Honey Onions: Exposing 
Snooping Tor HSDir Relays
Guevara'Noubir &'Amirali Sanatinia
{noubir,'amirali}@ccs.neu.edu
Northeastern'University
1
Motivations
• Previous'research'studied'the'maliciousness'of'the'relays
• Known'bad'Exit'nodes
• Other'work'looked'at'the'nature'of'hidden'services'content
• No'prior'work'on'the'Hidden'Service'Directories'(HSDirs)
• Indexing'hidden'services'requires'modification'to'Tor,'which'can'be'an'
indicator'of'some'effort'and'potentially'more'malicious'activities
2
Tor & Hidden Services
• A'widely'used'practical'anonymity'infrastructure
• Provides'anonymity'for'both'the'clients'and'the'server'through'
hidden'services
• Depends'on'the'honest'behavior'of'the'volunteering'relays
• It'is'known'that'some'relays'are'misbehaving'(Bad'Exit'nodes)
• Some'Exit'nodes'actively'try'to'perform'Man'in'the'Middle'Attack'
(MITM)
• Not'much'is'known'about'the'HSDirs or'Hidden'Services'in'general
3
Hidden Service Directories (HSDir)
Client
Hidden Service
IP
RP
HSDir
(1)
(2)
(3)
(4)
(5)
(6)
(7)
4
Ring of Responsible HSDirs
5
Honey Onions (HOnions)
• Each'HOnion corresponds'to'a'server/process
• Run'on'local'IP'address'(Hidden'Service)
• Accessible'only'through'Tor'and'not'shared'anywhere
• Three'schedules
• Daily
• Weekly
• Monthly
• Log'the'requests'for'further'investigation
6
HOnions Architecture
1. Generate honions
ho i
ho
j
2. Place honions on HSDirs
3. Build bipartite graph
On visit, mark potential HSDirs
ho
j
di
di+2
di+1
di
di+1
di+2
On visit, add to bipartite graph
7
Set Cover Problem
• !"# = %&': )*+%+,-./0%123ℎ%!"#2+%5-.6%
• !7 = ℎ*8: !792*9%3ℎ.3%1.0%:2023,&
• ; = !"# ∪ !7
• = =
ℎ*8,&8 %∈ !7%×%!"#% %ℎ*8%1.0%A-.Bed%on%&'%and%was%visited}
•
% %":%∀% ℎ*8,&' ∈ =, ∃&′' ∈ "% ∧ ℎ*8,&′'
∈ =
R%⊆TRU
VWXY'Z
• The'set'cover'is'an'NP-complete'problem
• Can'be'calculated'using'approximation'algorithms
• Set'cover'gives'the'lower'bound'on'the'number'of'snooping'HSDirs
8
Heuristic Approach
• Input:'''''G(V,%E): Bipartitie graph'of'HOnions to'HSDirs
• Output:''S:'Set'explaining'visits
• " ⟵ %∅
• while,,,;% ∩ !7% ≠ ∅%%%_o
• Pick'&% ∈ ;% ∩ %!"#: 123ℎ%ℎ26ℎ,03 degree
• ;% ← %;%\% &%.9&%230%!792*9%9,26ℎb*+0
• end
9
Integer Linear Programming (ILP)
• min %(ef, … , eTRU)''''''''''''''''∑
e8
|TRU|
8jf
subject'to%∀%ℎ*' ∈ !7
∑
e8 ≥ 1
m
∀%8: nop,qr ∈s
• Provides'a'lower'bound'on'the'number'of'snooping'HSDirs to'explain'
the'visits
10
Connectivity Graph
11
Snooping Behavior
• Wide'variety'of'behavior
• Automated'vs'manual'probing
• Aggressive,'periodic'probing
• Attempts'to'find'vulnerabilities
• SQL'Injection
• XSS
• Path'traversal
• PHP'Easter'Eggs
• Targeting'Drupal'and'Ruby'on'Rails
12
Snoopers’ Most Likely Geolocation
13
Snoopers’ Identity
• Hard'to'identify'the'real'entity'behind'the'relays
• More'than'half'of'the'HSDirs are'hosted'on'cloud'platform
• The'geolocations'correspond'to'the'location'of'the'hosting'platform'
and'not'necessarily'the'entity'running'them
• Number'of'cloud'platforms'are'located'in'countries'with'stronger'
privacy'protection'for'costumers
• Some'cloud'platform'accept'payments'over'bitcoin,'making'it'even'
harder'to'identify'the'real'actors
14
Conclusion
• Honey'Onions'(HOnions)'is'a'framework'to'detect'snooping'HSDirs
• Provides'a'lower'bound'on'such'relays
• Tor'relies'on'the'honest'behavior'of'the'volunteering'relays
• The'detection,'identification'and'mitigation'of'misbehaving'relays'
helps'to'improve'the'privacy'and'security'of'Tor
• This'work'is'an'addition'to'the'previous'body'of'work'focusing'on'
detection'of'misbehaving'Tor'relays
15