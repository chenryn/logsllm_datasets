**作者：深信服千里目安全实验室  
原文链接： **
## 摘要
漏洞研究者是大家心目中的安全专家，然而当安全专家的心理弱点被不讲武德的黑客利用，专家电脑上高价值的智力资产就会处于危险的境地，然而更危险的是这些本用于研究目的信息中如果存在可被武器化的内容，就导致研究人员无意中成为这些黑客的帮凶。
## 事件影响
26日，谷歌威胁分析小组披露了一系列来自东北亚某国黑客组织的针对安全研究人员(尤其是漏洞研究人员)的攻击活动。攻击者使用疑似Lazarus
APT组织的攻击基础设施，结合非常具有迷惑性的社工操作，骗取受害者信任，并可能以盗取安全公司电脑上的高价值漏洞研究资料达到攻击目的。目前国内已有一定数量的安全研究人员受到这个组织的欺骗，其研究电脑的敏感信息泄露。
## 攻击技巧
攻击者为了与安全研究者建立互信并保持联系，首先会在一些社交媒体上发布一些漏洞研究博客和Twitter，吸引相关研究者的关注。其已知的攻击策略有两种：
(1)在Twitter上进行一段时间的技术交流获得研究者信任后，攻击者会询问研究人员是否愿意开展合作研究，并向受害研究人员提供一个经过PGP加密的所谓“开展漏洞研究的VS源码项目”。其中在编译配置文件中调用了一段powershell脚本，加载了第一阶段的恶意DLL，进行一系列持久化配置在受害的研究者电脑建立后门，并与其C2服务建立连接，成为一个被控的目标。
(2)攻击者Twitter会链接到他们搭建的以漏洞研究博客为内容却包含疑似漏洞利用恶意代码的水坑站点。当受害者浏览相关页面时，其电脑将被安装一个恶意服务，并启动一个内存后门程序，开始与攻击者的C2建立连接，成为一个被控的目标。
在此，攻击者利用了安全研究人员的 ** _多个心理弱点_** ：
(1)研究者往往以为攻击者是个安全研究同行，且攻击者并不像其他漏洞贩子那样有金钱诉求，并在github上有长达近一年的持续内容更新，导致研究者降低了心理防御；
(2)漏洞研究者收到的攻击者的VS代码看来是明文，而研究者往往忽视对待编译代码配置文件的审计，意识不到编译过程中恶意代码就会执行；
## 攻击溯源
对比Lazarus组织2020年9月的攻击活动，从攻击者使用的C2域名，攻击技巧和恶意代码，可发现本次攻击事件Lazarus APT组织具有较大关联性。
（1）在基础设施上，有与Lazarus关联的C2（www.dronerc[.]it ，www.fabioluciani[.]com
），且使用的url有很大相似性：
（2）在攻击手法上，通过rundll32
加载恶意文件，传入16位随机字符串解密密钥“5I9YjCZ0xlV45Ui8”，payload命名方式（都以db为后缀），也与Lazarus组织2020年9月攻击活动的手法相似：
| 《Lazarus使用招聘诱饵结合持续更新的网络武器》 | 本次攻击事件  
---|---|---  
payload命名方式 | localdb.db | Browse.VC.db  
payload执行方式 | rundll32 | rundll32  
解密方式 | 16字节密钥 | 16字节密钥  
payload执行入口 | 导出函数 | 导出函数  
（3）对比相关payload文件，其数据解密部分，反射注入部分代码结构及代码数量方面具有很大的相似性：
## 技术分析详情
千里目高级威胁研究团队对相关恶意代码的分析显示其攻击的技术流程如下：
**攻击链1：**
(1)本次攻击者通过在VS项目中设置预构建事件命令，通过rundll32执行VS项目中附带的恶意64位的dll文件，编译时间戳为2020年12月19日(文件名Browse.VC.db，事实上是一个PE)：
描述 | 详细信息  
---|---  
名称 | Browse.VC.db  
文件大小 | 428544 bytes  
文件类型 | dll  
文件功能 | 释放器  
编译时间 | 2020/12/19 8:26:45  
开发平台及语言 | win/c++  
是否加壳 | 否  
VT首次上传时间 | 2020-12-31 22:25:33  
md5 | b52e05683b15c6ad56cebea4a5a54990  
Sha256 | 68e6b9d71c727545095ea6376940027b61734af5c710b2985a628131e47c6af7  
伪装成微软的组件程序：
截止到北京时间2021年1月26日下午18点，google发布预警数小时后，VT上也仅有15个引擎能够检出。
(2)调用导出函数，使用RC4解密出驻留文件夹路径、文件名称、注册表项等：
创建文件夹
    C:\ProgramData\VirtualBox\
打开注册表启动项，设置启动项数据
“HKLM\Software\Microsoft\Windows\CurrentVersion\Run”:
    C:\\Windows\\System32\\rundll32.exe  
    C:\\\\ProgramData\\\\VirtualBox\\\\update.bin,ASN2_TYPE_new 5I9YjCZ0xlV45Ui8 4113   
(3)内存解密释放第二阶段文件加载器update.bin，并且创建进程启动该加载器
    C:\ProgramData\VirtualBox\update.bin
描述 | 详细信息  
---|---  
名称 | update.bin  
文件大小 | 524288 bytes  
文件类型 | dll  
文件功能 | 加载器  
编译时间 | 2020/12/19 8:24:34  
开发平台及语言 | win/c++  
是否加壳 | 否  
VT首次上传时间 | 2020-12-31 22:10:41  
md5 | 9e9f69ed56482fff18933c5ec8612063  
Sha256 | 25d8ae4678c37251e7ffbaeddc252ae2530ef23f66e4c856d98ef60f399fa3dc  
(4)该加载器在内存解密新的dll，并且反射加载，传递固定参数4113
描述 | 详细信息  
---|---  
名称 | Dll.dll  
文件大小 | 475648 bytes  
文件类型 | dll  
文件功能 | 远控  
编译时间 | 2020/12/19 6:49:44  
开发平台及语言 | win/c++  
是否加壳 | 否  
VT首次上传时间 | 2020-12-31 22:10:41  
md5 | 0D8A05DE2C0D4DB54644178933AFA775  
Sha256 | 858AF1B8F4EFAEF560784617405FA46B714A69FCCA060E1F770C640883EAC3FF  
(5)执行后，只开启一个线程作监听作用，便于后续执行上传下载操作，C2地址：
    hxxps://codevexillium.org/image/download/download.asp   
    hxxps://angeldonationblog.com/image/upload/upload.php   
与C2进行数据通信，目前相关页面已经被删除
**攻击链2：**
根据Google安全报告以及安全人员反馈，该攻击者还疑似使用chrome浏览器0day漏洞对目标进行攻击。攻击成功会在其相关注册表留下被加密的payload，并且释放一个伪造为驱动文件的DLL文件创建服务进行驻留（如helpsvc.sys）。
其创建的两条注册项分别为
HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\KernelConfig  
HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\DriverConfig
其中注册表中保存着相关payload的加密数据
其拥有如下导出函数ServiceMain，调用并且注册服务
其会解密相关注册表路径，并且读取注册表中的数据
    HKLM\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\KernelConfig
读取SubVersion值，为数据大小
读取Description值，其为加密的payload数据
解密读取的数据为一个远控DLL文件，释放器会进行反射注入并且调用
描述 | 详细信息  
---|---  
名称 | T_DLL.dll  
文件大小 | 743936 bytes  
文件类型 | dll  
文件功能 | 远控  
编译时间 | 2020/11/7 17:51:10  
开发平台及语言 | win/c++  
是否加壳 | 否  
VT首次上传时间 | 2020-12-31 22:25:33  
md5 | 364FAFB8764183C926E7AB644B0D09A4  
Sha256 | D84E101B92F90D2349FE0F5CD25B8219B71FF4F413C7263BB6CBF2690B032F66  