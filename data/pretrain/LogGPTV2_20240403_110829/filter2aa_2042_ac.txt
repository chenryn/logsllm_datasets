算法模型（检测篇---外部引用）
域间路由的中间人攻击模型
域间路由的中间人攻击通常基于前缀劫持来实现。前缀劫持宣
告伪造的路由以劫持通往受害网络的流量。典型的前缀劫持如图所
示。AS6向外非法宣告属于AS1的前缀10.1.16.1/22，使得AS4和AS5
被该伪造路由污染。进而，它们到达受害网络AS1的流量也将被劫
持到AS6中。如下图示:
AS1是网络10.1.16.1/22的真实所有者，我们标示为:f
AS5为起始网络/受污染网络，我们标示为:Y
AS6为起始攻击者网络，我们标示为:X
在攻击发起前从Y到f的AS_PATH为：AS2 AS1。
在攻击发生后，从Y到f的AS_PATH为：AS6 AS2 AS1。如下图:
检测 & 防御
域间路由中间人攻击的异常特征
首先，如节上所述，域间路由中间人攻击的第1步是实施前缀劫持。鉴于前缀劫持会造成MOAS(multiple origin AS)冲突，
因此产生异常的MOAS是域间路由中间人攻击的第一个重要特征。
由上述分析显见，除产生上述控制平面的MOAS异常外，域间路由中间人攻击还具有另外2个典型特征，即：
1) 受污染网络在攻击之后，其到达受害前缀的数据平面的转发路径比控制平面的AS-path要延长(换言之，控制平面的
AS-path是其数据平面的转发路径的子路径)。
2) 受污染网络在攻击之后到达受害前缀的转发路径的终点正是攻击之前到达该前缀的AS-path的终点。
综合上面的分析，可使用公式表达式来描述：
：
算法模型（检测篇---外部引用）
安全增强协议RPKI 与BGPsec （终极防御篇）
 RPKI（RFC 6810）
针对BGP路由前缀劫持问题，当前业界正在推进的方案是RPKI（Resource Public Key Infrastructure:互联网码号资源公钥基础设施）。
在之前亚马逊的案例中，当天上午为时两小时的过程中，攻击者（AS10297）对以下前缀发起了路由起源声明：
205.251.192.0/24, AS10297
205.251.193.0/24, AS10297
205.251.195.0/24, AS10297
205.251.197.0/24, AS10297
205.251.199.0/24, AS10297
如果亚马逊部署RPKI并签发资源证书和ROA（路由起源认证），那么其他部署了RPKI路由器的自治网络就可以帮助过滤这些虚假路由。
具体地说，亚马逊使用自己的RPKI证书签发以下ROA并发布到全球资料库中：
那么部署了RPKI路由器的其他自治网络，就可以从RPKI依赖方那里得到验证后的IP前缀和起源AS号的绑定关系，继而判定起源于AS16509的相应
路由通告为真并将其保留，以及判定由攻击者发起的起源于AS10297的路由通告为假并将其丢弃，从而完全抵御这次路由劫持。
RPKI作为一种域间路由安全机制，本身只能提供路由起源认证，而不能提供路由全路径认证，所以RPKI能够避免以上这种前缀劫持攻击。
安全增强协议RPKI 与BGPsec （终极防御篇）
 BGPsec（RFC 8206）
但其他类型的路由攻击（如路由泄漏攻击和路径缩短攻击）可以绕过RPKI进行流量劫持。针对这种情况，IETF提出了一种部署在RPKI
之上的全路径认证机制——BGPsec，并将其标准化。BGPsec要求每一个AS都对它接收到的路由通告消息进行签名，签名内容作为路由消
息的路径属性BGPsec_Path_Signatures通告给邻居AS。
签名内容包括：
(1)上一个AS的BGPsec_Path_Signatures；
(2)本自治系统的AS号；
(3)路由消息要发往的自治网络的AS号；
(4)本AS的RPKI路由器公钥。
由此可见，BGPsec_Path_Signatures实际上代表了AS路径中的前一AS对后一AS继续通告该路由的授权。
部署了BGPsec的AS在路径签名之前还要进行路径验证，验证过程如下：
当一个AS收到路由通告消息后，会依次验证AS路径中每一个AS对应的BGPsec签名（包含在BGPsec_Path_Signatures中）。如果全部验
证成功，说明该AS路径是真实有效的，当前AS才可能采用并继续向外广播该路由通告。BGPsec可以有效避免BGP路径缩短攻击。
Say good,but you exchange the CARDS under the table
PART 05
BGP,AT&T and NSA
BGP,AT&T and NSA 
说好的不出老千，你却桌底换牌……
棱镜门始。末…
棱镜计划（PRISM）是一项由美国国家安全局（NSA）自2007年起开始实施的绝密电子监
听计划。该计划的正式名号为“US-984XN”。
揭秘者德华·斯诺登曾是美国中央情报局技术分析员，《华盛顿邮报》说，斯诺登之前
是国家安全局设在夏威夷的威胁行动中心的系统管理员，更早曾替中情局工作。斯诺登爆料
称，美国政府随时可以读取任何人的电邮，令包括谷歌在内的网络巨头致函美国政府自清，
他还称美国政府已入侵中国大陆与香港特区的网络多年。
泄露的文件中描述PRISM计划能够对即时通信和既存资料进行深度的监听。许可的监听对
象包括任何在美国以外地区使用参与计划公司服务的客户，或是任何与国外人士通信的美国
公民。国家安全局在PRISM计划中可以获得的数据电子邮件、视频和语音交谈、影片、照片、
VoIP交谈内容、档案传输、登入通知，以及社交网络细节。综合情报文件“总统每日简报”
中在2012年内在1,477个计划使用了来自PRISM计划的资料。
泄露的数据显示，自2009年以来，美国已针对中国网络发动了大规模的入侵活动。攻击
目标达到数百个之多，其中还包括学校。据悉，美国政府黑客主要通过入侵巨型路由器从而
一举入侵成千上万台电脑，而不是分别入侵每一台电脑。
BGP,AT&T and NSA 
基础设施建设篇
BGP,AT&T and NSA 
基础设施建设篇
美国国家安全局（NSA）的秘密据点隐藏在美国各地的城市中，那些高耸的没有窗户的摩天大楼和足以抵御地震，甚至核攻击。成千上万的人每天经过这些建筑物，很少再给他们看第二眼，因为
他们的功能并未公开。它们是全球最大的电信网络中不可分割的一部分，它们也与有争议的国家安全局监视计划相关。
亚特兰大，芝加哥，达拉斯，洛杉矶，纽约，旧金山，西雅图和华盛顿特区。截讯网在以上每个城市都确定了一个AT&T的设施，其中的网络设备可以截获美国传输大量的互联网数据。一系列证据
（包括国家安全局的文件，公共记录以及与多名前美国电报电话公司员工的访谈） 都表明，这些建筑物是国家安全局间谍活动的核心，多年来一直监控数十亿封通过美国的电子邮件，电话和在线聊
天。(可靠消息来源theintercept.com)
BGP,AT&T and NSA 
技术可行性
 战略层面技术点可行性：
在恰当节点先通过BGP Prefix hijack、BGP AS_PATH hijack、
HTTPS TLS hijack等技术控制目标网络流量，然后分而治之
 战术层面技术点可行性：
衔接上一环节的分类流量，并针对不同具体类型的流量制定与之对应的后续处理流程。例如：
明文监听：
ftp、http、telnet、http、smtp、snmp、pop、pop3、VoIP、UPnP…
明文传输数据不解释。
加密通讯信任关系降级攻击：
ssh、https（tls hijack）、3389（RDP）、VNC…
第一步client至server端信任关系欺骗。后面的都可以依靠假证书或信任关系解密数据。
加密数据通讯监听：
ssh、https、mssql、mysql、Oracle Datebase、DB2、3389（RDP）、VNC…
实时监听密文数据包，必要时调用超算资源破解。
BGP,AT&T and NSA 
我国互联网节点通讯安全现状
网络安全公司 Rapid7 近日发布的《2018国家暴露指数报告》显示，全球端口暴露最严重的十个国家为美国、中国、加拿大、韩国、英国、法国、荷兰、日本、德国和墨西哥，其中
美国暴露的情况最严重，中国位列第二，仅次于美国。
中国1400万服务器暴露原因
中国有超过3.4亿个 IPv4 地址，Rapid7 的研究人员发现中国有约1400万台服务器对扫描有响应。
报告指出，中国暴露严重的主要原因在于缺乏加密服务，这使被动的监控和针对不安全明文协议的主
动攻击成为可能。从这方面来看，中国的 Web 服务器数量远不及其他国家，且加密 Web 的比率为26%，
远远低于 Rapid7 期望的35%。
Rapid7 指出，由于中国人倾向于使用中国托管的网站，而非国际托管服务，因此这一点会带来麻烦。
同样，中国的加密 Shell 比率为58%，远远低于与之经济实力相当国家的平均水准（75%），更易遭受类
似 Mirai 僵尸网络的攻击。
BGP,AT&T and NSA 
总体概况综述：
1、引用的数据反映了现状态下我国暴露在外的互联
网的节点数世界第二,仅次于美国。
我国互联网节点通讯安全现状
HTTP VS HTTPS
Telnet VS SSH
IMAP VS IMAP over SSL
POP3 VS POP3 over TLS
SMTP VS SMTPS
2、这些暴露在外的数据超过50%是没有加密的。（50%+）
3、以上还没有算上加密协议漏洞、可进行加密通讯信
任关系降级攻击和软硬件级别供应链攻击手段影响的
范围。
BGP,AT&T and NSA 
总体概况综述：
近几年来虽然IETF已经有RPKI、BGPsec等安全的BGP标准推出,但由于种种原因（硬件资源消耗、迭代成本、过度风险等）这些标准的推进部署进度依旧十分缓慢。
所以要有一个清晰的认识：
BGP在未来的5至10年内依然不是安全的
我国互联网节点通讯安全现状
谢谢观看
演讲人：张玉兵(Eric)
360威胁情报中心
个人交流微信