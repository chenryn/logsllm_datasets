venenof@ubuntu:/tmps cat flag
venenof@ubuntu:/tmps vin -r flag
venenof@ubuntu:/tmps cat flag
flag{aaaaaa}
venenof@ubuntu:/tmpS
For SWP backup files, we can use the “"vim -r” command to restore the file’s
contents. To create a test demo case, execute the *vim flag” command first and then
close the terminal directly. A flag.swp file will be generated in the current directory.
To recover the SWP backup file, first create a flag file in the curent directory, then
use the command “vim -r flag”, you can get the contents of the file that was edited
when you exited unexpectedly. See Fig. 1.9.
3. Common files
Some common files could leak sensitive messages, and these files are summarized
by experts and listed in directory files of scanning scripts. Here are some examples.
•robots.txt: records some directory and CMS version information.
·readme.md: Records CMS version information, some even have a Github
address.
▪www.zip/rar/tar.gz: often the source codes of a website.
4. Personal experience
Some challenge maintainers modify their challenge files online during CTF online
competitions, and SWP backup files are generated due to vim’s feature. Thus players
could unintentionally get source codes or sensitive messages.
---
## Page 25
1.1 Significant *Information Gathering”
The backup file generated by vim on the first abnormally exit is format as *, swp,
the second exit could get *, swo, *, swn would be generated on the third exit. The
official vim manual also contains backup files with name format as *.un.filename.
dms
In addition, in a real-world environment, the backup of a website may often be a
zip file named as the domain name (google.zip) or date (2021-7-1.zip).
1.1.2.3 Banner Identification
In the CTF online competition, the website's banner information (some basic
players can often get the solutions from the banner information. For example, if
we know that the site is a windows server, we can exploit the upload vulnerability in
particular ways according to the features of windows. Here are the two most
common ways to identify banners.
1. collect your fingerprint database
There are several publicly available CMS fingerprints on GitHub that readers can
find for themselves and some well-known web scanners to identify websites.
2. Use existing tools
We can make use of the python-Wappalyzer, which is a Python library. The demo
code is listed below.
$ pip instal1 python-Wappalyzer
>>> vappalyzer = Wappalyzer. 1atest ()
>>> fron Kappalyzer inport Wappalyzer, KebPage
(obedqon) ozAteue*xozAtedden c>> vebpage = MebPage -neu_fron_ur1 ( *http : / /example . com′ )
set ([u′EdgeCast])
The apps.json file includes rules in the data directory, and readers can modify it
according to their needs.
3. Personal experience
When performing banner information detection on the server, we can also try to
enter some URLs at will, and sometimes we can find some information through the
404 error pages and 302 redirection pages. For example, the ThinkPHP (a kind of
web application) server with the debug option tumed on will display the ThinkPHP
version on error pages.
---
## Page 26
10
1 Introduction to the Web
1.2 SQL Injection in CTF
During the development process of web applications, many developers use data-
bases for data storage to quickly update the contents. Due to the lack of strict filtering
of the user input, the attacker could inject the possible attack payloads into SQL
query statements and then pass these query statements to the back-end database for
execution, resulting in a situation where the actual statements were executed incon-
sistently. This attack is known as an SQL injection attack.
Most applications put data such as passwords into the database. SQL injection
attacks can leak sensitive information in the system, making it an entry-level
vulnerability into the Web system. Thus, most CTF competitions take SQL injection
as a challenging point, and SQL injection vulnerability is one of the most common
vulnerabilities in real-world applications.
This chapter describes the principles, exploits, defenses, and bypass methods of
SQL injection. Given the space limit and the similarity of the principles of SQL
injection, only the most frequently exploited injection attacks against MySQL
databases during the competitions are covered, no more details about Access,
Microsoft SQL Server, NoSQL, etc. The reader needs to have some basic knowledge
of SQL and PHP to read this chapter.
1.2.1SQLInjectionBasics
SQL injection is a technique in which developers do not strictly filter the user input,
which causes the user input to affect the query function, and finally causes the
original information of the database to be leaked, moxdified, or even deleted. This
Spu p  sseq uoou s aonp o sadx ads sosn oos
digital SQL injection, UNION SQL injection, character SQL injection, Boolean-
blind-based SQL injection, time-based SQL injection, error-based SQL injection,
snbrup uodx Supodsauoo sadi uooou oqo pue uoofu Os xoes
[Test Environment】 Ubuntu 16.04 (IP address: 192.168.20.133), Apache,
MySQL 5.7, PHP 7.2.
1.2.1.1  Numerie SQL Injection and UNION SQL Injection
The PHP code snap for the first example (sql1.php) is shown below (see comments
for code introduction).
sq11-php
 select * fron wp_news;
wp_news
td
title
content
1
ibs
tt ts the begtnntng
2have
fun
2 rows tn set (o.o0 sec)
Fig, 1.12 Contents of table
wp_ user
1 | adntn  thts_ts_the_adntn_password
1 row in set (0.66 sec)
...........................
Sres = mysqli_query (Sconn, *SEL&CT title, content FROM wp_news HHERE
id=",S_Ger['id*]l ;
// Description: The code and commands are not case sensitive for SQL
statements, the keywords are uppercase here for clarity .
// Converts the query resulta to an array.
Srow = mysqli_fetch_azray ($res) :
echo *ccenter>′;
// Output the value of the title field in the results.
[]x <> 
/ / Output the value of the content field in the result .
echo ** ;
echo *a . $row[′content′] . ** ;
echo ** ;
? >
The table structure of the database is shown in Fig. 1.10. The contents of the news
table wp_news are shown in Fig. 1.11. The contents of the user table wp_user are
shown in Fig. 1.12.
The goal of this section is to tum the news table query into a query for the admin
table(usually the administrator) s columns account and password (the password is
usually a hash value, but here it is rendered in plaintext this_is_the_admin_password
for the demonstration) by changing the id value entered in HTTP's GET method. The 
---
## Page 28
12
1 Introduction to the Web
+
sqli
it is the beginning
Fig, 1.13 Result
nysql> select tltle,content fron wp_news where td=1;
sqlt
tt ts the begtnntng
row in set (o.oo sec)
Fig, 1.14 Result
admin’s account and password are the essential credentials of a web system, which
allows an attacker to log in to the backend system and control the entire web system.
The results are shown in Fig. 1.13.
The page displays the same results as the first row of id1 in the news table
wp_news in Fig. 1.11. PHP has injected the id1 passed by the GET method with
the previous SQL query statement. The original query statement is as follows.
Sres = mysql1_query (Sconn, "SELECT title, content FRON vp_news WHERE
id=", S_GEr['id']) ;
A request is received from http://192.168.20.133/sql1.php?id1, $_GET[id’] is
assigned a value of 1. The final query statement passed to MySQL is as follows.
SELECT tit1e, content FROH wp_news HHERE id = 1
We can get the same result by querying directly in MySQL, see Fig. 1.14.
The contents of most websites on the Internet today are stored in databases, and
the corresponding records are queried from the database through parameters such as
the user's incoming id and then displayed in the browser, such as *2" in http://192.1
68.20.133/sql1.php?id2. The result is in Fig. 1.15.
The following procedure demonstrates a SQL injection attack using the id
parameter entered by the user.
Visiting the link http://192.168.20.133/sql1.php?id=2, Fig. 1.16 shows the
record with id2 in Fig. 1.11, then visiting the link http:/192.168.20.133/sql1.
php?id=3-1, the page still shows the record with id=2. See Fig. 1.17. This
---
## Page 29
1.2  SQL Injection in CTF
 select title,content fron wp_news where id=-1
Enpty set (o.oo sec)
Fig, 1.21 Result
ttetecntent
p_user
onter
row tn set (0.o1 sec)
Fig, 1.22 Result
 不R全 ( 192.948.20.131/1/
admin
this_is_the_admin_password
Fig, 1.23 Result
Usually, the method shown in Fig. 1.22 is used to control result rows. Accessing
http:/192.168.20.133/sql1.php?id-1 union select user, pwd from wp_user, and the
result is shown in Fig. 1.23.
The injection approach to presenting data to a page using the UNION statement is
commonly referred to as UNION (union query) injection.
Since we already know the database structure in the example we just gave, how
do we know the field name pwd and the table name wp_user in blind pentesting?
After MySQL 5.0 version, it comes with a database information_schema by
default, from which all database names, table names, and field names of MySQL
can be queried. Although the introduction of this database facilitates the query of
database information, it objectively greatly facilitates the exploitation of SQL
injection.
Let us start with a real injection case. Assuming that we do not know anything
about the target database, the first thing we should do is determining if there is a
numerical injection by the same page result of id3-1 and id2 (ie., Fig. 1.16 is
consistent with Fig. 1.17), and then we use a union query to find all the other table
names in the database. The corresponding injection process is visiting URL as http://
192.168.20.133/sql1.php?id=-1 union select 1,group_concat(table_name) from
information_schema.tables where table_schema=database(), the results are shown
in Fig. 1.24.
---
## Page 32
16
1 Introduction to the Web
+x srRwm 0e e e
1
wp_files,wp_news,wp_user
Fig, 1.24 Result
aset):
gl> select table_nane fron Infernatton_schena.tables where tabte_schena=datab
file
Ln set (o.oo sec)
Fig, 1.25 Get the table
id,user,pwd
Fig, 1.26 Get the column
The table_name column represents the table name of tables recorded in
information_schema. There is also a database name column referred to as
table_schema in information_schema. The result returned by the databaseO function
is the current selected database’s name, and the group_concat() is a function that uses
° to combine multiple rows of records. In other words, this statement can jointly
query all (in fact, a specific length limit) table names in the current database and
combine them in one cell. The consistency of the results in Figs. 1.24 and 1.25 also
proves the validity of the sentence. In this way, you can get one of the existing tables
named wp_user.
Similarly, the columns table and its field name column_name could help query all
column name of wp_user table. Access hp://192.168.20.133/sql1.php?id-1 union
select 1, group_concat(column_name) from information _schema.columns where
table_name = *wp_user*, you can get the corresponding column name, see Fig. 1.26.
---
## Page 33
1.2 SQL Injection in CTF
17
At this point, the first example is over. The key to digital SQL injection is to find
the user input point. Then through addition, subtraction, multiplication, division,
etc., it could be judged that if there are quotation marks wrapped around the input
parameter in a SQL query, some general attack methods could be exploited to obtain
sensitive information in the database.
1.2.1.2 Character SQL Injection and Boolean Blinds SQL Injection
se °dqdzbs on dqd 1bs jo apoo oomos oqp jo uogeogspou apdus e s! umoog au
shown below.
sq12-php
dud >
Sconn = mysgli_connect ("127.0.0.1", *root", *root*, "test") ; 
$res = mysqli_quezy (Sconn, SELECT title, content FROH wp_news MHERE
id = **,$S_GEr['id′] .***] ;
Srou = mysqli_fetch_array (Sres) ;
echo "";
*[]x<> oo
echo "" Srov[*content°] . *;
echo "";
echo "";
? >
ndu 1ajoueed La p punoe sajonb asuis sdeum 1! dud1bs o1 paeduo
making it a string to query in MySQL
SELECT tit1e, content FROH wp_news KHERE id = +1′ ;
The results are shown in Fig. 1.27.
are uorssadxa t3rs enbo o jo sops qpoxq uo sxd wep o ! “TOs desc wp_news;
Fleld
Type
INull
|Key
Default|Extra
td
(nt(5)
NULL
varchar(255)
YES
SEA
NULL
NULL
content
rows tn set (0.6o sec)
Fig, 1.27 Result
Fig, 1.28 Result
'1'=1
'1a'=1|'a'=0
11
11
11
row in set, 2 warnlngs （0.01 sec)
1-Cpd |: 0
Fig, 1.29 Not a number type injection
191.908
①不营全 |192.18.20.138/0/2.pho
have fun
have fun baby!
Fig, 1.30 Character-type injection
---