# 【缺陷周话】第39期：解引用未初始化的指针
##### 译文声明
本文是翻译文章
译文仅供参考，具体内容表达以及含义原文为准。
## 1、解引用未初始化的指针
指针声明后没有进行初始化就对其进行解引用，会导致未定义的行为。一些动态内存分配方法虽然会对内存进行申请，但也可能不会对申请的内存进行初始化，如：
malloc()、 aligned_alloc() 不会初始化，而 calloc()
会初始化为0。程序在解引用这些不确定的值时可能会触发非预期的行为，甚至可能会让程序存在被恶意攻击的严重隐患。详见 CWE-457: Use of
Uninitialized Variable (3.2) 。
#
##  2、解引用未初始化的指针的危害
未初始化的指针拥有不确定的值，对未初始化的指针进行解引用可能会导致空指针解引用或其他不符合预期的行为。
CVE中也有一些与之相关的漏洞信息，从2018年1月至2019年6月，CVE中就有4条相关漏洞信息。漏洞信息如下：
CVE 编号 | 概述  
---|---  
CVE-2018-19407 | Linux kernel 4.19.2 及之前版本中的 arch/x86/kvm/x86.c 文件的
‘vcpuscanioapic’
函数存在安全漏洞，原因是当满足一定条件时ioapic未初始化。本地攻击者可借助特制的系统调用利用该漏洞造成拒绝服务（空指针解引用）。  
CVE-2018-19406 | Linux kernel 4.19.2 及之前版本中的 arch/x86/kvm/lapic.c文件的
kvmpvsend_ipi 存在安全漏洞，原因是当满足一定条件时apic
map未初始化。本地攻击者可借助特制的系统调用利用该漏洞造成拒绝服务（空指针解引用）。  
CVE-2018-4040 | Atlantis Word Processor 3.2.7.1 版本和 3.2.7.2 版本中的 rich text
format parser 存在安全漏洞。攻击者可通过诱使用户打开特制的文档利用该漏洞造成RTF令牌解引用未初始化的指针，进而执行代码或造成应用程序崩溃。  
CVE-2018-3842 | Foxit PDF Reader 9.0.1.1049 版本中的 JavaScript
引擎存在一个未初始化指针漏洞，通过构建特殊的 pdf 文件可以导致解引用未初始化的指针，攻击者利用该漏洞执行任意代码。  
## 3、示例代码
示例源于 Samate Juliet Test Suite for C/C++ v1.3
(https://samate.nist.gov/SARD/testsuite.php)，源文件名：CWE457_Use_of_Uninitialized_Variable__double_pointer_01.c。
### 3.1 缺陷代码
在上述示例代码中，第26行定义了 double 类型指针 data，但并未进行初始化，随后在第30行对 data 进行了解引用，由于此时 data
并未被赋值，其指向的内存也是未定义的。因此存在“解引用未初始化的指针”问题。
使用代码卫士对上述示例代码进行检测，可以检出“解引用未初始化的指针”缺陷，显示等级为高。如图1所示：
图1：”解引用未初始化的指针” 检测示例
### 3.2 修复代码
在上述修复代码中，Samate给出的修复方式为：在第27行定义了 double 类型的指针 data，第32行使用 malloc()
动态申请内存并在第33行判断内存申请是否成功，随后在第34行对指针 data 进行初始化，从而避免了第35行解引用未初始化的指针问题。
使用代码卫士对修复后的代码进行检测，可以看到已不存在“解引用未初始化的指针”缺陷。如图2：
图2：修复后检测结果
## 4、如何避免解引用未初始化的指针
（1）在指针声明时完成初始化操作，避免解引用未初始化的指针。
（2）谨记一些动态内存分配函数不会对指针进行初始化，在申请内存后需要人工对申请的内存进行初始化。