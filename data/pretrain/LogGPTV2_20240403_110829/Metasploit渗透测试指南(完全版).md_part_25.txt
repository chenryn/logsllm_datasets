[*]192.168.4.122(Apache/2.2.3(Red Hat))WebDAV disabled.
[*]Scanned 13 of 31 hosts(041% complete)
[*]192.168.13.242.251 (Microsoft-IIS/6.0) WebDAV disabled.
[*]192.168.13.242.234(Micr0s0ft-IIS/6.0)WebDAV disabled.
[*] Scanned 16 of 31 hosts (051% complete)
[*]192.168.8.67(Micr0soft-IIS/6.0) WebDAV disabled.
[*]Scanned 19 of 31 hosts (061% complete)
[*] 192.168.6.113 (Microsoft-IIS/5.0) has WEBDAV ENABLED
[*]192.168.13.242.231 (Microsoft-IIS/6.0) WebDAV disabled.
[*]Scanned 22 of 31 hosts(o70% complete)
[*]192.168.13.242.249 (Micr0soft-IIS/6.0) WebDAV disabled.
[*]Scanned 25 of 31 hosts(080% complete)
[*]192.168.4.115(Microsoft-IIS/6.0)WebDAV disabled.
[*]192.168.8.66(Microsoft-IIS/6.0)WebDAV disabled.
[*]Scanned 28 of 31 hosts (o90% complete)
[*]192.168.8.68(Micr0soft-IIS/6.0)WebDAV disabled.
[*]Scanned 31 of 31 hosts (100% complete)
[*]Auxiliary module execution completed
本例中你可以看见，我们对多台HTTP服务器是否开启WebDAV进行了扫描探测O，并快
速识别出了一台开启该服务的主机②，我们可以针对这台主机展开进一步攻击。
提示：辅助模块的功能绝不只限于扫描。在14章中你会看到仅需要简单的修改，就能将
辅助模块变成很棒的漏洞Fuzz测试器。一些用于拒绝服务攻击的辅助模块甚至可以用来攻击
Wi-Fi网络（如dos/wifi/deauth模块），这些模块如果使用得当会具有相当的破坏性
9.2辅助模块剖析
让我们通过一个有趣的小例子看一看辅助模块的内部结构，这个例子没有包含在Metasploit的
模块库中（因为它实际上和渗透测试没有任何关系）。这个例子将向你展示使用Metasploit框架进行
开发是多么的省时省力，它能让我们将注意力集中在模块功能细节上，而不是处理大量重复的代码。
译者注：本例中的Foursquare是一个基于用户地理位置信息的手机服务网站，它鼓励手机
用户通过签到（Check-in）的方式同他人分享自己当前所在地理位置等信息，每个地址位置有
一个唯一的标识，称为VENUEID。用户每签到一次将会得到一些虚拟积分，可以使用虚拟积
分来获得头衔一一如某市市长等等。这个例子中介绍的模块显然可用于刷积分。
128
---
## Page 156
第9章Metasploit辅助模块
克里斯·盖茨（ChrisGates）为Metasploit框架写了一个“神奇”的辅助模块，这个模块给
他的Twitter粉丝留下的印象是，他似乎发明了一种可以光速旅行的设备。这个模块是一个显示
Metasploit代码重用有时很棒的的例子。（你可以在http://carnalOwnage.googlecode.com/查看这个
模块脚本的源代码）
0root@bt:/opt/framework3/msf3#cdmodules/auxiliary/admin/
root@bt:/opt/framework3/msf3/modules/auxiliary/admin# wget http://carnalownage.googlecode
.com/svn/trunk/msf3/modules/auxiliary/admin/random/foursquare.rb
我们下载这个模块并把它放入我们的辅助模块目录下·，以便能够在Metasploit环境中使
用它。不过在我们使用这个模块前，让我们看一看实际的脚本代码，并把各个代码模块分解，
这样我们就能够知道这个模块到底包含了哪些内容。
require'msf/core'
0 class Metasploit3'FoursquareLocation Poster'，
'Version
=>'$Revision:$',
'Description' => 'F*ck with Foursquare, be anywhere you want to be by venue id',
'Author'
“[.5D.] MSF_LICENSE,
'References'
"/vi/checkin?vid=#{venid}",
'version'=>"1.1",
‘method'=>'POST'，
'data'=> postrequest,
'headers'=>
'Authorization'=>"Basic #{user_pass}",
}
}，25)
现在我们进入脚本中实际的逻辑流程部分，也就是当run函数被调用后发生的一系列事情。
首先将输入的参数传递到局部变量中·，并且定义了-一些其他的对象。然后使用send_request_cgi
方法?创建了-个对象，这个方法是由lib/msf/core/exploit/http.rb导入到脚本中的，这个方法定
义对它的功能描述是“连接到服务器，创建一个请求，发送请求，最后读取服务器返回的信息”。
如本例所示，使用这个方法需要多个参数，它会连接到实际的远程服务器上。
Oprint_status("#{res}")#thisoutputs the entire response.We could probably do
#withoutthisbutit'snicetoseewhat'sgoingon.
end
Orescue ::Rex::ConnectionRefused, ::Rex::HostUnreachable, ::Rex::ConnectionTimeout
rescue::Timeout::Error,::Errno::EPIPE =>e
puts e.message
end
end
创建这个对象后，将服务器返回的信息显示出来·。如果执行过程中发生错误，在·处有
一段错误处理的逻辑判断，它会将错误信息报告给使用者。代码中所有的逻辑非常简单，实际
130
---
## Page 158
第9章Metasploit辅助模块
上只是将Metasploit框架所提供的各种功能拼接起来。这个例子很好地展示了Metasploit框架的
强大功能，使用这个框架进行开发时，我们只需要关注为了达到目标所需的各种信息，而不必
关心如何进行错误处理、如何管理网络连接等等。
让我们看看这个模块运行时的样子。如果你不记得这个模块在Metasploit目录中的完整路
径，可以这样进行查找：
① msf> search foursquare
[*]Searchingloaded modulesfor pattern'foursquare'.
Auxiliary
Name
Rank
Description
admin/foursquare
normal
Foursquare Location Poster
 msf > use admin/foursquare
③msf auxiliary(foursquare）>info
Name:Foursquare LocationPoster
Version:$Revision:$
License:Metasploit Framework License (BSD)
Rank:Normal
Provided by:
CG 
Basic options:
Name
Current Setting
Required
Description
PASSWORD
password
yes
foursquare password
Proxies
no
Use a proxy chain
RHOST
api.foursquare.com
yes
The target address
RPORT
80
yes
The target port
USERNAME
username
yes
foursquare username
VENUEID
185675
yes
foursquare venueid
VHOST
no
HTTP server virtual host
Description:
F*ckwithFoursquare,beanywhereyouwanttobebyvenueid
References:
http://groups.google.com/group/foursquare-api
http://www.mikekey.com/im-a-foursquare-cheater/
131
---
## Page 159
Metasploit渗透测试指南
在上面的例子中，首先我们查找“foursquare”关键字·得到模块的全名，并输入use命令
②选择这个模块，然后显示这个模块的详细信息③。根据信息中提供的参数列表，我们对这个
模块进行配置。
0 msf auxiliary(foursquare)>set VENUEID 2584421
VENUEID => 2584421
msf auxiliary(foursquare)>set PI:EMAIL
USERNAME => metasploit
msf auxiliary(foursquare)> set PASSwoRD ilovemetasploit
PASSwORD => ilovemetasploit
 msf auxiliary(foursquare）>run
[*]Base64 Encoded User/Pass:bxNmQGVsd29vZC5uZXQ6aWxvdmVtZXRhc3Bsb210
[*]Base64DecodedUser/Pass:PI:EMAIL:ilovemetasploit
[*]HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Date: Sat, 08 May 2010 07:42:09 GMT
Content-Length:1400
Server: nginx/0.7.64
Connection:keep-alive
40299544Sat,08May1007:42:09+00000K!
We've got you @ washington DC Union Station.This is your 1st checkin here!
2584421WashingtonDCUnionStation79283http://foursquare.com/img/categories/travel/trainstation.png4685446Ronhttp://
playfoursquare.S3.amazonaws.com/userpix_thumbs/ELoW44QHXJFB4PwZ.jpgmale1Newbiehttp://foursquare.com/img/badge/newbie
.pngCongrats on your first check-in!
message>
为了成功地运行这个模块，我们需要一对合法的Foursquare用户名和口令以完成签到
（Check-in）操作。我们首先在Google上查找到一个合法的地域ID（VENUEID），然后设置好
VENUEIDO以及Foursquare网站的登录凭据?等必填参数，最后运行模块。通过Foursquare网
络服务返回的确认信息我们看到，签到已成功，而且获得了5个积分③。
在本例中，我们通过Foursquare 的网络服务提交了一次在华盛顿特区联合站（Washington
DCUnionStation）的“签到”（如图9-1所示）。
Friday May 7, 2010
3:42AM
Washington DC Union Station
Train Station
图9-1成功地在联合站签到
132
---
## Page 160
第9章Metasploit辅助模块
当我们登录到Foursquare网站时，我们同样能看到这次成功的操作。这个模块向我们展示：
我们能够想象到的事情，使用Metasploit儿乎都能做到。
9.3小结
如你所见，辅助模块可以有更广泛的用途。Metasploit框架提供的基础设施能够让你在短时
简内创建大量功能各异的辅助工具。使用Metasploit的辅助模块，你可以对一个IP地址范围进
行扫描，找到存活的主机，并识别出每台主机上运行的服务。然后，你可以利用这些信息来确
虽然你可以轻松地创建自定义的辅助模块，但不要低估了Metasploit自带辅助模块的能力。
这些模块的功能在实际渗透测试工作中可能正是你所需要的。
辅助模块拓宽了渗透攻击的道路与视野。对于Web应用程序来说，你可以使用辅助模块进
行多达40项的检查或攻击。有些情况下你可能希望能对一个Web服务器进行暴力搜索，以确
中转数据的开放代理。不论你的需求是什么，辅助模块都可以为你提供更大的信息量、更多的
攻击通道和安全漏洞。
DI
133
---
## Page 161
PDG
---
## Page 162
第
章
社会工程学工具包
这套工具包由ChrisHadnagy所构想设计，由本书的作者之一DavidKennedy实现。Social-engineer.org
网站集中提供了社会工程学的教程、技术说明、专业术语以及相关方案，能够帮助你掌握能够