following examples both display the /var/log/messages file stored on the Routing Engine in slot 1:
user@host> show log re1:messages
user@host> file show re1:/var/log/messages
For information about the fields in a log message, see Interpreting Messages Generated in Standard
Format by a Junos OS Process or Library, Interpreting Messages Generated in Standard Format by
Services on a PIC, and Interpreting Messages Generated in Structured-Data Format. For examples, see
"Log File Sample Content" on page 1326.
Log File Sample Content
This topic contains sample content from the /var/log directory. You can display the contents of
the /var/log/messages file stored on the local Routing Engine. (The /var/log directory is the default
location for log files, so you do not need to include it in the filename. The messages file is a commonly
configured destination for system log messages.)
NOTE: In Junos OS Evolved, the messages file is only written on the primary Routing Engine.
Backup Routing Engine messages are found in the messages file on the primary Routing Engine.
user@host> show log messages Apr 11 10:27:25 router1 mgd[3606]: UI_DBASE_LOGIN_EVENT: User
'barbara' entering configuration mode
Apr 11 10:32:22 router1 mgd[3606]: UI_DBASE_LOGOUT_EVENT: User 'barbara' exiting configuration
mode
Apr 11 11:36:15 router1 mgd[3606]: UI_COMMIT: User 'root' performed commit: no comment
1327
Apr 11 11:46:37 router1 mib2d[2905]: SNMP_TRAP_LINK_DOWN: ifIndex 82, ifAdminStatus up(1),
ifOperStatus down(2), ifName at-1/0/0
You can display the contents of the file /var/log/processes, which has been previously configured to
include messages from the daemon facility. When issuing the file show command, you must specify the full
pathname of the file:
user@host> file show /var/log/processes Feb 22 08:58:24 router1 snmpd[359]:
SNMPD_TRAP_WARM_START: trap_generate_warm: SNMP trap: warm start
Feb 22 20:35:07 router1 snmpd[359]: SNMPD_THROTTLE_QUEUE_DRAINED: trap_throttle_timer_handler:
cleared all throttled traps
Feb 23 07:34:56 router1 snmpd[359]: SNMPD_TRAP_WARM_START: trap_generate_warm: SNMP trap: warm
start
Feb 23 07:38:19 router1 snmpd[359]: SNMPD_TRAP_COLD_START: trap_generate_cold: SNMP trap: cold
start
You can display the contents of the file /var/log/processes when the explicit-priority statement is
included at the [edit system syslog file processes] hierarchy level:
user@host> file show /var/log/processes Feb 22 08:58:24 router1 snmpd[359]:
%DAEMON-3-SNMPD_TRAP_WARM_START: trap_generate_warm: SNMP trap: warm start
Feb 22 20:35:07 router1 snmpd[359]:
%DAEMON-6-SNMPD_THROTTLE_QUEUE_DRAINED: trap_throttle_timer_handler: cleared all throttled traps
Feb 23 07:34:56 router1 snmpd[359]:
%DAEMON-3-SNMPD_TRAP_WARM_START: trap_generate_warm: SNMP trap: warm start
Feb 23 07:38:19 router1 snmpd[359]:
%DAEMON-2-SNMPD_TRAP_COLD_START: trap_generate_cold: SNMP trap: cold start
Warning Message Support for Throughput Overuse:
The SRX4100 device supports up to 20 Gbps and 7 Mpps of Internet mix (IMIX) firewall performance.
When IMIX throughput exceeds 20 Gbps and 7 Mpps on an SRX4100 device, new log messages are
logged. These log messages remind you that there is throughput overuse. You can see the following
sample log messages when you issue the show log messages command.
user@host> show log messages
Apr 25 14:01:12 user Throughput exceed 20Gbps and 7Mpps in 35% of last 15 minutes, above the
time threshold 10%!
Apr 25 14:16:12 user Throughput exceed 20Gbps and 7Mpps in 95% of last 15 minutes, above the
time threshold 10%!
1328
As a reminder of throughput overuse, every 15 minutes the system calculates how many minutes the
throughout has exceeded 20 Gbps and 7 Mpps. The system triggers a log message if the throughput has
exceeded more than 1 minute, 30 seconds (10%) of the last 15 minutes. For example, suppose you see
the following log message:
Throughput exceed 20 Gbps and 7 Mpps in 35% of last 15 minutes, above the time threshold 10%!
It means your throughput has exceeded 20 Gbps and 7 Mpps for 5 minutes, 15 seconds of the last 15
minutes (35% of 15 minutes) that triggered the log message.
To turn off this log message, we recommend that you bring down the throughput level below 20 Gbps
and 7 Mpps or install the enhanced performance upgrade license.
NOTE: This feature requires a license. Please refer to the Juniper Licensing Guide for general
information about License Management. Please refer to the product Data Sheets at SRX Series
Services Gateways for details, or contact your Juniper Account Team or Juniper Partner.
Display a Log File from a Routing Matrix
One way to display a log file stored on the local Routing Engine of any of the individual platforms in a
routing matrix (T640 routing nodes or TX Matrix platform) is to log in to a Routing Engine on the
platform, enter Junos OS CLI operational mode, and issue the show log or file show command described in
"Displaying a Log File from a Single-Chassis System" on page 1326.
To display a log file stored on a T640 routing node during a terminal session on the TX Matrix platform,
issue the show log or file show command and add a prefix that specifies the T640 routing node’s LCC
index number as lccn, followed by a colon. The index can be from 0 (zero) through 3:
user@host> show log lccn:log-filename
user@host> file show lccn:log-file-pathname
By default, the show log and file show commands display the specified log file stored on the primary
Routing Engine on the T640 routing node. To display the log from a particular Routing Engine, prefix the
file- or pathname with the string lccn-primary, lccn-re0, or lccn-re1, followed by a colon. The following
1329
examples all display the /var/log/messages file stored on the primary Routing Engine (in slot 0) on
routing node LCC2:
user@host> show log lcc2:messages
user@host> show log lcc2-master:messages
user@host> show log lcc2-re0:messages
user@host> file show lcc2:/var/log/messages
If the T640 routing nodes are forwarding messages to the TX Matrix platform (as in the default
configuration), another way to view messages generated on a T640 routing node during a terminal
session on the TX Matrix platform is simply to display a local log file. However, the messages are
intermixed with messages from other T640 routing nodes and the TX Matrix platform itself. For more
information about message forwarding, see "Impact of Different Local and Forwarded Severity Levels on
System Log Messages on a TX Matrix Router" on page 1296.
For information about the fields in a log message, see Interpreting Messages Generated in Structured-
Data Format, Interpreting Messages Generated in Standard Format by Services on a PIC, and
Interpreting Messages Generated in Standard Format by a Junos OS Process or Library. For examples,
see "Log File Sample Content" on page 1326.
Display MD5 Log Files
Junos OS and Junos OS Evolved BGP supports authentication for protocol exchanges. When you
configure TCP Message Digest 5 (MD5) authentication for BGP protocol on the neighboring routing
devices to verify the authenticity of BGP packets, the following log warning messages stored
in /var/log/messages/ are displayed:
On Junos OS,
When MD5 configured on local but not on peer device,
Apr 16 21:49:52 R1_re kernel: tcp_auth_ok: Packet from 2.2.2.2:52848 missing MD5 digest
When MD5 configured on peer but not on local device,
Apr 16 21:51:30 R1_re kernel: tcp_auth_ok: Packet from 2.2.2.2:54049 unexpectedly has MD5 digest
1330
When MD5 is configured on both the routers and there is authentication password mismatch, the
following log is displayed:
Apr 16 21:51:58 R1_re kernel: tcp_auth_ok: Packet from 2.2.2.2:54049 wrong MD5 digest
On Junos OS Evolved,
When TCP MD5 authentication is configured on local but not on peer device, the log messages are not
available.
When TCP MD5 authentication is configured on peer but not on local device, the log messages are not
available.
When MD5 is configured on both the routers and there is authentication password mismatch, the
following log is displayed:
Apr 16 21:41:22 vScapa1-RE0-re0 kernel: %KERN-6-TCP: MD5 Hash failed for (2.2.2.2, 39213)-
>(1.1.1.1, 179)
Configure System Logging for Security Devices
IN THIS SECTION
System Logging Overview for Security Devices | 1331
Binary Format for Security Logs | 1333
On-Box Logging and Reporting | 1334
Monitor Reports | 1341
Configure On-Box Binary Security Log Files | 1352
Configure Off-Box Binary Security Log Files | 1354
Configure On-Box Protobuf Security Log Files in Event Mode | 1356
Configure On-Box Protobuf Security Log Files in Stream Mode | 1357
Configure Off-box Protobuf Security Log Files | 1359
Send System Log Messages to a File | 1360
Configure the System to Send All Log Messages Through eventd | 1361
1331
System Logging Overview for Security Devices
IN THIS SECTION
Control Plane and Data Plane Logs | 1331
Redundant System Log Server | 1332
Junos OS supports configuring and monitoring of system log messages (also called syslog messages). You
can configure files to log system messages and also assign attributes, such as severity levels, to
messages. Reboot requests are recorded to the system log files, which you can view with the show log
command.
This section contains the following topics:
Control Plane and Data Plane Logs
Junos OS generates separate log messages to record events that occur on the system’s control and data
planes.
• The control plane logs, also called system logs, include events that occur on the routing platform. The
system sends control plane events to the eventd process on the Routing Engine, which then handles
the events by using Junos OS policies, by generating system log messages, or both. You can choose
to send control plane logs to a file, user terminal, routing platform console, or remote machine. To
generate control plane logs, use the syslog statement at the [system] hierarchy level.
• The data plane logs, also called security logs, primarily include security events that are handled inside
the data plane. Security logs can be in text or binary format, and they can be saved locally (event
mode) or sent to an external server (stream mode). Binary format is required for stream mode and
recommended to conserve log space in event mode.
Note the following:
• Security logs can be saved locally (on box) or externally (off box), but not both.
• SRX1400, SRX1500, SRX3400, SRX3600, SRX4100, SRX4200, SRX4600, SRX5400, SRX5600,
and SRX5800 devices default to stream mode. To specify binary format and an external server,
see "Configuring Off-Box Binary Security Log Files" on page 1354.
1332
NOTE: Logs might be dropped if you configure event mode logging on these devices.
Starting with Junos OS Release 15.1X49-D100, the default mode for SRX1500 device is stream
mode. Prior to Junos OS Release 15.1X49-D100, the default mode for SRX1500 device was event
mode.
• Apart from Junos OS Release 18.4R1, 18,4R2, 19.1 and 19.2R1, in all the other releases starting
in Junos OS Release 18.3R3, the default logging mode for SRX300, SRX320, SRX340, SRX345,
SRX550, and SRX550M devices is stream mode. Data plane events are written to system log files
in a similar manner to control plane events. To specify binary format for the security logs, see
"Configuring Off-Box Binary Security Log Files" on page 1354.
Starting in Junos OS Release 20.2R1, we support escape in stream log forwarding and on-box
reporting to avoid parsing errors. Stream mode supports escape in sd-syslog and binary formats when
logs are not sent to eventd process. For the logs send to eventd process, we recommend not to enable
an escape option as the eventd process has enabled the escape for the structure log. Event mode
supports escape only in binary format. By default the escape option is disabled. You must enable the
escape option using the set security log escape command.
Redundant System Log Server
Security system logging traffic intended for remote servers is sent through the network interface ports,
which support two simultaneous system log destinations. Each system logging destination must be
configured separately. When two system log destination addresses are configured, identical logs are sent
to both destinations. While two destinations can be configured on any device that supports the feature,
adding a second destination is primarily useful as a redundant backup for standalone and active/backup
configured chassis cluster deployments.
The following redundant server information is available:
• Facility: cron
• Description: cron scheduling process
• Severity Level (from highest to lowest severity): debug
• Description: Software debugging messages
1333
Binary Format for Security Logs
The Junos OS generates separate log messages to record events that occur on the system’s control
plane and data plane. The control plane monitors events that occur on the routing platform. Such events
are recorded in system log messages. To generate system log messages, use the syslog statement at the
[system] hierarchy level.
Data plane log messages, referred to as security log messages, record security events that the system
handles directly inside the data plane. To generate security log messages, use the log statement at the
[security] hierarchy level.
System log messages are maintained in log files in text-based formats, such as BSD Syslog, Structured
Syslog, and WebTrends Enhanced Log Format (WELF).
Security log messages can also be maintained in text-based formats. Because security logging can
produce large amounts of data, however, text-based log files can quickly consume storage and CPU
resources. Depending on your implementation of security logging, a log file in a binary-based format can
provide more efficient use of on-box or off-box storage and improved CPU utilization. Binary format for
security log messages is available on all SRX Series Firewalls.
When configured in event mode, security log messages generated in the data plane are directed to the
control plane and stored locally on the device. Security log messages stored in binary format are
maintained in a log file separate from that used to maintain system log messages. Events stored in a
binary log file are not accessible with advanced log-scripting commands intended for text-based log files.
A separate CLI operational command supports decoding, converting, and viewing binary log files that are
stored locally on the device.
When configured in stream mode, security log messages generated in the data plane are streamed to a
remote device. When these messages are stored in binary format, they are streamed directly to an
external log collection server in a Juniper-specific binary format. Externally-stored binary log files can
only be read using Juniper Secure Analytics (JSA) or Security Threat Response Manager (STRM).
Starting in Junos OS Release 17.4R2 and later, on SRX300, SRX320, SRX340, SRX345 Series devices
and vSRX Virtual Firewall instances, when the device is configured in stream mode, you can configure
maximum of eight system log hosts. In Junos OS Release 17.4R2 and earlier releases, you can configure
only three system log hosts in the stream mode. If you configure more than three system log hosts, then
the following error message is displayed error: configuration check-out failed.
For information about configuring on-box (event-mode) binary security logs, please see "Configuring On-
Box Binary Security Log Files" on page 1352. For information about configuring off-box (stream-mode)
binary security logs, please see "Configuring Off-Box Binary Security Log Files" on page 1354.
1334
On-Box Logging and Reporting
IN THIS SECTION
Overview | 1334
On-Box Reporting Features | 1338
Table Selection | 1340
Table Lifetime | 1340
Table Dense Mode | 1341
Chassis Cluster Scenario | 1341
This topic describes the on-box logging and reporting CLI functionality and the design aspects of on-box
reporting for the SRX devices.
Overview
On-box traffic logging to solid-state drives (SSDs) supports eight external log servers or files.
An all-in-one XML file is added that contains all the traffic logs information. The XML file also generates
all the logging header files and traffic log related documents.
A new process (daemon) called local log management daemon (llmd) is supported in Services Processing
Cards 0 (SPCs0) to handle on-box traffic logging. Traffic produced by flowd in SPCs is listed in traffics
logs. The llmd saves these logs to the local SSD. Traffic logs are saved in the four different formats. See
Table 144 on page 1334 to know about the log formats.
Table 144: Log formats
Log format Description Default
Syslog • Traditional log format to save logs. Yes
1335
Table 144: Log formats (Continued)
Log format Description Default
Sd-syslog • Structured system log file format. -
• Most descriptive and lengthy hence takes more space to store.
• Takes more time to transfer logs saved in this format because
of the size.
Welf • WebTrends Enhanced Log file Format is an industry standard -
log file exchange format.
• Compatible with Firewall Suite 2.0 and later, Firewall Reporting
Center 1.0 and later, and Security Reporting Center 2.0 and
later.
Binary • Juniper proprietary format. -
• Least descriptive among all the other log formats and takes the
least space compared to other log formats.
protobuf • Google's language-neutral, platform-neutral, extensible
mechanism for serializing structured data.
• A different method is used to encode the data.
• File size is small compared to syslog and sd-syslog.
On-box reporting mechanism is an enhancement to the existing logging functionality. The existing
logging functionality is modified to collect system traffic logs, analyzes the logs, and generate reports of
these logs in the form of tables using the CLI. On-box reporting feature is intended to provide a simple
and easy to use interface for viewing security logs. The on-box reports are easy to use J-Web pages of
various security events in the form of tables and graphs. The reports allow the IT security management
to identify security information at a glance, and quickly decide the actions to be taken. Thorough
analysis of logs is performed (based on session types) for features such as screen, IDP, Content Security
and IPSec.
You can define filters for the log data that is reported on based on the following criteria:
1336
NOTE: The top, in-detail, and in-interval conditions cannot be used at the same time.
• top —This option allow you to generate reports for top security events as specified in the
command. for example: top 5 IPS attacks or top 6 URLs detected through Content Security.
• in-detail —This option allow you to generate detail log content.
• in-interval —This option allows you to generate the events logged between certain time
intervals.
• summary—This option allows you to generate the summary of the events. In this way, you can fine-tune
the report to your needs, and displays only the data that you want to use.
The maximum in-interval number which shows the count in intervals is 30. If large duration is specified,
then the counters are assembled to ensure the maximum in-interval is less than 30.
Both in-detail and summary have the “all” option, since different table have different attribute (like
session table does not have the attribute “reason” but Content Security has), the “all” option does not
have any filter except start-time and stop-time. If there is any other filter other than start time and stop
time then an error is displayed.
For example: root@host> show security log report in-detail all reason reason1
error: "query condition error"
The application firewall logs for application and user visibility will list applications and nested
applications. When the logs of these features list nested applications then nested applications are listed
in J-Web. When the logs list nested applications as not-applicable or unknown then only the
applications are listed in J-Web.
Use the following CLI commands for application and user visibility for all the applications and nested
applications listing:
• For top nested-application by count—show security log report top session-close top-number  group-
by application order-by count with user
• For top nested-application by volume—show security log report top session-close top-number 
group-by application order-by volume with user
• For top user by count with nested application—show security log report top session-close top-number
 group-by user order-by count with application
1337
The on-box reporting feature is enabled by default when you load the factory-default configurations on
the SRX Series Firewall with Junos OS Release 15.1X49-D100 or later.
If you are upgrading your SRX Series Firewall from a Junos OS Release prior to Junos OS 15.1X49-
D100, then the SRX Series Firewall inherits the existing configuration and the on-box reporting feature
is disabled by default. You need to configure the set security log report command and the set security log
mode stream command to enable the on-box reporting feature on the device that are upgraded.
Starting in Junos OS Release 19.3R1 , the factory-default configuration does not include on-box
reporting configuration to increase the solid-state drive (SSD) lifetime. You can enable the on-box
reporting feature by configuring the set security log report CLI command at [edit security log] hierarchy.
See J-Web User Guide for SRX Series Devices to perform this task on J-Web user interface.
Starting in Junos OS Release 21.3R1, the on-box reporting logs are stored on the memory file system
(MFS) if there is no external SSD. The maximum number of logs that you can save on MFS is lesser than
what you can save on an external SSD. This prevents memory exhaustion and failure. Logs saved in MFS
are not retained after device reboot or power failure. See Table 145 on page 1337 to know the number
of logs recorded in on-box reporting and off-box reporting.
Table 145: Number of Logs
Reporting Session Screen IDP Content IPsec-VPN SKY
Mode Security
Off-box 1200,000 120,000 120,000 120,000 40,000 120,000
On-box 500,000 50,000 50,000 50,000 20,000 50,000
NOTE: You must configure security policy for the session using the set security policies from-zone
zone-name to-zone zone-name policy policy-name then log session-close command to list all the
applications and nested applications in Application Tracking on J-Web using the on-box reporting
feature. See for more log (Security Policies) for details.
After the log message is recorded, the log is stored within a log file which is then stored in the database
table of the RE for further analysis (on SRX300, SRX320, SRX340, SRX345, and SRX550M devices) or
on the SSD card for further analysis (on SRX1500, SRX4100, and SRX4200 devices).
NOTE: This feature supports receiving top most reports based on count or volume of the session
or the type of log, captures events occurring in each second within a specified time range,
1338
captures log content for a specified CLI condition. Various CLI conditions like “summary”, top”,
“in-detail”, and “in-interval” are used to generate reports. You can generate only one report at one
time using the CLI. All the CLI conditions cannot be used at the same time. You can generate
only one report at one time using the CLI.
The benefits of this feature are:
• Reports are stored locally on the SRX Series Firewall and there is no requirement for separate devices
or tools for logs and reports storage.
• The on-box reports are easy-to-use J-Web pages of various security events in the form of tables and
graphs.
• Provides a simple and easy-to-use interface for viewing security logs.
• The reports generated enables the IT security management team to identify security information at a
glance and quickly decide the actions to be taken.
The on-box reporting feature supports:
• Generating reports based on the requirements. For example: count or volume of the session, types of
logs for activities such as IDP, Content Security, IPsec VPN.
• Capturing real-time events within a specified time range.
• Capturing all the network activities in a logical, organized, and easy-to-understand format based on
various CLI specified conditions.
On-Box Reporting Features
The on-box reporting feature supports:
• Sqlite3 support as a library—sqlite3 was not supported prior to Junos OS release 15.1X49-D100.
Starting with Junos OS Release 15.1X49-D100, an SQL log database (SQLite Version 3) is used by
the daemons running on the RE as well as other potential modules to store logs on SRX Series
Firewalls.
In Junos OS Release 19.4R1, we've upgraded the on-box logging database to improve query
performance.
• Running llmd in both Junos OS and Linux OS—The forwarding daemon (flowd) decodes database
index from binary logs and sends both index and log to the local log management daemon (llmd).
1339
On SRX300, SRX320, SRX340, SRX345, and SRX550M devices, llmd runs in Junos OS. On SRX1500,
SRX4100, and SRX4200 devices, llmd runs in Linux. So, for supporting llmd to run in both Junos OS
and Linux OS, the llmd code directory is moved from the Linux side to the Junos OS side.
• Storing of logs into specified table of the sqlite3 database by llmd— A new syslog daemon is
introduced to collect local logs on SRX Series Firewalls and saving them into the database.
Starting in Junos OS Release 19.3R1, Junos OS stores logs in multiple tables instead of a single table
in a database file. Each table contains the timestamp of the oldest and latest logs. When you initiate
a query based on the start and end time, llmd finds latest table to generate reports.