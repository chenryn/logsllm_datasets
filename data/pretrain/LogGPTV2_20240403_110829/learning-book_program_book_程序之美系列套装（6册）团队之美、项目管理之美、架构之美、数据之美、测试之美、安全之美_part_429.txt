常规的智慧告诉我们，如果一个恶意文件无法被激活，它就无法感
染我们的系统。但是，为了实现正确的功能，完全依赖于维护一个
干净的白名单。如果用户犯了错误，允许一个恶意文件添加到白名
单中，事态就严重了，保护措施就将失败。
更加烦人的是反可执行文件无法区分真正良好的程序和被劫持而运
行了恶意内容的良好程序。如果出现了这种情况，事态就会再度恶
化，用户将会失去保护。
基于主机的入侵预防系统
这种方法的一种变型是使用基于主机的入侵预防系统（HIPS）。从
概念上说，HIPS结合了免签名反病毒程序、防火墙、行为控制和沙
盒（将在后面描述）。尽管大型机构通常在专门设备上运行功能强
大的监测软件，对它们的网络中的每台主机进行审查，但HIPS应用
程序实际上栖息在用户的计算机（主机）中。
这种程序根据它所学习或者编制的一组规则，寻找恶意行为或可疑
行为。遗憾的是，良好程序和恶意程序常常展现出相似的行为，因
此HIPS必须确定这些行为背后的实际意图。这是它的致命缺陷，因
为这种程序必须依赖用户来确定什么是好的，什么是坏的。一旦用
户作出了错误的决定，就会和反可执行文件一样，对他的保护将会
遭到破坏。另外，这些程序极端地消耗资源，会对系统的性能和用
户的体验造成不良影响。
2486
---
## Page 2488
反病毒和反间谍软件所执行的扫描是一种令人绝望和震惊的入侵式
方法，即使在它们工作良好的时候也是如此。用户经常会抱怨它们
会导致性能下降，尤其是在应用程序启动的时候。这些产品所要求
的与操作系统的集成度导致了它们自身的脆弱性，软件中的缺陷甚
至会引人新的攻击向量。
在一定程度上，安全是一种简单功能。一种策略越是复杂，它遭到
失败的可能性也就越大。我们相信终端用户并不需要多重扫描、高
级防火墙、进程监视、过滤器和阻塞器（它们是现代的反病毒系统
的常见元素）才能获得安全。
应用人工智能
在我们的Returnil公司（http://www.returnil.com），我们试图通过行
为分析、人工智能和机器学习来简化恶意软件的确认以提高效率。
Returnil与一个虚拟环境共同运行，它还拥有我们将在16.2.2节所描述
的一个创新特性。
阻止任何表现出我们之前定义为恶意行为的进程（换而言之，这是
某种形式的黑名单），并把具有不可识别行为的进程报告给中心AI
系统。因此，任何新的或者与以前存在本质不同的行为都由AI系统
进行处理。
我们的AI知识库把提交给它的进程分为三种类型：良好、恶意或不
确定。不确定的进程继续由AI系统的学习引擎进行监视，进一步进
行归类。在极少数情况下，把它提交给研究人员作出最终决定。假
阳性和假阴性结果继续导向反馈循环，以完善AI学习引擎。
16.2.2沙盒和虚拟化：新的银弹
当用户认识到反病毒软件的入侵本质后，他们会关注当前的技术，
件，我可不可以至少将它隔离，使它不伤害我的计算机？”
答案既是肯定的，又是否定的。就像沙盒这个名称所提示的那样，
它允许用户把一个未知的或潜在有害的应用程序放在一个“气泡”
中，使它不再与文件和系统中的其他敏感部分进行接触，同时由安
全程序密切监视它是否有恶意行为。我们可以把它看成是把应用程
序放在一个孤岛上，使我们可以控制对它的所有访问。
2487
---
## Page 2489
这本身是个安全的想法，但它在实际应用中却很容易遭到失败。用
户的错误和恶意软件中的特定设计元素都会引起“泄漏”，导致被隔
离的“孤岛"和计算机的“大陆”之间的有限连接。沙盒还和到目前为
正所描述的其他解决方案一样具有一个显著的后果，就是对“气泡”
内的程序的性能和操作系统的总体性能都会产生影响。但是，这种
后果并不像传统的虚拟化那样极端。
虚拟机、主机和宾客
有些人建议使用传统的、成熟的虚拟化作为安全工具。这个概念本
身很简单，但它需要大量的精力和成本才能正确地工作。最终，它
无法提供任何真正的保护。大多数人听到过或知道像VMware这样的
程序，它是对实际"主机"的计算机内部的“客端”运行一台真正计算
机的一个模拟。事实上，这些类型的程序经常被恶意软件研究人员
所使用，在各种不同的操作系统中测试恶意内容，使他们并不需要
安装和使用一台真正的计算机，后者经常需要照看，以便在每个测
试会话时对它进行重置。
但是，这并不意味着真正的计算机受到了保护或者是安全的。用户
错误地把一个受病毒感染的应用程序植入到他的真正（主机）计算
机中是相对容易发生的事情，这样病毒就可以使用共享文件夹从客
端操作系统转移到主机操作系统。如果客端操作系统允许连接，也
可能通过Internet感染。
虚拟化同样会占据大量的资源，因为我们需要对诸如可用的RAM和
硬盘空间一样对一些东西进行划分。这可能会严重影响宾客操作系
统的性能，如果我们试图在主机操作系统上以本地的方式运行其他
程序，那么将会严重主机操作系统的性能。另外，我们仍然需要使
用与真正的计算机所使用的相同安全应用程序，它们将会消耗更多
的资源。
安全特定的虚拟化
我们并没有在可视化技术的顶部拼凑一个安全环境用于其他目的，
而是在Returnil上开发了一个精简版的虚拟化解决方案，直接处理关
键的系统文件与日常用户行为的隔离。当用户的系统启动时，我们
就锁定“现实世界"的系统不被修改，创建一个虚拟系统展现给用
户。对用户而言，系统看上去和其他任何Windows系统没什么两
样。从理论上说，用户甚至不必知道系统正在沙盒中运行。让用户
2488
---
## Page 2490
到磁盘的碎片或损耗的影响较小。
在默认情况下，虚拟系统是一份新鲜的拷贝，与之前的会话没什么
改变。但是用户可以选择在虚拟系统（例如MyComputer、
Favorites、Systemlogfiles）中保存系统文件夹，这样用户可以访问
他在重启时真正想要保存的数据。而且，我们还向用户提供了一种
把文件保存到真实环境的机制。本章“桌面安全的更佳实践”一节将
描述这个过程的安全性。
如果前面所描述的AMS监测软件（在16.2.1节）检测到不良行为，它
立即自动重启虚拟系统，通常这是个非常快速的操作，不会给用户
带来很大的不便。即使恶意内容出现在用户在重启时想要保存的一
个文件夹中，导致这些内容存在危险的注册表也修改只存储在虚拟
系统的注册表中，因此会在重启时会清除。用户并不需要作出他们
所运行的程序是否安全这样不合情理的决定。
图16-1描述了我们的监测系统和虚拟化沙盒之间的交互。
2489
---
## Page 2491
图16-1Returnil用于捕捉恶意软件的过程
Returnil中被保存文件的安全性
如前所述，我们的虚拟环境允许用户把文件保存到真实环境中。当
他们执行这种操作时，我们应用了一种全面的扫描，同时使用传统
的签名数据库和行为来分析检测恶意软件。大多数反病毒和反间课
软件程序会在用户试图完成工作时对系统进行持续全面的扫描，包
括所有正在运行的进程、PC注册表和磁盘的关键区域。这些软件按
照一定的间隔花费一小时甚至更多的时间扫描所有的文件。这是一
个巨大的并且极为消耗时间的任务，涉及数十万的对象。Returnil通
过在一个动态的基础上使用相对轻量级的行为检测，绕过了所有这
些开销，只对保存到真实环境的个别文件展开全面扫描。当我们实
际只需要扫描一个对象时，为什么要对10万个对象进行扫描呢？
16.3桌面安全的更佳实践
2490
---
## Page 2492
计算机用户可以采取什么措施提高当前不满意的安全状态呢？
首先需要接受一个现实，世上并不存在银弹或全能的灵符能够使你
的计算机免受任何恶意软件感染的侵害。我们建议了两个指导原
则：
安全是为了评估和降低风险，而不是让入侵变得不可能。
越简单的方案往往是越有效的。
一个相关并且众所周知的深度防御原则建议混合使用多种解决方
案。
这并不意味着用户必须求助于“越多越好"的资源耗竭、入侵式和恼
人的HIPS产品或沙盒方法。尽管这些产品对专家在某种特定的环境
下具有很大的价值，但是对于许多复杂配置并不知情的普通用户而
信，这些方法并不适用。
真正的神奇来自于作出正确的决定并选择出场阵容，使安全链中的
每个坏节结合起来形成一个坚固的整体并具有最小的开销。换句话
说，使用一种智能的层次式方法，把注意力集中在最可能遇到的威
胁。我们相信Returmil对人工智能和虚拟化的组合使用是一个良好的
起点。另外，还应该确保具有可靠的备份和紧急恢复过程。
尽管可供选择的程序数量非常惊人，每种都有自己独特的利整。但
是，如果采取符合逻辑的思路，缩小选择范围并不是一件困难的事
情。
第一个步骤是确定自己的目标。接着，可以选择在自己的环境中能
够最好地实现目标的程序。一般情况下，需要覆盖3个主要范畴：
预防
这可以通过防火墙、在不同的分区隔离程序和数据存储、注意软件
的定期安全更新、电子邮件过滤器、Internet内容建议、家长控制、
用户账户控制（即保证用户的有限权限）、可执行文件和驱动器控
制、策略限制和安全实践（常称为安全冲浪或安全HEX）。尽管“通
过隐藏实现安全”被研究人员所轻视，但是通过不合常规的命令约定
对敏感文件和数据进行伪装也不会有什么害处。
检测、分析和消除
2491
---
## Page 2493
这仍然是坚固的、一致的反恶意软件解决方案的天下。坚持使用一
种前沿的产品，因为它们现在都可以处理病毒、末马、螨虫、恶意
程序工具包、间谍软件和其他委婉地称为“潜在的不需要或有害的应
用程序（大多是指广告）”。
治愈
虚拟化、数据备份或复制以及紧急恢复提供了从被感染状态（包括
其他常见的用户错误，例如删除了关键的文件）恢复的方法。后者
并不总是为人所知，它是由镜像解决方案所组成，每隔一定的间隔
创建硬盘驱动器的一个“图像”，之后可以恢复这个镜像，通过简单
的重写磁盘消除所有恶意软件。
16.4小结
计算机安全行业和媒体已经联合起来创建了一个环境，恐惧、误导
信息、有缺陷的比较和侵略性的广告在公众面前肆意泛滥。这个行
业宣称提供了我们所需要的保护，但它们的许诺并没有成为现实。
只要访问任何安全或隐私论坛，总会看到大多数“讨论"涉及帮助成
员们确定和消除恶意或广告内容，然后就觉得这样就使他们受到了
保护。事实上，过了一段时间以后，这样的话题成为这些社区最主
要的任务。这个行业并没有解决恶意软件问题，而是助长了这种风
气，直到它排挤了以前与基本隐私和安全问题有关的建设性话题。
简而言之，要按照与处理个人安全相同的方式处理PC安全。注意你
的环境，确保自己所使用的工具是否正常，注意你所经过的地方，
并对紧急情况有所准备。对自已所使用的工具进行简化，对安全策
略进行配置，为问题的每一片段都提供最高层次的保护，在尽量不
与其他片段重叠的情况下实现对核心竞争力的保护。
例如，如果你正在度假，那么你不会在订好一家旅馆的同时带上帐
蓬，以防旅馆的屋顶漏雨。如果真的出现了这种情况，那么你会换
个房间或者干脆换家旅馆。类似，如果你在后台已经运行了一个反