CIC chooses an optimum set of interference cancelling sub-symbols
that provides both time and frequency resolution.
3 LORA DECODING BACKGROUND
In this section we provide the necessary background on LoRa PHY
layer required in the rest of the paper.
Chirp Modulation in LoRa. In LoRa, every data symbol ğ¶ğœ™ is
derived by shifting the fundamental symbol ğ¶0 by a frequency ğ‘“ğœ™.
ğ¶0 is a chirp with its instantaneous frequency increasing linearly
with time ğ‘¡ from âˆ’ ğµ
2 over a symbol duration ğ‘‡ğ‘ , where ğµ is
2 to ğµ
505
the bandwidth of transmission.
, 0 â‰¤ ğ‘¡ â‰¤ ğ‘‡ğ‘ 
(1)
(2)
(cid:40) ğ‘—2ğœ‹(cid:16)
ğ¶ğœ™(ğ‘¡) = ğ¶0(ğ‘¡) Â· ğ‘’ ğ‘—2ğœ‹ ğ‘“ğœ™ ğ‘¡;
2ğ‘†ğ¹ ğ‘¡2âˆ’ ğµ
ğ¶0(ğ‘¡) =
0, otherwise
0.5 ğµ2
2 ğ‘¡(cid:17)
In Eqn 1, ğœ™ âˆˆ {0, 1, Â· Â· Â· , 2ğ‘†ğ¹ âˆ’ 1} and ğ‘‡ğ‘  = 2ğ‘†ğ¹
ğµ . The spreading
factor, ğ‘†ğ¹ âˆˆ {7, 8, 9, 10, 11, 12}, fixed for each LoRa packet, dictates
the transmission data rate. Using a larger ğ‘†ğ¹ extends transmission
range at the cost of using a lower data rate.
Fig 4: Demodulation in LoRa
Demodulation Using De-chirping in Standard LoRa. To de-
modulate a symbol, the LoRa demodulator must estimate ğ‘“ğœ™. A
LoRa receiver first de-chirps a symbol by multiplying it with down-
chirp ğ¶âˆ—
0(ğ‘¡), the complex conjugate of ğ¶0, over a window aligned
with the symbolâ€™s boundaries (Eqn 3). De-chirping converts the
symbol into a sinusoid of constant frequency ğ‘“ğœ™. ğ‘“ğœ™ is recovered by
locating the peak in an FFT of the de-chirped symbol (Figure 1).
ğ¶ğœ™(ğ‘¡)ğ¶âˆ—
Î¦(ğ¶ğœ™(ğ‘¡)) = ğ¹ ğ¹ğ‘‡ (ğ¶ğœ™(ğ‘¡)ğ¶âˆ—
0(ğ‘¡) = ğ‘’ ğ‘—2ğœ‹ ğ‘“ğœ™ ğ‘¡
0(ğ‘¡)) = ğ‘ ğ‘–ğ‘›ğ‘(ğ‘‡ğ‘ (ğ‘“ âˆ’ ğ‘“ğœ™))
(3)
(4)
In Eqn 4, Î¦(ğ¶ğœ™(ğ‘¡)) represents de-chirping and a 2ğ‘†ğ¹ point FFT over
a symbol ğ¶ğœ™(ğ‘¡).
Carrier Frequency Offset (CFO). Carrier Frequency Offset (CFO),
ğ›¿ ğ‘“ , is the small difference in generated carrier frequencies between
the transmitter and the receiver due to manufacturing imperfec-
tions. CFO manifests itself as a constant shift in the estimated
symbol frequency so that the peak of a symbol ğ¶ğœ™ would be located
as ğ‘“ğœ™ + ğ›¿ ğ‘“ . Consequently, receivers must estimate and subtract ğ›¿ ğ‘“
Packet Detection using the LoRa Preamble. Before the receiver
can begin demodulating, it must first reliably detect the onset of a
new transmission, determine the exact positions of the boundaries
of the symbols within the packet in order to perform de-chirping
and FFT and, estimate ğ‘“ğœ™. A preamble preceding the data symbols,
facilitates all these functions(Fig. 5). The LoRa preamble comprises
a sequence of 8 consecutive ğ¶0 symbols, followed by two SYNC
symbols ğ¶ğ‘¥, ğ¶ğ‘¦ (ğ‘¥ â‰  0, ğ‘¦ = ğ‘¥ + 8) and 2.25 down-chirps ğ¶âˆ—
0. To
detect a new transmission, the receiver continuously de-chirps and
performs an FFT until it finds 8 consecutive peaks with the same
frequency. The SYNC words and down-chirps then help locate the
packetâ€™s symbol boundary positions, ğ›¿ ğ‘“ estimation and to confirm
onset of a new packet.
4 LORA DECODING UNDER COLLISIONS
In this section we extend the discussion in Section 3 to a multi-
packet collision scenario.
LoRa Demodulation during a collision. During a packet colli-
sion (Fig. 8), the received signal is a superposition of multiple LoRa
receptions, each starting at a different time, with a different symbol
SIGCOMM â€™21, August 23â€“28, 2021, Virtual Event, USA
M. Osama, M. Phillipose, K. Chintalapudi, S. Banerjee, B. Krishnaswamy
Fig 5: A LoRa Packet
Fig 6: Collision
Fig 7: CIC - Sub-Symbol Sections
ğ‘ğ‘Ÿğ‘’ğ‘£ and ğ‘“ ğ‘–
ğ‘ğ‘Ÿğ‘’ğ‘£ and ğ¶ğ‘–
boundary and at a different received power level. Fig. 6 illustrates
the demodulation of a LoRa symbol ğ¶1 from transmitter 1 during an
ğ‘ packet collision. Since symbol boundaries of colliding transmis-
sions are not aligned, ğ¶1 overlaps partially with two consecutive
symbols from each interfering transmissions â€“ ğ¶ğ‘–
ğ‘›ğ‘’ğ‘¥ğ‘¡
from transmitters 2 â‰¤ ğ‘– â‰¤ ğ‘ corresponding to de-chirped frequen-
cies ğ‘“ ğ‘–
ğ‘›ğ‘’ğ‘¥ğ‘¡ respectively. ğœğ‘– depicts the time difference of
symbol boundaries between 1ğ‘ ğ‘¡ and ğ‘–ğ‘¡â„ transmission. We assume
that the receiver has accurately determined the symbol boundaries
as well as the CFO for transmitter 1 using preamble detection (as
described in Section 5.8) ğ›¿ğ‘– represents the difference of the ğ‘–ğ‘¡â„ trans-
mitterâ€™s CFO from that of transmitter 1. The received signal symbol
ğ‘Ÿ(ğ‘¡) (with ğ‘¡ = 0 at the start of ğ¶1), during the collision is given by,
(5)
ğ‘Ÿ(ğ‘¡) = ğ´1ğ¶1
ğ¼(ğ‘¡) =
ğœ™(ğœ)(ğ‘¡) + ğ¼(ğ‘¡)
ğ´ğ‘–ğ‘’ ğ‘—2ğœ‹ğ›¿ğ‘–ğ‘¡
(cid:34) ğ¶ğ‘–
(cid:35)
ğ‘ğ‘Ÿğ‘’ğ‘£(ğ‘¡ + ğ‘‡ğ‘  âˆ’ ğœğ‘–)ğ‘Š ( ğ‘¡
ğœğ‘–
ğ‘›ğ‘’ğ‘¥ğ‘¡ (ğ‘¡ âˆ’ ğœğ‘–)ğ‘Š ( ğ‘¡âˆ’ğœğ‘–
+ğ¶ğ‘–
ğ‘‡ğ‘ âˆ’ğœğ‘–
0 â‰¤ ğ‘¡ â‰¤ 1
ğ‘œğ‘¡â„ğ‘’ğ‘Ÿğ‘¤ğ‘–ğ‘ ğ‘’
)
)
ğ‘Š (ğ‘¡) =
ğ‘– ğ‘“
ğ‘–=ğ‘
(cid:26) 1
ğ‘–=2
0
ğ‘›ğ‘’ğ‘¥ğ‘¡
ğ‘ğ‘Ÿğ‘’ğ‘£ and ğ¶1
) represent the partial overlap regions of ğ¶1
In Eqn 5, ğ¼(ğ‘¡) is the interference. The window functions ğ‘Š ( ğ‘¡
ğœğ‘–
ğ‘Š ( ğ‘¡âˆ’ğœğ‘–
ğ‘‡ğ‘ âˆ’ğœğ‘–
with ğ¶1 and have widths ğ‘‡ğ‘  âˆ’ ğœğ‘– and ğœğ‘– (Figure 6) respectively. ğ´ğ‘– is
received signal amplitude from ğ‘–ğ‘¡â„ transmitter. Demodulating ğ‘Ÿ(ğ‘¡)
by de-chirping and FFT, results in 2(ğ‘ âˆ’ 1) peaks corresponding to
the 2(ğ‘ âˆ’ 1) partially overlapping interfering symbols, ğ¶ğ‘–
ğ‘ğ‘Ÿğ‘’ğ‘£ and
ğ‘›ğ‘’ğ‘¥ğ‘¡ and one peak corresponding to symbol ğ¶1.
ğ¶ğ‘–
Î¦(ğ‘Ÿ(ğ‘¡)) = ğ´1ğ‘ ğ‘–ğ‘›ğ‘(cid:16)ğ‘‡ğ‘ (ğ‘“ âˆ’ ğ‘“ 1)(cid:17) + ğ¼(ğ‘“ )
ğ‘ ğ‘–ğ‘›ğ‘(cid:16)ğœğ‘–(ğ‘“ âˆ’ ğ‘“ ğ‘–
ğ‘ğ‘Ÿğ‘’ğ‘£ âˆ’ Î”ğ‘“ğ‘– âˆ’ ğ›¿ğ‘–)(cid:17)
ğ‘ ğ‘–ğ‘›ğ‘(cid:0)(ğ‘‡ğ‘  âˆ’ ğœğ‘–)(ğ‘“ âˆ’ ğ‘“ ğ‘–
(cid:19)
ğ‘–=ğ‘
(cid:18) ğµ
ğ‘›ğ‘’ğ‘¥ğ‘¡ âˆ’ Î”ğ‘“ğ‘– âˆ’ ğ›¿ğ‘–)(cid:1)(9)
ğ´ğ‘–
ğœğ‘–
+ ğ´ğ‘–
ğ‘‡ğ‘ âˆ’ğœğ‘–
ğ¼(ğ‘“ ) =
(8)
ğ‘–=2
(10)
Î”ğ‘“ğ‘–
= ğœğ‘–
2ğ‘†ğ¹
In Eqn 8 ğ¼(ğ‘“ ) is the interference, ğ‘“ 1,ğ‘“ ğ‘–
ğ‘›ğ‘’ğ‘¥ğ‘¡, and ğ‘“ ğ‘–
ğ‘ğ‘Ÿğ‘’ğ‘£ are the chirp
start frequencies for ğ¶1,ğ¶ğ‘–
ğ‘ğ‘Ÿğ‘’ğ‘£ and, ğ¶ğ‘–
ğ‘›ğ‘’ğ‘¥ğ‘¡. Eqn 8, shows that the
height of the interfering peaks are ğ´ğ‘–
ğœğ‘– depending on the
received power as well as the time difference in symbol boundaries
ğœğ‘–. Fig. 12 depicts LoRa demodulation of 6 colliding transmissions
(at SF=8) using COTS LoRa devices. Red circles indicate interfering
transmissions while the green circle indicates the true peak. In
Fig. 12, there are 3 peaks higher than the true peak corresponding
ğ‘‡ğ‘ âˆ’ğœğ‘– and ğ´ğ‘–
(6)
(7)
) and
Fig 8: Collisions : Illustration
to the symbol being decoded. This occurs because, the received
powers of the interfering transmissions can be stronger than the
one being decoded.
5 CIC
As described in Section 4, in the event of an ğ‘ packet collision,
the received signal of the symbol being decoded, ğ‘Ÿ(ğ‘¡) (Eqn 5), com-
prises a superposition of 2(ğ‘ âˆ’ 1) interfering symbols in addition
to the symbol of interest (ğ¶1). Consequently, the de-chirped signal
comprises 2ğ‘ âˆ’ 1 frequencies instead of one. CIC exploits tem-
poral variations in spectral content of the symbol as interfering
transmissions transition through their respective symbols. The key
observation that drives the design of CIC is that none of the interfering
symbols span the entire symbol duration while ğ¶1 does.
CIC selects a specific set of sub-symbols (parts of the symbol
being decoded) such that none of the interfering symbols is common
across all these sub-symbols. Such a set of sub-symbols is deemed
the Interference Cancelling Sub-Symbol Set (ICSS). This means
that the only common frequency across all sub-symbols in an ICSS
will be ğ¶1, as it is present in all sub-symbols of ğ‘Ÿ(ğ‘¡). By estimating
spectra for all sub-symbols in the ICSS and extracting the common
frequency, CIC removes all interfering symbols while retaining the
frequency ğ‘“ 1 corresponding to ğ¶1.
Sub-Symbols. A sub-symbol ğ‘Ÿğ‘–â†’ğ‘— (ğ‘¡) is a part of the received sym-
bol ğ‘Ÿ(ğ‘¡) that start at ğ‘¡ = ğœğ‘– and ends at ğ‘¡ = ğœ ğ‘—. Recall that ğ‘¡ = ğœğ‘– is
the symbol boundary of the ğ‘–ğ‘¡â„ transmission when it transitions
from ğ¶ğ‘–
ğ‘ğ‘Ÿğ‘’ğ‘£ to ğ¶ğ‘–
(cid:26) ğ‘Ÿ(ğ‘¡)
ğ‘›ğ‘’ğ‘¥ğ‘¡ (Section 4,Figure 6).
ğœğ‘– < ğ‘¡ < ğœ ğ‘—
ğ‘œğ‘¡â„ğ‘’ğ‘Ÿğ‘¤ğ‘–ğ‘ ğ‘’
ğ‘– ğ‘“
(cid:12)(cid:12)(cid:12)(cid:12) ğœ1 = 0, ğœğ‘+1 = ğ‘‡ğ‘ 
ğ‘Ÿğ‘–â†’ğ‘— (ğ‘¡) =
0
(11)
As an example, Figure 7 depicts the set of sub-symbols ğ‘Ÿğ‘–â†’ğ‘–+1(ğ‘¡).
The key property common to these sub-symbols is that each of
the sub-symbols comprises exactly ğ‘ âˆ’ 1 interfering symbols â€“
506
CIC : Decoding Multi-Packet Collisions in LoRa
SIGCOMM â€™21, August 23â€“28, 2021, Virtual Event, USA
Fig 9: Strawman CIC
Fig 10: Effect of poor resolution on
Strawman-CIC
Fig 11: Illustration of
Property P2
ğ‘›ğ‘’ğ‘¥ğ‘¡ , Â· Â· Â· , ğ¶ğ‘–
ğ‘›ğ‘’ğ‘¥ğ‘¡} âˆª {ğ¶ğ‘–+1
ğ‘ğ‘Ÿğ‘’ğ‘£, Â· Â· Â· , ğ¶ğ‘
ğ‘ğ‘Ÿğ‘’ğ‘£ to ğ¶ğ‘˜
ğ‘ğ‘Ÿğ‘’ğ‘£, Â· Â· Â· , ğ‘“ ğ‘
ğ‘ğ‘Ÿğ‘’ğ‘£ are absent and all ğ‘“ ğ‘˜
ğ‘ğ‘Ÿğ‘’ğ‘£}. This is because, trans-
ğ‘ğ‘Ÿğ‘’ğ‘£, Â· Â· Â· , ğ‘“ ğ‘
ğ‘›ğ‘’ğ‘¥ğ‘¡ , Â· Â· Â· ,fğ‘
{ğ¶2
missions 2 â‰¤ ğ‘˜ â‰¤ ğ‘–, have already transitioned from ğ¶ğ‘˜
ğ‘›ğ‘’ğ‘¥ğ‘¡
prior to ğ‘¡ = ğœğ‘– and thus all of ğ‘“ ğ‘˜
ğ‘›ğ‘’ğ‘¥ğ‘¡ are
present. On the other hand, transmissions ğ‘– < ğ‘˜ â‰¤ ğ‘ have not yet
transitioned to transmitting the symbol ğ¶ğ‘˜
ğ‘›ğ‘’ğ‘¥ğ‘¡, thus for all these
ğ‘›ğ‘’ğ‘¥ğ‘¡ are absent and ğ‘“ ğ‘˜
transmissions, all ğ‘“ ğ‘˜
ğ‘ğ‘Ÿğ‘’ğ‘£ are present. Thus,
the spectrum of their de-chirped versions Î¦(ğ‘Ÿğ‘–â†’ğ‘–+1(ğ‘¡)) (Eqn 4),
comprises a set of exactly the ğ‘ frequencies ğ¹(ğ‘Ÿğ‘–â†’ğ‘–+1) = {ğ‘“ 1} âˆª
ğ‘›ğ‘’ğ‘¥ğ‘¡} âˆª {ğ‘“ ğ‘–+1
{ğ‘“ 2
ğ‘›ğ‘’ğ‘¥ğ‘¡ , Â· Â· Â· , ğ‘“ ğ‘–
ğ‘ğ‘Ÿğ‘’ğ‘£} (Figure 7). ğ‘“ 1, the frequency
of the symbol to be decoded will be present in all sub-symbols since it
is present throughout ğ‘Ÿ(ğ‘¡).
Interference Cancelling Sub-Symbol Set (ICSS). Consider the
set of sub-symbols {ğ‘Ÿ1â†’2(ğ‘¡), ğ‘Ÿğ‘â†’ğ‘+1(ğ‘¡)}. ğ¹ (ğ‘Ÿ1â†’2(ğ‘¡)) comprises
of the frequencies {ğ‘“ 1} âˆª {ğ‘“ 1
ğ‘ğ‘Ÿğ‘’ğ‘£} as none of the symbols
have transitioned to their next symbol. ğ¹ (ğ‘Ÿğ‘â†’ğ‘+1(ğ‘¡)) comprises of
the frequencies {ğ‘“ 1} âˆª {ğ‘“ 1
ğ‘›ğ‘’ğ‘¥ğ‘¡} as all of the symbols have
transitioned to their next symbol. Thus, no interfering symbol fre-
quencies are common across this set of frequencies. Consequently,
{ğ‘Ÿ1â†’2(ğ‘¡), ğ‘Ÿğ‘â†’ğ‘+1(ğ‘¡)} is an example of ICSS.
A Strawman-CIC. To provide an intuition into how CIC works, we
consider a Strawman-CIC that uses the ICSS {ğ‘Ÿ1â†’2(ğ‘¡), ğ‘Ÿğ‘â†’ğ‘+1(ğ‘¡)}.
The only constituent frequency common to these two sections
is ğ‘“ 1. Thus, ğ‘“ 1 can be extracted by estimating all the frequen-
cies in ğ¹(ğ‘Ÿ1â†’2(ğ‘¡)) and ğ¹(ğ‘Ÿğ‘â†’ğ‘+1(ğ‘¡)) and finding ğ¹(ğ‘Ÿ1â†’2(ğ‘¡)) âˆ©
ğ¹(ğ‘Ÿğ‘â†’ğ‘+1(ğ‘¡)) ( Figure 9). As we discuss later in this section, Strawman-