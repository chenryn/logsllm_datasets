Hacker'Machine,Interface,
State,of,the,Union,for,SCADA,HMI,Vulnerabili:es,
Copyright,2016,Trend,Micro,Inc.,
2,
Introduc:on,
Copyright,2016,Trend,Micro,Inc.,
3,
Trend,Micro,Zero,Day,Ini:a:ve,
•  Fritz,Sands,',@FritzSands,
–  Security)Researcher)–)Zero)Day)Ini4a4ve)
–  Root)cause)analysis)and)vulnerability)discovery)
–  Focused)on)SCADA)HMI)vulnerability)analysis)
•  Brian,Gorenc,',@maliciousinput,
–  Senior)Manager)?)Zero)Day)Ini4a4ve)
–  Root)cause)analysis)and)vulnerability)discovery)
–  Organizer)of)Pwn2Own)hacking)compe44ons)
Copyright,2016,Trend,Micro,Inc.,
4,
SCADA,Industry,
Copyright,2016,Trend,Micro,Inc.,
5,
Marketplace,Overview,,
•  Focused,on,ICS,equipment,sales,over,soTware,sales,
•  Ac:ve,merger,and,acquisi:on,ac:vity,,
•  Highly,regionalized,,
Copyright,2016,Trend,Micro,Inc.,
6,
What,is,the,Human,Machine,Interface?,
•  Main,hub,for,managing,and,opera:ng,control,systems,
•  Collects,data,from,the,control,systems,
•  Presents,visualiza:on,of,the,system,architecture,
•  Alarms,operator/sends,no:ﬁca:ons,
•  Should,be,operated,on,isolated,and,trusted,networks,
Copyright,2016,Trend,Micro,Inc.,
7,
Why,target,the,Human,Machine,Interface?,
•  Control,the,targeted,cri:cal,infrastructure,
•  Harvest,informa:on,about,architecture,
•  Disable,alarming,and,no:ﬁca:on,systems,
•  Physically,damage,SCADA,equipment,
Copyright,2016,Trend,Micro,Inc.,
8,
Malware,Targe:ng,HMI,Solu:ons,
•  Stuxnet,
–  First,malware,created,to,target,ICS,environments,
–  Abused,HMI,vulnerabili:es,
•  Siemems,SIMATIC,STEP,7,DLL,Hijacking,Vulnerability,(ICSA'12'205'02),
•  Siemens,WinCC,Insecure,SQL,Server,Authen:ca:on,(ICSA'12'205'01),
•  ,BlackEnergy,
–  Ongoing,sophis:cated,malware,campaign,compromising,ICS,environments,
–  Abused,HMI,vulnerabili:es,
•  GE,CIMIPCITY,Path,Traversal,Vulnerabili:es,(ICSA'14'023'01),
•  Siemens,WinCC,Remote,Code,Execu:on,Vulnerabili:es,(ICSA'14'329'02D),
•  Advantech,WebAccess,(ICS'ALERT'14'281'01B),
Copyright,2016,Trend,Micro,Inc.,
9,
ICS'CERT,
•  Organiza:on,within,Department,of,Homeland,Security,
•  Focuses,on:,
–  Responding,to,and,analyzing,control,systems'related,incidents,
–  Conduc:ng,vulnerability,and,malware,analysis,
–  Providing,onsite,incident,response,services,
–  Coordina:ng,the,responsible,disclosure,of,vulnerabili:es,and,
associated,mi:ga:ons,
•  For,2015,,ICS'CERT,responded,to,295,incidents,and,handled,
486,vulnerability,disclosures,
Copyright,2016,Trend,Micro,Inc.,
10,
Cri:cal,Infrastructure,Ahacks,
Copyright,2016,Trend,Micro,Inc.,
11,
Targe:ng,Water,U:li:es,
•  Compromised,internet'facing,AS/400,system,responsible,for:,
–  Network,rou:ng,
–  Manipula:on,of,Programmable,Logic,Controllers,(PLC),
–  Management,of,customer,PII,and,billing,informa:on,
•  Altered,sejngs,related,to,water,ﬂow,and,amount,of,
chemicals,that,went,into,the,water,supply,
•  Four,separate,connec:ons,to,the,AS/400,over,a,60'day,
period,
•  Actors,IP,:ed,to,previous,hack:vist,ac:vi:es,
Copyright,2016,Trend,Micro,Inc.,
12,
Targe:ng,Power,Plants,
•  On,December,24,,2015,,Ukrainian,companies,experienced,
unscheduled,power,outages,impac:ng,225,000+,customers.,
–  Caused,by,external,malicious,actors,
–  Mul:ple,coordinated,ahacks,within,30,minutes,of,each,other,
•  Used,remote,administra:on,tools,and/or,remote,industrial,
control,system,(ICS),client,soTware,to,control,breakers.,
•  Used,KillDisk,to,overwrite,Windows'based,human'machine,
interface,system.,
–  Disrupt,restora:on,eﬀorts,
Copyright,2016,Trend,Micro,Inc.,
13,
Targe:ng,Railway,and,Mining,Industry,
•  Malware,similar,to,the,power,incident,found,in,the,ahacks,
against,a,Ukrainian,rail,and,a,Ukrainian,mining,company,
–  November,–,December,2015,
•  Overlap,between,the,samples,found,in,the,Ukrainian,power,
incident,and,those,apparently,used,against,the,Ukrainian,
mining,company,
–  Malware,leveraged,(BlackEnergy/KillDisk),
–  Infrastructure,
–  Naming,Conven:ons,
Copyright,2016,Trend,Micro,Inc.,
14,
Prevalent,Vulnerability,Types,
Copyright,2016,Trend,Micro,Inc.,
15,
Current,State,of,HMI,Solu:ons,
•  Not,built,with,security,in,mind,,
•  Seen,no,beneﬁt,of,the,evolu:on,of,the,secure,SDL,
•  Mi:ga:ons,against,advanced,ahacks,are,disabled,
•  Poor,design/developer,assump:ons,
•  Lack,of,understanding,of,real,opera:ng,environment,
–  Not,on,isolated,or,trusted,networks,
–  Con:nually,being,interconnected,
Copyright,2016,Trend,Micro,Inc.,
16,
Common,Problems,with,HMI,
Memory,Corrup:on,
Creden:al,Management,
Insecure,Default,
Authen:ca:on/Authoriza:on,
Injec:on,
Other,
Source:,2015'2016,ICS'CERT,Advisories,,
Copyright,2016,Trend,Micro,Inc.,
17,
Memory,Corrup:on,
•  20%,of,iden:ﬁed,vulnerabili:es,
•  Common,vulnerability,types,
–  Stack'based,Buﬀer,Overﬂow,
–  Heap'based,Buﬀer,Overﬂow,
–  Out'of'bounds,Read/Write,
•  Zero,Day,Ini:a:ve,case,study,
–  Advantech,WebAccess,webvrpcs,Service,
BwOpcSvc.dll,WindowName,,
sprinq,Stack'Based,Buﬀer,Overﬂow,
Remote,Code,Execu:on,Vulnerability,
Copyright,2016,Trend,Micro,Inc.,
18,
,
Advantech,WebAccess,Case,Study,
•  ICS'CERT,states:,
–  “There,are,many,instances,where,the,buﬀer,on,the,stack,can,be,
overwrihen”,
•  Iden:ﬁers,
–  CVE'2016'0856,
–  ZDI'16'048,
–  ICSA'16'014'01,
•  CVSS,
–  9.3,
•  Disclosure,Timeline,,
–  2015–09–17,',Reported,to,vendor,,
2016–02–05,–,Coordinated,release,
•  Credit,
–  Discovered,by:,Anonymous,
–  Disclosed,by:,Zero,Day,Ini:a:ve,
Copyright,2016,Trend,Micro,Inc.,
19,
,
Advantech,WebAccess,HMI,Solu:on,
Copyright,2016,Trend,Micro,Inc.,
20,
Remotely,Accessible,Services,,
•  Launches,a,service,,webvrpcs.exe,,in,the,context,of,a,local,
administra:ve,users,
•  Services,listens,on,TCP,port,4592,,by,default,,and,may,be,
accessed,over,an,RPC'based,protocol,
•  Applica:on,interface,is,structured,to,resemble,the,Windows,
Device,IoControl,func:on,
–  Each,func:on,contains,a,ﬁeld,similar,to,an,IOCTL,
Copyright,2016,Trend,Micro,Inc.,
21,
Prototype,of,RPC,func:on,
Copyright,2016,Trend,Micro,Inc.,
22,
IOCTL,0x0001388B,
•  Inside,BwOpcSvc.dll,(which,is,loaded,into,webvrpc.exe),,
rou:ne,with,an,exported,entry,name,of,BwSvcFunc:on,
which,processes,a,number,of,entry,points,,using,a,jump,
table.,
•  Flaw,exists,within,the,implementa:on,of,IOCTL,0x0001388B,,
•  Stack'based,buﬀer,overﬂow,exists,in,a,call,to,sprinq,using,
WindowsName,parameter,
Copyright,2016,Trend,Micro,Inc.,
23,
Vulnerable,Code,
Copyright,2016,Trend,Micro,Inc.,
24,
Stack,Layout,
Copyright,2016,Trend,Micro,Inc.,
25,
Applica:on,Crash,
Copyright,2016,Trend,Micro,Inc.,
26,
Exploita:on,Demo,
Copyright,2016,Trend,Micro,Inc.,
27,
Patch,Analysis,
•  _sprinq,is,in,the,list,of,MicrosoT,banned,APIs,list,
–  First,published,in,2007,
–  hhps://msdn.microsoT.com/en'us/library/bb288454.aspx,,,,
•  Advantech,should,implement,MicrosoT,banned,APIs,and,
remove,all,of,them,from,shipping,code,
•  What,did,they,do…,
Copyright,2016,Trend,Micro,Inc.,
28,
Patch,Analysis,
•  WindowName,ﬁeld,in,the,stack,buﬀer,is,0x80,bytes,
•  _snprinq,Length,parameter,is,0x7f,bytes,
Copyright,2016,Trend,Micro,Inc.,
29,
Variant,Analysis,
1. 
ZDI'16'049,',Advantech,WebAccess,webvrpcs,Service,BwOpcSvc.dll,WindowName,sprinq,Stack'Based,Buﬀer,Overﬂow,Remote,Code,Execu:on,Vulnerability,
2. 
ZDI'16'050,',Advantech,WebAccess,webvrpcs,Service,BwOpcSvc.dll,WindowName,sprinq,Stack'Based,Buﬀer,Overﬂow,Remote,Code,Execu:on,Vulnerability,