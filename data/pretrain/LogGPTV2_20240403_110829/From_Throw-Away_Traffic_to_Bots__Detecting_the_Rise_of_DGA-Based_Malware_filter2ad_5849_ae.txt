78.23
100
21.02
15.59
93.18
99.9
91.77
100
96.58
27.67
99.9
5
99.9
95.23
100
100
35.05
99.91
10
99.9
98.67
100
100
48.43
99.94
string wpdhsmp. Our best guess is that these are inter-
nal domain names that were accidentally leaked to the re-
cursive DNS server of our ISP. Domain names from this
cluster appeared only for one day. This class of NXDo-
mains was also modeled as a benign variant. It is worth
noting that all falsely reported DGA clusters, excluding
the Chrome cluster, were short lived.
If operators are
willing to wait a few days until a new DGA cluster is
reported by Pleiades, these false alarms would not have
been raised.
7.3 C&C Detection
i
i
i = NXi − NXtrain
To evaluate the effectiveness of the C&C Detection,
we proceeded as follows. We considered the six new
DGAs which we were able to attribute to speciﬁc mal-
ware, as shown in Table 3. Let NXi be the set of NXDo-
mains collected by the DGA Discovery (Section 4) and
DGA Modeling (Section 5.1) modules for the i-th DGA.
For each DGA, we set aside a subset NXtrain
⊂ NXi of
NXDomains to train an HMMi model. Then we use the
remaining NXtest
to compute the true
positive (TP) rate of HMMi, and a set A that consists
of 602,969 unique domain names related to the consis-
tently popular domain names according to alexa.com
to compute the false positive (FP) rate. To obtain A
we ﬁrst consider all domain names that have been con-
sistently ranked in the top 100,000 popular domains by
alexa.com for approximately one year. This gave us a
set T of about 60,000 “stable” popular domain names,
which we consider as legitimate domains. Then, we
monitored the stream of successful DNS queries in a
large live network for a few hours, and we added to A
all the domain names whose effective 2LD is in T .
i
We performed experiments with a varying number
c = |NXtrain
| of training samples. Speciﬁcally, we set c
equal to 100, 200, 500, 1,000, 2,000, 5,000, and 10,000.
We then computed the trade-off between TPs and FPs for
different detection thresholds. In the interest of space, we
report only the results for c=1,000 in Table 3. In general,
the results improve for increasing numbers of training in-
stances. We set the detection threshold so as to obtain an
FP rate equal to 0.1%, 0.5%, 1%, 3%, 5%, and 10%. As
we can see, at FP=1% we obtained a high (> 93%) TP
rate for three out of six DGAs, and relatively good results
(> 78%) in ﬁve out of six cases. At FP=3% we have high
TP rate (> 91%) in ﬁve out of six cases.
As mentioned in Section 3, the C&C Detection mod-
ule reduces the set of domain names successfully re-
solved by a host h that have been labeled as compro-
mised with DGA-malware to a smaller set of good can-
didate C&C domains generated by the DGA. The results
in Table 3 show that if we rank the domains resolved by
h according to the likelihood assigned by the HMM, in
most cases we will only need to inspect between 1/100
to 3/100 of the active domains queried by h to discover
the C&C.
7.4 Case Studies
7.4.1 Zeus.v3
In September 2011, Pleiades detected a new DGA
that we linked to the Zeus.v3 variant a few weeks later.
The domain names collected from the machines compro-
mised by this DGA-malware are hosted in six different
TLDs: .biz,.com,.info ,.net ,.org and .ru. Ex-
cluding the top level domains, the length of the domain
names generated by this DGA are between 33 and 45
alphanumeric characters. By analyzing one sample of
the malware4 we observed that its primary C&C infras-
tructure is P2P-based. If the malware fails to reach its
P2P C&C network, it follows a contingency plan, where
a DGA-based component is used to try to recover from
the loss of C&C communication. The malware will then
resolve pseudo-random domain names, until an active
C&C domain name is found.
To date, we have discovered 12 such C&C domains.
Over time, these 12 domains resolved to ﬁve different
C&C IPs hosted in four different networks, three in the
US (AS6245, AS16626 and AS3595) and one in the
United Kingdom (AS24931). Interestingly, we observed
that the UK-based C&C IP address remained active for a
very short period of time of only a few minutes, from Jan
25, 2012 12:14:04 EST to Jan 25, 2012 12:22:37
EST. The C&C moved from a US IP (AS16626) to the
UK (AS24931), and then almost immediately back to the
US (AS3595).
7.4.2 BankPatch
We picked the BankPatch DGA cluster as a sample
case for analysis since this botnet had been active for
several months during our experiments and the infected
population continues to be signiﬁcant. The C&C infras-
tructure that supports this botnet is impressive. Twenty
six different clusters of servers acted as the C&Cs for
this botnet. The botnet operators not only made use of
a DGA but also moved the active C&Cs to different net-
works every few weeks (on average). During our C&C
4Sample MD5s:
8f60afa9ea1e761edd49dfe012c22cbf
and
ccec69613c71d66f98abe9cc7e2e20ef.
discovery process, we observed IP addresses controlled
by a European CERT. This CERT has been taking over
domain names from this botnet for several months. We
managed to cross-validate with them the completeness
and correctness of the C&C infrastructure. Complete in-
formation about the C&C infrastructure can be found in
Table 4.
The actual structure of
the domain name used
by this DGA can be separated into a four byte pre-
ﬁx and a sufﬁx string argument. The sufﬁx string
arguments we observed were:
seapollo.com,
tomvader.com, aulmala.com, apon-
tis.com, fnomosk.com, erhogeld.com,
erobots.com, ndsontex.com, rte-
hedel.com, nconnect.com, edsafe.com,
berhogeld.com, musallied.com, newna-
cion.com, susaname.com, tvolveras.com
and dminmont.com.
The four bytes of entropy for the DGA were provided
by the preﬁx. We observe collisions between NXDo-
mains from different days, especially when only one suf-
ﬁx argument was active. Therefore, we registered a small
sample of ten domain names at the beginning of 2012 in
an effort to obtain a glimpse of the overall distribution of
this botnet. Over a period of one month of monitoring
the sink-holed data from the domain name of this DGA,
this botnet has infected hosts in 270 different networks
distributed across 25 different countries. By observing
the recursive DNS servers from the domain names we
sinkholed, we determined 4,295 were located in the US.
The recursives we monitored were part of this list and we
were able to measure 86 infected hosts (on average) in
the network we were monitoring. The ﬁve countries that
had the most DNS resolution requests for the sinkholed
domain names (besides the US) were Japan, Canada,
the United Kingdom and Singapore. The average num-
ber of recursive DNS servers from these countries that
contacted our authorities was 22 — signiﬁcantly smaller
than the volume of recursive DNS servers within the US.
8 Discussion and Limitations
Pleiades has some limitations. For example, once a
new DGA is discovered, Pleiades can build fairly accu-
rate statistical models of how the domains generated by
the DGA “look like”, but it is unable to learn or recon-
struct the exact domain generation algorithm. Therefore,
Pleiades will generate a certain number of false positives
and false negatives. However, the results we presented
in Table 1 show that Pleiades is able to construct a very
accurate DGA Classiﬁer module, which produces very
few false positives and false negatives for a = 10. At
the same time, Table 3 shows that the C&C Detection
module, which attributes a single active domain name
to a given DGA, and also works fairly well in the ma-
Table 4: C&C Infrastructure for BankPatch.
IP addresses
CC
Owner
146.185.250.{89-92}
31.11.43.{25-26}
31.11.43.{191-194}
46.16.240.{11-15}
62.122.73.{11-14,18}
87.229.126.{11-16}
94.63.240.{11-14}
94.199.51.{25-18}
94.61.247.{188-193}
88.80.13.{111-116}
109.163.226.{3-5}
94.63.149.{105-106}
94.63.149.{171-175}
176.53.17.{211-212}
176.53.17.{51-56}
31.210.125.{5-8}
31.131.4.{117-123}
91.228.111.{26-29}
94.177.51.{24-25}
95.64.55.{15-16}
95.64.61.{51-54}
194.11.16.133
46.161.10.{34-37}
46.161.29.102
95.215.{0-1}.29
95.215.0.{91-94}
124.109.3.{3-6}
213.163.91.{43-46}
200.63.41.{25-28}
Petersburg Int.
RU
SC EQUILIBRIUM
RO
SC EQUILIBRIUM
RO
iNet Colocation
UA
UA
“Leksim” Ltd.
HU Webenlet Kft.
Com Frecatei
RO
NET23-AS 23VNET
HU
RO
Vatra Luminoasa
PRQ-AS PeRiQuito
SE
VOXILITY-AS
RO
SC CORAL IT
RO
SC CORAL IT
RO
TR
Radore Hosting
Radore Hosting
TR
Radore Hosting
TR
LEVEL7-AS IM
UA
LEVEL7-AS IM
UA
UA
LEVEL7-AS IM
NETSERV-AS
RO
NETSERV-AS
RO
PIN-AS Petersburg
RU
PIN-AS Petersburg
RU
RU
PIN-AS Petersburg
PIN-AS Petersburg
RU
PIN-AS Petersburg
RU
SERVENET-AS-TH-AP
TH
INTERACTIVE3D-AS
NL
PA
Panamaserver.com
jority of cases. Unfortunately, there are some scenarios
in which the HMM-based classiﬁcation has difﬁculties.
We believe this is because our HMM considers domain
names simply to be sequences of individual characters.
In our future work, we plan to experiment with 2-grams,
whereby a domain name will be seen as a sequence of
pairs of characters, which may achieve better classiﬁca-
tion accuracy for the harder to model DGAs.
For example, our HMM-based detector was unable to
obtain high true positive rates on the Boonana DGA. The
reason is that the Boonana DGA leverages third-level
pseudo-random domain names under several second-
level domains owned by dynamic DNS providers. Dur-
ing our evaluation, the hosts infected with Boonana con-
tacted DGA-generated domain names under 59 different
effective second-level domains. We believe that the high
variability in the third-level domains and the high num-
ber of effective 2LDs used by the DGA make it harder
to build a good HMM, thus causing a relatively low
number of true positives. However, in a real-world de-
ployment scenario, the true positive rate may be signif-
icantly increased by focusing on the dynamic DNS do-
mains queried by the compromised hosts. For example,
since we know that Boonana only uses dynamic DNS
domains, we can ﬁlter out any other NXDomains, and
avoid passing them to the HMM. In this scenario the
HMM would receive as an input only dynamic DNS do-
mains, which typically represent a fraction of all active
domains queried by each host, and consequently the ab-
solute number of false positives can be signiﬁcantly re-
duced.
As we mentioned in Section 3, detecting active DGA-
generated C&C domains is valuable because their re-
solved IP addresses can be used to update a C&C IP
blacklist. In turn, this IP blacklist can be used to block
C&C communications at the network edge, thus pro-
viding a way to mitigate the botnet’s malicious activ-
ities. Clearly, for this strategy to be successful, the
frequency with which the C&C IP addresses change
should be lower than the rate with which new pseudo-
random C&C domain names are generated by the DGA.
This assumption holds for all practical cases of DGA-
based malware we encountered. After all, the generation
of pseudo-random domains mainly serves the purpose