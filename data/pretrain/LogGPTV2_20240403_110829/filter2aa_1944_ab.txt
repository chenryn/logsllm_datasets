Yahoo
Ebay
Amazon
Facebook
Twitter
In our test cases, the tool was even able to steal information transmitted over HTTPS.  During these captures, 
sessions were successfully and near transparently degraded from HTTPS to HTTP. The victim, who was using 
the Google Chrome web browser, logged into Facebook.com and had their credentials stolen and displayed by 
the tool in plaintext. Indication of foul play was limited to a Uniform Resource Locator (URL) that stated 
www.facebook.com as opposed to https://www.facebook.com.  No certificate errors were presented to the 
victim, and the victim was able to login just as they normally would.  Thus, their login information was still 
stolen with effective transparency.
Web Code Injection
The Subterfuge Project includes a modified version of SSLStrip that takes advantage of its web proxy 
capabilities. Subterfuge’s modification allows the data to be tampered with before reaching the victims 
browser. In essence this allows us to inject arbitrary code into a victim’s browser session. This can be anything 
from a JavaScript alert message to an exploit like ms10_aurora.
4
Extensibility and the Framework
Naturally, Man-in-the-Middle Attacks are not limited to mere credential fraud. Neither is Subterfuge. Basic 
usage of the tool will be to ARP Poison the LAN; however, from this perspective it is possible to initiate many 
attacks. The Framework will automatically gather credentials, but it can also do more. Subterfuge’s Plugin 
System allows for the usage of additional MITM functionality without the need to develop another security 
tool from scratch.
Future Work
There are numerous areas of future advancement for this framework.  At a fundamental level, the framework 
can be expanded to include additional features to increase its effectiveness in testing and exploiting the 
vulnerabilities in the ARP protocol.
This tool can also be modified to work as a payload to an exploitation framework such as Metasploit. 
Subterfuge could be deployed on a remote network to harvest the credentials of legitimate users silently and 
transparently and then report the information back to a command and control server.
Current Progress
The Subterfuge Project is currently in its beta phase. Plans for future development include modules for:
Session Hijacking
Race Conditions
DNS Spoofing
Wireless AP Suite
Evilgrade Update Exploitation
Module – Session Hijacking
The session hijacking plugin will allow a user to masquerade as a victim within the session that was hijacked.
Module – Race Conditions
The race condition plugin will allow Subterfuge to return its own version of the web page that a user attempts 
to view. This modified version of the web page will contain a browser exploit, which can be used to attain 
arbitrary code execution on the victim’s machine.
Module – DNS Spoofing
The DNS spoofing plugin will allow Subterfuge to supply false DNS information to a victim’s machine causing 
them to be redirected to an alternate location.
Module – Wireless AP Suite
The Wireless AP Suite will have a number of extremely useful features, which will increase the functionality of 
Subterfuge. A user will be able to setup a fake access point through which a victim will connect, successfully 
creating a MITM situation. An advanced option would even listen for what computers in the nearby area are 
probing for and setup an access point spoofing networks the victims have previously connected to. This will 
allow the victim computers to connect to and route their traffic through Subterfuge without any user input. 
Module – Evilgrade Update Exploitation
Evilgrade is a tool that allows a user to spoof an update server on the network. When a victim starts up a 
program such as iTunes it automatically looks to see if updates exist. Evilgrade steps into this process and 
sends the victim a malicious payload. Subterfuge will include a module that simplifies the process, and 
incorporates it into the framework.
OS Compatibility
The beta version of Subterfuge runs on Linux only; however, the creation of installer packages for the 
Windows and Mac operating systems will ensure the widespread use of the Subterfuge MITM Framework.
5
Custom ARP Spoof Tool
The final version of Subterfuge will incorporate a custom-built Python ARP Spoofing Tool using Scapy to 
improve performance, increase stealth, and provide better MITM protection avoidance. This tool will replace 
ARPSpoof and allow for more advanced configurations and dynamic options to increase effectiveness, and 
engender the ability to thwart certain configurations of Cisco’s Dynamic ARP Inspection protection. It will also 
decrease network load and will allow the attack to hide more effectively amongst normal network traffic.
Conclusion
In conclusion, the Subterfuge Framework allows a user to circumvent many security protocols and policies on 
a computer network with ease and with devastating results to the victims.  Credential harvesting can be one of 
the most difficult attacks to recover from as a corporation or an individual because the attacker has the 
legitimate information that is entered to authenticate a user. Furthermore, the modular structure of Subterfuge 
makes it extremely extensible. The simplicity and effectiveness offered by Subterfuge should drive the rate of 
its incorporation into the toolbox of network security practitioners.  If this tool is released to the public and 
distributed, the wide-spread ease in which anyone on a computer network could be victimized by a non-
technical user will have the desired effect of forcing the information security community to come up with a 
solution to the underlying problem – the trusting nature of the Address Resolution Protocol.
The Framework: Poking Holes in ARP one 
Starbucks at a Time
6
The GUI:
Subterfuge’s web based GUI uses AJAX and JQuery to leverage user input as commands. It then converses 
with a Django Backend to allow for the seamless execution of the python code that embodies the core of the 
project.
Command Line Interface:
The Command Line Interface (CLI) for Subterfuge allows users to quickly configure and run a MITM attack 
against a network.
Interface Options
7
A Potential Solution: VLANs
VLANs can provide network segmentation, which can prevent MITM attacks. Some routers put different hosts 
on different VLANs. In these cases the devices may be independent of MAC Addresses thereby preventing an 
ARP Poisoning Attack from occurring. If however, multiple hosts are on the same VLAN no additional 
protection is provided.
8
An ARP Cache Poison can modify a victim’s ARP Table:
9
“Creativity is inventing experimenting, growing, taking risks, breaking rules and having fun.”
~ Mary Lou Cook
[1] Barber, R. (2011, August 30). Security Science. Retrieved from Computer Fraud & Security Volume 2001, Issue 3.
[2] Kurose, J. and Ross, K. Computer Networking: A Top-Down Approach. 5th Edition. Addison-Wesley. Page 61
[3] Saltzman, R. (2011, August 30). Security Science. Retrieved from OWASP: http://www.security-
science.com/pdf/active-man-in-the-middle.pdf
[4] Leitch, S. (2009). Security Issues Challenging Facebook. Retrieved from Edith Cowan University Research Online: 
http://ro.ecu.edu.au/cgi/viewcontent.cgi?article=1017&context=ism&sei-redir=1#search=%22facebook%20secure%22
[5] Wagner, R. (2011, August 30). Address Resolution Protocol Spoofing and Man-in-the-Middle Attacks. Retrieved from 
http://savannah.gatech.edu/people/lthames/dataStore/WormDocs/arppoison.pdf
[6] Norton, D. (2011). An Ettercap Primer. SANS Institute, 1-27.
[7] Marlinspike, M. (2011, August 30). Blackhat. Retrieved from http://blackhat.com/presentations/bh-europe-
09/Marlinspike/blackhat-europe-2009-marlinspike-sslstrip-slides.pdf
[8] Song, D. (2012, January 1). Dsniff Frequently Asked Questions. Retrieved from 
http://www.monkey.org/~dugsong/dsniff/faq.html
[9] Ogle, J. and Wagner, E. (2012, March 8). Hotel Network Security: A Study of Computer Networks in U.S. Hotels. Retrieved 
from http://www.hotelschool.cornell.edu/research/chr/pubs/reports/abstract-14928.html
References
References
Legacy: Demonstrating Need and Spurring Change
There is an obvious need for change in routing equipment. While routers that incorporate VLANs 
and are thus protected against ARP Spoofing do exist, they are uncommon commodities. 
Manufactures have no real incentive to improve their equipment because the arcane art of Man-in-
the-Middle Attacks is obscure enough that the average consumer is unconcerned, but they are not 
safe. Subterfuge uncovers the faults in ARP so easily that consumers of routers will be able to point at 
products and ask themselves, “Does this product protect me from Subterfuge? “This just might 
provide the impetus that manufactures should have had a decade ago. Hopefully, through 
demonstration of the pervasive vulnerabilities inherent in the ARP Protocol router manufacturers 
will be spurred into utilization of existing technologies to protect their users.
Hopefully through demonstration of the pervasive vulnerabilities inherent in the ARP Protocol 
router manufactures will be spurred into utilization of existing technologies to protect against ARP 
Poisoning attacks.
10