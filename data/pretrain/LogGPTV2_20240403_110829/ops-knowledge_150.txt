User: How to implement port mapping using iptables on Ubuntu system?
Assistant: 1. Confirm whether iptables has been installed and enter the following command in the terminal: ``` sudo apt-get install iptables ``` If the system prompts that iptables has been installed, you can skip this step. 2. Enable port forwarding Enter the following command in the terminal: ``` sudo sysctl -w net.ipv4.ip_forward=1 ``` This will enable the IPv4 IP forwarding function. If you need to enable the IPv6 IP forwarding function, you can replace "ipv4" in the command with "ipv6". 3. Create a port mapping rule Replace A, B, C, and D in the following commands with the target IP address and port number, and replace X, Y with the local IP address and port number: ``` sudo iptables -t nat -A PREROUTING -p tcp --dport A -j DNAT --to-destination B:C sudo iptables -t nat -A POSTROUTING -p tcp -d B --dport C -j SNAT --to-source A sudo iptables -t nat -A OUTPUT -p tcp -d B --dport C -j DNAT --to-destination A:X sudo iptables -t nat -A OUTPUT -p tcp -d X --dport Y -j SNAT --to- source D ``` The role here is: PREROUTING: process the data packet before entering the route POSTROUTING: process the data packet before the network exit OUTPUT: process the data packet when it is sent from the machine DNAT: target address translation SNAT: original address translation 4. Save the rules Enter the following command in the terminal to save the rules to a file: ``` sudo sh -c "iptables-save > /etc/iptables.rules" ``` Then edit /etc/network /interfaces file, add the following content in the interface settings: ``` pre-up iptables-restore < /etc/iptables.rules ``` 5. Test Now you can test whether the port mapping is working. Open the terminal and enter the following command to ensure that the target host has started the required services: ``` telnet BC ``` If it can be connected, it means that the port mapping has been successful.