邮件钓⻥平台搭建以及基
础使⽤场景
- SecPulse.COM
安全脉搏
|
“ 前⾔
前⾔
⼀个⻛和⽇丽的下午，和平常⼀样，审审漏洞，然后逛逛
其他相关的安全论坛，翻看其他⼤佬们的漏洞挖掘思路，
⼀天就这样过去了，当准备要下班的时候，发现微信⼀直
响个不停，⼼⾥想完了（下班⽆望），看来⼜有新项⽬要
开始了，于是打开微信，果不其然，⾃⼰猜对了。
邮件钓⻥演练，听到这⼏个词语，⼀脸懵逼，
what？？？由于之前的⼯作⼀直都是以 web 挖洞为主，
突然让搞⼀个邮件钓⻥，可把我难住了，既然领导派下来
的活，硬着头⽪也得⼲，那就这样吧，说做就做。
⼼⾥想，既然要搞邮件钓⻥，那就先了解⼀下什么是邮件
钓⻥，怎么在项⽬中快速搭建邮件钓⻥环境以及完成钓⻥
邮件⼯作。
背景：
⽬前越来越多的红蓝对抗中，钓⻥邮件攻击使⽤的越来越
频繁，也是⽐较⾼效打点的⼀种 ⽅式，常⻅的钓⻥邮件
攻击⼀种是直接通过⼆维码，内嵌链接、直接索要敏感信
息等⽅式钓运维⼈员、内部⼈员相关的管理账号密码，另
⼀种通过携带 exe、execl、word 等附件（附件中要么包
含恶意宏代码、要么是远控 exe）的⽅式，诱导运维⼈
员、内部员⼯点击相关的附件，以达到控制运维⼈员或者
内部员⼯电脑的权限。但是⼀般项⽬中实施周期较短，并
且需要进⾏数据统计等，因此本次主要介绍如何通过
Gophish 和 EwoMail 快速搭建邮件钓⻥平台并介绍⼀次
实战钓⻥邮件场景。
概念性的内容介绍完了，那就开始着⼿准备相关邮件钓⻥
需要的环境吧。
准备的环境和⼯具
购买相近的域名（⽐如你需要针对某某公司进⾏
钓⻥，公司邮箱使⽤的是 PI:EMAIL, 则可
购买相类似的域名，如：yeeesd.com，多了⼀个
⼩写的 e，如果不仔细去看的话，⼀般员⼯会认
为该钓⻥⽹站即是公司的官⽹地址）
2 台 vps（1 台搭建邮件服务器、1 台搭建
Gophish）
Gophish 的版本 v0.9.0
EwoMai 的版本 v1.06
具体搭建过程
Gophish 搭建
建议在 centos7（windows 中搭建 gophish，虽然⽐较
⽅便，但是如果买的 vps 不是⾼配版，建议不要在
windows 中搭建 gophish，经测试，太卡了） 在 github
上根据不同操作系统下载对应版本即可，本次下载如下版
本。
gophish-v0.9.0-linux-64bit.zip
https://github.com/gophish/gophish/releases
解压并启动。
mkdir -p /app/gophish
unzip gophish-v0.9.0-linux-64bit.zip -d /app/gophish/
cd /app/gophish/
此时需要修改 config.json,（如下是本次已经修改完成
的，之前的配置是 127.0.0.1:3333）。
80 端⼝代表钓⻥⽹站开放的端⼝；后台管理⻚⾯开放的
端⼝是 3333，默认的账号和密码是 admin/gophish。
后台直接运⾏，⽬前环境即搭建完成。
./gophish &
进⾏测试 ⾸先访问钓⻥⻚⾯端⼝是否正常，直接访问如
下地址 http://x.x.x.x
后台管理系统如下：
https://x.x.x.x:3333/
Gophish 搭建完成。
EwoMail 搭建
官⽹直接下载开源的项⽬。
https://gitee.com/laowu5/EwoMail
此处直接按照官⽅⽂档进⾏⼀步步搭建以及配置域名即可
（前期是先买好相关的相类似域名）。
http://doc.ewomail.com/docs/ewomail/install
碰到的坑如下：购买域名以及搭建 EwoMail 的 vps 建议
选择国外⼚商，国内由于种种的限制，会导致出现莫名奇
妙的问题，最终搭建的效果如下所示：
http://域名:8010
新建相关的发件邮件地址即可。
⾄此⽬前已经搭建完毕，发现搭建成功后的 Gophish 是
英⽂平台，本⼈英⽂属于⽐较菜的那种，因此花费了不少
时间，才熟悉了 Gophish 的基本使⽤，那就先简单介绍
⼀下具体的使⽤吧，⼀⽅⾯为了⾃⼰巩固，另⼀⽅⾯，也
⽅便后续其他与我碰到相同项⽬的同事，能够快上⼿搭建
钓⻥邮件平台以及展开钓⻥邮件测试。
实战钓⻥攻击
进⾏实战钓⻥测试时，需要提前配置好 Gophish 该系统
具有如下⼏个功能，均需要进⾏配置。
功能 简述
Dashboard 仪表板，查看整体测试情况
Campaigns 每次攻击前需要配置⼀次
Users & ⽤户和⽤户组
Groups （添加需要进⾏钓⻥的邮箱和相关基础信息）
Email
电⼦邮件模板
Templates
Landing
需要伪造的钓⻥⻚⾯
Pages
Sending
钓⻥邮箱发送配置
Profiles
Sending Profiles - 邮箱配置
填写刚才新建的发送邮箱地址和⽤户名。
配置完成后，需要测试⼀下是否可正常发送邮件，使⽤如
下⾃带的测试功能（Send Test Email）。
如下是我的 QQ 邮箱收到的测试邮件。
注意点： 此处需要注意的是 Host 处，不能采⽤ smtp
默认端⼝：25 端⼝，因为⼤部分的云⼚商因为 监管要
求，为防⽌邮件泛滥，都将 25 端⼝禁⽤了，因此可采⽤
带有 SSL 的 SMTP 服务的端 ⼝：465 端⼝。
Users& Groups - 邮件⽤户和
组
此时就可以进⾏下⼀步的配置，设置要进⾏钓⻥攻击的邮
箱地址，“Users& Groups”。
⼀般项⽬中或者真实测试中需要批量发送邮件，因此可通
过上传 CVS ⽂件，进⾏批量添加。
Email Templates - 钓⻥邮件模
板
创建相应的钓⻥邮件模板 此处钓⻥模板可直接进⾏编
辑，也可导⼊其他邮箱的模板。
⽅式⼀：⾃⼰编辑。
为了后续记录邮件是否打开，可勾选上
AddTrackingImage，它将会在发送的每份邮件源码上插
⼊⼀个唯⼀特定的隐藏图⽚，当邮件被打开时，此隐藏图
⽚则也会被请求，以此来检测该邮件是否被打开，
AddFiles 则是给邮件添加附件。如下是官⽅提供的其他
可以使⽤的参数。
ariable Description
{{.RId}} The target's unique ID
{{.FirstName}} The target's first name
{{.LastName}} The target's last name
{{.Position}} The target's position
The target's email
{{.Email}}
address
{{.From}} The spoofed sender
The URL to the tracking
{{.TrackingURL}}
handler
{{.Tracker}} An alias for
{{.URL}} The phishing URL
ariable Description
The base URL with the
path and rid parameter
{{.BaseURL}} stripped. Useful for
making links to static
files.
针对如上提供的参数进⾏测试。
如下是收到的邮件结果。
可根据实际的钓⻥场景使⽤合适的参数，增加钓⻥邮件内
容的真实性。
⽅式⼆：导⼊其他邮箱已有模板 ⾸先将原有的邮件导出
为 eml 格式。
然后通过 notepad++ 打开，复制所有的内容。
默认会选择 Change Links to Point to Landing Page，
将图中链接替换成钓⻥⻚⾯链接，点击 import，即可成
功导⼊。
注意点：
1、如果需要去统计哪些⼈点开了钓⻥邮件，哪些⼈打开
了钓⻥⻚⾯，需要在钓⻥邮件模板 中的 html 进⾏更改和
添加，在 Text 中进⾏操作，后续是⽆法正常进⾏记录
的。
2、AddTrackingImage 功能记录不是很准确，仅作参
考，因为部分邮件软件会将邮件中插 ⼊的隐藏图⽚识别
为恶意代码，不允许显示该图⽚，经实际测试，⼤部分的
邮件软件不会 进⾏拦截的。