### 邮件钓鱼平台搭建及基础使用场景
- SecPulse.COM 安全脉搏

#### 前言
在一个风和日丽的下午，我像往常一样审核漏洞并浏览安全论坛，查看其他安全专家的漏洞挖掘思路。正当准备下班时，微信消息不断弹出，心中暗想：看来又有新项目要开始了。果然，领导安排了一个邮件钓鱼演练的任务。由于我之前的工作主要集中在Web漏洞挖掘上，对邮件钓鱼并不熟悉，但既然任务已经下达，只能硬着头皮开始。

首先，我决定了解一下什么是邮件钓鱼，并学习如何在项目中快速搭建邮件钓鱼环境以及完成钓鱼邮件工作。

#### 背景
目前，在红蓝对抗中，钓鱼邮件攻击越来越频繁，成为一种高效的攻击手段。常见的钓鱼邮件攻击方式包括通过二维码、内嵌链接或直接索要敏感信息来获取运维人员或内部员工的管理账号密码；另一种则是通过携带恶意附件（如包含宏代码或远控程序的exe、excel、word等）诱导点击，以获取目标电脑的控制权限。然而，一般项目实施周期较短，且需要进行数据统计，因此本文将介绍如何利用Gophish和EwoMail快速搭建邮件钓鱼平台，并展示一次实战钓鱼邮件场景。

#### 准备环境与工具
- **相近域名**：针对特定公司进行钓鱼时，购买一个相似的域名（例如，公司邮箱为PI:EMAIL，则可购买yeeesd.com，多一个小写的e，不仔细看的话容易误认为是官方地址）。
- **2台VPS**：1台用于搭建邮件服务器，1台用于搭建Gophish。
- **Gophish版本**：v0.9.0
- **EwoMail版本**：v1.06

#### 具体搭建过程
##### Gophish搭建
建议在CentOS 7上搭建Gophish，因为Windows环境下可能会出现性能问题。从GitHub下载对应版本：
```bash
gophish-v0.9.0-linux-64bit.zip
```
解压并启动：
```bash
mkdir -p /app/gophish
unzip gophish-v0.9.0-linux-64bit.zip -d /app/gophish/
cd /app/gophish/
```
修改`config.json`文件中的配置（如下是已修改后的配置）：
- 端口80：钓鱼网站开放端口
- 端口3333：后台管理页面开放端口
- 默认账号密码：admin/gophish

启动服务：
```bash
./gophish &
```
测试访问：
- 钓鱼页面：http://x.x.x.x
- 后台管理系统：https://x.x.x.x:3333/

##### EwoMail搭建
从官网上下载开源项目：
```bash
https://gitee.com/laowu5/EwoMail
```
按照官方文档逐步搭建并配置域名：
```bash
http://doc.ewomail.com/docs/ewomail/install
```
注意事项：
- 建议选择国外厂商购买域名和VPS，以避免国内的各种限制。
- 搭建完成后，访问：http://域名:8010
- 新建发件邮件地址即可。

#### 实战钓鱼攻击
在进行实战钓鱼测试前，需提前配置好Gophish系统的主要功能模块：

- **Dashboard**：仪表板，查看整体测试情况。
- **Campaigns**：每次攻击前需配置一次。
- **Users & Groups**：用户和用户组（添加需要进行钓鱼的邮箱及相关基本信息）。
- **Email Templates**：电子邮件模板。
- **Landing Pages**：伪造的钓鱼页面。
- **Sending Profiles**：发送邮件配置。

**配置步骤**：
1. **发送配置**：填写新建的发送邮箱地址和用户名。
2. **测试发送**：使用自带的“Send Test Email”功能进行测试。
3. **注意点**：Host处不能采用默认的SMTP 25端口，建议使用带有SSL的SMTP 465端口。

**用户和组配置**：
- 批量添加目标邮箱地址，可通过上传CSV文件实现。

**邮件模板创建**：
- **方式一**：自行编辑。勾选“AddTrackingImage”以便跟踪邮件打开情况。
- **方式二**：导入已有模板。导出原邮件为eml格式，使用Notepad++打开并复制内容，替换链接后导入。

**注意事项**：
1. 统计邮件打开情况需在HTML中更改和添加相应代码。
2. “AddTrackingImage”功能记录可能不准确，部分邮件软件会拦截隐藏图片。

通过以上步骤，可以快速搭建并使用邮件钓鱼平台，希望对后续有类似需求的同事有所帮助。