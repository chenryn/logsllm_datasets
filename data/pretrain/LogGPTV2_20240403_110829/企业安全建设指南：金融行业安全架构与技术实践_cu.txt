理，让不具备这种能力的安全人员也能成为对抗攻击者的力量，这是安全工程化能力提升的收益，也是
安全运营关注的问题。
要实现目标，必须有方法。本章接下来将从架构、工具、所需资源三个方面介绍安全运营体系的实
现方法。
20.2 架构
安全运营架构如图20-1所示。
图20-1 安全运营架构
为确保安全运营架构能够灵活扩展，推荐按功能划分成四个模块：安全防护框架、安全运维框架、
安全验证框架、安全度量框架。
1.安全防护框架
安全防护框架的目的是部署尽可能多和有效的安全感知器（Sensor），这些安全感知器构成了信息安
全的“天网”，这部分是基础工作，也是安全的传统主战场，需要历经多年的持续投入积累。安全感知器
的部署遵循纵深防御的理念，如图20-2所示。
实际上可能远远不止图20-2中这些Sensor。比如网络层，可以把防火墙监测信息特别是Deny信息采集
了，有些防火墙还自带IPS功能，如CheckPoint的SmartDefense，就是特别好用的安全Sensor，交换机、路
由器的ACS服务器信息，堡垒机登录信息，虚拟层虚拟主机操作信息，Windows、Linux主机日志，在主
机部署安全客户端的监测信息，数据库审计系统监测信息，AD系统信息，存储备份系统操作信息，
KVM、ILO等带外管理系统信息，ITIL系统工单信息，应用系统应用信息（如OA系统应用日志），SAP
系统应用信息，公文传输系统日志，FTP数据传输日志等。
图20-2 安全防护框架
企业基础安全的大部分内容就是建设各类安全Sensor，解决点状的安全问题和需求。比如企业防火墙
多了，如何管理防火墙规则的有效性和合规性，可能需要部署诸如Algosec、firemon等防火墙规则审计工
具，审计发现的信息就可以作为安全运维框架的输入。如果想监测企业内网或服务器访问了哪些恶意地
址，可以采集类似ArcOSI这样的开源恶意地址库。
安全防护框架建设，需要考虑两个问题：
·给安全运维框架发送原始监测信息还是Sensor处理后的监测告警信息？如果是防火墙、IPS等安全防
护系统，尽量是全量原始信息；如果是Windows、linux主机日志，合规检测，登入登出等信息，考虑对
原始信息进行过滤，只和安全相关的信息才作为安全运维框架的输入。
·要不要做业务安全监测？Ayazero认为企业安全涵盖七大领域：①网络安全；②平台和业务安全；③
广义的信息安全；④IT风险管理、IT审计&内控；⑤业务持续性管理；⑥安全品牌营销、渠道维护；
⑦CXO们的其他需求。对于传统行业，建议做①③④⑤；对于互联网公司，建议做①②⑤；对于金融行
业，建议做①③④；能力强的安全团队，建议做①②③④⑤⑥⑦。
2.安全运维框架
安全运维框架的建设目标是成为企业安全的大脑、耳目、神经中枢和手脚。在军队现代化作战体系
中，美军创造性地提出了C4 ISR作战指挥系统，即指挥、控制、通信、计算机与情报、监视、侦察。一
个完整的信息安全“作战指挥自动化系统”应包括以下几个分系统：基础架构平台、安全情报监视系统、
数据分析系统、安全控制系统。
·“大脑”—基础架构平台。基础架构平台是构成指挥自动化系统的技术基础，指挥自动化系统要求容
量大、速度快，兼容性强。
·“耳目”—安全情报，安全监视、侦察系统。主要是对安全防护框架中各安全Sensor的安全信息进行
收集和处理，实现异常行为的实时安全监测。
·“神经中枢”—数据分析系统。综合运用各类智能分析算法和数据挖掘分析技术，实现安全信息处理
的自动化和决策方法的科学化，以保障对安全控制设备的高效管理，主要技术是智能分析算法和模型及
其实现。
·“手脚”—安全控制系统。安全检测和控制系统是用来收集与显示安全信息、实施作战指挥系统发出
安全控制指令的工具，主要是各类安全控制技术和设备，如防病毒和主机安全客户端、防火墙等，实现
异常行为的实时安全控制。
安全运维框架实际落地时，企业会部署SIEM、安全大数据等类似平台，实现安全检测信息的统一采
集、分析处理和存储，大部分平台支持内置或自定义的黑名单检测规则进行实时检测。安全运维框架还
有很重要的一部分—安全事件的流程化处理和定期review、汇报。安全事件的流程化处理应遵循企业事件
管理流程（如ITIL），通过自动化下发安全工单，发送告警邮件、短信等方式进行安全提醒，安全事件
确认和溯源分析主要通过人工分析和确认的方式进行。对于100%确定的安全攻击通过自动化方式进行阻
断。同时，通过安全事件日例会、周报、月报、年报等方式进行闭环管理，并进行必要的管理层汇报。
3.安全验证框架
安全验证框架解决安全有效性的问题，承担对安全防护和安全运维两个框架的功能验证。安全验证
框架是企业安全的蓝军，在和平时期，蓝军扮演着对手角色，利于及时发现、评估、修复、确认和改进
安全防护框架和安全运维框架中的脆弱点。验证包括白盒检测（过程验证）和黑盒检测（结果验证）两
部分。
白盒检测（过程验证）是指建立自动化验证平台，对安全防护框架的管控措施实现100%的全面验
证，并可视化集成至安全运维平台中，管控措施失效能够在24小时内发现。通过自动化验证平台，可以
达到：
·验证安全Sensor的安全监测功能有效。
·验证安全Sensor所产生的监测信息到SIEM平台的信息采集有效。
·验证SIEM平台的安全检测规则有效。
·验证告警方式（邮件、短信与可视化展示平台）有效。
基于上述目标，自动化验证要求所有的验证事件必须为自动化模拟真实事件产生，不能使用插入记
录的方式产生。同时，自动化验证事件应提供判断是否为验证事件的唯一标识，验证事件产生时间需统
一安排，防止集中触发。安全运维平台应能够监测到安全验证未通过的系统和规则，并产生告警信息，
通知安全运维人员介入处理。
黑盒检测（结果验证）是指通过多渠道安全渗透机制和红蓝对抗演习等，先于对手发现自己的漏洞
和弱点。多渠道安全渗透机制目前常见的就是安全众测，红蓝对抗演习需要企业具有较高攻防技能的安
全人员，也可聘请外部专业机构完成，用于检测安全防护框架和安全运维框架的有效性。
4.安全度量框架
安全度量框架主要用于衡量评价安全有效性，这是挺难的一件事，此处仅做一些探讨。度量可以分
成以下几个层次：
一是技术维度。包括防病毒安装率、正常率，入侵检测检出率、误报率，安全事件响应时长、处理
时长，高危预警漏洞排查所需时间和完全修复时间等。还可以考虑安全运维平台可用性、事件收敛率
等。合规性方面可以设置合规率、不合规项数量、内外部审计发现数量和严重度等。
二是安全运营成效。包括覆盖率、检出率、攻防对抗成功率。有多少业务和系统处于安全保护之
下，有多少无人问津的灰色地带，安全能在企业内部推动得多深入、多快速，这是需要综合技术和软性
技能的，成败主要系于安全团队负责人。检出率和攻防对抗成功率都是衡量安全有效性的有效指标，安
全团队即使不能拍着胸脯保证不出事，也不能靠运气和概率生存，那么，持续提升检出率和攻防对抗成
功率就是努力的方向。
三是安全满意度和安全价值。安全价值反映在安全对业务支撑的能力，如TCO/ROI、安全用多少资
源、支撑了多少业务、支撑的程度等。安全价值还体现在内部的影响力以及对业务的影响力，是做微观
安全还是广义安全，是为业务带来正面影响还是负分拖后腿。安全满意度是综合维度指标，是对安全团
队和人员的最高要求，既要满足上级领导和业务部门对安全的利益诉求。又要满足同级横向其他IT团队
对安全的利益诉求，还要满足团队内部成员的利益诉求。要提供最佳的安全服务，既让安全的用户成为
安全的客户，又让使用者满意，真的是非常非常有挑战的一件事情。
20.3 工具
安全运营工具包括支撑安全运维框架实现的SIEM平台、安全事件处理标准化流程工具ITIL、安全控
制自动化工具三部分：
·SIEM平台，负责安全信息的统一收集和存储、基于检测规则的异常检测和告警。
·ITIL平台，负责接收SIEM平台发送过来的安全事件信息，并据此产生ITIL工单，推送给安全运营人
员处理和关闭。
·安全控制自动化工具，负责根据SIEM平台下发的安全控制指令进行自动化操作。例如，检测发现有
外部攻击源，通过下发自动化指令实现防火墙或IPS封禁该攻击源；检测发现某主机有可疑进程，通过安
全客户端收集该进程文件样本信息进一步手动分析；检测发现办公内网某用户计算机上有个可疑的非人
工操作，疑似程序自动操作，可通过安全客户端提示用户手工确认等。
SIEM平台、ITIL平台目前市面上成熟的产品不少，但安全控制自动化工具目前商业化程度不高。
1.检测规则
如果有合适的检测规则，SIEM是个非常强大的工具，可以检测其他安全工具无法捕获的安全事件。
通常SIEM的检测规则有三类：
（1）检测条件规则。满足单一特定检测条件则触发告警。例如，服务器主机登录来源非堡垒机地
址，满足该条件则告警。该类型规则最简单，主要依靠安全Sensor的监测能力和规则过滤能力。是攻击就
一定有异常，关键是怎么总结提炼出异常的特征加以检测，比如，Ayazero在《互联网企业高级安全》一
书中提到的检测攻击提权，“某个高权限（system?uid=0）进程（bash?cmd.exe?）的父进程为低权限”，是
一个总结提炼异常特征加以检测的很好案例。
（2）跨平台安全监测信息关联检测。最典型的规则为基于资产脆弱性的攻击告警，如，关联分析漏
洞扫描和入侵检测告警信息进行关联检测。再比如防火墙permit日志中有连接ArcOSI中定义的恶意IP地址
信息。
该类型规则在跨平台系统监测信息之间进行关联，可以衍生出很多脑洞大开的检测规则。比如，检
测安全违规行为，检测数据泄密，甚至人员可能离职等。这类规则检测效果的好坏取决于两点—一是安
全Sensor的类型尽可能多，单个Sensor能监测维度尽可能广；二是规则设计者的检测思维，最好就像攻击
者思维一样，需要脑洞大开，需要从“猥琐”处着眼。
（3）针对长时间缓慢低频度攻击的检测规则。大部分的安全工具是以孤立方式识别潜在的安全事
件，例如，IDS监测到某台工作站发出的可疑流量，然后从其他20台工作站上监测到同类流量，在IDS管
理面板上，每个事件被当作单独事件处理（有些IDS厂商有高级功能），在SIEM中可以编写规则，根据
事件发生的频率触发不同的告警，如果在几分钟内从IDS传来21次类似的事件可以触发一条规则。如果攻