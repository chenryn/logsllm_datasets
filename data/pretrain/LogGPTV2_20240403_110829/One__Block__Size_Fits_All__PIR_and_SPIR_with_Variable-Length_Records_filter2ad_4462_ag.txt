### Privacy-Friendly Sales of Digital Content
This document discusses the privacy-friendly sales of e-books, music, movies, and smartphone and tablet applications.

### Acknowledgements
We would like to express our gratitude to the anonymous reviewers for their thoughtful and constructive comments. This research was partially funded by the Natural Sciences and Engineering Research Council of Canada (NSERC), Mprime NCE (formerly MITACS), and the Ontario Research Fund. The first author is supported by an NSERC Vanier Canada Graduate Scholarship and a Cheriton Graduate Scholarship.

### References
1. **M. H. Au, W. Susilo, and Y. Mu, "Constant-Size Dynamic k-TAA,"** in Proceedings of SCN 2006, LNCS, vol. 4116, Maiori, Italy, September 2006, pp. 111–125.
2. **A. Beimel, Y. Ishai, and T. Malkin, "Reducing the Servers' Computation in Private Information Retrieval: PIR with Preprocessing,"** Journal of Cryptology, vol. 17, no. 2, pp. 125–151, March 2004.
3. **A. Beimel and Y. Stahl, "Robust Information-Theoretic Private Information Retrieval,"** Journal of Cryptology, vol. 20, no. 3, pp. 295–321, July 2007.
4. **M. Bellare, J. A. Garay, and T. Rabin, "Fast Batch Verification for Modular Exponentiation and Digital Signatures,"** in Proceedings of EUROCRYPT 1998, LNCS, vol. 1403, Espoo, Finland, June 1998, pp. 236–250.
5. **G. R. Blakley and C. Meadows, "Security of Ramp Schemes,"** in Proceedings of CRYPTO 1984, LNCS, vol. 196, Santa Barbara, California, August 1984, pp. 242–268.
6. **D. Boneh and X. Boyen, "Short Signatures Without Random Oracles,"** in Proceedings of EUROCRYPT 2004, LNCS, vol. 3027, Interlaken, Switzerland, May 2004, pp. 56–73.
7. **D. Boneh, X. Boyen, and E.-J. Goh, "Hierarchical Identity Based Encryption with Constant Size Ciphertext,"** in Proceedings of EUROCRYPT 2005, LNCS, vol. 3494, Aarhus, Denmark, May 2005, pp. 440–456.
8. **G. Brassard, C. Crépeau, and J.-M. Robert, "All-or-Nothing Disclosure of Secrets,"** in Proceedings of CRYPTO 1986, LNCS, vol. 263, Santa Barbara, California, August 1986.
9. **J. Camenisch, M. Dubovitskaya, and G. Neven, "Oblivious Transfer with Access Control,"** in Proceedings of ACM CCS 2009, Chicago, Illinois, November 2009, pp. 131–140.
10. **J. Camenisch, M. Dubovitskaya, and G. Neven, "Unlinkable Priced Oblivious Transfer with Rechargeable Wallets,"** in Proceedings of FC 2010, LNCS, vol. 6052, Tenerife, Canary Islands, January 2010, pp. 66–81.
11. **J. Camenisch, M. Dubovitskaya, G. Neven, and G. M. Zaverucha, "Oblivious Transfer with Hidden Access Control Policies,"** in Proceedings of PKC 2011, LNCS, vol. 6571, Taormina, Italy, March 2011, pp. 192–209.
12. **J. Camenisch, G. Neven, and abhi shelat, "Simulatable Adaptive Oblivious Transfer,"** in Proceedings of EUROCRYPT 2007, LNCS, vol. 4515, Barcelona, Spain, May 2007, pp. 573–590.
13. **D. Chaum, R. Carback, J. Clark, A. Essex, S. Popoveniuc, R. L. Rivest, P. Y. A. Ryan, E. Shen, A. T. Sherman, and P. L. Vora, "Scantegrity II: End-to-End Verifiability by Voters of Optical Scan Elections Through Confirmation Codes,"** IEEE Transactions on Information Forensics and Security, vol. 4, no. 4, pp. 611–627, December 2009.
14. **D. Chaum and E. van Heyst, "Group Signatures,"** in Proceedings of EUROCRYPT 1991, LNCS, vol. 547, Brighton, UK, April 1991, pp. 257–265.
15. **B. Chor, N. Gilboa, and M. Naor, "Private Information Retrieval by Keywords,"** Technion, Israel, Technical report TR CS0917, 1997.
16. **B. Chor, E. Kushilevitz, O. Goldreich, and M. Sudan, "Private Information Retrieval,"** Journal of the ACM, vol. 45, no. 6, pp. 965–981, November 1998.
17. **H. Cohn and N. Heninger, "Approximate Common Divisors via Lattices,"** in Proceedings of the 10th Algorithmic Number Theory Symposium — ANTS X, July 2012.
18. **R. Cramer, I. Damgård, and B. Schoenmakers, "Proofs of Partial Knowledge and Simplified Design of Witness Hiding Protocols,"** in Proceedings of CRYPTO 1994, LNCS, vol. 839, Santa Barbara, California, August 1994, pp. 174–187.
19. **G. Danezis, R. Dingledine, and N. Mathewson, "Mixminion: Design of a Type III Anonymous Remailer Protocol,"** in Proceedings of IEEE S&P 2003, Oakland, California, May 2003, pp. 2–15.
20. **C. Devet, I. Goldberg, and N. Heninger, "Optimally Robust Private Information Retrieval,"** in Proceedings of USENIX Security 2012, Bellevue, Washington, August 2012.
21. **R. Dingledine, N. Mathewson, and P. F. Syverson, "Tor: The Second-Generation Onion Router,"** in Proceedings of USENIX Security 2004, San Diego, California, August 2004, pp. 303–320.
22. **A. Fiat and A. Shamir, "How to Prove Yourself: Practical Solutions to Identification and Signature Problems,"** in Proceedings of CRYPTO 1986, LNCS, vol. 263, Santa Barbara, California, August 1986, pp. 186–194.
23. **Y. Gertner, S. Goldwasser, and T. Malkin, "A Random Server Model for Private Information Retrieval or How to Achieve Information Theoretic PIR Avoiding Database Replication,"** in Proceedings of RANDOM 1998, Barcelona, Spain, October 1998, pp. 200–217.
24. **Y. Gertner, Y. Ishai, E. Kushilevitz, and T. Malkin, "Protecting Data Privacy in Private Information Retrieval Schemes,"** in Proceedings of STOC 1998, Dallas, Texas, May 1998, pp. 151–160.
25. **I. Goldberg, "Improving the Robustness of Private Information Retrieval,"** in Proceedings of IEEE S&P 2007, Oakland, California, May 2007, pp. 131–148.
26. **V. Guruswami and M. Sudan, "Improved Decoding of Reed-Solomon and Algebraic-Geometry Codes,"** IEEE Transactions on Information Theory, vol. 45, no. 6, pp. 1757–1767, September 1999.
27. **R. Henry and I. Goldberg, "Batch Proofs of Partial Knowledge,"** University of Waterloo, Technical report CACR 2012-04, 2012.
28. **R. Henry, F. Olumoﬁn, and I. Goldberg, "Practical PIR for Electronic Commerce,"** in ACM CCS 2011, Chicago, Illinois, October 2011, pp. 677–690.
29. **A. Kate, G. M. Zaverucha, and I. Goldberg, "Constant-Size Commitments to Polynomials and Their Applications,"** in Proceedings of ASIACRYPT 2010, LNCS, vol. 6477, Singapore, December 2010, pp. 177–194.
30. **E. Kushilevitz and R. Ostrovsky, "Replication is Not Needed: Single Database Computationally-Private Information Retrieval,"** in Proceedings of FOCS 1997, Miami Beach, Florida, October 1997, pp. 364–373.
31. **C. A. Melchor and P. Gaborit, "A Lattice-Based Computationally-Efficient Private Information Retrieval Protocol,"** in Proceedings of WEWORC 2007, Bochum, Germany, July 2007.
32. **M. Naor and B. Pinkas, "Oblivious Transfer and Polynomial Evaluation,"** in Proceedings of STOC 1999, Atlanta, Georgia, May 1999, pp. 245–254.
33. **F. G. Olumoﬁn and I. Goldberg, "Privacy-Preserving Queries over Relational Databases,"** in Privacy Enhancing Technologies, LNCS, vol. 6205, Berlin, Germany, July 2010, pp. 75–92.
34. **F. G. Olumoﬁn and I. Goldberg, "Revisiting the Computational Practicality of Private Information Retrieval,"** in Proceedings of FC 2011, LNCS, vol. 7035, Gros Islet, St. Lucia, February 2011, pp. 158–172.
35. **P. Y. A. Ryan and S. A. Schneider, "Prêt à Voter with Re-encryption Mixes,"** in Proceedings of ESORICS 2006, LNCS, vol. 4189, Hamburg, Germany, September 2006, pp. 313–326.
36. **A. Shamir, "How to Share a Secret,"** Communications of the ACM, vol. 22, no. 11, pp. 612–613, November 1979.
37. **R. Sion and B. Carbunar, "On the Practicality of Private Information Retrieval,"** in Proceedings of NDSS 2007, San Diego, California, March 2007.
38. **S. Yekhanin, "New Locally Decodable Codes and Private Information Retrieval Schemes,"** Electronic Colloquium on Computational Complexity (ECCC), vol. 13, no. 127, October 2006.

### Appendix: Zero-Knowledge Proof from Protocol 4
Let \(\mathbf{f} = (f_1, \ldots, f_r)\) be a vector of degree (at most) \(T = t + q\) polynomials in \(F[x]\). Let \(PK\) be public parameters for degree-\(T\) polynomial commitments. Let \(\mathbf{C} = (C_1, \ldots, C_r)\) be a componentwise vector of polynomial commitments to the components of \(\mathbf{f}\). Let \(A \subseteq F^{q \times r}\) be a set of "allowable" \(q\)-by-\(r\) matrices over \(F\); in the SPIR setting, each matrix in \(A\) will describe the layout of one of the records the user may retrieve. The tuple \((t, q, \mathbf{C}, A, PK)\) is common input to both the prover (P) and the verifier (V), but only P knows \(\mathbf{f}\).

The following protocol allows P to convince V that:
\[ 
\begin{pmatrix}
f_1(1) & \cdots & f_r(1) \\
\vdots & \ddots & \vdots \\
f_1(q) & \cdots & f_r(q)
\end{pmatrix} \in A;
\]
i.e., that there exists an allowable matrix \(A\) such that, for all \(i \in [1, \ldots, q]\), \(\mathbf{f}\) evaluates componentwise to the \(i\)-th row of \(A\) on input \(x = i\).

#### Protocol Steps
1. **V: Choose \(\mathbf{a} \in_R \{0, \ldots, n-1\}^{1 \times r}\) and send it to P.**
2. **P: Choose \(\gamma \in_R \mathbb{Z}_F^*\) and a generator \(h \in_R F\). Compute the polynomial \(F(x) = \gamma (\mathbf{f} \cdot \mathbf{a})\). Compute \(h' = h^\gamma\) and the (polynomial commitment) witnesses \(\omega_1, \ldots, \omega_q\) to the evaluations of \(F(x)\) at \(x = 1, \ldots, q\). Send the tuple \((h, h', \omega_1, \ldots, \omega_q)\) to V.**
3. **V: Choose \(\mathbf{c} \in_R \{0, \ldots, n-1\}^{q \times 1}\) and send it to P.**
4. **P and V: Compute the \(q\)-by-\(r\) challenge matrix \(B = \mathbf{c} \otimes \mathbf{a}\), then construct the set of scalars \(B = \{\text{Tr}(B A^T) \mid A \in A\}\).**
5. **P: Compute and send the commitment \(C' = g^{\sum_{j=1}^q c_j F(\alpha)}\), where \(\Omega = \prod_{j=1}^q \omega_j^{c_j}\) and \(Y = \frac{e(C' \cdot J, g)}{e(\Omega, g^\alpha)}\).**
6. **V: Compute \(C = \prod_{i=1}^r C_i^{a_i}\).**
7. **P and V: Compute \(g^T = e(g, g)\) and engage in the following zero-knowledge proof of knowledge to show that \(\log_{g^T} Y \in \gamma B\):**
   \[
   \text{PK} \left\{ (\gamma) : C' = C^\gamma \land h' = h^\gamma \land \left( \sum_{B \in B} \log_{g^T} Y = \gamma B \right) \right\}.
   \]

This latter proof can be efficiently implemented using Henry and Goldberg’s batch proofs of partial knowledge [27].

#### Lemma 1
Fix a list \(\mathbf{v}_0, \mathbf{v}_1, \ldots, \mathbf{v}_m\) of distinct vectors in \(F^r\). Then for \(\mathbf{a} \in_R \{0, \ldots, n-1\}^r\),
\[
\Pr \left( \exists i \in [1, m], \mathbf{a} \cdot \mathbf{v}_0 = \mathbf{a} \cdot \mathbf{v}_i \right) \leq \frac{m}{n},
\]
where the probability is taken over the random choices of \(\mathbf{a}\).

**Proof:**
Consider the list of distinct nonzero vectors \(\mathbf{v}'_i = \mathbf{v}_i - \mathbf{v}_0\) for \(i \in [1, m]\). Fix an index \(j' \in [1, m]\) such that \(v_{ij'} \neq 0\) and define the sum \(V_{ij'} = \sum_{j \in [1, m] - j'} a_j v_{ij}\). Now, \(\mathbf{a} \cdot \mathbf{v}'_i = 0\) is equivalent to \(a_{j'} v_{ij'} = -V_{ij'}\); hence, \(a_{j'} = -V_{ij'}/v_{ij'}\). Note that the right-hand side of this equation is independent from \(a_{j'}\); hence, because each of the possible values for \(a_{j'}\) occurs with equal probability, this happens with probability at most \(1/n\).

#### Corollary 2
Fix a matrix \(M \in F^{q \times r}\) and set of matrices \(A \subseteq F^{q \times r}\). For randomly chosen vectors \(\mathbf{a} \in_R \{0, \ldots, n-1\}^{1 \times r}\) and \(\mathbf{c} \in_R \{0, \ldots, n-1\}^{q \times 1}\), define the matrix \(B = \mathbf{c} \otimes \mathbf{a} \in F^{q \times r}\) and the set of traces \(B = \{\text{Tr}(B A^T) \mid A \in A\}\). Then
\[
\Pr \left( \text{Tr}(B M^T) \in B \mid M \in A \right) = 1,
\]
and
\[
\Pr \left( \text{Tr}(B M^T) \in B \mid M \notin A \right) \leq \frac{2|A|}{n},
\]
where both probabilities are over the random choices of \(\mathbf{a}\) and \(\mathbf{c}\).

**Proof:**
Equation (2) is immediate from the definition of \(B\). To prove Equation (3), observe that for any \(A \in A \cup \{M\}\) we can rewrite \(\text{Tr}(B \cdot A^T) = \text{Tr}(\mathbf{c} \cdot \mathbf{a} \cdot A^T) = \text{Tr}(\mathbf{a} \cdot A^T \cdot \mathbf{c}) = \mathbf{a} \cdot (A^T \cdot \mathbf{c})\), which is a dot product of two length-\(r\) vectors. We use Lemma 1 to prove
\[
\Pr \left( \exists A \in A, M^T \cdot \mathbf{c} = A^T \cdot \mathbf{c} \right) \leq \frac{|A|}{n}
\]
for \(\mathbf{c} \in_R \{0, \ldots, n-1\}^{q \times 1}\); the result then follows from another application of Lemma 1.

#### Theorem 3
The above protocol is a zero-knowledge proof that Equation (1) holds; i.e., the protocol is complete, sound (with overwhelming probability in \(\log n\)), and simulatable.

**Proof:**
To prove completeness, suppose Equation (1) holds so that \(\gamma \text{Tr}(B M^T) = \sum_{j=1}^q c_j F(j)\). If \(\omega_1, \ldots, \omega_q\) are correct witnesses for evaluations of \(F(x)\) at \(x = 1, \ldots, q\), then it is straightforward to verify that \(e(\omega_j, g^\alpha / g^j) e(g, g) F(j)\) for \(j \in [1, q]\). Thus, since \(e(C', g) = \prod_{j=1}^q e(\prod_{i=1}^r C_i^{a_i})^\gamma, g)c_j\) and \(\prod_{j=1}^q e(\omega_j, g^\alpha / g^j) e(g, g) F(j) = \prod_{j=1}^q e(\omega_j, g^\alpha / g^j) e(g, g) \sum_{j=1}^q c_j F(j)\), it follows that \(g^{\gamma \text{Tr}(B M^T)}\). Completeness follows from the completeness of the ZKP in the final step.

Soundness follows from Corollary 2 and the soundness of the zero-knowledge proof of knowledge in the final step.

Given a simulator \(S\) for the ZKPoK in the final step, constructing a simulator \(S'\) for the entire protocol is trivial; i.e., \(S'\) chooses \(C', h', \omega_1, \ldots, \omega_q\) at random, then invokes \(S\) on these (and the common) inputs.