Parameter (afp:)
Description
LL2354.book  Page 71  Monday, October 20, 2003  9:47 AM
72
Chapter 8    Working With File Services
List of AFP serveradmin Commands
In addition to the standard start, stop, status, and settings commands, you can 
use serveradmin to issue the following service-specific AFP commands.
Listing Connected Users
You can use the serveradmin getConnectedUsers command to retrieve information 
about connected AFP users. In particular, you can use this command to retrieve the 
session IDs you need to disconnect or send messages to users.
To list connected users:
$serveradmin command afp:command = getConnectedUsers
Output
The following array of settings is displayed for each connected user:
afp:usersArray:_array_index:i:disconnectID = 
afp:usersArray:_array_index:i:flags = 
afp:usersArray:_array_index:i:ipAddress = 
afp:usersArray:_array_index:i:lastUseElapsedTime = 
afp:usersArray:_array_index:i:loginElapsedTime = 
afp:usersArray:_array_index:i:minsToDisconnect = 
afp:usersArray:_array_index:i:name = 
afp:usersArray:_array_index:i:serviceType = 
afp:usersArray:_array_index:i:sessionID = 
afp:usersArray:_array_index:i:sessionType = 
afp:usersArray:_array_index:i:state = 
useAppleTalk
Don’t modify. Internal use only.
useHomeDirs
Default = no
Parameter (afp:)
Description
Command (afp:command=)
Description
cancelDisconnect
Cancel a pending user disconnect. See “Canceling a User 
Disconnect” on page 74.
disconnectUsers
Disconnect AFP users. See “Disconnecting AFP Users” on page 73.
getConnectedUsers
List settings for connected users. See “Listing Connected Users” on 
this page.
getHistory
View a periodic record of file data throughput or number of user 
connections. See “Listing AFP Service Statistics” on page 75.
getLogPaths
Display the locations of the AFP service activity and error logs.
sendMessage
Send a text message to connected AFP users. See “Sending a 
Message to AFP Users” on page 73.
syncSharePoints
Update share point information after changing settings.
writeSettings
Equivalent to the standard serveradmin settings command, 
but also returns a setting indicating whether the service needs to 
be restarted. See “Determining Whether a Service Needs to be 
Restarted” on page 19.
LL2354.book  Page 72  Monday, October 20, 2003  9:47 AM
Chapter 8    Working With File Services
73
Sending a Message to AFP Users
You can use the serveradmin sendMessage command to send a text message to 
connected AFP users. Users are specified by session ID.
To send a message:
$ sudo serveradmin command
afp:command = sendMessage
afp:message = "message-text"
afp:sessionIDsArray:_array_index:0 = sessionid1
afp:sessionIDsArray:_array_index:1 = sessionid2
afp:sessionIDsArray:_array_index:2 = sessionid3
[...]
Control-D
Disconnecting AFP Users
You can use the serveradmin disconnectUsers command to disconnect AFP users. 
Users are specified by session ID. You can specify a delay time before disconnect and a 
warning message.
To disconnect users:
$ sudo serveradmin command
afp:command = disconnectUsers
afp:message = "message-text"
afp:minutes = minutes-until
afp:sessionIDsArray:_array_index:0 = sessionid1
afp:sessionIDsArray:_array_index:1 = sessionid2
afp:sessionIDsArray:_array_index:2 = sessionid3
[...]
Control-D
Parameter
Description
message-text
The message that appears on client computers.
sessionidn
The session ID of a user you want to receive the message. To list the 
session IDs of connected users, use the getConnectedUsers 
command. See “Listing Connected Users” on page 72.
Parameter
Description
message-text
The text of a message that appears on client computers in the 
disconnect announcement dialog.
minutes-until
The number of minutes between the time the command is issued 
and the users are disconnected.
sessionidn
The session ID of a user you want to disconnect. To list the session 
IDs of connected users, use the getConnectedUsers 
command. See “Listing Connected Users” on page 72.
LL2354.book  Page 73  Monday, October 20, 2003  9:47 AM
74
Chapter 8    Working With File Services
Output
afp:command = "disconnectUsers"
afp:messageSent = ""
afp:timeStamp = ""
afp:timerID = 
afp:status = 
Canceling a User Disconnect
You can use the serveradmin cancelDisconnect command to cancel a 
disconnectUsers command. Users receive an announcement that they’re no longer 
scheduled to be disconnected.
To cancel a disconnect:
$ sudo serveradmin command
afp:command = cancelDisconnect
afp:timerID = timerID
Control-D
Output
afp:command = "cancelDisconnect"
afp:timeStamp = ""
afp:status = 
Value
Description
The message sent to users in the disconnect announcement dialog.
The time when the command was issued.
An integer that identifies this particular disconnect. You can use 
this ID with the cancelDisconnect command to cancel the 
disconnect.
A standard array of user settings for each user scheduled for 
disconnect. For a description of these settings, see “Listing 
Connected Users” on page 72.
A command status code:
0 = command successful
Parameter
Description
timerID
The integer value of the afp:timerID parameter output when 
you issued the disconnectUsers command.
You can also find this number by listing any user scheduled to be 
disconnected and looking at the value of the disconnectID 
setting for the user.
Value
Description
The time at which the command was issued.
A command status code:
0 = command successful
LL2354.book  Page 74  Monday, October 20, 2003  9:47 AM
Chapter 8    Working With File Services
75
Listing AFP Service Statistics
You can use the serveradmin getHistory command to display a log of periodic 
samples of the number of connections and the data throughput. Samples are taken 
once each minute.
To list samples:
$ sudo serveradmin command
afp:command = getHistory
afp:variant = statistic
afp:timeScale = scale
Control-D
Output
afp:nbSamples = 
afp:samplesArray:_array_index:0:vn = 
afp:samplesArray:_array_index:0:t = 
afp:samplesArray:_array_index:1:vn = 
afp:samplesArray:_array_index:1:t = 
[...]
afp:samplesArray:_array_index:i:vn = 
afp:samplesArray:_array_index:i:t = 
afp:vnLegend = ""
afp:currentServerTime = 
Parameter
Description
statistic
The value you want to display.
Valid values:
v1 - number of connected users (average during sampling period)
v2 - throughput (bytes/sec)
scale
The length of time in seconds, ending with the current time, for 
which you want to see samples. For example, to see 30 minutes of 
data, you would specify afp:timeScale = 1800.
Value displayed by getHistory
Description
The total number of samples listed.
A textual description of the selected statistic. 
"CONNECTIONS" for v1
"THROUGHPUT" for v2
The numerical value of the sample.
For connections (v1), this is integer average number of users.
For throughput, (v2), this is integer bytes per second.
The time at which the sample was measured. A standard UNIX time 
(number of seconds since Sep 1, 1970.) Samples are taken every 60 
seconds.
LL2354.book  Page 75  Monday, October 20, 2003  9:47 AM
76
Chapter 8    Working With File Services
Viewing AFP Log Files
You can use tail or any other file listing tool to view the contents of the AFP service 
logs.
To view the latest entries in a log:
$ tail log-file
You can use the serveradmin getLogPaths command to see where the current AFP 
error and activity logs are located.
To display the log paths:
$ sudo serveradmin command afp:command = getLogPaths
Output
afp:accesslog = 
afp:errorlog = 
NFS Service
Starting and Stopping NFS Service
NFS service is started automatically when a share point is exported using NFS. The NFS 
daemons that satisfy client requests continue to run until there are no more NFS 
exports and the server is restarted.
Checking NFS Service Status
To see if NFS service and related processes are running:
$ sudo serveradmin status nfs
To see complete NFS status:
$ sudo serveradmin fullstatus nfs
Viewing NFS Settings
To list all NFS service settings:
$ sudo serveradmin settings nfs
To list a particular setting:
$ sudo serveradmin settings nfs:setting
Value
Description
The location of the AFP service access log. Default = 
/Library/Logs/AppleFileService/
AppleFileServiceAccess.log
The location of the AFP service error log. Default = 
/Library/Logs/AppleFileService/
AppleFileServiceError.log
LL2354.book  Page 76  Monday, October 20, 2003  9:47 AM
Chapter 8    Working With File Services
77
Changing NFS Service Settings
Use the following parameters with the serveradmin command to change settings for 
the NFS service.
FTP Service
Starting FTP Service
To start FTP service:
$ sudo serveradmin start ftp
Stopping FTP Service
To stop FTP service:
$ sudo serveradmin stop ftp
Checking FTP Service Status
To see if FTP service is running:
$ sudo serveradmin status ftp
To see complete FTP status:
$ sudo serveradmin fullstatus ftp
Viewing FTP Settings
To list all FTP service settings:
$ sudo serveradmin settings ftp
To list a particular setting:
$ sudo serveradmin settings ftp:setting
To list a group of settings:
You can list a group of settings that have part of their names in common by typing 
only as much of the name as you want, stopping at a colon (:), and typing an asterisk 
(*) as a wildcard for the remaining parts of the name. For example,
$ sudo serveradmin settings ftp:logCommands:*
Parameter (nfs:)
Description
nbDaemons
Default = 6
To reduce the number of daemons, you must restart the server 
after changing this value.
useTCP
Default = yes
You must restart the server after changing this value.
useUDP
Default = yes
You must restart the server after changing this value. 
LL2354.book  Page 77  Monday, October 20, 2003  9:47 AM
78
Chapter 8    Working With File Services
Changing FTP Settings
You can change FTP service settings using the serveradmin application.
To change a setting:
$ sudo serveradmin settings ftp:setting = value
To change several settings:
$ sudo serveradmin settings
ftp:setting = value
ftp:setting = value
ftp:setting = value
[...]
Control-D
FTP Settings
Use the following parameters with the serveradmin command to change settings for 
the FTP service.
Parameter
Description
setting
An FTP service setting. To see a list of available settings, type
$ sudo serveradmin settings ftp
or see “FTP Settings” on this page.
value
An appropriate value for the setting.
Parameter (ftp:)
administratorEmailAddress
Default = "user@hostname"
anonymous-root
Default = "/Library/FTPServer/FTPRoot"
anonymousAccessPermitted
Default = no
authLevel 
Default = "STANDARD"
bannerMessage
Default = "This is the "Banner" 
message for the Mac OS X Server's 
FTP server process.
FTP clients will receive this 
message immediately before being 
prompted for a name and password.
PLEASE NOTE: Some FTP clients may 
exhibit problems if you make this 
file too long.
----------------------------------"
chrootType
Default = "STANDARD"
enableMacBinAndDmgAutoConversion
Default = yes
ftpRoot
Default = "/Library/FTPServer/FTPRoot"
LL2354.book  Page 78  Monday, October 20, 2003  9:47 AM
Chapter 8    Working With File Services
79
List of FTP serveradmin Commands
You can use the following commands with the serveradmin application to manage 
FTP service.
logCommands:anonymous
Default = no
logCommands:guest
Default = no
logCommands:real
Default = no
loginFailuresPermitted
Default = 3
logSecurity:anonymous
Default = no
logSecurity:guest
Default = no
logSecurity:real
Default = no
logToSyslog
Default = no
logTransfers:anonymous:inbound
Default = yes
logTransfers:anonymous:outbound
Default = yes
logTransfers:guest:inbound
Default = no
logTransfers:guest:outbound
Default = no
logTransfers:real:inbound
Default = yes
logTransfers:real:outbound
Default = yes
maxAnonymousUsers
Default = 50
maxRealUsers
Default = 50
showBannerMessage
Default = yes
showWelcomeMessage
Default = yes
welcomeMessage
Default = "This is the "Welcome" 
message for the Mac OS X Server's 
FTP server process.
FTP clients will receive this 
message right after a successful 
log in.
----------------------------------"
Parameter (ftp:)
ftp:command=
Description
getConnectedUsers
List connected users. See “Checking for Connected FTP Users” on 
page 80.
LL2354.book  Page 79  Monday, October 20, 2003  9:47 AM
80
Chapter 8    Working With File Services
Viewing the FTP Transfer Log
You can use tail or any other file listing tool to view the contents of the FTP transfer 
log.
To view the latest entries in the transfer log:
$ tail log-file
The default location of log-file is /Library/Logs/FTP.transger.log. You can use the 
serveradmin getLogPaths command to see where the current transfer log is located.
To display the log path:
$ sudo serveradmin command ftp:command = getLogPaths
Checking for Connected FTP Users
To see how many FTP users are connected:
$ ftpcount
or
$ sudo serveradmin command ftp:command = getConnectedUsers
Windows (SMB) Service
Starting and Stopping SMB Service
To start SMB service:
$ sudo serveradmin start smb
To stop SMB service:
$ sudo serveradmin stop smb
Checking SMB Service Status
To see if SMB service is running:
$ sudo serveradmin status smb
To see complete SMB status:
$ sudo serveradmin fullstatus smb
getLogPaths
Show location of the FTP transfer log file. See “Viewing the FTP 
Transfer Log” on this page.
writeSettings
Equivalent to the standard serveradmin settings command, 
but also returns a setting indicating whether the service needs to 
be restarted. See “Determining Whether a Service Needs to be 
Restarted” on page 19.
ftp:command=
Description
LL2354.book  Page 80  Monday, October 20, 2003  9:47 AM
Chapter 8    Working With File Services
81
Viewing SMB Settings
To list all SMB service settings:
$ sudo serveradmin settings smb
To list a particular setting:
$ sudo serveradmin settings smb:setting
To list a group of settings:
You can list a group of settings that have part of their names in common  by typing 
only as much of the name as you want, stopping at a colon (:), and typing an asterisk 
(*) as a wildcard for the remaining parts of the name. For example,
$ sudo serveradmin settings smb:adminCommands:*
Changing SMB Settings
You can change SMB service settings using the serveradmin command.
To change a setting:
$ sudo serveradmin settings smb:setting = value
To change several settings:
$ sudo serveradmin settings
smb:setting = value
smb:setting = value
smb:setting = value
[...]
Control-D
Parameter
Description
setting
An SMB service setting. To see a list of available settings, type
$ sudo serveradmin settings smb
or see “List of SMB Service Settings” on page 82.
Parameter
Description
setting
An SMB service setting. To see a list of available settings, type
$ sudo serveradmin settings smb
or see “List of SMB Service Settings” on page 82.
value
An appropriate value for the setting. For a list of values that 
correspond to GUI controls in the Server Admin application, see 
“List of SMB Service Settings” on page 82.
LL2354.book  Page 81  Monday, October 20, 2003  9:47 AM
82
Chapter 8    Working With File Services
List of SMB Service Settings
Use the following parameters with the serveradmin command to change settings for 
the SMB service.
Parameter (smb:)
Description
adminCommands:homes
Whether home directories are mounted automatically when 
Windows users log in so you don’t have to set up individual 
share points for each user. Can be set to:
yes | no
Corresponds to the “Enable virtual share points” checkbox in 
the Advanced pane of Window service settings in the Server 