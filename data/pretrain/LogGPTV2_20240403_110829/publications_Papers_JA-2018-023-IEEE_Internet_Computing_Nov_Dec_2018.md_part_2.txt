i, j i j
ConsiderthematrixfromFigure4.IfU5fails,thenbasedontherelationshipsservice ,service ,
2 3
service ,andservice couldbedown.However,ifU5passes,itmeansthatservice ,service ,service ,
4 5 2 3 4
andservice areavailable.
5
IsomorphicUnitTestElimination
AsshowninFigure4,eachTempesttestcanberepresentedwithabinarystring.Forexample,U1is
representedas10101,U2as00010,etc.Tempestteststhathavethesamestringarecalledisomorphic
tests.Theyestablishthesamerelationshipswithservicesanddetectfailuresofsameservices.
Therefore,theyareredundant.Inordertoeliminatethem,allisomorphictestsaregroupedtogetherand
theonewiththelowerexecutiontimeisselected.
Inourexperiment,therewere18servicesrunningand518TempesttestsafterreductionfromPhase1.
AttheendofPhase2,theisomorphictesteliminationprocedurereducedthenumberofteststo19.
Phase 3: Failure Detection
ThisphaseanalyzestherelationshipsestablishedinPhase2byconstructingadecisiontreeandusing
thetreetodetectfailedservice(s).EachinternalnoderepresentsaTempesttestselectedinPhase2.
Eachbranchrepresentstheresultofthetestandeachleafrepresentsaservicewhichisinfailedstateor
insomecases,itrepresentsasetoffailedservices.
Inourexperiment,weusedthesequentialfaultdiagnosis14toconstructadecisiontree.Inthis
approach,atestcansplitthestateofasystemintotwosubsets.LetAdenotethesetofcandidate
systemstateswhenatestfailsandBthesetofcandidatesystemstateswhenthetestpasses.Fora
symmetricaltest:A\B¼;.
Thetest-sequencingproblemhasbeendefinedbyPattipatiandAlexandridis15bytuple(S,p,T,c),
where
S¼{s ,s ,...,s }finitesetofsystemstateswiths denotingthefaultfreestateofthesystem
0 1 m 0
ands (1<¼i<¼m)specifyingthedifferentfaultystatesofthesystem;
i
November/December2018 66 www.computer.org/internet
VIEWFROMTHECLOUD
Figure5. Decisiontree.Thefigureshowsthedecisiontreegeneratedfromtherelationshipderivedin
Phase2.
p¼[p(s ),p(s ),...,p(s )]aprioriprobabilityvectorofthesystemstate;
0 1 m
T¼{t ,t ,...,t }finitesetofnavailabletests;
1 2 n
c¼[c ,c ,...,c ]vectoroftestcostsmeasuredintermsoftime,manpowerorothereconomic
1 2 n
factors;
testmatrixDdescribingdiagnosticcapabilitiesoftestsT.Thisistherelationshipestablishedin
Phase2(seeFigure4).
Thetest-sequencingproblemfallsunderthecategoryofaMarkovdecisionproblem.TheMarkovstate
xdenotesthesuspectsetofsystemstate,whichisasubsetofS.Eachstatehasacorrespondingtestto
furtherdividethisstateintotwosubsetsofstates.Thisisrepeatedtillthestatecannotbefurther
divided.Figure5showsthedecisiontreegeneratedinourexperiment.
A test corresponding to a Markov state is executed. The result of the test splits the Markov state
(also known as ambiguity set) into two subsets, thereby reducing the ambiguity. As per the
convention, the left branch corresponds to the passed test and the right branch corresponds to
the failed test. The root node represents the state of complete ambiguity and the leaf node
represents one of the failed states.
InFigure5,therootnodecontainingtestt correspondstotheMarkovstatexcontainingallthestates
3
ofS.Theexecutionoft dividesthesystemintotwoMarkovstatesx andx ,therebyreducingthe
3 jp jf
ambiguitybasedontheresultoft .TheMarkovstatex denotesthestates{S0,S3,S5,S10,S11,
3 jp
S12}andx denotes{S1,S2,S4,S6,S7,S8,S9,S13,S14,S15,S16,S17,S18}.TheseMarkov
jf
statesarefurtherdividedtillnomoredivisionsarepossible.
Ateachnode,thetestisselectedbasedonthedistinguishabilityheuristicdefinedbythefollowing
expression[Eq.1],whichisgivenbyPattipatiandAlexandridis15:
d x;t ¼p x :p x (1)
c j jp jf
wherex andx aretheMarkovstatesofthepassandfailoutcomesoftestt suchthat
jp jf j
x [x ¼xandp(x ),p(x )aretheconditionalprobabilitiesofthepassandfailoutcomesof
jp jf jp jf
testt,respectively.Furthermore,p(x )[Eq.2] andp(x )[Eq. 3]areexpressedasfollows,
j jp jf
whicharegivenbyCuietal.11:
  hX   i
p x ¼ : 1d :pðs iÞ :½p^ðxÞ1 (2)
jp ij
si2x
    X
:
p x ¼1p x ;p^ðxÞ¼ pðs iÞ: (3)
if jp
si2x
November/December2018 67 www.computer.org/internet
IEEEINTERNETCOMPUTING
Thetestt thatmaximizesd(x,t)/cost,wherecostistheexecutiontimeofthetestt isselected.
j c j j
Figure5showstheconstructeddecisiontree.Letusdiagnoseasystemwithadefectiveservices .
13
Thediagnosisstartswiththerootnodecontainingthetestt .Ifthetestt fails,therightbranchofthe
3 3
treeisfollowedandthetestt isexecuted.Ifthetestt passes,theleftbranchistraversedandthetestt
5 5 8
isexecuted.Similarly,ift passes,thetestt isexecuted.Theexecutionofthetestt woulddetermine
8 6 6
thefaultyservice.Ifthetestt passes,itwouldleadustotheleafnodecontainingthefaultyservices .
6 13
Wehad19TempesttestsafterPhase2and18servicesrunninginourOpenStackcloud.Intheworst
case,thesolutionwasabletodetectthefaultyserviceafterexecutingfiveTempesttests.
EVALUATION
TheevaluationofthemethodwascarriedoutinOpenStackMitakawithamultinodesetup.Inmore
recentexperiments,werelyonOpenStackRallytoschedule,orchestrate,andreplicatefailure
diagnosisexperimentsforevaluationinacontrolledanddeterministicmanner.TheOpenStack
configurationwasthefollowing.
 1Controllernode(8GB,IntelXeonE5-2600,4cores).
 1Networknode(4GB,IntelXeonE5-2600,4cores).
 2Computenodes(8GB,IntelXeonE5-2600,4cores).
ToevaluatePhase1,eightmodulesfromdifferentcomponentsoftheTempestframeworkwere
randomlychosenandthereductionofthetestswasperformedmanually.Theresultswerethen
comparedwiththeonesproducedbythesolution.Thereductionperformedautomaticallymatchedthe
reductionperformedmanually.
ToevaluatePhase2,weranthealgorithmtoestablishrelationshipsbetweenTempesttestsand
services.Weestablishedtherelationshipbetween518testsand18servicesrunning.Isomorphictest
eliminationreducedthenumberofteststo19.Therelationshipswereevaluatedandwerecorrect.An
importantaspecttoconsideristhattheestablishmentofrelationshipsmustbecarriedoutinavalid
OpenStacksetup.Testscanfailforvariousreasons,suchastimeouts,networkcongestion,insufficient
memory,storageissues,etc.Theseproblemscanresultintheestablishmentofincorrectrelationships.
Hence,toeliminatefalsepositives,testswererunmultipletimestomakesurethattherelationships
wereaccurate.Therefore,thetestswererunfourtimestoestablishaccurateresults.
ToevaluatePhase3,thedecisiontreewasvalidatedbyconductingfailurediagnosisindifferent
scenarios.Servicesweremanuallydisabledtosimulatefailuresintheproductionenvironment.The
methodwasabletopredictallservicefailures.
Incaseacloudplatformisheavilyloaded,displaysinsufficientcapacity,anddropsservicerequests
thatcannotbehandled,ourapproachwillsignaltheserequestsasservicefailures.Thisdesigndecision
reflectsthefactthatcustomersperceiveaservicetobeunavailableasafailure.
Thereisanotherinterestingpracticalevaluationworthdiscussingthathighlightstheusefulnessofthe
methodproposed.OneofourOpenStackcloudwasdeployedinanetworksharedwiththeother
deploymentsresultinginIPconflicts.ThevirtualmachinescreatedbyOpenStackwereconfigured
withanIPusedbyanotherdeployment.ThetoolsthataremadeavailablebytheOpenStack
communitywerenothelpfultodiagnosetherootcauseoftheproblemastheyshowedthattheNeutron
servicewasrunningwithoutproblemsandtherewereenoughIPsavailable.Moreover,Tempesttests
alsodidnotprovetobehelpfulasmanytestsbelongingtodifferentcomponentsfailedbecauseofthe
underlyingproblem.However,ourmethodcorrectlydiagnosedthatthecomponentresponsibleforthe
problemwasNeutron.
The cost of each of the phases is also very reasonable. As an example, for the models that we
have reconstructed for OpenStack releases, the total time taken to run all the 1392 Tempest tests
was approx. 175 min. After the first phase, the number of tests was reduced to 518, which took
approx. 75 min to execute. The application of the model needs only to execute five to six tests
to detect a service failure, which typically takes less than 2 min to complete.
November/December2018 68 www.computer.org/internet
VIEWFROMTHECLOUD
Whileourapproachisintrusive,ourexperimentsshowthatatmostsixtestsoutofthe19testsleftafter
eliminatingtheisomorphictestsareneededtodetectaservicefailure.Theaveragelatencyofthe19
testsis16.55s(SD7.59).Furthermore,ifwepayattentiontoallthepathsfromtheroottotheleavesof
thedecisiontreetodiagnosefailures,themostexpensivepathtakesapprox.80storunallthetests.
Thus,thecostisacceptableaswellastheimpactonthecloudplatform.
CONCLUSION
Thisresearchdemonstratedtheuseofanewmethodforusingautomatedtestsforservicefailure
diagnosis.ThemethodassistscloudadministratorstodiagnosefailuresinOpenStackwithin4–5min.
Nevertheless,thereisroomforfutureresearch.Therelationshipsbetweenthetestsandserviceswere
establishedbycompletelydisablingservices,butitisworthlookingintoscenarioswhereservicesare
notcompletelydisablebutrathertosimulatesituationsunderwhichservicesarerunningwithlimited
bandwidth,memory,orstoragecapacity.Moreover,tofurtherimprovefailurediagnosis,logand
controlflowgraphanalysistechniquescanbeincorporatedtoreconstructtheunderlyingdistributed
systemtopologytonarrowthestate-spacesearchforservicesthathavefailed.
REFERENCES
1. (2016).[Online].Available:https://www.openstack.org
2. A.Avizienis,J.C.Laprie,andB.Randell,“Dependabilityanditsthreats:Ataxonomy,”in
Proc.BuildingInf.Soc.,Springer,vol.22,2004,pp.91–120.
3. (2016).[Online].Available:https://wiki.openstack.org/wiki/Operations/Tools
4. K.SrinivasandR.B.Michael“Methodsforfaultdetection,diagnostics,andprognosticsfor
buildingsystems—Areview,partI,”HVAC&RRes.,vol.11,2005.
5. T.Jia,P.Chen,L.Yang,Y.Li,F.Meng,andJ.Xu,“Anapproachforanomalydiagnosis
basedonhybridgraphmodelwithlogsfordistributedservices,”inProc.IEEEInt.Conf.
WebServices,Honolulu,HI,USA,2017,pp.25–32.
6. M.Peiris,J.H.Hill,J.Thelin,S.Bykov,G.Kliot,andC.Konig,“PAD:Performance
anomalydetectioninmulti-serverdistributedsystems,”inProc.7thInt.Conf.Cloud
Computing,2014,pp.769–776.
7. B.Sigelmanetal.,“Dapper,alarge-scaledistributedsystemstracinginfrastructure,”
Google,MountainView,CA,USA,2010.
8. P.Musavi,B.Adams,andF.Khomh,“Experiencereport:AnempiricalstudyofAPIfailures
inOpenStackcloudenvironments,”inProc.IEEE27thInt.Symp.Softw.Rel.Eng.,2016,
pp.424–434.
9. T.YoshinobuandY.Shigeru,“Practicalreliabilityandmaintainabilityanalysistoolforan
opensourcecloudcomputing,”Qual.Rel.Eng.Int.,vol.32,pp.909–920,2016.
10. P.Cuongetal.,“Failurediagnosisfordistributedsystemsusingtargetedfaultinjection,”
IEEETrans.ParallelDistrib.Syst.,vol.28,no.60,pp.503–516,Feb.2017.
11. C.Baojiangetal.,“Codecomparisonsystembasedonabstractsyntaxtree,”inProc.3rd
IEEEInt.Conf.BroadbandNetw.MultimediaTechnol.,2010,pp.668–673.
12. R.Juan,“UsingTF-IDFtodeterminewordrelevanceindocumentqueries,”inProc.1st
InstructionalConf.Mach.Learn.,section2.1,p.2,2003.
13. P.Slavík,“Atightanalysisofthegreedyalgorithmforsetcover,”inProc.28thAnnu.ACM
Symp.TheoryComput.,1996,pp.435–441.
14. Z .Alenka,A.Biasizzo,andF.Novak,“Sequentialdiagnosistool,”Microprocessors
Microsyst.,vol.24,pp.191–197,2000.
15. K.R.PattipatiandM.G.Alexandridis,“Applicationofheuristicsearchandinformation
theorytosequentialfaultdiagnosis,”IEEETrans.Syst.,Man,Cybern.,vol.20,no.4,
pp.872–887,Jul./Aug.1990.
November/December2018 69 www.computer.org/internet
IEEEINTERNETCOMPUTING
ABOUT THE AUTHORS
AnkurBhatiaiscurrentlyworkingtowardtheM.Sc.degreeininformaticsatthe
TechnicalUniversityofMunich,Munich,Germany.Hisresearchinterestsinclude
cloudcomputingandInternetofThings.HereceivedtheB.Techdegreeincomputer
sciencefromtheManipalInstituteofTechnology,Manipal,India.Contacthimat
ankur.bhatia@tum.de.
JorgeCardosoisachiefarchitectforCloudOperationsandAnalyticsatHuawei’s
GermanResearchCentre,Munich,Germany,andanassociateprofessoratthe
UniversityofCoimbra,Coimbra,Portugal.Hisresearchinterestsincludeintelligentcloud
operations,cloudcomputing,distributedsystems,andbusinessprocessmanagement.
HereceivedthePh.D.degreeincomputersciencefromtheUniversityofGeorgia,
Athens,GA,USA.Contacthimatjorge.cardoso@huawei.com.
MichaelGerndthasbeenaprofessorforparallelcomputerarchitectureattheTechnical
UniversityofMunich,Munich,Germany,since2000.Heisfocusingofperformance
analysisandtuningtoolsforHPCsystems.Furtherresearchfocusesonparallel
programminglanguagesandCloudsystems.Contacthimatgerndt@in.tum.de.
November/December2018 70 www.computer.org/internet