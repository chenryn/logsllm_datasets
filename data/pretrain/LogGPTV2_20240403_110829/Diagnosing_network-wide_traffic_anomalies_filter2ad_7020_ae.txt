r
F
120
100
80
60
40
20
0
0.1
0.2
0.3
0.4
0.5
0.6
Detection Rate
0.7
0.8
0.9
1
60
50
40
30
y
c
n
e
u
q
e
r
F
20
10
0
0.1
0.2
0.3
0.4
Detection Rate
0.5
0.6
0.7
0.8
0.9
(a) Large Injected Spike
(b) Small Injected Spike
Figure 7: Detection rate histograms from injecting synthetic
spikes (Sprint-1).
are computed over time) against the mean OD ﬂow rate for the
large injections for Sprint-1. This plot shows that for a ﬁxed size
anomaly, the method tends to detect the injections on the smaller
OD ﬂows better than on larger OD ﬂows. There are two reasons
for this. First, the larger variance OD ﬂows are likely better aligned
with S, as explained in Section 5.4. Second, an inserted spike can
be canceled out by a large negative spike in the OD ﬂow, an effect
more likely to occur on a high variance OD ﬂow.
Corresponding experiments for Abilene and for identiﬁcation
and quantiﬁcation yield similar results. Summary results from all
these experiments for both Sprint-1 and Abilene are presented in
Table 3. The ﬁrst two rows quantify the method’s ability to diag-
nose large injections, and shows very good detection, identiﬁcation
and quantiﬁcation rates. The next two rows capture the method’s
ability to avoid the small injected spikes, representing false anoma-
lies. These results show that regardless of the underlying network,
OD ﬂow and the time of the injected spike, the subspace method is
able to diagnose the volume anomaly with high accuracy and low
false alarm rates.
7. DISCUSSION
In this section we consider issues related to deployment of the
subspace method and its potential extensions.
7.1 Computational Complexity
Since the subspace method operates on link measurements, it
imposes relatively low cost in data collection. We envision that
the method may therefore be used as a ﬁrst-level online monitor-
ing tool, capable of raising an alarm and directing attention to par-
ticular OD ﬂows as the focus of attention. The diagnosis of an
anomaly may then trigger sophisticated, ﬁne-scale (but more ex-
pensive) measurements to further isolate the cause of the anomaly.
To be used in this manner, the method must impose low compu-
tational demand. Computing all the principal components of link
trafﬁc Y is in fact equivalent to solving the symmetric eigenvalue
problem for the covariance matrix, YTY. The standard proce-
dure for this relies on computing the singular value decomposition
(SVD) of Y. The computation complexity of a complete SVD of
a t × m matrix is O(tm2) [9]. However, the computation is typi-
cally not expensive for reasonable-sized datasets. For our 1008 ×
49 matrices the computation requires less than two seconds on a
1.0 GHz Intel-based laptop.
To apply the subspace method online, one processes each arrival
of new trafﬁc measurements using the matrix PPT , which is de-
rived from the SVD. Previous work has shown that (for OD ﬂows)
this matrix can be reasonably stable from week to week [16]. Thus
one need only compute the SVD occasionally, rather than at each
timestep.
Finally, it is conceivable that the straightforward SVD procedure
could become a bottleneck if applied to data with a larger set of
sources and destinations, e.g., IP-level ﬂow data. However, such
cases may still be manageable using one of the methods that ex-
ist for updating previously computed decompositions as new data
arrives [20].
7.2 Extensions
There are a number of ways in which the work described in this
paper can be extended.
The choice made here to identify only single-ﬂow anomalies is in
fact somewhat arbitrary. An important generalization is to the case
in which an anomaly involves multiple ﬂows having different trafﬁc
intensities. This can occur when an anomaly involves multiple OD
ﬂows, when it arises from routing changes, or when it arises from
network abuse (e.g, DDoS attacks). To handle this case, we may
proceed as follows (see also [5]). We replace θi with a matrix Θi
having as many columns as there are ﬂows that participate in the
anomaly; each column of Θi consists of the (normalized) column
of A corresponding to a participating ﬂow. We then replace fi with
a vector fi which will capture the intensity of the anomaly in each
ﬂow. The identiﬁcation algorithms remain the same (in particular,
Equation (1) is unchanged).
It is also possible to consider applying the subspace method to
other metrics on links for which the (cid:26)2 norm is an appropriate mea-
sure. For example, we may choose to look at the number of IP ﬂows
passing over a link, or the average packet size. We believe that the
method we have outlined in this paper is applicable to such met-
rics as well. In [15], we extend the subspace method to diagnose
anomalies in a broader variety of trafﬁc data.
7.3 Alternate Basis Sets for Y
Seen in a general light, the subspace method constructs an al-
ternate basis set for representing link measurements that makes the
separation of “normal” and “anomalous” conditions easier. It does
so by making use of spatial correlation (correlation across links) in
network measurements.
The same general strategy of seeking a useful alternate basis set
for data representation lies behind previous approaches to anomaly
detection as well [1, 2, 14]. However, these previous approaches
have made use of correlation in the temporal domain – for example,
using the wavelet transform, or using exponential smoothing.
However it is reasonable to ask how temporal correlation com-
pares to spatial correlation as a tool for constructing such alternate
basis sets in the multivariate case. This is an especially appropriate
question since we made use of time-domain methods in construct-
ing our “true” anomalies in Section 6.2.
For example, one method we used for constructing “true” anoma-
lies was extracting the periodicity of OD ﬂows (especially daily
variation) from each OD ﬂow using frequency-domain ﬁltering via
Fourier analysis. Since each link’s trafﬁc is a linear combination
of trafﬁc in all ﬂows, we might consider that the same frequencies
ﬁltered from each link timeseries might yield good results for de-
tecting anomalies in link data.
While a detailed exploration of this issue is beyond our scope,
we contrast here the results of extracting “normal” link behavior
via frequency-domain ﬁltering, exponential smoothing, and sub-
space separation. To do this, we apply to each timeseries of link
data the same Fourier-based ﬁltering and EWMA smoothing that
we applied to ﬂow data in Section 6.2. In each case, this allows
the separation of link measurements y into modeled and residual
components. We then plot the squared norm of the residual vector
as a function of time. These plots are shown in Figure 9. In this
ﬁgure, the upper plot (showing the subspace method results) is the
same as the lower plot in Figure 4(a).
The ﬁgure shows that the anomaly detection problem is much
easier using the subspace method than using the EWMA and Fourier-
based methods. In the case of the subspace method, it is possible
to ﬁnd a threshold such that all anomalies appear above the thresh-
old, while very few normal data points appear above the threshold –
3
2
1
r
o
t
c
e
V
l
i
a
u
d
s
e
R
3
2
1
l
i
a
u
d
s
e
R
−
r
e
i
r
u
o
F
l
i
a
u
d
s
e
R
−
A
M
W
E
2
1
0
x 1015
Mon
Tue
Wed
Thu
Fri
Sat
Sun
x 1015
Mon
x 1015
Tue
Wed
Thu
Fri
Sat
Sun
Mon
Tue
Wed
Thu
Fri
Sat
Sun
Figure 9: Comparing squared magnitude of Subspace, Fourier
and EWMA residual vectors.
in other words, achieving high detection probability and low false
alarm rate. The EWMA and Fourier methods are quite different;
the anomalous data points do not stand sharply out from the nor-
mal data, and there is no threshold having high detection probabil-
ity that does not also have high false alarm rate.
It is also striking that noticeable periodic behavior remains, even
when the most signiﬁcant frequencies are removed. This shows that
periodic behavior in network trafﬁc can be rather complex and dif-
ﬁcult to model using only a small set of frequencies. The subspace
method avoids this difﬁculty by not being restricted to a ﬁxed set
or number of frequencies. Quite complex behavior can be captured
in the ﬁrst few principal components, as shown in Figure 3(a).
Finally, it is important to note that temporal and spatial correla-
tion are both valuable sources of predictability in network trafﬁc,
and there is room for methods that attempt to exploit both simul-
taneously. In particular, it is possible to use the subspace method
across multiple time scales by applying PCA to the wavelet trans-
form of measured data [19]. In principle, such a method can allow
the detection of anomalies at all timescales.
8. RELATED WORK
A number of techniques have been proposed to detect anomalies
in trafﬁc volume. Some examples include [1, 2, 7, 14, 21]. As dis-
cussed in Section 7, all these schemes operate on single-timeseries
trafﬁc, measured for example from a network link, and indepen-
dent of trafﬁc on other links in a network. Thus, these techniques
exploit temporal patterns within a single trafﬁc timeseries to expose
anomalies. In contrast, our scheme exploits correlation properties
across links to detect network-wide anomalies.
Another distinguishing feature of our approach is that it does not
require detailed modeling assumptions about the underlying nor-
mal trafﬁc behavior. Previous methods have principally relied on
timeseries models to approximate normal trafﬁc [2, 10, 14] or have
relied on building models of the data during a training period [24].
For example, the commonly used Holt-Winters algorithm builds
a model for normal trafﬁc based on parameter settings and a pri-
ori knowledge of the periodic structure in trafﬁc. In contrast, our
scheme does not rely on any parameter settings and normal trafﬁc
behavior is captured directly in the data, by extracting the common
features across all links.
Isolating faults in networks (which is a more general problem
than trafﬁc anomaly detection) has also attracted some attention in
the past. A review of research in this area is [17]; noteworthy ex-
amples include [10] and [13]. The approach of [10] relies on an
autoregressive (AR) model of signals, coupled with Bayes nets for
detecting faults, but no signiﬁcant validation is given. The meth-
ods of [13] rely on an exhaustive analysis of how faults might be
detected through a variety of matching algorithms. Once a fault is
found, the best explanation for it is obtained by relying on heuris-
tics, some of which are unsubstantiated. In contrast, our approach
is more systematic, relying on statistical tools; it requires no mod-
eling assumptions, and has been successful validated on data from
two modern backbone networks.
The problem of identiﬁcation in our anomaly diagnosis frame-
work bears resemblance to the problem of trafﬁc matrix estima-
tion as formulated in [23]. However, trafﬁc matrix estimation is
concerned with the problem of estimating all underlying OD ﬂow
intensities from link data, which is a much harder problem. As a
result, most trafﬁc matrix estimation work to date has concentrated
on estimating mean values of large ﬂows [18, 25]. In contrast, our
work addresses estimation of anomalous values occurring in any
ﬂow.
The authors in [4] study a problem similar to the volume anomaly
diagnosis problem and propose a solution method based on Bayesian
models of anomaly events, but no evaluation is given.
Finally, as has been noted earlier in the paper, our methodology
draws strongly on techniques from subspace-based fault diagnosis,
such as those used in chemical engineering [5, 6]. Those methods
exploit correlation patterns among state variables in an industrial
process control setting, whereas we focus on covariance patterns
across link trafﬁc timeseries.
9. CONCLUSIONS
In this paper we have proposed an approach called the subspace
method to diagnose network-wide trafﬁc anomalies. The method
can detect, identify and quantify trafﬁc anomalies. The subspace
method uses Principal Component Analysis to separate network
trafﬁc into a normal component that is dominated by predictable
trafﬁc, and an anomalous component which is more noisy and con-
tains the signiﬁcant trafﬁc spikes.
We evaluate the method on volume anomalies, which are a spe-
ciﬁc instance of network-wide trafﬁc anomalies resulting from un-
usual changes in the trafﬁc of an OD ﬂow. We showed how to use
our method to diagnose volume anomalies from simple and read-
ily available link measurements. We quantiﬁed the efﬁcacy of our
approach on OD ﬂow data collected from two backbone networks,
and showed that the subspace method can successfully diagnose
volume anomalies with high detection rate and small false alarm
rate.
Although the evaluation in this paper is in terms of volume anoma-
lies, the subspace method is not speciﬁc to them. The strength of
the method lies in its use of correlations in timeseries data from
multiple links. This allows it to treat diagnosis of network-wide
trafﬁc anomalies as a spatial problem. Such an approach can there-
fore be extended to other types of network-wide data, and thus other
types of network-wide anomalies.
Our ongoing work is centered on extending the methodology
proposed here to diagnose additional network-wide anomalies, in-
cluding routing related anomalies. Once effective mechanisms for
diagnosing anomalies are built, we can begin to understand the
causes of the anomalies. Finally, we plan to incorporate these algo-
rithms in a toolset that can be used by network operators to better
diagnose, understand and ultimately prevent network-wide anoma-
lies.
10. ACKNOWLEDGEMENTS
We are grateful to Rick Summerhill, Mark Fullmer (Internet 2),
Matthew Davy (Indiana University) for helping us collect and un-
derstand the ﬂow measurements from Abilene, and to Bjorn Carls-
son, Jeff Loughridge (SprintLink) and Richard Gass (Sprint ATL)
for instrumenting and collecting the Sprint NetFlow measurements.
We also thank Tim Grifﬁn and Gianluca Iannaccone for feedback
on early drafts. Finally, we are grateful to Eric Kolaczyk for many
helpful discussions, and for clarifying the issues behind the discus-
sion in Section 7.3.
11. REFERENCES
[1] P. Barford, J. Kline, D. Plonka, and A. Ron. A Signal Analysis of Network
Trafﬁc Anomalies. In Internet Measurement Workshop, 2002.
[2] J. Brutlag. Aberrant Behavior Detection in Timeseries for Network Monitoring.
In USENIX Fourteenth Systems Administration Conference (LISA), 2000.
[3] NetFlow. At www.cisco.com/warp/public/732/Tech/netflow/.
[4] D. Donoho and G. Flesia and N. El-Karoui and M. Elad. Inferring Sparse
Causes for Extreme Network Events. In Network Modeling and Simulation
Workshop at Dartmouth College, 2002.
[5] R. Dunia and S. J. Qin. Multi-dimensional Fault Diagnosis Using a Subspace
Approach. In American Control Conference, 1997.
[6] R. Dunia and S. J. Qin. A Subspace Approach to Multidimensional Fault
Identiﬁcation and Reconstruction. American Institute of Chemical Engineers
(AIChE) Journal, pages 1813–1831, 1998.
[7] F. Feather, D. Siewiorek, and R. Maxion. Fault Detection in an Ethernet
Network Using Anomaly Signature Matching. In ACM SIGCOMM, 1993.
[8] A. Feldmann, A. Greenberg, C. Lund, N. Reingold, J. Rexford, and F. True.
Deriving Trafﬁc Demands for Operational IP networks: Methodology and
Experience. In IEEE/ACM Transactions on Neworking, 2001.
[9] G. Golub and C. F. V. Loan. Matrix Computations. The Johns Hopkins
University Press.
[10] C. Hood and C. Ji. Proactive Network Fault Detection. In IEEE INFOCOM,
1997.
[11] J. E. Jackson and G. S. Mudholkar. Control Procedures for Residuals
Associated with Principal Component Analysis. Technometrics, pages 341–349,
1979.
[12] D. R. Jensen and H. Solomon. A Gaussian Approximation to the Distribution of
a Deﬁnite Quadratic Form. J. of the American Statistical Association, pages
898–902, 1972.
[13] I. Katzela and M. Schwartz. Fault Identiﬁcation Schemes in Communication
Networks. In IEEE/ACM Transactions on Neworking, December 1995.
[14] B. Krishnamurthy, S. Sen, Y. Zhang, and Y. Chen. Sketch-based Change
Detection: Methods, Evaluation, and Applications. In Internet Measurement
Conference, 2003.
[15] A. Lakhina, M. Crovella, and C. Diot. Characterization of Network-Wide
Anomalies in Trafﬁc Flows. Technical Report BUCS-2004-020, Boston
University, 2004.
[16] A. Lakhina, K. Papagiannaki, M. Crovella, C. Diot, E. D. Kolaczyk, and N. Taft.
Structural Analysis of Network Trafﬁc Flows. In ACM SIGMETRICS, 2004.
[17] A. A. Lazar, W. Wang, and R. Deng. Models and Algorithms for Network Fault
Detection and Identiﬁcation: A Review. In ICC, 1992.
[18] A. Medina, N. Taft, K. Salamatian, S. Bhattacharyya, and C. Diot. Trafﬁc
Matrix Estimation: Existing Techniques and New Directions. In ACM
SIGCOMM, 2002.
[19] M. Misra, H. H. Yue, S. J. Qin, and C. Ling. Multivariate Process Monitoring
and Fault Diagnosis by Multi-scale PCA. Computers and Chemical
Engineering, pages 1281–1293, 2002.
[20] M. Moonen, P. Dooren, and J. Vandewalle. A Singular Value Decomposition
Updating Algorithm for Subspace Tracking. SIAM J. Matrix Anal. Appl., pages
1015–1038, 1992.
[21] M. Roughan, T. Grifﬁn, M. Mao, A. Greenberg, and B. Freeman. Combining
Routing and Trafﬁc Data for Detection of IP Forwarding Anomalies (Poster). In
ACM SIGMETRICS, 2004.
[22] Juniper Trafﬁc Sampling. At
www.juniper.net/techpubs/software/junos/junos60/
swconfig60-policy/html/sampling-overview.html.
[23] Y. Vardi. Network Tomography: Estimating Source-Destination Trafﬁc
Intensities from Link Data. J. of the American Statistical Association, pages
365–377, 1996.
[24] N. Ye. A Markov Chain Model of Temporal Behavior for Anomaly Detection.
In Workshop on Information Assurance and Security, 2000.
[25] Y. Zhang, M. Roughan, C. Lund, and D. Donoho. An Information-Theoretic
Approach to Trafﬁc Matrix Estimation. In ACM SIGCOMM, 2003.