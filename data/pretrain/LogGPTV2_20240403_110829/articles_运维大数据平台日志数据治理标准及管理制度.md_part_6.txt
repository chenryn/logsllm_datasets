|     |          |            |         |     | ，举例：80100180000  |   |
+-----+----------+------------+---------+-----+----------------------+---+
| 4   | 组件     | component  | comid   | 必  | 联盟统               |   |
|     | 实例编号 | id         |         | 填  | 一规划的组件实例编号 |   |
+-----+----------+------------+---------+-----+----------------------+---+
| 5   | 全局统   | global     | gtn     | 必  | 详见《交易路径跟踪   |   |
|     | 一流水号 | trace      |         | 填  | 全局统一流水号规范》 |   |
|     |          | number     |         |     |                      |   |
+-----+----------+------------+---------+-----+----------------------+---+
| 6   | 业       | trade      | tsn     | 可  |                      |   |
|     | 务流水号 | serial     |         | 空  |                      |   |
|     |          | number     |         |     |                      |   |
+-----+----------+------------+---------+-----+----------------------+---+
| 7   | 成       | bank id    | bid     | 可  | 5位成员行编号        |   |
|     | 员行编号 |            |         | 空  |                      |   |
+-----+----------+------------+---------+-----+----------------------+---+
| 8   | 会话编号 | session id | sid     | 可  | session id           |   |
|     |          |            |         | 空  |                      |   |
+-----+----------+------------+---------+-----+----------------------+---+
| 9   | 交易时间 | trade time | tt      | 可  |                      |   |
|     |          |            |         | 空  |                      |   |
+-----+----------+------------+---------+-----+----------------------+---+
| 10  | 交易代码 | trade code | tc      | 可  |                      |   |
|     |          |            |         | 空  |                      |   |
+-----+----------+------------+---------+-----+----------------------+---+
| 11  | 交易名称 | trade name | tn      | 可  |                      |   |
|     |          |            |         | 空  |                      |   |
+-----+----------+------------+---------+-----+----------------------+---+
| 12  | 交易机构 | trade      | ta      | 可  |                      |   |
|     |          | agency     |         | 空  |                      |   |
+-----+----------+------------+---------+-----+----------------------+---+
| 13  | 柜员编号 | teller id  | tid     | 可  |                      |   |
|     |          |            |         | 空  |                      |   |
+-----+----------+------------+---------+-----+----------------------+---+
| 14  | 交易金额 | amount of  | am      | 可  |                      |   |
|     |          | money      |         | 空  |                      |   |
+-----+----------+------------+---------+-----+----------------------+---+
| 15  | 客户号   | customer   | cid     | 可  |                      |   |
|     |          | id         |         | 空  |                      |   |
+-----+----------+------------+---------+-----+----------------------+---+
| 16  | 手机号码 | mobile     | mn      | 可  |                      |   |
|     |          | number     |         | 空  |                      |   |
+-----+----------+------------+---------+-----+----------------------+---+
| 17  | 客户     | customer   | cip     | 可  |                      |   |
|     | 端IP地址 | ip         |         | 空  |                      |   |
+-----+----------+------------+---------+-----+----------------------+---+
| 18  | 账号     | account    | an      | 可  |                      |   |
|     |          | number     |         | 空  |                      |   |
+-----+----------+------------+---------+-----+----------------------+---+
| 19  | 用户号   | user id    | uid     | 可  |                      |   |
|     |          |            |         | 空  |                      |   |
+-----+----------+------------+---------+-----+----------------------+---+
| 20  | 卡号     | card       | cn      | 可  |                      |   |
|     |          | number     |         | 空  |                      |   |
+-----+----------+------------+---------+-----+----------------------+---+
| 21  | 交易报文 | trade      | tm      | 可  | 请求或响应报文       |   |
|     |          | message    |         | 空  |                      |   |
+-----+----------+------------+---------+-----+----------------------+---+
| 22  | 日       | log        | lv      | 必  | 日志规范             |   |
|     | 志版本号 | version    |         | 填  | 的版本号，此文档中日 |   |
|     |          |            |         |     | 志规范的版本号为1.0  |   |
+-----+----------+------------+---------+-----+----------------------+---+
|     | 自定义   |            |         |     | 各系统自定义字段     |   |
+-----+----------+------------+---------+-----+----------------------+---+
###### 1.5.14.3.3.4建议日志埋点 {#建议日志埋点-1 .list-paragraph}
1)  服务调用方：发起服务调用之前，收到响应之后。
2)  服务提供方：收到服务调用之后，返回响应之前。
##### 1.5.14.3.4其他日志 {#其他日志 .list-paragraph}
###### 1.5.14.3.4.1作用 {#作用-3 .list-paragraph}
上述几种日志类型，是从某一个方面来关注应用系统对业务的处理情况。除了这几种日志类型之外，应用系统还可以根据自身需要，定义其他日志类型，例如：
**运行日志：**用来记录应用系统运行情况；
**监控日志**：用来监控应用系统各种关键指标的情况；
......
对于自定义日志类型，本规范仅对必须输出的公用性关键要素进行定义，其他要素可自定义。
###### 1.5.14.3.4.2关键要素 {#关键要素-3 .list-paragraph}
+-----+-----------+----------+--------+-----+-----------------------+
| *   | **要      | **英     | **英文 | *   | **描述**              |
| *序 | 素名称**  | 文全称** | 简写** | *填 |                       |
| 号  |           |          |        | 写  |                       |
| **  |           |          |        | **  |                       |
+=====+===========+==========+========+=====+=======================+
| 1   | 时间      | time     | t      | 必  | 时间格式：            |
|     |           |          |        | 填  |                       |
|     |           |          |        |     | yyyy-MM-dd            |
|     |           |          |        |     | HH:mm:ss.SSS          |
+-----+-----------+----------+--------+-----+-----------------------+
| 2   | 主机名    | host     | hn     | 可  | 应用系统日志无需输出  |
|     |           | name     |        | 空  | ，由日志分析平台在接  |
|     |           |          |        |     | 入日志时补充此字段。  |
+-----+-----------+----------+--------+-----+-----------------------+
| 3   | 应用      | system   | sysid  | 必  | 联盟                  |
|     | 系统编号  | id       |        | 填  | 统一规划的11位系统编  |
|     |           |          |        |     | 号，举例：80100180000 |
+-----+-----------+----------+--------+-----+-----------------------+
| 4   | 组件      | c        | comid  | 必  | 联盟统                |
|     | 实例编号  | omponent |        | 填  | 一规划的组件实例编号  |
|     |           | id       |        |     |                       |
+-----+-----------+----------+--------+-----+-----------------------+
| 5   | 全局统    | global   | gtn    | 必  | 详见《交易路径跟踪    |
|     | 一流水号  | trace    |        | 填  | 全局统一流水号规范》  |
|     |           | number   |        |     |                       |
+-----+-----------+----------+--------+-----+-----------------------+
| 6   | 业        | trade    | tsn    | 选  |                       |
|     | 务流水号  | serial   |        | 填  |                       |
|     |           | number   |        |     |                       |
+-----+-----------+----------+--------+-----+-----------------------+
| 7   | 日志级别  | log      | ll     | 必  | 详见日志级别划分章节  |
|     |           | level    |        | 填  |                       |
+-----+-----------+----------+--------+-----+-----------------------+
| 8   | 进程      | thread   | tn/pn  | 必  | 多进程输出进程号      |
|     | 号/线程号 | number   |        | 填  | ；多线程输出线程号；  |
|     |           | /process |        |     |                       |
|     |           | number   |        |     |                       |
+-----+-----------+----------+--------+-----+-----------------------+
| 9   | 源码定位  | code     | cp     | 必  | 包含包名、类名、方    |
|     |           | position |        | 填  | 法名、行号，格式为：  |
|     |           |          |        |     | 包名.类名.方法名.行号 |
+-----+-----------+----------+--------+-----+-----------------------+
| 10  | 错误码    | error    | ec     | 可  | 当日志级别为ERROR、FA |
|     |           | code     |        | 空  | TAL时，错误码必须填写 |
+-----+-----------+----------+--------+-----+-----------------------+
| 11  | 错误信息  | error    | em     | 可  | 当                    |
|     |           | message  |        | 空  | 日志级别为ERROR、FATA |
|     |           |          |        |     | L时，错误信息必须填写 |
+-----+-----------+----------+--------+-----+-----------------------+
| 12  | 日        | log      | lv     | 必  | 日志规                |
|     | 志版本号  | version  |        | 填  | 范的版本号，此文档中  |
|     |           |          |        |     | 日志规范的版本号为1.0 |
+-----+-----------+----------+--------+-----+-----------------------+
| 13  | 日志内容  | log      | lc     | 必  |                       |
|     |           | content  |        | 填  |                       |
+-----+-----------+----------+--------+-----+-----------------------+
|     | 自定义    |          |        |     | 各系统自定义字段      |
+-----+-----------+----------+--------+-----+-----------------------+
###### 1.5.14.3.4.3日志级别说明 {#日志级别说明 .list-paragraph}
自上而下，级别由低到高：
+---------+---------------------------------+--------------------------+
| **日志  | **级别描述**                    | **告警**                 |
| 级别**  |                                 |                          |
+=========+=================================+==========================+
| DEBUG   | 对调试（debug）有帮助           |                          |
|         | 的信息、事件。默认情况不打开。  |                          |
+---------+---------------------------------+--------------------------+
| INFO    | 在正常运行状态中                |                          |
|         | ，粗粒度的、关于重要流程/事件的 |                          |
|         | 、应用重要的配置和参数信息，可  |                          |
|         | 用来表示应用健康度的信息、事件  |                          |
+---------+---------------------------------+--------------------------+
| WARN    | 有潜在风险的、不会造            | 日志分析平台扫描到       |
|         | 成大危害的错误（往往由应用外部  | 此级别日志后，应该向运营 |
|         | 因素造成，如不正确的输入数据）  | 监控平台发送警告级别告警 |
+---------+---------------------------------+--------------------------+
| ERROR   | 应用发生错误（往往由于发生异常  | 日志分析平台扫描到       |
|         | ），但后续流程还能够继续进行；  | 此级别日志后，应该向运营 |
|         |                                 | 监控平台发送重要级别告警 |
|         | 此日志级别应该向运营监控平台发  |                          |
|         | 送重要告警，提醒运维人员关注；  |                          |
+---------+---------------------------------+--------------------------+
| FATAL   | 应                              | 日志分析平台扫描到       |
|         | 用发生严重错误，应用服务被终止  | 此级别日志后，应该向运营 |
|         | 或者重启。需要立即被处理的错误  | 监控平台发送严重级别告警 |
+---------+---------------------------------+--------------------------+
任何日志输出级别为info以上，生产系统不可出现debug级别的日志输出。
#### 日志改造方案
为方便接入日志分析平台，日志的输出必须要保证关键要素可识别、可提取。由于各应用系统技术架构不尽相同，日志分类和格式也差异较大，因此对于日志输出格式，不做强制性要求，提供几种建议输出方案，供各应用系统参考，各系统也可根据自身情况采用其他方案，经过运维日志分析平台确认可行后，方可采用并落地。
###### 1.5.14.4.1建议的日志埋点 {#建议的日志埋点 .list-paragraph}
1)  系统初始化：系统初始化时会依赖一些关键配置，根据参数不同会提供不一样的服务。将系统的启动参数记录INFO日志，打印出参数以及启动完成态服务表述。
2)  重要方法入口：建议记录方法调用、入参、返回值，对于排查问题会有很大帮助。
3)  业务流程与预期不符：项目代码中结果与期望不符时也是日志场景之一，简单来说就是所有流程分支都可以加入考虑。取决于开发人员判断能否容忍情形发生。常见的合适场景包括外部参数不正确，数据处理问题导致返回码不在合理范围内等等。
4)  系统核心的关键动作：系统中核心角色触发的业务动作是需要多加关注的，是衡量系统正常运行的重要指标，建议记录INFO级别日志，比如电商系统用户从登录到下单的整个流程；微服务各服务节点交互；核心数据表的增删改等等。
5)  系统异常：这类捕获的异常是系统告知开发人员需要加以关注的，是质量非常高的报错。应当适当记录日志，根据实际结合业务的情况使用warn或者error级别。
6)  系统间的交易请求和响应。
7)  外部服务调用和返回。
8)  应用和服务的启动，关闭，配置加载。
9)  程序异常或者错误：例如数据库无法连接。
10) 容错行为：调用重试。
11) 重要的警告。
12) 持久性数据的更改，例如写文件、更新数据库等。
13) 重要的状态变化。
14) 用户与前端界面的交互操作。
15) 有已知失败风险的调用。
16) 较长时间的等待。
17) 长期运行任务的执行进度。
18) 重要的逻辑分支和导向分支的条件。
1.5.14.4.2不建议的日志埋点
1)  方法入口：不要记录方法入口，除非它非常重要或者是日志处于调试级别。
2)  循环中的数据：避免在循环的多次迭代中记录日志。除非是小循环，或者是间歇性的记录。
3)  大消息或者文件的内容：截断或者使用一些有利于调试的方式进行汇总。
4)  良性错误：那些不是真正错误的错误会令日志的读者感到困惑。当异常处理是执行成功的一部分时，有时会遇到这种情况。
###### 1.5.14.4.2Java日志记录原则 {#java日志记录原则 .list-paragraph}
1)  使用门面中的API：应用中不建议直接使用日志系统（例如：Log4j、Logback）中的API，而应依赖使用日志框架（例如：SLF4J）中的API，使用门面模式的日志框架，有利于维护和各个类的日志处理方式统一；
2)  不推荐以字符串拼接的方式输出日志：如果信息本身需要计算或者合并的，打印前要用isXxxEnable()方法进行判断，或者使用占位符"{}"。这是因为当日志级别设置的比较高的时候，虽然低级别日志不打印，但也会执行字符串拼接，造成资源浪费。
3)  避免重复打印日志：例如在log4j配置文件中设置additivity=false。additivity默认为true，即通过该logger输出的日志会同时输出到root
    logger，如果还为该logger指定了独立的appender，就会导致这部分日志重复输出。
4)  异常信息应该包括两类信息：案发现场信息和异常堆栈信息。如果不处理，那么通过关键字throws往上抛出。
5)  谨慎地记录日志：生产环境禁止输出debug日志，有选择地输出info日志，避免把服务器磁盘撑爆。
6)  禁用System输出：不要直接使用System.out或者System.err输出日志，也不允许使用STDOUT、STDERR作为Logger名字。
7)  不打印无意义日志：不打印对排查故障无意义的日志信息，日志信息一定要带有业务信息。
8)  循环体内不要打印INFO以上级别日志。