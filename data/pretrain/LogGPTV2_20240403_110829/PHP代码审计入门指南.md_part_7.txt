1
9':dyd /x/:/xooueadud/pssdw/sbu/uw/  wu 1t unu jaxop
/bin/bash
/
apt-get update
aptinstalllibtool
Bash
复制代码
phpize
phpize生成Makefile
Bash
复制代码
./configure
-enable-evalhook
配置编译选项启用扩展
最后执行make编译扩展
编译好的扩展会放在./modules/目录下
使用扩展
87
---
## Page 88
C
复制代码
php-d extension=扩展位置-f 文件
可以重复使用-dextension加载多个扩展
总结
在选用PHP源码保护方案时尽量选择opcode或虚拟机方案
源代码混淆类只能对源代码获取和阅读增加一点困难在加密扩展可被攻击者获取到时并不能起到保护作
用
PHP代码审计入门指南
参考
php内核剖析
从Zend虚拟机分析PHP加密扩展
通用加密php文件还原方法
88
---
## Page 89
changelog
2021-12-12
1.弃用gitbook改用语雀
2.补充其他漏洞页面小幅度修整页面格式
2021-12-20
1.文件操作函数补充
2.增加扩展阅读页面
3.增加PHP源码解密
2021-12-28
PHP源码解密页面完成
2022-03-10
补充其他漏洞
89
---
## Page 90
PHP弱类型
PHP是一种弱类型语言在定义变量时无需定义变量值类型PHP会根据变量内容自动转换类型
例如整数与字符串松散比较时字符串会转成整数“0abcdefg"==0
PHP的松散比较（==)https://www.php.net/manual/zh/types.comparisons.php
值
tr
fa
1
-1
nul
II1I
1值
ue
Lse
"1""
"0""
1”
1
ay()
"p
2
h
p"
tru
tr
fa
tr
fa
tr
tr
fa
tr
fal
fal
t
false
e
ue
Lse
ue
Lse
ue
ue
lse
ue
se
se
ru
e
fal
fa
tr
fa
tr
fa
fa
tr
fa
tru
tru
f
true
se
lse
ue
Lse
ue
Lse
Lse
ue
lse
e
e
ne
LP
se
1
tr
fa
tr
fa
fa
tr
fa
fa
fal
fal
f
false
ue
Lse
ue
Lse
Lse
ue
Lse
Lse
se
se
ne
se
fa
tr
fa
tr
fa
fa
tr
fa
tru
fal
t
true
Lse
ue
Lse
ue
Lse
Lse
ue
Lse
e
se
ru
e
-1
tr
fa
fa
fa
tr
fa
fa
tr
fal
fal
f
false
ue
Lse
lse
lse
ue
lse
lse
ue
se
se
al
se
" 1"
tr
fa
tr
fa
fa
tr
fa
fa
fal
fal
f
false
le
lse
ue
1se
lse
ue
lse
lse
se
se
al
90
---
## Page 91
se
"0"
fa
tr
fa
tr
fa
fa
tr
fa
fal
fal
f
false
Lse
ue
Lse
ue
Lse
Lse
ue
lse
se
se
ne
se
"_
tr
fa
fa
fa
tr
fa
fa
tr
fal
fal
f
false
1"
ue
Lse
lse
lse
ue
lse
lse
ue
se
se
ne
se
nul
fa
tr
fa
tr
fa
fa
fa
fa
tru
tru
f
true
lse
ue
Lse
ue
Lse
lse
Lse
lse
e
e
ne
se
fa
tr
fa
fa
fa
fa
fa
fa
tru
tru
f
false
ay()
Lse
ue
lse
Lse
lse
Lse
lse
lse
e
e
ne
se
"ph
tr
fa
fa
tr
fa
fa
fa
fa
fal
fal
t
false
p"
ue
Lse
Lse
ue
Lse
Lse
Lse
Lse
se
se
ru
e
III
fa
tr
fa
tr
fa
fa
fa
fa
tru
fal
f
true
Lse
ue
Lse
ue
Lse
Lse
Lse
lse
e
se
ne
se
可以使用===同时比较类型避免这个问题
91
---
## Page 92
扩展阅读
巧用命令注入的N种方式[zeddy]
PHP7内核剖析
来读读PHP的源码x)
XSS
内容安全策路
我的CSP绕过思路及总结[evoA]
反序列化
PHP反序列化入门之寻找POP链（一）
PHP反序列化入门之寻找POP链（二）
利用phar拓展php反序列化漏洞攻击面
SQL注入
Sql预编译与模拟预编译研究[熊本熊本熊]
ThinkPHP5SQL注入漏洞&&PDO真/伪预处理分析[phithon]
DockerPHP裸文件本地包含综述[phithon]
PHP动态特性的捕捉与逃逸
PHP利用PCRE回溯次数限制绕过某些安全限制
谈escapeshellarg统过与参数注入漏洞
谈一谈php://filter的妙用
代码审计实战思路之浅析PHPCMS
user.ini文件构成的PHP后门
phpwind利用哈希长度扩展攻击进行getshell
WordPress5.0RCE详细分析
A New Era of SSRF - Exploiting URL Parser in Trending Programming Langua [Orange Tsai]
[pdf] A New Era of SSRF - Exploiting URL Parser in Trending Programming Langua [Orange Tsai]
DEF CON 26 - Orange Tsai - Breaking Parser Logic Take Your Path Normalization Off and Pop
ODays Out
[pdf] DEF CON 26 - Orange Tsai - Breaking Parser Logic Take Your Path Normalization Off and
Pop ODays Out
92
---
## Page 93
总结
要比产品更懂业务
你要对项目中全部业务都了如指掌这样才能发掘业务中潜在的逻辑漏洞出现新的业务功能要及时跟进测试
要比测试更懂流程
你要详细掌握项目中访问路由输入处理等过程形成测试流程做到快速测试提高审计调试效率
要比开发更懂代码
熟知PHP中危险函数和过滤方法
要比架构更懂框架
熟知常见PHP框架文件结构执行流程访问路由
没有人比我更懂PHP审计（雾）
6
---
## Page 94
参考
[1] PHP手册 https://www.php.net/manual/
[2]ThinkPHP5.0完全开发手册https://www.kancloud.cn/manual/thinkphp5/
[3]ThinkPHP3.2.3完全开发手册https://www.kancloud.cn/manual/thinkphp/
[4] Codelgniter2用户指南 https://codeigniter.org.cn/userguide2/index.html
[5] Codelgniter3用户指南https://codeigniter.org.cn/userguide3/general/welcome.html
[6] Codelgniter4用户指南https://codeigniter.org.cn/user_guide/
[7] CakePHP 4.x Strawberry Cookbook https://book.cakephp.org/4/en/contents.html
[8] Yii 2.0 权威指南 https://www.yiichina.com/doc/guide/2.0
[9]Laravel 8中文文档https://learnku.com/docs/laravel/8.x
[10] Mongodb注入攻击（wooyun drops 3939)
https: / /wooyun.js.0rg/drops/Mongodb%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB.ht
ml
[11]LDAP注入学习小记https://www.cnblogs.com/0nc3/p/12063436.html
[12]从xML相关一步一步到XXE漏洞https://xz.aliyun.com/t/6887
[13]PHP7内核剖析https://www.kancloud.cn/nickbai/php7
[14] 【LDAP】LDAP注入漏洞与防御 https://www.jianshu.com/p/d94673be9ed0
[15]LDAP注入入门学习
https://damit5.c0m/2019/08/05/LDAP%E6%B3%A8%E5%85%A5%E5%85%A5%E9%97%A8%
E5%AD%A6 %E4% B9%A0/
[16]php反序列化与POP链https://v0w.top/2020/03/05/unsearise-POP/
94
---
## Page 95
[17] Gynvael Coldwind 《PHP_LFl_rfc1867_temporary_files》 2011.3
http://gynvael.coldwind.pl/download.php?f=PHP_LFl_rfc1867_temporary_files.pdf
95
---