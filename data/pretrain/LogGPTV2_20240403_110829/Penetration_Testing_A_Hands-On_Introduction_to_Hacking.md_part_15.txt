think like attackers and develop plans of attack based on the information
we’ve gathered. Based on the information we uncover, we’ll actively search
for and verify vulnerabilities using vulnerability-scanning techniques, which
are covered in the next chapter.
open source intelligence gathering
We can learn a good deal about our client’s organization and infrastructure
before we send a single packet their way, but information gathering can still
be a bit of a moving target. It isn’t feasible to study the online life of every
employee, and given a large amount of gathered information, it can be dif-
ficult to discern important data from noise. If the CEO tweets frequently
about a favorite sports team, that team’s name may be the basis for her
webmail password, but it could just as easily be entirely irrelevant. Other
times it will be easier to pick up on something crucial. For instance, if your
client has online job postings for a system administrator who is an expert
in certain software, chances are those platforms are deployed in the client’s
infrastructure.
As opposed to intelligence gained from covert sources such as dump-
ster diving, dumping website databases, and social engineering, open source
intelligence (or OSINT) is gathered from legal sources like public records
and social media. The success of a pentest often depends on the results of
the information-gathering phase, so in this section, we will look at a few
tools to obtain interesting information from these public sources.
Netcraft
Sometimes the information that web servers and web-hosting companies
gather and make publicly available can tell you a lot about a website. For
instance, a company called Netcraft logs the uptime and makes queries
about the underlying software. (This information is made publicly available
at http://www.netcraft.com/.) Netcraft also provides other services, and their
antiphishing offerings are of particular interest to information security.
For example, Figure 5-1 shows the result when we query http://www
.netcraft.com/ for http://www.bulbsecurity.com. As you can see, bulbsecurity.com
was first seen in March 2012. It was registered through GoDaddy, has an IP
address of 50.63.212.1, and is running Linux with an Apache web server.
Armed with this information, when pentesting bulbsecurity.com, we could
start by ruling out vulnerabilities that affect only Microsoft IIS servers. Or,
if we wanted to try social engineering to get credentials to the website, we
could write an email that appears to be from GoDaddy, asking the adminis-
trator to log in and check some security settings.
114 Chapter 5
Figure 5-1: Netcraft’s results for bulbsecurity .com
Whois Lookups
All domain registrars keep records of the domains they host. These records
contain information about the owner, including contact information. For
example, if we run the Whois command line tool on our Kali machine to
query for information about bulbsecurity.com, as shown in Listing 5-1, we see
that I used private registration, so we won’t learn much.
root@kali:~# whois bulbsecurity.com
Registered through: GoDaddy.com, LLC (http://www.godaddy.com)
Domain Name: BULBSECURITY.COM
Created on: 21-Dec-11
Expires on: 21-Dec-12
Last Updated on: 21-Dec-11
Registrant: u
Domains By Proxy, LLC
DomainsByProxy.com
14747 N Northsight Blvd Suite 111, PMB 309
Scottsdale, Arizona 85260
United States
Information Gathering 115
Technical Contact: v
Private, Registration PI:EMAIL
Domains By Proxy, LLC
DomainsByProxy.com
14747 N Northsight Blvd Suite 111, PMB 309
Scottsdale, Arizona 85260
United States
(480) 624-2599 Fax -- (480) 624-2598
Domain servers in listed order:
NS65.DOMAINCONTROL.COM w
NS66.DOMAINCONTROL.COM
Listing 5-1: Whois information for bulbsecurity .com
This site has private registration, so both the registrant u and technical
contact v are domains by proxy. Domains by proxy offer private registra-
tion, hiding your personal details in the Whois information for the domains
you own. However, we do see the domain servers w for bulbsecurity.com.
Running Whois queries against other domains will show more interesting
results. For example, if you do a Whois lookup on georgiaweidman.com, you
might get an interesting blast from the past, including my college phone
number.
DNS Reconnaissance
We can also use Domain Name System (DNS) servers to learn more about a
domain. DNS servers translate the human-readable URL www.bulbsecurity.com
into an IP address.
Nslookup
For example, we could use a command line tool such as Nslookup, as shown
in Listing 5-2.
root@Kali:~# nslookup www.bulbsecurity.com
Server: 75.75.75.75
Address: 75.75.75.75#53
Non-authoritative answer:
www.bulbsecurity.com canonical name = bulbsecurity.com.
Name: bulbsecurity.com
Address: 50.63.212.1 u
Listing 5-2: Nslookup information for www .bulbsecurity .com
Nslookup returned the IP address of www.bulbsecurity.com, as you can
see at u.
We can also tell Nslookup to find the mail servers for the same website
by looking for MX records (DNS speak for email), as shown in Listing 5-3.
116 Chapter 5
root@kali:~# nslookup
> set type=mx
> bulbsecurity.com
Server: 75.75.75.75
Address: 75.75.75.75#53
Non-authoritative answer:
bulbsecurity.com mail exchanger = 40 ASPMX2.GOOGLEMAIL.com.
bulbsecurity.com mail exchanger = 20 ALT1.ASPMX.L.GOOGLE.com.
bulbsecurity.com mail exchanger = 50 ASPMX3.GOOGLEMAIL.com.
bulbsecurity.com mail exchanger = 30 ALT2.ASPMX.L.GOOGLE.com.
bulbsecurity.com mail exchanger = 10 ASPMX.L.GOOGLE.com.
Listing 5-3: Nslookup information for bulbsecurity .com’s mail servers
Nslookup says bulbsecurity.com is using Google Mail for its email servers,
which is correct because I use Google Apps.
Host
Another utility for DNS queries is Host. We can ask Host for the name
servers for a domain with the command host -t ns domain. A good example
for domain queries is zoneedit.com, a domain set up to demonstrate zone
transfer vulnerabilities, as shown here.
root@kali:~# host -t ns zoneedit.com
zoneedit.com name server ns4.zoneedit.com.
zoneedit.com name server ns3.zoneedit.com.
--snip--
This output shows us all the DNS servers for zoneedit.com. Naturally,
because I mentioned that this domain was set up to demonstrate zone
transfers, that’s what we are going to do next.
Zone Transfers
DNS zone transfers allow name servers to replicate all the entries about a
domain. When setting up DNS servers, you typically have a primary name
server and a backup server. What better way to populate all the entries in
the secondary DNS server than to query the primary server for all of its
entries?
Unfortunately, many system administrators set up DNS zone transfers
insecurely, so that anyone can transfer the DNS records for a domain.
zoneedit.com is an example of such a domain, and we can use the host com-
mand to download all of its DNS records. Use the -l option to specify the
domain to transfer, and choose one of the name servers from the previous
command, as shown in Listing 5-4.
Information Gathering 117
root@kali:~# host -l zoneedit.com ns2.zoneedit.com
Using domain server:
Name: ns2.zoneedit.com
Address: 69.72.158.226#53
Aliases:
zoneedit.com name server ns4.zoneedit.com.
zoneedit.com name server ns3.zoneedit.com.
zoneedit.com name server ns15.zoneedit.com.
zoneedit.com name server ns8.zoneedit.com.
zoneedit.com name server ns2.zoneedit.com.
zoneedit.com has address 64.85.73.107
www1.zoneedit.com has address 64.85.73.41
dynamic.zoneedit.com has address 64.85.73.112
bounce.zoneedit.com has address 64.85.73.100
--snip--
mail2.zoneedit.com has address 67.15.232.182
--snip--
Listing 5-4: Zone transfer of zoneedit .com
There are pages and pages of DNS entries for zoneedit.com, which gives
us a good idea of where to start in looking for vulnerabilities for our pen-
test. For example, mail2.zoneedit.com is probably a mail server, so we should
look for potentially vulnerable software running on typical email ports such
as 25 (Simple Mail Transfer Protocol) and 110 (POP3). If we can find a web-
mail server, any usernames we find may lead us in the right direction so that
we can guess passwords and gain access to sensitive company emails.
Searching for Email Addresses
External penetration tests often find fewer services exposed than internal
ones do. A good security practice is to expose only those services that must
be accessed remotely, like web servers, mail servers, VPN servers, and maybe
SSH or FTP, and only those services that are mission critical. Services like
these are common attack surfaces, and unless employees use two-factor
authentication, accessing company webmail can be simple if an attacker
can guess valid credentials.
One excellent way to find usernames is by looking for email addresses
on the Internet. You might be surprised to find corporate email addresses
publicly listed on parent-teacher association contact info, sports team ros-
ters, and, of course, social media.
You can use a Python tool called theHarvester to quickly scour thou-
sands of search engine results for possible email addresses. theHarvester
can automate searching Google, Bing, PGP, LinkedIn, and others for email
addresses. For example, in Listing 5-5, we’ll look at the first 500 results in
all search engines for bulbsecurity.com.
118 Chapter 5
root@kali:~# theharvester -d bulbsecurity.com -l 500 -b all
*******************************************************************
* *
* | |_| |__ ___ /\ /\__ _ _ ____ _____ ___| |_ ___ _ __ *
* | __| '_ \ / _ \ / /_/ / _` | '__\ \ / / _ \/ __| __/ _ \ '__| *
* | |_| | | | __/ / __ / (_| | | \ V / __/\__ \ || __/ | *
* \__|_| |_|\___| \/ /_/ \__,_|_| \_/ \___||___/\__\___|_| *
* *
* TheHarvester Ver. 2.2a *
* Coded by Christian Martorella *
* Edge-Security Research *
* PI:EMAIL *
*******************************************************************
Full harvest..
[-] Searching in Google..
Searching 0 results...
Searching 100 results...
Searching 200 results...
Searching 300 results...
--snip--
[+] Emails found:
------------------
PI:EMAIL
[+] Hosts found in search engines:
------------------------------------
50.63.212.1:www.bulbsecurity.com
--snip--
Listing 5-5: Running theHarvester against bulbsecurity .com
There’s not too much to be found for bulbsecurity.com, but theHarvester
does find my email address, PI:EMAIL, and the website,
www.bulbsecurity.com, as well as other websites I share virtual hosting
with. You may find more results if you run theHarvester against your
organization.
Maltego
Paterva’s Maltego is a data-mining tool designed to visualize open source
intelligence gathering. Maltego has both a commercial and a free com-
munity edition. The free Kali Linux version, which we’ll use in this book,
limits the results it returns, but we can still use it to gather a good deal of
interesting information very quickly. (The paid version offers more results
and functionality. To use Maltego on your pentests, you will need a paid
license.)
Information Gathering 119
note Feel free to use Maltego to study other Internet footprints, including your own, your
company’s, your high school arch nemesis’s, and so on. Maltego uses information
publicly available on the Internet, so it is perfectly legal to do reconnaissance on any
entity.
To run Maltego, enter maltego at the command line. The Maltego GUI
should launch. You will be prompted to create a free account at the Paterva
website and log in. Once logged in, choose Open a blank graph and let me
play around, and then click Finish, as shown in Figure 5-2.
Figure 5-2: Opening a new Maltego graph
Now select the Palette option from the left-hand border. As you can see,
we can gather information about all sorts of entities.
Let’s start with the bulbsecurity.com domain, as shown in Figure 5-3.
Expand the Infrastructure option from the Palette (on the left of the
Maltego window) and drag a Domain entity from the Palette onto the new
graph. By default, the domain is paterva.com. To change it to bulbsecurity.com,
either double-click the text or change the text field at the right side of the
screen.
120 Chapter 5
Figure 5-3: Adding an entity to the graph
Once the domain is set, you can run transforms (Maltego-speak for
queries) on it, instructing Maltego to search for interesting information.
Let’s start with a couple of simple transforms, which you can view by right-
clicking the domain icon and choosing Run Transform, as shown in
Figure 5-4.
In the figure, we can see all the transforms available for a domain entity.
As you work with different entities, different transform options will be avail-
able. Let’s find the MX records for the bulbsecurity.com domain and, thus,
where the mail servers are. Under All Transforms, choose the To DNS
Name – MX (mail server) transform.
As expected from our previous research, Maltego returns Google Mail
servers, indicating that bulbsecurity.com uses Google Apps for email. We can
run the simple To Website [Quick lookup] transform to get the website
address of bulbsecurity.com. See Figure 5-5 for the results from both this and
the previous transform.
Information Gathering 121
Figure 5-4: Maltego transforms
Figure 5-5: Transform results
122 Chapter 5
Maltego correctly finds www.bulbsecurity.com. Attacking the Google
Mail servers will likely be out of the scope of any pentest, but more infor-
mation on the www.bulbsecurity.com website would certainly be useful.
We can run transforms on any entity on the graph, so select the website
www.bulbsecurity.com to gather data on it. For instance, we can run the trans-
form ToServerTechnologiesWebsite to see what software www.bulbsecurity.com
is running, as shown in Figure 5-6.
Figure 5-6: www .bulbsecurity .com software
Maltego finds that www.bulbsecurity.com is an Apache web server with
PHP, Flash, and so on, along with a WordPress install. WordPress, a com-
monly used blogging platform, has a long history of security issues (like
a lot of software). We’ll look at exploiting website vulnerabilities in Chap-
ter 14. (Let’s hope I am keeping my WordPress blog up to date, or else I
might wake up to find my site defaced one day. How embarrassing!)
You can find additional information and tutorials about Maltego at
http://www.paterva.com/. Spend some time using Maltego transforms to find
interesting information about your organization. In skilled hands, Maltego
can turn hours of reconnaissance work into minutes with the same quality
results.
Port scanning