数据表明，一些人持有一些常见的“偏见”，认为女性比男性更有魅
力。年龄对于魅力的影响，女性比男性高。社会属性的空间和我们
所熟悉的很一致：乡下小伙、父辈、有魅力的年轻女性。但还是有
一些潜在的令人惊讶的地方：婴儿最有吸引力、看起来保守的智商
更高等。我们还发现一些性别化单词的例子。
我们试着一直继续探索这些有提示性的发现，但是本章不会给出任
何特定的结论。相反地，我们想要显示在关于人们的判断的大量，
混杂的数据中包含的有意义的模式的富集合的一些例子。更严格的
数据收集处理（如谨慎控制的实验）将永远都无法生成如此大量的
数据，因此对于后续的实验没有太大作用。
每天我们都通过自己购买的东西、使用的Web站点、搜索的查询、
发送的消息和去的地方方方面面地展示自己。不论我们喜欢与否，
在人类历史上，这是第一次把所有的数据都精心保存起来。暂不考
虑重要的隐私问题，该数据对于社会科学的价值是非常巨大的。通
过这种改变用途的信息的混乱，我们将以全新的方式了解自己。
1680
---
## Page 1682
致谢
非常感谢给本章初稿反馈的所有人：JoannaGubman、Sasha
G o o d ma n、Je ff Hammerbacher、Mike Love、Will Moffat和Toby
Segaran。FaceStat的存在归功于工作努力且杰出的同事ChrisVan
Pelt.
参考文献
我们上传了部分数据子集以及一些笔记和代码来帮助重现我们的分
析，在：http：//data.doloreslabs.come
如果你对学习建模工具R感兴趣，我们推荐两个Web站点：
Quick-R(http://statmethods.net)
RobertKabacoff与的高级概要和主题指南。
RSeek(http: //rseek. org)
SashaGoodman实现的R文档、包和邮件列表的搜索引擎。
统计工具R的官方Web站点可以通过http：//www.r-project.org访问。
如果你对它和其他的数据分析包比较感兴趣，请参见表17-2的很多
评论，可以通过http：/anyall.org/blog/?p=421访问。
最受推荐的学习R的书是PeterDalgaard的《IntroductoryStatisticswith
R》（Sringer出版，2008）。
除了统计工具R的核心功能，我们使用的一些附加包包括corrgram、
flowCore、gclus、geneplotter、plyr和pixmap。
TrevorHastie、RobertTibshirani和JeromeFriedman合著的《The
Elements ofStatisticalLearning》（Sringer出版，2008）包含了聚类、
局部加权回归法的优秀的概要总结以及其他机器学习技术。
关于标签部分仅仅涉及统计语言分析最基础的部分。为了了解更多
信息，可以参考ChristopherManning和HinrichSchitze著的
《Foundations ofStatisticalNaturalLanguageProcessing》语料语言学
一章(MT出版，1999），以及DanielJurafsky和JamesH.Martin著的
《Speech and LanguageProcessing》（Pentice Hall出版社，2008）。
1681
---
## Page 1683
对于魅力和年龄的变化关系分析，存在很多更好的方式来估计置信
区间。一种方法是部分集中(prtialpooling)；参考AndrewGelman和
Jennifer Hill的《Data Analysis Using Regression and
Multilevel/HierarchicalModels》（剑桥大学出版社，2006）的252~
258页。我们在本章所做的称为"探索性数据分析”（eploratorydata
假设检验不同。探索性数据分析被统计学家JohnTukey在1977年以之
命名（译注：即《ExploratoryDataAnalysis》）（Adison-Wesley出
版）的书中广泛推崇。
我们的创业公司DoloresLabs专注于外包项目：从大量的人中收集人
类的任务数据来解决内容控制、信息抽取、Web搜索相关性以及其
他领域的实际问题。我们收集、查看并自动分析大量关于人们的判
断的数据。你可以查看本章的后续，关于其他主题如性别、颜色和
宗教的分析，在博客http：/blog.doloreslabs.com可以获得。
第18章旧金山海湾区之殇：次贷危机的影响
HadleyWickham、DeborahF.Swayne和lDavidPoole
引言
房地产市场在过去几年得到了媒体的极大关注。大约从2000～2006
年，随着价格的额升，我们既惊奇又焦虑地看着房地产行业。从那
时开始，随着信用成为稀缺以及丧失抵押品赎回权的蔓延，房地产
业也跌入了冬天。在本章中，我们通过分析从2003～2008年旧金山
海湾地区50万的住宅销售来近距离探讨这个“故事”。从一个地区的
价格在一个很大价格范围内上升和下降的方式，我们可以学到些什
么呢？
我们将从描述数据、如何获取数据以及如何通过重构、转化、清除
和增强提升原始数据开始，从而为数据分析做准备。随着分析逐渐
深入，我们的大多数发现都会通过图像形式展示。在此过程中，还
会介绍一下我们使用的一些工具，这些工具多数都是可以免费获取
的。我们的主要工具是R，它提供了统计编程和数据分析环境，在数
据分析的各个阶段中都用到了这个工具：获取、清除、分析、诊断
和表示。
我们是如何获取数据的
1682
---
## Page 1684
在我们确定对房地产的实际销售数据感兴趣之后，数据搜索过程马
上随之展开。数据搜索并不总是成功的，因此当我们发现了《San
FranciscoChronicle》杂志生成的每周海湾地区（ByArea）的住宅房地
产（住房、公寓、托管公寓）的销售情况（在
http：/www.sfgate.com/homesales/可访问）之后，我们觉得特别的幸
运。当我们得知自己不需要通过解析Web页面来抽取数据，而是已
经可以获取计算机可读格式的数据时，我们感觉自己更幸运了。
每个人可读的(HMLWeb页面）每周总结都是基于如下的文本文件构
建的：
rowid: 1
county:Alameda County
city: Alameda
newcity: 1
zip: 94501
street: 1220 Broadway
price: $509, 000
br: 4
lsqft: 44 20
bsqft: 1834
year: 1910
每个星期的数据可以使用如下模式的URL获取：
http://www.sfgate.com/c/a////REHS.tbl。这
非常方便，因为只需要生成一个从他们并始记录的日期
2003/04/27（我们从他们网站的归档页面中找到的）到最近
2008/11/16（截止到分析时间）的所有星期天的日期列表。有了这个
日期列表，我们生成正确格式的URL列表，通过Unix命令行工具
Wge就可以下载它们了。我们之所以选用wget是因为它支持断点续
1683
---
## Page 1685
传功能，这样当下载中断时，可以很容易地从上一次下载到的位置
继续开始而不是从头开始。
所有的数据都保存在本地计算机上，下一步是把数据转换成标准格
式。我们通常使用csv（逗号分隔值，comma-separatedvalues)格式；
csv文件很容易生成，而且为各种统计包（包括Excel！）所支持。我
们生成了一个csv格式的文件，如下：
county, city, zip, street,price, br, lsqft, bsqft, year, date, dates
PTO
Alameda County,Alameda, 94501, 1220 Broadway, 509000, 4,
4420, 1834, 1910, 2003-04-27, NA
Alameda County,Alameda, 94501, 429 Fair Haven Road, 504000,
4， 6300, 1411, 1964, 2003-04-
27, NA
Alameda County,Alameda, 94501, 2804 Fernside Boulevard,
526000, 2, 4000, 1272, 1941， 2003-
04-27, NA
Alameda County,Alameda, 94501, 1316 Grove Street, 637000, 3,
2700, 1168, 1910, 2003-04-
27,NA
可能原始的数据格式更适合人们阅读，但是这种csv格式更适合计算
机处理。它不但更标准，而且更紧凑（csv格式的数据大小是45M
B，而原始数据格式的数据大小是90MB)。如果你仔细查看样本数
据，你可能会注意到有些东西需要解释：NAs。NA代表“不适用"Nt
Applicable)，而标记值R用于表示缺失值。在分析中我们必须考虑缺
失值。
解析所有293周的数据并创建结果文件house-sales.csv只需要花费几分
钟的时间，该csv文件包含521726个观察和11组变量。调整解析器使
得它满足所有的边界情况，这个过程花费了更多的时间：我们需要
把价格格式的数据转换成常用的数字（通过删除“S"和点“"符号），
1684
---
## Page 1686
把时间解析成一致的格式，而且为没有在所有的表都出现的字段填
充缺失值。
地理编码
当第一次查看数据时，我们认为对所有的436106个唯一地址进行地
理编码是非常重要的。也就是说，我们想要为每一个地址关联一个
经度和纬度值，这样可以很容易地探索细粒度的空间效果。这是一
个很有趣的挑战：你如何对将近50方的地址进行地理编码呢？
我们从查看G公司和Yahoo！提供的Web服务开始。这些服务不适合
有两个原因：一是它们对于每天的请求个数有严格的限制：二是使
用结果数据时存在繁琐的限制约束。单单请求限制就意味着对所有
的地址进行地理编码可能需要花费1个多月的时间，而且其授权将会
影响到公开发布结果！进一步调研之后，我们发现一项非常有用的
开源服务，USCWebGIS，它是由南加州大学的GIS研究实验室提供
的(Gldberg和Wilson2008）。该服务对于非商业使用是免费的，而且
对于结果数据的使用没有什么约束。我们开始使用该服务，不存在
每大的使用上限，但是由于速度原因存在一个隐含的上限：我们每
天只能够对大约8万条地址进行地理编码，因此为总共40多万条数据
进行地理编码花费了5天多的时间。该免费服务的缺点是地理编码的
质量不是很好（它只使用了公并可以访问的地址数据），但是该服
务的创始人很乐于帮助别人，并且发布了该服务主题的优秀的介绍
文档（Gldberg2008）。
除了经度和纬度，USCWebGIS服务提供的结果中还包含了用来描述
结果本身准确程度的一个类别变量：精确地址、邮政编码、区县
等。
数据检查
对于每个阶段的数据分析，通常而言，花一些时间来确保数据的准
确性是完全必要的，地理编码也不例外。地理编码的错误来自于很
多方面：地址中存在拓扑错误，新的建筑通常不会列在公开的数据
库中，邮政编码随着时间可能变更。我们在使用USCWebGIS过程
中，怀疑该软件可能存在一个bug，因为大量的地址被错误地分配到
该州的洛杉矶及其他地区：我们使用另一个免费在线服务
http：//gpsvisualizer.com对这些地址进行了重映射。调试过程中，为
了识别在旧金山海湾区很远以外的地址，我们使用统计建模工具R来
为每个区县以及绝大多数的城镇描绘经度和纬度的简单地图。
1685
---
## Page 1687
SanJose地区的地址提出了一个有趣的地理编码挑战。如一些"城镇”
的销售列表，我们找到的所有映射网站都无法识别这些信息，因此
我们假定它们是社区的非正式名称：SanJose的北部、南部、东部和