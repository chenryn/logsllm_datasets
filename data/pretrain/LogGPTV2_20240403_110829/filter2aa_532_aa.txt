1 
Advanced Wireless Attacks Against 
Enterprise Networks 
Course Guide 
Version 1.0.2 
Gabriel Ryan 
@s0lst1c3 @gdssecurity 
PI:EMAIL 
solstice.me 
2 
Introduction ........................................................................................................................... 3 
Lab Setup Guide ...................................................................................................................... 3 
Target Identification Within A Red Team Environment ........................................................... 3 
Chapter Overview .......................................................................................................................................... 3 
Scoping A Wireless Assessment: Red Team Style .......................................................................................... 5 
Linguistic Inference .................................................................................................................................... 5 
Sequential BSSID Patterns ......................................................................................................................... 5 
OUI Prefixes ............................................................................................................................................... 6 
Using Geographic Cross-Referencing To Identify In-Scope Access Points .................................................... 6 
Expanding The Scope By Identifying Sequential BSSIDs ................................................................................ 7 
Attacking And Gaining Entry To WPA2-EAP Wireless Networks ............................................... 9 
Chapter Overview .......................................................................................................................................... 9 
Wireless Theory: Evil Twin Attacks ................................................................................................................ 9 
Wireless Theory: WPA2-EAP Networks ....................................................................................................... 10 
Evil Twin Attack Using Hostapd-WPE .......................................................................................................... 13 
Lab Exercise: Evil Twin Attack Against WPA2-PEAP ................................................................................ 16 
Wireless Man-In-The-Middle Attacks ...................................................................................... 17 
Chapter Overview ........................................................................................................................................ 17 
Configuring Linux As A Router ..................................................................................................................... 18 
Lab Exercise: Using Linux As A Router ..................................................................................................... 21 
Classic HTTPS Downgrade Attack ................................................................................................................ 21 
Lab Exercise: Wireless MITM With And HTTP Downgrade ...................................................................... 23 
Downgrading Modern HTTPS Implementations Using Partial HSTS Bypasses ............................................ 23 
Lab Exercise: Wireless MITM With Partial HSTS Bypass ......................................................................... 27 
SMB Relays And LLMNR/NBT-NS Poisoning .............................................................................. 28 
Chapter Overview ........................................................................................................................................ 28 
LLMNR And NBT-NS Poisoning Using Responder ........................................................................................ 28 
Lab Exercise: LLMNR/NBT-NS Poisoning ................................................................................................. 30 
SMB Relay Attacks With impacket ............................................................................................................... 30 
Lab Exercise: SMB Relay Attacks ............................................................................................................. 34 
Firewall And NAC Evasion Using Indirect Wireless Pivots ........................................................... 35 
Chapter Overview .................................................................................................................................... 35 
Configuring Linux As A Captive Portal ......................................................................................................... 35 
Lab Exercise: Captive Portal .................................................................................................................... 38 
Wireless Theory: Hostile Portal Attacks ...................................................................................................... 38 
Wireless Redirect To SMB With LLMNR And NBT-NS Poisoning ................................................................. 44 
Lab Exercise: Wireless Redirect To SMB With LLMNR/NBT-NS Poisoning .............................................. 45 
Conclusion ........................................................................................................................... 46 
Resources............................................................................................................................. 47 
Advanced Wireless Attacks Against Enterprise Networks 
Introduction 
© 2017 Gabriel Ryan All Rights Reserved 
3 
Introduction 
Welcome to Advanced Wireless Attacks Against Enterprise Networks. In this workshop we’ll be 
going a few steps beyond classic techniques such as ARP replay attacks and WPA handshake 
captures. Instead we will focus on learning how to carry out sophisticated wireless attacks against 
modern corporate infrastructure. Our ultimate goal will be to learn how to leverage wireless as a 
means of gaining access to protected enterprise networks, and to escalate access within those 
networks to access sensitive data.  
There will be some overlap between the material covered in this course guide and material that 
would be more appropriate in a book about internal network penetration testing. This is 
unavoidable, since wireless and internal network penetration testing go hand-in-hand. They are 
both part of the same process of gaining unauthorized access to the network, then escalating that 
access as far as possible until full organizational compromise is achieved. However, in an effort to 
keep the scope of this workshop manageable, we’re going to focus on testing from a wireless 
perspective as much as possible. 
Lab Setup Guide 
Before we begin, it is recommended that you complete the lab setup guide that was included with 
this document. Depending on your previous experience using Active Directory and VirtualBox, it 
could take between two to five hours to complete the lab setup process. Please do not hesitate to 
reach out to the instructor should you encounter difficulties.  
Target Identification Within A Red Team Environment 
Chapter Overview 
Like any form of hacking, well executed wireless attacks begin with well-executed recon. During 
a typical wireless assessment, the client will give you a tightly defined scope. You’ll be given a set 
of ESSIDs that you are allowed to engage, and you may even be limited to a specific set of BSSIDs. 
During red team assessments, the scope is more loosely defined. The client will typically hire your 
company to compromise the security infrastructure of their entire organization, with a very loose 
set of restrictions dictating what you can and can’t do. To understand the implications of this, 
let’s think about a hypothetical example scenario.  
Evil Corp has requested that your firm perform a full scope red team assessment of their 
infrastructure over a five week period. They have 57 offices across the US and Europe, most of 
which have some form of wireless network. The client seems particularly interested in wireless 
as a potential attack vector. 
You and your team arrive at one of the client sites and perform a site-survey using airodump-ng, 
and see the output shown below. 
Advanced Wireless Attacks Against Enterprise Networks 
Target Identification Within A Red Team Environment 
© 2017 Gabriel Ryan All Rights Reserved 
4 
CH 11 ][ Elapsed: 1 min ][ 2017-02-02 13:49 
BSSID 
PWR 
RXQ 
Beacons 
#Data 
#/s 
CH 
MB 
ENC 
CIPHER 
AUTH 
ESSID 
1C:7E:E5:E2:EF:D9 
-66 
10 
572 
283 
0 
1 
54 
WPA2 
CCMP 
MGT 
1C:7E:E5:E2:EF:D8 
-66 
11 
569 
83 
1 
1 
54 
WPA2 
CCMP 
MGT 
1C:7E:E5:E2:EF:D7 
-66 
12 
580 
273 
0 
1 
54 
WPA2 
CCMP 
MGT 
1C:7E:E5:E2:EF:D6 
-66 
10 
566 
43 
0 
1 
54 
WPA2 
CCMP 
MGT 
1C:7E:E5:62:32:21 
-68 
11 
600 
24 
0 
6 
54 
WPA2 
CCMP 
MGT 
1C:7E:E5:97:79:A4 
-68 
0 
598 
82 
2 
6 
54 
WPA2 
CCMP 
MGT 
ECwnet1 
1C:7E:E5:97:79:A5 
-68 
9 
502 
832 
0 
6 
54 
WPA2 
CCMP 
MGT 
ECwnet1 
1C:7E:E5:97:79:B1 
-64 
14 
602 
23 
0 
6 
54 
WPA2 
CCMP 
MGT 
1C:7E:E5:97:79:A6 
-65 
12 
601 
42 
0 
11 
54 
WPA2 
CCMP 
MGT 
ECMNV32 
1C:7E:E5:97:79:A7 
-62 
12 
632 
173 
0 
11 
54 
WPA2 
CCMP 
MGT 
ECMNV32 
1C:7E:E5:97:79:A8 
-62 
10 
601 
21 
1 
11 
54 
WPA2 
CCMP 
MGT 
00:17:A4:06:E4:C6 
-74 
10 
597 
12 
0 
6 
54 
WPA2 
TKIP 
MGT 
00:17:A4:06:E4:C7 
-74 
8 
578 
234 
0 
6 
54 
WPA2 
TKIP 
MGT 
00:17:A4:06:E4:C8 
-74 
10 
508 
11 
1 
6 
54 
WPA2 
TKIP 
MGT 
00:17:A4:06:E4:C9 
-72 
11 
535 
12 
0 
1 
54 
WPA2 
TKIP 
MGT 
00:13:E8:80:F4:04 
-74 
11 
521 
132 
0 
1 
54 
WPA2 
TKIP 
MGT 
prN67n 
00:22:18:38:A4:64 
-68 
12 
576 
10 
0 
3 
54 
WPA2 
CCMP 
MGT 
ASFWW 
00:22:18:38:A4:65 
-68 
12 
577 
431 
0 
3 
54 
WPA2 
CCMP 
MGT 
ASFWW 
None of the networks within range have an ESSID that conclusively ties them to Evil Corp. Many 
of them do not broadcast ESSIDs, and as such lack any identification at all. 
To make matters worse, the branch location your team is scoping out is immediately adjacent to 
a major bank, a police station, and numerous small retail outlets. It is very likely that many of the 
access points that you see in your airodump-ng output belong to one of these third parties.  
During some engagements, you may be able to reach out to the client at this point and ask for 
additional verification. More likely, however, you’ll have to identify in-scope targets yourself. 
Let’s talk about how to do this. 
Advanced Wireless Attacks Against Enterprise Networks 
Target Identification Within A Red Team Environment 
© 2017 Gabriel Ryan All Rights Reserved 
5 
Scoping A Wireless Assessment: Red Team Style 
We have four primary techniques at our disposal that we can use to identify in-scope wireless 
targets: 
▪ 
Linguistic Inference 
▪ 
Sequential BSSID patterns 
▪ 
Geographic cross-referencing 
▪ 
OUI Prefixes 
Let’s talk about each of these techniques in detail. 
Linguistic Inference 
Using Linguistic Inference during wireless recon is the process of identifying access points with 
ESSIDs that are linguistically similar to words or phrases that the client uses to identify itself. For 
example, if you are looking for access points owned by Evil Corp and see a network named 
“EvilCorp-guest”, it is very likely (although not certain) that this network is in-scope. Similarly, if 
you’re pentesting Evil Corp but see an ESSID named “US Department of Fear,” you should 
probably avoid it. 
Sequential BSSID Patterns 
In our airodump-ng output, you may notice groups of BSSIDs that increment sequentially. For 
example: 
1C:7E:E5:E2:EF:D9 
1C:7E:E5:E2:EF:D8 
1C:7E:E5:E2:EF:D7 
1C:7E:E5:E2:EF:D6 
When you see a group of APs with BSSIDs that increment sequentially, as shown above, it usually 
means that they are part of the same network. If we identify one of the BSSIDs as in-scope, we 
can usually assume that the same is true for the rest of the BSSIDs in the sequence. 
1C:7E:E5:E2:EF:D9 
1C:7E:E5:E2:EF:D8 
1C:7E:E5:E2:EF:D7 
1C:7E:E5:E2:EF:D6 
Advanced Wireless Attacks Against Enterprise Networks 
Target Identification Within A Red Team Environment 
© 2017 Gabriel Ryan All Rights Reserved 
6 
OUI Prefixes 
The first three octets in a mac address identify the manufacture of the device. If we discover 
evidence that the client has a contract with certain hardware manufactures, we focus our 
attention on APs with OUI prefixes that correspond to these brands. 
Using Geographic Cross-Referencing To Identify In-Scope Access Points 
The most powerful technique we can leverage is geographic cross-referencing. We mentioned 
that Evil Corp has 57 offices worldwide. If we see the same ESSIDs appear at two Evil Corp 
locations, and no other 3rd party is present at both of these locations as well, it is safe to conclude 
that the ESSID is used by Evil Corp. 
We’ll apply these principles to identify in-scope access points in our airodump-ng output from 
the last section. Before we continue, we should attempt to decloak any wireless access points 
that have hidden ESSIDs. We do this by very briefly deauthenticating one or more clients from 
each of the hidden networks. Our running airodump-ng session will then sniff the ESSID of the 
affected access point as the client reassociates. Tools such as Kismet will do this automatically, 
although on sensitive engagements it’s preferable to do this manually in a highly controlled 
fashion. 
To perform the deauthentication attack, we use the following command: 
If successful, the ESSID of the affected access point will appear in our airodump-ng output. 
CH 11 ][ Elapsed: 1 min ][ 2017-02-02 13:49 
BSSID 
PWR 
RXQ 
Beacons 
#Data 
#/s 
CH 
MB 
ENC 
CIPHER 
AUTH 
ESSID 