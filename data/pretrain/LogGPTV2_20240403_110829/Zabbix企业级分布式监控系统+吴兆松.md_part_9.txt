!50100PA
020130913
ALUE
VALI
THAN
ENGIN
ENGIN
NGIN
图3-49
在图3-49中，时间戳使用的是数值，可以通过Linux下的date命令直接进行
转换。
时间转换为数值格式如下。
shel1#date-d"2014-06-09"+%s
1402243200
数值转换为时间格式如下。
2014-06-09
下面的例子是查询指定时间段的数据。
mysql> select count(*) from history_log where timestamp>138643200
0 and timestamp select count(*) from history_log where timestamp>138660480
0and timestamp$(TABLE_NAME).
Tbs
sleep 1
57
---
## Page 74
Zabbix企业级分布式监控系统
done
["$?" == O ] && echo "${DATE}: Backup zabbix succeed"
>>S(MyS
QL_DUMP_PATH)/logs/ZabbixMysqlDump.log
[ "$?" != O ] && echo "${DATE): Backup zabbix not succeed" >> ${MyS
QL_DUMP PATH)/logs/ZabbixMysqlDump.log
Cd ${MySQL_DUMP PATH}/
rm-rf $(date+%Y%m%d--date='5 daysago')
exit0
58
---
## Page 75
第4章快速配置和使用
本章在第3章的基础上，介绍Zabbix的快速配置使用，让读者了解配置流程，
通过本地浏览器访问http://ServerIP/zabbix开始配置和使用Zabbix。
默认的用户名为Admin，密码是zabbix，其用户名和密码存于数据库中。
mySql> SELECT * FROM zabbix.users WHERE alias='Admin';
如果忘记Admin用户名和密码，可以直接修改数据库密码字段，命令如下：
mysql> UPDATE zabbix.users SET passwd=md5('zabbix') WHERE alias='
Admin';
mySql> FLUSH PRIVILEGES;
使用Zabbix进行监控之前，要理解Zabbix监控的流程。
4.1配置流程
Zabbix完整的监控配置流程可以简单描述为：
）（）（）（）
在实际使用的时候，Items、Trigger、Graph 通常采用模板进行监控配置，
模板的特点就是可以对相同需求的监控项重复使用，无须对每台主机进行逐个
设置。
对于使用Zabbix来说，配置Graph不是必需的，因为没有配置图形，数据获
取也不影响，数据获取是Items的功能，但是对用户（Zabbix的Web界面用户）
来说，没有图形，就无法看到可视化的数据，因此，需要对最关心的Items添加
图形，以便将数据可视化。
配置Trigger不是必需的，但是对于特别关注的数据，需要对取到的值进行条
件判断，这时配置触发器就是必需的。
另外，如果想集中查看图形，可以使用Screens功能（遗憾的是，Screens功
能并不十分完美，只能满足一般需求）。
下面用一张图来展示Zabbix的运行流程，如图4-1所示，该图更能体现各种
逻辑关系。
---
## Page 76
Zabbix企业级分布式监控系统
读者当前只需要对这个流程图有一个简单的印象即可，待学习完本章，再回
过来看这个图，会加深理解。
Zabbix配置流程图
gger正则
tigger依赖
bgger等强
图4-1
简单的逻辑可以用图4-2表示。
Notic
Actio
Host
Items
Trigger
n
Command
Event
图4-2
下面我们来配置Zabbix。
60
---
## Page 77
第4章
快速配置和使用
4.2主机组的添加
分组的目的是将同一属性的主机归类，如果你不想将新添加的主机归纳为自
定义的分组，可以使用默认的分组。
配置主机组，打开前端Web页面，单击Configuration→Hostgroups，如图4-3
所示。
ZABBIX
图4-3
主机组中可以包含主机，也可以包含模板。
建议：对同一属性的主机或者模板，尽量归纳到分组，方便以后管理。分组
原则如下。
·以地理位置的纬度进行划分。
·●以业务为单位划分组。
·以机器用途划分。
●以系统版本划分。
●以应用程序划分组。
·其他方式等。
按组划分的好处是方便分组管理，如图4-4所示，就是以组划分的实例。
esI Hosts Mah
nceIActio
History:DashboardOverview
CONFIGURATION OF HOST GROUPS
Host groups
Displaying 1to9of9 found
Name
Members
Discoveredhosts
[emplates (0)
Hosts (1)
devops.itnibao.com
Hypervisors
Temiplates(o)
Hosts (0)
Temolates(1)
Linux Cluster App
Hosts(0)
Tenplates (0)
Hosts()
Templates (0)
rox
Hosts（0）
TemplatOLinumlatppabbixerveremlatApa
SNMPeviceetMPindwmltNMisk
SR1630,TemolateAppMySOL,JemplateOSQpenBSD,TemplateO
Terolates(39)OsWindows,TemplateMxGenenic,Template MXTomrat,Templal
Iemplates
Hosts(1)
Ieatlaice
IemlatPvicemlatMil
devops.itnihao.com
图4-4
61
---
## Page 78
Zabbix企业级分布式监控系统
如何添加新主机组呢？方法是单击Host groups上的按钮Createhost group,
如图4-5所示。
Help|Get support|Pnint|Profile|Logout
my-zabbix-monito
earch
ostgroups
Createhostgroup
图4-5
单击后会出现一个添加新主机组的界面，如图4-6所示。
esHostsNa
A
CONFIGURATION OF HOST GROUPS
Hostgroup
Groupname
webapp
Hosts
Other hosts|Grou
ost
图4-6
在图4-6中，“Group name”是组的名称：“Hosts Hosts in”是选择哪些设备
属于这个新添加的组。
单击Save保存，新添加的主机组就可以显示在主机组列表中，如图4-7所示。
Templates (o)
web-app
Hosts (0)
图4-7
当单击主机组中的信息名称时，会跳转到相关的页面。例如，单击Hosts，会
跳转到属于此组的Host主机列表。
如果想在数据库中查看主机组，运行下面这条语句即可。
62
---
## Page 79
第4章
快速配置和使用
mysql> SELECT * FROM zabbix.groups;
#如图4-8所示
groupid
Templates
Disco
business manager group3
zdnos6 dde
web
Dey
webappgroup3
webapp
Dev
图4-8
4.3模板的添加
监控项、触发器、图形、Web、Discovery等都是存在于主机之上的，由于多
个主机都会用相同的监控配置，因此，可以对这部分同类的数据进行归纳抽象，
即将这些数据做成模板。当我们需要对其他监控数据进行配置的时候，只需要对
相应的主机添加对应的模板即可。
配置模板的步骤为：单击Configuration→Templates→Createtemplate，如图4-9
所示。
ZABBIX
LOFTEM
Templates
Displaying 1to39of39found
Templates
Applications
Items
Triggers
Graphs
Discovery
Web
图4-9
创建模板，依次单击Templates→Createtemplate，如图4-10所示。
Help|Get support|Print|Profile|Logout
my-zabbix-monitor
ITser
Search
Import
GroupTemplates
日
图4-10
填入模板名称和所属的组，如图4-11所示。
63
---
## Page 80
Zabbix企业级分布式监控系统
guration
es|Hosts|Mal
slidesho
History:Configuration of templatesConfiguration of hostsConfiguration of templatesConfiguration of host groul
CONFIGURATIONOFTEMPLATES
TemplateLinked templatesMacros
Template nameweb-app
Visible nameweb-app
Groups In groups
Other groups
Templates
Discovered hosts
Hypervisors
Linux Cluster App
Virtual machines
proxy
web-app
web-xa
Zabbix servers
Newgroup
Hosts/templates In
Other|groupDisco
devops.itnihao.com
图4-11
模板具有继承的功能（将一个模板在另外一个模板中使用），如图4-12所示。
History: Configuration of templates
Configuration ofhosts>Configurationof templates
Configurat
CONFIGURATION OF TEMPLATES
Template
Linked templates
Macros.
Linked templates
SName
Action
No templates linked.
Linknew templates
zabbix
TemplateAppZabbixProxy
TemplateAppZabbixServer
Save
图4-12
搜索当前已经存在的模板，然后单击Add添加（在Zabbix2.2中，将添加数
据的方式改为搜索，而非弹框进行选择，对于习惯了使用Zabbix2.0之前版本的
读者，会感觉这个功能的改进并不方便）。
模板中也可以设置宏，如图4-13所示。
宏主要是对变量的定义，设置宏的作用是方便后面在Items、Trigger中引用，
在模板中配置一个宏，在不同的主机对该宏设置不同的变量值，从而达到模板化
通用的目的。
64
---
## Page 81
第4章快速配置和使用
CONFIGURATION OF TEMPLATES
Template
Linked templates
Macros
Value
Remove
Add
Cancel
图4-13
注意，宏的名称为{S名称}，宏的字符范围为“A～Z、0～9、、.”，如果不
是这个范围的字符，一律是无效的（请读者参考5.4节的内容）。
查看新建的模板，如图4-14所示。可以看到，Items中已经有三个Items了，