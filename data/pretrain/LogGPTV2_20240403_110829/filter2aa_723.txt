The$env:PATH lessTraveledisFull
ofEasyPrivilegeEscalationVulns
Bio
 SecurityResearcher/Tester(HarrisCorp)
 FormerArmyRedTeamOperator
 OneofthedevelopersofPowerSploit
 Twitter:@obscuresec
 Blog:www.obscuresec.com
Sucksalotlessnow…
Gettingevenbetter…
 OneGet
 ChocolateyNuget
 PSGet
 Alloftheseutilitiesaregreatfor:
 Simplifying3rdpartypatching
 Researchingvulnerabilities
 CTFbuilders
OneGet
 “OneGet isanewwaytodiscoverandinstall
softwarepackagesfromaroundtheweb.”
 Itletsyou“seamlesslyinstallanduninstall
packagesfromoneormorerepositorieswitha
singlePowerShellcommand.”
 OneGet willshipwithPowerShellv5
 PointedtoChocolateyRepobydefault
 https://github.com/OneGet/oneget
ChocolateyNuget
 Packagemanagerandreposerverwithalmost
4milliondownloads
 Over30contributors
 Microsoft“supported”opensourceproject
 https://chocolatey.org/
PSGet
SecurityReview
 Requestedtodoareview
 StartedwithoneVM
 Triedtoinstall1800chocolatey packages
Wellthere’syourfirstproblem…
SecurityReview(continued)
 Created25Windows7/8VMs
 Scriptedinstallationacrossthem
 Still2bluescreensafterrebooting
 ScriptedsubmittinghashestoVirusTotal
 100“new”hashes
 31packageswithdetections
PrivilegeEscalation
 Usedtheopportunitytowriteanewtool
 lookedforcommonprivilegeescalationvulns
 %PATH%based
 Filepermissionbased
 Servicepermissionbased
 Dllpreloading
 FoundabunchandcouldtunewiththeVMs
 Disclosuresucks
 MostwereapplicationsthatIhadneverheardof
RepositoryServers
 Mustbetrusted
 Chocolateyrepositoryisthemostpopular
 Allowscontributionsfromnondevelopers
 MustbeenabledinOneGet
 Thepackagemanagersinheritvulnerabilities
fromthereposerver
ChocolateyPackages
The$env:PATH
PSv3usesthePATH…
Soausercan…
Iseewhatyoudidthere…
Beforethefix…
DemoTime
Thanks
 MattGraeber
 JoeBialek
 WillSchroeder
 WillPeteroy
 LeeHolmes
 Manyothers…
Questions?