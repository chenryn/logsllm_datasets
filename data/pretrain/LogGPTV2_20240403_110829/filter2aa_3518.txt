R I C K Y  H I L L  
D E F C O N  2 1  
8 / 3 / 2 0 1 3  
Phantom Network Surveillance 
UAV / Drone 
1 
About Me 
 Security Consultant, D.C. Area 
 Specialties: Wireless & SCADA Security 
 US Govt. & Commercial 
 Previous DEFCON Talks:  
   WarRocketing & WarBallooning, (over Las 
Vegas ;-) 
 Hobbies:  R/C heli’s, Deep Sea Fishing 
2 
What Talk is NOT About 
 Having UR Dry Cleaning Delivered ->  
3 
Outline 
 Intro - Aerial Wireless Surveillance 
 Past attempts: Balloons, Rockets, UAVForge 
 New Technology: The Phantom Drone 
 Building the Network Surveillance Drone 
 Flights & Results 
 Conclusion 
4 
What this is Really About 
 Aerial, wireless (802.11) network surveillance 
  Past Attempts: 
 DARPA - UAVForge, 2011 
 Blackhat 2011: WASP spy drone 
5 
UAVForge “Perch and Stare” 
 OK, so this hawk 
doesn’t have a 
Pineapple, but he’s 
definitely perfected 
the technique! -> 
6 
But I luv Heli’s & Drones:                             
Why did UAVForge fail?  
 143 teams from 153 countries competed ->       
No One Won. 
 Factors: 
   - Govt. required op’s beyond LoS 
   - Limited FPV capabilities 
   - Ambitious, autonomous operations 
   - Some highlights (uavforge.net) 
7 
UAVForge Crashes 
8 
Meet “THE” DJI Phantom 
 DJI Innovations introduced the Phantom 
JAN 2013 
 It quickly gained a reputation for being the 
most stable drone platform in the air today 
 Features:  
GPS  
Auto “Return to Home”  
Payload: up to 400 grams 
$679. UAVForge Dones: $2K-9K 
9 
What’s New since 2011? 
 Technology has improved dramatically: 
 Tiny computers: Cotton Candy (30 gr.) 
 CC:  Bluetooth, HDMI, 802.11 capable 
 Wifi Pineapple:  remote 3G, 4G 
 DJI Phantom = the first “consumer quality” 
drone that is easily flyable by the average 
person.  
10 
TechnoLust Overcomes Me: Let’s build this! 
 Designed & Built 2 payloads: 
 Cotton Candy + WiSpy or KillerBee 
 Flying Pineapple = Hak5 Pineapple + GSM 3G/4G 
11 
Site Survey Payload 
 Cotton Candy makes a perfect headless 
computer 
 Apple Bluetooth KB & Mouse “detach” instantly 
 ARM processor runs Ubuntu or Android O/S 
 1.2 GHz ARM Cortex-A9 CPU, 1GB of RAM, 
image on microSD  
 Wireless Tools:  Kismet, Wispy (spectools) 
available, or pretty much any USB device, even 
Killerbee for ZIGBEE 
12 
WiSpy Flight Results 
 VA Waterfront Neighborhood: 
13 
WiSpy Flight Results 
 2.4 Ghz: 
14 
We found 802.11 sources – What’s next? 
 The “Flying Pineapple”:  
 Tools: Airodump, sslstrip, site survey, et. al. 
 Payload Objectives: 
[1] Land on any unique Vantage Point: Buildings, 
Towers, Balconies, etc. “Perch”… 
[2] Conduct Op’s 
[3]  Return Phantom safely to Starting Point 
15 
Network Diagram 
 Reverse ssh tunnel -> Hawaii Relay Server 
16 
Hak5 Video 
Episode 1112 
Pineapple Offensive Ops 
 Selected Pineapple Capabilities: 
OpenWRT running Jasager – >“the yes man” 
URL Snarf 
DNS Spoofing 
New http landing page for phishing, etc. 
 airodump-ng runs great in-flight!  
cd /usb/airodump-ng-logs 
airomon-ng start wlan0  (monitor mode) 
airodump-ng -w pcap mon0 
17 
Flight2:  Airmon-NG 
 Public Beach Flyover: 
 AIRMON-NG 
 In-Flight Monitor Mode 
 NO!  We are not looking for  Bikini’s… 
 How many people using wireless here? 
 Flight video & pcap  
18 
“Oh NO!!!”  Moments 
 All was not perfect with our Phantom 
Adventures… 
 A couple Incidents you may find amusing-> 
 Video 
19 
Crash:  Phantom v2 
20 
Flight3:  Rooftop Landing 
 Large Party Platform overlooking recreation 
area @ the Lake: 
 AIRMON-NG 
 Site Survey 
 UrlSnarf 
 Great Vantage Point!   (Video) 
21 
Flight3:  Results 
 sslstrip-> 
 urlsnarf-> 
22 
How did we compare to UAVForge Team Scores?
23 
How did we compare to UAVForge Team Scores?
Phantom  = 35 
5 th place 
24 
Conclusion / Future Work 
 Phantom Network Surveillance Drone:  
 Successful proof of concept of “Perch, 
Listen, and Engage” wireless network 
surveillance 
 Highly effective site survey tool 
25 
Next Time 
Next DARPA Challenge: 
Full FPV for non-LoS operations 
Autonomous operation with waypoints, (Naza-
M available now.) 
Descent rate instruments for precision landing 
Extend 4 Hr. surveillance capability with better 
power design... Multiple building operations 
become possible. 
26 
Legal & Safety Issues 
 Do NOT attempt to fly a quadcopter as large 
and expensive as the Phantom without 
experience! (I highly recommend joining an R/C 
club or getting a mentor). Start small:  the 
Blade MQX quadcopter is ideal… 
 Under current FAA rules flying beyond LOS or 
above 400 ft. AGL  is Illegal 
 Under no circumstances fly within 5 miles 
of any airport. 
 Do NOT violate people’s privacy with cameras 
or other devices. 
27 
How High is 400 ft? 
 www.apogeerockets.com  $49  
28 
Shout Outs 
29 
Thanks To-> 
Tenacity Alpha Ops Team - Flight Support 
Nick Hopler: Heli’ Op’s & Video Production 
Hobby Hangar, Chantilly, VA 
Checked your Roof Lately? 
30 
Questions? 
Bibliography 
 DARPA UAVForge project site: 
http://www.uavforge.net/ 
 DJI Innovations, Inc. Phantom: http://www.dji-
innovations.com/product/phantom/ 
 Cotton Candy Computer: 
http://www.fxitech.com/cotton-candy/what-is-it/ 
 WiFi Pineapple (Hak5): “The Hot-Spot Honeypot 
Pen-Testing Platform”: http://wifipineapple.com/ 
 Congressional Research Service, “Integration of 
Drones into Domestic Airspace: Selected Legal 
Issues”, Dolan and Thompson, April 4, 2013 
32 
 Site Survey Payload  
33 
 Site Survey Payload - Hardware 
 Cotton Candy: www.store.cstick.com 
 Apple Bluetooth Wireless Keyboard, A1314 
 HP Bluetooth Touch to Pair Mouse, 
#H4R81AA#ABA 
 Wi-Spy Spectrum Analysers, 900 Mhz, 2.4, 
5 Ghz    www.metageek.net 
 Eflite 1S, 3.7v Battery redrockethobbies.com 
 Protek 2A USB Adapter: 
http://www.bigsquidrc.com 
34 
 Site Survey Payload - Software 
 WiSpy: install spectools-> 
http://www.kismetwireless.net/spectools/ 
 Cotton Candy – attach bluetooth KB & 
mouse: 
hcitool scan   (finds bluetooth addresses) 
sudo apt-get install bluez-compat 
sudo hidd-connect  
35 
 Killerbee Zigbee Payload 
 Hardware: Amtel ATA-RZusbstick with firmware 
flash for Killerbee, (Joshua Wright) 
 Cotton Candy HW Config, (same as Wi-Spy) 
 Software: 
https://code.google.com/p/killerbee 
apt-get install python-gtk2 python-cairo python-
usb python-crypto 
cd /killerbee 
python setup.py install 
zbstumbler, zbfind, etc.             
36 
 Pineapple Payload 
37 
 Pineapple Payload - Hardware 
 WiFi Pineapple Mark IV  
http://hakshop.myshopify.com 
 Protek 2A USB Adapter: 
http://www.bigsquidrc.com 
 Eflite 2S, 1300 mAh, 7.4 v battery 
redrockethobbies.com 
 T-Mobile ZTE MF591 Rocket 3G 4G    
http://t-mobile.com 
38 
 Pineapple Payload - Software 
 Enabling T-Mobile USB Mass Storage & 
Swap Space:  
https://forums.hak5.org/index.php?/topic/25882-
how-to-enable-usb-mass-storage-with-swap-
partition/ 
 Note: U must mount storage and swap via 
UUID’s!  
sudo BLKID 
Enter uuid in fstab 
39 
 Pineapple – Internet Relay 
 Persistent ssh, Hak5 episode 1112-> 
http://hak5.org/episodes/hak5-1112 
 Relay Server Provider: digitalocean.com 
 Software: 
cd /etc/ssh  (on relay) 
nano sshd_config 
AllowTcpForwarding “yes” 
GatewayPorts “yes” 
40 
 FPV Parts List 
 First Person View (FPV) Hardware: 
Mini FPV Camera with 5.8Ghz TX Combo, 
http://www.unmannedtechshop.co.uk/fpv-gear/5-
8ghz-tx-rx/mini-fpv-camera-with-5-8ghz-tx-
combo.html 
Foxtech RC-305 Receiver   foxtechfpv.com 
41 
 Phantom Drone Adds / Improvements 
 High Performance Props 
Graupner E-Prop 9x5 (2x CW, 2x CCW)  team-
blacksheep.com 
 Extended Landing Gear 
PhantoMounts Carbon Fiber Landing Gear 
rcdude.com 
 Battery Tray  
PhantoMounts Wide CF Battery Tray                 
rc-drones.com 
42