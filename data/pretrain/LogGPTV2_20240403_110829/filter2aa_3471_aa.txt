http://Irongeek.com
Adrian Crenshaw
http://Irongeek.com
 I run Irongeek.com
 I have an interest in InfoSec 
education
 I  don’t  know  everything  - I’m  just  a  
geek with time on my hands
 Sr. Information Security Consultant 
at TrustedSec
 Co-Founder of Derbycon
http://www.derbycon.com
Twitter: @Irongeek_ADC
http://Irongeek.com
 I will be taking two perspectives
 People trying to stay anonymous
 People trying to de-anonymize users
 I’m  not  really  a  privacy  guy
 IANAL
 Be careful where you surf, contraband awaits
http://Irongeek.com
http://Irongeek.com
Darknets
 There are many definitions, but mine is 
“anonymizing  private  network  ”
 Use of encryption and proxies (some times other 
peers) to obfuscate who is communicating to whom
 Sometimes referred to as Cipherspace
(love that term)
http://Irongeek.com
The Onion Router
http://Irongeek.com
 Who?
First the US Naval Research Laboratory, then the EFF and now the Tor Project 
(501c3  non-profit).
http://www.torproject.org/
 Why?
“Tor  is  free  software  and  an  open  network  that  helps  you  defend  against  a  form  
of network surveillance that threatens personal freedom and privacy, 
confidential business activities and relationships, and state security known as 
traffic  analysis.”  ~  As  defined  by  their  site
 What?
Access normal Internet sites anonymously, and Tor hidden services. 
 How?
Locally run SOCKS proxy that connects to the Tor network.
http://Irongeek.com
 Layered encryption
 Bi-directional tunnels
 Has directory servers
 Mostly focused on out proxying to the Internet
 More info at https://www.torproject.org
Internet Server
Directory Server
http://Irongeek.com
http://Irongeek.com
Image from  http://www.torproject.org/hidden-services.html.en
http://Irongeek.com
Image from  http://www.torproject.org/hidden-services.html.en
http://Irongeek.com
Image from  http://www.torproject.org/hidden-services.html.en
http://Irongeek.com
Image from  http://www.torproject.org/hidden-services.html.en
http://Irongeek.com
Image from  http://www.torproject.org/hidden-services.html.en
http://Irongeek.com
Image from  http://www.torproject.org/hidden-services.html.en
http://Irongeek.com
Client
Just a user
Relays
These relay traffic, and can act as exit points
Bridges
Relays not advertised in the directory servers, so harder to block
Guard Nodes
Used to mitigate some traffic analysis attacks
Introduction Points
Helpers in making connections to hidden services 
Rendezvous Point
Used for relaying/establishing connections to hidden services 
http://Irongeek.com
http://Irongeek.com
Tails: The Amnesic Incognito Live System
https://tails.boum.org/
Tor2Web Proxy
http://tor2web.org
Tor Hidden Wiki:
http://kpvz7ki2v5agwt35.onion
Scallion (make host names)
https://github.com/lachesis/scallion
Onion Cat
http://www.cypherpunk.at/onioncat/
Reddit Onions
http://www.reddit.com/r/onions
http://Irongeek.com
Pros
 If you can tunnel it through a SOCKS proxy, you can make 
just about any protocol work.
 Three levels of proxying, each node not knowing the one 
before last, makes things very anonymous.
Cons
 Slow
 Do you trust your exit node?
 Semi-fixed Infrastructure: 
Sept 25th 2009, Great Firewall of China blocks 80% of Tor 
relays listed in the Directory, but all hail bridges!!!
https://blog.torproject.org/blog/tor-partially-blocked-china
http://yro.slashdot.org/story/09/10/15/1910229/China-Strangles-Tor-Ahead-of-National-Day
 Fairly easy to tell someone is using it from the server side
http://www.irongeek.com/i.php?page=security/detect-tor-exit-node-in-php
http://Irongeek.com
(Keep in mind, this is just the defaults)
 Local
9050/tcp Tor SOCKS proxy
9051/tcp Tor control port
(9150 and 9151 on Tor Browser Bundle)
 Remote
443/tcp and 80/tcp mostly
Servers may also listen on port 9001/tcp, and directory 
information on 9030.
 More details
http://www.irongeek.com/i.php?page=security/detect-tor-
exit-node-in-php
http://www.room362.com/tor-the-yin-or-the-yang
http://Irongeek.com
http://geti2p.net
http://Irongeek.com
 Crypto Currency
 Proof of work 
 Bitcoin Addresses & Private Keys
 Block Chain (ledger)
 Tumblers (laundering)
 Way more info by Bob Weiss 
http://www.irongeek.com/i.php?page=videos/bsidesde2013/2-6-
hacking-benjamins-bob-weiss-pwcrack-into-to-bitcoin
http://Irongeek.com
On  Dec.  16th  2013  a  bomb  threat  was  made  to  Harvard’s  student  news  
paper and some officials.
The person used https://www.guerrillamail.com to send
email after connecting over Tor
Guerrilla Mail puts an X-Originating-IP header on that 
marked who sent the message, in this case a Tor exit point
To: "PI:EMAIL"  
From:  
Subject: Hey baby! 
X-Originating-IP: [74.128.28.74]
Content-Type: text/plain; charset="utf-8"
shrapnel bombs placed in: 
science center 
sever hall 
emerson hall 
thayer hall 
2/4. 
guess correctly.  
be quick for they will go off soon
http://Irongeek.com
All Tor nodes are publicly known (except bridges):
http://torstatus.blutmagie.de
Easy to correlate who was attached to Harvard network 
and using Tor at the same time the email was sent (unless 
you use a bridge).  
Eldo Kim was connected to the Tor network around that 
time.
Suspect Eldo Kim wanted to get out of a final and admitted 
he made the bomb threat when interviewed.
More Details:
http://arstechnica.com/security/2013/12/use-of-tor-helped-fbi-finger-
bomb-hoax-suspect/
http://www.scribd.com/doc/192371742/Kim-El-Do-Harvard
http://Irongeek.com
Lessons Learned:
 Don’t  be  the  only  person  using  Tor on a 
monitored network at a given time
 Use a bridge? 
 Don’t  admit  anything
 Correlation attacks are a bitch
http://Irongeek.com
5MB
8MB
Client
Client
Client
Client
http://Irongeek.com
Client
Client
Client
I could just 
watch the 
timings.
Pulse the 
data flows 
myself.
Or even just 
change the load 
on the path.
DoS outside 
host to affect 
traffic. 
http://Irongeek.com
DNS 
Query 
Monitored DNS Server
If  I  don’t  use  the  
proxy for DNS, I 
may send the 
query to a DNS 
server.  It  won’t  
see my traffic 
to/from the 
destination, but 
may now know 
I’m  visiting  
someplace.com/
.onion/.i2p
http://Irongeek.com
 Hector Xavier Monsegur (Sabu) normally 
used Tor for connecting to IRC but was 
caught not using it once and FBI found 
his home IP. After being caught, he 
started to collaborate. 
 Hector spoke with Jeremy Hammond 
(sup_g) on IRC, and Jeremy casually let 
slip where he had been arrested before 
and groups he was involved with. 
 This narrowed the suspect pool, so the 
FBI got a court order to monitor his 