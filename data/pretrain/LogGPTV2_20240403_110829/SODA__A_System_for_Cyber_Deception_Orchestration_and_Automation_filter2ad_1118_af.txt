✓
✓
✓
-
✓
✓
✓
✓
-
-
-
✓
✓
✓
✓
✓
✓
✓
✓
✓
-
✓
✓
✓
✓
✓
✓
✓
✓
✓
✓
✓
✓
✓
✓
✓
✓
✓
✓
✓
✓
✓
-
-
✓
✓
✓
✓
✓
✓
✓
✓
✓
✓
✓
✓
Service Stop
Data Encrypted for Impact
Impact
Table 8: Comparison of SODA with other related tools in
terms of detecting different MITRE ATT&CK techniques
within malware execution.
back to the malware that the file is opened and content is
read without invoking the actual ReadFile call. In addition,
static content is provided by SODA for this ReadFile call. For
instance, if the malware wants to read the content of a file
named “input.txt," where the content is “It’s a text file", SODA
pretends the ReadFile was called and content of “input.txt"
is read; however, it shows “It’s not a text file" instead of “It’s
a text file" to the attacker.
• FakeExecute: Under this strategy, the action of the malware
is performed on a remote machine and SODA sends back
the response it received by running the action on a remote
machine. For example, the attacker wants to know the IP ad-
dress of the victim machine; hence the malware is designed
to run the “ipconfig" command on the victim machine. In this
✓
✓
✓
✓
✓
✓
-
✓
✓
✓
✓
✓
✓
-
-
✓
✓
✓
✓
✓
✓
✓
✓
-
-
-
-
✓
✓
-
-
-
-
✓
✓
✓
✓
✓
-
-
-
-
-
✓
✓
✓
✓
✓
✓
-
-
✓
✓
-
-
-
-
-
-
-
-
-
-
-
-
✓
-
-
-
-
-
-
-
✓
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
✓
-
-
-
-
-
-
-
-
-
-
✓
-
-
-
✓
✓
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
✓
✓
✓
✓
✓
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
✓
-
-
-
-
-
-
Figure 12: Call flow with and without API Hooking. In some
case, Response is return via the original API (5a, 5b), other-
wise, Detour function responds directly (5).
A DECEPTION 4D GOALS
• Diversion: Diversion means leading an adversary to a fake
target instead of a real one by giving deceptive responses
to any adversary queries or providing honey information.
For instance, diversion can be achieved by redirecting the
adversary’s exfiltration traffic to a decoy server.
• Distortion: Distortion creates confusion in the adversary’s
mind by providing too many options and ambiguity in cy-
berspace. For instance, while an adversary searches for user
credentials, providing multiple yet honey credentials will
distort the adversary’s view of the system.
• Depletion: Depletion means delaying the adversary’s prop-
agation into the attack kill-chain by consuming his power or
resources. As an example, we can deplete a Ransomware by
creating a delayed response without doing any encryption,
but responding encryption is not done yet..
• Discovery: Discover means figuring out new attack tech-
niques by letting an adversary executes its desired action
but in a contained environment. It can be done by running
malware inside a deception framework such as SODA.
B DECEPTION STRATEGIES
• FakeFailure: Under this strategy, SODA responds to the
malware as if the operation failed where the actual WinAPI
has never been called. For example, if the malware calls
CreateProcess to create a child process, SODA responds
back to the malware that the child process creation failed
without invoking the actual CreateProcess call.
• FakeSuccess: Under this strategy, SODA responds to the
malware as if the operation was successful where the actual
WinAPI has never been called. For example, the malware
calls ReadFile to read the content of a file, SODA responds
Target Process(Malware)Original API(Function) call1. Call2. ReturnTarget Process(Malware)Original API(Function) call1. Call5. ReturnDetour Function(Inside Injected DLL)2. Jump3. Process Call4. Execute Deception Actions5(a). Return5(b). ReturnB. With API HookingA. Without API Hooking688SODA: A System for Cyber Deception Orchestration and Automation
ACSAC ’21, December 6–10, 2021, Virtual Event, USA
scenario, SODA intercepts this call and runs the “ipconfig"
command on a remote machine(HoneyFactory) and sends
the response back to the attacker. Therefore, the attacker re-
ceives the IP address of the remote machine (HoneyFactory).
• NativeExecute: Under this strategy, SODA lets the malware
run so that it can discover the current/future actions of the
malware.
C HOW API HOOKING WORKS
EasyHook [5], a free, open-source hooking library for 32-bit and
64-bit Windows processes released under the MIT license in this
project. EasyHook provides a generic template for APIs hooking. In
addition, EasyHook ensures thread safety by using a thread dead-
lock barrier. EasyHook utilizes the CreateRemoteThread function
to create a thread in the target process and use it to load the de-
sired DLL. We install the hook by defining a detouring function
for each original WinAPI call we want to intercept. As a result,
the detouring functions take control of the malware and provide
us with the option to enforce our code to modify the execution.
Without API hooking, the API call flow is depicted in Figure 12A,
where the original API is responsible for performing the task and
return response. With API hooking, the call is jumped from the
original API to our detour function (Figure 12B), where we process
the call and execute our deception techniques and respond back to
the malware.
D CAPABILITY OF DETECTING DIFFERENT
MITRE ATT&CK TECHNIQUES
In Table 8, we compared SODA with other related tools in terms
of detecting different MITRE ATT&CK techniques within malware
execution. Clearly, SODA has better coverage in term of detecting
MITRE ATT&CK techniques. In addition, SODA can provide fine-
grained mapping, where the other tools provide the coarse-grained
mapping. Other tools, for example, can detect Exfiltration and C&C
sorts of actions at the MITRE tactics level, whereas SODA can detect
MITRE techniques level details, as shown in table 8.
689