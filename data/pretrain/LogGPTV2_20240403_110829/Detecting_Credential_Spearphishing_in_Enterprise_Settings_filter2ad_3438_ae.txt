detector to select entire batches of them because they
share the same DAS score.
Extending to Preventative Protection: One could ex-
tend our real-time detector to operate in a preventative
fashion. As emails arrived, our detector could compute
each email’s feature values and then check each URL in
the email to see whether or not it would generate an alert
if the URL were clicked at that moment. If so, we could
rewrite the email’s URL (before delivering the email to
its recipient) to point to an interstitial warning page set
up by the enterprise’s security team. Our computations
show that if we used our real-time detector with a budget
of 10 alerts/day, an employee would encounter a median
of 2 interstitial pages over the nearly 4-year time span of
our evaluation data (Appendix B). Given this low bur-
den, future work could explore how to design effective
warning mechanisms as part of a preventative defense.
8 Related Work
Recently, a number of papers have highlighted the threat
of spearphishing and explored potential defenses [8, 12,
19, 24]. Closest to our work, the systems proposed by
Stringhini et al. [19], Duman et al. [8], and Khonji et
al. [12] build behavioral models for senders based on
metadata, stylometry, and timing features. They then
classify an email as spearphishing or not by using the be-
havioral model to see whether a new email’s features dif-
fer from the sender’s historical behavioral proﬁle. This
prior work cannot detect spearphish sent by a previously
unseen attacker since the sender has no prior history (and
thus no behavioral model to compare the attack email
against). More importantly, when they evaluate their sys-
tems on smaller datasets with simulated attacks, the best
performing detectors obtain false positive rates (FPRs)
482    26th USENIX Security Symposium
USENIX Association
in the range of 1–10%. Although quite low, an FPR of
even 1% is too high for a practical enterprise settings;
our dataset contains over 250,000 emails per day, so an
FPR of 1% would lead to 2,500 alerts each day. In con-
trast, our detector can detect real-world attacks, includ-
ing those from a previously unseen attacker, with a bud-
get of 10 alerts per day.
Other work has characterized the landscape of
spearphishing attacks against individual activists and dis-
sidents [9, 15, 16, 20]. This body of work shows that
targeted attacks on individuals span a wide spectrum of
sophistication, from simple third-party tracking software
and common exploits to purchasing specialized spyware
and exploits from commercial ﬁrms. Most recently,
LeBlond et al. conducted a large-scale analysis of exploit
documents used in targeted attacks [14]. Their analysis
found that none of these malicious attachments used a
zero-day exploit, and over 95% of these documents relied
on a vulnerability that was at least one year old. While
these attacks can succeed against vulnerable activists and
individuals, such dated exploits will likely fail against an
enterprise with good security hygiene. Indeed, over the
past few years, all of the spearphishing attacks on LBNL
have been credential spearphishing.
9 Conclusion
In this work, we developed a real-time detector for iden-
tifying credential spearphishing attacks in enterprise set-
tings. Two key contributions enabled our detector to
achieve practical performance: (1) a new set of features
that targets the two fundamental stages of successful
spearphishing attacks, and (2) a new anomaly detection
technique that leverages these features to detect attacks,
without the need for any labeled training data.
We evaluated our approach on an anonymized dataset
of over 370 million emails collected from a large national
lab. At a false positive rate of less than 0.005%, our sys-
tem detected all but two attacks in our dataset and uncov-
ered two previously unknown successful attacks. Com-
pared against our anomaly scoring technique, standard
anomaly detection techniques would need to generate or-
ders of magnitude more false positives to detect the same
attacks as our algorithm. Because of our approach’s
ability to detect a wide range of attacks, including pre-
viously undiscovered attacks, and its low false positive
cost, LBNL has implemented and deployed a version of
our detector.
Acknowledgements
The authors would like to thank Nicholas Carlini, Chris
Thompson, Alyosha Efros, and Paul Pearce for insight-
ful discussions and feedback. We would also like to
thank Partha Banerjee, Jay Krous, Stephen Lau, Vin-
cent Stoffer, and Adam Stone of the Lawrence Berke-
ley National Laboratory for their wide-ranging assistance
in conducting the research. This work was supported
by the AFOSR under MURI award FA9550-12-1-0040;
the National Science Foundation through CNS awards
1161799/1237265/1348077/1406041, Intel through the
ISTC for Secure Computing, Qualcomm, Cisco,
the
Hewlett Foundation through the Center for Long-Term
Cybersecurity, an NSF Graduate Fellowship, and a Face-
book Fellowship.
References
[1] Spear phishing: The top ten worst cyber attacks.
https://blog.cloudmark.com/wp-
content/uploads/2016/01/cloudmark_
top_ten_infographic.png.
[2] DMARC. https://dmarc.org/, 2016.
[3] Peter Bright.
not
Spearphishing + zero-day:
“extremely
sophisticated”.
RSA hack
http://arstechnica.com/security/
2011/04/spearphishing-0-day-rsa-
hack-not-extremely-sophisticated/,
April 2011.
[4] Elie Bursztein and Vijay Eranti.
Internet-wide
to ﬁght email phishing are working.
efforts
https://security.googleblog.com/
2013/12/internet-wide-efforts-to-
fight-email.html, Feb 2016.
[5] Varun Chandola, Arindam Banerjee, and Vipin Ku-
mar. Anomaly detection: A survey. ACM Comput.
Surv., 41(3):15:1–15:58, 2009.
[6] Nitesh Chawla, Nathalie Japkowicz, and Alek-
sander Kotcz. Editorial: special issue on learning
from imbalanced data sets. ACM SIGKDD Explo-
rations Newsletter, 6(1):1–6, 2004.
Community.
of
[7] Dropbox
rendering
//www.dropboxforum.com/t5/Manage-
account/Discontinuing-rendering-
of-HTML-content/td-p/187920,
2016.
Discontinuing
https:
content.
html
Sep
[8] Sevtap Duman, Kubra Kalkan-Cakmakci, Manuel
Egele, William Robertson, and Engin Kirda. Email-
proﬁler: Spearphishing ﬁltering with header and
stylometric features of emails. In Computer Soft-
ware and Applications Conference (COMPSAC),
2016 IEEE 40th Annual, pages 408–416. IEEE,
2016.
USENIX Association
26th USENIX Security Symposium    483
[9] Seth Hardy, Masashi Crete-Nishihata, Katharine
Kleemola, Adam Senft, Byron Sonne, Greg Wise-
man, Phillipa Gill, and Ronald J. Deibert. Tar-
geted threat index: Characterizing and quantify-
ing politically-motivated targeted malware. In Pro-
ceedings of the 23rd USENIX Conference on Secu-
rity Symposium, SEC’14, 2014.
[18] Steve Sheng, Mandy Holbrook, Ponnurangam Ku-
maraguru, Lorrie Faith Cranor, and Julie Downs.
Who falls for phish?: a demographic analysis of
phishing susceptibility and effectiveness of inter-
In Proceedings of the SIGCHI Confer-
ventions.
ence on Human Factors in Computing Systems,
pages 373–382. ACM, 2010.
[19] Gianluca Stringhini and Olivier Thonnard. That
ain’t you: Blocking spearphishing through behav-
In Detection of Intrusions and
ioral modelling.
Malware, and Vulnerability Assessment, pages 78–
97. Springer, 2015.
[20] Colin Tankard. Advanced persistent threats and
how to monitor and deter them. Network security,
2011.
[21] Lisa Vaas.
How hackers broke into John
https:
Podesta, DNC Gmail accounts.
//nakedsecurity.sophos.com/2016/
10/25/how-hackers-broke-into-
john-podesta-dnc-gmail-accounts/,
October 2016.
[22] Colin Whittaker, Brian Ryner, and Marria Nazif.
Large-scale automatic classiﬁcation of phishing
pages. In NDSS, volume 10, 2010.
[23] Wikipedia.
Server
name
indication.
https://en.wikipedia.org/wiki/
Server_Name_Indication, June 2017.
[24] Mengchen Zhao, Bo An, and Christopher Kiek-
intveld. Optimizing personalized email ﬁltering
thresholds to mitigate sequential spear phishing at-
tacks. In AAAI, pages 658–665, 2016.
[10] Haibo He and Edwardo A Garcia. Learning from
imbalanced data. IEEE Transactions on knowledge
and data engineering, 21(9):1263–1284, 2009.
Dropbox
scam hosted
users
on
targeted
dropbox.
[11] Nick
Johnston.
phishing
by
https://www.symantec.com/connect/
blogs/dropbox-users-targeted-
phishing-scam-hosted-dropbox,
2014.
Oct
[12] Mahmoud Khonji, Youssef Iraqi, and Andrew
Jones. Mitigation of spear phishing attacks: A
content-based authorship identiﬁcation framework.
In Internet Technology and Secured Transactions
(ICITST), 2011 International Conference for, pages
416–421. IEEE, 2011.
[13] Aleksandar Lazarevic, Levent Ertoz, Vipin Kumar,
Aysel Ozgur, and Jaideep Srivastava. A compar-
ative study of anomaly detection schemes in net-
In Proceedings of the
work intrusion detection.
2003 SIAM International Conference on Data Min-
ing, pages 25–36. SIAM, 2003.
[14] Stevens Le Blond, C´edric Gilbert, Utkarsh Upad-
hyay, Manuel Gomez Rodriguez,
and David
Choffnes. A broad view of the ecosystem of so-
In NDSS,
cially engineered exploit documents.
2017.
[15] Stevens Le Blond, Adina Uritesc, C´edric Gilbert,
Zheng Leong Chua, Prateek Saxena, and Engin
Kirda. A look at targeted attacks through the lense
In USENIX Security, pages 543–558,
of an ngo.
2014.
[16] William R Marczak, John Scott-Railton, Morgan
Marquis-Boire, and Vern Paxson. When govern-
ments hack opponents: A look at actors and tech-
nology. In USENIX Security, pages 511–525, 2014.
[17] Trend Micro.
bait.
Spear-phishing email: Most
Trend Mi-
http://www.trendmicro.com.au/cloud-
favored APT attack
cro,
content/us/pdfs/security-intelligence/white-
papers/wp-spear-phishing-email-most-favored-
apt-attack-bait.pdf
2012.
(accessed 1 October 2014),
484    26th USENIX Security Symposium
USENIX Association
A Feature Vectors and Comparators per
Sub-Detector
Name spoofer Features
Host age of clicked URL
(email ts − domain’s 1st visit ts)
# visits to clicked URL’s host prior to email ts
# weeks that From name has
sent email on ≥ 5 days
# days that From name and From addr
have appeared together in emails
Comparator for DAS
≤
≤
≥
≤
Table 5: Summary of the feature vector for our name spoofer
sub-detector and the “suspiciousness” comparator we provide
to DAS for each feature.
Previously unseen attacker Features
Host age of clicked URL
(email ts − domain’s 1st visit ts)
# visits to clicked URL’s host prior to email ts
# days that From name has sent email
# days that From addr has sent email
Comparator for DAS
≤
≤
≤
≤
Table 6: Summary of the feature vector for our previously un-
seen attacker sub-detector and the “suspiciousness” compara-
tor we provide to DAS for each feature.
Lateral attacker Features
Host age of clicked URL
(email ts − domain’s 1st visit ts)
# visits to clicked URL’s host prior to email ts
# distinct employees who have previously logged in
from the same city as the session’s new IP addr
# previous logins by the current employee from
the same city as the session’s new IP addr
Comparator for DAS
≤
≤
≤
≤
Table 7: Summary of the feature vector for our lateral attacker
sub-detector and the “suspiciousness” comparator we provide
to DAS for each feature.
B Preventative Interstitials
In Section 7 we discussed how to extend our detec-
tor from a realtime alert system to a preventative de-
fense by rewriting suspicious URLs in emails to redi-
rect to an interstitial page. This defense can only be
practical if it does not cause employees to frequently
land on interstial’ed pages. To assess this concern, we
ran our detector on our entire evaluation dataset (Sep
1, 2013 – Jan 14, 2017) with an average daily budget
of 10 alerts, and selected the alerts that fell within our
cumulative budget for that window (i.e., selecting the
top B = 10∗ NdaysInEvalWindow = 12,310 most suspicious
click-in-email events). For each recipient (RCPT TO
email address) that received the emails of those 12,310
alerts, we computed the number alerts that recipient re-
ceived over the entire evaluation time window. Figures 8
and 9 show these results in histogram and CDF form.
Figure 8: Histogram of alerts per RCPT TO address for our
detector using an average budget of 10 alerts per day across the
Sep 1, 2013 – Jan 14, 2017 timeframe.
Figure 9: CDF of alerts per RCPT TO address for our detector
using an average budget of 10 alerts per day across the Sep 1,
2013 – Jan 14, 2017 timeframe.
From these ﬁgures, we see that over 95% of employ-
ees would see fewer than 10 interstitials across the entire
time span of nearly 3.5 years.
USENIX Association
26th USENIX Security Symposium    485
020406080100120140X = alerts per RCPT TO: email address0500100015002000250030003500Num RCPT TO: addresses who generate X alerts20020406080100120140160X = alerts per RCPT TO: email address0.00.20.40.60.81.0Cumul % of RCPT TO: addresses w/ an alert