## 五、智能摄像头
IP摄像头是IoT黑客最喜欢的设备。从历史上看，除了非常明显的未授权窥探之外，这种设备还可以用来发起破坏性[DDoS攻击](https://securelist.com/newish-mirai-spreader-poses-new-risks/77621/)。不出所料，今天生产这种设备的厂商几乎都是黑客的攻击目标。
2015年，我们想评估当时消费行业中IoT设备的安全状态，当时我们研究的是一款婴儿监视器；今年我们关注的是另一种类型的摄像头：用于外部监控的摄像头。比如，你可以在院子里安置这种摄像头，以防邻居偷摘你的苹果树。
刚开始时，由于厂商忽视安全问题，来自同一厂商的这种设备及相关设备的安全性得不到保障。但在2016年时，许多研究人员公布了大量研究成果[[1]](http://www.bbc.com/news/technology-34138480)[[2]](https://ipvm.com/reports/ip-cameras-default-passwords-directory)，使公众了解到这类摄像头存在未授权访问问题，从此时起这类摄像头的保护问题得以大大缓解。
在此之前，这个厂商出售的所有摄像头都带有默认出厂账户及默认密码“12345”。当然，用户一般不会修改这个密码。2016年，在安全问题方面该厂商成为了行业翘楚，因此他们开始供应处于“未激活”模式下的摄像头。在激活以前，用户无法使用摄像头。激活过程中用户需要创建密码，设置网络参数。此外，设备会检查密码是否满足基本的复杂度要求（长度、字符种类、包含数字及特殊字符）。用户可以通过本地网络，使用任何主机访问摄像头，完成激活操作。
经过这种改动，带有默认密码的摄像头更新固件后，会要求用户更改密码，并且每次连接时都会警告用户存在安全风险。设备使用的密码强度很高，如下所示：
此外，厂商也能够防护暴力破解密码攻击：
此外，在2016年，厂商还在固件中添加了一个新的功能。当某个IP连续5到7次输错密码时，设备就会阻止该IP，防止暴力破解攻击。锁定状态30分钟后会自动取消。这种功能默认启用，可以显著提高安全性。
尽管如此，这款摄像头并非尽善尽美。比如，摄像头与云端的数据交互使用HTTP协议，其中将摄像头的序列号作为ID来使用。这种方式导致设备容易受到中间人攻击影响。
除了标准的WEB界面之外，设备还提供了专门的配置工具，可以用来搜索网络中的摄像头、显示摄像头上的数据、执行基本设置操作（如激活、修改密码、重置网络设置的密码）。当搜索设备时，PC端会发送一个以太网帧。
摄像头的响应数据未经加密，包含产品型号信息，如固件信息、重置日期以及网络设置信息等。由于这个数据以非加密方式进行传输，并且请求动作不需要授权，因此一个以太网报文就能检测到网络中的所有摄像头，获取这些摄像头的详细信息。算法还有另一个脆弱性：当设备生成响应数据时并没有考虑时间延迟因素。因此，攻击者很容易在网络中发起DDoS攻击，将这种请求报文发给以太网中的所有摄像头。
除了上面描述的这种协议之外，该摄像头还支持标准的SSDP协议以发送通知信息，任何软件或者硬件可通过这种协议自动探测到这类摄像头。SSDP数据中也包含与摄像头有关的信息，如产品型号及序列号。
另一个攻击点是远程密码重置，厂商通过技术支持服务提供远程密码重置功能。只要接入摄像头网络中，任何人都可以通过摄像头专用配置工具选择目标摄像头，发起密码重置请求。这一过程会生成包含摄像头序列号的一个小文件。用户可以将该文件发送给技术支持服务，技术支持服务可能会拒绝重置请求，或者发送一个特定的代码以便用户输入新密码。有趣的是，该服务并不会检查用户是否是摄像头的所有者，因为室外监控场景最初的假设就是摄像头位于遥不可及的位置，想远程识别请求发起者基本上是一件不可能完成的任务。在这种场景下，内部的网络犯罪攻击是最可能的攻击行为。
总结一下：就网络安全而言，这款设备并不是最糟糕的一款设备；然而，这款设备还是存在一些细枝末节的安全问题，可能会被攻击者加以利用。
## 六、智能浴室体重秤
想象一个场景：智能体重秤被攻击后，如果受害者不支付赎金，攻击者就威胁会在线公布受害者体重指数。当然这只是一个玩笑而已，但我们的研究表明这种攻击场景依然存在可能性。
我们的研究对象是一款智能设备，手机应用可以通过蓝牙与其交互，但该设备也搭载了Wi-Fi模块。这种连接方式可以给用户提供许多附加功能，比如可以通过密码保护的私有网站来监测体重指标，也可以分析身体数据，也能与各种医疗保健应用相集成。有趣的是，Wi-Fi唯一能提供的功能就是接收天气更新信息。
我们决定在LAN中，使用ARP欺骗方法，配合中间人攻击来测试是否能够在这款设备上任意更新固件或者安装软件。我们的研究结果如下文所述。
手机通过HTTPS方式与主服务器交互，执行一系列查询操作。体重秤本身通过蓝牙方式与手机连接。配对过程非常简单：用户通过应用程序发起连接请求，然后再打开体重秤的蓝牙连接即可。由于配对过程时间非常有限，因此攻击者很难在不引起用户注意的情况下完成设备匹配操作。
除此之外，设备通过蓝牙来传输与用户有关的各种数据，如通知邮件、体重指标等。设备通过应用程序接收更新，应用程序将更新文件的当前版本信息及其他一些参数发送给服务器，而服务器会将某个链接发送给应用程序，该链接包含待下载的文件及文件校验和信息。
然而，更新文件通过HTTP通道进行传输，没有经过加密保护，更新文件本身也未经加密保护。因此，如果攻击者可以监听设备连接的那个网络，那么他们就可以伪造服务器响应报文，也可以伪造更新文件。
利用这个问题，我们首先就能“回滚”更新文件的版本，然后安装一个修改版的更新文件，该文件与服务器返回的更新文件有所不同。在这种场景中，攻击者可以发起更进一步的攻击，比如在设备上安装任意软件等等。
当然也有一些好消息，比如该设备没有搭载摄像头，因此即使找到其他严重漏洞，用户仍处于安全境地。除此之外，还有谁会专门花时间来攻击智能体重秤呢？其实这个问题还是有存在的可能性，我们在这一部分的开头图片中已经给出了这种攻击场景。另外，我们前面也提到过，有些黑客只是出于趣味的破解目标来攻击设备，以证实自己具备这种能力。
## 七、智能熨斗
提到智能熨斗，你肯定会说破解这种设备是非常有趣的一个过程。我们非常好奇这种设备存在的意义。分析这种设备时，我们很可能会找到一个严重的漏洞，以及相应的利用方法。然而现实并没有那么有趣。根据我们的研究结论，我们无法通过攻击智能熨斗来引燃整个房屋。然而，这款设备上还存在一些非常有趣的问题。
该设备具备蓝牙连接功能，用户可以通过移动应用远程管理各种设备选项。由于厂商一般不会在保护蓝牙通道上花费太多心思，因为他们认为攻击者并不会对智能熨斗感兴趣，因此我们假设服务器与设备之间的通信过程并不安全，某人可以借此控制设备及其敏感数据。
一旦设备连接到用户的移动手机，用户就可以通过iOS或者Android应用来控制这款智能熨斗。通过应用，用户能执行如下操作：
1、查看熨斗的方向（处于平放、直立或者挂起状态）；
2、禁用熨斗（并不支持启用熨斗，这一点非常遗憾）；
3、激活“安全模式”（在这个模式下，熨斗并不会响应机械开关动作。如果用户想在这一模式中启动熨斗，则需要在应用中关掉安全模式）。
在开关安全性方面，如果熨斗在平放静止状态中超过5秒钟，或者在直立状态下超过8分钟，那么熨斗会自动关闭。
用户也可以通过互联网来控制该熨斗。为了实现这个功能，用户需要在该设备附近设置一个网关，比如能够访问互联网的独立的智能手机或者智能平板，然后通过特定应用来控制熨斗。
基于这些信息，我们决定仔细研究该设备所使用的应用程序。这款设备对应三款应用：一个为iOS应用，其他两个为Android应用。当用户通过蓝牙来管理熨斗并且位于熨斗附近时，可以使用第一款Andorid应用；第二款Android应用承担网关功能，当用户不在家时，可以通过该应用访问熨斗。iOS应用用于蓝牙管理场景。对于这三款应用，我们想说的是厂商并没有对应用代码做任何混淆处理。
在分析在线传输的流量时，我们发现Android蓝牙应用使用的是HTTPS协议，这是一种较好的解决方案。而iOS应用或者Android网关应用并没有采用这种机制。我们决定测试iOS应用的通信流量。
上图说明：通过应用发起钓鱼攻击
运行该程序后，用户可以通过该应用在线注册，然后通过HTTP，以未加密方式发送数据。利用这一点，我们可以在本地网络中拦截移动应用以及厂商服务器之间的通信流量，在这个基础上发起攻击。
前面我们提到过，手机还可以通过BLE与智能熨斗通信。BLE流量也没有经过加密处理。进一步深入分析该应用后，我们根据设备间传输的内容，发现了可以使用的命令，通过创建这些命令，我们成功实现了对该熨斗的控制。
因此，在了解这些信息后，作为一名黑客，我们可以做哪些工作？首先，如果我们能捕捉到用户的凭据信息，那么就能通过官方应用的认证机制，关掉熨斗或者将其设置为“安全模式”。这里我们需要注意的是，这些应用可以用于该厂商的所有智能设备，并且这些设备的数量还不在少数。这大大延伸了我们的攻击面。
如果我们错过机会，无法拦截授权数据，那也不用担心。由于设备与应用之间交换的数据没有经过加密保护，你可以拦截到服务器发往应用的令牌（token）信息，然后自己创建命令发送给熨斗。
因此，本地网络中的攻击者可以执行如下攻击操作：
1、窃取用户身份信息（窃取私人邮箱地址、用户名、密码）；
2、勒索（利用用户的天真无邪，启用熨斗的“安全模式”，使得用户无法通过机械手段打开熨斗，然后要求用户支付赎金才停用熨斗的“安全模式”）。
当然，实际环境中很难广泛使用这些攻击方法，但这种攻击场景依然存在可能性。试想一下，如果因为熨斗本身安全性不佳，而不是因为复杂攻击行为导致你的私人信息被窃取，那么这是多么尴尬的一件事情。