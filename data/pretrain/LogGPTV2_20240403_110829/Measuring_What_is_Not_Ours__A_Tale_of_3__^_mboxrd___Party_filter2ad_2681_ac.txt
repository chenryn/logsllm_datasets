4
.
0
2
.
0
Original Page
3rd Party Rewritten
No Loss Good
Fair Passable Poor
Network Conditions
100 ms
50 ms
20 ms
5 ms
Last Mile (Wired) Latency
Fig. 13. PLTs in cellular conditions for
a page with TPTR of 25%.
Fig. 14. PLTs in wired conditions for
a page with TPTR of 25%.
Similarly, when comparing PLTs for webpages with 3PTR of 25% and 5% in
Figs. 13, 14 and Figs. 15, 16 respectively, we observe reduced PLTs by rewriting
3P URLs. However, for these webpages the improvements are less pronounced
than we observe in Figs. 11 and 12, as the 3PTR for these webpages is less.
For example in Figs. 13 and 14, the median PLTs and 3PTR of a webpage with
rewritten 3P URLs under Fair mobile conditions and 20 ms E2E wired latency
are 15% and 10% lower than original webpage, respectively. Similarly, in Figs. 15
and 16, the median PLTs and the 3PTR under same conditions are 3% and 2.2%
lower than for the original webpage.
Note: For CP customers that desire to enable 3P content acceleration for
their webpages, rewriting of all 3P objects served over HTTPS should be per-
formed only when the CDN provider makes legal agreements with individual
3P providers to terminate HTTPS connections to their servers and cache the
requested content. Additionally, URL rewriting does not introduce any opera-
tional complexity to CPs. As CDN providers fetch HTML from their CP cus-
tomers, CDNs could parse the HTML and apply URL rewriting to 3P objects
that lie on the critical path. Further, as CDNs cache 3P objects, these objects
can be refreshed similarly to how CDNs refresh objects from their CP customers.
152
U. Goel et al.
)
S
(
i
e
m
T
d
a
o
L
e
g
a
P
0
.
2
0
1
.
5
0
.
Original Page
3rd Party Rewritten
No Loss Good
Fair Passable Poor
Network Conditions
)
S
(
7
.
0
i
e
m
T
d
a
o
L
e
g
a
P
5
0
.
3
0
.
2
0
.
Original Page
3rd Party Rewritten
100 ms
50 ms
20 ms
Last Mile (Wired) Latency
5 ms
Fig. 15. PLTs in cellular conditions for
a page with TPTR of 5%.
Fig. 16. PLTs in wired conditions for
a page with TPTR of 5%.
7 Discussion
The improvements in PLTs depend on the value of 3PTR – higher the value of
3PTR, the more potential for reducing PLTs exists. While our URL rewriting
technique demonstrates improvements in PLTs, we argue that for certain 3Ps,
rewriting URLs may degrade the performance. For example, in Fig. 17 we com-
pare performance of a popular 3P resource in terms of DNS lookup time, TCP
handshake time, time to receive ﬁrst bit, download time, and the total load time,
when loaded from a major CDN provider network and 3P servers respectively.
We observe that DNS lookup time for the 3P resource is signiﬁcantly lower than
the DNS lookup time for the 1P CDN provider, likely because the 1P domain
name created for this experiment is not very popular and therefore is not cached
by the local DNS resolver. The TCP handshake, ﬁrst bit, and download time
are similar when downloading the same object from 3P or 1P servers. As such,
the total load time is governed by the DNS lookup time.
Similarly, in Fig. 18, we show the same performance metrics for a diﬀer-
ent 3P resource. We observe that while DNS lookup time is still higher for a
1P hostname, the TCP handshake, ﬁrst bit times are signiﬁcantly lower when
downloading the resource from a 1P server, which translates to a lower total
load time with rewritten URLs. Therefore, we argue that careful performance
analysis should be performed for each critical 3P resource before transmitting
3rd Party URL
Rewritten URL
3rd Party URL
Rewritten URL
0
0
4
1
)
s
m
(
e
m
T
i
0
0
8
0
0
4
0
0
3
0
0
2
0
0
1
)
s
m
(
e
m
T
i
0
DNS
1st Bit Download Total
TCP
Web Performance Metric
0
DNS
1st Bit Download
TCP
Web Performance Metric
Total
Fig. 17. Comparing performance met-
rics of a 3P objects.
Fig. 18. Comparing performance met-
rics of another 3P objects.
Measuring What is Not Ours: A Tale of 3rd Party Performance
153
Original Page
3rd Party Rewritten
0
1
)
S
(
i
e
m
T
d
a
o
L
e
g
a
P
5
2
1
4
1
.
0
.
1
)
S
(
i
e
m
T
d
a
o
L
t
c
e
b
O
j
6
0
.
2
.
No Loss Good
Fair Passable Poor
Network Conditions
0
Bing
Yahoo
3rd Party Vendors on Critical Path
Turn
Fig. 19. PLTs distributions when
rewriting URLs for an h2 page.
Fig. 20. Distributions
variation in 3P load times.
showing the
HTML with rewritten URLs to clients. For example, if DNS lookup time impacts
the overall load time of the object, either the 3P resource need not be rewritten,
or the rewritten URL should use a hostname that client should have already
resolved, or conﬁgure clients to coalesce TCP connections to multiple 3P host-
names. In fact, a recent Internet draft by Microsoft and Mozilla details how to
present additional certiﬁcates during an existing connection and serve content
for the domains referenced in the additional certiﬁcates [18].
Next, in Fig. 19 we show the impact of URL rewriting when the base page
is served over HTTP/2 (h2). This webpage uses many 3P hostnames for which
the client establishes several TCP connections. When rewriting such a webpage
we rewrite all critical 3P URLs to send requests to the basepage hostname –
reducing the total number of connections from several dozen to just one h2
connection. For such webpages, single TCP connection degrades PLTs as loss
interpreted by TCP due to variable radio latency in cellular networks degrades
HTTP/2 performance [24]. When measuring PLTs for the same page over h2
in wired networks, we observe that without packet loss, h2 oﬀers faster PLTs.
Therefore, we argue that for content delivery optimized for mobile networks, it
is important to consider impact on PLT of the number of TCP connections that
remain after rewriting URLs.
Finally, for another webpage with over 40 diﬀerent 3P hostnames and 3PTR
of about 30%, we identify that the performance variation from a few 3P
resources (for which we could not perform URL rewriting as they contain cook-
ies) negate the beneﬁts of URL rewriting for other 3P resources. As shown in
Fig. 20, the three 3P resources downloaded from Bing, Turn, and Yahoo servers
vary by over 1 second. For example, a resource loaded from Yahoo servers takes
anywhere from 300 ms to 1.5 s. Therefore, we argue that for webpages that embed
cookie-based 3P objects with high performance variation may not assist the URL
rewriting technique to improve PLTs.
Limitation: The one (minor) limitation of 3PTR is that for some webpages,
3PTR may give a lower bound on the impact of 3P downloads on PLT. For
example, when a 3P object initiates the download of a 1P object and the 3P
downloads in parallel with some other 1P object, the TPTR is calculated as
154
U. Goel et al.
zero. As the 3P object initiates the download of a 1P object, that 3P lies on
the webpage critical path, however, 3PTR does not consider object dependencies
within a webpage when calculating impact of 3P downloads on PLT. To detect
object dependencies, the Referrer header in the HTTP requests can be used to
identify the initiator of the request. However, the Resource Timing API does not
record the Referrer header and thus we designed 3PTR to utilize the start and
end timestamps for each loaded object. Using HTTP Archive data, we identify
that less than 2–10% of the webpages possess such dependencies and therefore
3PTR calculates accurate 3P impact for majority of the webpages.
8 Conclusions
Our large scale investigation on 3rd Party performance reveals that 3Ps can
impact the overall webpage load time by up to 50%. Through extensive exper-
imentation, we demonstrate that redirecting 3P traﬃc to 1P infrastructure
improves webpage load times. We, therefore, make recommendations to 1P
providers to investigate the existence of 3P resources the critical path of web-
pages and utilize URL rewriting to improve Web performance for end-users. In
the future, we plan to perform even larger scale measurements on production
Web traﬃc.
Acknowledgments. We thank Ilya Grigorik, Shantharaju Jayanna, Wontaek Na, and
Kanika Shah for their help. We also thank National Science Foundation for supporting
this work via grants CNS-1555591 and CNS-1527097.
References
1. Gomez Last-Mile Testbed, November 2009. https://goo.gl/BtwSWY
2. HTTP Archive: Interesting stats (2010). http://httparchive.org/
3. Performance of 3rd Party Content, February 2010. http://stevesouders.com/p3pc/
4. Gomez (Dynatrace Synthetic Monitoring), July 2015. https://goo.gl/4JTjJy
5. Navigation Timing, August 2015. http://w3c.github.io/navigation-timing/
6. The Truth Behind the Eﬀect of Third Party Tags on Web Performance, December
2015. https://goo.gl/24f09c
7. Alexa Top Sites, July 2016. http://www.alexa.com/topsites
8. Facebook for Developers, June 2016. https://developers.facebook.com/
9. Google Analytics Solutions, June 2016. https://analytics.googleblog.com/
10. Google Fonts, June 2016. https://fonts.google.com/
11. Performance Measurement for the Real World, August 2016. https://www.soasta.
com/performance-monitoring/
12. Resource Timing, July 2016. https://www.w3.org/TR/resource-timing/
13. Third-party content could be slowing Britain’s retail websites, March 2016. https://
goo.gl/1gi1Li
14. WebPageTest Framework, July 2016. http://www.webpagetest.org/
15. Alstad, K.: Can third-party scripts take down your entire site? June 2014. https://
goo.gl/V0iLfa
Measuring What is Not Ours: A Tale of 3rd Party Performance
155
16. Belshe, M., Peon, R., and E. M. Thomson. Hypertext Transfer Protocol Version 2
(HTTP/2), RFC 7540, May 2015
17. Bermes, B.: Third Party Footprint: Evaluating the Performance of External
Scripts, September 2014. https://goo.gl/Cqhafq
18. Bishop, M., Thomson, M.: Secondary Certiﬁcate Authentication in HTTP/2, May
2016. http://www.ietf.org/internet-drafts/draft-bishop-httpbis-http2-additional-
certs-01.txt
19. Chen, F., Sitaraman, R.K., Torres, M.: End-user mapping: next generation request
routing for content delivery. In: ACM SIGCOMM, August 2015
20. Enaganti, R.C.: Merge Overlapping Intervals, August 2015. http://www.
geeksforgeeks.org/merging-intervals/
21. Goel, U., Steiner, M., Na, W., Wittie, M.P., Flack, M., Ludin, S.: Are 3rd parties
slowing down the mobile web? In: ACM S3 Workshop, October 2016
22. Goel, U., Steiner, M., Wittie, M.P., Flack, M., Ludin, S.: A case for faster mobile
web in cellular IPv6 networks. In: ACM MobiCom, October 2016
23. Goel, U., Steiner, M., Wittie, M.P., Flack, M., Ludin, S.: Detecting cellular middle-
boxes using passive measurement techniques. In: Karagiannis, T., Dimitropoulos,
X. (eds.) PAM 2016. LNCS, vol. 9631, pp. 95–107. Springer, Heidelberg (2016).
doi:10.1007/978-3-319-30505-9 8
24. Goel, U., Steiner, M., Wittie, M.P., Flack, M., Ludin, S.: HTTP/2 performance in
cellular networks. In: ACM MobiCom (Poster), October 2016
25. Nygren, E., Sitaraman, R.K., Sun, J.: The Akamai network: a platform for high-
performance internet applications. In: ACM SIGOPS, July 2010
26. Rula, J.P., Bustamante, F.E.: Behind the curtain: cellular dns and content replica
selection. In: ACM IMC, November 2014
27. Wang, X.S., Balasubramanian, A., Krishnamurthy, A., Wetherall, D.: Demystify
page load performance with WProf. In: USENIX NSDI, April 2013