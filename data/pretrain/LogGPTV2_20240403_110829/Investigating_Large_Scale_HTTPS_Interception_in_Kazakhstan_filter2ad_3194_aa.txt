title:Investigating Large Scale HTTPS Interception in Kazakhstan
author:Ram Sundara Raman and
Leonid Evdokimov and
Eric Wustrow and
J. Alex Halderman and
Roya Ensafi
Investigating Large Scale HTTPS Interception in Kazakhstan
Ram Sundara Raman
University of Michigan
PI:EMAIL
Leonid Evdokimov
Independent
PI:EMAIL
Eric Wurstrow
University of Colorado Boulder
PI:EMAIL
J. Alex Halderman
University of Michigan
PI:EMAIL
ABSTRACT
Increased adoption of HTTPS has created a largely encrypted web,
but these security gains are on a collision course with governments
that desire visibility into and control over user communications.
Last year, the government of Kazakhstan conducted an unprece-
dented large-scale HTTPS interception attack by forcing users to
trust a custom root certificate. We were able to detect the intercep-
tion and monitor its scale and evolution using measurements from
in-country vantage points and remote measurement techniques.
We find that the attack targeted connections to 37 unique domains,
with a focus on social media and communication services, suggest-
ing a surveillance motive, and that it affected a large fraction of
connections passing through the country’s largest ISP, Kazakht-
elecom. Our continuous real-time measurements indicated that
the interception system was shut down after being intermittently
active for 21 days. Subsequently, supported by our findings, two
major browsers (Mozilla Firefox and Google Chrome) completely
blocked the use of Kazakhstan’s custom root. However, the incident
sets a dangerous precedent, not only for Kazakhstan but for other
countries that may seek to circumvent encryption online.
CCS CONCEPTS
• General and reference → Measurement; • Security and pri-
vacy → Security protocols; Web protocol security; • Social
and professional topics → Governmental surveillance; Tech-
nology and censorship.
KEYWORDS
HTTPS, Interception, Kazakhstan, MitM, Certificates
ACM Reference Format:
Ram Sundara Raman, Leonid Evdokimov, Eric Wurstrow, J. Alex Halderman,
and Roya Ensafi. 2020. Investigating Large Scale HTTPS Interception in
Kazakhstan. In ACM Internet Measurement Conference (IMC ’20), October
27–29, 2020, Virtual Event, USA. ACM, New York, NY, USA, 8 pages. https://
doi.org/10.1145/3419394.3423665
This work is licensed under a Creative Commons Attribution International 4.0 License. 
IMC ’20, October 27–29, 2020, Virtual Event, USA 
© 2020 Copyright held by the owner/author(s). 
ACM ISBN 978-1-4503-8138-3/20/10.
https://doi.org/10.1145/3419394.3423665
Roya Ensafi
University of Michigan
PI:EMAIL
1 INTRODUCTION
HTTPS protects billions of users: 74–95% of daily web traffic is now
encrypted, providing much-needed privacy and security [1, 23]. At
the same time, deep packet inspection technologies that inspect
HTTPS connections have also advanced [29, 46, 50]. Although
enterprise-level interception is common despite being fraught with
security issues [17, 40], large-scale interception at the ISP or na-
tional level has been limited, even as increased adoption of HTTPS
challenges mass surveillance and keyword-based censorship [5, 19].
Last year, in an unprecedented move, the Republic of Kazakhstan
became the first country to deploy carrier-grade HTTPS intercep-
tion on a national level. Starting on July 17, 2019,1 Kazakhstan
launched an HTTPS interception man-in-the-middle (MitM) attack,
after instructing citizens to install a government-issued root certifi-
cate on all devices and in every browser for “security” purposes [8].
This interception, which the government described as a “pilot”,
covered large portions of the country’s network and was active
intermittently until being shut down on August 7, 2019.
While the attack was going on, we worked to understand the
interception technique, measure its scope, and identify its likely tar-
gets. We first detected the interception using data from Hyperquack,
a recently introduced remote technique for detecting keyword-
based network interference [50]. Beginning on July 20, Hyper-
quack’s HTTPS measurements to some (but not all) of 82 available
vantage points in Kazakhstan detected rogue untrusted certificates
for popular destinations such as google.com and facebook.com.
The certificates were issued by the Kazakh government’s custom
root CA, Qaznet Trust Network. We later confirmed these detec-
tions with direct measurements from local virtual private servers
(VPSes) and 52 in-country RIPE Atlas nodes.
We determined that the interception system would trigger on
TLS connections passing through certain network locations in Kaza-
khstan when a targeted domain was present in the TLS Server Name
Indication (SNI) header. This allowed us to probe it using connec-
tions originating from outside or inside the country destined for
any HTTPS server in Kazakhstan. We used this behavior to per-
form comprehensive measurements from North America and two
Kazakh VPSes to 6,736 TLS hosts in different parts of the country,
setting the SNI header to popular domains. We also performed
TTL-limited measurements to discover the location in the network
where the interception was occurring. To track the attack over
time, we performed measurements continuously until well after
the interception system was shut down.
1Dates and times are in East Kazakhstan Time (UTC+6), except where noted.
125
IMC ’20, October 27–29, 2020, Virtual Event, USA
Sundara Raman et al.
Our findings show that only a fraction of the Internet traffic
inside the country was subject to interception (around 7–24% of the
6,736 TLS hosts measured were affected), and that the path to all of
the servers affected by the interception passed through two sets of
specific hops in AS9198 (Kazakhtelecom). Of the Alexa Top 10,000
domains [4], 37 triggered interception. The majority were media
and communication sites, 20 were Google services and 7 were ser-
vices affiliated with Facebook. The set of targets suggests that the
government’s actions were motivated by surveillance, rather than
increased security as was officially claimed. From our longitudinal
measurements, we observed the interception being turned on and
off intermittently and observed varying scale of interception, sug-
gesting that the interception system was still being tested or tuned.
Finally, the interception was turned off on August 7, with an official
announcement that the system will be used again “when there is a
threat [38].” We have not detected it since.
Kazakhstan’s national-level HTTPS interception sets a danger-
ous precedent, not only for Kazakhstan—but for all governments
and other powerful actors that wish to gain more control over users’
Internet traffic. It also serves as an important reminder of the lim-
its of HTTPS. Although nobody was forced to install the Qaznet
root CA, most of the affected sites employed Strict Transport Se-
curity, so users who did not were unable to access these sites at
all, even by clicking through security warnings. In the period the
interception system was active, the private data of many thousands
of users could have been compromised—including credentials for
some of the world’s most popular sites—and the security of their
connections was significantly reduced.
We hope our work will inform efforts within the HTTPS security
ecosystem to plan how to respond to future incidents of national-
level interception. Based in part on our findings, two major browser
vendors, Mozilla Firefox and Google Chrome, completely blocked
the use of the Qaznet Trust Network root, so that any future use
will be prevented even if users manually trust the certificate [33].
We advocate similar reactions to interception events in the future,
and further research into technologies that can rapidly detect and
impede such attacks.
1.1 Ethics
Our measurements were guided by several ethical considerations.
First, we were careful not to directly involve any human subjects
in Kazakhstan, due to potential legal risks they might face. For
our direct measurements using RIPE Atlas probes and VPSes in
the country, we only ran preliminary tests to google.com and
facebook.com, two very popular domains unlikely to draw sus-
picion, and did not conduct any longitudinal measurements that
might overload the network.
Ethical practices for remote censorship measurement have been
the subject of many papers, discussions, and workshops [13, 25, 36,
42, 56, 57]. Since IRBs have determined that work such as our study
is outside of their purview, we followed community norms and the
guidelines listed in the Menlo and Belmont reports [15, 37]. Specifi-
cally, our primary remote measurements to TLS hosts in Kazakhstan
only used hosts that had a valid certificate, so as to exclude typical
residential hosts. Moreover, we tested only domains from the Alexa
Top 10,000 [4] to reduce any risk of retaliation based on visiting
126
unusual sensitive sites. For a separate experiment, in which we
tested sensitive domains from the Citizen Lab Test List [12], we
limited our vantage points to servers that presented a valid EV
certificate, as these are almost exclusively larger organizations.
Additionally, we followed the Internet-wide scanning best prac-
tices proposed by the ZMap Project [18]. All our measurement
machines have WHOIS records and a web page served from port
80 that indicates that measurements are part of a research project
and offer the option to opt-out. We did not receive any complaints
during the study period.
2 BACKGROUND
In this section, we first provide background on HTTPS interception
attacks, their prevalence, and efforts to detect and prevent them
before providing a brief timeline of the events in Kazakhstan leading
up to the large-scale interception attack.
2.1 Related Work: HTTPS Interception
To perform HTTPS interception, a network entity poses as the
destination server, accepting HTTP requests from clients and trans-
parently proxying them to the real site [9]. HTTPS is designed
to prevent this by requiring the server to present a certificate,
signed by a certificate authority (CA) the client trusts, that as-
sociates its public key with the requested domain. For interception
to succeed, either the attacker has to cause a browser-trusted CA
to falsely issue them a certificate for the target domain, or the
user has to install and trust a custom CA, which the interception
system can use to sign certificates that the client will accept for
any site. The latter approach is commonly used in residential and
enterprise settings by client-side software and middleboxes, for
purposes such as malware protection and content filtering [29, 46].
However, previous work has shown that interception frequently
decreases connection security due to implementation flaws and
lack of support for recent standards [17, 40, 53]. Moreover, such
technology provides efficient avenues for implementing censorship
and surveillance [10, 22, 44, 50], since the proxy can observe or
modify connection plaintext.
In contrast to the prevalence of interception within enterprises,
large-scale adversarial HTTPS interception has only rarely been
documented, and the few recorded instances have tended to be
brief and narrowly focused. The best known incident occurred in
2011, when an attacker compromised a CA called DigiNotar and
created a fake browser-trusted certificate for *.google.com, which
an ISP in Iran used to intercept connections to Google services [5].
Large-scale interception attacks were also detected in Syria (for
facebook.com) and China (for github.com) for short periods in
2011 and 2013 respectively [19, 24], both based on untrusted certifi-
cates that raised security warnings in users’ browsers. Kazakhstan’s
2019 attack greatly exceeded these in duration, breadth of targets,
and administrative sophistication. It also represents the first time
that a national government attempted to induce its citizens to install
a custom CA for purposes of interception.
To defend against interception via CA compromise, researchers
have proposed a variety mechanisms to complement or replace
CAs [14, 30, 55] or to limit their scope of trust [26, 47], though
none has seen wide adoption. The idea of certificate pinning, where
Investigating Large Scale HTTPS Interception in Kazakhstan
IMC ’20, October 27–29, 2020, Virtual Event, USA
(with translation) in Figure 1. The certificate was not trusted by any
browser by default, and needed to be manually installed by users.
An initial thread about the interception was started on Bugzilla
(Mozilla’s bug tracker forum) on July 18 [8], which served as the
starting point for our investigations.
3 TRIGGERING INTERCEPTION
The first step in investigating the large-scale HTTPS interception
employed by Kazakhstan was to explore methods to trigger and
detect the interference. We designed our experiments to trigger
and analyze the interception based on the ethical considerations
described in §1.1.
3.1 Methodology
We employed both direct measurements from inside the country
and remote measurements from outside the country. For performing
direct measurements, we obtained access to two VPS clients and
52 RIPE Atlas probes in the country. The two VPS clients were
located in AS203087 and AS208450. We performed direct HTTPS
requests to google.com and facebook.com, two domains reported
in the initial Bugzilla report about the interception [8], from both
the VPSes and the RIPE Atlas probes on July 20, 2019.
In order to select infrastructural vantage points, we used data
from Censys [16] to identify web servers that returned a valid EV
certificate as these likely belong to large organizations [49]. We
identified 82 such vantage points in Kazakhstan, located in 21 ASes.2
On July 20, 2019, we performed Hyperquack HTTPS measurements
to these 82 vantage points in Kazakhstan, with the input test list
containing domains from the Citizen Lab Global Test List [12], a
curated list of globally censored and sensitive domains, and Alexa
Top 1000 popular domains [4], following the same test list selection
process adopted in previous work [49, 50].
2AS information obtained from Maxmind [31] and Censys [16].
To increase the scale of measurements, we tested whether the in-
terception could be triggered using remote measurement techniques
from outside the country. Specifically, we used Hyperquack, a re-
cently introduced remote measurement technique that detects net-
work interference by sending various HTTP and HTTPS requests
to thousands of infrastructural web servers around the world [50].
Hyperquack first requests several bogus (but benign) domains in
the form of .example.com from each web
server. Since the web servers do not host these domains, they will
likely respond with an error page. If the error response for all the
requested domains are the same, Hyperquack uses this response to
create a template that serves as the expected server response. This
template includes features such as the response status code and
the HTML body. In the case of HTTPS measurements, the template
additionally includes the certificate, and chosen TLS version and
cipher suite.
After building the template, Hyperquack requests test domains
(potentially blocked domains) from each server. Since the web
servers do not host these domains, the server response is expected
to be the same as the template. However, if the response for the