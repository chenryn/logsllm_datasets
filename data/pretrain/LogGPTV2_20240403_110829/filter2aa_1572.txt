Copyright 2011   Trend Micro Inc.
Targeted Malware Attacks
Nart Villeneuve
Copyright 2011   Trend Micro Inc.
Threat Landscape
• There are numerous attacks everyday; some are specific 
and targeted while others are automated and 
indiscriminate.  
• Attackers may be highly skilled and well resourced 
adversaries or simply opportunistic amateurs. 
• Attackers may be individuals or groups engaging in crime 
motivated by financial gain, politics or status within their 
community. 
• Attackers may be motivated by espionage or data theft 
and have implicit ties to government or military entities. 
Copyright 2011   Trend Micro Inc.
Presentation
• Cybercrime
– monetization through credential theft, pay-per-install and pay-per-
click within an affiliate organizational structure
• Targeted Malware Attacks
– use of social engineering to aggressively pursue and compromise 
specific targets
• Blurring Boundaries
– use of cybercrime tools and infrastructure for the theft of sensitive 
information
Copyright 2011   Trend Micro Inc.
Underground Resources
Network
• Bulletproof Hosting
• Domain Registration
• VPNs / Jabber
Malware
• Builders / Panels
• Cryptors / AV 
test
• Exploit Packs
Propagation
• Spam
• BHSEO
• TDS
• Installs/PPI
• All the software and 
services need to setup a 
malicious operation are 
available
• Aspiring cybercriminals 
seek a return on their 
investment
• A variety of monetization 
strategies are available 
Copyright 2011   Trend Micro Inc.
Credential Theft
• Use of tools such as Zeus 
and SpyEye to steal 
credentials, credit card 
numbers etc…
• Package the goods for re-
sale within the 
underground
• Use of money mules and 
pack mules to extract value
Copyright 2011   Trend Micro Inc.
Pack Mules
Copyright 2011   Trend Micro Inc.
CC Marketplace
Copyright 2011   Trend Micro Inc.
Bank Fraud / SpyEye Webinjects
Copyright 2011   Trend Micro Inc.
Source: http://www.fbi.gov/news/stories/2010/october/cyber-banking-fraud/cyber-banking-fraud-graphic
Copyright 2011   Trend Micro Inc.
Arrests: Mega-D, Bredolab, SpyEye
Copyright 2011   Trend Micro Inc.
Pay-Per-Install
• PPI is a model in 
which bot masters 
earn income 
whenever Internet 
users install software 
supplied by an 
affiliate.
Copyright 2011   Trend Micro Inc.
Pay-Per-Click
• PPC is a model in 
which bot masters 
earn income 
whenever Internet 
users click on 
advertisement links 
supplied by an 
affiliate.
Copyright 2011   Trend Micro Inc.
PPC Affiliates
Copyright 2011   Trend Micro Inc.
PPC
Copyright 2011   Trend Micro Inc.
FAKEAV Affiliates
Copyright 2011   Trend Micro Inc.
KOOBFACE: The Money
• June 23, 2009 to June 10, 2010
• Total income: $2,067,682.69
• Daily average: $5,857.46.
• Highest daily total (March 23, 2010): $19,928.53
• FAKEAV: 50.3% of Koobface’s earnings
• PPC: 49.7% of Koobface’s earnings
Copyright 2011   Trend Micro Inc.
Affiliates
Copyright 2011   Trend Micro Inc.
Daily SMS
Copyright 2011   Trend Micro Inc.
Challenges
 Law Enforcement: What crime? What law? What is the 
impact in my jurisdiction? International cooperation?
 Industry: Dynamic binaries, supply of new domain 
names, what threats are on the horizon?
 Users: What is social engineering? How can I protect 
myself?
Copyright 2011   Trend Micro Inc.
Part 2: Targeted Malware Attacks
• Computer intrusions staged by threat actors that:
– Aggressively pursue and compromise specific targets
• Often leveraging social engineering
– Maintain a persistent presence within the victim’s 
network 
– Escalate privilege and move laterally within the victim’s 
network 
– Extract sensitive information to locations under the 
attacker’s control 
Copyright 2011   Trend Micro Inc.
Low Distribution / High Impact
Copyright 2011   Trend Micro Inc.
Targeted Malware Attacks
• Attacks against civil society organizations, business 
enterprises and government/military networks
• Attacks are typically part of a broader campaign, a 
series of failed and successful compromises
• Attacks typically consist of a socially engineered 
message – such as an email or instant message – that 
encourages the target to click on a link or open a file
• Attackers use whatever is required, based on 
reconnaissance, to gain entry and will adjust tactics in 
reaction to the defenses of the target
Copyright 2011   Trend Micro Inc.
GhostNet
Copyright 2011   Trend Micro Inc.
GhostNet
Copyright 2011   Trend Micro Inc.
GhostNet
Copyright 2011   Trend Micro Inc.
GhostNet
Copyright 2011   Trend Micro Inc.
GhostNet
Copyright 2011   Trend Micro Inc.
Lessons of GhostNet
• Attackers do not need to be “advanced” or 
“sophisticated” to be effective
• Maintaining persistent control is important to the 
attackers
• Attribution is difficult:
• Use of off-the-shelf software (gh0stRAT)
• Geolocation is not enough (false flag)
• Notification is difficult:
• How and who to notify?
Copyright 2011   Trend Micro Inc.
ShadowNet
• Less than 200 computers compromised, almost all in 
India
• Recovered data included Secret, Confidential and 
Restricted Indian Gov’t documents
• Social engineering + malware embedded in malicious 
documents + tiered C&C infrastructure
Copyright 2011   Trend Micro Inc.
ShadowNet
Copyright 2011   Trend Micro Inc.
ShadowNet
Copyright 2011   Trend Micro Inc.
ShadowNet
Copyright 2011   Trend Micro Inc.
ShadowNet
Copyright 2011   Trend Micro Inc.
ShadowNet
Copyright 2011   Trend Micro Inc.
ShadowNet
Copyright 2011   Trend Micro Inc.
ShadowNet
{s:6:"hostid";s:7:"PHANTOM";s:6:"ipaddr";N;s:9:"outipaddr";s:12:"
76.67.xx.xxx";s:7:"macaddr";s:17:"08:00:27:4B:8C:79";s:8:"hostnam
e";s:7:"PHANTOM";s:6:"ostype";s:34:"Microsoft Windows XP 
Professional3";s:7:"version";s:5:"0.5.2";s:5:"owner";s:2:"TY";}s:10:"r
eporttime";s:14:"20091130091701";}
Copyright 2011   Trend Micro Inc.
ShadowNet
Copyright 2011   Trend Micro Inc.
Lessons of ShadowNet
• Subset of “noisy” attacks that have been ongoing since 
2002
• Documented by Maarten Van Horenbeeck in 2008
• Attacks by this group continue…
• Information sharing provides perspective
• OHHDL: Incident Response
• ShadowServer: samples + sinkhole
Copyright 2011   Trend Micro Inc.
Trends in Reconnaissance/Targeting
• Email address registered in the name of target’s colleague
• Forwarding legitimate emails (often from mailing lists)  along 
with a malicious attachment
• Sending two or more attachments one is clean, the other is 
malware
• Leveraging authority relationships, such as boss-employee,  
to communicate a sense of importance 
• Spoofing governmental email addresses to convey 
authenticity 
• Using the “res://” protocol to enumerate the targets system 
in preparation for a future attack 
Copyright 2011   Trend Micro Inc.
Social Engineering
• Spoofed Email? From 
a “real” person?
• Content of the 
message; Real 
events?
• Attachments? Links? 
Exploit? Drop?
• C&C? Port? 
Protocol? 
Downloads? 
Uploads?
Source: contagiodump.blogspot.com
Copyright 2011   Trend Micro Inc.
Social Engineering
• Sent from 
spoofed Gmail 
acct of US-
Taiwan Business 
Council President
• Content is about 
an issue that the 
org and the 
specific individual 
have been 
working on
Source: targetedemailattacks.tumblr.com
Copyright 2011   Trend Micro Inc.
Social Engineering
• Attackers 
leverage 
relationships of 
authority
• Sent from the 
president of the 
organization to 
the employees 
Source: targetedemailattacks.tumblr.com
Copyright 2011   Trend Micro Inc.
Trends in Delivery Mechanisms 
• Malicious attachments via socially engineered email Email
(pdf, doc, xls, ppt)
• Links to web pages hosting malware inside of compressed 
files (.zip, .rar, sometimes password protected) via Email or 
IM
• The use of the default windows configuration that hides file 
extensions to create executables that look like “folder” icons 
but are really executables
• Links to legitimate webpages, often contextually relevant to 
the victim, that have been compromised and have had a 
malicious iframe or malicious javascript embedded
• Use of right-to-left Unicode hole to disguise executables
Copyright 2011   Trend Micro Inc.
Trends: Right-to-Left Unicode
Source: h-online.com
Copyright 2011   Trend Micro Inc.
Trends: Relevant Compromised Hosts
• Spoofed Email of Executive 
Director of HRIC
• Contextually relevant 
content
• Sent to human rights 
mailing lists
• Link to compromised 
“Coalition for Citizens 
Rights” web site
Copyright 2011   Trend Micro Inc.
Trends: Relevant Compromised Hosts
• PDF loaded in “iframe”
• Detection:  8/42 
VirusTotal
• Components: connects 
to humanright-
watch.org/fun.exe
• Connects to 
360liveupdate.com
Copyright 2011   Trend Micro Inc.
Trends: Relevant Compromised Hosts
• humanright-watch.org used in 
two other attacks:
• Exploit: CVE-2009-4324 (Adobe 
PDF 0Day)
• Detection: 5/41 VirusTotal (now 
16/41)
• Exploit:  CVE-2009-3129 (XLS)
• Detection:  17/41 VirusTotal (now 
22/43) TROJ_MDROPR.MRV
• C&C: 360liveupdate.com 
Source: contagiodump.blogspot.com
Copyright 2011   Trend Micro Inc.
Trends in Compromises/Exploits
• Exploits in Gmail (MHTML) , Yahoo! Mail (XSS), and 
Hotmail (XSS) have all been used recently in targeted 
attacks
• Vulnerabilities, including zeroday, Adobe PDF Reader and 
Adobe Flash continue to be exploited
• Microsoft Office file formats, such as DOC and XLS continue 
to exploited,  recently, in conjunction embedded Adobe 
Flash objects
• Not always zeroday - older, reliable exploits (such as CVE-
2009-3129, CVE-2010-3333, CVE-2010-2883) are still in 
use
Copyright 2011   Trend Micro Inc.
Trends: Webmail
Copyright 2011   Trend Micro Inc.
Trends in Command and Control
• Cloud-based command and control , SSL encrypted 
webmail services, use of intermediaries such as blogs
• Heavy use of  RATs , often off-the-shelf RAT’s such as 
gh0st and  poisonivy
• Hide commands in base64’d (some with custom-alphabets) 
encoded commands in HTML comment tags in web pages
• Use of domains/subdomains specific to classes of victims, 
often using dynamic DNS providers
• The use of XOR’d traffic on non-standard ports
• The use of stolen or forged SSL certificates to encrypt 
network traffic to the command and control server
Copyright 2011   Trend Micro Inc.
Trends: C&C in the Cloud
• Exploit: Adobe Reader/Acrobat 
(CVE-2010-2883)
• Detection: 14 /43 (32.6%) VT; 
now 19/41 with Trend detecting 
as TROJ_PIDIEF.EQW
• Components: connected to 
drivehq.com (cloud storage) 
downloaded DLLs
• Ex-filtration: uploaded 
encrypted data to GMail
account via SSL
Source: contagiodump.blogspot.com
Copyright 2011   Trend Micro Inc.
Trends: Targeting + Stealth
•  
• base64 decode = 
d:http://www.parkerwood.com/images/top.gif
Copyright 2011   Trend Micro Inc.
Trends: Custom B64
Source: cyberesi.com
Copyright 2011   Trend Micro Inc.
Trends in Persistence / Lateral Movement
• Persistence
– Windows Service and Windows Service replacement
– DLL search order hijacking
• See, http://blog.mandiant.com/archives/1207
• Lateral Movement
– Privilege escalation / Pass-the-Hash tools
– Target Email servers / use of Email extraction tools (e.g. MAPI-
tools targeting Exchange servers)
– Targeting PKI (e.g. VPN& SSL certificates)
– Obtain directory listings
Copyright 2011   Trend Micro Inc.
Trends in Data Ex-Filtration
• Upload chunks of compressed archives using HTTP post 
(often to the attackers command and control server)
• Upload data via SSL to webmail services
• The use of the Tor anonymity network to transmit data to 
unknown locations
• The use of traditional protocols such as FTP and SMPT 
to transmit data
Copyright 2011   Trend Micro Inc.
Challenges
• Can malware used in attacks that are by definition 
targeted, and most often customized to pursue specific 
targets, be detected?
• Monitoring network traffic for C&C communication can 
typically provide an indication of compromise, how will 
the move to the cloud affect these methods?
• Can we distinguish “highly” targeted attacks from “less” 
targeted attacks? Can we group the activity of specific 
threat actors?
Copyright 2011   Trend Micro Inc.
Part 3: Crime or Espionage?
 At least 15 related attacks between December 9, 2009 
and December 23, 2010
 Common method, malware and (often) infrastructure
Spam email, contains link to .zip 
.zip contains a Zeus binary
Zeus connects to a C&C 
Downloads an infostealer
Infostealer FTP’s documents to a server (usually in Belarus)
Copyright 2011   Trend Micro Inc.
Emails
•
December 9, 2009 - CYBER-PMESII COMMANDER’S ANALYSIS OF FORECAST EFFECTS
•
December 14, 2009 - Information Systems Security Reminder
•
February 10, 2010 - Russian spear phishing attack against .mil and .gov employees
•
February 11, 2010 - RE: Zeus Attack Spoofs NSA, Targets .gov and .mil
•
February 12, 2010 - DoD Roles and Missions in Homeland Security
•
February 21, 2010 - INTELLIGENCE BULLETIN
•
March 6, 2010 - FOR OFFICIAL USE ONLY
•
March 7, 2010 - FOR OFFICIAL USE ONLY
•
March 11, 2010 - U.S. Department of Homeland Security
•
March 13, 2010 - RE: Instructions UNCLASSIFIED
•
June 16, 2010 - From STRATCOM to
•
June 17, 2010 - Scientific Advisory Board
•
June 17, 2010 - (U) Transportation Security Administration
•
August 26, 2010 - From Intelligence Fusion Centre
•
December, 23 2010 - Merry Christmas!
Copyright 2011   Trend Micro Inc.
Email Content
Copyright 2011   Trend Micro Inc.
Xmas/Zeus - Delivery 
 Email spoofed from 
PI:EMAIL 
and others...
 Contained links to websites 
which contained iframes
linked to:
− iphonedevelopersdk.com/wp
-admin/includes/card.zip and 
quimeras.com.mx/images/c
ard.zip
Copyright 2011   Trend Micro Inc.
Connecting the dots 1
 Dec, 23 2010 (Merry Christmas)  –
quimeras.com.mx/images/card.zip
 August 26, 2010 (From Intelligence Fusion Centre) –
quimeras.com.mx/media/EuropeanUnion_MilitaryOper
ations_EN.zip
from-us-with-love.info to get config file, connects to vittles.mobi 
to download infostealer which connects to nicupdate.com.
 June 16, 2010 (From STRATCOM to) –
quimeras.com.mx/home/report.zip
from-us-with-love.com to get the config file (other information 
unavailable).
Copyright 2011   Trend Micro Inc.
Connecting the dots 2
 June 16, 2010 (From STRATCOM to) –
nighthunter.ath.cx/report.zip has the same MD5 as 
quimeras.com.mx/home/report.zip 
 nighthunter.ath.cx was used to send the March 11, 2010 
(U.S. Department of Homeland Security) emails which 
contained the link:
dhsorg.org/docs/instructions.zip which connected to 
greylogic.org 
These domains were registered by: PI:EMAIL
Copyright 2011   Trend Micro Inc.
Challenges
• Is there a market for sensitive information?
• Are criminal tools and infrastructure being used for 
espionage?
• How do we determine significance given the volume of 
malware data?
Copyright 2009   Trend Micro Inc.
Thanks!
Comments & Questions?