SIEM(Security Information and Event
Managemen)即安全信息和事件管理，是企业安全建设的数据中心。为确保读者对企业安全有一定的认知，本材料第一章节会对企业安全建设内容、阶段及相关方法论进行介绍。之后才是日志易SIEM产品的介绍。
# 企业安全与SIEM
网络信息服务已深入到人们生活的方方面面，网络上的信息越来越多，同时也造成了个人隐私泄露风险增大。对企业而言，在企业生命周期的不同阶段，安全风险对企业造成的影响也不相同。随着企业业务的扩张，企业知名度提升，其数据中心的规模越来越大，面临的非法访问、账户信息窃取等安全风险也随着激增，而这些风险对企业业务的影响也随之呈现几何式递增。
## 企业安全建设
企业安全是不是发现漏洞然后修复漏洞，再设置一下防火墙之类的工作？假如你的公司只有一个产品、两台服务器、3个程序员，这个说法不能算错。不过在绝大多数情况下，企业安全远不止于此。渗透性测试和对抗能不能算企业安全？在一个过于纸上谈兵的企业这是不错的切入点，不过局部对抗发生于企业安全的各个场景中，它只能算是缩影，不是全貌。企业安全是什么？对传统乙方安全公司，对新兴的业务安全公司、移动安全公司，对甲方的互联网公司，对甲方的传统公司，对咨询顾问，对漏洞研究者，对活跃于各大SRC上的白帽子们来说，诠释肯定都不一样。
企业安全是什么？我认为它可以概括为：从广义的信息安全或狭义的网络安全出发，根据企业自身所处的产业地位、IT总投入能力、商业模式和业务需求为目标，而建立的安全解决方案以及为保证方案实践的有效性而进行的一系列系统化、工程化的日常安全活动的集合。怎么感觉有点咬文嚼字？实际上，这里面的每一个项都会决定你的安全整体方案是什么，哪怕同是中国互联网TOP10中的公司，安全需求也完全不一样。
但关键的一点是，安全建设与企业业务是息息相关的。
### 企业安全内容
企业安全涵盖网络安全、平台和业务安全、企业内部数据安全、IT风险管理（IT审计、内控）、业务持续性管理（BCM，Business
Continuity Management）等方向。
互联网企业的安全工作可概括为以下几个方面：
-   信息安全管理（设计流程、整体策略等），这部分工作约占总量的10%，比较整体，跨度大，但工作量不多。
```{=html}
```
-   基础架构与网络安全：IDC、生产网络的各种链路和设备、服务器、大量的服务端程序和中间件，数据库等，偏运维侧，跟漏洞扫描、打补丁、ACL、安全配置、网络和主机入侵检测等这些事情相关性比较大，约占不到30%的工作量。
-   应用与交付安全：对各BG、事业部、业务线自研的产品进行应用层面的安全评估，代码审计，渗透测试，代码框架的安全功能，应用层的防火墙，应用层的入侵检测等，属于有点"繁琐"的工程，"撇不掉、理还乱"，大部分甲方团队都没有足够的人力去应付产品线交付的数量庞大的代码，没有能力去实践完整的SDL（安全开发生命周期），这部分是当下比较有挑战的安全业务，整体比重大于30%，还在持续增长中。
-   业务安全：即平台和业务安全。指跟所在行业和主营业务相关的安全管理，例如反欺诈，不是纯技术层面的内容，是对基础安全的拓展，目的性比较强，属于特定领域的安全，不算广义安全。包括账号安全、交易风控、征信、反价格爬虫、反作弊、反bot程序、反欺诈、反钓鱼、反垃圾信息、舆情监控（内容信息安全）、防游戏外挂、打击黑色产业链、安全情报等，是在"吃饱饭"之后"思淫欲"的进阶需求，在基础安全问题解决之后，越来越受到重视的领域。整体约占30%左右的工作量，有的甚至大过50%。这里也已经纷纷出现乙方的创业型公司试图解决这些痛点。
    1.  ### 企业安全建设阶段
"企业的安全体系建设是一个从"0"到"1"的过程，这种过程采用分步走战略，图1-1展现了安全整体建设的"次第"。
在纵深防御建立起来之前，是不是被动挨打呢，显然不是的。你需要做一些基础的事情，最大化的止损，虽然有些事情看起来很简单，却往往是安全事件的根源。
所以**第一阶段是基础安全策略的实施**，这一部分看上去不那么高大上，却是ROI（投资回报率）最高的部分。这一部分大多属于整改项，不需要太多额外的投入就可以规避80%的安全问题，即使一个企业没太多安全预算，做不到全线业务实时入侵感知，也能有一个底线的基础保障，这一阶段总体上属于"饿不死"。
**第二阶段是进入系统性建设**，也就是第二篇中涉及的各个维度的安全防御手段。入侵检测等，除了技术上，还包括流程和审计需求。这是一个相对体系化的雏形，对于不是特别大的互联网公司而言，开源软件+商业解决方案一般可以应付。在这个阶段，如果对象是大型互联网公司，则应该直接进入自研之路，同步开始研发安全产品，例如HIDS、大数据平台等，自研迟早是一个无法回避的现实需求。
![](media/image1.png){width="5.763888888888889in"
height="3.865972222222222in"}
> 图1-1 安全整体建设的框架
第三阶段，系统化建设，安全运维和SDL成体系之后，可以**选择性关注业务安全的问题**。通常以账号安全为切入点，之后选择主营业务风险最大的IT流程活动做相关的业务风险分析和业务风险体系建设。
当安全运维、产品安全（SDL）、业务安全都初步成体系之后是不是安全的整体建设就算完了呢？显然不是。有这些点和面只能说是有了骨架，顶多只能算一层厚薄不均的防御网，薄弱点仍然容易被穿透，因此接下来的工作是进入**运营环节**，也就是所谓的PDCA的工作，把每一个防御点打磨到极致。这一部分工作很重要，但属于非前台可见的"内功"，可能不容易受到管理者的重视，但安全的Leader自己要清楚利害关系，如何在这部分工作投入资源和量化对应的KPI产出是需要考虑的问题。
最后一个层次，当以上点和面的建设都打磨得差不多的时候，安全建设进入"**自由发挥区间**"，这个区间做的事往往跟平台的经营状况，业务的市场地位，业务的全球化属性有很大的关系，已经无法给这个区间的事情贴标签，但也有一些可遵循的参考物，比如对标业界领导厂商。
1.  ## SIEM产品介绍
    1.  ### 背景
企业安全建设进入系统性建设阶段后，随着安全设备的逐渐增多，企业安全运营会面临以下问题：
**一是安全设备多，日常维护压力大。**企业经过一段时间的安全建设，都会建立起较为完善的，或基础的安全防御体系，会部署了一定数量的、多种类型的安全产品，如防火墙、WAF、IPS、NIDS、防病毒、邮件网关、HIDS（Host-based
Intrusion Detection
System，即基于主机型入侵检测系统）等，但各类安全产品之间是相互孤立的。由于安全管理人员精力有限，面对整个安全防御体系中的安全产品，日常维护管理压力很大（主要是需要查看不同设备上的告警并进行分析，进而协调处置）。
**二是日志量大，告警事件多，且无事件处理优先级之分。**种类众多的安全设备，每天都会产生大量的日志，其中不乏大量的误报信息。而实际上，安全建设人少活多，安全运维人员每天能处理的安全事件有限，这就可能导致关键的安全信息和告警被大量的无效告警所淹没。
**三是安全事件闭环处理进展缓慢，或者并无闭环处置。**安全事件对应的资产，往往需要单独再去资产库里面进行查询，同时资产上对应的漏洞也无从得知，在整个安全事件闭环管理上，容易出现安全管理人员未知的大量空白区，导致安全管理人员无法做出有效且快速的判断，实现对安全事件的处置。
同时，安全运营实际上应该是整个内部团队的事情，因为安全运营涉及的方面很多，往往需要跨部门沟通，比如当出现安全事件的时候，进行了一番分析，接下来需要进行处置的时候，就需要和网络、运维或基础架构等不同的部门或小组之间的协调沟通，这个过程可能沟通很慢、推进困难，但是也不能就此搁置不管。这个我们后面还会提到。
**再者就是安全现状不可见。**有时候，在企业的边界上、各安全域中，每天、每周、每月、每年，出现了多少个安全事件？涉及多少种告警类型？安全事件发展趋势如何？最终结果是成功还是失败？我们很少能快速地回答上面的问题。但上述问题又是了解企业综合安全情况的重要衡量指标，这也是与不同的安全设备之间的孤立性有关。
实际上，我们要回答上面的几个重要问题，还是需要先对企业自身的内外网环境以及边界加以了解。
当然，有些企业环境，如银行机构等，内网环境相对比较复杂。边界也不仅是说互联网边界，也可能是各个安全域之间的边界情况。所以我们才需要一个平台或工具类的产品，如SIEM（Security
Information and Event
Managemen，安全信息和事件管理），帮我们将企业中，内网以及边界的各类安全防御技术手段的分析结果，也可以说是日志，集中到一起，并进行二次分析，进而给予安全管理人员以告警信息，让安全管理人员可以借此得到提示，展开取证调查。
同时还是那个问题，**在人少活多的环境下，我们应该优先处理哪些问题？所以应该有个平台或工具来帮我们做分析决策，这就是SIEM。**
SIEM是企业安全发展到系统化建设阶段的必然选择。
### SIEM产品
SIEM（Security information and event
managemen安全信息和事件管理）一个由多个监视和分析组件组成的安全系统，旨在帮助组织检测和减轻威胁。
一款典型的SIEM产品是将许多其他安全规则和工具结合在一个综合的框架下形成的一个合集，包括以下模块：
-   日志管理(LMS)------用于传统日志收集和存储的工具。
-   安全信息管理(SIM)------集中于从多个数据源收集和管理与安全相关的数据的工具或系统。例如，这些数据源可以是防火墙、DNS服务器、路由器和防病毒应用程序。
-   安全事件管理(SEM)------基于主动监视和分析的系统，包括数据可视化、事件相关性和警报
目前成熟的开源SIEM产品有OSSIM、Elastic SIEM、Opensoc。
OSSIM
OSSIM是SIEM的代表性产品，在产品形式上和Kali类似是一个基于Debain进行二次开发的Linux发行版，当前5.6.5版本基于Dibian
8（jessie）。
OSSIM使用Nmap等实现资产发现、使用Nessus等实现漏洞扫描、使用Snort等实现入侵检测、使用MySQL等进行数据存储，自己实现的部分主要是工具、数据整合和可视化展示。ossim存储架构是mysql，支持多种日志格式，包括鼎鼎大名的Snort、Nmap、
Nessus以及Ntop等，对于数据规模不大的情况是个不错的选择，新版界面很酷炫。
从架构上来看，OSSIM系统是一个开放的框架，它的核心价值在于创新的集成各开源软件之所长，它里面的模块既有C/S架构，又有B/S架构，但作为最终用户主要掌握OSSIM
WebUI主要采用B/S架构，Web服务器使用Apache。OSSIM系统结构示意图如下图所示。
![在这里插入图片描述](media/image2.jpeg){width="4.956521216097988in"
height="4.120300743657043in"}
第1层，属于数据采集层，使用各种采集技术采集流量信息、日志、各种资产信息，经过归一化处理后传入核心层。改层体现安全事件来源，入侵检测、防火墙、重要主机发出的日志都是安全事件来源，它们按发出机制分为两类：模式侦查器和异常监控（两者都采集警告信息，功能互补）由它们采集的安全事件，再被Agent转换为统一的格式发到OSSIM服务器，这一层就是Sensor要完成的内容。
第2层，属于核心处理层，主要实现对各种数据的深入加工处理，包括运行监控、安全分析、策略管理、风险评估、关联分析、安全对象管理、脆弱性管理、事件管理、报表管理等。该层中OSSIM
Server是主角，OSSIM服务器，主要功能是安全事件的集中并对集中后的事件进行关联分析、风险评估及严重性标注等。所谓的集中就是以一种统一格式组织所有系统产生的安全事件告警信息（Alarms）并将所有的网络安全事件告警存储到数据库，这样就完成了对网络中所产生事件的一个庞大视图。系统通过事件序列关联和启发式算法关联来更好的识别误报和侦查攻击的能力。
OSSIM本质上通过对各种探测器和监控产生的告警进行格式化处理，再进行关联分析，通过后期这些处理能提高检测性能，即减少告警数量，减小关联引擎的压力，从整体上提高告警质量。
第3层，属于数据展现层，主要负责完成与用户之间的交互，达到安全预警和事件监控、安全运行监控、综合分析的统一展示，形式上以图形化方式展示给用户。Web框架(Framework)控制台界面即OSSIM的Web
UI（Web User
Interface，Web用户界面），其实就是OSSIM系统对外的门户站点，它主要由仪表盘、SIEM控制台、Alarm控制台、资产漏洞扫描管理、可靠性监控、报表及系统策略等部分组成。
OSSIM系统主要使用了PHP、Python、Perl和C等四种编程语言，从软件层面上看OSSIM框架系统包括五大模块：Agent模块、Server模块、Database数据库模块、Frameworkd模块以及Framework模块，逻辑结构如图所示。
![在这里插入图片描述](media/image3.jpeg){width="4.258027121609799in"
height="3.2950820209973752in"}
Elastic SIEM
Elastic SIEM 的核心是全新的 SIEM
应用，此应用是安全团队的交互式工作空间，可允许他们对事件进行分类并开展初期调查。其中包括的时间线事件查看器
(Timeline Event Viewer)
能够允许分析师收集和存储攻击证据，固定相关活动并添加注释，以及添加评论并分享他们的发现，而且这一切在
Kibana 中即可完成；这样一来，您便能够轻松处理符合 ECS 格式的任何数据了。
![在这里插入图片描述](media/image4.png){width="5.763888888888889in"
height="2.473611111111111in"}
Opensoc
Opensoc是思科2014年在BroCon大会上公布的开源项目，但是没有真正开源其源代码，只是发布了其技术框架。可以参考Opensoc发布的架构，结合实际落地SIEM的方案。Opensoc完全基于开源的大数据框架kafka、storm、spark和es等，天生具有强大的横向扩展能力。
![在这里插入图片描述](media/image5.png){width="5.763888888888889in"
height="2.553472222222222in"}
**从SIEM的定义和功能来看有，SIEM两个核心能力，一个是安全信息数据的采集汇聚能力，一个就是安全事件的分析能力。**
### SOC
随着信息安全问题的日益突出，安全管理理论与技术的不断发展，需要从安全的角度去管理整个网络和系统，而传统的NOC（网络运营中心）在这方面缺少技术支撑，于是出现了SOC（Security
Operation Center，安全运营中心）的概念。
SOC是以资产为核心，以安全事件管理为关键流程，采用安全域划分的思想，建立一套实时的资产风险模型，协助管理员进行事件及风险分析，预警管理，应急响应的集中安全管理系统。
SOC是一个复杂的系统，它既有产品，又有服务，还有运维，SOC是技术、流程和人的有机结合。
以前大家所说的SOC是SOC 1.0阶段，只是在SOC的核心部件SIEM的买卖。SOC
2.0是一个复杂的系统，它使用SIEM产品进行运维又以此向客户提供服务，这也是日志易SIEM产品的发展方向。
### 安全态势感知平台
"态势感知"早在 20 世纪 80
年代由美国空军提出，其包含感知、理解和预测三个层次。截止目前，业界对网络安全态势感知还没有一个统一全面的定义，基于美国Endsley
博士的理论对网络安全态势感知做出的定义："网络安全态势感知是综合分析网络安全要素，评估网络安全状况，预测其发展趋势，并以可视化的方式展现给用户，并给出相应的报表和应对措施。"
什么是态势感知平台，大家都认为应该是利用大数据、机器学习等技术对态势感知态势海量数据进行提取，进行多维度的关联分析。能够提供对安全风险保持报警、趋势预测等，海量数据、关联分析、大屏展示和趋势预测是四个重点。而趋势预测最核心，目前做起来也比较难。
**SIEM重点在于对安全事件的感知和理解，态势感知重点在于通过大数据、机器学习等技术加深了对安全趋势的预测**。国外一般不提态势感知系统，而国内很多厂商都推出了态势感知系统。
目前国内安全厂商提供的"态势感知产品"包含的功能模块有：资产管理、漏洞管理、大数据平台、日志分析平台、威胁情报、沙箱、用户行为分析、网络流量分析、取证溯源、威胁捕捉等能力。
安全态势感知平台的几个关键点为：
1.  大数据平台。随着监测范围的扩大，数据量也在扩大，需要一个具备大数据处理和计算能力的平台，这是整个态势感知平台建设很重要的基础。
2.  基于威胁情报的监测。威胁情报对于降低大量数据和报警中的垃圾数据或者报警噪声，帮助更快速、更高效的发现攻击行为和攻击者非常关键，威胁情报的质量是检验态势感知平台能力的很重要的方面。
3.  全要素数据的采集。利用态势感知这样的平台能力的核心目的，是要监测到复杂的、高级的攻击，就需要态势感知平台首先要捕获到微观的状态，低成本、高效率的全要素数据采集能力是基础。
4.  基于攻击场景的分析研判。攻击不再是基于特征的监测，需要运用威胁情报、运用一些专家的经验，来构建基于场景的分析系统，它不是一个静态的东西，是一个与时俱进的攻防对抗过程中不断学习、学习参考的过程，需要持续运营这样的分析管理，需要更多的专家的经验和安全运营人员的参与。
随着**安全态势感知平台的兴起，安全运营中心将以态势感知平台作为智能安全运营的载体**，在风险监测、分析研判、通知协作、响应处置、溯源取证等各方面进行了增强，同时融入了当前流行的技术和平台作为支撑，如大数据技术、东西向流量采集技术，EDR
终端检测响应技术、机器学习、欺骗攻击技术等。同时态势感知平台与
ITIL（Information Technology Infrastructure
Library，信息技术基础设施库）理念与信息安全管理标准相融合，将安全运营划分为不同角色，如安全管理人员、安全专家、安全运维、安全分析师、安全应急响应人员、安全研究人员等，在集成了安全事件管理全生命周期的流程中，通过工作流程将其串联起来，使安全运营流程更加规范和有序。
1.  ## SIEM体系建设
    1.  ### 安全建设相关要素
任何技术的落地都与三个要素息息相关，这在企业安全建设各阶段的体现更加明显。这三个要素分别是：
-   人：公司规模与相关人员；
-   流程：安全意识教育及持续更新；
-   技术，如：
    -   鉴别、授权和审计（AAA）
    -   防火墙/虚拟专用网（VPN）