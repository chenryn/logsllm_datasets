第16章X窗口系统的程序设计
6t
会知道：这些个按钮共享着同一个全局变量lang，它保存着与当前选择对应的值。这就保证了用
户每次只能选取一个单选按钮。
最后，我们定义了两个下压按钮，个在被按下时将退出这个应用程序，另一个会去调用
过程showVars输出当前的选择。
选择框通过命令changeState来改变三个单选按钮的整体状态，根据选择框是否被选中在单
选按钮们的活跃和不活跃状态之间进行切换。下压按钮showValue通过命令showVars把当前的选
择输出出米。
按钮还支持相当其他的选项，比如鼠标掠过方法等。详细资料请使用man命令去查阅button、
checkbutton和option的使用手册页。标题签和按钮还支持位图（bitmap）和图像（image）做为
它们的图案。我们稍后将学习图像的用法。
例子里以“grid.，.”开始的语句其作用是对被创建素材的几何尺寸进行管理。我
们将在稍后对几何尺寸管理进行介绍：
5.消息
消息（Message）类似于标题签，也可以用来显示多行的文本。它们之间的区别是消息能够
自动对文本进行换行，从而把它显示在多个行上；换行发生在单词边界处，文字会根据一定的
纵横比率显示在窗口里。消息素材可以按指定的段落对齐方式来显示文本，并自还可以处理非
打印字符。请看下面的例子：
#1/usr/bin/wish -f
message.m -aspect 400-justify center\
cext
*This 1s a message widget with aspect ratio 400 and\
\256\257\258and tabs\tetc...
pack .m
这个例子将创建出一个里面包含着控制字符的简单的消息素材。
6.输入框
输人框（Entry）是一个单行的文本素材，我们可以通过它敲人和显示一个单行的文本。输
入框还支持许多编辑文本用的键盘按键绑定。请看下面这个小程序login.tk，它能够处理用户的
登录操作，但我们这里没有给出核查用户口令字的代码。
动手试试：创建输入框
1)首先，设置登录窗口的外观。我们还定义了一个全局变量loginName。如下所示：
]- usa/utq/xsm/i#
set loginNane *timB*
label-name_-text*Login:*
entry -passwd&ntry -textvariable passwd -show *
passwd -text *Password:
加入jaVa编程群：524621833
---
## Page 512
494
Linux程序设计
2)然后我们从.nameEntry选取全部文字。如下所示：
nameEntry selection from 1
name&ntry seleetion to end
3）最后，在屏幕上摆放好这些素材一一我们一会儿再解释具体的做法！
mxos-0 mo-1-pse-pb
grid .nane-row 0 -column 0_-sticky *w*
gr1d.
.nameEntry -row 0 -column 1 -colummspan 2 -sticky *W*
运行这个程序的时候，我们将看到如图16-6所示的窗口：
login.tk
口区
Login:
timB
Password:
图16-6
操作注释：
程序开始的前五行代码创建了两个标题签和两个输人框素材，接下来的两行代码对输人框
里的文字进行了选取。selection命令是Tk用来在素材之间移动数据资料的方法。最后四行代码把
创建好的素材安排在屏幕上排列整齐。
X定义了一个提供和检索“选取物”的标准机制，而selection命令就是Tk用来管理
客户间通信（Inter-Client-Communication）的办法它遵守《X客户闺通信符号约定规
则》（XInter-Client Communication Convention Manual，简称ICCCM）中的规定。我们
在这里介绍selection的原因就是想让大家了解你可以在程序里对选取物进行设置，而其
他非TK的X客户可以使用普通的X窗口约定符号检索出那个选取物。
输人框素材通过键盘按键绑定可以实现内部的文本编辑操作。在它由man命令给出的使用手
册页里，你会发现输人框素材除了能够支持“theOSFMotif style guide"（《OSFMotif风格指南》）
中规定的全部Motif绑定以外，还支持大量的EMACS绑定。表16-3是最常用的几个：
表16-3
按键绑定
说明
Ctrl-a
把插入光标移动到输入柜文字的开始处
Cirl-e
把插人光标移动到输人框文字的结尾处
Ctrl-1
选取输入框中的全部文字
7.列表框
列衣糕（ListBox）素材用来显示一组字符串，并允许用户在其中选取一个或多个项目。下
加入jaVa编程群：524621833
---
## Page 513
第16章X窗口系统的程序设计
南这个程序通过列表框设计出一个Motir风格的提示对话框，请注意它里面的用法。
动手试试：列表柜
1）首先，创建用户操作界面的元素。如下所示：
#!, usr/bin/wish -f
srrollbar .h -orlent horizontal -conmand *.list xviewa
scrollbar.v-conmand·.1ist yview*
-setgrid 1-xscroll *.h set"-yscroll*.v set"
-width 2c-henght 10\
label.1abel-textFile Selected:-justity left
enLzy .e -textvaiiabe filnSeleeted
2）为了让素材有Motif风格的外观和动作，需要使用grid几何尺寸管理器。如下所示：
grid.1ist-row 0 -colum _columnspan 2-sticky *newe*
sxs--0-p16
am,Ax9- uedsuno-0no-mox-gpt16
grid.1abel-row2-column3
grid.e -row 3 -column 0-col:umnspan 3 -sticky "we”
grid colummconfigure_.0-weight 1
grid rowconfigure . 0 -weight 1
3）我们用当前子目录里的内容初始化这个列表框，如下所示：
foreach file [glob *]{
.1ist insert end $file
4）最后，我们给这个列表框绑定--个事件处理器，让它对鼠标按键1的释放动作做出反应。
如果你是一个右搬子，“鼠标按键！”一般对应于鼠标的左键；如果是左撤子，一般就对应于鼠
标的右键。我们在这一部分将一直称它为“鼠标按键1”，因为这是代码中使用的惯例。
bind .1ist \
(global fileSelected;set fileSelected [ew get {ew curselection}])
运行这个程序的时候，我们将看到如图16-7所示的窗口：
list.tk
操作注释：
irsuondo
程序先创建出两个卷屏条，再把这两个卷屏条与它创
ufi-boen
建的列表框联系起来。两种素材通过卷屏条的-command选
elloZ.gir
olloT-git
项和列表框的-xview和-yview命令建立起彼此之间的“内连
abelgif
接”（inter-connection）。我们通过这种办法告诉两种素材如
xamples
何交流信息，如何根据对方的几何尺寸或状态做出相应的
tramesgir
调整。我们还会在这一章里看到更多的内连接。
接着，我们通过foreach循环用当前子目录中的内容对
这个列长框进行了初始化。Tcl命令glob的作用是进行模板
Fle Selected:
匹配并返问这些文件名。
framesgr
列表框为了能够对显示在框里的内容进行处理还提供
图16-7
加入iava编程群
：524621833
---
## Page 514
496
Linux程序设计
了其他一些配置方法，象delete、get、index、insert和scan等。
8.卷屏条
正如我们在刚才那个例子里看到的，卷屏条（Scrollbar）经常会与其他素材联系在一起，使
那个素材的显示区可以被卷动。就拿上例中的列表框来说吧，它的显示区是由两个卷屏条“.h”
和“.v”控制的，如下所示：
scrollbar .v-comnand *.1ist yview*
似。列表框则通过下面的命令获知这一内连接情况：
也就是说，我们把这两种素材绑定在了一起并把它们一方的行为通知给对方，我们就是这
样让它们彼此通信的。我们在下一小节会看到一个建立隐含内连接的做法。
9.滑块
滑块（Scale）素材显示一个整数值，用户通过移动一个滑块对这个值进行设取。我们来看
一个简单的例子：
#!/usr/bin/wish -f
set foo 100
label.1 -text *Choose a Value:*-justify left
-showvalue true -length 3i-variable foo
entry .e -width 6 -justify 1eft -textvariable foo
pack .1-side top-anchor nw
pack .8 .e -s1de left -padx 4m -fi11 x
运行这个程序的时候，我们将看到如图16-8所示的窗口。
scale.
Qhoose a Value:
627
627
D
500
100015002000
图16-8
这里，滑块和输人框通过全局变量foo共享着一个隐含的内连接。如果你刷新滑块中的数值，
输人框里的值也会自动改变。
Tk素材的事件处理器里明确使用的一切变量都是全局范围的。如果变量不存在，
Tk将自动为你创建一个。因此，在上面的例子里，变量foo就是一个全局变量，而
滑块和列表框两个素材则共享着这个变量，这就为它们的行为建立了一个隐含着的
联系。
加入jaVa编程群：524621833
---
## Page 515
第16章X窗口系统的程序设计
10.文本
人们用Tk的文本（Text）素材来创建多行的可编辑文本，它的用途是很广的。它们支持二
种影响到文本显示效果的属性，即标签（tag）、书签（mark）和嵌人窗口（embedded window）。
·标签允许文本的不同部分被显示为不同的字体、颤色和凹凸效果。标签还可以与Tcl命令相
关联，使之能够对用户的动作产生反应。
·书签用来记录文本中各种有趣的位置。
嵌人窗口：而文本中所有的嵌人窗口都必须以该文本素材做为它们的父素材。
我们米看一个文本素材部分特性的演示程序。
TK文本素材的功能是很强大的，我们只委稍做修改就可以把它们用做HTML素材
著名的使用手册页查看器TkMan软件就使用了Tk的文本素材，它能把普通的UNIX使用
手册页显示为超链接的形式。
动手试试：文本操作
1）首先，我们创建一个垂直卷屏条并把它连接到文本素材上去。然后把它们并排打包在一
起，并让文本窗口扩展到充满整个可用窗口空间。
即使调整了窗口的尺寸，我们还是要让文本窗口继续充满着整个窗口，我们是这样告诉打
包器的：如果垂直方向上还有多余的空间，就扩展这两种素材，让它们占据那部分空间。但如
果在水平方向上有多余的空间，就只扩限文本素材。
1/usr/bin/wish -f
scro11bary-command"t yview*
---x
-height 25-yscrollcommandy set
pack .y -side left -fill y
2）接着，我们来创建嵌人窗口。我们不必操心它们的管理，因为文本素材会安排好这些
set fmage [image create photo -file mickey-gif -width 200 -height 2C0]
label.t.1 -inage Simage
button .t.b -text *Hello World1*-comand*puts Hi*
3）然后我们配置出所有将要关联到文本窗口的标签，如下所示：
.t tag configure bold -font -*-Courier-Bold-O-Normal--*-120-*-+-.+-+
.t tag configure blueFg-foreground blue
.t tag configure yellowBg_-background yellow
t tag configure yellowBgBlueFg -background yellow -foreground red
.t tag configure underline -underline 1
.t tag configure raised -relief raised -borderwidth 2
.t tag configure left
t tag configure
center -justify center
.t tag contigure right -justify right
-justify left
.t tag configure super -offset 4p
加入jaVa编程群：524621833
---
## Page 516
86
Linux程序设计
mo puoxq-
-background (}*
4）配置好标签之后，我们按它们的要求插人文本。虽然图像不是我们设计的，可文字部分
确实都是我们的工作成果。
.t insert end *Tk text widget is so versatile that it can support many \
.t insert end *Background;*bold
display styles:\n*
.t insert
endYou can change the
t
.C
insert end or
.t insert end or
.t insert
end*foreground*blueFg
.t insert
end *both*yellowBgBlueFg
t
insert
end*\nUnderlining.boid
.t
insert
eo nok.pua
.t
.t insert