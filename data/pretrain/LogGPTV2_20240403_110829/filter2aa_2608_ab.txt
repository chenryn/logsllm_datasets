– 把 request 序列直接当特征码 
• 因为 request list 会因为各家 DHCP client 的实作不
同而有所不同 
– 以刚刚那个 Win7 packet 为例， 
• 先找到 Option 55/0x37,跳过一个 byte (长度), 再比 
• 0x01, 0x0f, 0x03, 0x06, 0x2c, 0x2e, 0x2f, 0x1f, 
0x21, 0x79, 0xf9, 0x2b 
• 1,15,3,6,44,46,47,31,33,121,249,43 
2015/8/29 
HitCon2015: LAN device detection 
40 
How to detect LAN devices 
2. Check the DHCP options 
2015/8/29 
HitCon2015: LAN device detection 
41 
How to detect LAN devices 
2. Check the DHCP options 
• 一些 DHCP option 55 特征码 [2][4] 
– For Win7/Server2008 
• 1,15,3,6,44,46,47,31,33,121,249,43 
– For Win 8 
• 1,15,3,6,44,46,47,31,33,121,249,252,43 
• 1,3,6,15,33,44,46,47,121,249,43,60,212 
– For Apple iPod, iPhone or iPad 
• 1,3,6,15,119,78,79,95,252 
• 1,3,6,15,119,252 
• 1,3,6,15,119,252,46,208,92 
• 1,3,6,15,119,252,67,52,13 
2015/8/29 
HitCon2015: LAN device detection 
42 
How to detect LAN devices 
3. Check the user-agent of HTTP  
• 有时候，检查 Browser 的 user-agent 里面
的 keywords 也是一个选项。 
– 的确，user-agent 比 MAC address 或是 
DHCP option 55 更容易被假造。 
– 没有办法时的办法，加减用一下  
2015/8/29 
HitCon2015: LAN device detection 
43 
How to detect LAN devices 
3. Check the user-agent of HTTP  
• IE11 on Win7 
– User-Agent: Mozilla/5.0 (Windows NT 6.1; 
WOW64; Trident/7.0; rv:11.0; GTB7.5) like 
Gecko 
• iPhone 
– Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_3 
like Mac OS X; en-gb) AppleWebKit/533.17.9 
(KHTML, like Gecko) Version/5.0.2 
Mobile/8F190 Safari/6533.18.5 
2015/8/29 
HitCon2015: LAN device detection 
44 
How to detect LAN devices 
4. Check the used applications 
• 有些 things/devices 没有 Ethernet/Wifi，必
须透过 (IoT) Gateway 转换通云端 (to log 
servers)。 
– 看不到 MAC address, DHCP options 55, 不一
定有 user-agent 
– 传统招式： 
• IP、domain name、traffic or string-based patterns. 
• 还是要想法子识别 
2015/8/29 
HitCon2015: LAN device detection 
45 
How to detect LAN devices 
4. Check the used applications 
• AppID 
–1. 关于一般 pattern-based AppID 
–2. AppID for SSL-based applications 
–3. AppID for encrypted applications 
2015/8/29 
HitCon2015: LAN device detection 
46 
How to detect LAN devices 
4. Check the used applications 
• 关于一般 pattern-based AppID 
– 主要是AppID会希望 connections 能够被尽早
的识别出来并标注适当的ID ，这样可以及早 
apply QoS 
– IPS则是必须在关键时刻挡下攻击，在高速网
路(一秒钟几十G上下)的环境，就会变得很刺激 
2015/8/29 
HitCon2015: LAN device detection 
47 
How to detect LAN devices 
4. Check the used applications 
• AppID for SSL-based applications 
– 有些人遇到 SSL 的连线就放弃识别了， but 
2015/8/29 
HitCon2015: LAN device detection 
48 
How to detect LAN devices 
4. Check the used applications 
• AppID for SSL-based applications 
•
Source: http://www.cisco.com/c/en/us/support/docs/security-vpn/secure-
socket-layer-ssl/116181-technote-product-00.html 
2015/8/29 
HitCon2015: LAN device detection 
49 
How to detect LAN devices 
4. Check the used applications 
• Certificate 里面有些 keywords 可以抓 
•   
2015/8/29 
HitCon2015: LAN device detection 
50 
How to detect LAN devices 
4. Check the used applications 
• Certificate 里面有些 keywords 可以抓 
•   
2015/8/29 
HitCon2015: LAN device detection 
51 
How to detect LAN devices 
4. Check the used applications 
(AppID for encrypted applications) 
• 如果，你遇到的是私有的加密方式或编码，
无法知道封包的解析规则 
– 那还有招吗？ 
2015/8/29 
HitCon2015: LAN device detection 
52 
How to detect LAN devices 
4. Check the used applications 
(AppID for encrypted applications) 
• 那我们提供一个没有办法的办法 
– 放弃识别 payload 
– 单靠 方向、封包长度，产生出对应的 finite 
state machine (FSM) 
– 如果，这个 FSM 可以 match 某个 connection，
我们就假定它应该跟我们用来画出这个 FSM 
的 connections 是同一种。 
2015/8/29 
HitCon2015: LAN device detection 
53 
How to detect LAN devices 
4. Check the used applications 
(AppID for encrypted applications) 
2015/8/29 
HitCon2015: LAN device detection 
54 
How to detect LAN devices 
• 谁适合做 LAN Device Identification? 
• IoT Home Router/Gateway? 
– 兵家必争之地？ 
– LAN 与 WAN 资料交换必经之路 
– 一般来说，真正的 source MAC address 与 
DHCP option 55 只有在 LAN 看得到。 
2015/8/29 
HitCon2015: LAN device detection 
55 
How to detect LAN devices 
• Do you know the RAM-size in your home 
router? 
– 你知道家里的 router 的 RAM 是多大吗？ 
– In embedded system, in general, the RAM-
size imply the functionality which can be 
equipped. 
2015/8/29 
HitCon2015: LAN device detection 
56 
How to detect LAN devices 
2015/8/29 
HitCon2015: LAN device detection 
57 
How to detect LAN devices 
• 当大部分的家用 router 的 RAM 少于 128M，
(32M 是主流)，大家觉得它会拿多少出来给  
security functions? 
– 无米之炊…. 
– 这是大环境的问题，需要大家一起解决。 
– Security has its price. 
2015/8/29 
HitCon2015: LAN device detection 
58 
• The threat intelligence with LDI 
2015/8/29 
HitCon2015: LAN device detection 
59 
The threat intelligence with LDI 
• 我们和 home router 厂商合作，取得 user 
同意的 logs，汇整到我们的 cloud。 
– Timely 
– Accurate  
– Relevant 
2015/8/29 
HitCon2015: LAN device detection 
60 
The threat intelligence with LDI 
2015/8/29 
HitCon2015: LAN device detection 
61 
The threat intelligence with LDI 
• 底下是一些去可识别化的统计资讯 
2015/8/29 
HitCon2015: LAN device detection 
62 
The threat intelligence with LDI 
2015/8/29 
HitCon2015: LAN device detection 
63 
The threat intelligence with LDI 
Device by type 
2015/8/29 
HitCon2015: LAN device detection 
64 
The threat intelligence with LDI 
Traffic by Device 
2015/8/29 
HitCon2015: LAN device detection 
65 
The threat intelligence with LDI 
CVE 2015-0554 (Release Date: 2015/1/21) 
2015/8/29 
HitCon2015: LAN device detection 
66 
The threat intelligence with LDI 
Security Events timeline 
2015/8/29 
HitCon2015: LAN device detection 
67 
The threat intelligence with LDI 
• 第二届台湾资料科学爱好者年会 
– 阿里巴巴数据委员会会长-车品觉： 
– 数据科学现在有两大派别： 
• 数据很平但用深厚的演算法解决问题， 
• 另一种是数据广泛而大但是用简单的演算法。 
• 我(车品觉)个人的喜好是第二个  
2015/8/29 
HitCon2015: LAN device detection 
68 
The threat intelligence with LDI 
• 我们也是喜欢简单的演算法  
• 再回到那个冰箱送 SPAM 的问题 
– 万一，我们发现你家的冰箱开始送 emails 
– 我们会比对别人家的同款的冰箱们是不是也会
送 emails 
– 如果，你家的冰箱是特别的 
– 理论上，将来我们会想法子通知你…. 
• 自己的冰箱自己救 
2015/8/29 
HitCon2015: LAN device detection 
69 
• Summary 
2015/8/29 
HitCon2015: LAN device detection 
70 
Summary 
(Some things about LAN device identification) 
• 1. 在 IoT 时代，网路设备识别自动化是需
要的。 
• 2. 在 LAN 端，我们可以透过 MAC OUI，
DHCP packets 取得品牌与作业系统的相关
资讯。 
• 3. 精准的设备识别 结合 Big Data 的运算能
力，才有办法真正做到 threat intelligence。 
2015/8/29 
HitCon2015: LAN device detection 
71 
Acknowledgements 
• The Authors would like to thank 
– Eric Lien 
– MiG Chien 
– Hubert Lin 
– Ping-Jhih Chen 
– Miles Xie 
– Mit Liao 
– Justin Jan 
– and other helpers. 
2015/8/29 
HitCon2015: LAN device detection 
72 
Reference 
• 1. MAC address 
– https://en.wikipedia.org/wiki/MAC_address 
• 2. Fingerbank 
– https://fingerbank.inverse.ca/ 
• 3. Using DHCP for Passive OS Identification 
– http://chatteronthewire.org/download/bh-japan-
laporte-kollmann-v8.ppt 
• 4. Packetfence 
– http://www.packetfence.org/ 
2015/8/29 
HitCon2015: LAN device detection 
73 
One more thing 
(在 HITCON2015 ENT, 两个 hackers 的问答) 
• 安东尼问： 
– 我们一直揭露侦测与防御的技术，会不会造成
坏人一直改进，使得我们侦测与防御的能力变
弱？ 
• 博德曼答： 
– 不用担心这个问题，因为我从来没有在公开的
演讲，揭露我真正的实作方法与技术  
• Comments: 
– 也不是说我们这些 speakers 都留一手，而是
说我们做的比说的好   
2015/8/29 
HitCon2015: LAN device detection 
74 
Q&A 
• Thank you  
• E-mails: 
– For media and business 
• Terence Liu   
– For job opportunity 
• Hsien-Wei Hung   
– For technique 
• Canaan Kao  
2015/8/29 
HitCon2015: LAN device detection 
75 
About BoT2015 
• 现状： 
– 我现在还不能跟大家确认今年不会有 BoT2015 
– 大概九月底会有 update 
• Facebook for BoT conference: 
– https://www.facebook.com/BotnetCon 
2015/8/29 
HitCon2015: LAN device detection 
76