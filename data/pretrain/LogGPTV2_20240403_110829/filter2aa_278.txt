(U) I hunt TR-069 admins
Shahar Tal
TOP SECRET//SI//REL TO DC22
no ISPs were harmed during the
making of this presentation
corporate legal wouldn't let us
• Shahar Tal (@jifa)
• Father, husband, geek
• 10 years with IDF
obligatory whoami
Residential Gateway Security
• It sucks.
• Pedro Joaquin (Routerpwn), Jacob Holcomb (“So hopelessly broken”), 
Zachary Cutlip (“rooting SOHO”), devtty0 (D-Link “joel’s backdoor” and more)
TR-069 in 69 seconds
CPE WAN Management Protocol 
(CWMP/TR-069)
TR-069 (cont.)
SOAP RPC
(XML over HTTP)
Always* initiates session
Dual authentication mechanism
TR-069 Example RPC (ACSCPE)
1337069
InternetGatewayDevice.ManagementServer.URL
http://acs.supersecureisp.com/cwmp/
1337069
Secure-Devices-R-Us
001337
IGD
123456789
2 PERIODIC
1
2014-08-09T01:49:14+00:00
0
Device.DeviceSummary
Device.DeviceInfo.HardwareVersion
5.0
Device.DeviceInfo.SoftwareVersion
1.22
Device.ManagementServer.ConnectionRequestURL
http://2.65.32.114:7547/
Device.ManagementServer.ParameterKey
null
Device.LAN.IPAddress
192.168.1.1
1
1
TR-who?
• (2011) Estimated 147M TR-069 enabled devices online
• 70% Gateways
• According to zmap, 7547 is open on 1.12% of IPv4
• 2nd most popular open port in the world
Good Guy ACS
• Monitor for faults, errors or malicious activity
• Measure performance
• Assist users by allowing Tech Support remote management
• Replace/fix faulty configuration
• Deploy upgraded firmware
TR-069 Architecture
Photo credit: https://www.etsy.com/shop/sharpwriter
• Internet facing HTTP servers
• Non-trivial connectivity to internal ISP assets
Why should intelligence agencies care?
Why should you care?
• Because intelligence agencies do
Scumbag ACS
• What would an attacker do if he was in control of an ACS?
• Get private data
• SSID, hostnames & MAC addresses, usernames, VoIP
• Get complete configuration incl. passwords (vendor-specific)
• Set every parameter
• DNS servers
• Wi-Fi (add new hidden SSID, remove password)
• PPP (replace WAN service with attacker controlled tunnel)
• Download
• Configuration, firmware, logs
• Upload
• Configuration, firmware
Previous Work?
• Luka Perkov (“ISP’s black box” @ 29c3, UKNOF24)
• A brief survey of CWMP security (3SLabs)
• http://blog.3slabs.com/2012/12/a-brief-survey-of-cwmp-security.html
• That’s about it.
• (Apologies if my google fu wasn’t strong enough to find you)
Niche Market
• Service Provider world
• TR-069 community? 
TR-069 Community
ADB, Affinegy, Agile ACS, Alvarion, Arris, AVSystem, Axiros, Calix, Cisco, Comtrend, Consona, Dimark, Draytek, Fine Point Technologies, 
Friendly Tech, GIP, Incognito Software, Intraway, Iskratel, iWedia, Jungo, Juniper Bridge, Mobigen, Motive, Netgem communications, 
Netmania, OneAccess, Pace, ProSyst, Ronankii Infotech, Sigma Systems, Tata Elxsi, Tilgin, Wi-tribe, Wind River, Works Systems
I got TR-069 problems
Insecure 
Configuration
Insecure 
Implementation
How do you find ACSs ITW?
• Hack a single router. QED.
• Scanning
• zmap/masscan FTW
• 7547 and friends
• UPnP endpoints
• Public datasets
• Internet Census 2012
• DNS Census 2013
• lmgtfy
• lmstfy
Insecure Configuration
• Poor/Non-existent Perimeter Security
• Uhhm, like, firewalls.
• Misunderstanding of Architecture
Authentication Drill Down
• SSL or shared secret
• Shared secret = HTTP auth (basic/digest)
HTTP
81%
HTTPS
19%
Stealing the Secret
• Router interfaces try to protect ACS passwords.
• But… allow you to change the ACS URL.
.
• ACS chooses and can enforce HTTP Basic auth
• Base64 encoded “username:password”
SSL Certificate Validation
Field Test
OpenACS
• Open source (Java)
• Start auditing
• 3 days later: RCE 
• Reflection + Native File Upload = CVE-2014-2840 
GenieACS
• Open source (Node.js, Redis, MongoDB)
• Start auditing
• 2 days later: RCE
• Non-Global regex
• Running as root
output = input.replace(/[\[\]\\\^\$\.\|\?\+\(\)]/, "\\$&")
GET /devices?query=["./;require('util').log(‘lolwut');//*"] HTTP/1.1
PWNAGE
>be scanning ipv4 for GenieACS
>detect instance in Iraqi ISP
>nbi exposed
>picard_facepalm.png
>OP delivers (vulnerability report)
>Iraqi ISP support center not thrilled with Israeli calling about “vulnerable 
infrastructure” 
>8/10 would report again
What can I do?
• Audit your TR-069 settings
• Ensure SSL & proper cert validation
• Unsatisfied? disable TR-069
• (If you can)
• Add home security layer
• Another router with NAT/FW capabilities
• Open source firmware alternatives
• Ask your provider about their TR-069 configuration!
Fixing the Problem
• There is no easy fix.
• Bad implementations are out there, this is a long process
• TR-069 has to mature
• Awareness is key
• Security community
• That’s you guys
• ACS vendors
• Write better software, put money in secure coding
• Show your security stance (bug bounties?)
• Certification (?)
• Service Providers 
• Protect your customers, it’s your responsibility
More Directions
• Stay tuned for CCC
Questions
• https://www.iol.unh.edu/sites/default/files/knowledgebase/hnc
/TR-069_Crash_Course.pdf TR-069 Crash Course (University of 
New Hampshire Interoperability Laboratory)
• https://community.rapid7.com/servlet/JiveServlet/download/21
50-1-16596/SecurityFlawsUPnP.pdf Whitepaper: Security Flaws in 
Universal Plug and Play: Unplug, Don’t Play. (Rapid7)
• http://internetcensus2012.bitbucket.org/ Internet Census 2012 
(anonymous researcher)
• http://www.team-
cymru.com/ReadingRoom/Whitepapers/SOHOPharming.html
SOHO Pharming (Team Cymru)