title:Exploiting diverse observation perspectives to get insights on the
malware landscape
author:Corrado Leita and
Ulrich Bayer and
Engin Kirda
201O IEEEIIFIP International 
Conference 
on Dependable 
Systems & Networks (DSN) 
Exploiting 
to get insights on the mal ware landscape. 
diverse observation 
perspectives 
Corrado Leita 
Ulrich Bayer 
Engin Kirda 
Symantec Research Labs 
Sophia Antipolis, 
France 
Technical 
University 
Vienna, Austria 
Vienna 
Institute 
Eurecom 
Sophia Antipolis, 
France 
PI:EMAIL 
PI:EMAIL 
PI:EMAIL 
Abstract 
We are witnessing 
an increasing 
complexity in the mal­
into a daily load of approximately 
30,000 
explained 
can be partially 
with which mal ware writers 
can generate 
by 
new 
The usage of polymorphic 
tech­
existing 
code bases, or by re-packing 
a new challenge: 
of a known polymorphic 
it is often difficult to 
malware from 
using code obfuscation 
tools [21,22,27]. 
In ad­
mal ware sample counts are biased by the increasing 
numbers translate 
samples per day. This  load 
the easiness 
code by personalizing 
the binaries 
dition, 
usage of polymorphic 
such as Allaple 
mutate the binary content 
agation 
attempt. 
[10] take advantage 
techniques 
[5]. For instance, 
worms 
to 
file at each prop­
of these techniques 
of the executable 
of different 
information 
Such an explosion 
in the number of samples increases 
scenario. 
ware analysis 
niques generates 
discern the instance 
that of a newly encountered 
the impact of patching 
writers 
in order to prioritize 
malware family, 
and to evaluate 
and code sharing 
among malware 
analysis efforts. 
study on the value of 
malware relationships. 
By leveraging 
honeypot de­
data generated by a distributed 
in studying 
characteristics 
we combine clustering 
This paper offers an empirical 
the complementarity 
exploiting 
sources 
real-world 
ployment, 
and behavioral 
how this combination 
lies. We also show how the different 
approaches 
ships among different 
the importance 
agation 
for getting 
and the "economy" 
can help, once combined, 
code variants. 
of contextual 
helps in detecting 
information 
a deeper understanding 
of the different 
threats. 
and we show 
clustering 
anoma­
of the 
characteristics 
to underline 
relation­
Finally, 
we highlight 
on malware  prop­
of the evolution 
techniques 
of the samples, 
based on static 
1. Introduction 
On the one hand, a com­
of the malware landscape 
polymorphic 
instances 
from 
only by discerning 
analyst. 
on the complexity 
the task of the security 
plete picture 
is possible 
new variants. 
ing of the mal ware landscape 
get quantitative 
ferent families, 
share code and produce patches 
On the other hand, to get a full understand­
we need to go further, 
and 
among the dif­
on the interrelations 
insights 
and on the extent to which mal ware writers 
to known variants. 
study based on one 
an empirical 
by a distributed 
honeypot 
of protocol 
deploy­
learn­
[17]. By taking advantage 
SGNET is able to emulate code injection 
This paper presents 
year of data collected 
ment, SGNET 
ing techniques, 
attacks 
in a protocol 
edge of the vulnerabilities 
properties 
network domains, 
the current 
ware samples, 
server-side 
malware landscape 
and its deployment 
agnostic 
the SGNET dataset 
is representative 
for a specific 
of 
class of mal­
by means of 
namely samples that propagate 
code injection  attacks. 
way, and without 
prior knowl­
Because of its 
being exploited. 
in a large number of different 
Malware plays a major role in today's 
systems 
user pes puts an attacker 
Internet 
and installing 
Breaking 
code to remotely 
threat 
sce­
ma­
into vulnerable 
control 
to undertake 
narios. 
licious 
into the position 
ranging 
logging 
tion of unsolicited 
a number of illicit 
activities 
Many different 
tools and techniques 
have been devel­
Several 
through 
key­
to the genera­
breach (e.g., 
attacks, 
from data confidentiality 
activities), 
denial of service 
traffic. 
indicators 
oped in order to study the malware landscape.  Previ­
ous work proposed 
samples according 
an exponential  explosion 
teristics 
Despite 
that static 
sify malware, 
engines 
to cluster 
mal ware 
structural 
(such as in [26]) or their dynamic behavior 
the general 
we show in this work that most polymorphic 
in the wild have a low level of sophistication 
different 
to either their static 
to [7], the amount of samples sub­
[25], a popular virus scanning 
plat­
of samples per month. Such 
the number of newly generated 
For instance, 
mitted to VirusTotal 
form, is in the order of millions 
charac­
[4]. 
are not suitable 
in the research 
approaches 
approaches 
samples per day. 
community 
according 
consensus 
malicious 
to cluster 
suggest 
and clas­
and 
of 
978-1-4244-7501-8/10/$26.00 
©201O IEEE 
393 
DSN 2010: Leita et al. 
Authorized licensed use limited to: Tsinghua University. Downloaded on March 18,2021 at 14:00:10 UTC from IEEE Xplore.  Restrictions apply. 
2010 IEEE/IFIP International 
Conference 
on Dependable 
Systems & Networks (DSN) 
Sample 
Factory 11 
Semple 
Factory 12 
Shellcode 
Handler 
Figure 1. SGNET architecture 
Sensor 1 
characteristics 
of 
can still be useful for cluster­
techniques 
that simple static 
ing malware. 
of a very simple pattern 
the propagation 
the mal ware samples observed 
More specifically, 
generation 
technique 
and the structural 
strategy 
we show the effectiveness 
in classifying 
by the SGNET dataset. 
techniques 
clustering 
based 
We show how, by combining 
or behavioral 
environmental 
static 
we are able to detect clustering 
on either 
samples, 
ated by different 
how the combination 
on patching 
ware samples that would be invisible 
nique based on a single feature 
Many malware collection 
causes. 
of the two feature 
practices 
and code sharing 
techniques 
type. 
characteristics 
anomalies 
of the malware 
gener­
we show 
Moreover, 
sets offers insights 
in the observed 
mal­
tech­
to any clustering 
Senaor 3 
Senaor2 
We underline, 
through 
solely focus on the 
prac­
the knowl­
approaches 
with 
the usefulness 
by mal ware classification 
of combining 
of mal ware binaries. 
information 
collection 
tical examples, 
edge generated 
contextual 
by the SGNET deployment. 
such information 
to generate 
that helps the security 
ing of the "economy" 
modus operandi 
on malware propagation 
generated 
We show the importance 
rich, structured 
of 
analyst to 
obtain a better 
of the different 
threats 
knowledge 
understand­
and on the 
of the individuals 
at their root cause. 
2. Related work 
Previous 
mal ware clustering 
approaches 
that statically 
in [11] requires 
by Ghorghescu 
step and then performs 
the binary and systems that do not. The cluster­
the samples can be grouped into systems that dis­
by comparing 
of [14] determine 
their basic blocks. In contrast, 
of two binaries 
a prior 
a clustering 
of the 
the 
by 
analyze 
assemble 
ing system presented 
disassembling 
binaries 
authors 
comparing 
Wicherski  presented 
naries in such a way that polymorphic 
receive 
the 
same hash value [26]. peHash is able to statically 
large number of samples by grouping 
them according 
to the 
portions 
phic packers. 
of the PE header that are not mutated by polymor­
a hex dump of their code segments. 
peHash, a system for hashing PE bi­
the similarity 
binaries 
classify 
a 
Recently, 
The first attempts 
to cluster 
malware according 
to its be­
of the binaries) 
binaries 
requiring 
malicious 
by comparing 
of two binaries 
a dynamic analysis 
the system 
in [15] deter­
system 
For example, 
described 
havior (i.e., 
were based on system call traces. 
for classifying 
mines the similarity 
call traces of their execution. 
of the system is poor because system call traces are usu­
in long comparison 
ally large in size and, thus, result 
Bailey et at. were the first to build a clustering 
system [3] 
that described 
in more abstract 
The authors 
several 
sults were correct, 
of samples. 
the clustering 
the system suffers from the simplicity 
their prototype 
implementation 
evaluated 
a sample's 
behavior 
Although 
hundreds 
re­
of 
terms. 
times. 
However, the performance 
with 
ex­
that are not able to precisely 
descriptions 
Moreover, 
because it requires 
Holz was proposing 
the presented 
the computation 
a classification 
the behavioral 
press the behavior. 
scalable 
tances. 
for mal ware samples that uses the analysis 
CWSandbox sandbox system for computing 
of two samples. 
chine learning 
labels to build the initial 
have pointed 
such labels for mal ware classification 
set. Different 
out in the past the limitations 
purposes. 
ma­
relies on commercial 
The approach, 
techniques, 
training 
system is not 
of O(n2) dis­
system in [12] 
results 
the similarity 
based on supervised 
antivirus 
in the usage of 
works [3,7] 
of the 
In this paper, we make use of the 
behavior-based 
cluster­
ing system provided 
platform 
called Anubis [1,6] (i.e., 
see Section 
3.3). 
publicly 
as part of the 
dynamic analysis 
3. SGNET and EPM clustering 
to 
The analysis 
carried 
out in this paper is based on a freely 
SGNET [17]. In contrast 
on the collec­
SGNET focuses 
honeypot 
dataset, 
on code injection 
for these attacks. 
accessible 
other mal ware collections, 
tion of detailed 
information 
on the sources responsible 
ware sample collected 
riched by contextual 
on the attacks, 
tion of the attack in time, and on the structure 
injection 
itself. 
SGNET dataset 
approach 
analysis 
[18] that aggregates 
tools such as VirusTotal 
The contextual 
is generated 
by the deployment 
data generated 
information 
information 
by an information 
attacks 
and 
Each mal­
en­
the evolu­
of the code 
by the 
[25] and Anubis [1,6]. 
provided 
is, therefore, 
enrichment 
by different 
3.1. The SGNET dataset 
SGNET is a distributed 
honeypot 
deployment 
focusing 
on the study of code injection 
nally presented 
in [17], and then presented 
SGNET was origi­
with further 
attacks. 
de-
978-1-4244-7501-8/101$26.00 
©2010 IEEE 
394 
DSN 2010: Leita et al. 
Authorized licensed use limited to: Tsinghua University. Downloaded on March 18,2021 at 14:00:10 UTC from IEEE Xplore.  Restrictions apply. 
2010 IEEEIIFIP International 
Conference 
on Dependable 
Systems & Networks (DSN) 
to address 
rich information 
as much as possible 
tails in [16]. SGNET takes advantage 
techniques 
trieve 
longing 
and the need to reduce the resource 
inherent 
[19,20], 
versation 
use such models to respond to clients 
tivities. 
SGNET honeypots 
versations 
service implementation 
in  a distributed 
SGNET honeypots 
through 
Whenever a new/unknown 
to a honeyfarm, 
a Finite 
of protocol 
learning 
proposed 
tion attack into four distinct 
phases: 
in [9]. The EGPM model structures 
each injec­
a trade-off 
about the observed 
between the need to re­
by pro­
activities 
the conversation 
with clients 
• Exploit (E). The set of network bytes being mapped 
and maintenance 
costs 
deployment. 
By using ScriptGen 
are able to model protocol 
con­
State Machine (FSM) model and 
onto data which is used for conditional 
decisions. 
that the attacker 
vulnerable 
service 
This consists 
to the failure 
needs to perform in order to  lead 
in the set of client requests 
control 
flow 
point. 
the 
for well-known 
ac­
• Bogus control data (,). The set of network bytes be­
are able to dynamically 
activity 
is encountered, 
proxy the con­
ing mapped into control 
flow trace and redirects 
data which hijacks 
it to somewhere 
else. 
the control 
and take advantage 
of the real 
to handle the interaction. 
is encountered, 
of a new sample 
Figure 1 shows the main components 
of the SGNET de­
sen­
en­
SGNET is composed of multiple 
the instantiation 
The sample factory, 
Whenever a new activity 
require 
ployment. 
low-cost 
sors whose FSM model is kept in sync by a central 
tity, the gateway. 
SGNET honeypots 
factory to the central gateway. 
Argos [23], acts as an oracle and provides 
required 
detects 
tion attacks. 
apply the ScriptGen 
edge. After having seen  a sufficient 
the same type of interaction, 
able to handle autonomously 
activity 
is used by the gateway to 
and refine the FSM knowl­
number of samples of 
of the same 
the newly built FSM refinement. 
Such information 
future instances 