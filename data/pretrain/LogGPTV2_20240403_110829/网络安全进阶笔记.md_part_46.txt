源，对其攻击行为进行审计和取证，从面能够让防御者清晰地了解所面对的安全威胁，并通过
法律手段去追究攻击者的责任，或者通过技术和管理手段来增强对实际系统的安全防护能力。
那么，间谋的“十八般武艺”通常有哪些呢？回到网络世界，密罐关键技术包括以下几类。
（1）数据抽获技术。手段高明的入侵者攻入系统后，常常会试图更改甚至销毁目标主机上
的各种记录。因此，数据捕获主要是在日志文件中查找操作记录。通常情况下，日志文件包括
防火墙日志、IDS日志和密罐主机的系统日志，即“三重捕获”，其中，防火墙在网络层记录
所有出入密罐的连接，并且及时向系统管理员发出警告信息：IDS在数据链路层对蜜罐中的网
络数据流进行监控、分析和抓取，以便将来能够重现攻击行为，并在发现可疑行为时报警：密
罐主机除了使用操作系统自身提供的日志功能外，还可以利用第三方软件加强日志功能，传输
到安全级别更高的远程日志服务器上备份。
（2）网络款骗技术。为了使密罐对入侵者更有吸引力，需要采用各种欺骗手段来诱骗攻击
者。例如，在款骗主机上模拟一些网络攻击者最“喜欢”的端口和漏洞。蜜罐主要的网络欺骗
技术包括：模拟服务端口、模拟系统漏洞和应用服务、IP空间欺骗、流量仿真、网络动态配置、
网络服务、蜜罐主机，其中，网络流量仿真是常用来迷惑并吸引攻击者的方法。此外，还可以
采用实时方式或重现方式复制真正的网络流量，或者从远程产生伪造流量，诱骗入侵者。
（3）攻击报警和数据控制。该技术保证一旦密罐被攻陷，网络攻击者不会利用密罐攻击其
他系统并造成危害。该技术的难点是如何在控制住数据流量的同时又不引起攻击者的怀疑。在
攻击者突破蜜罐后，他们最需要的就是网络连接，以便从网络上下载攻击工具包、打开IRC连
接等，蜜罐允许他们做大部分的“合法”事情。但是对攻击其他系统的“需求”，比如发起拒
绝服务攻击、对外部扫描以及使用漏洞攻击他人的行为，则一概禁止。对于高包含性的蜜罐，
则必须采取外部数据控制的措施，如IDS或带宽限制。通常采取的方法是：使用多层次控制，
避免单点失效的风险：进行人工实时监控，一旦入侵者的活动超越了受控制的范围面产生威胁
时，马上终止所有连接。
---
## Page 223
网络安全进阶笔记
（4）端口重定向技术。端口重定向技术就是在工作系统中模拟一个非工作服务，为了吸引
网络攻击者上钩，一个较好的办法就是构建一个复制的模拟网，然后利用防火墙的端口映射或
重定向技术，将它重定向到一个蜜网IP地址中，如同余则成监视李涯一样，可以在不被攻击
者察觉的情况下监视他们的行动，得到攻击者所使用的工具、采用的方式、通信方法、组织机
构和入侵动机等信息，同时耗费他们的精力。例如我们正常使用Web服务，而用Telnet和FTP
重定向到蜜罐系统中，而实际上这两个服务是没有开启的，攻击者扫描时则发现这两个端口是
开放的，实际上这两个端口是蜜罐虚拟出来的，对服务器不会产生任何危害性。
通过上述技术的综合运用，我们完全可以模仿余则成的卧底神功，将蜜罐系统模拟成一个
操作系统，通过开放一些端口和弱口令，并设定出相应的回应程序，如Telnet密码暴力破解、
添加新用户、权限提升、删除添加文件，可将其设定为易攻破的主机。
2.愿者上钩：巧借VMware逆向分析入侵过程
与“多启动”系统相比，VMware不需要重新开机就能在同一台电脑使用好几个操作系统。
VMware可以将电脑上的一部分硬盘和内存进行组合，每台机器拥有自己独立的CMOS、硬盘
和操作系统，我们可以像使用普通机器一样对它们进行分区、格式化、安装系统和应用软件等
操作，还可以将这几个操作系统联成一个网络，这样，一台电脑就可以轻松虚拟出若干台机器。
在测试过程中，VMware需要一个操作系统作为最基本的平台，即HostOS（主系统），在HostOS
上运行的其他系统都叫GuestOS（子系统或客户系统）
(1）搭建虚拟主机测试环境
新建一个虚拟机后，除了使用默认值，用户还可以通过配置文件修改参数。这个配置文件，
实际上就相当于新电脑的“硬件配置”，用户可以在配置文件中决定虚拟机的硬盘、内存多大，
是否有并口串口、是否有网络等。现在，首先利用VMware虚拟出一个没有安装最新漏洞补丁
的操作系统，然后构建一个具有多个节点的局域网，进行网络安全测试。参考步骤如下。
①安装虚拟操作系统，使用虚拟机软件VMware安装操作系统软件，这里选择版本稍低
的Windows2000操作系统和SP4补丁。
②安装系统补丁程序和杀毒软件：给宿主机系统装上补丁程序，防止宿主机被攻破，并
安装杀毒软件，升级到最新的病毒库，并启动实时监控。
③安装日志服务器。将蜜罐上的应用程序日志、系统日志、安全日志都发送到日志服务
器，可真实地了解到蜜罐的运行情况，从中发现攻击者的蛛丝马迹。例如，在主机上安装日志
服务器，如Kiwi Syslog Daemon 8.3.40(下载地址为http:/www.onlinedown.net/sof/20742.htm),
KiwiSyslogDaemon是一个装在服务器上的应用软件，可以实时显示通过防火墙的所有访问信
息，并可以以文件的形式用日期命名，保存到硬盘，以供查看。软件参考界面如图4.48所示。
ik ee lervic Moger (hrim &3.9)
2 28 . 127.1
ates-Teet ar
图4.48KiwiSyslogDaemon软件的界面
24
---
## Page 224
第4章拒绝恶意代码与神秘的黑客
同时，还可以在虚拟主机上安装日志记录工具，把系统日志发送到日志服务器上，如
evtsys(https://engineering.purdue.edu/ECN/Resources/Documents/UNIX/evtsys)。
④安装cmd记录软件。cmdlog的特点是记录cmd.exe的程序，且不在进程列表中显示
出来，对于实时监控黑客在本机上的攻击行为十分有效。
软件下载地址为htp:/www.yeshack.com/Sof/200409/104.html，解压后，把文件考贝到
C:Windowsisystem32目录下。打开Windows命令提示符，输入以下参考命令：
C:\>evtsy-i-h192.168.1.100.
其中，“i”表示安装成系统服务，h”表示指定log服务器的IP地址。
③安装数据包捕获软件。例如，可以安装SnifferProv4.7.530（htp://down.chinaz.com/
通过捕获并分析虚拟机上流进和流出的网络数据包，可了解攻击者的攻击技术、利用的系统漏
洞和使用的工具等。
这样，通过“三重捕获”的层层防范措施，可以确保在不被入侵者发现和诱骗的前提下，
尽可能多地捕获攻击行为信息，包括入侵者的按键记录、CPU利用率、进程列表、使用过的各
种协议数据包内容等，同时充分保证捕获信息的完整和安全。
此外，还可以分析攻击者所要进行的下一步工作，以及将捕获的数据不放在蜜罐主机上，
防止被攻击者发现面提早退出。
(2）尽在掌控之中：实施监控测试
基本环境及工具配置好后，现在开始进行监控测试。
①开始监测扫描行为。搭建有蜜罐系统的虚拟主机后，连上互联网，通过唤探软件发现
不时有主机对蜜罐进行基于135端口扫描，有时伴随着基于NetBIOS扫描（137、139端口）。这
说明网络中存在大量随机扫描。
②对攻击行为进行抽获。现在，一位来自外网的不速之客开始对密罐进行扫描和攻击。
从分析数据来看，主要是基于135端口的扫描。
接下来攻击者对蜜罐的135端口进行攻击，建立RPC远程连接，并向蜜罐传送带有恶意
代码的数据包，捕获的数据包如图4.49所示。
Sirb data (1l3s-br1es) 
000
图4.49查看捕获的数据包
③漏洞分析。这是针对WindowsRPCDCOM接口进行缓冲区溢出漏洞的攻击，漏洞可
通过135（TCP/UDP)、139、445、593等端口发起攻击、
由于Windows的DCOM实现在处理一个参数时没有检查长度，通过提交一个超长（数百字
节）的文件名参数可导致堆溢出，从而使RpcSS服务崩溃，精心构造提交的数据可在系统上以
本地系统权限运行代码。攻击者可在系统中采取任何行为，包括安装程序，窃取更改或删除数
据，或以完全权限创建新账号。
④攻击者对蜜罐的RPCDCOM接口缓冲区溢出攻击成功后，蜜罐系统执行RPC数据包
215
---
## Page 225
网络安全进阶笔记
中附带的恶意代码，该代码检查本机是否已经被感染或被种下后门程序。经检查本机还没有被
感染，于是该程序就向攻击者请求发送蟠虫病毒程序Winregs32.cxe。随后，攻击者用TFTP协
议向本机传送该端虫病毒。下载完毕后，该螺虫病毒被立即执行，首先向DNS服务器查询IP
地址，接着与该主机建立IRC连接。捕获到的数据如图4.50所示。
.90.73
图4.50分析捕获的数据
小知识：缓冲区溢出，缓冲区溢出是一种非常普遍、非常危险的漏润，在各种操作系统、应用
教件中广泛存在。利用缓冲区溢出攻击，可以导致程序运行失败、系统岩机、重新启动
等后果，更为严重的是，可以利用它执行非授权指令，甚至可以取得系统特权，进而
进行各种非法操作，造成缓冲区溢出的原因是程序中没有仔细检查用户输入的参数，
③入侵行为分析。IRC连接成功后，主机通过IRC向该蟠虫病毒发送一条指令，让密罐
系统建立150个线程扫描某个网络段上的所有主机，寻找存在135端口漏润的主机。之后，蜜
罐主机开始不间断地扫描某个网络段上的所有主机，寻找有135端口漏润的主机，CPU利用率
达到100%，大量地消耗系统资源，到此为止，端虫已完成入侵、感染蜜罐系统，并立即执行，
通过对发送到日志服务器上的日志进行分析，得出该端虫病毒首先将自已拷贝到%system%
Winregs32.exe，注册表的列表项如下：
HKEY_LOCAL_MACHINE\SOPTWARE\Microsoft\Windows\CurrentVersion\Run
HKEY_LOCAL_MACHINE\SOPTWARz\Microsoft\Windows\CurrentVersion\RunServices
HKEY_CURRET_USER\Software\Microsoft\OLE
HKEY_CURRENT_USER\SYSTEN\CurrentControlSet\Control\Laa
添加如下键值：
*MsWindows SysDate*=*Winreg32.exe*
现在，Windows-启动时就会自动运行该病毒程序，然后扫描网络中的其他主机，且利用
TCP端口135的MicrosoftWindowsDCOMRPC接口缓存溢出漏润攻击其他有该漏润的主机并
复制自己，这就是该螺虫病毒具有自动攻击性、自我繁殖的原因，
现在，你可能在思考，《潜伏》中李涯也许是不聪明的，因为余则成巧妙地拖延了李涯对
自己的攻击，面且让其浪费了大量时间，从而保护了自己的安全。作为近年来逐渐兴起的安全
技术，蜜罐技术与《潜伏》等影视剧有着异曲同工之妙，并已成为网络管理员对付黑客和蜗虫
病毒的有效工具之一。
更重要的是，蜜罐技术还可以分析攻击者的攻击技术、攻击技巧、使用的工具等，从而更
加主动、全面地保护了网络的安全。
216
---
## Page 226
第4章拒绝恶意代码与神秘的黑客
4.5小结
仔细思索一下，我们会发现，恶意软件（尤其是计算机病毒）与我们的网络生活有着非常密
切的联系。本章从恶意软件的发展历程、危险木马的潜伏方法与分类、端虫的原理和分类、病
毒的分类和意义等方面进行了基本的概念探索，并对恶意软件的特征和发展趋势进行了一些分
析。本章的重点集中于个人用户和企业用户病毒防范、典型解决方案这两个方面。
声
PDC
212
---
## Page 227
第5章
趣解加密与解密
加密解密技术的使用至少可以追溯到4000年前，从古至今，它都是在敌对环境下，尤其
是战争和外交场合保护通信机密的重要手段。
古人以劈开两半的竹片为“符”，与现代的加解密技术有着异曲同工之妙，如公钥加密技
术使用成对的“公共密钥”和“私有密钥”，双方各执一个，互不相知，但却可以进行非常有
效的加密认证。仔细想想，是不是有不少玄机？
以大家常用而熟悉的电子邮件来说，就存在被偷看、误投和伪造的诸多安全隐患，然而，
网络的安全问题又仅仅局限于电子邮件系统，诸如软件代码保护、文件传输、网页信息加密等，
同样存在此类问题。这就更加要求我们不仅需要保护商业通信中的经济信息，而且还需要保护
个人通信的隐私权。“知己知被，百战不殆”，在了解加密技术的同时，我们还要了解解密方
面的技术，从而达到数据保护的目的。
通过本章的学习，你可以了解：
·简单有趣的加密方法，
通过PGP软件深入了解加密解密的详细如识，
·了解常见的加密算法及其应用。
南
·常用软件的加密与解密实现
---
## Page 228
网络安全进阶笔记
5.1开启加密与解密之门
在保障信息安全各种功能特性的诸多技术中，密码技术是信息安全的核心和关键技术，通
过数据加密技术，可以在一定程度上提高数据传输的安全性，保证传输数据的完整性。一个数
据加密系统包括加密算法、明文、密文以及密钥、密钥控制加密和解密过程，一个加密系统的
全部安全性是基于密钥的，而不是基于算法，所以加密系统的密钥管理是一个非常重要的问题。
5.1.1加密解密技术的趣闻轶事