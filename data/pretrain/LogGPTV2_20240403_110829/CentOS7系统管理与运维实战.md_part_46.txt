际的镜像数据。
或者获取镜像的元数据。这个模块本身不存储大量的数据，需要挂载后台存储Swift来存放实
供接口，处理来自Nova的各种请求。Glance Registry用来和MySQL数据库进行交互，存储
镜像的元数据、将虚拟机镜像从一种格式转换为另外一种格式。
12.2.5
件的元数据组成对象，存储在服务器上。
系统上传文件的时候，文件并不经过压缩或者加密，而是和文件存放的容器名、对象名以及文
Glance主要包括两个组成部分，分别是 Glance API和Glance Registry。Glance API主要提
Keystone是OpenStack中负责身份验证和授权的功能模块。Keystone类似一个服务总线，
Glance项目主要提供虚拟机镜像服务，其功能包括虚拟机镜像、存储和获取关于虚拟机
角色代表一组用户可以访问的资源权限，例如Nova中的虚拟机、Glance 中的镜像。用户
3.角色（Role）
租户是各个服务中的一些可以访问的资源集合。例如，在Nova中一个租户可以是一些机
2.租户（Tenant）
用户代表可以通过Keystone 进行访问的人或程序。用户通过认证信息如密码、API Keys
1.用户（User）
Keystone 包含以下基本概念：
OpenStack中的对象由存储实体和元数据组成，
Swift主要由以下3种服务组成：
（3）身份认证：提供用户身份鉴定认证功能。
（1）代理服务：提供数据定位功能，充当对象存储系统中的元数据服务器的角色，维护
（2）对象存储：作为对象存储设备，实现用户对象数据的存储功能。
身份认证模块Keystone
虚拟机镜像管理模块Glance
，相当于文件的概念。当向 Swif 对象存储
---
## Page 343
的主界面，关于Horzon的详细功能，将在后面的内容中介绍。
了所有的操作功能，包括Nova虚拟机实例的管理和 Swift存储管理等。图12.4显示了Horizon
形界面的方式就可以进行相应的管理任务，避免去记忆烦琐、复杂的命令。Horizon几乎提供
12.2.7
能被局域网访问，admin类型的URL 被从常规的访问中分离。
public、private 和 admin 这三种权限。其中public 类型的端点可以被全局访问，私有URL只
端点模版包含一个URL列表，列表中的每个URL都对应一个服务实例的访问地址，并且具有
因此，在Keystone中包含一个端点模板，这个模板提供了所有存在的服务的端点信息。一个
其租户内的服务时，该用户必须知道这个服务是否存在以及如何访问这个服务，这里通常使用
和角色，一个服务可以确认当前用户是否具有访问其资源的权限。但是当一个用户尝试着访问
一些不同的名称表示不同的服务。
户内执行角色规定的权限。
有的租户，即可以对所有的租户执行角色规定的权限；在租户内的角色中，用户仅能在当前租
可以被添加到任意一个全局的或租户内的角色中。在全局的角色中，用户的角色权限作用于所
Horizon为用户提供了一个管理OpenStack的控制面板，使得用户可以通过浏览器，以图
所谓端点，是指某个服务的URL。如果需要访问一个服务，则必须知道该服务的端点。
5.端点（Endpoint）
OpenStack 中包含许多服务，如 Nova、Glance、Swift。根据前三个概念，即用户、租户
4.服务（Service）
控制台Horizon
管理员
项目
openstack
系统面板
58.64.138.219/dash
主机集病
虚拟机管理器
资源使用情况
主机型
硬盘
选择的一段时间来查询其用量：
使用情况摘要
adrni
用量
活跃的云主机：1活跃的内存：512MB这一时期的的VCPU-小时数：363这一时期的GB小时数：363
从2014-5-01到.2014-0524桂文
概况
显示1个条目
dmsn
项目名称
图12.4 Horizon主界面
虚拟内校
磁盘
512MB
内存
日期采是YYY-mm-格式
第12章配置OpenStack私有云
363
虚拟内核小时数
.63
磁盘GB小时数
下载CSV摘要
三
331
---
## Page 344
的服务，该工具使用 python开发，小巧轻便，使用简单的命令即可完成PXE 网络安装环境的
将对主要的OpenStack部署工具进行介绍。
具已经被开发出来。通过这些工具，用户可以快速地搭建出一个OpenStack 的学习环境。本节
装各个组件是一项非常困难的事情。幸运的是，为了简化OpenStack的安装操作，许多部署工
CentOS7系统管理与运维实战
332
12.3.2
的各个组件。
还支持心跳检查。
来配置，这些配置便于共享。Puppet伸缩性强，可以管理成千上万台机器。
交给 Puppet 去完成，管理员只要集中精力在业务配置上。系统管理员使用Puppet 的描述语言
XML 语言定义配置。Puppet 提供了一个强大的框架，简化了常见的系统管理任务，大量细节
提示
配置，同时还可以管理DHCP，DNS，以及yum包镜像。
OpenStack组件以及图形界面等几个部分，下面分别进行简单介绍。
12.3.1
（OpenStackOver OpenStack）。通过使用OpenStack运行在裸机上的自有设施作为该平台的基
TripleO是另外一套OpenStack 部署工具，TripleO又称为OpenStack 的OpenStack
Fuel是一个端到端一键部署OpenStack 设计的工具，主要包括裸机部署、配置管理、
2
Fuel提供了基于Web的管理界面Fuel Web,可以使用户非常方便地部署和管理OpenStack
3.OpenStack组件
配置管理采用Puppet 实现。Puppet 是一个非常有名的云环境自动化配置管理工具，采用
Fuel支持裸机部署，该项功能由 HP的 Cobbler 提供。Cobbler 是一个快速网络安装Linux
4.图形界面
1.裸机部署
前面已经介绍过，OpenStack的体系架构比较复杂，对于初学者来说，逐个使用命令来安
除了可灵活选择安装OpenStack 核心组件以外，还可以安装Monitoring和HA 组件。Fuel
2.配置管理
packstack不包括此功能。
Fuel
TripleO
Openstack主要部署工具
---
## Page 345
如下：
名设置为完整的域名，来代替短主机名（注意如果不使用自建的DNS服务器，同时也要修改
ScientificLinux6.5或者Fedora 20以上。为了避免Packstack域名解析出现问题，需要把主机
12.4.1
难度。本节将对使用 RDO 部署OpenStack 进行详细介绍。
OpenStack，RDO仍然是首选的方案。尤其对于初学者来说，使用RDO可以大大降低部署的
12.4
境。正如DevStack官方所强调的，devstack不适合用在生产环境。
12.3.4DevStack
OpenStack的安装。
想在REHL上面部署OpenStack，最便捷的方式就是RDO。在本书中，就是采用RDO来介绍
个基于Puppet的部署工具，可以很快地通过 RDO部署一套复杂的OpenStack 环境。如果用户
12.3.3
OpenStack的Ironic功能再去部署裸机，再通过HEAT在裸机上部署OpenStack。
础，这个项目可以实现OpenStack的安装、升级和操作流程的自动化。
12.4.2
有一块网卡。
/etc/hosts)。
也可以选择其他的基于RHEL的发行版，例如CentOS6.5及之后的版本（包括CentOS7）、
硬件方面，OpenStack至少需要2GB 的内存，CPU也需要支持硬件虚拟化，此外，至少
DevStack 实际上是个 Shell 脚本，可以用来快速搭建OpenStack 的运行和开发环境，特
RDO（RedHatDistributionof OpenStack）是由红帽公司推出的部署OpenStack集群的-
为了保证当前系统的所有的软件包都是最新的，需要使用 yum命令进行更新操作，命令
OpenStack对于软硬件环境都有一定的要求，其中RHEL是官方推荐的版本，另外，用户
在使用TripleO的时候，需要先准备一个OpenStack控制器的镜像，然后用这个镜像通过
尽管OpenStack已经拥有了许多部署工具，但是在RHEL或者CentOS 等操作系统上部署
部署前的准备
配置安装源
RDO
通过RDO部署OpenStack
第12章配置OpenStack私有云
333
---
## Page 346
选择控制器加多个计算节点的方式或者是其他的部署方式。为了简化操作，本节将选择单节点
12.4.4
Packstack的安装命令如下：
安装 Packstack 软件包。Packstack 的底层也是基于Puppet,通过 Puppet部署OpenStack 各组件。
12.4.3安装Packstack
提示
http://rdo.fedorapeople.org/openstack-icehouse/rdo-release-icehouse.rpm
RPM软件包来帮助用户设置RDO安装源，其URL为：
更新操作可能会花费较长的时间。
有更新；如果存在更新，则会自动进行安装。由于系统中的软件包通常会非常多，所以上面的
#
CentOs7系统管理与运维实战
334
用户可以通过以下命令来查看这些选项及其含义：
部署方式。
简单。单节点部署方式中，OpenStack所有的组件都被安装在同一台服务器上面。用户还可以
[root@localhost ~]# yum-y install openstack-packstack
Packstack提供了一个名称为packstack的命令来执行部署操作。该命令支持非常多的选项，
Packstack提供了多种方式来部署OpenStack，包括单节点和多节点等，其中单节点部署最
在使用 RDO 安装 OpenStack 过程中，
接下来是配置OpenStack 安装源，目前 RDO的最新版本为IceHouse，RedH 提供了一个
执行以上命令之后，会为当前系统添加 Foreman、Puppet Labs 和 RDO安装源，命令如下：
[root@localhost -]# yum install -y
执行以上命令之后，yum软件包管理器会查询安装源，以验证当前系统中的软件包是否
-rw-r--r--.l
puppetlabs.repo
-rw-r--r--.
-rw-r--r--.
total 32
[root@localhost ~]# ll /etc/yum.repos.d/
用户只要安装以上软件包即可，命令如下：
导致安装完成后无法访问。
在正式开始安装之前，还需要妥善处理SELinux和防火墙等，以免安装过程中出现问题或
安装OpenStack
1
root
root
root
root
，需要Packstack 来部署OpenStack，所以，必须提前
248
707
1220
May2414:38
May2414:38
May2414:38
rdo-release.repo
foreman.repo
---
## Page 347
点，其余的部署为计算节点。如果只提供了一台主机，则所有的组件都将被部署在该主机上面。
packstack部署OpenStack所需的各种选项。
非常灵活，几乎为所有的OpenStack都提供了相应的选项。下面对常用的选项进行介绍。
选项、Swift 选项、Heat 选项、Ceilometer 选项以及 Nagios 选项等。可以看出 packstack 命令
AMQP选项、Keystone选项、Glance选项、Cinder选项、Nova选项、Neutron选项、Horizon
[root@localhost -]# packstack --help
该选项的值为y或者 n，
该选项的值为y或者n，用来指定是否安装Cinder 组件。
5.--os-mysql-install
该选项用来执行单节点部署。
4.--allinone
该选项用来指定一批主机，主机之间用逗号隔开。列表中的第1台主机将被部署为控制节
3.--install-hosts
该选项用来指定一个已经存在的应答文件，packstack命令将从该文件中读取各选项的值。
2.--answer-file
该选项用来创建一个应答文件（answer file），应答文件是一个普通的纯文本文件，包含了
1.--gen-answer-file
从大的方面来说，packstack命令的选项主要分为全局选项、vCenter选项、MySQL选项、
11.--os-swift-install
该选项的值为y或者n，用来指定是否安装Horizon组件。
10.--os-horizon-install
该选项的值为y或者n，用来指定是否安装Neutron 组件。
9.--os-neutron-install
该选项的值为y或者n，
8.--os-nova-install
7.--os-cinder-install
该选项的值为y或者n，
6.--os-glance-install
该选项的值为y或者n，用来指定是否安装MySQL服务器。
用来指定是否安装Swift 组件。
用来指定是否安装Nova组件。
，用来指定是否安装Glance组件。
第12章配置OpenStack私有云
335
---
## Page 348
[root0localhost]#packstackallinone--os-neutron-install=y
CentOs7系统管理与运维实战
336
Iroot@localhost1#packstack--answer-file openstack.txt
相应的安装选项。修改完成之后，使用以下命令进行安装部署：
如下所示：
[root@localhost]# packstack-gen-answer-file openstack.txt
个应答文件（Answer file）中。用户可以通过--gen-answer-file选项来创建应答文件，如下所示：
采用Neutron：
[rootθlocalhost]#packstack-allinone
用户可以根据自已的需要来修改生成的应答文件，以确定某个组件是否需要安装，以及
CONFIG GLANCE INSTALL-
# password and this key will be installed so the password will not be
#Path to a Public key to install on servers. If a usable key has not
应答文件为一个普通的纯文本文件，包含了packstack 部署OpenStack所需的各种选项，
由于 packstack 的选项非常多，为了便于使用，packstack 命令还支持将选项及其值写入-
如果想要单独指定其中的某个选项，例如下面的命令将采用单节点部署，并且虚拟网络
如果没有设置 SSH密钥，在部署之前，packstack会询问参与部署的各主机的root用户的
#Storage
#Set to
如果用户想在一个节点上面快速部署OpenStack，可以使用--allinone选项，命令如下：
除了以上选项之外，对于每个具体的组件，packstack 也提供了许多选项，不再详细介绍。
(root@l
该组件的值为y或者n，用来指定是否安装Ceilometer组件。
12.--os-ceilometer-install
again
bo
if you would like Packstack to install MySQL
cat
opens
a
---
## Page 349
/var/tmp/packstack/20140524-153355-0Imeuf/openstack-setup.1og
directory.
58.64.138.219.To use the
unsynchronized time on server instances might be problem for some
提示
密码，用户输入相应的密码即可。下面的代码是部分安装过程：
password : bcb0bc9462fd4b1b
components.
* Time synchronization installation was skipped. Please note that
Additional information:
File /root/keystonerc
Finalizing
Adding Glance
Adding Keystone manifest entries
Adding
Adding MysQL manifest entries
Setting up ssh keys
PI:EMAIL's password:
Clean Up
Installing:
[root@localhost]#packstack
*The installation log file is available at:
当出现以下信息时，表示安装完成：
执行以上命令重新安装部署。
相关，一般为20~50分钟。如果在安装的过程中，由于网络原因导致安装失败，可以再次
整个安装过程需要花费较长的时间，与用户选择的组件、网络和主机的硬件配置情况密切
AMQP manifest entries
manifest entries
completed
details
update
admin has been created on OpenStack client host
successfully
entries
the host 58.64.138:219 requires
-ansy
第12章配置OpenStack私有云
DONE
DONE
DONE
DONE
DONE
DONE
DONE
reboot
OpenStack
337
---
## Page 350
dashboard，例如，在本例中，主机的IP地址为58.64.138.219，所以其默认的控制台网址为：
的各项功能，对于初学者来说，是一个便捷的途径。本节主要介绍通过控制台管理OpenStack。
选项，对于初学者来说，其难度非常大。通过Horizon控制台，则可以非常方便地管理OpenStack
keystonerc_admin文件里面；用户可以通过http://58.64.138.219/nagios来访问Nagios，并给出
http://58.64.138.219/dashboard来访问Dashboard，即控制台，登录信息存储在用户主目录中的
OpenStack，则应该首先使用source命令读取并且执行其中的命令；用户可以通过
脚本文件/root/keystonerc_admin已经被创建了，如果用户需要使用命令行工具来配置
CentOS7系统管理与运维实战
338
12.5.1
12.5
此处不再赘述。
需手动将其安装好并设置其访问权限继续安装即可。具体细节可参考mariaDB相关文档了解，
了用户名和密码。此外还有一些安装日志文件的位置信息。
信息包括提醒用户当前主机上面没有安装NTP服务，因此，时间同步的相关配置被跳过去了；
/var/tmp/packstack/20140524-153355-0Imeuf/manifests
http://58.64.138.219/dashboard