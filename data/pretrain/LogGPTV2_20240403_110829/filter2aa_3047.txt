2/25/2007  Slide 1
Offensive Computing
Malware Secrets
Valsmith (PI:EMAIL)
Delchi (PI:EMAIL)
2/25/2007  Slide 2
Offensive Computing – Malware Secrets
Valsmith
BACKGROUND:
Malware analyst 
Penetration tester
Exploit developer
Reverse Engineer
AFFILIATIONS:
OffensiveComputing
Metasploit
cDc/NSF
2/25/2007  Slide 3
Offensive Computing – Malware Secrets
Delchi
BACKGROUND:
Incident Response 
Intrusion Detection
Data Mining / Log Correlation
AFFILIATIONS:
OffensiveComputing
cDc/NSF
2/25/2007  Slide 4
Offensive Computing – Malware Secrets
What is this?
• Offensive Computing
• What we do
• Database
• Findings
• Packers
• AV statistics
• URLs
• Other Interesting Data
• Future
• Questions
2/25/2007  Slide 5
Offensive Computing – Malware Secrets
Offensive Computing
• Malware Blog
• Posts from OC members and community
• Interesting malware discussions
• Rustok
• Dolphin Stadium trojan
• Symantec Worm / Big Yellow
• Sample Collection
• 140,054 samples and growing
• Available for download
• Auto-Analysis
• Uploaded samples baseline analyzed
2/25/2007  Slide 6
Offensive Computing – Malware Secrets
Database
• Database of associated malware information
• Searchable web interface
• File typing
• Multiple Checksums (md5,sha1,sha256)
• Packer detection (modified msfpescan)
• Multiple Anti-Virus scan 
• Bitdefender 
Kaspersky
• Antivir 
Avast
• Clamav 
AVG
• F-Prot 
F-Secure
• McAfee 
More coming
2/25/2007  Slide 7
Offensive Computing – Malware Secrets
Database
• PE Info
• Based on PEFile project from 
Ero Carrera with contributions by 
Danny Quist, OC
• Binary archive
• Strings
• File size
• Auto-unpacking coming soon! (see our 
other talk)
2/25/2007  Slide 8
Offensive Computing – Malware Secrets
Findings
• Ok so we have all this malware, now what?
• Time to mine the data
• What might be interesting?
• Packer statistics
• Common strings
• URL’s (call back, command and control, 
droppers)
• E-mail addresses
• IP addresses
2/25/2007  Slide 9
Offensive Computing – Malware Secrets
How these statistics were gathered
• Files collected via 
• Raw submissions to OC via web
• Honeypots
• Spam attachments
• Any file could have been uploaded
• Including benign files, system files, etc.
• Files were NOT manually verified to be malware
• Still useful test, AVs scan non-malware 
• Most current AV signatures used
• Linux based AV scanners only
2/25/2007  Slide 10
Offensive Computing – Malware Secrets
• Results of auto-analysis saved in database and 
text files
• Analysis data mined with PERL / shell scripts
• Tool called pizda developed by Delchi to data 
mine results
• Results could be somewhat “fuzzy”
• Many genetically similar samples exist in 
sample set 
• Different md5sum / same basic functionality
How these statistics were gathered
2/25/2007  Slide 11
Offensive Computing – Malware Secrets
Packers
• Out of 31996 samples 37.9% had detected 
packers
• Our packer detection also tries to detect 
compiler
• Top five detected packers:
• UPX
• PECOMPACT
• ASPACK
• FSG
• PE PACK
2/25/2007  Slide 12
Offensive Computing – Malware Secrets
Packers
• Compilers detected in order:
• Microsoft Visual C++
• Microsoft Visual Basic 
• Borland Delphi
• What’s statistically significant?
• Most used packers
• But also least used packers
2/25/2007  Slide 13
Offensive Computing – Malware Secrets
Packers  
Packer Distribution Over 100 Files
upx , 3294, 26%
Microsoft Visual C++ , 1946, 
15%
Microsoft Visual Basic , 1327, 
10%
pecompact , 1129, 9%
Borland Delphi , 988, 8%
aspack , 762, 6%
fsg , 750, 6%
PE Pack , 505, 4%
ste@lth PE , 498, 4%
MEW , 426, 3%
neolite , 379, 3%
InstallShield 2000 , 191, 1%
petite , 148, 1%
LCC Win32 , 114, 1%
PEX , 111, 1%
Krypton , 108, 1%
themida , 100, 1%
More than 
100 files 
detected 
with packer 
listed
2/25/2007  Slide 14
Offensive Computing – Malware Secrets
Packers
Packer Distribution Over 10 Files
video-lan client , 96, 13%
Obsidium , 80, 11%
telock , 79, 10%
yodas protector , 77, 10%
EXE Stealth , 68, 9%
yodas crypter , 55, 7%
PE Diminisher , 49, 6%
asprotect , 32, 4%
EZIP , 29, 4%
PC-Guard , 23, 3%
PC Shrinker, 23, 3%
xtreme-protector , 21, 3%
GCC-Win32 , 20, 3%
tasm/masm , 19, 3%
wwpack32 , 16, 2%
winzip 32-bit sfx module , 16, 
2%
Install Stub 32 , 16, 2%
PE Crypt , 15, 2%
CExe , 12, 2%
peninja , 10, 1%
More than 
10 files but 
less than 
100 
detected 
with packer 
listed
2/25/2007  Slide 15
Offensive Computing – Malware Secrets
Packers
Packer Distribution Under 10 Files
pklite , 9, 10%
PKLITE32 , 9, 10%
peshield , 9, 10%
Cygw in32 , 9, 10%
Nullsoft Install System , 8, 9%
Blade Joiner , 7, 8%
w inrar sfx module , 6, 6%
EXE Shield , 6, 6%
w ise installer stub , 5, 5%
AHTeam EP Protector , 4, 4%
virogen crypt , 3, 3%
Pow erBasic/CC , 3, 3%
PESpin , 3, 3%
Crypto-Lock , 3, 3%
stones PE Encryptor , 2, 2%
PEnguinCrypt , 2, 2%
North Star PE Shrinker , 2, 2%
SoftDefender , 1, 1%
Private EXE , 1, 1%
CodeSafe , 1, 1%
Less than 
10 files 
detected 
with packer 
listed
2/25/2007  Slide 16
Offensive Computing – Malware Secrets
Anti-virus
Detection statistics
Don’t base purchasing decisions on these figures!
Rough / inaccurate numbers!
Out of 31996 samples tested, each AV detected:
BitDefender 29127 
91.0% 
AVG 
28095 
87.8%
F-Secure 
27972 
87.4%
Kaspersky 
27979 
87.4%
Avast 
27777 
86.8%
McAfee 
27061 
84.5%
Antivir 
26388 
82.4%
ClamAV 
24496 
76.5%
F-Prot 
24048 
75.1%
2/25/2007  Slide 17
Offensive Computing – Malware Secrets
Anti-virus
Detection statistics
• 446 files not detected by any AV (could be non-malware)
• The few of these manually tested were malicious
• Out of 31996 samples tested, each AV failed to detect:
• Range of 5079 between worst and best
Antivir 
5608 
17.5%
Avast 
4219 
13.1%
AVG 
3901 
12.1%
BitDefender 2869 
8.0%
ClamAV 
7500 
23.4%
F-Prot 
7948 
24.8%
F-Secure 
4024 
12.5%
Kaspersky 
4017 
12.5%
McAfee 
4935 
15.4%
2/25/2007  Slide 18
Offensive Computing – Malware Secrets
Anti-virus
2/25/2007  Slide 19
Offensive Computing – Malware Secrets
Anti-virus
2/25/2007  Slide 20
What else can we find
• Collecting the strings from each binary
– Packed bins still often have info
• Strings give us clues into malware trends
• Financial related strings growing
• E-mail addrs, URLS, IP’s etc. useful for 
finding call home connections
• Trends?
2/25/2007  Slide 21
URLS
• Parsing the malware strings yields 
interesting results
• 123 Russian URLS
– http://catalog.zelnet.ru/
– http://binn.ru/
– http://www.aktor.ru/
– http://av2026.comex.ru/
– http://www.free-time.ru/
– http://momentum.ru/
– http://www.elemental.ru/
– http://mir-vesov.ru/p/lang/CVS/
– http://www.scli.ru/
– http://sacred.ru/
– http://pocono.ru/
2/25/2007  Slide 22
URLS
• URLs with the word “hack”:
– Http://www.Geocities.com/Hack_A_Freind_inc/
– http://1337suxx0r.ath.cx:580/hack/sneaker/
– http://www.hack-info.de/
– http://www.hacknix.com/~rnsys/
– http://hackzzz.narod.ru/
– http://www.micro-hack.com/
– http://www.outergroup.com/hacktack/
– http://www.hack-gegen-rechts.com/
– http://www.immortal-hackers.com/
– http://data.forumhoster.com/forum_hackersnet/
– http://www.shadowhackers.de.vu/
• (These are the SMART hackers :)
2/25/2007  Slide 23
URLS
• Government sites referenced:
– HTTP://WWW.CAIXA.GOV.BR/
– http://camaramafra.sc.gov.br/1/
– http://www.receita.fazenda.gov.br/
– http://www.lfxmsc.gov.cn/
– http://hbh.gov.cn/inc/
– http://hbh.gov.cn/gg/
– http://shadowvx.gov/benny/viruses/
2/25/2007  Slide 24
URLS
• 39 IP addresses (call back / C&C?)
• 7 Chinese sites
• 3 Israeli sites
• 23 Brazilian (banker trojans?)
• 98 German urls
• 4 Romanian
• 9 Japanese
• vx.netlux.org/ shows up quite a bit
2/25/2007  Slide 25
E-Mail addresses
• Only 67 total emails extracted
• 2 Russian Emails show up repeatedly
– PI:EMAIL
– PI:EMAIL
• Xfocus guys probably from ripped exploit code
– PI:EMAIL
– PI:EMAIL
2/25/2007  Slide 26
Interesting Strings
• Lots of useful words found in malware
• The word “BANK” shows up x times
• “CREDIT” shows up x times
• “SOCIAL SECURITY” / “SSN” show up x times
• Owned x times
• Hack x times
• Deface x times
2/25/2007  Slide 27
Interesting Strings
• $remote_addr="http://127.0.0.1/~ 
snagnever/defacement/paginanov 
a/";//url
2/25/2007  Slide 28
Interesting Strings
• Yo momma so old her social 
security number is 1!
2/25/2007  Slide 29
Interesting Strings
• CCALG - Credit Card Generator.exe
2/25/2007  Slide 30
Interesting Strings
• Enter credit card number here to 
verify
2/25/2007  Slide 31
Interesting Strings
• [TFTP]: I just owned: %s (%s).
2/25/2007  Slide 32
Interesting Strings
• C:\[Rx- 
oWneD]_[Coded_NAPSTER_For 
_0lab-Team]\[Rx-oWneD] [Coded 
NAPSTER For 0lab- 
Team]\Debug\rBot.pdb
2/25/2007  Slide 33
Interesting Strings
• HI HackeR, HenKy LiveS HerEf
2/25/2007  Slide 34
Interesting Strings
• Only a Joke!!!!!! JOKE The Web 
station has been HACKED Ha Ha 
Ha!!.
2/25/2007  Slide 35
Interesting Strings
• Citibank Australia
• Wachovia Online Business 
Banking
• Unibanco
• Bank of America
2/25/2007  Slide 36
Conclusion
• Large collection of malware provides data 
mining opportunity
• Not best way to test AV but interesting 
results
• Why don’t malware authors use tougher 
packers more often?
• Financial attacks prevalent (we already 
knew that)
2/25/2007  Slide 37
Questions ?
• Thanks to krbkelpto, Danny Quist, 
Metasploit, #vax and the rest of OCDEV 
team! 
• Thank you!