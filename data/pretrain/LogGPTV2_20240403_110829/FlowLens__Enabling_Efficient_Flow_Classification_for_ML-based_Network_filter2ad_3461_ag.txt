of packets of each ﬂow [17, 56, 23]. Examples of general
monitoring systems implementing sampling are OpenSam-
ple [77] or Planck [65]. Canini et al. [17] introduced a per-ﬂow
measurement technique that holds on the partial sampling of
ﬂows. However, the accuracy of sampling techniques is usually
reduced when one aims at obtaining a faithful representation of
a ﬂow’s distribution [39]. Moreover, increasing the sample rate
is at odds with a larger memory footprint which can impact
the overall performance of the network [30].
Probabilistic data structures known as sketches enable
the error-bounded representation of ﬂows’ statistics within
restrictive memory limits [88]. While multiple sketches allow
for the extraction of ﬂow’s coarse-grained features [21, 86, 39,
14
43, 31, 85, 32], their strive for generality prevents recording
ﬁne-grained information such as approximations of ﬂows’
packet lengths and timing distributions. NetWarden [82] uses
sketches to record approximate distributions of inter-packet
timing distributions for a speciﬁc security task. In contrast,
FlowLens can be broadly applicable to a range of ML-based
applications. Coskun et al. [22] and Nasr et al. [55] explore
additional ways to compress packet distributions based on the
use of linear projections. Unfortunately, such techniques cannot
be implemented efﬁciently in current switching hardware.
Recent systems relying on network query reﬁnement [54],
such as Turboﬂow [73] and *Flow [74], allow the data plane
to ofﬂoad simple packet features to servers for aggregation
and processing. However, differently from FlowLens, such a
strategy may increase the risks of network congestion and
introduce scalability bottlenecks in large networks [41, 87].
X. CONCLUSIONS
This work proposed FlowLens, the ﬁrst trafﬁc analysis
system for ML-based security applications that collects and
analyses compact representations of ﬂows’ packet distributions
– ﬂow markers – within programmable switches. We evaluated
our system for three use cases comprising the detection of
network covert channels, website ﬁngerprinting, and botnet
chatter detection. FlowLens can accurately predict these classes
of trafﬁc ﬂows with the help of compact ﬂow markers, allowing
for a reduction between one to two orders of magnitude of the
memory footprint to represent packet distributions.
ACKNOWLEDGMENTS
We thank the anonymous reviewers for their insight-
ful comments. This work was partially supported by na-
tional funds through Fundac¸˜ao para a Ciˆencia e a Tec-
nologia (FCT) via the SFRH/BD/136967/2018 grant, and
the PTDC/EEI-COM/29271/2017, UIDB/50021/2020, and
PTDC/CCI-INF/30340/2017 (uPVN) projects.
REFERENCES
[1] J. Aiken and S. Scott-Hayward, “Investigating adversarial
attacks against network intrusion detection systems in
sdns,” in Proceedings of the Conference on Network
Function Virtualization and Software Deﬁned Networks
(NFV-SDN), Dallas, TX, USA, November 2019, pp. 1–7.
[2] B. Anderson and D. McGrew, “Identifying encrypted
malware trafﬁc with contextual ﬂow data,” in Proceedings
of the 2016 ACM workshop on artiﬁcial intelligence and
security, Vienna, Austria, October 2016, pp. 35–46.
[3] G. Apruzzese, M. Colajanni, L. Ferretti, and M. Marchetti,
“Addressing adversarial attacks against security systems
based on machine learning,” in 2019 11th International
Conference on Cyber Conﬂict, vol. 900, Tallinn, Estonia,
May 2019, pp. 1–18.
[4] Barefoot Networks, Toﬁno Switch
https://www.barefootnetworks.com/products/brief-toﬁno/,
accessed: 2021-01-05.
[5] ——, P4 Studio,
https://www.barefootnetworks.com/products/brief-p4-
studio/, accessed:
2021-01-05.
[6] D. Barradas, N. Santos, and L. Rodrigues, “Deltashaper:
Enabling unobservable censorship-resistant TCP
tunneling over videoconferencing streams,” in
Proceedings on Privacy Enhancing Technologies,
Minneapolis, MN, USA, July 2017, pp. 5–22.
[7] ——, “Effective detection of multimedia protocol
tunneling using machine learning,” in Proceedings of the
27th USENIX Security Symposium, Baltimore, MD, USA,
August 2018, pp. 169–185.
[8] D. Barradas and S. Signorello, “FlowLens code
repository,” https://github.com/dmbb/FlowLens, 2020,
accessed: 2021-01-05.
[9] J. Bergstra, R. Bardenet, Y. Bengio, and B. K´egl,
“Algorithms for hyper-parameter optimization,” Advances
in Neural Information Processing Systems, pp.
2546–2554, 2011.
[10] J. Bergstra, D. Yamins, and D. Cox, “Making a science
of model search: Hyperparameter optimization in
hundreds of dimensions for vision architectures,” in
Proceedings of the 30th International Conference on
Machine Learning, Atlanta, GA, USA, June 2013, pp.
115–123.
[11] B. Biggio, G. Fumera, and F. Roli, “Multiple classiﬁer
systems for robust classiﬁer design in adversarial
environments,” International Journal of Machine
Learning and Cybernetics, vol. 1, no. 1-4, pp. 27–41,
2010.
[12] P. Bosshart, D. Daly, G. Gibb, M. Izzard, N. McKeown,
J. Rexford, C. Schlesinger, D. Talayco, A. Vahdat,
G. Varghese, and D. Walker, “P4: Programming
protocol-independent packet processors,” ACM
SIGCOMM Computer Communication Review, vol. 44,
no. 3, pp. 87–95, July 2014.
[13] P. Bosshart, G. Gibb, H.-S. Kim, G. Varghese,
N. McKeown, M. Izzard, F. Mujica, and M. Horowitz,
“Forwarding metamorphosis: Fast programmable
match-action processing in hardware for sdn,” ACM
SIGCOMM Computer Communication Review, vol. 43,
no. 4, pp. 99–110, 2013.
S. Vargaftik, A. Berger, G. Mendelson, M. Alizadeh,
S.-T. Chuang, I. Keslassy, A. Orda, and T. Edsall, “drmt:
Disaggregated programmable switching,” in Proceedings
of the Conference of the ACM Special Interest Group on
Data Communication, Los Angeles, CA, USA, August
2017, pp. 1–14.
[20] Cisco, Cisco Encrypted Trafﬁc Analytics Whitepaper,
https://www.cisco.com/c/dam/en/us/solutions/collateral/enterprise-
networks/enterprise-network-security/nb-09-encrytd-traf-
anlytcs-wp-cte-en.pdf, accessed:
2021-01-05.
[21] G. Cormode and S. Muthukrishnan, “What’s new:
Finding signiﬁcant differences in network data streams,”
IEEE/ACM Transactions on Networking, vol. 13, no. 6,
pp. 1219–1232, 2005.
[22] B. Coskun and N. Memon, “Online sketching of network
ﬂows for real-time stepping-stone detection,” in
Proceedings of the IEEE Annual Computer Security
Applications Conference, Honolulu, HI, USA, December
2009, pp. 473–483.
[23] N. Dufﬁeld, C. Lund, and M. Thorup, “Estimating ﬂow
distributions from sampled ﬂow statistics,” in
Proceedings of the SIGCOMM Conference on
Applications, Technologies, Architectures, and Protocols
for Computer Communications, 2003, pp. 325–336.
[24] P. I. Frazier, “A tutorial on bayesian optimization,” arXiv
preprint arXiv:1807.02811, 2018.
[25] K. Grosse, P. Manoharan, N. Papernot, M. Backes, and
P. McDaniel, “On the (statistical) detection of adversarial
examples,” arXiv preprint arXiv:1702.06280, 2017.
[26] J. Gu, J. Wang, Z. Yu, and K. Shen, “Walls have ears:
Trafﬁc-based side-channel attack in video streaming,” in
Proceedings of the IEEE Conference on Computer
Communications, Honolulu, HI, USA, April 2018, pp.
1538–1546.
[27] R. Habeeb, F. Nasaruddin, A. Gani, I. Hashem,
E. Ahmed, and M. Imran, “Real-time big data processing
for anomaly detection: A survey,” International Journal
of Information Management, vol. 45, pp. 289–307, 2019.
[14] Broadcom, Tomahawk II 6.4Tbps Ethernet Switch,
[28] M. Hall, E. Frank, G. Holmes, B. Pfahringer,
https://www.broadcom.com/news/product-
releases/broadcom-ﬁrst-to-deliver-64-ports-of-100ge-
with-tomahawk-ii-ethernet-switch, accessed:
2021-01-05.
[15] S. Calzavara, C. Lucchese, and G. Tolomei, “Adversarial
training of gradient-boosted decision trees,” in
Proceedings of the 28th ACM International Conference
on Information and Knowledge Management, Beijing,
China, November 2019, pp. 2429–2432.
P. Reutemann, and I. Witten, “The weka data mining
software: an update,” ACM SIGKDD explorations
newsletter, vol. 11, no. 1, pp. 10–18, 2009.
[29] D. Herrmann, R. Wendolsky, and H. Federrath, “Website
ﬁngerprinting: Attacking popular privacy enhancing
technologies with the multinomial na¨ıve-bayes classiﬁer,”
in Proceedings of the ACM Workshop on Cloud
Computing Security, Chicago, IL, USA, November 2009,
pp. 31–42.
[16] S. Calzavara, C. Lucchese, G. Tolomei, S. Abebe, and
[30] Q. Huang, X. Jin, P. Lee, R. Li, L. Tang, Y.-C. Chen, and
S. Orlando, “Treant: training evasion-aware decision
trees,” Data Mining and Knowledge Discovery, pp. 1–31,
2020.
[17] M. Canini, D. Fay, D. Miller, A. Moore, and R. Bolla,
“Per ﬂow packet sampling for high-speed network
monitoring,” in Proceedings of the First IEEE
International Communication Systems and Networks and
Workshops, Chennai, India, December 2009, pp. 1–10.
[18] C. Cascaval and D. Daly, P4 Architectures,
https://p4.org/assets/p4-ws-2017-p4-architectures.pdf,
accessed: 2021-01-05.
[19] S. Chole, A. Fingerhut, S. Ma, A. Sivaraman,
G. Zhang, “Sketchvisor: Robust network measurement
for software packet processing,” in Proceedings of the
Conference of the ACM Special Interest Group on Data
Communication, August 2017, pp. 113–126.
[31] Q. Huang, P. Lee, and Y. Bao, “Sketchlearn: relieving
user burdens in approximate measurement with
automated statistical inference,” in Proceedings of the
Conference of the ACM Special Interest Group on Data
Communication, Budapest, Hungary, August 2018, pp.
576–590.
[32] N. Ivkin, Z. Yu, V. Braverman, and X. Jin, “Qpipe:
Quantiles sketch fully in the data plane,” in Proceedings
15
[39] Y. Li, R. Miao, C. Kim, and M. Yu, “Flowradar: A
[52] M. Moshref, M. Yu, R. Govindan, and A. Vahdat,
of the 26th Network and Distributed System Security
Symposium, San Diego, CA, USA, February 2019.
[46] M. Malboubi, L. Wang, C.-N. Chuah, and P. Sharma,
“Intelligent sdn based trafﬁc (de) aggregation and
measurement paradigm (istamp),” in Proceedings of the
IEEE Conference on Computer Communications,
Toronto, Canada, April 2014, pp. 934–942.
[47] R. McPherson, A. Houmansadr, and V. Shmatikov,
“CovertCast: Using live streaming to evade internet
censorship,” Proceedings on Privacy Enhancing
Technologies, vol. 2016(3), pp. 212–225, 2016.
[48] Y. Meidan, M. Bohadana, Y. Mathov, Y. Mirsky,
A. Shabtai, D. Breitenbacher, and Y. Elovici,
“N-baiot—network-based detection of iot botnet attacks
using deep autoencoders,” IEEE Pervasive Computing,
vol. 17, no. 3, pp. 12–22, 2018.
[49] R. Meier, P. Tsankov, V. Lenders, L. Vanbever, and
M. Vechev, “Nethide: Secure and practical network
topology obfuscation,” in Proceedings of the 27th
USENIX Security Symposium, Baltimore, MD, USA,
August 2018, pp. 693–709.
[50] D. Meng and H. Chen, “Magnet: a two-pronged defense
against adversarial examples,” in Proceedings of the ACM
SIGSAC conference on computer and communications
security, Dallas, TX, USA, October 2017, pp. 135–147.
[51] R. Miao, H. Zeng, C. Kim, J. Lee, and M. Yu, “Silkroad:
Making stateful layer-4 load balancing fast and cheap
using switching asics,” in Proceedings of the Conference
of the ACM Special Interest Group on Data
Communication, Los Angeles, CA, USA, August 2017,
pp. 15–28.
“Dream: dynamic resource allocation for software-deﬁned
measurement,” ACM SIGCOMM Computer
Communication Review, vol. 44, no. 4, pp. 419–430,
2015.
[53] P. Narang, S. Ray, C. Hota, and V. Venkatakrishnan,
“Peershark: detecting peer-to-peer botnets by tracking
conversations,” in Proceedings of the IEEE Security and
Privacy Workshops, San Jose, CA, USA, May 2014, pp.
108–115.
[54] S. Narayana, A. Sivaraman, V. Nathan, P. Goyal,
V. Arun, M. Alizadeh, V. Jeyakumar, and C. Kim,
“Language-directed hardware design for network
performance monitoring,” in Proceedings of the
Conference of the ACM Special Interest Group on Data
Communication, Los Angeles, CA, USA, August 2017,
pp. 85–98.
[55] M. Nasr, A. Houmansadr, and A. Mazumdar,
“Compressive trafﬁc analysis: A new paradigm for
scalable trafﬁc analysis,” in Proceedings of the ACM
SIGSAC Conference on Computer and Communications
Security, Dallas, TX, USA, October 2017, pp.
2053–2069.
[56] Netﬂow, https://www.ietf.org/rfc/rfc3954.txt, accessed:
2021-01-05.
[57] P. Ngatchou, A. Zarei, and A. El-Sharkawi, “Pareto multi
objective optimization,” in Proceedings of the 13th
International Conference on, Intelligent Systems