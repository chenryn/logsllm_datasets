CentOS7å®‰è£…é…ç½®vsftpæ­å»ºFTP
===
å®‰è£…é…ç½®vsftpdåšFTPæœåŠ¡ï¼Œæˆ‘ä»¬çš„é¡¹ç›®åº”ç”¨ä½¿ç”¨gitç®¡ç†è¿›è¡Œè¿­ä»£ï¼Œå…¬å…±æ–‡ä»¶è½¯ä»¶å­˜å‚¨ä½¿ç”¨å¼€æºç½‘ç›˜Seafileæ¥ç®¡ç†ï¼ŒåŸºæœ¬å¤Ÿç”¨ã€‚æƒ³ä¸åˆ°FTPçš„ä½¿ç”¨çš„åœºæ™¯ï¼Œæ„Ÿè§‰å®ƒå¥½åƒè€å»äº†ï¼Œè™½ç„¶ç°åœ¨åŸºæœ¬æ²¡æœ‰ç”¨åˆ°è¿™ä¸ªå·¥å…·ï¼Œåˆšå¥½å…¬å¸å…¬å¸åˆ·ä¸€ä¸ªç¡¬ä»¶éœ€è¦ä½¿ç”¨FTPæ¥é…ç½®ä¸‹è½½æ–‡ä»¶ï¼Œäºæ˜¯ç ”ç©¶ä½¿ç”¨äº†ä¸€ä¸‹ï¼Œè®°å½•äº†ä¸€ä¸‹ä½¿ç”¨è¿‡ç¨‹ã€‚ğŸ˜€
## ç›®å½•
- [å®‰è£…](#å®‰è£…)
- [æŸ¥çœ‹ä½ç½®](#æŸ¥çœ‹ä½ç½®)
- [å¯åŠ¨vsftpdæœåŠ¡](#å¯åŠ¨vsftpdæœåŠ¡)
- [å…³é—­firewallå’ŒSELinux](#å…³é—­firewallå’Œselinux)
- [ä¿®æ”¹é…ç½®æ–‡ä»¶](#ä¿®æ”¹é…ç½®æ–‡ä»¶)
- [åŒ¿åç™»å½•](#åŒ¿åç™»å½•)
- [å¤šç”¨æˆ·é…ç½®](#å¤šç”¨æˆ·é…ç½®)
  - [åˆ›å»ºå®¿ä¸»ç”¨æˆ·](#åˆ›å»ºå®¿ä¸»ç”¨æˆ·)
  - [å»ºç«‹è™šæ‹Ÿç”¨æˆ·æ–‡ä»¶](#å»ºç«‹è™šæ‹Ÿç”¨æˆ·æ–‡ä»¶)
  - [ç”Ÿæˆè™šæ‹Ÿç”¨æˆ·æ•°æ®æ–‡ä»¶](#ç”Ÿæˆè™šæ‹Ÿç”¨æˆ·æ•°æ®æ–‡ä»¶)
  - [åˆ›å»ºç”¨æˆ·é…ç½®](#åˆ›å»ºç”¨æˆ·é…ç½®)
  - [åˆ›å»ºç”¨æˆ·ç›®å½•](#åˆ›å»ºç”¨æˆ·ç›®å½•)
  - [æœ€åé‡å¯vsftpdæœåŠ¡å™¨](#æœ€åé‡å¯vsftpdæœåŠ¡å™¨)
- [æœåŠ¡è¿ç»´](#æœåŠ¡è¿ç»´)
- [FTPå‘½ä»¤](#ftpå‘½ä»¤)
  - [å…³é—­FTPè¿æ¥](#å…³é—­ftpè¿æ¥)
  - [ä¸‹è½½æ–‡ä»¶](#ä¸‹è½½æ–‡ä»¶)
  - [ä¸Šä¼ æ–‡ä»¶](#ä¸Šä¼ æ–‡ä»¶)
- [çŠ¶æ€ç ](#çŠ¶æ€ç )
- [å‚è€ƒèµ„æ–™](#å‚è€ƒèµ„æ–™)
## å®‰è£…
åœ¨å®‰è£…å‰æŸ¥çœ‹æ˜¯å¦å·²å®‰è£…vsftpd
```shell
# æŸ¥çœ‹æ˜¯å¦å·²å®‰è£… æ–¹æ³•ä¸€
[root@localhost ~]# rpm -q vsftpd
vsftpd-3.0.2-21.el7.x86_64
# æŸ¥çœ‹æ˜¯å¦å·²å®‰è£… æ–¹æ³•äºŒ
[root@localhost ~]# vsftpd -v
vsftpd: version 3.0.2
# å®‰è£… vsftpd
[root@localhost ~]# yum -y install vsftpd
```
## æŸ¥çœ‹ä½ç½®
```shell
[root@localhost ~]# whereis vsftpd
vsftpd: /usr/sbin/vsftpd /etc/vsftpd /usr/share/man/man8/vsftpd.8.gz
```
## å¯åŠ¨vsftpdæœåŠ¡
```shell
systemctl start vsftpd.service
```
## å…³é—­firewallå’ŒSELinux
```shell
setenforce 0   # è®¾ç½®SELinux æˆä¸ºpermissiveæ¨¡å¼  ï¼ˆå…³é—­SELinuxï¼‰
setenforce 1   # è®¾ç½®SELinux æˆä¸ºenforcingæ¨¡å¼   ï¼ˆå¼€å¯SELinuxï¼‰
# æˆ–è€…ä¿®æ”¹é…ç½®
vi /etc/selinux/config
# SELINUX=enforcing
# æ³¨é‡Šæ‰
# SELINUXTYPE=targeted
# æ³¨é‡Šæ‰
SELINUX=disabled
# å¢åŠ 
:wq! #ä¿å­˜é€€å‡º
setenforce 0
```
æˆ–è€…è®¾ç½®SELinux
```shell
getsebool -a | grep ftp
setsebool -P ftpd_full_access on
```
```shell
systemctl stop firewalld.service
#åœæ­¢firewall
systemctl disable firewalld.service
#ç¦æ­¢firewallå¼€æœºå¯åŠ¨
```
å¦‚æœä½ ä¸æ„¿æ„å…³é—­é˜²ç«å¢™ï¼Œéœ€è¦é˜²ç«å¢™æ·»åŠ FTPæœåŠ¡ã€‚
```shell
firewall-cmd --permanent --zone=public --add-service=ftp
firewall-cmd --reload
```
## ä¿®æ”¹é…ç½®æ–‡ä»¶
é…ç½®æ–‡ä»¶`/etc/vsftpd/vsftpd.conf`
```shell
anonymous_enable=NO        # ä¸å…è®¸åŒ¿åè®¿é—®ï¼Œç¦ç”¨åŒ¿åç™»å½•
chroot_local_user=YES      # å¯ç”¨é™å®šç”¨æˆ·åœ¨å…¶ä¸»ç›®å½•ä¸‹
use_localtime=YES          # ä½¿ç”¨æœ¬åœ°æ—¶(è‡ªè¡Œæ·»åŠ )
chroot_list_enable=YES
local_enable=YES           # å…è®¸ä½¿ç”¨æœ¬åœ°å¸æˆ·è¿›è¡ŒFTPç”¨æˆ·ç™»å½•éªŒè¯
allow_writeable_chroot=YES # å¦‚æœå¯ç”¨äº†é™å®šç”¨æˆ·åœ¨å…¶ä¸»ç›®å½•ä¸‹éœ€è¦æ·»åŠ è¿™ä¸ªé…ç½®ï¼Œè§£å†³æŠ¥é”™ 500 OOPS: vsftpd: refusing to run with writable root inside chroot()
xferlog_enable=YES         # å¯ç”¨ä¸Šä¼ å’Œä¸‹è½½çš„æ—¥å¿—åŠŸèƒ½ï¼Œé»˜è®¤å¼€å¯ã€‚
local_umask=022            # è®¾ç½®æœ¬åœ°ç”¨æˆ·é»˜è®¤æ–‡ä»¶æ©ç 022
# FTPä¸Šæœ¬åœ°çš„æ–‡ä»¶æƒé™ï¼Œé»˜è®¤æ˜¯077ï¼Œä¸è¿‡vsftpdå®‰è£…åçš„é…ç½®æ–‡ä»¶é‡Œé»˜è®¤æ˜¯022
```
è™šæ‹Ÿç”¨æˆ·é«˜çº§å‚æ•°
```
å½“virtual_use_local_privs=YES æ—¶ï¼Œè™šæ‹Ÿç”¨æˆ·å’Œæœ¬åœ°ç”¨æˆ·æœ‰ç›¸åŒçš„æƒé™ï¼›
å½“virtual_use_local_privs=NO  æ—¶ï¼Œè™šæ‹Ÿç”¨æˆ·å’ŒåŒ¿åç”¨æˆ·æœ‰ç›¸åŒçš„æƒé™ï¼Œé»˜è®¤æ˜¯NOã€‚
å½“virtual_use_local_privs=YESï¼Œwrite_enable=YESæ—¶ï¼Œè™šæ‹Ÿç”¨æˆ·å…·æœ‰å†™æƒé™ï¼ˆä¸Šä¼ ã€ä¸‹è½½ã€åˆ é™¤ã€é‡å‘½åï¼‰ã€‚
å½“virtual_use_local_privs=NOï¼Œwrite_enable=YESï¼Œanon_world_readable_only=YESï¼Œ
anon_upload_enable=YESæ—¶ï¼Œè™šæ‹Ÿç”¨æˆ·ä¸èƒ½æµè§ˆç›®å½•ï¼Œåªèƒ½ä¸Šä¼ æ–‡ä»¶ï¼Œæ— å…¶ä»–æƒé™ã€‚
å½“virtual_use_local_privs=NOï¼Œwrite_enable=YESï¼Œanon_world_readable_only=NOï¼Œ
anon_upload_enable=NOæ—¶ï¼Œè™šæ‹Ÿç”¨æˆ·åªèƒ½ä¸‹è½½æ–‡ä»¶ï¼Œæ— å…¶ä»–æƒé™ã€‚
å½“virtual_use_local_privs=NOï¼Œwrite_enable=YESï¼Œanon_world_readable_only=NOï¼Œ
anon_upload_enable=YESæ—¶ï¼Œè™šæ‹Ÿç”¨æˆ·åªèƒ½ä¸Šä¼ å’Œä¸‹è½½æ–‡ä»¶ï¼Œæ— å…¶ä»–æƒé™ã€‚
å½“virtual_use_local_privs=NOï¼Œwrite_enable=YESï¼Œanon_world_readable_only=NOï¼Œ
anon_mkdir_write_enable=YESæ—¶ï¼Œè™šæ‹Ÿç”¨æˆ·åªèƒ½ä¸‹è½½æ–‡ä»¶å’Œåˆ›å»ºæ–‡ä»¶å¤¹ï¼Œæ— å…¶ä»–æƒé™ã€‚
å½“virtual_use_local_privs=NOï¼Œwrite_enable=YESï¼Œanon_world_readable_only=NOï¼Œ
anon_other_write_enable=YESæ—¶ï¼Œè™šæ‹Ÿç”¨æˆ·åªèƒ½ä¸‹è½½ã€åˆ é™¤å’Œé‡å‘½åæ–‡ä»¶ï¼Œæ— å…¶ä»–æƒé™ã€‚
```
## åŒ¿åç™»å½•
å®‰è£…å®Œé»˜è®¤æƒ…å†µä¸‹æ˜¯å¼€å¯åŒ¿åç™»å½•çš„ï¼Œå¯¹åº”çš„æ˜¯ `/var/ftp` ç›®å½•ï¼Œè¿™æ—¶åªè¦æœåŠ¡å¯åŠ¨äº†ï¼Œå°±å¯ä»¥ç›´æ¥è¿ä¸ŠFTPäº†ã€‚é»˜è®¤ç”¨æˆ·åæ˜¯`ftp`ï¼Œå¯†ç æ˜¯ç©ºçš„ã€‚å¦‚æœä½ åœ¨é…ç½®é‡Œé¢é…ç½®äº†`anonymous_enable=NO`ï¼ŒåŒ¿åå°±æ— æ³•ç™»å½•ã€‚
```shell
$ ftp 192.168.188.114
Connected to 192.168.188.114.
220 (vsFTPd 3.0.2)
Name (192.168.188.114:kennywang): ftp
331 Please specify the password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> ls
229 Entering Extended Passive Mode (|||47867|).
150 Here comes the directory listing.
-rw-r--r--    1 0        0              12 Jan 18 06:31 README.md
drwxr-xr-x    2 0        0               6 Nov 05 19:43 pub
226 Directory send OK.
```
## å¤šç”¨æˆ·é…ç½®
å¤šç”¨æˆ·é…ç½®éœ€è¦è‡ªå·±æ‰‹å·¥æ·»åŠ é…ç½®ï¼Œä¸‹é¢å†…å®¹åˆ°vsftpd.confæœ«å°¾
```shell
# 
# 
use_localtime=YES          # ä½¿ç”¨æœ¬åœ°æ—¶(è‡ªè¡Œæ·»åŠ )
listen_port=21
chroot_local_user=YES      # å¯ç”¨é™å®šç”¨æˆ·åœ¨å…¶ä¸»ç›®å½•ä¸‹
idle_session_timeout=300
data_connection_timeout=120  # æ•°æ®è¿æ¥è¶…æ—¶æ—¶é—´
guest_enable=YES             # è®¾å®šå¯ç”¨è™šæ‹Ÿç”¨æˆ·åŠŸèƒ½
guest_username=ftpuser       # æŒ‡å®šè™šæ‹Ÿç”¨æˆ·çš„å®¿ä¸»ç”¨æˆ· ftpuserï¼ˆå°±æ˜¯æˆ‘ä»¬åé¢ä¼šæ–°å»ºè¿™ä¸ªç”¨æˆ·ï¼‰
# guest_username=www
# å¦‚æœftpç›®å½•æ˜¯æŒ‡å‘ç½‘ç«™æ ¹ç›®å½•ï¼Œç”¨æ¥ä¸Šä¼ ç½‘ç«™ç¨‹åºï¼Œ
# å¯ä»¥æŒ‡å®šè™šæ‹Ÿç”¨æˆ·çš„å®¿ä¸»ç”¨æˆ·ä¸ºnginxè¿è¡Œè´¦æˆ·wwwï¼Œå¯ä»¥é¿å…å¾ˆå¤šæƒé™è®¾ç½®é—®é¢˜ 
user_config_dir=/etc/vsftpd/vuser_conf   # è™šæ‹Ÿç”¨æˆ·é…ç½®æ–‡ä»¶ç›®å½•
virtual_use_local_privs=YES # NOæ—¶ï¼Œè™šæ‹Ÿç”¨æˆ·å’ŒåŒ¿åç”¨æˆ·æœ‰ç›¸åŒçš„æƒé™ï¼Œé»˜è®¤æ˜¯NO
pasv_min_port=10060         # è¢«åŠ¨æ¨¡å¼æœ€å°ç«¯å£å·10060
pasv_max_port=10090         # è¢«åŠ¨æ¨¡å¼æœ€å¤§ç«¯å£å·10090