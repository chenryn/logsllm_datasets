### 版权信息
- **书名**：《Android应用安全防护和逆向分析》
- **作者**：姜维
- **排版**：KK
- **出版社**：机械工业出版社
- **出版时间**：2017年11月1日
- **ISBN**：978-7-111-58445-2
- **版权说明**：版权所有，侵权必究

### 推荐语
移动应用的安全问题日益凸显。本书通过多个实际案例详细讲解了多种实用工具和命令，是学习安全逆向技术的优秀参考书。姜维凭借多年的实践经验，将复杂的知识体系以易于理解的方式呈现给读者，对初学者和进阶者都具有很高的参考价值。
- **周鸿祎**，360公司创始人、董事长兼CEO，知名天使投资人

本书作者的技术博客在CSDN上的总访问量超过500万人次。随着Android系统在各类智能设备中的广泛应用，其安全问题也变得愈加重要。从正反两方面学习Android开发，不仅有助于掌握编程技巧，还能深入了解系统的运行机制。本书提供了丰富的案例和工具源码，是Android开发者提升技能的理想选择。
- **蒋涛**，CSDN创始人，极客帮基金创始人

随着Android应用范围的不断扩大，相关的安全威胁也随之增加。本书不仅注重实践操作，还深入浅出地介绍了背后的原理，能够帮助读者迅速提高技术水平。
- **段钢**，看雪学院创始人

信息安全领域充满了挑战与机遇。本书结合大量真实案例，逐步引导读者探索这一领域的奥秘。全书结构合理，内容详实，配图清晰，是一本不可多得的学习资料。
- **泮晓波**，顶象技术移动安全实验室负责人、合伙人

本书凝聚了作者多年的信息安全经验，旨在分享纯粹的技术知识。通过对底层原理的透彻解析，使读者能够全面掌握安全技术的核心要点。
- **丰生强（非虫）**，国内知名安全专家

移动应用安全已成为一个不容忽视的问题。对于初学者来说，一本合适的入门书籍至关重要。本书涵盖了基础知识，并精选了多个典型实例进行深入剖析，非常适合自学使用。
- **邓凡平**

### 前言
随着移动应用的普及，信息安全成为了一个亟待解决的重要课题。本书从Android应用安全与逆向两个角度出发，为读者提供了一套完整的解决方案。

起初，我并未从事安全逆向工作，但一次偶然的机会让我领略到了逆向研究的魅力。首次尝试是因为遇到了一个问题需要解决，我使用apktool进行了反编译，发现原来他人的应用程序中隐藏着如此多的信息。从此之后，每当遇到无法实现的功能或缺乏资源时，我都会转向逆向工程来寻找答案。随着时间的推移，我的经验和技能也在不断增长。

逆向思维是一种独特的能力，虽然我没有接受过专业培训，但在业余时间里通过阅读相关书籍并实践操作，逐渐掌握了这门技艺。本书是我多年学习成果的总结。

全书共分为四部分：
- **基础篇**（第1-7章）：介绍与逆向相关的基础知识；
- **防护篇**（第8-14章）：探讨安全防护策略；
- **工具篇**（第15-19章）：详细介绍常用工具及其使用方法；
- **操作篇**（第20-26章）：展示具体的逆向操作技巧。

### 适合人群
具备一定Android开发基础的读者会更容易理解和掌握本书内容。即使某些章节较为复杂，也可以从较简单的部分开始学习，逐步深入。

### 联系方式
如果您在学习过程中遇到任何问题，请随时联系我。可以通过以下渠道获取支持：
- 微信ID: peter_jw212
- 微信公众号: 编码美丽
- 博客: [http://blog.csdn.net/jiangwei0910410003](http://blog.csdn.net/jiangwei0910410003)
- 个人网站: [http://www.wjdiankong.cn](http://www.wjdiankong.cn)

### 致谢
在此感谢所有在写作过程中给予我帮助和支持的朋友，尤其是非虫大神、MindMac大神以及ThomasKing大神等，在技术上提供了宝贵的建议。同时也要感谢我的同学汪恒和殷传宝，他们在我整个创作过程中给予了极大的鼓励和支持。

### 第一章：Android中锁屏密码加密算法分析
#### 1.1 锁屏密码方式
目前Android系统支持两种主要类型的锁屏密码：
- **手势密码**：即九宫格图案解锁；
- **输入密码**：包括PIN码（纯数字）和复杂字符密码。

#### 1.2 密码算法分析
##### 1.2.1 输入密码算法
通过分析`LockPatternUtils.java`文件中的`passwordToHash`函数，可以得知输入密码的加密过程如下：
1. 将用户输入的密码与设备特有的salt值拼接；
2. 对拼接后的字符串分别执行MD5和SHA-1哈希运算；
3. 将两次哈希的结果转换成十六进制格式并再次拼接，最终得到加密后的密码。

其中，salt值的获取可通过`getSalt`方法实现。如果该值不存在，则随机生成一个新的salt并保存至数据库中。

##### 1.2.2 手势密码算法
手势密码的处理相对简单，主要是将绘制的图案转化为字节数组后进行SHA-1哈希计算。关于九宫格的具体编码规则不再赘述。