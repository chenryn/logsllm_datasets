able data services. Two systems should enforce the proper tran-
sition when the user device switches across 3G and 4G. We rec-
ommend that one detach condition should be removed in the stan-
dard. It is triggered when the user device without active PDP con-
text switches from 3G to 4G. Instead of detaching itself, the device
should immediately activate EPS bearer after inter-system 3G→4G
switching. Thus seamless system change can be ensured (§5.1).
In case of failures in one system, the other system should help
on recovery if possible. For example, in the second issue (§6.3),
the 4G MME should not detach the user device upon the failure of
location update in the 3G. Instead, it should recover the devices’
location update with the 3G MSC on behalf of the device.
In the
standard, it is not stipulated that the MME should detach the user
device upon the 3G failure. We suggest the operators abolish it.
9. PROTOTYPE AND EVALUATION
We describe the solution prototype and assess its effectiveness.
Prototype of Control Plane. We prototype the control plane
functions at three major components, user device, base station,
and core network in the cellular network. The user device uses a
programmable Android phone. We use two commercial machines
(both Lenovo X230) to emulate the base station and the core net-
work. Note that our prototype is based on our own proof-of-concept
3G/4G stacks, since the operational stacks are not accessible.
the modules of connectivity management
(CC/SM/ESM) and mobility management (MM/GMM/EMM) at
both the user device and the core network. For connectivity
management, there are two functions: CS/PS service establish-
ment/release, and the activation/deactivation of PDP context/EPS
bearer. The mobility management module provides three func-
tions: attach/detach, location update, and signaling establishment
of SM/CM/ESM. We also implement the RRC layer at the device
and the base station. Since the transmission at the RRC layer is not
reliable, we use UDP to emulate it. We use TCP to forward (re-
lay) RRC payloads between the base station and the core network,
since their transmission is assumed to be reliable. All functions are
implemented in the application layer.
9.1 Layer Extension
We show that our reliable shim layer in §8 prevents the detach
caused by the duplicate or the lost EMM signaling messages. To
emulate the lost of EMM messages, the RRC at the base station
drops the message according to a given drop rate. For each test,
user device does both attach and tracking area update for 100 times.
Figure 12 (left) shows that the number of detach varies with the
given drop rate with/without our solution. Note that the detach
times linearly increase with the drop rate when no solution is used.
With our solution, there is no detach while the drop rate increases.
To decouple the location update from the CS service, both the
device and core network’s MM create two threads to handle them
We implement
i
e
c
v
r
e
S
l
l
a
C
)
s
(
y
a
e
D
l
 6
 5
 4
 3
 2
 1
 0
w/ Solution
w/o Solution
 0
 1
 2
 3
 4
 5
 6
 10
 0
 2
 4
 8
Drop Rate (%)
 6
Figure 12: Left: the number of detach varies with drop rate.
Right: the call delay call varies with the location update time.
Location Update Time(s)
w/ Solution
w/o Solution
VoIP
Data
i
s
e
m
T
h
c
a
e
D
 10
 8
 6
 4
 2
 0
t
)
s
p
b
M
(
d
e
e
p
S
 25
 20
 15
 10
 5
 0
VoIP
Data
)
s
p
b
M
(
d
e
e
p
S
 25
 20
 15
 10
 5
 0
Coupled Decounpled
Coupled Decounpled
Figure 13: The data speeds vary with/without the coupled data
and voice: downlink (Left) and uplink (Right).
concurrently. The location update and the PS service for GMM are
also decoupled in the same way. We examine the CS/PS service de-
lay incurred by the location update in MM/GMM. We show only
the result of the CS service, and PS service’s result is similar. The
MM function is conﬁgured to do location update every 30 seconds.
When the location update is triggered, CM at the user device imme-
diately triggers a call service through MM. Figure 12 (right) shows
that the call service delay at MM varies with the processing time
of location update. Note that the processing time may vary with
the loading of signalling at the core network. Without enabling our
solution, the service delay linearly increases with the processing
time. However, our solution does not have delay since MM has two
threads to deal with location update and call service concurrently.
9.2 Domain Decoupling
We decouple the CS/PS service with two actions. First, we ap-
ply different modulations (channels) to CS and PS trafﬁc. Since
we have no BS access, we use WiFi Rate Adaptation (RA) module
to emulate 16QAM and 64QAM modulation in the CS/PS decou-
pling case. This can be approximated by using two 48 Mbps and
24 Mbps rates in 802.11a. Note that the overhead could be differ-
ent between 3G and WiFi, but the result is similar. Figure 13 shows
the speed for voice and data in both coupled and decoupled cases.
Voice trafﬁc is generated by Skype’s VOIP calls.
It is observed
that the speed of data trafﬁc at the decoupling can be improved by
about 1.6 times for both downlink and uplink. In the mean time, the
voice can still be carried by a robust modulation. The difference be-
tween the speeds of voice and data at the coupling, comes from the
voice’s small packet size. It incurs more overhead on transmission.
Second, to prevent the CSFB inter-system switching from being
blocked in the PS domain, we add a new function into the BS’s
RRC. It asks the user device to switch its RRC state to a proper
state for inter-system switching, once the switching is used to com-
plete the CSFB procedure. It is veriﬁed that the user device’s CSFB
switching is never blocked, by enabling our solution.
9.3 Cross-system Coordination
We prototype two remedies for the cross-system coordination be-
tween 3G and 4G. First, the user device always activates the EPS
bearer if it does not have active PDP context, after inter-system
3G→4G switching. We test it in the scenario that the user device
without PDP context switches from 3G to 4G. The remedy can
prevent the device from being detached, so the switch takes only
0.1-0.4s (median is 0.27s). Without the remedy, it takes 0.3-1.3s
(median is 0.9s) since the device has to re-attach to 4G network
after being detached. This delay may be much larger due to more
233complicated procedure or the heavy loading at the operator’s core
network. It is observed as large as 24.7s (§5.1).
In the second remedy, two actions are taken by MME once it
receives the failure message of 3G location update for a user device.
First, it does not forward this failure message to the device. Second,
it triggers the recovery process by updating the device’s location to
the 3G MSC. It is veriﬁed that the MME does not detach the user
device upon the failure of location update in the 3G, and further
recover it by updating device’s location with the MSC later.
10. RELATED WORK
Cellular networking has been an active research area in recent
years. Some interesting ﬁndings on inappropriate cellular network
operations are reported, including the interplay between applica-
tions and cellular infrastructure [9,14], TCP over cellular data for-
warding [13], mutual interference between data and voice [27], and
misbehaviors in cellular functions [21,22,26], to name a few. Our
work differs from all such early studies. They focus on packet
transmission on the data plane while we work on the control plane.
Moreover, they study protocols at the end hosts whereas our entities
are at both the devices and the infrastructure elements.
Protocol veriﬁcation has been investigated for the Internet proto-
cols [12,17,19,24]. New techniques have been recently developed
for more complex scenarios. For example, [18] presents SAT-based
data-plane debugging; [10] enhances the OpenFlow application de-
bugging with symbolic execution of event handlers; header space
analysis is applied for testing complex interactions between various
Internet protocols [15]. Our study is orthogonal to these efforts. We
focus on protocol veriﬁcation for cellular networks.
In cellular networks, formal model analysis has been applied to
individual protocols. [20] veriﬁes the 2G handover protocol using a
generic mobility model with π-calculus. [25] models the authenti-
cation protocol and identiﬁes several security loopholes. Our work
differs in both the problem and the solution approach. We study
protocol interactions and employ two-phrase veriﬁcation.
11. CONCLUSION
In 3G/4G cellular networks, control-plane protocols are more
complex than their counterparts over the Internet. They have to
work in more diversiﬁed usage settings, e.g., between CS and PS
domains, and across 3G and 4G systems. They also support addi-
tional functions, including mobility, data and carrier-grade voice,
ﬁne control over radio resources. Consequently, inter-protocol
signaling is widespread along all three dimensions of cross-layer,
cross-domain, and cross-system scenarios.
We show that, some interactions are not well designed, whereas
others are not properly operated. The inter-dependent signaling
protocols may not take concerted actions. The independent ones are
unnecessarily coupled. The incurred damages include both func-
tional incorrectness and performance degradation. The penalty is
more pronounced than data-plane faults in data transfer. They may
get mobile users stuck in 3G, or deny them 4G access.
Three domain-speciﬁc lessons in cellular networks are learnt
from our work. First, in the cross-layer case, the well-tested layer-
ing rule from the Internet should be honored. If the lower layer does
not provide certain functions, the higher layer has to do so, or to be
prepared to work without those functions. Coupling inter-layer ac-
tions is also not a good practice unless properly justiﬁed. Second, in
the cross-domain case, signaling design should recognize the inter-
domain difference. Treating domains identically seems to reduce
design and operational complexity, but makes it overly simplistic
and error prone. Third, in the cross-system case, failure messages
can be shared and even acted upon between systems. However, it
is better not to expose such failure-handling operations outside the
system unless absolutely needed.
In the broader scope, research on control-plane protocols in cel-
lular networks warrants more efforts. 3G/4G is a large-scale infras-
tructure on a par with the wired Internet. There is no competing
wireless technology for universal coverage and wide-area mobility
support on the horizon. Given such a critical system indispensable
to smartphones and tablets, more research is needed. The control-
plane research in cellular networks also complements the study on
the Internet counterpart. While the Internet seeks to enhance its
control plane (e.g., [16]), the cellular system needs to simplify its
signaling design. Both can beneﬁt from each other in the process.
12. ACKNOWLEDGMENTS
We greatly appreciate our shepherd, Dr. Ratul Mahajan, and the
SIGCOMM reviewers for their valuable feedback. We also thank
all participants in the user study. This project at its early stage was
partially supported by NSF Grant CSR-1017127.
13. REFERENCES
[1] Speedtest.net - Ookla. http://www.SpeedTest.net.
[2] Voice over LTE. http://www.gsma.com/technicalprojects/volte.
[3] 3GPP. TS25.331: Radio Resource Control (RRC), 2006.
[4] 3GPP. TS23.401: GPRS Enhancements for E-UTRAN Access, 2011.
[5] 3GPP. TS23.272: CSFB in EPS, 2012.
[6] 3GPP. TS24.008: Mobile Radio Interface Layer 3, 2012.
[7] 3GPP. TS36.331: Radio Resource Control (RRC), 2012.
[8] 3GPP. TS24.301: Non-Access-Stratum (NAS) for EPS; , Jun. 2013.
[9] N. Balasubramanian, A. Balasubramanian, and A. Venkataramani.
Energy Consumption in Mobile Phones: A Measurement Study and
Implications for Network Applications. In IMC, 2009.
NICE Way to Test OpenFlow Applications. In NSDI, 2012.
LTE. Wiley, 2007.
Laboratories, 1991.
O. Spatscheck. An in-depth study of LTE: Effect of network protocol
and application behavior on performance. In SIGCOMM’13.
[14] U. Javed, D. Han, R. Caceres, J. Pang, S. Seshan, and A. Varshavsky.
Predicting Handoffs in 3G Networks. SIGOPS Oper. Syst. Rev.,
45(3):65–70, Jan. 2012.
[15] P. Kazemian, G. Varghese, and N. McKeown. Header Space
Analysis: Static Checking for Networks. In NSDI, 2012.
[16] T. Koponen, M. Casado, N. Gude, et al. Onix: A distributed control
platform for large-scale production networks. In OSDI, 2010.
[17] B. T. Loo, J. M. Hellerstein, I. Stoica, et al. Declarative routing:
Extensible routing with declarative queries. In SIGCOMM’05.
[18] H. Mai, A. Khurshid, R. Agarwal, et al. Debugging the data plane
with anteater. SIGCOMM Comp. Comm. Rev., 41(4):290–301, 2011.
[19] M. Musuvathi and D. R. Engler. Model checking large network
protocol implementations. In NSDI, 2004.
[20] F. Orava and J. Parrow. An algebraic veriﬁcation of a mobile
network. Formal Aspects of Computing, 4(6):497–543, 1992.
[21] C. Peng, C. Li, G. Tu, S. Lu, and L. Zhang. Mobile Data Charging:
New Attacks and Countermeasures. In CCS, 2012.
[22] C. Peng, G. Tu, C. Li, and S. Lu. Can We Pay for What We Get in 3G
Data Access? In MobiCom, 2012.
[23] Qualcomm. Circuit-Switched Voice Services over HSPA.
[24] M. A. Smith. Formal Veriﬁcation of Communication Protocols. In
[25] C. Tang. Modeling and Analysis of Mobile Telephony Protocols. PhD
[26] G. Tu, C. Peng, C. Li, et al. Accounting for Roaming Users on
[27] G. Tu, C. Peng, H. Wang, C. Li, and S. Lu. How Voice Calls Affect
[10] M. Canini, D. Venzano, P. Peresini, D. Kostic, and J. Rexford. A
[11] H. Holma and A. Toskala. WCDMA for UMTS - HSPA Evolution and
[12] G. J. Holzmann. Design and Validation of Computer Protocols. Bell
[13] J. Huang, F. Qian, Y. Guo, Y. Zhou, Q. Xu, Z. M. Mao, S. Sen, and
FORTE, pages 129–144, 1996.
thesis, Stevens Institute of Technology, 2013.
Mobile Data Access: Issues and Root Causes. In MobiSys, 2013.
Data in Operational LTE Networks. In MobiCom, 2013.
234