## Page 34
口证书链
4.密钥分配
口X.509 数字证书的认证系统
4.密钥分配
■从根CA向下的所有链接都称为信任链。
■可以有不止一个根CA。
■X.509提出：把多级认证中心链接起来
无条件信任的），且其公钥是公开的。
(Root CA)
最高一级的认证中心都称为根认证中心
末端是用户。
的，构成-
根CA的公钥
根CA签名
根CA
根证书
最顶层的根证书的数字签名是自签名的（即自己的私钥给自己签名）
与信任链对应的是证书链。
一个树状的认证系统。
签发
验证
中间CA2的公钥
中间CA2的证书
根CA签名
根CA签发
中间CA2
签发
验证
B
中间CA1
中间CA2签名
中间CA2签发
用户E的证书
E的公钥
用户名：E
根CA
D
4.2公钥的分配
4.2公钥的分配
中间CA2
68
67
---
## Page 35
口证书撤销与更新
4.密钥分配
■有很多原因导致证书被吊销，例如：
■证书不是永久有效，它可以过期，也可以被吊销。
并定期更新。
每一个CA 应当有一个公布于众的、用本 CA的私钥签名的证书撤销名单,
①用户私钥被盗或遗失。
CA签署用户证书的私钥被泄漏。
用户不再被该CA认证。
11"1
catcmedus
4.2公钥的分配
69
---
## Page 36
口 IPsec 协议族 
5.互联网使用的安全协议
口 IPsec 提供了标准、健壮且包含广泛的机制保证IP 层安全。
口IP几乎不具备任何安全性，不能保证
5.互联网使用的安全协议
口
由于其在设计和实现上存在安全漏洞，使各种攻击有机可乘。
■ IPsec 支持 IPv4 和 IPv6。
■IPsec 是个框架：
■IPsec 不是一个单一协议，而是能够在IP 层提供互联网通信安全的协议族。
■ IPsec: IP security, IP 安全。
■例如：攻击者很容易构造一个包含虚假地址的IP 数据报。
③
?
为保证互操作性，IPsec 还包含了所有IPsec 都必须实现的一套加密算法。
口允许通信双方选择合适的算法和参数（例如，密钥长度）。
数据来源认证
数据完整性
数据机密性
5.1网络层安全协议
5.1网络层安全协议
72
---
## Page 37
口IPsec 协议族 
5.互联网使用的安全协议
口IPsec 协议族
5.互联网使用的安全协议
■IP 安全数据报有两种工作方式
■IPsec 由三部分组成
口IP 安全数据报格式：两个协议
口
口
互联网密钥交换 IKE(Internet Key Exchange) 协议
加密算法：三个协议 
在整个运输层报文段的前后分别添加若干控
·使用 ESP 或 AH 协议的IP 数据报称为IP 安全数据报（或IPsec数据报）。
·鉴别首部 AH(Authentication Header)协议
运输方式(transport mode)
封装安全有效载荷 ESP(Encapsulation SecurityPayload)协议
·AH协议的功能都已包含在ESP协议中，使用ESP协议就可以不使用AH协议。
·ESP 协议提供源点鉴别、数据完整性和保密。
·AH协议提供源点鉴别和数据完整性，但不能保密。
IP始部
IP安全数据报
TCP/UDP报文段
TCP/UDP报文段
·在原始的IP数据报的前后分别添加若干控制信息，再
IP新部IPSec首部
IPsec协议。
需要在IPsec数据报所经过的所有路由器上都运行
隧道方式(tunnelmode)
I原始
IP部TCP/UDP报文段
IP安全数据报
原始IP数据报
TCP/UDP 报文段
5.1网络层安全协议
5.1网络层安全协议
3
3
---
## Page 38
口安全关联
5.互联网使用的安全协议
口IPsec 协议族 
5.互联网使用的安全协议
■IPsec 把传统互联网无连接的网络层转换为具有逻辑连接的网络层。
■在发送IP安全数据报之前，在源实体和目的实体之间必须创建一条网络层的
■IP安全数据报有两种工作方式
安全关联的特点：
逻辑连接。此逻辑连接叫做安全关联SA(Security Association）。
口如要进行双向安全通信，则两个方向都需要建立安全关联。
口在安全关联SA上传送的就是IP 安全数据报。
口安全关联是从源点到终点的单向连接，它能够提供安全服务。
口通常把数据报的数据部分称为数据报的有效载荷(payload)。
口无论使用哪种方式，最后得出的IP 安全数据报的IP 首部都是不加密的。
口IP安全数据报的IP首部是不加密的。
口
若 n 个员工进行双向安全通信，共需要创建（2+ 2n）条安全关联 SA。
1安全数据报：指数据报的数据部分是经过加密的，并能够被鉴别的。
口
5.1网络层安全协议
5.1网络层安全协议
76
75
8
---
## Page 39
5.互联网使用的安全协议
5.互联网使用的安全协议
假定公司总部的主机H-1要和内部的主机H-3进行通信。
公司总部与分公司之间的安全关联SA是在路由器R和R2之间建立的。
假定公司总部的主机H-1要和分公司的主机H-2通过互联网进行安全通信。
由于都在公司内部，不需要加密，因此不需要建立安全关联
从H1到H3
公司总部
从H1到H2
公司总部
装有IPsec
装有IPsec
路由器 R-1到 R-2的安全关联SA
主机 H-1到H-3之间的通信
从R1到R2
互联网
联风
装有IPse
从H1到H2
分公司
分公司
5.1网络层安全协议
5.1网络层安全协议
78
6
---
## Page 40
5.互联网使用的安全协议
5.互联网使用的安全协议
口
安全关联 
■安全关联SA 包括的状态信息：
口完整性检查的类型（例如，使用报文摘要 MD5或 SHA-1的报文鉴别码MAC）。
口加密使用的密钥。
口安全关联 SA 的源点和终点的IP 地址（例如路由器 R1和 R2的IP 地址）。
口一个 32 位的连接标识符，称为安全参数索引 SPI(Security Parameter Index)。
口
鉴别使用的密钥。
所使用的加密类型（例如，DES 或AES）。
需要在公司总部的路由器R1和外地业务员的主机H2建立安全关联SA。
若公司总部的主机H1要和某外地业务员的主机H2进行安全通信。
从H1到H4
公司总部
装有IPsec
路由器R-1到主机H-4的安全关联SA
从R1到H4
互联网
装有IPsec
分公司
5.1网络层安全协议
5.1网络层安全协议
80
---
## Page 41
口IPsec 的其他构件
5.互联网使用的安全协议
IP 安全数据报的格式 
5.互联网使用的安全协议
■互联网密钥交换IKE 
送
↑
口IKEv2 以另外三个协议为基础：
口非常复杂。互联网的正式标准[RFC 7296]。
①Oakley：密钥生成协议[RFC 2412]。
隧道方式下的IP安全数据报的格式
安全参数索引ISPI
32位
厚智的原始的数据报
IP安全数据报的有效载荷
IP安全数据报—
ESP的有效载存
00..00填充长度下一个首部
尾SP报文
协议=
注意：
和目的地址。
的IP地址分别作为源地址
在 IP 安全数据报的"新的 IP
"中，用主机 H 和 H2 的 IP
关联SA，
对于路由器 R 到 R2 的安全
地址。
地址分别作为源地址和目的
5.1网络层安全协议
，用路由器 R 和 R2
5.1网络层安全协议
28
---
## Page 42
口协议 TLS 的要点
5.互联网使用的安全协议
口运输层广泛使用以下两个安全协议
5.互联网使用的安全协议
■2020 年，旧版本 TLS1.0/1.1均被废弃
■2018 年8月，IETF 发布了经历了 28个草案后才通过的最新版本TLS1.3 
■安全套接层 SSL 由 Netscape 于 1994 年开发，广泛应用于基于万维网的各
■
[RFC 8446，建议标准]（不向后兼容）
用提供安全数据传输服务。
1999年，
全通道，
SSL 作用在端系统应用层的 HTTP 和运输层之间，
种网络应用（但不限于万维网应用）
(Secure Socket Layer)
，IETF 在 SSL 3.0 基础上设计了 TLS1.0，为所有基于 TCP 的网络应
为通过 TCP 传输的应用层数据提供安全保障。
安全套接字层 SSL 
(Transport Layer Security)
运输层安全 TLS
，在TCP 之上建立起一个安
5.2运输层安全协议
5.2运输层安全协议
 84
83
---
## Page 43
口TLS与应用层协议独立无关
5.互联网使用的安全协议
5.互联网使用的安全协议
■应用层使用TLS最多的就是HTTP。
■TLS 提供了一个简单的带有套接字的应用程序接口API，与 TCP 的API相似。
口应用程序HTTP调用 TLS 对整个网页进行加密时，网页上会提示用户，在网址栏
口TLS 可用于任何应用层协议。
在发送方：TLS接收应用层的数据，对数据进行加密，然后把加密后的数据送往TCP套接字。
原来显示http的地方，现在变成了https。
应用层(HTTP)
网络接口层
SSL/TLS
TCP
协议TLS的位置
互联网
应用层(HTTP)
网络接口层
SSL/TLS
UDP
TCP
5.2运输层安全协议
5.2运输层安全协议
86
85
6
---
## Page 44
口协议 TLS 具有双向鉴别的功能 
5.互联网使用的安全协议
■建立安全会话两个阶段：
■常用单向鉴别：客户端（浏览器）需要鉴别服务器，确信即将访问的网站服
务器是安全和可信的。
两个前提：
①握手阶段：使用握手协议
③浏览器应具有一些手段来证明服务器是安全和可信的。
①服务器需要有一个有效的CA 证书来证明自己。
会话阶段：使用记录协议
CA 证书是运输层安全协议TLS 的基石。
5.2运输层安全协议
ICP案
88
---
## Page 45
口TLS的握手阶段：验证服务器，
5.互联网使用的安全协议
会阔阶股：
5.互联网使用的安全协议
1．协商加密算法。