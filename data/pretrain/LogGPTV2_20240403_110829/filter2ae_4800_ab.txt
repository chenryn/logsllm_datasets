### 主要用途
主要用途是在目标机器上设置跳板，进而对内网进行攻击。根据不同的网络情况，有四种基本场景：

1. 攻击者和目标服务器都有独立的外网IP。
2. 攻击者有独立外网IP，但目标服务器位于内网，只有几个映射端口。
3. 攻击者在内网，目标服务器也在内网且只有几个映射端口。
4. 攻击者在内网，目标服务器有独立外网IP。

针对这四种情况，可以采用不同的方法来获取服务器控制权。

## 端口转发
### 原理
端口转发是一种将网络流量从一个节点重定向到另一个节点的技术。通过激活NAT路由器，外部用户可以通过公网访问私有内部网络中的特定端口。简而言之，端口转发就是将一个端口（可以是本机端口或可访问主机上的端口）的数据转发到另一台可访问的主机上，通常是具有公网IP的主机。

### 应用场景
假设外网主机A能够连接内网主机B上的端口，但无法直接访问内网主机C的端口。此时，可以通过端口转发将C主机的端口数据转发至B主机，使得A主机访问B主机的某个端口时实际上是在访问C主机的相应端口。

### 工具介绍

#### LCX
LCX是一个基于socket套接字实现的跨平台端口转发工具，适用于Windows和Linux系统。该工具需要建立服务器端与客户端之间的连接。

- **Windows版本** (`lcx.exe`):
  - 转发端口: `lcx.exe -slave 公网IP 端口 内网IP 端口`
  - 监听端口: `lcx.exe -listen 转发端口 本地未占用端口`
  - 映射端口: `lcx.exe -tran 映射端口号 IP 目标端口`

- **Linux版本** (`portmap`):
  - 使用示例: `./portmap -m 2 -p1 6666 -h2 公网IP -p2 7777` //监听来自6666端口的请求并转发至7777
  
  其中 `-m` 参数指定操作模式:
  - `method=1`: 端口映射
  - `method=2`: 端口转发
  - `method=3`: 连接两个指定端口

#### FRP (Fast Reverse Proxy)
FRP是一款使用Go语言编写的反向代理应用，支持TCP/UDP/HTTP/HTTPS协议，可用于实现内网穿透。它允许处于内网或防火墙后的设备对外提供服务，并支持多域名共用同一端口。

- **配置步骤**:
  - 修改服务端配置文件 `frps.ini` 并启动服务: `./frps -c frps.ini`
  - 客户端修改 `frpc.ini` 文件后运行: `./frpc -c frpc.ini`

#### Metasploit Portfwd
Metasploit框架内置了Portfwd命令，用于在Meterpreter会话中转发TCP连接。通过受损主机作为中介，使攻击者可以直接访问原本不可达的目标系统。

- **常用选项**:
  - 创建转发: `portfwd add -L 本地监听端口 -p 目标端口 -r 目标IP`
  - 删除转发: `portfwd delete -L 本地监听端口 -p 目标端口 -r 目标IP`
  - 查看所有转发: `portfwd list`
  - 清空所有转发: `portfwd flush`

# 边界代理
边界代理分为多种类型，如HTTP、Socks等。常用的工具有EarthWorm、reGeorg、Proxifier等。正向代理用于内网设备访问外网资源，而反向代理则相反。负载均衡器负责将请求分配给可用的服务实例。

### Socks代理
Socks代理充当客户端与目标服务器之间的中间人角色，支持TCP流量而不支持UDP协议。

### 代理 vs 端口转发
| 特征 | 代理 | 端口转发 |
| --- | --- | --- |
| 协议需求 | 需要特定协议支持 | 无需特定协议 |
| 功能 | 多对一或多对多通信 | 一对一通信 |
| 实现方式 | 解析请求头以确定最终目的地 | 直接转发指定端口的数据 |

## proxychains
proxychains是一款开源代理软件，可在Linux环境下为应用程序提供全局代理功能，支持HTTP/SOCKS4/SOCKS5等多种协议。

- **使用说明**:
  1. 编辑配置文件 `/etc/proxychains.conf` 添加代理信息。
  2. 通过`proxychains [命令]`调用任何程序以启用代理。

## reGeorg
reGeorg利用WebShell创建HTTP/HTTPS隧道，从而绕过内网限制访问内部开放端口。支持PHP/ASPX/JSP等多种脚本语言。

- **部署流程**:
  1. 安装Python依赖库。
  2. 将对应语言版本的脚本上传至服务器。
  3. 在本地启动代理服务: `python reGeorgSocksProxy.py -u URL -p PORT`
  4. 配置proxychains使用新添加的SOCKS代理。

## MSF Route
在已获得Meterpreter Shell的情况下，可通过`run autoroute -s 子网掩码`命令添加通往内网的路由规则，以便于后续渗透测试活动。

## Proxifier
Proxifier是一款Windows下的SOCKS5客户端工具，能够让不支持代理的程序通过HTTPS或SOCKS5代理工作。支持多种协议，并提供了图形界面供用户管理代理规则。