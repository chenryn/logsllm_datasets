enterpriseapplications.Thissystemisrunforabouthalfanhour OneoftheclassicapproachesforaGrangercausaltestistolin-
duringwhichbookingsmadebymultipleusersissimulated.Afault earlyregressBt onAt−1:t−p,Bt−1:t−p forsomelagpandcompare
isinjectedinoneofthemicroserviceswhichimpactsasubsetof theresiduewiththatofregressionofBt onBt−1:t−p alone.Dis-
othermicroservicesinthesystem.Eachmicroservicecontinuesto tributional test involving residues finally acts a Granger causal
emitlogswhichmaybenormalorerroneousdependingonhowitis test.[8]wasoneoftheearliestworksthatstudiedtheaboveidea
impactedbythefault(e.g.seeFig.1(a)).Weconsiderlogsfromthose andproposeddistributionaltestsforresiduesinlinearregression.
microserviceswhichemitatleastoneerroneouslogandattempt Theabovelinearregressionbasedtestcanalsobedoneinthefre-
toconstructacausalgraphamongtheseimpactedmicroservices. quencydomainusingthetheoryofAuto-regressiveprocesses.The
timedomaintestsandfrequencydomaintestsculminatedinthe
Labellingoflogmessages.Thelogscollectedfromthesystem
MVGCtoolboxquitepopularinneuroscience[2].Theabovetest
areavailableinJSONformatwitheachloghavingabout71fields
canbeextendedtothecasewhenAisamultivariatetimeseries.
includingattributessuchasthenameofthemicroservice,container
Movingawayfromtestingmethods,recentworksemploysparse
id,loglinemessage,andsoon.Weuseadictionarybasedclassifier
linearregressionwithaLASSOpenalty[1,33]oftencalledLasso-
thatlooksforerrorpatternsinvariousfieldssuchaslogleveland
Grangermethods.[16]observedthatlaggedvariablesbelonging
loglinemessages(e.g.‘500InternalServerError’)toaccurately
tothesametimeseriesmustbegroupedtogetherandadvocates
distinguishwhetheralogisnormalorerroneous.Wemanuallyvali-
agrouplassopenaltywithlinearregression.Recently,neuralnet-
datetheaccuracyofourlabelsbycomparingthelogsemittedbefore
worksintheformofLSTMunitsareusedtomodelnon-linearity
andafterthefaultandbyconsideringtheunderlyingmicroservice
inthedataandahierarchicalgrouplassopenaltyisusedalong
architecture(thisisgenerallyunavailableinrealenterpriseenvi-
withanLSTMmodel[29].Althoughtheliteratureonregression
ronments).Asopposedtopriorworkthatusesmachinelearning
basedtechniquesinvast,forourexperimentalcomparisonweuse
techniquestodistinguishanomalouslogs[6,31],weuseadomain
methodsthatconductcausalinferencefromaBayesianperspective:
1https://github.com/FudanSELab/train-ticket BayesianLinear[4]andBayesainlassoregression[17].
189
EvaluationofCausalInferenceTechniquesforAIOps CODSCOMAD2021,January2–4,2021,Bangalore,India
3.2 IndependenceTestingBasedApproaches varioustimebinsinthepast,thatconvergestothetrueGEMfrom
Frominformationtheoryperspective,oneoftheimportantsigna- thisfamilyinasymptoticallimit.Ascorebasedmethodassignsa
turesofGrangercausalityfortimeseriesisthefollowingtest:Time scalarvaluetoagraphstructurewhichisacombinationofalike-
seriesAdoesnotGrangercauseBifforsomesetoftimeseriesZ, lihoodtermandacomplexityterm(relatedtothesparsityofthe
thefollowingquantityiszeroforsomelagp: graph).Thescoremaximizinggraphischosenattheendofafor-
wardbackwardgreedysearchprocedure.However,implementing
(cid:213)T thisscoremethodinpracticeforthegeneralclassofGEMsin[10]
D(A→B|Z)= I(Bt;At−1:t−p|Bt−1:t−p,Zt−1:t−p) (1)
isinfeasibleduetosearchovertimebinningparametersinaddition
t=p
tographsearch.Apracticalmethodwasproposedin[3]wherethe
Here,I(·;·|·)istheconditionalmutualinformationandDissome- authorsmakeasimplifyingproximalassumption(resultingina
timescalleddirectedmutualinformation.IfDfromAtoBgivenZ ProximalGEMdenotedPGEM).Theyassumethattheconditional
iszero,onecandeletethedirectededgebetweenAandB.[7,22] intensityfunctiondependsonlyonindicatorsofeventoccurrences
formalizedthisandshowedthatonecanrecoveraBayesianNet- ofeachoftheparentaleventsinasinglewindow(perparentevent)
work on the time series if the data is generated according to a ofacertainlengthintheimmediatepast.Ascoredbasedmethod
strictlycausalmanner(instantaneousinfluenceisforbidden)andif overonlygraphstructureswasproposedwherethewindowsearch
therearenounobservedlatentvariables(causalsufficiency)under (foreachofthecandidateparentsgivenagraph)wasincorporated
some mildly technical regularity conditions. In practice, with a inthelikelihoodmaximizationinvolvingtheintensityfunctions.
singlerealizationofthetimeseriesandwhenthetimeserieshas Thisdecouplingandsearchingoveronlythegraphsmakesthis
notattainedstationarity,itisnotdirectlypossiblytotestdirected practicalandscalable.Inourexperiments,sincetherawerrorlogs
mutualinformation.Inpractice,theaboveconditionistested[23] arejusteventsequences,weusePGEMsearchproceduretolearn
approximatelyusingofftheshelfconditionalindependence(CI) thegraphstructureofinfluences.
testersthatcheckifI(X;Y|W)is0ornotonasetofi.i.dsamples
Xi,Yi,Wi withsomejointdistribution.Touseit,wesupplyadata
tablewithrowsindexedbyt andthecolumnssubstitutedasfol- 4 EXPERIMENTALRESULTS
lows:Xt =Bt,Yt =At−1:t−p andWt =[Zt−1:t−p,Bt−1:t−p].The Wenowpresentexperimentalevaluationresultsbasedonlogdata
mannerinwhichthetestsoftheformD(A→ B|Z)willbeused collectedfromtheTrainTicketmicroservicesystem.Inorderto
toconstructthegraphishighlyanalogoustothePC[12,24,25] introduceafault,oneofthemicroservicesnamelyts-basicisdeleted
andMMPC[30]algorithmsusedfornontimeseriesbasedcausal fromthesystemwhichresultsin4microservicesemittingerror
structurediscovery.PChastwopopularvariantsappliedtothe logsnamely:ts-ui-dashboard,ts-travel2-service,ts-travel-service,
timeseriescase:a)PCMCIalgorithmin[23]andb)ModifiedPC andts-ticketinfo-service.Wefilterouterrorlogsalongwiththeir
algorithmin[5].MMPCalgorithmfromthei.i.dsettinghasbeen timinginformationtoconstruct(a)timeseriesoferrorcountscor-
adaptedtothetimeseriescasein[20]. respondingtoeachimpactedmicroserviceand(b)atemporalevent
Weuse3i.i.dCItestersnamelyG2,ParCorr(PartialCorrelation
sequence{(ti,li)}whichrecordsthetimeti atwhichmicroserviceli
Test)[23]andRCoT(RandomizedConditionalCorrelationTest) emitsanerrorlog.Atotalof266errorlogswereemitted.Fortime
[27].G2CItestisbasedonG2statistic,ParCorrisafasttestbased
series,weexperimentwith3binsizes:10,100,and1000ms.Weuse
onlinearmodelingassumptions,andRCoTisatesterthatworks the3familiesofGrangercausaldiscoveryalgorithmsdescribed
evenfornonlinearrelationsbasedonKerneltechniques.Weselect inSection3namely:Conditionalindependence(CI)testingbased,
asubsetoftheCItestingalgorithms:PC[12],ModifiedPC(denoted regressionbased,andGEMstoinferthecausaldependenciesamong
PCMod)[5],andMMPC[30]. the4impactedmicroservices.Wecomputeprecision,recall,andF1
scoresforallalgorithmswithrespecttogroundtruth.
3.3 GraphicalEventModels(GEMS) Figure2showsthecausalgraphsinferredbyonevariantofeach
AneventAisarandomsequenceoftimepointswithlabelAona algorithmalongwithgroundtruthinformation.Thegoldcoloured
timeline.Grangercausalityformultipleeventsequences(multiple edgesrepresentamatchwithgroundtruth.Thefalsepositivesor
labeledpointsonacommontimeline)ismodelledbyaGraphi- typeIerrorsaremarkedbyagreyedgeandindicatesuperfluous
calEventModel(GEM).Inthis,asetofeventsismodelledbya causalrelationshipsinferred.ThefalsenegativesortypeIIerrors
multivariateinhomogenousPoissonprocess,whereinstantaneous aremarkedbyadashedgreyedgeandindicatecausalrelationships
intensity(Poissonrate)ofeventAattimet isafunctionofthe thatthealgorithmfailstorecoverfromlogdata.
historyoftheparentaleventsPa(A),i.e.,intensityfunctionattimet Table1documentstheresultsforallalgorithms.Firstlynote
isafunctionofthetimesequenceofoccurrencesofeventtypesin thatusingcorrelationmetricdoesnothelprecoverthetruecausal
Pa(A)beforet.Thetuples(A,Pa(A))formadirectedgraphthatcon- dependencies(row1).Nextweexperimentwith3CItestingalgo-
stitutesthestructureoftheGEM.AnyGEMmodelwithasmooth rithms:PC[12],PCMod[5],andMMPC[30]incombinationwith
conditionalintensityfunctionhasbeenshowntobeapproximated 3CItests:G2,partialcorrelation,andRCoT[26].Weobservethat
byaclassofGEMswheretheconditionalintensityfunctionisa advancedPCvariantsPCModandMMPCyieldbetterresultsin
functionofindicatorseachofwhichindicatesifsomeparentalevent combinationwithlinearCItests(G2andpartialcorrelation)than
occurredinaspecifictimebininthepastornot[10].Theyalso withnonlinearCItestssuchasRCoT.
proposescorebasedmethodtosearchoverallsuchGEMs,whose Weuse2regressionbasedalgorithmstoinfercausaldependen-
intensityfunctionsdependonindicatorsofeventoccurrencesin ciesbetweenmicroservices:BLR(q0)[4]andBLasso(λ)[17].BLR(q0)
190
CODSCOMAD2021,January2–4,2021,Bangalore,India V.Arya,etal.
ts-ui-dashboard ts-travel-service
ts-ui-dashboard
ts-travel2-service ts-travel2-service ts-travel-service
ts-ui-dashboard
ts-travel-service ts-ui-dashboard ts-travel2-service
ts-travel-service ts-travel2-service
ts-ticketinfo-service ts-ticketinfo-service ts-ticketinfo-service
ts-ticketinfo-service
Figure 2: Causal graphs inferred using different Granger methods. (left to right): Ground truth, CI testing based
MMPC(ParCorr, bin=100ms), regression-based BLR(1) with bin=100ms, and event model based PGEM. False +ves (superflu-
ouscausalrelationships)aremarkedbydashedgrayedgesandfalse-ves(missingcausalrelationships)withgrayedges.
wus he es rB ea dye is sia tn helin ne ua mrr be eg rre os fsi to imn ewi st eh rip er sio ar nd dis qtr 0ib iu st uio sn edN t( o0, tq u0 n− e1 tI d he), coM rre et lh ao tid b 1i 0n -( 1m 0s 3) Prec 0ision Re 0call F 01
on
penaltyterminridgeregression.Inourexperiments,theperfor- PC(G2,RCOT) 10 0.43 0.6 0.5
manceofthealgorithmwasnotsensitivetoq0,sowesetq0=1.0. PC(G2,RCOT) 102 0.33 0.4 0.36
BLasso(λ)appliesBayesianLassotolearnthecausalgraph,where PC(G2,RCOT) 103 0.5 0.4 0.44
λ weighstheL1 penaltyterm.Wevaryλ from0.01to1000and PCMod(G2) 10 0.71 1.0 0.83
presenttheaveragecaseresultscorrespondingtoλ = 1.0.Addi- PCMod(G2) 102 1.0 0.6 0.75