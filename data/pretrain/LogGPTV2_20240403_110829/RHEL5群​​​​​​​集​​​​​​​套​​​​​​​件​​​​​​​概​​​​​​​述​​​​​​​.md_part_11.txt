shows a typical three-tier LVS configuration. In the example, the active
LVS router routes the requests from the public network (Internet) to the
second tier --- real servers. Each real server then accesses a shared
data source of a Red Hat cluster in the third tier over the private
network.
:::
::: figure
[⁠]{#ch.gfscs.cluster-overview-CSO.html#gr-lvs-cm-CSO}
::: figure-contents
::: mediaobject
![Three-Tier LVS Topology](images/lvs-three-tier.png)
:::
:::
**图 1.21. Three-Tier LVS Topology**
:::
::: para
这​​​​​​​种​​​​​​​拓​​​​​​​扑​​​​​​​结​​​​​​​构​​​​​​​适​​​​​​​合​​​​​​​于​​​​​​​繁​​​​​​​忙​​​​​​​的​​​​​​​ FTP
服​​​​​​​务​​​​​​​器​​​​​​​，其​​​​​​​可​​​​​​​访​​​​​​​问​​​​​​​的​​​​​​​数​​​​​​​据​​​​​​​存​​​​​​​储​​​​​​​在​​​​​​​中​​​​​​​央​​​​​​​的​​​​​​​、​​​​​​​高​​​​​​​可​​​​​​​用​​​​​​​的​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​上​​​​​​​，而​​​​​​​每​​​​​​​个​​​​​​​真​​​​​​​实​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​都​​​​​​​通​​​​​​​过​​​​​​​导​​​​​​​出​​​​​​​的​​​​​​​
NFS 目​​​​​​​录​​​​​​​或​​​​​​​ Samba
共​​​​​​​享​​​​​​​访​​​​​​​问​​​​​​​该​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​。​​​​​​​我​​​​​​​们​​​​​​​也​​​​​​​推​​​​​​​荐​​​​​​​在​​​​​​​访​​​​​​​问​​​​​​​用​​​​​​​于​​​​​​​事​​​​​​​务​​​​​​​的​​​​​​​中​​​​​​​央​​​​​​​的​​​​​​​、​​​​​​​高​​​​​​​可​​​​​​​用​​​​​​​性​​​​​​​的​​​​​​​数​​​​​​​据​​​​​​​库​​​​​​​的​​​​​​​网​​​​​​​站​​​​​​​上​​​​​​​应​​​​​​​用​​​​​​​这​​​​​​​种​​​​​​​拓​​​​​​​扑​​​​​​​结​​​​​​​构​​​​​​​。​​​​​​​此​​​​​​​外​​​​​​​，在​​​​​​​
Red Hat 群​​​​​​​集​​​​​​​中​​​​​​​使​​​​​​​用​​​​​​​ active-active
配​​​​​​​置​​​​​​​，您​​​​​​​可​​​​​​​以​​​​​​​配​​​​​​​置​​​​​​​高​​​​​​​可​​​​​​​用​​​​​​​性​​​​​​​的​​​​​​​群​​​​​​​集​​​​​​​来​​​​​​​同​​​​​​​时​​​​​​​行​​​​​​​使​​​​​​​这​​​​​​​个​​​​​​​两​​​​​​​种​​​​​​​功​​​​​​​能​​​​​​​。​​​​​​​
:::
:::
::: section
::: titlepage
## [⁠]{#ch.gfscs.cluster-overview-CSO.html#s2-lvs-routing-CSO}1.8.3. 路​​​​​​​由​​​​​​​方​​​​​​​法​​​​​​​ {.title}
:::
[]{#ch.gfscs.cluster-overview-CSO.html#idm139688985123760
.indexterm}[]{#ch.gfscs.cluster-overview-CSO.html#idm139688985121840
.indexterm}[]{#ch.gfscs.cluster-overview-CSO.html#idm139688985120432
.indexterm}
::: para
您​​​​​​​可​​​​​​​以​​​​​​​在​​​​​​​ LVS 里​​​​​​​使​​​​​​​用​​​​​​​网​​​​​​​络​​​​​​​地​​​​​​​址​​​​​​​转​​​​​​​换​​​​​​​（Network Address
Translation，NAT）或​​​​​​​直​​​​​​​接​​​​​​​路​​​​​​​由​​​​​​​。​​​​​​​下​​​​​​​面​​​​​​​的​​​​​​​内​​​​​​​容​​​​​​​简​​​​​​​单​​​​​​​地​​​​​​​描​​​​​​​述​​​​​​​了​​​​​​​在​​​​​​​ LVS 里​​​​​​​使​​​​​​​用​​​​​​​ NAT
路​​​​​​​由​​​​​​​和​​​​​​​直​​​​​​​接​​​​​​​路​​​​​​​由​​​​​​​。​​​​​​​
:::
::: section
::: titlepage
### [⁠]{#ch.gfscs.cluster-overview-CSO.html#s3-lvs-nat-CSO}1.8.3.1. NAT 路​​​​​​​由​​​​​​​ {.title}
:::
::: para
[图 1.22 "LVS Implemented with NAT
Routing"](#ch.gfscs.cluster-overview-CSO.html#gr-lvs-nat-CSO){.xref},
illustrates LVS using NAT routing to move requests between the Internet
and a private network.
:::
::: figure
[⁠]{#ch.gfscs.cluster-overview-CSO.html#gr-lvs-nat-CSO}
::: figure-contents
::: mediaobject
![LVS Implemented with NAT Routing](images/lvs-nat-routing.png)
:::
:::
**图 1.22. LVS Implemented with NAT Routing**
:::
::: para
在​​​​​​​这​​​​​​​个​​​​​​​例​​​​​​​子​​​​​​​中​​​​​​​，活​​​​​​​跃​​​​​​​ LVS 路​​​​​​​由​​​​​​​器​​​​​​​装​​​​​​​有​​​​​​​两​​​​​​​块​​​​​​​网​​​​​​​络​​​​​​​接​​​​​​​口​​​​​​​卡​​​​​​​（NIC）。​​​​​​​Internet 使​​​​​​​用​​​​​​​的​​​​​​​
NIC 在​​​​​​​ eth0 上​​​​​​​有​​​​​​​一​​​​​​​个​​​​​​​*真​​​​​​​实​​​​​​​的​​​​​​​ IP 地​​​​​​​址​​​​​​​*，它​​​​​​​也​​​​​​​有​​​​​​​一​​​​​​​个​​​​​​​别​​​​​​​名​​​​​​​为​​​​​​​ eth0:1 的​​​​​​​浮​​​​​​​动​​​​​​​ IP
地​​​​​​​址​​​​​​​。​​​​​​​专​​​​​​​用​​​​​​​网​​​​​​​络​​​​​​​接​​​​​​​口​​​​​​​的​​​​​​​ NIC 在​​​​​​​ eth1 上​​​​​​​有​​​​​​​一​​​​​​​个​​​​​​​真​​​​​​​实​​​​​​​的​​​​​​​ IP 地​​​​​​​址​​​​​​​以​​​​​​​及​​​​​​​别​​​​​​​名​​​​​​​为​​​​​​​ eth1:1
的​​​​​​​浮​​​​​​​动​​​​​​​ IP 地​​​​​​​址​​​​​​​。​​​​​​​在​​​​​​​故​​​​​​​障​​​​​​​切​​​​​​​换​​​​​​​发​​​​​​​生​​​​​​​时​​​​​​​，面​​​​​​​向​​​​​​​ Internet
的​​​​​​​虚​​​​​​​拟​​​​​​​接​​​​​​​口​​​​​​​以​​​​​​​及​​​​​​​专​​​​​​​用​​​​​​​虚​​​​​​​拟​​​​​​​接​​​​​​​口​​​​​​​由​​​​​​​备​​​​​​​份​​​​​​​ LVS
路​​​​​​​由​​​​​​​器​​​​​​​同​​​​​​​时​​​​​​​接​​​​​​​管​​​​​​​。​​​​​​​专​​​​​​​用​​​​​​​网​​​​​​​络​​​​​​​中​​​​​​​的​​​​​​​所​​​​​​​有​​​​​​​真​​​​​​​实​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​都​​​​​​​使​​​​​​​用​​​​​​​用​​​​​​​于​​​​​​​ NAT 路​​​​​​​由​​​​​​​器​​​​​​​的​​​​​​​浮​​​​​​​动​​​​​​​ IP
地​​​​​​​址​​​​​​​来​​​​​​​作​​​​​​​为​​​​​​​与​​​​​​​活​​​​​​​跃​​​​​​​ LVS 路​​​​​​​由​​​​​​​器​​​​​​​通​​​​​​​信​​​​​​​的​​​​​​​默​​​​​​​认​​​​​​​路​​​​​​​由​​​​​​​，这​​​​​​​样​​​​​​​它​​​​​​​们​​​​​​​响​​​​​​​应​​​​​​​来​​​​​​​自​​​​​​​ Internet
的​​​​​​​请​​​​​​​求​​​​​​​的​​​​​​​能​​​​​​​力​​​​​​​就​​​​​​​不​​​​​​​会​​​​​​​被​​​​​​​削​​​​​​​弱​​​​​​​。​​​​​​​
:::
::: para
In the example, the LVS router\'s public LVS floating IP address and
private NAT floating IP address are aliased to two physical NICs. While
it is possible to associate each floating IP address to its physical
device on the LVS router nodes, having more than two NICs is not a
requirement.
:::
::: para
使​​​​​​​用​​​​​​​这​​​​​​​种​​​​​​​拓​​​​​​​扑​​​​​​​结​​​​​​​构​​​​​​​，活​​​​​​​动​​​​​​​的​​​​​​​ LVS
路​​​​​​​由​​​​​​​器​​​​​​​接​​​​​​​收​​​​​​​请​​​​​​​求​​​​​​​并​​​​​​​将​​​​​​​其​​​​​​​发​​​​​​​送​​​​​​​到​​​​​​​合​​​​​​​适​​​​​​​的​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​上​​​​​​​。​​​​​​​让​​​​​​​后​​​​​​​真​​​​​​​实​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​处​​​​​​​理​​​​​​​这​​​​​​​个​​​​​​​请​​​​​​​求​​​​​​​并​​​​​​​将​​​​​​​数​​​​​​​据​​​​​​​包​​​​​​​返​​​​​​​回​​​​​​​给​​​​​​​
LVS 路​​​​​​​由​​​​​​​器​​​​​​​。​​​​​​​LVS 路​​​​​​​由​​​​​​​器​​​​​​​使​​​​​​​网​​​​​​​络​​​​​​​地​​​​​​​址​​​​​​​转​​​​​​​换​​​​​​​来​​​​​​​代​​​​​​​替​​​​​​​带​​​​​​​有​​​​​​​ LVS 路​​​​​​​由​​​​​​​器​​​​​​​挂​​​​​​​公​​​​​​​用​​​​​​​ VIP
地​​​​​​​址​​​​​​​的​​​​​​​数​​​​​​​据​​​​​​​包​​​​​​​里​​​​​​​的​​​​​​​真​​​​​​​实​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​。​​​​​​​因​​​​​​​为​​​​​​​对​​​​​​​客​​​​​​​户​​​​​​​隐​​​​​​​藏​​​​​​​了​​​​​​​事​​​​​​​实​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​的​​​​​​​真​​​​​​​正​​​​​​​的​​​​​​​ IP
地​​​​​​​址​​​​​​​，所​​​​​​​以​​​​​​​这​​​​​​​个​​​​​​​过​​​​​​​程​​​​​​​被​​​​​​​称​​​​​​​作​​​​​​​ *IP 伪​​​​​​​装​​​​​​​（masquerading）*。​​​​​​​
:::
::: para
使​​​​​​​用​​​​​​​ NAT 路​​​​​​​由​​​​​​​，真​​​​​​​实​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​可​​​​​​​以​​​​​​​是​​​​​​​运​​​​​​​行​​​​​​​不​​​​​​​同​​​​​​​操​​​​​​​作​​​​​​​系​​​​​​​统​​​​​​​的​​​​​​​任​​​​​​​何​​​​​​​类​​​​​​​型​​​​​​​的​​​​​​​机​​​​​​​器​​​​​​​。​​​​​​​NAT
的​​​​​​​主​​​​​​​要​​​​​​​缺​​​​​​​点​​​​​​​是​​​​​​​ LVS
路​​​​​​​由​​​​​​​器​​​​​​​可​​​​​​​能​​​​​​​成​​​​​​​为​​​​​​​大​​​​​​​型​​​​​​​部​​​​​​​署​​​​​​​中​​​​​​​的​​​​​​​瓶​​​​​​​颈​​​​​​​，因​​​​​​​为​​​​​​​它​​​​​​​既​​​​​​​得​​​​​​​处​​​​​​​理​​​​​​​转​​​​​​​入​​​​​​​又​​​​​​​得​​​​​​​处​​​​​​​理​​​​​​​转​​​​​​​出​​​​​​​的​​​​​​​请​​​​​​​求​​​​​​​。​​​​​​​
:::
:::
::: section
::: titlepage
### [⁠]{#ch.gfscs.cluster-overview-CSO.html#s3-lvs-directrouting-CSO}1.8.3.2. 直​​​​​​​接​​​​​​​路​​​​​​​由​​​​​​​ {.title}
:::
[]{#ch.gfscs.cluster-overview-CSO.html#idm139688982695536
.indexterm}[]{#ch.gfscs.cluster-overview-CSO.html#idm139688982693616
.indexterm}[]{#ch.gfscs.cluster-overview-CSO.html#idm139688982691696
.indexterm}
::: para
和​​​​​​​ NAT
相​​​​​​​比​​​​​​​，直​​​​​​​接​​​​​​​路​​​​​​​由​​​​​​​可​​​​​​​以​​​​​​​提​​​​​​​供​​​​​​​增​​​​​​​强​​​​​​​的​​​​​​​性​​​​​​​能​​​​​​​。​​​​​​​直​​​​​​​接​​​​​​​路​​​​​​​由​​​​​​​允​​​​​​​许​​​​​​​真​​​​​​​实​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​处​​​​​​​理​​​​​​​和​​​​​​​直​​​​​​​接​​​​​​​发​​​​​​​送​​​​​​​数​​​​​​​据​​​​​​​包​​​​​​​给​​​​​​​请​​​​​​​求​​​​​​​用​​​​​​​户​​​​​​​而​​​​​​​不​​​​​​​是​​​​​​​通​​​​​​​过​​​​​​​
LVS 路​​​​​​​由​​​​​​​器​​​​​​​传​​​​​​​送​​​​​​​转​​​​​​​出​​​​​​​数​​​​​​​据​​​​​​​包​​​​​​​。​​​​​​​让​​​​​​​ LVS
路​​​​​​​由​​​​​​​器​​​​​​​只​​​​​​​处​​​​​​​理​​​​​​​转​​​​​​​入​​​​​​​的​​​​​​​数​​​​​​​据​​​​​​​包​​​​​​​，直​​​​​​​接​​​​​​​路​​​​​​​由​​​​​​​降​​​​​​​低​​​​​​​了​​​​​​​网​​​​​​​络​​​​​​​性​​​​​​​能​​​​​​​出​​​​​​​现​​​​​​​问​​​​​​​题​​​​​​​的​​​​​​​可​​​​​​​能​​​​​​​性​​​​​​​。​​​​​​​
:::
::: figure
[⁠]{#ch.gfscs.cluster-overview-CSO.html#gr-lvs-dr-CSO}
::: figure-contents
::: mediaobject
![LVS Implemented with Direct Routing](images/lvs-direct-routing.png)
:::
:::
**图 1.23. LVS Implemented with Direct Routing**
:::
::: para
在​​​​​​​典​​​​​​​型​​​​​​​的​​​​​​​直​​​​​​​接​​​​​​​路​​​​​​​由​​​​​​​ LVS 配​​​​​​​置​​​​​​​里​​​​​​​，LVS 路​​​​​​​由​​​​​​​器​​​​​​​通​​​​​​​过​​​​​​​虚​​​​​​​拟​​​​​​​
IP（VIP）接​​​​​​​收​​​​​​​转​​​​​​​入​​​​​​​的​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​请​​​​​​​求​​​​​​​并​​​​​​​使​​​​​​​用​​​​​​​一​​​​​​​个​​​​​​​调​​​​​​​度​​​​​​​算​​​​​​​法​​​​​​​来​​​​​​​将​​​​​​​请​​​​​​​求​​​​​​​发​​​​​​​送​​​​​​​到​​​​​​​真​​​​​​​实​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​上​​​​​​​。​​​​​​​每​​​​​​​个​​​​​​​真​​​​​​​实​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​都​​​​​​​处​​​​​​​理​​​​​​​请​​​​​​​求​​​​​​​，并​​​​​​​将​​​​​​​响​​​​​​​应​​​​​​​直​​​​​​​接​​​​​​​发​​​​​​​送​​​​​​​给​​​​​​​客​​​​​​​户​​​​​​​而​​​​​​​不​​​​​​​通​​​​​​​过​​​​​​​
LVS 路​​​​​​​由​​​​​​​器​​​​​​​。​​​​​​​直​​​​​​​接​​​​​​​路​​​​​​​由​​​​​​​提​​​​​​​供​​​​​​​了​​​​​​​可​​​​​​​伸​​​​​​​缩​​​​​​​性​​​​​​​，因​​​​​​​为​​​​​​​可​​​​​​​以​​​​​​​添​​​​​​​加​​​​​​​真​​​​​​​实​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​而​​​​​​​不​​​​​​​增​​​​​​​加​​​​​​​ LVS
路​​​​​​​由​​​​​​​器​​​​​​​将​​​​​​​转​​​​​​​出​​​​​​​数​​​​​​​据​​​​​​​包​​​​​​​从​​​​​​​真​​​​​​​实​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​发​​​​​​​送​​​​​​​给​​​​​​​客​​​​​​​户​​​​​​​的​​​​​​​负​​​​​​​担​​​​​​​，而​​​​​​​这​​​​​​​在​​​​​​​网​​​​​​​络​​​​​​​负​​​​​​​载​​​​​​​很​​​​​​​重​​​​​​​时​​​​​​​可​​​​​​​能​​​​​​​是​​​​​​​瓶​​​​​​​颈​​​​​​​。​​​​​​​
:::
::: para
虽​​​​​​​然​​​​​​​在​​​​​​​ LVS
里​​​​​​​使​​​​​​​用​​​​​​​直​​​​​​​接​​​​​​​路​​​​​​​由​​​​​​​有​​​​​​​很​​​​​​​多​​​​​​​优​​​​​​​点​​​​​​​，但​​​​​​​它​​​​​​​也​​​​​​​有​​​​​​​缺​​​​​​​陷​​​​​​​。​​​​​​​直​​​​​​​接​​​​​​​路​​​​​​​由​​​​​​​最​​​​​​​常​​​​​​​见​​​​​​​的​​​​​​​问​​​​​​​题​​​​​​​是​​​​​​​和​​​​​​​
*地​​​​​​​址​​​​​​​解​​​​​​​析​​​​​​​协​​​​​​​议​​​​​​​（Address Resolution
Protocol）*（``{=html}ARP``{=html}）相​​​​​​​关​​​​​​​的​​​​​​​。​​​​​​​
:::
::: para
In typical situations, a client on the Internet sends a request to an IP
address. Network routers typically send requests to their destination by
relating IP addresses to a machine\'s MAC address with ARP. ARP requests
are broadcast to all connected machines on a network, and the machine
with the correct IP/MAC address combination receives the packet. The
IP/MAC associations are stored in an ARP cache, which is cleared