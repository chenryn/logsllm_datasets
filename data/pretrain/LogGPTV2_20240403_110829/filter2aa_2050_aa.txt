微软AD如何定位域控
我在本地搭建了⼀个域
DC
192.168.1.200
名字为DCSERVER
client
192.168.1.151
DNS
loca.test.com
在搭建完域之后，先把域控启动后再启动客户机的机器的时候抓了⼀下包
在3-6条
 1.client请求DNS服务器的ldap.tcp.dc._msdcs.loca.test.com的SRV记录
 2.DNS服务器返回SRV⾥记录的服务、端⼝、 A记录。（192.168.1.200：389）
 3.client拿到SRV⾥的值以后发送解析A记录的请求
 4.DNS服务器返回了解析的域名+IP地址
第1.2步是从DNS SRV⾥拿数据
第3.4步是把拿到的srv的数据解析为IP
在拿到srv的记录后⾥⾯存储的是域名和端⼝，在进⾏余下的操作的时候，是要解析为IP地址再进⾏通信的。
以下为MS⽂档中对SRV记录在AD中的作⽤
 SRV记录：DNS中的⼀种信息记录，它将服务的名称映射到域名系统名字提供该服务的服务器的。域控制器
（DC）的宣传是其由DNS SRV记录实现的此功能。在DNS服务器⾥则⼊下图所设置
在拿到DNS⾥的SRV记录后，还会在发送⼀个UDP的数据包（7），这个包在wireshark中标记为CLDAP。LDAP 
ping 在Microsoft Active Directory⽹络中最常⻅，其中客户端使⽤LDAP或CLDAP进⾏LDAP ping来检索服务
器信息。 
在理解LDAP  PING之前，先看⼀下前置知识
LDAP服务器提供有关⾃身的信息以及特定于每个服务器的其他信息，例如它的功能、它⽀持的 LDAP 版本以及它
使⽤的命名上下⽂。存储这些信息的是rootDSE 为⽬录服务器上⽬录数据树的根。rootDSE 不是任何命名空间的
⼀部分。rootDSE 的⽬的是提供有关⽬录服务器的数据。这些信息不经过身份验证即可访问，只读。存储的所有信
息如下。
A --> Windows 2000
D --> Windows Server 2003 operating system
DR2 --> Windows Server 2003 R2 operating system
G --> ADAM
K --> Windows Server 2008 operating system AD DS
L --> Windows Server 2008 AD LDS
N --> Windows Server 2008 R2 operating system AD DS
P --> Windows Server 2008 R2 AD LDS
S --> Windows Server 2012 operating system AD DS
T --> Windows Server 2012 AD LDS
V --> Windows Server 2012 R2 operating system AD DS
W --> Windows Server 2012 R2 AD LDS
Y --> Windows Server 2016 operating system AD DS
Z --> Windows Server 2016 AD LDS
B2 --> Windows Server v1709 operating system AD DS
C2 --> Windows Server v1709 AD LDS
E2 --> Windows Server v1803 operating system AD DS
F2 --> Windows Server v1803 AD LDS
H2 --> Windows Server v1809 operating system AD DS
I2 --> Windows Server v1809 AD LDS
K2 --> Windows Server 2019 operating system AD DS
Attribute name
A
D, DR2
G
K, N
L, P
S
T
V
W
Y
Z
B2
C2
E2, H2, K2
F2, I2, L2
configurationNamingContext
X
X
X
X
X
X
X
X
X
X
X
X
X
X
X
currentTime
X
X
X
X
X
X
X
X
X
X
X
X
X
X
X
defaultNamingContext
X
X
X
X
X
X
X
X
X
X
X
X
X
X
X
dNSHostName
X
X
X
X
X
X
X
X
X
X
X
X
X
X
X
dsSchemaAttrCount
X
X
X
X
X
X
X
X
X
X
X
X
X
X
X
dsSchemaClassCount
X
X
X
X
X
X
X
X
X
X
X
X
X
X
X
dsSchemaPrefixCount
X
X
X
X
X
X
X
X
X
X
X
X
X
X
X
dsServiceName
X
X
X
X
X
X
X
X
X
X
X
X
X
X
X
highestCommittedUSN
X
X
X
X
X
X
X
X
X
X
X
X
X
X
X
isGlobalCatalogReady
X
X
X
X
X
X
X
X
isSynchronized
X
X
X
X
X
X
X
X
X
X
X
X
X
X
X
ldapServiceName
X
X
X
X
X
X
X
X
namingContexts
X
X
X
X
X
X
X
X
X
X
X
X
X
X
X
netlogon
X
X
X
X
X
X
X
X
pendingPropagations
X
X
X
X
X
X
X
X
X
X
X
X
X
X
X
rootDomainNamingContext
X
X
X
X
X
X
X
X
schemaNamingContext
X
X
X
X
X
X
X
X
X
X
X
X
X
X
X
serverName
X
X
X
X
X
X
X
X
X
X
X
X
X
X
X
subschemaSubentry
X
X
X
X
X
X
X
X
X
X
X
X
X
X
X
supportedCapabilities
X
X
X
X
X
X
X
X
X
X
X
X
X
X
X
supportedControl
X
X
X
X
X
X
X
X
X
X
X
X
X
X
X
supportedLDAPPolicies
X
X
X
X
X
X
X
X
X
X
X
X
X
X
X
L2 --> Windows Server 2019 AD LDS
supportedLDAPVersion
X
X
X
X
X
X
X
X
X
X
X
X
X
X
X
supportedSASLMechanisms
X
X
X
X
X
X
X
X
X
X
X
X
X
X
X
domainControllerFunctionality
X
X
X
X
X
X
X
X
X
X
X
X
X
X
domainFunctionality
X
X
X
X
X