title:VIRL: the virtual internet routing lab
author:Joel Obstfeld and
Simon Knight and
Ed Kern and
Qiang Sheng Wang and
Tom Bryan and
Dan Bourque
VIRL – Virtual Internet Routing Lab
Personal Edition
Beau Williamson
CCIE R&S 1346 Emeritus
T-Mobile
VIRL-rev14.pptx
Housekeeping
Please turn off all Cell Phones and (and for 
the Dinosaurs in the room) Pagers!
WARNING: This session is being recorded via 
the super sensitive overhead mics in the 
room!  Please avoid side conversations. 
(Anything you say will be used against you 
on social media.)
VIRL-rev14.pptx
2
Acknowledgements
A big thanks to Joel Obstfeld and Alejandro Gallego
from the Cisco VIRL team who helped answer my many
questions and assisted with putting this presentation
together1.
1Some of the slides in this presentation are courtesy of Cisco.
VIRL-rev14.pptx
3
Opening Statements
• I am not an Expert on VIRL.
– You may ask me questions at any time but . . .
• There are no bonus points for “stumping” the presenter.
– Other people here my have more experience with VIRL.
• If so, please speak up.
• We want to benefit from your knowledge.
VIRL-rev14.pptx
4
Agenda
• What is VIRL?
• VIRL Architecture
• VIRL Components
• VIRL Installation
• VIRL Basics
• AutoNetkit
• Layer-2 Switching
• VIRL Advanced Features
VIRL-rev14.pptx
5
What is VIRL
• Up to 30 Cisco virtual machines in a box
– Runs same OS as Cisco’s physical routers and switches
• IOS, IOS-XR, IOS-XE NX-OS1, IOS L2 Switching, ASA
• Powerful GUI for network design and simulation control
• Auto-Netkit Configuration engine 
– Can build complete Cisco configuration automatically
• IPv4/v6 Addressing, OSPF Areas, BGP ASN, etc.
• Connectivity to outside Physical Networks
– Requires extra physical Network ports (NICs) on VIRL server
• Portability/Repeatability
1 Titanium Release – No VPC, etc.
VIRL-rev14.pptx
6
Agenda
• What is VIRL?
• VIRL Architecture 
• VIRL Components
• VIRL Installation
• VIRL Basics
• AutoNetkit
• Layer-2 Switching
• VIRL Advanced Features
VIRL-rev14.pptx
7
VIRL Architecture – Virtual OS
IOS XR
NX-OS
IOS XE
IOS
Servers
Virtualized 
in 
IOS XRv
Virtualized 
in NX-OSv
Virtualized in 
CSR1000v
Virtualized 
in IOSv and 
IOSvL2
Ubuntu, Cirros, 
3rd party Virtual 
Machines
Virtual Machines run the operating system but are NOT representations of a 
particular hardware platform – no fans, no switch fabric, no ASIC models 
VIRL-rev14.pptx
Courtesy of Cisco Systems
8
VIRL Architecture – Virtual OS
IOS XR
NX-OS
IOS XE
IOS
Servers
Virtualized 
in 
IOS XRv
Virtualized 
in NX-OSv
Virtualized in 
CSR1000v
Virtualized 
in IOSv and 
IOSvL2
Ubuntu, Cirros, 
3rd party Virtual 
Machines
• Same Control-plane code
• Same Management plane code
• Same memory footprint
• Different CPU performance
• Different Forwarding plane code
• No ASIC emulation
VIRL-rev14.pptx
Courtesy of Cisco Systems
9
Nested Virtualization
• Virtualized devices (CPU, I/O, 
memory) enable a single host 
to support many virtual 
machines
• KVM / QEMU provides a 
kernel-based Hypervisor / 
host-virtualization facility
• Ubuntu provides the basic 
host operating system
• Intel VT-x / AMD-V capable 
CPUs expose hardware-
virtualization functions to 
Ubuntu / KVM
/
QEMU
Virtual Machines
HyperVisor
Host O/S
Physical Host
VIRL-rev14.pptx
Courtesy of Cisco Systems
10
Built on OpenStack
Nova
(Compute Services)
Swift
(Object 
Services)
Cinder
(Block 
Storage 
Services)
Neutron
(Networking Services)
A
P
I
s
/
C
L
I
Keystone (Identity Services)
Glance (Image / Repository Services)
H
o
r
i
z
o
n
(
D
a
s
h
b
o
a
r
d
)
IaaS / cloud orchestration software – creates, manages, and deletes virtual 
resources according to API- or CLI-based instructions 
VIRL-rev14.pptx
Courtesy of Cisco Systems
11
VIRL OVA Delivery
VIRL-rev14.pptx
Courtesy of Cisco Systems
12
VIRL ISO Delivery
VIRL-rev14.pptx
Courtesy of Cisco Systems
13
Agenda
• What is VIRL?
• VIRL Architecture 
• VIRL Components
• VIRL Installation
• VIRL Basics
• AutoNetkit
• Layer-2 Switching
• VIRL Advanced Features
VIRL-rev14.pptx
14
VIRL Components (ESXi Version)
Browser
VM Maestro
Your Laptop
VIRL VM
virl.0.x.yyy.esxi.ova
(Custom Ubuntu OVA)
ESXi Host IP Address
VIRL Server
IP Address
Internet
TCP Ports 4505 & 4506
Every 7 Days
VIRL UWM
VIRL STD
VMWare ESXi1
1 Not supported on Oracle VirtualBox
VIRL Server
Min HW Requirements
• Quad Core 
 Intel Processor only
• 8 Gig Ram
• 70 Gig Datastore
VIRL-rev14.pptx
15
VIRL Components (Workstation 12.0 Player Version)
Browser
VM Maestro
Your Laptop
Min HW Requirements
• Quad Core 
• 8 Gig Ram
• 70 Gig Datastore
VIRL VM
virl.0.x.yyy.pc.ova
(Custom Ubuntu OVA)
VIRL Server
IP Address
Internet
TCP Ports 4505 & 4506
Every 7 Days
VIRL UWM
VIRL STD
VMWare Workstation 12.0 Player1
1 Not supported on Oracle VirtualBox
VIRL-rev14.pptx
16
Agenda
• What is VIRL?
• VIRL Architecture
• VIRL Components
• VIRL Installation
• VIRL Basics
• AutoNetkit
• Layer-2 Switching
• VIRL Advanced Features
VIRL-rev14.pptx
17
VIRL Installation
Install ESXi or VMWare Workstation Player
1. Purchase VIRL
2.
3. Create VIRL NW Port-Groups (Optional)
4. Deploy the VIRL OVA
5. Adjust VIRL VM Resources (Optional)
6. Configure Static IP (Optional)
7. Configure Internet Proxies (Optional)
8. Prepare VIRL for Activation (Optional)
9. Activate VIRL
10. Customize VIRL Config (Optional)
11. Validate VIRL Installation (Optional)
12. Install and Configure VM Maestro
VIRL-rev14.pptx
18
Step 1: Obtain VIRL
• Hardware Requirements
– Four CPU cores 
– Min. 8GB of DRAM that can be allocated to the VIRL VM 
• Recommendations: 12GB(for 20 nodes) or 15GB(for 30 nodes)]
– Host system must be able to access the Internet on a regular basis 
• TCP ports 4505 & 4506 outbound enabled
– Used for License Verification at least every 7 days
– Virtualization Extensions present 
• Intel VT-x / EPT or 
• AMD-V / RVI (VMWare Workstation 12.0 Player only)
• Enabled in the BIOS
– 70GB of free disk space for installation
VIRL-rev14.pptx
19
Step 1: Obtain VIRL
• Visit the “GetVIRL” Web site http://virl.cisco.com/getvirl/
• Pricing (as of today)
– Personal Edition 20 nodes - $199.99/yr
– Personal Edition 30 nodes - $299.99/yr
– Academic Edition 20 nodes - $79.99/yr
• Limited to faculty, staff and students of any public or private K-12 
institution or Higher Education institution.
• Once purchased you will receive email with:
– Download links for software (~5.4Gig), license key file & Hash
• Links good for 3 days.  
• Verify download using MD5 Hash
VIRL-rev14.pptx
20
Step 2: Install VMare on target machine
• VMWare ESXi, VM Workstation 12.0 Player
– ESXi Versions
• ESXi 5.1U2 (Build 1483097)
• ESXi 5.5U1 (Build 1623387)
• ESXi 6.0 (Build 2494585)
– Oracle VirtualBox not supported
• “Some” VMWare experience is assumed.
– If no experience, install VM Workstation 12.0 Player
• Experiment with creating/configuring/managing Virtual Machines
• Don’t Panic!!! 
– It’s really fairly easy and you need to learn this stuff anyway.
VIRL-rev14.pptx
21
Step 3: Create VIRL Network Port-Groups
VIRL-rev14.pptx
22
Step 3: Create VIRL Network Port-Groups
• See it done
http://virl-dev-innovate.cisco.com/video.lb/vdbplayer.swf?volume=100&url=video/client.networking.mp4
VIRL-rev14.pptx
23
Step 4: Deploy the VIRL OVA
VIRL-rev14.pptx
24
Step 4: Deploy the VIRL OVA
VIRL-rev14.pptx
25
Step 5: Adjust VIRL VM Resources (Optional)
• Navigate to VM manifest in 
vSphere Client.
• Right-click on the VIRL VM 
• Select 'Edit Settings'.
• Adjust memory
• Adjust number of vCPUs
VIRL-rev14.pptx
26
Step 5: Adjust VIRL VM Resources (Optional)
• Adjust number of vCPUs
VIRL-rev14.pptx
27
Step 5: Adjust VIRL VM Resources (Optional)
• Select 'Resources' tab.
• Select 'Memory' from 
settings list.
• Enable 'Reserve all guest 
memory (All locked)'.
VIRL-rev14.pptx
28
Step 6: Configure Static IP (Optional)
• Connect to VM Console
• Double-click xterm
• Edit Interface
sudo nano /etc/network/interfaces
iface eth0 inet static
address n.n.n.n
netmask mmm.mmm.mmm.mmm
gateway g.g.g.g
dns-nameservers a.a.a.a b.b.b.b
• Exit xterm & reboot
Control-X, Enter ‘Y’ to save.
sudo reboot now
VIRL-rev14.pptx
29
Step 7: Configure Internet Proxies (Optional)
• Only if deployed where proxies are in use
– Use xterm on VM console to edit “.bashrc” & “apt.conf”
• Requires knowledge of your site-specific proxy parameters.
– See Step 7 instructions on VIRL Web page for details
http://virl-dev-innovate.cisco.com/client.php
Example “.bashrc” changes:
export http_proxy=http://proxy.domain.tld:port/
export https_proxy=http://proxy.domain.tld:port/
export HTTP_PROXY=$http_proxy
export HTTPS_PROXY=$https_proxy
Example “.apt-conf” changes:
Acquire::http::proxy "proxy.domain. ld:port/"
VIRL-rev14.pptx
30
Step 8: Prepare VIRL for Activation (Optional)
• Login to VIRL VM Console via VSphere
• Launch xterm
• Perform following steps per Web page instructions:
http://virl-dev-innovate.cisco.com/client.php
– Reset SSH server’s RSA key
• If not installing from OVA
– Confirm “KVM acceleration” can be used
– Confirm Internet connectivity
– Confirm NTP Peering is established
• Debug and correct if not. (Instructions are provided on Web page)