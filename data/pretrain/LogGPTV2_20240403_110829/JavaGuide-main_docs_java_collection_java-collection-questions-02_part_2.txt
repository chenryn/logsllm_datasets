    // constant multiples at each bit position have a bounded
    // number of collisions (approximately 8 at default load factor).
    h ^= (h >>> 20) ^ (h >>> 12);
    return h ^ (h >>> 7) ^ (h >>> 4);
}
```
ç›¸æ¯”äºŽ JDK1.8 çš„ hash æ–¹æ³• ï¼ŒJDK 1.7 çš„ hash æ–¹æ³•çš„æ€§èƒ½ä¼šç¨å·®ä¸€ç‚¹ç‚¹ï¼Œå› ä¸ºæ¯•ç«Ÿæ‰°åŠ¨äº† 4 æ¬¡ã€‚
æ‰€è°“ **â€œæ‹‰é“¾æ³•â€** å°±æ˜¯ï¼šå°†é“¾è¡¨å’Œæ•°ç»„ç›¸ç»“åˆã€‚ä¹Ÿå°±æ˜¯è¯´åˆ›å»ºä¸€ä¸ªé“¾è¡¨æ•°ç»„ï¼Œæ•°ç»„ä¸­æ¯ä¸€æ ¼å°±æ˜¯ä¸€ä¸ªé“¾è¡¨ã€‚è‹¥é‡åˆ°å“ˆå¸Œå†²çªï¼Œåˆ™å°†å†²çªçš„å€¼åŠ åˆ°é“¾è¡¨ä¸­å³å¯ã€‚
![jdk1.8 ä¹‹å‰çš„å†…éƒ¨ç»“æž„-HashMap](https://oss.javaguide.cn/github/javaguide/java/collection/jdk1.7_hashmap.png)
#### JDK1.8 ä¹‹åŽ
ç›¸æ¯”äºŽä¹‹å‰çš„ç‰ˆæœ¬ï¼Œ JDK1.8 ä¹‹åŽåœ¨è§£å†³å“ˆå¸Œå†²çªæ—¶æœ‰äº†è¾ƒå¤§çš„å˜åŒ–ï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äºŽé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º 8ï¼‰ï¼ˆå°†é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘å‰ä¼šåˆ¤æ–­ï¼Œå¦‚æžœå½“å‰æ•°ç»„çš„é•¿åº¦å°äºŽ 64ï¼Œé‚£ä¹ˆä¼šé€‰æ‹©å…ˆè¿›è¡Œæ•°ç»„æ‰©å®¹ï¼Œè€Œä¸æ˜¯è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼‰æ—¶ï¼Œå°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´ã€‚
![jdk1.8ä¹‹åŽçš„å†…éƒ¨ç»“æž„-HashMap](https://oss.javaguide.cn/github/javaguide/java/collection/jdk1.8_hashmap.png)
> TreeMapã€TreeSet ä»¥åŠ JDK1.8 ä¹‹åŽçš„ HashMap åº•å±‚éƒ½ç”¨åˆ°äº†çº¢é»‘æ ‘ã€‚çº¢é»‘æ ‘å°±æ˜¯ä¸ºäº†è§£å†³äºŒå‰æŸ¥æ‰¾æ ‘çš„ç¼ºé™·ï¼Œå› ä¸ºäºŒå‰æŸ¥æ‰¾æ ‘åœ¨æŸäº›æƒ…å†µä¸‹ä¼šé€€åŒ–æˆä¸€ä¸ªçº¿æ€§ç»“æž„ã€‚
æˆ‘ä»¬æ¥ç»“åˆæºç åˆ†æžä¸€ä¸‹ `HashMap` é“¾è¡¨åˆ°çº¢é»‘æ ‘çš„è½¬æ¢ã€‚
**1ã€ `putVal` æ–¹æ³•ä¸­æ‰§è¡Œé“¾è¡¨è½¬çº¢é»‘æ ‘çš„åˆ¤æ–­é€»è¾‘ã€‚**
é“¾è¡¨çš„é•¿åº¦å¤§äºŽ 8 çš„æ—¶å€™ï¼Œå°±æ‰§è¡Œ `treeifyBin` ï¼ˆè½¬æ¢çº¢é»‘æ ‘ï¼‰çš„é€»è¾‘ã€‚
```java
// éåŽ†é“¾è¡¨
for (int binCount = 0; ; ++binCount) {
    // éåŽ†åˆ°é“¾è¡¨æœ€åŽä¸€ä¸ªèŠ‚ç‚¹
    if ((e = p.next) == null) {
        p.next = newNode(hash, key, value, null);
        // å¦‚æžœé“¾è¡¨å…ƒç´ ä¸ªæ•°å¤§äºŽç­‰äºŽTREEIFY_THRESHOLDï¼ˆ8ï¼‰
        if (binCount >= TREEIFY_THRESHOLD - 1) // -1 for 1st
            // çº¢é»‘æ ‘è½¬æ¢ï¼ˆå¹¶ä¸ä¼šç›´æŽ¥è½¬æ¢æˆçº¢é»‘æ ‘ï¼‰
            treeifyBin(tab, hash);
        break;
    }
    if (e.hash == hash &&
        ((k = e.key) == key || (key != null && key.equals(k))))
        break;
    p = e;
}
```
**2ã€`treeifyBin` æ–¹æ³•ä¸­åˆ¤æ–­æ˜¯å¦çœŸçš„è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚**
```java
final void treeifyBin(Node[] tab, int hash) {
    int n, index; Node e;
    // åˆ¤æ–­å½“å‰æ•°ç»„çš„é•¿åº¦æ˜¯å¦å°äºŽ 64
    if (tab == null || (n = tab.length)  hd = null, tl = null;
        do {
            TreeNode p = replacementTreeNode(e, null);
            if (tl == null)
                hd = p;
            else {
                p.prev = tl;
                tl.next = p;
            }
            tl = p;
        } while ((e = e.next) != null);
        if ((tab[index] = hd) != null)
            hd.treeify(tab);
    }
}
```
å°†é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘å‰ä¼šåˆ¤æ–­ï¼Œå¦‚æžœå½“å‰æ•°ç»„çš„é•¿åº¦å°äºŽ 64ï¼Œé‚£ä¹ˆä¼šé€‰æ‹©å…ˆè¿›è¡Œæ•°ç»„æ‰©å®¹ï¼Œè€Œä¸æ˜¯è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚
### HashMap çš„é•¿åº¦ä¸ºä»€ä¹ˆæ˜¯ 2 çš„å¹‚æ¬¡æ–¹
ä¸ºäº†èƒ½è®© HashMap å­˜å–é«˜æ•ˆï¼Œå°½é‡è¾ƒå°‘ç¢°æ’žï¼Œä¹Ÿå°±æ˜¯è¦å°½é‡æŠŠæ•°æ®åˆ†é…å‡åŒ€ã€‚æˆ‘ä»¬ä¸Šé¢ä¹Ÿè®²åˆ°äº†è¿‡äº†ï¼ŒHash å€¼çš„èŒƒå›´å€¼-2147483648 åˆ° 2147483647ï¼Œå‰åŽåŠ èµ·æ¥å¤§æ¦‚ 40 äº¿çš„æ˜ å°„ç©ºé—´ï¼Œåªè¦å“ˆå¸Œå‡½æ•°æ˜ å°„å¾—æ¯”è¾ƒå‡åŒ€æ¾æ•£ï¼Œä¸€èˆ¬åº”ç”¨æ˜¯å¾ˆéš¾å‡ºçŽ°ç¢°æ’žçš„ã€‚ä½†é—®é¢˜æ˜¯ä¸€ä¸ª 40 äº¿é•¿åº¦çš„æ•°ç»„ï¼Œå†…å­˜æ˜¯æ”¾ä¸ä¸‹çš„ã€‚æ‰€ä»¥è¿™ä¸ªæ•£åˆ—å€¼æ˜¯ä¸èƒ½ç›´æŽ¥æ‹¿æ¥ç”¨çš„ã€‚ç”¨ä¹‹å‰è¿˜è¦å…ˆåšå¯¹æ•°ç»„çš„é•¿åº¦å–æ¨¡è¿ç®—ï¼Œå¾—åˆ°çš„ä½™æ•°æ‰èƒ½ç”¨æ¥è¦å­˜æ”¾çš„ä½ç½®ä¹Ÿå°±æ˜¯å¯¹åº”çš„æ•°ç»„ä¸‹æ ‡ã€‚è¿™ä¸ªæ•°ç»„ä¸‹æ ‡çš„è®¡ç®—æ–¹æ³•æ˜¯â€œ `(n - 1) & hash`â€ã€‚ï¼ˆn ä»£è¡¨æ•°ç»„é•¿åº¦ï¼‰ã€‚è¿™ä¹Ÿå°±è§£é‡Šäº† HashMap çš„é•¿åº¦ä¸ºä»€ä¹ˆæ˜¯ 2 çš„å¹‚æ¬¡æ–¹ã€‚
**è¿™ä¸ªç®—æ³•åº”è¯¥å¦‚ä½•è®¾è®¡å‘¢ï¼Ÿ**
æˆ‘ä»¬é¦–å…ˆå¯èƒ½ä¼šæƒ³åˆ°é‡‡ç”¨%å–ä½™çš„æ“ä½œæ¥å®žçŽ°ã€‚ä½†æ˜¯ï¼Œé‡ç‚¹æ¥äº†ï¼š**â€œå–ä½™(%)æ“ä½œä¸­å¦‚æžœé™¤æ•°æ˜¯ 2 çš„å¹‚æ¬¡åˆ™ç­‰ä»·äºŽä¸Žå…¶é™¤æ•°å‡ä¸€çš„ä¸Ž(&)æ“ä½œï¼ˆä¹Ÿå°±æ˜¯è¯´ hash%length==hash&(length-1)çš„å‰ææ˜¯ length æ˜¯ 2 çš„ n æ¬¡æ–¹ï¼›ï¼‰ã€‚â€** å¹¶ä¸” **é‡‡ç”¨äºŒè¿›åˆ¶ä½æ“ä½œ &ï¼Œç›¸å¯¹äºŽ%èƒ½å¤Ÿæé«˜è¿ç®—æ•ˆçŽ‡ï¼Œè¿™å°±è§£é‡Šäº† HashMap çš„é•¿åº¦ä¸ºä»€ä¹ˆæ˜¯ 2 çš„å¹‚æ¬¡æ–¹ã€‚**
### HashMap å¤šçº¿ç¨‹æ“ä½œå¯¼è‡´æ­»å¾ªçŽ¯é—®é¢˜
JDK1.7 åŠä¹‹å‰ç‰ˆæœ¬çš„ `HashMap` åœ¨å¤šçº¿ç¨‹çŽ¯å¢ƒä¸‹æ‰©å®¹æ“ä½œå¯èƒ½å­˜åœ¨æ­»å¾ªçŽ¯é—®é¢˜ï¼Œè¿™æ˜¯ç”±äºŽå½“ä¸€ä¸ªæ¡¶ä½ä¸­æœ‰å¤šä¸ªå…ƒç´ éœ€è¦è¿›è¡Œæ‰©å®¹æ—¶ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹é“¾è¡¨è¿›è¡Œæ“ä½œï¼Œå¤´æ’æ³•å¯èƒ½ä¼šå¯¼è‡´é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æŒ‡å‘é”™è¯¯çš„ä½ç½®ï¼Œä»Žè€Œå½¢æˆä¸€ä¸ªçŽ¯å½¢é“¾è¡¨ï¼Œè¿›è€Œä½¿å¾—æŸ¥è¯¢å…ƒç´ çš„æ“ä½œé™·å…¥æ­»å¾ªçŽ¯æ— æ³•ç»“æŸã€‚
ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒJDK1.8 ç‰ˆæœ¬çš„ HashMap é‡‡ç”¨äº†å°¾æ’æ³•è€Œä¸æ˜¯å¤´æ’æ³•æ¥é¿å…é“¾è¡¨å€’ç½®ï¼Œä½¿å¾—æ’å…¥çš„èŠ‚ç‚¹æ°¸è¿œéƒ½æ˜¯æ”¾åœ¨é“¾è¡¨çš„æœ«å°¾ï¼Œé¿å…äº†é“¾è¡¨ä¸­çš„çŽ¯å½¢ç»“æž„ã€‚ä½†æ˜¯è¿˜æ˜¯ä¸å»ºè®®åœ¨å¤šçº¿ç¨‹ä¸‹ä½¿ç”¨ `HashMap`ï¼Œå› ä¸ºå¤šçº¿ç¨‹ä¸‹ä½¿ç”¨ `HashMap` è¿˜æ˜¯ä¼šå­˜åœ¨æ•°æ®è¦†ç›–çš„é—®é¢˜ã€‚å¹¶å‘çŽ¯å¢ƒä¸‹ï¼ŒæŽ¨èä½¿ç”¨ `ConcurrentHashMap` ã€‚
ä¸€èˆ¬é¢è¯•ä¸­è¿™æ ·ä»‹ç»å°±å·®ä¸å¤šï¼Œä¸éœ€è¦è®°å„ç§ç»†èŠ‚ï¼Œä¸ªäººè§‰å¾—ä¹Ÿæ²¡å¿…è¦è®°ã€‚å¦‚æžœæƒ³è¦è¯¦ç»†äº†è§£ `HashMap` æ‰©å®¹å¯¼è‡´æ­»å¾ªçŽ¯é—®é¢˜ï¼Œå¯ä»¥çœ‹çœ‹è€—å­å”çš„è¿™ç¯‡æ–‡ç« ï¼š[Java HashMap çš„æ­»å¾ªçŽ¯](https://coolshell.cn/articles/9606.html)ã€‚
### HashMap ä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨ï¼Ÿ
JDK1.7 åŠä¹‹å‰ç‰ˆæœ¬ï¼Œåœ¨å¤šçº¿ç¨‹çŽ¯å¢ƒä¸‹ï¼Œ`HashMap` æ‰©å®¹æ—¶ä¼šé€ æˆæ­»å¾ªçŽ¯å’Œæ•°æ®ä¸¢å¤±çš„é—®é¢˜ã€‚
æ•°æ®ä¸¢å¤±è¿™ä¸ªåœ¨ JDK1.7 å’Œ JDK 1.8 ä¸­éƒ½å­˜åœ¨ï¼Œè¿™é‡Œä»¥ JDK 1.8 ä¸ºä¾‹è¿›è¡Œä»‹ç»ã€‚
JDK 1.8 åŽï¼Œåœ¨ `HashMap` ä¸­ï¼Œå¤šä¸ªé”®å€¼å¯¹å¯èƒ½ä¼šè¢«åˆ†é…åˆ°åŒä¸€ä¸ªæ¡¶ï¼ˆbucketï¼‰ï¼Œå¹¶ä»¥é“¾è¡¨æˆ–çº¢é»‘æ ‘çš„å½¢å¼å­˜å‚¨ã€‚å¤šä¸ªçº¿ç¨‹å¯¹ `HashMap` çš„ `put` æ“ä½œä¼šå¯¼è‡´çº¿ç¨‹ä¸å®‰å…¨ï¼Œå…·ä½“æ¥è¯´ä¼šæœ‰æ•°æ®è¦†ç›–çš„é£Žé™©ã€‚
ä¸¾ä¸ªä¾‹å­ï¼š
- ä¸¤ä¸ªçº¿ç¨‹ 1,2 åŒæ—¶è¿›è¡Œ put æ“ä½œï¼Œå¹¶ä¸”å‘ç”Ÿäº†å“ˆå¸Œå†²çªï¼ˆhash å‡½æ•°è®¡ç®—å‡ºçš„æ’å…¥ä¸‹æ ‡æ˜¯ç›¸åŒçš„ï¼‰ã€‚
- ä¸åŒçš„çº¿ç¨‹å¯èƒ½åœ¨ä¸åŒçš„æ—¶é—´ç‰‡èŽ·å¾— CPU æ‰§è¡Œçš„æœºä¼šï¼Œå½“å‰çº¿ç¨‹ 1 æ‰§è¡Œå®Œå“ˆå¸Œå†²çªåˆ¤æ–­åŽï¼Œç”±äºŽæ—¶é—´ç‰‡è€—å°½æŒ‚èµ·ã€‚çº¿ç¨‹ 2 å…ˆå®Œæˆäº†æ’å…¥æ“ä½œã€‚
- éšåŽï¼Œçº¿ç¨‹ 1 èŽ·å¾—æ—¶é—´ç‰‡ï¼Œç”±äºŽä¹‹å‰å·²ç»è¿›è¡Œè¿‡ hash ç¢°æ’žçš„åˆ¤æ–­ï¼Œæ‰€æœ‰æ­¤æ—¶ä¼šç›´æŽ¥è¿›è¡Œæ’å…¥ï¼Œè¿™å°±å¯¼è‡´çº¿ç¨‹ 2 æ’å…¥çš„æ•°æ®è¢«çº¿ç¨‹ 1 è¦†ç›–äº†ã€‚
```java
public V put(K key, V value) {
    return putVal(hash(key), key, value, false, true);
}
final V putVal(int hash, K key, V value, boolean onlyIfAbsent,
                   boolean evict) {
    // ...
    // åˆ¤æ–­æ˜¯å¦å‡ºçŽ° hash ç¢°æ’ž
    // (n - 1) & hash ç¡®å®šå…ƒç´ å­˜æ”¾åœ¨å“ªä¸ªæ¡¶ä¸­ï¼Œæ¡¶ä¸ºç©ºï¼Œæ–°ç”Ÿæˆç»“ç‚¹æ”¾å…¥æ¡¶ä¸­(æ­¤æ—¶ï¼Œè¿™ä¸ªç»“ç‚¹æ˜¯æ”¾åœ¨æ•°ç»„ä¸­)
    if ((p = tab[i = (n - 1) & hash]) == null)
        tab[i] = newNode(hash, key, value, null);
    // æ¡¶ä¸­å·²ç»å­˜åœ¨å…ƒç´ ï¼ˆå¤„ç†hashå†²çªï¼‰
    else {
    // ...
}
```
è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯è¿™ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶ `put` æ“ä½œå¯¼è‡´ `size` çš„å€¼ä¸æ­£ç¡®ï¼Œè¿›è€Œå¯¼è‡´æ•°æ®è¦†ç›–çš„é—®é¢˜ï¼š
1. çº¿ç¨‹ 1 æ‰§è¡Œ `if(++size > threshold)` åˆ¤æ–­æ—¶ï¼Œå‡è®¾èŽ·å¾— `size` çš„å€¼ä¸º 10ï¼Œç”±äºŽæ—¶é—´ç‰‡è€—å°½æŒ‚èµ·ã€‚
2. çº¿ç¨‹ 2 ä¹Ÿæ‰§è¡Œ `if(++size > threshold)` åˆ¤æ–­ï¼ŒèŽ·å¾— `size` çš„å€¼ä¹Ÿä¸º 10ï¼Œå¹¶å°†å…ƒç´ æ’å…¥åˆ°è¯¥æ¡¶ä½ä¸­ï¼Œå¹¶å°† `size` çš„å€¼æ›´æ–°ä¸º 11ã€‚
3. éšåŽï¼Œçº¿ç¨‹ 1 èŽ·å¾—æ—¶é—´ç‰‡ï¼Œå®ƒä¹Ÿå°†å…ƒç´ æ”¾å…¥æ¡¶ä½ä¸­ï¼Œå¹¶å°† size çš„å€¼æ›´æ–°ä¸º 11ã€‚
4. çº¿ç¨‹ 1ã€2 éƒ½æ‰§è¡Œäº†ä¸€æ¬¡ `put` æ“ä½œï¼Œä½†æ˜¯ `size` çš„å€¼åªå¢žåŠ äº† 1ï¼Œä¹Ÿå°±å¯¼è‡´å®žé™…ä¸Šåªæœ‰ä¸€ä¸ªå…ƒç´ è¢«æ·»åŠ åˆ°äº† `HashMap` ä¸­ã€‚
```java
public V put(K key, V value) {
    return putVal(hash(key), key, value, false, true);
}
final V putVal(int hash, K key, V value, boolean onlyIfAbsent,
                   boolean evict) {
    // ...
    // å®žé™…å¤§å°å¤§äºŽé˜ˆå€¼åˆ™æ‰©å®¹
    if (++size > threshold)
        resize();
    // æ’å…¥åŽå›žè°ƒ
    afterNodeInsertion(evict);
    return null;
}
```
### HashMap å¸¸è§çš„éåŽ†æ–¹å¼?
[HashMap çš„ 7 ç§éåŽ†æ–¹å¼ä¸Žæ€§èƒ½åˆ†æžï¼](https://mp.weixin.qq.com/s/zQBN3UvJDhRTKP6SzcZFKw)
**ðŸ› ä¿®æ­£ï¼ˆå‚è§ï¼š[issue#1411](https://github.com/Snailclimb/JavaGuide/issues/1411)ï¼‰**ï¼š
è¿™ç¯‡æ–‡ç« å¯¹äºŽ parallelStream éåŽ†æ–¹å¼çš„æ€§èƒ½åˆ†æžæœ‰è¯¯ï¼Œå…ˆè¯´ç»“è®ºï¼š**å­˜åœ¨é˜»å¡žæ—¶ parallelStream æ€§èƒ½æœ€é«˜, éžé˜»å¡žæ—¶ parallelStream æ€§èƒ½æœ€ä½Ž** ã€‚
å½“éåŽ†ä¸å­˜åœ¨é˜»å¡žæ—¶, parallelStream çš„æ€§èƒ½æ˜¯æœ€ä½Žçš„ï¼š
```plain
Benchmark               Mode  Cnt     Score      Error  Units
Test.entrySet           avgt    5   288.651 Â±   10.536  ns/op
Test.keySet             avgt    5   584.594 Â±   21.431  ns/op
Test.lambda             avgt    5   221.791 Â±   10.198  ns/op
Test.parallelStream     avgt    5  6919.163 Â± 1116.139  ns/op
```
åŠ å…¥é˜»å¡žä»£ç `Thread.sleep(10)`åŽ, parallelStream çš„æ€§èƒ½æ‰æ˜¯æœ€é«˜çš„:
```plain
Benchmark               Mode  Cnt           Score          Error  Units
Test.entrySet           avgt    5  1554828440.000 Â± 23657748.653  ns/op
Test.keySet             avgt    5  1550612500.000 Â±  6474562.858  ns/op
Test.lambda             avgt    5  1551065180.000 Â± 19164407.426  ns/op
Test.parallelStream     avgt    5   186345456.667 Â±  3210435.590  ns/op
```
### ConcurrentHashMap å’Œ Hashtable çš„åŒºåˆ«
`ConcurrentHashMap` å’Œ `Hashtable` çš„åŒºåˆ«ä¸»è¦ä½“çŽ°åœ¨å®žçŽ°çº¿ç¨‹å®‰å…¨çš„æ–¹å¼ä¸Šä¸åŒã€‚
- **åº•å±‚æ•°æ®ç»“æž„ï¼š** JDK1.7 çš„ `ConcurrentHashMap` åº•å±‚é‡‡ç”¨ **åˆ†æ®µçš„æ•°ç»„+é“¾è¡¨** å®žçŽ°ï¼ŒJDK1.8 é‡‡ç”¨çš„æ•°æ®ç»“æž„è·Ÿ `HashMap1.8` çš„ç»“æž„ä¸€æ ·ï¼Œæ•°ç»„+é“¾è¡¨/çº¢é»‘äºŒå‰æ ‘ã€‚`Hashtable` å’Œ JDK1.8 ä¹‹å‰çš„ `HashMap` çš„åº•å±‚æ•°æ®ç»“æž„ç±»ä¼¼éƒ½æ˜¯é‡‡ç”¨ **æ•°ç»„+é“¾è¡¨** çš„å½¢å¼ï¼Œæ•°ç»„æ˜¯ HashMap çš„ä¸»ä½“ï¼Œé“¾è¡¨åˆ™æ˜¯ä¸»è¦ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªè€Œå­˜åœ¨çš„ï¼›
- **å®žçŽ°çº¿ç¨‹å®‰å…¨çš„æ–¹å¼ï¼ˆé‡è¦ï¼‰ï¼š**
  - åœ¨ JDK1.7 çš„æ—¶å€™ï¼Œ`ConcurrentHashMap` å¯¹æ•´ä¸ªæ¡¶æ•°ç»„è¿›è¡Œäº†åˆ†å‰²åˆ†æ®µ(`Segment`ï¼Œåˆ†æ®µé”)ï¼Œæ¯ä¸€æŠŠé”åªé”å®¹å™¨å…¶ä¸­ä¸€éƒ¨åˆ†æ•°æ®ï¼ˆä¸‹é¢æœ‰ç¤ºæ„å›¾ï¼‰ï¼Œå¤šçº¿ç¨‹è®¿é—®å®¹å™¨é‡Œä¸åŒæ•°æ®æ®µçš„æ•°æ®ï¼Œå°±ä¸ä¼šå­˜åœ¨é”ç«žäº‰ï¼Œæé«˜å¹¶å‘è®¿é—®çŽ‡ã€‚
  - åˆ°äº† JDK1.8 çš„æ—¶å€™ï¼Œ`ConcurrentHashMap` å·²ç»æ‘’å¼ƒäº† `Segment` çš„æ¦‚å¿µï¼Œè€Œæ˜¯ç›´æŽ¥ç”¨ `Node` æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘çš„æ•°æ®ç»“æž„æ¥å®žçŽ°ï¼Œå¹¶å‘æŽ§åˆ¶ä½¿ç”¨ `synchronized` å’Œ CAS æ¥æ“ä½œã€‚ï¼ˆJDK1.6 ä»¥åŽ `synchronized` é”åšäº†å¾ˆå¤šä¼˜åŒ–ï¼‰ æ•´ä¸ªçœ‹èµ·æ¥å°±åƒæ˜¯ä¼˜åŒ–è¿‡ä¸”çº¿ç¨‹å®‰å…¨çš„ `HashMap`ï¼Œè™½ç„¶åœ¨ JDK1.8 ä¸­è¿˜èƒ½çœ‹åˆ° `Segment` çš„æ•°æ®ç»“æž„ï¼Œä½†æ˜¯å·²ç»ç®€åŒ–äº†å±žæ€§ï¼Œåªæ˜¯ä¸ºäº†å…¼å®¹æ—§ç‰ˆæœ¬ï¼›
  - **`Hashtable`(åŒä¸€æŠŠé”)** :ä½¿ç”¨ `synchronized` æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ•ˆçŽ‡éžå¸¸ä½Žä¸‹ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥æ–¹æ³•æ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿè®¿é—®åŒæ­¥æ–¹æ³•ï¼Œå¯èƒ½ä¼šè¿›å…¥é˜»å¡žæˆ–è½®è¯¢çŠ¶æ€ï¼Œå¦‚ä½¿ç”¨ put æ·»åŠ å…ƒç´ ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¸èƒ½ä½¿ç”¨ put æ·»åŠ å…ƒç´ ï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨ getï¼Œç«žäº‰ä¼šè¶Šæ¥è¶Šæ¿€çƒˆæ•ˆçŽ‡è¶Šä½Žã€‚
ä¸‹é¢ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹ä¸¤è€…åº•å±‚æ•°æ®ç»“æž„çš„å¯¹æ¯”å›¾ã€‚
**Hashtable** :
![Hashtable çš„å†…éƒ¨ç»“æž„](https://oss.javaguide.cn/github/javaguide/java/collection/jdk1.7_hashmap.png)
https://www.cnblogs.com/chengxiao/p/6842045.html>
**JDK1.7 çš„ ConcurrentHashMap**ï¼š