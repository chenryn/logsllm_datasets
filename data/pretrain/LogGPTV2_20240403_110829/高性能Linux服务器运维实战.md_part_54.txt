主机群组招饮
ZABBIX监测中
作整作恢复操作
告警时间：(EVENT.DATE）【EVENT.TIME)
告警信息：{TRIGGER.NAME}
当前状态：（TRIGGER,STATUS）
操作细节
消里内容
默认标题
操作
换作遥书
发选消意给用户群组: Zabx dminstors通过微信需警
服务器(HOST.NAME)TRIGGERNAME)已恢复
更新取消
发送到用户群组
1-3
步骤
添加
新的
步骤持续时间
照等线
发送到用户
发送消息给用户群组：
细节
消息内容
操作类型
仅送到
条件
图6-74
图6-75酉
60
ME
Zabbix administrators
At least one user or user groupmust be selected
发送消息
用户群组
配置微信故障告警频率和通知人
Zabbix
配置微信告警故障恢复内容
nistrators通过微信告警
，接着配置故障恢复后的信息发送格式，单击
（0-使用默认）
名称
动作
开始于持续时间动作
运维监控利器Zabbix第6章
立即地60
Suppo
sha
移除
C
299
---
## Page 311
300
如图6-77所示。
击ZabbixWeb下的“报表”菜单，然后选择“动作日志”，查看告警信息发送日志，
里模拟一个MySQL故障的恢复，检查告警信息是否能通过Zabbix发送给微信。可单
高性能Linux服务器运维实战：shell编程、监控告警、性能优化与实战案例
可以模拟一个监控项故障，
至此，微信告警整合Zabbix，配置完成。
最后的“操作”按照如图6-76所示配置即可。
消息内容：
默认标题：
在这个界面下，默认标题和消息内容模板可配置如下：
4.
测试微信告警功能
服务器：（HOST.NAME）：（TRIGGER.NAME）已恢复！
操作细节
事件ID：(EVENT.ID）
持续时间：{EVENT.AGE）
恢
叶
监控项目：（ITEM.NAME）
告警主机：（HOST.NAME）
复时间：{EVENT.RECOVERY.DATE）
警时间：{EVENT.DATE}（EVENT.TIME}
警信息：（TRIGGER.NAME）
前状态：(TRIGGER.STATUS）
警等级：{TRIGGER.SEVERITY）
控取值：（ITEM.LASTVALUE)
警地址：（HOST.IP}
操作
更新取消
发送到用户群组
发送消息给用户群组：Zabbix
细节
发送到用户
消息内容
操作类型
仅送到
图6-76
微信告警
At least oneuser oruser groupmust be selected.
发送消惠
添加
添加
Zabbix administrators
用户群组
然后测试告警信息是否能通过Zabbix发送给微信。这
配置微信告警故障恢复通知组
administrators通过微信告警
{EVENT.RECOVERY.TIME}
移除
---
## Page 312
6.7.2
图6-78所示。
息，然后根据错误信息排查即可。如果显示发送成功，那么微信就能收到告警信息了，如
钉钉类似于微信，但是偏向于办公方向，可以通过钉钉的群机器人功能，实现将告警
1.关于钉钉机器人告警
这样，微信整合Zabbix告警功能，成功实现。
这个界面显示了告警日志是否发送成功，如果没有发送成功，可以看到具体的错误信
Zabbix整合钉钉实现实时告警
281-1-191
动作日志
ZABBIX
监测中
美型
图6-78手机上收到的微信告警截图
报表
本年过了
C
301
---
## Page 313
302
聊，
自定义机器人聚合到钉钉群。
器人支持Webhook协议的自定义接入，支持更多可能性，例如，可将运维告警提醒通过
更新同步；通过聚合Trello、JIRA等项目协调服务，实现项目信息同步。不仅如此，群机
中，实现自动化的信息同步。例如通过聚合GitHub、GitLab 等源码管理服务，实现源码
信息通过机器人发送到钉钉群。
高性能Linux服务器运维实战：shell编程、监控告警、性能优化与实战案例
群机器人是钉钉群的高级扩展功能。
然后，创建一个群聊，开始选择需要添加的人员，如图6-80所示。
加入需要接收钉钉告警信息的人员，如图6-79所示。
关于钉钉的注册很简单，
2.添加钉钉机器人
Zabbix整合钉钉告警，
O
确定（3/1000）
普通群
群类型
钉钉告警
群名称-选项
搜索
南非蚂义奔心xmjxTeaBrox
创建聊天
公告网重云产品和版
工作通知：阿里云
添加好友
发起群聊
发起投屏
0835
09-18
+
相比微信，
，这里不再过多介绍。注册完成登录到钉钉后，先发起一个群
取消
图6-79
图6-80添加钉钉群成员
文件小助手
要简单很多，
创建一个钉钉群聊
：群机器人可以将第三方服务的信息聚合到群聊
阿里云服务支持
外部联系人
按角色选择
按组织架构选择
运维团队
我的好友
下面详细介绍如下。
#
口
---
## Page 314
人，如图6-83所示。
所示界面。
这里选择自定义机器人，通过 Webhook 接入自定义服务，接着，开始添加一个机器
在这里选择“智能群助手”，然后在智能群助手中选择“添加机器人”，进入如图6-82
群聊创建完成后，
群机器人
预誉信息
JIRA
心知天气
8
预报和
接着就可以添加机器人到群里面了。单击群设置，如图6-81所示。
件ID：47970
持续时间：21m
恢复时间：2019.04.2115:12:25
告警时间：2019.04.2114:51:25
告警信息：Freedisk space is less
图6-81
图6-82
出色的读自与
阿里云Code
Iravis
选择要添加的机器人
在钉钉群中找到“智能群助手”
添加自定义的群机器人
事务跟
消息免打扰
第三方密盾加密
智能群助手
滑顶聊天
我在本群的昵称
群管理
群成员3人
群设置
翠于GIt的
运维团队
GitHub
Trello
马托管服
管理
运维监控利器Zabbix
1012
自定义
GitLab
第6章
303
---
## Page 315
结束。
最后，单击“完成”按钮，机器人添加完毕，接着进入如图6-84所示的界面。
这里选择“加签”，并记住“加签”这段以SEC开头的字符串密钥，后面会用到这个密钥。
高性能Linux服务器运维实战：shell编程、监控告警、性能优化与实战案例
304
注意，将上图这个Webhook地址复制记录下来，后面也会用到。机器人配置到此
输入机器人名字，并指定一个已经存在的钉钉群。“安全设置”中3个任选其一即可，
添加机器人
添加机器人
安全设置
添加到群组：
Webhook:
2.设置webhook，点击设置说明查看如何配置以使机器人生效
1.添加器人
兑明文档
机器人名字：
图6-83添加Webhook接入自定义服务的机器人
加签
使用Webhook地址，向钉钉联推送消息
请保管好此Webhook地址，不要公布在外部网站上，池需有安全风险
SEC1a76151535e7b96186e7ef8c960517
口自定义关键词
钉钉告警
图6-84机器人添加完成
取消
完成
设置说明
重置
复制
---
## Page 316
ZZZ&sign=DDD
时间戳和签名值才能进行调用，Webhook地址的调用格式为：
Webhook地址进行了安全设置，上面获取到的Webhook地址不能直接使用，还需要加上
如下方法进行安装：
的一个HTTP 客户端库，跟 urllib、urllib2类似，如果服务器没有安装requests，需要通过
headers).content
值，后面会进行介绍。