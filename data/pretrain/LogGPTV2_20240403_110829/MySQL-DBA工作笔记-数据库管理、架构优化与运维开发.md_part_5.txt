S
Row
Archive
Row
←
不支持
支持
大
不支持
N/A
不支持
相对较慢
MyiSAM
<
High
High
Low
<
Row
---
## Page 31
在功能、性能和稳定性方面的反应会逐步落后于官方版本。
的支持会更好，但是相对来说ToukuDB目前仅处于维护阶段。
对于 Percona 分支的测试更加充分，兼容性更好一些。
析一下它们的优缺点。
Enterprise 发行版的版本，其中 XtraDB 是 Percona一款独立的存储引擎，下面我们来分
1.3.2
富的特性、更好的性能和庞大的用户群，在行业内使用很普遍。
目前主要有Percona和MariaDB。分支可以在官方版本基础上做更多地扩充，有相对更丰
了 8.0版本，目前的迭代速度在功能补充和 bug 修复方面确实很快。
版的服务，而 Oracle 已和腾讯开展了战略合作，会落地Oracle 云服务的实施细节。
要在一些定制插件方面。
方版本主要分为社区版和企业版（此外还有标准版、经典版、集群版等)，两者的差异主
1.3.1
（5）ToukuDB 存储引擎，适合IO bound 的场景，已被Percona 收购，对于ToukuDB
MySQL社区发展成熟，社区担心Oracle 官方会把MySQL闭源，因此创建了分支，
（1）随着 MySQL 5.7版和 8.0测试版的发布，官方对于MySQL 的掌控力更强，分支
Percona Server 是 MySQL 的一个分支，被称为最接近 Oracle 发布的官方 MySQL
MySQL 近些年来开发团队迅速扩展，产品开发的迭代速度极快，在5.7版本后推出
Oracle 的 MySQL 服务具有得天独厚的优势，可以直接接入Oracle Cloud，拥有企业
（6）Percona在社区拥有强大的技术影响力，很多技术压测和方案建议比较权威。
（4）Percona 自身开发的一系列工具，比如 Percona-tookit，xtracbackup，sysbench 等，
MySQL官方版本还是很有号召力的，在社区建设和产品定义上具有权威性；目前官
（2）Percona Server 分支的维护由Percona 自己管理代码，不接受外部开发人员的贡献。
缺点：
（8）Percona 公司在全力推行 myrocks 存储引擎，压缩比很高。
（7）很多互联网公司都在使用Percona 分支，使用时间至少5年，比如阿里，搜狐等。
（3）后期做高可用的方案，比如 PXC、Galera，使用 Percona分支是一个更好地选择。
（2）根据Percona发布的压测报告，性能优于官方，行业测试其性能差别在10%左右
（1）Percona XtraDB 是 InnoDB 存储引擎的增强版，使用是透明的。
优点：
下面我们对这三个版本的优劣与取舍进行一下分析。
选择官方版的原因
Percona分支的优劣对比
第1章MySQL发展和技术选型
6
---
## Page 32
10丨MySQL DBA工作笔记：数据库管理、架构优化与运维开发
很有限，而且在优化器层面也比较薄弱。MySQL 5.6 版是目前在互联网里面经受考验较
些差别和特别之处。
MySQL5.7 版的完善功能，
哪一个版本没有对错，但是也存在一定的技巧。
产环境而言，我们力求稳定，对于新特性和功能的预研，其实更适合于测试环境。使用
持，
MariaDB 10.3企业级数据库，
实现，官方版本在5.7版才实现。
面我们来分析一下它的优缺点。
1.3.3
ToukuDB 等，对于官方的支持会拉开差距。
1.3.4
搭建主从（主为官方版本，从库为Percona）。
一个简单的分析。
MySQL5.5版是一个经典的版本，
（4）Percona 目前在同时进行多个版本分支的维护方面，比如 XtracDB，Myrocks,
所以从稳定的角度来说，我们是选择MySQL 5.5 版或 5.6版的力求稳定，
在版本使用过程中，存在两个边界：一个是用最新的，
做完软件选型，其实接下来的难事是做版本选型，就拿 MySQL 社区版为例，我们做
（3）用户基数相比MySQL官方版本和Percona 都要小一些。
（2）MariaDB 10.x目前集成的还是 5.6 InnoDB 存储引擎的版本，官宣10.2版本会支
（5）2018年9月底MariaDB与阿里云达成全球唯一战略合作，在阿里云上推出了
（3）MariaDB 大量的新特性是官方版本没有的，比如多源复制在 MariaDB 早期已经
MariaDB 是MySQL方向一个强有力的分支，在功能和设计上属于另辟蹊径，下
但这已经落后官方版本1年以上的时间。
（1）和官方版本不是完全兼容，因为功能的差异使用上有一些差别。
（4）有独立的产品文档，相对于官方版本来说更加完善。
（3）如果已经使用了官方社区版，和Percona 分支合可能会有兼容性的问题，比如
缺点：
（2）RedHat，wiki已经全线使用MariaDB，属于战略合作。
（1）MariaDB是
优点：
MySQL 版本选型
选择MariaDB的原因
是由 MySQL 创始人开发的分支，有较强的技术号召力。
对于很多新手来说会很难以执择，
，开始在公共云上提供了MariaDB 服务。
但是存在诸多的限制，
一个是用最稳定的。对于生
比如在线 DDL 变更，支持
我们就需要厘清它们的一
还是使用
---
## Page 33
深入的测试；如果是在更好的机器配置上，需要进一步做测试验证。
1.3.5分支选择的参考和标准
版本作为我们的基线版本，我们从 MySQL 5.5 的时代直接跳到了 MySQL5.7。
版本不涉及新特性的提出，而是修复了一些潜在的问题，综上所述，我们选择MySQL 5.7.16
们要选择5.7.13和5.7.17之间的版本，在综合比较了多个版本的变更细节之后，发现5.7.16
个版本发布了重量级的特性MGR，但是新特性的推出势必会带来一些潜在的问题，所以我
2018年10月最新的版本是5.7.24，这个版本还会不断的完善下去。
本可供选择。
特点选择一个最合适的版本。
角度综合来说，建议选择 MySQL5.7版，但是不建议选择最新的版本，而要根据自己的
本相对来说是比较新的，其从推出到使用也有好几个年头了。因此从功能完善和稳定的
多的，但是对于并行复制的改进是在MySQL 5.7版开始有了本质的改进。MySQL 5.7版
，排除了MySQL5.5版和MySQL5.6版，目前来看有5.7.X，5.7.16和5.7.13这3个版
MySQL5.6
列出这三个版本是有一定的道理的，MySQL 5.7.X 是代表 MySQL 最新版本，截止
·MariaDB10.2GA：2017年5月23日
●MySQL5.7GA：2015年10月21日
对于分支的选择，以MySQL5.7GA为例，版本发布时间如下：
（3）MySQL 5.6版以后对CPU多核利用率有很大的提高，在16 核，24核，32 核有
（2）公司当前的版本情况。
（1）目前业界主流的版本和分支。
在进行分支选择的时候，我们可以参考以下几个方面：
我们最后选择了MySQL5.7.16，主要是基于MySQL5.7.17版本来考虑，因为5.7.17这
·PerconaServer5.7GA：2016年2月23日
一些重要的分析点可以参考下图1-9。
MySQL 5.7.13是很多云厂商基于MySQL5.7定制的一个版本，使用范围较广。
MySQL 5.7.13MySQL5.7.16
5.7里面的并行复制改进，主从延迟极大降低
阿里云RDS5.7已经全面开放
新上线的业务使用Percona分支的5.7.16版本
图1-9
MySQL5.7.17
MGR初版，会有一些稳定性和性能上的问题
推出了MGR的特性，是高可用方案的官方实现
MySQL5.7.19
第1章MySQL发展和技术选型丨11
周边业务，测试业务可以考虑使用5.7.10版本试用
发布时间为2017年7月
是目前最新的版本
---
## Page 34
12丨MySQL DBA工作笔记：数据库管理、架构优化与运维开发
为 5.7.13、5.7.16、5.7.X。
版本和 Percona 分支。
MySQL软件和版本选型
从近两年的技术发展来看，
对于整体的MySQL软件和版本选型，我做了下面的图片（图1-10)，大家可以做参考
我们可以看出Percona 和官方的发布周期相距比较接近，我们是选用了MySQL 官方
版本选型软件选型
选择MySQL5.7
个别业务
主要使用社区版本
前主要使用MySQL
社区版本
MySQL5.7.19
MySQL5.7.17
MySQL5.7.16
MySQL5.7.13
5.6的新特性会存
官方的投入和支持更全面，建议使用社区版，参考版本
DB存储引膜
优点
主要修复了5.7.17中GR的-些问题
改进不是很
和官方版本不
存在大
图1-10
随着MySQL5.7和8.0测试版的发布，官方对于MySQL的掌控力更强，分支在功能，性能，稳定性上的反应会逐步落后于官方
后期考贷局的方案，比挥
conaXtraDB是InnoDB存储引擎的增强版，使用是透明的
同都在使用Pe
ona分支
d的场量，已被Per
掌的版本，官宜10.2版本会支持，但这已经落后自方1年
MariaDB早期已经实现，在官方版本5.7才实现
号召力
初步结论
kuDB，PXC上的投入有限
oukuDB的支持会更好，但是相对来说ToukuDB目前仅处于维护阶段
B.对于官方的支持会拉开差距
---
## Page 35
者兴趣而忽视一些工作短板。
要么因为简单而被替代，要么因为复杂而被革掉。
提供一个工具集，比如备份工具有几种可选项，完全可以根据公司的场景进行选型。
点需要注意：
和开发同学规范统一就有了一个基线。
本和麻烦，因此最好提前和团队有一个基本地沟通，达成一个共识。内部统一了以后，
碰到了各色问题再来统一，就比较难了，会有沟通、人力、技术沉淀和持续交付等的成
1.4MySQL常用工具选择和建议
需要协助系统部定制安排。
写优势，在后期可以考虑做预研，部分业务中采用。
MySQL5.7的方案，这个工作是在后期考虑高可用方案的前置任务。
1.3.6
（3）在工作中，我们需要尽可能全面地覆盖下面的这些方面，不能因为个人喜好或
（2）工具只是解决问题的一种方式，是可以被绕过的，它不是最根本和核心的问题，
（1)不是所有的工具都需要自己学习和安装一遍，这里列举出来主要是做一种信息完善，
：（1）对现有业务考虑升级/迁移到MySQL5.7版本，需要重点考虑MySQL5.5升级到
技术规划的时候，一些事情需要提前做，比如说 MySQL 里面的工具；如果等到实际
相关工具选型整理了脑图，如下图1-11所示。
这些工具要统一规划还是比较复杂的，我列举了这些工具类的一些基本信息，有两
·监控管理类工具：主要是侧重于系统层和数据库层的监控管理，也包含一些开源方案;
大体来说，我考虑了以下4个方面的工具：
（4）周边业务，测试业务可以考虑试用5.7.19Percona分支。
（2）字符集，默认为 utf8，部分业务需要存储表情类字段，可以设置为 utf8mb4。
（1）为了兼容后期的工具使用和扩展，系统层面建议 Python 软件版本升级为2.7+，
补充事宜：
（3）对于额外的需求，可以考虑ToukuDB 和 MyRocks，MyRocks 具有高压缩比和读
·运维管理类工具：侧重于DBA使用的工具，包含备份恢复、审计等工具；
（3）新上线的业务建议使用Percona分支的5.7.16版本。
（2）根据业务需求和经验定制不同版本的参数模板，目前主要是MySQL5.7版本。
试工具；
诊断和优化工具：侧重于性能诊断和优化，
应用工具：主要包含客户端工具；
初步结论
包含性能诊断、慢日志分析和性能测
第1章MySQL发展和技术选型|13
---
## Page 36
14丨MySQLDBA工作笔记：数据库管理、架构优化与运维开发
就是备份的IO问题没法大幅度扩展，因为都在最后备份出来的那个文件上，没有拆分。
辑备份。
量不大的数据备份工作。值得一提的是 Facebook 的生产环境都是使用 mysqldump 进行逻
也是和使用习惯与工具的成熟度相关。pt工具被Percona 收至摩下，有专门的项目维护。
是 Perl 的基因。而 Aspersa 的范畴更倾向于系统层面，比如磁盘信息等。
都出自同一个作者：Baron Schwartz；其中，Maatkit工具更偏重于数据库层面，最开始就
要熟练使用的一个运维工具。
1.4.1
些备份工具：
在2017年开始进入了3.0时代，目前行业内线上使用的版本主要是2.2（自2013年），
Percona-toolkit 通常简称为 pt 工具，它其实是工具 Maatkit 和 Aspersa 的组合，它们
这个工具还算比较流行，能够对原来的 mysqldump 做一个很好的补充。腾讯云就是
（3）mydumper 
MySQL 新版本推出的备份工具，但是效果没有想象的那么好，最大的一个痛点应该
（2）mysqlpump
MySQL最经典的逻辑备份工具,也是MySQL工具集里默认的工具，适用于一些数据
（1）mysqldump
2.数据备份恢复工具
要说 MySQL 运维工具，
在数据备份和恢复方面，主要依据是逻辑备份和物理备份，行业里主要有以下的
1．主流运维管理工具
ysbench
运维管理类工具
慢日志分析工具
性能测试工具
操作系统监控工具
诊断工具
性能监控工具
4运维工具-诊断和优化
3.监控管理工具
Percona-toolkit 当仁不让，它应该是我们学习MySQL 必须
相关工具选型
图1-11
2.应用工具
1.运维工具-运维管理
数据库版本管理工具liquibas
客户端工具
数据备份恢复工具
SQLdeveloper
MySQLWorkbenh
Navica
mydumpe
mysqlpum
mysqldump
---
## Page 37
支持MySQL，
等功能，它同时有开源和商业化两个版本。
属于付费产品。
降低系统管理成本而设计，
公司出品，属
指定工具规范来说尤其重要。
是否付费，在此列举出一些常见的客户端工具，而且标识出它是否为商业产品，对于DBA
1.4.2
感知的。
细粒度审计的合规性管理，
定制了 mydumper来做为默认的备份工具。
实践工作中所用到的数据库版本管理工具主要是 liquibase,它是一个数据库重构和迁
2．数据库版本管理工具
这个工具是 Oracle 推出的一
（4）SQL developer
为MySQL设计的 ER/数据库建模工具，
Navicat 是一套快速、可靠并价格适中的数据库管理工具，专为简化数据库的管理及
(2）Navicat
SQLyog是
（1）SQLyog
对于很多开发同学来说，使用客户端工具是一种很自然的工作习惯，但是很少关注
（3）MariaDB 插件
（2）Percona Audit Log 插件
（1）官方的商业版插件
目前在 MySQL 审计方面主要存在以下几类审计插件：
数据库审计是数据安全方面的一
3.MySQL审计插件
来自 Percona 的工具,
（4）xtrabackup
另外和 Mydumper 配套的工具是myloader，作为数据的批量导入工具。
(3）MySQLWorkbench
1.客户端工具
应用工具
则需要额外下载一
于付费产品。
是一个快速而简洁管理MySQL数据库的图形化工具，由业界著名的Webyog
它的设计符合数据库管理员、开发人员及中小企业的需要，
对数据库遭受到的风险行为进行告警
擅长做物理备份，
一款免费的数据库管理工具，它主要支持Oracle，如果要
一个驱动包。
一个重要参考；
，可以支持数据库管理、数据迁移、数据建模