## 密钥管理 - KMS (密钥管理服务)、HSM (硬件安全模块) 和 HSM as a Service

### 作者
digoal

### 日期
2019-02-05

### 标签
PostgreSQL, 密钥管理, 密钥生命周期管理

---

## 背景
密码在我们的日常生活中无处不在，例如银行卡、微信、支付宝、淘宝等。通常情况下，我们不会只使用一个密码，而是多个密码。如何安全地保存这些密码是一个问题。同样，在企业应用中，数据的对称加密和非对称加密也需要使用密钥、私钥和公钥。如何管理这些密钥也是一个重要的问题。

1. **KMS (Key Management Services)**：云厂商通常会提供 KMS。
2. **HSM (Hardware Security Modules)**。
3. **HSM as a Service**。

不同的环境建议使用的密钥管理服务如下：

| 环境 | 私有或混合云 | 单一云提供商 | 多云 |
| --- | --- | --- | --- |
| 建议 | 企业数据中心已配置的 HSM | 云提供商的 KMS 或由云提供商选择的 HSM 增强的 KMS | HSM as a Service |
| 优点 | HSM 安全性 | 管理简便（可选自带密钥） | 管理简便，HSM 级别安全性，额外防御数据泄露 |
| 替代方案 | HSM as a Service 消除 HSM 配置的持续成本和开销 | HSM as a Service 将加密密钥与数据分开存储，以增强数据泄露防护 | - |

相关文章：
- [《PostgreSQL 对称加密、非对称加密用法介绍》](../201802/20180226_03.md)
- [《[转载] 白话解释 非对称加密，电子签名，电子证书，根证书，HTTPS，PKI 到底是什么》](../201802/20180226_02.md)
- [《[转载] 对称加密与非对称加密》](../201802/20180226_01.md)

## [转载] 硬件安全模块 (HSM) 与密钥管理服务 (KMS) 的比较
来源：[https://blog.equinix.com/blog/2018/06/19/hardware-security-module-hsm-vs-key-management-service-kms/](https://blog.equinix.com/blog/2018/06/19/hardware-security-module-hsm-vs-key-management-service-kms/)

最近的网络安全威胁，如国家层面的攻击、参议院关于 Facebook 数据隐私处理的听证会以及欧盟 GDPR 法规，都强调了保护敏感和个人信息的迫切需求。随着企业将数据和应用程序从自己的数据中心迁移到云端，解决这些问题变得更加复杂。

特别是在私有、公共、混合或多云环境中安全地管理数据和加密密钥，面临着独特的挑战。随着企业向云端迁移，每个云环境都有自己的密钥管理方法，导致密钥管理可能变得不一致。目前存在三种解决方案来管理加密密钥：传统的硬件安全模块 (HSM)、密钥管理服务 (KMS) 以及结合 KMS 的简单性和 HSM 安全性的 HSM as a Service。

您采用的云策略（私有、混合、公共或多云）是决定哪种加密密钥管理策略最适合您的企业的关键因素。为了获得最佳效果，您的密钥策略应符合您的长期云策略，并在整个企业中一致应用。

### 传统 HSM 用于本地加密密钥管理
多年来，硬件安全模块已被用于在企业自己的数据中心内安全地管理加密密钥。这些硬件设备设计并认证为防篡改和抗入侵，提供了最高级别的物理安全性。密钥存储在 HSM 中，而加密操作则在模块内安全执行。

作为加密密钥管理的事实标准，HSM 提供了完整的功能和管理功能，包括：
- 生命周期管理：HSM 在密钥的整个生命周期中进行保护，包括创建、导入、导出、使用、轮换、销毁和审计。
- 集中管理：桌面管理工具可以远程管理密钥生命周期，并支持职责分离以增加安全性。
- 认证：HSM 符合 FIPS 140-2 Level 3 验证标准。
- API 支持：HSM 支持 PKCS #11、Microsoft CAPI、CNG、JCA、JCE 及其他 API，以便于集成和自定义应用程序开发。

#### 传统 HSM 在云环境中的局限性
随着企业转向云部署并与多个云服务提供商合作，传统 HSM 的局限性变得明显。考虑以下几点：
- HSM 选择和位置：云提供商是否允许使用您现有的本地 HSM，还是要求使用其数据中心托管的 HSM？
- 连接性：本地 HSM 与存储在云中的加密数据之间的连接是否会引入不可接受的延迟，影响加密和解密性能？
- 管理工具：如果您与多个云提供商合作，是否准备好应对每家提供商不同 HSM 密钥管理工具的低效问题？

为了简化过渡并缓解客户从本地加密密钥管理迁移到云端加密密钥管理时面临的挑战，许多云提供商开发了密钥管理服务 (KMS)，这些服务基于软件即服务 (SaaS) 的优势构建。

### 适用于云环境的密钥管理服务
功能上类似于 HSM 提供的服务，KMS 使客户能够无需担心 HSM 设备的选择和配置即可管理加密密钥。KMS 提供了集中化的加密密钥生命周期管理，并能够导出和导入现有密钥。它还提供了符合应用程序打包标准 (APS) 的 SDK 以支持应用程序开发和集成。

使用云提供商提供的 KMS 有明显的优点，尤其是它们建立在云平台的优势之上：
- 扩展性：云平台可以轻松适应企业数据、处理能力和地理扩展的需求。
- 可用性：云提供商在基础设施上进行了大量投资，以确保服务可用性。
- 集成：与云提供商提供的其他服务（如系统管理、数据库、存储和应用程序开发工具）的原生集成。
- 自带密钥 (BYOK)：作为附加的安全层，一些云提供商在其 KMS 中提供了使用外部 HSM 存储主密钥的选项。

#### KMS 在多云环境中的局限性
如果您仅与单一云提供商合作，KMS 加密密钥方法可能是最佳选择。然而，根据 RightScale State of the Cloud 报告等研究，大多数企业与多个云提供商合作。在多云环境中，由于需要为每个云环境采用不同的加密密钥管理方法，云的技术和经济优势被复杂性所抵消。

您的数据安全团队很可能已经在努力遵守不断增加的法规。您需要一种简化密钥管理而不增加管理复杂性的策略。您希望有一种一致、集中且安全的方式来管理加密密钥，理想情况下是专门为多云环境设计的。

### HSM as a Service —— 简单、安全且可扩展
HSM as a Service 是本地 HSM 或云提供商的 KMS 的替代方案。它适合那些需要 HSM 级别的密钥管理和单一管理环境的企业，无论加密密钥在哪里使用。HSM as a Service 提供了 HSM 级别的密钥存储，无需 HSM 设备，可以快速实施并轻松扩展以支持数据、处理能力和地理扩展。

HSM as a Service 提供的功能和功能与 KMS 相当，并具备几个补充云提供商优势的额外能力：
- 多云和混合云能力：无论数据位于何处，都能实现一致、集中的控制和管理。
- BYOK 支持：可以轻松集成现有的加密密钥。
- 加密保护：只有授权用户才能访问加密密钥。
- 认证：无需 HSM 设备即可提供 FIPS 140-2 Level 3 验证。
- 云友好型 API：支持 PKCS #11、CNG、JCE、KMIP 和 RESTful API 以支持应用程序开发和集成。还提供了示例代码。
- 安全性和延迟：密钥与数据分开存储但邻近，以减少延迟并提供额外的数据泄露防御。
- 连接性：通过公共互联网访问多个云服务提供商和网络服务提供商。也可通过全球数据中心之间的专用骨干网访问。

### 加密密钥管理解决方案：让您的长期云策略指导您的选择
选择最佳的加密密钥管理策略和实施方式可以是一个简单的过程。如果您在自己的数据中心内运行私有或混合云环境，并且已经配备了具有既定加密密钥的 HSM，并计划在未来一段时间内维持该环境，那么继续当前的策略是有意义的。同样，如果您与单一云服务提供商合作，并且没有长期计划扩展到其他提供商，那么该提供商的 KMS 或者更好的是，由其 HSM 支持的 KMS 是显而易见的选择。

不过，也可以考虑 HSM as a Service 的优势。它可以消除随着数据和处理需求增长而在数据中心配置 HSM 的成本和开销。与 KMS 不同，它可以通过将加密密钥与云提供商存储的加密数据分开来提供额外的数据泄露防御。

如果您是与多个云服务提供商合作的企业之一，或者预计您的私有、混合或单一提供商云策略很快会演变为多云策略，那么 HSM as a Service 是高效管理各种云平台上加密密钥的最佳方式。下表提供了基于您的长期云策略的最佳加密密钥管理解决方案建议：

| 环境 | 私有或混合云 | 单一云提供商 | 多云 |
| --- | --- | --- | --- |
| 建议 | 企业数据中心已配置的 HSM | 云提供商的 KMS 或由云提供商选择的 HSM 增强的 KMS | HSM as a Service |
| 优点 | HSM 安全性 | 管理简便（可选自带密钥） | 管理简便，HSM 级别安全性，额外防御数据泄露 |
| 替代方案 | HSM as a Service 消除 HSM 配置的持续成本和开销 | HSM as a Service 将加密密钥与数据分开存储，以增强数据泄露防护 | - |

探索使用 SmartKey 进行加密密钥管理的好处。SmartKey 的 HSM as a Service 交付模式简化了安全密钥存储的配置和控制；SmartKey 还提供加密和标记化服务，以优化性能并满足所有合规要求。开始非常简单：只需注册免费试用，您就可以快速进入更高效的加密密钥管理轨道。

## 参考资料
- [PostgreSQL 文档：pgcrypto](https://www.postgresql.org/docs/11/pgcrypto.html)
- [维基百科：密钥管理](https://en.wikipedia.org/wiki/Key_management)
- [Equinix 博客：硬件安全模块 (HSM) 与密钥管理服务 (KMS) 的比较](https://blog.equinix.com/blog/2018/06/19/hardware-security-module-hsm-vs-key-management-service-kms/)
- [硬件安全模块](https://www.hardware-security-module.com/)
- [《PostgreSQL 对称加密、非对称加密用法介绍》](../201802/20180226_03.md)
- [《[转载] 白话解释 非对称加密，电子签名，电子证书，根证书，HTTPS，PKI 到底是什么》](../201802/20180226_02.md)
- [《[转载] 对称加密与非对称加密》](../201802/20180226_01.md)

#### [PostgreSQL 许愿链接](https://github.com/digoal/blog/issues/76 "269ac3d1c492e938c0191101c7238216")
您的愿望将传达给 PG kernel hacker 和数据库厂商等，帮助提高数据库产品质量和功能。说不定下一个 PG 版本就有您提出的功能点。针对非常好的提议，奖励限量版 PG 文化衫、纪念品、贴纸、PG 热门书籍等，奖品丰富，快来许愿。[开不开森](https://github.com/digoal/blog/issues/76 "269ac3d1c492e938c0191101c7238216")。

#### [9.9元购买3个月阿里云RDS PostgreSQL实例](https://www.aliyun.com/database/postgresqlactivity "57258f76c37864c6e6d23383d05714ea")

#### [PostgreSQL 解决方案集合](https://yq.aliyun.com/topic/118 "40cff096e9ed7122c512b35d8561d9c8")

#### [德哥 / digoal's GitHub - 公益是一辈子的事](https://github.com/digoal/blog/blob/master/README.md "22709685feb7cab07d30f30387f0a9ae")

![digoal's 微信](../pic/digoal_weixin.jpg "f7ad92eeba24523fd47a6e1a0e691b59")

#### [PolarDB 学习图谱: 训练营、培训认证、在线互动实验、解决方案、生态合作、写心得拿奖品](https://www.aliyun.com/database/openpolardb/activity "8642f60e04ed0c814bf9cb9677976bd4")

#### [购买PolarDB云服务折扣活动进行中, 55元起](https://www.aliyun.com/activity/new/polardb-yunparter?userCode=bsb3t4al "e0495c413bedacabb75ff1e880be465a")

#### [关于 德哥](https://github.com/digoal/blog/blob/master/me/readme.md "a37735981e7704886ffd590565582dd0")