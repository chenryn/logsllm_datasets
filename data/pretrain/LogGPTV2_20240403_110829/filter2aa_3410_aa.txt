Let’s Sink The Phishermen’s Boat!
Teo Sze Siong, 
F-Secure Corporation
Sunday, June 29, 2008 Page 2
Why this topic?
• Internet banking has become more and 
more preferred choice
• Yet, many people don't understand the 
risk they are facing in online banking
• Keep antivirus software updated
• Use online banking on SSL-enabled websites only
• Use online banking on trusted machine only
• Use 2-factor authentication security feature
• Use latest web browser with fully patched plug-ins
• Keep antivirus software updated
• Use online banking on SSL-enabled websites only
• Use online banking on trusted machine only
• Use 2-factor authentication security feature
• Use latest web browser with fully patched plug-ins
Source: http://www.news.com.au/business/story/0,23636,22561818-5013952,00.html
Do you think the following practices 
protect you from phishing attack?
Answer is NO!
Sunday, June 29, 2008 Page 3
Phishing attack is not an issue that can be 
solved overnight!
• Billion dollar losses caused by phishing attacks
• Banks can't simply reverse transactions - legal issues
Source:
http://www.gartner.com/it/page.jsp?id=565125&format=print
Sunday, June 29, 2008 Page 4
Source: http://www.antiphishing.org/reports/apwg_report_jan_2008.pdf
How serious now?
• Currently, there is no complete automated solution to detect phishing accurately
• It is all over the world targeting different nationalities and different banks!
• Phishing techniques used are getting more sophisticated than before
Sunday, June 29, 2008 Page 5
Commonly used techniques in phishing
• DNS modification / cache poisoning a.k.a. pharming
• HTML / Javascript content with visual similarity (even Flash-based)
• Spoofed source email address
• ARP poisoning to redirect traffic
• API hooking (user mode / kernel mode)
• Browser plug-in (BHO mainly targeting Internet Explorer)
• Similar URLs / obfuscated encodings
• Hosting websites on fast flux network (usually botnet machines)
• Uses drive-by downloads to infect Trojan via software vulnerability
Sunday, June 29, 2008 Page 6
Flash-based phishing website
Source:
http://www.f-secure.com/weblog/archives/00001066.html
Sunday, June 29, 2008 Page 7
Example 1: Website with drive-by download
Sunday, June 29, 2008 Page 8
Analysis report of drive-by download website
2008/05/17 18:44:31 - [UTCD-INFO] Target: http://www.mongoliatourism.gov.mn/
2008/05/17 18:44:31 - [UTCD-INFO] Priority Level: 5
2008/05/17 18:44:31 - [UTCD-INFO] UMS's URL ID: 3643208
2008/05/17 18:44:31 - [UTCD-INFO] HTTP Request Metadata: null
2008/05/17 18:44:31 - [UTCD-INFO] Remaining Failure Retry: 3
2008/05/17 18:44:31 - [UTCD-INFO] URL Type: Web browser interpretable URL
2008/05/17 18:44:32 - [UTCD-INFO] Content-Type: text/html
2008/05/17 18:44:32 - [UTCD-INFO] Server Date: Sat, 17 May 2008 09:36:16 GMT
2008/05/17 18:44:32 - [UTCD-INFO] Server Type: Apache/2.2.8 (Unix)
2008/05/17 18:44:32 - [GOAT-INFO] WXPSP2-1: Windows XP Pro SP2 + Firefox 1.0 and IE6
2008/05/17 18:44:32 - [GOAT-INFO] IE6/IE7 = Enabled, Firefox1/2 = Enabled
2008/05/17 18:44:32 - [GOAT-INFO] Network IO Check Interval = 5secs
2008/05/17 18:44:32 - [GOAT-INFO] Network IO Activity Tolerance = 512bytes
2008/05/17 18:44:32 - [UTCD-INFO] Sending URL to UAE for automated analysis...
2008/05/17 18:44:32 - [UTCD-INFO] Analyzing website in VMware goat environment... 
2008/05/17 18:46:29 - [UTCD-INFO] Time elapsed 1 minutes and 57 seconds
2008/05/17 18:46:31 - [UTCD-INFO] Goat Process ID: 1636
2008/05/17 18:46:31 - [UTCD-INFO] IE6/7 Process ID: 1668
2008/05/17 18:46:31 - [UTCD-INFO] FireFox 1/2 Process ID: 1676
2008/05/17 18:46:31 - [UTCD-INFO] Pop-up Window(s) Found: 0
2008/05/17 18:46:31 - [UTCD-INFO] Analyzing tracer log... (2,363,042 bytes)
2008/05/17 18:46:31 - [UTCD-INFO] Time elapsed 0.102503061295 second
2008/05/17 18:46:31 - [UTCD-INFO] Exploited web browser: Internet Explorer
2008/05/17 18:46:31 - [UTCD-INFO] Suspicious folder creation count: 0
2008/05/17 18:46:31 - [UTCD-INFO] Suspicious file creation count: 3
2008/05/17 18:46:31 - [UTCD-INFO] Suspicious registry key creation count: 6
2008/05/17 18:46:31 - [UTCD-INFO] Suspicious process creation count: 4
2008/05/17 18:46:31 - [UTCD-INFO] Threat percentage: 100%
2008/05/17 18:46:31 - [UTCD-INFO] Conclusion: Malicious
===== DEBUG INFORMATION - GOAT MACHINE CHANGES =====
{'createdir': [],
'createfile': [
{'file': '%windir%\\system32\\drivers\\qdm33.sys'},
{'file': '%windir%\\system32\\winctrl32.dll'},
{'file': 'c:\\6lwxsu.exe'}],
'createkey': [
{'key': '%hkcu%\\s-1-5-21-1343024091-1417001333-839522115-1003\\parameters'},
{'key': '%hkcu%\\s-1-5-21-1343024091-1417001333-839522115-1003\\rfc1156agent'},
{'key': '%hklm%\\software\\microsoft\\windows 
nt\\currentversion\\drivers32\\controlset002'},
{'key': '%hklm%\\software\\microsoft\\windows nt\\currentversion\\drivers32\\qdm33'},
{'key': '%hklm%\\system\\currentcontrolset\\services\\qdm33'},
{'key': '%hklm%\\system\\currentcontrolset\\services\\security'}],
'newproc': [
{'1344,532': '%windir%\\system32\\cmd.exe'},
{'1392,1264': '%windir%\\system32\\svchost.exe'},
{'1392,1344': '%temp\\bn7.tmp'},
{'1668,1392': 'c:\\6lwxsu.exe'}]}
===== DEBUG INFORMATION - GOAT MACHINE CHANGES ======
Sunday, June 29, 2008 Page 9
Example 2: Website with drive-by download
Sunday, June 29, 2008 Page 10
2008/06/26 05:30:37 - [UTCD-INFO] Target: http://scit.hit.edu.cn/design/ShowArticle.asp?ArticleID=976
2008/06/26 05:30:37 - [UTCD-INFO] Priority Level: 5
2008/06/26 05:30:37 - [UTCD-INFO] UMS's URL ID: 5088202
2008/06/26 05:30:37 - [UTCD-INFO] HTTP Request Metadata: null
2008/06/26 05:30:37 - [UTCD-INFO] Remaining Failure Retry: 3
2008/06/26 05:30:37 - [UTCD-INFO] URL Type: Web browser interpretable URL
2008/06/26 05:30:38 - [UTCD-INFO] Content Length: 23,163 bytes
2008/06/26 05:30:38 - [UTCD-INFO] Content-Type: text/html
2008/06/26 05:30:38 - [UTCD-INFO] Server Date: Wed, 25 Jun 2008 21:33:09 GMT
2008/06/26 05:30:38 - [UTCD-INFO] Server Type: Microsoft-IIS/5.0
2008/06/26 05:30:38 - [GOAT-INFO] WXPSP2-2: Windows XP Pro SP2 + Firefox 2.0 and IE 7.0
2008/06/26 05:30:38 - [GOAT-INFO] IE6.0/IE7.0 = Enabled, Firefox1.0/2.0 = Enabled
2008/06/26 05:30:38 - [GOAT-INFO] Network IO Check Interval = 5secs
2008/06/26 05:30:38 - [GOAT-INFO] Network IO Activity Tolerance = 512bytes
2008/06/26 05:30:38 - [UTCD-INFO] Sending URL to UAE for automated analysis...
2008/06/26 05:30:38 - [UTCD-INFO] Analyzing website in VMware goat environment...
2008/06/26 05:32:15 - [UTCD-INFO] Time elapsed 1 minutes and 37 seconds
2008/06/26 05:32:15 - [UTCD-INFO] Goat Process ID: 1728
2008/06/26 05:32:15 - [UTCD-INFO] IE 6.0/7.0 Process ID: 8368
2008/06/26 05:32:15 - [UTCD-INFO] FireFox 1.0/2.0 Process ID: 8392
2008/06/26 05:32:15 - [UTCD-INFO] Pop-up Window(s) Found: 0
2008/06/26 05:32:16 - [UTCD-INFO] Analyzing tracer log... (20,669,663 bytes)
2008/06/26 05:32:16 - [UTCD-INFO] Time elapsed 0.760082960129 second
2008/06/26 05:32:16 - [UTCD-INFO] Exploited web browser: IE and Firefox
2008/06/26 05:32:16 - [UTCD-INFO] Suspicious folder creation count: 0
2008/06/26 05:32:16 - [UTCD-INFO] Suspicious file creation count: 7
2008/06/26 05:32:16 - [UTCD-INFO] Suspicious registry key creation count: 35
2008/06/26 05:32:16 - [UTCD-INFO] Suspicious process creation count: 4
2008/06/26 05:32:16 - [UTCD-INFO] Threat percentage: 100%
2008/06/26 05:32:16 - [UTCD-INFO] Conclusion: Malicious
Analysis report of drive-by download website
Sunday, June 29, 2008 Page 11
…continued
====================== DEBUG INFORMATION - GOAT MACHINE CHANGES ======================
{'createdir': [],
'createfile': [
{'file': '%internetcache%\\5ps8r2b2\\ko[1].exe'},
{'file': '%internetcache%\\6q9hncm8\\ko[1].exe'},
{'file': '%temp%\\orz.exe'},
{'file': '%windir%\\kdsv.exe'},
{'file': '%windir%\\system32\\drivers\\ntdapi.sys'},
{'file': '%windir%\\ugvq.exe'},
{'file': 'c:\\mahtesf3.bat'}],
'createkey': [
{'key': '%hkcu%\\ntdapi'},
{'key': '%hkcu%\\s-1-5-21-1343024091-1417001333-839522115-1003\\avs'},
{'key': '%hkcu%\\s-1-5-21-1343024091-1417001333-839522115-1003\\software\\microsoft\\windows nt\\currentversion\\image file execution options\\qqdoctor.exe'},
{'key': '%hkcu%\\s-1-5-21-1343024091-1417001333-839522115-1003\\software\\microsoft\\windows nt\\currentversion\\image file execution 
options\\qqdoctormain.exe'},
{'key': '%hklm%\\software\\microsoft\\windows nt\\currentversion\\windows\\clsid\\{a9895933-6636-4281-bc58-ee6de2af96e3}\\inprocserver32'},
{'key': '%hklm%\\software\\microsoft\\windows nt\\currentversion\\windows\\clsid\\{dc3d30ae-0380-4151-8934-ee98a34b0370}\\inprocserver32'},
{'key': '%hklm%\\software\\microsoft\\windows nt\\currentversion\\windows\\explorer'},
{'key': '%hklm%\\software\\microsoft\\windows nt\\currentversion\\windows\\inprocserver32'},
{'key': '%hklm%\\software\\microsoft\\windows nt\\currentversion\\windows\\inprocserver32'},
{'key': '%hklm%\\software\\microsoft\\windows nt\\currentversion\\windows\\inprocserver32'},
{'key': '%hklm%\\software\\microsoft\\windows nt\\currentversion\\windows\\inprocserver32'},
{'key': '%hklm%\\software\\microsoft\\windows nt\\currentversion\\windows\\software\\microsoft\\windows\\currentversion\\explorer\\browser helper 
objects\\{55694105-5108-9405-3695-954187462155}'},
{'key': '%hklm%\\software\\microsoft\\windows nt\\currentversion\\windows\\software\\microsoft\\windows\\currentversion\\explorer\\browser helper 
objects\\{5a069845-2036-6084-9054-6087502480a5}'},
{'key': '%hklm%\\software\\microsoft\\windows nt\\currentversion\\windows\\software\\microsoft\\windows\\currentversion\\explorer\\browser helper 
objects\\{7c8d1401-a58d-a81c-cd24-a5915c4517c7}'},
{'key': '%hklm%\\software\\microsoft\\windows nt\\currentversion\\windows\\software\\microsoft\\windows\\currentversion\\explorer\\browser helper 
objects\\{b490415f-65f8-b5c5-d8ba-9405fb12054b}'},
{'key': '%hklm%\\software\\microsoft\\windows nt\\currentversion\\windows\\windows'},
{'key': '%hklm%\\system\\currentcontrolset\\control\\nls\\locale\\alternate sorts\\{7a041f13-a111-12a3-b0cf-f99818aa68a7}'},
{'key': '%hklm%\\system\\currentcontrolset\\control\\nls\\locale\\alternate sorts\\{7c8d1401-a58d-a81c-cd24-a5915c4517c7}'},
{'key': '%hklm%\\system\\currentcontrolset\\control\\nls\\locale\\alternate sorts\\{a629ff4f-acdb-5c90-a098-facb3456a26a}'},
{'key': '%hklm%\\system\\currentcontrolset\\control\\nls\\locale\\alternate sorts\\{b490415f-65f8-b5c5-d8ba-9405fb12054b}'}],
'newproc': [
{'8196,8484': '%windir%\\kdsv.exe'},
{'8368,8964': '%temp\\orz.exe'},
{'8392,8196': '%temp\\orz.exe'},
{'8964,8268': '%windir%\\ugvq.exe'}]}
====================== DEBUG INFORMATION - GOAT MACHINE CHANGES ======================
Sunday, June 29, 2008 Page 12
…continued