区块链技术大量依赖于P2P网络，可以说没有P2P就没有区块链现在的发展。而区块链拥有去中心化的应用理论，所以对P2P的过程有着近似严苛的安全要求。本文围绕P2P网络的基础架构以及安全协议展开论述。内容是通过我的大量文献阅读之后进行的提炼。希望大家多多交流！
### 一、概述P2P网络
#### 1 何为P2P？
P2P（[peer-to-peer](https://www.baidu.com/s?wd=peer-to-peer&tn=SE_PcZhidaonwhc_ngpagmjz&rsv_dl=gh_pc_zhidao)）网络又称为对等式网络，或者点对点网络。这是一种无中心的服务器、完全由用户群进行交换信息的互联网体系，P2P网络的每一个用户即是一个客户端，同时也具备服务器的功能。在P2P技术之前，我们所有的网络应用都采用C/S或者B/S架构来实现的，然而在之前C/S架构的应用程序中，客户端软件向服务器发出请求，服务器然后对客户端请求做出响应，在这种情况下，如果客户端越多，此时服务器的压力就越大。然而采用P2P技术实现的每台计算机既是客户端，也是服务器，他们的功能都是对等的。对于安装了P2P软件（如迅雷，QQ等）的计算机加入一个共同的P2P网络，网络中的节点之间可以直接进行数据传输和通信。
那么有读者可能会提问：那我传统的P2P架构与C/S或者B/S架构有什么异同点呢？
#### 2 P2P架构和C/S架构的比较
相比于C/S，P2P有其自己独特的优势：所有的客户端都能够提供资源，包括带宽、存储空间已经计算能力。所以其网络容量可以远超其他模式。具体来说：
  * 1.对等模式
P2P系统中的客户端能够同时扮演客户端和服务器的角色，使两台计算机之间能够不通过服务器直接进行信息分享。也就是说信息的传输分散在各个节点，无须经过某个中心服务器，用户的隐私信息被窃听和泄露的可能大大减少。
  * 2.网络资源的分布式存储
在C/S架构中，所有客户端都直接从服务器下载所有数据资源，这样势必会加重服务器的负担，而P2P则改变了以服务器为中心的状态，使每个节点可以先从服务器上个下载一部分，然后再相互从对方或者其他节点下载其余部分。采用这种方式，当大量客户端同时下载时，就不会形成网络堵塞现象了。
而C/S架构有下面的缺点：
  * 1.服务器负担过重。当大量用户访问C/S系统的服务器时，服务器常常会出现网络堵塞等现象。
  * 2.系统稳健性和服务器关联密切。指的是——如果服务器出现了问题时，整个系统的运行将会瘫痪。
#### 3 区块链中的P2P
解释了这么多内容，那么我们现在就将区块链中的P2P技术单独拿出来，具体的分析下其中蕴含的道理。
从技术方面来分析，区块链技术就是——P2P+共识机制+密码学。具体来说，区块链就是P2P的网络架构，通过密码学来保证数据的安全，通过共识算法来保证数据的一致性。对于其他架构来说，故障是不可避免的。但是对于区块链的分布式P2P网络来说，其基本不存在单点故障。就算节点频繁的进退也不会对整个系统产生影响。
而我们知道区块链的落地项目有许多，但是我们可以将这些内容大致的分为三类——公链、私有链、联盟链。而公链是具有完全开放的特性的，所以其决定了它不回在网络中采用P2P加密。而对于其余的两者来说（尤其是联盟链），其节点间互相合作却又不完全信任的情况使P2P网络显的尤为重要。
### 二、P2P的分类
P2P 网络自身有多方面优点，在区块链的应用如下:
  * 1 去中心化
区块链的资源和服务分布在所有参与节点上，通过共识机制维护区块链网络一致性，无须中心系统的存在。
  * 2 可扩展性。
区块链节点可以自由加入、退出，网络系统根据节点自由扩展。
  * 3 健壮性。
区块链网络没有中心节点，也就没有了攻击对象。参与节点分布在网络中，部分节点遭到破坏对区块链系统无影响。（我们知道许多协议均是依靠CA来进行处理的，这也就成为了许多黑客攻击的对象。然后区块链并没有CA这种机制，所以也就规避了风险）。
  * 4 隐私保护。
区块信息采用广播机制，无法定位广播初始 节点，防止用户通信被监听，保护用户隐私。
  * 5 负载均衡。
区块链通过限制节点连接数等配置，避免资源负载、网络阻塞。
    针对区块链应用特点，按照 P2P 网络是否去中心化、节点地址是否结构化两个方面，将 P2P 网络分为如下四类。
#### 1 中心化 P2P 网络
在中心化网络中存在“ **中心服务器**
”，而其作用为保存接入节点的地址信息。倘若两个peer之间想要进行通信，那么它们可以通过中心服务器进行对方地址的索要。例如：
    将音乐文件与 保存文件的节点相互关联，用户查找某个音乐时，中心服务器告知储存节点地址，用户点对点连接以获得音乐。
由此可知，中心服务器是用来提供地址索引的（其他架构的中心服务器是提供所有的服务）。倘若其出现故障，那么整个系统就出现瘫痪了。
对小型网络而言，中心化拓扑模型在管理和控制方面占一定优势。但鉴于其存在的上述缺陷，该模型并不适合大型网络应用。
#### 2 全分布式非结构化 P2P 网络
因为它没有中央索引服务器，每台机器在网络中是真正的对等关系，既是客户机同时又是服务器。
全分布 P2P 节点可以自由加入退出，并且没有中心节点， 节点地址没有结构化统一标准，整个网络结构呈随机图的结构，
无固定网络结构图。然而完全的自由意味着新节点无法得知 P2P 网络节点信息，从而无法加入网 络。全分布式 P2P
网络更加自由化的同时也带来节点管理的问题，节点频繁加入、退出使得整个网络结构无法稳定， 大量的广播消息不仅造成资源浪费，甚至会阻塞网络。
而比特币采用的就是这种 P2P 网络结构，全分布式使得任 何人任何节点都可以参与，非结构化使得节点间既可以通过区 块链 P2P
协议同步区块数据，又保持匿名隐私保护。
举例如下：
    当一台计算机要下载一个文件，它首先以文件名或者关键字生成一个查询，并把这个查询发送给与它相连的所有计算机，这些计算机如果存在这个文件，则与查询的机器建立连接，如果不存在这个文件，则继续在自己相邻的计算机之间转发这个查询，直到找到文件为止。为了控制搜索消息不至于永远这样传递下去，一般通过TTL (Time To Live)的减值来控制查询的深度。
#### 3 全分布式结构化 P2P 网络
全分布式最大的问题在于节点地址管理，节点间没有固定规则约束，无法精确定位节点信息，只能通过洪泛查询方式进行查找，对网络的消耗很大。而结构化网络采用分布式哈希表
(distributed Hash table, DHT)，通过如 Hash 函数一类的加密散列函数，将不同节点地址规范为标准长度数据。
结构化模型与非结构化模型相思，但结构化模型的节点管理有固定结构图。例如：
    以太坊将节点椭圆加密算法的公钥转换为 64 Byte 长度的 NodeID 作为唯一标志符来区分节点，使得以太坊可以在没有中心服务器的情况下实现节点地址精确查找。
#### 4 半分布式 P2P 网络
结合中心化和分布式模型各有的优点，`半分布式 P2P 网络`将节点分类成普通 节点和超级节点，从而构成了半分布式网络结构。
超级节点维护部分网络节点地址、文件索引等工作，超级节点共同实 现中心服务器功能。超级节点本身却是分布式，可以自由扩展退出，具备分布式网络优点。
超级账本 hyperledger fabric 采用的 P2P
网络结构就如此。其将节点分为普通用户节点和超级节点(排序、背书节点等)。超级节点可以由普通节点选举，也可以自行配置，单独一个超级节点停机不影响系统运行。
### 三、密码协议解决方案分析
我们在上面的内容中介绍了P2P网络中的几种类型。下面我们详细介绍下关于区块链中的具体 **安全加密算法** 。
在描述协议前，我们先讨论下我们为啥们要使用P2P加密？
我们在区块链的节点之间、客户端之间需要建立安全的加密隧道，并防止在信息传输的过程中将敏感信息暴露给外人。除此之外，其也可以减少网络安全监管工作，提高安全性。
#### 1 传统通用SSL服务
简单来说，在比特币“钱包”的应用中，早起其应用使用了SSL进行客户端之间数据的加密。而SSL/TLS可以结合HTTP协议组合成HTTPS来加密web的内容，也可以与一些常用的FTP等协议进行组合来保证P2P网络中应用数据层的安全。
具体来说如下：