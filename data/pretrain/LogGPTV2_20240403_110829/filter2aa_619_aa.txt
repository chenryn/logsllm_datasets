# Building Secure Servers with Linux
# Tools & Best Practices for Bastion Hosts
# Michael D. Bauer

# O'Reilly Media
# Beijing • Cambridge • Farnham • Köln • Paris • Sebastopol • Taipei • Tokyo
# Copyright © 2002 O’Reilly & Associates, Inc. All rights reserved.

# Chapter 10: System Log Management and Monitoring
# October 16, 2002

## Introduction
Effective logging is a critical component of system security. Logs help in troubleshooting, provide early warnings of potential abuse, and offer essential forensic data in the event of a system compromise or crash. This chapter focuses on configuring and managing logs using `syslog` and `Syslog-ng`, as well as monitoring logs in real-time with `Swatch`.

## syslog
`syslog` is a robust and widely used Unix logging utility. It collects log data from the kernel (via `klogd`), local processes, and even remote systems. Its flexibility allows you to control what gets logged and where it is stored.

### Configuring syslog
The `syslog` daemon (`syslogd`) uses the `/etc/syslog.conf` file to determine how to handle log messages based on their facility and priority. Each line in this file specifies one or more facility/priority selectors followed by an action.

#### Example Configuration
```plaintext
mail.notice /var/log/mail
```
In this example, `mail.notice` is the selector, and `/var/log/mail` is the action. The selector consists of the `mail` facility and the `notice` priority.

#### Facilities
Facilities are categories of log messages. Common facilities in Linux include:
- `auth`: Security events.
- `auth-priv`: Access control messages.
- `cron`: Cron job messages.
- `daemon`: System processes and daemons.
- `kern`: Kernel messages.
- `lpr`: Printing system.
- `mail`: Mail system.
- `mark`: Timestamps generated by `syslogd`.
- `news`: Network news.
- `syslog`: Messages generated internally by `syslogd`.
- `user`: Default facility.
- `uucp`: UUCP subsystem.
- `local0` through `local7`: User-defined facilities.

#### Priorities
Priorities indicate the urgency of a log message. They are hierarchical and include:
- `debug`: Debugging messages.
- `info`: Informational messages.
- `notice`: Normal but significant conditions.
- `warning`: Warning conditions.
- `err`: Error conditions.
- `crit`: Critical conditions.
- `alert`: Action must be taken immediately.
- `emerg`: System is unusable.

#### Actions
Actions specify where log messages should be sent. Common actions include:
- **File**: Append messages to a file (e.g., `/var/log/mail`).
- **Pipe**: Send messages to a named pipe.
- **Device**: Send messages to a device file (e.g., TTY).
- **Remote host**: Send messages to a remote host (e.g., `@mothership.mydomain.org`).

### Advanced Configuration
You can list multiple facilities in a single selector and use semicolons to separate multiple selectors. For example:
```plaintext
mail,uucp.notice;uucp.!=alert /var/log/mail
```
This configuration logs all `mail` and `uucp` messages with priority `notice` or higher, excluding `uucp` messages with priority `alert`.

### Stealth Logging
Stealth logging involves sending log messages to a non-IP-addressed system that captures the messages without being directly accessible over the network. This can be useful for honey nets and production DMZs.

### Conclusion
Customizing `syslog` to meet your specific needs is crucial for effective log management. Use the `logger` command to test your `syslog.conf` rules and ensure they work as expected.

## Tables
### Table 10-1: syslog.conf’s Allowed Facilities
| Facility | Description |
|----------|-------------|
| auth | Security events |
| auth-priv | Access control messages |
| cron | Cron job messages |
| daemon | System processes and daemons |
| kern | Kernel messages |
| lpr | Printing system |
| mail | Mail system |
| mark | Timestamps generated by `syslogd` |
| news | Network news |
| syslog | Messages generated internally by `syslogd` |
| user | Default facility |
| uucp | UUCP subsystem |
| local0 - local7 | User-defined facilities |

### Table 10-2: syslog.conf’s Allowed Priorities
| Priority | Description |
|----------|-------------|
| debug | Debugging messages |
| info | Informational messages |
| notice | Normal but significant conditions |
| warning | Warning conditions |
| err | Error conditions |
| crit | Critical conditions |
| alert | Action must be taken immediately |
| emerg | System is unusable |

### Table 10-3: syslog.conf’s Types of Actions
| Action | Description |
|--------|-------------|
| File | Append messages to a file |
| Pipe | Send messages to a named pipe |
| Device | Send messages to a device file |
| Remote host | Send messages to a remote host |

By following these guidelines, you can effectively configure and manage your system's logs to enhance security and operational efficiency.