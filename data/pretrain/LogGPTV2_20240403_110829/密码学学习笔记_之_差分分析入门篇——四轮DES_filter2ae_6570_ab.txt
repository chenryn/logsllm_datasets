函数各个组件的性质第一条，差分不受轮密钥加的影响，所以后面也都不管它了）但是第一组是以差分为 4 进入 S 盒的，由于性质第三条，S
盒的输出差分不确定，这与输出差分有关，也与具体的输出有关。所以，这一轮 S 盒的输出差分为 ***0000000** ，之后还得 P 盒置换，所以B’ =
P(*0000000)。 **那么第二轮走完** ，左边等于B’ ⊕ R’ = P(*0000000) ⊕
00000000=P(*0000000)，右边等于b’ = 20000000
**开始第三轮** ，这一轮开始就要乱起来了。首先这个轮函数的输入是 c’ = B’ ⊕ R’= P(*00000000)，我们看一下具体的 P 盒，
这里我们不确定的前四个bit被扩散到了第3，5，6，8组，也就是说现在我们的c’ = 00*0**0*，然后这里还要先E 盒拓展，看看 E 盒
那么进入S 盒前
可以看到，几乎每一组都被”污染了“，只剩第5组还是 0 那么 C’ = ****0***，然后这里还有一个 P 盒置换， **那么第三轮走完，**
左边等于C’ ⊕ b’ = 20000000 ⊕ P(****0***)，右边等于c’ = ****0***（注，这里 * 为不确定的意思，进入S 盒前的
* 大概率不等于出 S 盒后的 *）
**到最后的第四轮了** ，此时进入 S 盒的是d’ = C’ ⊕ b’,万幸只有四轮，所以d’ = r’,由于r’ 是可由最后的输出密文右半部分求一个IP
逆置换而来，因此，d’ 已知。
我们直接计算d’ 可以发现 d’几乎不会有 0 bit，也可以推一下，因为 d’ = P(****0***) ⊕ 20000000，而由于这个P
盒置换，第5组最终也会被”污染“，那么可以预见，每一组进入 S 盒的差分都被”污染“了，也就是说每一个 S 盒都会被激活。这也就是书中所说的 **简单分析
S 盒针对差分的扩散特性以及拓展变换 E 的性质可知，第 4 轮轮函数的输入差分 r’ 也即 d’ 经过拓展变换 E 后（成为 S
盒的输入差分)，E(r’) 几乎会让 8 个 S 盒 都活跃，即这个 8 个 S 盒的输入差分都非0。**
那么到此四轮DES分析完毕。其实也就说明了一个问题，进入第四轮的 S 盒的输入会激活所有的 S 盒，然后进入第四轮 S 盒的输入差分已知，从第四轮后面7个
S 盒出来的输出差分可求，由此我们可以建立对这7个S 盒的差分分析模型以求出第四轮的轮密钥。
接下来简单讲讲具体怎么求。
首先拿到最后的输出明文差分 Y’,首先对右半边求 IP 逆置换得到 d’=r’，然后对其用 E盒 做拓展置换。先打住，我们去求一下第四轮 S 盒
的输出差分P^{-1}(D’)
我们拿到输出明文差分Y’,对做半边求 IP 逆置换得到 l’ = c’ ⊕ D’,这个c’ = a’ ⊕ B’ = 00000000 ⊕
P(*00000000) ，
第四轮的轮密钥会分为8组，分别和经过 E 盒拓展置换的 8 组输入异或后最终进入 S
盒。这8组输入差分在与轮密钥异或前后是不会变的，但是我们再次强调前面提到过的第三条性质： **S 盒：S(x) ⊕ S(x*) = y ⊕
y*，结果不确定，不仅与x ⊕ x* 有关，还与 x 有关**
。输入的差分没变，但是两次输入的具体值因为轮密钥的异或，会发生变化。因此改变这里的轮密钥，是会使得 S 盒的输出差分受影响的。
但是呢，但是呢，我们不是已经知道输出差分了么？啊哈，那么很显然了，我们只要不断地尝试每个 S 盒那一组的轮密钥——轮密钥加，再 S
盒输出差分，然后对比我们已知的输出差分，如果匹配，则该轮密钥放入待选集合。由于每个 S 盒只用到 6bit 轮密钥，因此穷举复杂度只有 7×
2^6，完全可以接受。然后会出现多解的情况。换一组具有相同差分（非必须，差分为40000000
00000000也可）的明文输入，得到一个新的解集，再取交集即可。根据实际情况，一般取四对差分明文就能有很大概率解出 42 bit的轮密钥。
然后现在有两个选择，一个是选择复杂度为 2^{14} 穷举，另一个是换一下差分，不要激活到第一个 S 盒就行。这样就能恢复全部的48
bit密钥，然后再进行复杂度为 2^8 的穷举，两种复杂度倒也都是能接受的。
有了48bit的轮密钥后，我们知道密钥拓展用的压缩 P 盒
1.所以我们先根据 P 盒将 48 bit 的密钥位置先还原，  
2.剩下的空位再直接穷举，最后得到56bit的轮密钥，  
3.然后根据轮密钥生成的方式，将第四轮轮密钥还原成最初的密钥，  
4.然后我们选取一对服务端生成的明文密文对，用我们的密钥对明文进行加密，  
5.观察得到的密文是否与服务端生成的密文一致，若一致则得到正确密钥，否则回到第二步。
至此，4轮DES差分就到此结束了。可以看到，还没有用到概率论的知识，这是因为轮次比较少，前面我们分析的每一轮都是确定的，而等轮次增大到8轮以后就要开始引入统计分析与概率论了，取寻找概率较大的差分路径，这才是差分分析的完全体。
**Remark** ：前面我们提到，
**DES差分分析的关键就在于其S盒差分分布的不均匀特性，何为不均匀特性，即相同的差分进入S盒，输出的差分是不均匀分布的。**
现在回头来看看这句话应该就能理解了，如果S盒差分分布均匀，相同地输入差分能够得到相同的输出差分，那么，我们就没办法去穷举验证我们的轮密钥了，因为我们没有了标准去区分密钥的正确与否。
## 结语
差分分析入门篇到此告一段落，希望接下来能有进阶篇叭，如果我学的会，能够理解的话哈哈哈哈哈哈哈哈哈哈哈哈哈。