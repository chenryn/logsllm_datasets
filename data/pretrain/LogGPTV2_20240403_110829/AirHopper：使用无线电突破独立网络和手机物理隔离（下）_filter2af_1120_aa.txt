# AirHopper：使用无线电突破独立网络和手机物理隔离（下）
|
##### 译文声明
本文是翻译文章，文章原作者 arxiv.org
原文地址：[Mordechai Guri](Mordechai Guri)
译文仅供参考，具体内容表达以及含义原文为准。
## 传送门
[AirHopper：使用无线电突破独立网络和手机物理隔离（上）](https://www.anquanke.com/post/id/95429)
## 5.隐身
为了在传输过程中保持隐身，AirHopper使用多种技术来实现视觉和被传送信号的隐身。
###  5.1 视觉隐身
本节将解释如何在电脑屏幕上实现所传输数据的视觉化隐身。推荐的三种技术利用的是配有附加显示器的标准化通信方式。HDMI、DVI和VGA
显示器以及VDU（视频显示单元）采用的是显示数据通道（DDC）协议族 。
显示数据通道命令接口（DDC/CI）本身是计算机显示器和VDU之间的一种双向通信协议。显示器控制命令集（MCCS）是一种由视频电子标准协会（VESA）制定的标准，特指通过DDC/CI通信协议控制显示器的命令集。
####  5.1.1 在显示器关闭状态下发射信号
通过使用DDC/CI，发射器能够在确定显示器处于关闭后才开始发射信号。当计算机在预定期间内处于空闲状态时，显示器会因为电源的节能设置而进入关闭状态。一旦发射器检测到显示器重新开启，它就会停止发射信号。需要注意的一点是，由于VDU会不断产生信号，而显示器电缆仅作为天线加以使用，因此信号传输只会在显示器关闭的状态下有效进行。从技术上讲，通过检查DDC/CI的电源控制状态（地址
0xe1）可以确定显示器的状态。发射器对这一状态进行持续采样，并同时在一个专用线程中对ioctl（I/O控制）进行顺序询问。0 表示屏幕处于关闭状态。
####  5.1.2 关闭显示器
通过使用
DDC/CI，传输代码也可以发送有意关闭显示器的命令。这种方法可以同样应用于屏幕保护程序；代码能够监视用户的计算机活动，并等待一段空闲时间。如果计算机处于闲置状态，它将关闭监视器并启动数据传输，直至检测到出现相关活动（如移动鼠标或敲击键盘）。然后它将停止数据传输并重新打开显示器，所有的表现都和正常的屏幕保护程序或电脑节电功能相同。与前面的方法类似，通过使用
ioctl 编写1或0至0xe1，完成打开或关闭显示器的操作。
####  5.1.3 将显示器切换到另一台计算机
在用户电脑屏幕上实现所显示图像隐身的另一个方法是利用通用的键盘视频鼠标（KVM）切换器。KVM开关是一种可以允许桌面基本外围设备、键盘鼠标和显示器在多台计算机之间共享的设备。通过单击KVM切换器上的一个按钮或使用键盘组合键，用户就可以在不同电脑之间切换。由于KVM切换器允许用户在一张办公桌上舒适地使用多台计算机，通常用于拥有物理隔离网络的企业。通过使用DDC/CI，发射器可以检测出KVM在不同计算机之间切换的时间，并据此相应地开始或停止传输数据。
####  5.1.4 使用辅助显示输出
本文测试的另一种方法是：迫使VDU在某个特定的视频输出上进行数据传输，即使它没有检测到可连接的显示器。当一台计算机（笔记本电脑或台式机）有多个显示输出时，这一功能将会非常有用。传送的代码可以检测到当前正在使用的是哪一个视频输出，并将传输重定向至某个闲置输出。由于大多数情况下只有一根显示电缆处于连接状态，而在没有显示电缆作为天线的情况下进行数据传输要求与接收器保持极近的距离，因此该方法仅适用于使用者将其手机放置在紧靠笔记本或台式机的情况下。另一种情况是，当笔记本电脑或台式机在会议室中使用时，其与投影仪之间拥有辅助的持久性连接。由于投影仪输出在大部分时间内处于关闭或连接断开状态，因此为进行长时间的数据传输提供了不易为人所觉察的良好机会。我们的测试也表明，通常用于连接投影仪的非屏蔽式长电缆也十分适用于高质量传输，且可以通过相邻房间里的手机予以接收。
###  5.2 信号隐身
另一种检测风险是被传输信号的意外接收情形。由于调制传输数据的系统使用的是可听的音调频率，因此如果将一台常规的FM接收器调到用于传输的载波频率，则会生成可能引起嫌疑人警惕的音调。为了减少这种被意外检测到的风险，我们将手机的FM接收频段扩展至
76MHz-108MHz，将传输载波频率调整至80MHz。
只有极少数国家（如日本）在76MHz～87.5MHz之间进行FM传输。世界其他地方的大多数FM接收器不允许在这个范围内进行收听或搜索无线电信号。然而，我们发现，虽然手机的FM芯片实际上支持非标准范围，但上层的软件层却对此加以禁用。通过在扩展范围中进行数据传输，可以在大多数国家中避免被偶然发现。在接收手机上，我们通过使用smali反汇编程序修改Samsung框架，从而扩大接收的频率范围[17]。从技术上讲，该框架文件位于
/system/framework目录下。通过将BAND_76000_108000_kHz的值设置为
1，我们对com.android.server数据包中的FMRadioService类进行了更改。这种在操作系统级代码上的更改无法被手机用户所察觉。与此同时，使用一个非标准的频段既有助于避免与当地的无线电广播产生冲突，也可以允许使用更广泛的可用传输频率。另一种防止被意外检测到的方法是改变手机的频率搜索间隔，将从默认的200KHz改为50KHz。这允许发送器和接收器代码微调到许多FM接收器不允许对普通用户开放的载波频率，从而避免遭遇意外检测的风险。
## 6\. 评估
在本节中，我们将评估假定的数据攫取方法的可行性和有效性。用于提高效率的主要措施包括发射的信号强度、有效的广播距离、传输速率、传输质量、电池消耗和扫描时间。影响因素包括电缆类型、接收机天线存在与否、调制方法（A-FSK或DTMF）、载波频率、信号延时、所发送的数据大小以及发送频率的范围。在给出相关实验设置的简短描述之后，下文进一步解释了用于提高效率的多种措施及其影响因素，阐述了它们之间的相关性。
###  6.1 实验设置
所使用的显示器是三星SyncMaster SA450。操作系统是64 位Ubuntu
13.04（代号raring）系统，内核为3.8.0-29-generic。
手机是三星 GT I9300 Galaxy S3。Android版本是三星 stock 4.1.2。基带版本是 I9300XXEMC2。内核版本是
3.0.31-1042335。无线电芯片是芯科实验室Si4705 FM无线电接收器IC。我们使用的是手机标配的 1.22 米（4
英尺）立体声耳机。需要注意的是，在这款手机中，耳机被用作 FM 接收器的天线。
我们使用四种类型的电缆来连接计算机的显示器：（I） 标准VGA电缆，1.52 米（5 英尺）、30V、接口类型15pin、正极对正极； （II）
标准VGA电缆，0.91 米（3 英尺）、HD15、正极对负极，通常用来作为投影仪延长线；（III） HDMI电缆，0.91 米（3
英尺）、30V。（IV） DVI 电缆，1.82 米（6 英尺）、30V。下文将这些缆线分别简述为标准VGA、扩展 VGA、HDMI和DVI。表 1
提供了电缆类型的相关分类（即屏蔽/非屏蔽、 模拟/数字）。
**表1 电缆分类**
###  6.2 信号强度
随着与发射器之间的距离逐渐增加，接收到的信号强度预计将会逐渐下降。我们测量了不同距离处的接收信号强度指示 （RSSI）（见 图 3）以及
dBm（毫瓦分贝，见图 4）。RSSI通常是由芯片API显示的信号质量指标。RSSI 的测量可以通过调用IFMPlayer的getCurrentRSSI
函数完成，其隶属于 FM 收音机播放器内置的一项三星公司服务。可以使用外置的频谱分析仪测定 dBm 的值。RSSI
的测量显示值与有效距离相关；若RSSI刻度上的测量值为10，则大致表示每根被测电缆的有效距离限值。
图3 使用A-FSK时，不同距离处的信号强度（RSSI）。  
（由移动电话的FM接收器测得）
图4 使用A-FSK时，不同距离处的信号强度（dBm）。  
（由外置的频谱分析仪测得）
###  6.3 有效距离
有效距离是发射器和接收器之间的最大距离，此时的传输质量仍处于可接受的程度。从图 5 中可以看出，使用接收天线时，非屏蔽电缆（扩展
VGA）的有效距离会显著大于屏蔽电缆（HDMI 和标准 VGA）。总而言之，当接收天线存在时，这两种类型电缆的有效距离大约为8~20
米，符合我们的实验要求。  
一些新型号的手机都配备了内置的FM天线，则不再需要使用耳机。
图5 使用A-FSK时，不同距离处的信号强度（RSSI）。
###  6.4 数据调制方法
信号发送方法（即 A-FSK或DTMF）也会对有效距离产生一定的影响。从图 6中可以看出，A-FSK能够产生的有效距离稍长一些。
图6 使用A-FSK和DTMF时，不同类型电缆在有接收天线的情况下的有效距离
###  6.5 传输质量
传输质量（也指“成功率”）表示的是每原始发送字节中正确接收到的字节比率。这一比率采用不同的信号延迟加以衡量，即为传输一个字节所分配的数据时间间隔
（以毫秒为单位）。
如图7
所示，传输质量和信号延迟之间的相关性呈对数关系，逐渐接近100%。若信号延迟超过70ms，额外的传输质量似乎可以忽略不计。之所以将延时时间设置为70ms较为合理，其原因是延迟时间越长会导致传输速度变慢，以致无法明显地改善传输的质量。
图7：使用DTMF时，不同信号延迟情形下的传输质量
正如表格2所示，我们测量了每种类型电缆在不同距离处的传输质量（或成功率）。信号延迟为最优值70
毫秒。该表中显示的测量值为0.3m、6.2m以及传输质量处于可接受程度下的最大距离（或有效距离）处的传输质量。可以看出，不同类型电缆的最大距离值不同。
表 2 中的数值反映的是传输质量；在达到最大距离之前（因电缆类型的不同而有所差异），这一数值随着距离的增大几乎保持在固定不变的高数值上。
**表 2：使用DTMF时不同距离处的传输质量**
###  6.6 数据大小
有效的数据攫取行为将实际限制放置在传输时间上。在被入侵的计算机上运行的传输程序应隐藏自身的活动，限制所收集数据被广播的安全时间间隔。此外，接收手机不会无限期地处于发射器的有效范围内。
在表格3中显示了各种类型文件（典型大小）使用原始数据或结构化数据包传输方式时所需的传输时间（如“实施”一节中所描述的）。实验发现，70ms延迟是最佳的选择。传输极少量数据（100
字节以下，如IP&MAC或密码）所需的时间少于10秒，这看来还可以接受。传输少量数据（10 KB以下，如系统信息或单日键盘记录）