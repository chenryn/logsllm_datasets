**技术交底书**
  -------------------------------------- ------------------------------------ -------------- ---------- ---------------
  **发明名称**                           **一种业务链的多字段撮合关联方法**                  **案号**   
  **关键词**                                                                                            
  **专利方案是否已在公司产品上应用**                                          否 是 ：                  
                                                                              （产品名称                
  **专利方案是否即将在公司产品上应用**                                        否 是 ：                  
                                                                              （产品名称）              
  **备注**                                                                                              
  -------------------------------------- ------------------------------------ -------------- ---------- ---------------
  ------------------------ -------------------- ----------------------- ----------------
  **发明人姓名**           （第一发明人）       （第二发明人）          （第三发明人）
  **工号**                 绕琛琳               梁玫娟                  
  **入职时间**                                                          
  **座机**                                                              
  **手机**                                                              
  **邮箱**                                                              
  **所属项目组**                                                        
  **部门主管**                                                          
  **奖金比例**                                                          
  **第一发明人身份证号**                                                
  ------------------------ -------------------- ----------------------- ----------------
> 1 发明名称：
**一种业务链多字段撮合关联方法**
2.  详细介绍技术背景,并描述已有的与本发明最相近似的实现方案
> 关于本发明的背景技术，请您简单介绍现有的一、两种现有技术的实现方法。该现有技术必须是与本发明相关的现有技术，且该现有技术必须存在本发明所能解决的技术问题）
当前在金融信息系统中，一个完整的服务链往往贯穿多个系统，需要在多个应用中调用才能满足一次用户请求。需要把多个系统的日志关联成交易明细日志，交易类型不同，涉及的系统不同。比如某次交易明细日志需要关联
ebank系统日志 -\> esb系统日志 -\>
fss系统日志这三个系统，优秀的应用日志中往往包含用于贯穿与上述服务请求相关的所有应用的事务的ID(ID
of the
transaction，transactionID)或用于关联任意两个上述应用的左右键关联ID。但是旧的日志系统中，应用日志往往缺少全局规划，并没有transactionID或左右键关联ID，只是部分应用之间存在关联。在各日志中没有transactionID或左右键关联ID的情况下，为了定位一个问题，从应用A中搜索到某条日志后，需要运维人员根据经验使用应用A中日志的相关字段再去查找其他相关的应用日志。例如通过手机号／卡号
对所有业务主机进行grep操作，找出相应日志。
3 现有技术的缺点是什么？
（客观评价现有技术的缺点，他们存在的问题必须是本发明所能够解决的问题，如果不能解决，可以不用提，如果无法指出存在的问题，可以不介绍现有工具的实现方法，只说用户有这种需求即可）
效率低下，费时费力，由于应用日志经常是海量数据，人工搜索难以涉及到所有的应用日志，即难以保证搜索的完整性。同时grep会命中较多的日志，需要运维人员一条条过滤，找出真正交易报文，经常需要grep多次才能准确找出请求报文；该操作对运维人员的工作经验要求极高。在涉及到多系统的交易出现故障时，未必是当前使用的模块出错，管理员如果不了解其他模块逻辑，就无法通过日志进一步关联搜索其他模块报文日志。
4.  本发明技术方案的详细阐述，应该结合流程图、原理框图、电路图、时序图进行说明
> （越详细越好；最好能够配合流程图和结构图等进行说明。发明中每一功能的实现都要有相应的技术实现方案，以别人不看附图即可明白技术方案为准；所有英文缩写都应有中文注释；所有附图都应该有详细的文字描述，同时附图中的关键词或方框图中的注释都尽量用中文；方法专利都应该提供一个流程图，并提供相关的系统装置.
-   含有程序的方法发明：该类申请包括解决特定技术问题的应用程序和计算机硬件系统，应结合相关硬件，按相应的应用程序流程图来描述该程序所执行的各个功能，即实现各个功能的步骤等，可以设计相关的工艺参数、数学模型和操作条件。）
对于不同的业务系统串联需求，我们采用以下方法：即选定任意两个相邻的系统的两个特定的日志行，比较这两行日志中的字段值，根据字段值相同数量最多的优先规则进行自动撮合关联。例如交易串联中相关日志可能是通过用户名，身份证号，金额字段关联起来。
![](media/image1.png){width="5.7652777777777775in"
height="3.1944444444444446in"}
具体处理步骤如下：
1)  收取海量数据，抽取时间信息，并将提取出的时间信息转成统一的时间格式：\"timestamp\"
    ： \"2011-09-12T13:00:42.000Z\"；
2)  根据解析规则确定字段(field)和字段值(value)的分隔符、字段之间的分隔符，抽取关键字段，并建立统一的field_name
    ：field_value格式；
3)  数据预处理，利用机器学习算法，通过降维和聚类找到相邻两个系统间日志共同覆盖的最小字段集合；具体处理过程为：
```{=html}
```
1.  根据 name:value 做聚类的模式树，排除掉 value 值基本一致的
    > name，只留下高基数的 name；
2.  以这些 name:value 作为日志的特征变量，进行 PCA 计算，按照 PCA
    > 的载荷矩阵，得到每个 name 对主成分的贡献度；
3.  对剩下的 name 按贡献度排序，作为后续对比时的优先顺序。
```{=html}
```
4)  创建transactionize命令对上述步骤3）中得出的最小字段集合中的字段进行比对，得出关联关系
    transactionize命令格式：
logtype:apache
\|limit 3
\| transactionize config=\"\[{
\\\"name\\\":\\\"xxx\\\",
\\\"query\\\" : \\\"hostname:\$hostname\$\\\",
\\\"query_size\\\": 1,
\\\"sort\\\":\\\"field_similarity\\\",
\\\"limit\\\": 3,
\\\"sort_fields\\\": \[\],
\\\"sort_ignore_fields\\\" : \[
\\\"id\\\"
\],
\\\"sort_ignore_string_below\\\": 1,