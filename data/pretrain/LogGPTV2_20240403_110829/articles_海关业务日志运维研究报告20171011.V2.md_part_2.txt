通过的磁盘数据结构提供消息的持久化，这种结构对于即使数以TB的消息也能够保持长时间的稳定性能。
高吞吐量，即使是非常普通的硬件也可以支持每秒数百万的消息。
消息队列对消息保存时根据Topic进行归类，一个Topic可以认为是一类消息，每个topic将被分成多个partition(区),每个partition在存储层面是append
log文件。任何发布到此partition的消息都会被直接追加到log文件的尾部，每条消息在文件中的位置称为offset（偏移量），offset为一个long型数字，它是唯一标记一条消息。
![](media/image5.png){width="3.5305555555555554in" height="2.28125in"}
### 集群资源同步与管理技术
一个针对大型分布式系统的高可靠协调系统，提供的功能包括：配置维护、名字服务、分布式同步、组服务等。封装好复杂易出错的关键服务，将简单易用的接口和性能高效、功能稳定的系统提供给用户。由3台或3台以上奇数台服务器组建完成，具有如下3个特性：
提供丰富的构件来实现多种协调数据结构和协议。
访问原子性，客户端要么读到所有数据，要么读取失败，不会出现只读取部分的情况。
具有高可用性，帮助系统避免单点故障，故障时可以快速删掉故障服务器。故障回复时，重新加入到集群。
### 日志分析技术
采用业界最先进的流式大数据处理架构Spark
Streaming，构建的高性能、分布式日志处理架构可以每秒钟分析10万条日志，每天可以处理TB级的日志量，而且处理延时非常短，可以让用户搜索、分析几秒钟之前产生的日志。
流式计算集群具有如下特性：
● 轻量级快速处理
着眼大数据处理，速度往往被置于第一位。Spark允许Hadoop集群中的应用程序在内存中以100倍的速度运行，即使在磁盘上运行也能快10倍。Spark通过减少磁盘IO来达到性能提升，它们将中间处理数据全部放到了内存中。
● 无数据丢失
系统需要保证无数据丢失，这也是系统高可用性的保证。系统为了无数据丢失，需要在数据处理失败的时候选择另外的执行路径进行replay（系统不是简单的重新提交运算，而是重新执行调度，否则按照来源的call
stack有可能使得系统永远都在相同的地方出同样的错误）。
● 容错透明
用户不会也不需要关心容错。系统会自动处理容错，调度并且管理资源，而这些行为对于运行于其上的应用来说都是透明的。
### 搜索引擎技术
索引集群是一个的分布式搜索引擎，具备高可靠性和高性能。支持时间文本索引和全文检索，提供丰富的api用于索引、检索、修改大多数配置。能够快速搜索数百亿的日志以及TB级的结构化或者非结构化的数据。
集群由2台及2台以上节点组成，其中一个为主节点，节点通过选举产生，主从节点是对于整个集群内部来说的，从外部来看整个集群，逻辑上是一个整体，与任何一个节点的通信和与整个集群通信是完全一致的。集群自动创建索引，通过配置我们可以非常方便的调整索引分片和索引副本。通过索引分片技术，一个大的索引被拆分成多个，然后分布在不同的节点上，以构成分布式搜索。索引副本的作用一是提供系统的容错性，当摸个节点摸个分片损毁或丢失时，可以从副本中恢复；二是提供查询效率，集群内部会自动实现搜索请求的负载均衡。
### 前端服务技术
采用LVS + Nginx构建的前端机器，主要有以下特点：
-   Http、rest协议
-   水平扩展
-   流量上涨时可快速通过增加前端机来提高处理能力
-   高吞吐、低延时
-   纯异步处理，单个请求异常不会影响其他请求
-   内部采用专门针对日志的Lz4压缩，提高单机处理能力，降低网络带宽
5.  **日志运维平台优势**
IT部门的价值首先是业务保障，业务得到保障，企业的正常活动才能开展，业务故障及时的处置，使运维工作能够更好地为业务服务，业务能够更快从故障中恢复，获得更高的可用性。
使用日志运维平台，能改变原有的被动式运维方式,
原有金关工程二期应用支撑平台日志管理系统、金关工程二期日志分析系统、安全运管中心等日志缺乏集中管理机制及关联分析能力，运维人员更多依靠用户电话反馈发现问题，依赖运维人员经验，人工追查各系统日志、排查故障原因的落后模式。
通过日志运维管理平台，运维人员能获得可量化的数据及全面的服务质量指标，方便系统优化及汇报，同时通过日志分析技术帮助运维人员对各IT组件对业务系统影响的权重度评估、各IT组件的风险预测，各IT组件的可用性监控，还能够对公司所有设备和业务系统的运行趋势进行分析，做到及时预警，提升管理决策。
日志运维平台优势：
-   实时性强
> 建立统一的日志运维平台实时采集数据，对海量日志信息进行组合条件检索查询，真正实现了即查即显。查询结果根据归一化后的格式展现。同时为具有一定专业知识的运维人员提供归一化日志与原始日志同屏显示功能，运维人员可以更深入的分析原始日志数据。支持多条件日志检索查询；支持原始日志全文检索。
-   一体优化考虑，一站式问题会诊
> 日志运维平台改变了传统的日志数据使用模式，将日志集中采集，运维人员基于多种维度全面审视，通过日志关联分析等方式，快速定位，排查故障原因。
-   可对操作人员行为审计
> 满足审计记录的规范化的需求，由于全网设备种类繁多，各设备日志信息存储格式、字段含义、通信协议差异较大。需要对采集到的各种设备日志进行归一化处理，提取审计记录完整信息，为后续审计分析提供依据。
运维平台要可持续扩展、不形成信息孤岛，不受业务变更左右运维平台发展。同时，日志运维平台兼容云平台和虚拟化环境，支持开源平台数据接入，
最大程度保障系统可用性规避软件快速迭代，不受业务变更影响，可与原有监控平台之间结合，不浪费客户原有投资减轻客户在开发及维护上的负担，保证可持续扩展。
当前海关缺乏对业务日志的收集，IT运维必须面向业务，以业务为导向。运维日志平台能集中采集业务日志，将运维工作与业务融合，实现业务关联分析、业务支撑的服务评价和业务系统健康管理，为业务部门提供价值。
6.  **日志分析**
通过对海关提供的部分业务及安全日志进行分析
## 业务日志分析
海关业务系统运行情况内部体现在性能和日志中，外部主要体现在业务量统计上。目前已有利用业务统计量来展示业务系统的运行情况。而审单日志则可以直接反映海关业务系统运行效率及运行业务情况。
本次项目针对海关业务系统日志，重点关注深圳及广州两个海关日志，对已有故障进行复现。
原始日志：
![C:\\Users\\Think\\AppData\\Roaming\\Tencent\\Users\\783170398\\QQ\\WinTemp\\RichOle\\ND\~0E%(R6E(@1H@IQ3DND\$5.png](media/image6.png){width="6.135416666666667in"
height="3.300698818897638in"}
故障介绍：
广州海关电子审单频繁出现异常造成报关单无法通过审单。
广州海关技术处于12月30日上午11时开始发现电子审单出现异常，审单服务没有响应，报关单无法通过审单，派单表积压。
通过日志检索，查看广州海关审单总量变化趋势：![](media/image7.png){width="6.4684055118110235in"
height="1.4013910761154855in"}
从图中可以看出，审单量变化趋势呈周期性变化，以七天为一周期，工作日正常情况呈双波峰状态变化。
与历史同期对比，发现12月30日审单总量变化趋势明显异常。由此重点展示12月30日广州海关审单业务运行情况。12月30日广州海关报错量（深）与审单量（浅）对比：
![](media/image8.png){width="6.479166666666667in"
height="1.3605314960629922in"}
统计出各地服务器审单时间及最高审单数量及对应出现的时间，对比业务运行正常的12月28/29日及发生故障的12月30日所出现的报错信息统计，可以看出出现明显的异常，对30日报错原因进行统计分析：
![](media/image9.png){width="6.435115923009624in"
height="2.8235968941382326in"}
## 安全日志分析
对安全日志进行分析，即充分利用安全设备生成、采集、报送的日志，通过日志分析深度挖掘需要核心关注的安全风险与威胁，完全契合用户排查安全事件的整个流程，对安全日志分析如下内容：
告警、内部地址、网络应用、服务访问。
对告警的内容进行分析展现：
1.  被攻击设备数：每个小周期内的ip去重，统计被攻击设备个数。
2.  告警数趋势：查看告警个数载各时间段的分布。
3.  告警级别分布：查看高中低告警的个数及分布。
4.  告警类型分布：查看告警类型及具体数目。
5.  攻击最多的设备：发出攻击次数最多的设备。
6.  中高级被告警设备：问题设备排名。
对内部地址发生的事件进行分析展示：
1、TCP重置包：查看哪个周期出现了网络异常。
2、TCP收发差：查看哪个周期可能发生了扫描事件。
3、异常2小时TCP重置包：查看异常事件段中的具体时间。
对网络应用日志进行分析：
1、软件下载量：查找异常下载的软件。
2、网络应用异常流量：网络应用的流量出现高频度的巨量增长。
![../汇报内容/科来网络应用1.png](media/image10.png){width="5.666666666666667in"
height="2.3958333333333335in"}
> 通过日志分析展示内容：
1.  服务连接流量：查看哪些设备大量连接过服务。
2.  连接服务端：查看哪些服务端被大量连接。
3、主要连接端口：将端口连接数做排名。
安全设备的很多行为都与攻击行为类似：例如地址扫描、端口扫描、弱口令猜测、网络结构探测等行为。因此在不了解安全设备的具体分布的情况下，不能准确的对网络行为做进一步判断，非常有必要对安全设备的日志生成、采集、保送做盘点，如下：