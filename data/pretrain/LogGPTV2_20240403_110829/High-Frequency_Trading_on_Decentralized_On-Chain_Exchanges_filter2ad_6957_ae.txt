combination of front and back-running. Fixing such front-
running is not trivial because the smaller the allowed
slippage set by a trader, the more likely the trade fails.
Cryptography-based defenses moreover aﬀect the usability
of the AMM DEXes due to multiple rounds of interactions
or trusted oﬀ-chain components (cf. Appendix C).
We show how under multiple competing adversaries,
sandwich attacks may still remain proﬁtable. Our work,
sheds light on a dilemma facing DEXs:
if the default
slippage is set too low, the DEX is not scalable (i.e. only
supports few trades per block), if the default slippage is too
high, adversaries can proﬁt. We hope that this work draws
attention to this unsolved issue and engenders future work
on open, secure and decentralized ﬁnance.
Acknowledgments
We very much thank the anonymous reviewers and
Nicolas Christin for the thorough reviews and helpful
suggestions that signiﬁcantly strengthened the paper.
Fig. 12: The simulated gas price of the “winning” transac-
tion when 2, 5 or 10 adversaries are performing a reactive
counter-bidding attack. Each experiment is run 100, 000
times. We visualize the 95% conﬁdence interval.
The cryptographic literature captures front-running by
allowing a “rushing adversary” to interact with a pro-
tocol [11]. The (ﬁnancial) high-frequency trading (HFT)
literature [7], [47] has also explored many trading strate-
gies and their economic impact, such as arbitrage, news
reaction strategies etc in traditional markets. Most of the
traditional market strategies are also applicable to AMM
and other decentralized exchanges [21], [8]. Daian et al. [21]
in particular, introduced the concept of gas price auctions
(PGA) among trading bots as well as the concept of
miner extractable value (MEV). Previous studies [10] also
suggest that HFT performance is strongly associated with
latency and execution speed. Multiple forms of malpractice
have been discovered on ﬁnancial exchanges. Besides the
traditional market manipulation techniques [34] (such as
cornering, front-running, and pump-and-dump schemes),
previous works [41] have also studied new techniques
such as spooﬁng, pinging and mass misinformation, which
Authorized licensed use limited to: Tsinghua University. Downloaded on February 25,2022 at 12:33:46 UTC from IEEE Xplore.  Restrictions apply. 
440
References
[1] Balancer Exchange. https://balancer.ﬁnance/whitepaper/.
[2] Etherum improvement proposal 1014: Skinny create2, 2018. ac-
cessed 26 May, 2020, https://eips.ethereum.org/EIPS/eip-1014.
[3] Blockchain Transparency Report, 2019.
[4] Implementing Ethereum trading front-runs on the Bancor ex-
[5] Kyber: An on-chain liquidity protocol. Technical report, Kyber
change in Python, 2019.
Network, April 2019.
[6] NASDAQ Glossary, 2019.
[7] James J Angel and Douglas McCabe. Fairness in ﬁnancial mar-
kets: The case of high frequency trading. Journal of Business
Ethics, 112(4):585–595, 2013.
[8] Guillermo Angeris, Hsien-Tang Kao, Rei Chiang, Charlie Noyes,
and Tarun Chitra. An analysis of uniswap markets. arXiv
preprint arXiv:1911.03380, 2019.
[9] Jakob Arnoldi. Computer algorithms, market manipulation
and the institutionalization of high frequency trading. Theory,
Culture & Society, 33(1):29–52, 2016.
[10] Matthew Baron, Jonathan Brogaard, Bj¨orn Hagstr¨omer, and
Andrei Kirilenko. Risk and return in high-frequency trading.
Journal of Financial and Quantitative Analysis, 54(3):993–
1024, 2019.
[11] Donald Beaver and Stuart Haber. Cryptographic protocols
provably secure against dynamic adversaries. In Workshop on
the Theory and Application of of Cryptographic Techniques,
pages 307–323. Springer, 1992.
[12] Iddo Bentov, Yan Ji, Fan Zhang, Lorenz Breidenbach, Philip
Daian, and Ari Juels. Tesseract: Real-time cryptocurrency
exchange using trusted hardware.
In Proceedings of the 2019
ACM SIGSAC Conference on Computer and Communications
Security, pages 1521–1538, 2019.
[13] Bitinfocharts. Ethereum block time.
[14] Joseph Bonneau, Edward W Felten, Steven Goldfeder, Joshua A
Kroll, and Arvind Narayanan. Why buy when you can rent?
bribery attacks on bitcoin consensus. 2016.
[15] Joseph Bonneau, Andrew Miller, Jeremy Clark, Arvind
Narayanan, Joshua A Kroll, and Edward W Felten.
Sok:
Research perspectives and challenges for bitcoin and cryptocur-
rencies. In Security and Privacy (SP), 2015 IEEE Symposium
on, pages 104–121. IEEE, 2015.
[16] Sean Bowe, Alessandro Chiesa, Matthew Green, Ian Miers,
Pratyush Mishra, and Howard Wu. Zexe: Enabling decentral-
ized private computation. Cryptology ePrint Archive, Report
2018/962, 2018. https://eprint.iacr.org/2018/962.
[17] Lorenz Breindenbach, Phil Daian, Florian Tram`er, and Ari
Juels. Enter the hydra: Towards principled bug bounties and
exploit-resistant smart contracts.
In 27th USENIX Security
Symposium (USENIX Security 18), pages 1335–1352, 2018.
[18] Benedikt B¨unz, Shashank Agrawal, Mahdi Zamani, and Dan
Boneh. Zether: Towards privacy in a smart contract world.
IACR Cryptol. ePrint Arch., 2019:191, 2019.
[19] Raymond Cheng, Fan Zhang, Jernej Kos, Warren He, Nicholas
Hynes, Noah Johnson, Ari Juels, Andrew Miller, and Dawn
Song. Ekiden: A platform for conﬁdentiality-preserving, trust-
worthy, and performant smart contracts.
In 2019 IEEE Eu-
ropean Symposium on Security and Privacy (EuroS&P), pages
185–200. IEEE, 2019.
[20] Securities Commission and Exchange. SEC Enforcement Action
Against EtherDelta. Technical report.
[21] Philip Daian, Steven Goldfeder, Tyler Kell, Yunqi Li, Xueyuan
Zhao, Iddo Bentov, Lorenz Breidenbach, and Ari Juels. Flash
Boys 2.0: Frontrunning, Transaction Reordering, and Consen-
sus Instability in Decentralized Exchanges.
arXiv preprint
arXiv:1904.05234, 2019.
[22] Christian Decker and Roger Wattenhofer. Information propa-
gation in the bitcoin network. In Conference on Peer-to-Peer
Computing, pages 1–10, 2013.
[23] DutchX, July 2019.
accessed 12 November, 2019, https://
github.com/gnosis/dx-docs.
[24] O˘guzhan Ersoy, Zhijie Ren, Zekeriya Erkin, and Reginald L La-
gendijk. Transaction propagation on permissionless blockchains:
incentive and routing mechanisms.
In 2018 Crypto Valley
Conference on Blockchain Technology (CVCBT), pages 20–30.
IEEE, 2018.
[25] Shayan Eskandari, Seyedehmahsa Moosavi, and Jeremy
Sok: Transparent dishonesty: Front-running attacks
Clark.
on blockchain.
In Andrea Bracciali, Jeremy Clark, Federico
Pintore, Peter B. Rønne, and Massimiliano Sala, editors,
Financial Cryptography and Data Security, pages 170–189,
Cham, 2020. Springer International Publishing.
[26] Prastudy Fauzi, Sarah Meiklejohn, Rebekah Mercer, and Clau-
dio Orlandi. Quisquis: A new design for anonymous cryptocur-
rencies. 11921:649–678, 2019.
[27] Juan Garay, Aggelos Kiayias, and Nikos Leonardos. The bit-
coin backbone protocol: Analysis and applications. In Annual
International Conference on the Theory and Applications of
Cryptographic Techniques, pages 281–310. Springer, 2015.
[28] Adem Efe Gencer, Soumya Basu, Ittay Eyal, Robbert Van
Renesse, and Emin G¨un Sirer. Decentralization in bitcoin and
ethereum networks. arXiv preprint arXiv:1801.03998, 2018.
[29] Arthur Gervais, Ghassan O Karame, Karl W¨ust, Vasileios
Glykantzis, Hubert Ritzdorf, and Srdjan Capkun. On the
security and performance of proof of work blockchains.
In
Proceedings of the 2016 ACM SIGSAC Conference on Computer
and Communications Security, pages 3–16. ACM, 2016.
[30] Arthur Gervais, Hubert Ritzdorf, Ghassan O Karame, and
Srdjan Capkun. Tampering with the delivery of blocks and
transactions in bitcoin. In Conference on Computer and Com-
munications Security, pages 692–705. ACM, 2015.
[31] Ethan Heilman, Alison Kendler, Aviv Zohar, and Sharon Gold-
berg. Eclipse attacks on bitcoin’s peer-to-peer network.
In
24th {USENIX} Security Symposium ({USENIX} Security 15),
pages 129–144, 2015.
[32] Sebastian Henningsen, Daniel Teunis, Martin Florian, and Bj¨orn
Scheuermann. Eclipsing ethereum peers with false friends.
In 2019 IEEE European Symposium on Security and Privacy
Workshops (EuroS&PW), pages 300–309. IEEE, 2019.
[33] Eyal Hertzog, Guy Benartzi, and Galia Benartzi. Bancor
protocol. 2017.
[34] Robert A Jarrow. Market manipulation, bubbles, corners, and
short squeezes. Journal of ﬁnancial and Quantitative Analysis,
27(3):311–336, 1992.
[35] Ghassan O Karame, Elli Androulaki, and Srdjan Capkun.
In Proceedings of
Double-spending fast payments in bitcoin.
the 2012 ACM conference on Computer and communications
security, pages 906–917. ACM, 2012.
[36] Mahimna Kelkar, Fan Zhang, Steven Goldfeder, and Ari Juels.
Order-fairness for byzantine consensus. Cryptology ePrint
Archive, Report 2020/269, 2020. https://eprint.iacr.org/2020/
269.
[37] Seoung Kyun Kim, Zane Ma, Siddharth Murali, Joshua Ma-
son, Andrew Miller, and Michael Bailey. Measuring Ethereum
network peers.
In Proceedings of the Internet Measurement
Conference 2018, pages 91–104. ACM, 2018.
[38] A Kosba, A Miller, E Shi, Z Wen, and C Papamanthou. Hawk:
The Blockchain Model of Cryptography and Privacy-Preserving
Smart Contracts. In IEEE Symposium on Security and Privacy,
pages 839–858, 2016.
[39] Aurora Labs. Idex: A real-time and high-throughput ethereum
smart contract exchange. Technical report, January 2019.
[40] Kevin Liao and Jonathan Katz. Incentivizing blockchain forks
via whale transactions. In International Conference on Finan-
cial Cryptography and Data Security, pages 264–279. Springer,
2017.
[41] Tom CW Lin. The new market manipulation. Emory LJ,
66:1253, 2016.
[42] Xuan Luo, Wei Cai, Zehua Wang, Xiuhua Li, and CM Victor
Leung. A payment channel based hybrid decentralized ethereum
token exchange.
In 2019 IEEE International Conference on
Blockchain and Cryptocurrency (ICBC), pages 48–49. IEEE,
2019.
[43] MakerDao.
Intro to the oasisdex protocol, September
2019.
accessed 12 November, 2019, https://github.com/
makerdao/developerguides/blob/master/Oasis/intro-to-oasis/
intro-to-oasis-maker-otc.md.
Authorized licensed use limited to: Tsinghua University. Downloaded on February 25,2022 at 12:33:46 UTC from IEEE Xplore.  Restrictions apply. 
441
[44] Yuval Marcus, Ethan Heilman, and Sharon Goldberg. Low-
resource eclipse attacks on ethereum’s peer-to-peer network.
IACR Cryptology ePrint Archive, 2018(236), 2018.
[45] Vasilios Mavroudis and Hayden Melton. Libra: Fair Order-
Matching for Electronic Financial Exchanges. arXiv preprint
arXiv:1910.00321, 2019.
[46] Patrick McCorry, Alexander Hicks, and Sarah Meiklejohn.
Smart contracts for bribing miners. In International Conference
on Financial Cryptography and Data Security, pages 3–18.
Springer, 2018.
[47] Albert J Menkveld. The economics of high-frequency trading:
Taking stock. Annual Review of Financial Economics, 8:1–24,
2016.
[48] Satoshi Nakamoto. Bitcoin: A peer-to-peer electronic cash
[49] Kaihua Qin, Liyi Zhou, Benjamin Livshits, and Arthur Gervais.
Attacking the deﬁ ecosystem with ﬂash loans for fun and proﬁt.
arXiv preprint arXiv:2003.03810, 2020.
[50] Eli Ben Sasson, Alessandro Chiesa, Christina Garman, Matthew
Green, Ian Miers, Eran Tromer, and Madars Virza. Zerocash:
Decentralized anonymous payments from bitcoin.
In Security
and Privacy (SP), 2014 IEEE Symposium on, pages 459–474.
IEEE, 2014.
[51] Slippage. Slippage - Investopedia, 2019.
[52] Uniswap.io, 2018. accessed 12 November, 2019, https://docs.
system. 2008.
uniswap.io/.
[53] Gavin Wood. Ethereum: A secure decentralised generalised
transaction ledger. Ethereum Project Yellow Paper, 2014.
[54] Jiahua Xu and Benjamin Livshits. The anatomy of a cryp-
tocurrency pump-and-dump scheme. In 28th USENIX Security
Symposium (USENIX Security 19), pages 1609–1625, 2019.
Appendix A
Sandwich Attack Details
In what follows, we assume that a victim V sends
y of Y . The
a transaction TV to trade δV
underlying AMM market starts with the initials state
s0 = (x0, y0). Eq. 6 shows the transition in AMM state
after applying TV without unexpected slippage.
x of X for δV
s0
−−−−−−−−−−−−→ (x∗, y∗),
TransactXForY(δV
x )
x0y0
x − cx(s0, δV
x0 + δV
y∗ =
y = y0 − y∗
(6)
δV
x ) + cy(s0, δV
y )
(7)
x∗ = x0 + δV
x ,
A. Liquidity Taker Attacks Taker
x for δA1
We assume that the adversary A has an initial state
(δA1
x , 0), and attacks by emitting TA1 and TA2.
TA1: a front-running transaction, exchanges δA1
y of
Y and is planned to execute before TV (e.g. by paying
a higher transaction fee than TV ). This results in the
state changes of Equation 8 and 9.
TransactXForY(δA1
−−−−−−−−−−−−−→ s1 = (x1, y1),
x )
y = y0 − y1
δA1
(8)
x ) + cy(s0, δA1
x )
(9)
TV : a victim transaction modiﬁes the state as per Equa-
x1 − cx(s0, δA1
x1 = x0 + δA1
x ,
y1 =
x0y0
s0
tion 10 and 11.
−−−−−−−−−−−−→ s2 = (x2, y2),
x )
TransactXForY(δV
s1
y = y1 − y2
δV
(10)
x1y1
x
y2 =
y ) for oA2
x2 = x1 + δV
x ,
x2 − cx(s1, δV
TA2: a back-running transaction exchanges δA2
x )
x ) + cy(s1, δV
(11)
y −
y = δA1
cy(s2, δA2
of X and is planned to execute
after TV (e.g. by paying a lower transaction fee than
TV ). TA2 eﬀectively closes the adversary’s position
that was opened by TA1 (cf. Equation 12 and 13).
x = x2 − x3
δA2
(12)
y3 = y2 + δA2
(13)
Transaction TA2 swaps the asset Y from transaction
TA1 in exchange for asset X. The corresponding proﬁt
is determined by comparing the input from TA1 and the
output TA2 of asset X (cf. Equation 14).
TransactXForY(δA2
y )
−−−−−−−−−−−−−→ s3 = (x3, y3),
y ) + cx(s0, δA2
y ),
y3 − cy(s2, δA2
x3 =
x2y2
s2
y
x − δA1
proﬁt = δA2
(14)
After the attack, the state of adversary becomes
x , 0). Thus, provided the proﬁt exceeds the costs (e.g.
(δA2
transaction fees and equipment costs), a rational adversary
would undertake the attack.
x
B. Liquidity Provider Attacks Taker
L
L
1−L of asset X and δy,N = yN
We use (xN , yN) to denote the state of an AMM ex-
change at block N ∈ Z, where xN, yN are the amounts of
asset X and Y in the liquidity pool (cf. Deﬁnition 1). The
liquidity provider owns a share of L ∈ [0, 1] liquidity if it
1−L of
deposits δx,N = xN
asset Y into the liquidity pool. We use ZN(x, y) to denote
the USD value of assets at block N, where x is the amount
of asset X and y is the amount of asset Y . Given two
blockchain blocks m, n, where the respective AMM states
diﬀer, the deposit of zm = Zm(xm
1−L) at block
m, or zn = Zn(xn
1−L) at block n both results in
a share of L liquidity in the respective market X/Y . For
the following section, we set zm > zn.
1) Attack Proﬁtability: We proceed by deﬁning prof-
y ∈ [0, 1[ denote the
itability for an adversary. Lx, L∗
x, Ly, L∗