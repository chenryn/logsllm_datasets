Journey to the Center of the 
HP28C/S
by
Travis Goodspeed
regarding the work of
Paul Courbis
Sébastien Lalande
Disclaimer
I am just the translator.
My French sucks.
HP 28S
Photo by
Kurt Moerman
Part 1: Software
● Objects: List and Structure
● I/O Zone
● RAM
● Accessing Machine Language
● Further Discoveries
● Useful Routines
Introduction
● Three Models
– HP28C-1BB
– HP28C-1CC
– HP28S-2BB
● HP SATURN architecture, same as HP 71b
● Nibble-wise Little Endian
Memory Layout
FFFFF
60000
40800
4F000
52000
00000
40000
ROM
Screen
Timer
Void
RAM
Void
HP 28C
HP 28S
FFFFF
 6 Ko
50000
Standard
ROM
Screen
Timer
Void
RAM
Void
ROM
Screen
Timer
Void
RAM
Void
40800
4F000
52000
34 Ko
ROM
FFFFF
C0000
Void
Screen
Timer
RAM
Void
D0000
E0000
FF800
Standard
00000
00000
40000
40000
DupRAM
Registers
OUTPUT
INPUT
CARRY
I/O
Status
12
16
1
4
HW Status
16
Status
P
D0,D1
PC
20
20 each
20
Pointers
RSTK
20 by 8
R0 to R4
64 each
Safeguard
A to D
64 each
Working
Nybbles
(Quartets)
● Byte
– 0x00 to 0xFF
– 0 to 255
● Nibble
– 0 to F
– BCD
● 0 to 9
1
0
4
2
00
01
...
...
Nybble Little Endian
#1234
12
34
Big Endian
12
34
Little Endian
HP 28
3
4
1
2
Objects: List and Structure
● Prologue
– 5 nibbles
– Specifies Type
● Type
– System or User
– Implies Length
Short Integer
#02911
Prologue
Number
11920
54321
11920
00000
00000
12345
5
5
Real
#02933
Prologue
Exponent
Mantissa
Sign
5
3
12
1
33290
500
953562951413
0
π*10^5
#02933
5
3.14159...
+
Reverse Polish Notation
● Stack Metaphor
● Left to right.
– If value
● PUSH onto stack.
– If operator,
● POP parameters.
● PUSH result.
● No grouping symbols.
● Easy to interpret.
1
10
3
+
*
1
10
3
+
*
+
1
10
3
*
RPN Interpretation
● Input
● Stack
+
1
10
3
*
10
10
3
3
*
30
1
1
+
31
Algebraic
#02ADA
Prologue
Expression
End. Alg.
5
5
π*10^5
π
10
5
*
^
π
10
5
*
^
Algebraic
#02ADA
Prologue
Expression
End. Alg.
5
5
π*10^5
π
10
5
*
^
π
10
5
*
^
Algebraic
#02ADA
Prologue
Expression
End. Alg.
5
5
π*10^5
π
10
5
*
^
π
10
5
*
^
Algebraic
#02ADA
Prologue
Expression
End. Alg.
5
5
π*10^5
π
10
5
*
^
π
10
5
*
^
Prologue
End. Alg.
33290
000
953562951413
0
I/O Zone
● IR in/out
● Timers
● Contrast
● Screen/Indicators
● Speed
– 28S Only
● Row Driver Waveform
– 28C Only
Row Driver Waveform
● Maps logical lines to physical lines.
● Scrolling
– Swap line-mappings, not data.
● Mirroring
– Map the same logic line to many physical lines.
● Initialized at boot.
● Interpreted by software video driver.
Row Driver Waveform
RAM
● Polling
– Background Processes Watch RAM
– I/O-like Behavior
● Keyboard Buffer
● Flags
● Command-Line
● Stacks
● Temp Environment
Keyboard Buffer
● Samples Keys
– Not ASCII
● Clock
● KEYSTART
– next to be handled
● KEYEND
– next to be sampled
Accessing Machine Language
● ML Program
– is an Object Type (#02C96)
– may not be created by the user.
● Bootstrapping
– ASS
– LASS
LASS
● Takes as input an ML string.
● One character, one nybble.
● Assembles
– ML String to ML Object
– not Assembly String to ML Object
● Usage
– Push string to stack.
– LASS
– Store resultant object to variable.
INV.VID
INV.VID
● “76C2091C7...
● LASS
● `INV.VID' STO
Further Discoveries
● Search ROM
– Strings Tables in Appendix
– I/O or RAM addresses
● Systematic Disassembly
– Disassembler Program
– Dump to a Workstation
Useful Routines
● SAV.REG
● LOAD.REG
● RES.ROOM
● GARB.COLL
– Force Garbage Collection
● TFM
– Too Few Memory
● ERROR
● BEEP
Useful Routines
SAV.REGN
C=reserved adr
RES.ROOM
LOAD.REG
GARB.COLL
First Try?
LOAD.REG
TFM
carry=0
carry=1
no
yes
continue
Part 2: Hardware
● Exterior Description
● Opening the Machine
● Interior Description
● Transformations
– External Power Feed
– Overclocking
– Extended Memory
● The I/O Port
● Closing the Machine
● I/O Interfaces
Exterior Description
-
+
-
+
-
+
Electronics
Keyboard
Keyboard
Opening
● No Screws!
● Gotta break some pins.
Interior Description
1
21
11
10
2
Keyboard
CD
STR
B0
B1
B2
B3
In
Out
2
1
3
4
GC
GND
DOUT
ILP3-0016
Buzzer
ROM A
ROM B
+
-
Transformations
● External Power Feed
● Overclocking
● Memory Upgrade
Overclocking
● HP28C
– Replace or Remove a Capacitor
– Replace an Inductor
● HP28S
– Overlocking in Software
– SPEED Program
Memory Upgrade
● HP71B Memory Module
● Installation
– Cut Traces of Memory Bus
– Patch in Upgrade Module
I/O Ports
● Hack of the IR Led
● Hack of the Buzzer
I/O Ports
● IR Cartridge
● Replacement Adapters
– Apple ][e Joystick
– HP to HP
– RS232
HP28 Printer
● HP82240B
Ideas!
● Add a Joystick
● Telephone Composer
– Photocoupler and Relays
– Provides click of a rotary phone.
– Dial by counting digits, then waiting.
● Motor Control
● Robot
● Plotter
Part 3: Appendices
● Machine Language
● SATURN Microprocessor
● SATURN Instructions
● Exhaustive List of Error Codes
● List of Objects and RPL Entry Points
● Library of Programs
Epilogue
HP28 Emulation
● Christoph Giesselink
HP48 Series
● Memory Expansion
● IR I/O
● Serial Port
● Meta Kernel
– Replacement OS
Photo by Heretiq
HP49 Series
● SD Card Slot
● USB, IR, Serial
● ARM CPU
– Emulates SATURN
● HPGCC
● Meta Kernel
– Official OS
Photo by Nova dc
TI Calculators
http://richfiles.solarbotics.net/
Next Step: TI Nspire
● No ML Programming
● No Games
● No ROM Dump
Questions?
Travis Goodspeed
PI:EMAIL
865.300.0094