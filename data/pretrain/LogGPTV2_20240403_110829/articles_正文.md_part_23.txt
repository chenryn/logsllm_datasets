## 12.1 概述
安全信息和事件管理（Security Information and Event Management, SIEM）是IT安全建设中的核心系统，有效的安全防护始于SIEM。组织和企业的安全建设应从制定安全规划蓝图开始，确保符合国家法律法规、行业标准或联盟标准，并通过管理和技术手段加以落实。在安全技术建设中，首先需要部署安全设备，以提供基础的安全防护，拦截或发现常见的攻击。然而，仅有安全设备是不够的。例如，黑客可以通过欺诈电话冒充高层领导，从维护人员那里获取高权限账户，从而在内网为所欲为。因此，必须考虑整体的安全建设，而SIEM正是这一阶段的关键内容。

SIEM的主要作用包括：
1. 有效侦测入侵行为。
2. 及时发现网络中新增的需防护的设备。
3. 按重要性和紧急程度有效处理设备和系统漏洞。
4. 区分和理解网络内部的操作行为。
5. 有效存储和使用日志。
6. 提供完善的报表生成工具。
7. 告警产生后有闭环处理流程。

SIEM的防护手段可以简单描述为“发现”和“处置”。日志是“发现”过程中最重要的基础。操作系统、网络设备、安全设备、数据库、中间件、容器、云平台等都会产生日志，黑客的攻击行为会在这些日志中留下记录。因此，通过分析日志，可以有效地发现黑客攻击行为。

## 12.2 信息安全建设中存在的问题
1. **安全设备多，日常维护压力大**  
   防火墙、WAF、IPS、NIDS、邮件网关、HIDS等安全设备数量众多且相互孤立，导致安全管理人员面临巨大的日常维护压力。

2. **日志量大，告警事件多**  
   安全设备每天产生大量日志，其中包含大量误报信息。由于安全管理人员每天能处理的安全事件有限，关键的安全信息和告警可能被大量无效告警淹没。

3. **安全事件闭环处理进展缓慢或无闭环处理**  
   安全事件对应的资产通常需要单独查询，资产对应的漏洞也难以确定，这使得安全管理人员无法快速有效地做出判断并处置安全事件。

4. **安全现状不可见**  
   面对庞大复杂的网络和业务系统，企业难以了解自身的安全状况、安全建设效果及安全风险的变化情况。企业无法为不同层级的人员（如领导层、管理层和运维人员）提供清晰的安全报告，说明企业的安全问题和现状。

## 12.3 日志分析在SIEM中的作用
企业在建设SIEM时通常期望达到以下目标：
1. 快速检索安全事件，缩短事故响应时间。
2. 降低误报率，减少人工判断的工作比重。
3. 还原攻击者的活动，锁定攻击者。
4. 在组织内部形成有效的安全事件处理流程。
5. 将当前事件与历史事件或其他异常事件关联，发现潜在的攻击者和漏洞。

对应上述期望，日志分析的作用如下：
1. 为人工确认安全事件的真实性提供检索工具，大幅缩短排查时间。
2. 在预置告警规则的前提下，从海量告警中精准地发现真实攻击。
3. 在SIEM建设初期，通过回溯还原攻击活动的时序特征，建立分析模型，为锁定攻击者提供支持。
4. 为安全事件处理提供入口和检索工具。
5. 通过IP地址、特征等发现攻击者。

## 12.4 日志分析与安全设备分析的异同
### 相同点
1. 从安全设备报送的日志层面来说，分析的基础是相同的。
2. 在同时采用大数据技术的前提下，单类型设备分析的思路是相同的。
3. 在只采集安全日志的前提下，分析的结论是相同的。

### 不同点
1. 日志分析除了采集安全设备日志，还会采集操作系统、数据库、中间件、网络设备、安全设备登录行为日志。
2. 某些安全设备更注重安全管理，几乎不具备分析能力（如VPN、DLP），此时日志分析具有不可替代的作用。
3. 日志分析更加广泛和全面，例如对异构网络中相同类型的设备进行联合分析，从业务连续性或网络可用性的角度发现异常。
4. 安全设备分析通常只留存那些已穿透的事件，而日志分析可留存被拦截或等级较低的事件，在网络环境不断变化的情况下，利用这些信息能捕捉到未遂但潜伏的攻击者。

## 12.5 SIEM功能架构
SIEM以日志平台为基础，其功能架构如图12-1所示。

![](media/image32.tiff){width="5.708333333333333in" height="3.24in"}

图12-1 SIEM功能架构

取证过程分为网络层取证和端点层取证。网络层信息收集用于确认告警是否真实，端点层信息收集用于确认攻击是否成功。漏洞中心和资产管理为取证提供数据支持。

- **漏洞中心**：对接第三方漏洞扫描器，展示漏洞信息，关联资产信息，并基于威胁涉及的资产进行漏洞分析计算，将结果提供给上层。
- **资产管理**：通过各种方式获取资产信息，对资产进行动态监控。

调查分析分为时间轴分析和攻击链分析，主要以威胁告警作为入口，将威胁告警和异常事件映射到时间轴，分析安全事件之间可能存在的关联性，并基于威胁告警对攻击链路进行溯源分析。

## 12.6 SIEM适用场景
SIEM不同于常规的安全设备分析。安全设备分析大多数基于历史攻击特征建立黑名单机制，而SIEM侧重于发现和关联未知威胁，适用于以下场景：

### 1. 网络扫描
网络扫描是指对网络主机发送特定的数据包，根据返回的数据判断系统的端口和服务是否开启，通常是网络攻击的前序准备。通过统计网络扫描事件，可以发现异常。
- 同一源地址针对多个端口进行扫描。
- 同一源地址针对不同目的地址的同一端口进行扫描。
- 多个源地址对同一目的地址的同一端口进行扫描。
- 多个源地址对同一目的地址的多个端口进行扫描。
- 同一源地址对多个目的地址进行扫描。
- 多个源地址对同一目的地址进行扫描。
- 源地址针对目的地址进行低频扫描。
- 主机发起高危端口扫描。
- 主机特定端口被大量扫描后发起同端口的横向扫描。

### 2. 网络攻击
网络攻击是指对计算机及网络进行破坏、揭露、修改，使软件和服务失去功能，或者未经授权访问计算机上的数据。利用关键字分析网络攻击事件，可以发现异常。
- 地址欺骗攻击。
- 利用渗透工具进行攻击。
- 疑似恶意软件连接。
- 漏洞扫描。
- 漏洞利用探测。
- FTP弱口令告警归并。
- SMTP登录弱口令告警归并。
- 缓冲区溢出攻击告警归并。

### 3. 拒绝服务攻击
攻击者通过对网站发起大量分布式的模拟请求，使网站服务器无法及时处理正常的页面访问请求。利用关键字可以发现拒绝服务攻击。
- ICMP DDoS。
- TCP/UDP DDoS。
- CC攻击。

### 4. 僵尸网络
攻击者控制网络中存在弱点的主机，利用大量被控主机实现分布式攻击。通过防火墙事件分析可以发现僵尸网络。
- 防火墙上内网机器短时间内向外部同一个地址或多个地址发起大量连接。
- 防火墙上出现外网机器大量访问连接。

### 5. 遍历行为
攻击者利用网站安全配置的漏洞或特殊字符，实现查看站点服务器上文件的目的，通常是网络攻击的前序准备。通过统计分析可以发现遍历行为。
- 多个源地址对同一个应用系统进行目录遍历。
- 同一个源地址对多个应用系统进行目录遍历。
- 多个源地址对同一个应用系统进行路径遍历。
- 同一个源地址对同一个应用系统进行路径遍历。

### 6. 爬虫事件
攻击者利用自动化程序脚本抓取网站上的关键信息。通过统计分析可以发现爬虫事件。
- 同一个源地址对API进行大量访问。
- 多个源地址对API进行大量访问。

### 7. Web攻击
以暴露、修改为目的对网站进行攻击。通过统计分析和关键字分析可以发现Web攻击。
- 同一个源地址针对应用系统发起多次SQL注入攻击尝试。
- 同一个源地址针对应用系统发起多次XSS攻击。
- 同一个源地址针对应用系统发起多次漏洞利用攻击。
- 同一个源地址针对应用系统发起多次命令执行攻击。
- 同一个源地址针对应用系统发起多次缓冲区溢出攻击。
- 应用系统遭受Web攻击后外连C2服务器。
- 信息泄露。
- 框架漏洞利用。
- 非管理员地址试图登录Web后台。
- 管理后台暴力破解。

### 8. 木马后门
通过日志分析可以检测到木马后门的存在及其活动。