# 揭秘Remcos下的僵尸网络

##### 译文声明
本文为翻译文章，原文来源：[talosintelligence.com](https://talosintelligence.com)。译文仅供参考，具体内容及含义以原文为准。

## 一、概述
思科Talos团队近期发现多起利用Remcos远程控制工具（RAT）进行的恶意活动。该工具由一家名为Breaking Security的公司销售。尽管该公司声称其软件仅用于合法用途，并且将撤销违反最终用户许可协议用户的许可证，但此类远程控制工具实际上为攻击者构建潜在僵尸网络提供了便利条件。每个Remcos许可证的价格区间在58欧元至389欧元之间，支持使用数字货币支付。此远控软件能够完全掌控并监控自Windows XP及其后的所有Windows系统，包括服务器版本。

除了Remcos外，Breaking Security还提供了一款名为Octopus Protector的加密工具，可帮助恶意软件绕过反病毒产品的检测。此外，该公司还出售键盘记录器、垃圾邮件发送系统以及DynDNS服务等辅助工具。当这些工具与Remcos结合使用时，便形成了一个持久性僵尸网络的基础架构。

通过思科高级恶意软件防护（AMP）系统，我们监测到了多次尝试安装该RAT的实例。同时，我们也注意到许多恶意软件正在分发Remcos，并采取不同策略逃避检测。为了协助受感染用户，思科Talos团队开发了一个脚本，可以从二进制文件中提取C2服务器地址及其他相关信息。详情请参阅下文中的技术细节部分。

## 二、Remcos的实际应用案例
鉴于Remcos在多个黑客相关论坛上被广泛宣传和售卖，我们观察到了几起试图大规模传播该工具给受害者的恶意活动。据信，众多不相关的攻击者正利用这种软件并通过各种手段实施入侵。例如，RiskIQ早些时候发布了一份关于一名针对土耳其国防承包商发起攻击的报告。此后，这名攻击者持续活跃，并扩大了目标范围，涉及以下类型组织：
- 国际新闻机构
- 柴油机设备制造商及海事能源服务提供商
- 能源行业的暖通空调服务供应商

在所观测到的活动中，攻击通常始于用土耳其语撰写的特制钓鱼邮件，伪装成来自土耳其政府机构的通知，内容涉及税务报告。其中一封示例邮件如下所示：

![示例邮件](图片链接)

攻击者尽力使邮件看起来像来自Gelir İdaresi Başkanlığı (GIB)，即土耳其税务局。邮件甚至包含了官方GIB标志及底部说明文字：“感谢您参与税务局电子邮件通知系统。此消息已通过GIB邮件通知系统发送给您，请勿回复。”

与其他钓鱼攻击相似，这些邮件附件通常包含恶意Microsoft Office文档。大多数情况下，Excel表格为空白，只附有提示开启宏功能的图片。对于Word文档，则可能故意模糊内容以诱骗受害者启用宏查看完整信息。以下是伪装成税单的一个Word文档示例：

![伪装成税单的Word文档](图片链接)

我们也发现了针对英语使用者的类似攻击，例如冒充西班牙旗舰航空公司Iberia或波兰航空公司AMC的账单。

一旦受害者启用了宏，隐藏于文档中的小型可执行文件将被释放并运行，进而从攻击者控制的服务器下载并安装Remcos。此过程通常会更改文件路径及名称以避开检测。

## 三、谁是Remcos背后的推手？
如前所述，Breaking Security公司在其官网上销售Remcos及其他可疑软件产品。尽管该公司未公开详细信息或幕后人物身份，但网站上列出了一个德国注册的增值税号。然而，在德国，出于隐私保护原因，无法查询到更多关于企业的具体信息。尽管如此，通过深入分析，我们仍能获取一些线索来推测公司背后的人物。

首先确认的是Viotto Keylogger截图中展示的邮箱地址和域名：
- logs[@viotto][.]it
- viotto-security[.]net

虽然viotto-security[.]net同样受到Cloudflare保护，但我们找到了与之关联的whois信息：
- viotto[@null][.]pm
- viotto24[@hotmail][.]it
- viotto[@xmpp][.]ru

进一步调查表明，breaking-security[.]net的主要托管IP为146.66.84[.]79，位于SiteGround Amsterdam数据中心。另一个与Remcos有关联的域名viotto-security[.]net目前重定向至breaking-security[.]net。

Viotto还在多个黑客论坛上积极推广Remcos，自2016年以来在HackForums等平台上频繁出现。尽管该公司声称若发现非法使用行为将取消授权，但从某些帖子来看，似乎对此并不十分严格。

## 四、Remcos的技术细节
根据其他研究显示，Remcos似乎是用C++编写的。从发布历史看，开发者几乎每月都会对其进行更新。最新版本为v2.0.5，发布日期为2018年7月14日。

作为典型的RAT，Remcos具备隐藏自身的能力，并采用多种技巧躲避普通用户的察觉。其部分代码片段疑似基于开源项目进行了修改。例如，下面是一段反调试代码：

```cpp
// 反调试代码示例
```

此外，Remcos大量使用RC4算法对数据进行加密处理，包括注册表项、C2通信以及文件路径等。解密后的注册表路径可能类似于：
```
C:\TEMP\1cc8f8b1487893b2b0ff118faa2333e1826ae1495b626e206ef108460d4f0fe7.exe
```

RC4实现遵循标准算法流程，在初始化阶段设置S数组，并通过伪随机生成器产生密钥流字节K。具体实现细节可参考如下伪代码：

```python
def RC4_KSA(key):
    S = list(range(256))
    j = 0
    for i in range(256):
        j = (j + S[i] + key[i % len(key)]) % 256
        S[i], S[j] = S[j], S[i]
    return S

def RC4_PRGA(S):
    i, j = 0, 0
    while True:
        i = (i + 1) % 256
        j = (j + S[i]) % 256
        S[i], S[j] = S[j], S[i]
        K = S[(S[i] + S[j]) % 256]
        yield K
```

Remcos使用存储于PE资源块中的'SETTINGS'作为初始密钥，长度介于40至250字节之间。