显示系统也应该对会话劫持免疫。例如，如果使用一个Web服务器审核报告，传输应该
输出数据的安全应该和输入数据的安全同样看待，限制有写权限和系统访问权限的人。
通过修改输人数据，攻击者可以导致系统报告虚假的攻击，或者不报告实际的攻击。分
rm~/.bash_history
最简单的可用性攻击是删除日志来源上的数据。
1.源的可用性
■结果的显示（输出）
■处理的数据（输人）
用于分析的工具（系统）
然后，攻击者利用对“ptrace”的攻击将他的权限提升到“root”
对可用性的攻击
第17章对日志系统的攻击245
---
## Page 267
246
此外，日志记录可以通过违规使用轮转方案强制清除出该文件。
ClearLogs（http://www.ntsecurity.nu/toolbox/clearlogs/）是两个稍有点老，但仍然有效的工具。
用特殊的日志清除工具来删除。WinZapper（http://www.ntsecurity.nu/tolbox/winzapper/）和
表明日志已经清除（见图17.3）。
程序清除这些日志（见图17.2）。但是，这样安全日志不会被清除“干净”，将生成一个事件
SecEvent.Evt和SysEvent.Evt文件。
的Windows Explorer shell程序上删除C:WINDOWS\system32\config中的AppEvent.Evt,
本著作中所介绍的，有许多“净化”二进制文件的工具，可以用于Unix和Windows上。
换二进制日志记录（从而用0记录填充文件，这很可疑）或者删除记录（从而使日志文件变
工具的常见例子有zap、clear和cloak。这些工具以两种不同的方式运作：它们可能置零／替
恢复，这一点我们在对机密性的攻击中已经介绍过。
上存储的数据，会使其无法恢复。简单地删除文件会在磁盘上留下数据，可以用合适的工具
rootkit，运行如下命令：
的记录，并将其符号链接到/dev/null，避免进一步记录任何新命令。然后，入侵者安装一个
还阻止所有本地日志记录)。他删除根用户的.bash_history文件，销毁他所输入的任何命令
，这也很可疑）。两种方法都有缺点，都可以检测到。
这一操作不能成功（见图17.1），因为系统保护在用的文件。可以使用事件查看器应用
下面是WindowsXP日志被删除或者清除时发生的情况。假定攻击者试图从标准
二进制格式文件（如wtmp和pact）也是删除的候选者。正如本书作者之一在他的前一
zap/var/log/messages
注意，第一条命令是杀死syslog守护进程，说明他希望阻止可能的远程日志记录（此外
事件日志也可以通过启动到另一个操作系统实例（例如用一张Linux软盘启动）或者使
上述命令用0覆盖/var/log/messages中的相关数据。和删除相比，数据置零以覆盖磁盘
复日志文件。调查的详细情况可以在《SecurityWarrior》（O’Reilly，2004）一书第20章中看到。
ErrorDeletingFileorFolder
Close any programs that might be usng thefle and tryagain.
图17.1Windows日志删除错误
OK
---
## Page 268
涉及数据删除的攻击的缓解方法和完整性攻击的防范方法一样。
Application Properties
General Fiter|
Using a low-speed connection
Accessed:
Modified.
Size:
Log name.
Created:
Displayname:
-Logsize
Qverwrite events asneeded
Whenmaximum log size is reached
Maximum log size
Oyerwite events older than
(clear log manualy)
Donotoverwrite events
图17.3Windows日志删除事件
图17.2Windows日志删除成功
Thursdey.November11.200410:33:30PM
Thursday.August01.200212:08:38PM
512.0 KB(524.288bytes)
CIWINDOWS\system32iconfigAppE
Wednesday.November10.20042.36:23AM
Application
512
KB
days
Bestore Defau
第17章对日志系统的攻击247
---
## Page 269
躲避跟踪的好方法之一是用完全虚假的流量进行网络洪泛攻击，其目标是现有主机上未用的
击，使他不希望你看到的流量被丢弃，从而隐藏痕迹。
量可能造成UDP数据包在源和日志主机之间被丢弃。攻击者可以用流量对网络进行洪泛攻
者填满日志文件之前发现违规行为。
或者移到另一个位置），并将日志记录切换到一个新文件。这在Unix和Windows系统上都能
成，攻击者也可能有其他的方法写人分区。一定要验证用户无法写入日志所在分区。
服务器，这通过搜索来自某台主机的消息缺乏的情况来完成。
息的不寻常数量，你就能够检测到洪泛攻击的发生。类似的方法还可以用来检测崩溃的日志
可以简单地用虚假流量对日志守护进程发动洪泛攻击，抑制守护进程记录的消息。这样的攻
趣的现象：这些数据包甚至在本地网络连接（例如“本地环回接口”）上也可能丢失。攻击者
验性的技术有助于避免这种攻击，但是最简单的方法是除了所处网络之外，阻止对日志守护
击不敏感，但是较旧的版本会受到影响。
效地阻止所有日志记录，包括转发日志到日志主机。“标准”syslog的当前版本对拒绝服务攻
（见图17.2）。很容易产生更多的日志记录，以取代相关的日志消息。
息，
完成。
服务器免遭溢出，也用于组织日志文件的存档。日志轮转意味着储存旧日志文件（可能压缩
击甚至可以在主机上用非特权用户进行。
进程的网络访问。！
对于本地洪泛攻击的补救方法不多。但是，通过对系统的活动建立基线，并搜索日志消
违规使用轮转的缓解方法是使用足够的磁盘空间和足够大的轮转容量，这就可以在攻击
洪泛攻击并不一定要使用日志流量，甚至不需要使用针对网络真实主机的流量。攻击者
，删除他的活动证据。
此外，虽然大家都理解UDP数据包在繁忙的网络中可能丢失，但是我们注意到一个有
基于TCP的syslog守护进程（例如 syslog-ng）可能遭到 SYN 洪泛攻击。虽然有一些试
Windows根据大小轮转日志，默认设置只保留很小的量，在日志文件满时覆盖旧条目
如果攻击者知道日志在达到特定尺寸时将被轮转，他可能会生成足以导致轮转的日志消
销毁日志数据的一种有趣的间接方法是利用日志轮转系统。日志轮转用于保护日志记录
抑制本地日志记录的另一种方法是填充存储日志的磁盘分区。这可以通过填充日志来完
例如，“CiscoIOS Syslog拒绝服务漏洞”（http://www.ciac.org/ciac/bulltins/j-023.shtml）可能导致syslog守
正如我们的例子中所看到的，除了删除本地日志文件之外，可以杀死日志守护进程，有
如前所述，标准的syslog传输机制使用UDP，通常称为“不可靠”传输。网络上的高流
2.传输中的可用性
我们认为自已发现了这一现象，但是没有足够精确的证据来确定。
护进程崩溃。
---
## Page 270
务一样。与保护日志主机免遭完整性攻击的相同措施也适用于这种情况。
能使服务器崩溃，至少造成其拒绝接受更多连接，就像人们可以阻塞所有其他基于TCP的服
流量）。用虚假日志流量对日志主机进行洪泛攻击有两种效果。首先，它可能造成合法的流
因为业务真的转好？你只能监控流量统计，搜索“不寻常”的事件（参见第11章)。
统上试图运行该命令时所发生的情况：
（ICMP）流量。
不正常的指示是路由器或者交换机上的流量计数器会显示丢包和大量的互联网控制消息协议
导致发送到日志主机的数据包被丢弃，在日志主机上不会有出现问题的指示。实际上，唯一
的速度）的速度发送数据包。对与日志主机相同网段的一个主机发动Ping洪泛攻击，可能会
本中有一个选项（通常是“-f”），告诉程序以至少每秒100个数据包（最高为主机能够响应
连接，也不会以任何其他明显的方式出现，只会在网络设备上留下利用率的统计数字。
攻击：
停止记录任何数据。（有时候这会造成主机系统故障)。
量被网络或者日志主机的内核丢弃。此外，日志数据可能填充日志文件分区，追使日志主机
端口，或者网络上不存在的主机，甚至另一个网络上的主机。这些流量在主机上不会显示为
下面是一个shell脚本示例，可以用于从向日志主机转发日志的客户端机器上发起洪泛
“Ping洪泛”是网络洪泛攻击的最简单方式之一，它很容易被忽略。Ping程序的很多版
和网络洪泛一样，日志主机也可能遭到洪泛攻击（利用虚假日志数据，或者就是虚假的
3.日志主机可用性
网络洪泛难以缓解。如何区分合法的流量和虚假的流量？如何知道网络流量的激增不是
注意，Unix系统上只有根用户才能使用Ping的这个选项。下面是非根用户在Linux系
基于TCP的 syslog守护进程可以避免丢包，但是可能遭受SYN 洪泛攻击，这种攻击可
递增变量的用处是避免 syslog守护进程汇集“最后一条消息重复X次”的消息。
ping:Operation notpermitted
#ping-floghost
ping-floghost
下面是对日志主机运行的 ping命令的示例：
这个例子对于本地日志和远程日志的洪泛攻击都有用。
对你来说洪泛攻击不够快？那就在后台同时运行多个脚本。
done
logger-p"Flooding$i"
while:do
i=0
i=$i+1
第17章对日志系统的攻击249
---
## Page 271
造问题。例如，用通过 SSL、SSH或者IPsec 隧道的可靠 syslog 代替基于UDP的 syslog，能
能力。通常，加密有助于解决这个问题。至少，它能够解决从源到收集点的传输中的数据伪
报，使监控系统的人员茫然不知所措。
系统的问题。除了给运行人侵检测软件的系统造成压力之外，警报洪泛攻击工具生成许多警
的最有名例子是警报洪泛攻击工具，如 stick、sneeze和 snot，这些工具会造成早期人侵检测
不知所措，或者使其花费时间去注意看起来更严重的其他活动，从而避开他们的视线。
者可能简单地依靠执行足够的不同攻击，或者注人数据使其看起来像攻击，使安全分析人员
术有助于缓解这种攻击。
崩溃的攻击，以及存储文件的删除。这里适用对完整攻击的相同建议。
系统进行洪泛攻击，压跨技术组件和分析人员。
够阻止攻击者在收集点注人数据。
接到Web服务器，并用另一台防火墙分离。在外部防火墙之后布设了一个入侵预防系统，
系统和互联网分离。基于Web的鼠交易系统的核心是一台电子商务应用程序服务器，连
构和老鼠培育机构。数据中心也设立在中心办公室的同一建筑物中。
合作伙伴网络（组合于“RatOne”合作伙伴计划中）直接提供服务和产品。
老鼠，以及为商业客户和政府培养定制的转基因老鼠。它通过网站、纸质目录和代理商及
管理产品和服务，包括鼠害预防、灭鼠、鼠相关事故清理以及为各种目的饲养老鼠、训练
紧接着发生了对日志记录基础设施的攻击。
攻击案例研究
事区”（DMZ）架构有两个防火墙，保护公开的服务器（Web、电子邮件等），并将其与内部
此外，某些机制还支持源身份认证，能够阻止攻击者引人虚假的日志记录来源，用它对
对可用性进行的一种攻击很有趣且常常被忽视，这就是对分析人员可用性的攻击。攻击
而且，一个有太多“假警报”的分析系统很快会被认为是无用的并被放弃。这种攻击
日志事件的收集和分析必须以某种方式组织，最大程度地降低外部人员注入伪造数据的
最后，数据库和日志主机一样容易遭到类似的攻击—网络洪泛、SYN 洪泛、使数据库
除了禁用分析系统之外，用分析数据淹没系统，可能使其陷入困境。有效的数据精简技
该公司的网站是公司收入的重要来源，所以“RatsRUs”投资了IT安全资源。“非军
该公司的中心办公室有数百名员工，包括所有IT人员。其余人员分布在区域销售机
“RatsRUs”是一家全球领先的企业和消费者端到端鼠管理公司。它提供了广泛的鼠
4.分析的可用性
除此之外，日志主机和日志源一样容易遭到拒绝服务攻击，适用相同的保护性措施。
在本节中，我们将描述一个虚构的公司在服务器入侵期间如何应对，在这一入侵之后
---
## Page 272
的没有太多信息，RatsRUs仍然可能遭到同样的攻击。
线索。但是所有这一切都只是猜测，缺乏真实的证据。
的访问。这种攻击在日志文件中会留下痕迹，所以入侵者删除日志，避免留下攻击情况的
主机遭到入侵，集中日志主机即使没有被入侵，至少也遭到了DoS攻击。
志。实际上，他们发现日志主机的 syslog守护进程甚至没有运行。所以，不仅DMZ 中的
任何入侵的情况。该服务器的配置是远程日志记录，所以该团队查看日志主机上的日志。
天没有记录任何内容。旧的日志仍然存在（由日志轮转脚本轮转并压缩)。旧日志没有提供
所以他们知道主机被入侵，但是不知道是如何入侵的。
根特权运行，这是入侵的明显征兆（例见《Issues DiscoveringCompromised Machines》)，