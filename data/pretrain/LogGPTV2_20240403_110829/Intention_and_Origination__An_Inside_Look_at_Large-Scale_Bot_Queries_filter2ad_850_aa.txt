title:Intention and Origination: An Inside Look at Large-Scale Bot Queries
author:Junjie Zhang and
Yinglian Xie and
Fang Yu and
David Soukal and
Wenke Lee
Intention and Origination: An Inside Look at Large-Scale Bot Queries
Junjie Zhang∗
Wright State University
PI:EMAIL
Yinglian Xie
Microsoft Research
PI:EMAIL
Fang Yu
Microsoft Research
PI:EMAIL
David Soukal
Microsoft Corporation
PI:EMAIL
Wenke Lee
Georgia Institute of Technology
PI:EMAIL
Abstract
Modern attackers increasingly exploit search engines as
a vehicle to identify vulnerabilities and to gather informa-
tion for launching new attacks. In this paper, we perform a
large-scale quantitative analysis on bot queries received by
the Bing search engine over month-long periods. Our anal-
ysis is based on an automated system, called SBotScope,
that we develop to dissect large-scale bot queries. Specif-
ically we answer questions of “what are the bot queries
searching for?” and “who are submitting these queries?”.
Our study shows that 33% of bot queries are searching for
vulnerabilities, followed by 11% harvesting user account
information. In one of our 16-day datasets, we uncover 8.2
million hosts from botnets and 13,364 hosts from data cen-
ters submitting bot queries. To the best of our knowledge,
our work is the ﬁrst large-scale effort toward systematically
understanding bot query intentions and the scales of the ma-
licious attacks associated with them.
1 Introduction
As an indispensable service, search engines play an im-
portant role in our daily life. Unfortunately, a signiﬁcant
portion of the queries to search engines are bot queries that
are generated by automated scripts and this volume contin-
ues to grow (at least 4.16% of search engine users are bots
according to [17]). While previous work has focused on ac-
curately detecting bot queries [14, 17], little attention has
been devoted to understanding the nature of these queries.
A natural question is “what are these bot queries searching
for and who are submitting these queries?”.
Motivated by recent observations that many bot queries
are associated with malicious activities such as searching
∗Work performed while at Microsoft Research Silicon Valley and the
Georgia Institute of Technology.
for vulnerabilities [20] or performing Search Engine Op-
timization (SEO) attacks [19], we perform a quantitative
analysis of bot queries at a large scale. We believe that
such analysis is important for understanding both the na-
tures of bot queries and the scales of the related attacks. It
can beneﬁt many security applications. For example, pre-
cisely identifying vulnerability-searching queries provides
valuable information on the newest security leaks and helps
discover zero-day exploits [20, 22]. In addition, detecting
hosts that constantly search trendy keywords or pharma-
ceutical topics provides opportunities to uncover blackhat
SEO attacks that attempt to boost the ranks of malicious
web sites [23]. Finally, detecting distributed, coordinated
bot queries can help reveal the existence of botnets [11],
their memberships, and their activity patterns.
As a means to this end, we describe a completely auto-
mated system called SBotScope for analyzing bot queries at
a large scale. Different from previous work that focuses on
speciﬁc types of malicious queries that are extracted based
on domain knowledge or using seeds [20], our goal is to
automatically dissect all bot queries in the following two
aspects:
• Query intentions: Instead of investigating every single
raw query, we look for an approach that can abstract
topics that represent the underlying query intentions.
• Query origination: We are interested in analyzing
hosts that submit bot queries, particularly those that
have engaged in coordinated large-scale efforts. Many
of these hosts are associated with botnet activities.
Despite extensive research on mining normal queries,
analyzing bot queries has a number of unique obstacles.
First, attackers adopt various strategies to obfuscate queries
and to increase search coverage. For example, they often
mix truly intended queries with random ones in a session, or
combine stufﬁng words with the real relevant keywords to
diversify them. In addition, different from real user queries,
bot queries usually do not result in any clicks as their pri-
mary purpose is to scrape information. Thus, we cannot
leverage techniques that rely on clicks for understanding
query intentions [8, 9, 6]. Finally, we are faced with a huge
amount of data complexity, as the bot query volume is enor-
mous and the query contents are highly diversiﬁed and con-
stantly evolving.
To analyze bot query intentions, we develop a compact
representation to summarize raw queries as a set of query
patterns. This new representation forms the technical basis
of our analysis. It allows us to hierarchically construct a set
of topic trees that summarize query intentions syntactically
and semantically. This approach captures the invariants of
obfuscated queries, and further reduces the data complexity
by orders of magnitude.
To understand the types of hosts submitting bot queries,
we develop techniques to perform large-scale clustering of
IP addresses and to identify distributed, coordinated query
activities. We leverage topic trees to represent hosts as fea-
ture vectors and explore their temporal and spatial behav-
iors. Since existing work has mostly focused on detecting
spamming botnets, we take a different angle to detect and
analyze a large number of botnets that submit queries.
Putting things together, we make the following contribu-
tions in the paper:
1. Our work is the ﬁrst large-scale effort towards auto-
matically mining bot queries to understand query in-
tentions and origins. We show that this direction of
research can beneﬁt security applications in multiple
ways.
2. We develop a system called SBotScope to perform au-
tomated analysis and measurements. SBotScope can
efﬁciently process billions of bot queries to categorize
query topics and cluster hosts.
3. Applying SBotScope to two large query logs that were
collected across different periods from the Bing search
engine, we perform systematic analysis and present a
set of unique ﬁndings.
Our study shows that a signiﬁcant portion of bot queries
can be attributed to a small number of malicious purposes
despite a diverse set of query intentions among overall bot
queries.
In particular, 33% of bot queries are searching
for vulnerabilities, followed by 11% attempting to harvest
email addresses. The information collected by attackers via
these queries can be used for zero-day exploits and spam-
ming attacks. The remaining intentions range from con-
tent downloading, fashion items, news, tourism and geo-
locations, to pornographic websites, and more.
We also demonstrate how we can leverage the analysis
results of SBotScope to perform in-depth analysis of ac-
tivities from both botnets and data centers. From our two
datasets, we have identiﬁed 8,154,180 and 7,278,295 botnet
IPs, and 13,364 and 19,559 data center IPs. Leveraging data
center hosts to perform dedicated, malicious activities [1]
is an emerging attack trend. Our analysis of coordinated
search behaviors from data centers enables a unique per-
spective to quantitatively study this phenomenon at a large
scale.
Finally, we show that our study can also help detect and
mitigate malicious activities proactively. Using the gener-
ated query patterns, we detect tens of millions of additional
bot queries that currently slip through the radar. These
queries are likely submitted by stealthier hosts that mimic
legitimate user behaviors.
The rest of the paper is organized as follows. Section 2
reviews related work. Section 3 presents the system design,
followed with experiment results in Section 4. Section 5
presents two example applications of SBotScope. Section 6
discusses attacker counter strategies and future work. We
conclude in Section 7.
2 Related Work
There have been extensive studies on search queries for
improving both search result rankings and user experience.
To date, most research efforts in this ﬁeld have focused on
analyzing real user generated search queries (e.g., [16, 29,
21, 8, 9, 6, 27, 18]) so that we can better understand normal
user intentions and improve query auto-suggestions.
While studying real user queries is important, we can-
not ignore bot queries. Doing so may result in inaccurate
statistics and polluted analysis results. Further, as the vol-
ume of bot queries continues to rise, they may deplete the
resources of search engines, resulting in signiﬁcant perfor-
mance degradation for normal users. In this regard, previ-
ous work has proposed a few systems to more accurately
detect bot queries [14, 15, 17]. For example, Buehrer et al.
leveraged a supervised learning method [14, 15] and Kang
et al. [17] adopted a semi-supervised learning method for
detection.
Comparatively, little attention has been devoted to sys-
tematically understanding bot queries and studying their
broad implications to security. Various recent evidences
suggest that bot queries are often submitted from infected
hosts from botnets [13]. They may also be submitted by
attackers to collect information for a variety of malicious
uses, such as targeted exploits, spamming, search engine
optimization, and click frauds [26, 25, 7]. For example,
a recent study shows that attackers submit queries to look
for known vulnerabilities posted in underground web fo-
rums [20]. A separate study ﬁnds that attackers query trendy
keywords in order to scrape contents from highly-ranked
web sites and use them for promoting the rankings of mali-
cious web sites [19].
With a massive number of sophisticated, actively evolv-
ing bot queries, a system that automatically summarizes and
dissects bot queries can bring in a lot of value to security.
Unfortunately, such a system is still in absence. As a result,
the extent to which attackers have been exploiting search
engine results remains largely unclear. Our work focuses
on this new research problem, where we develop a system
and perform strong quantitative analysis of bot queries to
understand their intentions and the scales of malicious at-
tacks associated with them on the Internet.
Compared with existing techniques on analyzing normal
query intentions, our system differs in many important as-
pects. First, unlike [8, 16, 21], our system does not use
click-through data since the majority of bot queries do not
result in any clicks. Second, in contrast to [29, 27], our sys-
tem does not depend on the availability of labeled data. Fi-
nally, different from [6, 9], our system does not need exter-
nal sources of information, such as query-to-topic mapping
functions based on Wikipedia.
Indeed, bot queries exhibit disparate characteristics com-
pared to normal user queries, which make the approaches
for analyzing normal queries not applicable to our study.
First, both the labeled data and the query-to-topic mappings
are relatively easier to obtain for normal queries than for bot
queries. Compared with bot queries, the set of topic cate-
gories for normal queries are more stable, so they can often
be derived manually. In addition, normal query intentions
are more directly tied to the set of keywords in queries, as
the purpose of normal users is to hit the relevant contents
as fast as possible. In contrast, bot queries are more dy-
namic and their contents largely depend on the current se-
curity vulnerabilities and attack trends. The keywords in bot
queries are more obscure in order to evade detection. They
are also designed to increase the search result coverage with
stufﬁng words. Such vast difference characteristics between
normal and bot queries suggest that we cannot directly ap-
ply techniques for mining normal query intentions to ana-
lyze bot queries, but instead need to develop a customized
system for our purpose.
3 The SBotScope System
Our goal is to analyze bot query intentions and origina-
tion by analyzing search logs automatically. Given the sheer
volume of query records, manual investigation is infeasible.
We need to develop a system to support such large-scale
analysis on a regular basis.
Our system, SBotScope is designed to perform off-line
analysis of search logs. It relies on existing bot query de-
tection systems to generate bot query feeds for analysis. We
assume that a large number of bot queries have been labeled
Field
IP
T ime
Query
U A
F orm
Description
IP address
Time stamp
Query content
Hash value of the User-Agent string
Hash value of the query API
Ref errer Hash value of the Referrer string
Click
isBot
Whether any search result is clicked
Whether it is detected as a bot query
Table 1. Fields in a search query record
Month
Data
D1 May,2011
Oct,2011
D2
# of days
16
16
# of IPs
12,687,346
12,207,937
# of Bot Queries
3,057,549,724
3,198,810,465
Table 2. Datasets
by existing detection systems with a reasonable accuracy.
Our system serves as a monitoring tool to discover query
intentions, identify groups of bots performing coordinated
search behaviors, and categorize queries accordingly. The
output of SBotScope can be used in multiple ways. The
categories and the statistics of query intentions can serve as
input to security analysts for discovering new attack trends.
The set of botnet and data center IP addresses can be used
to block future attacks and to monitor attack scales. Finally,
the output of SBotScope can also help detect additional bot
queries that evade the existing detection systems.
In this section, we present the design of SBotScope in de-
tail. We ﬁrst describe our datasets, the challenges involved,
and the system architecture. We then present the detailed
data-processing ﬂow.
3.1 Datasets
We obtain sampled data collected from the Bing search
engine during two different periods. Table 1 shows the
ﬁelds recorded for each query. Among these ﬁelds, the ﬁrst
seven ﬁelds are directly extracted from a query upon its ar-
rival at the search engine. The last ﬁeld “isBot” indicates
whether this query is classiﬁed as a bot query by the current
detection system, which mainly leverages an extensive set
of features derived from query behaviors, e.g., the number
of queries in a search session and the number of web pages
visited from the user.
Table 2 shows the statistics of the datasets. Each dataset
spans across roughly a two-week window, where we ob-
serve more than 3 billion detected bot queries, submitted
from over 12 million unique IP addresses around the globe.
The published privacy policies for this search engine ad-
dress the storage, use, sharing, and retention of data col-
lected in the course of the operation of these services. Our
use of data is in compliance with these policies.
Pattern Generation
Topic Analysis
Normal 
Search 
Queries
Query Pattern 
Generation
Pattern Tree 
Construction
Topic Clustering
Bot Search 
Queries
Host 
Representation
Feature Vector 
Generation
Host Clustering 
and Classiﬁcation
Host Analysis
Figure 1. System Overview
3.2 Challenges and System Overview
The ﬁrst challenging question of our analysis is how to
represent query intentions. One popular approach, taken
by normal query intention analysis [8, 9, 6], is to leverage
the clicked search results. For example, given two different
queries, if users always click the same set of result URLs,
it is a strong indication that these two queries share simi-
lar intentions. However, such an approach is not applicable
in our case because the vast majority of bot queries do not
result in any clicks.
The exact raw query is another natural way to describe
the underlying intention. This approach is also difﬁcult as
attackers often obfuscate queries or mix irrelevant queries
with truly intended ones. Table 3 shows an example of a
bot-query session 1.
In this case, attackers not only add
stufﬁng words, e.g., “unled” and “cheap mini”, to increase
their query diversity, but also add popular queries such as
“facebook.com” and “bing.com” to make their query ses-
sion look more legitimate. The real intentions of these
queries are looking for vulnerable web sites powered by cer-
tain versions of software.
Intuitively, to capture intentions, we would like to derive
the invariant portions of the queries with truly relevant key-
words and randomly inserted stufﬁng words. Toward this
goal, we derive a set of query patterns in terms of invariant
keywords to represent raw queries in a more compact for-
mat (see Section 3.3). The use of patterns also dramatically
reduces the complexity of our analysis. Furthermore, we
aggregate query patterns into a small set of topic trees that
summarize query intentions both syntactically and semanti-
cally. This step allows human users or security analysts to
conveniently examine the composition of queries.
The second question is how to represent hosts and iden-
tify their correlated activities, especially when the volume
of query records is huge. As Table 2 shows, each of our
datasets contains billions of queries and the total volume
1We use the term “session” to loosely refer to a set of consecutive
queries issued from one IP address within a short duration.
unled “powered vbulletin version 3.8.6”
cheap mini “powered vbulletin version 3.8.4”
discussion “powered vbulletin version 3.8.7”
facebook.com
forum “powered vbulletin remove”
bing.com
email “powered vbulletin music”
Table 3. An example bot-query session
of data is on the order of terabytes. Therefore, our system
needs to effectively reduce data complexity and ﬁlter noise
to study query origins.
To address this challenge, we construct feature vectors
that represent hosts in a low dimensional subspace. It fur-
ther aggregates hosts that share similar query patterns into