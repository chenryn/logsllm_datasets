**译者：知道创宇404实验室翻译组  
原文链接：**
## 摘要
Cisco Talos在2021年9月发现了一个新的恶意活动，攻击者使用了泄露的Cobalt Strike版本。 尽管Cobalt
Strike最初是作为合法工具创建的，但它仍然是安全工作者需要监视的东西，因为攻击者正在使用它来设置攻击。本例中的攻击者使用Cloudflare内容分发网络的域前置，将缅甸政府拥有的域定向到攻击者控制的服务器。攻击者采用在其攻击链中重新注册知名域的策略来逃避检测。
该攻击展示了MITRE
ATT&CK框架的几种技术，最显著的是T1202-间接命令执行，T1027-模糊文件或信息，T1105-入口工具传输，T1071.001-应用层协议：Web协议。
## 新的发现
Cisco Talos在2021年9月发现了一个恶意活动，攻击者使用一个模糊的Meterpreter储存器部署Cobalt
Strike信标。该攻击者使用缅甸政府拥有和运营的一个域名，即缅甸数字新闻网，作为其信标的域名前置。
这一威胁的演变表明，至少自2021年8月以来，攻击者就一直在活动，他们使用Meterpreter储存器和Cobalt
Strike信标，在受害者的端点上建立存在。
## 机制
恶意软件通常是一个加载程序，并在受害者设备上运行，通过反射注入解码并执行Cobalt Strike beacon
DLL。它在运行时加载多个库，并根据嵌入的配置文件生成信标流量。配置文件包含与指挥和控制（C2）服务器相关的信息，该服务器指示受害者的机器发送初始DNS请求，试图连接到缅甸政府拥有的域`www[.]mdn[.]gov[.]mm`的主机。该站点托管在Cloudflare内容分发网络后面，实际C2流量重定向到攻击者控制的服务器`test[.]softlemon[.]net`,该域是基于信标配置数据中指定的HTTP主机头信息
## 进展
Cobalt Strike过去曾被许多攻击者使用，是post-exploitation和pivot的事实上的标准工具。攻击者利用它部署范围广泛的有效载荷，从商品恶意软件到复杂的国家支持的攻击行为。 Cobalt
Strike允许攻击者改造信标的流量，以模拟合法的流量模式。域前置是一种通过DNS过滤隐藏流量的技术。域名代理使用合法或高声誉的域名来保证不被安全员发现。攻击者选择缅甸特定的域名作为域名前置可能表明他对该地区的地缘政治感兴趣。
在这次攻击中，攻击者使用MeterMeter
stager使用分段有效载荷，这表明信标将用于进一步的攻击。安全员应时刻保持警惕，监控网络流量，以检测Cobalt Strike活动，因为Cobalt
Strike是犯罪软件和APT组织最常用的攻击工具之一。
## 攻击的演变
一项关于该攻击演变的研究显示，攻击者正在尝试不同的主机组合，目的是完善域名前置技术。 2021年8月中旬左右发现的最早的信标包含C2
URI集，用于test[.]softlemon[.]net，而HTTP Get和Post请求头部指向dark-forest-002[.]president[.]workers[.]dev，这是一个Cloudflare无服务器workers域。请求的默认主机头配置包含主机名test[.]softlemon[.]net，最近的样本也在使用它。
2021年8月底发现的另一个样本由C2主机URI xxx[.]xxxx[.]tk和配置为指向test[.]softlemon[.]net的主机头设置组成。
从2021年9月开始，攻击者开始使用缅甸数字新闻域作为其信标的前置。虽然默认C2域指定为www[.]mdn[.]gov[.]mm，但信标的流量通过信标配置中指定的HTTP
Get和POST元数据重新定向到事实上的C2 test[.]softlemon[.]net。
攻击者可能在发起攻击之前更改了配置，用来测试其基础设施和域前置功能。基于信标配置模板和真实C2主机test[.]softlemon[.]net，我们有一定底气判断评估样本是由单个攻击者创建的。
首次发现的恶意软件样本时间线
## Cobalt Strike信标配置
我们从负载中提取了beacon配置，该配置显示，攻击者在本次活动的不同恶意软件中使用了不同的用户代理、C2服务器和主机头值。
样本的信标配置通常有一个与Mozilla兼容的Windows 7用户代理。
信标中C2服务器、用户代理和事实上的C2变体
## 水印
Cobalt Strike水印是从许可证文件生成的数字，对于Cobalt
Strike许可证来说该水印是独有的。此攻击中使用的信标上的水印为305419896（十六进制：0x12345678）。
这一特定的水印之前被认为是泄露的Cobalt
Strike版本，其他恶意攻击者（如勒索软件Maze和Trickbot组织）使用这一水印也就不足为奇了，这使得基于水印编号判定归属变得不可能。很难评估先前注册的C2服务器过期域和泄露的Cobalt
Strike的使用是因为攻击者的操作安全意识增强还是可用资源有限。
## 域前置
这次攻击中的参与者使用了域名前置技术，这是一种可以使用著名域名来隐藏Cobalt Strike
C2流量的技术。在今天分析的案例种，攻击者使用了缅甸政府域名www.]mdn[.]gov[.]mm。
前置域名mdn[.]gov[.]mm是缅甸数字新闻（一家国有数字报纸）的合法域名。该网站曾于2月被缅甸兄弟会组织（一个民兵组织）攻破。虽然没有迹象表明缅甸兄弟会先前对该领域的诽谤与本文所述的攻击行为有关，但该域名本身显然引起了各路黑客的兴趣。
域前置可以通过恶意服务器和目标之间的重定向来实现。恶意参攻击者可能会滥用各种内容分发网络（CDN），将服务内容重定向到由攻击者控制的C2主机所服务的内容。Cloudflare是CDN服务之一，它为用户的服务器上托管的文件提供了一个全局分布式缓存。Cloudflare通过用于请求资源的FQDN进行标记分发。Cloudflare用户可以选择使用自己的子域并创建指向Cloudflare的DNS记录。此子域告诉Cloudflare将该DNS记录与特定分发相关联。
信标调用主页www[.]mdn[.]gov[.]mm,/api/3，并将主机头设置为实际的C2服务器test[.]softlemon[.]net。信标流量解析为Cloudflare
IP地址,引导流量到达该地址的DNS请求将丢失，并依赖于HTTP请求的其他部分，包括主机头和实际的C2 test[.]softlemon[.]net。
## Cobalt Strike有效载荷
由于攻击者的域名前置技术使用了政府主机作为初始DNS诱饵，这些信标尤其令人感兴趣。此恶意软件使用的MITRE ATT&CK框架技术包括：
  * T1202-间接命令执行
  * T1027-模糊文件或信息
  * T1105-入口工具转移
  * T1071.001-应用层协议：Web协议
我们还分析了加载程序二进制文件，尝试找到其内存加载和功能的细节。