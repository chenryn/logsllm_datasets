Abstract 
This	
  paper	
  details	
  an	
  approach	
  by	
  which	
  SQL	
  injection	
  is	
  used	
  to	
  gain	
  remote	
  access	
  to	
  arbitrary	
  files	
  from	
  the	
file	
  systems	
  of	
  Netgear	
  wireless	
  routers.	
  It	
  also	
  leverages	
  the	
  same	
  SQL	
  injection	
  to	
  exploit	
  a	
  buffer	
  overflow	
in	
  the	
  Netgear	
  routers,	
  yielding	
  remote,	
  root-­‐level	
  access.	
  It	
  guides	
  the	
  reader	
  from	
  start	
  to	
  finish	
  through	
the	
  vulnerability	
  discovery	
  and	
  exploitation	
  process.	
  In	
  the	
  course	
  of	
  describing	
  several	
  vulnerabilities,	
  this	
paper	
  presents	
  effective	
  investigation	
  and	
  exploitation	
  techniques	
  of	
  interest	
  to	
  those	
  analyzing	
  SOHO	
routers	
  and	
  other	
  embedded	
  devices.	
SQL Injection to MIPS Overflows: 
Rooting SOHO Routers 
Zachary	
  Cutlip,	
  Tactical	
  Network	
  Solutions	
PI:EMAIL	
SQL	
  Injection	
  to	
  MIPS	
  Overflows:	
  Rooting	
  SOHO	
  Routers	
Zachary	
  Cutlip	
1 
Introduction 
In	
  this	
  paper	
  I	
  will	
  demonstrate	
  novel	
  uses	
  of	
  SQL	
  injection	
  as	
  an	
  attack	
  vector	
  to	
  exploit	
  otherwise	
unexposed	
  vulnerabilities.	
  Additionally,	
  I	
  detail	
  a	
  number	
  of	
  zero-­‐day	
  remote	
  vulnerabilities	
  found	
  in	
several	
  popular	
  Small	
  Office/Home	
  Office	
  (SOHO)	
  wireless	
  routers	
  manufactured	
  by	
  Netgear.	
  In	
  the	
course	
  of	
  explaining	
  the	
  vulnerabilities,	
  I	
  demonstrate	
  how	
  to	
  pivot	
  off	
  of	
  a	
  SQL	
  injection	
  in	
  order	
  to	
achieve	
  fully	
  privileged	
  remote	
  system	
  access	
  via	
  buffer	
  overflow	
  attack.	
  I	
  also	
  make	
  the	
  case	
  that	
  the	
oft-­‐forgotten	
  SOHO	
  router	
  is	
  among	
  the	
  most	
  valuable	
  targets	
  on	
  a	
  home	
  or	
  corporate	
  network.	
Traditionally,	
  SQL	
  injection	
  attacks	
  are	
  regarded	
  as	
  a	
  means	
  of	
  obtaining	
  privileged	
  access	
  to	
  data	
  that	
would	
  otherwise	
  be	
  inaccessible.	
  An	
  attack	
  against	
  a	
  database	
  that	
  contains	
  no	
  valuable	
  or	
  sensitive	
data	
  is	
  easy	
  to	
  disregard.	
  This	
  is	
  especially	
  true	
  in	
  the	
  case	
  that	
  the	
  data	
  is	
  temporary	
  and	
  application-­‐
generated.	
I	
  will	
  show	
  that	
  such	
  vulnerabilities	
  may	
  actually	
  present	
  new	
  exploitation	
  opportunities.	
  Often,	
  an	
application	
  developer	
  assumes	
  that	
  only	
  his	
  or	
  her	
  application	
  will	
  ever	
  make	
  modifications	
  to	
  the	
database	
  in	
  question.	
  As	
  a	
  result,	
  the	
  application	
  may	
  fail	
  to	
  properly	
  validate	
  results	
  from	
  database	
queries,	
  since	
  it	
  is	
  assumed	
  that	
  all	
  query	
  results	
  may	
  be	
  trusted.	
If	
  the	
  database	
  is	
  vulnerable	
  to	
  tampering,	
  it	
  is	
  then	
  possible	
  violate	
  the	
  application	
  developer’s	
assumption	
  of	
  well-­‐formed	
  data,	
  sometimes	
  to	
  interesting	
  effect.	
I	
  will	
  demonstrate	
  three	
  vulnerabilities	
  in	
  the	
  target	
  device.	
  First	
  is	
  a	
  SQL	
  injection	
  vulnerability	
  that	
  is	
trivially	
  exploitable,	
  but	
  yields	
  little	
  in	
  the	
  way	
  of	
  privileged	
  access.	
  The	
  second	
  and	
  third	
  vulnerabilities	
yield	
  successively	
  greater	
  access,	
  but	
  are	
  less	
  exposed.	
  I	
  will	
  show	
  how	
  we	
  can	
  use	
  the	
  first	
  as	
  an	
  attack	
vector	
  in	
  order	
  to	
  effectively	
  exploit	
  the	
  second	
  and	
  third	
  vulnerabilities.	
The	
  goals	
  for	
  this	
  paper	
  are:	
• 
Introduce	
  novel	
  application	
  of	
  SQL	
  injection	
  in	
  order	
  to	
  exploit	
  a	
  buffer	
  overflow	
  and	
  gain	
remote	
  access.	
• 
Describe	
  zero-­‐day	
  vulnerabilities	
  found	
  in	
  Netgear	
  SOHO	
  routers	
• 
Guide	
  the	
  reader	
  step-­‐by-­‐step	
  through	
  the	
  investigative	
  process,	
  so	
  that	
  he	
  or	
  she	
  may	
  produce	
the	
  same	
  results	
  independently	
• 
Provide	
  the	
  reader	
  with	
  a	
  set	
  of	
  useful	
  investigative	
  techniques	
  applicable	
  to	
  SOHO	
  routers	
  and	
embedded	
  devices	
  in	
  general	
SQL	
  Injection	
  to	
  MIPS	
  Overflows:	
  Rooting	
  SOHO	
  Routers	
Zachary	
  Cutlip	
2 
Target Device: Netgear WNDR3700v3 
In	
  order	
  to	
  demonstrate	
  real	
  world	
  cases	
  in	
  which	
  application	
  vulnerabilities	
  may	
  be	
  exploited	
  by	
  first	
compromising	
  the	
  integrity	
  of	
  a	
  low-­‐value	
  database,	
  I	
  will	
  demonstrate	
  security	
  analysis	
  of	
  a	
  popular	
wireless	
  router.	
  The	
  device	
  in	
  question	
  is	
  the	
  Netgear	
  wireless	
  router	
  WNDR3700	
  version	
  3.1	
The	
  WNDR3700’s	
  robust	
  feature	
  set	
  makes	
  it	
  very	
  popular.	
  It	
  is	
  this	
  enhanced	
  capability	
  set	
  that	
  also	
makes	
  it	
  an	
  attractive	
  subject	
  of	
  security	
  analysis.	
  Specifically,	
  it	
  is	
  this	
  device’s	
  media	
  storage	
  and	
serving	
  capability	
  that	
  is	
  the	
  subject	
  of	
  this	
  paper’s	
  research.	
  In	
  addition	
  to	
  traditional	
  wireless	
networking	
  and	
  Internet	
  gateway	
  capability,	
  the	
  WNDR3700	
  functions	
  as	
  a	
  DLNA	
  server.	
  DLNA	
  stands	
for	
  Digital	
  Living	
  Network	
  Alliance	
  and	
  refers	
  to	
  set	
  of	
  specifications	
  that	
  define,	
  among	
  other	
  things,	
mechanisms	
  by	
  which	
  music	
  and	
  movie	
  files	
  may	
  be	
  served	
  over	
  a	
  local	
  network	
  and	
  played	
  back	
  by	
DLNA-­‐capable	
  devices.	
  As	
  I	
  will	
  show,	
  this	
  device’s	
  DLNA	
  functionality	
  exposes	
  critical	
  vulnerabilities.	
SOHO Router as High Value Target  
The	
  SOHO	
  router,	
  as	
  class	
  of	
  device,	
  is	
  generally	
  inexpensive	
  and	
  sees	
  little	
  direct	
  user	
  interaction.	
  It	
functions	
  discreetly	
  and	
  reliably	
  on	
  a	
  shelf	
  and	
  is	
  often	
  forgotten	
  past	
  its	
  initial	
  setup	
  and	
  configuration.	
However,	
  the	
  significance	
  of	
  this	
  device’s	
  role	
  on	
  the	
  network	
  cannot	
  be	
  overstated.	
  As	
  a	
  gateway	
device,	
  it	
  is	
  often	
  entrusted	
  with	
  all	
  of	
  its	
  users’	
  Internet-­‐bound	
  traffic.	
The	
  vulnerabilities	
  I	
  discuss	
  in	
  this	
  paper	
  offer	
  an	
  attacker	
  a	
  privileged	
  vantage	
  point	
  on	
  a	
  home	
  or	
corporate	
  network.	
  A	
  compromise	
  of	
  such	
  a	
  device	
  can	
  grant	
  to	
  the	
  attacker	
  access	
  to	
  all	