# ZN600电信光猫分析 —— 初识
##### 译文声明
本文是翻译文章
译文仅供参考，具体内容表达以及含义原文为准。
作者：L.A.M[@Duncan](https://github.com/Duncan "@Duncan") SecTeam
## 0x00：引言
这应该是OpenWrt系列的第三篇文章了，这次终于要谈到主题了——OpenWrt，按照这个进度来说，好像真的是非常慢热。。。在上一篇文章《PT632电信“老猫”分析》中，做了一些关于PT632光猫的简单分析，但是这款猫已经停产了，因此没有对这款光猫进行更深入的剖析。这篇文章将会对电信新款的ZN600光猫（众多品牌天翼智能网关中的一款）进行相对深入的分析，当然主要是从操作系统和网络安全的角度来讲。如果想要详细了解如何捣鼓光猫的话，可以去恩山和chinaadsl上去搜罗一下，有很多大牛和一线技术人员的分析文章，非常棒，也给了我们很多的启发，在此一并表示感谢！
这篇文章涉及到的内容会比较多一些，因为ZN600光猫较之于PT632而言做了很多升级（本质上来说存在两个代际的跨越），主要包括但不限于：Lxc，OpenWrt，tcLinux等。在开始正文之前，还是按照Duncan
SecTeam的老规矩，祭上本文的mindmap，便于各位客官把我文章脉络，“挑肥拣瘦”。
## 0x01：ZN600电信光猫简介
ZN600是深圳兆能科技有限公司的一款天翼智能网关，目前还能在官网上查询到。但遗憾的是，公司官网上并没有给出这款光猫的技术细节，能够查到的最detail信息的也就是下面这张截图了。可以看到，官方只是给出了CPU，内存，FLASH等一些最基本的硬件信息，至于系统信息则是完全没有的。不过，咱这不就给它慢慢补上了嘛。。。
###  1、硬件信息
**a) CPU简介**
从兆能官网的信息来看，主CPU采用的是MTK
7526GT芯片，但是网上找不到任何技术资料，包括MTK官网，着实很吊诡。难道是定制芯片的原因吗？希望路过的学硬件的同学可以给科普一下啦。。。
**b) Wi-Fi芯片——2.4G，5G双频**
Wi-Fi芯片组其实也存在类似前面主芯片组的问题，找不着对应的MTK 7692N 2.4GHz芯片和MTK 7612EN
5GHz芯片，勉强在官网找到了一个MT7612E的芯片信息，迷茫。。。
**c) 内存 —— /proc/meminfo**
从官方给出的内存信息来看ZN600应该有512MB大小，但实际的内存为469092KB（458MB），这个地方暂时没搞明白。有懂硬件的童靴，请多多指教啦！
**d) FLASH存储**
从下面的图片中可以看到ZN600一共有12个分区，总共的大小为180282KB（约177MB），这大小跟官方说的128MB
FLASH又有出入，请懂硬件的童鞋给科普一下啦^_^
各个分区的用途也都非常清楚了
###  2、软件
**a) Linux tc**
ZN600光猫跑的是Linux内核是3.18.21版本，这个版本算是很低了，但是已经能够支持Linux
Container容器。在这里，我被要求代表team给各位看官大爷道个歉，之前关于电信网关中跑的“tc” Linux给出了错误的信息，天翼网关中的“tc”
Linux与Tiny Core Linux项目或许并不是同宗同源的，很可能只是凑巧用了同样的缩写“tc”
Linux。下面两张图分别截取了在天翼网关上的uname命令执行结果和在Tiny Core
Linux系统上执行uname命令的执行结果。可以看出，天翼网关的系统名称为“Linux tc”，而Tiny Core Linux的系统名称为“Linux
box”。
起初，我坚定认为天翼网关是从Tiny Core
Linux项目fork过来的原因是，他们俩的定位是一致的针对嵌入式系统的Linux，而且他们都有各种有一套类似于dbus的系统参数配置命名，而且名字也是非常相似，所以就犯懒了，草率的认定这俩系统就是一个祖宗。
**b) Linux Container —— Lxc**
我们team一致认为ZN600这只光猫最大的亮点在于采用了Lxc容器技术，这一点比起其他两家运行商来说在技术上显得更加大胆和自信，毕竟像光猫这种千家万户都在用的设备在设计之初就是一个“稳”字当头啊，一是怕大规模断网，二是怕美丽国通过这些智能网关设备对我们搞大规模监听（这是master说的）。
当然，也正是使用了这种操作系统级别的虚拟化技术，工程师们才能够比较容易的将电信传统的Web管理平台和“离经叛道”的OpenWrt项目整合到了一起。Master说，正是因为使用了容器技术，才使得电信工程师们在温和的技术改革中，既不需要在传统的Web管理界面中生硬的加入OpenWrt项目的各种功能（防火墙，行为管理等），也不用不着在OpenWrt中加上一大堆支持TR069协议的代码。这就是容器技术带来的技术变革和好处。
**c) Busyboxc) Busybox**
在ZN600光猫中，这款Linux操作系统“小军刀”仍然有在使用，不过显然是做了升级，解除了对grep命令的封杀，大快人心啊。。。
**d) Boa**
对比之前的电信PT632光猫来看，Boa
Web服务器基本没变化。估计电信工程师们应该是被那套老的Web管理界面给害苦了，坑惨了吧，都不愿意碰那套东西。历史遗留代码往往没人愿意在上面花精力维护，况且他们还把OpenWrt那套东西给塞进来了。
**e) Openwrt**
从参考文章[3]“打造智慧家庭连接新生态，中国电信明年推天翼网关3.0版本”中，可以看到电信在2018年推出了天翼网关3.0版本，这算得上给360、小米等智能路由器品牌当头一棒吧，直接亮底牌——谁才是家庭网关的王？
从上面这张图中，我们可以找到Lxc的身影——“先进的容器隔离技术”，当然这个“先进”应该是对照另外两家提供固网服务的后起友商吧，毕竟lxc算不得什么先进技术啊（都发展十几年了）！再者，所谓的智能OS难道就是一个针对嵌入式系统的Linux魔改版？当然，最让人捉摸不透的就是所谓的“智能应用插件”技术。从前面分析已经看出来了，电信传统的Web端口算是彻底废了，只是目前还把持网络通信这块儿的功能，其余的所谓“智能”技术全部交给了OpenWrt。。。