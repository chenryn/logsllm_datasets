# 【技术分享】逆向集成在谷歌语音程序中的OBi200固件：第一部分

#### 译文声明
本文为翻译文章，原文来源：[randywestergren.com](http://randywestergren.com)。译文仅供参考，具体内容及含义以原文为准。
- 译者：[hacker2017](http://bobao.360.cn/member/contribute?uid=1210592773)
- 预估稿费：100 RMB
- 投稿方式：发送邮件至 linwei#360.cn 或登录网页版在线投稿

### 前言
**OBi200** 是由Obihai公司生产的一款家庭VoIP网关，支持与谷歌语音集成。该设备具备大多数标准的VoIP功能，并可兼容几乎所有的“便携式”SIP服务。今年早些时候，我购买了一台OBi200作为家里的座机（无月租），至今运行状况良好。但在完全安装之前，我决定深入研究其工作原理。

### 固件分析
首先，我将设备连接到网络并打开了Web界面。检查后发现，当前刷入的固件版本为3.0.1 (Build: 4492)。而根据Obihai官网信息，最新版本是3.1.1 (Build: 5463EX)，显然我的设备使用的是旧版固件。我没有立即更新到新版本，而是选择先检查旧版固件是否存在已知的安全漏洞。

接着，我在Obihai官网上下载了最接近当前版本的固件文件——3.0.1 (Build: 4738)。使用[binwalk](https://github.com/devttys0/binwalk)工具对下载的固件进行扫描，结果显示其中包含了多个Squashfs文件系统镜像以及一个ARM文件系统镜像。这表明存在进一步探索的可能性。因此，我将这些文件导出到了本地文件系统中以便详细研究。

通过查看/etc/passwd文件，我发现root账户并未设置密码。此外，启动脚本/etc/rc也提供了有价值的信息，如设备初始化过程中执行的一系列命令和挂载点配置等。值得注意的是，一些被注释掉的调试/开发信息揭示了设备内部环境的部分细节。

### 弹出Shell
基于此前有关Obihai公司OBi1000电话产品安全漏洞的文章提示，我测试了自己的设备是否存在类似的命令注入漏洞。经验证，确实可以通过特定URI触发重启操作。然而，在尝试启动telnet守护进程时遇到了障碍——端口23似乎已被封锁。最终，我成功地在另一端口上开启了telnetd服务，并获得了根shell访问权限。

### 其他命令注入点
出于好奇心驱使，我继续寻找更多潜在的命令注入点。利用IDA Pro反汇编obiapp二进制文件后，发现了几个可疑的请求处理逻辑。经过实验验证，这些位置均能实现不同程度上的代码注入攻击。

### 持续获取Root权限
尽管上述漏洞已在新版固件中得到了修复，但我仍希望能够在升级之后继续保持对设备的控制。考虑到直接获得控制台shell是最理想的选择，下一步计划是定位主板上的UART接口并通过串行通信方式进行交互。具体操作将在后续文章中详细介绍。

敬请期待第二部分内容，届时我们将讨论如何识别并连接到主板上的UART引脚以实现设备的物理访问。