title:Identifying Traffic Differentiation in Mobile Networks
author:Arash Molavi Kakhki and
Abbas Razaghpanah and
Anke Li and
Hyungjoon Koo and
Rajesh Golani and
David R. Choffnes and
Phillipa Gill and
Alan Mislove
Identifying Trafﬁc Differentiation in Mobile Networks
Arash Molavi Kakhki
Northeastern University
PI:EMAIL
Abbas Razaghpanah
Stony Brook University
PI:EMAIL
Anke Li
Stony Brook University
PI:EMAIL
Hyungjoon Koo
Stony Brook University
PI:EMAIL
Rajesh Golani
Stony Brook University
PI:EMAIL
David Choffnes
Northeastern University
PI:EMAIL
Phillipa Gill
Stony Brook University
PI:EMAIL
Abstract
Traﬃc diﬀerentiation—giving better (or worse) performance
to certain classes of Internet traﬃc—is a well-known but
poorly understood traﬃc management policy. There is ac-
tive discussion on whether and how ISPs should be allowed
to diﬀerentiate Internet traﬃc [8, 21], but little data about
current practices to inform this discussion. Previous work
attempted to address this problem for ﬁxed line networks;
however, there is currently no solution that works in the
more challenging mobile environment.
In this paper, we present the design, implementation, and
evaluation of the ﬁrst system and mobile app for identify-
ing traﬃc diﬀerentiation for arbitrary applications in the
mobile environment (i.e., wireless networks such as cellular
and WiFi, used by smartphones and tablets). The key idea
is to use a VPN proxy to record and replay the network traf-
ﬁc generated by arbitrary applications, and compare it with
the network behavior when replaying this traﬃc outside of
an encrypted tunnel. We perform the ﬁrst known testbed
experiments with actual commercial shaping devices to vali-
date our system design and demonstrate how it outperforms
previous work for detecting diﬀerentiation. We released our
app and collected diﬀerentiation results from 12 ISPs in 5
countries. We ﬁnd that diﬀerentiation tends to aﬀect TCP
traﬃc (reducing rates by up to 60%) and that interference
from middleboxes (including video-transcoding devices) is
pervasive. By exposing such behavior, we hope to improve
transparency for users and help inform future policies.
Categories and Subject Descriptors
C.2.2 [Computer-Communication Networks]: Network
Protocols
Permission to make digital or hard copies of all or part of this work for personal or
classroom use is granted without fee provided that copies are not made or distributed
for proﬁt or commercial advantage and that copies bear this notice and the full cita-
tion on the ﬁrst page. Copyrights for components of this work owned by others than
ACM must be honored. Abstracting with credit is permitted. To copy otherwise, or re-
publish, to post on servers or to redistribute to lists, requires prior speciﬁc permission
and/or a fee. Request permissions from Permissions@acm.org.
IMC’15, October 28–30, 2015, Tokyo, Japan.
c(cid:13) 2015 ACM. ISBN 978-1-4503-3848-6/15/10 ...$15.00.
DOI: http://dx.doi.org/10.1145/2815675.2815691.
Alan Mislove
Northeastern University
PI:EMAIL
Keywords
Traﬃc diﬀerentiation; mobile networks; network neutrality
1.
INTRODUCTION
The rise in popularity of bandwidth-hungry applications
(e.g., Netﬂix) coupled with resource-constrained networks
(e.g., mobile providers) has reignited discussions about
how the diﬀerent applications’ network traﬃc is treated
(or mistreated) by ISPs. One commonly discussed ap-
proach to managing scarce network resources is traﬃc
diﬀerentiation—giving better (or worse) performance to cer-
tain classes of network traﬃc—using devices that selectively
act on network traﬃc (e.g., Sandvine [25], Cisco, and oth-
ers). Diﬀerentiation can enforce policies ranging from pro-
tecting the network from bandwidth-hungry applications, to
limiting services that compete with those oﬀered by the net-
work provider (e.g., providers that sell voice/video services
in addition to IP connectivity).
Recent events have raised the proﬁle of traﬃc diﬀerentia-
tion and network neutrality issues in the wired setting, with
Comcast and Netﬂix engaged in public disputes over conges-
tion on network interconnects [11, 15, 18]. The situation is
more extreme in the mobile setting, where historically reg-
ulatory agencies imposed few restrictions on how a mobile
provider manages its network, with subscribers and regula-
tors generally having a limited (or no) ability to understand
and hold providers accountable for management polices.1
Despite the importance of this issue, the impacts of traf-
ﬁc diﬀerentiation on speciﬁc applications—and the Inter-
net as a whole—are poorly understood. Previous eﬀorts
attempt to detect traﬃc diﬀerentiation (e.g.,
[6, 30, 36, 37]),
but are limited to speciﬁc types of application traﬃc (e.g.,
peer-to-peer traﬃc [6]), or focus on shaping behaviors on
general classes of traﬃc as opposed to speciﬁc applications
[13, 30, 37]. Addressing these limitations is challenging, due
to the wide variety of applications (often closed-source) that
users may wish to test for diﬀerentiation, coupled with the
closed nature of traﬃc shapers. As a result, external ob-
servers struggle to detect if such shapers exist in networks,
1As we discuss throughout this paper, FCC rules that took
eﬀect in June 2015 [9] now prohibit many forms of traﬃc
diﬀerentiation in the US.
239what exactly these devices do, and what is their impact on
traﬃc. What little we do know is concerning. Glasnost [6]
and others [26, 30, 36] found ISPs throttling speciﬁc types of
Internet traﬃc, Cogent admitted to diﬀerentiating Netﬂix
traﬃc [23], and recent work by Google and T-Mobile [12] in-
dicated that unintentional interactions between traﬃc shap-
ing devices has been known to degrade performance.
This paper tackles three key challenges that have held
back prior work on measuring traﬃc diﬀerentiation:
(1)
the inability to test arbitrary classes of applications, (2) a
lack of understanding of how traﬃc shaping devices work in
practice, and (3) the limited ability to measure mobile net-
works (e.g., cellular and WiFi) from end-user devices such as
smartphones and tablets. Designing methods that can mea-
sure traﬃc diﬀerentiation in mobile networks (in addition to
well-studied wired networks) presents unique challenges, as
the approaches must work with highly variable underlying
network performance and within the constraints of mobile
operating systems. By addressing these challenges, we can
provide tools that empower average users to identify diﬀer-
entiation in mobile networks, and use data gathered from
these tools to understand diﬀerentiation in practice.
This paper makes the following key contributions:
• The design and implementation of a system for
detecting traﬃc diﬀerentiation in mobile net-
works (Sec. 3). We design an application-layer trace
record-and-replay system that enables testing of arbi-
trary network applications, and works even if these appli-
cations are closed source. Our solution does not require
special privileges on client devices, making it readily de-
ployable on a global scale. The key idea is to use a VPN
proxy to record arbitrary application traﬃc, and later
replay that traﬃc both with and without the VPN to
identify diﬀerentiation. We implement this both as an
Android and desktop application.
• Validation of our approach using commercial
shaping devices (Sec. 4). To the best of our knowl-
edge, we are the ﬁrst study to validate that our detection
system correctly triggers diﬀerentiation on commercial
shaping devices. Using a testbed consisting of two such
devices, we establish a ground truth to evaluate the ac-
curacy of our approach and identify several pitfalls of
previous approaches.
• Evaluating statistical techniques for identifying
diﬀerentiation (Sec. 5). Previous work uses a variety
of statistical techniques to determine when diﬀerentia-
tion occurs. We use our testbed with commercial shaping
products (with conﬁgurable shaping rates), a controlled
network with no diﬀerentiation, and controlled loss with
Linux Traﬃc Control (tc) to systematically evaluate the
accuracy of diﬀerent statistical techniques for identifying
diﬀerentiation.
• An Android app that conducts our diﬀerentiation
tests and a measurement study of diﬀerentiation
in mobile networks (Sec. 6). We develop an Android
app that conducts our diﬀerentiation tests on unmod-
iﬁed Android OSes, as part of an IRB-approved study
of diﬀerentiation in mobile networks worldwide. We de-
ploy our software in the US and four other countries, and
ﬁnd several instances of shaping, in addition to pervasive
interference from middleboxes.
In addition to being the ﬁrst approach to reliably de-
tect diﬀerentiation from mobile devices without special
privileges, our study also identiﬁes several instances of
middleboxes violating end-to-end principles for a variety
of popular apps. In particular, we ﬁnd evidence of video
transcoding, HTTP header manipulation in requests and
responses, and proxies that modify TCP behavior. While
previous work identiﬁed such behavior for Web traﬃc, we
are the ﬁrst to do so for arbitrary app traﬃc.
The following section discusses related work and deﬁnes
diﬀerentiation that we detect. After detailing our key con-
tributions listed above, we discuss issues with diﬀerentiation
and its detection that are beyond the scope of this work
(Sec. 7), and we conclude in Sec. 8.
2. BACKGROUND
There is an ongoing debate about whether the network
should be neutral with respect to the packets it carries [4];
i.e., not discriminate against or otherwise alter traﬃc except
for lawful purposes (e.g., blocking illegal content). Propo-
nents such as President Obama argue for an open Inter-
net [21] as essential to its continued success, while some
ISPs argue for shaping to manage network resources [6, 26].
The regulatory framework surrounding traﬃc diﬀerentia-
tion is rapidly changing; between submission and publication
of this manuscript, the FCC transitioned from imposing few
restrictions on how mobile providers manage their network,
to new rules that prohibit many forms of diﬀerentiation [9].
In this environment, it is important to monitor traﬃc diﬀer-
entiation in practice, both to inform regulators and enforce
policies.
In the remainder of this section, we overview related work
on measuring traﬃc diﬀerentiation and network neutrality
and then deﬁne the types of traﬃc diﬀerentiation our system
aims to detect.
2.1 Related Work
Comcast’s blocking of BitTorrent [28] in the mid 2000s
spurred research eﬀorts to study traﬃc diﬀerentiation. This
led to several studies that focus on applications or ﬂows
known to be subject to classiﬁcation, and design tests to
detect diﬀerentiation on those ﬂows. For example, Glasnost
focuses on BitTorrent [6] and NetPolice [36] tests ﬁve ap-
plications (HTTP, BitTorrent, SMTP, PPLive and VoIP).
Bonaﬁde [3] takes a similar approach to Glasnost in the
mobile environment, including tests for HTTP, FlashVideo
(YouTube), SIP, RTSP, BitTorrent, and VoIP H323. These
approaches focus on protocols rather than speciﬁc applica-
tion implementations. A key limitation is that the shaping
devices we observed support application/provider granular-
ity, e.g., shape RTSP traﬃc for one content provider, but
not other RTSP applications (see Sec. 4). Such application-
based diﬀerentiation may not be detected by these systems.
They also require manually implementing protocol details
and thus have limited extensibility. We address these limi-
tations in this work.
Furthermore, these projects treat traﬃc diﬀerentiation as
a “black box” which they aim to detect by sending traﬃc
and observing network performance metrics. Notably, these
prior studies lack ground-truth information about how dif-
ferentiation is implemented, and whether or not their de-
tection mechanisms would trigger traﬃc shaping in practice
(an issue we address in this work).
240Another approach avoids testing speciﬁc applications and
focuses on detecting diﬀerentiation for arbitrary traﬃc.
NANO [30] uses Bayesian analysis to detect diﬀerentiation,
while Zhang et al. [37] focus on identifying when it is feasible
to detect and isolate diﬀerentiation. Other related projects
focus on performance issues in ISPs [7, 16, 18, 19] and shap-
ing of all of a subscriber’s traﬃc [13], but do not detect
diﬀerentiation itself.
Other related studies detect proxies on network paths, and
conduct tests to identify a wide range of application-speciﬁc
proxy behaviors [2, 14, 29, 32, 33]. A recent paper [31] specif-
ically focuses on proxies and other middleboxes in mobile
networks, and discusses how these devices vary according to
mobile virtual network operator (MVNO). Zarinni et al. use
Bonaﬁde [3] to test for diﬀerentiation of BitTorrent, VoIP-
H323 and RTSP [35] in MVNOs. The authors did not ob-
serve diﬀerentiation of this limited set of applications; in
contrast, our approach identiﬁed diﬀerentiation in three of
the networks they tested.
2.2 Differentiation considered in our work
In this work, we consider the problem of detecting dif-
ferentiation caused by traﬃc-shaping middleboxes (rather
than interconnection provisioning [11, 15, 18]). We focus on
the mobile environment, in large part due to minimal regu-
lation and scarce network resources in mobile data networks.
However, our techniques also work in the ﬁxed-line environ-
ment.
We focus on diﬀerentiation aﬀecting network performance
as perceived by applications. In our experiments, we observe
that even high-bandwidth mobile applications such as video
streaming do not necessarily exhaust the bandwidth avail-
able, possibly to avoid wasting data transfer in case of viewer
abandonment. This is in contrast to protocols that previ-
ous approaches focused on (e.g., BitTorrent), which aim to
saturate the link bandwidth. For applications that do not
exhaust the available resources, we do not consider traﬃc
shaping where the shaping rate is higher than the bandwidth
demands to be diﬀerentiation. For example, if a shaper lim-
ited a given application to 200 KB/s, but the application
never sent faster than 150 KB/s, we would not consider this
diﬀerentiation (as the application would never be aﬀected
by it). This more conservative approach gives us a clearer
picture of shaping that actually impinges on the network
resource demands of applications.
We make the assumption that traﬃc diﬀerentiation is
likely triggered by at least one of the following factors: IP
addresses, port numbers, payload signatures, number of con-
nections, total bandwidth, and time-of-day.
We conﬁrmed these assumptions are consistent with fea-
tures listed in online manuals of deep packet inspection
(DPI) devices and traﬃc shapers. We also run experiments
with two commercial packet shapers and show that our as-
sumptions hold for these devices (Sec. 4.2).
In this work, there are certain types of traf-
Nongoals.
ﬁc management policies that we are not able to detect.
First, we do not focus on detecting congestion at peering
points, a tactic used by certain ISPs to extract payment
from large bandwidth consumers [11]. Second, we do not
focus on blocking (e.g., censorship) or content modiﬁcation
(e.g., transcoding) by middleboxes. While our methodology
is able detect these types (and we found cases of both), they
are orthogonal to the issue of shaping. Third, we currently
(a) Record
(b) Parse
(c) Replay
(d) Analyze
Figure 1: System overview: (a) Client connects to VPN, that
records traﬃc between the client and app server(s). (b) Parser
produces transcripts for replaying. (c) Client and replay server