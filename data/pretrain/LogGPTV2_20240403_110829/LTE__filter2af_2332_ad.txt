消息的完整性。然而，我们推测设备供应商误解了某些特殊情况（例如，当 UE 在为初始消息激活安全性之前发送消息时，MME 在没有完整性保护的情况下接受 NAS
消息）。在我们的测试场景中，因为受害者UE 和服务 MME 具有有效的安全上下文，MME 应该验证每个接收到的消息的完整性。验证失败应该导致 MME
丢弃或拒绝接收到的消息，同时保持受害 UE 的现有连接。因此，这些案例显然构成了所有三个 MME 的处理错误。
###  D. 重放消息被接受
**测试用例观察。** 在验证属性 2 中的第二种情况时，我们还检验了接收实体（网络组件或 UE）是否验证序列号以防止消息重放攻击。结果证实，一些精心设计的
NAS 消息被 MME 和 UE 都接受为有效，因为测试人员随后收到了预期的回复消息（情况 1）。例如，当测试者发送重放的 NAS PDN
断开请求以断开指定的现有数据承载时，测试者收到安全保护的 NAS 消息，而受害 UE 隐秘地断开了数据承载的连接（情况
1）。另外，当测试器向MME3发送重放的NAS TAU请求时，它向测试器回复了NAS TAU
accept，这意味着MME3错误地更新了受害UE的TA（情况2）。然而，当测试器向 MME1 发送重放的 TAU 请求时，它立即断开注册受害 UE
的现有连接，而测试器收到 RRC Connection release （情况 3）。对于下行 NAS
消息，我们确认海思基带接受了重放的消息，允许攻击者执行消息欺骗攻击（情况 2）。  
 **根本原因分析。** 3GPP 标准要求 MME 和 UE 都支持对受安全保护的 NAS
消息的重放保护，并为供应商提供了详细的重放保护方法。但是，同一个文档要求接收实体在验证接收到的 NAS 消息的完整性时，将接收到的消息中包含的 NAS
序列号用于计数器的 8 个 LSB。此外，当完整性验证成功时，接收实体应使用接收到的序列号的值更新其本地计数器。在这种完整性验证方法中，除非本地计数器的
28个 LSB 与计算消息完整性时使用的计数器不同，否则消息重放是可能的。因此，标准中规定的完整性验证方法与 NAS
消息应支持重放保护的安全要求相矛盾。结果，所有三个 MME 都容易受到重放攻击，至少对于一个 NAS 消息，我们的目标基带之一接受了重放消息。
###  E. 安全过程可被绕过
**测试用例观察。** 在属性 3 方面，我们检查了三个测试用例：（1）跳过 RRC 层中的密钥协商过程以取消 RRC 和用户数据的安全上下文，（2）跳过
RRC 和 NAS 层中的密钥协商程序取消整个控制平面和数据平面的安全上下文，以及 (3) 在 RRC 和 NAS 中跳过 AKA
中的所有安全过程。因此，对于我们的目标移动设备，只有第一种情况成功。如果攻击者利用这种情况，他们将能够欺骗 RRC 消息以获取 UE
的私人信息，并窃听用户的通信。  
 **根本原因分析。** 如规范中所述，安全程序是保护 UE
与网络之间通信的强制性步骤。但是，我们确认部分商用设备（使用高通基带）不符合规范，所以它们允许省略 RRC
层中的安全密钥协商。因此，该漏洞的根源在于商用基带芯片组的实现缺陷。
## 0x06 Attacks Exploting ENB
###  A. BTS 资源耗尽攻击
每个商用 eNB 都具有基于其硬件和软件规范的最大活动用户连接容量。 BTS 资源耗尽攻击的目的是耗尽活动 RRC Connections
的这个容量，从而阻止其他用户连接到目标 eNB。  
1) **攻击模型** ：这种攻击的目标是商业运营的 eNB。攻击者可以通过被动侦听广播消息来获取目标 eNB 的连接信息，类似于其他正常设备。  
2) **攻击过程** ：攻击者重复执行随机访问并生成 RRC 连接以增加活动 RRC 连接的数量，如下图所示。在正常情况下，在 RRC 连接建立后，初始
NAS 连接过程立即通过 NAS 连接请求或 NAS 服务请求搭载在 RRC 连接完成消息上进行。在我们的攻击中，攻击者使用任意用户 IMSI 发送 NAS
Attach Request。与正常流程不同的是，一旦攻击者收到 NAS Authentication Request，它就会重新启动 Random
Access 以建立新的 RRC 连接。对手不回复来自 MME 的 NAS 认证请求的原因是在 MME 等待有效的 NAS 认证响应时维持已建立的 RRC
连接。如果对手以无效的 NAS 身份验证响应进行回复，则会导致立即释放 RRC 连接。攻击成功的一个考虑因素是新建立的 RRC 连接的数量必须大于释放的现有
RRC 连接的数量。
3) **实现** ：我们使用一个 USRP B210 作为软件无线电收发器，并使用 srsUE 来实现恶意 UE。为了用不同的 C-RNTI 连续重复
RRC 连接过程，我们修改了 srsUE 以在它收到 NAS 认证请求时重新启动另一个随机接入过程，而不是用 NAS 认证响应进行回复。如果使用相同的
C-RNTI 发送多个 RRC 连接请求，则 eNB 将其作为对同一 RRC 连接的重复请求进行处理，这不是我们攻击的目标。  
4) **验证** ：因为攻击商业运营的 eNB 会影响合法用户，我们对连接到我们在 OpenAirInterface (OAI) 上实现的测试平台 EPC
网络的 COTS 毫微微蜂窝基站执行了 BTS 资源消耗攻击。我们主要尝试确定可以使用一台 USRP 设备建立的虚假 RRC 连接的数量。这是通过验证使用
Airscope 的毫微微蜂窝的活动 RRC 连接来完成的。它通过对 LTE 物理层中的通信信道进行解码来提供无线用户信息。下图显示活动 RRC
连接的数量增加，直到达到毫微微蜂窝的最大容量，即在我们的目标毫微微蜂窝的情况下为 16 个活动连接。
因此，一旦对手产生了 16 个 RRC 连接，毫微微蜂窝将拒绝来自对手或合法 UE 的所有后续 RRC 连接请求，如下图所示。在演示攻击时，建立 16 个
RRC 连接需要 0.762 秒，我们每秒可以建立 20 个 RRC 连接。因此，如果可操作的 eNB 等待 10 秒以释放不活动的 RRC
连接，则对手将能够创建 200 个 RRC 连接。我们与运营商确认，这种性质的攻击会影响正在运行的 eNB。此外，运营商提出了一个更严重的情况。如果对手在
RRC 连接请求中包含“紧急”作为建立原因，如果没有额外的 RRC 资源可用，它甚至会释放现有的 RRC 连接。
###  B. 盲 DoS 攻击
与上述拒绝 eNB 中的多个用户的攻击不同，盲 DoS 攻击通过建立伪装成受害者 UE 的 RRC 连接来拒绝目标 UE。  
1) **攻击模型** ：攻击者在受害者服务 eNB 覆盖的区域内进行攻击。攻击者还知道受害者的 S-TMSI，可以通过三种方式获得：
• 知道受害者的电话号码或社交媒体（例如 Facebook 和 Whatsapp）上的帐户的对手可以通过执行无声寻呼攻击来获取受害者的 S-TMSI。  
• 位于目标用户附近的攻击者可以操作恶意 eNB 来获取受害 UE 的 NAS TAU 请求。该请求包含受害者 UE 的
S-TMSI。一旦收到此消息，攻击者就会关闭恶意 eNB，以使受害 UE 能够通过连接到运营商网络来恢复 LTE 服务。  
• 攻击者嗅探目标UE 的RRC 连接过程以获得目标UE 的S-TMSI，如RRC 连接建立中指定的那样。
2) **攻击过程** ：攻击者通过建立一个被欺骗为受害者 UE 的 RRC 连接来执行攻击（如下图所示）。这可以通过在 RRC 连接请求的
ueIdentity 字段中插入受害 UE 的 S-TMSI 来实现。不费吹灰之力就可以发起这种攻击来规避已部署的安全措施，因为按照设计，RRC
连接过程没有安全机制来隐藏内容或验证消息发送者。
3) **实现** ：我们使用一个 USRP B210 作为软件无线电收发器，srsUE 用于软件 LTE UE。我们稍微修改了 srsUE，将目标 UE
的 S-TMSI 添加到 RRC Connection 请求的 ueIdentity
字段中。另外，由于与BTS资源耗尽攻击相同的原因，攻击者设备不响应NAS Authentication请求。  
4) **验证** ：我们验证了对位于我们实验室大楼附近的商用 eNB 的攻击。为了排除无辜的受害者，我们只使用了我们手机的 S-TMSI 作为受害者 UE
的身份。根据受害UE的RRC连接状态，通过将攻击分为两种类型来评估攻击的影响。
• 受害UE 处于RRC IDLE 状态：当寻呼通知传入服务或UE 有传出服务流量时，UE 尝试建立RRC 连接。如果攻击者伪造成受害者 UE建立了一个
RRC 连接，提供服务的 eNB 将受害者的 RRC 状态保存为 RRC CONNECTED 并将此更改通知提供服务的
MME。因此，尽管存在针对受害者的传入服务，MME 不会触发对任何 eNB 的寻呼。在这种情况下，受害者会隐式地与服务 eNB
断开连接，直到它尝试为来自应用服务的传出流量建立新的 RRC 连接。从用户的角度来看，传入的数据和语音都被阻止，而不会发出任何断开连接的通知。  
• 受害者 UE 处于 RRC CONNECTED 状态：当攻击者建立了一个伪造的 RRC 连接，受害者 UE 现有的 RRC 连接在 eNB
上被释放，而不通知受害者。在这种情况下，UE 继续与服务 eNB 通信，但由于无线承载已经释放而失败。一旦多次通信失败，UE 就会进入无线链路失败
(RLF) 状态，从而发送 RRC 连接重建请求。然而，服务 eNB 拒绝了这个请求，因为它已经被释放了。 UE收到拒绝消息后，尝试执行NAS
TAU程序并通过发送NAS服务请求重新建立连接。最终，UE在上述重新注册过程中与网络断开连接。重新注册所需的时间约为 0.5 秒，因此如果攻击者每 0.5
秒持续建立欺骗性 RRC 连接，受害者将永久保持断开连接状态。
请注意，我们在三个不同的 eNB 供应商上验证了这种攻击。当受害 UE 处于 RRC IDLE 时，所有 eNB 的攻击都成功了。然而，当受害者 UE 处于
RRC CONNECTED 状态时，我们的两个目标 eNB 受到攻击影响，而另一个 eNB 没有。总而言之，盲 DoS 攻击可以通过欺骗 eNB 认为 UE
处于 RRC CONNECTED 状态的来阻止处于 RRC IDLE 状态的受害 UE 的传入服务。此外，受害的 UE 被两个供应商永久停止使用 LTE