### Skew in Evaluation Results and Bias

The evaluation results tend to favor signature-based tools, which is further evidenced by the less popular samples in the benchmark and the real-world website evaluations (Section 4.2). To explore this bias, we developed five benign and five malicious PHP programs in an adversarial manner. A collaborator, who was unaware of the specific detection techniques, created these scripts. The benign scripts were intentionally designed to trick detection methods into generating false positives by employing encoding and obfuscation techniques for benign operations. The malicious scripts ranged from simple, straightforward code to highly obfuscated ones. Table 1 provides an overview of our benchmark suite, which includes malware ranging from one-liners to files larger than 500KB.

### Malware Detection Tools for Comparison

We compared the performance of several widely used malware detection tools:

1. **Linux Malware Detector (maldet)**: Uses MD5 and hexadecimal signatures for malware detection.
2. **backdoorMan**: An open-source Python toolkit for detecting malicious PHP scripts.
3. **PHP Malware Finder (phpmaldet)**: Focuses on deobfuscation and then recognizes malware using Yara rules.
4. **ClamAV**: An open-source antivirus solution.
5. **VirusTotal**: An online aggregate service that scans files with over 50 antivirus systems.

Additionally, there are online PHP malware detection and deobfuscation services like unPHP and shellray. However, we excluded these from our comparison due to inconsistent and non-deterministic results, as well as a high rate of false positives.

### Scanning Real-World Websites (Dataset A)

To demonstrate the effectiveness of MalMax, we used a large corpus of 87 real-world infected websites, consisting of 3,225,403 files (approximately 1 TB). The dataset includes various types of malware found in the wild, showcasing how MalMax performs against realistic, advanced threats. These websites were selected because at least one file in each site was flagged as malicious by Linux Malware Detector (maldet). For more details on the file extension distribution in the dataset, see Appendix A.1.

### Malware Categorization

Table 1 categorizes the malware in our benchmark. Some malware fall into multiple categories, as shown below:

| Category       | Count |
|----------------|-------|
| Webshell       | 39    |
| Backdoor       | 7     |
| Flooder        | 6     |
| Spammer        | 7     |
| Bruteforcer    | 9     |
| Bypasser       | 3     |
| Defacer        | 2     |
| **Total (Unique)** | **73 (53)** |

### Real-World Benign PHP Applications (Dataset C)

We selected four diverse, popular, and representative PHP web applications to evaluate MalMaxâ€™s false positive and negative rates:

1. **WordPress**: A content management system that powers more than half of the World Wide Web.
2. **Joomla**: The second most popular web application, powering over 10 million websites and known for its complexity (500K lines of code, 55 dynamic scripting features).
3. **phpMyAdmin**: A MySQL database management web application in PHP, which involves security-sensitive behaviors such as changing database server and system configurations.
4. **CakePHP**: A popular PHP web application development framework that uses various third-party tools and scripts, making analysis challenging.

### Analysis of Program Relevant Files

We preprocessed all the files to identify those containing PHP source code. We found 712,367 files with PHP code, including 35,555 files disguised as non-PHP files (e.g., icons, images, text files). This is a common tactic used by attackers to hide malicious PHP code. To confirm the accuracy of these disguised files, we ran MalMax to obtain complete control flow and behaviors, confirming they are valid PHP files.

### Malware Detection Results

We ran MalMax and maldet on all 712,367 program-relevant files, and 3,986 files were flagged as malware. Figure 6 shows the breakdown of samples flagged as malicious by PhpMalScan and maldet:

- **95 files** (Blue) only detected by maldet.
- **3,748 files** (Red) only identified by PhpMalScan.
- **143 files** (Black) detected by both tools.

To further investigate, we used VirusTotal (VT) to scan the 238 files detected by maldet. VT detected 33 out of these 238 files. The detailed results are summarized in the following table:

| Tool          | Detected Malware |
|---------------|------------------|
| maldet        | 95               |
| PhpMalScan    | 3,748            |
| Both          | 143              |
| VT (of 238)   | 33               |

### Summary of Scan Results

- **Total Files Scanned**: 712,367
- **Program-Relevant Files**: 712,367
- **Flagged as Malware**: 3,986
- **Not Flagged**: 708,381 (99.44%)
- **Data Files (e.g., images, icons, text files)**: 2,513,036 (77.9%)

This comprehensive evaluation demonstrates the effectiveness of MalMax in detecting both benign and malicious PHP code, providing a robust and reliable solution for real-world applications.