180.*
210.*
240.*
(a) NS records
(b) MX records
(c) A records
Figure 2: Fraction of IP addresses associated with malicious domains and comparison with legitimate domains.
almost entirely in untainted ASes. On the other hand,
the
majority of spam domains have records hosted in tainted ASes,
even during the pre-attack period.
We derive the tainted AS set by including an AS that has hosted
records for more than 100 spam domains. Figure 3 shows the ra-
tio of the tainted record number to the number of all records for
the domain. More than 90% of legitimate new domains have zero
records belonging to the tainted AS set.
5. EARLY LOOKUP BEHAVIOR
The recursive DNS resolvers initially query the TLD name
In this section,
servers to get referrals to second-level domains.
we explore the characteristics in the lookup networks to different
types of domains. Queries to a malicious domain may signal the
onset of attack, and the abnormal pattern in the global DNS trafﬁc
could help to detect the attack campaign in its infancy.
5.1 Network-Wide Patterns
We ﬁrst investigate the querying patterns across different do-
mains, to see whether similar sets of networks were looking up
different domains. Our intuition is that domains that are used for
malicious purposes may be looked up by similar groups of net-
works as well. For example, a user clicking on a URL in spam
might click on other spam URLs. If two domains are queried by
the same set of recursive DNS servers, they may be the same type
of domain.
Are the networks querying different domains distributed sim-
ilarly? We measure the similarity using an average pairwise sim-
ilarity of querying /24 network blocks over n days. Suppose
two domains A and B who have sequences of querying /24 set
{a1, a2, . . . , an} and {b1, b2, . . . , bn} over n days. The similarity
between domains A and B is
S(A, B) =
Pn
i=1 J(ai, bi)
n
, where J(ai, bi) =
|ai ∩ bi|
|ai ∪ bi|
where J(ai, bi) is the Jaccard index of set ai and bi: the size of
the set intersection divided by the size of union. Based on this
pairwise similarity, we aggregate the domains into different groups
using single-linkage clustering, a simple and efﬁcient clustering
method [18]. We considered a 5-day time period from March 1–5,
2011, during which there were 804 malicious domains and 1, 104
sampled legitimate domains registered. We terminate the cluster-
ing after 50, 000 comparisons, which places 1, 631 domains into
total
1404
157
16
10
10
malicious
463
156
16
10
10
legitimate
941
1
0
0
0
% malicious
33.0%
99.4%
100.0%
100.0%
100.0%
Table 3: Five largest clusters based on lookup networks.
17 clusters that have more than a single domain. We expect do-
mains to fall into distinct clusters. Tables 3 shows the statistics for
the ﬁve largest clusters. The ﬁrst three columns show the domain
counts in each cluster. The last column means the percentage of the
malicious domains in the cluster.
Finding 5.1 (Similarity in lookups) Different malicious do-
mains are looked up by similar group of network blocks, which
may indicate that they are part of the same spamming campaign.
The results show that clustering often works well: many of the clus-
ters contain either only all good or all bad domains. The legitimate
domains contained in the large cluster are only queried by a small
number of networks, which a detection system could easily ﬁlter.
These results suggest that domains of certain types do share similar
network-wide spatial lookup patterns that may ultimately be used
as input to a blacklist.
5.2 Evolution of Lookup Trafﬁc
The numbers of distinct networks querying the TLD servers
for the second-level domains approximate how widely around the
world the users try to connect to these domains. Although there
might be multiple connection attempts behind one recursive server,
counting all querying recursive servers is a good indicator for the
domain’s initial “popularity”. Our intuition is that once deployed,
malicious domains may receive a lot of trafﬁc in a short time, but
visits to legitimate domains will increase relatively more slowly.
How quickly do the newly registered domains become popular?
Figure 4 shows the average lookup volume from /24s for domains
in different categories over time. The x-axis shows the number
of days after a domains’ registration. The y-axis shows the aver-
age number of querying /24s over the domains with error bars (i.e.,
standard error). The solid blue curve shows lookups for legitimate
domains; the y-axis values are multiplied by 10 to make the ﬁgure
more readable. The dashed red curve shows the patterns of mali-
cious domains.
273i
s
n
a
m
o
d
f
o
s
r
e
b
m
u
n
f
o
%
e
v
i
t
l
a
u
m
u
C
100
 80
 60
 40
 20
  0
0
100
100
i
s
n
a
m
o
d
f
o
s
r
e
b
m
u
n
f
o
%
e
v
i
t
l
a
u
m
u
C
legitimate sample
malicious
pre−attack period
0.2
0.4
0.6
0.8
1
Ratio of records within the tainted AS set for the domain
 80
 60
 40
 20
  0
0
i
s
n
a
m
o
d
f
o
s
r
e
b
m
u
n
f
o
%
e
v
i
t
l
a
u
m
u
C
legitimate sample
malicious
pre−attack period
0.2
0.4
0.6
0.8
1
Ratio of records within the tainted AS set for the domain
 80
 60
 40
 20
  0
0
legitimate sample
malicious
pre−attack period
0.2
0.4
0.6
0.8
1
Ratio of records within the tainted AS set for the domain
(a) NS records
(b) MX records
(c) A records
Figure 3: The distribution for the ratio of domains’ records falling in the “tainted” AS set.
legitimate sample × 10
malicious
1400
1200
1000
800
600
400
200
i
s
4
2
/
g
n
y
r
e
u
q
f
o
r
e
b
m
u
n
e
g
a
r
e
v
A
0
0
5
10
15
20
25
30
Age (Days)
Figure 4: Number of querying /24s after domains’ registration.
Finding 5.2 (Initial lookup trends) Queries to the malicious
domains increased quickly after the domains were registered,
and usually reached the peak in the ﬁrst 3–4 days.
On the other hand, /24s querying for domains not reported as mali-
cious increased slowly and stayed relatively low over the 30-day
period. The markedly different lookup patterns of likely legiti-
mate domains and those involved in spamming activities might ul-
timately help blacklist operators quickly detect bad domains, by
watching for newly registered domains that suddenly become pop-
ular. The changes to malicious domains also indicate that the ini-
tial ﬁve-day period may contain valuable information, since these
attack domains are heavily queried at the beginning, but lookups
quickly trail off after that.
6. CONCLUSION AND FUTURE WORK
We have monitored DNS resource records for second-level do-
mains newly registered in March 2011 and examined the lookup
trafﬁc to large authoritative top-level domain servers. We show the
DNS characteristics observed at TLD name servers and extracted
from zones’ resource records for malicious domains are different
than those for legitimate domains. Resource records of malicious
domains tend to resolve to speciﬁc IP address range and ASes.
Once we identify a set of “tainted” autonomous systems that host
many scam domains, the legitimate domains rarely have resource
records within the tainted AS set. We also discover that miscre-
ant domains exhibit distinct clusters, in terms of the networks that
look up these domains. Finally, we ﬁnd that these domains become
widely popular considerably more quickly after their initial regis-
tration time.
The distinct DNS characteristics and their tendency on different
types of domains suggest that it may ultimately be possible to ﬁn-
gerprint domains based on their resource records and lookup trafﬁc
close to TLD name servers before an attack ever takes place. Al-
though a single pattern in DNS might have limited power to identify
malicious domains, the combination of our ﬁndings may ultimately
guide the design of future “early warning” systems for DNS.
Acknowledgments
We thank Yahoo!
Inc. for providing the received time of the
email messages and the contained URLs. We also thank our shep-
herd, Christian Kreibich, as well as David Dagon and Anirudh Ra-
machandran for helpful comments on the paper. This work was
funded by NSF CAREER Award CNS-0643974 and NSF Awards
CNS-0716278 and CNS-0721581.
REFERENCES
[1] M. Antonakakis, D. Dagon, X. Luo, R. Perdisci, W. Lee, and
J. Bellmor. A Centralized Monitoring Infrastructure for
Improving DNS Security. In Proc. 13th International
Symposium on Recent Advances in Intrusion Detection
(RAID), Ottawa, Ontario, Canada, Sept. 2010.
[2] M. Antonakakis, R. Perdisci, D. Dagon, W. Lee, and
N. Feamster. Building a Dynamic Reputation System for
DNS. In Proc. 19th USENIX Security Symposium,
Washington, DC, Aug. 2010.
[3] M. Antonakakis, R. Perdisci, W. Lee, N. V. II, and D. Dagon.
Detecting Malware Domains at the Upper DNS Hierarchy. In
Proc. 20th USENIX Security Symposium, San Francisco, CA,
Aug. 2011.
[4] L. Bilge, E. Kirda, C. Kruegel, and M. Balduzzi.
EXPOSURE: Finding Malicious Domains Using Passive
DNS Analysis. In Proc. 18th Annual Network and
Distributed System Security Symposium (NDSS), San Diego,
CA, Feb. 2011.
[5] A. Broido, E. Nemeth, and K. Claffy. Spectroscopy of DNS
Update Trafﬁc. ACM SIGMETRICS Performance Evaluation