DEF CON 19 
Malware Freakshow 3: 
 They're pwning er'body out there! 
Nicholas J. Percoco & Jibran Ilyas 
Copyright Trustwave 2011 
Agenda 
•  Introduction 
•  Evolution of Malware 
•  Sample Analysis + Victim + Demo 
•  Sample SL2010-161 – Kameo (Grocery Store) 
•  Sample SL2011-014 – Memory Dumper (Bar) 
•  Sample SL2011-026 – Webcheck.dll (Work) 
•  Sample SL2011-039 – Android Malware (Phone) 
•  Conclusions 
Copyright Trustwave 2011 
Inspiration – “System Intruder” 
“Well… There's malware on the interwebs. They're pwning all 
your systems, snatching your data up. So hide your cards, hide 
your docs, and hide your phone, 'cause they're pwning er'body 
out there!” – Zero Cool 
Copyright Trustwave 2011 
Introduction – Who are these guys? 
Nicholas J. Percoco (@c7five) 
•  Head of SpiderLabs at Trustwave 
•  Started my InfoSec career in the 90s 
•  4th DEF CON talk (2 more this weekend – Droid & SSL) 
•  Primary author of Trustwave’s Global Security Report  
Jibran Ilyas (@jibranilyas) 
•  Senior Forensic Investigator, Spiderlabs at Trustwave 
•  9 Years of InfoSec Experience 
•  Speaker at several Global Security Conferences like Black 
Hat, DEF CON, SecTor, Source Barcelona, etc. 
•  Masters degree from Northwestern University 
Copyright Trustwave 2011 
Introduction – Why give a “Freakshow”? 
Exploits	
  are	
  commodi0es.	
  Malware	
  fuels	
  the	
  business	
  of	
  crime*.	
*“They're pwning er'body out there!” 
Copyright Trustwave 2011 
Introduction – What’s this about? 
This	
  the	
  3rd	
  Itera0on	
  of	
  this	
  Talk	
• 
2009	
  –	
  KeyLogger,	
  MemDumper,	
  Video	
  Poker,	
  Sniﬀer	
• 
2010	
  –	
  MemDumper,	
  Logon	
  Creden=als	
  Stealer,	
  Sniﬀer,	
Client-­‐Side	
  (PDF	
  Malware)	
New	
  Targets	
  This	
  Year	
  -­‐>	
  YOU	
• 
Your	
  Grocery	
  Store	
• 
Your	
  Favorite	
  Bar	
• 
Your	
  Work	
• 
Your	
  Smart	
  Phone	
Copyright Trustwave 2011 
Evolution of Malware - 2009 
•  Sloppy	
  malware	
  developers	
•  Just	
  “tes=ng	
  the	
  waters”	
•  No	
  covert	
  ﬁle	
  system	
  placement	
•  Noisy	
  output	
  ﬁles	
•  Easily	
  detected	
  using	
  “Task	
  Manager”	
Copyright Trustwave 2011 
Evolution of Malware - 2010 
•  Started	
  to	
  use	
  “tricky”	
  names	
  for	
  executable	
•  Located	
  in	
  “system”	
  folders	
•  Output	
  s=ll	
  mainly	
  in	
  plain-­‐text	
  and	
  wriYen	
  to	
  disk	
•  Advanced	
  tools	
  can	
  easily	
  detect	
  them	
•  Automated	
  exﬁltra=on	
  in	
  certain	
  instances	
Copyright Trustwave 2011 
Evolution of Malware - 2011 
•  Malware	
  developers	
  have	
  grown	
  up	
•  Completely	
  subver=ng	
  process	
  analysis	
  tools	
•  Many	
  instances	
  of	
  ZERO	
  data	
  storage	
•  When	
  data	
  is	
  stored	
  it	
  is	
  ENCRYPTED	
•  More	
  eﬃcient	
  methods	
  resul=ng	
  in	
  small	
  footprint	
•  Automa=on	
  is	
  “everywhere	
  they	
  want	
  to	
  be”	
Copyright Trustwave 2011 
Evolution of Malware – Network Sniffers 
Year	
Notables	
2009	
•  Obvious	
  ﬁlenames	
•  Output	
  was	
  plain	
  text	
  (.cap	
  extension)	
•  AYacker’s	
  FTP	
  creden=als	
  in	
  executable	
2010	
•  Filenames	
  matched	
  Windows	
  system	
  ﬁles	
•  Output	
  compress	
  and	
  password	
  protected	
•  Nightly	
  auto-­‐exﬁltra=on	
  func=onality	
  appeared	
2011	
•  No	
  output	
  on	
  disk	
•  Malware	
  u=lizes	
  buﬀers	
  (one	
  to	
  sniﬀ,	
  one	
  to	
export)	
•  Real-­‐=me	
  data	
  exﬁltra=on	
•  Encryp=on/Encoding	
  of	
  output	
  data	
Copyright Trustwave 2011 
Evolution of Malware – Memory Dumper 
Year	
Notables	
2009	
•  Malware	
  kit	
  required	
  3	
  executable	
  ﬁles	
•  No	
  an=-­‐forensics	
  capabili=es	
•  Plain	
  text	
  output	
  in	
  “system”	
  folders	
2010	
•  Single	
  executable	
•  Kernel	
  rootkit	
•  Plain	
  text	
  output	
  in	
  “system	
  folders”	
2011	
•  Return	
  of	
  3	
  executable	
  ﬁles,	
  but	
  output	
  ﬁle:	
•  Time	
  stomped	
  aeer	
  each	
  update	
•  Encrypted	
Copyright Trustwave 2011 
Evolution of Malware – Advanced Techniques 
Malware	
  Landscape	
  Today	
•  An0-­‐forensic	
  features	
  are	
  built	
  into	
  malware.	
•  Stolen	
  data	
  is	
  stored	
  encrypted	
  and	
  encryp=on	
algorithms	
  are	
  gefng	
  advanced.	
•  Automated	
  Exﬁltra0on	
  features	
  are	
  built	
  in	
  so	
aYackers	
  don’t	
  have	
  to	
  keep	
  coming	
  back	
  to	
  get	
  the	
data.	
•  Data	
  commonly	
  being	
  exported	
  on	
  port	
  80	
  which	
  is	
usually	
  allowed	
  for	
  outbound	
  access	
  in	
  most	
organiza=ons.	
•  Time	
  stomping	
  is	
  common.	
•  Malware	
  is	
  a	
  DLL	
  -­‐	
  injected	
  into	
  cri=cal	
  processes	
Copyright Trustwave 2011 
Sample SL2010-161 – Kameo 
Vitals	
Code	
  Name:	
   Best	
  Suppor0ng	
  Actor	
Filename:	
   Kameo.exe	
File	
  Type:	
   PE	
  32-­‐bit	
Target	
  Plahorm:	
   Windows	
Key	
Features	
•  	
  Malware	
  has	
  minimal	
  ﬁle	
  and	
  registry	
  ac=vity.	
•  	
  Malware	
  sniﬀs	
  magne=c	
  stripe	
  data	
  of	
  credit	
  cards	
and	
  puts	
  it	
  in	
  a	
  buﬀer	
  XYZ.	
•  	
  In	
  a	
  separate	
  thread,	
  malware	
  sends	
  the	
  data	
  in	
buﬀer	
  XYZ	
  to	
  hacker	
  server	
  via	
  port	
  80.	
•  	
  Exported	
  data	
  is	
  encoded	
  to	
  defeat	
  monitoring	
  tools	
•  	
  There	
  is	
  no	
  storage	
  of	
  intercepted	
  data	
  on	
  disk	
  at	
any=me.	
Vic0m	
Your	
  Grocery	
  Store	
Copyright Trustwave 2011 
Sample SL2010-161 – Kameo 
Demo Demo Demo! 
Copyright Trustwave 2011 
Sample SL2011-014 – Memory Dumper 
Vitals	
Code	
  Name:	
   Son	
  of	
  Brain	
  Drain	
Filename:	
   Winboot.exe	
File	
  Type:	
   PE	
  32-­‐bit	
Target	
  Plahorm:	
   Windows	
Key	
Features	
•  	
  Malware	
  is	
  installed	
  as	
  Windows	
  service.	
•  	
  Winboot.exe	
  invokes	
  two	
  other	
  processes:	
  One	
dumps	
  memory	
  of	
  processes,	
  other	
  parses	
  data.	
•  	
  Malware	
  executables	
  are	
  =me	
  stomped	
  to	
  OS	
  Install	
=me.	
•  Output	
  ﬁle	
  is	
  =me	
  stomped	
  despite	
  regular	
  read/
writes.	
•  	
  Output	
  ﬁle	
  is	
  encrypted.	
Vic=m	
Your	
  Favorite	
  Bar	
Copyright Trustwave 2011 
Sample SL2011-014 – Memory Dumper 
Demo Please! 
Copyright Trustwave 2011 
Sample SL2011-026 – Webcheck.dll 
Vitals	
Code	
  Name:	
   Napoleon's	
  Victory	
Filename:	
   Webcheck.dll	
File	
  Type:	
   Win32	
  DLL	
Target	
  Plahorm:	
   Windows	
Key	
Features	
•  	
  10KB	
  DLL	
  gets	
  injected	
  into	
  explorer.exe	
•  	
  Malware	
  is	
  packed	
  so	
  strings	
  can’t	
  be	
  read.	
•  	
  Monitors	
  a	
  speciﬁc	
  process	
  and	
  records	
  data	
processed	
  by	
  it	
  in	
  a	
  hidden	
  and	
  encrypted	
  ﬁle.	
•  	
  At	
  2am,	
  data	
  is	
  FTP’ed	
  to	
  aYacker’s	
  server.	
•  	
  Outgoing	
  ﬁle	
  is	
  encrypted	
  has	
  extension	
  of	
  zip	
  ﬁle	
but	
  is	
  not	
  actually	
  a	
  zip	
  ﬁle.	
Vic0m	
Your	
  Work	
Copyright Trustwave 2011 
Sample SL2011-026 – Webcheck.dll 
This Sh*t is Live 
(Demo) 
Copyright Trustwave 2011 
Sample SL2011-039 – Android Malware 
Vitals	
Code	
  Name:	
   ZiTFO	
  (aka	
  Zitmo)	
Filename:	
   zitmo.apk	
File	
  Type:	
   Android	
  Package	
Target	
  Plahorm:	
   Android	
Key	
Features	
•  Registers	
  an	
  intent	
  ﬁlter	
  looking	
  for	
  SMS_RECEIVED	
  events	
•  Sets	
  this	
  ﬁlter	
  with	
  a	
  priority	
  of	
  1000	
  (highest)	
•  Prevents	
  everything	
  else	
  from	
  seeing	
  SMS	
  messages	
•  Send	
  the	
  content	
  of	
  the	
  message	
  to	
  the	
  aYacker’s	
  website	
•  It	
  does	
  NOT	
  do	
  any	
  form	
  of	
  content	
  analysis	
•  AYackers	
  are	
  likely	
  collec=ng	
  a	
  lot	
  junk	
  texts	
•  It	
  ironically	
  appears	
  on	
  the	
  phone	
  as	
  a	
  package	
  by	
  Trusteer	
called	
  “Rapport”	
  which	
  is	
  used	
  by	
  banks	
  to	
  speciﬁcally	
prevent	
  this	
  type	
  of	
  SMS	
  intercep=on	
  aYack	
Vic0m	
You	
Copyright Trustwave 2011 
Sample SL2011-039 – Android Malware 
Oh No3s! 
(Android Demo) 
Copyright Trustwave 2011 
Conclusions 
Windows Malware is All Grown Up 
• 
We have seen the same type of malware advance 
over the last three years.  
Mobile Malware is Just Taking it First Steps 
• 
This is a new, but interesting area where we will 
likely see the most growth. 
• 
Attacks are PLENTY of targets   
Where will be next year?  
• 
Predictions:  
−  iOS/Android Malware w/ Advanced Features 
−  Mobile DDoS and Spam Bots 
−  Malware Focused on Stealing Corporate Credentials  
Copyright Trustwave 2011 
Special Thanks 
Eric Monti 
Ryan Merritt 
Sean Schulte 
Zack Fasel 
Zero Cool 
Contact Us: 
Nicholas J. Percoco / PI:EMAIL / @c7five 
Jibran Ilyas / PI:EMAIL / @jibranilyas