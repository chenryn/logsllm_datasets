exit command 125, 187, 235, 239
exploit command 120, 123, 125, 181
exploit development 120
exploit module 123
exploit/linux/local/service_persistence 
module 156
exploitable, defined 120
export command 94
extensible storage engine database (ESEDB) 184
F
-f4 option 242
fgdump tool 115
file pentestkey command 172
filesystem
credential harvesting 147–149
removing leftover files from 196–199
removing ntds.dit copies 199
INDEX
276
filesystem (continud)
removing SSH key pairs 198
removing Windows registry hive copies
197–198
find command, locating SUID binaries with
167–169
findstr command, locating files with 148–149
fingerprinting 47
flags 29
flavors of Linux 14
focused penetration phase 9–10, 86–88
accessing remote management services 87–88
attacking unpatched services 132
attacking vulnerable database services 117
attacking vulnerable web services 101
deploying backdoor web shells 87
exploiting missing software patches 88
footprinting 22
functions, defined 231
fuzzing 120
G
gem command 234
gem install nokogiri library 234
gems libraries 234
get command 187
get sam command 114
get sys command 114
getting a shell 94
Gohan hostname 249
Gohan.capsulecorp.local 251
Gohanadm account 251
Goku hostname 249
Goku.capsulecorp.local 250–251
Gokuadm account 251
grep command 27–28, 30, 49–51, 57, 68, 164, 228, 
242–243
grey-box scoping 22
Groovy script console execution 100–101
H
-h flag 76
-H option 152
smbpass 151
hashdump command 150
Hello World example 230–233
code block iterations 232–233
command-line arguments 231–232
in two lines of code 230–231
methods 231
hello.rb file 230
help command 30, 126
help mimikatz command 141
high severity 215, 261
hives 110
host discovery 37
Capsulecorp Pentest project
overview 22–24
setting up environment 24
engagement scope 21–24
black-box scoping 22
grey-box scoping 22
white-box scoping 22
ICMP 24–29
with DNS brute-forcing 35
with Nmap 29–34
increasing scan performance 33–34
primary output formats 30–31
RMI ports 32–33
with packet capture and analysis 35–36
with subnet hunting 36–37
hosts 51
HTTP (Hypertext Transfer Protocol) 41
http protocol 261
I
-i 30 command argument 139
-i flag 159
ICMP (Internet Control Message Protocol), ping 
command
limitations of using 28–29
overview 25–26
using bash 26–28
id -a command 171
ifconfig command 26, 94
imikatz_command option 142
impact statement 212
Incognito, impersonating logged-in users 
with 182–183
info command 238
information gathering phase 8–9
host discovery 37
service discovery 58
vulnerability discovery 81
informational severity 215
INPT (internal network penetration test) 4, 12, 
22, 44, 59–60, 85, 102, 120, 175, 193, 221
See also penetration testing
ipconfig /all command 92–94, 100
J
Jakarta Server Pages (JSP) 89, 238
jar command 91
Java Development Kit (JDK) 90
INDEX
277
jboss_invoke_deploy module 238
JDK (Java Development Kit) 90
Jenkins servers, compromising 99–101
default credentials found on Jenkins 258
Groovy script console execution 100–101
jobs -k command 195
John the Ripper
cracking cached credentials in Windows
144–146
using dictionary file with 146–147
JSP (Jakarta Server Pages) 89, 238
-just-dc-ntlm parameter 188
K
kerberos-sec protocol 262
kpasswd5 protocol 262
Krillin account 251
Krillin hostname 249
Krillin.capsulecorp.local 252
L
-l argument 243
-L c:\\ command argument 138
lab environment 12–13
Capsulecorp Pentest project 13
setting up 24
ldap protocol 262
level-one hosts 10, 85, 102
level-two hosts 10, 129, 137, 149
LHF (low-hanging-fruit) 7, 61, 256
lhost variable 124
libpcre3-dev command 226
libpcre4-dev command 226
Linux 240–246
CLI commands 240–244
cat 240–241
cut 241–242
grep 242–243
sort 243–244
wc 243–244
creating servers 252–253
post-exploitation 174
escalating privileges with SUID binaries
166–171
harvesting credentials 163–166
maintaining reliable re-entry with cron 
jobs 156–163
passing SSH keys 171–174
tmux commands 244–246
saving session 246
using 245
virtual penetration testing platform 13–14
list_tokens -u command 182
live host 22
live ping 24
living-off-the-land approach 156
load incognito command 182
load mimikatz command 141
Local Security Authority Subsystem Service 
(LSASS) 141
localhost variable 124
long-term support (LTS) 222
low severity 215, 261
low-hanging-fruit (LHF) 7, 61, 256
ls -l ~/.ssh 172
ls -l command 167, 169
ls -la command 164
ls -lah /root/.ssh command 198
ls -lah /tmp command 198
ls -lah command 94, 205
ls command 234
LSASS (Local Security Authority Subsystem 
Service) 141
lsass.exe process 141
LTS (long-term support) 222
M
make -s clean && make -sj 144
make command 227
malicious service requests 41
man nmap 228
master..xp_cmdshell stored procedure 108–109
mc-nmf protocol 262
medium severity 215, 261
Metasploit 233–239
compromising Eternal Blue vulnerability
121–124
using ms17_010_psexec exploit module 124
verifying that patch is missing 122–123
enumerating MSSQL servers with 105
msfconsole 237–239
OS dependencies 233
Ruby gems 234–235
scanning multiple targets with 172–174
setting up PostgreSQL 235–236
smb_login module 150–151
metasploit-framework command 234
Meterpreter
credential harvesting in Windows 143–144
installing autorun backdoor executable 139
maintaining reliable re-entry in Windows
138–139
payload 125–130
uninstalling persistent callbacks 204–205
useful commands 127–130
Meterpreter session 126
INDEX
278
methods, defined 231
microsoft-ds protocol 262
Mimikatz
credential harvesting in Windows 141–143
harvesting clear-text credentials 183–184
using extension 141–143
--min-hostgroup 37
--min-rate setting 34, 37
mkdir ~/.msf4 command 236
mkdir webshell command 90
modes 230
more command 228
moving laterally (pivoting)
in Windows with Pass-Hash 149–154
CrackMapExec 152–154
Metasploit smb_login module 150–151
overview 137–138
ms-olap4 protocol 263
ms-sql-s protocol 262
ms-wbt-server protocol 262–265
ms17_010_eternalblue module 130
ms17_010_psexec exploit module 124
MS17-010 (Eternal Blue) vulnerability
compromising with Metasploit 121–124
using ms17_010_psexec exploit module 124
verifying that patch is missing 122–123
documenting missing security update 
MS17-010 259–260
scanning for 64–65
mscache 143
mscache2 143
msexchange-logcopier protocol 266
./msfconsole 236
msfconsole 237–239
msmq protocol 265
msrpc protocol 262
MSSQL (Microsoft SQL) Servers, 
compromising 103–109
brute-force password guessing 69–72
disabling stored procedures 200
enumerating with Metasploit 105
stored procedures 104–105
xp_cmdshell
enabling 106–108
running OS commands with 108–109
mssql_enum module 105
mssql_exec Metasploit module 106
mssql_login module 103, 105
mssql-cli command 113
mssql-cli shell 102, 112, 114
MySQL databases, brute-force password 
guessing 69–72
mysql protocol 263
N
-N flag 161
#N ports 45
Nail hostname 249
name variable 231
Nappa hostname 249
Nappa.capsulecorp.local 252
National Vulnerability Database (NVD) 60
ncacn_http protocol 262, 265
net command, querying Active Directory 
groups 178–179
net localgroup administrators command 109
net share command 201
net share pentest /delete command 115
net-tools 223
netbios-ssn protocol 262–263
netstat -ant |grep -i listen command 163
netstat command 161
network mapper (nmap) 221
network penetration testing. See penetration 
testing
network services
banners 42–43
communication 40–41
identifying listening network services 42
New Technology LAN Manager (NTLM) hash 116
Nmap 224–228
compiling and installing from source 227
documentation 228
host discovery with 29–34
increasing scan performance 33–34
primary output formats 30–31
RMI ports 32–33
Nmap Scripting Engine 224–226
OS dependencies 226
port scanning with 43–52
commonly used ports 44–47
scanning all TCP ports 47–48
sorting through NSE script output 49–52
Nmap -h command 228
Nmap -V command 227
Nmap (network mapper) 221
Nmap Scripting Engine (NSE) 49–52, 224–226
non-interactive shell 94
NSE (Nmap Scripting Engine) 49–52, 224–226
-ntds parameter 188
ntds.dit 184–189
bypassing restrictions with VSC 185–188
extracting all hashes with secretsdump.py
188–189
removing copies 199
NTLM (New Technology LAN Manager) hash 116
number variable 232
NVD (National Vulnerability Database) 60
INDEX
279