5.8 第五步——构建响应 .............................................................................................................131
5.8.1 响应实体 ....................................................................................................................131
5.8.2 MIME类型.................................................................................................................132
5.8.3 重定向 ........................................................................................................................133
5.9 第六步——发送响应 .............................................................................................................134
5.10 第七步——记录日志 ...........................................................................................................134
5.11 更多信息 ...............................................................................................................................134
第6章 代理 .....................................................................................................................................135
6.1 Web的中间实体 .....................................................................................................................136
6.1.1 私有和共享代理 ........................................................................................................136
6.1.2 代理与网关的对比 ....................................................................................................137
6.2 为什么使用代理 .....................................................................................................................138
6.3 代理会去往何处 .....................................................................................................................143
6.3.1 代理服务器的部署 ....................................................................................................144
6.3.2 代理的层次结构 ........................................................................................................144
6.3.3 代理是如何获取流量的 ............................................................................................147
6.4 客户端的代理设置 .................................................................................................................148
6.4.1 客户端的代理配置：手工配置 ................................................................................149
6.4.2 客户端代理配置：PAC文件 ....................................................................................149
6.4.3 客户端代理配置：WPAD .........................................................................................150
6.5 与代理请求有关的一些棘手问题 .........................................................................................151
6.5.1 代理URI与服务器URI的不同 ...............................................................................151
6.5.2 与虚拟主机一样的问题 ............................................................................................152
6.5.3 拦截代理会收到部分URI.........................................................................................153
6.5.4 代理既可以处理代理请求，也可以处理服务器请求 ............................................154
6.5.5 转发过程中对URI的修改........................................................................................154
6.5.6 URI的客户端自动扩展和主机名解析.....................................................................155
6.5.7 没有代理时URI的解析............................................................................................155
6.5.8 有显式代理时URI的解析........................................................................................156
6.5.9 有拦截代理时URI的解析........................................................................................157
6.6 追踪报文 .................................................................................................................................158
6.6.1 Via首部.....................................................................................................................158
6.6.2 TRACE方法 ..............................................................................................................162
6.7 代理认证 .................................................................................................................................164
目录 ｜ 5
6.8 代理的互操作性 .....................................................................................................................165
6.8.1 处理代理不支持的首部和方法 ................................................................................166
6.8.2 OPTIONS：发现对可选特性的支持........................................................................166
6.8.3 Allow首部 ................................................................................................................167
6.9 更多信息 .................................................................................................................................167
第7章 缓存 .....................................................................................................................................169
7.1 冗余的数据传输 .....................................................................................................................170
7.2 带宽瓶颈 .................................................................................................................................170
7.3 瞬间拥塞 .................................................................................................................................171
7.4 距离时延 .................................................................................................................................172
7.5 命中和未命中的 .....................................................................................................................173
7.5.1 再验证 ........................................................................................................................173
7.5.2 命中率 ........................................................................................................................175
7.5.3 字节命中率 ................................................................................................................176
7.5.4 区分命中和未命中的情况 ........................................................................................176
7.6 缓存的拓扑结构 .....................................................................................................................177
7.6.1 私有缓存 ....................................................................................................................177
7.6.2 公有代理缓存 ............................................................................................................177
7.6.3 代理缓存的层次结构 ................................................................................................179
7.6.4 网状缓存、内容路由以及对等缓存 ........................................................................180
7.7 缓存的处理步骤 .....................................................................................................................181
7.7.1 第一步——接收 .........................................................................................................181
7.7.2 第二步——解析 .........................................................................................................182
7.7.3 第三步——查找 .........................................................................................................182
7.7.4 第四步——新鲜度检测 .............................................................................................182
7.7.5 第五步——创建响应 .................................................................................................182
7.7.6 第六步——发送 .........................................................................................................183
7.7.7 第七步——日志 .........................................................................................................183
7.7.8 缓存处理流程图 ........................................................................................................183
7.8 保持副本的新鲜 .....................................................................................................................183
7.8.1 文档过期 ....................................................................................................................184
7.8.2 过期日期和使用期 ....................................................................................................185
7.8.3 服务器再验证 ............................................................................................................185
7.8.4 用条件方法进行再验证 ............................................................................................186
7.8.5 If-Modified-Since:Date再验证 .....................................................................187
7.8.6 If-None-Match：实体标签再验证 ......................................................................189
7.8.7 强弱验证器 ................................................................................................................190
7.8.8 什么时候应该使用实体标签和最近修改日期 ........................................................190
7.9 控制缓存的能力 .....................................................................................................................191
7.9.1 no-Store与no-Cache响应首部 .........................................................................191
6 ｜ 目录
7.9.2 max-age响应首部 ...................................................................................................192
7.9.3 Expires响应首部 ...................................................................................................192
7.9.4 must-revalidate响应首部 .................................................................................192
7.9.5 试探性过期 ................................................................................................................193
7.9.6 客户端的新鲜度限制 ................................................................................................194
7.9.7 注意事项 ....................................................................................................................194
7.10 设置缓存控制 .......................................................................................................................195
7.10.1 控制Apache的HTTP首部 ..................................................................................195
7.10.2 通过HTTP-EQUIV控制HTML缓存 ..................................................................196
7.11 详细算法 ...............................................................................................................................197
7.11.1 使用期和新鲜生存期 .............................................................................................198
7.11.2 使用期的计算 .........................................................................................................198
7.11.3 完整的使用期计算算法 .........................................................................................201
7.11.4 新鲜生存期计算 .....................................................................................................202
7.11.5 完整的服务器——新鲜度算法 .............................................................................202
7.12 缓存和广告 ...........................................................................................................................204
7.12.1 发布广告者的两难处境.........................................................................................204
7.12.2 发布者的响应.........................................................................................................204
7.12.3 日志迁移.................................................................................................................205
7.12.4 命中计数和使用限制.............................................................................................205
7.13 更多信息 ...............................................................................................................................205
第8章 集成点：网关、隧道及中继 ........................................................................................207
8.1 网关 .........................................................................................................................................208
8.2 协议网关 .................................................................................................................................210
8.2.1 HTTP/*：服务器端Web网关 ..................................................................................211
8.2.2 HTTP/HTTPS：服务器端安全网关 .........................................................................212
8.2.3 HTTPS/HTTP客户端安全加速器网关 ....................................................................212
8.3 资源网关 .................................................................................................................................213
8.3.1 CGI..............................................................................................................................215
8.3.2 服务器扩展API .........................................................................................................215
8.4 应用程序接口和Web服务 ....................................................................................................216
8.5 隧道 .........................................................................................................................................217
8.5.1 用CONNECT建立HTTP隧道................................................................................217
8.5.2 数据隧道、定时及连接管理 ....................................................................................219
8.5.3 SSL隧道.....................................................................................................................219
8.5.4 SSL隧道与HTTP/HTTPS网关的对比 ...................................................................220
8.5.5 隧道认证 ....................................................................................................................221
8.5.6 隧道的安全性考虑 ....................................................................................................221
8.6 中继 .........................................................................................................................................222
8.7 更多信息 .................................................................................................................................224
目录 ｜ 7
第9章 Web机器人 ......................................................................................................................225
9.1 爬虫及爬行方式 .....................................................................................................................226
9.1.1 从哪儿开始：根集 ....................................................................................................226
9.1.2 链接的提取以及相对链接的标准化 ........................................................................227
9.1.3 避免环路的出现 ........................................................................................................228
9.1.4 循环与复制 ................................................................................................................228
9.1.5 面包屑留下的痕迹 ....................................................................................................229
9.1.6 别名与机器人环路 ....................................................................................................230
9.1.7 规范化URL ...............................................................................................................230
9.1.8 文件系统连接环路 ....................................................................................................231
9.1.9 动态虚拟Web空间 ...................................................................................................232
9.1.10 避免循环和重复 ......................................................................................................233
9.2 机器人的HTTP ......................................................................................................................236
9.2.1 识别请求首部 ............................................................................................................236
9.2.2 虚拟主机 ....................................................................................................................236
9.2.3 条件请求 ....................................................................................................................237
9.2.4 对响应的处理 ............................................................................................................238
9.2.5 User-Agent导向 ....................................................................................................239
9.3 行为不当的机器人 .................................................................................................................239
9.4 拒绝机器人访问 .....................................................................................................................240
9.4.1 拒绝机器人访问标准 ................................................................................................241
9.4.2 Web站点和robots.txt文件 .......................................................................................242
9.4.3 robots.txt文件的格式 ................................................................................................243
9.4.4 其他有关robots.txt的知识 .......................................................................................246
9.4.5 缓存和robots.txt的过期 ...........................................................................................246
9.4.6 拒绝机器人访问的Perl代码 ....................................................................................246
9.4.7 HTML的robot-control元标签 ........................................................................249
9.5 机器人的规范 .........................................................................................................................251
9.6 搜索引擎 .................................................................................................................................254
9.6.1 大格局 ........................................................................................................................255
9.6.2 现代搜索引擎结构 ....................................................................................................255
9.6.3 全文索引 ....................................................................................................................255
9.6.4 发布查询请求 ............................................................................................................257
9.6.5 对结果进行排序，并提供查询结果 ........................................................................258
9.6.6 欺诈 ............................................................................................................................258
9.7 更多信息 .................................................................................................................................258
第10章 HTTP-NG .......................................................................................................................261
10.1 HTTP发展中存在的问题 ....................................................................................................262
10.2 HTTP-NG的活动 .................................................................................................................263
8 ｜ 目录
10.3 模块化及功能增强 .....................................................................................................263
10.4 分布式对象 ...........................................................................................................................264
10.5 第一层——报文传输 ...........................................................................................................264
10.6 第二层——远程调用 ...........................................................................................................265
10.7 第三层——Web应用 ...........................................................................................................265
10.8 WebMUX ..............................................................................................................................265
10.9 二进制连接协议 ...................................................................................................................266
10.10 当前的状态 .........................................................................................................................267
10.11 更多信息 .............................................................................................................................267
第三部分 识别、认证与安全
第11章 客户端识别与cookie机制 ........................................................................................271
11.1 个性化接触 ...........................................................................................................................272
11.2 HTTP首部 ............................................................................................................................273
11.3 客户端IP地址 .....................................................................................................................274
11.4 用户登录 ...............................................................................................................................275
11.5 胖URL ..................................................................................................................................277
11.6 cookie ....................................................................................................................................278
11.6.1 cookie的类型 .........................................................................................................278
11.6.2 cookie是如何工作的 .............................................................................................279
11.6.3 cookie罐：客户端的状态 .....................................................................................280
11.6.4 不同站点使用不同的cookie .................................................................................282
11.6.5 cookie成分 .............................................................................................................283
11.6.6 cookies版本0（Netscape） ....................................................................................284
11.6.7 cookies版本1（RFC 2965） ..................................................................................285
11.6.8 cookie与会话跟踪 .................................................................................................288
11.6.9 cookie与缓存 .........................................................................................................290
11.6.10 cookie、安全性和隐私 ........................................................................................291
11.7 更多信息 ...............................................................................................................................292
第12章 基本认证机制 ................................................................................................................293
12.1 认证 .......................................................................................................................................294
12.1.1 HTTP的质询/响应认证框架 ...............................................................................294
12.1.2 认证协议与首部 .....................................................................................................295
12.1.3 安全域 .....................................................................................................................296
12.2 基本认证 ...............................................................................................................................297
12.2.1 基本认证实例 .........................................................................................................298
12.2.2 Base-64 用户名/密码编码 ....................................................................................298
12.2.3 代理认证 .................................................................................................................299
目录 ｜ 9
12.3 基本认证的安全缺陷 ...........................................................................................................300
12.4 更多信息 ...............................................................................................................................301
第13章 摘要认证 .........................................................................................................................303
13.1 摘要认证的改进 ...................................................................................................................304
13.1.1 用摘要保护密码 .....................................................................................................304
13.1.2 单向摘要 .................................................................................................................306
13.1.3 用随机数防止重放攻击 .........................................................................................307
13.1.4 摘要认证的握手机制 .............................................................................................307
13.2 摘要的计算 ...........................................................................................................................308
13.2.1 摘要算法的输入数据 .............................................................................................308
13.2.2 算法H(d)和KD(s,d) ............................................................................................310