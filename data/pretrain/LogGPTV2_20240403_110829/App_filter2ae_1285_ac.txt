根据设计，比特币支付网络使用点对点（P2P）分布式网络架构，该架构允许比特币钱包客户端访问比特币网络而无需任何中间代理或服务器。这种方法不仅保护了比特币钱包用户的匿名性（例如，不需要服务器端用户注册，而且没有检查点监视所有比特币用户的活动），而且还防止了比特币钱包服务受到其中一些节点的损害。比特币网络。攻击者需要控制大多数比特币矿工和整个节点；否则，攻击者将无法篡改比特币支付交易。为了保持比特币的去中心化，比特币官方网站
 还发布了比特币节点的参考实现，Bitcoin Core支持所有比特币功能（例如，钱包，网络路由，矿工 ）。
但是，Bitcoin.org仅针对PC用户（Windows，Mac OS和Linux）而非手机用户开发并发布了BitCoin
Core，这意味着市场上所有比特币钱包App均由其他方开发。更糟糕的是，比特币未规定任何检查机制来检查和强制执行比特币钱包App的合规性。因此，这引发了两个问题：这些比特币钱包App是否仍将比特币去中心化？如果不是，用户是否知道违规？分别对10种流行的比特币钱包App及其用户进行了安全性研究和用户研究。结果表明上述两个问题的答案都是“否”。
有三个发现，首先某些钱包应用程序未提供理想的比特币去中心化功能。这些钱包应用程序不允许用户直接访问比特币网络。所有比特币交易必须通过安全通道（例如TLS）传输到应用程序开发人员部署的中间服务器。将这些应用程序称为违反比特币去中心化的非P2P钱包应用程序。其次发现，一些非P2P钱包应用程序的用户不能完全控制他们的比特币钱包私钥。因此，用户在其比特币地址中存放的比特币可以在未经用户事先同意的情况下由其他方转移到其他比特币地址。最后但并非最不重要的一点是，大多数钱包应用程序用户都不知道存在违反比特币去中心化的行为，这些用户可能遭受各种比特币钱包欺诈攻击。
**验证：** 进行了一个实验来验证此漏洞，首先，在Samsung Galaxy S6 Edge上安装了经过测试的比特币钱包应用程序，通过家用Wi-Fi路由器将其与互联网连接，并禁用了S6上的所有后台数据服务。其次，使用数据包抓取工具tcpdump来抓取由家庭Wi-Fi路由器发送并发往S6的所有数据包。第三，启动了经过测试的比特币钱包应用程序。
上图a和b分别说明了从Bitcoin
Wallet和Coinbase钱包应用程序中获得的数据包。发现比特币钱包发送和接收了几条比特币消息，而没有观察到从Coinbase发送/接收到任何比特币消息，而是从许多TLSv1.2数据包中发送/接收了比特币消息。特别是，Coinbase需要与IP地址为54.xxx.xxx.99的中间服务器建立TLSv1.2连接。结果表明，Coinbase，Luno，Blockchain
Wallet，Bitcoin.com
Wallet，Mycelium，Coinomi和BitPay不允许其用户直接访问没有中间服务（非P2P钱包）的比特币网络，而Bitcoin
Wallet，BRD和Simple比特币钱包可以做到（P2P钱包）。
**用户研究：**
本文进行了一个小规模的用户研究（50个参与者），以研究比特币智能手机钱包用户是否注意到当前市场上有两种类型的比特币智能手机钱包（即P2P比特币钱包和非P2P比特币钱包），后者违反了比特币的去中心化。在这项研究中采访了五十名参与者，结果表明只有一位参与者知道他必须通过他的比特币钱包应用程序开发人员部署的中间服务器访问比特币支付网络，而其他参与者则不知道。进一步研究了这种现象的根本原因，有两个主要原因。首先，大约三分之一的参与者表示，他们仅根据该应用程序的下载和评论下载了一个比特币钱包应用程序，因此他们没有注意到存在两种不同类型的比特币钱包应用程序。其次，大约三分之二的参与者表示，他们确实使用了不止一个比特币钱包应用程序。但是，这些钱包应用程序为用户提供了相似的用户界面。
上图说明了在发送和接收BTC时，Bitcoin Core（用于PC的基于P2P的客户端），Bitcoin
Wallet（用于智能手机的基于P2P的客户端）和Coinbase（用于智能手机的非基于P2P的客户端）的用户界面。因此，他们不知道有两种类型的比特币钱包应用程序。
**影响：**
进行了另一个实验来研究违反比特币去中心化的可能负面影响，旨在探讨非P2P比特币钱包应用程序用户存放的BTC是否将在未经用户事先同意的情况下转移到其他比特币地址。请注意针对的服务是比特币钱包服务，而不是比特币交换服务（例如，出售BTC）。
实验进行如下，首先将0.0001
BTC存入了经过测试的比特币钱包应用程序提供的比特币地址。其次，通过查询公共在线比特币交易数据库Blockchain.Info来监视是否有任何与比特币地址相关的新交易，监控过程持续了一周。结果表明，在未经许可的情况下，存放的BTC在大约27小时后被转移到其他比特币地址。在另一种非基于P2P的钱包应用程序Luno上也观察到了类似的结果。结果表明，并不是所有的比特币钱包App用户都能完全控制其比特币钱包私钥。
此外，表面上看违反比特币去中心化不一定是一个漏洞，因为非P2P钱包应用程序可能是良性的，而支持比特币去中心化的基于P2P的钱包应用程序可能是恶意的。但是由于以下原因，第二种想法的情况并非如此。首先，无论非P2P钱包应用程序是否良性，其代理/服务器都可能受到攻击者的侵害，因此其用户的所有比特币钱包私钥都会泄露给攻击者。相反，P2P比特币钱包应用程序的操作不依赖于任何中间代理/服务器，而是分布式的比特币网络。其次，对于恶意的基于P2P的钱包应用程序而言，绕过常规的深度数据包检测（DPI）安全机制具有挑战性，因为基于P2P的应用程序传输的所有消息都是纯文本比特币消息，而不是其他任何消息，即因此，可以轻松地进行消息调查以识别可疑活动。最后，违反比特币去中心化违规行为为非P2P钱包应用程序提供商提供了一种有效手段，可以监视用户信息（例如，位置，智能手机型号，IP地址，服务WiFi
/蜂窝网络），这威胁着比特币用户匿名。
## 0x04 Proof-of-Concept Attacks
###  A.比特币去匿名攻击
该攻击旨在使匿名比特币地址和比特币钱包App用户的交易匿名化。近年来，比特币去匿名化是一个流行的研究主题。
已证明如果SPV客户端（比特币钱包应用程序）拥有少量的比特币地址（例如小于20），则攻击者可以使用单个过滤器从拦截的filterload消息中正确猜测所有这些比特币地址的概率为80％，而过滤器使用的目标误报率为0.05％。然而，现有技术具有三个关键限制。首先，如果攻击者长时间无法连续监视受害者，则攻击者可能无法拦截受害者发送的filterload。其次，猜测受害者的所有比特币地址的准确性在很大程度上取决于受害者使用的比特币地址的数量。例如，当SPV客户拥有50个比特币地址（0.05％的目标误报）时，在考虑7.149亿比特币地址已添加到区块链时，直到09/01/2020
，攻击者正确猜出所有这些比特币地址的可能性将大大降低至6.67×10^(−212)％。第三，现有技术没有识别出比特币钱包应用用户的真实身份（例如，名字），因此对现实世界的破坏是有限的。
本研究的比特币去匿名攻击旨在解决上述问题。通过利用漏洞V1，攻击者可以迫使受害者的SPV客户端主动传输多个不同的filterload消息。每个消息都有一个过滤器，该过滤器的默认误报率为0.001％。通过对多个过滤器进行处理，攻击者可以将识别出的比特币地址的错误率降低到可接受的水平（例如，三个不同的过滤器得到10％至13％的错误率）。具体来说，在此攻击中，在考虑所有使用的比特币地址（即7.149亿）的同时，错误识别的比特币地址的数量为0.00000072。由于错误率低，因此可以将识别出的比特币地址开发为新的唯一钱包指纹。两个用户生成相同的比特币地址的可能性极小。此外，通过利用智能手机上流行的Wi-Fi呼叫服务（也称为WiFi语音，VoWiFi）的漏洞，攻击者可以发现比特币钱包应用程序用户的身份。请注意，直到2019年2月，52个国家/地区的许多蜂窝网络运营商已广泛支持Wi-Fi呼叫服务。
**攻击者假设：** 假设受害者的智能手机支持Wi-Fi呼叫服务，而攻击者可以在公共场所（例如Starbucks，Walmart,
Mcdonalds）附近的受害者附近部署Wi-Fi网络和监控摄像头。实际上，攻击者实现这一目标并不是很困难。例如，攻击者可以通过在智能手机上使用移动热点服务，同时将智能手机用作面对受害者的监视摄像头，来部署流氓AP（例如模拟Starbucks的Wi-Fi AP）。
**攻击设计：**
上图说明了此攻击的流程图。首先，正如之前假设的那样，攻击者可以拦截所有受害者包。其次，为了分析这些数据包，开发了一个由两个模块组成的比特币地址去匿名器：（1）用户身份推断模块和（2）比特币地址发现模块。接下来，将详细介绍这两个模块的设计。
**1）用户身份推断：** 利用新部署的蜂窝网络服务，Wi-Fi呼叫服务和可视技术来推断智能手机上比特币钱包所有者的用户身份。该模块通过利用独特的人类通话动作（即在接听电话时将手机移至右/左耳并在通话结束时放下电话）和视觉检测技术来推断用户身份。
该模块包含两个主要功能：第一项功能是通过分析加密的Wi-Fi呼叫IPSec数据包来推断用户智能手机的IP地址，其Wi Fi呼叫事件和事件时间戳。
攻击者可以通过分析Wi-Fi呼叫的IPSec数据包来识别Wi-Fi呼叫用户的呼叫事件（例如，拨打电话，接听电话或通话）。具体来说，通过分析Wi-Fi用户的IPSec数据包，攻击者可以准确地知道特定IP地址的所有者通过Wi-Fi呼叫服务进行通话的时间（呼叫开始的时间和呼叫结束的时间）。第二项功能是使用监控摄像头记录用户的动作，发现Wi-Fi呼叫开始和结束的时间，以及通过面部识别技术和在线反向图像搜索引擎（即查找人的姓名）来识别其用户身份通过提供照片）。通过关联第一个功能提供的Wi-Fi通话开始和结束的时间，能够推断出IP地址（例如192.168.1.75↔Alice）的用户身份。输出结果IP地址，用户身份将发送到比特币地址发现模块。