# PT632电信“老猫”分析
|
##### 译文声明
本文是翻译文章
译文仅供参考，具体内容表达以及含义原文为准。
作者：L.A.M[@Duncan](https://github.com/Duncan "@Duncan") SecTeam
## 0x00：引言
本以为电信的“老猫”（老旧光猫）是跑的OpenWrt，所以打一开始就先尝试着在各种操作系统上跑OpenWrt，然后把OpenWrt的系统架构和Luci的东西基本搞明白了，就好拿着master的“老猫”来玩一下。结果，很意外的结果，这款友华2014年之后生产的PT632光猫（在友华官网已经找不到这只猫了。。。），里面跑的压根儿不是电信现在主流的光猫软件系统。从线上和线下了解到的情况来看，现在电信当家光猫的Web应用是基于Luci定制“改发”的。然而，PT632光猫里面跑的是Tiny
Core Linux，一个非常mini的Linux发行版，适配Arm架构的版本大小不到10MB，你没看错，这货就是Linux王国里的“矮人族”或者“地精”。
其实，这样也蛮好的，正好有个机会了解一下Tiny Core
Linux这个小矮人。说人家是“小矮人”其实也不太恰当，毕竟在Distrowatch的年度排名还是72位哦。出于兴趣和该死的好奇，我下载x86
64位的TinyCore Linux，21MB，还能跑出这样的GUI，我还是很满足的。
差点忘了，按照team的规矩，得先祭上mindmap。。。
## 0x01：PT632软硬件简介
###  1、硬件
这款猫很老的另一个证明就是他只支持2.4GHz的单频，也就是说没有5GHz的Wi-Fi。对硬件不是很熟悉，就简单粗暴的把cpuinfo扔这里吧。。。
###  2、软件
操作系统：Tiny Core Linux
从设备的CMIIT
ID查询到的信息来看，PT632是友华在2014年就提交注册了的，但是系统信息显示呢，TCLinux是2016年编译的，或许这是系统做了一次在线升级，当然也可能是这猫是在2016年生产的。
## 0x02：Tiny Core Linux
Tiny Core Linux（后统称tcLinux）是有Lauri
Kasanen等人发起的一个Linux发行版项目。tcLinux的特点是小，确切的说是极致的精致（Mini），因此官方不推荐安装运行这种典型的Linux运行方式，而是希望使用者每次都从外部存储设备中Load系统到RAM里面（就是所谓的这种Live
CD模式），再适合嵌入式设备不过了。当系统启动（Load到RAM之后）后，再加载（mount或者copy）应用程序。之所以选用这种模式的原因，官方给出的解释是：  
——快啊  
——防止不必要的文件系统修改  
——确保系统每次Boot的时候，都是一个原汁原味的、无比纯粹的系统  
因此，tcLinux的宗旨就是：方便，快速，易于更新且稳定可靠！
tcLinux有一套自己的Package管理工具，包括基于GUI的和基于CLI的，这里就不细说了。通过tcLinux提供的tce-ab工具，我们可以查询到该平台source里提供的两款httpd工具：
考虑到PT632猫的系统环境，自己测试了一下在tcLinux上搭建基于busybox-httpd的Web服务器。整个搭建工作非常简单，大概有以下几个步骤：  
1)通过简单的CLI交互查找package，选中并查看package信息，然后安装package即可。
`$tce-ab #不允许root权限运行tce-ab，赞`
2)创建所需的web根目录
其中/home/tc/是默认账户tc的家目录，web根目录wwwroot就配置到tc家目录下。由于busybox-httpd不会自动搜索index文件，因此需要自己动手写一个。Cgi-bin里面是busybox的cgi程序，hello.sh是一个测试脚本。一切很完美，支持简单的页面，也支持cgi脚本。这个特性是我很关系的，因为PT632下面也有很多的cgi脚本。
通过tce-ab查询到的busybox-httpd包里面，有服务器启动的信息，很简单就能上手。
另外，有一个很有意思的地方：通过tce-ab安装的这些程序都是存放在tmp目录下的，然后链接到/usr/local目录下。或许，这是因为tcLinux强调在RAM运行的原因，很多东西下载之后都放在tmp下面。但是，预装的dbus为什么也放在/tmp目录下呢？PT632是否也是如此呢？细想，挺有意思的。。。
## 0x03：busybox
对于很多人而言，busybox应该不是一个陌生的概念，尤其是喜欢在手机上安装Linux模拟器的童鞋。大家熟知的Kali
Nethunter，还是我们team最喜欢的Andrax，都用了busybox。但是，很多人对它却不甚了解，甚至以为这就是一个Linux的超级迷你的发行版。额，当然不是这样了，所以这里顺势来一个冬日IoT大补丸吧。
Busybox是一个常用的Linux命令“工具包”，整合了很多常用的Linux命令，而且非常适合于嵌入式环境。或许，很多人认为这个东西的存在违背常理，既然是Linux命令，那么整合在一块儿就会变小吗？难不成就跟那酒精兑水一样吗？100毫升纯净水加入100毫升酒精，其体积小于200毫升！当然，不是这个逻辑，主要是Denys
Vlasenko将这些常用命令做了简化处理，主要是剔除了各种常用命令中极少使用到的options，那么当然体积就直接呈几何量级的减小。然而，这样的精简并不会影响绝大多数的正常使用，或许这也是“二八原理”在软件维护和系统运维领域的一个典型案例吧。
上面这张图是busybox所整合的全部命令，当然还有一些其它的外部工具可以使用，比如OpenWrt中采用的符合OpenSSH
2.0规范的Dropbear服务器等等。而下面这张图呢，则是PT632中的busybox所提供的全部命令，可以说贫瘠得一毛不拔，连alias，find和grep这样几乎是生活必需品一样的Linux命令都给阉割掉了。虽然友华的工程师这种做法极其过分，但是在一定程度上确实会让hacker没了兴致。
在查找PT632系统中的系统命令和安装程序时，很意外的得到了master家光猫的电信账户和密码，本以为需要解密配置文件或者分析rom文件才能搞到的，没想到来得这么以外，一条ps