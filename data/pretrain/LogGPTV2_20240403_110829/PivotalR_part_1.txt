Package ‘PivotalR’
October22,2016
Type Package
Title AFast,Easy-to-UseToolforManipulatingTablesinDatabases
andaWrapperofMADlib
Version 0.1.18.2
Date 2016-10-21
Author PredictiveAnalyticsTeamatPivotalInc.
,withcontributionsfromDataScienceTeam
atPivotalInc.
Maintainer RahulIyer
Contact PredictiveAnalyticsTeamatPivotalInc.
Depends R(>=2.14.0),methods,Matrix
Suggests DBI,RPostgreSQL,shiny,testthat,tools,rpart,
randomForest,topicmodels
Description ProvidesanRinterfaceforthePivotalDatastack
runningon'PostgreSQL','Greenplum'or'ApacheHAWQ(incubating)'
databaseswithparallelanddistributedcomputationabilityforbigdata
processing.'PivotalR'providesanRinterfacetovariousdatabase
operationsontablesorviews.Theseoperationsarealmostthesameas
thecorrespondingnativeRoperations.ThususersofRdonotneed
tolearn'SQL'whentheyoperateonobjectsinthedatabase.Italso
providesawrapperfor'ApacheMADlib(incubating)',whichisanopen-
sourcelibraryforparallelandscalablein-databaseanalytics.
License GPL(>=2)
LazyLoad yes
LazyData yes
NeedsCompilation yes
Repository CRAN
Date/Publication 2016-10-2212:17:19
1
2 Rtopicsdocumented:
R topics documented:
PivotalR-package . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4
abalone . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 8
Aggregatefunctions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 10
AIC . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 13
Arith-methods . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 15
array.len . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 18
arraydb.to.arrayr. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19
as.db.data.frame . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 21
as.environment . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 24
as.factor-methods . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 25
by . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 26
cbind2-methods . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 28
clean.madlib.temp . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 30
coef . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 31
Compare-methods . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 32
conn.eql . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 35
conn.id . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 36
content. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 38
crossprod . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 39
db.connect . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 41
db.data.frame . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 43
db.data.frame-class . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 44
db.disconnect . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 46
db.existsObject . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 48
db.list . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 49
db.obj-class . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 50
db.objects . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 51
db.q . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 52
db.Rcrossprod-class . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 53
db.Rquery-class . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 54
db.search.path . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 57
db.table-class . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 58
db.view-class . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 59
delete . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 60
dim-methods . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 63
eql-methods . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 64
Extractdatabaseconnectioninfo . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 66
Extract-Replace-methods . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 68
Func-methods . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 70
generic.bagging . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 72
generic.cv . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 73
getTree.rf.madlib . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 76
groups . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 77
GUI . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 79
ifelse. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 80
is.db.data.frame . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 81
Rtopicsdocumented: 3
is.factor-methods . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 82
is.na-method. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 83
key. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 84
Logical-methods . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 85
madlib.arima . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 87
madlib.elnet . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 91
madlib.glm . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 96
madlib.kmeans . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 101
madlib.lda . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 103
madlib.lm . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 104
madlib.randomForest . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 107
madlib.rpart . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 110
madlib.summary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 112
madlib.svm . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 114
margins . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 118
merge-method . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 122
na.action . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 124
names-methods . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 125
null.data . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 126
perplexity.lda . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 127
plot.dt.madlib . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 128
predict . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 130
predict.arima . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 132
predict.bagging.model . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 133
predict.dt.madlib . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 135
predict.elnet.madlib . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 136
predict.lda . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 137
predict.rf.madlib . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 138
preview . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 140
print . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 142
print-methods . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 143
print.arima.madlib. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 145
print.dt.madlib. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 146
print.elnet.madlib . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 147
print.lm.madlib . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 148
print.none.obj . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 149
print.rf.madlib . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 150
print.summary.madlib . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 151
residuals . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 152
Row_actions. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 153
sample-methods . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 155
scale . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 156
sort . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 158
subset-methods . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 159
summary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 160
summary.arima.madlib . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 161
summary.elnet.madlib . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 162
summary.lm.madlib . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 163
4 PivotalR-package
text.dt.madlib . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 164
TypeCastfunctions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 165
unique-methods . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 167
vcov . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 168
Index 171
PivotalR-package AnRfont-endtoPostgreSQLandGreenplumdatabase, andwrapper
forin-databaseparallelanddistributedmachinelearningopen-source
libraryMADlib
Description
PivotalRisapackagethatenablesusersofR,themostpopularopensourcestatisticalprogramming
language and environment to interact with the Pivotal (Greenplum) Database as well as Pivotal
HD/HAWQ for Big Data analytics. It does so by providing an interface to the operations on ta-
bles/viewsinthedatabase. Theseoperationsarealmostthesameasthoseofdata.frame. Thusthe
users of R do not need to learn SQL when they operate on the objects in the database. The latest
code, along with a training video and a quick-start guide, are available at https://github.com/
pivotalsoftware/PivotalR.
Details
Package: PivotalR
Type: Package
Version: 0.1.18
Date: 2016-09-15
License: GPL(>=2)
Depends: methods,DBI,RPostgreSQL
This package enables R users to easily develop, refine and deploy R scripts that leverage the par-
allelism and scalability of the database as well as in-database analytics libraries to operate on big
datasetsthatwouldotherwisenotfitinRmemory-allthiswithouthavingtolearnSQLbecause
thepackageprovidesaninterfacethattheyarefamiliarwith.
ThepackagealsoprovidesawrapperforMADlib. MADlibisanopen-sourcelibraryforscalable
in-database analytics. It provides data-parallel implementations of mathematical, statistical and
machine-learningalgorithmsforstructuredandunstructureddata. Thenumberofmachinelearning
algorithmsthatMADlibcoversisquicklyincreasing.
As an R front-end to the PostgreSQL-like databases, this package minimizes the amount of data
transferredbetweenthedatabaseandR.Allthebigdataisstoredinthedatabase. Theuserenters
theirfamiliarRsyntax,andthepackagetranslatesitintoSQLqueriesandsendstheSQLqueryinto
databaseforparallelexecution. Thecomputationresult,whichissmall(ifitisasbigastheoriginal
data,whatisthepointofbigdataanalytics?),isreturnedtoRtotheuser.
Ontheotherhand,thispackagealsogivestheusualSQLuserstheaccessofutilizingthepowerful
PivotalR-package 5
analytics and graphics functionalities of R. Although the database itself has difficulty in plotting,
theresultcanbeanalyzedandpresentedbeautifullywithR.
ThiscurrentversionofPivotalRprovidesthecoreRinfrastructureanddataframefunctionsaswell
asover50analyticalfunctionsinRthatleveragein-databaseexecution. Theseinclude
*DataConnectivity-db.connect,db.disconnect,db.Rquery
*DataExploration-db.data.frame,subsets
*Rlanguagefeatures-dim,names,min,max,nrow,ncol,summaryetc
*ReorganizationFunctions-merge,by(group-by),samples
*Transformations-as.factor,nullreplacement
*Algorithms-linearregressionandlogisticregressionwrappersforMADlib
Note
This package is differernt from PL/R, which is another way of using R with PostgreSQL-like
databases. PL/RenablestheuserstorunRscriptsfromSQL.IntheparallelGreenplumdatabase,
onecanusePL/Rtoimplementparallelalgorithms.
However,PL/Rstillrequiresnon-trivialknowledgeofSQLtouseiteffectively. Itismostlylimited
toexplicitlyparalleljobs. Andfortheenduser,itisstillaSQLinterface.
ThispackagedoesnotrequireanyknowledgeofSQL,anditworksforbothexplicitlyandimplicitly
paralleljobsbyemployingtheopen-sourceMADliblibrary. Itismuchmorescalable. Andforthe
enduser,itisapureRinterfacewiththeconventionalRsyntax.
Author(s)
Author: PredictiveAnalyticsTeamatPivotalInc. ,with
contributionsfromDataScientistTeamatPivotalInc.
Maintainer: FrankMcQuillan,PivotalInc. 
References
[1]MADlibwebsite,http://madlib.incubator.apache.org
[2]MADlibuserdocs,http://madlib.incubator.apache.org/docs/latest/
[3]MADlibWikipage,https://cwiki.apache.org/confluence/display/MADLIB
[4]MADlibcontributionguide,https://cwiki.apache.org/confluence/display/MADLIB/Contribution+
Guidelines
[5]MADlibonGitHub,https://github.com/apache/incubator-madlib
SeeAlso
madlib.lmLinearregression
madlib.glmLinear,logisticandmultinomiallogisticregressions
madlib.summarysummaryofatableinthedatabase.
6 PivotalR-package
Examples
## Not run:
## get the help for the package
help("PivotalR-package")
## get help for a function
help(madlib.lm)
## create multiple connections to different databases
db.connect(port = 5433) # connection 1, use default values for the parameters
db.connect(dbname = "test", user = "qianh1", password = "", host =
"remote.machine.com", madlib = "madlib07", port = 5432) # connection 2
db.list() # list the info for all the connections
## list all tables/views that has "ornst" in the name
db.objects("ornst")
## list all tables/views
db.objects(conn.id = 1)
## create a table and the R object pointing to the table
## using the example data that comes with this package
delete("abalone", conn.id = cid)
x <- as.db.data.frame(abalone, "abalone")
## OR if the table already exists, you can create the wrapper directly
## x <- db.data.frame("abalone")
dim(x) # dimension of the data table
names(x) # column names of the data table
madlib.summary(x) # look at a summary for each column
lk(x, 20) # look at a sample of the data
## look at a sample sorted by id column
lookat(sort(x, decreasing = FALSE, x$id), 20)
lookat(sort(x, FALSE, NULL), 20) # look at a sample ordered randomly
## linear regression Examples --------
## fit one different model to each group of data with the same sex
fit1 <- madlib.lm(rings ~ . - id | sex, data = x)
fit1 # view the result
lookat(mean((x$rings - predict(fit1, x))^2)) # mean square error
## plot the predicted values v.s. the true values
PivotalR-package 7
ap <- x$rings # true values
ap$pred <- predict(fit1, x) # add a column which is the predicted values
## If the data set is very big, you do not want to load all the
## data points into R and plot. We can just plot a random sample.
random.sample <- lk(sort(ap, FALSE, "random"), 1000) # sort randomly
plot(random.sample) # plot a random sample
## fit a single model to all data treating sex as a categorical variable ---------
y <- x # make a copy, y is now a db.data.frame object
y$sex <- as.factor(y$sex) # y becomes a db.Rquery object now
fit2 <- madlib.lm(rings ~ . - id, data = y)
fit2 # view the result
lookat(mean((y$rings - predict(fit2, y))^2)) # mean square error
## logistic regression Examples --------
## fit one different model to each group of data with the same sex
fit3 <- madlib.glm(rings < 10 ~ . - id | sex, data = x, family = "binomial")
fit3 # view the result
## the percentage of correct prediction
lookat(mean((x$rings < 10) == predict(fit3, x)))
## fit a single model to all data treating sex as a categorical variable ----------
y <- x # make a copy, y is now a db.data.frame object
y$sex <- as.factor(y$sex) # y becomes a db.Rquery object now
fit4 <- madlib.glm(rings < 10 ~ . - id, data = y, family = "binomial")
fit4 # view the result
## the percentage of correct prediction
lookat(mean((y$rings < 10) == predict(fit4, y)))
## Group by Examples --------
## mean value of each column except the "id" column
lk(by(x[,-1], x$sex, mean))
## standard deviation of each column except the "id" column
lookat(by(x[,-1], x$sex, sd))
## Merge Examples --------
## create two objects with different rows and columns
key(x) <- "id"
y <- x[1:300, 1:6]
z <- x[201:400, c(1,2,4,5)]
8 abalone
## get 100 rows
m <- merge(y, z, by = c("id", "sex"))
lookat(m, 20)
## operator Examples --------
y <- x$length + x$height + 2.3
z <- x$length * x$height / 3
lk(y < z, 20)
## ------------------------------------------------------------------------
## Deal with NULL values
delete("null_data")
x <- as.db.data.frame(null.data, "null_data")
## OR if the table already exists, you can create the wrapper directly
## x <- db.data.frame("null_data")
dim(x)
names(x)
## ERROR, because of NULL values
fit <- madlib.lm(sf_mrtg_pct_assets ~ ., data = x)
## remove NULL values
y <- x # make a copy
for (i in 1:10) y <- y[!is.na(y[i]),]
dim(y)
fit <- madlib.lm(sf_mrtg_pct_assets ~ ., data = y)
fit
## Or we can replace all NULL values
x[is.na(x)] <- 45
## End(Not run)
abalone Abalonedataset
Description
Anexampledata.framewhichisusedbyexamplesinthisusermanual
abalone 9
Usage
data(abalone)
Format
Givenistheattributename,attributetype,themeasurementunitandabriefdescription.Thenumber
ofringsisthevaluetopredict: eitherasacontinuousvalueorasaclassificationproblem.
Name/DataType/MeasurementUnit/Description
—————————–
Id/integer/–/indexofeachobservation
Sex/nominal/–/M,F,andI(infant)
Length/continuous/mm/Longestshellmeasurement
Diameter/continuous/mm/perpendiculartolength
Height/continuous/mm/withmeatinshell
Wholeweight/continuous/grams/wholeabalone
Shuckedweight/continuous/grams/weightofmeat
Visceraweight/continuous/grams/gutweight(afterbleeding)
Shellweight/continuous/grams/afterbeingdried