sive computer use.
Given an employee’s job title, we also categorize his or her job
type by taking the last word in the job title after stripping away
level indicators (e.g., “engineer I” and “engineer II” are both con-
sidered “engineers”). There are 12 job types that have more than
500 employees, covering 84% of all employees whose machine(s)
are instrumented with the McAfee client. Appendix D describes
each of these job types.
Figure 9 shows the number of hosts (whose corresponding user
is) of each job type, as well as the fraction of hosts with that job
type that encountered malware. It appears that job types requiring
greater technical expertise also have a greater likelihood of encoun-
tering malware. Similar results were reported by Lévesque et al. [9]
from a small study of 50 users. It is possible that technically savvy
users may be more exposed to malware by spending more time with
computers or the Internet, or they are potentially less careful about
unknown ﬁles.
Findings: The likelihood of encountering malware increases the
further the employee is from the top of the enterprise organizational
tree, and also increases with technical proﬁciency.
3.4 Web Malware
The web is reportedly the most prevalent vector for attackers and
malware authors to gain access to victim hosts [19]. In our dataset,
3.11% of the hosts likely encountered malware by visiting mali-
cious websites, i.e., the detected malicious ﬁle was found in the
browser cache (see Section 3.1). Among those hosts, 29.85% (583
hosts) generated the McAfee report while they were connected to
the corporate network. We are interested in investigating where
those malicious ﬁles came from, and in particular, why the web
proxy that ﬁlters web connections from the enterprise failed to
block them.
ExternalDriveWebTemporaryFilesApplicationUnknownDownloadJavaProgramFilesSystemFiles0.0000.0050.0100.0150.0200.0250.0300.035FractionofHostsOutsideInsideAllUSIndiaIrelandChinaUKGermanyIsraelEgyptBrazilS.Korea1110987654321Level0.000.060.120.180.240.300.360.420.480.541122Fraction of
Fraction of
Website category matching hosts matching reports
31.28%
Business
Communities
8.46%
4.36%
Search
14.87%
Travel
4.62%
Non-Categorized
2.31%
SaaS
3.59%
Sports
Food
8.46%
3.08%
Entertainment
Computers
1.03%
29.51%
11.48%
9.02%
8.19%
6.56%
6.56%
4.92%
4.92%
3.28%
3.28%
Table 2: Top website categories for matching McAfee reports in
the “Web” category.
whelming majority (95%) of the matching McAfee reports were
allowed through the web proxy, while 2.56% were blocked. This
means that although the proxy prevented the connection while the
host is inside the corporate network, the malicious ﬁle was down-
loaded when the host was brought outside the enterprise. More
interestingly, among the 2.31% matching reports whose connec-
tion required user consent, over half (55.56%) were allowed to pro-
ceed because of a previous user acknowledgment to a different site.
Given the small number of encounters we observed under this pol-
icy, more data is needed to draw conclusions on its effectiveness.
Policy
Allowed
Require user consent
Blocked
Fraction of
Fraction of
matching hosts matching reports
95.13%
2.31%
2.56%
93.44%
6.56%
0.82%
Table 3: Web ﬁltering policies applied to matching McAfee reports
in the “Web” category.
Findings: The majority of web-based encounters that we corre-
lated with the web proxy logs are from sites deemed business-
appropriate under enterprise policy. 31% of the web-based encoun-
ters (around 554 over the four-month duration of our study, ex-
trapolated from the 22% of correlatable encounters) originate from
websites in the “business” category and 15% (around 266, similarly
extrapolated over four months) originate from the “travel” category.
4.
INFERRING THE RISK OF INFECTION
We have observed in Section 3 that there are multiple factors re-
lated to the likelihood of a host encountering malware, including
demographic features of its user as well as various aspects of its
user’s behavior. In this section, we develop a statistical model to
infer the risk of a host encountering malware proactively. We eval-
uate the model accuracy and discuss applications to detection and
remediation of malware infections in early stages.
4.1 Logistic Regression Model
Motivated by results in Section 3, we extract three categories of
features to be used in the model: 1) Demographic features cap-
turing information about the user, 2) VPN activity features to infer
user behavior outside the corporate network (e.g., number of VPN
logins, duration of VPN sessions), and 3) Web activity features in-
cluding information about the user’s browsing behavior (e.g., cate-
gories of web sites visited, web trafﬁc volume). Some of the fea-
tures are numeric values (e.g., number of VPN logins), and some
are categorical (e.g., the country where the user is located). A sub-
set of the features are static (e.g., country, job type), but most vary
over time (e.g., number of domains visited or VPN logins).
We are interested in building a predictive model that estimates
the conditional probability of encountering malware given the fea-
Figure 9: Malware encounter rate by job type. The encounter rate
is the fraction of hosts (whose corresponding user has) the job type
on the horizontal axis that encountered malware.
The web proxy logs collected in the enterprise contain ﬁelds in
the HTTP request header, including the destination URL and do-
main, web referer, user-agent string, as well as auxiliary informa-
tion like the website reputation and category (provided by the web
proxy vendor), and the ﬁltering policy that was applied to that con-
nection (see Section 2.4). Since we know the name of the detected
malicious ﬁle, we can identify matching URLs in the web proxy
logs to obtain details of that connection.
This method only works for ﬁles that are stored as-is with the
same ﬁlename. For some browsers, including Chrome4 and Fire-
fox5, the cache is structured as a layered hash table for fast ac-
cess, where cached ﬁles are stored in multiple local ﬁles. The name
of the detected malicious ﬁle, as recorded in McAfee reports, is
hence an index to the actual data location, and difﬁcult to reverse-
engineer without knowledge of the cache structure and addresses
local to the host. In addition, the web proxy logs only store the
IP address of the host, while McAfee reports store only the host-
name. We further analyze DHCP logs in the enterprise to obtain an
IP-to-hostname mapping, and correlate it with the web proxy logs
to look up the host assigned that IP during that time (though clock
skew and missing or out-of-order logs sometimes cause this lookup
to fail). Even with these limitations posed by imperfect data, we
were able to match 390 McAfee reports (22% of those found in the
browser cache and from hosts inside the enterprise network at the
time of detection) with the corresponding web proxy logs.
Table 2 lists the top website categories associated with matched
McAfee reports. Surprisingly, none of these categories seem to be
intuitively suspicious or malicious. The top category, “Business,”
is a rather general one that encompasses sites related to market-
ing, commerce, business practices, human resources, transporta-
tion, payroll, and a dozen other services.6 “Search” includes search
engines and portal sites, and “Communities” are sites associated
with special interest groups, web newsgroups, and message boards.
Of particular interest is the “Non-Categorized” category, which
are new sites that have not yet been given a category label. If an
uncategorized site lacking a reputation score is contacted, the web
proxy requests that the user acknowledge the enterprise security
policies before proceeding. Once the user gives consent, it remains
valid for one hour for that host, during which the user can visit
other uncategorized sites without further prompt from the proxy.
Table 3 shows the web proxy ﬁltering policy that was applied to
connections associated with matching McAfee reports. An over-
4http://www.chromium.org/developers/
design-documents/network-stack/disk-cache
5https://code.google.com/p/
firefox-cache-forensics/wiki/FfCacheRead
6Although not the same as “malicious”, a study of Android apps
by Sounthiraraj et al. [18] also found that “business” is the top app
category with the most number of vulnerable apps.
SpecialistConsultantArchitectAdministratorEngineerAnalystRepresentativeManagerCoordinatorAssistantDirectorTechnician0500010000150002000025000NumberofHosts0.060.080.100.120.140.160.180.200.220.24EncounterRateNumberofHostsEncounterRate1123ture values at a particular moment in time. We investigated a num-
ber of statistical models based on regression (linear, logistic, Pois-
son, and proportional hazards regression) and found logistic regres-
sion to be the most suitable for constructing the predictive model.
Logistic regression is used to estimate a conditional probability
P r(Y |X) of a binary response variable Y given a set of input vari-
ables X = (X1, . . . , Xn). The model assumes that P r(Y |X) is
the logistic function and estimates unknown parameters using the
maximum likelihood method.
More precisely, let p((cid:126)x) = P r(Y = 1|X = (cid:126)x), for (cid:126)x =
(x1, . . . , xn). Logistic regression assumes that:
= α + β · (cid:126)x,
p((cid:126)x)
log
1 − p((cid:126)x)
where α is called intercept, β = (β1, . . . , βn) are regression co-
efﬁcients for the features and β · (cid:126)x denotes the scalar product of
vectors β and (cid:126)x.
We model the response variable Y as a random variable with
value 1 if the host encountered malware, and 0 otherwise. Input
variables X = (X1, . . . , Xn) denote features modeling various
aspects of user demographic information and behavior, whose se-
lection process is described in detail in Section 4.2.
To demonstrate the model’s effectiveness, we randomly split the
entire host population into two equal-size training and testing data
sets. The parameters of the logistic regression model are estimated
using the training set, which are used to compute risk scores for
hosts in the testing set. We ﬁnally demonstrate that among the hosts
with highest risk score, a large fraction (more than 50%) encoun-
tered malware. Our evaluation results are presented in Section 4.3.
4.2 Feature Selection
We employ a two-stage feature selection process to identify the
most relevant features for the model. First, we build a logistic re-
gression model separately for each category of features with the
goal of ﬁnding the “signiﬁcant” features to predict malware en-
counters. Second, we combine the statistically signiﬁcant features
selected in the ﬁrst stage to build the ﬁnal model. Here we describe
the feature selection process in more detail.
4.2.1 Details on Statistical Model
We use the glm function in R for implementing logistic regres-
sion. Based on the training data, glm outputs estimates of the inter-
cept α and regression coefﬁcients βi, as well as standard errors for
estimation. For each feature i, glm also computes the p-value for
the hypothesis test that βi is zero, implemented using the standard
Wald test. A low p-value indicates that the null hypothesis can be
rejected with high conﬁdence, implying that the feature is relevant
in the model. Signiﬁcance levels of 0.001, 0.01 and 0.05 are de-
noted by ***, **, and *; a dot (.) denotes a 0.1 signiﬁcance level;
and no star or dot means the feature is not found signiﬁcant.
For categorical (i.e., discrete) variables, R employs the follow-
ing encoding scheme. Assume that a variable V takes m possible
values v1, . . . , vm. Then R encodes this with m − 1 binary vari-
ables Z1, . . . , Zm−1. Value V = vi for i ∈ {1, . . . , m − 1} is
encoded with Zi = 1 and all other Zj binary variables set at 0, for
j (cid:54)= i. Value V = vm is encoded with all variables Zi set at 0, for
i ∈ {1, . . . , m − 1}. vm is called the reference value for V .
4.2.2 Demographic Features
The user demographic features we consider include Gender (in-
ferred user gender), Country (country of user’s ofﬁce), Level (level
in the management hierarchy) and Technical (technical level of the
user’s job type). While the employee dataset does not include user
gender, we infer this information from the employees’ ﬁrst names
using data from the U.S. census bureau.7 The gender for 65.59% of
the employees was determined this way, with the remaining users
labeled as “unknown.” Technical level is a binary variable inferred
from the job title, set to 1 for “Engineer,” “Architect,” “Specialist,”
and “Administrator,” and 0 for all other job types. There are over
70 unique countries in our employee dataset. Ordering them by the
number of employees, we focus on the top countries that cover 95%
of the employee population.
Table 4 shows the estimated coefﬁcients for each feature, the
standard error, the p-value for the hypothesis that the regression
coefﬁcient is zero, and the signiﬁcance level.8 The low p-values
for the Gender, Level, Technical variables, as well as for the ma-
jority of the binary variables encoding Country, demonstrate that
all demographic features considered are signiﬁcant. The estimated
coefﬁcient is correlated with the infection risk of that feature, con-
ﬁrming that India has the highest infection risk, while Japan has the
lowest. Six countries (Japan, Ireland, Netherlands, Germany, UK,
US) have negative coefﬁcients indicating negative correlation with
malware encounters. Another six countries have coefﬁcients close
to 0, suggesting no statistical signiﬁcance regarding infections.
Feature
Gender
Country
Levels
Technical
Value
Male
Unknown
Brazil
Canada
China
Egypt
France
Germany
India
Ireland
Israel
Italy
Japan
Korea
Mexico
Netherlands
Russia
Singapore
Spain
UAE
UK
US
Other
Est.
0.23
0.39
1.01
0.05
0.92
0.86
0.24
-0.22
1.21
-0.24
0.09