Evil	
  DoS	
  A*acks	
  and	
  Strong	
Defenses	
Sam	
  Bowne	
  and	
  Ma*hew	
  Prince	
DEF	
  CON	
  21	
August	
  2,	
  2013	
Bio	
Bio	
Evil	
  A*acks	
Sockstress	
New	
  IPv6	
  RA	
  Flood	
Sockstress	
TCP	
  Handshake	
Images	
  from	
  drawingstep.com	
  and	
  us.123rf.com	
Client	
Server	
TCP	
  Window	
  Size	
 0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          Source Port          |       Destination Port        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Sequence Number                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Acknowledgment Number                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Data |           |U|A|P|R|S|F|                               |
   | Offset| Reserved  |R|C|S|S|Y|I|            Window             |
   |       |           |G|K|H|T|N|N|                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Checksum            |         Urgent Pointer        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Options                    |    Padding    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                             data                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                            TCP Header Format
Sockstress	
  A*ack	
Images	
  from	
  drawingstep.com	
  and	
  us.123rf.com	
Client	
Server	
From	
  2008	
•  SPll	
  not	
  patched	
•  A*acks	
  TCP	
  by	
  sending	
  a	
  small	
  WINDOW	
  size	
•  Causes	
  sessions	
  to	
  hang	
  up,	
  consuming	
  RAM	
•  Can	
  render	
  servers	
  unbootable	
Sockstress	
  Demo	
MiPgaPon	
•  Short-­‐term	
– Block	
  packets	
  with	
  small	
  window	
  sizes	
  with	
  a	
ﬁrewall	
•  Long-­‐term	
– PATCH	
  OS	
  to	
  reclaim	
  RAM	
– It’s	
  been	
  5	
  years,	
  guys!	
IPv4	
  ExhausPon	
IPv4	
  ExhausPon	
One	
  Year	
  Le\	
IPv6	
  ExhausPon	
Link-­‐Local	
  DoS	
IPv6	
  Router	
  AdverPsements	
Old	
  A*ack	
  (from	
  2011)	
Image	
  from	
  forumlane.org	
IPv4:	
  DHCP	
PULL	
  process	
n Client	
  requests	
  an	
  IP	
n Router	
  provides	
  one	
Host	
Router	
I	
  need	
  an	
  IP	
Use	
  this	
  IP	
IPv6:	
  Router	
  AdverPsements	
PUSH	
  process	
n Router	
  announces	
  its	
  presence	
n Every	
  client	
  on	
  the	
  LAN	
  creates	
  an	
  address	
  and	
  joins	
the	
  network	
Host	
Router	
JOIN	
  MY	
  NETWORK	
Yes,	
  SIR	
Router	
  AdverPsement	
  Packet	
RA	
  Flood	
  (from	
  2011)	
ﬂood_router6	
Eﬀects	
  of	
  ﬂood_router6	
•  Drives	
  Windows	
  to	
  100%	
  CPU	
•  Also	
  aﬀects	
  FreeBSD	
•  No	
  eﬀect	
  on	
  Mac	
  OS	
  X	
  or	
  Ubuntu	
  Linux	
The	
  New	
  RA	
  Flood	
Image	
  from	
  guntech.com/	
MORE	
  IS	
  BETTER	
•  Each	
  RA	
  now	
  contains	
– 17	
  Route	
  InformaPon	
  secPons	
– 18	
  Preﬁx	
  InformaPon	
  secPons	
Flood	
  Does	
  Not	
  Work	
  Alone	
•  Before	
  the	
  ﬂood,	
  you	
  must	
  send	
  some	
  normal	
RA	
  packets	
•  This	
  puts	
  Windows	
  into	
  a	
  vulnerable	
  state	
– Thanks	
  to	
  var_x	
  for	
  noPcing	
  this	
  in	
  my	
  lab	
  at	
  CCSF	
How	
  to	
  Perform	
  this	
  A*ack	
•  For	
  best	
  results,	
  use	
  a	
  gigabit	
  Ethernet	
  NIC	
  on	
a*acker	
  and	
  a	
  gigabit	
  switch	
•  Use	
  thc-­‐ipv6	
  2.1	
  on	
  Linux	
•  Three	
  Terminal	
  windows:	
1.  ./fake_router6	
  eth1	
  a::/64	
2.  ./fake_router6	
  eth1	
  b::/64	
3.  ./ﬂood_router26	
  eth1	
•  Windows	
  dies	
  within	
  30	
  seconds	
Eﬀects	
  of	
  New	
  RA	
  Flood	
•  Win	
  8	
  &	
  Server	
  2012	
  die	
  (BSOD)	
•  Microso\	
  Surface	
  RT	
  dies	
  (BSOD)	
•  Mac	
  OS	
  X	
  dies	
•  Win	
  7	
  &	
  Server	
  2008	
  R2,	
  with	
  the	
  "IPv6	
Readiness	
  Update"	
  freeze	
  during	
  a*ack	
•  iPad	
  3	
  slows	
  and	
  somePmes	
  crashes	
•  Android	
  phone	
  slows	
  and	
  somePmes	
  crashes	
•  Ubuntu	
  Linux	
  suﬀers	
  no	
  harm	
Videos	
  and	
  Details	
MiPgaPon	
•  Disable	
  IPv6	
•  Turn	
  oﬀ	
  Router	
  Discovery	
  with	
  netsh	
•  Use	
  a	
  ﬁrewall	
  to	
  block	
  rogue	
  RAs	
•  Get	
  a	
  switch	
  with	
  RA	
  Guard	
•  Microso\'s	
  "IPv6	
  Readiness	
  Update"	
  provides	
some	
  protecPon	
  for	
  Win	
  7	
  &	
  Server	
  2008	
  R2	
– Released	
  Nov.	
  13,	
  2012	
– KB	
  2750841	
– But	
  NOT	
  for	
  Win	
  8	
  or	
  Server	
  2012!!	
DEMO	
More	
  Info	
•  Slides,	
  instrucPons	
  for	
  the	
  a*acks,	
  &	
  more	
  at	
•  Samsclass.info