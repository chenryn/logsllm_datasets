### DPOS共识机制的原理
DPOS机制让每一个持币者都可以进行投票，由此产生一定数量的代表
,或者理解为一定数量的节点或矿池，他们彼此之间的权利是完全相等的。持币者可以随时通过投票更换这些代表，以维系链上系统的“长久纯洁性”。  
我们可以以我国的人大代表制度来理解DPOS共识制度的涵义。当被选出来的人大代表不能再履行人民赋予他们的职责之时，他们将会被除名，而网络将会重新选出新的代表来代替他们的位置。
### DPOS共识机制的过程
**DPos在共识期间分为“见证人选举”和“见证人出块”两个过程。**  
见证人对各个交易签名与时间进行验证。在网络中每个账户都可以为下一个见证人投票，而票数要根据区块链的资产情况来分配。  
**见证人选举过程**
：只有拥有被选举权的永久节点才能够被选举，最终只有前N名见证人可以被选举出来。这N个人都要获得50%以上的票数才能够顺利当选，除此之外，这个名单会按照固定的时间间隔进行重新选举。  
**见证人出块过程**
：见证人每生产一个块，都会获得报酬，他们的薪酬水平由其获得的投票决定。如果见证人没有生产区块，他们便没有收入，并且还有可能被投票失去见证人的身份。见证人生产区块时，每2s需要产生一个区块，如果超过了规定的时间，那么当前见证人就会失去生产权利而转交给下一个人。  
网络中所有的用户均有责任监控区块链生成的过程，并且同意需要选择分叉最长的那个链进行追加。
**DPoS的优点：** 大幅缩小参与验证和记账节点的数量，可以达到秒级的共识验证。  
**DPoS的缺点：** 整个共识机制还是依赖于代币，而很多商业应用是不需要代币的。
## 拜占庭容错（PBFT）
### 什么是PBFT
PBFT是Practical Byzantine Fault Tolerance的缩写，意为实用拜占庭容错算法。该算法是Miguel Castro
(卡斯特罗)和Barbara
Liskov（利斯科夫）在1999年提出来的，解决了原始拜占庭容错算法效率不高的问题，将算法复杂度由指数级降低到多项式级，使得拜占庭容错算法在实际系统应用中变得可行。
### PBFT共识机制的原理
PBFT共识机制一共包含三个阶段：预准备（Pre-Prepare）、准备（Prepare）、确认（Commit）  
**具体步骤：**  
1.从全网节点选举出一个主节点（leader）,新区块由该主节点负责生成  
2.Pre-Prepare:每个节点把客户端发来的交易向全网广播，主节点0将从网络收集到需放在新区块内的多个交易排序后存入列表，并将该列表向全网广播，扩散至123  
3.Prepare：每个节点收到交易列表后，根据排序模拟执行这些交易。所有交易执行完后，基于交易结果计算新区块的哈希摘要，并向全网广播，1-023,2-013,3因为宕机无法广播。  
4.commit：如果一个节点收到的2f(f为可容忍的拜占庭节点数)个，其他节点发来的摘要都和自己相等，就向全网广播一条commit消息。  
5.Reply:如果一个节点收到2f+1条commit消息，即可提交新区块及其交易到本地的区块链和状态数据库。
拜占庭容错能够容纳将近1/3的错误节点误差，IBM创建的Hyperledger
0.6版本就是使用了该算法作为共识算法。同时在PBFT算法下，网络通信的复杂度达到了O(n²)，这也就意味着，PBFT网络节点不能太多，如果节点太多将会造成网络风暴，使得整个网络堵塞。  
**PBFT优点** ：共识效率高，可实现高频交易。  
**PBFT缺点** ：当系统只剩下33%的节点的时候，系统会停止运行。
## 授权拜占庭容错机制（dBFT）
### 什么是DBFT
2016年4月，小蚁公司发布共识算法白皮书，描述了一种通用共识机制——授权拜占庭容错(dBFT)，提出了一种改进的拜占庭容错算法，使其能够适用于区块链系统。该系统由节点、委托人（谁可以批准区块）和发言人（谁提议下一个区块）组成。各种场景说明了dBFT协议有足够能力来保护网络不受恶意参与者的影响。
### DBFT的改进之处
**授权拜占庭容错算法在使用拜占庭容错算法的基础上，进行了以下改进：**  
1.将C/S架构的请求响应模式改进为适合P2P网络的对等节点模式；  
2.静态的共识参与节点改进为可动态进入、退出的共识参与节点；  
3.为共识参与节点的产生设计了一套基于持有权益比例的投票机制，通过投票决定共识参与节点（记账节点）；
  1. 在区块链中引入数字证书，解决了投票中对记账节点真实身份的认证问题。  
**授权拜占庭容错机制的优点：**
专业化的记账人；可以容忍任何类型的错误；记账由多人协同完成,每一个区块都有最终性，不会分叉,算法的可靠性有严格的数字证明。  
**授权拜占庭容错机制的缺点：**  
1.当三分之一或以上的记账人停止工作后，系统将无法提供服务；  
2.当三分之一或以上的记账人联合作恶，且其他所有的记账人被恰好分割为两个网络孤岛时，恶意记账人可以使系统出现分叉，但是会留下密码学证据。  
总而言之，授权拜占庭容错机制最核心的一点，就是最大限度地确保系统的最终性，使区块链能够适用于真正的金融应用场景。
## POA
### 什么是POA
POA（proof ofactivity,活跃证明），它是一种POW与POS混合的共识算法。
### POA共识算法简介
1.每个活跃节点不断进行HASH计算，寻找HASH值小于特定值的区块头。区块头中，包括前区块HASH值，本节点的地址，区块序号和nonce值。对比比特币区块头，我们可以发现POA区块头中少了区块中交易Merple树根值，也就是说POA区块头中不包含交易信息。  
2.当节点找到满足条件的区块头后，就向全网广播这个区块头。  
3.所有活跃节点收到广播，进行验证。若验证通过，则以广播中的区块头作为数据源，导出N个随机的股权所有者。具体方法是：  
a.将此区块头的HASH值与区块头中的前区块HASH值串联，再与一个固定值串联，然后计算串联后数据的HASH值；  
b.对上述HASH值执行跟随聪算法，找出一个幸运股权人。  
c.重复步骤a,b N-1次，找到另外N-1个幸运股权人。  
4.所有活跃节点判断自己是否是幸运股权人。  
如果自己是前N-1个幸运股权人的一个，则用私钥对上述区块头进行签名，并将这个签名在全网广播；  
如果自己是第N个幸运股权人，则构建用这个区块头来构建一个新区块。  
区块中包含了自己选出的尽可能多的交易，前N-1个幸运股权人的签名，还有自己对完整区块的HASH值的签名。然后 将这个签名后的完整节点在全网广播。  
5.所有活跃节点在收到完整节点之后，进行验证（例如N个签名必须正确），若验证通过则认为该节点是一个合法的新区块，将其加入区块链。如果这个区块属于最长链，则以它为前区块，转到步骤1；否则，作丢弃处理。