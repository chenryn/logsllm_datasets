User: 请解答这个和日志有关的问题Authenticating Client Certificates from Different Issuer Ok, here's the scenario. A company called "Corp" issues SSL certificates to all their employees for accessing Corp's web resources. Corp also provides a certificate for their Certificate Authority so that their employees can install this as a trusted CA.

I am building a tool that is outside of Corp's network, but I would like to use the SSL certificates that all of the employees have installed to identify them when they use this tool (since only Corp employees should be able to use this tool). This is running on an Apache 2.2 install on Amazon's linux distro. Here is what I have tried so far:

1) I created and self-signed a SSL certificate for the server to use to serve up HTTPS ("privatekey.pem" and "server.crt")

2) I copied Corp's CA certificate to the server (corp-ca.crt)

3) I used the following VirtualHost configuration for Apache:

&lt;VirtualHost *:443&gt;
        ServerName toolname.thirdparty.com
        DocumentRoot /var/www/html
        ServerAdmin admin@myemail.com
        ErrorLog logs/toolname-error_log
        CustomLog logs/toolname-access_log common
        &lt;Directory "/var/www/html"&gt;
                AllowOverride all
        &lt;/Directory&gt;
        SSLEngine On
        SSLCertificateFile /etc/ssl/server.crt
        SSLCertificateKeyFile /etc/ssl/privatekey.pem
        SSLCACertificateFile /etc/ssl/corp-ca.crt
        SSLVerifyClient require
        SSLVerifyDepth 1
        SSLOptions +StdEnvVars
&lt;/VirtualHost&gt;


When I try to access one of Corp's websites, I can select my client certificate from them and it works, so I know the client certificate is installed properly. When I do this with SSLVerifyClient optional, the page loads fine over HTTPS so I know my server's SSL setup is good. With SSLVerifyClient required, though, I get an ERR_SSL_PROTOCOL_ERROR saying:

"Unable to make a secure connection to the server. This may be a problem with the server, or it may be requiring a client authentication certificate that you don't have."

So this brings up the question I have to ask: is what I'm trying to do even possible? Can I use a client certificate issues by someone else to verify their identity on my own site? If that's actually possible, how would I go about doing it?

Assistant: Your configuration seems correct, assuming the certificate of the CA that signs your client certificates is fuond in this file:

/etc/ssl/corp-ca.crt

I would suggest you to add another directove too, this one:

SSLCADNRequestFile

That shoud point to a file that is a concatenation of all the CA's that can sign your client's certs, and another caveat, see this apache bug about that list (a list of acceptable CA's sent from apache to the client):

https://bz.apache.org/bugzilla/show_bug.cgi?id=12355

That and the fact that the CA's may not be known to the browser can give you the exact message you got.

In this case, first make sure to install the client certificate to your browser, you need a pkcs12 file which includes both the private key and certificate. Once done this, all should work fine.

To check if that is the case you can use curl:

curl -k -E YOUR_CLIENT_CERT.pem --key YOUR_CLIENT_KEY.pem https://toolname.thirdparty.com

-k because you are not checking server's certificate in this case.