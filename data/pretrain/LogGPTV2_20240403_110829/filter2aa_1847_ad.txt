The most effective method to guard against these attacks is vigilance. This includes 
maintaining up-to-date software as well as auditing your DNS records regularly. As 
exploits are found in the current version of BIND, the exploit is patched and a Security 
Update is made available for Mac OS X Server. Apply all such security patches. Regular 
audits of your DNS records is also valuable to prevent these attacks.
Server Mining
Server mining is the practice of getting a copy of a complete master zone by 
requesting a zone transfer. In this case, a hacker pretends to be a slave zone to another 
master zone and requests a copy of all of the master zone’s records.
LL2351.Book  Page 30  Monday, September 8, 2003  2:47 PM
Chapter 2    DNS Service
31
With a copy of your master zone, the hacker can see what kinds of services a domain 
offers, and the IP address of the servers that offer them. He or she can then try specific 
attacks based on those services. This is reconnaissance before another attack.
To defend against this attack, you need to specify which IP addresses are allowed to 
request zone transfers (your slave zone servers) and disallow all others. Zone transfers 
are accomplished over TCP on port 53. The method of limiting zone transfers is 
blocking zone transfer requests from anyone but your slave DNS servers.
To specify zone transfer IP addresses:
m Create a firewall filter that allows only IP addresses inside your firewall to access TCP 
port 53.
Follow the instructions in “Creating an Advanced IP Filter for TCP ports” in Chapter 3, “IP 
Firewall Service.” Use the following settings:
• Allow packet.
• Port 53.
• TCP protocol.
• Source IP is the IP address of your slave DNS server.
• Destination IP is the IP address of your master DNS server.
DNS Service Profiling
Another common reconnaissance technique used by malicious users is to profile your 
DNS Service. First a hacker makes a BIND version request. The server will report what 
version of BIND is running. He or she then compares the response to known exploits 
and vulnerabilities for that version of BIND.
To defend against this attack, you can configure BIND to respond with something other 
than what it is.
To alter BIND’s version response:
1 Launch a command-line text editor (like vi, emacs, or pico).
2 Open named.conf for editing.
3 Add the following to the “options” brackets of the configuration file.
version    "[your text, maybe ‘we're not telling!’]";
4 Save the config file.
Denial-of-Service (DoS)
This kind of attack is very common and easy to do. A hacker sends so many service 
requests and queries that a server uses all of its processing power and network 
bandwidth to try and respond. The hacker prevents legitimate use of the service by 
overloading it.
LL2351.Book  Page 31  Monday, September 8, 2003  2:47 PM
32
Chapter 2    DNS Service
It is difficult to prevent this type of attack before it begins. Constant monitoring of the 
DNS service and server load allows an administrator to catch the attack early and 
mitigate its damaging effect.
The easiest way to guard against this attack is to block the offending IP address with 
your firewall. See “Creating an Advanced IP Filter for TCP ports” on page 51. 
Unfortunately, this means the attack is already underway and the hacker’s queries are 
being answered and the activity logged. 
Service Piggybacking
This attack is not often done by hackers, but common Internet users. They may feel that 
their DNS response time with their own Internet Service Provider is too slow. They learn 
this trick from other users. The Internet users will configure their computer to query 
another DNS server instead of their own ISP’s DNS servers. Effectively, there will be 
more users accessing the DNS server than have been planned for. 
You can guard against this by limiting or disabling DNS Recursion. If you plan to offer 
DNS service to your own LAN users, they need recursion to resolve domain names, but 
you don’t want to provide this service to any Internet users.
To prevent recursion entirely, see “Enabling or Disabling Recursion” on page 21.
The most common balance is allowing recursion for requests coming from IP addresses 
within your own range, but denying recursion to external addresses. BIND allows you to 
specify this in its configuration file, named.conf. Edit your named.conf file to include the 
following:
options {
...
allow-recursion{
127.0.0.0/8;
[your internal IP range of addresses, like 192.168.1.0/27];
};
};
Please see BIND’s documentation for further information.
LL2351.Book  Page 32  Monday, September 8, 2003  2:47 PM
Chapter 2    DNS Service
33
Common Network Administration Tasks That Use 
DNS Service
The following sections illustrate some common network administration tasks that 
require DNS service.
Setting Up MX Records
If you plan to provide mail service on your network, you must set up DNS so that 
incoming mail is sent to the appropriate mail host on your network. When you set up 
mail service, you define a series of hosts, known as mail exchangers or MX hosts, with 
different priorities. The host with the highest priority gets the mail first. If that host is 
unavailable, the host with the next highest priority gets the mail, and so on. 
For example, let’s say the mail server’s host name is “reliable” in the “example.com” 
domain. Without an MX record, the users’ mail addresses would include the name of 
your mail server computer, like this:
PI:EMAIL 
If you want to change the mail server or redirect mail, you must notify potential 
senders of a new address for your users. Or, you can create an MX record for each 
domain that you want handled by your mail server and direct the mail to the correct 
computer. 
When you set up an MX record, you should include a list of all possible computers that 
can receive mail for a domain. That way, if the server is busy or down, mail is sent to 
another computer. Each computer on the list is assigned a priority number. The one 
with the lowest number is tried first. If that computer isn’t available, the computer with 
the next lowest number is tried, and so on. When a computer is available, it holds the 
mail and sends it to the main mail server when the main server becomes available, and 
then the server delivers the mail. A sample list might look like this:
example.com
10 reliable.example.com
20 our-backup.example.com
30 last-resort.example.com
MX records are used for outgoing mail, too. When your mail server sends mail, it looks 
at the MX records to see whether the destination is local or somewhere else on the 
Internet. Then the same process happens in reverse. If the main server at the 
destination is not available, your mail server tries every available computer on that 
destination’s MX record list, until it finds one that will accept the mail.
Note:  If you don’t enter the MX information into your DNS server correctly, mail won’t 
work.
LL2351.Book  Page 33  Monday, September 8, 2003  2:47 PM
34
Chapter 2    DNS Service
Configuring DNS for Mail Service
Configuring DNS for mail service is enabling Mail Exchange (MX) records with your own 
DNS server. If you have an Internet Service Provider (ISP) that provides you with DNS 
service, you’ll need to contact the ISP so that they can enable your MX records. Only 
follow these steps if you provide your own DNS Service.
To enable MX records:
1 In Server Admin, choose DNS in the Computers & Services list.
2 Click Settings.
3 Select the Zones tab.
4 Select the Zone you want to use.
5 Click the Add button under the Records pane.
6 Choose MX from the Type pop-up menu.
7 Enter the domain name (like “example.com.”) in the From field.
8 Enter the name of the mail server (like “mail.example.com.”) in the To field.
9 Enter a precendence number.
10 Click OK.
Enabling Redundant Mail Servers
You may need to set up multiple servers for redundancy. If this is the case, you’ll need 
to add additional information to each MX record. Create one record for each auxiliary 
server. This consists of two steps:
These instructions assume you have an existing MX record for a primary mail server. If 
not, please see “Configuring DNS for Mail Service” on page 34.
Step 1:  Edit the MX record of the primary mail server
1 In Server Admin, choose DNS in the Computers & Services list.
2 Click Settings.
3 Select the Zones tab.
4 Select the Zone you want to use.
5 Click the primary mail server’s MX record in the Records pane.
6 Click the Edit button below the Records pane.
7 Enter a low precedence number for that server.
A lower number indicates it will be chosen first, if available, to receive mail.
8 Click OK.
9 Proceed to Step 2.
LL2351.Book  Page 34  Monday, September 8, 2003  2:47 PM
Chapter 2    DNS Service
35
Step 2:  Create records and priorities for the auxiliary mail servers
These instruction assume you have edited the original MX record. If not, please do so 
before proceeding.
These instructions also assume you have already set up and configured one or more 
auxiliary mail servers.
To enable backup or redundant mail servers:
1 In Server Admin, select DNS in the Computers & Services pane.
2 Click Settings.
3 Select the Zones tab.
4 Select the Zone you want to use.
5 Click the Add button under the Records pane.
6 Choose MX from the Type pop-up menu.
7 Enter the domain name (like ‘example.com.’) in the From field.
8 Enter the name of the mail server (like ‘backup.example.com.’) in the To field.
9 Enter a precedence number for that server which is higher than that of the primary 
server.
A higher the number indicates it will be chosen if the primary server is unavailable.
10 Click OK.
Setting Up Namespace Behind a NAT Router
If you’re behind a Network Address Translation (NAT) router, you have a special set of IP 
addresses that are only usable within the NAT environment. If you were to assign a 
domain name to these addresses outside of the NAT router, none of your domain 
names would resolve to the correct computer. See Chapter 4, “NAT Service,” on page 67 
for more information about NAT.
You can, however, run a DNS service behind the router, assigning host names to the 
NAT IP addresses. This way, if you’re behind the NAT router, you can enter domain 
names rather than IP addresses to access servers, services, and workstations. Your DNS 
server should also have a Forwarding zone to send DNS requests outside of the NAT 
router to allow resolution of names outside the routed area. Your clients’ networking 
settings should specify the DNS server behind the NAT router. The process of setting up 
one of these networks is the same as setting up a private network. See “Setting Up a 
Private TCP/IP Network” on page 36 for more information.
If you choose to do this, names entered by users outside the NAT router won’t resolve 
to the addresses behind it. You should set the DNS records outside the NAT-routed area 
to point to the NAT router, and use NAT port forwarding to access computers behind 
the NAT router. For more information on port forwarding, see Chapter 4, “NAT Service,” 
on page 67.
LL2351.Book  Page 35  Monday, September 8, 2003  2:47 PM
36
Chapter 2    DNS Service
Mac OS X’s Rendezvous feature allows you to use hostnames on your local subnet that 
end with the “.local” suffix without having to enable DNS. Any service or device that 
supports Rendezvous allows the use of user-defined namespace on your local subnet 
without setting up and configuring DNS.
Network Load Distribution (aka Round Robin)
BIND allows for simple load distribution using an address-shuffling method called 
round robin. You set up a pool of IP addresses for several hosts mirroring the same 
content, and BIND cycles the order of these addresses as it responds to queries. Round 
robin has no capability to monitor current server load or processing power. It simply 
cycles the order of an address list for a given host name.
You enable round robin by adding multiple address entries in your zone data file for a 
given host. For example, suppose you want to distribute web server traffic between 
three servers on your network that all mirror the same content. Suppose the servers 
have the IP addresses 192.168.12.12, 192.168.12.13, and 192.168.12.14. You would add these 
lines to the zone data file db.example.com:
www.example.com
60
IN
A
192.168.12.12
www.example.com
60
IN
A
192.168.12.13
www.example.com
60
IN
A
192.168.12.14
When BIND encounters multiple entries for one host, its default behavior is to answer 
queries by sending out this list in a cycled order. The first request gets the addresses in 
the order A, B, C. The next request gets the order B, C, A, then C, A, B, and so on. Notice 
that the time-to-live (TTL) in the second column is set quite short to mitigate the effects 
of local caching.
Setting Up a Private TCP/IP Network
If you have a local area network that has a connection to the Internet, you must set up 
your server and client computers with IP addresses and other information that’s unique 
to the Internet. You obtain IP addresses from your Internet service provider (ISP).
If it’s unlikely that your local area network will ever be connected to the Internet and 
you want to use TCP/IP as the protocol for transmitting information on your network, 
it’s possible to set up a “private” TCP/IP network. When you set up a private network, 
you choose IP addresses from the blocks of IP addresses that the IANA (Internet 
Assigned Numbers Authority) has reserved for private intranets:
• 10.0.0.0–10.255.255.255 (10/8 prefix)
• 172.16.0.0–172.31.255.255 (172.16/12 prefix)
• 192.168.0.0–192.168.255.255 (192.168/16 prefix)
LL2351.Book  Page 36  Monday, September 8, 2003  2:47 PM
Chapter 2    DNS Service
37
If you set up a private TCP/IP network, you can also provide DNS service. By setting up 
TCP/IP and DNS on your local area network, your users will be able to easily access file, 
web, mail, and other services on your network.
Hosting Several Internet Services With a Single IP Address
You must have one server supplying all your Internet services (like mail, web). They may 
all be running on one computer with a single IP address. For example, you may want to 
have the domain name www.example.com resolve to the same IP address as 
ftp.example.com, or mail.example.com. 
Setting up the DNS records for this service is easy. You’ll still need a full set of DNS 
records, one for each name you want to resolve.
• Set up MX records for mail, so mail.example.com resolves to your server’s IP address.
• Set up A records for each service your server provides, so web.example.com resolves 
to your server’s IP address.
• Do the same for each service you provide (ftp.apple.com, or fileshare.apple.com, or 
whatever).
As your needs grow, you can add other computers to the network to take over these 
services. Then all you have to do is update the DNS record, and your client’s settings 
can remain the same.
Configuring BIND Using the Command Line
In order to set up and use DNS service on Mac OS X Server you may wish to configure 
BIND with the command-line. Configuring BIND requires making changes to UNIX 
configuration files in the Terminal application. To configure BIND, you must be 
comfortable with typing UNIX commands and using a UNIX text editor. Only 
manipulate these settings if you have a thorough understanding of DNS and BIND, 
preferably as an experienced DNS administrator.
What Is BIND?
BIND stands for Berkeley Internet Name Domain. BIND runs on UNIX-based operating 
systems and is distributed as open-source software. BIND is used on the majority of 
name servers on the Internet today.
Important:  If you think you might want to connect to the Internet in the future, you 
should register with an Internet registry and use the IP addresses provided by the 
registry when setting up your private network. Otherwise, when you do connect to 
the Internet, you’ll need to reconfigure every computer on your network.
Warning:   Incorrect BIND configurations can result in serious network problems.
LL2351.Book  Page 37  Monday, September 8, 2003  2:47 PM
38
Chapter 2    DNS Service
BIND is configured by editing text files containing information about how you want 
BIND to behave and information about the servers on your network. If you wish to 
learn more about DNS and BIND, resources are listed at the end of this chapter.
BIND on Mac OS X Server
Mac OS X Server uses BIND version 9.2.2. You can start and stop DNS service on 
Mac OS X Server using the Server Admin application. You can use Server Admin to view 
DNS status and usage statistics.
BIND Configuration File
By default, BIND looks for a configuration file labeled “named.conf” in the /etc directory. 
This file contains commands you can use to configure BIND’s many options. It also 
specifies the directory to use for zone data files.
Zone Data Files
Zone data files consist of paired address files and reverse lookup files. Address records 
link host names (host1.example.com) to IP addresses. Reverse lookup records do the 
opposite, linking IP addresses to host names. Address record files are named after your 
domain name– for example, example.com. Reverse lookup file names look like part of 
an IP address, such as db.192.168.12.
By default, the zone data files are located in /var/named/.
Practical Example
The following example allows you to create a basic DNS configuration using BIND for a 
typical network behind a Network Address Translation (NAT) device that connects to an 
ISP. The port (cable modem/DSL/dial-up/etc.) that is connected to your ISP is referred to 
here as the WAN interface. The port that is connected to your internal network is 
referred to here as the LAN interface. The sample files you need are installed with 
Mac OS X Server in the directories listed in the steps below. This example also assumes 
the following:
• The IP address of the WAN interface is determined by your ISP.
• The IP address of the LAN interface is 10.0.1.1.
• The IP address of the Mac OS X or Mac OS X Server computer that will be used as the 
DNS server is 10.0.1.2.
• The IP addresses for client computers are 10.0.1.3 through 10.0.1.254.
If IP address assignment is provided by the NAT device via DHCP, it must be configured 
with the above information. Please consult your router or gateway manual for 
instructions on configuring its DHCP server.
If your NAT device connects to the Internet, you also need to know the DNS server 
addresses provided by your ISP.
LL2351.Book  Page 38  Monday, September 8, 2003  2:47 PM
Chapter 2    DNS Service
39
Setting Up Sample Configuration Files
The sample files can be found in /usr/share/named/examples.
The sample files assume a domain name of example.com behind the NAT. This may be 
changed, but must be changed in all modified configuration files. This includes 
renaming /var/named/example.com.zone to the given domain name, for example, /var/
named/foo.org.zone
To set up the sample files:
1 In Terminal, log in as root.
2 Enter the following command:
cp /etc/named.conf /etc/named.conf.OLD
This saves a copy of the process configuration file.
3 Then, enter the following command:
cp /usr/share/named/examples/db.10.0.1.sample /var/named/10.0.1.zone
This copies the sample file for the NAT zone.
4 Enter the following command:
cp /usr/share/named/examples/example.com.sample /var/named/
example.com.zone
This copies the sample file for your domain.
5 Now, enter the following command:
cp /usr/share/named/examples/named.conf.sample /etc/named.conf
This copies in a sample named process configuration file.
6 Using a command-line text editor (like pico, or emacs), open /etc/named.conf for 
editing.
7 Follow the instructions in the sample file to apply edits appropriate to your specific 
installation.
8 Save your changes to named.conf.
9 Use Server Admin to start DNS service.
10 In the Network pane of System Preferences, change the domain name servers to list 
only the IP address of the new DNS server, 10.0.1.2.
Configuring Clients
If the IP addresses of your client computers are statically assigned, change the domain 
name servers of their Network preference panes to only list the new server’s IP address, 