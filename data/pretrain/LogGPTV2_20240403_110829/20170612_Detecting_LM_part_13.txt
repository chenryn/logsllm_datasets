Targeted OS Windows
Operating Domain Not required
Condition Communication
-
Protocol
Service -
Information Standard Settings - Execution history (Prefetch)
Acquired from - Execution history (Sysmon / audit policy)
Additional Settings
Log - Auditing of change of file creation date and time
Evidence That Can Be Confirmed If the following log is in the event log, it is considered that the timestamp was changed.
When Execution is Successful - The Event ID: 4663 is recorded in the event log "Security", and the "WriteAttributes" keyword for the target file is set to "Audit Success".
Points to be Confirmed
Log Generation Additional
Communication Log Type and Name Acquired Information Details
Location Settings
Event ID: 4688 (A new process has been created)
4689 (A process has exited)
- Process Information -> Process Name: "[File Name (timestomp.exe)]"
- Confirmable Information
- Process Start/End Time and Date: Log Date
- Name of User Who Executed the Process: Subject -> Account Name
- Domain of User Who Executed the Process: Subject -> Account Domain
- Presence of Privilege Escalation at Process Execution: Process Information -> Token Escalation Type
- Process Return Value: Process Information -> Exit Status
Event ID: 4656 (A handle to an object was requested)
- Process Information -> Process Name: "[File Name (timestomp.exe)]"
- Confirmable Information
- Targeted File: Object -> Object Name
Event Log - Handle ID: Object -> Handle ID *Used for association with other logs
- - Process Details: Access Request Information -> Access ("SYNCHRONIZE", "ReadAttributes", "WriteAttributes") Required
Security - Success or Failure: Keywords ("Audit Success")
Event ID: 4663 (An attempt was made to access an object)
- Process Information -> Process Name: "[File Name (timestomp.exe)]"
- Confirmable Information
- Targeted File: Object -> Object Name
- Handle ID: Object -> Handle ID *Used for association with other logs
- Process Details: Access Request Information -> Access ("WriteAttributes")
- Success or Failure: Keywords ("Audit Success")
Event ID: 4658 (The handle to an object was closed)
- Process Information -> Process Name: "[File Name (timestomp.exe)]"
- Confirmable Information
- Handle ID: Object -> Handle ID *The same as the handle ID recorded in events 4663 and 4656 to be output first
Host
-
(Windows)
Event ID: 1 (Process Create)
5 (Process Terminated)
- Image: "[File Name (timestomp.exe)]"
- Confirmable Information
- Process Start/End Time and Date (UTC): UtcTime
- Process Command Line: CommandLine
*The target file, properties to be changed, and new timestamp are recorded in the argument in the command line.
- User Name: User
Event ID: 2 (File creation time changed)
- Image: "[File Name (timestomp.exe)]"
Event Log - Confirmable Information
- - Date and Time (UTC) the Change Occurred: UtcTime Required
Sysmon - New File Name: TargetFilename
- New Timestamp (UTC): CreationUtcTime
- Previous Timestamp (UTC): PreviousCreationUtcTime
*The Event ID: 2 shows a change in the file creation date and time, but it is output regardless of the type (creation, change, or access)
of the changed timestamp. If an item other than the creation date and time is changed, the same time (original date and time) is
recorded in the timestamp before and after the change.
*Timestamps other than for the creation date and time will not be recorded.
Event ID: 9 (RawAccessRead detected - Direct disk read detected)
- Image: "[File Name (timestomp.exe)]"
- Confirmable Information
- Name of the Device that has the Target File: Device ("\Device\HarddiskVolume2")
File name:
Execution History C:\Windows\Prefetch\[File Name (TIMESTOMP.EXE)]-[RANDOM].pf
- -
- Confirmable Information (the following can be confirmed using this tool: WinPrefetchView)
Prefetch
- Last Execution Time and Date: Last Execution Time
Remarks
Additional Event Logs That Can Be Output -
62
3.14.1. wevtutil
Basic Information
Tool Name wevtutil Legend
Category Deleting Event Log - Acquirable
Tool Overview Deletes Windows event logs Information
Tool - Event ID/Item Name
Example of This tool is used to delete the evidence of an attack.
- Field Name
Presumed Tool Use - Source host: wevtutil command execution source
- "Field Value"
During an Attack - Destination host: The machine accessed by the wevtutil command
Authority Administrator
Targeted OS Windows
Operating
Domain Not required
Condition
Communication Protocol 135/tcp
Service Event Log
Information Standard Settings - The fact that an event log was cleared remains in each cleared log of the host.
Acquired from Additional Settings - The account used for clearing logs and the host that executed the clear command can be confirmed.
Evidence That Can Be Confirmed - Source host: If the following log is in the event log, it is considered that logs were cleared.
When Execution is Successful - The Event ID: 104 is recorded in each target event log.
Points to be Confirmed
Log Generation Additional
Communication Log Type and Name Acquired Information Details
Location Settings
Event ID: 4688 (A new process has been created)
4689 (A process has exited)
- Process Information -> Process Name: "C:\Windows\System32\wevtutil.exe"
- Confirmable Information
- Process Start/End Time and Date: Log Date
- Name of User Who Executed the Process: Subject -> Account Name
- Domain of User Who Executed the Process: Subject -> Account Domain
- Presence of Privilege Escalation at Process Execution: Process Information -> Token Escalation Type
Event Log
- Process Return Value: Process Information -> Exit Status
- Required
Security
Event ID: 4648 (A logon was attempted using explicit credentials)
- Process Information -> Process Name: "C:\Windows\System32\wevtutil.exe"
- Process Information -> Process ID: The same as the process ID recorded in the event 4688
Source host
- Confirmable Information
- Local Account: Subject -> Account Name / Account Domain
- Account Used at Destination Host: Account for which a Credential was Used -> Account Name / Account Domain
- Destination Host: Target Server -> Target Server Name
Event ID: 1 (Process Create)
5 (Process Terminated)
- Image: "C:\Windows\System32\wevtutil.exe"
OS: Windows Event Log
user - - Confirmable Information Required
↓
Sysmon - Process Start/End Time and Date (UTC): UtcTime
OS: Windows - Process Command Line: CommandLine
administrator - User Name: User
- Process ID: ProcessId
Event ID: 104 (The System log file was cleared)
Event Log
- - Confirmable Information -
Each Target Log - User: Detailed Tab -> UserData\SubjectUserName / SubjectDomainName
- Target Log Name: Detailed Tab -> UserData\Channel
Event ID: 4672 (Special privileges assigned to new logon)
- Confirmable Information
- Account with Escalated Privileges: Subject -> Account Name / Account Domain
Destination host
- Available Privileges: Special Privileges ("SeSecurityPrivilege" / "SeRestorePrivilege" / "SeTakeOwnershipPrivilege" /
"SeDebugPrivilege" / "SeSystemEnvironmentPrivilege" / "SeLoadDriverPrivilege" / "SeImpersonatePrivilege" /
Event Log "SeEnableDelegationPrivilege")
- Required
Security Event ID: 4624 (An account was successfully logged on)
- Logon Type: "3"
- Confirmable Information
- Used Security ID: New Logon -> Security ID
- Account: Account Name / Account Domain
- Host which Requested Logon: Network Information -> Source Network Address
Remarks
Additional Event Logs That Can Be Output -
63
3.15.1. csvde
Basic Information
Tool Name csvde Legend
Category Acquisition of Account Information - Acquirable
Tool Overview Outputs account information on the Active Directory in the CSV format Information
Tool - Event ID/Item Name
Example of This tool is used to extract information on an existing account and select users and clients available as attack targets.
- Field Name
Presumed Tool Use - Source host: csvde command execution source
- "Field Value"
During an Attack - Destination host: The machine in which information is collected by the csvde command
Authority Standard user
Targeted OS Windows
Domain Not required
Operating
Participation *By entering correct authentication information, it is possible to obtain information remotely from a client that does not participate in the domain.
Condition
Communication
389/tcp
Protocol
Service Active Directory Domain Services
Standard Settings Source host: Execution history (Prefetch)
Information
- Source host: The fact that a csv file was created by csvde.exe.
Acquired from
Additional Settings The fact that "C:\Users\[User Name]\AppData\Local\Temp\csv[Random Number].tmp" was created as a temporary file when creating a csv file.
Log
- Destination host: Inbound to 389/tcp and login with Kerberos Authentication are recorded.
Evidence That Can Be Confirmed - Source host: csvde.exe was executed and a file specified by the "-f" option was created.
When Execution is Successful - "C:\Users\[User Name]\AppData\Local\Temp\csv[Random Number].tmp" was created and deleted.
Points to be Confirmed
Log Generation Additional
Communication Log Type and Name Acquired Information Details
Location Settings
Event ID: 4688 (A new process has been created)
4689 (A process has exited)
- Process Information -> Process Name: "[File Name (csvde.exe)]"
- Confirmable Information
- Process Start/End Time and Date: Log Date
- Name of User Who Executed the Process: Subject -> Account Name
- Domain of User Who Executed the Process: Subject -> Account Domain
- Presence of Privilege Escalation at Process Execution: Process Information -> Token Escalation Type
- Process Return Value: Process Information -> Exit Status
Event ID: 5156 (The Windows Filtering Platform has allowed a connection)
- Application Information -> Application Name: "[File Name (csvde.exe)]"
- Network Information -> Direction: "Outbound"
- Network Information -> Destination Address: "[Domain Controller IP Address]"
- Network Information -> Destination Port / Protocol: "389" / "6"(TCP)
- Confirmable Information
- Source Port: Source Port *Used for association with logs on the Domain Controller side
Event ID: 4663 (An attempt was made to access an object)
4656 (A handle to an object was requested)
4658 (The handle to an object was closed)
- Process Information -> Process Name: "[File Name (csvde.exe)]"
- Confirmable Information
Event Log - Target File: Object -> Object Name: ("C:\Users\[User Name]\AppData\Local\Temp\
- csv[Random Number].tmp") Required
Security - Handle ID (Used for Association with Other Logs): Object -> Handle ID
- Process Details: Access Request Information -> Access ("SYNCHRONIZE" / "WriteData (or AddFile)" /
"AppendData (or AddSubdirectory, or CreatePipeInstance) / "WriteEA" / "WriteAttributes")
- Success or Failure: Keywords ("Audit Success")
OS: Windows
user Event ID: 4663 (An attempt was made to access an object)
↓ 4656 (A handle to an object was requested)
Source host
OS: Windows 4658 (The handle to an object was closed)
Server - Process Information -> Process Name: "[File Name (csvde.exe)]"
domain user - Object -> Object Name: "[File specified with the "-f" option when executing csvde.exe]"
- Confirmable Information
- Handle ID (Used for Association with Other Logs): Object -> Handle ID
- Process Details: Access Request Information -> Access ("WriteData or AddFile" /
"AppendData, AddSubdirectory, or CreatePipeInstance")
- Success or Failure: Keywords ("Audit Success")
Event ID: 4663 (An attempt was made to access an object)
4656 (A handle to an object was requested)
4658 (The handle to an object was closed)
- Process Information -> Process Name: "[File Name (csvde.exe)]"
- Object -> Object Name ("C:\Users\[User Name]\AppData\Local\Temp\csv[Random Number].tmp")
- Confirmable Information
- Handle ID: Object -> Handle ID *Used for association with other logs
- Process Details: Access Request Information -> Access ("DELETE")
- Success or Failure: Keywords ("Audit Success")
Event ID: 1 (Process Create)
5 (Process Terminated)
- Image: "[File Name (csvde.exe)]"
Event Log
- - Confirmable Information Required
Sysmon - Process Start/End Time and Date (UTC): UtcTime
- Process Command Line: CommandLine *If a user or file name is specified, an argument is recorded.
- User Name: User
- Process ID: ProcessId
File name:
Execution History C:\Windows\Prefetch\[File Name(CSVDE.EXE)]-[RANDOM].pf
- -
- Confirmable Information (the following can be confirmed using this tool: WinPrefetchView)
Prefetch
- Last Executed Time and Date: Last Execution Time
64
Log Generation Additional
Communication Log Type and Name Acquired Information Details
Location Settings
Event ID: 5156 (The Windows Filtering Platform has allowed a connection)
- Application Information -> Application Name: "\device\harddiskvolume2\windows\system32\lsass.exe"
- Network Information -> Direction: "Inbound"
- Network Information -> Source Port / Protocol: "389" / "6"(TCP)
- Network Information -> Destination Port: "[Source Port recorded in the client which executed csvde.exe]"
OS: Windows
user
- Confirmable Information
↓
- Source Host: Destination Port
OS: Windows Event Log
Server Destination host - Required
domain user Security Event ID: 4624 (An account was successfully logged on)
(Continued from 4634 (An account was logged off)
- Logon Type: "3"
the previous
- Network Information -> Source Network Address: "[Destination Address in Event 5156]"
entry)
- Network Information -> Source Port: "[Destination Port Recorded in Event 5156]"
- Confirmable Information
- Used User: New Logon -> Account Name / Account Domain
- New Logon ID: New Logon -> Logon ID *Used for association with other logs
Remarks
Additional Event Logs That Can Be Output -
65
3.15.2. ldifde
Basic Information
Tool Name ldifde Legend
Category Acquisition of Account Information -Acquirable
Tool Overview Outputs account information on the Active Directory in the LDIF format Information
Tool -Event ID/Item Name
Example of This tool is used to extract information on an existing account and select users and clients available as attack targets.
-Field Name
Presumed Tool Use - Source host: ldifde command execution source
-"Field Value"
During an Attack - Destination host: The machine in which information is collected by the ldifde command
Authority Standard user
Targeted OS Windows
Domain Not required
Operating
Participation *By entering correct authentication information, it is possible to obtain information remotely from a client that does not participate in the domain.
Condition
Communication
389/tcp
Protocol
Service Active Directory Domain Services
Information Standard Settings - Source host: Execution history (Prefetch)
Acquired from - Source host: The fact that a LDIF file was created by ldifde.exe.
Additional Settings
Log - Destination host: Inbound to 389/tcp and login with Kerberos Authentication are recorded.
Evidence That Can Be Confirmed - Source host: ldifde.exe was executed and a file specified by the "-f" option was created.
When Execution is Successful
Points to be Confirmed
Communicatio Log Generation Additional
Log Type and Name Acquired Information Details
n Location Settings
Event ID: 4688 (A new process has been created)
4689 (A process has exited)
- Process Information -> Process Name: "[File Name (ldifde.exe)]"
- Confirmable Information
- Process Start/End Time and Date: Log Date
- Name of User Who Executed the Process: Subject -> Account Name
- Domain of User Who Executed the Process: Subject -> Account Domain
- Presence of Privilege Escalation at Process Execution: Process Information -> Token Escalation Type
- Process Return Value: Process Information -> Exit Status
Event ID: 5156 (The Windows Filtering Platform has allowed a connection)
- Application Information -> Application Name: "[File Name (ldifde.exe)]"
- Network Information -> Direction: "Outbound"
Event Log - Network Information -> Destination Address: "[Domain Controller IP Address]"
- - Network Information -> Destination Port / Protocol: "389" / "6"(TCP) -
Security
- Confirmable Information
- Source Port: Source Port *Used for association with logs on the Domain Controller side
Event ID: 4656 (A handle to an object was requested)
4663 (An attempt was made to access an object)
4658 (The handle to an object was closed)
Source host
- Process Information -> Process Name: "[File Name (ldifde.exe)]"
- Object -> Object Name: "[File specified with the "-f" option when executing ldifde.exe]"
- Confirmable Information
- Handle ID: Object -> Handle ID *Used for association with other logs
- Process Details: Access Request Information -> Access ("WriteData or AddFile" / "AppendData,
AddSubdirectory, or CreatePipeInstance")
- Success or Failure: Keywords ("Audit Success")
OS: Windows
user Event ID: 1 (Process Create)
↓ 5 (Process Terminated)
- Image: "[File Name (ldifde.exe)]"
OS: Windows
Event Log
Server
- - Confirmable Information Required
domain user
Sysmon - Process Start/End Time and Date (UTC): UtcTime
- Process Command Line: CommandLine *If a user or file name is specified, an argument is recorded.
- User Name: User
- Process ID: ProcessId
File name:
Execution History C:\Windows\Prefetch\[File Name (LDIFDE.EXE)]-[RANDOM].pf
- -
- Confirmable Information (the following can be confirmed using this tool: WinPrefetchView)
Prefetch
- Last Execution Time and Date: Last Execution Time
Event ID: 5156 (The Windows Filtering Platform has allowed a connection)
- Application Information -> Application Name: "\device\harddiskvolume2\windows\system32\lsass.exe"
- Network Information -> Direction: "Inbound"