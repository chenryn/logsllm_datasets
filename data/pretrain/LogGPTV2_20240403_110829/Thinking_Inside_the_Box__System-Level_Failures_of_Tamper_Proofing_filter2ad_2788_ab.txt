### Mechanisms for Detecting Tampering and Data Interception

#### 1. Tamper Detection and Data Line Tapping
Both the Ingenico and Dione Point of Sale (POS) devices include mechanisms to detect tampering, such as drilling from the rear. The designers have even provided easily accessible circuit board pads to short the tamper detection mechanism. However, the main processing unit and the keypad are potted together, making it difficult to capture PIN keystrokes between the keypad and the processor.

In both designs, the secure storage for cryptographic keys is well-protected. Nevertheless, it is possible to tap the data line of the PED-smartcard interface. The data exchanged on this line is not encrypted, which allows an attacker to obtain the information needed to create a fake magnetic-strip card and the corresponding PIN.

#### 2. Signal Eavesdropping Attack
We successfully defeated the Ingenico PED using a simple "tapping attack" due to a series of design flaws. The rear of the device has a user-accessible compartment for inserting optional SIM-sized cards to expand functionality. This space is not intended to be tamper-proof, and when covered, it cannot be inspected by the cardholder, even if they handle the PED. This compartment provides access to the circuit board and many signals routed on its bottom layer. Although a sensor mesh layer prevents drilling into the PCB to access more sensitive routes, the designers have provided 1 mm diameter holes and other vias through the PCB. These holes are used for positioning optional surface-mount sockets, but in the PEDs we examined, these sockets were not populated. Other exploitable vias do not serve any obvious electrical purpose. Through one of these holes, a simple metal hook can tap the serial data line, making it easy to place the tap between the microprocessor and the card interface chip. We preferred to tap the signal before the interface chip, using a bent paperclip inserted through a hole in the plastic surrounding the internal compartment, leaving no external marks.

After testing this attack in the laboratory, we repeated it in the field for the BBC 'Newsnight' program. We tapped a terminal from a London shop and, during a transaction, extracted the card and PIN details for a journalist's card without triggering the tamper detection system.

The Dione PED, while lacking a concealed compartment, is still vulnerable. By drilling a 0.8 mm hole from the rear, we can insert a 4 cm needle into a flat ribbon connector socket. Figure 3 shows the full Dione attack, with the PED mounted as it would be in a shop, and a thin wire connected to an FPGA board that translates the data and sends it to a laptop. The scope and laptop screen show an 'answer to reset' (ATR) initial exchange intercepted using the tap.

What should have required $25,000 was achieved with a bent paperclip, a needle, a short length of wire, and some creative thinking. Attaching them to the data line takes minutes with practice. A small FPGA or microcontroller board with non-volatile memory can fit inside the Ingenico PED's compartment and record transaction details without the cardholder's knowledge. For the Dione PED, a wire routed from the back to a recorder under the counter will not be detected unless the cardholder conducts a very close inspection and knows what to look for. The recording circuit can be battery-operated or attached to the PED's power supply, and with a full transaction requiring about 1 kB of storage, even a small memory can record thousands of transactions. Detecting such a tap from within the PED is extremely difficult, as high input-impedance probes do not significantly distort signals, and proper termination suppresses reflections. Bond [12] has shown that even without these measures, a tap outside the terminal is not detected, while Drimer and Murdoch [20] showed that PEDs can drive 1.5 m cables placed between the card slot and a card.

#### 3. Shim-in-the-Middle Attack
We propose, but have yet to implement, an attack involving the insertion of a thin, flexible circuit board into the card slot, so it lodges between the reader and the card's contacts. This "shim-in-the-middle" attack is illustrated in Figure 4. A basic circuit that can transmit the signal on the data line to a nearby receiver would not be easily detected by a cursory inspection because it is within the PED itself. The fraudster can create an "inserter card" with the shim attached, so when inserted into a particular device, the shim locks into place as the carrier card is removed. A receiver is then placed nearby to record card details and PINs, and this receiver could include a mobile phone to SMS the proceeds back to the fraudster.

This attack bypasses all tamper protections and does not require the participation of anyone in the store. None of the PEDs we examined appeared to contain any countermeasures to the shim attack, and it is challenging to imagine what they might be. If the PED vendor included a LED and a photocell, the shim designer would just use a transparent material. One option is to make the card slot transparent, though this means dumping liability on unsuspecting cardholders. A better, but not infallible, option is PIN encryption, as discussed later. A corrupt merchant may also prefer this type of attack, as they can indignantly deny all knowledge of it if the police find the shim.

#### 4. Further Attacks and Observations
The Visa PED certification criteria [41] insist that an attacker should not be able to hijack the display to prompt the user to enter a PIN at any other time than intended, or to tap the keypad interface to capture PIN keystrokes. We have not seen any special protection given to these interfaces, though the need to access multiple wires would make an attack harder. The keypad interface on the Dione PED is better protected because it is potted, but the display interface goes through the same connector we tap for the smartcard's data line. Furthermore, the Dione PED is also a magnetic-strip card reader, and a similar tap attack can be made on that interface, though it would not reveal the PIN.

Even if the PED were tamper-proof, pressure sensors in a mat under it may be able to triangulate key-presses [29, p132]. Another risk is that some PEDs do not encrypt the data they send to the bank, so a crooked store employee can get the card data in clear from the local network and observe the PIN using the Mark 1 human eyeball. This attack appears to have been widely used in fuel stations, where CCTV has also been used to capture PINs.

A further possible attack is terminal replacement. Some terminals are handheld devices that communicate wirelessly to a base station, but the shopkeeper must trust the terminal display to confirm whether payment has been made. A villain could walk into a jeweler's shop, perform a transaction, swap the terminal for an identical one programmed to accept bogus cards, and then send in accomplices with bogus cards to buy expensive goods [30]. Banks even advise merchants not to look at a PED while the customer is using it. Other PEDs are connected to stores or even bank counters using a detachable cable, raising the question of whether a recording device placed between the PED's connector and the cable could do anything creative with the communications.

The primary goal of this research is to protect the cardholder, and our secondary goal is to help merchants make informed purchasing decisions. The publication of this paper should make it harder for banks to blame customers for fraud by claiming systems are secure when they are not. We have successfully performed a live demonstration of the tapping attack and, based on our experience, see no reason why the shim attack would fail or be detected. We also do not think that we are revealing concepts not already known to malicious actors; there have already been attacks using Trojanned terminals [9], and with a price tag of $20 for each PED, all a criminal needs is a sense of curiosity and some imagination.

### Defenses and Attack Extensions

We analyzed the main products from the market-leading vendors. It may be that newer models are less vulnerable, though the Ingenico PED we examined is still currently offered as standard by Barclaycard. Promptly replacing insecure devices with more secure models could be prudent; we do not believe that "patching" these devices is likely to solve the problem. In fact, we do not believe the interface between the smartcard and PED can be adequately protected, so changes in EMV system configuration will be needed. Essentially, the vulnerabilities we exploit are not just a matter of hardware design but also of the options many banks chose as they implemented EMV.

In our view, EMV is flawed in that it permits unencrypted PIN transfer over the hard-to-defend smartcard interface. Even if cardholders examine PEDs before PIN entry, "bugs" may be completely concealed in compartments, as with the Ingenico PED, or hidden as shims inside the card slot. Nevertheless, there are some mitigation techniques, although not all are as effective as they might initially appear.

#### 3.1 Encrypted PIN
Our attack reads data as it passes between PED and card "in the clear." If both the card and PED support it, EMV permits the PIN to be encrypted under the card's public key. Cards currently issued in the UK do not support this, as banks chose a low-cost EMV option (SDA) where cards do not possess the capability to do asymmetric cryptography. Upgraded cards will prevent a passive eavesdropper from observing the PIN, though card details are still unencrypted. This requires the card to be capable of public key operations, so it only applies to appropriately configured DDA and CDA cards [23].

However, due to a quirk in the EMV implementation, PIN encryption can sometimes be bypassed. A card advertises its support of encrypted PIN verification by placing an appropriate entry in the cardholder verification method (CVM) list, which is sent at the start of the transaction. In eight out of the 15 cards we examined, the CVM list is not signed and may be modified, causing the PIN to be sent unencrypted. This attack can be done by an active tap that selectively alters the communication, forcing a HIGH bit to LOW so that the PED thinks the card cannot process encrypted PINs and sends the cardholder's PIN in the clear. Conveniently for the attacker, CVM entries are normally qualified with 0x03, indicating that this applies to all types of transactions, but by flipping a single bit so it becomes 0x01, this entry will be ignored for purchases.

If a full middleman scenario can be implemented, a more sophisticated attack may defeat even signed CVM lists. Here, the attack device impersonates an entirely different card to the PED at the start of the transaction and presents a CVM list that allows clear PIN entry. Once the customer has entered their PIN and it has been intercepted, the attack device causes the PED to restart the normal transaction. At worst, this looks like an intermittent error; in some PED implementations, it may be possible to avoid alerting the customer at all.

This attack illustrates that evaluators should consider active attacks too. All of the specifications we have examined appear to consider only passive taps. But there may be some mileage in anti-tampering measures that prevent the communication path from being broken and where the card or PED checks if the data sent has been corrupted—a more feasible task than detecting passive taps. Protocol defenses are also possible: displaying the cardholder name from the card's certificate on the PIN entry prompt would allow some middleman attacks to be detected.

#### 3.2 iCVV
We mentioned above that all the information needed to clone a working magnetic-strip card from a chip card is transmitted in clear during a normal EMV transaction. This backward-compatibility feature is known to be a serious factor in the fallback vulnerability. Visa has therefore proposed that the card verification value (CVV), a cryptographic checksum stored on the magnetic strip, be replaced with a different one—the 'iCVV' (CVV for Integrated Circuit Cards)—in the card's certificate [39].

Some systems do not check CVVs, but many appear to, and once iCVV is universal, a fraudster wanting to make a correct magnetic-strip card would have to recover the true CVV from the mag strip using a 'swipe and dock' reader or by swiping the card in a separate reader. We strongly recommend the adoption of iCVV to mitigate this vulnerability.