TYPE
PATH
NAME
#编辑导入文件，内容如下所示
#切换用户到oneadmin并查看系统中的映像列表
[root@mal data]# 1l Cent0s6.5-x86_64-Desktop.qcow2
首行查看权限
#以下命令在控制端执行
[oneadmin@mal~]$ onedatastore list
[oneadmin@mal-]s cat centos.one
oneadmin@mal
rw-r--r--1 root root 4236247040 Jul711:02Cent0s6.5-x86_64-Desktop.qcow2
【示例13-17】
root@mal data]# su-oneadmin
在虚拟机的控制台中将系统安装完成并作相应的设置后，在控制台中关闭系统，这样就得
IDNAME
IDUSER
0oneadmin
=OS
GROUP
]s oneimage list
oneadmin
QEMU
"centos 6.5desktop"
SIZE AVAIL CLUSTER
图13.12VNC远程连接虚拟机控制台
NAME
Cent0s6.5-x86_6 default
Press fTabl to edit options
Welcome to Centos 6.5!
th basxistingsustenr
DATASTORE
IMAGES TYPE DS
SIZE TYPE PER STAT RVMS
15GOS
山
No used
STA
---
## Page 393
像列表，
#导入后映像的状态将变为rdy
#命令输出的映像名称不完全，但在Sunstone中显示正常
在
#命令执行后添加的映像状态为1ock
[oneadmin@mal ~]s oneimage list
[oneadmin@mal -]s oneimage list
ID:1
[oneadmin@mal ~]s oneimage create centos.one
#将映像导入到default中
Sunstone中添加映像需要在左侧选中虚拟资源中的映像管理，
ID USER
1oneadmin
ID USER
0
2files
I default
0 system
单击列表上方的加号弹出创建映像窗口，如图13.13所示。
oneadmin
oneadmin
oneadmin
创建磁盘映像
高级选项
董置
磁盘映像位置：
描述
CentO56.586_64-server
sCrver
名称
路径
oneadmin
GROUP
oneadmin
oneadmin
oneadmin
GROUP
tOS6.5-
-x86_64-scrvcr.qcow2
457.8G96%
457.8G 96%
457.8G96%
提供个路径上传空白Datablock
Cent0s6.5-x86_6 default
Cent0s6.5-x86_6 default
NAME
NAME
Cent0S6.5-x86 6
Cent0S6.5-x86_6default
图13.13创建映像窗口
maincluster
maincluster
mainCluster
持久性
1:defoult
数据仓库
DATASTORE
DATASTORE
default
第13章配置OpenNebula云平台
--datastore default
0fil
一
SIZE TYPE PER STAT RVMS
SIZE TYPE PER STAT RVMS
img
向导
15GOS
15GOS
15GOS
15GOS
右侧窗口将显示当前映
fs
fs
高级模式
ssh
sharedon
sharedon
X
Nordy
No used
No lock
No used
on
381
O
---
## Page 394
列表，单击列表上方的加号将显示创建模板页面，如图13.15所示。
上方的加号，将显示创建虚拟网络页面，如图13.14所示。
虚拟机。
新添加的映像在列表中的状态为锁定，当导入成功后状态将变为就绪。
中的驱动程序中输入qcow2，最后单击“创建”按钮即可添加新映像。同使用CLI方式相同，
Centos7系统管理与运维实战
382
和大小（即地址数量），最后单击“创建”按钮，即可创建虚拟网络。
多Vlan中继，因此此处需要按实际情况选择。接下来需要在“地址”选项中输入IP起始地址
本例中输入网桥为br0，即桥接网络，网络模式保持默认。OpenNebula也支持802.1q协议的
13.3.4
当映像导入成功之后，还需要创建虚拟网络才能添加模板，最后在模板的基础上创建
在 Sunstone 界面的左侧选择虚拟资源中的模板管理，此时右侧将显示当前已存在的模板
1.添加虚拟网络
在创建硬盘映像窗口中输入名称、描述，选择数据仓库并在路径中输入映像位置，在高级
2.创建模板
在“常规”选项中输入虚拟网络的名称，然后在“配置”选项中输入网桥和网络模式，在
在 Sunstone 左侧的基础设施中选择虚拟网络，此时右侧将显示虚拟网络列表，单击列表
描述：
vneto
名称：
创建虚拟网络
添加虚拟网络和模板
?
重置
Securt
图13.14创建虚拟网络
向导
---
## Page 395
加号，将弹出创建虚拟机页面，如图13.16所示。
Sunstone界面左侧的虚拟资源中选择虚机管理，此时右侧将显示虚拟机列表。在列表上方单击
13.3.5
面选择VNC，监听IP中输入0.0.0.0，并设置访问密码。
备；最后在“调度”中选择运行模板的主机或集群，单击“创建”按钮即可。在本例中图形界
模板选择磁盘映像；在“网络”选项中为模板选择虚拟网络；在“输入输出”中选择控制台设
在Logo中可以为模板选择一个图标，并选择合适的内存和CPU数量；在“存储”选项中为
创建虚拟机模板之后就可以将模板实例化为虚拟机，并运行虚拟机。创建虚拟机可以在
在“常规”选项的名称中输入模板名称，Hypervisor中选择节点类型，此处选择KVM，
创建并访问虚拟机
描述
口
CreateTemplate
创建虚拟机
步骤——制定一个谷称，以夜实做数量
票二
选择个模板
1
图13.16创建虚拟机页面
图13.15创建模板页面
52
其物的要量：
MB
Logo.
Cosr
150）
第13章配置OpenNebula云平
注册时间
口
向导高级
383
---
## Page 396
CentOS7系统管理与运维实战
384
还介绍了OpenNebula在CentOS7中的安装和配置等内容。
少，但可以预见在不久的将来，将会有大量的用户使用。本章介绍了OpenNebula的基本情况，
进一步使用。
虚拟机后有一个显示器图标，单击此图标将在网页中显示控制台，如图13.17所示。
息中的模板中查看（GRAPHICS信息）。另一个访问虚拟机的方法是在虚拟机列表中，运行的
可以在列表中单击虚拟机，在虚拟机详细信息中选择日志，查看错误原因并排除错误。
状态中看到虚拟机处于运行状态，此时就可以访问了。如果状态为错误或其他非正常的状态
拟机。刚创建的虚拟机还不能立即访问，还需要等待系统分配资源，当资源分配完成后可以在
建”按钮，就完成虚拟机创建了。创建完虚拟机之后，可以在虚拟机管理中查看到刚创建的虚
13.4
one
当虚拟机处于运行状态时，可通过VNC客户端进行访问，访问端口可通过虚拟机详细信
OpenNebula是一个功能十分强大而又简单的开源云计算平台，虽然目前国内使用的人较
OpenNebula中虚拟机还有许多操作，读者可通过阅读其官方网站的相关说明了解详情并
在步骤一中的VM名称中输入虚拟机名，然后在步骤二中选择一个模板，然后单击“创
小结
图13.17网页访问虚拟机控制台
二50下午
SendCtiAltDel
---
## Page 397
cp [选项] [参数]。
cp命令默认不能复制目录，复制目录必须使用-R选项。cp命令具备了In命令的功能。语法为：
A.1.1复制文件cp
介绍Linux中文件管理相关的命令。
的正文中详细介绍。
本附录的目的是通过示例的方式演示Linux的一些常用命令，与运维相关的高级命令则在本书
系统的目录结构，并且掌握常用的命令，以便进行文件操作、信息查看和系统参数配置等操作。
[root@Centos conf]# 1l nginx.conf nginx.conf.20150412 backup
【示例A-1】
cp命令用来复制文件或目录。当复制多个文件时，目标文件参数必须为已经存在的目录。
#以下为演示cP的用法
文件是Linux的基本组成部分，文件管理包括文件的复制、删除、修改等操作。本节主要
#当使用cP命令复制单个文件时，第1个参数表示源文件，第2个参数表示目标文件
Linux操作和Windows操作有很大的不同。要熟练地使用Linux系统，首先要了解Linux
nginx.conf' ->backup/nginx.conf
复制多个文件
rootecentos conf]# ls -l nginx.conf nginx.
#如需显示执行过程，可以使用以下选项
aginx.conf
[rooteCentos ~]# cd /usr/local/nginx/conf
rw-r
文件管理
Linux常用命分示例
附录A
.conf.20150412
---
## Page 398
CentOs7系统管理与运维实战
386
total2784
cp:
[gossecentos ]s cp
#复制时保留文件的原始属性
drwxr-xr-x.
total 8
backup/:
#并不复制文件本身，而是创建当前文件的软链接
[rootecentos conf]# cp
[root@centos conf]# cp -i /usr/local/nginx/conf/nginx.conf
drwxr-xr-x. 12 root
X-IX-XME
drwxr-xr-x. 12 goss
total 2792
[rootecentos goss]#
drwxr-xr-x.12 goss
drwxr-xr-x. 12 goss
total2788
drwxr-xr-x.
[gossecentos -]s
drwxr-xr-x.
Igoss@centos ~]s
cp:
cp:
cp:
otal40
rooteCentos nginx]# ls -l
[rootecentos nginx]# cp -r conf conf.20150412
rootecentos nginx]# cp conf conf.bak
复制文件夹
eW-
rw-r-
cannot access
cannot access
—-r--.
WEE
12 goss
12 goss
2root
12 goss
root
root
root root 2685 Apr
Tng
11
LS
/usr/local/nginx/client_body
/usr/local/nginx/scgi_temp': Permission denied
/usr/local/nginx/fastcgi_temp':Permission denied
/usr/local/nginx/uwsgi_temp':Permission denied
root
goss
goss
S
goss
cp
goss
goss
-1
root 4096
-a nginx/ nginx.bak
一1
E
4096
4096Apr 1220:35 nginx.root
4096 Apr
4096 Apr 12 20:33 nginx.bak
4096 Apr 12 20:33 nginx
4096 Apr
6 Apr 12 20:33 conf.20150412
Apr
1220:33 nginx
temp':Permission denied
Permission denied
---
## Page 399
将各参数指定的文件或目录移动到此目录中，如果目的文件存在时，将会进行覆盖。
当mv接收两个参数或多个参数时，如果最后一个参数对应的是目录而且该目录存在，mv会
名。mv只接收两个参数，第1个为要移动或重命名的文件或目录，第2个为新文件名或目录。
A.1.2
#示
否则会提示错误。如果忽略提示信息则可以使用“-f”选项。
用户可以使用mV命令来移动文件或目录至另一文件或目录，还可以将目录或文件重命
1181c1834012245d785120e3505ed169 nginx.conf
total 72
30d53ba50698ba789d093eec830d0253nginx.conf
1181c1834012245d785120e3505ed169
nginx.conf
lrwxrwxrwx.1 root root
[root@Centos conf]#/bin/mv -f nginx.conf.20150412 nginx.conf.bak
#在要覆盖某已有的目标文件时不给任何提示信息
--I--I-MX-
—-I--I-MI-
[root@centos
[root@Centos
-rw-r--r--
total72