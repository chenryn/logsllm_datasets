t
n
e
v
E
P
G
B
0
0
0
0
3
0
0
0
0
2
0
0
0
0
1
0
0
1
2
3
4
5
6
7
Time (days)
Fig. 3. iBGP Updates During a Typical Week (10-17 Feb. 2003)
284
S. Agarwal et al.
)
g
v
a
i
n
m
5
(
%
d
a
o
L
U
P
C
0
0
1
0
8
0
6
0
4
0
2
0
0
1
2
3
4
5
6
7
Time (days)
Fig. 4. CPU Load During a Typical Week (10-17 Feb. 2003)
F
C
C
4
.
0
2
.
0
0
0
.
2
.
0
−
.
4
0
−
−10
−5
0
Lag
5
10
Fig. 5. CCF for 2 Hours Around Event A
This behavior we observe is typical across other routers and during other time periods.
On average, the cross correlation is below 0.15. In some instances, for two hour periods
around speciﬁc cases of above average CPU utilization or high BGP activity, the cross
correlation is around 0.5. However, in none of these instances have we observed both
high (signiﬁcantly above average) CPU load and high BGP activity.
3.4 Abnormal Network Conditions
We now focus on abnormal network conditions. Around 05:30 UTC on 25 January 2003,
the Sapphire/Slammer SQL worm attacked various end hosts on the Internet. While
routers were not targeted, the additional trafﬁc generated by the attack caused various
links on the Internet to get saturated. This caused router adjacencies to be lost due to
congestion, resulting in a withdrawal of BGP routes. These withdrawals propagated
across the Internet. Upon withdrawal of these routes, congestion would no longer occur
on these links and BGP sessions would be restored, causing BGP routes to be re-added.
This cycle repeated until ﬁlters were applied to drop the attack trafﬁc. As a result, in
Figure 7, we see a signiﬁcant amount of BGP trafﬁc. While the peak value of about
20, 000 route changes in a 5 minute window is not signiﬁcant compared to the peaks in
Figure 3, the length of time is. This large amount of activity took many hours to abate,
Impact of BGP Dynamics on Router CPU Utilization
285
F
C
C
6
.
0
4
.
0
2
0
.
0
.
0
4
.
0
−
−10
−5
0
Lag
5
10
Fig. 6. CCF for 2 Hours Around Event B
instead of just a several minute spike. While this graph shows the number of changes
at a particular router in the Sprint network, all routers that we have BGP data from
experienced similar activity.
We correlate this time series with the CPU load percentage for the same router.Across
the 65 hour period, there is a correlation of 0.5 around time lag of 0 to 5 minutes. When
we focus on 12 hours before and 12 hours after the start of the attack, we see a stronger
correlation of 0.6. For a period of 30 minutes before and 30 minutes after the event in
Figure 8, a maximum correlation of 0.7 is observed. We plot the maximum correlation
between BGP changes and CPU load across all 196 routers that we have access to as a
histogram in Figure 9. We see that most routers had a correlation of over 0.5 during this
abnormal event.
However, even with a strong correlation, we need to consider the magnitude of the
impact on the router CPU load. In Figure 10, we show a histogram of the increase in CPU
load during the 65 hour period that we consider across the 196 routers. The value that
we show is the difference between the lowest CPU load and highest CPU load that each
router experienced during the 3 day period. We see that despite the strong correlation,
for most routers, there was less than a 20% increase in the router CPU load. In Figure 11
)
s
e
t
i
u
n
m
5
(
s
t
n
e
v
E
0
0
0
5
1
0
0
0
5
0
0
10
20
30
40
50
60
Time (hours)
Fig. 7. iBGP Updates During the SQL Worm Attack (24-26 Jan. 2003)
286
S. Agarwal et al.
F
C
C
6
.
0
2
.
0
2
.
0
−
6
.
0
−
−6
−4
−2
2
4
6
0
Lag
Fig. 8. CCF During the SQL Worm Attack (24-26 Jan. 2003), One Hour Around Event
s
r
e
t
u
o
R
f
o
#
0
5
0
4
0
3
0
2
0
1
0
0.2
0.4
0.6
0.8
1.0
CCF
Fig. 9. Max. CCF During the SQL Worm Attack (24-26 Jan. 2003), 1 Hour Around Event
s
r
e
t
u
o
R
f
o
#
0
8
0
6
0
4
0
2
0
10
20
30
40
50
60
CPU Load % Shift
Fig. 10. CPU Utilization Increase During the SQL Worm Attack (24-26 Jan. 2003)
we show the histogram of the highest CPU utilization experienced by each router at any
time during the 3 day period. We see that in most cases, the maximum load was below
50%. A few outliers above 50% exist in the data set, but manual inspection revealed that
these few routers underwent scheduled maintenance during the increase in CPU load.
Impact of BGP Dynamics on Router CPU Utilization
287
t
s
r
e
u
o
R
f
o
#
0
7
0
5
0
3
0
1
0
20
40
60
80
CPU Load %
Fig. 11. Maximum CPU Utilization During the SQL Worm Attack (24-26 Jan. 2003)
4 Conclusions
Router CPU load is a signiﬁcant concern in the operation of an ISP. Long periods of high
CPU load can increase route convergence times, and has some correlation with router
instability. The BGP routing protocol has a potential for signiﬁcantly impacting CPU
load due to the nature of the protocol. Several actions need to be taken upon receiving a
route announcement, and on average more route announcements are seen by an ISP today
than ever before. In this study, we examine the impact of BGP activity on operational
routers in the Sprint IP network.
We ﬁnd that on average, BGP processes tend to consume over 60% of a router’s non-
idle CPU cycles. During short time scales (5 seconds), we have observed BGP processes
contributing almost 100% CPU load. During longer time scales (1 − 5 minutes), we
see a weaker correlation. During normal network operation, we ﬁnd that there is some
correlation between increased BGP activity and router CPU load, but the impact is small.
During an abnormal network event that lasted over 10 hours, we ﬁnd a correlation.
However, the increase in CPU load was under 20% for most routers.
BGP processes tend to run frequently for very short intervals, during which the
CPU can reach the maximum utilization. Due to this, BGP consumes the majority of
CPU cycles over a very long period of time (weeks). The quantity of BGP messages
received during a particular cycle can increase the CPU load. However, this increase
is not consistently large enough to cause concern about the operation of the router. A
possibility is that certain kinds of BGP messages may increase the load more than others.
However, without a detailed understanding of the speciﬁc implementation of BGP in
these routers, we cannot speculate on such speciﬁc behavior.
Thus we conclude that during normal operation, CPU load is not signiﬁcantly im-
pacted by BGP activity in the time scale of minutes. Short term impact in the time scale
of seconds in not likely to signiﬁcantly impact convergence times or router stability.
During abnormal events of the magnitude of the SQL Slammer worm, router CPU is not
likely to increase signiﬁcantly.
288
S. Agarwal et al.
References
1. Stewart, J.W.: BGP4: Inter-Domain Routing in the Internet. Addison-Wesley (1998)
2. Huston, G.: Analyzing the Internet’s BGP Routing Table. Cisco Internet Protocol Journal
(2001)
3. Bu, T., Gao, L., Towsley, D.: On routing table growth. In: Proc. IEEE Global Internet Sympo-
sium. (2002)
4. Halabi, S., McPherson, D.: Internet Routing Architectures. Second edn. Cisco Press (2001)
5. Cowie, J., Ogielski, A., Premore, B., Yuan, Y.: Global Routing Instabilities during Code Red
II and Nimda Worm Propagation. Draft paper (2001)
6. Wang, L., Zhao, X., Pei, D., Bush, R., Massey, D., Mankin,A., Wu, S.F., Zhang, L.: Observation
and analysis of BGP behavior under stress. In: Proc. Internet Measurement Workshop. (2002)
7. Bollapragada, V., Murphy, C., White, R.: Inside Cisco IOS Software Architecture. Cisco Press
(2000)