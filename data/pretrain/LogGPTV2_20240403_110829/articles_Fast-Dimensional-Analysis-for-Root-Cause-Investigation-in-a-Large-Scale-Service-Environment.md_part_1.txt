Fast Dimensional Analysis for Root Cause Investigation in a
Large-Scale Service Environment
FREDLIN,Facebook,Inc.
KEYURMUZUMDAR,Facebook,Inc.
NIKOLAYPAVLOVICHLAPTEV,Facebook,Inc.
MIHAI-VALENTINCURELEA,Facebook,Inc.
SEUNGHAKLEE,Facebook,Inc.
SRIRAMSANKAR,Facebook,Inc.
Rootcauseanalysisinalarge-scaleproductionenvironmentischallengingduetothecomplexityofservices
runningacrossglobaldatacenters.Duetothedistributednatureofalarge-scalesystem,thevarioushardware,
software,andtoolinglogsareoftenmaintainedseparately,makingitdifficulttoreviewthelogsjointlyfor
understandingproductionissues.Anotherchallengeinreviewingthelogsforidentifyingissuesisthescale-
therecouldeasilybemillionsofentities,eachdescribedbyhundredsoffeatures.Inthispaperwepresenta
fastdimensionalanalysisframeworkthatautomatestherootcauseanalysisonstructuredlogswithimproved
scalability.
Wefirstexploreitem-sets,i.e.combinationsoffeaturevalues,thatcouldidentifygroupsofsampleswith
sufficientsupportforthetargetfailuresusingtheApriorialgorithmandasubsequentimprovement,FP-Growth.
Thesealgorithmsweredesignedforfrequentitem-setminingandassociationrulelearningovertransactional
databases.Afterapplyingthemonstructuredlogs,weselecttheitem-setsthataremostuniquetothetarget
failuresbasedonlift.Weproposepre-processingstepswiththeuseofalarge-scalereal-timedatabaseand
post-processingtechniquesandparallelismtofurtherspeeduptheanalysisandimproveinterpretability,
anddemonstratethatsuchoptimizationisnecessaryforhandlinglarge-scaleproductiondatasets.Wehave
successfullyrolledoutthisapproachforrootcauseinvestigationpurposesinalarge-scaleinfrastructure.We
alsopresentthesetupandresultsfrommultipleproductionusecasesinthispaper.
CCSConcepts:•Informationsystems→Associationrules;Collaborativefiltering;•Computingmethod-
ologies→Featureselection;•Computersystemsorganization→Reliability;Maintainabilityand
maintenance;•Softwareanditsengineering→Softwaremaintenancetools;Softwaresystemmodels;
•Securityandprivacy→Intrusiondetectionsystems.
AdditionalKeyWordsandPhrases:rootcauseanalysis;anomalydetection;dimensioncorrelationanalysis;
investigationanalysis;large-scaleserviceenvironment
ACMReferenceFormat:
FredLin,KeyurMuzumdar,NikolayPavlovichLaptev,Mihai-ValentinCurelea,SeunghakLee,andSriram
Sankar.2020.FastDimensionalAnalysisforRootCauseInvestigationinaLarge-ScaleServiceEnvironment.
Proc.ACMMeas.Anal.Comput.Syst.4,2,Article31(June2020),24pages.https://doi.org/10.1145/3392149
Authors’addresses:FredLin,Facebook,PI:EMAIL;KeyurMuzumdar,Facebook,PI:EMAIL;Nikolay
PavlovichLaptev,Facebook,PI:EMAIL;Mihai-ValentinCurelea,Facebook,PI:EMAIL;SeunghakLee,
Facebook,PI:EMAIL;SriramSankar,Facebook,Inc.sriramsankar@fb.com.
Permissiontomakedigitalorhardcopiesofallorpartofthisworkforpersonalorclassroomuseisgrantedwithoutfee
31
providedthatcopiesarenotmadeordistributedforprofitorcommercialadvantageandthatcopiesbearthisnoticeand
thefullcitationonthefirstpage.CopyrightsforcomponentsofthisworkownedbyothersthanACMmustbehonored.
Abstractingwithcreditispermitted.Tocopyotherwise,orrepublish,topostonserversortoredistributetolists,requires
priorspecificpermissionand/orafee.Requestpermissionsfrompermissions@acm.org.
©2020AssociationforComputingMachinery.
2476-1249/2020/6-ART31$15.00
https://doi.org/10.1145/3392149
Proc.ACMMeas.Anal.Comput.Syst.,Vol.4,No.2,Article31.Publicationdate:June2020.
31:2 Lin,etal.
1 INTRODUCTION
CompaniesrunningInternetserviceshavebeeninvestinginautonomoussystemsformanaging
largescaleservices,forbetterefficiencyandscalability[12].AssomeoftheInternetserviceshave
becomeutilitiesthatthepublicreliesonfortransportation,communication,disasterresponse,etc.,
thereliabilityoftheinfrastructureisnowemphasizedmorethanbefore.Therearevariouslogsthat
thesesystemsrecordandactupon.Thelogsrecordeventsandconfigurationsaboutthehardware,
theservices,andtheautomatedtooling,whichareimportantinmeasuringtheperformanceofthe
systemandtracingspecificissues.Giventhedistributednatureandthescaleofamodernservice
environment,itischallengingtofindandmonitorpatternsfromthelogs,becauseofthescaleand
thecomplexityofthelogs-eachcomponentinthesystemcouldrecordmillionsofentitiesthat
aredescribedbyhundredsoffeatures.AnautomatedRCA(RootCauseAnalysis)toolistherefore
neededforanalyzingthelogsatscaleandfindingstrongassociationstospecificfailuremodes.
Traditional supervised machine learning methods such as logistic regression are often not
interpretableandrequiremanualfeatureengineering,makingthemimpracticalforthisproblem.
Castelluccioetal.proposedtouseSTUCCO,atree-basedalgorithmforcontrastsetmining[4]for
analyzingsoftwarecrashreports[11].However,thepruningprocessinSTUCCOcouldpotentially
dropimportantassociations,asillustratedinSection3.7.
In this paper, we explain how we modified the classical frequent pattern mining approach,
Apriori [2],tohandleourrootcauseinvestigationusecaseatscale.WhileApriorihasbeenan
important algorithm historically, it suffers from a number of inefficiencies such as its runtime
andtheexpensivecandidategenerationprocess.Thetimeandspacecomplexityofthealgorithm
are exponentialO(2D) where D is the total number of items, i.e. feature values, and therefore
it is practical only for datasets that can fit in memory. Furthermore, the candidate generation
process creates a large number of item-sets, i.e. combinations of feature values, and scans the
datasetmultipletimesleadingtofurtherperformanceloss.Forthesereasons,FP-Growthhasbeen
introducedwhichsignificantlyimprovesonApriori’sefficiency.
FP-Growthisamoreefficientalgorithmforfrequentitem-setgeneration[13].Usingthedivide-
and-conquerstrategyandaspecialfrequentitem-setdatastructurecalledFP-Tree,FP-Growthskips
thecandidategenerationprocessentirely,makingthealgorithmmorescalableandapplicableto
datasetsthatcannotfitinmemory.AsweshowintheexperimentalresultsinSection4,FP-Growth
canbe50%fasterthanaparallelizedAprioriimplementationwhenthenumberofitem-setsislarge.
WhileFP-GrowthissignificantlymoreefficientthanApriori,someproductiondatasetsinlarge-
scaleserviceenvironmentsarestilltoolargeforFP-Growthtominealltheitem-setsquicklyfor
time-sensitivedebugging.ThehugeamountofdatacouldalsobecomeablockerformemoryIOor
thetransferbetweenthedatabaseandlocalmachinesthatrunFP-Growth.Tofurtherspeedupthe
analysis,weuseScuba[1],ascalablein-memorydatabasewheremanylogsarestoredandaccessed
inreal-time.Asmanyrecordedeventsintheproductionlogsareidenticalexceptfortheunique
identifierssuchastimestampsandjobIDs,wepre-aggregatetheeventsusingScuba’sinfrastructure
beforequeryingthemfortherootcauseanalysis.Thepre-aggregationstepsavesruntimeand
memoryusagesignificantly,andisnecessaryforenablingautomaticRCAonproductiondatasets
atthisscale.
Theframeworkletsusersspecifyirrelevantfeatures,i.e.columns,inthestructuredlogtobe
excludedforavoidingunnecessaryoperations,therebyoptimizingtheperformance.Userscan
also specify the support and lift of the analysis for achieving the desired tradeoff between the
granularityoftheanalysisandtheruntime.Forexample,afasterandlessgranularresultisneeded
formissioncriticalissuesthatneedtoremediatedimmediately;andmorethoroughresultsfroma
slowerrunareusefulforlong-termanalysesthatarelesssensitivetotheruntime.Parallelismand
Proc.ACMMeas.Anal.Comput.Syst.,Vol.4,No.2,Article31.Publicationdate:June2020.
FastDimensionalAnalysisforRootCauseInvestigation 31:3
automaticfilteringofirrelevantcolumnsarealsofeaturesforachievingbetterefficiency,whichwe
discussinSection3.5.
Withtheaboveoptimizations,wehaveproductionizedafastdimensionalanalysisframework
forthestructuredlogsinalarge-scaleinfrastructure.Thefastdimensionalanalysisframework
hasfoundvariousassociationrulesbasedonstructuredlogsindifferentapplications,wherethe
associationrulesrevealhiddenproductionissuessuchasanomalousbehaviorsinspecifichardware
andsoftwareconfigurations,problematickernelversionsleadingtofailuresinauto-remediations,
andabnormaltierconfigurationsthatledtoanunexpectedlyhighnumberofexceptionsinservices.
Therestofthepaperisorganizedasfollows:Wediscusstherequirementsofalarge-scaleservice
environment,theadvantageoflogginginastructuredformat,thetypicalRCAflowinSection2.
WeillustratetheproposedframeworkinSection3.Wedemonstratetheexperimentalresultsin
Section4,andtheapplicationsonlarge-scaleproductionlogsinSection5.Section6concludesthe
paperwithadiscussiononfuturework.
2 ROOTCAUSEANALYSISINALARGE-SCALESERVICEENVIRONMENT
2.1 ArchitectureofaLarge-ScaleServiceEnvironment
LargescaleservicecompanieslikeGoogle,Microsoft,andFacebookhavebeeninvestingindata
centerstoservegloballydistributedcustomers.Theseinfrastructurestypicallyhavehigherserver-
to-administratorratioandfaulttoleranceasaresultoftheautomationthatisrequiredforrunning
theservicesatscale,andtheflexibilitytoscaleout overalargenumberoflow-costhardwares
insteadofscalingupoverasmallersetofcostlymachines[12].Twoimportantpartsforkeeping
suchlarge-scalesystemsathighutilizationandavailabilityareresourceschedulingandfailure
recovery.
Resourceschedulingmainlyfocusesonoptimizingtheutilizationoveralargesetofheterogeneous
machineswithsufficientfaulttolerance.Variousdesignsofresourceschedulinghavebeenwell-
documentedinliterature,suchasBorgfromGoogle[24],ApollofromMicrosoft[9],Tupperware
fromFacebook[29],FuxifromAlibaba[32],ApacheMesos[15]andYARN[23].
The ultimate goal for a failure recovery system is to maintain the fleet of machines at high
availabilityforservingapplications.Timelyfailuredetectionandrootcauseanalysis(RCA),fastand
effectiveremediation,andpropersparepartplanningaresomeofthekeysforrunningthemachines
athighavailability.Whilephysicalrepairsstillneedtobecarriedoutbyfieldengineers,mostparts
inalarge-scalefailurerecoverysystemhavebeenfullyautomatedtomeettherequirementsfor
highavailability.ExamplesofthefailurehandlingsystemsareAutopilotfromMicrosoft[16]and
FBARfromFacebook[17].
2.2 LogsinaLarge-ScaleSystem
Properloggingiskeytoeffectivelyoptimizingandmaintainingalarge-scalesystem.Inaservice
environmentcomposedofheterogeneoussystems,logscomefromthreemajorsources:
• Software - The logs populated from the services running on the servers are critical for
debuggingjobfailures.Jobqueuetimesandexecutiontimesarealsoessentialforoptimizing
theschedulingsystem.Typicallyprogramdevelopershavefullcontrolinhowandwherethe
eventsshouldbelogged.Sometimesaprogramfailureneedstobeinvestigatedtogetherwith
thekernelmessagesreportedontheserver,e.g.outofmemoryorkernelpanic.
• Hardware - Hardware telemetries such as temperature, humidity, and hard drive or fan
spinningspeed,arecollectedthroughsensorsinandaroundthemachines.Hardwarefailures
are logged on the server, e.g. System Event Log (SEL) and kernel messages (dmesg). The
hardwareandfirmwareconfigurationsofthemachinearealsocriticalindebugginghardware
Proc.ACMMeas.Anal.Comput.Syst.,Vol.4,No.2,Article31.Publicationdate:June2020.
31:4 Lin,etal.
issues,e.g.theversionofthekernelandthefirmwaresrunningondifferentcomponents.The
messagesontheserversneedtobepolledatanappropriatefrequencyandgranularitythat
strikesabalancebetweentheperformanceoverheadontheserversandourabilitytodetect
thefailurestimelyandaccurately.
• Tooling - As most of the parts in the large-scale system are automated, it is important
to monitor the tools that orchestrate the operations. Schedulers would log the resource
allocationsandjobdistributionresults.Failurerecoverysystemswouldlogthefailuresignals
andtheremediationstatus.Historicaltoolinglogsareimportantforanalyzingthetooling
efficiency.
Forrootcauseanalysisinreal-time,thelogsarepushedtoScuba,a“fast,scalable,distributed,
in-memorydatabase.”[1]Keepingthedatain-memory,Scubatablestypicallyhaveshorterretention.
Forlong-termanalytics,logsarearchivedindisk-basedsystemssuchasHDFS[8],whichcanbe
queriedbyHive[21]andPresto[22].Someofthemoredetailedoperationaldatacanbefetched
fromtheback-endMySQLdatabases[19]toenrichthedatasetfortheanalysis.Thequalityofthe
logshasfundamentalimpactsontheinformationwecanextract.Wewilldiscusstheadvantagesof
structuredlogginginSection3.2.
2.3 PriorRootCauseAnalysisWork
Rootcauseanalysis(RCA)isasystematicprocessforidentifyingtherootcausesofspecificevents,e.g.
systemfailures.RCAhelpspinpointcontributingfactorstoaproblemortoanevent.Forexample,
RCAmayinvolveidentifyingaspecificcombinationofhardwareandsoftwareconfigurationsthat
arehighlycorrelatedtounsuccessfulserverreboots(discussedinSection5.1),andidentifyingaset
ofcharacteristicsofasoftwarejobthatarecorrelatedtosometypesofjobexceptions(discussedin
Section5.3).
Duringanincidentinalarge-scalesystem,theoncallengineerstypicallyinvestigatetheunder-
lyingreasonforasystemfailurebyexploringtherelevantdatasets.Thesedatasetsarecomprised
of tables with numerous columns and rows, and often the oncall engineers would try to find
aggregationsoftherowsbythecolumnvaluesandcorrelatethemwiththeerrorrates.However,a
naiveaggregationscalespoorlyduetothesignificantamountoftherowsanddistinctvaluesinthe
columns,whichresultinahugeamountofgroupstobeexamined.
ForautomatingRCA,theSTUCCOalgorithmhasbeenusedforcontrastsetmining[4,5,11].
Suriadietal.[20]demonstratedanRCAapproachusingdecisiontree-basedclassificationsfrom
theWEKApackage[27],aswellasenrichingthedatasetwithadditionalfeatures.Thetraditional
STUCCOalgorithm,however,canmissimportantassociationsifoneoftheitemsdoesnotmeet
thepruningthresholdonthe χ2value,asexplainedinSection3.7.Decisiontree-basedapproaches,
whileprovidingthevisibilityinhowthefeaturesareusedtoconstructthenodes,becomeharder
totuneandinterpretasthenumberoftreesgrows.Toensurewecapturetheassociationsthat
arerelativelysmallinpopulationyetstronglycorrelatedtoourtarget,wechoosetoexploreall
association rules first with additional filtering based on support and lift as post-processing, as
illustratedinSection3.6.
Inassociationrulemining,FP-Growth[13]hasbecomethecommonapproachastheclassical
Apriorialgorithm[2]suffersfromitshighcomplexity.Thestate-of-the-artapproachesforlog-based
rootcauseanalysisfoundinliteratureoftenhavesmall-dataexperiments,donothandleredundant
item-setswithpre-/post-processingandfailtofindrootcauseswithsmallerrorratesrelativeto
successes.Forexample,whiletheauthorsin[30]provideapre-processingstepforpre-computing
theassociationmatrixforspeedingupassociationrulemining,itlacksthestudyoflargescale
applicability and the filtering of small error classes (see Figure 5 and Section 4.2 for how the
Proc.ACMMeas.Anal.Comput.Syst.,Vol.4,No.2,Article31.Publicationdate:June2020.
FastDimensionalAnalysisforRootCauseInvestigation 31:5
proposedfastdimensionalanalysisframeworkaddressesthesepoints).Similarly,theauthorsin
[3]provideahybridapproachforspamdetectionusingaNaiveBayesmodelwithFP-Growthto
achieve betterspam-detectionaccuracy butwitha decreasedinterpretability because onlythe
predictionisprovidedandnottheroot-cause.Inourusecase,however,havinganexplainable
modeliscritical(seeSection4.2)andwearebiasedawayfromcompromisesininterpretability.
AnFP-GrowthimplementationonSparkplatformwasproposedin[18],andanextensionfor
FP-Growthtohandlenegativeassociationrules[28]wasproposedin[25].Forbetterinterpretability,
Bittmannetal.proposedtoremoveubiquitousitemsfromtheitem-setsusinglift [6],whereas
Liuetal.usedlifttofurtherprunetheminedassociationrulesfromFP-Growth[18].
Forsustainingthelarge-scaleserviceenvironmentathighavailabilityallthetime,weneedan
analysisframeworkthatcanhandlelarge-scaleproductiondatasets,e.g.billionsofentriesperday,
andgenerateresultinnearreal-time,e.g.secondstominutes.Inthispaperweproposeaframework
thatpre-aggregatesdatatoreducedatasizeby>500X usinganin-memorydatabase[1],mines
frequent item-sets using a modified version of FP-Growth algorithm, and filters the identified
frequentitem-setsusingsupportandliftforbetterinterpretability.Wevalidatetheframeworkon
multiplelarge-scaleproductiondatasetsfromaserviceenvironment,whereastherelatedpapers