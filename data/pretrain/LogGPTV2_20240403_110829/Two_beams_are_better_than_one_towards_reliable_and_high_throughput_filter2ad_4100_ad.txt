then the effective multi-beam channel can be expressed as:
ℎeff =
𝛼𝑘𝛿(𝑡 − 𝜏𝑘),
ℎeff[𝑛] =
(18)
where 𝛼𝑘 is a function of the transmitter and receiver beam pattern,
while 𝛿𝑘 relates to the Time of Flight (ToF) of each multi-beam
channel path. Recall that our goal is to estimate the individual 𝛼𝑘
for each beam (𝑘 = 1, . . . , 𝐾).
For a frequency-selective wideband system the received signal
is sampled at sampling rate and sinc interpolated due to limited
bandwidth as follows:
𝛼𝑘sinc(cid:0)𝐵(𝑛𝑇𝑠 − 𝜏𝑘)(cid:1)

𝑘
(19)
where 𝐵 is the bandwidth, 𝑇𝑠 is the sampling rate of the receiver,
and 𝛼𝑘 is total signal attenuation along path 𝑘.
∥hCIR − S𝛼∥2 + 𝜆∥𝛼∥2
We can re-write the above formulation as an optimization prob-
lem where our objective is to find 𝛼𝑘 such that it fits the channel
best. Let say the collected CIR is represented by column vector hCIR.
We solve the following optimization to extract 𝛼 = [𝛼1𝛼2 . . . 𝛼𝐾]𝑇 ,
which amplitude per beam.
𝛼𝑒𝑠𝑡 = arg min𝛼
(20)
where the matrix S consists of all the ToF. We are essentially solving
a super-resolution problem by fitting a sinc model over the entire
CIR response. The optimization is a convex formulation, with L2
norm regularization. We use standard techniques [50, 51] to solve
this problem in 100𝜇s. Here, we make a key observation that, after
training, the absolute ToF may have changed, but the relative ToF
changes slowly. Our key idea is that we shift the hCIR first so that
the strongest path is shifted to zero delays and since we know
relative to the first path, the delay of the second and third path.
We can populate the S matrix with only a few columns, thereby
achieving accurate and reliable solutions to 𝛼𝑘. We account for
small variations in relative-ToF by trying few values around the
initial value that best fits our model. In summary, we have built
(a) User mobility w.r.t.gNB(b) User mobility w.r.t.virtual gNBMobile UEgNBstatic 𝜑1𝜑2𝑡=𝑡0𝑡=0Mobile UEgNBstatic Virtual gNB𝜑1𝜑2𝑡=𝑡0𝑡=0051015RelativeToF(ns)10-610-410-2100MSEofpowerestimatew/o super-resolutionw/ super-resolution(a)020406080100Time (ns)(b)-60-50-40-30-20CIR(dB)MeasuredRecovered Sinc1Recovered Sinc2SIGCOMM ’21, August 23–27, 2021, Virtual Event, USA
IK Jain, R.Subbaraman, D.Bharadia
Figure 9: Demonstrating beam misalignment for a multi-beam UE.
an accurate super-resolution algorithm by leveraging the initial
relative-ToF information between the multi-beams.
■ Efficiency of super-resolution algorithm: In Fig. 8(a), we
show that our super-resolution algorithm can indeed achieve high
resolution in estimating per-beam amplitude even when the relative
ToF is lower than what corresponds to the resolution (2.5 ns for 400
MHz bandwidth). We also measure the channel impulse response
through our testbed (6m link with a reflector placed at 30o) in Fig.
8(b) and show that our super-resolution can efficiently extract the
two sinc which are superimposed in the received CIR.
4.4 Generalization to Multi-beam UE
So far we developed mmReliable for a quasi-omni beam pattern
at the user equipment (UE). Directional beams may be required
at the UE side when the SNR is low, e.g., for longer outdoor links.
mmReliable extends naturally to the scenarios where the UEs also
have directional beams. In order to do so, mmReliable utilizes the
design concepts discussed before, like super-resolution, proactive
tracking to mitigate the multi beam link against outages due to
mobility, thus addressing the new system level challenges posed by
directional UEs.
The main challenge posed by a directional UE is misalignments
on both the UE and gNB side due to UE mobility. Consider the
scenario in Fig. 9 (a), in which because of UE moving from t=0 to t=𝑡0,
the two beams at the gNB are misaligned by 𝜑1, 𝜑2 angle differences
respectively. We see a similar misalignment at the UE side as well.
If the UE and gNB were able to estimate these misalignment angles,
they could compensate for the UE mobility by realigning the beams
𝑎1, 𝑏1 and moving them 𝜑1,−𝜑1 respectively, and 𝑎2, 𝑏2 will be
realigned by −𝜑2, 𝜑2 respectively. Along with estimation of 𝜑1, 𝜑2,
this step also requires association of beams 𝑎1, 𝑏1 and 𝑎2, 𝑏2, since
there could be fallacious solutions by associating 𝑎1, 𝑏2 or 𝑎2, 𝑏1
together. Hence, handling UE mobility involves solving the two step
problem, by first correctly associating one multi beam to the other,
and then estimating the misalignment angles. The first problem
follows as a corollary of our super-resolution algorithm, which
allows to resolve the per path CIR, and by utilizing the unicity of
ToF, we can associate two per path CIRs and hence associate the
two beams which are along these respective paths.
In order to mitigate against the misalignments due to user mo-
bility, mmReliable needs to repeatedly estimate and compensate
for the misalignment angles. For estimation of the misalignment
angles, we develop individual models for tracking translation and
rotation similar to our approach in Eq. (16). The rotation of UE
beam causes changes in UE antenna gain from which we can es-
timate the angle of rotation using a inverse function (Fig. 9). The
translation case causes changes in both the gNB’s and UE’s antenna
gain. The received power in this case will be the sum of the two
antenna gains. To estimate the angle in this case, we leverage our
observation that the beams at gNB and the UE gets misaligned by
the same angle (Fig. 9). We estimate this angle by inverting the sum
of the beam pattern at gNB and UE. In this way, we track the user
motion and proactively refine the beams.
5 Implementation
We use a custom 28 GHz mmWave testbed to evaluate the per-
formance of mmReliable. Our testbed consists of two major com-
ponents as shown in Fig. 10(a): (i) an 8×8 mmWave phased array
(PA) with real-time beamforming, and (ii) a baseband module that
generates and processes standard-compliant OFDM waveforms. For
more details on the architectural choices and performance of our
testbed, we refer the reader to [31]. In this section, we describe
components relevant to this work in greater detail.
5.1 Phased Array and beamforming
Our 8×8 Phased Array has only one RF chain and is designed in-
house [31, 52, 53]. It features an integrated up-down converter that
operates with an IF frequency of 3.5 GHz. The array is capable
of 2 GHz bandwidth centered at 28 GHz and includes amplifiers,
image-reject filters in both transmit and receive directions. We use
only the azimuth for beamforming and set all the weights along
the elevation to the same value. We use a Cinetics Axis-360 [54]
gantry system to precisely move the array for our evaluations.
■ Beamforming Control: Inspired by state-of-the-art design [55],
we use an Artix-7 FPGA [56] with custom Verilog modules to pro-
gram the phased array with high speed (100 us per beam) and ac-
curate timing over an SPI bus. In practical systems, beam-weights
that span a limited set of angular directions (typically numbering
64-1024) are programmed into the memory of the FPGA device [14].
Multi-beams require beam-specific amplitude and phase in addi-
tion to angular directions, and storing all possible combinations in
memory could be intractable. Since multi-beams are linear sums of
single-beam-weights, they can be generated using simple addition
and multiplication operations on the FPGA. It would allow the fast
creation of multi-beam weights while requiring storage of only
single-beam weights.
■ Beam Weight Quantization: Phase-coherent multi-beam pat-
terns can be generated using minimum 2-bit phase shifters and 1-bit
amplitude control (turning antenna on or off) [14, 57, 58] which
is available in commercial 802.11ad devices [49, 59, 60] as well as
28 GHz 5G NR [61, 62]. Having higher resolution in phase and am-
plitude control helps create accurate single-beam and multi-beam
patterns that reflect mathematical models. Our array provides 6
bits of phase control and 27 dB of gain control per antenna element
similar to commercial products [55, 61, 62]3. Fig. 10(d) shows that
our phased arrays generate accurate multi-beam patterns.
5.2 Baseband module and 5G-NR compliance
Fig. 10(d) Shown in Fig. 10(a), we use a 1 GSPs ADC/DAC in conjunc-
tion with a KCU-105 FPGA [65, 66] for creating 400 MHz baseband
OFDM waveforms. We use an off-the-shelf IF mixer [67] to up/down-
convert to the IF frequency of 3.5 GHz. For outdoor experiments
(Fig. 10(c)), we use a compact setup with a USRP X300 (100 MHz
bandwidth) [31]. A host PC running MATLAB controls waveform
3Verizon, Ericsson, & other commercial vendors deploy high-resolution 28 GHz phased
arrays developed by Samsung, IBM & others [63, 64]
495
gNB(stac)VirtualgNBReﬂectorUE (mobile)𝜑1𝜑2𝜑2𝜑1t=0t=𝑡0gNB(stac)ReﬂectorUE (rotang)𝜑2=𝜑1𝜑1(a) User Translaon(b) UserRotaon𝑎2𝑎1𝑎1𝑎2𝑏2𝑏1𝑏1𝑏2Towards Reliable and High Throughput mmWave Links
SIGCOMM ’21, August 23–27, 2021, Virtual Event, USA
Figure 10: (a) Our experimental testbed with FPGA baseband and 64 element phased array [31], (b) indoor 5m and (c) outdoor 80m test scenarios.
Our phased array is mounted on a gantry system which provides precise translation and rotation measurements used as ground truth. (d)
Comparison of multi-beam patterns from theoretical analysis and our measurements.
generation, post-processing, and beamforming. We synchronize
the array’s clock with that of the baseband module to switch beams
at intervals with an accuracy of < 0.1𝜇𝑠.
■ 5G-NR Compliance: To ensure that mmReliable is compatible
with 5G NR standards, we use OFDM waveforms with an effective
bandwidth of 400 MHz or 100 MHz and numerology that yields
120 kHz sub-carrier spacing [1, 68]. The beam-training phase in
5G-NR is performed using channel estimates from Synchroniza-
tion Signal Block (SSB), which repeats with a default period of 20
ms [69, TS 38.215]. mmReliable leverages channel estimates from
the Channel State Information Reference Signal (CSI-RS) [69, TS
38.215] for beam-maintenance. CSI-RS can be sent arbitrarily with
a spacing ranging from 0.5 ms to 80 ms. A CSI-RS occupies only
one symbol (8.93𝜇s@120 kHz) in the slot and only a few frequency
subcarriers [69, TS 38.211], contributing much less overhead than
an SSB. For example, by using only one CSI-RS symbol every 20
ms for beam-maintenance, we incur an overhead of less than 0.04%.
While beam-training cannot be avoided altogether, the maintenance
scheme can reduce its periodicity. If the periodicity of a 5 ms long
SSB can be extended to 1 second, then the overhead of the entire
beam-maintenance process is 0.5% of channel air time. During post-
processing, we use channel estimates only at standard specified
intervals to evaluate all algorithms.
6 Evaluation
We evaluate the performance of mmReliable for various indoor
and outdoor settings: a 7𝑚 × 10𝑚 conference room occupied with
wooden furniture, whiteboard, and reflective glass walls (Fig. 10(b))
and an outdoor 30𝑚 − 80𝑚 link next to a large building with glass
walls (Fig. 10(c)). The Tx module of the testbed is used as a fixed
gNB, while the Rx module is movable as a mobile user placed on
a cart. The phased array antenna of the Tx is kept vertical, facing
the user, and parallel to the line of user translation. The precision
gantry setup allows 70 cm linear motion and 360-degree rotation
about its axis accurate to 1 cm and 0.1o, respectively, for controlled
experiments. The Rx phased array mounted on the gantry (see Fig.
10 (a)) moves as a mobile user with 24o/s rotation (typical speed
for VR headset motion [70]) and 1.5m/s translation speed in indoor
scenarios. For outdoor experiments, we manually move the cart to
a predefined trajectory for accurate ground truth information. We
also experiment with natural motion for end-end experiments.
Figure 11: Sensitivity analysis (simulation): SNR gain (dB) of 2-beam
w.r.t. single-beam for varying 2nd beam’s phase ˆ𝜎 and amplitude ˆ𝛿
in multi-beam. We show for a -3 dB weaker multipath channel, the
multi-beam’s highest SNR gain is 1.76 dB which is not very sensitive
even for a high phase error of ±75o. However, if the phase error is
highest (180o), the SNR drops significantly.
and user tracking algorithm to realign the beam patterns in real-
time as the user moves. Our testbed reports the complex channel per
sub-carrier, Signal to Noise Ratio (SNR), and throughput of the wire-
less link as performance metrics similar to others [9, 12, 62, 71, 72].
6.1 Micro Benchmarks
Here we present benchmarks for both constructive multi-beam and
proactive user tracking to characterize our system.
■ Sensitivity Analysis of Multi-Beam: Accurate estimation of
phase and amplitude provides the highest SNR; however, it is not
very sensitive to estimation errors in these parameters. To quantify
the sensitivity, we simulate a two-path channel and set the relative
phase and attenuation to −40o and −3 dB, respectively. We vary
the relative phase and amplitude of the 2nd beam in a 2-beam
pattern (w.r.t. the first beam) and show the 2D plot of SNR gain
in Fig. 11. The highest SNR gain is 1.76 dB for perfect estimation,
which reduces gradually with an increasing mismatch between
channel parameters and their estimations. The multi-beam SNR
exceeds the single-beam SNR and can tolerate errors of ±75o in
phase estimation and amplitude errors of -20 dB.
■ Constructive combining accuracy: We first show the need for
constructive combining in a multi-beam system and then evaluate
the performance of mmReliable’s algorithm for estimating the phase
𝜎 and amplitude 𝛿 needed for constructive combining. We establish
an indoor multi-beam link with two beams towards a static UE at
7 m along a LOS angle of 0◦ and NLOS angle of 30o, respectively.
We set the phase and amplitude of the first beam to be 0 radians, 0
dB, respectively. We then perform an exhaustive scan of the second
beam’s phase in the range [0, 2𝜋] and observe the SNR variations
in Fig. 12(a). We see that the SNR is a maximum of 27 dB with a
minor variation of around 1 dB in the range of ±70◦. Any estimate
in this range would give a high SNR. But, if the phase estimate
is off by 180◦, the SNR degradation could be as significant as 13
We perform multiple experiments of 1-sec duration with mobil-
ity and blockage. At the beginning of each experiment, we perform
beam training to estimate the angle to the user and establish direc-
tional communication. We then run our constructive multi-beam
496
-90-60-300306090-30-20-100-90-60-300306090-30-20-100TheoryMeasuredgNBUEUEgNBBaseband ProcessingControlBoardIF mixerPhasedarray(d) Multi-beam patterns(a) Experiment testbed(b) Indoor scenario(c) Outdoor scenario5m80m-160-120-80-4004080120160Phase (deg)-20-100Amplitude (dB)-4-202SNR gainSIGCOMM ’21, August 23–27, 2021, Virtual Event, USA
IK Jain, R.Subbaraman, D.Bharadia
Figure 12: (a) SNR measurements with different phases of the 2nd beam in our 2-beam pattern, (b) SNR measurements with various amplitudes
of the 2nd beam through brute-force probing. We also show that our constructive multi-beam requires only two probes and provides accurate
phase and amplitude estimates without brute-force scanning. (c) The optimal phase is stable over a frequency range of 100 MHz. (d) SNR gain
of multi-beam against the single beam and oracle (knows the best channel-dependent beam) for a static unblocked link.
which does not cause a link outage. In comparison, a single beam
link SNR degrades by 26 dB, below the outage threshold of 6 dB