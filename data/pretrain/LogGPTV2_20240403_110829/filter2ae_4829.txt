# 技术分享：基于机器学习的Web异常检测

## 译文声明
本文为翻译文章，原文来源为阿里聚安全。译文仅供参考，具体内容及含义以原文为准。

### 引言
Web防火墙是信息安全的第一道防线。随着网络技术的迅速发展，新型黑客技术层出不穷，对传统规则防火墙构成了挑战。传统的Web入侵检测技术通过维护规则集来拦截入侵访问。然而，硬性规则容易被灵活的黑客绕过，且基于以往知识的规则集难以应对0day攻击。此外，攻防对抗不断升级，防守方在构建和维护规则方面面临高门槛和高昂成本。

新一代基于机器学习的Web入侵检测技术有望弥补传统规则集方法的不足，为Web安全带来新的突破和发展。机器学习方法能够基于大量数据进行自动化学习和训练，已在图像、语音和自然语言处理等领域广泛应用。然而，将机器学习应用于Web入侵检测也存在挑战，尤其是标签数据的缺乏。尽管有大量的正常访问流量数据，但Web入侵样本稀少且变化多样，给模型的学习和训练带来了困难。

因此，目前大多数Web入侵检测方法采用无监督学习，针对大量正常日志建立模型（Profile），与正常流量不符的则被识别为异常。这种方法与拦截规则的构造相反：拦截规则旨在识别入侵行为并“随机应变”，而基于Profile的方法旨在建模正常流量并在对抗中“以不变应万变”，更难被绕过。

### Web入侵识别中的异常检测
基于异常检测的Web入侵识别通常包括以下步骤：
1. **训练阶段**：针对每个URL，基于大量正常样本，抽象出描述样本集的统计学或机器学习模型（Profile）。
2. **检测阶段**：通过判断Web访问是否与Profile相符，来识别异常。

### Profile建立的主要思路
1. **基于统计学习模型**
   - **特征提取**：例如，URL参数个数、参数值长度的均值和方差、参数字符分布、URL的访问频率等。
   - **统计建模**：通过对大量样本进行特征分布统计，建立数学模型，并通过统计学方法进行异常检测。
   - **示例**：斯坦福大学CS259D课程中介绍了一些有效的特征和异常检测方法，如参数值长度、字符分布、参数缺失、参数顺序、访问频率和访问时间间隔等。

2. **基于文本分析的机器学习模型**
   - **背景**：URL参数输入的背后是后台代码的解析，每个参数的取值都有一定的范围和模式。
   - **隐马尔科夫模型（HMM）**：通过状态序列建模，将原始数据转化为状态表示，压缩状态空间，并统计状态转移概率。利用状态转移模型判断输入序列是否符合白样本的模式。

3. **基于单分类模型**
   - **背景**：由于Web入侵黑样本稀少，传统监督学习方法难以训练。基于白样本的异常检测可以通过非监督或单分类模型进行。
   - **单类支持向量机（one-class SVM）**：通过N-Gram将文本数据向量化，再通过单分类SVM找到最小边界，边界之外的识别为异常。
   - **深度自编码模型**：通过非线性特征约减和重建误差进行异常检测。

4. **基于聚类模型**
   - **背景**：正常流量通常是大量重复存在的，而入侵行为极为稀少。通过Web访问的聚类分析，可以识别小部分异常行为，实现入侵发现。

### 结论
本文简要介绍了几种基于机器学习的Web异常检测方法。Web流量异常检测只是Web入侵检测的一部分，用于从海量日志中筛选出少量“可疑”行为，但仍存在大量误报。一个完整的Web入侵检测系统还需要在此基础上进行入侵行为识别和告警降误报等环节。

2017年阿里聚安全算法挑战赛将收集真实的Web访问流量数据，经过脱敏和混淆处理后供参赛选手使用机器学习算法提高检测精度。优胜者有机会获得30万元奖金，并前往加拿大参加KDD国际数据挖掘会议。

### 竞赛详情
[竞赛详情链接]

### 推荐阅读
1. CS259D: Data Mining for CyberSecurity, [课程网址]
2. 楚安，数据科学在Web威胁感知中的应用, [链接]
3. McPAD : A Multiple Classifier System for Accurate Payload-based Anomaly Detection, Roberto Perdisci
4. AI2 : Training a big data machine to defend, Kalyan Veeramachaneni