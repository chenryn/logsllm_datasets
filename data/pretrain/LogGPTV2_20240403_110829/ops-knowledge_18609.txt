User: 请回答以下安全问题HTML过滤器需要做些什么来防止SVG攻击？我最近了解到SVG（可伸缩矢量图形）图像为网络上的细微攻击带来了许多机会。（请参阅下面的文章。）虽然SVG图像可能看起来像图像，但文件格式实际上可以包含Javascript，它可以触发HTML、Flash或其他内容的加载或执行。因此，SVG格式引入了新的潜在方法，试图将恶意内容偷偷带到网页上，或者绕过HTML过滤器。
我正在编写一个HTML过滤器来净化用户提供的HTML。我需要在我的HTML过滤器中做些什么来确保SVG图像不能被用来绕过我的过滤器？我需要阻止哪些HTML标记和属性？过滤CSS时需要做什么吗？如果我想简单地阻止所有SVG图像，那么SVG可以嵌入HTML文档的所有方式是什么？
参考文献：
卧虎藏龙：可伸缩矢量图形的安全风险，Mario Heidrich，Tilman Frosch，Meiko Jensen，Thorsten Holz。ACM CCS 2011。
另请参阅SVG上传的漏洞利用或其他安全风险？（一个不同但相关的问题）和Mike Samuel在其他地方的回答。

Assistant: 我是你链接的这篇论文的作者之一。我注意到，这篇文章中给出的一些建议是善意的，经过深思熟虑，但并非100%正确。
例如，Opera在处理通过&lt；img&gt；或CSS背景。这里有一个例子，只是为了好玩，我们通过&lt；img&gt；它将包含一个PDF，打开一个skype:URL，然后会给你打电话：
http://heideri.ch/opera/
http://www.slideshare.net/x00mario/the-image-that-called-me
我们创建了SVGPurifier，这是一组规则，扩展了HTMLPurifier，使其能够处理清理SVG的问题。当我们编写这些规则时（如果你愿意，你可以拥有它们——让我知道，我会把它们放在Github上），我们测试的每个浏览器都对SVG有不同的处理方式。还强烈依赖于它的嵌入方式：内联，带有&lt；嵌入&gt/&lt；对象&gt&lt；小程序&gt&lt；img＞；，SVG中的SVG、CSS背景、列表样式和内容。。。
事实证明，如果威胁模型主要涉及XSS及更高版本，那么在SVG中找到一个无害的子集是可能的。然而，如果你的威胁模型还包括例如UI重叠、侧通道、历史窃取攻击的缓解，那么它就变得有点困难了。例如，这里有一个有趣的片段，显示了我们如何使用非常模糊的JavaScript URI处理程序来导致XSS：http://jsbin.com/uxadon
然后我们有了内联SVG。在我个人看来，这是W3C/WHATWG有史以来最糟糕的想法之一。允许在HTML5文档中使用XML文档，强制它们遵守HTML5解析规则以及其他什么。。。安全噩梦。以下是内联SVG和包含JavaScript的一个扣人心弦的示例，其中显示了您将要处理的内容：http://pastebin.com/rmbiqZgd
为了不让这整件事最终成为SVG在安全/XSS环境中可能有多糟糕的长叹，这里有一些建议。如果您真的并且仍然想/正在处理这个HTML过滤器，请考虑执行以下操作：
给我们一个公开的测试，在那里我们可以锤击那个东西。
对你的规则集要灵活，每天都有新的绕过。
确保知道过滤内联SVG的含义。
试着看看HTMLPurifier方法是否是最好的。
白名单，不要黑名单。
不惜一切代价避免使用reg ex。这不是正则表达式的用武之地
要使用。
确保您的子集只允许那些已经
在所有相关浏览器中测试安全问题。记住
SVG密钥记录器？http://html5sec.org/#132
研究已经发布的基于SVG的攻击，并准备定期发现更多信息：http://html5sec.org/?svg
我喜欢有人尝试构建一个维护得当甚至可以工作的HTML+SVG过滤器的想法，我非常乐意测试它——我想还有很多其他过滤器。但请注意：HTML过滤已经非常困难了，而SVG只是给它增加了一层全新的困难。