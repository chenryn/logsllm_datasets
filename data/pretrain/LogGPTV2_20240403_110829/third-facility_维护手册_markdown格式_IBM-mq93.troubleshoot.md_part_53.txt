Procedure
1.Generate an MSCS cluster log after the problem occurs.
On one of the cluster members:
a)Start PowerShell (or run the 'PowerShell' command in a DOS prompt).
b)Go to the IBM MQ top-level errors directory.
For example:
PS C:\> CD $env:ProgramData\IBM\MQ\Errors
338 Troubleshooting and Support for IBM MQ
c)Run the Get-ClusterLog cmdlet to generate cluster logs for the nodes in the cluster:
PS C:\ProgramData\IBM\MQ\Errors> Get-ClusterLog -Destination
2.Run the IBM MQ amqmsysn utility to display information about all IBM MQ executables and libraries
on both members of the cluster.
Use the To File button to save this information to a file, for example %TEMP%\MQ.exeinfo.txt.
3.Generate a high detail MQ trace on both members of the cluster during the problem. For example:
C:\> strmqtrc -e -t all -t detail
...
C:\> endmqtrc -a
4.Show the registry checkpoints on both members of the cluster:
C:\> CLUSTER RESOURCE /CHECKPOINTS > %TEMP%\Cluster.checkpoints.txt
5.Check the registry checkpoints on both cluster members.
6.Save all three Event Viewer logs (System, Application and Security) on both members of the cluster.
7.Place the cluster logs, error logs and command outputs from Steps 1 and 2 directly in the top-level
IBM MQ errors directory on each member of the cluster.
The automatic and manual data collection processes in Step “8” on page 339 both collect files found
in this directory.
8.Collect the IBM MQ data.
You can do this either automatically or manually:
• Collect the data automatically by using the runmqras command on both cluster members as
described in “Collecting troubleshooting information automatically with runmqras” on page 303.
Be sure to collect the runmqras trace section, and to specify your case number as shown in the
following example for collecting output from queue manager QMA:
runmqras -section trace -qmlist QMA -caseno TS001234567
• Alternatively, collect the data manually as described in “Collecting troubleshooting information
manually” on page 306.
9.Send the information that you have collected to IBM.
A good description of the problem and the data is the most important information you can provide to
IBM. Do not send data without providing a description!
For FTP and email instructions, see Exchanging information with IBM Software Support.
To open or update a case, go to the IBM My Support site.
Note: Always update your case to indicate that data was sent.
If you need to speak with IBM Software Support, contact your country representative. If you need to
speak with IBM Software Support in the US, you can call 1-800-IBM-SERV.
Collecting information for MQIPT problems
If you need to report a problem with MQIPT to IBM Support, send relevant information that will help to
resolve the problem more quickly.
About this task
Complete the following steps to obtain the required information.
Procedure
1.Synchronize the system clock on each computer involved, including all those running IBM MQ and
MQIPT.
IBM MQ troubleshooting and support 339
This operation helps to match trace entries in different trace files.
2.Move old trace files to a backup directory so that new trace files contain information related only to
this problem.
3.Turn on trace for all routes that are affected by the problem.
For more information, see “Tracing errors in IBM MQ Internet Pass-Thru” on page 419.
4.Run the client to reproduce the problem and create new trace files.
5.Send a copy of all MQIPT .TRC, .FDC, and .log files.
Also send a simple network diagram of all the computers used between the IBM MQ endpoints,
including firewalls, routers, load balancers, and servers. For each computer, include its name, IP
address, and relevant port numbers.
6.Send the information that you have collected to IBM.
A good description of the problem and the data is the most important information you can provide to
IBM. Do not send data without providing a description!
For FTP and email instructions, see Exchanging information with IBM Software Support.
To open or update a case, go to the IBM My Support site.
Note: Always update your case to indicate that data was sent.
If you need to speak with IBM Software Support, contact your country representative. If you need to
speak with IBM Software Support in the US, you can call 1-800-IBM-SERV.
Related tasks
“Contacting IBM Support” on page 301
If you need help with a problem that you are having with IBM MQ, you can contact IBM Support through
the IBM Support Site. You can also subscribe to notifications about IBM MQ fixes, troubleshooting, and
other news.
“Troubleshooting IBM MQ Internet Pass-Thru problems” on page 90
There are a number of steps you can follow to help determine the nature of any problems you might
encounter when using IBM MQ Internet Pass-Thru (MQIPT).
Collecting information for publish/subscribe problems
If you need assistance from IBM Support to resolve a problem where IBM MQ publish/subscribe is
not delivering messages properly or reporting a problem on Multiplatforms, you first need to collect
troubleshooting information to send to IBM Support to help find a solution.
Before you begin
Before you start this task, answer the following questions about the problem:
• What publish subscribe problem did you observe on the system?
• What time did the publish subscribe problem start and when did it stop?
• Which specific topics and subscriber applications are involved in the problem?
About this task
It is important to gather information from the system when the publish/subscribe problem is happening in
order to identify the cause.
After collecting the troubleshooting information, you can send it to IBM.
Procedure
Generate the troubleshooting information.
340 Troubleshooting and Support for IBM MQ
1.If the publish subscribe problem is affecting an IBM MQ classes for Java or IBM MQ classes for
JMS application, generate an IBM MQ classes for Java trace or a Java Message Service trace, as
appropriate.
If your application is running under WebSphere Application Server, follow the trace instructions for
that environment.
2.Generate a trace of the queue manager when the publish/subscribe problem occurs.
If you are generating a Java or JMS trace, do this at the same time.
• “Tracing on AIX and Linux” on page 376
• “Tracing on Windows” on page 391
• “Tracing on IBM i” on page 381
3.
On Linux and UNIX systems, save the output from the mqconfig command.
Collect the troubleshooting information.
4.Place the output from the mqconfig command that you generated in Step 3 in the top-level IBM MQ
errors directory.
The automatic and manual data collection processes in Step “5” on page 341 both collect files found
in this directory.
5.Collect the IBM MQ data.
You can do this either automatically or manually:
• Collect the data automatically by using the runmqras command as described in “Collecting
troubleshooting information automatically with runmqras” on page 303. Be sure to collect the
runmqras trace section, and from queue managers the defs and topic sections as well, and
to specify your case number as shown in the following example for collecting output from queue
manager QMA:
runmqras -section defs,topic,trace -qmlist QMA -caseno TS001234567
• Alternatively, collect the data manually as described in “Collecting troubleshooting information
manually” on page 306.
Send the troubleshooting information to IBM.
6.Send the information that you have collected to IBM.
A good description of the problem and the data is the most important information you can provide to
IBM. Do not send data without providing a description!
For FTP and email instructions, see Exchanging information with IBM Software Support.
To open or update a case, go to the IBM My Support site.
Note: Always update your case to indicate that data was sent.
If you need to speak with IBM Software Support, contact your country representative. If you need to
speak with IBM Software Support in the US, you can call 1-800-IBM-SERV.
Collecting information for RDQM problems
A replicated data queue manager (RDQM) is reporting a problem or failing to work properly on Linux, and
you need to collect MustGather data to send to IBM Support to help find a solution.
About this task
If you need to collect troubleshooting information to send to IBM Support when reporting a problem with
RDQM, you can use the runmqras command to collect the diagnostic data.
These instructions apply to IBM MQ 9.0.0 Fix Pack 4 and later on Linux.
IBM MQ troubleshooting and support 341
Procedure
1.Collect the runmqras output from each RDQM node using an mqm user:
sudo runmqras -qmlist rdqmName -section defs,trace -caseno casenumber
where rdqmName is the name of the queue manager and casenumber is the case number, for example
TS001234567.
Notes:
• -caseno only works in IBM MQ 9.0.0 Fix Pack 5 or later, IBM MQ 9.1.0 Fix Pack 1 or later, IBM MQ
9.1.1 or later, and IBM MQ 9.2.0 or later.
• You can omit the trace attribute from the -section parameter if you are using IBM MQ 9.1.5 or
later.
For more information about using the runmqras command, see “Collecting troubleshooting
information automatically with runmqras” on page 303.
2.Provide the /var/log/messages file from all three nodes.
Include any archived syslog files that might contain activity from the date of the problem.
3.Provide the /var/log/pacemaker.log from all three nodes.
Include any archived pacemaker.log files that might contain activity from the date of the problem.
Note: The -section trace option collects files in the /var/mqm/trace folder, which is where
root-RDQM.log and mqm-RDQM.LOG files are located. DRBD logs are written to the /var/log/
messages (syslog) file.
One small caveat is that /var/log/messages is the location of the default syslog output. If a
non-default location is used for the syslog target, locate the syslog in the custom location.
Related tasks
“Troubleshooting RDQM configuration problems” on page 217
These topics give information that is useful for troubleshooting RDQM high availability (HA) and disaster
recovery (DR) configurations.
Related reference
rdqm high availability
Collecting information for security problems
If an IBM MQ is incorrectly allowing or denying access to a user or application on Multiplatforms, you
might need to collect troubleshooting information to help with finding a solution.
Before you begin
Before you start this task, answer the following questions about the problem:
• What security problem did you observe on the system?
• What time did the security problem start and when did it stop?
• Which specific users or applications and queue manager objects are involved?
• Was this system previously working?
• What changed since it was working?
• How long is your username and password that you are attempting to use?
About this task
If the security problem is happening right now or you are able to reproduce it, you can generate data to
provide more information about the problem.
After collecting the troubleshooting information, you can send it to IBM.
342 Troubleshooting and Support for IBM MQ
Procedure
1.Generate a trace of the queue manager when the security problem occurs.
If possible, issue the runmqsc command REFRESH SECURITY just before tracing so that the trace will
show the queue manager querying the operating system for details about the user.
• “Tracing on AIX and Linux” on page 376
• “Tracing on Windows” on page 391
• “Tracing on IBM i” on page 381
2.Display information about the user, particularly the groups to which the user belongs.
For example:
• To display user watson on UNIX and Linux:
sh> id watson > /tmp/watson.id.txt
sh> groups watson > /tmp/watson.groups.txt
• To display user "Thomas Watson" on Windows:
C:\> NET USER "Thomas Watson" > %TEMP%\watson.user.txt
• To display user WATSON at the IBM i command line:
===> DSPUSRPRF USER(WATSON) OUTPUT(*PRINT)
Then use WRKSPLF option 5 to display the joblog from QPUSRPRF
3.Collect the IBM MQ data.
You can collect do this either automatically or manually:
• Collect the data automatically by using the runmqras command as described in “Collecting
troubleshooting information automatically with runmqras” on page 303. Be sure to collect the
runmqras defs and trace (if the issue was traced) sections, and to specify your case number as
shown in the following example:
runmqras -section defs,cluster,trace -qmlist QMA -caseno TS001234567
• Alternatively, collect the data manually as described in “Collecting troubleshooting information
manually” on page 306.
Note: If one of the sides of this connection is not a queue manager, collect that client's applicable logs.
4.Send the information that you have collected to IBM.
A good description of the problem and the data is the most important information you can provide to
IBM. Do not send data without providing a description!
For FTP and email instructions, see Exchanging information with IBM Software Support.
To open or update a case, go to the IBM My Support site.
Note: Always update your case to indicate that data was sent.
If you need to speak with IBM Software Support, contact your country representative. If you need to
speak with IBM Software Support in the US, you can call 1-800-IBM-SERV.
Related tasks
“Troubleshooting security problems” on page 231
IBM MQ troubleshooting and support 343
Troubleshooting information to help you solve problems relating to security.
Collecting information for TLS channel problems
If an IBM MQ queue manager or client application is failing to establish a secure channel using TLS on
Multiplatforms, you might need to collect troubleshooting information to help with finding a solution.
Before you begin
Before you start this task, answer the following questions about the problem:
• What TLS channel problem did you observe on the system?
• What time did the TLS channel problem start and when did it stop?
• Which specific channels and certificates are involved in the problem?
• Was this channel previously working with TLS or is this a new configuration?
• If the channel was previously working what changed?
• Does the channel work without TLS?
Submit the outputs from both sides of the IBM MQ connection. The following examples are from KDB
keystore based systems. For clients using other formats, see the documentation for the appropriate
format for information on how to list the keystores.
• Keystore Location and Permissions
– UNIX and Linux command line:
ls -la 
– Windows Powershell command:
Get-Acl  |
Format-List
• Keystore Certificate Listing UNIX, Linux and Windows:
runmqakm -cert -list -v -db  -stashed
• Certificates expired or expiring in the next 90 days:
runmqakm -cert -list -expiry 90 -db  -stashed
About this task
If the TLS channel problem is happening right now or you are able to reproduce it, you can generate data
to provide more information about the problem.
After collecting the troubleshooting information, you can send it to IBM.
Procedure
1.Generate a trace of the queue manager when the TLS problem occurs.
Unless your support representatives inform you differently the correct options for a queue manager
TLS trace are -t all -t detail:
• “Tracing on AIX and Linux” on page 376
• “Tracing on Windows” on page 391
• “Tracing on IBM i” on page 381
344 Troubleshooting and Support for IBM MQ
2.Generate IBM MQ trace simultaneously at the other end of the channel, whether it is another queue
manager or a client application:
• “Tracing on AIX and Linux” on page 376
• “Tracing on Windows” on page 391
• “Tracing on IBM i” on page 381
• Java and JMS Client Applications
• z/OS CHIN trace
3.Collect the IBM MQ data.
You can collect do this either automatically or manually:
• Collect the data automatically by using the runmqras command as described in “Collecting
troubleshooting information automatically with runmqras” on page 303. Be sure to collect the
runmqras defs and trace (if the issue was traced) sections, and to specify your case number as
shown in the following example:
runmqras -section defs,cluster,trace -qmlist QMA -caseno TS001234567
• Alternatively, collect the data manually as described in “Collecting troubleshooting information
manually” on page 306.
Note: If one of the sides of this connection is not a queue manager, collect that client's applicable logs.
4.Send the information that you have collected to IBM.
A good description of the problem and the data is the most important information you can provide to
IBM. Do not send data without providing a description!
For FTP and email instructions, see Exchanging information with IBM Software Support.
To open or update a case, go to the IBM My Support site.
Note: Always update your case to indicate that data was sent.
If you need to speak with IBM Software Support, contact your country representative. If you need to
speak with IBM Software Support in the US, you can call 1-800-IBM-SERV.
Related tasks
“Troubleshooting security problems” on page 231
Troubleshooting information to help you solve problems relating to security.
Collecting information for triggering problems
If you need assistance from IBM Support to resolve a problem where IBM MQ is not triggering an
application or a channel properly on Multiplatforms, you first need to collect troubleshooting information
to send to IBM Support to help find a solution.
Before you begin
Before you start this task, answer the following questions about the problem:
• What triggering problem did you observe on the system?