QuLog: Data-Driven Approach for Log Instruction Quality
Assessment
JasminBogatinovski SashoNedelkoski AlexanderAcker
PI:EMAIL PI:EMAIL PI:EMAIL
TechnicalUniversityBerlin TechnicalUniversityBerlin TechnicalUniversityBerlin
Berlin,Germany Berlin,Germany Berlin,Germany
JorgeCardoso OdejKao
PI:EMAIL PI:EMAIL
HuaweiMunichReserchCenter TechnicalUniversityBerlin
Munich,Germany Berlin,Germany
ABSTRACT CCSCONCEPTS
InthecurrentITworld,developerswritecodewhilesystemopera- •Softwareanditsengineering→Softwaretestinganddebug-
torsrunthecodemostlyasablackbox.Theconnectionbetween ging.
bothworldsistypicallyestablishedwithlogmessages:thedevel-
operprovideshintstothe(unknown)operator,wherethecause KEYWORDS
of an occurred issue is, and vice versa, the operator can report logquality,deeplearning,loganalysis,programcomprehension
bugsduringoperation.Tofulfilthispurpose,developerswritelog
ACMReferenceFormat:
instructionsthatarestructuredtextcommonlycomposedofalog
JasminBogatinovski,SashoNedelkoski,AlexanderAcker,JorgeCardoso,
level(e.g.,“info","error"),statictext(“IP{}cannotbereached”),and
andOdejKao.2022.QuLog:Data-DrivenApproachforLogInstruction
dynamicvariables(e.g.IP{}).However,opposedtowell-adopted
QualityAssessment.InProceedingsofThe30thInternationalConferenceon
codingpractices,therearenowidelyadoptedguidelinesonhowto
ProgramComprehension(ICPC2022).ACM,NewYork,NY,USA,13pages.
writeloginstructionswithgoodqualityproperties.Forexample, https://doi.org/XXXXXXX.XXXXXXX
adevelopermayassignahighloglevel(e.g.,"error")foratriv-
ialeventthatcanconfusetheoperatorandincreasemaintenance 1 INTRODUCTION
costs.Orthestatictextcanbeinsufficienttohintataspecificissue.
Loggingisimportantprogrammingpracticeinmodernsoftware
Inthispaper,weaddresstheproblemoflogqualityassessment
development,assoftwarelogs–theendproductoflogging,are
andprovidethefirststeptowardsitsautomation.Westartwith
frequentlyadoptedindiversedebuggingandmaintenancetasks.
anin-depthanalysisofqualityloginstructionpropertiesinnine
Logsrecordsystemeventsonarbitrarygranularityandgivein-
softwaresystemsandidentifytwoqualityproperties:1)correct
sightsintotheinner-workingstateoftherunningsystem.Therich
loglevelassignmentassessingthecorrectnessoftheloglevel,and
informationtheyprovideenablesthedevelopersandoperatorsto
2)sufficientlinguisticstructureassessingtheminimalrichnessof
analyzeeventsandperformawiderangeoftasks.Notabletaskex-
thestatictextnecessaryforverboseeventdescription.Basedon
amplesrelyingonlogsarecomprehendingsystembehaviour[28],
thesefindings,wedevelopedadata-drivenapproachthatadapts
troubleshooting[13],andtrackingexecutionstatus[41].
deeplearningmethodsforeachofthetwoproperties.Anextensive
Logsaretextualeventdescriptorsgeneratedbyloginstructions
evaluationonlarge-scaleopen-sourcesystemsshowsthatourap-
inthesourcecode.Figure1adepictsanexampleofaloginstruction
proachcorrectlyassessesloglevelassignmentswithanaccuracyof
andthelogmessage(logforshort)describingtheexecutedsystem
0.88,andthesufficientlinguisticstructurewithanF scoreof0.99,
1 event.Theloginstructionsarecommonlycomposedofthreeparts
outperformingthebaselines.Ourstudyhighlightsthepotentialof
1) static text describing the event (e.g., VM {} created in {}
thedata-drivenmethodsinassessingloginstructionsqualityand
seconds.),2)variabletextgivingadynamicinformationaboutthe
aiddevelopersincomprehendingandwritingbettercode.
event(e.g.,8),and3)loglevel(e.g.,info,error,warning),denoting
the subjective developer opinion for the severity degree of the
recordedevent.Theimportanceofloginstructionsmakesthem
widelypresentwithinthesourcecode.Forexample,HBase–a
popularJavasoftwaresystem,hasmorethan5kloginstructions.
Permissiontomakedigitalorhardcopiesofallorpartofthisworkforpersonalor Developersusediverseloggingframeworks(e.g.,Log4j[15])and
classroomuseisgrantedwithoutfeeprovidedthatcopiesarenotmadeordistributed
forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation loggingwrappers(e.g.,SLF4J[39]),whichprovidecommonlogging
onthefirstpage.CopyrightsforcomponentsofthisworkownedbyothersthanACM featuresunifyingtheloginstructionswriting.
mustbehonored.Abstractingwithcreditispermitted.Tocopyotherwise,orrepublish,
Manycompaniesareadoptingloggingframeworksandspecify
topostonserversortoredistributetolists,requirespriorspecificpermissionand/ora
fee.Requestpermissionsfrompermissions@acm.org. guidancetotheirdevelopersonthequality requirementswhen
ICPC2022,May21–22,2022,Pittsburgh,PA,USA writingloginstructions[5].Thequalityrequirementsdefinediffer-
©2022AssociationforComputingMachinery. entpropertiesofloginstructionsquality,suchas1)assignmentof
ACMISBN978-1-4503-XXXX-X/18/06...$15.00
https://doi.org/XXXXXXX.XXXXXXX correctloglevels,2)writingstatictextwithsufficientinformation
ReportedLog Instruction
LOG.info(“EventThread shut down.”);
FixedLog Instruction
LOG.info(“EventThreadshut down for sessionID: 0x{}.” + getSId());
ICPC2022,May21–22,2022,Pittsburgh,PA,USA Bogatinovski,etal.
Log Instruction in the Source Code ReportedLogInstruction ReportedLog Instruction
LOG.info(“VM{} created in {} seconds.”, vmID, seconds); LOG.info(“Cannot access storage directory{}.” + rootPath); LOG.info(“EventThreadshut down.”);
Log Message of an Executed Event FixedLog Instruction FixedLog Instruction
12/12/2021 10:12:42 INFOVMafe11-10a1created in8 seconds. LOG.error(“Cannot access storage directory{}.” + rootPath); LOG.info(“EventThreadshut down for sessionID: {}.”+getSId());
(a)Anexampleofloginstructionandgeneratedmes-(b)JiraissueHDFS-4048:Exampleofwrongloglevel(c)JiraissueZOOKEEPER-2126:Insufficientinforma-
sagefromthesoftwaresystemOpenStack. assignmentanditsfix. tion/(linguistics)hurtseventunderstanding.
Figure1:(a)Exampleofloginstruction.(b)&(c)Examplesofissuesrelatedtologinstructionqualityandtheirfixes.
(i.e.,sufficientlinguisticproperties),3)appropriateloginstruction software,withmanydifferentcomponentsdevelopedbymultiple
formats,and4)correctloginstructionplacementwithinthesource developerslocatedindiversegeographicalregions(e.g.,systems
code[6].Thequalityguidelinesaimtoaligntheexpectationsfrom likeOpenStack).Itrequiresnon-trivialknowledgeandexperience
thelogsforbothdevelopersandoperatorsthatmayworkindif- toconstructanunderstandabledescriptionoftheevent,estimate
ferentteamsandusethelogsfordifferentactivities.Sincemany theloglevelsoftheinstructionorconductqualityloggingpractices
maintenancetasks(e.g.,tracingfaultyactivities,diagnosingfailures, ingeneral.Althoughthehuman-centricapproachinlogquality
andperformingrootcauseanalysis)arefrequentlylog-based[28], assessmentisthegoldenstandard,theaforenamedchallengesimply
they directly depend on the quality of the logs, i.e., the quality theneedforanautomaticapproach.
propertiesoftheloginstructions.Therefore,evaluatingthequality Inthispaper,weaddressthelogqualityassessmentproblem.Our
oftheloginstructionsemergesasarelevanttask. goalistodevelopanapproachtoautomaticallyassessthequality
Acentralprobleminthiscontextistowriteloginstructionswith ofloginstructionsfromanarbitrarysoftwaresystem.Suchanap-
sufficientquality.Recentstudiesonindustrial[5]andopen-source proachischallengedbytheheterogeneityofthesoftwaresystems,
softwaresystems[6]suggestthatdevelopersmakerecurrentlog- theuniquewritingstylesofdevelopers,anddifferentprogramming
relatedcommitsduringdevelopment.Itmeansthatwritingquality languages. They limit the set of testable quality properties. For
loginstructionsforthefirsttime,evenwithgivenqualityguidelines, example,thedifferentsyntaxofthenearbycodefromtwoprogram-
isnottrivial.Additionally,theguidelinescanbeincompleteanddo minglanguages(e.g.,JavaandPython)questionstheapplicability
notcovereverypossiblecase.Forexample,intheJiraissueLOG4J2- ofloginstructionplacementmethodsonarbitrarysystem[5].To
3161,adeveloperreportedthattheloggingguidelinesmisguided findtheempiricallytestableproperties,weperformedapreliminary
himinproperusageofloglevels. manualstudyonthepropertiesoftheloginstructionsfromnine
Whiletheloggingframeworksunifylogging,theydonotim- open-sourcesystems.Weidentifiedtwosuchqualityproperties–
plementmechanismstotrackthequality.Thereby,thedecisions 1)loglevelassignment assessingthecorrectnessoftheloglevel,
abouttheloginstructionsarepurelyhuman-centric,whichcan and2)sufficientlinguisticstructureassessingtheminimallinguistic
resultinpoorloggingpractices(e.g.,wrongloglevelassignment richnessofthestatictextnecessaryforverboseeventdescription.
orinsufficientlinguisticstructure)[29,44].Forexample,intheJira Throughthepreliminarystudy,wefindthatthestatictextofthe
issueHDFS-40482(depictedinFigure1b),thewrongloglevelofthe loginstructionissufficientinassessingthetwoproperties.There-
instructionLOG.info("Cannotaccessstoragedirectory"+rootPath); fore,thelogqualityassessmentisdoneonthestatictextofthelog
resultedinalongtimeforlocalizationofthefailure.Thedeveloper instructions,independentoftheotherpropertiesofthesourcecode
usedtheloglevels"error"and"warning"forlog-basedfailurelocal- (e.g.,nearbycodestructure).Thismakesthelogqualityassessment
ization,buttheeventinitiallywasloggedonloglevel"info",not system-agnostic.Theobserveddependenciesbetweenthestatic
"error".Similarly,intheJiraissueZOOKEEPER-21263(depictedin textononeside,andtheloglevelsandlinguisticallysufficientla-
Figure1c),theloginstructionhasinsufficientinformationabout belsontheothersideallowtheapplicationofdata-drivenmethods.
whichEventThreadisterminated.Asreportedbythedevelopers, Ultimatelyenablingtheautomationoftheloginstructionquality
itbecomesconfusingwhenanewEventThreadiscreatedbefore assessment.
terminatingthepreviousone.Thelackofasessionidentifierwas Basedonourobservations,weproposeQuLogasanapproachto
pointedtoasthemainconcern.Theproblemisresolvedbyadding automaticallyassessloginstructionsquality.QuLogtrainstwodeep
additional words in the static text to give minimal information learningmodelsfromtheloginstructionsofmanysoftwaresystems
abouttheeventwhichcanbeunderstood/comprehendedbythe andappropriatelearningobjectivestolearnqualitypropertiesfor
developers.Notably,inlinguisticterms,thismeansenrichingthe theloglevelsandsufficientlinguisticstructureofstatictexts.To
linguisticstructureofthestatictext.Theaforenamedissuesare capturediversedevelopersloggingstyles,wetrainedthemodels
notisolatedevents.Previousworksonloggingpractices[6,29] onacarefullyconstructedloginstructioncollectionwithexpected
suggest that it is surprisingly common for the log levels to be goodqualitypracticessimilarasinrelatedwork[6].Byadoptingan
over/under-estimatedorthelogstohavemissingorexcessivein- approachfromexplainableAI,wefurtherimplementedaprediction
formation.Theseproblemsareparticularlychallengingincomplex explainertoshowwhythemodelsmakecertainpredictions,which
serveasadditionalfeedbackfordevelopers.Ourexperimentalre-
1https://issues.apache.org/jira/browse/LOG4J2-3166 sultsshowthatQuLogachieveshighperformanceinassessingthe
2https://issues.apache.org/jira/browse/HDFS-4048 twoqualitypropertiesoutperformingthebaselines.Theprediction
3https://issues.apache.org/jira/browse/ZOOKEEPER-2126
QuLog:Data-DrivenApproachforLogInstructionQualityAssessment ICPC2022,May21–22,2022,Pittsburgh,PA,USA
explainerhasalowerrorforthecorrectpredictionreasonsugges- Table1:Overviewofthestudiedsystems
tion.Thereby,theexperimentsshowthatQuLoghelpstoassessthe
loginstructionsqualitywhilegivingusefulsuggestionsfortheir SoftwareSystem Version LOC NOL
improvement. Cassandra 3.11.4 432K 1.3K
Inanutshell,ourcontributionssummarizeas: Elasticsearch 7.4.0 1.50M 2.5K
(1) Weperformedamanualanalysisonthequalitylogprop- Flink 1.8.2 177K 2.5K
ertiesoftheloginstructionsonninesoftwaresystemsand HBase 2.2.1 1.26M 5.5K
identified1)logleveland2)sufficientlinguisticstructure JMeter 5.3.0 143K 1.9K
assessmentsastwoempiricallytestableproperties. Kafka 2.3.0 267K 1.5K
(2) Weimplementedanovelapproachforautomaticsystem- Karaf 4.2.9 133K 0.7K
agnosticlogqualityassessmentnamedQuLog,whichuses Wicket 8.6.1 216K 0.4K