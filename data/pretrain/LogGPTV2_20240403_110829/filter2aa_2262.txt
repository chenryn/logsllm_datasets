#BHUSA @BlackHatEvents
Chasing Your Tail With A 
Raspberry Pi
Matt Edmondson
#BHUSA @BlackHatEvents
Information Classification: General
Why Are We Talking About This?
• For some people, trying to figure out if they’re being 
followed is a matter of physical safety for 
themselves or others
• I was approached by a friend in this situation 
looking for a technical option to use in conjunction 
with traditional tradecraft
#BHUSA @BlackHatEvents
Information Classification: General
The New (i.e. Really Old) SDR: Surveillance 
Detection Route 
#BHUSA @BlackHatEvents
Information Classification: General
One Option: Looking for Persistent Digital 
Signatures
• Go to Starbucks to grab a drink
• Hit the gas station to top off the tank
• Head over to the bookstore to look at magazines
• Now… Did I see any devices at all three locations?
#BHUSA @BlackHatEvents
Information Classification: General
One Option: Looking for Persistent Digital 
Signatures Cont.
• We’ll accomplish this by passively detecting Wi-Fi 
and Bluetooth devices we observe around us
• The devices could be part of an active connection, or 
just looking for networks to connect to
#BHUSA @BlackHatEvents
Information Classification: General
Hardware
• For hardware I wanted to use things that I had 
laying around in a closet
• I imagine many of you have these same things 
gathering dust somewhere and if not, they’re cheap
#BHUSA @BlackHatEvents
Information Classification: General
Platform: Raspberry Pi is One Cheap Option
#BHUSA @BlackHatEvents
Information Classification: General
Wireless: Something You Can Put In Monitor 
Mode
#BHUSA @BlackHatEvents
Information Classification: General
Power: A Battery Pack or Other Power 
Source
#BHUSA @BlackHatEvents
Information Classification: General
Display: A Screen For Real Time Monitoring
#BHUSA @BlackHatEvents
Information Classification: General
Software: Kismet
• Open source with a fantastic Discord server
• Easy to install
• Passive
• Supports Wi-Fi, Bluetooth, SDR, ZigBee etc.
• Writes the data into a SQLite database
• Able to generate PCAP and other formats if needed
#BHUSA @BlackHatEvents
Information Classification: General
Everything Else is Just Python or Shell 
Scripts
#BHUSA @BlackHatEvents
Information Classification: General
But It’s Not Perfect!
• “Perfect is the enemy of good” – Voltaire
• "Give them the third best to go on with; the second 
best comes too late, the best never comes.“ -
Robert Watson-Watt
#BHUSA @BlackHatEvents
Information Classification: General
Back to Kismet
• By default Kismet starts up a new SQLite file every 
time you start it (with a .kismet extension)
• We’ll just have that output to the same directory and 
have our Python code parse whatever the newest 
.kismet file in that directory is
#BHUSA @BlackHatEvents
Information Classification: General
A Slight Change in the Methodology
• Look for any Wi-Fi or Bluetooth devices currently in 
the area which I also saw 5-10 minutes ago, 10-15 
minutes ago or 15-20 minutes ago
• If there are, alert me with the MAC address, device 
type (Wi-Fi Access point, BTLE etc.) and the time 
frame I previously saw it
#BHUSA @BlackHatEvents
Information Classification: General
Our First Snag
• Not solvable with a simple SQL query by time frame 
since Kismet stores the first and most recent time 
stamps, but not those in between
• But there is a solution…
#BHUSA @BlackHatEvents
Information Classification: General
Enter the List!
• Create 5-10, 10-15 and 15-20 min lists at startup
• Initialize a list of current devices
• Every minute add things you’re seeing into the 
current list
• Every five minutes, make the current devices the 5-
10 mins list
#BHUSA @BlackHatEvents
Information Classification: General
Now What?
• Every minute grab the devices that have been seen 
in the previous 60 seconds, see if any of them are in 
any of the 5-10 min,10-15 min or 15-20 min lists and 
print an alert to the screen if so
#BHUSA @BlackHatEvents
Information Classification: General
We Don’t Want to Alert on Ourselves…
#BHUSA @BlackHatEvents
Information Classification: General
Let’s Make Some Ignore Lists
• At any time you can create an “ignore list” of every 
MAC address seen in the latest kismet database
• These devices are ignored for the rest of the session
• You can delete or re-recreate the list at any time
#BHUSA @BlackHatEvents
Information Classification: General
Please Don’t Laugh… OK, You Can Laugh
• How do you do all this on a tiny touch screen with no 
keyboard??
#BHUSA @BlackHatEvents
Information Classification: General
Field Testing
• Worked great in the lab, did everything it was 
supposed to
• Took it out in the middle of nowhere, turned on a 
new wireless device and saw…. nothing
#BHUSA @BlackHatEvents
Information Classification: General
MAC Randomization Was WAY More 
Frequent Than I Thought
#BHUSA @BlackHatEvents
Information Classification: General
Is This a Deal Breaker?
• The MAC address logic works and needs to remain, 
but we obviously can’t rely on it alone if we’re 
counting on seeing devices that currently aren’t 
connected to a Wi-Fi network when they’re looking 
for Wi-Fi networks
• We’re going to have to dive deeper and look at what 
was being probed for
#BHUSA @BlackHatEvents
Information Classification: General
Thank You Kismet!
• Kismet normalizes some fields in the database but 
has a lot more data in JSON blobs
• raw_device_json["dot11.device"]["dot11.device.last_
probed_ssid_record"]["dot11.probedssid.ssid"]
• So now in addition to MACs, we can look for what 
was being probed for, regardless of the MAC 
address probing
#BHUSA @BlackHatEvents
Information Classification: General
User Display
#BHUSA @BlackHatEvents
Information Classification: General
User Display Cont
#BHUSA @BlackHatEvents
Information Classification: General
User Display Cont
#BHUSA @BlackHatEvents
Information Classification: General
The MVP Version
#BHUSA @BlackHatEvents
Information Classification: General
The…. Better…ish… version
#BHUSA @BlackHatEvents
Information Classification: General
We Said Earlier That Kismet Keeps Great 
Logs
• Can we analyze these logs to find information about 
the individuals following us?
• Potentially… 
#BHUSA @BlackHatEvents
Information Classification: General
Sub-Optimal OPSEC
• Many organizations have a very bad habit of naming 
their Wi-Fi networks the name of their agencies or 
specialty units
#BHUSA @BlackHatEvents
Information Classification: General
Wigle.net
• I did this government 
agency the courtesy of 
sanitizing the first part of 
their Wi-Fi network name
#BHUSA @BlackHatEvents
Information Classification: General
Path Forward
• More Wi-Fi adapters
• More wireless protocols
• GPS tracking
#BHUSA @BlackHatEvents
Information Classification: General
Special Thanks
• Mike Kershaw (@kismetwireless)
• Dominic White (@singe)
• Joshua Wright (@joswr1ght)
#BHUSA @BlackHatEvents
Information Classification: General
Thank You!
Matt Edmondson
@matt0177
PI:EMAIL
www.digitalforensicstips.com