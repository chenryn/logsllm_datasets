1.将从事务中提取的数据从字节数组转换为二进制文件，然后保存该文件；
2.将二进制文件输入file carving工具；
3.如果该工具检测到二进制文件中的某些文件，请记录交易信息
本研究使用了18种文件类型进行检测：jpg，gif，png，bmp，avi，exe，mpg，wav，riff，wmv，mov，pdf，ole，doc，zip，rar，html和cpp。在此评估中，没有涵盖分别分割并嵌入到区块链中并以某种方式编码的文件。攻击者需要一定的负担（例如，文件，gas等的管理）才能通过划分或编码来隐藏嵌入式文件或区块链上的数据。
###  2)事务中嵌入的文件
对从交易中提取的数据的调查表明，在以太坊区块链中嵌入了154个文件。上图显示了提取文件的文件类型。从图可以明显看出，大约80％的提取文件是图像文件（jpg，png和gif）。大多数图像内容没有问题，因为它们是集体照和风景。但是，某些图片包含不良内容。此外，乍看之下是正常的图片可能是恶意的，因为它们可能侵犯他人的隐私，并被隐写术所滥用。在以太坊区块链中发现了三个exe文件。这三个exe文件的MD5哈希如下所示；
（1）c9a31ea148232b201fe7cb7db5c75f5e
（2）c1e5dae72a51a7b7219346c4a360d867
（3）c9a31ea148232b201fe7cb7db5c75f5e
这两个文件显然是相同的。将这些哈希值输入VirusTotal来评估文件，并得出结论认为这三个exe文件是恶意软件，因为文件(1)和文件(3)的分析结果表明，它们被反病毒软件的检测率为56/70，并且文件(2)的结果表明其检测率为58/66。根据报告，一种名为W32.Duqu的恶意软件具有与文件(1)和文件(3)相同的哈希值。
此外，发现这三个exe文件是由一个帐户嵌入的，该帐户在大约6分钟内发送了三个嵌入文件的交易。下图显示了嵌入文件的事务的时间序列直方图。
演示了交易嵌入式文件的发送者和接收者之间的关系。发件人帐户数量为113，而文件嵌入式交易数量为154。这表明某些帐户多次将文件嵌入以太坊区块链。一个帐户发送的文件嵌入交易的最大数量为10。
上表列出了发件人帐户和收件人帐户之间的关系数量。关系分为三种：（a）发送者和接收者相同，（b）发送者和接收者不同，（c）接收者为空（即合约创建交易）。大多数具有文件嵌入式事务的帐户会将事务发送给除null以外的任何收件人。一些帐户将文件嵌入合约创建交易中。
## 0x06 Feasibility Experiment of Poisoning Attack
确定攻击的可行性对于评估攻击风险很重要，构建了一个模拟以太坊区块链实际环境的实验环境，以评估投毒攻击的可能性。在环境中，尝试将文件嵌入到私有的以太坊区块链中，并使用网络浏览器从资源管理器中提取相同的文件。提取并嵌入了文件，以使用网络浏览器和shell命令验证区块链中毒作为C＆C基础设施的可用性，这表明攻击容易。
###  1）实验环境
实验环境是使用两个服务器（服务器A和服务器B）和一台笔记本电脑构建的，如上图所示。实验环境的组件如下：
服务器A（以太坊专用网）： Go Ethereum安装在此服务器上，该服务器配置为挖掘私有区块链。该服务器在实际环境中扮演以太坊主网的角色。
服务器B（资源管理器）：在此服务器上设置了一个Web服务器，以使用EthExplorer在服务器A上显示有关以太坊私有区块链的信息。该Web服务器在实际环境中扮演Etherscan等区块链浏览器的角色。
笔记本电脑：使用MacBook Pro执行shell命令，并使用Google
Chrome（已安装METAMASK）进行实验。这些使嵌入和提取文件的过程与对以太坊主网进行中毒攻击的过程相同。
###  2）实验
分三个步骤（准备，嵌入文件和提取文件）说明实验过程。由于以太坊拒绝包含32 kB以上数据的交易，因此使用32 kB以下的图像文件嵌入到私有区块链中。
**准备步骤** ，这是服务器A上的设置：
1.开始在服务器A上进行挖掘；
2.将METAMASK连接到服务器A上的以太坊专用网络；
3.在METAMASK上创建一个帐户，然后将Ether从服务器A上的Coinbase帐户发送到该帐户；
4.在METAMASK的设置中，打开“ Show Hex Data”开关。
**嵌入文件** ，描述了将文件嵌入到区块链中的过程：
1.要获取文件（例如pic.jpg）的十六进制转储，执行以下命令并将结果复制到剪贴板；
xxd -p pic.png | perl -pe ’s/ n//g’
2.单击METAMASK上的“SEND”；
3.选择任何帐户发送交易，并将文件的十六进制转储粘贴到“Hex Data”字段中；
4.单击“NEXT”和“CONFIRM”发送交易；
5.区块链收到交易后，可以确认区块链在服务器B的Web应用程序中包含hexdump。
**提取文件** ，下面给出了从区块链中提取文件的过程。应当注意，提取文件的名称为“ pic extract.png”：
1.复制服务器B的Web应用程序上显示的十六进制字符串;
2.用十六进制字符串上的以下命令替换并执行它。
echo  | xxd -p -r > pic extracted.png
## 0x07 Discussion
###  1）可疑帐户的行为
单个帐户可以将三个exe文件（由Virus
Total判定为恶意软件）嵌入以太坊区块链，启发式分析可以检测分析可疑行为的恶意软件。考虑到可以针对区块链中毒实施启发式分析的可能性，观察了可疑账户的行为。在评估中发现，可疑帐户总共发送和接收了十笔交易。这些交易如下。假设“帐户X”表示可疑帐户，帐户A，B和C表示普通帐户。
这一系列交易表明攻击者试图检查恶意文件是否可以嵌入到区块链中。这种尝试可以解释如下：
首先，这个可疑帐户收到了一些以太币（1），用于发送交易并将数据嵌入交易中。为了检查可嵌入到区块链中的数据大小，该帐户发送了两个大小不同的交易（3）（4）。接下来，该帐户发送了一个交易嵌入式PNG文件，以检查它是否可以嵌入到区块链中（5）。然后，该帐户发送了包含恶意软件二进制文件的三个事务，以检查是否可以将恶意文件嵌入到区块链中（6）（7）（8）。
通过一个帐户发现了可疑行为。但是，恶意软件与此类可疑帐户之间存在明显的区别。恶意软件会采取一系列措施。相比之下，攻击者还可以在区块链上创建无限账户（例如地址）。尽管在这种情况下，单个帐户发送了交易，但是它们可以被多个帐户划分和发送。因此，由于区块链上恶意软件和账户之间的差异，对每个账户进行启发式分析是无效的，应通过观察每个交易而不是账户来采取针对区块链投毒的对策。
###  7.2区块链灵活空间的风险
考虑到对可编程空间的评估以及投毒攻击的实验，讨论了以太坊区块链的灵活空间带来的风险，以下是增加风险的原因。
嵌入数据的功能已正式提供：除了OP
RETURN和Coinbase交易外，禁止将任意数据嵌入比特币区块链的技术被正式允许。因此，当将任何没有灵活空间的数据嵌入到区块链中时，有必要使用“编码比特币脚本”之类的方法，因为此类区块链的通用钱包没有嵌入功能。
但是，对于具有灵活空间的区块链（包括以太坊），正式提供了一些将数据写入空间的功能。攻击者可以使用钱包应用程序（良性用户也可以使用它们）通过相同的过程执行投毒攻击。因此，区块链中的灵活空间可促进投攻击。
存在Explorer：每个区块链中都有一个名为Explorer的网站，提供与区块链相关的信息。这些网站的内容根据每个区块链的结构和功能而有所不同。如果区块链具有灵活的空间，则可以以任意形式（例如ascii和十六进制）轻松获取嵌入式数据。
可以使用Web浏览器通过Explorer将数据嵌入到区块链中，这意味着可以通过HTTP / HTTPS获得嵌入的数据，许多公司都允许使用HTTP /
HTTPS进行通信。对于使用C＆C的攻击者来说，具有灵活空间的区块链是一个优势。过去已经报道了使用博客和社交媒体的恶意软件和使用GitHub进行C＆C的恶意软件。使用Explorer的技术可以轻松地在此类恶意软件上实施。
对于攻击者而言，重要的是不要参与将数据从区块链迁移到Explorer网站的过程。当浏览器收到数据时，它们会独立访问Explorer网站。这意味着使用区块链Explorer的C＆C技术对于攻击是有效的，因为很难将僵尸程序链接到攻击者。
3）在合约中包装任意二进制文件的可能性
由于灵活性，不利的数据可以嵌入到区块链中。因此，作为解决区块链网络中不利交易的简单对策，可以降低用于嵌入数据的空间的灵活性。在本文中找到的大多数文件以hexdump形式嵌入，在以太坊中，可以通过仅将有效数据作为EVM代码来拒绝在其初始区域中具有文件十六进制转储的事务。
但是，即使代码是嵌入式hexdump，也可以将其成功编译为EVM代码，如上所示的Solidity源代码。这意味着可以制作一个有效的EVM代码，其中包含文件的任意十六进制转储。因此，很难采取措施将恶意数据嵌入到区块链中。
4）防止区块链投毒的对策
作为针对内容插入的对策之一，提出了强制性的最低收费以惩罚大笔交易。当然，经济成本是有效的，因为除了某些特定情况（例如降低算力）外，工作证明从未被打破。然而，由于缺乏数据的大小和恶意性之间的相关性，所提出的方法具有缺点。
以下可以被视为针对区块链投毒攻击的一种临时对策。该对策采用与其他合约相似性决定的强制性最低费用。费用是根据过去部署在区块链上的所有合约计算得出的，如果没有类似合约，费用会更大。随着类似合约数量的增加，最低费用会减少。
在这种机制中，发送交易的成本取决于类似合约的数量，而不是交易的大小。由于在区块链中此类恶意交易的数量很少，因此攻击者可能被迫支付高额费用。
先前的研究表明由于某些原因（例如重用合约的源代码），实际使用了类似的合约。在区块链网络中，区块的内容由网络参与者之间的共识确定。但是，如果文件是良性或恶意的，通常很难达成共识。
## 0x08 Conclution
为了评估区块链投毒攻击的风险，分析了以太坊区块链以检查实际情况，并使用实验性区块链环境验证了攻击的难易程度。
确认在以太坊区块链上嵌入了154个文件，其中包括一些恶意文件。此外，证明了使用Web浏览器和Shell命令可以轻松执行区块链投毒。指出了使用以太坊区块链进行C＆C技术的可能性，该方法可以轻松地应用于现有的恶意软件，因为它们使用HTTP
/ HTTPS协议从botmaster接收命令。