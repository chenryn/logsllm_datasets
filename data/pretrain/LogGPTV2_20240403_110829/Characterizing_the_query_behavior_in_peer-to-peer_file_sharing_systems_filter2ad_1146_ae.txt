 100
 10
 1000
 1
Time After Last Query, x (sec)
(c) Each Key Period,  
 10000 100000
Peers in Europe 
Figure 9. Distribution of Time After Last Query for Active Sessions 
region. 
The analysis of the correlation between query interarrival time and 
number  of  queries  per  session  reveals  some  interesting  results. 
Whereas  there  is  no  significant  correlation  between  these  two 
measures  for  North  American  peers,  sessions  of  European  peers 
with  many  queries  have  smaller  interarrival  times  than  sessions 
with few queries as can be seen in Figure 8 (b). This indicates that 
there  is  a  difference  in  the  environment  of  North  American  and 
European peers like e.g. the prizing model of the Internet service 
providers. Due to this difference sessions of North American peers 
with many queries tend to connect for a longer period compared to 
similar  sessions  of  European  peers.  We  conclude  that  the  query 
interarrival time has to be conditioned on the number of queries per 
session for European peers but not for North American peers.  
To  analyze the correlation to  time  of  day,  Figures  8  (c)  plots  the 
CCDF of query interarrival time of broken down to the important 
daily time periods for European peers. It show that queries issued in 
peak  hours  (all  daily  periods  except  03:00-04:00)  have  longer 
interarrival  times  than  queries  issued  in  non-peak  hours.  For 
example,  94%  of  the  queries  issued  in  Europe  between  3:00  and 
4:00  have  an  interarrival  time  below  100  seconds,  while  this 
fraction is only 85% for sessions starting between 11:00 and 12:00. 
Results  for  the  other  geographical  regions  are  identical.  We 
conclude that query interarrival time shows a significant correlation 
to time of day.  
As  before,  we  provide  a  ready-to-use  model  for  the  conditional 
distributions of the query interarrival time in the Appendix. Figure 
A.1 (c) shows that a bimodal distribution composed of a lognormal 
body  and  a  Pareto  tail  matches  well  to  the  measured  query 
interarrival times. The parameters for the conditional distributions 
are summarized in Table A.4. 
Figure 9 (a) plots the CCDF of the time after the last query broken 
down  by  geographical  region.  The  figure  shows  that  only  a  very 
small fraction of peers close the connection in less than 12 seconds 
after the last query. Furthermore, the distributions are very similar 
for North American and European peers, while Asian peers tend to 
close  sessions  much  faster.  For  instance,  the  fraction  of  sessions 
with a time after last query of more than 1000 seconds is 20% for 
Europe  and  North  America,  while  it  is  only  10%  for  Asia.  We 
conclude  that  there  is  a  significant  correlation  between  time  after 
last query and geographical region. 
The  correlation  between  time  after  last  query  and  the  number  of 
queries  per  session  is  shown  in  Figure  9  (b).  We  observe  the 
smallest  and  greatest  values  for  the  time  after  the  last  query  for 
sessions  with  a  single  query,  and  with  8  and  more  queries, 
respectively.  Furthermore,  the  conditional  distributions  for  2 
queries  and  3  to  7  queries  are  identical  for  99%  of  the  sessions, 
similar  to  the  curves  for  exactly  8  and  more  than  8  queries. 
Combining both distributions of these pairs, we observe a positive 
correlation between time after last query and number of queries per 
session for 90% of the sessions. We conclude from Figure 9 (b) that 
the  distribution  of  time  after  last  query  must  be  conditioned  on 
number of queries per session.  
Analyzing  the  correlation  to  time  of  day  for  European  peers  in 
Figure 9 (c), we find that sessions sending the last query in the non-
peak  hours  have  a  shorter  time  after  last  query  than  sessions 
sending the last query in peak hours. This trend is most noticeable 
in Europe, where the time after the last query for sessions sending 
the last query between 03:00 and 04:00 is below 10,000 seconds for 
more  than  99%  of  the  sessions,  while  it  is  below  91%  of  the 
sessions sending the last query at other times. For North American 
peers we observe the same trend. We conclude from Figure 9 (c) 
that time after last query is significantly correlated to time of day. 
The  time  after  the  last  query  conditioned  on  geographical  region, 
time of day and number of queries per session is well modeled by a 
lognormal distribution. As before the parameters for the conditional 
distributions are provided in Table A.5. 
4.6  Query Popularity Distribution 
Since users’ interests will change over time, we expect that the set 
of  queries  that  are  popular  will  change  within  the  measurement 
period.  To  confirm  this  assumption,  we  illustrate  the  drift  in  the 
most popular queries, i.e., the hot set drift [11]. For illustration, we 
determine the number of the top ten queries on day n that are found 
among  the  top  N  document  on  the  subsequent  day,  for  N=10,  20 
and  100.  Furthermore,  we  perform  the  same  experiment  for  the 
queries with rank 11-20 and 21-100 on day n, respectively. Figure 
10  plots  the  CCDF  of  the  observed  distributions  for  North 
American peers. The figure shows that for about 80% of the days 
the  number  of  top  10  queries  that  is  found  in  the  top  100  on  the 
subsequent day is not larger than 4, indicating a significant hot set 
drift.  Even  the  top  100  queries  change  significantly  from  day  to 
day, as Figure 10 (c) illustrates. We conclude from Figure 10 that 
the  query  popularity  distribution  cannot  be  calculated  over  the 
entire trace, since the hot set drift must be considered. 
In  addition  to  temporal  influences,  we  conjecture  that  the  query 
popularity  distribution  depends  on  the  geographical  location  of 
peers. To confirm this conjecture, we determine the set of distinct 
queries  issued  by  North  American,  European  and  Asian  peers, 
subsequently, for periods of length N=1,2, and 4 days. Furthermore, 
we determine the pair-wise intersection between the query sets and 
N=100
N=20
N=10
x
>
h
t
i
w
s
y
a
D
f
o
n
o
i
t
c
a
r
F
1
+
n
y
a
D
n
o
N
p
o
T
n
i
 4
 0.8
 0.6
 0.4
 0.2
 0
N=100
N=20
N=10
x
>
h
t
i
w
s
y
a
D
f
o
n
o
i
t
c
a
r
F
1
+
n
y
a
D
n
o
N
p
o
T
n
i
 0.8
 0.6
 0.4
 0.2
 0
 0
N=100
N=20
N=10
 1
 2
 3
Number of Queries, x
x
>
h
t
i
w
s
y
a
D
f
o
n
o
i
t
c
a
r
F
1
+
n
y
a
D
n
o
N
p
o
T
n
i
 4
(a) Top 10 on Day n 
 0.8
 0.6
 0.4
 0.2
 0
 0
 1
 2
 3
Number of Queries, x
(b) Rank 11-20 on Day n 
 2
 3
 4
 0
 1
Number of Queries, x
(c) Rank 21-100 on Day n 
Figure 10. Drift in Query Popularity (North American Peers) 
the  intersection  of  all  three  sets.  The  cardinalities  of  the  sets  for 
typical periods are shown in Table 3. We note that the cardinality 
of the intersection between the query sets of North American and 
European  peers  is  about  2.8%  of  the  cardinality  of  the  North 
American set and the European set for a single day. Even for a 4-
day period, the cardinality of the intersection is not larger than 6%. 
The relative cardinality of the intersection of the query sets from all 
three  continents  is  about  0.001%  and  0.02%  for  all  geographical 
regions  and  periods.  We  conclude  from  Table  3  that  peers  from 
different geographical regions issue different queries. Nevertheless, 
there is a small intersection that should be considered in an accurate 
workload model. 
As  a  consequence  of  Figure  10  and  Table  3,  we  employ  the 
following  methodology  for  calculation  of  representative  query 
popularity  distributions.  To  account  for  geographical  correlations, 
we divide the queries for each day into seven sets, i.e., one set for 
queries that are issued only from a single geographical region, three 
sets  for  queries  that  are  issued  by  peers  from  two  geographical 
regions (one for each pair), and one set of queries that are issued by 
peers from all three regions. We rank the queries by their frequency 
for each day and each of the seven subsets. To consider the hot set 
drift, we calculate the average frequency for a query with rank i for 
all days. Note, that according to Figure 10 the query with rank i on 
day n in general is different from the query with rank i on day n+1. 
Thus, ranking queries separately for each day preserves the hot-set 
drift and we obtain an average distribution of query popularity for a 
single day. 
Figure 11 plots the pmf of the popularity distributions for the class 
of  queries  issued  only  by  North  American  peers,  the  class  issued 
only  by  European  peers,  and  the  class  of  queries  issued  by  both 
North American and European peers. On a log-log scale, the curves 
are  nearly  linear,  indicating  that  the  query  popularity  per  day 
follows a Zipf-like distribution. Note that the skew in the Zipf-like 
distribution  (i.e.,  the  slope  of  the  line)  is  somewhat  different  for 
each region; in fact, the fitted Zipf-like distribution has parameter 
αNA=0.386 for queries issued only in North America, and αE=0.223 
for  queries  issued  only  in  Europe.  We  also  note  that,  similar  to 
[9,20],  when  we  computed  the  popularity  distribution  for  the 
aggregate set of queries over multiple (e.g., 4 or 10) days from our 
measurement trace, we observe a flattened head in the distribution 
(not shown to conserve space), since there are multiple queries in 
the aggregate set that were accessed with similar frequency but on 
different days. Similarly, the popularity distribution for the queries 
that are issued by both North American and European peers (shown 
in  Figure  11(c))  has  a  flattened  head  and  is  fit  by  two  different 
Zipf-like  distributions,  one  for  queries  ranked  1  to  45  with 
αI,body=0.453  and  the  other  for  queries  ranked  46  to  100  with 
αI,tail=4.67.  Furthermore,  the  values  of  these  Zipf  parameters  are 
significantly smaller than those observed in related work [20], due 
to  filtering  of  automated  queries.  This  fact,  again,  provides 
evidence that the filtering of automated client behavior is essential 
for  characterizing  user  behavior  in  a  peer-to-peer  file  sharing 
system. As a consequence of the small Zipf parameters, caching of 
responses  will  be  more  effectively  in  systems  that  use  aggressive 
automated re-query features than in systems that only issue queries 
on the users action. 
For synthetic workload generation, the results shown in Table 3 and 
Figure  11  can  be  used  as  follows:  For  North  American  peers,  a 
query is in the set of North American queries with a probability of 
0.97,  and  with  probability  0.03  in  the  intersection  set.  Thus,  for 
each query the set is chosen with these probabilities. After that, the 
query  is  chosen  by  a  Zipf  like  distribution  with  the  parameter 
determined  by  Figure  11  for  the  according  set.  We  use  only  two 
geographical  regions,  North  America  and  Europe  in  the  example. 
Table 3. Query Class Sizes  
Measure 
Number of Different Queries from North American Peers 
Number of Different Queries from European Peers 
Number of Different Queries from Asian Peers 
Number  of  Queries  in  Intersection  Set  between  North  American  an 
European Peers 
Number  of  Queries  in  Intersection  Set  between  North  American  and 
Asian Peers 
Number of Queries in Intersection Set between European and Asian Peers 
Number  of  Queries  in  Intersection  Set  between  North  American, 
European, and Asian Peers 
4-Day Period 
2-Day Period 
1-Day Period 
6106 
5382 
776 
323 
41 
28 
17 
3588 
3729 
299 
114 
15 
10 
4 
1990 
1934 
153 
56 
5 
5 
2 
r
y
r
e
u
Q
f
o
y
c
n
e
u
q
e
r
F
 0.1
 0.01
 0.001
 1e-04
 1
r
y
r
e
u
Q
f
o
y
c
n
e
u
q
e
r
F
 0.1
 0.01
 0.001
 1e-04
 1
Measured pmf
Fitted Zipf-like Distribution
 10
Query Rank, r
r
y
r
e
u
Q
f
o
y
c
n
e
u
q
e
r
F
 0.1
 0.01
 0.001
 1e-04
 1
100
Measured pmf
Fitted Zipf-like Distribution
 10
Query Rank, r
 100
(a) Queries by 
North American Peers Only 
(b) Queries by  
European Peers Only 
Figure 11. Distribution of Per Day Query Popularity 
Measured pmf
Fitted Zipf-like Distribution Body