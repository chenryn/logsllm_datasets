相对次要的系统可能会降低未来调查的门槛。另一方面，如果一个
作为PICDSS审核组成部分的系统遭到入侵，可能会对规章制度的遵
循以及客户的风险带来巨大的影响。
DHCP契约日志
许多攻击痕迹都围绕着IP地址。大多数企业为除了服务器之外的所
有计算机分配动态地址，因此对一个影响192.168.5.4的事件作出响
应可能是没有用处的，因为这台物理主机现在可能使用了一个不同
的IP地址。如果能够访问DHCP日志，我们就可以查找MAC地址，它
对于每个物理网络接口都是唯一的。
每个属性都为事件的评估增加了一个判断依据，最终可以增加判断
事件是否应该付诸行动的可信度。它们还提供了与主机的业务功能
有关的上下文信息，允许进行快速的商业影响评估，以便作出适当
的响应。
14.4小结
尽管IDP为执行事件检测提供了基础，但它们具有许多内在的限制，
需要使用其他技术或技巧实现更全面的覆盖率。在本章中，我们了
解了各种不同数据来源和观察点对于提高检测率的重要性。最重要
的是，富有弹性的事件检测模型允许使用一组范围很厂的技术和技
巧，使那些能够躲过一种或儿种检测技术的事件能够被其他技术所
捕捉。富有弹性的事件检测模型还保证了在监测基础设施的某个部
分的不可避免的失败（不管是由于人的错误、应用程序错误还是网
络错误）时将得到其他检测功能的弥补。有了正常的数据来源和检
测技巧，我们应该能够创建一种富有弹性和健壮的安全监测程序，
能够找到网络中的大多数安全事件。
第15章无需真实数据就能出色
完成工作
最大的隐私破坏都是由于数据窃贼偷取企业或政府的数据库内容所
造成的。设想一个能够完成实际工作却又不含有任何有用信息的数
据库。例如有一台能够回答问题的服务器，这些问题都是一些关于
2467
---
## Page 2469
你所购买的物品、你的下周四日程安排、你喜爱的电影以及其他无
数的类似琐碎问题。这种情形和许多其他连接到互联网的数据库类
似，但是如果有人偷偷地穿过防火墙，破译了密码，或者发现了其
他得到机器上超级用户控制权限的方法，那么他将找不到任何有用
的东西。即使是邪恶的黑客或者忍者偷偷地进人摆放服务器的机房
并且把硬盘挂载到取证分析仪上，也找不到任何有用的信息。
像这样的数据库看起来不太可能。一个并不清楚下周四将会发生什
么事情的数据库如何来回答关于下周四日程安排这样的问题呢？某
个地方一定藏有数据，对不对？
也有人建议用次优的解决方案来保护敏感数据。但是即使这些敏感
数据是在某个电子安全设备之中，而这个设备位于一座网络堡垒内
部的一间虚拟的石砌小屋之中，在堡垒之外是一条不可越过的软件
护城河，河里全是能够溶解任何数据的数字酸液，数据也依然存在
而且对某个足够聪明以致能够伪装成特权用户的人来说，仍然是有
安全危险的。在本章中，我所提出的解决方案比较独特。我承认数
据是存在的，但是以只对最终用户有用而对其他任何人都没有用的
形式存在。数据在发送给服务器之前由最终用户或者客户端对其进
行混乱，当客户端取回服务器的返回数据时再进行解码。虽然数据
仍留在数据库中，但除了正确的所有者之外，对其他任何人都是不
可理解的，也几乎是没用的。这种方法与简单地使用大多数数据库
中都内置的加密函数对数据库进行加密有点不同。数据库加密是由
数据库本身处理的，在存储和检索终端都存在可读版本的数据。数
据可能是以加密的形式存在的，但是数据库能够对其进行解密，然
后进行检索并给出结果。如果服务器知道整个过程，那么所有能够
攻入服务器或者网络的人都可以获取这些数据。
这种解决方案的技巧在于不要把数据库看做是一个什么都能看到的
预言机，而把它当做一个对所有经过它的信息流一无所知的数学交
换网络。然后选择性地对数据进行伪装并作半透明式的存储，这样
敏感的数据就隐藏起来了，而非敏感信息仍然保持明文。换句话
说，不要把数据库看做是一个受保护的堡垒，而把它看做是一个允
长的、不可攻击的、到处都是分散数据的透明云彩。
这种方法不需要任何高深的数据理论或者复杂的计算机科学知识。
人们已经很好地掌握了对信息进行加密和解密的工具，这些工具能
够有效地在现代CPU上运行，而且相对比较稳定。35年的公开研究
2468
---
## Page 2470
给我们提供了一个广泛的可选加密函数范围，也提供了各种机制用
于创造对其存储的信息一无所者的数据库。
这个系统也存在一些局限和缺陷。如果数据库真的什么都不知道，
那么它无法向程序员和依赖这些数据的人提供同样可信的基础以及
像一般数据库那样的稳定性。如果有人忘记了她的密码，即解密数
据库中所有数据的钥匙，那么这些数据就会永远无法还原了。如叶
芝所言，再也保不住中心山，因为中心什么也不知道。
这种方法有价值吗？它确实有价值，而且比大多数预想的还要大。
不错。但是没有任何实际意义。如果互联网想要读取我们的思想
那么它就要时刻掌握我们的动机。"我不这么认为。接下来进行测
试。我曾根据这个想法大致搭建了一个类似于业马逊（Amazon）这
样的大型在线商城，我发现这个商城能够提供所有最好的在线商城
所具有的功能，而不保存任何个人信息。此时，只需以半透明的形
式来存储数据，即一部分是可读的，另一部分是不透明的。
15.1数据半透明化的工作原理
这种商店看起来会是什么样的？解释它的基本设计模式的最好的办
法是通过一个例子来说明。表15-1给出了一个传统的商城中所用的
数据库表。
2469
---
## Page 2471
这些都是售货员和制定营销决策的人所需要的信息。他们需要知道
卖出了什么以及卖给了谁。
人们对这些数据库各有不同的本能反应。有些人很喜欢他们，而且
把这种效益看做是社会的一种网络收入（Brin1998）。其他有些人
担心这些信息可能会被用作其他目的。我们有保护人们电影租赁记
录的法律，因为这种数据在RobertBork的一次参议院听证会上成为
了焦点（Etzioni1999）。随着时间和习俗的改变，没有人知道将来
这些信息会包含什么。吸烟曾经十分风行，而且也是一种可接受的
按下生命终止键的方法。现如今，一些公司会因为抽烟而解雇员工
以减少医疗成本。未来的社会会怎样处理你目前的购物记录呢？
一家服装店可以通过宣布隐私保护条约来缓解消费者的顾虑，并且
将顾客的消费记录采用某种万无一失的策略保存起来，但仍然还会
发生隐私泄露的情况。这种情况有故意为之的（Wald2004，
Anon.2003，Shenon2003），也有无心的（Wald2007，Zeller2006，
2470
---
## Page 2472
Pfanner2007，除此之外还有很多），但是即使你采用安全的堡垒模
型也不可能阻止这种情况的发生。
半透明化方法可以解决这个问题，将某几列使用一种单向散列函数
来进行混乱，比如SHA256。SHA256是一种著名的散列函数，它是
不可逆的。就是说，如果有一个字符事x，你可以很容易的得到
SHA256（x），但是如果你手上是SHA256（x）的值，却不可能得
到字符串x2]。如果对客户的姓名进行散列，那么原来的明文姓名
就可以用BASE64（SHA256（姓名））的256位计算结果来替代。结
果类似于表15-23]。
销售部仍然可以从数据库中得到卖出了多少条卡其裤。市场部仍然
能够从中寻找客户的消费模式，比如ick93LKJ0dkK这个顾客同时买
了一条裤子和一件衬衫。但是，他的名字却是经过混淆的。
2471
---
## Page 2473
单向函数的价值在于把隐藏信息和让信息始终是可靠的这两种看起
来不相容的目标组合在了一起。也就是说，JamesMorrison可以将他
的名字的散列值以ick93LKJ0dkK这种形式交给商店，而商店也能够
知道数据库中相应的记录是属于他的，但是却无法知道他的真实姓
名。这种方法能够用于一些担保条款中，或者是常用的购物程序以
及自动建议工具中。能够根据顾客已往购买记录来计算出顾客消费
建议的网站同样也能够根据数字化名ick93LKJ0dkK来计算。
当JamesMorrison使用这些功能时，他可以提供他的名字以查看这些
计算结果。他不需要记住ick93LKJodkK这个字符串，因为他电脑上
的软件能够通过计算BASE64（SHA256（姓名））来重新得到这个
值。在这之后，ick93LKJ0dkK就成为一个正规的姓名。
混乱后的表中原始数据没有多大用。一个疯狂的毒品犯不可能只花
几个小时就能从一个半透明化的药店数据库中找出麻醉处方（Meier
2007，Harris 2004，Butterfield2001）±]。但这种方案还存在一些缺
陷。如果JamesMorrison的邻居恰好在这家商店工作，那么这个邻居
仍然能够查出JamesMorrison买了哪些东西，只需将名字正确的拼写
出来就可以了。这个不足可以通过要求JamesMorrison记住一个秘密
口令来消除，即由SHA256（姓名+口令）来计算出化名。这是一个
很好的解决办法，一旦JamesMorrison忘掉了这个口令，那么所有的
记录都将销毁。这也是为什么这种级别的安全最适合于那些不太
正式的应用程序的原因，比如在线商城。对于价值较高的记录而
言，这种方法可能没有什么意义，比如银行的存储证书。
[1]PaceYeats,the center cannothold，叶芝，爱尔兰著名诗人，这句诗
取自于他的《基督降临》（TheSecondComing）一诗。
[21用户需要密切关注对SHA256这类函数的攻击研究情况，已有许
多类似的函数被证明远没有达到完美的单向。例如，对诸如SHA256
这类的普通散列函数使用HMAC机制进行封装以提高安全性也是很
有意义的。
[3]256位用BASE64来表示通常是42又3分之2个字符。可以用
BASE64（SHA256（姓名））的前n个字符来保存原来的空格字符。
用更短的唯一字符串来表示也可以，这是一个目标。
[4]药店有记录药卖给哪个人的要求，这种要求限制了半透明化方法
的应用。但是也可以在本地分店使用半透明化的数据库，而在总部
保存真实姓名。
5]由拼错了密钥或者是忘记密钥所导致的错误可以用多种技术来限
制，比如删除空格、全部转换成大写字母，或者使用读音码
2472
---
## Page 2474
（SOUNDEXCode）。其他的解决方案在《半透明化的数据库》中
有详细的介绍（见15.6一节）。
15.2一个现实的例子
半透明化的数据库可以通过多种方式来节省系统管理员的时间和精
力，免除对他们所管理的数据的担忧。假设有一个记录了保姆工作
日程安排的数据库，家长们可以进行搜索以查看在某个特定的晚上
哪位保姆有空。它提供了一种减少家长和保姆之间进行多次麻烦的
电话联系的服务。我构建了一个这样的系统以研究我的想法的价
值。这个系统要求向客户分发一种牢靠的散列函数。中央服务器不
需要做任何的代码修改，因为经过散列处理的个人信息也是字符
串，它能够代替姓名。
这些保姆的信息在安全方面一直存在一些没有解决的麻烦。这些信
息被用于恶意目的的潜在风险很大，而且一旦如此，造成的损失也
是相当严重的，但是没有人对这种系统做出大的经济支持以解决这
个问题。这些保姆不像美国政府，他们没有钱来维护这种系统以保
护“核发射码”。
这么多的信息都集中在一块地方，而且只有一个管理员的密码来保
护。半透明化数据库能够降低这些信息的危险。与存储每个保姆的
姓名所不同的是，工作日程表能够以化名的形式来进行存储，如表
15-3所示。
2473
---