# 41丨数据挖掘实战（3）：如何对比特币走势进行预测？今天我带你用数据挖掘对比特币的走势进行预测和分析。我们之前介绍了数据挖掘算法中的分类、聚类、回归和关联分析算法，那么对于比特币走势的预测，采用哪种方法比较好呢？可能有些人会认为采用回归分析会好一些，因为预测的结果是连续的数值类型。实际上，数据挖掘算法还有一种叫时间序列分析的算法，时间序列分析模型建立了观察结果与时间变化的关系，能帮我们预测未来一段时间内的结果变化情况。那么时间序列分析和回归分析有哪些区别呢？首先，在选择模型前，我们需要确定结果与变量之间的关系。回归分析训练得到的是目标变量y 与自变量 x（一个或多个）的相关性，然后通过新的自变量 x 来预测目标变量y。而时间序列分析得到的是目标变量 y 与时间的相关性。另外，回归分析擅长的是多变量与目标结果之间的分析，即便是单一变量，也往往与时间无关。而时间序列分析建立在时间变化的基础上，它会分析目标变量的趋势、周期、时期和不稳定因素等。这些趋势和周期都是在时间维度的基础上，我们要观察的重要特征。那么针对今天要进行的预测比特币走势的项目，我们都需要掌握哪些目标呢？1.  了解时间序列预测的概念，以及常用的模型算法，包括 AR、MA、ARMA、ARIMA    模型等；2.  掌握并使用 ARMA 模型工具，对一个时间序列数据进行建模和预测；3.  对比特币的历史数据进行时间序列建模，并预测未来 6 个月的走势。``{=html}
## 时间序列预测关于时间序列，你可以把它理解为按照时间顺序组成的数字序列。实际上在中国古代的农业社会中，人们就将一年中不同时间节点和天气的规律总结了下来，形成了二十四节气，也就是从时间序列中观察天气和太阳的规律（只是当时没有时间序列模型和相应工具），从而使得农业得到迅速发展。在现代社会，时间序列在金融、经济、商业领域拥有广泛的应用。在时间序列预测模型中，有一些经典的模型，包括AR、MA、ARMA、ARIMA。我来给你简单介绍一下。AR 的英文全称叫做 AutoRegressive，中文叫自回归模型。这个算法的思想比较简单，它认为过去若干时刻的点通过线性组合，再加上白噪声就可以预测未来某个时刻的点。在我们日常生活环境中就存在白噪声，在数据挖掘的过程中，你可以把它理解为一个期望为0，方差为常数的纯随机过程。AR 模型还存在一个阶数，称为AR（p）模型，也叫作 p 阶自回归模型。它指的是通过这个时刻点的前 p个点，通过线性组合再加上白噪声来预测当前时刻点的值。MA 的英文全称叫做 Moving Average，中文叫做滑动平均模型。它与 AR模型大同小异，AR 模型是历史时序值的线性组合，MA是通过历史白噪声进行线性组合来影响当前时刻点。AR模型中的历史白噪声是通过影响历史时序值，从而间接影响到当前时刻点的预测值。同样MA 模型也存在一个阶数，称为 MA(q) 模型，也叫作 q阶移动平均模型。我们能看到 AR 和 MA 模型都存在阶数，在 AR 模型中，我们用p 表示，在 MA 模型中我们用 q 表示，这两个模型大同小异，与 AR模型不同的是 MA 模型是历史白噪声的线性组合。ARMA 的英文全称是 Auto Regressive MovingAverage，中文叫做自回归滑动平均模型，也就是 AR 模型和 MA模型的混合。相比 AR 模型和 MA 模型，它有更准确的估计。同样 ARMA 模型存在p 和 q 两个阶数，称为 ARMA(p,q) 模型。ARIMA 的英文全称是 Auto Regressive Integrated Moving Average模型，中文叫差分自回归滑动平均模型，也叫求合自回归滑动平均模型。相比于ARMA，ARIMA多了一个差分的过程，作用是对不平稳数据进行差分平稳，在差分平稳后再进行建模。ARIMA的原理和 ARMA 模型一样。相比于 ARMA(p,q) 的两个阶数，ARIMA是一个三元组的阶数 (p,d,q)，称为 ARIMA(p,d,q) 模型。其中 d 是差分阶数。
## ARMA 模型工具上面介绍的 AR，MA，ARMA，ARIMA四种模型，你只需要了解基础概念即可，中间涉及到的一些数学公式这里不进行展开。在实际工作中，我们更多的是使用工具，我在这里主要讲解下如何使用 ARMA模型工具。在使用 ARMA 工具前，你需要先引用相关工具包：    from statsmodels.tsa.arima_model import ARMA然后通过 ARMA(endog,order,exog=None) 创建 ARMA类，这里有一些主要的参数简单说明下：endog：英文是 endogenousvariable，代表内生变量，又叫非政策性变量，它是由模型决定的，不被政策左右，可以说是我们想要分析的变量，或者说是我们这次项目中需要用到的变量。order：代表是 p 和 q 的值，也就是 ARMA 中的阶数。exog：英文是 exogenousvariables，代表外生变量。外生变量和内生变量一样是经济模型中的两个重要变量。相对于内生变量而言，外生变量又称作为政策性变量，在经济机制内受外部因素的影响，不是我们模型要研究的变量。举个例子，如果我们想要创建 ARMA(7,0)模型，可以写成：ARMA(data,(7,0))，其中 data 是我们想要观察的变量，(7,0)代表 (p,q) 的阶数。创建好之后，我们可以通过 fit 函数进行拟合，通过 predict(start, end)函数进行预测，其中 start 为预测的起始时间，end 为预测的终止时间。下面我们使用 ARMA 模型对一组时间序列做建模，代码如下：    
# coding:utf-8
# 用 ARMA 进行时间序列预测import pandas as pdimport matplotlib.pyplot as pltimport statsmodels.api as smfrom statsmodels.tsa.arima_model import ARMAfrom statsmodels.graphics.api import qqplot
# 创建数据data = [5922, 5308, 5546, 5975, 2704, 1767, 4111, 5542, 4726, 5866, 6183, 3199, 1471, 1325, 6618, 6644, 5337, 7064, 2912, 1456, 4705, 4579, 4990, 4331, 4481, 1813, 1258, 4383, 5451, 5169, 5362, 6259, 3743, 2268, 5397, 5821, 6115, 6631, 6474, 4134, 2728, 5753, 7130, 7860, 6991, 7499, 5301, 2808, 6755, 6658, 7644, 6472, 8680, 6366, 5252, 8223, 8181, 10548, 11823, 14640, 9873, 6613, 14415, 13204, 14982, 9690, 10693, 8276, 4519, 7865, 8137, 10022, 7646, 8749, 5246, 4736, 9705, 7501, 9587, 10078, 9732, 6986, 4385, 8451, 9815, 10894, 10287, 9666, 6072, 5418]data=pd.Series(data)data_index = sm.tsa.datetools.dates_from_range('1901','1990')
# 绘制数据图data.index = pd.Index(data_index)data.plot(figsize=(12,8))plt.show()
# 创建 ARMA 模型 
# 创建 ARMA 模型arma = ARMA(data,(7,0)).fit()print('AIC: %0.4lf' %arma.aic)
# 模型预测predict_y = arma.predict('1990', '2000')
# 预测结果绘制fig, ax = plt.subplots(figsize=(12, 8))ax = data.ix['1901':].plot(ax=ax)predict_y.plot(ax=ax)plt.show()运行结果：    AIC: 1619.6323![](Images/3fd907b161ef7d75179af9f2ebe5b34c.png){savepage-src="https://static001.geekbang.org/resource/image/71/6a/71c5fe77926ba65e4b4aca48c337c66a.png"}![](Images/86925c4e0704ccf88a0a0a058b09f1ae.png){savepage-src="https://static001.geekbang.org/resource/image/08/fc/082ff6d7e85e176b8fd5c38f528314fc.png"}\我创建了 1901 年 -1990 年之间的时间序列数据 data，然后创建 ARMA(7,0)模型，并传入时间序列数据 data，使用 fit 函数拟合，然后对 1990 年 -2000年之间的数据进行预测，最后绘制预测结果。你能看到 ARMA 工具的使用还是很方便的，只是我们需要 p 和 q的取值。实际项目中，我们可以给 p 和 q 指定一个范围，让 ARMA都运行一下，然后选择最适合的模型。你可能会问，怎么判断一个模型是否适合？我们需要引入 AIC准则，也叫作赤池消息准则，它是衡量统计模型拟合好坏的一个标准，数值越小代表模型拟合得越好。在这个例子中，你能看到 ARMA(7,0) 这个模型拟合出来的 AIC 是1619.6323（并不一定是最优）。