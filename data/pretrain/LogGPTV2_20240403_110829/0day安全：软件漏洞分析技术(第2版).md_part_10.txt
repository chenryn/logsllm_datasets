x
JNE SHORT 0040107F
PFhNOP
LastErr
HDNF,
8012F884
提示跳转不会发生，程序将
进入错误密码的处理流程
图1.4.8破解前的状态
34
---
## Page 60
第
密码验证函数的返回值将存在EAX寄存器中，if（）语句通过以下两条指令实现。
1
TEST EAX,EAX
章
XXXXX30
基
也就是说，EAX中的值为0时，跳转将被执行，程序进入密码确认流程：否则跳转不执行，
础
程序进入密码重输的流程。由于现在输入的是错误密码，所以可以在预执行区看到提示：“Jump
知
识
is not taken”。
如果我们把JE这条指令的机器代码修改成JINE（非0则跳转），那么整个程序的逻辑就会
反过来：输入错误的密码会被确认，输入正确的密码反而要求重新输入！当然，把
TESTEAX,EAX
指令修改成
XOREAX,EAX
也能达到改变程序流程的目的，这时不论正确与否，密码都将被接受。
双击JE这条指令，将其修改成JNE，单击“Assemble”按钮将其写入内存，如图1.4.9
所示。
1alyhg-crerk_te[ctacas.tjane-[U-min lhreaf_miodeetrack_mn]
-X
1a0.3
_.86A8107F
原本JE对应的机器指令为
74，改成JIN之之后变成75
HSH
PiIH crar)
提示跳转将要发生，程序将
进入正确密码的处理流程！
图1.4.9破解后的状态
OllyDbg将汇编指令翻译成机器代码后写入内存。原来内存中的机器代码74（JE）现在变
成了75（JNE）。此外，在预执行区中的提示也发生了变化，提示跳转将要发生，也就是说，
在修改了一个字节的内存数据后，错误的密码也将跳入正确的执行流程！后面您可以单步执行，
看看程序是不是如我们所料执行了正确密码才应该执行的指令。
35
---
## Page 61
day
0
上面只是在内存中修改程序，我们还需要在二进制文件中也修改相应的字节。这就要用到
安全：
第2章讲到的内存地址VA与文件地址之间的对应关系了。
用LordPE打开.exe文件，查看PE文件的节信息，如图1.4.10所示。
软件漏洞分析技术
VOtf
JVSue
ROfhe..
RSi
rdata
00001000
00006000
00004BA2
00000822
00010000
00006000
00005000
00001000
60000020
lata
00007000
00001E68
00007000
00001000
CO000040
40000040
0108
NuOlRvlndSi00000010
（第
图1.4.10计算文件偏移地址
2版
我们已经知道跳转指令在内存中的地址是VA=0x0040106E，
按照第2章VA与文件地址的换算公式：
文件偏移地址=虚拟内存地址（VA）-装载基址（ImageBase）-节偏移
=0x0040106E-0x00400000-（0x00001000-0x00001000)
=0x106E
也就是说，这条指令在PE文件中位于距离文件开始处106E字节的地方。用UltraEdit按
照二进制方式打开crack_me.exe文件，如图1.4.11所示。
UhraEdit-3z.
leEdSeerhBroetYFomgColupnHeocroadvancedndow_teb
cack_m
比XGO
区
00000000
OK
00177F0000EZ？......
000000201
000000101
006e
D000000000
Cancel
0000
00000030
Do De
00
0O
00:
Fa HEXad O77
CCD
00
00
ForDec
21
-7.777L7Th
DOOD0O50I
61
6E
44
4F
53
00
4F
.R衔OR衔OR衔O
0090h1
BA
DO
C5
53
CT
CE
D1
D3
CO
CE
1F1
000000e0h:
52
CF
4F
CE
4F
30
DO
PD
CZ
0%前00体000
DA
DO
C4
61
CF
CE
AF
52
CF
CE
4F
TO
00
DO
0O
00
00
00
DO
00
00
Q0
0O
00
0O
0O
DO
0O
DO
DO
01
EO
0O
FD OE
EA
16
00
00
00
00
00
00
0
EO
00
OF
01
00000010b:
OB 01
06
00
00
50
00
00
00
30
00
O0
00
00000100b:
D010
0O
00
00
10
00
OO
60
00
QC
0O
40
0O
00000110b:
001000：
0000
00
04
00
00
00
00
0O
00
0000120b:04 000000 00000000
68
10
OH,0,CW
DO
Mod：913/20
Fle
图1.4.11修改PE文件
按快捷键Ctrl+G，输入0x106E直接跳到JE指令的机器代码处，如图1.4.12所示。
36
---
## Page 62
第
1
章
oackm
基
00001060h:4C240C51ZB97FFFF7P83C410B5C00F:L.O
效
础
00001070h:
00001060h:
04040000C3:
Bp8.?.......?
知
38704000E61E0D0000
81
C4
00001090h:
8D 44 24 0650 77
742408
CO
70
4000E85D：皖$.Pt$.he.
识
000010a0h:
01
00
00
B3
C4
OC
CS
56
BE
EO
70
40
00 57 56 ;
效.肝v距p.w
000010b0h:
B
BS OC
880000
168D
44
24
16
50
FT742418：....P
280D0000B3;v...Vu7...?
ts.
000010c0b1
000010d0h:
EO
C4
18
BB
C3
5F
SE
ES
C3
55
BE
EC
Y9
FT
68
A8
60：？饰_[胱]
00 50 64 89; 8.h78.d7...Pd7
b
000010e0h:
4000
68
DC
2F
40
00
64
A1
00
00
00
Do0010t0h:
00
EC
10
ES
56
57
65E8FF 15;....发.svw8？.
00001100h:
04
50
40
EE
D2
BA
D-4
B9
15
58