9753.9K (100.0%)
6647.8K (75.1%)
954.1K (98.6%)
cache probing
DNS logs
cache probing ∪ DNS logs
Microsoft clients
Microsoft resolvers
Table 1: Each entry shows the size of intersection of the set of /24 prefixes observed in the two datasets. In parentheses is the percent of the row
dataset also observed in the column dataset. The diagonal gives the size of each dataset.
line is the minimum activity consistent with our measurements, a
single active /24 per non-overlapping prefix with a cache hit. The
upper bound is the maximum amount of activity, where we assume
activity exists within all /24 prefixes in a prefix with a cache hit.
The results vary widely across ASes—some have only a small
fraction of prefixes active, while some have most/all prefixes active.
This result shows that APNIC’s per-AS granularity is too coarse
for use cases that need to understand activity at the IP-level. Our
techniques help fill that gap. The result also shows that our current
technique allows a wide range of interpretations—the median per-
centage of active prefixes per AS could be anywhere between 25%
and 100%—suggesting room to refine our techniques.
Prefix-level analysis. Table 1 shows the overlap in /24 prefixes
found to be hosting clients using our methods and in privileged
Microsoft traces. We upper bound our cache probing coverage by
assuming that, if it found a prefix to contain clients, all /24 prefixes
within that (possibly larger) prefix contain clients. Our methods
capture prefixes that include 9.75M /24 prefixes in total, including
75.1% of /24 prefixes seen by Microsoft clients, and those /24
prefixes represent 95.2% of Microsoft clients volume. Although
our DNS logs method only finds 692.2K prefixes, 95.5% of these
prefixes were also in Microsoft clients, suggesting that these
prefixes do host clients (high precision). However, only 6.6M (74.7%)
of the /24 prefixes included in cache probing were also seen by
Microsoft clients, suggesting that our upper bound on cache
probing is too generous. Our future work will try to improve the
precision. Still, 99.1% of prefixes returned as the scope for our cache
probing queries contain at least one /24 in Microsoft clients, so
our cache probing method has few false positives.
5 RELATED WORK
Our cache snooping approach is inspired by earlier approaches
that either cache snoop Google Public DNS or use ECS to simulate
access to vantage points worldwide, although we are not aware
of any earlier work that uses these approaches for our goal of
understanding global Internet usage. Two studies used ECS scans
of the entire IPv4 space to uncover the client-to-server mapping
for CDNs [7, 34]. That work did not use Google Public DNS and
was interested in where a CDN would direct an ECS prefix, not
in whether actual clients from that prefix had queried for popular
domains. A recent study demonstrated how cache snooping on
Google Public DNS (and other public DNS services) can be used to
estimate the usage of rare domains [31]. The particular approach in
that study did not achieve the global coverage that is our goal, as it
did not use ECS and limited itself to measurements from 43 United
States vantage points. So, its cache snooping was limited to results
for ≤ 43 client prefixes to 7 Google PoPs. Other work investigated
the ECS behavior of recursive resolvers [3].
758
Previous work estimated the popularity of websites by using
open resolvers [29, 37]. Our work instead uses popular domains to
identify Internet clients. A recent study analyzes ECS queries from
Google Public DNS as seen in traces at an authoritative resolver
to understand usage of Google Public DNS [14]. The study reveals
interesting aspects of Google Public DNS adoption, although the
queries do not provide an unbiased view of global usage because
the resolver is mainly authoritative for Dutch domain names. A
study measured connection logs from a CDN to estimate Internet
activity at the IP address granularity [32]. They use activity metrics
as a proxy to assess IPv4 address scarcity and characterize Internet
growth. We used similar logs for our Microsoft clients dataset.
6 CONCLUSIONS AND FUTURE WORK
Measuring user Internet activity would provide a rich source of data
to help answer research questions. We present preliminary work
on new techniques for measuring client activity—cache probing
Google Public DNS and crawling root DNS traces. Our techniques
have global coverage, can be replicated by other researchers with-
out privileged data, and provide fine-grained client activity data
(at the resolver or prefix level). Going forward, we will explore
how to infer which prefixes with client activity likely include (hu-
man) user activity, using signals such as activity across a range of
user-facing services, patterns over time (e.g., diurnal patterns), and
consistency across methods (e.g., using Chromium and querying
popular services).
Future work will focus on obtaining a relative activity ranking
across prefixes, similar to how APNIC lists ASes by Internet user
population [19]. We envision two major directions. First, we want to
combine the information from our two techniques, which is difficult
since cache probing measures client prefix activity whereas DNS
logs measures recursive resolver prefix activity. One possibility is to
join on geolocation—since users are often physically close to and in
the same AS as their recursive resolver [10], we can estimate activity
at the ⟨region, AS⟩ granularity and associate that activity with
active prefixes in that ⟨region, AS⟩. Second, the cache probing
technique yields different results depending on where and when
it is run, and on which domains. We are developing techniques to
estimate a prefix’s cache hit rates over time and across domains,
as a step towards a relative ranking of prefix activity levels. Our
contemporaneous workshop paper presents initial validation of
this approach to measuring relative prefix activity levels as part of
a vision for an Internet traffic map [20].
Future work can investigate which methodologies for measuring
activity—including both ours and others—are best for particular
questions, to bring us closer to understanding how users are affected
by, interact with, and are a part of different areas of the Internet.
Towards Identifying Networks with Internet Clients Using Public Data
IMC ’21, November 2–4, 2021, Virtual Event, USA
Acknowledgements. This paper has been partially funded by
NSF grant CNS-1836872. We would like to thank our shepherd
Philipp Richter and the anonymous reviewers for their insightful
comments, Google Public DNS operators for information about their
system, and John Heidemann for validating some of our root DNS
analysis. We acknowledge the Trufflehunter authors [31], especially
Audrey Randall and Aaron Schulman, for inspiring aspects of our
approach and for answering our questions about their work.
REFERENCES
[1] Routeviews prefix to AS mappings dataset for IPv4 and IPv6, 2021. URL https:
//www.caida.org/catalog/datasets/routeviews-prefix2as/.
[2] Moheeb Abu Rajab, Jay Zarfoss, Fabian Monrose, and Andreas Terzis. A mul-
In ACM IMC,
tifaceted approach to understanding the botnet phenomenon.
2006.
[3] Rami Al-Dalky, Michael Rabinovich, and Kyle Schomp. A look at the ECS behavior
of DNS resolvers. In ACM IMC, 2019.
[4] Pelayo Vallina Alvaro Feal, Julien Gamba, Sergio Pastrana, Antonio Nappa, Oliver
Hohlfeld, Narseo Vallina-Rodriguez, and Juan Tapiador. Blocklist babel: On the
transparency and dynamics of open source blocklisting. IEEE Transactions on
Network and Service Management, April 2021.
[5] Todd Arnold, Ege Gürmeriçliler, Georgia Essig, Arpit Gupta, Matt Calder, Vasileios
Giotsas, and Ethan Katz-Bassett. (How much) does a private WAN improve cloud
performance? In IEEE INFOCOM, 2020.
[6] Todd Arnold, Jia He, Weifan Jiang, Matt Calder, Italo Cunha, Vasileios Giotsas,
and Ethan Katz-Bassett. Cloud provider connectivity in the flat Internet. In ACM
IMC, 2020.
[7] Matt Calder, Xun Fan, Zi Hu, Ethan Katz-Bassett, John Heidemann, and Ramesh
Govindan. Mapping the expansion of Google’s serving infrastructure. In ACM
IMC, 2013.
[8] Matt Calder, Ashley Flavel, Ethan Katz-Bassett, Ratul Mahajan, and Jitendra
Padhye. Analyzing the performance of an anycast CDN. In ACM IMC, 2015.
[9] Matt Calder, Xun Fan, and Liang Zhu. A cloud provider’s view of EDNS client-
subnet adoption. In TMA, 2019.
[10] Fangfei Chen, Ramesh K Sitaraman, and Marcelo Torres. End-user mapping:
Next generation request routing for content delivery. In ACM SIGCOMM, 2015.
[11] Yi-Ching Chiu, Brandon Schlinker, Abhishek Balaji Radhakrishnan, Ethan Katz-
Bassett, and Ramesh Govindan. Are we one hop away from a better Internet? In
ACM IMC, 2015.
[12] David R Choffnes and Fabián E Bustamante. Taming the torrent: a practical
approach to reducing cross-isp traffic in peer-to-peer systems. In ACM SIGCOMM,
2008.
[13] Carlo Contavalli, Wilmer van der Gaast, David C. Lawrence, and Warren Kumari.
Client subnet in DNS queries. RFC 7871, RFC Editor, May 2016. URL https:
//datatracker.ietf.org/doc/html/rfc7871.
[14] Wouter de Vries, Roland van Rijswijk-Deij, Pieter-Tjerk de Boer, and Aiko Pras.
Passive observations of a large DNS service: 2.5 years in the life of Google. In
TMA, 2018.
[15] DITL. DITL traces and analysis | DNS-OARC, 2020. URL https://www.dns-
oarc.net/oarc/data/ditl.
[16] Manaf Gharaibeh, Anant Shah, Bradley Huffaker, Han Zhang, Roya Ensafi, and
Christos Papadopoulos. A look at router geolocation in public and commercial
databases. In ACM IMC, 2017.
[17] Petros Gigis, Vasileios Kotronis, Emile Aben, Stephen D Strowes, and Xenofontas
Dimitropoulos. Characterizing user-to-user connectivity with RIPE Atlas. In
ACM/IRTF ANRW, 2017.
[18] John Heidemann, Yuri Pradkin, Ramesh Govindan, Christos Papadopoulos,
Genevieve Bartlett, and Joseph Bannister. Census and survey of the visible
Internet. In ACM IMC, 2008.
[19] Geoff Huston. How big is that network?, 2014. URL https://labs.apnic.net/?p=526.
[20] Thomas Koch, Weifan Jiang, Tao Luo, Petros Gigis, Ethan Katz-Bassett, Matt
Calder, Georgios Smaragdakis, Lefteris Manassakis, Emile Aben, and Narseo
Vallina-Rodriguez. Towards a traffic map of the Internet. In ACM HotNets, 2021.
[21] Thomas Koch, Ke Li, Calvin Ardi, Ethan Katz-Bassett, Matt Calder, and John
Heidemann. Anycast in context: A tale of two systems. In ACM SIGCOMM, 2021.
[22] Vasileios Kotronis, George Nomikos, Lefteris Manassakis, Dimitris Mavrommatis,
and Xenofontas Dimitropoulos. Shortcuts through colocation facilities. In ACM
IMC, 2017.
[23] Zhihao Li. Diagnosing and Improving the Performance of Internet Anycast. PhD
thesis, University of Maryland, 2019.
[24] Zhihao Li, Dave Levin, Neil Spring, and Bobby Bhattacharjee. Internet anycast:
performance, problems, & potential. In ACM SIGCOMM, 2018.
[25] Jared Mauch. Open resolver project revisited. In OARC 31, 2019.
Figure 5: Google Public DNS PoPs that our measurements do and do
not probe.
[26] Arian Akhavan Niaki, William Marczak, Sahand Farhoodi, Andrew McGregor,
Phillipa Gill, and Nicholas Weaver. Cache Me Outside: A New Look at DNS
Cache Probing. In PAM, 2021.
[27] Mark O’Neill, Scott Ruoti, Kent Seamons, and Daniel Zappala. TLS proxies: Friend
or foe? In ACM IMC, 2016.
[28] Jeman Park, Aminollah Khormali, Manar Mohaisen, and Aziz Mohaisen. Where
are you taking me? Behavioral analysis of open DNS resolvers. In IEEE/IFIP DSN,
2019.
[29] Moheeb Abu Rajab, Fabian Monrose, Andreas Terzis, and Niels Provos. Peeking
through the cloud: DNS-based estimation and its applications. In ACNS, 2008.
[30] Sivaramakrishnan Ramanathan, Anushah Hossain, Jelena Mirkovic, Minlan Yu,
and Sadia Afroz. Quantifying the impact of blocklisting in the age of address
reuse. In ACM IMC, 2020.
[31] Audrey Randall, Enze Liu, Gautam Akiwate, Ramakrishna Padmanabhan, Ge-
offrey M Voelker, Stefan Savage, and Aaron Schulman. Trufflehunter: Cache
Snooping Rare Domains at Large Public DNS Resolvers. In ACM IMC, 2020.
[32] Philipp Richter, Georgios Smaragdakis, David Plonka, and Arthur Berger. Beyond
counting: new perspectives on the active IPv4 address space. In ACM IMC, 2016.
[33] Will Scott, Thomas Anderson, Tadayoshi Kohno, and Arvind Krishnamurthy.
Satellite: Joint analysis of CDNs and network-level interference. In USENIX ATC,
2016.
[34] Florian Streibelt, Jan Böttger, Nikolaos Chatzis, Georgios Smaragdakis, and Anja
Feldmann. Exploring EDNS-client-subnet adopters in your free time. In ACM
IMC, 2013.
[35] Matthew Thomas. Chromium’s impact on root DNS traffic, 2020. URL https:
//blog.apnic.net/2020/08/21/chromiums-impact-on-root-dns-traffic/.
[36] Duane Wessels. How Chromium reduced root DNS traffic, 2021. URL https:
//blog.apnic.net/2021/02/04/how-chromium-reduces-root-dns-traffic/.
[37] Craig E Wills, Mikhail Mikhailov, and Hao Shang. Inferring relative popularity
of Internet applications by actively querying DNS caches. In ACM IMC, 2003.
[38] Maya Ziv, Liz Izhikevich, Kimberly Ruth, Katherine Izhikevich, and Zakir Du-
rumeric. ASdb: A system for classifying owners of autonomous systems. In ACM
IMC, 2021.
A ADDITIONAL VALIDATION OF
METHODOLOGIES
A.1 Coverage of Google Public DNS PoPs
As discussed in Section 3.1.1 and shown in Figure 1, our current
vantage points suffice to probe 22 Google Public DNS PoPs. Fig-
ure 5 shows the locations of those PoPs and the ones we currently
do not probe. For the 23 we do not probe, 5 show up as recursive
resolvers in our Microsoft resolvers dataset (unprobed and
verified in Figure 5), indicating that they actively serve clients.
The other 18 do not query Microsoft Azure’s DNS Traffic Man-
ager, (the source of Microsoft resolvers), during the week of
2021/09/20, suggesting that they are likely not actively serving
users or announcing the anycast route, and explaining why we
were unable to reach them from any cloud data center we tried.
Additionally, the 5 unprobed and verified sites account for only
759
unprobed & unverified (18)unprobed and verified (5)probed and verified (22)IMC ’21, November 2–4, 2021, Virtual Event, USA
Weifan Jiang, Tao Luo, Thomas Koch, Yunfan Zhang, Ethan Katz-Bassett, and Matt Calder
5% of the Google Public DNS queries seen by Microsoft, with the
22 sites in probed and verified that provide the results in our
paper account for 95%. This result suggests that the unprobed and
verified receive little traffic, so likely would result in relatively
fewer ECS cache hits for cache probing and may have fewer any-
cast routes reaching them, explaining why the cloud providers we
have tried do not reach them.
A.2 Validating ECS query scopes
Section 3.1.1 describes how we set the prefix scopes we use for ECS
queries to reduce probing overhead, and this section demonstrates
that the response scopes assigned by the authoritative name servers
are stable, and therefore the reduction in probes does not signifi-
cantly alter our cache probing results or the granularity of cache
hit prefixes. If the response scopes assigned by the authoritatives
are stable over time, our less specific query scopes will match the
response scopes cached by Google Public DNS. In this case, our
probes that use the less specific query scope would generate the
same result as if we had probed for the /24 prefix.
Across all cache hits, 90% of the responses have the same scope
as the query, suggesting that our approach to reducing probing
overhead has little impact on our overall results. The results are
shown in Table 2, with 97% of the hits having response scopes and
queries scopes that differ by at most 2. Only 1% of the hits have
response scopes and queries scopes that differ by more than 4. This
result demonstrates that the vast majority of response scopes are
stable over the period in which we probed Google Public DNS, and
our query scope reduction technique significantly reduces probing
overhead without having a large impact on results.
B ADDITIONAL MEASUREMENT RESULTS
B.1 Dataset overlap by AS
Expanding the results from Section 4, Table 3 shows the overlap
in ASes detected as hosting users by five techniques: our cache
probing for per-ECS cache hits, our crawls of root DNS logs
for Chromium queries, plus APNIC, Microsoft clients, and Mi-
crosoft resolvers. Each entry shows the size of intersection of
the set of ASes observed in the two datasets. The parentheses in
a column indicates the coverage of that technique relative to the
others.