数据分析及相关概念
数据收集
服务器
客户端
数据处理
反作
·数据清洗
·格式转换
图2-1
数据分析的整个过程
数据建模
数据分析及相关软件
·模型管理
，BI）、数据挖掘（DataMining，DM）、
数据分析
·预警
·数据洞察
数据可视化
·直方图
·切片图
热力图
第
---
## Page 40
一种结合，以解决业务的问题为目标，帮助人们从数据中获得智慧）。
现可以钻取（Drill-down/up）、切片（Slice）、切块（Dice）等灵活、系统和直观的数据展现。
于Association rulelearning）信息的过程。很多年前，它一直是一个热门的研究生专业，直到
掘（Data Mining）等技术。
（数据的抽取、转换、加载）、数据仓库（DataWarehouse）、OLAP（联机分析处理）、数据挖
很多时候会特别指通过数据仓库技术进行业务报表制作和分析的过程，在分析方法上通常使
接近，容易混淆，下面做个简单介绍。
源数据软件的核心目标。例如，Hive利用MapReduce作为计算引擎，Presto自己开发计算引
大量日志数据都存放在HDFS中，如何提高数据处理性能，支持实时查询功能则成为不少开
据的方式，大大改进了数据处理的响应时间，快速发展出一个较为完备的生态系统。另外
实时性能一直是Hadoop的一个伤痛。2014年，Spark横空出世，通过最大利用内存处理数
数据分析。部分分析软件的创建时间和重要收购，可以参考图2-2。
软件，处理TB级别数据非常费劲，而这些新兴的数据库正是瞄准TB级别，乃至PB级别的
析公司Netezza；这些收购事件指向的是同一个目标市场一
年，EMC收购了数据仓库软件厂商GreenPlum；2013年，IBM宣布以17亿美元收购数据分
各种专业领域的开源软件日益壮大，通用数据存储系统也不断升级。
大鱼吃小鱼的故事；另一个是开源数据存储处理软件，在互联网精神和开源情怀的引导下，
2.2
和融合），也是一个经验和想象力的融合（它涉及数学算法、统计分析、工具和软件工程的
多维度的数据立方体，以维度（Dimension）和度量（Measure）为基本概念，辅以元数据实
信息检索专业的出现。
数据分析既是一门艺术（所谓艺术就是结合技术、想象、经验和意愿等综合因素的平衡
联机分析处理：联机分析处理（OLAP）是一种建立数据系统的方法，其核心思想即建立
数据挖掘：数据挖掘（DM）是指在大量数据中自动搜索隐藏于其中有着特殊关系（属
商务智能：商务智能（BI）是在商业数据上进行价值挖掘的过程。商务智能的历史很长、
在开源世界，Hadoop将人们引人了大数据时代，处理TB级别大数据成为一种可能，但
2011年，Teradata收购了AsterData公司，同年惠普收购了实时分析平台Vertica等；2012
数据分析软件市场一直以来都很活跃，从两个视角来看，一个是商业软件市场，充满了
数据分析软件的发展
一大数据分析。传统的数据库
Druid实时大数据分析原理与实践
---
## Page 41
得者，INGRES、PostgreSQL、VoltDB等数据库发明人）。2011年Vertica 被惠普收购。Vertica
1.HP Vertica
这里介绍几个有特点的支持大数据的商用数据库软件。
2.3.1
类来介绍。在介绍完每种软件的技术特点后，我们会与Druid做一些简单的技术性比较。
者面向大数据分析，适用于TB级别以上的数据存储和分析任务。接下来，按照以下几个分
2.3
高的性能。
擎，以及Druid自己开发索引和计算引擎等，都是为了一个目标：处理更多的数据，获取更
第2章
Vertica公司成立于2005年，创立者为数据库巨壁Michael Stonebraker（2014年图灵奖获
商用数据库软件种类繁多，但是真正能够支持TB级别以上的数据存储和分析并不多，
·云端数据分析SaaS
·开源 SQL on Hadoop
·开源数据分析软件
·开源计算框架
·开源时序数据库
·商业数据库
为了全面了解数据分析软件的分类，本节将介绍一些适合大数据分析的存储数据库，或
商业软件
数据分析软件的分类
数据分析及相关软件
Hadoop
收购Netezza
IBM
2010
图2-2
2011
Hive
部分分析软件的创建时间和重要收购
2012
lmpala
EMC
2013
Presto
2014
Spark1.0
2015
Kylin
Pinot
2016
---
## Page 42
和产生优化的存储结构。
Vertica不使用Index，而是尝试利用行程编码（Run-LengthEncoding），以及其他的压缩技术
Projection功能，但缺少Druid的数据部分聚合，缺少数据的实时摄入功能。另外一个区别是
称Facebook超过300个节点（Node）和处理超过6PB数据。
Groupon）分析处理，数据达到PB级别。Facebook利用Vertica进行快速的用户数据分析，据
处理（MPP）。产品广泛应用于高端数字营销、互联网客户（比如Facebook、AOL、Twitter
软件是能提供高效数据存储和快速查询的列存储数据库实时分析平台，还支持大规模并行
相比Druid，Vertica支持更多的企业级特性，例如SQL、JDBC等标准，支持数据拆分的
如图2-3所示。
·支持Projection（数据投射）功能。
·支持标准的SQL查询、ODBC/JDBC等。
·MPP架构，分布式存储和任务负载，Sharednothing架构。
·高可用数据库和查询。
·灵活的压缩算法，
·面向列的存储。
Vertica有以下几个特点。
，根据数据的排序性和基数决定压缩算法。
orentrmnion
图2-3Vertical的特点
Vertica
Cadvansedn
HPE
Integration
Applicatior
Aautomatie
Avlahity
Druid实时大数据分析原理与实践
---
## Page 43
一套处理存储密集型的查询，Exadata能够做到智能查询分配。
现有的OracleExadata数据库云服务器中。它包含两套子系统，
速的专用数据网络协议，主要专用硬件支持）3.2TBPCI闪存卡（每个闪存卡都配有Exadata
（OLAP）和数据仓库（DW）的场景。
合。它提供最快、最可靠的数据库平台，不仅支持常规的数据库应用，也支持联机分析处理
2.Oracle Exadata
以加快后期的数据访问速度，同一个列可以在不同的Projection中，如图2-4所示。
第2章
Exadata采用了多种最新的硬件技术，例如40Gb/s的InfiniBand网络（InfiniBand是超高
OracleExadata是数据库发展史上的一个传奇，它是数据库软件和最新硬件的完美结
接下来介绍一下Projection技术，它的原理是将数据的某些列提取出来进行专门的存储，
·OracleExadata支持混合列压缩。
·针对所有数据库负载进行了优化，
·全面的Oracle数据库兼容性。
·采用InfiniBand高速网络，采用极速闪存方案。
OracleExaData有如下几个技术特点。
Exadata体系结构示意图如图2-5所示
1236
1235
1234
Trackid
数据分析及相关软件
1236
1235
1234
Trackid
Time
ProjectionA
01:02:34
01:02:34
01:02:33
01:02:34
01:02:34
01:02:33
Time
userA
User
userc
userB
图2-4Projection示意图
Table
包括智能扫描。
userB
userA
User
userC
01:02:34
01:02:34
01:02:33
Time
Login
Query
Login
一套处理计算密集型的查询
ProjectionB
User
userc
userB
userA
---
## Page 44
行分段处理，每一段都使用列式存储放在Block中，而后按照不同的压缩策略进行处理。
不从心，
TB级别的数据量上有很大的性能优势。对于处理PB级别的数据量，Exadata可能会有些力
代名词。其发展历程如图2-6所示。
OracleExadata混合列存储是介于行存储和列存储之间的一个方案，主要思想是对列进
相比Druid，OracleExadata提供了大而全的企业解决方案，通过硬件加速查询，在处理
OracleExadata于2008年推出，
当然成本也是一个大问题。
Storage side
DBside
ORACLE
O2008 V1
Cell Server1
EXADATA
图2-6
图2-5
DBServer1
&OLTP
2010X2
OracleExadata的发展历程
，软硬件一体，
Exadata体系结构示意图
Cell Server 2
内存数据库
2012X3
DBServer2
不断发展壮大，
Cell Server3
DataasaService
OLTP&DW
2013X4
ASM
Oracle11.2
Oracle Linux
Druid实时大数据分析原理与实践
存储密集型
计算密集型
，逐渐成为高性能数据库的
XE
cellsrv
OracleLinux
---
## Page 45
MapReduce的数据分析解决方案，可以支持更加灵活的数据结构的处理，例如非结构化数据
走不同的路线：Teradata是传统数据仓库，满足通用的数据需求；Aster实际上是一种基于
和查询数据的节点，支持排序和聚合等操作。
高速的互联层，是一个软件和硬件结合的解决方案。AMP（Access ModuleProcessor）是存储
是查询的分析引擎，用于分析SQL查询、制定查询计划、聚合查询结果等；BYNET是一个
于数据仓库的应用领域。Teradata的架构示意图如图2-7所示，其中PE（Parsing Engine(s)）
商。Teradata采用纯粹的 Shared nothing架构，支持MPP。对于多维度的查询更加灵活，专注
3.Teradata
第2章数据分析及相关软件
在数据仓库中的时序数据库问题上。
的处理。
产品，一个是Teradata数据仓库，另一个是TeradataAster数据分析产品。这两个产品分别
Teradata提供了一个完整的数据解决方案，包括数据仓库和 MapReduce。Druid 则聚焦
另外，Teradata还提出了一个统一的数据分析框架，如图2-8所示，其中包括两个核心
Teradata（天睿）公司是专注于大数据分析、数据仓库和整合营销管理解决方案的供应
Disk
AMP
图2-7Teradata的架构示意图
AMP
Parsing Engine(s)
BYNET
Disk
Disk
AMP
---
## Page 46
司也有超过50个节点的部署。它的设计思路是利用HBase的Key存储一些Tag信息，将同
应用于很多互联网公司的运维系统中，例如Pinterest公司有超过100个节点的部署，雅虎公
能的监控和度量，包括网络和服务器、传感器、IoT、金融数据的实时监控领域。OpenTSDB
它采用Java语言编写，通过基于HBase的存储实现横向扩展。OpenTSDB广泛用于服务器性
1.OpenTSDB
数据仓库的角色，但是在很多特性上它也属于一种时序数据库。
计上需要支持高吞吐、高效数据压缩，支持历史查询、分布式部署等。虽然Druid更加接近
大，因此写入的量非常大，一般的关系型数据库无法满足这些场景。因此，时序数据库在设
标，例如CPU、内存使用情况等。目前时序数据库也广泛应用于各种传感器的数据收集分析
2.3.2时序数据库
一个小时数据放在一行存储，提高了查询速度。其设计架构示意图如图2-9所示。
工作中，这些数据的收集都有一个特点，就是对时间的依赖非常大，每天产生的数据量非常
乙
OpenTSDB是一个开源的时序数据库，支持存储数千亿的数据点，并提供精确查询功能。
时序数据库用于记录过去时间的各个数据点的信息，典型的应用是服务器的各种性能指
灵活查询分析
数据科学家
图2-8Teradata统一数据架构示意图
ASTER
客户/合作伙伴
商业分析师
DATATWARATEOS
TERADATA
运营
线
Druid实时大数据分析原理与实践
员工
标准数据仓库
---
## Page 47
（Zookeeper等）、SQLon Hadoop（Hive）等。其整体生态如图2-10所示。
还有最完整的大数据生态，包括机器管理、NoSQLKeyValue存储（如 HBase）、协调服务
了一个分布式文件系统（Hadoop Distributed File System，HDFS）。除了文件存储，Hadoop
底层细节的情况下，开发分布式程序，充分利用集群的威力高速运算和存储。Hadoop实现
1.Hadoop
2.3.3
也有非常大的差别。
作为内部存储，支持与SQL类似的查询语言。
压缩比的算法等。在早期设计中，使用LevelIDB作为存储，后来改成Time Series Merge Tree
持方便、强大的查询语言，集成了数据采集、存储和可视化功能。它支持高效存储，使用高
常活跃，是GoLang的一个非常成功的开源应用。其技术特点包括：支持任意数量的列，支
2.InfluxDB
显降低。
用 HBase 的KeyRange 进行快速查询，在任意维度的组合查询下，OpenTSDB 查询效率会明
显，OpenTSDB 通过预先定义好维度Tag等，采用精巧的数据组织方式放入HBase中，利
第2章
Hadoop是一个分布式系统基础架构，由Apache基金会开发。用户可以在不了解分布式
相比Druid，InfluxDB的设计更加针对OpenTSDB的一些场景，内部存储结构和 Druid
InfluxDB是最近非常流行的一个时序数据库，采用GoLang语言开发，目前它的社区非
相比Druid，OpenTSDB 在运维监控领域有长时间的应用，两者在技术上的区别比较明
开源分布式计算平台
数据分析及相关软件
Humans
Gear
Network
图2-9OpenTSDB 设计架构示意图
HTTP
SNMP
RPC
HTTP/
HBase
TSD
HBase RPC
TSDRPC
23
---
## Page 48