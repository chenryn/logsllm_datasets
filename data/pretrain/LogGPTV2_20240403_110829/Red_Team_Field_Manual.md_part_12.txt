Static Source Translation Terminology
NAT Pool
! One line per static translation
ip nat inside source static 10.0.0.19 192.0.2.1 A pool of IP addresses to be used as inside
ip nat inside source static 10.0.1.47 192.0.2.2 global or outside local addresses in translations
ip nat outside source static 174.143.212.133 10.0.0.47
Port Address Translation (PAT)
ip nat outside source static 174.143.213.240 10.0.2.181
An extension to NAT that translates information
at layer four and above, such as TCP and UDP
Dynamic Source Translation port numbers; dynamic PAT configurations
include the overload keyword
! Create an access list to match inside local addresses
Extendable Translation
access-list 10 permit 10.0.0.0 0.0.255.255
The extendable keyword must be appended
!
when multiple overlapping static translations are
! Create NAT pool of inside global addresses
configured
ip nat pool MyPool 192.0.2.1 192.0.2.254 prefix-length 24
!
Special NAT Pool Types
! Combine them with a translation rule
ip nat inside source list 10 pool MyPool
Rotary Used for load balancing
!
! Dynamic translations can be combined with static entries Match- Preserves the host portion of
ip nat inside source static 10.0.0.42 192.0.2.42 Host the address after translation
Port Address Translation (PAT) Troubleshooting
show ip nat translations [verbose]
! Static layer four port translations
ip nat inside source static tcp 10.0.0.3 8080 192.0.2.1 80
show ip nat statistics
ip nat inside source static udp 10.0.0.14 53 192.0.2.2 53
ip nat outside source static tcp 174.143.212.4 23 10.0.0.8 23 clear ip nat translations
!
! Dynamic port translation with a pool NAT Translations Tuning
ip nat inside source list 11 pool MyPool overload
! ip nat translation tcp-timeout 
! Dynamic translation with interface overloading ip nat translation udp-timeout 
ip nat inside source list 11 interface FastEthernet1 overload ip nat translation max-entries 
Inside Destination Translation
! Create a rotary NAT pool
ip nat pool LoadBalServers 10.0.99.200 10.0.99.203 prefix-length 24 type rotary
!
! Enable load balancing across inside hosts for incoming traffic
ip nat inside destination list 12 pool LoadBalServers
by Jeremy Stretch v1.0
Q S · P 1
UALITY OF ERVICE ART
packetlife.net
Quality of Service Models IP Type of Service (TOS)
Best Effort · No QoS policies are implemented
Precedence
Integrated Services (IntServ)
Resource Reservation Protocol (RSVP) is used to reserve bandwidth per-
flow across all nodes in a path Ver HL TOS Len
Differentiated Services (DiffServ)
Packets are individually classified and marked; policy decisions are made DSCP
independently by each node in a path
Precedence/DSCP
Layer 2 QoS Markings
Binary DSCP Prec.
Medium Name Type
56 111000 Reserved 7
Ethernet Class of Service (CoS) 3-bit 802.1p field in 802.1Q header
48 110000 Reserved 6
Frame Relay Discard Eligibility (DE) 1-bit drop eligibility flag
46 101110 EF 5
ATM Cell Loss Priority (CLP) 1-bit drop eligibility flag
32 100000 CS4
MPLS Traffic Class (TC) 3-bit field compatible with 802.1p
34 100010 AF41
IP QoS Markings 4
36 100100 AF42
IP Precedence
The first three bits of the IP TOS field; limited to 8 traffic classes 38 100110 AF43
Differentiated Services Code Point (DSCP) 24 011000 CS3
The first six bits of the IP TOS are evaluated to provide more granular
26 011010 AF31
classification; backward-compatible with IP Precedence
3
28 011100 AF32
QoS Flowchart
30 011110 AF33
No 16 010000 CS2
Software Queue
18 010010 AF21 Scheduler
HW Yes 2
Queuing Hardware
Queue Software Queue 20 010100 AF22
Decision Queue
Full?
22 010110 AF23
Software Queue
8 001000 CS1
10 001010 AF11
Terminology
1
Per-Hop Behavior (PHB) 12 001100 AF12
The individual QoS action performed at each independent DiffServ node 14 001110 AF13
Trust Boundary · Beyond this, inbound QoS markings are not trusted
0 000000 BE 0
Tail Drop · Occurs when a packet is dropped because a queue is full
Congestion Avoidance
Policing
Imposes an artificial ceiling on the amount of bandwidth that may be Random Early Detection (RED)
consumed; traffic exceeding the policer rate is reclassified or dropped Packets are randomly dropped
before a queue is full to prevent tail
Shaping
drop; mitigates TCP
Similar to policing but buffers excess traffic for delayed transmission;
synchronization
makes more efficient use of bandwidth but introduces a delay
TCP Synchronization Weighted RED (WRED)
Flows adjust TCP window sizes in synch, making inefficient use of a link RED with the added capability of
recognizing prioritized traffic based
DSCP Per-Hop Behaviors on its marking
Class Selector (CS) · Backward-compatible with IP Precedence values Class-Based WRED (CBWRED)
WRED employed inside a class-
Assured Forwarding (AF) · Four classes with variable drop preferences
based WFQ (CBWFQ) queue
Expedited Forwarding (EF) · Priority queuing for delay-sensitive traffic
by Jeremy Stretch v2.0
Q S · P 2
UALITY OF ERVICE ART
packetlife.net
Queuing Comparison
FIFO PQ CQ WFQ CBWFQ LLQ
Default on Interfaces >2 Mbps No No 2 Mbps) interfaces always emptied before lower- class-map match-all Scavenger
priority queues match access-group name Other
· Configurable with the tx-ring-
limit interface config command · Lower-priority queues are at risk
of bandwidth starvation policy-map Foo Policy Creation
Custom Queuing (CQ) class Voice
Weighted Fair Queuing (WFQ) ! Priority queue policed to 33%
Queue A 500 B/cycle priority percent 33
Flow 1 class Call-Signaling
Queue B 4500 B/cycle ! Allocate 5% of bandwidth
Hardware Flow 2 bandwidth percent 5
Queue C 1500 B/cycle Queue ... class Critical-Apps
Hardware bandwidth percent 20
· Rotates through queues using Flow n Queue ! Extend queue size to 96 packets
Weighted Round Robin (WRR) queue-limit 96
· Queues are dynamically created class Scavenger
· Processes a configurable number
per flow to ensure fair processing ! Police to 64 kbps
of bytes from each queue per turn
police cir 64000
· Statistically drops packets from
· Prevents queue starvation but conform-action transmit
aggressive flows more often
does not provide for delay- exceed-action drop
· No support for delay-sensitive class class-default
sensitive traffic
traffic ! Enable WFQ
fair-queue
Class-Based WFQ (CBWFQ)
Low Latency Queuing (LLQ) ! Enable WRED
random-detect
Queue A 512 Kbps Min
Priority 512 Kbps Max
interface Serial0 Policy Application
Queue B 1024 Kbps Min
Queue A 512 Kbps Min ! Apply the policy in or out
Hardware service-policy output Foo
Default Remainder
Queue Queue B 1024 Kbps Min
· WFQ with administratively Hardware LLQ Config Example
Default Remainder
Queue
configured queues
show policy-map [interface]
· Each queue is allocated an · CBWFQ with the addition of a
Show interface
amount/percentage of bandwidth policed strict-priority queue
· No support for delay-sensitive · Highly configurable while still show queue 
traffic supporting delay-sensitive traffic
Show mls qos
by Jeremy Stretch v2.0
IP 4 S
V UBNETTING
packetlife.net
Subnets Decimal to Binary
CIDR Subnet Mask Addresses Wildcard Subnet Mask Wildcard
/32 255.255.255.255 1 0.0.0.0 255 1111 1111 0 0000 0000
/31 255.255.255.254 2 0.0.0.1 254 1111 1110 1 0000 0001
/30 255.255.255.252 4 0.0.0.3 252 1111 1100 3 0000 0011
/29 255.255.255.248 8 0.0.0.7 248 1111 1000 7 0000 0111
/28 255.255.255.240 16 0.0.0.15 240 1111 0000 15 0000 1111
/27 255.255.255.224 32 0.0.0.31 224 1110 0000 31 0001 1111
/26 255.255.255.192 64 0.0.0.63 192 1100 0000 63 0011 1111
/25 255.255.255.128 128 0.0.0.127 128 1000 0000 127 0111 1111
/24 255.255.255.0 256 0.0.0.255 0 0000 0000 255 1111 1111
/23 255.255.254.0 512 0.0.1.255
Subnet Proportion
/22 255.255.252.0 1,024 0.0.3.255
/21 255.255.248.0 2,048 0.0.7.255
/20 255.255.240.0 4,096 0.0.15.255
/27
/19 255.255.224.0 8,192 0.0.31.255 /26 /28
/29
/18 255.255.192.0 16,384 0.0.63.255
/30
/17 255.255.128.0 32,768 0.0.127.255
/30
/16 255.255.0.0 65,536 0.0.255.255
/15 255.254.0.0 131,072 0.1.255.255
/14 255.252.0.0 262,144 0.3.255.255
/25
/13 255.248.0.0 524,288 0.7.255.255
/12 255.240.0.0 1,048,576 0.15.255.255
/11 255.224.0.0 2,097,152 0.31.255.255
Classful Ranges
/10 255.192.0.0 4,194,304 0.63.255.255
A 0.0.0.0 – 127.255.255.255
/9 255.128.0.0 8,388,608 0.127.255.255
B 128.0.0.0 - 191.255.255.255
/8 255.0.0.0 16,777,216 0.255.255.255
C 192.0.0.0 - 223.255.255.255
/7 254.0.0.0 33,554,432 1.255.255.255
D 224.0.0.0 - 239.255.255.255
/6 252.0.0.0 67,108,864 3.255.255.255
E 240.0.0.0 - 255.255.255.255
/5 248.0.0.0 134,217,728 7.255.255.255
/4 240.0.0.0 268,435,456 15.255.255.255 Reserved Ranges
/3 224.0.0.0 536,870,912 31.255.255.255 RFC 1918 10.0.0.0 - 10.255.255.255
/2 192.0.0.0 1,073,741,824 63.255.255.255 Localhost 127.0.0.0 - 127.255.255.255
/1 128.0.0.0 2,147,483,648 127.255.255.255 RFC 1918 172.16.0.0 - 172.31.255.255
/0 0.0.0.0 4,294,967,296 255.255.255.255 RFC 1918 192.168.0.0 - 192.168.255.255
Terminology
CIDR VLSM
Classless interdomain routing was developed to Variable-length subnet masks are an arbitrary length
provide more granularity than legacy classful between 0 and 32 bits; CIDR relies on VLSMs to define
addressing; CIDR notation is expressed as /XX routes
by Jeremy Stretch v2.0
IP 6
V
packetlife.net
Protocol Header Address Notation
8 16 24 32 · Eliminate leading zeros from all two-byte sets
Ver Traffic Class Flow Label
· Replace up to one string of consecutive zeros
Payload Length Next Header Hop Limit with a double-colon (::)
Address Formats
Source Address
Global unicast
Global Prefix Subnet Interface ID
Destination Address
48 16 64
Link-local unicast
Version (4 bits) · Always set to 6
Interface ID
Traffic Class (8 bits) · A DSCP value for QoS
64 64
Flow Label (20 bits) · Identifies unique flows (optional)
Multicast
Payload Length (16 bits) · Length of the payload in bytes sgalF epocS
Group ID
Next Header (8 bits) · Header or protocol which follows
8 4 4 112
Hop Limit (8 bits) · Similar to IPv4's time to live field
EUI-64 Formation
Source Address (128 bits) · Source IP address
Destination Address (128 bits) · Destination IP address MAC
Address Types
EUI-64
Unicast · One-to-one communication
Multicast · One-to-many communication · Insert 0xfffe between the two halves of the MAC
Anycast · An address configured in multiple locations · Flip the seventh bit (universal/local flag) to 1
Multicast Scopes Extension Headers
1 Interface-local 5 Site-local Hop-by-hop Options (0)
Carries additional information which must be examined by every
2 Link-local 8 Org-local
router in the path
4 Admin-local E Global Routing (43)