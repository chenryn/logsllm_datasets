c.Has the application received an unexpected MQI return code? For example:
– Does your application assume that the queues it accesses are shareable? If a queue has
been redefined as exclusive, can your application deal with return codes indicating that it
can no longer access that queue?
– Have any queue definition or security profiles been changed? An MQOPEN call could fail
because of a security violation; can your application recover from the resulting return
code?
See MQI Applications reference for your programming language for a description of each
return code.
d.If you have applied any PTF to IBM MQ for IBM i, check that you received no error messages
when you installed the PTF.
No
Ensure that you have eliminated all the preceding suggestions and proceed to Step “4” on page
21.
4.Has the server system remained unchanged since the last successful run?
Yes
Proceed to “Identifying characteristics of the problem on IBM i” on page 22.
IBM MQ troubleshooting and support 21
No
Consider all aspects of the system and review the appropriate documentation on how the
change might have affected the IBM MQ application. For example :
– Interfaces with other applications
– Installation of new operating system or hardware
– Application of PTFs
– Changes in operating procedures
Related tasks
“Contacting IBM Support” on page 301
If you need help with a problem that you are having with IBM MQ, you can contact IBM Support through
the IBM Support Site. You can also subscribe to notifications about IBM MQ fixes, troubleshooting, and
other news.
“Manually applying required authority for commands and programs” on page 25
Some IBM MQ commands rely on using IBM i system commands for creating and managing objects,
files, and libraries, for example, CRTMQM (create queue manager) and DLTMQM (delete queue manager).
Similarly some IBM MQ program code, for example a queue manager, relies on using IBM i system
programs.
“Determining problems with applications, commands and messages on IBM i” on page 26
If you encounter problems with IBM MQ applications, commands, and messages, there are a number of
questions that you can consider to help you determine the cause of the problem.
“Making initial checks on AIX” on page 7
Before you start problem determination in detail on AIX, consider whether there is an obvious cause of
the problem, or an area of investigation that is likely to give useful results. This approach to diagnosis can
often save a lot of work by highlighting a simple error, or by narrowing down the range of possibilities.
“Making initial checks on Linux” on page 29
Before you start problem determination in detail on Linux, consider whether there is an obvious cause of
the problem, or an area of investigation that is likely to give useful results. This approach to diagnosis can
often save a lot of work by highlighting a simple error, or by narrowing down the range of possibilities.
“Making initial checks on Windows” on page 42
Before you start problem determination in detail on Windows, consider whether there is an obvious cause
of the problem, or an area of investigation that is likely to give useful results. This approach to diagnosis
can often save a lot of work by highlighting a simple error, or by narrowing down the range of possibilities.
“Making initial checks on z/OS” on page 51
Before you start problem determination in detail on z/OS, consider whether there is an obvious cause of
the problem, or an area of investigation that is likely to give useful results. This approach to diagnosis can
often save a lot of work by highlighting a simple error, or by narrowing down the range of possibilities.
Related reference
Messages and reason codes
Identifying characteristics of the problem on IBM i
If you have not been able to identify the cause of the problem by using the preliminary checks, you should
now start to look at the characteristics of the problem in greater detail.
About this task
Use the following questions as pointers to help you to identify the cause of the problem:
• Can you reproduce the problem?
• Is the problem intermittent?
• Are you receiving errors when you use special characters in commands?
• Does the problem affect specific parts of the network?
22 Troubleshooting and Support for IBM MQ
• Does the problem affect specific parts of the network?
• Does the problem occur at specific times of the day?
• Does the problem occur at specific times of the day?
• Have you received no response from a command?
As you go through the list, make a note of anything that might be relevant to the problem. Even if your
observations do not suggest a cause straight away, they might be useful later if you need to carry out a
systematic problem determination exercise.
When you open a case with IBM, you can include additional IBM MQ troubleshooting information
(MustGather data) that you have collected to help with investigating the problem. For more information,
see “Collecting troubleshooting information for IBM Support” on page 302.
Procedure
1.Can you reproduce the problem?
If you can reproduce the problem, consider the conditions under which you do so:
• Is it caused by a command? Does the operation work if it is entered by another method?
If the command works if it is entered on the command line, but not otherwise, check that
the command server has not stopped. You must also check that the queue definition of the
SYSTEM.ADMIN.COMMAND.QUEUE has not been changed.
• Is it caused by a program? If so, does it fail in batch? Does it fail on all IBM MQ for IBM i systems, or
only on some?
• Can you identify any application that always seems to be running in the system when the problem
occurs? If so, examine the application to see if it is in error.
• Does the problem occur with any queue manager, or when connected to one specific queue
manager?
• Does the problem occur with the same type of object on any queue manager, or only one particular
object? What happens after this object has been cleared or redefined?
• Is the problem independent of any message persistence settings?
• Does the problem occur only when sync points are used?
• Does the problem occur only when one or more queue manager events are enabled?
2.Is the problem intermittent?
An intermittent problem might be caused by failing to take into account the fact that processes can run
independently of each other. For example, a program might issue an MQGET call, without specifying a
wait option, before an earlier process has completed.
You might also encounter this problem if your application tries to get a message from a queue while
the call that put the message is in-doubt (that is, before it has been committed or backed out).
3.Are you receiving errors when you use special characters in commands?
To avoid potential problems with special characters be careful when including special characters, for
example backslash (\) and quotation marks (") characters, in descriptive text for some commands. If
you use either of these characters in descriptive text, precede them with a backslash (\) character, for
example:
• Enter \\ if you need a backslash (\) character in your text.
• Enter \" if you need quotation marks (") characters in your text.
Queue managers and their associated object names are case-sensitive. By default, IBM i uses
uppercase characters, unless you surround the name in apostrophe (') characters. For example,
MYQUEUE and myqueue translate to MYQUEUE, whereas 'myqueue' translates to myqueue.
4.Does the problem affect all users of the IBM MQ for IBM i application?
If the problem affects only some users, look for differences in how the users configure their systems
and queue manager settings.
IBM MQ troubleshooting and support 23
Check the library lists and user profiles. Can the problem be circumvented by having *ALLOBJ
authority?
5.Does the problem affect specific parts of the network?
You might be able to identify specific parts of the network that are affected by the problem (remote
queues, for example). If the link to a remote message queue manager is not working, the messages
cannot flow to a remote queue. Check these points:
• Is the connection between the two systems available, and has the intercommunication component
of IBM MQ for IBM i started? Check that messages are reaching the transmission queue, the local
queue definition of the transmission queue, and any remote queues.
• Have you made any network-related changes that might account for the problem or changed any
IBM MQ for IBM i definitions?
• Can you distinguish between a channel definition problem and a channel message problem? For
example, redefine the channel to use an empty transmission queue. If the channel starts correctly,
the definition is correctly configured.
6.Does the problem occur only on IBM MQ?
If the problem occurs only on this version of IBM MQ, check the appropriate database on RETAIN,
or the https://www.ibm.com/support/entry/portal/Overview/Software/WebSphere®/WebSphere_MQ,
to ensure that you have applied all the relevant PTFs.
7.Does the problem occur at specific times of the day?
If the problem occurs at specific times of day, it might be that it is dependent on system loading.
Typically, peak system loading is at mid-morning and mid-afternoon, and so these times are when
load-dependent problems are most likely to occur. (If your IBM MQ for IBM i network extends across
more than one time zone, peak system loading might seem to occur at some other time of day.)
8.Have you received no response from a command?
If you have issued a command but you have not received a response, consider the following questions:
• Is the command server running? Work with the DSPMQMCSVR command to check the status of the
command server.
– If the response to this command indicates that the command server is not running, use the
STRMQMCSVR command to start it.
– If the response to the command indicates that the SYSTEM.ADMIN.COMMAND.QUEUE is not
enabled for MQGET requests, enable the queue for MQGET requests.
• Has a reply been sent to the dead-letter queue? The dead-letter queue header structure contains a
reason or feedback code describing the problem. See MQDLH - Dead-letter header for information
about the dead-letter queue header structure (MQDLH). If the dead-letter queue contains messages,
you can use the provided browse sample application (amqsbcg) to browse the messages using the
MQGET call. The sample application steps through all the messages on a named queue for a named
queue manager, displaying both the message descriptor and the message context fields for all the
messages on the named queue.
• Has a message been sent to the error log? For more information, see “Error logs on IBM i” on page
358.
• Are the queues enabled for put and get operations?
• Is the WaitInterval long enough? If your MQGET call has timed out, a completion code
of MQCC_FAILED and a reason code of MQRC_NO_MSG_AVAILABLE are returned. (See Getting
messages from a queue using the MQGET call for more information about the WaitInterval field,
and completion and reason codes from MQGET.)
• If you are using your own application program to put commands onto the
SYSTEM.ADMIN.COMMAND.QUEUE, do you need to take a sync point? Unless you have excluded
your request message from sync point, you must take a sync point before attempting to receive reply
messages.
• Are the MAXDEPTH and MAXMSGL attributes of your queues set sufficiently high?
24 Troubleshooting and Support for IBM MQ
• Are you using the CorrelId and MsgId fields correctly? Set the values of MsgId and CorrelId in
your application to ensure that you receive all messages from the queue.
Related tasks
“Contacting IBM Support” on page 301
If you need help with a problem that you are having with IBM MQ, you can contact IBM Support through
the IBM Support Site. You can also subscribe to notifications about IBM MQ fixes, troubleshooting, and
other news.
“Manually applying required authority for commands and programs” on page 25
Some IBM MQ commands rely on using IBM i system commands for creating and managing objects,
files, and libraries, for example, CRTMQM (create queue manager) and DLTMQM (delete queue manager).
Similarly some IBM MQ program code, for example a queue manager, relies on using IBM i system
programs.
“Determining problems with applications, commands and messages on IBM i” on page 26
If you encounter problems with IBM MQ applications, commands, and messages, there are a number of
questions that you can consider to help you determine the cause of the problem.
Related reference
Messages and reason codes
Manually applying required authority for commands and programs
Some IBM MQ commands rely on using IBM i system commands for creating and managing objects,
files, and libraries, for example, CRTMQM (create queue manager) and DLTMQM (delete queue manager).
Similarly some IBM MQ program code, for example a queue manager, relies on using IBM i system
programs.
About this task
To enable this reliance, the commands and programs must either have *PUBLIC *USE authority, or
explicit *USE authority to the IBM MQ user profiles QMQM and QMQMADM.
Such authority is applied automatically as part of the installation process, and you do not need to apply
it yourself. However, if you encounter problems, you can set the authorities manually as described in the
following steps.
Procedure
1.Set the authorities for commands using GRTOBJAUT with an OBJTYPE(*CMD) parameter, for example:
GRTOBJAUT OBJ(QSYS/ADDLIBLE) OBJTYPE(*CMD) USER(QMQMADM) AUT(*USE)
You can set authorities for the following commands:
• QSYS/ADDLIBLE
• QSYS/ADDPFM
• QSYS/CALL
• QSYS/CHGCURLIB
• QSYS/CHGJOB
• QSYS/CRTJRN
• QSYS/CRTJRNRCV
• QSYS/CRTJOBQ
• QSYS/CRTJOBD
• QSYS/CRTLIB
• QSYS/CRTMSGQ
IBM MQ troubleshooting and support 25
• QSYS/CRTPF
• QSYS/CRTPGM
• QSYS/CRTSRCPF
• QSYS/DLTJRN
• QSYS/DLTJRNRCV
• QSYS/DLTLIB
• QSYS/DLTMSGQ
• QSYS/OVRPRTF
• QSYS/RCLACTGRP
• QSYS/RTVJRNE
• QSYS/RCVJRNE
• QSYS/SBMJOB
2.Set the authorities for programs using GRTOBJAUT with an OBJTYPE(*PGM) parameter, for example:
GRTOBJAUT OBJ(QSYS/QWTSETP) OBJTYPE(*PGM) USER(QMQMADM) AUT(*USE)
You can set authorities for the following programs:
• QSYS/QWTSETP(*PGM)
• QSYS/QSYRLSPH(*PGM)
• QSYS/QSYGETPH(*PGM)
Determining problems with applications, commands and messages
on IBM i
If you encounter problems with IBM MQ applications, commands, and messages, there are a number of
questions that you can consider to help you determine the cause of the problem.
About this task
Use the following questions as pointers to help you to identify the cause of the problem:
• Are some of your queues working?
• Does the problem affect only remote queues?
• Are messages failing to arrive on the queue?
• Do messages contain unexpected or corrupted information?
• Are unexpected messages received when using distributed queues?
As you go through the list, make a note of anything that might be relevant to the problem. Even if your
observations do not suggest a cause straight away, they might be useful later if you need to carry out a
systematic problem determination exercise.
When you open a case with IBM, you can include additional IBM MQ troubleshooting information
(MustGather data) that you have collected to help with investigating the problem. For more information,
see “Collecting troubleshooting information for IBM Support” on page 302.
Procedure
1.Are some of your queues working?
If you suspect that the problem occurs with only a subset of queues, select the name of a local queue
that you think is having problems. Display the information about this queue, using WRKMQMQSTS or
DSPMQMQ then use the data displayed to do the following checks:
26 Troubleshooting and Support for IBM MQ
• If CURDEPTH is at MAXDEPTH, the queue is not being processed. Check that all applications are
running normally.
• If CURDEPTH is not at MAXDEPTH, check the following queue attributes to ensure that they are
correct:
– If triggering is being used, is the trigger monitor running? Is the trigger depth too large? Is the
process name correct?
– Can the queue be shared? If not, another application might already have it open for input.
– Is the queue enabled appropriately for GET and PUT?
• If there are no application processes getting messages from the queue, determine why. For example,
it might be because the applications must be started, a connection has been disrupted, or because
the MQOPEN call has failed for some reason.
If you cannot solve the problem, contact IBM Support for help.
2.Does the problem affect only remote queues?
If the problem affects only remote queues, check the subsequent points:
a.Check that the programs that should be putting messages to the remote queues have run
successfully.
b.If you use triggering to start the distributed queuing process, check that the transmission queue
has triggering set on. Also, check that the trigger monitor is running.
c.If necessary, start the channel manually. See Distributed queuing and clusters.
d.Check the channel with a PING command.
3.Are messages failing to arrive on the queue?
If messages do not arrive when you are expecting them, check for the following:
• Have you selected the correct queue manager, that is, the default queue manager or a named queue
manager?
• Has the message been put on the queue successfully?
– Has the queue been defined correctly, for example, is MAXMSGLEN sufficiently large?
– Can applications put messages on the queue (is the queue enabled for putting)?
– If the queue is already full, it might mean that an application was unable to put the required
message on the queue.
• Can you get the message from the queue?
– Must you take a sync point? If messages are being put or retrieved within sync point, they are not
available to other tasks until the unit of recovery has been committed.
– Is your timeout interval long enough?
– Are you waiting for a specific message that is identified by a message identifier or correlation
identifier (MsgId or CorrelId)? Check that you are waiting for a message with the correct MsgId
or CorrelId. A successful MQGET call sets both these values to that of the message retrieved, so
you might need to reset these values in order to get another message successfully. Also check if
you can get other messages from the queue.
– Can other applications get messages from the queue?
– Was the message you are expecting defined as persistent? If not, and IBM MQ for IBM i has been
restarted, the message has been lost.