7.27.2012	
frak.redballoonsecurity.com	
R E D 
BALLOON 
S e c u r i t y 
{ Ang Cui | PI:EMAIL } 
www.redballoonsecurity.com 
FIRMWARE 
R E V E R S E 
A N A L Y S I S 
K O N S O L E 
W
H
O  
A
M 
I 
W H A T D O I  
D O 
7.27.2012	
frak.redballoonsecurity.com	
PI:EMAIL	
W
H
O  
A
M 
I 
W H A T D O I  
D O 
5th Year Ph.D. Candidate 
Intrusion Detection Systems Lab 
Columbia University 
7.27.2012	
frak.redballoonsecurity.com	
PI:EMAIL	
5th Year Ph.D. Candidate 
Intrusion Detection Systems Lab 
Columbia University 
Co-Founder and CEO 
Red Balloon Security Inc. 
www.redballoonsecurity.com 
7.27.2012	
frak.redballoonsecurity.com	
W
H
O  
A
M 
I 
W H A T D O I  
D O 
PI:EMAIL	
5th Year Ph.D. Candidate 
Intrusion Detection Systems Lab 
Columbia University 
Co-Founder and CEO 
Red Balloon Security Inc. 
www.redballoonsecurity.com 
Past publications: 
• 
Pervasive Insecurity of Embedded Network 
Devices.  [RAID10] 
• 
A Quantitative Analysis of the Insecurity 
of Embedded Network Devices.  [ACSAC10] 
• 
Killing the Myth of Cisco IOS Diversity: 
Towards Reliable Large-Scale Exploitation 
of Cisco IOS.                   [USENIX WOOT 11] 
• 
Defending Legacy Embedded Systems with 
Software Symbiotes.                       [RAID11] 
• 
From Prey to Hunter: Transforming 
Legacy Embedded Devices Into 
Exploitation Sensor Grids.        [ACSAC11] 
7.27.2012	
frak.redballoonsecurity.com	
W
H
O  
A
M 
I 
W H A T D O I  
D O 
PI:EMAIL	
5th Year Ph.D. Candidate 
Intrusion Detection Systems Lab 
Columbia University 
Co-Founder and CEO 
Red Balloon Security Inc. 
www.redballoonsecurity.com 
Past Embedded Tinkerings: 
• 
Interrupt-Hijack Cisco IOS Rootkit 
7.27.2012	
frak.redballoonsecurity.com	
W
H
O  
A
M 
I 
W H A T D O I  
D O 
PI:EMAIL	
Interrupt-Hijack Rootkit 
[blackhat USA 2011] 
7.27.2012	
frak.redballoonsecurity.com	
PI:EMAIL	
5th Year Ph.D. Candidate 
Intrusion Detection Systems Lab 
Columbia University 
Co-Founder and CEO 
Red Balloon Security Inc. 
www.redballoonsecurity.com 
Past Embedded Tinkerings: 
• 
Interrupt-Hijack Cisco IOS Rootkit 
• 
HP LaserJet Printer Rootkit 
7.27.2012	
frak.redballoonsecurity.com	
W
H
O  
A
M 
I 
W H A T D O I  
D O 
PI:EMAIL	
HP-RFU Vulnerability 
HP LaserJet 2550 Rootkit 
[28c3] 
Firewall
Network Printer
Attacker
Server
1. Reverse Proxy
Printer -> Attacker
2. Reverse Proxy
Printer -> Victim
3. Attacker -> Server 
Via Reverse Proxy
4. Win: Reverse Shell
Server -> Kitteh
7.27.2012	
frak.redballoonsecurity.com	
PI:EMAIL	
WORKFLOW 
[Cisco IOS ROOTKIT] 
7.27.2012	
frak.redballoonsecurity.com	
PI:EMAIL	
WORKFLOW 
[Cisco IOS ROOTKIT] 
7.27.2012	
frak.redballoonsecurity.com	
[HP LaserJet Rootkit] 
PI:EMAIL	
WORKFLOW 
[Cisco IOS ROOTKIT] 
7.27.2012	
frak.redballoonsecurity.com	
[HP LaserJet Rootkit] 
[Software Symbiotes for Routers, Phones, Printers] 
PI:EMAIL	
7.27.2012	
frak.redballoonsecurity.com	
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
PI:EMAIL	
7.27.2012	
frak.redballoonsecurity.com	
Unpacking Process
Parse Package 
Manifest
De{crypt,compress}
Known Algorithm or Proprietary Algorithm?
Record
Encrypted?
Record
Compressed?
Record
Checksummed?
Record
Digitally 
Signed?
Known Format or Proprietary Format?
Sub-Record / FileSystem
 Extraction
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
7.27.2012	
frak.redballoonsecurity.com	
Unpacking Process
Parse Package 
Manifest
De{crypt,compress}
Known Algorithm or Proprietary Algorithm?
Record
Encrypted?
Record
Compressed?
Record
Checksummed?
Record
Digitally 
Signed?
Known Format or Proprietary Format?
Sub-Record / FileSystem
 Extraction
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
Unpacking Process
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
7.27.2012	
frak.redballoonsecurity.com	
Unpacking Process
Parse Package 
Manifest
De{crypt,compress}
Known Algorithm or Proprietary Algorithm?
Record
Encrypted?
Record
Compressed?
Record
Checksummed?
Record
Digitally 
Signed?
Known Format or Proprietary Format?
Sub-Record / FileSystem
 Extraction
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
Unpacking Process
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
Unpacking Process
Parse Package 
Manifest
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
7.27.2012	
frak.redballoonsecurity.com	
Unpacking Process
Parse Package 
Manifest
De{crypt,compress}
Known Algorithm or Proprietary Algorithm?
Record
Encrypted?
Record
Compressed?
Record
Checksummed?
Record
Digitally 
Signed?
Known Format or Proprietary Format?
Sub-Record / FileSystem
 Extraction
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
Unpacking Process
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
Unpacking Process
Parse Package 
Manifest
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
Unpacking Process
Parse Package 
Manifest
De{crypt,compress}
Known Algorithm or Proprietary Algorithm?
Record
Encrypted?
Record
Compressed?
Record
Checksummed?
Record
Digitally 
Signed?
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
7.27.2012	
frak.redballoonsecurity.com	
Unpacking Process
Parse Package 
Manifest
De{crypt,compress}
Known Algorithm or Proprietary Algorithm?
Record
Encrypted?
Record
Compressed?
Record
Checksummed?
Record
Digitally 
Signed?
Known Format or Proprietary Format?
Sub-Record / FileSystem
 Extraction
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
Unpacking Process
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
Unpacking Process
Parse Package 
Manifest
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
Unpacking Process
Parse Package 
Manifest
De{crypt,compress}
Known Algorithm or Proprietary Algorithm?
Record
Encrypted?
Record
Compressed?
Record
Checksummed?
Record
Digitally 
Signed?
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
Unpacking Process
Parse Package 
Manifest
De{crypt,compress}
Known Algorithm or Proprietary Algorithm?
Record
Encrypted?
Record
Compressed?
Record
Checksummed?
Record
Digitally 
Signed?
Known Format or Proprietary Format?
Sub-Record / FileSystem
 Extraction
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
7.27.2012	
frak.redballoonsecurity.com	
Unpacking Process
Parse Package 
Manifest
De{crypt,compress}
Known Algorithm or Proprietary Algorithm?
Record
Encrypted?
Record
Compressed?
Record
Checksummed?
Record
Digitally 
Signed?
Known Format or Proprietary Format?
Sub-Record / FileSystem
 Extraction
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
Unpacking Process
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
Unpacking Process
Parse Package 
Manifest
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
Unpacking Process
Parse Package 
Manifest
De{crypt,compress}
Known Algorithm or Proprietary Algorithm?
Record
Encrypted?
Record
Compressed?
Record
Checksummed?
Record
Digitally 
Signed?
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
Unpacking Process
Parse Package 
Manifest
De{crypt,compress}
Known Algorithm or Proprietary Algorithm?
Record
Encrypted?
Record
Compressed?
Record
Checksummed?
Record
Digitally 
Signed?
Known Format or Proprietary Format?
Sub-Record / FileSystem
 Extraction
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
Firmware 
Analysis  
Firmware 
Modification  
REpacking Process
Modified Binary Firmware Image
7.27.2012	
frak.redballoonsecurity.com	
Unpacking Process
Parse Package 
Manifest
De{crypt,compress}
Known Algorithm or Proprietary Algorithm?
Record
Encrypted?
Record
Compressed?
Record
Checksummed?
Record
Digitally 
Signed?
Known Format or Proprietary Format?
Sub-Record / FileSystem
 Extraction
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
Unpacking Process
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
Unpacking Process
Parse Package 
Manifest
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
Unpacking Process
Parse Package 
Manifest
De{crypt,compress}
Known Algorithm or Proprietary Algorithm?
Record
Encrypted?
Record
Compressed?
Record
Checksummed?
Record
Digitally 
Signed?
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
Unpacking Process
Parse Package 
Manifest
De{crypt,compress}
Known Algorithm or Proprietary Algorithm?
Record
Encrypted?
Record
Compressed?
Record
Checksummed?
Record
Digitally 
Signed?
Known Format or Proprietary Format?
Sub-Record / FileSystem
 Extraction
Original Binary Firmware Image
Firmware 
Analysis  
Firmware 
Modification  
Firmware 
Analysis  
Firmware 
Modification  
REpacking Process
Modified Binary Firmware Image
Known Format or Proprietary Format?
Re-Pack Modified
Sub-record / File System
Re-{crypt,compress}, Recalculate Checksum, etc
Known Algorithm or Proprietary Algorithm?
Record
Encrypted?
Record
Compressed?
Record
Checksummed?
Record
Digitally 
Signed?
Firmware 
Analysis  
Firmware 
Modification  
REpacking Process
Modified Binary Firmware Image
Regenerate 
Package Manifest
Reasons why Ang stays  
home on Friday night 
7.27.2012	
frak.redballoonsecurity.com	
PI:EMAIL	
Reasons why Ang stays  
home on Friday night 
Payload Design
7.27.2012	
frak.redballoonsecurity.com	
PI:EMAIL	
Reasons why Ang stays  
home on Friday night 
Payload 
Developement
Payload Design
7.27.2012	
frak.redballoonsecurity.com	
PI:EMAIL	
Reasons why Ang stays  
home on Friday night 
Payload 
Developement
Payload Testing
Payload Design
7.27.2012	
frak.redballoonsecurity.com	
PI:EMAIL	
Reasons why Ang stays  
home on Friday night 
Payload 
Developement
Payload Testing
Payload Design
Payload 
Developement
Payload Testing
Payload Design
STARE
@
 BINARY 
BLOB
7.27.2012	
frak.redballoonsecurity.com	
PI:EMAIL	
7.27.2012	
frak.redballoonsecurity.com	
Such Mystery! 
PI:EMAIL	
Payload Design
Payload 
Developement
Payload Design
Payload 
Developement