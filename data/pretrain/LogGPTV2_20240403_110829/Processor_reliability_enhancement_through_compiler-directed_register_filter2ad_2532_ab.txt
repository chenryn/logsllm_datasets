Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 09:58:58 UTC from IEEE Xplore.  Restrictions apply. 
registerﬁlepeaktemperature.Moreover,tominimizethehardwareoverheadandhencetheextrapowerdissipationofthisdynamicremappingsupport,thisregisternameshufﬂingprocessisdeterministicallydirectedbythecompiler.Apost-compilationadjustmentoftheregisternamesallowsregularitytobeembeddedwithinregisteraccesses,sothataccessestoeachregistercanbeevenlybalancedacrossloopiterationswithnoneedofanyhardwaremappingtabletokeeptrackofregisterusageorregistermappinginformation.Thisextremelylowhardwareoverheadthereforeenablesaneasyincorporationoftheproposedtechniqueintolow-powerembeddedprocessorstoattaintemperaturecontrol.Therestofthepaperisorganizedasfollows.SectionIIbrieﬂyreviewstherelatedwork.SectionIIIoutlinesthetechni-calmotivation.SectionsIVandVpresentindetailtheproposedregistershufﬂingschemeandthecorrespondingimplementa-tion,respectively.TheefﬁcacyoftheproposedtechniqueisexperimentallyveriﬁedinsectionVI.Finally,sectionVIIoffersabriefsetofconclusions.II.RELATEDWORKTheadverseimpactofoperatingtemperatureonsystemrelia-bilityhasbeenstudiedextensively.Researchershavebuiltbothanalyticalandexperimentalmodelsfortemperature-inducedfaultrateincreases,suchasdelayviolations[4],negativebiastemperatureinstability[3],neutron-inducedlatchup[11],andon-chipinterconnect[5].Anumberofdesignandmodellingchallengeshavebeensummarizedin[12].Basedonthephysicalandpowerconsumptioncharacteristicsofeachhardwareresource,researchershavedevelopedarchi-tecturalthermalmodels,suchastheHotSpot[6],forcalculatingtransienttemperatureresponse.Usingthesemodels,twotypesofarchitecturalDynamicThermalManagement(DTM)tech-niqueshavebeenproposedtopreventthechipfromreachingcriticaltemperaturelevels.Temporaltechniquesslowdownheataccumulationeitheratﬁnegranularitythroughfetchtoggling[10],decodethrottling[13],frequencyandvoltagescaling[6],oratcoarsegranularitythroughperiodicallystoppingthecomputationtoinducecooling[14].Obviously,slowingdownorstoppingtheentirecomputationengenderssigniﬁcantperformancedegradation.Spatialtechniques,ontheotherhand,reducetemperaturebyshiftingcomputationfromahotresourcetoarelativelycoolresource,atthegranularityoffunctionalunits[15],pipelines[15],executionclusters[16],orevencoresonasinglechip[17].ThesespatialtechniquessizablyreducetheperformanceoverheadassociatedwithtemporalDTMtechniques,yettheirapplicabilityrequirestheexistenceofspareorunderutilizedresourcecopies.Sincetheregisterﬁleisoneofthemostpower-hungryandoverheatedresourcesincurrentprocessors,increasingresearchattentionhasalsobeenpaidtothedesignofthermal-awareregisterﬁles.Gateleveltechniques,suchassingle-ormulti-levelbanking[18]andbit-partitioning[19],havebeenproposedtoreducethepowerconsumedineachregisterﬁleaccessand,hence,thepeaktemperature.Astemperatureisdeterminednotonlybypowerdensitybutfurthermorebyheatdissipationspeed,researchershavealsoproposedtoeitherincorporateanextraregisterﬁle[6]toincreasetheaverageidletime,artbzip2eonmcfadpcmepicgsmmpeg2Average00.20.40.60.81  4 regs8 regs12 regs16 regs20 regs32 regsFig.1.Cumulativeregisteraccessratioorphysicallydistributetheregisterﬁleintomultipleclusters[16]toaccelerateheatdissipation.Duplicationordistributionofcriticalresourcessuchastheregisterﬁlethoughengenderssizableincreasesinchiparea,designandwiringcomplexity,aswellascriticalpathdelay,thussigniﬁcantlylimitingtheirapplicability.Asthepeaktemperatureisdeterminedbythemostfre-quentlyaccessedregisters,thermal-awareregisterreassignmenttechniques[20],[21]havebeenproposed.Bothtechniquesreducethelevelofasymmetryinregisteraccessesthroughmappingthemostfrequentlyaccessedregisterstodistinctregisterbanks.However,asbothtechniquesneedtorevisittheNP-hardproblemofregisterallocation,thequalityofthesolutionsisdeterminedbythequalityoftheirheuristicalgorithms.Morecrucially,nomatterhowgoodtheheuristicsare,suchtechniquescannotcompletelyeliminatetheaccessasymmetrytoeachregister,sincesuchasymmetrydirectlyderivesfromtheasymmetricvariableutilizationoftheprogram.Asaresult,thesetechniquescanonlyattainacoarse-grainedspatialbalance,implyingthattheyareonlyapplicabletomulti-bankregisterﬁles.Incontrast,thetechniqueweproposeiter-ativelymapsalogicaldestinationtodistinctphysicalregistersacrossloopiterations,thusenablingtheattainmentofaﬁne-grainedtemporalbalancetoeachindividualregisterwithoutrevisitingtheregisterallocationproblem.III.TECHNICALMOTIVATIONThedesignofadynamicregistershufﬂingprocesstoreducetheregisterﬁlepeaktemperatureand,hence,toimprovechipreliability,ismotivatedbytheobservationthatthecodegeneratedbythecompilerexhibitshighlyasymmetricregisteraccessactivity.Atraditionalregisterallocationschemeinatemperature-unawarecompilerinitiallyassumesaninﬁnitesetofvirtualregistersforrepresentation,andsubsequentlymapsthesevirtualregistersintoaﬁxednumberofarchitecturalregisters.Thedecisionregardingwhichphysicalregistersinparticulararetobeallocated,however,doesnottakeintoconsiderationtheaccessdistribution,thusleadingtoahighlyasymmetricregisteraccessactivity.Figure1,whichpresentsthecumulativeregisteraccessratiosofasetofSPEC2000(shownintheﬁrst4barsofFigure1)andmediabenchprograms(thesecond4bars),providesexperimentalconﬁrmation.Ascanbeseen,bothsetsofbenchmarksexhibitanappreciableamountofimbalanceinthat48%to71%ofthetotalregisteraccessesare978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
470
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 09:58:58 UTC from IEEE Xplore.  Restrictions apply. 
t9:a5:t8:t10:1R+1W1R+1W2R+1W2Rra:1R+1W1Rt11:1R2R+2W2R+1W1R+1W3R+1Wt9:a5:t8:t10:ra:t10t9t9a5t8t11t9a5t8t12t8t12t9a5t10t12t9a5t12t9a5t11t11t8t12t9t11t12t11t9a5t10t10t12t11t101.2.3.4.5.6.7.8.9.10.11.12.13.i1i2i3i4(c) Shift of destination regsiter:1.2.3.4.5.6.7.8.9.10.11.12.13.14.movldbuaddlldastbxorbeqmovldbuaddlstbxorbne1(t10)0x1, t8ra, a5a52(t10)−1(t10)nexta50(t10)0x1, t80(t10)ra, a5looploop:next:stbt9,a5,t8,t9,t9,a5,t9,t9,t8,t9,t11,a5,t11,t10,(a) Code fragment(b) Control & data flowB1B28(sp)Fig.2.Aloopexampleobtainedfrombzip2to4registers.MediabenchprogramsdisplayahigheramountofimbalanceascomparedtoSPEC2000benchmarks.Ontheaverage,asetof12outofatotalof32registersisabletocapturemorethan90%ofthetotalregisteraccesses.TheasymmetricregisterutilizationshowninFigure1con-ﬁrmsthatbyevenlydistributingtheaccessestoeachindividualregisterwithinfrequentlyexecutedloops,thepeakpowerden-sityandhencethepeaktemperaturecanbeeffectivelyreduced.However,suchabalancingcannotbedirectlyattainedthroughanassignmentofregisternamesduringcodegeneration,astheaccessasymmetrydirectlyderivesfromtheasymmetricvariableutilizationoftheprogram.ThislimitationcanbemoreconcretelyillustratedbyarepresentativecodefragmentpresentedinFigure2a,anunrolledloopcomposedof13instructionsthataccountsformorethan25%ofthetotalexecutiontimeofbzip2.ThecorrespondingcontrolﬂowandregisteraccesspatternarepresentedinFigure2b.Ascanbeseen,thisloopexhibitsaquiteunbalancedregisterutilizationasitonlyaccesses6(a5,t8–t11,ra)outof32generalpurposeregisters.Amongthese6registers,a5,t9,andt10areaccessedmostfrequently.Whilethecompilermaybeabletousemoreregistersbyseparatingmultipledeﬁnitionsofasingleregister(a5andt9)orfurtherunrollingtheloop,individualregisteraccesseswouldstillremainskewedduetotheexistenceofsinglyassignedyetfrequentlyreferredregisters,suchast10.Sincethestaticregisterallocationprocesscannotcompletelybalancetheaccessestoeachindividualregister,adynamicmappingneedstobeestablishedbetweentheencodedregis-ternames,denotedasthelogicalregisters,andtheregisterinstancesintheregisterﬁle,denotedasthephysicalregisters,tophysicallyremapheavilyaccessedlogicalregisterspriortolocalheatbuildup.Thistaskcouldbeachievedthroughusingahardwaremappingtable,suchastheoneusedinconventionalsuperscalarprocessors,torecordfreephysicalregistersandredirectregisteraccesses.Unfortunately,suchamappingtableimposesanotableamountofhardwarecomplexity,energyconsumptionandperformanceoverhead.Morecrucially,asthetableneedstobeaccessedusinglogicalregisternamesatafrequencynolowerthanthatofregisterﬁleaccesses,thissmallhardwareunititselfwouldhencebecomeatemperature“hotspot”withskewedaccessdistribution.Thissigniﬁcantenergyandheatoverheadconﬁrmsthatatemperature-awareregisterﬁleshouldbeabletoevenlydistributeaccessestoeachregisterwithnorelianceonahardwaremappingtable.Moreover,asnohardwaremappingtableisusedtokeeptrackofrun-timeregisterusageorregistermappinginformation,regularityneedstobeembeddedwithinregisteraccessessothatthemappingbetweenlogicalandphysicalregisternamescanbecontrolledinadeterministicmanner.Speciﬁcally,thefollowingtwotasksneedtobeaccomplished:•Selectafreephysicalregisterforeachwriteaccesswithnodynamicregisterusageinformation;•Redirecteachreadaccesstothecorrespondingphysicalregisterwithnodynamicmappinginformation.Theseissuesnecessitateaneasilycomputabledynamicmap-pingthatdeterministicallycontrolstherenamingprocess.Toattainthisgoal,inthispaperweproposeacompiler-directeddynamicregistershufﬂingtechniquetocontrolthelogical-to-physicalregistermappingonaperiterationbasis.Byexploit-ingthefactthatnoﬁxed,preordainedcorrespondenceexistsbetweenprogramvariablesandregisternames,thecompilercanestablishacertainpropertybetweentheﬁxedstaticnameandtheiterativelyvaryingdynamicnameofalogicalregister,thusenablingthehardwaretoredirectregisteraccesseswithnorelianceonamappingtable.IV.DETERMINISTICREGISTERSHUFFLINGA.AnillustrativeexampleThefundamentalgoaloftheproposedregistershufﬂingtechniqueistoevenlybalanceregisteraccessesacrossloopiterationswithnorelianceonahardwaremappingtable.Accordingly,notonlyadynamiclogical-to-physicalregistermappingneedstobeestablished,butfurthermoredeterminismneedstobeembeddedwithinsuchadynamicmapping.Toattainadeterministicregisterremapping,theproposedtechniqueexploitsthefactthatduringloopexecution,thephysicalregisterusedattheprecedingiterationbecomesfreewheneveranewphysicalregisterisallocatedasthedestinationofaninstruction.TakingthecodefragmentpresentedinFigure2aasanexample,uponanewiteration,ifafreeregister(t12forexample)isusedasthedestinationofinstruction1,theolddestination,t9,becomesfreethereafter.Asaresult,t9canbeusedasthenewdestinationofinstruction2,whichinturnfreesupa5,allowingittobeusedforinstruction3,andsoonandsoforth.Thisshiftinregisterassignmentscanbeclearlyseeninthei2columnofFigure2c.Finally,attheendofthisiteration,t11hasbeenfreed,thusallowingittobeusedasthenewdestinationofinstruction1atthenextloopiteration.Theremappingofthedestinationregistersduringtheﬁrst4consecutiveiterationsissummarizedinFigure2c.ItcanbeseenfromtheregisternamespresentedinFigure2cthattheproposedregisterremappingprocessexhibitsthefollowingtwoproperties:•Acrossloopiterations,alogicalregisterissequentiallymappedtoallthephysicalregistersbeforeitshufﬂesbacktotheinitialmapping.•Withinasingleiteration,alltheassignmentsofasinglelogicalregisteraremappedtothesamephysicalregister,thusestablishingaone-to-onemappingbetweenlogicalandphysicalregisternames.978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
471
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 09:58:58 UTC from IEEE Xplore.  Restrictions apply. 
Theﬁrstpropertyindicatesthattheproposedtechniquecaneffectivelybalanceaccessestoindividualregistersacrossloopiterations.Althoughthistechniquedoesnotreducetheenergyconsumedineachregisteraccess,itstilleffectivelypreventslocalheatbuildupsinceheavilyaccessedlogicalregisters,suchasa5,t9andt10intheexample,aremappedtodistinctphysicalregistersacrossloopiterations.Astemperaturetakesatleast0.1millioncyclestoriseby0.1°C[6],thisbalancedaccessactivity,achievedatthegranularityofloopiterations,enablesaneffectivereductionoftheregisterﬁlepeaktemperature.Thesecondpropertyenablestheproposedremappingschemetoattainaccessdeterminism.Speciﬁcally,withinasingleiterationasaone-to-onemappingisestablishedbetweenlogicalandphysicalregisternames,thedynamicnameofaregistertobecompletelydeterminedaccordingtothestaticnameandtheloopiterationcount,thuseliminatingthenecessityofahardwaretabletorecorddynamicregistermapping.B.DestinationregisternameadjustmentAteachiteration,theproposedschemedeterministicallyremapsthekthlogicaldestinationregistertothephysicalregisterusedasthe(k−1)thdestinationinthelastiteration.Thisrecursiverelationshipcanbeformalizedasfollows,withDN(Rik)denotingthedynamicnameofthekthdestinationregisteratiterationi:DN(Rik)=DN(Ri−1k−1)=DN(Ri−2k−2)=...(1)Equation(1)illustratesacrucialpropertyoftheproposedregistershufﬂingtechnique:duringloopexecutionallthelogicaldestinationregistersareiterativelymappedtothesamesetofphysicalregistersinthesameshiftingorder.Theshiftingorderofthebzip2example,representedbythearrowsinFigure2c,is(t9,t12,t11,t10,t8,a5,t9).Moreover,thisshiftingorderhappenstobethereverseoftheorderinwhicheachlogicalregisterappearsasadestinationwithintheloopbody.Thereverse-orderpropertyindicatesthatifaﬁxedoffsethasbeenimposedbetweenanytwoconsecutiveyetdistinctdestinationregisternames,anytwoconsecutivemappingsofalogicalregisterwouldalsoexhibitaﬁxedoffset.Moreformally,byimposingaﬁxedoffsetofO(cid:2)betweenthestaticnamesofthekthandthe(k−1)thdestinationregisters,thedynamicnameofregisterRkatiterationi,denotedasDN(Rik),canbegeneratedthroughshufﬂingDN(Ri−1k)byaﬁxedoffsetofO.UsingVαOtodenotetheshufﬂeofavalueVbyanoffsetOforαtimes,thisﬁxed-offsetrelationshipcanbeformalizedintothefollowingequations,withOandO(cid:2)beingcomplementsinthat(VαO)αO(cid:2)=VforanypositiveintegersVandα.DN(Rik)=DN(Ri−αk)αO=SN(Rk)iO(2a)SN(Rk)=SN(Rk−α)αO(cid:2)=SN(R0)kO(cid:2)(2b)AccordingtoEquation(2),atiterationi,thedynamicnameofregisterRkcanbegeneratedthroughshufﬂingthecorre-spondingstaticregisternameSN(Rk)byanoffsetofOforitimes,whileSN(Rk)shouldbegeneratedthroughshufﬂingthestaticnameofthe0thdestinationregisterSN(R0)byanoffsetofO(cid:2)forktimes.TheseequationsclearlyconﬁrmthatTABLEITHEUSEOFTHETWOSHUFFLEFUNCTIONSTOSHIFTREGISTERNAMESINTHEbzip2EXAMPLE,B=1,O=1,T=7ModuloAdditionGF(23)Multiplicationai0i1i2i3i4i5i6i0i1i2i3i4i5i6t9→B12345671243675a5→B1O(cid:2)71234565124367t8→B2O(cid:2)67123457512436t10→B3O(cid:2)56712346751243t11→B4O(cid:2)45671233675124DN(Rik)=(SN(Rk)+i)%7=SN(Rk)⊗2iSN(Rk)=(SN(R0)−k)%7=SN(R0)⊗27−kaTheﬁeldgeneratingpolynomialofGF(23)isx3+x+1.ateachiteration,thedynamicregisternamescanbecompletelydeterminedbythecompiler.Toeffectivelybalanceregisteraccesseswhileminimizingthehardwarecomplexity,alight-weightshufﬂingfunctionisfurthermorenecessitated.GivenashufﬂewindowcomposedofasetofcontiguousphysicalregistersB,B+1,...,B+T−1,aneffectiveshufﬂingfunctionneedstoensurethateachlogicaldestinationregisterRkwillbesequentiallymappedtoeachphysicalregisterwithinthewindowbeforeitshufﬂesbacktotheinitialmapping.Inotherwords,theshufﬂingfunctionneedstoestablishaone-to-onemappingfromV1O,V2O,...,VTO,theTconsecutivedynamicnamesofregisterRk,totheTdistinctvaluesB,B+1,...,B+T−1,withintheshufﬂewindow.Accordingtothisrequirement,twoshufﬂefunctions,namely,amoduloadditionandaGaloisﬁeldmultiplication,canbeemployedtoattainadeterministicregistershifting,assummarizedinthefollowingequation.SN(Rk)=BkO(cid:2)=(cid:2)B⊗2T−(k∗O)%T,T=2n−1;(B−k∗O)%T,GCD(O,T)=1.(3)InmoduloTaddition,thestaticregisternameofRkisgeneratedas(B−k∗O)%T.ThevaluesoftheoffsetOandthewindowsizeTshouldberelativelyprimesoastoensuretheassignmentofdistinctphysicalnamestodifferentlogicregisterswithinasingleiteration.Inhardware,thisadditionfunctioncanbeimplementedusingaj-bitmoduloTadderforeachregisteraccessport,assumingatotalof2jregistersprovidedinthearchitecture.Ontheotherhand,ifthevalueofthewindowsizeTequals2n−1,amoreefﬁcientshufﬂefunctioncanbeimplementedsothatBkO(cid:2)=B⊗2T−(i∗O)%T,with⊗denotingthemultiplicationoperatorsdeﬁnedintheextensionGaloisﬁeldofGF(2n).Thehardwareimplementationofthismultiplicationfunctioniscomparativelycheaperasnomoduloaddersbutonlyalimitednumberofxorgatesarerequired.ThedifferencesbetweenthesetwofunctionsareconcretelyillustratedinTableI,whichshowsthemappingoftheﬁvedestinationregistersofthebzip2examplein7consecutiveiterations,withB,OandTsetto1,1,and7,respectively.C.Loop-carrieddependencepreservationAsthenewnameofeachlogicaldestinationregistercanbedeterminedusingEquation(3),thenamesofsourceregisters978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
472