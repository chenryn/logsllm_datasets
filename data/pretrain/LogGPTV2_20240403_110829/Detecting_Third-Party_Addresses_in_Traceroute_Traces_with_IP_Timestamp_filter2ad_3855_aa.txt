title:Detecting Third-Party Addresses in Traceroute Traces with IP Timestamp
Option
author:Pietro Marchetta and
Walter de Donato and
Antonio Pescapè
Detecting Third-Party Addresses
in Traceroute Traces with IP Timestamp Option
Pietro Marchetta, Walter de Donato, and Antonio Pescap´e
{pietro.marchetta,walter.dedonato,pescape}@unina.it
University of Napoli Federico II Italy
Abstract. Traceroute is one of the most famous and widely adopted di-
agnostic tool for computer networks. Although traceroute is often used
to infer links between Autonomous Systems (ASes), the presence of the
so-called third-party (TP) addresses may induce the inference of false
AS-level links. In this paper, we propose a novel active probing tech-
nique based on the IP timestamp option able to identify TP addresses.
For evaluating both the applicability and the utility of the proposed
technique, we perform a large-scale measurement campaign targeting –
from multiple vantage points – more than 327K destinations belonging
to about 14K ASes. The results show how TP addresses are very com-
mon and aﬀect about 17% of AS-level links extracted from traceroute
traces. Compared to a previously proposed heuristic method, our tech-
nique allows to identify many more TP addresses and to re-interpret part
of its results.
1
Introduction
An accurate knowledge of the Internet topology is essential for a deep under-
standing of such a complex and ever-evolving system [7, 11, 19, 20]. In the last
decade many attempts have been done to overcome the incompleteness of BGP-
derived AS-level topologies [12] using traceroute [4, 8, 13]. However, traceroute
is known to be inaccurate and to induce errors when its results are used to infer
the Internet topology [15, 17, 27].
One source of inaccuracy is represented by the so called third-party (TP)
addresses [14, 18], i.e. addresses associated to interfaces which are not actually
traversed by the IP packets sent toward the traceroute destination. While several
other causes may impact the accuracy of AS links derived from traceroute – such
as divergence between data and control paths, anonymous hops, unmapped hops,
Internet exchange points (IXPs), multi-origin AS preﬁxes, and siblings – TP
addresses (when shared between peering AS neighbors) were recently deﬁned
by Zhang et al. [27] as “the last and the most diﬃcult cause to be inferred”
and as “a huge obstruction towards the accuracy of traceroute measurements”.
Several works, by using heuristic methods, tried to deal with such issues with
diﬀerent objectives: to explain the mismatches between BGP- and traceroute-
derived AS paths [8, 27], or to complement the AS-level topology inferred from
BGP repositories [4, 8, 13]. However, to the best of our knowledge, only two
M. Roughan and R. Chang (Eds.) PAM 2013, LNCS 7799, pp. 21–30, 2013.
(cid:0) Springer-Verlag Berlin Heidelberg 2013
22
P. Marchetta, W. de Donato, and A. Pescap´e
works tried to isolate and study the phenomenon of TP addresses in order to
quantify their impact, achieving diﬀerent conclusions. By adopting a heuristic
method based on IP-to-AS mapped traceroute traces, Hyun et al. [14] conclude
that TP addresses mostly appear at the border of multi-homed ASes and cannot
be a signiﬁcant source of AS map distortion. On the other hand, by using pre-
computed AS-level graphs and pre-acquired knowledge about routers interfaces,
Zhang et al. [27] conclude that TP addresses cause 60% of mismatches between
BGP- and traceroute-derived AS paths, where mismatches aﬀect from 12% to
37% of the paths depending on the vantage point.
In this paper, for shedding light on this controversial topic, we propose the
ﬁrst active probing technique able to directly detect the presence of TP addresses
in traceroute IP paths. Our technique is based on the IP prespeciﬁed timestamp
option [5] and requires no previous knowledge about routers interfaces, nor AS
paths provided by BGP or IP-to-AS mapping. Performing a large scale measure-
ment campaign, we evaluate the technique showing that: (i) the same IP address
may be a TP or not depending on both the source and the destination of the IP
path; (ii) TP addresses aﬀect 17% of the AS links extracted from our dataset
and (iii) they appear in a signiﬁcant portion of the detected AS-level loops. We
further compare our technique with the method proposed by Hyun et al. [14],
which is the only other method not using AS paths extracted from BGP. The
comparison reveals that only 1.5% of IP addresses detected as TP by our tech-
nique are recognized as such by their heuristic, explaining the underestimation
of the phenomenon.
The paper is organized as follows. Sec. 2 introduces TP addresses and ex-
plain their eﬀect when traceroute is used to infer topological information; Sec. 3
presents our active probing technique to identify TP addresses in traceroute
traces; Sec. 4 describes the methodology adopted to evaluate the proposed tech-
nique as well as the main ﬁndings; Sec. 5 concludes the paper.
2 Understanding TP Addresses and Their Impact
The RFC1812 [5] states that the source address of an ICMP error packet should
correspond to the outgoing interface of the ICMP reply, rather than the interface
on which the packet triggering the error was received [14]. This behavior can
cause a traceroute IP path to include addresses associated to interfaces not
included in the path actually traversed. For instance, the trace from S to D in
Fig. 1 contains the sequence (a, b, c) of IP addresses (hereafter IPs), where a
and b are associated to the incoming interfaces of routers A and B respectively,
and c is the interface used by router C to send ICMP replies to the traceroute
originator. The IP c is a TP address since it is associated – in this speciﬁc trace
– to an interface not eﬀectively traversed by the packets sent from S to D.
The occurrence of TP addresses can have a signiﬁcant impact on some tracer-
oute applications. The major impact is related to the inference of AS-level links
from traceroute traces: as shown in previous works [14, 27], TP addresses may
cause the inference of false AS links. Consider again Fig. 1: if the IP address b
Detecting Third-Party Addresses in Traceroute Traces
23
Fig. 1. TP addresses inducing the inference of false AS links
belongs to ASx, and c belongs to the ASz addressing space, then the IP-to-AS
mapping of the trace will induce the inference of a false AS link, i.e. ASx− ASz.
Note also how the TP address hides the ASy which, tough traversed, does not
appear in the mapped AS-level trace.
While TP addresses may also impact subnet positioning [26] and alias reso-
lution [25], forcing the adoption of several complex heuristics, in this paper we
focus on their impact on the AS-level links inferred from traceroute traces.
3 Detecting TP Addresses
Our technique only requires two probes to understand if an IP address discovered
by traceroute lies on the path (OP) or not (TP).
Basic Principles. Our technique is based on the IP prespeciﬁed timestamp
(TS) option [23]. It allows to prespecify in a single packet up to four IP ad-
dresses from which a timestamp is requested. Hereafter, we adopt the notation
(cid:2)
(cid:2)ABCD introduced in [24], where PROBE is the probe type, X is the
PROBE X
targeted destination and ABCD is the ordered list of prespeciﬁed IPs from which
a timestamp is requested1.
Thanks to a large-scale measurement campaign targeting more than 1.7M
IP addresses [10], we detected that most routers (including Cisco devices), when
processing such option, insert one timestamp every time the probe passes through
the interface associated to the prespeciﬁed address. Such behavior can be easily
(cid:2)
detected by targeting Y with an ICMPecho
(cid:2)YYYY probe. According to [10],
if the ICMPecho
reply message contains 1 timestamp, it means that the interface Y
was only traversed by the probe when entering the router. If it contains 2 times-
tamps, Y was traversed by the probe providing either one timestamp when both
entering and leaving the router or two timestamps just when entering. Finally,
3 timestamps occur if the probe was stamped twice when entering the router,
but only once when leaving it. In such three cases the targeted router exposes a
per network interface stamping behavior, which can be exploited to understand
if a traceroute hop is part or not of the forward IP path.
request Y
1 The order implies that B cannot insert its own timestamp before A, and so on.
24
P. Marchetta, W. de Donato, and A. Pescap´e
Fig. 2. Classiﬁcation of the hop Y discovered by traceroute toward D
TP Address Detection Technique. In order to understand if the hop Y
discovered by traceroute toward D is a TP address, the proposed technique
works according to the following steps (see Fig. 2): (1.) it targets Y with an
(cid:2)
ICMPecho
(cid:2)YYYY probe to verify if it is classiﬁable or not (see below); (2.) if
(cid:2)
(cid:2)YYYY2: if the TS option brought back
Y is classiﬁable, it targets D with UDP D
port
unreach message contains at least one timestamp, Y
into the payload of the ICMP
is classiﬁed as OP, otherwise it is a TP address.
request Y
The ﬁrst step is necessary because there are other less common router be-
haviors that may lead the technique to misleading results. Indeed, adopting a
conservative approach, a traceroute hop Y is considered non−classiﬁable ev-
ery time there is no clear evidence that its router has a per network interface
stamping behavior, as in the following circumstances:
– Private Address (PVT): Y is part of a private addressing block and it
may be unreachable by the ICMPecho
request message or it may be employed in
diﬀerent networks along the path toward the destination. In the latter case, a
port
unreach message may be inserted by a diﬀerent router.
timestamp in the ICMP
(cid:2)
(cid:2)YYYY,
thus either the targeted device dropped the probe or the reply was ﬁltered
along the path3.
– Lack of Reply (NO−REP): No reply is received to ICMPecho
– The TS Option is Removed (NO−OPT): The ICMPecho
reply message re-
ceived from Y contains no TS option, thus either the targeted hop did not
replicate the option in the reply or the option was removed along the path.
– Zero Timestamps (NO−TS): The targeted device simply ignores the TS
request Y
option, without inserting any timestamp in the ICMPecho
reply message.
– Four Timestamps (JUN): The targeted device provides 4 timestamps.
Such behavior has been already observed in the case of Juniper routers, which
insert their timestamp also when the prespeciﬁed address is associated to any
owned interface [10]. Hence, the presence of a timestamp in the ICMP
message obtained during the second step would not allow to classify Y.
port
unreach
In other words, a traceroute hop Y is considered classiﬁable only if it provides
from 1 to 3 timestamps when directly probed with ICMPecho
(cid:2)
(cid:2)YYYY.
request Y
2 UDP probes allow to avoid ambiguities caused by the reverse path [10].
3 In [10], we observed how equipping classic active probes with the TS option causes
a strong reduction of the responsiveness.
Detecting Third-Party Addresses in Traceroute Traces
25
We also implemented and made publicly available 4 an enhanced traceroute
version, based on paris−traceroute [3], which applies our technique to classify
the hops discovered along the path toward the destination.
4 Experimental Evaluation
In this section, we describe the large scale measurement campaign conducted to
evaluate the proposed technique as well as the main ﬁndings.
4.1 Measurement Campaign
To evaluate our technique, we selected more than 327K destinations in 14K
ASes among the ones showing stable responsiveness to both ping, according to
the PREDICT project [2], and UDP probes carrying the TS option5. To perform
a large scale measurement campaign, we used 53 PlanetLab nodes [6] located in
diﬀerent ASes as vantage points (hereafter VPs).
request Y
In particular, each node was instructed to (1.) send UDP probes toward
the destinations and select those which reply and preserve the TS option; (2.)
launch UDP paris-traceroute toward the selected destinations; (3.) launch an
(cid:2)
ICMPecho
(cid:2)YYYY toward each intermediate hop Y; (4.) select the classiﬁ-
able hops as the ones providing 1−3 timestamps; (5.) send an UDP probe toward
the traceroute destination prespecifying each time a diﬀerent classiﬁable hop col-
lected on the path. In order to avoid ambiguities caused by load balancers, the
UDP probes used to classify the hops and the ones generated by traceroute are
crafted as part of the same ﬂow according to [3].
After removing the traces aﬀected by ﬁltering, the ﬁnal dataset – publicly
available 4 – consisted of ∼12M traces for a total number of ∼ 443K addresses.
4.2 Main Findings
Since every VP traced IP paths toward the same destinations, a speciﬁc IP
address may be discovered by multiple VPs: this happens especially for those
located close to the destinations. Fig. 3 shows how many distinct VPs discovered
the same IP address: more than 96% of IPs were captured by at least two VPs,
while about a half were captured by more than 35 VPs.
Hops Classiﬁability. When an IP address is captured by multiple VPs, each
node independently states if it is classiﬁable or not. However, the TS option may
trigger the ﬁltering of the ICMPecho
reply message on some paths inducing a subset
of VPs to consider the targeted device as non−classiﬁable (NO−REP). Fig. 4
reports the number of nodes not receiving replies from a device which successfully
replied to at least one VP: only 15% of addresses did not experience such in-
transit ﬁltering, while on average 4 VPs were forced by ﬁltering to consider a
device as non−classiﬁable. We can conclude that the number of VPs is a key
point for applications based on the TS option [16, 24].
http://traffic.comics.unina.it/tpa/
4
5 According to a campaign conducted from our laboratory at University of Napoli.
26
P. Marchetta, W. de Donato, and A. Pescap´e
1
0.8
0.6
0.4
0.2
F
D
C
1
0.8
0.6
0.4
0.2
F
D
C
0
0
60
#VPs observing the same address
20
40
Fraction of Classifiable Hops per Path
0.6
0.8
1
Worst VP
Entire Dataset
Best VP
0
0
0.2
0.4
Fig. 3. VPs observing each
IP of the dataset
Fig. 4. In−transit