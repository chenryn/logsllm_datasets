hosting devices of type A and B. Devices of type C are harder to
detect given the sampling rates and header-only nature of NetFlow.
In this paper, we use a unique testbed and dataset to build a
methodology for detecting and monitoring IoT devices at scale (see
Figure 2). We (cid:128)rst use controlled experiments, where we tunnel
the tra(cid:129)c of two IoT testbeds with 96 IoT devices to an ISP. (cid:140)is
provides us with ground truth IoT tra(cid:129)c within this ISP (Section 2).
We con(cid:128)rm the visibility of the ground truth IoT tra(cid:129)c using the
NetFlow ISP data (Section 3). Next, we identify backend infras-
tructures for many IoT services, from the observed ISP IoT tra(cid:129)c
(Section 4). We augment this base information with data from DNS
queries, web certi(cid:128)cates, and banners. Next, we use the tra(cid:129)c sig-
natures to identify broadband subscriber lines using IoT services
at the ISP, as well as an IXP (Section 6). Finally, we discuss our
results, their signi(cid:128)cance, and limitations in Section 7, related work
(Section 8), and conclude with a summary in Section 9.
• We develop a methodology for identifying IoT devices, by classi-
fying domains and IP addresses of the backend infrastructure. To
this end we derive distinct signatures, in terms of IP/domain/port
destinations, to recognize IoT devices. With our signatures we
were able to recognize the presence of devices from 31 out of 40
manufacturers in our testbed.2
Our main contributions are as follows:
2To foster further research in the area of IoT privacy and security, we make all the
signatures available at h(cid:138)ps://moniotrlab.ccis.neu.edu/imc20/
2
ISPDevice A IoT Service Flow Device B IoT Service Flow Device C IoT Service Flow Subscriberw/ IoTServerDedicatedInfrastructureCDNFigure 2: General methodology overview.
Figure 3: ISP setup
& (cid:131)ow collection points.
Figure 4: IXP setup
& (cid:131)ow collection points.
to us and for each experiment we use the default DNS server for
the ISP. Importantly, since the /28 pre(cid:128)x is used explicitly for our
experiments, there was no other network activity other than that
of the IoT devices.
Ethical considerations–Home-VP setting. With the coopera-
tion of the ISP, we were able to use a reserved /28 allocated to this
speci(cid:128)c subscriber line (Home-VP) (with signed explicit consent)
out of a /22 pre(cid:128)x reserved for residential users. (cid:140)us, the analysis
in this paper only considers tra(cid:129)c explicitly ingested by the ground
truth experiments and does not involve any user-generated tra(cid:129)c.
2.2 Ground Truth Tra(cid:129)c Setting
(cid:140)e IoT testbeds used here consist of 96 devices from 40 vendors.
We selected the devices to provide diversity within and between
di(cid:130)erent categories: surveillance, smart hubs, home automation,
video, audio, and appliances. Most of these are among the most
popular devices, according to Amazon, in their respective region.
Our testbed includes multiple instances of the same device (56
di(cid:130)erent products), so that we can see the destinations that each
product contacts in di(cid:130)erent locations. For a list of the IoT devices
and the category of each device, we refer to Table 1. We redirect all
IoT tra(cid:129)c to the Home-VP within the ISP, and we capture all the
tra(cid:129)c generated by the IoT devices (see 1 in Figure 2).
Most of the selected IoT devices are controlled using either a
voice interface provided by a voice assistant (such as Amazon Alexa)
or via a smartphone companion application. We use the voice inter-
face to automate active experiments by producing voice commands
using a Google Voice synthesizer. For IoT devices that support a
companion app, we use Android smartphones, and we rely on the
Monkey Application Exerciser for Android Studio [14] for automat-
ing simulated interactions between the user and the IoT device.
2.3 Active and Idle IoT Experiments
Our experiments can be classi(cid:128)ed into idle and active experiments.
Idle experiments. We de(cid:128)ne as idle the experiments during which
the devices are just connected to the Internet without being actively
used. We generate idle tra(cid:129)c for three days (November 23rd-25th,
2019) from both testbeds.
Category
Surveillance
Device Name
Amcrest Cam, Blink Cam, Blink Hub, Icsee Door-
bell, Lefun Cam, Luohe Cam, Microseven Cam,
Reolink Cam, Ring Doorbell, Ubell Doorbell,
Wansview Cam, Yi Cam, ZModo Doorbell
Insteon, Lightify, Philips Hue, Sengled, Smar(cid:138)hings,
SwitchBot, Wink 2, Xiaomi
Smart Hubs
Home Automation D-Link Mov Sensor, Flux Bulb, Honeywell T-stat,
Magichome Strip, Meross Door Opener, Nest T-stat,
Philips Bulb, Smartlife Bulb, Smartlife Remote, TP-
Link Bulb, TP-Link Plug, WeMo Plug, Xiaomi Strip,
Xiaomi Plug
Apple TV, Fire TV, LG TV, Roku TV, Samsung TV
Allure with Alexa, Echo Dot, Echo Spot, Echo Plus,
Google Home Mini, Google Home
Anova Sousvide, Appke(cid:138)le, GE Microwave,
Netatmo Weather, Samsung Dryer (idle), Sam-
sung Fridge (idle), Smarter Brewer, Smarter Cof-
fee Machine, Smarter iKe(cid:138)le, Xiaomi Rice Cooker
Video
Audio
Appliances
Table 1: IoT devices under test. idle indicates that we capture the
tra(cid:129)c just for idle periods because the experiments could not be
automated.
Active experiments. We de(cid:128)ne as active the experiments involv-
ing automated interactions. We perform two types of automated
interactions, each one repeated multiple times: (i) power interac-
tions, since in a previous study [4] it was reported that many IoT
devices generate signi(cid:128)cant tra(cid:129)c when they are powered o(cid:130) and
on. We manage the power status of the devices through several
TP-Link smart plugs that we can control programmatically, fol-
lowed by two minutes of tra(cid:129)c capture; (ii) functional interactions,
by automatically controlling the main functionality of the devices
(i.e., the act of switching on/o(cid:130) the light for a smart bulb) via voice
(either directly or through a smart speaker) or via a companion app
running on a separate network with respect to the IoT device (to
force the communication to happen over the Internet rather than
locally). Unfortunately, some interactions for some devices cannot
easily be automated (devices with idle in Table 1). For these devices,
we consider only idle experiments. In total, we perform 9,810 active
experiments between November 15th and 18th, 2019.
3
ISP223332244445555551Generate and capture ground truth (GT) IoT traﬃc in the labs and household - Section 22Capture GT traﬃc in ISP Vantage pointEvaluate visibility of GT IoT traﬃc in the ISP-VP - Section 33Identify IoT domains, service IPs , and port numbers, generate detection rules - Section 4    4Detect IoT devices in the wild - Section 65Cross check detection rules by inferring devices on GT data - Section 5 Home w/ IoT Devices1Border RouterBNG RouterBorder RouterHome Vantage PointBorder RouterTestbed 1 w/ IoT DevicesTestbed 2 w/ IoT DevicesBNG RouterIoT Traﬃc through VPNDevice A IoT Service Flow Device B IoT Service Flow Device C IoT Service Flow Packet Capture PointFlow Capture PointBNG RouterBorder RouterDevice A IoT Service Flow Device B IoT Service Flow Flow Capture PointIXP Member(a) # Unique service IPs per hour.
(b) # Unique domains per hour.
(c) Cumulative service IPs per port.
Figure 5: Home-VP vs. ISP-VP.
(d) # Unique IoT devices per hour.
and 1,300 service IPs per hour when monitored at the Home-VP.
Due to sampling, not all of this tra(cid:129)c is visible at the ISP-VP. We
de(cid:128)ne service IPs as the sets of IPs associated with the backend
infrastructures that support the IoT services. Indeed, the number of
observed service IPs per hour in the ISP-VP decreases to an average
of 16%. Overall, during our idle experiments, the total number
of contacted service IPs is lower, but the average percentage of
observed service IPs remained at 16.5%.
(cid:140)e spikes in the active experiments are partially due to power
and the functional interactions. (cid:140)is can be seen on the idle experi-
ments, where the spike indicates the action of starting the device
(only at the beginning). Note that these spikes are also visible in
the sampled ISP NetFlow data.
At (cid:128)rst glance, 16% sounds like a very small percentage. However,
we note that the visibility of popular service IPs is signi(cid:128)cantly
high. Figure 6 shows the fraction of service IPs that are visible for
the servers contacted the most, according to byte count. For the
top 10% of the service IPs, more than 75% are visible, rising up to
90% during some experiments. For less popular service IPs, e.g., the
top 20% and top 30%, the visibility is only reduced to 70% and 60%
in the active experiment, and a bit lower for the idle experiment.
If we consider the entire period of our experiments, the percent-
age of visible service IPs is more than 34% and 28% for idle and
active experiments. Overall, at the daily level, more than 95% of
service IPs are visible for the top 20%. Although we cannot observe
all IoT devices activity at the ISP-VP, a signi(cid:128)cant subset is visible.
While any speci(cid:128)c service IP may not ma(cid:138)er that much for an IoT
service, its communications with a server domain name that may be
Figure 6: Fraction of observed ISP-VP vs. Home-VP per hour for pop-
ular servers (heavy hitters).
IOT TRAFFIC – VISIBILITY
3
In this section, we aim to understand (i) to which extent the IoT
related tra(cid:129)c of a single subscriber line reaches a diverse set of
servers in the Internet, and (ii) whether the low sampling rate of
NetFlow limits the subscriber/device visibility. For this, we rely
on the ground truth tra(cid:129)c for the Home-VP. More speci(cid:128)cally, we
monitor the IoT tra(cid:129)c at both vantage points: the Home-VP, as well
as the border routers of the ISP-VP (see 1 and 2 of Figure 2).
We (cid:128)rst focus on the number of IP addresses that are contacted
in each hour during the idle and the active experiments by the
IoT devices, as stated in Section 2.3. We explicitly exclude DNS
tra(cid:129)c, since it is not IoT-speci(cid:128)c. From Figure 5(a), we see that
during the active experiments, the IoT devices contact between 500
4
lllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllActive ExperimentIdle ExperimentNov 15Nov 16Nov 17Nov 18Nov 19Nov 22Nov 23Nov 24Nov 2502505007501k1.25kUnique # Service IPs Per HourVantage PointlHome−VPISP−VPllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllActive ExperimentIdle ExperimentNov 15Nov 16Nov 17Nov 18Nov 19Nov 22Nov 23Nov 24Nov 250100200300400Unique # Domains Per HourVantage PointlHome−VPISP−VPllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllActive ExperimentIdle ExperimentNov 15Nov 16Nov 17Nov 18Nov 19Nov 22Nov 23Nov 24Nov 251101001k10kCumulative # Service IPs Per Hour(log10)Type of Service IP  and Vantage PointllHome−VP: Web Service IPsHome−VP: NTP Service IPsHome−VP: Other Service IPsISP−VP: Web Service IPsISP−VP: NTP Service IPsISP−VP: Other Service IPslllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllActive ExperimentIdle ExperimentNov 16Nov 17Nov 18Nov 23Nov 24Nov 250204060Unique # Devices Per HourVantage PointlHome−VPISP−VPActive ExperimentIdle ExperimentNov 15Nov 16Nov 17Nov 18Nov 19Nov 22Nov 23Nov 24Nov 250.000.250.500.751.00FractionObservedHeavy HittersFraction of top 10% service IPs in terms of BytecountFraction of top 20% service IPs in terms of BytecountFraction of top 30% service IPs in terms of Bytecounthosted on multiple service IPs is essential. From the Home-VP, we
know which service IPs correspond to which domain. (cid:140)us, we can
determine which observed service IPs at the ISP-VP belong to which
domain. (cid:140)is information is relevant for our methodology because
in the ISP NetFlow data only IPs are visible. Figure 5(b) shows the
number of observed Fully (cid:139)li(cid:128)ed Domain Names (FQDNs, we
will refer to them as domains or domain names for the rest of the
paper) at the Home-VP and the ISP-VP. Many domains are hosted
at multiple service IPs, hence we see that the number of observed
service IPs is higher than the number of observed domains.
Figure 5(d) shows the number of observed IoT devices per hour
from the ground truth IoT tra(cid:129)c. We observe a device when at
least one packet from that device is seen within an hour. Note,
For active mode, the experiments on devices from Testbed 1 (see
(cid:128)gure 3), are initiated a(cid:137)er Testbed 2. (cid:140)erefore, all devices are not
active during the same period. (cid:140)e average percentages of devices
visible at ISP-VP, during active and idle experiments are 67% and
64% respectively.
Next, we separate the observable network activity by ports. More
speci(cid:128)cally, we consider Web Services (ports 443, 80, 8080), NTP
services (port 123), and other services (the rest of the ports), and
we show the cumulative number of service IPs contacted. (cid:140)e
resulting plot, Figure 5(c), shows that (i) the trend of observable
service IPs at the Home-VP is mirrored at the ISP-VP, even when
di(cid:130)erent services are considered, and (ii) the number of service IPs
converges over time.
We also checked if any of the tra(cid:129)c from the Home-VP is visible
at the IXP. However, neither during the active, nor during the idle
experiments, we observe tra(cid:129)c at the IXP. (cid:140)is is expected as the
ISP is not a member of the IXP. Rather it peers directly (via private
interconnects) with a large number of content and cloud providers
as well as other networks.
In summary, our analysis of the ground truth IoT tra(cid:129)c shows
that, despite the low sampling of NetFlow, popular domains, service
IPs, and ports of a single subscriber line (the Home-VP) are visible
at the ISP.
4 IOT DEVICE DETECTION METHODOLOGY
In this section, we outline our methodology for the detection of IoT
devices in-the-wild. IoT services typically rely on a backend support
infrastructure (see Figure 1) for user interactions. From our ground
truth experiments, we noticed that this backend infrastructure is
o(cid:137)en also used for keep-alives, heartbeats, updates, maintenance,
storage, and synchronization. (cid:140)is observation is consistent with
previous works [4, 15].
We focus on identifying which Internet backend infrastructure is
supporting each of the IoT devices that we deployed in our testbeds
(see 3 in Figure 2). When we refer to Internet backend infrastruc-
ture, we use two di(cid:130)erent abstractions: (i) sets of IP addresses/ports
combinations as observable from the Internet vantage points, and
(ii) sets of DNS domains. We focus also on domains because they
are the primary indirect way for the devices to access their backend
infrastructure. While domain names are typically part of the per-
manent programming of the devices, IP addresses are discovered
during DNS resolution, and may change over time.