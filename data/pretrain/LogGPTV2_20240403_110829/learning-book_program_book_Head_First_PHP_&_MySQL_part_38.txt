稍稿能高一点，这个巴
掌大的小镇就不会知运是谁
干的了。
听爸爸妈妈的话没有错；不要跟陌生人说话。或者至少不要信任他们。
最起码的，不要把应用数据的钥匙给他们，以为他们不会做坏事。这是一
个残酷的世界，你不能过分相信任何一个人。实际上，作为一个Web应用
开发人员，你必须持半怀疑半合作的态度。不过，人往往都有坏心眼，他
们肯定都在想方设法算计你！不错，也许这有点偏激，不过重视安全性
PDG
确实非常重要，要适当地设计应用，使它得到充分保护免受可能有危害的
人进行破坏。
这是新的一章
295
---
## Page 332
GuitarWars遭遇黑客
音乐完结之日
喉呀，摇滚天才的辉煌如此短暂，因为Jacob的Guitar
Wars最高
分不知什么原因不见了，所有其他分数也都无影无踪。看起来就
像有一种恶魔般的力量破坏了这个高分应用，不让最佳吉他手们
（GuitarWarrior）在线竞争。虚拟吉他手们很不高兴，也就是说你
的用户很不高兴，这只会导致一个后果，作为应用开发人员，也
就是你.同样不高兴！
000
Guitar Wars-High Scores
Welcome, Guitar Warrior, do you have what
主页上的高分都消失了
这不公孚！我千辛万苦才
因为它们已经从数据库
成为最佳客他手，可是现
删除！
在我的分数不见了。
GuitarWars最高分得主aco6，看到
他的最高分居然从高分表中消失了.
简直气爽了。
Jaco6选择的音乐武器，最
棒的2005 Eradicastet。
PDG
296
第6章
---
## Page 333
保证应用安全
那些高分都去哪里了？
SELECT奎询显示出
我们知道GuitarWars主页空了，不过这是不是意味着数据库也为空呢？
suitawars表完全为空，所有
一个SELECT查询就能回答这个问题：
分数都没有了！
1d
Idate
(0.0005
所有高分记录行都莫名其妙地从GuitarWars数据库删除了。是不是有
人在利用我们的RemoveScore脚本干坏事？我们要保护这些分数！
圈出可以使用以下哪些技术来保护GuitarWars高分，以免那些增恨吉
他的人加以破坏，然后写出原因。
利用口令保护Admin页面，只有知道口令的
创建一个用户注册系统，只有某些用户
人（你！）才能删除分数。
（你！）才有管理权限。
检查想要访问Admin页面的计算机的IP地址
只允许某些计算机（你的计算机！）访问。
完全去除分数删除特性
你现在的位置
297
---
## Page 334
保护GuitarWars的高分
Sharpenyourpencil
Solution
圈出可以使用以下哪些技术来保护GuitarWars高分，以免那些僧恨吉
他的人加以破坏，然后写出原因。
利用口令保护Admin页面，只有知道口令的
所有这些技术都被圈出，因为它
人（你！）才能删除分数。
们都能解决这个问题，不过其中
某些技术相对来讲更为可行。
用口今保护Admin页面是一个很好的解决方素
快捷而简单，因为这种方素不大复杂，而且可
以很快地保护网站的安全。
创建一个用户注册系统，只有某些用户
（你！）才有管理权限。
有管理员权限的用户注册系统是一个很棒的解决方
素，不过需要做大量的规划和编码工作…….Cuitar
Wars迫切需要现在就提供安全性！
检查想要访问Admin页面的计算机的IP地址
只允许某些计算机（你的计算机！）访问。
检查炉地址的做法是可行的，不过这金使网站
依赖于你的计算机的P地址，而这很可能金改
变。
完全去除分数删除特性。
去除这个特性肯定能解决这个特定问题，不过
如果还记得，上一章之所以增加删除特性就是
为了让网站更易于维护。
298
第6章
---
## Page 335
保证应用安全
保护广大用户
要尽快地保护GuitarWars高分，一种简单而直接的方法就是使用HTTP
HTTP认证提供了
认证通过口令保护Admin页面。这种技术具体要用到一个用户名和一
一种使用PHP保护
个口令，其思想是，管理员访问受限制的应用特性之前（如这里的分
数删除链接），需要提供一些安全信息。
页面的简单方法。
使用HTTP认证保证页面安全时，在允许访问受保护的页面之前，会
弹出一个窗口请求输人用户名和口令。对于GuitarWars，可以限制只
是你希望的某些人可以访问Admin页面，有可能只是你自己！
HTTP认证窗口现在位于用户
和Admin页面之间。
不要被这
个微笑所
透惑！
数据库中的高分现在得到了保
护，因为Admin页面受到保护。
Admin页面上
的“Remove”链接现
在只允许Guitat Was
管理员访问。
你现在的位置
299
---
## Page 336
使用HTTP认证
保护GuitarWarsAdmin页面
HTTP认证的工作原理如下：用户尝试访问一个通过认证保护的页面
时，如我们的Admin页面，会为用户提供一个窗口，要求输入一个用
户名和口令。
允许访问一个受保护的页
这个PHP超级全品变量存储了输
面之前.We6浏览器使用
入到认证富口的用户名。
一个与此类似的窗口请求
输入一个用户名和口今。
Y
0
S_SERVER['PHPAUTHUSER']
Namve
SSERVER['PHPAUTHPW']
为简单起见，
Remember thhs pass
K
口今未加密。
Cancetog
这个变量存储了输入到认证
窗口的口今。
在这里PHP隆重登场，要利用PHP来访问用户输人的用户名和口令。
它们存储在S_SERVER超级全局变量中，这与之前使用的其他超级全
局变量类似（S_POST、$FILES等）。PHP脚本可以分析用户输人
的用户名和口令，并确定是否允许访问受保护的页面。假设只有当用
只有输入了正确的用户
示了如何“解开”Admin页面：
名和口今时才元许访问
Admin页面。
300
第6章
---
## Page 337
保证应用安全
thereareno
DumbQuestions
没有什么是百分之百的安全，所以我们一直在谈论安全度。为了保护
GuitarWars中的高分，HTTP认证提供了一个合理的安全度。还可以对
口令加密来进一步提高安全性。不过，如果应用涉及更机密的数据（如
金融数据），对于这样的应用，HTTP认证可能还不够。
的，不会这么可怕。通常会显示一个消息，让用户知道他们想访问一个
安全页面，而显然他们无权访问这个页面。最终要由你来决定这个消息
的严厉程度。
口令呢？
只重点检查S_SERVER[PHP_AUTH_PW]全局变量。有关这个变量的更
多内容稍后就会介绍
PHP函数吗？
HTTP首部建立一个通信线路。可以把首部认为是浏览器和服务器之间
的一个简短的小对话。浏览器和服务器经常在PHP之外使用首部通信，
不过PHP确实允许发送首部，这正是HTTP认证的工作原理。我们将更
深入地讨论首部，还会讨论使用PHP实现HTTP认证时首部所承担的角
色。
RAN
Admin页面的认证具体应该
什么时候发生？
你现在的位置
301
---
## Page 338
认证和首部
HTTP认证需要首部
HTTP认证的基本思想是，服务器会“扣留”一个受保护的Web页面，
所有Web页面
然后要求浏览器向用户询问一个用户名和口令。如果用户正确地输人
都需要借助于
了用户名和口令，浏览器会继续发送页面。浏览器和服务器之间的这
首部来传送。
个对话是通过首部完成的，首部是一个短小的文本消息，包含所请求
或传送的特定指令。
实际上每次你访问一个Web页面时都用到了首部，而不只是需要认证
Web服务器
时才使用首部。以下是一个未加保护的正常Web页面，它在首部的帮
助下从服务器传送到浏览器：
这个首部集合构成了
一个We6页面请求。
浏览器请求服务器上的一个
2
页面，为此发送两个首部来
服务器以一个首部集合作
标识所请求的文件和服务器
为响应，其后是所请求的
的主机名。
页面。
index.php
这组首部集合构成了
一个We6页面响应。
Guitar
客户Web浏
览器
Guitar
浏览器接收首部和页面，并显
示页面的HTML代码。
所有这些都完成时，在首
部的帮助下成功地将所请
求的页面传送到测览器。
302
第6章
---
## Page 339
保证应用安全
首部剖析
首部准确地控制着如何在Web浏览器和Web服务器之间来回传递信息，以及传递何种信息。
每个首部通常包含标识着一段信息的一个名/值对，如一个Web页面（HTML）的内容类
型。首先一组首部会作为Web页面请求的一部分发送到服务器，然后返回另一组首部作为
响应的一部分发回给浏览器。下面将更仔细地查看各组首部，从而明确客户与服务器相互
通信时究竞发送了哪些信息。
第一个首部不是一
大多数首部都由一个名/值对
个名/值对，这是页
组成，名与值之间用罗号分隔。
面的GET请求。
GET/index.phpHTTP/1
Host:www.guitarwars.net
Connection: close
这个首部指定了发出
User-Agent:Mozilla/5.0.
请求的测览器。
Accept-Charset:IS0-8859=
Cache-Control:no
Accept-Language:de,en;q=0.7
第一个首部是服务器的
HTTP响应。
V
HTTP/1.1 200OK
Date:Tnu,01May 2008 11:22:09GMT
Server: Apache/2.0.54.
X-Powered-By: PHP/5.2.5
Transfer-Encodina: chunked
Content-Type:text/html
这个首部告诉测览器：页面
内容是HTML代码，而不是
首部发送之后就会发送
index.php
纯文本。
页面的HTML内容。
对于GuitarWars应用，首部非常重要，因为它们提供了一种机制，可以中断服务器的页面
传送，并在真正传送页面之前请求用户输人一个用户名和口令。换句话说，必须调整服务
器返回的首部，利用HTTP认证来保护页面。
你现在的位置
303
---
## Page 340
与首部的访谈
出场嘉宾：首部
本周访谈主题：
这么麻烦到底要做什么？
HeadFirst:谈到认证Web页面时看起来你很受关注。HeadFirst:有意思。不过我听说服务器也可以发送首
有必要吗？或者只是你在故意造势，想要红极一时，部。我还以为服务器只是发回Web页面。
享有15分钟短暂的辉煌？
首部：哈，问得好。在通信的另一端我也同样重要，
首部：喔，绝对必要。你必须承认我在传送每一个Web因为服务器不只是要向浏览器输送一大堆内容。倘若
页面时所起的作用。所以我想你可能会说，如果没有浏览器对得到的内容不多做一些了解，对于如何处理
我，Web甚至无法运转。我的存在远不止15分钟，尽这些内容将毫无头绪。
管在很大程度上我一直没有得到足够的重视。
HeadFirst:比如说哪些？
HeadFirst:那么你的作用到底是什么？
首部：比如说，内容的类型。这可能是最重要的一
首部：你要知道Web浏览器和Web服务器并不是人类，点，不过服务器还会发送其他一些信息，如内容的大
所以他们不能直接通过电话或发文本消息来相互联小、传送的日期和时间等。
系。
HeadFirst:那么Web页面本身什么时候发送？
HeadFirst:哦，天哪！
首部：就在服务器把我发送到浏览器之后，接下来就
首部：没错，我知道，这确实有点让人震惊，不过机会发送具体的内容，可能是HTML、PDF数据或者是
器可不会用人类的方式通信。但是浏览器和服务器仍GIF或JPEG等图像数据。
然必须通信，而且他们之间的通信就要用到我。
HeadFirst:OK，我已经有点了解你对于正常Web页面
HeadFirst:那么这到底是怎么回事？
的作用了。不过与这里的认证有什么关系呢？
有关请求的一些信息。具体来讲，首部会包含所请求提示用户输入认证信息。
页面的名和主机、发出请求的浏览器的类型等信息。
HeadFirst:你是说一个用户名和口令？
HeadFirst:我还是看不出这里的重要性。
首部：完全正确。然后要由服务器上的PHP代码来确
首部：嗯，也许你要告诉咖啡馆的服务生你想要一大定用户名和口令是否匹配，如果确实匹配，服务器可
杯加脱脂奶的香草espressiato，你认为这重要吗？
以继续发送余下的页面。
HeadFirst:那当然，他们需要知道我想要什么。
HeadFirst:太棒了，谢谢指点。
首部：这里也是同样的道理。浏览器将请求打包为首首部：没问题。这是我应该做的。
部并发送给服务器，以此告诉服务器它想要什么。
304第6章
---
## Page 341
保证应用安全
利用PHP控制首部
利用PHP，可以精心控制由服务器发送给浏览器的首部，从而有可能
header()函数
完成一些首部驱动的任务，如HTTP认证。在PHP脚本中要利用内置
允许从PHP脚
header（）函数将首部从服务器发送到浏览器。
本创建和发送
header('Content-Type:text/html');
首部。
header（）函数会立即从服务器向浏览器发送一个首部，而且这个函
数必须在向浏览器发送任何具体内容之前调用。这是一个非常严格的
要求，如果在首部之前即使只是发送了一个字符或空格，浏览器也会
拒绝并报错。出于这个原因，header（）函数调用应当放在PHP脚本
中的所有HTML代码之前：
即使
header('Content-Type:text/html');
标记内部的
空格不全导致出现问题
？>
因为它们不金传递到测
览器。
首部的这些内容挺有意思，不过到
底如何使用它利用认证保护页面呢？
PDG
你现在的位置
305
---
## Page 342
首部认证如何工作
利用首部认证
Web服务器
使用首部认证GuitarWarsAdmin页面需要创建一组特定的首部，实际
上是两个首部，让浏览器知道在传送页面之前要提示用户输人一个用
户名和口令。这两个首部由Admin脚本中的PHP代码生成，并控制如
何向浏览器传送页面。
HTTP认证首部从服务器
发送到别览器。
HTTP/1.1 401 Unauthorized
将admin.php页面的内容传送到
WWW-Authenticate:
Basic realn-*Guitar Wars*
浏览器之前，服务器处理这个
页面的所有首部。
然后浏览器提示用
户输入一个用户名
和口今。
ov
Name
rock