title:Internet anycast: performance, problems, &amp; potential
author:Zhihao Li and
Dave Levin and
Neil Spring and
Bobby Bhattacharjee
Internet Anycast: Performance, Problems, & Potential
Zhihao Li
University of Maryland
Neil Spring
University of Maryland
Dave Levin
University of Maryland
Bobby Bhattacharjee
University of Maryland
ABSTRACT
Internet anycast depends on inter-domain routing to direct
clients to their “closest” sites. Using data collected from a
root DNS server for over a year (400M+ queries/day from
100+ sites), we characterize the load balancing and latency
performance of global anycast. Our analysis shows that site
loads are often unbalanced, and that most queries travel
longer than necessary, many by over 5000 km.
Investigating the root causes of these inefficiencies, we can
attribute path inflation to two causes. Like unicast, anycast
routes are subject to inter-domain routing topology and poli-
cies that can increase path length compared to theoretical
shortest (e.g., great-circle distance). Unlike unicast, anycast
routes are also affected by poor route selection when paths
to multiple sites are available, subjecting anycast routes to
an additional, unnecessary, penalty.
Unfortunately, BGP provides no information about the
number or goodness of reachable anycast sites. We propose
an additional hint in BGP advertisements for anycast routes
that can enable ISPs to make better choices when multiple
“equally good” routes are available. Our results show that use
of such routing hints can eliminate much of the anycast path
inflation, enabling anycast to approach the performance of
unicast routing.
ACM Reference Format:
Zhihao Li, Dave Levin, Neil Spring, and Bobby Bhattacharjee. 2018.
Internet Anycast: Performance, Problems, & Potential. In SIGCOMM
’18: SIGCOMM 2018, August 20–25, 2018, Budapest, Hungary. ACM,
New York, NY, USA, 15 pages. https://doi.org/10.1145/3230543.3230547
Permission to make digital or hard copies of all or part of this work for
personal or classroom use is granted without fee provided that copies are not
made or distributed for profit or commercial advantage and that copies bear
this notice and the full citation on the first page. Copyrights for components
of this work owned by others than ACM must be honored. Abstracting with
credit is permitted. To copy otherwise, or republish, to post on servers or to
redistribute to lists, requires prior specific permission and/or a fee. Request
permissions from permissions@acm.org.
SIGCOMM ’18, August 20–25, 2018, Budapest, Hungary
© 2018 Association for Computing Machinery.
ACM ISBN 978-1-4503-5567-4/18/08...$15.00
https://doi.org/10.1145/3230543.3230547
59
1 INTRODUCTION
Anycast is one of the fundamental modes of communication,
in which a set of anycast replicas all serve the same content
under a shared identifier. In IP anycast in particular, server
replicas at multiple geographic sites advertise the same IP
address via BGP; clients are “routed” to a replica based on
the underlying BGP routes; and from a client’s perspective,
all of the anycast replicas offer an equivalent service [23, 31,
39]. This basic one-to-any form of communication is used
in critical network infrastructure: all root DNS servers and
many popular open resolvers are hosted via IP anycast [11,
12, 26, 44], and some content delivery networks (CDNs) use
it in an attempt to lower latencies and distribute load [7].
What makes IP anycast attractive when deploying a glob-
ally replicated service is the mental model that it seems to
permit. In particular, as one adds more anycast replicas in
locations with many clients, it is generally believed [3, 7, 47]
that: (1) overall client latency will decrease and (2) load from
nearby clients will be more evenly distributed. Of course,
inter-domain routing is not guaranteed to be optimal in terms
of bandwidth, latency, or geographic proximity: at best, BGP
can be relied upon for connectivity and policy-compliance.
Nonetheless, as evidenced by the increasing deployment of
anycast in root DNS servers and open resolvers, network
operators expect these broad trends, at least, to apply.
Unfortunately, several prior studies have found that IP
anycast’s performance does not match even these most basic
expectations. Clients are often routed to replicas that are
hundreds of kilometers away from their closest replicas [24,
28], resulting in increased latency. It has been known for
over a decade that IP anycast can be inefficient, and yet there
are surprisingly few explanations of why or how to fix it.
To the best of our knowledge, the only concrete proposed
solution comes from Ballani et al. [3, 4], who hypothesized
that deploying anycast replicas such that they all share the
same upstream provider is one approach to fix inefficiencies
in anycast. Were this the only solution, it would mean that ef-
ficiently running a geo-replicated service over anycast would
require cooperation from a large ISP; adding even a small ISP
could negatively impact performance. Is this a fundamental
limitation of anycast, or is there another solution?
SIGCOMM ’18, August 20–25, 2018, Budapest, Hungary
Zhihao Li, Dave Levin, Neil Spring, and Bobby Bhattacharjee
In this paper, we present an in-depth analysis of three
distinct IP anycast deployments: those of the C-, D-, and K-
root DNS servers.1 We investigate the current inefficiencies
of IP anycast, why it fails (and succeeds), and how to fix it
without relying upon a single large upstream provider. This
paper makes three broad, interrelated contributions:
Performance (§3): Using passive and active measurements
of distinct, root DNS anycast deployments, we quantify the
inefficiencies of IP anycast in terms of both latency and
load balance. While it is not surprising that IP anycast is
suboptimal (BGP routing lacks mechanisms to select routes
with better performance), we find the inefficiencies to be
surprisingly excessive. In particular, we show that adding
more anycast replicas (1) often increases overall latency, and
(2) often exacerbates load balancing, matching clients to
anycast replicas in different continents than their own.
Problems (§4): To explore the root causes of these perfor-
mance problems, we introduce a novel measurement tech-
nique that allows us to compare the AS-level paths from
clients to multiple IP anycast sites. The resulting data indi-
cate that the majority of performance inefficiency is due to
BGP’s poor route selection: routers are presented with routes
to two or more anycast replicas each of whom have equal
preference. Lacking any useful information to distinguish
between them, routers often select a distant, high-latency
anycast site over the closer, low-latency one. Again, it is not
surprising that inter-domain routing would not choose the
best alternative, but it is surprising that the best alternative
is often an unselected option.
Potential (§5): Finally, applying our findings from our root-
cause analysis, we propose a fix. We propose to include
geographic hints in BGP advertisements that routers can
use to more intelligently select routes among alternatives
with equal preference. We find that this reduces the anycast
path inflation (the additional latency imposed specifically
by anycast) to zero for over 65% of clients. This technique is
incrementally deployable and, although we evaluate it only
on root DNS data and an experimental deployment, it can
be applied to any IP anycast system.
Our results collectively provide an accurate, in-depth un-
derstanding of why IP anycast currently does not work, and
how it can. To assist practitioners and researchers in better
understanding and mitigating IP anycast’s inefficiencies, our
nonsensitive datasets are publicly available.2
1We have also analyzed other root DNS servers, and have found them to be
largely similar to the three we focus on; we omit them due to space.
2http://www.cs.umd.edu/projects/droot/
60
2 RELATED WORK
IP anycast [23, 31, 39] is widely used to allows services to
be transparently replicated across the Internet. Two of the
most studied applications of IP anycast to date are root DNS
servers [4, 13, 26, 27, 33, 45, 47] and content delivery net-
works (CDNs) [2, 6, 7, 14–16].
We organize our discussion of related work along the
efforts of measuring, explaining, and fixing IP anycast per-
formance. Although generally related to DNS performance,
we focus here on work that studied root servers’ use of IP
anycast, and not more general studies of DNS server perfor-
mance or availability [5, 38].
Performance measurements of IP anycast Several stud-
ies have compared the RTTs between clients and their any-
cast replicas to the smallest RTT among all of the possible
anycast replicas [4, 13, 27, 45, 47].
Early studies of the performance of IP anycast among DNS
root servers indicated a promising trend towards lowered
latency. In 2006, Sarat et al. [45] performed an initial mea-
surement of the additional latency induced by anycast on
F- and K-root, and found that while few go to their lowest-
latency replica, the latency overheads are typically small
(75th percentiles of less than 5 msec for K-root and less than
20 msec for F-root). Colitti et al. [13] studied K-root in the
same year and concluded with similar results. In 2010, Lee
et al. [25] evaluated the loss rate and latency to root DNS
servers that had deployed IP anycast. Their results from 2010
indicated a gradual decrease in the overall latencies from
2007 through most of 2008, followed by a gradual increase
into the beginning of 2009. Given how early into the trend
their study was, they were unable to account for the statisti-
cal significance or cause of this trend. Our study shows this
trend to be real—IP anycast performance often decreases as
more replicas are added—and identifies a root cause (BGP
route selection) and a fix.
In 2013, Liang et al. [27] applied King technique [19] to
measure latencies between about 20K open recursive re-
solvers and root DNS servers. Their results, however, showed
that about 40% of the resolvers experienced latency over-
heads over 50 msec. Most recently, in 2016, Schmidt et al. [47]
used RIPE atlas probes to measure RTTs to all DNS root
servers that support anycast. They conclude that having “a
few sites” is enough to achieve nearly as good performance
as having many sites. Qualitatively, our results support this
in the sense that adding many more sites does not improve
performance, but we show that this is a bug, not a feature, in
that many anycast deployments are unable to take advantage
of performance that could be realized. In fact, we show that,
for many anycast deployments, adding more replicas harms
performance by increasing latency—a phenomenon origi-
nally predicted by Ballani et al. [4]. Like Schmidt et al. [47],
Internet Anycast: Performance, Problems, & Potential
SIGCOMM ’18, August 20–25, 2018, Budapest, Hungary
we make use of RIPE atlas probes, and thus, also like them,
are subject to the probes’ Europe-centric bias. In §3.2, we
demonstrate that this bias does not negatively impact our
results.
Other studies have used the relative geographic distance
as a metric for comparing how well anycast chooses among
replicas. In 2006, Liu et al. [28] used two days’ passive DNS
data from C-, F-, K-root, and reported median additional dis-
tances (over the distances to their closest replicas) of 6000 km,
2000 km, and 2000 km, respectively. For C-root, they found
that over 60% of clients traveled an extra 5000 km longer
than strictly necessary; for F- and K-roots, 40% of clients
traveled an extra 5000 km. Kuipers [24] performed a coarser-
grained analysis of 10 minutes of K-root’s anycast perfor-
mance, showing that most clients are not getting routed to
their geographically closest anycast replica. Our findings
largely reinforce these prior results by showing that anycast
can indeed be surprisingly far from optimal, but we expand
them by identifying the root cause of these inefficiencies and
by offering a fix.
Explaining and fixing IP anycast performance Many
of the above measurement studies speculate that BGP routing
has an impact on whether clients obtain their optimal replica,
but have offered no concrete explanation or fix.
Sarat et al. [45] suggested that each anycast site has an
announcement radius, and hypothesized that clients would
select the route to topologically nearby site. However, change
of advertisement radius does not ensure BGP to select the
route towards the closer replica among the available routes.
Ballani et al. [3, 4] hypothesized that IP anycast’s latency
inflation (what they refer to as the “stretch-factor”) can be
remedied by ensuring that all anycast replicas share a single
upstream provider. Our study confirms this hypothesis; in
particular, we find that C-root has such a deployment and
does not suffer from the route selection problems that other
root servers have. Most root servers are not deployed in this
fashion; implementing this fix would require renegotiating
their providers, a significant undertaking. Moreover, central-
izing an anycast service’s routing behind a large upstream
provider introduces a single point of failure. Were this the
only solution, it would mean that only very large ISPs could
efficiently offer IP anycast; adding even a single small ISP
could negatively impact performance. In §5, we introduce
a more democratic fix: by adding static geographic hints
to BGP, we can achieve nearly all of the same benefit as
using a single upstream provider. In comparison to these
prior proposals, our “geo-hints” are easily and immediately
deployable, and they remain efficient even when there are
many distinct upstream providers.
3 PERFORMANCE
We begin by studying the performance of Internet-wide any-
cast, using measurements of DNS root servers. The DNS root
is served by 13 Internet addresses: A- through M-root. These
addresses are administered by various different entities, and
all root addresses are now served using anycast.
We use the following terminology: each address is anycast
from different physical locations across the Internet, called
sites. The same root address may be (and often is) anycast
from different ASes. Each site may have multiple machines,
called replicas. For a specific root, a given site is either local
or global: replicas at local sites are available only within
the AS in which they are located. Global replicas are adver-
tised using inter-domain BGP, and can be accessed across
the Internet. As of early 2018, some roots are anycast from
hundreds of (global) sites, whereas others have fewer than
ten [44]. In this paper, we consider each root to be a separate
anycast service, and examine their behavior independently.
Fundamentally, we want to use our measurements to an-