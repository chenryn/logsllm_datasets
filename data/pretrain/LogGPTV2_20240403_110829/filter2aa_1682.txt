Ashley X Belinda 
Let’s Play Hide and Seek  
In the Cloud 
The APT Malwares Favored in Cloud Service 
HITCON 2015                                                             Let’s Play Hide and Seek in the Cloud 
• Speakers 
• APT vs Cloud Service 
• Hide and Seek in SaaS 
–
Redirect 
–
Storage 
–
Control Channel 
• What APT malware love about cloud service? 
• What can we do? 
Outline 
HITCON 2015                                                             Let’s Play Hide and Seek in the Cloud 
Ashley 
Belinda 
Speakers 
HITCON 2015                                                             Let’s Play Hide and Seek in the Cloud 
Ashley 
• Ashley Shen 
• Threat Analyst in Team T5 
• APT research, Malware analysis 
• Malicious Document Detection 
• Member of HITCON GIRLS 
• PI:EMAIL 
HITCON 2015                                                             Let’s Play Hide and Seek in the Cloud 
Belinda 
• Belinda Lai 
• Security Engineer in III 
• Malware Analysis 
• Assist organizations handle 
information security incidents 
• Member of HITCON GIRLS 
• PI:EMAIL 
APT vs Cloud Service 
HITCON 2015                                                             Let’s Play Hide and Seek in the Cloud 
Google Trend of Cloud Service 
HITCON 2015                                                             Let’s Play Hide and Seek in the Cloud 
Software as a Service 
Platform as a Service 
Infrastructure as a Service 
Cloud Service Models 
HITCON 2015                                                             Let’s Play Hide and Seek in the Cloud 
HITCON 2015                                                             Let’s Play Hide and Seek in the Cloud 
Google Trend of APT Attack 
Once upon the time… 
Stuxnet 
Operation Aurora 
Recently… 
Sony Pictures 
Garena Hacked 
HITCON 2015                                                             Let’s Play Hide and Seek in the Cloud 
How do cloud service take 
part in APT attack? 
What can malware do  
with cloud service? 
HITCON 2015                                                             Let’s Play Hide and Seek in the Cloud 
Web server as  
C&C server 
Code 
VPS as  
C&C server 
VM 
APT Leverage Cloud Service Models 
Cloud Service as  
Invisibility cloak 
IaaS 
PaaS 
SaaS 
HITCON 2015                                                             Let’s Play Hide and Seek in the Cloud 
Cloud Service as  
Invisibility cloak 
Data 
APT Leverage Cloud Service Models 
VPS as  
C&C server 
Web server as  
C&C server 
IaaS 
PaaS 
SaaS 
Code 
VM 
Hide and Seek in SaaS 
Redirect 
Storage 
Control Channel 
Redirect 
Victim  
Cloud Service  
Second Stage C&C 
Encode  
C&C address  
String 
Command  
1 
2 
3 
4 
Decode String to 
get IP address  
The Malwares 
HITCON 2015                                                             Let’s Play Hide and Seek in the Cloud 
Elirks 
•
Name: Elirks 
•
Targeted Country: Taiwan、 
Japan、HK 
•
Targeted Sector: GOV、
ThinkTank 
•
First Seen: 2010 
•
Infrastructure: Yahoo, Plurk, 
Google (blogger), Dropbox, 
Twitter 
•
Campaign: Elirks group 
• We found that the earliest Elirks post was posted in 2010. 
• In 2012~2014, Plurk had been used in several incidents. 
• Encode C2 information with modified TEA and Base64. 
Pattern : 
<http://google.com.t
w/37619834? 
+ C2 information 
•
 In 2014, Elriks start to Hide c2 information in Html tag 
• In 2015, Our latest observation shows that Elirks using Japa
n Blog to targeting JP victim. Encrypt with DES. 
HITCON 2015                                                             Let’s Play Hide and Seek in the Cloud 
WMIgh0st 
•
Name: WMIghost 
•
Targeted Country: Tibet 
•
Targeted Sector: Various 
•
First Seen: 2009 
•
Infrastructure:blog.com, 
Yahoo, Wordpress, 
SOSblogs, livejournal 
• Used Windows Management Instrumentation (WMI, 
implement Web-Based Enterprise Management) as a 
venue to   conveniently perform malicious activities 
• Download html file and decode blog title 
HITCON 2015                                                             Let’s Play Hide and Seek in the Cloud 
Midhos 
30 
•
Name: Midhos 
•
Targeted: Taiwan, Tibet 
•
Targeted Sector: GOV, 
corporation 
•
First Seen: 2012 
•
Infrastructure: Yahoo, Baidu, 
Pixnet, Xuite 
•
Behavior: First Stage C&C 
•
2013, Midhos Leverage baidu blog as first stage 
C2 
HITCON 2015                                                             Let’s Play Hide and Seek in the Cloud 
IXESHE 
•
Name: IXESHE 
•
Targeted Country: Taiwan、 
Japan 
•
Targeted Sector: GOV、
Enterprise、NGO 
•
First Seen: 2009                         
(2013 start to connect blog) 
•
Infrastructure: Yahoo blog , 
Dropbox, WordPress 
•
Campaign: IXESHE 
**********Encoded String********** 
RSA and RC4 encryption 
HITCON 2015                                                             Let’s Play Hide and Seek in the Cloud 
Taleret 
•
Name: Taleret 
•
Targeted Country: Taiwan、
UN 
•
Targeted Sector: GOV、
Enterprise、ORG 
•
First Seen: 2010  
     (2011 start to connect blog) 
•
Infrastructure: Yahoo, Yam, 
Pixnet 
•
Campaign:  
Possibly Taidoor 
ARTEMIS (base64 string, encoded by 
RC4, contains C2 IP Port 0x4C) 
ARTEMIS 
HITCON 2015                                                             Let’s Play Hide and Seek in the Cloud 
PlugX 
•
Name: Plug X 
•
Targeted Country: Taiwan ; 
Japan ; Korean  
•
Targeted Sector:  
•
First Seen: 2012 
•
Infrastructure: Baidu, 
Dropbox, Twitter, MSDN, 
Linkedin 
pattern: 
 DZKSJDADBDCDHDOCADOCADOCBDDZJS 
More Tricks - 1 
• Using DNS lookup cloud service to obtain 
second stage C&C address.  
• Bypass DNS blocking. 
Victim  
Cloud DNS Lookup Service  
The IP address 
of Domain is x
xx.xxx.xxx.xxx 
1 
2 
Request 
Second Stage C&C 
Command  
3 
4 
Protux 
•
Name: Protux  
•
Targeted: TW 
•
Targeted Sector: GOV  
•
First Seen: 2009 
•
Infrastructure: DNS Watch, 
ip138,  
•
Campaign: DragonOK 
•
The trojan request for the search result of 
DNS Watch to retrieve C&C address. 
•
DNS Watch is a public DNS lookup tool. 
•
Locate the IP address by identify string.  
•
Try to Query DNS Watch first. If fail then try 
DNS Server.  
Hinet DNS Server 
Seednet DNS Server 
•
DNS Watch tried to block by detecting user 
agent. (However…) 
GET 
/dns/dnslookup?la=en&host=picture.ucparlnet.c
om&type=A&submit=Resolve HTTP/1.1 
User-Agent: Mozilla/5.0 (compatible; MSIE 6.0.1; 
WININET 5.0) 
Host: www.dnswatch.info 
Cache-Control: no-cache 
GET 
/dns/dnslookup?la=en&host=picture.ucparlnet.c
om&type=A&submit=Resolve HTTP/1.1 
User-Agent: Mozilla/5.0 (compatible; MSIE 6.0.1) 
Host: www.dnswatch.info 
Cache-Control: no-cache 
Storage 
Victim  
1 
2 
Command  
Cloud Storage  
Data 
Actor 
3 
4 
5 
The Malwares 
DropNetClient 
• Name: DropNetClient 
• Targeted Country: Taiwan 
• Targeted Sector: GOV 
• First Seen: 2015 
• Infrastructure: Dropbox 
• Behavior:  
Fetch command from 
Dropbox and upload 
victim data to Dropbox. 
• Campaign: Taidoor  
•
Low Detection Rate 
•
Connect to Dropbox with DropNet Lib 
•
Use two RC4 Keys. 
•
Key 1: A pubKey use to decrypt the file 
“10101” download from dropbox”.  
•
Use two RC4 Keys. 
•
Key 2: The decrypted key, use to encrypt 
the victim files and upload to dropbox. 
•
We can find accessTokwn, appKey and 
appSecret in the malware 
•
With Dropbox python SDK, we were able to 
access to the folders and the files, and get 
the account information. 
• The actor register a Gmail account for the 
specific victim  
HITCON 2015                                                             Let’s Play Hide and Seek in the Cloud 
GDrive RAT 
• Name: GDrive RAT  
(aka TSPY_DRIGO.A) 
• Targeted Country: Taiwan 
• Targeted Sector: GOV 
• First Seen: 2012 
• Infrastructure: 
• Behavior:  
Second stage backdoor. Upload 
victim data to specific google 
drive 
• Campaign:  
Possibly PLEAD  
•
Develop with Go programming language. 
•
Low detection rate. 
•
Search for  
•
XLSX 
•
XLS 
•
DOC 
•
DOCX 
•
PDF 
•
TXT 
•
PPT 
•
PPTX 
•
Using OAuth 2.0 protocol to log in to 
specific Google Drive. 
•
We can find the access token, client ID, 
Refresh Token and email address in the 
process memory.  
HITCON 2015                                                             Let’s Play Hide and Seek in the Cloud 
illitat 
•
Name: illitat (fc.asp 
Downloader) 
•
Targeted Country: TW 
•
Targeted Sector: GOV 
•
First Seen: 2010  
     (2013 start to use blog) 
•
Infrastructure: Yahoo, Yam, 
Pixnet 
•
Behavior: Connect to blog to 
download trojan DLL 
(Taidoor) 
•
Campaign: Taidoor 
• download jpg or yahoo blog article, find pattern 
yxyyyxyy 
• extract 2nd Gen Taidoor DLL 
• illitat encode C2 pattern:  
(random char) yxyyyxyy (base64+RC4) decoded   to 
be Taidoor-RAT DLL version yxyyyxyy (random char) 
yxyyyxyyAwAAADMzMwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA 
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGFFDWmXB+pydDwdvQc9MPR 
8Uoday9yM5lHo+sdPAmzPE0t7LTjjXM9vIOYRCKBytSNICOpSImHuswDN9gz3JMiB 
Dk0I+ylZG4szjaxDa8ALnyFMzEl0n3GcYujgwwoiZRXdzFyRtG782fvUtVfwNdDWeofS 
TZEKV9kG3VbZ9XDdwbe7YkiBTt7UYK3VgFf9hpXKFp6VkgBvRj2heFoIwDiKXRusYRf 
5Km1KYKaDM7TZMVV5Jtcdyg97Cha7RVosja5lU83f4k0cC7jJkROBICPwIyZbhi8rV5j 
j2DftJQ01NjnOg2rnUIDfbfkeywxHZQJx4a1AAwMPQyk+pekIwF1bzVF9xhD3dDkjvh 
db8Hh2QE3IF3jGkcSdUecpTGZr2E2x+fnuNfHrtNbxoRRcebmyIYz9oD0BMrDgiD3T9 
x5QnqwrHMjg8TUymCCeWxiUshE81QyS7LUo8ibCmu3+yT9K6eYPiW0AzzH5TohSd 
D0uIapLsZCRXRk+vodo9i8FBmVnq1+U3W1snM1JkhUJG3SUqdXGulkzB42nL82Ad 
…… yxyyyxyy  
Base 64 
Key Length 
Key 
Key xor 02  Key for RC4  RC4 Decrypt trojan DLL 
Control Channel 
Victim  
Cloud Service  
Actor 
Command  
Data 
The Malwares 
HITCON 2015                                                             Let’s Play Hide and Seek in the Cloud 
Stalk 
• Name: Stalk / glooxmail  
• Targeted Country:  
• Targeted Sector:  
• First Seen: 2011 
• Infrastructure: G Talk 
• Campaign: APT1 
Victim  
1 
2 
TLS encryption 
Encoded  Command  
TROJAN.GTALK functionality  
Function 
Description 
Create/kill/list processes 
Send a process listing, kill a 
process by name or PID. 
File upload/download 
Gather system information 
Information includes hostname, IP 
address, OS version, and the static 
string “0.0.1” which may be a 
malware version string. 
Interactive shell session 
Start a cmd.exe child process. 
Arbitrary commands can be sent 
from a remote host to the 
malware to execute 
Set sleep interval 
HITCON 2015                                                             Let’s Play Hide and Seek in the Cloud 
Kimsuky 
• Name: Kimsuky 
• Targeted Country: KR 
• Targeted Sector: GOV; 
Military Industry; ThinkTank 
• First Seen:2013 
• Infrastructure:  
  Public email 
service,TeamViewer  
• Behavior: communicated 
with its “master” via a 
public e-mail server and 
TeamViewer 
1 
Victim  
2 
3 
4 
RC4 Encrypted Data  
RSA Encrypted RC4 Key  
RC4 Encrypted  
Modules 
modules 
Description 
Keystroke logging 
Directory listing collection 
Gather information and 
Spy victim 
HWP document theft 
Hancom Office 
Remote control download 
and execution 
Download extra program 
from in-coming mail 
Remote control access 
Use modified TeamViewer 
client  
Interesting 
• The public e-mail server :Bulgarian – mail.bg 
• Compilation path string : Korean hieroglyphs 
•D:\rsh\공격\UAC_dll(완성)\Release\test.pdb 
•D:\rsh\ATTACK\UAC_dll(COMPLETION)\Release\te
st.pdb 
• Modified TeamViewer  
Attacker Thread - IP 
Attacker Thread – Mail Account 
• Mail accounts : 
• PI:EMAIL  
• PI:EMAIL 
• DropBox Account : 
• Names: kimsukyang and “Kim asdfa” 
Who are the Target or Targets ....? 
What APT malware love 
about cloud service? 
HITCON 2015                                                             Let’s Play Hide and Seek in the Cloud 
• Easy to change; like DDNS 
• Bypass passive DNS 
• Bypass IDS 
• Bypass AV 
• Difficult to trace 
• Cost down 
• Easy to build/maintenance   
What can we do? 
HITCON 2015                                                             Let’s Play Hide and Seek in the Cloud 
• Black List 
What can we do? 
HITCON 2015                                                             Let’s Play Hide and Seek in the Cloud 
• CTI (Cyber Threat Intelligence) 
What can we do? 
• “Cyber threat intelligence is knowledge about 
adversaries and  
their motivations, intentions, and methods that is  
collected, analyzed, and disseminated in ways that  
help security and business staff at all levels  
protect the critical assets of the enterprise.”  
Jon Friedman et al, 2015, Definitive Guide to Cyber Threat Intelligence 
HITCON 2015                                                             Let’s Play Hide and Seek in the Cloud 
• Security Guard 
• 24x7 monitor、
report 
• indicator match 
• Emergency 
Response Team 
• Emergency 
Response、
Handling Crisis 
• malware weapon 
• Doctor 
• Prescription 
• high-level strategy 
• Private Detective 
• Investigation、
Long-term tracking 
• Campaign Tactics 
Techniques and 
procedure    
review 
prevent 
detect 
respond 
Q & A 
http://girls.hitcon.org/