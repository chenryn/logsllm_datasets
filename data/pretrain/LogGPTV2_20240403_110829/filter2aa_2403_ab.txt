目
目    录
录  
第一部分  指令讲解 
第 1 章 CPU 简介 ............................................. 3 
1.1 指令集架构 ............................................... 3 
第 2 章 最简函数 ............................................... 5 
2.1 x86 ............................................................. 5 
2.2 ARM .......................................................... 5 
2.3 MIPS .......................................................... 5 
MIPS 指令集与寄存器名称 ...................... 6 
第 3 章 Hello，world！ ................................. 7 
3.1 x86 ............................................................. 7 
3.1.1 MSVC ............................................. 7 
3.1.2 GCC ................................................ 9 
3.1.3 GCC:AT&T 语体 ............................ 9 
3.2 x86-64 ...................................................... 11 
3.2.1 MSVC-x86-64 .............................. 11 
3.2.2 GCC－x86-64 ............................... 12 
3.3 GCC 的其他特性 .................................... 12 
3.4 ARM ........................................................ 13 
3.4.1 Keil 6/2013—未启用优化功
能的 ARM 模式 ........................... 14 
3.4.2 Thumb 模式下、未开启优化选项
的 Keil .......................................... 15 
3.4.3 ARM 模式下、开启优化选项的
Xcode ............................................ 15 
3.4.4 Thumb-2 模式下、开启优化选项
的 Xcode（LLVM） .................... 16 
3.4.5 ARM64 ......................................... 18 
3.5 MIPS ........................................................ 19 
3.5.1 全局指针 Global pointer .............. 19 
3.5.2 Optimizing GCC ........................... 19 
3.5.3 Non-optimizing GCC .................... 21 
3.5.4 栈帧 .............................................. 23 
3.5.5 Optimizing GCC: GDB 的分
析方法 .......................................... 23 
3.6 总结 ......................................................... 24 
3.7 练习题 ..................................................... 24 
3.7.1 题目 1 ........................................... 24 
3.7.2 题目 2 ........................................... 24 
第 4 章 函数序言和函数尾声 ...................... 25 
递归调用 .......................................................... 25 
第 5 章 栈 ........................................................... 26 
5.1 为什么栈会逆增长 .................................. 26 
5.2 栈的用途.................................................. 27 
5.2.1 保存函数结束时的返回地址 ....... 27 
5.2.2 参数传递 ....................................... 28 
5.2.3 存储局部变量 ............................... 29 
5.2.4 x86:alloca()函数............................ 29 
5.2.5 （Windows）SEH 结构化 
异常处理 ....................................... 31 
5.2.6 缓冲区溢出保护 ........................... 31 
5.3 典型的栈的内存存储格式 ...................... 31 
5.4 栈的噪音.................................................. 31 
5.5 练习题 ..................................................... 34 
5.5.1 题目 1 ............................................ 34 
5.5.2 题目 2 ............................................ 34 
第 6 章 printf()函数与参数调用 ................ 36 
6.1 x86 ........................................................... 36 
6.1.1 x86：传递 3 个参数 ..................... 36 
6.1.2 x64：传递 9 个参数 ..................... 41 
6.2 ARM ........................................................ 44 
6.2.1 ARM 模式下传递 3 个参数 ......... 44 
6.2.2 ARM 模式下传递 8 个参数 ......... 46 
6.3 MIPS ........................................................ 50 
6.3.1 传递 3 个参数 ............................... 50 
6.3.2 传递 9 个参数 ............................... 52 
6.4 总结 ......................................................... 56 
6.5 其他 ......................................................... 57 
第 7 章 scanf() .................................................. 58 
7.1 演示案例.................................................. 58 
7.1.1 指针简介 ....................................... 58 
7.1.2 x86................................................. 58 
7.1.3 MSVC＋OllyDbg.......................... 60 
7.1.4 x64................................................. 62 
7.1.5 ARM ............................................. 63 
7.1.6 MIPS ............................................. 64 
7.2 全局变量.................................................. 65 
异步社区会员 dearfuture(15918834820) 专享 尊重版权
2 
逆向工程权威指南（上册） 
7.2.1 MSVC：x86 ................................. 66 
7.2.2 MSVC：x86+OllyDbg ................. 67 
7.2.3 GCC：x86 .................................... 68 
7.2.4 MSVC：x64 ................................. 68 
7.2.5 ARM: Optimizing Keil 6/2013  
(Thumb 模式) ............................... 69 
7.2.6 ARM64 ......................................... 70 
7.2.7 MIPS ............................................. 70 
7.3 scanf()函数的状态监测 .......................... 74 
7.3.1 MSVC：x86 ................................. 74 
7.3.2 MSVC：x86：IDA ...................... 75 
7.3.3 MSVC：x86+OllyDbg ................. 77 
7.3.4 MSVC：x86+Hiew ...................... 78 
7.3.5 MSVC:x64 .................................... 79 
7.3.6 ARM ............................................. 80 
7.3.7 MIPS ............................................. 81 
7.3.8 练习题 .......................................... 82 
7.4 练习题 ..................................................... 82 
题目 1  ...................................................... 82 
第 8 章 参数获取 ............................................. 83 
8.1 x86 ........................................................... 83 
8.1.1 MSVC ........................................... 83 
8.1.2 MSVC+OllyDbg ........................... 84 
8.1.3 GCC .............................................. 84 
8.2 x64 ........................................................... 85 
8.2.1 MSVC ........................................... 85 
8.2.2 GCC .............................................. 86 
8.2.3 GCC: uint64_t 型参数 .................. 87 
8.3 ARM ........................................................ 88 
8.3.1 Non-optimizing Keil 6/2013 
(ARM mode) ................................. 88 
8.3.2 Optimizing Keil 6/2013  
(ARM mode) ................................. 89 
8.3.3 Optimizing Keil 6/2013  
(Thumb mode) ............................ 89 
8.3.4 ARM64 ......................................... 89 
8.4 MIPS ........................................................ 91 
第 9 章 返回值 ................................................. 93 
9.1 void 型函数的返回值 ............................. 93 
9.2 函数返回值不被调用的情况.................. 94 
9.3 返回值为结构体型数据 ......................... 94 
第 10 章 指针 ................................................... 96 
10.1 全局变量 ................................................ 96 
10.2 局部变量 ................................................ 98 
10.3 总结 ..................................................... 100 
第 11 章 GOTO 语句 ................................... 101 
11.1 无用代码 Dead Code ........................... 102 
11.2 练习题 .................................................. 102 
第 12 章 条件转移指令 ............................... 103 
12.1 数值比较 .............................................. 103 
12.1.1 x86 ............................................. 103 
12.1.2 ARM.......................................... 109 
12.1.3 MIPS ......................................... 112 
12.2 计算绝对值 .......................................... 115 
12.2.1 Optimizing MSVC ................. 115 
12.2.2 Optimizing Keil 6/2013: Thumb  
 mode .......................................... 116 
12.2.3 Optimizing Keil 6/2013: ARM  
 mode .......................................... 116 
12.2.4 Non-optimizng GCC 4.9  
 (ARM64) ................................... 116 
12.2.5 MIPS ......................................... 117 
12.2.6 不使用转移指令 ....................... 117 
12.3 条件运算符 .......................................... 117 
12.3.1 x86 ............................................. 117 
12.3.2 ARM.......................................... 118 
12.3.3 ARM64 ...................................... 119 
12.3.4 MIPS ......................................... 119 
12.3.5 使用 if/else 替代条件运算符 ... 120 
12.3.6 总结 ........................................... 120 
12.4 比较最大值和最小值 .......................... 120 
12.4.1 32 位 .......................................... 120 
12.4.2 64 位 .......................................... 123 
12.4.3 MIPS ......................................... 125 
12.5 总结 ..................................................... 125 
12.5.1 x86 ............................................. 125 
12.5.2 ARM.......................................... 125 
12.5.3 MIPS ......................................... 126 
12.5.4 无分支指令 
（非条件指令） ......................... 126 
12.6 练习题.................................................. 127 
第 13 章 switch()/case/default .................. 128 
13.1 case 陈述式较少的情况 ...................... 128 
13.1.1 x86 ............................................. 128 
异步社区会员 dearfuture(15918834820) 专享 尊重版权
目    录 
3 
13.1.2 ARM: Optimizing Keil 6/2013  
 (ARM mode) ............................. 133 
13.1.3 ARM: Optimizing Keil 6/2013  
 (Thumb mode) .......................... 133 
13.1.4 ARM64: Non-optimizing GCC  
 (Linaro) 4.9 ............................... 134 
13.1.5 ARM64: Optimizing GCC 
 (Linaro) 4.9 ............................... 134 
13.1.6 MIPS ......................................... 135 
13.1.7 总结 .......................................... 136 
13.2  case 陈述式较多的情况 ...................... 136 
13.2.1 x86 ............................................ 136 
13.2.2 ARM: Optimizing Keil 6/2013  
 (ARM mode) ............................. 140 
13.2.3 ARM: Optimizing Keil 6/2013  
 (Thumb mode) .......................... 141 
13.2.4 MIPS ......................................... 143 
13.2.5 总结 .......................................... 144 
13.3 case 从句多对一的情况 ...................... 145 
13.3.1 MSVC ....................................... 145 
13.3.2 GCC .......................................... 147 
13.3.3 ARM64: Optimizing 
 GCC 4.9.1 ................................. 147 
13.4 Fall-through ......................................... 149 
13.4.1 MSVC x86 ................................ 149 
13.4.2 ARM64 ..................................... 150 
13.5 练习题 ................................................. 151 
13.5.1 题目 1 ....................................... 151 
第 14 章 循环 ................................................. 152 
14.1 举例说明 ............................................. 152 
14.1.1 x86 ............................................ 152 
14.1.2 x86:OllyDbg ............................. 155 
14.1.3 x86:跟踪调试工具 tracer ......... 156 
14.1.4 ARM ......................................... 157 
14.1.5 MIPS ......................................... 160 
14.1.6 其他 .......................................... 161 
14.2 内存块复制 ......................................... 161 
14.2.1 编译结果 .................................. 161 
14.2.2 编译为 ARM 模式的 
 程序 .......................................... 162 
14.2.3 MIPS ......................................... 163 
14.2.4 矢量化技术 .............................. 164 
14.3 总结 ..................................................... 164 
14.4 练习题 ................................................. 165 
14.4.1 题目 1 ........................................ 165 
14.4.2 题目 2 ........................................ 165 
14.4.3 题目 3 ........................................ 166 
14.4.4 题目 4 ........................................ 167 
第 15 章 C 语言字符串的函数 .................. 170 
15.1 strlen() .................................................. 170 
15.1.1 x86 ............................................. 170 
15.1.2 ARM.......................................... 174 
15.1.3 MIPS ......................................... 177 
15.2 练习题.................................................. 178 
15.2.1 题目 1 ........................................ 178 
第 16 章 数学计算指令的替换 .................. 181 
16.1 乘法 ..................................................... 181 
16.1.1 替换为加法运算 ....................... 181 
16.1.2 替换为位移运算 ....................... 181 
16.1.3 替换为位移、加减法的 
 混合运算 ................................... 182 
16.2 除法运算 .............................................. 186 
16.2.1 替换为位移运算 ....................... 186 
16.3 练习题.................................................. 186 
16.3.1 题目 1 ........................................ 186 
第 17 章 FPU .................................................. 188 
17.1 IEEE 754 .............................................. 188 
17.2 x86 ....................................................... 188 
17.3 ARM、MIPD、x86/x64 SIMD ........... 188 
17.4 C/C++................................................... 188 
17.5 举例说明 .............................................. 189 
17.5.1 x86 ............................................. 189 
17.5.2 ARM: Optimizing Xcode 
 4.6.3 (LLVM) (ARM mode) ...... 193 
17.5.3 ARM: Optimizing Keil 6/2013 
 (Thumb mode) ........................... 193 
17.5.4 ARM64: Optimizing GCC 
 (Linaro) 4.9 ............................... 194 
17.5.5 ARM64: Non-optimizing GCC 
 (Linaro) 4.9 ............................... 195 
17.5.6 MIPS ......................................... 195 
17.6 利用参数传递浮点型数据 .................. 196 
17.6.1 x86 ............................................. 196 
17.6.2 ARM + Non-optimizing  
 Xcode 4.6.3 (LLVM)  
 (Thumb-2 mode) ....................... 197 
异步社区会员 dearfuture(15918834820) 专享 尊重版权
4 
逆向工程权威指南（上册） 
17.6.3 ARM + Non-optimizing Keil 
 6/2013 (ARM mode) ................. 198 
17.6.4 ARM64 + Optimizing GCC 
 (Linaro) 4.9 ............................... 198 
17.6.5 MIPS ......................................... 199 
17.7 比较说明 ............................................. 200 
17.7.1 x86 ............................................ 200 
17.7.2 ARM ......................................... 216 
17.7.3 ARM64 ..................................... 219 
17.7.4 MIPS ......................................... 220 
17.8 栈、计算器及逆波兰表示法 .............. 221 
17.9 x64 ....................................................... 221 
17.10 练习题 ............................................... 221 
17.10.1 题目 1 ..................................... 221 
17.10.2 题目 2 ..................................... 221 
第 18 章 数组 ................................................. 223 
18.1 简介 ..................................................... 223 
18.1.1 x86 ............................................ 223 
18.1.2 ARM ......................................... 225 
18.1.3 MIPS ......................................... 228 
18.2 缓冲区溢出 ......................................... 229 
18.2.1 读取数组边界以外的内容 ....... 229 
18.2.2 向数组边界之外的地址赋值 ... 231 
18.3 缓冲区溢出的保护方法 ..................... 234 
18.3.1 Optimizing Xcode 4.6.3 (LLVM) 
 (Thumb-2 mode) ....................... 236 
18.4 其他 ..................................................... 238 
18.5 字符串指针 ......................................... 238 
18.5.1 x64 ............................................ 239 
18.5.2 32 位 MSVC ............................. 239 
18.5.3 32 位 ARM ............................... 240 
18.5.4 ARM64 ..................................... 241 
18.5.5 MIPS ......................................... 242 
18.5.6 数组溢出 .................................. 242 
18.6 多维数组 ............................................. 245 
18.6.1 二维数组举例 .......................... 246 
18.6.2 以一维数组的方式访问 
 二维数组 .................................. 247 
18.6.3 三维数组 .................................. 248 
18.6.4 更多案例 .................................. 251 
18.7 二维字符串数组的封装格式 .............. 251 
18.7.1 32 位 ARM ............................... 253 
18.7.2 ARM64 ..................................... 254 
18.7.3 MIPS ......................................... 254 
18.7.4 总结 ........................................... 255 
18.8 本章小结 .............................................. 255 
18.9 练习题.................................................. 255 
18.9.1 题目 1 ........................................ 255 
18.9.2 题目 2 ........................................ 258 
18.9.3 题目 3 ........................................ 263 
18.9.4 题目 4 ........................................ 264 
18.9.5 题目 5 ........................................ 265 
第 19 章 位操作 ............................................. 270 
19.1 特定位.................................................. 270 
19.1.1 x86 ............................................. 270 
19.1.2 ARM.......................................... 272 
19.2 设置/清除特定位 ................................. 274 
19.2.1 x86 ............................................. 274 
19.2.2 ARM + Optimizing Keil 6/2013 
 (ARM mode) ............................. 277 
19.2.3 ARM + Optimizing Keil 6/2013 