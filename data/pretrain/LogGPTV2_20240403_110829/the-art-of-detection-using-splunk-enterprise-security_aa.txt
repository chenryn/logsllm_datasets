© 2017 SPLUNK INC.
The Art of Detection
Using Splunk Enterprise Security
Doug Brown  |  Senior Information Security Analyst, Red Hat
95B6 922E 47D2 7BC3 D1AF F62C 82BC 992E 7CDD 63B6
September 27, 2017  |  Washington, DC
PRESENTATIONS.	© 2017 SPLUNK INC.
Forward-Looking StatementsDuring the course of this presentation, we may make forward-looking statements regarding future events or the expected performance of the company. We caution you that such statements reflect our current expectations and estimates based on factors currently known to us and that actual events or results could differ materially. For important factors that may cause actual results to differ from those contained in our forward-looking statements, please review our filings with the SEC.The forward-looking statements made in this presentation are being made as of the time and date of its live presentation. If reviewed after its live presentation, this presentation may not contain current or accurate information. We do not assume any obligation to update any forward looking statements we may make. In addition, any information about our roadmap outlines our general product direction and is subject to change at any time without notice. It is for informational purposes only and shall not be incorporated into any contract or other commitment. Splunk undertakes no obligation either to develop the features or functionality described or to include any such feature or functionality in a future release.Splunk, Splunk>, Listen to Your Data, The Engine for Machine Data, Splunk Cloud, Splunk Light and SPL are trademarks and registered trademarks of Splunk Inc. in the United States and other countries. All other brand names, product names, or trademarks belong to their respective owners. © 2017 Splunk Inc. All rights reserved.
© 2017 SPLUNK INC.
May this presentation improve the security oforganizations great and small.
© 2017 SPLUNK INC.
Speaker Background
▶
▶
▶
▶
▶
▶
▶
▶ Doug “trustedsubject” Brown 
Fond of SELinux 
SplunkTrust member 
Author of more than a dozen Splunkbase apps, incl Auditd 
2016 Developer Revolution Award Winner 
Masters degree examining the compositional behavioural properties of computer networks using formal methods: 
https://eprints.qut.edu.au/93693/1/Douglas_Brown_Thesis.pdfContributor to ES roadmap 
Preparing for a Successful ES Engagement:
	•https://www.splunk.com/blog/2016/10/24/preparing-for-a-successful-	enterprise-security-ps-engagement.html
© 2017 SPLUNK INC.
1. Operational Security at Red Hat
Overview 2. A New Triage Paradigm 
3. Correlation Search Development Process
4. Extensions and Customizations
5. Case Study
© 2017 SPLUNK INC.
Operational Security© 2017 SPLUNK INC.
Operational Security
	▶ Leading Open Source vendor
	▶ Global team of 14 people, dealing with 	various aspects of corporate security▶ Splunk customer since v4.1
▶ TB+ license ▶ Needed tool to support workflow and 	whole incident management lifecycle
	▶ Cost & risk of developing/maintaining our 	own tool was considered greater than ES	▶ Implemented ES at end of last year© 2017 SPLUNK INC.
Enterprise Security is just a framework 	upon which to build a world-class 	security operation
© 2017 SPLUNK INC.
A New Triage 
Paradigm
Our strategy to address alert fatigue and find what really matters.
© 2017 SPLUNK INC.
What Makes An Alert Actionable?
One or more of these?
▶ High Confidence?
▶ A Realised Threat?
▶ Must Be Rectified By Human?
▶ Substantial Evidence?▶ Substantial Evidence?
© 2017 SPLUNK INC.
Intrinsically 
Actionable
© 2017 SPLUNK INC.
Alert Fatigue 
Root Cause
▶ We falsely think we can detect "badness"
▶ Our detection mechanisms are bias towards early stages of the kill-chain where 	there's greater entropy and lower fidelity
▶ The hidden problem is that due to our assumption we're not actually detecting the 	genuinely bad things that present a real risk to organisationSolution
▶ Change-based correlation searches
▶ Risk-based incident detection
▶ Auto-close notables (no analyst triage required)
▶ Triage high-risk objects, prioritised by urgency (object priority x aggregated 	risk)
© 2017 SPLUNK INC.
Alert Fatigue 
Result
▶ Abstract rather than concrete approach to operational security allows unknown 	threats to be detected
▶ Analysts can concentrate on hunting and prioritise their triage time▶ Analysts triage less than 6 objects in a shift (often none)
▶ Changes the notion of what constitutes a false-positive
Requirements/Assumptions
▶ Bad actor changes something in order to achieve their actions on objective▶ Sufficient data across attack surface ingested and normalised
▶ Identity and asset prioritisation
▶ Team of creative analysts
▶ Suite of correlation searches
© 2017 SPLUNK INC.© 2017 SPLUNK INC.
Alert Fatigue 
FAQ
| ▶ Q: Why bother raising notables if they’re not triaged?
•	A: To summarise and retain evidence
•	A: Provide the means for higher-order correlation searches that perform meta-analysis of 
trends and anomalies across notables
▶ Q: If not triaging notables, which dashboards are used first for triage:
•	A: “Security Posture” & “Risk Analysis”▶ Q: Why stop triaging notables raised by high-fidelity correlation searches? | ▶ Q: Why bother raising notables if they’re not triaged?
•	A: To summarise and retain evidence
•	A: Provide the means for higher-order correlation searches that perform meta-analysis of 
trends and anomalies across notables
▶ Q: If not triaging notables, which dashboards are used first for triage:
•	A: “Security Posture” & “Risk Analysis”▶ Q: Why stop triaging notables raised by high-fidelity correlation searches? |
|---|---|
| • |A: If they are intrinsically actionable, then they should be triaged by an analyst |
© 2017 SPLUNK INC.
Security Event Tiering
Tier 	1  Raw information and events from security tools 
Typically low fidelity (“could be bad”) and not intrinsically actionable
| Tier Tier
1 2  | Behaviour-based correlation search notablesTypically medium fidelity (“looks bad”) and generally not intrinsically actionable | Behaviour-based correlation search notables 
Typically medium fidelity (“looks bad”) and generally not intrinsically actionable | Behaviour-based correlation search notables 
Typically medium fidelity (“looks bad”) and generally not intrinsically actionable |
|---|---|---|---||---|---|---|---|
| Tier Tier 1 2  |Tier 3 |Object risk/sequence-based correlation searches High fidelity (“likely bad”) and requires attention |Object risk/sequence-based correlation searches High fidelity (“likely bad”) and requires attention |
| Tier Tier 1 2  |Tier  4 |Tier  4 |Abstract risk-based correlation searches High fidelity (“likely bad”) and requires attention |
© 2017 SPLUNK INC.© 2017 SPLUNK INC.
Correlation Search 
Development Process
© 2017 SPLUNK INC.
1st: The Idea
How we produce a behaviour of interest
▶ What is the org concerned about?
▶ What does it look like?
© 2017 SPLUNK INC.
2nd: The Source
How we prepare the data into the form required
▶ Scope and Abstraction
▶ Period and Acceleration
▶ Cleaning, Checking and Filtering
▶ Enrichment and Modelling▶ Enrichment and Modelling
© 2017 SPLUNK INC.
3rd: The Metric
How we measure the behaviour of interest
▶ Signatures and Blacklists
▶ Statistics and Bounds
▶ Set Operations
▶ State Machines
© 2017 SPLUNK INC.
4th: The Conditions
How do we determine when the behaviour is of interest
▶ Simple Threshold / Predicate
▶ Dynamic Threshold / Predicate
▶ Multi-Stage Conditionals▶ Multi-Stage Conditionals
▶ Sequences
© 2017 SPLUNK INC.
5th: The Triage
How to interpret and action an event
▶ Fields and Documentation
▶ Analysis and Enrichment
▶ Actions and Remediation
▶ Fidelity and Refinement
© 2017 SPLUNK INC.
Extensions and 
Customizations
Developing a SIEM to meet the needs of your team.
© 2017 SPLUNK INC.
| ▶ | Enrichment | 
 |
|---|---|---|| ▶ | Enrichment | 
 |
|---|---|---|
| ▶ |Internal |  |
| ▶ |Network Sessions (DHCP lease, VPN session) |  |
| ▶ |User Endpoints (learnt devices) |  |
| ▶ |pDNS (derived from DNS logs / wire data) |  |
| ▶ |Notable Comment Key-Value Extraction |  |
| ▶ |Internal Subnets |  |
| ▶ |User Watchlist |  |
| ▶ |(https://splunkbase.splunk.com/app/3591/) |  |
| ▶ |Notable Macro |  |
| ▶ |Notable Macro |  || ▶ |Notable Macro |  |