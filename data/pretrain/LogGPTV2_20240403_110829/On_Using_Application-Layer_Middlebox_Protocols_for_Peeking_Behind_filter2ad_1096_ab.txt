Models
Implementations
WANIPConnection
WANPPPConnection
With forwards
Internal
External
2,789,823
957,031
1,832,792
223
11,984
1,067,035
1,545
15,038
28,963
393,775
100,063
130,899
127,133
17,704
480,563
221,176
259,387
200
5,256
480,563
677
2,125
749
393,775
100,063
130,899
127,133
17,704
Vulnerable†
408,080
192,759
215,321
195
4,381
408,080
237
716
445
326,312
88,244
118,556
114,790
17,704
† As deﬁned in Section II-B5.
‡ Endpoints that allowed downloading the service description ﬁle (Section II-A2).
†† Hosts undiscoverable with vanilla ZMap.
found that more than half of the hosts were from Asia: 19 %
from South Korea, followed by China (15 %), Taiwan (8 %),
Vietnam (7 %), and Japan (5 %). The remaining 46 % were
spread over 209 other countries.
2) Hosts With Port Mapping Service: From these hosts,
38 % (almost 1,100,000) exposed their HTTP endpoint, i. e.,
we were able to fetch the corresponding device description
ﬁle. 45 % (~480,000) of hosts had either WANIPConnection
(~394,000), WANPPPConnection (~100,000), or both of
them (~13,000) exposed. The majority of these devices (almost
350,000) had no active forwards. However, 86 % of them re-
turned a SOAP error indicating that they support the interface,
but that there are no active forwards. The remaining devices
represent various errors caused by network outages or protocol
handling differences.
3) Existing Port Mappings: We now concentrate only on
the endpoints having forwards, totaling 27 % of all WAN*-
Connection exposing endpoints with a total of almost
5,000,000 forwards, covering almost all possible ports. After
ﬁltering out non-active forwards (either by being explicitly
disabled, or not having information about the ports and hosts)
and removing duplicates (where the forwards share the same
description as well as the target host and port), we are left
with almost 3,300,000 forwards.
For simplicity, we categorize the forwards into three
groups: (a) “Galleta Silenciosa” forwards targeting mainly TCP
ports 139 and 445, (b) forwards targeting Internet-routable
IP addresses, and (c) innocuous port mappings. We note that
the two former groups are not mutually exclusive, whereas
the innocuous group contains all forwards not contained in
those two. This does not necessarily mean that all forwards
in this group are deﬁnitely benign. Table II provides an
overview of numbers of unique hosts, forwards, and locations
for each of these categories. Table III on page 6 provides a
closer look into the most frequently seen descriptions, internal
ports, and targeted subnets (we summarize IP addresses to
the corresponding /24 subnets for readability). For clarity,
we also clean the descriptions by removing unique identiﬁers
(e.g., WhatsApp ((cid:104)ID(cid:105)) to WhatsApp, and group descriptions
consisting only of host:port under “IP+port match” if there
is a match.
4
TABLE II.
UPNP GATEWAYS WITH PORT FORWARDS
Total
External
Galleta Silenciosa
Innocuous
Hosts
With internal forwards
With external forwards
Countries
AS#
Forwards
Internal forwards
UDP forwards
TCP forwards
External forwards
UDP forwards
TCP forwards
Target hosts
Target subnets
Target ports
Descriptions
Cleaned descriptions
SSDP
SSDP source ports
HTTP endpoint ports
SSDP implementations
Manufacturers
Models
130,899
127,133
17,704
183
3,340
3,265,311
2,678,840
525,369
2,147,450
586,471
7,410
579,000
62,535
16,963
64,600
407,028
35,479
15,027
12,431
399
471
1,468
17,704
0
17,704
90
593
586,471
0
0
0
586,471
7,410
579,000
31,984
15,052
11,942
13,464
3,251
225
1,323
149
145
423
42,401
39,354
10,425
116
1,067
1,625,220
1,598,233
0
1,598,233
26,987
0
26,987
39,603
7,609
8
1
1
676
3,883
160
197
609
113,388
113,388
0
180
3,187
1,080,607
1,080,607
525,369
549,217
0
0
0
15,678
1,816
64,492
393,888
32,486
14,839
11,379
363
460
1,411
a) Galleta Silenciosa – Silent Cookie: Our ﬁrst cate-
gory consists of hosts with forwards with the exact description
“galleta silenciosa” (Spanish: “silent cookie”), accounting for
up to 37 % of all existing forwards. In total, 32 % (~42,000
from all hosts had these forwards, predominantly targeting
TCP ports 139 and 445 (87 %) across all private, RFC1918
address ranges. In total, we found ~1,600,000 forwards to
~22,000 unique IP addresses on ~7,600 different /24 subnets.
A closer analysis revealed that this observation indicates that
actual attacks are performed by adversaries in the wild that
exploit UPnP to reach hosts behind a NAT gateway. The most
common 20 subnets had forwards to each of the hosts in
these subnets, while the top 100 had a median of 201 hosts
being targeted, which indicates that an attacker has aimed to
locate endpoints behind these NAT gateways. These forwards
target primarily the network indicated in the Location header
of the discovery response. Although these mappings were seen
on hosts from almost 700 different SSDP response ports, we
emphasize that 97 % of them were from devices responding
to discovery from port 1900. The device description ﬁles were
predominantly hosted on ports 2048 and 5431 (up to 62 %), the
rest were seen in arbitrary ports and non-standard ﬁle paths.
This indicates a more sophisticated approach from the attacker
than simply trying to use the commonly used endpoints.
Independently from us, Seaman also detected these port
mappings (or “NAT injections”) [62], which conﬁrms that we
are actually observing attackers exploiting this attack vector
in practice. Seaman speculated that the goal of the attacker
has been to exploit SMB implementations vulnerable to the
famous SMB vulnerabilities EternalBlue and EternalRed. Con-
currently to our work, a security company identiﬁed a malware
family using the hardcoded string “galleta silenciosa” for its
port forwards [15]. Whether this is the origin of these forwards
or just a copycat remains unknown to us.
b) External Port Mappings: The second category of
malicious port forwards involves forwarding to external hosts.
In total, we detected over 18,000 gateway devices (14 % from
all forward-having devices) containing such forwards targeting
on 32,000 different IP addresses. More speciﬁcally, the most
commonly seen descriptions are “galleta silenciosa” (~27,000
forwards on ~10,000 hosts), “MONITOR” (~530,000 on 5,100
hosts), and “node:nat:upnp”1 (over 1,800 on ~1,400 hosts),
which seem to be of malicious nature and used by different
actors based on their usage. Whereas the external “galleta”
injections mostly link to other routers in this same group of
gateways, the “node:nat:upnp” ones are pointing to DNS ports,
while the “MONITOR” forwards’ target addresses that are
not contained in our data set. These forwards are mostly on
HTTP(S) ports on 11,239 unique IP addresses, of which ~7,000
had reverse DNS records indicating various advertisement
networks, VPS providers, and CDNs as targets, indicating their
potential use for domain fronting as indicated by Akamai’s
research. In total, we observed 205 different 2nd-level domains
under 29 top-level domains.
Given the variety of malicious activities we observed re-
lated to these forwards, we speculate that this activity belongs
to different kinds of actors. This observation also corresponds
to the interpretation by researchers from Akamai [1], who
speculate that these injections are part of a botnet linked to the
“Inception Framework” identiﬁed by Symantec [67]. Again,
these observations demonstrate that attackers are actively mis-
using such protocols to peek behind NAT gateways.
c) Innocuous Port Mappings: Our last group consists
of non-malicious port mappings, which were not included in
the two previous groups described above. This group contains
the majority of the devices with forwards, totaling ~114,000
hosts with over a million of non-duplicate forwards. As shown
in Table II, these one million forwards divide equally to UDP
and TCP forwards.
In total, ~25,000 hosts in this group contained forwards to
privileged ports including HTTP(S) ports (port 80 on ~11,000
hosts, port 443 on over 6,000), with appearances of telnet
(660 hosts), SSH (1,216), SMTP (611), and FTP (1,238). On
average, gateways in this group had three internal clients with
a total of 8 forwards. The most common internal networks
were unsurprisingly 192.168.0.0/24 and 192.168.1.0/24 (seen
in Table III). The most common, legitimate applications were
BitTorrent and chat programs (e. g., WhatsApp or WeChat) on
20 % of devices, and gaming (e.g., UDP 9308 is apparently
used for PlayStation multiplayer games).
4) Forwards on Port 0 and Broadcasts Addresses: The
widespread occurrence of port 0 on both innocuous and
external mappings is a mystery—the speciﬁcation states that
it is not allowed as forwarding target and shall only be used
as a wildcard to indicate that all unmapped ports are to be
forwarded to the speciﬁed client (seen on almost 500 gateways
for external and on ~3,100 for internal target addresses). This
feature could potentially be misused by an attacker to capture
all potential trafﬁc, assuming the functionality is implemented
as it is speciﬁed in the standard. The innocuous forwards
on 255.255.255.255 are likewise odd—in total, almost 1,300
hosts had one for TCP (most with internal port 44382) and
over 2,100 for UDP. We could not ﬁnd a reason for the
TCP forwards (all but three had description “miniupnpd”), nor
should they be valid forwards. Note that the UPnP speciﬁcation
explicitly states that UDP mappings must be supported for
1The default value for the Node.js UPnP library, https://github.com/indutny/
node-nat-upnp
5
TABLE III.
MOST COMMON UPNP FORWARD DESCRIPTIONS, INTERNAL TARGET PORTS, AND SUBNETS PER CATEGORY. THE PERCENTAGE
INDICATES THE AMOUNT OF RESPONSIVE HOSTS IN THE CATEGORY HAVING THE DESCRIBED FORWARD.
Galleta Silenciosa (TCP)
External Forwards TCP
External Forwards UDP
Innocuous TCP
Innocuous UDP
Everything (any)
galleta silenciosa
–
–
–
–
Unique values
100.0 %
galleta silenciosa
– MONITOR
–
–
–
proxy
Skype-preﬁxed
HTTP FORWARD
node:nat:upnp
miniupnpd
HCDN
63.01 %
30.76 %
5.37 %
3.32 % WhatsApp-preﬁxed
2.7 %
Teredo
1
Unique values
3,019
Unique values
139
445
80
0
443
76.23 %
72.55 %
18.25 %
13.95 %
0.07 %
80
0
443
8100
4450
68.83 %
22.14 %
21.14 %
12.59 %
5.36 %
53
8290
6881
4194
0
Unique values
8
Unique values
7,357
Unique values
Forward Descriptions
50.79 %
25.75 %
4.37 %
4.01 %
3.96 %
uTorrent
libtorrent
Network
PiXel
miniupnpd
Unique values
277
Internal Ports