title:Capacity-efficient and uncertainty-resilient backbone network planning
with hose
author:Satyajeet Singh Ahuja and
Varun Gupta and
Vinayak Dangui and
Soshant Bali and
Abishek Gopalan and
Hao Zhong and
Petr Lapukhov and
Yiting Xia and
Ying Zhang
Capacity-Efficient and Uncertainty-Resilient Backbone Network
Planning with Hose
Satyajeet Singh Ahuja
Facebook
Soshant Bali
Facebook
Petr Lapukhov
Facebook
Varun Gupta
Facebook
Abishek Gopalan
Facebook
Yiting Xia
Max Planck Institute for Informatics
Vinayak Dangui
Facebook
Hao Zhong
Facebook
Ying Zhang
Facebook
ABSTRACT
This paper presents Facebook’s design and operational experience
of a Hose-based backbone network planning system. This initial
adoption of the Hose model in network planning is driven by the
capacity and demand uncertainty pressure of backbone expansion.
Since the Hose model abstracts the aggregated traffic demand per
site, peak traffic flows at different times can be multiplexed to save
capacity and buffer traffic spikes. Our core design involves heuristic
algorithms to select Hose-compliant traffic matrices and cross-layer
optimization between the optical and IP networks. We evaluate the
system performance in production and share insights from years
of production experience. Hose-based network planning can save
17.4% capacity and drops 75% less traffic under fiber cuts. As the
first study of Hose in network planning, our work has the potential
to inspire follow-up research.
CCS CONCEPTS
• Networks → Wide area networks; Traffic planning; Network
reliability; Layering; Network simulations; Network experimenta-
tion; Network measurement; • Computer systems organization
→ Availability;
KEYWORDS
Wide-area networks, Network planning, Network modeling, Net-
work optimization
ACM Reference Format:
Satyajeet Singh Ahuja, Varun Gupta, Vinayak Dangui, Soshant Bali, Abishek
Gopalan, Hao Zhong, Petr Lapukhov, Yiting Xia, and Ying Zhang. 2021.
Capacity-Efficient and Uncertainty-Resilient Backbone Network Planning
with Hose . In ACM SIGCOMM 2021 Conference (SIGCOMM ’21), August
23–27, 2021, Virtual Event, USA. ACM, New York, NY, USA, 13 pages. https:
//doi.org/10.1145/3452296.3472918
(cid:53)(cid:73)(cid:74)(cid:84)(cid:1)(cid:88)(cid:80)(cid:83)(cid:76)(cid:1)(cid:74)(cid:84)(cid:1)(cid:77)(cid:74)(cid:68)(cid:70)(cid:79)(cid:84)(cid:70)(cid:69)(cid:1)(cid:86)(cid:79)(cid:69)(cid:70)(cid:83)(cid:1)(cid:66)(cid:1)(cid:36)(cid:83)(cid:70)(cid:66)(cid:85)(cid:74)(cid:87)(cid:70)(cid:1)(cid:36)(cid:80)(cid:78)(cid:78)(cid:80)(cid:79)(cid:84)(cid:1)(cid:34)(cid:85)(cid:85)(cid:83)(cid:74)(cid:67)(cid:86)(cid:85)(cid:74)(cid:80)(cid:79)(cid:1)(cid:42)(cid:79)(cid:85)(cid:70)(cid:83)(cid:79)(cid:66)(cid:85)(cid:74)(cid:80)(cid:79)(cid:66)(cid:77)(cid:1)(cid:21)(cid:15)(cid:17)(cid:1)(cid:45)(cid:74)(cid:68)(cid:70)(cid:79)(cid:84)(cid:70)(cid:15)
SIGCOMM(cid:1)’21,(cid:1)August(cid:1)23–27,(cid:1)2021,(cid:1)Virtual(cid:1)Event,(cid:1)USA
©(cid:1)2021(cid:1)Copyright(cid:1)held(cid:1)by(cid:1)the(cid:1)owner/author(s).
ACM(cid:1)ISBN(cid:1)978-1-4503-8383-7/21/08.
https://doi.org/10.1145/3452296.3472918
1 INTRODUCTION
Global online service providers, such as Google, Facebook, and
Amazon, build wide-area backbone networks for connecting thou-
sands of Point-of-Presence (PoP) sites and hundreds of Data Cen-
ters (DCs) across continents. To keep up with the explosive traffic
growth, tremendous amounts of money and engineering effort
are constantly invested in expanding and upgrading the backbone
network. Network planning is thus the key to the backbone evolve-
ment, with the ultimate goal of devising capacity-efficient network
build plans that are resilient to unforeseen demand uncertainties from
service changes and traffic dynamics.
Facebook achieves this goal by innovatively adopting the Hose
model in backbone planning. Traditionally, backbone planning was
based on the Pipe model. As illustrated in Figure 1, the Pipe model
abstracts pairwise traffic demands between network sites [16]. To
provision sufficient capacity across demand variations, with the
Pipe model, we must plan for the peak demand between every site
pair. From the entire network’s perspective, this approach aims
at accommodating the “sum of peak” traffic regarding all the con-
nected sites. The Hose model, in contrast, abstracts the aggregated
ingress and egress traffic demands per site [9, 13]. It naturally sums
up the traffic demands across sites, so capacity planning with the
Hose model is for the “peak of sum” traffic. As the peak traffic
demands across different sites are unlikely to happen simultane-
ously, the Hose model offers multiplexing gain, which saves the
total capacity and leaves headroom for traffic uncertainties after
deployment where individual demands across sites vary but their
sum does not exceed the provisioned peak capacity.
Besides capacity saving and resilience to uncertainty, Hose-based
backbone planning goes hand in hand with the industry trend of
decoupling service logic from infrastructure design. In practice, ser-
vices are migrated from one DC to another for various reasons, e.g.,
load balancing, service scaling, latency reduction, DC maintenance,
etc. The network and server infrastructure should mark out the
service behaviors and provide flexibility for service migration. This
requirement makes accurate point-to-point traffic demand forecast
between site pairs very difficult. In addition, for an actively growing
backbone network like Facebook’s, new DCs are built yearly, so it is
almost impossible to estimate the traffic demand to/from new DCs
yet to be built. Thanks to the Hose model, we only need to specify
the aggregated traffic demand per site, without worrying about the
other end of each traffic flow. Therefore, using Hose-based plan-
ning, the network has the potential to scale up per-node basis, as
easily as storage and compute resources, in the future.
547
(cid:3)(cid:9)
(cid:3)(cid:10)
(cid:2)(cid:5)(cid:7)(cid:4)
(cid:1)(cid:6)(cid:8)(cid:4)
(cid:3)(cid:11)
(cid:25)(cid:16)(cid:13)(cid:20)(cid:11)(cid:2)(cid:8)(cid:11)(cid:3) (cid:35)(cid:3)(cid:12)(cid:14)(cid:25)(cid:26)(cid:37)(cid:13)(cid:27)(cid:7)(cid:13)(cid:22)(cid:38)
(cid:25)(cid:16)(cid:13)(cid:20)(cid:11)(cid:2)(cid:8)(cid:11)(cid:4) (cid:35)(cid:4)(cid:12)(cid:14)(cid:25)(cid:26)(cid:37)(cid:13)(cid:27)(cid:4)(cid:25)(cid:22)(cid:38)
(cid:25)(cid:16)(cid:13)(cid:20) (cid:36)(cid:11)(cid:2)(cid:31)(cid:32)(cid:33)(cid:31)(cid:34)(cid:34) (cid:35)(cid:5)(cid:12)(cid:14)(cid:25)(cid:26) (cid:13)(cid:21)(cid:21)(cid:15)(cid:13)(cid:30)
(cid:10)(cid:19)(cid:25)(cid:16)(cid:1)(cid:26)(cid:28)(cid:22)(cid:24)(cid:17)(cid:25)(cid:16)(cid:13)(cid:20)(cid:35)(cid:6)(cid:12)(cid:14)(cid:25)(cid:26)
(cid:9)(cid:24)(cid:26)(cid:16)(cid:1)(cid:25)(cid:16)(cid:13)(cid:20)(cid:24)(cid:17)(cid:26)(cid:28)(cid:22)(cid:35)(cid:5)(cid:12)(cid:14)(cid:25)(cid:26)
(cid:9)(cid:24)(cid:26)(cid:16)(cid:22)(cid:28)(cid:21)(cid:27)(cid:19)(cid:25)(cid:21)(cid:16)(cid:29)(cid:19)(cid:23)(cid:18)(cid:18)(cid:13)(cid:19)(cid:23)(cid:35)(cid:2)(cid:12)(cid:14)(cid:25)(cid:26)
Figure 1: Hose model for aggregated ingress and egress traffic de-
mands per site vs. Pipe model for individual traffic demands be-
tween node pairs on a 3-site network. A site can be a DC or PoP.
Pipe plans for “sum of peak” traffic, whereas Hose plans for “peak
of sum” traffic, which offers multiplexing gain as individual peak
traffic demands usually happen at different times.
However, regardless of the advantages of Hose-based network
planning, the capacity must be granted to site pairs in a point-to-
point manner like in the Pipe model. Our problem with backbone
planning is thus to convert the Hose per-site traffic into the Pipe
pairwise traffic. The Hose model, which was originally invented for
Virtual Private Network (VPN) provisioning [9] and later used for
Virtual Machine (VM) placement [4] in the cloud, has never been
applied to the network planning setting, so we cannot turn to the
literature for readily available solutions.
Our main contribution in this paper is the solution to this new
problem. The Pipe output traffic can be presented as a traffic matrix
(TM) between the site pairs. The aggregated traffic demands in
Hose map to a continuous space, which contains an infinite number
of TMs. It is computationally intractable to plan for all possible Pipe
TMs under the Hose model. Our challenge is to generate a small
subset of TMs to represent the Hose space. We propose a series of
heuristic algorithms to address this challenge (§4). We first design a
sampling scheme to generate candidate TMs uniformly in the Hose
space. From these TMs, we find critical ones that stress the current
bottleneck links, which are potential locations to deploy additional
capacity. We thus propose a sweeping algorithm to quickly find
bottleneck links in the network. Critical TMs are chosen through
optimization, and we also define “Hose coverage” as a metric to
quantify how representative these chosen TMs are.
Another contribution of this paper is to share the production
network planning process, with practical considerations in Face-
book’s network setting. Our engineering experience includes the
separation of short-term and long-term planning, the abstraction
to simplify the interaction between the optical and IP networks,
the resilience policy to protect against failures, and the optical-IP
cross-layer capacity optimization (§5). We also evaluate the perfor-
mance of our Hose-based network planning system in production
(§6). We demonstrate Hose can save 17.4% capacity compared to
Pipe and drops up to 75% less traffic under unplanned failures.
To the best of our knowledge, we are the first to study the Hose
model in the context of network planning, and this is the first time
that the end-to-end network planning procedure is introduced to
academia. We wish our work to inspire a new line of research,
where theoreticians can have a better formulation of our heuristic
algorithms and practitioners can optimize our planning system.
This work does not raise any ethical issues. We preserved user
privacy and anonymity throughout this study.
2 MOTIVATION FOR HOSE
In this section, we use production traffic to demonstrate the ad-
vantages of Hose-based backbone planning on capacity saving and
resilience to traffic uncertainties.
Experimental setup We collect production traffic between every
site pair on the Facebook North America backbone from 11/23/2020
to 12/28/2020. To eliminate the time-of-day effect, we only look at
the busy hour, when the total traffic in the backbone is the highest in
the day. In the busy hour, traffic is sampled once per minute, making
60 data points. For the Pipe model, we get the 90th percentile across
the 60 data points as the peak traffic demand for each site pair. For
the Hose model, we add up the ingress/egress traffic per site for each
data point across the source/destination sites it talks to. Among
the 60 data points of aggregated traffic, we use the 90th percentile
as the peak Hose traffic demand. This method gives us the “daily
peak” traffic demands for the Hose and Pipe models respectively.
In production, we usually smooth traffic demands with a moving
average. By Facebook’s standard, we take a 21-day window to
average the daily peak demands described above, and we add 3×
the standard deviation of the 21-day data to the moving average as a
buffer for sudden traffic spikes. This method produces the “average
peak” traffic demand per Hose site and per Pipe site pair.
In the following experiments, we sum up the total traffic demand
in the entire North America backbone, across sites in Hose and
across site pairs in Pipe. We look at 4 numbers per day: the total daily
peak demand and the total average peak demand in the backbone,
under the Hose and Pipe models respectively.
Traffic reduction The key difference between Hose- and Pipe-
based planning is to deploy capacity for “peak of sum” vs. “sum
of peak” traffic. If using the Hose model, the multiplexing gain
allows us to plan for less capacity, as the Pipe traffic sharing the
same source/sink are unlikely to reach the peak simultaneously.
Figure 2 shows the relative Hose traffic reduction, as the reduced
total demand in Hose against Pipe divided by the total demand
in Pipe. The “daily peak” demand of Hose (red dashed curve) is
10%-15% lower than Pipe, and the “average peak” demand (black
solid curve) is 20%-25% lower. As backbone planning is based on
traffic demands, we have good reasons to believe a considerable
proportion of capacity can be saved just by adopting the Hose
model for planning.
Tolerance to traffic dynamics The multiplexing effect also means
the Hose planning result can cover more traffic variations. Figure 3
is the CDF of the total daily peak traffic demand. For confidentiality,
we normalize the absolute traffic volume against the maximum
demand (which is from the Pipe model). As shown in the figure,
the vertical line at 𝑥 = 0.55 maps to 90% of the days in the Hose
model and 40% in Pipe. It means if we plan for 55% of the maximum
total demand, under the Hose model, the daily peak demand will
be satisfied for 90% of the days, while it will be satisfied for only
40% of the days in Pipe. The higher percentile in Hose indicates
it can tolerate more traffic uncertainties. Since the Hose model is
constrained by the aggregated traffic instead of a particular TM, it
has more headroom to absorb unexpected traffic spikes.
Stable traffic demand We also measure the variance of Hose
and Pipe traffic across days. To make the different traffic demands
comparable, we use coefficient of variation as the metric, which is
548
i
g
n
v
a
s
c
(cid:1)
a
r
t
e
v
i
t
a
e
R
l
 26
 24
 22
 20
 18
 16
 14
 12
 10
Daily peak
Average peak
F
D
C
11/28 12/05 12/12 12/19 12/26
Day
 1
 0.9
 0.8