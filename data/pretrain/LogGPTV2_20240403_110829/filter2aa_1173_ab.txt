•  Remaining&–&Command/ApplicaAon&&&File&
Path&
File&Analysis&
fs_usage!
Very&Verbose&
NaAve&to&OS&X&
fs_usage –w –f !
Filters:&
• pathname&–&File&Path&Events&
• filesys&–&File&System&Events&
• exec&–&New&and&Spawned&Process&Events&
• diskio&–&Disk&Input/Output&Events&
• cachehit&–&Cache&Hits&
• network&–&Network&Events&
File&Analysis&–&Pathname&Events&
fs_usage –f pathname!
•  Columns&
–  Timestamp&
–  Call&
–  File&Descriptor&(F=##)&
–  [ERRNO]&–&Error&Code&
–  File&Path&
–  Time&Interval&(W&=&Wait&
Time)&
–  Process&Name&
&
•  Calls&of&Interest&
–  getattrlist&–&Get&ﬁle&
system&arributes&
–  getxattr&–&Get&
extended&arribute&
–  setattrlist&–&Set&ﬁle&
system&arribute&
–  stat64,&lstat64&–&Get&
ﬁle&status&
–  open&–&Open/Create&File&
–  mkdir,&rmdir&–&Make/
Remove&a&directory&
File&Analysis&N&Pathname&Events&
fs_usage –w –f pathname&
!
08:05:21.631155  getattrlist /Applications/
Messages.app   0.000011   Dock.513976!
!
08:05:21.006391  open F=135 (R_____) /Users/
sledwards/Library/Application Support/
Google/Chrome/Default/Local Storage  
0.000022   Google Chrome.7460!
!
File&Analysis&–&Disk&I/O&Events&
fs_usage –f diskio!
•  Columns&
–  Timestamp&
–  Call&
–  Disk&Block&(D=##)&
–  Byte&Count&(B=##)&
–  Disk&
–  File&Path&
–  Time&Interval&(W&=&Wait&
Time)&
–  Process&Name&
•  Calls&of&Interest&
–  WrMeta&–&Write&
Metadata&
–  WrData&–&Write&Data&
–  RdData&–&Read&Data&
–  PgIn&–&Page&In&
–  PgOut&–&Page&Out&
File&Analysis&–&Disk&I/O&Events&
fs_usage –w –f diskio&
!
08:15:54.847585    WrMeta[AT3]     D=0x01471e78  
B=0x2000   /dev/disk1  /Users/sledwards/Library/
Mail/V2/PI:EMAIL/[Gmail].mbox/
Trash.mbox/65AE84E4-7606-4E45-BC3F-E5E3398FDCE0/
Data/0/7/Messages  0.000262 W launchd.207!
!
08:15:55.005800    WrData[AT1]     D=0x125f2870  
B=0x1000   /dev/disk1  /Users/sledwards/Library/
Application Support/Google/Chrome/Default/Local 
Storage/http_www.rdio.com_0.localstorage-journal 
0.000169 W Google Chrome.7458!
!
File&Analysis&
fseventer&
fernlightning.com&
GUI&ApplicaAon&
Diﬀerent&Views:&
• Graphical&“Tree”&View&
• Table&View&
Filtering&
Save&Output&to&Text&File&
File&Analysis&N&fseventer&
File&Analysis&N&fseventer&
File&Analysis&N&fseventer&
Process&Analysis&
Dtrace&
• execsnoop&
• newproc.d&
fs_usage&
procxp&
AcAvity&Monitor&
Process&Analysis&–&Snoop&New&Processes&
Dtrace&–&newproc.d&
•  Timestamp&
•  Process&ID&
•  Parent&Process&ID&
•  Architecture&=&32b/64b&&
•  Command&&&Arguments&/&ApplicaAon&
Process&Analysis&N&New&Processes&
Dtrace&–&execsnoop&
• 
TIME&–&RelaAve&Timestamp&
• 
STRTIME&–Timestamp&(String)&
• 
PROJ&–&Project&ID&
• 
UID&–&User&ID&
• 
PID&–&Process&ID&
• 
PPID&–&Parent&Process&ID&
• 
ARGS&–&Program/ApplicaAon&
Process&Analysis&–&New&Processes&
fs_usage –f exec!
•  Columns&
–  Timestamp&
–  Call&
–  Pathname&
–  Time&Interval&(W&=&Wait&
Time)&
–  Process&Name&
&
•  Calls&of&Interest:&
–  execve&–&New&Process&
–  posix_spawn&–&
Spawned&Process&
Process&Analysis&N&New&Processes&
fs_usage –w –f exec&
!
20:53:48.539284  posix_spawn /Applications/0xED.app/
Contents/MacOS/0xED 0.000270 launchd.777421!
!
20:54:04.592903  execve /usr/bin/man 0.000175 bash.777569!
!
20:54:04.600445  posix_spawn /bin/sh 0.000165 man.777569!
!
20:54:04.603848  execve /usr/bin/tbl 0.000224 sh.777573!
!
20:54:04.604053  execve /usr/bin/groff 0.000173 sh.777574!
&
Process&Analysis&–&RealNAme&Processes&
procxp&
&
CLI&Process&Explorer&(for&Mac)&
Scroll/sort&processes&via&keys&
Click&Enter&for&more&info&on&process&
www.newosxbook.com/index.php?page=downloads&
&
Process&Analysis&
procxp&
&
Process&Analysis&–&RealNAme&Processes&
AcAvity&Monitor&
Network&Analysis&
CocoaPacketAnalyzer&
Wireshark&
Tcpdump&
AcAvity&Monitor&
lsock&
Network&Analysis&N&CocoaPacketAnalyzer&
www.tastycocoabytes.com/cpa/&
Network&Analysis&–&Wireshark&
www.wireshark.org/download.html&
Network&Analysis&
tcpdump&
Without&Content:&tcpdump -i en0 -n host #.#.#.#&
&
With&Content:&tcpdump -i en0 -n -X host #.#.#.#!
Network&Analysis&
AcAvity&Monitor&
Network&Analysis&–&lsock&
www.newosxbook.com/index.php?page=downloads&
Malware&Analysis&Examples&
LogKext&–&Open&Source&Keylogger&
• *.pkg&Installer&
Imuler&–&File/Screenshot&Stealer&
• *.app&disguised&as&a&photo&
Example&N&LogKext&
Example&N&LogKext&
newproc.d&
2014 Apr  1 17:46:48 1445  64b  /bin/sh /tmp/
PKInstallSandbox.82TjPW/Scripts/
com.fsb.logkext.logkextExt.pkg.V8BqhR/postinstall /Users/
cliffstoll/Desktop/logKext-2.3.pkg /System/Library/
Extensions / /!
!
2014 Apr  1 17:46:49 1457  64b  /Library/Application 
Support/logKext/logKextKeyGen!
!
2014 Apr  1 17:46:49 1458  64b  /bin/launchctl 
load /Library/LaunchDaemons/logKext.plist!
!
2014 Apr  1 17:46:49 1460  64b  /usr/bin/open /
LogKext Readme.html!
Example&N&LogKext&
newproc.d&
2014 Apr  1 17:46:48 1455  64b  /sbin/kextunload -b 
com.fsb.kext.logKext!
2014 Apr  1 17:46:49 1456  64b  /sbin/kextload /
System/Library/Extensions/logKext.kext!
!
2014 Apr  1 17:46:49 1459  64b  /Library/Application 
Support/logKext/logKextDaemon!
!
2014 Apr  1 17:47:00 1472  64b  login -pf cliffstoll!
2014 Apr  1 17:47:00 1473  64b  -bash!
2014 Apr  1 17:47:11 1476  64b  sudo logKextClient!
2014 Apr  1 17:47:11 1477  64b  logKextClient!
Example&N&LogKext&
fs_usage&–f&pathname&
17:40:24.418176  getattrlist /Users/cliffstoll/Desktop/
logKext-2.3.pkg 0.000004   Finder.7100!
!
17:40:24.418285  getattrlist /System/Library/CoreServices/
Installer.app 0.000012   Finder.7100!
!
17:40:24.641275  open F=15 (RW_A_E) private/var/log/install.log 
0.000028   syslogd.30889!
!
17:40:39.296222  statfs64 /Library/Application Support/logKext 
0.000021   mds.30953!
!
17:40:39.296445  stat64 /System/Library/Extensions/logKext.kext 
0.000010   mds.30953!
!
17:40:43.135053  getattrlist /LogKextUninstall.command 0.000014  
mds.31061!
Example&N&LogKext&
fs_usage&–f&pathname&
17:40:58.946647  open F=3 (R_____)  /usr/bin/logKextClient 
0.000007   logKextKeyGen.31301!
!
17:40:59.028515  open [  2] (R_____)  /Library/Preferences/
com.fsb.logKext.plist 0.000003  cfprefsd.31142!
!
17:40:59.056241  statfs [  2] /Library/Preferences/com.fsb.logKext 
0.000018   logKextDaemon.31319!
!
17:40:59.190232  open F=11 (R_____)  /LogKext Readme.html 0.000007   
mds.31061!
!
17:41:06.808873  open F=25 (_WC_T_)  /Users/cliffstoll/Library/
Caches/Metadata/Safari/History/file:%2F%2F%2FLogKext
%2520Readme.html.webhistory 0.000110   Safari.31520!
!
17:41:31.191547  stat64 /usr/bin/logKextClient                             
0.000007   sudo.31638!
Example&N&Imuler&
Example&N&Imuler&
fs_usage&–f&exec&
Example&N&Imuler&
fseventer&[1]&
Example&N&Imuler&
fseventer&[2]&
Example&–&Imuler&
tcpdump&
•  Beacons&to&“ouchmen.com”&
Resources&&&References&
Blogs&
•  “Reverse&Engineering&OS&X”&N&reverse.put.as&(@osxreverser)&
•  “Reverse&Engineering&Resources”&N&hrp://samdmarshall.com/re.html&(@dirk_gently)&
•  Hopper&App&Blog&N&hopperapp.tumblr.com&(@hopperapp)&
Resources&
•  Apple&Developer&Website&
•  man&Pages&
Malware&Samples&
•  Contagio&N&contagiodump.blogspot.com&
•  VXShare&N&virusshare.com&
•  Open&Malware&N&www.oﬀensivecompuAng.net&
•  Malwr&N&malwr.com&
Contact&me&at:&@iamevltwin&or&PI:EMAIL&