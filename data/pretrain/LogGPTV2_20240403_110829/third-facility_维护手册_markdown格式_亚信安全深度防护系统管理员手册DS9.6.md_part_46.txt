速记属性在以下情况下会非常有用：一组属性自然组合到一起，完全列出一组属性将变得冗长，以及由高级别属性表示的属性集可能会随
时间或系统配置发生更改。每种情况的示例分别如下所示：
属属性性 描描述述
用于监控实体集的属性集。这不同于实体集的“每个可能的属性”。例如，此属性集不包括每个可能的哈希算法，仅包括被认为足以满足功能的哈希算
STANDARD
法。有关每个实体集的 "standard" 属性列表，请参阅各实体集的相关部分。
CONTENTS 这是文件内容的哈希或哈希集速记。缺省值为 SHA-1。
onChange
EntitySet 可能会被设置为实时监控更改。如果将 EntitySet 的 onChange 属性设置为 true（缺省值），则由 EntitySet 返回的实体
的更改情况将受到实时监控。当检测到更改时，系统会立即根据实体基线对实体进行对比，以找出变化。如果将 EntitySet 的 onChange
属性设置为 false，仅当生成基线或通过预设任务（或根据亚信安全服务器深度安全防护系统管理中心需求）触发基线时，才运行此实体
集。
223
亚信安全服务器深度安全防护系统 9.6 管理员指南 完整性监控规则语言
以下示例实时监控 MySQL 二进制文件：
环境变量
环境变量可以包含在实体集中所使用的基值中。这些变量括在 "${}" 内。变量名称本身的前缀为 "env."。
以下示例将 FileSet 的基本目录设置为 PROGRAMFILES 环境变量中存储的路径：
注意： 引用的环境变量的值由亚信安全服务器深度安全防护系统客户端在客户端启动时读取并存储。如果环境变量的值发生更
改，则必须重新启动客户端才能注册更改。
如果未找到引用的环境变量，则不会扫描或监控引用此变量的实体集，但使用其余配置。触发警报表示变量不存在。客户端使用客户端事
件“完整性监控规则编译问题”来报告无效的环境变量。完整性监控规则的 ID 和环境变量名称将作为参数提供给事件。
注册表值
注册表值可以包含在实体集中所使用的基值中。这些注册表值括在 ${} 内。注册表值本身的路径前缀为 "reg."。以下示例将 FileSet 的
基本目录设置为 "HKLM\Software\AsiaInfo Security\Deep SecurityAgent\InstallationFolder" 注册表值中存储的路径：
上述示例将 FileSet 的基本目录设置为 "HKLM\Software\AsiaInfoSecurity\DeepSecurityAgent\InstallationFolder" 注册表值中存
储的路径。
客户端收到新的或已更改的规则时，会读取引用的注册表值。客户端还会在启动时检查所有规则，如果任何引用的注册表值发生更改，客
户端将针对受影响的规则重新生成基线。
如果未找到引用的注册表值，则不会扫描/监控引用此注册表值的实体集，但使用其余配置。会引发警报，通知您变量不存在。客户端使
用客户端事件 8012 来报告无效的环境变量扩展。完整性监控规则的 ID 和注册表值路径将作为参数提供给事件。
注意： 通配符只可在基本名称的最后一个层次结构组件中使用。例如，base="HKLM\Software\ATI*" 有效，并且将找到 "HKLM\
Software\ATI" 和 "HKLM\Software\ATI Technologies"；但 "base="HKLM\*\Software\ATI*" 无效。
使用 ".."
在客户端的所有当前版本中，支持使用 ".." 来引用父目录的惯例。客户端将通过解析 ".." 引用并将 Windows 短名称转换为长名称来尝
试规范化 FileSet 和 DirectorySet 元素的基本目录名称。例如，在 Vista 上，以下 FileSet 的基本目录将为 "C:\Users"。在 Vista
之前的 Windows 版本上，基本目录则为 "C:\Documents and Settings"
最佳做法
编写规则时应使其仅包含有意义的对象和属性。这将确保在对象的其他属性发生更改时不报告任何事件。例如，更改监控策略可能会给
"/bin" 中的文件的权限和所有权设置限制。完整性监控规则应该监控所有者、组和权限，而非其他属性（如上次修改时间或哈希值）。
224
亚信安全服务器深度安全防护系统 9.6 管理员指南 完整性监控规则语言
使用完整性监控规则检测恶意软件和可疑活动时，监控服务、观察 NTFS 数据流的使用情况，并留意特殊位置（如 "/tmp" 或
"${env.windir}\temp"）中的可执行文件。
指定要在规则中包括的对象时，尽可能具体一点。包括的对象越少，则创建基线以及扫描更改所花费的时间就越少。排除预料中会发生更
改的对象，仅监控关心的属性。
请勿执行以下操作：
• 从层次结构的顶级（如 "/"、"C:\" 或 "HKLM\Software"）使用 "**/..."
• 使用多个内容哈希类型（除非绝对必要）
• 引用用户特定的位置，如 HKEY_CURRENT_USER、${env.USERPROFILE} 或 ${env.HOME}
在完整性监控规则中使用任何这些语句都将导致性能问题，因为亚信安全服务器深度安全防护系统客户端会搜索许多项以匹配指定的特征
码。
225
亚信安全服务器深度安全防护系统 9.6 管理员指南 DirectorySet
DirectorySet
DirectorySet 标记介绍了一组目录。
标记属性
相对于完整性监控规则所监控的实体的属性，以下属性是标记本身的 XML 属性。
必必 缺缺省省
属属性性 描描述述 允允许许值值
需需 值值
解析为语法有效的路径（并不要求路径存在）的字符串值。注注意意：Windows 客户端允许使用 UNC 路径，但要求客户端计算
设置 机的 "LocalSystem" 帐户能够访问远程系统。此客户端是一种以 LocalSystem（又称为 NT AUTHORITY\SYSTEM）身份运行
DirectorySet 的 Windows 服务。当访问网络资源时，LocalSystem 使用计算机的凭证，即名为 DOMAIN\MACHINE$ 的帐户。由于提供给
的基本目录。 远程计算机的访问令牌还包含此计算机的“管理员”组，因此远程共享必须向客户端计算机的帐户、客户端计算机的管理
base 标记中的其他 是 N/A 员组或“每个成员”授予读权限。有关测试对 UNC 路径的访问权限，请使用此技术启动在 LocalSystem 帐户下作为服务
所有内容都是 运行的 Windows 命令提示符。这样，您便可以尝试访问网络和本地资源，或启动将在 LocalSystem 帐户下运行的其他应
相对于此目录 用程序。
的
如果基本值的语法无效，将不会处理 FileSet。但会评估其余配置。
是否应当实时
onChange 监控返回的目 否 false true、false
录。
此
DirectorySet
followLinks 否 false true、false
是否将要遵循
符号链接。
实体集属性
以下是可能受完整性监控规则监控的实体的属性。
• CCrreeaatteedd：：创建目录的时间戳
• LLaassttMMooddiiffiieedd：：上次修改目录的时间戳
• LLaassttAAcccceesssseedd：：上次访问目录的时间戳在 Windows 上，不会立即更新此值，并且记录上次访问的时间戳会因性能增强而遭到禁
用。有关详细信息，请参阅文件时间。关于此属性的其他问题为：执行扫描目录需要客户端打开目录，这将更改上次访问的时
间戳。
• PPeerrmmiissssiioonnss：：在 Windows 上，是目录的安全描述符，格式为 SDDL；或在支持 ACL 的 Unix 系统上，是 Posix 样式的 ACL，
否则将会是数字（八进制）格式的 Unix 样式 rwxrwxrwx 文件权限。
• OOwwnneerr：：目录所有者的用户 ID（在 Unix 上通常指 "UID"）
• GGrroouupp：：目录所有者的组 ID（在 Unix 上通常指 "GID"）。
• FFllaaggss：：仅限 Windows。由 GetFileAttributes() Win32 API 返回的标志。Windows 资源管理器将以下内容称为文件的“属
性”：只读、已归档、已压缩等。
• SSyymmLLiinnkkPPaatthh：：如果目录是符号链接，则链接的路径存储在此处。在 Windows 上，使用 SysInternal "junction" 工具创建与
符号链接等效的 Windows 链接。
• IInnooddeeNNuummbbeerr（（仅仅限限 LLiinnuuxx））：：
• DDeevviicceeNNuummbbeerr（（仅仅限限 LLiinnuuxx））：：磁盘的设备编号，此磁盘存储与目录关联的 inode
226
亚信安全服务器深度安全防护系统 9.6 管理员指南 DirectorySet
速记属性
以下是速记属性及其映射到的属性。
• SSTTAANNDDAARRDD：：Created、LastModified、Permissions、Owner、Owner、Flags（仅限 Windows）、SymLinkPath
"Key" 的含义
Key 是一种模式，用于匹配与 "dir" 指定的目录相对的目录路径。这是一种层次结构模式，其中，用 "/" 隔开的模式各部分与用给定操
作系统的文件分隔符隔开的路径各部分匹配。
子元素
• IInncclluuddee
• EExxcclluuddee
有关 include/exclude 的允许属性和子元素，请参阅 include/exclude 的一一般般说说明明((第第221188页页))。此处仅包含与该 EntitySet 类相关的
include/exclude 的特定信息。
227
亚信安全服务器深度安全防护系统 9.6 管理员指南 FileSet
FileSet
FileSet 标记介绍了一组文件。
标记属性
相对于完整性监控规则所监控的实体的属性，以下属性是标记本身的 XML 属性。
必必 缺缺省省
属属性性 描描述述 允允许许值值
需需 值值
解析为语法有效的路径（并不要求路径存在）的字符串值。注注意意：Windows 客户端允许使用 UNC 路径，但要求客户端计算机
设置
的 "LocalSystem" 帐户能够访问远程系统。此客户端是一种以 LocalSystem（又称为 NT AUTHORITY\SYSTEM）身份运行的
FileSet 的
Windows 服务。当访问网络资源时，LocalSystem 使用计算机的凭证，即名为 DOMAIN\MACHINE$ 的帐户。由于提供给远程计
基本目录。
算机的访问令牌还包含此计算机的“管理员”组，因此远程共享必须向客户端计算机的帐户、客户端计算机的管理员组或
base 标记中的其 是 N/A
“每个成员”授予读权限。有关测试对 UNC 路径的访问权限，请使用此技术启动在 LocalSystem 帐户下作为服务运行的
他所有内容
Windows 命令提示符。这样，您便可以尝试访问网络和本地资源，或启动将在 LocalSystem 帐户下运行的其他应用程序。
都是相对于
此目录的。
如果基本值的语法无效，将不会处理 FileSet。但会评估其余配置。
是否应当实
onChange 时监控返回 否 false true、false
的文件。
此 FileSet
是否将要遵
followLinks 否 false true、false
循符号链
接。
实体集属性
以下是可能受完整性监控规则监控的 FileSet 的属性。
• CCrreeaatteedd：：创建文件的时间戳
• LLaassttMMooddiiffiieedd::上次修改文件的时间戳
• LLaassttAAcccceesssseedd::上次访问文件的时间戳在 Windows 上，不会立即更新此值，并且记录上次访问的时间戳会因性能增强而遭到禁
用。有关详细信息，请参阅文件时间。关于此属性的其他问题为：执行扫描文件需要客户端打开文件，这将更改上次访问的时
间戳。在 Unix 上，如果打开文件时 O_NOATIME 标志可用，则客户端将使用此标志，这将阻止操作系统更新上次访问的时间戳
并提高扫描速度。
• PPeerrmmiissssiioonnss：：在 Windows 上，是文件的安全描述符，格式为 SDDL；或在支持 ACL 的 Unix 系统上，是 Posix 样式的 ACL，
否则将会是数字（八进制）格式的 Unix 样式 rwxrwxrwx 文件权限。
• OOwwnneerr：：文件所有者的用户 ID（在 Unix 上通常指 "UID"）
• 组组::文件所有者的组 ID（在 Unix 上通常指 "GID"）
• SSiizzee：：文件的大小
• SShhaa11::SHA-1 哈希
• SShhaa225566：：SHA-256 哈希
• MMdd55::MD5 哈希
• 标标志志：：仅限 Windows。由 GetFileAttributes() Win32 API 返回的标志。Windows 资源管理器将以下内容称为文件的“属
性”：只读、已归档、已压缩等。
• SSyymmLLiinnkkPPaatthh（仅限 Unix）：如果文件是符号链接，则链接的路径存储在此处。Windows NTFS 支持类似于 Unix 的符号链接，
但仅限目录，并不包括文件。Windows 快捷方式对象并不是真的符号链接，因为操作系统未处理这些对象；Windows 资源管理
器处理快捷方式文件 (*.lnk)，但打开 *.lnk 文件的其他应用程序将只看到此 lnk 文件的内容。
228
亚信安全服务器深度安全防护系统 9.6 管理员指南 FileSet
• IInnooddeeNNuummbbeerr（仅限 Unix）
• DDeevviicceeNNuummbbeerr（仅限 Unix）：磁盘的设备编号，此磁盘存储与文件关联的 inode
• BBlloocckkssAAllllooccaatteedd（仅限 Unix）
• GGrroowwiinngg：：如果文件的大小保持不变或在扫描之间增加，则 (DSA 7.5+) 包含值 "true"，否则包含值 "false"。此属性主要对
附加了数据的日志文件有用。注意，滚动日志文件将导致此属性发生更改。
• SShhrriinnkkiinngg：：如果文件的大小保持不变或在扫描之间减少，则 (DSA 7.5+) 包含值 "true"，否则包含值 "false"。
速记属性
以下是速记属性及其映射到的属性。
• CCOONNTTEENNTTSS：：解析为在策策略略//计计算算机机编编辑辑器器 >> 完完整整性性监监控控 >> 高高级级中设置的内容哈希算法。