measurements at a large scale and offers researchers access to its
110[simplified]50⩾61Number of days (n)0204060Percentage1Mostpopular20K40K60K80K100KLesspopularSitepopularityranking020406080100Cumulativepercentageshort-termlong-termFigure 9: Top providers with the highest number of high-
churn IP addresses.
Figure 10: CDF of the k-anonymity value per domain as a
percentage of all domains observed from the Active DNS
Project, Rapid7, and our datasets.
data. Unlike the Active DNS Project, Rapid7 resolves a much larger
number of domains (1.8B), but with a lower frequency (domains are
resolved only once a week). The dataset includes not only second-
level domains from several TLD zone files, but also lower-level
domains obtained through web crawling and targeted scanning
with Zmap [34].
Different from these datasets, as discussed in §4.2, our domain
name dataset is curated from the global lists of Alexa and Majestic.
We also perform measurements from vantage points around the
world to observe localized DNS responses from CDNs. In contrast,
the above datasets are collected from local vantage points, as their
goal is to maximize the number of observed domains, and not
to exhaustively resolve all potential IP addresses of a domain. In
particular, the Active DNS Project is run from Georgia Tech, while
Rapid7’s data is collected using AWS EC2 nodes in the US. To that
end, we used two datasets from the Active DNS Project and Rapid7
collected on March 29th, 2019 for our comparison. We sanitized
poisoned records from these datasets, as described in Appendix §B,
before analyzing them.
Figure 10 shows the CDF of the k-anonymity value per domain
for all the domains in the Active DNS, Rapid7, and our datasets,
while Figure 11 shows the CDF of the k-anonymity value per do-
main for only common domains among the three datasets.
In Figure 10, when k = 1, there is some difference in the per-
centage of single-hosted domains between the Active DNS Project
(5.3%), Rapid7 (54.3%), and our observation (18.7%). As expected,
the percentage of single-hosted domains for Rapid7 is the high-
est because this dataset is the largest (1.8B FQDNs), and includes
lower-level FQDNs that may host other services (e.g., email, DNS,
SSH) instead of web content. On the other hand, only 5.3% of the
domains in the Active DNS dataset are single-hosted, since the
dataset contains mostly A records of domains extracted from TLD
zone files, instead of many lower-level FQDNs.
When all domains are considered, our observation of single-
hosted domains is in between the two (18.7%) because (as mentioned
in §4.2) we derive our domain name dataset from the two global top
websites lists (Alexa and Majestic), and include not only second-
level domains but also lower-level FQDNs, as long as they are
Figure 11: CDF of the k-anonymity value per domain as a
percentage of common domains observed from the Active
DNS Project, Rapid7, and our datasets.
included in the lists and serve web content. This aligns well with
the results of Rapid7 and Active DNS, given the inherent over-
approximation of the Rapid7 dataset (due to non-web services and
highly unpopular or even single-use domains) and the inherent
under-approximation of the Active DNS Project dataset (due to
only domains extracted from TLD zone files).
When considering only common domains, the percentages of
single-hosted domains are 4.1%, 11.7%, and 20.4% for the Rapid7,
Active DNS, and our dataset, respectively. In other words, some
domains classified as single-hosted in our dataset are actually multi-
hosted when considering the larger datasets. This result confirms
our hypothesis discussed in §4.2 that by only considering the two
sets of popular websites, we would have missed those less popular,
random, or even dormant domains in the long tail. Thus, the result
provided by our dataset can be considered as a lower bound value
of the actual k-anonymity, since any increase in k provided by less
well-known, random, or even dormant domains is less meaningful
from the perspective of adversaries whose goal is to reveal a visited
0K25K50K75K100K125K150KAS16509AmazonAS16625AkamaiTech.AS20940AkamaiIntl.AS13335CloudﬂareAS14618AmazonAS3320DeutscheTelAS15169GoogleAS9498BHARTIAirtelAS13911Tera-byteAS2914NTTAmericaNumberofdynamicIPaddresses/domainsIPaddressesdomains100102104106108K-anonymityvalue020406080100CumulativepercentageOursActiveDNSRapid7100102104106108K-anonymityvalue020406080100CumulativepercentageOursActiveDNSRapid7website by incorporating the popularity ranking information in
their “guess.”
At the right end of the CDFs in both Figures 10 and 11, the
two larger datasets exhibit k-anonymity values higher than ours.
The primary reason for this is that these datasets include not only
second-level domains, but also third-level and longer FQDNs. The
higher k values also comprise the long-tail of domains that are not
included in our dataset, including less popular domains, random or
single-use FQDNs used for tracking, and malicious domains [96].
7 DISCUSSION
7.1 Recommendations
While the security benefits of DoH/DoT against on-path adversaries
are clear (e.g., prevention of MiTM or MoTS DNS poisoning attacks),
our findings show that Encrypted SNI alone cannot fully address
the privacy concerns it aims to tackle. More effort and collabora-
tion from all involved parties (i.e., operators of DNS authoritative
name servers, website owners, and hosting and CDN providers) are
needed. In this section we provide some suggestions for maximizing
the privacy benefits of ESNI.
In the current designs,
Full Domain Name Confidentiality.
plaintext domain names are exposed through two channels: the
SNI extension in TLS, and traditional DNS name resolutions—the
deployment of DoH/DoT is thus a prerequisite for ESNI. Equiva-
lently, the use of DoH/DoT will not provide any meaningful privacy
if domain names are still exposed through the (unencrypted) SNI
extension in TLS handshake traffic.
Recently, there is a push for the deployment of DoH/DoT, with
major organizations already supporting it (e.g., Google, Cloudflare,
Firefox), though this has not been followed by an equivalent effort
for the deployment of ESNI. An even more complicated method
of securing DNS traffic is DNS-over-HTTPS-over-Tor, which has
been already implemented and supported by Cloudflare [91]. Unless
the confidentiality of domain names is preserved on both channels
(TLS and DNS), neither technology can provide any actual privacy
benefit if deployed individually.
Domain Owners. Website owners who want to provide increased
privacy to their users can seek hosting providers or CDNs that
offer an increased ratio of co-hosted domains per IP address and/or
highly dynamic domain-to-IP mappings. In practice, however, this
may be challenging. Our results show that unfortunately only a
few providers offer a high domain-to-IP ratio, while other more
pressing factors (e.g., site popularity) may tilt the decision towards
other more important factors, such as latency, bandwidth, or points
of presence.
While pointer (PTR) records are often not configured, from a
privacy perspective, their operation conflicts with DoH/DoT and
ESNI as further discussed in Appendix C. Consequently, website
operators should not configure PTR records unless absolutely nec-
essary (e.g., for email servers). In addition, providers with a higher
rotation of IP addresses are more preferable, as this also helps in
improving privacy.
Hosting Providers. Hosting and CDN providers are in a more
privileged position to achieve meaningful impact in helping im-
prove the potential privacy benefits of ESNI, as they can control
the number of co-hosted domains per IP address, and the frequency
of IP addresses rotation. Unless website owners prefer otherwise,
providers could group more websites under the same IP address
(which, understandably, may not be desirable for some websites).
To improve k-anonymity even more meaningfully, providers
should cluster websites according to similarities in terms of traffic
patterns and popularity ranking, to hinder website fingerprinting at-
tempts. As discussed in §5.4, more dynamic hosting IP addresses can
also help improve visitors’ privacy. Currently, the number of web-
sites benefiting from more short-lived domain-to-IP mappings is
relatively small. While more frequent IP address changes may com-
plicate operational issues and are certainly more challenging to de-
ploy from a technical perspective (especially for smaller providers),
existing load balancing schemes already provide such a capability,
which could be tuned to also maximize privacy. In the future, it
may be worthwhile to explore more sophisticated schemes that
actively attempt to maximize privacy by increasing the “shuffling”
rate of co-hosted domains per IP address, to hinder attribution even
further, especially when considering more determined adversaries.
7.2 Impact
The deployment of domain encryption has various advantages and
disadvantages from the two—rather conflicting—perspectives of
Internet censorship and network visibility.
The existing plaintext exposure of domain names on the wire,
as part of DNS requests and TLS handshakes, has enabled the wide
use of network traffic filtering and censorship based on domain
names [2, 32, 39, 49, 82, 93]. In a future with all domain name infor-
mation being encrypted, DNS and SNI traffic will no longer be an
effective vector to conduct censorship. It is likely that censors will
shift to use IP-based blocking, which can be very effective if hosting
IP addresses of censored websites are stable and host only a handful
of sites or services [33, 50]. However, if providers start adapting
according to the above mentioned recommendations, the cost of
conducting IP-based blocking will increase, since a censor will have
to keep track of which IP address belong to which websites.
More importantly, the collateral damage caused by this type of
blocking will also increase dramatically if censored websites are
co-hosted with multiple other innocuous websites [52]. Although
some previous actions from the side of providers (e.g., hindering
domain fronting [40]) have shown that privacy is often given a
secondary priority [88], as the collateral damage caused to censors
may also impact significantly the providers, the renewed recent
focus on privacy as a potential competitive advantage by some
providers may encourage the deployment of hosting schemes that
will improve the privacy benefits of ESNI.
On the other hand, while providing many security and privacy
benefits, domain name encryption can be a “double-edged sword”
for network administrators who want to have full visibility and
control over domain resolutions in the networks under their re-
sponsibility. Until now, the operation of firewalls, intrusion detec-
tion systems, and anti-spam or anti-phishing filters has benefited
immensely from the domain name information extracted from net-
work traffic, as is evident by the series of works mentioned in §8
that employ DNS data to detect domain name abuses and malicious
online activities.
Under a full DoH/DoT and ESNI deployment, this visibility will
be lost, and systems based on domain reputation [9] and similar
technologies will be severely impacted. While many malicious do-
mains often hide themselves by sharing hosting addresses with
other innocuous and unpopular websites [96], it will be challenging
to detect and block them. A possible solution would be to rely solely
on TLS proxying using custom provisioned certificates, in order to
gain back the visibility lost by ESNI and DoH/DoT, which is already
a common practice used by transparent SSL/TLS proxies. Although
this will defeat any privacy benefits of these technologies, this may
be an acceptable trade off for corporate networks and other similar
environments.
8 RELATED WORK
The domain name system is one of the core elements of the Internet
and plays an essential role for most online services. As a result, it
has been (ab)used for many different purposes. In this section, we
review prior works that investigate DNS from security and privacy
perspectives, and some recent studies that analyze the domain name
ecosystem via empirical measurements.
From a security perspective, domain names have been heavily
abused for illicit purposes. For instance, domain squatting is one
of the most common abuses. It is used to register domains that
are similar to those owned by well-known Internet companies. Do-
main squatting has many variations, including typo-squatting [5, 57,
96], homograph-based squatting [41, 85], homophone-based squat-
ting [76], bit-squatting [77], and combo-squatting [58]. Domain
names registered using these squatting techniques can then be used
for phishing [80, 85] or distributing malware [8]. To cope with these
unwanted domain names, DNS data has been used intensively to
create domain name reputation systems to detect abuse [9–11, 62].
Another major form of DNS abuse is DNS poisoning, in which
an on-path observer can easily observe and tamper with DNS re-
sponses to redirect users to malicious websites or to censor un-
wanted content [2, 32, 39, 67, 82, 93]. The exposure of domain
names in DNS requests and TLS handshakes (due to SNI) has also
been extensively used for traffic filtering and censorship [21, 49].
As mentioned in §2.1, the traditional design of DNS exposes In-
ternet users to severe privacy risks. In addition to on-path observers
(discussed in §3), previous works have also studied the privacy risk
associated with centralizing all domain name resolutions to third-
party recursive resolvers (e.g., 8.8.8.8, 1.1.1.1) [18, 19, 46, 59, 95, 105].
Zhao et al. [105] propose to add random noise and use private in-
formation retrieval to improve privacy by obfuscating DNS queries.
These proposals however have turned out to be impractical and inse-
cure under certain circumstances [19], and have not been adopted.
Lu et al. [69] propose privacy-preserving DNS (PPDNS), which
is based on distributed hash tables and computational private in-
formation retrieval. More recently, Hoang et al. [51] propose K-
resolver as a mechanism to distribute DoH queries among multiple
recursors, thus exposing to each recursor only a part of a user’s
browsing history. Sharing similar goals with our study, Shulman et
al. [95] examined the pitfalls of DNS encryption. By analyzing the
co-residence of zone files on name servers, the authors argue that
guessing visited domains by destination IP address does not provide
a significant advantage. Our findings, however, show that this is
only the case for a small number of domains that are co-hosted
with an adequate number of other domains.
Hounsel et al. [54] study the effect of DoH/DoT on performance
of domain name resolution and content delivery. The study finds
that the resolution time of DoH/DoT is longer than traditional
DNS resolution. Of the two new technologies, DoT provides better
page load times while DoH at best has the same page load times
as DNS. They also find that DoT and DoH perform worse than
DNS in networks with sub-optimal performance. Similarly, a recent
study by Bottger et al. [14] analyzes the DoH ecosystem and shows
that they can obtain more advanced privacy features of DoH with
marginal performance degradation in terms of page load times.
There have also been studies that investigated the robustness of
the DNS ecosystem through various types of measurements. Rama-
subramanian et al. [86] leverage a dataset of almost 600K domains
to study their trusted computing base, which is the set of name
servers on which a FQDN is hosted. The study shows that a typical
FQDN depends on 46 servers on average. Dell’Amico et al. [30] use
DNS data collected through both active and passive measurements
to also investigate the ecosystem of dependencies between websites
and other Internet services. Similarly to our work, Shue et al. [94]
use DNS data collected by both passive and active measurements to
study web server co-location and shared DNS infrastructure. How-
ever, their measurements were conducted from a single location,
while excluding all servers belonging to CDNs. Furthermore, the
passive DNS dataset used was collected by capturing network traf-
fic from the authors’ institute, therefore facing all potential issues
of a passive measurement discussed in §4.1. More recently, Hoang
et al. [52] revisit the results of Shue et al. [94] by conducting a
large-scale active DNS measurement study, which reveals that the
Web is still centralized to a handful of hosting providers, while IP
blocklists cause less collateral damage than previously observed
regardless of a high level of website co-location.
9 CONCLUSION
The deployment of encrypted SNI in TLS, combined with DNS over
HTTPS/TLS, will definitely provide many security benefits to Inter-
net users. However, as we have shown in this work, a significant
effort is still needed in order for these same technologies to provide
meaningful privacy benefits. More specifically, while domain name
information is encrypted, the IP address information is still visible
to any on-path observers and can be used to infer the websites
being visited.