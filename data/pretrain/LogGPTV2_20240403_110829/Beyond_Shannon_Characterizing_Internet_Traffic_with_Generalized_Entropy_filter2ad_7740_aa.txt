title:Beyond Shannon: Characterizing Internet Traffic with Generalized Entropy
Metrics
author:Bernhard Tellenbach and
Martin Burkhart and
Didier Sornette and
Thomas Maillart
Beyond Shannon: Characterizing Internet Trafﬁc with
Generalized Entropy Metrics
Bernhard Tellenbach1, Martin Burkhart1, Didier Sornette2, and Thomas Maillart2
1 Computer Engineering and Networks Laboratory, ETH Zurich, Switzerland
2 Department of Management, Technology and Economics, ETH Zurich, Switzerland
{betellen,martibur,dsornette,tmaillart}@ethz.ch
Abstract. Tracking changes in feature distributions is very important in the do-
main of network anomaly detection. Unfortunately, these distributions consist of
thousands or even millions of data points. This makes tracking, storing and vi-
sualizing changes over time a difﬁcult task. A standard technique for capturing
and describing distributions in a compact form is the Shannon entropy analysis.
Its use for detecting network anomalies has been studied in-depth and several
anomaly detection approaches have applied it with considerable success. How-
ever, reducing the information about a distribution to a single number deletes
important information such as the nature of the change or it might lead to over-
looking a large amount of anomalies entirely. In this paper, we show that a gen-
eralized form of entropy is better suited to capture changes in trafﬁc features, by
exploring different moments. We introduce the Trafﬁc Entropy Spectrum (TES)
to analyze changes in trafﬁc feature distributions and demonstrate its ability to
characterize the structure of anomalies using trafﬁc traces from a large ISP.
1 Introduction
Fast and accurate detection of network trafﬁc anomalies is a key factor in providing a
reliable and stable network infrastructure. In recent years, a wide variety of advanced
methods and tools have been developed to improve existing alerting and visualization
systems. Some of these methods and tools focus on analyzing anomalies based on vol-
ume metrics, such as e.g., trafﬁc volume, connection count or packet count [1]; oth-
ers look at changes in trafﬁc feature distributions [2] or apply methods involving the
analysis of content or the behavior of each host or group of hosts [3]. However, con-
tent inspection or storing state information on a per host basis are usually limited to
small- and medium-scale networks. If feasible at all, the link speeds and trafﬁc volumes
in large-scale networks hinder a reasonable return on investment from such methods.
Most approaches designed for large-scale networks have therefore two things in com-
mon: First, they reduce the amount of input data by looking at ﬂow-level information
only (e.g., Cisco NetFlow [4] or IPFIX [5]). Second, they use on-the-ﬂy methods that do
not rely on a large amount of stored state information. A major drawback of on-the-ﬂy
methods is their inappropriateness for approaches relying on the history of trafﬁc feature
distributions. A related problem arises, when one wants to visualize the evolution of IP
address- or ﬂow size distributions over time. In large-scale networks, these distributions
consist of millions of data points and it is unclear how to select a relevant subset.
S.B. Moon et al. (Eds.): PAM 2009, LNCS 5448, pp. 239–248, 2009.
c(cid:2) Springer-Verlag Berlin Heidelberg 2009
240
B. Tellenbach et al.
A prominent way of capturing important characteristics of distributions in a compact
form is the use of entropy analysis. Entropy analysis (1) reduces the amount of informa-
tion needed to be kept for detecting distributional changes and (2) allows for a compact
visualization of such changes. Evidence that methods based on Shannon entropy cap-
ture the relevant changes has been documented [6,7,8].
Here, we propose a new method for capturing and visualizing important character-
istics of network activity based on generalized entropy metrics. Our method is a sig-
niﬁcant extension of the work of Ziviani et al. [9] who recently proposed and studied
the use of generalized entropy metrics in the context of anomaly detection. Ziviani et
al. introduced a method based on a single generalized entropy value which needs to be
tuned to a speciﬁc attack. In their evaluation, they provide evidence that generalized
entropy metrics are better suited to capture the network trafﬁc characteristics of DoS
attacks than Shannon entropy.
Our new method makes the following contributions:
– We deﬁne the Trafﬁc Entropy Spectrum (TES) for capturing and visualizing impor-
tant characteristics requiring little or no tuning to speciﬁc attacks.
– We demonstrate that the TES can not only be used for the detection of an anomaly
but also for capturing and visualizing its characteristics.
– We provide evidence that Autonomous System (AS) entropy is a valuable comple-
ment to IP address entropy.
– We conﬁrm the ﬁnding of [9] for a broader set of anomalies.
The remainder of this paper is organized as follows: In Section 2, we start with a
review of the Tsallis entropy and discuss its advantage over Shannon entropy. Next,
we introduce the Trafﬁc Entropy Spectrum (TES) and explain how it is used to capture
and visualize distributional changes. Section 3 describes the methodology used for the
evaluation. Section 4 discusses the results and outlines how TES could be used to build
a detector with integrated anomaly classiﬁcation. Finally, Section 5 discusses related
work and section 6 summarizes the results.
2 The Tsallis Entropy
The Shannon entropy Ss(X) = − (cid:2)n
i=1 pi · log2(pi) [10] can be seen as a logarithm
moment as it is just the expectation of the logarithm of the measure (with a minus
sign to get a positive quantity). Given that different moments reveal different clues on
the distribution, it is clear that using other generalized entropies may reveal different
aspects of the data. Two of such generalized entropies relying on moments different
from the log-moment are the Renyi and Tsallis entropies, the latter being an expansion
of the former. Here, we use the Tsallis entropy
Sq(X) =
1
q − 1
(cid:3)
1 − n(cid:4)
(pi)q
(cid:5)
i=1
(1)
as it has a direct interpretation in terms of moments of order q of the distribution and has
also enjoyed a vigorous study of its properties [11,12,13,14,15] From these properties, it
follows that Tsallis entropy is better suited to deal with non-Gaussian measures, which
Beyond Shannon: Characterizing Internet Trafﬁc
241
are well-known to characterize Internet trafﬁc [16,17,2], while Shannon’s entropy is
better adapted to Normal distributions. Note that this and other interesting aspects of
the Tsallis entropy are the reason why it has many applications to complex systems1.
2.1 Meaning of the Parameter q
When using the Tsallis entropy, there is not one Tsallis entropy but as many as there
are possible choices for q. Each q reveals different aspects of distributions used to char-
acterize the system under study. Before we take a closer look at the meaning of q, we
need to deﬁne what kind of distributions we want to use and how we get it. We start
with the deﬁnition of important terms used in the reminder of the paper:
– system: A (set of) network(s) described by an ensemble of network ﬂows
– feature: Any ﬂow property that takes on different values and whose characteriza-
tion using a distribution is potentially useful. Flow properties used in this study
are: source and destination IP address, source and destination port and origin and
destination Autonomous System (AS).
– element i: A speciﬁc instance of a feature (e.g., source IP address 10.0.0.1)
– activity ai: The number of occurrences of element i within a time slot of size T.
Slot sizes used for this study are: 5, 10 and 15 minutes.
– feature distribution: The probability distribution P [I = i] = pi = ai(cid:2)
j aj of, e.g.,
the feature source port. Note that pi can also be interpreted as relative activity of i.
These feature distributions serve as input for the Tsallis entropy calculation.
We now discuss the meaning of different values of q. First, it is essential to stress
that both q = 0 and q = 1 have a special meaning. For q = 0, we get n − 1, the
number of elements in the feature distribution minus one. For q = 1, the Tsallis entropy
corresponds to the Shannon entropy. This correspondence can be derived by applying
l’Hˆopital’s rule to (1) for q −→ 1. For other q’s, we see that (1) puts more emphasis on
those elements which show high (low) activity for q > 1 (q  1.
2.2 The Trafﬁc Entropy Spectrum
To leverage the full capabilities of Tsallis entropy, we introduce a new characterization
and visualization method called the Trafﬁc Entropy Spectrum (TES). The TES is a three
axis plot that plots the entropy value over time (ﬁrst axis) and for several values of q
(second axis). For convenient 2D presentation, the third axis (showing the normalized
entropy values) can be mapped to a color range. Hence, the TES illustrates the temporal
dynamics of feature distributions in various regions of activity, ranging from very low
activity elements for negative qs to high activity elements for q > 1.
But what values should be used for the parameter q and do they need to be tuned
to the characteristics of the network trafﬁc at a speciﬁc sensor? By experimenting with
1 See http://tsallis.cat.cbpf.br/biblio.htm for a complete bibliography
242
B. Tellenbach et al.
Fig. 1. Impact of changes to different regions of the distribution. Bottom: Baseline and target
distributions for low, medium and high activity regions. Top: Resulting TES when altering the
distribution in the respective region from the baseline to the target distribution in multiple, even
sized, steps.
traces from different sensors and years (2003 to 2008) showing largely differing trafﬁc
characteristics, we found that the selection q = −2,−1.75, ..., 1.75, 2 gives sufﬁcient
information to detect network anomalies in all of those traces. Large values q > 2 or
smaller values q  1
– medium activity: reducing the # of elements decreases entropy for −1 < q < 1
– low activity: reducing the activity of some elements increases entropy for q < −1
3 Methodology
For anomaly detection with real trafﬁc traces, we calculated the TES on the activity of
the following ﬂow features: Source- and destination IP address, source- and destination
ports, origin and destination Autonomous System. We did this for each of the protocols
TCP, UDP, ICMP and OTHERS separately.
3.1 Calculating the TES
The calculation of the TES is straightforward. We aggregated the sample distribution of
the various trafﬁc features over an interval of 5, 10 and 15 minutes. While the results
using the 15 minutes interval are much smoother, shorter intervals are better suited to
point out anomalies that last only tens of seconds or a few minutes. At the end of each
interval, we calculated the Tsallis entropy values for the different qs and stored them
for visualization using the TES. Note that with our selection of qs, we need to store a
set of 17 values per interval only.
After calculating the TES, we apply two different normalization methods to com-
pensate for the large absolute difference of the entropies for different q’s:
– Global normalization using the maximum and minimum entropy value for a given
maxSq−minSq . This
q during the observation period as follows Snormalized,q = Sq−minSq
maps all entropy values to the range [0,1].
– Normalization using the maximum and minimum entropy for a given q on a training
day, for instance before the anomaly under scrutiny. Here, we map entropy values
between the minimum and maximum of the training day to [0,1]. Other values are
either above 1 or below 0.
The TES based on global normalization is used to identify dominating changes. If such
a dominating change is present, it stands out at the cost of a decreased visibility of non-
dominating changes. The second normalization is used to assess whether changes stay
within the variations of the training day. Using the second normalization method, it is
easy to develop a simple anomaly detector. Values going below the minimum or above
the maximum of the training day, expose the anomalous parts of the TES only. Even
though this detection procedure is very straight-forward, our evaluation shows that this
simple method is already sufﬁcient for detecting and classifying critical anomalies in
network traces.
3.2 Anomaly Characterization
Malicious attacks often exhibit very speciﬁc trafﬁc characteristics that induce changes
in feature distributions known to be heavy-tailed. In particular, the set of involved values
per feature (IP addresses or ports) is often found to be either very small or very large.
In a DDoS attack, for instance, the victim is usually a single entity, e.g., a host or a
router. The attacking hosts, on the other hand, are large in numbers, especially if source
addresses are spoofed. Similarly, if a speciﬁc service is targeted by an attack, a single
244
B. Tellenbach et al.
destination port is used, whereas source ports are usually selected randomly. In general,
speciﬁc selection of victims or services leads to concentration on a feature and, in turn,
to a change in the high activity domain. In contrast, random feature selection results in
dispersion and impacts the low activity domain (e.g., spoofed IP addresses only occur
once in the trace). Knowing this, it is possible to proﬁle an attack based on the affected
activity regions for each feature.
4 Application on Network Traces
The data used in this study was captured from the ﬁve border routers of the Swiss
Academic and Research Network (SWITCH, AS 559) [18], a medium-sized backbone
operator that connects several universities and research labs (e.g., IBM, CERN) to the
Internet. The SWITCH IP address range contains about 2.4 million IP addresses, and
the trafﬁc volume varies between 60 and 140 million NetFlow records per hour. The
records are collected from ﬁve different border routers which do not apply any sam-
pling or anonymization. We study the effect of TES using ﬁve well-understood events:
– Reﬂ. DDoS: A reﬂector DDoS attack involving 30,000 reﬂectors within the
SWITCH network, used to attack a web server. Two weeks of trafﬁc were analyzed
including some preliminary scanning activity (April 2008). Figure 2(a) shows the
TES for incoming DstIPs. The attack is clearly visible around 04/11 and lasts for
almost one day. Figure 2(b) shows the effective activity of the reﬂectors during a
two-week period. The sustained activity on 04/04 and 04/05 without attack ﬂows
suggests that attackers are scanning the network for potential reﬂectors.
– DDoS 1: A short (10 min.) DDoS attack on a router and a host with 8 million
spoofed source addresses (Sept. 2007). DstPort is TCP 80. Figure 2(c) plots the
TES for incoming Autonomous System (AS) numbers. The attack is nicely visible
for q < 0 on the 09/01. Although the covered period is 8 days, the attack is visible
with an excellent signal to noise ratio and no false alarms. Note that for Shannon
entropy (q = 1) the peak is insigniﬁcant.
– DDoS 2: A long (13h) DDoS attack on a host with 5 million spoofed source ad-
dresses (Dec. 2007/Jan. 2008). DstPort is TCP 80.
– Blaster Worm: Massive global worm outbreak caused by random selection/
infection of new hosts, exploiting a RPC vulnerability on TCP DstPort 135 (Aug.
2003).
– Witty Worm: Fast spreading worm exploiting a vulnerability in ISS network secu-
rity products. Uses UDP SrcPort 4000 and random DstPort (March 2004).
4.1 Patterns in Real Trafﬁc
In this Section we analyze the spectrum patterns exhibited by the attacks described
previously. For describing these patterns we use a shorthand notation representing the
state of Sq with respect to the thresholds by a single character cq:
⎧
⎨
cq =
⎩
‘+’ if Sq ≥ max Sq of the training day (positive alert)
‘-’ if Sq ≤ min Sq of the training day (negative alert)
‘0’ else (normal conditions)
Beyond Shannon: Characterizing Internet Trafﬁc
245
2
1.5
1
0.5
q
0
−0.5
−1
−1.5
−2
04/03 04/04 04/05 04/06 04/07 04/08 04/09 04/10 04/11 04/12 04/13
)
s
r
o
t
c
e
l
f
e
r
e
v