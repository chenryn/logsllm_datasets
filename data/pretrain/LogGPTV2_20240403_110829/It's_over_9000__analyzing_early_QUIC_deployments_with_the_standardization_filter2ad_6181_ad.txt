14 M
Figure 6: Supported individual QUIC versions from ZMap
scans. Other combines versions with an occurrence of less
than 1 %.
set only containing the string quic. The most common set only con-
sists of IETF QUIC versions, namely h3-27,h3-28,h3-29. It is mainly
used by Cloudflare, besides 269 additional ASes, and thus already
covers a majority of domains. Interestingly, the deployment of IETF
“Version 1” from Cloudflare seen in Figure 5 cannot be seen based
on the HTTP ALT-SVC Header during our measurement period.
Even though Google itself is only the sixth common AS based on
HTTP ALT-SVC Header data, the second most common set is h3-
25,h3-27,h3-Q043,h3-Q046,h3-Q050,quic, containing Google QUIC
versions and older IETF QUIC versions. It is used by 1.7 k ASes.
However, over time a slight shift towards a new set including ALPN
h3-27,h3-29 and h3-34 besides Google QUIC versions can be seen
for targets in 444 ASes. The set only consisting of quic was used
more often at the beginning of our measurement period but mainly
lost its share towards the end.
Regarding the ALPN sets retrieved from HTTPS DNS RRs, 99.9 %
of the domains resolve to records including h3-29, h3-28, h3-27, the
majorly used set from Cloudflare. As one of the driving forces be-
hind the HTTPS DNS RR, Cloudflare is also dominating this dataset.
Key take-away. We find that based on announced versions,
existing QUIC deployments were well-prepared for the final stan-
dardization of QUIC. Throughout our measurement period, the
support for draft 29, the final draft supposed to be deployed [22], in-
creased to 96 %. The activation of “Version 1” by Cloudflare but also
other ASes even before the official conversion of the draft to an RFC
shows that deployments were ready for the final standardization of
IETF QUIC.
5 THE STATE OF QUIC DEPLOYMENTS
To analyze found QUIC deployments in more detail, we use the
QScanner to complete QUIC handshakes with targets from ZMap,
HTTP ALT-SVC Headers and HTTPS DNS RRs. We extract QUIC
specific parameters, TLS configurations and HTTP headers.
For HTTP ALT-SVC Headers and HTTPS DNS RRs we only scan
with SNI as we expect higher success rates and know at least one
domain per IP address that indicates reachability using QUIC. As
explained in Section 4, for 90 % of IPv4 and 38 % of IPv6 addresses,
no domains were found by joining the data with our DNS scans.
Therefore, we scan addresses from ZMap also without SNIs to test
whether a QUIC connection can be established and to check the
default behavior of targets without SNI.
To reduce the scan overhead, we only select targets, that an-
nounced a version compatible with the QScanner, namely draft 29,
32 and 34 (see Section 3.4). Similar to the results from Section 4 we
use scans from calendar week 18 (May 3, 2021 until May 09, 2021).
General results are shown in Table 3.
NO SNI Scan. We scan 2 046 615 IPv4 (95.9 % of found IP ad-
dresses with ZMap) and 209 729 IPv6 addresses (99.4 %). For IPv4,
7.25 % or 148 281 connection attempts are successful, 34.5 % time
out and 50 % result in the generic QUIC Alert 0x128, more pre-
cisely the generic TLS Alert 0x28 [43]. For IPv6, 27.7 % or 58 002
connection attempts are successful, only 12.3 % time out and 60 %
result in the QUIC Alert 0x128. Messages for alert 0x128 differ
between scanned targets but do not reveal the exact reason why the
handshake failed. We identify that the exact wording of the error
message depends on their corresponding implementation, e.g., we
found the most prominent error message in the QUIC implementa-
tion from Cloudflare and the second most prominent string in the
library from Google. We investigate this further in comparison to
results from scans with SNI.
Interestingly, the handshake failed for 180 k (9 %) IPv4 addresses
and 1.5 k (0.7 %) IPv6 addresses due to a version mismatch. While
these addresses indicated during the ZMap scan to support a version
compatible to the QScanner, the stateful scan failed with a version
mismatch, i.e., none of the offered versions are supported. 99 % of
these are part of AS15169 or AS396982, both operated by Google.
We re-scanned a subset of these targets with the ZMap module and
the QScanner and found that the mismatch between version nego-
tiation and QUIC handshake was reproducible and constant over
a period of time. However, in August 2021, the behavior changed,
and version mismatches can not be seen anymore. We talked about
our observation with Google and concluded that observed inconsis-
tencies were most likely due to an iterative roll-out of IETF QUIC
within the Google network. Due to the complete deployment of
268
OtherQ039Q043Q046Q048Q050Q099T048T051draft-27draft-28draft-29ietf-01mvfst-1mvfst-2mvfst-e020406080100VersionSupportinPercentCalendarWeek5791114151618It’s Over 9000: Analyzing Early QUIC Deployments with the Standardization on the Horizon
IMC ’21, November 2–4, 2021, Virtual Event, USA
Figure 7: QUIC related ALPN values for domains from successful TLS-over-TCP IPv4 scans over several calendar weeks (x-axis)
in 2021. Other combines all sets with an occurrence of less than 1 %.
Table 4: Individual success rate per input. Due to an over-
lap between sources, targets do not sum up to total scanned
targets.
Source
ZMAP + DNS
ALT-SVC
HTTPS
IPv4
Targets
14.4 M
14.1 M
6.2 M
Success
85.6 %
85.2 %
77.6 %
IPv6
Targets
14.1 M
13.7 M
6.0 M
Success
85.3 %
84.9 %
77.0 %
Figure 8: AS distribution of successfully scanned targets (Note
the y-axis does not start at 0).
IETF QUIC by most Google services, these inconsistencies are not
seen during new scans anymore.
As shown in Figure 8, IPv4 addresses with a successful scan still
cover more than 4.4 k ASes (93.1 % of all seen ASes) even though
the success rate is 7.25 %. Successful IPv6 address scans reach a
similar coverage with at least one successful target in 92.6 % of the
seen ASes.
SNI Scans. We combine found targets from all three sources for
our scans with SNI. Besides filtering for targets with supported
versions, we reduce the number of scanned domains per IP address
to a maximum of 100 domains from each source for SNI scans as
described in Appendix A. Therefore, we scanned 17 357 269 IPv4 tar-
gets consisting of 417 708 addresses in combination with 13 290 754
domains and 14 170 532 IPv6 targets consisting of 344 362 addresses
and 10 176 968 domains.
The total IPv4 scan reaches a success rate of 76.1 % while 11.1 %
of connection attempts time out, 5.7 % result in the QUIC alert
0x128 and another 5.8 % fail due to a version mismatch similar
to the scan without SNI (see Table 3). The 13 M successful targets
only account for 110 k addresses, 26.5 % of all scanned addresses.
Furthermore, they are only part of 1.6 k ASes and 82.3 % are part
of Cloudflare (AS13335).
Considering the IPv6 scan, the success rate is comparably high
with 90.7 % but this only includes 90 k distinct addresses from 546
ASes. The most common errors are the QUIC alert 0x128, a timeout
and no compatible QUIC version in that order.
All three sources contribute to successful targets as shown in
Table 4. We scanned 14 M million targets with IPv4 but also with
IPv6 addresses each, from (i) ZMap joined with DNS and (ii) HTTP
ALT-SVC Header with a respective success rate of 85 %. ZMap
covers 105 k and HTTP ALT-SVC Headers cover 85 k distinct IPv4
addresses respectively. HTTPS DNS RR results in only 6.2 M targets
based on IPv4 and IPv6 addresses respectively and reaches success
rates of 77 %.
Key take-away. While many QUIC deployments can be found
using stateless measures from Section 4, successful handshakes can
269
101112131415161718020406080100SupportedALPNinPercent10111213141516171801234SupportedALPNinTotal×107quich3-27,h3-29,h3-34,h3-Q043,h3-Q046,h3-Q050,quich3-27,h3-28,h3-29h3-25,h3-27,h3-Q043,h3-Q046,h3-Q050,quicOther100101102103ASRank0.40.60.81.0CDF[IPv4]noSNI[IPv6]noSNI[IPv4]SNI[IPv6]SNIIMC ’21, November 2–4, 2021, Virtual Event, USA
Johannes Zirngibl, Philippe Buschmann, Patrick Sattler, Benedikt Jaeger, Juliane Aulbach, and Georg Carle
only be established to a subset of found hosts. The most unexpected
error is the version mismatch for many targets from Google. While
IETF versions are announced during the version negotiation, suc-
cessful handshakes fail. After a discussion with Google, we were
able to link the observed behavior, to an iterative roll-out of IETF
QUIC throughout Google network services. While connection at-
tempts have been impacted throughout the roll-out period, it was
only temporary and a resolution of the error is visible with the
deployment of the finally standardized version.
We argue that the large number of timeouts is either due to load
balancers or due to the high duration of ZMap scans (see Section 3.1)
and thus the large interval between version negotiation and stateful
handshake for some targets. If HTTPS DNS RRs are deployed more
widely in the future, it offers a reliable method to quickly detect
QUIC service endpoints in the future and reduce the overall scan
overhead for further studies drastically.
5.1 QUIC TLS Behavior compared to TLS over
TCP
TLS is an intrinsic part of QUIC. Furthermore, due to changed
requirements, e.g., the new Transport Parameters extension and
the necessity to use TLS 1.3, many QUIC implementations rely on
custom TLS libraries. As a consequence, services reachable using
QUIC and TLS over TCP might use different TLS stacks and con-
figurations. Therefore, we evaluate the deployment of TLS as part
of QUIC and compare it to TLS over TCP measurements for the
same targets. As reported in Table 3, the stateful no SNI QUIC scans
exhibit a low success rate. Our TLS over TCP scans can perform a
successful TLS handshake for 43 % IPv4 and 50 % of the IPv6 targets.
We analyzed this substantial difference and found that it is caused
by only a handful providers. Google, Akamai, Cloudflare, and Fastly
are nearly evenly responsible for more than 80 % (600 k) of cases
where the TLS over TCP scan succeeds but the QUIC scan fails. We
evaluated the QUIC scan errors in order to get more insight into
parallel deployments and to rule out any error in our stateful QUIC
scanner. While the Google errors are caused by a version mismatch
as already described before, Akamai and Fastly run into a timeout
using QUIC. We assume these timeouts are due to a similar reason
Google returns IETF QUIC versions in the version negotiation but
cannot complete a handshake afterwards. The same behavior could
be observed for the same targets in multiple scans. In contrast,
Cloudflare returns the TLS alert 0x128 reporting a handshake fail-
ure in these cases. As we are able to perform a successful QUIC
scan with other Cloudflare IP addresses, we assume this is an issue
on Cloudflare’s side. To rule out any CDN specific issues with the
no SNI scans we joined the failing IP addresses with any targets
on the same address in our SNI scan. We found 42.5 k IP addresses
in our SNI scan. We performed a successful QUIC handshake to
only 2.8 k of these. Therefore, it seems most of these addresses
are not actively used to deploy QUIC but are rather an artifact of
CDN architectures. This enforces our idea of an early middlebox
answering the QUIC version negotiation with the end hosts not
being able to actually complete such a handshake.
We find a small number (less than 0.5 %) of targets successfully
completing a QUIC scan but resulting in an error on the TLS over
TCP scan. As this does not represent a relevant share and could
Table 5: Share of hosts (%) using the same TLS properties
on TLS over TCP and QUIC. All properties after the TLS
version are made on targets where the TLS over TCP scan
also performed a TLS 1.3 handshake.
IPv4
IPv6
Certificate
TLS Version
Key Exchange Group
Cipher
Extensions
no SNI
31.7
99.6
100.0
99.2
67.3
SNI
98.1
99.7
100.0
100.0
99.9
no SNI
17.7
99.8
100.0
100.0
56.4
SNI
98.2
99.7
100.0
100.0
99.9
also be caused by the two scans not running in parallel, we do not
investigate it further.
In Table 5 we compare the TLS over TCP scans with the QUIC
results. The comparison of returned certificates can provide insights
into the deployment strategy. We evaluate whether the certificate
collected by the QUIC scan is used for the same set of domains as
with the TLS over TCP scan. With the SNI scan we find more than
98 % of all targets returning the same certificate for QUIC but also
TLS over TCP. Some certificates differ due to the delay between
QUIC and TLS over TCP scans. However, we see a different picture
for the no SNI scans. Only 31.7 % and 17.7 % of the targets for IPv4
and IPv6 respectively return the same certificates. Our evaluation
of this artifact revealed that Google returns a self signed certificate
with the common name indicating an error due to the SNI missing
on TLS over TCP. When a QUIC handshake is performed to the
same target, it returns a valid certificate. Moreover, we see the effect
of Google rolling its certificates about weekly [6] which produces
further certificate mismatches between QUIC and TLS over TCP.
We find few IP addresses which only offer TLS 1.2 over TCP
while QUIC uses at least TLS 1.3 [43]. As QUIC implementations
need a modified TLS library they often include it into their software
while traditional HTTPS over TCP web servers usually allow the
configuration of a TLS library. Therefore, the versions and exact
deployment configurations can differ. We find that 99.7 % of all
targets use the same TLS version (i.e., TLS 1.3). The single most
contributor to differing TLS versions is Cloudflare. We investigated
this and found that using Cloudflare, it is possible to disable TLS 1.3
but enable QUIC. Moreover, we found that Cloudflare enables QUIC
by default, which might be a reason for this behavior. To our knowl-
edge there is no other reason to disable TLS 1.3 but enable QUIC.
As QUIC requires TLS 1.3, a comparison of TLS ciphers, key
exchange groups and extensions is only useful if the chosen TLS
over TCP version is the same. In order to have comparable results
we made sure to send the same TLS Client Hello with our QUIC
and TLS over TCP scanner. We offer the X25519 key exchange
group which is accepted by close to all targets (e.g., 206 of IPv4 SNI