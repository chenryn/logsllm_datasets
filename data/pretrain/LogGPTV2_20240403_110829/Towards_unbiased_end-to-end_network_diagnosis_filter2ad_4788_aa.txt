title:Towards unbiased end-to-end network diagnosis
author:Yao Zhao and
Yan Chen and
David Bindel
1724
IEEE/ACM TRANSACTIONS ON NETWORKING, VOL. 17, NO. 6, DECEMBER 2009
Towards Unbiased End-to-End Network Diagnosis
Yao Zhao, Yan Chen, and David Bindel
fault diagnosis
Abstract—Internet
is extremely important
for end-users, overlay network service providers (like Akamai
[1]), and even Internet service providers (ISPs). However, be-
cause link-level properties cannot be uniquely determined from
end-to-end measurements, the accuracy of existing statistical
diagnosis approaches is subject to uncertainty from statistical
assumptions about the network. In this paper, we propose a
novel least-biased end-to-end network diagnosis (in short, LEND)
system for inferring link-level properties like loss rate. We deﬁne
a minimal identiﬁable link sequence (MILS) as a link sequence of
minimal length whose properties can be uniquely identiﬁed from
end-to-end measurements. We also design efﬁcient algorithms
to ﬁnd all the MILSs and infer their loss rates for diagnosis.
Our LEND system works for any network topology and for both
directed and undirected properties and incrementally adapts to
network topology and property changes. It gives highly accurate
estimates of the loss rates of MILSs, as indicated by both extensive
simulations and Internet experiments. Furthermore, we demon-
strate that such diagnosis can be achieved with ﬁne granularity
and in near real-time even for reasonably large overlay networks.
Finally, LEND can supplement existing statistical inference ap-
proaches and provide smooth tradeoff between diagnosis accuracy
and granularity.
Index Terms—Internet diagnosis,
measurement.
linear algebra, network
I. INTRODUCTION
“WHEN something breaks in the Internet, the Internet’s
very decentralized structure makes it hard to
to assign
ﬁgure out what went wrong and even harder
responsibility.”—“Looking Over the Fence at Networks: A
Neighbor’s View of Networking Research,” by the Committee
on Research Horizons in Networking, National Research
Council, 2001.
Internet fault diagnosis is important to end-users, overlay
network service providers (like Akamai [1]), and Internet
service providers (ISPs). For example, with Internet fault
diagnosis tools, users can choose more reliable ISPs. Overlay
service providers can use such tools to locate faults in order
to ﬁx them or bypass them; information about faults can also
guide decisions about service provisioning, deployment, and
Manuscript received July 05, 2006; revised September 12, 2007 and
September 03, 2008; approved by IEEE/ACM TRANSACTIONS ON NETWORKING
Editor D. Raz. First published September 29, 2009; current version published
December 16, 2009. A subset of this work appears in the Proceedings of ACM
SIGCOMM’06.
Y. Zhao and Y. Chen are with the Department of Electrical Engineering and
Computer Science, Northwestern University, Evanston, IL 60208 USA (e-mail:
PI:EMAIL; PI:EMAIL).
D. Bindel is with the Department of Computer Science, Cornell University,
Ithaca, NY 14853 USA (e-mail: PI:EMAIL).
Color versions of one or more of the ﬁgures in this paper are available online
at http://ieeexplore.ieee.org.
Digital Object Identiﬁer 10.1109/TNET.2009.2022158
redirection. For ISPs, diagnosis tools can be used to verify ser-
vices from provider/peering ISPs and to troubleshoot problems
with the physical network.
The modern Internet is heterogeneous and largely unregu-
lated, which renders link-level fault diagnosis an increasingly
challenging problem. The servers and routers in the network
core are usually operated by businesses, and those businesses
may be unwilling or unable to cooperate in collecting the
network trafﬁc measurements vital for Internet fault diagnosis.
Therefore, most research in this area is focused on end-to-end
approaches.
Internet tomography is an important approach to fault diag-
nosis in which link properties [2]–[5] or shared congestion [6]
are inferred from end-to-end measurements. In many of these
systems, path properties are assumed to be linearly related to
link quantities. For example, the latency along a path is the sum
of the latencies along the links that make up the paths, and we
may write this fact as a matrix equation relating unknown link
latencies to measured path latencies. However, as we observed
in [7], [8], the linear system is fundamentally underconstrained:
There exist unidentiﬁable links with properties that cannot be
uniquely determined from path measurements.
Because of the challenge of unidentiﬁable links, existing to-
mography systems must make certain assumptions in order to
infer the property of each link. These modeling assumptions
may not always hold in the Internet, and so these systems will
have systematic inference errors with nonzero expected value.
In other words, the error in the model assumptions prevents
the inference error from converging to zero, even when there
are many measurements available. We call this modeling error
bias, and we call the problematic statistical assumptions biased
assumptions.
In this paper, we advocate a different paradigm for network
diagnosis: unbiased diagnosis. Note that there are two funda-
mental statistical assumptions for any end-to-end network diag-
nosis approach:
(cid:129) End-to-end path properties can be measured accurately.
(cid:129) The properties of each path are a known linear function of
the properties of the link on the path.
Though these assumptions work well
in practice (see
Section III-A), they may still introduce some bias. However,
this is the minimal amount of bias for any end-to-end diagnosis
scheme. We call these assumptions basic assumptions. In this
paper, we aim to only use the basic assumptions to achieve
the least biased diagnosis. We deﬁne a minimal identiﬁable
link sequence (MILS) as a link sequence of minimal length
whose properties can be uniquely identiﬁed from end-to-end
measurements without bias. We then propose the least-biased
end-to-end network diagnosis (LEND) system, which uses
linear algebra to ﬁnd MILSs and infer their properties. Our
LEND system achieves the ﬁnest diagnosis granularity possible
without additional assumptions.
1063-6692/$26.00 © 2009 IEEE
ZHAO et al.: TOWARDS UNBIASED END-TO-END NETWORK DIAGNOSIS
1725
Fig. 1. The spectrum of network diagnosis methods.
When combined with statistical inference, our approach
gives a full spectrum of network diagnosis methods with
smooth tradeoff between diagnosis accuracy and diagnosis
granularity,1 as shown in Fig. 1. Because of the unidentiﬁable
link problem, LEND cannot infer properties for each link.
However, with more and stronger statistical assumptions, we
can reduce the diagnosis granularity while introducing more
bias and sacriﬁcing diagnosis accuracy.
An interesting problem that we faced when designing the
LEND system is that our inference methods behave much differ-
ently on directed graphs than they do on undirected graphs. For
a simple network with symmetric link properties,2 the network
can be modeled as an undirected graph in which the nodes are
connected by undirected links. For networks modeled as undi-
rected graphs, we can use routing information to get the MILSs
that are uniquely deﬁned by the inherent path sharing of the
networks, and we propose efﬁcient algorithms to ﬁnd all such
MILSs. However, the real Internet has asymmetric link proper-
ties (e.g., loss rate), and so must be modeled as a directed graph.
However, to ﬁnd the MILSs in a directed graph is signiﬁcantly
more challenging.
In this paper, we make the following contributions in the al-
gorithm design.
(cid:129) We advocate the unbiased end-to-end diagnosis paradigm
and introduce the concept of MILS.
(cid:129) Taking a network as a directed graph, when only topology
information is used, we prove that each path is a MILS:
No path segment smaller than an end-to-end path has
properties that can be uniquely determined by end-to-end
measurements.
(cid:129) To address the problem above, we observe that, in prac-
tice, there are many good paths with zero loss rates. Then,
as a fact rather than a statistical assumption, we know all
the links on such paths must also have no losses. Based
on this observation, we propose a “good path” algorithm,
which uses both topology and measurement snapshots to
ﬁnd MILSs with the ﬁnest granularity.
(cid:129) We design efﬁcient algorithms to incrementally update
the MILSs and their loss rate estimates when the network
topology or overlay measurement nodes change.
(cid:129) We show that our approach complements other tomog-
raphy techniques—it helps signiﬁcantly reduce their com-
plexity and improves their inference accuracy.
We evaluate the LEND system through extensive simulations
and Internet experiments. Both give promising results. We
deﬁne the diagnosis granularity of a path as the average of the
1We deﬁne diagnosis accuracy as the inference accuracy of the properties
of the link sequences and diagnosis granularity as the length of the smallest
consecutive link sequences whose properties are inferred. Formal deﬁnitions
are in Section VI-A.
2A link property between routers A and B is symmetric if A  ! B has the
same property as link B  ! A.
lengths of all the lossy MILSs contained in the path. For the
experiments with 135 PlanetLab hosts (each from a different
organization), the average diagnosis granularity is only four
hops for all the lossy paths. This can be further improved with
larger overlay networks, as shown through our simulation with
a real router-level topology from [9]. This suggests we can do
very ﬁne-level accurate diagnosis with reasonably large overlay
networks.
In addition, the loss rate inference on the MILSs is highly
accurate, as veriﬁed through the cross-validation and IP spoof-
based validation schemes. The LEND system is also highly efﬁ-
cient. For the PlanetLab experiments with 135 hosts, the average
setup (monitoring path selection) time is 109.3 s, and the online
diagnosis of 18 090 paths, 3714 of which are lossy, takes only
4.2 s.
The rest of the paper is organized as follows. In Section II,
we survey related work. Then, we deﬁne MILSs in Section III,
present algorithms to discover MILSs in Section IV, and de-
scribe how we validate our approach in Section V. We describe
our evaluation of LEND in simulation in Section VI and the
evaluation on an Internet testbed in Section VII. We discuss our
results in Section VIII and conclude in Section IX.
II. RELATED WORK
Ping and traceroute are the earliest Internet diagnosis tools,
and they are still widely used. However, the asymmetry of In-
ternet routing and of link properties makes it difﬁcult to use
these tools to infer properties of individual links. The latest
work on network diagnosis can be put into two categories: pure
end-to-end approaches [2]–[5], [7], [10], [11] and router-re-
sponse-based approaches [12], [13].
A. Pure End-to-End Approach
Most end-to-end tomography tools fall in one of two classes:
tools that are based on temporal correlations among multiple
receivers in a multicast-like environment [2]–[4], [10], [11] and
tools that impose additional statistical assumptions beyond the
linear loss model described in Section III-A [5], [7]. As we dis-
cuss below, none of these tools provides unbiased diagnosis as
deﬁned in Section I. As evidence of the utility of least-unbiased
diagnosis, we show in Section VI that our inference is much
more accurate than the inference of one statistical tool based on
Gibbs sampling introduced in [5].
Under certain assumptions, tools in the ﬁrst class infer a loss
rate for each virtual link (i.e., sequence of consecutive links
without a branching point) with high probability. Thus, these
tools diagnose failures at the granularity of individual virtual
links; obviously, this is a bound on the granularity obtainable
by the end-to-end tomography system. Typically, these systems
assume an ideal multicast environment, but since true multicast
is very rare in the Internet, they use unicast for approximation.
Thus, the accuracy of the probe measurements heavily depends
on the cross trafﬁc in the network, and there is no guarantee of
their accuracy.
As for the second class of tools, the statistically based tools
introduced in [5] and [7] use only uncorrelated end-to-end mea-
surements to identify lossy network links. To see why these tools
are insufﬁcient, we consider a simple tree topology, shown in
Fig. 2. The numbers in the ﬁgure are the loss rates of the cor-
responding paths or links. In this tree, we can only measure
1726
IEEE/ACM TRANSACTIONS ON NETWORKING, VOL. 17, NO. 6, DECEMBER 2009
TABLE I
NOTATION
Fig. 2. Example of an underconstrained system.
and
the loss rates of two paths:
. In the ﬁgure,
(a) and (b) show two possible link loss rates that lead to the
same end-to-end path measurements. The linear programming
approach in [5] and SCFS [7] will always obtain the result of
(a) because they are biased toward minimizing the number of
lossy link predictions, but such results may not be correct. As
for the random sampling and Gibbs sampling approaches in [5],
either (a) or (b) may be predicted. In fact, none of the loss rates
for these three links are identiﬁable from end-to-end measure-
ments. The LEND system will determine that none of the indi-
vidual links are identiﬁable and will get MILSs
and
.
Other than the aforementioned two classes, Shavitt et al. use
a linear algebraic algorithm to compute some additional “dis-
tances” (i.e., latencies of path segments) that are not explicitly
measured [14]. The algorithm proposed in [14] has the same
function as our link-level diagnosis algorithm in undirected
graph model. However, our LEND system incorporates the
scalable measurement approach designed in [8] and reuses its
outputs to save the computational complexity for link-level
diagnosis, and our LEND system is hence both measurement
cost-efﬁcient and computation-efﬁcient. More importantly, the
Internet should be modeled as a directed graph, in which the
algebraic algorithm in [14] fails to do any link-level diagnosis,
shown in Theorem 1 (see Section IV-C-I).
B. Router-Response-Based Approach
All the router-based approaches to network diagnosis are
based on response packets sent by interior routers. Unfortu-
nately, interior routers may be unwilling to respond or may
respond in an insufﬁciently informative manner. For example,
because many routers implement ICMP ﬁltering or ICMP rate
limiting, some ICMP-based tools [12], [13] cannot measure
the loss rate on each link. These systems also do not scale well
to the task of simultaneously measuring many paths in a large
overlay network; furthermore, the accuracy of measurements
may be affected by ICMP cross trafﬁc [12].
Tulip, the latest representative of this router-based approach
[12], cannot accurately infer the loss rates of links or link se-
quences because of the following two problems. First, a Tulip
probe involves two small ICMP packets and one large UDP
data packet. To identify whether the loss happens on the for-
warding path or not, Tulip only takes into account the case when
only UDP packets are lost. About 40% of the time, a loss in-
volves one of the ICMP packets as well. Tulip simply ignores
these cases and consequently underestimates overall loss rates
by about 40% [12]. Second, Tulip is sensitive to other simul-
taneous measurement probes. Tulip requires continuous IP-IDs
of replies from the probed router, and it may fail to get accurate
loss rate if other measurements (e.g., another instance of Tulip)
probe the router at the same time.
III. MODELS AND ARCHITECTURE
In this section, we brieﬂy describe the algebraic model and the
system architecture of the LEND system. The algebraic model
is widely used in Internet tomography and other measurement
works [3], [8], [14]. However, the techniques for diagnosis re-
quire a signiﬁcant amount of extra design over this framework,
as we will describe in the paper—e.g., the MILSs introduced in
Section IV-A.
A. Algebraic Model
Here, we brieﬂy introduce the algebraic model that is widely
used in network diagnosis. For easy indexing, all the impor-
tant notations in the paper can be found in Table I.3 Suppose
IP links. We represent a path by a
an overlay network spans