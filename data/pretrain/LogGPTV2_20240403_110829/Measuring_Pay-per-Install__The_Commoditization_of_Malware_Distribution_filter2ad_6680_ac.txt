Table 2: Number of downloads and distinct MD5s col-
lected from each PPI service, starting August 1, 2010
and ending February 1, 2010.
isting clustering systems for domain names [26], HTTP
requests [25], and similar communication patterns [11],
our system must accommodate any type of C&C, includ-
ing custom binary protocols. In this work we therefore
use our own, simple, clustering method, based primar-
ily on manual inspection, but forsee integrating other ap-
proaches as the need arises.
Our clustering ﬁrst groups all executables with identi-
cal features into a single cluster, with the list of features
acting as the initial cluster signature. We then manually
merge similar clusters, assigning the new cluster a signa-
ture of simply the disjunction of the signatures of each
merged cluster. Using this process on the August 2010
milk, we identify 57 clusters. The cluster signatures vary
from a domain list—of limited value due to continual up-
dates to C&C domains—to binary and HTTP signatures
that prove more useful long-term.
For tagging, we prioritize clusters by the total number
of times we milked them. For each cluster we manually
check if we can ﬁnd labeled trafﬁc that matches the clus-
ter signature in public repositories and malware analysis
reports. If so, we change the cluster tag to match the pub-
licly available name. This process is painful due to the
disparity of names used for the same families (and bina-
ries) in the community. We were able to tag 35 of the
57 clusters. In Section 4.1 we describe the results from
our classiﬁcation.
4
Insights into the PPI Business
We now present results from our inﬁltration by analyz-
ing the executables we collected. We began our milking
operations on August 1, 2010. As of February, 2011,
we downloaded 1,060,895 client executables, yielding
9,153 distinct binaries during approximately 6 months
of inﬁltration. The modest proportion (0.8%) of unique
executables arises due to our frequent milking, and the
fact that our geo-diverse milking frequently retrieves the
same executable from multiple locations. We began
CLASS PPI
FAMILY
Rustock
61,017
LoaderAdv-ack
60,770
CLUSTER: A
11,758
Hiloti
10,045
CLUSTER: B
8,194
Gleishug
7,620
Nuseek
5,802
Palevo2
16,101
Securitysuite
15,403
Zbot
3,684
CLUSTER: D
5,723
SmartAdsSol.
18,317
Spyeye
4,522
Securitysuite-avm 4,732
Grum
2,974
Tdss
4,893
Otlard
677
Blackenergy1
1,135
Palevo
2,594
Harebot
1,617
MILKED DIST. DAYS
spam L
31
31
ppi L
31 clickfraud G
31
ppi L
31
? G
31 clickfraud L
30 clickfraud G
29
29
29
28
26
25
20
20
19
16
15
14
14
15
62
8
43
9
15
2
21
100
49
1
6
16
45
54
12
7
15
2
13
fakeav L
spam G,L
ppi G,L
botnet G,L
botnet G,L
fakeav L
infosteal G,L
? G
adware L
infosteal G,L
ddos L
botnet G
botnet G,L,V
Table 3: Top 20 malware families we milked during Au-
gust 2010. The columns indicate the total number of
executables milked, distinct executables per family, the
number of days seen, the families’ general class, and
PPI services that distribute the family: LoaderAdv (L),
GoldInstall (G), Virut (V).
our inﬁltration with LoaderAdv, GoldInstall, and Virut,
adding Zlob in Jan. 2011. Table 2 shows the breakdown
of our harvest by PPI service. The download rate varies
across PPI providers since each PPI has a different num-
ber of endpoints to download malware and our milkers
access each through geo-diverse locations.
4.1 Family Classiﬁcation
We developed a set of classiﬁcation signatures and vetted
them based on extensive manual analysis of the 313,791
executables we milked during August 2010. These signa-
tures classify 92% of the total August downloads. If we
then apply these same signatures to milk from September
2010, the proportion matched only diminishes to 86%,
and for October 2010, 77%. Thus, in terms of classi-
fying the most prevalent downloads, the power of such
milk-derived signatures decays fairly slowly with time.
(Certainly we do expect their power to diminish, how-
ever, as PPI providers acquire new clients, and existing
clients release variants of their malware that no longer
manifest the behavior targeted by our signatures.)
For the 8% of August downloads unmatched by our
signatures, we have assigned a general label reﬂecting
absence of any generated trafﬁc. We manually evaluated
the behavior of 243 executables in this group and con-
ﬁrmed that the executables appear corrupted and do not
execute. We also ran most on bare hardware and con-
ﬁrmed that their failure to execute does not reﬂect anti-
virtualization checks.
While our signatures work quite effectively for classi-
fying the bulk of downloads, the picture changes if we in-
stead consider distinct binaries (only 0.6% of the overall
volume). For these, we classify only 36%. However, it
is unclear that this latter ﬁgure holds much signiﬁcance:
a single malware specimen whose behavior we have not
speciﬁcally classiﬁed can account for a large number of
failures to classify distinct binaries if the specimen hap-
pens to be repacked frequently.
To examine the malware families distributed by each
PPI provider, we limit our discussion to the August 2010
milk. Since the distributed malware changes over time,
focusing on a single month facilitates a clear presentation
of our results, while still spanning a signiﬁcant breadth
of activity. Table 3 lists the top 20 malware families we
milked during August 2010, the number of times milked,
the number of distinct executables, the number of days
we saw the family being dropped, the overall class for
the family’s predominant activity (“botnet” represents
generic malware platforms), and the different PPI ser-
vices that distributed the family.
Some of the malware families are crimeware kits
(Palevo2, Spyeye, Zbot, Bredolab), which means they
may be distributed by otherwise independent clients.
When computing statistics for individual clients, we thus
remove these kits to avoid potential aliasing. We observe
that out of the 20 malware families, 7 are distributed by
more than one PPI service. If we assume each (non-kit)
malware family belongs to one actor, the results show
that clients do not feel tied to a single PPI provider.
Distribution over time. Figure 4 shows distribution
timelines for each family we could label by activity class,
for August 2010. We visualize availability continuously
whenever a family was available at least once in three
hours. We make several observations. Programs push
clickbots at virtually all times, but DDoS platforms much
more sporadically. The latter perhaps reﬂects some sort
of Just-In-Time DDoS-for-hire service. With the ex-
ception of the GoldInstall-list downloader, we see PPI
downloaders pushed for weeks at a time. Spambots show
no uniform availability pattern:
relatively short-lived
push-outs for Pushdo and Grum, but continual push-outs
FAMILY
Rustock
LoaderAdv-ack
CLUSTER: A
Hiloti
CLUSTER: B
Gleishug
Nuseek
Palevo2
Securitysuite
CLUSTER: D
DAYS TO REPACK
# DISTINCT MEAN MIN MAX
2.12
8.51
0.00
2.21
0.00
7.14
7.46
2.63 12.34
0.76
0.00
2.58
4.42
0.34 23.62
3.57
0.00
8.60
14.08
5.04 23.13
1.77
0.00 10.15
0.37
0.00
1.17
28.22 28.22 28.22
15
62
8
43
9
15
2
21
100
1
Table 4: Repacking rates for the 10 most-milked fam-
ilies (Aug. 2010), excluding crimeware kits.
The
columns show the number of distinct binaries and the
mean/minimum/maximum time to repack, in days. A
minimum time of zero means that one of the distinct ex-
ecutables appeared in only a single milking instance.
for Rustock.
In the PPI setting, botmasters can afford
to push out their bots as convenient, which will keep
the installs relatively “silent”; by contrast, propagation
campaigns driven by social engineering (e.g., as used
by Storm [17]) require more careful design and timing.
4.2 Repacking Rate
The rate at which malware distributors repack their prod-
ucts reﬂects their concern about content-driven AV sig-
natures.
In this section we analyze the repacking rate
for the client programs that we milk, which are typically
repacked by the client themselves. In addition, we de-
scribe how the Zlob service repacks their afﬁliate down-
loader binaries on-the-ﬂy.
In the milk from August 2010, a malware family is
repacked on average at least once every 11 days. Ta-
ble 4 summarizes the individual repacking rate for the
top 10 families (excluding crimeware kits) milked in Au-
gust 2010. The data for the top 10 families shows that
they are repacked on average every 6.5 days. This indi-
cate that the top malware families are repacked more of-
ten than the average malware family. Among these fami-