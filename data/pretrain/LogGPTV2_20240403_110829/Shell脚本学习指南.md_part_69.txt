www.TopSage.com
---
## Page 405
Shell可移桂性议题与扩展
393
表14-1：$[var:?message)在bash与ksh93下的互动
命令
显示信息
接下来命令的执行
S bash x.sh
是
否
S ksh93 x.8h
是
bash$. x.eh
是
是
ksh93$.x.ob
是
否
这里指出，如果你确定脚本可以用点号命令执行，则你应该确保它在使用
$（variable:?message）架构之后便离开。
在for循环中，漏失循环项目
这部分很难解释，先看下面这个循环：
for i in $a Sb $c
do
执行一些操作
donie
如果三个变量都为空，则没有值给循环处理，Shell就静默地不作任何操作。就像
这么写循环一样：
for 1 in
什么事也设做！
do
执行一些操作
done
: -
然而，对大部分的BourneShell版本来说，真的这么编写循环会产生语法错误。不
过2001POSIX标准中，已将直接进入一个空循环的作法制定为合法。
当前版本的ksh93与bash都接受空的for循环，只是静默地不做任何事，不过这
是近期出现的功能，这两套Shell的旧版本以及原始的BourneShell，可能还是会
产生语法错误的信息。
DEBUG捕提，行为模式各异
ksh88与ksh93都提供特殊的DEBUG捕捉，以利Shell除虫与追踪。在ksh88下，
DEBUG的捕提是在每个命令执行之后发生，但在ksh93下，却是在命令执行之前
发生，到当前为止还好，较让人觉得混淆的是：bash早期版本遵循ksh88的行为
模式，但现行版本却是遵循ksh93，这点在13.3.2节里即已说明。
set的长与短选项
两个Shell下的set命令都接受额外的短选项与长选项，它们完整的set选项列于
表14-2。标注POSIX的项目在bash与Korn Shell中都可使用。
www.TopSage.com
---
## Page 406
394
表14-2：set的Shell选项
短选项-0形式
可用性叙述
G
-a
allexport
POSIX
导出所有接续的已定义变量。
-A
ksh88,
ksh93
数组指定，set+A不会清除数组。详见14.3.6
节。
-b
notify
POSIX
马上显示工作完成的信息，而不是等待下一个
提示，为交互式使用所设计。
-B
braceexpand
bash
启用括弧展开。默认值是启用的。详见14.3.4。
-C
noclobbex
POSIX
不允许>重导至已存在的文件，但>1运算符会
使此选项的设置无效。为交互式使用所设计。
=e
errexit
POSIX
当命令以非零状态离开而结束Shell.
-f
nog1ob
POSIX
停用通配字符展开。
-h
hashal1 (bash)
POSIX
在函数被定义时，找出及记得自函数主体中调
trackall(ksh)
用命令的位置，而不是在函数执行时微这件事
-H
histexpand
bash
启用：风格的历史展开。默认值是启用的。
-k
keyword
bash, ksh88,
将所有变量指定放进环境里，即便它们位居命
ksh93
令的中间，这是已过时的功能且不应该再使用。
=m
monitor
POSIX
启用工作控制（默认值是启用的）。为交互式使
用所设计。
=n
noexec
POSIX
读取命令并检查是否有语法错误，但不要执行
它们。交互模式下的Shell允许忽略此选项。
-P
privileged
bash,ksh88，
尝试在更安全的模式运作。细部的处理方式在
ksh93
各Shell间都有所不同，请参考你Shell的文件。
-P
physica1
bash
使用实体的目录结构，执行改变目录的命令。
ksh88，ksh93排序位置型参数。
bash，ksh88，
读取并执行命令然后离开。这是过时的用法，它
ksh93
是为了与BourmeShell的兼容性且不应该再使用。
=u
nounset
POSIX
将未定义的变量视为错误，而非null。
-V
verbose
POSIX
在命令执行之前，（逐字地）显示它们。
-X
xtrace
POSIX
在命令执行之前，显示它们（于展开之后）。
bgnice
ksh88，ksh93-自动地降低所有后台执行（带有&）之命令优先
权。
enacs
bash, ksh88,
使用emacs风格的命令列编辑。为交互式使用
ksh93
所设计。
www.TopSage.com
---
## Page 407
Shell可移植性议题与扩展
395
表14-2：set的Shell选项（续）
短选项-0形式
可用性
叙述
gma.cs
ksh88, ksh93
使用GNUemacs风格的命令列编辑。为交互式
使用所设计。
history
bash
启用命令历史功能，默认值为启用的。
ignoreeof
POSIX
停用Ctrl-D离开Shell.
markdirs
ksh88，ksh93执行通配字符展开时，将/附加到目录，
nolog
POSIX
停用对函数定义所执行的命令历史功能。
pipefai1
ksh93
令管道离开状志是上一个失败命令的状态，或
是如运作无误，则为零，仅ksh93n或更新版适
用。
posix
bash
启用全POSIX兼容功能。
vi
POSIX
使用vi式的命令列编辑。为交互式使用所设计。
viraw
ksh88，ksh93使用vi式的命令列编辑。为交互模式使用所设
计，此模式较set-Ovi更消耗使用CPU.
注：若你使用bash，我们建议美闭此功能。
14.2
bash的shop
bashShell除了可使用set命令的长选项与短选项之外，另还有shopt命令，可停用
与启用选项。
bash3.0版的选项列表如下。我们会针对每个选项，叙述当它们设置时·（启用时）的
行为模式：
cdab1e_vars
当cd的参数不是目录时，bash会将它视为变量名称，其值为目标目录，
cdspe11
如果cd至目录的操作失败，bash会试图进行多次微辐的拼字修正，看看是否能
找到真正的目录，如果找到正确的，它会显示名称，并切换至经运算过的目录。此
选项仅于交互式Shell下运作。
checkhash
当bash在路径查找之后找到命令，它会将路径查找的结果存储在杂凑表格中，此
举可加速下一次相同命令的执行。当命令第二次被执行时，bash便会执行存储于
杂凑表格里的命令，有了这个选项，bash会在执行它之前，先验证存储在杂凑表
格中的文件名真的存在。如果找不到，bash便会按照正规方式，进行路径查找。
www.TopSage.com
---
## Page 408
396
第14章
shopt (bash)
语法
shopt(-pqsu ][-o ][option-name ...]
用途
当Shell选项加入至bash时，进行集中控制，而非增生的set选项或Shell
变量。
主要选项
-0
限制选项为那些可以用set-O设置的。
-P
以选于重读的形式打印输出。
-Q
静默模式，其离开状态可指出选项是否被设置。以多选项而言，如果它们
都是启用的，则状态为零，否则即为非章。
=S
设置（启用）给定的选项。
解除设置（停用）给定的选项。
如果-S与-u不带指名的选项，则分别显示设置或解除设置的选项列表。
行为模式
控制各种内部Shell选项的设置，未带选项或使用-D时，则显示设至。使用
-D，会以可供稍后重读的形式显示设置。
登告
仅bash适用，ksh别否。
checkwinsize
在每个命令之后，bash都会检查窗口大小，并于窗口大小变更时，更新LINES与
COLUMNS变量。
cmdhist
bash将多行命令的所有行都存储于历史文件里。这使我们得以重新编辑多行命令。
dotglob
bash在文件名展开的结果里包含名称开头为.（点号）的文件。
www.TopSage.com
---
## Page 409
Shell可移植性议题与扩展
468
execfail
如果bash无法执行exec内置命令所给定的命令，则bash不会离开，见7.3.2
节。在任何状况下，如果exec失败，则交互式Shell不会离开。
expand_aliases
bash会展开别名。这是交互式Shell的默认值。
extdebug
bash启动除虫程序所需要的行为：
·declare-F为每个函数名称参数显示来源文件名与行编号。