YOU'D BETTER SECURE YOUR
YOU'D BETTER SECURE YOUR
BLE DEVICES OR WE'LL KICK
BLE DEVICES OR WE'LL KICK
YOUR BUTTS !
YOUR BUTTS !
@virtualabs | DEF CON 26, Aug. 12th 2018
WHO AM I ?
WHO AM I ?
  Head of R&D @ Econocom Digital Security
  Studying Bluetooth Low Energy for 3 years
  Developer & maintainer of BtleJuice
  Having fun with Nordic's nRF51822 ðŸ˜‰
AGENDA
AGENDA
BLE sniï¬€ing 101
Improving the BLE arsenal 
Sniï¬€ing BLE connections in 2018
Introducing BtleJack, a flexible sniï¬€ing tool
BtleJacking: a brand new attack 
How it works
Vulnerable devices & demos
Recommendations
BLE SNIFFING 101
BLE SNIFFING 101
MUCH CHEAP TOOLS,
MUCH CHEAP TOOLS, 
(NOT) WOW RESULTS
(NOT) WOW RESULTS
Sniï¬€ing existing/new connections with an
Ubertooth One
Sniï¬€ing new connections with an Adafruit's
Bluefruit LE Sniï¬€er
Sniï¬€ing BLE packets with gnuradio
Sniï¬€s existing and new connections
Does not support channel map
updates
Costs $120
UBERTOOTH ONE
UBERTOOTH ONE
Up-to-date soware (Nov. 2017)
Proprietary firmware from Nordic
Semiconductor
Sniï¬€s only new connections
Costs $30 - $40
BLUEFRUIT LE SNIFFER
BLUEFRUIT LE SNIFFER
Sniï¬€s only BLE advertisements
Unable to follow any
existing/new connection
Latency
Requires 2.4GHz compatible SDR
device
SOFTWARE DEFINED RADIO
SOFTWARE DEFINED RADIO
BLE SNIFFING 101
BLE SNIFFING 101
BLE is designed to make sniï¬€ing diï¬€icult: 
3 separate advertising channels
Uses Frequency Hopping Spread Spectrum
(FHSS)
Master or slave can renegotiate some
parameters at any time
Sniï¬€ing BLE connections is either hard or
expensive
MAN IN THE MIDDLE
MAN IN THE MIDDLE
HOW BLE MITM WORKS
HOW BLE MITM WORKS
Discover the target device (advertisement data,
services & characteristics)
Connect to this target device, it is not advertising
anymore (connected state)
Advertise the same device, await connections and
forward data
BTLEJUICE
BTLEJUICE
https://github.com/DigitalSecurity/btlejuice
GATTACKER
GATTACKER
https://github.com/securing/gattacker
Pros: 
Get rid of the 3 advertising channels issue
You see every BLE operation performed
You may tamper on-the-fly the data sent or
received
Cons: 
Complex to setup: 1 VM & 1 Host computer
Only capture HCI events, not BLE Link Layer
Does not support all types of pairing
Only compatible with 4.0 adapters
WE ARE DOING IT WRONG !
WE ARE DOING IT WRONG !
Ubertooth-btle is outdated and does not work with
recent BLE stacks
Nordic Semiconductor' sniï¬€er is closed source and
does not allow active connection sniï¬€ing and may
be discontinued
The MitM approach seems great but too diï¬€icult to
use and does not intercept link-layer packets
IMPROVING
IMPROVING 
THE BLE ARSENAL
THE BLE ARSENAL
THE IDEAL TOOL
THE IDEAL TOOL
Able to sniï¬€ existing and new connections
Uses cheap hardware
Open-source
SNIFFING ACTIVE CONNECTIONS
SNIFFING ACTIVE CONNECTIONS
MIKE RYAN'S TECHNIQUE
MIKE RYAN'S TECHNIQUE
1. Identify Access Address (32 bits)
2. Recover the CRCInit value used to compute CRC
3. hopInterval = time between two packets / 37
4. hopIncrement = LUT[time between channel 0 & 1]
MIKE'S ASSUMPTION (2013)
MIKE'S ASSUMPTION (2013)
All 37 data channels are used
DATA CHANNELS IN 2018
DATA CHANNELS IN 2018
Not all channels are used to improve reliability
Some channels are remapped to keep a 37 channels
hopping sequence
0, 4, 8, 12, 16, 20, 24, 0, 4, 8, 3, 7, 11, 15, 19, 23, 27, 3, 7,
2, 6, 10, 14, 18, 22, 26, 2, 6, 1, 5, 9, 13, 17, 21, 25, 1, 5 
Mike's technique does not work anymore !
HOW TO DEDUCE CHANNEL MAP AND
HOW TO DEDUCE CHANNEL MAP AND
HOP INTERVAL
HOP INTERVAL
Channel map
Listen for packets on every possible channels
May take until 4 x 37 seconds to determine !
Hop interval
Find a unique channel
Measure time between 2 packets and divide by 37
DEDUCE HOP INCREMENT
DEDUCE HOP INCREMENT
Pick 2 unique channels
Generate a lookup table
Measure time between two packets on these
channels
Determine increment value
More details in PoC||GTFO 0x17
SNIFFING NEW CONNECTIONS
SNIFFING NEW CONNECTIONS
CONNECT_REQ PDU
CONNECT_REQ PDU
Every needed information are in this packet
Sniï¬€er must listen on the correct channel
"INSTANT" MATTERS
"INSTANT" MATTERS
Defines when a parameter update is eï¬€ective
Used for:
Channel map updates
Hop interval updates
WE DON'T CARE AT ALL
WE DON'T CARE AT ALL
WE DON'T CARE AT ALL
WE DON'T CARE AT ALL
WE DON'T CARE AT ALL
WE DON'T CARE AT ALL
WE DON'T CARE AT ALL
WE DON'T CARE AT ALL
WE DON'T CARE AT ALL
WE DON'T CARE AT ALL
MULTIPLE SNIFFERS FOR THE ULTIMATE
MULTIPLE SNIFFERS FOR THE ULTIMATE
SNIFFING TOOL
SNIFFING TOOL
A BRAND NEW TOOL ...
A BRAND NEW TOOL ...
... BASED ON A MICRO:BIT
... BASED ON A MICRO:BIT
$15
$15
BTLEJUICE
BTLEJUICE
BTLE
BTLEJUICE
JUICEJACK
JACK
NO LIVE DEMO, I KNOW YOU.
NO LIVE DEMO, I KNOW YOU.
SNIFFING A NEW CONNECTION
SNIFFING A NEW CONNECTION
SNIFFING AN EXISTING CONNECTION
SNIFFING AN EXISTING CONNECTION
PCAP EXPORT
PCAP EXPORT
Supports Nordic and legacy BTLE formats
BTLEJACKING
BTLEJACKING
A NEW ATTACK ON BLE
A NEW ATTACK ON BLE
SUPERVISION TIMEOUT
SUPERVISION TIMEOUT
Defined in CONNECT_REQ PDU
Defines the time aer which a connection is
considered lost if no valid packets
Enforced by both Central and Peripheral devices
SUPERVISION TIMEOUT VS. JAMMING
SUPERVISION TIMEOUT VS. JAMMING
SUPERVISION TIMEOUT VS. JAMMING
SUPERVISION TIMEOUT VS. JAMMING
SUPERVISION TIMEOUT VS. JAMMING
SUPERVISION TIMEOUT VS. JAMMING
SUPERVISION TIMEOUT VS. JAMMING
SUPERVISION TIMEOUT VS. JAMMING
SUPERVISION TIMEOUT VS. JAMMING
SUPERVISION TIMEOUT VS. JAMMING
SUPERVISION TIMEOUT VS. JAMMING
SUPERVISION TIMEOUT VS. JAMMING
SUPERVISION TIMEOUT VS. JAMMING
SUPERVISION TIMEOUT VS. JAMMING
JAMMING FTW
JAMMING FTW
BTLEJACKING
BTLEJACKING
Abuse BLE supervision timeout to take over a
connection
BLE versions 4.0, 4.1, 4.2 and 5 are vulnerable
Requires proximity (about 5 meters away from
target)
EXAMPLE OF VULNERABLE DEVICES
EXAMPLE OF VULNERABLE DEVICES
SEXTOYS TOO !
SEXTOYS TOO !
https://fr.lovense.com/sex-toy-blog/lovense-hack
IMPACT
IMPACT
Unauthorized access to a device, even if it is already
connected
Bypass authentication, if authentication is
performed at the start of connection
Keep the device internal state intact: this may leak
valuable information
COUNTER-MEASURES
COUNTER-MEASURES
Use BLE Secure Connections (see specifications)
At least authenticate data at application layer
BTLEJACK
BTLEJACK
https://github.com/virtualabs/btlejack
FEATURES
FEATURES
Already established BLE connection sniï¬€ing
New BLE connection sniï¬€ing
Selective BLE jamming
BLE connection take-over (btlejacking)
PCAP export to view dumps in Wireshark
Multiple sniï¬€ers support
CONCLUSION
CONCLUSION
Btlejack is an all-in-one solution for BLE sniï¬€ing,
jamming and hijacking
BLE hijacking works on all versions
Insecured BLE connections are prone to sniï¬€ing and
hijacking
It might get worse with further versions of BLE
(greater range)
Secure your BLE connections FFS (really, do it)
CONTACT
CONTACT
THANKS ! QUESTIONS ?
THANKS ! QUESTIONS ?
 @virtualabs
 damien.cauquil@digital.security
WHY DIDN'T YOU IMPROVE 
WHY DIDN'T YOU IMPROVE  
UBERTOOTH-BTLE
UBERTOOTH-BTLE CODE ?
 CODE ?
I am a lot more familiar with nRF51 SoCs than LPC
microcontrollers
Buying 3 Ubertooth devices ($360) is not cheap
HOW DID YOU MAKE YOUR CLUSTER ?
HOW DID YOU MAKE YOUR CLUSTER ?
From a modified ClusterHat v2 ($30) 
https://shop.pimoroni.com/products/cluster-hat