# 基准测试与最佳实践

## 作者简介
- **姓名**：digoal
- **身份**：PGer（PostgreSQL社区成员）
- **贡献**：撰写超过2000篇技术文章，内容涵盖数据库管理、优化和开发。
- **个人主页**：[http://blog.163.com/digoal@126/](http://blog.163.com/digoal@126/)
- **社区参与**：
  - PostgreSQL中国社区的创始人之一。
  - 发起并支持了PostgreSQL中国社区内的PG大学项目。
  - DBA+社群的联合发起人。
- **专利**：拥有数十项与数据库及网络相关的发明专利。
- **职业经历**：
  - 曾任职于斯凯网络，负责数据库部门。在此期间主导了集团数据库系统、存储解决方案、主机配置、操作系统选择以及跨多个IDC的数据架构设计。具体职责包括高可用性(HA)方案制定、灾难恢复策略规划、备份与恢复流程建立、分布式数据库及数据仓库架构设计等。在公司上市前成功实施了基于PostgreSQL的去Oracle化，并通过SOX合规性审计。
  - 目前就职于阿里巴巴集团，在AliCloudDB RDS PG内核团队工作。

## 目录
1. TPC-C介绍
2. TPC-H介绍
3. benchmarkSQL for TPC-C
4. dbgen & pg-tpch for TPC-H
5. PostgreSQL最佳实践
6. Greenplum最佳实践
7. tpc.org参考数据

### TPC-C概述
TPC-C是一种针对在线交易处理(OLTP)系统的性能测试标准，旨在评估数据库管理系统(DBMS)处理复杂业务逻辑的能力。

#### 数据关系模型
- 公司 -> 仓库(W)
- 仓库 -> 销售点(每个仓库有10个销售点)
- 销售点 -> 客户(每个销售点服务3000名客户)

其中W代表用户可以自定义的仓库数量。

#### 关键表结构
- **Warehouse**: 每个仓库包含10个District。
- **Customer**: 每个District下关联3000个客户记录。
- **Order**: 记录每个客户的订单信息。
- **New Order**: 新建但未完成处理的订单。
- **Item**: 存储商品详细信息。
- **Stock**: 库存状态跟踪。
- **History**: 用户操作历史记录。

### TPC-H概述
TPC-H用于衡量决策支持系统(DSS)中执行复杂查询时的效率，以每小时能够处理的查询数量(TPC-H QphH)作为评价指标。

#### 查询集
- 包含22条预定义的SELECT语句，严格遵循SQL-92规范。
- 每条查询都有明确的商业背景描述、语法说明、参数列表及结果验证方法。
- 查询难度远超普通OLTP应用需求，单次运行时间可能从几十秒到十几小时不等。

#### 更新操作
- RF1: 向`Order`和`Lineitem`表插入新行，模拟新增销售活动。
- RF2: 删除过期或无效的数据条目。

以上即为本次分享的主要内容概览。接下来我们将深入探讨如何使用benchmarkSQL工具进行TPC-C测试，以及利用dbgen与pg-tpch对TPC-H基准进行评估的具体步骤。