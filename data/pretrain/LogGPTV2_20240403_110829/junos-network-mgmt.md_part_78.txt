Apr 6 0:17:18.234 xe-0/0/1 1053520 842
Apr 6 0:17:18.244 xe-0/0/1 1055184 844
Meaning
The output displays queue-statistics information as expected.
Verify Traffic Statistics
Purpose
Verify that traffic statistics collection is working.
Action
From operational mode, enter the show analytics traffic-statistics command to display the traffic
statistics.
user@host> show analytics traffic-statistics
Time: Apr 5 19:52:48.549, Physical interface: xe-0/0/1
Traffic Statistics: Receive Transmit
Total octets: 4797548752936 408886273632
Total packet: 5658257464 3190613435
Octets per second: 0 0
Packet per second: 0 0
Octets dropped: 0 252901000
Packet dropped: 0 252901
Utilization: 0.0% 0.0%
Time: Apr 5 19:52:48.549, Physical interface: xe-0/0/7
Traffic Statistics: Receive Transmit
Total octets: 4790866253100 477139024
969
Total packet: 5624473639 477944
Octets per second: 0 0
Packet per second: 0 0
Octets dropped: 0 166582000
Packet dropped: 0 166582
Utilization: 0.0% 0.0%
Time: Apr 5 19:52:48.549, Physical interface: xe-0/0/8
Traffic Statistics: Receive Transmit
Total octets: 4789797668456 764910024
Total packet: 5623280870 765715
Octets per second: 0 0
Packet per second: 0 0
Octets dropped: 0 156099000
Packet dropped: 0 156099
Utilization: 0.0% 0.0%
Meaning
The output displays traffic-statistics information as expected.
Example: Configure Queue and Traffic Monitoring
IN THIS SECTION
Requirements | 969
Overview | 970
Configuration | 971
Verification | 978
This example shows how to configure the enhanced network analytics feature, including queue and
traffic monitoring.
Requirements
This example uses the following hardware and software components:
970
• A QFX5100 standalone switch
• A external streaming server to collect data
• Junos OS Release 13.2X51-D15 software
• TCP server software (for remote streaming servers)
Before you configure network analytics, be sure you have:
• Junos OS Release 13.2X51-D15 or later software installed and running on the QFX5100 switch.
• (Optional for streaming servers for the JSON, CSV, and TSV formats) TCP or UDP server software set
up for processing records separated by a newline character (\n) on the remote streaming server.
• (Optional for streaming servers for the GPB format) TCP or UDP build streaming server using the
analytics.proto file.
• All other network devices running.
Overview
IN THIS SECTION
Topology | 971
The network analytics feature provides visibility into the performance and behavior of the data center
infrastructure. This feature collects data from the switch, analyzes the data using sophisticated
algorithms, and captures the results in reports. Network administrators can use the reports to help
troubleshoot problems, make decisions, and adjust resources as needed.
You enable network analytics by first defining a resource profile template, and then applying the profile
to the system (for a global configuration) or to individual interfaces.
NOTE: Disabling of the queue or traffic monitoring supersedes the configuration (enabling) of
this feature. You disable monitoring by applying a resource profile that includes the no-queue-
monitoring or no-traffic-monitoring configuration statement at the [edit services analytics resource-
profiles] hierarchy level.
971
Topology
In this example, the QFX5100 switch is connected to an external server used for streaming statistics
data.
Configuration
IN THIS SECTION
CLI Quick Configuration | 971
Configure the Polling Interval for Queue and Traffic Monitoring | 972
Configure a Local Statistics File | 972
Configure and Apply a Resource Profile for the System | 973
Configure and Apply a Resource Profile for an Interface | 974
Configure an Export Profile and Collector for Streaming Data | 974
To configure the network analytics features, perform these tasks:
CLI Quick Configuration
To quickly configure this example, copy the following commands, paste them in a text file, remove any
line breaks, change any details necessary to match your network configuration, and then copy and paste
the commands into the CLI at the [edit] hierarchy level.
[edit]
set services analytics resource system polling-interval queue-monitoring 1000
set services analytics resource system polling-interval traffic-monitoring 5
set services analytics collector local file an.stats
set services analytics collector local file an files 3
set services analytics collector local file an size 10m
set services analytics resource-profiles sys-rp queue-monitoring
set services analytics resource-profiles sys-rp traffic-monitoring
set services analytics resource-profiles sys-rp depth-threshold high 999999 low 99
set services analytics resource system resource-profile sys-rp
set services analytics resource-profiles if-rp queue-monitoring
set services analytics resource-profiles if-rp traffic-monitoring
set services analytics resource-profiles if-rp latency-threshold high 2300 low 20
set services analytics resource interfaces xe-0/0/16 resource-profile if-rp
972
set services analytics resource interfaces xe-0/0/18 resource-profile if-rp
set services analytics resource interfaces xe-0/0/19 resource-profile if-rp
set services analytics export-profiles ep stream-format gpb
set services analytics export-profiles ep interface information
set services analytics export-profiles ep interface statistics queue
set services analytics export-profiles ep interface statistics traffic
set services analytics export-profiles ep interface status link
set services analytics export-profiles ep system information
set services analytics export-profiles ep system status queue
set services analytics export-profiles ep system status traffic
set services analytics collector address 10.94.198.11 port 50001 transport tcp export-profile ep
set services analytics collector address 10.94.184.25 port 50013 transport udp export-profile ep
Configure the Polling Interval for Queue and Traffic Monitoring
Step-by-Step Procedure
To configure the polling interval queue and traffic monitoring globally:
1. Configure the queue monitoring polling interval (in milliseconds) for the system:
[edit]
set services analytics resource system polling-interval queue-monitoring 1000
2. Configure the traffic monitoring polling interval (in seconds) for the system:
[edit]
set services analytics resource system polling-interval traffic-monitoring 5
Configure a Local Statistics File
Step-by-Step Procedure
To configure a file for local statistics collection:
1. Configure the filename:
[edit]
set services analytics collector local file an.stats
973
2. Configure the number of files:
[edit]
set services analytics collector local file an files 3
3. Configure the file size:
[edit]
set services analytics collector local file an size 10m
Configure and Apply a Resource Profile for the System
Step-by-Step Procedure
To define a resource profile template for queue and traffic monitoring resources:
1. Configure a resource profile and enable queue monitoring:
[edit]
set services analytics resource-profiles sys-rp queue-monitoring
2. Enable traffic monitoring in the profile:
[edit]
set services analytics resource-profiles sys-rp traffic-monitoring
3. Configure the depth-threshold (high and low values) for queue monitoring in the profile:
[edit]
set services analytics resource-profiles sys-rp depth-threshold high 999999 low 99
4. Apply the resource profile template to the system resource type for a global configuration:
[edit]
set services analytics resource system resource-profile sys-rp
974
Configure and Apply a Resource Profile for an Interface
Step-by-Step Procedure
You can configure queue and traffic monitoring for one or more specific interfaces. The interface-
specific configuration supersedes the global (system) configuration. To define a resource profile template
for queue and traffic monitoring resources for an interface:
1. Configure a resource profile and enable queue monitoring:
[edit]
set services analytics resource-profiles if-rp queue-monitoring
2. Enable traffic monitoring in the profile:
[edit]
set services analytics resource-profiles if-rp traffic-monitoring
3. Configure the latency-threshold (high and low values) for queue monitoring in the profile:
[edit]
set services analytics resource-profiles if-rp latency-threshold high 2300 low 20
4. Apply the resource profile template to the interfaces resource type for specific interfaces:
[edit]
set services analytics resource interfaces xe-0/0/16 resource-profile if-rp
set services analytics resource interfaces xe-0/0/18 resource-profile if-rp
set services analytics resource interfaces xe-0/0/19 resource-profile if-rp
Configure an Export Profile and Collector for Streaming Data
Step-by-Step Procedure
To configure a collector (streaming server) for receiving monitoring data:
975
1. Create an export profile and specify the stream format:
[edit]
set services analytics export-profiles ep stream-format gpb
2. Configure the export profile to include interface information:
[edit]
set services analytics export-profiles ep interface information
3. Configure the export profile to include interface queue statistics:
[edit]
set services analytics export-profiles ep interface statistics queue
4. Configure the export profile to include interface traffic statistics:
[edit]
set services analytics export-profiles ep interface statistics traffic
5. Configure the export profile to include interface status link information:
[edit]
set services analytics export-profiles ep interface status link
6. Configure the export profile to include system information:
[edit]
set services analytics export-profiles ep system information
7. Configure the export profile to include system queue status:
[edit]
set services analytics export-profiles ep system status queue
976
8. Configure the export profile to include system traffic status:
[edit]
set services analytics export-profiles ep system status traffic
9. Configure the transport protocol for the collector addresses and apply an export profile:
[edit]
set services analytics collector address 10.94.198.11 port 50001 transport tcp export-profile
ep
set services analytics collector address 10.94.184.25 port 50013 transport udp export-profile
ep
NOTE: If you configure the tcp or udp option for the JSON, CSV, and TSV formats, you must
also set up the TCP or UDP client software on the remote collector to process records that
are separated by the newline character (\n) on the remote server.
If you configure the tcp or udp option for the GPB format, you must also set up the TCP or
UDP build streaming server using the analytics.proto file.
Results
Display the results of the configuration:
[edit services analytics]
user@switch# run show configuration
services {
analytics {
export-profiles {
ep {
stream-format gpb;
interface {
information;
statistics {
traffic;
queue;
}
status {
link;
977
}
}
system {
information;
status {
traffic;
queue;
}
}
}
}
resource-profiles {
sys-rp {
queue-monitoring;
traffic-monitoring;
depth-threshold high 99999 low 99;
}
if-rp {
queue-monitoring;
traffic-monitoring;
latency-threshold high 2300 low 20;
}
}
resource {
system {
resource-profile sys-rp;
polling-interval {
traffic-monitoring 5;
queue-monitoring 1000;
}
}
interfaces {
xe-0/0/16 {
resource-profile if-rp;
}
xe-0/0/18 {
resource-profile if-rp;
}
xe-0/0/19 {
resource-profile if-rp;
}
}
}
978
collector {
local {
file an size 10m files 3;
}
address 10.94.184.25 {
port 50013 {
transport udp {
export-profile ep;
}
}
}
address 10.94.198.11 {
port 50001 {
transport tcp {
export-profile ep;
}
}
}
}
}
}
Verification
IN THIS SECTION
Verify the Network Analytics Configuration | 978
Verify the Network Analytics Status | 979
Verify the Collector Configuration | 980
Confirm that the configuration is correct and works as expected by performing these tasks:
Verify the Network Analytics Configuration
Purpose
Verify the configuration for network analytics.
979
Action
From operational mode, enter the show analytics configuration command to display the traffic and queue
monitoring configuration.
user@host> show analytics configuration
Traffic monitoring status is enabled
Traffic monitoring polling interval : 5 seconds
Queue monitoring status is enabled
Queue monitoring polling interval : 1000 milliseconds
Queue depth high threshold : 99999 bytes
Queue depth low threshold : 99 bytes
Interface Traffic Queue Queue depth Latency
Statistics Statistics threshold threshold
High Low High Low
(bytes) (nanoseconds)
xe-0/0/16 enabled enabled n/a n/a 2300 20
xe-0/0/18 enabled enabled n/a n/a 2300 20
xe-0/0/19 enabled enabled n/a n/a 2300 20
Meaning
The output displays the traffic and queue monitoring configuration information on the switch.
Verify the Network Analytics Status
Purpose
Verify the network analytics operational status of the switch.
Action
From operational mode, enter the show analytics status global command to display global traffic and
queue monitoring status.
user@host> show analytics status global
Traffic monitoring status is enabled
980
Traffic monitoring pollng interval : 5 seconds
Queue monitoring status is enabled
Queue monitoring polling interval : 1000 milliseconds
Queue depth high threshold : 99999 bytes
Queue depth low threshold : 99 bytes
From operational mode, enter the show analytics status command to display both the interface and global
queue monitoring status.
user@host> show analytics status
Traffic monitoring status is enabled
Traffic monitoring pollng interval : 5 seconds
Queue monitoring status is enabled
Queue monitoring polling interval : 1000 milliseconds
Queue depth high threshold : 99999 bytes
Queue depth low threshold : 99 bytes
Interface Traffic Queue Queue depth Latency
Statistics Statistics threshold threshold
High Low High Low
(bytes) (nanoseconds)
xe-0/0/16 enabled enabled n/a n/a 2300 20
xe-0/0/18 enabled enabled n/a n/a 2300 20
xe-0/0/19 enabled enabled n/a n/a 2300 20
Meaning
The output displays the global and interface status of traffic and queue monitoring on the switch.
Verify the Collector Configuration
Purpose
Action
Verify the configuration for the collector for streamed data is working.
981
From operational mode, enter the show analytics collector command to display the streaming servers
configuration.