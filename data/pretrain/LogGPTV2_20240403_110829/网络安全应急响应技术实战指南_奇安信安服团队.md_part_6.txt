-y：显示所有连接的TCP连接模板。无法与其他选项结合使用。
interval：重新显示选定统计信息，每次显示之间暂停时间间隔（以秒计）。
常见的网络状态说明如下。
LISTENING：侦听状态。
ESTABLISHED：建立连接。
CLOSE_WAIT：对方主动关闭连接或网络异常导致连接中断。
32
第2章
网络安全应急响应工程师基础技能
在排查过程中，一般会使用【netstat -ano | findstr "ESTABLISHED"】命令查
看目前的网络连接，定位可疑的ESTABLISHED。如图2.29所示，在排查中发现
PID为2856的进程有大量网络连接。
图2.2.9 PID为2856的进程有大量网络连接
通过【netstat】命令定位出PID，再通过【tasklist】命令进行程序定位，发现
PID为2856的进程有大量网络连接后，使用【tasklist | find "2856"】命令可查看具
体的程序，如图2.2.10所示。
图2.2.10 查看具体的程序
33
网络安全应急响应技术实战指南
也可以通过【netstat -anb】命令（需要管理员权限）快速定位到端口对应的
程序，如图2.2.11所示。
图2.2.11 快速定位到端口对应的程序
4）使用PowerShell进行排查
有时对于有守护进程的进程，还要确认子父进程之间的关系，可以使用
PowerShell进行查看，一般PowerShell在查询时会调用Wmi对象。【Get-WmiObject
Win32_Process | select Name, ProcessId, ParentProcessId, Path】命令中Get-WmiObject
Win32_Process表示获取进程的所有信息，select Name, ProcessId, ParentProcessId,
Path表示选择Name, ProcessId, ParentProcessId, Path 4个字段，整个命令表示显示
所有进程信息中的Name, ProcessId, ParentProcessId, Path 4个字段的内容。执行后
的结果如图2.2.12所示。
5）使用【wmic】命令进行查询
（1）在命令行中使用【wmic process】命令，可以对进程情况进行查询。 但
使用【wmic process list full /format:csv】命令，即以csv格式列出进程的所有信息，
此时命令列出的信息过多，不便于阅读。因此，可以使用【wmic process get
34
第2章
网络安全应急响应工程师基础技能
name,parentprocessid,processid /format:csv】命令，以csv格式来显示进程的名称、
父进程ID、进程ID，如图2.2.13所示。
图2.2.12 执行后的结果
图2.2.13 显示所有进程的部分信息
35
网络安全应急响应技术实战指南
其他类似命令如下。
【wmic process get ExecutablePath, processid /format:csv】命令表示以csv格式
来显示进程路径、进程ID信息。
【wmic process get name, ExecutablePath, processid, parentprocessid /format:csv |
findstr /I "appdata"】命令表示以csv格式来显示进程的名称、进程路径、进程ID、
父进程ID信息。
（2）同时【wmic】命令还可以结合条件对进程进行筛选。
【wmic process where processid=[PID] get parentprocessid】命令表示以PID的
值作为条件来获取其父进程的PID情况。如图2.2.14所示，是获取PID的值为1888
的进程的父进程PID的值，获取到的父进程PID的值为808。
图2.2.14 获取指定进程的父进程PID的值
其他类似命令如下。
【wmic process where processid=[PID] get commandline】命令表示以PID的值
作为条件来获取其命令行。
（3）在使用【wmic process】命令查出恶意进程后，会结束恶意进程，一般使
用如下命令结束恶意进程。
【wmic process where name="malware.exe" call terminate】命令是指删除
"malware.exe"恶意程序的进程。
【wmic process where processid=[PID] delete】命令是指删除PID为某值的进程。
2．Linux系统
在命令行中输入【netstat】网络连接命令，可分析可疑端口、可疑IP地址、
可疑PID及程序进程。如图2.2.15所示，PID为2963的进程存在恶意外链情况。
根据PID的值，利用【ls -alt /proc/PID】命令，可查看其对应的可执行程序。
如图2.2.16所示，使用【ls -alt /proc/2963】命令，可查看PID为2963的进程的可
执行程序。
36
第2章
网络安全应急响应工程师基础技能
图2.2.15 PID为2963的进程存在恶意外链情况
图2.2.16 查看对应可执行程序
也可以利用【lsof -p PID】命令，查看进程所打开的文件。如图2.2.17所示，
使用【lsof -p 2963】命令，可查看 PID 为 2963 的进程所打开的文件，发现文件
mbrn为可疑文件。
37
网络安全应急响应技术实战指南
图2.2.17 查看PID为2963的进程所打开的文件
如果是恶意进程，可以使用【kill -9 PID】命令结束进程，如【kill -9 2535】
命令表示结束PID为2535的进程。然后使用【rm -rf filename】命令可删除木马，
如要删除mbrn文件，则可使用命令【rm -rf mbrn】。如果root用户都无法删除相
关文件，那么很可能是因为该文件被加上了i属性。使用【lsatter filename】命令，
可查看文件属性，然后使用【chattr -i filename】命令，可移除i属性，进而删除
文件。也有的进程因为存在守护进程而无法删除，我们可以先把进程挂起，查杀
守护进程后，再返回将进程删除。
有些攻击者会将进程隐藏，以躲避排查，因此查看隐藏进程同样重要。按照
顺序执行【ps -ef | awk '{print}' | sort -n | uniq >1】、【ls /proc | sort -n |uniq >2】和【diff
1 2】命令，可以查看隐藏进程，如图2.2.18所示。
图2.2.18 查看隐藏进程
38
第2章
网络安全应急响应工程师基础技能
对于挖矿进程的排查，可使用【top】命令查看相关资源占用率较高的进程，
之后进行定位。如图2.2.19所示，发现PID为29245的进程的CPU占用率较高，
因此可进行重点排查。
图2.2.19 查看相关资源占用率较高的进程
2.3 服务排查
服务可以理解为运行在后台的进程。这些服务可以在计算机启动时自动启动，
也可以暂停和重新启动，而且不显示任何用户界面。服务非常适合在服务器上使
用，通常在为了不影响在同一台计算机上工作的其他用户，且需要长时间运行功
能时使用。在应急响应排查过程中，服务作为一种运行在后台的进程，是恶意软
件常用的驻留方法。
1．Windows系统
打开【运行】对话框，输入【services.msc】命令，可打开【服务】窗口，查
看所有的服务项，包括服务的名称、描述、状态等，如图2.3.1所示。
2．Linux系统
在命令行中输入【chkconfig --list】命令，可以查看系统运行的服务，如图2.3.2
所示。
39
网络安全应急响应技术实战指南
图2.3.1 【服务】窗口
图2.3.2 查看系统运行的服务
其中，0、1、2、3、4、5、6表示等级，具体含义如下：
1表示单用户模式；
40
第2章
网络安全应急响应工程师基础技能
2表示无网络连接的多用户命令行模式；
3表示有网络连接的多用户命令行模式；
4表示不可用；
5表示带图形界面的多用户模式；
6表示重新启动。
使用【service --status-all】命令，可查看所有服务的状态，如图2.3.3所示。
图2.3.3 查看所有服务的状态
2.4 文件痕迹排查
在应急响应排查的过程中，由于大部分的恶意软件、木马、后门等都会在文
件维度上留下痕迹，因此对文件痕迹的排查必不可少。一般，可以从以下几方面
对文件痕迹进行排查：
41
网络安全应急响应技术实战指南
（1）对恶意软件常用的敏感路径进行排查；
（2）在确定了应急响应事件的时间点后，对时间点前后的文件进行排查；
（3）对带有特征的恶意软件进行排查，这些特征包括代码关键字或关键函数、
文件权限特征等。
1．Windows系统
1）敏感目录
在Windows系统中，恶意软件常会在以下位置驻留。
（1）各个盘下的 temp（tmp）相关目录。有些恶意程序释放子体（即恶意程
序运行时投放出的文件）一般会在程序中写好投放的路径，由于不同系统版本的
路径有所差别，但是临时文件的路径相对统一，因此在程序中写好的路径一般
是临时目录。对敏感目录进行的检查，一般是查看临时目录下是否有异常文件。
图2.4.1通过临时目录发现可疑程序svchost.exe。
图2.4.1 通过临时目录发现可疑程序svchost.exe
（2）对于一些人工入侵的应急响应事件，有时入侵者会下载一些后续攻击的
工具。Windows系统要重点排查浏览器的历史记录、下载文件和cookie信息，查
42
第2章
网络安全应急响应工程师基础技能
看是否有相关的恶意痕迹。如图2.4.2所示，是在排查浏览器下载文件时发现的恶
意样本。
图2.4.2 排查浏览器下载文件时发现的恶意样本
（3）查看用户Recent文件。Recent文件主要存储了最近运行文件的快捷方式，
可通过分析最近运行的文件，排查可疑文件。一般，Recent文件在Windows系统
中的存储位置如下：
C:\Documents and Settings\Administrator（系统用户名）\Recent；
C:\Documents and Settings\Default User\Recent。
如图2.4.3所示，是打开Recent文件后看到的内容。
图2.4.3 Recent文件内容
43
网络安全应急响应技术实战指南
（4）预读取文件夹查看。Prefetch 是预读取文件夹，用来存放系统已访问过
的文件的预读取信息，扩展名为 pf。之所以自动创建 Prefetch 文件夹，是为了加
快系统启动的进程。Windows 系统利用“预读取”技术，在实际用到设备驱动程
序、服务和shell程序之前装入它们。这种优化技术也被用到应用软件上，系统对
每个应用软件的前几次启动情况进行分析，然后创建一个描述应用需求的虚拟“内
存映像”，并把这些信息保存到Windows\Prefetch文件夹中。一般，在Windows 7
系统中可以记录最近128个可执行文件的信息，在Windows 8到Windows 10系统
中可以记录最近1024个可执行文件。一旦建立了映像，之后应用软件的装入速度
可大幅提升。Prefetch文件夹的位置为“%SystemRoot%\Prefetch\”。
可以在【运行】对话框中输入【%SystemRoot%\Prefetch\】命令，打开Prefetch
文件夹。之后排查该文件夹下的文件，如图2.4.4所示。
图2.4.4 排查Prefetch文件夹下的文件
另外，Amcache.hve 文件也可以查询应用程序的执行路径、上次执行的时间