(NTO)两个合约存在类似漏洞，这两个合约没有铸币上限限制，但同样的手段，可以溢出合约中一个用于记录已发币总量(totalSupply)的变量值，使其与市场中实际流通的总币数不一致。
漏洞实例：合约Playkey (PKT)
漏洞所在位置：红色标注的行L237
漏洞攻击效果：管理员可以篡改已发币总量(totalSupply)为任意值，并绕过合约中的铸币上限超额发行token；
漏洞原理：`_value`在函数调用时被设置为精心构造的极大值，使得`totalSupply +
_value`计算结果溢出后小于tokenLimit，从而轻易绕过L237行的铸币上限检测。
##### 3.5.allocateAny: 超额定向分配(CVE-2018-11810)
管理员通过制造溢出来绕过合约中对单地址发币的最大上限，可以对指定地址分配超额的token，使得对单地址的发布上限无效。
漏洞实例：合约LGO (LGO)
漏洞所在位置：红色标注的行L286
漏洞攻击效果：管理员绕过合约中规定的单地址发币上限，给指定地址分配超额的token；
漏洞原理： 一个极大的`_amount`可以使得算数加法运算holdersAllocatedAmount +
_amount发生整数溢出，变为一个极小值，从而绕过L286的检测。
##### 3.6.overBuy：超额购币（CVE-2018-11809）
买家如果拥有足够多的ETH，可以通过发送大量token制造溢出，从而绕过ICO发币上限，达到超额购币。
漏洞实例：合约EthLend (LEND)
漏洞所在位置：红色标注的行L236
漏洞攻击效果：调用者绕过合约中规定ICO的token容量上限，获得了超额购币；
漏洞原理：一个极大的`_newTokens`可以使得算数加法运算totalSoldTokens +
newTokens发生整数溢出，变为一个极小值，从而绕过L236的检测。
#### 4.漏洞列表
团队采用自动化工具分析了390份ERC20智能合约，除上述已披露的漏洞之外，共发现25个智能合约存在未知的整数溢出漏洞，详细情况如下表所示，出于对相关厂商安全的考虑，隐去了具体的漏洞位置、源代码等技术细节，相关厂商安全人员如有需求，可与研究团队联系（列表最右侧一列的类型编号对应上述分类，每种合约可能同时存在多种类型漏洞）:
#### 5.结论
智能合约之所以“智能”，是由于合约代码一旦上链，其执行效果完全由可见且不可篡改的代码来决定，而不用依赖于对任何参与方的信任。然而，由上述漏洞分析可见，智能合约并没有预期的“智能”，存在相当多的安全风险，尤其是管理员权限下，可能导致诸多严重的安全问题。仅仅通过整数溢出这一常见漏洞类型，管理员便能够任意篡改所有账户余额，恶意超额、甚至无上限铸币，背离合约白皮书的约定，这样的合约无法保证参与多方的公平性，更无谈智能。而管理员利用整数溢出进行作恶早已有先例，2018年2月初，基于以太坊的Monero
Gold(XMRG) Token在交易所的价格先猛涨787%，后迅速暴跌至崩盘，造成大量用户经济损失
，其背后就是管理团队利用预留的整数溢出漏洞进行超额铸币，并在交易所抛售造成恶性通货膨胀，最后价值几乎归零
。在区块链上运行的智能合约，本意是利用区块链不可篡改的特性来构建可信的执行环境，然而安全漏洞的存在就像一个个隐藏的定时炸弹，对智能合约的可信任基础带来了巨大的挑战。
在近一个月之前，团队已经发现上述安全漏洞，在评估了安全威胁之后第一时间反馈给相关厂商，并通知了交易所（如火币网），希望能够帮助厂商和交易所及时修补漏洞和杜绝安全隐患，多家厂商在得到通报后也积极做出了应急响应。
#### 6.关于我们
清华-360企业安全联合研究中心（筹）是清华大学网络研究院和360企业安全集团共同成立的联合研究机构，结合清华大学和360企业安全集团在学术研究和产业服务中的优势，面向世界学术和技术前沿开展研究，服务于国家和社会对网络空间安全的战略需求。研究团队在漏洞挖掘与攻防领域有丰富的经验，团队在国际四大顶级安全会议中发表多篇论文，在世界学术和工业界有广泛的影响力，孕育了“蓝莲花”等国际知名黑客战队。
#### 参考文献
  1. Explaining the DAO exploit for beginners in Solidity
  2. Building a safer crypto token
  3. EDU问题：还原EDU被黑客攻击始末：期货与现货的组合套现
  4. BAI 智能合约存在和 EDU 一样的漏洞，可转走任意账户里的 BAI Token
  5. EOS Node Remote Code Execution Vulnerability — EOS WASM Contract Function Table Array Out of Bounds
  6. 区块链智能合约漏洞，想说补你不容易（干货）
  7. 导致惨重代价的Bug
  8. Monero Gold – The story and tech specs of a 4 million USD shitcoin scam, brilliantly executed
  9. Monero Gold (XMRG) 价格，图表，市值，以及其他计量 | CoinMarketCap
* * *
_本文经安全客授权发布，转载请联系安全客平台。_
* * *