title:(Nothing else) MATor(s): Monitoring the Anonymity of Tor's Path Selection
author:Michael Backes and
Aniket Kate and
Sebastian Meiser and
Esfandiar Mohammadi
(Nothing else) MATor(s):
Monitoring the Anonymity of Tor’s Path Selection
Michael Backes1,2
Aniket Kate1,3
Sebastian Meiser1,2
Esfandiar Mohammadi1,2
1 Saarland University, 2 CISPA, 3 MMCI
{backes, meiser, mohammadi}@cs.uni-saarland.de
PI:EMAIL
October 14, 2014
Abstract
In this paper we present MATOR: a framework for rigorously assessing the degree of anonymity in the
Tor network. The framework explicitly addresses how user anonymity is impacted by real-life characteristics
of actually deployed Tor, such as its path selection algorithm, Tor consensus data, and the preferences and the
connections of the user. The anonymity assessment is based on rigorous anonymity bounds that are derived in
an extension of the ANOA framework (IEEE CSF 2013). We show how to apply MATOR on Tor’s publicly
available consensus and server descriptor data, thereby realizing the ﬁrst real-time anonymity monitor. Based
on experimental evaluations of this anonymity monitor on Tor Metrics data, we propose an alternative path
selection algorithm that provides stronger anonymity guarantees without decreasing the overall performance of
the Tor network.
Contents
1 Introduction
2 Overview
3 The extended AnoA Framework
3.1 The extended AnoA challenger .
.
3.2 Adversary classes .
.
3.3 Sequential composability .
.
3.3.1 Composability theorem .
.
3.4 Anonymity Notions .
.
.
.
.
.
.
.
.
.
.
.
.
. . .
.
.
. . .
. . . .
. . . .
.
. .
.
4 Modeling Tor in AnoA
4.1 The Tor’s path selection (PSTOR) algo-
. . . .
4.2 The Tor protocol in extended AnoA . .
rithm .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
2
3
4
4
6
7
8
10
11
11
12
5 Anonymity Monitors
13
13
5.1 Modeling MATor in AnoA . . . . . . .
5.2 Computing Sender Anonymity Bounds .
13
5.3 Computing Recipient Anonymity Bounds 16
18
5.4 Approximations . . . . . . . . . . . . .
5.5 Relationship Anonymity Bounds . . . .
19
6 Experimental results
Implementation and Data collection . .
6.1
. . . . . . . .
6.2 Path Selection Strategies
6.3 Lessons learned . . .
. . . . . . . . . .
6.4 The impact of a multiplicative factor . .
7 Conclusion & Future Work
22
22
23
24
25
26
1
1 Introduction
The onion routing network Tor is a widely employed low-latency anonymous communication service [30]. To
provide anonymity Tor routes a user’s trafﬁc through anonymizing proxies. In Tor the trust in these anonymizing
proxies (also called nodes) is distributed over three nodes, instead of one proxy, which are chosen from more than
5000 volunteer nodes. Using these anonymizing proxies, Tor creates an anonymous channel for the user, which
leads to the following central question from a user perspective:
How anonymous is this channel that Tor creates, i.e., how likely is it that an adversary can deanonymize
me?
Deriving the degree of a user’s anonymity is challenging for such a complex system where each of the 5000
ﬂuctuating nodes is entrusted with different bandwidth, and each node offers a different set of ports for a commu-
nication. Previous mathematically founded analyses abstract the Tor network by ignoring characteristics of Tor,
such as the path selection algorithm, the varying entrusted bandwidth of different Tor nodes, or the user’s requested
ports [6,13–16,19]. However, these real-life characteristics of Tor signiﬁcantly inﬂuence a user’s anonymity, which
renders the previously proven bounds inaccurate.
Contribution.
the ﬁrst system to derive sender, recipient and relation-
ship anonymity guarantees based on Tor’s real-life characteristics, such as its actual path selection strategy. Our
anonymity deﬁnitions are founded in the ANOA framework [6] and are thus modular. MATOR entails light-weight
real-time monitors that compute sender, recipient and relationship anonymity guarantees based on the actual Tor
consensus data and the user requested ports.
In this paper, we present MATOR:
As ANOA, the theoretical framework upon which we base MATOR, does not provide a formalism to model
adversaries that resemble the worst case for a realistic scenario, we extend ANOA with the concepts of adversary
classes and adaptive user behavior. These adversary classes allow for restricting the strong ANOA adversary to
the scenario of interest, whereas extending ANOA with adaptive user behavior enables interactive communication
scenarios. We show that sequential composition does not hold for some adversary classes and characterize those
adversary classes for which we show sequential composition. We consider this extension of the ANOA framework
to be of independent interest for the analysis of other anonymous communication networks.
Using MATOR, we conduct experiments on Tor Metrics [29] data that span the last 24 months. These experi-
ments illustrate that the anonymity guarantees ﬂuctuate substantially on an hourly basis, which further underscores
the value of MATOR’s novel methodology to monitor anonymity in real-time. The experiments additionally high-
light the inﬂuence of the entrusted bandwidth on a user’s anonymity, as Tor’s path selection algorithm places a
large amount of trust into single high-bandwidth nodes and hence has similar weaknesses as choosing a single
anonymizing proxy. Based on our ﬁndings from the experiments, we propose DISTRIBUTOR: a novel path se-
lection algorithm that improves Tor for all three considered anonymity notions (sender, recipient and relationship
anonymity) by redistributing the trust in single high-bandwidth nodes to a larger set of Tor nodes. In contrast to
previous proposals for path selection algorithms that solely concentrate on improving the users’ anonymity [4,11],
our path selection algorithm additionally preserves the overall performance of the Tor network.
Related work. In the literature, there are two lines of work about estimating the degree of anonymity of Tor users.
The ﬁrst line of work assumes a worst case adversary and proves rigorous anonymity bounds for Tor users [6,
13–16, 19]. These pieces of work, however, abstract the Tor network by ignoring characteristics of Tor that
signiﬁcantly inﬂuence a user’s anonymity, such as the path selection algorithm, the varying entrusted bandwidth of
different Tor nodes, or the user’s requested ports. Nevertheless, these previous approaches for proving anonymity
degrees for Tor offer a valuable foundation for our work: in particular, the rigorous ANOA framework. ANOA,
however, has several severe limitations: it only considers a worst-case adversary that has full control over all
actions of all users, which is too strong for many realistic and interesting scenarios. However, there are important
scenarios in which the adversary should not have full control over all actions of all users and that cannot be
modeled in ANOA. Therefore, we extend ANOA such that it also allows much more ﬁne-grained scenarios.
The second line of work models Tor’s anonymity relevant characteristics more accurately [22, 31], e.g., they
explicitly model Tor’s path selection. Johnson et al. [22] give estimates for the anonymity that Tor provides for
typical users based on simulation experiments that assume an experimentally estimated adversarial strategy for
compromising relays, which, however, does not model the worst case adversary. Moreover, they characterize the
adversary by its bandwidth and split this bandwidth up between entry and exit nodes (i.e., the ﬁrst and third proxy),
which neglects the following case: a relay that offers its bandwidth as entry node will with signiﬁcant probability
be chosen as a middle node (i.e., the second proxy) or as an exit node (i.e., the third proxy) and can still learn some
information. This case is ignored by their analysis, which signiﬁcantly reduces the estimated de-anonymization
probability of adversarial relays. The work by Wacek et al. [31] goes into a similar direction. They construct
2
Figure 1: Output of MATOR on historical data from January 2012 until the end of July 2014: HTTPS + IRC vs.
HTTPS, The graph shows a bound on the success probability of a worst case adversary in deanonymizing a user,
where the adversary may compromise up to 0.5% of the nodes.
a small-scale model of the Tor network, on which they perform extensive simulations, using the real Tor client
code, to evaluate the impact of path selection algorithms on Tor’s performance and anonymity. As both analyses
are based on simulations, they, in contrast to our work, do not yield provable bounds on the degree of a user’s
anonymity. Moreover, unlike MATOR, their analyses cannot be performed in real time on commodity hardware.
With respect to the improvement on Tor’s path selection algorithm, there is an extensive line of work. Wang et
al. [32] focus on improving Tor’s latency by using a congestion-aware path selection. This proposed path selection
would improve the overall performance of Tor, but the authors show that their path selection does not improve a
user’s anonymity and even slightly reduces it. In contrast, there are several proposals to improve the anonymity of
single user’s in Tor signiﬁcantly [4,11,23], but these path selection algorithms solely aim to improve the anonymity
of Tor and ignore the inﬂuence on the overall performance of the Tor network. If one of these latter path selection
algorithms was to be widely deployed and used by the majority of Tor users, the overall performance of the
Tor network would signiﬁcantly decrease, as the path selection would no longer allow the trafﬁc to be distributed
according to the bandwidth of the nodes. In this work, we propose a path selection algorithm that both signiﬁcantly
improves the anonymity of users and at the same time is completely performance-preserving; i.e., even if every
Tor user applied our technique, the overall performance of Tor would not change at all.
2 Overview
The Tor network is an overlay network consisting of OR nodes that relay user trafﬁc and of a distributed directory
service that maintains and provides the users with cryptographic information and with routing information about
the OR nodes in form of a consensus. On a regular basis (typically every 10 minutes) users select a sequence of
(three) OR nodes based on the directory information, such as bandwidth and accepted ports, and create a path,
called a circuit over the selected set. The users then employ these circuits to send trafﬁc to their destinations and
to receive responses from those. The selection of nodes is done by a random choice. However, to improve the
performance of the Tor network, this choice is not uniformly at random, but a weighted random choice over all
possible nodes, where the weight depends on the node’s bandwidth.
Our goal is to perform a rigorous real-time analysis of a user’s anonymity bounds in the presence of real-life
parameters such as the current path selection algorithm in a mathematically founded framework.
Due to the lack of a suitable theoretical framework that we could use off-the-shelf, we chose to extend the
ANOA framework [6], a general framework for anonymity guarantees, such that we can prove our analysis secure.
ANOA is a mathematical framework that is conceptually based on differential privacy in three ways: ﬁrst, it
considers the user behavior as a database of user actions, hence statically determines a users’ behaviors; second,
it leaves the choice over a user’s behavior to the adversary; and third, it allows for deriving guarantees for all
sufﬁciently similar user behaviors. By statically determining the behavior of all users (in a database) before this
behavior is executed, ANOA excludes interactive communication scenarios.
In Section 3 we extend the ANOA framework to such interactive communication scenarios by allowing the
adversary to specify user actions as atomic steps instead of providing databases.
In addition, we restrict the
adversary’s power in ANOA by introducing wrapper machines that we coin adversary classes for including settings
with uncompromised servers. With these adversary classes we, additionally, are able to describe usage patterns
and to restrict the ports that an adversary may choose for a user’s connection and the inﬂuence that the adversary
may have on user preferences. With adversary classes, a variety of user proﬁles and realistic restrictions for the
3
 0 0.2 0.4 0.6 0.8 12012-012012-042012-072012-102013-012013-042013-072013-102014-012014-042014-07Anonymity bound δRecipient Anonymity PSTorSender Anonymity PSTorRecipient Anonymity DistribuTorSender Anonymity DistribuToradversary can be deﬁned. In addition, they can modularly be combined with anonymity notions, such as sender
anonymity, recipient anonymity and relationship anonymity.
Before we discuss how a user’s anonymity in Tor is assessed in MATOR, we describe in Section 4 Tor and its
path selection in order to illustrate that there is a variety of parameters that need to be carefully considered. Then,
we ﬁnally deﬁne, on top of ANOA, MATOR as a framework for assessing a user’s anonymity in the Tor network.
We describe how to derive bounds on the degree of anonymity, depending on the path selection algorithm and
actual Tor consensus data. From this data we derive the impact of individual relays on anonymity – which is the
likelihood that they are used as entry, middle or exit node in a user’s circuit – depending on the user’s preferences,
the ports she wants to connect to and the structure of the Tor network, such as the active Tor nodes with their tags,
entrusted bandwidths and family relations [29]. We then base the computation of bounds for sender, recipient, and
relationship anonymity on these calculations, and we show these bounds to be founded in ANOA. To allow users
to compute their anonymity, we present light-weight live-monitors that implement MATOR for sender, recipient
and relationship anonymity.
In Section 6 we conduct experiments by applying MATOR to Tor network data, taken from the Tor Metrics
archive [29]. These experiments give several interesting insights into Tor’s anonymity guarantees: these guaran-
tees heavily depend on a user’s preferences, Tor’s path selection algorithm and the status of all active Tor nodes.
Consequently, the guarantees vary over time as new nodes become active, are entrusted with more or less band-
width and receive different tags. As depicted in Figure 12, these guarantees signiﬁcantly ﬂuctuate with every
new consensus ﬁle, i.e., every hour. Moreover, our experiments show that the current path selection algorithm
does not properly distribute the trust over Tor nodes and extremely prioritizes a few high-bandwidth nodes. This