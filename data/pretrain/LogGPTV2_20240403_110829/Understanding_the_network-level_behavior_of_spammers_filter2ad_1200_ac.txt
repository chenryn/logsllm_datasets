22730
United States
Earthlink, Inc
17381
Germany
16666
Schlund Partner AG
United States
14699 Microsoft Corp
United States
13115
12493 GTE.net LLC
United States
United States
11597
Inktomi Corporation
Inktomi Corporation
d
e
v
i
e
c
e
r
m
a
p
s
l
l
a
f
o
n
o
i
t
c
a
r
F
 1
 0.8
 0.6
 0.4
 0.2
 0
 0
Spam from bobax drones
All spam
Spam from transient BGP announcements
 1
 2
 3
 4
 5
 6
 7
 8
Minimum number of DNSBLS listing this spammer
Figure 4: The fraction of spam emails that were listed in a certain num-
ber of blacklists or more, at the time each mail was received.
d
e
t
s
i
l
m
a
p
S
f
o
n
o
i
t
c
a
r
F
 1
 0.8
 0.6
 0.4
 0.2
 0
S
S
S
p
a
O
p
a
D
S
m
m
R
B
B
L
a
b
u
s
e
r
f
c
i
g
n
c
o
p
S
h
a
u
s
a
t
.
o
r
g
Blacklist
o
p
m
.
b
O
R
D
B
o
r
a
n
t
.
o
r
g
l
i
t
z
e
d
.
o
r
g
Table 2: Top 10 ASes (by email volume) in our legitimate email trace.
and 36% of all received spam originated from only 20 ASes. With a
few exceptions, the ASes containing hosts responsible for sending
large quantities of spam differ from those sending large quantities
of legitimate email.
The concentration of spammers in a small collection of offend-
ing ASes—and the fact that this collection of ASes differs from
the ASes responsible for sending legitimate email (with the excep-
tion of ASes 5731 and 8075)—suggests that spam ﬁlters should
attribute more suspicion to email coming from ASes where spam
commonly originates. This observation begs the question about
why Figure 2 does not show similar differences. Indeed, the spam-
ming behavior of speciﬁc IP address ranges deserves further study,
since Figure 2 really only exposes macro-level behavior of IP ad-
dress ranges (i.e., differences for small IP address ranges may not
be visible in the ﬁgure). We are studying the behavior of ﬁne-
grained address ranges in ongoing work.
Recent reports have claimed that most spam originates in the
United States [5]. On the other hand, Figure 2 suggests that many
spamming hosts reside in IP address space that is allocated to the
Asia-Paciﬁc region (e.g., 61.0.0.0/8). To perform a rough estimate
of the amount of spam originating from each country, we associated
the ASes from which we received spam to the countries where those
ASes were based.1 Table 1 also shows the distribution of hosts that
1Although some ASes span multiple countries, typically even large transit
providers have different AS numbers for backbone networks in different
countries. In any case, we use the primary country where the AS is based.
Figure 5: The cumulative fraction of spam emails that were listed in
each blacklist at the time each mail was received, sorted from most ag-
gressive to least aggressive blacklist.
sent spam to the sinkhole by country, for the top 20 ASes from
which we received spam.
Finding 4.3 (Distribution by country) Although the top two ASes
from which we received spam were from Asia, 11 of the top 20 ASes
from which we received spam were from the United States and com-
prised over 40% of all spam from the top 20 ASes.
We mapped the most proliﬁc IP address (i.e., the top 11.6% of IP
addresses, responsible for 65% of all spam received at the sinkhole)
to their respective countries. Our analysis indicates that nearly three
times as much spam in our trace originates from ISPs based in the
United States than from either of the next two most proliﬁc coun-
tries (Korea and China, respectively). This conclusion does differ
from other reports, which also indicate that most spam comes from
the U.S., but to a much lesser degree. The distribution of spam by
country, when compared to the statistics for legitimate email (Ta-
ble 2), also suggests that, in some cases, assigning a higher level
of suspicion according to an email’s country of origin may be an
effective ﬁltering technique for some networks.
4.2 The Effectiveness of Blacklists
Given the transience of each IP address sending spam to our sink-
hole (i.e., the results shown in Figure 3), we suspected that ﬁltering
based on IP address, a method commonly employed by DNSBLs,
would be relatively ineffective. To test this hypothesis, we used the
results from real-time DNSBL lookups performed by Mail Avenger
to 8 different blacklists at the time the mail was received .
Figure 4 indicates that IP-based blacklisting is still working rea-
sonably well if many blacklists are consulted simultaneously: Al-
though 20% of spam came from IP addresses that were not listed in
any blacklist, (as shown by the middle line “All spam”, where about
80% spam was listed in at least one blacklist), more than 50% of
such spam was listed in two or more blacklists, and 80% was listed
in two or more blacklists.
More troubling, however, is that the spam that we received from
spammers using “BGP spectrum agility” techniques (as described
in Section 2) are not blacklisted nearly as much: half of these IP
addresses do not appear in any blacklist, and only about 30% of
these IP addresses appear in more than one blacklist.
Finding 4.4 (Effectiveness of blacklists) Nearly 80% of all spam
was received from mail relays that appear in at least one of eight
blacklists. A relatively higher fraction of Bobax drones were black-
listed, but relatively fewer IP addresses sending spam from short-
lived BGP routes were blacklisted—only half of these mail relays
appeared in any blacklist.
Although this ﬁnding appears to suggest that DNSBLs are effective
at identifying most types of spam based on IP address, the reality is
actually not as bright as it appears. First, this result is based on an
aggressive approach that sends queries to eight blacklists; Figure 5
shows the cumulative fraction of spam listed in each blacklist, from
most aggressive DNSBL to least aggressive and shows that even
the most aggressive blacklist, Spamcop, only lists about half of all
spam received. Second, many of the more aggressive blacklists are
known to have a signiﬁcant number of false positives. Finally, even
aggressive mechanisms, such as querying eight different blacklists,
are fairly ineffective at identifying IP addresses using more sophis-
ticated cloaking techniques (e.g., the BGP spectrum agility tech-
nique, which we discuss in more detail in Section 6).
5. Spam from Botnets
In this section, we amass circumstantial evidence that suggests
that a majority of spam originates from bots. Although, given our
limited datasets, we cannot determine a precise fraction of the to-
tal amount of spam that is coming from bots, we use our trace of
“Bobax” command and control data to study the patterns of spam
that are being sent from hosts that are known to be bots. First, we
study the activity proﬁle of drones from the “Bobax” botnet and
ﬁnd that the IP address space where we observe worm activity bears
close similarity to the IP address space where we observed spam-
ming activity (Finding 4.1). Second, we observe that about 70%
of all remote hosts spamming our sinkhole—and 95% of hosts for
which we could attribute some operating system—appear to be run-
ning Windows; additionally, these hosts each send relatively low
volumes of spam to the sinkhole, regardless of their persistence.
5.1 Bobax Topology
We studied the prevalence of spamming hosts versus the preva-
lence of known Bobax drones to better understand how the distri-
bution of IP addresses of Bobax-infected hosts compared to the IP
distribution of spammers in general. Figure 6 shows the results of
this analysis; the distribution of all Bobax-infected hosts is quite
similar to that of the distribution of all spammers (Figure 2).
F
D
C
 1
 0.8
 0.6
 0.4
 0.2
 0
0
0
.
.
0
0
.
Bobax Spam
Bobax IPs
0
0
.
.
.
0
0
3
0
0
.
.
.
0
0
6
0
0
.
.
.
0
0
9
0
0
.
.
.
0
0
2
1
0
0
.
.
.
0
0
5
1
0
0
.
.
.
0
0
8
1
0
0
.
.
.
0
0
1
2
0
0
.
.
.
0
0
4
2
IP Space
Figure 6: The number of all Bobax drones, and the amount of spam
received from those drones at the sinkhole, as a function of IP address
space. On the x-axis, IP address space is binned by /24.
space, which indirectly suggests that much of the spam received
at the sinkhole may be due to botnets such as Bobax.
This similarity provides evidence of correlation, not causality, but
the fact that the distribution of IP addresses from which spam is
received more closely resembles botnet activity than the spread of
IP addresses of legitimate email suggests that a signiﬁcant amount
of spam activity may be due to botnet activity.
Although the range 60.* – 67.* has a signiﬁcant fraction of spam-
ming IP addresses (Figure 2), we see relatively less spam from
Bobax drones from this space, which led us to suspect that spam-
mers may be using techniques other than botnets for sending spam
from many of the hosts in this range. Indeed, in Section 6, we
present ﬁndings that suggest that one or more sophisticated groups
of spammers appear to be sending spam from a large number of ma-
chines (or, perhaps, a smaller number of machines with changing IP
addresses), numbered from portions of unused IP space within this
range that are unroutable except for when they are sending spam.
5.2 Operating Systems of Spamming Hosts
In this section, we investigate the prevalence of each operating
system among the spam we received, as well as the total amount
of spam we received from hosts of each type. For this purpose, we
used the passive OS ﬁngerprinting tool, p0f, which is incorporated
into Mail Avenger; thus, we can attribute an operating system to
each remote host that sends us spam. Using this technique, we were
able to identify the operating system for about 75% of all hosts from
which we received spam. Table 3 shows the results of this study.
Roughly 70% of the hosts from which we receive spam, and 95%
of these hosts to which we could attribute an operating system, run
Windows; this fraction is consistent with the fact that roughly 95%
of all hosts on the Internet run Windows [20].
More striking is that, while only about 4% of the hosts from
which we receive spam are from hosts are running operating sys-
tems other than Windows, this small set of hosts appears to be