010203040506000.511.522.533.544.5x 10−5time (minutes)Hellinger Distance (HD)Normal Traffic Behavior051015202530354000.050.10.150.20.25time (minutes)Hellinger Distance (HD)Flash Crowd: INVITE Surge From 75 CPS to 500 CPS INVITE SURGE 05101520253000.010.020.030.040.050.060.070.080.09time (minutes)Hellinger Distance (HD)INVITE Flood Attack (150 per sec.)INVITE SURGE (a.)NormalTrafﬁc(b.)FlashCrowdEvent(c.)INVITEFloodAttackFig.5.HellingerDistanceCalculationHellingerDistance.LetPandQbethetwoprobabilitymeasuresonaﬁniteeventspaceΩ.ProbabilitymeasurePonΩisanN-tuple(p1,p2,...,pN),whichsatisﬁespα≥0and(cid:2)αpα=1.Similarly,QonΩisalsoanN-tuple(q1,q2,...,qN),whichsatisﬁesqα≥0and(cid:2)αqα=1.TheHellingerdistance(HD)betweenPandQisdeﬁnedas:d2H(P,Q)=12N(cid:3)α=1(√pα−√qα)2TheHDsatisﬁestheinequalityof0≤d2H≤1.Thedistanceis0whenP=Q.DisjointPandQshowsthemaximumdistanceof1.FurtherdetailsonHDcanbefoundin[13],[3].Detectionthresholdandclassiﬁcation.Thedistributionofmeasurednormaldistancesisusedtocalculatethemeanμandvarianceσ2.Giventhesetwoparameters,wewishtodeterminethevalidityoftheobserveddistancedinthetestingperiod.Todoso,weassumethatthemeasureddistanceXisarandomvariablewithmeanE(X)=μandvarianceσ2=var(X).Then,theChebyshevinequality,P(|X−μ|≥t)≤σ2t2,foranyt>0.canbeusedtocomputeanupperboundontheprobabilitythatsomerandomvariableXdeviatesfromitsmeanbymorethananypositivevaluet,givenonlythemeanandvarianceofX.Wedeﬁneaconﬁdencebandofμ±8∗σasanormalregion,inwhichtheproportionofobserveddistancesfallingintheregionisatleast98.5%.Beyondthisnormalregion,theobserveddistancesareanomalous.Once,ananomalousprotocolbehaviorisdetected,theattackclassiﬁcationisdonebycorrelatingitwiththeINVITEsurgealarm(discussedlater).Applicationofdetectionmechanism.Tomodelsecurityviolations,outofallavailableattributes,weneedonlyafractionofspeciﬁcattributestorepresentaparticulartypeofattack.TodetectINVITEﬂoodingandﬂashcrowd,wechoosefourSIPprotocolattributesofcallsetupphase,namelyINVITE,(100Trying),(200OK),andACK.Inthecaseofauthenticatedcallsetup,wecanselectchallenge/responsemessagesaswell.Here,theprobabilitymeasurePisanarrayofnormalizedfrequenciesofpINVITE,p100Trying,p200OK,andpACK(i.e.,pα=Nα/NTotalwhereα∈{INVITE,100Trying,200OK,ACK}andNTotal=(NINVITE+N100Trying+N200OK+NACK))overthetrainingdatasetassumingthatweobserveNINVITE,N100Trying,N200OKandNACKpacketsinn∗(cid:4)ttimeperiod.Similarly,duringthetestingperiod(i.e.,atthe(n+1)thsamplingduration),QisanarrayofnormalizedfrequenciesofqINVITE,q100Trying,q200OKandqACK.TocalculatetheHDbetweenPandQattheendof(n+1)thsamplingperiod,weused2H(P,Q)formula.Figure5(a.)showstheHDplotfornormalbehaviorofSIPprotocolattributeset.Duringanhour,themaximumobserveddistanceis4∗10−5andmostofthetimetheHDshowsremarkableclosenessbetweentheobservedandtrainingdatasets.Theoccasionalpeaksintheplotoverlappedtheperiodwherethetrafﬁcrateisverylow(asshowninFigure2b.)andevenafewpacketdropsandretransmissionsresultintospikes.Athigherrate,thedroppingorretransmissionsoffewpacketsaremaskedanddonotcauseanysigniﬁcantobservabledeviation.Figure5(b.)isplottedunderﬂashcrowdevent.Theinitial10minutesshowanormalbehaviorandatthestartof10thminute,aﬂashcrowdofcallrequestshappensbringingthecallratefrom75CPSto500CPS.Weobservethattowardtheendof14thminute,thedistancestartsclimbingandreachesamaximumof0.21at15.66minute.InFigure5(c.),atthestartof10thminutespoofedINVITErequestsaremixedwiththenormalrequests;consequently,intheverynextobservationperiod(i.e.,atthe10.166minute)thedistancejumpsto0.008andthenincreasestothemaximumof0.085atthe10.83minute.05101500.0020.0040.0060.0080.010.0120.0140.016time (minutes)Hellinger Distance (HD)Injection of Spoofed INVITEs in peak call rate of 75 CPS10 INVITEs/sec.15 INVITEs/sec.20 INVITEs/sec.25 INVITEs/sec.Fig.6.Low-rateAttackDetection978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
424
024681000.20.40.60.811.21.4x 10−4time (minutes)Hellinger Distance (HD)Adverse Network Condition (Internet Delay)100 ms150 ms200 msPeak Call Rate 75 CPSPacket Drop Rate 0.42% Internet Delay 50 ms 12345678910024x 10−4time (minutes)Hellinger Distance (HD)Adverse Network Condition (Packet Drop Rate)2% Drop3% Drop4% Drop5% DropInternet Delay 50 msPeak Call Rate 75 CPS 012345678900.20.40.60.81x 10−3time (minutes)Hellinger Distance (HD)Adverse Network Condition vs. Call Rate5 CPS15 CPS30 CPS75 CPSInternet Delay − 50 msPacket Drop − 0.42% Normal Behavior Effect on Normal Behavior Internet Delay − 200 msPacket Drop − 5.00 % (a.)InternetDelay(b.)PacketDropRate(c.)CallRateFig.7.SensitivityoftheProposedDetectionMechanismDistinguishingﬂashcrowdsfromDDoSattacks.Bycor-relatingINVITEsurgealert(i.e.,whenthenumberofcallsexceedsthemaximumsafelimitdeﬁnedfortheserver)andanomalousprotocolbehavioralert,wecandistinguishﬂashcrowdsfromDDoSattacks.AswithanINVITEsurgealert,iftheprotocolbehaviordistanceremainslowerthanthethresholdvalueof(μ+8∗σ=1.841∗10−6+8∗(5.76∗10−6)≈4.8∗10−5)thenitisaﬂashcrowdevent.Whereas,inDDoSattack,theprotocolbehaviordistancecrossesthethresholdvaluealongwithanINVITEsurgealarm.Furtherdiscussion.Inthissection,weaddresssomeoftheconcernsregardingtheproposeddetectionmechanism.A1.Itcouldbearguedthatasophisticatedattackermaycircumventthedetectionmechanismbysendingamixofattacktrafﬁc.The(100Trying)messageintheattributesetistheonlyper-hopmessageamongotherend-to-endmessages.Itisgeneratedbyastatefulproxyserverthatwewanttoprotect.ItleavesanattackertoplaywithACKmessagesonly.However,anACKwithoutvalidTotag(sentwithin200OKresponse)resultsin(481TransactionDoesNotExist)errormessagemakingsuchanattackeasiertodetect.A2.Sinceourproﬁlecreationisadaptive,itispossiblethatanattackercancircumventthedetectionmechanismbygraduallytrainingtheproﬁlecreation.Toovercomethedrawbackofadaptiveproﬁling,weuseadetectionschemethatissensitiveenoughtodetectlow-rateattackstoo.AsshowninFigure6,wecandetectlow-rateattacksaslowas10spoofedINVITEspersec.Inthiscase,themaximumobserveddistanceis(cid:3)4∗10−3,stillmuchhigherthanthethresholdvalueof4.8∗10−5.Thedetectionoflow-rateattacksbelow10INVITEspersec.isalsopossible,butmaycausemanyfalsealarmsasdiscussednext.A3.WhataretheeffectsofadverseInternetconditionsonthedetectionsensitivityoftheproposedmechanism?TheadverseInternetconditionsmaycausefalsealarms.Forexample,theaddedlatenciesandpacketdrops(leadingtopacketretransmissions)causetransitorydeviationfromnormalprotocolbehaviorasshowninFigure7(a.)and(b.).WeobservethattheworstInternetconditionsmaycausethedistancestojumpupto(cid:3)10−4.Toavoidsuchfalsealarms,werestrictourselvestothedetectionofabnormalbehaviorscausingdistancestotheorderof10−3.A4.Isitpossibletousethedetectionmechanisminsmallenterprisenetworkswherethecallrateisrelativelylowcomparedtovoiceserviceprovider’snetwork?Inourexperiments,weassumedthepeakcallrateof75CPSasgenerallyobservedattheserviceprovider’sswitches(e.g.,SIPservers).However,asshowninFigure7(c.),theproposeddetectionmechanismisequallyapplicabletolowcallratesastypicallyobservedinsmallenterprisenetworks.Innormalconditions,thelowcallratesuchas5CPSgeneratethedistancesof(cid:3)10−5.Evenassumingtheworstnetworkconditionsof5%packetdropand200msInternetdelay,thedistancemayjumpupto(cid:3)10−4(i.e.,stilllowerthanthethreshold).Thepropersettingofthresholdvalueat10−3achievesthreegoals:(1)itaccommodatesbothnormalpeakhourcallrateandalsonighttimeoff-peakhourcallrate;(2)itallowsthedetectionoflow-rateﬂoodingattacks;andﬁnally,(3)itreducesthepossibilityoffalsealarmsduetoadversenetworkconditions.V.STEP2:OVERLOADINGPREVENTIONMECHANISMToprotectaSIPproxyserverfromasuddensurgeofINVITErequests,theVoIPsecurityproductsandSIPproxyserversinthemarketadoptathreshold-basedINVITEratelimitingsolution.However,ithasfewdrawbacks:1)thespuriousINVITErequestsbelowthethresholdvalueremainundetected;2)thelegitimatecallrequestsbeyondthethresholdvaluearethrottled;3)theproxyserverisconstrainedtounderperform;andﬁnally,4)nodistinctionismadebetweenlegitimateandspuriouscallrequests.OurproposedstatelessdetectionmechanismprovidesanearlyalarmalongwiththenatureofimpendingoverloadingonaSIPproxyserver.Asapreventivemeasure,weproposeserver-sidepushbackcontrolforprotocolconformantINVITEsurge,whereasprotocolnonconformantINVITEﬂoodsaremitigatedbyperformingselectiveINVITEadmittance.Preventionmethodology.TheproposedschemeisbasedonTCPandSIPprotocol’sinbuiltreliabilitymechanism.SIP’sreliabilitymechanismallowstheuseofunreliableUDPbyretransmittingtheINVITErequestsatanintervalthatstartswithtimerAatT1(=500ms)anddoublesaftereveryretransmission.ThisexponentialbackoffcontinuesuntiltimerBexpiresat64∗T1msandatthattimethetransactiontimeouts.BecauseUDPispreferredtransportprotocolforSIP978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
425
messagesandlaunchingDoSattacks,ourdiscussionisfocusedonUDP-basedSIPclients.4=@1816-)@EJJ=?A=@,HFJEAJJJJIAJB?=IKHCA*JD5AA?JELA=@4=@1816-)@EJJ=?A=@,HF5122HNO5AHLAH2=?AJ+=FJKHA=@2=H=AJAH-NJH=?JE0=ID.K?JE020=ID8=KAI+KJIFAH*E0=ID+=1,>H=?DCCECB,HFFA@1816-AII=CAI),51JAHAJ0=ID5H?12Fig.8.ControlledINVITEAdmittanceandLoggingofDroppedINVITEsServer-sidePushback:AsshowninFigure8,thetimespaceisdividedintoΔt(=500ms)timewindowsasperthedefaultvalueofSIP’sT1timer.Intheﬁrstwindow,afractionofrandomlyselectedINVITEmessagesareallowedtoaccesstheSIPproxyserverandtheremainingonesareeitherstraightforwardlyrefused(i.e.,bysendingerrormessages)ordelayedforlaterprocessing.ThedelayedINVITEmessagesareloggedandthensilentlydropped(e.g.,withoutsending[100Trying]message).TheloggingofdroppedINVITEmessagesrequiressomeparametersfromtheSIPmessagebody,suchasRequest-URI,Totag,Fromtag,Call-ID,CSeq,andtopViaheaderﬁelds.However,inourexperimentsforsimpliﬁcationweselectonly3parametersSrcIP,CallID,andbranch.AsshowninFigure8,theselectedparametersareextracted,concatenatedandhashedtouniquevalues.Thehashof(CallID(cid:10)branch)correspondstoahashbinwithaninitialcountervalueof1.ThishashvalueactsasanuniqueidentiﬁerforthecapturedINVITEmessagesthatcandistinguishanewINVITEmessagefromtheretransmittedINVITEmessages.Eachtime,withthearrivalofanINVITEmessage,iftheloggingmoduledetectsthesamehashedvaluepointingtoanalreadyexistinghashbin,thenthecountervalueisincrementedotherwiseanewhashbiniscreatedwithaninitialcountervalueof1.TheuniquevalueofSrcIPactsasanindextoreachtoitscorrespondinghashbins.ItalsohelpsinobservingthenumberofsessionsopenedbyasinglesourcethatmayleadinanearlydetectionofanimpendingDDoSattack.Ourimplementationofhashbinsandcounterscorrespondtokey-valuepairsofahashtable.Thecreationofbinsandtheincrementationofcountersoccurineachtimewindow.Attheendofonetimewindowandduringthenext,anewhashtableiscreated.However,atanytimeonlyfewhashtablesexistinthememory.Infact,thehashtablesarearrangedinacircularfashionandthenumberofhashtablesinthecircleiscloselyrelatedtothechosenexponentialbackofftimervalue.Thechosenexponentialbackofftimervaluegivestheﬂex-ibilityofacceptingretransmittedINVITEmessagesafteranyof1,2,3,...drops(uptosixthretransmittedmessage).Forexample,anexponentialbackofftimervalueT1(e.g.,INVITEsaredroppedonlyonce)allowsﬁrstretransmittedINVITEtoaccessserverresourcesandweneedtomaintainatleast2hashtablesinthememory.Similarly,theexponentialbackofftimervalueof2∗T1(e.g.,INVITEsaredroppedtwice)requiresatleast4hashtablesinthememory.WehavesofarseentheINVITEmessagesprocessinginoneparticulartimewindow(saythenthtimewindow).Nowwedescribewhathappensinthenextsubsequent(n+1)thtimewindow.AssumingthatourselectedexponentialbackofftimervalueisT1,theincomingINVITEsareﬁrstcheckedinthehashtableofprevioustimewindow.IfthemembershiptestsucceedsthenitisaretransmittedINVITEandallowedtoaccessSIPproxyserverafterincrementingthecountervalue.Theknowledgeofprevioushashtable’scountervalueallowsustoblockallothersubsequentretransmittedmessagesasitmaybeapartofDoSattack.AfractionoftheremainingINVITEsthatdonotpassthemembershiptestareeitherrefusedorsilentlydroppedandloggedinthecurrenthashtablecorrespondingtothe(n+1)thtimewindow.TheotherINVITEmessagesareallowedtoaccessSIPproxyserverresources.Inthe(n+2)thtimewindow,thenthhashtableisdeletedandinitsplaceanewhashtableiscreatedfortheloggingofdroppedINVITEmessagesofthiscurrenttimewindow.5AHA7IAHIF=?A1?EC2=?AJ?=>=?BK?JEAJBEJAH0EFJ=>AIGKAKECE>H=HO+JEKAKHAO2=?AJ8AH@E?J,HFF=HIAJDAF=?AJ1816-AII=CA2=II)++-26F=?AJLAH@E?J2=II,42F=?AJLAH@E?JA>AHIDEFJAIJF=IIA@+DA?EJIA>AHIDEFEJDAFHALEKID=IDJ=>AI:BF=?AJI=HAH=@OIAA?JA@BH@HF1IJDEIF=?AJ=??AFJA@BHCCECCEJDA?KHHAJD=IDJ=>AOAI=??AFJ@HFOAIOAIOAI1IJDEIF=?AJ=??AFJA@OAIFig.9.TheFlowofCapturedINVITEPacketsServer-sideSelectiveINVITEAdmittance:TheworkingofselectiveINVITEadmittancecontrolisverysimilartotheserver-sidepushbackcontrolasdescribedearlier.ThedifferenceisinitsmorerestrictivenessinallowingINVITEmessagestoaccessserverresources.Intheﬁrsttimewindow,theselectiveINVITEadmittancelogsandthensilentlydis-cardsallofthereceivedINVITEmessages.Inthesubsequenttimewindows,onlythoseINVITEsareallowedtoaccessserverresourceswhichhaveshownitsmembershipinthedigesttablesofprevioustimewindows.Applicationofprotectionmechanism.OurPC-basedproto-typeofprotectionmechanismusesNetﬁlter,apacketﬁlteringsubsystemintheLinuxkernelstack[12].OurprototypeimplementationisdoneattheSIPproxyserverhost(1.8GHzIntelPentiumIVwith512MBRAM)itself,thereforeweuseonlyNFIPLOCALINhookthatisusedforthepacketsdestinedtolocalhostandbeforebeingpassedtothelocalprocess.Byusingiptables[12]userspacepacketqueuinglibrary,packetsaretakenoutofthestackandqueued978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
426