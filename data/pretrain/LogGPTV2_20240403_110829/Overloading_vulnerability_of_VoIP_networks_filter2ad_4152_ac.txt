### Hellinger Distance Calculation and Application in Network Security

#### Introduction
The Hellinger distance (HD) is a measure used to quantify the difference between two probability distributions. In the context of network security, it can be employed to detect anomalies in traffic behavior, such as flash crowds and DDoS attacks. This document provides an overview of how HD is calculated and applied to detect and classify abnormal protocol behavior.

#### Hellinger Distance Definition
Let \( P \) and \( Q \) be two probability measures on a finite event space \( \Omega \). The probability measure \( P \) on \( \Omega \) is an N-tuple \( (p_1, p_2, \ldots, p_N) \), where \( p_\alpha \geq 0 \) and \( \sum_{\alpha} p_\alpha = 1 \). Similarly, \( Q \) on \( \Omega \) is an N-tuple \( (q_1, q_2, \ldots, q_N) \), where \( q_\alpha \geq 0 \) and \( \sum_{\alpha} q_\alpha = 1 \).

The Hellinger distance (HD) between \( P \) and \( Q \) is defined as:
\[ d^2_H(P, Q) = \frac{1}{2} \sum_{\alpha=1}^{N} (\sqrt{p_\alpha} - \sqrt{q_\alpha})^2 \]

The HD satisfies the inequality \( 0 \leq d^2_H \leq 1 \). The distance is 0 when \( P = Q \), and disjoint \( P \) and \( Q \) show the maximum distance of 1.

#### Detection Threshold and Classification
The distribution of measured normal distances is used to calculate the mean \( \mu \) and variance \( \sigma^2 \). Given these parameters, we determine the validity of the observed distance \( d \) in the testing period. We assume that the measured distance \( X \) is a random variable with mean \( E(X) = \mu \) and variance \( \sigma^2 = \text{var}(X) \).

Using Chebyshev's inequality:
\[ P(|X - \mu| \geq t) \leq \frac{\sigma^2}{t^2} \]
for any \( t > 0 \), we can compute an upper bound on the probability that some random variable \( X \) deviates from its mean by more than any positive value \( t \), given only the mean and variance of \( X \).

We define a confidence band of \( \mu \pm 8 \sigma \) as the normal region, in which the proportion of observed distances falling in this region is at least 98.5%. Beyond this normal region, the observed distances are considered anomalous. Once an anomalous protocol behavior is detected, the attack classification is done by correlating it with the INVITE surge alarm (discussed later).

#### Application of Detection Mechanism
To model security violations, we need specific attributes to represent particular types of attacks. For detecting INVITE flooding and flash crowd, we choose four SIP protocol attributes of the call setup phase: INVITE, 100 Trying, 200 OK, and ACK. In the case of authenticated call setup, we can also select challenge/response messages.

The probability measure \( P \) is an array of normalized frequencies \( (p_{\text{INVITE}}, p_{100 \text{Trying}}, p_{200 \text{OK}}, p_{\text{ACK}}) \) over the training dataset, assuming we observe \( N_{\text{INVITE}}, N_{100 \text{Trying}}, N_{200 \text{OK}}, \) and \( N_{\text{ACK}} \) packets in \( n \times t \) time periods. Similarly, during the testing period (i.e., at the \( (n+1) \)-th sampling duration), \( Q \) is an array of normalized frequencies \( (q_{\text{INVITE}}, q_{100 \text{Trying}}, q_{200 \text{OK}}, q_{\text{ACK}}) \).

To calculate the HD between \( P \) and \( Q \) at the end of the \( (n+1) \)-th sampling period, we use the \( d^2_H(P, Q) \) formula.

#### Experimental Results
- **Normal Traffic Behavior** (Figure 5(a)): During an hour, the maximum observed distance is \( 4 \times 10^{-5} \). Most of the time, the HD shows remarkable closeness between the observed and training datasets. Occasional peaks in the plot overlap with periods where the traffic rate is very low, and even a few packet drops or retransmissions result in spikes.
- **Flash Crowd Event** (Figure 5(b)): The initial 10 minutes show normal behavior. At the start of the 10th minute, a flash crowd of call requests happens, bringing the call rate from 75 CPS to 500 CPS. By the end of the 14th minute, the distance starts climbing and reaches a maximum of 0.21 at 15.66 minutes.
- **INVITE Flood Attack** (Figure 5(c)): At the start of the 10th minute, spoofed INVITE requests are mixed with normal requests. Consequently, in the very next observation period (i.e., at 10.166 minutes), the distance jumps to 0.008 and then increases to a maximum of 0.085 at 10.83 minutes.

#### Low-Rate Attack Detection
Figure 6 shows the detection of low-rate attacks. For example, injecting spoofed INVITEs at rates of 10, 15, 20, and 25 INVITEs per second. The maximum observed distance is \( 4 \times 10^{-3} \), still much higher than the threshold value of \( 4.8 \times 10^{-5} \).

#### Sensitivity to Adverse Network Conditions
Adverse Internet conditions, such as added latencies and packet drops, can cause transient deviations from normal protocol behavior. Figure 7 shows the sensitivity of the proposed detection mechanism under different adverse conditions:
- **Internet Delay** (Figure 7(a)): Delays of 50 ms, 100 ms, 150 ms, and 200 ms.
- **Packet Drop Rate** (Figure 7(b)): Drop rates of 2%, 3%, 4%, and 5%.
- **Call Rate** (Figure 7(c)): Call rates of 5 CPS, 15 CPS, 30 CPS, and 75 CPS.

#### Distinguishing Flash Crowds from DDoS Attacks
By correlating the INVITE surge alert (i.e., when the number of calls exceeds the maximum safe limit defined for the server) and the anomalous protocol behavior alert, we can distinguish flash crowds from DDoS attacks. If the protocol behavior distance remains lower than the threshold value of \( \mu + 8 \sigma \approx 4.8 \times 10^{-5} \), it is a flash crowd event. In DDoS attacks, the protocol behavior distance crosses the threshold value along with an INVITE surge alarm.

#### Overloading Prevention Mechanism
To protect a SIP proxy server from a sudden surge of INVITE requests, we propose a server-side pushback control for protocol-conformant INVITE surges and selective INVITE admittance for non-conformant INVITE floods.

- **Server-Side Pushback**: In each time window (Î”t = 500 ms), a fraction of randomly selected INVITE messages are allowed to access the SIP proxy server, while the remaining ones are either refused or delayed for later processing. The delayed INVITE messages are logged and then silently dropped.
- **Selective INVITE Admittance**: In the first time window, all received INVITE messages are logged and silently discarded. In subsequent time windows, only those INVITEs that have shown membership in the digest tables of previous time windows are allowed to access server resources.

#### Implementation
Our prototype implementation uses Netfilter, a packet filtering subsystem in the Linux kernel stack. The implementation is done at the SIP proxy server host (1.8 GHz Intel Pentium IV with 512 MB RAM) using the NF_IP_LOCAL_IN hook for packets destined to the local host.

This approach provides an effective and adaptive method for detecting and mitigating various types of network attacks, ensuring the robustness and reliability of SIP-based communication systems.