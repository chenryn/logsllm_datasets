1"
2"
3"
7"
8"
9"
10"
11"
12"
This"is"how"networks"show"up"in"your"network"list"when"searching"for"wiﬁ"networks"
on"your"device."
13"
When"you"join"a"network,"this"interacCon"happens."
14"
15"
16"
KARMA"aKacks"do"exactly"the"same"thing"as"a"normal"associaCon,"it’s"just"an"evil"AP"
instead"of"the"actual"AP"doing"it."
17"
18"
19"
20"
This"is"why"KARMA"aKacks"weren’t"working"well,"we"weren’t"responding"to"the"
broadcast"probes.""
21"
22"
23"
In"trying"to"ﬁgure"out"the"issue,"we"went"to"the"place"we"should"always"see"probes,"
hidden"networks."Hidden"networks"don’t"return"the"ESSID"in"response"to"broadcast"
probes."
24"
The"AP"only"gives"up"it’s"name"if"the"device"probes"for"it"speciﬁcally"(i.e."you"must"
know"the"name"already)."
25"
26"
This"means"that"iOS"devices"are"passively"looking"for"beacons"from"hidden"networks."
Why"not"do"that"for"all"networks?"
27"
28"
29"
30"
31"
Probe"responses"contain"a"ﬂag"indicaCng"whether"they"are"WEP,"WPA/2"PSK,"WPA/2"
EAP"etc."This"is"used"as"part"of"the"“uniqe”"match"for"PNL"networks."
32"
33"
This"speciﬁc"part"is"sCll"under"heavy"tesCng"at"the"Cme"of"wriCng."
34"
We"don’t"have"the"creds."But,"we"can"have"our"rogue"AP"act"as"a"WPA/2"network"and"
send"the"ﬁrst"packet,"and"we"capture"the"second."We"don’t"have"the"right"key,"and"
can’t"generate"the"Temporal"key,"but"we"have"anonce"and"snonce"and"a"MIC"from"
the"client,"so"we"can"aKempt"to"brute"the"key"unCl"we"can"generate"a"MIC"for"the"
snonce"that"matches"the"clients."Josh"Wright’s"coWPAKy"tool"ﬁrst"did"this."
35"
With"EAP,"we"have"a"similar"problem,"but"if"the"client"isn’t"validaCng"correctly,"we"
can"MitM."EAP"TLS"is"mutually"authenCcated"so"we"can’t"here"(just"included"for"a"
simpler"decripCon)."
36"
We"can"MitM"PEAP"and"PEAPdlike"EAPs"most"of"the"Cme."This"is"because"most"
conﬁguraCons"don’t"validate"the"server"cert,"and"even"when"they"do,"there"is"no"CN"
name"match,"it’s"purely"on"authority."A"successful"MitM"gets"up"an"MSCHAPv2"
challenge"response"(depending"on"setup).""
37"
38"
39"
40"
41"
42"
43"
44"
45"
46"
47"
48"