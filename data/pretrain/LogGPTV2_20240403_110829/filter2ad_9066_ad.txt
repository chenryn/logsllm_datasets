0day
漏洞、恶意代码等单点环节上，既无助于对其整个过程进行全面的分析，也难以有效地指导防御工作。为应对高能力网空威胁行为体的攻击活动，安全人员需要有体系化、框架化的威胁分析模型，对其行为展开更深入、系统的分析，理解威胁，进而实现更有效的防御。当前类似的分析模型包括洛克希德·马丁公司（Lockheed
Martin）的 Kill Chain（杀伤链）和 MITRE 公司的 ATT&CK 等。
Kill Chain由洛克希德·马丁公司于 2011
年提出，定义了攻击者为达到目标必须要完成的7个阶段，并认为防御者在任意一个阶段打破链条，就可以阻止入侵者的攻击尝试。Kill
Chain将网络攻击模型化，有助于指导对网络攻击行动的识别和防御，但整体上粒度较粗，全面性不足，相应的应对措施也缺乏细节支撑。为解决上述问题，MITRE
公司在Kill Chain 的基础上，提出了 ATT&CK 模型，即对抗战术、技术和通用知识库，将入侵全生命周期期间可能发生的情况划分为 12
个阶段，分别为初始访问、执行、权限提升、防御逃避、凭证访问、发现、横向移动、收集、命令与控制、渗出和影响，每个阶段又细分了具体的攻击技术。ATT&CK
提供了对每一项技术的细节描述、用于监测的方法及缓解措施，有助于安全人员更好地了解网络面临的风险并开展防御工作。但 ATT&CK
侧重于具体的攻击技术，在层次性和对入侵行为的分类方面偏弱。
NSA 和 CSS 参考各类现有框架，于 2018 年 3 月发布了《 NSA/CSS 技术网空威胁框架》（NSA/CSS Technical Cyber
Threat
Framework）（以下简称“威胁框架”）V1版本，该框架是一个基于国家情报总监（DNI）网空威胁框架开发的、与网空行为活动紧密结合的通用技术词典，NSA
在整个情报体系内共享这一词典，实现对情报共享、产品研发和作战规划的支撑，促进情报体系各机构间更紧密地合作。
随着网络威胁不断升级，NSA 和 CSS 在“威胁框架” V1 的基础上进行调整和延伸，对其中划分不细致、归类不准确的内容进行重新梳理，于 2018 年
11 月发布了 V2 版本。“威胁框架” V2 共包含 6
个阶段（Stage）、21个目标（Objective）、188种行为（Action）和若干个关键词（Key
Phrases），提供了标准定义，能够指导讨论攻击者全生命周期内的活动，呈现攻击事件全貌，可视化攻击者所使用的策略及手段，协助安全人员制定针对性的防御措施。
由于“威胁框架”尝试将各种可能的目标和行为涵盖在内，其恰恰将其自身和关联的专属攻击能力也涵盖在内。例如，“方程式组织”覆盖各种型号硬盘固件持久化能力，“量子”（QUANTUM）攻击系统修改通信路径的能力，“湍流”框架下的被动信号收集系统“混乱”（TURMOIL）向中点发送信标、仿冒合法流量的能力等等，都能够在“威胁框架”中得到映射，体现出其体系化、复杂化的网空攻击能力。因此，“威胁框架”对于梳理来自超高能力网空威胁行为体的网空攻击活动来说，就成为了非常有效的方法框架体系。
图 5 1 NSA/CSS技术网空威胁框架
安天以“威胁框架” V2
为参考，对超高能力网空威胁行为体攻击行动的各阶段行为进行标准化描述和分类，协助分析这些行为体的意图和行为，为相关防御工作的开展提供借鉴。
通过本次事件的复盘分析，可将该事件中涉及的威胁行为映射到“威胁框架” V2
中。攻击者基于长期环境准备，在多个国家或地区建立大量跳板机资源，可以随时选择发起攻击，利用 ZESTYLEAK、BARGLEE、BANANAGLEE
攻击装备打击防火墙，获得防火墙权限，实现对设备的控制并管理服务器。利用“永恒”系列漏洞获取服务器控制权后在其上执行 sql 脚本，查询与服务器相连的
Oracle 数据库中的信息，获取凭证以及内部架构信息。利用已获取的凭证对相关 Windows
的主机和服务器实现远程登陆，横向移动到不同的办公地点主机继续收集相关用户凭证。最后，采用数据加密等规避手段防止受害者发现威胁。这些行动都能够与“威胁框架”的类别与动作建立映射。
图 5 2 本次事件映射到威胁框架
这一攻击事件共涉及 15 个目标中的 47 种行为，其中包括推测的和确定执行的行为。经过分析，确定使用的行为如下：
侦察：收集凭证、测绘可访问网络、扫描设备；
环境预制：应用数据文件中添加可利用点、建立跳板、预置载荷；
投递：利用受感染主机；
利用：利用固件漏洞、利用本地应用程序漏洞、利用操作系统漏洞、利用远程应用程序漏洞、利用零日漏洞；
执行：通过服务控制器执行、利用解释脚本、利用系统接口、写入磁盘；
内部侦察：枚举账号和权限、枚举文件系统、枚举操作系统和软件、枚举进程、测绘可访问网络、嗅探网络；
提权：利用操作系统漏洞；
凭证访问：定位凭证；
横向移动：远程登录、利用远程服务、写入远程文件共享；
渗出：从本地系统收集、从网络资源收集、压缩数据；
命令与控制：中继通信；
规避：规避数据大小限制、加密数据、操纵受信进程、仿冒合法流量、使用rootkit、将文件存储在非常规的位置、根据环境调整行为。
同时，对于进行这种复杂、严密、动用大量网空攻击装备资源的攻击，必然有系统的前期准备工作，包括规划统筹、确定目标、选择攻击装备（也可能包括为现有攻击装备不覆盖的IT场景临时研发装备）等。
### **6、事件总结**
基于对被攻击资产情况、所使用攻击装备和攻击过程的复盘梳理，这份报告基本呈现出了整体的攻击全貌。从时间发生的 2012~2013
年的背景来看，被攻击目标的布防情况，总体体现出在那个时代信息资产的布防特点，部署了包括
VPN、防火墙、主机杀毒等基础安全环节，对内部资产做了基本的分区，进行了一定的配置加固等等。这些防护手段是建立起网络防御体系的基本工作，对于防范一般性的网络攻击是有效的，但对于防护超高能力网空威胁行为体则是完全不足的。
同时，通过相关泄露的资料，也可以看到系统管理者存在一些非常明显的配置和安全策略失误。例如，同组的多台服务器采用相同的超级用户口令，导致一旦其中一台的口令被提取还原或嗅探，就可以被连锁突破；不同组的服务器口令存在明显的“公共部分+序号”的可猜测规律；防火墙没有对可以访问管理接口的
IP 地址作出明确的限定策略等。
但建立起能够有效防御高级网空威胁行为体的防御体系，并不是简单的查缺补漏，而是一个复杂艰巨的过程：
（1）
必须直面开放式场景和信息系统规模增长带来的安全挑战，全面提升网络安全规划能力，落实全生命周期的安全规划建设运维。传统银行系统依靠物理安全隔离保障自身资产的时代早已过去，随着跨行转账、通存通兑，类似
SWIFT
等服务就必然成为在公网上可以到达的基础设施。必须立足于开放式场景的现实条件、信息系统规模日趋扩大和复杂度日趋增加的前提，信息系统的开放度越高，规模越庞大，就越需要在规划、建设和运维的全生命周期同步提升网络安全整体能力，就越需要系统全面的安全规划。
（2）
重要信息资产和规模性信息资产，需要以“敌已在内，敌将在内”作为客观敌情设定。鉴于当前信息系统的规模、供应链的复杂程度以及各类信息交换的必然性，将威胁阻挡在边界（安全网关或网闸）之外已经是一种高度不现实的想象。对于掌握大量突破隔离网络装备、可以渗透配送物流环节、可以进行上游供应链预置作业的超级网空威胁行为体来说，其既可能从网络边界逐层突破，也可能借助其他作业手段直接建立内部桥头堡。因此，对于关键基础设施和重要信息系统，必须将“敌已在内”和“敌将在内”作为最基础的敌情设定。安天在2017年提出了“有效的敌情想定是做好网络安全防御工作的前提”的观点，这是源于军事演习的防御思考，但在过去两年的理念的不断推动实践中，我们日趋感到网络空间所面临的风险，比演习想定更为严峻。敌将在内，可以作为一种想定，指导“防患于未然”的规划。而敌已在内，则已经构成了“现实战情”，需要具备将威胁行为体“找出来，赶出去”的威胁猎杀能力。
（3）
参考的“威胁框架”，更新对威胁行为体和攻击活动的系统性认知，以深化和完善敌情设定，进而改善防御。网络防御者必须直面高级网空威胁行为体，掌握着大量高级装备和攻击资源，其行动是复杂过程组合的既定事实，同时复杂的过程并不必然均由“高级”攻击手段和“高级”装备支撑。一方面，一些低级的配置错误和未及时修补的漏洞会成为威胁行为体进入的入口；另一方面，高级网空威胁行为体也会劫持和利用低级网空威胁行为体所掌控的僵尸网络等资源。将安全防护工作视为对各种威胁类型如恶意代码、DDoS、网站篡改和僵尸网络等的一一应对，进行产品堆砌，显然不能组合起有效防御体系。而从威胁框架出发，针对威胁每个阶段、逐个行为推演，无论对评估当前防御体系及相关安全产品能力的有效性和合理性，还是对形成体系化的防御规划与建设目标，都是一种有益的工作。