在定义日志打印标准时，应考虑到以下因素：
-   自定义日志文件打印路径，便于调试查看；
-   日志自动分割；
-   日志要包含告警插件名称、告警的名称、每一次告警的MD5值、时间、级别等；
-   调用方法的时候要把入参打印完整；
-   调用接口的时候要打印入参，请求用时，返回值，来源等关键字段。
# 告警维护期
日志易系统支持设置【维护期】功能。当故障已经明确发生，或者即将开始计划内的调整动作时，系统内的各种告警已经没有必要执行，因为数据肯定是没用的。维护期让用户主动指明现在是维护期间，维护期间影响的若干监控项实际不触发告警。维护结束，涉及的监控恢复到之前的状态。
告警维护期应用的场景如下：
如果我们系统每周五进行更新操作，我们的一些监控检测到应用不可用那么就会进行告警，而这些告警是我们可以忽略的。我们不想接收这些告警，该怎么办呢？可以设置每周五停止告警。如果以后的告警越来越多，每次操作太浪费时间了。这时候使用维护期将这些告警管理起来，每到周五的更新点都暂停执行。
![图片包含 屏幕截图
描述已自动生成](media/image88.png){width="4.259568022747157in"
height="4.243146325459318in"}
维护周期可以选择定时或单次，定时可以选择每天，每周和每月。影响范围点击选择具体监控项，可通过标签快速过滤。
维护期间，监控列表影响的监控显示"正在维护"。用户在维护期间不会接收到被触发的监控。
![图片包含 屏幕截图
描述已自动生成](media/image89.png){width="5.777777777777778in"
height="0.5576388888888889in"}
另，不管是开始还是结束，登记的时间和操作的时间哪个晚，就是哪个为准。具体示例如下：
-   用户在16:00创建一次维护期，选择维护时间为16:10-17:10；那么系统自动在16:10停止，17:10启动。
-   用户在16:10创建一次维护期，选择维护时间为16:00-17:10，那么系统自动在16:10停止，17:10启动。
-   用户在16:10创建一次维护期，选择维护时间为16:00-?，那么系统自动在16:10停止；等到用户在17:10再次登录，修改维护为17:00，那么系统在17:10启动。
# Cruxee
随着网络的发展，大数据时代的到来，运维工程师经常被告警风暴困扰，告警风暴的形成主要有这几个原因：
-   告警重复度高，告警策略执行周期计算，会持续产生重复报警。
-   告警关注度不足，尤其是夜间告警的关注率低至25%。
-   告警接人冗余，报警策略的接收人往往会填写了运维团队中的所有人，但实际值班人只有一个人，大家按周期轮转。因此，对于一个特定的报警，大部分同学是不需要即时关注的。
-   告警时效性不足，40%以上告警只需要简单的处理即可恢复，比如磁盘打满或者内存泄露等。
日志易提供Cruxee应用，即事件合并处理应用，可以把若干描述同一故障的报警合并在一起，让值班工程师可以快速捕捉到故障本质，甚至故障根因，而并非一味的削减报警量。
![cruxee-overview-map](media/image90.jpeg){width="5.759722222222222in"
height="2.15in"}
如上图所示，Cruxee提供的功能有：
-   多平台告警统一。来自不同平台的告警需要进入合并系统进行进一步的分析和使用，例如，三个公司分别为rizhiyi，nagios和zabbix，可以同时将告警数据结构化到AlertCEF表中。
-   事件流模式，告警的接收是实时。
-   提取本质信息。解决告警冗余并不是简单删除重复的告警，而是保留告警信息，并进行合理的合并。Cruxee提供默认归并策略，同时支持用户自定义归并策略。
-   解决告警冗余导致的告警风暴问题。告警的周期时间短，告警A和告警B有关联等应用情景都会产生告警冗余的问题，实际上运维人员并不需要处理那么多的告警，只需要处理归并后的事件。
## 基本概念及功能
Cruxee中的基本概念有：
-   AlertCEF：告警统一格式，其中CEF（Common event
    > format）是标准事件格式的意思。所有接收的事件必须满足AlertCEF。
    > AlertCEF格式详见章节《数据对接》。
-   Event：一次告警发送事件，即event可以重复，alertCEF只记录一次。
-   Incident：告警合并后的事件，将告警通过合并策略进行合并，分组到一个或者多个Incident中，event和incident是多对多的关系。
    Cruxee首页如下图所示。
    ![](media/image91.png){width="5.761111111111111in"
    height="2.857638888888889in"}
```{=html}
```
-   多平台告警统一。来自不同平台的告警需要进入合并系统进行进一步的分析和使用，例如，三个公司分别为rizhiyi，nagios和zabbix，可以同时将告警数据结构化到AlertCEF表中。
-   事件流模式，告警的接收是实时。
-   提取本质信息。解决告警冗余并不是简单删除重复的告警，而是保留告警信息，并进行合理的合并。Cruxee提供默认归并策略，同时支持用户自定义归并策略。
-   解决告警冗余导致的告警风暴问题。告警的周期时间短，告警A和告警B有关联等应用情景都会产生告警冗余的问题，实际上运维人员并不需要处理那么多的告警，只需要处理归并后的事件。
    Cruxee的功能菜单主要包括以下内容：
```{=html}
```
-   合并策略：合并策略是event合并到incident的路由，cruxee提供默认合并策略，也支持自定义合并策略。
-   策略统计：该页面可根据所选配置，包含时间（今天/周/月/季度）和计算方法，统计各合并策略分组内事件状态的等级分布，以及浮动涨跌幅。
-   事件管理：Cruxee首页，用户的主要工作区，用户可对incident（告警合并后的事件）进行查看，处理，分配，评论等操作。
-   处理统计：通过设置时间（周/月/季度）和及时率，针对incident被处理的操作用户，展示该用户对incident的操作表现。由于不同公司对incident的处理完成时限要求不一样，可点击设置及时率的阈值。
-   发送策略：用户可以使用发送策略配置多种发送方式通知用户，可以选择不同优先级关联不同发送方式，例如优先级严重/重要关联电话通知，优先级中等关联短信/微信通知，优先级一般关联邮件通知。
## 事件管理
点击应用中的事件管理，进入Cruxee应用，事件管理是Cruxee的首页，也是用户的主要工作区，用户可以对incident进行查看，处理，分配，评论等操作。
如下图依次介绍事件处理页面的内容：
![incident introduce](media/image92.png){width="5.833333333333333in"
height="3.0940944881889765in"}
1.  过滤框：搜索关键字或者负责人。
2.  incident提供3个快捷过滤方式：\"全部\"，\"我的\"和\"未分配\"，默认选中\"全部\"。
3.  时间范围：默认是最近10天，可以自定义时间范围。
4.  排序方式：优先级从高到低，优先级从低到高，时间升序，时间降序。
5.  批量操作：点击\"批量操作\"，进入下图，选中incident，分配负责人或者更改状态。
    ![incident batch
    operation](media/image93.png){width="5.833333333333333in"
    height="2.6195548993875764in"}
-   点击\"取消\"，退出批量操作模式。
6.  incident列表，每行展示incident的主要属性，从上到下，从左到右依次介绍具体内容：
    -   时间范围：是incident内event的最早和最晚时间。
    -   maintitle：是合并策略的分组字段，如果分组字段值为空，则maintitle为空。
    -   subtitle：取进入incident的第一条event的summary，如果没有summary则取名称。
    -   优先级icon和event数量：incident的优先级是取第一条event的优先级。深红色代表严重，红色代表重要，橙色代表中等，蓝色代表一般，蓝绿色代表较低，绿色代表告警恢复。告警恢复不在incident列表展示。
    -   状态：待分配，工作中，已解决，已分配。
    -   评论信息：展示评论icon和评论数量。
    -   负责人：展示incident负责人。
7.  incident属性详情：包括maintitle，subtitle，状态和负责人。incident默认状态是待分配，如果指定负责人，则状态自动变为工作中；如果处理完成，则修改状态为已解决或已忽略。所有操作都会展示在操作记录中。
8.  incident详情包括3个tab：告警，评论和操作记录。
    -   告警：展示告警列表。
    -   评论：可以添加评论，可以关联一个或多个知识，也可以创建新的知识。
        ![cruxee incident comment
        1](media/image94.jpeg){width="5.704861111111111in"
        height="6.2243055555555555in"}
        ![cruxee incident commit
        2](media/image95.jpeg){width="5.747222222222222in"
        height="4.495833333333334in"}
    -   操作记录：展示针对该incident的所有操作。
        ![cruxee incident oper
        history](media/image96.png){width="3.928472222222222in"
        height="4.844444444444444in"}
默认日志易平台的告警记录会发送到Cruxee，如果没有匹配到合并策略，一个event是一个incident。
## 合并策略
合并策略是event合并到incident的路由，cruxee提供默认合并策略，也支持自定义合并策略。event合并为incident的流程如下图：
![cruxee policy flow](media/image97.jpeg){width="5.833333333333333in"
height="4.388194444444444in"}
每条event会检查所有自定义合并策略，如果一条event符合多个自定义合并策略的规则，则会该event会合并到多个incident中；如果都不符合，则该event会合并到新创建的incident中，新创建的incident只包含这一条event。
### 合并策略列表
合并策略列表展示策略名称，描述，分组字段，编辑操作和删除操作。
![policy list](media/image98.png){width="5.833333333333333in"
height="1.1645833333333333in"}
### 默认合并策略
合并策略DEFAULT是cruxee提供的默认策略，优先级是0，只能查看不能编辑。
默认合并策略DEFAULT的规则如下：
-   应用条件：\*
-   分组字段：alert_id
-   闭合条件：持续发生超过24小时闭合，事件中止超过check_interval，两者是OR的关系。其中check_interval是监控配置的执行计划：
    ![cruxee check
    interval](media/image99.png){width="5.478472222222222in"
    height="2.2875in"}
-   发送条件：无
### 自定义合并策略
在合并策略列表点击\"新建\"，进入新建合并策略页面。自定义合并策略的优先级是1，高于DEFAULT策略。
![cruxee new policy](media/image100.jpeg){width="5.833333333333333in"
height="4.172800743657043in"}
合并策略的属性有：
-   名称：必填。
-   描述：可选。
-   应用条件：框内是and关系，框外是or关系。当应用条件未配置时，实际应用条件是\*。
```{=html}
```
-   ![cruxee merge policy app
    condition](media/image101.jpeg){width="5.833333333333333in"
    height="3.9156244531933506in"}
```{=html}
```
-   分组字段：可选，最多添加5个分组字段，分组字段间是and关系。
    -   incident列表的maintitle展示\"分组字段值1 \| 分组字段值2 \|
        ...​\"。
    -   incident详情的maintitle展示\"分组字段1：分组字段值1，分组字段：分组字段值2，...​\"。
    -   每个event最少属于一个incident。
-   闭合条件：闭合意味着：incident不再接收的event，新接收的event进入新创建的incident，但仍可以对已闭合的incident进行分配，处理，评论等操作。
    -   默认闭合条件都24h自动闭合。
    -   最新事件：选择字段满足条件后闭合。例：名称中包含OK时闭合。
    -   持续发生超过_秒/分钟/小时，默认24小时。例：每小时接收到的event合并为一个incident，则只需设置持续发生超过1小时即可。
    -   分组数量超过\_：分组内event数量超过输入值后闭合。
    -   事件中止超过_秒/分钟/小时：如event未生成或cruxee接收超过输入值后闭合。
    ```{=html}
    ```
    -   ![cru mergepolicy close
        condition](media/image102.jpeg){width="5.833333333333333in"
        height="1.4306080489938757in"}
-   发送策略：下拉框可选，需要用户先创建发送策略才可以选择。详情请见下一章《发送策略》。
-   默认合并策略新建后立即启用。
## 发送策略
用户可以使用发送策略配置多种发送方式通知用户，可以选择不同优先级关联不同发送方式，例如优先级严重/重要关联电话通知，优先级中等关联短信/微信通知，优先级一般关联邮件通知。