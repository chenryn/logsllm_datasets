NSM 101 for ICS 
About me 
Chris Sistrunk, PE 
Electrical Engineer 
Sr. ICS Security Consultant 
– Control system security assessments 
– ICS Village (DEF CON & RSA Conference) 
Entergy (11+ years) 
– SCADA Engineer (10 years) 
– Project Robus (ICS Protocol Fuzzing) 
• 30+ implementation vulnerabilities in DNP3 stacks 
– Substation Security Team 
BSidesJackson 
What happens when you use nmap  
or a fuzzer on an ICS? 
If ICS are so vulnerable, 
why haven’t we seen 
more attacks? 
We aren’t looking! 
Two Key Reasons 
Intent 
Visibility 
Intent 
Very little ICS targeted attack data 
 Maroochy Shire to Stuxnet to German Steel Plant 
Why are targeted attacks different? 
 It’s a “Who” not a “What” 
 Professional, organized, well-funded 
 If you kick them out, they will return 
Visibility 
Visibility 
Public ICS Vulnerabilities Per Year 
If your ICS gets hacked… 
gadgets       
water 
electricity 
you can’t make 
anymore 
Now what? 
 More Gov’t security regulations 
 ICS security still lagging 
 Breaches are inevitable 
 Attacks aren’t stopping 
 Every sector 
 Including ICS 
What can we do to get ahead of this??? 
Network Security Monitoring 
“The collection, analysis, and escalation of 
indications and warnings to detect and respond 
to intrusions. NSM is a way to find intruders on 
your network and do something about them 
before they damage your enterprise.”  
- The Practice of Network Security Monitoring 
Network Security Monitoring 
Invented in 1990, still in use today 
Cliff Stoll 
“Stalking the 
Wily Hacker” 
1988 
Todd Herberlein 
et al. 
“A Network 
Security 
Monitor” 
1990 
US Air Force 
Defense 
Information 
Systems Agency 
Lawrence 
Livermore 
National Lab 
Early 1990s 
NetRanger 
RealSecure 
Snort 
and many 
others 
Late 1990s - 
early 2000s 
Formal 
definition of 
NSM 
2002 
Before we start looking… 
We need  
 At least one person (to watch and hunt) 
 The right tools to collect and analyze the data 
The NSM Cycle 
Collection 
Detection 
Analysis 
 Model for action, based on 
network-derived data 
 Requires people and process, 
not just technology 
 Focuses on the adversary, 
not the vulnerability 
Methods of Monitoring 
 Network tap – physical device which relays a 
copy of packets to an NSM sensor 
 SPAN or mirrored ports – switch configuration 
which sends copies of packets to a separate port 
where NSM sensor can connect 
 Host NIC – configured to watch all network traffic 
flowing on its segment (usually on NSM sensor) 
 Serial port tap – physical device which relays 
serial traffic to another port, usually requires 
additional software to interpret data 
Fluke Networks 
Stratus Engineering 
Types of Data Collected 
 Full content data – unfiltered collection of packets 
 Extracted content – data streams, files, Web pages, etc. 
 Session data – conversation between nodes 
 Transaction data – requests and replies between nodes 
 Statistical data – description of traffic, such as protocol 
and volume 
 Metadata – aspects of data, e.g. who owns this IP 
address 
 Alert/log data – triggers from IDS tools, tracking user 
logins, etc. 
Difficulties for NSM 
 Encrypted networks 
 Widespread NAT 
 Devices moving between network segments 
 Extreme traffic volume 
 Privacy concerns 
Issues that most ICS do not face! 
Example ICS 
Enterprise/IT 
DMZ 
Plant 
Control 
Web 
Historian or 
other DB 
DCS 
Historian  
HMI 
PLCs, 
Controllers, 
RTUs, PACs 
Anatomy of an Attack 
20 
Over all Mandiant attack investigations, 
only a little more than half of victim computers have malware on them. 
While attackers often use malware to gain an initial foothold, 
they quickly move to other tactics to execute their attacks. 
Unauthorized Use 
of Valid Accounts 
Known & 
Unknown 
Malware 
Command & 
Control Activity 
Suspicious 
Network Traffic 
Files Accessed by 
Attackers 
Valid Programs Used 
for Evil Purposes 
Trace Evidence & 
Partial Files 
Attacker Objectives 
Attacker’s goals: 
Damage equipment 
Affect or steal process info 
Cause safety or compliance issue 
Pivot from vulnerable ICS to 
enterprise 
Attacker’s options: 
Gain physical access to an ICS host 
Gain remote access to an ICS host 
Compromise a highly-privileged 
client machine with access to the ICS 
network 
Enterprise/IT 
Plant DMZ 
Control 
Web 
Historian or 
other DB 
SCADA 
Historian  
HMI 
PLCs, 
Controllers, 
RTUs, PACs 
Let’s do some NSM! 
Let’s do some NSM! 
Inquisitive mind 
NSM collection tools 
NSM hunting tools 
Protection 
NSM Collection 
 Firewall Logs 
 Session Data 
 NIDS/HIDS Logs 
 Full packet capture 
 Windows Logs and syslog 
 SNMP (CPU % etc.) 
 Alerts from security agents 
(AV, whitelisting, etc.) 
Enterprise/IT 
Enterprise technology collectors 
Logs and/or Agent 
Network sensors 
Logs only 
Plant DMZ 
Control 
Web 
Historian or 
other DB 
SCADA 
Historian  
HMI 
PLCs, 
Controllers, 
RTUs, PACs 
NSM Collection 
http://3.bp.blogspot.com/-B6PtheVJ9Jg/Uj4EErYhHdI/AAAAAAAAAFE/i_2dk9emrp4/s1600/Deer+tracks.jpg 
What are we looking for? 
 Exceptions from baseline (e.g. A talks to B but never C) 
 “Top Talkers” 
 Unexpected connectivity (to Internet, Business network) 
 Known malicious IPs and domains 
 Logins using default accounts 
 Error messages that could correlate to vulnerabilities 
 Unusual system and firewall log entries 
 Host-based IDS or other security system alerts 
 Unexpected file and firmware updates 
 Antivirus alerts 
 And others…. 
NSM Detection & “Hunting” 
Analyst looks at detected anomalies  
or alerts then escalates to IR 
! 
 IDS alerts 
 Anomaly detection 
 Firmware updates, other commands 
 Login with default credentials 
 High CPU or network bandwidth 
 Door alarms when nobody is 
supposed to be working 
 Devices going off-line or behaving 
strangely 
Plant DMZ 
Control 
Web 
Historian or 
other DB 
SCADA 
Historian  
HMI 
PLCs, 
Controllers, 
RTUs, PACs 
NSM Detection 
http://www.buckmasters.com 
http://www.jimyuskavitchphotography.com/data/photos/56_1wolf_track4.jpg 
NSM Analysis 
Incident responders analyze the 
detected anomalies to find evil 
 Application exploitation 
 Third-party connections (ex. ICCP or 
vendor access) 
 ICS-specific communication protocol 
attacks (ex. Modbus, DNP3, Profinet, 
EtherNet/IP) 
 Remote access exploitation 
 Direct network access due to poor 
physical security 
 USB-delivered malware 
Plant DMZ 
Control 
Web 
Historian or 
other DB 
SCADA 
Historian  
HMI 
PLCs, 
Controllers, 
RTUs, PACs 
NSM Analysis 
http://alistairpott.com/wp-content/uploads/2008/05/rabbit-owl.jpg 
http://www.youtube.com 
ICS NSM Examples 
Session Data “Top Talkers” 
FlowBAT characterizes Session Data, showing which nodes have the most traffic 
Web traffic 
Web traffic 
NetBios 
NTP 
SiLK and FlowBAT can be easily 
installed in Security Onion 
Pcap Analysis for anomalies 
NetworkMiner can find potential ARP spoofing (as well as many other indicators) 
Pcaps - Abnormal DNS Traffic 
NetworkMiner sees“strange” DNS requests originating from within the ICS 
IDS alerts - Abnormal DNS Traffic 
DNS requests shown in the Bro IDS log in ELSA 
Pcaps - Malformed Modbus 
Deep packet inspection of Modbus by Wireshark 
IDS Logs 
 Bro IDS 
– DNP3 & Modbus 
– More ICS protocols being developed by UIUC 
 Snort IDS 
– DNP3 & Modbus preprocessors 
– ET SCADA & DigitalBond Quickdraw Snort rules 
 Suricata IDS 
– New DNP3 parser & ET SCADA rules 
IDS Logs 
Modbus 
DNP3 
Bro IDS parses Modbus and DNP3 packets, ELSA consolidates Bro logs 
IDS GUIs 
Alerts in Sguil of scanning activity 
Syslog 
Syslog can be configured to send to a NSM sensor or detected in 
network traffic if sent elsewhere.  This is the Bro IDS Log for 
Syslog from an RTU. 
RTUs with Syslog 
• SEL-3530 RTAC 
• GE D20MX 
• Novatech OrionLX 
• Cooper SMP 16 
If not…require syslog and other logs in the ICS 
procurement language 
NSM Tools for the 7 Data Types 
Security Onion Linux distribution 
– Easy to install and lots of documentation 
 Full packet capture – 
Tcpdump/Wireshark/NetworkMiner 
 Extracted content – Xplico/NetworkMiner 
 Session data – Bro/FlowBAT 
 Transaction data – Bro 
 Statistical data – Capinfos/Wireshark 
 Metadata – ELSA (Whois) 
 Alert data – Snort, Suricata, Sguil, Snorby 
Peel Back the Layers of Your Network 
Security Onion Tools 
NetFlow Tools 
SiLK & FlowBAT 
Install on Security Onion with 2 scripts 
www.flowbat.com 
Security Onion Implementation 
 Test in a lab first 
 Select suitable hardware platform 
 More RAM is better 
 Bigger hard drive is better (longer retention) 
 Mirrored/SPAN port on router/switch or a good 
network tap 
 Select proper placement of SO sensor 
 The Practice of Network Security Monitoring 
 Applied Network Security Monitoring 
 Work with the right stakeholders if placing in 
production 
SO for ICS = Security Ogre 
 The Cuckoo’s Egg by Cliff Stoll 
https://www.youtube.com/watch?v=EcKxaq1FTac 
1-hour NOVA Special (1990) 
 The Practice of Network Security Monitoring  
by Richard Bejtlich   
http://www.nostarch.com/nsm 
 Applied Network Security Monitoring  
by Chris Sanders & Jason Smith 
http://www.appliednsm.com/ 
 The NSM Wiki http://nsmwiki.org 
 http://securityonion.net 
NSM References/Resources 
Takeaways 
You can implement NSM in ICS 
today – without impacting your 
operations 
There are free tools available to 
help you start looking at your ICS 
and hunting for evil 
People… 
…the most important part of NSM! 
 Gigabytes of data and 1000s of 
IDS alerts are useless without  
interpretation 
 Analyze data collected to understand  
what’s normal – and what’s not 
 Identify adversary TTPs and act to disrupt them 
Remember 
Adversaries are a “Who”, not a “What” 
Find Evil 
PI:EMAIL 
@chrissistrunk