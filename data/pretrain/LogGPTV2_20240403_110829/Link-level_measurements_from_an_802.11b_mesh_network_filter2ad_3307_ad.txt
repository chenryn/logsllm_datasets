P
t
s
o
L
 0
 0
s
r
i
a
P
f
o
n
o
i
t
c
a
r
F
e
v
i
t
l
a
u
m
u
C
 1
 0.9
 0.8
 0.7
 0.6
 0.5
 0.4
 0.3
 0.2
 0.1
 0
 100
 0
 500
 1000  1500  2000  2500
Distance (meters)
 40
 20
 80
Foreign Packets/Second
 60
Figure 18: Each point indicates one host pair. The
x-axis shows the number of foreign packets received
per second by the receiver in that pair (same data
as Table 1). The y-axis shows the number of 1500-
byte packets lost per second at 1 Mbit/s. The data
for the two axes are from experiments performed
within a few minutes of each other. There is no
obvious correlation.
such delay spreads signiﬁcantly increase packet loss rates.
While we cannot characterize the reﬂective paths present in
Roofnet, we can evaluate the impact of longer delay spreads
on packet loss with the channel emulator described in Sec-
tion 2.1.
The emulator uses a two-ray channel model, in which a
delayed copy of the transmitted radio signal is attenuated
and mixed with the original before arriving at the receiving
radio. This emulates the original signal following a line-
of-sight path and a single reﬂective signal which followed
a longer path. The parameters of the model are the delay
between the two signals and their relative strengths. A real
physical environment would produce many reﬂective rays,
so the emulation results probably provide a lower bound on
the losses caused by reﬂections.
In the experiment, the sender transmitted batches of 200
broadcast packets at 1, 2, 5.5 and 11 Mbit/s. Measurements
were taken while varying both the delay and attenuation
of the reﬂected ray in increments of 0.02 microseconds and
0.2dB respectively. The original ray was not attenuated.
Figure 19 presents the results for each bit-rate. Each bar
corresponds to a diﬀerent delay diﬀerence, indicated on the
x-axis. The black part of each bar indicates the attenuation
levels which resulted in ≥ 90% loss, while the gray part of
each bar indicates the attenuation levels which resulted in
loss rates between 10% and 90%.
For example, in the 1 Mbit/s data, at a delay of 1 mi-
crosecond, at least 90% of the packets are lost when the
reﬂected ray is attenuated by 9.2dB or less, and at least
10% of the packets are lost when the reﬂected ray is atten-
uated by 7dB or less. For a delay of 1.5 microseconds, 90%
packet loss never occurs, even when the reﬂected ray and the
original ray have equal signal strength; 10% of packets are
lost when power of the reﬂected signal is within 4dB of the
original. No packets are lost if the reﬂected signal is more
than 4 dB weaker.
Figure 20: A CDF of the distance between all pairs
of Roofnet nodes that have non-zero delivery prob-
abilities for 1500-byte packets at 1 Mbit/s.
Figure 19 shows that a delay spread of less than a few hun-
dred nanoseconds has little eﬀect on packet loss, regardless
of the relative strength of the reﬂected ray; this is consistent
with Intersil’s speciﬁcation for the RAKE receiver. Packet
loss rates increase for delays above a few hundred nanosec-
onds because the RAKE receiver has trouble distinguishing
the original signals from the reﬂections.
The data show that some delays cause more loss than oth-
ers; these delays are multiples of the modulation’s symbol
boundaries. For the phase shift keying modulation used by
the 1 and 2 Mbit/s data rates, each symbol lasts one mi-
crosecond, so the data show peaks of loss at x values of one
and two microseconds. At the 5.5 and 11 Mbit/s data rates,
the complementary code keying modulation has symbol du-
ration of 0.73 microseconds. At delay oﬀsets that are not
multiples of a symbol time, the delayed path’s symbols look
like random noise with respect to the symbols of the direct
path, and do not interfere very much; at oﬀsets that are a
multiple of a symbol time, the delayed path delivers valid
symbols that the receiver cannot distinguish from the direct
symbols.
Signiﬁcant losses due to multi-path are only likely to oc-
cur if the inter-node distances in Roofnet are long enough
that a reﬂected signal could be delayed on the order of a
microsecond. This delay corresponds to approximately 300
meters, so Roofnet would have to have direct paths signif-
icantly longer than that. Figure 20 shows a CDF of the
distances between all pairs of Roofnet nodes that have non-
zero delivery probabilities at 1 Mbit/s. The median is 500
meters, and about a quarter of the links are longer than
1000 meters. Links of this length seem compatible with de-
lay spreads of at least a few hundred nanoseconds.
It is
common to assume delay spreads of up to a microsecond for
similar urban wireless environments [4, 13].
The emulator experiment shows that multi-path interfer-
ence could cause loss rates in a way that would be hard
to predict from S/N alone. For example, at 5.5 Mbit/s,
Figure 19 shows that loss rate could vary widely depend-
ing on the exact length of the reﬂective path; if reﬂective
path lengths are more or less uniformly distributed, then
1Mbps
0
0.1
0.2
0.3
0.4
0.5
0.6
0.7
0.8
0.9
1
1.1
1.2
1.3
1.4
1.5
1.6
1.7
1.8
1.9
2
2.1
2.2
10% packet loss
90% packet loss
Delay (microseconds)
2Mbps
0
0.1
0.2
0.3
0.4
0.5
0.6
0.7
0.8
0.9
1
1.1
1.2
1.3
1.4
1.5
1.6
1.7
1.8
1.9
2
2.1
2.2
10% packet loss
90% packet loss
Delay (microseconds)
5.5Mbps
0
0.1
0.2
0.3
0.4
0.5
0.6
0.7
0.8
0.9
1
1.1
1.2
1.3
1.4
1.5
1.6
1.7
1.8
1.9
2
2.1
2.2
10% packet loss
90% packet loss
Delay (microseconds)
11Mbps
)
B
d
(
n
o
i
t
a
u
n
e
t
t
A
10
8
6
4
2
0
)
B
d
(
n
o
i
t
a
u
n
e
t
t
A
10
8
6
4
2
0
)
B
d
(
n
o
i
t
a
u
n
e
t
t
A
10
8
6
4
2
0
)
B
d
(
n
o
i
t
a
u
n
e
t
t
A
10
8
6
4
2
0
0
0.1
0.2
0.3
0.4
0.5
0.6
0.7
0.8
0.9
1
1.1
1.2
1.3
1.4
1.5
1.6
1.7
1.8
1.9
2
2.1
2.2
10% packet loss
90% packet loss
Delay (microseconds)
Figure 19: The eﬀect at 1, 2, 5.5 and 11 Mbit/s of various combinations of multi-path delay and attenuation,
measured using the emulator. The x-axis indicates how long the reﬂected ray is delayed relative to the direct
ray. The y-axis indicates how much the reﬂected ray is attenuated relative to the direct ray. The tops of
the gray and black bars at each delay indicate the attenuation levels which result in 10% and 90% packet
loss respectively, so the height of the gray bar indicates the region of intermediate packet loss. Packet loss is
common for delay spreads greater than a few hundred nanoseconds and occurs more often when the reﬂected
ray is delayed by a multiple of the symbol time.
one might expect the loss rate caused by multi-path to be
roughly uniformly distributed as well. This uniformity is a
potential contributor to the prevalence of intermediate loss
rates in Figure 4.
10. Related Work
Eckhardt and Steenkiste [7] found relatively few links with
intermediate loss rates in an indoor 802.11 network.
Kotz et al. [10] examine the question of whether, if two
nodes can hear each other at all, they can hear each other
perfectly (their Axiom 4). They conclude that the assump-
tion is very nearly correct. Our measurements show that
Roofnet behaves very diﬀerently from the network studied
by Kotz, perhaps because the latter is an 802.11 access-point
network in which clients are typically close to the nearest ac-
cess point.
Lundgren et al. [11], Yarvis et al. [15], and De Couto et
al. [6] all report much lower performance on deployments
of multi-hop routing systems than predicted in simulation,
and all observe in one way or another that the problem is a
predominance of intermediate-quality links. They propose
solutions that involve measuring link quality and carefully
routing through the best links. While our work does not pro-
pose any solutions, it does contribute to an understanding
of the reasons for intermediate-quality links.
Earlier studies of 802.11 links [14, 12, 3] ﬁnd packet losses
are bursty and require a multi-state Markov model for accu-
rate prediction. These bursts were caused by movement in
the environment, either of the receiver or obstacles, which
induced slow changes in the channel due to Rayleigh fading.
In the case of static outdoor 802.11 measurements [3], the
highly directional antennas are susceptible to motion caused
by wind, which is a possible explanation for their bursty
losses. The omni-directional antennas used in Roofnet are
not as easily aﬀected by weather conditions.
In general,
multi-state Markov models such as the Gilbert Model and
those developed in [9] are found to ﬁt loss patterns induced
by movement well, but are over-speciﬁed for static environ-
ments.
11. Conclusions
This paper is a study of packet loss on a 38-node urban
802.11b mesh network. Links with intermediate levels of loss
are the common case; there is no clear distinction between
“working” and “non-working” links. Link distance and S/N
ratio do have an eﬀect on loss rates, but the correlation is
weak. Experiments using a hardware channel emulator sug-
gest that an important cause of intermediate loss rates is
multi-path fading due to reﬂections in the radio environ-
ment.
The measurements on which this paper is based will be
available at http://pdos.lcs.mit.edu/roofnet.
Acknowledgments
This research was supported by grants from NTT Corpo-
ration under the NTT-MIT collaboration, and by MIT’s
Project Oxygen. We thank the many volunteers who host
Roofnet nodes for their time and patience. Ben Chambers
deployed the original Roofnet, Doug De Couto wrote the
original software and designed the initial protocols, and Ed-
die Kohler maintains the indispensable Click.
References
[1] ISL3873: Wireless LAN Integrated Medium Access
Controller with Baseband Processor. Intersil
Corporation, 2000. Application Note FN4868.
[2] D. W. Allan. Time and frequency (time domain)
characterization, estimation and prediction of
precision clocks and oscillators. In IEEE Trans.
UFFC, vol. 34, no. 6, November 1987.
[3] H. Balakrishnan and R. Katz. Explicit loss
notiﬁcation and wireless web performance. In IEEE
Globecom Internet Mini-Conference, October 1998.
[4] M. V. Clark, K. K. Leung, B. McNair, and Z. Kostic.
Outdoor IEEE 802.11 cellular networks: Radio link
performance. In Proc. of IEEE ICC 2002, April 2002.
[5] D. C. Cox. Delay Doppler characteristics of multipath
propagation at 910 MHz in a suburban mobile radio
environment. In IEEE Transactions on Antennas and
Propagation, AP-20(5):625-635, September 1972.
[6] D. De Couto, D. Aguayo, J. Bicket, and R. Morris. A
high-throughput path metric for multi-hop wireless
routing. In Proceedings of ACM MobiCom Conference,
September 2003.
[7] D. Eckhardt and P. Steenkiste. Measurement and
analysis of the error characteristics of an in-building
wireless network. In Computer Communication Review
26:4, pp. 243-254, SIGCOMM ’96, October 1996.
[8] G. Judd and P. Steenkiste. Repeatable and realistic
wireless experimentation through physical emulation.
In HotNets-II, Cambridge, MA, November 2003. ACM.
[9] A. Konrad, B. Y. Zhao, A. D. Joseph, and R. Ludwig.
A Markov-based channel model algorithm for wireless
networks. In Proceedings of Fourth ACM International
Workshop on Modeling, Analysis and Simulation of
Wireless and Mobile Systems, 2001.
[10] D. Kotz, C. Newport, and C. Elliott. The mistaken
axioms of wireless-network research. Technical report
TR2003-647, Dartmouth CS Department, July 2003.
[11] H. Lundgren, E. Nordstrom, and C. Tschudin. Coping
with communication gray zones in IEEE 802.11b
based ad hoc networks. In ACM WoWMoM
Workshop, September 2002.
[12] G. Nguyen, R. H. Katz, B. Noble, , and
M. Satyanarayanan. A trace-based approach for
modeling wireless channel behavior. In Proc. Winter
Simulation Conf., December 1996.
[13] E. S. Sousa, V. M. Jovanovic, and C. Daigneault.
Delay spread measurements for the digital cellular
channel in Toronto. In IEEE Trans. on Veh. Tech.,
vol. 43, no. 4, pp. 1-11, November 1994.
[14] A. Willig, M. Kubisch, C. Hoene, and A. Wolisz.
Measurements of a wireless link in an industrial
environment using an IEEE 802.11-compliant physical
layer. In IEEE Transactions on Industrial Electronics,
vol. 43, no. 6, pp. 1265-1282, December 2002.
[15] M. Yarvis, W. Conner, L. Krishnamurthy, J. Chhabra,
B. Elliott, and A. Mainwaring. Real-world experiences
with an interactive ad hoc sensor network. In
Proceedings of the International Workshop on Ad Hoc
Networking, August 2002.