2015.11 by phithon
被Git打破的 
企业安全大门
Who am I
• phith0n	
• 乌云核⼼心⽩白帽⼦子/XDSEC成员	
• 从事Web安全/运维安全研究
What is GIT
删除
增加
增加
phithon@fake-demo:~$ git add .
phithon@fake-demo:~$ git commit
Finish
Git是⼀一个分布式版本控制软件
在开发中运⽤用git可以⽅方便地进⾏行团队协作、敏捷开发
GIT与信息安全
• Github造成的企业敏感信息泄露 
• web⺫⽬目录/.git/访问造成的源码泄露 
• 内⺴⽹网Git未授权访问造成敏感信息泄露
• Github造成的企业敏感信息泄露
• web⺫⽬目录/.git/访问造成的源码泄露 
• 内⺴⽹网Git未授权访问造成敏感信息泄露
当最单纯的人遇上了最邪恶的人
案例 / 某电商宁⼿手机客户端源码泄露
案例 / 某电商宝内⺴⽹网邮箱泄露导致漫游
http://www.wooyun.org/bugs/wooyun-2014-062243
Github Hacking Skill
• 关键词搜索: password、@domain.com、salt、BEGIN RSA 
PRIVATE KEY、smtp 
• “@domain-inc.com in:ﬁle” 在所有代码中搜索内⺴⽹网邮箱 
• “id_rsa in:path” 获得结果18534个 
• “password language:yaml” 获得结果784327个 
• “password size:  
列出tree对象的所有⼦子对象
方法3、 
解析并依次下载objects，执⾏行git reset还原源⽂文件
git  cat-file  -p    
列出blob对象的内容
git  reset  
还原整个GIT环境（较其他两法的优势）
找到commit id
找到并下载tree
下载blob
git reset
恢复源⽂文件
GitRefs
运⾏行演⽰示
http://v.qq.com/
page/y/e/l/
y0171fyrxel.htm
l
案例
• WooYun-2015-133666 百度某站漏洞导致敏感信息泄
露Getshell(涉及⾄至少66W+的⽤用户数据含密码可内⺴⽹网) 
• WooYun-2015-121319 PHP官⽅方多个分站存在git信息
泄露可读取⼤大量程序源码 
• WooYun-2015-117925 盛⼤大某站源码泄露Getshell直
⼊入内⺴⽹网 
• WooYun-2015-114272 百度从git信息泄露到getshell
漫游内⺴⽹网 
• WooYun-2015-93434 我是如何让周鸿祎/⺩王思聪等关
注我微博的
如何直接利⽤用git⾃自带命令下
载泄露的源码？
提⽰示 
git clone的⼯工作流程 
http协议的git服务器原理
思考
• Github造成的企业敏感信息泄露 
• web⺫⽬目录/.git/访问造成的源码泄露
• 内⺴⽹网Git未授权访问造成敏感信息泄露
• Github造成的企业敏感信息泄露 
• web⺫⽬目录/.git/访问造成的源码泄露 
• 内⺴⽹网Git未授权访问造成敏感信息泄露
GIT  
私有化解决方案
1.服务器存在于内网，代码绝对私
有性可受保障  
2.稳定性不受平台影响  
3.内网速度快，便于加速团队内部
敏捷开发  
4.便于二次开发，可兼容公司内部
认证机制，避免冗余的认证操作  
5.公司对平台拥有绝对控制权，避
免出现不必要的纠纷
Gitlab
1.具有成熟的技术支持，减少环境、
运维、迭代的支出  
2.具有更加成熟的安全性
Github
私有化GIT解决方案安全性问题
• ⿊黑客进⼊入内⺴⽹网后，GIT⼜又暴露出哪些问题？ 
• GIT服务权限配置不当 
• Gitlab等开源项⺫⽬目的不稳定性 
• Gitweb的滥⽤用与漏洞
GIT服务的载体
特点与利⽤用
FILE协议
优点：利⽤用⽂文件系统进⾏行权限限制。 
缺点：只允许本地或共享硬盘访问。
SSH协议
优点：基于SSH协议的通⽤用性与安全性。 
缺点：权限限制太死，不适合开源软件。
GIT协议
监听9418端⼝口 
优点：速度快 
缺点：没有授权机制，传输过程也不加密
HTTP(S)协议
优点：适⽤用性⼲⼴广，服务器搭建简单 
缺点：传输数据过⼤大，且⽆无权限控制
GIT服务权限配置不当
• GIT服务端权限设置不合理 
• 影响协议⽅方式：GIT协议、HTTP(S)协议 
• 利⽤用： 
• 下载内部项⺫⽬目 git clone git://xxx.com/private/project.git 
• 写⼊入任意⽂文件 git push git://xxx.com/private/project.git 
• 解决⽅方案：公有/私有项⺫⽬目严格划分，⽤用ssh进⾏行⾝身份认证
Gitlab等开源项目的不稳定性
• 平台易受到传统WEB漏洞影响 
• CVE-2014-6271 shellshock漏洞导致的gitlab任意
命令执⾏行漏洞 
• CVE-2013-4580 GitLab未经⾝身份验证API访问漏洞 
• CNVD-2013-14288 GitLab 'SSH key upload’功能
远程执⾏行代码漏洞 
• 解决⽅方案：及时更新/跟进
Gitweb的滥用与漏洞
• gitweb是git⾃自带的web界⾯面（默认端⼝口1234）： 
• git instaweb —httpd=lighttpd
Gitweb的滥用与漏洞
• Gitweb远程命令执⾏行漏洞演⽰示（CVE-2008-5516） 
• http://v.qq.com/page/r/z/l/r0171uj9jzl.html
GIT对于后渗透
的价值
• 源码审计 
• 信息收集 
• 内⺴⽹网渗透
GIT对于后渗透的价值
• 源码审计 
• 信息收集 
• git blame ﬁlename 查看代码每⼀一⾏行的作者 
• git log | grep ".*@.*" | sort -u | uniq 找到所有开发
者及其邮箱地址 
• …… 
• 内⺴⽹网渗透
What is GIT
开发者：GIT是⼀一个好⽤用的版本控制软件 
hacker：GIT是⼀一个信息的⼤大宝库
END
Email: PI:EMAIL 
weibo: @phithon别跟路⼈人甲BB 
blog: http://www.leavesongs.com/