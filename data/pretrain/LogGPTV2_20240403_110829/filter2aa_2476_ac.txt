### Bill of Materials (BOM)

| Item | Quantity | Reference | Manufacturer | Manuf. Part # | Distributor | Distrib. Part # | Description |
|------|----------|-----------|--------------|---------------|-------------|-----------------|-------------|
| 1    | 1        | BT1       | MPD          | BU2032SM-JJ-GTR | N/A         | N/A             | Battery Holder, CR2032, SMD |
| 1b   | 1        | N/A       | Panasonic    | CR2032        | Digi-Key    | P189-ND         | Coin Cell Battery, Lithium, 3V, 225mAh |
| 2    | 9        | C1, C2, C6, C7, C8, C9, C10, C12, C13 | Kemet | C0603C104K4RACTU | Digi-Key | 399-1096-2-ND | Capacitor, 0.1uF, 16V, X7R, 0603 |
| 3    | 1        | C3        | Samsung      | CL10B103KB8NCNC | Digi-Key    | 1276-1921-2-ND | Capacitor, 0.01uF, 50V, X7R, 0603 |
| 4    | 2        | C4, C5    | AVX          | 06035A470JAT2A | Digi-Key    | 478-1171-2-ND | Capacitor, 47pF, 50V, C0G/NP0, 0603 |
| 5    | 1        | C11       | Kemet        | T491A106M016AT | Digi-Key    | 399-3687-2-ND | Capacitor, 10uF, 16V, Tantalum, 20%, Size A |
| 6    | 2        | C14, C15  | Taiyo Yuden  | TMK212B7225KG-TR | Digi-Key | 587-2991-2-ND | Capacitor, 2.2uF, 25V, X7R, 0805 |
| 7    | 4        | D1, D9, D17, D25 | Kingbright | AA3528SYCKT09 | N/A         | N/A             | LED, Yellow, 250mcd, 2.0Vf, 590nm, Reverse Mount, PLCC-2 |
| 8    | 4        | D2, D10, D18, D26 | Kingbright | AA3528SECKT09 | N/A         | N/A             | LED, Orange, 350mcd, 2.1Vf, 605nm, Reverse Mount, PLCC-2 |
| 9    | 8        | D3, D4, D11, D12, D19, D20, D27, D28 | Kingbright | AA3528SURCKT09 | N/A | N/A | LED, Red, 350mcd, 1.95Vf, 630nm, Reverse Mount, PLCC-2 |
| 10   | 16       | D5, D6, D7, D8, D13, D14, D15, D16, D21, D22, D23, D24, D29, D30, D31, D32 | Kingbright | AA3528CGCKT09 | N/A | N/A | LED, Green, 100mcd, 2.1Vf, 570nm, Reverse Mount, PLCC-2 |
| 11   | 1        | D33       | Kingbright   | APT1608LQWF/D  | N/A         | N/A             | LED, White, 35mcd, 2.65Vf, 0603 |
| 12   | 1        | L1        | TDK          | MPZ2012S221AT000 | Digi-Key | 445-1568-2-ND | Inductor, Ferrite Bead, 220R @ 100MHz, 3A, 0805 |
| 13   | 1        | L2        | Taiyo Yuden  | LBMF1608T100K   | Digi-Key    | 587-1714-2-ND | Inductor, Wirewound, 10uH, 10%, 360mR, 80mA, 0603 |
| 14   | 1        | P2        | TE Connectivity | 2173157-2 | Verical | N/A | Connector, Micro-USB Type B, R/A, 5 position, SMD |
| 15   | 2        | Q1, Q3    | Infineon     | IRLML6402TRPBF | Digi-Key    | IRLML6402PBFTR-ND | Transistor, MOSFET, P-Channel, 20V, 65mR @ 3.7A, SOT23 |
| 16   | 1        | Q2        | Infineon     | IRLML2502TRPBF | Digi-Key    | IRLML2502TRPBFTR-ND | Transistor, MOSFET, N-Channel, 20V, 45mR @ 4.2A, SOT23 |
| 17   | 8        | R1, R3, R5, R6, R8, R9, R10, R15 | Panasonic | ERJ-3GEYJ103V | Digi-Key | P10KGTR-ND | Resistor, 10k, 5%, 1/10W, 0603 |
| 18   | 2        | R2, R4    | Panasonic    | ERJ-3GEYJ270V  | Digi-Key    | P27GTR-ND    | Resistor, 27 ohm, 5%, 1/10W, 0603 |
| 19   | 1        | R7        | Panasonic    | ERJ-3GEYJ332V  | Digi-Key    | P3.3KGTR-ND  | Resistor, 3.3k, 5%, 1/10W, 0603 |
| 20   | 4        | R11, R12, R13, R14 | Panasonic | ERJ-3GEYJ470V | Digi-Key | P47GTR-ND | Resistor, 47 ohm, 5%, 1/10W, 0603 |
| 21   | 1        | SW1       | Panasonic    | EVP-AA202K     | Digi-Key    | P13348SDKR-ND | Switch, SPST, Tactile Momentary, 160gf, 3.5 x 2.9mm, J-Lead |
| 22   | 1        | U1        | FTDI         | FT231XS-R      | Digi-Key    | 768-1129-2-ND | IC, USB-to-UART Bridge, SSOP20 |
| 23   | 1        | U2        | Microchip    | ATMEGA328P-AU  | N/A         | N/A             | IC, Microcontroller, 32KB Flash, TQFP32 |
| 23b  | 1        | N/A       | Microchip    | N/A            | N/A         | N/A             | IC, Microcontroller, Programming |
| 24   | 1        | U3        | STMicroelectronics | LIS3DHTR | Digi-Key | 497-10613-6-ND | IC, Accelerometer, 3-Axis, 2-16g, LGA16 |
| 25   | 1        | U4        | Nexperia     | 74HC595PW,118 | Digi-Key    | 1727-3068-2-ND | IC, Shift Register, 8-bit, TSSOP16 |
| 26   | 1        | U5        | Microchip    | MCP1700T-3002E/MB | Digi-Key | MCP1700T-3002E/MBCT-ND | Voltage Regulator, LDO, 3.0V, 250mA, SOT89-3 |
| 27   | 1        | Y1        | Kyocera      | PBRC8.00MR50X000 | Mouser | 581-PBRC8.00MR50X | Resonator, 8MHz, 0.5%, Internal 15pF Capacitor, SMD |
| 28   | 1        | PCB       | Electronic Interconnect | DCN1.0 | N/A | N/A | PCB Fabrication, Assembly, Test |

### Arduino Platform
- **Open Source**: Easy-to-use hardware, software, and firmware.
- **Community**: Worldwide community of users and contributors.
- **Memory Usage**:
  - 90% of Flash (27.6kB)
  - 43% of RAM (887 bytes)
- **Main Loop**:
  - Set power state (battery, USB, USB charger)
  - Check for and process interactive mode
  - Check for and process FPC communication
  - Update LEDs
  - Sleep until accelerometer interrupt

### Firmware
- **Third-Party Libraries**: Add functionality to the Arduino.
- **Essential for Rapid Development**.
- **Code Modifications Required**: During badge integration.
- **Low Power Library**: [https://github.com/rocketscream/Low-Power](https://github.com/rocketscream/Low-Power)
- **Adafruit_LIS3DH (Accelerometer)**: [https://github.com/adafruit/Adafruit_LIS3DH](https://github.com/adafruit/Adafruit_LIS3DH)
- **Adafruit_SENSOR (Sensor Abstraction Layer)**: [https://github.com/adafruit/Adafruit_Sensor](https://github.com/adafruit/Adafruit_Sensor)

### Libraries
- **LED Matrix**: Individually addressable, dimmable, shift register.
  - [https://github.com/marcmerlin/LED-Matrix](https://github.com/marcmerlin/LED-Matrix)
- **Adafruit GFX Library**: Core graphics primitives.
  - [https://github.com/adafruit/Adafruit-GFX-Library](https://github.com/adafruit/Adafruit-GFX-Library)
- **DIO2**: Fast digital I/O.
  - [www.codeproject.com/Articles/732646/Fast-digital-I-O-for-Arduino](www.codeproject.com/Articles/732646/Fast-digital-I-O-for-Arduino)
- **TimerOne**: Enhanced timer, periodic interrupts.
  - [https://github.com/PaulStoffregen/TimerOne](https://github.com/PaulStoffregen/TimerOne)

### Code Modifications
- **LED Matrix**:
  - Add `#define swap()` to `.cpp` to prevent compiling error.
  - Remove `#defines` for DIO2 `pinMode` and `digitalWrite` as they conflict with the rest of the badge code.

### Fabrication and Assembly
- **Raspberry Pi 3 Model B+**:
  - Shell script to program FT231X and ATmega328P via USB.
- **Power On Self Test**:
  - Visual inspection of LEDs.
  - Detection of accelerometer.

### Badge Numbers
- **Human (Attendee), black silkscreen**: 2,784
- **Goon, red**: 156
- **Speaker, blue**: 50
- **Village, blue**: 90
- **Sponsor, grey**: 120
- **Press, green**: 100
- **Total**: 3,300

### Challenges
- **Battery Life**:
  - CR2032 3V lithium coin cell, 225mAh to 2V.
  - Power up, idle: 3.3mA.
  - All LEDs enabled: 10mA.
  - Sleep mode: 4-6uA.
  - Accelerometer to detect motion.
  - Sleep mode after 10 seconds of inactivity.
- **Mechanical Stress**:
  - Reworking flex PCB.
  - Time frame constraints.

### FPC Breakout Board
- **Access all FPC signals**:
  - UART, I2C, AVR ICSP.
  - SAO adapter.
  - [http://oshpark.com/shared_projects/X4QDh3nj](http://oshpark.com/shared_projects/X4QDh3nj)

### Programming Shield
- **Serial Communication via FPC**:
  - Set/clear individual LED.
  - Read state of badge.
  - Arduino with custom shield.
  - TXS0104 level translator.
  - 5V Arduino, 3V badge.
  - DIP switches.
  - I2C, AVR ICSP footprints.
  - [http://oshpark.com/shared_projects/WGHZCahO](http://oshpark.com/shared_projects/WGHZCahO)

### The Tree of Promise
- **LED Tree Fruit**:
  - Graphics displayed on a 3D cube.
  - Touch-sensitive tree branches.
  - Algorithm to generate unique branch for each attendee.

### Resources
- **Design Documentation, Code, etc.**:
  - [www.grandideastudio.com/portfolio/defcon-china-2019-badge](www.grandideastudio.com/portfolio/defcon-china-2019-badge)

### Enjoy the Conference!
- **Contact**: @JOEGRAND
- **Website**: [www.grandideastudio.com](www.grandideastudio.com)