# Title: Smoke Detector: Cross-Product Intrusion Detection with Weak Indicators

## Authors:
- Kevin A. Roundy
- Acar Tamersoy
- Michael Spertus
- Michael Hart
- Daniel Kats
- Matteo Dell'Amico
- Robert Scott

### Affiliations:
- Symantec Research Labs
- Symantec Corporation

### Contact Information:
- **Acar Tamersoy**: acar@symantec.com
- **Michael Spertus**: mike@symantec.com
- **Matteo Dell’Amico**: matteo@symantec.com
- **Kevin A. Roundy**: kevin@symantec.com
- **Michael Hart**: michael@symantec.com
- **Daniel Kats**: daniel@symantec.com
- **Robert Scott**: rsco@symantec.com

## Abstract
The primary task of a Security Incident and Event Manager (SIEM) or Managed Security Service Provider (MSSP) is to detect security incidents based on tens of thousands of event types from various security products. We introduce Smoke Detector, which processes trillions of security events using the Random Walk with Restart (RWR) algorithm. This algorithm infers high-order relationships between known security incidents and imperfect secondary security events (referred to as "smoke") to identify previously undetected security incidents ("fire"). By discovering these undetected incidents, Smoke Detector's RWR algorithm increases the MSSP’s critical incident count by 19% with a 1.3% false positive rate.

Beyond increased incident detection, our approach offers significant additional benefits:
1. It provides a robust method for leveraging Big Data sensor networks to enhance the adversarial resistance of protected networks.
2. Our event-scoring techniques enable efficient discovery of primary indicators of compromise.
3. Our confidence scores provide intuitive and tunable metrics for the detected security incidents, aiding in their display and response.

## 1. Introduction
The massive volume and diversity of security events collected by modern security products present significant challenges to traditional intrusion detection methods. Email, host, and network security products are logging an increasing variety and volume of security events, overwhelming analysts with a deluge of information. Security Incident and Event Managers (SIEMs) have been developed to distill this data into actionable security incidents. Managed Security Service Providers (MSSPs) face even greater challenges, as they manage security events for multiple customers, involving more products and requiring higher scalability.

In this context, we studied the challenges faced by a leading MSSP, which receives nearly two trillion security event instances per month, with over 70,000 distinct event types. These events are generated by tens of thousands of security devices, representing over 100 distinct security products.

When a SIEM or MSSP raises a security incident, it is typically based on the presence of a Primary Indicator of Compromise (IOC), such as an anti-virus detection or a blacklisted URL. The presence of a primary IOC provides sufficient evidence to trigger a security incident notification under predefined conditions. Other security events are treated as unreliable Secondary Indicators, which include generic security and system events that may not be attack-related. These classifications can be made by the vendor, the security device, the SIEM, or expert analysts, often requiring significant manual effort.

Large collections of expert rules are created and tuned at significant cost to identify combinations of primary IOCs that should trigger an incident. However, identifying primary IOCs is a major undertaking prone to mistakes due to the large and rapidly evolving number of event types. Attackers actively work to evade primary IOCs by tweaking their malware until it evades detection. For such attacks, detection must rely on secondary indicators. 

Existing sub-disciplines of intrusion detection, including network anomaly detection, alert fusion, and root-cause analysis, focus on identifying intrusions through secondary indicators. However, these methods are often designed for homogeneous event sets or normalized alerts. In contrast, Smoke Detector is designed for the diverse and heterogeneous events produced by various intrusion detection systems.

## 2. Background
In MSSP and SIEM data, machines with unusually high event counts rarely exhibit serious security problems and are often symptomatic of issues like network outages or product misconfigurations. This is because the most frequent events are generic traffic logs and status messages, which, while useful, are typically also processed by intrusion detection systems before reaching the SIEM or MSSP.

Smoke Detector tracks the relationships between known security incidents and security events, enabling the identification of useful events and ranking of potentially infected machines to detect novel incidents. It consists of two key components:
1. A graph that captures the relationships between events and the machines on which they appear, using the Random Walk with Restart (RWR) algorithm to propagate information from known-infected machines.
2. A component that identifies the conditional probability with which an event indicates a machine infection, providing confidence scores for intuition and tuning.

We describe our dataset in Section 3, the graph-based techniques in Section 4, the confidence scoring algorithm in Section 5, and the implementation and scalability properties in Section 6. Qualitative results are presented in Section 7, and a discussion of adversarial resistance is provided in Section 8. Related work is discussed in Section 9, and we conclude in Section 10.

## 3. Data Description
Our dataset consists of records of the form \((m[ti, tj], s, l)\). Here, \(m[ti, tj]\) represents a time window during which a machine \(m\) was observed. We refer to \(m[ti, tj]\) as a machine-window. The security event observed in relation to the machine-window is represented by \(s\), and \(l\) indicates the location of the event source (internal or external).

Security events represent security-relevant actions recorded by security products, along with metadata. Each event is classified as either a primary or secondary indicator of compromise. Primary indicators indicate serious security issues that may require remediation or preventative action, while secondary indicators vary in their ability to indicate security issues.

Some machine-windows in the dataset are known to contain verified security incidents. Most serious incidents are raised due to the presence of a primary indicator within the machine-window, but all secondary indicators occurring in this window are included. The remaining security events correspond to unknown machine-windows, which may contain data that analysts would classify as a security incident if reviewed.

To determine the optimal width for a machine-window, we studied the distribution of events around known security incidents. We observed a spike in event activity in the central 2 hours of a security incident, with the majority of events occurring within the central 24-hour period. After 2 days, the activity significantly decreases.

## 4. Graph-Based Techniques
[Content for Section 4]

## 5. Confidence Scoring Algorithm
[Content for Section 5]

## 6. Implementation and Scalability
[Content for Section 6]

## 7. Qualitative Results
[Content for Section 7]

## 8. Adversarial Resistance
[Content for Section 8]

## 9. Related Work
[Content for Section 9]

## 10. Conclusion
[Content for Section 10]