逻辑，如图15-45所示。
图15-45 修改返回包
步骤三：直接跳转到了重置密码页面，如图15-46所示。
图15-46 重置密码页面
15.8 注册覆盖——已存在用户可被重复注册
有些信息系统的用户注册功能没有严格校验已存在的用户账号，导致攻击者可以通过
重复注册其他用户账号的方式重置他人密码。
已存在用户可被重复注册案例如下。
步骤一：进入某快递网站，单击用户注册，输入用户名admin，在鼠标离开输入框后
会提示该账号已注册，如图15-47所示。
图15-47 注册界面
步骤二：输入一个未注册的用户名并提交表单，同时用抓包工具截取数据包并将
username修改为admin，如图15-48所示。
图15-48 抓包并修改用户名
步骤三：此时 admin 用户的密码被重复注册的方式修改了，但原用户的所有信息却没
有改变，也就是说这时候攻击者获取了用户的信息，包括姓名、身份证、手机号等。
15.9 Session覆盖——某电商网站可通过Session覆盖方式重置他人密码
有些服务器密码找回功能的服务端校验存在漏洞，攻击者使用密码找回链接重置密码
时可以通过Session覆盖的方式成功重置其他用户的密码。
某电商网站可通过Session覆盖方式重置他人密码案例如下。步骤一：使用自己的账
号进行密码找回，如图15-49所示。
图15-49 密码找回
步骤二：收到邮件后先不要打开链接，如图15-50所示。
图15-50 收到邮件
步骤三：在同一浏览器内打开网站再次进入密码找回页面，输入其他人的账号，如图
15-51所示。
图15-51 其他用户的身份验证界面
步骤四：单击发送“找回密码邮件”后停在该页面，如图15-52所示。
图15-52 发送邮件成功
步骤五：在同一浏览器中打开第二步中自己邮箱中收到的链接，然后设置一个新密
码，如图15-53所示。
图15-53 密码设置界面
步骤六：使用新设置的密码，成功登录进了其他人的账户，如图15-54所示。
图15-54 登录成功
15.10 防范密码找回漏洞的相关手段
（1）在密码找回功能设计时对用户凭证的验证次数和频率进行限制，防止攻击者对
用户凭证的暴力枚举攻击。
（2）对密码找回的各个环节进行梳理，记录分析所有交互数据，避免密码找回凭证
等敏感信息直接返回给客户端。
（3）对服务端密码重置Token的生成算法进行审计，避免使用容易被攻击者破解的
简单算法。
（4）密码重置凭证应与账户严格绑定，并设置有效时间，避免攻击者通过修改账户
ID的方式重置他人密码。
（5）对客户端传入的数据要进行严格的校验，手机号、邮箱地址等重要信息应和后
台数据库中已存储的信息进行核对，不应从客户端传入的参数中直接取用。避免攻击者通
过篡改传入数据的方式重置他人密码。
（6）对用户注册、手机邮箱绑定等业务逻辑进行审计，避免攻击者通过用户重复注
册和越权绑定等漏洞间接重置他人密码。
第16章 越权访问安全案例总结
16.1 平行越权
攻击者请求操作（增、删、查、改）某条数据时，Web 应用程序没有判断该数据的
所属人，或者在判断数据所属人时直接从用户提交的表单参数中获取（如用户ID），导
致攻击者可以自行修改参数（用户ID），操作不属于自己的数据，如图16-1所示。
图16-1 平行越权流程图
16.1.1 某高校教务系统用户可越权查看其他用户个人信息
某高校教务系统存在平行越权漏洞。通过测试发现，学号有规律可循，学号后4位是
连续的数字，普通用户登录系统后可越权查看其他学生的学籍信息、课程成绩等敏感信
息。
步骤一：以“高某某”学号为12xxxx0031为例，登录教务系统，并查看该账号的学籍信
息。查看学籍信息链接为 http：//host/search.do？m=xsx&xh=12Sxxx0031，如图16-2所
示。
图16-2 查看学号为12xxxx0031的学生的学籍信息
步骤二：访问学号为 12Sxxx0032 的学生的学籍信息，链接为 http：//host/search.do？
m=xsx&xh=12Sxxx0032，如图16-3所示。
图16-3 越权查看其他学号（12xxxx0032）的学籍信息
步骤三：访问学号为 12Sxxx0033 的学生的学籍信息，链接为 http：//host/search.do？
m=xsx&xh=12Sxxx0033，如图16-4所示。
图16-4 越权查看学号12xxxx0033的学籍信息
16.1.2 某电商网站用户可越权查看或修改其他用户信息
某电商网站存在越权漏洞可任意进行读取或删除其他用户收货地址、订单信息等操
作。
步骤一：注册账号并登录，当前用户名为 april，UserID 为 460，添加收货地址并查
看“我的地址簿”，如图16-5所示。
图16-5 查看UserID为460的地址簿
步骤二：使用Burp Suite抓包，修改cookie中的UserID为460，提交后服务器返回地址
信息，如图16-6所示。
图16-6 越权查看UserID为460的地址信息
步骤三：修改cookie中的UserID为360，提交后服务器返回地址信息，如图16-7所示。
图16-7 越权查看UserID为360的地址信息
步骤四：在前台下单并提交后，单击查看“我的订单”，如图16-8所示。
图16-8 单击“我的订单”查看订单详细信息
同时使用Burp Suite抓包发现用户ID为460，其订单详细信息如图16-9所示。
图16-9 使用Burp Suit查看当前UserID（460）订单信息
步骤五：修改cookie中的UserID为360，提交后服务器返回的订单信息如图16-10所
示。
图16-10 越权查看UserID为360的订单信息
16.1.3 某手机APP普通用户可越权查看其他用户个人信息
某手机APP查看“个人信息”功能存在平行越权漏洞，可越权查看其他用户个人信息。
步骤一：注册用户并登录后单击“系统设置→个人信息”处查看个人信息，如图16-11
所示。
图16-11 查看当前个人用户信息
步骤二：使用Burp Suite抓包并修改studentId为188750，提交后服务器返回的其他用
户信息如图16-12所示。
图16-12 越权查看studentId为188750的用户信息
步骤三：修改studentId为138850，提交后服务器返回的其他用户信息如图16-13所
示。
图16-13 越权查看studentId为138850的用户信息
16.2 纵向越权
16.2.1 某办公系统普通用户权限越权提升为系统权限
服务器为鉴别客户端浏览器会话及身份信息，会将用户身份信息存储在 Cookie中，
并发送至客户端存储。攻击者通过尝试修改Cookie中的身份标识为管理员，欺骗服务器分
配管理员权限，达到垂直越权的目的，如图16-14所示。
某办公系统存在纵向越权漏洞，通过修改Cookie可直接提升普通用户权限为系统权
限。
图16-14 纵向越权流程图
步骤一：使用普通权限账号a02登录办公系统，成功登录后访问链接
http：//host/aaa/bbb/editUser.asp？iD=2，尝试修改权限。
由于普通用户无法访问修改权限模块，系统会跳转到NoPower页面提示用户无操作权
限，如图16-15所示。
图16-15 a02用户没有权限访问该模块
步骤二：使用Burp Suite修改Cookie中的Tname参数为admin，欺骗服务器该请求为系
统管理员发出的，成功提升账号a02为系统管理员权限，如图16-16所示。
图16-16 将a02用户Cookie中的Tname修改为admin
步骤三：再次访问权限修改modifyuser页面http：//host/aaa/bbb/editUser.asp？iD=2，
如图16-17所示可成功访问。
图16-17 a02账号权限提升成功
16.2.2 某中学网站管理后台可越权添加管理员账号
攻击者通过删除服务器响应数据包中的跳转JS代码，未经身份验证直接进入后台“添
加用户”页面。然后利用Cookie先后添加普通用户A与B，虽然A与B不能直接修改自己的
权限，但A与B可相互修改对方的权限，因此攻击者利用A将B的权限修改为管理员权限，
并以 B 的身份登录后台，最终实现垂直越权获得管理员权限，如图16-18所示。
图16-18 纵向越权流程图
某学校网站管理后台存在越权漏洞，可以越权添加管理员账号。
步骤一：访问登录页面，尝试登录，如图16-19所示。
图16-19 身份认证未通过
访问 http：//www.xxx.com/WEB/ABC/addUser.aspx 可直接打开添加用户页面，如图
16-20所示。
图16-20 未授权访问新增用户模块
添加账号test，密码123456，添加完用户返回首页登录，如图16-21所示。
图16-21 使用新添加的用户登录系统
步骤二：登录成功后，提示没有分配管理权限，然后会强制退出管理系统，如图16-
22所示。
图16-22 test用户没有被管理员分配权限
但此时会生成一个Cookie，如图16-23所示。
图16-23 查看test用户的Cookie
步骤三：使用该Cookie访问http：//www.xxx.com/WEB/ABC/userList.aspx，可直接打
开分配权限的页面。其中test用户不能修改自己的权限，但可以修改其他用户的权限。再
添加一个新用户test2，两者可以互相添加权限，如图16-24所示。
图16-24 新增另一用户test2
步骤四：使用test账号修改test2账号的权限为管理员权限，如图16-25所示。
图16-25 修改test2用户为管理员权限
步骤五：使用test2账号重新登录，成功进入管理后台，如图16-26所示。
图16-26 test2用户成功登录管理员后台
16.2.3 某智能机顶盒低权限用户可越权修改超级管理员配置信息
攻击者以普通管理员身份登录后台，通过搜集信息获得管理员请求数据包进行重放，
越权修改超级管理员模块的设置，如图16-27所示。
图16-27 纵向越权流程图
某智能机顶盒设备在后台管理上存在越权漏洞，在同一网络中的任意用户可以利用受
影响的页面，越权修改超级管理员的设备配置信息。
步骤一：使用超级管理员登录，配置 user 密码。智能机顶盒设备的超级管理员的账
户名和密码为 chinanet/123456，登录后查看该机顶盒的设备信息，如图 16-28所示。
图16-28 超级管理员登录系统后台
使用超级管理员登录后，在“管理”模块下的“用户管理”中配置 user 用户的密码，如图
16-29所示。
图16-29 user用户密码配置
步骤二：使用超级管理员配置proxy代理地址，通过超级管理员在“应用”模块下
的“proxy代理”中配置，然后获取相关的测试链接和参数，设置的值如图16-30所示。
图16-30 proxy代理配置
步骤三：通过这次的简单配置后，使用抓包软件进行抓取提交的链接和参数，如图
16-31所示。
图16-31 修改proxy代理的数据包
步骤四：退出超级管理员，清除浏览器的Cookie信息，使用user账号登录操作。与超
级管理员相比，user用户在“应用”模块中只有简单的“日常应用”一项权限，并没有其他的