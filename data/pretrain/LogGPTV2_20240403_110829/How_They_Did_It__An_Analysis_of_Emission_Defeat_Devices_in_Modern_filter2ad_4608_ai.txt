Eos
Matched Cycles (upper bound)
ECE-15, EUDC(L), NEDC
ECE-15, FTP-75, HWFET, LA92, NEDC, SC03, US06
ECE-15, EUDC(L), NEDC
ECE-15, EUDC(L), NEDC
ECE-15, EUDC(L), NEDC
ECE-15, EUDC(L), NEDC
ECE-15, EUDC(L), FTP-75, HWFET, LA92, NEDC, SC03,
US06
ECE-15, EUDC(L), NEDC
ECE-15, EUDC(L), FTP-75, HWFET, LA92, NEDC, SC03,
US06
ECE-15, EUDC(L), NEDC
ECE-15, EUDC(L), FTP-75, HWFET, LA92, NEDC, SC03,
US06
ECE-15, EUDC(L), NEDC
ECE-15, EUDC(L), NEDC
ECE-15, EUDC(L), FTP-75, HWFET, LA92, NEDC, SC03,
US06
ECE-15, EUDC(L), FTP-75, HWFET, LA92, NEDC, SC03,
US06
ECE-15, NEDC
ECE-15, EUDC(L), FTP-75, HWFET, LA92, NEDC, SC03,
US06
(deactivated)
ECE-15, EUDC(L), NEDC
ECE-15, EUDC(L), NEDC
ECE-15, EUDC(L), NEDC
ECE-15, NEDC
ECE-15, EUDC(L), NEDC
ECE-15, EUDC(L), NEDC
ECE-15, NEDC
ECE-15, EUDC(L), NEDC
ECE-15, EUDC(L), NEDC
ECE-15, EUDC(L), NEDC
ECE-15, EUDC(L), NEDC
ECE-15, EUDC(L), NEDC
CADC-RURAL, CADC-URBAN, ECE-15, EUDC(L), FTP-
75, HWFET, IM240, J1015, JP10, LA92, NEDC, RTS-95,
SC03, US06, WLTP-1, WLTP-2, WLTP-3
ECE-15, NEDC
ECE-15, FTP-75, HWFET, LA92, NEDC, SC03, US06
ECE-15, EUDC(L), NEDC
ECE-15, EUDC(L), NEDC
ECE-15, NEDC
ECE-15, EUDC(L), NEDC
ECE-15, EUDC(L), NEDC
ECE-15, NEDC
ECE-15, NEDC
ECE-15, NEDC
ECE-15, EUDC(L), NEDC
ECE-15, NEDC
ECE-15, EUDC(L), NEDC
ECE-15, EUDC(L), NEDC
ECE-15, NEDC
St.W.













































245
Authorized licensed use limited to: IEEE Xplore. Downloaded on March 18,2021 at 12:25:49 UTC from IEEE Xplore.  Restrictions apply. 
Generally speaking, there are two approaches to distinguish
regular street driving conditions from those (rather special)
conditions exhibited during emission tests: active and passive
detection. Active detection techniques take characteristics of
the car during emission tests into account and hence are able
to target speciﬁc tests. Most notably, the Volkswagen defeat
device covered in this paper is able to detect an ongoing
emission test based on the car’s driving proﬁle and comparing
it to well-known test curves. Our approach is based on this
insight and we propose a curve-agnostic method to detect
that the ﬁrmware attempts to match a certain driving proﬁle.
CURVEDIFF can detect such defeat devices and we found
many instance of such devices. However, a car manufacturer
could also implement other active evasion approaches, for
example by matching on the proﬁle of related parameters such
as speed or torque; another concrete example being the defeat
device found in the Opel Zaﬁra [9].
On the other hand, passive detection techniques cover test-
agnostic methods that do not actively observe vehicle speciﬁcs
to detect an ongoing emission test, but rather target general
peculiarities of those tests. For example, emission tests are
comparably short, which opens up the possibility to simply
stay in a compliant mode for as long as the average emission
test is carried out and switch to a more harmful emissions
policy afterwards. The Fiat defeat device we discussed earlier
belongs to this category. In principle, an ECU can leverage
all available sensors in an attempt to ﬁngerprint the testing
environment, for example by measuring the temperature or the
ambient pressure since both are also standardized. In addition
to software-based methods, hardware-based approaches such
as over-inﬂating tires for dynamometer tests also fall into
this category. Our coverage of such passive defeat devices is
limited since we focus on curve-based defeat devices. This is
mostly due to the fact that the latter approach provides higher
means of conﬁdentiality. Still, tracking the data ﬂow in the
code and analyzing whether certain sensor conditions inﬂuence
the Exhaust Gas Recirculation (EGR) or other subsystems
related to emission control might enable the detection of such
passive devices. As part of future work, we plan to study the
viability of such an approach and evaluate if we can detect
Fiat’s defeat device in an automated manner.
We implemented our approach in a tool called CURVEDIFF.
Given that we perform an intra-procedural analysis, we might
miss certain ways how a defeat device can be implemented
and an inter-procedural analysis could enhance the soundness
of our implementation. Furthermore, our analysis can be
extended to take more primitive building blocks such as timers
and multiplexers into account to deepen the knowledge about
the relation of various components in the detection logic.
VIII. CONCLUSION
As software control becomes a pervasive feature of complex
systems, regulators in the automotive domain (as well as many
others) will be faced with certifying software systems whose
manufacturers have an immense ﬁnancial incentive to cheat.
In this paper, we described two families of defeat devices used
in the Bosch EDC17 ECU to circumvent US emission tests.
The ﬁrst family of defeat devices was used by Volkswagen and
lies at the heart of the Volkswagen diesel emissions scandal.
The second device appears in the diesel Fiat 500X automobile
sold in Europe, and has not beed documented previously. We
also presented and evaluated an automated approach to detect
defeat devices in a given ﬁrmware image based on the insights
we obtained from manually analyzing the Volkswagen defeat
device.
ACKNOWLEDGMENTS
Part of this work was supported by the European Research
Council (ERC) under the European Union’s Horizon 2020
research and innovation programme (grant agreement No
640110 – BASTION). This work was funded in part by the
National Science Foundation through grant NSF-1646493.
REFERENCES
[1] Association for Standardisation of Automation and Measuring Systems
https://wiki.asam.net/
(ASAM e.V.). ASAM MCD-2 MC.
display/STANDARDS/ASAM+MCD-2+MC.
[2] Michael A. Bender, Mart´ın Farach-Colton, Giridhar Pemmasani, Steven
Skiena, and Pavel Sumazin. Lowest Common Ancestors in Trees and
Directed Acyclic Graphs. In Journal of Algorithms, 2005.
[3] Robert J. Blaszczak. EPA Technical Bulletin: Nitrogen Oxides (NOx)
https://www3.epa.gov/
– Why and How They are Controlled.
ttncatc1/cica/other7_e.html, 1999.
[4] Robert N. Charette. This Car Runs on Code. IEEE Spectrum, 46(3),
2009.
[5] Jong-Deok Choi, Ron Cytron, and Jeanne Ferrante. Automatic Con-
struction of Sparse Data Flow Evaluation Graphs. In ACM Symposium
on Principles of Programming Languages (POPL), 1991.
[6] Ron Cytron, Jeanne Ferrante, Barry K. Rosen, Mark N. Wegman, and
F. Kenneth Zadeck. Efﬁciently Computing Static Single Assignment
Form and the Control Dependence Graph.
In ACM Transactions on
Programming Languages and Systems (TOPLAS), 1991.
[7] DieselNet. Emission Test Cycles. https://www.dieselnet.com/
standards/cycles.
[8] Christof Ebert and Capers Jones. Embedded Software: Facts, Figures,
and Future. Computer, 42(4), 2009.
[9] Felix Domke. Software Deﬁned Emissions, 33C3. https://media.
ccc.de/v/33c3-7904-software_defined_emissions.
[10] Felix Domke and Daniel Lange.
The exhaust emissions scandal
(“Dieselgate”), 32C3. https://media.ccc.de/v/32c3-7331-the_
exhaust_emissions_scandal_dieselgate.
[11] Fiat Chrysler Automobiles. FCA on Real Driving Emissions. https://
www.fcagroup.com/en-US/media_center/fca_press_release/
2016/february/Pages/fca_on_real_driving_emissions.aspx,
2016.
[12] Ulrich Flaig, Wilhelm Polach, and Gerhard Ziegler. Common Rail
System (CR-System) for Passenger Car DI Diesel Engines; Experiences
with Applications for Series Production Projects.
In SAE Technical
Paper. SAE International, 1999.
[13] Hex-Rays SA. Product Page for the Interactive Disassembler. https:
//www.hex-rays.com/products/ida.
[14] Laura Myers. GM Forced to Recall Cadilacs with Emission ‘Defeat
http://www.apnewsarchive.com/1995/GM-Forced-
Device’.
to-Recall-Cadillacs-With-Emission-Defeat-Device-/id-
4b030c7601a14dcc8208fcc1d1bd30cc, 1995.
[15] New York State Ofﬁce of the Attorney General. NY A.G. Schneiderman,
Massachusetts A.G. Healey, Maryland A.G. Frosh Announce Suits
Against Volkswagen, Audi And Porsche Alleging They Knowingly
Sold Over 53,000 Illegally Polluting Cars And Suvs, Violating State
Environmental Laws. http://www.ag.ny.gov/press-release/ny-
ag-schneiderman-massachusetts-ag-healey-maryland-ag-
frosh-announce-suits-against, 2016.
[16] Robert Bosch GmbH. Diesel Engine Management. John Wiley & Sons
Ltd., fourth edition, 2005.
246
Authorized licensed use limited to: IEEE Xplore. Downloaded on March 18,2021 at 12:25:49 UTC from IEEE Xplore.  Restrictions apply. 
8018763a call32 re_12 #800b64f0 a4_9 d4_12
8018764a call32 re_13 #800b64f0 a4_10 d4_13
80187694 call32 re_15 #800b64f0 a4_12 d4_15
80187684 call32 re_14 #800b64f0 a4_11 d4_14
re_12
re_13
re_15
re_14
8018763a cconv.w d2_26 re_12
8018764a cconv.w d2_27 re_13
         phi d9_3 [d9_1 d9_2 d9_2 d9_2]
80187694 cconv.w d2_32 re_15
80187684 cconv.w d2_31 re_14
d9_3
d2_26
d2_27
d9_3
d9_3
d2_32
d9_3
d2_31
ge d2_18 d2_17 d9_3
80187644 mov16 d15_105 d2_26
d9_3
8018764e ge d2_28 d2_27 d9_3
d9_3
80187698 ge d2_33 d2_32 d9_3
d9_3
d9_3
8018768e mov16 d15_114 d2_31
5_87
d2_18
d15_105
d2_28
d2_33
d15_114
801875c2 and.ge d2_19 d2_18 d9_3 d15_87
80187656 and.ge d2_29 d2_28 d9_3 d15_105
801876a0 and.ge d2_34 d2_33 d9_3 d15_114
d2_19
d2_29
d2_34
801875c8 xor32 d2_20 d2_19 #1
8018765c xor32 d2_30 d2_29 #1
801876a6 xor32 d2_35 d2_34 #1
d2_20
d2_30
d2_35
z16 d2_20 #801875d8
80187666 jz16 d2_30 #8018766c
801876b0 jz16 d2_35 #801876b6
801876fa jz1
Fig. 10: A part of a connected component in the data-ﬂow forest of the defeat device. It can be seen how the boundaries obtained via two calls to the
SrvX IpoCurveS16 (at 0x800b64f0) are compared against the covered distance (in d93). Speciﬁcally, following the two leftmost curve calls (at 0x8018763a
and 0x8018764a), we end up with the forward join node at 0x80187656 (and.ge d2, d2, d9, d15), implementing the interval check. Similarly, the φ
node deﬁning d93 is a backward join node, whose deﬁnition equals to the distance covered so far. Continuous lines represent data ﬂow of the labeled variable,
whereas dotted lines show control dependencies.
TABLE IV: Overview of various test cycles used for emissions testing. The
ﬁrst segment details tests following US EPA and CARB legislation, the second
segment is relevant to EU law, and the last segment shows international
standards. Information follows [7], [20].
Abbreviation
EPA IM-240
FTP-75, EPA-75
EPA HWFET
SFTP SC03
CARB LA92
CADC-RURAL
CADC-URBAN
UN/ECE 15
UN/EUDC
UN/EUDCL
NEDC
WLTP
Full Name
Inspection and Maintenance
Federal Test Procedure
Highway Fuel Economy Driving Schedule
Speed Correction Driving Schedule, SC03 SFTP
“Uniﬁed” Dynamometer Driving Schedule, Uniﬁed
Cycle
Common Artemis Driving Cycles, Rural Road Cycle
Common Artemis Driving Cycles, Urban Cycle
ECE Elementary Urban Cycle
ECE Extra-Urban Driving Cycle
ECE Extra-Urban Driving Cycle for Low-Powered
Vehicles
New European Driving Cycle
Worldwide Harmonized Light Vehicles Test Proce-
dure
[17] The Telegraph.
inves-
http://www.telegraph.co.uk/cars/news/diesel-
tigation.
emissions-scandal-fiat-under-investigation, 2016.
scandal: Fiat under
Diesel emissions
[18] United States Environmental Protection Agency.
Notice of Vio-
https://www.epa.gov/sites/production/files/2015-
lation.
10/documents/vw-nov-caa-09-18-15.pdf, 2015.
[19] US Code of Federal Regulations. 40 CFR §86.
[20] US Environmental Protection Agency (EPA).
Drive Schedules.
emissions-testing/dynamometer-drive-schedules.
Dynamometer
https://www.epa.gov/vehicle-and-fuel-
[21] Volkswagen of America, Inc. Self Study Program 826803: 2.0 Liter TDI
Common Rail BIN5 ULEV Engine. http://www.natef.org/natef/
media/natefmedia/vw\%20files/2-0-tdi-ssp.pdf, 2008.
[22] WirtschaftsWoche Online. Kommt der zweite Abgasskandal aus Italien?
http://www.wiwo.de/unternehmen/auto/fiat-500x-doblo-
und-jeep-renegade-kommt-der-zweite-abgasskandal-aus-
italien/14483066.html, 2016.
APPENDIX
/ begin MEASUREMENT
InjCrv stNsCharCor
" Status der Akustikbedingung "
UBYTE
OneToOne
1
100
0.00
255 .0
FORMAT "%5 .1"
ECU_ADDRESS 0 xC0000CDD
/ end MEASUREMENT
/ begin CHARACTERISTIC
AirCtl numInjChar CA
" Abgasstrategie f Ã r AirCtl und VswCtl "
MAP
0 x801C5A34
Map_Xu8Yu8Wu8
255 .0
OneToOne
0.00
255 .0
FORMAT "%5 .1"
EXTENDED_LIMITS 0.00 255 .0
/ begin AXIS_DESCR
STD_AXIS
InjCrv_stNsCharCor
OneToOne
...
from an A2L ﬁle, depicting metadata given for
Listing 1: Excerpt
the acoustic condition InjCrv stNsCharCor as well as
the array
AirCtl numInjChar CA. In the latter case, it is evident how the x axis
is indexed by the acoustic condition. Akin to regular symbol ﬁles,
the
ECU ADDRRESS entry identiﬁes the address of the variable in the ﬁrmware
image.
247