北京市西城区西直门南大街2号成铭大厦C座807室（100035）
奥莱利技术咨询（北京）有限公司
本书有一个Web页面，上面列出了勘误表、一些实例以及所有的附加信息。可以通
过以下链接来访问这个页面。
4 ｜ 前言
http://www.oreilly.com/catalog/httptdg/
为本书提意见或者询问一些技术性问题，可以向以下地址发送邮件。
PI:EMAIL
更多与书籍、会议、资源中心以及 O’Reilly 网络有关的问题，都请参见 O’Reilly
的网站。
http://www.oreilly.com
致谢
本书是很多人共同劳动的成果。五位作者要感谢一些人，感谢他们为这本书所作出
的巨大贡献。
首先，我们要感谢 O’Reilly 的编辑 Linda Mui。Linda 早在 1996 年就与 David 和
Brian进行了首次接触，她还提炼了几个概念，并将其融入到今天大家拿到的这本书
中。Linda还帮助我们这帮首次写书、徘徊不定的人协调一致地按计划逐步完成了
这本书的写作（尽管我们完成得并不怎么快）。最重要的是，Linda给了我们一个创
作此书的机会。我们要对她表示由衷的感谢。
我们还要感谢以下人士，他们非常聪明博学而且非常友善，为校对、注释并修订
本书草稿花费了大量精力。他们是：Tony Bourke、Sean Burke、Mike Chowla、
Shernaz Daver、Fred Douglis、Paula Ferguson、Vikas Jha、Yves Lafon、Peter
Mattis、Chuck Neerdaels、Luis Tavera、Duane Wessels、Dave Wu和Marco Zagha。
他们的一些观点和建议大大提升了本书的质量。
本书大部分精美的插图都是由O’Reilly的Rob Romano制作的。为了能够更加清晰
地描述一些微妙的概念，本书使用了大量详尽备至的插图。其中很多插图制作起来
都很费劲，而且还经过了大量的修改。如果一幅图相当于一千个字的话，Rob就相
当于为本书增加了数百页的篇幅。
Brian还要特别感谢所有作者对本项目的付出。为了对HTTP作出首次详细而又切
实可行的剖析，作者们投入了大量的时间。其间虽然出现了婚礼、孩子出世、刻不
容缓的工作项目、创业公司起步以及就读研究生院等诸多问题，但作者们的共同努
力使这个项目得以圆满完成。我们相信，每个人的努力付出都是值得的，而且最重
要的是，这项工作为大家提供了一项很有价值的服务。Brian还要感谢Inktomi的员
工们，感谢他们的热情和支持，以及他们对HTTP在实际应用程序中应用状况的深
前言 ｜ 5
刻洞察力。同时，还要感谢Cajun-shop.com允许我们使用他们的站点来展示书中的
一些范例。
David要感谢他的家人，尤其是母亲和祖父长期以来不懈的支持。他要感谢那些在
写书这几年中忍受他古怪作息习惯的家人们。他要对Slurp、Orctomi和Norma所做
的一切表示感谢，还要感谢合作者们的辛勤工作。最后，他要感谢Brian说服自己
再次冒险。
Marjorie 要感谢她丈夫 Alan Liu 的技术洞察力，以及他对家庭的支持和理解。
Marjorie还要感谢合作者们丰富且深刻的灵感和洞察力。在编写过程中能够与他们
共同工作，她感到非常开心。
Sailu要感谢David和Brian为他提供机会参与编写本书，感谢Chuck Neerdaels将
他引入了HTTP的世界。
Anshu要感谢他的妻子Rashi和他的父母。尽管本书的编写旷日持久，但家人依旧
对他有着足够的耐心，不断地支持并鼓励他。
最后，作者们要集体感谢各位著名和无名的因特网先驱们，他们在过去40年中所做
的研究、开发和传播工作对我们的科学界、社会及经济团体作出了巨大的贡献。没
有他们的工作，就没有本书所要讨论的话题。
6 ｜ 前言
目录
第一部分 HTTP：Web的基础
第1章 HTTP概述 ............................................................................................................................3
1.1 HTTP——因特网的多媒体信使 ...............................................................................................4
1.2 Web客户端和服务器 .................................................................................................................4
1.3 资源 .............................................................................................................................................5
1.3.1 媒体类型 ........................................................................................................................6
1.3.2 URI..................................................................................................................................7
1.3.3 URL ................................................................................................................................7
1.3.4 URN ................................................................................................................................8
1.4 事务 .............................................................................................................................................9
1.4.1 方法 ................................................................................................................................9
1.4.2 状态码 ..........................................................................................................................10
1.4.3 Web页面中可以包含多个对象 ..................................................................................10
1.5 报文 ...........................................................................................................................................11
1.6 连接 ...........................................................................................................................................13
1.6.1 TCP/IP ..........................................................................................................................13
1.6.2 连接、IP地址及端口号 ..............................................................................................14
1.6.3 一个使用Telnet的实例 ..............................................................................................16
1.7 协议版本 ...................................................................................................................................18
1.8 Web的结构组件 .......................................................................................................................19
1.8.1 代理 ..............................................................................................................................19
1.8.2 缓存 ..............................................................................................................................20
1.8.3 网关 ..............................................................................................................................20
1.8.4 隧道 ..............................................................................................................................21
1
1.8.5 Agent代理 ....................................................................................................................21
1.9 起始部分的结束语 ...................................................................................................................22
1.10 更多信息 .................................................................................................................................22
1.10.1 HTTP协议信息 ........................................................................................................22
1.10.2 历史透视 ...................................................................................................................23
1.10.3 其他万维网信息 .......................................................................................................23
第2章 URL与资源 ...........................................................................................................................25
2.1 浏览因特网资源 .......................................................................................................................26
2.2 URL的语法 ..............................................................................................................................28
2.2.1 方案——使用什么协议 ...............................................................................................29
2.2.2 主机与端口 ..................................................................................................................30
2.2.3 用户名和密码 ..............................................................................................................30
2.2.4 路径 ..............................................................................................................................31
2.2.5 参数 ..............................................................................................................................31
2.2.6 查询字符串 ..................................................................................................................32
2.2.7 片段 ..............................................................................................................................33
2.3 URL快捷方式 ..........................................................................................................................34
2.3.1 相对URL .....................................................................................................................34
2.3.2 自动扩展URL .............................................................................................................37
2.4 各种令人头疼的字符 ...............................................................................................................38
2.4.1 URL字符集 .................................................................................................................38
2.4.2 编码机制 ......................................................................................................................38
2.4.3 字符限制 ......................................................................................................................39
2.4.4 另外一点说明 ..............................................................................................................40
2.5 方案的世界 ...............................................................................................................................40
2.6 未来展望 ...................................................................................................................................42
2.7 更多信息 ...................................................................................................................................44
第3章 HTTP报文 ..........................................................................................................................45
3.1 报文流 .......................................................................................................................................46
3.1.1 报文流入源端服务器 ..................................................................................................46
3.1.2 报文向下游流动 ..........................................................................................................47
3.2 报文的组成部分 .......................................................................................................................47
3.2.1 报文的语法 ..................................................................................................................48
3.2.2 起始行 ..........................................................................................................................50
3.2.3 首部 ..............................................................................................................................53
3.2.4 实体的主体部分 ..........................................................................................................55
3.2.5 版本0.9的报文 ...........................................................................................................55
3.3 方法 ...........................................................................................................................................56
3.3.1 安全方法 ......................................................................................................................56
2 ｜ 目录
3.3.2 GET ...............................................................................................................................56
3.3.3 HEAD ...........................................................................................................................57
3.3.4 PUT ...............................................................................................................................57
3.3.5 POST .............................................................................................................................58
3.3.6 TRACE .........................................................................................................................58
3.3.7 OPTIONS......................................................................................................................60
3.3.8 DELETE .......................................................................................................................60
3.3.9 扩展方法 ......................................................................................................................61
3.4 状态码 .......................................................................................................................................62
3.4.1 100～199——信息性状态码 .....................................................................................62
3.4.2 200～299——成功状态码 .........................................................................................63
3.4.3 300～399——重定向状态码 .....................................................................................64
3.4.4 400～499——客户端错误状态码 .............................................................................68
3.4.5 500～599——服务器错误状态码 .............................................................................69
3.5 首部 ...........................................................................................................................................70
3.5.1 通用首部 ......................................................................................................................71
3.5.2 请求首部 ......................................................................................................................72
3.5.3 响应首部 ......................................................................................................................74
3.5.4 实体首部 ......................................................................................................................75
3.6 更多信息 ...................................................................................................................................77
第4章 连接管理 ..............................................................................................................................79
4.1 TCP连接...................................................................................................................................80
4.1.1 TCP的可靠数据管道 ..................................................................................................80
4.1.2 TCP流是分段的、由IP分组传送.............................................................................81
4.1.3 保持TCP连接持续不断地运行 .................................................................................82
4.1.4 用TCP套接字编程 .....................................................................................................84
4.2 对TCP性能的考虑..................................................................................................................85
4.2.1 HTTP事务的时延 .......................................................................................................86
4.2.2 性能聚焦区域 ..............................................................................................................87
4.2.3 TCP连接的握手时延 ..................................................................................................87
4.2.4 延迟确认 ......................................................................................................................88
4.2.5 TCP慢启动 ..................................................................................................................89
4.2.6 Nagle算法与TCP_NODELAY ...................................................................................89
4.2.7 TIME_WAIT累积与端口耗尽 ....................................................................................90
4.3 HTTP连接的处理 ....................................................................................................................91
4.3.1 常被误解的Connection首部 .................................................................................91
4.3.2 串行事务处理时延 ......................................................................................................92
4.4 并行连接 ...................................................................................................................................94
4.4.1 并行连接可能会提高页面的加载速度 ......................................................................94
4.4.2 并行连接不一定更快 ..................................................................................................95
目录 ｜ 3
4.4.3 并行连接可能让人“感觉”更快一些 ......................................................................95
4.5 持久连接 ...................................................................................................................................96
4.5.1 持久以及并行连接 ......................................................................................................96
4.5.2 HTTP/1.0+ keep-alive连接 .........................................................................................97
4.5.3 Keep-Alive操作 ......................................................................................................98
4.5.4 Keep-Alive选项 ......................................................................................................98
4.5.5 Keep-Alive连接的限制和规则 ..............................................................................99
4.5.6 Keep-Alive和哑代理 ............................................................................................100
4.5.7 插入Proxy-Connection ......................................................................................102
4.5.8 HTTP/1.1持久连接 ...................................................................................................104
4.5.9 持久连接的限制和规则 ............................................................................................104
4.6 管道化连接 .............................................................................................................................105
4.7 关闭连接的奥秘 .....................................................................................................................106
4.7.1 “ 任意”解除连接 ........................................................................................................106
4.7.2 Content-Length及截尾操作 ...............................................................................107
4.7.3 连接关闭容限、重试以及幂等性 ............................................................................107
4.7.4 正常关闭连接 ............................................................................................................108
4.8 更多信息 .................................................................................................................................110
4.8.1 HTTP连接 .................................................................................................................110
4.8.2 HTTP性能问题 .........................................................................................................110
4.8.3 TCP/IP ........................................................................................................................111
第二部分 HTTP结构
第5章 Web服务器 ......................................................................................................................115
5.1 各种形状和尺寸的Web服务器 ............................................................................................116
5.1.1 Web服务器的实现 ....................................................................................................116
5.1.2 通用软件Web服务器 ...............................................................................................117
5.1.3 Web服务器设备 ........................................................................................................117
5.1.4 嵌入式Web服务器 ...................................................................................................118
5.2 最小的Perl Web服务器 ........................................................................................................118
5.3 实际的Web服务器会做些什么 ............................................................................................120
5.4 第一步——接受客户端连接 .................................................................................................121
5.4.1 处理新连接 ................................................................................................................121
5.4.2 客户端主机名识别 ....................................................................................................122
5.4.3 通过ident确定客户端用户 ......................................................................................122
5.5 第二步——接收请求报文 .....................................................................................................123
5.5.1 报文的内部表示法 ....................................................................................................124
5.5.2 连接的输入/输出处理结构 .....................................................................................125
5.6 第三步——处理请求 .............................................................................................................126
4 ｜ 目录
5.7 第四步——对资源的映射及访问 .........................................................................................126
5.7.1 docroot ........................................................................................................................127
5.7.2 目录列表 ....................................................................................................................129
5.7.3 动态内容资源的映射 ................................................................................................130
5.7.4 服务器端包含项 ........................................................................................................131
5.7.5 访问控制 ....................................................................................................................131