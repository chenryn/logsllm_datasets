via sendinblue.com. The workaround is using Web-hosting services email or
S_E_Oblako
a fake Gmail or other free mail services.
S_E_Oblako
9
Web Browser Exploitation with
BeEF
BeEF stands for the Browser Exploitation Framework. It is a
penetration testing tool that focuses on the web browser. Amid
growing concerns about web-borne attacks against clients,
including mobile clients, BeEF allows the professional penetration
tester to assess the actual security posture of a target environment
by using client-side attack vectors. Unlike other security
frameworks, BeEF looks past the hardened network perimeter and
client system and examines exploitability within the context of the
one open door: the web browser. BeEF will hook one or more web
browsers and use them as bases for launching directed command
modules and further attacks against the system from within the
browser context. BeEF framework generate a one line java code
that when it is inserted in a website, it will hook the website
visitors and create a connection between the visitor web browser
and the BeEF server, then allow attacker to run commands on the
visitor machine.
BeEF comes preinstalled in older Kali versions (2019.2 and older),
so you should not have to install anything if you're running one of
those versions on your computer.
In mid-2019, Kali removed BeEF as a preinstalled exploitation
tool, moving it from "kali-linux-default" to the "kali-linux-large"
metapackage. That means, if you installed a fresh version of kali
Linux , you will need to install BeEF manually.
In this section we are going to run BeEF and see how it hook the
web browser and what commands can be sent from BeEF server to
the victim browser.
S_E_Oblako
9. Browser exploitation
Exercise 42: Browser Exploitation with BeEF
In this exercise we are going to use BeEF to hook and control users who
access the DVWA website ( DVWA is a website for testing vulnerabilities
that comes part of Metaspolitable virtual machine) by adding BeEF script to
as XSS stored vulnerability. The BeEF hook will allow us to perform many
tasks in the victim machine like trick the user to enter Facebook credentials
thinking that Facebook asking him to relogging plus many other commands
that we can do from BeEF hook.
In real life scenario this is send by hackers in a phishing email that contain a
link to a website that the hacker either have exploited XSS vulnerability or
the website is designed by the hacker which has BeEF hook imbedded inside
a java script in the website.
Note
If you are running Kali 2019.2 or older, BeEF comes already installed, if you
have newer version of Kali such as 2019.3 and higher including Kali 2020 ,
you will need to install BeEF manually. To check if you have BeEF installed
or not in the Kali version you have, go to Kali applications and search for
Beef, if it is not their then follow BeEF installation procedure in point 8
below.
1. In Virtual Box Start Metasplotable virtual machine
S_E_Oblako
S_E_Oblako
2. Login to Metasploitable machine as msfadmin/msfadmin
3. Check its IP address #ifconfig
4. Open Kali and then web browser and go to DVWA page in
Metasplitable VM.
5. Click on Setup then click on Create/Reset Database to clear old
setting and scripts from DVWA database.
6. Click on XSS stored
7. From Kali search for BeEF and start it and log on to beef as
beef/beef
8. BeEF Installation
a. In Kali 2020.1 BeEF does not come installed and
S_E_Oblako
you will need to install it manually, here the
procedure to install BeEF manually
b. #sudo git clone https://github.com/beefproject/beef.git
Go to beef folder #cd opt/beef
c. #sudo ./install
d. To start Beef for the first time you will get error that default
username and password in use.
e. Make sure to switch to root account #sudo su
f. Then edit the file in beef confi.yaml using mousepad text
editor ( or any file text editor) and save.
#sudo su
#mousepad config.yaml
g. Change username and password and save
S_E_Oblako
#./beef
9. If Beef installed manually, every time you want to run beef you
need to do the following:
#cd /opt/beef
#sudo ./beef
S_E_Oblako
10. Open the web browser and go to
http://127.0.0.1:3000/ui/authentication
11. Login to DVWA page at the metasploitable server
S_E_Oblako
12. Set up DVWA Security to low
13. Click on XSS Stored
14. Copy BeEF Hook URL and include it in a java script.
15. Enter the java script that include BeEF hook in the message box of
XSS stored page.
Just make sure to change the IP address to Kali IP address.
Change the length of the Message body from 50 to 500 .
Write the script inside the message body as shown below
S_E_Oblako
16. Click Sign Guestbook in the page.
17. From Windows 10 machine open web browser and go to
Metasploitable DVWA page, then click on XSS stored
S_E_Oblako
Now check BeEF window in Kali, you will see that Windows 10 IP address
is under online browser
S_E_Oblako
18. Click on the IP address of Windows 10 machine, you will get
detailed information about the machine
19. Click on Commands / Social Engineering/ Pretty Theft and choose
Facebook then click execute
S_E_Oblako
20. Look at the Windows 10 browser, you will see Facebook login
dialogue, enter and username and password
S_E_Oblako
21. Go to Kali BeEF page and see the information that entered by the
victim user.
Note
we will know more about Store Cross Site Scripting XSS vulnerability that
we used in the above exercise in the Web penetration testing section.
9.1. Using BeEF to send backdoor
S_E_Oblako
Exercise 43: Hacking Windows 10 using BeEF
If a user accesses a website that is loaded with BeEF hook, attacker will see
the information of the of the machine which it is browsing the website such
as the machine operating system and the browser type. The attacker can then
send fake update to the victim web browser. If the user chooses to allow
update, BeEf will send a reverse shell backdoor which will give the attacker
Metasploit meterpreter session from the victim machine. As we saw before in
Client attacks Meterpreter will give a full control of the victim machine.
In this exercise we are going to use Kali website and insert BeEF java code
inside it, then we are going to connect to the Website from a windows 10
machine , BeEF will send a fake update to the Windows 10 browser user to
have a meterpreter session.
1. Start Kali Virtual machine
2. Start Windows 10 virtual machine
3. From Kali Machine start Beef
#./beef
S_E_Oblako
4. Copy the Hook URL
5. Go to /var/www/html and modify the index.html file by adding the
Beef hook to the file using leafpad.
#leafpad /var/www/html/index.html
6. Add 
S_E_Oblako
7. Save the file
8. We need to have the malware file reverse https that we used
previously in Exercise 36 to be directly under /var/www/html and
change its name to update.exe
9. Start webserver apache2 in Kali
#service apache2 start
10. In kali open browser and go to Beef Webpage
http://127.0.0.1:3000/ui/authentication and login to beef
S_E_Oblako
11. Start windows 10 machine
12. Open Firefox browser and go to kali website http://kali_ip address
13. Look at Beef page in Kali, you will notice new online machine is
listed
14. Highlight the machine to see its details
S_E_Oblako
15. In Beef Click on Commands, then Social Engineering and go to
Fake Notification Bar ( FireFox)
16. Enter the IP address of Kali and the name of the Malware file and
give Notification text
17. -Start Kali Metasploit and setup Metasploit to listen to incoming
connection from the malware file
S_E_Oblako
18. Go to Windows you will see message bar with a request to update
Firefox
19. Click on install plugin , the update.exe file will be downloaded into
the Windows 10 machine
20. Run the update.exe file
S_E_Oblako
21. look at the Metasploit connection , you will see a meterpreter
session established
S_E_Oblako
9.2. Hooking up a Mobile phone
BeEf works with Mobile phones (Android and IOS ) the same way it works
with PC because it works through the Web browser. Even you can send a
malware to the Mobile Phone ( android only ) as an APK file and somehow
convince the victim to run the APK file which will give the attacker complete
access/control over the mobile phone.
If you like to test Beef with Mobile phone either have an android emulator in
your PC , there is a virtual box machines that emulate android, or have
external server with Ubuntu or Kali OS and loaded with Beef and has website
running that contain the Beef hook. Just browse the hooked website from the
Mobile phone and you will see the phone information in the online Browsers
section in Beef.
S_E_Oblako
10.
Detecting Trojans
This is a short theoretical section about Trojans. After gaining a
good understanding of malwares and Trojans through the previous
sections of this book, I wanted the reader to know what is the
Trojans? How they differ from virus? What type of Trojans, how to
protect PC from them and how to detect a file is a Trojan before
running it in the PC.
S_E_Oblako
10. Detecting Trojans
A Trojan horse, or Trojan, is a type of malicious code or software that looks
legitimate but can take control of your computer. A Trojan is designed to
steal, damage, disrupt, or in general inflect some other harmful action on your
data or network.
A Trojan will look like a normal harmless file to trick you. It seeks to deceive
you into loading and executing the malware in your device, once installed, a
Trojan can perform the action it is designed for.
A Trojan different from a virus, a virus can replicate itself, but a Trojan
cannot.
10.1. How Trojans works
You might think you have received an email from someone you know and
click on what looks like a legitimate attachment. But you have been fooled.
The email is from a Hacker, and the file you clicked on — and downloaded
and opened — has gone on to install malware on your device.
When you execute the program, the malware can spread to other files and
damage your computer.
10.2. Trojan Types
Backdoor Trojan: This Trojan can create a “backdoor” on your computer. It
lets an attacker access your computer and control it. Your data can be
downloaded by a third party and stolen, or more malware can be uploaded to
your device.
Distributed Denial of Service (DDoS) attack Trojan: This Trojan performs
DDoS attacks. The idea is to take down a network by flooding it with traffic.
That traffic comes from your infected computer and others.
Downloader Trojan: This Trojan targets your already-infected computer. It
downloads and installs new versions of malicious programs. These can
include Trojans and adware.
Fake AV Trojan: This Trojan behaves like antivirus software but demands
money from you to detect and remove threats, whether they are real or fake.
Info stealer Trojan: As it sounds, this Trojan is after data on your infected
computer.
Mail finder Trojan: This Trojan seeks to steal the email addresses you’ve
accumulated on your device.
S_E_Oblako
Ransom Trojan: This Trojan seeks a ransom to undo damage it has done to
your computer. This can include blocking your data or impairing your
computer’s performance.
Remote Access Trojan: This Trojan can give an attacker full control over
your computer via a remote network connection. Its uses include stealing
your information or spying on you.
Rootkit Trojan: A rootkit aims to hide or obscure an object on your infected
computer. The idea is to extend the time a malicious program runs on your
device.
SMS Trojan: This type of Trojan infects your mobile device and can send
and intercept text messages. Texts to premium-rate numbers can drive up
your phone costs.
Trojan banker: This Trojan takes aim at your financial accounts. It’s
designed to steal your account information for all the things you do online.
That includes banking, credit card, and bill pay data.
Trojan IM: This Trojan target instant messaging. It steals your logins and
passwords on IM platforms.
That is just a sample. There are a lot more.
10.3. Protect against Trojans
Use up to date Anti-Virus/Anti-malware software.
Protect with complex unique password.
Be careful with email attachments. To help stay safe, scan an
email attachment first.
Do not visit unsafe websites. Some internet security software
will alert you that you are about to visit an unsafe site.
Do not open a link in an email unless you are confident it
comes from a legitimate source. In general, avoid opening
unsolicited emails from senders you do not know.
Do not click on pop-up windows that promise free programs
that perform useful tasks.
Do not ever open a link in an email unless you know exactly
what it is.
10.4. Manual Trojans detection
S_E_Oblako
If you are suspecting a file that carry Trojan, right click the file, and see
property. If the file looks like jpg or PDF and carry a Trojan the property will
show it is executable (.exe), also if you try to run the file, Windows 10 will
give you a warning that the file is executable if choose to “run anyway “the
backdoor will be installed in your machine.
If you open resource monitor in Windows 10, you can see all the processes
that uses the internet and which port it is using.
10.5. Using Sandbox
You can use sandbox to analyze the file before running it in your machine,
the sandbox is an online service that you upload the suspected file to it and
they will do complete analysis of the file. Some data in the report will be
hidden for paid version but the data that is not hidden well enough, an expert
eye can tell it is a suspicious file, the link to Sandbox is:
https://www.hybrid-analysis.com/
S_E_Oblako
11
Gaining Access in Real Networks
In all exercises we did so far we were using the virtual internment
that we created in the section 1, there is small different between
doing the previous exercises in virtual environment or in a real
environment in case you want to do a penetration testing to an
organization, this section will show what is the difference and how
to setup the different tools with real network IP addresses and how
to do forwarding from the local Wi-Fi router that the tester is using
to his machine.
S_E_Oblako
11. Gaining access in real network
All the previous attacks such as backdoors and BeEF will work in real
network the same way as in lab the only difference is that by default the
internal Wi-Fi router will not accept incoming connection or even if it accepts
the incoming connection, it does not know what to do with it as the incoming
connection will be using the public IP address.
11.1. Configuring the router
You will need to know the public IP address that you internet connection is
using in the router ad configure the router to forward the incoming request in
specific port to the Kali machine.
Exercise 44: Gaining Access in Real Networks
You need to create malware using Viel Framework as done in
Exercise 29 but you replace the Kali local IP address with Router
public IP address
Check the router public IP address by going to whatsmyip.com page
configure Viel with public IP address and generating the backdoor
S_E_Oblako
Setting the Metasploit :
The Metasploit is the program which make Kali machine listen to the
incoming connection, this should be set with the internal IP address of
the Kali machine not the Public IP address as the forwarding from
public to internal will be done in the router
Setting the Router
Now we need to set the router to forward any connection coming in port
8080 to the Kali Machine internal IP address.
Connect to Router through http using the first IP address in the
router range such as 192.168.0.1
Login to the router
Look for IP FORDWARDING in the router setting
S_E_Oblako
Add port 8080 and point to the Kali machine IP address and save
Setup another role for port 80 to allow the backdoor to be uploaded
from Kali web server to victim machine
S_E_Oblako
Setting up Beef for web browser hookup from outside
Change the IP address in the Java script to the public IP address
Setup the router IP FORWARDING to send connection coming in
port 3000 (Beef port) to the Kali machine internal IP address.
S_E_Oblako
12
Website Penetration Testing
Web penetration testing is the process of using penetration testing
techniques on a web application to detect its vulnerabilities. Web
application penetration testing works by using manual or
automated penetration tests to identify any vulnerability, security
flaws or threats in a web application. In the following sections we
will focus manual and automated Web Pen testing techniques.
S_E_Oblako
12. Website penetration testing
Web Application Penetration Testing is a process in which we use
penetration testing and security skills to find different vulnerabilities in web
applications. It plays an important role in every modern organization. If the
organization does not thoroughly test and secure its web apps, adversaries
can compromise these applications, damage business functionality, and steal
data. The web application penetration testing key outcome is to identify
security weakness across the entire web application and its components
(source code, database, back-end network). It also helps in prioritizing the
identified vulnerabilities and threats, and possible ways to mitigate them.
12.1. Website (web Applications) components
Server (hardware or virtual)
Server Operating system
Web site software such as Apache or IIS
Database such as Mysql , ..
Web application such as php, python
The first step of website penetration testing is data gathering about the
website and its IP address, domain registration information, website software
and many other information. There are many resources that can give this
information online and other tools that can reveal the website info and the
subdomains.
12.2. Website Information Gathering
Whois Lookup: http://whois.domaintools.com/
W3dt.net (free information gathering online tools)
https://pentest-tools.com/home (paid web site for info gathering
tools)
S_E_Oblako
The Data that you need to collect about website to start penetration
testing is:
IP address
Domain Name info