39
 1+A
图9-79用CAM处理器生产Gerber文件
图9-80选择有效的Gerber文件
D
区
CKGHA
日
O
图9-81
在ViewMate中检查Gerber文件
412
---
## Page 425
第9章打造专宝硬件工具
9.1.5焊接调试
收到板子后，焊接出来的效果就像我们之前做的一样，如图9-82和图9-83所示。
图9-82焊接好的HackNET的正面
图9-83焊接好的HackNET的背面
当然，这些直插的网口还能替换为贴片的，图9-84和图9-85所示为 2.0版本的HackNET,
全贴片器件，沉金工艺，体积更小更美观。
图9-84采用沉板贴片RJ45网口的HackNET的正面图9-85采用沉板贴片RJ45网口的HackNET的背面
测试时，左右两个接口分别连接到路由器和目标计算机，如图9-86所示。下方两个网口
连接计算机后使用Wireshark分别侦听双向数据，如图9-87和图9-88所示。
413
---
## Page 426
图9-86HackNET的连接方法图9-87在Wireshark中Snifer正向数据
7
图9-88在Wireshark中Sniffer反向数据
9.2铸造IDSimulator
第6章讲过ID卡模拟器，本节我们就动手铸造一个ID卡模拟器。
414
---
## Page 427
草打悟专压址件工具
9.2.1硬件原理
协议的原理前面章节都介绍过，也提到过用一块Arduino板，配合一个电阻、一个三极
管外加一个线圈，就能模拟ID卡。我们再加一个切换用的LED指示灯。一个开关，一个切
换ID卡号的按键，就可以打造一个ID卡的万能钥匙。
9.2.2硬件选型
这里其实不存在什么选型，使用现成的Arduino方案，外加LED和按键就行。当然，如
果想做得更好，比如想用带Wi-Fi的或者带蓝牙的单片机做，可以通过Wi-Fi或者蓝牙直接修
改ID卡号，那就需要考虑代码移植和功能实现的问题
当然，我们不需要用现成的Arduino板或Arduino Mini，直接用Atmega328单片机就行，
面且这个单片机的封装SparkFun的元件库中有现成的，可以直接使用，其他的品振、电阻电
容也有。
用EAGLE绘制的原理图如图9-89所示。
阳9-89ID Simulator 的原理图
整个原理图其实很简单，拆分看就行。首先是Arduino 的主控单片机 Atmegal68 或者
Atmega328，两者封装一样可以直接替换，再就是晶振、复位电路和 SPI烧写接口，以及烧写
415
---
## Page 428
更性安全职防大据理
bootloader 后，通过 tx、rx 串口外加 dtr 进行烧写的接口，如图9-90所示，可以参照Arduino
Mini 的原理图。实际上绝大多数的单片机都是如此，供电电路、复位电路、品振及烧写接口
就是单片机的最小系统。如果要将Arduino替换成STM8或者STM32单片机，将这部分最小
系统替换就行。
CC2032纽扣电池的供电电路及拨动开关，如图9-91所示。通常需要加儿个滤波电容保
证电源供电的稳定性，需要依照实际情况添加，本例中加一个10uF的钮电容和一个0.1uF的
X7R电容（电容材质相关差异性自行检索，网上有很多对比介绍）。
图9-90Arduino的最小系统
图9-91电池供电电路
天线在网上直接买绕好的125kHz天线线圈，驱动电路用电阻加三极管，再加一个调谐电
容，如图9-92所示。NFC电路的天线感值匹配比较烦琐，用PCB天线也可以，但方便起见，
可以直接用绕制好的 125kHzID卡线圈，网上各种尺寸参数都有，面且很便宜。如果有特殊
需求可以让卖家定制。笔者选用的线圈如图9-93所示，参数如下。
·内径：32mm
·外径：36mm
·线径：0.13mm
416
---
## Page 429
消9室打造专属驶件工具
·厚度：1mm
频率：125kHz
电感：345UH
图9-92125kHz天线电路
图9-93选用的125kHz天线线圈
按键和LED显示电路如图9-94所示。两个按键用于切换和开关，两个LED做指示，上
拉还是下拉依据实际需求面定。
S3
GND
1X3
VV
TX-4
AWW
图9-94LED和按键电路
I/O接口如下。D5引脚控制天线线圈模拟ID卡，正面留三个LED灯作为指示灯，从上
到下分别连接到了D8、D9和D13，同时第三个LED可以作为烧写指示灯，另外两个按键作
为交互按键，从上到下连接到D3、D2，第三个按键作为复位按键。
417
---
## Page 430
9.2.3设计PCB
这个电路很简单，PCB设计就随意了，依照自己所需要的样式布板即可，只要不短路，
电池不放在天线上，其他基本都没问题，为了关观，我们设计成一把钥匙的样子，上面是镂
空的天线线圈，下面装电池，开关在侧面，上面只有按键和LED灯。没有强电也没有高速信
号，线宽用常规的8mil就可以，电源线路可以用10-12mil宽的，顶层和底层之间可以多打过
孔，保证导电性。至于覆铜，设计出来的PCB尺寸比较小，如图9-95所示，隐藏覆钢的项层
和底层视图，如图9-96和图9-97所示。
国
H24
图9-95绘制好的PCB图
图9-96绘制好的PCB顶层视图
围9-97绘制好的PCB底层视图
9.2.4 加加工PCB
PCB 设计完成后，导出Gerber文件，用VicwMate 检查。如图9-98和图9-99所示。
需要注意的是，因为这块PCB功能简单，元件数目少，为了美观，并没有在板上留原件
位号。也就是说，在导出 Gerber 时，并没有在丝印层勾选rName 层和 bName 层，最后生产
出来的PCB上，也就没有各个元件的名称标号，焊接时需要自己对照PCB图进行焊接。在实
际产品生产时，保留丝印能方便焊接调试，但为了安全，防止抄板或者破解，最好还是去掉
418
---
## Page 431
第9章打尚专国硬件工具
板上的丝印。除此之外，还需要磨去芯片上的丝印，最后还可以涂上一层不易溶解的黑色胶
水，这样可以极大地提高破解的难度和抄板成本。
如果没有安全方面的强需求，为了生产效率和良品率，元件丝印是需要的，而且显示要
清晰，位置要对。图9-100所示为360天巡的PCB板的背面，如果不给这些密密麻麻的阻容
标号，想要找某个元件的位置难度很大。
图9-98检查项层视图
图9-99检查底层视图
图9-100360天巡PCB板的背面
在EAGLE中，PCB设计好之后，如果需要调整丝印位置，前面讲过用 Smash命令可以
将元件的丝印刹离出来，可以将它当成一个文字符号移动位置或者调整大小和粗细。需要注
意的是，EAGLE中使用的都是矢量字体，即使在PCB 设计时用了其他字体，最后导出
Gerber时，也会变成矢量字体，所以从一开始就用矢量字体一致性更好。
将Gerber提交给工厂后，付款后等待收货即可。当然，在等待期间，可以从原理图导出
BOM清单，准备元件物料。
9.2.5焊接调试
如图9-101和图9-102所示，收到PCB后，检查有无问题，之后按照BOM焊接
419
---
## Page 432
图9-101加工好的PCB的正面图9-102加工好的PCB的背面
元件数量很少，焊接好后，125kHz天线线圈可以用双面胶或者透明胶固定好，因为焊接
的第一块板子（如图9-103和图9-104所示）要调试，所以直接焊上了排针，代码调试完毕后，
焊接第二块板子时就不需要再焊接排针了，直接用手将排针压在焊盘上保证接触良好，然后
将代码烧写进主控芯片就可以了。
图9-103焊接好的PCB的正面
图9-104焊接好的PCB的背面
420
---
## Page 433
第9章打造专属硬件工具
代码参照第3章的“打造ID万能钥匙”即可。按键功能可以自定义，例如预存两个ID
卡号，然后两个按键来回切换也行，或者一个按键用于切换ID卡号，另一个按键用于模拟和
停止，LED 指示灯的作用也是由读者自由定义，比如显示正在运行或者已经停止。
9.2.6小结
本节主要介绍了怎样将第6章的案例，转换为好玩的硬件设备，读者可以依照这个思路
做设计。
当然，这仅仅是最基础的案例，读者可以根据自己的喜好加入电池充电电路、矩阵键盘
和 OLED 液晶，从而做出类似作者团队出品的 HackID 的硬件。
9.3如何选择硬件方案
在硬件设计之前，要先按照需求评估一个或者几个基础的方案架构，然后按照实施难度
和成本，选择最优芯片方案。
9.3.1方案公司、ODM与OEM
如果你有产品需求，有庞大的资金、良好的供应链和生产广商，也有优秀的销售团队
只是缺少强大的硬件研发团队来研发产品，那么可以考虑找一个方案公司充当硬件研发团队
的角色来制作方案，
有很多方案公司会依照需求做方案。当然，他们仅仅只会给你生产文件，这些方案的设
计文件和知识产权都归属他们。虽然他们也会协助你进行生产，但他们会按照生产的数量收
取授权费。
很多传统行业都是这样做的，养一个强大的研发团队很烧钱，如果只是几个固定的硬件
产品，交给方案公司一劳永选。当然，前提是方案公司实力可靠，不能把方案直接或者变相
卖给你的竞争对手。
般的方案公司都会有很多经验丰富的“老司机”，收费很贵，面且设计方案的知识产
权归属他们，最多唯一授权给你用。通常，方案公司会提供BOM和原理图，也会协助生产测
试，如果想要整体方案，就要再谈判，也称作“买断”。
ODM（Original DesignManufacture，原始设计商），意思是一家厂商根据你的规格和要
421
---
## Page 434
法件安全攻防大易
求设计并生产产品，那个厂商拥有设计能力和技术水平，基于你的授权合同生产产品。简单
地说，就是你掏钱，ODM公司帮你设计和生产，你只管验收产品就可以
至于OEM（Original Equipment/EntrustedManufacture），就是贴牌生产，俗称“贴牌“
“代工”，意思是你有设计方案，找一家生产厂商帮你生产产品，然后贴你的品牌。
ODM和OEM的主要区别是，前者的厂商除了要生产还负责设计，后者只管生产。所以，
可以从方案公司买个方案，然后找个OEM厂商生产。很多传统行业做产品都是这个路线，现
在的互联网公司做硬件产品，也大多是这个路线。因为自己开发费时费力，最后做出来的还
不一定靠谱，直接找方案公司买现成的方案做修改，然后贴牌，最后定制个UI界面开发APP。
款智能硬件产品就出来了。
山寨手机、山寨平板、3G/4G路由、智能摄像头、智能手环基本都是这样的做法。如果
拆解分析硬件，再研究底层固件，会发现都是大同小异。
9.3.2常见的芯片广商
要做一个硬件，通常需要找到几家芯片厂，他们的芯片完全能满足你的需求，但可能因
为价格、交期、供货量等问题让你不得不准备预备方案。这就是体现工程师的经验和能力的
时候。近几年芯片厂商不停并购，除了经济方面因素外，技术革新也是重要原因。曾经只有
个别广商的芯片能实现的功能现在很多厂商都能做，面且做得很好。本节就介绍儿个常见的
多产品线的芯片厂商，读者在设计硬件时可以多几个选择。
1.德州仪器（TI）
中文网址:：htp://www.ti.com.cn
收购美国国家半导体公司以后，产品线非常广，电源、射频、嵌入式等应有尽有，如
图 9-105所示。TI在国内的 FAE（Field Application Engineer，现场技术支持工程师）很多，
TI技术支持和销量业绩挂钩，对那些有庞大芯片用量的大客户的支持很到位。这是很现实的
问题，你不买他们的芯片，或者用量很少，给他们带来不了多少利润，为什么要花费人力物
力给你做技术支持？所有的公司都这样，不要期望免费的午餐。TI的技术论坛活跃度很高，
在上面提问很快就会有FAE网答。TI的所有产品线的产品都不错，不一定排在第一，但肯定
排前几位。例如，经典的cc2530ZigBce、cc2540蓝牙、cc1101 Sub1GHz、BQ系列充电芯片、
AM335x系列嵌入式等，除了成本因素，T1一直是作者首选的芯片厂商。
422
---
## Page 435
第9章打造专属硬件工具
按产品浏览
182
YRI1
 RkZ (VCU
DLP
15R8m
EIt$31
图9-105T1产品线
2.恩智浦半导体（NXP）
中 文 官 β| :http:/www.nxp.com/zh-Hans
收购Freescale之后，NXP 的产品线基本覆盖所有电子行业，如图9-106所示。NXP 的
NFC技术独步天下，收购FSL之后在汽车方面也是一枝独秀，但NXP的FAE人数较少，基
本只针对几个大客户，而且NXP的很多资料都是保密的不对外公开，不签署NDA保密协议
无法拿到。收购FSL以后，嵌入式方面的实力非常强，imx系列的多媒体处理能力很不错。
总体来说，NXP的芯片性价比不错，如果技术支持更到位就更好了。
As电7AS
. 55. 
LUPC.
RXTA)
其的产2E9
58 :
图9-106NXP的产品线
3.美信（MAXIM）
中文官网 : https:/www.maximintegrated.com/cn.html
收购DALLAS 以后，美信在加密芯片领域越发给力，在电源、射频领域也很厉害，美信
423