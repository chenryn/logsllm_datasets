title:RAPTOR: Routing Attacks on Privacy in Tor
author:Yixin Sun and
Anne Edmundson and
Laurent Vanbever and
Oscar Li and
Jennifer Rexford and
Mung Chiang and
Prateek Mittal
RAPTOR: Routing Attacks on Privacy in Tor
Yixin Sun and Anne Edmundson, Princeton University; Laurent Vanbever, ETH Zürich;  
Oscar Li, Jennifer Rexford, Mung Chiang, and Prateek Mittal, Princeton University
https://www.usenix.org/conference/usenixsecurity15/technical-sessions/presentation/sun
This paper is included in the Proceedings of the 24th USENIX Security SymposiumAugust 12–14, 2015 • Washington, D.C.ISBN 978-1-939133-11-3Open access to the Proceedings of  the 24th USENIX Security Symposium is sponsored by USENIXRAPTOR: Routing Attacks on Privacy in Tor
Yixin Sun
Princeton University
Anne Edmundson
Princeton University
Laurent Vanbever
ETH Zurich
Oscar Li
Princeton University
Jennifer Rexford
Princeton University
Mung Chiang
Princeton University
Prateek Mittal
Princeton University
Abstract
The Tor network is a widely used system for anony-
mous communication. However, Tor is known to be
vulnerable to attackers who can observe trafﬁc at both
ends of the communication path. In this paper, we show
that prior attacks are just the tip of the iceberg. We
present a suite of new attacks, called Raptor, that can
be launched by Autonomous Systems (ASes) to com-
promise user anonymity. First, AS-level adversaries can
exploit the asymmetric nature of Internet routing to in-
crease the chance of observing at least one direction of
user trafﬁc at both ends of the communication. Second,
AS-level adversaries can exploit natural churn in Inter-
net routing to lie on the BGP paths for more users over
time. Third, strategic adversaries can manipulate Inter-
net routing via BGP hijacks (to discover the users using
speciﬁc Tor guard nodes) and interceptions (to perform
trafﬁc analysis). We demonstrate the feasibility of Rap-
tor attacks by analyzing historical BGP data and Tracer-
oute data as well as performing real-world attacks on the
live Tor network, while ensuring that we do not harm real
users. In addition, we outline the design of two monitor-
ing frameworks to counter these attacks: BGP monitor-
ing to detect control-plane attacks, and Traceroute moni-
toring to detect data-plane anomalies. Overall, our work
motivates the design of anonymity systems that are aware
of the dynamics of Internet routing.
1
Introduction
Anonymity systems aim to protect user identities from
untrusted destinations and third parties on the Internet.
Among all of them, the Tor network [25] is the most
widely used. As of February 2015, the Tor network com-
prises of 7,000 relays or proxies which together carry
terabytes of trafﬁc every day [8]. Tor serves millions
of users and is often publicized by political dissidents,
whistle-blowers, law-enforcement, intelligence agencies,
journalists, businesses and ordinary citizens concerned
about the privacy of their online communications [9].
Along with anonymity, Tor aims to provide low la-
tency and, as such, does not obfuscate packet timings
or sizes. Consequently, an adversary who is able to ob-
serve trafﬁc on both segments of the Tor communication
channel (i.e., between the server and the Tor network,
and between the Tor network and the client) can corre-
late packet sizes and packet timings to deanonymize Tor
clients [45, 46].
There are essentially two ways for an adversary to
gain visibility into Tor trafﬁc, either by compromising
(or owning enough) Tor relays or by manipulating the
underlying network communications so as to put herself
on the forwarding path for Tor trafﬁc. Regarding net-
work threats, large Autonomous Systems (ASes) such as
Internet Service Providers (ISPs) can easily eavesdrop on
a portion of all links, and observe any unencrypted infor-
mation, packet headers, packet timing, and packet size.
Recent declarations by Edward Snowden have conﬁrmed
that ASes poses a real threat. Among others, the NSA has
a program called Marina which stores meta information
about user communications for up to a year [15], while
the GCHQ has a program called Tempora that stores
meta-information for 30 days and buffers data for three
days [36]. Also, and maybe more importantly, it has been
shown that Tor was targeted by such adversaries in col-
lusion with ASes [10, 12, 11].
In this paper, we present Raptor, a suite of novel trafﬁc
analysis attacks that deanonymize Tor users more effec-
tively than previously thought possible. To do so, and
unlike previous studies on AS-level adversaries [28, 26,
40], Raptor leverages the dynamic aspects of the Inter-
net routing protocol, i.e.
the Border Gateway Protocol
(BGP).
Raptor attacks are composed of three individual at-
tacks whose effects are compounded (§2). First, Raptor
exploits the asymmetric nature of Internet routing: the
BGP path from a sender to a receiver can be different
USENIX Association  
24th USENIX Security Symposium  271
Trafﬁc Analysis
BGP Churn
BGP Hijack
BGP Interception
Symmetric
Asymmetric
Known [45, 46]
Novel (§3)
Novel (§4)
Novel (§5)
Novel (§5)
Table 1: This paper describes Raptor, a suite of previously unknown attacks on the Tor Network
than the BGP path from the receiver to the sender. In-
ternet routing asymmetry increases the chance of an AS-
level adversary observing at least one direction of both
communication endpoints, enabling a novel asymmetric
trafﬁc analysis attack. Second, Raptor exploits natural
churn in Internet routing: BGP paths change over time
due to link or router failures, setup of new Internet links
or peering relationships, or changes in AS routing poli-
cies. Changes in BGP paths allow ASes to observe ad-
ditional Tor trafﬁc, enabling them to deanonymize an in-
creasing number of Tor clients over time. Third, Rap-
tor exploits the inherent insecurity of Internet routing:
strategic adversaries can manipulate Internet routing via
BGP hijack and BGP interception attacks against the Tor
network. These attacks enable the adversary to observe
user communications, and to deanonymize clients via
trafﬁc analysis.
Raptor attacks were brieﬂy discussed in a preliminary
and short workshop paper [48]. In this paper, we go fur-
ther by measuring the importance of the attacks using
real-world Internet control- and data-plane data. We also
demonstrate the attacks feasibility by performing them
on the live Tor network—with success. No real Tor users
were harmed in our experiments (§7). Finally, we also
describe efﬁcient countermeasures to restore a good level
of anonymity. To summarize, we make the following key
contributions:
Asymmetric Trafﬁc Analysis and BGP Churn: Us-
ing live experiments on the Tor network, we showed
that Raptor’s asymmetric trafﬁc analysis attacks can
deanonymize a user with a 95% accuracy, without any
false positives (§3). Using historical BGP and Tracer-
oute data, we showed that by considering routing asym-
metry and routing churn, the threat of AS-level attacks
increases by 50% and 100%, respectively (§4).
BGP Hijacks and Interceptions: We analyzed known
BGP hijacks and interception attacks on the Internet and
show multiple instances where Tor relays were among
the target preﬁxes (§5). As an illustration, the recent Bit-
coin Hijack attack [1] in 2014, as well as Indosat Hijack
attacks [3, 2] in 2014 and 2011 involved multiple Tor re-
lays. To demonstrate the feasibility of such attacks for
the purpose of deanonymizing Tor clients, we success-
fully performed an interception attack against a live Tor
relay. Overall, we found that more than 90% of Tor re-
lays are vulnerable to our attacks.
Countermeasures: We present a comprehensive taxon-
omy of countermeasures against Raptor attacks (§6). In
particular, we outline the design of a monitoring frame-
work for the Tor network that aims to detect suspicious
AS-level path changes towards Tor preﬁxes using both
BGP and Traceroute monitoring.
2 Raptor Attacks
To communicate with a destination, Tor clients establish
layered circuits through three subsequent Tor relays. The
three relays are referred to as: entry (or guard) for the
ﬁrst one, middle for the second one, and exit relay for
the last one. To load balance its trafﬁc, Tor clients se-
lect relays with a probability that is proportional to their
network capacity. Encryption is used to ensure that each
relay learns the identity of only the previous hop and the
next hop in the communications, and no single relay can
link the client to the destination server.
It is well known that if an attacker can observe the
trafﬁc from the destination server to the exit relay as well
as from the entry relay to the client (or trafﬁc from the
client to the entry relay and from the exit relay to the
destination server), then it can leverage correlation be-
tween packet timing and sizes to infer the network iden-
tities of clients and servers (end-to-end timing analysis).
This timing analysis works even if the communication is
encrypted.
In the rest of the section, we present the three Raptor
attacks and how they contrast to conventional symmetric
trafﬁc analysis. We start by discussing how seeing just
one direction of the trafﬁc for each segment (between
the sender and the guard, and between the last relay and
the destination) is sufﬁcient for the adversary (§2.1). We
then explain how ASes can exploit natural BGP dynam-
ics (§2.2), or even launch active attacks (§2.3), to com-
promise the anonymity of Tor users.
2.1 Asymmetric Trafﬁc Analysis
We propose asymmetric trafﬁc analysis, a novel form of
end-to-end timing analysis that allows AS-level adver-
saries to compromise the anonymity of Tor users. Let
us suppose that a Tor client is uploading a large ﬁle to a
Web server. Conventional trafﬁc analysis considers only
one scenario where adversaries observe trafﬁc from the
272  24th USENIX Security Symposium 
USENIX Association
2
entry
AS2
entry-to-client
AS1
client-to-entry
client
dest-to-exit
dest
entry
dest
AS3
AS5
AS4
AS6
exit-to-dest
exit-to-dest
AS3
AS5
AS4
AS6
AS2
AS1
exit
client
exit
Figure 1: Asymmetric routing increases the power of
AS-level adversaries. When considering forward traf-
ﬁc, i.e., client-to-entry and exit-to-destination ﬂows, only
AS5 can compromise anonymity. When considering
both forward and backward trafﬁc though, AS3, AS4
and AS5 can compromise anonymity. Our measurements
conﬁrm that asymmetric trafﬁc analysis is feasible.
client to the entry relay, and from the exit relay to the
Web server (same direction as the ﬂow of trafﬁc)1.
However, Internet paths are often asymmetric:
the
path from the exit relay to the Web server may be dif-
ferent than the path from the Web server to the exit relay.
Thus it is possible that an adversary may not be able to
observe the data trafﬁc on the path from the exit relay
to the server, but it observes the TCP acknowledgment
trafﬁc on the path from the server to the exit relay.
We introduce an asymmetric trafﬁc analysis attack that
allows an adversary to deanonymize users as long as the
adversary is able to observe any direction of the trafﬁc, at
both ends of the communication. Note that we can view
the conventional end-to-end timing analysis as a special
case of our attack, in which the adversary is able to ob-
serve trafﬁc at both ends of the anonymous path, and in
the same direction as the ﬂow of trafﬁc. Routing asym-
metry increases the number of ASes who can observe at
least one direction of trafﬁc at both communication end-
points. We illustrate this scenario in Figure 1.
More concretely, our attack is applicable to four sce-
narios where an adversary observes (a) data trafﬁc from
the client to entry relay, and data trafﬁc from exit relay to
the server, or (b) data trafﬁc from the client to entry re-
lay, and TCP acknowledgment trafﬁc from the server to
exit relay, or (c) TCP acknowledgment trafﬁc from guard
relay to the client, and data trafﬁc from exit relay to the
server, or (d) TCP acknowledgment trafﬁc from guard re-
lay to the client, and TCP acknowledgment trafﬁc from
the server to the exit relay.
A key hurdle in asymmetric trafﬁc correlation is that
TCP acknowledgments are cumulative, and there is not
a one-to-one correspondence between data packets and
1If the trafﬁc is ﬂowing from the server to the client, then end-to-
end timing analysis considers a scenario where the adversary observes
trafﬁc from the Web server to the exit relay and from the entry relay to
the client.
the TCP acknowledgment packets. We overcome this
hurdle by observing that Tor (and other anonymity sys-
tems) use SSL/TLS for encryption, which leaves the TCP
header unencrypted. Our attack inspects TCP headers in
the observed trafﬁc to retrieve the TCP sequence number
ﬁeld and TCP acknowledgment number ﬁeld, and ana-
lyzes the correlation between these ﬁelds of both ends
over time. Our experimental results in Section 3 show
the feasibility of asymmetric trafﬁc analysis, with a de-
tection accuracy of 95%. Furthermore, asymmetric traf-
ﬁc analysis can be combined with other Raptor attacks,
such as exploiting natural churn and BGP interception
attack, which we discuss next.
2.2 Natural Churn
client-to-entry
connection
exit-to-server
connection
dest
entry
entry
dest
AS2
AS1
AS3
AS5
AS4
AS6
potentially
compromising AS
AS3
AS5
AS4
AS6
AS2
AS1
client
exit
client
exit
Figure 2: BGP churn increases the number of ASes that
can deanonymize Tor trafﬁc.
Initially, only AS5 can
deanonymize the client, seeing both direction of the traf-
ﬁc (left). After the failure of link (AS4, AS5), both AS5
and AS3 can deanonymize Tor trafﬁc (right).
When users communicate with recipients over multi-
ple time instances, then there is a potential for compro-
mise of anonymity at every communication instance [49,
42]. Thus anonymity can degrade over time. Tor consid-
ers this threat from the perspective of adversarial relays
(but not adversarial ASes).Tor clients use a ﬁxed entry
relay (guard relay) for a period of time (Dingledine et al.
recommend 9 months [24]) to mitigate this threat with
respect to adversarial relays. We note that the threat of
AS-level adversaries still persists, because even though
the entry relay is ﬁxed, the set of ASes on the path be-
tween the client and the guard relay may change over
time. Next, we discuss such attacks that rely on natural
churn in BGP paths.
The underlying Internet paths between a client and
guard relay vary over time due to changes in the phys-
ical topology (e.g., failures, recoveries, and the rollout
of new routers and links) and AS-level routing policies
(e.g., trafﬁc engineering and new business relationships).
These changes give a malicious AS surveillance power
that increases over time. For example, AS 3 in Figure 2
does not lie on the original path from the exit to the des-
USENIX Association  
24th USENIX Security Symposium  273
3
tination, but a BGP routing change can put AS 3 on the
path, allowing it to perform trafﬁc analysis.
In Section 4, we show that the surveillance capability
of an AS-level adversary can increase up to 50% when
considering BGP churn over a period of one month.
2.3 BGP Hijack
So far, we discussed Raptor attacks that were pas-
sive. Strategic AS-level adversaries are also capable of
launching active attacks, that deviate from honest routing
behavior. Internet routing is vulnerable to attacks which
enable an AS to manipulate inter-domain routing by ad-
vertising incorrect BGP control messages. While these
attacks are well known in the networking community, we
are the ﬁrst to apply these attacks to anonymity systems
such as Tor.
AS-level adversaries can hijack an IP preﬁx [51] by
advertising the preﬁx as its own. The attack causes a
fraction of Internet trafﬁc destined to the preﬁx to be
captured by the adversary. Tor relay nodes can ob-
serve a large amount of client trafﬁc. For example, a
Tor guard relay observes information about client IP ad-
dresses. Thus, the IP preﬁxes corresponding to Tor guard
relays presents an attractive target for BGP hijack.
As a concrete attack example, we consider a scenario
where an AS-level adversary aims to deanonymize the
user associated with a connection to a sensitive Web
server (say a whistleblowing website). The adversary can
ﬁrst use existing attacks on the Tor network to uncover
the identity of the client’s guard relay [39, 37, 31, 42].
Next,
the adversary can launch a BGP hijack attack
against the Tor relay. This allows the adversary to see
trafﬁc destined to the guard relay. BGP hijack thus en-
ables an adversary to learn the set of all client IP ad-