### 问题描述：动态DNS客户端记录未正确更新

我们的网络环境包括运行Windows和macOS的客户端，所有这些客户端都加入了Active Directory。Mac设备通过Bootcamp运行Windows。我们遇到了一些问题，主要是由于macOS客户端未能正确注册PTR记录以及存在过期记录。为了解决这些问题，我花费了大量时间研究DNS和DHCP配置，并认为已经通过以下配置解决了问题。但最近我发现仍然存在问题，具体如下。

#### 服务器配置
- 2台Windows Server 2016虚拟机
- 均为域控制器
- 均运行DNS服务
- 均运行DHCP服务

#### DHCP配置
- 故障转移模式：负载均衡
- 启用DNS动态更新：始终动态更新DNS记录
- 删除租约时丢弃A和PTR记录：已启用
- 为不请求更新的DHCP客户端动态更新DNS记录：已启用
- 禁用DNS PTR记录的动态更新：未启用
- DHCP名称保护：未启用
- 租约期限：2天
- 配置了动态DNS凭据。账户仅为域用户

#### DNS配置
- 活动目录集成区域
- 动态更新：仅安全
- 复制：此域中的所有域控制器
- 不刷新间隔：1天
- 刷新间隔：1天
- 清理周期：3天

#### 组策略
- 计算机\管理模板\网络\DNS客户端\动态更新：设置为禁用

#### 当前问题
1. **macOS客户端仍创建自己的A记录**：
   - 我的目标是让DHCP服务器处理所有DNS注册，以解决macOS客户端不注册PTR记录的问题。现在PTR记录被创建，但macOS客户端似乎仍在创建自己的A记录，因为权限列表中显示的是客户端而不是DNS注册用户。
   - macOS和Windows共享同一块网卡，因此MAC地址不会改变。我认为每个操作系统请求IP时会因MAC地址而获得相同的IP地址，并且DHCP服务器会更新客户端名称。我不确定DNS是否会创建新的A记录，导致单个IP有多个记录；或者DHCP服务器是否会尝试更改与匹配IP的A记录中的客户端名称，如果macOS已经注册了自己的记录，则可能会失败。我不知道如何告诉macOS让DHCP服务器为其注册记录（我们的macOS技术员离职了，留下我们这些Windows技术人员一头雾水）。

2. **Windows客户端未正确注册**：
   - 有时即使Windows客户端也无法正确注册。例如，一个仅运行Windows的设备从DHCP获取了IP地址，但没有A或PTR记录。该设备受上述组策略影响，依赖于DHCP服务器为其注册记录。但在事件查看器中找不到与此客户端相关的DHCP-Server或DNS-Server日志。

3. **静态IP分配的客户端未注册DNS**：
   - 由于组策略设置，任何具有静态IP分配的客户端都不会在DNS中注册。尽管这类客户端数量不多，但我们偶尔会临时分配静态IP用于各种任务（因为DHCP客户端需要代理才能访问互联网）。

如果有遗漏的重要信息，请告诉我。非常感谢您的帮助！

---

### 回复
Roger:
您好，看到您的问题后，我想分享一下我们遇到类似问题时的解决方案，特别是关于“第三个次要问题”。

对于静态IP地址，我们在DHCP中使用保留地址。这样，DHCP服务器可以处理DNS记录的注册。希望这对您有所帮助！祝好运！
Roger