use of SafeBrowsing is fairly common in our dataset, we do not ﬁnd additional
prevalent cases of this “two roots” phenomenon. From a modeling standpoint
Towards a Model of DNS Client Behavior
269
SLDs
Hostnames
Queries
Feb:Residential:Others
Feb:Residential:Users
r
e
l
t
s
u
c
r
e
p
F
D
C
1.0
0.9
0.8
0.7
0.6
0.5
0.4
0.3
0.2
0.1
0.0
1
10
100
Count per metric (log scale)
t
n
e
i
l
c
r
e
p
F
D
C
1.0
0.9
0.8
0.7
0.6
0.5
0.4
0.3
0.2
0.1
0.0
0.1
1
10K
Mean queries sent per day (log scale)
100
1K
10
Fig. 1. Number of queries, hostnames,
and SLDs per cluster.
Fig. 2. Queries issued by each client
per day.
we have not yet determined whether “two roots” clusters would need special
treatment.
Figure 1 shows the distribution of queries per cluster. While the majority of
clusters are small, there are relatively few large clusters. We ﬁnd that 90 %
of clusters contain at most 26 queries for at most 22 hostnames. Addition-
ally, we ﬁnd 90 % of the clusters encompass at most 10 SLDs. The largest
cluster spans 95 s and consists of 9,366 queries for names that match to
the 3rd level label. The second largest cluster consists of 6,211 queries for
myapps.developer.ubuntu.com—which is likely a Ubuntu bug.
5 Query Timing
Next we tackle the question of when and how many queries clients issue. We
begin with the distribution of the average number of queries that clients issue
per day, as given in Fig. 2. We ﬁnd that clients in Users issue 2 K lookups per day
at the median and 90 % of clients in Users issue less than 6.7 K queries per day.
The Others datasets show greater variability where relatively few clients generate
the lion’s share of queries—i.e., the top 5 % of clients produce roughly as many
total DNS queries per day as the bottom 95 % in the Feb:Residential:Others
dataset.
A related metric is the time between subsequent queries from the same client,
or inter-query times. Figure 3 shows the distribution of the inter-query times.
The “Aggregate” line shows the distribution across all clients. The area “90 %”
shows the range within which 90 % of the individual client inter-query time dis-
tributions fall. The majority of inter-query times are short, with 50 % of lookups
occurring within 34 ms of the previous query. However, we also ﬁnd a heavy tail,
with 0.1 % of inter-query times being over 25 min. Intuitively, long inter-query
times represent oﬀ periods when the client’s user is away from the keyboard (e.g.,
asleep or at class). The Others datasets show wide ranging behavior suggesting
that they are less amenable to succinct description in an aggregate model.
270
K. Schomp et al.
1.0
0.9
0.8
0.7
0.6
0.5
0.4
0.3
0.2
0.1
e
m
i
t
y
r
e
u
q
−
r
e
t
n
i
r
e
p
F
D
C
0.0
0.001
90%
Aggregate
Intra−cluster time
Cluster duration
Inter−cluster time
F
D
C
1.0
0.9
0.8
0.7
0.6
0.5
0.4
0.3
0.2
0.1
0.0
1ms
10ms
100ms
1s
10s
100s
Time (log scale)
0.01
100
Inter−query time in seconds (log scale)
0.1
1
10
Fig. 3. Time between queries from the
same client in aggregate and per client.
Fig. 4. Duration of clusters,
inter-
cluster query time and intra-cluster
query time.
For the Users dataset, we are able to model the aggregate inter-query time
distribution using the Weibull distribution for the body and the Pareto distribu-
tion for the heavy tail. We ﬁnd that partitioning the data at an inter-query time
of 22 s minimizes the mean squared error between the data and the two analyti-
cal distributions. Next, we ﬁt the analytical distributions—split at 22 s—to each
of the individual client inter-query time distributions. We ﬁnd that while the
parameters vary per client, the empirical data is well represented by the ana-
lytical models as the mean squared error for 90 % of clients is less than 0.0014.
Thus, parameters for a model of query inter-arrivals will vary per client, but the
distribution is invariant.
Next, we move from focusing on individual lookups to focusing on timing
related to the 1 M lookup clusters that encompass 12 M (80 %) of the queries
in our dataset (see Sect. 4). Figure 4 shows our results. The “Intra-cluster time”
line shows the distribution of the time between successive queries within the
same cluster. This time is bounded to ε = 2.5 s by construction, but over 90 %
of the inter-arrivals are less than 1 s. On the other hand, the line “Inter-cluster
time” shows the time between the last query of a cluster and the ﬁrst query of
the next cluster. Again, most clusters are separated from each other by much
more than ε time, the minimum separation by construction. The line “Cluster
duration” shows the time between the ﬁrst and last query in each cluster. Most
clusters are short, with 99 % less than 18 s. Additionally, we ﬁnd that most of
client DNS traﬃc occurs in short clusters: 50 % of clustered queries belong to
clusters with duration less than 4.6 s and 90 % are in clusters with duration less
than 20 s. For the Others datasets, a smaller percentage of DNS queries occur in
clusters—e.g., 60 % in the Feb:Residential:Others dataset.
6 Query Targets
Finally, we tackle the queries themselves including relationships between queries.
Towards a Model of DNS Client Behavior
271
90%
Aggregate
SLDs
Hostnames
1E+0
1E−1
1E−2
1E−3
1E−4
1E−5
1E−6
1E−7
l
)
e
a
c
s
g
o
l
(
s
e
i
r
e
u
q
l
a
t
o
t
f
o
n
o
i
t
c
a
r
F
1
1E+0
1E−1
1E−2
l
)
e
a
c
s
g
o
l
(
s
t
n
e
i
l
c
f
o
n
o
i
t
c
a
r
F
100K
1E−3
1
100
10
Index of name, sorted (log scale)
10K
1K
100
10
Index of name, sorted (log scale)
10K
1K
100K
Fig. 5. Fraction of queries issued for
each hostname per client.
Fig. 6. Fraction of
queries for each hostname and SLD.
clients
issuing
Popularity of Names: We analyze the popularity of hostnames using two
methods—how often the name is queried across the dataset and how many clients
query for it. Figure 5 shows the fraction of queries for each hostname (with the
hostnames sorted by decreasing popularity) in the Feb:Residential:Users dataset.
Per Sect. 5, we plot the aggregate distribution and a range that encompasses 90 %
of the individual client distributions. Of the 499 K unique hostnames within our
dataset, 256 K (51 %) are looked up only once. Meanwhile, the top 100 hostnames
account for 28 % of DNS queries. Figure 6 shows the fraction of clients that query
for each name. We ﬁnd that 77 % of hostnames are queried by only a single
client. However, over 90 % of the clients look up the 14 most popular hostnames.
Additionally, 13 of these hostnames are Google services and the remaining one
is www.facebook.com. The plot shows similar results for second-level domains
(SLDs), where 66 % of the SLDs are looked up by a single client.
The distributions of both queries per name and clients per name demon-
strate power law behavior in the tail. Interestingly, the Pearson correlation
between these two metrics—popularity by queries and popularity by clients—is
only 0.54 indicating that a domain name with many queries is not necessar-
ily queried by a large fraction of the client population and vice versa. As an
example, updatekeepalive.mcafee.com is the 19th most queried hostname but