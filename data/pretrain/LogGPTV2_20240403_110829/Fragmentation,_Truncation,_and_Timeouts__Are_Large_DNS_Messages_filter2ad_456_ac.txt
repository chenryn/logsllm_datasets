DNS and Large Responses: Large DNS/UDP responses have been previously
shown to cause unreachability [51,53]. In 2011, using active measurements,
Weaver et al. [53] have shown that 9% of clients could not receive fragmented
DNS/UDP packets. Given our vantage point are not clients, we cannot deter-
mine this rate. We showed, however, the number of ICMP messages showing
that DNS messages exceed the path MTU (Sect. 3.2). In a 2012 study [51], the
authors analyzed DNSSEC messages (8.4M) from 230k resolvers to authoritative
servers hosted SURFnet, the Dutch NREN. for 4k+ zones. They showed how
58% of resolvers received fragmented responses for DNSSEC queries.
Our results show a contrast to both of these studies: by analyzing 164B
queries from more than 3M resolvers, for one zone (.nl), we show a tiny fraction
of fragmented queries (10k/day, Sect. 3.2), but our VP allows only to measure
the server-side. Besides, we also analyze truncation, responses sizes distribution,
resolver behavior, EDNS0 distribution, from two distinct large DNS anycast
operators that provide DNS service to .nl. Another (non-academic) study from
472
G. C. M. Moura et al.
Google Public DNS operators in 2020 [28] showed similar rates of truncation
and fragmentation, but measure on the resolver side.
New Protocols and Features. over the last years there have been several alterna-
tives to “vanilla” DNS, such as DoH (DNS over HTTPS) [18] and DNS over TLS
(DoTLS) [20], and DNS over QUIC [21]. Also, new features are being added to
DNS, such (such as ESNI [42]). While we do not cover them here – our authorita-
tive servers only support traditional DNS – as these new protocols get deployed,
it will be necessary to evaluate how they handle truncation and/or fragmenta-
tion. For example, Google rarely truncate responses for its public DoTLS and
DoH service [15], even if both run on TCP.
6 Conclusions
DNS/UDP large messages that lead to fragmentation have been long feared and
blamed for causing unreachability. Drawing from 164B queries/responses, we
asses state of aﬀairs of large messages on DNS. We show that large responses are
rare (for .nl), and that server-side IP fragmentation is minimal. In case of clients
experience query timeouts on DNS/UDP, we show that 75% of resolvers do fall
back to TCP – and by this way are able to retrieve large responses. Previous
research has shown that “hammering” and server switching – behaviors shown
by resolvers in the wild – are expected to be useful in avoiding unreachability.
Still, our evaluation of more than 3M resolvers show that they still have a
long way to go: many of them announce either small (512 bytes) or large (4096
bytes) EDNS0 buﬀer sizes, both leading to more truncation, and increasing the
chances of fragmentation/packets being lost on the network.
We also show that the initial uptake of the DNS Flag Day 2020 suggested
EDNS0 buﬀer size has not been very wide, however, similar to DNSSEC algo-
rithms adoption, it would be interesting to evaluate this adoption over time,
especially now that major resolver vendors have adopted this value.
Acknowledgments. We thank Klaus Darillion, the anonymous PAM reviewers and
our shepherd, Balakrishnan Chandrasekaran, for feedback and reviewing paper drafts.
This work is partially funded by the European Union’s Horizon 2020 CONCORDIA
project (Grant Agreement # 830927).
A Extra graphs
Fig. 10 shows the truncated queries for NS3 in 2020. Figure 11 shows the time-
series of truncated queries for .nl on July 2019. We see in the same ﬁgures a
close match between UDP truncated queries and TCP ones – however not quite
the same. Figure 11 shows the CDF of DNS/UDP truncated queries for 2019,
per server.
Fragmentation, Truncation, and Timeouts: Are Large DNS
473
Fig. 10. NS3: CDF of DNS/UDP TC responses for .nl: July 2020
A.1 Clients and Large DNS/UDP Responses
We evaluate if DNS messages are being lost along the way from authoritative
servers to clients. To do that, we setup two measurements using RIpe Atlas (∼10k
probes), as shown in Table 5. We conﬁgure each probe to send a query directly
to NS3, the server that returns additional records. As such, probes bypass local
resolvers, so they cannot fallback to TCP: they simply send one UDP query. We
setup two measurements: one that retrieves large DNS/UDP responses (1744
bytes, Large column) and one that retrieves small ones (221 bytes).
In total, we see 8576 probes being active on both measurements – sending
more than 1M queries (512k on the Large, 510k on the Small). For each probe, we
Fig. 11. CDF of DNS/UDP TC answers for .nl: July 2019
474
G. C. M. Moura et al.
Table 5. Atlas measurements for large and small responses. Datasets:[43]
EDNS0 buﬀer
Query
Target
Response Size
Protocol/IP
Active Probes
∩
Queries
∩
OK
timeout
Large
4096
Small
512
ANY NS .nl A ns1.dns.nl
ns3.dns.nl
1744
9323
221
9322
UDP/IPv4
8576
557047
512351
473606
555007
510575
497792
38745(6.9%)
12783 (2.5%)
look then into the number of failed responses (timeout), for the small and large
measurements. We see that 6.9% of queries timeout for the large measurement,
however, 2.5% of them also timeout for short responses.
Next we investigate each probe and compute the percentage of timeout
queries per dataset. We then compute the diﬀerence between the rate of failed
queries for the large and the small datasets. Out of the 8576 probes on both
datasets, 6191 have no error diﬀerence for both large and small queries (72%).
10% in fact have more errors for the small dataset query, and only 17% have
more errors for the longer answers. 325 have 100% of errors for the large datasets,
but no errors for the small datasets. Overall, this measurement show the frag-
mentation is still an issue on the client side –which justiﬁes the ﬂag day.
References
1. 1.1.1: The Internet’s fastest, privacy-ﬁrst DNS resolver, AprIL 2018. https://1.1.
1.1/
2. Abley, J., Gudmundsson, O., Majkowski, M., Hunt, E.: Providing minimal-sized
responses to DNS Queries That Have QTYPE=ANY. RFC 8482, IETF, January
2019
3. Arends, R., Austein, R., Larson, M., Massey, D., Rose, S.: DNS security introduc-
tion and requirements. RFC 4033, IETF, March 2005
4. Bellis, R.: DNS Transport over TCP - implementation requirements. RFC 5966,
IETF, August 2010
5. Bonica, R., Baker, F., Huston, G., Hinden, R., Troan, O., Gont, F.: IP fragmenta-
tion considered fragile. RFC 8900, IETF, September 2020
6. Brandt, M., Dai, T., Klein, A., Shulman, H., Waidner, M.: Domain validation++
For MitM-resilient PKI. In: CCS 2018, New York, NY, USA, pp. 2060–2076. Associ-
ation for Computing Machinery (2018). https://doi.org/10.1145/3243734.3243790
7. Damas, J., Graﬀ, M., Vixie, P.: Extension mechanisms for DNS (EDNS(0)). RFC
6891, IET, April 2013
8. De Boer, M., Bosma, J.: Discovering Path MTU black holes on the Internet using
RIPE Atlas. Master’s thesis, University of Amsterdam (2012). https://nlnetlabs.
nl/downloads/publications/pmtu-black-holes-msc-thesis.pdf
Fragmentation, Truncation, and Timeouts: Are Large DNS
475
9. Deering, S., Hinden, R.: Internet Protocol, Version 6 (IPv6) Speciﬁcation. RFC
2460, IETF, December 1998
10. Dickinson, J., Dickinson, S., Bellis, R., Mankin, A., Wessels, D.: DNS transport
over TCP - implementation requirements. RFC 7766, IETF, March 2016
11. Elvy, M., Nedved, R.: Network mail path service. RFC 915, IETF, December 1984
12. Fujiwara, K., Vixie, P.: Serving stale data to improve DNS resiliency (work in
progress). Internet Draft, April 2020. https://tools.ietf.org/html/draft-fujiwara-
dnsop-avoid-fragmentation-03
13. Gont, F.: Security implications of predictable fragment identiﬁcation values. RFC
7739, IETF, February 2016
14. Gont, F., Linkova, J., Chown, T., Liu, W.: Observations on the dropping of packets
with IPv6 extension headers in the real world. RFC 7872, IETF, June 2016
15. Google: secure transports for DNS: DNS response truncation, January. https://
developers.google.com/speed/public-dns/docs/secure-transports#tls-sni
16. Google: Public DN, January 2020. https://developers.google.com/speed/public-
dns/
17. Herzberg, A., Shulman, H.: Fragmentation considered poisonous, or: one-domain-
to-rule-them-all. In: 2013 IEEE Conference on Communications and Network Secu-
rity (CNS), pp. 224–232. IEEE (2013)
18. Hoﬀman, P., McManus, P.: DNS queries over HTTPS (DoH). RFC 8484, IETF,
October 2018
19. Hoﬀman, P., Sullivan, A., Fujiwara, K.: DNS Terminology. RFC 8499, IETF, Jan-
uary 2019
20. Hu, Z., Zhu, L., Heidemann, J., Mankin, A., Wessels, D., Hoﬀman, P.: Speciﬁcation
for DNS over transport layer security (TLS). RFC 7858, IETF, May 2016
21. Huitema, K., Mankin, A., Dickinson, S.: Speciﬁcation of DNS over dedicated QUIC
connections (work in progress). Internet Draft, October 2020. https://datatracker.
ietf.org/doc/draft-ietf-dprive-dnsoquic/
22. Huston, G.: Dealing with IPv6 fragmentation in the DNS, August 2017. https://
blog.apnic.net/2017/08/22/dealing-ipv6-fragmentation-dns/
23. Internet Assigned Numbers Authority (IANA): Root Files (2020). https://www.
iana.org/domains/root/ﬁles
24. ISC: 4. bind 9 conﬁguration reference (2020). https://bind9.readthedocs.io/en/v9
16 6/reference.html
25. Krishnan, S.: Handling of overlapping IPv6 fragments. RFC 5722, IETF, December
2009
26. Kulkarni, M., Patel, A., Leung, K.: Mobile IPv4 dynamic home agent (HA) assign-
ment. RFC 4433, IETF, March 2006
27. Laurie, B., Sisson, G., Arends, R., Blacka, D.: DNS Security (DNSSEC) Hashed
authenticated denial of existence. RFC 5155, IETF, March 2008
28. Lieuallen, A.: DNS Flag Day 2020 and Google Public DNS, October 2020. https://
www.youtube.com/watch?v=CHprGFJv WE
29. McPherson, D., Oran, D., Thaler, D., Osterweil, E.: Architectural considerations
of IP anycast. RFC 7094, IET, January 2014
30. Miller, I.: Protection against a variant of the tiny fragment attack (RFC 1858).
RFC 3128, IETF, June 2001
31. Mockapetris, P.: Domain names - concepts and facilities. RFC 1034, IETF, Novem-
ber 1987
32. Mockapetris, P.: Domain names - implementation and speciﬁcation. RFC 1035,
IETF, November 1987
476
G. C. M. Moura et al.
33. Moura, G.C.M., Heidemann, J., M¨uller, M., de O. Schmidt, R., Davids, M.: When
the dike breaks: dissecting dns defenses during DDoS. In: Proceedings of the ACM
Internet Measurement Conference, Boston, MA, USA, pp. 8–21, October 2018
34. Moura, G.C.M., Heidemann, J., de O. Schmidt, R., Hardaker, W.: Cache me if
you can: eﬀects of DNS Time-to-Live. In: Proceedings of the ACM Internet Mea-
surement Conference, Amsterdam, The Netherlands, pp. 101–115. ACM, October
2019
35. M¨uller, M., Moura, G.C.M., de O. Schmidt, R., Heidemann, J.: Recursives in the
wild: engineering authoritative DNS servers. In: Proceedings of the ACM Internet
Measurement Conference, London, UK, pp. 489–495. ACM (2017)
36. OpenDNS: setup guide: OpenDNS. https://www.opendns.com/setupguide/, Jan-
uary 2019. https://www.opendns.com/setupguide
37. Partridge, C., Mendez, T., Milliken, W.: Host Anycasting Service. RFC 1546,
IETF, November 1993
38. Postel, J.: Internet control message protocol. RFC 792, IETF, September 1981
39. Postel, J.: Internet Protocol. RFC 791, IETF, September 1981
40. Quad9: Internet security & privacy in a few easy steps. https://quad9.net, January
2021
41. Rekhter, Y., Li, T., Hares, S.: A border gateway protocol 4 (BGP-4). RFC 4271,
IETF, January 2006
42. Rescorla, E., Oku, K., Sullivan, N., Wood, C.: TLS encrypted client hello (work
in progress). Internet Draft, December 2020. https://tools.ietf.org/html/draft-ietf-
tls-esni-09
43. RIPE NCC: RIPE Atlas measurement IDS, October 2020. https://atlas.ripe.net/
measurements/ID. where ID is the experiment ID: large:27759950, small:27760294
44. RIPE NCC: RIPE Atlas Probes, May 2020. https://ftp.ripe.net/ripe/atlas/
probes/archive/2020/05/
45. RIPE Ncc Staﬀ: RIPE atlas: a global internet measurement network. Internet
Protocol Journal (IPJ) 18(3), 2–26 (2015)
46. Root Server Operators: Root DNS, May 2020. http://root-servers.org/
47. SIDN Labs: ENTRADA - DNS big data analytics, January 2020 https://entrada.
sidnlabs.nl/
48. SIDN Labs: nl stats and data (2020). http://stats.sidnlabs.nl. https://stats.
sidnlabs.nl/en/dnssec.html
49. Thomson, S., Huitema, C., Ksinant, V., Souissi, M.: DNS extensions to support
IP version 6. RFC 3596, IETF, October 2003
50. Tomas, H.: IP fragmentation attack on DNS. In: RIPE 67, - Athens, Greece, Octo-
ber 2016. https://ripe67.ripe.net/presentations/240-ipfragattack.pdf
51. Van Den Broek, G., Van Rijswijk-Deij, R., Sperotto, A., Pras, A.: DNSSEC meets
real world: dealing with unreachability caused by fragmentation. IEEE Commun.
Mag. 52(4), 154–160 (2014)
52. Vixie, P.: Extension Mechanisms for DNS (EDNS0). RFC 2671, IETF, August
1999
53. Weaver, N., Kreibich, C., Nechaev, B., Paxson, V.: Implications of Netalyzr’s DNS
measurements. In: Proceedings of the First Workshop on Securing and Trusting
Internet Names (SATIN), Teddington, United Kingdom. Citeseer (2011)
54. Wessels, D.: RSSAC002-data, May 2020. https://github.com/rssac-caucus/
RSSAC002-data/
55. Wijngaards, W.: release-1.12.0: Unbound 1.12.0 (2020). https://github.com/
NLnetLabs/unbound/releases/tag/release-1.12.0
Fragmentation, Truncation, and Timeouts: Are Large DNS
477
56. Wullink, M., Moura, G.C., M¨uller, M., Hesselman, C.: Entrada: A high-
performance network traﬃc data streaming warehouse. In: Network Operations
and Management Symposium (NOMS), 2016 IEEE/IFIP, pp. 913–918. IEEE, April
2016
57. Ziemba, G., Reed, D., Traina, P.: Security considerations for IP fragment ﬁltering.
RFC 1858, IETF, October 1995
58. ˇSpaˇcek, P., Sur´y, O.: DNS ﬂag day 2020, October 2020. https://dnsﬂagday.net/
2020/