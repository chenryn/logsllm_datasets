test ID is configured at the initiating MEP, and the responding MEP uses the test ID it receives from the
initiating MEP. Because ETH-SLM is a sampling technique, it is less precise than counting the service
frames. Also, the accuracy of measurement depends on the number of SLM frames used or the period
for transmitting SLM frames.
Reception of SLMs and Transmission of SLRs
After the destination MEP receives a valid SLM frame from the source MEP, an SLR frame is generated
and transmitted to the requesting or source MEP. The SLR frame is valid if the MEG level and the
destination MAC address match the receiving MEP’s MAC address. All the fields in the SLM PDUs are
copied from the SLM request except for the following fields:
• The source MAC address is copied to the destination MAC address and the source address contains
the MEP’s MAC address.
• The value of the OpCode field is changed from SLM to SLR (54).
• The responder MEP ID is populated with the MEP’s MEP ID.
• TxFCb is saved with the value of the local counter RxFCl at the time of SLR frame transmission.
• An SLR frame is generated every time an SLM frame is received; therefore, RxFCl in the responder is
equal to the number of SLM frames received and also equal to the number of SLR frames sent. At the
responder or receiving MEP, RxFCl equals TxFCl.
223
Reception of SLRs
After an SLM frame (with a given TxFCf value) is transmitted, a MEP expects to receive a corresponding
SLR frame (carrying the same TxTCf value) within the timeout value from its peer MEP. SLR frames that
are received after the timeout value (5 seconds) are discarded. With the information contained in SLR
frames, a MEP determines the frame loss for the specified measurement period. The measurement
period is a time interval during which the number of SLM frames transmitted is statistically adequate to
make a measurement at a given accuracy. A MEP uses the following values to determine near-end and
far-end frame loss during the measurement period:
• Last received SLR frame's TxFCf and TxFCb values and the local counter RxFCl value at the end of
the measurement period. These values are represented as TxFCf[tc], TxFCb[tc], and RxFCl[tc], where
tc is the end time of the measurement period.
• SLR frame's TxFCf and TxFCb values of the first received SLR frame after the test starts and local
counter RxFCl at the beginning of the measurement period. These values are represented as
TxFCf[tp], TxFCb[tp], and RxFCl[tp], where tp is the start time of the measurement period.
For each SLR packet that is received, the local RxFCl counter is incremented at the sending or source
MEP.
Computation of Frame Loss
Synthetic frame loss is calculated at the end of the measurement period on the basis of the value of the
local counters and the information from the last frame received. The last received frames contains the
TxFCf and TxFCb values. The local counter contains the RxFCl value. Using these values, frame loss is
determined using the following formula:
Frame loss (far-end) = TxFCf – TxFCb
Frame loss (near-end) = TxFCb – RxFCl
Release History Table
Release Description
16.1 Starting Junos OS Release 16.1, the Ethernet loss measurement (ETH-LM) results are inaccurate when
connectivity fault management (CFM) and performance monitoring (PM) PDUs received locally at a
maintenance endpoint (MEP) as classified as belonging to the yellow class or a packet loss priority (PLP)
of medium-high.
16.1 Starting with Junos OS Release 16.1, performance monitoring for connectivity fault management (by
including the performance-monitoring statement and its substatements at the [edit protocols oam ethernet
connectivity-fault-management] hierarchy level) is not supported when the network-to-network (NNI) or
egress interface is an aggregated Ethernet interface with member links on DPCs.
224
Configure Ethernet Frame Delay Measurement Sessions
IN THIS SECTION
Guidelines for Configuring Routers to Support an ETH-DM Session | 224
Guidelines for Starting an ETH-DM Session | 226
Guidelines for Managing ETH-DM Statistics and ETH-DM Frame Counts | 228
Configuring Routers to Support an ETH-DM Session | 234
Triggering an Ethernet Frame Delay Measurements Session | 239
Starting an ETH-DM Session | 241
Example: Configuring One-Way Ethernet Frame Delay Measurements with Single-Tagged Interfaces | 244
Example: Configuring Two-Way Ethernet Frame Delay Measurements with Single-Tagged Interfaces | 250
Managing Continuity Measurement Statistics | 256
Viewing Ethernet Frame Delay Measurements Statistics | 258
Managing ETH-DM Statistics and ETH-DM Frame Counts | 259
Use this topic to understand how to configure Ethernet frame delay measurement sessions. You can
start either a one-way Ethernet delay measurement session or a two-way Ethernet delay measurement
session. Also, use this topic to view the delay measurement statistics and frame counts.
Guidelines for Configuring Routers to Support an ETH-DM Session
IN THIS SECTION
Configuration Requirements for ETH-DM | 224
Configuration Options for ETH-DM | 225
Keep the following guidelines in mind when configuring routers to support an Ethernet frame delay
measurement (ETH-DM) session:
Configuration Requirements for ETH-DM
You can obtain ETH-DM information for a link that meets the following requirements:
225
• The measurements can be performed between peer maintenance association endpoints (MEPs) on
two routers.
• The two MEPs must be configured on two Ethernet physical interfaces or on two Ethernet logical
interfaces. For more information, see "Configuring a MEP to Generate and Respond to CFM Protocol
Messages" on page 35.
• The two MEPs must be configured—on their respective routers—under the same maintenance
association (MA) identifier. For more information, see "Creating a Maintenance Association" on page
28.
• On both routers, the MA must be associated with the same maintenance domain (MD) name. For
more information, see "Creating a Maintenance Domain" on page 27.
• On both routers, periodic packet management (PPM) must be running on the Routing Engine and
Packet Forwarding Engine, which is the default configuration. You can disable PPM on the Packet
Forwarding Engine only. However, the Ethernet frame delay measurement feature requires that
distributed PPM remain enabled on the Packet Forwarding Engine of both routers. For more
information about ppm, see the Junos OS Routing Protocols Library for Routing Devices.
• If the PPM process (ppm) is disabled on the Packet Forwarding Engine, you must re-enable it. Re-
enabling distributed ppm entails restarting the ethernet-connectivity-fault-management process, which
causes all connectivity fault management (CFM) sessions to re-establish. For more information about
CFM sessions, see Configuring Ethernet Local Management Interface.
NOTE: The Ethernet frame delay measurement feature is supported only for MEPs configured on
Ethernet physical or logical interfaces on DPCs in MX Series routers. The ETH-DM feature is not
supported on aggregated Ethernet interfaces or LSI pseudowires.
Configuration Options for ETH-DM
By default, the ETH-DM feature calculates frame delays using software-based timestamping of the ETH-
DM PDU frames sent and received by the MEPs in the session. As an option that can increase the
accuracy of ETH-DM calculations when the DPC is loaded with heavy traffic in the receive direction,
you can enable hardware-assisted timestamping of session frames in the receive direction.
SEE ALSO
Ethernet Alarm Indication | 341
Inline Transmission Mode | 356
226
Guidelines for Starting an ETH-DM Session
IN THIS SECTION
ETH-DM Session Prerequisites | 226
ETH-DM Session Parameters | 226
Restrictions for an ETH-DM Session | 227
Keep the following guidelines in mind when preparing to start an Ethernet frame delay measurement
(ETH-DM) session:
ETH-DM Session Prerequisites
Before you can start an ETH-DM session, you must configure two MX Series routers to support ETH-
DM by defining the two CFM-enabled physical or logical Ethernet interfaces on each router. This entails
creating and configuring CFM maintenance domains, maintenance associations, and maintenance
association end points on each router. For more information about enabling CFM on an Ethernet
interface, see "Creating a Maintenance Domain" on page 27.
NOTE: The Ethernet frame delay measurement feature is supported only for maintenance
association end points configured on Ethernet physical or logical interfaces on DPCs in MX
Series routers. The ETH-DM feature is not supported on aggregated Ethernet interfaces or LSI
pseudowires.
For specific information about configuring routers to support ETH-DM, see"Guidelines for Configuring
Routers to Support an ETH-DM Session" on page 224 and "Configuring Routers to Support an ETH-DM
Session" on page 234.
ETH-DM Session Parameters
You can initiate a one-way or two-way ETH-DM session by entering the monitor ethernet delay-measurement
operational command at a router that contains one end of the service for which you want to measure
frame delay. The command options specify the ETH-DM session in terms of the CFM elements:
• The type of ETH-DM measurement (one-way or two-way) to be performed.
• The Ethernet service for which the ETH-DM measurement is to be performed:
227
• CFM maintenance domain—Name of the existing maintenance domain (MD) for which you want
to measure Ethernet frame delays. For more information, see "Creating a Maintenance Domain"
on page 27.
• CFM maintenance association—Name of an existing maintenance association (MA) within the
maintenance domain. For more information, see "Creating a Maintenance Association" on page
28.
• Remote CFM maintenance association end point—The unicast MAC address or the numeric
identifier of the remote maintenance association end point (MEP)—the physical or logical
interface on the remote router that resides in the specified MD and is named in the specified MA
—with which to perform the ETH-DM session. For more information, see "Configuring a MEP to
Generate and Respond to CFM Protocol Messages" on page 35.
• Optional specifications:
• Count—You can specify the number of ETH-DM requests to send for this frame delay
measurement session. The range is from 1 through 65,535 frames. The default value is 10 frames.
NOTE: Although you can trigger frame delay collection for up to 65,535 ETH-DM requests at a
time, a router stores only the last 100 frame delay statistics per CFM session (pair of peer MEPs).
• Frame interval—You can specify the number of seconds to elapse between ETH-DM frame
transmittals. The default value is 1 second.
For more detailed information about the parameters you can specify to start an ETH-DM session, see
the monitor ethernet delay-measurement operational command description in the CLI Explorer.
Restrictions for an ETH-DM Session
The following restrictions apply to an ETH-DM session:
• You cannot run multiple simultaneous ETH-DM sessions with the same remote MEP or MAC
address.
• For a given ETH-DM session, you can collect frame delay information for a maximum of 65,535
frames.
• For a given CFM session (pair of peer MEPs), the ETH-DM database stores a maximum of 100
statistics, with the older statistics being “aged out” as newer statistics are collected for that pair of
MEPs.
• For one-way delay measurements collected within the same CFM session, the 100 most recent
ETH-DM statistics can be retrieved at any point of time at the router on which the receiver MEP
is defined.
228
• For two-way delay measurements collected within the same CFM session, the 100 most recent
ETH-DM statistics can be retrieved at any point of time at the router on which the initiator MEP
is defined.
Depending on the number of frames exchanged in the individual ETH-DM sessions, the ETH-DM
database can contain statistics collected through multiple ETH-DM sessions.
• If graceful Routing Engine switchover (GRES) occurs, any collected ETH-DM statistics are lost, and
ETH-DM frame counts are reset to zeroes. GRES enables a router with dual Routing Engines to
switch from a primary Routing Engine to a backup Routing Engine without interruption to packet
forwarding. For more information, see the Junos OS High Availability User Guide.
• Accuracy of frame delay data is compromised when the system is changing (such as from
reconfiguration). We recommend performing Ethernet frame delay measurements on a stable system.
SEE ALSO
monitor ethernet delay-measurement
Guidelines for Managing ETH-DM Statistics and ETH-DM Frame Counts
IN THIS SECTION
ETH-DM Statistics | 228
ETH-DM Statistics Retrieval | 231
ETH-DM Frame Counts | 231
ETH-DM Frame Count Retrieval | 232
ETH-DM Statistics
Ethernet frame delay statistics are the frame delay and frame delay variation values determined by the
exchange of frames containing ETH-DM protocol data units (PDUs).
• For a one-way ETH-DM session, statistics are collected in an ETH-DM database at the router that
contains the receiver MEP. For a detailed description of one-way Ethernet frame delay measurement,
including the exchange of one-way delay PDU frames, see "Ethernet Frame Delay Measurements
Overview" on page 205.
• For a two-way ETH-DM session, statistics are collected in an ETH-DM database at the router that
contains the initiator MEP. For a detailed description of two-way Ethernet frame delay measurement,
229
including the exchange of two-way delay PDU frames, see "Ethernet Frame Delay Measurements
Overview" on page 205.
A CFM database stores CFM-related statistics and—for Ethernet interfaces that support ETH-DM—the
100 most recently collected ETH-DM statistics for that pair of MEPs. You can view ETH-DM statistics
by using the delay-statistics or mep-statistics form of the show oam ethernet connectivity-fault-management
command to display the CFM statistics for the MEP that collects the ETH-DM statistics you want to
view.
Table 13 on page 229 describes the ETH-DM statistics calculated in an ETH-DM session.
Table 13: ETH-DM Statistics
Field Name Field Description
One-way delay (μsec)† For a one-way ETH-DM session, the frame delay, in microseconds, collected at the
receiver MEP.
To display frame delay statistics for a given one-way ETH-DM session, use the delay-
statistics or mep-statistics form of the show oam ethernet connectivity-fault-management
command at the receiver MEP for that session.
Two-way delay (μsec) For a two-way ETH-DM session, the frame delay, in microseconds, collected at the
initiator MEP.
When you start a two-way frame delay measurement, the CLI output displays each DMR
frame receipt timestamp and corresponding DMM frame delay and delay variation
collected as the session progresses.
To display frame delay statistics for a given two-way ETH-DM session, use the delay-
statistics or mep-statistics form of the show oam ethernet connectivity-fault-management
command at the initiator MEP for that session.
230
Table 13: ETH-DM Statistics (Continued)
Field Name Field Description
Average delay† When you start a two-way frame delay measurement, the CLI output includes a runtime
display of the average two-way frame delay among the statistics collected for the ETH-
DM session only.
When you display ETH-DM statistics using a show command, the Average delay field
displays the average one-way and two- frame delays among all ETH-DM statistics
collected at the CFM session level.
For example, suppose you start two one-way ETH-DM sessions for 50 counts each, one
after the other. If, after both measurement sessions complete, you use a show command
to display 100 ETH-DM statistics for that CFM session, the Average delay field displays
the average frame delay among all 100 statistics.
Average delay variation† When you start a two-way frame delay measurement, the CLI output includes a runtime
display of the average two-way frame delay variation among the statistics collected for
the ETH-DM session only.
When you display ETH-DM statistics using a show command, the Average delay variation
field displays the average one-way and two- frame delay variations among all ETH-DM
statistics collected at the CFM session level.
Best-case delay† When you start a two-way frame delay measurement, the CLI output includes a runtime
display of the lowest two-way frame delay value among the statistics collected for the
ETH-DM session only.
When you display ETH-DM statistics using a show command, the Best case delay field
displays the lowest one-way and two-way frame delays among all ETH-DM statistics
collected at the CFM session level.
Worst-case delay† When you start a two-way frame delay measurement, the CLI output includes a runtime
display of the highest two-way frame delay value among the statistics collected for the
ETH-DM session only.
When you display ETH-DM statistics using a show command, the Worst case delay field
displays the highest one-way and two-way frame delays among all statistics collected at
the CFM session level.
231
Table 13: ETH-DM Statistics (Continued)
Field Name Field Description
†When you start a one-way frame delay measurement, the CLI output displays NA (“not available”) for this field. One-
way ETH-DM statistics are collected at the remote (receiver) MEP. Statistics for a given one-way ETH-DM session
are available only by displaying CFM statistics for the receiver MEP.
ETH-DM Statistics Retrieval
At the receiver MEP for a one-way session, or at the initiator MEP for a two-way session, you can
display all ETH-DM statistics collected at a CFM session level by using the following operational
commands:
• show oam ethernet connectivity-fault-management delay-statistics maintenance-domain md-name maintenance-
association ma-name   
• show oam ethernet connectivity-fault-management mep-statistics maintenance-domain md-name maintenance-
association ma-name   
ETH-DM Frame Counts
The number of ETH-DM PDU frames exchanged in a ETH-DM session are stored in the CFM database
on each router.
Table 14 on page 231 describes the ETH-DM frame counts collected in an ETH-DM session.
Table 14: ETH-DM Frame Counts
Field Name Field Description
1DMs sent Number of one-way delay measurement (1DM) PDU frames sent to the peer MEP in this
session.
Stored in the CFM database of the MEP initiating a one-way frame delay measurement.
Valid 1DMs received Number of valid 1DM frames received.
Stored in the CFM database of the MEP receiving a one-way frame delay measurement.
232
Table 14: ETH-DM Frame Counts (Continued)
Field Name Field Description
Invalid 1DMs received Number of invalid 1DM frames received.
Stored in the CFM database of the MEP receiving a one-way frame delay measurement.
DMMs sent Number of delay measurement message (DMM) PDU frames sent to the peer MEP in
this session.
Stored in the CFM database of the MEP initiating a two-way frame delay measurement.
DMRs sent Number of delay measurement reply (DMR) frames sent (in response to a received
DMM).
Stored in the CFM database of the MEP responding to a two-way frame delay
measurement.
Valid DMRs received Number of valid DMR frames received.
Stored in the CFM database of the MEP initiating a two-way frame delay measurement.
Invalid DMRs received Number of invalid DMR frames received.
Stored in the CFM database of the MEP initiating a two-way frame delay measurement.
ETH-DM Frame Count Retrieval
Each router counts the number of ETH-DM frames sent or received and stores the counts in a CFM
database.
Frame Counts Stored in CFM Databases
You can display ETH-DM frame counts for MEPs assigned to specified Ethernet interfaces or for
specified MEPs in CFM sessions by using the following operational commands:
• show oam ethernet connectivity-fault-management interfaces (detail | extensive)
• show oam ethernet connectivity-fault-management mep-database maintenance-domain md-name maintenance-
association ma-name  
233
One-Way ETH-DM Frame Counts
For a one-way ETH-DM session, delay statistics are collected at the receiver MEP only, but frame
counts are collected at both MEPs. As indicated in Table 14 on page 231, one-way ETH-DM frame
counts are tallied from the perspective of each router in the session:
• At the initiator MEP, the router counts the number of 1DM frames sent.
• At the receiver MEP, the router counts the number of valid 1DM frames received and the number of
invalid 1DM frames received.
You can also view one-way ETH-DM frame counts—for a receiver MEP—by using the show oam ethernet
connectivity-fault-management mep-statistics command to display one-way statistics and frame counts
together.
Two-Way ETH-DM Frame Counts
For a two-way ETH-DM session, delay statistics are collected at the initiator MEP only, but frame
counts are collected at both MEPs. As indicated in Table 14 on page 231, two-way ETH-DM frame
counts are tallied from the perspective of each router in the session:
• At the initiator MEP, the router counts the number of DMM frames sent, valid DMR frames received,
and invalid DMR frames received.
• At the responder MEP, the router counts the number of DMR frames sent.
You can also view two-way ETH-DM frame counts—for an initiator MEP—by using the show oam ethernet
connectivity-fault-management mep-statistics command to display two-way statistics and frame counts
together.
SEE ALSO
clear oam ethernet connectivity-fault-management statistics
show oam ethernet connectivity-fault-management mep-statistics
show oam ethernet connectivity-fault-management delay-statistics
show oam ethernet connectivity-fault-management interfaces
show oam ethernet connectivity-fault-management mep-database
234
Configuring Routers to Support an ETH-DM Session
IN THIS SECTION
Configuring MEP Interfaces | 234
Ensuring That Distributed ppm Is Not Disabled | 235
Enabling the Hardware-Assisted Timestamping Option | 238
Configuring the Server-Side Processing Option | 238
Configuring MEP Interfaces
Before you can start an Ethernet frame delay measurement session across an Ethernet service, you must
configure two MX Series routers to support ETH-DM.
To configure an Ethernet interface on a MX Series router to support ETH-DM:
1. On each router, configure two physical or logical Ethernet interfaces connected by a VLAN. The
following configuration is typical for single-tagged logical interfaces:
[edit interfaces]
interface {
ethernet-interface-name {
vlan-tagging;
unit logical-unit-number {
vlan-id vlan-id; # Both interfaces on this VLAN
}
}
}
Both interfaces will use the same VLAN ID.
2. On each router, attach peer MEPs to the two interfaces. The following configuration is typical:
[edit protocols]
oam {
ethernet {
connectivity-fault-management {
maintenance-domain md-name { # On both routers
level number;
235
maintenance-association ma-name { # On both routers
continuity-check {
interval 100ms;
hold-interval 1;
}
mep mep-id { # Attach to VLAN interface
auto-discovery;
direction (up | down);
interface interface-name;