'
POC!Script!"!h]p://c22.cc/POC/ﬁngerprint.html!
USER_AGENTS!
CAN!BE!
SPOOFED!
BROWSER!
TRAITS!CAN’T'
PROXY!
DETECTION!
#4.2&
! 
Chrome!handles!proxy!conﬁg!diﬀerently!
! 
407!status!code!isn’t!rendered!!
! 
Unless!an!HTTP!proxy!is!set!!
! 
Allows!us!to!detect!if!an!HTTP!proxy!is!set!
! 
Just!not!which!proxy!
! 
Can!only!detect!HTTP!proxies!;(!
Chrome!Proxy!Deteceon!
!  Request!page!from!server!
!  Response!Status:!407!Proxy!Authenecaeon!
!  w/o!Proxy_Authenecate!header!
!  If!Chrome!responds!HTTP!proxy!is!set!
Chrome!Proxy!Deteceon!
!  Privoxy!3.0.20!(CVE_2013_2503)!
!  407!Proxy!Authenecaeon!Required!
!  w/!Proxy_Authenecate!header!
!  User!prompted!for!user/pass!
!  Prompt!appears!to!be!from!Privoxy!
!  Privoxy!passes!user/pass!to!remote!site!
!  Proﬁt???!
Side_Eﬀect:!Owning!Proxies!
!  Not!just!Privoxy!that’s!eﬀected!
! 
Any!transparent!proxy!
! 
e.g.!Burp,!ZAP,!…!
! 
Not!really!a!vuln!for!most!
! 
Works!as!designed!!
Side_Eﬀect:!Owning!Proxies!
#5&
]!
[!
BRINGINGITALL 
TO GETHER 
What!we!have!
!  Status!codes!all!browsers!treat!as!content!
!  Status!codes!all!browsers!can’t!handle!
!  1XX,!etc..!
!  Lots!of!browser!quirks!
What!can!we!do!
!  F*ck!with!things!
!  Screw!with!scanner!monkeys!
!  Make!RFC!lovers!cry!into!their!beer!
!  Break!things!in!general!
Let’s!try!to…!
!  Use!what!we’ve!discovered!to…!
!  Break!spidering!tools!
!  Cause!false!posieves!/!negaeves!
!  Slow!down!a]ackers!
!  The!fun!way!!
!  Blocking!successful!exploitaeon!
BREAKING!
SPIDERS!
#5.1&
Simplisec!view!
of!spiders!
!  Access!target!URL!
!  Read!links!/!funceons!
!  Test!them!out!
!  If!true:!conenue!
!  What!is!TRUE?!
!  What!happens!if:!
!  Every!response!is!
!  200!OK!
!  404!Not!Found!
!  500!Internal!Server!Error!
200!OK!
!  IF!200!==!True:!
!  Problems!!
!  Never_ending!spider!
404!Not!Found!
!  IF!404!==!False:!
!  What!website?!
500!Internal!Server!Error!
!  Skipﬁsh!!=!happy!ﬁsh!
False!
Posieves!/
Negaeves!
#5.2&
!  Most!scanners!use!status!codes!
!  At!least!to!some!extent!
!  Inieal!match!(prior!to!more!costly!regex)!
!  Speed!up!deteceon!
!  Easy!solueon!
!  What!happens!if:!
!  Every!response!is!
!  200!OK!
!  404!Not!Found!
!  500!Internal!Server!Error!
!  raNd0M*!
*!Using!codes!that!are!accepted!by!all!browsers!as!content!!
Vulnerability!Baseline!
!  w3af!
!  Informaeon!Points!"!79!
!  Vulnerabiliees!"!65!
!  Shells!"!0!shells!#!
!  Scan!eme!"!1h37m23s!
Every!response!200!OK!
!  No!change!in!discoveries!
!  All!points!discovered!_!per!baseline!
!  79!Informaeon!Points!
!  65!Vulnerabiliees!
!  0!Shells!
!  Scan!eme!"!9h56m55s!
!  Lots!more!to!check!;)!
Every!response!404!Not!Found!
!  Less!to!scan!==!Less!to!ﬁnd!
!  False!negaeves!
!  44!Informaeon!Points!(_35)!
!  37!Vulnerabiliees!(_28)!!
!  Scan!eme!"!7m13s!
!  Much!quicker!scan!
!  Less!paths!traversed!
Every!response!500!
!  Server!Error!==!OMG!VULN!SANDWICH!&
!  False!posieves+++&
!  9540!Informaeon!points!(+9461)!
!  9526!Vulnerabiliees!(+9461)!!
Random!Status!Codes!
!  Muleple!test!runs!
!  All!tests!produced!False!posieves++&
!  avg.!619!Informaeon!points!(+540)!
!  avg.!550!Vulnerabiliees!(+485)!!
!  Avg.!scan!eme!"!11m37s!
!  Ooen!much!quicker!scans!
!  Lots!of!variaeon!in!scan!emes!
Random!Status!Codes!
!  Skipﬁsh!+!$random_status!=!chaos!
!  False!Posieves!+!False!Negaeves!
!  Scan!jobs!killed!(due!to!lack!of!scanner!resources)!
!  Scan!emes!
!  1st!scan!eme!"!10h3m35s!
!  2nd!scan!eme!"!0h0m4s!
!  3rd!scan!eme!"!16h47m41s!
Slowing!
a]ackers!
down!!
#5.3&
What!does!
your!WAF!
really!do?!
! 
OMG!A]ack!
! 
Block!/!Return!error!
! 
403,!500,!…!
! 
Proﬁt???!
Why?!
Remember!that!list!
of!status!codes!
browsers!don’t!
handle!well?!
Yeah!well,!scanners!
don’t!usually!handle!
them!well!either!!
Especially!the!
1XX!codes!
!  Remember!LaBrea!tarpit?!
! 
Tim!Liston!2001!*!
! 
Designed!to!slow!spread!of!Code!Red!
! 
Slows!down!scans!/!a]ackers!
*!h]p://labrea.sourceforge.net!
How!about!an!
HTTP!Tarpit!!
HTTP!Tarpit!Scenario!
!  WAF!detects!scan!/!a]ack!
!  Adds!source!IP!to!“naughty”!list!
!  Rewrite!all!responses!from!the!server!
! 
100|101|102!status!codes!only!(random)!
! 
204|304!might!also!be!useful!(no!content)!
Let’s!do!
some!
science!*!
*!Science!not!included!
vs.!the!HTTP!TARPIT!
NIKTO!
Baseline&
HTTP&Tarpit&
Scan!eme!
2m!18s!
Findings!
18!
14h!33m!2s!
10!
vs.!the!HTTP!TARPIT!
W3AF!
Baseline&
HTTP&Tarpit&
Scan!eme!
1h!37m!23s!
Findings!
65!
18m!10s!
0!
vs.!the!HTTP!TARPIT!
SKIPFISH!
Baseline&
HTTP&Tarpit&
Scan!eme!
18m!10s!
Findings!
Low:!2519!
Med:!2522!
High:!12!
Low:!
Med:!!
High:!
05s!
0!
0!
3!
vs.!the!HTTP!TARPIT!
ACUNETIX!
Baseline&
HTTP&Tarpit&
Scan!eme!
1h!19m!
Findings!
Info:!1104!
Low:!30!
Med:!32!
High:!24!
Info:!
Low:!
Med:!!
High:!
33m!
3!
3!
1!
0!
HTTP!Tarpit!Results!
!  HTTP!Tarpit!Results!*!
! 
Slow!down!scans!
! 
Nikto:!340x!as!long!
! 
Others!give!up!quicker!;)!
! 
Unreliable!/!aborted!scans!
! 
Up!to!100%!less!ﬁndings!
*!Not!scieneﬁcally!sound!;)!
Blocking!
successful!
exploitae0n!
#5.4&
We’ve!made!it!
hard!to!ﬁnd!the!
vulnerabiliees!
We’ve!made!it!
Ome'consuming!
for!a]ackers!
Now!let’s!stop!the!
sk1dd13s!using!
Metasploit!to!pop!
$hells!
Q:!How!ooen!does!Metasploit!reference!
status!codes?!
)
)rgrep)2E)'res[p|ponse]?\.code')*)
"!958!*!
*!Not!scieneﬁcally!sound!;)!
rgrep)2E)'res[p|ponse]?\.code')*)
Lots!of!
dependency!on!
status!codes*!
*!yep,!even!the!stuﬀ!I!wrote!
)
)if)(res.code)=)300))
)
)
)case)res.code)
)
)
)when)401)
)
)
)
)print_warning("Warning:)The)web)site)
)
)
)
)asked)for)authentication:)#{res.headers)
)
)
)
)['WWW2Authenticate'])||)res.headers ))
)
)
)
)['Authentication']}"))
)
)
)end)
)
)
)fail_with(Exploit::Failure::Unknown,)
)
)
)"Upload)failed)on)#{path_tmp})
)
)
)[#{res.code})#{res.message}]"))
)
)end)
No!match,!
No!shell*'
*!exploit!dependent!
#6&
]!
[!RE VIEW 
!  Using!status!codes!to!our!beneﬁt!is!fun!
! 
…!and!useful!!
!  Browsers!can!be!quirky!
!  Scanners!/!a]ack!toolkits!are!someemes!
set!in!their!ways!
! 
Take!the!easy!route!
! 
Easy!to!fool!
!  WAFs!need!to!get!more!oﬀensive!about!
their!defense!
! 
More!than!just!blocking!a!request!
! 
Even!if!you!use!a!snazzy!message!
! 
Hacking!back!is!bad!
! 
Slowing!down!known!a]acks!is!good!
! 
Make!life!harder!for!skiddies!is!pricele$$!
!  Current!tools!are!much!the!same!as!APT!
! 
APT!(Adequate!Persistent!Threat)!
! 
Only!as!advanced!as!they!NEED!to!be!
…because!screwing!
with!sk1dd13s!
is!fun!!
Implementaeon!
#6.1&
!  PHP!(the!lowest!common!denominator)!
! 
auto_prepend_ﬁle!
! 
Limited!to!resources!PHP!handles!
!  MITMdump!
! 
MITMproxy!==!memory!hog!
! 
Reverse!proxy!mode!
Ghe]o!Implementaeon!
!  Usable!implementaeon!
! 
Nginx!as!reverse!proxy!
! 
Requires:!ngx_lua!
! 
ngx.status!=!XXX!
! 
Bugs!in!non_git!version!
! 
203,!305,!306,!414,!505,!506!return!nil'
h]ps://github.com/ChrisJohnRiley/Random_Code/blob/master/nginx/nginx.conf!
!
!  Ease!adopeon!
!  Implement!into!mod_security!
! 
Not!a!simple!task!
! 
Already!been!discussed!many!emes!
! 
Help!wanted!;)!
Countering!
this!research!
#6.2&
!  Less!reliance!on!status!codes!
!  More!reliance!on!content!/!headers!
!  Pros !!
! 
Be]er!matching!/!intelligence!
!  Cons!
! 
Slower?!(regex!matching)!
! 
More!resource!intensive!
Queseons?!
!
CODE!/!SCRIPTS!AVAILABLE!
!
HTTP://GITHUB.COM/CHRISJOHNRILEY/RANDOM_CODE!
Thanks!for!coming!
!
h]p://blog.c22.cc!
@ChrisJohnRiley!!!!PI:EMAIL!