Number 
analysis
Chaff using 
random keys
Chaff Insertion Approaches
Naive
Inject random 
frames
Sophisticated
Poof!
Aircrack-ng 
Default
Weak IV frames 
of fixed size
Frame Size 
Filter
Chaff using 
single  key
Aircrack-ng 
Visual 
Inspection
Chaff using 
multiple keys
Sequence 
Number 
analysis
Chaff using 
random keys
Initialization 
Vector 
analysis
WEP IV vs Time Graph
 Example Illustrating WEP IV Filter Implementation (using a 
subset of packets from the trace) 
 Note the distinct pattern in IV progression for different 
devices
 Legacy devices which WEP Chaffing desires to protect have 
Sequential IVs
 IV pattern can thus be used as a filter
IV Filter
1
10
100
1000
10000
100000
1000000
10000000
100000000
0
200
400
600
800
1000
1200
Packet Number
WEP IV (Logarithmic 
Scale)
Legitimate-IV
Chaffer-IV
Just a few hours before we submitted this presentation, we came across Joshua Wright’s blog in 
which he countered WEP Cloaking advocating the same technique (sequence number + IV based 
filtering).  This submission will demonstrate the tool whose development Joshua predicted. 
http://edge.arubanetworks.com/blog/2007/04/airdefense-perpetuates-flawed-protocols
Few lines of pseudo-code illustrating IV 
filter!
For all packets of a given device in the trace:
Prev_wep_iv = First WEP IV seen for device;
If (current_wep_iv – prev_wep_iv < threshold)
{
prev_wep_iv = current_wep_iv;
consider packet for key cracking
} else {
Discard packet
}
Sequence Number and IV based 
Chaff filtering
(Demo)
Separating Chaff using Sequence No and IV 
:  Analysis of this technique
 Strengths
 Works with all 3 kinds of chaff discussed – chaffer 
with single key, multiple keys and random keys
 Passive, off-line method
 Combination of sequence number and IV analyses 
creates a very robust filter
 An independent chaff separator can be built
 Weakness
 Reduced filtering efficiency when IVs are generated 
randomly. (The good news is that most legacy WEP 
devices for which WEP Chaffing is recommended 
don’t seem to use random IVs)
Chaff Insertion Approaches
Naive
Inject random 
frames
Sophisticated
Pants ☺
Aircrack-ng 
Default
Weak IV frames 
of fixed size
Frame Size 
Filter
Chaff using 
single  key
Aircrack-ng 
Visual 
Inspection
Chaff using 
multiple keys
Sequence 
Number 
analysis
Chaff using 
random keys
Initialization 
Vector 
analysis
Frames indistinguishable 
from AP Seq# & IV sequence
Chaff Insertion Approaches
Naive
Inject random 
frames
Sophisticated
Down they 
come!
Aircrack-ng 
Default
Weak IV frames 
of fixed size
Frame Size 
Filter
Chaff using 
single  key
Aircrack-ng 
Visual 
Inspection
Chaff using 
multiple keys
Sequence 
Number 
analysis
Chaff using 
random keys
Initialization 
Vector 
analysis
Frames indistinguishable 
from AP Seq# & IV sequence
Active Frame 
replay
Chaff Separation using Active Frame Replay
Basic Idea
WEP has no replay protection
Header of WEP frames can be modified
Upon receiving a correctly encrypted WEP frame, the receiver will 
forward the frame as directed by its header
Upon receiving an incorrectly encrypted WEP frame, the receiver will 
drop the packet
Idea inspired from chopchop tool by Korek.
Building a practical Frame Re-player
Pick a frame whose authenticity is to be verified
Change destination address to ff:ff:ff:ff:ff:ff or a chosen Multicast 
address and transmit
 If the AP relays the broadcast frame – the frame is authentic
 If AP drops the frame – it is a chaff frame
Replay packets can be identified by looking at the transmitter address 
(addr3) of packets transmitted by AP
Optionally, a signature can be added to identify the replay packets (e.g., 
specific multicast as destination)
The packet size is another parameter which can be used to identify the 
replayed packet
100% chaff separation is possible
Chaff Separating using Active Frame Replay 
Successful Key Cracking
 The corrupted trace was filtered using Active replay 
technique and a new filtered trace was created.
 Aircrack-ng is able to crack the filtered trace after the 
application of packet replay filter
Separating Chaff using Active Frame Replay
 Strengths
Get a bonus packet for every packet we send
Works with all 3 kinds of chaff discussed – chaffer with 
single key, multiple keys and random keys
 100% accurate chaff separation
 Oblivious to the sequence number or IV progression 
of a device
 Can be done in real-time
 Frame replay tools already available in public domain
 Weakness
 WEP cracker cannot be totally passive; Active frame 
injection required
 This has to be done “online” and at least one client 
needs to be associated with the network, whose 
source MAC we can forge and use for packet replays
Chaff Insertion Approaches
Naive
Inject random 
frames
Sophisticated
Shirt
Aircrack-ng 
Default
Weak IV frames 
of fixed size
Frame Size 
Filter
Chaff using 
single  key
Aircrack-ng 
Visual 
Inspection
Chaff using 
multiple keys
Sequence 
Number 
analysis
Chaff using 
random keys
Initialization 
Vector 
analysis
Frames indistinguishable 
from AP Seq# & IV sequence
Active Frame 
replay
Using Super 
secret magic
Chaff Insertion Approaches
Naive
Inject random 
frames
Sophisticated
Ooops!
Aircrack-ng 
Default
Weak IV frames 
of fixed size
Frame Size 
Filter
Chaff using 
single  key
Aircrack-ng 
Visual 
Inspection
Chaff using 
multiple keys
Sequence 
Number 
analysis
Chaff using 
random keys
Initialization 
Vector 
analysis
Frames indistinguishable 
from AP Seq# & IV sequence
Active Frame 
replay
Using Super 
secret magic
Replay & 
Fingerprinting 
Chaff
Replay & Fingerprinting Chaff
 Implementation of chaffing dictates that there will be an 
identifiable fingerprint in the Chaff
 This is because the WIPS needs to identify its own Chaff 
packets from the real network data
 Finding a usable fingerprint is a one time job
 Check packet header fields for any abnormality 
 Packet is fixed length?
 Something appended, pre-pended to the packet?
 …many more possibilities
 Once found, simply write a filter to weed out all the 
Chaff, then release the fingerprint to the community 
Chaff Insertion Approaches
Naive
Inject random 
frames
Sophisticated
Anyone for a 
Full Monty??
Aircrack-ng 
Default
Weak IV frames 
of fixed size
Frame Size 
Filter
Chaff using 
single  key
Aircrack-ng 
Visual 
Inspection
Chaff using 
multiple keys
Sequence 
Number 
analysis
Chaff using 
random keys
Initialization 
Vector 
analysis
Frames indistinguishable 
from AP Seq# & IV sequence
Active Frame 
replay
Using Super 
secret magic
Replay & 
Fingerprinting 
Chaff
Overlapping Countermeasures
Aircrack-ng 
Default
Frame Size 
Filter
Aircrack-ng 
Visual 
Inspection
Sequence 
Number 
Analysis
IV 
Analysis
Active 
Frame 
Replay
Finger- 
printing 
Chaff
Random 
Frames
Weak IV 
frames of 
fixed size
Chaff using 
single key
Chaff using 
multiple 
keys
Chaff using 
random 
keys
Indistinguish- 
able Seq# 
and IV in AP
Super Secret 
Magic potion
Counter
Types of 
Chaff
Talk Outline
 Evolution of WEP Cracking
 What is WEP Chaffing? What are Chaff packets?
 WEP Chaffing example
 Techniques to counter different types of Chaff:
 Random frames
 Single key
 Multiple keys 
 Random keys
 …
 Implementation problems with WEP Chaffing
 Final verdict on WEP Chaffing
 Q&A 
Implementation problems with Chaffing
Now, we mention several implementation issues which 
indicate that it may be highly impractical to have a scalable 
Chaffing solution : 
 Passive key cracking tools cannot be detected
 Chaffing needs to be done 24x7x365 
Chaffing needs to be done on all channels on which WEP 
devices operate.
 Imagine the load on the WIPS and the bandwidth 
wasted.
Chaffing needs to be done for all APs and Clients 
connected to the authorized network.
 Achieving a reliable confusion for the attacker 
requires continual generation of chaff frames
 Difficult (almost impossible) to achieve the above unless 
dedicated devices are installed for Chaffing on each channel
Implementation issues …
 Chaffer has to spend significantly high resources to win 
all the time. If chaffing stops even for a brief period, the 
attacker might crack the key.
 Chaffer has to win always, Attacker has to win 
only once.
 Increasing sophistication of attack on Chaffing is 
possible; attacker can go off-line; take a lot of time, try 
a gamut of techniques and possibilities to break the key
 Increasing sophistication of chaffing is more difficult; it 
has be done continuously, as newer countermeasures 
are discovered
Talk Outline
 Evolution of WEP Cracking
 What is WEP Chaffing? What are Chaff packets?
 WEP Chaffing example
 Techniques to counter different types of Chaff:
 Random frames
 Single key
 Multiple keys 
 Random keys
 …
 Implementation problems with WEP Chaffing
 Final verdict on WEP Chaffing
 Q&A 
Final Verdict …
Even if Chaff 
frames were 
made 
indistinguishable 
by an oracle, 
WEP can still be 
cracked.
WEP has so 
many other 
vulnerabilities 
which can be 
easily exploited!
128-bit key
Suppress weak IV generation
ARP filtering
WEP Chaff frame insertion
Final Verdict: WEP Chaffing was indeed too 
good to be true …
 WEP Chaffing can at best slow down a Cracker by a couple of 
minutes but cannot stop him from breaking the key.
 Though our talk only includes Aircrack-ng, the chaff 
separation  techniques we have outlined can be easily added 
to the functionality of any WEP cracking tool, without much 
additional work
 Chaffing is another attempt of providing security through 
obscurity
 Chaffing cannot provide a robust protection against WEP key 
cracking. WEP was broken …. it is broken ….it will 
remain broken.  PERIOD .
Open Challenge!!
If you believe you have a WEP Chaffing implementation 
which works very differently and is unbeatable, then we 
request you send it to us and we will break it within 72 
hours
Demo Setup: 
We will provide you an AP and clients – you can bring 
the WEP Chaffer to protect them 
Client
Client
AP
Chaffer
Talk Outline
 Evolution of WEP Cracking
 What is WEP Chaffing? What are Chaff packets?
 WEP Chaffing example
 Techniques to counter different types of Chaff:
 Random frames
 Single key
 Multiple keys 
 Random keys
 …
 Implementation problems with WEP Chaffing
 Final verdict on WEP Chaffing
 Q&A 
Questions?
References (1)
 Vendor aims to ‘cloak’ WEP 
http://www.networkworld.com/news/2007/032907-air-
defense-wep-wireless-devices.html?page=1
 The TJX breach using Wireless
http://www.emailthis.clickability.com/et/emailThis?clickMap=v
iewThis&etMailToID=2131419424
 RC4 stream Cipher basics
http://en.wikipedia.org/wiki/RC4
 Wired Equivalent Privacy (WEP)
http://en.wikipedia.org/wiki/Wired_Equivalent_Privacy
 Weaknesses in the Key Scheduling Algorithm of RC4, Selected 
Areas in Cryptography, 2001 - Fluhrer, Mantin and Shamir
http://www.wisdom.weizmann.ac.il/~itsik/RC4/Papers/Rc4_ks
a.ps
 Korek’s post on Netstumbler
http://www.netstumbler.org/showpost.php?p=89036
 WEP Dead Again: Part 1 – Infocus, Securityfocus.com
http://www.securityfocus.com/infocus/1814
 WEP Dead Again: Part 2 – Infocus, Securityfocus.com
http://www.securityfocus.com/infocus/1824
References (2)
Aircrack-ng : WEP Cracker
http://www.aircrack-ng.org/
Airsnort : WEP Cracker
http://airsnort.shmoo.com/
Pcap2air : Packet replay tool
http://www.802.11mercenary.net/pcap2air/
Chop-Chop : Packet decoder using WEP ICV flaw
http://www.netstumbler.org/showthread.php?t=12489
Intercepting Mobile Communications: The Insecurity of 802.11 –
N.Borisov
http://www.isaac.cs.berkeley.edu/isaac/mobicom.pdf
Your 802.11 Wireless Network has No Clothes – William Arbaugh
http://www.cs.umd.edu/~waa/wireless.pdf
Detecting Detectors: Layer 2 Wireless Intrusion Analysis – Joshua 
Wright
http://home.jwu.edu/jwright/papers/l2-wlan-ids.pdf
Detecting WLAN MAC address spoofing – Joshua Wright
http://home.jwu.edu/jwright/papers/wlan-mac-spoof.pdf
WPA/WPA2 the replacement for WEP
http://en.wikipedia.org/wiki/WPA2
AirDefense Perpetuates Flawed Protocols – Joshua Wright
http://edge.arubanetworks.com/blog/2007/04/airdefense-
perpetuates-flawed-protocols