我们在m a i n . s h t m l文挡中创建一个指向相应c g i脚本的链接，该脚本能够显示这些变量。
下面是我们使用的链接：
Environment
其中A HREF是链接标记的头。相应的地址包含在双引号中。单词 E n v i r o n m e n t是要显示
出来的单词，用户将点击这里。是链接标记的尾。
下面就是m a i n . s h t m l文挡：
下面是被调用的脚本 p r i n t e n v. c g i，它使用e n v命令显示环境变量。在这里，我们使用
标记来保持该命令输出中的空格和跳格不变。
加入java编程群：524621833
333
第29章 cgi 脚 本
下载
图2 9 - 5显示了该页面。
图29-5 含有显示环境变量链接的页面
图29-6 显示当前环境变量的页面
加入java编程群：524621833
334
第五部分 高级s h e l l编程技巧
下载
当你点击该链接时，将会显示出当前的环境设置 (见图2 9 - 6 )。你在自己机器上所看到的可
能与此有所不同。在运行不同的脚本时，一些相应的环境变量值将会随之改变。
29.4.6 其他常用的环境变量
表2 9 - 2列出了最常用的c g i环境变量。其中有些变量可以用e n v或s e t命令显示出来。
表29-2 常用的cgi We b服务器变量
DOCUMENT ROOT We b服务器的主目录，是放置H T M L文挡的地方
G AT E WAY _ I N T E R FA C E c g i的版本
H T T P _ A C C E P T 可接受的各种M I M E类型
H T T P _ C O N N E C T I O N 缺省的H T T P连接
H T T P _ H O S T 本地主机名
H T T P _ U S E R _ A G E N T 客户端浏览器
R E M O T E _ H O S T 远程主机
R E M O T E _ A D D R * 远程主机的I P地址
R E Q U E S T _ M E T H O D 传递信息的方法
S C R I P T _ F I L E N A M E c g i脚本的绝对路径
S C R I P T _ N A M E c g i脚本的相对路径
S E RV E R _ A D M I N We b服务器管理员的邮件地址
S E RV E R _ N A M E 服务器的主机名、D N S或I P地址
S E RV E R _ P R O TO C O L 连接所使用的协议
S E RV E R _ S O F T WA R E We b服务器软件名
Q U E RY _ S T R I N G g e t方法所传递的数据
C O N T E N T _ T Y P E M I M E类型
C O N T E N T _ L E N G T H p o s t方法所传递的字节数
*严格来讲，这是你连接至I n t e r n e t的网关地址。
为了显示这些变量，可以把它们放在一个 c g i脚本中，这样，在需要使用某个变量值时随
时都可以调用该脚本。
加入java编程群：524621833
335
第29章 cgi 脚 本
下载
29.5 get和post方法简介
到现在为止，我们只是向屏幕上输出。要想从用户那里得到信息，我们需要使用表单，
这也是c g i为什么如此流行的原因。你需要有获得用户输入的能力。有了表单就可以显示文本
框、下拉式列表框和单选框。
在用户通过键入或选择向表单输入了一些信息之后，他可以点击发送按钮将这些信息发
送给某个脚本，在这里是c g i脚本。我们需要使用g e t或p o s t方法来收集这样的信息。
29.5.1 get方法
任何表单的缺省操作都是g e t方法。g e t方法是从静态H T M L页面获取文件的方法。
当用户点击“提交”按钮时，用户选择的信息将以编码字符串的形式附加在服务器 U R L
的后面。服务器环境变量Q U E RY _ S T R I N G保存了编码字符串。变量R E Q U E S T _ M E T H O D保
存了该表单所使用的方法。
1. 创建一个简单的表单
现在让我们来创建一个简单的表单，在m a i n . s h t m l文挡中创建一个指向b o o k a . c g i脚本的链
接。
在m a i n . s h t m l文挡中上一次创建的链接后面增加这样一行：
现在就按照下面的内容创建b o o k a . c g i文件，不要忘记把它放在c g i - b i n目录中。
加入java编程群：524621833
336
第五部分 高级s h e l l编程技巧
下载
我们在上述表单的操作项中设定：一旦用户按下“发送”按钮，脚本 b o o k a _ r e s u l l t . c g i将
被执行。我们现在讨论g e t方法。
上面的表单将会显示两个文本框、两个下拉式列表框和一个复选框。
输入姓名的文本框宽度为3 0个字符，相应的输入被赋给变量c o n t a c t。
第一个下拉式列表框让用户选择最喜爱的电影，选择项被赋给变量 f i l m。
第二个下拉式列表框让用户选择最喜爱的演员，选择项被赋给变量 a c t o r。
用户可以通过点击选择某一个复选框或两个都选。相应的逻辑值分别保存在变量
v i e w _ c i n e和变量v i e w _ v i d中。如果用户选择某一个复选框，那么相应的变量的值为 o n。
区域型文本框允许用户输入超过一行的文本，而不是像标准文本框那样只能输入一行 (在
本例中是4行，每行宽3 0个字符)，所有的输入都将赋给变量t e x t a r e a。
发送数据时需要使用s u b m i t作为输入类型。用户可以点击c l e a r按钮清除当前的表单。
创建如下的c g i脚本，命名为b o o k a _ r e s u l t . c g i并将其保存在c g i - b i n目录下。
上面的脚本显示了变量Q U E RY _ S T R I N G和R E Q U E S T _ M E T H O D。变量Q U E RY _ S T R I N G保
加入java编程群：524621833
337
第29章 cgi 脚 本
下载
存了由脚本b o o k a . c g i创建的表单中编码字符串格式的所有输入数据。变量R E Q U E S T _ M E T H O D
中保存了所使用的方法，这里是get。图29-7显示了该表单。
现在我们在该表单中输入一些信息并发送(见图2 9 - 8 )。点击“发送”按钮就会看到图2 9 - 9所
示的页面。由于字符串太长，变量QU E R Y_ S T R I N G 只能显示出一部分。下面是该字符串的全部。
图29-7 使用get方法的cgi表单
图29-8 在表单中选择并键入信息
加入java编程群：524621833
338
第五部分 高级s h e l l编程技巧
下载
图29-9 该表单所发送的信息被回显出来
从我们所发送的信息可以知道，Q U E RY _ S T R I N G变量中应包含下列信息：
变 量 值
c o n t a c t David Ta n s l e y
f i l m The Sound Of Music
a c t o r Bruce Wi l l i s
v i e w _ c i n e 选中，则该值为‘o n’
v i e w _ v i d 选中，则该值为‘o n’
t e x t a r e a ! "比% $ % ^ * ^ & * ( ) * ( ) ( *
H o w ’s that!!
2. 对编码字符串解码
当用户点击提交按钮时，相应的信息被赋给了变量 Q U E RY _ S T R I N G，这些信息是以下面
的格式编码的：
所有的空格用+来替代。
所有的值域用&隔开。
所有的值和相应域用=隔开。
所有的符号和一些特殊字符用%x y的形式表示，其中x y是该字符的1 6进制A S C I I码。看一
下Q U E RY _ S T R I N G变量就知道，在t e x t a r e a变量中含有很多这样的字符。
c g i协议声明，所有采用%x y形式表示的特殊字符(其中x y为1 6进制数)都被转换为对应的
A S C I I字符。这种1 6进制字符包括特殊字符&、%、+、=、(、)及所有A S C I I码超过1 2 7的其他
特殊字符。例如字符“(”应为%2 9。
这种1 6进制字符产生于文本框，用户可能会在这些地方输入这样的字符。不过，它们也
可以出现在下拉式列表框中。
加入java编程群：524621833
339
第29章 cgi 脚 本
下载
为了解码相应字符串，我们应当：
将所有的&替换为换行。
将所有的+替换为空格。
将所有的=替换为空格。
将所有的%x y替换对应的A S C I I字符。
在完成上述转换之后，我们可能需要访问某个变量，这样就可以根据用户发送的信息来
进行某些处理。解码只是所有工作的一部分，尽管这是最繁重的一部分。如果想访问这些变
量，可以使用e v a l命令。
下面的脚本将会完成所有必要的转换并能够访问每一个变量。该脚本的注释丰富，应该
能够理解。
你可能已经注意到，这里使用 p r i n t f命令来回显所有的变量—这是因为使用它更简单。
加入java编程群：524621833
340
第五部分 高级s h e l l编程技巧
下载
p r i n t f命令和e c h o命令的功能相似，但它可以完成所有 1 6进制字符的转换。需要注意的是，在
使用p r i n t f命令时，它不会自动换行，必须要在每一行的末尾使用 \ n来换行。Q U E RY _ S T R I N G
变量中的1 6进制字符是以%x y的形式来表示的，我们只要使用s e d把它们转换成\ x n n的格式(其
中n n为1 6进制数)，p r i n t f命令就可以自动完成相应的转换。有简单的办法我们何必要使用复杂
的呢？
把上面的脚本存为c o n v. c g i，并放在c g i - b i n目录下。现在我们只要对脚本b o o k a . c g i做小小
的改动，就能够在表单提交时执行脚本 c o n v. c g i而不是b o o k a _ r e s u l t . c g i。下面是做改动的一
行：
现在如果我们重新提交该表单，它将执行脚本 c o n v. c g i，我们将会得到如图2 9 - 1 0所示的
结果。
图29-10 完全解码的表单输入数据
现在我们把该字符串转换成为一种更可读的形式，这样我们可以对其做进一步的处理。
在使用表单时，g e t方法是缺省的方法。根据所处的环境，使用g e t方法有两个潜在的问题。
在发送信息时，整个编码字符串都附加在服务器 U R L的后面，这样所发送的信息可以从 U R L
框中看到。可能你会认为这没什么大不了的，如果你是通过网络发送公司或个人的信息，这
就是一个值得注意的问题了。
如果表单具有很多的输入域，那么Q U E RY _ S T R I N G变量将会变得很长。大多数人在使用
c g i时都用p o s t作为表单输入的方法。在下一小节中，我们将对p o s t方法进行介绍。
29.5.2 post方法
p o s t方法的字符串编码方式与g e t方法相同。它们所不同的是获取数据的方法， p o s t方法是
加入java编程群：524621833
341
第29章 cgi 脚 本
下载
从标准输入读入的。如果想用p o s t方法来发送数据，只要把表单操作语句中的g e t替换为p o s t即
可。
变量C O N T E N T _ L E N G T H中含有使用p o s t方法发送的总字节数。我们从标准输入读入该
字符串，然后进行与g e t方法一样的转换。在输入的字节数等于变量 C O N T E N T _ L E N G T H的值
时，将会停止读入。
只需要改动表单处理脚本中的相应语句就可以产生一个通用的解码脚本。为了从标准输
入中读入，可以使用c a t命令。下面是需要在c o n v. c g i脚本中增加的语句，这样它就既可以适用
于g e t方法，也可以适用于p o s t方法。
注意c a t命令后面的横杠-，它允许c a t命令从标准输入中读入。
我们只测试Q U E RY _ S T R I N G变量—如果使用p o s t方法，那么就用c a t命令把所有来自于
标准输入的字符串赋给该变量。如果使用 g e t方法，就无须做这样的操作，只需从该变量中读
取信息即可。
将c g i脚本b o o k a . c g i中的表单操作一行由
改为：
我们还将在c o n v. c g i脚本中做一些其他修改，这样就可以测试文本框和复选框中输入的值。
下面是修改后的脚本。
加入java编程群：524621833
342
第五部分 高级s h e l l编程技巧
下载
注意，我使用了很多p r i n t f命令，在不需要置换字符串变量时，本可以使用 e c h o命令，但
为了统一起见，我一律都使用了p r i n t f命令。