=== 关键字高亮
==== 事件详情高亮和划选
在《日志易入门手册》中，我们已经知道，关键字查询时，日志易可以在日志原文中高亮展示搜索指明的关键字内容。但高亮本身在日志长度较长的时候，可能会导致搜索响应变慢，所以日志易默认并不开启高亮行为，您可以点击搜索配置参数弹层，勾选“关键字高亮”。
除了高亮日志原文以外，索引配置有具体的分词字段时，点击展开的日志事件详情中，该字段也可以高亮展示命中的关键字。
image::images/keywords-in-log-detail.png[]
此外，在展开的日志事件详情中，您可以点击字段值，选择"添加到搜索"或"从搜索删除"，进行快捷过滤。而对日志原文或其他分词字段，您可以双击选中单词或鼠标拖拽划选其中部分字符串，选择将这段单词字符串"添加到搜索"或"从搜索删除"。
image::images/select-in-log-detail.png[]
==== 异常关键字高亮
在一开始查询日志时，用户未必能明确知道自己需要关注具体哪个关键字。通常会先使用时间、主机名等粗颗粒度的过滤条件。日志易可以在查询结果中，自动高亮一些值得关注的异常关键字，帮助用户主动锁定异常情况的发生。
异常关键字列表可以在日志易 Manager 中定义 yottaweb 模块的 `highlight.custom_string_list` 参数，也可以在各租户内部系统设置中自行定义。以系统设置优先：
image::images/keywords-define.png[]
在搜索页搜索时，可以看到，即使不明确搜索error，也有高亮提示效果：
image::images/keywords-in-search.png[]
在以往的项目中，我们发现默认关键字高亮对后端性能影响很大，当搜索数据量过大时，可能会导致搜索超时。鉴于此，日志易将关键字是否高亮作为前端的可选项，默认是不勾选的，在使用过程中，需要异常关键字展示高亮时，在搜索配置中勾选"关键字高亮"即可。
image::images/search_config_keyword.png[]
=== 管道式搜索指令
日志易提供高级的管道式搜索指令模式，您可以通过直接在搜索框输入命令，实现较为复杂的关联分析，建立新字段，对字段进行数值运算等。
使用方法为在搜索框中填入 query 串之后追加管道命令。
比如：
 apache.status:200 | eval host=… | stats count by host
对于常用的统计类高级搜索命令，日志易统一封装成了“统计菜单视图”功能，您可以按照下一章节的介绍直接使用。在统计菜单不足以完成需求的时候，再求助于高级搜索语法。
日志易高级搜索命令的列表，以及命令的可用参数介绍，见《日志易搜索参考手册》。
日志易告警搜索命令的常见组合用法及场景举例，见《日志易搜索实例手册》。
=== 搜索结果取样
目前很多地方其实没必要等到全局查询或统计完成，如数据分析时，想先大概看看数据分布情况再考虑如何可视化。鉴于这些场景，日志易提供每个分片取样功能，使用户可以更快得到搜索结果。
点击搜索页的搜索配置，在弹出框输入每个分片取样条数，如2000条，则返回结果条数等于分片个数*每个分片取样条数。用户可以在manager的beaver\->shard查看shard个数。
image::images/search_config_sample.png[]
<<<
== 数据集
数据集是您为特定分析目的定义和维护的数据集合。用户可以使用数据集的别名属性构建树状结构，使用汇聚或继承构建不同的父子行为，进而得到不同的数据集合。
image::images/dataset-list.png[]
数据集是一种资源，可以对数据集进行编辑，标签，删除，授权和导入导出操作。点击操作列的"设为默认"，则每次打开搜索页面，默认选择该数据集。
每次编辑数据集等任一某种资源时，系统会自动记录编辑行为，用户可以在列表页点击行首展开，查看最近十次编辑历史的时间、账号、编辑属性等：
image::images/dataset-list-audit.png[]
=== 新建数据集
image::images/dataset-new.png[]
点击数据集列表页右上角的"新建数据集"，弹出悬浮层如上图，依次解释下各个属性：
* 名称：数据集名称。
* 别名：域内唯一，数据集展示的名称。可以使用dot(".")合并多个数据集展示，最多4层的dot分割描述，详见"别名使用dot合并展示结构"章节。
* 父子行为：无/汇聚/继承。父子行为是"无"时，父子节点之间没有继承（AND）和汇聚（OR）的关系，节点的约束语句保持独立。父子行为是汇聚或继承时，详见"汇聚式数据集"或"继承式数据集"章节。
* 约束语句：query语句，目前不能填写统计类 SPL 语句。
* 字段列表：在query语句约束下，数据实际会拥有，且有分析意义的字段名称和类型。目前仅支持字段提取字段，以及时间、文本、数值三种类型。在搜索页当选定的数据集配置有对应的字段列表时，执行搜索，左侧字段列表区域将直接展示该数据集配置的字段列表，不再向后台请求索引字段列表。您依然可以点击“全部字段”来查看索引字段列表。
* 所属应用：选择所属应用。只能选择一个应用，相关细节说明请参阅稍后应用章节介绍。
* 标签：选择/新建标签。
+
image::images/dateset-fields-in-search.png[]
点击"保存"，进入数据集编辑模式，如图：
image::images/dataset-edit-empty.png[]
==== 数据集结构
数据集结构是由父子节点组成的树状结构，节点包括节点名称、约束语句和字段列表，根节点是新建数据集时填写别名和约束语句，可以在编辑模式下，点击右上角"编辑根事件"，进行编辑。
image::images/dataset-edit-pnode.png[]
===== 添加节点
1. 鼠标放在节点上，显示"\+"，点击"+"添加子节点。
2. 输入节点名称，点击"✔"，保存节点名称。
3. 输入节点的约束语句，编辑"保存"，成功添加节点。
4. 输入节点的字段列表，点击"添加"，输入字段名称并选择字段类型即添加成功。点击"批量操作"可以批量删除字段列表。
image::images/dataset-add-cnode.png[]
===== 编辑节点
如图，在数据集结构右侧，编辑子节点名称、约束语句、字段列表。注意：修改完成后请进行保存。
image::images/dataset-edit-cnode.png[]
===== 删除节点
鼠标放在子节点上，显示"X"，点击"X"，删除该节点。或者点击右侧的"删除"，删除该节点。
===== 调整同一层级的节点顺序
在数据集编辑页可以选中并拖拽子节点，以调整同一层级的节点顺序。
=== 继承式数据集
父子行为是继承，子节点继承父节点的约束语句。例如：
1. 定义数据集Database，约束语句为：appname:database。
2. 添加一个子数据集SlowLog,约束语句为：tag:slowlog。
则，在搜索页看到的树状结构如下：
image::images/dataset-inherit.png[]
当点击Database时，生成到右侧的实际过滤语句为：appname:database；
当点击SlowLog时，生成到右侧的实际过滤语句为：appname:database AND tag:slowlog。
=== 汇聚式数据集
父子行为是汇聚，父节点汇聚子节点的约束语句。例如：
1. 定义数据集ESB，约束语句为：“appname:esb”。
2. 添加第一个子数据集esb1.mobile.cmb.com，约束语句为：“hostname:192.168.1.12”。
3. 再添加第二个子数据集esb2.mobile.cmb.com，约束语句为：“hostname:192.168.1.14”。
则，在搜索页看到的树状结构如下：
image::images/dataset-aggregation.png[]
当点击esb1.mobile.cmb.com时，生成到右侧的实际过滤语句为：“hostname:192.168.1.12”；
当点击ESB时，生成到右侧的实际过滤语句为：“appname:esb AND (hostname:192.168.1.12 OR hostname:192.168.1.14)”。
=== 别名使用dot合并展示结构
数据集之间是平行关系，可以平行展示，也可以根据别名的dot分隔描述，合并展示。比如：
1. 定义数据集手机银行ESB，别名为：应用.手机银行.esb系统，可以看到其数据结构是：
+
image::images/database-dot-structure.png[]
2. 定义数据集支付ESB，别名为：应用.二代支付.esb系统，可以看到其数据结构是：
+
image::images/dataset-dot-structure2.png[]
则，在搜索页上看到的树状结构如下：
image::images/dataset-dot-merge-display.png[]
其中，应用，手机银行，二代支付这三个层级是不可点击的，纯展示级别。
=== 数据集的展示和使用
==== 数据集在搜索页
image::images/dataset-display-in-searchpage.png[]
数据集在搜索页展示如上图。
* 当数据集很多时，可以通过数据集顶部的搜索框快速定位到指定数据集。
* 鼠标放在节点上展示节点对应的约束语句，如果该节点只是展示结构，则没有约束语句，且不可点击。
* 当数据集很多时，可以通过+、-来收起、展示子节点。默认状态为全部收起。
* ↑表示汇聚关系，↓表示继承关系。
* 节点可以多选，选中的节点在右侧搜索框上方展示，选中的节点之间是OR的关系。
* 搜索页默认没有选中数据集，选中数据集后，可以点击"展示"查看选中的数据集。
+
image::images/search-dataset-display-btn.png[]
由于数据集节点名称长度不一，搜索页左侧区域支持用户拖拽自定义宽度。拖放到合适宽度以后，系统将自动记录，刷新或重新登录时都将自动沿用这个宽度。
当用户可见范围内没有数据集定义时，搜索页左侧区域默认为完全收起状态。
==== 数据集在监控配置页
在监控配置中，当搜索配置选定数据集节点以后，填写触发条件中的字段名称时，系统会自动提供该数据集节点的字段列表供您选择。
image::images/dataset-monitor-tip.png[]
==== 数据集在趋势图新建页
在新建趋势图流程中，也可以直接选择数据集节点并基于节点字段列表进行快速配置。详细说明参见数据透视表章节。