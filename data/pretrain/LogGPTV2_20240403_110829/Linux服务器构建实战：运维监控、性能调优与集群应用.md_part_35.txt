resource.cfg是Nagios的变量定义文件，文件内容只有一行：
(2）resource.cfg文件
command_line
command _name
command_1ine
command_name
register
notification_period
notification_interval
contact_groups
retry_check_interval
normal_check
is_volatile
retain_nonstatus_information
www.Linuxidc .com
$NOTIFICATIONTYPE$\n\nService: $SERVICEDESCS\nHost: SHOSTALIASS\nAddress:
$CONTACTEMAILS
mail -S "** $NOTIFICATIONTYPES HoSt Alert:$HOSTNAMES is $HOSTSTATES **
$HOSTADDRESSS\nInfo:$HOSTOUTPUTS\n\nDate/Time:SLONGDATETIMES\n"1/bin/
Type:SNOTIFICATIONTYPES\nHost:SHOSTNAMES\nState:$HOSTSTATES\nAddress:
#下面是notify-host-by-email命令的定义
#cfg文件中定义
#命令的具体执行方式，“-H$HOSTADDRBSS”是定义目标主机的地址，这个地址在hoBts
#命令名称，即定义了一个主机异常时发送邮件的命令
#指定“发送通知”的时阅段，也就是可以在什么时候发送通知给使用者
#重试检查时间间隔，单位是分钟
#这里的check_period告诉Nagios检查服务的时间段
在服务出现异需后，故障一直浸有解决，NagioB再次向使用者发出通知的时间。单位是分钟
notify-service-by-email#命今名称，即定义了一个服务异常时发送邮件的命今
10分钟
interval
notify-host-by-email
24x7
60
w,u,c,x
admins
24x7
1
*****\n\nNotification
在
---
## Page 241
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
此文件在默认情况下不存在，
（4）hosts.cfg文件
define command{
check_tcp命令的定义如下：
define command{
口check_ping命令的定义如下：
define command{
口check_ssh命令的定义如下：
define command{
check_http命令的定义如下：
define command{
check-ftp命令的定义如下：
define command
check-host-alive命令的定义如下：
command_1ine
commandname
command_1ine
command_name
command name
commandline
#SARG1S是指在调用这个命令的时候，命令后面的第一个参数
command_line
command name
command_name
SCONTACTEMAILS
SerVice Alert: SHOSTALIASS/SSERVICEDESCS is SSERVICESTATE$ **
nAdditional Info:\n\n$SERVICEoUTpUTs|
$HOSTADDRESSS\nState:$SERVICESTATE$\n\nDate/Time:
www.Linuxidc.com.
$USER1$/check_ping -H $HOSTADDRESS$
check_tcp
check_ping
SUSERiS/check_ssh $ARG1$ $HOSTADDRESS$
check ssh
$USER1$/check_http -I SHOSTADDRESSS $ARG1$
check_http
SUSER1$/check_ftp -H $HOSTADDRESSS $ARG1$
check_ftp
check-host-alive
需要手动创建。hosts.cfg主要用来指定被监控的主机地址
#命令名称，用来检测主机状态
d-000'000050-80800000M-
$LONGDATETIMES\n
225
PDG
---
## Page 242
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
务和主机资源，例如监控HTTP服务、FTP服务、主机磁盘空间、主机系统负载等。
建更多被远程监控的主机和主机组，按照相同的格式分别手动创建即可。
及相关属性信息。
define service{
define service{
#################
一个配置好的示例如下：
此文件在默认情况下也不存在，
（5）services.cfg文件
此文件创建了192.168.12.251和192.168.12.26两个远程主机和一个主机组。如果要创
members
alias
define hostgroup{
define host{
define host{
check_command
service_description
host_name
check_command
service_description
host_name
address
alias
host_name
use
address
alias
host_name
use
#指定检查的命令，check_ping命令在commands.cfg中定义，后跟两个参数，命令与参数
#对监控服务内容的描述，以供维护人员参考
#指定要监控哪个主机上的服务，
#引用local-service服务的属性值，local-service在templates.cfg文件中进行了定义
间用！分割
一个配置好的示例如下：
web, mysq1
sa server:
sa-servers
ixdba
192.168.12.26
mysq1
linux-server
192.168.12.251
ixdba-web
web
linux-server
Web
inuxidc.com
local-service
，需要手动创建。services.cfg文件主要用于定义监控的服
################
check_ssh
web
local-service
check_ping1100.0,201500.0,60
PING
，“web”在hosts.cfg文件中进行了定义
web
HSS
#上面定义的两个主机
主机组成员，其中“web"、“myagl”就是
#定义一个主机组
主机组别名
主机组名称，可以随意指定
#引用主机linux-server的属性信息，1inux-server
IP，也可以是城名
PDG
---
## Page 243
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
local/nagios/libexec,
定义。结合commands.cfg和resource.cfg文件，不难看出，这些命令对应的真实路径是/usr/
FTP服务的check_ftp、监控HTTP服务的check_http等，这些命令均在commands.cfg中进行
check_ftp和check_http。如果要监控远程主机更多的服务，按照相同格式增加即可。
在service.cfg文件中，有很多对命令的定义，例如监控SSH服务的check_ssh、监控
这里对Web和MySQL主机设置了4个监控服务，
define service
define service
define service{
define service{
define servicef
define service{
service_description
host_name
ise
service_description
host_name
1se
service_description
host_name
ase
check_command
service_description
host_name
ise
check_command
service_description
host_name
ise
service_description
host_name
use
www.Linuxidc.com
，也就是说，这些命令其实就是安装Nagios插件后生成的可执行文件。
mysq1
local-service
check_ftp
ftp
mysq1
local-service
check_ssh
local-service
check_ping1100.0,20号1500.0,60$
mysq1
local-service
check_http
http
web
local-service
check_tcp122
SSHD
web
local-service
真6第
分别是check_ping、check_ssh、
运维监控利器Nagio
227
---
## Page 244
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
时，
次通过叹号分割即可。下面列举几个命名组合进行介绍。
228第4篇
此文件只用于定义监控的时间段。下面是一个配置好的示例：
（7）timeperiods.cfg文件
define contactgroup
define contact
下面是一个配置好的示例。
Nagios会通过指定的通知方式（邮件或短信）将信息发给这里指定的联系人或使用者。
contacts.cfg是一个定义联系人和联系人组的配置文件，当监控的主机或者服务出现故障
(6）contacts.cfg文件
另外，在监控服务器端口时，
此命令组合从左到右依次为：命令！告警时延！严重告警时延！连接超时时间。
此命令组合从左到右依次为：命令！端口！连接超时时间。
check_ssh!22110
此命令组合从左到右依次为：命令！端口！告警时延！严重告警时延！连接超时时间。
此命令组合从左到右依次为：命令！告警时延！严重告警时延！连接超时时间，
此命令组合从左到右依次为：命令！告警时延，丢包率！严重告警时延，丢包率。
check_ping!100.0,201500.0,60
在Nagios中，插件命令和参数的组合格式为：命令！参数！参数。如果有更多参数，依
alias
wdnox5uo
check_smtp10.002010.0050110
check_tcp12310.002010.0050110
check_http!0.002010.0050!10
alias
check_telnet=check_tcp123
check_udp=check_tcp
check_pop=check_udp!110
check_ftp=check_tcp!21
check_imap=check_tcp1143
check_ash=check_tcp!22
use
www.Linuxidc .com
PI:EMAIL
sa-system
generic-contact
运维监控与性能优化篇
sasysten
system administrator group
admins
：很多命令都可以使用check_tcp来代替，例如：
联系人的邮件地址
其中“generic-contact”在templates.cfg文件中进行定义
联系人名称
美系人别名
#就是上面定义的联系人
#联系人组描述
#联系人组名称
关系人组成员，其中“sasystem”
---
## Page 245
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
配置文件即可。下面分别对Nagios.cfg文件中的内容进行介绍。
件，所有的对象配置文件都必须在这个文件中进行定义才能发挥其作用，这里只需引用对象
/usr/local/nagios/etc目录下，接着开始配置nagios.cfg文件。
户的执行权限就可以了。需要修改的配置信息如下：
件了。由于Nagios的Web监控界面验证用户为ixdba，因此只需在cgi.cfg文件中添加此用
重启Nagios进程、关闭Nagios通知、停止Nagios主机检测等，这时就需要配置cgi.cfg文
cfg_file=/usr/local/nagios/etc/hosts.cfg
“log_file”变量用来定义Nagios日志文件的路径。
1og_file=/usr/local/nagios/var/nagios.1cg
nagios.cfg文件默认的路径为/usr/local/nagios/etc/nagios.cfg，是Nagios的核心配置文
(9）nagios.cfg文件
到这里为止，Nagios的所有对象配置文件已经修改完了。将创建好的8个文件全部放到
authorized_for_all_host_commands=nagiosadmin,ixdba
authorized_for_all_hosts=nagiosadmin,ixdba
authorized_for_all_services=nagiosadmin,ixdba
authorized_for_system_information=nagiosadmin, ixdba
default_user_name=ixdba
此文件用来控制相关CGI脚本，如果想在Nagios的Web监控界面执行CGI脚本，例如
（8）cgi.cfg文件
define timeperiod{
define timeperiod{
friday
thursday
tuesday
nonday
alias
saturday
friday
tuesday
monday
sunday
alias
timeperiod_name 24x7
www.Linuxidc.com
for
for
al
09:00-17:00
09:00-17:00
09:00-17:00
09:00-17:00
09:00-17:00
Normal Work Hours
00:00-24:00
00:00-24:00
00:00-24:00
00:00-24:00
00:00-24:00
00:00-24:00
24 Hours A Day.7 Days A Week
#下面定义一个名为workhours的时间段，即工作时间段
#下面定义一个名为24x7的时间段，即监控所有时间段
229
---
## Page 246
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
了一个数字加一个“s”（如10s），那么外部检测命令的间隔是这个数值以秒为单位的时间间
“1”为运行，“0”为不允许运行。
命令，也就是是否允许Nagios在Web界面下执行重启Nagios、停止主机／服务检查等操作，
秒，
机信息等。
的Nagios不影响CGI的显示输出。