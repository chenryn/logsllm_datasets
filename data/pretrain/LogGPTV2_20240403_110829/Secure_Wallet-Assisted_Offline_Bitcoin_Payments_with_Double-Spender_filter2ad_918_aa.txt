title:Secure Wallet-Assisted Offline Bitcoin Payments with Double-Spender
Revocation
author:Alexandra Dmitrienko and
David Noack and
Moti Yung
Secure Wallet-Assisted Ofﬂine Bitcoin Payments with
Double-Spender Revocation
Alexandra Dmitrienko
Institute of Information
Security, ETH Zurich
alexandra.dmitrienko@
inf.ethz.ch
David Noack
Technische Universität
Darmstadt
PI:EMAIL
Moti Yung
Snapchat, Inc.
and Columbia University
PI:EMAIL
ABSTRACT
Bitcoin seems to be the most successful cryptocurrency so
far given the growing real life deployment and popularity.
While Bitcoin requires clients to be online to perform trans-
actions and a certain amount of time to verify them, there
are many real life scenarios that demand for oﬄine and im-
mediate payments (e.g., mobile ticketing, vending machines,
etc). However, oﬄine payments in Bitcoin raise non-trivial
security challenges, as the payee has no means to verify the
received coins without having access to the Bitcoin network.
Moreover, even online immediate payments are shown to be
vulnerable to double-spending attacks.
In this paper, we propose the ﬁrst solution for Bitcoin
payments, which enables secure payments with Bitcoin in
oﬄine settings and in scenarios where payments need to be
immediately accepted. Our approach relies on an oﬄine wal-
let and deploys several novel security mechanisms to prevent
double-spending and to verify the coin validity in oﬄine set-
ting. These mechanisms achieve probabilistic security to
guarantee that the attack probability is lower than the de-
sired threshold. We provide a security and risk analysis as
well as model security parameters for various adversaries.
We further eliminate remaining risks by detection of misbe-
having wallets and their revocation.
We implemented our solution for mobile Android clients
and instantiated an oﬄine wallet using a microSD security
card. Our implementation demonstrates that smooth inte-
gration over a very prevalent platform (Android) is possible,
and that oﬄine and online payments can practically co-exist.
We also discuss alternative deployment approach for the of-
ﬂine wallet which does not leverage secure hardware, but
instead relies on a deposit system managed by the Bitcoin
network.
Keywords
Bitcoin; Oﬄine payments; Zero conﬁrmation transactions;
Double-Spender revocation; Secure hardware
Permission to make digital or hard copies of all or part of this work for personal or
classroom use is granted without fee provided that copies are not made or distributed
for proﬁt or commercial advantage and that copies bear this notice and the full citation
on the ﬁrst page. Copyrights for components of this work owned by others than the
author(s) must be honored. Abstracting with credit is permitted. To copy otherwise, or
republish, to post on servers or to redistribute to lists, requires prior speciﬁc permission
and/or a fee. Request permissions from permissions@acm.org.
AsiaCCS ’17, April 4–6, 2017, Abu Dhabi, United Arab Emirates
c(cid:13) 2017 Copyright held by the owner/author(s). Publication rights licensed to ACM.
ISBN 978-1-4503-4944-4/17/04. . . $15.00.
DOI: http://dx.doi.org/10.1145/3052973.3052980
1 Introduction
Electronic payments and mobile banking have experienced
rapid development and deployment with hundred millions of
customers worldwide [12]. Mobile banking services have par-
ticularly been successful in developing countries and enable
ﬁnancial services to the large part of the population that is
unbanked or cannot use solutions oﬀered by banks [19].
Electronic cash has been an attractive subject of research
and investigation since the late 1980s, starting with the sem-
inal paper by David Chaum [26] followed by a large body
of subsequent works. Cryptographic techniques were intro-
duced to tackle security and privacy challenges such as pro-
tecting against forgery and double-spending and providing
anonymity. However, almost all the proposed solutions so far
involve trusted third parties such as banks to generate and
validate digital cash. Moreover, none of these cryptocurren-
cies have ever made it to be used for real-world payments.
In contrast, Bitcoin [49] relies neither on banks nor on any
other central authority for coin issuing or verifying transac-
tions and seems to be the most successful cryptocurrency
that is used for real world payments. There were at least
over 100,000 merchants worldwide that accepted bitcoins in
2015 [29], and large support by merchant tools and payment
processors [13, 23] is likely to increase this number to mil-
lions in 2016.
Indeed Bitcoin has initially celebrated enormous success
driven by the large interest from users as well as academia
and markets. Within a short time Bitcoin has been thor-
oughly analyzed with regards to security [42, 20, 35], privacy
issues [15, 51, 46] as well as economic aspects [16, 44]. More-
over, a number of alternative cryptocurrencies (altcoins)
were proposed that have made substantial changes to initial
Bitcoin design with diﬀerent goals. For instance, Zerocoin
[47], Zerocash [21], CryptoNote [55] and PinnochioCoin[30]
aim at providing advanced anonymity, Litecoin [9] and Do-
gecoin [6] use ”memory-hard” puzzles which can be eﬀec-
tively solved using commodity hardware, Primecoin [43] in-
troduced the useful puzzle which requires ﬁnding sequences
of large prime numbers, while Ethereum [24] extends Bit-
coin’s transaction semantics to enable advanced transaction
types. However, Bitcoin seems to still be the most popular
and promising cryptocurrency for deployment in practice
and believed to continue to co-exist with traditional ﬁnan-
cial systems.
The most challenging security requirements of digital cur-
rency, unforgeability and double-spending prevention, are
addressed in Bitcoin by means of asymmetric cryptography
520and a distributed time-stamping service based on proof-of-
work (PoW). As a consequence, transactions cannot be con-
sidered deﬁnite as soon as they are received, because it takes
some time for the Bitcoin network to verify and integrate
them in a state that is very hard to change. Hence, a re-
ceiver of a Bitcoin transaction requires an online connection
to the Bitcoin network in order to determine validity of the
transaction, as well as a certain amount of time (10 min.
in average). This makes, however, oﬄine payment with bit-
coins extremely challenging, although in many real world
scenarios (e.g., taxis, mobile ticketing, vending machines,
etc.) oﬄine payments are highly desirable. Moreover, Bit-
coin payments are increasingly used at POS terminals for
immediate payments, where purchased items are released
within a few seconds after the payment and before the trans-
action conﬁrmation have been generated by the network,
although it was already shown that such deployments are
vulnerable to double-spending attacks [42].
Goals and Contributions
We present an extension to Bitcoin protocol which enables
secure payments with Bitcoin in oﬄine settings and in sce-
narios where payments need to be immediately accepted. In
particular, our contributions are as follows:
• Solution for immediate and oﬄine payments. We an-
alyze non-trivial challenges of oﬄine and immediate
payments with Bitcoin (Section 3) and, for the ﬁrst
time, propose a solution which requires neither payer
nor payee to be online during the payment and in
which payments can be instantly accepted (Section 4).
The solution relies on an oﬄine wallet of a payee and
incorporates probabilistic security mechanisms, which
provide guarantees that the attack probability is lower
than the desired threshold. Moreover, we eliminate
remaining risks by introducing safe yet usable trans-
action limits and revocation mechanisms for double
spending wallets in order to make attacks unproﬁtable
for an adversary. We provide a rigorous risk analysis
of our solution and suggest exemplary values for the
security parameters (Section 5).
• Implementation and Evaluation. We provide a proof-
of-concept implementation for mobile Android plat-
forms and instantiate an oﬄine wallet using a microSD
security card (Section 6). Minor changes to Bitcion
miners for revocation support are integrated into bit-
coind client. We report performance measurements
of operations performed on resource constrained mi-
croSD card, which demonstrate the feasibility of our
approach for deployment in practice. We further dis-
cuss an alternative deployment option for the oﬄine
wallet, which relies on Bitcoin-based deposit system
and does not require any secure hardware (Section 7).
Our scheme provides a valuable solution to a challenging
problem and enables the promising use of Bitcoin in rising
developing markets with the need for innovative and inde-
pendent payment solutions.
2 Bitcoin Basics
We begin with a brief description of Bitcoin ecosystem. For
a more detailed description we refer the reader to [36].
Involved Parties Generally, Bitcoin system assumes two
types of users: Regular users U and miners M. A regular
user X ∈ U can utilize the Bitcoin network for exchang-
ing bitcoins with another user Y ∈ U by means of trans-
actions, either spending or receiving them. Regular users
own (pseudonymous) accounts identiﬁed by addresses and
associated asymmetric key pairs. Generally, a single trans-
action can transfer funds between several accounts at once,
i.e., it can involve several sender and destination accounts,
however for simplicity and without loss of generality we will
assume throughout the paper that transactions involve one
sender and one destination account.
Miners M are the actual operators of Bitcoin network.
Each miner M ∈ M works on verifying transactions and in-
cludes them into the public history of all transactions, called
the blockchain B. There are no special miner accounts in the
network, however miners typically own accounts of regular
users in order to receive rewards for transaction processing.
Blockchain operation The blockchain is simply a chain (or
sequence) of blocks, which can be extended by appending
a new valid block. Each block in the chain references the
previous block, which deﬁnes the unique order of blocks in
the sequence. Creation of a new valid block requires miners
to solve a cryptographic puzzle, which requires signiﬁcant
computational eﬀort. The puzzle used by Bitcoin network
requires to ﬁnd an input to a hash function (randomized by
a nonce) which results in a hash value less than a speciﬁc
target value. Hence, miners usually have to compute a large
number of hashes until they solve the puzzle. The target
value is a security parameter which regulates diﬃculty of
the puzzle, which is adjusted to the computational power
available in the network.
As soon as the new block is created, all the transactions
included into the block are considered as being conﬁrmed
by the network. The more subsequent blocks have been ap-
pended to the current block, the harder it gets to tamper
with included transactions, as this would require to recom-
pute all the subsequent blocks. Hence, one could say that
the transaction τ is conﬁrmed by n-transaction conﬁrma-
tion n -T = {Bi, ..., Bi+n}, if it is included into the block
Bi and there are n subsequent blocks appended to Bi. The
larger n is, the higher is the conﬁdence in the validity of
τ . For simplicity, we will refer to blocks from n-transaction
conﬁrmation as conﬁrmation blocks throughout the paper.
Generally, transactions can be veriﬁed on diﬀerent levels.
While miners and powerful nodes perform a full veriﬁcation,
many (especially mobile) clients perform a more lightweight
processing, called simple payment veriﬁcation (SPV). The
full veriﬁcation includes checks of correctness of the transac-
tion syntax, veriﬁcation of all preceding transactions, which
increased balance of the current account, as well as ensures
that the account balance has not been already spent (by
checking the entire blockchain).
In contrast, SPV clients
verify only transaction syntax and rely on n-transaction con-
ﬁrmation issued by the network, which implies that all the
other veriﬁcations were successfully performed by full nodes.
Conﬁrmation blocks are veriﬁed by SPV clients at the level
of blockheaders (i.e., without verifying transactions included
into blocks), which is suﬃcient to ensure that conﬁrmation
blocks are the part of the entire blockchain and they were
generated using the appropriate diﬃculty.
5213 Threat Analysis and Challenges
In this section we analyze threats of oﬄine Bitcoin payments
and discuss associated challenges.
3.1 Coin forgery attacks
Coin forgery attacks do not impose threat to immediate
payments for full clients, as they have a local copy of the
blockchain and can verify validity of all preceding transac-
tions on their own, without relying on transaction conﬁr-
mations issued by the network. However, in oﬄine scenario
detection of forged coins is challenging even for full nodes, as
they may not have a part of the blockchain which is neces-
sary for veriﬁcation of (one of) the preceding transaction(s).
This may happen if the node got oﬄine before the preceding
transaction have been integrated into the blockchain.
To address this threat, we propose a new time-based trans-
action conﬁrmation veriﬁcation mechanism (cf. Section 4.2).
Additionally to regular checks performed by the standard
transaction conﬁrmation veriﬁcation of Bitcoin, it considers
a time window within which the transaction conﬁrmation
was generated. As a result, it can provide a high conﬁdence
even in oﬄine settings that the transaction conﬁrmation was