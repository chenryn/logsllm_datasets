69
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 09:56:40 UTC from IEEE Xplore.  Restrictions apply. 
channelsendingreceivingactionautomataautomatanewjobload,totalchargeschedulercalltheschedulertomakeaschedulingdecisionwhenanewjobstartsorabatteryisemptygoonschedulertotalchargeswitchthebatterychosenbytheschedulertoonusechargetotalchargeheightdifferenceincreasetheheightdifferencewithoneunitforeverychargeunitdrawnfromthebatteryemptiedtotalchargemaximumﬁnderaddonetothenumberofbatteriesthatareemptyallemptymaximumﬁnderheightdifference,load,schedulerstopallbatteryprocesseswhenallbatteriesareemptyTable2.OverviewofthesynchronizationchannelsusedintheTA-KiBaM.chargewells.InTable2allusedsynchronizationchannelsarelistedtogivenanoverviewoftheinteractionsbetweenthedifferentautomata.WeusethusCoratocheckthesimpleTCTLpropertyA[]notmax.done.Thispropertyisnotsatisﬁed,andCorareturns,withappropriatelychosenoptions,apathasacounterexamplewhichminimizesthecostandmaximizesthesystemlifetime.4.4ComplexityThecomplexityofﬁndingtheoptimalscheduledependsexponentiallyonthenumberofschedulingdecisionsthathastobemade,wherethenumberofbatteries(B)isthebase.AteveryschedulingpointonecanchoosebetweenallBbatteries.Thenumberofschedulingpointsdependonthebattery’scapacityandtheloadapplied.Betweentheschedulingpointsthemodelisfullydeter-ministic.Thenumberofstatesinbetweentwoschedulingpointswilldependonthegranularityofthediscretization.ThemaximumnumberofstatechangesthatcanbemadeduetodischargingisN=C/Γ,whenallchargeunitsaredrainedoneatatime.Themaximumnumberofstatechangesduetorecoveryisnotsoeasytodeﬁne.However,itwillbeproportionalto1/Δ.Sinceinthemodel,Δ=Γ/c,thismaximumnumberofstateswillbeproportionalto1/Γ.Thediscretizationoftimewillnotinﬂuencethemaximumnumberofstates.Introducingsmallertimestepswillonlyincreasethenumberoftimestepsittakestochangestates.5ValidationoftheTA-KiBaMTovalidatetheTA-KiBaM,wecomparethebatterylifetimescomputedwiththismodelandwiththeoriginalKiBaM.TheKiBaMitselfhasbeenvalidatedin[16],whereitiscomparedtotheverypreciseelectro-chemicalmodelDualfoil[11,14,13].testlifetimelifetimedifferenceloadKiBaMTA-KiBaM%(min)(min)CL2504.534.560.7CL5002.022.041.0CLalt2.582.600.8ILs25010.8010.840.4ILs5004.304.320.5ILsalt4.804.820.4ILsr14.724.740.4ILsr24.724.740.4IL(cid:4)25021.8621.880.1IL(cid:4)5006.536.560.5Table3.BatterylifetimesofbatteryB1forthedifferentloadscomputedwithboththeana-lyticalKiBaMandtheTA-KiBaM.Weconsiderasingle-batterycase,andusetwodifferentbatterytypes,onewithcapacity5.5Amin(Ampere-minute)(B1)andonewithcapacity11Amin(B2).Thebatterypa-rametersarethesameforbothbatteries:c=0.166andk(cid:2)=0.122min−1[15],correspondingtothelithium-ionbatteryusedintheItsypocketcomputer,whichwasalsosimulatedbyRakhmatovetal.[20,21].Thetimestepsizeissetto0.01min.Thetotalchargeisdiscretizedinstepsofsize0.01Amin.Thisleadstothediscretizationstepsizeoftheheightdifferenceof0.01/c=0.06Amin.TheItsypocketcomputeroperateswithcurrentsupto700mA.Inthetestsweusedtwotypesofjobs,alowcurrentjob(250mA)andahighcurrentjob(500mA).Withthesejobs,tendifferenttestloadshavebeencreated:•threecontinuousloads(CL)withnoidleperiodsbe-tweenthejobs:oneloadwithonlylowcurrentjobs978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
70
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 09:56:40 UTC from IEEE Xplore.  Restrictions apply. 
(CL250),onewithonlyhighcurrentjobs(CL500),andonealternatingbetweenalowcurrentjobandahighcurrentjob(CLalt).•ﬁveintermittedloadswithshortidleperiodsofoneminutebetweenthejobs(ILs):onewithonlylowcur-rentjobs(ILs250),onewithonlyhighcurrentjobs(ILs500),onealternatingbetweenalowcurrentjobandahighcurrentjob(ILsalt),andtwowherethejobisrandomlychosen(ILsr1andILsr2)•twointermittedloadswithlongidleperiodsoftwominutesbetweenthejobs(IL(cid:4)):onewithonlylowcur-rentjobs(IL(cid:4)250)andonewithonlyhighcurrentjobs(IL(cid:4)500).TheresultsofthetestsforthetwobatterytypesaregiveninTable3and4.Formostloadsthelifetimeinthetimedautomatonbatterymodelisonlybetween0.02and0.04minlongerfortheanalyticalKiBaM.FortheloadsCL250andCLaltTA-KiBaMgivesabiggerdifferenceforbatteryB2.Thisbiggerdifferenceisduethediscretiza-tionoftheheightdifferenceandthetimeneededtore-coveroneheightunit.Whenabatteryisdischarged,theheightdifferencecangrowuptothepointthatthetimetoincreasetheheightdifferencewithoneunitequalsthetimetodecreasetheheightdifferencewithoneunit,i.e.,curtimes[x]=recovtime[y].Therecovtimeiscom-putedaccordingto(6)androundedtothenearestnumberoftimesteps.Theroundingcausestheheightdifferencetogrowlessthanitdoesintheanalyticalversionofthemodel.Theamountofchargethatisunavailablewhenthebatteryisemptyisproportionaltotheheightdifference,sothesmallerheightdifferencewillgivealongerlifetime.ThemomenttheheightdifferencedoesnotincreaseanymoreisonlyreachedwiththeloadsCL250andCLaltappliedtoB2.Inallothercases,eitherthebatterylifetimeistooshortfortheheightdifferencetoreachthispoint,ortheloadhasidleperiodsinwhichtheheightdifferencewilldecrease.Notethatevenfortheloadswiththebiggerdifferences,therelativedifferenceisstillonly1%.Althoughthediscretizedmodelsometimesgivessmalldifferencesinlifetimecomputationcomparedtotheanalyt-icalmodel,weregarditperfectlyusableforattackingtheschedulingproblem.6SchedulingresultsWeusethemultiplebatterytimedautomatonmodeltoﬁndtheoptimalwaytoscheduletwobatteriesonthesametestloadsasusedinSection5.WeusebatteriesoftypeB1.Nexttocomputingthemaximumlifetime,weusedtheTA-KiBaMtocomputethelifetimeusingthreedeterminis-ticschedulingschemes.Hence,wecomparefourschedules:testlifetimelifetimedifferenceloadKiBaMTA-KiBaM%(min)(min)CL25012.1612.281.0CL5004.534.540.2CLalt6.456.521.1ILs25044.7844.800.04ILs50010.8010.840.4ILsalt16.9316.940.1ILsr122.7122.740.1ILsr214.8114.840.2IL(cid:4)25084.9084.920.02IL(cid:4)50021.8621.880.1Table4.BatterylifetimesofbatteryB2forthedifferentloadscomputedwithboththeana-lyticalKiBaMandthediscretizedtimedau-tomataKiBaM.•Sequentialschedule.Thebatteriesareusedsequen-tially,i.e.,thesecondbatteryisonlychosenwhentheﬁrstoneisempty.•Roundrobinschedule.Foreverynewjobanewbatteryischosen.Thebatteriesarechoseninaﬁxedorder.•Best-of-twoschedule.Atthestartofajob,thestatusofthebatteriesischecked.Thebatterywiththemostchargeintheavailablechargewellischosentosupplythechargeforthejob.•Optimalschedule.TheschedulecomputedusingCora.ThecomputedlifetimesaregiveninTable5,alongwiththerelativedifferencetothelifetimeoftheroundrobinscheduler.Forthetestloads,onecanseetheorderinperfor-manceofthedifferentschedulingschemes.Onecaneasilyshow,usingtheCoramodel,thatthesequentialschedulingisactuallytheworstpossiblewaytoschedulethebatteries.Forthetestloadstheroundrobinandbest-of-twoschemedifferonlyinthecasesofthealternatingjobs.Thesecasesareclearlyverybadfortheroundrobinscheme,sincetheheavyloadisalwaysputontothesamebattery.Thisbat-terywillbeemptyveryfast,andthenonlyonebatteryislefttohandlealloftheremainingload,leavingthisbat-terywithlessidletimetorecover.Thebest-of-twoschemebalancestheloadbetteroverthetwobatteries,whichleadstoalongerlifetime,especiallyintheILsaltcase.Intheothercasesthebest-of-twoschemebehavesexactlyliketheroundrobinscheme.Althoughtheroundrobinandbest-of-twoschedulersperformclosetooptimalinmostcases,forsomeloadstheschedulesarefarfromoptimal.Theoptimalscheduleryieldslifetimeimprovementsupto32%.978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
71
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 09:56:40 UTC from IEEE Xplore.  Restrictions apply. 
testsequentialroundrobinbest-of-twooptimalloadlifetimedifferencelifetimelifetimedifferencelifetimedifference(min)%(min)(min)%(min)%CL2509.12-21.411.6011.60012.043.79CL5004.10-9.54.534.5304.581.1CLalt5.48-10.26.106.120.36.486.2ILs25022.80-41.538.9638.96040.804.7ILs5008.60-17.910.4810.48010.480ILsalt12.38-3.412.8216.3027.216.9131.9ILsr112.80-21.2816.2616.26020.5226.2ILsr212.24-15.5914.5014.50014.540.3IL(cid:4)25045.84-39.776.0076.00078.963.9IL(cid:4)50012.94-18.915.9615.96018.6817.0Table5.Systemlifetimecomputedforalltestloadsaccordingtothefourschedulingschemes.Nexttothevaluesofthelifetimes,thedifferencerelativetotheroundrobinschemearegiven.-1 0 1 2 3 4 5 6 0 2 4 6 8 10 12 14 16 18 0 1 2charge (Amin)chosen batterytime (min)total charge battery 1total charge battery 2available charge battery 1available charge battery 2battery schedule(a)best-of-two-1 0 1 2 3 4 5 6 0 2 4 6 8 10 12 14 16 18 0 1 2charge (Amin)chosen batterytime (min)total charge battery 1total charge battery 2available charge battery 1available charge battery 2battery schedule(b)optimalFigure6.Theschedulesandthetotalandavailablechargeinthebatteriesforthebest-of-two(a)andtheoptimal(b)schedulefortheILsaltload.Besidesthesystemlifetimes,theCoraevaluationofthetimedautomatabatterymodelalsoprovidestheactualscheduleswhichleadtotheselifetimes,aswellastheevo-lutionofthechargeinthebattery.Figure6showstheevolu-tionofthetotalandavailablechargeinthetwobatteries(lefty-axis)forboththebest-of-twoscheduler(Figure6(a))andtheoptimalscheduler(Figure6(b)),intheILlaltcase.Intheﬁgure,alsothetwoschedules(righty-axis)areshown.Whenabatteryischosen,onecanseethetotalandavailablechargedecreaseduetotheload.Theslopeofthecurvesisproportionaltothedischargecurrent.Whenabatteryisnotused,onecanseetheavailablechargeriseagain.Thisisduetotherecoveryeffect.Notethat,whenthebatteriesareempty,stillarelativelylargeamountofchargeremainsinthebattery(approximately3.9Amin,whichis70%ofitsoriginalenergy).Duetothecomplexityofﬁndingtheoptimalschedule,itispossibletomodelonlyalimitedtotalbatterycapacity.Theuseddischargecurrentsarerelativelyhighforthebat-tery’scapacity,andwilldraintheavailablechargewellfast.Therefore,therewillbelittletimefortheboundchargetobecomeavailable,andalargefractionwillremainunused.Whenthebatterycapacityisincreasedthisfractionwillbesmaller.Usingthedeterministicschedulingscheme,wecancomputetheresultsforlargercapacities.Forexample,withatentimeslargercapacity,thefractionofchargeleftbehindinthebatterieswillbelessthan10%inthecaseofbest-of-twoscheduling.WhenwelookatthetwoschedulesinFigure6,weseethatthebest-of-twoscheduleactslikearoundrobinsched-978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
72
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 09:56:40 UTC from IEEE Xplore.  Restrictions apply. 
ulerthatswitchesbatteriesafterthehighcurrentjobs.Theoptimalscheduledoesnotshowaregularpattern;furtherresearchisneededhere.Theoptimalscheduledoesdependstronglyonthesizeofthebatteriesandtheirparameters,aswellasontheloadthatisapplied.7ConclusionsandoutlookWehaveshownanewapproachtomaximizingthesys-temlifetimethroughbatteryscheduling.Thepriced-timedautomatonbatterymodelallowsustocomputetheoptimalwaytoschedulemultiplebatteriesforagivenload.Theoptimalscheduleandlifetimecaneasilybecomparedtostraightforwardschedulingschemes,likeroundrobin.Formostofthetestedloadstheroundrobinandbest-of-twoschedulersperformclosetooptimal.However,theoptimalschedulesdoshowthattherestillisroomforimprovement.Theoptimalschedulercanonlybeusedinreallifesys-tems,whentheloadfunctionisknowninadvance.How-ever,itdoeshelpinﬁndingabetterwayofusingtheavail-ablebatterycapacity.Nexttothetestloadsasusedhere,realisticrandomloadsneedtobeanalyzed.However,Up-paalCoradoesnotallowforprobabilitiestobeincludedinthemodels.Forthis,onedoesneedprobabilistic(priced)timedautomata.However,notoolsareavailableyettodothis,althoughalgorithmsareindevelopment[8].Besidesmultiplebatteryscheduling,wealsowanttousethetimedautomatabatterymodelforanotheroptimizationproblem.Foradevicewithonebatteryandagivenwork-load,wewanttoknowhowtoschedulethejobsovertimetooptimizethebatterylifetime.Thiscould,forexample,beusedinnodesinsensornetworks,whichhavesimpleregu-larworkloads.Nexttothetimedautomatamodelsforoptimizingthebatterylifetime,wewanttoinvestigatetheusabilityofAIplanning[12]tosolvetheschedulingproblems.References[1]R.Alur,C.Courcoubetis,andD.Dill.Model-checkingindensereal-time.InformationandComputation,104(2):2–34,1993.[2]R.Alur,S.L.Torre,andG.J.Pappas.Optimalpathsinweightedtimedautomata.InBenedettoandSangiovanni-Vincentelli[6],pages49–62.[3]G.Behrmann,A.David,andK.Larsen.AtutorialonUp-paal.InFormalMethodsfortheDesignofReal-TimeSys-tems,volume3185ofLNCS,pages200–236.SpringerVer-lag,2004.[4]G.Behrmann,A.Fehnker,T.Hune,K.G.Larsen,P.Pet-tersson,J.Romijn,andF.W.Vaandrager.Minimum-costreachabilityforpricedtimedautomata.InBenedettoandSangiovanni-Vincentelli[6],pages147–161.[5]G.Behrmann,K.G.Larsen,andJ.I.Rasmussen.Optimalschedulingusingpricedtimedautomata.ACMSIGMET-RICSPerformanceEvaluationReview,32(4):34–40,2005.[6]M.D.D.BenedettoandA.L.Sangiovanni-Vincentelli,ed-itors.Proc.HSCC2001,volume2034ofLNCS.Springer,2001.[7]L.Benini,G.Castelli,A.Macii,E.Macii,M.Poncino,andR.Scarsi.Extendinglifetimeofportablesystemsbybat-teryscheduling.InDesign,AutomationandTestinEurope,pages197–203.IEEECSPress,2001.[8]J.Berendsen,D.N.Jansen,andJ.-P.Katoen.Probablyontimeandwithinbudget–onreachabilityinpricedproba-bilistictimedautomata.InProc.QEST’06.IEEECSPress,2006.[9]C.ChiasseriniandR.Rao.Energyefﬁcientbatteryman-agement.IEEEJ.Sel.AreasinCom.,19(7):1235–1245,2001.[10]L.Cloth,B.R.Haverkort,andM.R.Jongerden.Comput-ingbatterylifetimedistributions.InProc.DSN2007,pages780–789.IEEECSPress,2007.[11]M.Doyle,T.F.Fuller,andJ.Newman.Mod-elingofgalvanostaticchargeanddischargeofthelithium/polymer/insertioncell.JournaloftheElectrochemi-calSociety,140(6):1526–1533,1993.[12]M.FoxandD.Long.Modellingmixeddiscrete-continuousdomainsforplanning.JournalofAIResearch,27:235–297,2006.[13]T.F.Fuller,M.Doyle,andJ.Newman.Relaxationphenom-enainlithium-ion-insertioncells.JournaloftheElectro-chemicalSociety,141(4):982–990,1994.[14]T.F.Fuller,M.Doyle,andJ.Newman.Simulationandop-timizationoftheduallithiumioninsertioncell.JournaloftheElectrochemicalSociety,141(1):1–10,1994.[15]M.R.JongerdenandB.R.Haverkort.Batterymodel-ing.TechnicalReportTR-CTIT-08-01,CTIT,UniversityofTwente,2008.[16]M.R.JongerdenandB.R.Haverkort.Whichbatterymodeltouse?InProc.UK-PEW2008,Tech.ReportDComp.,ImperialCollegeLondon,pages76–88,2008.[17]J.ManwellandJ.McGowan.Leadacidbatterystoragemodelforhybridenergysystems.SolarEnergy,50:399–405,1993.[18]J.ManwellandJ.McGowan.Extensionofthekineticbat-terymodelforwind/hybridpowersystems.InProc.EWEC’94,pages284–289,1994.[19]J.Manwell,J.McGowan,E.Baring-Gould,S.W.,andA.Leotta.Evaluationofbatterymodelsforwind/hybridpowersystemsimulation.InProc.EWEC’94,pages1182–1187,1994.[20]D.Rakhmatov,S.Vrudhula,andD.A.Wallach.Batterylifetimepredictionsforenergy-awarecomputing.InProc.ISLPED’02,pages154–159,2002.[21]D.Rakhmatov,S.Vrudhula,andD.A.Wallach.Amodelforbatterylifetimeanalysisfororganizingapplicationsonapocketcomputer.IEEETrans.onVLSISystems,11(6):1019–1030,2003.[22]UPPAALwebpage.www.uppaal.com.