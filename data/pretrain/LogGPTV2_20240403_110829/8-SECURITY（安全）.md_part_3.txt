\[root@room9pc01 \~\]# ls -Al /root/.ssh
总用量 20
-rw-r\--r\--. 1 root root 404 4月 27 2018 authorized_keys
-rw-r\--r\--. 1 root root 1675 2月 14 08:30 id_rsa
-rw-r\--r\--. 1 root root 404 2月 14 08:30 id_rsa.pub
-rw-r\--r\-- 1 root root 6424 3月 5 17:01 known_hosts
3.  **拷贝id_rsa私钥文件给别的主机免密登录**
\[root@room9pc01 \~\]# cd /root/.ssh
\[root@room9pc01 .ssh\]# ls
authorized_keys id_rsa id_rsa.pub known_hosts
\[root@room9pc01 .ssh\]# scp id_rsa 192.168.4.51:/root/.ssh
\[root@sql51 \~\]# ls ./.ssh -l
总用量 8
-rw-r\--r\--. 1 root root 1675 3月 6 16:52 id_rsa
\[root@sql51 \~\]# ssh PI:EMAIL
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@ WARNING: UNPROTECTED PRIVATE KEY FILE! @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
Permissions 0644 for \'/root/.ssh/id_rsa\' are too open.
It is required that your private key files are NOT accessible by others.
This private key will be ignored.
Load key \"/root/.ssh/id_rsa\": bad permissions
Permission denied (publickey,gssapi-keyex,gssapi-with-mic).
解决方法：
系统提示说644对私钥文件来说太奔放了，不够私密.后面两个4代表的含义为：同组的小伙伴可以读，其他小伙伴也可以读。这怎么能行，果断收掉他们的权限，改为600。so执行以下命令就ok啦。
\[root@sql51 \~\]# chmod 0600 /root/.ssh/id_rsa
\[root@sql51 \~\]# ssh PI:EMAIL
Last login: Wed Mar 6 17:04:25 2019 from 192.168.4.254
\[root@client-50 \~\]# exit
登出
Connection to 192.168.4.50 closed.
\[root@sql51 \~\]# ll /root/.ssh/id_rsa
-rw\-\-\-\-\-\--. 1 root root 1675 3月 6 16:52 /root/.ssh/id_rsa
# 4：SELinux安全防护
SELinux(Security-Enhanced Linux)
是美国国家安全局（NSA）对于强制访问控制的实现，是
Linux历史上最杰出的新安全子系统。NSA是在Linux社区的帮助下开发了一种访问控制体系，在这种访问控制体系的限制下，进程只能访问那些在他的任务中所需要文件。
SELinux是一种基于 域-类型
模型（domain-type）的强制访问控制（MAC）安全系统，它由NSA编写并设计成内核模块包含到内核中，相应的某些安全相关的应用也被打了SELinux的补丁，最后还有一个相应的安全策略。任何程序对其资源享有完全的控制权。假设某个程序打算把含有潜在重要信息的文件扔到/tmp目录下，那么在DAC情况下没人能阻止他。SELinux提供了比传统的UNIX权限更好的访问控制。
## SELinux的运行模式
enforcing(强制):已强制执行SELinux安全策略。
permissive(宽松):SELinux打印警告而不是强制执行
disabled(彻底禁用) :未加载SELinux策略。
变成disabled状态,必须配置/etc/selinux/config文件并重起系统
• 切换运行模式
-- 临时切换:setenforce 1\|0 1为enforcing模式 0为permissive模式
-- 查看当前模式:getenforce
-- 固定配置:/etc/selinux/config 文件
## 查看SElinux状态
\[root@sql51 \~\]# sestatus
SELinux status: enabled
SELinuxfs mount: /sys/fs/selinux #相关文件
SELinux root directory: /etc/selinux #工作根目录
Loaded policy name: targeted
Current mode: permissive #当前模式permissive(宽松)
Mode from config file: permissive
Policy MLS status: enabled
Policy deny_unknown status: allowed
Max kernel policy version: 28
## 当前类型
\[root@client-50 \~\]# vim /etc/sysconfig/selinux
SELINUX=permissive
SELINUXTYPE=targeted #当前类型
targeted:有针对性的保护当前机器的常用服务(目标流程受到保护).
minimum: 最低限度修改目标政策。仅保护选定的进程。
mls:全部保护(多级安全保护).
# 5：SELinux策略设置
## -Z查看安全上下文(标签)
加 -Z 查看
\[root@client-50 \~\]# ps aux -Z \| grep httpd
system_u:system_r:httpd_t:s0 root 962 0.0 0.8 232560 8844 ? Ss 09:10
0:01 php-fpm: master process (/etc/php-fpm.conf)
\[root@client-50 \~\]# ps aux \| grep httpd #不加-Z区别
root 3781 0.0 1.2 312900 12212 ? Ss 11:54 0:01 /usr/sbin/httpd
-DFOREGROUND
\[root@client-50 \~\]# ls -lZ /etc/passwd
-rw-r\--r\--. root root system_u:object_r:passwd_file_t:s0 /etc/passwd
\[root@client-50 \~\]# ll -dZ /var/www/html/
drwxr-xr-x. root root system_u:object_r:httpd_sys_content_t:s0
/var/www/html/
\[root@client-50 \~\]# ll -dZ /var/lib/mysql
drwxr-x\--x. mysql mysql unconfined_u:object_r:mysqld_db_t:s0
/var/lib/mysql
用户:角色:访问类型:选择
system_u:system_r:httpd_t:s0
system_u:object_r:passwd_file_t:s0
system_u:object_r:httpd_sys_content_t:s0
## chcon工具修改安全上下文(标签)
使用chcon工具
-t :指定访问类型
-R:递归修改
一般操作规律
移动的文件,会保持原有的上下文属性不变
复制的文件,会自动继承目标目录的访问类型
新建的文件,会自动继承父目录的访问类型
\]# chcon -t 访问类型 文件
\# chcon -R -t 访问类型 目录
\]# chcon -t httpd_sys_content_t a2.html
\]# chcon -R -t httpd_sys_content_t /var/www/html
恢复所在位置的默认上下文属性
\]# restorecon /var/www/html/a2.html
\]# restorecon -R /var/www/html
# 6调整SELinux布尔值 
功能开关,
查看SELinux布尔值
设置SELinux布尔值
例如:修改布尔值,允许ftp匿名上传文件,50为ftp服务器,51为客户端
\[root@client-50 \~\]# yum -y install vsftpd
\[root@client-50 \~\]# vim /etc/vsftpd/vsftpd.conf
29 anon_upload_enable=YES
\[root@client-50 \~\]# mkdir /var/ftp/sharedir
\[root@client-50 \~\]# chmod o+w /var/ftp/sharedir
\[root@client-50 \~\]# cp /etc/passwd /var/ftp/sharedir
\[root@client-50 \~\]# systemctl restart vsftpd
\[root@client-50 \~\]# netstat -untlp \| grep :21
tcp6 0 0 :::21 :::\* LISTEN 2179/vsftpd
51主机
\[root@sql51 \~\]# which ftp
/usr/bin/which: no ftp in
(/root/perl5/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin)
\[root@sql51 myload\]# ftp 192.168.4.50
bash: ftp: 未找到命令\...
\[root@sql51 \~\]# mkdir /myload
\[root@sql51 \~\]# cd /myload
\[root@sql51 myload\]# yum -y install ftp
\[root@sql51 myload\]# which ftp
/usr/bin/ftp
\[root@sql51 myload\]# ftp 192.168
ftp: connect: 网络不可达
ftp\> exit
\[root@sql51 myload\]# ftp 192.168.4.50
Connected to 192.168.4.50 (192.168.4.50).
220 (vsFTPd 3.0.2)
Name (192.168.4.50:root): ftp
331 Please specify the password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp\> ls
227 Entering Passive Mode (192,168,4,50,237,86).
150 Here comes the directory listing.
drwxr-xr-x 2 0 0 6 Mar 23 2017 pub
drwxr-xrwx 2 0 0 20 Mar 07 01:16 sharedir
226 Directory send OK.
\[root@sql51 myload\]# ftp 192.168.4.50
Connected to 192.168.4.50 (192.168.4.50).
220 (vsFTPd 3.0.2)
Name (192.168.4.50:root): ftp
331 Please specify the password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp\> ls
227 Entering Passive Mode (192,168,4,50,20,134).
150 Here comes the directory listing.
drwxr-xr-x 2 0 0 6 Mar 23 2017 pub
drwxr-xrwx 2 0 0 20 Mar 07 01:16 sharedir
226 Directory send OK.
ftp\> cd sharedir
250 Directory successfully changed.
ftp\>
ftp\>
ftp\> ls
227 Entering Passive Mode (192,168,4,50,79,150).
150 Here comes the directory listing.
-rw-r\--r\-- 1 0 0 2374 Mar 07 01:16 passwd
226 Directory send OK.
ftp\> get passwd
local: passwd remote: passwd
227 Entering Passive Mode (192,168,4,50,202,41).
150 Opening BINARY mode data connection for passwd (2374 bytes).
226 Transfer complete.
2374 bytes received in 6.6e-05 secs (35969.70 Kbytes/sec)
上传文件
ftp\> lcd /etc
Local directory now /etc
ftp\> put hosts
local: hosts remote: hosts
227 Entering Passive Mode (192,168,4,50,227,75).
553 Could not create file. #上传失败
修改布尔后再上传
\[root@client-50 \~\]# setsebool -P ftpd_anon_write on
\[root@client-50 \~\]# setsebool -P ftpd_full_access on
这两个修改是在ftp上的配置文件中指定的
51上
ftp\> put hosts
local: hosts remote: hosts
227 Entering Passive Mode (192,168,4,50,156,12).
150 Ok to send data.
226 Transfer complete.
158 bytes sent in 3.9e-05 secs (4051.28 Kbytes/sec) #上传成功
# 7查看SELinux日志排错
\[root@client-50 \~\]# rpm -qa \|grep -i setroubles
setroubleshoot-3.2.28-3.el7.x86_64
setroubleshoot-server-3.2.28-3.el7.x86_64
setroubleshoot-plugins-3.0.65-1.el7.noarch
\[root@client-50 \~\]# rpm -qa \|grep -i setroubleshoot
setroubleshoot-3.2.28-3.el7.x86_64
setroubleshoot-server-3.2.28-3.el7.x86_64
setroubleshoot-plugins-3.0.65-1.el7.noarch
\[root@client-50 \~\]# ls /var/log/messages
#没有单独日志的程序的所有日志记录
/var/log/messages
\[root@client-50 \~\]# grep setroubleshoot /var/log/messages \|tail -1
Mar 7 09:36:42 client-50 setroubleshoot: SELinux is preventing vsftpd
from write access on the directory sharedir. For complete SELinux
messages run: sealert -l 96d20b8c-e48f-43d6-9e38-4598fac41003
翻译
3月7日09:36:42 client-50
setroubleshoot:selinux正在阻止vsftpd对目录sharedir进行写访问。对于完整的SELinux消息，请运行：sealert-l
96d20b8c-e48f-43d6-9e38-4598fac41003
例子:启动SELinux
后(selinux的端口策略为80),设置本机网站httpd服务端口8060,
\[root@client-50 \~\]# getenforce
Enforcing #强制执行模式
\[root@client-50 \~\]# vim /etc/httpd/conf/httpd.conf
Listen 8060
\[root@client-50 \~\]# systemctl start httpd
#修改httpd配置文件断口,启动报错
Job for httpd.service failed because the control process exited with
error code. See \"systemctl status httpd.service\" and \"journalctl
-xe\" for details.
\[root@client-50 \~\]# grep setroubleshoot /var/log/messages \| tail -1
#查看报错
Mar 7 09:55:37 client-50 setroubleshoot: SELinux is preventing
/usr/sbin/httpd from name_bind access on the tcp_socket port 8060. For
complete SELinux messages run: sealert -l
869458fb-03ac-4cdc-9b21-5ccd5f78752b
\[root@client-50 \~\]# sealert -l 869458fb-03ac-4cdc-9b21-5ccd5f78752b
\....
\# **semanage port -a -t PORT_TYPE -p tcp 8060 #日志显示解决办法**