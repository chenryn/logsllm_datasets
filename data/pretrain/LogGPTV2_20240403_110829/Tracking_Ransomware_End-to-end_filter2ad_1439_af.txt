i
t
a
u
m
u
C
l
w
s
e
s
s
e
r
d
d
a
P
100%
80%
60%
40%
20%
0%
0
25
50
75
Partner ID
100
Number of hours between
Packet A and C
I
(a)
(b)
Fig. 10: (a) A histogram that shows that number of infected
IP addresses per Cerber partners. (b) The time from observing
Packet A at a given IP address to observing Packet C at the
same IP address.
services and whose subscribers happen to be widely infected
with Cerber. This uncertainty highlights some of the challenges
of distinguishing real infections from sandbox trafﬁc.
Distribution of partners: Based on our own execution of
Cerber’s two binaries in Section VI-A, it appears that the
Partner ID might be persistent across binaries. As Cerber is
known to operate in the afﬁliate model [11], it is likely that
a partner is an afﬁliate that distributes a particular binary in
exchange of a percentage of ransom revenue; the Partner ID
thus offers a possible insight on the number of infected IP
addresses for each afﬁliate.
We extract the Partner ID from Packets A or B for each
infected IP address and present
the number of unique IP
addresses for each partner in Figure 10a. In particular, Partner
0 infected 253 distinct IP addresses while Partner 1 infected
162. We observe a total of 118 partners, but Partners 0 through
7 account for 51.5% of all infected IP addresses. Each of these
8 partners are associated with between 13 and 33 infected
countries across the world. Identifying major afﬁliates could
be useful for prioritizing which afﬁliates to investigate and
target for technical and law enforcement based interventions.
Duration of encryption: Recall, from Section VI-A, that
the Cerber binary sends Packets A before encrypting user
ﬁles, and when the encryption is complete, the binary sends
Packets C. The duration between Packets A and C allows us to
measure how long it takes for encryption of ﬁles to complete;
the shorter the duration, the smaller the window is between
infection and when the malware needs to be detected before
all ﬁles are encrypted.
it would be difﬁcult
In order to compute this duration, we ﬁrst
identify IP
addresses that are associated with exactly one Machine ID.
If an IP address is associated with multiple Machine IDs,
then there could be multiple Packets A and multiple Packets
C;
to determine which Packets A-C
pair belongs in the same infection. Using IP addresses each
with a single Machine ID reduces this error, although what
appears to be a pair of Packets A and C could come from
different infections due to packet losses. Absent ground-truth,
we assume that Packets A and C, in this case, likely mark the
beginning and end of encryption for a single infection.
In total, 412 IP addresses are associated with a single
Machine ID, but we have received both Packets A and C from
only 182 of the IP addresses. For these 182 IP addresses, we
plot the distribution of the encryption duration in Figure 10b.
The median duration is 7.8 minutes. In other words, if a
victim ﬁnds that one of his ﬁle is encrypted, she has less
than 7.8 minutes to back up other documents before they are
all encrypted. Alternatively, if the victim uses software that
automatically detects ransomware encryption — for instance,
using techniques proposed by Kharaz et al [36] — then the
detection algorithm has less than 7.8 minutes to react.
VII. DISCUSSION
It is widely known that ransomware causes harm to many
people either through monetary losses or destruction of ﬁles.
This threat is challenging to measure, but an improved un-
derstanding of the ransomware ecosystem is a key ﬁrst step
to identifying new and potentially more effective intervention
strategies. Based on our measurements, we propose a multi-
pronged strategy to improve our ability to measure and reduce
the harm caused by ransomware. In this section, we outline
our ideas and discuss looming hurdles, including ethical issues
that are unique to ransomware. A full investigation of our
suggestions will require signiﬁcant future work.
Estimating conversion: One open question that remains
unanswered in this paper is conversion. Given an infection,
what is the probability that a victim might pay the ransom? The
telemetry data that we collected in Section VI could have been
used to estimate the conversion rate of Cerber, but it involves
ethical problems that caused us to decide against performing
this analysis.
Speciﬁcally, Cerber’s telemetry gives us indirect access
to individual victims’ payment record (or the lack thereof).
After the ransomware ﬁnishes the encryption, the ransom note
automatically appears on the victim’s desktop and asks the
victim to visit a set of ransom payment websites. The URLs
are in the form of http://id1.hostname/id2, where id1
is the hidden service ID shared across multiple infections (as
victims can make payments via Tor at http://id1/id2 as
well), and id2 concatenates the Partner ID and Machine ID,
along with an MD5-based checksum (which we discovered in
our own reverse engineering of the binary). To pay, the victim
visits one of the URLs and sees a webpage customized for the
victim. The webpage contains id2, a Bitcoin ransom address
unique to the victim, and the ransom amount. A ﬁve day
countdown is started when a victim visits the page for the ﬁrst
time; afterwards, the ransom doubles (based on our experience
with synthetic victims). Our telemetry data’s Packets B contain
both the Partner IDs and Machine IDs, enabling us to compute
id2 and, in theorey, visit the victim’s payment URL to check
if and when the victim paid.
However, we did not conduct this analysis, since visiting the
URL might cause harm to victims. If we visit the URL before
the victim visits,
immediately,
the countdown would start
629
Authorized licensed use limited to: IEEE Xplore. Downloaded on March 18,2021 at 12:36:14 UTC from IEEE Xplore.  Restrictions apply. 
which might cause the victim to have to pay double the ransom
amount. One strategy is to wait for several months after our
data collection in February 2017 before we visit the victims’
URLs. Regardless of how long we wait, we cannot guarantee
that all victims would have either visited the payment URLs or
decided to re-install their systems during this period. As such,
the risks of the analysis outweigh the beneﬁt of estimating the
conversion rate.
Coverage limitations: Our measurement techniques provided
improved coverage over prior techniques, but it is still not
complete. One of the main limitations is that our transaction
ﬁltering methods were not effective for some ransomware
families, such as those that had a dynamic pricing structure or
for which we did not know the ransom amount (e.g., Spora).
Another limitation was that, for ransomware campaigns where
we did not have a binary or that were no longer operating, we
could not generate synthetic victims and make micropayments.
We plan on exploring improved ﬁltering techniques to cover
more families. We are also exploring OCR and NLP methods
for ﬁnding more reported payments from victims to improve
coverage of ransomware measurement.
We will also continue to investigate methods of tracing
additional cash-outs that traverse mixers or use other methods
of obfuscating ﬂows of bitcoins. This is key to increasing the
risk of liquidating ransomware proﬁts.
Intervention: Our measurement study indentiﬁed potential
intervention beyond improved ransomware detection and back-
ing up of ﬁles, such as increasing the difﬁculty and risk when
ransomware operators cash out their bitcoins. Our methods
of tracing ransomware payment assist in this objective; in-
deed BTC-e’s operator was arrested and the exchange was
closed [37].
Another potential intervention point is to disrupt a victim’s
ability to pay the ransom. During our analysis of Cerber, we
found that the hostname part of Cerber’s payment URL is
generated using a domain-generation algorithm (DGA). Based
on our analysis, the hostname is the preﬁx of the most recent
wallet address that receives and sends bitcoins from and to
w, another wallet address likely controlled by Cerber. This
DGA creates an opportunity for us to disrupt the payment
infrastructure. We could prevent victims from being able to
pay the ransom by using our own wallet addresses to send
bitcoins to w, which would have created new hostnames
to divert victim visits from Cerber’s payment infrastructure.
However, we chose not to conduct this intervention, since it
would have also prevented victims from recovering their ﬁles.
This introduces a unique ethical issue. We must consider
the impact on victims before taking down ransomware in-
frastructure. Whereas disrupting conventional malware reduces
the damage on victims, the effect could be the opposite for
ransomware. Any attempts to prevent ransom payment could
be risky. Herein lies a common ransomware dilemma: If every
victim did not pay or was prevented from paying, the scale
of the problem would likely decrease; however, this would
mean that some individuals would incur additional harm by
not being able to recover their ﬁles.
VIII. RELATED WORK
The initial Bitcoin tracing method that links together ﬂows
with multiple input transactions was proposed in prior stud-
ies [38], [39], [5] and in the original paper proposing Bit-
coin [24]. However, this method is now prone to incorrectly
linking ﬂows that use anonymization techniques, such as
CoinJoin [23], [40] and CoinSwap [41]. Moser and Bohme
[42] developed methods of detecting likely anonymized trans-
actions. We use Chainalysis’s platform, which uses all these
methods and additional proprietary techniques to detect and
remove anonymized transactions, to trace ﬂows of bitcoins.
BitIodine is a Bitcoin forensic analysis tool which used
reported victim ransom payments to perform a payment anal-
ysis for a single ransomware family, CryptoLocker [7]. A
followup study by Liao Et. Al. [6] performed an expanded
analysis of CryptoLocker by discovering additional reported
victim ransom payments and further analyzing whether an
inﬂow is a likely victim payment (similar to our Filter 1).
Finally, researchers from FireEye performed an analysis of
the actual conversion rate of infections to paying victims for
TeslaCrypt [43]. The data source for the FireEye study was
not explicitly mentioned, but was likely the backend database
for TeslaCrypt that was either leaked or seized.
Intervention strategies include technical solutions, such as
detecting changes on the ﬁle system as a result of ransomware
infection [36] and analyzing network trafﬁc [44]; or economic
solutions, such as disrupting the payment processors [45].
We use BinDiff [31] to identify similar malware binaries.
Other related methods include SigMal [46].
IX. CONCLUSION
Our study of the ransomware ecosystem illustrates that the
phenomenon of cybercriminals increasingly using Bitcoin for
payments produces an opportunity to gain key insights into the
ﬁnancial inner workings of these operations. We have created
a set of measurement methodologies and used them to conduct
a detailed two year end-to-end examination of the ransomware
ecosystem. Our methods allowed us to track ransom payments
from the acquisition of bitcoins by victims, to the cash-out
of bitcoins by the ransomware operators. We were able to
conservatively estimate that
the overall ecosystem revenue
for the past two years was over 16 million USD extorted
from on the order of 20,000 victims. Our ensuing analysis of
ransomware operators’ cash-out strategies indicated that BTC-
e was a key piece of support infrastructure that was used to
exchange millions of USD worth of ill-gotten bitcoins into ﬁat
currency. Our study also illuminates many open technical and
ethical issues to measuring and intervening on the ransomware
ecosystem.
ACKNOWLEDGMENTS
This work was funded in part by the National Science Foundation through
CNS-1619620, CNS-1717062, and CNS-1629973, and by gifts from Comcast
and Google. We thank Melissa McCoy, Kurt Thomas, and Geoffrey M.
Voelker for their feedback, and Cindy Moore and Brian Kantor for their
technical assistance.
630
Authorized licensed use limited to: IEEE Xplore. Downloaded on March 18,2021 at 12:36:14 UTC from IEEE Xplore.  Restrictions apply. 
REFERENCES
[1] Wismer, David. Hand-To-Hand Combat With The Insidious “FBI
MoneyPak Ransomware Virus”. Forbes,
https://www.forbes.com/sites/davidwismer/2013/02/06/hand-to-hand-
combat-with-the-insidious-fbi-moneypak-ransomware-
virus/#56afdeb1504a, 2013.
[2] Nicolas Christin. Traveling the Silk Road: A Measurement Analysis of
a Large Anonymous Online Marketplace. CoRR, abs/1207.7139, 2012.
[3] Rebecca S Portnoff, Danny Yuxing Huang, Periwinkle Doerﬂer, Sadia
Afroz, and Damon McCoy. Backpage and bitcoin: Uncovering human
trafﬁckers. In Proceedings of the 23rd ACM SIGKDD International
Conference on Knowledge Discovery and Data Mining, pages
1595–1604. ACM, 2017.
[4] Ryan Brunt, Prakhar Pandey, and Damon McCoy. Booted: An
Analysis of a Payment Intervention on a DDoS-for-Hire Service. In
Workshop on the Economics of Information Security, 2017.
[5] Sarah Meiklejohn, Marjori Pomarole, Grant Jordan, Kirill Levchenko,
Damon McCoy, Geoff Voelker, and Stefan Savage. A Fistful of
Bitcoins: Characterizing Payments Among Men with No Names. In
Proceedings of the ACM Internet Measurement Conference, 2013.
[6] K. Liao, Z. Zhao, A. Doupe, and G. J. Ahn. Behind closed doors:
measurement and analysis of CryptoLocker ransoms in Bitcoin. In
2016 APWG Symposium on Electronic Crime Research (eCrime),
pages 1–13, June 2016.
[7] Michele Spagnuolo, Federico Maggi, and Stefano Zanero. BitIodine:
Extracting Intelligence from the Bitcoin Network. In Financial
Cryptography and Data Security: 18th International Conference, FC,
pages 457–468, 2014.
[8] Damon McCoy, Andreas Pitsillidis, Grant Jordan, Nicholas Weaver,
Christian Kreibich, Brian Krebs, Geoffrey M Voelker, Stefan Savage,
and Kirill Levchenko. Pharmaleaks: Understanding the business of
online pharmaceutical afﬁliate programs. In Proceedings of the 21st
USENIX conference on Security symposium, pages 1–1. USENIX
Association, 2012.
[9] Shuang Hao, Kevin Borgolte, Nick Nikiforakis, Gianluca Stringhini,
Manuel Egele, Michael Eubanks, Brian Krebs, and Giovanni Vigna.
Drops for stuff: An analysis of reshipping mule scams. In Proceedings
of the 22nd ACM SIGSAC Conference on Computer and
Communications Security, pages 1081–1092. ACM, 2015.
[10] Brett Stone-Gross, Ryan Abman, Richard A Kemmerer, Christopher
Kruegel, Douglas G Steigerwald, and Giovanni Vigna. The
underground economy of fake antivirus software. In Economics of
information security and privacy III, pages 55–78. Springer, 2013.
[11] CerberRing: An In-Depth Expose on Cerber Ransomware-as-a-Service.
Check Point Blogs,
https://blog.checkpoint.com/2016/08/16/cerberring/, 2016.
[12] Ransomware in Action. https://www.tmsi.hu/antidotum-
prezentaciok/antidotum-2017-r1/Ransomware presentation DP.pdf ,
2017.
[13] Danny Palmer. Now Cerber ransomware wants to steal your Bitcoin
wallets and passwords too. http://www.zdnet.com/article/now-cerber-
ransomware-wants-to-steal-your-bitcoin-wallets-and-passwords-too/.
[14] John Kevin Adriano. Fake invoice email with HTML attachment
spreads Locky ransomware.
https://www.trendmicro.com/vinfo/us/threat-encyclopedia/spam/3621/
fake-invoice-email-with-html-attachment-spreads-locky-ransomware.
[15] Lawrence Abrams. Researcher ﬁnds the Karma Ransomware being
distributed via Pay-per-Install Network.
https://www.bleepingcomputer.com/news/security/researcher-ﬁnds-the-
karma-ransomware-being-distributed-via-pay-per-install-network/,
2016.
[16] Lily Hay Newman. Petya Ransomware Hackers Didn’t Make
WannaCry’s Mistakes.
https://www.wired.com/story/petya-ransomware-wannacry-mistakes/.
[17] Kan, Michael. Paying the WannaCry ransom will probably get you
nothing. Here’s why.
https://www.pcworld.com/article/3196880/security/paying-the-
wannacry-ransom-will-probably-get-you-nothing-heres-why.html.
[18] Ducklin, Paul. “Locky” ransomware what you need to know.
https://nakedsecurity.sophos.com/2016/02/17/locky-ransomware-what-
you-need-to-know/.
[19] Malwarebytes Labs. Explained: Spora ransomware. https:
//blog.malwarebytes.com/threat-analysis/2017/03/spora-ransomware/.
[20] ID Ransomware. https://id-ransomware.malwarehunterteam.com/.
[21] VmRay. http://vmray.com.
[22] Cloud Vision API. https://cloud.google.com/vision/.
[23] Tim Rufﬁng, Pedro Moreno-Sanchez, and Aniket Kate. Coinshufﬂe:
Practical decentralized coin mixing for bitcoin. In 19th European
Symposium on Research in Computer Security - Volume 8713,
ESORICS 2014, pages 345–364, New York, NY, USA, 2014.
Springer-Verlag New York, Inc.
[24] Satoshi Nakamoto. Bitcoin: A peer-to-peer electronic cash system.
Consulted, 1(2012):28, 2008.
[25] S. Goldfeder, H. Kalodner, D. Reisman, and A. Narayanan. When the
cookie meets the blockchain: Privacy risks of web payments via
cryptocurrencies. ArXiv e-prints, August 2017.
[26] H. Kalodner, S. Goldfeder, A. Chator, M. M¨oser, and A. Narayanan.
BlockSci: Design and applications of a blockchain analysis platform.
ArXiv e-prints, September 2017.
[27] Google Trends. https://trends.google.com/trends/.
[28] VirusTotal. http://virustotal.com.
[29] Yara rule dataset. https://github.com/Yara-Rules/rules.
[30] VXClass. https://www.zynamics.com/vxclass.html.
[31] BinDiff manual.
https://www.zynamics.com/bindiff/manual/#chapUnderstanding.
[32] Cerber version 6 shows how far the ransomware has come.
http://blog.trendmicro.com/trendlabs-security-intelligence/cerber-
ransomware-evolution/.
[33] Tomas Meskauskas. CryptXXX Ransomware.
https://www.pcrisk.com/removal-guides/9963-cryptxxx-ransomware.
[34] David Dagon, Cliff Changchun Zou, and Wenke Lee. Modeling Botnet
Propagation Using Time Zones. In Proceedings of the 13th Annual
Symposium on Network and Distributed System Security, 2006.
[35] MaxMind. GeoIP2 Precision Insights Service.
https://www.maxmind.com/en/geoip2-precision-insights.
[36] Amin Kharaz, Sajjad Arshad, Collin Mulliner, William Robertson, and
Engin Kirda. UNVEIL: A large-scale, automated approach to detecting
ransomware. In 25th USENIX Security Symposium (USENIX Security
16), pages 757–772, Austin, TX, 2016. USENIX Association.
[37] Russian National And Bitcoin Exchange Charged In 21-Count
Indictment For Operating Alleged International Money Laundering
Scheme And Allegedly Laundering Funds From Hack Of Mt. Gox.
https://www.justice.gov/usao-ndca/pr/russian-national-and-bitcoin-
exchange-charged-21-count-indictment-operating-alleged, 2017.
[38] Elli Androulaki, Ghassan O. Karame, Marc Roeschlin, Tobias Scherer,
and Srdjan Capkun. Evaluating User Privacy in Bitcoin, pages 34–51.
Springer Berlin Heidelberg, 2013.
[39] Dorit Ron and Adi Shamir. Quantitative Analysis of the Full Bitcoin
Transaction Graph. In Proceedings of Financial Cryptography 2013,
2013.
[40] Gregory Maxwell. CoinJoin: Bitcoin Privacy for the Real World.
https://bitcointalk.org/index.php?topic=279249.0, 2013.
[41] Gregory Maxwell. CoinSwap: Transaction graph disjoint trustless
trading. https://bitcointalk.org/index.php?topic=321228.0, 2013.
[42] M. M¨oser and R. B¨ohme. Anonymous Alone? Measuring Bitcoin’s
Second-Generation Anonymization Techniques. In 2017 IEEE
European Symposium on Security and Privacy Workshops (EuroS PW),
pages 32–41, April 2017.
[43] Nart Villeneuve. TeslaCrypt: Following the Money Trail and Learning
the Human Costs of Ransomware.
https://www.ﬁreeye.com/blog/threat-
research/2015/05/teslacrypt followin.html, 2015.
[44] K. Cabaj and W. Mazurczyk. Using Software-Deﬁned Networking for
Ransomware Mitigation: The Case of CryptoWall. IEEE Network,
30(6):14–20, November 2016.
[45] Kirill Levchenko, Andreas Pitsillidis, Neha Chachra, Brandon Enright,
M´ark F´elegyh´azi, Chris Grier, Tristan Halvorson, Chris Kanich,
Christian Kreibich, He Liu, et al. Click trajectories: End-to-end
analysis of the spam value chain. In Security and Privacy (SP), 2011
IEEE Symposium on, pages 431–446. IEEE, 2011.
[46] Dhilung Kirat, Lakshmanan Nataraj, Giovanni Vigna, and B. S.
Manjunath. Sigmal: A static signal processing based malware triage.
In Proceedings of the 29th Annual Computer Security Applications
Conference, ACSAC ’13, pages 89–98, New York, NY, USA, 2013.
ACM.
631
Authorized licensed use limited to: IEEE Xplore. Downloaded on March 18,2021 at 12:36:14 UTC from IEEE Xplore.  Restrictions apply.