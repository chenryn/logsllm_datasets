Weex直播间时，旧逻辑是同时初始化竖屏下的布局和横屏下的布局，耗时比较长。
278 > 9年双11：互联网技术超级工程
我们的修改是进入直播间时只初始化竖屏下需要的组件，将横屏下需要的组件延迟加
载，真正需要时才创建和初始化。
优化冗余布局
优化减少Layout层级，将设置Visibility为gone的冗余View全部删除。
此外，Weex直播会场页也做了大量的层级/View精简的动作，两者结合起来最
终使得加载体验有了很大的提高。
飘赞动画优化
直播间的点赞图标是一个Native封装的Weex Component，当用户手动点击
或者收到其他用户的点赞推送时，点在图标会飘出若干个红心或者服务端下发的其他
图片。
粗略一看点赞功能实现的没有什么问题，但是在晚会预演的高并发条件下问题就
暴露出来了，由于用户量太大，点赞推送消息太多，Android端的点赞动画会变得非
常卡顿。
我们的解决办法是做了一个Orange开关，在较低性能的机器上减少或者屏蔽飘
赞动画；收到点赞消息推送后，不再立即飘出点赞动画，而是点赞数大于某个阈值，
或者大于某个时间间隔才飘出动画，减少端上的渲染压力。
此外，我们注意到飘赞动画是飘出显示区域之后直接销毁，需要飘出新动画时再
创建新的图片，我们有考虑引入对象池的技术预先分配一些动画帧并复用，但是由于
时间关系未能发布到线上。
减轻服务端压力
1. zcache将Weex bundle JS，图片等静态资源通过zcache推送到客户端上。
（1）减轻了猫晚当天，客户端请求服务端拉取资源的压力
（2）由于待请求的资源就在本地，大大提高了页面渲染的速度
（3）提高了页面加载成功率
2. 请求合并由于某些mtop接口功能庞杂，Weex和Native代码都要请求，
新体验  9年双11：互联网技术超级工程
余温
以双十一直播会场为基础，依据老的标准直播间样式重写了一份皮肤之后，
Weex直播间已经在优酷直播业务中全量上线，老的Native直播间已经下线。我们
为双十一Weex直播间开发的各种互动玩法已经落地为优酷直播的常态化运营手段。
此次双十一猫晚直播是优酷历史上采用Weex承接的规模最大的项目，也是阿
里历史上直播在线人数最高的项目。在各部门的通力合作之下，整个晚会的直播任务
运行平稳，没有出现任何意外情况。
在当前的双十一直播会场成果基础上，Weex直播间不仅承担了目前线上全部的
优酷直播业务，还会承担即将到来的跨年晚会，春节联欢晚会的直播任务，直播团队
还将推出更多酷炫的互动玩法，更加流畅的直播加载体验，敬请期待。
新体验  9年双11：互联网技术超级工程
但是，如果明星们只是一如既往地呆在电视机里，那就太没有新意了。能不能让
电视机里的明星走下舞台，甚至是进到每一个观众的家里去，和观众实现零距离互
动呢？
范冰冰“瞬间移动”到你家
在这次晚会中，观众只要在手机上点一下按钮，就能把明星“请”到自己家里拍
照、互动。
原来，阿里工程师首次把真人三维建模和动作捕捉技术运用到了国内的手机平台，
把明星的动作甚至表情细节都进行了逼真的还原，再通过特殊加密算法将模型文件压
缩在20M左右，同时巧妙地将AR技术与VR全景技术结合，实现了用技术将明星
通过AR技术投射到真实场景，达到和观众面对面、多角度、零距离接触的效果。
机遇与挑战
在接到这样一个项目的时候，整个团队都是很兴奋的，可以把一种新技术带给大
众, 不仅是炫技, 更是技术人心中的一种执念：技术改变世界。
进行技术调研后，我们有了以下顾虑:
新体验  9年双11：互联网技术超级工程
需要熟悉一定的图形学相关知识，开发者上手需要学习成本。
1. 如何创建一个AR+ SLAM的场景？
使用 与标签就可以创建一个AR场景，
而Camera/Renderer/Light等 Redim已经帮助处理无需关心，Tracking也由
Redim的slam算法解决，你所要做的只是在标签上指定一个算法:type=arkit/
planeasmarker/imu就好了。
新体验  9年双11：互联网技术超级工程
3. 基于面还是特征点？
在这个问题上我们反复了很多次，基于特征点有以下问题：
每次启动应用它不知道设备的
●
位置。
长距离和长时间的使用，误差会
●
累计变成drift。
主要体现出的问题还是定位不准
●
确，范爷很容易就在天上了：）
基于面的检测，有以下问题：
面对环境不可辨认，比如纯色的
●
墙，纯色的桌子。
面对室外环境。因为深度传感器
●
有距离限制，空间大小超出限制
就没有深度信息了。
主要体现出的问题是定位时间过
●
长，很容易让用户失去耐心。
为了体现最好的视觉效果，我们最
终还是选择了基于面的检测。
4. 不同算法对应的世界坐标不同，
其单位也不同，这点需要去做统一
处理。 猫晚效果图
新体验 < 287
写在最后
新零售供应链平台：零售终端技术团队持续在日常业务、台网通、线下门店业务
中，基于AR/VR与娱乐互动、客户体验深度结合。期待前端& 客户端人才加入我
们。简历投递邮箱：PI:EMAIL
扫一扫二维码图案，关注我吧
“阿里技术”微信公众号 “阿里技术”官方微博