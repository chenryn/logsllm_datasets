Algorithm 1: Construction of traffic matrix
Input: Topology ğº = (K, E), Server per switch ğ»
Output: Traffic matrix ğ‘‡
1 Q â† âˆ…
2 ğ‘‡ â† 0 âˆˆ R|K|Ã—|K|
3 for ğ‘¢ âˆˆ K \ Q do
4
ğ‘£ â† arg maxğ‘£â€²âˆˆK\Q ğ¿ğ‘¢ğ‘£â€²
(ğ‘¡ğ‘¢ğ‘£, ğ‘¡ğ‘£ğ‘¢) â† (ğ», ğ»)
Q â† Q âˆª {ğ‘¢, ğ‘£}
5
6
7 end
D Proof of Theorem 4.1.
Lemma 8.1. Given a uni-regular topology with total servers ğ‘ and
ğ» servers per switch, for every switch ğ‘¢, the number of switches with
at least ğ‘š hops away from the switch is at least
ğ‘Šğ‘š =
ğ‘
ğ»
âˆ’1âˆ’(ğ‘…âˆ’ğ») (ğ‘… âˆ’ ğ» âˆ’ 1)ğ‘šâˆ’1 âˆ’ 1
ğ‘… âˆ’ ğ» âˆ’ 2
, ğ‘š âˆˆ {1, . . . , ğ‘‘} (10)
where ğ‘‘ is the minimum diameter computed using Moore bound [39].
Proof. Fix switch ğ‘¢. Let ğ‘¦ğ‘– be the number of switches with
distance ğ‘– from switch ğ‘¢. Since every switch has ğ‘… âˆ’ ğ» switch-
to-switch ports, the number of switches with distance 1 from ğ‘¢
is bouned by ğ‘¦1 â‰¤ ğ‘… âˆ’ ğ». The number of switches with distance
ğ‘– hops away from switch ğ‘¢ can be recursively bounded by ğ‘¦ğ‘– â‰¤
(ğ‘… âˆ’ ğ» âˆ’ 1)ğ‘¦ğ‘–âˆ’1 = (ğ‘… âˆ’ ğ» âˆ’ 1)ğ‘–âˆ’1(ğ‘… âˆ’ ğ»), as each ğ‘–-th switch has
one port connecting to (ğ‘– âˆ’ 1)-th switch. Since there are total ğ‘/ğ»
switches, the number of switches with at least ğ‘š hops away from
switch ğ‘¢ is ğ‘
ğ‘–=1 ğ‘¦ğ‘– and is at least
ğ» âˆ’ 1 âˆ’ğ‘šâˆ’1
âˆ’ 1 âˆ’ ğ‘šâˆ’1
ğ‘¦ğ‘– â‰¥ ğ‘
ğ»
ğ‘–=1
ğ‘
ğ»
âˆ’ 1 âˆ’ (ğ‘… âˆ’ ğ») (ğ‘… âˆ’ ğ» âˆ’ 1)ğ‘šâˆ’1 âˆ’ 1
ğ‘… âˆ’ ğ» âˆ’ 2
Algorithm 1 generates a traffic matrix with high pair-wise short-
est path length. In each iteration (Line 3-7), from unpicked switches,
it arbitrarily picks a switch ğ‘¢ and then a switch ğ‘£ which maximizes
the shortest path length from ğ‘¢ (Line 4). Then, it updates entries
ğ‘¡ğ‘¢ğ‘£ and ğ‘¡ğ‘£ğ‘¢ of the traffic matrix ğ‘‡ with ğ».
Lemma 8.2. Given a uni-regular topology with total servers ğ‘ and
ğ» servers per switch, Algorithm 1 constructs a traffic matrix with at
least ğ‘Šğ‘š non-zero entries whose shortest path lengths are at least ğ‘š,
for ğ‘š âˆˆ {1, . . . , ğ‘‘}.
Proof. We will show that there are at least ğ‘Šğ‘š non-zero entries
whose shortest path lengths are at least ğ‘š at the end of ğ‘˜ğ‘š-th
iteration of Algorithm 1 for every ğ‘š. Fix ğ‘š and ğ‘Šğ‘š from Lemma 8.1.
Let Qğ‘˜ be the set of switches already picked after ğ‘˜-th iteration
and Q0 = âˆ…. In the ğ‘˜-th iteration, switches ğ‘¢ and ğ‘£ are picked
from unpicked switches in K \ Qğ‘˜âˆ’1 such that ğ‘£ maximizes the
shortest path length from ğ‘¢. Let Vğ‘¢
ğ‘š denote the set of switches
with distance of at least ğ‘š hops from switch ğ‘¢. We observe that
ğ‘š \ Qğ‘˜âˆ’1;
ğ‘š \ Qğ‘˜âˆ’1 is non-empty because
(b) if ğ‘Šğ‘š âˆ’ 2(ğ‘˜ âˆ’ 1) > 0, then Vğ‘¢
ğ‘š| âˆ’ |Qğ‘˜âˆ’1| â‰¥ ğ‘Šğ‘š âˆ’ 2(ğ‘˜ âˆ’ 1) > 0. (We use
|Vğ‘¢
ğ‘š \ Qğ‘˜âˆ’1| â‰¥ |Vğ‘¢
ğ‘š| â‰¥ ğ‘Šğ‘š and the fact that |Qğ‘˜âˆ’1| = 2(ğ‘˜ âˆ’ 1).)
Lemma 8.1 that |Vğ‘¢
ğ‘š \ Qğ‘˜âˆ’1(cid:12)(cid:12) is non-empty, ğ‘£ will be picked from Vğ‘¢
(a) if(cid:12)(cid:12)Vğ‘¢
ğ¿ğ‘¢ğ‘£I [ğ‘¡ğ‘¢ğ‘£ > 0] â‰¥ ğ‘‘
Lemma 8.1, we have
(ğ‘¢,ğ‘£)âˆˆK2
Proof of Theorem 4.1.
ğ‘š=1
ğ‘Šğ‘š.
â–¡
Proof. To prove this theorem, we apply Lemma 8.1 and
Lemma 8.3 to the RHS of Theorem 2.2. We have;
ğœƒâˆ— â‰¤ min
ğ‘‡ âˆˆ Ë†T
2ğ¸
ğ»(ğ‘¢,ğ‘£)âˆˆK2 ğ¿ğ‘¢ğ‘£I [ğ‘¡ğ‘¢ğ‘£ > 0]
ğ» maxğ‘‡ âˆˆ Ë†T(ğ‘¢,ğ‘£)âˆˆK2 ğ¿ğ‘¢ğ‘£I [ğ‘¡ğ‘¢ğ‘£ > 0] â‰¤ 2ğ¸
(cid:32) (ğ‘… âˆ’ ğ» âˆ’ 1)ğ‘‘ âˆ’ 1
ğ»ğ·
2ğ¸
âˆ’ 1) âˆ’ ğ‘… âˆ’ ğ»
ğ‘… âˆ’ ğ» âˆ’ 2
ğ‘… âˆ’ ğ» âˆ’ 2
ğ‘Šğ‘š = ğ‘‘( ğ‘
ğ»
=
(12)
(cid:33)
âˆ’ ğ‘‘
where
ğ· =
ğ‘‘
ğ‘š=1
A Throughput-Centric View of the Performance of Datacenter Topologies
SIGCOMM â€™21, August 23â€“28, 2021, Virtual Event, USA
From Equation 12 and using the fact that in uni-regular topologies,
2ğ¸ = ğ‘
â–¡
ğ» (ğ‘… âˆ’ ğ»), we have the upper bound in Equation 2.
E Asymptotic behavior of throughput gap
In Â§3.1, we pointed out that the throughput gap for Jellyfish might
be expected to be non-zero in the range 100K â€“ 180K servers, but
could not confirm this because our KSP-MCF implementation does
not scale to these sizes. To be able to quantify the throughput gap
for topologies larger than our computational limit for KSP-MCF, we
compute a lower bound on throughput when routing can exploit all
paths of length equal to or less than the length of the shortest path
plus ğ‘€ (ğ‘€ is a parameter to the lower bound calculation) in Theo-
rem 8.4. Define the theoretical throughput gap to be the difference
between the upper and lower bounds (for a given ğ‘€). Intuitively,
the theoretical throughput gap shows the maximum possible gap
one can expect when using our bound in Theorem 2.2. Figure A.1
shows that the magnitude of the theoretical gap as a function of the
topology size. (we use ğ‘€ = 1; at this setting, each topology has at
least 300 distinct paths between each source-destination pair across
the entire range of topology sizes we have considered, which is
sufficient for our path-based MCF computation Â§H).
Figure A.1 shows that the maximum possible gap at these scales is
going to be smaller than that of 3K â€“ 15K. Moreover, the theoretical
gap decreases as the size of the topology grows. We prove this
observation in Corollary 2 showing that the theoretical throughput
gap approaches zero asymptotically. In other words, for very large
topologies, we expect our throughput bound to match the actual
topology throughput.
Figure A.1: Theoretical throughput gap.
We first start by stating the following assumption that always
holds in all of our experiments.
Assumption 1. Given a traffic matrix ğ‘‡ and a corresponding
solution of our path-based MCF, the ingress capacity of network-
facing ports is saturated by traffic at every switch:
ğ‘‹ğ‘¢(ğ‘‡) + ğœƒ(ğ‘‡) 
ğ‘¡ğ‘£ğ‘¢ = ğ‘…ğ‘¢ âˆ’ ğ»ğ‘¢
ğ‘£âˆˆK\{ğ‘¢}
ğ‘‹ğ‘¢(ğ‘‡) = ğ‘…ğ‘¢
for every ğ‘¢ âˆˆ K
for every ğ‘¢ âˆˆ S \ K,
where ğ‘‹ğ‘¢(ğ‘‡) is the amount of transit traffic on switch ğ‘¢ as a result of
routing the traffic matrix ğ‘‡ . Note that ğ»ğ‘¢ = 0 for every switch with
no servers, and it is omitted in the second equality.
Intuitively, the assumption holds in practice because datacenter
topologies are designed such that all the link capacities can be fully
utilized, as are the ingress capacities. We use this assumption to
prove a bound on throughput gap. Let ğ‘€ denote the additive path
length such that every path length is bounded by
ğ‘™ğ‘’ğ‘›(ğ‘) â‰¤ ğ¿ğ‘¢ğ‘£ + ğ‘€ for every ğ‘ âˆˆ Pğ‘¢ğ‘£, and every (ğ‘¢, ğ‘£) âˆˆ K2.
Theorem 8.4. Under a permutation traffic matrix ğ‘‡ âˆˆ Ë†T , when
Assumption 1 holds with the additive path length ğ‘€ğ‘‡ (depending
on ğ‘‡ ), the maximum achievable throughput of a topology (either
uni-regular or bi-regular) is at least;
ğ‘ ğ‘€ğ‘‡ + ğ»(ğ‘¢,ğ‘£)âˆˆK2 ğ¿ğ‘¢ğ‘£I [ğ‘¡ğ‘¢ğ‘£ > 0] .

(ğ‘…ğ‘¢ âˆ’ ğ»ğ‘¢) âˆ’ ğœƒ(ğ‘‡)

Proof. Let S denote the set of all switches. From Assumption
1, we sum the transit traffic ğ‘‹ğ‘¢(ğ‘‡) over all switches and have the
following equality
ğ‘‹ğ‘¢(ğ‘‡) =

ğœƒ(ğ‘‡) â‰¥
(13)
(14)
ğ‘¡ğ‘£ğ‘¢ .
2ğ¸
ğ‘¢âˆˆS
ğ‘¢âˆˆS
ğ‘¢âˆˆK
ğ‘£âˆˆK\{ğ‘¢}
Note that Assumption 1 changes the inequality in Equation 9 to
equality due to all ingress capacity is fully utilized.
Alternatively, we can compute the total
transit
traffic
(ğ‘¢âˆˆS ğ‘‹ğ‘¢(ğ‘‡)) based on Equation 5;

ğ‘‹ğ‘¢(ğ‘‡) = ğœƒ(ğ‘‡)

ğ‘‹ğ‘¢(ğ‘‡) â‰¤ ğœƒ(ğ‘‡)

ğ‘£âˆˆK\{ğ‘¢}
ğ‘¢âˆˆK
ğ‘¢âˆˆS
ğ‘¢âˆˆS
ğ‘¢âˆˆK

ğ‘¡ğ‘¢ğ‘£
ğ‘âˆˆPğ‘¢ğ‘£

ğ‘¢âˆˆS (ğ‘…ğ‘¢ âˆ’ ğ»ğ‘¢)
ğ‘£âˆˆK\{ğ‘¢}
ğœƒ(ğ‘‡) â‰¥
From Equation 14 and Equation 15, we have
ğ‘¢âˆˆKğ‘£âˆˆK\{ğ‘¢} ğ‘¡ğ‘¢ğ‘£(ğ¿ğ‘¢ğ‘£ + ğ‘€ğ‘‡) .
Finally, using the fact that a)ğ‘¢âˆˆS (ğ‘…ğ‘¢ âˆ’ ğ»ğ‘¢) = 2ğ¸, b) ğ‘‡ is a permu-
tation traffic matrix, c) ğ¿ğ‘¢ğ‘¢ = 0 for every switch ğ‘¢ and d) the sum of
all the entries except the diagonals of the traffic matrix ğ‘‡ is at most
ğ‘ , we can derive the throughput lower bound in Equation 13. â–¡
The above theorem states the lower bound of throughput with
respect to the additive path length ğ‘€ğ‘‡ depending on a given per-
mutation traffic matrix ğ‘‡ . Our path-based MCF computation shows
that ğ‘€ğ‘‡ = 1 is sufficient to provide enough path diversity to make
Assumption 1 valid for all Jellyfish, Xpander and FatClique. Us-
ing Theorem 8.4, we show that the gap between the upper bound
and the lower bound can be arbitrarily small when the network
size is sufficiently large and when a mild assumption holds.
Assumption 2. The additive path length for the maximal permu-
tation traffic matrix Ë†ğ‘‡ does not increase with a topology size such that
ğ‘€ Ë†ğ‘‡ = ğ‘‚(1).
ğ›½ğ‘(ğ‘‡)(ğ‘™ğ‘’ğ‘›(ğ‘) âˆ’ 1).
Since length of all the paths in Pğ‘¢ğ‘£ is at most ğ¿ğ‘¢ğ‘£ + ğ‘€ğ‘‡ from the
definition of the additive path length, we have;
ğ‘¡ğ‘¢ğ‘£(ğ¿ğ‘¢ğ‘£ + ğ‘€ğ‘‡ âˆ’ 1).
(15)
10k100k#Servers (N)0.000.050.100.150.200.250.30Throughput GapSIGCOMM â€™21, August 23â€“28, 2021, Virtual Event, USA
Namyar .et al.
Corollary 2. When Assumptions 1 and 2 hold, for any positive
ğœ– such
value ğœ– > 0, any uni-regular topology with ğ‘ servers has ğ‘âˆ—
that for every ğ‘ â‰¥ ğ‘âˆ—
ğœ– ;
ğœƒâˆ— âˆ’ ğœƒğ‘™ğ‘ â‰¤ ğœ–
where ğœƒâˆ— is the throughput upper bound from Theorem 2.2 and ğœƒğ‘™ğ‘ =
minğ‘‡ âˆˆ Ë†T ğœƒğ‘™ğ‘(ğ‘‡) is the mininum of throughput lower bound ğœƒğ‘™ğ‘(ğ‘‡)
from Theorem 8.4.
Proof. From Assumption 1, it holds for every permutation ma-
trix ğ‘‡ âˆˆ Ë†T that
ğœƒâˆ— âˆ’ ğœƒğ‘™ğ‘(ğ‘‡) â‰¤ ğœƒâˆ— âˆ’ min
ğ‘‡ âˆˆ Ë†T
ğœƒâˆ— âˆ’ min
ğ‘‡ âˆˆ Ë†T
ğœƒğ‘™ğ‘(ğ‘‡) â‰¤