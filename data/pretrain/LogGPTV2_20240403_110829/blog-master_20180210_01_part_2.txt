 43 | 10107301 |  500040498.08918 | 163 | 999999842 | 5054059826377266  
  5 | 10100558 | 499863342.325278 |  31 | 999999940 | 5048898681230323  
 75 | 10101250 | 500037496.222365 |  63 | 999999928 | 5051003758716163  
 97 | 10103503 | 500029746.921376 | 123 | 999999921 | 5052052048109365  
 21 | 10102929 | 500098408.485223 | 446 | 999999926 | 5052458713939206  
 93 | 10105004 | 499972842.513604 |  25 | 999999852 | 5052227573491343  
 60 | 10105650 | 499950744.869079 | 209 | 999999873 | 5052327244886207  
 27 | 10102588 | 499797776.872304 |  41 | 999999858 | 5049251023056813  
 45 | 10100466 | 499847713.021728 |  38 | 999999841 | 5048694830553717  
 70 | 10103640 | 500126978.162685 | 238 | 999999801 | 5053102941643626  
 91 | 10102311 |    499764530.032 |   1 | 999999950 | 5048776709152101  
 22 | 10099804 | 500243130.452219 | 250 | 999999867 | 5052357569913843  
 49 | 10099635 | 500022230.537738 |  19 | 999999896 | 5050042020317004  
 13 | 10100454 | 499986238.143486 |  53 | 999999646 | 5050087999001322  
 86 | 10099751 |  499991374.31582 |   7 | 999999782 | 5049788382737577  
 26 | 10105606 | 500021405.572664 |   6 | 999999938 | 5053019316283545  
  1 | 10095409 | 500001476.917716 | 206 | 999999776 | 5047719410088402  
 58 | 10099972 | 499913934.276812 |  35 | 999999792 | 5049116738605642  
 25 | 10104666 | 500031883.894369 | 137 | 999999510 | 5052655176103381  
 82 | 10101286 | 499966805.257835 |  10 | 999999534 | 5050307690415695  
 44 | 10104380 | 499990027.500454 |   9 | 999999872 | 5052089234075034  
 20 | 10100166 | 500033955.063915 | 130 | 999999908 | 5050425951782085  
 23 | 10099118 | 500033099.525857 |  58 | 999999918 | 5049893276017372  
 92 | 10097628 | 499985682.503551 |  79 | 999999951 | 5048669427246965  
 62 | 10098974 |  500002801.70268 |  33 | 999999765 | 5049515294322520  
 53 | 10104969 | 500071097.824301 |   5 | 999999948 | 5053202941310532  
 56 | 10099521 |  499829373.88272 | 157 | 999999902 | 5048037257945384  
 40 | 10098880 |  500118160.98974 | 202 | 999999731 | 5050633293656069  
 73 | 10102325 | 499981690.451386 |  62 | 999999809 | 5050977530989301  
 95 | 10102589 | 499885307.442653 |  74 | 999999770 | 5050135808231760  
  4 | 10094812 | 499884810.734528 |  37 | 999999815 | 5046243186020638  
 30 | 10097653 | 499985894.883754 | 127 | 999999861 | 5048684071430626  
 77 | 10097737 | 500019227.640071 |  34 | 999999751 | 5049062655652572  
 15 | 10100451 | 499990119.574357 |  86 | 999999946 | 5050125703244929  
 36 | 10097433 | 499910715.309699 |  60 | 999999952 | 5047814953821765  
 94 | 10097423 | 500030504.883845 | 102 | 999999930 | 5049019520715746  
 83 | 10097518 | 499986390.218504 |   8 | 999999777 | 5048621574986367  
 28 | 10102778 | 499892202.902798 | 147 | 999999929 | 5050299949857921  
 48 | 10095113 | 500116265.596128 | 171 | 999999942 | 5048730214330929  
 46 | 10101708 | 499972043.149036 |  24 | 999999878 | 5050571588054961  
 99 |  5051395 | 499818438.433132 |  39 | 999999936 | 2524780360808931  
 47 | 10106118 | 500030970.343216 |  29 | 999999844 | 5053371989943041  
 54 | 10096312 |  500084305.08323 |  77 | 999999934 | 5049007170423474  
 16 | 10104458 | 500003081.506687 |  36 | 999999800 | 5052260136954892  
 80 | 10102160 | 499846266.993651 |  54 | 999999945 | 5049526964572583  
  8 | 10103060 | 500007130.726843 | 136 | 999999891 | 5051602042161142  
(100 rows)  
Time: 9608.447 ms (00:09.608)  
```  
5、CPU资源  
```  
top - 16:25:09 up 30 days, 21:12,  2 users,  load average: 15.10, 6.80, 6.63  
Tasks: 522 total,  57 running, 465 sleeping,   0 stopped,   0 zombie  
%Cpu(s): 99.8 us,  0.2 sy,  0.0 ni,  0.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st  
KiB Mem : 23094336+total,  9608932 free,  5427976 used, 21590646+buff/cache  
KiB Swap:        0 total,        0 free,        0 used. 10311448+avail Mem   
```  
### 2、VOPS瓦片式存储表10亿  
1、创建VOPS表  
```  
create unlogged table b(id vops_int4, c1 vops_int4);    
do language plpgsql $$    
declare    
begin    
  for i in 0..55 loop    
    execute format('create unlogged table b%s (like b) inherits (b)', i);    
  end loop;    
end;    
$$;    
```  
2、将10亿原始数据转换为vops  
```  
do language plpgsql $$    
declare    
begin    
  for i in 0..55 loop    
    perform conn('link'||i,  'hostaddr=127.0.0.1 port=1921 user=postgres dbname=postgres');           
    perform dblink_send_query('link'||i, format('select populate(''b%s''::regclass, ''a%s''::regclass)', i, i));         
  end loop;    
end;    
$$;    
```  
3、数据样例  
```  
postgres=# select * from b0 limit 2;  
-[ RECORD 1 ]----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  
id | {1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64}  
c1 | {91,59,72,18,53,26,86,83,44,82,66,42,7,87,66,29,10,85,49,6,89,98,9,46,93,7,42,61,47,3,5,39,62,77,58,16,4,45,99,49,27,66,90,35,55,58,64,65,44,14,71,34,13,80,80,7,87,23,68,36,26,73,75,88}  
-[ RECORD 2 ]----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  
id | {65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128}  
c1 | {51,33,6,55,78,5,5,7,72,95,41,27,54,6,92,98,19,64,34,32,45,15,39,33,38,9,69,64,82,45,53,34,78,59,90,57,64,94,64,37,91,6,64,46,12,58,45,31,23,79,64,68,94,4,2,33,13,71,97,95,17,51,30,95}  
postgres=# select * from a0 limit 2;  
-[ RECORD 1 ]  
id | 1  
c1 | 91  
-[ RECORD 2 ]  
id | 2  
c1 | 59  
```  
4、空间占用，8.7GB  
```  
postgres=# \dt+ b*  
                    List of relations  
 Schema | Name | Type  |  Owner   |  Size   | Description   
--------+------+-------+----------+---------+-------------  
 public | b    | table | postgres | 0 bytes |   
 public | b0   | table | postgres | 156 MB  |   
 public | b1   | table | postgres | 156 MB  |   
 public | b10  | table | postgres | 156 MB  |   
 public | b11  | table | postgres | 156 MB  |   
 public | b12  | table | postgres | 156 MB  |   
 public | b13  | table | postgres | 156 MB  |   
 public | b14  | table | postgres | 156 MB  |   
 public | b15  | table | postgres | 156 MB  |   
 public | b16  | table | postgres | 156 MB  |   
 public | b17  | table | postgres | 156 MB  |   
 public | b18  | table | postgres | 156 MB  |   
 public | b19  | table | postgres | 156 MB  |   
 public | b2   | table | postgres | 156 MB  |   
 public | b20  | table | postgres | 156 MB  |   
```  
5、vops（瓦片式存储）分片表并行聚合  
```  
create or replace function get_res_vops() returns setof record as $$    
declare    
begin    
  for i in 0..55 loop           
    perform conn('link'||i,  'hostaddr=127.0.0.1 port=1921 user=postgres dbname=postgres');           
    perform 1 from dblink_get_result('link'||i) as t(c1 int, cnt int8, aggs int8[]);          
    perform dblink_send_query('link'||i, format('select (reduce(map(c1, ''min,max,sum'', id,id,id))).* from b%s', i));          
  end loop;       
  for i in 0..55 loop    
    return query select * from dblink_get_result('link'||i) as t(c1 int, cnt int8, aggs int8[]);    
  end loop;    
end;    
$$ language plpgsql strict;    
```  
6、查询耗时，1.97秒  
```  
select c1, sum(cnt), sum(aggs[3])/sum(cnt)::float8, min(aggs[1]), max(aggs[2]), sum(aggs[3]) from ( select * from get_res_vops() as t(c1 int, cnt int8, aggs int8[])) t group by c1;  
postgres=# select c1, sum(cnt), sum(aggs[3])/sum(cnt)::float8, min(aggs[1]), max(aggs[2]), sum(aggs[3]) from ( select * from get_res_vops() as t(c1 int, cnt int8, aggs int8[])) t group by c1;  
 c1 |   sum    |     ?column?     | min |    max    |       sum          
----+----------+------------------+-----+-----------+------------------  
  7 | 10104223 |  500196670.66755 |  13 | 999999922 | 5054098704282486  
 41 | 10098079 | 500105983.312797 |  75 | 999999899 | 5050109727865311  
 72 | 10099035 | 499987853.746656 |   3 | 999999917 | 5049394834562362  
  2 | 10098707 | 500027259.278005 | 119 | 999999881 | 5049628783461600  
 29 | 10101931 | 500172863.741008 |  16 | 999999911 | 5052711757584067  
 71 | 10099125 | 500129933.363706 |  51 | 999999877 | 5050874713281733  
  6 | 10104713 | 500020892.341227 |  20 | 999999943 | 5052567611111995  
 74 | 10098824 | 499966081.890066 | 170 | 999999890 | 5049069466977368  
 38 | 10103601 | 499961610.602928 |  89 | 999999949 | 5051412628849349  
 88 | 10103668 | 499850251.056789 |  64 | 999999780 | 5050320986394444  
 84 | 10105345 |  500042003.07277 | 271 | 999999895 | 5053096955541396  
 68 | 10098999 |   499977042.1773 |  59 | 999999857 | 5049267648971511  
 55 | 10103707 | 499960231.761415 |  45 | 999999850 | 5051451693369436  
 64 | 10102942 | 500113184.404115 |  47 | 999999693 | 5052614495470081  
 24 | 10099982 |  499936812.84724 | 190 | 999999901 | 5049352810894492  
  9 | 10104341 | 499996733.660471 |  23 | 999999915 | 5052137495791580  
 63 | 10102023 | 499895229.112864 | 353 | 999999910 | 5049953102088419  
 98 | 10097327 | 499944814.066904 |  22 | 999999919 | 5048106269587731  
 78 | 10107866 | 500012506.299485 |  69 | 999999740 | 5054059411999348  
 59 | 10099747 | 499892322.509487 |   2 | 999999808 | 5048785984588223  
 18 | 10101977 | 499926956.667668 |   4 | 999999897 | 5050250617936782  
 90 | 10096744 | 500199293.810021 |  43 | 999999875 | 5050384218580567  
 42 | 10101533 | 500126553.670129 |  12 | 999999865 | 5052044886075076  
 79 | 10098900 | 499957103.416255 | 114 | 999999846 | 5049016791690421  
 10 | 10095854 |  500035390.09691 |  17 | 999999719 | 5048284293251445  
 12 | 10105025 | 499832509.132034 | 109 | 999999799 | 5050820000591935  