User: 请解答这个和日志有关的问题Win Server 2008 RDP Attack On one of my machines I run Win 2008 R2 server. It has been recently updated. My RDP session is limited to my IP address only and firewall is UP. Even though the main RDP post 3389 is blocked by firewall ( IP restricted) I am getting 1000's of attempts to break in on range of different ports from 1012 to 63000. I attached the snapshot of the issue. I am getting 1000's of every day so my log file fills up pretty quick.

I am not an expert on win Servers and all I can do at this point is to ad the culprit's IP address to blocked IP's in my firewall. But the IP changes after 500 attempts regularly. My question is, how do I prevent this so I do not have to monitor this server every day? Any help appreciated.

Below is the copy of the event details one of many hack attempts:

EventData 

  SubjectUserSid S-1-5-18 
  SubjectUserName MyServer12$ 
  SubjectDomainName WORKGROUP 
  SubjectLogonId 0x3e7 
  TargetUserSid S-1-0-0 
  TargetUserName administrator 
  TargetDomainName MyServer12 
  Status 0xc000006d 
  FailureReason %%2313 
  SubStatus 0xc000006a 
  LogonType 10 
  LogonProcessName User32  
  AuthenticationPackageName Negotiate 
  WorkstationName MyServer12 
  TransmittedServices - 
  LmPackageName - 
  KeyLength 0 
  ProcessId 0x3114 
  ProcessName C:\Windows\System32\winlogon.exe 
  IpAddress 27.151.120.145 
  IpPort 1214

Assistant: There are a few items in addition to what you've written that I would add.


Rename your admin account - Yes this might be a pain in the ass (especially if you've got services using the domain admin account) however this is a commonly attempted brute force username. Rename this account to something ambiguous that won't easily be guessed. 
Don't use common names for accounts - If you audit the security logs you'll notice that a good chunk of the login names are common names (Administrator, admin, sql, sa, besadmin, guest, etc). Ensure that you are either not using these usernames, or if you need to use the username ensure it doesn't have the rights to logon to your remote desktop server
Enforce an Account Lockout Policy - With your administrator account renamed and your other service accounts renamed or not given access to the remote server, this will disable someone's attempt to login with that username. Make sure you set this as a local policy on the remote server and not a domain policy. Users will attempt the wrong password with your account for X amount of tries, get locked out and move on to the next IP address.
Investigate TS Gateway - TS Gateway allows for your RDP sessions to connect to your network via the standard SSL port of TCP 443. This will allow you to completely shut off port 3389 from the outside world. The one pitfall I've found with this technology is there is no free Mac RDP client that will allow you to utilize TS Gateway so if you have Macs you'll either need to pay for the client or disrergard TS Gateway.
Windows SSHD_Block - A talented SysAdmin by the name of Evan Anderson wrote a nice little VBScript that will block IPs attempting to Brute Force your Terminal server. Check it out HERE


Hope these little tips and tricks help you secure your network.