exist to address them.
6.6 Future Work
One important area for future investigation is to implement other
transport proposals such as TCP-over-DTLS and UDP-OR, in order
to compare their performance to that of PCTCP in large-scale net-
work emulation. Tor’s forthcoming transport abstraction layer [32]
should greatly facilitate this task.
Another area for future work is to consider an alternative queue-
ing design for Tor that reduces the number of times cells are copied.
Indeed, our design eliminates the need for circuit queues as every
input buffer corresponds to single output buffer, which means that
data can be copied immediately from the input buffer to the output
buffer after being encrypted or decrypted.
7. CONCLUSION
In this work, we recognize the importance of the Tor network
as a privacy-preserving tool online and seek to enhance its perfor-
mance for interactive application users. To this end, we propose
PCTCP, a new anonymous communication transport design for Tor
which allows every circuit to use a separate kernel-level TCP con-
nection protected by IPsec. Our design is easily deployable and
requires minimal changes to routers. PCTCP avoids the deploy-
ability and performance problems that were introduced by TCP-
over-DTLS due to the use of a user-level TCP stack. Furthermore,
experimental evaluation of PCTCP shows vast improvement gains,
while maintaining the threat model of the Tor network. Our realistic
large-scale experiments show that it is possible to obtain improve-
ments of more than 60% for response times and approximately 30%
for download times when PCTCP is used, as compared to Tor.
Acknowledgements.
We thank the anonymous reviewers for their helpful comments and
suggestions. We thank NSERC, ORF, and The Tor Project, Inc. for
funding this research.
8. REFERENCES
[1] iPlane: Data. http://iplane.cs.washington.
edu/data/data.html. Accessed Feb. 2013.
[2] Net Index Dataset.
http://www.netindex.com/source-data/.
Accessed Feb. 2013.
[3] OpenSwan. https:
//www.openswan.org/projects/openswan/.
Accessed Feb. 2013.
[4] M. Akhoondi, C. Yu, and H. V. Madhyastha. LASTor: A
Low-Latency AS-Aware Tor Client. In Proceedings of the
2012 IEEE Symposium on Security and Privacy, SP ’12,
pages 476–490, Washington, DC, USA, 2012. IEEE
Computer Society.
[5] M. AlSabah, K. Bauer, and I. Goldberg. Enhancing Tor’s
performance using real-time trafﬁc classiﬁcation. In
Proceedings of the 2012 ACM conference on Computer and
communications security, CCS ’12, pages 73–84. ACM,
2012.
[6] M. AlSabah, K. Bauer, I. Goldberg, D. Grunwald,
D. McCoy, S. Savage, and G. M. Voelker. DefenestraTor:
Throwing out Windows in Tor. In 11th Privacy Enhancing
Technologies Symposium, pages 134–154, July 2011.
[7] J. Appelbaum. Tor and NAT devices increasing bridge &
relay reachability or enabling the use of NATâ ˘A¸SPMP and
UPnP by defaults. https:
//trac.torproject.org/projects/tor/
attachment/ticket/4960/tor-nat-plan.pdf,
August 2012. Accessed Feb. 2013.
[8] K. Bauer, M. Sherr, D. McCoy, and D. Grunwald.
ExperimenTor: A Testbed for Safe and Realistic Tor
Experimentation. In Proceedings of the 4th USENIX
Workshop on Cyber Security Experimentation and Test
(CSET), pages 51–59, August 2011.
[9] P. Boucher, A. Shostack, and I. Goldberg. Freedom Systems
2.0 Architecture. White paper, Zero Knowledge Systems,
Inc., December 2000.
[10] T. Braun, C. Diot, A. Hoglander, and V. Roca. An
Experimental User Level Implementation of TCP. Technical
Report RR-2650, INRIA, Sept. 1995.
[11] Z. Brown. Pragmatic IP Anonymity. http://www.
cypherspace.org/cebolla/cebolla.pdf, June
2002. Accessed Feb. 2013.
[12] T. Dierks and E. Rescorla. RFC 5246â ˘AˇTThe Transport
Layer Security (TLS) Protocol Version 1.2.
http://www.ietf.org/rfc/rfc5246.txt, August
2008.
[13] R. Dingledine. Tor and Circumvention: Lessons Learned. In
Proceedings of the 31st Annual Conference on Advances in
Cryptology (CRYPTO), pages 485–486, August 2011.
[14] R. Dingledine, N. Mathewson, and P. Syverson. Tor: The
Second-Generation Onion Router. In Proceedings of the 13th
USENIX Security Symposium, pages 303–320, August 2004.
[15] R. Dingledine and S. Murdoch. Performance Improvements
on Tor or, Why Tor is Slow and What We’re Going to Do
about It. http://www.torproject.org/press/
presskit/2009-03-11-performance.pdf, March
2009.
[16] A. Edwards and S. Muir. Experiences implementing a high
performance TCP in user-space. In Proceedings of the
conference on Applications, technologies, architectures, and
protocols for computer communication, SIGCOMM ’95,
pages 196–205. ACM, 1995.
[17] D. Gopal and N. Heninger. Torchestra: Reducing Interactive
Trafﬁc Delays over Tor. In Proceedings of the 2012 ACM
Workshop on Privacy in the Electronic Society (WPES 2012),
pages 31–42. ACM, 2012.
[18] R. Jansen, K. Bauer, N. Hopper, and R. Dingledine.
Methodically Modeling the Tor Network. In Proceedings of
the USENIX Workshop on Cyber Security Experimentation
and Test (CSET 2012), August 2012.
[19] R. Jansen and N. Hopper. Shadow: Running Tor in a Box for
Accurate and Efﬁcient Experimentation. In Proceedings of
the 19th Network and Distributed Security Symposium,
February 2012.
[20] R. Jansen, N. Hopper, and Y. Kim. Recruiting New Tor
Relays with BRAIDS. In Proceedings of the 17th ACM
Conference on Computer and Communications Security,
CCS ’10, pages 319–328. ACM, 2010.
[21] R. Jansen, P. Syverson, and N. Hopper. Throttling Tor
Bandwidth Parasites. In 21st USENIX Security Symposium,
August 2012.
[22] S. Kent and R. Atkinson. RFC 2401â ˘AˇTSecurity
Architecture for the Internet Protocol.
http://www.ietf.org/rfcs/rfc2401.txt,
November 1998.
[23] T. Kohno, A. Broido, and K. C. Claffy. Remote Physical
Device Fingerprinting. IEEE Trans. Dependable Secur.
Comput., 2(2):93–108, Apr. 2005.
[24] D. McCoy, K. Bauer, D. Grunwald, T. Kohno, and D. Sicker.
Shining Light in Dark Places: Understanding the Tor
Network. In Proceedings of the 8th Privacy Enhancing
Technologies Symposium, pages 63–76, July 2008.
[25] J. McLachlan, A. Tran, N. Hopper, and Y. Kim. Scalable
Onion Routing with Torsk. In Proceedings of the 16th ACM
conference on Computer and Communications Security, CCS
’09, pages 590–599. ACM, 2009.
[26] P. Mittal, F. Olumoﬁn, C. Troncoso, N. Borisov, and
I. Goldberg. PIR-Tor: Scalable Anonymous Communication
Using Private Information Retrieval. In Proceedings of the
20th USENIX Security Symposium, August 2011.
[27] W. B. Moore, C. Wacek, and M. Sherr. Exploring the
Potential Beneﬁts of Expanded Rate Limiting in Tor: Slow
and Steady Wins the Race with Tortoise. In Proceedings of
the 27th Annual Computer Security Applications Conference
(ACSAC), pages 207–216, December 2011.
[28] S. J. Murdoch. Comparison of Tor Datagram Designs. Tor
Project Technical Report, November 2011.
[29] T.-W. J. Ngan, R. Dingledine, and D. S. Wallach. Building
Incentives into Tor. In Proceedings of Financial
Cryptography, pages 238–256, January 2010.
[30] J. Padhye, V. Firoiu, D. Towsley, and J. Kurose. Modeling
TCP throughput: a simple model and its empirical validation.
In Proceedings of the ACM SIGCOMM ’98 conference on
Applications, technologies, architectures, and protocols for
computer communication, SIGCOMM ’98, pages 303–314.
ACM, 1998.
[31] J. Reardon and I. Goldberg. Improving Tor Using a
TCP-over-DTLS Tunnel. In Proceedings of the 18th USENIX
Security Symposium, August 2009.
[32] A. Shepard. Build abstraction layer around TLS.
https://trac.torproject.org/projects/
tor/ticket/6465. Accessed Feb. 2013.
[33] M. Sherr, M. Blaze, and B. T. Loo. Scalable Link-Based
Relay Selection for Anonymous Routing. In PETS ’09:
Proceedings of the 9th International Symposium on Privacy
Enhancing Technologies, pages 73–93, Berlin, Heidelberg,
2009. Springer-Verlag.
[34] C. Shue, Y. Shin, M. Gupta, and J. Y. Choi. Analysis of
IPSec overheads for VPN servers. In Proceedings of the First
international conference on Secure network protocols,
NPSEC’05, pages 25–30, Washington, DC, USA, 2005.
IEEE Computer Society.
[35] R. Snader and N. Borisov. A Tune-up for Tor: Improving
Security and Performance in the Tor Network. In
Proceedings of the Network and Distributed Security
Symposium (NDSS), February 2008.
[36] A. H. T. Kivinen, B. Swander and V. Volpe. RFC
3947—Negotiation of NAT-Traversal in the IKE.
http://www.ietf.org/rfc/rfc3947.txt,
January 2005.
[37] C. Tang and I. Goldberg. An Improved Algorithm for Tor
Circuit Scheduling. In Proceedings of the 17th ACM
Conference on Computer and Communications Security
(CCS), pages 329–339, October 2010.
[38] The Tor Project. Tor Metrics Portal: Data.
https://metrics.torproject.org/data.
html#performance. Accessed Feb. 2013.
[39] The Tor Project. Tor Metrics Portal: Network. http:
//metrics.torproject.org/network.html.
Accessed Feb. 2013.
[40] F. Tschorsch and B. Scheurmann. How (not) to Build a
Transport Layer for Anonymity Overlays. In Proceedings of
the ACM Sigmetrics/Performance Workshop on Privacy and
Anonymity for the Digital Economy, June 2012.
[41] A. Vahdat, K. Yocum, K. Walsh, P. Mahadevan, D. Kosti´c,
J. Chase, and D. Becker. Scalability and Accuracy in a
Large-scale Network Emulator. SIGOPS Oper. Syst. Rev.,
36(SI):271–284, Dec. 2002.
[42] C. Viecco. UDP-OR: A Fair Onion Transport Design.
http://www.petsymposium.org/2008/
hotpets/udp-tor.pdf, 2008. Accessed Feb. 2013.
[43] T. Wang, K. Bauer, C. Forero, and I. Goldberg.
Congestion-aware Path Selection for Tor. In Proceedings of
Financial Cryptography and Data Security (FC’12),
February 2012.
APPENDIX
A. LARGE-SCALE EXPERIMENTS USING
A HIGHER-BANDWIDTH TOPOLOGY
To observe the effect of PCTCP in a potential future Tor net-
work with more available bandwidth, we construct an experiment
on ExperimenTor using a higher-bandwidth underlying Modelnet
network topology. Our overlay Tor network is a scaled-down net-
work in which we run 400 clients and 20 Tor routers. The ORs are
assigned bandwidth capabilities that are sampled from the band-
width distribution of the live Tor network ORs. We test the per-
formance of PCTCP in this topology using a light trafﬁc load of
39:1 web-to-bulk client ratio, and using a high trafﬁc load of 9:1
web-to-bulk client ratio.
We also experiment with PCTCP on ExperimenTor using a higher-
bandwidth underlying Modelnet network topology. Our overlay
Tor network is a scaled-down network in which we run 400 clients
and 20 Tor routers. The ORs are assigned bandwidth capabilities
that are sampled from the bandwidth distribution of the live Tor
network ORs. We test the performance of PCTCP in this topology
(a) Web clients
(b) Web clients
(c) Bulk clients
(d) Bulk clients
Figure 8: Performance of the web clients in a high-bandwidth network of 400 clients and 20 routers. Compare to Figure 7.
using a light trafﬁc load of 39:1 web-to-bulk client ratio, and using
a high trafﬁc load of 9:1 web-to-bulk client ratio.
Figure 8 shows the download time and time-to-ﬁrst-byte com-
parisons for Tor and PCTCP using the different trafﬁc loads for
the web and bulk clients. The ﬁgures show that for Tor clients,
the performance degrades faster, compared to PCTCP clients, as
we increase the trafﬁc load in the network by decreasing the web-
to-bulk client ratio. For example, for the web client, the median
time-to-ﬁrst-byte remains 0.9 seconds for PCTCP under the low
and high trafﬁc loads, whereas the corresponding value in Tor de-
grades by approximately 20%. This is also true for the download
time distribution. The median download time for PCTCP remains
the same as we increase the load (though the 4th quartile is slightly
degraded), whereas the median download time for Tor clients de-
grades by more than 30%.
 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 0 5 10 15 20 25 30 35 40Cumulative DistributionDownload Time (s)PCTCP 39:1PCTCP 9:1Tor 39:1Tor 9:1 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 0 2 4 6 8 10Cumulative DistributionTime to First Byte (s)PCTCP 39:1PCTCP 9:1Tor 39:1Tor 9:1 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 0 50 100 150 200 250 300Cumulative DistributionDownload Time (s)PCTCP 39:1PCTCP 9:1Tor 39:1Tor 9:1 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 0 2 4 6 8 10Cumulative DistributionTime to First Byte (s)PCTCP 39:1PCTCP 9:1Tor 39:1Tor 9:1