message space MsgSp is deﬁned by three algorithms:
• The randomized key generation algorithm K returns a
secret key K.
• The (possibly) randomized or stateful encryption algo-
rithm E takes input the secret key K and a plaintext
M ∈ MsgSp and returns a ciphertext.
• The deterministic decryption algorithm D takes the se-
cret key K and a ciphertext C to return the correspond-
ing plaintext or a special symbol ⊥ indicating that the
ciphertext was invalid.
The consistency condition requires that DK(EK(M)) = M
for all K that can be output by K and all M ∈ MsgSp.
We now recall cryptographic security notions for encryp-
tion. The following deﬁnition [9] formalizes the require-
ment that even though an adversary knows some partial
information about the data, no additional information is
leaked.
Deﬁnition 2.2 [Privacy: IND-CPA, IND-CCA] Let SE =
(K,E,D) be an encryption scheme. For atk ∈ {cpa, cca},
adversary A and a bit b deﬁne the experiments Expind-atk-b
as follows. In all experiments ﬁrst the secret key K is gen-
erated by K. Let LR be the oracle that on input M0, M1, b
returns Mb. The adversary A is given access to left-right
encryption oracle EK(LR(·,·, b)) that A can query on any
pair of messages of equal length. In Expind-cca-b
the ad-
versary is also given the decryption oracle DK(·) that it
can query on any ciphertext that was not returned by an-
other oracle. The adversary’s goal is to output a bit d as its
guess of the challenge bit b, and the experiment returns d as
well. The scheme SE is said to be indistinguishable against
chosen-plaintext attack or ind-cpa (resp. chosen-ciphertext
attack or ind-cca) if for every adversary A with reasonable
resources2 the difference
SE,A
SE,A
Pr
Expind-atk-0
SE,A
= 0
Expind-atk-1
SE,A
= 0
h
i − Pr
h
i
It is easy to see that IND-CCA security is a stronger notion
that implies IND-CPA security.
The following deﬁnition [12, 13] formalizes the require-
ment that no adversary should be able to compute a new
ciphertext which the receiver will deem valid.
Deﬁnition 2.3 [Integrity: INT-CTXT] Let SE = (K,E,
D) be an encryption scheme. The encryption scheme is
said to provide authenticity or ciphertext integrity (or be
INT-CTXT secure) if any adversary with reasonable re-
sources can be successful in the following experiment only
with small probability, called the int-ctxt-advantage of A,
Advint-ctxt
(A). In the experiment ﬁrst the random key K
is generated by K. The adversary has access to the encryp-
tion oracle EK(·). It is successful if it can output a valid
ciphertext C (i.e. DK(C) 6= ⊥) that was never returned by
the encryption oracle.
SE
It has been shown [12] that if an encryption scheme is IND-
CPA and INT-CTXT then it is also IND-CCA. To achieve
INT-CTXT security encryption scheme often utilize mes-
sage authentication codes (MACs), that we deﬁne below.
Deﬁnition 2.4 [Message authentication code] A message
authentication code (MAC) MAC = (K,T ) with associated
message space MsgSp is deﬁned by two algorithms:
• The randomized key generation algorithm K returns a
a secret key K.
• The deterministic4 mac aka.
tagging algorithm T
takes input the secret key K and a plaintext M to return
a mac aka. tag for M.
For a message-tag pair (M, σ), we say σ is a valid tag for
M if σ = σ0 where σ0 ← TK(M).
The following security deﬁnition [10] requires that no ad-
versary can forge a valid tag for a new message.
Deﬁnition 2.5 [Unforgeability: UF-CMA] Let MAC =
(K,T ) be a MAC scheme. It is called unforgeable against
chosen-message attacks or UF-CMA secure if any adver-
sary A with reasonable resources can be successful in the
following experiment only with small probability.
In the
experiment ﬁrst the random key K is generated by K. The
adversary has access to the tagging oracle TK(·). It is suc-
cessful if it can output a message-tag pair (M, σ) such that
σ is a valid tag for M under K, and M was not queried to
the tagging oracle.
3We call the value of an advantage “small” if it is very close to 0 (e.g.
4A MAC does not have to be deterministic. But most practical schemes
are, and in this paper we consider only detrministic MACs.
2Here and further in the paper we call the resources of an algorithm
(or adversary) “reasonable” if it runs some reasonable amount of time (e.g.
up to 10 years) in some ﬁxed model of computation, and does reasonable
number of oracle queries.
2−60.)
Authorized licensed use limited to: Tsinghua University. Downloaded on March 19,2021 at 02:53:14 UTC from IEEE Xplore.  Restrictions apply. 
2007 IEEE Symposium on Security and Privacy(SP'07)0-7695-2848-1/07 $20.00  © 2007Another (stronger) security deﬁnition requires that the out-
put of the MAC is indistinguishable from a random string.
Deﬁnition 2.6 [PRF] Let MAC = (K,T ) be a MAC
scheme. Let R be the set of all functions with the same
domain and range as T . The MAC is called pseudorandom
function or PRF secure if for any adversary A with reason-
able resources and access to an oracle and
Pr
K $← K : ATK (·) = 1
h
i − Pr
h
g $← R : Ag(·) = 1
i
is small.
It is known that any MAC that is PRF is also UF-CMA.
Deﬁnition 2.7 [Hash functions] A hash function HF =
(K,H) consists of two algorithms. The key generation al-
gorithm K outputs a key K5. The hash algorithm H on
inputs K and M outputs the hash value H.
Deﬁnition 2.8 [Collision-resistance] A hash function
HF = (K,H) is called collision-resistant if every adver-
sary with reasonable resources who is given a random K
output by K can output two messages M1, M2 such that
HK(M1) = HK(M2), M1 6= M2 only with small proba-
bility.
An encoding scheme is an unkeyed invertible transfor-
mation that is used to extend the message with some associ-
ated data such as padding, a counter or random nonce, etc.
Formally, an encoding scheme EC = (E nc, Dec) is deﬁned
by two algorithms. The (possibly) randomized or stateful
encoding algorithm E nc takes a message M and outputs a
pair of messages (Me, Mt). The deterministic decoding al-
gorithm takes Me and returns a pair (M, Mt) or (⊥,⊥) on
error. For any message M, let (Me, Mt) $← E nc(M) and
t) ← Dec(Me) then, the consistency condition re-
(M0, M0
quires that M = M0 and Mt = M0
t. The following is from
[13, 11].
Deﬁnition 2.9 [Coll-CPA] Let EC = (E nc, Dec) be an
It is called collision-resistant against
encoding scheme.
chosen-plaintext attacks or Coll-CPA if every adversary A
with reasonable resources has only small success probabil-
ity in the following experiment. The adversary has access to
the encoding oracle E nc(·) and it is considered successful
if it ever gets two replies containing Mt and M0
t such that
Mt = M0
t.
3 Analysis of Encryption in Kerberos v.5
GENERAL PROFILE. Kerberos allows the users to choose
the encryption scheme. All the options though conform to
a general design that we outline below (it is further general-
ized in [19]).
5All our results also apply to keyless hash functions.
Encode-then-MAC-then-Encrypt
Construction 3.1 [Encode-then-MAC-then-Encrypt]
Let SE = (Ke,E,D), EC = (E nc, Dec), MAC = (Km,T )
be an encryption scheme, an encoding scheme and
a checksum (i.e. MAC or hash function). The cor-
responding
scheme
SE0 = (K0,E0,D0) is deﬁned as follows.
• K0 runs Ke,Km and returns their outputs Ke k Km.
• E0 on inputs Ke k Km and M ﬁrst gets the encodings
It then computes σ ←
via (Me, Mt)
TKm(Mt), parses Me as MelkMer and returns C $←
EKe(Mel k σ k Mer).
• D0 on inputs Ke k Km and C computes Me ←
Mel k Mer, σ from (Mel k σ k Mer) ← DKe(C),
decodes (M, Mt) ← Dec(Me), computes σ0 ←
TKm(Mt) and returns M if σ = σ0, and ⊥ otherwise.
Above we assume that the outputs of the encoding scheme
are compatible with inputs to E,T .
$← E nc(M).
The next construction speciﬁes in more detail how Ker-
beros’ encryption operates. Figure 1 illustrates the design.
Figure 1. General proﬁle.
Construction 3.2 [Authenicated encryption in Ker-
beros. General proﬁle] Let E : {0, 1}k × {0, 1}n →
{0, 1}n be a block cipher (e.g. DES). Let SE = (Ke,E,D)
be the CBC encryption mode with IV ﬁxed to be a
string of n zeros6. Let MAC = (Km,T ) describe a hash
i.e. Km always returns ⊥, T is the keyless
function,
hash function algorithm with output of length l bits. Let
EC = (E nc, Dec) be an encoding scheme such that E nc
on input M pads it to make the length multiple of n bits (so
6The Kerberos’ speciﬁcation also allows the stateful update of the IV ,
i.e. the IV is assigned to be the last block of the previous ciphertext. Our
analyses applies to this case as well. But since this option is not commonly
used, we do not consider it in detail. We note however, that [22] does not
specify how the state and IV are updated when the receiver gets an invalid
ciphertext. The only reasonable resolution preventing malicious attacks
disrupting the future communication may be to issue an error message and
reset the IV to 0n.