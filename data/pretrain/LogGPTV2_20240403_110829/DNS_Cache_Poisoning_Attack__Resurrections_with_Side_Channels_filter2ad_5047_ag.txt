[1] [n.d.]. SADDNS website. https://www.saddns.net/.
[2] 2018. Introducing DNS Resolver, 1.1.1.1 (not a joke). https://blog.cloudflare.com/
dns-resolver-1-1-1-1/.
[3] D. Eastlake 3rd and M. Andrews. 2016. RFC 7873: Domain Name System (DNS)
Cookies. Technical Report. https://tools.ietf.org/html/rfc7873
[4] S. Deering A. Conta and Ed. M. Gupta. 2006. RFC 4443: Internet Control Message
Protocol (ICMPv6) for the Internet Protocol Version 6 (IPv6) Specification. Technical
Report. https://tools.ietf.org/html/rfc4443
[5] Josh Aas, Richard Barnes, Benton Case, Zakir Durumeric, Peter Eckersley, Alan
Flores-López, J Alex Halderman, Jacob Hoffman-Andrews, James Kasten, Eric
Rescorla, et al. 2019. Let’s Encrypt: An automated certificate authority to encrypt
the entire web. In Proceedings of the 2019 ACM SIGSAC Conference on Computer
and Communications Security. 2473–2487.
[6] Akamai. 2021. Configure split-DNS forwarding on Cisco routers.
https:
//learn.akamai.com/en-us/webhelp/enterprise-threat-protector/enterprise-
threat-protector/GUID-5916F532-2D1D-4CC0-B926-9D6CC44BEF33.html.
[7] G. Alexander and J. R. Crandall. 2015. Off-path round trip time measurement
via TCP/IP side channels. In 2015 IEEE Conference on Computer Communications
(INFOCOM).
[8] Geoffrey Alexander, Antonio M Espinoza, and Jedidiah R Crandall. 2019. De-
tecting TCP/IP Connections via IPID Hash Collisions. Proceedings on Privacy
Enhancing Technologies 2019, 4 (2019).
[9] Fatemah Alharbi, Jie Chang, Yuchen Zhou, Feng Qian, Zhiyun Qian, and Nael
Abu-Ghazaleh. 2019. Collaborative Client-Side DNS Cache Poisoning Attack.
In IEEE INFOCOM 2019-IEEE Conference on Computer Communications. IEEE,
1153–1161.
[10] Hanieh Bagheri, Victor Boteanu, Willem Toorop, and Benno Overeinder. 2013.
Making do with what we’ve got: Using PMTUD for a higher DNS responsiveness.
[11] F. Baker. 1995. RFC 1812: Requirements for IP Version 4 Routers. Technical Report.
https://tools.ietf.org/html/rfc1812
[12] R. Braden. 1989. RFC 1122: Requirements for Internet Hosts – Communication
Layers. Technical Report. https://tools.ietf.org/html/rfc1122
[13] Markus Brandt, Tianxiang Dai, Amit Klein, Haya Shulman, and Michael Waidner.
2018. Domain validation++ for MitM-resilient PKI. In Proceedings of the 2018 ACM
SIGSAC Conference on Computer and Communications Security. ACM, 2060–2076.
[14] Yue Cao, Zhiyun Qian, Zhongjie Wang, Tuan Dao, Srikanth V. Krishnamurthy,
and Lisa M. Marvel. 2016. Off-Path TCP Exploits: Global Rate Limit Considered
Dangerous. In 25th USENIX Security Symposium (USENIX Security 16). USENIX
Association, Austin, TX, 209–225.
[15] Yue Cao, Zhiyun Qian, Zhongjie Wang, Tuan Dao, Srikanth V. Krishnamurthy,
and Lisa M. Marvel. 2018. Off-Path TCP Exploits of the Challenge ACK Global
Rate Limit. IEEE/ACM Transactions on Networking (TON).
[16] Yue Cao, Zhongjie Wang, Zhiyun Qian, Chengyu Song, Srikanth V. Krish-
namurthy, and Paul Yu. 2019. Principled Unearthing of TCP Side Channel
Vulnerabilities. In Proceedings of the 2019 ACM SIGSAC Conference on Com-
puter and Communications Security (London, United Kingdom) (CCS ’19). As-
sociation for Computing Machinery, New York, NY, USA, 211–224.
https:
//doi.org/10.1145/3319535.3354250
[17] Weiteng Chen and Zhiyun Qian. 2018. Off-Path TCP Exploit: How Wireless
Routers Can Jeopardize Your Secrets. In 27th USENIX Security Symposium (USENIX
Security 18). 1581–1598.
[18] Taejoong Chung, Roland van Rijswijk-Deij, Balakrishnan Chandrasekaran, David
Choffnes, Dave Levin, Bruce M. Maggs, Alan Mislove, and Christo Wilson. 2017.
A Longitudinal, End-to-End View of the DNSSEC Ecosystem. In 26th USENIX
Security Symposium (USENIX Security 17). USENIX Association, Vancouver, BC,
1307–1322.
[19] European Commision. 2014. Quality of Broadband Services in the EU. http:
//ec.europa.eu/newsroom/dae/document.cfm?action=display&doc_id=10816.
[20] Tianxiang Dai, Philipp Jeitner, Haya Shulman, and Michael Waidner. 2021. From
IP to Transport and beyond: Cross-Layer Attacks against Applications. In Pro-
ceedings of the 2021 ACM SIGCOMM 2021 Conference (Virtual Event, USA) (SIG-
COMM ’21). Association for Computing Machinery, New York, NY, USA, 836–849.
https://doi.org/10.1145/3452296.3472933
[21] Jacob Davis and Casey Deccio. 2021. A Peek into the DNS Cookie Jar. In Passive
and Active Measurement, Oliver Hohlfeld, Andra Lutu, and Dave Levin (Eds.).
Springer International Publishing, Cham, 302–316.
[22] Zakir Durumeric, David Adrian, Ariana Mirian, Michael Bailey, and J. Alex
Halderman. 2015. A Search Engine Backed by Internet-Wide Scanning. In 22nd
ACM Conference on Computer and Communications Security.
[23] Roya Ensafi, Jong Chun Park, Deepak Kapur, and Jedidiah R. Crandall. 2010.
Idle Port Scanning and Non-Interference Analysis of Network Protocol Stacks
Using Model Checking. In Proceedings of the 19th USENIX Conference on Security
(Washington, DC) (USENIX Security’10). USENIX Association, USA, 17.
[24] FCC. 2018.
Eighth Measuring Broadband America Fixed Broadband Re-
https://www.fcc.gov/reports-research/reports/measuring-broadband-
port.
america/measuring-fixed-broadband-eighth-report.
[25] Xuewei Feng, Chuanpu Fu, Qi Li, Kun Sun, and Ke Xu. 2020. Off-Path TCP
Exploits of the Mixed IPID Assignment. In Proceedings of the 2020 ACM SIGSAC
Conference on Computer and Communications Security (Virtual Event, USA) (CCS
’20). Association for Computing Machinery, New York, NY, USA, 1323–1335.
https://doi.org/10.1145/3372297.3417884
[26] Linux Foundation. 2021. net/ipv4/icmp/c. https://elixir.bootlin.com/linux/v5.11/
[27] F. Gont. 2010. RFC 5927: ICMP Attacks against TCP. Technical Report. https:
[28] Google. 2021. IPv6 Adoption Statistics. https://www.google.com/intl/en/ipv6/
source/net/ipv4/icmp.c#L1218.
//tools.ietf.org/html/rfc5927
statistics.html.
[29] Hang Guo and John Heidemann. 2018. Detecting ICMP rate limiting in the
Internet. In International Conference on Passive and Active Network Measurement.
Springer, 3–17.
[30] Matthias Göhring, Haya Shulman, and Michael Waidner. 2018. Path MTU Discov-
ery Considered Harmful. In 2018 IEEE 38th International Conference on Distributed
Computing Systems (ICDCS). 866–874. https://doi.org/10.1109/ICDCS.2018.00088
[31] Brendon Harris and Ray Hunt. 1999. TCP/IP security threats and attack methods.
Computer communications 22, 10 (1999), 885–897.
[32] Amir Herzberg and Haya Shulman. 2012. Security of Patched DNS. In ESORICS
2012, Sara Foresti, Moti Yung, and Fabio Martinelli (Eds.).
[33] Amir Herzberg and Haya Shulman. 2013. Fragmentation considered poisonous,
or: One-domain-to-rule-them-all. org. In 2013 IEEE Conference on Communications
and Network Security (CNS). IEEE, 224–232.
[34] J. Mogul J. McCann, S. Deering and Ed. R. Hinden. 2017. RFC 8201: Path MTU
Discovery for IP version 6. Technical Report. https://tools.ietf.org/html/rfc8201
[35] Philipp Jeitner and Haya Shulman. 2021. Injection Attacks Reloaded: Tunnelling
Malicious Payloads over DNS. In 30th USENIX Security Symposium (USENIX
Security 21). USENIX Association.
[36] Dan Kaminsky. 2008. Black ops 2008: It’s the end of the cache as we know it.
Black Hat USA (2008).
[37] Amit Klein. 2020. Cross Layer Attacks and How to Use Them (for DNS Cache
Poisoning, Device Tracking and More). arXiv:2012.07432 [cs.CR]
[38] Amit Klein, Haya Shulman, and Michael Waidner. 2017. Internet-wide study
of DNS cache injections. In IEEE INFOCOM 2017-IEEE Conference on Computer
Communications. IEEE, 1–9.
[39] Jeffrey Knockel and Jedidiah R. Crandall. 2014. Counting Packets Sent Between
Arbitrary Internet Hosts. In 4th USENIX Workshop on Free and Open Communica-
tions on the Internet (FOCI 14). USENIX Association, San Diego, CA.
[40] Marc Kührer, Thomas Hupperich, Jonas Bushart, Christian Rossow, and Thorsten
Holz. 2015. Going wild: Large-scale classification of open DNS resolvers. In
Proceedings of the 2015 Internet Measurement Conference. ACM, 355–368.
[41] R. G. Fairhurst L. Eggert and G. Shepherd. 2017. RFC 8085: UDP Usage Guidelines.
Technical Report. https://tools.ietf.org/html/rfc8085
[42] M. Lepinski and S. Kent. 2012. RFC 6480: An Infrastructure to Support Secure
Internet Routing. Technical Report. https://tools.ietf.org/html/rfc6480
[43] lkm. 2007. Blind TCP/IP Hijacking is Still Alive. http://phrack.org/issues/64/13.
[44] Matthew Luckie, Robert Beverly, Ryan Koga, Ken Keys, Joshua A. Kroll, and
k claffy. 2019. Network Hygiene, Incentives, and Regulation: Deployment of
Source Address Validation in the Internet. In Proceedings of the 2019 ACM SIGSAC
Conference on Computer and Communications Security (London, United Kingdom)
(CCS ’19). Association for Computing Machinery, New York, NY, USA, 465–480.
https://doi.org/10.1145/3319535.3354232
[45] Keyu Man, Zhiyun Qian, Zhongjie Wang, Xiaofeng Zheng, Youjun Huang, and
Haixin Duan. 2020. DNS Cache Poisoning Attack Reloaded: Revolutions with
Side Channels. In Proceedings of the 2020 ACM SIGSAC Conference on Computer
and Communications Security (Virtual Event, USA) (CCS ’20). Association for
Computing Machinery, New York, NY, USA, 1337–1350. https://doi.org/10.1145/
3372297.3417280
[46] P. Mockapetris. 1987. RFC 1035: DOMAIN NAMES - IMPLEMENTATION AND
SPECIFICATION. Technical Report. https://tools.ietf.org/html/rfc1035
[47] J. Mogul and S. Deering. 1990. RFC 1191: Path MTU Discovery. Technical Report.
https://tools.ietf.org/html/rfc1191
[48] J. Postel. 1981. RFC 792: INTERNET CONTROL MESSAGE PROTOCOL. Technical
Report. https://tools.ietf.org/html/rfc792
[49] Zhiyun Qian and Z Morley Mao. 2012. Off-path TCP sequence number inference
attack-how firewall middleboxes reduce security. In 2012 IEEE Symposium on
Security and Privacy. IEEE, 347–361.
[50] Zhiyun Qian, Z. Morley Mao, Yinglian Xie, and Fang Yu. 2010. Investigation of
Triangular Spamming: A Stealthy and Efficient Spamming Technique. In 2010 IEEE
Symposium on Security and Privacy. 207–222. https://doi.org/10.1109/SP.2010.42
[51] Alan Quach, Zhongjie Wang, and Zhiyun Qian. 2017. Investigation of the 2016
Linux TCP Stack Vulnerability at Scale. SIGMETRICS Perform. Eval. Rev. (2017).
[52] M. Larson D. Massey R. Arends, R. Austein and S. Rose. 2005. RFC 4035: Protocol
Modifications for the DNS Security Extensions. Technical Report. https://tools.
ietf.org/html/rfc4035
html.
Session 12C: Traffic Analysis and Side Channels CCS ’21, November 15–19, 2021, Virtual Event, Republic of Korea3413residential host showed packet losses, which confirms rate-limiting
in the transit network is not a popular policy. Even for the Chinese
residential host, we find that the losses seem to be affected by the
nationwide slowdown effect as reported recently [60]. We had the
suspicion because UDP packets destined to the same residential
host experienced similar losses also.
C RESETTING THE EXCEPTION CACHE
STATE
Since the search of the ephemeral port we conduct requires multiple
rounds of probes, the attacker has to reset the cache state after
getting a positive response (i.e., a probing packet in a batch hitting
the correct open ephemeral port or the false positive caused by
noises). Generally speaking, this can be done similarly to the cache
planting phase in the private-facing port scan where the attacker
finds 5 hash-collision IPs (note these can be done via IP spoofing
instead of direct ownership) to evict the cache entry containing his
primary scanning IP. Note that an easier method exists specifically
for the public-facing port scans using ICMP frag needed messages.
This is because when a correct port is hit, the resolver will reduce
the MTU for the attacker’s host to that specified in the ICMP frag
needed message. The attacker can continue to lower the MTU
in future rounds of probes. Each time the MTU is decreased, an
attacker can simply send a PING verification packet to infer if the
new MTU is now in effect. Note that it is not possible to raise the
MTU using this method according to the specification [34, 47]. As
a result, if the minimum MTU is reached, the attacker would have
to fall back to the general method (i.e., replanting the cache).
D SYSTEMATIC MITIGATIONS ON NETWORK
SIDE CHANNEL ATTACKS
Both this work and SADDNS [45] showed a significant threat
against DNS security. Since they arise from the kernel network
stack, other protocols (e.g., QUIC or RTP) could suffer from the
side-channel-based port scan as well.
To mitigate unknown side channels, we suggest a careful design
on any use of shared resources and minimize sharing unless it is
absolutely necessary. To verify if a specific sharing is safe, we need
to model the side channel threat properly and can apply automated
reasoning techniques, e.g., static analysis and model checking [16]
to verify whether any leakage of information can occur.
Beyond the above analysis, which can be tricky to do correctly,
a universal best practice is to randomize the limit or use of the
shared resource. This can substantially increase the difficulty of a
side channel attack even if there is a vulnerability. Indeed, this is
exactly what the patches do against prior TCP side channels [15]
and SADDNS [45].
[53] Riccardo Ravaioli, Guillaume Urvoy-Keller, and Chadi Barakat. 2015. Character-
izing ICMP rate limitation on routers. In 2015 IEEE International Conference on
Communications (ICC). 6043–6049. https://doi.org/10.1109/ICC.2015.7249285
[54] Kyle Schomp, Tom Callahan, Michael Rabinovich, and Mark Allman. 2014. DNS
Record Injectino Vulnerabilities in Home Routers. http://www.icir.org/mallman/
talks/schomp-dns-security-nanog61.pdf.
[55] Kazuhiro Suzuki, Dongvu Tonien, Kaoru Kurosawa, and Koji Toyota. 2006. Birth-
day paradox for multi-collisions. In International Conference on Information Secu-
rity and Cryptology. Springer, 29–40.
[56] W. Simpson T. Narten, E. Nordmark and H. Soliman. 2007. RFC 4861: Neighbor
Discovery for IP version 6 (IPv6). Technical Report. https://tools.ietf.org/html/
rfc4861
[57] P. Vixie and D. Dagon. 2008. Use of Bit 0x20 in DNS Labels to Improve Transac-
tion Identity. Technical Report. https://tools.ietf.org/html/draft-vixie-dnsext-
dns0x20-00
[58] Neil Wright. 2012. DNS in Computer Forensics. Journal of Digital Forensics,
Security and Law 7 (2012), 11–42. https://doi.org/10.15394/jdfsl.2012.1117
[59] Xiaofeng Zheng, Chaoyi Lu, Jian Peng, Qiushi Yang, Dongjie Zhou, Baojun Liu,
Keyu Man, Shuang Hao, Haixin Duan, and Zhiyun Qian. 2020. Poison Over
Troubled Forwarders: A Cache Poisoning Attack Targeting DNS Forwarding
Devices. In 29th USENIX Security Symposium (USENIX Security 20). USENIX
Association, 577–593.
[60] Pengxiong Zhu, Keyu Man, Zhongjie Wang, Zhiyun Qian, Roya Ensafi, J. Alex
Halderman, and Haixin Duan. 2020. Characterizing Transnational Internet Per-
formance and the Great Bottleneck of China. Proc. ACM Meas. Anal. Comput.
Syst. 4, 1, Article 13 (May 2020), 23 pages. https://doi.org/10.1145/3379479
A ICMP REDIRECT ATTACKS
We performed the following small-scale experiments to measure
the four conditions (outlined in §5.1) for redirect-based attacks.
University network experiment. We verified the conditions of
successful attacks against resolvers in a university network. Since
we are able to craft ICMP redirect messages with the spoofed IPs
inside the university network, we target 9 resolvers by redirecting
the packets destined to our test machine to an IP that is considered
nearby of the resolver. The result shows 3 out of 9 resolvers are
vulnerable, (i.e., meeting 𝐶1−𝐶4). Most resolvers are not vulnerable
because they do not accept ICMP redirect packets at all, which
breaks 𝐶3. In practice, the acceptance of redirects can be configured
via sysctl on Linux and the default value varies on different Linux
distributions. Two resolvers are not vulnerable because they run
FreeBSD which blindly accepts redirects and invalidates 𝐶1.
Delivery of ICMP redirect on the Internet. Since ICMP redi-
rects are potentially dangerous [31], one concern is that such mes-
sages may be dropped on the Internet and only work in local net-
works. We therefore performed a small-scale experiment by having
8 vantage points (corresponding to 8 ASes) distributed across the
world (i.e., in five continents) to send ICMP redirect messages to
each other. Specifically, our vantage points reside in AWS (multiple
continents), Google Cloud Platform, China educational network,
US university campus network, and China residential network. The
result shows ICMP redirects can successfully traverse the Internet
in all pairs of experiments.
B ICMP RATE LIMIT
ICMP traffic is generally considered as control-plane traffic and it
has been proposed that the source should rate-limit the generation
of such packets [11, 53]. If such traffic is rate limited not only at
the source but also during transit (for ICMP PING [29]), the port
scan speed can be significantly hampered. As a result, we conduct
a small-scale experiment using the same setup as mentioned in
Appendix A and send ICMP frag needed or redirect messages to
each other at a rate of 10k pps. We find that none except one Chinese
Session 12C: Traffic Analysis and Side Channels CCS ’21, November 15–19, 2021, Virtual Event, Republic of Korea3414