给CPU。大家对中断控制器的认识可能比较薄弱，不过只需了解该设
备的存在和角色就可以了（图11-7）。
CPU
按照顺序传达给CPU
中断控制器
同时发生多个中断请求
中断请求xx号
中断请求yy号
外图设备A
外围设备B
图11-7中断控制器的功能
CPU接收到来自中断控制器的中断请求后，会把当前正在运行的
主程序中断，并切换到中断处理程序。中断处理程序的第一步处理，
就是把CPU所有寄存器的数值保存到内存的栈中。在中断处理程序中
完成外围设备的输入输出后，把栈中保存的数值还原到CPU寄存器
中，然后再继续进行对主程序的处理。假如CPU寄存器的数值没有还
①BIOS（Basic Input Outpu System）位于计算机主板或扩张板卡上内置的
ROM中，里面记录了用来控制外国设备的程序和数据。这一点在第7章中
进行过说明。
---
## Page 235
11.5用中断来实现实时处理
原的话，就会影响到主程序的运行，甚至还有可能会使程序意外停止
或者发生运行异常。这是因为主程序在运行过程中，出于某些原因用
到CPU寄存器。而这时如果突然插入别的程序，主程序必然会受到影
响。因此，在中断请求完毕后，各寄存器的数值必须要还原到中断前
的状态。只要寄存器的值保持不变，主程序就可以像没有发生任何事
情一样继续处理（图11-8）。
主程序
主程序的处理
发生中断请求
中新处理程序
寄存器的备份
外图设备控制
客存的还原
主程序的处理
图11-8中断请求的顺序
11.5用中断来实现实时处理
在主程序运行的过程中，中断发生的频率有多大呢？实际上，大
部分的外围设备，都会频繁地发出中断请求。其原因就是为了实时处
更多资料请关注裁的新浪薄客http：//blc
22
---
## Page 236
第11章硬件控制方注
理从外围设备输入的数据。虽然不利用中断也可以从外围设备输人数
据。但那种情况下，主程序就必须要持续不断地检测外围设备是否有
数据输人。
由于外围设备有很多个，因此就有必要按照顺序来调查。按照顺
序调查多个外围设备的状态称为轮询。对几乎不产生中断的系统来说，
轮询是比较合适的处理。不过，对计算机来说就不适合了。举例来说，
假如主程序正在调查是否有鼠标输人，这时如果发生了键盘输人的话，
该如何处理呢？结果势必会导致键盘输入的文字无法实时地显示在显
示器上。而通过使用中断，就可以实现实时显示了。
打印机等输出用的外围设备中，外围设备接收数据的状态，有时
是需要用中断来通知的。由于外围设备的处理速度比计算机主机的处
理速度要慢很多，因此，这种情况下就不需要对打印机的状态进行多
次调查，只需在中断请求发生时输出数据即可，这样一来，其他时间
CPU就可以集中处理别的程序了。中断处理是不是很方便呢。
11.6DMA可以实现短时间内传送大量数据
在了解IO输入输出及中断处理的同时，还希望大家记住另外一个机
制，这就是DMA（Direct Memory Access）。DMA是指在不通过CPU 的
情况下，外围设备直接和主内存进行数据传送。磁盘等都用到了这个DMA
机制。通过利用DMA，大量数据就可以在短时间内转送到主内存。之所以
这么快速，是因为CPU作为中介的时间被节省了（图11-9）。
图11-10和在前面看到的软盘控制器的属性画面是相同的。在资源
①资源是计算机具备的有限资源的统称。端口号、IRQ、DMA等可以指定的
数值范围都是有限的，因此它们也是资源的一种。
---
## Page 237
11.6DMA可以实现塑时间内传送大量数据
标签中有DMA设定，可以看出此处该设定为02。02这个编号称为DMA
通道。CPU借助DMA通道，来识别是哪一个外围设备使用了DMA。
通过CPU进行内存的读写（速度慢）
CPU
不使用DMA的外围设备的IO
使用DMA的外围设备的I/O
直接读入内存（速度快）
内存
围11-9使用DMA的外围设备和不使用DMA的外围设备的不同
标水软验控器屋性
案视动程序详信息货递
标准软盘制器
资源设置0）：
爽源类型
设置
130
0000000606)
置基于9）：
当前透
团使用自动设置0
更改设置（
本实设备到表：
设有中院：
BA
图11-10软盘控制器的DMA通道
---
## Page 238
IO端口号、IRQ、DMA通道可以说是识别外围设备的3点组合。
不过，IRQ和DMA通道并不是所有的外围设备都必须具备的。计算机
主机通过软件控制硬件时所需要的信息的最低限，是外围设备的1/O端
口号。IRQ只对需要中断处理的外围设备来说是必需的，DMA通道则
只对需要DMA机制的外围设备来说是必需的。假如多个外围设备都设
定成同样的端口号、IRQ及DMA通道的话，计算机就无法正常工作
了。这种情况下，就会出现“设备冲突”的提示。
11.7文字及图片的显示机制
在本章的最后，让我们一起来看一下显示器显示文字及图形的机
制。如果用一句话来简单地概括该机制，那就是显示器中显示的信息
一直存储在某内存中。该内存称为VRAM（VideoRAM）。在程序中，
只要往VRAM中写入数据，该数据就会在显示器中显示出来。实现该
功能的程序，是由操作系统或BIOS提供，并借助中断来进行处理的。
在MS-DOS时代，对大部分计算机来说，VRAM都是主内存的一
部分。例如PC-9801这种机型的计算机，主内存地址A0000地址以后
是VRAM区域。如果用程序往VRAM内存地址中写人数据，文字及
图形就可以显示出来。不过，文字和图形的颜色最多只能有16种。这
是因为VRAM的内存空间太小了（图11-11(a)）。
在现在的计算机中，显卡等专用硬件中一般都配置有与主内存相
独立的VRAM和GPU（Graphics Processing Unit，图形处理器，也称
为图形芯片）。这是因为，对经常需要描绘图形的Windows来说，数百
兆的VRAM是必需的。而为了提升图形的描绘速度，有时还需要专用
的图形处理器（图11-1I(b））。但不管怎样，内存VRAM中存储的数据
就是显示器上显示的信息，这一机制是不变的。
224
---
## Page 239
11.7文字及图片的显示机制
(a) MS-DOS时代
计算机主机
CPU
主内存
显示器
VRAM
( b ) WindowsB代
计算机主机
CPU
显卡
GPU
显示器
主内存
VRAM
图11-11VRAM中写入的数据被显示在显示器上
用软件来控制硬件听起来好像很难，但实际上只是利用输入输出
指令同外围设备进行输人输出的处理而已。中断处理是根据需要来使
用的选项功能，DMA则直接交给对应的外围设备即可。由此可见，对
程序员来说，其实并不困难。
虽然计算机领域的新技术在不断涌现，但计算机能处理的事情，
始终只是对输入的数据进行运算，并把结果输出，这一点是不会发生
任何变化的。不管程序内容是什么，最终都是数据的输入输出和运算。
本章介绍的开启和停止蜂鸣器的程序，就是一个很好的例子。而无论
是计算机还是程序，其实都很简单。
下一章，我们会通过开发一个简单的游戏程序，来对计算机的“思
考”机制进行说明。
更多资料请关注裁的新浪薄客http：//blo
---
## Page 240
CoLUMN
如果是你，
你会怎样介绍？
向邻居老奶奶说明显示器
和电视机的不同
笔者：老奶奶您好啊。身体咋样啊？
放的是什么呢？
老奶奶：嗯嗯。挺好。
笔者：这个不是电视机，大家称它
笔者：顺便问一下，您喜欢什么样
为显示器。电视机最初是“把远
的电视节目呀？
处的东西放映出来”的意思。把
老奶奶：《水户黄门》和《暴坊将
电视台上播放的古装剧，在您家
军）年轻人看的电视节目太吵
里放映出来，就是电视机。与此
了，受不了。
相对。计算机显示器上显示的是
笔者：原来您喜欢古装剧啊。我也
计算机主机上的程序的运行结果。
挺喜欢的。“不认识这把上方宝剑
老奶奶：都是啥跟啥啊，太难了，
么？（水户黄门）、“忘了老子长
不懂。
什么样了么？”（暴坊将军）这些
笔者：抱款啊，老奶奶。我说的有
台词还真是经典啊。
点难理解了。那咱们就先说说计
老奶奶：啊呀啊呀，小年轻的，这
算机的功能吧。计算机有好多功
也知道，不多见啊。做什么的啊？
能，公司、事务所等处理文档啊
笔者：计算机相关的工作。
记账啥的，用的都是计算机。
老奶奶：计算机工作，每天对着电
老奶奶：？？？
视机。眼睛很累吧。
笔者：这么说可能有点失礼，在老
笔者：您知道的真多。不过，计算
奶奶你们那个年代，大家用的都
机带的那个画面，和电视机可不
是纸质的文档和记账本等。现在，
一样，是放不了古装剧的。
计算机发达了，大家就不再用纸，
老奶奶：是吗？那计算机的电视机
面是用计算机来处理事务了。
---
## Page 241
老奶奶：？？？
笔者：（槽了，老奶奶不说话了，
有办法了！）老奶奶，计算机的显
示器可以显示文档和记账本。大
家就是看着这些来进行工作的。
老奶奶：噢，有点明白了。那么，
怎么在电视机中的文档和记账本
上写字呢？
笔者：（有戏，老奶奶开口了）用
键盘啊。在键盘上，有大量标着
字母和数字的按键。只要按下这
些按键，就可以写了。计算机是
显示器、键盘以及计算机主机的
组合体。
老奶奶：这么说来计算机是用来写
就可以在计算机上看电视了。
字的工具啊。还真是头一回听说。
老奶奶：啊，那不还是和电视机一
笔者：额这样理解也没有
样吗？
问题。
笔者：额·这么想好像也没有什
老奶奶：计算机的电视机会显示
么不对的。
文字。
笔者：（不是电视机，是显示器好
不好！）是啊，是啊。
老奶奶：如果计算机的电视机能放
古装剧的话就好了。那样的话工
作的时候还能看电视呢。
笔者：老奶奶，这还真是个好想
法！实际上，利用电视调谐器，
更多资料请
---
## Page 243
12
第
章
让计算机“思考”
热身间答
阅读正文前，让我们先回答下面的问题来热热身吧。
1.用计算机进行的模拟试验称为什么？
2.伪随机数指的是什么？