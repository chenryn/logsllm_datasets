•
The converted RTP media stream headers are initialized with the:
-
Original RTP stream’s SSRC
-
Payload Type
-
Incremented sequence and timestamp values
-
Spoofed source IP and UDP port of valid video sender
DefCon 17
53
Sipera Confidential - Do not reproduce or distribute without express written consent
© 2008 Sipera Systems, Inc. All Rights Reserved. 
VideoJak Overview
Target an H.264 RTP Video stream
• Select the 1-way video stream
• Start attack, by dropping the valid RTP packets
Video DoS Exploit
• Select the AVI or H.264 raw file
• Use Libnet to construct the H.264 RTP packet
• Use SSRC, timestamp, and other values of dropped packet
• Video interception can be a replay or random movie clip
• Target video device and send AVI file on destination RTP port
DefCon 17
54
Sipera Confidential - Do not reproduce or distribute without express written consent
© 2008 Sipera Systems, Inc. All Rights Reserved. 
Video
ARP
Video
Video
Video
© 2008 Sipera Systems, Inc. All Rights Reserved. 
VideoJak Target
Cisco 4300 Series IP Camera
DefCon 17
56
Sipera Confidential - Do not reproduce or distribute without express written consent
© 2008 Sipera Systems, Inc. All Rights Reserved. 
VideoJak Targets
Cisco 4300 Series IP Camera
• Cisco “Physical Security” solutions portfolio
• 1080p High Definition (HD) Video
• Uses RTP to stream H.264 compressed frames
• Uses RTSP for port negotiation
• Supports security features such as SRTP and 802.1x
• 10/100 FE with PoE, or wireless
• Web application (Active X control) for remote viewing from PC
• Video Analytics:  4500 series supports DSP-based, programmable
Purchased from Cisco reseller specializing in Video surveillance
• EYESthere  http://www.eyestheredfw.com
For this demo, we will target the uni-directional RTP stream from 
the IP camera to our demo laptop.
DefCon 17
57
Sipera Confidential - Do not reproduce or distribute without express written consent
© 2008 Sipera Systems, Inc. All Rights Reserved. 
VideoJak Tool Demo
DefCon 17
58
Sipera Confidential - Do not reproduce or distribute without express written consent
© 2008 Sipera Systems, Inc. All Rights Reserved. 
Agenda
Introduction
Overview of UC
Live demo of Video Eavesdropping
Live demo of Video Replay and Video Hijack
VoIP Pentesting Tricks
• Stealth Target Mode
• Story of modify IP Phone settings
Conclusion
DefCon 17
59
Sipera Confidential - Do not reproduce or distribute without express written consent
© 2008 Sipera Systems, Inc. All Rights Reserved. 
The Ultimate UCSniff Trick
This is the ultimate stealth UCSniff trick that can have you 
eavesdropping a targeted user with the least risk of service 
impact.
•
So smooth and stealth, even a Ninja would be impressed
First, you need to know the IP address of target IP Phone.  If you 
know the IP address, skip this step.
You don’t have to ARP Poison all of the traffic.
You don’t have to walk into the cube of the targeted user and look 
at their phone, learning the MAC Address of the IP Phone.
There is a clandestine way to learn this information remotely.
DefCon 17
60
Sipera Confidential - Do not reproduce or distribute without express written consent
© 2008 Sipera Systems, Inc. All Rights Reserved. 
Find IP Address of remote IP Phone
To clandestinely find the IP address of remote IP Phone:
•
Share a hub with laptop and IP Phone
•
Sniff traffic with Wireshark
•
Call remote User (Via corporate directory, Intranet)
•
Remote called party must pick up – Remote Phone must go offhook
•
Decode RTP Packets to find remote IP address
•
Wireshark RTP filter will find IP address
DefCon 17
61
Sipera Confidential - Do not reproduce or distribute without express written consent
© 2008 Sipera Systems, Inc. All Rights Reserved. 
Create Targets Entry
Manually create file targets.txt 
•
Manually create file targets.txt, including IP address of discovered remote IP Phone 
target
DefCon 17
62
Sipera Confidential - Do not reproduce or distribute without express written consent
© 2008 Sipera Systems, Inc. All Rights Reserved. 
UCSniff Target Mode
Run UCSniff in targeted user mode
•
Usually ‘ucsniff –i eth0 –c 1 –T’
•
Select Option 1 for Single User Mode
DefCon 17
63
Sipera Confidential - Do not reproduce or distribute without express written consent
© 2008 Sipera Systems, Inc. All Rights Reserved. 
Select Targeted User
Select targeted user
DefCon 17
64
Sipera Confidential - Do not reproduce or distribute without express written consent
© 2008 Sipera Systems, Inc. All Rights Reserved. 
UCSniff Stealth Mode Targeted 
Eavesdropping
UCSniff is now intercepting the traffic of only the targeted user’s 
IP Phone.  All calls to or from this user will be recorded.
•
Low risk of impact
•
Will not impact other IP Phone users
DefCon 17
65
Sipera Confidential - Do not reproduce or distribute without express written consent
© 2008 Sipera Systems, Inc. All Rights Reserved. 
Background of a Live UC Pentest
VIPER Security Consultant onsite with client in Europe
Authorized penetration test against Cisco UCM 7.1 VoIP 
environment
By default, GARP was disabled on all Cisco Unified IP Phones
For IP Phones calling each other in same VLAN, we could re-
construct RTP media with –garpdb feature of ucsniff
For IP Phones calling to remote VLANs, we could only re-construct 
traffic in ingress direction due to “GARP disabled”
We couldn’t intercept Skinny keypad messages for theft of voice 
mail passwords (as we could do before)
DefCon 17
66
Sipera Confidential - Do not reproduce or distribute without express written consent
© 2008 Sipera Systems, Inc. All Rights Reserved. 
Background of a Live UC Pentest
The “GARP Disabled” feature was getting in the way of a very 
successful pentest
DefCon 17
67
Sipera Confidential - Do not reproduce or distribute without express written consent
© 2008 Sipera Systems, Inc. All Rights Reserved. 
Background of a Live UC Pentest
We had to figure a way to remotely Enable GARP on the IP Phone
We knew that:
• “GARP Enabled” is a setting that is managed via the server, by 
specifying the configuration for that IP Phone
• Cisco Unified IP Phones download the configuration file via TFTP, 
which tells the IP Phone how to configure itself
This configuration file is only downloaded when the Phone boots 
up and registers via Skinny / SCCP protocol
Could there be a way for us to force the IP Phone to download this 
configuration file, and somehow modify it?
DefCon 17
68
Sipera Confidential - Do not reproduce or distribute without express written consent
© 2008 Sipera Systems, Inc. All Rights Reserved. 
Background of a Live UC Pentest
We figured out a method to do this via an automated process
We wrote a new feature of UCSniff that can remotely change the 
configuration of an IP Phone, thus enabling GARP
This is done through the MitM engine of UCSniff, and we’ve called 
it “TFTP MitM IP Phone modification” vector
This new feature will be included in UCSniff 3.0
In the following screen shots, UCSniff will step through the 
required methods
Note:  This method can be mitigated by applying security controls 
to a default installation
DefCon 17
69
Sipera Confidential - Do not reproduce or distribute without express written consent
© 2008 Sipera Systems, Inc. All Rights Reserved. 
Prepare UCSniff
We must first have physical access to port that is a member of the 
Voice VLAN for the IP Phone we want to change (MitM Condition)
We should know the IP address for that IP Phone
First, create the targets.txt file with the IP address of the IP Phone
DefCon 17
70
Sipera Confidential - Do not reproduce or distribute without express written consent
© 2008 Sipera Systems, Inc. All Rights Reserved. 
Launch UCSniff with new feature
Launch UCSniff with new feature:  
•
ucsniff –i eth0 –Z –G –T 
•
This can only run in Target Mode, against a single IP Phone
DefCon 17
71
Sipera Confidential - Do not reproduce or distribute without express written consent
© 2008 Sipera Systems, Inc. All Rights Reserved. 
Step 1:  Drop KeepAliveAckMessage
Cisco SCCP IP Phones use a KeepAlive/KeepAliveAckMessage as 
a heartbeat mechanism, letting the IP Phone know it has a 
connection to the server
The KeepaliveAckMessage is the response message sent from 
CUCM to the IP Phone
Since we are MitM for any traffic from Network 
 IP Phone, we can 
drop this message
UCSniff drops the KeepAliveAck Message from the server 
 IP 
Phone
DefCon 17
72
Sipera Confidential - Do not reproduce or distribute without express written consent
© 2008 Sipera Systems, Inc. All Rights Reserved. 
Step 2:  IP Phone Registers, 
downloads Configuration file
Since the IP Phone believes it has lost connectivity to the server, it 
attempts to Register to CUCM
When the IP Phone registers, it downloads the configuration file 
via TFTP
We intercept the served TFTP file via a UDP stream dissector in 
UCSniff
UDP stream destined to IP Phone is dissected.  We look for the 
GARP setting within the UDP Stream
DefCon 17
73
Sipera Confidential - Do not reproduce or distribute without express written consent
© 2008 Sipera Systems, Inc. All Rights Reserved. 
Step 3:  Modify configuration setting 
for GARP via UDP Stream
GARP Setting is changed over the network, from “GARP Disabled”
To “GARP Enabled”
DefCon 17
74
Sipera Confidential - Do not reproduce or distribute without express written consent
© 2008 Sipera Systems, Inc. All Rights Reserved. 
Step 4:  Cisco IP Phone parses new 
configuration
Cisco IP Phone finishes download of Configuration file via TFTP
Cisco IP Phone parses new configuration, Enabling GARP
DefCon 17
75
Sipera Confidential - Do not reproduce or distribute without express written consent
© 2008 Sipera Systems, Inc. All Rights Reserved. 
Summary
This happens in less than 30 seconds
• IP Phone will keep settings until it is rebooted
IP Phone will blank out when it loses registration for ~ 20 seconds
• If user is watching their IP Phone LCD, they might see the blankout
and lost registration
Pentest Trick
• Wait until employees go home for the day
• Target each IP Phone, Enabling GARP
• When employees arrive for work the next morning, they can be 
targeted for VoIP / Voicemail eavesdropping
DefCon 17
76
Sipera Confidential - Do not reproduce or distribute without express written consent
© 2008 Sipera Systems, Inc. All Rights Reserved. 
Summary
We can modify any IP Phone setting that is controlled by SEP 
Configuration file
• We could add new features and modules for modification of IP 
Phone configuration
In the absence of security controls, all Cisco Unified IP Phones are 
vulnerable to this issue with UCSniff 3.0
As stated before, this can be mitigated by following Cisco Security 
Best practices
• See the Cisco SAFE Architecture
• http://www.cisco.com/en/US/netsol/ns954/index.html
DefCon 17
77
Sipera Confidential - Do not reproduce or distribute without express written consent
© 2008 Sipera Systems, Inc. All Rights Reserved. 
Contact Information
DefCon 17
78
Sipera Confidential - Do not reproduce or distribute without express written consent
Jason Ostrom, CCIE #15239 Security
• Director, VIPER (Voice over IP Exploit Research)
• PI:EMAIL; PI:EMAIL
Arjun Sambamoorthy
• Research Engineer
• PI:EMAIL; PI:EMAIL
For more information about Sipera VIPER Lab, visit us online at 
http://www.viperlab.net
For more information about Sipera Systems, visit us online at 
http://www.sipera.com