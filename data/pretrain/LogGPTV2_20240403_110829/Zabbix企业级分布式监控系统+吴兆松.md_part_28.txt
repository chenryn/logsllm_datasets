ifOutErrorsS{=SNMPVALUE)]
60
365
SNMPV2agent
ifOutOctets[{#SNMPVALUE)]
60
365
SNMPv2agent
Ten
图9-27
9.4.1
现实案例需求
下面通过一个例子详细介绍如何配置Lowleveldiscovery。
1．业务需求
现在有大量的URL需要监控，形式如http://www.itnihao.com，要求URL状
态不为200时发出告警。
224
---
## Page 241
第9章Zabbix与自动化运维
2.需求详细分析
具有大量的URL，且URL经常变化，要求增加URL即可完成监控。
3.解决方案
分析需求后，发现URL是经常变化的，但其他状态不发生改变，那么它刚好
可以用Zabbix的Lowleveldiscovery功能轻松解决此问题。
9.4.2Zabbix客户端配置
Zabbix客户端配置语句如下。
shell# egrep -v "(#I^$)" /etc/zabbix/zabbix_agentd.conf
LogFile=/var/log/zabbix/zabbix_agentd.log
EnableRemoteCommands=0
Server=127.0.0.1,192.168.0.240
#Zabbix-Server端的IP地址
StartAgents=8
ServerActive=192.168.0.240:10051#Zabbix-Server端的IP地址
Hostname=nodel
Timeout=30
Include=/etc/zabbix/zabbix_agentd.conf.d/ #子配置文件路径
UnsafeUserParameters=1
#自定义的Key中可以包括特殊字符
9.4.3Lowleveldiscovery自动发现脚本编写
Lowleveldiscovery的脚本是一个JSON格式，鉴于大多数用户习惯使用
Shell，故此处采用Shell来编写，若用PERL、Python，则代码会更简洁，读者如
有需要，可以到https://github.com/itnihao/zabbix-book中下载相关脚本。
shell#cat /etc/zabbix/scripts/web_site_code_status
#!/bin/bash
# function:monitor web  status from zabbix
#License:GPL
# mail:PI:EMAIL
# version:1.0 date:2012-12-09
source /etc/bashrc >/dev/null 2>&1
#/usr/bin/curl -o /dev/null -s -w %(http_code) http://$1/
Web SITE_discovery(){
Web_SITE=($(cat /etc/zabbix/scripts/Web.txtIgrep -v "^#"))
printf '(\n'
printf '\t"data":[\n'
for（(i=0;i]
Select
Type of information
Numeric[unsigned）]
Decimal
Units
Usecustommultiplier
Update interval (in sec)
30
Flexibleinter
Interval
Period
Action
No flexible intervals defined.
Interval(in sec)
Add
Keephistory (in days)
Keep trends(in days)
365
Storevalue
ASIS
Showvalue
Asis
Ney
图9-41
图9-41中的$1代表我们检测出来的 URL，web.site.code[{#SITENAME}]中
的变量会依次检测这几个URL。
单击 Save 保存。创建 Trigger，单击 Trigger prototypes，如图 9-42 所示。
231
---
## Page 248
Zabbix企业级分布式监控系统
Itemadded
IRATION OFIIEN P
OTOTY
Itemprototypes ofweb.site.discovery
Displaying1to1of1found
TemplatelistTemplate:web
erylist
Discovery:web
Iten
orototypes
prototypes（o)
Name
Key
Interval
History
Trends
Type
Status
web.site.code on{=SITENAME}
web.site.code[(=SITENAME)]
30
90
365
Zabbix agent
Enabled
Activate selectedGo(0o)
图9-42
单击Create trigger prototype，如图9-43所示。
Configurationof item prototypes
Create tigger prototype
[Hide disabled tnggers]
gger prototypes (o)Graph prototypes (o)
Stat
图9-43
继续配置Trigger，如图9-44至图9-49所示。
Expression
MultiplePROBLEM
URL
Seventy
Save
图9-44
Select prototype]
Item
Sele
Function
Last(mostrecent）Tvalueis=N
Last of(T)
oSeconds
Time shit
Seconds
InsertCancel
图9-45
232
---
## Page 249
第9章Zabbix与自动化运维
Name
Key
Type
Type of information Status
web site.code on {#SITENAME} web.site.code[(=SITENAME)]Zabbix agent Numeric(unsigned)
Enabled
Condition-GoogleChrome
一回x
168.0.200/zabbix/popup_trexpr.php?dstfrm=triggersFom&dfld1=expression&srctbl=expressior
Item
Selec
Selectprototype
Function
Last(mostrecent)Tvalueis=N
、
Last of (T)
Seconds
Time shift
Seconds
NO
Insert
Cancel
图9-46
Itemweb_site_code_status:web.site.code on(#SITESelectSelect prototype
FunctionLast(mostrecent)Tvalueis=N
Last of(T)
0seconds
Time shift
Seconds
NO
lsert
Cancel