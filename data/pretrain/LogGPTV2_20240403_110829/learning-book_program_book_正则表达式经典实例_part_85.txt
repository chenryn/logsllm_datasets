或者，一个单引号引起来的值
) *?
0次或多次，匹配尽量少次（懒情量词）
\s cellspacing \b
#
整字匹配“cellspacing"
)
#
·(
#把下面的正则式捕获到第1个向后引用中
(？：[^>"]
匹配除了>、”或、之外的任意字符
|"[]*
#
或者，一个双引号引起来的值
436
第8章
www.TopSage.com
---
## Page 453
#
或者，一个单引号引起来的值
)*
0次或多次，匹配尽量多次（贪心量词）
）
>
#
正则选项：不区分大小写
正则流派：.NET、Java、PCRE、Perl、Python、Ruby
插入新的属性
本实例中所给的所有正则式都可以使用相同的替代字符串，因为这些正则式都会把在
匹配到的标签（如果存在）中的属性捕获到第1个向后引用中。这会允许你把
这些属性作为替代字符串的一部分放回去，同时可以添加新的cellspacing属性。下面
是所需的替代字符串：
替代文本流派：.NET、Java、JavaScript、Perl、PHP
替代文本流派：Python、Ruby
实例3.15中展示了如何在替代字符事中使用向后引用来执行替换。
讨论
为了详细解释这些正则式如何工作，我们先来对最简单的解答做一个分解。你可以看
到其中包含了4个逻辑组成部分。
第一个部分（会先匹配字面字符串）。单词
边界会防正匹配到仅仅以“table”开始的标签名称。虽然当我们处理（X)HTML的时候，
这样的元素名称），然而这是我们推荐采用的形式，而且它还会帮助你在用它查找其他
标签时避免可能出现的错误。
该正则式的第二个部分]*?\scellspacing\b)》是一个否定型顺序环视。它并不会在
匹配的时候消费任何文本，但是如果在起始标签中的任何地方出现了单词cellspacing，
那么它会让匹配尝试失败。因为要把cellspacing属性添加到所有匹配中，因此我们并
不想匹配到已经包含它的标签。
由于顺序环视会在匹配尝试中从当前位置向前看，所以其中使用了前导的[>]*?>，使
之可以尽量搜索更多的内容，直到被认为是标签结束的地方为止（也就是第一次出现>
的地方）。顺序环视子模式中的剩余部分（\scellspacing\b>）会简单以整字形式匹配字
面的字符串cellspacing。因为在一个属性名称与标签名称或者前面的属性之间总是使用
空格作为分隔，所以我们会匹配一个前导的空格字符（s)）。我们会匹配一个拖尾的单
词边界，而不是匹配另外一个空格字符，这是因为单词边界能够帮助我们满足整字匹
标记语言和数据交换437
www.TopSage.com
---
## Page 454
配cellspacing的目的，而且即使该属性没有取值，或者该属性名称之后紧跟着一个等
号也可以正常工作。
接下来，我们来看该正则式的第三个部分：([^>]*)。这是一个否定型的字符类加
上一个“0次或多次”量词，它们都被包围在一个捕获分组中。把这部分匹配捕获
起来允许你很容易地把每个匹配到的标签作为替代字符事的一部分放回去。而且与
否定型的顺序环视不一样，这部分实际上会把标签内的属性添加到该正则式匹配到
的字符串中。
最后，正则式会匹配字面字符（>来结束这个标签。
第二个正则式，也就是被称作是更可靠版本的那个，与我们刚刚讲解的正则式工作原
理是一模一样的，唯一的区别是两个否定型字符类>]的实例都被替换成了
"]"[]*"[^]*)。这个较长的模式会在一步之中就略去双引号和单引号引起来的
属性值。
至于替代字符事，它们可以用于这两个正则式，把每个匹配到的标签都替换成一个包
含cellspacing作为第一个属性的新标签，随后是在原来标签中出现的任意属性（第1
个向后引用）。
参见
实例8.6从概念上正好和本实例相反，它会查找包含某个特定属性的标签。
8.8删除XML风格的注释
问题描述
你想要删除一个（X)HTML或XML文档中的注释。例如，在把一个网页传递给web浏
览器之前，你想要删除其中的注释，从而可以减少该页面的文件大小，并因此降低那
些使用低速Intermnet连接的用户的加载时间。
解决方案
因为有了懒情量词可以使用，所以查找注释并不是一件很困难的工作。下面是完成这
个任务的正则表达式：
正则选项：点号匹配换行符
正则流派：.NET、Java、PCRE、Perl、Python、Ruby
这个正则式很直接。然而，我们知道在JavaScript中并不包括一个“点号匹配换行符”
的选项，这就意味着你需要把点号替换为一一个包含所有字符的字符类，从而这个正则
438第8章
www.TopSage.com
---
## Page 455
表达式可以匹配跨多行的注释。下面是一个在JavaScript中可用的版本：
正则选项：无
正则流派：JavaScript
要想删除注释，只需要把所有匹配都替换为空字符串（也就是替换为空）。实例3.14中
可以找到用来替换一个正则式的所有匹配的代码。
讨论
工作原理
在这个正则表达式的开始和结束处分别是字面的字符序列。因为这些字
符在正则式语法中都不是特殊字符（除了在字符类中连字符会创建范围），因此它们并
不需要进行转义。这样我们就只需要认真来解释一下位于正则式的中间的（.*？>或
。
因为有了“点号匹配换行符”的选项，所以该正则式中的点号会首先匹配任意单个的
字符。在JavaScript版本中，代替点号出现的是字符类sIS]>。然而，这两个正则式是
完全等价的。《s>会匹配任意空白字符，而S>会匹配所有其他字符。因此二者组合起
来就可以匹配任意字符。
懒情的*？量词会重复它之前的“任意字符”元素0次或多次，而且是重复尽量少的
次数。因此，前面的记号会被一直重复到第一次出现->为止。（关于在懒情和贪心量词
中如何进行回溯的内容，请参考实例2.13。）因为XML风格的注释不充许彼此之间进
行嵌套，所以这个简单的策略就足够好了。换句话说，它们总是会在第一次出现（也
就是最左边的）-->的时候结束。
当注释不能被删除的时候
大多数Web开发人员都熟悉在和元素中使用HTML注释，从而可以
同老版本的浏览器兼容。如今，这样做大体上只是一种没有任何意义的咒语，但是
由于人们通常喜欢复制粘贴，从而这种形式也会长期存在下去。我们会假设在要从
一个(X)HTML文档中删除注释的时候，你并不想把其中内嵌的JavaScript和CSS
都删除掉。你可能同样想要保留元素的内容、CDATA片段以及在标签中的
属性值。
早些时候，我们说过删除注释并不是一件很难的工作。然而事实是，只有当你忽略
(X)HTML或XML中语法规则总会发生变化的区域之时，才会真的很简单。换句话说，
如果你忽略了这个问题中比较难的部分，那么它就容易了。
当然，在有些情形中，你可能会评估你要处理的标记，并决定是否可以忽略这些问题
情形，可能是因为你自已写的标记代码，从而知道下面会遇到什么。如果你是在一个
标记语言和数据交换439
www.TopSage.com
---
## Page 456
文本编辑器中进行查找和替换，并且能够在删除每个匹配之前可以对它进行手动审查，
那么可能也是可以接受的。
但是，如果想要知道如何解决这些问题，在本章前面的“跳过复杂的(X)HTML和
XML片段”小节中，我们讨论了在匹配XML风格标签的时候如何解决相同的这些问
题。在查找注释时，还可以使用类似的手段。使用在实例3.18中的代码，先用下面所
给的正则表达式来找到这些复杂的片段，然后再把匹配之间找到的注释都替换为空字
符串（也就是删除注释）：
*（,•].1+]1[
11("]
匹配任意属性名称
1"["]*"
#
.和值
￥[.].
)*?
(?：
#单体标签
/>
#否则，把元素的内容和匹配的结束标签包括进来
*？
#标准元素：只包含标签
正则选项：不区分大小写、点号匹配换行符、宽松排列
正则流派：.NET、Java、PCRE、Perl、Python、Ruby
下面是一个用于JavaScript的等价版本，其中不支持“点号匹配换行符”和“宽松排列”
的选项：
•（].1*
(?：/>|>[\s\S]*?) |"}1"[]*"1*[]*)*>|
正则选项：不区分大小写
正则流派：JavaScript
变体
查找合法的XML风格注释
实际上，对于(X)HTML和XML注释来说，除了简单地以结束之外，
还存在一些其他的语法规则。具体来讲包括。
·2个连字符不能在注释中连续出现。例如，是不合法的，因为在
中间出现了2个连字符。
结束的分隔符前面不能出现术语注释-一部分的连字符。例如，
是不合法的，但是内容完全为空的注释则是充许的。
在结束的--和>之间可以出现空格。例如，是一个合法的完整
注释。
用一个正则式来表示这些规则也并不是很困难：
正则选项：无
正则流派：.NET、Java、JavaScript、PCRE、Perl、Python、Ruby
注意在起始和结束注释分界符之间的所有内容都还是可选的，因此它会匹配到完全为
空的注释。然而，如果在两个分界符之间存在一个连字符，那么它之后必须跟
着至少一个非连字符的字符。而且因为这个正则式的内层部分不能匹配连续两个连字
符，所以在本实例开始的时候所给的正则式中的懒情量词被替换为了贪心量词。虽然
懒情量词也是正确的，但是却会导致不必要的回溯（参见实例2.13）。
有些读者在看到这个新的正则式时，可能会想要知道为什么其中的否定字符类]被
使用了两次，而不是简单地把位于非捕获分组中的连字符设为可选的（例如，
())。之所以这样做是有原因的，读者可以参考实例2.15中关于“灾
难性回溯”的讨论。
所谓的嵌套量词（nestedquantifiers）总是需要额外的小心，一定要确保不会带来灾难
性回溯的可能。当一个量词出现在-一个使用量词重复的分组中的时候，我们称之为嵌
套量词。例如，模式（当你把这个模式片