15.2.2 GUC 参数设置
GBase8s提供了六类GUC参数，具体分类和设置方式参考表15-1。
表 15-1GUC参数说明
参数类型 说明 设置方式
INTERNAL 固定参数，在创建数据库的时候确定，用户无法 无
南大通用数据技术股份有限公司
620
GBase 8s V8.8开发者手册
修改，只能通过show语法或者pg_settings 视图
进行查看。
POSTMASTER 数据库服务端参数，在数据库启动时确定，可以 支持表 2 中的方式
通过配置文件指定。 一、方式四。
SIGHUP 数据库全局参数，可在数据库启动时设置或者在 支持表 2 中的方式
数据库启动后，发送指令重新加载。 一、方式二、方式四。
BACKEND 会话连接参数。在创建会话连接时指定，连接建 支持表 2 中的方式
立后无法修改。连接断掉后参数失效。内部使用 一、方式二、方式四。
参数，不推荐用户设置。
说明：
设置该参数后，下一
次建立会话连接时
生效。
SUSET 数据库管理员参数。可在数据库启动时、数据库 支持表 2 中的方式
启动后或者数据库管理员通过SQL进行设置。 一、方式二或由数据
库管理员通过方式
三设置。
USERSET 普通用户参数。可被任何用户在任何时刻设置。 支持表 2 中的方式
一、方式二或方式三
设置。
GBase8s提供了四种方式来修改GUC参数，具体操作参考表15-2。
表 15-2GUC参数设置方式
序号 设置方法
方式一 (1) 使用如下命令修改参数。
gs_gucset-Ddatadir-c“paraname=value“
说明：
如果参数是一个字符串变量，则使用-c parameter=“'value'“或者使用-c
“parameter='value'“。
使用以下命令在数据库节点上同时设置某个参数。
gs_gucset-Nall-Iall-c“paraname=value“
(2) 重启数据库使参数生效。
南大通用数据技术股份有限公司
621
GBase 8s V8.8开发者手册
说明：
重启GBase8s数据库的操作，会导致用户执行操作中断，请在操作之前
规划好合适的执行窗口。
gha_ctlstopall-lhttp://:2379
gha_ctlstartall-lhttp://:2379
方式二 gs_gucreload-Ddatadir-c“paraname=value“
说明：
使用以下命令在数据库节点上同时设置某个参数。
gs_gucreload-Nall-Iall-c“paraname=value“
方式三 修改指定数据库、用户、会话级别的参数。
 设置数据库级别的参数
gsql=#ALTERDATABASEdbnameSETparanameTOvalue;
在下次会话中生效。
 设置用户级别的参数
gsql=#ALTERUSERusernameSETparanameTOvalue;
在下次会话中生效。
 设置会话级别的参数
gsql=#SETparanameTOvalue;
修改本次会话中的取值。退出会话后，设置将失效。
说明：
SET设置的会话级参数优先级最高，其次是ALTER设置的，其中ALTER
DATABASE设置的参数值优先级高于ALTERUSER设置，这三种设置
方式设置的优先级都高于gs_guc设置方式。
方式四 使用ALTERSYSTEMSET修改数据库参数。
 设置POSTMASERT级别的参数
gsql=#ALTERSYSTEMSETparanameTOvalue;
重启后生效。
 设置SIGHUP级别的参数
gsql=#ALTERSYSTEMSETparanameTOvalue;
立刻生效(实际等待线程重新加载参数略有延迟)。
 设置BACKEND级别的参数
南大通用数据技术股份有限公司
622
GBase 8s V8.8开发者手册
gsql=#ALTERSYSTEMSETparanameTOvalue;
在下次会话中生效。
使用方式一和方式二设置参数时，若所设参数不属于当前环境，数据库会提示参数不在
支持范围内的相关信息。
15.2.3 操作步骤
使用方式一设置数据库参数，以在数据库主节点设置archive_mode参数为例。
(1) 以操作系统用户gbase登录数据库主节点。
(2) 查看archive_mode参数。
cat/home/gbase/data/dn1/dn1_1/postgresql.conf|greparchive_mode
archive_mode=on
on表示日志要进行归档操作。
(3) 设置archive_mode参数为off，关闭日志的归档操作。
gs_gucset-D/home/gbase/data/dn1/dn1_1-c"archive_mode=off"
说明： 可以使用以下命令在数据库节点上设置archive_mode参数为off。
gs_gucset-Nall-Iall-c"archive_mode=off"
(4) 重启数据库使参数生效。
gha_ctlstopall-lhttp://:2379
gha_ctlstartall-lhttp://:2379
(5) 使用如下命令连接数据库。
gsql-dpostgres-p15432
postgres为需要连接的数据库名称，15432为数据库主节点的端口号（根据实际情况指
定端口号。以下端口说明与此相同）。
连接成功后，系统显示类似如下信息：
gsql((GBase8s3.0.0BXXbuildd28887c9)compiledat2022-05-1311:31:40commit0lastmr
55)
Non-SSLconnection(SSLconnectionisrecommendedwhenrequiringhigh-security)
Type"help"forhelp.
南大通用数据技术股份有限公司
623
GBase 8s V8.8开发者手册
gsql=#
(6) 检查参数设置的正确性。
gsql=#SHOWarchive_mode;
archive_mode
--------------
off
(1row)
使用方式二设置参数，以在数据库主节点设置authentication_timeout参数为例。
(1) 以操作系统用户gbase登录数据库主节点。
(2) 查看authentication_timeout参数。
cat/home/gbase/data/dn1/dn1_1/postgresql.conf|grepauthentication_timeout
authentication_timeout=1min
(3) 设置authentication_timeout参数为59s。
gs_gucreload-Nall-Iall-c"authentication_timeout=59s"
Totalinstances:2.Failedinstances:0.
Successtoperformgs_guc!
说明： 可以使用以下命令在数据库节点上设置authentication_timeout参数为59s。
gs_gucreload-Nall-Iall-c"authentication_timeout=59s"
(4) 使用如下命令连接数据库。
gsql-dpostgres-p15432
postgres为需要连接的数据库名称，15432为数据库主节点的端口号（根据实际情况，
指定相应端口号）。
连接成功后，系统显示类似如下信息：
gsql((GBase8s3.0.0BXXbuildd28887c9)compiledat2022-05-1311:31:40commit0lastmr
55)
Non-SSLconnection(SSLconnectionisrecommendedwhenrequiringhigh-security)
Type"help"forhelp.
gsql=#
(5) 检查参数设置的正确性。
南大通用数据技术股份有限公司
624
GBase 8s V8.8开发者手册
gsql=#SHOWauthentication_timeout;
authentication_timeout
------------------------
59s
(1row)
使用方式三设置参数，以设置explain_perf_mode参数为例。
(1) 以操作系统用户gbase登录数据库主节点。
(2) 使用如下命令连接数据库。
gsql-dpostgres-p15432
postgres为需要连接的数据库名称，15432为数据库主节点的端口号。
连接成功后，系统显示类似如下信息：
gsql((GBase8s3.0.0BXXbuildd28887c9)compiledat2022-05-1311:31:40commit0lastmr
55)
Non-SSLconnection(SSLconnectionisrecommendedwhenrequiringhigh-security)
Type"help"forhelp.
gsql=#
(3) 查看explain_perf_mode参数。
gsql=#SHOWexplain_perf_mode;
explain_perf_mode
-------------------
normal
(1row)
(4) 设置explain_perf_mode参数。
使用以下任意方式进行设置：
设置数据库级别的参数
gsql=#ALTERDATABASEpostgresSETexplain_perf_modeTOpretty;
当结果显示为如下信息，则表示设置成功。
ALTERDATABASE
在下次会话中生效。
设置用户级别的参数
gsql=#ALTERUSERgbaseSETexplain_perf_modeTOpretty;
南大通用数据技术股份有限公司
625
GBase 8s V8.8开发者手册
当结果显示为如下信息，则表示设置成功。
ALTERROLE
在下次会话中生效。
设置会话级别的参数
gsql=#SETexplain_perf_modeTOpretty;
当结果显示为如下信息，则表示设置成功。
SET
(5) 检查参数设置的正确性。
gsql=#SHOWexplain_perf_mode;
explain_perf_mode
--------------
pretty
(1row)
15.2.4 示例
示例1：使用方式一修改GBase8s数据库主节点的最大连接数。
(1) 以操作系统用户gbase登录数据库主节点。
(2) 使用如下命令连接数据库。
gsql-dpostgres-p15432
postgres为需要连接的数据库名称，15432为数据库主节点的端口号。
连接成功后，系统显示类似如下信息：
gsql((GBase8s3.0.0BXXbuildd28887c9)compiledat2022-05-1311:31:40commit0lastmr
55)
Non-SSLconnection(SSLconnectionisrecommendedwhenrequiringhigh-security)
Type"help"forhelp.
gsql=#
(3) 查看最大连接数。
gsql=#SHOWmax_connections;
max_connections
-----------------
200
南大通用数据技术股份有限公司
626
GBase 8s V8.8开发者手册
(1row)
(4) 使用如下命令退出数据库。
gsql=#\q
(5) 修改GBase8s数据库主节点的最大连接数。
gs_gucset-Nall-Iall-c"max_connections=800"
(6) 重启GBase8s。
gs_om-tstop&&gs_om-tstart
(7) 使用如下命令连接数据库。
gsql-dpostgres-p15432
postgres为需要连接的数据库名称，15432为数据库主节点的端口号。
连接成功后，系统显示类似如下信息：
gsql((GBase8s3.0.0BXXbuildd28887c9)compiledat2022-05-1311:31:40commit0lastmr
55)
Non-SSLconnection(SSLconnectionisrecommendedwhenrequiringhigh-security)
Type"help"forhelp.
gsql=#
(8) 查看最大连接数。
gsql=#SHOWmax_connections;
max_connections
-----------------
800
(1row)
示 例 2 ： 使 用 方 式 二 设 置 数 据 库 主 节 点 的 客 户 端 认 证 最 长 时 间 参 数
“authentication_timeout”
(1) 以操作系统用户gbase登录数据库主节点。
(2) 使用如下命令连接数据库。
gsql-dpostgres-p15432
postgres为需要连接的数据库名称，15432为数据库主节点的端口号。
连接成功后，系统显示类似如下信息：
南大通用数据技术股份有限公司
627
GBase 8s V8.8开发者手册
gsql((gsqlx.x.xbuildf521c606)compiledat2021-09-1614:55:22commit2935lastmr6385
release)
Non-SSLconnection(SSLconnectionisrecommendedwhenrequiringhigh-security)
Type"help"forhelp.
gsql=#
(3) 查看客户端认证的最长时间。
gsql=#SHOWauthentication_timeout;
authentication_timeout
------------------------
1min
(1row)
(4) 使用如下命令退出数据库。
gsql=#\q
(5) 修改数据库主节点的客户端认证最长时间。
gs_gucreload-Nall-Iall-c"authentication_timeout=59s"
(6) 使用如下命令连接数据库。
gsql-dpostgres-p15432
postgres为需要连接的数据库名称，15432为数据库主节点的端口号。
连接成功后，系统显示类似如下信息：
gsql((gsqlx.x.xbuildf521c606)compiledat2021-09-1614:55:22commit2935lastmr6385
release)
Non-SSLconnection(SSLconnectionisrecommendedwhenrequiringhigh-security)
Type"help"forhelp.
gsql=#
(7) 查看客户端认证的最长时间。
gsql=#SHOWauthentication_timeout;
authentication_timeout
------------------------
59s
(1row)
示例3：修改GBase8s数据库节点的最大连接数。
(1) 以操作系统用户gbase登录数据库主节点。
南大通用数据技术股份有限公司
628