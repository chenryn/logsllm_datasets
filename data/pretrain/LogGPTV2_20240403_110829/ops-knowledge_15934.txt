User: Please use Python to write a script to monitor the CPU, memory and disk usage of a web server, and send an alert email when an exception occurs.
Assistant: The following is a simple Python script that can be used to monitor the CPU, memory and disk usage of a web server, and send an alert email when an exception occurs: ``` import psutil import smtplib from email.mime.text import MIMEText from email.header import Header # Set the alarm threshold, if the threshold is exceeded, an alarm email will be sent cpu_threshold = 80 mem_threshold = 80 disk_threshold = 80 # Get CPU usage cpu_usage = psutil.cpu_percent() if cpu_usage > cpu_threshold: # Send CPU alarm email msg = MIMEText(' CPU usage is too high: {}%'.format(cpu_usage), 'plain', 'utf-8') msg['From'] = Header('Web server') msg['To'] = Header(' Admin') msg['Subject'] = Header('Alert: High CPU usage', 'utf-8') smtp_server = 'smtp.example.com' smtp_port = 587 smtp_username = 'admin@example.com' smtp_password = 'password' sender = 'admin@example.com' receivers = ['admin@example.com'] smtp_conn = smtplib.SMTP(smtp_server, smtp_port) smtp_conn.starttls() smtp_conn.login(smtp_username, smtp_password) smtp_ conn. sendmail(sender, receivers, msg.as_string()) smtp_conn.quit() # Get memory usage mem_info = psutil.virtual_memory() mem_usage = mem_info.percent if mem_usage > mem_threshold: # Send memory alert email msg = MIMEText('memory High usage: {}%'.format(mem_usage), 'plain', 'utf-8') msg['From'] = Header('Web server') msg['To'] = Header('Management Staff') msg['Subject'] = Header('Alert: High memory usage', 'utf-8') smtp_server = 'smtp.example.com' smtp_port = 587 smtp_username = 'admin@example.com' smtp_password = 'password' sender = 'admin@example.com' receivers = ['admin@example.com'] smtp_conn = smtplib.SMTP(smtp_server, smtp_port) smtp_conn.starttls() smtp_conn.login(smtp_username, smtp_password) smtp_conn.sendmail (sender, receivers, msg.as_string()) smtp_conn.quit() # Get disk space usage disk_info = psutil.disk_usage('/') disk_usage = disk_info.percent if disk_usage > disk_threshold: # Send disk alert email msg = MIMEText ('Disk space usage is too high: {}%'.format(disk_usage), 'plain', 'utf-8') msg['From'] = Header('Web server') msg['To'] = Header('Administrator') msg['Subject'] = Header('Alert: High disk space usage', 'utf-8') smtp_server = 'smtp.example.com' smtp_port = 587 smtp_username = 'admin@ example.com' smtp_password = 'password' sender = 'admin@example.com' receivers = ['admin@example.com'] smtp_conn = smtplib.SMTP(smtp_server, smtp_port) smtp_conn.starttls() smtp_conn.login(smtp_username, smtp_password) smtp_conn.sendmail(sender, receivers, msg.as_string()) smtp_conn.quit() ``` Note: In actual use, you need to modify the SMTP server, user name, password, sender, and receiver according to the actual situation Information such as people and thresholds. At the same time, the script needs to be executed regularly to continuously monitor the server.