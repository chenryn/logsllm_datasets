# H3C SecPath F1000-C8102 [F1000-ServerBlade] 日志手册

## 资料版本：5W101-20190118
### 产品版本：
- **H3C SecPath F1000-C8102 防火墙系列**：E6471
- **H3C SecPath F1000-ServerBlade 服务器安全智能模块系列**：E6301

## 版权声明
版权所有 © 2019 新华三技术有限公司。未经本公司书面许可，任何单位和个人不得擅自摘抄、复制本文档内容的部分或全部，并不得以任何形式传播。除新华三技术有限公司的商标外，本手册中出现的其它公司的商标、产品标识及商品名称，由各自权利人拥有。本文档中的信息可能变动，恕不另行通知。

---

## 目录
1. 简介
   1.1 日志格式说明
   1.2 如何获取日志信息
      1.2.1 将日志信息保存到日志文件
      1.2.2 将日志信息发送到日志服务器
   1.3 日志模块列表
   1.4 文档使用说明
2. 系统管理日志
   2.1 用户上下线日志
      2.1.1 IMC认证上下线通知
      2.1.2 免认证上下线通知
      2.1.3 APP认证上下线通知
      2.1.4 微信认证上下线通知
      2.1.5 本地WEB认证上下线通知
      2.1.6 短信认证上下线通知
      2.1.7 单点登录上下线通知
   2.2 系统操作日志
   2.3 事件日志
   2.4 系统状态日志
   2.5 健康日志
   2.6 整机转发流量日志
3. 流量日志
   3.1 流量日志
   3.2 流阻断日志
   3.3 NAT日志
      3.3.1 Nat44日志
      3.3.2 Nat日志
4. 策略匹配日志
5. 网站访问日志
6. 恶意URL日志
7. 上网行为日志
   7.1 IM上报内容
   7.2 博客、微博、论坛、社区上报内容
   7.3 搜索引擎上报内容
   7.4 邮件上报
   7.5 文件传输上报内容
   7.6 娱乐/股票上报内容
   7.7 其他应用
8. 防攻击日志
   8.1 防异常包攻击日志
   8.2 防扫描攻击日志
   8.3 防DOS攻击日志
   8.4 IPS日志
   8.5 AV日志
9. IPSec_traffic日志
   9.1 IPSec_traffic日志
   9.2 VPN告警日志

---

## 1. 简介
本文档介绍了H3C SecPath F1000-C8102防火墙和H3C SecPath F1000-ServerBlade服务器安全智能模块的日志信息。包括日志参数、产生原因、处理建议等，为用户进行系统诊断和维护提供参考。

### 1.1 日志格式说明
缺省情况下，日志采用如下格式：
```
<time> <name> <msg>
```

#### 表1-1 日志头字段说明
| 字段 | 描述 |
| --- | --- |
| PRI | 由尖括号包含的一个数字构成，这个数字包含了程序模块（Facility）和严重性（Severity）。PRI = Facility * 8 + Severity |
| time | 时间紧跟在PRI后面，格式为“Mmm dd hh:mm:ss”，不包括年份。月份取值包括：Jan、Feb、Mar、Apr、May、Jun、Jul、Aug、Sep、Oct、Nov、Dec |
| name | 设备名称或IP，格式为：`device_name;sn;ipversion;msgversion`。其中，ipversion可以是ipv4或ipv6 |
| msg | 日志的具体内容，包含事件或错误发生的详细信息 |

#### 表1-2 日志等级说明
| 级别 | 严重程度 | 描述 |
| --- | --- | --- |
| 0 | Emergency | 表示设备不可用的信息，如系统授权已到期 |
| 1 | Alert | 表示设备出现重大故障，需要立刻做出反应的信息，如流量超出接口上限 |
| 2 | Critical | 表示严重信息，如设备温度已经超过预警值，设备电源、风扇出现故障等 |
| 3 | Error | 表示错误信息，如接口链路状态变化，存储卡拔出等 |
| 4 | Warning | 表示警告信息，如接口连接断开，内存耗尽告警等 |
| 5 | Notification | 表示正常出现但重要的信息，如通过终端登录设备，设备重启等 |
| 6 | Informational | 表示需要记录的通知信息，如通过命令行输入命令的记录信息，执行ping命令的日志信息等 |
| 7 | Debug | 表示调试过程产生的信息 |

#### 表1-3 可变参数域
| 参数标识 | 参数类型 |
| --- | --- |
| INT16 | 有符号的16位整数 |
| UINT16 | 无符号的16位整数 |
| INT32 | 有符号的32位整数 |
| UINT32 | 无符号的32位整数 |
| INT64 | 有符号的64位整数 |
| UINT64 | 无符号的64位整数 |
| DOUBLE | 有符号的双32位整数，格式为：[INT32].[INT32] |
| HEX | 十六进制数 |
| CHAR | 字节类型 |
| STRING | 字符串类型 |
| IPADDR | IP地址 |
| MAC | MAC地址 |
| DATE | 日期 |
| TIME | 时间 |

### 1.2 如何获取日志信息
缺省情况下，设备的日志功能处于开启状态，并允许向控制台（console）、WEB页面、日志服务器（loghost）和本地日志文件（logfile）方向输出日志信息。您可以在WEB页面上实时看到系统输出的日志信息，也可以通过`display log event`命令查看事件日志信息。

#### 1.2.1 将日志信息保存到日志文件
缺省情况下，系统根据通过`log`命令配置的日志过滤条件，将需要记录的日志实时记录到日志文件当中。日志文件中的内容可以通过WEB页面中的日志查询实时查看。

#### 1.2.2 将日志信息发送到日志服务器
您可以通过配置日志服务器向指定的IP地址发送设备的日志信息，还可同时配置日志服务器接收日志信息的端口号（默认为514）。如果设备侧配置的日志服务器接收日志信息的端口号与日志服务器侧不一致，则日志服务器将无法接收日志信息。您可以指定多个不同服务器同时接收设备产生的日志信息，但最多可指定3个。

### 1.3 日志模块列表
表1-4列出了所有可能生成日志信息的日志模块。

#### 表1-4 日志模块列表
| 模块名 | 说明 |
| --- | --- |
| 系统管理日志 | 包括系统操作日志和系统状态日志 |
| 流量日志 | 与流量相关的日志 |
| 网站访问日志 | 所有访问过的网站 |
| 恶意URL日志 | 访问的恶意URL |
| 上网行为日志 | 上网行为产生的日志 |
| 防攻击日志 | 发生攻击的日志 |
| 系统事件日志 | 系统事件，比如接口up/down |

### 1.4 文档使用说明
本文将系统日志信息按照日志模块分类。本文以表格的形式对日志信息进行介绍。有关表中各项的含义请参考表1-5。

#### 表1-5 日志信息表内容说明
| 表项 | 说明 | 举例 |
| --- | --- | --- |
| 日志内容 | 显示日志信息的具体内容 | ACL [$1:UINT32] [$2:STRING] [$3:COUNTER64] packet(s). |
| 参数解释 | 按照参数在日志中出现的顺序对参数进行解释。参数顺序用“$数字”表示，例如“$1”表示在该日志中出现的第一个参数。 | $1：ACL编号<br>$2：ACL规则的ID和内容<br>$3：与ACL规则匹配的数据包个数 |
| 日志等级 | 日志严重等级 | 6 |
| 举例 | 一个真实的日志信息举例 | operator_name=admin; operate_ip=192.168.1.105; create_time=2014-07-22 17:56:32; level=notice; reason=mod; result=success; managestyle=WEB; content=mod syslog configuration |
| 日志说明 | 解释日志信息和日志生成的原因 | 匹配一条ACL规则的数据包个数。该日志会在数据包个数发生变化时输出。 |
| 处理建议 | 建议用户应采取哪些处理措施。级别为6的“Informational”日志信息是正常运行的通知信息，用户无需处理。 | 系统正常运行时产生的信息，无需处理。 |

---

## 2. 系统管理日志
本节介绍系统管理输出的日志。

### 2.1 用户上下线日志
#### 2.1.1 IMC认证上下线通知
##### 1. IMC认证上线通知
- **日志内容**
  ```
  [$1:Imc] [$2:login]: logname=[$3:USERNAME] realname=[$4:REALNAME] groupname=[$5:GROUPNAME]@[$6:IPADDR]($7:MACADDR)
  ```
- **参数解释**
  - $1：IMC认证。
  - $2：认证上线。
  - $3：认证用户名字。
  - $4：用户真实名称。
  - $5：用户组名称。
  - $6：用户IP地址。
  - $7：用户MAC地址。
- **日志等级**：5
- **举例**
  ```
  Imc login: logname=123 realname=321 groupname=test@1.1.1.1(8c:34:fd:26:0f:50)
  ```
- **日志说明**：IMC认证上线通知。
- **处理建议**：无。

##### 2. IMC认证下线通知
- **日志内容**
  ```
  [$1:Imc] [$2:logout]: logname=[$3:USERNAME] realname=[$4:REALNAME] groupname=[$5:GROUPNAME]@[$6:IPADDR]($7:MACADDR) login at [$8:TIME], logout at [$9:TIME], duration is [$10:TIME], reason is [$11:logout/kickoff]
  ```
- **参数解释**
  - $1：IMC认证。
  - $2：认证下线。
  - $3：认证用户名字。
  - $4：用户真实名称。
  - $5：用户组名称。
  - $6：用户IP地址。
  - $7：用户MAC地址。
  - $8：登录时间。
  - $9：退出时间。
  - $10：登录时常。
  - $11：退出/强制下线。
- **日志等级**：5
- **举例**
  ```
  Imc logout: logname=test realname=testabc groupname=test@1.1.1.1(8c:34:fd:26:0f:50) login at 2016-05-25 09:17:26, logout at 2016-05-25 09:18:52, duration is 85s, reason is logout
  ```
- **日志说明**：IMC认证下线通知。
- **处理建议**：无。

#### 2.1.2 免认证上下线通知
##### 1. 免认证上线通知
- **日志内容**
  ```
  [$1:Free] [$2:login]: [$3:USERNAME]@[$4:IPADDR]($5:MACADDR)
  ```
- **参数解释**
  - $1：免认证方式。
  - $2：认证上线。
  - $3：认证用户名字。
  - $4：用户IP地址。
  - $5：用户MAC地址。
- **日志等级**：5
- **举例**
  ```
  Free login: user1@1.1.1.1(8c:34:fd:26:0f:50)
  ```
- **日志说明**：免认证上线通知。
- **处理建议**：无。

更多详细内容请参见后续章节。