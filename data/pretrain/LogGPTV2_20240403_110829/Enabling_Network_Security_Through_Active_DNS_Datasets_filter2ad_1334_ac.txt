8,495,216.5
908
586, 695
28, 162
14, 499
28, 655
185,205,470.67 75,690.83
184,075,003.5 83,309.0
485,239,507
48,891,296.25 485,117,732.0 39,316,201.5
291,514,366.5
2,346,885.75
291,172,940.5 2,022,850.0
58,474,102.67
1,208,253.83
58,304,209.5
1,205,094.5
57,838,938.5
2,387,929.75
57,693,964
2,380,550
4.1 Enhancing Public Blacklists
Due to the nature of Thales we can make use of the collected data in ways
that can reveal abuse signal about domains before they are identiﬁed as actual
malicious use. Blacklisted domains, for example, are an interesting category of
candidate indicators of abuse that can be registered, set-up, and pointed to an
IP location well before they are actually used in malicious activities. Thus, active
DNS could be used as a potential source of raw datasets that can be used for
timely domain abuse detection.
As we have already discussed, alongside the active DNS data collection, we
were also able to gather a plethora of public domain name blacklists. As expected,
domain names in these blacklists also appeared in the active DNS traces we
collected using the active DNS project. For all domain names seen in both the
public blacklists and active DNS data, we identiﬁed two important dates. The
ﬁrst denotes the ﬁrst day the domain name was probed by Thales. This behavior
is driven by the addition of the domain in our seed list that can be caused
by a change in any of the zone ﬁles collected daily from the top level domain
Enabling Network Security Through Active DNS Datasets
199
authorities. The second important date we identiﬁed is the ﬁrst day one of the
many blacklists we collect (on a daily basis) actually listed this domain name as
part of a particular abusive activity.
We compared the ﬁrst seen dates of blacklisted domains and the ﬁrst seen
date of a domain resolved by Thales and we plotted the results in a cumulative
distribution function (CDF) that depicts the time diﬀerence in days between a
resolution in our passive or active DNS data and the appearance of the domain
in a public blacklist. Negative values represent the number of domains that
have ﬁrst appeared in our active or passive DNS data before getting eventually
blacklisted. On the other hand, positive values represent domains that had been
blacklisted before they had a resolution in our data.
It is worth pointing out that not all the public domain names blacklists were
used as a seed domain source for Thales, rather the ones that are described in
Sect. 2.2. That is, we should expect a fair amount of both positive and negative
values in these CDFs. Positive values indicate that a domain name was ﬁrst seen
in a blacklist and then in either the active or passive DNS data that we present
in Fig. 7, while negative values indicate that the domain was ﬁrst seen in DNS
before being blacklisted.
Thales resolves domains that came in part from zoneﬁles for major top-
level domains. It queries any domain registered in that zone within a day after
it was registered and added in the zoneﬁle. This creates a temporal history
of the DNS activity capable of describing the IP infrastructure history that
supported the domain name, before blacklisting, at the time, and after it was
blacklisted. This is a new property that active DNS datasets will freely oﬀer to
the security community, and it is a property that is rarely seen in passive DNS
data. The reason for this behaviour that active DNS exhibits compared to passive
DNS is simple; infections get remediated and hosts are mobile, thus making it
hard for the network operator to passively observe the network evolution of the
infrastructure that supports a domain. Thus, Thales should be able to oﬀer a
strong signal augmenting existing passive DNS data to which researchers and
network operators have access.
Figure 7 shows the CDF plots for diﬀerent classes of malicious domain names
(Figs. 7a to d). The values plotted include the domains in our active and passive
DNS datasets that have been blacklisted. Several instances of these domains are
found in our dataset long before they are blacklisted; for example 50 % of domain
names associated with spam were queried approximately 2.5 months before they
were blacklisted. On the other hand, we do not have the same visibility for
ephemeral types of attacks, like phishing and exploit kits. In the latter two
cases, approximately 75 % of the domain names are queried by Thales at least
one day earlier, with the 50 % mark being at around 50 days earlier.
In total 42,000 domain names have been blacklisted and also appeared in
our active DNS dataset. From this set, 30 % were queried and data have been
collected for approximately 100 days before the blacklisting instance (Fig. 7(e)).
For 75 % of the blacklisted domain names, we have collected data for more than
a week before they appeared on a PBL. Considering that PBLs have been used
200
A. Kountouras et al.
Fig. 7. Cumulative distribution of the ﬁrst seen date in active and passive DNS, sub-
tracting the ﬁrst seen date of the same domain in a PBL for Zeus, Spam, Phishing,
and Exploit domains.
Enabling Network Security Through Active DNS Datasets
201
as ground truth for various security systems [21,23,26,30], we are planning to
utilize this data over time to model the behavior of these domains and identify
the threats long before current systems, or even before they are utilized by the
adversaries.
On the other hand, we were able to identify 20,000 domain names in the
passive DNS dataset that also appear in blacklists. The dashed line in Fig. 7
plots represents these domain names. Approximately 50 % of the domain names
that are blacklisted appear in the passive DNS data feed, with only 25 % revealing
themselves 50 days earlier than the blacklisting event, as shown in Fig. 7e. In
this case, there are only 20,000 domain names that have been blacklisted and the
visibility that we have is approximately 15 % for the 100 days mark. About 50 %
of all the domain names were seen roughly two days before they were blacklisted.
This clearly supports our claim about the merit of active DNS datasets, and
how well they complement existing passive DNS repositories. The early linkage
between domain names and IP infrastructure witnessed by the active DNS data
will be able to enrich the signal that passive DNS data contains, potentially
making local DNS modeling eﬀorts easier for researchers and operators.
In most cases, the active DNS dataset contains domain names far before
they appear in either the passive DNS or the blacklist dataset. Note that the
intersection between active and passive DNS records that have been blacklisted
is approximately 19,000. This is almost half of the domains in the active DNS
dataset and 95 % of the domain names in the passive DNS dataset. Passive DNS
seems to show better results in early days for the spam domain names case
(Fig. 7b), but active DNS catches up very fast (within 15 days) and then loses
the advantage again at the time of the blacklisting events (0 point in the plot).
Lastly, Fig. 7f depicts the diﬀerence between the day a blacklisted domain
name was ﬁrst seen in our active DNS dataset and the day it was seen in our
passive DNS dataset. This includes only the domain names that were seen before
the PBLs included them. Approximately 17,000 domain names have been found
in both active and passive DNS before they were blacklisted. The vast majority
of them were ﬁrst resolved by Thales, at least one day before it was visited by a
system in our university. Approximately 40 % of the domain names were already
being resolved by Thales for more than 100 days before they appeared in the
passive DNS dataset.
4.2 Enhancing the Detection of Domain’s Residual Trust Change
On the Internet, domain names serve as trust anchors for numerous systems and
services, and for many, ownership of a domain is enough to prove one’s identity.
Work by Lever et al. [25] discussed the problems caused by the use of domains
as trust anchors and showed that residual trust, implicitly inherited by domains
after an ownership change, is a root cause of many seemingly disparate security
problems. Therefore, identifying changes in ownership, due to expiration or some
other cause, is an important problem in protecting against the abuse of resid-
ual trust. WHOIS [19] is typically used to discover more information about the
owner of a particular domain, and thus, it would a appear to be a natural ﬁt for
202
A. Kountouras et al.
creating a remedy to this problem. However, collecting WHOIS at scale is out-
side the grasp of most organizations due to rate limiting imposed on automated
collection of WHOIS records. To make matters worse, these limits frequently
vary by registrar, further adding to the complexity of collecting WHOIS data
at scale. To circumvent this problem, Lever et al., proposed Alembic, a light-
weight algorithm for locating potential ownership changes that relies solely on
passive DNS. This algorithm relied upon three diﬀerent components: changes
in infrastructure, changes in lookup volume distribution, and change in SOA
records.
While passive DNS is much easier collect, it is also very sparse, and this
results in two limitations with respect to Alembic. Scores can only be computed
for domains observed in passive DNS and that have suﬃcient historical resolu-
tions. Active DNS can help improve upon these limitations. First, Fig. 6e shows
that active DNS captures many more eﬀective second level domains than passive
DNS. Given that the passive DNS dataset used for comparison was generated
from a large university network, this result is particularly important. It demon-
strates that even large networks have diﬃculty matching the breadth of domains
that can be collected using active DNS querying. Next, active DNS querying can
consistently gather speciﬁed DNS record types over time. In particular, Figs. 5a
and b show that active DNS results in substantially more SOA records than
passive DNS each day. Since one of the key components of the Alembic scor-
ing is SOA records, active DNS should be able to enhance the performance of
the Alembic scoring algorithm. While active DNS provides many beneﬁts, it
is important to note that the one component Active DNS cannot enhance is
the lookup volume distribution of domains. This component is derived by user
behavior observed in passive DNS, and therefore, there is no analog in the active
DNS dataset.
y
t
i
s
n
e
D
2 × 10+7
1 × 10+7
0 × 10+0
5 × 10+7
3 × 10+7
4 × 10+7
To evaluate whether Alembic could work
using only active DNS, we implemented
a modiﬁed version of the algorithm that
excluded lookup volume distribution as a
component and used a ﬁxed window size of
two weeks. Then we computed scores for
March 27, 2016 using our modiﬁed algorithm.
In total, this resulted in 63,332,836 domains
with non-zero scores, where larger scores indi-
cate a higher conﬁdence in an ownership
change. The distribution of those scores can
be seen in Fig. 8. The majority fell in the range
between 0.4 and 0.5, and further inspection revealed that the SOA component
contributed the most to these scores. In short, most of the scores in this range
were a result of changes in the SOA record for the domains. Since we saw very
little change in hosting infrastructure, it is possible these scores could simply
be the result of minor changes within the SOA record. The next largest range
was between 0.9 and 1.0 and consisted of 5,652,910 domains. According to the
Fig. 8. Histogram showing the dis-
tribution of Alembic scores for
March 27, 2016.
0.6
Score
0.0
0.3
0.9
Enabling Network Security Through Active DNS Datasets
203
algorithm, domains with a score in this range are most likely to have undergone
a change in ownership. 5,625,397 (99.5 %) of these domains had a score of 1.0,
indicating that both infrastructure and SOA records had undergone complete
changes. Indeed, we found 10,885 of these domains on a public service’s list [5]
of expired domains for March 27, 2016. The remainder of these domains provide
interesting cases for further study.
Our modiﬁed version of the Alembic algorithm, originally proposed by Lever
et al., provides an interesting example of how active DNS can be used to enhance
or extend existing research. Without active DNS, deploying an algorithm like
Alembic would require access to a large scale passive DNS dataset (e.g., uni-
versity, enterprise, Internet service provider). However, using openly available
active DNS data, as oﬀered by this research, can help remove the barriers to
using or deploying existing DNS research.
4.3 Tracking Malicious Domain Names in Non-routable IP Space
Bogons are private, reserved, or otherwise unallocated network blocks [18,32,34].
Bogons should be boring since by deﬁnition they should not be hosting anything
in the context of the global Internet. But occasionally, a domain name, like
messisux.bix, resolves to a bogon like 0.0.0.0 despite the fact this IP can
not host anything. The presence of a domain name, however, indicates a ser-
vice that should be globally reachable exists. These “nonsense” resolutions are
at times caused by misconﬁgurations, brand protection services, and occasion-
ally, malicious actors. To investigate further, we don our threat researcher hats
and analyze domain names that resolved to bogon IP space during our analysis.
Here we focus on malicious infrastructure as it is a primary interest of the secu-
rity community. However, we also note that active DNS data that resolves to