### Examination of New Malicious and Suspicious Domains

We conducted a thorough examination of the domains labeled as new malicious and suspicious, identifying several prominent and interesting clusters. Among the newly identified malicious domains, we found five hosting URLs with the pattern `/logo.gif?`, which were later confirmed by the Security Operations Center (SOC) to be related to the Sality worm. Additionally, 15 domains with the same URL pattern were reported by VirusTotal. We also identified a cluster of 10 Domain Generation Algorithm (DGA) domains, none of which were reported by either VirusTotal or the SOC, demonstrating our detector's capability in capturing new malicious campaigns. All these malicious domains are under the top-level domain (TLD) `.info` and have names consisting of 4 or 5 characters (e.g., `mgwg.info`). Nine out of the ten domains host URLs with the pattern `/tan2.html`, and visiting them redirects to the remaining domain, `1.tv990.info`.

### Legitimate Domains and False Positive Rate

We labeled 63 domains as legitimate, belonging to categories such as Ad-network, Gaming, Toolbar, and Torrent Tracker, resulting in a false positive rate (FPR) of 8.63 · 10^-4% over 7.3 million domains. These domains were flagged by our detector due to exhibiting suspicious features, such as automated connections or recent registration. Although they do not pose serious harm to the enterprise, some violate company policies (e.g., Gaming, Torrent Tracker). No suspicious activities were discovered from examining log data, but we believe these domains still need to be vetted.

### Comparison and Performance

We compared the results of the two modes of operation. Only 21 domains were detected in both modes, a small percentage compared to the 202 and 108 domains detected separately. For enterprise deployment, we recommend configuring the detector to run in both modes to achieve better coverage. As shown, starting from a seed of known malicious domains or hosts, the algorithm in SOC hints mode can identify suspicious domains with high accuracy.

The Command and Control (C&C) communication detector has the unique capability of identifying C&C domains used in new attack campaigns. To reduce the false positive rate in the no-hint mode, we recommend that the detected C&C domains are first vetted by the SOC and then belief propagation is seeded only with confirmed malicious C&C domains.

In terms of performance, our system scales well with the logs generated by a large enterprise (averaging 662GB of data daily). The data is stored on a parallel Greenplum database with 90TB of storage and processed on a Cisco UCS C200 M2 server with 48GB of RAM. The normalization and profiling stages take approximately 2 hours daily, including the time to query the database, create normalized representations, and write the normalized data to disk. Belief propagation is extremely fast, taking an average of 5 seconds, as we build the bipartite graph incrementally and add only a small number of suspicious domains and hosts in each iteration.

Both variants of our detector include configurable options for various parameters (e.g., thresholds for domain scoring). These parameters can be chosen by the SOC according to the capacity of the team performing manual investigation and the trade-offs between accuracy and coverage, as demonstrated by our experimental evaluation.

### Related Work

Our work focuses on detecting early-stage infections within enterprise perimeters, including communications related to malware delivery and C&C. While there has been extensive research in this area, to the best of our knowledge, we are the first to exploit the relationship between malicious domains associated with the same attack campaign and detect them using a graph-theoretic framework based on belief propagation.

#### Detection of C&C Communication

Previous work on detecting C&C domains in botnets often requires malware samples as input to detect similar connection patterns (e.g., BotFinder, Jackstraws). Anomaly-based botnet detection systems (e.g., BotMiner, BotSniffer, TAMD) typically detect clusters of multiple synchronized hosts infected by the same malware. In contrast, our approach does not require malware samples and can detect campaigns with few hosts communicating to a C&C server.

DISCLOSURE identifies C&C traffic using features extracted from NetFlow records and incorporates external intelligence sources to reduce false positives. Our C&C detector is different in that it leverages enterprise-specific features extracted from HTTP connections. ExecScent is similar to our work in detecting C&C communications in large enterprise networks, but it requires malware samples to extract templates representing malicious C&C connections. Our work complements ExecScent by detecting new, unknown malware that can be provided as input to the template generation module.

#### Detection of Malware Delivery

Nazca analyzes web requests from ISP networks to identify traffic related to malware delivery and unveils malicious distribution networks. CAMP determines the reputation of binary downloads in browsers and predicts malicious activities. BotHunter identifies sequences of events during infection, as observed from a network perimeter.

#### Detection of Malicious Domains

Malicious domains often use highly resilient infrastructures to deal with takedowns or blacklisting, exhibiting unique characteristics distinct from benign sites. Other work detects domains involved in malicious activities by patterns observed in DNS traffic (e.g., EXPOSURE, Notos, Kopis, and Antonakakis et al.). Paxson et al. detect malicious communication established through DNS tunnels. Carter et al. use community detection to identify highly localized malicious domains in the IP space.

#### Anomaly Detection in Enterprise Networks

Beehive is an unsupervised system that identifies general anomalies in an enterprise setting, including policy violations and malware distribution. Our work specifically targets enterprise infections that pose high risk and potential financial loss.

#### Targeted Attacks

Cyber threats continue to evolve, with more sophisticated attacks emerging. Some targeted attacks (APT) are well-funded, carefully orchestrated, and persist in victim environments for years before detection. Detecting targeted attacks is challenging, as they are usually stealthy and evade existing defenses. However, many campaigns (e.g., Shady RAT, Mirage, APT1) exhibit similar infection patterns during the automated infection stage. Recent studies show that goal-oriented attackers use relatively low levels of sophistication. We leverage common patterns observed during the infection stage to build a detector tailored to an enterprise. Our detection results on the LANL’s APT infection discovery challenge indicate that our techniques have potential in detecting infections originating from targeted attacks.

### Limitations and Discussion

As reported by Mandiant, the infection patterns we detect are prevalent in many APT attacks. Nevertheless, attackers could potentially use various techniques to evade our detectors, such as:

- Communicating through protocols other than HTTP(S), although most other communication is blocked at the enterprise border.
- Adding more randomization to the timing of C&C communications, making patterns less predictable.
- Using standard user-agent strings, but this limits the functionality of malware that encodes host status, configuration, and other information in the UAs.
- Registering domains in advance before their use.
- Communicating directly with IP addresses, increasing the risk of their infrastructure being discovered.

These evasion methods come at an increased operational cost for attackers, limiting malware functionality and increasing the risk of campaign discovery.

Our proposed approach is meant to complement existing tools rather than replace them. The results demonstrate that our belief propagation algorithm in both variants (SOC hints and no-hint) detects new suspicious activities overlooked by deployed defense mechanisms. These include both domains associated with existing malware campaigns (identified by VirusTotal) and entirely new malware campaigns (not yet detected by anti-virus technologies). Since our methods focus on detecting the initial infection stages of a campaign, it is difficult to determine how many of these suspicious activities are related to more advanced attacks and how many are mainstream malware variants. Monitoring activity to these suspicious domains over longer periods and correlating with information from other data sources will help answer this question, and we leave this as an avenue for future work.

### Acknowledgments

We are grateful to Kevin Bowers, Michael Fikes, Robert Griffin, Christopher Harrington, Engin Kirda, Silvio La Porta, Todd Leetham, James Lugabihl, Robin Norris, Martin Rosa, and Ronald L. Rivest for their valuable comments and suggestions on the system design and evaluation. We also thank the enterprise that permitted us access to the web proxies dataset and helped with the investigation of suspicious activities. We are grateful to LANL for releasing the anonymous DNS dataset and the C3E 2014 organizers for supporting the APT infection discovery challenge. Finally, we thank our shepherd Michel Cukier and anonymous reviewers for their feedback on drafts of this paper.

### References

[References listed here as in the original text]