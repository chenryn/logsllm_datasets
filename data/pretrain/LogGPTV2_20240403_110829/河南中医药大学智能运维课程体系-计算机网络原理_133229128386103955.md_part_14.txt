口多播路由选择
在多播过程中，一个多播组中的成员是动态变化的。
■多播路由选择实际上就是要找出以源主机为根节点的多播转发树
■不同的多播组对应于不同的多播转发树。
同一个多播组，对不同的源点也会有不同的多播转发树。
---
## Page 255
255
7.IP多播
7.4多播路由选择协议
口多播路由选择在转发多播数据报时使用三种方法：
■洪泛与剪除
口适合于较小的多播组，所有组成员接入的局域网也是相邻接的。
口开始时，路由器转发多播数据报使用洪泛的方法（这就是广播）。
为避免兜圈子，采用反向路径广播RPB（ReversePathBroadcasting）的策略。
RPB 的要点：形成以源为根节点的多播转发树。如果存在几条同样长度的最短路径，选择IP 地址最
小的。最后就得出了以源为根节点的、用来转发多播数据报的多播转发树。
·剪枝：如果在多播转发树上的某个路由器发现它的下游树枝（即叶节点方向）已没有该多播组的成
员，就把它和下游的树枝一起剪除。
·嫁接：当某个树枝有新增加的组成员时，可以再接入到多播转发树上。
河南中医药大学信息技术学院互联网技术教学团队／https://inter
cm.edu.cn
---
## Page 256
256
7.IP多播
7.4多播路由选择协议
多播路由选择在转发多播数据报时使用三种方法：
隧道技术 (tunneling)
口隧道技术适用于多播组的位置在地理上很分散的情况。
N-1支持多播
N-1支持多播
不支持多播
的网络
多播数据报
首部
数据
网N，和网N，中的多播数据报
首部
数
据
隧道中通行的单播IP数据报
单播IP数据报
河南中医药大学信息技术学院互联网技术教学团队／https://internet.hactcm.edu.cn
---
## Page 257
257
7.IP多播
7.4多播路由选择协议
口多播路由选择在转发多播数据报时使用三种方法：
■基于核心的发现技术
口对于多播组的大小在较大范围内变化时都适合。
口对每一个多播组G指定一个核心（core）路由器，并给出它的IP单播地址。
口核心路由器按照前面讲过的2种方法创建出对应于多播组G的转发树（核心路由
器为根节点）。
·为一个多播组构建一棵转发树，而不是为每个（源，组）组合构建一棵转发树
■构建转发树开销较小，扩展性较好。
n.edu.cr
---
## Page 258
258
7.IP多播
7.4 多播路由选择协议
口多播路由选择在转发多播数据报时使用三种方法：
■基于核心的发现技术
口如果有一个路由器R1向核心路由器发送数据报，那么它在途中经过的每一个路由
器都要检查其内容。
·如果 R1发出的是一个多播数据报，其目的地址是G 的组地址，R2 就向G 的成员转发这个多播数据
报。
·如果 R1发出的数据报是一个请求加入多播组G的数据报，R2 就把这个信息加到它的路由中，并用
隧道技术向R1转发每一个多播数据报的副本。
n.edu.cn
---
## Page 259
259
7.IP多播
7.4多播路由选择协议
口多播路由选择在转发多播数据报时使用三种方法：
■基于核心的发现技术
·互联网上使用的第一个多播路由选择协议。
口基于核心的转发树 CBT (CoreBasedTree)
开放最短通路优先的多播扩展MOSPF（MulticastExtensionstoOSPF)
 协议无关多播-稀疏方式 PIM-SM (Protocol Independent Multicast-Sparse
Mode)。
■唯一成为互联网标准的一个协议。
m.edu.cr
---
## Page 260
260
8.VPN和 NAT
8.1虚拟专用网VPN
由于IP地址的紧缺，一个机构能够申请到的IP地址数往往远小于本机
构所拥有的主机数。
口考虑到互联网并不很安全，一个机构内也并不需要把所有的主机接入到
外部的互联网。
假定在一个机构内部的计算机通信也是采用TCP/IP协议，那么从原则上
讲，对于这些仅在机构内部使用的计算机就可以由本机构自行分配其IP
地址。
---
## Page 261
261
8.VPN和 NAT
8.1虚拟专用网VPN
口本地地址与全球地址
■本地地址：仅在机构内部使用的IP地址，可以由本机构自行分配，而不需要
向互联网的管理机构申请。
■全球地址：全球唯一的IP地址，必须向互联网的管理机构申请。
问题与解决方案：
口在内部使用的本地地址就有可能和互联网中某个IP地址重合，这样就会出现地址
的二义性问题。
口RFC1918指明了一些专用地址(privateaddress)。
·专用地址只能用作本地地址而不能用作全球地址。
·在互联网中的所有路由器，对目的地址是专用地址的数据报一律不进行转发。
河南中医药大学信息技术学院互
---
## Page 262
262
8.VPN和 NAT
8.1虚拟专用网VPN
口本地地址与全球地址
口RFC 1918 指明了一些专用地址 (private address)
(1) 10.0.0.0 到 10.255.255.255
A类，或记为10.0.0.0/8，又称为24位块
(2) 172.16.0.0 到 172.31.255.255
B类，或记为172.16.0.0/12，又称为20位块
(3) 192.168.0.0 到 192.168.255.255
C类，或记为192.168.0.0/16，又称为16位块
河南中医药大学信息技术学院卫
m.edu.cn
---
## Page 263
263
8.VPN 和 NAT
8.1虚拟专用网VPN
口专用网
■采用专用IP地址的互连网络称为专用互联网或本地互联网，或更简单些，就
叫做专用网。
■因为这些专用地址仅在本机构内部使用，专用IP地址也叫做可重用地址
(reusable address)。
河南中医药大学信息技
---
## Page 264
264
8.VPN和 NAT
8.1虚拟专用网VPN
口虚拟专用网VPN
利用公用的互联网作为本机构各专用网之间的通信载体，这样的专用网又称
为虚拟专用网VPN(Virtual Private Network)。
“专用网"是因为这种网络是为本机构的主机用于机构内部的通信，而不是用
于和网络外非本机构的主机通信。
"虚拟"表示"好像是”，但实际上并不是，因为现在并没有真正使用通信专线
而VPN只是在效果上和真正的专用网一样。
河南中医药大学信息技
---
## Page 265
265
8.VPN和NAT
8.1虚拟专用网VPN
口虚拟专用网√PN的构建方法
■如果专用网不同网点之间的通信必须经过公用的互联网，但又有保密的要求
那么所有通过互联网传送的数据都必须加密。
并进行配置，使每一个场所的√P门系统都知道其他场所的地址。
河南中医药大学信息技术
---
## Page 266
266
8.VPN 和 NAT
8.1虚拟专用网VPN
虚拟专用网VPN的实现：
基于隧道技术
全球地址
125.1.2.3
1194.4.5.6
互联网
Host-1
Host-2
隧道
10.1.0.1
10.2.0.2
使用隧道技术
R-1
R-2
本地网络N-110.1.0.0
本地网络 N-2 10.2.0.0
河南中医药大学信息技术学院互联网技术教学团队／https://internet.hactcm.edu.cn
---
## Page 267
267
8.VPN 和 NAT
8.1虚拟专用网VPN
虚拟专用网VPN的实现：
基于隧道技术
源地址：125.1.2.3
目的地址：
加密的从×到丫的内部数据报
194.4.5.6
外部数据报的数据部分
数据报首部
125.1.2.3
194.4.5.6
互联网
Host-1
Host-2
LE
隧道
10.1.0.1
10.2.0.2
使用隧道技术
R-1
R-2
本地网络 N-110.1.0.0
本地网络N-2 10.2.0.0
河南中医药大学信息技术学院互联网技术教学团队／https://internet.hactcm.edu.cn
---
## Page 268
268
8.VPN和 NAT
8.1虚拟专用网VPN
口内联网intranet和外联网extranet
■均基于 TCP/IP 协议。
由部门A和B 的内部网络所构成的虚拟专用网VPN 又称为内联网（intranet)，表示
部门A和B都是在同一个机构的内部。
■某机构和其他的外部机构共同建立的虚拟专用网VPN又称为外联网(extranet)。
全球地址
125.1.2.3
194.4.5.6
Host-1
Host-2
L
10.1.0.1
10.2.0.2
R-1
R-2
本地网络N-110.1.0.0
本地网络 N-2 10.2.0.0
河南中医药大学信息技术学院互联网技术教学团队／https://internet.hacto
tcm.edu.cn
---
## Page 269
269
8.VPN 和 NAT
8.1虚拟专用网VPN
口远程接入VPN
■远程接入VPN（remoteaccessVPN）可以满足外部流动员工访问公司网络的
需求。
限中工玛网美互丶工工班
员工的PC机和公司的主机之间建立VPN隧道。
■外地员工与公司通信的内容是保密的，员工们感到好像就是使用公司内部的
本地网络。
---
## Page 270
270
8.VPN和NAT
8.1虚拟专用网VPN
口远程接入VPN
■对于个人"翻墙"行为的规定早已明确。
定》，该规定在1997年进行修正。
该《规定》第六条提出，计算机信息网络直接进行国际联网，必须使用邮电
部国家公用电信网提供的国际出入口信道。该规定明确要求，任何单位和个
人不得自行建立或者使用其他信道进行国际联网。如果违反第六条规定，由
公安机关责令停止联网，给予警告，可以并处15000元以下的罚款;有违法所
得的，没收违法所得。
---
## Page 271
271
8.VPN和 NAT
8.2网络地址转换NAT
■1994年提出。
需要在专用网连接到互联网的路由器上安装NAT软件。装有NAT软件的路
由器叫做NAT路由器，它至少有一个有效的外部全球IP地址。
所有使用本地地址的主机在和外界通信时，都要在门AT路由器上将其本地地
址转换成全球IP 地址，才能和互联网连接。
河南中医药大学信息技大
---
## Page 272
272
8.VPN 和 NAT
8.2网络地址转换NAT
网络地址转换 NAT (Network Address Translation)
= 10.1.0.1
S = 125.1.2.3
S
D = 211.69.32. 50
D = 211.69.32.50
125.1.2.3
Host-1
Server-1
互联网
10.1.0.1
211.69.32.50
R-1
NAT转换表
本地网络N-110.1.0.0
专用网地址
全球地址
10.1.0.1
125.1.2.3
211.69.32.50
211. 69.32.50
S
D
= 10.1.0.1
D = 125.1.2.3
河南中医药大学信息技术学院互联网技术教学团队／https://internet.hactcm.edu.cn
---
## Page 273
273
8.VPN 和 NAT
8.2网络地址转换NAT
口网络地址转换的过程
NAT 路由器。
■NAT路由器将数据报的源地址IPA转换成全球地址IPG，并把转换结果记录
到NAT地址转换表中，目的地址IP；保持不变，然后发送到互联网。
■NAT路由器收到主机 B 发回的数据报时，知道数据报中的源地址是IP；而目
的地址是IPG
■根据 NAT 转换表，NAT 路由器将目的地址IPG转换为IPA，转发给最终的
内部主机A。
---
## Page 274
274
8.VPN 和 NAT
8.2网络地址转换NAT
网络地址转换的过程
■在内部主机与外部主机通信时，在NAT路由器上发生了两次地址转换：
■离开专用网时：替换源地址，将内部地址替换为全球地址。
■进入专用网时：替换目的地址，将全球地址替换为内部地址。
NAT地址转换表举例
方向
字段
旧的 IP 地址
新的IP地址
出 (发往互联网)
源IP 地址
10.1.0.1
172.38.1.5
入 (进入专用网)
目的IP地址
172.38.1.5
10.1.0.1
---
## Page 275
275
8.VPN 和 NAT
8.2网络地址转换NAT
口网络地址转换
■当 NAT 路由器具有 n 个全球IP 地址时，专用网内最多可以同时有 n 台主机
接入到互联网。这样就可以使专用网内较多数量的主机，轮流使用门AT路由
器有限数量的全球IP地址。
■通过NAT路由器的通信必须由专用网内的主机发起。
1专用网内部的主机不能充当服务器用，因为互联网上的客户无法请求专用网
内的服务器提供服务。
NAT显然有巨大的缺陷
无法应用于较大规模的园区网
河南中医药大学信息技术学
m.edu.cr
---
## Page 276
276
8.VPN和 NAT
8.2网络地址转换NAT
口网络地址与端口号转换NAPT
■NAT并不能节省IP地址。
口为了更加有效地利用NAT路由器上的全球IP地址，现在常用的NAT转换表把运
输层的端口号也利用上。
口这样就可以使多个拥有本地地址的主机，共用一个NAT路由器上的全球IP地址，
因而可以同时和互联网上的不同主机进行通信。
■使用端口号的NAT叫做网络地址与端口号转换NAPT（NetworkAddressand
Port Translation).
口NAPT可以使多台拥有本地地址的主机，共用一个全球IP地址，同时和互联网上
的不同主机进行通信。
■不使用端口号的NAT就叫做传统的NAT(traditional NAT)。
河南中医药大学信息技术学院互
---
## Page 277
277
8.VPN和NAT
8.2网络地址转换NAT
口网络地址与端口号转换NAPT
NAPT把专用网内不同的源IP 地址，都转换为同样的全球IP 地址。但对源主
机所采用的TCP端口号（不管相同或不同），则转换为不同的新的端口号。
当NAPT路由器收到从互联网发来的应答时，就可以从IP数据报的数据部分
找出运输层的端口号，然后根据不同的目的端口号，从门APT转换表中找到
正确的目的主机。
---
## Page 278
278
8.VPN 和 NAT
8.2网络地址转换NAT
网络地址与端口号转换NAPT
125.1.2.3
Host-1
Server-1
互联网
10.1.0.1
211.69.32.50
R-1
Host-2
10.1.0.2
本地网络N-110.1.0.0
NAPT地址转换表举例
方向
字段
I旧的IP地址和端口号
新的IP地址和端口号
出
源IP地址:TCP源端口
10.1.0.1:30000
125.1.2.3:40001
出
源IP地址:TCP源端口
10.1.0.2:30000
125.1.2.3:40002
入
目的IP地址:TCP目的端口
125.1.2.3:40001
10.1.0.1:30000
入
目的IP地址:TCP目的端口
125.1.2.3:40002
10.1.0.2:30000
河南中医药大学信息技术学院互联网技术教学团队／https://internet.hactcm.edu.cn
---
## Page 279
279
8.VPN和NAT
8.2网络地址转换NAT
网络地址与端口号转换NAPT
河南中医药大学信息技术学院互联网技术教学团队／https://internet.hactcm.edu.cn
---
## Page 280
280
Thanks
---