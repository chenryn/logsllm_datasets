== 应用
对部分可固化的分析场景，日志易还提供比资源包更高级更完善的封装方式：应用。目前，日志易提供两种类型的应用：静态应用和动态应用。
静态应用指日志易出品的独立应用，包括有机器学习、大屏可视化、智能运维、事件管理等。独立应用的使用说明请参见各自独立的使用手册及内部帮助页面。
动态应用指用户可以在日志易平台基础上通过安装方式额外部署的、可删除和修改的应用。属于资源包的高级版本。一个动态应用在资源包的基础上，增加了自定义多级菜单，资源标签过滤，版本标识等功能。使用动态应用更像是一个完整而独立的系统。
=== 应用管理[[dynamic-app-manage]]
应用管理入口在日志易系统左上角，在"应用"-"自定义应用"浮层顶部点击"管理"，即可进入应用管理列表页。
image::images/app-list.png[]
用户对动态应用，可以编辑、使用、删除和导出。
导出操作，将自动在当前应用的版本号基础上加 1 。以保证同一名称的应用是在不断更新的。
新建操作，则是在一个空白应用的基础上完成应用导出。其版本号固定为 1 。
=== 应用基础属性配置
image::images/create-app.png[]
如上图所示，一个应用的属性有：
* 名称: 必填，在租户内唯一。可使用中文、英文字母、数字、下划线、短横线，且不可纯数字。
* 描述: 可选填写。
* 应用标识: 应用新建或导出时，所在的日志易系统使用的域标识(token)。不可修改。
* 出品人: 应用新建或导出时，所在的日志易系统的许可证记录的客户名称。不可修改。
* 版本: 整型数值，每次导出自动加 1 。不可修改。
* 菜单栏: 应用可以自定义系统二级菜单作为自己的菜单栏，采用多级菜单样式，支持外链。
+
当菜单指向具体资源的查看或编辑页时，请使用 UUID 格式的 url，而非自增 ID 格式，确保应用打包后导入其他平台依然可用。
+
例如：应使用的仪表盘 url 为：`/dashboard/09ac7122-57f8-4af3-aba2-2cc3ca166848/1ee8debe-ccde-4f4b-9df1-7cd9434fda21/`，而非 `/dashboard/3/3/`。
+
资源 UUID 在列表页点击展开属性详情中可见。特殊的，仪表盘标签页的二级 UUID 在查看页右上角点击复制。
+
image::images/app-resource-uuid.png[]
+
* 菜单颜色: 应用可以自定义系统二级菜单的颜色。
* 默认首页: 应用可以自定义自己的默认首页，在多级菜单中非外链选项里择一设置。如果访问者对该 URL 无权访问，则默认打开应用的属性查看页面。
* 资源配置: 应用内归属的资源。
+
注意：一个资源最多只能属于一个应用，所以当您选择归属的资源原本有其他所属应用时，资源会从原应用中去除。
* 资源范围: 可以设置在应用页面内查看时，只展示应用内归属的资源，其他内容不可见。
* Logo: 可以上传一个自定义小图标，作为应用在应用列表上的 icon 。
导出和编辑应用，与新建应用类似。
为保证导出的应用在其他客户或集群依然可用，强烈建议用户：
. 编写搜索语句时明确定义好 tag/logtype 等条件，避免使用 hostname/ip 等条件。
. 仪表盘、拓扑图、全链路图的手写钻取地址时，采用 UUID 格式的 url。
=== 安装应用
创建或从其他地方得到一个应用安装包后，在应用管理列表页点击"安装"进入应用安装流程。界面如下所示：
image::images/install-app.png[]
需要分配以下两个属性：
1. 角色：拥有该角色的用户，才能在应用列表里看到这个应用。
2. 数据集：可选，选中数据集后将替换应用包里所有搜索语句使用的数据集。同时用户请查看搜索权限确保搜索范围符合预期。
3. 替换字段配置：可选，选择启用后，应用更新时可以替换原来的动态字段配置。
=== 使用应用
用户可以在应用管理列表上点击"打开"进入应用，也可以直接在日志易顶部应用浮层里点击名称进入。打开应用后，可以看到设置的资源过滤、多级菜单和配色效果如下：
image::images/use-app.png[]
=== 应用内数据和字段配置
日志易支持在应用内，独立使用一些非系统全局可见的数据和字段配置。比如：KV 字典，字段别名，字段萃取等。其中 KV 字典无法导出，故而只能在应用编辑时添加，不能在新建应用时添加。而其他字段配置没有该限制。
[IMPORTANT]
====
应用内字段配置必须点击页面右上角的"保存"后，才会正式提交生效。 添加弹窗的"确定"按钮只是页面临时缓冲。
====
==== KV字典
KV字典使用arangodb中的库表数据扩展事件。KV字典可以通过REST API直接进行数据存取，也可以使用搜索命令lookup、inputlookup、outputlookup存取数据。
KV字典即是一种应用内的资源，也是权限可以操作的目标。用户可以通过角色授权对KV字典进行读取，编辑，转授等权限设置，详情请查看《日志易使用手册》的权限管理章节。
KV字典和CSV文件都可以扩充日志易系统的数据，在确定使用KV字典或CSV文件时，请参考以下因素：
[width="100%",options="header,footer"]
|====
|查询类型  |优点  |缺点  
|KV字典  |
* 启用每个记录的插入和更新。
* 允许对写入操作执行可选的数据类型。
* 允许您指定字段以提高搜索性能。
*提供对数据集的REST API访问。
|不支持不区分大小写的字段查找 
|CSV文件  | 
*对于较小或很少修改的文件，效果很好。
*CSV文件更易于手动修改，小于1M的文件提供在线编辑
*由于CSV是标准格式，因此与其他应用程序（例如Microsoft Excel）的集成更加容易。
*支持区分大小写的字段查找。
|
*需要完全重写文件才能进行编辑操作（outputlookup）。
* 不支持REST API访问。
|====
===== 新建KV字典
由于 KV 字典必须从属于某个 App，所以用户必须在 App 设置中进行 KV 字典的创建和管理操作。
点击"应用管理"，进入应用列表页，选定准备添加 KV 字典的应用，在该应用所在行右侧操作栏点击"编辑"，在应用设置页面上找到"KV字典"列表，可以对其进行新建，编辑，删除等操作。
image::images/kvstore-list.jpg[]
点击"添加"，在浮层中按提示填写字典配置，点击"创建"即可。如下图所示：
image::images/kvstore-new.jpg[]
其中：
* 开启强制类型转换，在写入数据时，待写入数据类型符合KV字典设置的类型，则写入，否则不写入直接丢弃。
* 关闭强制类型转换，在写入数据时，待写入数据类型符合KV字典设置的类型，则写入，否则将待写入数据类型转换为字符串类型进行写入。
===== 使用KV字典
已创建的KV字典可以在本App下通过lookup、outputlookup、inputlookup搜索命令使用，相关命令及参数详情请查看《日志易检索参考》。
非本App内页面中的搜索命令无法跨App使用KV字典。
也可以使用REST API创建KV字典、存取arangodb中的数据，详情请查看《日志易API使用手册》。