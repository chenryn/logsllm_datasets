Charles R. Kalmanek
EnterpriseSecurity:ACommunityofInterestBasedApproachPatrickMcDaniel∗mcdaniel@cse.psu.eduSubhabrataSen†sen@research.att.comOliverSpatscheck†spatsch@research.att.comJacobusVanderMerwe†kobus@research.att.comBillAiello‡aiello@cs.ubc.caCharlesKalmanek†crk@research.att.comAbstractEnterprisenetworkstodaycarryarangeofmissioncrit-icalcommunications.AsuccessfulwormattackwithinanenterprisenetworkcanbesubstantiallymoredevastatingtomostcompaniesthanattacksonthelargerInternet.Inthispaperweexploreabrownﬁeldapproachtohardeninganenterprisenetworkagainstactivemalwaresuchasworms.Thepremiseofourapproachisthatiffuturecommunica-tionpatternsareconstrainedtohistorical“normal”com-municationpatterns,thentheabilityofmalwaretoexploitvulnerabilitiesintheenterprisecanbeseverelycurtailed.Wepresenttechniquesforautomaticallyderivingindividualhostproﬁlesthatcapturehistoricalcommunicationpatterns(i.e.,communityofinterest(COI))ofendhostswithinanen-terprisenetwork.Usingtracesfromalargeenterprisenet-work,weinvestigatehowarangeofdifferentsecuritypoli-ciesbasedontheseproﬁlesimpactusability(asvalidcom-municationsmaygetrestricted)andsecurity(howwellthepoliciescontainmalware).OurevaluationsindicatethatasimplesecuritypolicycomprisedofourExtendedCOI-basedproﬁleandRelaxedThrottlingDisciplinecaneffec-tivelycontainwormbehaviorwithinanenterprisewithoutsigniﬁcantlyimpairingnormalnetworkoperation.1IntroductionTheoutbreakofthewittyworm[6],whichironicallyspreadthroughvulnerabilitiesincommercialdesktopse-curitysoftware,illustratestheimportanceofmulti-facetsecuritycountermeasures.Thiswasarguablytheﬁrstwidespreadwormtohaveatrulymaliciouspayload.Italsoappearsthatthereleaseofthewormwascoordinatedacrossmanyhosts,makingitnearlyimpossibletoidentifyitsori-gin.Becausethedesktopsecuritymechanismsweretotally∗SIISLaboratory,CSE,PennsylvaniaStateUniversity†AT&TLabs–Research‡ComputerScience,UniversityofBritishColumbiacompromised,littlecouldbedonetopreventinfection.Theperimeterdefenses(e.g.,ﬁrewalls)onlymarginallyaidedthesuppressionofthesewormsbecauseofthedifﬁcultyofdeﬁningandimplementingperimeterdefenses.Thislackofsecurityisparticularlytroublesomeinthecontextofcorporateenterprisenetworks.WhiletheInter-netitselfisbecominganincreasinglyimportantpartofto-day’seconomy,corporateenterprisenetworksstillcarrythevastmajorityofmissioncriticalcommunications.There-fore,asuccessfulwormattackwithinanenterprisenetworkwillbesubstantiallymoredevastatingtomostcompaniesthanattacksontheInternet.Furthermore,wormscanspreadinenterprisenetworkseveniftheyarecompletelyisolatedfromtheInternet.Forexample,wormsmightbeintroducedbylaptopsthatareusedbothoutsideandwithintheenter-prise,orbyunauthorizedsoftwareinstallationswithintheenterprise.Theseattacksareexacerbatedbythesheersizeofenterprisenetworks:enterprisenetworkscanspanmulti-plecontinents,connecttensofthousandsofmachines,andbeusedbyhundredsofthousandsofemployees.Thegoalofourworkistoimprovetheprotectionagainstwormsandsimilarsecuritythreatswithinenterprisenet-works.Whilethesenetworkscanbequitelargetheydoprovidecertainpropertieswhichmakeiteasiertoprotectthem.Inparticulartheytypicallyhaveaknownnetworktopology,haveknowledgeofallendhostsallowedonthenetwork,cancontroltheconﬁgurationonallroutersandswitcheswithinthenetworkandcaninstallsoftwareonev-eryhostdeployedintheenterprise.Wedenoteallhostswithintheenterprisenetworkinquestionasinternalhostsandallotherhostsasexternalhosts.Thestandardroleofﬁrewallsistoprotectinternalhostsfrompotentiallyma-liciousexternalhoststhattypicallytranslateintorulesfordroppingorpassingpacketsoriginatingfromexternalhostsdestinedforinternalhosts.Weacknowledgethatevenin-ternalnodesmaybecomemaliciouswhentheyarecompro-mised.Thuseachinternalnodeshouldalsobeprotectedfromotherinternalhosts.Inthesimplestinstantiationofourframework,thistranslatesintoasetofrulesfordroppingorallowingpacketswhereboththeoriginanddestinationareinternalhosts.Inthemostgeneralcase,thesetofrulesmaydeﬁneanarbitrarysubsetofthe4-tupledeﬁnedbyoriginanddestinationIPaddresses,protocol,anddestinationportnumberwheretheoriginanddestinationIPaddressesareforinternalhosts.Thedesignspaceforsuchasetofrulesisdeﬁnedalongthreeprincipleaxes:security,usability,andmanageability.Enterprisepoliciesmustbemanageabletobeusableinrealnetworks.Hence,werestrictourselvestosimplepoli-ciesthroughout.Moreover,forallthepolicies,wedescribemethodsforautomaticallypopulatingtherulesdeﬁningtheallowedinternal-to-internalcommunication.Theprimaryfocusofthepaperisananalysisoftheusabilityandsecu-rity,andthetradeoffsbetweenthem,ofthechosensetofmanageablepolicies.Ifoneenvisionsdesigninganddeployinganenterprisenetwork,includingallhardwareandsoftware,fromthegroundup,itmaybepossibletodesignandenforcequiterigidinternal-to-internalcommunicationpolicies.Butourworkdoesnotrequiresuchagreenﬁeldapproach.Ratherourworkisaimedatabrownﬁeldenvironment–anexistinglarge,complexenterprisenetwork.Insuchanenvironment,itis(inourexperience)nearlyimpossibletoimposerulesafterthefactwithoutseverelyaffectingusability.Thisisduebothtothediversityofuserrequirementsandtothecomplexityofexplicitandimplicithostcommunications.Moreover,itmaybenearlyimpossibleto“reverseengineer”byhandtheimplicit,existingenterprise-widepolicy–evenwithmanyhands.Inthispaper,wepresentmethodsforautomaticallygen-eratingthepoliciesbasedonseveralweeksoftrainingdata.Theessentialpremiseofthisapproachisthatiffuturecommunicationpatternsareconstrainedtohistorical“nor-mal”communicationpatterns,thentheabilityofmalware(e.g.,worms)toexploitvulnerabilitiesintheenterpriseisseverelycurtailed.Ofcourse,suchahistory-basedap-proachmayhinderbothusabilityandsecurity.Forusability,thisapproachmayblockaperfectlylegitimatecommunica-tionifitdidn’toccurinthetrainingperiod,whichisunde-sirable.Tohandlesuchpossibilities,ourpolicieshavetwocomponents.Theﬁrstisaproﬁle.Thisisasetofrulesdeﬁninginternal-to-internalpacketsthatareallowed.Sev-eralofthepoliciesweintroduceallowforaspeciﬁedrateofout-of-proﬁlecommunication.Therate,andtheactiontotakewhentherateisexceededisgivenbythethrottlingdiscipline(TD),asecondcomponentofourpolicies.Ourhistory-basedapproachmayalsocompromisesecurityifil-legitimatecommunicationispartofthetrainingset.Weassumethataftercreation,theproﬁleisscrubbedforillegit-imaterulesbasedonthebehaviorofknownworms.Werelyonmultipleheuristicsintroducedinourpreviouswork[16]toreducetheamountofillegitimaterulesbeforetheproﬁlesarederived.Weshouldmakeabriefnotehereaboutenforcementofourpolicies.Ourinternal-to-internalcommunicationpoli-ciescanbeenforcedateithertheoriginorthedestination,ortheswitchorhubjustupstreamordownstream,respec-tively,andtheworkpresentedinthispaperisagnostictothatdecision.However,themotivatingperspectiveofthepaper,i.e.,ofviewingenterprisehostsaspotentiallymali-cious,suggeststhatenforcementshouldbeasclosetothepotentiallymaliciousentityaspossible,i.e.,attheoriginat-inghostsortheupstreamswitch.Thisisconsistentwiththeacceptedsecuritypracticeofdeployingtheenforcementasclosetothesourceaspossible.Asaspeciﬁcexampleoftheadvantageofsuchaplacement,severalfastspreadingwormssuchasSlammereffectivelyimplementedadenial-of-serviceonenterprisenetworksevenforuninfectedma-chinesasthewormoverwhelmedthecapacityofmanyLANsegments.Policyenforcementofout-of-proﬁletrafﬁcattheoriginmitigatesthistypeofbandwidthDoS.Asweshalldiscussindepthbelow,aprimaryconclu-sionofouranalysisisthatinorderforapolicytohavebothreasonablesecurityandusability,itmustdifferenti-atebetweencommunicationsthatuseﬁxedserverportnum-bersandthosethatusesomewhatrandomportnumbersthataredeﬁnedontheﬂy(e.g.,agreeduponovertheﬁxed-portcommunication).Werefertothelatterasephemeralports.Inprinciple,giventheproﬁleofallowedﬁxed-portcommunication,itispossibletodynamicallypopulateandenforcerulesforephemeral-portcommunication.Allsuchapproaches,however,requireanadditionalprotocoland/ormodiﬁcationstoexistingprotocolsoftware.Whilesuchap-proachesmayeventuallyallowforﬁned-grainedcontrolofephemeralports,intheinterestofdeployability,inthisworkweconsideredonlyarestricteddesignspaceofpoliciesthatareenforceableinahostoraswitchwithouttheuseofaddi-tionalprotocolsorthemodiﬁcationofexistingapplicationsoftware.Theremainderofthepaperisstructuredasfollows.Sec-tion2presentsrelatedwork.Section3introducesthedatasetweused.InSection4wedescribeourapproachofbuild-ingendhostproﬁlesanddescribesthedifferentthrottlingdisciplinesthatweinvestigate.Wethenevaluatetheusabil-ityandsecurityofourpoliciesinSection5andSection6respectively.ThepaperconcludesinSection7.2RelatedWorkAdministratorsintheearlydaysoftheInternetreliedal-mostexclusivelyonnetworkperimeterdefenses.Perime-terdefenseswereprimarilyimplementedthroughﬁrewallsthatphysicallygovernthetrafﬁcenteringandleavingthenetwork.Managingtheoftenlow-levelaccesscontrolsonﬁrewallshasshowntobequitcomplexandmultipleefforts2havefocusedtoeasethisburdenonthenetworkoperator[4,1,2,10,18].Despitethoseefforts,perimeterdefensesbecamelessef-fectiveastheInternetgrew.Enterprisesbegantoemploythemyriadoftechnologiesandapplicationsattheirdisposal,e.g.,multi-media,B2Bapplications,remotedata.Theseservicesrequiredsigniﬁcantlymoreaccesstoresourcesex-ternaltotheenterprise.Hence,theperimeterwasneces-sarilyweakenedasmorechannelstotheseserviceswereopened.Bellovinaddressedthedissolvingperimeterbyap-plyingtheﬁrewallpoliciesateachend-point[3,9].Cen-tralizedentitiesinhisdistributedﬁrewallsystemdistributeﬁrewallpoliciestoeachhostinthenetwork.Becauseglobalpolicyisenforcedthroughtheaggregatebehaviorofhost,thedissolvingperimeterislessproblematic.Personalﬁre-walls(e.g.,host-levelﬁrewalls)arenowcommonfeaturesofalmostallcommercialandopensourceoperatingsys-tems.Thereareseveraldifferencesbetween[3,9]andtheworkpresentedinthispaper.Wealsoenvisionenforce-mentofcommunicationpoliciesat,orcloseto,theend-host.However,ourpoliciestreattheend-hostaspotentiallyhos-tileandseektoprotecttherestoftheenterprisenetworkbyblockingillegitimatepacketsemanatingfromthatend-host.Theperspectiveof[3,9]istoprotecteachendhostfromotherpotentiallyhostilehostsandisprimarilyconcernedwithblockingillegitimatepacketsatthedestination.Inad-dition,weconsidertheissuesofbrownﬁelddeploymentandout-of-proﬁlethrottlingdisciplines.Ourworkisalsorelatedtomorerecentlyproposed,introspectivenetworksystems.EarlysystemssuchasGrIDS[15]usedmodelsofnormalconnectivitygraphstodetectmaliciousbehavior.Thesesolutionswereusefulindetectingscanningattacks.Aswormandvirusbehaviorbe-gantobebetterunderstood[14,12],previousgraphbasedmechanismswerereplacedwithmoresophisticatedbehav-ioralmodels.Forexample,Staniford’sCounterMalice[13]usesthenetworkinfrastructuretodetectandcounteractma-liciousactivity.AmodelofnormalactivityisgleanedfromhistoricaldatareﬂectingbothnumberofuniqueIPad-dressestowhichaconnectionisattemptedandthenum-beroffailedconnectionattempts.Thismodelofnormalbehaviorisusedtodetectabnormalbehaviorthatisthenblocked.Thisvirusthrottling[17]cangreatlyreducetheinfectionrateofaworm.Ourworkdiffersfromtheseear-lierapproachesinanumberofways.Firstisouruseofcommunitiesofinterest(COI)toderivethemodelofnor-malbehavior.ThisbuildsonourearlieranalysisofCOIinenterprisenetworks[16]andis,toourknowledge,theﬁrstapplicationoftheCOIconcepttodatanetworks.Second,isthefactthatweusethemodelofnormalbehaviornottodetectabnormalbehavior,buttocontroltheextenttowhichabnormalcommunicationisallowed.Thisisasubtlebutsigniﬁcantdifferencebecausethereisno“detectionphase”andthereforehostsareprotectedassoonasthesecuritypol-icyisinplace.3ExperimentalDataCollectionandPrepro-cessingToperformtheanalysispresentedinthispaper,wecol-lectedelevenweeksworthofﬂowrecordsfromasinglesiteinalargeenterpriseenvironmentconsistingofmorethan400distributedsitesconnectedbyaprivateIPbackboneandservingauserpopulationinexcessof50,000users.TheﬂowrecordswerecollectedfromanumberofLANswitchesusingtheGigascopenetworkmonitor[5].TheLANswitchesandGigascopewereconﬁguredtomoni-toralltrafﬁcformorethan300hoststhatincludeddesk-topmachines,notebooksandlabservers.A150hostsub-setofthese300machinescommunicatedduringtheentireeleven-weekperiod.Werefertothissmallersetasthelo-calhostsandtheyformthefocalpointofouranalysis.Inadditiontosomecommunicationamongstthemselves,thelocalhostsmostlycommunicatedwithotherhostsintheenterprisenetwork(referredtoasinternalhosts)aswellaswithhostsoutsidetheenterprise(i.e.,externalhosts).Thelattercommunicationisexcludedfromouranalysis.Dur-ingtheeleven-weekperiodwecollectedﬂowrecordscor-respondingtomorethan4.5TByteofnetworktrafﬁc.InthisstudyweonlyconsideredTCPandUDPtrafﬁc.Wealsoremovedweekenddatafromourdataset,thusensur-ingamoreconsistentper-daytrafﬁcmix.Ourmeasurementinfrastructuregenerated“raw”ﬂowrecordsthatwerepro-cessedusingthesametechniquesdescribedin[16].Insum-marythisprocessingremovedallunwanted(abnormal)traf-ﬁcfromthedata,dealtwithDHCPissues,andtaggeddatawithclient/serverdesignationsbasedonwhetherahostwasinitiatingcommunicationorlisteningonasockettoallowotherhoststocommunicatewithit.4SecuringtheEndHostOurapproachistodeviseanindividualpolicyforeachendhostbasedonthehistoricalsetofotherhostsintheenterprisewithwhichitinteracts,i.e.,itsCommunityofIn-terest(COI).Weperformthistaskintwosteps.First,wedevelopaCOIProﬁleofeachendhost.Thegoaloftheproﬁleistocapturewhatcommunicationisnormalforaparticularhost.Duetothecleaningthatweperformonourdata,wemakethereasonableassumptionthatthedatasetweuseforouranalysiscontainsonlylegitimatetrafﬁc.InthesecondstepwedeﬁneThrottlingDisciplines(TDs)thatdeﬁnewhatshouldhappenifahostattemptstocommuni-cateoutsideofitsproﬁle.Foreachhost,thecombinationofitsproﬁleandTDisusedtorestrictandcontrolfuture3communication.Wefocusinparticularonpoliciesthatcanbeeasilyimplementedasaccesscontrollists(ACLs)ontheswitchthatconnectsthehosttotherestofthenetwork.Itshouldbeimmediatelyapparentthatrestrictingcommuni-cationinthiswaywouldhavedesirablesecurityproperties,becausecommunicationoutsidethe“normal”proﬁlecanberestricted.Atthesametime,however,communicationisneverstaticandthesystemshouldminimizedisruptionsoflegitimatetrafﬁcthatfallsoutsideofthehistoricalproﬁles.Indeed,thistensionbetweentheusabilityofourapproachanditssecuritybeneﬁtsformsthebasisforourevaluationinSections5and6.4.1COIProﬁlesInourapproach,allCOIproﬁlesareconstructedbyana-lyzinghistoricnetworkcommunicationforhostswithinanenterprisenetworkduringaproﬁletrainingperiod.ThegoalofaCOIproﬁleistwofold.Firstitcapturesthehis-toriccommunicationofasetofendhosts,andsecond,thishistoryisusedtopredictthehost’sfuturecommunicationbehavior.Proﬁlesdifferintermsofthedomainknowledgeusedtoconstructthem,i.e.,protocolspeciﬁcinformation.ThemostbasicofsuchproﬁlesthatwedenoteasSimpleCOIPro-ﬁlesdonotconsideranydomainspeciﬁcknowledge,ratheritonlyconsidersinformationfromthe4-tuple:(protocol,clientIP,serverport,serverIP).1NotsurprisinglyaSimpleCOIProﬁlethatconsidersportlevelinformationwillhavegreatdifﬁcultypredictingthehost’sfuturecommunicationbehaviorinthepresenceofapplicationsthatuseephemeral-portcommunicationsuchasFTPandmoststreamingpro-tocols.Tocompensateforthepresenceofephemeral-portcommunicationweinvestigatetwoalternateapproaches.IntheﬁrstapproachwestillconsideronlySimpleCOIProﬁlesbutusewildcardsforsomeoftheﬁeldsinthefour-tuple.Aswewillseethisapproachleadstoproﬁleswithunaccept-ablesecurityproperties.ToaddressthiswealsoinvestigateaheuristicthatcompensatesforephemeralcommunicationwhilestillconsideringtheserverportwithintheproﬁlethatwecalltheExtendedCOIProﬁle.4.1.1SimpleCOIProﬁlesForagivensetofclientswedeﬁnepurehistorybasedpro-ﬁlesatthefollowingthreelevelsofgranularity:1.Protocol,Client,ServerPort,ServerProﬁle(PC-SPP)-ThePCSPPproﬁlecontainsall(protocol,client1Werefrainfromconsideringclientportfortworeasons.First,clientportnumbersarenottypicallymeaningfulandthereforewillhavenobear-ingontheclientproﬁle.Second,aswewillshowinSection5,aproﬁlethatconsidersserverportsisalreadyoverlyrestrictivethushamperingitsusability.IP,serverport,serverIP)tuplesofhistoriccommuni-cationsforthegivensetofclients.Thisproﬁlemostcloselyrepresentspastcommunication.2.Protocol,Client,ServerProﬁle(PCSP)–ThePCSPproﬁlecontainsallthe(protocol,clientIP,serverIPaddress)tuplesforthegivensetofclients.Inotherwords,inthiscase,ifaparticularclientcommunicatedwithaparticularserveronanyport,weconsidercom-municationonallportsbetweentheclientandservertobepartoftheproﬁle.3.Protocol,ServerProﬁle(PSP)–ThePSPproﬁlecon-tainsall(protocol,serverIPaddress)tuplesforthegivensetofclients.Forthisproﬁle,ifanyclientcom-municatedwithaserver,thencommunicationbetweenallclientsandthisserver(onallports)isconsideredpartoftheproﬁle.4.1.2ExtendedCOIProﬁleTheobservationthathistoricalcommunicationonephemeralportsisnotaverygoodpredictorofportnumbersusedforfutureephemeralcommunicationiskeytoderivinganExtendedCOIproﬁle.Intuitivelytherearethreepartstoourapproach.First,wepartitionthetrainingdataintoephemeralandnon-ephemeralcommunication.Second,thenon-ephemeraltrainingdataisuseddirectlytoderivetheﬁrstpartoftheExtendedCOI.Third,fortheephemeraltrainingdata,weassumethatpastcommu-nicationisagoodpredictorofthefutureoccurrenceofephemeralcommunicationbetweenthehostsinquestion.However,suchfuturecommunicationmightnotbeontheobservedserverports,andthereforewederiveamorerelaxed(inclusive)proﬁlefortheExtendedCOIproﬁle.Acriticalpartofthisapproachistheaccuratepartition-ingofthetrainingdata.Ratherthanrelyingonvariousman-uallyderivedheuristics(e.g.,thresholdingorapplicationheuristics),weoptedtouseanautomateddataclusteringap-proach.Ratherthanattemptingtoidentifyephemeralcom-municationsdirectly,wegothroughtworoundsofidentify-ing(andremovingfromthetrainingdata),non-ephemeralcommunication.Foreachtransportprotocol,i.e.,TCPandUDP,thefollowingstepsareexecuted:1.Non-ephemeralGlobal:Intheﬁrststepthealgorithmconsidersthesetofserverportsandidentiﬁesthoseportsthatareheavyhittersintermsofthenumberofassociatedconnectionsthatareusedbylargenumbersofservers.Intuitively,thisidentiﬁestheportsassoci-atedwithpopularﬁxed-portservicesthatarerunningonmultipleservers.Wemodelthisasamultidimen-sionalclusteringproblemwherethe2dimensionsare(i)numberofconnectionsperportand(ii)numberofserversusingthatport.Eachportcanberepresentedas4apointinthis2-dimensionalspace.Wethenusethek-meansunsupervisedstatisticalclusteringalgorithm[7]toseparatetheheavyhitterportsfromtheothers.Givenasetofpointsinann-dimensionalspace,andadesirednumberofpartitionsk,k-meansperformsanit-erativepartitioningwhichminimizesthesum,overallclusters,ofthewithin-clustersumsofpoint-to-cluster-centroiddistances.Ourinputstothek-meansalgo-rithmareallportsthatwereusedasserverportsonmultipleservers.Eachportpisrepresentedbythetu-ple(np,sp)wherenpisthenumberofconnectionsonthatserverportandspthenumberofserversthatusedportp.Wesetkto2toseparatetheheavyhittercluster,andusedsquaredEuclideandistanceasthedistancemeasureforclustering.Beforeapplyingk-meansclusteringweperformthefollowingoperations.(i)Logtransformation:inordertoreducetheeffectofoutliersatthehighendofthevaluerange,transformthedatavaluesforeachvari-abletoalogarithmicscale.(ii)ScaleStandardization:The2variableshavedifferentscales.Wenormalizethemonacommonscaletoavoidonevariablefromdominatingtheotherintheclustering.Weselectedthewidelyusedz-scorenormalization.Z-Scoreisdeﬁnedasx=(v−mean(v))/stdev(v),wherevisthein-putvariable,andthetransformedscoreshaveameanofzeroandastandarddeviationofone.Thek-meansalgorithmusesrandomlyselectedinitialcentroidlocations.Poorlyplacedcentroidsmaydrivethek-meansclusteringtoalocalminimum.Toad-dressthispossibility,werepeatthek-meansclustering100times,eachwithanewsetofrandomlyselectedinitialclustercentroidpositions,andselectthesolu-tionwiththelowestvalueforthetotalsumofwithin-clusterpoint-to-centroiddistances.Thek-meansstepyields2distinctclusteringsofthepoints.Theﬁrstonecorrespondstopointsclusteredaroundlowvaluesofnumberofconnectionsandnumberofservers.Thesecondclusterconsistsofpointsthathavehighval-uesalongthesedimensions.Theportscorrespondingtothesepointsareselectedastheglobalportsforthetransportprotocolprotbeingconsidered.Wederivethefollowingproﬁlefortheseports.Thetuple(c,s,p,prot)isaddedtotheproﬁleiftherewasaclientccommunicatingwithaserversonglobalserverportpwithprotocolprot.2.Non-ephemeralPer-Server:Weremovefromthetrainingdataallthecommunicationsassociatedwiththeglobalportsidentiﬁedabove.Inthenextstepweaimtoidentifyfromamongtheremainingports,those(server,port)pairsthathavesigniﬁcantcommunica-tions.Intuitively,eachsuchpaircorrespondstothatserverrunningnon-ephemeralcommunicationsoverthatserverport.Weusethek-meansclustering(de-scribedabove),withk=2forclusteringbasedonnumberofconnectionsfromeach(server,serverport)pair.Weselecttheheavyhitterclusterasthesetofper-serverports.Thetuple(c,s,p,prot)isaddedtotheproﬁleiftherewasaclientccommunicationwithaserversonserverportpwithprotocolprot,wherethepair(s,p)belongstotheheavyhitter(server,serverport)set.Foreachservers,wealsocomputethelistofportsPs,whichwillbeusedinthenextstep,thatareeitherintheglobalportlistorintheheavyhitterportlist.3.Ephemeral:Thenextstepistoidentify,fromthere-mainingcommunicationsthoseclient-serverpairsthatcommunicateonmanyports,i.e.,client-serverpairsengaginginephemeralcommunication.Weusek-meansclusteringtoclustertheclient-serverpairsintoaheavy-hitterandnon-heavy-hitterclusterbasedonthenumberofportsthesepairscommunicateon.Fortheidentiﬁedheavyuserpairs(c,s),weaddrulestotheproﬁlethatwouldallowcommunicationbetweenthepaironallports,exceptthesetofglobalportsortheper-serverheavyhitterports(setPs)forthatserver.ThisexclusionisgearedspeciﬁcallytoprotecttheportsinPswhicharerunningpopularﬁxed-portservices.4.Non-EphemeralUnclassiﬁed:Intheﬁnalstepallre-mainingcommunicationsthathavenotbeenclassiﬁedthroughtheprecedingstepsareaddedtotheproﬁleasnon-ephemeralcommunication.I.e.,iftherewasaclientccommunicatingwithaserversonserverportpwithprotocolprot,thenweaddthetuple(c,s,p,prot)totheproﬁle.4.2ThrottlingDisciplinesWeconsiderthefollowingThrottlingDisciplines(TDs):(i)n-r-Strict:An-r-strictTDblocksallout-of-proﬁlecommunicationandblocksallcommunicationofaclientifthenumberofout-of-proﬁleattemptsexceedathresholdnwithinatimeperiodr.nmightbe0inwhichcaseallcom-municationisblockedassoonasoneout-of-proﬁlecommu-nicationisattempted.(ii)n-r-Relaxed:An-r-relaxedTDallowsnout-of-proﬁlecommunicationstosucceedwithinatimeperiodr.Ifthenumberofout-of-proﬁleinteractionsexceedathresholdnwithinatimeperiodr,allfuturecom-municationisblocked.Forn=0thispolicyisequaltothe0-strictpolicy.(iii)n-r-Open:An-r-openTDallowsnout-of-proﬁlecommunicationswithinatimeperiodr.Itblocksallout-of-proﬁlecommunicationswhenthenumber5ofout-of-proﬁleinteractionsexceedathresholdnwithinatimeperiodr,butneverblocksin-proﬁlecommunications.5UsabilityInthissectionwediscusstheusabilityoftheproﬁlesandthrottlingdisciplinesweproposed.Inparticularweevalu-atethreeaspectsofusability.Firstwediscussthedifferentproﬁlesizesthatwillimpactthecomplexityrequiredtoim-plementsuchaproﬁleonanetworkdevice.Secondlyweinvestigatehowwellproﬁlesbuiltusingtheﬁrstfourweeksofourdatasetmatchcommunicationinthenextfourweekstoprovidesomeinsightinhowwellproﬁlespredictfuturecommunication.InthelastevaluationofthissectionwesimulatethethreeTDs.5.1ProﬁlePropertiesSinceourproﬁlesneedtobespeciﬁedwithinthenet-workdevice(switch/router/ﬁrewall)thatenforcesourTDs,thesizeofeachproﬁleisofparticularimportance.Usingtheproﬁleswederivedfromtheﬁrstfourweeks,wecom-putedthenumberofrulesneededtospecifytheproﬁle.Inthiscontextarulehasslightlydifferentdeﬁnitionsforthedifferentproﬁles.Forsimplehistorybasedproﬁles,aruleisdeﬁnedasthen-tuplecoveringtheﬁeldsincludedintheproﬁle.ThismeansthatthePCSPPrulesaredeﬁnedasthefollowing4-tuple(c,s,p,prot).ThePCSPrulesarea3-tuplecovering(c,s,prot)andthePSPrulesarea2-tupleincluding(s,prot).Incontrast,theExtendedCOIPro-ﬁlehastwotypesofrules.Theﬁrsttypeofrulescoversallnon-ephemeralcommunicationandisrepresentedbya4-tupleidenticaltothePCSPPrules.Thesecondtypeofruledescribesephemeralcommunication.Theserulesarerepresentedbyatuplerepresentingaclient,aserverandasetofportranges.Wedenotetheserulesasrangerules.AsexpectedtherulecountsforthethreesimpleCOIpro-ﬁles(PSP,PCSP,PCSPP),showninTable1,showanin-creasingnumberofrulesasmoreIPheaderﬁeldsareaddedtotheproﬁle.Theseproﬁlesshowa4.2to6.3foldincreaseinrulesgoingfromapurelyserverIPaddressandprotocolbasedrulesettoarulesetbasedonclientIPaddress,serverIPaddressandprotocol.Interestingly,thefurtherincreaseinproﬁlerulesiftheserverportisaddedis59%forTCPwhereasforUDPtheproﬁlesizeincreases374%.Thisre-sultconﬁrmstheintuitionthatTCPserverportsaremorestablethanUDPserverports.ThenumberofrulesneededtospecifytheExtendedCOIproﬁleisonlyslightlylargerthanthenumberofrulesinthePCSPPproﬁle.InboththeUDPandTCPcaseswerequiredlessthan400ephemeralrulesforourclientsetof150hosts.Overallwecanconcludethatourproﬁlesizesarequitemanageable.Evenforthelargestproﬁle(ExtendedCOI)werequireonaveragelessthan100rulesperclienttocapturetheclientscommunicationpattern.Nextweconsiderthequestionofhowwellthehistory-basedproﬁlespredictfuturebehaviorofclients.Figure1showstheempiricalCDFofconnectionsperclientinweeks5to8ofourdatasets.Intherestofthissectionwewilluseweeks5to8astestweekstovalidatetheproﬁleswederivedfromthedatacollectedinweeks1to4.Therefore,abasicunderstandingofthetrafﬁcinweeks5to8isofinterest.Firstwecanobservethatweseesimilardistributionsinall4weeksfortheempiricalCDFofthenumberofclientcon-nections.Thisallowsustoconcludethateachofthe4testweekshasacomparablemixofclienttrafﬁc.Inadditionweobservethatmorethan45%oftheclientshavemorethan1000connectionswithintheenterprisenetworkperworkweek,areasonablemodelfornormaluserbehavior.Usingthesetestweeks,wecountedthenumberofcon-nectionsnotwithinthePCSPPproﬁle.Figure2depictstheempiricalCDFofsuchconnections.Thenumberofmissedconnectionsisfairlyhigh.Forexample,20%oftheclientsmissatleast100connectionsperweekineachoftheweeks.Althoughthisnumberisnotoutrageouslyhigh,itisstillfairlysigniﬁcant.Notethatthemisscountisreallyacon-servativeestimateofthetrueuserimpactanddoesnotac-countforcollateralimpact.Forexample,the0-r-StrictTDwillblockalltheout-of-proﬁleconnections,aswellasallin-proﬁlecommunicationsduringablockingevent.Thishighlightstheneedforapolicythatallowsforsomelevelofout-of-proﬁlecommunicationstoaccommodatenormalchangesincommunicationpatterns.5.2UserImpactWeestimatetheimpactonauserforagivenproﬁleviasimulationofallcombinationsofproﬁlesandpoliciesun-dervariousparametersettings.Thegoalofthesimulatoristodeterminehowmanylegalconnectionswouldhavebeenblockedinthesimulatedenvironment.Thesimulatorusesanout-of-proﬁlecountercthatcountsthenumberofout-of-proﬁleconnections.ItiseitherresetafterthetimeperiodrspeciﬁedintheTDormanuallybythenetworkopera-torfollowinganinvestigationoftheevent.Asourdatahasbeencleaned,inthissectionweassumethatalleventsarecausedby“good”trafﬁcthathappenstobeout-of-proﬁle.Aneventoccurswhentheout-of-proﬁlecountercexceedsthethresholdnofallowedout-of-proﬁlecommunicationsbeforecisbeingreset.Therefore,thesimulatorconsidersthefollowingparameters:•Proﬁle:Thederivedproﬁlesnamely,PSP,PCSP,PC-SPP,andextendedCOI.•TD:Thethrottlingpoliciesnamely,STRICT,RE-LAXED,andOPEN.•n:Theallowedout-of-proﬁlethreshold.Weinvesti-gatedvaluesof0,1,5,10,15,and20.6AlgorithmProtocoln-tuplerulesrangerulesTotalPSPTCP7050705PCSPTCP300103001PCSPPTCP477504775ExtendedCOITCP44433384781PSPUDP3160316PCSPUDP201402014PCSPPUDP956309563ExtendedCOIUDP91933899582Table1.ProﬁleSizes0.10.20.30.40.50.60.70.80.910.1110100100010000100000 CDF  conn_total W5W6W7W8Figure1.TotalConnectionsperClient0.10.20.30.40.50.60.70.80.910.1110100100010000 CDF  conn_outprof W5W6W7W8Figure2.MissedConnectionsperclientinPCSPP•r:Thecounter-reset-timerristhetimeinterval2inwhichweresetctozero.Weinvestigated1hourand1day.•BlockTime:Thetimeperiodittakesanoperatortoinvestigateaneventandunblockaclient.Afteraclientisunblockedcissettozero.Weinvestigatedvaluesof1minute,10minutesand1hour.•TestWeek:Theweekforwhichweperformedthesimulation.Weusedalltestweekswhichareweeks5-8.Thesimulatormeasuresthenumberofblockedconnectionsandblockingevents.5.2.1SimpleCOIProﬁleBasedSimulationResultsWeperformedsimulationsforallSimpleCOIbasedpro-ﬁlesunderthevariousparametersettings.Toreducetheparameterspace,wethengroupedallresultsforagivenpro-ﬁle,TD,n,blocktime,andrsetintoasinglerepresentingthenumberofblockedconnectionsper(client,week)tuple.Sincethetestweekshavesimilarempiricaldistributions,asshowninFigures1and2,webelievethatthiscombinationhasminimalimpactontheresultspresentedwhilesimplify-ingthepresentationoftheresultsinthismultidimensionalparameterspace.BlockedEvents:Figure3depictsthenumberofeventsforthe50%-tileand90%-tileof(client,week)tuples.These2Analternateapproachtoresettingcafteraﬁxedintervalwouldbetouseaslidingwindowofsizer.Wechosetheinterval-basedapproachsinceitlendsitselftoasimplerimplementationtwoﬁgurecoversallthreeTDssincethenumberofeventsisindependentofthechosenTD.Thereasonforthisindepen-denceisthataneventistriggeredwhentheTDthresholdnisreached,whichrepresentsthestartofaneventinallthreeTDs.TD-speciﬁcblockingactionistakenforthedurationoftheblocktime,butdoesnotcomeintoplayifweareonlyconsideringeventcounts.Theout-of-proﬁlecount,c,isre-seteitherafteraneventoraftertheresettimeexpires.ThetimesinthiscycledonotdependontheTDused,therefore,theeventcountisindependentoftheTD.InFigure3theblocktimewasﬁxedto10minutestoinvestigateablockingevent.Asexpectedthegraphsshowthatthenumberofeventsdecreasesasnincreases.Infactforn=10the50%tilegraphshowsonly1eventper(client,week)pairforthemostrestrictiveSimpleCOIbasedpro-ﬁle.The90%tileeventgraphshowsthattheeventcountincreasesbymorethananorderofmagnitude.BlockedConnections:InFigures4,5,and6,weshowthe50and90%tileresultsofthenumberofblockedconnec-tionsforOPEN,RELAXEDandSTRICTTDsrespectively.ItisnotsurprisingthattheOPENTDperformsbestinboththe50%tileand90%tile.Thisisbecausetheinproﬁlecom-municationisneverblocked.However,aswewillseeinthesecurityanalysis(Section6)thisTDallowsallvulnerablein-proﬁleserverstobeinfectedbyaspreadingworm.IncontrasttheRELAXEDandSTRICTTDblockallcommu-nicationsafteraneventwhichhasamodestimpactonthe50%tilenumberofconnectionsblockedper(client,week)butadramaticimpactonthe90%tilenumberofconnections7012345605101520 No. of event_blk Npcspp,RST =86400pcsp,RST =86400psp,RST =86400pcspp,RST =3600pcsp,RST =3600psp,RST =3600(a)50%tile05101520253035404505101520 No. of event_blk Npcspp,RST =86400pcsp,RST =86400psp,RST =86400pcspp,RST =3600pcsp,RST =3600psp,RST =3600(b)90%tileFigure3.NumberofBlockingEventsusing10minuteblocktime05101520253005101520 No. of conn_blk Npcspp,RST =86400pcsp,RST =86400psp,RST =86400pcspp,RST =3600pcsp,RST =3600psp,RST =3600(a)50%tile010020030040050060005101520 No. of conn_blk Npcspp,RST =86400pcsp,RST =86400psp,RST =86400pcspp,RST =3600pcsp,RST =3600psp,RST =3600(b)90%tileFigure4.BlockedConnectionsforOPENpolicyusing10minuteblocktimeblockedper(client,week).Thereasonisforthisisthatifabusyclienttriggersanevent,manyinproﬁlecommunica-tionssuffer.InadditiontheSTRICTTDalwaysblocksoutofproﬁlecommunicationsevenifnoeventoccurs.Com-paredtotheRELAXEDTD,thisslightlyincreasesthenum-berofblockedconnectionsper(client,week)forsmalln(infactthetwoTDsareequalforn=0)butshowsalargerim-pactforlargen.ItisnotsurprisingthattheSimpleCOIbasedproﬁlesarebecomingsubstantiallylessusableasadditionalIPheaderﬁeldsareconsidered.Forexample,fortheRELAXEDTDinFigure5,thenumberofblockedconnectioninthe90%tilegraphdiffersbythreeordersofmagnitudebetweenPSPandPCSPPforn=1.Althoughthiswouldindicatethatfromausabilitypointofviewweshouldchooseoneofthelessrestrictiveproﬁles,wewillseeinSection6thatthesecuritypropertiesofthePSPandPCSPproﬁlesarenotacceptableforalargenumberofenvironments.AnotherobservationwecanmakefromFigures3to6isthatr,whichwevariedbetween1hour(RST=3600sec-onds)and1day(RST=86400seconds),doesseemtoimpacttheresultssub-linearly.Innearlyallcasesadoublinginnimprovestheresultsapproximatelythesameamountasthereductionsoftherfrom1dayto1hour.Sincetheamountofoutofproﬁlecommunicationwhichispossiblewithouttriggeringaneventislimitedbytherateoprate=n/ritseemsbeneﬁcialtochosearof1daywhichis24timeslargerthanthe1hourresettimeandcompensatefortheincreaseineventsorblockedconnectionsbydoublingn.Theresultingoprateistherefore12timessmallerwhilewepreservethesameusabilitycharacteristics.Theoprateisparticularlyimportantforslowspreadingwormswhichcanonlyspreadundetected(withouttriggeringanevent)iftheyinitiateoutofproﬁleconnectionswitharatesmallerthanoprate.BlockedTime:Basedontheresultsofpreviousexperi-ments,wechosen=10,r=1dayandtheRELAXEDTDfortheremainingevaluations.ThischoicewasmotivatedbythefactthatforthetestedTDsandparametersettingsalargernseemstoproducediminishingreturns.Inaddition,asdiscussedabove,choosingarof1daygreatlyreducestheundetectedprobingaslowspreadingwormcanperformwithoutimpactingthenumberofeventsorblockedconnec-tionsper(client,week)substantially.TherelaxedTDwaschosensincetheOPENTD,aswewillseelater,istooper-missivefromasecurityperspectivewhiletheSTRICTTDproducesahigheruserimpact.Usingthesesettingswenowinvestigatetheimpactoftheblocktime.Thisparameterisdeterminedbyhowquicklynetworkoperatorsreactandisnotaparameterthatcanbechosenfreely.Theresults,showninFigure7,indicatethatthenumberofconnectionsblockedper(client,week)in-creasessub-linearlywithincreasingblocktime.Weobservethatablocktimeof10minutes(whichrequiresthenetwork802040608010012014005101520 No. of conn_blk Npcspp,RST =86400pcsp,RST =86400psp,RST =86400pcspp,RST =3600pcsp,RST =3600psp,RST =3600(a)50%tile010002000300040005000600005101520 No. of conn_blk Npcspp,RST =86400pcsp,RST =86400psp,RST =86400pcspp,RST =3600pcsp,RST =3600psp,RST =3600(b)90%tileFigure5.BlockedConnectionsforRELAXEDpolicyusing10minuteblocktime02040608010012014005101520 No. of conn_blk Npcspp,RST =86400pcsp,RST =86400psp,RST =86400pcspp,RST =3600pcsp,RST =3600psp,RST =3600(a)50%tile010002000300040005000600005101520 No. of conn_blk Npcspp,RST =86400pcsp,RST =86400psp,RST =86400pcspp,RST =3600pcsp,RST =3600psp,RST =3600(b)90%tileFigure6.BlockedConnectionsforSTRICTpolicyusing10minuteblocktimeoperatortoreacttoeventswithinthattime)providesaccept-ableresultswith7blockedconnectionsper(client,week)forthe50%tilePCSPPproﬁle.5.2.2ImpactofExtendedCOIAswehavediscussedbefore,asubstantialpartoftheout-of-proﬁleconnectionsinthePCSPPproﬁleareduetoephemeralports.OurgoalwithdevelopingtheExtendedCOIproﬁleistoattempttomoreaccuratelypredictsuchephemeralcommunication.WenowinvestigatethebeneﬁtsintermsofusabilityoftheExtendedCOIproﬁlebycompar-ingittothePCSPPproﬁlewiththeparametersetderivedintheprevioussection.Table2showstheabsolutenumberofeventsandblockedconnectionsforthe50,80and90%tile(client,week)value.Italsoshowstherelativeimprovementoftheeventsandblockedconnectionsforthosepercentiles.Wefocusedthistableonthe50-90%tilerangesincethelowerpercentilesalreadyproducefeweventsandblockedconnections.Theresultsshowthatthenumberofblockedconnectionsimprovesbetween43%to66%forthe50%tile,between30%to39%forthe80thpercentile,andbetween15%to33%forthe90thpercentile—overallasubstantialimprovementoverthePCSPPproﬁle.Thenumberofeventsisalsoreduced,however,itseemsthattheimprovementsaresmallerwhichindicatesthatbusierhostsbeneﬁtmore.6SecurityThissectiondetailsoursimulation-basedsecurityevalu-ationoftheCOIapproach.Weusethedataandmethodol-ogyidentiﬁedintheprecedingsectionstoderiveanetworkmodelandsourceTDandproﬁles.Thewormsimulationusedthroughoutmodelspropagationinsimulated(discrete)roundswithinamodeledenterprisenetwork.Thesimu-latedwormcancompromisehoststhroughaﬁxedportoverwhichthewormispropagated,e.g.,port80/http.Anin-fectedhostcancompriseexactlyoneotherhostinaround.Hence,modulothemitigationtechniqueused,thenumberofwormsattemptingtocompromiseotherhostsgrowsateachround.Inthisway,thesimulationmodelstheexpo-nentialbehaviorofwormpropagationwithintheenterprise.Weusetwometricstoevaluatesecurity.Theinfectedmetricindicatesthenumberofhostsinfectedattheendoftheex-periment.Thisreﬂectsthedegreetowhichthetestedpoli-ciescontainthewormoutbreak.Thesecondmetric,timetocompletionmeasuresthenumberofroundstillcomple-tionoftheexperiment.Thismeasureshowquicklyawormiscontainedor,inthecaseofsaturation,howquicklyallvulnerablehostsarecompromised.Eachcompromisedhostinthesimulationhasaﬁxedprobabilitysofsuccessfullycompromisinganothersimu-latedhostinaround.Thisparametermodelstheabilityofthewormtoidentifyavulnerablehosttoattempttocompro-9024681012141605001000150020002500300035004000 No. of conn_blk Block Time (sec)pcspppcsppsp(a)50%tile05001000150020002500300005001000150020002500300035004000 No. of conn_blk Block Time (sec)pcspppcsppsp(b)90%tileFigure7.BlockedConnectionsper(client,week)vsBlockduration(RELAXEDpolicy1dayresettimeandn=10)ComparisonTypePCSPPExten.Change%PCSPPExten.Change%PCSPPExten.Change%50%80%90%Events1107527161411OpenBC316671423919016015RelaxedBC7357266160391632109033StrictBC372143451313301782134024Table2.ExtendedCOIandSimpleCOIbasedproﬁleseventsandblockedconnections(BC)mise.Ahostcanbecompromisedif(a)thehostisreach-ablebytheinfectinghostaccordingtothetestedproﬁleandTD,and(b)thepolicyhasnotrestrictedcommunica-tiontothevictimhost/port,and(c)ifthevictimhostisnotalreadycompromised.Ifahostisinfectedduringoneroundofthesimulation,thenitwillattempttoinfectotherhostsinsubsequentrounds.Everyout-of-proﬁlecommunicationattemptbyahostisdeemedamiss.AsdeﬁnedinSection4,TDdetermineshowthehostisrestrictedonceitreachesthenthresholdofmisses.TorestatetheTDs,then-r-STRICTandn-r-RELAXEDwillpreventanyfurthercompromiseattemptsbythathostoncethethresholdisreached,andthen-r-OPENwillpreventanyout-of-proﬁleattemptsoncethethresholdisreached.Foroursimulationweassumedthatrismuchlargerthenthetimetospreadtheworm.Forbrevitywe,therefore,donotconsidertheimpactofr,i.e.,assumer=∞.Anexperimentterminateswhenallhostsarecompro-misedortherearenohoststhatcancompromiseanyre-maininguninfectedhosts.Thenetworkissaturatedifallcompromisablehostsarecompromised(whichrepresentstheworst-case,totalinfectionofthenetwork).Conversely,awormiscontainedwhenthewormcannolongerspreadbecauseofproﬁleandTDrestrictions,butthereremainhoststhatarevulnerabletocompromise.Thesimulationusesthesourcedatausedintheproﬁlecreationtoseedtheexperiments.Weconservativelyassumeallhoststhathavethetargetportintheirproﬁle,eitherasaclientoraserverport,arevulnerable.Inpractice,theremaybeotherportsvulnerableinthenetworkthatwereunusedoverthe8weeksamplingperiod.Onﬁrstglance,thismayappeartounder-estimatethepossiblespreadoftheworm.However,becauseunusedportswillnotshowupinanyproﬁle,theyoffernoadditionalopportunityforcompriseinan-r-STRICTpol-icy,andonlyuptothethresholdinthen-r-RELAXEDandn-r-OPENpolicies.Conversely,manywormsareonlyabletocompromisehoststhatarelisteningonaparticularport,i.e.,willonlyexploitavulnerabilityintheserverinterface.Oursimulationofclientportsasalsobeingvulnerableismoreconservative,asitwouldrequirethecompromisingoftheclientbasedonclientrequest,e.g.,abufferoverﬂowintheresponsetosomeclientdrivenrequest.Inpractice,client-sidevulnerabilitiesarelessfrequentlyobservedandaremoredifﬁculttoexploit.Hence,thepropagationofwormsinrealnetworksislikelytobelesssuccessfulthanthatreported.Eachexperimentseedsasinglesimulatedhostascom-promisedandmodelsinfectionbehavior,roundbyround,untiltheexperimentterminates.Werepeatthesimulationforeachseededhostwithadifferentseedandshowthemeasurementstakenoverallexperiments.Hence,eachex-perimentisforaTD/proﬁle/parameterisrepeatedanum-beroftimesequaltothenumberofvulnerablehosts.Forourevaluationwechoseportsforwhichareasonablylargenumberofexploitsisactivelybeingmonitoredbyalargetier1ISPe.g.,25,80,53,135,137,139,443,445.WerepeatthesimulationoverthethreeTDs(n-r-STRICT,n-r-RELAXED,andn-r-OPEN)andfourproﬁles(PC-SPP,PCSP,PSP,andExtendedCOI).Table3summarizesthenumberofinfectablehoststestedports.Notethatbycon-10COIProﬁlesPortPC-SPPPCSPPSPExtended25/tcp401351354080/tcp911351359153/udp128151151128135/tcp5413513554137/udp119151151119137/tcp013513561139/tcp9813513598443/tcp6913513569445/tcp9013513590Table3.Vulnerablehostsbyprotocolstruction,allhostswillbemodeledasvulnerableinthePCSPandPSPpoliciesbecausetheydonotrestrictcom-municationbasedonport.6.1BaselineInfectionRatesFigure8depictstheanalyticallydevelopedspreadofaworminanetworkwithnowormmitigationinplace.Thisrepresentstheworst-casescenariowhereallhostsarevul-nerableandthereisnocountermeasureinplacetodetectandmitigatethewormbehavior.Cappedat10,000hostin-fections,thesetestsshowhowthesuccessoftheworminﬁndingothervictimsaffectsthelengthoftimeittakestosaturatethenetwork.Thecurvesdemonstratewhywormsaresodangerous—evenforwormswithverysmallinfec-tionrates(1in10,000attemptsleadstoaninfection),thereexistsapointofcriticallyatwhichtheoutbreakisgrowingataratefasterthancanreasonablybecontrolled.Highlyeffectiveworms(forexample100%,suchasthosewithhit-lists[14])essentiallyinfecttheentirenetworkimmediately,whereittakesonly14roundstoinfecttheentirenetwork.Theslopeoftheinfectionsisslightlylesssteepinthewormswithlowerrate.However,theyarestillextremelydanger-ous:usingSlammer’saveragerateof7infectionsasec-ond[11],itwouldtakeslightlylessthan4secondsforawormtoinfectanetworkof10,000hosts.Studiedhereafter,therearetwogoalsofacountermea-sureillustratedbythesegraphs.First,obviously,itisdesir-abletocompletelycontaintheoutbreak.Stoppinganinfec-tionbeforeitsaturatesthelocalnetwork,andpossiblymoreimportantly,beforeitbecomesuncontrollablewithintheIn-ternetisessentialtoquashingit.However,asdescribedbyStanifordetal.,itisnotalwayspossibletostoptheworm.Inthiscase,slowingtherateofinfectionistheprimarygoal:decreasingtheslopeofinfectionisenormouslyuse-fulbecauseitallowsothercountermeasurestobeenacted.Suchothercountermeasuresspanfromsimple(turningoffvulnerablehosts)totheexceptionallycomplex(real-timepatching[8])countermeasures. 1 10 100 1000 10000 1 10 100 1000 10000 100000Hosts InfectedRoundNo Mitigation0.01%0.1%1%5%10%100%Figure8.Unabatedwormpropagation6.2WormContainmentAninitialsetofexperimentssoughttomeasuretheeffec-tivenessoftheSTRICTandRELAXEDTD.Figure9showsaCCDFoftheresultsofteststhatsimulateawormattack-ingport137withs=0.01(1%)andn=10underSTRICTandRELAXEDTDs.Thisaggressivewormsuccessfullycompromisesahostoneoutofeveryonehundredtriesbutislargelyineffective.Itisquashedinshortorderbecauseanyinfectedhostisshutdownbeforeitcandomuchdamage:thatisaftertenmisses,thehostispreventedfromcommuni-catingoverthenetwork.TheSTRICTpoliciesalmostnevergoesbeyondasinglehost–nooutofproﬁlecommunicationiseverallowed.However,theRELAXEDpolicyallowsasmallamountofadditionalspread(byallowingsomeinfec-tionstooccurthatareoutofproﬁle).ThesimulationofwormbehaviorundertheOPENTDleadtomorepolarresults.Eitherthewormwaslargelycon-tainedasintheprecedingexperiments(infecting10)wormsarelargelyimpossibletostopunderRELAXEDandOPENTDs.However,evenawormwithperfectaccuracy(e.g.,aﬂashworm)isonlyabletoinfectonethirdofthehostsinaPSPproﬁle,andessentiallynohostsusingtheEx-12PortPolicys(%)nPSPPCSPPCSPPIntelligent135/tcpstrict1100.768%0.741%1.852%1.852%135/tcpstrict5100.872%0.741%1.852%1.852%135/tcpstrict510014.044%0.785%1.852%1.852%135/tcpstrict1010031.048%0.818%1.852%1.852%135/tcpstrict25100033.421%10.126%1.852%1.852%135/tcpstrict100100033.421%12.617%1.852%1.852%135/tcprelaxed1100.842%0.793%2.143%2.109%135/tcprelaxed5101.383%1.495%3.841%3.738%135/tcprelaxed510098.938%98.996%99.280%99.331%135/tcprelaxed1010099.997%99.995%100.000%100.000%135/tcprelaxed251000100.000%100.000%100.000%100.000%135/tcprelaxed1001000100.000%100.000%100.000%100.000%135/tcpopen11092.060%61.871%1.989%1.972%135/tcpopen51095.734%50.209%16.907%10.065%135/tcpopen51098.621%98.886%99.949%99.074%135/tcpopen10100100.000%100.000%99.983%100.000%135/tcpopen251000100.000%100.000%100.000%100.000%135/tcpopen1001000100.000%100.000%100.000%100.000%53/udpstrict1100.673%0.662%0.781%0.781%53/udpstrict10100.969%0.667%0.781%0.781%53/udprelaxed1100.739%0.732%0.861%0.854%53/udprelaxed10106.125%6.456%6.796%6.110%53/udpopen11098.719%46.456%0.897%0.858%53/udpopen101099.737%75.157%54.831%55.530%80/tcpstrict1100.763%0.741%1.099%1.099%80/tcpstrict10101.152%0.752%1.099%1.099%80/tcprelaxed1100.815%0.815%1.177%1.220%80/tcprelaxed10106.505%6.549%7.457%7.946%80/tcpopen11091.907%50.486%25.999%26.186%80/tcpopen101096.524%78.875%62.764%67.534%137/tcpopen11091.536%51.254%N/A7.041%137/tcpopen101096.840%79.597%N/A64.888%Table4.Broadsecurityexperiments-numberofhostsinfectedperpolicyonthetestedports13 0.001 0.01 0.1 1 0 5 10 15 20 25CCDFWorm lifetime (rounds)PSP/StrictPCSP/StrictPCSPP/StrictExtended COI/StrictPSP/RelaxedPCSP/RelaxedPCSPP/RelaxedExtended COI/RelaxedFigure11.Wormlifetimesonport137,s=0.01,n=10 0 0.2 0.4 0.6 0.8 1 0 200 400 600 800 1000 1200 1400 1600 1800CCDFWorm lifetime (rounds)PSP/OpenPCSP/OpenPCSPP/OpenExtended COI/OpenBaseline expected lifetime (119 hosts)Baseline expected lifetime (151 hosts)Figure12.Wormlifetimesonport137,s=0.01,n=10tendedCOI.Thereasonforthisisthatthetherearemanyhoststhatmaybeinfectable,butonlyaminutefewthatareactuallywithinaparticularExtendedCOIproﬁle.Alter-ingthepolicythresholdnsimilarlyaffectstheresult:therearedemonstrableresultchangesinalmostallpolicieswhenchangingthenparameterfrom10to100.Asthethresh-oldincreases,thewormhasmoreopportunitytoinfectout-of-proﬁlehosts.Hence,asisseenonport135intheRE-LAXEDTD,increasingnallowsacontainablewormtosaturatethenetwork.7ConclusionsandFutureWorkInthispaperwepresentedabrownﬁeldapproachtohard-eninganenterprisenetworkagainstinternallyspreadingmalware.Wepresentedtechniquesforautomaticallyderiv-ingfourdifferentindividualhostproﬁles(PSP,PCSP,PC-SPPandextendedCOI)tocapturehistoricalcommunica-tionpatterns(i.e.,communityofinterest(COI))ofendhostswithinanenterprisenetwork.Usingtracesfromalargeen-terprisenetwork,weexplorehowthreedifferentsecuritypoliciesbasedontheseproﬁlesandTDsimpactboththeusabilityoftheendhostaswellasthespreadofwormsandsimilarsecuritythreats.Themainconclusionsare:(i)Theresultsvalidateakeypremiseofourapproachthatiffuturecommunicationpatternsareconstrainedtohistorical“nor-mal”communicationpatterns,thentheabilityofmalware(e.g.,worms)toexploitvulnerabilitiesintheenterprisecanindeedbeseverelycurtailed.(ii)Whiletheoverallapproachispromising,theselectionofthecorrectproﬁleandthrot-tlingdisciplinearebothcrucialtoachievingeffectivesecu-rityandusabilityproperties.PSPandPCSPpossessgoodusabilitybutweretoopermissiveresultinginpoorsecurityimpact,whilePCSPPhadgoodsecuritybutpoorusability,duetoitsinabilitytoaccommodateephemeralcommuni-cations.Amongthethrottlingdisciplines,n−r−Openhadgoodusabilitybutwaslargelyineffectiveagainstwormattacks,whilen−r−Strictwasveryeffectiveinwormdefensebutlackedgoodusability.(iii)Allowingasmallnumber(n=10)ofout-of-proﬁlecommunicationsperhostbeforethethrottlingactionisinitiated,cansubstantiallyim-provetheusability(byaccommodatingnewvalidcommu-nications),whilemaintaininggoodsecuritypropertiesofthepolicy.(iv)AsimplesecuritypolicycomprisedofourExtendedCOIproﬁleandn-r-RelaxedThrottlingDisciplinewhichallowsasmallnumberofout-of-proﬁlecommunica-tionsperhost,achievesbothhighprotectionagainstwormsandotherthreats,aswellaslowimpactontheusabilityofendhosts.Wehaveshownthatourproﬁlesaresufﬁcientlystableforweeksatatime,butstillneedtoaddresshowtheseproﬁleswillbeupdatedascommunicationpatternschangeoverlongertimeperiods.Onepossibleoptionistorecom-putetheproﬁlesperiodicallyincludingthenot-blockedout-of-proﬁlecommunicationsintherecomputationprocess.Analternateapproachistohavethenetworkoperatoraddrulesforlegitimateoutofproﬁlecommunicationsmanuallywheneverthenetworkoperatorinvestigatesanevent.Wearecurrentlyinvestigatingthetradeoffsoftheseandotheroptions.8AcknowledgementsWewouldliketothankHaowenChanforhismanycon-tributionstoearlyworkinautomatedpolicygeneration,toWillEnck,LisaJohansen,andPatrickVerkaikfortheired-itorialcomments,andtotheanonymousreviewersfortheirinsightfultechnicalcomments.14References[1]K.Al-TawilandI.A.Al-Kaltham.Evaluationandtestingofinternetﬁrewalls.InternationalJournalofNetworkMan-agement,9(3):135–149,1999.[2]Y.Bartal,A.J.Mayer,K.Nissim,andA.Wool.Firmato:Anovelﬁrewallmanagementtoolkit.InIEEESymposiumonSecurityandPrivacy,pages17–31,1999.[3]S.Bellovin.DistributedFirewalls.;login:,pages39–47,Nov.1999.[4]W.CheswickandS.Bellovin.FirewallsandInternetSecu-rity:RepellingtheWilyHacker.Addison-Wesley,Reading,MA,1994.[5]ChuckCranoret.al.Gigascope:astreamdatabasefornet-workapplications.InProceedingsofACMSIGMOD,June2003.[6]CooperativeAssociationforInternetDataAnalysis(CAIDA).TheSpreadoftheWittyWorm,March2004.http://www.caida.org/analysis/security/witty/.[7]T.Hastie,R.Tibshirani,andJ.Friedman.TheElementsofStatisticalLearning:DataMining,InferenceandPredic-tion.Springer,2001.[8]M.Hicks.DynamicSoftwareUpdating.PhDthesis,De-partmentofComputerandInformationScience,UniversityofPennsylvania,August2001.Winnerofthe2002ACMSIGPLANDoctoralDissertationaward.[9]S.Ioannidis,A.D.Keromytis,S.Bellovin,andJ.M.Smith.ImplementingaDistributedFirewall.InProceedingsofComputerandCommunicationsSecurity(CCS)2000,pages190–199,Nov.2000.Athens,Greece.[10]A.Mayer,A.Wool,andE.Ziskind.Fang:AFirewallAnal-ysisEngine.In2000IEEESymposiumonSecurityandPri-vacy,pages177–187.IEEE,May2000.Oakland,CA.[11]D.Moore,V.Paxson,S.Savage,C.Shannon,S.Staniford,andN.W.ver.Insidetheslammerworm.IEEESecurityandPrivacy,1(4):33–39,2003.[12]D.Moore,C.Shannon,G.M.Voelker,andS.Savage.InternetQuarantine:RequirementsforContainingSelf-PropagatingCode.InProceedingsofIEEEINFOCOM2003.IEEE,March2003.SanFrancisco,CA.[13]S.Staniford.ContainmentofScanningWormsinEnterpriseNetworks.JournalofComputerSecurity,2004.toappear.[14]S.Staniford,V.Paxson,andN.Weaver.Howtoowntheinternetinyoursparetime.InProceedingsofthe11thUSENIXSecuritySymposium,pages149–167.USENIXAs-sociation,2002.[15]S.Staniford-Chen,S.Cheung,R.Crawford,M.Dilger,J.Frank,J.Hoagland,K.Levitt,C.Wee,R.Yip,andD.Zerkle.GrIDSAGraph-BasedIntrusionDetectionSys-temforLargeNetworks.InProceedingsofthe19thNationalInformationSystemsSecurityConference,1996.[16]W.Aiello,C.Kalmanek,P.McDaniel,S.Sen,O.SpatscheckandJ.VanderMerwe.AnalysisofCommunitiesofInterestinDataNetworks,March2005.PassiveandActiveMea-surementWorkshop.[17]M.M.Williamson.Throttlingviruses:Restrictingprop-agationtodefeatmaliciousmobilecode.InProceedingsofthe18thAnnualComputerSecurityApplicationsConfer-ence,pages61–68.IEEEComputerSociety,2002.[18]A.Wool.ArchitectingtheLumetaFirewallAnalyzer.InProceedingsofthe10thUSENIXSecuritySymposium,pages85–97,August2001.Washington,DC.15