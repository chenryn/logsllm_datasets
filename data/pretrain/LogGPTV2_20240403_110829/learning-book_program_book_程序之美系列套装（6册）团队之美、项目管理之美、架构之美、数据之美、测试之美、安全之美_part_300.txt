聚集级别从城市扩大到县级时，仍然具有上述特征。
显然，价格和收入是强正相关，从图18-11的城市等级上可以观察
到。
根据《NewYorkTimes》的一篇文章（MKinley2007），Stockton城
市，SanJoaquin省最大的城市之一，到2007年夏天，已经是美国丧
失抵押品回权比例最高的城市了。
遗憾的是，我们没有Stockton城市在2008年之前的销售数据，但是直
到2008年，看起来它仍然是该地区持续低迷的主要代表。Stockton城
市的人口在过去10年增长迅速，为了逃避海湾地区过热的房地产市
场，上下班的人们住的地方越来越偏远。这有助于解释之前提出的
新建筑，而且也把我们的观察和上下班时间关联起来。该文章还列
举了Modesto和Merced城市，在中央山谷(CntralValley)的两个城镇，
在当时都位列全国丧失抵押品回权数量最高的十大城市之中。
探索旧金山
探索了城市之间的区别，我们开始更详细地查看单个城市。旧金山
是个很显然的选择：在我们包含的数据中它是最大的城市，也是我
们最熟悉的城市，而且它包含一些标志性的特征，可以很容易为别
人所识别。我们通过抽取旧金山的所有地址来开始探索，这些地址
通过非常高的精确度进行编码，为我们总共提供25377个地址。我们
创建了一个简单的经纬度散点图，如图18-13所示。
1698
---
## Page 1700
平均收入
大学生比例
5
翠均交通时间
图18-11：从上到下，住房价格的下降（价格回落）和平均收入、
大学生比例和平均交通时间的关系
1699
---
## Page 1701
SanJoaquin
2006
2000
Solano
变化比例
ContraCosta
San Benito
Napa
Sonoma
位的
Monterey
Santa Clara
单
住
Alameda Santa Cruz
Marin
0.2
0.3
0.4
0.5
0.6
0.7
0.8
2008年的平均销售价格（单位：百万）
San Joaquin
15
年
2006
(2000
Solano
0
Contra Costa
化比例
Napa
SanBenito
Sonoma
变
Monterey
Santa Clara
单
Santa Cruz
Alameda
房
San Francisco
世
San Mateo
Marin
20
30
40
50
60
70
80
2005年的人均收入（单位：千）
图
18-12：新的构建与最近价格（上图）和个人收入（下图）的关
系，数据以县为单位聚集。住房单位个数在价格较低和人均收入较
低的住房城市相对增长最大
对于城市的居住地区，该图给了我们非常详尽的画面。我们可以看
到街道方向、海滨边界和公园。一些地区的视图，如市中心，显得
1700
---
## Page 1702
更散落，因为这些地方住宅区较少。（在本章中，我们将避免用简
写词“房子”，因为很显然很多销售的住房指的是公寓。）
该绘图的一个问题是我们无法看到每个特定位置的销售数量。图18-
14显示了试着捕获信息的两种尝试。在上图，我们显示的是冒泡
图，其地理位置和销售数量成正比。现在，我们得到和商业区非常
不同的视图：那里有很高的销售量。仔细查看这些数据可以发现这
些公寓建筑有几百套的公寓。在下图，我们把旧金山分成经度和纬
度0.005平方米的方块，计算每个方块内的住房数量。这给了我们更
高层次的视图，显示主要的家庭所在的地区。
1701
---
## Page 1703
图18-13：（上图）对于数据中的每个住宅销售都画出了一个小
点，它给我们非常好的旧金山布局的感觉；（下图）为了比较，显
示的是一张旧金山的街道地图，来自http：//openstreetmap.com（见彩
图68）
使用相同的分块方式，我们计算了住房价格的均值和变化系数。变
化系数是通过除以平均值计算出来的标准差。我们这里使用它是因
为$100000的变化在当住房价格很低时要比住房价格高相对更重要。
1702
---
## Page 1704
·50
·100
200
252
住房数量
100
200
300
400
500
图18-14：住宅销售数量的地理分布。（上图）该图和之前的绘图
相似，但是点的大小和每个唯一位置的销售数量成正比。这大大改
变了图片，因为城市大公寓的复杂性现在开始凸显出来。（下图）
在更高层聚集的销售显示：经度和纬度被划分到少数的分块，每个
分块的销售数量都被计数，作为分块的颜色显示
1703
---
## Page 1705
图18-15显示了这两种求和统计的地理分布。我们可以看到Presidio城
市边界和该城市的南海岸最昂贵的住房。在西南地区看起来有个高
峰：这就是富裕的St.FrancisWood地区，在旧金山州立大学附近。变
化系数存在一个有趣的地理趋势：似乎价格朝着西北地区增长。
平均价格
0.5
1.5
2.5
2
c.V.
0.2
0.4
0.6
0.8
图18-15：使用和之前图相同的经度和纬度分块方法：均值（上
图）和变化系数（下图）是使用相同的灰色调来计算和显示的
1704
---
## Page 1706
结论
我们从多个角度查看了数据，观察到的是相同的东西：住房危机在
更贫困地区相对伤害更深。繁荣和萧条对于价格低的住房打击更早
更大；平均收入较低的城市高峰值更高，下降更多，落差也更大。
很多繁荣景象和新建筑有关，绝大多数的目标是低端市场。
很多新建成的住宅远离旧金山市区，在较不发达的地区，居民平均
收入较低、孩子更多、上下班时间更长。虽然价格上最大的绝对下
降发生在高端，但从跌下的价格相对于房子本身的价值所占比例的
角度考虑，较便宜的住房损失更大。
自从房地产泡沫成为头条新闻，所有这一切都和我们所学到的关于
次级抵押贷款一致。很多信誉很低的人也获得了抵押贷款，初始每
个月支付很少。当这些支付款项不断增长时，他们就无法支付了，
违约和丧失抵押品回权的数量开始上升。我们之前猜测过2008年
销售的增长可能和丧失抵押品回权有关，而且下一步有趣的步骤
是定位出丧失抵押品赎回权的数据，并结合我们的销售数据一起调
研。
我们使用了相对简单的统计方法如索引、计算位数、平滑和分块来
探索大的、复杂的数据集合。我们从广泛的摘要开始，然后深入探
索细节，但是我们还只是触及表面。如果你对我们的数据感兴趣并
希望进一步了解我们的工作细节，或者尝试一些你的想法，你可以
在git库：https：//github.com/hadley/sfhousing检出所有数据和代码。我
们写的所有代码（R、Perl和shell脚本）都是运行在开源软件上，因
此，任何人都可以复制这些工作成果，而不需要购买昂贵的软件，
再生性的原则(Gntleman和TempleLang2007）在科学实验室非常重
要，在这里也很重要：如果我们犯了一个错误，你可以发现它、解
决它并观察对结论的影响。
通过这次实践工作，我们获得了从住房数据中抽取、探索、分析并