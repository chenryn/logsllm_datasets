频率”、“集中的IP来源”来判断是否为工具。动态技术不管这
个工具是什么名字，在业务逻辑的哪个环节，模拟了哪类浏览器、
是否不断更换工具和改变IP，只要被识别为“工具”，即可将主
动触发软拦截。
经过大量的理论和实战得出，在企业中结合动态防护和稳态防护两
者防护能力下，企业在对抗恶意攻击者发起的攻击，还是非常有效
的。自动化工具攻击，可以通过动态防护技术能力，进行“围剿”；
而手动渗透攻击可以利用业内成熟度较高的WAF来进行抗衡。
可以拦截常见的SQL注入、XSS注入、文件上传、Webshell等 企业安全架构建设的道路坎坷，不乏会遇到各种棘手的事件，静下
OWASP…TOP10常见恶意攻击，效果比较突出。如若不具备这些 心来，换位思考，开拓思路，行业内外安全技术思路调研，并在各
恶意攻击的特征所发起的网站请求，如入无人之地，一路绿灯通行， 个不同阶段结合企业自身情况进行量身定制才是通向安全之路。
直达服务器。针对这类攻击则需要通过其他技术手段来补足。
动态安全防护系统以一系列“动态”技术为核心，提供应用和业务
层面的威胁感知和主动式防御，对黑客和不法分子隐蔽自己，甄别
伪装和假冒正常行为的已知和未知自动化攻击，提供企业和个人安
全的业务服务，保护企业和个人数据；同时，其“动态验证”技术，
可以有效识别客户端是“工具还是人”，针对模拟合法操作的工具
行为进行阻拦或者软拦截，为企业建立新的动态安全防护能力，补
充主动式防护建设要求。
动态防护系统设计技术，是通过对网页代码的持续动态变化，实现
作者介绍 SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN
对网页敏感内容的隐藏，防止攻击者对网页代码进行深入分析。另
外通过核心技术对工具的识别，再结合用户行为分析，实现对各种
刘嵩，网络安全总监
自动化攻击的拦截。动态技术其根本的原理就是判定是“人”的操
有着20余年信息安全研究的工作者。
作还是“工具”操作，识别拦截工具请求动态技术并不依赖“访问
SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN
120 121
基于 CDM 技术的敏捷数据管理实践分享
光大证券 基础数据管理团队
孙伟 沈波
行
业
专
刊
一、前言
近年来，证券业务快速发展，信息系统变更日益频繁，敏捷开发、
快速迭代已经成为支持业务创新的必要条件。数据库作为信息系统
运行的重要支撑，数据准备和交付的自动化程度对系统开发、测试
效率有大的影响。
二、数据准备遇到的困难
测试数据的准备通常包括数据库备份、数据库脱敏、数据库恢复等
几大步骤。在备份环节，我司主要是利用数据库自带的备份功能进
行数据库物理和逻辑备份，并通过统一备份平台对备份文件进行备
份。
根据测试实际需求，如需要真实数据，我们通常采用灰度环境，灰
123
行
业 基于CDM技术的敏捷数据管理实践分享
专
刊
度环境的数据准备主要有两种方式：直接采用实时备库或者是采用 是对于一些稳态系统，由于日常迭代需求很低，如果不定期对数据
与生产隔离的数据库。 库备份进行验证，一旦遇到需要数据库恢复场景，很可能遭遇备份
文件不可用局面。结合行业要求，我司每季度会对所有数据库备份
两种方式各有优劣，第一种方式的优点在于数据是实时和生产库 文件进行恢复验证，由于数据库种类繁多，数据量很大，这个工作
同步，省去了数据导入的环节，而且对于某些数据库如ORACLE… 需要耗费大量时间。
DATAGUARD可以利用Flashback功能在测试完成之后快速恢复
与生产的同步，缺点在于如DB2，SQLSERVER，MYSQL等数据 基于以上遇到的问题，我们进行了市场调研，接触到了一种基于
库并不支持一键恢复同步功能，往往需要重新恢复备库以及和主库 CDM（Copy…Data…Management，数据副本管理）技术，通过对
同步关系；对于第二种方式显著优点是在于与生产环境隔离，导入 该技术的运用，我们整合了CDM和脱敏相关工具，实现了生产到
和恢复都不会影响到生产环境，更加安全，但是往往时间需要更久， 开发测试环境的数据快速复制，以及备份数据的自动校验。
因为包括了备份文件传输，数据导入，也牺牲了实时性。
三、基于CDM技术实践
如果数据到测试或者开发环境，根据《证券期货业信息系统运维管
理规范》数据用于非生产环境时，应进行脱敏处理。结合我司实际 CDM技术简介
安全要求，脱敏工作必须在进入测试或者开发之前完成。对于全库 Gartner对CDM的定义是，它从生产环境通过快照技术获取有应
的数据准备步骤以及时间更加复杂： 用一致性保证的数据，在非生产存储上生成“黄金副本”（Golden…
需要在脱敏区域对数据库备份文件进行导入还原到脱敏区域； Image），这个“黄金副本”数据格式是原始的磁盘格式，可再虚
通过脱敏工具对该库中的敏感数据进行脱敏； 拟化成多个副本直接挂载给服务器，分别用于备份恢复、容灾或开
重新进行全库备份； 发测试等。
备份文件通过至少2次传输到达测试环境；
在测试环境进行全库导入/还原。 基于CDM技术的敏捷数据管理实践
我们在调研市场后，发现当前主要存在以下三种CDM技术产品：
整个过程经历了2次备份，2次还原，至少2次传输操作，时间长 1、以存储为核心提供的CDM，虽然能够提供快照和克隆功能，
且复杂度高，严重影响测试开发环境数据准备。 但很难实现跨异构存储，构建企业级规则驱动的副本数据平台，
并缺乏丰富的数据服务能力，无法提供自动化、自服务等功能。
除了影响测试数据的准备效率，我们还面临另外一种场景，数据库
备份的定期验证。定期验证的重要性不言而喻，有多个案例表明在 2、备份软件提供的CDM功能，利用备份技术所创建的副本数据，
真正需要用到数据库备份进行恢复时，发现备份文件不可用。尤其 是一种磁盘快照技术，无法保证数据的一致性，并且同一时间
124 125
行
业 基于CDM技术的敏捷数据管理实践分享
专
刊
的磁盘快照只能挂载一份，难以满足多应用场景的数据需求。 2)…当需要数据时，将指定时间点的数据挂载发布到灰度环境（发
布到灰度环境上数据不需要脱敏）；
3、端到端的CDM：把单纯面向恢复的应用场景，变成了面向数
据使用的应用场景，通过副本数据在各个业务环节的即时可用， 3)…测试结束后，销毁灰度数据库。
为更多业务场景提供数据支撑。
生产到开发测试环境的数据快速复制
以存储为核心的CDM和备份软件提供的CDM功能，按照 通过部署CDM方案，分钟内创建完成虚拟数据库并调用脱敏系
Gartner的定义，属于“类”CDM。我们最终选择了端到端的 统对虚拟数据库执行脱敏，脱敏后数据自动推送复制到中间网
CDM技术产品，在生产到灰度、生产到开发测试环境的数据快速 CDM，经过中间网CDM节点可将脱敏数据分钟级挂载发布到测
复制，以及备份数据的自动校验三个应用场景。 试网，有效减少开发测试场景中测试数据的准备时间，提高开发测
试环境搭建的效率。
(1) 网络说明：
生产网和测试网进行物理隔离，生产网和中间网、中间网和测试网
分别可点对点打通。
(2) 开发测试数据快速交付：
1)…在生产网和中间网分别部署CDM节点；…
图1：整体业务架构拓扑 2)…生产数据脱敏在生产网内完成；
3)…生产网CDM节点将脱敏后的数据推送到中间网CDM节点；
生产到灰度环境的数据快速复制 4)…脱敏数据通过中间网挂载发布到测试网开发测试环境；
利用CDM产品的数据库虚拟化技术，通过一份数据副本，可快速 5)…测试结束后，按策略定期销毁数据。
创建出多个虚拟数据副本，这些虚拟数据副本几乎不占用任何存储
空间，且整个发布动作可以分钟级完成。 (3) 数据脱敏：
部署CDM前的数据脱敏，需要分别在生产网和中间网各部署一套
具体流程： 脱敏系统，生产数据不能直接给到测试网，需要经历从生产网到中
1)…对接生产库备库，定时进行全量，增量备份，并实时备份获取 间网、从中间网到测试网的两次数据抽取和脱敏，并且是面向整库
数据归档日志； 全量数据的抽取。
126 127
行
业 基于CDM技术的敏捷数据管理实践分享
专
刊
部署CDM后的数据脱敏，生产网部署一套脱敏系统，将数据发布
到生产网的脱敏环境并执行脱敏任务后，脱敏数据利用CDM节点
之间的远程复制功能推送到中间网，并通过中间网挂载发布到测试