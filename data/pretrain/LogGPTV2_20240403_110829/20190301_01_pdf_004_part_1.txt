Database Compatibility for Oracle®
Developer’s Guide
EDB Postgres™ Advanced Server 11
November 20, 2018
Database Compatibility for Oracle® Developer’s Guide
by EnterpriseDB® Corporation
Copyright © 2007 - 2018 EnterpriseDB Corporation. All rights reserved.
EnterpriseDB Corporation, 34 Crosby Drive, Suite 201, Bedford, MA 01730, USA
T +1 781 357 3390 F +1 978 467 1307 E PI:EMAIL www.enterprisedb.com
Database Compatibility for Oracle® Developers Guide
Table of Contents
1 Introduction ............................................................................................................................................ 9
1.1 What’s New ...................................................................................................................................10
1.2 Typographical Conventions Used in this Guide ............................................................................10
1.3 Configuration Parameters Compatible with Oracle Databases ......................................................11
1.3.1 edb_redwood_date .................................................................................................................12
1.3.2 edb_redwood_raw_names .....................................................................................................12
1.3.3 edb_redwood_strings .............................................................................................................13
1.3.4 edb_stmt_level_tx ..................................................................................................................15
1.3.5 oracle_home...........................................................................................................................16
1.4 About the Examples Used in this Guide ........................................................................................17
2 SQL Tutorial ..........................................................................................................................................18
2.1 Getting Started ...............................................................................................................................18
2.1.1 Sample Database ....................................................................................................................19
2.1.1.1 Sample Database Installation ............................................................................................19
2.1.1.2 Sample Database Description ...........................................................................................19
2.1.2 Creating a New Table ............................................................................................................30
2.1.3 Populating a Table With Rows ..............................................................................................31
2.1.4 Querying a Table ...................................................................................................................32
2.1.5 Joins Between Tables ............................................................................................................34
2.1.6 Aggregate Functions ..............................................................................................................38
2.1.7 Updates ..................................................................................................................................40
2.1.8 Deletions ................................................................................................................................41
2.1.9 The SQL Language ................................................................................................................42
2.2 Advanced Concepts .......................................................................................................................43
2.2.1 Views .....................................................................................................................................43
2.2.2 Foreign Keys..........................................................................................................................45
2.2.3 The ROWNUM Pseudo-Column ...........................................................................................46
2.2.4 Synonyms ..............................................................................................................................48
2.2.5 Hierarchical Queries ..............................................................................................................52
2.2.5.1 Defining the Parent/Child Relationship ............................................................................53
2.2.5.2 Selecting the Root Nodes ..................................................................................................53
2.2.5.3 Organization Tree in the Sample Application ...................................................................53
2.2.5.4 Node Level ........................................................................................................................55
2.2.5.5 Ordering the Siblings ........................................................................................................56
2.2.5.6 Retrieving the Root Node with CONNECT_BY_ROOT .................................................57
2.2.5.7 Retrieving a Path with SYS_CONNECT_BY_PATH ......................................................61
2.2.6 Multidimensional Analysis ....................................................................................................63
2.2.6.1 ROLLUP Extension ..........................................................................................................65
2.2.6.2 CUBE Extension ...............................................................................................................68
2.2.6.3 GROUPING SETS Extension ...........................................................................................72
2.2.6.4 GROUPING Function .......................................................................................................78
2.2.6.5 GROUPING_ID Function ................................................................................................81
2.3 Profile Management ......................................................................................................................84
2.3.1 Creating a New Profile ..........................................................................................................85
2.3.1.1 Creating a Password Function...........................................................................................88
2.3.2 Altering a Profile ...................................................................................................................91
2.3.3 Dropping a Profile .................................................................................................................92
2.3.4 Associating a Profile with an Existing Role ..........................................................................93
2.3.5 Unlocking a Locked Account ................................................................................................95
2.3.6 Creating a New Role Associated with a Profile .....................................................................97
2.3.7 Backing up Profile Management Functions ...........................................................................99
2.4 Optimizer Hints ...........................................................................................................................100
Copyright © 2007 - 2018 EnterpriseDB Corporation. All rights reserved. 3
Database Compatibility for Oracle® Developers Guide
2.4.1 Default Optimization Modes ...............................................................................................102
2.4.2 Access Method Hints ...........................................................................................................104
2.4.3 Specifying a Join Order .......................................................................................................108
2.4.4 Joining Relations Hints ........................................................................................................109
2.4.5 Global Hints .........................................................................................................................112
2.4.6 Using the APPEND Optimizer Hint ....................................................................................115
2.4.7 Parallelism Hints ..................................................................................................................116
2.4.8 Conflicting Hints .................................................................................................................121
3 Stored Procedure Language .................................................................................................................122
3.1 Basic SPL Elements.....................................................................................................................122
3.1.1 Character Set........................................................................................................................122
3.1.2 Case Sensitivity ...................................................................................................................123
3.1.3 Identifiers .............................................................................................................................123
3.1.4 Qualifiers .............................................................................................................................123
3.1.5 Constants .............................................................................................................................124
3.1.6 User-Defined PL/SQL Subtypes ..........................................................................................125
3.2 SPL Programs ..............................................................................................................................128
3.2.1 SPL Block Structure ............................................................................................................129
3.2.2 Anonymous Blocks ..............................................................................................................131
3.2.3 Procedures Overview ...........................................................................................................132
3.2.3.1 Creating a Procedure .......................................................................................................132
3.2.3.2 Calling a Procedure .........................................................................................................137
3.2.3.3 Deleting a Procedure .......................................................................................................137
3.2.4 Functions Overview .............................................................................................................139
3.2.4.1 Creating a Function .........................................................................................................139
3.2.4.2 Calling a Function ...........................................................................................................144
3.2.4.3 Deleting a Function .........................................................................................................145
3.2.5 Procedure and Function Parameters ....................................................................................146
3.2.5.1 Positional vs. Named Parameter Notation ......................................................................147
3.2.5.2 Parameter Modes ............................................................................................................149
3.2.5.3 Using Default Values in Parameters ...............................................................................151
3.2.6 Subprograms – Subprocedures and Subfunctions ................................................................152
3.2.6.1 Creating a Subprocedure .................................................................................................153
3.2.6.2 Creating a Subfunction ...................................................................................................155
3.2.6.3 Block Relationships ........................................................................................................157
3.2.6.4 Invoking Subprograms ....................................................................................................159
3.2.6.5 Using Forward Declarations ...........................................................................................166
3.2.6.6 Overloading Subprograms ..............................................................................................167
3.2.6.7 Accessing Subprogram Variables ...................................................................................171
3.2.7 Compilation Errors in Procedures and Functions ................................................................178
3.2.8 Program Security .................................................................................................................180
3.2.8.1 EXECUTE Privilege .......................................................................................................180
3.2.8.2 Database Object Name Resolution .................................................................................181
3.2.8.3 Database Object Privileges .............................................................................................182
3.2.8.4 Definer’s vs. Invokers Rights..........................................................................................182
3.2.8.5 Security Example ............................................................................................................183
3.3 Variable Declarations ..................................................................................................................190
3.3.1 Declaring a Variable ............................................................................................................190
3.3.2 Using %TYPE in Variable Declarations..............................................................................192
3.3.3 Using %ROWTYPE in Record Declarations ......................................................................195
3.3.4 User-Defined Record Types and Record Variables .............................................................196
3.4 Basic Statements ..........................................................................................................................199
3.4.1 NULL ..................................................................................................................................199
3.4.2 Assignment ..........................................................................................................................199
3.4.3 SELECT INTO ....................................................................................................................200
3.4.4 INSERT ...............................................................................................................................202
Copyright © 2007 - 2018 EnterpriseDB Corporation. All rights reserved. 4
Database Compatibility for Oracle® Developers Guide
3.4.5 UPDATE .............................................................................................................................204
3.4.6 DELETE ..............................................................................................................................204
3.4.7 Using the RETURNING INTO Clause ...............................................................................205
3.4.8 Obtaining the Result Status .................................................................................................208
3.5 Control Structures ........................................................................................................................209
3.5.1 IF Statement .........................................................................................................................209
3.5.1.1 IF-THEN .........................................................................................................................209
3.5.1.2 IF-THEN-ELSE ..............................................................................................................210
3.5.1.3 IF-THEN-ELSE IF .........................................................................................................211
3.5.1.4 IF-THEN-ELSIF-ELSE ..................................................................................................212
3.5.2 RETURN Statement ............................................................................................................214
3.5.3 GOTO Statement .................................................................................................................215
3.5.4 CASE Expression ................................................................................................................217
3.5.4.1 Selector CASE Expression .............................................................................................217
3.5.4.2 Searched CASE Expression ............................................................................................218
3.5.5 CASE Statement ..................................................................................................................220
3.5.5.1 Selector CASE Statement ...............................................................................................220
3.5.5.2 Searched CASE statement ..............................................................................................221
3.5.6 Loops ...................................................................................................................................224
3.5.6.1 LOOP ..............................................................................................................................224
3.5.6.2 EXIT ...............................................................................................................................224
3.5.6.3 CONTINUE ....................................................................................................................225
3.5.6.4 WHILE ...........................................................................................................................225
3.5.6.5 FOR (integer variant) ......................................................................................................226
3.5.7 Exception Handling .............................................................................................................228
3.5.8 User-defined Exceptions ......................................................................................................230
3.5.9 PRAGMA EXCEPTION_INIT ...........................................................................................232
3.5.10 RAISE_APPLICATION_ERROR ......................................................................................234
3.6 Transaction Control .....................................................................................................................236
3.6.1 COMMIT .............................................................................................................................237
3.6.2 ROLLBACK ........................................................................................................................238
3.6.3 PRAGMA AUTONOMOUS_TRANSACTION .................................................................241
3.7 Dynamic SQL ..............................................................................................................................249
3.8 Static Cursors ...............................................................................................................................252
3.8.1 Declaring a Cursor ...............................................................................................................252
3.8.2 Opening a Cursor .................................................................................................................252
3.8.3 Fetching Rows From a Cursor .............................................................................................253
3.8.4 Closing a Cursor ..................................................................................................................254
3.8.5 Using %ROWTYPE With Cursors ......................................................................................256
3.8.6 Cursor Attributes .................................................................................................................257
3.8.6.1 %ISOPEN .......................................................................................................................257
3.8.6.2 %FOUND .......................................................................................................................257
3.8.6.3 %NOTFOUND ...............................................................................................................258
3.8.6.4 %ROWCOUNT ..............................................................................................................260
3.8.6.5 Summary of Cursor States and Attributes .......................................................................261
3.8.7 Cursor FOR Loop ................................................................................................................261
3.8.8 Parameterized Cursors .........................................................................................................262
3.9 REF CURSORs and Cursor Variables .........................................................................................264
3.9.1 REF CURSOR Overview ....................................................................................................264
3.9.2 Declaring a Cursor Variable ................................................................................................264
3.9.2.1 Declaring a SYS_REFCURSOR Cursor Variable ..........................................................264
3.9.2.2 Declaring a User Defined REF CURSOR Type Variable ...............................................265
3.9.3 Opening a Cursor Variable ..................................................................................................265
3.9.4 Fetching Rows From a Cursor Variable ..............................................................................266
3.9.5 Closing a Cursor Variable ...................................................................................................266
3.9.6 Usage Restrictions ...............................................................................................................267
Copyright © 2007 - 2018 EnterpriseDB Corporation. All rights reserved. 5
Database Compatibility for Oracle® Developers Guide
3.9.7 Examples .............................................................................................................................268
3.9.7.1 Returning a REF CURSOR From a Function .................................................................268
3.9.7.2 Modularizing Cursor Operations ....................................................................................269
3.9.8 Dynamic Queries With REF CURSORs..............................................................................271
3.10 Collections ...................................................................................................................................274
3.10.1 Associative Arrays ...............................................................................................................274
3.10.2 Nested Tables ......................................................................................................................278
3.10.3 Varrays ................................................................................................................................282
3.11 Collection Methods......................................................................................................................285
3.11.1 COUNT ...............................................................................................................................285
3.11.2 DELETE ..............................................................................................................................285
3.11.3 EXISTS ................................................................................................................................287
3.11.4 EXTEND .............................................................................................................................287
3.11.5 FIRST ..................................................................................................................................290
3.11.6 LAST ...................................................................................................................................290
3.11.7 LIMIT ..................................................................................................................................291
3.11.8 NEXT ..................................................................................................................................291
3.11.9 PRIOR .................................................................................................................................292
3.11.10 TRIM ..............................................................................................................................292
3.12 Working with Collections ............................................................................................................294
3.12.1 TABLE() ..............................................................................................................................294
3.12.2 Using the MULTISET UNION Operator ............................................................................294
3.12.3 Using the FORALL Statement ............................................................................................296
3.12.4 Using the BULK COLLECT Clause ...................................................................................298
3.12.4.1 SELECT BULK COLLECT ......................................................................................299
3.12.4.2 FETCH BULK COLLECT ........................................................................................300
3.12.4.3 EXECUTE IMMEDIATE BULK COLLECT ...........................................................302
3.12.4.4 RETURNING BULK COLLECT ..............................................................................302
3.13 Errors and Messages ....................................................................................................................305
4 Triggers ...............................................................................................................................................306
4.1 Overview .....................................................................................................................................306
4.2 Types of Triggers.........................................................................................................................307
4.3 Creating Triggers .........................................................................................................................308
4.4 Trigger Variables .........................................................................................................................311
4.5 Transactions and Exceptions .......................................................................................................313
4.6 Trigger Examples ........................................................................................................................313
4.6.1 Before Statement-Level Trigger ..........................................................................................313
4.6.2 After Statement-Level Trigger.............................................................................................314
4.6.3 Before Row-Level Trigger ..................................................................................................315
4.6.4 After Row-Level Trigger .....................................................................................................315
5 Packages ..............................................................................................................................................318
6 Object Types and Objects ....................................................................................................................319
6.1 Basic Object Concepts .................................................................................................................319
6.1.1 Attributes .............................................................................................................................320
6.1.2 Methods ...............................................................................................................................320
6.1.3 Overloading Methods ..........................................................................................................320
6.2 Object Type Components ............................................................................................................321
6.2.1 Object Type Specification Syntax .......................................................................................321
6.2.2 Object Type Body Syntax ....................................................................................................325
6.3 Creating Object Types .................................................................................................................328
6.3.1 Member Methods .................................................................................................................328
6.3.2 Static Methods .....................................................................................................................329
6.3.3 Constructor Methods ...........................................................................................................330
6.4 Creating Object Instances ............................................................................................................333
6.5 Referencing an Object .................................................................................................................334
6.6 Dropping an Object Type ............................................................................................................336
Copyright © 2007 - 2018 EnterpriseDB Corporation. All rights reserved. 6
Database Compatibility for Oracle® Developers Guide
7 Open Client Library .............................................................................................................................337
8 Oracle Catalog Views ..........................................................................................................................338
9 Tools and Utilities ...............................................................................................................................339
10 Table Partitioning ............................................................................................................................340
10.1 Selecting a Partition Type ............................................................................................................341
10.2 Using Partition Pruning ...............................................................................................................342
10.2.1 Example - Partition Pruning ................................................................................................346
10.3 Partitioning Commands Compatible with Oracle Databases .......................................................349
10.3.1 CREATE TABLE…PARTITION BY ................................................................................349
10.3.1.1 Example - PARTITION BY LIST .............................................................................353
10.3.1.2 Example - PARTITION BY RANGE ........................................................................354
10.3.1.3 Example - PARTITION BY HASH ...........................................................................355
10.3.1.4 Example - PARTITION BY RANGE, SUBPARTITION BY LIST .........................356
10.3.2 ALTER TABLE...ADD PARTITION .................................................................................358
10.3.2.1 Example - Adding a Partition to a LIST Partitioned Table ........................................360
10.3.2.2 Example - Adding a Partition to a RANGE Partitioned Table ...................................361
10.3.3 ALTER TABLE… ADD SUBPARTITION .......................................................................363
10.3.3.1 Example - Adding a Subpartition to a LIST-RANGE Partitioned Table ...................365
10.3.3.2 Example - Adding a Subpartition to a RANGE-LIST Partitioned Table ...................366
10.3.4 ALTER TABLE...SPLIT PARTITION ...............................................................................368
10.3.4.1 Example - Splitting a LIST Partition ..........................................................................370
10.3.4.2 Example - Splitting a RANGE Partition ....................................................................372
10.3.5 ALTER TABLE...SPLIT SUBPARTITION .......................................................................375
10.3.5.1 Example - Splitting a LIST Subpartition ....................................................................377
10.3.5.2 Example - Splitting a RANGE Subpartition ..............................................................379
10.3.6 ALTER TABLE… EXCHANGE PARTITION ..................................................................383
10.3.6.1 Example - Exchanging a Table for a Partition ...........................................................384
10.3.7 ALTER TABLE… MOVE PARTITION ............................................................................388
10.3.7.1 Example - Moving a Partition to a Different Tablespace ...........................................389
10.3.8 ALTER TABLE… RENAME PARTITION .......................................................................391
10.3.8.1 Example - Renaming a Partition ................................................................................392
10.3.9 DROP TABLE .....................................................................................................................393
10.3.10 ALTER TABLE… DROP PARTITION ........................................................................394
10.3.10.1 Example - Deleting a Partition ...................................................................................394
10.3.11 ALTER TABLE… DROP SUBPARTITION ................................................................396
10.3.11.1 Example - Deleting a Subpartition .............................................................................396
10.3.12 TRUNCATE TABLE .....................................................................................................398
10.3.12.1 Example - Emptying a Table ......................................................................................398
10.3.13 ALTER TABLE… TRUNCATE PARTITION ..............................................................401
10.3.13.1 Example - Emptying a Partition .................................................................................401
10.3.14 ALTER TABLE… TRUNCATE SUBPARTITION ......................................................404
10.3.14.1 Example - Emptying a Subpartition ...........................................................................404
10.4 Handling Stray Values in a LIST or RANGE Partitioned Table .................................................407
10.5 Specifying Multiple Partitioning Keys in a RANGE Partitioned Table ......................................413
10.6 Retrieving Information about a Partitioned Table .......................................................................414
10.6.1 Table Partitioning Views - Reference ..................................................................................415
10.6.1.1 ALL_PART_TABLES ...............................................................................................415
10.6.1.2 ALL_TAB_PARTITIONS .........................................................................................416
10.6.1.3 ALL_TAB_SUBPARTITIONS .................................................................................417
10.6.1.4 ALL_PART_KEY_COLUMNS ................................................................................418
10.6.1.5 ALL_SUBPART_KEY_COLUMNS ........................................................................418
11 ECPGPlus ........................................................................................................................................419
12 dblink_ora ........................................................................................................................................420
12.1 dblink_ora Functions and Procedures ..........................................................................................421
12.1.1 dblink_ora_connect() ...........................................................................................................421
12.1.2 dblink_ora_status() ..............................................................................................................422
Copyright © 2007 - 2018 EnterpriseDB Corporation. All rights reserved. 7
Database Compatibility for Oracle® Developers Guide
12.1.3 dblink_ora_disconnect() ......................................................................................................422
12.1.4 dblink_ora_record() .............................................................................................................423
12.1.5 dblink_ora_call() .................................................................................................................423
12.1.6 dblink_ora_exec() ................................................................................................................423
12.1.7 dblink_ora_copy() ...............................................................................................................424
12.2 Calling dblink_ora Functions ......................................................................................................425
13 System Catalog Tables ....................................................................................................................426
14 Acknowledgements .........................................................................................................................427
Copyright © 2007 - 2018 EnterpriseDB Corporation. All rights reserved. 8
Database Compatibility for Oracle® Developers Guide
1 Introduction
Database Compatibility for Oracle means that an application runs in an Oracle
environment as well as in the EDB Postgres Advanced Server (Advanced Server)
environment with minimal or no changes to the application code. Developing an
application that is compatible with Oracle databases in the Advanced Server requires
special attention to which features are used in the construction of the application. For
example, developing a compatible application means choosing compatible:
 System and built-in functions for use in SQL statements and procedural logic.
 Stored Procedure Language (SPL) when creating database server-side application
logic for stored procedures, functions, triggers, and packages.
 Data types that are compatible with Oracle databases
 SQL statements that are compatible with Oracle SQL
 System catalog views that are compatible with Oracle’s data dictionary
For detailed information about the compatible SQL syntax, data types, and views, please
see the Database Compatibility for Oracle Developers Reference Guide.
The compatibility offered by the procedures and functions that are part of the Built-in
packages is documented in the Database Compatibility for Oracle Developers Built-in
Packages Guide.
For information about using the compatible tools and utilities (EDB*Plus, EDB*Loader,
DRITA, and EDB*Wrap) that are included with an Advanced Server installation, please
see the Database Compatibility for Oracle Developers Tools and Utilities Guide.
For applications written using the Oracle Call Interface (OCI), EnterpriseDB’s Open
Client Library (OCL) provides interoperability with these applications. For detailed
information about using the Open Client Library, please see the EDB Postgres Advanced
Server OCI Connector Guide.
Advanced Server contains a rich set of features that enables development of database
applications for either PostgreSQL or Oracle. For more information about all of the
features of Advanced Server, please consult the user documentation available at the
EnterpriseDB website.
Advanced Server documentation is available at:
https://www.enterprisedb.com/resources/product-documentation
Copyright © 2007 - 2018 EnterpriseDB Corporation. All rights reserved. 9
Database Compatibility for Oracle® Developers Guide
1.1 What’s New
The following database compatibility for Oracle features have been added to Advanced
Server 10 to create Advanced Server 11:
 Advanced Server now supports SPL standalone procedure overloading. Note that
this feature is not compatible with Oracle databases. For more information, see
Section 3.2.3.1.
 Advanced Server now supports the PRAGMA AUTONOMOUS_TRANSACTION