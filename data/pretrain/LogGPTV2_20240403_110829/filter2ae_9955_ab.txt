    resultName = strcat(resultName,imgname);
    resultName =regexprep(resultName,'.tif','.gist');
    resultName = char(resultName);
    fid = fopen(resultName,'w');
    for i=1:512
       fprintf(fid,'%d ',gist(i));
    end
    fclose(fid);
    end
之后使用python批量化提取gist特征：
    def call_matlab(AllImg):  #  利用os.system() 执行cmd中的命令。
        cmmd = 'matlab -nojvm -nosplash -r "'
        get_gist = "get_gist"
        i = 0
        for img in AllImg:
            cmmd += get_gist +"('"+img+"');"
            if i==10:
                cmmd +='exit"'
                os.system(cmmd)
                print(cmmd)
                time.sleep(4)
                i = 0
                cmmd = 'matlab -nojvm -nosplash -r "'
            i += 1
### 卷积网络结构
上文使用Matlab软件进行Gist特征提取，提取结果为[1, 512]的二维数组，调整数据形状为[32,
16]，输入形状为32×16×1，第一层卷积核为5×5，将输入的1通道转为32通道，第二层使用批量归一化（BN算法），最大限度的保证输出在同一分布上，第三层为Relu激励层，第四层是卷积核形状为2×2的最大池化层。第五层为两个卷积核并行的卷积层，两个卷积核形状分别为3×3，5×5，第六层分别对上一层两个卷积操作进行批量归一化处理，第七层为两个卷积的Relu激励层，第八层使用concat函数将两个卷积操作后的输出拼合在一起。第九层是卷积核形状为2×2的最大池化层。第十层输出1024节点的全连接层，第十一层为Relu激励层，第十二层为dropout层，随机的选择一些数据进行丢弃，降低对小概率异常数据的学习机会。第十三层为9个节点的全连接层，最后归为9类。第十四层为softmax层。网络层次结构如下图所示：
## 数据集、训练设备及结果说明
### 数据集
本项目所采用的数据集为2015年微软公司在kaggle上发布的一个项目，项目地址为：
数据集解压后为400G大小，包括训练样本，测试样本，以及训练样本的标签，标签为一个csv文件，其中详细的标注了训练样本中每一个恶意代码样本的名称以及它所对应的家族种类。
系统样本库中所使用的九类恶意代码家族种类为：Ramnit，Lollipop，Kelihos_ver3，Vundo，Simda，Tracur，Kelihos_ver1，Obfuscator.ACY，Gatak。  
以下是每个家族的详细介绍：
  1. Ramnit家族所具备的危害为感染Windows可执行文件和HTML文件并尝试允许远程访问的病毒的检测。
  2. Lollipop家族所具备的危害为此广告软件程序会在您浏览网页时显示广告。它还可以重定向搜索引擎结果，监控您在PC上执行的操作，下载应用程序以及将有关PC的信息发送给黑客。
  3. Kelihos_ver3家族所具备的危害为可以分发垃圾邮件，其中可能包含自身安装程序的Web链接。它还可以连接到远程计算机以交换配置数据以及下载和执行任意文件。
  4. Vundo所具备的危害为提供“脱离上下文”的弹出式广告，下载和运行文件，经常作为DLL文件传播，并在未经您同意的情况下作为浏览器帮助对象（BHO）安装在您的PC上。
  5. Simda所具备的危害为威胁可以为您的PC提供恶意黑客后门访问和控制。然后，他们可以窃取您的密码并收集有关您PC的信息。
  6. Tracur所具备的危害为运行时，此脚本会将“ explorer.exe ”进程添加到Windows防火墙例外列表中，以故意降低系统安全设置。
  7. Kelihos_ver1所具备的危害为可以分发垃圾邮件，其中可能包含自身安装程序的Web链接。它还可以连接到远程计算机以交换配置数据以及下载和执行任意文件。
  8. Obfuscator.ACY所具备的危害为这种威胁一直是“obfuscated“，这意味着它试图隐藏其目的，因此您的安全软件无法检测到它。混淆之下的恶意软件几乎可以用于任何目的。
  9. Gatak所具备的危害为收集有关您的PC的信息并将其发送给黑客。它可以作为密钥生成器应用程序的一部分到达您的PC，或者看起来是合法应用程序的更新。
**样本数据共10860个，本实验采取随机抽样来分割训练样本和测试样本，即在任意类别中以4：1进行切分数据。训练样本共有8686个，测试样本有2174个。**
### 训练设备环境配置
  * cpu 40核
  * 内存256G
  * ubuntu系统；
  * python3.6；
  * python装有以下库：numpy， tensorflow， pyqt5， cv2；
### 结果
在测试集上准确率表现为98.758%，交叉熵表现为0.0858844。训练与测试如下图所示：
### TensorBoard可视化
在训练网络的代码中添加TensorBoard模块的API，生成日志文件，随后使用日志文件观测训练是否正常，准确率accuracy，交叉熵loss如图所示：
## 缺陷及限制
数据源中的样本并不包含正常文件，只有九类恶意代码家族样本，利用九类恶意代码家族样本训练出成熟的模型最后只能用于预测恶意代码家族分类，这是先天的因素所限制，导致本项目的可适用性略窄。而针对恶意代码家族标注的系统一般都会具备检测是否恶意代码功能，如果为恶意代码，则会进一步检测恶意代码的家族种类。