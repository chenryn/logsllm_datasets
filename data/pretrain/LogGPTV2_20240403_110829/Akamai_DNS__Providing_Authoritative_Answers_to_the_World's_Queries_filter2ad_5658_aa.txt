title:Akamai DNS: Providing Authoritative Answers to the World's Queries
author:Kyle Schomp and
Onkar Bhardwaj and
Eymen Kurdoglu and
Mashooq Muhaimen and
Ramesh K. Sitaraman
Akamai DNS: Providing Authoritative Answers to the World’s
Queries
Kyle Schomp†, Onkar Bhardwaj†, Eymen Kurdoglu†, Mashooq Muhaimen†, Ramesh K. Sitaraman†‡
kschomp,obhardwa,ekurdogl,mmuhaime,PI:EMAIL
‡University of Massachusetts Amherst
†Akamai Technologies
PI:EMAIL
ABSTRACT
We present Akamai DNS, one of the largest authoritative DNS
infrastructures in the world, that supports the Akamai content de-
livery network (CDN) as well as authoritative DNS hosting and
DNS-based load balancing services for many enterprises. As the
starting point for a significant fraction of the world’s Internet in-
teractions, Akamai DNS serves millions of queries each second
and must be resilient to avoid disrupting myriad online services,
scalable to meet the ever increasing volume of DNS queries, per-
formant to prevent user-perceivable performance degradation, and
reconfigurable to react quickly to shifts in network conditions and
attacks. We outline the design principles and architecture used to
achieve Akamai DNS’s goals, relating the design choices to the
system workload and quantifying the effectiveness of those designs.
Further, we convey insights from operating the production system
that are of value to the broader research community.
CCS CONCEPTS
• Networks → Application layer protocols; Naming and ad-
dressing;
KEYWORDS
DNS, Distributed Systems
ACM Reference Format:
Kyle Schomp, Onkar Bhardwaj, Eymen Kurdoglu, Mashooq Muhaimen,
and Ramesh K. Sitaraman. 2020. Akamai DNS: Providing Authoritative
Answers to the World’s Queries. In Annual conference of the ACM Special
Interest Group on Data Communication on the applications, technologies,
architectures, and protocols for computer communication (SIGCOMM ’20),
August 10–14, 2020, Virtual Event, NY, USA. ACM, New York, NY, USA,
14 pages. https://doi.org/10.1145/3387514.3405881
Permission to make digital or hard copies of all or part of this work for personal or
classroom use is granted without fee provided that copies are not made or distributed
for profit or commercial advantage and that copies bear this notice and the full citation
on the first page. Copyrights for components of this work owned by others than the
author(s) must be honored. Abstracting with credit is permitted. To copy otherwise, or
republish, to post on servers or to redistribute to lists, requires prior specific permission
and/or a fee. Request permissions from permissions@acm.org.
SIGCOMM ’20, August 10–14, 2020, Virtual Event, NY, USA
© 2020 Copyright held by the owner/author(s). Publication rights licensed to the
Association for Computing Machinery.
ACM ISBN 978-1-4503-7955-7/20/08...$15.00
https://doi.org/10.1145/3387514.3405881
465
1 INTRODUCTION
Naming is a central service of the Internet and is primarily ad-
dressed by the Domain Name System (DNS). Originally described
in 1983 [31], DNS enables the mapping of human-legible hierarchi-
cal names to arbitrary records, most notably IP addresses. Thus, we
refer to websites as “example.com” instead of “12.23.34.45”. From
its original design, DNS has expanded and grown in complex-
ity [37, 46, 50] and continues to be an area of innovation today
[13, 19, 21].
DNS consists of two types of systems that coordinate to provide
domain name translations for end-users. The client-side system pri-
marily consists of recursive resolvers that are charged with resolving
queries from end-users. A request from an end-user for a domain
name translation is first sent to its assigned resolver. If a valid trans-
lation is not found in the resolver’s cache, the resolver obtains the
answer by querying a system of authoritative nameservers for the
requested name. The authoritative system stores the associations
of domain names to records and provides definitive answers to
queries.
The authoritative system is organized hierarchically in accor-
dance with the name hierarchy. At the top, “root” nameservers
are responsible for the empty label “.” while one level down the
“toplevel domain” nameservers are responsible for the labels under
the root (e.g., “com”). Below that, organizations operate authorita-
tive nameservers for their respective domains, e.g., “google.com” is
served by Google’s nameservers. To obtain an answer to a query,
recursive resolvers iteratively search starting at the root and fol-
lowing delegations down the naming hierarchy, until reaching a
nameserver that is responsible for the domain of the query and re-
turns an answer. Nameservers include a Time-To-Live (TTL) field in
answers, allowing the resolver to cache the answer for a prescribed
amount of time, a feature that greatly improves performance and
decreases DNS traffic.
We present Akamai DNS, one of the largest authoritative DNS
infrastructures in the world, providing insights into its architecture,
algorithms, design principles, and operation. We start by describing
the services that it supports.
Authoritative DNS Services: Akamai DNS supports three au-
thoritative DNS services. The first is an authoritative DNS hosting
service (ADHS) that allows enterprises to host their DNS domains
on Akamai. The second service is global traffic management (GTM)
that allows DNS-based load-balancing among server deployments
owned by an enterprise. Third, Akamai DNS is a component of
Akamai’s CDN service, serving 15-20% of all web traffic [36], and
SIGCOMM ’20, August 10–14, 2020, Virtual Event, NY, USA
Schomp et al.
Figure 1: Queries per second served by Akamai DNS.
allows enterprises to outsource their entire content and application
delivery infrastructure to Akamai. While these services impose
differing requirements on the design of Akamai DNS, they can also
be used together by a single enterprise, e.g., DNS hosting for their
domains, GTM for their datacenters, and CDN services for edge
delivery of their content fetched from those datacenters.
Design Requirements: Akamai DNS is the starting point for
a significant fraction of the world’s interactions with the Internet,
whether it be end-users downloading web pages, watching videos,
shopping online, downloading software, or accessing social net-
works. Given its critical role in the Internet ecosystem, the first
and foremost requirement is 24/7 availability of the services that it
supports. Because DNS translations preface the majority of Inter-
net connections [45], even a minor disruption in Akamai DNS can
cause a worldwide disruption in online services, severely impacting
the conduct of commerce, business, and government around the
globe. Yet, server and network failures are common in distributed
systems. Also, due to the central role of DNS and high visibility
when it fails, DNS has become a popular target of distributed denial
of service (DDoS) attacks. Thus, Akamai DNS is architected to be
resilient to both failures and attacks.
Since querying Akamai DNS forms the first step in an end-user’s
interaction with many online services, the answers must be pro-
vided quickly, so as not to increase the response times experienced
by end-users. The system must also serve millions of queries per
second (see Figure 1), with query volumes increasing (an 18% in-
crease in the past year) in proportion to global Internet usage. Thus,
Akamai DNS is architected for both scalability and performance.
Finally, the authoritative answers provided by Akamai DNS must
adapt rapidly to changes in enterprise configurations, server live-
ness and load, and Internet conditions. For instance, to provide GTM
and CDN services, Akamai DNS must always resolve an end-user’s
query to a proximal server that can deliver the content with low
latency to the end-user [36]. When server or network conditions
degrade, new DNS records are computed by Akamai’s mapping sys-
tem [11] and propagated to resolvers through Akamai DNS within
seconds, so as to reroute end-user requests and prevent perfor-
mance degradation. Unlike traditional authoritative DNS whose
translations remain relatively static, Akamai DNS is architected for
rapid reconfigurability.
Our Contributions: Our work is the first in-depth view of the
architecture and capabilities of one of the world’s largest authori-
tative DNS infrastructures that is a key part of the global Internet
ecosystem. Specific contributions follow.
(1) We characterize how domain names are queried by resolvers
around the world from the unique vantage point of Akamai
DNS. We show that 3% of resolvers generate 80% of the DNS
queries and that those same resolvers consistently send high
volumes of DNS queries for periods of weeks to months.
(2) We outline the system architecture of Akamai DNS, including
key features such as its wide-area deployment, its use of anycast
to distribute DNS queries among locations, its software and
server architecture within each location to provide resiliency,
and its two-tier delegation system to provide rapid answers
with low TTLs.
(3) We describe our anycast failover mechanism for resilience. We
measure how long failover from one location to another takes
when advertising or withdrawing routes via BGP. We show that
in most scenarios failover is rapid – less than 1 sec in 76% of
measurements.
(4) We present the system design elements that provide resiliency
to network, hardware, and software failures and malicious DDoS
attacks. We present a taxonomy of attack scenarios and the
mitigations designed to thwart them.
(5) We show how Akamai DNS provides high performance by
anycast traffic engineering and two-tier delegation. We measure
the performance of two-tier delegation and show that it reduces
DNS times for 87-98% of resolutions over a single-tier.
Roadmap: The rest of the paper is laid out as follows. In §2, we
characterize the workload that Akamai DNS supports. Then in §3,
we present the system architecture. Next, §4 and §5 describe the
architectural features and algorithms that provide failure resilience,
attack resilience, and performance. Finally, we list related work (§6)
and conclude (§7). This work does not raise any ethical issues.
2 CHARACTERIZING QUERY TRAFFIC
We analyze the DNS queries served by Akamai DNS to understand
its basic properties and to justify the design decisions we made in
architecting Akamai DNS as described in this paper. Further, since
Akamai DNS serves a wide cross-section of the Internet ecosystem,
its query traffic is representative of how end-users across the world
access DNS as a prelude to accessing content and applications.
We analyze traffic served by Akamai DNS over a typical week
in December 2019. In this period, Akamai DNS served ∼360B DNS
queries per day originating from over 5.4M source IP addresses. As
shown in Figure 1, the rate of queries received varies diurnally from
3.9M to 5.6M queries per second (qps), with weekend-weekday vari-
ations. Using the EdgeScape geolocation service [3], we geolocate
the source IP addresses of DNS queries. While we observe DNS
queries from all around the globe, 92% of queries arrive from source
IP addresses in North America, Europe, and Asia.
We now examine how the DNS queries are distributed among
source IP addresses of resolvers. Figure 2 in line “IPs” shows a CDF
of what percent of resolver IP addresses account for what percent
of the total DNS traffic. The 3% of resolver IP addresses that drive
the most DNS queries account for 80% of all DNS queries, similar to
466
SunMonTueWedThuFriSatSun3.5m4m4.5m5m5.5m6mqueries per secondAkamai DNS
SIGCOMM ’20, August 10–14, 2020, Virtual Event, NY, USA
Figure 2: Percent of queries for/from percent of zones, ASNs,
and source IP addresses.
Figure 3: The avg/max queries per second per resolver.
observations in [17]. The resolvers that drive the most DNS queries
to Akamai DNS are also highly consistent over time. Using a list of
the top 3% of resolvers by DNS queries constructed weekly over 69
weeks, we find that week-to-week the lists contain 85-98% (mean
92%) of the same resolvers and month-to-month 79-98% (mean 88%).
The “ASNs” line shows that 1% of ASNs account for 83% of DNS
queries. The top 6 ASNs include 3 public DNS services, 2 major ISPs,
and Akamai itself. Both highly-skewed distributions demonstrate
that a small and relatively stable set of resolvers drive the majority
of DNS queries. The relatively stable access patterns observed here
allow us to detect and filter anomalous traffic as described in §4.3.4.
We breakdown the queries by domain requested in our domain
hosting service (ADHS)1. Figure 2 shows that the top 1% of the
zones account for 88% of all DNS queries, with one zone receiving
5.5% of all DNS queries and many infrequently-accessed zones.
Next, we examine the workload on individual authoritative
nameservers. Figure 3 shows the queries received by one specific,
modestly-loaded nameserver from 60K resolvers. The distribution
is highly skewed with most resolvers sending very few queries –
less than 1% sent greater than 1 qps on average. Further, we observe
that the workload exhibits bursty behavior with the highest aver-
age being only 173 qps while the maximum qps observed is 2,352.
These observations inform the design of filters that use historically-
observed query rates of resolvers to detect and flag anomalous
requests, e.g., the rate limiting filter described in §4.3.4.
We also observe that the resolvers sending the most DNS queries
to an individual nameserver are consistent over time. Taking two
one-hour samples of DNS queries exactly one week apart, we
compute per resolver the percent difference in DNS queries sent
during the two samples. Figure 4 shows the PDF of the differ-
ences, weighted by DNS queries sent. We observed that 53% of
the weighted resolvers differed by less than ±10%, indicating the
resolvers that send the most DNS queries predominantly continued
to do so a week later.
3 SYSTEM ARCHITECTURE
Akamai DNS consists of authoritative DNS nameservers that answer
DNS queries and supporting components that handle tasks such
1CDN and GTM use specific zones owned by Akamai and traffic patterns are likely
unique to Akamai. ADHS, on the other hand, hosts generic third-party zones that
enterprises may create for any purpose.
Figure 4: Change in query rate of resolvers in a week.
as metadata processing and transmission, monitoring and analysis,
and complex control and business logic. Figure 5 shows the high-
level architecture whose components we describe below.
3.1 Authoritative Nameservers
To provide quick responses to DNS queries received from resolvers
all around the world, Akamai’s authoritative nameservers number
in the tens of thousands and are distributed among hundreds of
points of presence (PoPs) in 157 countries. Like many other large
DNS platforms [12, 18, 39], Akamai relies heavily on IP anycast
to distribute load among the PoPs and to reduce the round-trip-
time (RTT) between resolvers and the authoritative nameservers.
We use a total of 24 distinct IPv4-IPv6 anycast prefix pairs for the
authoritative service. Each prefix pair forms an “anycast cloud” of
PoPs, from which they are advertised. To provide resiliency to PoP
failures, each of the 24 clouds are distributed among the PoPs, with
no PoP advertising more than two clouds.
PoP Architecture: Each PoP (Figure 6) consists of a router in
front of one or more purpose-built machines running our special-
ized nameserver software. Besides the nameserver, each machine
also runs a BGP-speaker that establishes a session with the PoP
router and advertises the clouds assigned to the PoP over that
session. The machines also run a local monitoring agent which con-
tinuously tests the nameserver’s health. If an problem is detected,
the BGP-speaker [40] withdraws the advertisement of the anycast
clouds, as further discussed in §4.2. When the router receives a