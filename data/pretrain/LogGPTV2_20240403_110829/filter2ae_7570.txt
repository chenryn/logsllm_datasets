# 【技术分享】利用服务器漏洞进行挖矿的黑产案例分析

## 译文声明
本文为翻译文章，原文来源：安全客。译文仅供参考，具体内容及含义以原文为准。

## 作者
360天眼实验室

## 概述
互联网产业中，BAT等公司代表了光明的一面，而与之相对的是黑暗面的网络黑产。这些黑产为了最大化收益，可谓是八仙过海，各显神通。有的通过窃取数据转卖实现财务自由，其中一些及时收手的人或许还能安享余生，而那些贪婪无度者则在近期日益严厉的打击下锒铛入狱。除了数据盗窃外，还有一些黑产通过榨取设备计算能力来获利。近期，天眼实验室追踪了一些利用已知漏洞攻击服务器并植入挖矿木马的团伙，并在此分享一个真实的案例。

希望通过这次曝光，能够引起管理员们的警觉，检查自身服务器是否存在漏洞，并清除机器中的恶意代码（如果存在漏洞，则几乎可以肯定已被入侵控制），从而确保数据和服务的安全。

基于Java的Web应用服务器曾出现过几个远程命令执行漏洞，例如：
- **CVE-2015-7450**：IBM WebSphere Java Comments Collections组件反序列化漏洞
- **CVE-2015-4852**：Oracle WebLogic Server Java反序列化漏洞

尽管这些漏洞的技术细节和利用工具已经公开了近2年，但目前互联网上仍有大量存在这些漏洞的Web服务器，这些服务器迟早会成为攻击者的猎物。一旦被控制，攻击者可以选择窃取数据或利用服务器的高性能硬件配置（如高速CPU和网络连接）进行挖矿，尤其是在比特币价格较高的情况下，这种行为对黑产来说可谓是一石二鸟。

## 案例
### 攻击流程
黑产通过扫描IP段发现开放特定端口的服务器，确认其存在漏洞后，利用这些漏洞控制服务器。随后，攻击者下载一张包含挖矿恶意程序的图片，解析并执行该图片，将服务器转变为一台挖矿肉鸡。

#### 示例
我们架设了一个蜜罐服务器，开放了WebLogic服务（http://xxx.xx.xx.xxx:7001/）。日志分析显示，攻击者利用了WebLogic应用服务器中的Java反序列化漏洞攻破了该服务器。获得控制权后，攻击者首先执行了一个脚本，该脚本用于下载并执行名为`regedit.exe`的程序。此程序会调用`powershell.exe`来执行以下Powershell脚本：

```powershell
# 脚本内容
```

脚本首先从开源网站下载工具程序`dd.exe`，该工具常被标记为白文件，因此可以绕过部分检测操作。接着，脚本从[https://ooo.0o0.ooo/2017/01/22/58842a764d484.jpg](https://ooo.0o0.ooo/2017/01/22/58842a764d484.jpg)下载了一张JPG图片。实际上，这张图片中嵌入了一个PE文件。最终，脚本使用`dd.exe`提取出该PE文件并命名为`msupdate.exe`。运行解压后的`msupdate.exe`会启动挖矿程序，指向特定的矿池和比特币钱包地址。

此外，我们还发现另一种脚本，它利用WebLogic漏洞下载如下链接的Powershell脚本：
- [http://45.33.56.197:43110/19pdroifAf1QR84u1yoG7J1ASwmc9r32nU/images/miner.ps1](http://45.33.56.197:43110/19pdroifAf1QR84u1yoG7J1ASwmc9r32nU/images/miner.ps1)

该脚本会下载`yam.exe`，并将其添加到计划任务中，每6小时运行一次，以确保恶意代码长期存在于服务器中。

## 影响范围
根据网络特征匹配，最近一个月内被此类恶意代码感染的机器超过20,000台，构成了可观的算力。IP来源统计显示，95%以上的感染服务器位于国内，反映出国内服务器安全管理仍需加强。按省份分布来看，黑龙江、湖北、河南、广东和四川是重灾区。

## 小结
黑产对于利益的追逐永无止境，他们会“充分”榨取所能得到的一切资源的价值。我们必须采取一切必要的措施来保护自己，绝不能寄希望于对手的懒惰。

## IOC（妥协指标）
### URL
- http://txrdr.com/sitecontent/WIN-WEB.jpg
- https://ooo.0o0.ooo/2017/01/22/58842a764d484.jpg
- http://45.33.56.197:43110/19pdroifAf1QR84u1yoG7J1ASwmc9r32nU/images/miner.ps1
- http://45.33.56.197:43110/19pdroifAf1QR84u1yoG7J1ASwmc9r32nU/images/yam.exe

### 文件名
- WIN-WEB.jpg
- rsyslog.exe

### 矿工用户名
- 1140***PI:EMAIL
- szt***PI:EMAIL
- att***PI:EMAIL
- ca***PI:EMAIL
- a4***PI:EMAIL
- y5***PI:EMAIL
- nan***PI:EMAIL