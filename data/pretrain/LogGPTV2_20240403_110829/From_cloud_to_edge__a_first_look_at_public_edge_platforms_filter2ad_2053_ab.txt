# 从云到边缘：公共边缘平台的初步观察

## 摘要
本文研究了中国领先的边缘计算平台NEP（以下简称NEP），并将其与传统的云计算平台进行比较。通过收集和分析大量的性能数据和工作负载数据，我们揭示了NEP在性能、资源使用等方面的独特优势。本文还提供了一个重要的基准，用于未来对边缘服务的研究。

## 1. 引言
随着边缘计算的日益普及（特别是在5G的推动下），我们的研究提供了关键的见解，以改进未来的边缘服务。同时，我们的结果也为未来研究提供了重要的“基准”。

### 开源数据
我们在研究中收集的边缘工作负载跟踪数据已开源，可在以下GitHub仓库获取：
- [https://github.com/xumengwei/EdgeWorkloadsTraces](https://github.com/xumengwei/EdgeWorkloadsTraces)

## 2. NEP边缘平台
### 2.1 背景和术语
NEP与传统云计算提供商（如阿里云和AWS EC2）的主要区别在于物理服务器的位置、组织和维护方式。虽然云计算提供商也在不同地理位置建立了大型数据中心，但边缘计算提供商更进一步，将地理分布视为首要目标。我们将不同位置的数据中心称为站点。每个站点包含许多服务器，每台服务器托管多个虚拟机（VM）。NEP的客户通常订阅一个或多个VM，在这些VM上运行应用程序或服务。在本研究中，我们认为使用相同系统镜像且属于同一用户的VM服务于同一个应用程序（边缘应用）。

### 2.2 NEP概述
尽管NEP仍处于早期阶段，但它已成为中国领先的边缘平台。与通常在一个国家内只有不到10个站点的云计算平台相比，NEP的站点数量大约是其两个数量级，并且数量仍在快速增长。这种差异导致了平台其他方面的显著连锁反应，如应用性能和资源使用等。云计算站点通常托管数千甚至数百万台服务器，而NEP站点通常只托管数十或数百台服务器，受限于物理基础设施（如空间和电力）。虽然NEP支持多种类型的服务（如PaaS和FaaS），但当前主要使用的是基础设施即服务（IaaS）VM。因此，本文主要针对NEP中的IaaS VM进行工作负载分析。NEP的物理服务器来自多个来源，大部分基于阿里巴巴CDN PoPs构建，部分由NEP和其他第三方IDC或网络运营商共同管理。NEP还为商业客户提供托管在其自有硬件上的边缘基础设施。然而，目前NEP的形式主要是基于微型数据中心，尚未普遍下沉到蜂窝核心网络中。

### 2.3 NEP操作
与云计算类似，部署NEP应用需要两个主要阶段：
1. **边缘提供商的VM放置**：客户首先向NEP管理员提交他们在不同地理位置的资源需求。例如：“我需要在广东省部署10台虚拟机，每台具有16个CPU核心和32GB内存。”NEP仅向客户提供相对较粗粒度的空间选择（如省份而不是站点），以确保灵活的资源分配策略。一旦收到订阅请求，NEP会返回一个可行的分配方案。NEP倾向于选择销售比率和实际CPU使用率较低的服务器。
2. **边缘客户的流量调度**：一旦NEP分配了VM，客户就完全控制这些VM，并负责将最终用户的请求调度到特定的VM。类似于内容分发网络（CDN）中的流量路由，边缘客户通常基于DNS或HTTP 302将用户请求路由到附近的站点。

### 2.4 测量方法
我们从NEP收集了两种类型的数据集：
1. **边缘性能数据**（见§2.4.1）：我们主动构建基准工具并通过众包和受控实验获得测试结果。
2. **边缘工作负载数据**（见§2.4.2）：我们被动记录边缘VM的活动和跟踪信息。

#### 2.4.1 边缘性能数据收集
我们主动收集了三种类型的数据：网络延迟、网络吞吐量和应用级性能，分别针对边缘和云计算环境。前两项通过众包获得，第三项在受控环境中进行。

- **边缘和云计算服务器**
  - **延迟**：我们在每个NEP边缘站点和每个阿里云区域设置一个VM作为ping的目标。
  - **吞吐量**：我们在不同城市设置了20个NEP VM，每个具有1Gbps带宽容量。由于实验产生的流量开销过大，我们没有使用所有NEP区域或阿里云。
  - **应用QoE**：我们在距离实验地点670公里、1300公里和2000公里的不同位置设置了1个最近的边缘VM和3个云VM。每个VM配置8个vCPU（2.5GHz）、16GB内存和足够的带宽。

- **用户设备（UE）**
  - 我们使用了几种现成的UE进行众包网络测量。对于应用QoE测试，我们使用了一台笔记本电脑（MacBook Pro，2019版，16英寸）和三部智能手机：三星Note 10+（Snapdragon 855，支持5G）、小米Redmi Note 8（Qualcomm Snapdragon 665）和Nexus 6（Qualcomm Snapdragon 805）。我们主要使用Qualcomm芯片组，因为GamingAnywhere框架无法利用其他芯片的内置编解码硬件。

- **测试工具和应用**
  - 我们主要使用traceroute（ICMP）和iPerf3（TCP）来获取网络延迟和吞吐量性能。我们还构建了两个QoE测试应用：云游戏和实时流媒体。

- **测试过程**
  - **延迟**：我们在中国招募了志愿者，他们使用Android设备运行我们的速度测试应用。测试完成后，结果会被加密并上传到我们的服务器，包括网络条件（WiFi/LTE/5G）、测试时间和城市名称。总计收到了来自158名用户、覆盖20个省份和41个城市的385份测试结果（>2M次ping）。
  - **吞吐量**：我们选择了25名志愿者在不同城市运行测试脚本。脚本使用iPerf3获取到每个选定的20个边缘VM的上下行吞吐量，每次连接持续15秒。
  - **应用QoE实验**：作者在同个城市的不同位置进行了多次重复测试，包括校园室内/室外和办公楼室内/室外。

#### 2.4.2 边缘工作负载数据收集
该数据集包含了从2020年6月1日至9月1日运行在NEP上的每个VM的信息，具体包括：
- **VM表**：每个VM的放置信息（托管在哪台服务器和哪个站点）、客户信息（归属者）和系统信息（镜像ID、操作系统类型、内核版本等）。
- **资源大小**：每个VM和服务器的最大CPU核心数、内存和磁盘容量。
- **CPU使用率**：每分钟报告一次每个VM的CPU使用率。
- **带宽使用**：每5分钟报告一次每个VM的带宽使用情况，包括内部（站点内）和外部流量。

## 3. 选择云工作负载进行比较
本文旨在比较NEP与云计算平台，揭示它们之间的差异，并展示NEP带来的关键优势。关于工作负载比较（见§4），我们调查了公开可用的云计算工作负载数据集，并总结如下：

- **Azure数据集** [38]：最具代表性的公共云平台数据集，我们使用了2019年的版本。
- **阿里云数据集** [3]：未使用，因为它仅包含容器使用情况而非VM，且时间范围太短（8天）。
- **Google数据集** [92]：未使用，因为其资源仅对Google内部开发者开放，且通过BigQuery接口访问不支持复杂的用途（如基于ML的预测）。
- **GWA-T-12数据集** [88]：未使用，因为规模太小且过时。

## 4. 揭示边缘性能
### 4.1 端到端网络延迟
基于收集的数据（见§2.4.1），我们首先计算每个用户和NEP站点之间的中位网络延迟，然后汇总用户的结果，以消除频繁用户的影响。为了简化起见，我们将“最近的边缘/云”定义为具有最小中位RTT的边缘/云站点。除了表示NEP/AliCloud当前部署的最佳网络性能的最近边缘/云外，我们还包括另外两个基线：(i) 第三个最近的边缘；(ii) 所有云，这是跨所有阿里云站点的平均值。这个基线反映了在全国范围内（以中国为例）部署集中式服务器的性能，这是一个经济和性能之间的常见权衡。

## 5. 伦理声明
在进行本研究时，我们采取了谨慎的步骤来保护用户隐私并保持研究伦理。对于收集边缘性能数据集，数据收集得到了研究所伦理委员会的批准，并且参与者在实验前通过知情同意书批准了数据收集。我们没有收集参与者的敏感数据，除了他们自己输入的居住城市。对于收集NEP的边缘工作负载数据集，数据收集得到了客户的批准，且在研究过程中没有收集可识别客户身份的信息。导出时，数据集中的客户ID已被匿名化。

---

图1：NEP平台的整体组织结构（顶部）和我们的测量方法（底部）。

本文的主要结论将在第6节中讨论。鉴于边缘计算（尤其是5G的推动下）日益普及，我们的工作提供了关键的见解，以改进未来的边缘服务。同时，我们的结果也为未来研究如何发展提供了重要的“基准”。

---
希望以上优化后的文本更加清晰、连贯和专业。如果有任何进一步的修改需求，请随时告知。