This script will now ask you the relevant information to create the SSL certificate of OpenVAS.
Note that this information will *NOT* be sent to anybody (everything stays local), but anyone with
the ability to connect to your OpenVAS daemon will be able to retrieve this information.
CA certificate life time in days [1460]:
#设置CA证书有效时间
Server certificate life time in days [365]:
#设置服务证书有效时间
Your country (two letter code) [DE]:
#设置国家
Your state or province name [none]:
#设置州或省份
Your location (e.g. town) [Berlin]:
#设置城市
Your organization [OpenVAS Users United]:
#设置组织
以上提示的信息，可以配置也可以不配置。如果不想配置的话，直接按下Enter键接
收默认值即可。以上信息设置完后，将显示以下信息：
Creation of the OpenVAS SSL Certificate
Congratulations.Your server certificate was properly created
The following files were created:
Certification authority:
Certificate = /var/lib/openvas/CA/cacert.pem
Private key = /var/lib/openvas/private/CA/cakey.pem
OpenVASServer:
Certificate = /var/lib/openvas/CA/servercert.pem
Private key= /varlib/openvas/private/CA/serverkey.pem
· 133 •
---
## Page 146
第2篇信息的收集及利用
Press [ENTER] to exit
输出的信息显示了创建的OpenVAS证书及位置。此时按下Enter键，退出程序。
（2）使用OpenVASNVTFeed同步OpenVASNVT数据库，并且更新最新的漏洞检查。
执行命令如下所示：
root@kali:/usr/share/openvas# openvas-nvt-sync
[i] This script synchronizes an NVT collection with the ‘OpenVAS NVT Feed".
[i] The ‘OpenVAS NVT Feed’ is provided by 'The OpenVAS Project'
[i] NVT dir: /var/lib/openvas/plugins
[i] rsync is not recommended for the initial sync. Falling back on http.
[j] will use wget
[i] Using GNU wget: /usr/bin/wget
[i] Downloading to: /tmp/openvas-nvt-sync.xAKyyzYVdT/openvas-feed-2014-04-25-8214.tar.bz2
current.tar.bz2
正在解析主机www.openvas.org(www.openvas.org)...5.9.98.186
正在连接www.openvas.org（www.openvas.org)|5.9.98.186|：80..已连接。
已发出HTTP请求，正在等待回应..200OK
长度：14771061（14M)[application/x-bzip2]
正在保存至：“/tmp/openvas-nvt-sync.xAKyyzYVdT/openvas-feed-2014-04-25-8214.tar.bz2
14,771.06154.0K/s用时7m16s
2014-04-25-8214.tar.bz2"[14771061/14771061])
12planet_chat_server_xss.nasl
12planet_chat_server_xss.nasl.asc
2013/
2013/secpod_ms13-005.nasl.asc
2013/gb_astium_voip_pbx_51273.nasl
2013/secpod_ms13-001.nasl
2013/deb_2597.nasl
2013/gb_astium_voip_pbx_51273.nasl.asc
2013/secpod_ms13-006.nasl
2013/gb_edirectory_57038.nasl
2013/secpod_ms13-006.nasl.asc
...省略部分内容...
zope_zclass.nasl.asc
zyxel_http_pwd.nasl
zyxel_http_pwd.nasl.asc
zyxel_pwd.nasl
zyxel_pwd.nasl.asc
[i]Download complete
[i] Checking dir: ok
[] Checking MD5 checksum: ok
输出的信息显示了同步OpenVASNVT数据库的信息，并也更新了所有的漏洞信息。
（3）创建客户端证书库。执行命令如下所示：
root@kali:/usr/share/openvas# openvas-mkcert-client -n om -i
Generating RSA private key, 1024 bit long modulus
* 134 *
---
## Page 147
第5章漏润扫描
..++++++
e is 65537 (0x10001)
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '', the field will be left blank.
Country Name (2 letter code) [DE]:State or Province Name (full name) [Some-State]:Locality
Name (eg. city) [:Organization Name (eg. company) [Internet Widgits Pty Ltd]:Organizational Unit
Name (eg, section) []:Common Name (eg, your name or your server's hostname) [:Email Address
:Using configuration from /tmp/openvas-mkcert-client.16792/stdC.cnf
Check that the request matches the signature
Signature ok
The Subject's Distinguished Name is as follows
countryName
PRINTABLE:DE'
localityName
PRINTABLE:Berlin'
commonName
:PRINTABLE:'om'
Certificate is to be certified until Apr 25 06:55:05 2015 GMT (365 days)
Write out database with 1 new entries
Data Base Updated
User om added to OpenVAS.
以上输出的信息显示了生成客户端证书的详细过程，并添加了om用户。
（4）重建数据库。执行命令如下所示：
执行以上命令后，没有任何输出信息。
（5）启动OpenVAS扫描，并加载所有插件。执行命令如下所示：
root@kali:/usr/share/openvas# openvassd
Loading the OpenVAS plugins...base gpgme-Message: Setting GnuPG homedir to '/etc/openvas/
gnupg'
base gpgme-Message: Using OpenPGP engine version ‘1.4.12
All plugins loaded
从输出的信息中可以看到所有插件已加载。由于加载的插件比较多，所以执行该命令
的时间会长一点。
（6）重建并创建数据库的备份。执行命令如下所示：
root@kali:/usr/share/openvas# openvasmd --rebuild
root@kali:/usr/share/openvas# openvasmd -backup
执行以上命令后，没有任何信息输出。
（7）创建一个管理OpenVAS的用户。执行命令如下所示：
root@kali/usr/share/openvas# openvasad -c'add_user' -n openvasadmin -r Admin
Enter password:
admain:MESSAGE:2732:2014-04-25 15h25.35 CST:No rules file provided, the new user will
have no restrictions.
ad main:MESSAGE:2732:2014-04-25 15h25.35 CST: User openvasadmin has been successfully
created.
从输出的信息中可以看到用户openvasadmin被成功创建。
（8）创建一个普通用户。执行命令如下所示：
· 135 *
---
## Page 148
第2篇信息的收集及利用
root@kali:/usr/share/openvas#openvas-adduser
Using /var/tmp as a temporary file holder.
Add a new openvassd user
Login : lyw
#输入用户名
Authentication (pass/cert)[pass]:pass
#选择认证方式
Login password :
#设置用户密码
Login password (again) :
#输入确认密码
User rules
openvassd has a rules system which allows you to restrict the hosts that lyw has the right to test.
For instance, you may want him to be able to scan his own host only.
Please see the openvas-adduser(8) man page for the rules syntax.
Enter the rules for this user, and hit ctrl-D once you are done:
(the user can have an empty rules set)
#按下Ctrl+D
Login
:lyw
Password
：**8*******8
Rules
Is that ok? (y/n) [y] y
：
#输入y，提交数据
user added.
从输出的信息中看到用户被添加。
（9）为OpenVAS配置端口。执行命令如下所示：
root@kali:/usr/share/openvas# openvasmd -p 9390-a 127.0.0.1
root@kali:/usr/share/openvas# openvasad -a 127.0.0.1 -p 9393
root@kali:/usr/share/openvas# gsad --http-only --listen=127.0.0.1 -p 9392
执行以上命令后，OpenVAS的端口号就被设置为9392。
注意：9392是推荐的一个Web浏览器端口。用户也可以选择其他端口号。
（10）在浏览器中输入http://127.0.0.1:9392/，打开OpenVAS登录界面，如图5.28所示。
Greenbone Security Assistant = Iceweasel
-0×
Ele Edt Yew Higtory BeokmarisIoois Help
one Security Assistant
 127.0.0.1:9]
ogle
ilom
rtive Sec
arity
, Kali Linux
Kali Docs
Gree
Login
图5.28OpenVAS登录界面
· 136 *
---
## Page 149
第5章漏洞扫描
（11）在该界面输入创建的用户名和密码，然后单击Login按钮，将显示如图5.29所
示的界面。
0x
Ele Edr yiew Higtory leokir
marksIooiselp
ttsssy Aunsag eue
+
 127.0.0.1
ack-ng
curily Aasi
apply
图目
图5.29 OpenVAS 初始界面
关于启动OpenVAS介绍一些附加信息。每次运行OpenVAS时，都必须要做以下工作：
口同步NVTFeed（当新的漏洞被发现时，该记录将改变）：
口启动OpenVAS扫描器：
口重建数据库：
口备份数据库；
口配置端口。
为了节约时间，下面将介绍编写一个简单的Bash脚本，方便用户启动OpenVAS。保
存脚本文件名为OpenVAS.sh，并放该文件在/root文件夹中脚本文件内容如下所示：
#1/bin/bash
openvas-nvt-sync
openvassd
openvasmd --rebuild
openvasmd --backup
openvasmd -p 9390 -a 127.0.0.1
openvasad -a 127.0.0.1-p 9393
gsad --http-only --listen=127.0.0.1 -p 9392
编写好该脚本时，以后运行OpenVAS
Log lr
就不用执行多条命令了，只需要执行一下
rofile
OpenVAS.sh脚本就可以了。
在Kali中，OpenVAS也提供了图形界
Save
Delete
面。启动OpenVAS图形界面的方法如下：
Serveraddress Port
在Kali桌面上依次选择“应用程
127.0.0.1
9390
序”Kali Linux]“漏洞分析”OpenVAS|
Username
openvas-gsd命令，将显示如图5.30所示的
openvasadmin
界面。
Password
在该界面输入服务器的地址
**....
127.0.0.1、用户名和登录密码。然后单击
Log in
Login按钮即可登录到OpenVAS服务器。
图5.30OpenVAS图形登录界面
· 137 ·
---
## Page 150
第2篇信息的收集及利用
5.2.2创建ScanConfig和扫描任务
通过以上步骤OpenVAS就配置好了，现在使用浏览器的方式登录服务器。在该服务
器中新建ScanConfig、创建扫描目标及新建扫描任务才可以进行各种漏洞扫描。设置好这
些信息用户就可以进行各种漏洞扫描了，如本地漏洞扫描、网络漏洞
扫描和指定操作系统漏洞扫描等。进行这些漏洞扫描之前，都必须要
gurac
创建ScanConfig和扫描任务等。这里将分别介绍这些配置，方便后面
Targets
Pert Lists
的使用。
Credentials
Scan Cenfige
1.新建Scan Config
Alerts
Filters
Schedules
新建ScanConfig的具体操作步骤如下所示。
Report Formats
（1）在服务器的菜单栏中依次选择Configuration|ScanConfigs命
Slaves
Agenti
令，如图5.31所示。单击ScanConfigs命令后，将显示如图5.32所示
图5.31 Scan Configs
的界面。
Scan Configs 1 - 5 of 5 (total: 5) 图
vNe aa
G
Fiter: rows=10 first=1 sort=name
FamiliesNVTs
Total TrendTotalTrend
(Empty and static configuration template.)
empty
。
口
0
Full and fast
(Most NVTs: opti
ized by using pre
51
34694
Full and fast ultimate
Mest NVT's including these that can s
51
34694
Full and very deep
51
34694
Full and very deep ultimate
Most NVT's including those that can stop
51
34694
0
图5.32 Scan Configs 界面
（2）从该界面可以看到默认总共有5个ScanConfig。在该界面单击（NewScanConfig）
图标，将显示如图5.33所示的界面。
Greenbone
curityAssi
FriApr 25.07-51:38.20141TC
New Scan Config 
 Empty, satic and fast
○ Full nd ftt
 Create Scan Config
图 5.33 New Scan Config
· 138 ·
---
## Page 151
第5章漏洞扫描
(3)在该界面设置扫描的名称，这里设置为LocalVulnerabilities。对于Base选择Empty，
staticandfast复选框，该选项允许用户从零开始并创建自已的配置。然后单击CreateScan
Config按钮，将会看到新建的配置，如图5.34所示。
Familes
NVTs
Tetal Trend TetalTrend
Local Vulnerabilities
。
图5.34新建的 LocalVulnerabilities
（4）从该界面可以看到新建的LocalVulnerabilities，要编辑该配置可以单击（EditScan
Config）图标。创建好ScanConfig后需选择扫描的内容。此时单击图标选择扫描的内容，
如图5.35所示。
Edit Scan Config 图
Save Config
Edit Network Vulnerability Test Families
Family
NVT's sele
t all NVT's
Act
Compliance
0 of4
Detabases
0 of115
口
0 of2899
口
Default Accounts
0 of68
aoyua5 jo feua0
0 of 877
H
FTP
0 of 168
Z
Total: 0
0 of 0
口
Save Config
图5.35选择扫描内容
（5）从该界面的Family栏看到有很多的可扫描信息，此时将SelectallNVT's栏中的复
选框勾选上即可，设置完后，单击SaveConfig按钮。图5.35是经过修改后的一个图，该
界面显示的内容较多，由于篇幅的原因，这里只截取了一部分。
2.新建目标
在服务器的菜单栏中依次选择ConfigurationTargets命令，将显示如图5.36所示的
界面。
Greenbone
tApr2603:16:282014UT0
Targets 1 - 1 of1 (total: 1)国
/Ne
rows=10 first=1 sort=name
Name
Hosts
IPsPort List
SSH Credential
SMB Credential
Actions
Localhost