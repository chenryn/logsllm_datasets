If a queue structure becomes full, return code MQRC_STORAGE_MEDIUM_FULL is returned to the
application.
If the administration structure becomes full, the exact symptoms depend on which processes
experience the error, they might range from no responses to CMDSCOPE(GROUP) commands, to
queue manager failure as a result of problems during commit processing.
System programmer action
You can use IBM MQ to inhibit MQPUT operations to some of the queues in the structure to prevent
applications from writing more messages, start more applications to get messages from the queues,
or quiesce some of the applications that are putting messages to the queue.
Alternatively you can use XES facilities to alter the structure size in place. The following z/OS
command alters the size of the structure:
SETXCF START,ALTER,STRNAME= structure-name,SIZE= newsize
where newsize is a value that is less than the value of MAXSIZE specified on the CFRM policy for the
structure, but greater than the current coupling facility size.
You can monitor the utilization of a coupling facility structure with the DISPLAY CFSTATUS command.
A Db2 system fails
If a Db2 subsystem that IBM MQ is connected to fails, IBM MQ attempts to reconnect to the subsystem,
and continue working. If you specified a Db2 group attach name in the QSGDATA parameter of the
CSQ6SYSP system parameter module, IBM MQ reconnects to another active Db2 that is a member of the
same data-sharing group as the failed Db2, if one is available on the same z/OS image.
There are some queue manager operations that do not work while IBM MQ is not connected to Db2.
These are:
• Deleting a shared queue or group object definition.
• Altering, or issuing MQSET on, a shared queue or group object definition. The restriction of MQSET on
shared queues means that operations such as triggering or the generation of performance events do not
work correctly.
• Defining new shared queues or group objects.
• Displaying shared queues or group objects.
• Starting, stopping, or other actions for shared channels.
• Reading the shared queue definition from Db2 the first time that the shared queue is open by issuing an
MQOPEN.
Other IBM MQ API operations continue to function as normal for shared queues, and all IBM MQ
operations can be performed against the queue manager private versions (COPY objects) built from
GROUP objects. Similarly, any shared channels that are running continue normally until they end or have
an error, when they go into retry state.
When IBM MQ reconnects to Db2, resynchronization is performed between the queue manager and Db2.
This involves notifying the queue manager of new objects that have been defined in Db2 while it was
disconnected (other queue managers might have been able to continue working as normal on other
z/OS images through other Db2 subsystems), and updating object attributes of shared queues that have
changed in Db2. Any shared channels in retry state are recovered.
If a Db2 fails, it might have owned locks on Db2 resources at the time of failure. In some cases, this might
make certain IBM MQ objects unavailable to other queue managers that are not otherwise affected. To
resolve this, restart the failed Db2 so that it can perform recovery processing and release the locks.
496 Troubleshooting and Support for IBM MQ
A Db2 data-sharing group fails
If an entire Db2 data-sharing group fails, recovery might be to the time of failure, or to a previous point in
time.
In the case of recovery to the point of failure, IBM MQ reconnects when Db2 has been recovered, the
resynchronization process takes places, and normal queue manager function is resumed.
However, if Db2 is recovered to a previous point in time, there might be inconsistencies between the
actual queues in the coupling facility structures and the Db2 view of those queues. For example, at the
point in time Db2 is recovered to, a queue existed that has since been deleted and its location in the
coupling facility structure reused by the definition of a new queue that now contains messages.
If you find yourself in this situation, you must stop all the queue managers in the queue sharing group,
clear out the coupling facility structures, and restart the queue managers. You must then use IBM MQ
commands to define any missing objects. To do this, use the following procedure:
1.Prevent IBM MQ from reconnecting to Db2 by starting Db2 in utility mode, or by altering security
profiles.
2.If you have any important messages on shared queues, you might be able to offload them using the
COPY function of the CSQUTIL utility program, but this might not work.
3.Terminate all queue managers.
4.Use the following z/OS command to clear all structures:
SETXCF FORCE,STRUCTURE,STRNAME=
5.Restore Db2 to a historical point in time.
6.Reestablish queue manager access to Db2.
7.Restart the queue managers.
8.Recover the IBM MQ definitions from backup copies.
9.Reload any offloaded messages to the shared queues.
When the queue managers restart, they attempt to resynchronize local COPY objects with the Db2 GROUP
objects. This might cause IBM MQ to attempt to do the following:
• Create COPY objects for old GROUP objects that existed at the point in time Db2 has recovered to.
• Delete COPY objects for GROUP objects that were created since the point in time Db2 has recovered to
and so do not exist in the database.
The DELETE of COPY objects is attempted with the NOPURGE option, so it fails for queue managers that
still have messages on these COPY queues.
Db2 and the coupling facility fail
If the coupling facility fails, the queue manager might fail, and Db2 will also fail if it is using this coupling
facility.
Recover Db2 using Db2 recovery procedures. When Db2 has been restarted, you can restart the queue
managers. The CF administration structure will also have failed, but this is rebuilt by restarting all the
queue managers within the queue sharing group.
If a single application structure within the coupling facility suffers a failure, the effect on the queue
manager depends on the level of the queue manager and the CFLEVEL of the failed CF structure:
• If the CF application structure is CFLEVEL(3) or higher and RECOVER is set to YES, it will not be usable
until you recover the CF structure by issuing an MQSC RECOVER CFSTRUCT command to the queue
IBM MQ troubleshooting and support 497
manager that will do the recovery. You can specify a single CF structure to be recovered, or you can
recover several CF structures simultaneously. The queue manager performing the recovery locates the
relevant backups on all the other queue managers' logs using the data in Db2 and the bootstrap data
sets. The queue manager replays these backups in the correct time sequence across the queue sharing
group, from just before the last backup through to the point of failure. If a recoverable application
structure has failed, any further application activity is prevented until the structure has been recovered.
If the administration structure has also failed, all the queue managers in the queue sharing group must
be started before the RECOVER CFSTRUCT command can be issued. All queue managers can continue
working with local queues and queues in other CF structures during recovery of a failed CF structure.
• If the CF application structure is CFLEVEL(3) or higher and RECOVER is set to NO, the structure is
automatically reallocated by the next MQOPEN request performed on a queue defined in the structure.
All messages are lost, as the structure can only contain non-persistent messages.
• If the CF application structure has a CFLEVEL less than 3, the queue manager fails. On queue manager
restart, peer recovery attempts to connect to the structure, detect that the structure has failed and
allocate a new version of the structure. All messages on shared queues that were in CF structures
affected by the coupling facility failure are lost.
Since IBM WebSphere MQ 7.1, queue managers in queue sharing groups have been able to tolerate loss
of connectivity to coupling facility structures without failing. If the structure has experienced a connection
failure, attempts are made to rebuild the structure in another coupling facility with better connectivity in
order to regain access to shared queues as soon as possible.
Problems with long-running units of work
Use this topic to investigate, and resolve problems with long-running units of work.
This topic explains what to do if you encounter a long-running unit of work during restart. In this context,
this means a unit of work that has been active for a long time (possibly days or even weeks) so that the
origin RBA of the unit of work is outside the scope of the current active logs. This means that restart could
take a long time, because all the log records relating to the unit of work have to be read, which might
involve reading archive logs.
Old unit of work found during restart
Problem
A unit of work with an origin RBA that predates the oldest active log has been detected during restart.
Symptoms
IBM MQ issues the following message:
CSQR020I +CSQ1 OLD UOW FOUND
System action
Information about the unit of work is displayed, and message CSQR021D is issued, requesting a
response from the operator.
System programmer action
None.
Operator action
Decide whether to commit the unit of work or not. If you choose not to commit the unit of work, it is
handled by normal restart recovery processing. Because the unit of work is old, this is likely to involve
using the archive log, and so takes longer to complete.
498 Troubleshooting and Support for IBM MQ
IMS-related problems
Use this topic to investigate, and resolve problems with IMS and IBM MQ.
This topic includes plans for the following problems that you might encounter in the IMS environment:
• “IMS cannot connect to IBM MQ” on page 499
• “IMS application problem” on page 499
• “IMS is not operational” on page 500
IMS cannot connect to IBM MQ
Problem
The IMS adapter cannot connect to IBM MQ.
Symptoms
IMS remains operative. The IMS adapter issues these messages for control region connect:
• CSQQ001I
• CSQQ002E
• CSQQ003E
• CSQQ004E
• CSQQ005E
• CSQQ007E
For details, see the IBM MQ for z/OS messages, completion, and reason codes documentation.
If an IMS application program tries to access IBM MQ while the IMS adapter cannot connect, it can
either receive a completion code and reason code, or terminate abnormally. This depends on the
value of the REO option in the SSM member of IMS PROCLIB.
System action
All connection errors are also reported in the IMS message DFS3611.
System programmer action
None.
Operator action
Analyze and correct the problem, then restart the connection with the IMS command:
/START SUBSYS subsysname
IMS requests the adapter to resolve in-doubt units of recovery.
IMS application problem
Problem
An IMS application terminates abnormally.
Symptoms
The following message is sent to the user's terminal:
DFS555I TRANSACTION tran-id ABEND abcode
MSG IN PROCESS: message data:
where tran-id represents any IMS transaction that is terminating abnormally and abcode is the
abend code.
IBM MQ troubleshooting and support 499
System action
IMS requests the adapter to resolve the unit of recovery. IMS remains connected to IBM MQ.
System programmer action
None.
Operator action
As indicated in message DFS554A on the IMS master terminal.
IMS is not operational
Problem
IMS is not operational.
Symptoms
More than one symptom is possible:
• IMS waits or loops
IBM MQ cannot detect a wait or loop in IMS, so you must find the origin of the wait or loop. This can
be IMS, IMS applications, or the IMS adapter.
• IMS terminates abnormally.
– See the manuals IMS/ESA Messages and Codes and IMS/ESA Failure Analysis Structure Tables for
more information.
– If threads are connected to IBM MQ when IMS terminates, IBM MQ issues message CSQ3201E.
This message indicates that IBM MQ end-of-task (EOT) routines have been run to clean up and
disconnect any connected threads.
System action
IBM MQ detects the IMS error and:
• Backs out in-flight work.
• Saves in-doubt units of recovery to be resolved when IMS is reconnected.
System programmer action
None.
Operator action
Resolve and correct the problem that caused IMS to terminate abnormally, then carry out an
emergency restart of IMS. The emergency restart:
• Backs out in-flight transactions that changed IMS resources.
• Remembers the transactions with access to IBM MQ that might be in doubt.
You might need to restart the connection to IBM MQ with the IMS command:
/START SUBSYS subsysname
During startup, IMS requests the adapter to resolve in-doubt units of recovery.
Hardware problems
Use this topic as a starting point to investigate hardware problems.
If a hardware error causes data to be unreadable, IBM MQ can still be recovered by using the media
recovery technique:
1.To recover the data, you need a backup copy of the data. Use DFDSS or Access Method Services
REPRO regularly to make a copy of your data.
2.Reinstate the most recent backup copy.
3.Restart the queue manager.
500 Troubleshooting and Support for IBM MQ
The more recent your backup copy, the more quickly your subsystem can be made available again.
When the queue manager restarts, it uses the archive logs to reinstate changes made since the backup
copy was taken. You must keep sufficient archive logs to enable IBM MQ to reinstate the changes fully. Do
not delete archive logs until there is a backup copy that includes all the changes in the log.
IBM MQ troubleshooting and support 501
502 Troubleshooting and Support for IBM MQ
Notices
This information was developed for products and services offered in the U.S.A.
IBM may not offer the products, services, or features discussed in this document in other countries.
Consult your local IBM representative for information on the products and services currently available in
your area. Any reference to an IBM product, program, or service is not intended to state or imply that
only that IBM product, program, or service may be used. Any functionally equivalent product, program, or
service that does not infringe any IBM intellectual property right may be used instead. However, it is the
user's responsibility to evaluate and verify the operation of any non-IBM product, program, or service.
IBM may have patents or pending patent applications covering subject matter described in this
document. The furnishing of this document does not grant you any license to these patents. You can
send license inquiries, in writing, to:
IBM Director of Licensing
IBM Corporation
North Castle Drive
Armonk, NY 10504-1785
U.S.A.
For license inquiries regarding double-byte (DBCS) information, contact the IBM Intellectual Property
Department in your country or send inquiries, in writing, to:
Intellectual Property Licensing
Legal and Intellectual Property Law
IBM Japan, Ltd.
19-21, Nihonbashi-Hakozakicho, Chuo-ku
Tokyo 103-8510, Japan
The following paragraph does not apply to the United Kingdom or any other country where such
provisions are inconsistent with local law: INTERNATIONAL BUSINESS MACHINES CORPORATION
PROVIDES THIS PUBLICATION "AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR
IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT,
MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. Some states do not allow disclaimer of
express or implied warranties in certain transactions, therefore, this statement may not apply to you.
This information could include technical inaccuracies or typographical errors. Changes are periodically
made to the information herein; these changes will be incorporated in new editions of the publication.
IBM may make improvements and/or changes in the product(s) and/or the program(s) described in this
publication at any time without notice.
Any references in this information to non-IBM Web sites are provided for convenience only and do not in
any manner serve as an endorsement of those Web sites. The materials at those Web sites are not part of
the materials for this IBM product and use of those Web sites is at your own risk.
IBM may use or distribute any of the information you supply in any way it believes appropriate without
incurring any obligation to you.
Licensees of this program who wish to have information about it for the purpose of enabling: (i) the
exchange of information between independently created programs and other programs (including this
one) and (ii) the mutual use of the information which has been exchanged, should contact:
IBM Corporation
Software Interoperability Coordinator, Department 49XA
3605 Highway 52 N
Rochester, MN 55901
U.S.A.
© Copyright IBM Corp. 2007, 2023 503
Such information may be available, subject to appropriate terms and conditions, including in some cases,
payment of a fee.
The licensed program described in this information and all licensed material available for it are provided
by IBM under terms of the IBM Customer Agreement, IBM International Program License Agreement, or
any equivalent agreement between us.
Any performance data contained herein was determined in a controlled environment. Therefore, the
results obtained in other operating environments may vary significantly. Some measurements may have
been made on development-level systems and there is no guarantee that these measurements will be
the same on generally available systems. Furthermore, some measurements may have been estimated
through extrapolation. Actual results may vary. Users of this document should verify the applicable data
for their specific environment.
Information concerning non-IBM products was obtained from the suppliers of those products, their
published announcements or other publicly available sources. IBM has not tested those products and
cannot confirm the accuracy of performance, compatibility or any other claims related to non-IBM
products. Questions on the capabilities of non-IBM products should be addressed to the suppliers of
those products.
All statements regarding IBM's future direction or intent are subject to change or withdrawal without
notice, and represent goals and objectives only.
This information contains examples of data and reports used in daily business operations. To illustrate
them as completely as possible, the examples include the names of individuals, companies, brands, and
products. All of these names are fictitious and any similarity to the names and addresses used by an
actual business enterprise is entirely coincidental.
COPYRIGHT LICENSE:
This information contains sample application programs in source language, which illustrate programming
techniques on various operating platforms. You may copy, modify, and distribute these sample programs
in any form without payment to IBM, for the purposes of developing, using, marketing or distributing
application programs conforming to the application programming interface for the operating platform
for which the sample programs are written. These examples have not been thoroughly tested under
all conditions. IBM, therefore, cannot guarantee or imply reliability, serviceability, or function of these
programs.
If you are viewing this information softcopy, the photographs and color illustrations may not appear.
Programming interface information
Programming interface information, if provided, is intended to help you create application software for
use with this program.
This book contains information on intended programming interfaces that allow the customer to write
programs to obtain the services of WebSphere MQ.
However, this information may also contain diagnosis, modification, and tuning information. Diagnosis,
modification and tuning information is provided to help you debug your application software.
Important: Do not use this diagnosis, modification, and tuning information as a programming interface
because it is subject to change.
Trademarks
IBM, the IBM logo, ibm.com®, are trademarks of IBM Corporation, registered in many jurisdictions
worldwide. A current list of IBM trademarks is available on the Web at "Copyright and trademark
information"www.ibm.com/legal/copytrade.shtml. Other product and service names might be trademarks
of IBM or other companies.
Microsoft and Windows are trademarks of Microsoft Corporation in the United States, other countries, or
both.
504 Notices
UNIX is a registered trademark of The Open Group in the United States and other countries.
Linux is a registered trademark of Linus Torvalds in the United States, other countries, or both.
This product includes software developed by the Eclipse Project (https://www.eclipse.org/).
Java and all Java-based trademarks and logos are trademarks or registered trademarks of Oracle and/or
its affiliates.
Notices 505
506 Troubleshooting and Support for IBM MQ
IBM®
Part Number:
:N/P
)P1(