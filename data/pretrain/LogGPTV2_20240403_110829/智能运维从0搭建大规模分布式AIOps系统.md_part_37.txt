行类推或延伸，借以预测下一段时间或以后若干年内可能达到的水平。其内容包括：收集与整
预测法就是通过编制和分析时间序列，根据时间序列所反映出来的发展过程、方向和趋势，进
据或者动态数列。它是将某种统计指标的数值，按时间先后顺序排列所形成的数列。时间序列
移动平均法是一种简单的平滑预测技术。它的基本思想是基于时间序列的历史数据，依次
时间序列预测法可用于短期、中期和长期预测。在进行非平稳时间序列（Non-stationary
时间序列一般具有如下比较明显的特征。
在实时监控系统中所处理的数据通常具有时间特征，因此被称作时间序列，也叫作时间数
O随机性（Random）：也称不规则波动。
趋势性（Trend)：数据呈现某种持续向上或向下的趋势或者规律。
移动平均法
周期性（Cyclical)：也称循环波动性或者周期波动现象。
季节性（Seasonality）：数据呈现季节性，数据取值重复出现的现象。
趋势预测算法
第13章
---
## Page 250
平均值；如果数据项大于20，则可以把第1期的值作为初始值，计作So。
般比较难见到，因此我们重点介绍一次、二次和三次指数平滑。
重数，这也避免了在加权移动平均法中需要指定每一个参数权重的劣势。
不舍弃过去的数据，仅给予逐渐减弱的影响程度，即随着数据的远离，赋予逐渐收敛为0的权
13.2
预测的时期数；W+W2+…+Wn=1。
高的权重，对远离目标期的变量值赋予较低的权重。预测公式如下：
预测公式如下：
法会使很多趋势特征丢失，从而得不到好的预测结果。
取历史数据的平均数即可。但缺点也显而易见，若时序数据的波动比较剧烈，采用平均数的方
计算移动周期的时序数据平均值，用来预测未来的发展趋势。因此，其优点是计算简单，只需
224
在平滑之前，首先需要有初始值。通常，如果数据项小于 20，则初始值取第1、2、3 期的
指数平滑法是一种特殊的加权移动平均法。其优势在于兼容了全期平均和移动平均所长,
其中，St为t期的预测值；Wi为第 t-1 期实际值的权重；Wn为第t-n 期实际值的权重；n 为
加权移动平均给不同时期的变量值赋予不同的权重。其基本原则是对近期的变量值赋予较
移动平均法可以分为简单移动平均和加权移动平均。简单移动平均的各元素的权重相等。
（1）一次指数平滑一般应用于水平型数据。其计算公式为：
一般常用的指数平滑法为一次指数平滑、二次指数平滑和三次指数平滑。高次指数平滑一
在加权移动平均法中，对权重的选择是一个难题，一般通过尝试和经验来决定。
其中，St为t期的预测值；n 为移动平均的时期个数；αt-n为t-n 期实际值。
智能运维：从O搭建大规模分布式AIOps系统
指数平滑法
(13-3)
（13-2）
(13-1)
---
## Page 251
实际值，α为常数。
列数据。其计算公式如下：
滑。其计算公式为：
当数据波动较大时，选择较大的α值。
其中，s)为t 期的一次平滑值，s2)为t期的二次平滑值，s3)为t 期的三次平滑值，
（3）三次指数平滑则是在二次平滑的基础上再平滑，适用于同时含有趋势性和季节性的序
其中
预测未来T期的计算公式为：
其中，s为t期的一次平滑值，s2为t期的二次平滑值，s为t－1期的一次平滑值，
（2）二次指数平滑适用于斜坡型时序数据，
其中，对α的选择是一个难题，一般也是通过经验法。当数据波动不大时，选择较小的α值;
预测未来期的公式为：
Ar = 2s(1 - s(2)
xt+T=A+BT
1
其基本思想是在一次平滑之后，再进行一次平
第13章趋势预测算法
，s为t-
α为常数。
(13-7)
(13-6)
(13-5)
(13-4)
225
---
## Page 252
平稳，下图代表趋势平稳。
就是用来刻画时间序列的统计性质关于时间平移的不变性的。如图13-1所示，上图代表趋势不
们希望挖掘出的历史数据的一些性质在将来保持不变，这样对模型的预测才有意义。而平稳性
模型，最重要的假设是平稳性。从本质上讲，时间序列模型是通过历史规律预测未来的，即我
要假设：①自变量是独立且随机的；②误差值服从均值为0的正态分布。同样，对于时间序列
13.3.2
但是缺点也很明显，本质上只能挖掘线性关系，不适用于非线性关系的时序数据。
分阶数，q代表移动平均阶数。
来确定一个特定的 ARIMA 模型，计作 ARIMA(p,d,q)。其中，p代表自回归模型阶数，d代表差
Model)。ARIMA 模型并不是一个特定的模型，而是一类模型的总称。通常，我们用 p,d,q值
13.3.1
13.3
226
对于每一个统计学问题，我们都需要对其先做一些假设。比如最简单的线性回归，我们需
ARIMA 模型的优点是数学原理简单，只需要内生变量（历史上的情况），不需要外生变量。
ARIMA 模型的全称为自回归移动平均模型（Auto-Regressive Integrated Moving Average
1．平稳性
其中
预测未来T期的计算公式为：
智能运维：从0搭建大规模分布式AIOps系统
ARIMA模型
重要概念
简介
α
Xt+T=AT +BrT +CrT2
q2
(13-8)
---
## Page 253
稳性这个假设前提的。但是在现实中，大多数时间序列都是不平稳的，例如随着时间的推移，
运算理解为适用于离散变量的微分运算即可。
关系，那么一阶导数则为速度，二阶导数则为加速度。有了微分运算的概念之后，我们将差分
一阶导数y'=2x，二阶导数y"=2。举个实际生活中的例子，原始函数f(x)代表距离与时间的
中，当分布很复杂时，很难写出其联合分布函数，故而难以证明强平稳性。
弱平稳的假设。这是因为：①在现实中，很少有时间序列数据能够满足强平稳性；②在统计学
函数相同)，弱平稳是统计量在观测意义上的平稳（均值、方差)。通常，时间序列模型仅基于
随时间变化，并且协方差函数只与时间间隔相关。简单来理解，强平稳是事实上的平稳（分布
Ztm和 Zti-k,Zt2-k",Ztm-k的联合分布相同。弱平稳是指时间序列{Zt}的均值是一个常数μ，不
那么，在ARIMA 模型中为什么需要差分？在上文中我们已经知道，ARIMA 模型是基于平
二阶差分为：
在时间序列预测中,差分是时间序列变量的本期值与上期值相减的运算。例如一阶差分为：
差分是研究离散数学的一种方法,类似于连续变量微分的概念。例如,在微分计算中,y=x²，
2.差分
平稳性分为强平稳和弱平稳。强平稳是指时间序列[Zt}，对于所有的 n 和k,满足Zt,Zt2",
7.5
8.5
9.5
1950
1950
图13-1时间序列是否平稳示意图
1960
1960
1970
1970
xt=xt-xt-1
Year
1980
199020002010
1990
20002010
第13章趋势预测算法
(13-10)
（13-9）
12
---
## Page 254
上一时刻的Y值有关。也就是说，每一步的行走都是随机的。其计算公式如下：
达式。
第三部分为 MA(q)移动平均。
13.3.3
么就可以得到一个平稳的序列。
GDP 在一直增长。假设 GDP 随着时间t的增加而呈线性增长，如果对 GDP 进行一阶差分，那
228
ARIMA(0,1,0)又称作 Random Walk（随机行走)，如图 13-2所示。每一时刻的 Y值，只与
1. ARIMA(0,1,0)
接下来，我们举例说明 ARIMA(p,d,q)模型中 p,d,q 取不同的值分别代表的意义以及数学表
其中，yt表示经过 d阶差分后的变量。第一部分为常数μ，第二部分为 AR(p)自回归模型，
ARIMA模型通用的表达式如下：
〇MA(q)：MA是Moving Average 的缩写，表示移动平均模型，含义是当前时间点的值等
○I(d)：I是 Integrated 的缩写，含义是模型对时间序列进行了差分。因为 ARIMA 要求平
OAR(p)：AR 是Auto-Regressive的缩写，表示自回归模型，含义是当前时间点的值等于
ARIMA(p,d,q)由三个部分组成。
赖过去最近的α个历史预测误差值，则称阶数为q，记为 MA(q)模型。
智能运维：从O搭建大规模分布式AIOps系统
于过去若干个时间点的预测误差的回归。预测误差=模型预测值-真实值。如果序列依
出一定的周期 T，让t时刻的值减去 t-T时刻的值得到季节性差分序列。
d表示差分的阶数。另外，还有一种特殊的差分是季节性差分S，即一些时间序列反映
稳性，不平稳的序列需要通过一定的手段转化为平稳的序列，一般采用的手段是差分，
值，故称为自回归。如果依赖过去最近的p个历史值，则称阶数为p，记为 AR(p)模型。
过去若干个时间点的值的回归。因为不依赖其他的解释变量，只依赖自己过去的历史
参数解释
yt =μ+ P1yt-1 +.+ @pyt-p + θet-1 +.+ θget-q
t=μ+Yt-1
(13-12)
(13-11)
---
## Page 255
且存在线性关系。其计算公式如下：
关系。其计算公式如下：
存在线性关系。其计算公式如下：
公式如下：
ARIMA(0,1,1)表示一阶差分后（d=1)，t期的差分变量y:依赖 t-1 期的预估误差值et-1，并
5. ARIMA(0,1,1)
ARIMA(0.0,1)又称作 MA(1)，表示t期的Y值依赖t-1 期的预估误差值et-1，并且存在线性
4. ARIMA(0,0,1)
ARIMA(1,1,0)表示一阶差分后（d=1)，t 期的差分变量yt依赖 t-1 期的差分变量yt-1，并且
ARIMA(1,0.0)又称作 AR(1)，表示t期的Y依赖 t-1 期的Yt-1，并且存在线性关系。其计算
3.
2. ARIMA(1,0,0)
ARIMA(1,1,0)
图13-2随机行走示意图
t=μ+θet-1
Y=μ+θet-1
t=μ+1yt-1
t=μ+pYt-1
第13章趋势预测算法
(13-16)
(13-15)
(13-14)
(13-13)
229
---
## Page 256
在各个频率上的值相同。
噪声，是因为它和白光的特性类似，白光的光谱在各个频率上有相同的强度，白噪声的谱密度
得到平稳的序列。
则，接受原假设，即该时序数据存在单位根，是非平稳的序列，需要进一步进行数据处理，
5%、10%）的临界统计值，则说明拒绝原假设，即该时序数据不存在单位根，呈现平稳性；否
据进行ADF 单位根检验，从统计学上判定是否平稳。
平稳。若是明显不平稳的序列，则可进行取对数、差分等预处理。在肉眼识别后，可对时序数
需要对时序数据进行平稳性检验。通常，我们先画出时序散点图或折线图，通过肉眼判定是否
拟合出的ARIMA模型对时序数据进行预测。
适的 ARIMA 模型进行拟合。模型拟合后，对误差值进行白噪声检验，通过后分析结束，采用
具有弱平稳性。通过平稳性检验后，进行白噪声检验，当序列不是白噪声序列时，即可选择合
间序列（简称时序）数据进行平稳性检验，若不通过，则采取取对数、差分等方法使时序数据
13.3.4
230
根据定义，白噪声序列需要满足的数学条件为：
白噪声序列，是指对于一个不相关的随机变量{X}，均值为0，方差为常数。之所以称为白
ADF单位根检验的原假设是存在单位根，因此如果得到的统计量显著小于3个置信度（1%、
上文提到，ARIMA 模型是基于时序数据平稳性这个假设前提的，因此在进行模型拟合前
本节中，我们将为大家介绍通用的 ARIMA 模型建模步骤（如图13-3所示)。首先，对时
Q
2
1．数据平稳性检验
E(X)=0，均值为 0。
白噪声检验
智能运维：从O搭建大规模分布式AIOps系统
建模步骤
图13-3ARIMA模型建模步骤
N
白噪声检
拟合
---
## Page 257
系数如表13-1所示。
的条件下时间序列观测值与其过去的观测值之间的线性相关性。
ACF 描述时间序列观测值与其过去的观测值之间的线性相关性，PACF 描述在给定中间观测值
构成，计作 ARIMA(p,d,q)。对于不同的时序数据，我们需要选定不同的 p,d,q 值进行模型拟合。
进一步选定合适的ARIMA 模型进行拟合。
布。给定显著性水平α，若p≤α，则拒绝原假设，即原序列不是白噪声序列，存在相关性，可
验基于一系列滞后阶数,判断序列是否存在总体的相关性或者随机性。其原假设和备择假设为：
ARIMA 模型的基本思想。
个纯随机序列意味着时刻的值完全是随机的，并不依赖上一时刻的变量值，这显然不符合
ARMA(p.q)
MA(q)
AR(p)
平稳的随机时间序列模型
通常采用自相关函数（ACF）、偏自相关函数（PACF）来判别 ARIMA 模型的q和p 值。
我们已经知道，ARIMA 模型不是一个特定的模型，而是一系列模型的总称，它由三个参数
那么，如何进行白噪声检验呢？我们采用的方法是Ljung-Box Test，简称LB 检验。LB 检
3．ARIMA模型选型
其中，n 是样本数量，p是样本k阶滞后的相关系数，该统计量服从自由度为h 的卡方分