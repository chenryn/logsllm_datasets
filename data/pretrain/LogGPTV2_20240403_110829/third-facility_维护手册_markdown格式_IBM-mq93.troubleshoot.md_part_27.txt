This means there was something wrong with your environment file and Managed File Transfer
commands. This can be due to invalid paths specified.
• From your environment file, locate the value of BFG_PROD.
168 Troubleshooting and Support for IBM MQ
1.Go into OMVS and use the ls -ltr command.
For example, if BFG_PROD is /mqm/V9R2M0/mqft, type the command:
ls -ltr /mqm/V9R2M0/mqft/bin/fteBatch
2.Check this file exists, and that the batch job has read permission to the file.
3.Resolve any problems.,
• If the JCL still fails to process correctly:
1.Create a file in z/OS UNIX System Services, for example, myenv and use an editor to copy
information from the environment file into this myenv file.
2.Save this file.
3.From the command line, use the command chmod +x myenv, to allow the file to be run.
4.Issue the command . myenv. Note, that is (period blank filename).
Running this command reports any errors in the myenv file.
5.Correct any errors in both the myenv and environment files.
What to do if your MFT agent process disappears but no
diagnostic information is logged
On AIX and Linux platforms, if an agent process has disappeared but the agent log files do not contain any
explanation, this might be caused by the way the agent has been started.
You can check for agent diagnostic information in the following ways:
• Check whether the agent's log files state that the agent has been stopped.
• Check whether the agent lock file agent.lck still exists.
If you start the agent from a shell script for example, all child processes associated with that script are
removed when the script completes (including the agent process). To keep the agent running past the
duration of the script that called the agent, complete the following step:
1.Prefix the fteStartAgent command with the nohup command to disassociate the fteStartAgent
process (and any child processes) from the script.
In future when the script terminates, the agent now continues to run.
What to do if your MFT agent or logger configuration is not secure
If a Managed File Transfer process detects a condition that a configuration file contains sensitive
information, is a keystore or truststore file, and has system-wide read, write, or delete permissions, the
process will fail to start if detected at startup time. If the condition was not detected at startup time but
was detected at runtime, Managed File Transfer generates a warning message and ignores the contents
of the configuration file. This is relevant to the protocol bridge and the Connect:Direct bridge capabilities
which reload a configuration if it changes while the agent is running.
Complete the following checks to determine the cause of the problem:
1.Identify the configuration file that has been reported as not secure from the error message provided.
2.Ensure that the file access permissions match the requirements needed. For more information, see
MFT permissions to access sensitive configuration information.
3.Restart the agent or logger. Or, in the case of the protocol bridge or Connect:Direct credentials files,
wait for the next reload.
IBM MQ troubleshooting and support 169
Example
In this example of an error message, a database logger is failing to start:
BFGDB0066E: The logger encountered a problem accessing its credentials file and will stop.
Reported error: BFGNV0145E: The 'Everyone' group has access to the file 'C:\mqmftcredentials.xml'.
In this example of an error message, a protocol bridge agent is failing to start:
BFGIO0383E: The security permissions defined for credentials file 'C:\ProtocolBridgeCredentials.xml' do
not meet the
minimum requirements for a file of this type.
Reported problem: BFGNV0145E: The 'Everyone' group has access to the file
C:\ProtocolBridgeCredentials.xml'.
Related reference
MFT permissions to access sensitive configuration information
What to do if messages are building up on your SYSTEM.MANAGED.DURABLE queues
or filling your file system
If your IBM MQ Explorer plug-in uses a durable subscription on the coordination queue manager,
messages can build up on the SYSTEM.MANAGED.DURABLE queues. If you have a high-volume Managed
File Transfer network, use the IBM MQ Explorer plug-in infrequently, or both, this message data can fill
the local file system.
To remove the buildup of messages on the SYSTEM.MANAGED.DURABLE queues, you can perform one of
the following actions:
• Start the IBM MQ Explorer that uses the durable subscription. The Managed File Transfer plug-in for
IBM MQ Explorer consumes the messages from the queue.
• Delete the messages from the queues manually.
You can avoid the build up of messages on durable queues in one of the following ways:
• Specify that the IBM MQ Explorer plug-in uses a non-durable subscription to the coordination queue
manager. Perform the following steps in your IBM MQ Explorer:
1.Select Window > Preferences > IBM MQ Explorer > Managed File Transfer
2.From the Transfer Log subscription type list, choose NON_DURABLE.
• Clear durable subscriptions from the coordination queue manager that are created by the IBM MQ
Explorer MFT plugin.
The name of the durable subscription is prefixed to show that the subscription was created
by the IBM MQ Explorer MFT plug-in, the host name, and the name of the user, for example
MQExplorer_MFT_Plugin_HOST_TJWatson.
Related tasks
Retaining MFT log messages
Examining messages before publication
Because agents can connect to IBM WebSphere MQ 6.0 queue managers, agents do not use the direct
publication approach introduced in IBM WebSphere MQ 7.0. Instead, agents send ordinary messages
to the coordination queue manager that contain an MQRFH header. The MQRFH header requests
that the message's payload is published. These messages are sent to the SYSTEM.FTE queue on the
coordination queue manager, and the messages are typically published immediately from that queue. If
error conditions stop this publication, you can examine the messages on the queue before publication is
attempted to help with diagnosis. You can do this by completing these following steps:
1.Disable the publish/subscribe engine in the coordination queue manager.
170 Troubleshooting and Support for IBM MQ
You can either complete this step using the IBM MQ Explorer or using MQSC commands. Be aware that
this temporarily stops all publish/subscribe activity on the queue manager, including activity unrelated
to Managed File Transfer if your coordination queue manager is also used for other purposes.
IBM MQ Explorer:
a.In the Navigator view, right-click the coordination queue manager and select Properties.
b.From the Properties pane, select Publish/Subscribe.
c.Select Compatibility from the Publish/Subscribe mode list.
MQSC:
ALTER QMGR PSMODE(COMPAT)
2.Send another message.
Perform the Managed File Transfer action that has publication problems. For example, for agent
registration, a message is sent whenever the agent is started (you do not need to repeatedly delete
and create the agent to generate registration messages). Because the publish/subscribe engine is
disabled, no publication takes place.
3.Browse the SYSTEM.FTE queue on the coordination queue manager.
You should use the IBM MQ Explorer to browse your coordination queue manager's SYSTEM.FTE
queue.
IBM MQ Explorer:
a.In the Navigator view, expand the coordination queue manager and click Queues. In the
Content view, right-click the SYSTEM.FTE queue and select Browse Messages. The Message
browser window opens and shows the messages that would have been published.
b.The User identifier column shows the user ID contained in the message descriptor. A common
reason for publication failure is that this user ID does not have publish authorization on the
SYSTEM.FTE topic.
c.You can find out more information about each message (including the XML that will be
published) by right-clicking the message and selecting Properties.
There is no MQSC command to inspect the contents of messages. If you are do not have the IBM
MQ Explorer, you must use a different program that can browse queues and display all aspects of the
messages found. You can use the amqsbcg sample program, if installed, as described in the following
topic: Browsing queues. The UserIdentifier line shows the user ID. Alternatively, you can use
dmpmqmsg; the user ID for a message is found in lines like:
A RTM MQ24
A USR JOHNDOE
A ACC 1A0FD4D8F2F4C3C8C9D5F1F9C6F7C1C3F3F00019F7AC30000000000000000000
The second line in the example is the message descriptor user ID for that message.
4.Re-enable the coordination queue manager publish/subscribe engine.
You can either complete this step using the IBM MQ Explorer or using MQSC commands. After you
have re-enabled the publish/subscribe engine in the coordination queue manager, any messages on
the SYSTEM.FTE queue are processed immediately.
IBM MQ Explorer:
a.In the Navigator view, right-click the coordination queue manager and select Properties.
b.From the Properties pane, select Publish/Subscribe.
c.Select Enabled from the Publish/Subscribe mode list.
IBM MQ troubleshooting and support 171
MQSC:
ALTER QMGR PSMODE(ENABLED)
Possible errors when configuring the Redistributable Managed File Transfer
components
Error messages that you might see when you are configuring the Redistributable Managed File Transfer
components.
Native library for Windows could not be loaded
You must install the Microsoft Visual C++ Redistributable for Visual Studio 2015, 2017 and
2019 libraries, available from Microsoft, on your system to use the Redistributable Managed File Transfer
Agent. See The latest supported Visual C++ downloads.
For Continuous Delivery from IBM MQ 9.2.1, the Microsoft Visual C++ Redistributable for
Visual Studio 2015, 2017 and 2019 libraries are also required for the Redistributable Managed File
Transfer Logger.
If these libraries are not installed and you try to run MFT commands, an error is reported:
• BFGUB0070E: Internal error: Native library for platform Windows (architecture
amd64) could not be loaded because mqmft (Not found in java.library.path).
• BFGCL0043I: Specify the '-h' command line parameter to see more usage information.
Check that the Microsoft libraries are installed. If the libraries are not installed, install them and run the
command again.
Use of bindings mode is not supported
The Redistributable Managed File Transfer Agent can only connect to IBM MQ in client mode. If you try
run commands in bindings mode, an error is reported:
• BFGCL0408E: Unable to obtain IBM MQ installation information for queue manager 'queue manager
name'.
Reason Cannot run program "../bin/dspmq": error=2, No such file or directory
When you are issuing commands, you must provide the queue manager host, port, name, and channel
name.
From IBM MQ 9.3.0, you might also see this error for the Redistributable Managed File
Transfer Logger, which only supports FILE type loggers that are connecting in client mode to the
coordination queue manager.
Related tasks
Downloading and configuring Redistributable Managed File Transfer components
Related reference
BFGCL0001 - BFGCL9999
BFGUB0001 - BFGUB9999
Guidance for using UAC and virtual store with MFT
User Account Control (UAC) is present in Windows Server 2008 R2 and other similar operating systems.
This is a security infrastructure and one of its features is to divert user data stored in the central Program
Files directory to a user location, which is known as virtual store.
172 Troubleshooting and Support for IBM MQ
If only the Managed File Transfer tools are used to manage the data structures, Managed File Transfer
is not affected by UAC and virtual store. However, if the directory structure is changed or rebuilt using
standard operating system tools by a non-IBM MQ administrator, it is possible the new structure will be
diverted into a virtual store. This can cause one or more of the following situations:
• Users, including the IBM MQ administrator, can no longer see files in their expected location.
• An agent might fail to start, reporting message BFGCL0315 but give no supporting reason code.
• The log files cannot be found at the location reported by the agent.
• An agent when started with the -F parameter might fail to start, reporting message:
The current directory is invalid
.
To correct all of these situations:
• As an IBM MQ administrator, use the fteDeleteAgent and fteCreateAgent commands to rebuild
the agent structure.
• As an operating system administrator, remove the IBM MQ entries in the virtual store of the affected
users. For example, on Windows the location of the virtual store is as follows: %USERPROFILE%
\AppData\Local\VirtualStore\
Related reference
fteDeleteAgent
fteCreateAgent
Guidance for running an MFT agent or logger as a Windows service
You can run a Managed File Transfer agent, a stand-alone database logger, and a stand-alone file logger,
as Windows services. If you are having a problem with these Windows services, you can use the service
log files and the information in this topic to diagnose the issue.
For information about configuring your agent, stand-alone logger, or stand-alone file logger, to run as
a Windows service, see Starting an MFT agent as a Windows service and fteModifyLogger: run an MFT
logger as a Windows service.
Note: If the redistributable agent is going to run as a Windows service, then the BFG_DATA environment
variable needs to be set in the system environment for the service to work.
Location of log files
When you use the fteCreateAgent, fteCreateCDAgent, fteCreateBridgeAgent,
fteModifyAgent, fteCreateLogger, or fteModifyLogger command to run an agent or logger as
a Windows service, you can choose the level of logging by using the -sl parameter. The possible values
for this parameter are error, info, warn, and debug. The default value is info.
The log file for the Windows service has the file name servicedate.log, where date is
the date when the service was started. The file for an agent is written to the directory
MQ_DATA_PATH\mqft\logs\coordination_qmgr_name\agents\agent_name. This directory is the
same directory that Managed File Transfer Agent trace files are written to. The file for the logger is written
to the directory MQ_DATA_PATH\mqft\logs\coordination_qmgr_name\loggers\logger_name.
If you have problems starting an agent, or a stand-alone logger as a Windows service, try setting
the logging level to debug using the -sl parameter. Additional information is written to the
servicedate.log file.
Note: When the logging level is set to debug, the user account and password that you are using to run the
Windows service are shown in the log file in plain text.
IBM MQ troubleshooting and support 173
Number of log files
When you use the fteCreateAgent, fteCreateCDAgent, fteCreateBridgeAgent,
fteModifyAgent, fteCreateLogger,or fteModifyLogger command to run an agent or a stand-
alone logger as a Windows service, you can choose the number of log files by using the -sj
parameter. Specify the following text as part of your command to change the number of log files: -sj
-Dcom.ibm.wmqfte.daemon.windows.windowsServiceLogFiles=number, where number is the
number of log files that you want expressed as a positive integer. If you do not specify the number of log
files, the default is five.
"Log on as a service" authority
The Windows account that you use to run the service must have the Log on as a service right. If
you try to start the service, either with the fteStartAgent, fteStartLogger command, or with the
Windows Sc.exe command, and you are using a user account that does not have this right, a Services
window opens. If the service you wanted to start was to run an agent, this window contains the following
message:
Unable to start Windows service mqmftAgentAGENT@QMGR.
System error 1069: The service did not start due to a logon failure.
In this message, AGENT is your agent name and QMGR is your agent queue manager name. If you are
trying to run a stand-alone logger as a service, a similar message is produced, which refers to the logger
rather than an agent.
To prevent this error, give the Windows account that you use to run the service the Log on as a
service right. For example, on Windows 10 complete the following steps:
1.From the Start menu, click Administrative Tools > Local Security Policy.
2.In the Security Settings pane, expand Local Policies, and then click User Rights Assignments.
3.In the Policy and Security Setting pane, double-click Log on as a service.
4.Click Add User or Group, and then add the user that you want to run the service to
the list of users that have the Log on as a service right. You provided this user
name when you ran the fteCreateAgent, fteCreateCDAgent, fteCreateBridgeAgent,
fteModifyAgent,fteCreateLogger, or fteModifyLogger command.
Note: The error System error 1069: The service did not start due to a logon
failure. can also be caused by an incorrect password.
Hiding your Windows account password
When you configure your agent or stand-alone logger to run as a Windows service, you specify a user
name and password to use. In the following example, the agent AGENT1 is created, which has an agent
queue manager QMGR1 and is configured to run as a Windows service:
fteCreateAgent -agentName AGENT1 -agentQMgr QMGR1 -s -su fteuser -sp ftepassword
In this example, the Windows service runs with a user name of fteuser, which has an associated
password ftepassword. When you run the fteCreateAgent command, or one of the other commands
that accepts the -s parameter, you specify the password for the Windows account in plain text. If you
prefer not to display your password, carry out the following steps:
1.Run the command (fteCreateAgent, fteCreateCDAgent, fteCreateBridgeAgent,
fteModifyAgent, fteCreateLoggeror fteModifyLogger) without specifying the -sp parameter.
For example:
fteCreateAgent -agentName AGENT1 -agentQMgr QMGR1 -s -su fteuser
174 Troubleshooting and Support for IBM MQ
Note: The command produces a message that warns you that you must set the password by using the
Windows Services tool before the service starts successfully.
2.Open the Windows Services window.
3.In the list of services, right-click the agent or stand-alone logger service and select Properties. The
agent service display name is Managed File Transfer Agent AGENT @ QMGR, where AGENT
is the agent name and QMGR is your agent queue manager name. The logger service display name
is Managed File Transfer Logger for property set coordination_qmgr_name, where
coordination_qmgr_name is the coordination queue manager that you specified for the stand-alone
logger to use as its property set. For more information about the property set, see fteStartLogger and
fteModifyLogger.
4.In the Properties window, select the Log On tab.
5.Enter the password for the user account that runs the service in the Password and Confirm password
fields. The password characters are hidden as you enter them.
6.Click OK.
Known issues
Problem using the JAVA_HOME system environment variable (applies to Managed File Transfer in
IBM WebSphere MQ 7.5.0 Fix Pack 1 or earlier only).
The JAVA_HOME system environment variable must not be set, otherwise the agent or logger
Windows Service is unlikely to start. The agent or logger Windows Service must be run with the
IBM MQ Java runtime.
Related tasks
Starting an MFT agent as a Windows service
Related reference
fteCreateAgent
fteModifyAgent
fteCreateCDAgent
fteCreateBridgeAgent
fteCreateLogger
fteModifyLogger