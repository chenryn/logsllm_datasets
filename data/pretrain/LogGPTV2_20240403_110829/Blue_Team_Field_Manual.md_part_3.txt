Por8t0 d"i r=aicnt ion=parloltoowc ol=TCP
localport=80
23
C:\n>e tasdhv firfeiwraelwalad lrdlu lnea me="My
Applicdaitri=oaincn"t iolno=wa l
program="C:\MyeAnpapb\lMey=Aypeps. exe"
C:\n>e tasdhv firfeiwraelwalad lrdlu lnea me="My
Applicdaitri=oaincn"t iolno=wa l
program="C:\MyeAnpapb\lMey=Aypeps. exe"
remoteip=157.60.0.1,172.16.0.0/16,Local5ubnet
priol fe =dionm a
C:\n>e tasdhv firfeiwraelwalad lrdlu lnea me="My
Applicdaitri=oaincn"t ion=allow
program="C:\MyeAnpapb\lMey=Aypeps. exe"
remoteip=157.60.0.1,172.16.0.0/16,LocalSubnet
profile=domain
C:\n>e tasdhv firfeiwraelwalad lrdlu lnea me="My
Applicdaitri=oaincn"t iolno=wa l
program="C:\MyeAnpapb\lMey=Aypeps. exe"
remoteip=157.60.0.1,172.16.0.0/16,Local5ubnet
profile=private
C:\n>e tasdhv firfeiwraelwdlae lller tuel e
name=nraumplere o gram="C:\MyApp\MyApp.exe"
C:\n>e tasdhv firfeiwraelwdlae lller tuel e
name=nraumplere o tocollo=cuadlpp ort=500
C:\n>e tasdhv firfeiwraelwslae lrtlu le
grourpe=m"od tees ktnoepew"n ablep=riYolefes = domain
C:\n>e tasdhv firfeiwraelwslae lrtlu le
group="dreesmkotntoeepew "n ablper=oNfoi le=public
Settuopg glioncga tion:
C:\n>e tasdhv firseewctaru lrle ntplroofgiglien g
C:\E\>
mor%es ystemroot%\system32\LogFiles\Firewall\pfirewa
lll.o g
24
C:\n>e tasdhv firseewatal lllp rolfoiglgei ng
maxfil4e0s9i6z e
C:\n>e tasdhv firseewatal lllp rolfoiglgei ng
droppedcoennnaebcltei ons
C:\n>e tasdhv firseewatal lllp rolfoiglgei ng
allowedcoennnaebcltei ons
Dispfliarye wlaolgls :
PSC :\G>e t-Content
$env:systemroot\system32\LogFiles\Firewall\pfirewall
.l og
PASSWORDS
Chanpgaes sword:
C:\n>e uts edomain
C:\n>e uts eE PWA SSWORD>
Chanpgaes swroermdo tely:
Refh.t tps://technet.microsoft.com/en­
us/sysinternals/bb897543
C:\p>s passw\d\.E MUOSTENERA M-Ep>
Chanpgaes swroermdo tely:
PSC :\p>s passw\d\.
HOSFTI LE
FluDsNhoS f m alicdioomuasi n/IP:
C:\i>p con/ffilgu shdns
FluNseht Bicoasco hfeh ost/IP:
C:\n>b ts-tRa t
25
Adnde mwa licdioomuasti ohn o sftisl aen,rd o uttoe
localhost:
C:\e>c h1o2 7.0SI> N >
C:\Windows\System32\drivers\etc\hosts
Cheicfkh osftisl iesw orkibnysg e,n dpiinngtg o
127.0.0.1:
C:\p>i n
WHITELIST
UsaeP roAxuyt Coo nfigf(iPlAteCoc ) r eaBtaeUd R L
orI PL is(tI EF,i refCohxr,o me):
functFiionnd ProxyFhoorsU{tR )L (url,
IIS enbda DdN nSa mteot hper oxy
if( dnsDomai"n.ibsa(dhsoistte,. com"))
retu"rPnR OhXtYt p:11127.0.0.1:8080";
IIS enbda IdP tso t hper oxy
if( isinNet(myi"p2A2d2d.r2e2s2s.(2)2,2 .222",
"255.255.255.0"))
retu"rPnR OhXtYt p:11127.0.0.1:8080";
IIAl lo thterra fbfyipcap srso xy
retu"rDnI R"E;C T
}
APPLICRAETSITORNI CTIONS
Applo-cSkeerrv 2e0r0R 82o rW ind7oo wrsh igher:
UsiGnUgWI i zacrodn figure:
• ExecutRaubl(lee.esx e.c, o m)
• DLRLu l(e. sd l.lo,c x)
• ScriRputl( e.sp s.lb,a. tc,m .dv,b .sj,s )
• WindIonwsst Raulll(e. sm s.im,s .pm,s t)
26
Stetpose mplAopyp loc(kGeUirIs n eedfeoddr i gital
signaepdrp e strictions):
Ste1p: C reaatn eeG wP O.
Ste2p: R ight-ocnil tit coek d iatn,td h enna vigate
throCuogmhp uCtoenrf iguProaltiicoWinie,ns d,o ws
SettiSnegcsu,rS iettyt iAnpgpsl,i cCaotnitorno l
PolicaineAdsp plocker.
CliCcokn fiRguulErene f orcement.
Ste3p: U ndEexre cutRaubllecesh ,et chkCe o nfigured
boaxn tdh emna kseu rEen foRrucleie sss elected
frotmh ed rop-bdooxCw.ln i OcKk.
Ste4p:I nt hlee fpta ncel,i Ecxke cutRaubllees .
Ste5p: R ight-icntl hireci kg phatn aen sde lect
CreaNteeRw u le.
Ste6p:O nt hBee foYroeBu e gsicnr ecelni,Nc ekx t.
Ste7p:O nt hPee rmisssciroencesln i,Nc ekx t.
Ste8p:O nt hCeo nditsicornessee nl,et chte
Publicsohnedri atnicdol ni Ncekx t.
Ste9p: C litchkBe r owbsuet taonnbd r owtsoae n y
executfaiblolenye o usry stIetmd .o esmna'ttt er
which.
Ste1p0 D: ratgh sel idueptr o A nPyu bliasnhde r
thecnl iNcekx t.
Ste1p1 :C liNcekx otnt hEex ceptsicornese n.
Ste1p2 N: ampeo liEcxya,m upolnerl uyen x ecutables
thaatr sei gnaendcd"l iCcrke ate.
Ste1p3 I: ft hiissy oufri rtsitm cer eatainn g
ApplopcokleirWc iyn,d woiwlspl r omypottu o c reate
defaruulltce l,i Yceks .
Ste1p4 :E nsuArpep licIadteinotSnie tryvi isc e
Running.
C:\n>e stt aArptp IDSvc
27
C:\R>E aGd d
"HKLM\SYSTEM\CurrentCont/rvo lSet\services\AppIDSvc"
Sta/rttR EG_D/WdO2 / RfD
Ste1p5 C: hanrgeeqsu rierbeo ot.
C:s\h utdow/nr. exe
C:s\h utdo/wnr/. m\e \x
Adtdh Aep plocckmedrl einttsPo o werShell:
PSC :\i>m port-Ampopdluolcek er
Gettsh ef ilien formaftoaril olonf t hee xecutable
filaenssd criipntt sh ed irectory
C:\Windows\System32:
PSC :\G>e t-ApplockerF-iDlieriencftoorrmya tion
C:\Windows-\RSeycsu-trFesimel3 e2ET\xy eSp,ce r ipt
Creaat Aep ploPcokleirtc hya atl lorwu lefso ral l
oft heex ecutfaibllieens C :\Windows\System32:
PSC :\G>e t-ChiCl:d\iWtienmd ows\SyIs tem32\*,exe
Get-ApplockerFIiN leewi-nAfpoprlmoactkieornP olicy -
RuleTPyupbel isHhaes-rhU, s Eevre ryone -
RuleNamSeyPsrteefmi3x2
Settsh el ocaAlp plocpkoelrit coyt hep olicy
speciifniCe :d\ Policy.xml:
PSC :\S>e t-AppLoc-kXeMrLPPooCll:ii\ccPyyo licy.xml
Usetsh Aep plopcokleiric nyC :\Politcoyt .exsmtl
whetchaelrc .aenxdne o tepaadr.eae lxleo wteord u n
foru serwsha or mee mboefrt sh eE verygornoeu Ipf.
youdo n ots pecai fgyr outph,eE verygornoeiu sp
usebdy d efault:
PSC :\T>e st-AppLo-cXkMeLrPPoolliiccyy
C:\Poli-cPya.Ctx:hm\ lW indows\System32\calc.exe,
C:\Windows\Syst-eUms3Ee2vr\e nroytoenpea d.exe
28
Reviheowmw a ntyi measf ilweo ulhdav bee ebnl ocked
frormu nniifnr gu lewse reen forced:
PSC :\G>e t-ApplockerF-iElveeinn-tfloorgm ation
Logn"aMmiec rosoft-WindoawnsDd-L AL-p"p locker\EXE
EventATuydpie-t Setda tistics
Creaat neesAw p plocpkoelrif cryot mh ea udited
evenitnst hel ocaMli crosoft-Windows-Applocker/EXE
andD LeLv enlto ga,p pltioecd u rrent
Applocpkoelriw ciyl bleo verwritten:
PSC :\G>e t-ApplockerF-iElveeinn-tfloorgm ation
LogP"aMtihc rosoft-WindoawnsDd-L AL-p"p Locker/EXE
EventATuydpieIt N eedw -Apploc-kReurlPeoTlyipcey
Publish-eUrs,deHoram sahi n\-
IgnoreMissingFIi lSeeitn-fAoprpmlaotcikoenr Policy -
LDA"PL DAP://,.com/CN={31B2F340-016D-
11D2-945F-
00C04FB984F9},CN=Policies,CN=System,DC=,DC=c
om"
Expotrhtel ocAaplp locpkoelri ccoym,p arUsienrg' s
explicdietnliayec dc etsosr una,n do utptuetx t
file:
PSC :\G>e t-AppLockerIPT oelsitc­y -Local
AppLocke-rPPaoCtl:hi\ cWyi ndows\Sy-stem32\*,exe
Usedro mainN\AEi Rl Dteenri IeF do rmat-List
-PropPeart>thC y: \DeniedFiles.txt
Expotrhter e sulotfts h tee stto a filfeo r
analysis:
PSC :\G>e t-Chi
Filtr t-Path
IT est-Applo-cXkMeLrPPoolliiccyy
e rname>
Filt I Export-CSV
29
GridVliiesowtf a nlyo craull aepsp licable:
PSC :\G>e t-AppLoc-kLeorc-PaXolmIl lO i ucty­
GridView
IPSEC
Creaat IeP SLEoCc Saelc urPiotlyi acpyp,l tioea dn y
connecatnipyor no,t oacnoudls ,i an pgr eshkaerye:d
C:\n>e tisphs setca taidcfd i lter
filtiesrtl=MyIPsserccFaidlddtrse=trAa ndyd r=Any
protocol=ANY
C:\n>e tisphs setca taidcfd i lteraction
name=MyIPascetciAocnt=inoeng otiate
C:\n>e tisphs setca taidcpd o licy
name=MyIPassesciPgonl=iyceys
C:\n>e tisphs setca taidcrd u lnea me=MyIPsecRule
policy=MyIfPisletceProlliiscty= MyIPsecFilter
filteraction=cMoynInPtsyepacecA=tcaitlvilao tne =yes
psk=
Adrdu lteoa llwoewbb r owspionr8gt0 (HTaTnPd)
443(HToTvPeISrP) S EC:
C:\n>e tisphs setca taidcfd i lternaacmtei=oAnl low
action=permit
C:\n>e tisphs setca taidcfd i lter
filterlists=rWceabdFdidrls=ttAeanrdy d r=Any
protocdoslt=pToCrPt =80
C:\n>e tisphs setca taidcfd i lter
filterlists=rWceabdFdidrls=ttAeanrdy d r=Any
protocdoslt=pToCrPt =443
C:\n>e tisphs setca taidcrd u lnea me=WebAllow
policy=MyIfPisletceProlliiscty= WebFilter
filteractcioonnn=tAylpaleco=twai lvla te=yes
psk=
30
ShotwhsIe P SLEoCc Saelc urPiotlyiw ciytn ha me
"MyIPsecPolicy":
C:\n>e tisphs setca tsihcop wo licy
name=MyIPsecPolicy
StooprU nassaiI gPnS PEoCl icy:
C:\n>e tisphs setca tsiecpt o licy
name=MyIPsecPolicy
CreaatI eP SAEdCv aFnicree wRaullalen Pdo liacnyd
preshkaerfyer do amn tdo a ncyo nnections:
u
C:\n>e tasdhv firceownasaledlcrd u lnea mIeP=SEC"
endpoinetnld=paoniyn t2=any
action=requirqemisnercemqeutihroedosu=td efault
RequIiPrSepE rCe shkaeroyen da lolu tgoing
requests:
C:\n>e tasdhv firfeiwraelwalad lrdlu le
u
namIeP=SEC_dOiurt=a"oc utti on=eanlalbolwe =yes
profilleo=caanlyi rpe=maontye ippr=oatnoyc ol=any
interfacesteycpuer=iatnyy= authenticate
Creaatr eu lfeo wre bbr owsing:
C:\n>e tasdhv firfeiwraelwalad rldul l nea me="Allow
11
OutboPuonr8dt0 dir=looucta lport=80 protocol=TCP
action=allow
Creaatr eu lfeo DrN S:
C:\n>e tasdhv firfeiwraelwalad lrdlu lnea me="Allow
11
OutboPuonr5dt3 dir=looucta lpoprrto=t5o3c ol=UDP
action=allow
DeleItSeP REuCl e:
C:\n>e tasdhv firfeiwraelwdlae lller tuel e
name="IPSEC_RULE"
ACTIDVIER EC(TAODR-)GY R OPUOPL IOCBYJ E(CGTP O)
Geatn fdo rnceepw o licies:
31
C:\g>p upd/aftoer ce
C:\g>p upd/astyen c
AudSiutc caensFdsa ilfuorures eBro b:
C:\a>u dit/psoe/ltu ser/:cbaotbe gory:"Detailed
Track/iinngc"l/ usduec cess/:feanialbulree :enable
CreaatnOe r ganizUantititoom no vseu speocrt ed
infecutseedar nsmd a chines:
(\:>d saOdUd E
Movaena ctidvier ecutsoeroryb jeicnttN oE GWR OUP: