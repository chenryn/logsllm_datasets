自 动 化 漏 洞 扫 描 系 统 开 发 和 应 用
李斌
系 统 建 设 背 景
Ø 互联网应用系统大量使用开源软件和应用组件，且系统迭代快，可能
存在各种安全漏洞，依靠手工检测需要投入大量人力。
Ø 通过建设自动化漏洞扫描系统，实现安全资产统一管理、漏洞自动化
检测和安全漏洞生命周期管理，提升漏洞发现效率和能力，降低漏洞
被利用风险。
系 统 建 设 目 标
ü IP和端口
ü 中间件及版本
ü 组件库及版本
ü 数据库
ü 进程
ü 运行用户
ü 域名和URL
ü 端口开放
ü 系统和中间件漏洞
ü 弱口令、未授权访问
ü Web安全漏洞
ü 漏洞确认
ü 漏洞复核
ü 漏洞跟踪和管理
ü 统计和报表
安全资产
管理
漏洞自动化
扫描
漏洞生命
周期管理
系 统 功 能 架 构
n 安全资产管理模块
n 漏洞扫描模块
n 漏洞管理模块
系 统 开 发 和 设 计 思 路
1、技术和开发语言
ü Python3（后台）
ü Django（Web前端和交互）
ü MySQL（数据库）
2、设计思路
ü 重度资产管理，被动+主动收集
ü 尽量使用成熟开源组件和漏洞扫描模块进行二次开发
ü 架构需有良好的扩展性
ü 考虑POC和漏洞库可维护性
安 全 资 产 管 理 系 统
n 被动为主、主动为辅
n 全网覆盖
n 持续更新
安 全 资 产 管 理 - 被 动 采 集 模 块
利用Agent执行shell命令取服务器上资产信息：
ü TCP监听端口、进程ID和进程名 
ü 进程运行用户、进程运行命令 
ü 所有部署的应用程序（微服务列表）
ü 服务器上用户列表
ü 服务器上类库，主要是jar包及版本（依赖标准化路径）
安 全 资 产 管 理 - 主 动 采 集 模 块
WINDOWS主机信息
Masscan
Nmap
URL列表
WIG
Accesslog
特定组件和版本信息
运维自动化平台API
漏 洞 扫 描 模 块
n 调度器统一管理和调度扫描任
务、管理扫描模块
n 扫描模块插拔式增加
n 安全资产管理系统提供输入源
漏 洞 扫 描 调 度 引 擎
1、扫描模块注册
2、任务创建
l 任务名称
l 任务类型（调用哪个扫描模块）
l 扫描目标（可以是IP，或者是IP+端口，或者是URL等）
l 扫描参数（比如专门扫描SQL注入漏洞）
3、任务调度和管理
l 队列中、扫描中、扫描结束
l 终止、暂停、恢复
l 定时任务
l 完成扫描
4、结果解析入库
l 任务ID、标题、级别、类型
l 漏洞详情（建议为JSON格式，包括漏洞所有明细信息，如漏
洞的IP、漏洞端口、探测方法、漏洞检测返回信息、漏洞
CVE描述等，每种漏洞的详情可以不同）
边 界 端 口 开 放 扫 描
1、端口扫描模块（外网）
用于扫描互联网对外开放IP和端口。
2、端口扫描模块（广域网边界）
 用于扫描广域网边界开放IP和端口情况，如办公内网
和IDC之间开放端口情况、外联区（专线、VPN）边界
开放端口情况。
3、扫描结果接收接口
用于接收扫描结果，建议扫描结果为JSON格式，接收
结果后入库。
系 统 漏 洞 扫 描
OpenVAS
1、Docker安装和部署
2、Openvas_lib库二次开发
l 任务终止功能
l 扫描结果字段格式化解析
l 扫描端口优化提升扫描效率
中 间 件 漏 洞 扫 描
巡风系统-扫描模块
ü vulscan.py
ü Vuldb漏洞POC库
ü 支持全模块或单独某个模块扫描
ü 弱口令字典自定义
W E B 漏 洞 扫 描
Wapiti3.0
Wapiti是开源的Web应用漏洞扫描系统
-黑盒漏洞扫描系统，通过爬取网页，获
取网页结构、表单和参数输入点，通过
注入payload检测是否存在安全漏洞。
主要功能如下：
ü 文件包含
ü 注入
ü XSS
ü 命令执行
ü CRLF
ü XXE
ü SSRF
ü 敏感信息泄露
二次开发和整合：
l 支持手动输入cookie
l 可选择单独模块或全扫描
l 扫描参数自定义（爬虫深
度、代理等）
l 漏洞扫描结果解析
漏 洞 管 理 模 块
1、漏洞管理功能：
ü 用户管理、登录和权限管理
ü 安全资产管理
ü 漏洞扫描任务管理
ü 漏洞扫描结果管理
ü 统计、报表和导出功能
2、开发实现
ü Django Web框架
ü 任务输入和前后端交互
ü 前端模块（Bootstrap、Jquery、
Layui、Echarts）
漏 洞 管 理 系 统 应 用 实 践
1、持续运营，确保资产库新鲜、全面
2、漏洞库持续更新、POC手动编写和更新
3、定期开展漏洞扫描，控制扫描强度
4、漏洞发现要从多方面入手，自动化扫描是其中重要一环
欢迎交流
“安全+” 专注于信息安全行业，通过互联网平台、线下沙龙、培
训、峰会、人才招聘等多种形式，培养安全人才，提升行业的整体
素质，助推安全生态圈的健康发展。
官方网站：www.anquanjia.net.cn
微信公众号：anquanplus