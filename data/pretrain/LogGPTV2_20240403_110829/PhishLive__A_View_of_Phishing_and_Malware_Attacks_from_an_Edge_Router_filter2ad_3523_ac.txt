o
n
o
i
t
p
o
r
P
0.5
0.45
0.4
0.35
0.3
0.25
0.2
0.15
0.1
0.05
0
0.25
0.2
0.15
0.1
0.05
s
e
m
a
n
t
s
o
H
f
o
n
o
i
t
p
o
r
P
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15
Ranges
0
1
10
100
1000
Number of Attacks
10000
1e+006
(a) # of Days
(b) Range of Days
(c) # of HTTP accesses
Fig. 4. Temporal characteristics of malicious accesses. Subplot (a) shows distribution of host-
names in terms of number of days a hostname has been accessed. (b) shows the distribution of
range, and (c) shows distribution of number of accesses.
A similar behavior can be observed in Figure 4(b), where we plot the range of the
days between which we observed a given hostname. While this plot (in Figure 4(b) has
similar characteristics as the previous one (Figure 4(a)), the bar for 15 days, which in-
cludes all hostnames that were active for greater than or equal to 15 days, is signiﬁcantly
taller (almost 30% compared to only 5%). But, the number of hostnames that were ac-
tive for only 15 days is small (15 days.
Finally, we plot the distribution of the number of HTTP accesses to particular host-
names in Figure 4(c). From this ﬁgure, we can observe that most hostnames are accessed
relatively infrequently. Almost 70% of hostnames were seen only less than 10 times, and
90% were seen less than 100 times in our dataset. A small number of hostnames seem to
have been accessed a lot of times, greater than 33,000 times. We manually checked the
43 hostnames that were accessed more than a 1000 times. Those 43 hostnames belong
to 27 different websites. Among those websites we found 1 job hunting website, 1 local
246
L. Cao, T. Probst, and R. Kompella
forum, 2 ﬁle sharing websites, 3 porn websites, 3 news websites and the rest of them
are general websites with many different types of content.
3.4 Lexical Similarity of Domains
We now study the lexical similarity in attack domains we have observed in our data set.
We decompose a malicious URL into three components: hostname, ﬁle path and query
string, out of which our main interest is just the hostname. We lexically group together
hostnames that share some similarity in the form of a tree. All the 395,671 malicious
URLs we observed belong to 1686 distinct hostnames, 37 of which are IP addresses
that we exclude in the clustering process. We ﬁrst split each hostname to several tokens
which are strings between two dots. For example, we break pann.nate.com into pann,
nate and com tokens. Then we start to build the tree in the reverse order, starting from
the top level domain name (e.g., com, nate and then pann).
End nodes in this tree are the hostnames we detected in our experiment. Children
sharing the same parent node contain the same upper-level domain names. By do-
ing this, we are trying to put different hostnames into clusters indicating the degree
of similarity. From the tree, we observed that some preﬁxes exhibited large subtrees.
For example, in our data, we observed PassingGas.net shared by 42 hostnames that
differed mainly in the third-level token, such as nealyxadxloa.PassingGas.net, hccayx-
adxloa.PassingGas.net and so on. We observe that their third-level domain names look
like they have been generated randomly; this discovery is not surprising as we observe
such occurrences even in public domain phishing blacklists such as PhishTank.
What was interesting, however, is that each unique hostname was accessed for no
more than 2 days by hosts in our network; such information cannot be obtained by ob-
serving blacklists such as PhishTank alone. The old hostnames became invalid, leading
to a page indicating that this website is using Sitelutions Redirection Engine and the
URL is either entered incorrectly or has been removed by itself. Another feature of
these hostnames is that they all share the same IP address (located in Herndon, VA)
no matter how they change the third level domain name. Obviously, this indicates that
the attackers are manipulating the DNS Resource Records dynamically, which is not
surprising as attackers often try to evade detection this way [3].
3.5 Redirect Chain Analysis
Researchers in [19] reported that attackers may use long redirect chains to hide ma-
licious content; we therefore study whether redirections are actively used in attacks
today. There are many ways to implement HTTP redirections, such as server-side 3XX
response, client-side scripting (javascript), META refresh tag and so on. Since, server-
side redirection is prominent in both legitimate and spam redirection [22], and since
content-based analysis has signiﬁcant impact on the performance of a real-time system,
we choose to only focus on server-side HTTP redirects.
In our dataset, we observed a total of 7,497 redirect chains that contained at least one
malicious URL. However, in some of the redirect chains, the original HTTP requests
and redirect response belonged to the same hostname. If a redirect chain is created by
attackers intentionally, then: (i) the URL in the redirect response typically belongs to
PhishLive: A View of Phishing and Malware Attacks from an Edge Router
247
Table 2. Statistics of Effective Malicious Redirect Chain
Type
Total Redirect Chains
Malicious Redirect Chains
Effective Malicious Chains
Average Number of Redirect
Number of Chains Longer Than 1
Max Number of Redirect
Start with Normal Request
301 Redirect
302 Redirect
303 Redirect
307 Redirect
Number
50,204,174
7,497
1449
2.221
246
5
988
231
1523
6
0
a different hostname; (ii) the last redirect is malicious; (iii) the redirect chain usually
contains more than one redirect. Therefore, we deﬁne a redirect chain to be a effective
malicious redirect chain if the URLs in the chain belong to at least two different host-
names, and the last redirect is malicious. However, we do not put any restriction on the
length of the redirect chain, since it usually does not matter.
For example, the chain consisting of redirecting http://www.dwnews.com/images/
news/blog.gif→ http://www.dwnews.com/ is not effective malicious redirect chain since
the two URLs belong to the same hostname. However, the chain that involves the fol-
lowing redirection, http://grannymovs.in/→ http://lotaz.in/MyTRAFF/apiLINK da.php
→ http://servantspywarekeep.info/755063395c4 a385d/ is an effective malicious redi-
rect chain, since the last URL is malicious. We also noticed a special case that the
redirect chains caused by the expiration of the hostnames mentioned before. Redirects
related to the expiration of those hostnames occurred 2,065 times, which we removed
from our set. Among the remaining, we identiﬁed 1,449 effective malicious redirect
chains, the statistics of whom are summarized in Table 2.
Several conclusions can be derived from our analysis on malicious redirect chains:
(1) The number of malicious redirect chains (7497) among all redirects (≈ 50 million)
is quite small (<0.0149%). (2) Only a small portion of malicious redirect chains (246
out of 7497) are effective malicious redirect chains and contain more than 1 redirect
(about 3.29%) in our experiment. (3) Most of the effective malicious chains (about 988
out of 1449) start from a normal HTTP request and end up with a malicious URL as
redirect response.
4 Conclusions
To date, no studies exist on how prevalent phishing/malware attacks are or on the tem-
poral characteristics of malware accesses in edge networks. We designed the Phish-
Live system for long-term monitoring of HTTP trafﬁc of a large campus network that
enabled us to study various temporal characteristics of phishing/malware attacks.
248
L. Cao, T. Probst, and R. Kompella
Using a month-long deployment of the PhishLive system at the university gateway
router, we observed many interesting characteristics of phishing attacks. For example,
we found that malicious accesses are more common during 11:00-5:00pm than dur-
ing day times. Similarly, we found that most domains appeared only for one day and
redirection was not common among many of the malware URLs we detected.
Acknowledgements. We thank the anonymous reviewers and Changhyun Lee, our
shepherd, for their comments that improved the paper signiﬁcantly. We thank the Purdue
University IT staff including Bill Harshbarger and Greg Hedrick for their support in
collecting the traces. This work was supported in part by NSF grant 1017915 and a
grant from Google.
References
1. Egelman, S., Cranor, L.F., Hong, J.: You’ve been warned: An empirical study of the effec-
tiveness of web browser phishing warnings. In: CHI, 1065–1074 (April 2008)
2. Zhang, Y., Egelman, S., Cranor, L., Hong, J.: Phinding phish: Evaluating Anti-Phishing tools.
In: NDSS (February 2007)
3. Prakash, P., Kumar, M., Kompella, R., Gupta, M.: Phishnet: Predictive blacklisting to detect
phishing attacks. In: INFOCOM, pp. 1–5 (March 2010)
4. Ma, J., Saul, L.K., Savage, S., Voelker, G.M.: Beyond blacklists: Learning to detect malicious
web sites from suspicious URLs. In: KDD, pp. 1245–1254 (June 2009)
5. Ramachandran, A., Feamster, N., Vempala, S.: Filtering spam with behavioral blacklisting.
In: CCS (October 2007)
6. Garera, S., Provos, N., Chew, M., Rubin, A.D.: A framework for detection and measurement
of phishing attacks. In: WORM, 1–8 (2007)
7. Zhang, Y., Hong, J.I., Cranor, L.F.: Cantina: A content-based approach to detecting phishing
web sites. In: WWW, pp. 639–648 (May 2007)
8. Bayer, U., Habibi, I., Balzarotti, D., Kirda, E., Kruegel, C.: A view on current malware
behaviors. In: LEET, pp. 1–11 (April 2009)
9. Rossow, C., Dietrich, C.J., Bos, H., Cavallaro, L., et al.: Sandnet: network trafﬁc analysis of
malicious software. In: BADGERS (April 2011)
10. Gu, G., Zhang, J., Wenke, L.: BotSniffer: Detecting botnet command and control channels in
network trafﬁc. In: NDSS (February 2008)
11. Perdisci, R., Lee, W., Feamster, N.: Behavioral clustering of http-based malware and signa-
ture generation using malicious network traces. In: NSDI (April 2010)
12. Song, C., Zhuge, J., Han, X., Ye, Z.: Preventing drive-by download via inter-module com-
munication monitoring. In: ASIACCS, pp. 124–134 (April 2010)
13. Whittaker, C., Ryner, B., Nazif, M.: Large-scale automatic classiﬁcation of phishing pages.
In: NDSS (February 2010)
14. Provos, N., Mavrommatis, P., Rajab, M.A., Monrose, F.: All your iframes point to us. In:
IEEE S&P Conference (Oakland), pp. 1–15 (May 2008)
15. Maier, G., Feldmann, A., Paxson, V., Sommer, R., Vallentin, M.: An Assessment of Overt
Malicious Activity Manifest in Residential Networks. In: Holz, T., Bos, H. (eds.) DIMVA
2011. LNCS, vol. 6739, pp. 144–163. Springer, Heidelberg (2011)
16. Google safe browsing API,
https://developers.google.com/safe-browsing/
PhishLive: A View of Phishing and Malware Attacks from an Edge Router
249
17. Webb, S., Caverlee, J., Pu, C.: Introducing the webb spam corpus: Using email spam to
identify web spam automatically. In: CEAS (July 2006)
18. Webb, S., Caverlee, J., Pu, C.: Characterizing web spam using content and http session anal-
ysis. In: CEAS (July 2007)
19. Lee, S., Kim, J.: Warningbird: Detecting suspicious URLs in twitter stream. In: NDSS, pp.
1–13 (February 2012)
20. Konte, M., Feamster, N., Jung, J.: Dynamics of Online Scam Hosting Infrastructure. In:
Moon, S.B., Teixeira, R., Uhlig, S. (eds.) PAM 2009. LNCS, vol. 5448, pp. 219–228.
Springer, Heidelberg (2009)
21. Holz, T., Gorecki, C., Rieck, K., Freiling, F.: Measuring and detecting fast-ﬂux service net-
works. In: NDSS (February 2008)
22. Bhargrava, K., Brewer, D., Li, K.: A study of URL redirection indicating spam. In: CEAS
(July 2009)