        -1
        -1
        ERROR_SUCCESS
        2
        0
        *
        C:Program FilesInternet Exploreriexplore.exe
        Certificate Trust check failed:  Application  : C:Program FilesInternet Exploreriexplore.exe  User Name  : IE9WIN7IEUser  Session ID  : 1  PID   : 0x79C (1948)  TID   : 0xDA8 (3496)
值得一提的是，如果如果验证失败， EMET_CE.dll 将无法阻止连接到发送这些链接的服务器，而是创建日志事件和由代理应用程序显示通知给用户。
第二条消息用于在EMET命名空间中生成一般的日志事件。此信息的发件人能够选择信息的严重级别。
      Test
最后一个消息负责生成漏洞检测事件。其中包含触发进程名的相关信息，消息会出现在事件日志中。
        FOOBAR-APP
        FOOBAR-MSG
          test
        FOOBAR-Url
而大多数数据只是简单地包含在日志信息中，应用程序元素和文件/文件元素还会有一些额外的影响。服务会读取文件数组中包含的路径来计算MD5校验。代理之后会使用应用程序内容来创建windows错误报告。
这意味着，你可以作为非特权用户来生成受保护文件的MD5总数，但是还是没有办法访问内容。
**  
**
**代理**
* * *
正如前文所说，也有一个叫做EMET_Agent.exe
的应用程序在当前桌面上运行。该代理的作用是生成错误报告并向用户显示通知。如果前文提到的服务收到了一条消息来利用此漏洞事件日志，它就会连接到一个通知。
证书检查中出现问题时也会用到通知命令。
**EMET 执行 Dll**
* * *
这种保护机制主要由两个库中执行︰
EMET.dll
EMET64.dll
EMET_CE.dll
EMET_CE64.dll
EMET.dll 包含针对内存损坏和筛选可能有害库调用的保护措施。这也是通过SHIM框架注入进程的库。
EMET_CE.dll
负责证书检查，主要用于在IE浏览器中检查证书链。因为它使用的是微软的证书存储库，所以无法在拥有自己证书库的应用程序中运行，比如Mozilla
Firefox。
**以前的EMET绕过思路**
* * *
EMET是2009年末发布的，当时还只有几个缓解技术，为应用程序提供了针对覆盖结构化异常处理（SEH）的保护措施，通过使用数据执行保护（DEP）对堆栈执行代码防护。目前最新版本的EMET是5.5.1，在以前版本的基础上已经改进添加了很多新功能。
尽管开发EMET的主要目的是为应用程序减少和防止可能的攻击，但是实际上它反而证明了那些老练的攻击者可能绕过EMET使用的各种保护技术。
在本节中我们会简要地介绍一些最近用来规避EMET的技术。正如[BYPASS-EMET-ROP]一文的作者所述，EMET3.5可以被成功绕过，因为KernelBase.dll
和其中的函数并没有受到保护，所以攻击者可以找到dll基址，从而使用VirtualProtect 函数击败DEP。
正如Offensive安全的工作人员在[DISARM-EMET]、[DISARM-EMET5.0] 和[DISARM-EMET5.1]中所解释的那样，
只要针对一个控制ROP的全局变量，就可以绕过EMET 4.1、EMET
5.0和EMET5.1。这种旁路机制使用的技术受三个影响版本的不同而略有不同。在4.1版本中，只要将全局变量固定在一个指向EMET.dll 的
“.data”部分的开关，再用0覆盖这个全局变量就可以了。在5.0和5.1中，这个全局变量不是直接指向那个开关，而是指向一个编码指针来定位一个叫做CONFIG_STRUCT的结构。
在今年年初的美国黑帽大会上， FireEye
研究人员公布了他们在EMET5.2.0.1中发现的漏洞，这会允许攻击者完全禁用EMET.dll部署的拦截。他们在
[DISABLE_EMET16]中的研究论文中解释道，此漏洞的主要原因是因为微软的EMET团队没有使用 DLLMain Windows API卸载
EMET.dll 。
大约一个月之前，Blue Frost Security GmbH 的研究主任在HITB新加坡大会上介绍了一种针对EMET5.5
ASR功能的旁路手段，作为他演讲的一部分(演讲题为”看妈妈，我不使用外壳代码“)。在这种旁路技术中，攻击者使用了类似于Offensive
安全工作人员使用的技术，但不是为了找到可以禁用ROP保护功能的开关，而是找到用于检查ASR功能是否可用的开关。值得一提的是，研究人员说道微软目前还没有办法来解决这一旁路技术。
**参考链接**
[[SHIMS]](https://technet.microsoft.com/en-us/library/dd837644%28v=ws.10%29.aspx) Understanding Shims
[[EMET5.2]](http://expdev-kiuhnm.rhcloud.com/2015/05/29/emet-5-2-2/) EMET 5.2
– Exploit Development Community
[[DISABLE_EMET16]](https://www.blackhat.com/docs/us-16/materials/us-16-Alsaheel-Using-EMET-To-Disable-EMET.pdf) Using-EMET-To-Disable-EMET
[[PERSIST]](https://www.blackhat.com/docs/asia-14/materials/Erickson/WP-Asia-14-Erickson-Persist-It-Using-And-Abusing-Microsofts-Fix-It-Patches.pdf)
Persist It
[[EMET-CERT]](https://blogs.technet.microsoft.com/srd/2013/05/08/emet-4-0s-certificate-trust-feature/) EMET 4.0’s Certificate Trust Feature
[[INSIDE-EMET4.0]](https://www.youtube.com/watch?v=RGn-knmXf_Y) REcon 2013 –
Inside EMET 4 0 (Elias Bachaalany)
[[PIRATE-AV]](https://breakingmalware.com/vulnerabilities/captain-hook-pirating-avs-bypass-exploit-mitigations/) Captain Hook: Pirating AVs to Bypass
Exploit Mitigations
[[EMET-SINGLE]](http://forum.thewindowsclub.com/windows-security/37487-bypassing-emet-single-instruction.html) Bypassing EMET With a
Single Instruction
[[DEFEAT-AV]](https://breakdev.org/defeating-antivirus-real-time-protection-from-the-inside/) Defeating Antivirus Real-time Protection From The Inside
[[DEFEAT-EMET5.x]](http://casual-scrutiny.blogspot.de/2015/03/defeating-emet-52.html) Defeating EMET 5.2 & 5.5
[[LOOK-MOM]](http://gsec.hitb.org/materials/sg2016/D2%20-%20Moritz%20Jodeit%20-Look%20Mom%20I%20Don%27t%20Use%20Shellcode.pdf)
Moritz Jodeit -Look Mom I Don’t Use Shellcode
[[LOOK-MOM2]](https://labs.bluefrostsecurity.de/files/Look_Mom_I_Dont_Use_Shellcode-WP.pdf) Look Mom, I don’t use Shellcode – Browser Exploitation Case Study for
Internet Explorer 11
[[SECURE-HOST]](https://github.com/iadgov/Secure-Host-Baseline/blob/master/EMET/README.md) Secure-Host-Baseline
[[SCRAMMED]](http://scrammed.blogspot.de/2014/03/reversing-emets-eaf-and-couple-of.html) Scrammed!: Reversing EMET’s EAF (and a couple of curious
findings…)
[[DISARM-EMET] ](https://www.offensive-security.com/vulndev/disarming-enhanced-mitigation-experience-toolkit-emet/)
[[DISARM-EMET5.0] ](https://www.offensive-security.com/vulndev/disarming-emet-v5-0/)
[[DISARM-EMET5.1] ](https://www.offensive-security.com/vulndev/disarming-and-bypassing-emet-5-1/)
[[BYPASS-EMET-ROP] ](https://repret.wordpress.com/2012/08/08/bypassing-emet-3-5s-rop-mitigations/)
[[HOW-EMET-WORKS] ](http://0xdabbad00.com/2010/09/12/how-emet-works/)
[[EMET-UNCOVERED] ](http://0xdabbad00.com/wp-content/uploads/2013/11/emet_4_1_uncovered.pdf)