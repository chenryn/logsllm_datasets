破坏。本节仅适用于Unix系统。这里假设，当你在Windows上运行服务器时，拥有对机器的
13.1
名和组名（如使用了自己的登录账户来运行MySQL服务器），则需要更改各个示例里的名称。
使
472
可以登录到MySQL服务器主机，否则你必须考虑那台机器上的其他人可能获得服务器数据
数据目录的内容，那么再好的数据库网络访问安全设置都没有意义。除非你很清楚只有你自
MySQL服务器的权限系统非常灵活，其实现依托的是mysq1数据库里的权限表。你可以设
有些文件是要允许客户端程序访问的，如Unix套接字文件。通常情况下，都只是允许访问，
明文形式记录在某些日志文件里。对这些日志文件具有读取权限的攻击者，只要通过简单的
设置过程会涉及诸如CREATEUSER、GRANT或SETPASSWORD之类的语句，而这些语句都
用了密码加密机制，但是这个加密机制要在设置了密码并且建立了连接之后才起作用。密
很显然，你需要维护好服务器所维护的那些数据库的保密内容。数据库的所有者需要经常
自己建
服务器来完成。由你负责创建的文件包括选项文件或安全套接层相关的文件。服务器在运行
要MySQL管理账户以外的任何人对其进行访问。相比之下，客户端程序通常允许公开访问，
MySQL在安装过程中会创建几个目录，其中有些需要不同的保护。例如，服务器程序就不
必须要保证日志
很显然，你肯定不想服务器主机上的其他用户对数据目录里的文件拥有直接写入的访问权
在初次安装完成之后，还需要创建其他一些受保护的文件。对于具体的创建方式，既可以
本节将介绍如何锁住MySQL的安装位置，使其免遭服务器主机上未经授权的用户实施的
（1）在服务器主机上安装一个自己的“流氓”MySQL服务器，使用与官方服务器不同的端
下面这个简短的示例说明了安全的重要性。它强调这样一个事实：你其实并不想让其他用
建立的目录和文件包括数据库目录、数据库目录下的文件（与数据库里的表相对应的）
如何窃取数据
保护对MySQL文件系统的访问
第13章安全性与访问控制
可题，因为任何具有日志文件访问权限的人都可以监视数据库内容的变化。与日志
可恰当地做好数据库内容的保密工作。即使他们不做这样的考虑，也应该选择让数
志文件的安全，因为它们包含了客户端发送给服务器的语句文本。这是一
会
---
## Page 493
可能会获得类似如下的结果：
器都会将其创建的数据库目录的权限设置成，只允许运行服务器的那个账户可以访问它们。
格的数据库目录一
宽松，它们在权限设置方面的要求没那么严格。（从这里显示的内容可以看出，那些限制较为严
续逐步地升级到较新的版本。与新版MySQL服务器相比，旧版服务器所创建的用户权限比较
限。本示例展示的这个情况是日积月累的结果，即从一个（非常）旧的MySQL 安装开始，持
如 drwxrwxr-x，表示所有其他用户乃至mysql 组外的用户，都具有读取和执行这些目录的权
者具有读、写和执行权限，其他人无权访问。但是其他一些目录的访问权限模式则过于宽松，
目录/usr/local/mysql。
列表，其中列出了一部分数据库目录：
找出“组”或“其他”用户权限已被打开的那些文件或目录即可。下面是一个不安全数据目录的
的名称和路径名。
与本书所描述的布局可能不一样，不过你应该能够做出相应的调整。根据需要更改你自己系统
装的基本目录都是/usr/local/mysql,数据目录都是其下一级目录/usr/local/mysql/data。
位于同一个基本目录下，而不是分散在整个文件系统的不同目录下。在各个示例里，MySQL
就是不能选root，具体原因请参考12.2.1.1节。）这些指导还会假设MySQL安装的所有内容者
节的指导所使用的用户名和组名都是mysql，它们将被赋予安装所有权。（选哪一个用户都行，
13.1.2保护MySQL安装
请利用下面讨论里的各项指导保护好你自己。
取来的表。
都可以从任何主机连接到该服务器，访问你的test 数据库。这相当于是向全世界公开那些窃
副本表；使用SELECT*语句，则可以显示其中任何一个表的整个内容。
的那些表的副本，你可以随意访问它们。使用 SHOW TABLES FROMteSt 语句，可以显示这些
到你自己那个服务器数据目录下的test目录里。这个动作只需要目标数据目录的读取权限。
户身份访问你的服务器，建立一个test数据库，用于存储窃取到的那些表。
你也可以使用1s-1a 命令来查看 MySQL安装的基本目录/usr/local/mysql。例如，
通过执行1s
在完成此步操作之后，本书将对如何处理某些非标准的安装布局进行讲解。你的系统布月
请仔细想想这一场景，然后换位思考一下。你想要有人这样对付你吗？肯定不想！因此，
本节将针对组成MySQL安装的那些目录和文件，讲述如何设置其所有权和访问模式。本
（5）更为可恶的是，你可以将许可权限开放给你服务器上的匿名用户账户，这样，任何人
其中，“.”代表的是正被列出的那个目录，即/usr/local/mysql/data。“..”代表的是父
%ls-la /usr/local/mysql/data
（4）启动你的那个流氓服务器。一眨眼功夫，
（3）访问你想要攻击的那个服务器的数据目录，将你想要窃取的那些表所对应的文件复制
、套接字文件和数据目录。
drwxrwxr-x
drwx------
drwx-
drwxr-xr-x
drw
-la 命令，可以确定数据目录中是否包含不安全的文件或目录。只需在其中
。如果你运行有多个服务器，则需要对每个服务器都执行此步骤。
2
mysql
mysql
mysql
mysql
root
mysql
sql
。有些数据库目录的用户权限比较合理，如drwx------，表示其所不
mysql
wheel
mysql
wheel
wheel
，初始化数据目录。这个动作可以让你以MySQL的root用
1024
555
1024
9
22
2
May
Jun
May
这个服务器的test数据库便包含了窃取来
13.1保护对MySQL文件系统的访问
L
8
8
10:45
13:31
12:20
test
sampdb
mysql
menagerie
473
你
安
有
局
都
---
## Page 494
这个样子：
目录里的内容。
拥有其全部权限，而其他人只拥有其读取和执行权限。有可能它们已被这样设置过了；如果没
有
可以用 mysql 身份来执行它们。
命令必须以root身份执行：
MySQL程序的所有权和权限模式应该会被设置成与这些目录里的其他程序一样。
生
系统目录里，那么其中的有些步骤就不能使用。（如果使用RPM包来安装MySQL，则通常会发
限制，如同之前指明的那样。
容除外，有时其他用户也需要访问它们。例如，需要对data目录的权限和所有权进行更严格的
474
_在完成前面的几个步骤之后，你的MySQL 安装基本目录的所有权和用户权限将变成下面
（3）对于那些客户端应该能访问的基本目录及其子目录，需要更改它们的模式，以便mysql
上述情况。）例如，服务器位于/usr/sbin，而各个客户端位于/usr/bin。在这种情况下，
请注意
这样，除了用于运行MySQL 服务器的那个登录账户之外，其他账户都不能直接访问数据
%chmod -R go-rwx/usr/local/mysql/data
(4）更改数据目录以及其下面所有文件和子目录的访问模式，只允许mysql用户访问它们：
同样地，包含客户端程序的那个bin目录也可以用下列命令中的任何一条来进行设置：
%chmod755/usr/1ocal/mysql
则需要更改它们。例如，可以用下列命令中的任何一条来设置基本目录：
如果你把总的所有者设置为 root，则需要以 root 身份执行下面的大部分步骤。否则，你
另
（2）使用下面的命令，把整个MySQL安装的所有者和组名设置为MySQL管理账户，这些
（1）如果MySQL服务器正在运行，则需要停止它：
通过下面几个步骤可以把所有内容锁定，只允许mysql账户进行访问，不过，部分安装内
开
drwxr-xr-x
drwxr-xr-x
drwxr-xr-x
drwxr-xr-x
drwxr-xr-x
drwxr-xr-x
drwxrwxr-x
drwxr-xr-x
drwxr-xr-x
drwxrwxr-x
%1s-la/usr/local/mysql
chmod755/usr/1ocal/mysql/bin
另一种常见的方法是，让所有除数据目录以外的内容都隶属于root，相关命令如下所示：
chgrp -R mysql/usr/local/mysql/data
chown -R root /usr/local/mysql
chgrp -R mysql
mysqladmin-p -uroot shutdown
意，如果将MySQL服务器和客户端程序连同其他的非MySQL程序一起安装在通用的
第13章安全性与访问控制
mysql
13 mysql
2
L/usr/local/mysql
/usr/local/mysql
mysql
mysql
mysql
mysql
mysql
my
mysql
mysql
mysql
/usr/local/mysql/data
sgl
sgl
mysql
一
mysql
mysql
mysq
mysql
mysql
mysql
mysql
wheel
sa]
sql
lee
1024May
1024
10241
1024
1024May
512
512
512
512
May
16
710:45
7
10:45 support-files
10:45
10:45
10:45
12:20
20:58
12:54
10:45
10:45
share
scripts
mysql-test
man
1ib
include
etc
data
---
## Page 495
们所指向的那些位置的所有权。
的问题。如果你所用版本的chown和chgrp 不支持符号链接，
文件（如日志文件）进行重定位，这一原则也同样适用。
录的访问模式设置成与数据目录的一样。如果想对那些在通常情况下存放在数据目录里的其他
如果数据
果不是这
更多
其他位置
把数据目录用作Unix套接字文件的存放位置，则必须让该目录的访问权限更开放一点。否则，
合
么做有好处，
它代表的是父目录/usr/local/mysql。该目录隶属于root 用户，只允许该用户进行修改，
客
令来适兰
如果安装根目录下的某些目录实际是指向其他某个地方的符号链接，则会产生另一个复杂
需
#find /usr/local/mysql -follow -print | xargs chown
默认情况下，这些文件都在数据目录里。如果把它们放在innodb 目录里，则必须将该目
信息话
需要对其进行访问的文件，如那些包含全局客户端参数的选项文件。（与实现这些方法有关的
有些文件可能需要作为“只有mysql能访问数据目录”这一策略的例外情况。例如，想要
端