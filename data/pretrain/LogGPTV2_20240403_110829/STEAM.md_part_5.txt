suchasOpenTelemetryhavebeenwidelyadoptedinpractice.
Besidesthebenchmarktraces,weevaluateSTEAMonproduction
Distributedtracingenablesthefeasibilityformanyscenarios[1,
traces,whichisofmuchhighercomplexity.Theresultscouldreflect
5,12,20,22,28,35,42,43].Wuetal.proposed[43]thetemporal
theeffectivenessofourmethodinrealworldscenarios.Thesystem
provenanceindiagnosingtiming-relatedproblemsbasedontraces.
andtracedetailsareintroducedinSec.5.1.Likebefore,thefirst
Zhouetal.[49]leveragethetracelogstopredictlatenterrors,faulty
evaluationisaboutwhetherthelearnedmodelcorrectlycaptures
microservices,andfaulttypesatruntime.PCatch[22]automatically
thetracesimilarity.TheaccuraciesofSifter,PERCH,Contrastand
predictsperformancecascadingbugsbyanalyzingsystemexecution
STEAMare0.850,0.768,0.594and0.939separately.Ourmethod
undersmall-scaleworkloads.Moreover,distributedtracingisalso
outperformstheotherthreebaselinesby10%,22%,and58%re-
appliedinworkloadmodelingandmonitoringresourceusage[30].
spectively.Theresultsconfirmthatourproposedmethodcanwell
Withthedramaticincreaseintracevolumeinpractice,trace
capturethetracesimilaritybasedonthetracerepresentation.
samplingishighlyindemand.Severalpriorworks[14,20,21,47]
Wealsoevaluatethesamplingeffectivenessintermsofboththe
havestudiedtracesamplingbyclusteringalgorithmsorleveraging
coverageandentropymetrics.TheresultsareshowninFig.12.We
naturallanguageprocessingtechniques.However,thereisalack
canobservethatSTEAMachievesmuchhighercoveragescores
ofquantitativeevaluationofthesamplingresults.Besides,these
thanallthebaselineapproachesonperspectivesincludingopera-
approacheseitherdonotconsidertherichstructureoftraces[20]
tion,structure,latency,andtheircombinations.Especiallyonthe
orthelatencyinformation[21].InTraceCRL[47],itwouldcreate
combinationperspectivethatisveryhard,ourmethodobtainsa
tracesthatdonotmakesenseinrealworldandcannotincorporate
coverageof0.7whilethebest-performingbaselinemethodhasa
domainknowledge.Unlikethesework,wedefineobservability-
scoreofaround0.32only.Regardingtheentropymetric,thecon-
preserving trace sampling with a formal goal. Additionally, we
clusionissimilar.STEAMobtainsthehighestentropyvaluewhen
designedmodelstorepresenttracesandmakesamplingbyincor-
comparedtoallbaselinemethods.Theresultsareconsistentwith
poratingthetracedomainknowledgethatallowscustomization.
theevaluationresultsonfourmicroserviceapplications,demon-
stratingthepracticalvalueofSTEAMinindustrialenvironment.
8 CONCLUSION
6 THREATSTOVALIDITY Weproposedtheobservability-preservingtracesamplingtoallevi-
atetheseriousinformationlossissuecausedbythelong-taildistri-
Inthiswork,themodelistrainedbasedonthecollectedtracedata
butionoftraces.Wedefinedtwometrics,coverageandentropy,to
afterincorporatingdomainknowledge,whosequalitywouldaffect
quantitativelyevaluatetheobservability.Wefurtherformulatethe
theperformanceofSTEAM.Weidentifiedthefollowingthreats:
taskasmaximizingbothmetricsinthesampledtracesjointlyfrom
Data Quality In practice, there could be many data quality
multipleperspectives.Byincorporatingthetracedomainknowl-
issues,includingmissingtrace,incompletetrace,andtracedelay.
edge,weadoptthegraphneuralnetworktorepresenttraceswith
Bylearningfromthebaddata,themodelmightbebiasedandmake
structureandattributeembedded.Giventhelearnedrepresenta-
incorrectpredictions.Therefore,ahighlyreliabletracingplatform
tion,weproposedanefficientsamplingmethodtoselectasubset
isneeded.Fromthesamplingperspective,itisworthexploringhow
oftracesthatsatisfyourgoal.Weimplementedtheproposedsys-
tosamplecorrectlygiventhelimitedtraceinformation.
temSTEAMinOpenTelemetry.Throughextensiveevaluationson
DomainKnowledgeCorrectness:Weallowthecustomization
tracescollectedfromfourbenchmarkmicroserviceapplications
ofthedomainknowledgeinlogicclauses.However,itispossible
andaproductionsystem,weshowthatSTEAMiseffectiveand
thatthelogicclausescouldbeincorrect.Wehavetoadmitthat
scalableintracesamplingandcanpreservetheobservabilityduring
thiswouldaffectthesamplingeffectivenessasthemodellearns
thedetectionanddiagnosisofsystemfaults.
thewrongdata.Besidesthemanualassuranceoflogicclauses,we
couldalsodetectconflictsinthelogicclausesbyvalidatingifany
9 DATAAVAILABILITY
logicdoesnothold,whichweleaveforfuturework.
ApplicableScenarios:Thesamplingproposedinthiswork Toreproducetheresultsinthestudy,tracesshouldbecollectedafter
willchangethedistributionoftheoriginaldata,therefore,itmight deployingthefouropen-sourcebenchmarkapplicationsandrun-
not be appropriate for scenarios that heavily relies on the data ningsyntheticworkloadsbyfollowingtheinstructionsinSec.5.1.
1759
STEAM:Observability-PreservingTraceSampling ESEC/FSE’23,December3–9,2023,SanFrancisco,CA,USA
REFERENCES
[24] AristidisLikas,NikosVlassis,andJakobJVerbeek.2003. Theglobalk-means
[1] PaulBarham,RebeccaIsaacs,RichardMortier,andDushyanthNarayanan.2003. clusteringalgorithm.Patternrecognition36,2(2003),451–461.
Magpie:Onlinemodellingandperformance-awaresystems.In9thWorkshopon [25] JohnWLloyd.2012. Foundationsoflogicprogramming. SpringerScience&
HotTopicsinOperatingSystems(HotOSIX). BusinessMedia.
[2] ElisaCelis,VijayKeswani,DamianStraszak,AmitDeshpande,TarunKathuria, [26] Locust.[n.d.]. LOCUST:Anopensourceloadtestingtool. https://locust.io/.
andNisheethVishnoi.2018.FairanddiverseDPP-baseddatasummarization.In [Online;accessed03-Sep-2022].
InternationalConferenceonMachineLearning.PMLR,716–725. [27] ShutianLuo,HuanleXu,ChengzhiLu,KejiangYe,GuoyaoXu,LipingZhang,Yu
[3] GalChechik,VarunSharma,UriShalit,andSamyBengio.2010. LargeScale Ding,JianHe,andChengzhongXu.2021.CharacterizingMicroserviceDepen-
OnlineLearningofImageSimilarityThroughRanking. JournalofMachine dencyandPerformance:AlibabaTraceAnalysis(SoCC).
LearningResearch11,3(2010). [28] JonathanMace,RyanRoelke,andRodrigoFonseca.2015.Pivottracing:Dynamic
[4] LamingChen,GuoxinZhang,andEricZhou.2018.Fastgreedymapinference causalmonitoringfordistributedsystems.InProceedingsofthe25thSymposium
fordeterminantalpointprocesstoimproverecommendationdiversity.Advances onOperatingSystemsPrinciples.378–393.
inNeuralInformationProcessingSystems31(2018). [29] C.Majors,L.Fong-Jones,andG.Miranda.2022. ObservabilityEngineering.
[5] MikeYChen,AnthonyAccardi,EmreKiciman,JimLloyd,DavePatterson,Ar- O’ReillyMedia. https://books.google.com/books?id=JmZuEAAAQBAJ
mandoFox,andEricBrewer.2004.Path-basedfaliureandevolutionmanagement. [30] GideonMann,MarkSandler,DarjaKrushevskaja,SudiptoGuha,andEyalEven-
InProceedingsofthe1stconferenceonSymposiumonNetworkedSystemsDesign Dar.2011. ModelingtheParallelExecutionof{Black-Box}Services.In3rd
andImplementation-Volume1.23–23. USENIXWorkshoponHotTopicsinCloudComputing(HotCloud11).
[6] RodrigoFonseca,GeorgePorter,RandyHKatz,andScottShenker.2007. {X- [31] ChaosMesh.[n.d.].ChaosMesh:APowerfulChaosEngineeringPlatformfor
Trace}:APervasiveNetworkTracingFramework.In4thUSENIXSymposiumon Kubernetes.https://chaos-mesh.org/. [Online;accessed03-Sep-2022].
NetworkedSystemsDesign&Implementation(NSDI07). [32] TomasMikolov,KaiChen,GregoryS.Corrado,andJeffreyDean.2013.Efficient
[7] YuGan,MingyuLiang,SundarDev,DavidLo,andChristinaDelimitrou.2021. EstimationofWordRepresentationsinVectorSpace.InICLR.
Sage:practicalandscalableML-drivenperformancedebugginginmicroservices. [33] OpenTelemetry.[n.d.].OpenTelemetry:High-quality,ubiquitous,andportable
InProceedingsofthe26thACMInternationalConferenceonArchitecturalSupport telemetrytoenableeffectiveobservability.https://opentelemetry.io/. [Online;
forProgrammingLanguagesandOperatingSystems.135–151. accessed03-Sep-2022].
[8] YuGan,YanqiZhang,DailunCheng,AnkithaShetty,PriyalRathi,NayanKatarki, [34] GoogleCloudPlatform.[n.d.].OnlineBoutique:acloud-nativemicroservices
ArianaBruno,JustinHu,BrianRitchken,BrendonJackson,etal.2019. An demoapplication.https://github.com/GoogleCloudPlatform/microservices-demo.
open-sourcebenchmarksuiteformicroservicesandtheirhardware-software [Online;accessed03-Sep-2022].
implicationsforcloud&edgesystems.InProceedingsoftheTwenty-FourthIn- [35] RajaRSambasivan,AliceXZheng,MichaelDeRosa,ElieKrevat,SpencerWhit-
ternationalConferenceonArchitecturalSupportforProgrammingLanguagesand man,MichaelStroucken,WilliamWang,LianghongXu,andGregoryRGanger.
OperatingSystems.3–18. 2011. Diagnosingperformancechangesbycomparingrequestflows.In8th
[9] AdamGluck.[n.d.].IntroducingDomain-OrientedMicroserviceArchitecture. USENIXSymposiumonNetworkedSystemsDesignandImplementation(NSDI11).
https://eng.uber.com/microservice-architecture/.[Online;accessed03-Sep-2022]. [36] GiulioSantoli.[n.d.].MicroservicesArchitectures:BecomeaUnicornlikeNetflix,
[10] RobertMGray.2011.Entropyandinformationtheory.SpringerScience&Business TwitterandHailo.https://www.slideshare.net/gjuljo/microservices-architec
Media. tures-become-a-unicorn-like-netflix-twitter-and-hailo. [Online;accessed
[11] XiaofengGuo,XinPeng,HanzhangWang,WanxueLi,HuaiJiang,DanDing, 03-Sep-2022].
TaoXie,andLiangfeiSu.2020. Graph-basedtraceanalysisformicroservice [37] BenjaminHSigelman,LuizAndreBarroso,MikeBurrows,PatStephenson,Manoj
architectureunderstandingandproblemdiagnosis.InProceedingsofthe28th Plakal,DonaldBeaver,SaulJaspan,andChandanShanbhag.2010. Dapper,a
ACMJointMeetingonEuropeanSoftwareEngineeringConferenceandSymposium large-scaledistributedsystemstracinginfrastructure.(2010).
ontheFoundationsofSoftwareEngineering.1387–1397. [38] ApacheSpark.[n.d.].StreamingK-means.https://spark.apache.org/docs/latest
[12] LexiangHuangandTimothyZhu.2021.Tprof:PerformanceProfilingviaStruc- /mllib-clustering.html. [Online;accessed03-Sep-2022].
turalAggregationandAutomatedAnalysisofDistributedSystemsTraces.InPro- [39] C.Sridharan.2018.DistributedSystemsObservability:AGuidetoBuildingRobust
ceedingsoftheACMSymposiumonCloudComputing(SoCC’21)(SoCC’21).Associ- Systems.O’ReillyMedia. https://books.google.co.jp/books?id=07EswAEACAAJ
ationforComputingMachinery,76–91. https://doi.org/10.1145/3472883.3486994 [40] Stanford.[n.d.]. InverseDocumentFrequency. https://nlp.stanford.edu/IR-
[13] PengHuang,ChuanxiongGuo,JacobRLorch,LidongZhou,andYingnongDang. book/html/htmledition/inverse-document-frequency-1.html. [Online;accessed
2018.Capturingandenhancinginsitusystemobservabilityforfailuredetection. 03-Sep-2022].
In13thUSENIXSymposiumonOperatingSystemsDesignandImplementation [41] w3c.2021.W3CRecommendation:TraceContext.https://www.w3.org/TR/trace-
(OSDI18).1–16. context-1. [Online;accessed03-Sep-2022].
[14] ZichengHuang,PengfeiChen,GuangbaYu,HongyangChen,andZibinZheng. [42] LingmeiWeng,PengHuang,JasonNieh,andJunfengYang.2021. Argus:De-
2021.Sieve:Attention-basedSamplingofEnd-to-EndTraceDatainDistributed buggingPerformanceIssuesinModernDesktopApplicationswithAnnotated
MicroserviceSystems.In2021IEEEInternationalConferenceonWebServices CausalTracing.In2021USENIXAnnualTechnicalConference(USENIXATC21).
(ICWS).IEEE,436–446. USENIXAssociation,193–207.
[15] Jaeger.2022.Jaeger:opensource,end-to-enddistributedtracing.https://www.ja [43] YangWu,AngChen,andLinhThiXuanPhan.2019. Zeno:Diagnosingper-
egertracing.io/. [Online;accessed03-Sep-2022]. formanceproblemswithtemporalprovenance.In16thUSENIXSymposiumon
[16] JonathanKaldor,JonathanMace,MichałBejda,EdisonGao,WiktorKuropatwa, NetworkedSystemsDesignandImplementation(NSDI19).395–420.
JoeO’Neill,KianWinOng,BillSchaller,PingjiaShan,BrendanViscomi,etal.2017. [44] ZonghanWu,ShiruiPan,FengwenChen,GuodongLong,ChengqiZhang,and
Canopy:Anend-to-endperformancetracingandanalysissystem.InProceedings SYuPhilip.2020. Acomprehensivesurveyongraphneuralnetworks. IEEE
ofthe26thsymposiumonoperatingsystemsprinciples.34–50. transactionsonneuralnetworksandlearningsystems32,1(2020),4–24.
[17] RudolfEKalman.1960.Onthegeneraltheoryofcontrolsystems.InProceedings [45] KeyuluXu,WeihuaHu,JureLeskovec,andStefanieJegelka.2018.Howpowerful
FirstInternationalConferenceonAutomaticControl,Moscow,USSR.481–492. aregraphneuralnetworks?arXivpreprintarXiv:1810.00826(2018).
[18] AriKobren,NicholasMonath,AkshayKrishnamurthy,andAndrewMcCallum. [46] YuningYou,TianlongChen,YongduoSui,TingChen,ZhangyangWang,and
2017.Ahierarchicalalgorithmforextremeclustering.InProceedingsofthe23rd YangShen.2020.Graphcontrastivelearningwithaugmentations.Advancesin
ACMSIGKDDinternationalconferenceonknowledgediscoveryanddatamining. NeuralInformationProcessingSystems33,5812–5823.
255–264. [47] ChenxiZhang,XinPeng,TongZhou,ChaofengSha,ZhenghuiYan,YiruChen,
[19] AlexKuleszaandBenTaskar.2012.Determinantalpointprocessesformachine andHongYang.2022. TraceCRL:contrastiverepresentationlearningformi-
learning.arXivpreprintarXiv:1207.6083(2012). croservicetraceanalysis.InProceedingsofthe30thACMJointEuropeanSoftware
[20] PedroLas-Casas,JonathanMace,DorgivalGuedes,andRodrigoFonseca.2018. EngineeringConferenceandSymposiumontheFoundationsofSoftwareEngineering.
Weightedsamplingofexecutiontraces:capturingmoreneedlesandlesshay.In 1221–1232.
ProceedingsoftheACMSymposiumonCloudComputing.326–332. [48] XiangZhou,XinPeng,TaoXie,JunSun,ChaoJi,WenhaiLi,andDanDing.2018.
[21] PedroLas-Casas,GiorgiPapakerashvili,VaastavAnand,andJonathanMace.2019. Faultanalysisanddebuggingofmicroservicesystems:Industrialsurvey,bench-
Sifter:Scalablesamplingfordistributedtraces,withoutfeatureengineering.In marksystem,andempiricalstudy.IEEETransactionsonSoftwareEngineering47,
ProceedingsoftheACMSymposiumonCloudComputing.312–324. 2(2018),243–260.
[22] JiaxinLi,YuxiChen,HaopengLiu,ShanLu,YimingZhang,HaryadiSGunawi, [49] XiangZhou,XinPeng,TaoXie,JunSun,ChaoJi,DeweiLiu,QilinXiang,and
XiaohuiGu,XichengLu,andDongshengLi.2018.Pcatch:automaticallydetecting ChuanHe.2019.Latenterrorpredictionandfaultlocalizationformicroservice
performancecascadingbugsincloudsystems.InProceedingsoftheThirteenth applicationsbylearningfromsystemtracelogs.InProceedingsofthe201927th
EuroSysConference.1–14. ACMJointMeetingonEuropeanSoftwareEngineeringConferenceandSymposium
[23] lightstep.[n.d.].Thecloud-nativereliabilityplatform|Lightstep.https://www.li ontheFoundationsofSoftwareEngineering.683–694.
ghtstep.com/. [Online;accessed03-Sep-2022]. [50] YanqiaoZhu,YichenXu,QiangLiu,andShuWu.2021.AnEmpiricalStudyof
GraphContrastiveLearning.InThirty-fifthConferenceonNeuralInformation
ProcessingSystemsDatasetsandBenchmarksTrack(Round2).
1760
ESEC/FSE’23,December3–9,2023,SanFrancisco,CA,USA ShilinHe,BotaoFeng,LiqunLi,XuZhang,YuKang,QingweiLin,SaravanRajmohan,andDongmeiZhang
[51] YanqiaoZhu,YichenXu,FengYu,QiangLiu,ShuWu,andLiangWang.2021. [52] Zipkin.[n.d.]. OpenZipkin. https://www.zipkin.io/. [Online;accessed
Graphcontrastivelearningwithadaptiveaugmentation.InProceedingsofthe 03-Sep-2022].
WebConference2021.2069–2080.
Received2023-05-18;accepted2023-07-31
1761