### SOFA 的演进和开源之路

SOFA 是蚂蚁金服自主研发的金融级分布式中间件框架，它包含了构建金融级云原生架构所需的各种组件，提供了一套完整的分布式解决方案，并且在金融场景中经过了严格的实际验证。下图展示了 SOFA 开源全景图，该图涵盖了微服务领域的各个方面，并积极整合业界流行的开源组件，例如阿里巴巴集团开源的 Nacos 和 Sentinel，为用户提供更广泛的选择。

![](/data/attachment/album/201902/18/100346hkdyskv2d5ayg2ge.png)

*SOFA 开源全景图，涵盖微服务各个领域，并与流行开源组件如 Nacos 和 Sentinel 相结合，提供更多选择给用户。*

SOFA 经历了多年的内部发展，代表了蚂蚁金服技术体系的演变过程。目前，SOFA 采用核心开源加组件式开源模式，自 2018 年起正式对外开源。下面将探讨 SOFA 在开源前的发展历程及其后续演进方向。

#### SOFA 的发展历程

杨冰提到，“最初，在蚂蚁金服还未从淘宝独立出来时，公司内部使用了一个名为 Webx 的框架。但随着业务增长和技术进步，Webx 已经无法满足需求。因此，胡喜（现任蚂蚁金服副 CTO）领导开发了新的 SOFA 中间件框架。”

SOFA 中间件在蚂蚁内部经历了十年的迭代更新，共五个版本的升级。它被应用于支付、借贷、信用评估、基金管理和保险等全金融场景，成功支撑了多次大型促销活动，如双十一、双十二及新春红包发放，创造了每秒处理 25.6 万笔交易的记录，且这一数字仍在不断刷新。

“SOFA 的每一次重大版本更新都紧密跟随公司的整体架构调整。例如，SOFA1 主要关注模块化设计；到了 SOFA2，则引入了微服务体系；而 SOFA3 则致力于通过服务聚合来优化部署流程。”杨冰进一步解释道，“随着每年交易量的增长，我们必须从单体应用转向服务化架构，再逐渐过渡到单元化架构乃至弹性架构。SOFA 功能上的每次改进都是为了应对更加严峻的技术挑战。”

#### SOFA4：开启开源新篇章

尽管 SOFA 已经积累了多年的经验，但由于历史遗留问题较多，直到第四代产品才准备好对外开源。在此过程中，团队努力减轻代码负担，同时保留那些可以独立于蚂蚁特定环境运行的功能部分。杨冰强调，“我们不希望维护两套完全不同的代码库，而是希望通过同一份代码实现内外部兼容性。”

自 2018 年 4 月开始，SOFA 正式对外公开其源码。短短几个月内，该项目就获得了超过 10,000 个 Star 和来自 80 多位贡献者的支持。在线社区方面，官方站点 (https://www.sofastack.tech/) 也持续发布相关文章和技术文档以促进交流。

#### SOFA5：迈向 Service Mesh

近年来，随着容器技术和微服务架构的普及，Service Mesh 成为了一个新的研究热点。对此，杨冰表示：“我个人非常看好 Mesh 技术的发展前景，因为它能够在不增加应用复杂度的前提下提升系统性能和服务质量。”

目前，蚂蚁金服正积极参与 Istio 社区的合作，共同推进 Service Mesh 技术的应用与发展。其中，SOFAMesh 和 SOFAMosn 两个项目尤为关键：

- **SOFAMesh**：作为蚂蚁金服 Service Mesh 控制平面的一部分，基于 Istio 进行了功能增强，旨在解决大规模生产环境中遇到的实际问题。
  
- **SOFAMosn**：则提供了底层网络通信的支持，不仅服务于 Service Mesh 场景，还适用于 Ingress/API Gateway 等其他用途。

#### 未来展望

除了 Service Mesh 领域外，蚂蚁金服还计划将其成熟的分布式事务框架以及服务注册中心逐步开放给公众。这将进一步丰富 SOFA 生态系统，并为行业带来全新的解决方案。

总之，蚂蚁金服通过 SOFA 框架展现了如何有效地将企业级软件与开源理念相结合的过程。从最初的专有软件使用到后来的部分开源采纳，再到最终全面拥抱开源文化，这一路径值得众多科技公司借鉴学习。