interception over UDP and other factors.
China-wide analysis. We cooperate with an interna-
tional security company who has developed mobile se-
curity software with millions of users. The software has
been granted the permission to send arbitrary network
requests when installed, so we are able to collect ﬁne-
grained DNS data.
The major concerns of this experiment are around
ethics and privacy, and we carefully address these con-
cerns as brieﬂy described below (more details are cov-
ered in Section 3.5). Firstly, the module where we im-
plement our measurement script (sending and receiv-
ing DNS packets) comes with a consent, and the soft-
ware has to be run manually with granted permission
from users. Secondly, although sending diverse DNS
requests from a client helps us comprehensively under-
stand DNSIntercept characteristics, we try to avoid
generating excessive trafﬁc on user’s devices. This
choice limits the diversity of our DNS requests. Finally,
our script only captures DNS packets of domains exclu-
sively registered for this study, thus the data deemed pri-
vate, like requests to social networks, is not collected.
Distribution of DNS packets. According to our in-
ception model described earlier, to generate as diverse
DNS packets as possible, we should launch DNS re-
quests from a client under all four different SLDs, of all
ﬁve RR types, over both TCP and UDP, and to all four
public DNS services. However, we believe it is difﬁcult
due to ethical concerns and limitations of vantage points.
In the phase of Global analysis, ProxyRack only ac-
cepts TCP trafﬁc. Meanwhile, the proxy network has a
rate limit of submitting requests, so we have to be careful
in crafting DNS requests. Therefore, from each client,
we only request DNS A record, the most common RR
type, of our com domain name using TCP-based lookups,
to all four public DNS services.
USENIX Association
27th USENIX Security Symposium    1119
ﬁrst
the
investigate
4.1 Scope and Magnitude
landscape
of
We
global
DNSIntercept from three aspects.
Firstly, using
our methodology described in the previous section, we
identify and classify interception by cross-matching
resolver addresses.
Secondly, we validate whether
correct responses are eventually accepted by clients.
Here we regard a response of an FQDN accepted by the
client to be correct, only when its RR value is identical
to the RR of the same FQDN which is responded by
our authoritative nameserver; otherwise, the response is
incorrect, which is tampered on its way back. Thirdly,
speciﬁcally for Request replication scenario, intercep-
tors may hope to use out-of-band DNS packets [46]
(i.e., responses of replicated lookups) to replace in-band
ones (i.e., responses of original lookups). To this end,
replicated lookups are often made faster than original
ones. Through our design of authoritative nameservers,
we present how many in-band responses are eventually
accepted by the client.
Table 2 summarizes our ﬁndings in Global analysis.
All of three interception types are found in our dataset.
In total, 198 (out of 2,691, 7.36%) client ASes witness
intercepted trafﬁc, in 158 of which queries to Google
Public DNS are intercepted. The ratio of Direct respond-
ing is signiﬁcantly low, since it is impossible for re-
solvers to correctly resolve a domain without contacting
nameservers, and thus this behavior is distinguishable
from clients. Moreover, we also ﬁnd that compared to
the less-known EDU DNS (0.45% packets intercepted),
DNS trafﬁc sent to renowned public DNS services are
more likely to become victims of DNSIntercept (e.g.,
0.66% for Google DNS).
As for responses accepted by clients, all except one
are correct, suggesting major responses of intercepted
queries are not tampered. The one incorrect response1
is accepted by a client in AS36992 (EG, ETISALAT-
MISR), which is caused by domain blocking. On the
other hand, for Request replication, in-band responses
accepted by clients are in the minority. Among 23 ASes
where replicated queries are found, only clients in 2 of
them (AS9198 JSC Kazakhtelecom, and AS31252 Star-
Net Solutii SRL) receive in-band responses.
4.2 AS-Level Characteristics
As described in our landscape study, intercepted DNS re-
quests are found in 198 client ASes, with different modes
and ratio. We now analyze the AS-level characteristics of
DNSIntercept, by focusing on the 158 ASes with inter-
cepted requests to Google Public DNS.
1Response: 146.112.61.109,
its reverse lookup pointing to
hit-block.opendns.com
Figure 6: Geo-distribution of proxy nodes
3.5 Ethics
Our methodology could introduce a few ethical concerns.
Here, we discuss them before presenting our results.
Throughout this study, we take utmost care to protect
users from side-effects that may be caused by our ex-
periment.
In Global analysis, ProxyRack is commercial. We pay
for the proxy plans and totally abide by their terms of
service. More importantly, owners of exit nodes (i.e., our
vantage points) have an agreement with ProxyRack that
permits ProxyRack trafﬁc to exit from their hosts. There-
fore, launching DNS requests from ProxyRack adheres
to the granted permission from owners of exit nodes.
In China-wide analysis, we implement our measure-
ment script in a network debugger module of security
software with millions of users. To avoid ethical con-
cerns, this network debugger module comes with a one-
time consent stating its procedure and data collected.
Users reserve the right of choosing whether to install this
security software and whether to run this module con-
taining our measurement script manually.
In addition,
the user has the option to install the software without the
measurement module.
Regarding our methodology, we carefully craft our
DNS requests and limit their quantities to avoid exces-
sive network trafﬁc. Meanwhile, we only launch DNS
lookups of domain names exclusively registered and
used for this study on each client, without connecting to
any host except for DNS resolvers.
Through said approaches, we believe we have mini-
mized the threat to user’s privacy and security in the ex-
periments, as all operations are under granted permission
from users, and we do not collect any data except for
DNS resolutions under the limited scope.
4 TCP DNS Interception Analysis (Global)
To conduct a global measurement of DNSIntercept, we
ﬁrst leverage a residential proxy network based on TCP
SOCKS. Here, we report our measurement results and
analysis in the phase of Global Analysis, by showing its
landscape and characteristics.
1120    27th USENIX Security Symposium
USENIX Association
Table 2: Summary of interception (Global analysis). All DNS packets are over TCP. Under each type, ratio is used for correct
answers and raw numbers are used for incorrect and in-band ones.
Request Replication
Direct Responding # Problematic
Public DNS
# Request
Google DNS
OpenDNS
391,042
431,633
Dynamic DNS 407,632
422,646
EDU DNS
Interception
Ratio
0.66%
0.64%
0.53%
0.45%
Normal Resolution Request Redirection
Correct
99.34%
99.36%
99.47%
99.55%
Incorrect Correct
0.41%
0.26%
0.29%
0.27%
Incorrect Correct
0.25%
0.38%
0.24%
0.18%
0
1
0
0
0
0
0
0
Incorrect
In-band
Incorrect
Client AS
0
0
0
0
8
0
0
9
0
0
0
2
158
139
116
121
Table 3: Targeted public DNS services of top 10 ASes
AS (Country)
Google Others
Organization
AS38001 (SG) NewMedia Express
AS36351 (US) SoftLayer Technologies
AS43554 (UA) Cifrovye Dispetcherskie
AS198605 (CZ) AVAST Software
AS16397 (BR) EQUINIX BRASIL SP
AS7922 (US) Comcast Cable
AS23693 (ID) PT. Telekomunikasi
AS61102 (IS)
AS49505 (RU) Network of Selectel
AS15774 (RU) TransTeleCom
Interhost Communication


















Table 4: Alternative DNS resolvers of top 10 ASes
Organization
AS (Country)
AS38001 (SG) NewMedia Express
AS36351 (US)
SoftLayer Technologies
AS43554 (UA) Cifrovye Dispetcherskie
AS198605 (CZ) AVAST Software
AS16397 (BR) EQUINIX BRASIL SP
AS7922 (US)
AS23693 (ID)
AS61102 (IS)
AS49505 (RU) Network of Selectel
AS15774 (RU) TransTeleCom
Alternative resolvers
113.29.230.* (38001)
169.57.1.* (36351)
178.209.65.* (43554)
77.234.42.* (198605)
177.47.27.* (16397)
69.241.93.* (7922)
Comcast Cable
PT. Telekomunikasi
114.125.67.* (23693)
Interhost Communication 185.18.205.* (61102)
95.213.193.* (49505)
188.43.31.* (15774)
top 10 ASes, alternative resolvers actually locate in the
same AS as the clients.
Trafﬁc ranking of problematic ASes. We expect
DNSIntercept tends to take place in ASes with lower
reputation since such behavior should be furtive. How-
ever, by correlating problematic client ASes with their
trafﬁc ranking logged by CAIDA [2], our result shows
that interception also exists in reputable ASes. Presented
in Figure 8, problematic ASes span a diverse ranking. As
an example, both Request redirection and Request repli-
cation are observed under AS3356, which is ranked the
ﬁrst according to CAIDA.
Figure 8: Trafﬁc ranking of problematic ASes
Figure 7: Top 20 ASes with most intercepted requests to Google
Public DNS. Ratio of intercepted requests over total requests to
Google DNS is shown above for each AS.
Types and ratio of interception. Figure 7 illustrates
the quantity and types of intercepted requests to Google
from each AS, as well as the ratio over its total requests
to Google. We ﬁnd that among the top 20 ASes, most
of them only witness one type of interception, which in-
dicates a uniﬁed policy of DNS trafﬁc ﬁltering within an
AS. Both Request redirection and Request replication are
found in top ASes.
Regarding interception ratio, we ﬁnd that 82 (52%)
of all 158 problematic ASes intercept more than 90%
of DNS requests sent to Google, such as AS38001 and
AS43554. By contrast, 50 (32%) ASes have an intercep-
tion rate lower than 0.5 (e.g., AS17974). We speculate it
to be a result of interception policies and deployment of
on-path devices, which may cover only limited locations
within the AS.
Country-level analysis. We further investigate the coun-
try distribution of the 158 ASes, and ﬁnd they span 41
countries. Russia tops the list and accounts for 44 ASes
(28%), followed by the US (15 ASes, 9%), Indonesia (8
ASes, 5%), Brazil and India (7 ASes each, 4%).
Targeted public DNS services. We ﬁnd that in some
ASes, only queries sent to speciﬁc public DNS services
are intercepted. Table 3 shows the results of top 10 ASes
with most intercepted requests to Google. While the ma-
jority of ASes do not, we ﬁnd 2 ASes (AS43554 and
AS15774) exclusively intercept trafﬁc to Google DNS.
Alternative resolvers. When DNSIntercept takes
place, alternative resolvers contact our authoritative
nameservers. For each of top 10 ASes with most inter-
cepted requests, Table 4 shows their alternative resolvers
which handle the resolution. We can conclude that for
USENIX Association
27th USENIX Security Symposium    1121
Case study. AS7922 (ranked 22 according to CAIDA)
belongs to Comcast Cable Communications, LLC, a
renowned ISP based in the US. Among our 13,466 DNS
requests sent from this AS to Google DNS, 72 (0.53%)
are redirected, with alternative resolvers outside Google
actually contacting our authoritative nameservers. The
IP preﬁx of these alternative resolvers is 76.96.15.*
(also locating in AS7922), whose PTR record points to
hous-cns14.nlb.iah1.comcast.net. We also ﬁnd
that clients of the 72 intercepted requests are grouped in
several preﬁxes (e.g., 67.160.0.0/11). As the inter-
ception ratio is low, we speculate that on-path devices
conducting DNSIntercept are deployed only in limited
sub-networks within this AS. Also, it is possible that in-
terception devices are deployed by customers of Com-
cast, instead of AS-level network operators.
4.3 Summary of Findings
Our measurement ﬁndings in Global analysis are sum-