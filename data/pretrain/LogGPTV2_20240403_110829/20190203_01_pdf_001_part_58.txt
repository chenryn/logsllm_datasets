For a Postgres publication database in a single-master replication system, verify that the
publication database user is a superuser and has the privilege to modify pg_catalog
tables.
See Section 5.1.4.3.
For the master definition node in a multi-master replication system, verify that the
publication database user is a superuser and has the privilege to modify pg_catalog
tables.
See Section 6.1.3.
For a master node other than the master definition node in a multi-master replication
system, verify that the master node database user is a superuser and has the privilege to
modify pg_catalog tables.
See Section 6.1.4.
Step 6: Verify that the necessary privileges have been granted to the subscription
database user.
For an Oracle subscription database, verify that the subscription database user has
CONNECT and RESOURCE privileges.
For a Postgres subscription database, verify that the subscription database user is a
superuser and has the privilege to modify pg_catalog tables.
See Section 5.1.5.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 649
EDB Postgres Replication Server User’s Guide
Step 7 (For Linux only): Verify that the network IP address returned by the
/sbin/ifconfig command either matches the IP address associated with the host name
in the /etc/hosts file (see Section 5.1.6.2), or matches the IP address specified with
the java.rmi.server.hostname configuration option in the publication and
subscription server configuration files (see Section 10.4.1.7).
10.3.4 Troubleshooting Areas
The following topics provide information on specific problem areas you may encounter.
10.3.4.1 Java Runtime Errors
If errors are encountered regarding the Java Runtime Environment such as the Java
program cannot be found or Java heap space errors, check the parameters set in the xDB
Startup Configuration file xdbReplicationServer-xx.config. See Section 2.3.1.4
for information on the xDB Startup Configuration file.
The following is an example of the content of the xDB Startup Configuration file:
#!/bin/sh
JAVA_EXECUTABLE_PATH="/usr/bin/java"
JAVA_MINIMUM_VERSION=1.7
JAVA_BITNESS_REQUIRED=64
JAVA_HEAP_SIZE="-Xms256m -Xmx1536m"
PUBPORT=9051
SUBPORT=9052
If you make any changes to the parameters in the xDB Startup Configuration file, be sure
to restart the publication server and subscription server after making the modifications.
10.3.4.2 Starting the Publication Server or Subscription Server
Note: The subscription server only applies to single-master replication systems.
If you cannot start the publication server or the subscription server perform the following
steps:
Step 1: Check the pubserver.log and subserver.log files for errors.
Step 2: Check the log file of the database server running the controller database for
errors.
Step 3: Verify that the user name and password in the xDB Replication Configuration
file on the hosts running the publication server and subscription server match a database
user name and password in the database server running the controller database that the
publication server and subscription server are attempting to access.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 650
EDB Postgres Replication Server User’s Guide
Step 4: If the controller database is a Postgres database, verify that the pg_hba.conf
file of its Postgres database server has entries that allow access to the controller database
from the IP addresses of the hosts running the publication server and subscription server
by the user name in the xDB Replication Configuration file.
10.3.4.3 Deleting the Control Schema and Control Schema Objects
The control schema completely describes the replication system. The control schema and
its control schema objects must be complete and correct in order for replication to occur
properly. In addition, the configuration and maintenance operations performed through
the xDB Replication Console or the xDB Replication Server CLI cannot be accomplished
properly unless the control schema is complete and correct.
There may be occasions where the control schema becomes corrupted. Either one or more
control schema tables containing metadata are inadvertently deleted, or the data within
the control schema tables becomes corrupted. Typically, corruption occurs in the form of
the first case – one or more control schema tables were deleted, or the entire control
schema and its contents were deleted manually using an SQL utility rather than through
the operation of the xDB Replication Console or xDB Replication Server CLI.
In these situations, there may be no other choice than to remove all of the remaining
control schema objects using the database management system’s deletion functions,
which effectively deletes all replication systems managed by the control schema.
The same control schema deletion procedure must be performed in all publication
databases that share the same control schema information as the current controller
database given in the xDB Replication Configuration file.
From the viewpoint of the xDB Replication Console replication tree, a publication server
that connects to the controller database has subordinate to it, the publication databases
sharing the same control schema information.
In the following example, the SMR publication database edb as well as the three MMR
master node databases mdnnode, mmrnode_a, and mmrnode_b are all managed by the
same publication server, which connects to the controller database designated in the xDB
Replication Configuration file. Thus, all publication databases edb, mdnnode,
mmrnode_a, and mmrnode_b contain what should be the same control schema
information.
The control schema must be removed from all four publication databases if it is
determined that the control schema is corrupted in any of the four publication databases.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 651
EDB Postgres Replication Server User’s Guide
Figure 10-4 - Publication databases with shared controller database
Finally, the subscription databases of SMR systems contain a control schema object,
which must be deleted as well.
In the preceding example, subscription database subdb contains a control schema object
that may have to be deleted if control schema deletion is performed on the publication
database.
The instructions in this section describe how to completely remove all control
schema objects created by the xDB Replication Server product leaving just your
original publication tables and any replicated subscription tables or publication
tables of multi-master system nodes. Hence, the definition and framework for all
existing single-master and multi-master replication systems are deleted. In effect,
this simulates the situation when you have installed the xDB Replication Server
product for the first time.
After you have performed this deletion process, single-master replication systems must
then be recreated following the directions in sections 5.2 onward. A multi-master
replication system must be recreated following the directions in sections 6.2 onward.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 652
EDB Postgres Replication Server User’s Guide
Warning: Do not attempt this if any replication systems are running in production.
All replication systems will become inoperable.
This section describes what to look for in order to tell if the control schema is not
complete, and if so, what must be deleted to completely remove the replication system.
This section does not discuss the internal contents of the control schema objects. If all of
the control schema objects are present, then review the checklist in Section 10.3.3 before
proceeding with deletion of the control schema as it is fairly unlikely that the content of a
control schema table becomes corrupted.
If you decide that you must delete all of the control schema objects, follow the steps as
discussed in the following:
Step 1: Stop the publication server.
Step 2: Stop the subscription server.
Step 3: Look for the control schema objects contained within a publication database. In
the example used in this section, pubuser is the publication database user name. The
publication consists of two tables – dept and emp.
For Oracle only: See Section 5.2.4.1 for a list of Oracle control schema objects.
For SQL Server only: See Section 5.2.4.2 for a list of SQL Server control schema
objects.
For Postgres only: See Section 5.2.4.3 for a list of Postgres control schema objects.
Step 4: If the schema that is supposed to contain the control schema objects (the
publication database user name for Oracle, or the control schema you created or selected
when configuring a SQL Server publication database along with
_edb_replicator_pub, _edb_replicator_sub, and _edb_scheduler, or
_edb_replicator_pub, _edb_replicator_sub, and _edb_scheduler for
Postgres) is missing, or there are missing database objects under the control schema, then
you may need to complete the process of removing all remaining control schema objects.
If you decide to undergo this procedure, you must remove the control schema objects
from all publication databases. You must also remove all subscription metadata objects
from the subscription databases. Proceed with Step 7 and repeat Step 7 for all publication
databases. Then proceed with Step 8 and repeat Step 8 for all subscription databases.
If the control schema objects look intact, repeat Step 3 for all other publication databases.
If the control schema objects of all publication databases appear intact, then proceed with
Step 5.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 653
EDB Postgres Replication Server User’s Guide
Step 5: For single-master replication systems, the subscription database contains a single
control schema object in the form of a table named rrep_txset_health. See Section
5.3.4 for a listing of this control schema object for each type of subscription database.
For each subscription database, verify the presence of this subscription metadata object.
Step 6: If at this point, all control schemas and control schema objects appear intact in all
publication databases and all subscription databases, then chances are that the problem
lies elsewhere. Do not go proceed with any further steps in this section. Instead, recheck
the checklist in Section 10.3.3.
If it was determined that incomplete control schema objects exist, and you decide to go
ahead with the deletion process, proceed with Step 7.
Step 7: Repeat this step for every publication database to delete its control schema and
control schema objects.
For Oracle only: If the publication user name still exists, then log onto SQL*Plus or any
other Oracle database administration utility and drop all control schema objects owned by
the publication user. Alternatively, you can drop the publication database user along with
its database objects using the cascade option, but the publication database user must be
recreated and privileges reassigned if you intend to rebuild your replication systems. See
Section 5.1.4 for directions on creating the publication database user. The following
example illustrates use of the cascade option:
SQL> CONNECT system/password
Connected.
SQL> DROP USER pubuser CASCADE;
User dropped.
For SQL Server only: If any of the control schema objects listed in Step 3 still exist,
then log onto the SQL Server command line program, sqlcmd, or SQL Server
Management Studio and drop these objects. The following example assumes some of the
control schema objects were created under schema pubuser. The other control schema
objects are created under _edb_replicator_pub, _edb_replicator_sub, and
_edb_scheduler. The publication tables are dept and emp located in schema edb.
The following example shows how to delete the jobs in the msdb database:
1> USE msdb;
2> GO
Changed database context to 'msdb'.
1> EXEC sp_delete_job @job_name = 'rrep_cleanup_job_edb';
2> GO
1> EXEC sp_delete_job @job_name = 'rrep_txset_job_edb';
2> GO
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 654
EDB Postgres Replication Server User’s Guide
The next example shows the deletion of the triggers on the non-snapshot only publication
tables:
1> USE edb;
2> GO
Changed database context to 'edb'.
1> DROP TRIGGER edb.rrpd_edb_dept;
2> DROP TRIGGER edb.rrpi_edb_dept;
3> DROP TRIGGER edb.rrpu_edb_dept;
4> DROP TRIGGER edb.rrpd_edb_emp;
5> DROP TRIGGER edb.rrpi_edb_emp;
6> DROP TRIGGER edb.rrpu_edb_emp;
7> GO
The control schema objects under the _edb_replicator_pub schema are dropped as
shown by the following:
1> USE edb;
2> GO
Changed database context to 'edb'.
1> DROP TABLE _edb_replicator_pub.rrep_lock;
2> DROP TABLE _edb_replicator_pub.rrep_mmr_pub_group;
3> DROP TABLE _edb_replicator_pub.rrep_mmr_txset;
4> DROP TABLE _edb_replicator_pub.rrep_properties;
5> DROP TABLE _edb_replicator_pub.rrep_publication_subscriptions;
6> DROP TABLE _edb_replicator_pub.rrep_publication_tables;
7> DROP TABLE _edb_replicator_pub.rrep_tables;
8> DROP TABLE _edb_replicator_pub.rrep_tx_monitor;
9> DROP TABLE _edb_replicator_pub.rrep_txset;
10> DROP TABLE _edb_replicator_pub.rrep_txset_health;
11> DROP TABLE _edb_replicator_pub.rrep_txset_log;
12> DROP TABLE _edb_replicator_pub.xdb_cleanup_conf;
13> DROP TABLE _edb_replicator_pub.xdb_conflicts;
14> DROP TABLE _edb_replicator_pub.xdb_conflicts_options;
15> DROP TABLE _edb_replicator_pub.xdb_events;
16> DROP TABLE _edb_replicator_pub.xdb_events_status;
17> DROP TABLE _edb_replicator_pub.xdb_mmr_pub_group;
18> DROP TABLE _edb_replicator_pub.xdb_pub_database;
19> DROP TABLE _edb_replicator_pub.xdb_pub_table_replog;
20> DROP TABLE _edb_replicator_pub.xdb_pub_replog;
21> DROP TABLE _edb_replicator_pub.xdb_publication_filter;
22> DROP TABLE _edb_replicator_pub.xdb_publication_filter_rule;
23> DROP TABLE _edb_replicator_pub.xdb_publication_subscriptions;
24> DROP TABLE _edb_replicator_pub.xdb_publications;
25> DROP TABLE _edb_replicator_pub.xdb_pubtables_ignoredcols;
26> DROP TABLE _edb_replicator_pub.xdb_sub_servers;
27> GO
For SQL Server 2008 only: Drop the following control schema objects when the
publication database is SQL Server 2008:
1> USE edb;
2> GO
Changed database context to 'edb'.
1> DROP PROCEDURE _edb_replicator_pub.nextval;
2> DROP PROCEDURE _edb_replicator_pub.sp_createsequence;
3> DROP PROCEDURE _edb_replicator_pub.sp_dropsequence;
4> DROP TABLE _edb_replicator_pub.rrep_common_seq;
5> DROP TABLE _edb_replicator_pub.rrep_tx_seq;
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 655
EDB Postgres Replication Server User’s Guide
6> DROP TABLE _edb_replicator_pub.rrep_txset_seq;
7> GO
For SQL Server 2012, 2014 only: Drop the following control schema objects when the
publication database is SQL Server 2012 or 2014:
1> USE edb;
2> GO
Changed database context to 'edb'.
1> DROP SEQUENCE _edb_replicator_pub.rrep_tx_seq;
2> DROP SEQUENCE _edb_replicator_pub.rrep_txset_seq;
3> DROP SEQUENCE _edb_replicator_pub.rrep_common_seq;
4> GO
Drop the _edb_replicator_pub control schema:
1> USE edb;
2> GO
Changed database context to 'edb'.
1> DROP SCHEMA _edb_replicator_pub;
2> GO
The control schema objects under the _edb_replicator_sub schema as well as the
schema itself are dropped as shown by the following.
Note (For SQL Server 2012, 2014): When the publication database is SQL Server 2012
or 2014, the first table in the following list, rrep_common_seq, does not exist.
Therefore do not issue the first DROP TABLE
_edb_replicator_sub.rrep_common_seq command.
1> USE edb;
2> GO
Changed database context to 'edb'.
1> DROP TABLE _edb_replicator_sub.rrep_common_seq;
2> DROP TABLE _edb_replicator_sub.xdb_sub_database;
3> DROP TABLE _edb_replicator_sub.xdb_subscription_tables;
4> DROP TABLE _edb_replicator_sub.xdb_subscriptions;
5> DROP TABLE _edb_replicator_sub.xdb_tables;
6> DROP SCHEMA _edb_replicator_sub;
7> GO
The control schema objects under the _edb_scheduler schema as well as the schema
itself are dropped as shown by the following:
1> USE edb;
2> GO
Changed database context to 'edb'.
1> DROP TABLE _edb_scheduler.sch_pub_BLOB_TRIGGERS;
2> DROP TABLE _edb_scheduler.sch_pub_CALENDARS;
3> DROP TABLE _edb_scheduler.sch_pub_CRON_TRIGGERS;
4> DROP TABLE _edb_scheduler.sch_pub_SIMPLE_TRIGGERS;
5> DROP TABLE _edb_scheduler.sch_pub_TRIGGER_LISTENERS;
6> DROP TABLE _edb_scheduler.sch_pub_FIRED_TRIGGERS;
7> DROP TABLE _edb_scheduler.sch_pub_TRIGGERS;
8> DROP TABLE _edb_scheduler.sch_pub_JOB_LISTENERS;
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 656
EDB Postgres Replication Server User’s Guide
9> DROP TABLE _edb_scheduler.sch_pub_JOB_DETAILS;
10> DROP TABLE _edb_scheduler.sch_pub_LOCKS;
11> DROP TABLE _edb_scheduler.sch_pub_PAUSED_TRIGGER_GRPS;
12> DROP TABLE _edb_scheduler.sch_pub_SCHEDULER_STATE;
13> DROP TABLE _edb_scheduler.sch_sub_BLOB_TRIGGERS;
14> DROP TABLE _edb_scheduler.sch_sub_CALENDARS;
15> DROP TABLE _edb_scheduler.sch_sub_CRON_TRIGGERS;
16> DROP TABLE _edb_scheduler.sch_sub_SIMPLE_TRIGGERS;
17> DROP TABLE _edb_scheduler.sch_sub_TRIGGER_LISTENERS;
18> DROP TABLE _edb_scheduler.sch_sub_FIRED_TRIGGERS;
19> DROP TABLE _edb_scheduler.sch_sub_TRIGGERS;
20> DROP TABLE _edb_scheduler.sch_sub_JOB_LISTENERS;
21> DROP TABLE _edb_scheduler.sch_sub_JOB_DETAILS;
22> DROP TABLE _edb_scheduler.sch_sub_LOCKS;
23> DROP TABLE _edb_scheduler.sch_sub_PAUSED_TRIGGER_GRPS;
24> DROP TABLE _edb_scheduler.sch_sub_SCHEDULER_STATE;
25> DROP SCHEMA _edb_scheduler;
26> GO
The control schema objects under the pubuser schema are dropped as shown by the
following:
1> USE edb;
2> GO
Changed database context to 'edb'.
1> DROP FUNCTION pubuser.getPackageVersionNumber;
2> DROP PROCEDURE pubuser.CleanupShadowTables;
3> DROP PROCEDURE pubuser.ConfigureCleanUpJob;
4> DROP PROCEDURE pubuser.ConfigureCreateTxSetJob;
5> DROP PROCEDURE pubuser.CreateMultiTxSet;
6> DROP PROCEDURE pubuser.CreateTableLogTrigger;
7> DROP PROCEDURE pubuser.CreateTxSet;
8> DROP PROCEDURE pubuser.CreateTxSet_old;
9> DROP PROCEDURE pubuser.CreateUniTxSet;