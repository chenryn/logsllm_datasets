    select * from (  
      select   
        row_number() over (order by coalesce("语文",0)+coalesce("数学",0)+coalesce("英语",0)+coalesce("政治",0)+coalesce("历史",0)+coalesce("地理",0) desc nulls last) as wen_rn,   
        row_number() over (order by coalesce("语文",0)+coalesce("数学",0)+coalesce("英语",0)+coalesce("物理",0)+coalesce("化学",0)+coalesce("生物",0) desc nulls last) as li_rn,   
        "总分排名",   
        coalesce("语文",0)+coalesce("数学",0)+coalesce("英语",0)+coalesce("政治",0)+coalesce("历史",0)+coalesce("地理",0) as wen,  
        coalesce("语文",0)+coalesce("数学",0)+coalesce("英语",0)+coalesce("物理",0)+coalesce("化学",0)+coalesce("生物",0) as li,  
        COLUMNS(* EXCLUDE ("总分排名", "准考证号", "自定义考号")) from st_read('/Users/digoal/Downloads/总分.xlsx', layer='Sheet1')   
    ) t  
  ) t  
) t  
where "学校"='杭州市余杭中学' order by li_rn1 limit 20;   
┌────────┬────────┬───────┬──────────┬────────┬────────┬─────────┬─────────┬───┬────────┬────────┬────────┬────────┬────────┬────────┬────────┬────────┐  
│ li_rn1 │ wen_rn │ li_rn │ 总分排名 │  wen   │   li   │  姓名   │  班级   │ … │  数学  │  英语  │  物理  │  化学  │  生物  │  政治  │  历史  │  地理  │  
│ int64  │ int64  │ int64 │  int32   │ double │ double │ varchar │ varchar │   │ double │ double │ double │ double │ double │ double │ double │ double │  
├────────┼────────┼───────┼──────────┼────────┼────────┼─────────┼─────────┼───┼────────┼────────┼────────┼────────┼────────┼────────┼────────┼────────┤  
│   1008 │    698 │   944 │      814 │  570.5 │  595.0 │         │ 13班    │ … │   99.0 │  127.5 │   75.5 │   87.5 │   88.0 │   79.0 │   74.5 │   73.0 │  
│   1191 │   2165 │  1111 │     1606 │  532.5 │  589.0 │         │ 14班    │ … │  109.0 │  125.5 │   84.5 │   90.5 │   79.0 │   63.5 │   71.0 │   63.0 │  
│   1363 │   4034 │  1284 │     2481 │  504.5 │  583.0 │         │ 13班    │ … │  125.0 │  103.0 │   78.5 │   94.0 │   83.5 │   61.0 │   62.5 │   54.0 │  
│   1377 │    966 │  1303 │      969 │  561.0 │  582.0 │         │ 14班    │ … │  119.5 │  108.5 │   84.0 │   87.0 │   81.0 │   77.0 │   85.0 │   69.0 │  
│   1416 │   1899 │  1339 │     1424 │  538.0 │  581.0 │         │ 11班    │ … │   95.0 │  117.5 │   77.5 │   90.0 │   87.0 │   72.5 │   73.0 │   66.0 │  
│   1557 │   1829 │  1763 │     1717 │ 539.25 │  569.0 │         │ 14班    │ … │  102.0 │  123.0 │   68.0 │   90.0 │   85.5 │  81.25 │   73.5 │   59.0 │  
│   1729 │   1948 │  1917 │     1700 │  537.0 │  565.0 │   xxx   │ 14班    │ … │  108.5 │  105.5 │   81.0 │   87.0 │   78.0 │   78.5 │   63.5 │   76.0 │  
│   1778 │   4069 │  1672 │     2223 │  504.0 │  572.0 │         │ 11班    │ … │  107.0 │  102.5 │   89.0 │   85.0 │   89.0 │   49.5 │   66.5 │   79.0 │  
│   1819 │   2213 │  1716 │     1495 │  531.5 │  570.5 │         │ 10班    │ … │  106.0 │  104.0 │   75.0 │   93.0 │   90.5 │   86.5 │   63.0 │   70.0 │  
│   1854 │   1994 │  2050 │     1417 │  536.0 │  562.0 │         │ 11班    │ … │  100.5 │   97.5 │   76.0 │   89.5 │   91.5 │   73.0 │   80.0 │   78.0 │  
│   1883 │   3293 │  1774 │     1731 │  514.5 │  569.0 │         │ 12班    │ … │  101.0 │   95.0 │   78.5 │   97.0 │   92.0 │   66.5 │   72.5 │   74.0 │  
│   1899 │   1689 │  2291 │     1785 │  542.0 │  556.5 │         │ 11班    │ … │  103.5 │  106.5 │   72.5 │   89.0 │   76.5 │   75.0 │   81.5 │   67.0 │  
│   2018 │   4384 │  1911 │     2630 │ 500.25 │  565.5 │         │ 11班    │ … │  101.5 │  117.5 │   81.5 │   90.0 │   84.5 │  58.25 │   60.5 │   72.0 │  
│   2037 │   2504 │  1936 │     1529 │  526.5 │  564.5 │         │ 11班    │ … │  117.0 │   78.5 │   85.0 │   81.5 │   96.0 │   62.0 │   77.5 │   85.0 │  
│   2123 │   1396 │  2507 │     2016 │  548.5 │  552.0 │         │ 13班    │ … │   93.5 │  128.0 │   67.5 │   84.0 │   73.5 │   81.5 │   67.0 │   73.0 │  
│   2158 │   5325 │  2043 │     2765 │  489.5 │  562.5 │         │ 13班    │ … │   97.5 │  102.5 │   84.5 │   91.0 │   87.0 │   67.5 │   65.0 │   57.0 │  
│   2234 │   1425 │  2625 │     1441 │  547.5 │  550.0 │         │ 10班    │ … │   96.5 │  111.5 │   79.5 │   82.5 │   82.5 │   79.0 │   81.0 │   82.0 │  
│   2240 │   3834 │  2129 │     2829 │  507.5 │  560.5 │         │ 12班    │ … │  101.5 │  105.0 │   70.0 │   95.5 │   77.5 │   65.5 │   66.0 │   58.5 │  
│   2255 │   2810 │  2145 │     2352 │  521.5 │  560.0 │         │ 14班    │ … │  124.0 │   98.0 │   86.0 │   79.0 │   77.0 │   74.0 │   71.5 │   58.0 │  
│   2334 │   2092 │  2213 │     2135 │  534.0 │  558.5 │         │ 13班    │ … │   98.5 │  111.0 │   62.5 │   82.0 │   91.0 │   82.0 │   68.0 │   61.0 │  
├────────┴────────┴───────┴──────────┴────────┴────────┴─────────┴─────────┴───┴────────┴────────┴────────┴────────┴────────┴────────┴────────┴────────┤  
│ 20 rows                                                                                                                        23 columns (16 shown) │  
└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  
```  
6、假设选文科:    
```  
select * from (  
  select row_number() over (order by case when li_rn - wen_rn >= 500 then wen_rn+500 when abs(li_rn - wen_rn) <= 100 then wen_rn-300 else wen_rn end) as wen_rn1 , * from (  
    select * from (  
      select   
        row_number() over (order by coalesce("语文",0)+coalesce("数学",0)+coalesce("英语",0)+coalesce("政治",0)+coalesce("历史",0)+coalesce("地理",0) desc nulls last) as wen_rn,   
        row_number() over (order by coalesce("语文",0)+coalesce("数学",0)+coalesce("英语",0)+coalesce("物理",0)+coalesce("化学",0)+coalesce("生物",0) desc nulls last) as li_rn,   
        "总分排名",   
        coalesce("语文",0)+coalesce("数学",0)+coalesce("英语",0)+coalesce("政治",0)+coalesce("历史",0)+coalesce("地理",0) as wen,  
        coalesce("语文",0)+coalesce("数学",0)+coalesce("英语",0)+coalesce("物理",0)+coalesce("化学",0)+coalesce("生物",0) as li,  
        COLUMNS(* EXCLUDE ("总分排名", "准考证号", "自定义考号")) from st_read('/Users/digoal/Downloads/总分.xlsx', layer='Sheet1')   
    ) t  
  ) t  
) t  
where "学校"='杭州市余杭中学' order by wen_rn1 limit 20;   
┌─────────┬────────┬───────┬──────────┬────────┬────────┬──────────┬─────────┬───┬────────┬────────┬────────┬────────┬────────┬────────┬────────┬────────┐  
│ wen_rn1 │ wen_rn │ li_rn │ 总分排名 │  wen   │   li   │   姓名   │  班级   │ … │  数学  │  英语  │  物理  │  化学  │  生物  │  政治  │  历史  │  地理  │  
│  int64  │ int64  │ int64 │  int32   │ double │ double │ varchar  │ varchar │   │ double │ double │ double │ double │ double │ double │ double │ double │  
├─────────┼────────┼───────┼──────────┼────────┼────────┼──────────┼─────────┼───┼────────┼────────┼────────┼────────┼────────┼────────┼────────┼────────┤  
│     591 │    698 │   944 │      814 │  570.5 │  595.0 │          │ 13班    │ … │   99.0 │  127.5 │   75.5 │   87.5 │   88.0 │   79.0 │   74.5 │   73.0 │  
│     803 │    966 │  1303 │      969 │  561.0 │  582.0 │          │ 14班    │ … │  119.5 │  108.5 │   84.0 │   87.0 │   81.0 │   77.0 │   85.0 │   69.0 │  
│    1358 │   1829 │  1763 │     1717 │ 539.25 │  569.0 │          │ 14班    │ … │  102.0 │  123.0 │   68.0 │   90.0 │   85.5 │  81.25 │   73.5 │   59.0 │  
│    1468 │   1948 │  1917 │     1700 │  537.0 │  565.0 │    xxx   │ 14班    │ … │  108.5 │  105.5 │   81.0 │   87.0 │   78.0 │   78.5 │   63.5 │   76.0 │  
│    1478 │   1155 │  2755 │     1190 │  555.0 │  547.0 │          │ 11班    │ … │   74.0 │  119.0 │   76.5 │   90.0 │   81.5 │   86.0 │   85.0 │   85.0 │  
│    1515 │   1994 │  2050 │     1417 │  536.0 │  562.0 │          │ 11班    │ … │  100.5 │   97.5 │   76.0 │   89.5 │   91.5 │   73.0 │   80.0 │   78.0 │  
│    1535 │   1221 │  3101 │     1802 │  553.5 │  540.5 │          │ 8班     │ … │   88.5 │  118.0 │   61.0 │   87.0 │   78.0 │   83.0 │   85.0 │   71.0 │  
│    1598 │   1794 │  2272 │     2352 │  540.0 │  557.0 │          │ 12班    │ … │   91.5 │  129.5 │   54.0 │   91.5 │   78.0 │   72.0 │   69.5 │   65.0 │  
│    1611 │   1309 │  3810 │     2528 │  551.0 │  527.0 │          │ 13班    │ … │  107.5 │  104.0 │   53.0 │   78.0 │   77.0 │   83.5 │   78.5 │   70.0 │  
│    1688 │   1396 │  2507 │     2016 │  548.5 │  552.0 │          │ 13班    │ … │   93.5 │  128.0 │   67.5 │   84.0 │   73.5 │   81.5 │   67.0 │   73.0 │  
│    1690 │   1397 │  5033 │     3316 │  548.5 │  507.5 │          │ 11班    │ … │   84.0 │  120.5 │   53.5 │   69.5 │   67.5 │   78.0 │   77.5 │   76.0 │  
│    1693 │   1899 │  1339 │     1424 │  538.0 │  581.0 │          │ 11班    │ … │   95.0 │  117.5 │   77.5 │   90.0 │   87.0 │   72.5 │   73.0 │   66.0 │  
│    1717 │   1425 │  2625 │     1441 │  547.5 │  550.0 │          │ 10班    │ … │   96.5 │  111.5 │   79.5 │   82.5 │   82.5 │   79.0 │   81.0 │   82.0 │  
│    1875 │   2092 │  2213 │     2135 │  534.0 │  558.5 │          │ 13班    │ … │   98.5 │  111.0 │   62.5 │   82.0 │   91.0 │   82.0 │   68.0 │   61.0 │  
│    1940 │   2165 │  1111 │     1606 │  532.5 │  589.0 │          │ 14班    │ … │  109.0 │  125.5 │   84.5 │   90.5 │   79.0 │   63.5 │   71.0 │   63.0 │  
│    1948 │   1669 │  5248 │     3316 │  542.5 │  505.0 │          │ 7班     │ … │   80.0 │  124.5 │   55.5 │   66.0 │   75.0 │   73.5 │   88.5 │   72.0 │  
│    1967 │   1689 │  2291 │     1785 │  542.0 │  556.5 │          │ 11班    │ … │  103.5 │  106.5 │   72.5 │   89.0 │   76.5 │   75.0 │   81.5 │   67.0 │  
│    1971 │   1691 │  2809 │     2044 │  542.0 │  546.0 │          │ 11班    │ … │   96.0 │  116.5 │   62.5 │   85.5 │   82.5 │   79.0 │   68.5 │   79.0 │  
│    1993 │   2213 │  1716 │     1495 │  531.5 │  570.5 │          │ 10班    │ … │  106.0 │  104.0 │   75.0 │   93.0 │   90.5 │   86.5 │   63.0 │   70.0 │  
│    2029 │   2249 │  2385 │     1868 │  531.0 │  554.5 │          │ 13班    │ … │   76.5 │  126.0 │   76.5 │   83.0 │   87.0 │   79.5 │   72.5 │   71.0 │  
├─────────┴────────┴───────┴──────────┴────────┴────────┴──────────┴─────────┴───┴────────┴────────┴────────┴────────┴────────┴────────┴────────┴────────┤  
│ 20 rows                                                                                                                          23 columns (16 shown) │  
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘  
```  
实际排名采用文理赋分的方式进行排名, 以上方法未考虑赋分, 未考虑其他人的选择. 但是大致逻辑没毛病.   
其他建议阅读:
- [《德说-第215期, 和ChatGPT聊一聊, 高考如何选择专业? 大学如何修炼出师? 毕业如何终身成长?》](../202303/20230331_09.md)  
- [《德说-第227期, 致大学生的入学第一课, 如何从大一开始就为就业做正确的事情?》](../202305/20230513_01.md)  
- [《德说-第224期, 如何启发小孩的创新思维? 为什么以往中国本土理科诺贝尔奖偏少?》](../202304/20230421_01.md)  