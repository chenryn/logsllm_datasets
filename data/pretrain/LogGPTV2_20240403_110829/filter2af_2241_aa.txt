**原文链接：[Against U.S. Utilities Sector Returns with New
Malware](https://www.proofpoint.com/us/blog/threat-insight/ta410-group-behind-lookback-attacks-against-us-utilities-sector-returns-new "Against U.S.
Utilities Sector Returns with New Malware")**  
**译者：知道创宇404实验室翻译组**
去年8月，Proofpoint研究人员发现LookBack恶意软件在该年7月至8月间针对美国公用事业部门发起了网络攻击。通过分析8月21日至29发起的活动发现，这些攻击活动还利用恶意宏向美国各地的攻击目标发送恶意软件。与此同时，研究人员还发现了一个全新的恶意软件家族FlowCloud，这个家族也被交付给了美国的公用事业提供商。
像LookBack这样的FlowCloud恶意软件可以使攻击者完全控制受感染的系统。它的远程访问木马（RAT）功能包括访问已安装的应用程序、键盘、鼠标、屏幕、文件和服务进程，并通过这些命令控制来泄露信息。
通过观察2019年7月至11月间的网络钓鱼活动，基于威胁参与者使用共享附件宏、恶意软件安装技术和重叠交付基础结构我们可以确定LookBack和FlowCloud恶意软件都归因于我们称为TA410的威胁参与者。
此外，我们还发现TA410和TA429（APT10）之间的相似之处。具体来讲，他们之间有共同的附件宏，而且2019年11月检测到的TA410活动中还包括网络钓鱼附件传递宏中使用的与TA429（APT10）相关的基础结构。但是，Proofpoint分析师认为，黑客们可能是在故意使用TA429（APT10）技术和基础架构来进行虚假标记。因此，在进行研究时我们不会将LookBack和FlowCloud活动归因于TA429（APT10）。
下图显示了所标识的LookBack和FlowCloud活动的时间表。
## 发现
从2019年7月10日开始，研究人员观察到了钓鱼活动，这些活动以美国各地的公用事业供应商为目标，带有 Portable Executable
安全(PE)附件，并使用了类似“PowerSafe能源教育课程(30天试用期)”这样的主题，这些活动一直持续到2019年9月。
针对这些钓鱼活动，我们经过分析确定发现PE附件传递了一个模块化的恶意软件，我们称这些活动为“FlowCloud”。
值得注意的是，这些FlowCloud活动与Proofpoint先前记录的攻击活动是同时发生的。Flowcloud 和
LookBack这两个活动都针对的是美国的公用事业供应商，两者都使用以培训和认证为主题的诱饵，两者都使用黑客控制的域进行传递。在某些情况下，FlowCloud
和 LookBack 活动不仅针对同一家公司，而且针对同一个收件人。
从2019年11月发动攻击开始，我们观察到FlowCloud交付策略的显着变化。目标即美国公用事业公司保持不变，但是攻击者从PE附件转移到了载有大量恶意宏的Microsoft
Word文档。
此外，攻击者们从11月开始使用域名asce[.email]传递这些附件。该域于2019年6月首次注册到IP103.253.41[.]
75([ZoomEye搜索结果](https://www.zoomeye.org/searchResult?q=103.253.41.75
"ZoomEye搜索结果")），在先前的LookBack活动中用作登台和侦察IP。在2019年10月29日，该域名解析为IP134.209.99[.]169
[（ZoomEye搜索结果）](https://www.zoomeye.org/searchResult?q=134.209.99.169
"ZoomEye搜索结果")，其还涉及了一些能源认证和教育主题领域。这些域中的许多域还与2019年7月和8月FlowCloud网络钓鱼活动中先前观察到的传递域共享SSL证书。如下图所示，该图演示了参与者将单个SSL证书用于多个能量和培训领域。参与者在“备用名称”字段中列出了由证书签名的域，以便标识其他相关基础结构。FlowCloud活动中使用了许多此类域。
下表显示了TA410分段IP，在首次被观察时，与它们关联的注册域以及源自这些域的电子邮件所传递的恶意软件。
2019年11月活动中的电子邮件内容冒充了美国土木工程师学会，并被伪装成合法的域asce[.]org。该电子邮件的结构与为在2019年7月模拟NCEES和全球能源认证构造的LookBack电子邮件非常相似。下图是相关邮件示例：
## 开发-安装宏
如上所述，长时间使用PE附件在活动中交付FlowCloud之后，FlowCloud背后的攻击者在2019年11月开始转向使用带有恶意宏的Microsoft
Word文档。Word文档附件和交付FlowCloud的宏具有相似之处。通过Word文档附件和宏，我们确定在2019年7月至8月交付了LookBack。
与LookBack所使用的方法相同，FlowCloud宏使用了增强隐私的邮件（“.pem”）文件，这些文件随后被重命名为“pense1.txt”。接下来，将此文件另存为“gup.exe”的可执行文件，并使用名为“Temptcm.tmp”的certutil.exe工具版本执行。
相比之下，2019年11月5日用于安装 FlowCloud 恶意软件的宏显示了用于安装 FlowCloud 的宏，而2019年8月6日用于安装
LookBack 恶意软件的宏显示了用于安装 LookBack 的宏。
本文中LookBack恶意软件针对美国公用事业部门，模拟工程许可委员会对LookBack所使用的这种方法进行了更深入的说明。FlowCloud使用完全相同的宏连接代码的相同方法。
虽然我们发现两个宏版本的LookBack
Gup代理工具和FlowCloud恶意软件的最终执行方法相同，但FlowCloud宏却引入了一种新的恶意软件传递方法。
宏的早期LookBack版本将有效负载隐藏在电子邮件（“.pem”）文件中，这些文件在用户点击附件时被删除。宏的FlowCloud版本利用之前未被观察到的部分从DropBox
URL下载有效负载。在下载有效负载后，以.pem文件形式的FlowCloud恶意软件PE会保存为变量“Pense1.txt”。如下图所示：
宏还包含一个奇怪的 try..catch 语句，该语句最初试图从DropBox
URL下载FlowCloud有效负载来作为try语句的一部分。但是如果无法从该资源中检索有效负载，那么一个与try语句类似的catch语句将试图从URL
http://ffca.caibi379[.]com/rwjh/qtinfo.txt”.” 中检索资源. 下图显示有问题的代码语句。
这个try... catch序列意义重大，因为catch语句和恶意软件资源中的URL在“[Uncovering New Activity by
APT10](https://www.fortinet.com/blog "Uncovering New Activity by
APT10")”文章中普及。该文章称这个URL提供了一个修改过的Quasar
RAT有效载荷，而且其中包括了SharpSploit（一个开源的后开发工具），当分析在同一天的FlowCloud活动投放时，此URL资源不可用，而DropBox的URL则成功交付了FlowCloud.Pem文件。尽管Proofpoint尚未独立验证其他研究人员针对参考的Quasar
RAT样本所作的这些归因声明，但这个
URL的使用代表了以前未披露的与TA429(APT10)公开报道的IoCS的重叠。虽然表面上该域可能暗示链接到TA429（APT10），但我们发现了与域注册信息和URL的非活动性质有关的若干异常，下文也将详细阐述。