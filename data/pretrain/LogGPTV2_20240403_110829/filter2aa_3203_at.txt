manually configured routes for subnet 3 (131.107.24/0/8) and for the rest of the intranet (10.0.0.0/8). 
To route packets from subnet 2 and 3 to the rest of the intranet, the routing table for Router B must 
include manually configured routes for subnet 1 (131.107.8.0/24) and for the rest of the intranet 
(10.0.0.0/8). 
To route packets from subnet 3 and the rest of the intranet to subnets 1 and 2, the routing table for the 
RIP router must include manually configured routes for subnet 1 (131.107.8.0/24) and subnet 2 
(131.107.16.0/8). 
Figure 5-6  Integrating static and dynamic routing 
The routing tables in Figure 5-6 do not show the routes for directly attached subnets or other routes 
learned by the RIP router. 
Chapter 5 – IP Routing 
TCP/IP Fundamentals for Microsoft Windows  
Page: 133 
IPv4 Route Aggregation and Summarization 
Routing protocols can propagate the individual routes for each subnet on an IPv4 network to each 
router. However, when a network grows very large with hundreds or thousands of subnets, you might 
need to configure your routers or routing protocols to advertise aggregate or summarized routes, rather 
than all of the routes within a region of your network. 
For example, a specific site of a large private network uses the subnets 10.73.0.0/24 to 10.73.255.0/24 
(up to 256 subnets). Rather than having the routers at the edge of the site advertise up to 256 routes, 
you can configure them to instead advertise a single route: 10.73.0.0/16. This single route summarizes 
the entire address space used by the site.  
Figure 5-7 shows an example of how routes can be summarized at various sites of an organization 
intranet. 
Figure 5-7  Example of summarizing routes 
The advantage of summarizing the address space of the site is that only a single route must be 
advertised outside the site, lowering the number of routes in the routing tables of routers outside the 
site. Another advantage is that the rest of the IPv4 network is protected from route flapping, which is the 
propagation of routing updates when networks become available or unavailable. The disadvantage to 
route summarization is that traffic destined to unreachable addresses within the summarized address 
space crosses more routers before being discarded.  
Chapter 5 – IP Routing 
TCP/IP Fundamentals for Microsoft Windows  
Page: 134 
For example, if the 10.73.252.0/24 address prefix was not assigned to any subnet (it was an address 
prefix reserved for a future subnet) and the routers on the edge of the site advertised the 10.73.0.0/16 
address prefix, then traffic destined to 10.73.252.19 would be forwarded all the way to the routers at the 
edge of the site before being discarded. If the address space of the site was not summarized and the 
individual routes for the subnets of the site were propagated to all the routers of the IPv4 network, the 
router on the sending host's subnet would discard the traffic. 
RIP, OSPF, and BGP-4 support route summarization. You can also summarize when configuring static 
routes. 
Route Summarization for Internet Address Classes: Supernetting 
With the recent growth of the Internet, it became clear to the Internet authorities that the class B 
address prefixes would soon be depleted. For most organizations, a class C address prefix does not 
contain enough host IDs, and a class B address prefix has enough bits to provide a flexible subnetting 
scheme within the organization. 
To prevent the depletion of class B address prefixes, the Internet authorities devised a new method of 
assigning address prefixes. Rather than assigning a class B address prefix, the Internet Corporation for 
Assigned Names and Numbers (ICANN) assigns a range of class C address prefixes that contain 
enough network and host IDs for the organization’s needs. This was known as supernetting, a route 
summarization technique for class C address prefixes on the Internet. For example, rather than 
allocating a class B address prefix to an organization that has up to 2,000 hosts, ICANN allocates a 
range of eight class C address prefixes. Each class C address prefix accommodates 254 hosts, for a 
total of 2,032 host IDs. 
Although this technique helps conserve class B address prefixes, it creates a different problem. Using 
class-based routing techniques, the routers on the Internet must have eight class C address prefix 
entries in their routing tables to route IP packets to the organization. To prevent Internet routers from 
becoming overwhelmed with routes, a technique called Classless Inter-Domain Routing (CIDR) is used 
to collapse multiple address prefix entries into a single entry corresponding to all of the class C address 
prefixes allocated to that organization. 
For example, to express the situation where eight class C address prefixes are allocated starting with 
address prefix 220.78.168.0: 
The starting address prefix is 220.78.168.0, or 11011100 01001110 10101000 00000000 
The ending address prefix is 220.78.175.0, or 11011100 01001110 10101111 00000000 
Note that the first 21 bits (bolded) of all the above Class C address prefixes are the same. The last 
three bits of the third octet vary from 000 to 111. The CIDR entry in the routing tables of the Internet 
routers becomes 220.78.168.0/21, or 220.78.168.0, 255.255.248.0 in subnet mask notation. 
A block of addresses using CIDR is known as a CIDR block. Because prefix lengths are used to 
express the count, class-based address prefixes must be allocated in groups corresponding to powers 
of 2. 
To support CIDR, routers must be able to exchange routing information in the form of [Prefix, Prefix 
Length or Subnet Mask] pairs. RIP for IP version 2, OSPF, and BGP-4 support CIDR, but RIP for IP 
version 1 does not. 
Chapter 5 – IP Routing 
TCP/IP Fundamentals for Microsoft Windows  
Page: 135 
On today's Internet, the term "supernetting" is obsolete. Because the Internet no longer uses Internet 
address classes, distinguishing a block of Class C address prefixes as a supernetted address prefix is 
no longer necessary. Instead, organizations are assigned an address space without regard to the 
original Internet address class to which the address space originated. The address space is the 
summarized route for all the public addresses within the organization, whether the organization decides 
to subnet or not. 
IPv4 Routing Support in Windows 
Windows Server 2003 supports both static and dynamic IPv4 routing. Windows XP supports only static 
IPv4 routing. 
Static Routing 
You can enable static routing through the following: 
The IPEnableRouter registry entry 
The Routing and Remote Access service 
For computers running Windows Vista, Windows XP, Windows Server 2008, or Windows Server 2003, 
you can enable static IPv4 routing by setting the 
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\ Services\Tcpip\Parameters\IPEnableRouter 
registry entry to 1 (data type is REG_DWORD). Editing the registry is necessary only for computers 
running Windows Vista or Windows XP.  
For computers running Windows Server 2008 or Windows Server 2003, you should use the Routing 
and Remote Access service to enable IPv4 routing rather than setting the IPEnableRouter registry 
entry. To run the Routing and Remote Access Server Setup Wizard, do the following: 
1. In the console tree of the Routing and Remote Access snap-in, right-click the server you want to 
enable, and then click Configure And Enable Routing and Remote Access.  
2. Follow the instructions in the Routing and Remote Access Server Setup Wizard.  
To enable simple IPv4 routing, choose Custom Configuration on the Configuration page and LAN 
Routing on the Custom Configuration page of the Routing and Remote Access Server Setup Wizard. 
Dynamic Routing with RIP and OSPF 
You can enable dynamic routing through the Routing and Remote Access service. To do so, first 
configure and enable the Routing and Remote Access service as described in the previous section. 
Then configure RIP or OSPF routing by adding the RIP and OSPF routing protocol components and 
adding and configuring interfaces on which they are enabled. OSPF is not supported in Windows 
Server 2008 
For more information about configuring RIP and OSPF routing, see the Help and Support in Windows 
Server 2008 and Windows Server 2003. 
Configuring Hosts for IPv4 Routing 
IPv4 hosts can use the following methods to reach remote destinations: 
Chapter 5 – IP Routing 
TCP/IP Fundamentals for Microsoft Windows  
Page: 136 
Store a host-specific route to each remote destination. This method is obviously not practical or 
possible, because the routing table might have to contains thousands or, in the case of the Internet, 
millions of routes. The host routing table would have to change as addresses were added or removed. 
Store a route to each remote subnet. Although more possible, this method is also not practical, because 
the routing table would still have to contain possibly hundreds or, in the case of the Internet, tens of 
thousands of routes. The host routing table would have to change as subnets were added or removed. 
Store a single default route that effectively summarizes all of the locations that are not located on the 
local subnet. This method is possible and practical. Only a single route is needed and does not need to 
change for nodes or subnets that are added or removed from the network. 
By using a default route, the knowledge of the topology of the network and the set of reachable 
destinations is offloaded to the routers, rather than being a responsibility of the sending host. The 
advantage to this method is ease of configuration.  
The default gateway setting, which creates the default route in the IPv4 routing table, is a critical part of 
the configuration of a TCP/IP host. The role of the default gateway is to provide the host with that next-
hop IPv4 address and interface for all destinations that are not located on its subnet. Without a default 
gateway, communication with remote destinations is not possible, unless additional routes are added to 
the IPv4 routing table. 
Default Gateway Setting 
You can configure a default gateway on a computer running Windows in the following ways: 
When IPv4 obtains an address configuration using DHCP, the default gateway becomes the value of 
the first IPv4 address in the Router DHCP option. A network administrator configures this option on the 
DHCP server to specify an ordered list of one or more default gateways. 
When the user specifies an alternate IPv4 address configuration, the default gateway is the IPv4 
address typed in Default Gateway on the Alternate Configuration tab for the properties of the Internet 
Protocol Version 4 (TCP/IPv4) or Internet Protocol (TCP/IP) component in Network Connections. You 
can specify only a single default gateway. 
When the IPv4 address configuration is manually specified, the default gateway is the IPv4 address 
typed in Default Gateway on the General tab for the properties of the Internet Protocol Version 4 
(TCP/IPv4) or Internet Protocol (TCP/IP) component. To specify multiple default gateways, you must 
add them from the IP Settings tab in the advanced properties dialog box of the Internet Protocol 
Version 4 (TCP/IPv4) or Internet Protocol (TCP/IP) component.  
When the IPv4 address configuration is obtained using Automatic Private IP Addressing (APIPA), a 
default gateway is not configured. APIPA supports only a single subnet. 
The configuration of a default gateway creates a default route in the IPv4 routing table. The default 
route has a destination of 0.0.0.0 with a subnet mask of 0.0.0.0. In prefix length notation, the default 
route is 0.0.0.0/0, which is sometimes abbreviated to 0/0. The next-hop address, also known as the 
Gateway address in the display of the route print command, is set to the IPv4 address of the default 
gateway. The next-hop interface is the interface assigned the IPv4 address in the Interface column in 
the display of the route print command. 
Chapter 5 – IP Routing 
TCP/IP Fundamentals for Microsoft Windows  
Page: 137 
Based on the route determination process, the default route matches all destinations. If no other route 
matches the destination more closely, IPv4 uses the default route to determine the next-hop address 
and interface. Default route traffic is traffic destined to a remote network but that is forwarded to the 
default gateway (rather than traffic destined for the default gateway's IPv4 address). 
Default Route Metric 
TCP/IP for Windows by default automatically calculates a metric for the default route that is based on 
the speed of the adapter to which the default gateway is configured. For example, for a 100 megabit per 
second (Mbps) Ethernet adapter, the default route metric is set to 20. For a 10 Mbps Ethernet adapter, 
the default route metric is set to 30. 
To override this behavior for DHCP-assigned default gateways, use the Default Router Metric Base 
Microsoft-specific DHCP option, specifying Microsoft Windows 2000 Options as the vendor class. To 
override this behavior for manually configured default gateways, open the advanced properties dialog 
box for the Internet Protocol Version 4 (TCP/IPv4) or Internet Protocol (TCP/IP) component, click the IP 
Settings tab, and then clear the Automatic metric check box on the TCP/IP Gateway Address dialog 
box for the configured default gateways. Figure 5-8 shows the TCP/IP Gateway Address dialog box. 
Figure 5-8  The TCP/IP Gateway Address dialog box 
ICMP Router Discovery 
ICMP Router Discovery provides an alternate method of configuring and detecting default gateways. 
Instead of obtaining a default gateway configuration manually or using DHCP, IPv4 can also 
dynamically discover the routers on a subnet. If the primary router fails, hosts can automatically switch 
to a backup router. When a host that supports router discovery initializes, it joins the all-systems IP 
multicast group (224.0.0.1) and then listens for the Router Advertisement messages that routers send 
to that group. Hosts can also send Router Solicitation messages to the all-routers IP multicast address 
(224.0.0.2) when an interface initializes to be configured immediately. 
TCP/IP for Windows supports sending ICMP router solicitations and receiving ICMP router 
advertisements, known as host-side router discovery. This capability is disabled by default and can be 
enabled if you are using DHCP and the Perform Router Discovery DHCP option.  
The Routing and Remote Access service in Windows Server 2008 and Windows Server 2003 supports 
sending ICMP router advertisements, known as router-side router discovery. To enable router-side 
ICMP router discovery, do the following: 
1. In the console tree of the Routing and Remote Access snap-in, open Routing and Remote Access, 
IP Routing or IPv4, and then General. 
2. In the details pane, right-click the interface that you want to enable, and then click Properties.  
3. On the General tab, select the Enable router discovery advertisements check box, and configure 
Chapter 5 – IP Routing 
TCP/IP Fundamentals for Microsoft Windows  
Page: 138 
additional settings as needed.  
Static Routes 
The Route tool adds entries to the IPv4 routing table. You can add entries for hosts or networks, and 
you can use IPv4 addresses or aliases. If you use aliases to specify hosts or gateways, the alias name 
is looked up in the Hosts file. If you use an alias to specify an address prefix, the alias name is looked 
up in the Networks file. Both of these files are in the %systemroot%\System32\Drivers\Etc folder. 
The following are examples of how to use the Route tool to add entries to the host IPv4 routing table. 
Example of adding an entry corresponding to a host IPv4 address: 
route add 131.107.24.192 mask 255.255.255.255 131.107.1.1 
or 
route add 131.107.24.192 mask 255.255.255.255 router1 
in which the Hosts file has the entry: 
131.107.1.1 
router1 
Example of adding an entry corresponding to an address prefix: 
route add 131.107.3.0 mask 255.255.255.0 131.107.1.2 
or 
route add network3 mask 255.255.255.255 131.107.1.2 
in which the Networks file has the entry: 
network3  
131.107.3.0 
Persistent Static Routes 
Because the IPv4 routing table is maintained in memory, the table must be rebuilt every time the node 
is restarted. To maintain static routes that are not based on the node's configuration when Windows is 
restarted, the Route tool supports the -p option. The -p option makes the route persistent by storing it in 
the registry at the following location:  
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\TCPIP\PersistentRoutes 
RIP Listener 
RIP Listener is an optional networking component that you can install through the Programs and 
Features item of Control Panel on computers running Windows Vista or the Add or Remove Programs 
item of Control Panel on computers running Windows XP Professional. When installed, the RIP Listener 
service listens for RIP v1 and RIP v2 traffic and uses the received RIP messages to update its IPv4 
routing table. A computer using the RIP Listener service is known as a silent RIP host. 
Routing for Disjoint Networks 
If you have multiple interfaces and you configure a default gateway for each interface, the default route 
metric, which is based on the speed of the interface, causes your fastest interface to be used for default 
route traffic. This behavior might be desirable in some configurations in which the computer has 
multiple adapters that are connected to the same network. For example, if you have a 100 Mbps 
Chapter 5 – IP Routing 
TCP/IP Fundamentals for Microsoft Windows  
Page: 139 
Ethernet adapter and a 10 Mbps Ethernet adapter connected to the same organization intranet, you 
would want the default route traffic to be sent using the 100 Mbps adapter. 
However, this default behavior might be a problem when the computer is connected to two or more 
disjoint networks (networks that do not provide symmetric reachability at the Network layer). Symmetric 
reachability exists when packets can be sent to and received from an arbitrary destination. For 
example, the Ping tool tests for symmetric reachability. 
Examples of disjoint networks are the following: 
Networks that have no Network layer connectivity, such as an organization intranet and a test lab that 
have no IPv4 router forwarding packets between them. A computer can be connected to both networks, 
but if no routes reach both networks and the computer connecting them is not forwarding packets, the 
two networks are disjoint. 
A privately addressed intranet that has a routed connection to the Internet. This configuration offers 
asymmetric or one-way reachability. Intranet hosts can send packets to Internet hosts from private IPv4 
addresses, but the return traffic cannot be delivered because routes for the private address space do 
not exist in the routing infrastructure of the Internet. 
Connectivity to disjoint networks is important when organizations use the following: 
Either a proxy server, such as Microsoft Internet Security and Acceleration (ISA) Server, or a network 
address translator (NAT) to connect their private intranets to the Internet. In either case, the address 
space of the intranet is not directly accessible to Internet hosts, regardless of whether the organization 
is using private or public addressing. Intranet hosts can access Internet locations indirectly through 
proxy or translation, but Internet hosts cannot access arbitrary intranet locations directly. Therefore, 
there is no symmetric reachability. This configuration is common for organizations that offer Internet 
connectivity to their employees.  
A virtual private networking (VPN) server to allow remote users or remote sites to connect to a private 
intranet over the Internet. Although the VPN server is connected to both the Internet and a private 
intranet and is acting as a router, the configuration of packet filters on the Internet interface prevents it 
from accepting anything but VPN-based traffic. Internet hosts cannot directly reach intranet locations 
without an authenticated VPN connection. 
Because the TCP/IP protocol uses only a single default route in the routing table at any one time for 
default route traffic, you can obtain undesirable results when default gateways are configured on 
multiple interfaces that are connected to disjoint networks.  
For the examples of the ISA or VPN server, the default route traffic is forwarded either to the Internet or 
the intranet but not both. From the ISA or VPN server, all the locations on either the Internet or the 
intranet are reachable, but you cannot reach both at the same time. However, ISA or VPN servers 
require simultaneous symmetric reachability for all the locations on both the Internet and the intranet to 
operate properly.  
When default gateways are configured on multiple interfaces, the default route that IPv4 chooses for 
current use is based on the following: 