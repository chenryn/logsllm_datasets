title:Messy States of Wiring: Vulnerabilities in Emerging Personal Payment
Systems
author:Jiadong Lou and
Xu Yuan and
Ning Zhang
Messy States of Wiring: Vulnerabilities in 
Emerging Personal Payment Systems
Jiadong Lou and Xu Yuan, University of Louisiana at Lafayette; 
Ning Zhang, Washington University in St. Louis
https://www.usenix.org/conference/usenixsecurity21/presentation/lou
This paper is included in the Proceedings of the 30th USENIX Security Symposium.August 11–13, 2021978-1-939133-24-3Open access to the Proceedings of the 30th USENIX Security Symposium is sponsored by USENIX.Messy States of Wiring: Vulnerabilities in Emerging Personal Payment Systems
Jiadong Lou, Xu Yuan ∗
University of Louisiana at Lafayette
Ning Zhang
Washington University in St. Louis
Abstract
This paper presents our study on an emerging paradigm of
payment service that allows individual merchants to lever-
age the personal transfer service in third-party platforms to
support commercial transactions. This is made possible by
leveraging an additional order management system, collec-
tively named Personal Payment System (PPS). To gain a bet-
ter understanding of these emerging systems, we conducted
a systematic study on 35 PPSs covering over 11740 mer-
chant clients supporting more than 20 million customers. By
examining the documentation, available source codes, and
demos, we extracted a common abstracted model for PPS and
discovered seven categories of vulnerabilities in the existing
personal payment protocol design and system implementa-
tion. It is alarming that all PPSs under study have at least one
vulnerability. To further dissect these potential weaknesses,
we present the corresponding attack methods to exploit the
discovered vulnerabilities. To validate our proposed attacks,
we conducted four successful real attacks to illustrate the se-
vere consequences. We have responsibly disclosed the newly
discovered vulnerabilities, with some patched after our report-
ing.
1 Introduction
Pervasive network connections in modern computing devices
are enabling the adoption of the online payment service as a
more convenient and safer method for monetary transactions.
Reports from eMarketer [20, 21] state that 1.06 billion people
are using a proximity mobile payment. Asia’s 577.4 million
proximity mobile payment users make up about half of that
total, largely due to rapid adoption in China. In recognition
of the growing market, there have been an increasing number
of mobile payment platforms designed to enable payments
among users without having to go through traditional methods
such as credit cards and checks, often reducing the risk to the
user in the case of information disclosure to the vendor. The
∗Corresponding author: Dr. Xu Yuan (PI:EMAIL)
well-known third-party platforms include but are not limited
to Alipay [2], Wexpay [10], Apple pay [4], Paypal [6], and
Venmo [8].
However, existing payment platforms have several limita-
tions. First, individual payment accounts on these platforms
are not designed to handle large volumes of transactions,
thereby there is a lack of scalable methods to automatically
associate orders with payment transactions. Second, while
there exist merchant accounts that can be registered on the
payment platforms to provide the aforementioned function-
alities, the barrier to entry is quite high for many small busi-
nesses. For example, it requires a government-issued license
(considerable delay in application) in China to get a merchant
account with Alipay. Lastly, there is also a non-trivial upfront
cost commitment to get started. Realizing these drawbacks,
a new form of payment management service has emerged
to serve as a broker between buyers and sellers, providing a
minimalist payment management system with signiﬁcantly
lower transaction fees and initial ﬁnancial commitment. They,
however, are not individual ﬁnancial institutions and do not
offer wallet functions. Instead, these payment management
systems rely on existing personal transfer services from third-
party platforms for actual money transfers. We refer to this
new paradigm of payment system as the personal payment
system (PPS).
Since this new payment system builds on top of the ex-
isting personal money transfer interface and has to involve
multiple rounds of complex interactions between different
entities in the ecosystem, security remains a challenging issue
for both the PPS and its users. Recognizing the role of pay-
ment systems in the digital economy, there have been several
studies analyzing and demonstrating security issues in both
web-based payment services [18,34,45,46,48,52] and in-app
payment services [25, 37, 54]. However, they have mainly
focused on commercial payment services, and little attention
has been given to the emerging PPS.
In this paper, we present our systematic analysis of the
emerging PPS where we dissect its design elements, ecosys-
tem, and potential vulnerabilities. The 35 PPSs under study
USENIX Association
30th USENIX Security Symposium    3273
offer both web and mobile app applications covering over
11740 merchant clients supporting more than 20 million cus-
tomers. By analyzing the technical documents and applica-
tions of these 35 PPSs, we abstract the common design pattern
of their payment systems and the corresponding business pro-
cesses. We found that all PPSs have ﬁve key components to
satisfy the essential business needs of their clients, namely
PPS enrollment and key distribution, order generation, order
payment, payment notiﬁcation, and order inquiry. We found
seven unique patterns of vulnerabilities that are common in
the majority of the studied PPSs. Of the ﬁve key components,
the majority of the vulnerabilities are within the order gen-
eration process. Based on the discovered vulnerabilities, we
designed and implemented ﬁve proof-of-concept attacks that
chain together multiple vulnerable patterns to demonstrate the
real-world threat. To minimize the impact on the real-world
systems, all experiments were designed to attack our own
test accounts, and we also reported the processes and results
to all vendors so that they could mitigate the impact of the
attacks. The ﬁnancial ramiﬁcations of the attacks are typically
mitigated by closure of the test accounts.
To mitigate the threat of these vulnerabilities, we conducted
a systematic analysis of the root causes and classiﬁed them
from different perspectives, such as protocol vs. implemen-
tation. With the analysis, we list 10 suggestions for PPS
providers, merchants, and the buyers who make payments.
Lastly, to ensure that the vendors had enough time to ﬁx
the vulnerabilities, we contacted them individually about the
vulnerabilities several months before the submission of this
manuscript. This allowed several vendors to ﬁnish patching
the reported vulnerabilities at the time of writing. We have
also disclosed the vulnerabilities to various security response
platforms, including Tencent security response center [7] and
Alibaba security response center [1].
In summary, we have made the following contributions in
this paper:
• We dissected the internals of a newly emerging paradigm
of payment system, the Personal Payment System (PPS),
and presented a common abstracted model of these new
payment systems.
• Based on our analysis of the PPS, we have discovered 7
vulnerable patterns and presented 5 new attacks methods
that exploit these vulnerable patterns.
• We conducted an empirical study to analyze the pay-
ment services from the 35 most widely used PPSs and
exposed the security issues corresponding to our discov-
ered 7 vulnerable patterns. Four real-world attacks on
the websites adopting the PPSs were also conducted to
demonstrate our discovered vulnerabilities.
• Following the practice of responsible disclosure, we have
reported all the discovered design ﬂaws and worked with
some vendors in ﬁxing these vulnerabilities.
• To mitigate these vulnerabilities, we have conducted a
root cause analysis and provided a discussion on how to
secure the ecosystem.
2 Personal Payment System
2.1 PPS Deﬁnition
Personal payment system is an emerging paradigm that cou-
ples personal money transfer functions provided by existing
third-party platforms with an order management platform
developed by a PPS provider. It allows individual small busi-
nesses to leverage personal ﬁnancial accounts registered in
third-party platforms to meet the demands of commercial
transactions without incurring signiﬁcant upfront costs. Due
to its low barrier of entry, these new systems have successfully
attracted a large number of merchants, especially startups and
small businesses.
Third-party payment platforms provide free personal
money transfer services, and each user can register a personal
account for sending money to or receiving money from oth-
ers. However, the personal transfer interface does not include
payment and order related management functionalities (e.g.,
recording the payment information and order status, moni-
toring the money ﬂow, informing merchants about payment
status). Therefore, it is often impossible to use these accounts
directly for commercial transactions. Recognizing this op-
portunity, PPS providers develop a payment management
platform to complement existing payment platforms. To use
the PPS platform, a merchant has to register an account on
the PPS system and link this account to an existing personal
account on a third-party payment system such as AliPay. The
PPS platform will work in the background to present to its
users a uniﬁed commercial-capable interface that supports
both payment and order tracking.
2.2 Personal Payment System v.s. Commer-
cial Payment System
While both the existing mainstream third-party commercial
payment systems (TP-CPS) and the PPS offer the ability to
manage transactions and payments at the commercial scale,
there are major differences between the ecosystems of the two.
The high level workﬂows of TP-CPS and PPS are summarized
in Figures 1(a) and 1(b), respectively.
In the TP-CPS, as shown in Figure 1(a), there are three
entities, i.e., merchant client (MC), merchant server (MS), and
cashier server (CS). MC is the merchant client, where users
can browse merchandise and make orders. MS is the merchant
server that hosts the client content. It is also responsible for
processing orders and conﬁrming payment statuses of orders.
The CS in a third-party platform manages money transactions
between different accounts, and offers the ability to track
payment status. With a commercial account on a third-party
3274    30th USENIX Security Symposium
USENIX Association
Third-party Platform
Cashier Server (CS)
Buyer Personal 
Account
Money  Flow
Merchant
Commercial Account
Third-party Platform
Cashier Server (CS)
Order Management Subsystem
Buyer Personal 
Account
Money  Flow
Merchant
Personal Account
Active Monitoring of 
Payment Information
Order Management Subsystem
Payment details
Payment + Order
details
Order Payment 
Status
Merchant PPS 
Account
Order details
PPS Order 
Management Platform 
(PMP)
Order Payment 
Status
Merchant Client 
(MC)
Merchant 
Server (MS)
Merchant Client 
(MC)
Merchant Server 
(MS)
(a) The transaction process in the TP-CPS.
(b) The transaction process in the PPS.
Figure 1: The transaction process in two payment paradigms
payment platform, order management is part of the service
and is tightly integrated. As a result, MC and MS only need
to interact with third-party systems to upload and obtain both
the payment and order status for an agreed upon fee.
On the other hand, for PPS, shown in Figure 1(b), a mer-
chant makes use of an independent order management system.
He/she also needs to register an account with the CS; how-
ever, the account is a personal account without the ability to
access the integrated order management system, and therefore
there is no commission fee imposed on the transactions. To
leverage the personal payment system for commercial trans-
actions, PPS provides a PPS Order Management Platform
(PMP), an additional platform offering the commercial pay-
ment functionalities traditionally provided by CS, such as
recording the transaction information, monitoring cash ﬂow
in the transaction, and verifying the order status.
The transaction ﬂow in PPS can be summarized as follows:
A merchant needs to register two accounts, one personal ac-
count at the third-party payment platform (i.e., CS) and a
merchant commercial account at the PMP. After the buyer
places an order, the payment information will be sent to the
CS while the order information is transmitted to the PMP.
When the contracted payment is made in the CS, the PMP
will then notify the MS to continue the order process. The
addition of an independent PMP in the order and payment
management process is the unique design element in this
ecosystem that avoids the transaction fee. To obtain payment
status, the merchant account at PMP has to keep monitoring
for the money transfer event at the CS.
2.3 PPS Abstracted Model
The abstracted model common to all PPSs is described in this
subsection, from the initial enrollment of the service to order
processing as well as order query.
2.3.1 Enrollment and Key Distribution/Update
Enrollment and initial key distribution - In order to use PPS,
a merchant needs to register for a personal account on the
third-party cashier server as well as a commercial account on
the payment management system in the PPS. After comple-
tion of the registration process of the merchant commercial
account on the PPS website, the enrollment process starts
with the initial key distribution. First, a unique key (hence-
forth referred to as KEY) is generated for each merchant
account. The KEY is distributed via the merchant account
web page on the PPS platform and can only be viewed via this
web portal. The initial KEY distribution process is protected
by common web-based security techniques using merchant
account authentication (i.e., logging in) at the PPS website.
Key update - While the initial key is only available via
the PPS website, it is also possible to request key renewals
subsequently and receive the updated keys via web APIs.
As a result, there are two ways PPS merchants can request
and receive key updates, via the PPS website or via a REST
API call. All the PPSs we studied support key update via
API. Furthermore, 88% of them do not require authentication.
More details can be found in section 3.1.
Common interface and order format - Almost all the PPSs
offer API-based payment service in some form. Speciﬁcs
about the order and the transacting parties are usually encap-
sulated in a JSON object sent through the order API (O-API).
Required ﬁelds often include order identiﬁer, payment URL,
price, merchant ID as well as the signature that aims to pro-
tect the integrity of the object. This signature is also widely
referred to as the Token in many of the user documents. Sur-
prisingly, we found all PPSs use the MD5 mechanism to
generate the Token (i.e., single MD5 or multi-layer MD5).
USENIX Association
30th USENIX Security Symposium    3275
M(cid:18)
MS
PMP
Order Generation
1. orderrq
3. orderp
Order Payment
4. orderp
7. Payment
Payment Notification
11. Payment
notification
2. Token=sign(...+KEY)
generate orderp
6. Personal account
10. Payment
notification
5.Token*=sign(...+KEY)
Token =? Token*
8. Money transfer
monitoring
9. Order
checking
Figure 2: The transaction ﬂow of PPS.
The input of MD5 is a string that concatenates all the related
order information (i.e., values in all ﬁelds) in an order packet
as well as the KEY. The ordering of all ﬁelds varies in differ-
ent PPSs. The most common approach is to order the ﬁelds
alphabetically.
receives multiple orders from one merchant with the
same price simultaneously, it might change the payment
amount by a tiny deviation on these orders so that PMP
can identify these orders by monitoring the paid amount.
6. The payment account information (i.e., the QR code of
the merchant’s personal account registered at the chosen
third-party platform) is sent to the MC.
7. The buyer pays the required amount to the merchant’s
personal account.
8. PMP monitors the merchant’s personal account for the
expected money ﬂow. The actual implementation of how
the PMP can monitor the personal account of the mer-
chant differs among the PPSs under our study. For exam-
ple, some of the PPSs monitor the ﬁnancial transactions