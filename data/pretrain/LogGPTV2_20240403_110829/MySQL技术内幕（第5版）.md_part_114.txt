口CREATE USER、DROP USER和RENAME USER。分别用于创建、删除和重命名MySQL
% mysql_update --password=rootpass
默认情况下，mysql_update需要以 root 用户身份连接本地服务器，因此在调用它时
有些MySQL版本引入了新的权限表或权限列，而这会改变它们的内部结构。当第一次在
账户。
必须像下面这样带着root的密码，然后重启服务器：
用当前版本之后发生的所有修改来升级这些权限表。
版本来说是最新的。如果把MySQL升级到一个更新的版本,则需要运行mysql_update,
机器上安装MySQL时，安装过程创建权限表所使用的结构对于你正安装的那个MySQL
第13章安全性与访问控制
proxies_priv
procs_priv
columns_priv
tables_priv
db
user
权限表
，用于指定账户权限（如果账户不存在，则创建它们）。
，如何创建和删除MySQL用户账户，如何实现权限的授权和撤销
因为在你描述好自己对各种访问权限所要进行的修改操作后，
使用像CREATEUSER和GRANT这样的账户管理语句，可以
表13-1MySQL权限表
代理用户权限
存储例程权限
列权限
表权限
数据库权限
可连接到服务器的那些用户，以及他们的全局性权限
内容
使
---
## Page 499
以将用户限制在该台主机上：
主机进行连接
才能完成的操作。
名字更改为 superduper，然后再用 superduper 身份连接服务器，执行各种需要超级用户权限
超级用户（它可以做任何事情）的名字root，也没什么特别的。你完全可以在权限表里把这个
么客户端程序将默认把登录名当作MySQL用户名，但这只是一种约定。关于那个被用作MySQL
Windows的登录名没有任何必然联系。在Unix里，如果连接服务器时没有显式指定用户名，那
的那个账户。
Host列，还会存入与该账户相关的其他权限表行中。
权限。服务器会将其中的 user_name 和host_hame值，存入该账户user 表行的 User 列和
分别建立一个独立的账户。MySQL允许你区别对待它们，并为每一个账户分配彼此毫无瓜葛的
什么地方进行连接。这意味着，可以为拥有相同名字、但会从不同位置连接服务器的两个用户，
13.2.1.1指定账户名
认证这个用户。更多与认证有关的信息请参考13.2.1.3节。
构成。更多与语法管理规则有关的信息请参考13.2.1.1节。
语句。
或 RENAME USER 语句。
13.2.1MySQL账户的高级管理
user_name'@'host_name'。
通过选择一个合适的 account值，便可以让用户从你想要的某个特定主机或者某个范围的
在 MySQL 里的用户名，仅仅是在连接服务器时用于表明身份的名字。它与Unix 或者
也可以把账户名指定为CURRENT_USER或CURRENT_USER（），它代表的是当前会话里使用
对第三个问题的回答取决于你是要为账户分配密码，还是要指定服务器使用其他的方法来
在创建新账户时，一般可以通过回答下面这几个问题来确定使用何种类型的CREATEUSER
CREATE USER
CREATE USER
对前面两个问题的回答可用于确定该语句里的那个account值。账户名由用户名和主机名
口如何进行用户认证？
口用户名是什么？
如果你拥有全局的CREATE USER权限，那么这三条语句就都可以使用。否则，
口
口RENAME USER语句。用于更改已有账户的名字：
口DROP USER语句。用于删除已有账户和所有与之关联的权限：
口CREATEUSER语句。用于创建新账户，并选择性地为它设置密码或授权方法：
使用下面三条语句可以对MySQL账户执行一些高级操作。
RENAME USER from_account To to_account;
这个用户能连接哪个或哪些主机？
DROPUSER 语句不会删除，这个被删账户可以访问到的那些数据库或其中的对象。
DROP USER aCcount;
CREATEUSER 语句不会分配权限，那是GRANT 语句分内的事情。
CREATE USER account [auth_info];
接。一种极端的情况是，如果你知道某个用户只会从某台主机进行连接，则完全可
'fred'@'ares.mars.net'
。在MySQL里，你不仅要指定谁可以连接，而且还要指定可以从
IDENTIFIED BY'Steam';
13.2管理MySQL用户账户
你必须拥有
479
---
## Page 500
作是一个合法的账户。发生的情况是，MySQL 将"boris@localhost‘整个解释为只包含用户
字符串引号，也可以使用标识符引号。用户名和主机名需要分开使用引号，例如，需要写月
引号引起来。如果它包含有像“_”或“%”这样的特殊字符，则必须将它用引号引起来。例如，
255.255.255.255。
的
255.255.255.0指
为带掩码（它指明哪些位
画
（使用%来指定主机，不
机名指示符时，其代表的是
设该用户的名字为max，
种极端的情况是，你的用户可能会经常出差，必须要从世界各地的不同主机连接到服务器。假
'bori's'@'localhost"，但是却将其误写成了‘boris@localhost’，那么MySQL也会将其兰
'max'@·%是相同的account值。这意味着，如果原本想要把某个账户设置
boris'@'localhost'，而不要写成'boris@localhost'。
号
对
11
指
能
是指客户端将要连接到哪台服务器主机(除非它们碰巧相同)。
480
是最保险的，本书的示例也都遵循这一原则。在给用户名和主机名加上引号时，既可以使月
寸于账户名boris@localhost，其用户名和主机名部分不使用引号也是合法的。不过，使用
为任何一台主机相匹配。
条语句指定的IP模式表示的是C类子网192.168.128。在第三条语句里，192.168.128.0/
旨定。对于I
从
配符
如果在指定账户时没有给出主机名部分，则等同于把主机名部分设置为%。因此，
你可以做到的最为严格的访问控制形式是，只允许用户从单台主机连接到服务器。而另一
对于IPv6主机值，除了不支持掩码以外，其他规则都类似。
CREATE USER'mary'@'%.example.com'IDENTIFIED BY'fog';
example.com域里的任意一
对于中间情况，
请注意，其中的主机名部分指的是客户端将要从它那里连接到服务器的那台主机。它并不
如是
口
口
上面第一条语句表明，用户只能从IP地址为192.168.128.3的那台主机连接服务器。第
CREATE
只要
另
其中，
账户名里使用主机名localhost，可以让用户从本地主机连接服务器。具体方式如下。
REATE
REATE
“%”
一个是LIKE
接；否则，所有连接的类型都是TCP/IP连接。如果服务器支持命名管道连接，那么用
类型为基于本地主机的IPv4或IPv6 环回接口的 TCP/IP连接。
或:：：1。对于1ocalhost，连接类型为Unix套接字文件。对于127.0.0.1或：：1，连接
在Unix.里，用户在进行连接时可以使用的主机值包括1ocalhost、127.0.0.1
愿意，
第13章
USER
IPv4主机值，
“”
USER
USER
或
，account
字符是一个通配符，其含义与LIKE模式匹配里的含义相同。因此，当%作为主
rex'@192.168.128.0/255.255.255.0IDENTIFIED BYice';
'ardis'@'192.168.128.%'
'joe'@'192.168.128.3 IDENTIFIED BY water';
安全性与访问控制
定了一个掩码，该掩码打开了前24位。它能与IP地址前24位为192.168.128
可以让用户只能从一组有限的主机连接服务器。例如，想让用户mary 只
通配符
有时也会
本
位可用于网络编号）的IP地址：
身，
，则可以使用如下语句让他在任何地方都能连接到服务器：
、可用的掩码值有255.0.0.0、255.255.0.0、255.255.255.0或
你可以指定为文字IP地址（一种包含模式字符的地址），也可以指定
值的主机部分还允许以IPv4或 IPv6地址（而非主机名）的形式进行
则需要在其前面加上一个反斜线字符进行转义。
（“")，它可以用在主机值里，匹配任意单个字符。如果需要指定
会导致一些令人头疼的问题，具体原因详见13.4.4节。）
“任意主机”。这是最简单的用户设置方式，但它也是最不安全的。
台主机连接服务器，则需要把主机名指定为%.example.com：
IDENTIFIED BY
'snow
127.0.0.1
与xew,
为
户
当
成
用
引
---
## Page 501
其中，auth_info子句也是GRANT语句的一部分请参考13.2.2节。
13.2.1.3指定账户认证方式
核实一下你的DNS解析器会怎样返回值，并使用与账户名一样的格式。
为192.168.010.14或192.168.010.%的账户。如果你感到疑惑，可以运行DNS查找工具，
以与主机部分为192.168.10.14或192.168.10.%的那些账户相匹配，但是无法匹配主机部分
名部分。
名字是全限定的，还是未限定的？根据具体结果，便可以判断出在账户名里需要如何指定主机
主机名称：
情况相反)，那么这两个主机名肯定不相匹配。
名解析器报告的是一个未限定的主机名，如cobra，而权限表的行里包含的是全限定名（或者
机名报告给程序的方式不一致。假设，服务器主机的全限定名为cobra.example.com。如果域
一些麻烦。出现这一问题的原因在于，在权限表里指定主机名的方式与 DNS 域名字解析器把主
13.2.1.2将账户名里的主机值与DNS相匹配
localhost‘@%’。为避免这一问题，一定要给账户名里的用户名和主机名分别加上引号。
名部分，并会给它加上一个%，以作为其默认的主机名部分，最终得到的账户名将是boris@
当把IP值作为主机部分指定某个账户时，如果DNS以不同的格式返回该IP值，则可能会
为确定你的系统上是否会出现这种问题，可以在连接本地服务器时尝试使用-h选项来指定
当使用服务器的主机名（而不是使用localhost）从服务器主机进行连接时，通常会遇到
auth_info子句可采用的两种形式如下所示。
CREATE USER account [auth_info]
接着，查看服务器的常规日志文件。当服务器在报告连接尝试时，它会怎样写人主机名呢？
口
口贝
mysql-hcobra.example.com
此时，MySQL不会直接管理密码，但是会期望插件在连接时能够报告用户认证是否正
CREATE USER'felipe'@'localhost' IDENTIFIED BY 'myplugin';
IDENTIFIED WITH auth_plugin[As'auth_string']
个为该插件提供附加信息的可选字符串：
指定一种不同的认证方法。使用下列语法，指定一个实现了所需方法的认证插件和一
例如：
GRANTS显示的是散列后的密码值，而不是明文密码。）
关键字。当利用 SHOW GRANTS 的输出重新创建账户时，可能会出现这种情况。（SHOW
殊情况下，如你想要以已有的散列格式来指定密码，可以在该值的前面加上PASSWORD
用纯文本指定明文密码。MySQL 会在存储值之前，将其转换为给定的散列格式。在特
存储在该账户user 行中的 Password 列里。通常情况下，可以省略 PASSWORD关键字，
此时，MySQL会管理密码本身，并使用相当于PASSWORD（）函数生成的散列格式，将其
例如：
账户采用密码认证。语法格式如下：
13.2管理MySQL用户账户
481
同
---
## Page 502
使用何种类型的GRANT语句。
13.2.2
避免。
WITH子句，则客户端会在无认证的情况下用它来连接服务器。这种情况是不安全的，应该尽量
这
语
482
下面几个部分。
样可以防
吾句会在创建它时带上分配的权限。为避免GRANT语句创建不需要进行认证的新账户（这会是
口应该为该账户分配什么样的访问类型？或者说，该用户应该拥有什么样的权限级别？
在指定某个账户可以做哪些事情时，通常可以采用回答下面这几个简单问题的方式来决定
其中有几个子句是可选的，如无必要，完全可以不用指定它们。通常情况下，最为常用的
如果指定的账户存在，那么GRANT语句会修改其权限。如果该账户不存在，那么GRANT
GRANT
为某个账户分配访问权限时，
当服务器创建账户时，如果不指定带有非空密码的IDENTIFIED BY子句或者IDENTIFIED
口
口
auth_info、REQUIRE子句和WITH子句都是可选的。
口
口
D
口
口
过度占用服务器资源。
WITH子句。它可用于授予GRANTOPTION 权限，从而让此账户能够把自己的权限转授
REQUIRE子句。它会设置账户，要求其在进行连接时必须使用安全的安全套接字月