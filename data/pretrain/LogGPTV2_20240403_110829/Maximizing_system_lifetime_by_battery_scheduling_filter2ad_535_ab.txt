65
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 09:56:40 UTC from IEEE Xplore.  Restrictions apply. 
current(I),thetotalchargewilldecreaselinearly,cf.(2).ThetotalchargeisdiscretizedinNpartsofsizeΓ=C/N.ItwilltakeΓ/(I·T)timeunitstodecreasethetotalchargewithonechargeunitatadischargerateofI.Atthesametime,thedischargewithcurrentIwillin-creasetheheightdifferencewithΓ/c.Thiswillbethestepsizeofthediscretizationoftheheightdifference.Oncesomechargeisdrawnfromtheavailablechargewell,chargewillstarttoﬂowbetweentheboundandavailablechargewell.Thisisanon-linearprocess,describedbythesecondpartoftheﬁrstequationin(2):dδdt=−k(cid:2)δ.(4)Thesolutiontothisdifferentialequationisgivenby:δ(t)=δ(0)e−k(cid:2)t.(5)Ifattimepoint0wehaveδ=m·Γ/c,thenthetimetneededtodecreasetheheightdifferencewithoneunitist=−1k(cid:2)·ln(cid:5)m−1m(cid:6).(6)Toobtainthenumberoftimestepsittakestodecreasetheheightdifferencebyoneunit,wedividethistimetbyTandroundittothenearestinteger.3Priced-timedautomataInthissectionweinformallydescribenetworksoflinearpricedtimedautomata(NLPTA),astheyareusedasinputtoCora[22],bymeansofanexample.Theexampleitselfisofnorelevanceforbatteryscheduling,butillustratesnicelytheimportantingredientsofNLPTA.3.1NetworksoftimedautomataThebasicingredientsofNLPTAarelocations,switches,clocks,guards,invariants,assignments,andchannels.AnNLPTAiscomposedofacollectionoftimedautomata,whichruninparallelandcommunicateviachannels.brightlowoffpress?y = 5press?press?y := 0idlepress!(a)Lamp(b)UserFigure2.ModeloflampFigure2(examplefrom[3])depictsaverysimpleNLPTA,comprisingonlytwocomponents.Thenetworkmodelsthebehaviorofalamp.Thisbehaviordependsonwhentheon/offswitchispressed.InFigure2(a)thebe-haviorofthelampismodeled.Weseethreelocationsoff,low,andbright,whichdenotethethreestatesthelampcanbein:inoffthelampisoff,inlow,itison,givingalowlight,andinbright,itshinesbrightly.Locationoffisthestartinglocation.Theswitchfromofftolow(abbreviatedoff→low)islabeledwithareceiveoperation(signiﬁedwiththequestionmark)onchannelpress.ThisswitchcanonlybetakenifthetimedautomatainFigure2(b)(amodeloftheuser)executestheswitchlabeledwiththecorrespond-ingsendoperation(signiﬁedwiththeexclamationmark)onchannelpress,i.e.,bothtimedautomatasynchronizeonchannelpress.Whileoff→lowisexecuted,clockvariableyisresetto0bytheassignmenty:=0.Clocksarereal-valuedvariableswhichareusedtomeasuretime:clockvaluesincreaselin-earlywithrate1astimeprogresses.Clocksareusedtoex-pressenabling-andurgency-conditionsdependingontime.Forexample,theswitchlow→offislabeledwithaguardy>=5,whichallowsthisswitchtobetakenonlyifclockyhasavalueofatleast5.Inthatcase,iftheuserpressesthebuttonagain,thelampgoesoff.Theswitchlow→bright,ontheotherhand,isguardedbyexpressiony=c*ngamma[id],whichisex-actlycondition(8).Whenthisinequalityholdsthebatteryidisempty,andthetotalchargeautomatonwillgotoloca-tionempty.Theheightdifferenceautomatonkeepstrackoftheheightdifferencebetweenthetwowells,mdelta[id].Initially,mdelta[id]iszero.Foreverychargeunitdrawnfromthebattery,mdeltaisincreasedwithoneunit.Whenmdelta[id]>1,recoverystartsandmdelta[id]isde-creasedbytheautomaton.Thetimeittakestorecoveroneunitdependsonmdelta[id].Thetimesareprecomputed,using(6)andstoredinthearrayrecovtimes.Thus,af-terrecovtimes[mdelta[id]],mdelta[id]isdecreasedbyoneunit.Theclockcrecovisusedtocheckwhethertheappropriatetimehaspassedtorecoveraunit.4.3BatteryschedulingIntheloadautomaton(Figure5(c))thearrayloadtimeisusedtodeterminethestartandendtimesofthediffer-entepochsintheload.Thearraycurisusedtodeter-minewhetheranepochcontainsajob(cur[j]>0)oranidleperiod(cur[j]=0).Whentheepochcontainsajob978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
68
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 09:56:40 UTC from IEEE Xplore.  Restrictions apply. 
emptyonc_disch=cur_times[j]&&(1000-c)*m_delta[id]=c*n_gamma[id]emptied!bat_empty[id] = true(1000-c)*m_delta[id]=recov_time[m_delta[id]]m_delta[id]-=1,c_recov=0c_recov1c_recov=0m_delta[id]==1m_delta[id]>2 &&  c_recov>=recov_time[m_delta[id]]m_delta[id]-=1,c_recov=0m_delta[id]==2 && c_recov>=recov_time[m_delta[id]]m_delta[id]-=1use_charge[id]?c_recov=0,m_delta[id]+=cur[j](b)heightdifferenceoffload_ont=load_time[j]&&cur[j]==0j+=1all_empty?cur[j]>0new_job!go_off!t>=load_time[j]&&cur[j]>0j+=1new_job!t=0,j=0(c)loadoffchoosewaitall_empty?all_empty?go_on!new_job?(d)schedulerdoneoffc_cost=charge_leftall_empty!empty_count==bat_num-1emptied?c_cost=0,charge_left = sum_gamma()empty_count<bat_num-1emptied?empty_count+=1(e)maximumﬁnderFigure5.Timedautomataforbatteryschedulingtheloadautomatonwillsynchronizewiththeschedulerau-tomatonatthestartoftheepochthroughthenewjobchan-neltoschedulethenextbattery.Attheendofthejobtheloadautomatonsynchronizesthroughthegooffchannelwiththeassignedbatterytoswitchitoff.Thesetwosyn-chronizationsarenotneededforidleperiods,sincenobat-teryisused.Whentheloadautomatonsynchronizeswiththeschedulerautomaton(Figure5(d))throughthenewjobchannel,theschedulerwillnondeterministicallysynchro-nizethroughthegoonchannelwithoneofthebatter-ies.Whenabatteryisemptiedduringajob,thesched-ulerchoosesanotherbatterytocontinuethejobatthepointtheotherstopped.Althoughthebatterycanstillrecoversomecharge,weassumeitcannotbeusedanymoreonceobservedempty.Theoptimalschedule,i.e.,theonethatyieldsthelongestsystemlifetime,istheschedulethattakesthelongestforbothbatteriestoreachthelocationempty.Wewantthemodelcheckertoﬁndthelongestpathtothisstate.Unfortunately,Coraisnotabletoﬁndthelongestpathleadingtoatargetstate.Itisthusnecessarytotrans-latethequestionforthelongestthatleadstothemaxi-mumlifetimeintoaquestionforaminimumcost.Thishasbeendonebyaddingthemaximumﬁnderautomaton(Figure5(e)).Whenabatteryisempty,thetotalchargeautomatonwillsignalthemaximumﬁnderautomatononchannelemptied.Themaximumﬁnderautomatoncountsthenumberofemptybatteries.Whenallbatteriesareemptythemaximumﬁnderautomatonbroadcastsonthechannelallemptytostopallprocessesintheotherautomata.Now,themaximumﬁnderautomatonconvertsthechargeremain-ingintheboundchargewellofthebatteriesintoacost.Thepaththatwillleadtothelongestsystemlifetimewillhaveusedthemostchargefromthebatteriesandthereforewillhavethesmallestamountofchargeremaininginthebound978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE