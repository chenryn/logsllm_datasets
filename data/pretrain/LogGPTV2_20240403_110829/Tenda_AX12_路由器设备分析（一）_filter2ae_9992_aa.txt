# Tenda AX12 路由器设备分析（一）
##### 译文声明
本文是翻译文章
译文仅供参考，具体内容表达以及含义原文为准。
## 0x01 前言
首先感谢Tenda 提供的对Tenda AX12 路由器的测评资格和提供的路由器设备。  
今天这篇文章就来讲述如何对路由器设备进行设备分析，以及在分析设备过程中要注意的点，在Tenda设备上的UART串口中获取shell。
## 0x02 Tenda AX12 硬件分析
Tenda AX12 路由器是我们的第一个目标，Tenda AX12
从外观上看，塑料的外壳透露着金属的质感，中间的金黄色log在灯光下非常好看，而且这款路由器的外壳特别坚硬，在使用过程中应该不容易被一些东西砸到而产生变形，影响外观，整体设备有四根天线，根据设备的官方说明，设备支持5G和2.4G的WiFi信号。从外观上看，还看不出来设备有几根5G
的天线。需要将设备拆下来。并且设备的LED状态灯只有一个，不像以前的路由器，有专门WiFi、LAN口、WAN口、和电源的状态信号灯。
这一款Tenda设备拆卸开还是很轻松，背部只有两颗梅花螺丝，使用螺丝刀套装拧开螺丝，接着用塑料卡片一点一点的从边缘撬开，把顶上的塑料盖拿下来之后，这个时候就可以看到设备开发板，我移除了最外面的散热器，还有金属屏蔽层没有拆下来，从开发板上可以看到最右侧貌似是一个串口，然后是SOP8
flash
芯片，这边还看不清除具体是什么型号，并且在开发板上看到两个WiFi的芯片组，分别有2，4G和5G，并且每一个WiFi天线分别配备一个WiFi芯片，感觉WiFi的信号稳定性应该很不错。
用螺丝刀将芯片上的金属屏蔽层打开，打开金属屏蔽层有一个小窍门，要从屏蔽层的边缘，可以看到一个小缝隙，用扁头螺丝刀轻轻网上翘即可，撬开之后用棉签蘸点洗板水清洁一下芯片，这样能更清除的看清楚芯片型号，或者轻微的将台灯的灯光侧向一方，能看的更清楚，由于手机的渣像素，拍的依旧还是不清楚。
1 号芯片：S0374L87 SLN23
2 号芯片：S0393N23 SLMQ3
3号芯片：winbond 25Q128JVSQ 2104
2号芯片下面的芯片：ESMT M15T1G1664A
最右边的串口在板子上标注依次是 “3v3”,”OUT”,”IN”,”GND”，根据以往的路由器串口，大体上可以猜测出这是开发板上提供调试的UART
串口。那么根据UART 串口对引脚的定义，从上到下依次应该是 “VCC”、”TXD“、”RXD“、”GND“
智能设备的固件存在一般flash里，flash没有保护固件被非法读取的措施。现在大多数设备的FLASH和RAM、CPU分别独立,这样是特别容易被提取固件的，拆下FLASH用编程器直接能读到flash里面的内容了。如果FLASH和RAM集成在CPU上，并且开启了加密的话这样就会比较难提取固件，也使设备更加安全。
这里主要关心的是winbond 25Q128JVSQ 2104
芯片，在识别出了芯片型号，可以在搜索引擎中输入芯片型号，可以下载设备的datasheet（芯片数据手册）。芯片在winbond
华邦的官网中可以找到芯片的datasheet。
固件存在flash里，flash没有保护固件被非法读取的措施。现在大多数设备的FLASH和RAM、CPU分别独立,这样是特别容易被提取固件的，拆下FLASH用编程器直接能读到flash里面的内容了。如果FLASH和RAM集成在CPU上，并且开启了加密的话这样就会比较难提取固件，也使设备更加安全
根据datasheet 手册的信息，可以了解到winbond 25Q128JVSQ 芯片是一款25系列的SPI flash 芯片,并且是128mbit
内存。
下图是芯片的引脚定义，这一部分在提取flash芯片内的固件会用到。
## 0x03 UART 接入
由于在路由器板子上看到的疑似UART串口。使用FT232 接入设备，TXD —> IN，RXD —> OUT，GND —> GND
。由于手头上没有逻辑逻辑分析仪，波特率用常用的115200来尝试。打开SecureCRT ，设备通电。看到设备的启动的log信息，这里放出一部分的UART
log信息。
根据log信息中的line 20看到，按ESC可以终端boot的自启。在line 67 的 Kernel command line
值可以了解到设备的固件文件类型是squash，设备的波特率是115200，和内核初始化的一些参数。在line 89
可以看到不同的分区所在的偏移区间，根据这些信息，可以从固件中提取指定偏移区间内的文件信息，比如可以提取
0x000000300000-0x000000f00000 偏移地址区间内的rootfs 文件系统。
    U-Boot 2016.07-INTEL-v-3.1.177 (Nov 25 2020 - 09:48:15 +0000)
    interAptiv
    cps cpu/ddr run in 800/666 Mhz
    DRAM:  224 MiB
    manuf ef, jedec 4018, ext_jedec 0000
    SF: Detected W25Q128BV with page size 256 Bytes, erase size 64 KiB, total 16 MiB
    *** Warning - Tenda Environment, using default environment
    env size:8187, crc:d89b57c5 need d89b57c5
    In:    serial
    Out:   serial
    Err:   serial
    Net:   multi type
    Internal phy firmware version: 0x8548
    GRX500-Switch
    Type run flash_nfs to mount root filesystem over NFS
    Hit ESC to stop autoboot:  0 
    Wait for upgrade... use GRX500-Switch
    tenda upgrade timeout.
    manuf ef, jedec 4018, ext_jedec 0000
    SF: Detected W25Q128BV with page size 256 Bytes, erase size 64 KiB, total 16 MiB
    device 0 offset 0x100000, size 0x200000
    SF: 2097152 bytes @ 0x100000 Read: OK
    ## Booting kernel from Legacy Image at 80800000 ...
       Image Name:   MIPS UGW Linux-4.9.206
       Created:      2020-11-18   5:39:29 UTC
       Image Type:   MIPS Linux Kernel Image (lzma compressed)
       Data Size:    2079952 Bytes = 2 MiB
       Load Address: a0020000
       Entry Point:  a0020000
       Verifying Checksum ... OK
       Uncompressing Kernel Image ... OK
    [    0.000000] Linux version 4.9.206 (root@ubt1-virtual-machine) (gcc version 8.3.0 (OpenWrt GCC 8.3.0 v19.07.1_intel) ) #0 SMP Fri Nov 13 09:14:24 UTC 2020
    [    0.000000] SoC: GRX500 rev 1.2
    [    0.000000] CPU0 revision is: 0001a120 (MIPS interAptiv (multi))
    [    0.000000] Enhanced Virtual Addressing (EVA 1GB) activated
    [    0.000000] MIPS: machine is EASY350 ANYWAN (GRX350) Main model
    [    0.000000] Coherence Manager IOCU detected
    [    0.000000] Hardware DMA cache coherency disabled
    [    0.000000] earlycon: lantiq0 at MMIO 0x16600000 (options '')
    [    0.000000] bootconsole [lantiq0] enabled
    [    0.000000] User-defined physical RAM map:
    [    0.000000]  memory: 08000000 @ 20000000 (usable)
    [    0.000000] Determined physical RAM map:
    [    0.000000]  memory: 08000000 @ 20000000 (usable)
    [    0.000000]  memory: 00007fa4 @ 206d5450 (reserved)
    [    0.000000] Initrd not found or empty - disabling initrd
    [    0.000000] cma: Reserved 32 MiB at 0x25c00000