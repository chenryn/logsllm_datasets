Raffael Marty
18
Defcon 2005 Las Vegas
A 3D Example
►An LGL example:
Raffael Marty
19
Defcon 2005 Las Vegas
Monitoring Web Servers
assetCategory(DestIP)=
WebServer
Raffael Marty
20
Defcon 2005 Las Vegas
Network Scan
Raffael Marty
21
Defcon 2005 Las Vegas
Suspicious Activity?
Raffael Marty
22
Defcon 2005 Las Vegas
Port Scan
►Port scan or something else?
Raffael Marty
23
Defcon 2005 Las Vegas
Firewall Activity
External Machine
Internal Machine
Outgoing
Incoming
Rule#
Rule#
DIP
SIP
Next Steps: 
1. Visualize “FW Blocks” of outgoing traffic
-> Why do internal machines trigger blocks?
2. Visualize “FW Blocks” of incoming traffic
-> Who and what tries to enter my network?
3. Visualize “FW Passes” of outgoing traffic
-> What is leaving the network?
Raffael Marty
24
Defcon 2005 Las Vegas
Firewall Rule-set Analysis
pass
block
Raffael Marty
25
Defcon 2005 Las Vegas
Load Balancer
Raffael Marty
26
Defcon 2005 Las Vegas
Worms
Raffael Marty
27
Defcon 2005 Las Vegas
DefCon 2004 Capture The Flag
DstPort  1024
Source Of Evil
Other Team's Target
DIP
Internal Target
Internal Source
Internet Target
DPort
SIP
Our Servers
Exposed Services
Raffael Marty
28
Defcon 2005 Las Vegas
DefCon 2004 Capture The Flag – TTL Games
TTL
Source Of Evil
Internal Target
DIP
TTL
SIP
Internal Source
Raffael Marty
29
Defcon 2005 Las Vegas
DefCon 2004 Capture The Flag – The Solution
Flags
TTL
DPort
Only show SYNs
Show Node Counts
Raffael Marty
30
Defcon 2005 Las Vegas
Email Cliques
From: My Domain
From: Other Domain
To: Other Domain
From
To
To: My Domain
Raffael Marty
31
Defcon 2005 Las Vegas
Email Relays
From: My Domain
From: Other Domain
To: Other Domain
From
To
To: My Domain
Do you run an open relay?
Grey out emails to 
and from “my domain”
Make “my domain” invisible
Raffael Marty
32
Defcon 2005 Las Vegas
Email SPAM?
To
Size
Size > 10.000
Omit threshold = 1
Multiple recipients with
same-size messages
Raffael Marty
33
Defcon 2005 Las Vegas
Email SPAM?
nrcpt => 2
Omit threshold = 1
From
nrcpt
Raffael Marty
34
Defcon 2005 Las Vegas
BIG Emails
From
Size > 100.000
Omit Threshold = 2
To
Size
Documents leaving the 
network?
Raffael Marty
35
Defcon 2005 Las Vegas
Email Server Problems?
2:00  10:00
To
Delay
To
Raffael Marty
36
Defcon 2005 Las Vegas
AfterGlow
afterglow.sourceforge.net
Raffael Marty
37
Defcon 2005 Las Vegas
AfterGlow
►http://afterglow.sourceforge.net
►Supported graphing tools:
• GraphViz from AT&T (dot and neato) 
http://www.research.att.com/sw/tools/graphviz/
• LGL (Large Graph Layout) by Alex Adai
http://bioinformatics.icmb.utexas.edu/lgl/
Raffael Marty
38
Defcon 2005 Las Vegas
AfterGlow – Command Line Parameters
● Some command line parameters:
-h 
: help
-t
: two node mode
-d
: print count on nodes
-e
: edge length
-n
: no node labels
-o threshold: omit threshold (fan-out for nodes to be displayed)
-c configfile : color configuration file
Raffael Marty
39
Defcon 2005 Las Vegas
AfterGlow – color.properties
color.[source|event|target|edge]=
● Array @fields contains input-line, split into tokens:
color.event=“red” if ($fields[1] =~ /^192\..*)
● Special color “invisible”:
color.target=“invisible” if ($fields[0] eq
“IIS Action”)
● Edge color
color.edge=“blue”
Raffael Marty
40
Defcon 2005 Las Vegas
AfterGlow – color.properties - Example
color.source="olivedrab" 
if ($fields[0]=~/191\.141\.69\.4/);
color.source="olivedrab" 
if ($fields[0]=~/211\.254\.110\./);
color.source="orangered1"
color.event="slateblue4"
color.target="olivedrab" 
if ($fields[2]=~/191\.141\.69\.4/);
color.target="olivedrab" 
if ($fields[2]=~/211\.254\.110\./);
color.target="orangered1"
color.edge="firebrick" 
if (($fields[0]=~/191\.141\.69.\.4/) or 
($fields[2]=~/191\.141\.69\.4/))
color.edge="cyan4"
Raffael Marty
41
Defcon 2005 Las Vegas
THANKS!
PI:EMAIL
Raffael Marty
41
Defcon 2005 Las Vegas