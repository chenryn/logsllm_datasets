[]{#index.html}
::: book
::: titlepage
::: producttitle
[Red Hat Enterprise Linux]{.productname} [9]{.productnumber}
:::
# []{#index.html#idm140502415957872}在 IdM 中管理证书 {.title}
## 在 Red Hat Enterprise Linux 9 中发布证书、配置基于证书的身份验证以及控制身份管理中的证书有效 {.subtitle}
::: abstract
**摘要**
本文档论述了管理 IdM
证书颁发机构(CA)发布的证书、配置用户帐户以使用证书进行身份验证，以及 Red
Hat Enterprise Linux 9 中身份管理中的证书维护。
:::
------------------------------------------------------------------------
:::
:::
[]{#making-open-source-more-inclusive.html}
::: preface
::: titlepage
# []{#making-open-source-more-inclusive.html#making-open-source-more-inclusive}使开源包含更多 {.title}
:::
红帽致力于替换我们的代码、文档和 Web
属性中存在问题的语言。我们从这四个术语开始：master、slave、黑名单和白名单。由于此项工作十分艰巨，这些更改将在即将推出的几个发行版本中逐步实施。详情请查看
[CTO Chris Wright
的信息](https://www.redhat.com/en/blog/making-open-source-more-inclusive-eradicating-problematic-language){.link}。
:::
[]{#proc_providing-feedback-on-red-hat-documentation_managing-certificates-in-idm.html}
::: preface
::: titlepage
# []{#proc_providing-feedback-on-red-hat-documentation_managing-certificates-in-idm.html#proc_providing-feedback-on-red-hat-documentation_managing-certificates-in-idm}对红帽文档提供反馈 {.title}
:::
我们感谢您对文档提供反馈信息。请让我们了解如何改进文档。
::: itemizedlist
-   关于特定内容的简单评论：
    ::: orderedlist
    1.  请确定您使用 [*Multi-page HTML*]{.emphasis}
        格式查看文档。另外，确定 [**Feedback**]{.strong}
        按钮出现在文档页的右上方。
    2.  用鼠标指针高亮显示您想评论的文本部分。
    3.  点在高亮文本上弹出的 [**Add Feedback**]{.strong}。
    4.  按照显示的步骤操作。
    :::
:::
::: itemizedlist
-   要通过 Bugzilla 提交反馈，请创建一个新的 ticket：
    ::: orderedlist
    1.  进入
        [Bugzilla](https://bugzilla.redhat.com/enter_bug.cgi?product=Red%20Hat%20Enterprise%20Linux%209){.link}
        网站。
    2.  在 Component 中选择 [**Documentation**]{.strong}。
    3.  在 [**Description**]{.strong}
        中输入您要提供的信息。包括文档相关部分的链接。
    4.  点 [**Submit Bug**]{.strong}。
    :::
:::
:::
[]{#cert-intro_managing-certificates-in-idm.html}
::: chapter
::: titlepage
# []{#cert-intro_managing-certificates-in-idm.html#cert-intro_managing-certificates-in-idm}第 1 章 身份管理中的公钥证书 {.title}
:::
本章描述了 X.509
公钥证书，其用于验证身份管理(IdM)中的用户、主机和服务。除了身份验证外，X.509
证书还支持数字签名和加密，来提供隐私性、完整性和不可否认性。
证书包含以下信息：
::: itemizedlist
-   证书验证的主题。
-   签发者，即签署证书的 CA。
-   证书有效性的开始和结束日期。
-   证书的有效使用。
-   主题的公钥。
:::
由公钥加密的消息只能由相应的私钥解密。虽然包含的证书和公钥可以公开发布，但用户、主机或服务必须对其私钥保密。
[]{#cert-intro_managing-certificates-in-idm.html#con-cert-authority-idm_cert-intro}
::: section
::: titlepage
# []{#cert-intro_managing-certificates-in-idm.html#_certificate_authorities_in_idm}IdM 中的证书颁发机构 {.title}
:::
证书颁发机构在信任层次结构中操作。在带有内部证书颁发机构(CA)的 IdM
环境中，所有 IdM 主机、用户和服务信任由 CA 签名的证书。除了这个根 CA
外，IdM 还支持根 CA 授予其依次签署证书能力的子 CA。通常，此类子 CA
能够签名的证书是特定类型的证书，如 VPN 证书。最后，IdM 支持使用外部
CA。[下](#cert-intro_managing-certificates-in-idm.html#tab-comparison-of-using-integrated-and-external-cas-in-idm_cert-intro "表 1.1. 在 IdM 中使用集成和外部 CA 的比较"){.link}
表显示了 在 IdM 中使用独立 CA 的详情。
::: table
[]{#cert-intro_managing-certificates-in-idm.html#tab-comparison-of-using-integrated-and-external-cas-in-idm_cert-intro}
**表 1.1. 在 IdM 中使用集成和外部 CA 的比较**
::: table-contents
  CA 的名称            描述                                          使用                                                                                                 有用的链接
  -------------------- --------------------------------------------- ---------------------------------------------------------------------------------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `ipa`{.literal} CA   基于 Dogtag 上游项目的集成 CA                 集成的 CA 可以为用户、主机和服务创建、吊销和发布证书。                                               [使用 ipa CA 来请求一个新用户证书，并将其导出到客户端](#dc-web-ui-auth_managing-certificates-in-idm.html#requesting-and-exporting-a-user-certificate_dc-web-ui-auth "请求新用户证书并将其导出到客户端"){.link}
  IdM sub-CAs          从属于 `ipa`{.literal} CA 的集成 CA           IdM 子 CA 是 `ipa`{.literal} CA 对其授予了签署证书的 CA。通常，这些证书是特定类型的，如 VPN 证书。   [将应用程序限制为只信任证书子集](#restricting-an-application-to-trust-only-a-subset-of-certificates_managing-certificates-in-idm.html "第 17 章 将应用程序限制为只信任证书子集"){.link}
  外部 CA              外部 CA 是集成 IdM CA 或其子 CA 以外的 CA。   使用 IdM 工具，您可以将这些 CA 发布的证书添加到用户、服务或主机，以及删除它们。                      [为 IdM 用户、主机和服务管理外部签名证书](#managing-externally-signed-certificates-for-idm-users-hosts-and-services_managing-certificates-in-idm.html "第 3 章 为 IdM 用户、主机和服务管理外部签名证书"){.link}
:::
:::
从证书的角度来看，由自签名 IdM CA 签名和外部签名的证书之间没有区别。
CA 的作用包括以下目的：
::: itemizedlist
-   它发布数字证书。
-   通过签署证书，它证明证书中指定的对象拥有一个公钥。主题可以是用户、主机或服务。
-   它可以吊销证书，并通过证书吊销列表(CRL)和在线证书状态协议(OCSP)提供吊销状态。
:::
::: itemizedlist
**其他资源**
-   请参阅 [规划您的 CA
    服务](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/planning_identity_management/index#planning-your-ca-services-planning-identity-management){.link}。
:::
[]{#cert-intro_managing-certificates-in-idm.html#compare-certs-kerberos_cert-intro}
:::
::: section
::: titlepage
# []{#cert-intro_managing-certificates-in-idm.html#_comparison_of_certificates_and_kerberos}证书和 Kerberos 的比较 {.title}
:::
证书与 Kerberos 票据执行类似的功能。Kerberos
是一种计算机网络身份验证协议，它在票据的基础上工作，来允许节点通过非安全网络进行通信，从而以安全的方式证明它们相互的身份。下表显示了
Kerberos 和 X.509 证书的比较：
::: table
[]{#cert-intro_managing-certificates-in-idm.html#tab-compare-cert-kerberos_cert-intro}
**表 1.2. 证书和 Kerberos 的比较**
::: table-contents
  ---------------------------- ------------------------- ----------------------
  [**特性**]{.strong}          [**Kerberos**]{.strong}   [**X.509**]{.strong}
  `认证`{.literal}             是                        是
  `隐私性`{.literal}           选填                      是
  `完整性`{.literal}           选填                      是
  `涉及的加密类型`{.literal}   对称                      非对称
  `默认有效期`{.literal}       短（1 天）                长（2 年）
  ---------------------------- ------------------------- ----------------------
:::
:::
默认情况下，身份管理中的 Kerberos 仅确保通信各方的身份。
:::
::: section
::: titlepage
# []{#cert-intro_managing-certificates-in-idm.html#using-certs-to-authenticate-users_cert-intro}使用证书验证 IdM 中用户的优缺点 {.title}
:::
在 IdM 中使用证书验证用户的优点包括以下几点：
::: itemizedlist
-   与常规密码相比，智能卡上保护私钥的 PIN 通常不复杂、更容易记住。
-   根据设备的不同，无法导出保存在智能卡上的私钥。这提供了额外的安全性。
-   智能卡可以自动退出登录： IdM
    可以配置为在用户从读卡器中移除智能卡时退出用户登录。
-   窃取私钥需要对智能卡的实际访问，这样可以防止智能卡遭受攻击。
-   智能卡验证是一双因素验证的一个示例：它要求您拥有某些东西（卡），知道某些东西(PIN)。
-   智能卡比密码更灵活，因为它们提供可用于其他用途的密钥，如加密电子邮件。
-   在作为 IdM
    客户端的共享机器上使用智能卡不会给系统管理员带来额外的配置问题。事实上，智能卡验证对于共享机器来说是一个理想的选择。
:::
在 IdM 中使用证书验证用户的缺点包括以下几点：
::: itemizedlist
-   用户可能会丢失或忘记携带其智能卡或证书，并被有效锁住。
-   多次输错 PIN 可能会导致卡被锁住。
-   通常，在请求与某些安全官或批准人授权之间有一个中间步骤。在 IdM
    中，安全官或管理员必须运行 [**ipa cert-request**]{.strong} 命令。
-   智能卡和读卡器往往是特定于供应商和驱动程序的：虽然许多读卡器可用于不同的卡，但特定供应商的智能卡可能无法在另一供应商的读卡器或不是为其设计的读卡器类型中工作。
-   证书和智能卡对管理员来说有一个陡峭的学习曲线。
:::
:::
:::
[]{#managing-certificates-for-users-hosts-and-services-using-the-integrated-idm-ca_managing-certificates-in-idm.html}
::: chapter
::: titlepage
# []{#managing-certificates-for-users-hosts-and-services-using-the-integrated-idm-ca_managing-certificates-in-idm.html#managing-certificates-for-users-hosts-and-services-using-the-integrated-idm-ca_managing-certificates-in-idm}第 2 章 使用集成的 IdM CA 为用户、主机和服务管理证书 {.title}
:::
本章描述了如何使用集成的 CA、`ipa`{.literal} CA 以及其子 CA
在身份管理(IdM)中管理证书。
本章包含以下部分：
::: itemizedlist
-   [使用 IdM Web UI
    为用户、主机或服务请求新证书](#managing-certificates-for-users-hosts-and-services-using-the-integrated-idm-ca_managing-certificates-in-idm.html#requesting-new-certificates-for-a-user-host-or-service-using-idm-web-ui_managing-certificates-for-users-hosts-and-services-using-the-integrated-idm-ca "使用 IdM Web UI 为用户、主机或服务请求新证书"){.link}。
-   使用 IdM CLI 为用户、主机或服务从 IdM CA 请求新证书：
    ::: itemizedlist
    -   [使用 certutil 为用户、主机或服务从 IdM CA
        请求新证书](#managing-certificates-for-users-hosts-and-services-using-the-integrated-idm-ca_managing-certificates-in-idm.html#requesting-new-certificates-for-a-user-host-or-service-from-idm-ca-using-certutil_managing-certificates-for-users-hosts-and-services-using-the-integrated-idm-ca "使用 certutil 为用户、主机或服务从 IdM CA 请求新证书"){.link}
        ::: itemizedlist
        -   对于使用 `certutil`{.literal} 工具从 IdM CA
            请求新用户证书，并将其导出到 IdM 客户端的具体示例，请参阅
            [请求新的用户证书并将其导出到客户端](#dc-web-ui-auth_managing-certificates-in-idm.html#requesting-and-exporting-a-user-certificate_dc-web-ui-auth "请求新用户证书并将其导出到客户端"){.link}。
        :::
    -   [使用 openssl 为用户、主机或服务从 IdM CA
        请求新证书](#managing-certificates-for-users-hosts-and-services-using-the-integrated-idm-ca_managing-certificates-in-idm.html#requesting-new-certificates-for-a-user-host-or-service-from-idm-ca-using-openssl_managing-certificates-for-users-hosts-and-services-using-the-integrated-idm-ca "使用 openssl 为用户、主机或服务从 IdM CA 请求新证书"){.link}
    :::
:::
您还可以使用 `certmonger`{.literal} 工具为来自 IdM CA
的服务请求新证书。如需更多信息，请参阅 [使用 certmonger 为来自 IdM CA
的服务请求新证书。](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/configuring_and_managing_identity_management/index#using-certmonger_configuring-and-managing-idm){.link}
::: itemizedlist
**先决条件**
-   您的 IdM 部署包含一个集成的 CA：
    ::: itemizedlist
    -   有关如何在 IdM 中规划您的 CA 服务的详情，请参考 [规划您的 CA
        服务](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/planning_identity_management/index#planning-your-ca-services-planning-identity-management){.link}。
    -   有关如何使用集成 DNS 安装 IdM 服务器并将 CA 作为 root CA
        的信息，[请参阅安装 IdM 服务器： 使用集成的 DNS，将集成的 CA
        作为 root
        CA](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/installing_identity_management/index?lb_target=production#installing-an-ipa-server-with-integrated-dns_installing-identity-management){.link}
    -   有关如何安装带有集成 DNS 和外部 CA 的 IdM 服务器作为 root CA
        的信息，请参阅安装 [IdM 服务器： 使用集成的 DNS，将外部 CA 作为
        root
        CA](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/installing_identity_management/index?lb_target=production#installing-an-ipa-server-with-external-ca_installing-identity-management){.link}
    -   有关如何在没有集成 DNS 的情况下安装 IdM 服务器以及集成的 CA 作为
        root CA 的信息，请参阅安装 [IdM 服务器： 在不集成 DNS
        的情况下，使用集成的 CA 作为 root
        CA](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/installing_identity_management/index?lb_target=production#installing-an-ipa-server-without-integrated-dns_installing-identity-management){.link}。
    -   \[可选\] 您的 IdM 部署支持使用证书进行用户身份验证：
        ::: itemizedlist
        -   有关如何配置 IdM 部署以支持使用存储在 IdM
            客户端文件系统中的证书进行用户身份验证的详情，请参考
            [使用存储在 IdM
            客户端桌面上的证书来配置身份验证](#dc-web-ui-auth_managing-certificates-in-idm.html "第 10 章 使用保存在 IdM 客户端桌面中的证书配置身份验证"){.link}。
        -   有关如何配置 IdM
            部署以支持使用存储在智能卡上证书进行用户身份验证的信息，请参阅
            [为智能卡身份验证
            配置卡身份管理](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/managing_smart_card_authentication/configuring-idm-for-smart-card-auth_managing-smart-card-authentication){.link}。
        -   有关如何配置您的 IdM
            部署以支持使用活动目录证书系统颁发的智能卡进行用户身份验证的详情，请参阅
            [为 IdM 中智能卡身份验证配置由 ADCS
            颁发的证书](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/managing_smart_card_authentication/configuring-certificates-issued-by-adcs-for-smart-card-authentication-in-idm_managing-smart-card-authentication){.link}。
        :::
    :::
:::
::: section