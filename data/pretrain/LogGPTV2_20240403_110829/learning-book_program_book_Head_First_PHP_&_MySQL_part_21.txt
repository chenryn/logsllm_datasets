elvi
你现在的位置
143
---
## Page 180
完成的sendemail.php脚本
PHP&MySQL磁贴
使用以下磁贴完成Sendemail脚本的代码，使得Elmer可以开始向他的客户列表发送邮件。先
复习一下mai1（)函数的用法：
mail(to,subject，msg，'From:'.from);
一定要把这个地址改为你
自己的邮件地址。
';
echo 'Email sent to:
邮件接收者、邮件主题和邮件主体连同ELmer
mysqli_close($dbc);
的“om”地址一同传递到mail(）函数。
?>
sendemail.php
数据库中“email列包含客户的邮
在页面上回显输出一个确认消
件地址，即消息将发送到的地址。
息，其中包含接收邮件的各个
从安全的角度考虑，直接将用户输入
客户的邮件地址。
的数据传送给mail(）面数而不首先进行
检查不是一个好的想法。第6章将介绍
克服这个问题的一些技术。
144
第3章
---
## Page 181
创建与填充数据库
运行测试
使用Sendemail表单向邮件列表发送邮件。
从HeadFirstLabs网站（www.headfirstlabs.com/books/hfphp）下载
Send
Email页面的代码。代码放在chapter03文件夹下。与前面见过的Add
要记住你的邮件地
Email页面类似，这个代码包括一个Web表单（sendemai1.html）、一个样
甘必须在邮件列表
式表（style.css）以及两个图像（elvislogo.gif和blankface.jpg）
中才能保证你收到
邮件。
创建一个新的文本文件sendemail.php，输人上一页的所有代码。将所有这
些文件上传到你的Web服务器，并在一个Web浏览器中打开sendemail.html页面。
在表单中输人邮件正文，然后点击Submit。
你确实收到了邮件.....·来自Elmer！
最后，通过使用这个新的SendemailWeb表单和PHP脚本，Elmer可以把他的
MakeMeElvis.com促销邮件发送给邮件列表中的每一个人。他还可以使用脚本的
输出来确认各个邮件确实已经成功发送。每次执行脚本while循环中的代码时，
他都会看到一条形如“PI:EMAIL”的消息，其中的
邮件地址是其数据库中某个人的邮件地址。最终的结果是，会有更多的人了解
到他的商品，相应地，会有更多看上去像猫王的人（真不知道这一点是好还是
坏）！
Sendemail脚本确实金向数
/据库中存储的地址发送邮件，
我的蓝色小
所以尝试时要当心！
山羊皮皮鞋已经销售
空.…我发财了！
Sig Seie
lodyofe
你现在的位置
145
---
## Page 182
应用还需要删除功能
有时人们想退出
与所有蓬勃发展的新企业一样，前进道路并不总是一帆风顺的。
看起来有些猫王迷们已经改弦易辙，想要退出Elmer的邮件列
表。Elmer希望满足他们的要求，但这意味着他要从数据库中删
除这些客户。
亲爱的老板，
亲爱的Elmer.
虽然我还是很喜欢猫王活力四
我想并不是所有人都那么坚决地
我不想再收到ElvisStore的更多
射的动作，但现在已经不再那
想要模仿猫王。我得把这些人从
么为之着迷了。我现在更喜欢
促销邮件了。尽管我还是一个猫
Liberace恰到好处的演技和出神
我的列表中删除，重点关注那些
王迷，但已经不想再模仿了，请
入化的钢琴技艺。下面是我的邮
真正的猫王迷。
把我从你的列表中去掉。我的邮
件地址是cbriggs@boards-r-us.
件地址（请从列表中将我去除）
com.
PI:EMAIL。
非常感谢
衷心感谢，
一个从前酷爱模仿的人
LiberaceLindy
亲爱的先生
因为你卖给我的马繁络腮胡子
（尽管是真货）已经让我有好几
次过敏反应，所以我认为也许装
扮成猫王并不适合我。我确实想
要个好的斗篷，不过络腮胡子实
在是让我受够了。请将我从你的
邮件列表中去掉。
衷心感谢，
对于客户的流失，Elmer并不
太高兴，不过他还是尊重这些
Brian Powers
客户的请求，决定将他们从
PI:EMAIL
邮件列表去除。
这是MySQL世界中毫无悬念的事实，有时需要从数据库删除数
据。Elmer需要扩展他的应用，从而能够从emai11ist表删除用
户。
如果Elmer需要实现RemoveEmail功能，你认为需要哪些新的应
用组件，请写出这些组件：
146
---
## Page 183
创建与填充数据库
用DELETE删除数据
要从数据库删除数据，需要一个新的SQL命令：DELETE。我们
?
一为部件列表创建个数据库和数据库
将在一个新的Removeemail脚本中使用DELETE，它从Elmer的邮
表。
件列表删除客户的数据。实际上，为此我们需要一个新的脚本和
③-创建一个Add-emuilWeb表单和PHP脚
本向列表增加新客户：
一个新的Web表单....不过首先需要了解DELETE。
DELETESQL命令会从一个数据库表删除数据行。正因如此，使
③
创建个Send-emailWeb表单和PHP
脚本向列表发送个部件。
用时要特别当心，因为它完全能够在眨眼之间将填满数据的一个
表完全清空。了解到这一点后，下面给出DELETE最危险的形式，
创建一个RemoveemailWeb表单和
PHP脚本从列表中删除一个客户。
这会从一个表删除所有行。
这是要别除其中数据行
DELETE FROM table_name
的表名。
7
看上去还需要一个新步.·
有时设计方案金有变化！
如果没有其他限定符，DELETE命会
全完全清空一个表的所有数据。
这么说，如累不是全部删
除，我们就无法从表中删除
任何数据，是这样吗？
不对，根本不是这样。DELETE可以用来精确地指定一个或一些特定的
行进行删除。
要用DELETE准确地指定想要删除的行，需要增加一个WHERE子句。如果
还记得SELECT命令中使用的WHERE子句，应该知道利用WHERE可以抽取
出一个查询中的特定行。
harpenyourpencil
假设Elmer有23个名为Anne的客户，11个姓为Parker的客户，并且有1个
名叫AnneParker的客户。请写出以下各个查询分别删除多少数据行。
DELETE FROM email_list WHERE first_name = 'Anne';
DELETE FROM email_list WHERE first_name = 'Anne' OR last_name = 'Parker'
DELETE FROM email_list WHERE last_name = Parker;
你现在的位置
147
---
## Page 184
带WHERE的DELETE
harpenyour
假设Elmer有23个名为Anne的客户，11个姓为Parker的客户，并且有1个
名叫AnneParker的客户。请写出以下各个查询分别删除多少数据行。
DELETE FROM email_list WHERE first_name ='Anne';
.23....
DELETE FROM email_list WHERE first_name = 'Anne' OR 1ast_name = 'Parker';
..3.3...
DELETE FROM email_list WHERE last_name = Parker;
.O.
有陷阱的题：姓没有加引号，所以不
会删除任何数据行，所有文本值都必
须加引号。
利用WHERE删除特定数据
通过在DELETE命令中使用WHERE子句，我们可以准确地指定要删除
的特定数据行，而不是清空整个表。WHERE子句允许我们只关注想
要删除的行，在这里就是希望从邮件列表退出的客户。
WHERE子句
要匹配的值
可以缩小查询
DELETE FROM email list
WHERE email='PI:EMAIL'
的范围从而重
WHERE子句的这一部分对每一行完成
点关注特定的
表列名
一个测试，查看哪些行匹配。
数据行。
WHERE子句中的具体测试会完成一个比较，对于表中的每一行都会
做这样一个比较。在这个例子中，等号（=）会检查email列中的
各个值，来查看哪些行的地址等于"PI:EMAIL”。如
果某一行emai1列中的值与之匹配，则删除该行。
你认为为什么WHERE子句中要使用email列，面不是first_name
或last_name，请写出原因：
148
第3章
---
## Page 185
创建与填充数据库
将意外删除的风险减至最小
要了解重要的一点，尽管可以在WHERE子句中使用任何列名来匹配行，但
是我们选择了emai1列完成Elmer的DELETE查询，对此有一个很充分的原
DELETE语句中
因。要知道，如果不只有一行与一个WHERE子句匹配，那么所有匹配的行
的WHERE子句
都将被删除。所以Elmer的WHERE子句必须准确地指定想要删除的行，这
允许精确指定想
一点至关重要。
要删除的行。
现在讨论的实际上是唯一性问题。完全可以假定email1ist表中的邮件
地址是惟一的，而名和姓不唯一。如果只是想要删除一个客户，你肯定不
希望建立一个将first_name列与”Pat”进行匹配的wHERE子句—这
样一来，最后会把所有名为Pat的客户都统统删除！正是因为这个原因，我
们将Elmer的wHERE子句精心设计为使用emai1列查找特定的匹配。
DELETE奎询从数据库删除
DELETE FROMemail_list
这一行.再也不会看到
WHEREemail='PI:EMAIL'
这一行了！
email_list
last_nome
email
WHERE子句中使用email列有助于
first_name
建立唯一性，并降低意外删除一
Joe
Milano
PI:EMAIL
行的风险。
Spence
PI:EMAIL
Bruce
Pat
-Riove
pehonoy doihoom
Bertie
Henderson
PI:EMAIL
Greg
Eckstein
PI:EMAIL
Wilma
Wu
PI:EMAIL
Sam
Jaffe
PI:EMAIL
Louis
Shaffer
lsGobjectville.net
如果在WHERE子句中使用titst_
Bubba
Shakespeare
PI:EMAIL
name而不是email，这个用户就金
John
Doe
PI:EMAIL
被意外删除。
Pat
Grommet
PI:EMAIL
mysql>DELETE FROMemail_list WHERE email='PI:EMAIL'
1rowdeleted（0.005sec)
你现在的位置
149
---
## Page 186
DELETE命令测试
运行测试
尝试对Elmer的数据库执行DELETE命令。
打开一个MySQL工具，并尝试执行几个DELETE命令，根据客户的邮件地
址从email_list表分别删除数据行。不过要确保每个DELETE语句都要包
含一个WHERE子句，以免无意中清空整个表！
DELETE命令很方便、但是我们的理
想做法是使用一个Web表单和PHP膨
本来副除数据行，对不对？
没错。利用单独的查询手动地删除用户根本无法管理邮件列表。
由于Elmer将来不可避免地要面对这样一些用户，他们希望将自己
从邮件列表中删除，所以开发一个基于Web的用户界面来删除客户
很有意义。利用一个HTMLWeb表单和PHP脚本应该能完成这个工
作，当然还要有一个DELETEFROM查询并需要一个WHERE子句的
一点帮助
PDG
150
第3章
---
## Page 187
创建与填充数据库
Elmer已经创建了一个Web表单（removeemail.html），用来从他的邮件列表删除
ExeRciSe
一个客户。这个表单接收的只是一个邮件地址，它输入到一个名为email的HTML表单
域。请帮助Elmer完成removeemail.php脚本的代码，这个脚本将由表单调用来具体
完成各个客户的删除。
A00
MakEMEELViS.COM
这个表单域名
为“email”
Enter an era asdress to remove.
Emeil acoress.
Remove
点击Remove按纽将把表单
作为一个POST请求提交
给PHP脚本。
removeemail.html
dqd>
$dbc = mysqli_connect('data.makemeelvis.com',
'elmer',
'theking','elvis_store')
or die('Error connecting to MySQL server.')
mysqli_close($dbc);
removeemail.php
?>
你现在的位置
151
---
## Page 188
完成的removeemail.php脚本
Elmer已经创建了一个Web表单（removeemail.html），用来从他的邮件列表删除
一个客户。这个表单接收的只是一个邮件地址，它输人到一个名为email的HTML表单
xeRciSe
域。请帮助Elmer完成removeemail.php脚本的代码，这个脚本将由表单调用来具体
SoLutiON
完成各个客户的删除。
A00
MakEMEELviS.COM
这个表单域名
为“emait"
Remcve
点击Remove按钮将把表单
作为一个POST请求提交
给PHP脚本。
S_POST中的email表单数据存储
在一个变量中，然后在DELETE
查询中使用。
removeemail.html
<?php
$dbc = mysqli_connect('data.makemeelvis.com',
'elmer',
'theking','elvis_store')