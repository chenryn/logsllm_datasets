# 【漏洞分析】Foscam C1室内高清摄像机的多个漏洞分析
|
##### 译文声明
本文是翻译文章，文章来源：安全客
原文地址：
译文仅供参考，具体内容表达以及含义原文为准。
译者：[eridanus96](http://bobao.360.cn/member/contribute?uid=2857535356)
预估稿费：200RMB
投稿方式：发送邮件至linwei#360.cn，或登陆网页版在线投稿
**摘要**
Foscam
C1室内高清摄像头是一个基于网络的摄像头，用于包括家庭安防在内的多种场合。在6月，Talos团队曾发现该设备存在多个漏洞，并与Foscam一同开发了修复补丁，随后在我们的博客中发布了漏洞的详细信息：
在继续对这些设备进行安全评估的过程中，我们又发现了其它漏洞。根据我们“负责任的披露”原则，我们已经与Foscam进行合作，以确保这些漏洞最终能得以解决，并且可以为受漏洞映像的客户提供固件更新。
借助本次发现的这些漏洞，攻击者可以在受漏洞影响的设备上实现远程代码执行，并可以将恶意固件映像上传至设备，最终可能导致攻击者完全控制该设备。
**webService DDNS客户端代码执行漏洞**
Foscam
C1室内高清摄像机一旦启用了动态DNS（DDNS）功能，就很容易受到多个缓冲区溢出漏洞的攻击。针对启用了DDNS的设备，攻击者可以利用恶意HTTP服务器来进行攻击。
当设备启动时，会产生一个线程，以定期连接到此前配置过的DDNS服务器。该线程会检查是否存在可用更新，同时检查与DDNS服务器相关联的IP地址是否发生变化。在该过程中，设备向DDNS服务器发送请求，随后没有执行边界检查，就将DDNS服务器的响应写入到缓冲区之中。
**如果攻击者能够控制服务器，构建一个大于所分配缓冲区的响应消息并返回，就能导致溢出，从而在设备上实现远程代码执行。** 由该问题导致的漏洞如下：
**Foscam IP Video Camera webService oray.com DDNS Client Code Execution Foscam
IP Video Camera webService oray.com DDNS Client Code Execution Vulnerability
(TALOS-2017-0357 / CVE-2017-2854)**
**Foscam IP Video Camera webService 3322.net DDNS Client Code Execution
Vulnerability (TALOS-2017-0358 / CVE-2017-2855)**
**Foscam IP Video Camera webService dyndns.com DDNS Client Code Execution
Vulnerability (TALOS-2017-0359 / CVE-2017-2856)**
**Foscam IP Video Camera webService 9299.org DDNS Client Code Execution
Vulnerability (TALOS-2017-0360 / CVE-2017-2857)**
**CGIProxy.fcgi固件升级未验证映像漏洞(TALOS-2017-0379 / CVE-2017-2872)**
Foscam C1室内高清摄像机允许通过设备上的Web管理界面进行固件升级，然而该设备并没有对用户提供的固件升级映像文件进行充分的安全验证。
攻击者可以利用这一漏洞， **在受影响的设备上上传并执行自定义的固件映像。** 但由于权限限制，攻击者需要登录到管理员权限账户，才可以进行升级操作。
该漏洞编号为CVE-2017-2872，详细信息请参见：
[https://www.talosintelligence.com/reports/TALOS-2017-0379/](https://www.talosintelligence.com/reports/TALOS-2017-0379/)
**  
******
**CGIProxy.fcgi模拟AP配置命令执行漏洞 (TALOS-2017-0380 / CVE-2017-2873)**
Foscam C1室内高清摄像机允许配置“模拟AP”（SoftAP），以便在第一次通过Wi-Fi使用时对摄像机进行设置。这一功能可以在Web界面进行配置。HTTP请求首先由CGIProxy.fcgi进程处理，该进程会向相应组件发送消息。当处理“setSoftApConfig”命令时，“webService”中的sub_35FCC函数会被调用。在这里，只有2级权限（管理员）的用户才有权调用此命令。
该函数会从“查询”[1]
中获取参数，随后函数会检查“psk”参数，并要求其长度至少为7个字符[2]，且不包含“n”或“r”字符[3]。最后，使用消息代码“0x607F”将请求转发到另一个组件。
消息代码“0x607F”将会由devMng中的函数 **OnDevMngMsgSetSoftApConfig**
来处理。该函数会将固定的SSID和用户提供的PSK复制到“CNetworkService”对象[5]中。随后，在[6]处它会调用另一个函数，修改模拟AP中的配置文件。
**sub_3DF44** 函数再次复制SSID和PSK，随后，调用负责配置模拟AP的sub_4519C函数。该函数首先在[7]的位置更新文件“
**/mnt/mtd/app/config/SoftApConfig.xml** ”，然后更新“
**/mnt/mtd/app/etc/RT2870AP.dat** ”。上述更新操作都是通过系统的 **sed** 命令来完成。
由于[9]中的PSK参数由用户控制，攻击者就可以使用这一漏洞来插入任意Shell命令。
**此漏洞需要具有管理员权限的有效用户账户，并借助于“setSoftApConfig”命令访问** ，其PoC如下：
**devMng 多摄像头10000端口0x0000命令信息泄露漏洞 (TALOS-2017-0381 / CVE-2017-2874)**
Foscam
C1室内高清摄像机允许设备通过UDP端口10000和10001与另一台设备进行通信。这一功能的目的是：方便用户在Web管理界面中看到来自多个设备的视频流。
然而，这些设备存在信息泄露漏洞， **未经身份验证的远程攻击者可以利用此漏洞获取到设备的敏感信息，例如MAC地址、摄像机名称和固件版本。**
该漏洞编号为 **CVE-2017-2874** ，更多信息请参见：