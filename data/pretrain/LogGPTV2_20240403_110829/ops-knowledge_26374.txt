User: 请回答以下安全问题哪个更有效和“安全”：压缩+加密，还是仅加密？这是IRC在freenode上的一次讨论中提出的，现在我很好奇。
这个想法是，有人想确定单独加密或压缩+加密（gpg/pgp是主要加密系统）是否能为文件提供更好的“安全性”。
由于我不是密码学或密码安全方面的专家，我想知道是否有任何东西可以支持这两种选择。
（因为没有什么是真正“安全”的，所以我在这里使用单引号）

Assistant: 有几个因素在起作用。第一个是加密应该隐藏模式：如果您的文件包含重复多次的相同内容，则加密应该隐藏这一事实。如果你有一个弱加密方案，它会在密文中泄露一些关于明文模式的信息，那么压缩可以帮助减少泄露的信息量。至少，这是经典理论。任何现在使用的足够好的加密方案都应该自行处理模式，无论是压缩还是不压缩（相关提示：永远不要直接使用ECB模式）。因此，加密前压缩的经典论点不再那么相关（加密后压缩在几乎所有情况下都毫无意义）。
另一个“经典”论点是，破解密码的几率随着你必须使用的密文数量的增加而增加。因此，如果在发送之前压缩消息，那么攻击者可以使用的材料就会减少。同样，对于任何在现代观念下安全的密码，你不应该担心这一点。你应该根据最新的建议不时更新你的算法和密钥大小，旋转密钥等，但压缩对此的影响将是最小的。此外，如果你用每条消息的密钥加密每条消息，然后传输这个密钥，而不是用密钥加密密钥加密它，这是一件非常标准的事情（尤其是当涉及公钥加密时），那么你可以更好地控制在任何一个密钥下发送的密文数量，而不是通过篡改压缩。
下一点是，您可能也希望加密在某种程度上隐藏密文的长度。通过观察数据包的长度和频率，不难获得一些关于某人在TLS连接上所做事情的“元数据”。在某些情况下，加密前的压缩有助于降低“信号”的强度，但如果你担心流量分析，那么你可能应该做其他事情，比如填充到固定的长度——同样，压缩可以让糟糕的情况变得不那么糟糕，但它不会把糟糕的情况变成好的情况。
最后，您可能听说TLS协议中的压缩将在v1.3中被废除和禁止，或者至少我上次阅读草案时是这样。这与一般的压缩无关，而是因为TLS 1.2和早期标准中加密、填充、MAC和压缩的特定交互方式存在一些漏洞（CRIME、BEAST等）。这并不意味着你不能在更高的（应用）级别进行压缩，也不意味着压缩通常会削弱加密，只是它在实际的加密模块中没有位置，至少目前在TLS中没有这样做。
编辑
针对提出进一步问题的评论，以下是压缩如何帮助或伤害你的两个例子。
示例1你正在申请一份工作，你同意给你最好的朋友发一条加密信息，告诉你是否得到了这份工作。因为你在IT部门工作，一个简单的“是”或“否”是不行的——它必须是一个动画GIF，所以你准备了两个文件，是.GIF和否.GIF，因为你担心有人只看你密文的文件大小，所以你把它们都制作成64KB。但yes.gif充满了色彩、小马和彩虹，压缩后为60KB大——no.gif是一个更端庄的慢速黑白动画，压缩至4KB。加密程序会在加密前自动应用压缩。
在这种情况下，压缩会完全破坏您的安全性。
示例2
你已经放弃了动画GIF，并同意下次你想和朋友见面时，你会给他一封加密的电子邮件，简单地说“让我们下一天见面”。你的加密程序以8个字符（64位）块加密。如果你的信息是“让我们下周一见面”，那么它可以很好地分为3个区块，如果是“我们下周三见面”，那就是4个区块。再次失败。在这种情况下，把所有的日子“精神上压缩”成他们的前三个字母（“让我们下个星期三见面”）会拯救你。
总之，压缩通常不会帮助或损害加密；如果你通常必须处理长度相似但熵/可压缩性水平不同的消息，那么这可能弊大于利。
CRIME攻击之所以有效，是因为有一组非常特殊的情况，其中包括压缩，但不应适用于文件存储。