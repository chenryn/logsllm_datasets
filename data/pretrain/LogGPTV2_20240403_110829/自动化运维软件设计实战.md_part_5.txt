-e
-e
-e
-e
-e主
-e
-e
司
-e
内存简要信息："\t"$mem_info>>$path
一
系统环境变量："\t"$system_envirement_var>>Spath
逻辑cPU个数："\t"Slogic_cpu_num >> Spath
物理cPu个数："\t"Sphy_cpu>>Spath
磁盘使用用情况："\t""\t"Sdisk_usage>>Spath
操作系统版本："\t"Ssystem_version>>Spath
系统内核："\t"$system_core >> $path
主机名："\t"$system_hostname >> $path
/proc/meminfo
章
集中化运维利器一
-Ansible
---
## Page 40
Python的方式去对目标主机进行操作的。
么办呢？这个时候就可以使用raw模块了，这个模块是直接通过SSH的方式而不是通过
备上没有Python环境，Ansible的很多模块都用不了，但是又想执行一些简单的命令，怎
多需要客户机上有Python环境或者具备某些Python扩展才能够执行。假设我们管理的设
很好地完成这个巡检任务。这时可以用script模块完成主机的批量巡检。
自动化运维软件设计实战
get_url模块用于下载网络上的文件。
raw模块的参数及说明如表2.11所示。
例如，可以通过raw模块直接进行一些简单的命令：
相信大家都还记得前面所提到的Ansible，虽然不需要安装客户端，但是内置的模块大
4.SSH命令执行模块一
free_form
参
script模块参数及说明如表2.10所示。
可以看到整份脚本的命令数量是比较多的，采用 shell模块或者command模块都无法
1.下载模块一
2.4.3
free_form
executable
参
ansible all -m raw-a'ipa'
数
ansible all -M script -a'/root/demo/inspection.sh'
大的pid值线程/"\t"$system_load >> Spath
$system_uptime >>$path
数
网络相关模块
—get_url
必
必
是
否
是
填
填
-raw
表2.11raw模块的参数及说明
表2.10script模块参数及说明
默认值
默认值
选
5
项
改变执行命令所用的shell
需要执行的指令
需要执行的脚本
说
---
## Page 41
明如表2.13所示。
站发送如Get、Post 这样的 HTTP请求，并且能得到返回的状态码。uri 模块参数及其说
uri模块主要用于发送HTTP协议，通过使用uri模块，可以让目标主机向指定的网
use_proxy
sha256sum
get_url模块参数及说明如表2.12所示。
例：下载百度的首页。
force_basic_auth
follow_redirects
others
force
dest
HEADER
Web请求模块一
url
method
Creates
物
Body
数
ansible all -m get_url
Dest
数
必
否
是
否
否
否
是
必
-uri
否
否
否
否
否
否
否
表2.12get_url模块参数及说明
填
表2.13uri模块的参数及说明
-a'dest=/root url=http://www.baidu.com'
默认值
no
默认值
GET
no
no
屏
yes/no
yes/no
选
OPTIONS
DELETE
HEAD
PUT
POST
yes/no
yes/no
GET
集中化运维利器一
一
项
是否采用SHA-256校验和
下载文件的目标路径
文件模块的其他参数
URI模块是否应该遵
是否使用代理
强制在发送请求前发
文件下载路径
是否覆盖
循所有的重定向
说
送身份验证
文件下载路径
HTTP消息体
HTTP方法
文件名称
HTTP头
说
明
Ansible
明
---
## Page 42
是因为有了本地仓库这一概念，使得Git 可以脱离服务器进行版本的控制，等到需要提交
集中式版本管理工具不一样，它有本地仓库这个概念，如图2.3所示。
源码管理模块来实现，Git是目前比较流行的版本管理工具之一。
自动化运维软件设计实战
可证更为灵活的版本控制系统。
得BitKeeper的许可证并不适合开放源码社区的工作，因此Torvalds决定着手研究许
一直是Linux内核开发人员在全球使用的主要源代码工具。开放源码社区中的有些人觉
Linux内核而开发的一个开放源码的版本控制软件。
1)Git 是一款免费、开源的分布式版本控制系统。它是LinusTorvalds 为了帮助管理
在了解Git模块所提供的功能之前，我们先快速地了解一下Git这款工具，它与传统的
每当我们做资料的提交的时候，都会先提交到本地仓库，然后再提交到远端仓库。正
Torvalds 开始着手开发Git 是为了作为一种过渡方案来替代BitKeeper，后者之前
当我们需要做文件集中下发的时候，除了可以用copy这样的方式之外，其实还可以用
1.Git
2.4.4
return_content
status_code
timeout
removes
password
参
others
user
url
源码管理模块
数
资料
必
图2.3Git的本地仓库与远端仓库
否
是
否
K
否
否
否
否
填
本地仓库
默认值
200
no
yes/no
项
远端仓库
需要删除的文件名称
文件模块参数
url地址
超时限制
返回内容
用户名
状态码
密码
（续表）
---
## Page 43
作，完成文件从管理节点到目标主机的传输过程。Git模块参数及说明如表2.14所示。
件传送到远端的Git，接着通过Git模块命令目标主机执行Pull命令。通过这样一系列的操
新版本的动作叫作Pull。理解了这几个名词之后，我们再看看图2.4。
的动作叫作Commit，从本地仓库提交到服务器上的动作叫作Push，而从服务器上拉取最
了，或者网络能连接上服务器的时候，再从本地仓库进行一次批量提交。提交到本地仓库
executable
首先，我们在管理节点上把需要下发的文件commit到本地，然后通过Push操作将文
version
update
参
repo
remote
force
dest
depth
管理节点
否
否
是
否
否
否
是
否
填
图2.4使用Git模块完成文件管理
表2.14Git模块参数及说明
Push
默认值
HEAD
Pull命令
origin
no
#
Pull命令
Git
选
yes/no
yes/no
一
一
Pull
Pull
集中化运维利器一
创建一个浅克隆历史阶段到指定
目标主机A
目标主机B
是否更新远端仓库
Git的可执行路径
是否强制更新
代码克隆的位置
迁出的版本
仓库地址
远端的版本
说
的版本
明
-Ansible
---
## Page 44
可以自动处理依赖性关系，并且一次安装所有依赖的软件包，无须烦琐地一次次下载、安装。
的shell前端软件包管理器。基于RPM包管理，能够从指定的服务器自动下载RPM包并安装，
们可以非常容易地完成软件的安装。
自动化运维软件设计实战
install_recommends
例：使用YUM 模块安装最新的 httpd。
YUM（全称为Yellow dog Updater，Modified）是一个在Fedora和RedHat 以及CentOS 中
2.YUM
cache_valid_time
default_release
APT模块参数及说明如表2.15所示。
update_cache
例：使用APT模块安装JDK
Advanced Packaging Tool（APT）是Linux下的一款安装包管理工具。通过使用它，
1.APT
Ansible支持多种包管理模块，此处以APT和YUM为例。
2.4.5
upgrade
参
state
purge
pkg
force
apt: name=openjdk-6-jdk state=latest install_recommends=no
包管理模块
必
否
否
否
否
否
否
否
否
填
表2.15APT模块参数及说明
默认值
present
yes
true
1
一
选
present
absent
latest
yes/no
yes/no
yes/no
一
项
卸载后是否清除配置文件
apt-no-install-recommends
dist等同于dist-upgrade
full等同于full-upgrade
safe等同于safe-upgrade
安装前是否更新缓存
更新、删除、安装包
是否强制更新或删除
校验缓存是否过期
等同于apt-t
等同于
说
包名
明
我
---
## Page 45
置，它的格式共分为六个字段，前五段是时间设定段，第六段是要执行的命令段，格式如下：
配置好相关的参数，系统就会帮我们自动对作业进行定期的调度。
disable_gpg_check
在用户所建立的crontab 文件中，每一行都代表一项任务，每行的每个字段代表一项设
在Linux服务器中，定时任务一般由cron来承担，我们只需要按照cron所要求的格式
Ansible带有许多常用的系统管理模块，我们只讲解几个最常用的。
2.4.6
disablerepo
YUM模块参数及说明如表2.16所示。
其中：
1.作业管理模块一
enablerepo
conffile
参
minute表示分钟，可以是从0到59之间的任何整数；
hour表示小时，可以是从0到23之间的任何整数；
state
name
month表示月份，可以是从1到12之间的任何整数；
day表示日期，可以是从1到31之间的任何整数；
list
minute
yum:name=httpd state=latest
数
系统管理模块
hourdaymonthweek
必
cron
否
是
否
否
否
否
填
表2.16YUM模块参数及说明
默认值