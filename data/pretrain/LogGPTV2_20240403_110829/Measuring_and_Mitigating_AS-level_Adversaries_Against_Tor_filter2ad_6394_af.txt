selected network-level attackers. Since it is not yet clear if
network-level adversaries pose a larger threat than relay-level
adversaries. Therefore, determining this threshold is a non-
trivial open research problem.
VI. DISCUSSION
In this section, we compare the Astoria Tor client with
the hypothetical perfect Tor client and discuss how Astoria
can be augmented and improved with recent and ongoing
developments from the network measurement community.
A. Comparing Astoria and the perfect Tor client
Here we point out some of the shortcomings of Astoria
when compared to the perfect Tor client. We ﬁnd that many
of these apply to any AS-aware client. The perfect Tor client
is able to simultaneously achieve three conﬂicting goals:
Defend against network-level attackers. The perfect Tor
client is able to prevent compromise from network-level at-
tackers. In particular, the client constructs circuits that are safe
from trafﬁc correlation attacks.
While such adversaries are largely ignored by the vanilla
Tor client, Astoria successfully deals with them by utilizing
efﬁcient path-prediction tools to explicitly avoid relays that
enable correlation attacks. However, Astoria does not currently
deal with attacks from active network-level adversaries that are
able to exploit BGP dynamics. In addition, Astoria is unable to
exactly predict the paths that will be utilized to communicate
with each Tor relay, and therefore only makes estimates (which
are validated to be reasonably tight estimates).
Defend against relay-level attackers. Since the Tor network
is volunteer driven, it is critical for the perfect Tor client to
be able to defend against passive and active attackers that are
able to control a fraction of all relays within the network.
This primarily involves (1) constructing circuits so that the
probability of an adversarial pair of relays occupying the entry-
and exit-hop of the circuit is low, and (2) ensuring that no
single relay should be able to conclusively link the source and
destination of the circuits it is on.
While the vanilla Tor client is able to successfully mitigate
threats from many types of relay-level attacks, we ﬁnd that
this is challenging for AS-aware clients such as Astoria. First,
while the concept of entry-guards mitigates many threats from
relay-level attackers, it has a negative inﬂuence on the number
of safe circuits that can be built by AS-aware clients. Second,
AS-aware circuits inherently leak some information about the
source and destination of the circuit. Our analysis in Section
V-D shows that in the average-case, Astoria circuits are safe
from de-anonymization due to these leaks.
Maintain performance and load-balancing. The perfect Tor
client must also perform load-balancing to ensure that no single
set of relays in the network are overloaded, while providing
reasonable performance for all its users.
In Section V we demonstrated that Astoria performs load-
balancing in an identical manner to the vanilla Tor client and
page-loads are only slightly slower in most cases. There are
two main reasons for Astoria’s increased page-load times: (1)
Path prediction is expensive, and (2) Astoria loses the ability
to pre-emptively construct circuits. While (1) is unavoidable,
there are interesting future research questions regarding (2)
– e.g., can smart caching and pre-emptive/predictive circuit
construction for a set of popular/predicted destinations result
in signiﬁcant performance gains?
B. Improving path-prediction accuracy
Measuring the potential
threat of correlation attacks is
made challenging by the fact that it requires measuring both
forward and reverse network paths between the client and
entry, and exit and destination, respectively. Thus, we opt
to leverage an up-to-date map of the Internet’s topology,
augmented with inferred business relationships between net-
works and a model of routing policies to infer network paths.
Modeling of interdomain routing is a thorny issue and we
take care to avoid well known pitfalls including complex
business relationships (e.g., ASes that act as a customer in one
geographic region, and a peer in others) and sibling ASes (ie.,
multiple ASes which correspond to a single organization). The
issue of siblings ASes is particularly relevant in our context,
as multiple ASes controlled by a single organization may
share information to perform a correlation attack. Despite all
this, accurate path prediction remains an open challenge. In a
related study, we validate the accuracy of this approach and
ﬁnd that measured paths follow this model 65-85% of the time
[10]. As a result, the numbers we observe should be taken as
an estimate of the threat.
We note that novel path measurement tools are on the
horizon (e.g., Sibyl [17]) that take into account richer vantage
point sets than prior work (e.g., PlanetLab used by iPlane [28]
vs. RIPE Atlas [35] used by Sibyl). An interesting future
direction is determining how such measurement planes can
be integrated into a Tor client (e.g., to operate in an ofﬂine
mode or via a secured querying interface).
VII. CONCLUSIONS
We have leveraged highly-optimized algorithmic simula-
tions of interdomain routing on empirically-derived AS-level
topologies to quantify the potential for correlation attacks
where an adversary can leverage asymmetric Internet routing
and collude with others within the same organization. Our
results show that a signiﬁcant number of Tor circuits are
vulnerable to AS- and state-level attackers.
To mitigate the threat from such attackers, we developed
Astoria—an AS-aware Tor client. Beyond providing a high-
level of security against these attacks, Astoria also has perfor-
mance that is within a reasonable distance from the current Tor
client. Also, unlike other AS-aware Tor clients, Astoria also
considers how circuits should be built in the worst case, i.e.,
when there are no safe relays available to the client. Further,
Astoria is a good network citizen and is designed to ensure
that the all circuits created by it are load-balanced across the
volunteer-driven Tor network.
Our work highlights the importance of applying current
models and data from network measurements to inform relay
selection so as to protect against timing attacks. Astoria also
opens multiple avenues for future work such as integrating
real-time hijack and interception detection systems (to fully
counter RAPTOR [39] attacks) and understanding how new
measurement services can be leveraged by a Tor client without
defeating anonymity.
Source code: The source code of the Astoria client is available
under the CRAPL 4 license at http://nrg.cs.stonybrook.edu/
astoria-as-aware-relay-selection-for-tor/.
ACKNOWLEDGMENTS
We would like to thank Ruwaifa Anwar, Haseeb Niaz,
and Abbas Razaghpanah for their help with integrating sibling
detection algorithms into our measurement toolkit.
This material is based upon work supported by the National
Science Foundation under Grant No. CNS-1350720, a Google
Faculty Research Award, ISF grant 420/12, Israel Ministry
of Science Grant 3-9772, Marie Curie Career Integration
Grant, Israeli Center for Research Excellence in Algorithms
(I-CORE), and an Open Technology Fund Emerging Tech-
nology Fellowship. Any opinions, ﬁndings, and conclusions
or recommendations expressed in this material are those of
the author(s) and do not necessarily reﬂect the views of the
National Science Foundation, Google, the Israel Ministry of
Science, or the Open Technology Fund.
REFERENCES
“Alexa top sites,” http://www.alexa.com/.
“Collection of censorship blockpages as collected by various sources,”
https://github.com/citizenlab/blockpages.
“How the nsa attacks tor/ﬁrefox users with quantum and foxacid,” https:
//www.schneier.com/blog/archives/2013/10/how the nsa att.html.
[1]
[2]
[3]
4http://matt.might.net/articles/crapl/
14
Proceedings on Privacy Enhancing Technologies, vol. 2015, no. 2, pp.
1–17, 2015.
[27] E. Katz-Bassett, H. V. Madhyastha, V. K. Adhikari, C. Scott, J. Sherry,
P. van Wesep, T. E. Anderson, and A. Krishnamurthy, “Reverse tracer-
oute,” in Proceedings of the 7th USENIX Symposium on Networked
Systems Design and Implementation, NSDI 2010, April 28-30, 2010,
San Jose, CA, USA, 2010, pp. 219–234.
[28] H. V. Madhyastha, T. Isdal, M. Piatek, C. Dixon, T. Anderson, A. Kr-
ishnamurthy, and A. Venkataramani, “iPlane: an information plane for
distributed services,” in OSDI, 2006.
J. McLachlan and N. Hopper, “On the risks of serving whenever you
surf: Vulnerabilities in Tor’s blocking resistance design,” in Proceedings
of the Workshop on Privacy in the Electronic Society (WPES 2009).
ACM, November 2009.
[29]
[30] S. J. Murdoch and G. Danezis, “Low-cost trafﬁc analysis of tor,” in
Proceedings of the 2005 IEEE Symposium on Security and Privacy,
ser. SP ’05. Washington, DC, USA: IEEE Computer Society, 2005,
pp. 183–195.
[31] S. J. Murdoch and P. Zieli´nski, “Sampled trafﬁc analysis by internet-
exchange-level adversaries,” in Proceedings of the 7th International
Conference on Privacy Enhancing Technologies, ser. PET’07. Berlin,
Heidelberg: Springer-Verlag, 2007, pp. 167–183.
J. Qiu and L. Gao, “Cam04-4: As path inference by exploiting known as
paths,” in Global Telecommunications Conference, 2006. GLOBECOM
’06. IEEE, Nov 2006, pp. 1–5.
[32]
[33] B. Quoitin and S. Uhlig, “Modeling the routing of an autonomous
system with c-bgp,” Netwrk. Mag. of Global Internetwkg., vol. 19, no. 6,
pp. 12–19, Nov. 2005.
J. Rice, Mathematical Statistics and Data Analysis, ser. Duxbury
advanced series. Duxbury Press, 1995, no. v. 1.
[34]
[35] RIPE NCC, “RIPE atlas,” http://atlas.ripe.net.
[36] X. Shi, Y. Xiang, Z. Wang, X. Yin, and J. Wu, “Detecting preﬁx
hijackings in the internet with argus,” in Proceedings of the 2012 ACM
Conference on Internet Measurement Conference, ser. IMC ’12. New
York, NY, USA: ACM, 2012, pp. 15–28.
[37] V. Shmatikov and M.-H. Wang, “Timing analysis in low-latency mix
networks: Attacks and defenses,” in Proceedings of ESORICS 2006,
September 2006.
[38] P. Smith, “Bgp routing table analysis,” http://thyme.apnic.net/.
[39] Y. Sun, A. Edmundson, L. Vanbever, O. Li, J. Rexford, M. Chiang,
and P. Mittal, “Raptor: Routing attacks on privacy in tor,” pp. 271–286,
Aug. 2015.
[40] L. Vanbever, O. Li, J. Rexford, and P. Mittal, “Anonymity on quicksand:
the 13th ACM
Using bgp to compromise tor,” in Proceedings of
Workshop on Hot Topics in Networks, ser. HotNets-XIII. New York,
NY, USA: ACM, 2014, pp. 14:1–14:7.
[41] C. Wacek, H. Tan, K. S. Bauer, and M. Sherr, “An empirical evaluation
of relay selection in tor,” in 20th Annual Network and Distributed
System Security Symposium, NDSS 2013, San Diego, California, USA,
February 24-27, 2013, 2013.
[42] T. M. P. website, “Tor project: Anonimity online,” Available at
https://metrics.torproject.org.
[43] P. Winter and S. Lindskog, “How the Great Firewall of China is blocking
Tor,” in Proceedings of the USENIX Workshop on Free and Open
Communications on the Internet (FOCI 2012), August 2012.
[4]
[5]
[6]
[7]
[8]
“The lifecycle of a new relay – the tor blog,” https://blog.torproject.org/
blog/lifecycle-of-a-new-relay.
“Nsa stores metadata of millions of web users for up to a year,
secret ﬁles show,” http://www.theguardian.com/world/2013/sep/30/nsa-
americans-metadata-year-documents.
“Selenium web browser automation,” http://www.seleniumhq.org/.
“’Tor
interactive/2013/oct/04/tor-stinks-nsa-presentation-document.
“Torspec – tor’s protocol speciﬁcations,” https://gitweb.torproject.org/
torspec.git/tree/path-spec.txt.
http://www.theguardian.com/world/
Stinks’
presentation,”
[9] M. Akhoondi, C. Yu, and H. V. Madhyastha, “Lastor: A low-latency
as-aware tor client,” in Proceedings of the 2012 IEEE Symposium on
Security and Privacy, ser. SP ’12. Washington, DC, USA: IEEE
Computer Society, 2012, pp. 476–490.
[10] R. Anwar, H. Niaz, D. Choffnes, I. Cunha, P. Gill, and E. Katz-Bassett,
“Investigating interdomain routing policies in the wild,” in Proceedings
of the 2015 ACM Conference on Internet Measurement Conference, ser.
IMC ’15. New York, NY, USA: ACM, 2015, pp. 71–77.
[11] N. Borisov, G. Danezis, P. Mittal, and P. Tabriz, “Denial of service or
denial of security?” in Proceedings of the 14th ACM Conference on
Computer and Communications Security, ser. CCS ’07. New York,
NY, USA: ACM, 2007, pp. 92–102.
[12] CAIDA, “ HIJACKS: Detecting and Characterizing Internet Trafﬁc
Interception based on BGP Hijacking .”
[13] N. Danner, S. DeFabbia-Kane, D. Krizanc, and M. Liberatore, “Effec-
tiveness and detection of denial of service attacks in Tor,” Transactions
on Information and System Security, vol. 15, no. 3, pp. 11:1–11:25,
2012.
[14] R. Dingledine, “Improving tor’s anonymity by changing entry guard
parameters,” The Tor Blog.
[15] R. Dingledine, N. Mathewson, and P. Syverson, “Tor: The second-
generation onion router,” in Proceedings of the 13th USENIX Security
Symposium, August 2004.
[16] M. Edman and P. Syverson, “As-awareness in tor path selection,” in
Proceedings of the 16th ACM Conference on Computer and Commu-
nications Security, ser. CCS ’09. New York, NY, USA: ACM, 2009,
pp. 380–389.
[17] Ethan Katz-Bassett and Pietro Marchetta and Matt Calder and Yi-Ching
Chiu and Italo Cunha and Harsha Madhyastha and Vasileios Giotsas,
“Sibyl: A Practical Internet Route Oracle.”
[18] N. Feamster and R. Dingledine, “Location diversity in anonymity
networks,” in Proceedings of the 2004 ACM Workshop on Privacy in
the Electronic Society, ser. WPES ’04. New York, NY, USA: ACM,
2004, pp. 66–76.
[19] Freedom House, “Freedom on the Net 2014.”
[20] L. Gao, “On inferring autonomous system relationships in the internet,”
IEEE/ACM Trans. Netw., vol. 9, no. 6, pp. 733–745, Dec. 2001.
[21] L. Gao and J. Rexford, “Stable internet routing without global coordi-
nation,” IEEE/ACM Transactions on Networking (TON), vol. 9, no. 6,
pp. 681–692, 2001.
[22] P. Gill, M. Schapira, and S. Goldberg, “Modeling on quicksand:
Dealing with the scarcity of ground truth in interdomain routing data,”
SIGCOMM Comput. Commun. Rev., vol. 42, no. 1, pp. 40–46, Jan.
2012.
[23] V. Giotsas, M. Luckie, B. Huffaker, and k. claffy, “Inferring complex
as relationships,” in Proceedings of the 2014 Conference on Internet
Measurement Conference, ser. IMC ’14. New York, NY, USA: ACM,
2014, pp. 23–30.
[24] A. Houmansadr and N. Borisov, “Swirl: A scalable watermark to
detect correlated network ﬂows,” in Proceedings of the Network and
Distributed Security Symposium - NDSS’11.
Internet Society, February
2011.
[25] A. Johnson, C. Wacek, R. Jansen, M. Sherr, and P. Syverson, “Users
get routed: Trafﬁc correlation on tor by realistic adversaries,” in
Proceedings of the 2013 ACM SIGSAC Conference on Computer &#38;
Communications Security, ser. CCS ’13. New York, NY, USA: ACM,
2013, pp. 337–348.
J. Juen, A. Johnson, A. Das, N. Borisov, and M. Caesar, “Defending
tor from network adversaries: A case study of network path prediction,”
[26]
15