日志学院
前言
日志分析利器——SPL
一个日志分析项目包括以下环节：
1、分析环境部署；
2、日志接入；
3、日志结构化解析；
4、日志分析；
5、可视化展现；
6、监控告警及报表呈现。
在初级部分，我们已经简单了解了日志易产品在上述各个环节的使用流程。要冲锋陷阵，光
有器在手还不够，还得是趁手的利器。
日志分析项目的实施主体是日志分析。仅靠初级部分学习的简要统计，是无法满足企业监控
及分析需求的。为应对复杂分析场景，日志易SPL（SearchProcessingLanguage）搜索分析
语句应运而生。
在日志易中，对日志数据进行处理使用SPL语句。可以参考Excel表格理解日志易SPL语句
的处理过程。在Excel表格中，虽然能够清晰明了的观测到每行每列的数据，但要对数据进
行处理，还需要使用计算函数，如VLOOKUP函数。
如同Excel需要格式化的表格数据一般，使用SPL语句对日志进行处理也对日志的格式有一
定要求。只有将不规则的文本数据转化为规则的字段形式，才能使用SPL对日志的各个字段
进行处理。这个过程被称为日志解析。初级我们已经学习过日志解析中最常用的正则解析。
将日志进行结构化处理（日志解析）后，再使用SPL对日志字段进行处理，将处理后得到的
指标或图表保存下来以便客户即时查看，这便是日志分析的价值所在。
在中级培训环节，我们将带领您掌握最常用的若干SPL语句，以便您在日志分析时能为客户
呈现出各种指标数据。
为了使您在项目实施时更加游刃有余，中级部分的学习，还会介绍更多常用的日志解析方法，
以便为您的日志分析提供必备要素；了解日志易可视化工具的更多使用方法，可以使您的可
视化更具展现力；了解监控告警及定时任务，可以拓宽日志分析的应用范围；了解日志易系
统的维护方法，可以便您的日志分析系统更加可控；了解日志分析项目的命名标准及规范，
可以使项目交接及后续维护更加方便省时。
中级部分的材料会从日志采集的注意要点说起，以加深您对日志分析的流程的认知。
1
日志学院
目录
前言.....................................................................................................................................................1
目录.....................................................................................................................................................2
1. 日志采集........................................................................................................................................7
1.1. 划分日志搜索权限.............................................................................................................7
新建搜索权限.....................................................................................................................9
搜索权限的授权...............................................................................................................10
搜索权限临时授权tmp-share........................................................................................11
1.2. 日志采集的方法与技巧...................................................................................................11
多行合并...........................................................................................................................12
数据压缩...........................................................................................................................19
数据加密...........................................................................................................................20
Agent资源控制................................................................................................................22
复杂目录处理...................................................................................................................24
Agent配置分发................................................................................................................32
Agent分组采集................................................................................................................33
Agent升级及管理............................................................................................................35
1.3. 其他数据源的接入...........................................................................................................37
Syslog数据接入...............................................................................................................37
脚本及命令采集...............................................................................................................39
Windows事件日志采集..................................................................................................40
数据库数据采集...............................................................................................................41
1.4. 数据备份...........................................................................................................................43
日志原文备份（heka）...................................................................................................43
备份策略（archiver）.....................................................................................................49
1.5. 入库优先级.......................................................................................................................51
1.6. 数据集...............................................................................................................................53
新建数据集.......................................................................................................................56
数据集父子关系...............................................................................................................60
数据集的展示和使用.......................................................................................................61
2. 日志解析......................................................................................................................................64
2.1. 日志解析规则简述...........................................................................................................64
规则与appname、tag的关系.......................................................................................64
解析规则与解析项...........................................................................................................65
内置规则...........................................................................................................................66
解析原则...........................................................................................................................66
2.2. 常用解析算子...................................................................................................................67
正则解析...........................................................................................................................68
JSON解析.........................................................................................................................72
KeyValue分解..................................................................................................................72
KeyValue正则匹配..........................................................................................................73
CSV解析...........................................................................................................................75
自定义字典.......................................................................................................................75
XML解析..........................................................................................................................79
时间戳识别.......................................................................................................................80
数值型字段转换...............................................................................................................81
2
日志学院
格式化处理.......................................................................................................................82
删除字段...........................................................................................................................83
内容替换...........................................................................................................................84
UserAgent解析...............................................................................................................85
URL解码...........................................................................................................................85
Syslog_pri解析.................................................................................................................86
IP格式转换.......................................................................................................................86
手机号码解析...................................................................................................................87
固定电话解析...................................................................................................................88
Hex转换...........................................................................................................................88
geo解析...........................................................................................................................89
脱敏配置...........................................................................................................................89
字段重命名.......................................................................................................................93
结构体解析.......................................................................................................................94
重定向解析.......................................................................................................................95
自定义解析.......................................................................................................................96
2.3. 规则管理.........................................................................................................................104
算子的条件控制.............................................................................................................104
规则验证.........................................................................................................................105
规则运行状况查看.........................................................................................................108
规则管理.........................................................................................................................110
3.SPL...............................................................................................................................................112
3.1.SPL....................................................................................................................................112
初识SPL..........................................................................................................................112
小试牛刀.........................................................................................................................114
画龙点睛.........................................................................................................................125
爬梳剔抉.........................................................................................................................128
一脉相通.........................................................................................................................142
高歌猛进.........................................................................................................................150
附件：.............................................................................................................................150
3.2. 高级搜索视图.................................................................................................................150
序列.................................................................................................................................154
维度.................................................................................................................................164
关系.................................................................................................................................168
复合.................................................................................................................................174
地图.................................................................................................................................176
其他.................................................................................................................................179
3.3. 客户场景分析实践.........................................................................................................186
指标分析.........................................................................................................................186
趋势分析.........................................................................................................................190
4. 数据展现....................................................................................................................................193
4.1. 仪表盘标签页管理.........................................................................................................194
图表布局调整.................................................................................................................196
事件列表.........................................................................................................................197
时间范围选择.................................................................................................................200
过滤项.............................................................................................................................200
输入项.............................................................................................................................205
标签页高级编辑.............................................................................................................207
3
日志学院
4.2. 仪表盘图表管理.............................................................................................................208
图表类型.........................................................................................................................209
图表配置.........................................................................................................................210
通用配置.........................................................................................................................211
钻取配置.........................................................................................................................212
高级编辑.........................................................................................................................220
恢复初始.........................................................................................................................229
4.3. 仪表盘应用实例.............................................................................................................229
仪表盘实例.....................................................................................................................229
自动登录查看仪表盘的方式........................................................................................235
5. 定时任务....................................................................................................................................237
5.1. 创建定时任务.................................................................................................................237
5.2. 修改定时任务.................................................................................................................240
5.3. 定时任务结果.................................................................................................................241
定时任务结果查询.........................................................................................................241
将定时任务结果保存到数据库....................................................................................242
5.4. 定时任务数据补采.........................................................................................................243
补采任务界面管理.........................................................................................................243
5.5. 定时任务应用实例.........................................................................................................244
6. 监控告警....................................................................................................................................245
6.1. 配置监控.........................................................................................................................245
基础配置.........................................................................................................................246
告警类型.........................................................................................................................250
设备切分.........................................................................................................................257
高级配置.........................................................................................................................258
6.2. 告警方式.........................................................................................................................262
告警内容模板.................................................................................................................263
告警方式.........................................................................................................................272
告警插件开发.................................................................................................................277
6.3. 查看告警记录.................................................................................................................282
监控运行记录到单独索引monitor里.........................................................................282
6.4. 维护期.............................................................................................................................283
6.5. 告警应用实例.................................................................................................................284
日志陡变监控.................................................................................................................285
基线告警.........................................................................................................................286
告警归并.........................................................................................................................286
7. 日志分析过程最佳实践............................................................................................................289
7.1. 日志分析流程.................................................................................................................289
前期规划.........................................................................................................................289
权限分配及用户创建....................................................................................................289
日志采集及解析.............................................................................................................289
日志搜索.........................................................................................................................290
日志分析.........................................................................................................................290
7.2. 用户角色权限管理.........................................................................................................290
7.3.appname、tag规划.......................................................................................................291
7.4. 日志采集规范.................................................................................................................293
7.5. 字段提取规范.................................................................................................................293
7.6. 图表配置规范.................................................................................................................294
7.7. 告警配置规范.................................................................................................................294
4
日志学院
告警发送规范.................................................................................................................294
告警案例.........................................................................................................................295
告警监控指标.................................................................................................................297
8. 产品管理....................................................................................................................................299
8.1. 系统配置.........................................................................................................................299
Logo修改.......................................................................................................................300
消息提醒.........................................................................................................................300
邮箱配置.........................................................................................................................301
8.2. 下载管理.........................................................................................................................303
8.3. 使用限额.........................................................................................................................305
8.4. 结算管理.........................................................................................................................305
8.5. 搜索用量.........................................................................................................................308
8.6. 租户管理.........................................................................................................................308
更改超限次数.................................................................................................................309
产品特性添加.................................................................................................................310
系统状态.........................................................................................................................311
创建租户.........................................................................................................................312
租户外观.........................................................................................................................314
Agent升级包管理.........................................................................................................314
8.7. 产品路径结构.................................................................................................................316
9.Manager......................................................................................................................................318
9.1. 日志易Manager说明....................................................................................................318
9.2.Manager集群扩展..........................................................................................................320
9.3. 版本管理.........................................................................................................................321
大版本升级.....................................................................................................................321
更新日志易安装包.........................................................................................................322
更新日志易后台版本....................................................................................................324
更新日志易后台license................................................................................................326
更新Agent的版本........................................................................................................326
更新server的版本........................................................................................................327
9.4. 模块管理功能.................................................................................................................327
添加/删除Agent服务器上运行的服务.......................................................................327
启动/停止/重启服务......................................................................................................329
查看服务配置及日志文件............................................................................................329
修改服务配置及模板文件............................................................................................330
修改模块配置参数.........................................................................................................330
9.5. 监控功能.........................................................................................................................331
系统整体运行情况.........................................................................................................331
业务模块查看.................................................................................................................332
Agent服务器查看.........................................................................................................333
9.6. 性能管理.........................................................................................................................335
Agent上报机制.............................................................................................................335
性能指标.........................................................................................................................336