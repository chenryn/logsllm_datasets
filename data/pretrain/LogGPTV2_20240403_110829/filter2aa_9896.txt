**ANALYZE(7) — SQL 命令**

**名称**
ANALYZE — 收集与数据库相关的统计信息

**概要**
```
ANALYZE [VERBOSE] [table [ (column [, ...]) ]]
```

**描述**
`ANALYZE` 命令用于收集有关 PostgreSQL 表内容的统计信息，并将这些信息存储在系统表 `pg_statistic` 中。查询规划器可以使用这些统计信息来确定最有效的查询执行计划。

- 如果不提供任何参数，`ANALYZE` 会检查当前数据库中的所有表。
- 如果指定了表名，则只对该表进行分析。
- 可以进一步指定列名，这样仅收集这些特定列的统计信息。

**参数**
- **VERBOSE**：启用此选项后，`ANALYZE` 将显示处理过程中的详细信息。
- **table**：需要分析的具体表（可带有模式名）。默认情况下，是当前数据库中的所有表。
- **column**：需要分析的具体字段。默认为表中的所有字段。

**输出**
当启用了 VERBOSE 选项时，`ANALYZE` 将显示正在处理的行的信息以及关于该表的其他相关信息。

**注意事项**
- 定期运行 `ANALYZE` 或者在对表进行了大量更改之后立即运行它是一种良好的实践。准确的统计信息有助于规划器选择最佳的查询计划，从而提高查询处理速度。一种常见的策略是在低负载期间每天运行一次 `VACUUM` 和 `ANALYZE`。
- 与 `VACUUM FULL` 不同，`ANALYZE` 只需要对目标表进行读取锁定，因此它可以与其他针对该表的操作并行执行。
- 收集的统计信息通常包括每个字段最常见的值列表及一个近似表示数据分布的直方图。如果 `ANALYZE` 判断这些信息无用（例如，在唯一键字段上没有共同值），或者字段的数据类型不支持相关操作符，则可能忽略它们。更多详情请参见第21章“常规数据库维护”。
- 对于大型表，`ANALYZE` 通过随机抽样而不是逐行检查来估算统计信息。这确保了即使对于非常大的表也能快速完成分析。但请注意，由于基于采样的性质，每次执行 `ANALYZE` 后，EXPLAIN 显示的预期开销可能会略有不同，即便实际数据未发生变化。为了减少这种不确定性带来的影响，可以通过调整统计收集的数量来改进准确性。
- 可以通过设置 `default_statistics_target` 参数或使用 `ALTER TABLE ... ALTER COLUMN ... SET STATISTICS` 命令按字段调整统计目标，以此控制分析的深度。默认的目标值为10，但可以根据需求调整以平衡规划器精度、`ANALYZE` 执行时间和 `pg_statistic` 表的空间占用。特别是对于那些从未出现在 WHERE、GROUP BY 或 ORDER BY 子句中的字段，将其统计目标设为零（即关闭统计收集）可能是有用的，因为规划器不会利用这些字段上的统计信息。
- 在被分析的所有字段中，最大的统计目标决定了用于统计采样的表中行数。增加目标值会导致 `ANALYZE` 的时间和空间需求成比例增长。

**兼容性**
SQL 标准中并未定义 `ANALYZE` 语句。

**翻译者**
- Postgresql 中文网站
- 何伟平