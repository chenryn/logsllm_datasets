与linux不同,aix系统日志主要是通过命last,who,failedlogin,errpt,
aix,nmon采集系统信息为主。
##### Aix操作系统日志关键字段
同一种系统，建议日志格式、时间戳保持一致，通过对aix系统主要几个日志分析，梳理出日志中关键的几个字段，包含**时间戳(timestamp)**、**syslog头部中日志级别(pri)**、**IP(ip)**、**用户(user)**、**主机名
(hostname)**、**动作(action)及服务(program)**等关键字段。
syslog日志：通过对aix系统主要几个日志分析，梳理出日志中关键的几个字段，包含**syslog头部中日志级别(pri)、时间戳(timestamp)**、**主机名
(hostname)**、**IP(ip)**、**用户(user)**、**动作(action)及服务(program)**等关键字段。
时时间戳使用同一种格式，如：May 01 15:00:00.000
##### Aix操作系统日志输出
aix操作系统日志输出匹配规则可参见如下:
![](media/image2.png){width="5.768055555555556in"
height="3.3534722222222224in"}
#### windows系统日志
本规范适用windows操作系统2003及其以上版本日志规范，对于其它操作系统或者较低版本的系统类型，不在本规范适用范围内。
##### windows操作系统日志
通过windows版本agent方式采集事件日志，一般采集window系统的日志为system日志、application日志、security日志，日志范围包括但不限于windows系统、域控和服务等日志。
##### windows操作系统日志关键字段
通过对windows系统system日志、application日志、security日志分析，梳理出日志中关键的几个字段，包含**时间戳(timestamp)**、**主机名(hostname)**、**IP(ip)**、**用户(user)**、**事件ID(eventid)**、**及详情信息(mes)**等关键字段。
##### windows操作系统日志输出
windows操作系统日志输出匹配规则可参见如下:
![](media/image3.png){width="5.768055555555556in"
height="1.0604166666666666in"}
PS:windows系统以日志中eventid做初步分析，如下为通过eventid来进行windows系统相关分析案例：
![](media/image4.png){width="5.768055555555556in"
height="3.088888888888889in"}
### 网络设备日志规范
本规范适用通用网络设备(交换机、路由器等)日志规范，对于其它非常见品牌类型，不在本规范适用范围内。
#### 交换机设备日志
##### 1.5.11.1.1适用范围 {#适用范围-1 .list-paragraph}
交换机设备常见的有思科、华为、华三、juniper、锐捷等厂商设备，通过配置syslog上传至日志平台。
##### 1.5.11.1.2日志关键字段 {#日志关键字段 .list-paragraph}
同一种设备，建议日志格式、时间戳保持一致，通过对通用常见交换机设备日志分析，梳理出日志中关键的几个字段，包含**syslog头部中日志级别(pri)**、**时间戳(timestamp)**、**主机名(hostname)**、**IP(ip)**、**模块(module)及详情信息(desc)**等关键字段。
时间戳使用同一种格式，如：Nov 30 08:59:00 2020
样例：\ Nov 30 08:59:00 2020 DOYFW04BHS-SCL4-M9016-V
%%10session/6/SESSION_IPV4_FLOW: -Slot=3.1;
Protocol(1001)=UDP;Application(1002)=gtp-user;SrcIPAddr(1003)=117.142.193.134;SrcPort(1004)=62910;NatSrcIPAddr(1005)=117.142.193.134;NatSrcPort(1006)=62910;DstIPAddr(1007)=117.142.196.17;DstPort(1008)=2152;NatDstIPAddr(1009)=117.142.196.17;NatDstPort(1010)=2152;InitPktCount(1044)=0;InitByteCount(1046)=0;RplyPktCount(1045)=0;RplyByteCount(1047)=0;RcvVPNInstance(1042)=;SndVPNInstance(1043)=;RcvDSLiteTunnelPeer(1040)=;SndDSLiteTunnelPeer(1041)=;BeginTime_e(1013)=11302020085829;EndTime_e(1014)=11302020085901;Event(1048)=(2)Aged
for timeout;
##### 1.5.11.1.3日志输出规则 {#日志输出规则 .list-paragraph}
交换机设备日志输出匹配规则可参见如下:
![](media/image5.png){width="5.768055555555556in"
height="0.9888888888888889in"}
#### 路由器设备日志
##### 1.5.11.2.1适用范围 {#适用范围-2 .list-paragraph}
路由器设备常见的有思科、华为、华三、锐捷等厂商设备，通过配置syslog上传至日志平台。
##### 1.5.11.2.2日志关键字段 {#日志关键字段-1 .list-paragraph}
同一种设备，建议日志格式、时间戳保持一致,通过对通用常见路由器设备日志分析，梳理出日志中关键的几个字段，包含**syslog头部中日志级别(pri)**、**时间戳(timestamp)**、**主机名(hostname)**、**IP(ip)**、**模块(module)及详情信息(desc)**等关键字段。
##### 1.5.11.2.3日志输出规则 {#日志输出规则-1 .list-paragraph}
路由器设备日志输出匹配规则可参见如下:
![](media/image6.png){width="5.768055555555556in"
height="0.9888888888888889in"}
### 安全设备日志规范
##### 1.5.12.1适用范围 {#适用范围-3 .list-paragraph}
常见的安全设备类型有ddos(常见的厂商有飞塔等)，waf(常见的厂商有f5、绿盟、天融信、飞塔、山石等)，tda(常见的厂商有亚信等)，ips(常见的厂商有华为、绿盟、juniper、飞塔、天融信等)，ids(常见的厂商有华为、绿盟、天融信、启明星辰等)，firwall(常见的厂商有思科、华三、绿盟、启明星辰等)等，通过配置syslog上传至日志平台。
##### 1.5.12.2日志关键字段 {#日志关键字段-2 .list-paragraph}
同一种设备，建议日志格式、时间戳保持一致，通过对通用常见安全设备日志分析，梳理出日志中关键的几个字段，包含**syslog头部中日志级别(pri)**、**时间戳(timestamp)**、**主机名(hostname)**、**IP(ip)**、**模块(module)**、**动作(action)及详情信息(desc)**等关键字段。
##### 1.5.12.3日志输出规则 {#日志输出规则-2 .list-paragraph}
交换机设备日志输出匹配规则可参见如下:
![](media/image7.png){width="5.768055555555556in" height="0.9875in"}
### 中间件日志规范
#### 适用范围
根据中间件定义范畴，可以将常用中间件划分为消息中间件、数据库中间件、应用中间件等，其中消息中间件有redis、mq、kafka、rabbitmq等，
数据中间件有mysql、oracle、db2、sqlserver等，应用中间件有iis、tomcat、was、weblogic等。
#### 日志关键字段
同一种应用，建议日志格式、时间戳保持一致，通过对通用中间件日志分析，梳理出日志中关键的几个字段，包含**时间戳(timestamp)**、**日志级别
(level)**、**模块(module)或子模块(submodule)**、**IP(IP)或者主机名(hostname)**、**进程号(processid)或线程号(threadid)及详情信息(msg)**等关键字段。
#### 日志输出规则
如下以weblogic日志文件，例举应用中间件日志规则:
![](media/image8.png){width="5.768055555555556in"
height="0.5131944444444444in"}
如下以mysql日志文件，例举数据库中间件日志规则:
![](media/image9.png){width="5.768055555555556in"
height="0.6145833333333334in"}
对于数据库内部基础工作状态分析，一般相关数据落地为xml文件，或者存储在数据库内部表中，此时通过采集解析xml文件或对接采集数据库性能相关数据作为数据库日志分析的辅助依据。如下以oracle数据库为例：
![](media/image10.png){width="6.257638888888889in"
height="4.159027777777778in"}
### 应用日志规范
#### 适用范围
本规范适用于承载联机交易类业务的应用系统，对于数据类系统、批处理、不涉及到跨系统调用的应用系统，不在本规范适用范围内。
#### 日志输出规则
##### 1.5.14.2.1日志分离 {#日志分离 .list-paragraph}
为了更快更准确地检索日志，日志文件应按法人行分开输出、按日期分开输出。
##### 1.5.14.2.2日志目录结构 {#日志目录结构 .list-paragraph}
日志的目录深度不可超过5层，且目录结构中不可出现空格、中文和特殊字符。目录结构规则如下：
....../日期/成员行/....../日志文件名.log
说明：
1)  **日期**：自然日，格式为YYYYMMDD，例如20191101；
2)  **成员行**：3位成员行编码；
3)  **......**：自定义目录结构部分；
##### 1.5.14.2.3日志文件名 {#日志文件名 .list-paragraph}
日志文件命名不可出现中文，使用字母、数字、下划线组成，日志文件名中要包含日志类型名部分。
##### 1.5.14.2.4日志文件大小 {#日志文件大小 .list-paragraph}
日志文件按照时间或大小进行滚动，不建议生成超大数据文件，最大文件大小为500M。
##### 1.5.14.2.5日志文件个数 {#日志文件个数 .list-paragraph}
每天每台主机日志文件数量不要超过1千个。
##### 1.5.14.2.6日志文件保留、备份及清理 {#日志文件保留备份及清理 .list-paragraph}
1)  **业务类日志**（包括交易日志及其他自定义的业务类日志）：本地最长保留一个月，归档至磁带库，保留周期三年。
2)  **其他日志**：本地最长保留一个月，无需归档至磁带库。
##### 1.5.14.2.7日志文件字符集编码 {#日志文件字符集编码 .list-paragraph}
1)  日志文件内容输出要采用统一的编码，不可在一种日志文件内出现多种编码格式。
2)  输出数据编码采用utf-8或gbk。
##### 1.5.14.2.8日志内容分隔符 {#日志内容分隔符 .list-paragraph}
分隔符建议为："#"或"\|"，除分隔符本身外，日志数据中不可包含与分隔符相同的字符。在同种日志类型中，不建议使用多种分隔符进行数据分割。
##### 1.5.14.2.9日志内容要求 {#日志内容要求 .list-paragraph}
1)  数据不建议跨行进行输出。
2)  每行最大数据不可超过65535个字节。
3)  日志内容非特殊情况不建议使用中文。
##### 1.5.14.2.10其他要求 {#其他要求 .list-paragraph}
1)  应用及业务日志不可以输出至中间件运行日志中。
2)  应用程序在运行过程中需输出的日志，至少包含：运行日志、性能日志、跟踪日志（详见《交易路径跟踪全局统一流水号规范》）、交易日志（例如交易日志或其他自定义类型）。
3)  业务系统在运行过程中需输出**单独**的业务日志，如：apache的access日志、核心柜员日志等。
4)  接入的流式数据必须要有规范的时间戳来标识事件发生的时间，建议格式为：yyyy-MM-dd
    HH:mm:ss.SSS或yyyy/MM/dd HH:mm:ss.SSS。
5)  输出数据的时区采用北京时区。
6)  需要用来触发告警的关键字段（如：事件级别）及用来进行统计分析数据挖掘的字段请单独成列打印。
7)  日志输出的服务器必须和联盟时间服务器时钟进行同步，保障日志输出的时间和其他系统一致。
8)  日志分析平台接入日志数据的方式为：syslog、文本、kafka、snmptrap、mysql、db2、脚本；
9)  日志分析平台接入日志数据的时间不可以严重滞后当前时间（滞后30天）；
10) 日志分析平台接入日志数据的时间不可以严重超前当前时间（超前10分钟）；
#### 日志分类
##### 1.5.14.3.1跟踪日志 {#跟踪日志 .list-paragraph}
###### 作用
跟踪日志用来从宏观的角度，记录和跟踪整个交易路径跨系统的调用过程及结果，并关注系统间调用的性能。日志分析平台通过接入和分析跟踪日志，可以画出整个交易路径的走向，并可以用调用时序图的方式，展示出系统间调用性能情况。一笔交易的处理中间如果出现了问题，从交易路径图上可以很直观地定位出问题出在哪里。
###### 日志类型名
gl
###### 关键要素
+---+-----------+----------+-----+-----+------------------+---------+
| * | **要      | **英     | *   | *   | **描述**         | **需    |
| * | 素名称**  | 文全称** | *英 | *填 |                  | 要输出  |
| 序 |          |          | 文  | 写  |                  | 日志字  |
| 号 |          |          | 简  | **  |                  | 段的联  |
| * |           |          | 写  |     |                  | 机交互  |
| * |           |          | **  |     |                  | 动作**  |
+===+===========+==========+=====+=====+==================+=========+
| 1 | 日        | log      | Lv  | 必  | 日志规范的版本号 | 全部    |
|   | 志版本号  | version  |     | 填  | ，此文档中日志规 |         |
|   |           |          |     |     | 范的版本号为1.0  |         |
+---+-----------+----------+-----+-----+------------------+---------+
| 2 | 时间      | time     | T   | 必  | 日志实           | 全部    |
|   |           |          |     | 填  | 际输出时间格式： |         |
|   |           |          |     |     |                  |         |