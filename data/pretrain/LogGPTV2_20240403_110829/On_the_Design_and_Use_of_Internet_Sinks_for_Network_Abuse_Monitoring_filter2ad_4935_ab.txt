observed in the TCP ﬂows could be isolated to sources scanning two services (port 139
and 445) simultaneously. Port 139 is SMB (Server Message Block protocol) over Net-
BIOS and port 445 is direct SMB. However, this did not help us isolate the attack vector
because it is fairly common for NetBIOS scanners to probe for both these services. Pas-
sive logs provided three additional clues: 1) scans typically involve 256 successive IP
154
Vinod Yegneswaran, Paul Barford, and Dave Plonka
Inbound Bits by IP Protocol
Campus Network Sink (~100K Addresses)
Inbound Packets by IP Protocol
Campus Network Sink (~100K Addresses)
2.0 M
TCP
UDP* (ms-sql-m excluded)
1.5 M
1.0 M
d
n
o
c
e
S
r
e
p
s
t
i
B
d
n
u
o
b
n
I
500.0 k
0.0 
Tue
Wed
Thu
Fri
Sat
Sun
Mon
d
n
o
c
e
S
r
e
p
s
t
e
k
c
a
P
d
n
u
o
b
n
I
2.0 k
1.5 k
1.0 k
500.0 
0.0 
TCP
UDP* (*ms-sql-m excluded)
Tue
Wed
Thu
Fri
Sat
Sun
Mon
Fig. 3. Inbound Trafﬁc for a Typical Week on Campus-Enterprise Sink (bits/pkts per second)
addresses that span a /24 boundary, 2) the probes had a period of roughly 2.5 hours,
3) the small timescale periodicity seemed to be super imposed over a diurnal periodic
behavior at larger timescales.
Figure 6 shows the number of ﬂows scanning both services in a week. To simplify
our analysis we then focused on a single day’s data and classiﬁed scanners on these
services based on their scan footprints. We deﬁned scanners that match our proﬁle (be-
tween 250-256 successive IP addresses spanning a /24 boundary) as type-1 sources. We
also deﬁned sources that scan ﬁve or more subnets simultaneously as type-5 sources.
This includes processes that pick destination IP addresses randomly and others that are
highly aggressive. Figure 7 shows a time-volume graph of the type-1 and type-5 scan-
ners. The interesting aspect of this ﬁgure is that the number of sources in each peak
(around 100) is more than an order of magnitude smaller than the total number
of participants observed in a day (2,177). We can also see that most of the diurnal
behavior could be attributed to type type-5 sources.
This mystery motivated our development of NetBIOS and SMB responders. By
observing the packet logs generated by the active response system we concluded that the
scanning process was the LovGate worm [2] which creates the ﬁle NetServices.exe
among others.
This section demonstrates iSink’s capabilities and illustrates the complementary
roles of the Passive Monitor and the Active Sink using results from our two iSink de-
ployments. We ﬁrst discuss issues of perspective by comparing the passive-monitoring
results observed in the campus-enterprise sink with that of the service-provider sink. We
then demonstrate the utility of the Active Sink in investigating network phenomenon re-
vealed by the Passive Monitor including periodic probing and SMTP hot-spots.
4.1 Campus Enterprise iSink Case Study
Because the campus iSink is located inside one autonomous system and advertised via
the local interior routing protocol, this system sees trafﬁc from local sources in addition
to trafﬁc from sources in remote networks. Trafﬁc observed from local sources included:
– Enterprise network management trafﬁc attempting to discover network topology
and address utilization (such as ping sweeps and SNMP query attempts)
On the Design and Use of Internet Sinks for Network Abuse Monitoring
155
Inbound Bits by IP Protocol
Class-A Network Sink (16M Addresses)
Inbound Packets by IP Protocol
Class-A Network Sink (16M Addresses)
d
n
o
c
e
S
r
e
p
s
t
i
B
d
n
u
o
b
n
I
15 M
10 M
5 M
0 
TCP
UDP
Sat
Sun
Mon
Tue
Wed
Thu
Fri
d
n
o
c
e
S
r
e
p
s
t
e
k
c
a
P
d
n
u
o
b
n
I
10 k
8 k
6 k
4 k
2 k
0 
TCP
UDP
Sat
Sun
Mon
Tue
Wed
Thu
Fri
Fig. 4. Inbound Trafﬁc for a Typical Week on Service Provider Sink (bits/pkts per second)
– Trafﬁc from misconﬁgured hosts. For instance, a few hosts continually send domain
queries to what is now an unused campus IP address. Presumably, an operational
DNS server used to be at that address. We also see trafﬁc from misconﬁgured AFS
clients and NetBIOS name registration requests from local windows hosts with
incorrect WINS address.
– Malicious probes and worm trafﬁc that has an afﬁnity for hosts within their classful
network.
Figure 3 shows the trafﬁc observed from only remote sources in a typical week at
the campus-enterprise iSink. There are several notable features. The dominant protocol
is TCP since the campus border routers ﬁlter scans to port 1434 (ms-sql-m) that was
exploited by the SQL-Slammer worm [16]. The peak rate of trafﬁc is about 1Mb/s and
1500 packets per second. There is no obvious periodicity in this dataset. Finally, because
TCP is the dominant protocol, the packet sizes are relatively constant and the number
of bytes and packets follow a predictable ratio. Hence, the graphs of bit and packet rate
show very similar trends.
4.2 Service Provider iSink Case Study
The volume of unsolicited inbound trafﬁc to the class A network varied between average
rates of 5,000 packets-per-second (pps) when we brought the system on line to over
20,000pps six months later at the end of our study. One consequence that was relayed
to us by experienced network operators is that it is not possible to effectively operate
even this relatively quiescent class A network at the end of a 1.5 megabit-per-second
T1 link because the link becomes completely saturated by this unsolicited trafﬁc.
To operate the service-provider iSink continuously, we originally assumed that we
could safely introduce the class A least-speciﬁc /16 route for the iSink and still allow
operators to occasionally introduce more-speciﬁc routes to draw the network’s trafﬁc
elsewhere in the Internet when need-be. While sound in theory (according to “CIDR
and Classful Routing” [24]), it didn’t work in practice. Because today’s Internet is bi-
furcated into commercial/commodity networks and research/education networks (In-
ternet2’s Abilene), some institutions connected to both types employ creative routing
policies. We found that some sites prefer less-speciﬁc routes over more-speciﬁc when
156
Vinod Yegneswaran, Paul Barford, and Dave Plonka
Table 2. Top Services (Service Provider Sink)
Table 3. Backscatter sources (victims) in ser-
vice provider sink (12 hrs – 5 min avg)
Service:
udp netbios-ns dst
udp ms-sql-m dst
http dst
netbios-ssn dst
microsoft-ds dst
smtp dst
http src
https dst
ms-sql-s dst
telnet dst
Inbound ﬂows per second
Type
Num IPs % IPs
1932
1187
197
133
115
67
44
11
10
2
TCP RST
TCP SYN RST
TCP ACK
TCP ACK RST
ICMP INTRANS TIME EXCEEDED
ICMP PORT UNREACH
ICMP PKT FILTERED UNREACH
TCP SYN ACK
ICMP HOST UNREACH
OTHER
295
105
81
80
58
29
23
10
6
87
38%
14%
10%
10%
7%
4%
3%
1%
1%
11%
Inbound Backscatter Packets
Class-A Network Sink (16M Addresses), 12 hours
Periodic Service Probing, period = ~2.67 hours
Class-A Network Sink (16M Addresses)
d
n
o
c
e
S
r
e
P
s
r
e
k
c
a
P
300
200
100
0
TCP ACK|RST (61%)
TCP SYN|ACK (15%)
TCP SYN|ACK|RST (11%)
TCP SYN|RST (4%)
ICMP INTRANS_TIME_EXCEEDED (3%)
02:00:00
04:00:00
06:00:00
08:00:00
10:00:00
12:00:00
d
n
o
c
e
S
r
e
p
s
w
o
l
F
d
n
u
o
b
n
I
500
400
300
200
100
0
microsoft-ds destination (TCP port 445)
netbios-ssn destination (TCP port 139)
Sat
Sun
Mon
Tue
Wed
Thu
Fri
Fig. 5. Time-volume graph of backscatter
packet types on service-provider sink over a
typical 12 hour period
Fig. 6. Inbound ﬂows (per second) observed
at service-provider sink on ports 139 and 445
over a typical week
the less-speciﬁc route is seen on what is likely to be a higher-performance (or ﬁxed
cost) service such as Internet2.
Figure 4 depicts the trafﬁc observed in a typical week at the service-provider iSink.
Unlike the campus-enterprise network, the dominant protocol is UDP, most of which
can be attribute to Windows NetBIOS scans on port 137 and the ms-sql-m trafﬁc from
worm attempting to exploit the vulnerable MS-SQL monitor. Since UDP trafﬁc with
payloads of varying sizes dominates, there is no strong correspondence between the
graphs for bytes and packets. The most interesting feature is the striking periodic be-
havior of the TCP ﬂows, discussed in more detail in the section 4. Table 2 provides a
summary of the inbound per second ﬂow rate of the top services.
Analysis of Backscatter Packets. Backscatter packets are responses to spoofed DoS
attacks and have been effectively used to project Internet wide attack behavior [19].
Figure 5 provides a time series graph of the backscatter packet volume observed in our
service-provider sink. Noteworthy features include the following:
1. TCP packets with ACK/RST dominate as might be expected. This would be the
most common response to a SYN ﬂood from forged sources.
On the Design and Use of Internet Sinks for Network Abuse Monitoring
157
)
l
a
v
r
e
n
t
i
i
t
e
u
n
m
e
v
i
f
r
e
p
(