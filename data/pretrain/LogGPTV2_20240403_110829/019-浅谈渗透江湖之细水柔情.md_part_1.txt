2020/7/27 浅谈渗透江湖之细⽔柔情
浅谈渗透江湖之细⽔柔情
原创 队员编号020 酒仙桥六号部队 6⽉16⽇
这是 酒仙桥六号部队 的第 19 篇⽂章。
全⽂共计4030个字，预计阅读时⻓12分钟。
前⾔
1
在渗透测试的江湖⾥，不只有getshell后在⼑光剑影的内⽹中拿下域控的快意恩仇，更
有侧重于业务逻辑的细⽔柔情。业务安全需要去细腻的考虑⽅⽅⾯⾯，更偏向于逻辑漏
洞的⼀个思路挖掘。
在接到⼀个待测试⽬标站点后，不只要对常规漏洞的点去进⾏渗透测试，还要对各个功
能模块所可能存在的逻辑漏洞进⾏挖掘。⽂件上传等多种⽅式getshell固然可以对站点
⼀剑封喉，但⼀些严重敏感信息泄露、逻辑设计缺陷跟流程缺陷，虽然细腻不易察觉，
却同样招招致命。
通⽤业务逻辑漏洞模块
2
通⽤业务逻辑漏洞模块，是各⾏业共性的业务逻辑安全⻛险点，在每次的测试过程中也
是最常⻅到的模块，也是测试的重点对象，所以⽹上介绍此类逻辑漏洞的⽂章很多，在
这⾥再做下简单的思路点总结：
1.注册模块
•恶意⽤户批量注册。
•⽤户登录账号、id、昵称身份覆盖。
2.登录认证模块
•密码爆破。
•空密码登录。
•登录越权：修改登录请求返回包中的⽤户id等。
https://mp.weixin.qq.com/s/GCTPZ4IZlih7plHowoYADQ 1/15
2020/7/27 浅谈渗透江湖之细⽔柔情
3.找回密码(修改密码)模块
•前端js校验绕过。
•邮箱重置密码链接弱token遍历。
4.验证码模块(图形、滑块、⼿机、邮箱)
•验证码前端js绕过。
•验证码空参数或删除验证码绕过。
•图形验证码⻓宽DDOS。
•验证码单⼀⽤户⽆限制发送。
•验证码重复使⽤。
•验证码低位数爆破。
•验证码回传泄露。
•验证码越权接收。
•验证码重复发送同⼀值。
5.⽀付交易(充值、提现、抽奖、优惠券、会员)等多个模块
•⾦额、数量负值/⼩数。
•总⾦额=商品⾦额+优惠券⾦额（只校验订单总⾦额，⽽不单独校验优惠券⾦额跟商品
⾦额，可增⼤优惠券⾦额）。
• 订 单 参 数 混 淆 ⼲ 扰 （ 在 同 ⼀ 个 订 单 内 提 交 两 个 或 多 个 ⾦ 额 参 数 ， 如
price=1&price=-1）。
•校验商品总数量不能为负数，⽽不校验单个数量，可以设置两个商品⼀个数量为-1，⼀
个数量为2。
•越权使⽤他⼈优惠券。
•⾸充优惠、升级会员等，多台设备同⼀账号同时进⼊⽀付宝微信第三⽅⽀付⻚⾯，此时
签名订单已⽣成，⽀付时不会变成其他⾦额，可依次以优惠价格⽀付订单。
•⼩数点精度：0.019=0.02（⽐如充值0.019元，第三⽅⽀付截取到分也就是0.01元，
但是系统四舍五⼊为0.02）。
https://mp.weixin.qq.com/s/GCTPZ4IZlih7plHowoYADQ 2/15
2020/7/27 浅谈渗透江湖之细⽔柔情
•int型溢出（超过最⼤值整数溢出）遍历优惠券id，有可能遍历出测试隐藏的⽆条件⼤
额优惠券。
•⾸充、提现、抽奖、领取优惠券等并发：不⼀定⾮要⽤同⼀个数据包去进⾏多次并发操
作，可⽤bp等⼯具拦截客户端数据包，快速多次点击相应客户端按钮，然后停⽌拦截，
并发请求。
专项业务逻辑漏洞模块
3
由于业务逻辑漏洞更侧重的是思路，再加上师傅们超脱银河系的脑洞，各⾏各业的业务
逻辑漏洞被挖掘的越来越多。接下来以我⾃身案例以及⽹上分享的逻辑漏洞思路点，给
⼤家汇总⼀下不同⾏业所特有的逻辑漏洞⻛险点：
1.直播
•快速进出房间炸房。
•⽆限发送点赞协议。
•修改礼物数量，0，⼩数，负数，特定值（⼀般情况下为1073741824）。
•修改礼物ID，遍历尝试是否有隐藏ID。
•并发送礼物，抽奖。
•⽆限创建⾸次优惠订单，有些⾸次优惠订单是⼀个特殊的pid，这种的直接替换pid进
⾏⽀付。有些是相同的ID，这种的提前创建订单，记录多个订单号在依次修改订单⽀
付。
•刷屏：发⾔刷屏，分享，点赞等有提示的地⽅刷屏房间内可以申请的地⽅进⾏申请取消
操作，看看是否能炸房。
•越权踢⼈，增加管理员，关闭房间等操作。
•发送的表情是否可以修改⻓宽（真实案例）。
•加密直播尝试删除⻚⾯锁定弹窗对应div标签。
2.外卖
•商品数量，0，负数，⼩数，特定值，正负数（A为-1，B为2，总值为1）。
•送餐员评价修改，星级，打赏⾦额（⼩数，负数）。
https://mp.weixin.qq.com/s/GCTPZ4IZlih7plHowoYADQ 3/15
2020/7/27 浅谈渗透江湖之细⽔柔情
•订单商品评价，星级，评论字数，上传图⽚是否可以⾃定义格式。
•订单超出送餐地址。
•强⾏货到付款，取消订单，退款。
•越权操作别⼈订单，登录。
•优惠购买会员（重复使⽤优惠购买）。
3.社交论坛
•强⾏举报（读取本地消息上传那种）。
•强⾏加好友（⼀般尝试重发通过好友这条协议）。
•⾃由修改号码（靓号类）。
•群管理⽆限禁⾔越权禁⾔，踢⼈，拉⿊。
•会员修改⾦额，数量，⽆限优惠购买。
•⾮会员使⽤会员功能。
4.购物
•购买数量：为0，⼩数，负数，正负值（A为-1，B为2，总值为1）。
•代⾦券：并发领取，遍历领取。
•同⼀个代⾦券重复使⽤。
•未满⾜条件使⽤代⾦券。
5.读书/漫画
•打赏⾦额为负数，⼩数，特定值（溢出）。
•越权删除评论，登录。
•修改充值⾦额。
•付费漫画免费看。
•评论图⽚数量过多会导致客户端加载卡死。
6.⾳乐
•唱歌类软件修改上传分数等参数。
https://mp.weixin.qq.com/s/GCTPZ4IZlih7plHowoYADQ 4/15
2020/7/27 浅谈渗透江湖之细⽔柔情
•付费下载尝试替换下载ID。
•修改付费下载⾦额。
•F12查看下是否有歌曲地址。
7.⽹约⻋