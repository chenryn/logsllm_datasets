也就是说，通过了sqlmap的渗透测试，并不代表安全。    
### sqlmap包含了哪些常规渗透测试？如何封堵常规的安全漏洞？    
1\. sql注入    
防范手段，应用程序使用绑定变量，或者使用过滤规则。    
SQL注入成功是后面的攻击基础。    
2\. 数据库用户密码hash    
指SQL注入成功后。    
防范手段1，业务使用普通用户连接数据库，那么它拿不到其他用户的密码hash。    
防范手段2，隐藏或加密用户密码hash，任何情况下，你都只能看到加密后的hash。(需修改数据库内核来实现)       
3\. 上传下载数据库主机文件    
指SQL注入成功后。    
防范手段1，业务使用普通用户连接数据库，那么它无法读取或者写入文件。    
防范手段2，禁止一切文件读写操作权限的函数。    
4\. 调用数据库主机操作系统命令    
指SQL注入成功后。    
防范手段，业务使用普通用户连接数据库，那么它无法读取或者写入文件。也就无法创建UDF。    
5\. 把数据库主机变成肉鸡，或者跳板机    
指SQL注入成功后。    
防范手段，业务使用普通用户连接数据库，那么它无法读取或者写入文件。也就无法创建UDF。    
6\. 访问数据库主机才能访问的私有网络    
指SQL注入成功后。    
防范手段1，业务使用普通用户连接数据库，那么它无法读取或者写入文件。也就无法创建UDF。    
防范手段2，对有网络访问权限的插件，实行IP地址过滤，只能访问白名单内的IP，比如数据库的DBLINK插件，需要有白名单过滤机制。（需要修改数据库内核来实现）      
防范手段3，隔离数据库主机与其他主机的网络访问。    
## PostgreSQL安全加固文档    
前面已经提到了sqlmap的数据库安全检测并不完善，仅仅针对一些常规的攻击方法。    
毕竟他们的团队不是专业搞数据库的，所以如果需要更加完善的数据库安全加固方法，可以参考如下文档。    
[《PostgreSQL 密码 安全指南》](../201410/20141009_01.md)     
[《PostgreSQL 数据库 安全指南》](../201506/20150601_01.md)    
[《PostgreSQL cancel 安全漏洞》](../201509/20150925_01.md)     
[《DBA专供 冈本003系列 - 数据库安全第一,过个好年》](../201612/20161224_01.md)    
[《PostgreSQL psql 安全设置数据库用户密码的方法之一》](../201701/20170112_01.md)    
[《PostgreSQL views privilege attack and security with security_barrier(视图攻击)》](../201307/20130710_01.md)    
[《PostgreSQL leakproof function in rule rewrite("attack" security_barrier views)》](../201404/20140414_01.md)      
[《PostgreSQL 安全陷阱 - 利用触发器或规则，结合security invoker函数制造反噬陷阱》](../201509/20150929_01.md)    
[《开放dblink , fdw带来的安全隐患》](../201510/20151022_01.md)     
[《PostgreSQL 安全警钟长鸣》](../201511/20151130_01.md)    
[《PostgreSQL 9.4 patch : Row-Level Security》](../201307/20130727_01.md)      
[《EnterpriseDB (PPAS) Oracle兼容性Virtual Private Database(VPD) 数据隔离以及当前缺陷》](../201606/20160614_02.md)      
## sqlmap 检测网站漏洞    
略    
## 云数据库的安全挑战    
sqlmap支持直连数据库的方式，所以我们可以使用它来测试数据库是否存在常规漏洞。    
比如获得操作系统权限，访问数据库主机的私网主机等。（对于云厂商来说，这个是比较致命的问题。）    
通常云数据库如果提供给用户的是普通账号，如果是超级账号，那么要做到对云自身的保护，数据库内核的改动量会非常庞大。    
云数据库可能运行在物理机也可能运行在虚拟机。    
云数据库所在环境可能还有其他的主机，对用户是隔离的，但是云数据库主机也许能访问它们。    
## sqlmap 探测云数据库常规安全性    
注意，sqlmap只包含了一些常规的安全测试手段，所以通过了SQLMAP的安全测试，并不代表这个云数据库是安全的。    