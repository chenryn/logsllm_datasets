;;QUESTION SECTION:
Address:
Name:
www.example.net.
<>> DiG 9.7.0-P1> ww.example.net @10.1.1.4
Server:
；global options:+cmd
SERVER:10.1.1.4#53(10.1.1.4)
WARNING:recursion requested but not available
flags: qr rd;QUERY:1,ANSWER:0，AUTHORITY:0,ADITIONAL:0
->>HEADER DiG 9.7.0-P1> example.net
->>HEADER> DiG 9.7.0-P1 <>> example.net NS
:；WHEN:Mon Mar 19 20:48:272012
example.net.
example.net.
；ANSWER SECTION:
;example.net.
;;->>HEADER<<- opcode:QUERY， Status: NOERROR,id: 38194
:Got answer:
300
IN
NI
10.1.1.4
ns2.example.net.
nsl.example.net.
6.2DNS服务器故障排除·103
不仅仅是
---
## Page 111
104
查询：
·第6章为什么主机名无法解析？解决DNS服务器的问题
每次都查询名称服务器。在Linux中,nscd daemon(如果安装了的话）
系统也会缓存DNS请求，这样它就不需要在解析一个记录的时候
存。首先要刷新的缓存是操作系统中的缓存。是的，甚至你的操作
天调低TTL，这样那里所有的DNS服务器都有机会遵循新的更短
还是缓存的旧记录，这有不少补救的方法。最简单的补救方法就是
新而其他的还未更新，那么可能存在区域传输问题。
的TTL。然后，一旦更改通过，他们再将TTL调回之前的值。
更改，而且TTL很长，很多DNS管理者都会在更改之前，提前几
等待，直到缓存过期。理想情况下，如果你预先知道你需要做DNS
么区域文件中可能有一个语义错误。如果一些DNS 服务器已经更
中获得正确的记录。如果发现没有一个DNS 服务器更新完毕，那
时，直接查询名称服务器列表中其余的名称服务器，看看是否能从
然是老IP地址，就能知道更改还没有更新到这个名称服务器。这
服务器缓存，获得了当前最新的记录。所以如果直接访问得到的仍
如果你发现名称服务器的确有正确的记录但是本地DNS 服务器
如果不能等不到本地缓存过期，你也可以刷新对应的DNS 缓
当你直接查询一个名称服务器的时候，就绕开了任何本地DNS
一旦你获得了名称服务器列表，那么就选择其中的一个，直接
$ dig web1.example.net @10.1.1.4
;; MSG SIZErcvd: 98
1; WHEN: Sat Mar 24 20:44:42 2012
；ADDITIONAL SECTION:
; SERVER: 192.168.0.1#53(192.168.0.1)
;Query time:3msec
ns2.example.net.
ns1.example.net.
N
10.1.1.4
10.1.1.3
---
## Page 112
会处理这类缓存，所以想要清空缓存只要输人：
查系统中记录BIND错误消息的/var/log/syslog和/var/log/messages
重载了BIND 服务，但名称服务器还是返回了旧记录，那么需要检
则你甚至都不会意识到发生了什么问题。如果更新了一个区域，并
文件的任何更改，仍然使用之前的记录。除非你看了日志文件，否
BIND，如果它发现文件中有语义错误，那么它会简单的忽略该区域
区域文件中的语义错误。当你对一个区域文件作了更改，然后重载
更新并没有在该区域任何一台名称服务器上起作用，这很有可能是
是一种短视的解决方式，我不建议这样做。
置文件，或者，也可以将 IP地址硬编码到/etc/hosts 文件中，但这
方法就是临时用没有旧记录缓存的配置文件替换名称服务器中的配
bind9 而不是named。如果无法重启递归名字服务器，那么唯一的
服务器。在基于 Red Hat 的系统上，可能需要输人：
清空它的缓存。想要清空 BIND 名称服务器的DNS 缓存，仅需重启
文件。
区域语义错误如果你对一个DNS记录作了更改，但发现这个
下面是一个语义错误的消息示例：
在基于Debian的系统上，这个服务的名称可能是bind或者
$sudo/etc/init.d/namedrestart
如果你的递归DNS服务器有缓存，你需要用管理员身份登录并
$ sudo /etc/init.d/nsdc restart
或者下面的命令，这取决于Mac操作系统的版本：
在Windows 系统中，可以打开命令行并输人：
dscacheutil -flushcache
lookupd-flushcache
在Mac 系统中，
ipconfig /flushdns
，打开终端并输人：
6.2DNS服务器故障排除·105
---
## Page 113
106
dig 命令类似，仅需简单地查询域并将 SOA 添加到查询的末尾。
绝大多数配置文件都支持在行前使用#来标识该行是注释，除了
特殊的记录中，名为 Start of Autority（SOA）的记录。该记录列出
DNS 服务器是否能得到正确的记录。主 DNS 服务器被配置在一个
这些更改还是没有正确地传输到机器上，那么下一步就是确定主
再试，因为这些更改生效可能需要一些时间。如果过了几分钟后
该区域配置的所有名称服务器进行直接 DNS 查询。如果你看到部
可能会在不同的时间看到不同的IP 地址。
或者多个从机的请求响应的都是旧记录。结果就是，不同的客户端
检测到，因为主名称服务器响应是的新记录，然而，任何发向一个
何更改都会推送到它配置的从属机器上。区域传输的问题很难立即
器会被视为特定区域的主机，其余的机器都从属于它。主机上的任
分号作为注释的标识，管理员不小心也会使用#，出现这种情况的
·第6章为什么主机名无法解析？解决DNS服务器的问题
了该区域哪些是经过授权的DNS 服务器，与查询特定记录类型的
分名称服务器有更改，但其他的没有更改，那么需要等待一两分钟
的原因是区域传输问题。在普通 DNS 基础设施中，一个 DNS 服务