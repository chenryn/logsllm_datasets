### Solaris样本指令功能简要描述

Solaris样本的指令功能与Windows指令大体相同。特别是在下载和执行部分，Solaris样本使用了与Windows相同的指令标记，并通过三个步骤（创建、写入、执行）来完成下载和执行的功能。不过，在代码结构上有所不同，Solaris将这三个步骤整合到一个函数中。

#### 执行文件
在执行文件时，首先需要提升文件权限，然后使用`execle`函数带参数执行文件。具体参数如下：
- 参数1：文件B的路径。
- 参数2：文件名B或"sendmail"（推测与邮件相关）。
- 参数3：0。
- 参数4：环境变量`PATH=%PATH%`。

示例代码：
```c
execle("/usr/bin/sample", "sample", NULL, %envp);
```

#### 图 20: 执行文件参数
- 文件路径：`/usr/bin/sample`
- 文件名：`sample`
- 参数列表终止符：`NULL`
- 环境变量：`%envp`

### 指令功能与数据包格式
Solaris样本的指令功能和数据包格式与Windows样本相同。详细的功能说明和数据包格式可以参考Windows平台样本的指令分析。

### 收集系统信息
Solaris样本收集的系统信息与Windows略有不同，具体内容将在后续章节中详细介绍。

## 5 总结

### 5.1 以真实威胁驱动我国信息防御能力的改进
安天希望通过自身的工作向中国用户证明，超级攻击组织具备全平台覆盖的能力，并且这种威胁是真实存在的。在我国的安全防御实践中，有一种普遍的观点认为，由于各种规定和约束，暴露在互联网上的节点并不存放高价值的信息。然而，随着大数据时代的到来，高价值信息的定义和范围不断变化，更多的信息资产已经不可避免地分布在公共网络体系中。同时，对这些资产的窥视和攻击也在不断增加。

针对DNS服务器的入侵可以帮助实现恶意代码注入和信息劫持；针对邮件服务器的植入可以获取用户的全部邮件通信；针对运营商骨干节点的持久化可以用来获取全方位的信息。此外，“物理隔离”的安全神话也已经到了破灭的时候。习近平总书记在4.19讲话中提醒国内用户和网络安全工作者：“‘物理隔离’防线可被跨网入侵，电力调配指令可被恶意篡改，金融交易信息可被窃取，这些都是重大风险隐患。”

面对武装到牙齿的对手，中国的信息化体系显得尤为脆弱。攻击载荷的代码工程规模、作业链条的精密设计以及全方位无死角的平台覆盖都显示了方程式攻击组织等超级攻击组织空前的攻击能力。根据曝光的信息，这些组织发动了针对大量关键目标为期数年的攻击，表明其坚定的攻击决心。安天在此前的研究中将类似的攻击能力组织称为A2PT，并从恶意代码载荷视角给出了A2PT的若干评价标准，这些标准与方程式组织的行为和能力高度吻合。

### 5.2 我们的努力和对能力型厂商深入协作的期待
自2010年以来，安天先后对“震网”、“毒曲”、“火焰”、“APT-TOCS(海莲花)”、“白象”、“乌克兰停电”、“方程式”等高级攻击行动或攻击组织进行了深入分析，累计发布了数百页的分析报告。毫无疑问，高级威胁检测产品的能力是依托扎实有效的分析过程不断改进的。安天推出了面向高级威胁检测和态势感知的产品体系，包括探海威胁检测系统、智甲终端防御系统和追影威胁分析平台。

安天将下一代威胁检测引擎、高定制化深度分析、面向资产和威胁的交互可视分析以及知识与情报支撑作为自身达成有效、可落地用户价值的产品基因。但安天也客观地认识到，面对超级攻击组织的强大能力和坚定意志，任何厂商单打独斗都难以有效达成使命。因此，安天一直倡导能力型安全厂商间的积极协作和能力互认。此前，安天与360企业安全在应对来自南亚次大陆的网络攻击时进行了有效的信息互通和成果互认，这是一个良好的开端。

### 5.3 期待一个更安全的网络世界
当前，超级攻击组织的全环节覆盖能力已经引发了全球用户的“一切均不可信”的安全焦虑。去年部分国内媒体对方程式攻击的报道中，将攻击者针对高价值目标节点硬盘固件实现攻击持久化的植入解读为当前主流硬盘都带有后门，这固然是一种误解，但也反映了当一个超级攻击组织的能力强大到只能猜测和想象的程度时，会引发恐慌并导致对超级大国滥用供应链和信息流优势的严重质疑。

近期的方程式攻击代码泄露事件以及此前“ANT”装备体系的曝光，使我们看到了相关的Exploit储备和攻击思路流入到网络犯罪组织甚至恐怖主义组织的可能性。鉴于网络攻击技术存在极低的复制成本，当前已经存在严峻的网络军备扩散风险。因此，超级大国能否合理控制自身网络军备发展的速度和规模，并对因自身未有效履行责任而使网络领域发生可能的军备扩散进行有效干预和控制，是我们能达成一个更安全的网络世界的关键因素。

我们期待一个更安全的网络世界，我们为之努力！

### 附录一：参考资料
- Equation Group Cyber Weapons Auction - Invitation
  - https://github.com/theshadowbrokers/EQGRP-AUCTION
- Shadow Brokers reveals list of Servers Hacked by the NSA
  - http://thehackernews.com/2016/10/nsa-shadow-brokers-hacking.html
- 安天：修改硬盘固件的木马 探索方程式（EQUATION）组织的攻击组件
  - http://www.antiy.com/response/EQUATION_ANTIY_REPORT.html
- 安天：方程式（EQUATION）部分组件中的加密技巧分析
  - http://www.antiy.com/response/Equation_part_of_the_component_analysis_of_cryptographic_techniques.html
- Kaspersky：Equation: The Death Star of Malware Galaxy
  - http://securelist.com/blog/research/68750/equation-the-death-star-of-malware-galaxy/
- Kaspersky：A Fanny Equation: "I am your father, Stuxnet"
  - http://securelist.com/blog/research/68787/a-fanny-equation-i-am-your-father-stuxnet/
- Kaspersky：Equation Group: from Houston with love
  - http://securelist.com/blog/research/68877/equation-group-from-houston-with-love/
- Kaspersky：Equation_group_questions_and_answers
  - https://securelist.com/files/2015/02/Equation_group_questions_and_answers.pdf
- SPARC架构
  - https://en.wikipedia.org/wiki/SPARC
- Solaris系统
  - https://en.wikipedia.org/wiki/Solaris_(operating_system)
- 黄晟：关于网络纵深防御的思考
  - http://www.antiy.com/wtc/2015/02_Joe.pdf

### 附录二：关于安天
安天从反病毒引擎研发团队起步，目前已发展成为以安天实验室为总部，以企业安全公司、移动安全公司为两翼的集团化安全企业。安天始终坚持以安全保障用户价值为企业信仰，崇尚自主研发创新，在安全检测引擎、移动安全、网络协议分析还原、动态分析、终端防护、虚拟化安全等方面形成了全能力链布局。安天的监控预警能力覆盖全国，产品与服务辐射多个国家。安天将大数据分析、安全可视化等方面的技术与产品体系有效结合，以海量样本自动化分析平台延展工程师团队作业能力，缩短产品响应周期。结合多年积累的海量安全威胁知识库，综合应用大数据分析、安全可视化等方面经验，推出了应对高级持续性威胁（APT）和面向大规模网络与关键基础设施的态势感知与监控预警解决方案。

全球超过三十家以上的著名安全厂商、IT厂商选择安天作为检测能力合作伙伴，安天的反病毒引擎得以为全球近十万台网络设备和网络安全设备、近两亿部手机提供安全防护。安天移动检测引擎是全球首个获得AV-TEST年度奖项的中国产品。安天技术实力得到行业管理机构、客户和伙伴的认可，安天已连续四届蝉联国家级安全应急支撑单位资质，亦是中国国家信息安全漏洞库六家首批一级支撑单位之一。安天是中国应急响应体系中重要的企业节点，在红色代码、口令蠕虫、震网、破壳、沙虫、方程式等重大安全事件中，安天提供了先发预警、深度分析或系统的解决方案。

更多信息请访问：
- 安天实验室
  - 中文：http://www.antiy.com
  - 英文：http://www.antiy.net
- 安天企业安全公司
  - http://www.antiy.cn
- 安天移动安全公司（AVL TEAM）
  - http://www.avlsec.com