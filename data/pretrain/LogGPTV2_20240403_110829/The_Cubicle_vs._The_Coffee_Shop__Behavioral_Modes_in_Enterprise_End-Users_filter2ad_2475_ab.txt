ﬁnd interestingly that users exhibit tremendous diversity: some can stay on the
vpn for 3 to 4 times as long as inside; others illustrate exactly the opposite
behavior (points spread equally on both sides of the diagonal in Fig. 2(c). Users
whose points lie near the extreme right side of this plot are likely to be employees
who travel frequently, or who telecommute often, and thus their dominant work
environment is through a VPN. We also observe, that even within the inside
mode, there is great diversity across users - some have working sessions for 8 to 9
The Cubicle vs. The Coﬀee Shop: Behavioral Modes in Enterprise End-Users
207
(a) Avg. Diﬀ: +230%
(b) Avg. Diﬀ: +200%
(c) Avg. Diﬀ: +85%
Fig. 2. Median Lifetimes in diﬀerent environments. Median values across users:
outside=43min, vpn=3h45min, inside=6h30min.
hours, while for others the median time is 1 or 2 hours. The main takeaway from
these statistics is that we see two kinds of diversity. There is tremendous diversity
for each individual, in terms of the time the user stays pinned to particular
environments. Not only do users spend vastly diﬀerent amounts of time in each
environment, but knowing a particular user’s behavior does not reveal much
about the others. Some users will have similar trends (regarding the fraction
of time spent in each environment), whereas others exhibit completely opposite
trends. We thus also see diversity across users for this measure.
3.2 Destination Port Diversity
We now examine whether there are quantitative diﬀerences in how network ser-
vices are used in diﬀerent environments. We use TCP and UDP destination ports
as a useful proxy for “network service” (for the subset of ports we consider this
is reasonable). Because it is impossible to exhaustively examine all destination
ports, we focus on two logically formed groups. First, we study the ports associ-
ated with HTTP and web traﬃc (80,88,8080, 443) which we term the Web ports,
and second, we look at the ports associated with Windows based services, that
are popular in the enterprise (135,389,445,1025-1029), denoted MS Ports.
The particular metric of comparison that we use is the fraction of connections
corresponding to a particular port (or group of ports). For every user and in
each of the environments, we collect all the connections made to a particular
port and the metric is computed as the ratio of connections on that port to
the total number of connections (in the same environment). This is intended to
capture a notion of what percent of a user’s activities in each environment do
they spend on a given service. Fig. 3 plots this metric for three diﬀerent port
sets, in each case comparing behavior across the inside and outside modes.
In each scatter plot, a point corresponds to an individual user and the (x,y)
coordinates are the connection fractions corresponding to inside and outside,
respectively.
Fig. 3(a) plots the statistic for http traﬃc across the inside and outside
environments (we exclude SSL traﬃc on port 443 from this plot and analyze
that separately). The ﬁrst thing we observe is the scattering of points over the
208
F. Giroire et al.
entire graph. Importantly, nearly all these points are oﬀ the diagonal, indicating
the percent of activity spent browsing the web in the two environments is not
the same for users. Interestingly, there is no “typical user”. For some users,
the fraction of connections they generate that are HTTP is higher when in
inside mode, and for other users, it is the reverse. The set of dense points along
the x-axis indicates users that only use HTTP when inside the enterprise. Such
users may have a second machine at home that they use for general browsing.
Such users stand in contrast to the user at (0.1,0.8) who generates 8 times as
many HTTP connections (as a function of his total traﬃc) when outside as
opposed to when at work. This could capture a user that prefers to read news,
or pursue other leisure activities, when outside the oﬃce.
(a) Web (HTTP) traﬃc
(b) Web (SSL) traﬃc
(c) Microsoft/Windows traﬃc
Fig. 3. Comparing behavior across inside and outside environments
Similarly, we see in Fig. 3(b) for SSL traﬃc, that most of the points are oﬀ
diagonal. Depending upon the user, the points can be a little or very far away
from the diagonal. On most laptops, SSL constitutes a larger fraction of the total
activity when the machine is inside the enterprise. In Fig. 3(c), we see a dramatic
diﬀerence in the use of the MS ports. This is not surprising as many of these are
primarily infrastructure services. The three plots conﬁrm our hypotheses, that
activity level proﬁles for a user are not the same in diﬀerent environments. For
some users, the diﬀerences may be small (but nonzero), whereas for others, the
diﬀerences can be dramatic. We thus advocate that any proﬁling methodology
that attempts to capture relative traﬃc measures — of a network service, for a
given user on a particular machine — needs to be environment aware.
3.3 Thresholds on Behavioral Anomaly Detectors
Today, most enterprise end-hosts employ Host Intrusion Detection Systems (H-
IDS) for security purposes. H-IDS systems typically include, among other things,
a suite of anomaly detectors. From recent research, a popular approach to
anomaly detection is to build behavioral proﬁles and use them to understand
what is and isn’t ”normal” at an end-host. Many anomaly detectors deﬁne a
threshold, [8,9,10], which deﬁnes the boundary between what is normal and ab-
normal for that host.
We now ask the important question as to whether or not such thresholds would
vary for a given user, across diﬀerent environments? If so, this would imply that
The Cubicle vs. The Coﬀee Shop: Behavioral Modes in Enterprise End-Users
209
(a) TCP connections
(b) UDP connections
(c) ICMP traﬃc
Fig. 4. 95th %-ile values for tcp, udp and icmp protocols. Connection counts in 15
minute windows are used.
the conﬁguration of anomaly detectors also needs to be environmentally-aware,
possibility loading diﬀerent proﬁles (i.e., thresholds) into the H-IDS, depending
upon the current user environment.
Some detectors track the number of connections of a particular type within
a time window. Here we will examine this type of feature for TCP connections,
UDP connections and ICMP packet-pair counts. For these 3 protocols, we count
the number of connections in 15 minute windows and build histograms for each
user to indicate how many are likely. We compute thresholds that demarcate the
95th percentile point of these distributions, and consider these as the threshold
value for the anomaly indicator. Considerable work has been devoted to the very
speciﬁc problem of selecting suitable deﬁnitions of what constitutes an anomaly,
or an outlier, however this topic is well outside the scope of this paper. Instead
we pick a simple deﬁnition of an outlier and use it consistently across users and
environments; this facilitates a straightforward comparison of the tail behavior
of users across environments. Here, we study how this value diﬀers across the
environments.
In order to obtain connection records from raw packet traces, we use bro [11]
to reassemble the ﬂows/connections from the packet headers. The 95th percentile
values for the three features are shown in Fig. 4. In each scatter plot, a point
corresponds to the values, in the two environments, for an individual user.
The high-level observation is that points are considerably oﬀ diagonal in ev-
ery case. Note that points on or near the diagonal correspond to users that have
approximately the same threshold value in both environments being compared.
For instance, take ﬁg. 4(a): here most of the points are well oﬀ diagonal. More-
over, roughly half of the user population lies on either side of the diagonal. The
latter hints at two user classes (of roughly equal population) for whom the value
in one environment dominates. Take the point most extreme to the right: the
95%-ile corresponding to outside is 400, and 120 for inside. Thus, there is a
higher intensity of outgoing TCP connections when in outside, while when in
insidemode there are almost no 15 minute windows in which one sees more
than 120 TCP connections. This is a marked diﬀerence. If a security anomaly
detector tracking TCP connections, is conﬁgured with a threshold of 120/15min
for all environments, then when the machine is outside a large number of false
210
F. Giroire et al.
positives will be generated. Conversely, if the machine were conﬁgured with 400
connections/15min, then when the machine was in insidemode, it would miss
all stealthy attacks. Clearly neither of these is good for all environments.
Fig. 4(b) plots the diﬀerences for UDP ﬂows; here, we contrast usage in vpn
and inside. We clearly see that the bulk of the distribution is away from (and
below) the diagonal; this signiﬁes that one sees more UDP ﬂows in vpn, as
opposed to inside. This seems puzzling at ﬁrst; one would normally expect
more traﬃc, and correspondingly larger number of UDP ﬂows when inside.
Upon closer inspection, we identiﬁed two destination UDP ports that contributed
a large number of small sized ﬂows; one was associated with the VPN client
application and the other with a software compliance checker. The ﬂows from
these ports contributed signiﬁcantly to the “rightward” skew of the points in
Fig. 4(b). When the same plot was recomputed after ﬁltering out ﬂows from
these two ports, the distribution of the points more closely resembled that in
Fig. 4(a).
Finally, in Fig. 4(c) we compare ICMP traﬃc across outside and vpn envi-
ronments. We see that there is very little ICMP traﬃc (to almost none) when the
host is outside. Thus, ICMP traﬃc is extremely discriminating to the environ-
ment (more than TCP and UDP). This is possibly due to a lot of maintenance
and network management traﬃc when the machine is on the VPN (a logical
extension of the enterprise). This last observation strongly supports our hypoth-
esis, i.e., that environment awareness is critical. A number of DDoS attacks, and
some OS ﬁngerprinting techniques make use of ICMP probes; large amounts of
ICMP traﬃc are generally suspicious. In the ﬁgure, we see many users generate
200-300 ICMP packets within 15 minutes, and to be eﬀective, an anomaly de-
tection threshold would be set above this level. However, when we do this, we
essentially provide a safe margin of the same amount (of ICMP traﬃc) when the
host is outside; an infected or compromised machine could send out 200-300
ICMP packets without any fear of being ﬂagged.
We conclude from this section, that because thresholds used by anomaly de-
tectors deﬁne a boundary between normal and abnormal traﬃc, end-user based
security mechanisms need to be designed to be “environment-aware”. This is
because these boundaries do change across environments for the same user.
4 Conclusion
Our study of common user-behavior features illustrates that most users exhibit
signiﬁcant diversity in how they use their machines in diﬀerent environments.
We show this on traces collected from end-hosts in an actual enterprise network.
Regardless of whether we are looking at time spent in an environment, volumes
of connections, http traﬃc, fraction of connections for Microsoft/Windows ser-
vices, the measure can diﬀer by anywhere from twice to 10 times as much in one
environment as compared to another. These results illustrate that a proﬁle com-
puted in one environment will yield an inaccurate representation of user activity
levels in another environment, for the majority of the users.
The Cubicle vs. The Coﬀee Shop: Behavioral Modes in Enterprise End-Users
211
We showed how this could impact the conﬁguration of anomaly detectors in
H-IDS systems. These ﬁndings have implications for a number of other appli-
cations as well, such as resource allocation, VPN tunneling, and even virtual
machine conﬁgurations. For example, if tomorrow’s laptops employ diﬀerent vir-
tual machines for the home and work environments (such as the ”red/green”
VM proposal in [12]), then each VM should be conﬁgured to grab the appro-
priate proﬁle before launching. We thus believe that “environmental awareness”
is important for such applications. In the future we plan to study how some
of these applications could be improved by using environmentally-aware proﬁle
information. We also plan to carry out user clustering to determine the minimal
number of common proﬁles that could be used to capture the entire set of user
behaviors.
References
1. McDaniel, P., Sen, S., Spatscheck, O., der Merwe, J.V., Aiello, B., Kalmanek, C.:
Enterprise security: A community of interest based approach. In: Proc. of Network
and Distributed System Security (NDSS) (Feburary 2006)
2. Tan, G., Poletto, M., Guttag, J., Kaashoek, F.: Role classiﬁcation of hosts within
enterprise networks based on connection patterns. In: Proc. of the USENIX Annual
Technical Conference 2003, USENIX, pp. 2–2 (2003)
3. Karagiannis, T., Papagiannaki, K., Taft, N., Faloutsos, M.: Proﬁling the end host.
In: Passive and Active Measurement, pp. 186–196 (2007)
4. Padmanabhan, V.N., Ramabhadran, S., Padhye, J.: Netproﬁler: Proﬁling wide-area
networks using peer cooperation. In: Castro, M., van Renesse, R. (eds.) IPTPS
2005. LNCS, vol. 3640, pp. 80–92. Springer, Heidelberg (2005)
5. Bhatti, N., Bouch, A., Kuchinsky, A.: Integrating user-perceived quality into web
server design. In: Proc. of the 9th International World Wide Web conference on
Computer networks, pp. 1–16. North-Holland Publishing Co, Amsterdam (2000)
6. Pang, R., Allman, M., Bennett, M., Lee, J., Paxson, V., Tierney, B.: A ﬁrst look
at modern enterprise traﬃc. In: Proc. of the Internet Measurement Conference
(IMC), pp. 2–2. ACM, New York (2005)
7. Bahl, P., Chandra, R., Greenberg, A., Kandula, S., Maltz, D.A., Zhang, M.: To-
wards highly reliable enterprise network services via inference of multi-level depen-
dencies. In: Proc. of ACM SIGCOMM, New York, USA, pp. 13–24. ACM, New
York (2007)
8. Biles, S.: Detecting the unknown with snort and the statistical packet anomaly
detection engine (SPADE) Computer Security Online Ltd
9. Jung, J., Paxson, V., Berger, A.W., Balakrishnan, H.: Fast portscan detection
using sequential hypothesis testing. In: IEEE Symposium on Security and Privacy,
p. 211 (2004)
10. Kreibich, C., Warﬁeld, A., Crowcroft, J., Hand, S., Pratt, I.: Using Packet Symme-
try to Curtail Malicious Traﬃc. In: Fourth Workshop on Hot Topics in Networks
(HotNets-IV) (November 2005)
11. Paxson, V.: Bro: A system for detecting network intruders in real-time. Comput.
Networks 31(23), 2435–2463 (1999)
12. England, P., Manferdelli, J.: Virtual machines for enterprise desktop security. In-
formation Security Technical Report 11(4), 193–202 (2006)