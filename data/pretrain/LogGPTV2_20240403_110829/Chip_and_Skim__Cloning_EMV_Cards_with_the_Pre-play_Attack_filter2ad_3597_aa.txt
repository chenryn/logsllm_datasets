# Title: Chip and Skim: Cloning EMV Cards with the Pre-play Attack

## Authors
- Mike Bond
- Omar Choudary
- Steven J. Murdoch
- Sergei P. Skorobogatov
- Ross J. Anderson

## Conference
2014 IEEE Symposium on Security and Privacy

## Abstract
EMV, also known as "Chip and PIN," is the leading system for card payments worldwide, widely used in Europe, Asia, and increasingly in North America. Payment cards contain a chip to execute an authentication protocol, which requires point-of-sale (POS) terminals or ATMs to generate a nonce, called the unpredictable number (UN), for each transaction to ensure its freshness. We have discovered two significant issues: a widespread implementation flaw and a deeper, more challenging flaw within the EMV protocol itself.

The first flaw is that some EMV implementers use counters, timestamps, or home-grown algorithms to supply the UN, making them vulnerable to a "pre-play" attack. This attack is indistinguishable from card cloning from the bank's logs and can be executed even if physical card cloning is impossible. Card cloning is the type of fraud that EMV was designed to prevent.

We describe our detection methodology, a survey to assess the scope of the vulnerability, evidence from field experiments, and proof-of-concept attacks. We found flaws in widely-used ATMs from major manufacturers. Our findings explain some of the increasing fraud cases where victims are denied refunds by banks claiming EMV cards cannot be cloned.

The second issue, independent of random number quality, is a protocol failure: the actual UN generated by the terminal can be replaced by one the attacker used earlier when capturing an authentication code from the card. This variant of the pre-play attack can be carried out by malware in ATMs or POS terminals, or by a man-in-the-middle between the terminal and the acquirer. We explore the design and implementation mistakes that enabled these flaws to evade detection, including shortcomings in the EMV specification, certification processes, testing, formal analysis, and monitoring customer complaints. Finally, we discuss potential countermeasures.

## I. The Smoking Gun
EMV is now the leading scheme for debit and credit card payments and cash withdrawals, with over 1.62 billion cards in use worldwide. US banks, though late adopters, are now issuing EMV cards. These cards contain a smart card chip, making them more difficult to clone than magnetic-strip cards.

EMV was rolled out in Europe over the last ten years, with the UK being an early adopter (from 2003-2005). After deployment, banks became more aggressive towards customers who complained of fraud. A cycle emerged where victims were denied compensation, sought technical information online, and researchers discovered new vulnerabilities.

A key case was that of Mr. Gambin, a Maltese HSBC customer who was refused a refund for transactions billed to his card, allegedly made at an ATM in Palma, Majorca. In such cases, we advise victims to demand transaction logs. In the Gambin case, the bank provided detailed log data, revealing that the UN appeared to be a predictable counter:

| Date       | Time       | UN         |
|------------|------------|------------|
| 2011-06-29 | 10:37:24   | F1246E04   |
| 2011-06-29 | 10:37:59   | F1241354   |
| 2011-06-29 | 10:38:34   | F1244328   |
| 2011-06-29 | 10:39:08   | F1247348   |

The UN consists of a 17-bit fixed value and a 15-bit counter, incrementing every few milliseconds and cycling every three minutes. We hypothesized that if the UN is predictable, it could enable a "pre-play" attack, where a criminal with temporary access to a card can compute future authentication codes. We found several ATMs generating poor random numbers, and even when a strong random number is used, a protocol flaw allows the attack. Following responsible disclosure, we informed bank industry organizations in early 2012. We are now publishing our research to help wrongly denied customers and to inform the crypto, security, and bank regulation communities.

## II. Background
EMV, named after its original developers Europay, MasterCard, and Visa, was developed in the mid-1990s to combat magnetic strip card counterfeiting. Organized crime gangs produced cloned cards using discarded receipts or skimming legitimate cards. The EMV protocol involves the payment terminal executing a cryptographic message authentication code (MAC) with a symmetric key stored in the card and shared with the issuing bank. This setup aims to detect counterfeit cards and prevent key extraction through tamper-resistance.

Many countries, including the UK, adopted PINs instead of signatures for both POS and ATM transactions. While this made using stolen cards more difficult, criminals adapted by moving to "card-not-present" transactions and creating magnetic-strip clones of EMV cards. This led to an increase in counterfeit fraud, particularly after the UK EMV rollout in 2005. Total fraud levels were reduced post-2008 through improved back-end fraud detection, more aggressive tactics towards disputing customers, and reducing fallback magnetic-strip transactions.

## III. Technical Background
[This section will provide a detailed explanation of how an EMV transaction works and how the "pre-play" attack can be mounted.]

## IV. Experimental Methods and Results
[This section will detail the experimental methods and results, including the development of a data capture card to harvest UN sequences from ATMs and insights from examining second-hand ATMs bought on eBay.]

## V. Protocol Flaw
[This section will describe the protocol flaw in detail, explaining how the actual UN generated by the terminal can be replaced by one the attacker used earlier.]

## VI. Possible Defenses
[This section will discuss potential countermeasures to mitigate the identified flaws.]

## VII. Scientific Analysis
[This section will present a scientific analysis, discussing what the crypto and security communities should take away from this, how EMV can be made more robust, and how such failures can be prevented in future large-scale systems.]

## VIII. Conclusions
[This section will draw conclusions from the research and provide final thoughts on the implications and future directions.]