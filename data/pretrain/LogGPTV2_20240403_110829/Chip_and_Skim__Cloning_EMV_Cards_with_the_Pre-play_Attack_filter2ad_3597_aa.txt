title:Chip and Skim: Cloning EMV Cards with the Pre-play Attack
author:Mike Bond and
Omar Choudary and
Steven J. Murdoch and
Sergei P. Skorobogatov and
Ross J. Anderson
2014 IEEE Symposium on Security and Privacy
Chip and Skim: cloning EMV cards with the pre-play attack
Mike Bond, Omar Choudary, Steven J. Murdoch, Sergei Skorobogatov, Ross Anderson
Computer Laboratory, University of Cambridge, UK
PI:EMAIL
Abstract—EMV, also known as “Chip and PIN”,
is the
leading system for card payments worldwide. It
is used
throughout Europe and much of Asia, and is starting to be
introduced in North America too. Payment cards contain a
chip so they can execute an authentication protocol. This
protocol requires point-of-sale (POS) terminals or ATMs to
generate a nonce, called the unpredictable number, for each
transaction to ensure it is fresh. We have discovered two serious
problems: a widespread implementation ﬂaw and a deeper,
more difﬁcult to ﬁx ﬂaw with the EMV protocol itself. The
ﬁrst ﬂaw is that some EMV implementers have merely used
counters, timestamps or home-grown algorithms to supply this
nonce. This exposes them to a “pre-play” attack which is
indistinguishable from card cloning from the standpoint of the
logs available to the card-issuing bank, and can be carried out
even if it is impossible to clone a card physically. Card cloning
is the very type of fraud that EMV was supposed to prevent.
We describe how we detected the vulnerability, a survey
methodology we developed to chart the scope of the weakness,
evidence from ATM and terminal experiments in the ﬁeld, and
our implementation of proof-of-concept attacks. We found ﬂaws
in widely-used ATMs from the largest manufacturers. We can
now explain at least some of the increasing number of frauds in
which victims are refused refunds by banks which claim that
EMV cards cannot be cloned and that a customer involved
in a dispute must therefore be mistaken or complicit. The
second problem was exposed by the above work. Independent
of the random number quality, there is a protocol failure:
the actual random number generated by the terminal can
simply be replaced by one the attacker used earlier when
capturing an authentication code from the card. This variant
of the pre-play attack may be carried out by malware in an
ATM or POS terminal, or by a man-in-the-middle between
the terminal and the acquirer. We explore the design and
implementation mistakes that enabled these ﬂaws to evade
detection until now: shortcomings of the EMV speciﬁcation,
of the EMV kernel certiﬁcation process, of implementation
testing, formal analysis, and monitoring customer complaints.
Finally we discuss countermeasures. More than a year after
our initial responsible disclosure of these ﬂaws to the banks,
action has only been taken to mitigate the ﬁrst of them, while
we have seen a likely case of the second in the wild, and the
spread of ATM and POS malware is making it ever more of
a threat.
I. THE SMOKING GUN
EMV is now the leading scheme worldwide for debit and
credit card payments, as well as for cash withdrawals at
ATMs, with more than 1.62 billion cards in use worldwide.
US banks were late adopters, but are now in starting to issue
EMV cards to their customers. EMV cards contain a smart
card chip, and are more difﬁcult to clone than the magnetic-
strip cards that preceded them.
EMV was rolled out in Europe over the last ten years, with
the UK being one of the early adopters (from 2003–5). After
it was deployed, the banks started to be more aggressive
towards customers who complained of fraud, and a cycle
established itself. Victims would be denied compensation;
they would Google for technical information on card fraud,
and ﬁnd one or other of the academic groups with research
papers on the subject; the researchers would look into their
case history; and quite often a new vulnerability would be
discovered.
The case which kicked off the research we report here
was that of a Mr Gambin, a Maltese customer of HSBC
who was refused a refund for a series of transactions that
were billed to his card and which HSBC claimed must have
been made with his card and PIN at an ATM in Palma,
Majorca on the 29th June 2011. In such cases we advise
the fraud victim to demand the transaction logs from the
bank. In many cases the banks refuse, or even delete logs
during the dispute process, leaving customers to argue about
generalities. Some courts have recently criticised banks for
this and in the Gambin case the bank produced detailed log
data. We observed that one of the ﬁelds on the log ﬁle, the
“unpredictable number” or UN, appeared to be increasing
steadily:
Date
2011-06-29
2011-06-29
2011-06-29
2011-06-29
Time
10:37:24
10:37:59
10:38:34
10:39:08
UN
F1246E04
F1241354
F1244328
F1247348
The UN appears to consist of a 17 bit ﬁxed value and the
low 15 bits are simply a counter that is incremented every
few milliseconds, cycling every three minutes.
We wondered whether,
if the “unpredictable number”
generated by an ATM is in fact predictable,
this might
create the opportunity for an attack in which a criminal with
temporary access to a card (say, in a Maﬁa-owned shop) can
compute the authentication codes needed to draw cash from
that ATM at some time in the future for which the value of
the UN can be predicted. We term this scenario the “pre-
play” attack.
We discovered that several ATMs generate poor random
© 2014, Mike Bond. Under license to IEEE.
DOI 10.1109/SP.2014.11
49
Authorized licensed use limited to: IEEE Xplore. Downloaded on March 18,2021 at 11:56:33 UTC from IEEE Xplore.  Restrictions apply. 
numbers, and that attacks are indeed possible. Even more,
we found that such attacks are also possible when an ATM
generates a cryptographically strong random number due to
a ﬂaw in the protocol. Following our responsible disclosure
policy, we informed bank industry organisations in early
2012 so that ATM software can be patched. We are now
publishing the results of our research so that customers
whose claims for refund have been wrongly denied have the
evidence to pursue them, and so that the crypto, security and
bank regulation communities can learn the lessons. These
are considerable. For engineers, it is fascinating to unravel
why such a major failure could have been introduced, how
it could have persisted undiscovered for so long, and what
this has to tell us about assurance. At the scientiﬁc level,
it has lessons to teach about the nature of revocation in
cryptographic protocols, the limits of formal veriﬁcation,
and the interplay between protocol design and security
economics.
The rest of this paper is organised as follows. In Section II,
we give the high-level background, telling the history of
EMV and discussing its effect on fraud ﬁgures overall. In
Section III we give the technical background, describing
how an EMV transaction works, and how our “pre-play”
attack can be mounted. Section V describes our experimental
methods and results: how we developed a data capture
card to harvest UN sequences from ATMs, and what we
learned from examining second-hand ATMs bought on eBay.
Section VI describes the protocol ﬂaw, and Section VII
discusses the possible defences. Section VIII presents our
scientiﬁc analysis: what the crypto and security communities
should take away from this, how EMV can be made more
robust, and how such failures can be made less likely in
future large-scale systems that employ cryptography for
authentication and authorisation. Finally in Section IX we
draw some conclusions.
II. BACKGROUND
EMV (named after its original developers Europay, Mas-
terCard and Visa) was developed in the mid 1990s to tackle
the developing threat of magnetic strip card counterfeiting,
where organised crime gangs with access to card manufac-
turing equipment produced cloned cards using data from dis-
carded receipts, or skimmed surreptitiously from legitimate
cards, ﬁrst at point-of-sale (POS) and later at automated
teller machines (ATMs). The payment
terminal executes
the EMV protocol with the chip, which exchanges selected
transaction data sealed with a cryptographic message au-
thentication code (MAC) calculated using a symmetric key
stored in the card and shared with the bank which issued
the card (the “issuer”). The idea is that the bank should be
able to detect a counterfeit card that does not contain this
key, and the physical tamper-resistance of the chip should
prevent an attacker from extracting the key.
Chip & PIN deployment period
●
●
●
●
●
●
●
●
●
●
●
●
●
●
Card−not−present
Counterfeit
Lost and stolen
●
●
●
Mail non−receipt
●
Cheque fraud
ID theft
●
●
Online banking
●
)
m
£
(
s
e
s
s
o
L
0
0
3
0
5
2
0
0
2
0
5
1
0
0
1
0
5
0
●
●
●
●
●
●
Phone banking
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
2004
Total, ex phone (£m)
2005
503
2006
491.2
2007
591.4
2008
704.3
2009
529.6
2010
441.4
2011
410.6
2012
463
2013
518.9
Year
Figure 1. Fraud levels on UK-issued payments cards [1]
Many countries, including the UK, moved to authenticat-
ing cardholders with a PIN rather than a signature at both
POS and ATM, where previously PINs had only been used at
ATMs. The goal was to make it harder to use a stolen card.
This simultaneous introduction gave rise to the term “Chip
and PIN” being commonly used in the English-speaking
world to refer to EMV. In layman’s terms, the chip protects
against card counterfeiting, and the PIN against stolen card
abuse.
EMV did not cut fraud as its proponents predicted. While
using counterfeit and stolen cards did become more difﬁcult,
criminals adapted in two ways, as can be seen from Fig-
ure 1. First, they moved to “card-not-present” transactions
– Internet, mail-order, and phone-based payments – which
remained beyond the scope of EMV.
Second,
they started making magnetic-strip clones of
EMV cards. There had always been some ATM “skim-
ming” where crooks put devices on ATM throats to cap-
ture card data and record PINs; and now that PINs were
demanded everywhere and not just at ATMs, the oppor-
tunities for skimming increased hugely. The simultaneous
deployment of EMV with magnetic strip meant that fallback
and backwards-compatibility features in EMV could be
exploited; for several years, all ATMs would still accept
mag-strip cards, and even once this started to be phased
out in the UK for locally-issued cards, it was still possible
to use mag-strip clones of UK cards in ATMs in the USA.
This is why, soon after the completion of the UK EMV roll-
out in 2005, counterfeit fraud went up. Instead of entering
PINs only at ATMs, customers were now entering their PIN
in POS terminals, which are much easier to tamper with [2].
Total fraud levels were brought down after 2008 through
improvements to back-end fraud detection mechanisms; by
more aggressive tactics towards customers who dispute
transactions; and by reducing the number of UK ATMs
that accept “fallback” magnetic-strip transactions on EMV-
issued cards. Fallback fraud is now hard enough to push the
50
Authorized licensed use limited to: IEEE Xplore. Downloaded on March 18,2021 at 11:56:33 UTC from IEEE Xplore.  Restrictions apply. 