# Implications of Autonomy for the Expressiveness of Policy Routing

**Authors: Nick Feamster, Ramesh Johari, and Hari Balakrishnan**

**Publication: IEEE/ACM TRANSACTIONS ON NETWORKING, VOL. 15, NO. 6, DECEMBER 2007**

## Abstract
Thousands of competing autonomous systems (ASes) must cooperate to provide global Internet connectivity. Each AS encodes various economic, business, and performance decisions in its routing policy. The current interdomain routing system allows each AS to express policy through rankings that determine how each router in the AS chooses among different routes to a destination, and filters that determine which routes are hidden from neighboring ASes. Because the Internet is composed of many independent, competing networks, the interdomain routing system should provide autonomy, allowing network operators to set their rankings independently and have no constraints on allowed filters. This paper studies routing protocol stability under these conditions. We first demonstrate that "next-hop rankings," commonly used in practice, may not ensure routing stability. We then prove that, when providers can set rankings and filters autonomously, guaranteeing that the routing system will converge to a stable path assignment imposes strong restrictions on the rankings ASes are allowed to choose. We discuss the implications of these results for the future of interdomain routing.

**Index Terms: Autonomy, BGP, interdomain routing, policy, safety.**

## I. Introduction
In Internet routing, independently operated autonomous systems (ASes) must cooperate to exchange global information, despite competing to provide Internet service. BGP facilitates this "competitive cooperation" by enabling network operators to express routing policies consistent with desired economic, business, and performance goals.

Ranking and filtering are the two main mechanisms used to implement these policies. Ranking determines which of many possible routes to a destination should be used, providing an AS the flexibility to specify preferences over multiple candidate paths (e.g., specifying a primary and a backup path). Filtering allows an AS to selectively advertise routes to some ASes and hide routes from others, thereby controlling which neighboring ASes send traffic over its infrastructure.

Two important characteristics of policy routing are autonomy and expressiveness. Autonomy is the ability of each AS to set its rankings and filters independently. Expressiveness refers to the flexibility that the routing protocol provides an operator for specifying rankings and filters. Ranking expressiveness determines what classes of rankings over routes are permitted, while filtering expressiveness determines the range of route filters allowed.

The combination of expressiveness and autonomy has been a key factor in the success of BGP over the past decade. We argue that both autonomy and filtering expressiveness will remain requirements for policy routing in the foreseeable future. Previous studies of routing stability assume that ASes are willing to compromise some degree of autonomy, filtering expressiveness, or both. However, autonomy preserves each AS’s ability to set its policies without coordinating with any other AS, and filtering expressiveness gives an AS flexibility in establishing contracts with another AS, a task that should be unconstrained.

Ideally, an interdomain routing system should preserve autonomy, filtering expressiveness, and ranking expressiveness. However, highly expressive rankings come at a considerable cost to system robustness. As observed by Varadhan et al. and Griffin et al., if there are no constraints on the rankings an AS can specify, BGP may violate safety (i.e., oscillate forever).

### Example 1
Consider Figure 1. ASes 1, 2, and 3 each prefer the indirect path through their neighboring AS in the clockwise direction over the direct path to the destination, 0. All other paths are filtered. This configuration has no stable path assignment. For example, consider the path assignment (10, 210, 30); in this case, AS 1 has a better path available, 130, so it switches paths. This switch breaks the path 210, causing AS 2 to switch to its second choice, path 20. The resulting path assignment, (130, 20, 30), is a permutation of the original path assignment: this time, AS 3 has the path 320 available, so it switches. This oscillation continues indefinitely.

As the example suggests, full autonomy and expressiveness can have undesirable consequences. Routing protocol update messages should reflect actual reachability changes in the network topology or policy. Unfortunately, in BGP, conflicting policies can cause oscillations that produce endless streams of routing updates unrelated to changes in topology or policy. This instability creates numerous performance problems, may cause network partitions, and complicates diagnosis and debugging of problems in the routing system. Moreover, a network operator has no way to guarantee that any given configuration of rankings and filters will not adversely interact with the policies of other ASes. Therefore, developing rigorous conditions on policy expressiveness that guarantee routing stability while preserving autonomy is crucial.

This paper explores the following question: if each AS retains complete autonomy and complete filtering expressiveness, how expressive can rankings be while guaranteeing stable routing? This question is important because ranking autonomy and filtering expressiveness reflect the realities of how ASes specify policies today, and little is known about the tradeoffs between autonomy and expressiveness as far as routing stability is concerned, especially under filtering. Our work is the first to develop necessary conditions for stability under realistic assumptions about autonomy and expressiveness and the first to derive necessary conditions for stability under filtering in policy routing.

We acknowledge that our requirements for complete autonomy and filtering expressiveness are strong; indeed, given the negative results presented in this paper, it may be reasonable to ask whether they are too strong. Nevertheless, we believe that the assumptions are not unnecessarily strong, because complete filtering expressiveness essentially reflects the realities of today’s business landscape, where a provider has complete flexibility to form contracts (i.e., exchange routing information) with any other party. Thus, we believe that this paper studies routing stability guarantees from a reasonable point in the design space.

This paper makes three main contributions:
1. In Section IV-A, we show that rankings based solely on the immediate next-hop AS en route to the destination may never reach a stable path assignment from an arbitrary initial state; i.e., next-hop rankings, which are common in practice, are not safe. Moreover, under unrestricted filtering, a routing system with next-hop rankings may have no stable path assignment. These results are surprising because next-hop rankings with no route filtering always have a stable path assignment. We also observe that, although rankings based on a globally consistent weighting of paths are safe under filtering, even minor generalizations of the weighting function compromise safety (Section IV-B).
2. We define a dispute ring, a special case of the “dispute wheel” (a group of nodes whose rankings have a particular form) of Griffin et al. [14], and show that any routing protocol that has a dispute ring is not safe under filtering (Section V). Using the dispute wheel concept, Griffin et al. showed a sufficient condition for safety, proving that if a routing system is unsafe then it must have a dispute wheel. In contrast, our result is the first known necessary condition for safety under filtering.
3. We show that, providing for complete autonomy and filtering expressiveness, if providers directly choose their rankings, then the set of allowable rankings that guarantee safety is tightly constrained. In Section VI, we prove that any routing system that permits paths of length \( k \) to be ranked over paths of length \( k-1 \) can have a dispute ring, and is thus unsafe under filtering. We also prove that any routing system that permits paths of length \( k \) to be ranked over paths of length \( k-2 \) can have a dispute wheel. In summary, our results indicate that stable policy routing with provider autonomy and expressive filtering requires tight constraints on rankings.

Recent work has observed that routing protocols whose rankings are derived from a “strictly monotonic” algebra are guaranteed to converge [13], [15], [20], [21]. Informally, a strictly monotonic algebra is one where a path has a higher cost (i.e., is less preferred) than any of its subpaths. In cases of unrestricted filtering, these strictly monotonic algebras represent a generalization of shortest paths routing, which is consistent with our results in Section VI. We discuss such mechanisms further in Section VII.

Our findings may be interpreted in several ways. The optimist will note that checking a set of rankings to ensure safety is trivial, as it only requires BGP routers to modify the decision process to consult a route’s “local preference” attribute after considering its AS path length. The pessimist, however, may conclude that guaranteeing safe routing while preserving autonomy may yield constraints on expressiveness that are too strong. In either case, the results proved in this paper about the fundamental tradeoff between expressiveness and autonomy may help guide the design of stable interdomain routing protocols in the future. Section VII explores this tradeoff in further detail.

## II. Background
Because Internet routing is policy-based, and each AS has the flexibility to define its own policies independently of other ASes, the policies of one AS may interact with those of another to cause the protocol to oscillate. Seminal work by Varadhan et al. observed that policy-based interdomain routing protocols could oscillate and defined the concept of safety [22], [23]. Varadhan et al. also conjectured that routing systems that allow rankings other than those based on next-hop rankings or shortest path routing may be unsafe [22], [23]. In fact, in Section IV, we show that even routing systems that only allow next-hop rankings are not safe.

Griffin et al. asked how expressive an autonomous, robust routing system can be [13]; we address this question in this paper. Varadhan et al. observed that a routing system with an acyclic topology will have at least one stable path assignment if participants can only express next-hop preferences [22], [23]. We show that when BGP’s protocol dynamics are taken into account, restricting each AS to only next-hop rankings does not guarantee that the routing system will be safe (even though the routing system always has at least one stable path assignment).

Various previous work has studied global conditions to guarantee the safety of routing systems; global conditions presume that the routing system does not preserve local choice of rankings (i.e., ranking autonomy). Griffin et al. showed that, if the rankings of the ASes in a routing system do not form a dispute wheel (a concept that describes the global relationship between the rankings of a set of ASes), then the routing system is safe [14]. Griffin et al. also examined robustness, the property that safety is guaranteed even if arbitrary nodes or edges are removed from the graph. We view robustness as a special case of filtering: removing an edge can be achieved if the ASes incident to that edge filter all routes through that edge; removing a node entails having all ASes filter all routes through that node.

Gao and Rexford derived sufficient constraints on rankings, filtering, and global network topology to guarantee routing stability; they also observe that these constraints reflect today’s common practice [8], [9]. They showed that if every AS considers each of its neighbors as either a customer, a provider, or a peer, and obeys certain local constraints on rankings and filtering, and if the routing system satisfies certain topological constraints, then BGP is stable. However, their model does not incorporate ranking autonomy, because their proposed topological constraints are global. The example below illustrates why the restrictions of Gao and Rexford may sometimes be too strict.

### Example 2
Consider Figure 2; there are hundreds of similar real-world examples [2]. AS 1 and AS 2, two ISPs, peer in North America, but AS 1 buys service from AS 2 in Europe (in practice, this arrangement may occur if AS 1 does not have a European backbone). Suppose that AS 2 peers with AS 3 in North America, and AS 1 peers with AS 3 in Europe. This arrangement is precisely the “peer-provider” cycle that is prohibited by some of the convergence conditions of Gao and Rexford (e.g., Guideline A, [9]). This scenario mandates that AS 2 prefer the route to all destinations via AS 1 over AS 3, even destinations in North America.

The sufficient conditions of Griffin et al. require global knowledge of rankings [14]. Those of Gao and Rexford require global knowledge of the AS-level topology. Furthermore, the work of Griffin et al. does not consider the effects of filtering, and the conditions of Gao and Rexford restrict filtering severely. Our goal is to derive constraints that must hold on the configuration of a single AS without any global knowledge.

Griffin et al. also showed how to modify a BGP-like path vector protocol to detect the existence of a dispute wheel but left unspecified how the ASes should resolve the dispute wheel [16]. Machiraju and Katz defined a new global invariant for determining safety when at most one AS deviates from the conditions of Gao and Rexford [19]. Govindan et al. proposed a routing architecture where ASes coordinate their policies [11], [12] using a standardized policy specification language [1]. Jaggard and Ramachandran presented global conditions that guarantee safety of routing systems that allow ASes to express only next-hop preferences over routes, and designed centralized and distributed algorithms to check these global conditions [18].

Gouda and Schneider study classes of routing protocol metrics for which each node in a routing tree has its most preferred path, but do not address routing stability [10]. In contrast to these studies of global conditions for safety, we study the conditions under which a policy-based interdomain routing protocol can be safe if it preserves the autonomy of each AS.

More recent work has attempted to design policy-based protocols that are guaranteed to converge without imposing any global conditions. Sobrinho described global relationships between preferences in an algebraic framework [20], [21], and incorporated several previous results (including those of both Griffin et al. [14] and Gao and Rexford [9]). He examined requirements for convergence and asserted that any vectoring protocol that preserves “strict monotonicity” is guaranteed to converge. Recent work on “metarouting” exploits this algebraic framework to allow designers to specify new routing protocols that are guaranteed to converge by requiring algebras that preserve strict monotonicity [15]. Strictly monotonic routing protocols may be viewed as extensions of shortest path routing to a more general algebraic setting; in this sense, the design principles of metarouting are consistent with the characterization results of our paper. For further details, see Section VII.

## III. Routing Model and Definitions
We now define our routing model. After introducing some basic terminology, we formally define two notions of good behavior for routing protocols: stability and safety. Finally, we extend each of these two definitions to handle filtering expressiveness.

### A. Preliminaries
We consider a model consisting of ASes (nodes), labeled \( N = \{1, 2, \ldots, n\} \). Each of these nodes wishes to establish a path (defined below) to a single destination, labeled 0.

**Definition 1 (Path):** A path from \( i \) to 0 is a sequence of nodes \( (i, i_1, i_2, \ldots, 0) \) with no repetition; i.e., such that \( i \neq i_1 \neq i_2 \neq \ldots \neq 0 \).

Note that we have defined the path to be loop-free, as BGP typically discards paths that have loops in the AS-level path. Definition 1 also precludes the practice of AS-path prepending. However, the negative results of this paper continue to hold even if AS-path prepending is allowed.

To formally capture situations where a node learns that a path no longer exists, we define consistent paths and consistent path assignments.

We denote the number of hops in a path \( p \) as \( |p| \). In addition, given an AS \( i \), we will write \( i \in p \) if node \( i \) appears in path \( p \). For clarity, given a path \( p \) from \( i \) to 0, we will often denote \( p \) as \( (i, i_1, i_2, \ldots, 0) \); furthermore, if \( p \) is a path from \( i \) to \( j \), and \( q \) is a path from \( j \) to 0, then we will denote the concatenation of \( p \) and \( q \) by \( pq \).

We denote the set of all paths from \( i \) to 0 (i.e., all paths on the complete graph) using the nodes \( N \) by \( P_i \). Given the set \( P_i \) over \( N \), each AS will choose a ranking \( \preceq_i \) of nodes \( N \), defined as follows.

**Definition 2 (Ranking):** A ranking \( \preceq_i \) for node \( i \) is a total ordering over the set of all paths \( P_i \); thus, given any two paths \( p \) and \( q \) in \( P_i \), either \( p \preceq_i q \) (node \( i \) prefers \( p \) to \( q \)) or \( q \preceq_i p \) (node \( i \) prefers \( q \) to \( p \)).