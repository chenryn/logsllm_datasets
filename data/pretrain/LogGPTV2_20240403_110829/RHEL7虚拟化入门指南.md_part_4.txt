### 3.3.1 虚拟和仿真设备

KVM在软件中实现了虚拟机的多个核心设备。这些仿真硬件设备对于虚拟化操作系统至关重要。

**仿真设备**是指完全使用软件实现的虚拟化设备。仿真驱动可以利用物理设备或虚拟化软件设备，作为虚拟机与Linux内核（管理源设备）之间的“翻译层”。KVM虚拟机监控程序会将设备层的指令进行完全转换。任何能被Linux内核识别的同类设备（如存储、网络、键盘和鼠标）都可以作为仿真驱动的后端源设备。

#### 主要仿真设备包括：

- **虚拟化 CPU (vCPU)**: 不论主机实际拥有多少个CPU，主机系统都能为每个客机提供多达160个vCPU。
  
- **仿真图形设备**: 可通过SPICE协议或VNC连接的两种选择：
  - Cirrus CLGD 5446 PCI VGA卡
  - 标准VGA图形卡，带有Bochs VESA扩展
  
- **仿真系统组件**: 提供基本系统功能的核心组件仿真，例如Intel i440FX主机PCI桥、PIIX3 PCI到ISA桥等。
  
- **仿真声音设备**: Red Hat Enterprise Linux 6.1及以上版本支持仿真(Intel) HDA声音设备(`intel-hda`)，适用于多种操作系统。另一种选项是`ac97`，但因兼容性问题不推荐使用。
  
- **仿真监视器设备**: 自RHEL 6.0起提供两种设备选项，用于在虚拟机过载或无响应时自动重启虚拟机。这需要在客机上安装`watchdog`包。
  
- **仿真网络设备**: `e1000`和`rtl8139`分别模拟了Intel E1000和Realtek 8139网络适配器。
  
- **仿真储存驱动**: 包括IDE接口、软盘驱动以及AHCI控制器等，用以连接存储池与虚拟机。请注意，仿真储存驱动本身不是储存设备；它只是让虚拟机能够访问到备用储存设备、文件或储存池容量的一个桥梁。

### 3.3.2 半虚拟化设备

半虚拟化技术提供了快速且高效的通讯方式，使得客机可以直接利用主机上的硬件资源。KVM通过Virtio API来实现在虚拟机监控程序与客机之间的高效数据交换。

**特点及优势**:
- 减少I/O延迟并提高吞吐量至接近裸机水平。
- 对于运行大量I/O密集型应用的虚拟机来说，相比仿真设备，更建议采用半虚拟化设备。
- 所有virtio设备都由两部分组成：主机侧的设备实现和客机侧的驱动程序。
- 驱动需安装于客机操作系统上。默认情况下，Red Hat Enterprise Linux从特定版本开始内置支持这些驱动；而对于Windows客机，则需手动安装。

**常见的半虚拟化设备类型**:
- **网络设备(virtio-net)**: 提供高性能网络接入。
- **块设备(virtio-blk)**: 支持高效率低延迟的数据存储操作。
- **SCSI控制器(virtio-scsi)**: 更加灵活可扩展，相较于virtio-blk具有更好的多设备支持能力。此设备广泛兼容于多种操作系统版本。

更多关于如何配置和使用这些半虚拟化设备的信息，请参考《Red Hat Enterprise Linux 7 虚拟化部署与管理指南》。