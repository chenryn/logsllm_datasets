16.2.4 某Web防火墙通过修改用户对应菜单类别可提升权限
16.3 防范越权访问漏洞的相关手段
第17章 OAuth 2.0安全案例总结
17.1 OAuth2.0认证原理
17.2 OAuth2.0漏洞总结
17.2.1 某社交网站CSRF漏洞导致绑定劫持
17.2.2 某社区劫持授权
17.3 防范OAuth2.0漏洞的相关手段
第18章 在线支付安全案例总结
18.1 某快餐连锁店官网订单金额篡改
18.2 某网上商城订单数量篡改
18.3 某服务器供应商平台订单请求重放测试
18.4 某培训机构官网订单其他参数干扰测试
18.5 防范在线支付漏洞的相关手段
网址 http://www.broadview.com.cn/33581
理论篇
第1章 网络安全法律法规
本书编写的初衷是为了增强企业的网络安全防护意识，提升网络安全从业者和相关人
士的专业技能水平。本书中讨论的内容仅限于研究和学习，严禁用于任何危害网络安全的
非法活动。《中华人民共和国网络安全法》于2017年6月1日起正式施行，作为我国网络领
域的基础性法律，不仅从法律上保障了广大人民群众在网络空间的利益，有效维护了国家
网络空间主权和安全，同时将严惩破坏我国网络空间的组织和个人。
下面摘录一些网络安全相关法律法规。
中华人民共和国网络安全法
第十二条
国家保护公民、法人和其他组织依法使用网络的权利，促进网络接入普及，提升网络
服务水平，为社会提供安全、便利的网络服务，保障网络信息依法有序自由流动。
任何个人和组织使用网络应当遵守宪法法律，遵守公共秩序，尊重社会公德，不得危
害网络安全，不得利用网络从事危害国家安全、荣誉和利益，煽动颠覆国家政权、推翻社
会主义制度，煽动分裂国家、破坏国家统一，宣扬恐怖主义、极端主义，宣扬民族仇恨、
民族歧视，传播暴力、淫秽色情信息，编造、传播虚假信息扰乱经济秩序和社会秩序，以
及侵害他人名誉、隐私、知识产权和其他合法权益等活动。
第二十七条
任何个人和组织不得从事非法侵入他人网络、干扰他人网络正常功能、窃取网络数据
等危害网络安全的活动；不得提供专门用于从事侵入网络、干扰网络正常功能及防护措
施、窃取网络数据等危害网络安全活动的程序、工具；明知他人从事危害网络安全活动
的，不得为其提供技术支持、广告推广、支付结算等帮助。
第四十四条
任何个人和组织不得窃取或者以其他非法方式获取个人信息，不得非法出售或者非法
向他人提供个人信息。
第四十六条
任何个人和组织应当对其使用网络的行为负责，不得设立用于实施诈骗，传授犯罪方
法，制作或者销售违禁物品、管制物品等违法犯罪活动的网站、通信群组，不得利用网络
发布涉及实施诈骗，制作或者销售违禁物品、管制物品以及其他违法犯罪活动的信息。
第四十八条
任何个人和组织发送的电子信息、提供的应用软件，不得设置恶意程序，不得含有法
律、行政法规禁止发布或者传输的信息。
电子信息发送服务提供者和应用软件下载服务提供者，应当履行安全管理义务，知道
其用户有前款规定行为的，应当停止提供服务，采取消除等处置措施，保存有关记录，并
向有关主管部门报告。
第六十条
违反本法第二十二条第一款、第二款和第四十八条第一款规定，有下列行为之一的，
由有关主管部门责令改正，给予警告；拒不改正或者导致危害网络安全等后果的，处五万
元以上五十万元以下罚款，对直接负责的主管人员处一万元以上十万元以下罚款：
（一）设置恶意程序的；
（二）对其产品、服务存在的安全缺陷、漏洞等风险未立即采取补救措施，或者未按
照规定及时告知用户并向有关主管部门报告的；
（三）擅自终止为其产品、服务提供安全维护的。
第六十三条
违反本法第二十七条规定，从事危害网络安全的活动，或者提供专门用于从事危害网
络安全活动的程序、工具，或者为他人从事危害网络安全的活动提供技术支持、广告推
广、支付结算等帮助，尚不构成犯罪的，由公安机关没收违法所得，处五日以下拘留，可
以并处五万元以上五十万元以下罚款；情节较重的，处五日以上十五日以下拘留，可以并
处十万元以上一百万元以下罚款。
单位有前款行为的，由公安机关没收违法所得，处十万元以上一百万元以下罚款，并
对直接负责的主管人员和其他直接责任人员依照前款规定处罚。
违反本法第二十七条规定，受到治安管理处罚的人员，五年内不得从事网络安全管理
和网络运营关键岗位的工作；受到刑事处罚的人员，终身不得从事网络安全管理和网络运
营关键岗位的工作。
第六十四条
违反本法第四十四条规定，窃取或者以其他非法方式获取、非法出售或者非法向他人
提供个人信息，尚不构成犯罪的，由公安机关没收违法所得，并处违法所得一倍以上十倍
以下罚款，没有违法所得的，处一百万元以下罚款。
第六十七条
违反本法第四十六条规定，设立用于实施违法犯罪活动的网站、通信群组，或者利用
网络发布涉及实施违法犯罪活动的信息，尚不构成犯罪的，由公安机关处五日以下拘留，
可以并处一万元以上十万元以下罚款；情节较重的，处五日以上十五日以下拘留，可以并
处五万元以上五十万元以下罚款。关闭用于实施违法犯罪活动的网站、通信群组。
单位有前款行为的，由公安机关处十万元以上五十万元以下罚款，并对直接负责的主
管人员和其他直接责任人员依照前款规定处罚。
中华人民共和国刑法
第二百八十五条
违反国家规定，侵入国家事务、国防建设、尖端科学技术领域的计算机信息系统的，
处三年以下有期徒刑或者拘役。
违反国家规定，侵入前款规定以外的计算机信息系统或者采用其他技术手段，获取该
计算机信息系统中存储、处理或者传输的数据，或者对该计算机信息系统实施非法控制，
情节严重的，处三年以下有期徒刑或者拘役，并处或者单处罚金；情节特别严重的，处三
年以上七年以下有期徒刑，并处罚金。
提供专门用于侵入、非法控制计算机信息系统的程序、工具，或者明知他人实施侵
入、非法控制计算机信息系统的违法犯罪行为而为其提供程序、工具，情节严重的，依照
前款的规定处罚。
单位犯前三款罪的，对单位判处罚金，并对其直接负责的主管人员和其他直接责任人
员，依照各该款的规定处罚。
第二百八十六条
违反国家规定，对计算机信息系统功能进行删除、修改、增加、干扰，造成计算机信
息系统不能正常运行，后果严重的，处五年以下有期徒刑或者拘役；后果特别严重的，处
五年以上有期徒刑。
违反国家规定，对计算机信息系统中存储、处理或者传输的数据和应用程序进行删
除、修改、增加的操作，后果严重的，依照前款的规定处罚。
故意制作、传播计算机病毒等破坏性程序，影响计算机系统正常运行，后果严重的，
依照第一款的规定处罚。
单位犯前三款罪的，对单位判处罚金，并对其直接负责的主管人员和其他直接责任人
员，依照第一款的规定处罚。
第二百八十六条之一
网络服务提供者不履行法律、行政法规规定的信息网络安全管理义务，经监管部门责
令采取改正措施而拒不改正，有下列情形之一的，处三年以下有期徒刑、拘役或者管制，
并处或者单处罚金：
（一）致使违法信息大量传播的；
（二）致使用户信息泄露，造成严重后果的；
（三）致使刑事案件证据灭失，情节严重的；
（四）有其他严重情节的。
单位犯前款罪的，对单位判处罚金，并对其直接负责的主管人员和其他直接责任人
员，依照前款的规定处罚。
有前两款行为，同时构成其他犯罪的，依照处罚较重的规定定罪处罚。
中华人民共和国刑法修正案（七）
九、在刑法第二百八十五条中增加两款作为第二款、第三款：“违反国家规定，侵入
前款规定以外的计算机信息系统或者采用其他技术手段，获取该计算机信息系统中存储、
处理或者传输的数据，或者对该计算机信息系统实施非法控制，情节严重的，处三年以下
有期徒刑或者拘役，并处或者单处罚金；情节特别严重的，处三年以上七年以下有期徒
刑，并处罚金。
提供专门用于侵入、非法控制计算机信息系统的程序、工具，或者明知他人实施侵
入、非法控制计算机信息系统的违法犯罪行为而为其提供程序、工具，情节严重的，依照
前款的规定处罚。
中华人民共和国刑法修正案（九）
二十八、在刑法第二百八十六条后增加一条，作为第二百八十六条之一：网络服务提
供者不履行法律、行政法规规定的信息网络安全管理义务，经监管部门责令采取改正措施
而拒不改正，有下列情形之一的，处三年以下有期徒刑、拘役或者管制，并处或者单处罚
金：
（一）致使违法信息大量传播的；
（二）致使用户信息泄露，造成严重后果的；
（三）致使刑事案件证据灭失，情节严重的；
（四）有其他严重情节的。
单位犯前款罪的，对单位判处罚金，并对其直接负责的主管人员和其他直接责任人
员，依照前款的规定处罚。
有前两款行为，同时构成其他犯罪的，依照处罚较重的规定定罪处罚。
二十九、在刑法第二百八十七条后增加两条，作为第二百八十七条之一、第二百八十
七条之二：
第二百八十七条之一利用信息网络实施下列行为之一，情节严重的，处三年以下有期
徒刑或者拘役，并处或者单处罚金：
（一）设立用于实施诈骗、传授犯罪方法、制作或者销售违禁物品、管制物品等违法
犯罪活动的网站、通信群组的；
（二）发布有关制作或者销售毒品、枪支、淫秽物品等违禁物品、管制物品或者其他
违法犯罪信息的；
（三）为实施诈骗等违法犯罪活动发布信息的。单位犯前款罪的，对单位判处罚金，
并对其直接负责的主管人员和其他直接责任人员，依照第一款的规定处罚。
有前两款行为，同时构成其他犯罪的，依照处罚较重的规定定罪处罚。
第2章 业务安全引发的思考
2.1 行业安全问题的思考
近年来，随着信息化技术的迅速发展和全球一体化进程的不断加快，计算机和网络已
经成为与所有人都息息相关的工具和媒介，个人的工作、生活和娱乐，企业的管理，乃至
国家的发展和改革都无出其外。信息和互联带来的不仅仅是便利和高效，大量隐私、敏感
和高价值的信息数据和资产，成为恶意攻击者攻击和威胁的主要目标，从早期以极客为核
心的黑客黄金年代，到现在利益链驱动的庞大黑色产业，网络安全已经成为任何个人、企
业、组织和国家所必须面对的重要问题。“网络安全和信息化是事关国家安全和国家发
展、事关广大人民群众工作生活的重大战略问题，没有网络安全就没有国家安全，没有信
息化就没有现代化。” 
随着“互联网+”的发展，经济形态不断地发生演变。众多传统行业逐步地融入互联网
并利用信息通信技术以及互联网平台进行着频繁的商务活动，这些平台（如银行、保险、
证券、电商、P2P、O2O、游戏、社交、招聘、航空等）由于涉及大量的金钱、个人信
息、交易等重要隐私数据，成为了黑客攻击的首要目标，而因为开发人员安全意识淡薄
（只注重实现功能而忽略了在用户使用过程中个人的行为对Web应用程序的业务逻辑功能
的安全性影响）、开发代码频繁迭代导致这些平台业务逻辑层面的安全风险层出不穷（业
务逻辑漏洞主要是开发人员业务流程设计的缺陷，不仅限于网络层、系统层、代码层等。
比如登录验证的绕过、交易中的数据篡改、接口的恶意调用等，都属于业务逻辑漏洞）。
目前业内基于这些平台的安全风险检测一般都采用常规的渗透测试技术（主要基于owasp top  10），而常规的渗透测试往往忽视这些平台存在的业务逻辑层面风险，业务逻辑风险
往往危害更大，会造成非常严重的后果。
为何业务逻辑漏洞会成为黑客的主要攻击目标？
一方面随着社会及科技的发展，购物、社交、P2P、O2O、游戏、招聘等业务纷纷具
备了在线支付功能。如电商支付系统保存了用户手机号、姓名、家庭住址，甚至包括支付
的银行卡号信息、支付密码信息等，这些都是黑客感兴趣的敏感信息。相比SQL注入漏
洞、XSS漏洞、上传、命令执行等传统应用安全方面的漏洞，现在的攻击者更倾向于利用
业务逻辑层面存在的安全问题。这类问题往往容易被开发人员忽视，同时又具有很大的危
害性，例如一些支付类的逻辑漏洞可能使企业遭受巨大的财产损失。传统的安全防护设备
和措施主要针对应用层面，而对业务逻辑层面的防护则收效甚微。攻击者可以利用程序员