6
）
这些列都是为了我们回答顾客美子电影内客的提问而
设计的。
236
第6章
---
## Page 269
SELECT进阶
当前表的问题
这些是DatavilleVideo的当前表的缺点。
顾客归还影片时我们不知道影片原本的
位置。
如果影片在表中多个列中的记录都为T，那真的不太容易判断
影片的上架分类。所以应该为影片指定单一分类。
大家都不太清楚影片的内容。
顾客有时会在喜剧区发现很恐怖的影片封面。目前T/F值的地
位都一样，归类时无法判断哪个列应该优先考虑。
添加T/F数据很花时间，而且常常出错。
每次进新片时都必须插入所有列的T/F值，列越多，越容易填
错。分类列应该有助于我们检查这些T/F列，而最后我们可以
摆脱旧的分类方法。
我们需要一个分类列来加快分类上架的速度、帮助顾客
了解他们选择的影片的类型，并减少店里的资料的错误。
动好
现有的列该如何对应到新的分类呢？有任何电影符合一种或多种分类吗？
当前位置
237
---
## Page 270
ALTER当前数据
比对现有数据
我们已经知道如何使用ALTER添加新的影片分类列，但添加实际分
类可能有点麻烦。幸好，表中的现有内容可以帮助我们识别出每部
影片的分类，我们不用看过每部影片再决定。
用很简单的句子重新写出每部影片的关系吧：
如果影片的
drama
列是T'
则把它的category列设为‘drama
如果影片的
comedy
列是'T
则把它的category列设为‘comedy
如果影片的
action
列是'T‘
则把它的category列设为'action‘
如果影片的
列是'T
则把它的category列设为'horror！
如果影片的
scifi
列是'T’
则把它的category列设为'scifi'
如果影片的
for_kids
列是'T’
则把它的category列设为'family
如果影片的
cartoon
列是'T
而且
rating
列是'G‘
则把它的category列设为'family
如果影片的
cartoon
列是'T
但
rating
列不是'G
则把它的category列设为'misc
有些卡通片不一定是给小孩看的，tatins列有助于
判新影片是否适合全家观赏。如果它的值是G，就
应该可以归类为“Bamily”：但如果不是，则归类
为“misc”。
238
第6章
---
## Page 271
SELECT进阶
产生新列
现在可以把前页的短句变成SQL的UPDATE语句：
UPDATE movie_table SET category'comedy'where comedy='T';
UPDATE movie_tableSETcategory='action'where action'T';
UPDATE movie_table SET category='family'where for_kids='T';
UPDATE movie_table SET category='family'where cartoon=T'AND rating='G';
UPDATE movie_table SET category'misc'where cartoon=T'AND rating <>'G';
tatins的值不为‘C
磨笋上吃
请填人下列影片的分类值。
movie_table
title
rating
drama
comedy
action
gore
scifi
for_
cartoon
category
kids
Big Adventure
G
F
F
F
F
F
T
F
Greg: The Untold Story
PG
F
F
T
F
F
F
F
Mad Clowns
R
F
F
F
T
F
F
F
Paraskavedekatriaphobia
R
T
T
T
F
T
F
F
Rat named Darcy.A
G
F
F
F
F
F
T
F
End of the Line
R
T
F
F
T
T
F
T
Shiny Things, The
PG
T
F
F
F
F
F
F
Take it Back
R
F
T
F
F
F
F
F
Shark Bait
G
F
F
F
F
T
F
Angry Pirate
PG
F
T
F
F
F
F
T
我们判断每个T/F列的顺序是否重要？
当前位置
239
---
## Page 272
磨笔上阵解答
磨笔上阵
解答
请填人下列影片的分类值。
movie_table
title
rating
drama
comedy
action
gore
scifi
for_kids
cartoon
category
Big Adventure
F
F
F
F
F
T
F
samily
Greg: The Untold Story
PG
F
F
T
F
F
F
action
Mad Clowns
R.
F
F
T
F
F
F
hortot
Paraskavedekatriaphobia
R
T
T
T
F
F
？
Rat named Darcy, A
G
F
F
F
F
F
T
F
Samity
End of the Line
R
T
F
F
T
>
F
T
misc
Shiny Things, The
PG
T
F
F
F
F
F
F
dtama
Take it Back
R
F
T
F
F
F
F
F
fpawtoo
Shark Bait
G
F
F
F
F
F
T
F
？
Angry Pirate
PG
F
T
F
F
F
misc
Potentially Habitable Planet
PG
F
T
F
F
T
F
F
问号表示这部影片金被多个UPDATE改变，它的分
类值将根据UPDATE执行的顺序而改变。
我们判断每个T/F列的顺序是否重要？
是的，确实重要。
顺序确实重要
顺序很重要。
以“Paraskavedekatriaphobia”为例（译注1），它
两个UPDATE语
最终将被归为scifi类，尽管影片内容或许更接近
喜剧。我们不确定它究竞该属于comedy、action、
句可能修改了
drama、cartoon、scifi 中的哪一类。既然不清楚放
相同列的值。
为哪一类，或许放在misc类中最为保险。
》译注1：paraskavedekatriaphobia或paraskevidekatriaphobia，13号星期五恐惧症。
240
第6章
---
## Page 273
SELECT进阶
如累数据较少的话，这似乎还不会构成问题，但
如票表中有几百列呢？有没有结合成一个超大型
UPDATE语句的方式呢？
嗯，是可以合成超大型UPDATE，但我
们有更好的工具。
利用CASE检查现有列的值和条件，就可以结合
所有UPDATE语句。如果现有列的值符合条件，
我们才会在新列中填入指定的值。
CASE甚至能告诉RDBMS，如果没有记录符合条
件时该如何处理。
以下是基本语法：
这里指定的列值将根据下
列条件做适当的更新。
UPDATEmy_table
CASE表达式由
SET new_column=
此开始。
>
CASE
WHEN：当符合这个
条件时….
>WHEN column1= somevalue1
THEN：然后花
new_column值设为此
>THENnewvaluel
处拖定的值。
绵排对运算没有影响
>WHEN column2=somevalue2
当符合另一个条件时
只是让我们更客易理
解程序代码。
THEN newvalue2
然后把new_colamn
值设为此处指定的另
ELSEnewvalue3
一个值。
K
>END;
任何不符合上迷条件的记录
CASE表达式和整段
都会被改为这个值。
UPDATE语句在此结秉
（因为它后面有分号）。
当前位置
241
---
## Page 274
用来UPDATE的CASE
使用CASE表达式来UPDATE
让我们把cASE表达式套用到movie_table上。
UPDATEmovie_table
这部分和“UPDATE movie_ta6le SET
SET category=
catesory ='drama’WHERE dtama
CASE
='T'”相同.但是要打的字可就少
WHEN drama ='T'THEN'drama'
多了！
WHEN cOmedy='T'THEN'cOmedy'
WHEN cartoon='T'THEN'family'
ELSE'misc'
END;
原本对新列套用UPDATE时还未知的数
凡是不符合上述条件的数据
据现在都有分类值了。
都会被归类为“misc”
不过，请注意我们如何为“Ansty Piate”和“End
o theLine”的分类列填入新值的。
movie_table
title
rating
drama
comedy
action
gore
scifi
for_-
cartoon
category
kids
Big Adventure
PG
F
F
F
F
F
F
T
family
Greg: The Untold Story
PG
F
F
T
F
F
F
F
action
Mod Clowns
R
F
F
F
T
F
F
F
horror
Paraskavedekatriaphobia
R
T
>
F
7
F
drama
Rat nomed Darcy. A
G
F
F
F
F
F
T
F
family
End of the Line
R
T
F
F
T
品
T
drama
 Shiny Things, The
PG
T
F
F
F
F
F
dromo
Take it Back
R
F
T
F
F
F
F
F
comedy
SharkBait
G
F
family
AngryPirate
PG
F
T
comedy
Potentially Habitable Planet
PG
F
1
comedy
242
第6章