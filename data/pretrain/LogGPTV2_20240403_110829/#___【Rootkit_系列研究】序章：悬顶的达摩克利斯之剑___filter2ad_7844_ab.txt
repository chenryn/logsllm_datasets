实际上，不仅是安全研究员研究对抗Rootkit，操作系统提供商也在积极与 Rootkit 作斗争。例如，Windows 10
操作系统提供了一系列驱动程序检测来对抗 Rootkit。
所谓 **道高一尺魔高一丈** ，攻击者也在开发绕过 Rootkit 防御机制的技术。例如，新的Moriya Rootkit已经提供了
**绕过驱动程序检查** 和 **PatchGuard 强制签名** 的功能。
甚至攻击者开始向 **硬件设备** 中 **注入 Rootkit 模块。**
Amnpardaz的恶意软件分析团队首次在 HP iLO设备中发现 Rootkit —— iLOBleed 。
HP iLO 设备带有自己的处理器单元、存储空间、RAM 和网卡，并且独立于任何本地操作系统运行。
它们的主要 **作用** 是为 **系统管理员** 提供一种 **连接远程系统** 的方法，即使 **系统处于关闭状态** 下，也可以 **执行维护操作**
，例如 **更新固件** 、 **安装安全更新** 或 **重新安装系统** 等。
iLOBleed 向iLO设备固件中添加了一个名为Implant.ARM.iLOBleed.a的恶意模块，并进行隐藏恶意活动和持久化操作。
攻击者通过更改多个原始固件模块方式，实现劫持 iLO 和服务器之间的消息交换通道，绕过固件正常更新过程，劫持管理 Web 界面以显示无效的 iLO
软件版本信息，鸡翅服务器事件日志模块以防止记录恶意软件的操作，修改 iLO 操作系统的多线程内核等功能， **达到高隐藏目的** 。
攻击者通过逆向分析提取 bootloader.bin、kernel.bin 和 ELF.bin 三个主要部分后，查找在 **引导加载程序**
和内核中执行签名验证操作的函数的地址，并将它们替换为 NOP 命令。最后，将修改后的文件组合在一起形成一个完整的 HP Image 文件，并作为新固件写入
SPI 闪存， **达到高持久化目的** 。
iLOBleed 在 **伪装完成更新** 的同时，默默地 **阻止固件更新** 。它还提供对服务器硬件的访问， **定期** 执行 **数据销毁操作**
。
Rootkit 技术在攻防两端的持续对抗下，不断发展。即使开发Rootkit需要对目标操作系统、逆向和编程有很高要求，其开发过程也是困难重重，但新的
Rootkit 还是会定期出现。
## 隐匿于Rootkit背后的影子
**内核级别的Rootkit难以开发，那么谁还坚持使用它们？**
**答案很明确：** 即具有足够技术和财力支持的战略性组织，这些组织通常会不计成本地进行 **经济犯罪、破坏基础设施** 或 **窃取数据** 。
DirtyMoe 僵尸网络、H2Miner 组织利用Rootkit进行持久化并隐藏挖矿模块，掩盖挖矿行为和其他恶意活动，将 Rootkit 技术直接用于
**经济犯罪** 。
Rootkit 在攻击中的使用最著名的事件莫过于 2010 年震网攻击事件（Stuxnet），攻击者使用 Stuxnet
秘密收集数据并将恶意文件文件下载到受感染机器。攻击的主要目的是阻止伊朗核系统的发展并实际 **破坏其基础设施** 。
由于Rootkit 相关开发的各种困难性与其应用场景，它们最常被 APT 组织使用。这一级别的攻击者的主要动机是 **窃取数据** 和
**从事网络间谍活动** 。
例如，攻击者使用Flame Rootkit跟踪受害者的网络流量、执行键盘记录功能并截取屏幕截图。
APT 组织Strider（也称为 ProjectSauron，或
G0041），其主要目标是俄罗斯、比利时、伊朗、瑞典和卢旺达等政府。在对政府机构的攻击中，使用了Remsec
Rootkit，用于窃取加密密钥、配置文件，并收集加密密钥基础设施服务器的 IP 地址。
Kaspersky研究人员发现了TunnelSnake行动，这是一起 **高级持续性威胁（APT）攻击** 活动。TunnelSnake至少从 2018
年开始，利用Moriya Rootkit有针对性的从事网络间谍活动。目标包括东南亚和非洲的两个外交组织。Moriya Rootkit 绕过Windows
系统驱动程序检查和 PatchGuard
模块的强制签名验证，为攻击者提供远程访问权限、拦截网络流量、下载和运行下攻击阶段的恶意代码、隐藏向受感染主机发出的恶意命令。这导致攻击者秘密控制了目标的网络长达数月之久。
根据Positive Technologies研究发现，最常见的目标是政府和研究机构，77%的Rootkit被攻击者用于 **收集数据等间谍目的** 。
44%的攻击针对政府部门，38%的攻击针对科研单位。这些机构的数据对攻击者往往具有重要价值。除此之外，电信、制造业、金融机构也是名列前茅。而56%的攻击被犯罪分子用来针对个人，包括高级官员、外交官等。而在动机方面，31%是出于经济利益，只有15%的攻击，试图利用受害者的基础设施进行后续攻击。
图2 受Rootkit攻击最多的 5 个行业
Rootkit将继续被APT组织使用，这意味着它不再只是为了破坏数据和获取经济利益，而是为了隐藏复杂的有针对性的攻击，这些攻击可能会给组织带来不可估量的损失。
综上所述，Rootkit 是非常 **危险** 并且造成的 **损失难以评估** ，原因是：
  * Rootkit 为攻击者提供 **系统权限** ；
  * Rootkit 使 **检测恶意活动** 变得更加 **困难** ；
  * Rootkit 很难被发现和清除在某些情况下 **无法移除Rootkit** ，必须升级受感染的硬件；
  * Rootkit **窃取数据** 带来的经济 **损失难以评估** ；
  * 目标设备存在内核态 Rootkit 通常表明，可能被一个准备充分的 **高水平组织** 发起的有 **针对性的攻击** ，这意味着虽然攻击未被检测到，但目标的基础设施可能处于攻击者的完全控制之下并 **潜伏多年** 。
## Rootkit的阿喀琉斯之踵
罗卡交换定律：“ **凡两个物体接触，必会产生转移现象**
”。其定律原本用于犯罪现场调查中，行为人（犯罪嫌疑人）必然会带走一些东西，亦会留下一些东西。即现场必会留下微量迹证。
罗卡交换定律衍生到计算机取证调查领域来说就是—— **当攻击者试图进行检测规避时，也产生了其他可以被检测的新特征** 。
所以高隐藏高持久化 Rootkit 并不是不可检测的。
其 Rootkit 技术本身，就存在 **阿喀琉斯之踵——隐藏永远是相对用户而言。**
攻击者使用Rootkit最关键的地方在于实现其所需功能的前提条件下，尽可能隐藏自身，实现所需功能意味着 Rootkit
必须要与系统进行交互，这说明Rootkit 运行过程中的数据， **必然是符合操作系统需求的数据结构** 。
技术不分好坏，只是看被谁利用，在攻击方利用Rootkit谋坏事之际，防守方也可以利用 Rootkit 发现攻击方的蛛丝马迹。
发现 Rootkit **植入后的异常** ，往往实时地 **处置异常** ，不是第一考虑的要素，因为目标设备存在Rootkit
，通常表明可能正在被一个准备充分的 **高水平APT组织** 发起的有 **针对性的攻击。一旦成为 APT 的目标，“他们”会继续回来，达到最终目的。**
此时， **安全分析师** 介入 **调查并取证溯源是最为重要的** ，定位 **数据泄漏范围** 以及 **攻击者信息** ，保护重要业务
**数据不再泄漏。**
**悬顶的达摩克里斯之剑还未真正落下** ，在 Rootkit 领域的攻防对抗中，就是较量攻防双方 **谁更了解操作系统，谁掌握的更深，谁就更占据优势**
。相信未来 Rootkit 技术还会向更加深远的领域不断前进。
To be continued ……
## 参考链接
1.
2.
3.
4.
5.
6.
7.
8.
9.
10.
11.
12.
13.