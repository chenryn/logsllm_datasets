User: 请解答这个和日志有关的问题Nginx only responds on port 80 externally I'm trying to setup a Nginx server for use with Django. To begin with I just wanted it to run on a non-standard port. 

When does it work?

I installed nginx with the default configuration and straight away I see the basic welcome page if I go to my servers IP in a browser.

If I change the port in sites-available/default to anything other than 80 however, I get a long response time followed by a timeout. This person seemed have a similar problem, but no answer was ever posted.



My set-up

I'm running:


nginx 1.10.1
Ubuntu 14.04.5
I have no firewall running
I have Wooey installed, although the server is not running (it's a django development server)
All i have changed in the nginx install is listen: 80 to listen: 81. It runs perfectly on port 80 and nothing on port 81.
I have tried changing the server name to the IP of the machine however that has not helped.
This is on a digital ocean VPS, so the only things running are what I've installed.
wget localhost:81 downloads the server page, so clearly it is working internally, but nothing happens externally


What am I missing? I have no idea how to debug this any further.

IP tables output 

Chain INPUT (policy ACCEPT)
target     prot opt source               destination
ACCEPT     all  --  anywhere             anywhere
REJECT     all  --  loopback/8           anywhere             reject-with icmp-port-unreachable
ACCEPT     icmp --  anywhere             anywhere             state NEW icmp echo-request
ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:ssh state NEW
ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:http state NEW
ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:https state NEW
ACCEPT     all  --  anywhere             anywhere             state RELATED,ESTABLISHED
LOG        all  --  anywhere             anywhere             limit: avg 5/min burst 5 LOG level debug prefix "iptables_INPUT_denied: "
REJECT     all  --  anywhere             anywhere             reject-with icmp-port-unreachable

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination
LOG        all  --  anywhere             anywhere             limit: avg 5/min burst 5 LOG level debug prefix "iptables_FORWARD_denied: "
REJECT     all  --  anywhere             anywhere             reject-with icmp-port-unreachable

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination


Relevant output of netstat -napl

Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      903/sshd
tcp        0      0 0.0.0.0:81              0.0.0.0:*               LISTEN      756/nginx -g daemon


Nginx error log only shows this message (access.log is empty)

2016/12/17 21:17:08 [notice] 14556#14556: signal process started

Nginx config is default:

Default server configuration

server {
        listen 81 default_server;
        #listen [::]:80 default_server;
        root /var/www/html;

        # Add index.php to the list if you are using PHP
        index index.html index.htm index.nginx-debian.html;

        server_name my_ip;
        ...

Assistant: In your firewall rules, we can read:

ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:http state NEW
ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:https state NEW


I can't find a rule allowing traffic on port 81.

Do you know where/how is managed iptables on this server? You'll probably want to duplicate a rule in there.

You should be able to make a non-persistent change using iptables directly:

iptables -I INPUT -p tcp -m state --state NEW --dport 81 -j ACCEPT