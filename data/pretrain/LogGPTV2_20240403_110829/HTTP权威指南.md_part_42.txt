时，搜索引擎用户会通过HotBot（http://www.hotbot.com）或Google（http://www.
google.com）这样的Web搜索网关对全文索引进行查询。Web页面总是在不断地
发生变化，而且爬行一大块Web要花费很长的时间，所以全文索引充其量也就是
Web的一个快照。
现代搜索引擎的高层结构如图9-7所示。
9.6.3 全文索引
全文索引就是一个数据库，给它一个单词，它可以立即提供包含那个单词的所有文
档。创建了索引之后，就不需要对文档自身进行扫描了。
注27： 这取决于服务器的资源、客户端的机器人，以及两者之间的网络状况。
Web机器人 ｜ 255
用户
Web服务器
用户
Web搜索网关 全文索引数据库 搜索引擎爬虫/索引器 Web服务器
用户
用户 Web服务器
Web搜索用户 查询索引 爬行及索引
图9-7 产品级搜索引擎中包含了一些协作的爬虫和查询网关
图9-8显示了三份文档和相应的全文索引。全文索引列出了包含每个单词的文档。
单词 文档
a A B
best A C
A buy A
drill A B
We have the best
electric A
tools,like the
WorkMaster 5000 fat C
electric drill. Buy a fire B
drill from us today!
from A
B have A
into B
The routine fire know C
drill turned into lose C
a tragedy today... routine B C
the AB C
C to C
today A B
We know the tools A
best routine tragedy B
to lose fat. turned B
us A
we A C
workmaster A
图9-8 三份文档和一个全文索引
比如：
• 单词“a”位于文档A和B中；
256 ｜ 第9章
• 单词“best”位于文档A和C中；
• 单词“drill”位于文档A和B中；
• 单词“routine”位于文档B和C中；
• 单词“the”位于所有的三份文档A、B和C中。 243
9.6.4 发布查询请求
用户向Web搜索引擎网关发布一条请求时，会填写一个HTML表单，他的浏览器
会用一个HTTP GET或POST请求将这个表单发送给网关。网关程序对搜索请求进
行解析，并将Web UI查询转换成搜索全文索引所需的表达式。28
图9-9显示了一条对www.joes-hardware.com站点的简单用户查询。用户在搜索框
表单中输入drills，然后浏览器就会将这个动作转换成一条在URL中包含请求参数
的GET请求。29Joe的五金商店的Web服务器收到这条请求，并将其转发给其搜索
网关应用程序，这个程序会将文档的结果列表返回给Web服务器，然后Web服务
器又会将这些结果转换成HTML页面提供给用户。
Welcome to Joe’s Hardware
Search for: drills
Submit
用户在浏览器中填写站点的HTML搜索表单（通过
HTTP方法的GET动作），单击Submit（提交）
客户端
请求报文
查询：drills
GET /search.html?query=drills HTTP/1.1
Host: www.joes-hardware.com
Accept: * 结果：文件BD.html
User-agent: ShopBot
www.joes-hardware.com 搜索网关
响应报文
HTTP/1.1 200 OK
Content-type: text/html
Content-length: 1037
Search Results
Black and Decker Drills
[...]
图9-9 搜索查询请求的实例
注28： 传送这条请求的方法与所使用的搜索策略有关。
注29：2.2.6节讨论了URL中查询参数的常见用法。
Web机器人 ｜ 257
9.6.5 对结果进行排序，并提供查询结果
一旦搜索引擎通过其索引得到了查询结果，网关应用程序会获取结果，并将其拼成
244 结果页面提供给终端用户。
很多Web页面都可能包含任意指定的单词，所以搜索引擎采用了一些很聪明的算
法，尝试着对结果进行排名。比如，在图9-8中，单词best出现在很多文档中；为
了将相关度最高的结果提供给用户，搜索引擎要知道应该按照什么顺序来提供结果
列表中的文档。这被称为相关性排名（relevancy ranking）——这是对一系列搜索结
果的评分和排序处理。
为了更好地辅助这一进程，在爬行Web的过程中都会进行数据统计。比如，对指向
指定页面的链接进行计数有助于判断其流行程度，还可以用此信息来衡量提供结果
的顺序。算法、爬行中获取的辅助信息以及搜索引擎所使用的其他技巧都是保守最
森严的秘密。
9.6.6 欺诈
在搜索请求得到的前几个结果中没有看到自己想要查找的内容时，用户通常会感到
很沮丧，因此，查找站点时搜索结果的顺序是很重要的。在搜索网管们认为能够最
245 好地描述其站点功能的单词时，会有众多因素激励着这些网管，努力使其站点排在
靠近结果顶端的位置上，尤其是那些依赖于用户找到它们，并使用其服务的商业
站点。
这种对较好排列位置的期待引发了很多对搜索系统的博弈，也在搜索引擎的实现者
和那些想方设法要将其站点列在突出位置的人之间引发了持久的拉锯战。很多网
管都列出了无数关键字（有些是毫不相关的），使用一些假冒页面，或者采用欺诈
（spoof）行为——甚至会用网关应用程序来生成一些在某些特定单词上可以更好地
欺骗搜索引擎相关性算法的假冒页面。
这么做的结果就是，搜索引擎和机器人实现者们要不断地修改相关性算法，以便更
有效地抓住这些欺诈者。
9.7 更多信息
更多有关Web客户端的信息，请参见下列资料。
• http://www.robotstxt.org/wc/robots.html
Web机器人页面——机器人开发者所需的资源，包括因特网机器人的登记注册。
258 ｜ 第9章
• http://www.searchengineworld.com
搜索引擎世界——搜索引擎和机器人的相关资源。
• http://www.searchtools.com
Web站点和内部网络的搜索工具——搜索工具和机器人的相关资源。
• http://search.cpan.org/doc/ILYAZ/perl_ste/WWW/RobotRules.pm
RobotRules的Perl语言资源。
• http://www.conman.org/people/spc/robots2.html
拒绝机器人访问的扩展标准。
• Managing Gigabytes: Compressing and Indexing Documents and Images（《海量数
据管理——文档和图像的压缩与索引》）
Witten, I.、Moffat, A.和Bell, T.编写，Morgan Kaufmann公司出版。 246
Web机器人 ｜ 259
第10章
HTTP-NG
261
在这本书即将完稿的时候，HTTP正在庆祝它的第十个生日。这十年是这个因特网
协议成就辉煌的十年。现在，世界上绝大多数的数字流量都是由HTTP传输的。
但随着HTTP迈入青少年时期，它也面临着一些挑战。从某些方面来说，HTTP应
用的步伐已经超越了其设计。现在，人们将HTTP作为各种不同应用程序的基础，
并将其运行在很多不同的联网技术之上。
本章对HTTP未来的一些发展趋势和所要面临的挑战，以及被称为HTTP-NG的下
一代HTTP结构方案进行了介绍。尽管HTTP-NG工作组已经解散了，而且看起来
也不太可能得到快速的应用，但它还是给出了HTTP未来一些潜在的发展方向。
10.1 HTTP发展中存在的问题
HTTP最初被设想为一种简单的技术，用于访问分布式信息服务器上链接的多媒体
内容。但在过去的十年中，HTTP及其衍生产品起到了更为广泛的作用。
HTTP/1.1现在提供了可以追踪文档版本的标记和指纹，提供了一些方法来支持文档
的上传以及与可编程网关之间的交互，还提供对多语言内容、安全及认证功能、降
低流量的缓存功能、减小时延的管道功能、降低启动时间提高带宽使用效率的持久
连接，以及用来进行部分更新的访问范围功能的支持。HTTP的扩展及衍生产品具
有更为广泛的功能，可以提供对文档发布、应用程序服务、任意的消息服务、视频
247 流以及无线多媒体访问的支持。HTTP正在成为分布式多媒体应用程序的“操作系统”。
尽管HTTP/1.1的设计经过了充分的考量，但随着HTTP被越来越多地用作复杂远
程操作的统一载体，HTTP/1.1已经开始显现出了一些局限性。HTTP的发展中至少
存在4个方面的问题。
• 复杂性
HTTP相当复杂，而且其特性之间是相互依存的。由于存在一些复杂的、相互交
织的要求，以及连接管理、报文处理和功能逻辑之间的混合作用，要想正确地实
现HTTP软件肯定是非常痛苦、很容易出错的。
• 可扩展性
HTTP很难实现递增式扩展。很多流传下来的HTTP应用程序中都没有自主的功
能性扩展技术，使协议的扩展无法兼容。
• 性能
HTTP中有些部分效率不高。其中很多低效特性会随着高时延、低吞吐量的无线
262 ｜ 第10章
访问技术的广泛使用而变得更加严重。
• 传输依赖性
HTTP是围绕TCP/IP网络协议栈设计的。尽管没有限制说不能使用替代协议栈，
但在这方面所做的工作非常少。HTTP要为替代协议栈提供更多的支持，才能作
为一个更广阔的报文发送平台应用于嵌入式和无线应用程序之中。
10.2 HTTP-NG的活动
1997年夏天，万维网联盟启动了一个特殊项目，调查并提出一个新的HTTP版本，
以修正与复杂性、可扩展性、性能及传输依赖性有关的一些问题。这个新的HTTP
被称为HTTP：下一代系统（HTTP-NG）。
在1998年12月举行的一次IETF会议上，提出了一组HTTP-NG建议。这些建议勾
勒出了一种可能的HTTP主要发展方向。这项技术还未被广泛采用（可能永远也不
会被广泛采用了），但HTTP-NG确实在扩展HTTP系统方面做出了最认真的努力。
下面我们来仔细看看HTTP-NG。
10.3 模块化及功能增强
可以用三个英语单词来描述HTTP-NG的主题：“模块化及功能增强”（modularize
and enhance）。如图10-1所示，HTTP-NG工作组建议将协议模块化为三层，而不
是将连接管理、报文处理、服务器处理逻辑和协议方法全都混在一起。 248
• 第一层，报文传输层（message transport layer），这一层不考虑报文的功能，而
是致力于端点间报文的不透明传输。报文传输层支持各种子协议栈（比如无线环
境下的协议栈），主要负责处理高效报文传输及处理方面的问题。HTTP-NG项目
组为本层提出了一个名为WebMUX的协议。
• 第二层，远程调用层（remote invocation layer），定义了请求/响应的功能，客户
端可以通过这些功能调用对服务器资源的操作。本层独立于报文的传输以及操作
的精确语义。它只是提供了一种标准的方法来调用服务器上所有的操作。本层试
图提供一种像CORBA、DCOM和Jave RMI那样的面向对象的可扩展框架，而
不是HTTP/1.1中那种静态的、服务器端定义的方法。HTTP-NG项目组建议本
层使用二进制连接协议（Binary Wire Protocol）。
• 第三层，Web应用层（Web application layer），提供了大部分的内容管理逻辑。
所有的HTTP/1.1方法（GET、POST、PUT等），以及HTTP/1.1首部参数都是
在这里定义的。本层还支持其他构建在远程调用基础上的服务，比如WebDAV。
HTTP-NG ｜ 263
第三层 Web应用功能
HTTP-NG 第二层 远程操作调用 二进制连接协议
第一层 报文传输 WebMUX
底层网络传输
TCP/IP
图10-1 HTTP-NG将功能都分散到各层之中实现
只要将HTTP组件模块化了，就可以对其进行改进，以提供更好的性能和更丰富的
特性。
10.4 分布式对象
HTTP-NG的很多基本原理和功能目标都是从CORBA和DCOM这样的结构化、面