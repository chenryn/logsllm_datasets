**防御**
防御这种攻击最好的方式就是在你的网络中消除使用 LM/NTLMv1 的主机.你可以为网络中的所有机器使用下面的组策略,.
    Network security: Do not store LAN Manager hash value on next password change – Enabled
    Network security: LAN Manager authentication level – Send NTLMv2 response only. Refuse LM & NTLM.
这些也可以在本地安全策略中设置.在策略生效后确保修改每个账号的密码,密码的复杂度要高一些比如: 15个字符以上.
最后也可以考虑下一个监控 spoofing
攻击的工具.[地址](https://www.netspi.com/blog/entryid/195/identifying-rogue-nbns-spoofers)
目录共享在 windows网络中的用的特别多,如果一个攻击者能够访问到共享,他就可以
查看敏感资料,执行代码等,比如以前的ipc$入侵….因此内网中的开放共享就成了攻击者比较喜欢的攻击点了.
**简单的攻击及他的影响**
在网络中查看开放的文件共享有很多工具可以帮助我们,这里介绍的是 [Softperfect’s Network Scanner
(Netscan)](http://www.softperfect.com/products/networkscanner/),我们可以导入需要扫描的ip给他或者像下图一样直接指定一个范围.
你可以在 Options中设置一些选项,比如选择Enable security and user permission scan
他就会在扫描到的共享中检测我们的权限,然后 按下 Start Scanning 就可以开始扫描了.
当找到我们开放的共享后我们要做的就是在这些共享中找一些有用的数据,比如一些账号密码等.我们可以使用
[AstroGrep](http://astrogrep.sourceforge.net/) 来帮我们查找,它支持使用正则表达式来查找一些数据.
这里找到了一个可能的账号密码
敏感文件.
**防御**
造成这种攻击的原因在于系统用户的错误配置,对这种东西的防御最好的方法就是对系统的使用者进行安全教育,以及定时的对网络进行检测.
**4.敏感资源的弱口令/默认口令**
这种方式的攻击非常简单,就是先找到一些比较好利用的东西,然后使用默认口令,弱口令进去,之后进一步渗透.
**简单的攻击及他的影响**
进行这种攻击我们不需要一款很复杂强大的自动化漏洞扫描器.我们可以使用下面的一些工具来辅助我们进行这样的攻击.
[Rapid Assessment of Web Resources (RAWR)
](https://bitbucket.org/al14s/rawr/wiki/Home)对网页进行快照,然后生成html报告便于我们分析
[Eyewitness](https://www.christophertruncer.com/eyewitness-usage-guide/)
与上面的功能类似
[Nmap http-screenshot script](http://blog.spiderlabs.com/2012/06/using-nmap-to-screenshot-web-services.html) 与上面的功能类似
[Nessus Default Common Credentials Scan
Policy](http://www.tenable.com/blog/scanning-for-default-common-credentials-using-nessus) 上面的工具专注于信息探测,这个会尝试对一些已知的服务,进行一些暴力破解之类的攻击
[NBTEnum 3.3](http://www.securityfocus.com/archive/1/452622)
该工具可以非常高效的找到用户名和密码相同的账号.不管你信不信,我曾经用这种方式搞定过一个内网.
找到了两个用户名和密码相同的账号.
下面看看使用默认口令能造成的危害.
**Tomcat**
tomcat有些默认口令:admin/admin,tomcat/tomcat.而且进入tomcat的管理界面后我们就可以部署一个war包来拿到一个webshell,又tomcat往往运行在
SYSTEM权限所以我们也不用去考虑提权的问题.下面是一个实例
使用默认账号密码进入tomcat 管理界面
上传webshell执行系统命令,查看权限:
可以看到是系统权限,下面我们可以添加用户,然后我们就可以接管目标的主机了.或者可以直接使用 metasploit的模块来利用
一些远程管理软件比如 vnc DRAC (Dell Remote Access Control), Radmin, 及
PCAnywhere如果存在弱口令或者默认口令,一旦被攻击者发现那么这台机器立马沦陷.下面是一些实例
**VNC**
直接控制目标机器
**DRAC**
使用 root/calvin 默认口令
Console Redirection Connection提供了对系统的完全控制.
**防御**
这种攻击的发生在于管理人员的安全意识不足,针对这样的攻击的防御有以下一些方式:
对管理人员进行安全教育,提升他们的安全意识,
对所有的敏感软件,资源的密码的要统一强化复杂度.
同时还要定期进行常规性的检测,来避免出现这类问题.
**5.利用具有公开exploit的漏洞**
在一个大型的网络中,由于种种原因系统管理员不可能对他所管辖的所有主机,应用都打上所有的补丁,尤其是在内网中.所以使用已有漏洞的exploit来进行渗透也是非常常见的事情.
有漏洞是一回事,有一个具有公开的exploit的漏洞又是另外一回事.Metasploit exploitation framework 和 exploit-db.com是两个最大的免费exploit的来源.下面介绍两个我最喜欢的使用这些exploit的方式.
第一个是 通过使用 Nessus 扫描策略配置Exploit Available =
True来进行扫描.扫描的结果中会返回一些可被利用的目标,或者直接就提供了远程访问.示例配置.
第二个就是大名鼎鼎的 Metasploit,首先使用nmap对网络进行扫描,之后导入扫描结果到 Metasploit中,然后结合经验,测试一些
exploit来实现攻击.比如使用 ms08-067 来进行攻击
使用MS09_050来攻击
**防御**
针对这种攻击的防御我们
首先要做的是搞清楚我们手里的资产有多少, 然后建立一套机制实现所有系统,软件能够尽快的一起打上最新的补丁.
使用上面所说的扫描策略对网络中的机器进行一次彻底的扫描,然后修补找到的问题,
最后安全人员需要关注网络中所有软件的的漏洞的披露情况,尽可能及时的打上补丁.
同时还可以在网络中部署一些监控报警的软件.
**总结**
本文很大部分都在讲 口令安全 方面的东西,可以看出在防御过程中最简单也最容易被忽视的问题就是
弱口令的问题,这也提示我们在渗透测试的过程中不可以轻视这种攻击手法.同时还讲了在内网中有价值的一些利用点,比如 LLMNR 以及
NBNS广播机制相关的一些安全问题,及老生常谈的
文件共享的问题,这些点在内网渗透时都是一些值得我们去关注的点.同时渗透测试就是各种手法,技巧的融合,不要轻视任何一种技巧,能拿到权限的技巧都是好技巧。