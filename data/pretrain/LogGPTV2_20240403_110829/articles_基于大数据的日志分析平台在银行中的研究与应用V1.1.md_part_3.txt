图3 部署方案
整个系统可由多个模块构成，并支持资源横向拓展及功能模块重新分布，用户可以根据自身服务器资源、数据量、系统稳定性等因素自定义各个模块的节点组成，同时支持物理机和虚拟机混合部署，保证数据安全性。在数据量每日达到十几TB时，通过集群部署方式，借助云计算能力和存储的弹性扩展能力为日志管理中心提供可靠的运行环境，满足日志审查要求。
对银行整体IT架构及业务流程做全面分析,针对银行业务特点，设计日志平台架构，实现日志集中采集、统一管理。
1.  消息队列技术 ②集群资源同步与管理技术
图4 日志中心总体架构图
-   物理支撑层：采用分布式集群方式搭建日志中心环境，借助云计算机能力和存储的弹性扩展能力为日志中心提供可靠的运行环境。
-   日志采集层：日志中心依据日志采集规范通过Agent、Syslog、ODBC、SNMP
    Trap、Socket、File等多种接口，采集各设备、系统和应用的本地型日志等；通过镜像等方式采集网络型日志，通过两种采集方式的合理配置，实现全部设备和资源的日志采集。
-   日志存储、加工层：实现日志的持久化、结构化存储，统一日志格式，并根据规则、策略库，对日志进行加工处理，结合资产信息实现日志信息的关联。
-   应用与展现层：实现系统管理、策略制定、规则制定、关键业务参数配置等基本业务功能，提供常用的告警分析场景，实现海量日志的快速查询，数据分析统计及可视化，并提供对外接口服务，方便系统进行二次开发。
> 数据处理流程：
>
> ![](media/image9.png){width="5.772222222222222in"
> height="3.854266185476815in"}
图5 数据流程图
##  模型的实现
### 日志采集技术
一个高可用的，高可靠的，分布式的海量日志采集、聚合和传输的系统，支持在日志系统中定制各类数据发送方，用于收集数据；同时提供对数据进行简单处理，并写到各种数据接受方（可定制）的能力。
\(1\) 可靠性
当节点出现故障时，日志能够被传送到其他节点上而不会丢失。集群提供了end-to-end模式来保障可靠性：收到数据agent首先将event发送到后端消息队列集群，如果数据发送失败，将event写到磁盘上，可以重新发送。
\(2\) 可扩展性
模块完全是多主平行结构，不存在单点故障问题。
\(3\) 可管理性
每个节点均提供metric
api接口，以json格式数据展现服务状态，方便提供服务指标和运维监控。
### 消息队列技术
用于消息的持久化和缓存。该系统使用磁盘文件做持久化，顺序进行读写，以append方式写入文件。为减少内存copy，集群使用sendfile发送数据，通过合并message提升性能。集群本身不储存每个消息的状态，而使用（consumer/topic/partition）保存每个客户端状态，大大减小了维护每个消息状态的麻烦。在消息推拉的选择上，集群使用拉的方式，避免推的方式下存在的各个客户端的处理能力、流量等不同产生不确定性。以多机形式形成集群，建议3台或3台以上奇数台服务器组建，并且支持分区副本。
采用高吞吐量的分布式发布订阅消息系统有如下特性：
通过的磁盘数据结构提供消息的持久化，这种结构对于即使数以TB的消息也能够保持长时间的稳定性能。
高吞吐量，即使是非常普通的硬件也可以支持每秒数百万的消息。
消息队列对消息保存时根据Topic进行归类，一个Topic可以认为是一类消息，每个topic将被分成多个partition(区),每个partition在存储层面是append
log文件。任何发布到此partition的消息都会被直接追加到log文件的尾部，每条消息在文件中的位置称为offset（偏移量），offset为一个long型数字，它是唯一标记一条消息。
![](media/image10.png){width="3.5305555555555554in" height="2.28125in"}
### 集群资源同步与管理技术
一个针对大型分布式系统的高可靠协调系统，提供的功能包括：配置维护、名字服务、分布式同步、组服务等。封装好复杂易出错的关键服务，将简单易用的接口和性能高效、功能稳定的系统提供给用户。由3台或3台以上奇数台服务器组建完成，具有如下3个特性：
-   提供丰富的构件来实现多种协调数据结构和协议。
-   访问原子性，客户端要么读到所有数据，要么读取失败，不会出现只读取部分的情况。
-   具有高可用性，帮助系统避免单点故障，故障时可以快速删掉故障服务器。故障回复时，重新加入到集群。
### 日志分析技术
采用业界最先进的流式大数据处理架构Spark
Streaming，构建的高性能、分布式日志处理架构可以每秒钟分析10万条日志，每天可以处理TB级的日志量，而且处理延时非常短，可以让用户搜索、分析几秒钟之前产生的日志。
流式计算集群具有如下特性：
● 轻量级快速处理
着眼大数据处理，速度往往被置于第一位。Spark允许Hadoop集群中的应用程序在内存中以100倍的速度运行，即使在磁盘上运行也能快10倍。Spark通过减少磁盘IO来达到性能提升，它们将中间处理数据全部放到了内存中。
● 无数据丢失
系统需要保证无数据丢失，这也是系统高可用性的保证。系统为了无数据丢失，需要在数据处理失败的时候选择另外的执行路径进行replay（系统不是简单的重新提交运算，而是重新执行调度，否则按照来源的call
stack有可能使得系统永远都在相同的地方出同样的错误）。
● 容错透明
用户不会也不需要关心容错。系统会自动处理容错，调度并且管理资源，而这些行为对于运行于其上的应用来说都是透明的。
5.  ### 
6.  ### 前端服务技术
采用LVS + Nginx构建的前端机器，主要有以下特点：
-   Http、rest协议
-   水平扩展
-   流量上涨时可快速通过增加前端机来提高处理能力
-   高吞吐、低延时
-   纯异步处理，单个请求异常不会影响其他请求
-   内部采用专门针对日志的Lz4压缩，提高单机处理能力，降低网络带宽
6.  **课题研究总结与展望**
## 
  --------- ------ ------ ------ ------ ------ ------ --- ------ ------ -------
  --------- ------ ------ ------ ------ ------ ------ --- ------ ------ -------
### 
  ------------ -------------------- -------------------- -----------------
  ------------ -------------------- -------------------- -----------------
### 
  -------- --------------------- -------- -------------------------------