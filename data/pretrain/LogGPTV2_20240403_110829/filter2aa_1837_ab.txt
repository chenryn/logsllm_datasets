• MSSQLSvc/adsmsSQL01.adsecurity.org:1433
• RDP
• TERMSERV/adsmsEXCAS01.adsecurity.org
• WSMan/WinRM/PS Remoting
• WSMAN/adsmsEXCAS01.adsecurity.org
• Forefront Identity Manager
• FIMService/adsmsFIM01.adsecurity.org
• Exchange Client Access Servers
• exchangeMDB/adsmsEXCAS01.adsecurity.org
• Microsoft SCCM
• CmRcService/adsmsSCCM01.adsecurity.org
| @PryoTek3 | sean @ adsecurity.org |
SPN Scanning
SPN Directory:  
http://adsecurity.org/?page_id=183
| @PryoTek3 | sean @ adsecurity.org |
Cracking Service Account Passwords 
(Kerberoast)
Request/Save TGS service tickets & crack offline.
“Kerberoast” python-based TGS password cracker.
No elevated rights required.
No traffic sent to target.
https://github.com/nidem/kerberoast
| @PryoTek3 | sean @ adsecurity.org |
Discover Admin Accounts: Group Enumeration
| @PryoTek3 | sean @ adsecurity.org |
Discover Admin Accounts – RODC Groups
| @PryoTek3 | sean @ adsecurity.org |
Discover Admin Accounts –
AdminCount = 1
| @PryoTek3 | sean @ adsecurity.org |
Discover AD Groups with Local Admin Rights
| @PryoTek3 | sean @ adsecurity.org |
Discover AD Groups with Local 
Admin Rights
| @PryoTek3 | sean @ adsecurity.org |
Attack of the Machines:
Computers with Admin Rights
| @PryoTek3 | sean @ adsecurity.org |
Discover Users with Admin Rights
| @PryoTek3 | sean @ adsecurity.org |
Discover Virtual Admins
| @PryoTek3 | sean @ adsecurity.org |
Follow the Delegation…
| @PryoTek3 | sean @ adsecurity.org |
Follow the Delegation…
| @PryoTek3 | sean @ adsecurity.org |
Discover Admin Accounts: Group Policy 
Preferences
\\\SYSVOL\\Policies\
| @PryoTek3 | sean @ adsecurity.org |
Identify Partner Organizations via Contacts
| @PryoTek3 | sean @ adsecurity.org |
Identify Partner Organizations via Contacts
| @PryoTek3 | sean @ adsecurity.org |
Identify Domain Password Policies
| @PryoTek3 | sean @ adsecurity.org |
Identify Fine-Grained Password Policies
| @PryoTek3 | sean @ adsecurity.org |
Group Policy Discovery
| @PryoTek3 | sean @ adsecurity.org |
Identify AppLocker Whitelisting Settings
| @PryoTek3 | sean @ adsecurity.org |
Identify Microsoft EMET Configuration
| @PryoTek3 | sean @ adsecurity.org |
Identify Microsoft LAPS Delegation
| @PryoTek3 | sean @ adsecurity.org |
Identify Microsoft LAPS Delegation
| @PryoTek3 | sean @ adsecurity.org |
AD Defenses & Bypasses
| @PryoTek3 | sean @ adsecurity.org |
| @PryoTek3 | sean @ adsecurity.org |
HoneyTokens, HoneyCredentials…
•Credentials injected into memory.
•Deployment method? 
•May or may not be real on the network.
•Validate account data with AD.
•Avoid these.
| @PryoTek3 | sean @ adsecurity.org |
Randomized Local Admin PW (LAPS)
•PowerUp to local admin rights.
•Dump service credentials. 
•Leverage credentials to escalate 
privileges.
•Find AD accounts with LAPS password 
view rights.
•Find secondary admin account not 
managed by LAPS.
| @PryoTek3 | sean @ adsecurity.org |
Network Segmentation
•“High Value Targets” isolated on the 
network.
•Admin systems on separate segments.
•Find admin accounts for these systems & 
where they logon.
•Compromise patching system to gain 
access. (see PowerSCCM in PowerSploit).
| @PryoTek3 | sean @ adsecurity.org |
No Domain Admins
•Check domain “Administrators” 
membership.
•Look for custom delegation:
•“Tier” or “Level”
•Workstation/Server Admins
•Somebody has rights! 
| @PryoTek3 | sean @ adsecurity.org |
Privileged Admin Workstation (PAW)
• Active Directory Admins only logon to PAWs.
• Should have limited/secured communication.
• Should be in their own OU.
• May be in another forest (Red/Admin Forest).
• Compromise install media or patching system.
• Compromise in/out comms.
| @PryoTek3 | sean @ adsecurity.org |
Jump (Admin) Servers
• If Admins are not using Admin workstations, 
keylog for creds on admin’s workstation.
• Discover all potential remoting services.
• RDP
• WMI
• WinRM/PowerShell Remoting
• PSExec
• NamedPipe
• Compromise a Jump Server, 0wn the 
domain!
| @PryoTek3 | sean @ adsecurity.org |
AD Admin Tiers
| @PryoTek3 | sean @ adsecurity.org |
https://technet.microsoft.com/en-us/library/mt631193.aspx
AD Admin Tiers
| @PryoTek3 | sean @ adsecurity.org |
https://technet.microsoft.com/en-us/library/mt631193.aspx
ESAE Admin Forest (aka “Red Forest”)
| @PryoTek3 | sean @ adsecurity.org |
https://technet.microsoft.com/en-us/library/mt631193.aspx#ESAE_BM
ESAE Admin Forest (aka “Red Forest”)
• The “best” way to secure & protect AD.
• Separate forest with one-way forest trust.
• Separate smart card PKI system.
• Separate updating & patching system.
• All administration performed w/ ESAE 
accounts & ESAE computers.
• Completely isolated.
| @PryoTek3 | sean @ adsecurity.org |
Universal Bypass for Most Defenses
•Service Accounts
•Over-permissioned
•Not protected like Admins
•Weak passwords
•No 2FA/MFA
•Limited visibility/understanding
| @PryoTek3 | sean @ adsecurity.org |
Interesting AD Facts
•All Authenticated Users have read 
access to: 
• Most (all) objects & their attributes in AD 
(even across trusts!).
• Most (all) contents in the domain share 
“SYSVOL” which can contain interesting 
scripts & files.
| @PryoTek3 | sean @ adsecurity.org |
Interesting AD Facts:
•Standard user account…
• Elevated rights through “SID History” 
without being a member of any 
groups.
• Ability to modify users/groups without 
elevated rights w/ custom OU ACLs.
• Modify rights to an OU or domain-
linked GPO, compromise domain.
| @PryoTek3 | sean @ adsecurity.org |
A Security Pro’s AD Checklist
• Identify who has AD admin rights (domain/forest).
• Identify DC logon rights. 
• Identify virtual host admins (virtual DCs).
• Scan Active Directory Domains, OUs, 
AdminSDHolder, & GPOs for inappropriate custom 
permissions.
• Ensure AD admins protect their credentials by not 
logging into untrusted systems (workstations).
• Limit service account rights that are currently DA (or 
equivalent).
| @PryoTek3 | sean @ adsecurity.org |
PowerView AD Recon Cheat Sheet
• Get-NetForest
• Get-NetDomain
• Get-NetForestTrust
• Get-NetDomainTrust
• Invoke-MapDomainTrust
• Get-NetDomainController
• Get-DomainPolicy
• Get-NetGroup
• Get-NetGroupMember
• Get-NetGPO
• Get-NetGPOGroup
• Get-NetUser
• Invoke-ACLScanner
| @PryoTek3 | sean @ adsecurity.org |
Summary
•AD stores the history of an organization. 
•Ask the right questions to know more 
than the admins.
•Quickly recon AD in hours (or less)
•Business requirements subvert security.
•Identify proper leverage and apply.
| @PryoTek3 | sean @ adsecurity.org |
Questions?
Sean Metcalf (@Pyrotek3)
s e a n @ adsecurity . org
www.ADSecurity.org
Slides:  Presentations.ADSecurity.org 
| @PryoTek3 | sean @ adsecurity.org |
References
• PowerShell Empire
http://PowerShellEmpire.com
• Active Directory Reading Library
https://adsecurity.org/?page_id=41
• Read-Only Domain Controller (RODC) Information
https://adsecurity.org/?p=274
• DEF CON 18: Dave Kennedy & Josh Kelly “PowerShell OMFG!” 
https://www.youtube.com/watch?v=JKlVONfD53w
• PowerShell v5 Security Enhancements
http://blogs.msdn.com/b/powershell/archive/2015/06/09/powershell-
the-blue-team.aspx
• Detecting Offensive PowerShell Attack Tools 
https://adsecurity.org/?p=2604
• Active Directory Recon Without Admin Rights
https://adsecurity.org/?p=2535
| @PryoTek3 | sean @ adsecurity.org |
References
• Mining Active Directory Service Principal Names
http://adsecurity.org/?p=230
• SPN Directory:  
http://adsecurity.org/?page_id=183
• PowerView GitHub Repo (PowerSploit)
https://github.com/PowerShellMafia/PowerSploit/tree/master/Recon
• Will Schroeder (@harmj0y): I have the PowerView (Offensive Active Directory 
PowerShell) Presentation
http://www.slideshare.net/harmj0y/i-have-the-powerview
• MS14-068: Vulnerability in (Active Directory) Kerberos Could Allow Elevation of 
Privilege
http://adsecurity.org/?tag=ms14068
• Microsoft Enhanced security patch KB2871997
http://adsecurity.org/?p=559
• Tim Medin’s DerbyCon 2014 presentation: “Attacking Microsoft Kerberos: Kicking 
the Guard Dog of Hades”
https://www.youtube.com/watch?v=PUyhlN-E5MU
• Microsoft: Securing Privileged Access Reference Material
https://technet.microsoft.com/en-us/library/mt631193.aspx
• TechEd North America 2014 Presentation: TWC: Pass-the-Hash and Credential 
Theft Mitigation Architectures (DCIM-B213) Speakers: Nicholas DiCola, Mark 
Simos http://channel9.msdn.com/Events/TechEd/NorthAmerica/2014/DCIM-B213
| @PryoTek3 | sean @ adsecurity.org |
References
• Mimikatz
https://adsecurity.org/?page_id=1821
• Attack Methods for Gaining Domain Admin Rights in Active 
Directory 
https://adsecurity.org/?p=2362
• Microsoft Local Administrator Password Solution (LAPS) 
https://adsecurity.org/?p=1790
• The Most Common Active Directory Security Issues and What 
You Can Do to Fix Them 
https://adsecurity.org/?p=1684
• How Attackers Dump Active Directory Database Credentials 
https://adsecurity.org/?p=2398
• Sneaky Active Directory Persistence Tricks
https://adsecurity.org/?p=1929
| @PryoTek3 | sean @ adsecurity.org |
| @PryoTek3 | sean @ adsecurity.org |
Detecting/Mitigating PS>Attack
• Discover PowerShell in non-standard processes.
• Get-Process modules like 
“*Management.Automation*”
| @PryoTek3 | sean @ adsecurity.org |
Detecting EXEs Hosting PowerShell
•Event 800: HostApplication not standard 
Microsoft tool 
•Event 800: Version mismatch between 
HostVersion & EngineVersion (maybe).
•System.Management.Automation.dll hosted 
in non-standard processes.
•EXEs can natively call .Net & Windows APIs 
directly without PowerShell.
| @PryoTek3 | sean @ adsecurity.org |