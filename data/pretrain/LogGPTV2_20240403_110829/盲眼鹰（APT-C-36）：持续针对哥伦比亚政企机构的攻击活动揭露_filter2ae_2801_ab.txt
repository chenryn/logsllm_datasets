---|---  
MD5 | ef9f19525e7862fb71175c0bbfe74247  
编译信息 | .NET  
释放执行的1.exe为最终的木马后门，该样本为混淆比较严重的C#代码：
去混淆后可以明确看到Imminent Monitor字符串，该样本为Imminent Monitor RAT：
样本运行后首先从资源文件中提取名称为“application”的数据，并解密出一个来自7zip合法的lzma.dll库：
随后从资源文件中提取名称为“_7z的”数据，并利用lzma.dll解压缩该段数据，得到真正的Imminent Monitor RAT样本（MD5:
4fd291e3319eb3433d91ee24cc39102e）：
核心功能分析
MD5 | 4fd291e3319eb3433d91ee24cc39102e  
---|---  
  * 静态分析
该样本包含Imminent Monitor RAT实体功能代码，但采用了ConfuserEx+Eazfuscator.NET双重淆器加密了代码，如下图所示：
部分去混淆后可以看出其提供的功能如下表：
ID | 功能  
---|---  
bDfBqxDCINCfwSAfMnZwspLefnc | 主机管理  
ChatPacket | 用户支持  
cokLfFnjBwgKtzdTpdXSgQIPacR | 注册表管理  
CommandPromptPacket | 远程命令行  
ConnectionSocketPacket | 网络传输通道管理  
ExecutePacket | 上传、下载、执行PE文件  
FastTransferPacket | 支持快速传输  
FilePacket | 文件管理  
FileThumbnailGallery | 支持文件缩略图库  
KeyLoggerPacket | 键盘记录  
MalwareRemovalPacket | 恶意功能管理  
MessageBoxPacket | 聊天消息  
MicrophonePacket | 麦克风聊天  
MouseActionPacket | 鼠标动作  
MouseButtonPacket | 鼠标左、右、掠过等  
NetworkStatPacket | 主机网络管理  
PacketHeader | 通信数据头信息  
PasswordRecoveryPacket | 浏览器密码恢复  
PluginPacket | 插件管理  
ProcessPacket | 进程管理  
ProxyPacket | 代理管理（反向代理等）  
RDPPacket | 提供远程桌面功能  
RegistryPacket | 注册表操作  
RemoteDesktopPacket | 标志远程桌面数据包  
ScriptPacket | 执行脚本（html、vbs、batch）  
SpecialFolderPacket | Windows特殊文件夹  
StartupPacket | 启动项操作  
TcpConnectionPacket | TCP刷新及关闭  
ThumbnailPacket | 缩略图相关  
TransferHeader | 通信连接操作  
WebcamPacket | 网络摄像头相关  
WindowPacket | Windows操作（刷新、最大化、最小化等）  
通过分析与其官方网站提供的功能说明一致：
  * 动态调试
核心模块运行后会检测是否在%temp%\\[appname]目录下，如果不在则将自身拷贝为%temp%\\[appname]\\[appname]，并设置文件属性为隐藏：
然后启动%temp%\\[appname]：
最后删除原始文件，并退出进程
样本重新启动后将在%AppData%目录创建Imminent目录，该目录将保存加密后的日志、网络信息、系统信息等文件，当接受到相应指令时发送到服务端：
C&C地址为：mentes.publicvm.com:4050
###  TTP（战术、技术、过程）
360威胁情报中心总结了该APT组织的TTP如下：
攻击目标 | 哥伦比亚的政府机构、大型企业以及跨国企业的哥伦比亚分支部门  
---|---  
最早活动时间 | 2018年4月  
主要风险 | 主机被远程控制，机密信息被窃取  
攻击入口 | 鱼叉邮件  
初始载荷 | MHTML文件格式含恶意宏代码的Word文档  
恶意代码 | Imminent后门  
通信控制 | 基于动态域名的远程控制  
抗检测能力 | 中  
受影响应用 | Windows系统主机  
主要攻击战术技术特征分析 |
  1. 通过入侵西班牙语网站或者注册有隐私保护的域名并上传用于投放的攻击载荷文件和文档；
  2. 发送带有MHTML文件格式并包含恶意宏代码的Word文档的鱼叉邮件，并会使用RAR加密诱饵文档以避免邮件网关的查杀；
  3. 攻击者伪装成哥伦比亚国家民事登记处、哥伦比亚国家税务和海关总署、哥伦比亚国家统计局、哥伦比亚国家网络警察局、哥伦比亚国家司法部门，对哥伦比亚的政府、金融机构，本国大型企业或跨国公司的哥伦比亚分公司进行攻击；
  4. 使用了商业木马Imminent对目标进行远程控制，并采用了基于动态域名的远程控制技术；
## 溯源和关联
360威胁情报中心通过分析攻击者投递的多个加密的Office
Word文档的最后修改时间、MHTML文档字符集（语言环境）等信息，并结合地缘政治等APT攻击的相关要素，怀疑攻击者来自于UTC时区在西4区（UTC-4）正负1小时对应的地理位置区域。
###  可靠的文件修改时间
以投递的加密RAR压缩包（Registraduria Nacional del Estado Civil -Proceso
inicado.rar）为例，由于RAR会保存文件的修改时间，所以解密RAR包后得到的Word文档的修改时间非常可靠。右边为解密得到的Word文档修改时间，这和左边诱饵文档（MHTML）元信息内包含的文档修改时间一致（由于笔者处于UTC+8时区，需要将文件修改时间减8小时对比）：
通过对比所有加密RAR文件内的诱饵文档修改时间和文档元信息内的文档修改时间，我们有很大的把握确认文档元信息内的修改时间为攻击者的真实修改时间，这样我们可以以捕获到的所有诱饵文档元信息内的修改时间做数据统计。
###  MHTML诱饵文档修改时间统计
我们统计了所有诱饵文档的修改时间如下表：
UTC+00  
---  
00:32  
01:15  
01:15  
01:17  
01:35  
01:59  
02:57  
03:28  
04:40  
04:55  
05:17  
12:27  
12:49  
12:50  
13:38  
13:42  
13:49  
14:21  
14:22  
15:19  
15:26  
15:30  
15:56  
17:22  
17:58  
18:31  
20:53  
21:31  
23:30  
从大量样本的修改时间可以看出，从未出现过修改时间在05:30到12:30之间的诱饵文档。基于最合理的推测：正常的休息时间应该在晚12点到早8点之间的区域（睡觉时间段），那么攻击者所处的时区应该在西4区（UTC-4）正负1小时的区间内。
###  PE时间戳与诱饵文档修改时间对比
我们还统计了木马程序去混淆后dump出来的核心PE文件时间戳信息，与每个对应的诱饵文档修改时间进行对比可以看出：诱饵文档的修改时间与对应的PE文件的时间戳间隔都非常接近，这更加说明了该攻击活动的定向属性：
诱饵文档修改时间 | 木马核心模块时间戳  
---|---  
2019/2/11 17:58 | 2019/2/14 3:28  
2018/12/3 15:30 | 2018/12/3 23:26  
2018/11/26 18:31 | 2018/10/17 22:29  
2018/11/15 12:49 | 2018/10/17 22:29  
2018/11/8 14:21 | 2018/10/17 22:29  
2018/10/26 13:49 | 2018/10/17 22:29  
2018/10/22 17:22 | 2018/10/17 22:29  
2018/10/12 15:56 | 2018/10/17 22:29  
2018/10/4 5:17 |  
2018/9/13 13:42 | 2018/8/27 22:08  
2018/9/9 0:32 |  
2018/9/2 20:53 | 2018/8/27 22:08  
2018/8/27 15:19 | 2018/8/27 22:08  
2018/8/6 1:35 | 2018/8/1 11:25  
2018/8/1 2:57 | 2018/8/1 11:25  
2018/7/31 1:59 | 2018/8/1 11:25  
2018/7/30 1:17 | 2018/8/1 11:25  
2018/7/26 3:28 | 2018/8/27 22:08  
2018/7/10 4:55 | 2018/7/11 11:47  
2018/6/19 21:31 |  
2018/6/14 1:15 |  
2018/6/14 1:15 |  
2018/5/29 13:38 |  
2018/5/18 14:22 | 2018/5/22 20:11  
2018/4/28 12:27 | 2018/5/22 20:11  
2018/4/25 23:30 | 2018/5/22 20:11  
2018/4/24 12:50 |  
2018/4/17 15:26 | 2018/5/22 20:11  
2018/4/6 4:40 |  
###  语言和charset
另外，我们统计了所有的诱饵文档（MHTML），可以看到所有诱饵文档都基于西欧语言环境（西班牙语等）编写：
Charset：windows-1252
而部分诱饵文档的作者信息也是西班牙文：
Centro de Servicios Judiciales