Chapter 2    Setting Up Share Points
Setting Up a Drop Box
A drop box is a shared folder with permissions set so that anyone can copy files into 
the folder, but only the owner can read them.
Note:  Create drop boxes only within AFP share points. AFP is the only protocol that 
automatically changes the owner of any file put into the drop box to be the same as 
the owner of the drop box. For other protocols, the ownership of the file is not 
transferred even though the original owner may not have access to the file once it’s 
inside the drop box.
To create a drop box:
1 Create the folder that will act as a drop box within an AFP share point.
2 Open Workgroup Manager and click Sharing.
3 Click Share Points and select the folder in the AFP share point that you want to use as a 
drop box. 
4 Click General.
5 Set Write Only privileges for users who can copy items into the drop box. 
To create a drop box for a select group of users, enter the group name (or drag the 
group from the Users & Groups drawer) and choose Write Only privileges from the 
Group pop-up menu. 
To create a drop box anyone can put things in, choose Write Only privileges from the 
Everyone pop-up menu. (For greater security, do not allow access to everyone—assign 
None for the Everyone privileges.)
6 Click Save.
From the Command Line
You can also set up a drop box using the mkdir and chmod commands in Terminal. For 
more information, see the file services chapter of the command-line administration 
guide.
LL2346.Book  Page 34  Friday, August 22, 2003  2:38 PM
Chapter 2    Setting Up Share Points
35
Using Workgroup Manager With Mac OS X Server Version 10.1.5
Workgroup Manager is available only on Mac OS X Server version 10.2 or later. If you 
want to use Workgroup Manager to edit account information on a Mac OS X Server 
version 10.1.5, you must access that server remotely from a computer running 
Mac OS X Server version 10.2 and log in as a root user.
To log in to a remote server as a root user with Workgroup Manager:
1 In Workgroup Manager, choose the shared domain of interest from the domain pop-up 
list below the toolbar.
Alternatively, you can choose View Directories from the Server menu.
2 Use a root user name and password to log in.
If you are not logged in as a root user, you can’t make changes using Workgroup 
Manager. 
If possible, you should upgrade servers on your network to use Mac OS X Server 
version 10.2 or later.
LL2346.Book  Page 35  Friday, August 22, 2003  2:38 PM
LL2346.Book  Page 36  Friday, August 22, 2003  2:38 PM
3
37
3 AFP Service
This chapter shows how to set up and manage AFP 
service in Mac OS X Server.
General Information
AFP (Apple Filing Protocol) service allows Macintosh clients to connect to your server 
and access folders and files as if they were located on their own computers. 
AFP service uses version 3.1 of AFP, which supports new features such as Unicode file 
names and 64-bit file sizes. Unicode is a standard that assigns a unique number to 
every character regardless of language or the operating system used to display the 
language.
Kerberos Authentication
Apple file service supports Kerberos authentication. Kerberos is a network 
authentication protocol developed at MIT to provide secure authentication and 
communication over open networks. In addition to the standard authentication 
method, Mac OS X Server utilizes Generic Security Services Application Programming 
Interface (GSSAPI) authentication protocol to support Kerberos v.5. You specify the 
authentication method using the Access pane of AFP service settings. See “Changing 
Access Settings” on page 41. For more information on setting up Kerberos, see the 
Open Directory administration guide.
LL2346.Book  Page 37  Friday, August 22, 2003  2:38 PM
38
Chapter 3    AFP Service
Automatic Reconnect
Mac OS X Server provides the ability to automatically reconnect Mac OS X clients that 
have become idle or gone to sleep. When clients become idle or go to sleep, the 
Mac OS X Server disconnects those clients to free up server resources. Mac OS X Server 
can save Mac OS X client sessions, however, allowing these clients to resume work on 
open files without loss of data. You configure this setting in the Idle Users pane of the 
AFP service configuration window. See “Changing Idle User Settings” on page 43.
Find By Content
Mac OS X clients can use Sherlock to search the contents of AFP servers. This feature 
enforces privileges so that only files to which the user has access are searched. 
AppleTalk Support
One difference in the new Apple file service is that AppleTalk is no longer supported as 
a client connection method. Mac OS X Server advertises its services over AppleTalk so 
clients using AppleTalk can see servers in the Chooser, but they’ll need to connect to 
the server using TCP/IP. See “Mac OS X Clients” on page 51 and “Mac OS 8 and 
Mac OS 9 Clients” on page 53.
Apple File Service Specifications
• Maximum number of connected users, depending on your license 
agreement:  Unlimited (hardware dependent)
• Maximum volume size:  2 terabytes
• TCP port number:  548
• Log file location:  /Library/Logs in the AppleFileService folder
• Rendezvous registration type:  afpserver
LL2346.Book  Page 38  Friday, August 22, 2003  2:38 PM
Chapter 3    AFP Service
39
Setting Up AFP Service
If you allowed the Server Assistant to start AFP service when you installed Mac OS X 
Server, you don’t have to do anything else. However, you should check to see if the 
default service settings meet your needs. The following section steps you through each 
of the Apple file service settings.
You set up Apple file service by configuring four groups of settings on the Settings 
pane for AFP service in Server Admin:
• General  Set information that identifies your server, enable automatic startup, and 
create a login message for Apple file service
• Access  Set up client connections and guest access
• Logging  Configure and manage logs for Apple file service
• Idle Users  Configure and administer idle user settings
The following sections describe the tasks for configuring these settings. A fifth section 
tells you how to start up Apple file service after you’ve completed its configuration.
LL2346.Book  Page 39  Friday, August 22, 2003  2:38 PM
40
Chapter 3    AFP Service
Changing General Settings
You use the General pane of AFP service settings to enable automatic startup, enable 
browsing with Network Service Location or AppleTalk, and create a login greeting for 
your users. 
To configure AFP service General settings:
1 Open Server Admin and select AFP in the Computers & Services list.
2 Click Settings, then click General. 
3 To advertise the AFP share point using both Network Service Location (NSL) and 
Rendezvous, select “Enable Rendezvous registration.” 
This option lets clients browse for the share point using the Mac OS X “Connect to 
Server” command or the Mac OS 9 Network Browser.
For NSL registration to work, you must also enable IP multicasting on your network 
routers. See the network services administration guide for more information about 
Service Location Protocol (SLP) and IP multicasting.
4 To allow Mac OS 8 and Mac OS 9 clients to find your file server using the Chooser, 
select “Enable browsing with AppleTalk.”
For Chooser browsing to work, AppleTalk must be enabled on both the client computer 
and the server. Clients can then see the server in the Chooser, but will need to connect 
using TCP/IP.
5 If you have Mac OS 8 and Mac OS 9 clients with special language needs, choose the 
appropriate character set from the “Encoding for older clients” pop-up menu. 
When Mac OS 9 and earlier clients are connected, the server converts file names from 
the system’s UTF-8 to the chosen set. This has no effect on Mac OS X client users.
6 In the Logon Greeting field, type the message you want users to see when they 
connect.
Note:  The message does not appear when a user logs in to his or her home directory.
7 To prevent users from seeing the greeting repeatedly, select “Do not send same 
greeting twice to the same user.”
8 Click Save.
From the Command Line
You can also change the AFP service settings using the serveradmin command in 
Terminal or by modifying the AFP preferences file. For more information, see the file 
services chapter of the command-line administration guide.
LL2346.Book  Page 40  Friday, August 22, 2003  2:38 PM
Chapter 3    AFP Service
41
Changing Access Settings
The Access pane of AFP Settings in Server Admin lets you control client connections 
and guest access.
To configure AFP service Access settings:
1 Open Server Admin and select AFP in the Computers & Services list.
2 Click Settings, then click Access. 
3 Choose the authentication method you want to use:  Standard, Kerberos, or Any 
Method.
4 To allow unregistered users to access AFP share points, select “Enable Guest access.”
Guest access is a convenient way to provide occasional users with access to files and 
other items, but for better security, do not select this option.
Note:  After you allow guest access for Apple file service in general, you can still 
selectively enable or disable guest access for individual share points. 
5 To allow clients to connect using secure AFP (using SSH), select “Enable secure 
connections.”
6 To allow an administrator to log in using a user’s name with an administrator password 
(and thereby experience the AFP service as the user would), select “Enable 
administrator to masquerade as any registered user.”
7 To restrict the number of simultaneous client connections, click next to the number 
field for clients or guests and type a number.
The maximum number of simultaneous users is limited by the type of license you have. 
For example, if you have a 10-user license, then a maximum of 10 users can connect at 
one time. 
The maximum number of guests cannot exceed the maximum number of total client 
connections allowed.
8 Click Save.
From the Command Line
You can also change the AFP access settings using the serveradmin command in 
Terminal or by modifying the AFP preferences file. For more information, see the file 
services chapter of the command-line administration guide.
LL2346.Book  Page 41  Friday, August 22, 2003  2:38 PM
42
Chapter 3    AFP Service
Changing Logging Settings
You use the Logging pane of the Apple File Service settings in Server Admin to 
configure and manage service logs. 
To configure Apple file service Logging settings:
1 Open Server Admin and select AFP in the Computers & Services list.
2 Click Settings, then click Logging.
3 To keep a record of users who connect to the server using AFP, select “Enable Access 
log.”
4 To periodically close and save the active log and open a new one, select “Archive every 
__ days” and type the number of days after which the log is archived.
5 Select the events that you want Apple file service to log. 
An entry is added to the log each time a user performs one of the actions you select.
Consider available disk space when you choose the number of events to log. The more 
events you choose, the larger the log file. 
6 To specify how often the error log file contents are saved to an archive, select “Error 
Log:  Archive every __ days” and type the number of days. 
7 Click Save.
The server closes the active log at the end of each archive period, renames it to include 
the current date, and then opens a new log file. 
You can keep the archived logs for your records or delete them to free disk space when 
they’re no longer needed. The default setting is 7 days.
Log files are stored in /Library/Logs/AppleFileService. You can use the log rolling scripts 
supplied with Mac OS X Server to reclaim disk space used by log files.
From the Command Line
You can also change the AFP service logging settings using the serveradmin 
command in Terminal or by modifying the AFP preferences file. For more information, 
see the file services chapter of the command-line administration guide.
LL2346.Book  Page 42  Friday, August 22, 2003  2:38 PM
Chapter 3    AFP Service
43
Changing Idle User Settings
You use the Idle Users pane of Apple File Service settings to specify how your server 
handles idle users. An idle user is someone who is connected to the server but whose 
connection has been inactive a predefined period of time.
If a client is idle or asleep for longer than the specified idle time, open files are closed, 
they are disconnected, and any unsaved work is lost.
To configure idle user settings:
1 Open Server Admin and select AFP in the Computers & Services list.
2 Click Settings (near the bottom of the window), then click Idle Users. 
3 To allow client computers to reconnect after sleeping for a certain time, select “Allow 
clients to sleep __ hour(s)—will not show as idle” and type the number of hours clients 
can sleep and still automatically reconnect to the server.
Although the server disconnects sleeping clients, their sessions are maintained for the 
specified period. If they resume work within that time, they are reconnected with no 
apparent interruption. 
4 To specify the idle time limit, select “Disconnect idle users after __ minutes” and type 
the number of minutes after which an idle computer should be disconnected. 
A sleeping Mac OS X version 10.2 (and later) client will be able to resume work on open 
files within the limits of the “Allow clients to sleep” setting. 
5 To prevent particular types of users from being disconnected, select them under 
“Except.”
6 In the “Disconnect Message” field, type the message you want users to see when they 
are disconnected. 
If you don’t type a message, a default message appears stating that the user has been 
disconnected because the connection has been idle for a period of time.
7 Click Save.
From the Command Line
You can also change the AFP service idle user settings using the serveradmin 
command in Terminal or by modifying the AFP preferences file. For more information, 
see the file services chapter of the command-line administration guide.
LL2346.Book  Page 43  Friday, August 22, 2003  2:38 PM
44
Chapter 3    AFP Service
Starting AFP Service
You start the AFP service to make AFP share points available to your client users.
To start Apple file service:
1 Open Server Admin and select AFP in the Computers & Services list.
2 Click Start Service (near the top of the window).
The service will run until you stop it and will restart automatically if your server is 
restarted for any reason.
From the Command Line
You can also start the AFP service using the serveradmin command in Terminal. For 
more information, see the file services chapter of the command-line administration 
guide.
Managing AFP Service
This section tells you how to perform day-to-day management tasks for AFP service 
once you have it up and running.
Checking Service Status
You can use Server Admin to check the status of AFP service.
To view AFP service status:
1 Open Server Admin and select AFP in the Computers & Services list. 
2 Click Overview (near the bottom of the window) to see whether the service is running, 
when it started, its throughput and number of connections, and whether guest access 
is enabled.
3 Click Logs to review the access and error logs.
Use the Show pop-up menu to choose which log to view.
4 Click Connections to see a list of connected users.
The list includes the user name, type of connection, user’s IP address or domain name, 
duration of connection, and the time since the last data transfer (idle time).
5 Click Graphs to see graphs of connected users or throughput.
Use the pop-up menu to choose which graph to view. Adjust the time scale using the 
slider at the bottom of the pane.
From the Command Line
You can also check the status of the AFP service process using the ps or top 
commands in Terminal, or look at the log files in /Library/Logs/AppleFileService using 
the cat or tail command. For more information, see the file services chapter of the 
command-line administration guide.
LL2346.Book  Page 44  Friday, August 22, 2003  2:38 PM
Chapter 3    AFP Service
45
Viewing Service Logs
You use Server Status to view the error and access logs for AFP service (if you have 
enabled them).
To view logs:
1 Open Server Admin and select AFP in the Computers & Services list.
2 Click Logs and use the Show pop-up menu to choose between the access and error 
logs.
To enable logging, click Settings (near the bottom of the window), then click Logging.
From the Command Line
You can also view the AFP service logs in /Library/Logs/AppleFileService using the cat 
or tail commands in Terminal. For more information, see the file services chapter of 
the command-line administration guide.
Stopping Apple File Service
Important:  When you stop AFP service, connected users may lose unsaved changes in 
open files.
To stop Apple file service after warning users:
1 Open Server Admin and select AFP in the Computers & Services list.
2 Click Connections (near the bottom of the window), then click Stop.
3 Type the length of time the server will wait before stopping service.
4 Type a message in the Additional Message field if you want users to know why they 
must disconnect. Otherwise, a default message is sent indicating that the server will 
shut down in the specified number of minutes.
5 Click Send.
From the Command Line
You can also stop the AFP service immediately using the serveradmin command in 
Terminal. For more information, see the file services chapter of the command-line 
administration guide.
LL2346.Book  Page 45  Friday, August 22, 2003  2:38 PM
46
Chapter 3    AFP Service
Enabling NSL and Rendezvous Browsing
You can register the service with Network Service Locator (NSL) and Rendezvous to 
allow users to find the server by browsing through available servers. Otherwise, users 
must type the server’s host name or IP address when connecting.
To register with NSL and Rendezvous:
1 Open Server Admin and select AFP in the Computers & Services list.
2 Click General, select “Enable Rendezvous registration,” and click Save.
AFP share points use the Rendezvous registration type afpserver.
To take advantage of NSL registration, you must also enable and configure Service 
Location Protocol (SLP) service on your network router.
From the Command Line
You can also set the AFP service to register with NSL and Rendezvous using the 
serveradmin command in Terminal. For more information, see the file services chapter 
of the command-line administration guide.
Enabling AppleTalk Browsing
If you enable browsing with AppleTalk, Mac OS 8 and 9 users can see your servers and 
other network resources using the Chooser.
Important:  AppleTalk must be enabled both on the user’s computer and on the server. 
On the server, you can use the Network pane of System Preferences.
To enable browsing via AppleTalk:
1 Open Server Admin and select AFP in the Computers & Services list.
2 Click General and select “Enable browsing with AppleTalk.”
3 Click Save.
From the Command Line
You can also set the AFP service to enable AppleTalk browsing using the serveradmin 
command in Terminal. For more information, see the file services chapter of the 
command-line administration guide.
LL2346.Book  Page 46  Friday, August 22, 2003  2:38 PM
Chapter 3    AFP Service
47
Limiting Connections
If your server provides a variety of services, you can prevent a flood of users from 
affecting the performance of those services by limiting the number of clients and 
guests who can connect at the same time.
To set the maximum number of connections:
1 Open Server Admin and select AFP in the Computers & Services list.
2 Click Settings, then click Access and look under “Maximum Connections.”
3 Click the button next to the number field following “Client Connections (Including 
Guests)” and type the maximum number of connections you want to allow.
4 Next to “Guest connections,” enable the number field and type the maximum number 
of guests you want to allow.
5 Click Save.
The guest connections limit is based on the client connections limit, and guest 
connections count against the total connection limit. For example, if you specify 
maximums of 400 client connections and 50 guest connections, and 50 guests are 
connected, that leaves 350 connections for registered users.
From the Command Line
You can also set the AFP service connections limit using the serveradmin command in 
Terminal. For more information, see the file services chapter of the command-line 
administration guide.
Keeping an Access Log
The access log can record when a user connects or disconnects, opens a file, or creates 
or deletes a file or folder.
To set up access logging:
1 Open Server Admin and select AFP in the Computers & Services list.
2 Click Settings (near the bottom of the window), then click Logging.
3 Select “Enable access log.”
4 Select the events you want to record. 
Consider your server’s disk size when choosing events to log. The more events you 
choose, the larger the log file. 
To view the log, open Server Admin, select AFP, and click Logs. Log files are stored in 
/Library/Logs/AppleFileService.
From the Command Line
You can also set the AFP service to record logs using the serveradmin command in 
Terminal. For more information, see the file services chapter of the command-line 
administration guide.
LL2346.Book  Page 47  Friday, August 22, 2003  2:38 PM
48
Chapter 3    AFP Service
Archiving AFP Service Logs