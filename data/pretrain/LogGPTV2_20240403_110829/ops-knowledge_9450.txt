### 问题描述

我正在使用 Nginx 作为多个 Web 服务器的代理。最近，一个客户要求我们使用客户端证书，并提供了三个不同的客户端证书，用于三台将连接到其中一个被代理服务器上的 Web 服务的机器。

由于之前从未配置过客户端 SSL 认证，我在相关文档中找到了 Nginx 的设置，并创建了一个站点配置文件（相关部分如下）：

```nginx
server {
    listen 443 ssl;
    server_name service.domain.com;

    ssl_certificate /etc/nginx/ssl/wildcard/server.crt;
    ssl_certificate_key /etc/nginx/ssl/wildcard/server.key;
    ssl_client_certificate /etc/nginx/ssl/client.certificates/client_package.cer;
    ssl_verify_client on;
}
```

我将这三个客户端证书以及一个由开发人员生成的自签名证书（该证书在开发期间需要访问该站点）合并到了上述提到的单个文件中。

然而，当客户尝试访问该站点时，却无法成功。为了测试配置是否正确，我从合并的证书文件中移除了开发人员的证书，并确认他确实无法访问该站点。当我再次将他的证书添加回合并文件后，开发人员能够正常访问该站点。

为了进一步排查问题，我启用了错误日志的调试级别。当客户尝试连接时，我收到了以下错误信息：

```
2015/08/13 11:57:41 [info] 27601#0: *1963 client sent no required SSL certificate while processing SPDY, client: 1x.xx.xx.xx, server: service.domain.com, request: "GET /test.cfm HTTP/1.1", host: "service.domain.com"
```

从上面的配置可以看出，我没有启用 SPDY（尽管我在其他站点上启用了）。客户也向我保证他们已经发送了客户端证书。由于这是我第一次进行此类配置，我希望确保在我告知客户他们的日志显示未发送客户端证书之前，我的配置是正确的。

关于提供的证书：所有三个证书都是由同一个公共证书颁发机构签署的。不过，我没有完整的证书链。根据我找到的一些在线指南，建议包含根 CA 证书，但这些指南通常针对自签名证书，而这些证书并不是自签名的。因此我不确定这是否适用。

此外，我还想澄清一点，我并不打算将客户端证书传递给被代理的服务器。

Nginx 版本：`nginx/1.8.0`  
OpenSSL 版本：`OpenSSL 1.0.1k 8 Jan 2015`

如果需要更多信息，请告诉我。

### 解决方案

您的配置实际上是正确的。但是，请确保不要将实际的客户端证书放入 `client_package.cer` 文件中。该文件应该只包含受信任的 CA 证书，并且应该是完整的证书链。您应该向客户请求所有的根和中间证书，如果他们还没有提供的话。

还有一些与默认服务器设置相关的注意事项，请参考以下内容并确保它们不会影响您：

1. **CA 证书文件**：`ssl_client_certificate` 指令应指向包含受信任的 CA 证书的文件。这个文件应该包含完整的证书链，包括根 CA 和中间 CA 证书。请确保您已从客户那里获取了这些证书。
   
2. **客户端证书验证**：确保客户端确实在其浏览器或应用程序中正确配置了客户端证书。有时，客户端可能没有正确安装或选择了正确的证书。

3. **SPDY 相关问题**：虽然您提到没有启用 SPDY，但日志中的错误信息提到了 SPDY。请检查您的 Nginx 配置文件，确保没有意外启用 SPDY。如果您不需要 SPDY，可以将其完全禁用以避免混淆。

4. **日志级别**：您可以将日志级别调整为更详细的级别，以便更好地了解问题所在。例如，将 `error_log` 设置为 `debug` 级别可以帮助您捕获更多详细信息。

5. **客户端配置**：请确保客户端在访问时正确配置了他们的浏览器或应用程序，以发送客户端证书。有时候，客户端可能需要手动选择要使用的证书。

通过以上步骤，您可以进一步排查和解决这个问题。如果问题仍然存在，请提供更多详细信息以便进一步分析。