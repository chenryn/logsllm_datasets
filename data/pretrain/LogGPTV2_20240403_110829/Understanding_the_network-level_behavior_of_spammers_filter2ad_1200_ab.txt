of the username for which the mail was destined and (2) gather
network-level properties about the mail relay from which spam is
received. In particular, the mail server collects the following infor-
mation about the mail relay when the spam is received:
• the IP address of the relay that established the SMTP con-
nection to the sinkhole
• a traceroute to that IP address, to help us estimate the network
location of the mail relay
• a passive “p0f” TCP ﬁngerprint, based on properties of the
TCP stack, to allow us to determine the operating system of
the mail relay
• the result of DNS blacklist (DNSBL) lookups for that mail
relay at eight different DNSBLs.
Note that, unlike many features of the SMTP header, these features
are not easily forged.
3.2 Legitimate Email Traces
One of the motivations for our study was to determine whether
the network-level characteristics of spam differ markedly from
those of legitimate email. To perform this comparison, we obtained
a corpus of mail logs from a large email provider that runs a Post-
ﬁx mail server. Because this provider manages millions of mail-
boxes, it performs extensive spam ﬁltering at its incoming SMTP
servers. Accordingly, the logs for this mail server record, for each
SMTP connection attempt, the time at which the connection at-
tempt was made, the IP address of the connecting host, whether the
mail was accepted or rejected, and, if the email was rejected, the
reason for rejection. Using these logs, we can estimate the network-
level properties of email that this domain deems to be legitimate.
We performed our analysis over approximately 700,000 pieces of
legitimate mail, as received at this provider’s mail server on June
13, 2006. Although the corpus of legitimate mail is from a different
domain than our sinkhole, both the spam sinkhole and the domain
for legitimate email constitute large, domain-wide data sources for
spam and legitimate mail, respectively, and are representative sam-
ples of spam and legitimate email that could be expected at any
Internet domain.
3.3 Botnet Command and Control Data
To identify a set of hosts that are sending email from botnets,
we used a trace of hosts infected by the W32/Bobax (“Bobax”)
worm from April 28-29, 2005. This trace was captured by hijack-
ing the authoritative DNS server for the domain running the com-
mand and control of the botnet and redirecting it to a machine at
a large campus network. This method was only possible because
(1) the Bobax drones contacted a centralized controller using a do-
main name, and (2) the researchers who obtained the trace were
able to obtain the trust of the network operators hosting the author-
itative DNS for that domain name. This technique directs control of
the botnet to the honeypot, which effectively disables it for spam-
ming for this period. On the upside, because all Bobax drones now
attempt to contact our command-and-control sinkhole rather than
the intended command-and-control host, we can collect a packet
trace to determine the members of the botnet.
To obtain a sample of spamming behavior from known botnets,
we correlate Bobax botnet membership from the 1.5-day trace of
Bobax drones with the IP addresses from which we receive spam in
the sinkhole trace. This technique, of course, is not perfect: over the
course of our spam trace, hosts may be patched. Although we can-
not precisely determine the extent to which the transience of bots
affects our analysis, previous work suggests that, even for highly
publicized worms, the rate at which vulnerable hosts are patched
is slow enough to expect that many of these infected hosts remain
unpatched [19]. We also acknowledge another shortcoming of our
approach: if hosts use dynamic addressing, different hosts (some of
which may be Bobax-infected and some of which may not be) may
use one of the IP addresses observed in the Bobax trace. However,
we believe that the resulting inaccuracies are small: We observe
a signiﬁcantly higher percentage of Windows hosts in the subset
of spam messages sent by IP addresses in our Bobax trace than in
the complete spam dataset, which indirectly suggests that the hosts
with IP addresses from the Bobax trace were indeed part of a spam-
ming botnet when they spammed our sinkhole.
3.4 BGP Routing Measurements
In this paper, we study whether an IP address of the mail relay
from which we receive spam is reachable and how long it remains
reachable. We are particularly interested in cases where a route for
an IP address is reachable for only a short period of time, coinciding
with time at which spam was sent. To measure network-layer reach-
ability from the network where spam was received, we co-located
a “BGP monitor” in the same network as our spam sinkhole, sim-
ilar to that in our previous work [7]. The monitor receives BGP
updates from the border router, and our analysis includes a BGP
update stream that overlaps with our spam trace. Since the moni-
tor has an internal BGP session to the network’s border router, it
will see only those BGP updates that cause a change in the border
router’s choice of best route to a preﬁx. Despite not observing all
BGP updates, the monitor receives enough information to allow us
to study the properties of short-lived BGP route announcements:
the monitor will have no route to the preﬁx at all if the preﬁx is
unreachable.
4. Network(cid:173)level Characteristics of Spammers
In this section, we study some ﬁrst-order network-level char-
acteristics of spam sources. We survey the portions of IP address
space from which our sinkhole received spam and the ASes that
sent spam to the sinkhole. We also observe the persistence of these
characteristics over time. To determine whether these network level
characteristics could be suitable for ﬁltering spam, we compare the
network-level characteristics of spam to the same characteristics
for legitimate email, as received at a large domain that manages
approximately 40 million mailboxes.
We ﬁnd that the distribution of spam across IP address space is
(1) nearly identical to the legitimate mail distributions (with a few
exceptions), and (2) quite persistent over time. Still, the distribu-
tion of spam senders across IP address space is far from uniform,
and spam arrival by IP address range is much more pronounced,
persistent, and concentrated than similar characteristics by IP ad-
dress. Additionally, we ﬁnd that a large fraction of spam is received
from just a handful of ASes: nearly 12% of all received spam origi-
nates from mail relays in just two ASes (from Korea and China, re-
spectively), and the top 20 ASes are responsible for sending nearly
37% of all spam. This distribution (as well as the main perpetrators)
is also persistent over time. This heavily skewed distribution sug-
gests that spam ﬁltering efforts might better focus on identifying
high-volume, persistent groups of spammers (e.g., by AS number),
rather than on blacklisting individual IP addresses, many of which
are transient.
4.1 Distribution Across Networks
To determine the address space from which spam was arriving
(“prevalence”) and whether the distribution across IP addresses
changes over time (“persistence”), we tabulated the spam in our
trace by IP address space. We ﬁnd that spam arrivals across IP space
are far from uniform.
Finding 4.1 (Distribution across IP address space) The major-
ity of spam is sent from a relatively small fraction of IP address
space.
Figure 2 shows the number of spam email messages received
over the course of the entire trace, as a function of IP address space.
Several ranges of IP address space originate large amount of email
trafﬁc (both spam and legitimate), including space allocated to ca-
ble modem providers (e.g., 24.*) and the address space allocated
to the Asia Paciﬁc Network Information Center (APNIC) regional
Internet registry (e.g., 61.*). Although most IP address ranges that
originate a signiﬁcant amount of spam also originate a lot of legit-
imate mail trafﬁc, a few IP address ranges have signiﬁcantly more
spam than legitimate mail (e.g., 80.*–90.*), and vice versa (e.g.,
60.*–70.*). This characteristic suggests that it may be possible to
use IP address ranges to distinguish spam from legitimate email.
We repeated the analysis of the network-level characteristics of
spam per day across months, per month across years, and so forth.
We also compared the distribution of spam collected at our sink-
hole to the distribution of rejected SMTP connections at the domain
where we performed our analysis of legitimate email and found
F
D
C
 1
 0.8
 0.6
 0.4
 0.2
 0
0
0
.
.
0
0
.
Legitimate email
Spam
Spamming IPs
0
0
.
.
.
0
0
3
0
0
.
.
.
0
0
6
0
0
.
.
.
0
0
9
0
0
.
.
.
0
0
2
1
0
0
.
.
.
0
0
5
1
0
0
.
.
.
0
0
8
1
0
0
.
.
.
0
0
1
2
0
0
.
.
.
0
0
4
2
IP Space
Figure 2: Fraction of spam email messages and comparison with legit-
imate email received (as a function of IP address space); also, fraction
of client IP addresses that sent spam, binned by /24.
s
t
n
e
i
l
c
f
o
n
o
i
t
c
a
r
F
 1
 0.9
 0.8
 0.7
 0.6
 0.5
 0.4
 0.3
 0.2
 0.1
 0
 1
 10
 100
 1000
 10000
 100000
Number of Appearances
Figure 3: The number of distinct times that each client IP sent mail to
our sinkhole (regardless of the number emails sent in each batch).
that the distribution of these connections across IP address space
is similar to that shown in Figure 2. All of these distributions have
remained roughly constant over time (i.e., the results look similar
to those shown in Figure 2).
In contrast, individual IP addresses
are far more transient. Figure 3 shows that even though a few IP
addresses sent more than 10,000 emails, about 85% of client IP ad-
dresses sent less than 10 emails to the sinkhole, indicating that tar-
geting an individual IP address might not help mitigate spam with-
out sharing information across domains. This ﬁnding has an impor-
tant implication for spam ﬁlter design: Though the individual IP ad-
dresses from which spam is received changes from day-to-day, the
fact that spam continually comes from the same IP address space
suggests that incorporating these more persistent features may be
more effective, particularly in portions of the IP address space that
send either mostly spam or mostly legitimate email.
In many cases, IP address ranges are not adequate for distin-
guishing spam from legitimate email. To determine whether other
network-level properties, such as the AS from which the email was
sent, could serve as better classiﬁers, we examined the distribution
of spam across ASes and compared this feature to the distribution
of legitimate email across ASes.
Finding 4.2 (Distribution across ASes) More than 10% of spam
received at our sinkhole originated from mail relays in two ASes,
AS Number
766
4134
1239
4837
9318
32311
5617
6478
19262
8075
7132
6517
31797
12322
3356
22909
8151
3320
7018
4814
China Telecom
Sprint
China Network Communications
# Spam AS Name
580559 Korean Internet Exchange
560765
437660
236434
225830 Hanaro Telecom
JKS Media, LLC
198185
181270
Polish Telecom
152671 AT&T WorldNet Services
142237 Verizon Global Networks
107056 Microsoft
SBC Internet Services
99585
94600 Yipes Communications, Inc.
89698 GalaxyVisions
87340
87042
86150
81721 UniNet S.A. de C.V.
79987 Deutsche Telekom AG
74320 AT&T WorldNet Services
74266
PROXAD AS for Proxad ISP
Level 3 Communications, LLC
Comcast Cable Corporation
China Telecom
Primary Country
Korea
China
United States
China
Japan
United States
Poland
United States
United States
United States
United States
United States
United States
France
United States
United States
Mexico
Germany
United States
China
Table 1: Amount of spam received from mail relays in the top 20 ASes.
11 of the top 20 networks from which we received spam are primarily
based in the United States.
AS Number
15169
5731
26101
3561
4355
8560
8075
14779
6541
14780
# Email
AS Name
Primary Country
49500 Google Inc.
United States
38238 AT&T WorldNet Services United States
30406 Yahoo
United States
United States
Savvis