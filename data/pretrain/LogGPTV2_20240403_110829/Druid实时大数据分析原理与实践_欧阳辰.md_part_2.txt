构设计、设计理念、安装配置、集群管理和监控，书中还介绍了一些高级特性和核心源码的
快速处理大规模的数据，并能够实现快速查询和分析。本书让读者能够深入了解Druid的架
为分析而生的，主要应用于大数据实时查询和分析的高容错、高性能开源分布式系统，旨在
分布式存储和查询系统都做了对比。想要系统掌握Druid技术，推荐阅读本书。
非常适用。本书既讲解了Druid技术本身，也讲解了多维数据分析相关的知识，并对业内的
是一本非常难得的OLAP的实时分析系统经典书籍。
导读，最后深人分析了Druid的最佳实践。本书采用由浅入深、循序渐进的方式介绍Druid，
支撑。而Druid的出现，正好比较完美地满足了这四点，特别是对于维度变换不频繁的场景，
推荐语
Druid是一个分布式的支持实时分析的数据存储系统（DataStore），Druid设计之初就是
我用“大、全、细、时”四个字来总结大数据，传统数据库在这种数据特性下根本无法
AdMaster（精硕科技）技术副总裁
神策数据公司创始人&CEO
卢亿雷
桑文锋
xii
---
## Page 15
也有几分相似。Druid被设计成支持PB级别的数据量，现实中有数百TB级别的数据应用实
很多设计思想来源于Google的秘密分析武器PowerDrill，在功能上，和Apache开源的 Dril
本、高性能、高可靠性的解决方案，整个系统支持水平扩展，管理方便。实际上，Druid的
是一个支持在大型数据集上进行实时查询而设计的开源数据分析和存储系统，提供了低成
种SQL和NoSQL方案后，最后决定自行设计且创建了Druid，该项目于2013年开源。Druid
数据分析问题。
量的实时分析，Druid就是在这种背景下脱颖而出的开源软件，帮助大家解决业务中的实时
现出一批基于新硬件架构设计的数据存储系统，常常统称为NoSQL，很多系统都高效地解决
时性要求高，对计算总成本敏感，主流关系型数据库开始有些力不从心。同时，数据行业涌
中小规模数据的复杂维度的分析查询。2005年以后，很多分析场景的数据量大大增加，对实
因是为了保证数据索引的高效性和查询性能。
在亚秒级。在数据多样性方面，Druid还是有些局限性的，它只支持强类型的数据结构，原
松应对每秒数万的流式实时事件，并且支持水平扩展。Druid的大多数据查询的响应时间也
践中，不少公司都有几百TB数据量的成功应用。实时性是Druid的一个内置特性，能够轻
面，一是大数据量；二是实时处理速度。Druid在设计上支持PB级别的数据处理能力，在实
据实时分析的众多场景！希望此书成为Druid宝剑秘籍，帮助读者利用Druid解决业务问题
前言
人人心，没有数据指标，就无法进行优化。很多数据软件系统都无法支持TB到PB级别数据
了Key-Value的存储和访问问题。
以产生商业和社会价值为目的。Druid在解决大数据问题时，能够比较好地处理其中两个方
2011年，MetaMarkets公司为了解决广告交易中海量实时数据的分析问题，在尝试了各
2010年后，基于大数据的分析场景越来多、越来越重要。大数据驱动的业务模式开始深
2005年以前，数据分析主要是以关系型数据库为基础，包括多维数据库（OLAP），支持
大数据，相比传统数据，具有四个典型特征，即形式多、体量大、速度快及价值高，最终
大数据的繁荣已经来到，Druid是数据分析的一把利剑，以开源之道，高效解决了大数
---
## Page 16
有理由相信Druid必将会在开源世界里拥有一个更为繁荣和光彩的明天！
几乎都是口口相传的推广，很多基于Druid的项目都是线上产品的一部分。正因如此，我们
起，包括灵活数据摄入、数据可视化、标准SQL查询等。目前Druid在中国发展非常迅速，
持更多的业务场景，不断支持各种主流开源生态，同时围绕着Druid的开源生态也在慢慢崛
方便系统管理。
望。附录A简要回答了一些常见的问题；附录B列出了各个服务模块的参数含义和建议值
的安全和监控；第10章，介绍几个公司的Druid最佳实践；第11章，Druid的生态介绍和展
性，包括正在积极完善的一些功能；第8章，核心代码的导读和分析；第9章，集群管理中
配置；第5章，Druid的数据摄人；第6章，查询详解；第7章，介绍Druid的一些高级特
比，包括一些时序数据库；第3章，Druid的设计理念和架构介绍；第4章，Druid的安装和
容组织如下：
绍了一些高级特性和核心源码的导读。本书采用由浅入深、循序渐进的方式介绍Druid，内
广泛应用于中国互联网公司中，例如腾讯、阿里、小米、优酷土豆、蓝海讯通等。
术交流。Druid项目初期，不少中国广告技术公司参与了Druid的技术评估。目前该技术也
开发工程师也包括阿里的宾莉金、谷歌的郭秉坤等。杨仿今曾多次来到中国进行Druid的技
数据分析。
使用Druid进行用户行为分析等项目。Druid帮助这些业务场景实现了高效数据存储和流式
都曾尝试或开始采用Druid支持实时数据分析。传统技术公司如Cisco,SKTelecom，也都在
数据分析、物联网的实时数据分析、互联网广告交易分析等领域。国内的主流广告技术公司
推动Druid的完善和改进。
可用架构，灵活支持部署的扩展；四是社区的力量，Druid开发和用户社区保持活跃，不断
有效的聚合或预计算；二是数据结构的优化，应用了Bitmap的压缩算法；三是可扩展的高
例，每天处理数十亿流式事件。Druid之所以保持高效，有这样几个原因：一是数据进行了
前言
Druid本身也在不断升级中，大约每3~6个月都有一次升级，每年都有一个大变化，支
第1章，介绍Druid的初级概念；第2章，对行业中不同的数据分析软件进行介绍和对
另外，Druid项目中也有不少中国元素，其创始人之一为中国工程师杨仿今，其他核心
Druid成功应用于众多互联网和非互联网公司中，特别是用户行为分析、个性化推荐的
本书的目的就是介绍Druid，让读者能够深入了解Druid的架构设计、使用管理，也介
本书创作组
XV
---
## Page 17
第1章
目录
1.6
1.5
1.4
3
1.1Druid是什么
1.9
1.9.1国内公司
Druid的应用场景
性能指标
系统的扩展性
1.6.2Druid的基本概念
1.6.1Druid的部署环境
Druid 的 Hello World
1.5.4社区支持力度大
1.5.3
1.5.2
1.5.1数据吞吐量大
Druid的技术特点
1.4.3实时分析（Realtime Analytics）
1.4.2水平扩展能力（Horizontal Scalability）
1.4.1快速查询（FastQuery）
Druid的三个设计原则
1.3.2失败总结
1.3.1MetaMarkets 简介
Druid 的产生
大数据分析和Druid
查询灵活且快
支持流式数据摄入
---
## Page 18
第3章
第2章
目录
3.5历史节点
3.4
3.3扩展系统
3.1Druid架构概览
参考资料
2.4小结
2.3
2.2
2.1
参考资料
3.2
1.10小结
3.5.1
3.4.2
3.4.1
实时节点
3.3.2
3.3.1
3.2.3
3.2.2
3.2.1
Druid架构设计思想
2.3.6
2.3.5
2.3.4
2.3.3
2.3.2
2.3.1
数据分析软件的分类
数据分析软件的发展
数据分析及相关概念
1.9.2国外公司
架构详解
高可用性与可扩展性
内存为王的查询之道
Segment数据文件的制造与传播
索引对树结构的选择
下载与加载扩展
主要的扩展
Druid总体架构
数据分析云服务
SQL on Hadoop/Spark
开源分析数据库
开源分布式计算平台
时序数据库
商业软件
5
5
1313
xvii
6
6
币9
9
35
C
---
## Page 19
第4章
xvili
4.2
4.1
3.9
3.8
4.4
4.3
3.7
3.6
查询节点
4.4.1基础依赖配置
4.2.2
4.2.1
简单示例
4.1.3
4.1.2
4.1.1
安装准备
小结
3.8.4
3.8.3
3.8.2
3.8.1
索引服务
3.7.4
3.7.3
3.7.2
3.7.1
协调节点
3.6.3
3.6.2
3.6.1
3.5.3
3.5.2
4.4.3
4.4.2
基本配置
规划与部署
数据导入与查询
服务运行
安装包简介
Druid外部依赖
主从结构的架构
高可用性
副本实现Segment的高可用性
高可用性
高可用性与可扩展性
查询节点配置调优
数据节点配置调优
任务
中间管理者与苦工
统治节
利用规则管理数据生命周期
集群数据负载均衡的主宰
缓存的使用
查询中枢点
层的分组功能
装环境
目录
9
9
98
9
25
1919
8
9
8
S
6
5
S
S
52
52
5
5
5
S
---
## Page 20
第6章
第5章
目录
6.1
5.6
5.5
5.4
5.3
5.2
5.1
4.6
4.5
查询过程
小结
4.5.1节点规划
集群节点配置示例
小结
5.5.4
5.5.3
5.5.2
5.5.1
数据摄取的其他重要知识
5.4.2
5.4.1
流式与批量数据摄取的结合
5.3.2
5.3.1
静态数据批量摄取
5.2.4
5.2.3
5.2.2
5.2.1
流式数据摄取
5.1.2
5.1.1
数据摄人的两种方式
4.5.3
4.5.2
解决时间窗口问题
Lambda架构
以Hadoop方式摄取
以索引服务方式摄取
索引服务任务相关管理接口
流式数据源
Master机器配置
高基数维度优化
索引服务之Tranquility
数据复制
数据分片
用户行为数据摄取案例
以Pull方式摄取
静态数据源
以Push方式摄取
Data机器配置
·····。
三
1
00
1
00
6
69
8
8
6
6
6
6
8
8
8
8
8
8
6
---
## Page 21
第7章