**海关信息系统**
**统一日志管理规范**
二○一七年七月
**目录**
1 前言 [3](#前言)
> 1.1 概述 [3](#概述)
>
> 1.2 公司日志管理现状 [3](#_Toc447029545)
>
> 1.3 统一日志管理目标 [5](#统一日志管理目标)
2 日志记录规范 [6](#日志记录规范)
> 2.1 主机设备日志 [7](#主机设备日志)
>
> 2.2 网络类设备日志 [9](#网络类设备日志)
>
> 2.3 安全类日志 [12](#安全类日志)
>
> 2.4 应用类日志 [19](#应用类日志)
>
> 2.5 终端类日志 [20](#终端类日志)
3 日志统一采集规范 [22](#日志统一采集规范)
4 日志分析规范 [23](#日志分析规范)
> 4.1 日志解析 [23](#日志解析)
>
> 4.2 日志挖掘 [26](#日志挖掘)
5 日志存储规范 [27](#日志存储规范)
> 5.1 存储原则 [27](#存储原则)
>
> 5.2 存储时间 [28](#存储时间)
>
> 5.3 存储格式 [29](#存储格式)
>
> 5.4 存储规范 [29](#存储规范)
6 日志使用规范 [30](#日志使用规范)
> 6.1 日志检索 [30](#日志检索)
>
> 6.2 日志数据可视化 [31](#日志数据可视化)
>
> 6.3 日志导出 [31](#日志导出)
>
> 6.4 对外接口 [32](#对外接口)
# 前言
## 概述
随着IT技术的发展，云计算、大数据、移动互联等应用日益广泛，海关信息化建设所面临的问题也越来越多。网络中的主机、服务器、网络设备、安全设备、数据库以及各种应用服务系统在运行过程中会产生大量的运行日志、安全日志和行为日志，工作人员面对数量如此巨大的信息，由于缺乏分析手段，无法及时准确定位网络故障和发现隐患，缺少一个全面统一的日志收集、分析、存储和消费提供的平台。
日志中心能够对全网范围内的主机、服务器、网络设备、数据库以及各种应用服务系统等产生的各类日志，进行规范采集，统一规范日志格式，统一持久化存储，统一策略制定，并进行细致分析，通过统一的控制台进行实时可视化的呈现。通过定义日志筛选规则和策略，帮助工作人员从海量日志数据中精确查找关键有用的事件数据，准确定位网络故障并提前识别安全威胁，保障网络安全。为明确角色职责，加强审单状态跟踪，问题的根源分析和解决，应用性能分析，满足安全管控、审计等要求特制定本规范。本规范的目标是：
-   实现自动的日志集中采集与存储。将各专业系统的系统日志、应用日志、操作访问日志汇聚到一起，进行分类、压缩存储。
-   实现自动的日志集中分析。通过定义规则，对日志进行横向和纵向关联，进行自动化分析，找出潜在安全问题。
-   实现自动的日志集中审计。
-   实现分析结果自动触发响应告警的机制，更快、更早地发现问题。
本规范所提到的日志以文本格式展现。是海关业务系统在审单流程中，应用和服务输出的运行信息，该数据的丢失或者损坏不会对业务运行产生影响。
开发团队和业务团队，可以通过日志记录的关键信息来获取应用、交易和业务的状态和路径，维护业务系统的正常和稳定的运行，保证用户良好的用户体验
。
## 统一日志管理目标
1.  智能、规范化的收集最全面的日志数据：不仅完成对主机、网络安全设备、中间件、数据库等基本设备的日志收集，而且对信息系统日志、安全审计日志、业务日志等进行全面收集。
2.   实现日志准实时搜索：实现日志实时收集和处理，日志从产生到搜索分析出结果只有几秒的延时。
3.  统一标准化日志记录格式：针对不同类型日志制定其记录规范，统一的日志记录格式有利于日志的快速解析和对日志的快速索引查询。
4.  实现日志的统一存储：日志存留时间需满足相关政策法规中要求的保存的特定日志的类型和存储时间。规范日志的存储格式，具有企业级分布式文件系统，具有高扩展性。
5.  安全事件快速定位、响应与追责：在收集到的各类日志的基础上，对安全事件进行快速响应，定位问题原因，追踪事件源头，并采取相应行动进行处理。
6.  实现日志使用的标准化：对收集的日志统一格式、统一存储后，提供对外的统一使用接口，可实现在线日志的快速搜索，日志内容的文本导出，以及告警和日志内容向第三方平台的统一、规范化推送。
7.  对信息系统运行、使用情况进行分析：通过对中间件、信息系统等日志的关联分析和数据挖掘获取信息系统运行状、用户使用情况等信息。
8.  利用大数据、机器学习技术进行异常行为检测：异常行为分析技术通过对流经设备的流量进行连续、实时监控来分析流量信息，利用统计分析、关联分析和机器学习等多种技术手段来检测流量和用户或应用行为中的异常模式，以发现异常行为。通过机器学习提高运维效率、为规则设定提供依据。
9.  提高安全分析效率：告警事件自动归类，安全事件回溯检索平台。
10. 对未知威胁和异常行为检测发现：自动识别未知的安全威胁和安全行为，变被动为主动。
# 日志记录规范
日志采用文档结构存储，以标准的JSON格式进行日志的扩展。采用syslog、SNMP、端口镜像、第三方、agent等发送方式。
日志是日志中心处理的最小数据单元。日志中心采用半结构数据模式定义一条日志，具体数据模型如下：
**日志文件命名规范**
日志分为两类：错误信息日志、一般输出信息日志。日志文件命名规则如下：
• 错误信息日志文件名为：
ComponentCode.SubComponentCode.Node.err.log.yyyy-mm-dd.n；
• 一般输出信息日志文件名为：
ComponentCode.SubComponentCode.Node.out.log.yyyy-mm-dd.n。
*字段说明：*
•
ComponentCode是组件编码或简称，必选项，应符合海关信息系统组件管理规范，组件重启或者时间推移不会造成该编码的变化或者漂移。
•
SubComponentCode是组件二级分类，为可选项。由于各个应用组件存在需求差异，具体内容各个应用组件自行决定。如可以用机构、子组件名称、服务简称或子系统等
。如果指定，应符合海关信息系统组件管理规范，组件重启或者时间推移不会造成该编码的变化或者漂移。
•
Node是应用组件运行时所在的节点信息，如主机编号、虚机编号，服务逻辑节点编号等，这是一个必选项，用于区分分布式系统中不同主机或虚机节点、不同服务产生的日志。这里没有进一步细分进程号和线程号，避免过多文件的生成和定位问题的不便。对于高并发的应用系统中，避免多进程多线程高并发写入同一个文件，引起性能下降，应有应有程序保证。
•
yyyy-mm-dd（或者yyyymmdd）是日期，可选项，用于区分日志内容产生的时间。不同日期产生的日志文件存放在不同的日志文件中。
•
n是日志文件序号。这是一个可选项，当日志文件内容在一天内超过规定的日志文件大小上限时使用，属于日志的回转配置。
• 字段之间用"."进行分割，字段内部可以使用"\_"进行分割
主题（Topic）：用户自定义字段，用以标记一批日志（例如：访问日志根据不同的站点进行标记）。日志主题命名规范如下：
  ------------------------- -----------------------------------------------------------------------
  **主题标识**              **主题标识说明**
  Win_weblogic              Windows环境下weblogic的http访问类型日志
  Win_weblogic_Server       Windows环境下weblogic服务器日志
  Win_secure                Windows操作系统安全类日志
  Win_system                Windows操作系统系统日志
  Win_app                   Windows操作系统应用类日志
  Linux\_ weblogic          Linux环境下weblogic的http访问类型日志
  Linux\_ weblogic_Server   Linux环境下weblogic服务器日志
  Linux_message             Linux操作系统标准错误日志，非内核产生的引导信息；各子系统产生的信息。
  Linux_secure              Linux操作系统用认证相关信息，例如用户登录，修改用户信息等操作记录。
  Linux_cron                Linux操作系统记录cron和at服务日志信息
  Linux_mail                Linux操作系统记录邮件系统的日志信息
  Linux_boot                Linux操作系统记录系统服务的启动信息
  Linux\_ dmesg             Linux操作系统记录内核的硬件检测信息
  Switch                    交换机日志
  FireWall_h3c              H3c防火墙日志
  FireWall_dp               迪普防火墙日志
  Trend_stda                趋势设备日志
  Linux_tomcat              Linux下tomcat http访问日志
  Tap                       Tap设备日志
  win_tomcat                windows下tomcat http访问日志
  Linux_tomcat_Cata         Linux下tomcat 服务日志
  win_tomcat_Cata           windows下tomcat 服务日志
  Orcl_Access               Oracle数据库访问日志
  Orcl_opt                  Oracle数据库操作日志
  Mysql_Access              Mysql数据库访问日志
  Mysql_opt                 Mysql数据库操作日志
  Net_mirror                网络流量镜像日志
  Sys_BussinessName         业务系统日志，以sys_开头,后面跟业务系统名称
  Other                     未归类日志，新发现的未知日志类型
  ------------------------- -----------------------------------------------------------------------
时间（Time）：日志中保留字段，用以表示日志产生的时间（精度为秒，从1970-1-1
00:00:00
UTC计算起的秒数），一般由日志中的时间直接生成。日志格式统一规范为"yyyy-MM-dd
hh:mm:ss"形式。
内容（Content）：用以记录日志的具体内容。内容部分由一个或多个内容项组成，每一个内容项由Key、Value对组成。
来源（Source）：日志的来源地，例如产生该日志机器的IP地址。默认该字段为空。
对日志内容（Content）的进一步进行统一规范、格式化处理有利于日志的快速解析，因此我们分别制定了主机类、网络类、安全类、应用类的日志统一规范。
## 主机设备日志
1.  物理主机日志格式规范
  ---------- --------------------------------------------------------------
  **序号**   **记录项**
  1          事件标识
  2          事件产生时间
  3          主机名
  4          事件优先级
  5          事件严重级别
  6          事件内容
  7          事件导致结果
  8          事件源设备地址
  9          事件源设备类型
  10         事件文件名
  11         事件源地址
  12         事件源用户名称
  13         事件源主机名称
  14         事件归类1
  15         事件归类2
  16         产生事件进程名称
  17         应用管理日志-应用名称
  18         应用管理日志-安装位置
  19         应用管理日志-版本号
  20         应用管理日志-登录帐号
  21         应用管理日志-操作时间
  22         应用管理日志-操作类型
  23         用户登录日志-登录时间
  24         用户登录日志-登出时间
  25         用户登录日志-登录帐号
  26         用户登录日志-登录IP
  27         用户登录日志-登录认证方式
  28         用户登录日志-登录认证结果
  29         账号管理日志-登录账号
  30         账号管理日志-目的账号
  31         账号管理日志-操作时间
  32         账号管理日志-操作类型
  ---------- --------------------------------------------------------------
2.  虚拟类主机日志格式规范
  ---------- ----------------------------------------------------------------
  **序号**   **记录项**
  1          事件名标识
  2          事件产生时间
  3          主机名称
  4          事件优先级
  5          事件严重级别
  6          事件内容
  7          事件导致结果
  8          事件源设备地址
  9          事件源设备类型
  10         事件文件名
  11         事件源地址
  12         事件源用户名
  13         事件源主机名