t
t
A
1
2
3
4
5
6
7
8
9
10
1
2
3
4
5
6
7
8
9
10
10
8
6
4
2
0
s
n
o
i
t
c
e
n
n
o
c
f
o
.
o
n
e
g
a
r
e
v
A
1
0.8
0.6
0.4
0.2
0
e
t
a
r
s
s
e
c
c
u
s
k
c
a
t
t
A
1
2
3
4
5
6
7
8
9
10
1
2
3
4
5
6
7
8
9
10
10
8
6
4
2
0
s
n
o
i
t
c
e
n
n
o
c
f
o
.
o
n
e
g
a
r
e
v
A
1
2
3
4
5
6
7
8
9
10
Threshold 
Threshold 
Threshold 
(a) Victim location: London (AS16509)
(b) Victim location: Bangalore (AS14061)
(c) Victim location: Atlanta (AS47065)
Figure 13: Attack success rates and the average number of established connections of three victims.
No RAP, no tweak
Tweaks (T3, T4, T5)
Optimal RAP
Optimal RAP + Tweaks (T3, T4, T5)
7 Related Work
7.1 Security Research in Blockchain Net-
works
Security breaches in the P2P layer of blockchain networks of-
ten cause signiﬁcant damage to the entire blockchain systems
as the P2P layer is the fundamental underlying network of the
consensus and transaction layers.
Eclipse attacks and defenses. In recent years, several attacks
have shown that eclipsing the P2P networks of blockchain
systems is possible [4, 8, 27, 28, 38, 57]. Earlier eclipse at-
tacks [27] utilize small-size botnets and exploit speciﬁc vul-
nerabilities of the Bitcoin client software to partition one or
more nodes from the P2P networks. Similar attacks that ex-
ploit the implementation bugs of Ethereum have also been
presented [28, 38]. Most of these vulnerabilities have been
quickly ﬁxed by Bitcoin and Ethereum communities, render-
ing these attacks ineffective. More recent studies show that
a malicious AS can control all the connections of a targeted
Bitcoin node via launching a BGP hijacking attack [4]. As
a solution to this Bitcoin hijacking attack, a new Bitcoin re-
lay system, called SABRE [3], that is designed to be robust
against BGP hijacking attacks. There also exists an eclipse at-
tack that speciﬁcally targets Bitcoin nodes connecting via Tor
bridges by exploiting the anti-DoS mechanism in Bitcoin [8].
Relays and Bitcoin security. Although Bitcoin is designed
as a fully decentralized P2P network, a special type of peer
nodes, called relays, have been proposed for performance and
security purposes. Fast relay networks, such as Falcon [18]
and FIBRE [20], have been used to speed up the block data
propagation between a closed group members. SABRE [3]
is a special relay that guarantees BGP-hijacking-free peering.
One may be tempted to rely on such existing relays or even
introduce more relays to diversify his/her Bitcoin nodes’ con-
nectivity in the hope that it will mitigate the Erebus attacks.
However, it is a far-from-ideal approach to handling the Ere-
bus attacks. First, there still exist non-negligible chances that
some malicious transit ASes are on the paths to the relays.
Second, perhaps more importantly, the reliance on a small
number of relays for P2P operations makes the relay infras-
tructure effectively a centralized regulating authority. Relays
may be used as a temporary measure when no good coun-
termeasures to Erebus exist but they cannot be a long-term
1
0.8
0.6
0.4
0.2
e
t
a
r
s
s
e
c
c
u
s
k
c
a
t
t
A
0
    London
 (AS160509)
  Bangalore
 (AS14061)
   Atlanta
 (AS47065)
    All locations
 (averaged results)
Victim location
Figure 14: Attack success rate when three victims implement
RAP combined with some protocol tweaks.
Combing RAP and tweaks. Here, we attempt to combine
the optimal RAP defenses with some effective protocol tweak
combinations discussed in previous sections to show their in-
tegrated defense performance. Following the example above,
we implement the combination of the tweaks (T3, T4, T5)
along with RAP with the optimal τ values8 in all victim clients.
We show the success rates of the attacks against them and
highlight three victim examples (i.e., located in London, Ban-
galore, and Atlanta) in Figure 14. Figure 14 shows that com-
bining RAP and tweaks makes the most effective countermea-
sure against the Erebus attacks as the attack success rates drop
to 2–8% in three examples and only 3% on average.
6.3 Responsible Disclosure
We have disclosed our ﬁndings to the Bitcoin Core secu-
rity team in late December 2020. The Bitcoin Core de-
velopers acknowledged the effectiveness of the RAP ap-
proach and are seeking extensive discussions before its de-
ployment. Regarding the simple protocol tweaks, we learn
that the team has been implementing a slightly different IP-
to-ASN mapping for the tweak T1, see Appendix C for
more details. Also, the tweaks T2 and T3 are being ac-
tively implemented while T4 and T5 are in consideration
as of this writing. We will keep updating the status of these
countermeasures on our public project webpage at https:
//erebus-attack-countermeasures.github.io/.
8When combining RAP and tweak T3, the optimal τ threshold for RAP
should be adjusted accordingly to the increased number of connections.
1266    30th USENIX Security Symposium
USENIX Association
solution. In this paper, we focus on the solutions that do not
hurt the openness and decentralization of Bitcoin.
7.2 Routing Awareness in Tor
Our work is the ﬁrst to thoroughly evaluate the ideas of routing
awareness in blockchain systems. In fact, the idea of RAP
has been already investigated several times in Tor [1, 7, 17, 19,
32, 45, 53]. These Tor systems employ routing awareness by
using inter-domain route inference algorithms (e.g., Mao et
al.’s algorithm [37]) to estimate a common, suspicious AS that
appears on both connections from a client to a Tor entry node
and from a Tor exit node to a destination, similar to how we
implement RAP in Bitcoin. Juen et al. [32] also compare the
inferred AS paths of the Tor connections with the data-plane
paths and report an overall 80% difference between them.
These routing-aware mechanisms developed for Tor cannot
be directly used for Bitcoin because the semi-permissionless
nature of Tor network is fundamentally different from that of
Bitcoin, see more detailed discussion in Section 5.4.
8 Conclusion
Perhaps, we may have been building a house of cards when
we keep inventing new blockchain consensus ideas while rely-
ing on the P2P networks that are easy to eclipse. We attempt
to address one recent eclipse attack that exploits a powerful
network-Sybil capability, with the practicality of countermea-
sures as the top priority. Our critical evaluation shows that
one highly promising countermeasure, called routing-aware
peering (RAP), yields disappointing defense performance due
to its weakness. Yet, we conﬁrm that Bitcoin can be protected
from most Erebus attacks when these available countermea-
sures are carefully optimized and customized for each node.
We believe that our work helps us take a step towards highly
reliable blockchain P2P networking protocols.
Acknowledgments
We thank the anonymous reviewers of this paper and our
shepherd Yixin Sun for their helpful feedback. We also thank
Inho Choi for the useful comments on early versions of this
paper and help in traceroute experiments. This work uses
measurements from the PEERING testbed, which cannot be
done without support from Italo Cunha and other team mem-
bers. We also thank Gleb Naumenko and other Bitcoin Core
developers for the discussion on RAP and protocol tweaks pre-
sented in this paper. This work was supported by Institute for
Information & communications Technology Planning & Eval-
uation (IITP) grant funded by the Korea government (MSIT)
(No.2019-0-01343, Regional strategic industry convergence
security core talent training business) and the CRYSTAL Cen-
tre at National University of Singapore.
References
[1] Masoud Akhoondi, Curtis Yu, and Harsha V Madhyastha.
LASTor: A low-latency AS-aware Tor client. In Proc. IEEE
S&P, 2012.
[2] Ehab Al-Shaer, Qi Duan, and Jafar Haadi Jafarian. Ran-
In Proc. Se-
dom host mutation for moving target defense.
cureComm, 2012.
[3] Maria Apostolaki, Gian Marti, Jan Müller, and Laurent Van-
bever. SABRE: Protecting Bitcoin against Routing Attacks.
In Proc. NDSS, 2019.
[4] Maria Apostolaki, Aviv Zohar, and Laurent Vanbever. Hijack-
In Proc.
ing Bitcoin: Routing attacks on cryptocurrencies.
IEEE S&P, 2017.
[5] asmap-rs.
https://github.com/rrybarczyk/asmap-rs,
2020.
[6] Erebus Attack. Bitcoin emulator, 2020. https://github.
com/Erebus-Attack/Bitcoin-Emulator.
[7] Armon Barton and Matthew Wright. DeNASA: Destination-
In
Naive AS-Awareness in Anonymous Communications.
Proc. PETS, 2016.
[8] Alex Biryukov and Ivan Pustogarov. Bitcoin over Tor isn’t a
good idea. In Proc. IEEE S&P, 2015.
[9] CAIDA. AS Rank: A ranking of the largest Autonomous
Systems (AS) in the Internet, 2020. https://asrank.caida.
org/.
[10] CAIDA. AS Relationships, 2020. http://www.caida.org/
data/as-relationships/.
[11] CAIDA. BGPStream, 2020. https://bgpstream.caida.
org/.
[12] CAIDA. Routeviews Preﬁx to AS mappings Dataset (pfx2as)
for IPv4 and IPv6, 2020. https://www.caida.org/data/
routing/routeviews-prefix2as.xml.
[13] Bitcoin Core.
Bitcoin Core 0.21.0, 2021.
https://
bitcoincore.org/en/releases/0.21.0/.
[14] Joan Antoni Donet Donet, Cristina Pérez-Sola, and Jordi
In Proc.
Herrera-Joancomartí. The bitcoin P2P network.
FC, 2014.
[15] John R Douceur. The Sybil attack. In Springer IPTPS, 2002.
[16] Zakir Durumeric, Eric Wustrow, and J Alex Halderman. ZMap:
Fast Internet-wide scanning and its security applications. In
Proc. USENIX Security, 2013.
[17] Matthew Edman and Paul Syverson. AS-awareness in Tor path
selection. In Proc. ACM CCS, 2009.
[18] Falcon. A Fast Bitcoin Backbone, 2016.
https://www.
falcon-net.org/.
[19] Nick Feamster and Roger Dingledine. Location diversity in
anonymity networks. In Proc. ACM WPES, 2004.
[20] FIBRE. Fast Internet Bitcoin Relay Engine, 2020. http:
//bitcoinfibre.org/.
[21] William Foxley. Latest Bitcoin Core Code Release Protects
Against Nation-State Attacks. CoinDesk, 2020.
USENIX Association
30th USENIX Security Symposium    1267
[22] Lixin Gao. On inferring autonomous system relationships in
[40] Satoshi Nakamoto. Bitcoin: A Peer-to-Peer Electronic Cash
the Internet. IEEE/ACM TON, 2001.
System, 2009.
[23] Phillipa Gill, Michael Schapira, and Sharon Goldberg. A
survey of interdomain routing policies. ACM SIGCOMM CCR,
2013.
[24] Jivika Govil, Jivesh Govil, Navkeerat Kaur, and Harkeerat
Kaur. An examination of IPv4 and IPv6 networks: Constraints
and various transition mechanisms. In Proc. IEEE Southeast-
Con, 2008.
[25] Ethan Heilman. Added test-before-evict discipline in Ad-
https://github.com/
drman, feeler connections, 2015.
bitcoin/bitcoin/pull/6355.
[26] Ethan Heilman. net: Feeler connections to increase online ad-
drs in the tried table, 2016. https://github.com/bitcoin/
bitcoin/pull/8282.
[27] Ethan Heilman, Alison Kendler, Aviv Zohar, and Sharon Gold-
berg. Eclipse Attacks on Bitcoin’s Peer-to-Peer Network. In
Proc. USENIX Security, 2015.
[28] Sebastian Henningsen, Daniel Teunis, Martin Florian, and
Björn Scheuermann. Eclipsing Ethereum Peers with False
Friends. In Proc. IEEE EuroS&PW, 2019.
[29] Muhammad Anas Imtiaz, David Starobinski, Ari Trachtenberg,
and Nabeel Younis. Churn in the Bitcoin Network: Characteri-
zation and impact. In Proc. ICBC, 2019.
[30] Jafar Haadi Jafarian, Ehab Al-Shaer, and Qi Duan. Openﬂow