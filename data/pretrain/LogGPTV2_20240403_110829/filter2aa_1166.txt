The BYOD PEAP Show
Mobile Devices Bare Auth
Josh Yavor
iSEC Partners
DEF CON XXI
August , 
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Introduction
Welcome
A Perfect Storm
1
1noaa.gov
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Introduction
Welcome
PEAP: Pwned Extensible Authentication Protocol
Joshua Wright & Brad Antoniewicz - ShmooCon 
“It’s amazing to me that lots of people seemed to have missed
thisissueinPEAPandotherEAPmethods, asit’sstillextremely
useful in most of the pen-tests I engage in.”
– Joshua Wright, May 1
Windows and OS X
FreeRADIUS-WPE
“PEAP and TTLS can be secure when deployed carefully”
1http://www.willhackforsushi.com/?page_id=37
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Introduction
Welcome
Bring Your Own Device
All the cool kids are doing it
Growth
%-% of companies
“Bring Your Own Deﬁnition”
EAP Types
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Introduction
Welcome
CloudCracker
Moxie Marlinspike, David Hulton, Marsh Ray - DEF CON XX
“Enterprises who are depending on the mutual authentication
properties of MS-CHAPv for connection to their WPA Radius
serversshouldimmediatelystartmigratingtosomethingelse.”
– Moxie Marlinspike, July , 2
Divide and conquer
 = % in  hours
2https://www.cloudcracker.com/blog/2012/07/29/cracking-ms-chap-v2/
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Introduction
Welcome
Take Aways
Spoiler Alert
Real-world deployments are messy
PEAP is unsafe for BYOD environments
Impact is enormous
Immediate corrective action required
No easy ﬁx
Users are in control
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Introduction
Welcome
Bottom Line
Defense
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Introduction
Welcome
Bottom Line
Oﬀense
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Introduction
Welcome
Some Disagree
“In a properly implemented wireless network, this MS-CHAPv
exploit is a non-issue. There is no need for Wi-Fi network ad-
ministrators to abandon PEAP. Period.”3
3revolutionwiﬁ.blogspot.com///is-wpa-security-broken-due-to-defcon.html
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Introduction
Welcome
Risk Characteristics
Lower Risk
Individual users (depends)
Smaller organizations
Static user base
Higher Risk
Internal network assets
Larger organizations
Transient user base
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Introduction
Welcome
Misconﬁguration is Everywhere
Be cruel to your school
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Introduction
Welcome
For Mobile Devices
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Introduction
Welcome
Even for Windows
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Introduction
Prerequisite Knowledge
PEAP 
Why is PEAP so popular?
EAP Type Support
iOS
Android
Windows Phone 
BlackBerry
PEAP
Yes
Yes
Yes
Yes
EAP-TLS
Yes
Yes
No
Yes
EAP-TTLS
Yes
Yes
No
Yes
EAP-FAST
Yes
No
No
Yes
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Introduction
Prerequisite Knowledge
Wireless Authentication Comparison
Access Control Granularity
Open
WPA
WPA Ent.
None
Group of users who know password
Individual user accounts
wiﬁ? ok!
getyourownwiﬁ
evalDoer / p
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Introduction
Prerequisite Knowledge
Wireless Authentication Comparison
Response to Credential Compromise
Open
WPA
WPA Ent.
N/A
Change password, update all devices
Modify single user account
wiﬁ? ok!
getyourownwiﬁ
Error: User account locked
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
WPA Ent. & .X
PEAP
Association to AP
.thisOneGoesTo
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
WPA Ent. & .X
PEAP
Outer Authentication
Thanks to Brad & Joshua
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
WPA Ent. & .X
PEAP
Inner Authentication with MSCHAPv
Thanks to Moxie
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Mobile Platforms
Mobile Platforms
2
2ocio.osu.edu
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Mobile Platforms
Android
Android
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Mobile Platforms
Android
Android
EAP Types
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Mobile Platforms
Android
Android
PEAP Conﬁguration
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Mobile Platforms
Android
Android
CA Conﬁguration
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Mobile Platforms
Android
Android
Inner Authentication
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Mobile Platforms
iOS
iOS
3
3apple.com
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Mobile Platforms
iOS
iOS
PEAP Conﬁguration
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Mobile Platforms
iOS
iOS
CA Conﬁguration
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Mobile Platforms
iOS
iOS
Cert Details
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Mobile Platforms
BlackBerry
BlackBerry
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Mobile Platforms
BlackBerry
BlackBerry
EAP Types
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Mobile Platforms
BlackBerry
BlackBerry
PEAP Conﬁguration
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Mobile Platforms
BlackBerry
BlackBerry
CA Conﬁguration
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Mobile Platforms
Windows Phone
Windows Phone 
4
4microsoft.com
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Mobile Platforms
Windows Phone
Windows Phone 
PEAP Conﬁguration
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Mobile Platforms
Windows Phone
Windows Phone 
CA Conﬁguration
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Mobile Platforms
Windows Phone
Windows Phone 
Cert Details
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Attacking PEAP
Methodology
Single Network
Traditional attack
Story time:
- users, shared building
> , users, campus
Extra credit
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Attacking PEAP
Methodology
Multiple Networks
Curated Lists
Geographical, industry, other?
Story time:
Industry
Geographical
Extra credit
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Attacking PEAP
Methodology
All The Devices
Everything (almost)
Challenges
Story time
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Attacking PEAP
It’s Tool Time!
Pwning 
Single target
Multiple targets
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Attacking PEAP
It’s Tool Time!
Existing Tools
FreeRADIUS-WPE
hostapd & hostapd-wpe
DD-WRT & OpenWrt
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Attacking PEAP
It’s Tool Time!
The Goal
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Attacking PEAP
It’s Tool Time!
What’s Next?
*WRT scripts
*WRT integration
hostapd-python-script5
5github.com/nims/hostapd-python-script
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Attacking PEAP
It’s Tool Time!
Getting Fancy
Dynamic target selection
GPS (wigle.net?)
Single tool
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Solutions
How do we ﬁx this?
Hide yo’ kids, hide yo’ WiFi
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Solutions
How do we ﬁx this?
EAP-TLS
Better Mobile Device Management
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Solutions
PEAP vs EAP-TLS
Feature
PEAP
EAP-TLS
Support
Nearly Universal
Nearly Universal
Server Authentication
Yes
Yes
User Authentication
MSCHAPv
Certiﬁcate
Easy to Conﬁgure
Yes
No
Easy to Manage
Yes
No
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Solutions
PEAP Mitigations
Doing PEAP “Right”
Mobile Device Management
Custom CA vs Public CA
Separate accounts
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Solutions
PEAP Mitigations
Doing PEAP “Right”
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Demo
DefConSecure
Hacking the hackers
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Demo
Victims Needed
Fair warning
Turn oﬀ all of your WiFi devices if you do not wish to participate
Targeting only DefConSecure
No Man-in-the-Middle
Username and MSCHAPv challenge/response collected
Username and response displayed
Brief Denial of Service
Yes, I could crack your password later, but I know you didn’t reuse an
important one (right?)
I expect to capture only a handful, but maybe we’ll get lucky
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Demo
Additional Resources
Windows Phone  WiFi Conﬁguration Guide - http://www.windowsphone.
com/en-US/how-to/wp8/start/connect-to-a-wi-fi-network
Apple iOS WiFi Deployment Guide -
http://images.apple.com/iphone/business/docs/iOS_6_Wifi_Sept12.pdf
Smart Phone WiFi Certiﬁcations -
http://certifications.wi-fi.org/search_products.php?search=1&lang=
en&filter_category_id=24&listmode=1
Android WPA Enterprise UI Bug -
https://code.google.com/p/android/issues/detail?id=1386
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Demo
Thank Yous
DEF CON
iSEC Partners / NCC Group
EFF
The “victims”
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 / 
Demo
Josh Yavor
Senior Security Engineer
iSEC Partners
https://www.isecpartners.com
@schwascore
Josh Yavor (iSEC Partners)
The BYOD PEAP Show
DEF CON XXI, August , 
 /