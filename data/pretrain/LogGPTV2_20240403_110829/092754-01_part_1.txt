第 6 章
高级系统运维
数据是企业或者组织的核心资产，一些新崛起的互联网科技公司，例如，抖音、
阿里巴巴、美团拥有大量的用户数据，对这些数据的分析与挖掘的价值甚至已经超过
了各自公司的主营业务价值。在享受大数据分析便利和效果的同时，如何注意对安全
的管控，如何保护核心资产的保密性、完整性、可用性也逐渐成为越来越重要的工作
事项。同时越来越多的企业运维人员开始把系统服务的稳定性放在运维工作的首要位
置，而大数据系统在这些系统中所表现的稳定需求也尤为突出。如何保持一个系统可
以连续性地对外提供服务，减少系统的故障情况，从而增加实际使用过程中的用户体
验度、运维的高可用（high availability），已经成为系统从设计到实施乃至后期维护中
都要着重考虑的内容。
本章将从系统运维的视角出发，展开描述高级系统运维中的安全管理、系统优化，
以及系统的高可用架构等相关概念，并从实践的角度扩充介绍相关的技术实践方案和
优化方案。
6.1 安全管理
安全管理的主要目标是保障系统的安全和稳定运行，以及资产的保密性、完整性
和可用性。
（1）保密性是指对数据的访问控制，只有被授权的用户才能允许使用。
（2）完整性指的是保证数据没有在未经授权的方式下改变。
（3）可用性是指在系统服务时间内，确保服务的连续可用。
在 ISO 中，信息安全的定义是在技术上和管理上为数据处理系统建立的安全保护，
保护计算机硬件、软件和数据不因偶然和恶意的原因而遭到破坏、更改和泄漏。
从互联网诞生以来，有关信息安全的问题一直呈现上升态势，而随着近年来相关
第 6章 高级系统运维 193
软件和硬件技术的进一步发展、相关安全管理制度和技术的逐渐完善，代码扫描和漏
洞检测工具的日趋成熟，系统安全已经逐步步入一个新的高度；然而安全的风险和威
胁并没有随着体系的日益成熟而消除，创建和维护一个相对安全的系统，仍然是每一
个行业从业者不得不考虑的问题。如图 6-1 所示为目前各漏洞类型的占比情况。
Web应用
图6-1 信息安全漏洞占比
6.1.1 资产安全
1．环境设施安全
环境的区分可以分为服务器机房环境和日常终端办公环境，然而无论是其中何种
环境，都需要遵循以下的规则去进行权限细化。细化的过程首先是对环境最小颗粒度
的拆分，按照功能把每个环境拆分成多个很小的功能区域，每个区域设置对应的门禁
措施，并为具备相关权限的开发者或管理人员配置进出权限。
当前应用比较广泛的门禁系统主要分为卡片式、密码式、生物特征式和混合式。
卡片式的门禁系统，进入人员需要持卡刷卡进出权限环境；密码式门禁系统，人员凭
借提前配置好的密码进出权限环境；生物特征式的门禁系统，就如字面意思，人员可
以通过生物相关的唯一性特征进出权限环境，这类生物相关特征目前比较多的有指纹、
虹膜、面部识别等；混合式的门禁系统可能会采取以上所列举的一种或多种认证方式
进行组合认证进入场所。对于非组织内部的相关人员，则要求制度规范拥有一套对应
的登记机制流程，确保外来人员可以在组织监控下进出相关关键场所。
为了保护重要的电子设备和数据资源，机房防火系统一般都会安装延误探测器，
在起火产生明火前发现火警，并且在火势进一步扩大前进行电源截断，使用灭火设备
手动灭火。一般在数据中心或者机房场景中，电子元器件会在遇水后发生故障，因此
会采用气体灭火系统。该系统可以将具有灭火能力的气态化合物通过自动或者手动的
方式释放到火灾发生区域。其主要使用的气态化合物有二氧化碳、七氟丙烷、三氟甲
烷、烟烙烬等。另外需要注意的是，数据中心还应该安装适当的防火墙，这样可以使
火源控制在局部范围内而不会进一步扩大，从而把火灾的损失降到最低。除了防火系
194 大数据应用部署与调优
统外，防水、防雷、防鼠患等措施也需要被考虑到环境防护因素中。
视频监控也是一个常用的安全管控手段，在关键的通道、入口处安装相应监控设
备，通过实时监控的方式获取对应环境的实际情况，并根据存储容量，及时归档监控
视频的内容，方便后期随时查询。监控的内容除了图像内容之外，还应包括环境的温
度、湿度、电力工作情况等。
2．设备安全
常见的设备管理措施首先是对所有设备的统计登记和编号；然后是在设备发生变
化时及时去进行设备信息的维护，变化场景主要有设备的购入、报修、报废、迁移、
升级调整等；另外每年需要重新对所有设备信息进行定期的审计复核，确保数据的准
确。目前，已经有二维码或者 RFID 内置的标签，可以粘贴在各种设备的物理表面，
也有自动化的物理机架可以直接配合对应的设备管理系统对物理硬件设备进行信息化
管理。
6.1.2 应用安全
1．技术安全
1）安全漏洞
随着软件技术的发展，对系统、网络、物理方面应用层的入侵手段逐步增多，而
入侵的门槛也同步变低，同时应用由于自身需求的不断变化而快速迭代，来自应用层
的攻击问题凸显出来。OWASP（开放式 Web 应用程序安全项目）根据攻击向量、技
术影响、漏洞可检测性、漏洞普遍性几个维度的评估，列出了十大 Web 应用漏洞，如
表 6-1 所示。
表6-1 OWASP十大Web安全漏洞
漏 洞 概 述
注入攻击漏洞，例如，SQL、OS以及LDAP（轻型目录访问协议）注入。这些攻
击发生在当不可信的数据作为命令或者查询语句的一部分，被发送给解释器时。
注入
攻击者发送的恶意数据可以欺骗解释器，以执行计划外的命令或者在未被恰当授
权时访问数据
与身份认证和会话管理相关的应用程序功能往往得不到正确的实现，这就导致了
失效的身份认证和
攻击者破坏密码、密钥、会话令牌，或攻击其他的漏洞去冒充其他用户的身份（暂
会话管理
时或永久的）
当应用程序收到含有不可信的数据，在没有进行适当的验证和转义的情况下，就
将它发送给一个网页浏览器，或者使用可以创建 JavaScript 脚本的浏览器 API，
跨站脚本（XSS） 利用用户提供的数据更新现有网页，这就会产生跨站脚本攻击。XSS允许攻击者
在受害者的浏览器上执行脚本，从而劫持用户会话、危害网站或者将用户重定向
到恶意网站
第 6章 高级系统运维 195
续表
漏 洞 概 述
对于通过认证的用户所能够执行的操作，缺乏有效的限制。攻击者会利用这些缺
失效的访问控制 陷来访问未经授权的功能和/或数据，例如，访问其他用户的账户、查看敏感文件、
修改其他用户的数据、更改访问权限等
由于许多设置的默认值并不是安全的，因此，必须定义、实施和维护这些设置。
安全配置错误
此外，所有的软件应该保持及时更新
许多Web应用程序和API没有正确保护敏感数据，例如，财务、医疗保健和PII。
攻击者可能会窃取或篡改此类弱保护的数据，进行信用卡欺骗、身份窃取或其他
敏感信息泄露
犯罪行为。敏感数据应该具有额外的保护，例如，在存放或在传输过程中的加密，
以及与浏览器交换时进行特殊的预防措施
大多数应用和API缺乏检测、预防和响应手动或自动化攻击的能力。攻击保护措
攻击检测与防护
施不限于基本输入验证，还应具备自动检测、记录和响应，甚至阻止攻击的能力。
不足
应用所有者还应能够快速部署安全补丁以防御攻击
一个跨站请求伪造攻击迫使登录用户的浏览器将伪造的HTTP请求，包括受害者
跨站请求伪造
的会话cookie和所有其他自动填充的身份认证信息，发送到一个存在漏洞的Web
（CSRF）
应用程序
组件，例如，库文件、框架和其他软件模块，具有与应用程序相同的权限。如果
使用含有已知漏洞 一个带有漏洞的组件被利用，这种攻击可以促成严重的数据丢失或服务器接管。
的组件 应用程序和API使用带有已知漏洞的组件可能会破坏应用程序的防御系统，并使
一系列可能的攻击和影响成为可能
现代应用程序通常涉及丰富的客户端应用程序和API，例如，浏览器和移动App
未受有效保护的API 中的JavaScript，其与某类API（SOAP/ XML、REST/JSON、RPC、GWT等）连
接。这些API通常是不受保护的，并且包含许多漏洞
2）安全开发
从应用自身角度出发，如果是应用代码本身产生的漏洞，那么在代码层加固或者
编码时就解决漏洞无疑是最根本有效的方法。这就对系统的设计阶段提出了要求。
（1）设计完整的认证和授权。在设计和开发应用程序时，常常会首先定义认证和
授权模块，使用认证和授权技术对使用的用户进行身份认证和权限授权。认证是对用
户身份的甄别，通过对用户的登录账号与密码进行验证匹配，判定用户是否有权限进
入或者获取系统相关的服务功能。为了遵循安全性和便捷性的要求，也可以通过生物
标识、统一认证、客户端证书认证、动态口令复核的方式进行用户身份的认证。认证
的完成其实只是授权认证的基础，只是标识用户具备了访问和登录的权限，接下来是
对用户权限的查询与赋权。
由于 Web 应用中的用户众多，大部分 Web 应用权限系统的设计都会采用 RBAC
（role-bases access contrl）模型，是一种基于角色进行应用环境访问的权限控制策略。
系统会在预定义配置中划分出几类用户角色的赋权，这里的角色可以理解为具备
同类行为和责任范围的一组权限共同组。只要把角色赋予用户，就可以使用户具备与
角色等同的授权内容，而不用特定关心是具体哪一个用户。当然用户也可以同时包含
196 大数据应用部署与调优
多个角色，从而获得一个可配置的复杂角色身份。一个用户可以拥有多个角色，而一
个角色也可以囊括多个使用用户。角色访问控制的优点显而易见：便于授权管理和赋
权；便于按照工作和业务进行权限分级，责任独立可控；便于文件的分级管理且适合
大规模实现。角色访问是一种有效而灵活的安全措施，系统管理模式明确，且可以节
约管理开销。
在具体的系统设计和实现中，还有两个重点的问题：权限信息的存储和权限的校