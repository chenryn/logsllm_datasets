title:Em\(µ\)code: Masking hard faults in complex functional
units
author:Nicholas Weaver and
John H. Kelm and
Matthew I. Frank
978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
458
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 09:58:33 UTC from IEEE Xplore.  Restrictions apply. 
Emμcode:MaskingHardFaultsinComplexFunctionalUnitsNicholasWeaver,JohnH.KelmandMatthewI.FrankCenterforReliableandHigh-PerformanceComputing,CoordinatedScienceLaboratoryUniversityofIllinoisatUrbana-Champaign1308W.MainStreet,Urbana,IL-61801,USA{nrweaver,jkelm2,mif}@illinois.eduAbstractThispaperpresentsEmμcode,atechniqueformaskinghardfaultsinmodernmicroprocessorsthatprovidesgrace-fulperformancedegradation.Emμcodeemploysmicrocodetraceswithcontrolﬂowthatreplaceanoriginalinstruc-tiononceafaultisdetected.Emμcodeaddslightweightmi-croarchitecturalhardwaretoassistincorrectinghardfaultsinlargerstructures,suchasSIMDexecutionunitsfoundincontemporarymicroprocessors,wherereplicationisin-feasible.Keychallengesinimplementingmicrocodetracesincludemaintainingproperarchitecturalstateandtheop-timizationoftracecode.Weareabletosigniﬁcantlyop-timizetracesbyexploitingdynamictracebehaviorandbyperformingminormodiﬁcationstothemicroarchitecture.Weﬁndthatremovinghardtopredictbranchesisimpor-tantforoptimizingtraces.Emμcodeusespartialpredica-tion,newmicrocodeoperations,andthefulluseofthemi-crocode’sﬂexibilityandvisibilitytocreatefasttraces.ThispaperstudiestheviabilityofimplementingSIMDﬂoatingpointarithmeticoperationsfoundinmodernx86processorsusingEmμcodetraces.Ourresultsshowthatforprogramswith1to5percentofthedynamicinstructionsreplacedbyEmμcode,agracefulperformancedegradationofonly1.3xto4xisachievable.1.IntroductionAsprocessfabricationtechnologyimproves,hardfaultsarebecomingaprimaryconcernofcomputerarchitects.Ahardfaultoccurswhenatransistororwireiseitherimprop-erlyfabricatedordegradestothepointwhereitnolongeroperatescorrectly.Hardfaultsalsomanifestthemselvesasstuck-atfaultswhereatransistorornodeispersistentlystuckateitheralogicaloneorzero.Smallermanufactur-ingprocessesexacerbatetheproblemsthathavebeenob-servedalready.Examplesofdegradationincludeelectromi-gration[3],negativebiastemperatureinstability[22],andthehot-electroneffect[16].Theseproblemsbecomemorecommonasprocessvariationincreaseswiththedecreaseindevicesizes,leadingtoanincreasedlikelihoodofdefectsduetofabrication[4].Moreover,hardfaultsarepersistentandnon-local.Previousworksuggestsmanymethodsofcorrectingthesehardfaults.Aformofgracefulperformancedegra-dationwherebyredundancy,whichalreadyexistsinproces-sorsforthepurposeofincreasingperformancethroughpar-allelism,enablesexecutiontocontinueaftercertainunitshavefailed[20].Structuralduplication(SD)[20]involvesfabricatingsparestructuresonthechipthatcanbebeacti-vatedwhenafailureisdiscovered.Similarlyextrapipelinestagestodetectandcorrecterrorshavebeenstudied[2].However,notallofthesetechniquesareusefulforspe-cializedstructureslikeﬂoatingpointunits,orforcorrect-inginstructionsthatrequiretheuseoftheentireexecu-tionpipeline,suchassmall-vectorSIMDoncontempo-raryCPUs,wherethereisnoredundancyinthearchitec-ture.Duetotheprohibitivecostintermsofareaofaddingspareﬂoatingpointunits,wepursueanalternateapproach.Emμcodeisatechniquepresentedtomaskthesehardfaultsoncedetected.Emμcodecorrectshardfaultsinacceleratedstructuresbyreplacingfaultyinstructionswithmicrocodethatusesadifferentpipeline.Emμcodeisagracefulperformancedegradation(GPD)techniquewherehardfaultsaremaskedbyexecutinganEmμcodetraceinplaceoftheoriginalinstructionthatfailed.AnEmμcodetraceissimilarinnaturetotracesfoundintheTraceCachearchitectureaspresentedbyRotenbergetal.[17].FloatingpointEmμcodetraces,forinstance,aremicrocodedversionsoftheoriginalinstructionthatutilizeonlytheintegerpipeline,whichismoreeasilyprotectedbyothermethodssuchasSD.Forthepurposesofthiswork,SSEﬂoatingpointarithmetic[21]operationsarechosenasarepresentativesetofinstructionsthatcouldbeprotectedbyEmμcode.SinceduplicatingtheSSEpipelineisprohibitivebecauseitislarge,havinganothermethodofcorrectinghardfaultsovertheinstructionsthatusetheSSE978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE