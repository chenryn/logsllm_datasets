如果我们希望你注意代码块中的某些部分，那么相关的行或语句就会被加租：
fron drozer import android
from drozer,modules import common, Module
class AttackSurface (Module, common.Filters , common. PackageManager) :
命令行窗口中的输入或输出，则被表示成这样：
sudo aptitude update//如累律&经某好了aptitude
第一次出现的术语和重要的单词会被加租。在正文中，你会在屏幕上，菜单栏
或对话框中看见的文字，也会像这样出现：“当你同意了用户许可协议之后，你可以
单击“安装”按钮，收集你的文档和API”。
Q
警告或重要的提示会出现在这样的地方。
1
小窍门或小技巧会这样显示。
读者反馈
我们总是欢迎你—亲爱的读者提出宝贵的意见。请让我们知道你对本书的看
法—无论你喜欢还是不喜欢。反馈意见对我们今后出版你真正最需要的东西是非常
重要的。
如果只是一般的意见，请给PI:EMAIL 发送电子邮件，并在主题中
注明书名即可。
如果你对某个主题特别有研究，或者你有兴趣写一本书或投稿，请移步我们的
作者指南页面 www.packtpub.com/authors。
区
---
## Page 11
Android安全攻防实战
售后服务
你现在已经是尊贵的Packtbook的客户了。我们愿意为你的购买提供全面的服
务，使你获得更多东西。
下载示例代码
你可以在网站htp:/www.packtpub.com 你的账户中，下载所有你已经购买了的
Packtbooks的示例代码。无论你是在哪里购买这本书的，你都可以用你的电子邮箱
注册一个账号，访间http://www.packtpub.com/support 页面。
勤误
尽管我们已经非常仔细地校对了稿件，但错误仍然是不可避免的。如果你在我
们的书中发现了错误—不论是文字，还是代码错误—都请告诉我们，我们将感激
不尽。这样做，你不仅可以帮助其他读者免受错误的困扰，也能帮助我们改进这本
书后续版本的质量。如果你发现了任何错误。请访间http://www.packtpub.
com/submit-rrata 网页，选中你的书籍，单击“errata submission form”链接，并输
入你发现的错误的详细信息，把它告诉我们。一旦你报告的错误被确认之后，你的
意见将会被接受，该错误也会被发布在我们的网站上，或被添加到一张该书籍的期
误表中。在 http://www.packtpub.com/support 网站中选中您的书目，就能看到所有目
前已知的错误。
版权
互联网上，可复制媒体的版权保护问题是个一直困扰着所有媒体的问题。在
Packt，我们是非常严肃地对待版权保护和用户许可协议问题的。如果你在网上发现
任何非法复制我们的书籍的情况—无论是以何种形式，请立即通过我们公司的地址
或网站联系我们，以便我们采取补救措施。
请通过邮箱PI:EMAIL联系我们，并附上疑似盗版材料的链接。
我们感谢你为保护我们的作品而提供的帮助，并且我们也将尽我们的所能，向
你提供物质回馈。
疑难解答
如果你对本书的任何方面有所疑问，请通过邮箱PI:EMAIL联系我
们，我们将尽力去解决它。
X
---
## Page 12
作者简介
Keith Makan
以前他是计算机科学和物理学专业的学生，现在是狂热的业余爱好者和安全研
究员。他把绝大多数业余时间都用在了阅读源码、逆向工程、fuzz 测试和编写Web
应用技术中的相关漏润的利用代码上。
Keith工作起来就像是一个IT安全评估专家一样专业。他的个人研究已经使他多
写了谷歌Chrome的WebKit XSSAuditor，火狐浏览器的NoScript 插件中漏洞的利用
代码。此外，他还数次报告了WordPress插件中的漏洞，并写出了相应的利用工具。
我要感谢我的妈妈、爸爸以及其他支持我疫狂的想法，并总是给我极
大鼓励的家人们
Scott Alexander-Bown
他是一名在金融服务，软件开发和移动app客户端开发方面有着丰富经验的研发
高手。他一直沉洒于Android之中，热爱移动app 安全。
Scott目前是一位高级开发人员，专长于移动 app 的开发、逆向工程以及app 加
固。他也热衷于发表与app安全相关的演讲，活跃在多个国际移动app开发者大会上。
最重要的，我要感谢我的妻子Ruth，没有你的爱和鼓励，我将一事无
成。我爱我们的儿子Jake，他的笑声和可爱的笑脸是我前行的动力。
此外，我还要感谢以下诸公：
Keith, Barbara,Kirk Bown,Mhairi  Robert Alexander ，感谢你们给
予我的爱和支持。
AndrewHoog和viaForensics小组的成员，感谢你们在移动安全领城
的支持、洞察力和经验。
---
## Page 13
Android安全攻防实战
Mark Murphy, Nikolay Elenkov, Daniel Abraham, Eric Lafortune, Roberto
Tyley, Yanick Fratantonio, Moxic Marlinspike, the Guardian Project fo the
Android 安全团队，你们博客中的文章、论文、演示和/或示例代码对于学
习Android安全是很有趣且非需有用的。
感谢Keith Makan的热心和指导，在你的带领下，我才能完成本书的
编写。
感谢本书的各位技术审校对细节的关注和极具价值的反馈意见。最后，
感谢您—亲爱的读者—我希望，您能从本书中获益，并由此写出更安全
的app
XII
---
## Page 14
审稿人简介
Miguel Catalan Banuls是一名年轻的工程师，他唯一的梦想是希望自己的努力
能为世界的改变做出贡献。他是一名软件开发人员，也是一名团队的带头人。
他拥有工业工程学士学位，是GeekyTheory的合伙人。他还是MiguclHermandez
大学（西班牙分校）的IEEE学生分会的副会长。
我想感谢我的要子与父母，感谢他们对于我工作的理解与宽容。
Seyton Bradford是一名在移动设备安全和取证上有着超过10年经验的软件开
发人员和工程师。
目前，他在viaForensics 任高级软件工程师，主攻app 和移动设备的安全性。
他的作品在全球各地均有出版，同时还是多部学术期刊的评审。
感谢我的家人及朋友对我事业与工作的支持。
Nick Glynn 目前受聘担任技术培训师和顾间，在英国和世界各地提供关于
Android、Python和Linux的课程和专业知识，他在许多领域，无论是主板启动代码、
Linux 驱动程序开发和系统开发，还是全栈部署、Web应用程序开发，以及Linux和
Android平台的安全强化，都拥有丰富的经验。
我要感谢我家人给我的爱，感谢我漂亮的宝员女儿，是你照亮了我的
生活。
Rui Gongalo就读于葡萄牙布拉加的Minho大学，他现在正在完成Android安全
领域的硕士论文。他正在开发一项新功能，旨在使用户能以非常细的粒度，控制互
---
## Page 15
Android安全攻防实战
两门课程，在几次有关的活动中他得到了这一领域里葡萄牙最重要的公司的支持。
他建议涡望成为安全领域专家的Android安全初学者把这本书作为必读书目。
我要感谢Packt出版社负责此书的工作人员，是你们让我完全相信，对
移动安全的研究会占满我对探索软件世界的所有好奇心。
EliotLong从小在硅谷长大，2005年起就编写了多个移动app。他是移动旅游线
路生成软件mycitymate SL/GmbH的共同创始人。2009 他加入了Intohand有限公司，
负责Android和黑莓开发。
XIV
---
## Page 16
目
录
第1章Android开发工具
1.1简介
1.2安装 Android 开发工具（ADT）
2
1.3安装Java开发包（JDK）
1.4更新API资源.
9
1.5另一种安装ADT的方法
.11
1.6安装原生开发包（Native Development Kit，NDK）
15
1.7虚拟Android 设备
16
1.8使用命令行创建Android虚拟设备（AVD）
 19
1.9使用Android调试桥（ADB）与AVD交互
21
1.10从AVD上复制出/复制入文件
22
1.11通过 ADB 在AVD 中安装app
23
第2章实践app安全
.24
2.1简介
24
2.2检查app 的证书和签名
24
2.3对 Android app 签名
33
2.4验证 app 的签名
. 37
2.5探索 AndroidManifestxml 文件
37
2.6通过ADB与 activity 管理器交互
 47
2.7通过 ADB 提取 app里的资源
, 50
第3章Android安全评估工具
.56
3.1简介
56
3.2制作 Santoku 启动盘和安装Santoku
58
---
## Page 17
Android安全攻防实战
3.3安装drozer
62
3.4运行一个 drozer会话
71
3.5枚举已安装的包（package）
72
3.6枚举 activity
 78
3.7
枚举content provider
. 80
3.8
枚举 service.
83
3.9枚举 broadcast receiver.
85
3.10确定app 的受攻击面（attack surface）
87
3.11运行 activity
89
3.12编写drozer模块
个驱动枚举模块
16 *
3.13
编写一个app证书枚举器。
94
第4章利用app中的漏洞，
86
4.1
简介
98
4.2
收集 logcat 泄露的信息.
101
4.3
检查网络流量
106
4.4
通过 activity manager 被动噢探 intent
..111
4.5
攻击service
.117
4.6
攻击broadcast receiver.
. 121
4.7
枚举有漏洞的 content provider
123
4.8
从有漏洞的 content provider 中提取数据。
126
4.9向 content provider 插入数据
129
4.10枚举有 SQL-注入漏洞的 content provider..
131
4.11
利用可调试的app
134
4.12 对app 做中间人攻击，
139
第5章保护app...
..146
5.1简介
146
5.2
保护 app 的组件
147
5.3
通过定制权限保护组件
149
5.4
保护 content provider 的路径（path）
152
5.5
防御SQL注入攻击
155
5.6