#BHUSA @BlackHatEvents
Glitched on Earth by Humans: 
A Black-Box Security Evaluation of the SpaceX 
Starlink User Terminal
Lennert Wouters
@LennertWo
COSIC
#BHUSA @BlackHatEvents
Starlink 101
Laser link
Lower Earth Orbit (LEO)
Space
Earth
User Terminal (UT)
Gateway
Internet
Satellite
2
This talk
Source: u/darkpenguin22
Source: SpaceX
Source: SpaceX
#BHUSA @BlackHatEvents 3
#BHUSA @BlackHatEvents
Teardowns
youtube.com/c/KenKeiter   @kenkeiter
youtube.com/c/MikeOnSpace   @mikeonspace
youtube.com/c/Thesignalpath  @TheSignalPath
youtube.com/c/ColinOFlynn   @colinoflynn
danmurray.net
@DanJMurray
4
olegkutkov.me    @olegkutkov
#BHUSA @BlackHatEvents
Hardware revisions
Circular UT
Square UT
High Performance UT
• 50 x 30 cm (19″ x 12″)
• Residential and RV
• rev3_proto0
• rev3_proto1
• rev3_proto2
• 57 x 51 cm (22″ x 20″)
• Business and Maritime
• hp1_proto0
• hp1_proto1
• 59 cm (23,23″) diameter
• Residential
• rev1_pre_production
• rev1_production
• rev1_proto1/2/3
• rev2_proto0/1/3
• rev2_proto2 (SoC cut 3)
• rev2_proto4 (SoC cut 4)
5
This talk (but attack should apply to all UT hardware)
Transceiver
• External phased array
• transceiver_rev2p0/5
#BHUSA @BlackHatEvents
ethernet + power
motors
UART
Accessible connectors on V2*
UT RX
UT TX
JST BM10B-ZPDSS-TF(LF)(SN)
JST BM05B-ZESS-TBT(LF)(SN)
6
*V1 hardware had an extra connector, V3 does 
not have easily accessible connectors
#BHUSA @BlackHatEvents
UART – U-Boot
7
(Newer firmware no longer uses this version)
U-Boot does not accept serial input
(on non-development/fused hardware) 
#BHUSA @BlackHatEvents 8
UART – Login Prompt
#BHUSA @BlackHatEvents
Clock generation
59 cm (23,23″) 
9
GPS receiver
STM STA8089
GLLBLU
GPS
clock
SoC
POE
PCB overview
#BHUSA @BlackHatEvents
• (A) Digital BeamFormer (DBF)
• STM GLLBSUABBBA
• Codename: SHIRAZ
• (B) Front-End Module (FEM)
• Codename: PULSAR(AD)
• V2 hardware and up: 
• 1 DBF → 16 FEMs
10
RF Components
A
B
#BHUSA @BlackHatEvents 11
Siliconpr0n
Thanks to John McMaster!
@johndmcmaster
siliconpr0n.org/archive/doku.php?id=mcmaster:spacex:gllbsuabbba-shiraz
id=mcmaster:spacex:gea-aa12-109d-tg02-pulsarad
#BHUSA @BlackHatEvents
• (A) System-on-Chip
• Custom quad-core ARM Cortex-A53
• ST Microelectronics 
•
GLLCCOCA6BF (cut 3?)
•
GLLCCODA6BF (cut 4?)
• Codename: CATSON
• (B) Secure Element
• STM STSAFE-A110
• (C) 4GB eMMC
• (D) 2 x 4Gbit DDR3
A
C
D
D
12
B
#BHUSA @BlackHatEvents
SoC
• through substrate image
• GLLCCOCA6BF (cut 3?)
• Thorlabs NIR camera
• Mitutoyo NIR objective 50x
• Can help narrow down 
interesting locations for some 
physical attacks
• Full resolution version will be 
available on siliconpr0n.org!
13
4 CPU cores
#BHUSA @BlackHatEvents
Identifying eMMC test points
14
CMD
CLK
D0
#BHUSA @BlackHatEvents
SD card reader
TXS0202EVM
Level shifter
15
Reading eMMC in-circuit
What I did
What I recommend
Low Voltage eMMC Adapter 
by
1V8
#BHUSA @BlackHatEvents
Extracting the eMMC dump
•
Split the dump into:
•
TF-A Bootstages: Firmware Image Packages 
•
unpack with TF-A fiptool
•
Flattened uImage Tree (FIT) 
•
unpack with U-Boot dumpimage
•
SpaceX Runtime (dm-verity, error correcting codes)
•
SpaceX Calibration (dm-verity)
•
SpaceX EDR (LUKS)
•
SpaceX dish config (LUKS)
•
More details:
•
esat.kuleuven.be/cosic/blog/dumping-and-extracting-the-spacex-starlink-user-terminal-firmware
16
U-Boot GPL sources: spacex_catson_boot.h
#BHUSA @BlackHatEvents
Temperature and RF channels
17
#BHUSA @BlackHatEvents 18
Development geofences
#BHUSA @BlackHatEvents
Obtaining root
19
#BHUSA @BlackHatEvents
Fault injection
✓ Flip-chip packaging exposes die backside
•
Laser Fault Injection, Body Bias Injection, Electromagnetic Fault Injection
x PCB is too big for our automatic XYZ positioning equipment
•
Likely cumbersome to do on a roof...
x No development kits
•
Differential clock input
•
(But PLL?)
•
Reset line
•
Voltage Fault Injection
20
#BHUSA @BlackHatEvents
Crowbar VFI
•
NewAE ChipWhisperer-Lite (~ $250) 
•
Glitch port is connected to the SoC core voltage
•
Momentarily shorts core voltage to GND
•
Core voltage:~1V, generated by TI TPS56C230
•
All decoupling capacitors untouched at this point!
•
Oscilloscope triggers on serial data
•
Trigger output is input to the ChipWhisperer-Lite
•
Glitch parameters controlled from Python
•
Offset from trigger point
•
Glitch width
21
#BHUSA @BlackHatEvents 22
Example output
#BHUSA @BlackHatEvents
Results
✓ The Proof-of-Concept works
✓ Was reproduced by the SpaceX PSIRT
✓ Easy to produce (undesirable) faults
✓ A fully booted SoC is already being pushed to its limits
x
Slow: 1 attempt every 12 seconds (one per boot)
x
Low success rate: many hours for one good attempt
x
Unreliable: successful glitch often also results in other errors
23
#BHUSA @BlackHatEvents
STM/SpaceX ARM TFA-A
24
1. BL1 loads BL2 certificate from eMMC
2. BL1 verifies the certificate’s signature
3. BL1 loads the BL2 firmware from eMMC
4. BL1 verifies that SHA512(BL2) matches the hash contained in the certificate
#BHUSA @BlackHatEvents 25
BL1 Glitch setup
•
Try to boot with (in)valid signature, hash and firmware
•
Try to glitch a valid certificate into a signature verification failure
#BHUSA @BlackHatEvents
Normal boot
26
UART
x 10e6 samples
EM side-channel
Signature verification
“INFO:    Image id=6 loaded at address 0x30209000, size = 0x90”
→ Certificate has been loaded
#BHUSA @BlackHatEvents
Glitched boot
27
UART
x 10e6 samples
EM side-channel
Signature verification skipped?!
“INFO:    cert_nv_ctr : 1”
→ Signature verified and the rollback counter is 1
#BHUSA @BlackHatEvents
ROM Bootloader (BL1)
•
Mapped at 0x30000000 and readable from BL2!
•
BSEC eFuses mapped at 0x22400000 (shadow registers)
•
Emulated the ROM bootloader using Unicorn Engine
•
Fuzzed using AFL++ in Unicorn mode
•
Simulated instruction skip faults in Unicorn Engine
•
Single instruction skip faults do not result in the observed behavior!
•
Code has some control flow checks and redundant operations
•
Skipping two consecutive instructions does result in the observed behavior
•
(Actual fault model is likely to be different)
28
github.com/AFLplusplus/AFLplusplus
github.com/unicorn-engine/unicorn
#BHUSA @BlackHatEvents
BL1 glitch detection example
29
INFO:    BL1: Get the image descriptor
INFO:    BL1: Loading BL2
INFO:    Loading image id=6 at address 0x30209000
INFO:    Skip reserving region [base = 0x30209000, size = 0x90]
INFO:    Image id=6 loaded at address 0x30209000, size = 0x90
INFO:    cert_nv_ctr : 1 
INFO:    plat_nv_ctr : 0
INFO:    Loading image id=1 at address 0x30209000
INFO:    Image id=1 loaded at address 0x30209000, size = 0xf178
NOTICE:  BL1: Booting BL2
NOTICE:  plat_error_handler
err = -80
INFO:    Authentication error !!!
Certificate has been loaded
Contains invalid signature but 
valid digest of BL2 firmware
Signature verification succeeded!
Loaded BL2 firmware and 
verified hash digest
Final control flow check detects 
our glitch! 
BL1 UART output
#BHUSA @BlackHatEvents
BL1 glitch detection example
30
1
2
3
Called right before passing control to BL2
#BHUSA @BlackHatEvents
•
Decoupling capacitors 
are needed for later boot 
stages
•
Experimented with:
•
N-channel MOSFETS
•
P-channel MOSFETS
•
High/Low side switching
•
Gate voltage
•
MOSFET drivers
•
Capacitor sizes
•
Timing
31
Enabling decoupling capacitors
#BHUSA @BlackHatEvents
Researcher access
• Demonstrated a full attack in the lab!
• But the setup is still too bulky to be used in a practical setting (e.g., on the roof)
• SpaceX offered an easy way out: SSH access through a Yubikey
• But I was already too far down the rabbit hole …
32
#BHUSA @BlackHatEvents
•
Replacing lab 
equipment with 
low-cost off-the-
shelf components
•
RPI Pico replaces 
oscilloscope and 
ChipWhisperer
•
Works
•
But still messy…
33
Creating a mobile setup
#BHUSA @BlackHatEvents
•
Scanner @ 600 DPI
•
Draw board outline at real size in Inkscape
•
Load in KiCad and use in the edgecuts layer  
34
PCB design
#BHUSA @BlackHatEvents
Modchip
35
RP2040 @250MHz
PIO for triggering
and glitch generation
2 channel MOSFET driver
Glitch/crowbar MOSFET
Decoupling MOSFETs
Castellated holes to mount to the UT PCB
6 cm
2,36″
0,8 mm
Available on GitHub!
#BHUSA @BlackHatEvents 36
12V for MOSFET drivers 
and standalone power
Core voltage regulator 
enable pin 
(for power cycling)
1V8 for
level shifter
Installed modchip
#BHUSA @BlackHatEvents 37
#BHUSA @BlackHatEvents
SpaceX strikes back
•
I did a firmware update… 
•
Previously unused eFuse is now blown and disables UART output
•
Modchip was designed to  trigger on UART
38
#BHUSA @BlackHatEvents 39
BEFORE
AFTER
Adapt
#BHUSA @BlackHatEvents
Overcome
•
Trigger on eMMC D0 instead of UART
•
Modchip could be easily adapted
•
Disconnect UT UART TX
•
Connect to eMMC D0
•
Update glitch parameters from Python
•
Alternative: new PCB revision
40
#BHUSA @BlackHatEvents
Network exploration
•
All interesting communication uses mutually authenticated TLS (STSAFE)
•
Added STSAFE support to the tlslite-ng TLS implementation
•
Python script to download the latest firmware updates
•
Mostly IPv6 2620:134:b000::1:0:0
•
Open ports (nmap): 8001-8012, 9000, 9003, 9005, 9010, 9011
41
Firmware update archive
#BHUSA @BlackHatEvents
What’s next?
•
You can make your own modchip and use it to:
•
Further explore the network infrastructure
•
Not accessible as a normal user
•
Integrate the STSAFE with GRPC
•
Interact with the Digital BeamFormers and update their firmware
•
Repurpose your terminal?
42
#BHUSA @BlackHatEvents
Conclusion
•
We can bypass secure boot using voltage fault injection in BL1
•
Quad core Cortex-A53 in a black box scenario 
•
no documentation, no open development kits
•
Enabling and disabling of decoupling capacitors
•
Fault injection countermeasures are only as good as the fault model that was used
•
This is a well-designed product (from a security standpoint)
•
No obvious (to me) low-hanging fruit
•
In contrast to many other devices getting a root shell was challenging
•
And a root shell does not immediately lead to an attack that scales  
•
SpaceX PSIRT was very responsive and helpful!
•
https://bugcrowd.com/spacex PI:EMAIL
43
#BHUSA @BlackHatEvents
COSIC
@LennertWo
PI:EMAIL 
github.com/KULeuven-COSIC/Starlink-FI
#BHUSA @BlackHatEvents 45
Demo!
#BHUSA @BlackHatEvents
Thanks!
• Arthur Beckers
• Gert Van Beneden
• Tim Ferrell
• John McMaster
• Dan Murray
• Colin O’Flynn
46