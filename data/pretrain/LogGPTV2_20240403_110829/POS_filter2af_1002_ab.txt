INIT功能由初始权益分配参数化。这是给参与者分配的非负数，写成S0 =((U1,s1),…,(Un，sn))。
功能INITS0的操作如下：
•在进行各方的任何计算之前，该功能会为每个方U∈U确定一对公钥和私钥(pkU,skU)。
•在协议期间，该功能使用skU（用户U的私钥skU）响应来自格式为key的用户U的消息。
•在协议期间，该功能以“创世模块” B0响应genesis_lock形式的任何消息，其中包括初始权益分配和与用户相关联的公钥
该模型引入了另一个实体：环境Z。在环境中，环境仅负责生成交易，这些交易作为各方的输入提供。特别地，在协议的每一轮中，环境可以向各方提供交易的集合。具有（U，U’，s）形式，要求将s的股份从U方转移到U’方。
（对于攻击，仅将环境视为交付给各方的固定交易时间表就足够了。请注意，典型的区块链安全模型将赋予环境更大的强大力量：攻击者的信息通道，自适应选择交易，消息传递的安排等）
最后，给定初始化功能INITS0和环境Z，协议的执行由生成块B0、各方的密钥、环境交付给参与者的交易顺序，以及参与者广播的整个消息序列组成。
## 0x05 Blockchains, Ledgers and Proof-of-stake Protocols
**a）交易分类账本属性：**
区块链是一种与每个时隙（最多）一个块关联的数据结构。除了特定于协议的元数据外，各个块还包含一组交易。在上述模型的上下文中，假设创世区块B0在与时间0相关的任何区块链中均显示为默认初始区块。一个链也立即进行股权分配SC，通过将链中的交易应用于创世区块的股权分配来实现。对于区块链C，让C⌊i表示通过删除最后i块获得的C的前缀。
直观地，区块链协议Π允许各方集合共同维护一个公共分类帐本。将关注于实际上在每个时间点为参与者维护一个单独的分类帐本的协议；协议Π的适当持久性和可用性特性可确保公共分类账本的概念：
**持久性：**
一旦系统的某个节点宣布某笔交易tx稳定，则其余的诚实节点（如果被查询）将要么在分类帐中的同一位置报告tx，要么不会报告任何与tx有冲突的交易。在这里，稳定性的概念是由安全性参数k参数化的断言。具体来说，当且仅当交易出现在C⌊k中时，它才被宣布为稳定交易（由拥有C链的一方）。
**可用性：**
如果系统中所有诚实节点都试图包括某个事务，则在经过与相对应的时间u（称为事务确认时间）之后，如果所有节点被查询并做出诚实响应，它将报告该交易稳定。
直观地讲，安全的区块链协议保证这些特性由诚实方持有的账本（记录在区块链中）拥有，在对手A的适当约束下。
**b）链选择规则—最长链规则：**
将注意力集中在由链选择规则定义的协议上：协议的每个步骤都要求某些参与者广播区块链；参与者然后采用选择规则，这可能导致用广播链之一替换其本地链。关注“最长链规则”：检查广播区块链的有效性（一种依赖协议的属性），然后采用最长有效链，包括参与者持有的链。
（长度仅是块的数量；为具体起见，假设联系在字典上是断开的）
**c）权益证明协议：** 关注通过权益证明协议Π维护的分类账 本，该账本赋予将链扩展到参与者U的权利，该概率与U在该链中的权益（前缀）成正比。
权益比例增长。SC⌊i，由C⌊i导致的权益分配，允许一方扩展给定链C的概率（表示为ExtendOpportunityΠ的事件）与在该方控制下的权益成正比。
i是协议特定参数，通常与上述安全参数k有关。
**d）相对权益和诚实大多数：**
作为一种符号，对于一组X的参与者和一个权益分配S，用S（X）表示参与者在X中所持的股份。在执行区块链协议的特定时刻（通常从上下文中可以理解），让αX∈[0，1]表示X中各方的相对权益。具体来说，是SC（X）/
SC（U），其中C是诚实用户的链。
（请注意，由于广播假设，所有诚实的参与者在每个时隙中都拥有相同的最长有效链。）如果协议的每个步骤中的αA<1/2，则具有诚实大多数执行Π。
**e）区块奖励和交易费用：** 大多数区块链协议都涉及某种形式的区块奖励和交易费用。为了能够对所有考虑的协议做出通用声明，引入以下符号：
FeesΠ(E,i)表示Z在执行E的时隙i中创建的所有新交易的总费用（占总权益的一部分）。
rewardsΠ(C,i)表示由协议Π创建并提供给在时隙i中在区块链C中创建区块的一方的代币总数。
transfersX→Y(C,i)表示时隙i中区块链C上从X中的参与者转移到Y中的参与者的总金额。
## 0x06 The Stake-bleeding Attack
在协议Π定义的通用权益证明区块链的上下文中，首先非形式化地描述攻击的运作方式。为了简化表示，始终假设攻击者控制一定比例的股份αA<1/2。攻击者A模拟诚实协议，并维护该协议规定的当前区块链的本地副本（表示为C）。此外，它还维护了一个替代的区块链Cˆ，该区块链最初是空的，对诚实参与者来说是隐藏的。
攻击者在每个时隙中根据协议的规则检查是否允许扩展链C或Cˆ。它忽略了扩展C的所有机会，因此根本没有对C的增长做出贡献。另一方面，每当出现扩展Cˆ的机会时，A便用一个新的块来扩展Cˆ，并将诚实链Cˆ中尚未包括在Cˆ中并且在Cˆ上下文中有效的所有交易插入该新块中。
（或Π规则所允许的数量）。这使A有权（在Cˆ上）获得任何块创建奖励和来自所包含交易的任何交易费用。
随着协议的发展，C和Cˆ都将以极大的概率增长，而C增长更快。由于授予C中区块创建者的区块创建奖励，A在C上的相对权益可能会减少，但由于区块奖励和交易费用，其在链Cˆ中的相对权益将会增加。在关于交易费用和大笔奖励的相对大小的一些现实假设下，Cˆ的对抗性相对权益最终将超过C的诚实相对权益。
从这一点开始，链Cˆ（比预期中）的增长快于C链，并最终变得更长。如果使用普通最长链规则，则A现在可以通过发布Cˆ轻松违反分类帐本的持久性，之后所有诚实方都将采用Cˆ。而且，如果A在发布之前将交易添加到Cˆ的末尾，在该交易中A将足够的股份转让给诚实方以不再控制多数，则它不会违反“诚实大多数”假设。
上图中给出了执行攻击的对手的更简洁描述。该描述使用ExtendOpportunityΠ（C），只要允许A根据Π规则扩展给定链C，就为true。另外，从攻击者的角度来看length（C）表示链C的长度。
## 0x07 Attack Analysis
权益证明协议Π必须满足几个属性才能使攻击成功，主要需求是：
**（i）没有频繁的检查点：**
协议必须按照最长链规则操作：在诚实方看到的所有有效链中，规定它们采用最长的链。尽管可能会偏离此要求，但Π必须一定要允许很久以前的重组：如果指定了最大重组深度且规模很小（即Π不允许诚实参与者更多地改变其对主链的看法，即使有一个更可取的候选链），也不会超过过去的几个区块（或时隙），则该攻击不适用。
**（ii）存在交易费用：**
协议Π必须涉及交易费用，或更广泛地说，涉及从交易方到维护分类账的方的任何代币转移。更详细地讲，只有在Cˆ最终比C增长快时，攻击才会成功。由于C的增长速度（分别为Cˆ）与诚实方在C中的相对权益（Cˆ对手的相对比例）成正比，因此需要后者最终超过了前者。当攻击者创建一个区块时，在每个时隙i中，Cˆ中攻击者的相对权益都会增加：