lock1xlh就是锁屏界面上的随机码，运行后你就可以得到解锁密码了。我的随机码是477042，计算后得到解锁密码：1200556544，在模拟器中输入后，点击解锁，然后进入第二层锁屏，作者还是那么嚣张，界面依然奇丑无比：
#### 0x05分析第二层锁屏
接下来继续JEB分析第二层锁屏。查看hx2代码，这里改名为hx2_showLockView2：
还是一样的配方，随机码保存在lock2xlh中，创建全屏浮动窗口达到锁屏效果，解锁按钮点击响应函数是100000002，继续看代码：
代码有点乱，拷贝出来精简一下：
注释都写清楚了，关键是理解最后代码，输入的解锁码v2前3位经过sha、md5之后就应该等于“9fd09fe7fd77ab118ef78795668bc8a1”，后9位等于随机码经过md5、sha之后保留数字位的前9位。下面就可以写代码计算了。
#### 0x06 解密第二层锁屏
由于解锁码都是数字，前3位经过sha、md5之后就应该等于“9fd09fe7fd77ab118ef78795668bc8a1”，这个可以写代码爆破。算法很简单，如下所示：
lock2xlh就是第二层锁屏界面上的随机码，运行后你就可以得到解锁密码了。我的随机码是498691，计算后得到解锁密码：187360012293，在模拟器中输入后，点击解锁，锁屏终于解除了。
之前还有个`libStarEngine.so`，在app代码中并没有发现加载该库文件的代码，IDA查看也没有发现什么，经过搜索发现是一个3d引擎，在这里也没有什么实际作用。
到这里，锁屏App已经分析完了。
#### 0x07 总结
结合之前分析，总结一下：
  1. 这是一个子母型的勒索App，母App主要完成解密、释放子病毒文件。病毒文件在5.0以下系统是`/system/app/time.apk`、 `/system/lib/libStarEngine.so`；5.0及其以上系统是`/system/priv-app/com.hl.app/com.hl.app.apk` 、`/system/priv-app/com.hl.app/lib/arm/libStarEngine.so`。
  2. 子病毒文件被加密后放在母App中，主要目的应该是绕过杀毒软件检测,效果如何见后文。
  3. 子病毒文件被释放到系统App目录中，系统双清是无法删除病毒文件的。
  4. 如果手机没有root，或者没有给勒索App授予root权限，那么是不会受影响的，只要卸载该“荒野行动盒子”即可。
  5. 病毒代码中虽然写了很多加密算法：AES、DES、md5、sha及字符替换等等，但还是很容易写出解密算法的。
  6. 另外，这个样本中可以看到使用了AIDE、MT管理器，这两个工具可以完成病毒App的开发、修改，也就是说，你只要有个安卓手机，就可以完成病毒的制作、修改过程，可以不用PC来完成，这个变化是值得注意和警惕的。
这里我简单写了一个计算解锁码的程序，需要java环境支持，用法很简单：
java -jar unlock_hyhz.jar,然后按照提示输入屏幕解锁码即可，执行效果如下图所示：
下载地址：
Hash校验：CRC32: 346A9DCB
MD5: 6BC24E74AA3C80FE2C85F0ADD84F5772
SHA-1: E0D693064D2A4350A4FC4B4B700F891420ED446C
5.0及以上系统执行：
最后所有系统上需要卸载母包：
#### 0x09 测试一下杀毒软件
最后把样本上传到virustotal.com上看了一下，有17款杀毒软件检测出来问题：
国产的阿里、360、腾讯、瑞星都可以检测出来。附[链接](https://www.virustotal.com/#/file/bf3637f7ed48732404eaaf74abc6eca0a628def264a20d86fa044db04b6abce4/detection
"链接")。
如果把子包直接放上去再看看，检测率还降低了：
我也是醉了，不知道国外那几个是怎么检测的，不过国产的阿里、360、腾讯、瑞星还是可以检测出来的，附[链接](https://www.virustotal.com/#/file/f426e208bbb8ed720d0200b28d1969c8eeb0ebaf841e63f8258d4c3fc428af88/detection
"链接")。
总体感觉，这个检测率还是偏低的。这个检测结果可能也无法代表安卓手机端的检测率。
#### 0x010 后记
个人感觉，自从5月份
wannacry爆发之后，不管是PC还是安卓系统，国内勒索病毒也越来越多了。而且现在安卓手机端的病毒可以使用安卓手机App开发、修改，那么分发、传播起来会更快，变种也会更多，这些都是PC上病毒没有的特点,需要引起重视。
最后，对于普通用户来说，防范措施非常简单，只要保持良好的使用习惯即可避免被锁屏勒索：
  1. 不要root手机！（除非你非常懂安全，即使被锁也能自己搞定）
  2. 不要下载、安装来历不明的App！
  3. 安装一个杀毒软件。
最重要的还是前两个习惯，因为“安全问题很多时候都是人的问题”。
#### 0x011 附录
样本来源：
* * *