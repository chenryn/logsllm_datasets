partially rate-limited
non-rate-limited
 0
 0.2
 0.4
 0.6
 0.8
 1
 1.2
 1.4
Throughput of 1MB+ Flows (normalized)
Figure 2: CDF of the measured throughput distri-
bution of 1MB+ ﬂows from: all ﬂows, a (application,
content-provider) that is rate-capped, one that is par-
tially rate-limited, and one that is not rate-capped
or partially rate-limited.
proximation is to ﬁnd a ﬂow size that allows most ﬂows
to exit slow-start.2 Figure 1 shows that the median mea-
sured throughput of non-rate-limited ﬂow records stabilizes
at about ﬂow size = 1MB. (We describe how we identify
rate-limited ﬂows in §3.2.)
Thus, the next most obvious algorithm is to apply a sum-
mary function over the byte/duration values in all ﬂow
records that have total bytes ≥ 1MB. For brevity, we call
these records the 1MB+ ﬂows. However, this algorithm is
not suﬃcient because measured throughput of identically
sized large ﬂows can still vary based on application pro-
tocol and content-provider. For example, Figure 2 shows
the distribution of measured throughput values over 1MB+
2Since our study examines a wireless network, TCP may exit
slow start due to physical layer loss rather than congestion
induced loss.
Indeed, the throughput in Figure 1 contin-
ues to increase linearly at a slow rate even after the knee in
the curve, which indicates that TCP AIMD sometimes ﬁnds
more capacity available after slow-start. However, since our
goal is to estimate the max-throughput that real users ac-
tually experience, we do not attempt to exclude the eﬀects
of physical layer loss.
Figure 3: Histogram of the 95th percentile of
throughput from each application, content-provider,
and (application, content-provider) ﬂow type, respec-
tively.
ﬂows for several (application, content-provider) ﬂow types.
The rate-capped type appears to be bottle-necked at or rate-
limited by the content-provider since none of its ﬂows achieve
the higher throughputs possible, as shown in the tail of the
all ﬂows line. This is in contrast to the non-rate-limited type,
which achieves throughput values throughout the possible
spectrum. The partially rate-limited line shows that a ﬂow
type can exhibit bimodal behavior:
rate-limited in some
ﬂows (0-40%) but non-rate-limited in others (40-100%). This
can be because the same application protocol is used for con-
trol messages and bulk transfer. Our inspection of ﬂow types
showed that most fall into one of these three categories. This
includes application protocols that are used only for control
messages, which would appear to be rate-capped at a very
low throughput value.
Note that a ﬂow can appear to be rate-limited for a variety
of reasons, including traﬃc shaping by the content-provider,
application protocol bottlenecks, and persistent congestion
or capacity problems on the Internet path to the server. In
practice, we do not actually need to detect the cause of the
rate-limiting, only its eﬀect on the throughput distribution.
3.2 Identifying Rate-Limited Flows
To obtain a more accurate measure of max-throughput,
we must ﬁlter out the applications and content-providers
that have ﬂow distributions similar to the rate-capped and
partially rate-limited ﬂow types. We deﬁne a rate-capped ﬂow
type to be one that never reaches the available capacity of
the network. We deﬁned a partially rate-limited ﬂow type to
be one that has a signiﬁcant fraction of rate-limited ﬂows.
We describe two heuristics to detect each ﬂow type below.
To identify rate-capped ﬂows, we note that the rate-capped
ﬂow distribution shown in Figure 2 never crosses the tail of
the all ﬂows distribution. In general, if we assume that at
least 5% of all 1MB+ ﬂows reach the available capacity, then
a non-rate-capped ﬂow type should have a 95th percentile
throughput at least as large as the 95th percentile through-
put of all 1MB+ ﬂows. This is because all 1MB+ ﬂows in-
cludes both rate-limited and non-rate-limited ﬂow records.
Figure 3 shows a histogram of the 95th percentile of each
ﬂow type, where we deﬁne ﬂow type by application only,
content-provider only, and (application, content-provider)
pair. Only ﬂow types with at least 100 ﬂows are presented.
426x
=
o
i
t
a
R
h
t
i
w
%
 5
 4
 3
 2
 1
 0
(application,content-provider)
partial rate-limiting threshold
 1
 10
 100
 1000  10000  100000  1e+06  1e+07
Maximum Slope Ratio
Figure 4: Histogram of the Maximum Slope Ratio
of each (application, content-provider) ﬂow type for de-
tails. See text in §3.2. Note the logarithmic scale of
the x-axis.
We see that for the content-provider and (application,
content-provider) distributions, there is a clear mode to the
right of the “95th percentile of all 1MB+ ﬂows” line. This
mode represents the non-rate-capped ﬂows. The application
distribution does not exhibit this mode, which suggests rate-
capping is primarily a property of content-providers, not ap-
plication protocols. We identify all ﬂow types to the left of
the line as rate-capped.
To identify partially rate-limited ﬂows, we note that the
partially rate-limited ﬂow distribution shown in Figure 2 is
bimodal: the ﬁrst portion of the distribution has a very
steep slope due to rate-limiting, while the later portion is
less steep.
In general, we want to detect these dramatic
decreases in a ﬂow type’s CDF slope. We use the following
heuristic: Let si and si+5 be the slopes at percentile i and
i + 5, respectively. We deﬁne the slope ratio of si and si+5
to be si/si+5. Deﬁne the maximum slope ratio to be the
greatest slope ratio over i ∈ [7, 8, 9, . . . , 93] (we ignore the
top and bottom percentiles to guard against outliers). The
maximum slope ratio will be large if there is a dramatic
decrease in slope within any 5 percentile range. In practice,
we approximate si as the diﬀerence between percentile (i −
2.5) and percentile (i + 2.5).
Figure 4 shows a histogram of the maximum slope ratio
over each (application, content-provider) ﬂow type. Again,
only ﬂow types with at least 100 ﬂow records are presented.
We see a primary mode to the left of line at maximum slope
ratio = 5. This mode represents ﬂow types without dra-
matic changes in slope. However, there is also a long tail to
the right of this line. We identify ﬂow types to the left of
the “partial rate-limiting threshold” as partially rate-limited.
The choice of a threshold = 5 conservatively captures the
most of the ﬂow types in the main mode. We note that our
approach described in the next section is not very sensitive
to this threshold value (we have tried thresholds up to 20
without noticeable diﬀerences).
3.3 Our Approach: A Throughput Index
To obtain a better estimate of max-throughput, our ap-
proach is to include only ﬂow types that are non-rate-capped
and non-rate-limited. We call the set of all (application,
content-provider) types that satisfy these criteria the
Throughput Index (TI). Table 1 shows the top 15 ﬂow types
Flow type
(streaming, C1)
(http other, C2)
(ﬁle download, C3)
(http other, C4)
(streaming, C5)
(p2p, C6)
(unknown, C7)
(email, C8)
(web browsing, C4)
(streaming, C5)
(http other, C9)
(email, C10)
(web browsing, C2)
(streaming, C4)
(email, C11)
...
TI
C L
(cid:129)
(cid:129) (cid:129)
(cid:129) (cid:129)
(cid:129) (cid:129)
(cid:129)
(cid:129) (cid:129)
(cid:129)
(cid:129)
(cid:129)
(cid:129) (cid:129)
(cid:129)
% 1MB+ Throughput (norm)
Mean
0.237
0.502
0.477
0.028
0.559
0.029
0.027
0.116
0.026
0.328
0.576
0.175
0.415
0.028
0.155
Flows Median
0.229
11.79
10.91
0.497
0.427
9.35
0.032
6.78
0.539
6.36
0.014
3.03
0.009
2.80
0.056
1.19
0.95
0.032
0.266
0.92
0.566
0.90
0.147
0.80
0.421
0.76
0.025
0.75
0.61
0.072
38.7
0.503
0.524
Table 1: Top 15 (application, content-provider) ﬂow
types, the % of 1MB+ ﬂows they comprise, and the
normalized median and mean throughputs of their
1MB+ ﬂows. Each content-provider is identiﬁed
with a consistent Cx identiﬁer. Column ‘C’ and ’L’
indicate rate-capped ﬂows and partially rate-limited
ﬂows, respectively. Bold rows are in the TI.
by number of 1 MB+ ﬂows, whether they are identiﬁed as
rate-capped (C) and/or partially rate-limited (L), and their
mean and median throughputs. The bold entries are in-
cluded in the TI. We see that mean and median through-
puts of TI ﬂow types are much closer to each other than
non-TI ﬂow types, as expected of unconstrained vs. con-
strained downloads. One anomaly is the “web browsing”
ﬂow type third from last in the table, which has mean and
median throughputs similar to the other TI ﬂow types. A
few of these potential “false negatives” exist because their
95th percentiles of throughput or maximum slope ratios fall
just below or above our choice of thresholds. However, it is
clear from Figure 3 and Figure 4 that modifying the thresh-
olds slightly would not dramatically change the fraction of
rate-capped or partially rate-limited ﬂow types. Moreover,
a perfect classiﬁcation isn’t necessary for the TI to be func-
tional.
Table 1 also shows that inspecting the application protocol
or content provider is not suﬃcient to determine which ﬂow
types are rate-limited. For example, the top two stream-
ing applications use the exact same streaming protocol, but
one is clearly rate-capped while the other is not. This is
because the protocol can be conﬁgured so that the entire
stream is downloaded at once. In addition, we see that iden-
tifying ﬂow type by (application, content-provider) rather
than just application or content-provider is important, since
some content-providers have both non-rate-limited and rate-
limited applications (e.g., C2 and C5). Table 2 shows the
percentage of ﬂows and ﬂow types in each ﬂow type category.
Only the ﬂow types with at least 100 ﬂows are analyzed, but
the remaining ﬂow types comprise only 6% of ﬂows. Sur-
prisingly, nearly 60% of large ﬂows are rate-capped and can
never reach the peak network capacity. The TI includes 39%
of ﬂows and 23% of ﬂow types.
In practice, we compute the TI oﬄine based on a repre-
sentative time period of ﬂow records. Once computed, we
process ﬂows online using the TI as a ﬁlter to select ﬂows for
max-throughput estimates. We currently recompute the TI
427% 1 MB+ Flows
% (application, content-provider)
C
25.8
24.3
L C+L
33.5
49.6
1.9
3.0
TI
38.7
23.1
Table 2: Percent of ﬂows and (application, content-
provider) types that are rate-capped (C), partially
rate-limited (L), both (C+L), and in the TI.
once every few months since we have observed that the dis-
tributions of popular (application, content-provider) types
do not change often.
A ﬁnal question is how to aggregate the byte/duration
measurements of ﬂows in the TI. We evaluate two approach-
es: The ﬁrst approach, TI-F, takes a mean over the through-
puts of all ﬂows records in the TI. This aggregate will be rel-
atively robust to outlier users since it weights a very large
number of ﬂows from diﬀerent users equally. However, it
is also sensitive to non-network problems that impact the
top 3 content-providers since they make up a majority of all
ﬂows in the TI. The second approach,TI-T, takes the mean
of the means of each ﬂow type. This aggregate weights each
ﬂow type equally so it is more robust to unexpected changes
with individual content-providers, but it is more sensitive
to unpopular ﬂow types that may only be used by a small
number of users. In the next section, we show that the es-
timate produced by each of these aggregates is comparable
under typical circumstances.
4. EVALUATION
Evaluating the accuracy of any max-throughput estima-
tion technique, whether passive or active, is diﬃcult because
“ground truth” measurements are not available from all user
locations at all times. In this section, we evaluate our passive
max-throughput estimation techniques by comparison with
a set of active measurements. Although these active mea-
surements do not necessarily represent ground truth, they
do represent the current state-of-the-art for max-throughput
estimation. The TI estimates of max-throughput are closer
to these active measurements than alternative passive mea-
surement techniques, which suggests that the TI estimates
are more representative of max-throughput.
4.1 Setup
In this section we compare our passive max-throughput
estimation techniques against active measurements in sev-
eral 3G wireless network regions. Each region roughly covers
a major metropolitan area. In addition, we compare against