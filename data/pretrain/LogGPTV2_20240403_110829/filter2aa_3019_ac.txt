200
PSP1
PSP1 UserA
Deposit all tokens
Token#6
2
PSP1
Token#5
1
UserA
Historic
Transactions
Token#3
3
UserA
Token#x
44
PSP1
Token#10
2
PSP1
Token#9
1
UserA
Token#2
197
PSP1
Token#8
3
PSP1
Token#x
3
PSP1
Token#x
3
PSP1
Token#x
3
PSP1
Token#x
3
PSP1
Token#x
3
PSP1
Token#x
1
UserA
Token#x
2
PSP1
Token#x
2
PSP1
Token#x
1
UserA
Token#x
2
PSP1
Token#x
1
UserA
Token#x
2
PSP1
Token#x
1
UserA
Token#x
2
PSP1
Token#x
2
PSP1
Token#x
2
PSP1
Token#x
2
PSP1
Token#x
2
PSP1
Token#x
2
PSP1
Token#x
1
UserA
Token#x
1
UserA
Token#x
1
UserA
Token#x
1
UserA
Token#x
1
UserA
Token#x
1
UserA
Token#n
12
PSP1
55
How to exploit token selection and long 
backchains
Token#1
200
PSP1
Token#6
2
PSP1
Token#5
1
UserA
Token#3
3
UserA
Token#x
44
PSP1
Token#2
197
PSP1
Token#8
3
PSP1
Token#x
3
PSP1
Token#x
3
PSP1
Token#x
3
PSP1
Token#x
3
PSP1
Token#x
3
PSP1
Token#x
2
PSP1
Token#n
12
PSP1
PSP1 Admin
Riksbank Corda node
Redeem
Token#9
1
UserA
Token#x
1
UserA
Token#x
1
UserA
Token#x
1
UserA
Token#x
1
UserA
Token#x
1
UserA
Token#x
1
UserA
Token#x
1
UserA
Token#x
1
UserA
Token#x
1
UserA
Token#x
1
UserA
Token#10
2
PSP1
Token#x
2
PSP1
Token#x
2
PSP1
Token#x
2
PSP1
Token#x
2
PSP1
Token#x
2
PSP1
Token#x
2
PSP1
Token#x
2
PSP1
Token#x
2
Token#x
56
Other setups with better effects
1500
PSP1
2000
PSP1
3000
PSP1
Several issue tokens to 
get several merkle trees
100
UserA
57
Other setups with better effects
1500
PSP1
2000
PSP1
3000
PSP1
Several issue tokens to 
get several merkle trees
Split tokens into hundreds
100
UserA
1
UserB
1
UserB
1
UserB
1
UserB
1
UserB
1
UserB
58
Other setups with better effects
1500
PSP1
2000
PSP1
3000
PSP1
Several issue tokens to 
get several merkle trees
Split tokens into hundreds
100
UserA
1
UserB
1
UserB
1
UserB
1
UserB
1
UserB
1
UserB
Use hundreds of tokens in one transaction 
5
UserA
59
Other setups with better effects
1500
PSP1
2000
PSP1
3000
PSP1
Several issue tokens to 
get several merkle trees
Split tokens into hundreds
100
UserA
1
UserB
1
UserB
1
UserB
1
UserB
1
UserB
1
UserB
Use hundreds of tokens in one transaction 
5
UserA
And do this over and over again 
to get the TransactionOfDeath
60
Crash nodes with TransactionOfDeath
and permanently lock tokens
Sometimes crashes gives inconsistencies.
PSP1
Corda 
node
PSP3
Corda 
node
UserA => UserC
Token#1
5
UserA
Token#2
5
UserC
61
Crash nodes with TransactionOfDeath
and permanently lock tokens
Sometimes crashes gives inconsistencies.
PSP1
Corda 
node
PSP3
Corda 
node
UserA => UserC
Riksbank
Corda 
notary
Token#1
5
UserA
Token#2
5
UserC
Mark Token#1 as used
62
Crash nodes with TransactionOfDeath
and permanently lock tokens
Sometimes crashes gives inconsistencies.
PSP1
Corda 
node
PSP3
Corda 
node
UserA => UserC
Riksbank
Corda 
notary
Token#1
5
UserA
Token#2
5
UserC
Mark Token#1 as used
63
Crash nodes with TransactionOfDeath
and permanently lock tokens
Sometimes crashes gives inconsistencies.
PSP1
Corda 
node
PSP3
Corda 
node
UserA => UserC
Riksbank
Corda 
notary
Token#1
5
UserA
Token#2
5
UserC
Mark Token#1 as used
Used token: Token#1
Available token: Token#1
64
Network problems, timeouts, in memory 
token selection and lock tokens until restarted
Card payments in the prototype phase 1 is a signed transaction on the smart card traveling through the 
PSP of the Merchant to card holder PSP.
PSP1
Corda 
node
PSP3
Corda 
node
UserC => UserA
65
UserC
Network problems, timeouts, in memory 
token selection and lock tokens until restarted
Card payments in the prototype phase 1 is a signed transaction on the smart card traveling through the 
PSP of the Merchant to card holder PSP.
PSP1
Corda 
node
PSP3
Corda 
node
UserC => UserA
Token#2
5
UserA
Token#1
5
UserC
66
UserC
Network problems, timeouts, in memory 
token selection and lock tokens until restarted
Card payments in the prototype phase 1 is a signed transaction on the smart card traveling through the 
PSP of the Merchant to card holder PSP.
PSP1
Corda 
node
PSP3
Corda 
node
UserC => UserA
Riksbank
Corda 
notary
Token#2
5
UserA
Token#1
5
UserC
Mark Token#1 as used
67
UserC
Network problems, timeouts, in memory 
token selection and lock tokens until restarted
Card payments in the prototype phase 1 is a signed transaction on the smart card traveling through the 
PSP of the Merchant to card holder PSP.
PSP1
Corda 
node
PSP3
Corda 
node
UserC => UserA
Riksbank
Corda 
notary
Token#2
5
UserA
Token#1
5
UserC
Mark Token#1 as used
68
UserC
Network problems, timeouts, in memory 
token selection and lock tokens until restarted
Card payments in the prototype phase 1 is a signed transaction on the smart card traveling through the 
PSP of the Merchant to card holder PSP.
PSP1
Corda 
node
PSP3
Corda 
node
UserC => UserA
Riksbank
Corda 
notary
Token#2
5
UserA
Token#1
5
UserC
Mark Token#1 as used
Available token: Token#1
Timeout! 
Error! 
69
UserC
Network problems, timeouts, in memory 
token selection and lock tokens until restarted
Card payments in the prototype phase 1 is a signed transaction on the smart card traveling through the 
PSP of the Merchant to card holder PSP.
PSP1
Corda 
node
PSP3
Corda 
node
UserC => UserA
Riksbank
Corda 
notary
Token#2
5
UserA
Token#1
5
UserC
Mark Token#1 as used
Used token: Token#1
Available token: Token#1
Timeout! 
Error! 
70
UserC
Evil PSP can lock tokens of other PSPs
As the evil PSP has the information about the tokens sent to others, the evil PSP can send those tokens to 
the non validating notary node to be marked as used.
EvilPSP
Corda 
node
PSP3
Corda 
node
UserA => UserC
ing.com
https://www.ingwb.com/media/3024436/
solutions-for-the-corda-security-and-privacy-
trade-off_-whitepaper.pdf
71
Evil PSP can lock tokens of other PSPs
As the evil PSP has the information about the tokens sent to others, the evil PSP can send those tokens to 
the non validating notary node to be marked as used.
EvilPSP
Corda 
node
PSP3
Corda 
node
UserA => UserC
Token#1
5
UserA
Token#2
5
UserC
ing.com
https://www.ingwb.com/media/3024436/
solutions-for-the-corda-security-and-privacy-
trade-off_-whitepaper.pdf
72
Evil PSP can lock tokens of other PSPs
As the evil PSP has the information about the tokens sent to others, the evil PSP can send those tokens to 
the non validating notary node to be marked as used.
EvilPSP
Corda 
node
PSP3
Corda 
node
UserA => UserC
Riksbank
Corda 
notary
Token#1
5
UserA
Token#2
5
UserC
Mark Token#1 as used
ing.com
https://www.ingwb.com/media/3024436/
solutions-for-the-corda-security-and-privacy-
trade-off_-whitepaper.pdf
73
Evil PSP can lock tokens of other PSPs
As the evil PSP has the information about the tokens sent to others, the evil PSP can send those tokens to 
the non validating notary node to be marked as used.
EvilPSP
Corda 
node
PSP3
Corda 
node
UserA => UserC
Riksbank
Corda 
notary
Token#1
5
UserA
Token#2
5
UserC
Mark Token#1 as used
Used token: Token#1
Available token: Token#2
ing.com
https://www.ingwb.com/media/3024436/
solutions-for-the-corda-security-and-privacy-
trade-off_-whitepaper.pdf
74
Evil PSP can lock tokens of other PSPs
As the evil PSP has the information about the tokens sent to others, the evil PSP can send those tokens to 
the non validating notary node to be marked as used.
EvilPSP
Corda 
node
PSP3
Corda 
node
UserA => UserC
Riksbank
Corda 
notary
Token#1
5
UserA
Token#2
5
UserC
Mark Token#1 as used
Used token: Token#1
Available token: Token#2
Mark Token#2 as used
Used token: Token#2
ing.com
https://www.ingwb.com/media/3024436/
solutions-for-the-corda-security-and-privacy-
trade-off_-whitepaper.pdf
75
PSP1 Corda
And an ending note on token selection
Token#3
1000000
Owner:
PSP1
Token#2
1000000
Owner:
PSP1
Token#1
2000000
Owner:
PSP1
PSP1 UserA
PSP1 Admin
76
PSP1 Corda
And an ending note on token selection
Token#3
1000000
Owner:
PSP1
Token#2
1000000
Owner:
PSP1
Token#1
2000000
Owner:
PSP1
PSP1 UserA
PSP1 Admin
Redeem 3500000
Withdraw 50
77
PSP1 Corda