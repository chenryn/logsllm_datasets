© Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
kNAC!
August 2007
Ofir Arkin, CTO
10 (or more) ways to bypass a NAC solution
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
In Memory of Oshri Oz  
September 13, 1972 - May 27, 2007
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Agenda
What is NAC?
NAC Basics
10 (or more) ways to bypass NAC
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Ofir Arkin
CTO & Co-Founder, Insightix
http://www.insightix.com
Founder, The Sys-Security Group
http://www.sys-security.com
Computer security researcher
–
Infrastructure discovery
•
ICMP Usage in Scanning
•
Xprobe2
–
VoIP security
–
Information warfare
–
NAC
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
What is NAC?
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
What is NAC?
What problem does it aim to solve?
What functions does it need to support?
What type of a solution is it?
–
A compliance solution?
–
A security solution?
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
The Problem
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
The Problem
An enterprise network is a complex and dynamic
environment which hosts a variety of devices
–
Workstations, servers, printers, wireless access points, VoIP
phones, switches, routers and more
The stability, integrity and the regular operation of the
enterprise LAN are in jeopardy by rogue, non-compliant
and unmanaged elements (viruses, worms, Malware,
information theft, etc.)
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
NAC History
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
NAC History
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
What is NAC?
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
What is NAC?
Standardization and/or common criteria for NAC does
not exist
Therefore the definition of what NAC is, what
components a NAC solution should (and/or must) have,
and what does a NAC solution needs to adhere to
varies from one vendor to another
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
What is NAC?
The basic task of NAC is to control network access
The secondary task of NAC is to ensure compliance
As such NAC is first and foremost a security solution
and only then a compliance solution
NAC is a risk mitigation security solution
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
My Definition of NAC
Network Access Control (NAC) is a set of technologies
and defined processes, which are tasked with
controlling access to the Enterprise LAN allowing only
authorized and compliant devices to access and
operate on the network
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
NAC Basics
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Attack Vectors
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Attack Vectors
Architecture
–
The inner working of the different solution pieces
Technology
–
The technology used to support the various NAC features
•
Element detection
•
Device authorization
•
User authentication
•
Assessment
•
Quarantine / Enforcement
•
Etc.
Components
–
The various components a solution is combined from
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
10 (or more) ways to bypass NAC
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Ways to Bypass NAC
Definition
Element detection
–
Completeness
–
Real-time
–
L2 vs. L3
Validation
–
Device authorization
–
User authentication
Quarantine
–
Shared Vs. Private
–
L2 vs. L3
–
How to bypass
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Ways to Bypass NAC
Enforcement
–
Using exceptions as a bypass means
–
L2 vs. L3
Assessment
–
Qualification of elements
–
Client vs. client less
–
All-in-one client approach
–
The information checked as part of the assessment stage
–
Falsifying returning information
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
The Definition
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Definition
The problem definition
How one defines its NAC solution
The goal of the NAC solution
–
Posture validation only
–
Access control against all devices
How does the NAC solution defined?
–
Security
–
Compliance
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Definition
“Trusted Network Connect (TNC)…is an open,
nonproprietary standard that enables the application
and enforcement of security requirements for endpoints
connecting to the corporate network…enforce corporate
configuration requirements and to prevent and detect
malware outbreaks…”
“TNC includes collecting endpoint configuration data;
comparing this data against policies set by the network
owner; and providing an appropriate level of network
access based on the detected level of policy
compliance”
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Element Detection
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Element Detection
THE core feature of any NAC solution
One cannot afford having an element operating on its
network without knowing about it
If a NAC solution cannot perform complete element
detection in real-time then it does not provide a valuable
line of defense
No Knowledge == No Control == No Defense
No Element Detection == No NAC
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Multitude of Element Detection Methods
Listening to traffic
–
DHCP
–
Broadcast listeners
–
Out-of-band solutions
–
In-line devices
Through an integration with a switch
–
802.1x
–
SNMP traps
Software
–
Client-based software
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Multitude of Element Detection Methods
L2
L3
Switch
Software
Broadcast listeners
DHCP
802.1x
Agents
In line devices
In line devices
SNMP
traps
Out of band solutions
Out of band solutions
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Passive Element Detection
What you see is only what you get
–
A passive network discovery and monitoring solution cannot
draw conclusions about an element and/or its properties if the
related network traffic does not go through the monitoring point
No control over the pace of the discovery
–
One cannot force an element to send traffic (passively)
More information:
–
“Risks of passive network discovery systems”, Ofir Arkin, 2005.
Available from: http://sys-security.com/blog/published-
materials/papers/
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Passive Element Detection, L2 & L3 Example
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Passive Element Detection
Layer-3
–
Not real-time
•
You cannot expect an element to send traffic through the monitoring point
as soon as it is introduced to the network (or to send the type of traffic the
solution needs at all…)
–
Not complete
•
One cannot force an element to send traffic (passively)
–
An element can reside on the local subnet and not be detected
Layer-2
–
An element may reside on the local subnet and not be detected
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Issues with Element Detection L3 Example
THE GOAL
Intranet/Network
•     2.  User is redirected to a login page
•     3a.  Device is non compliant or login is incorrect
•     3b.  Device is “clean.”
Machine gets on “clean list”
and is granted access to network.
CCA Server validates username and
password.  Also performs device and network
scans to assess vulnerabilities on the device.
Cisco Clean Access Server
 Cisco Clean Access Manager
•     1.  End user attempts to access a web page or uses an optional client
Network access is blocked until end 
user provides login information.
Authentication
Server
User is denied access and assigned to a quarantine
role with access to online remediation resources.
Quarantine
Role
Cisco Clean Access
Agent (optional)
Source: Cisco Clean Access presentation
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Issues with Element Detection L3 Example
Branch A
Scenario:  1 Headquarters with 3,000 users & 10 Branches with 1,000 users total
Headquarters
BEFORE
AFTER
Branch B
Branch C
Data Center
Si
Si
Si
Si
etc.
Branch B
Branch A
etc.
Branch C
Data Center
Si
Si
Si
Si
12 pairs  3 pairs
Clean Access Servers
Source: Cisco Clean Access presentation
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Issues with Element Detection L2 Example
Intranet/Network
Broadcast
Listener
Broadcast traffic
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Issues with Element Detection L2 Example
Intranet/Network
Broadcast
Listener
(1) Unicast ARP request
(2) Unicast ARP reply
No knowledge regarding the existence of the element
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Issues with Element Detection L2 Example
Product: (Can one guess?)
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Other Element Detection Issues
Some element detection methods provides with poor
discovery capabilities
–
DHCP: Elements which do not use DHCP will not be
discovered
–
SNMP Traps: Elements connecting to switches which cannot
send SNMP traps in regards to new Source MAC registrations
will not be discovered
–
Client Software: Elements which cannot install the client-based
software will not be discovered
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Other Element Detection Issues
Most element detection methods will not discover
–
NAT enabled devices
–
NAT in progress
Virtualization makes a huge problem
–
Vmware
–
Xen
–
Parallels
–
Etc.
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Validation
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Validation
Validation is the process of authorizing devices to
operate on the Enterprise LAN and proving the identity
of their users (as users which belong to the organization
and allowed to use its network)
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Validation
The role of device authorization is to combat rogue
devices and to make sure that only authorized devices
operates on the Enterprise LAN
It must be tightly integrated with element detection
If a device is unauthorized, its access to the network
must be immediately blocked when it is being attached
to the network
Most NAC solutions will not authorize devices (some
would only authenticate users)
And nearly all NAC solutions are not able to perform
complete and real-time element detection
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Validation
Some NAC solutions would only mandate to prove the
identity of a user using a device on the network
Some other NAC solutions would not mandate user
authentication at all, or would support NAC scenarios
which user authentication will not be mandated
–
For example, with Cisco NAC Framework, two out of three
operational modes do not require user authentication
One may use a non-authorized device, with proper user
credentials and introduce a rogue device onto the
network…
–
In this case the consequences would be more sever (stealing a
user’s credentials)
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Validation Issues Example
THE GOAL
Intranet/Network
•     2.  User is redirected to a login page
•     3a.  Device is non compliant or login is incorrect
•     3b.  Device is “clean.”
Machine gets on “clean list”
and is granted access to network.
CCA Server validates username and
password.  Also performs device and network
scans to assess vulnerabilities on the device.
Cisco Clean Access Server
 Cisco Clean Access Manager
•     1.  End user attempts to access a web page or uses an optional client
Network access is blocked until end 
user provides login information.
Authentication
Server
User is denied access and assigned to a quarantine
role with access to online remediation resources.
Quarantine
Role
Cisco Clean Access
Agent (optional)
Source: Cisco Clean Access presentation
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Validation
Tying between a device and the user using the device
(and its location) creates a binding which is much
needed for stronger authentication, authorization, and
auditing
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Poor User Authentication Example
DHCP in a Box / Authenticated DHCP
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Poor User Authentication Example
DHCP in a Box / Authenticated DHCP
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
A Word About 802.1x
Just a username/password protocol and nothing more
then that
–
For other capabilities a client is required
Not a device authorization solution
–
The credentials used with 802.1x are in most cases the same
as the regular username/password pair used by a user to logon
to the Domain/machine
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Assessment
 © Ofir Arkin, 2006 - 2007
Ofir Arkin, kNAC!
Assessment
Assessment is the process of evaluating whether an