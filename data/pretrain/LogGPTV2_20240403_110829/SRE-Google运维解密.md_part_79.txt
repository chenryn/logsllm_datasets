系统的体系结构和跨服务依赖
发布协调工程团队（LCE）（参
SRE参与模型
385
444
---
## Page 428
445
名SRE，或者是由SRE自我提名来负责PRR过程。该小组负责与研发团队启动讨论。
SRE管理层首先需要决定具体由哪个SRE团队接管服务最合适。通常管理层会选择1~3
PRR流程包含以下几个阶段，和研发生命周期很像，但是这里它可以与研发周期并行进
在必要的改进全部实施之后，SRE认为该服务已经“准备好”之后，一个SRE团队会接
PRR：简单PRR模型
同时可以被合理运维，有必要进行长期性的SRE参与。
大困难，同时这些服务对用户来说又越来越重要。因此，为了确保这些服务不断发展的
够的：
对于一个给定的系统有非常深刻的理解。所以，对于某些研发团队而言，这种咨询是不
386
该讨论涵盖以下事项：
参与
3
我们将首先描述简单PRR模型，这通常是针对已经推出并且即将由SRE团队接管的服务。
接下来，我们会讨论PRR评审流程本身。一共有三个不同但是相关的参与模型，它们是
管所有的生产运维职责。
的目标如下：
人力资源来促成这一支持，那么SRE会与研发团队一起启动PRR评审流程。PRR评审
前团队的可用性。如果该服务的确值得SRE支持，并且SRE团队和研发团队同意调动
当SRE接到来自研发团队的生产运维接管要求时，
上述这些类型的服务可能已经发展到了一个转折点，这时它们会开始在运维过程遭遇重
·验证该服务符合公认的标准的生产部署方式和运维方式，同时该服务负责人已经
·某个服务发布之后，逐渐被许多其他的服务所依赖。流量有明显增长，同时这些
准备好与SRE一起工作，利用SRE的知识改进服务。
过仅仅阅读文档以及简单的咨询来解决问题，必须投入更多的时间来仔细了解。
某个服务自发布到现在，已经进行了数个数量级的增长。该服务现在已经不能通
会关注SRE所关注的生产环境的所有方面。
提升服务生产环境中的可靠性，并最小化可预见的故障的数量和严重程度。PRR
流量来自许多不同的客户。
第32章SRE参与模式的演进历程
他们需要评估该服务的重要程度和目
---
## Page 429
上文的分析阶段会形成一系列对于该服务改进的建议。下一阶段按如下顺序进行
改进和重构
有良好的运维操控性。
的待办事项。这个评估过程可以评估该服务对紧急事件响应的需求程度，以及其是否具
与SRE工具结合。SRE同时也会查看最近事故与对应的事后总结，包括事后总结中列出
善的但是没有遵循该SRE团队的“黄金标准”的服务配置，可能需要重构，以便更好地
该检查列表可能还会包括该SRE团队所遵循的运维标准和最佳实践。例如，
检查列表中的项目可能包括：
些组件更有经验，或者是对被依赖服务有运维经验的其他SRE团队进行咨询。
类似系统的经验，加上“生产指南”中的最佳实践得出的。SRE团队同时也可以向对某
查列表。该检查列表是针对该服务特别制定的，一般是基于领域专业知识，以及相关或
保遵循生产环境的最佳实践。通常，SRE会在这个阶段专门建立以及维护一个PRR检
以及SRE最关注的运维方面的情况。他们还会审阅服务的设计文档以及具体实现，以确
知识，开始对其生产方面的缺陷进行分析。SRE的目标是度量该服务自身的成熟程度，
工作中的第一个较大阶段是分析。在这个阶段中，SRE评审者将仔细学习该服务的一切
分析
该流程的目标是对PPR 流程、最终目标，以及结果形成一个共识。
·所有用户可见的请求失败情况都有度量和监控吗？报警策略是否合适？
SRE和产品研发团队同时参与，并且协助对方进行重构，或者实现额外的功能。
·将每个改进建议按照其对服务可靠度的影响而排序，制定一个优先级顺序。
该服务是否会将错误报告传送到中央日志记录系统进行分析？该服务是否报告所
）对于服务进行的更新是否立刻影响到系统中大比例的部分？是否合理？
）制定交接计划和培训计划。
与研发团队讨论和协商这些建议，达成一个共识。
为可能的、为了提高可靠性的破坏性设计变更制定计划。
有的会造成降级回复，或者会造成最终用户请求失败的特殊情况？
该服务在连接关键的远程服务时，是否需要较高的网络服务质量（QoS）？
服务的依赖是否合理？例如，直接面向用户请求的服务不应该依赖于一个主要用
为该服务建立一个SLO/SLA。
于批处理的系统。
PRR:简单PRR模型
一个功能完
|387
446
---
## Page 430
447
服务生产运维的责任通常是由整个SRE团队共同承担的。为了确保整个团队都有所准备，
培训
388
持续改进
SRE团队将继续专注于之前提到的生产的各个领域。为了保障交接彻底完成，研发团队
所有权逐步转移给SRE，其中包括部分的运维操作、变更管理流程以及访问权限控制等。
“接手”服务
当培训结束时，SRE团队应该已经做好接管服务的准备了。
般来说，通过研发团队的帮助和参与，这些SRE会组织一系列的培训课程和练习。其中
领导PRR的SRE评审者负责对团队的培训，这还包括整理运维服务所必需的文档。一
的时间，评估该服务成熟度和复杂度的时间，以及无数的其他因素。
此阶段所需要的时间和资源在各个项目上有很大不同。这主要取决于工程师花在重构上
档中。
见。这些运维经验同时会形成一系列的最佳实践，这些会记录在“生产指南”和其他文
专业知识会分享给研发团队，形成对新功能、新组件和新的依赖关系加入时的建议和意
总结，以及对于根源问题的分析，该SRE团队自然而然地会对服务了解更加深人。这种
可靠性标准。随着平时的生产运维，新变更的评审，紧急事件的处理，特别是书写事后
依赖，技术升级和其他各种因素。SRE团队必须在面对这种持续改动的同时维持服务的
活跃的服务会根据新的需求和条件持续变化，包括用户请求的新功能，不断变化的系统
作的基础。
必须在这段时间内给予SRE团队后备支援与各种建议。这种关系将成为团队之间未来工
培训阶段之后，SRE团队进入具体的“接手”阶段。该阶段涉及将各种生产运维职责和
包括：
）对系统运维各个方面的手动练习
对系统中各种请求的处理流进行深入探讨
设计概述
生产环境部署模式的描述
第32章SRE参与模式的演进历程
---
## Page 431
特点：
将来会有足够的规模或复杂性，以从SRE的专业知识中受益。适用的服务往往具有以下
型需要在研发周期的早期就确定服务的重要性和／或商业价值。还需要确定该服务是否
早期参与模型通过在开发周期的早期引入SRE来实现显著的额外优势。应用早期参与模
早期参与模型的适用对象
成功率都有可能提高。
服务中潜在问题的机会将显著增加。这样一来，SRE参与的成功率以及服务自身未来的
参与是在生命周期的后期才进行的。如果PRR发生在服务生命周期的早期，SRE修复
然而，PRR模型的主要限制来源于这样一个事实：服务已经发布，已经规模化，SRE的
入发布阶段的服务。该模型同时还有很多限制和对应的成本。例如：
到目前为止，
简单PRR模型的演进：早期参与模型
破坏）。
与SRE充分讨论，这样确保未来新的发布更平稳（然而墨菲定律总是寻找机会搞
即将到来的大规模维护活动或者集群离线情况。同时，有关服务的未来计划也会
开发者同时也会参与每周一次的on-call会议，讨论上周遇到的问题以及如何处理
后，SRE接过了该服务的on-call职责，但是同时还有两个开发者参与运维轮值。
·该服务实现了一个显著的新功能，并将成为一个现存的SRE运维的系统的一部分。
是该服务的监控台页面漏掉了一些SLO指标，需要修复。在全部问题都被修复以
由于该产品已经上线，所以SRE启动了PRR评审流程。评审中发现的一个问题
应。然而，随着服务用量的上升和服务收入的增长，该服务开始需要SRE的支持。
一开始，莎士比亚搜索服务的研发人员对产品直接负责，包括对紧急事件进行响
·SRE所做的工作必须是高度可见的，同时能够被研发团队充分评审，以确保知识
·团队之间的额外沟通会增加开发团队的开销，同时对SRE评审者也造成了一定
的共享。SRE实际上应该作为开发团队的一部分工作，而不是作为外部单元参与
进PRR流程。
合适的SRE评审者很关键，他们必须有时间参与，并且能够在现有事务之外推
的认知负担。
我们刚刚讨论了PRR流程在简单PRR模型中的应用
参与“莎士比亚”项目
简单PRR模型的演进：早期参与模型
这仅适用于已经进
389
449
448
---
## Page 432
450
390
更改，这会打乱研发团队对于未来功能的计划。
之后的发展势头。发布过程中出现的问题会很容易地导致对于源代码和生产环境的紧急
后遇到问题的风险。发布过程中的平稳有助于保持运维负载很低，同时可以维持在发布
的做法可以让团队获得运维知识，在不影响现有用户的情况下解决问题，并减少在发布
中的响应是“隐形”的，因为它们会被直接抛弃而不会实际显示给用户。这种“隐形发布”
形发布”机制，将现有用户流量的一部分复制发送给新服务，不影响生产服务。新服务
SRE还可以帮助实现广泛使用的发布模式和控制系统。例如，SRE可以帮助实现一种“隐
发布
来运维操作更便利，同时允许SRE在发布之前就获得运维经验。
和优化具体实现，或者直接帮助构建某些控制系统。SRE在这个阶段的参与有助于使未
资源的使用率和效率等。在这个阶段，SRE可以通过建议使用现存的类库和组件来影响
构建阶段涉及生产中的很多方面，例如指标选择与度量，运维和紧急事件中的控制功能
构建和实现
目标是最小化服务进入生产后出现的设计分歧。
与，SRE可以从一开始就了解这种权衡取舍，同时成为决策的一部分。早期SRE介入的
偶尔，艰难的权衡取舍导致研发团队选择了一个不太理想的设计。通过在设计阶段的参
好的生产事故是那些从来没有发生过的事故！
周期中，设计决策可以被逆转或纠正，但这样的变更所需要的成本和复杂性都很高。最
在设计阶段与SRE的合作可以预防未来很多类型的问题或事故的发生。虽然在开发生命
设计阶段
于整个服务生命周期，而非后期的方式也产生了很大的益处。
虽然早期参与模式的确带来了一定的风险和困难，但这种将SRE专家的经验和协作应用
早期参与模型的优势
者其后的任何一个阶段接管。该模型是基于研发团队和SRE团队之间的积极合作建立的。
是改善生产质量的手段不同。SRE会参与设计和后面的各阶段，最终在“构建”阶段或
早期参与模型本质上就是将SRE尽早投入到研发过程中。SRE关注的焦点仍然不变，只
·研发团队曾经寻求过SRE的建议，或在发布之后就需要SRE接管。
该服务是一个针对现有系统的大幅重写或者替代品，服务目标一致。
第32章SRE参与模式的演进历程
---
## Page 433
经验教训
不断发展的服务：框架和SRE平台