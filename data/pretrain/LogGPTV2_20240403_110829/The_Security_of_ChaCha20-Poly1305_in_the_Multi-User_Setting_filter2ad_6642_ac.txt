ğ‘Ÿ âˆ¥ğ‘  â† Poly1305_Key_Gen(ğ¾, ğ‘)
1 :
2 : ğ‘‡â€² â† Poly1305_Mac((ğ‘Ÿ, ğ‘ ), ğ´ğ·, ğ¶)
3 :
4 :
procedure ChaCha20(ğ¾, ğ‘ , ğ‘€)
1 : ğ‘€1âˆ¥ Â· Â· Â· âˆ¥ğ‘€â„“ â† ğ‘€
for ğ‘– = 1 to â„“ âˆ’ 1 do
2 :
3 :
4 : ğ‘â„“ â† ğ‘€â„“ âŠ• trunc(CC_block(ğ¾, ğ‘ , â„“), |ğ‘€â„“ |)
5 :
procedure Poly1305_Key_Gen(ğ¾, ğ‘)
return trunc(CC_block(ğ¾, ğ‘ , 0), 2ğ‘¡)
1 :
procedure Poly1305_Mac((ğ‘Ÿ, ğ‘ ), ğ´ğ·, ğ¶)
1 :
ğ‘ğ‘– â† ğ‘€ğ‘– âŠ• CC_block(ğ¾, ğ‘ , ğ‘–)
return ğ‘1âˆ¥ Â· Â· Â· âˆ¥ğ‘â„“
return ğ»ğ‘Ÿ (ğ´ğ·, ğ¶) (ğ‘¡)+ ğ‘ 
Figure 3: Pseudocode description of ChaCha20-Poly1305.
is outlined in Definition 3.1 and its security is stated in Theorem
3.2, reproduced here from [5] for completeness.
Definition 3.1 (The Hash Function ğ» in Poly1305). Let ğ‘¡ be a
positive integer multiple of 8, let ğ‘ â‰¥ 2ğ‘¡+1 be a prime, let ğ‘Ÿ be a ğ‘¡-bit
string and let ğ‘€ be any byte string. Parse ğ‘€ as ğ‘€ = ğ‘€1âˆ¥ Â· Â· Â· âˆ¥ğ‘€â„“
where |ğ‘€ğ‘–| = ğ‘¡ for ğ‘–  0 and ğ‘¡ > 1
(2) ğ‘š =(cid:6)logğ‘¡ (ğµâˆ’1) +(cid:101)ğ‘š(cid:7) and ğ‘„ â‰¤ logğ‘¡ (ğµâˆ’1)+(cid:101)ğ‘š
(3) ğ‘š = âŒˆğ‘„ğµğ‘¡eâŒ‰ and ğ‘„ â‰¥ logğ‘¡ (ğµâˆ’1)+(cid:101)ğ‘š
(cid:109)
most ğ‘¡âˆ’(cid:101)ğ‘š.
(cid:108) logğ‘¡ (ğµâˆ’1)+(cid:101)ğ‘š
(cid:108) max(ğ‘„ğµğ‘¡e,logğ‘¡ (ğµâˆ’1)+(cid:101)ğ‘š)
the probability that the heaviest bin contains ğ‘š balls or more is at
max(1,logğ‘¡ ((ğ‘„ğµ)âˆ’1))
and ğ‘„ â‰¤ 1
ğµ ,
logğ‘¡ ((ğ‘„ğµ)âˆ’1)
(4) ğ‘š =
(1) ğ‘š =
ğµğ‘¡e
,
ğµğ‘¡e
,
,
The proof can be found in Appendix A. Compared to prior re-
sults, the first advantage of this theorem is its generality as it allows
more freedom in selecting parameters. Case 4 yields the best bound,
giving the smallest maximum load ğ‘š for a fixed maximum proba-
of balls ğ‘„. Moreover, Cases 1, 2 and 3 can be derived as subcases of
Case 4.
bility bound ğ‘¡âˆ’(cid:101)ğ‘š, and has no restrictions on the maximum number
troducing a trade-off parameter(cid:101)ğ‘š between the maximum load and
In comparison to the biased balls-into-bins lemmas of Bose,
Hoang, and Tessaro, Case 1 improves over [10, Lemma 10] by in-
the probability bound instead of a fixed probability bound. This is
essentially what allows us to lift the restrictive term of 2âˆ’48 in the
bound for nonce-randomized GCM (cf. Sections 7.2 and 7.3).
In combination, Cases 2 and 3 are roughly equivalent to [10,
Lemma 11]. While the latter allows for an unrestricted number
of balls, it yields a looser bound than [10, Lemma 10] when the
number of balls is small. Thus, when applying the lemmas of [10],
one has to choose between a good bound over a restricted range of
ğ‘„, or a suboptimal bound extending over a larger range of ğ‘„. Case 4
improves over both lemmas in [10] by combining their advantages
in a single expression while additionally retaining the improvement
from Case 1. We employ this improved bound in our multi-user
security proof, though Lemma B.1, when bounding the probabilities
of bad transcripts in Appendix B.2.
6 THE MULTI-USER SECURITY OF
CHACHA20-POLY1305
The following theorem bounds the multi-user security of ChaCha20
-Poly1305 in the ideal permutation model, i.e., when the ChaCha20
permutation is assumed to be a random permutation. This allows
us to capture the local computation of the adversary expressed
as the number of offline queries that it makes to the ChaCha20
permutation.
Theorem 6.1 (Multi-user Security of ChaCha20-Poly1305).
Let ChaCha20-Poly1305[ğœ‹] be the AEAD scheme described in Fig-
ure 3 having parameters ğ‘›, ğ‘˜, ğ‘¡, ğ‘ with its underlying permutation ğœ‹
modelled as a random permutation. Let A be a ğ‘‘-repeating adversary
making at most ğ‘ ideal permutation queries, ğ‘ğ‘’ encryption queries to-
taling at most ğœğ‘’ encrypted blocks, and ğ‘ğ‘£ verification queries. Further,
let â„“ğ‘š denote the maximum size in ğ‘¡-bit blocks (including associated
data) that it is allowed to query to its encryption and verification
oracles. Then:
Adv
muAE
+ ğ‘‘(ğ‘ + ğ‘ğ‘’)
ChaCha20-Poly1305[ğœ‹](A) â‰¤ ğ‘ğ‘£(ğ‘â„“ğ‘š + 3)
2ğ‘¡
2ğ‘˜
+ 2ğ‘ Â· (ğ‘› âˆ’ ğ‘˜)
+ (ğœğ‘’ + ğ‘ğ‘’)2
1
22ğ‘¡âˆ’2 +
+
2ğ‘›+1
Â· 2ğ‘›âˆ’ğ‘˜(cid:17)
ğ‘ğ‘£ â‰¤ 2ğ‘›âˆ’2, ğ‘ â‰¤ min(cid:16) 2ğ‘¡âˆ’1
In the above we further require that: ğ‘› âˆ’ ğ‘˜ â‰¤ 2ğ‘˜âˆ’2, ğœğ‘’ â‰¤ ğ‘›âˆ’ğ‘˜
6
, and ğ‘‘ â‰¤ 2ğ‘¡
3 Â· 22ğ‘¡ .
+ 2ğ‘ğ‘£ Â· (ğ‘› âˆ’ ğ‘˜ + 4ğ‘¡)
Â· 22ğ‘¡ , ğ‘›âˆ’ğ‘˜âˆ’1
2ğ‘˜
2ğ‘˜
1
6
6
2ğ‘›âˆ’ğ‘˜âˆ’2 .