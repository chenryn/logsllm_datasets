title:Just the Tip of the Iceberg: Internet-Scale Exploitation of Routers
for Cryptojacking
author:Hugo L. J. Bijmans and
Tim M. Booij and
Christian Doerr
Just the Tip of the Iceberg:
Internet-Scale Exploitation of Routers for Cryptojacking
Hugo L.J. Bijmans, Tim M. Booij and Christian Doerr
Delft University of Technology, Cyber Security Group
2628CD Delft, The Netherlands
{h.l.j.bijmans@student.,t.m.booij@student.,c.doerr@}tudelft.nl
ABSTRACT
The release of an efficient browser-based cryptominer, as introduced
by Coinhive in 2017, has quickly spread throughout the web either
as a new source of revenue for websites or exploited within the
context of hacks and malicious advertisements. Several studies have
analyzed the Alexa Top 1M and found 380 – 3,200 [5, 15, 18, 30, 31]
(0.038% – 0.32%) to be actively mining, with an estimated $41,000
per month revenue for the top 10 perpetrators [18]. While placing
a cryptominer on a popular website supplies considerable returns
from its visitors’ web browsers, it only generates revenue while
a client is visiting the page. Even though large popular websites
attract millions of visitors, the relatively low number of exploiting
websites limits the total revenue that can be made.
In this paper, we report on a new attack vector that drastically
overshadows all existing cryptojacking activity discovered to date.
Through a firmware vulnerability in MikroTik routers, cyber crimi-
nals are able to rewrite outgoing user traffic and embed cryptomin-
ing code in every outgoing web connection. Thus, every web page
visited by any user behind an infected router would mine to profit
the criminals. Based on NetFlows recorded in a Tier 1 network,
semiweekly crawls and telescope traffic, we followed their activi-
ties over a period of 10 months, and report on the modus operandi
and coordinating infrastructure of the perpetrators, which were
during this period in control of up to 1.4M routers, approximately
70% of all MikroTik devices deployed worldwide. We observed dif-
ferent levels of sophistication among adversaries, ranging from
individual installations to campaigns involving large numbers of
routers. Our results show that cryptojacking through MITM attacks
is highly lucrative, a factor of 30 more than previous attack vectors.
KEYWORDS
cryptojacking; MikroTik; router; MITM; cyber threat intelligence
ACM Reference Format:
Hugo L.J. Bijmans, Tim M. Booij and Christian Doerr. 2019. Just the Tip of
the Iceberg: Internet-Scale Exploitation of Routers for Cryptojacking. In
2019 ACM SIGSAC Conference on Computer& Communications Security (CCS
’19), November 11–15, 2019, London, United Kingdom. ACM, New York, NY,
USA, 16 pages. https://doi.org/10.1145/3319535.3354230
Permission to make digital or hard copies of all or part of this work for personal or
classroom use is granted without fee provided that copies are not made or distributed
for profit or commercial advantage and that copies bear this notice and the full citation
on the first page. Copyrights for components of this work owned by others than ACM
must be honored. Abstracting with credit is permitted. To copy otherwise, or republish,
to post on servers or to redistribute to lists, requires prior specific permission and/or a
fee. Request permissions from permissions@acm.org.
CCS ’19, November 11–15, 2019, London, United Kingdom
© 2019 Association for Computing Machinery.
ACM ISBN 978-1-4503-6747-9/19/11...$15.00
https://doi.org/10.1145/3319535.3354230
1 INTRODUCTION
Cryptocurrencies, which started with the release of Bitcoin in
2009 [24], represent monetary value secured by a blockchain. Trans-
actions are permanently stored in an ever growing list of records,
where transaction data can be added by solving a cryptographic
challenge. This puzzle is dependent on the last block, the current
transactions and their recipients, and once solved a new record
gets inserted into the chain consolidating the record of previously
conducted activities. Users are incentivized to participate and do-
nate computational resources to the system, as the one solving the
puzzle gets a (fraction of a) cryptocurrency unit as reward.
As the Bitcoin blockchain was designed to continuously increase
the difficulty of these challenges, Bitcoin mining is no longer prof-
itable on regular PCs, now requiring specialized hardware such as
ASICs. As a result, thousands of other cryptocurrencies, so-called
alt-coins, have emerged that replace the proof-of-work algorithm
of Bitcoin with alternative mechanisms to validate transactions.
The Monero cryptocurrency [39], which uses a private blockchain
with transactions not publicly visible, relies on the CryptoNight
algorithm, a memory-intensive computation of subsequent reads
and writes that can be efficiently run using the processor-level
cache found in typical consumer-grade CPUs.
The reward that can be gained from these alt-coins has however
also attracted the attention of cyber criminals, who have distributed
cryptomining code through malware or as part of botnet instal-
lations [28]. With the recent introduction of a JavaScript miner
by Coinhive in 2017, cryptomining code can now be shipped as
part of a web page and be efficiently executed by a web browser,
thereby providing an easy, scalable and low-effort method to roll
out cryptomining to a large user population. This has led to new
business and revenue models, for example replacing advertisements
by letting website visitors donate computational resources [40].
The relative ease with which website visitors can be recruited for
cryptomining has also led to a major surge in illicit cryptomining,
so-called cryptojacking or drive-by mining, in which the visitor’s
resources are hijacked without knowledge and consent. Aside from
cryptojacking that is initiated by the website owner without their
visitors’ consent, criminals also seek to increase their revenue by
compromising websites to install mining code [6, 20], as well as
hiding miners in third party software used by web masters and
thus inadvertently being deployed [2, 8, 42]. Cryptojacking is also
spread through exploitable vulnerabilities in content management
systems [23], through the distribution of advertisements including
malicious code [22] or through malware [28]. Previous work by
Konoth et al. estimate that cryptojacking possibly yields monthly
revenues of $41,000 for the 10 most successful perpetrators across
the Alexa Top 1M [18].
In this paper, we will analyze a previously unseen attack vector for
cryptojacking, namely man-in-the-middle attacks launched through
compromised consumer and edge routers that inject mining code
into every web page requested by their users. This was made possi-
ble by a firmware vulnerability in MikroTik routers discovered in
early 2018 [26], which allowed adversaries to change the device con-
figuration and create an outgoing HTTP proxy, and that remained
widely unpatched until a year later. By following reconnaissance
scans of the perpetrators through a large network telescope, the
detection of compromised routers through semiweekly crawls, and
the tracing of connection patterns of adversaries, their supporting
infrastructure and the compromised routers based on NetFlows
from a Tier 1 operator, we are able to provide a comprehensive
insight into how this vulnerability scaled out into massive crypto-
jacking campaigns that drastically overshadow previous mining
activities. In this work, we make the following four contributions:
• We are first to investigate a new type of attack that exploits
Internet infrastructure for cryptomining, and show how over
a period of 10 months after the initial discovery of the vul-
nerability groups of criminals launch massive campaigns to
control 1.4M routers, with a peak of 460,618 simultaneously
infected routers.
• We have analyzed adversarial tactics and unveil the support-
ing infrastructure used within the campaigns, and are able
to show differences between groups in how they locate their
victims, compromise routers, and run their infrastructure.
• We demonstrate that previously reported vectors are neg-
ligibly small in number of affected users and created rev-
enue, compared to the reported MITM attack. We find that
this attack yielded monthly revenues, estimated exceeding
$1,200,000 per month for the top 10 grossing accounts, a
factor of 30 larger than previously estimated cryptojacking
revenues from hacked websites, malicious advertisements
and website-owner initiated mining combined.
• We have observed high levels of sophistication in three iden-
tified campaigns, of which the largest involved 40 mining
accounts linked to one single actor.
The remainder of the paper will be structured as follows: Section 2
provides an overview of related work. Section 3 introduces the
concept of cryptojacking and previously used modus operandi, and
describes the vulnerability and its exploitation used for a MITM-
based cryptojacking on routers. Section 4 describes the datasets
used in this study. Section 5 presents the techniques, tactics and
procedures in use during the identification, exploitation, moneti-
zation and maintenance of the compromised systems. Section 6
puts the techniques and sophistication levels of the ecosystem into
perspective and quantifies adversarial revenues. Finally, Section 7
summarizes and concludes our work.
2 RELATED WORK
The growing interest in cryptojacking by cyber criminals was fol-
lowed by an interest of the academic world to research this new
phenomenon. Only shortly after the release of the Coinhive miner
in September 2017, Eskandari et al. made the first explorations
into the field by searching source code databases Censys.io and Pub-
licWWW for strings known to be part of cryptomining libraries [12].
Due to the possibilities of JavaScript obfuscation and other hiding
techniques, other research that followed soon focused on detection
of these mining applications. Rauchberger et al. built Mininghunter,
a crawler instructed to analyze both source code and WebSocket
traffic of the visited pages [30]. A crawl of the Alexa Top 1M re-
sulted in the identification of 3,178 cryptojacking websites and the
discovery of a number of campaigns. Other web crawling studies
performed by Parra Rodriguez & Posegga [31] and Carlin et al. [5]
used machine learning techniques to determine active mining on a
web page while crawling, and both reached high precision scores.
The CMTracker made by Hong et al. [15] also crawls the web, but
detects cryptojacking behavior based upon periodic executions in
WebAssembly modules. This robust detection method was able to
identify 868 actively mining websites in the Alexa Top 100K. Wang
et al. performed a similar study by learning a support vector ma-
chine (SVM) on the characteristics of WebAssembly modules and
concluded that analyzing WebAssembly modules is a very efficient
and robust detection method [41].
The latest web crawling studies involve the work of Rüth et al.,
who crawled the three largest top-level domains (.com, .net and .org)
as well as the Alexa Top 1M to estimate the prevalence of browser-
based cryptomining (0.08% of the probed websites were actively
mining) [32], Konoth et al., responsible for creating another crawler
which identified 1,735 actively mining websites and performed
campaign analysis to gain knowledge about the ecosystem [18], and
Kharraz et al. performing a similar study but identified the actively
cryptomining websites using machine learning techniques [17].
They also dedicated a section to campaign analysis, in which the
authors identified 35 campaigns involving a total of 386 websites.
The largest study to date across 55M websites discovered that the
prevalence of cryptojacking significantly varied by top-level domain
zone and the popularity of websites, and that about half of all
cryptojacking activity is organized and part of a campaign [2].
Initial evidence begins to suggest that exploitation of websites
for browser-based mining through their visitors might not gen-
erate the main source of revenue. Papadopoulos et al. concluded
that advertisements are still over five times more profitable than
browser-based cryptomining [27]. A longitudinal study performed
by Pastrana et al. revealed that in the cryptojacking ecosystem, only
a small number of cyber criminals is making large profits and those
making profits had mined 4.3% of all Monero in circulation. [28].
Previous studies have primarily focused on either detection or
the estimation of the compromised websites attack vector. While
cryptojacking as part of a man-in-the-middle (MITM) attack – for
example through a malicious WiFi network – is mentioned as being
feasible by Eskandari et al. [12], this particular attack vector has
never been researched before by the academic community. As a
MITM attack will affect all traffic that crosses a particular device,
the potential number of victims and with it potential revenue is
however much higher. This paper will thus address this gap, and
show how and to what extent cryptojacking is deployed in the wild
through the attack on Internet infrastructure.
3 BACKGROUND
The introduction of memory-bound cryptocurrencies like Mon-
ero allowed for new methods of cryptomining, one of them be-
ing browser-based cryptomining. These cryptocurrencies, together
with new web technologies such as WebAssembly (native speed
code execution within the browser sandbox), WebWorkers (separate
JavaScript instances), HTML5 WebSockets (simple multiplex TCP
connection) and the Stratum Mining Protocol (JSON-RPC format-
ted mining pool communications) paved the way for the creation
of an efficient browser-based cryptominer by Coinhive in 2017.
Their miner, and most other mining applications, work as follows:
the user visits a cryptojacking website which includes (a reference
to) a cryptojacking script. This script explores the host system,
downloads a highly optimized WebAssembly module for mining
and spawns a number of WebWorkers to run this module. Conse-
quently, it sets up a connection with a mining pool through a proxy
server operated by the service, authenticating using a siteKey or
(Monero) wallet address, which is essentially the account of the
adversary. For readability when we mention siteKeys in the paper,
we will refer to them by the first six characters of the key. The
mining pool distributes a job to work on, the WebWorkers start
mining and found hashes are submitted to the mining pool. When
the browser window is closed, all mining activity stops.
3.1 Past modus operandi of cryptojacking
As stated by a New Jersey Attorney General in 2015 [14], mining
cryptocurrencies with the computing power of others is not consid-
ered illegal when a clear notification of such activities is shown and
the possibility of opting-out exist. However, most cryptojacking
cases lack these and are therefore considered illegal. There have
been cryptojacking scripts found on malware infected PCs [28], but
since the release of the Coinhive miner, cryptojacking in the form
of browser-based mining gained enormous popularity. There is a
large number of websites running a cryptominer to increase their
revenues, such as The Pirate Bay [40], but cryptojacking has also oc-
curred on websites where the owner did not initiate it. Website com-
promises, such as government pages of the Indian government [6]
in 2018, have lead to cryptojacking infections, but cyber criminals
are constantly searching for more efficient methods to deploy their
miners. To spread an infection over a large number of websites,
attackers abused third party software (such as infecting WordPress
plugins [42] or exploiting Drupal CMS vulnerabilities [34]) with
cryptojacking scripts as well as injected advertisements with min-
ing code and served them through ad networks to websites unaware
of any infection [22].
3.2 Pervasive Cryptojacking through
Man-In-The-Middle Attacks
As mentioned in the previous section, cryptomining code is included
as part of the served HTML page, which requires the website owner
to explicitly install a cryptominer or inadvertently embed it due to a
compromised component. It is however also possible to modify the