测试方法    
```    
chmod 700 ./test_native.sh     
nohup ./test_native.sh >/dev/null 2>&1 &    
```    
5、阿里云版本测试脚本如下    
```    
vi test_aliyun.sh    
#!/bin/bash    
export PGHOST=/tmp    
export PGPORT=1999    
export PGUSER=postgres    
export PGDATABASE=postgres    
Y=32    
for ((i=1;i ./test_aliyun_$X.log 2>&1    
Y=X    
done    
psql -c "vacuum freeze"    
psql -c "checkpoint"    
./pgsql11/bin/pgbench -M prepared -n -r -P 3 -c 8192 -j 128 -T 600 > ./test_aliyun_8192.log 2>&1    
psql -c "vacuum freeze"    
psql -c "checkpoint"    
./pgsql11/bin/pgbench -M prepared -n -r -P 3 -c 16384 -j 256 -T 600 > ./test_aliyun_16384.log 2>&1    
```    
测试方法    
```    
chmod 700 ./test_aliyun.sh     
nohup ./test_aliyun.sh >/dev/null 2>&1 &    
```    
### unlogged table    
1、初始化    
```    
./pgsql11/bin/pgbench -i -s 5000 --unlogged-tables    
```    
2、修改数据库配置    
```    
vi $PGDATA/postgresql.conf    
synchronous_commit = off    
pg_ctl reload    
```    
3、测试同样的脚本    
## 性能对比    
[《logged table测试结果详细LOG下载》](20180505_07_doc_001.tar.bz2)    
[《unlogged table测试结果详细LOG下载》](20180505_07_doc_002.tar.bz2)    
### 1 logged table对比    
#### 1、TPS对比    
连接数 | 社区版本TPS | 阿里云版本TPS | 社区版本TPS(过滤首尾干扰值) | 阿里云版本TPS(过滤首尾干扰值)  
---|---|---|---|---    
64 | 69216 |   67853 | 无干扰 | 无干扰   
128 | 69211 |  65712 | 无干扰 | 无干扰   
256 | 62964 |  62775 | 无干扰 | 无干扰   
512 | 44595 |  53382 | 46141 | 54988   
1024 | 35055 | 44295 | 37022 | 48679   
2048 | 26791 | 38881 | 30327 | 44358   
4096 | 24218 | 26990 | 32023 | 39086   
8192 | 7064 |  24304 | 18611 | 34316   
16384 | 5046 | 12478 | 10020 | 29499   
**1.6万并发时，约3倍于社区版本。**  
#### 2、事务整体RT对比    
连接数 | 社区版本RT | 阿里云版本RT    
---|---|---    
64 | 0.923 ms | 0.941 ms    
128 | 1.839 ms | 1.936 ms    
256 | 4.010 ms | 4.021 ms    
512 | 11.151 ms | 9.269 ms    
1024 | 27.475 ms | 21.070 ms    
2048 | 67.295 ms | 46.063 ms    
4096 | 127.923 ms | 104.689 ms    
8192 | 999.236 ms | 239.466 ms    
16384 | 1594.185 ms | 577.913 ms    
#### 3、实际SQL RT对比    
连接数 | 社区版本RT | 阿里云版本RT    
---|---|---    
64 | 0.428 ms | 0.465 ms    
128 | 0.698 ms | 0.734 ms    
256 | 1.784 ms | 1.658 ms    
512 | 4.736 ms | 4.378 ms    
1024 | 11.082 ms | 8.664 ms    
2048 | 37.258 ms | 8.007 ms    
4096 | 65.486 ms | 7.395 ms    
8192 | 818.411 ms | 6.472 ms    
16384 | 1183.571 ms | 4.927 ms    
**1.6万连接时，真实SQL响应速度约240倍于社区版本。**    
#### 4、RT 标准方差对比    
连接数 | 社区版本RT DEV | 阿里云版本RT DEV    
---|---|---    
64 | 2.960 ms | 2.863 ms    
128 | 7.559 ms | 4.914 ms    
256 | 6.595 ms | 6.090 ms    
512 | 11.810 ms | 8.704 ms    
1024 | 30.656 ms | 46.411 ms    
2048 | 88.371 ms | 68.239 ms    
4096 | 183.815 ms | 140.255 ms    
8192 | 20114.612 ms | 345.584 ms    
16384 | 2404.222 ms | 1116.238 ms    
#### 5、建立完所有连接的耗时对比    
连接数 | 社区版本 | 阿里云版本    
---|---|---    
64 | 0 s | 0 s    
128 | 0 s | 0 s    
256 | 4.8 s | 5 s    
512 | 8.9 s | 11.3 s    
1024 | 18.5 s | 27.4 s    
2048 | 36.3 s | 37.8 s    
4096 | 73.5 s | 93.6 s    
8192 | 150.9 s | 168.6 s    
16384 | 306 s | 341.8 s    
#### 6、释放完所有连接的耗时对比    
连接数 | 社区版本 | 阿里云版本    
---|---|---    
64 | 0 s | 0 s    
128 | 0 s | 0 s    
256 | 0 s | 0 s    
512 | 0 s | 0 s    
1024 | 0 s | 0 s    
2048 | 0 s | 0 s    
4096 | 0 s | 0 s    
8192 | 594 s | 9 s    
16384 | 21 s | 24 s    
### 2 unlogged table对比    
#### 1、TPS对比    
连接数 | 社区版本TPS | 阿里云版本TPS | 社区版本TPS(过滤首尾干扰值) | 阿里云版本TPS(过滤首尾干扰值)  
---|---|---|---|---    
64 | 99086 | 95932 | 无干扰 | 无干扰    
128 | 86807 | 86719 | 无干扰 | 无干扰     
256 | 69805 | 74371 | 70766 | 75143   
512 | 49147 | 59423 | 50369 | 61153   
1024 | 42295 | 45883 | 44798 | 48910   
2048 | 32147 | 38698 | 36729 | 44552    
4096 | 23556 | 27604 | 31504 | 38334    
8192 | 17037 | 24524 | 22937 | 34553  
16384 | 196 | 12668 | 1943 | 30273  
#### 2、事务整体RT对比    
连接数 | 社区版本RT | 阿里云版本RT    
---|---|---    
64 | 0.644 ms | 0.666 ms    
128 | 1.466 ms | 1.466 ms    
256 | 3.617 ms | 3.391 ms     
512 | 10.115 ms | 8.343 ms     
1024 | 22.761 ms | 20.864 ms    
2048 | 55.771 ms | 45.903 ms    
4096 | 130.195 ms | 107.858 ms     
8192 | 356.904 ms | 239.312 ms    
16384 | 66640.630 ms | 570.207 ms    
#### 3、实际SQL RT对比    
连接数 | 社区版本RT | 阿里云版本RT    
---|---|---    
64 | 0.475 ms | 0.501 ms     
128 | 0.934 ms | 0.854 ms     
256 | 2.109 ms | 1.842 ms     
512 | 4.656 ms | 4.587 ms    
1024 | 9.837 ms | 8.69 ms    
2048 | 36.882 ms | 7.928 ms    
4096 | 67.513 ms | 7.522 ms    
8192 | 201.208 ms | 6.536 ms    
16384 | 65428.243 ms | 4.811 ms     
#### 4、RT 标准方差对比    
连接数 | 社区版本RT DEV | 阿里云版本RT DEV    
---|---|---    
64 | 2.941 ms | 1.767 ms     
128 | 4.445 ms | 2.763 ms     
256 | 5.515 ms | 2.775 ms    
512 | 11.424 ms | 4.447 ms    
1024 | 28.950 ms | 16.575 ms    
2048 | 87.051 ms | 52.400 ms    
4096 | 200.132 ms | 149.614 ms    
8192 | 403.771 ms | 358.461 ms    
16384 | 462277.689 ms | 1161.376 ms    
#### 5、建立完所有连接的耗时对比    
连接数 | 社区版本 | 阿里云版本    
---|---|---    
64 | 0 s | 0 s     
128 | 0 s | 0 s     
256 | 4.9 s | 5.3 s    
512 | 9.4 s | 10.2 s    
1024 | 18.5 s | 20.2 s    
2048 | 37.6 s | 40 s    
4096 | 75 s | 81.3 s    
8192 | 151.6 s | 168.4 s    
16384 | 312.1 s | 341.5 s    
#### 6、释放完所有连接的耗时对比    
连接数 | 社区版本 | 阿里云版本    
---|---|---    
64 | 0 s | 0 s     
128 | 0 s | 0 s    
256 | 0 s | 0 s    
512 | 0 s | 0 s    