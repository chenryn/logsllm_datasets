同等重要。
从攻击路径来看，分支机构的安全能力一般弱于总部，同时分支
机构和总部网络层面是相通的，并且在早期进行安全建设的时候往往
会默认对方的网络是可信的；在安全防护层面，总部一般仅仅对来自
分支机构的访问请求设置一些比较粗糙的访问控制措施。这些安全隐
患都会给攻击队留出机会，使攻击队可以从薄弱点进入，然后横向拓
展到总部的目标系统。
因此，防守队只有将总部和分支机构进行统一的安全规划和管
理，形成整体防御能力，才能有效开展实战攻防对抗。在整体防御能
力上，建议防守队开展如下工作。
1）互联网出入口统一管理。条件允许的情况下，应尽量上收分支
机构的互联网出入口。统一管理的好处是集中防御、节约成本、降低
风险。同时，在整体上开展互联网侧的各类风险排查，包括互联网未
知资产、敏感信息泄露、社工信息的清理等工作。
2）加强分支机构防御能力。如果无法实现分支机构的互联网出入
口统一管理，则让分支机构参考总部的安全体系建设完善其自身的防
御能力，避免让出入口成为安全中的短板。
3）全面统筹，协同防御。在准备阶段，应让分支机构配合总部开
展风险排查；在实战值守阶段，让分支机构与自己一起安全值守，并
配置适当的安全监控人员、安全分析处置人员，配合自己做好整体的
防御、攻击的应急处置等工作。
第二部分 蓝队视角下的防御体系突破
蓝队作为实战攻防演练中的攻击方，根据队员的不同攻击能力特
点组织攻击团队。队员们在网络攻击各阶段各司其职，采用适当的攻
击手段和攻击策略对目标系统展开网络攻击，最终获取目标网络和系
统的控制权限和数据，检验目标单位的网络安全防护能力。
本部分主要站在蓝队的角度，讲述网络实战攻防演练中攻击阶段
的划分、各阶段主要工作内容、攻击中主要使用的技术手段以及攻方
人员必备的技能，最后通过多个实战案例对攻击手段进行了直观展
示。
第2章 蓝队攻击的4个阶段
蓝队的攻击是一项系统的工作，整个攻击过程是有章可循、科学
合理的，涵盖了从前期准备、攻击实施到靶标控制的各个步骤和环
节。按照任务进度划分，一般可以将蓝队的工作分为4个阶段：准备工
作、目标网情搜集、外网纵向突破和内网横向拓展（见图2-1）。
图2-1 蓝队攻击的4个阶段
2.1 准备工作
实战攻防演练一般具有时间短、任务紧的特点，前期各项准备工
作是否充分是决定蓝队能否顺利完成攻击任务的关键因素。在一场实
战攻防演练开始前，蓝队主要会从工具、技能和队伍三方面来进行准
备（见图2-2）。
图2-2 蓝队准备工作
2.1.1 工具准备
在蓝队攻击任务中，各类工具的运用会贯穿始终，高质量的工具
往往能起到事半功倍的效果，极大提升蓝队的攻击效率。因为攻防演
练任务紧、时间有限，很多战机稍纵即逝，而现场临时对渗透工具进
行搜集匹配或调试往往会耽误宝贵的时间，甚至错过极佳的突破时
机，所以高质量的工具准备是蓝队攻击任务高效推进的有力保证。网
络实战攻防演练前，需要准备任务各环节会用到的工具，包括信息搜
集、扫描探测、口令爆破、漏洞利用、远程控制、Webshell管理、隧
道穿透、网络抓包分析和集成平台等各类工具。
1. 信息搜集工具
蓝队主要利用信息搜集工具搜集目标网络IP、域名等详细网络信
息，并利用搜集到的信息准确确定渗透攻击范围。常用的工具如下。
（1）Whois
Whois（音同“Who is”，非缩写）是用来查询域名的IP及所有者
等信息的传输协议。简单来说，Whois就是一个用来查询域名是否已经
被注册、注册域名详细信息（如域名所有人、域名注册商）的数据
库。通过Whois可实现对域名信息的查询。早期的Whois查询多以命令
列接口存在，现在出现了一些基于网页接口的简化线上查询工具，可
以一次向不同的数据库查询。APNIC（Asia-Pacific Network
Information Center，亚太互联网络信息中心），是全球五大区域性
因特网注册管理机构之一，负责亚太地区IP地址、ASN（自治域系统
号）的分配并管理一部分根域名服务器镜像。CNNIC（China Internet
Network Information Center，中国互联网络信息中心）是我国的域
名体系注册管理机构。APNIC和CNNIC均提供所辖范围内域名信息查询
的Whois服务。
（2）nslookup命令工具
nslookup是Windows系统中一个非常有用的命令解析工具，用于连
接DNS服务器、查询域名信息。它可以指定查询的类型，可以查到DNS
记录的生存时间，还可以指定使用哪个DNS服务器进行解释。在已安装
TCP/IP协议的电脑上均可以使用这个命令工具探测域名系统（DNS）基
础结构的信息。
（3）DIG命令工具
DIG（Domain Information Groper，域名信息搜索器）是Linux和
Unix环境下与Windows环境下的nslookup作用相似的域名查询命令工
具。DIG工具能够显示详细的DNS查询过程，是一个非常强大的DNS诊断
查询工具，具有设置灵活、输出清晰的特点。一般Linux和Unix系统都
已内置了该功能，而在Windows环境下只有nslookup工具，也可以考虑
安装和部署DIG工具。
（4）OneForAll子域名搜集工具
OneForAll是一款基于CPython开发的功能强大的子域收集工具，
具有全面的接口和模块支持，集成证书透明度、网络爬虫、常规检
查、DNS数据集、DNS查询与搜索引擎6个模块，支持各搜集模块多线程
调用，对搜集的子域结果自动去重，有较高的扫描效率，并且支持将
搜集结果以多种格式导出利用。
2. 扫描探测工具
蓝队主要利用扫描探测工具对目标Web应用系统、网络设备、终端
主机或服务器进行漏洞和薄弱点发现，为进一步利用扫描探测到的漏
洞实施渗透攻击做准备。网上公开、免费的扫描探测工具非常多，有
的蓝队还会自主开发扫描探测工具。比较有名的开源扫描探测工具有
以下几个。
（1）Nmap
Nmap（Network Mapper）是一款开放源代码的网络探测和安全审
核工具，具备对Windows、Linux、macOS等多个操作系统的良好兼容
性，功能包括在线主机探测（检测存活在网络上的主机）、端口服务
探测（检测主机上开放的端口和应用服务）、设备指纹探测（监测目
标系统类型和版本信息）和漏洞探测（借助Nmap脚本对目标脆弱性进
行扫描和检测）。Nmap扫描示例见图2-3。
图2-3 Nmap扫描示例
（2）Nessus
Nessus是一款功能强大、操作方便的网络系统安全扫描工具，号
称是“全球使用人数最多的系统漏洞扫描与分析软件，全世界超过75
000个组织在使用它”。Nessus采用集成技术帮助执行物理和虚拟设备
发现及软件安全审核，通过插件库实现功能拓展和最新漏洞补丁检
测，并提供对包括移动设备在内的广泛的网络资产覆盖和架构环境探
测。
（3）AWVS
AWVS（Acunetix Web Vulnerability Scanner）是一款知名的Web
网络漏洞扫描工具，利用网络爬虫原理来测试Web网站的安全性。AWVS
采用AcuSensor技术和自动化客户端脚本分析器实现业内最先进且深入
的SQL注入和跨站脚本测试，集成了HTTP Editor和HTTP Fuzzer等高级
渗透测试工具，允许对AJAX和Web 2.0应用程序进行安全性测试，支持
通过多线程高速扫描Web网络服务来检测流行安全漏洞。AWVS的扫描任
务界面如图2-4所示。
图2-4 AWVS扫描任务界面
（4）Dirsearch
Dirsearch是一款用Python开发的目录扫描工具，可对包括目录和
文件在内的网站Web页面结构进行扫描，进而搜集关于后台目录、后台
数据库、弱口令、安装包、网站源码和后台编辑器类型等敏感信息的
信息。
（5）Nikto
Nikto是一款开源的Web安全扫描工具，可对Web服务器进行全面的
多项安全测试，扫描指定主机的Web类型、主机名、目录、特定CGI漏
洞。Nikto使用Rain Forest Puppy的LibWhisker实现HTTP功能，并且
可以检查HTTP和HTTPS，同时支持基本的端口扫描以判定网页服务器是
否运行在其他开放端口上。
3. 口令爆破工具
口令意味着访问权限，是打开目标网络大门的钥匙。蓝队主要利
用口令爆破工具来完成对目标网络认证接口用户名和口令的穷尽破
解，以实现对目标网站后台、数据库、服务器、个人终端、邮箱等目
标的渗透控制。
（1）超级弱口令检查工具
超级弱口令检查工具（弱口令扫描检测）是可在Windows平台运行
的弱密码口令检测工具，支持批量多线程检查，可以快速检测弱密
码、弱密码账户、密码支持和用户名组合检查，从而大大提高检查成
功率，并且支持自定义服务。该工具目前支持SSH、RDP、Telnet、
MySQL、SQL Server、Oracle、FTP、MongoDB、Memcached、
PostgreSQL、SMTP、SMTP_SSL、POP3、POP3_SSL、IMAP、IMAP_SSL、
SVN、VNC、Redis等服务的弱密码检查爆破（见图2-5）。
图2-5 超级弱口令检查工具
（2）Medusa
Medusa是Kali Linux系统下对登录服务进行暴力破解的工具，基
于多线程并行可同时对多个主机、服务器进行用户名或密码强力爆
破，以尝试获取远程验证服务访问权限。Medusa支持大部分允许远程
登录的服务，包括FTP、HTTP、SSH v2、SQL Server、MySQL、SMB、
SMTP、SNMP、SVN、Telnet、VNC、AFP、CVS、IMAP、NCP、NNTP、
POP3、PostgreSQL、rlogin、rsh等（见图2-6）。
图2-6 Medusa可爆破种类列表