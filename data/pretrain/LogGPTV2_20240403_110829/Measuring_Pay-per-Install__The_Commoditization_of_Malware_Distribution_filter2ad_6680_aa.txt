title:Measuring Pay-per-Install: The Commoditization of Malware Distribution
author:Juan Caballero and
Chris Grier and
Christian Kreibich and
Vern Paxson
Measuring Pay-per-Install: The Commoditization of Malware Distribution
Juan Caballero†, Chris Grier∗‡, Christian Kreibich∗‡, Vern Paxson∗‡
∗UC Berkeley
‡ICSI
†IMDEA Software Institute
PI:EMAIL {grier, vern}@cs.berkeley.edu PI:EMAIL
Abstract
Recent years have seen extensive diversiﬁcation of the
“underground economy” associated with malware and the
subversion of Internet-connected systems.
This trend to-
wards specialization has compelling forces driving it: mis-
creants readily apprehend that tackling the entire value-chain
from malware creation to monetization in the presence of
ever-evolving countermeasures poses a daunting task requir-
ing highly developed skills and resources. As a result,
entrepreneurial-minded miscreants have formed pay-per-install
(PPI) services—specialized organizations that focus on the in-
fection of victims’ systems.
In this work we perform a measurement study of the PPI
market by inﬁltrating four PPI services. We develop infrastruc-
ture that enables us to interact with PPI services and gather and
classify the resulting malware executables distributed by the
services. Using our infrastructure, we harvested over a million
client executables using vantage points spread across 15 coun-
tries. We ﬁnd that of the world’s top 20 most prevalent fami-
lies of malware, 12 employ PPI services to buy infections. In
addition we analyze the targeting of speciﬁc countries by PPI
clients, the repacking of executables to evade detection, and the
duration of malware distribution.
1
Introduction
Recent years have seen extensive diversiﬁcation of the
“underground economy” associated with malware and
the subversion of Internet-connected systems. This trend
towards specialization has compelling forces driving it:
miscreants readily apprehend that tackling the entire
value-chain from malware creation to monetization in
the presence of ever-evolving countermeasures poses a
daunting task requiring highly developed skills and re-
sources. As a result, market forces foster a service cul-
ture that has brought about a wide range of specialized
providers for all stages in the malware-monetization life-
cycle, such as malware toolkits [3, 15], packing tools to
evade antivirus (AV) software [21], “bullet-proof” host-
ing [4], and forums for buying and selling ill-gotten
gains [10].
At the heart of this ecosystem lies the infection of vic-
tim computers. Virtually every enterprise in this market
ultimately hinges on access to compromised systems. To
meet the demands for wholesale infection of Internet sys-
tems, a service called pay-per-install (PPI) has risen to
predominance. Such PPI services play a key role in the
modern malware marketplace by providing a means for
miscreants to outsource the global dissemination of their
malware. Miscreants simply determine the raw number
of victim systems (including speciﬁc geographical distri-
bution, if desired) that ﬁts within their budget, supply a
PPI service with payment and malware executables of the
miscreants’ choice, and in short order their malware is in-
stalled on thousands of new systems. In today’s market,
the entire process costs pennies per target host—cheap
enough for botmasters to simply rebuild their ranks from
scratch in the face of defenders launching extensive, en-
ergetic, take-down efforts [6].
In this work we perform a measurement study of the
PPI market by inﬁltrating four PPI services. We develop
infrastructure that enables us to (1) interact with PPI ser-
vices by mimicking the protocol interactions they ex-
pect to receive from afﬁliates with whom they have con-
tracted, and (2) gather and classify the resulting malware
executables as distributed by the PPI services. We report
results of inﬁltrations we conducted in the six months
between August 2010 and February 2011.
To our knowledge, our work reﬂects the ﬁrst system-
atic study of the PPI ecosystem as seen from the perspec-
tive of the downloads pushed out by PPI services down
to their victims. Security analysts have previously exam-
ined PPI services in a top-down manner, by becoming
afﬁliates of particular services [7, 29]. Our study is in-
stead based on inﬁltrating PPI services in a bottom-up
manner, by creating custom programs that can continu-
ously download malware specimens that the PPI services
distribute, enabling us to track the inﬁltrated PPI services
over time.
We harvested over a million client executables us-
ing vantage points spread across 15 countries. The
month of August 2010 yielded 57 malware families, in-
cluding many of the most prevalent infections at the
time. They include spam bots (Rustock, Grum), fake
antivirus (Securitysuite, Securityessential), information-
stealing trojans (Zbot, Spyeye), rootkits (Tdss), DDoS
bots (Russkill, Canahom), clickers (Gleishug), and ad-
ware (SmartAdsSolutions).
Using our geo-diverse vantage points, we measure dif-
ferences in the geographical preferences of the different
malware families. We identify families that exclusively
target the US, the UK, and a variety of European coun-
tries. We also analyze the rate at which malware authors
repack their wares to evade hash-based signatures. On
average, they repack specimens every 11 days, and some
malware families repack up to twice daily. We track the
dynamics of campaigns during which a service dissem-
inates a given malware family in an ongoing push, ob-
serving a wide temporal range, from specimens that are
continually distributed over weeks, to pointwise efforts
lasting only a few hours. We also analyze the particulars
of how different PPI services interact with their afﬁli-
ates, including surprising evidence suggesting that some
afﬁliates who sell installs to a particular PPI service not
only buy installs from rival PPI services, but also from
the very service to which they sell installs—apparently
to exploit arbitrage.
2 An Overview of Pay-Per-Install
The PPI market, as depicted in Figure 1, consists of three
main actors: clients, PPI providers (or services), and
afﬁliates. We begin with an overview of these actors,
followed by discussion of the transactions they perform
(Section 2.1) and the means and importance of evading
detection (Section 2.2).
Clients are entities that want to install programs onto a
number of target hosts. They wish to buy installs of their
programs. The PPI provider receives money from clients
for the service of installing their programs onto the target
hosts, where installation comprises distributing the pro-
Figure 1: The typical transactions in the PPI market. PPI
clients provide software they want to have installed, and
pay a PPI service to distribute the software (). The PPI
service conducts downloader infections itself or employs
afﬁliates that install the PPI’s downloader on victim ma-
chines(). The PPI service pushes out the client’s exe-
cutables (). Afﬁliates receive commission for any suc-
cessful installations they facilitated ().
grams to the target hosts, executing the client programs,
and tracking successful executions for accounting.
The PPI provider develops a program, called a down-
loader, that retrieves and runs client’s executables upon
installation. The PPI provider may conduct the instal-
lation of the downloader itself or may outsource distri-
bution to third parties called afﬁliates. When a provider
has afﬁliates, the provider acts as a middle man that sells
installs to the clients while buying installs from afﬁli-
ates that specialize in some speciﬁc distribution method
(e.g., bundling malware with a benign program and dis-
tributing the bundle via ﬁle-sharing networks; drive-by-
download exploits; or social engineering). PPI providers
pay afﬁliates for each target host on which they execute
the provider’s downloader program. Once the down-
loader runs, it connects to the PPI provider to download
the client programs. If the PPI provider does the distri-
bution itself, we call the service a direct PPI service. If
the PPI provider runs an afﬁliate program, we call it an
afﬁliate PPI service.
In general, both reputable and not-so-reputable enti-
ties use PPI services. In this paper we focus on the use
of PPI services as a distribution mechanism for malware,
e.g., bots, trojans, fake AV software, and spyware. To
avoid determining what constitutes malware, we limit the
scope of the paper to PPI services that perform (or al-
low their afﬁliates to perform) silent installs on the target
hosts, i.e., installations that lack the informed consent of
the owner of the system. Hereafter we use the term PPI
providers to refer exclusively to those providers that per-
form or facilitate silent installs.
2.1 The PPI Ecosystem
We describe the PPI ecosystem in terms of the transac-
tions that take place between clients and PPI providers,
and between PPI providers and their afﬁliates.
Clients. Clients proﬁt from the malicious activities en-
abled by malware they want to deploy on target hosts,
such as click fraud, stealing user information (e.g., credit
card numbers, credentials), or selling software to the user
under false pretense (e.g., fake AV).
PPI providers allow clients to choose the geographic
distribution of target hosts. This distinction creates price
differentiation in the market due to varying demand for
machines in certain regions and varying target host sup-
ply. Clients pay only per unique install, i.e., for one in-
stallation of their program on a given target host.
PPI providers. PPI providers proﬁt from installation
fees paid by the clients. PPI install rates vary from
$100–$180 for a thousand unique installs in the most
demanded regions (often the US and the UK, and more
recently other European nations), down to $7–$8 in the
least popular ones (predominantly Asia) [12, 13, 19]. In
this study, we observe PPI providers installing multiple
client programs on the same target host, and have not ob-
served attempts to secure exclusive use of a target host
on behalf of a client. Exclusivity of a host is difﬁcult to
guarantee because a PPI provider cannot generally know
whether a target host already runs other malware (e.g.,
a rival PPI downloader that installs competitors of the
client program). In addition, it is very difﬁcult for clients
to validate that the PPI service only installed their mal-
ware on a host.
Afﬁliate PPI services give their afﬁliates a PPI down-
loader program personalized with their unique afﬁliate
identiﬁer. The service credits afﬁliates for executing their
speciﬁc PPI downloader on a target host. Afﬁliates only
receive credit for conﬁrmed installs of their PPI down-
loader. The conﬁrmation takes the form of the PPI down-
loader sending the personalized afﬁliate identiﬁer to the
PPI provider after downloading and executing the client
programs. Thus, afﬁliates receive credit only after deliv-
ering the installs.
Afﬁliates. Afﬁliates proﬁt from the installs performed on
behalf of the PPI provider, with the distribution method
remaining transparent to the clients. Afﬁliates might in
fact be botmasters that compromise hosts, install their
own malware, and then task their malware with down-
loading and installing the PPI downloaders as one means
for monetizing their botnet. When doing so, the bot-
master relinquishes exclusive control of the hosts in ex-
change for the install payments from the PPI service. The
same botmasters might work with multiple PPI providers
simultaneously to maximize the income from each bot,
installing multiple afﬁliate binaries on each of their hosts.
the market has a somewhat fundamental
conﬂict-of-interest, in that the more installs a botmas-
ter/afﬁliate provides, the more payment they receive; but
each install degrades the quality of previous installs, be-
cause the likelihood of the owner of the system discern-
ing they have become infected, and remedying the situ-
ation, rises with the volume of malicious installs on the
system.
Indeed,
2.2 Evading Detection
AV software may detect and block any program in the
installation chain, making it difﬁcult to sustain installs.
Therefore, providing stealthy executables is a key objec-
tive for both PPI providers and clients. In the PPI ecosys-
tem, clients are often in charge of making their programs
stealthy before giving them to the PPI provider, while af-
ﬁliates rely upon the PPI provider to provide them with
a stealthy downloader.
To render programs stealthy, both PPI providers and
clients employ packer programs sold by third parties [21,
23]. Packers change the program content so that its sig-
nature (e.g., MD5 hash) differs even though the pro-
gram’s functionality has not changed. Sophisticated
packers may also change the program size and add de-
tection techniques for debuggers and virtual machines,
which are commonly used by analysts. PPI providers
have responsibility for packing the PPI downloaders for
each afﬁliate and testing that the resulting executable
remains undetected by AV software.
In addition, PPI
providers instruct afﬁliates and clients not to test their
programs on free malware scanners [30, 32], because
these services often redistribute samples to AV ven-
dors. The vendors may then add new signatures to their
databases, thus uncloaking the programs. We analyze
Figure 2: Brands used by the LoaderAdv PPI service
over time. The domains under each brand correspond
to known front-ends for afﬁliates.
how frequently clients repack their programs in Sec-
tion 4.2.
3
Inﬁltrating PPI Infrastructure
In this section, we ﬁrst describe how we identiﬁed the
four PPI services we inﬁltrate, and evaluate our coverage
of the PPI ecosystem. We then explain the processing
pipeline we have developed for milking executables from
PPI services and classifying them.
3.1
Identifying PPI services
A good starting point for identifying PPI services to in-
ﬁltrate is PPI forums [27, 28], which mainly serve as a
means for advertising afﬁliate PPI services to attract new
afﬁliates. General underground forums sometimes offer
the same advertisements. One challenge when study-
ing PPI services concerns how to identify the different
brands used by the same PPI service over time. We ap-
proached this task by analyzing public information, in-
cluding copies of any old front-ends [14], forums used
to advertise afﬁliate PPI services [27, 28], and previous
analysis by security analysts [7, 29].
We selected four afﬁliate PPI programs for inﬁltration:
LoaderAdv, GoldInstall, Virut, and Zlob. We use these
names to refer to the respective PPI services, regardless
of their branded program names over time. Figure 2 il-
lustrates such branding, employed by the LoaderAdv ser-
vice.
Our coverage. Several other PPI services exist that we
did not inﬁltrate. To get an idea of our coverage of the
malware ecosystem, we compare our malware harvest
with contemporary reports by the security industry. In
July 2010, FireEye posted the list of the top 20 malware
families they observed using their network during April–