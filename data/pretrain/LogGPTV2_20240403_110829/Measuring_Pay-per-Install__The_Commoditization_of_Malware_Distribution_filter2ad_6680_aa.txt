# Measuring Pay-per-Install: The Commoditization of Malware Distribution

**Authors:**
- Juan Caballero†
- Chris Grier∗‡
- Christian Kreibich∗‡
- Vern Paxson∗‡

**Affiliations:**
- ∗UC Berkeley
- ‡ICSI
- †IMDEA Software Institute

**Contact:**
- PI:EMAIL {grier, vern}@cs.berkeley.edu

## Abstract

In recent years, the "underground economy" associated with malware and the subversion of Internet-connected systems has seen extensive diversification. This trend towards specialization is driven by the realization that managing the entire value chain from malware creation to monetization, in the face of ever-evolving countermeasures, is a daunting task requiring highly developed skills and resources. As a result, entrepreneurial-minded miscreants have formed pay-per-install (PPI) services—specialized organizations that focus on the infection of victims' systems.

In this study, we perform a measurement analysis of the PPI market by infiltrating four PPI services. We develop infrastructure to interact with these services, gather, and classify the resulting malware executables distributed. Using our infrastructure, we harvested over a million client executables from vantage points across 15 countries. Our findings indicate that 12 of the world's top 20 most prevalent malware families use PPI services to buy infections. Additionally, we analyze the targeting of specific countries by PPI clients, the repacking of executables to evade detection, and the duration of malware distribution.

## 1. Introduction

The "underground economy" associated with malware and the subversion of Internet-connected systems has diversified extensively in recent years. This trend towards specialization is driven by the recognition that handling the entire value chain from malware creation to monetization, in the presence of evolving countermeasures, is a formidable challenge requiring advanced skills and resources. Consequently, market forces have fostered a service culture, leading to a wide range of specialized providers for all stages in the malware-monetization lifecycle, such as malware toolkits, packing tools to evade antivirus (AV) software, "bullet-proof" hosting, and forums for buying and selling ill-gotten gains.

At the core of this ecosystem is the infection of victim computers. Virtually every enterprise in this market ultimately depends on access to compromised systems. To meet the demand for widespread infection, pay-per-install (PPI) services have emerged. These PPI services play a crucial role in the modern malware marketplace by providing a means for miscreants to outsource the global dissemination of their malware. Miscreants can specify the number of victim systems, including geographical distribution, supply the PPI service with payment and malware executables, and within a short period, their malware is installed on thousands of new systems. In today’s market, this process costs pennies per target host, making it feasible for botmasters to rebuild their ranks even when faced with extensive takedown efforts.

In this work, we conduct a measurement study of the PPI market by infiltrating four PPI services. We develop infrastructure to interact with PPI services by mimicking the protocol interactions they expect from affiliates, and to gather and classify the resulting malware executables. Our study covers the six months between August 2010 and February 2011.

To our knowledge, this is the first systematic study of the PPI ecosystem from the perspective of the downloads pushed out by PPI services to their victims. Previous security analyses have examined PPI services in a top-down manner by becoming affiliates. Our study, however, is based on bottom-up infiltration, using custom programs to continuously download malware specimens distributed by PPI services, enabling us to track the services over time.

We harvested over a million client executables using vantage points spread across 15 countries. In August 2010, we identified 57 malware families, including many of the most prevalent infections at the time, such as spam bots (Rustock, Grum), fake antivirus (Securitysuite, Securityessential), information-stealing trojans (Zbot, Spyeye), rootkits (Tdss), DDoS bots (Russkill, Canahom), clickers (Gleishug), and adware (SmartAdsSolutions).

Using our geo-diverse vantage points, we measure differences in the geographical preferences of different malware families. We identify families that exclusively target the US, the UK, and various European countries. We also analyze the rate at which malware authors repack their wares to evade hash-based signatures, finding that on average, they repack specimens every 11 days, with some families repacking up to twice daily. We track the dynamics of campaigns during which a service disseminates a given malware family, observing a wide temporal range, from continuous distribution over weeks to pointwise efforts lasting only a few hours. We also analyze the interactions between different PPI services and their affiliates, including evidence suggesting that some affiliates who sell installs to a particular PPI service also buy installs from rival PPI services, apparently to exploit arbitrage.

## 2. An Overview of Pay-Per-Install

The PPI market, as depicted in Figure 1, consists of three main actors: clients, PPI providers (or services), and affiliates. We begin with an overview of these actors, followed by a discussion of the transactions they perform (Section 2.1) and the means and importance of evading detection (Section 2.2).

### 2.1 The PPI Ecosystem

**Clients:** Clients are entities that want to install programs onto a number of target hosts. They wish to buy installs of their programs. The PPI provider receives money from clients for the service of installing their programs onto the target hosts, where installation involves distributing the programs, executing them, and tracking successful executions for accounting.

**PPI Providers:** The PPI provider develops a program called a downloader, which retrieves and runs the client's executables upon installation. The provider may conduct the installation of the downloader itself or outsource distribution to third parties called affiliates. When a provider has affiliates, it acts as a middleman, selling installs to clients while buying installs from affiliates who specialize in specific distribution methods (e.g., bundling malware with benign programs, drive-by-download exploits, or social engineering). PPI providers pay affiliates for each target host on which they execute the provider’s downloader program. Once the downloader runs, it connects to the PPI provider to download the client programs. If the PPI provider does the distribution itself, it is called a direct PPI service. If the PPI provider runs an affiliate program, it is called an affiliate PPI service.

**Affiliates:** Affiliates profit from the installs performed on behalf of the PPI provider, with the distribution method remaining transparent to the clients. Affiliates might be botmasters who compromise hosts, install their own malware, and then task their malware with downloading and installing the PPI downloaders as a means for monetizing their botnet. When doing so, the botmaster relinquishes exclusive control of the hosts in exchange for install payments from the PPI service. The same botmasters might work with multiple PPI providers simultaneously to maximize the income from each bot, installing multiple affiliate binaries on each of their hosts.

There is a fundamental conflict of interest in the market: the more installs a botmaster/affiliate provides, the more payment they receive; however, each install degrades the quality of previous installs because the likelihood of the system owner detecting and remedying the infection increases with the volume of malicious installs.

### 2.2 Evading Detection

Antivirus (AV) software can detect and block any program in the installation chain, making it difficult to sustain installs. Therefore, providing stealthy executables is a key objective for both PPI providers and clients. In the PPI ecosystem, clients are often responsible for making their programs stealthy before giving them to the PPI provider, while affiliates rely on the PPI provider to provide them with a stealthy downloader.

To render programs stealthy, both PPI providers and clients use packer programs sold by third parties. Packers change the program content so that its signature (e.g., MD5 hash) differs, even though the program’s functionality remains unchanged. Sophisticated packers may also change the program size and add detection techniques for debuggers and virtual machines, commonly used by analysts. PPI providers are responsible for packing the PPI downloaders for each affiliate and testing that the resulting executable remains undetected by AV software.

Additionally, PPI providers instruct affiliates and clients not to test their programs on free malware scanners, as these services often redistribute samples to AV vendors, who may then add new signatures to their databases, uncloaking the programs. We analyze how frequently clients repack their programs in Section 4.2.

## 3. Infiltrating PPI Infrastructure

In this section, we first describe how we identified the four PPI services we infiltrated and evaluate our coverage of the PPI ecosystem. We then explain the processing pipeline we developed for extracting and classifying executables from PPI services.

### 3.1 Identifying PPI Services

A good starting point for identifying PPI services to infiltrate is PPI forums, which mainly serve as a means for advertising affiliate PPI services to attract new affiliates. General underground forums sometimes offer the same advertisements. One challenge in studying PPI services is identifying the different brands used by the same PPI service over time. We approached this task by analyzing public information, including copies of any old front-ends, forums used to advertise affiliate PPI services, and previous analysis by security analysts.

We selected four affiliate PPI programs for infiltration: LoaderAdv, GoldInstall, Virut, and Zlob. We use these names to refer to the respective PPI services, regardless of their branded program names over time. Figure 2 illustrates the branding employed by the LoaderAdv service.

**Our Coverage:** Several other PPI services exist that we did not infiltrate. To gauge our coverage of the malware ecosystem, we compare our malware harvest with contemporary reports by the security industry. In July 2010, FireEye posted a list of the top 20 malware families they observed using their network during April–June 2010.