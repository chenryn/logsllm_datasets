媲美的免费工具。商业产品与其他替代品之间最显著的区别是它们的报告引
探器软件将更有助于适应特定的应用场景。
能够支持你所要用到的协议。
抓取一个网段上所有的网络通信流量，
况下，通过将选定的网卡设置成混杂模式来完成抓包。在这种模式下，网卡将
个步骤。
之间的差异，可能会迫使你在不同的设备上使用不同的噢探器软件。
你有时会在一台机器上捕获数据包，然后在另一台机器上分析它们。操作系统
那么你就需要一款能够在大多数操作系统平台上运行的噢探器。你还需要留意，
果你是一位顾问，你可能需要在大多数操作系统平台上进行数据包捕获和分析，
系统平台。你需要选择一款噢探器，能够支持所有你将要使用的操作系统。如
包噢探器的使用方法。
一些开发人员文档，但使用这些应用软件的社区往往可以填补这些空白。使用
费用：关于数据包噢探器最伟大的事情是有着很多能够与任何商业产品相
操作系统支持：遗憾的是，并不是所有的数据包噢探器都支持所有的操作
技术支持：即使你已经掌握了噢探软件的基本用法，但是你还是偶尔会在
用户友好性：考虑数据包嗅探器的界面布局、安装的容易度，以及操作流
第一步：收集，数据包噢探器从网络线缆上收集原始二进制数据。通常情
数据包噢探过程中涉及到软件和硬件之间的协作。这个过程可以分为成3
而不仅是发往它的数据包。
数据包分析技术与网络基础
3
---
## Page 25
1.2.1
网络通信原理
协议
Wireshark数据包分析实战（第2版）
开始分析每个协议的特定属性。
析方式进行显示，而将大部分的分析工作留给最终用户。
型）、网络数据帧的基础知识，以及支持网络通信的硬件知识。
行相互通信的。在本节中，我们将研究网络协议、开放系统互连模型（OSI模
态主机配置协议（DHCP）。协议栈是一组协同工作的网络协议的逻辑组合。
协议包括传输控制协议（TCP）、互联网协议（IP）、地址解析协议（ARP）和动
能够相互通信，我们使用了一套共同的网络语言，
着巨大的差异，但它们通常用来解决以下问题。
议可以非常简单，
进行传输？
哪些信息？
为了充分理解数据包分析技术，你必须准确掌握计算机是如何通过网络进
的顺序进行处理？
理解网络协议的最佳途径之一是将它们想象成人类口头或书面语言的使用
现代网络是由多种运行在不同平台上的异构系统组成的。为了使它们之间
并称之为协议。
常见的网络
---
## Page 26
1.2.2七层OSI参考模型
注意
们更容易理解网络通信。
模型将网络通信过程分为7个不同层次，如图1-1所示：这个分层模型使得我
通信，应该传送什么样的最终信息？
客户端暂时无法和服务器建立通信时，该如何恢复连接？
的网络模型，也被称为TCP/IP模型
参考模型也并不是现有唯一的网络模型，例如，有些人更推崇美国国防部（DoD）
OSI参考模型只是一个行业建议标准，协议开发并不需要严格地遵守它，OSI
数据在协议上层或下层中得到妥善处理。
它来进行实际的网络数据传播。每一层次上的网络协议共同合作，来确保通信
连接终止：一台主机如何告知另一台主机通信已经结束？为了礼貌地终止
OSI参考模型最初是在1983年由国际标准化组织出版，标准号为ISO7498.
网络协议是基于它们在行业标准OSI参考模型中的职能进行分层的.OSI
顶端的应用层表示用来访问网络资源的实际程序。底层则是物理层，通过
图1-1OSI参考模型的七层协议视图
数据链路层
物理层
网络层
传输层
会话层
表示层
应用层
第1章数据包分析技术与网络基础
---
## Page 27
Wireshark数据包分析实战（第2版）
终用户所有网络活动的基础。
工的方式来创建会话连接，在通信主机间礼貌地关闭连接，而不是粗暴地直接
有通信设备之间建立、管理和终止会话连接。会话层还负责以全双工或者半双
同时进行用来保护数据的多种加密与解密操作。
完整的一层。传输层同时提供了面向连接和无连接的网络协议。某些防火墙和
无差错传输。
通过流量控制、分段/重组、差错控制等机制，传输层确保网络数据端到端的
OSI层之一。它除了负责网络主机的逻辑寻址（例如通过一个IP地址）外，还
代理服务器也工作在这一层。
丢弃。
处理数据包分片和一些情况下的错误检测。路由器工作在这一层上。
交换机是工作在数据链路层的物理设备。
会话层（第5层）：这一层管理两台计算机之间的对话（会话），负责在所
表示层（第6层）：这一层将接收到的数据转换成应用层可以读取的格式。
转换回数字信号。
应用层（第7层）：OSI参考模型的最上层，
传输层（第4层）：传输层的主要目的是为较低层提供可靠的数据传输服务
OSI参考模型中的每层都具有特定功能，具体如下。
数据链路层（第2层）：这一层提供了通过物理网络传输数据的方法，其主
网络层（第3层）：这一层负责数据在物理网络中的路由转发，是最复杂的
表1-1列出了OSI参考模型各个层次上的一些常见网络协议。
虽然OSI参考模型仅仅是一个建议标准，你还是应该将其牢记在心。
因为确保可靠的数据传输极为烦琐，因此OSI参考模型将其作为
当我
---
## Page 28
注意
物理层。在物理层上，传输系统将数据发送到接收系统。接收系统从它的物理
案例标成了“第8层的问题”，第8层是对用户层的一种非官方说法，通常是由
他不能访问网络资源，而实际原因是用户输入的密码不正确。我的同事将这个
件问题则被识别为“第7层上的问题”。
层只能从第1层与第3层发送和接收数据。
向从底部流向顶部。
通信数据会从一个通信端的顶部流向底部，然后当它到达另一通信端时，将反
层有着相应的网络协议，负责对网络数据进行解密。
第7层的某个协议是负责对传输数据进行加密的，那么往往在接收系统的第7
以不同的方式来实现。
提供与之完全相同的服务。不同层次的协议可能有目标类似的功能，但它们会
如果某层上的一个网络协议提供了一种服务，那么再没有任何其他层的协议将
层获取传输数据，然后向上逐层处理，直到最高的应用层。
数据首先在传输网络的应用层开始，沿着OSI参考模型的七层逐层向下，直到
那些整天工作在数据包层次上的网络工程师们使用。
数据链路层
会话层
表示层
应用层
层次
表1-1OSI参考模型各个层次上的典型网络协议
图1-2中连接了两个通信端图形化地说明了OSI参考模型。你可以看到，
网络层
传输层
在OSI参考模型任意层次上由不同协议提供的服务并不是多余的例如，
OSI参考模型中的每一层只能和直接的上层与下层进行通信。例如，第2
发送和接收计算机相同层上的网络协议是相互配合的。例如，发送系统在
那网络数据是如何流经OSI参考模型的各个层次呢？在网络上传输的初始
在讨论我们的工作时，一位同事告诉我，他曾处理过一位用户的投诉，说
Ethemet、Token Ring、FDDI、AppleTaik
IP、IPX
TCP.UDP、SPX
NetBIOS.SAP、SDP、NWLink
ASCII、MPEG、JPEG、MIDI
HITP、SMTP、FTP.Telnet
协议
第1章
数据包分析技术与网络基础
---
## Page 29
1.2.3
8Wireshark数据包分析实战（第2版）
注意
数据封装
间能够进行通信的额外信息。例如，当传输层从会话层接收数据时，它会在将数据
的每层协议都负责在传输数据上增加一个协议头部或尾部，其中包含了使协议栈之
向下流动，PDU逐渐变化和增长，各层协议均将其头部或尾部信息添加进去，
传递到下一层之前，增加自己的头部信息数据。
模型的最上层时，将只剩下原始传输数据。
的头部与尾部信息。
OSI参考模型不同层次上的协议在数据封装的帮助下进行通信传输。协议栈中
图1-2处于发送系统和接收系统同一层的协议
数据链路层
传输层
会活层
表示层
应用层
物理层
网络层
数据链路层
传输层
会话层
表示层
应用层
物理层
网络层
---
## Page 30
译者注：TCP/IP模型中并没有会话层和表示层，因此实际的TCPIP协议栈中并没有单独设计会话层和表示层网络协议
注意
数据封装处理过程。
务器上。这里我们假设TCP/IP通信会话已经被建立，图1-3所示为此案例中的
个过程中，我们首先必须产生一个请求数据包，从客户端计算机传输到目标服
（包括本书的其余部分）。
了解，我们经常会忽略掉会话层和表示层，所以它们将不会在这个例子中出现
靠交付，正如你学习到的，DNS协议构架于UDP上，而TCP构架在IP之上。
如HTTP等应用层协议提供了一个特定的服务，并依靠TCP协议来保证服务的可
将被创建，并被添加到数据包中，以确保数据包能够被正确交付。
协议来确保数据包的可靠投递。所以一个包括序列号和其他数据的TCP协议头部
是一个使用TCP（或在TCP协议之上）的应用层协议，因此传输层中将使用TCP
何发送到目的地。数据包中封装的应用层数据将沿着协议栈传递给传输层。HTTP
一旦我们的应用层协议已经确定我们要完成的任务，我们现在关心的是数据包如
层协议是HTTP，通过此协议发出请求命令，从google.com下载index.html文件
我们常说一个协议在其他协议之上，是因为OSI参考模型的上下层设计，例
我们从客户端计算机的应用层开始，在我们浏览一个网站时，所使用的应用
IPTCPHTTP
图1-3客户端和服务器之间数据封装过程示意图
客户端
数据链路层
物理层
网络层
传输房
表示层
第1章数据包分析技术与网络基础9
IPTCPHTTP
厦
以太网
服务器
IPTCPHTTP
---
## Page 31
1.2.4
10
Wireshark数据包分析实战（第2版）
网络硬件
旦处理完这些信息，第2层头部与尾部的信息将被剥除，并进入第3层的信息
取到所包含的物理以太网寻址信息，
服务器开始读取数据包，从下往上，
这里数据包变成0、1信号通过网络完成传输。
层报头信息被剥离，留下的只有应用层数据。这些数据会被传递到Web服务器
处理。
以及数据包未进行分片处理。这些数据也同样被剥离，并交到下一层进行
认数据包，
应用程序。
处理过程中。
是哪种协议。
件内容了
路由器。
封装好的数据包将穿越网络线缆，最终到达Google的Web服务器。Web
一步看到只包含第2层、第3层或第4层协议信息的数据包。
现在第4层TCP协议信息被读取，以确保数据包是按序到达的。然后第4
读取IP寻址信息的方式和第2层相同，目的是确认数据包被正确转发，
所有数据包都会以这个例子中描述的过程进行创建和处理，而无论使用的
集线器
48端口机盒设备，变化很大。
集线器
使客户端知道它的请求已经被接收，并可以等待获取index.html
为了响应客户端发过来的这个数据包，服务器应该发回一个TCP确
确定数据包是否是发往这台服务器的。
，这意味着它首先读取数据链路层，从中提
---
## Page 32
的身影了（用交换机来代替）。然而，你应该知道集线器的工作机制，因为它们对
送出数据时，所有连接到集线器的计算机都将接收到数据，但只有计算机B会
数据包。图1-5所示为从计算机A发送数据到计算机B的例子，当计算机A发
如，如果一台计算机连接到一个4端口集线器的1号端口上，需要发送数据到
同一时间发送和接收数据），所以你通常不会在现代或高密度的网络中再看到它们
实际接受数据，而其他计算机则将丢弃它。
媒体访问控制（MAC）地址，判断出这些数据包并不是给它们的，便丢弃这些
接到3号端口与4号端口上的客户端计算机通过检查以太网帧头字段中的目标
连接在2号端口的计算机，那么集线器将会把数据发送给端口1、2、3、4。连
端口接收到数据包，然后将数据包传输（中继）到设备的其他每个端口上。例
一台集线器无非就是工作在OSI参考模型物理层上的转发设备。它从一个
因为集线器会产生很多不必要的网络流量，并仅在半双工模式下运行（不能在
图1-5计算机A通过集线器传输数据到计算机B的通信流
计算机A
图14一台典型的4端口以太网集线器
计算机D
计算机B
K
第1章数据包分析技术与网络基础11
计算机C
---
## Page 33
12Wireshark数据包分析实战（第2版）
集线器最好的替代产品是交换机，它们是支持全双工的设备，可以同步地发送
的通信和时间浪费，然而这正是集线器的工作原理。在高密度的实际网络中，
接的端口上。如同你在图1-6中看到的那样，交换机的外表与集线器没什么
交换机并不是将数据广播到每一个端口，而是将数据发送到目的计算机所连
和接收数据。
两样
特定端口、查看端口细节参数、远程修改配置、远程重启等。
管理型交换机提供了多种在网络管理中非常有用的功能特性，
商特定软件或Web接口进行远程管理。这些交换机通常被称为管理型交换机。
意味着它们必须工作在OSI参考模型的数据链路层上。
与集线器相同，交换机也是用来中继数据包的。但与集线器不同的是，
交换机
送到特定端口上，从而大大降低了网络流量。
市场上几个大牌公司的交换机，比如思科品牌的，能够通过专业化的供应
®
图1-6一个机架式24端口以太网交换机
通
T
工T面
包括启用或禁
---
## Page 34
相连的所有计算机。
但信息将会直接通过交换机向目标接收者进行传输，而不会被传递到与交换机
数据包。路由器在网络间引导数据包流向的这一过程被称为路由。几种不同类
所示为一款路由器的示例。
LED指示灯，在背板上会有一些网络端口，个数则取决于网络的大小。图1-8
路由器可以有许多种不同的形状和外形，但大多数路由器在前面板上会有几个
·路由器
图1-7当计算机A通过交换机传输数据到计算机B时的通信流示意图
图1-7说明了流量经过交换机进行传输的过程。在这个图示中，计算机A
路由器工作在OSI参考模型的第3层，它负责在两个或多个网络之间转发
路由器是一种较交换机或集线器具有更高层次功能的先进网络设备。一个
图1-8一款低端的Cisco路由器：适合在一个中小型网络使用
计算机A
计算机D
计算机B
第1章数据包分析技术与网络基础13
计算机C
---
## Page 35
Oak Street
14Wireshark数据包分析实战（第2版）
用第3层地址（如IP地址）来唯一标识网络上的设备。
进行沟通交流，就像是与不同网段中的计算机进行通信。
许在同一网段中的所有计算机进行相互通信。然而，与其他街道上居住的邻居
易地与同一街道中居住的邻居进行沟通交流，
A
的网段的路由器才可以到达目标网段上。
换机上（具有内置功能，可以充当一台路由器的先进型交换机）。
Dogwood Lane
Vine Street
202
图1-9一个路由网络与邻街区的类比
504
100
0
10:1001150
192.168.0.50
，这类似于交换机的操作，能够允
1921
192.1680.5
192:16809
---
## Page 36
1.3.1广播流量
1.3
流量分类