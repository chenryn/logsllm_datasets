title:Discovering Malicious Domains through Passive DNS Data Graph Analysis
author:Issa Khalil and
Ting Yu and
Bei Guan
See	discussions,	stats,	and	author	profiles	for	this	publication	at:	https://www.researchgate.net/publication/296678352
Discovering	Malicious	Domains	through
Passive	DNS	Data	Graph	Analysis
Conference	Paper	·	June	2016
DOI:	10.1145/2897845.2897877
CITATIONS
2
3	authors:
READS
857
Issa	Khalil
Qatar	Computing	Research	Institute
80	PUBLICATIONS			1,177	CITATIONS			
Ting	Yu
Qatar	Computing	Research	Institute
117	PUBLICATIONS			3,586	CITATIONS			
SEE	PROFILE
SEE	PROFILE
Bei	Guan
Qatar	Computing	Research	Institute
6	PUBLICATIONS			23	CITATIONS			
SEE	PROFILE
Some	of	the	authors	of	this	publication	are	also	working	on	these	related	projects:
En-route	Caching	View	project
Resource	Allocation	View	project
All	content	following	this	page	was	uploaded	by	Issa	Khalil	on	03	March	2016.
The	user	has	requested	enhancement	of	the	downloaded	file.
Discovering Malicious Domains through Passive DNS Data
Graph Analysis
Issa Khalil
Institute
Ting Yu
Institute
Bei Guan
Institute
Hamad Bin Khalifa University
PI:EMAIL
Qatar Computing Research
Qatar Computing Research
Qatar Computing Research
Hamad Bin Khalifa University
Hamad Bin Khalifa University
PI:EMAIL
PI:EMAIL
ABSTRACT
Malicious domains are key components to a variety of cyber
attacks. Several recent techniques are proposed to identify
malicious domains through analysis of DNS data. The gen-
eral approach is to build classiﬁers based on DNS-related
local domain features. One potential problem is that many
local features, e.g., domain name patterns and temporal pat-
terns, tend to be not robust. Attackers could easily alter
these features to evade detection without aﬀecting much
their attack capabilities.
In this paper, we take a complementary approach. Instead
of focusing on local features, we propose to discover and ana-
lyze global associations among domains. The key challenges
are (1) to build meaningful associations among domains; and
(2) to use these associations to reason about the potential
maliciousness of domains. For the ﬁrst challenge, we take
advantage of the modus operandi of attackers. To avoid de-
tection, malicious domains exhibit dynamic behavior by, for
example, frequently changing the malicious domain-IP reso-
lutions and creating new domains. This makes it very likely
for attackers to reuse resources.
It is indeed commonly
observed that over a period of time multiple malicious do-
mains are hosted on the same IPs and multiple IPs host
the same malicious domains, which creates intrinsic associ-
ation among them. For the second challenge, we develop
a graph-based inference technique over associated domains.
Our approach is based on the intuition that a domain having
strong associations with known malicious domains is likely
to be malicious. Carefully established associations enable
the discovery of a large set of new malicious domains using
a very small set of previously known malicious ones. Our
experiments over a public passive DNS database show that
the proposed technique can achieve high true positive rates
(over 95%) while maintaining low false positive rates (less
than 0.5%). Further, even with a small set of known ma-
licious domains (a couple of hundreds), our technique can
discover a large set of potential malicious domains (in the
scale of up to ten thousands).
Permission to make digital or hard copies of all or part of this work for
personal or classroom use is granted without fee provided that copies are
not made or distributed for proﬁt or commercial advantage and that copies
bear this notice and the full citation on the ﬁrst page. To copy otherwise, to
republish, to post on servers or to redistribute to lists, requires prior speciﬁc
permission and/or a fee.
WOODSTOCK ’97 El Paso, Texas USA
Copyright 20XX ACM X-XXXXX-XX-X/XX/XX ...$15.00.
1
1.
INTRODUCTION
Malicious domains are key components to a variety of
cyber attacks, e.g., phishing, botnet command and control
and spams. It is therefore important to be able to discover
and block access to these attack enablers. Many techniques
have been proposed in the literature to identify malicious
domains, utilizing diﬀerent types of local network and host
information [1, 3, 8]. DNS data have been exploited in some
of these eﬀorts.
The general approaches extract multi-
ple features from DNS records as well as DNS queries and
responses, which may further be enhanced with historical
patterns and network traﬃc features of local hosts (those
issuing DNS queries). Based on these features and some
training datasets, a classiﬁer can be built to distinguish ma-
licious domains from benign ones. Such approaches are ef-
fective as long as the features used in the classiﬁer are not
manipulated. However, it has been shown that many of the
features used are not robust [12], that is, attackers could
change the features of malicious domains or infected hosts
to evade detection. For example, patterns in domain names
(e.g., number of characters or pronounceable words) can ob-
viously be altered easily [5, 6] without aﬀecting attacking
capabilities; similarly, attackers can also change TTL for
DNS query caching if it is used as a feature for detection.
The essential reason is that many of the proposed features
in existing work are local features about a single domain or
host. Therefore, it is not hard to coordinately alter these
features so that malicious domains do not conform to the
patterns speciﬁed in a classiﬁer.
In this paper we take a complementary approach. Instead
of focusing on local features, we propose to discover and an-
alyze global associations among domains. We derive such
global associations mainly from passive DNS data, though
other data sources (such as server logs and WHOIS records)
could be integrated to enhance conﬁdence of such associ-
ations. Our observation is that, though many features of
DNS records can be altered per individual domains, attack-
ers have to host malicious domains on IPs that they control
or have access to. Additionally, tactics implemented by ma-
licious domains (e.g., frequent creation of new domains and
fast ﬂuxing), in the continuous struggle to evade detection,
makes them exhibit dynamic characteristics among groups of
malicious domains instead of individual domains. For exam-
ple, Cova et al. [4] oﬀered a longitudinal analysis of the rogue
antivirus threat ecosystem. Their analysis shows that mali-
cious domains used in such campaigns are moving through-
out the Internet space over time, usually in bulk, while
sharing a number of varying features among them. Con-
sequently, it is very likely that multiple malicious domains
may end up being hosted at the same IPs, and similarly, mul-
tiple IPs are used to host the same malicious domains over
time, which creates intrinsic associations among them. To
eliminate such associations, attackers would have to make
sure that each malicious domain is hosted by very few IPs,
and each IP hosts very few malicious domains. These kinds
of tactics greatly limit the utilization of resources available
to attackers, incur heavy costs, and curb their proﬁts. We
thus submit that the associations between domains and IPs
oﬀer a robust way to study how attackers organize and de-
ploy malicious resources, which can further help us discover
new malicious domains from known ones.
Our approach is based on the intuition that a domain
having strong associations with known malicious domains is
likely to be malicious. Given a set S of known malicious do-
mains, we could assess other domains based on the strength
of their associations with those in S. To make this idea
eﬀective, we need to address several key issues: ﬁrst, how
to deﬁne the association between domains. As mentioned
earlier, such association should not be easily avoided by at-
tackers without greatly aﬀecting their attacking capabilities.
Further, it should reﬂect non-trivial relationships between
domains; second, given such associations and known ma-
licious domains, how to assess the maliciousness of other
related domains and how to combine such malicious scores
into a global measure, as a domain may be connected with
several malicious ones directly or indirectly; third, as we
focus on global patterns instead of local ones, we need to
ensure that the inference process is eﬃcient and scalable.
In this paper, we develop graph analysis techniques to dis-
cover new malicious domains given a seed of existing known
ones. Speciﬁcally, we make the following contributions:
• We develop a simple yet robust measure to reﬂect the
intrinsic associations between resources controlled by at-
tackers. Speciﬁcally, two domains are connected if they
are hosted by the same IPs during a period of time. Com-
pared with many existing features for malicious domain
detections, our scheme is tied to the key properties of how
malicious resources are utilized. Therefore, it is hard to
eliminate such connections without aﬀecting the utiliza-
tion of malicious resources. We further develop heuristics
to enhance the conﬁdence of such associations to better
reveal connections between malicious domains. We ac-
knowledge that domains may use the same IP without
being related to each other, especially in web hosting sce-
narios. We explain later how to deal with this issue.
• Based on the above associations, we construct graphs to
reﬂect the global correlations among domains, which en-
ables analysis well beyond those that only focus on a
host’s or a domain’s local properties. Associations be-
tween domains do not necessarily imply maliciousness.
In fact, they may happen due to legitimate management
of Internet resources. To discover malicious domains, we
propose a path-based mechanism to derive a malicious
score of each domain based on their topological connec-
tion to known malicious domains.
• We conduct extensive experiments to evaluate the eﬀec-
tiveness of the proposed scheme based on a large-scale
publicly available passive DNS database as well as ground
truth collected from public sources. We evaluate the
practicality of our scheme through careful analysis of the
tradeoﬀ between true positives and false positives for dif-
ferent parameter conﬁgurations. Our experimental re-
sults show that the proposed technique can achieve high
true positive rates (over 98%) while maintaining low false
positive rates (less than 0.5%). Further, even with a small
set of known malicious domains (a couple of hundreds),
our technique can discover a large set of potential mali-
cious domains (in the scale of tens of thousands).
We note that, though in this paper we focus on utiliz-
ing global association patterns to discover potential mali-
cious domains, we do not advocate discarding local features
proposed by existing eﬀorts.
Instead, we aim to oﬀer an-
other dimension to detect malicious domains, and indeed
our scheme could be integrated with robust local features to
further improve its eﬀectiveness. For example, besides rely-
ing on known malicious domains to bootstrap our scheme,
each domain may also have an initial score based on some lo-
cal features identiﬁed in past work. This score may then be
enhanced through (or combined with) the malicious scores
derived from our scheme, which we believe would oﬀer a
promising approach that is both highly accurate and robust.
Meanwhile, diﬀerent from many past eﬀorts (e.g., [1, 3]),
our approach is not a generic classiﬁcation scheme, i.e., we
do not build a classiﬁer that can label any given domain
as malicious or non-malicious.
Instead, our scheme is de-
signed to discover new malicious domains associated with
known malicious ones, which can be limited (e.g., just a few
malicious domains found in the early phase of an emerging
spam campaign) or do not exhibit clear patterns of local fea-
tures to be successfully classiﬁed. In fact, our scheme can
be combined with classiﬁcation-based schemes such that it
takes the output from a classiﬁer as the seeds to discover
other malicious domains whose local features do not ﬁt the
malicious proﬁle of the classiﬁer.
The rest of the paper is organized as follows. We pro-
vide a brief survey of related work on malicious domains in
section 2. Section 3 presents the technical details of the pro-
posed approach. Experiment setup and results are reported
in section 4. We conclude the paper in section 6.
2. RELATED WORK
Quite a few eﬀorts have been dedicated to identifying ma-
licious domains in the literature, utilizing diﬀerent types of
data and analysis techniques. Here we discuss brieﬂy repre-
sentative work most relevant to our approach.
Notos [1] was a pioneer work to use passive DNS data
to identify malicious domains. Notos dynamically assigns
reputation scores of unknown domains based on features ex-
tracted from DNS queries. EXPOSURE [3] follows a similar
methodology , and overcomes some of the limitations of No-
tos (e.g., EXPOSURE requires less training time and less
training data). Moreover, EXPOSURE diﬀerentiates itself
by being agnostic to the kind of services that the malicious
domains provide (e.g., botnet, Phishing, Fast-ﬂux).
Our approach is complementary to EXPOSURE and No-
tos by focusing on global topologies of the deployment of
malicious domains over IPs instead of their local features.
EXPOSURE and Notos perform best when they can get
access to individual DNS queries, which could be quite sen-
sitive. Our approach meanwhile works on public aggregated
passive DNS data, and thus will not cause privacy concerns.
We elaborate this point further in section 4.1.
2
Phoenix [10] utilizes passive DNS data to diﬀerentiate
between DGA and non-DGA malicious domains. Phoenix
models pronounceable domains, likely generated by humans,
and considers domains that violate the model as DGA gen-
erated. While our approach is to detect unknown mali-
cious domains, Phoenix is mainly concerned with tracking
and intelligence beyond detection. In fact the output of our
scheme can be used as input feed to Phoenix.
Novel work by Antonakakis et al. [2] detects DGAs by
monitoring DNS traﬃc. The observation is that the exis-
tence of DGAs in a network will increase the amount of ob-
served Non-Existent Domain (NXDomain) responses in the
network trace. Our approach instead focuses on the analysis
of successful resolutions of domains.
Manadhata et al. [7] proposed to identify malicious do-
mains by analyzing DNS query logs. The main technique is
to build a bipartite host-domain graph (which hosts query
what domains), and then apply belief propagation to dis-
cover malicious domains based on known malicious and be-
nign domains. The rationale is that, if a host queries a
malicious domain, that host is more likely to be infected.
Similarly, a domain queried by an infected host is more likely
to be malicious. Passive DNS data can also be modeled as
a bipartite graph. It seems compelling to identify malicious
domains by applying belief propagation over passive DNS
data. However, we observe that the inference intuition in [7],
though working very well for host-domain graphs, does not
carry through well in passive DNS data.
In section 4 we
experimentally compare our scheme with that in [7].
Rahbarinia et al. [8] proposed a behavior-based technique
to track malware-controlled domains. The main idea is to
extract user behavior patterns from DNS query logs beyond
the bipartite host-domain graph. As a contrast, our tech-
nique exploits passive DNS data instead of user DNS query
behavior. Features used in [8] are not applicable to passive
DNS data that we study.
SMASH [15] is an unsupervised approach to infer groups
of related servers involved in malware campaigns.
It fo-
cuses on server side communication patterns extracted from
HTTP traﬃc to systematically mine relations among servers.
SMASH is novel in proposing a mechanism that utilizes con-
nections among malicious severs to detect malware cam-
paigns in contrast with classiﬁcation schemes that solely
use individual server features. Our approach is similar to
SMASH in establishing server associations as bases for iden-
tifying new malicious servers, but complements SMASH by
utilizing passive DNS data, which oﬀers privacy beneﬁts.
Additionally, instead of using second-level domain names,
our approach establishes associations among fully qualiﬁed
domain names. This relaxes the assumption in SMASH that
servers with the same second-level domain belong to the
same organization and hence, our approach detects mali-
cious dynamic DNS servers.
Our path-based inference of malicious domains is par-
tially inspired by reputation management in decentralized
systems [11], where global trust are computed through feed-
backs on local interactions, though our application context
is totally diﬀerent. In particular, we investigate malicious-
ness propagation along domain associations while reputation
systems rely on trust transitivity in social contexts.
3. PROPOSED APPROACH
3