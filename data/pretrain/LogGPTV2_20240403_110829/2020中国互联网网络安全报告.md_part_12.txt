### 2.5.6 总结

#### 1. 远程办公人员数量激增导致信息技术服务业攻击事件急剧上升
2020年，由于新冠肺炎疫情的影响，许多企业开始实行远程办公，导致远程办公人员数量激增。这使得IT相关的各个部分成为攻击者的主要目标，包括企业VPN、视频会议软件和内部通信平台等。攻击者通过注册假域名冒充Zoom、Microsoft Teams等远程办公软件的官网来传播恶意软件。随着RDP（远程桌面协议）和VPN等远程访问技术使用频率的增加，RDP爆破攻击的数量急剧上升。

#### 2. 工业互联网或成网络安全下一个焦点
工业互联网涵盖了工业控制系统、工业网络、大数据存储分析、云计算、商业系统、客户网络等各种网络基础设施，并融合了云计算、物联网、大数据、5G通信和边缘计算等新一代信息通信技术。这种多元技术的融合带来了多种安全隐患。工业互联网打破了传统工业控制系统相对封闭的生产环境，其暴露面大大增加。

工业互联网与普通通信网的关键不同点在于它包含对工业控制和生产运营有直接影响的操作技术（OT）网络，其中包含较多敏感核心数据，涉及企业机密乃至国家安全。这些信息是不能进行公开或共享的。

#### 3. 云原生漏洞成为安全研究员和黑色产业链关注重点
近年来，云原生技术逐渐成为安全研究员和黑色产业链的关注重点。云原生技术旨在进一步利用云计算的弹性、敏捷性和资源化优势，解决应用在持续集成方面的困境，实现高度自动化的开发、集成、发布和运行等全生命周期管理。然而，编排系统Kubernetes和容器Docker频繁出现漏洞，尤其是由于配置问题导致的未授权访问漏洞，成为了黑客攻击和挖矿牟利的突破口。

### 2.6 2020年勒索病毒专题分析

#### 2.6.1 勒索病毒感染的数据统计分析

##### 1. 勒索病毒家族分析
2020年，勒索病毒攻击事件频发，新的变种和新家族大量出现。根据统计数据，Phobos家族占比最高（21.7%），其次是GlobeImposter家族（17.5%）和Crysis家族（12.3%）。具体数据如下图所示：

![2020年TOP10的勒索病毒家族占比情况](图2-56)

- Phobos：21.7%
- GlobeImposter：17.5%
- Crysis：12.3%
- Sodinokibi：9.5%
- Buran：5.3%
- MedusaLocker：3.2%
- Makop：2.2%
- Stop：6.0%
- Hermes837：1.5%
- CryptoJoker：1.4%
- 其他：19.4%

Phobos勒索病毒家族于2019年初被发现，早期主要通过远程桌面登录密码爆破传播。2020年6月出现新的变种，以系统激活工具为载体，诱导用户下载并安装后入侵终端，窃取用户机器信息，并通过木马控制端服务器下载加密勒索程序，实施比特币勒索。

GlobeImposter勒索病毒家族首次出现于2017年5月，主要传播方式包括远程桌面登录爆破和垃圾邮件。

Crysis勒索病毒家族从2016年开始传播，主要通过远程桌面登录爆破进行传播。

CryptoJoker勒索病毒家族于2020年11月开始在我国传播，仅两个月就成为年度感染占比前十的勒索病毒。该病毒通过“匿影”僵尸网络进行投递，危害严重。

##### 2. 被感染操作系统分析
2020年，被感染的操作系统中，Windows 10、Windows 7和Windows Server 2008仍然是占比较高的系统。具体数据如下图所示：

![2020年被感染系统占比情况](图2-57)

- Windows 10：34.4%
- Windows 7：32.2%
- Windows Server 2008：17.6%
- Windows Server 2012：9.5%
- Windows XP：2.1%
- 其他：4.2%

被感染的操作系统以桌面操作系统为主，占比70.0%，明显高于服务器操作系统的30.0%。

##### 3. 通用防范措施建议
针对主要通过远程桌面登录爆破方式传播的勒索病毒，建议采取以下防范措施：
- 设备登录口令应为强口令（字母+数字+特殊符号的长组合），定期修改口令；
- 不同的设备应使用不同的强口令，避免一个口令重复使用的情况；
- 定期进行数据备份并异地保存；
- 关闭或修改高危端口（如135～139、445），关闭服务器之间的文件共享；
- 定期对资产进行安全自查，及时安装漏洞补丁；
- 对内网的安全域进行合理的划分，域之间做好访问控制列表（ACL）限制，特别是域管理员的计算机；
- 记录和监控全流量日志，定期检查设备是否存在异常情况；
- 安装安全软件，提高服务器的安全性，以防核心数据被加密，造成重大损失。

针对主要通过钓鱼等方式传播的勒索病毒，建议采取以下防范措施：
- 不要下载网络上不明的档案、文件、图片或影片，谨慎对待陌生邮件、短信中的链接；
- 从正规渠道下载安装软件；
- 规范U盘等移动介质的使用，关闭自动播放功能，使用前先进行查杀；
- 定期进行安全培训，提升网络管理员和普通用户的安全意识。

#### 2.6.2 利用无文件攻击技术的新型勒索病毒分析

##### 1. 无文件攻击技术
2020年，主要勒索病毒家族大量采用无文件攻击技术。无文件攻击通常不会在目标主机的磁盘上写入任何恶意PE或ELF文件，而是通过各种脚本（如PowerShell、VBS脚本、PHP脚本等）实施攻击。无文件攻击通常使用以下几种特定技术：
- **恶意文档**：通过被植入特定威胁代码的Word文档、PDF文档等进行攻击。
- **恶意脚本**：绕开二进制检测方法，通过脚本运行，利用本地白名单程序，达到绕开防病毒检测的目的。
- **病毒执行体代码混淆**：依赖脚本执行，并利用各种私有的混淆技术进行改造，使安全运维人员难以回溯其工作方式。
- **无须依赖其他组件**：利用本地环境的各种组件（如WMI、regsvr32.exe等白名单工具），实现持久化脚本、启动脚本、横向移动攻击等。

##### 2. Sodinokibi家族勒索无文件攻击技术分析
Sodinokibi勒索病毒于2019年4月在国内首次被发现，主要通过RDP攻击方式进行传播。该病毒使用多种传播渠道，包括Web漏洞、Flash漏洞、钓鱼邮件、水坑攻击和漏洞利用工具包下载执行脚本等无文件攻击方式。其主要攻击流程如下图所示：

![Sodinokibi勒索病毒主要攻击流程](图2-59)

- **无文件攻击方式分析**：Sodinokibi勒索病毒利用恶意网站伪装成游戏辅助工具欺骗用户下载。当用户点击下载辅助工具的链接后，病毒通过一系列无文件攻击手段，在内存中直接运行，从而进行传播和勒索。该病毒利用了多个无文件攻击特征技术，包括内存执行、PowerShell脚本、JavaScript脚本、PHP脚本等执行，以及多层脚本间接混淆加密真正的病毒执行体。
- **Sodinokibi勒索病毒样本分析**：一旦用户浏览了植入该恶意病毒的网站并点击特定链接，病毒会通过创建白名单文件或感染白名单文件的方式防止被防病毒软件查杀，然后将磁盘中的重要文件加密，扩展名为.qv05z。该病毒试图在内存中执行病毒攻击主体或执行一个多级高模糊PowerShell脚本，规避各种防病毒软件和安全解决方案，并躲避沙箱。此类无文件攻击技术为基于签名和行为的安全工具带来了严峻挑战。

根据进程树关系显示，名为WINWORD.EXE的可执行程序打开了名为“info_17.07.doc”的文件，然后该文档病毒载体启动了攻击点中的PowerShell脚本。在另一个名为“VolontariDipendenti-addestramento-congiunto8-12Lugli.doc”的Word文档中也发现了相同的被植入脚本的攻击行为。

该勒索病毒启动后，通过白名单工具PowerShell执行Base64编码的命令。这是一种典型的无文件攻击方式，采用各种混淆技术，只有指定的脚本能够解密代码执行，给反病毒引擎造成了极大的检测困难。被解码后的勒索病毒脚本命令内容不包含直接造成危害的病毒执行体代码，而是通过另一个混淆和编码命令，释放一个简单的PowerShell代码。间接解码阶段完成后，样本释放一个简单的PowerShell代码，如图2-60所示。

该段脚本代码试图下载并执行一个名为“KiLrd.exe”的文件，该文件来自恶意URL：“hxxp://fcamylleibrahim[.]top/sywo/fgoow[.]php?l=dxclass2.gxl”。该勒索病毒下载的可执行文件被保存到用户目录默认文件夹中，即“C:\Users\user\user_name”。“KiLrd.exe”进一步尝试从另一个URL下载其他代码，即URL：“hxxp://185[.]193[.]141[.]248/gs[.]php”。

至此，经过复杂的多层间接步骤，该勒索病毒终于将病毒攻击代码放到被感染主机中。此病毒代码首先检查主机的处理器体系结构，以便启动正确的PowerShell实例（32位或64位）；然后启动PowerShell进程，调用驻留在其他URL中的代码：“hxxp://pastebin[.]com/raw/CY2EEMJN”。经过深入分析，该代码是一个Empire模块，该模块源代码托管在GitHub项目中。Empire是一个后端开发框架，提供了加密安全通信和灵活的体系结构。通过上述方式，降低了病毒的外部依赖，甚至无须任何外部依赖，就可以完成整个攻击过程。