title:Home Network or Access Link? Locating Last-Mile Downstream Throughput
Bottlenecks
author:Srikanth Sundaresan and
Nick Feamster and
Renata Teixeira
Home Network or Access Link? Locating
Last-Mile Downstream Throughput Bottlenecks
Srikanth Sundaresan1(B), Nick Feamster2, and Renata Teixeira3
1 ICSI, Berkeley, USA
PI:EMAIL
2 Princeton University, Princeton, USA
3 Inria, Lyon, France
Abstract. As home networks see increasingly faster downstream
throughput speeds, a natural question is whether users are beneﬁting
from these faster speeds or simply facing performance bottlenecks in
their own home networks. In this paper, we ask whether downstream
throughput bottlenecks occur more frequently in their home networks
or in their access ISPs. We identify lightweight metrics that can accu-
rately identify whether a throughput bottleneck lies inside or outside
a user’s home network and develop a detection algorithm that locates
these bottlenecks. We validate this algorithm in controlled settings and
report on two deployments, one of which included 2,652 homes across
the United States. We ﬁnd that wireless bottlenecks are more common
than access-link bottlenecks—particularly for home networks with down-
stream throughput greater than 20 Mbps, where access-link bottlenecks
are relatively rare.
Keywords: Bottleneck location · Wireless bottlenecks · Last-mile ·
Passive measurements
1 Introduction
Many countries around the world are investing heavily to increase the speeds
of access network infrastructure. As the downstream throughput of access links
increases, a natural question is whether users are reaping the beneﬁts of these
faster speeds. The downstream throughput they are experiencing may be limited
by other factors, such as their home wireless networks, which may face perfor-
mance problems due to a variety of factors (e.g., a poorly placed access link,
interference from competing networks or even devices on the same network). In
light of these trends, we study a simple question: Do users tend to see downstream
throughput bottlenecks more often in their access ISPs or in their home wireless
networks? To study this question, we design and implement an algorithm, HoA
(Home or Access), that can accurately locate these downstream bottlenecks on
commodity home routers. We deploy HoA in 2,652 home networks in the United
States and characterize the throughput bottlenecks that we observe across this
deployment.
c(cid:2) Springer International Publishing Switzerland 2016
T. Karagiannis and X. Dimitropoulos (Eds.): PAM 2016, LNCS 9631, pp. 111–123, 2016.
DOI: 10.1007/978-3-319-30505-9 9
112
S. Sundaresan et al.
Despite the importance and widespread interest in answering this question,
both data and conclusions have proved to be elusive. Although throughput analy-
sis and wireless diagnosis tools exist, each existing tool has some limitation that
makes it unsuitable for studying this question—typically, these tools require per-
forming measurements from multiple vantage points (which are hard to convince
users to install in their home networks), performing active measurements (which
can aﬀect the performance of the wireless network), or custom hardware (which
can hamper widespread deployment). (Section 4 explains how our work relates
to previous throughput detection and analysis tools and why existing tools do
not apply in our setting.) In contrast, we seek to develop a passive network mea-
surement tool that can run from a low-cost, commodity home network router.
This choice necessarily limits the extent of the data that we can collect (and,
as a result, the conclusions that we can draw), but it also aﬀords a relatively
large-scale deployment. HoA’s simplicity allowed us to implement it on a com-
modity Netgear router for two in-home deployments: A deployment of BISmark
routers across 64 homes and 15 countries; and another deployment that was
sponsored by the US Federal Communications Commission (FCC) and included
2,652 homes across the United States. These deployments allowed us to conduct
a ﬁrst-of-its-kind large-scale study of last-mile bottlenecks. Section 2.6 describes
the deployments in more detail.
Realizing HoA required tackling several challenges. First, we needed to prop-
erly isolate performance problems in the home network versus outside of the
home; capturing measurements at the home router oﬀers a convenient solution
to this challenge, since it lies between these two parts of the network. Next,
we had to identify and validate metrics that were lightweight enough to cap-
ture on a low-cost home router, yet suﬃcient to accurately locate downstream
throughput bottlenecks. We also wanted to use performance metrics from pas-
sive network traﬃc capture, to avoid introducing conditions that might either
alter the state of the wireless network or disrupt network performance for home
network users. Ultimately, we identiﬁed two features—the coeﬃcient of variation
of packet inter-arrival time and the round-trip time on the wireless LAN—that
can be measured passively, are lightweight enough to be deployed on a commod-
ity home gateway, and can identity last-mile bottlenecks in many circumstances.
Section 2 incorporates these metrics into a complete identiﬁcation algorithm.
We oﬀer two important contributions: (1) the design of HoA, a lightweight
tool that both accurately detects home access link and wireless network bot-
tlenecks; (2) a detailed characterization of the nature and extent of throughput
bottlenecks that commonly arise in many home networks using data from a large-
scale prototype deployment of HoA in home routers. We do not determine why a
particular bottleneck exists (e.g., it cannot determine whether a wireless problem
results from poor device placement, non-WiFi interference, or other causes), but
rather only where the problem exists, to the granularity of whether the problem
is inside or outside the home. Our study yields the following important ﬁndings:
(cid:129) Access link bottlenecks rarely occur in home networks where downstream
access throughput exceeds 20 Mbps. Rather, in these cases, throughput
bottlenecks are often introduced by the home wireless network.
Locating Last-Mile Downstream Throughput Bottlenecks
113
access throughput is less than 10 Mbps.
(cid:129) Access link bottlenecks only tend to be common for users whose downstream
(cid:129) In homes with multiple devices where we detect a wireless bottleneck, it is
equally likely that only a single device experiences the wireless bottleneck as
it is that all devices in the home experience the bottleneck simultaneously.
Our results suggest that it is worth spending eﬀort to improve home wireless
network performance, in addition to the extensive attempts to optimize perfor-
mance in other parts of the network and end hosts.
2 HoA: Design, Implementation, and Deployments
We describe the design, implementation, and deployment of HoA.
2.1 Design Choices
Our ﬁrst design choice was to perform measurements from the home access point.
Locating bottlenecks at the last mile becomes easier with a vantage point inside
the home network. Although vantage points in the access ISP (such as in the
DSLAM for a DSL ISP) can see all the home traﬃc, these locations outside
the home obscure metrics that can provide important clues about whether the
home wireless network is introducing a bottleneck. Inside the home, we can
either instrument end-hosts or the access point itself. Client devices can observe
wireless properties from their own traﬃc but may not be able to observe traﬃc
properties of other clients. A device also cannot determine characteristics of the
access link. End-host tools such as T-RAT [22] can monitor TCP properties such
as congestion window or duplicate ACKs to identify the causes of throughput
bottlenecks but cannot isolate the location of congestion.
Our second design choice was to use passive traﬃc measurements. While
active probing may yield useful information about the state of the network,
it also carries potential drawbacks. It risks introducing extra load on the net-
work, thereby aﬀecting the conditions that we are trying to measure; it may also
disrupt the users who are hosting our measurement devices. Thus, we rely on
passive measurements of in situ user traﬃc as the main source of information
for detecting performance bottlenecks. We aim to do so without custom wireless
drivers or anything that could adversely aﬀect the performance of the networks
we are measuring, so we look for features at the IP layer that can indicate per-
formance problems. Possible metrics thus include ﬂow timings and sizes, packet
timings and sizes, and information that we can retrieve from TCP headers. We
brieﬂy discuss our choices.
2.2 Network Metrics
Packet arrival timings and TCP RTT are promising metrics particularly because
our vantage point at the access point allows us to separately compute these
114
S. Sundaresan et al.
(a) Cumulative distribution of the number
of packets per second in FCC deployment.
(b) Cumulative distribution of the number
of packets per ﬂow in FCC deployment.
Fig. 1. Properties of test samples from the FCC deployment
n
o
i
t
c
a
r
f
e
v
i
t
a
l
u
m
u
C
s
e
l
p
m
a
s
f
o
1.0
0.8
0.6
0.4
0.2
0.0
0.0
0.5
1.0
1.5
cv
Access link bottleneck
Wireless bottleneck
2.0
2.5
3.0
n
o
i
t
c
a
r
f
e
v
i
t
a
l
u
m
u
C
s
e
l
p
m
a
s
f
o
1.0
0.8
0.6
0.4
0.2
0.0
Access link bottleneck
Wireless bottleneck
0
5
10
20
15
25
LAN RTT (ms)
30
35
40
Fig. 2. Coeﬃcient of variation of
packet interarrival times. When the
access link is a downstream throughput
bottleneck, packet arrivals are smooth
(i.e., the variance on packet interarrival
time is lower).
Fig. 3. TCP RTT between client
and access point. When the wireless
link is the throughput bottleneck, the
TCP RTT between the device and the
access point is signiﬁcantly higher.
metrics for the WAN and LAN portions of the end-to-end path, potentially
allowing us to disambiguate problems that occur on either side of the access
point.
Packet Interarrival Time. We exploit an observation that is common to many
bottleneck links: packets traversing a bottlenecked link experience buﬀering imme-
diately upstream of the link; as a result, they experience smoothed arrival patterns
downstream of the bottleneck link. To capture this eﬀect, we use the coeﬃcient
of variation of packet interarrival times, cv, which is the standard deviation of
packet interarrival time divided by the mean packet interarrival time. In our
example, when the access link is the bottleneck cv = 0.05; whereas when the
wireless is the bottleneck cv is 0.88. In Fig. 2, the “access link bottleneck” curve
presents the distribution of cv for 100 experiments where we introduced a bottle-
neck at the access link; and the “wireless bottleneck” curve for 100 experiments
where the bottleneck was on the wireless. There is no overlap between the two
curves: cv is lower when the access link is the bottleneck versus when it is not.
Wireless Round-Trip Time. The second eﬀect is that devices in home net-
works are only one hop away from the access point, so the baseline latency
between the access point and the device should be a few milliseconds (as we
Locating Last-Mile Downstream Throughput Bottlenecks
115
measured in our controlled experiments). We observe that the delays caused by
buﬀering in the wireless network (i.e., those caused by throughput bottlenecks)
are signiﬁcantly higher. We measure this eﬀect by capturing the TCP RTT, τ,
between the device and the access point. Figure 3 presents the LAN TCP RTT
(the RTT over TCP between the access point and a device in the home network)