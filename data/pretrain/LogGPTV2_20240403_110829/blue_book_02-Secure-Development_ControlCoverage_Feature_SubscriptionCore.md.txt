## IMPORTANT: DevOps Kit (AzSK) is being sunset by end of FY21. More details [here](../../../ReleaseNotes/AzSKSunsetNotice.md)
----------------------------------------------
SubscriptionCoreDescription & RationaleControlSeverityAutomatedFix ScriptMinimize the number of admins/ownersEach additional person in the Owner/Contributor role increases the attack surface for the entire subscription. The number of members in these roles should be kept to as low as possible.MediumYesNoJustify all identities that are granted with admin/owner access on your subscription.Accounts that are a member of these groups without a legitimate business reason increase the risk for your subscription. By carefully reviewing and removing accounts that shouldn't be there in the first place, you can avoid attacks if those accounts are compromised.MediumYesNoMandatory central accounts must be present on the subscriptionCertain central accounts are expected to be present in all subscriptions to support enterprise wide functions (e.g., security scanning, cost optimization, etc.). Certain other accounts may also be required depending on special functionality enabled in a subscription (e.g., Express Route network management). The script checks for presence of such 'mandatory' and 'scenario-specific' accounts. If these are not present per the current baseline, there may be security/functionality impact for your subscription.HighYesYesDeprecated/stale accounts must not be present on the subscriptionDeprecated accounts are ones that were once deployed to your subscription for some trial/pilot initiative (or some other purpose). These are not required any more and are a standing risk if present in any role on the subscription.CriticalYesYesDo not grant permissions to external accounts (i.e., accounts outside the native directory for the subscription)Non-AD accounts (such as PI:EMAIL, PI:EMAIL, etc.) present at any scope within a subscription subject your cloud assets to undue risk. These accounts are not managed to the same standards as enterprise tenant identities. They don't have multi-factor authentication enabled. Etc.HighYesNoService accounts cannot support MFA and should not be used for subscription activityService accounts are typically not multi-factor authentication capable. Quite often, teams who own these accounts don't exercise due care (e.g., someone may login interactively on servers using a service account exposing their credentials to attacks such as pass-the-hash, phishing, etc.) As a result, using service accounts in any privileged role in a subscription exposes the subscription to 'credential theft'-related attack vectors. (In effect, the subscription becomes accessible after just one factor (password) is compromised...this defeats the whole purpose of imposing the MFA requirement for cloud subscriptions.)HighNoNoThere should not be more than 2 classic administratorsThe v1 (ASM-based) version of Azure resource access model did not have much in terms of RBAC granularity. As a result, everyone who needed any access on a subscription or its resources had to be added to the Co-administrator role. These individuals are referred to as 'classic' administrators. In the v2 (ARM-based) model, this is not required at all and even the count of 2 classic admins currently permitted is for backward compatibility. (Some Azure services are still migrating onto the ARM-based model so creating/operating on them needs 'classic' admin privilege.)HighYesNoUse of management certificates is not permitted.Just like classic admins, management certificates were used in the v1 model for script/tool based automation on Azure subscriptions. These management certificates are risky because the (private) key management hygiene tends to be lax. These certificates have no role to play in the current ARM-based model and should be immediately cleaned up if found on a subscription. (VS-deployment certificates from v1 timeframe are a good example of these.)HighYesNoPending Azure Security Center (ASC) alerts must be resolvedBased on the policies that are enabled in the subscription, Azure Security Center raises alerts (which are typically indicative of resources that ASC suspects might be under attack or needing immediate attention). It is important that these alerts/actions are resolved promptly in order to eliminate the exposure to attacks.HighYesNoService Principal Names (SPNs) should not be Owners or Contributors on the subscriptionJust like AD-based service accounts, SPNs have a single credential and most scenarios that use them cannot support multi-factor authentication. As a result, adding SPNs to a subscription in 'Owners' or 'Contributors' roles is risky.MediumYesNoCritical application resources should be protected using a resource lockA resource lock protects a resource from getting accidentally deleted. With proper RBAC configuration, it is possible to setup critical resources in a subscription in such a way that people can perform most operations on them but cannot delete them. resource locks can help ensure that important data is not lost by accidental/malicious deletion of such resources (thus ensuring that availability is not impacted).MediumYesNoARM policies should be used to audit or deny certain activities in the subscription that can impact securityThe AzSK subscription security setup configures a set of ARM policies which result in audit log entries upon actions that violate the policies. (For instance, an audit event is generated if someone creates a v1 resource in a subscription.) These policies help by raising visibility to potentially insecure actions. MediumYesYesAlerts must be configured for critical actions on subscription and resourcesThe AzSK subscription security setup configures Insights-based alerts for sensitive operations in the subscription. These alerts notify the configured security point of contact about various sensitive activities on the subscription and its resources (for instance, adding a new member to subscription 'Owners' group or deleting a firewall setting or creating a new web app deployment, etc.)HighYesYesDo not use custom-defined RBAC rolesCustom RBAC role definitions are usually tricky to get right. A lot of threat modeling goes in when the product team works on and defines the various 'out-of-box' roles ('Owners', 'Contributors', etc.). As much as possible, teams should use these roles for their RBAC needs. Using custom roles is treated as an exception and requires a rigorous review.MediumYesNoDo not use any classic resources on a subscriptionYou should use new ARM/v2 resources as the ARM model provides several security enhancements such as: stronger access control (RBAC), better auditing, ARM-based deployment/governance, access to managed identities, access to key vault for secrets, AAD-based authentication, support for tags and resource groups for easier security management, etc.MediumYesNoDo not use any classic virtual machines on your subscription.You should use new Az resources as the ARM model provides several security enhancements such as: stronger access control (RBAC), better auditing, ARM-based deployment/governance, access to managed identities, access to key vault for secrets, AAD-based authentication, support for tags and resource groups for easier security management, etc.HighYesNoVerify the list of public IP addresses on your subscriptionPublic IPs provide direct access over the internet exposing a cloud resource to all type of attacks over the public network. Hence use of public IPs should be carefully scrutinized/reviewed.HighYesNoEnable PIM (Privileged Identity Management) for granting privileged access to subscription level roles.PIM (Privileged Identity Management) allows to manage, control, and monitor access on your subscription which helps to mitigate the risk of excessive, unnecessary or misused access rights.By using PIM, one can ensure that least required access is granted for just enough duration of time thereby eliminating risks from persistent privileged role memberships.HighYesNoEnable PIM (Privileged Identity Management) for granting privileged access to resource group level roles.PIM (Privileged Identity Management) allows to manage, control, and monitor access on your resource group which helps to mitigate the risk of excessive, unnecessary or misused access rights.By using PIM, one can ensure that least required access is granted for just enough duration of time thereby eliminating risks from persistent privileged role memberships.Note: This control gets executed only during CA scan.HighYesNoMandatory tags must be set per your organization policy.Certain tags are expected to be present in all resources to support enterprise wide functions (e.g., security visibility based on environment, security scanning, cost optimization, etc.). The script checks for presence of such 'mandatory' and 'scenario-specific' tags.HighYesNoStandard tier must be enabled for Azure Security Center.ASC standard tier enables advanced threat detection capabilities, which uses built-in behavioral analytics and machine learning to identify attacks and zero-day exploits, access and application controls to reduce exposure to network attacks and malware, and more.HighYesNoEnsure any credentials approaching expiry are rotated soon.Periodic credential rotation is a good security hygiene practice as, over time, it minimizes the likelihood of data loss/compromise which can arise from key theft/brute forcing/recovery attacks. Credential expiry can also impact availability of existing apps.HighYesNoAzure Security Center (ASC) policies must be correctly configured on the subscription.ASC security policies define the desired configuration of your workloads and helps ensure you're complying with the security requirements of your company or regulators. It provides key policy settings (e.g., is patching configured for VMs?, is threat detection enabled for SQL?, etc.) and alerts about resources which are not compliant to those policy settings. Correctly configuring ASC is critical as it gives a baseline layer of protection for the subscription and commonly used resource types.HighYesYesAuto Provisioning must be set to ON in Azure Security Center.ASC monitors various security parameters on a VM such as missing updates, OS security settings, endpoint protection status, and health and threat detections, etc using a monitoring agent. This agent needs to be provisioned and running on VMs for the monitoring work. When automatic provisioning is ON, ASC provisions the Microsoft Monitoring Agent (MMA) on all supported Azure VMs and any new ones that are created.HighYesYesSecurity contact details must be configured in Azure Security Center.Security contact information will be used by Microsoft to contact you if the Microsoft Security Response Center (MSRC) discovers that your customer data has been accessed by an unlawful or unauthorized party.HighYesYesEnsure deleted objects do not have access to the subscription.Access of deleted objects to subscription should be removed, while it does not have direct implication to security but it is a good security hygiene to follow.MediumYesNoEnsure applications without owners do not have access on subscription.Access of applications without any owners should be removed, as you would not know who is accountable for any accidental or malicious activity that happens using these applications.HighYesNoEnsure that users do not have additional access to the subscription via apps owned by them.When we remove a user from the subscription RBAC (e.g., remove from Owner or Contributor) there are chances that user may still own or possess credential of an SPN that has privileged access to the subscription. By identifying and cleaning up such inadvertent vectors of access, the risks from accidental or malicious misuse via this attack vector can be reduced.HighYesNoConsider revoking access for applications/users who are not actively using the subscription.As a good security hygiene consider revoking access for applications/users who are not actively using the subscription, in order to reduce risk of any mallicious activity.MediumYesNo