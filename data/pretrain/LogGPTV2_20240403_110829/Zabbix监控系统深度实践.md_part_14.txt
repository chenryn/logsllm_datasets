·94
LC_MESSAGES/目录，
配置文件做一下修改。
到的 Trigger 等级名称都是提到的几个。如果要根据自己的语言修改 Trigger 名称，需要对语言
默认的Trigger 等级名字对于所有语言都是一样的，即无论选择的是英语、汉语还是法语，看
serverities”定义。如果在Zabbix前端使用了多语言的功能，Trigger等级名称会覆盖默认的名字。
Trigger，把报警发给工程师就可以了，而 Disaster 的问题，可能就要通知到领导了。
和交换机B的可用性Trigger 都是OK 状态才行。
Zabbix监控系统深度实践
Disaster
High
Average
Warning
Information
Not classified
6.1.5
然后保存就行了。这里可以把 msgid 和 msgstr 看成是翻译的一个键值对。
msgstr“重要"
msgid “Important"
例如，如果想把“Important”改为“重要”，那么要进入PHP前端目录下的/locale/zh_CN/
Zabbix 还可以自定义Trigger 的等级和颜色,可以在“Administration”→“General”→“Trigger
（3）不同等级的Trigger所触发的Action，会把报警发给不同的人。比如 Information 的
（2）不同等级的Trigger，会有不同的警报声音。
（1）使用不同颜色区分不同等级的Tnigger，从前端一眼就能看到问题有多严重。
使用Trigger等级主要有以下用途。
Trigger 等级，是用来定义 Trigger的严重程度的。Zabbix支持如表6-3 所示的 Trigger等级。
当需要恢复服务器A可用性Trigger时（即从 PROBLEM 状态变为OK），一定要交换机A
Trigger等级
等级
，找到frontend.po，增加一个对应关系：
灾难性的问题
重要的问题
一般的问题
警告的信息
提示的信息
未知的等级
定义
表6-3
鲜红色
红色
橙色
黄色
绿色
灰色
颜色
---
## Page 110
DiscoveryEvent 就产生了。具体如表6-4所示。
扫描一定范围（范围由网络侦测规则设定）的IP，每当扫描到 Host或者 Service时，一个
生成一个Event。Trigger 是Event 最大的来源。
状态变化，
13
这样是不是简单多了呢？
的1024倍。
其他都是按照1024来换算。除了K、M、G、T，还支持P、E、Z、Y，每个单位都是前面一个
可以使用一些后缀缩写，来简化这个过程。主要的后缀缩写是时间单位后缀和容量单位后缀。
Service Discovered
HostDown
Host Up
Service Down
Service Up
（2）Discovery Event：当 Hosts 和 Services 被侦测到的时候产生。Zabbix 每隔一段时间会
一共有下面几种Event。
6.1.6单位
例如，{host:system.uptimelast(0)}<86400，可以表示为(host:system.uptimep.last（0）}1d,
（1）Trigger Event：Trigger 状态变化，会生成一个Event。这里需要注意的是，只要Trigger
Events(事件）是Zabbix重要的概念，任何一个动作的产生，都会生成一个Event。在Zabbix中，
时间单位后缀有：s、m、h、d和w，分别表示秒、分钟、小时、天和周，可以将它们使
容量单位后缀有：K、M、G和T,对应计算机中的容量换算，其中Bps是按照1000来换算的，
如果使用“86400"去表示一天的秒数，是很麻烦的，一是位数多，二是容易写错。在Zabbix中，
Events
，一定会生成Event。即无论是OK变到PROBLEM，还是PROBLEM变到OK，都会
事件
第一次侦测到服务，或者服务挂掉后恢复
IP上一个服务也没有
IP至少有一个服务
当Zabbix侦测到服务停止
当Zabbix侦测到服务启动
表6-4
产生的时间
第6章报警配置
·95°
---
## Page 111
96
置，下面主要来了解Zabix支持的报警途径，以及如何设置报警一
件”告诉工程师。Zabbix在这一方面有非常丰富的功能，当然，随之而来的就是较为复杂的设
8
Events 和它们的细节。
之间的变化。
之间的变化，low-level发现规则“正常”和“异常”之间的变化，Trigger的“正常”和“未知”
机器的磁盘满了之类，而是Zabbix本身可用性变化的一个事件。比如 Item的“正常”和“异常”
够了解到Zabbix内部的一些事件的发生，它的目标并不是发现某个Item出了问题，比如某个
态发生变化的时候产生。InternalEvents是从Zabbix2.2开始的，增加这个特性，是为了用户能
Zabbix监控系统深度实践
Host Lost
Host Discovered
ServiceLost
Zabbix是一个监控系统，是检测数据，发出报警的，即一旦系统出现问题，要将这个“事
查看 Zabbix 生成的Events，可以从菜单进人“Monitoring”→“Events"，浏览过去生成的
if（ConditionA == true）
还可以选择给谁报警（哪个用户）、怎样报警（哪种途径，短信或者邮件等），具体如下
Alert（）;
if（ConditionA == true）{
抽象成计算机语言，就是：
如果某种条件符合，
通常，一个报警的产生，是这样的一个过程。
（4）Intermal Events：当 Item或者是low-level发现规则的状态发生变化和一个Trigger的状
（3）Auto Registration Event：当Agent 被Server自动发现并且注册的时候。
Actions
事件
，那么报警。
服务器侦测到后丢失
第一次侦测到服务器，或者服务器挂掉后恢复
服务侦测到后丢失
产生的时间
一何时报警，报警给谁。
续
表
---
## Page 112
就是发生报警时，将报警通过各种方式发送给对应的用户。
的预先设置的邮箱地址了。这个邮箱地址叫做这个用户的 Media，即联系方式。
发邮件，一定要设置Action向某个用户发送报警，发送报警的途径是邮箱，那么就会发到用户
个 Trigger是PROBLEM状态了，等等。
作”，就是当某种Condition 符合时，会进行一些操作，这些操作就叫做Action。Condition，
去执行一些命令，这已经不是狭义上的“报警”了。在Zabbix中，这个被定义为Action,译为“动
自己启动就行了，则又变成了：
6.3.1
Action是 Zabbix 非常强大的功能,可以基于Event 的不同状态，执行不同的操作。最常见的，
下面来介绍Action的设置。
在Zabbix中，报警的途径是依附于用户的。即不能直接将一个Action设置为给某个邮箱
这就是Zabbix的“报警”了，为什么这里的“报警”要加引号呢？其实，发生问题后，
Execute（command）;
Alert（sms）;
Alert（email);
if（ConditionA == True && ConditionB != True）{
再扩展一些，可能条件非常的复杂
Execute（command）;
Alert（sms）;
Alert（email）;
if（ConditionA==true）{
如果出了问题不一定要报警，
Alert(userBsms）;
Alert(userA.email);
Action
，可以在服务器上运行一些命令自动恢复，比如Nginx挂了，
第6章报警配置
·6·
译
---
## Page 113
98
所示。
关系；“Operations”定义的是Action被触发后的一些操作。
用来定义Action本身的一些属性和说明；“Conditions”用来定义触发Action的各种条件的组合、
Zabbix监控系统深度实践
默认是建立基于 trigger event 的 action，如果需要其他的，选择对应的选项即可，如图 6-2
① Recovery message：是否在问题解决后发送消息。Zabbix将“OK”状态的Trigger认为是
Default message：报警的默认内容。应该已经写在对话框中。
Default subject：报警的默认标题。
Name：唯一的Action的名字。
“Action”标签，有下面的属性可以设置。
（2）在“Event source”下拉框中，可以选择只显示依赖于某种源头的Actione
 Auto Registration Events：当有新的 Zabbix Agent 自动注册到 Zabbix时产生。
@Discovery Events：当发生网络 Discovery 的时候产生。
@ Trigger Events：当 Trigger 的状态变化，即从 OK 到 PROBLEM或从 PROBLEM到 OK 时
下面进入Action的配置。
目前 Zabbix支持Action 根据下面的Events触发。
?
都会产生。
题和内容。
event只会触发一次。对于Recovery的报警，可以像发出报警的邮件一样，设置报警标
理解为报警的升级，比如，多久没处理一个报警，就要将邮件发送给老板等），Recovery
一个恢复的 recovery event。注意，如果使用了Escalation 机制（后文有介绍，这里简单
Event source
应该已经写在对话框中。
图6-2
Discovery
Create action
---
## Page 114
6.3.2Operation
（1）添加一个Host。
对于auto-registration事件，也有额外的一些操作：
（8）取消和一个Template的关联。
（7）关联到一个Template。
（6）（Host）从一个 Host group 中删除。
（5）（Host）添加到一个 Host groupo
（4）禁用一个Host。
（3）启用一个Host。
（2）移除一个Host。
（1）添加一个Host。
对于 discovery 事件，还有额外的一些操作：
（2）执行一个命令（包括IPMI）。
（1）发送一条消息。
Operation 指的是Action 触发以后具体的操作，在Zabbix中，可以定义下面这些操作：
Enabled：是否启用这个Action。
Recovery message：Recovery 信息中的内容。
Recovery subject：Recovery信息的标题。
不是Recovery。
（5）在Recovery信息中,EVENT.RECOVERY,*表示的是出自Recovery event的数据。
（4）在Recovery信息中，EVENT*Macro中的数据，都是基于出问题的Event，而
（3）恢复信息和Action依赖的PROBLEM生成的Event 维护同一份ACK状态。
（2）恢复信息只会发送给那些之前收到过关于这个Action的报警信息的人。
（1）自定义的恢复信息，只针对Condition，是“Trigger value is PROBLEM”的生效。
以下几点需要注意。
第6章报警配置
·66·
---
## Page 115
●100·
如图6-3所示。
Zabbix监控系统深度实践
Default operation step duration：最小是60秒。若设置为1小时（即3600秒），则表明执
以下对各部分进行详细说明。
随后会出现配置一个新的Operation的界面，如图6-4所示。
在配置Action的Operation标签页时，可以看到目前配置的Operation，单击“New”按钮，
（4）关联到一个Template。
（3）添加到一个Host group。
（2）禁用一个Hosto
行了一个操作后，要等待1小时，才会执行下一个操作。
CONFIGURATIONOFACTIONS
Defaultoperationstepduration
iction
efauitopera
ctlon
Conditions
Operatior
Action operations
SaveCloneDeteCance
Save
details
Operations
CloneDeiete
AddCancel
3600（minimum
Defauttime
Send to Users
Step
Steps Detalls
New
Steps Details
onditions
end only to
Caacel
A
Add
Send messad
Step.duration
图6-4
图6-3
Name
Action
0（minimum 60seconds,0-use action default）
1(0-infinitely)
Action
Action
Startin
Immediatel
irat
Action
Action
---
## Page 116
有如下几点。
（比如 PHP进程重启），也需要将出错的信息及时发送给负责人。对于“Send message”的配置
流程。下面，一起看下如何订制Operation。
一边向ZabbixAgent发出命令，让它重启PHP服务器上的PHP进程。这是非常棒的报警处理
的功能。比方说，当一台PHP服务器的PHP进程意外退出后，Zabbix一边发送邮件给负责人，
是对报警有应急的措施。前者对应的是“Sendmessage”的功能，后者是“Remote command
command”是最重要的两个Operation。报警的核心是什么？其一，是将问题通知到负责人;其二，
首先看“Send message”，这个应该是所有 Action 都会具备的Operation。就算能够自动恢复
Opertaion具体执行的操作，是Operation 的核心。在Zabbix中，“Send message”和“Remote
注意：对于discovery事件和 auto-registration 事件，可以在这里选择更多的操作。
下面我们看看Operation details的设置。
@Operation details：用来设置一个Operation的具体设置。
·Operation type：选择操作的类型，可以选择的有如下两种。
·Step duration：每一步持续的时间，如果填0，就使用上面的“Default operation step
·To：表明到哪一步结束。
·From：表明从哪一步开始。
·Step：在Escalation的过程中的执行计划。
·Start in：在Event 发生后多久执行操作。
·Details:操作的类型和目标。从 Zabbix2.2开始,还会显示在发送信息时的 media type(电
·Steps:在escalation（报警的扩散、升级）的时候，会按照 Step的顺序来执行，从1开始。
duration，那么会选择最短的那个生效。
Duration(sec)：显示的是 Step 的持续时间，如果 Step使用了默认的“持续时间"，那么
－Send message：给用户发送信息（这里的信息可以是邮件等）。
duration”中的值。可以在同一个步骤中，进行多个操作。如果这些操作有多个
显示“Default”。
子邮件、SMS、Jabber等），用户的名字也会显示。
Remote command：远程执行命令。
Duration(sec) 和 Actiona
第6章报警配置
●101°
---
## Page 117
102°
以看到过去一段时间内发生的所有Action。
表示Action已经被处罚了；“Failed”表示没有Action触发成功。
Monitoring-Events 中可以看到有触发的Action的列表。红色表示Action是失败的；“In progress
如图6-5所示左侧的“Z”。
限的用户。Trigger中至少一个表达式关联的Host是正常工作的，即在 Host中看到是绿色的标识，
Zabbix监控系统深度实践
Conditions：后面进行单独介绍。
@ Execute on：可以选择在 Zabbix agent 还是 Zabbix server 上运行命令。
Type：选择执行的命令的类型，其中“IPMI"、“SSH"、“Telnet”很好理解，主要看剩下
@ Target ist：选择命令执行的 Host，可以选择发生问题的 Host，指定某个 Host 或者 Host group。
“Remote command”的参数有以下几种。