Fitted Zipf-like Distribution Tail
Query Rank, r
(c) Queries by Both 
North America & Europe 
 10
100
However, the methodology can be extended in a straight-forward 
way to more geographical regions. 
4.7  Generating Synthetic Workloads 
In this section we outline how to apply the characteristics derived 
in  Sections  4.1  to  4.6  to  generate  P2P  file  sharing  system 
workloads. Consider a system in steady state with N peers. When 
a peer finishes a session, it is replaced by a new peer. All peers 
are modeled according as described in Figure 12. The evaluation 
is  performed  for  a  given  time  of  day,  which  is  selected  before 
workload  generation.  For  simplicity,  we  spell  out  conditional 
distributions for North American peers only. The algorithm can 
be applied for peers from other geographical regions by using the 
corresponding conditional distributions identified in Sections 4.1 
to 4.6.  
5.  CONCLUSIONS 
This  paper  provides  a  detailed  characterization  of  the  query 
behavior of peers in a peer-to-peer (P2P) file sharing system. The 
measures  include  the  fraction  of  connected  sessions  that  are 
completely  passive,  the  duration  of  such  sessions,  and  for  each 
active  session,  the  number  of  queries  issued,  query  interarrival 
time,  time  until  first  query,  time  after  last  query,  and  query 
popularity. The characterization captures the key correlations in 
the  observed  workload  measures  as  well  as  correlation  with 
geographic  region  and  time  of  day,  such  that  the  measured 
behavior can be used in constructing realistic synthetic workloads 
for evaluating new P2P system designs. 
Key  new  observations 
re-queries 
generated  by  the  client  software  have  a  significant  impact  on 
most  workload  measures  and  thus  have  to  be  filtered  for 
characterizing  user  behavior,  (2)  the  100  most  popular  queries 
changes  significantly  from  one  day  to  the  next,  (3)  97%  of  the 
queries  issued  from  peers  in  North  America  are  not  issued  by 
peers  in  Europe,  and  vice  versa,  (4)  the  number  of  queries  per 
session  and  passive  session  duration  are  also  sensitive  to 
geographic region, with peers in Europe issuing more queries per 
session and having longer passive session durations, on average, 
and (5) the time between the last query in an active session and the 
end of the session has a much heavier tail than the time between 
queries.  
Future work includes characterizing the query hit rate of the peers, 
including the correlation of hit rate with other measures. 
(1)  automated 
include: 
For each peer: 
(1)  Select  the  geographical  region,  each  with  probability 
conditioned on time of day as given by Figure 1. 
(2)  Determine whether the peer is passive or active, each with 
the  probability  conditioned  on  geographical  region,  as 
given by Figure 4. 
(3)  If the peer is passive: 
(a)  Choose  the  connected  session  length  conditioned  on 
time of day according to Table A.I 
(4)  If the peer is active: 
(a)  Determine 
the  number  of  queries  per  session 
conditioned on geographical region according to Table 
A.II 
(b)  Determine the time until first query conditioned on the 
number of queries and time of day, e.g., according to 
Table A.III for North American peers. 
(c)  For each query: 
(i)  Determine the query interarrival time conditioned 
on time of day, e.g., according to Table A.IV for 
North American peers. 
(ii)  Determine  the  class  of  the  query  according  to 
Table 3.  
(iii)  Determine the rank of the query according to the 
distribution  of  rank  for  the  query  class,  e.g., 
according  to  Figure  11(a)  for  queries  by  North 
American peers only. 
(d)  Determine  the  time  after  last  query  conditioned  on 
time of day according to Table A.V 
Figure 12. Algorithm for generating a synthetic workload 
6.  ACKNOWLEDGEMENTS 
The  authors  thank  Carey  Williamson  for  his  comments  which 
substantially improved the presentation of this paper. 
7.  REFERENCES 
[1]  E.  Adar  and  B.  Hubermann,  Free  Riding  on  Gnutella, 
Technical Report, Xerox PARC, 2000. 
[2]  R.  Bhagwan,  S.  Savage,  and  G.  Voelker,  Understanding 
Availability,  Proc.  2nd  Int.  Workshop  on  P2P  Systems, 
Berkeley, CA, 2002. 
[3]  Y. Chawathe, S. Ratnasamy, L. Breslau, N. Lanham, and S. 
Shenker, Making Gnutella-like P2P Systems Scalable, Proc. 
ACM Conf. on Applications, Technologies, Architectures, and 
Protocols  for  Computer  Communication  (SIGCOMM  ’03), 
Karlsruhe, Germany, 2003. 
J. Chu, K. Labonte, and B.Levine, Availability and Locality 
Measurements  of  Peer-to-Peer  File  Systems,  Proc.  SPIE 
ITCom:  Scalability  and  Traffic  Control  in  IP  Networks, 
Boston. MA, 2002. 
[4] 
[5]  E.  Cohen  and  S.  Schenker,  Replication  Strategies 
in 
Unstructured  Peer-to-Peer  Networks,  Proc.  ACM  Conf.  on 
Applications, Technologies, Architectures, and Protocols for 
Computer Communication (SIGCOMM ’02), Pittsburgh, PA, 
2002. 
[6]  Collab.Net 
and 
http://www.jxta.org. 
Sun 
Microsystems, 
2003. 
[7]  Z.  Ge,  D.  R.  Figueiredo,  S.  Jaiswal,  J.  Kurose,  and  D. 
Towsley,  Modeling  Peer-Peer  File  Sharing  Systems,  Proc. 
IEEE Conference on Computer Communications (INFOCOM 
‘03), San Francisco, CA, 2003.  
[8]  Gnutella  Developer  Forum,  Gnutella  –  A  Protocol  for  a 
Revolution, 2003. http://rfc-gnutella.sourceforge.net. 
[9]  K. Gummadi, R. Dunn, S. Saroiu, S. Gribble, H. Levy, and J. 
Zahorjan,  Measurement,  Modeling,  and  Analysis  of  a  Peer-
to-Peer  File-Sharing  Workload,  Proc.  19th  ACM  Symp.  on 
Operating Systems Principles, Bolton Landing, NY, 2003. 
[10]  MaxMind, 
LLC, 
http://www.maxmind.com. 
Geotargeting 
IP 
Address, 
[11]  A. Mahanti, D. Eager, and C. Williamson, Temporal Locality 
Impact  on  Web  Proxy  Cache  Performance, 
and 
Performance Evaluation 42, 187-203, 2000. 
its 
APPENDIX 
[12]  Mutella Hompage. http://mutella.sourceforge.net. 
[13]  Napster Homepage. http://www.napster.com. 
[14]  S.  Ratnasamy,  P.  Francis,  M.  Handley,  R.  Karp,  and  S. 
Shenker,  A  Scalable  Content-Addressable  Network,  Proc. 
ACM Conf. on Applications, Technologies, Architectures, and 
Protocols  for  Computer  Communication  (SIGCOMM  ’01), 
San Diego, CA., 2001. 
[15]  S. Saroiu, K. P. Grummadi, R. J. Dunn, S. D. Gribble, and H. 
M. Levy, An Analysis of Internet Content Delivery Systems, 
Proc.  5th  Symposium  on  Operating  Systems  Design  and 
Implementation (OSDI ’02), Boston, MA, 2002. 
[16]  S.  Saroiu,  K.  Gummadi,  and  S.  Gribble,  A  Measurement 
Study  of  Peer-to-Peer  File  Sharing  Systems,  Proc. 
Multimedia  Computing  and  Networking  (MMCN  ‘02),  San 
Jose, CA, 2002. 
[17]  S.  Sen  and  J.  Wang,  Analyzing  P2P  Traffic  Across  Large 
Networks,  Proc.  2nd  Internet  Measurement  Workshop  (IMW 
’02), Marseilles, France, 2002. 
[18]  Sharman Networks Ltd., http://www.kazaa.org. 
[19]  I.  Stoica,  R.  Morris,  D.  Karger,  F.  Kaashoek,  and  H. 
Balakrishnan,  Chord:  A  Scalable  Peer-to-Peer  Lookup 
Service  for  Internet  Applications,  Proc.  ACM  Conf.  on 
Applications, Technologies, Architectures, and Protocols for 
Computer Communication (SIGCOMM ’01), San Diego, CA, 
2001. 
[20]  K.  Sripanidkulchai,  The  Popularity  of  Gnutella  Queries  and 
its  Implications  on  Scalability,  Featured  on  O'Reilly's 
www.openp2p.com website, February 2001. 
[21]  StreamCast Networks, http://www.morpheus.com. 
[22]  B. Yang and H. Garcia-Molina, Comparing Hybrid Peer-to-
Peer Systems. Proc. 27th Int. Conf. on Very Large Data Bases 
(VLDB ’02), Rome, Italy, 2001. 
x
>
s
e
i
r
e
u
Q
#
h
t
i
s
n
o
i
s
s
e
S
f
o
n
o
i
t
c
a
r
F
w
 1
 0.1
 0.01
Measured
Fitted Lognormal
s
n
o
i
s
s
e
S
f
o
n
o
i
t
c
a
r
F
x
>
e
m
T
i
h
t
i
w
 1
 10
Number of Queries, x
 1
 0.1
 0.01
Measured Time
Fitted Weibull Body
Fitted Lognormal Tail
 10
 1
Time Until First Query, x (sec)
 1000
 10000 100000
 100
h
t
i
x
>
e
m
T
i
l
a
v
i
r
r
a
r
e
t
n
I
w
s
e
i
r
e
u
Q
f
o
n
o
i
t
c
a
r
F
 1
 0.1
 0.01
 1
Measured
Fitted Lognormal Body
Fitted Pareto Tail
 10
 100
Interarrival Time, x (sec)
 1000
10000
(a) Number of Queries Per Active Session  
(b) Time Until First Query,  
 2 minutes   (25%) 
Body: 1-2 minutes (55%) 
Tail: > 2 minutes   (45%) 
distribution function 
Lognormal 
Lognormal 
Lognormal 
Lognormal 
parameters 
σ = 2.502  µ = 2.108 
σ = 2.749  µ = 6.397 
σ = 2.383  µ = 2.201 
σ = 2.848  µ = 6.817 
Table A.2. Active Session Length (number of queries per session) 
Geographical region 
North America 
Europe 
Asia 
Fitted distribution 
Lognormal 
Lognormal 
Lognormal 
Matched parameters 
σ = 1.360  µ = -0.0673 
σ = 1.306  µ = 0.520 
σ = 1.618  µ = -1.029 
Table A.3. Time Until First Query for North American Peers 
Time of day period 
Number  of  queries 
per session 
 3 queries 
 3 queries 
Fitted 
distribution 
Weibull 
Lognormal 
Weibull 
Lognormal 
Weibull 
Lognormal 
Body: 0-45 seconds 
Tail: > 45 seconds 
Body: 0-45 seconds 
Tail: > 45 seconds 
Body: 0-45 seconds 
Tail: > 45 seconds 
Body: 64-120 seconds  Weibull 
Tail: > 120 seconds 
Body: 64-120 seconds  Weibull 
Tail: > 120 seconds 
Body: 64-120 seconds  Weibull 
Tail: > 120 seconds 
Lognormal 
Lognormal 
Lognormal 
Matched parameters 
α = 1.477  λ = 0.005252 
σ = 2.905  µ = 5.091 
α = 1.261  λ = 0.01081 
σ = 2.045  µ = 6.303 
α = 0.9821  λ = 0.02662 
σ = 2.359  µ = 6.301 
α = 1.159  λ = 0.01779 
σ = 3.384  µ = 5.144 
α = 1.207  λ = 0.01446 
σ = 2.324  µ = 6.400 
α = 0.9351  λ = 0.03380 
σ = 2.463  µ = 7.186 
Table A.4. Query Interarrival Time of North American Peers 
Time of day period 
Peak for North American peers 
Non-peak 
peers 
for  North  American 
Body: ≤ 103 seconds 
Tail: > 103 seconds 
Body: ≤ 103 seconds 
Tail: > 103 seconds 
Fitted distribution 
Lognormal 
Pareto 
Lognormal 
Pareto 
Matched parameters 
σ = 1.625  µ = 3.353 
α = 0.9041  β = 103 
σ = 1.410  µ = 2.933 
α = 1.143  β = 103 
Table A.5. Time After Last Query of North American Peers 
Time of day period 
Peak for North American peers 
Non-peak for North American peers 
Number  of  queries  per 
session 
1 query 
2-7 queries 
> 7 queries 
1 query 
2-7 queries 
> 7 queries 
Fitted distribution 
Lognormal 
Lognormal 
Lognormal 
Lognormal 
Lognormal 
Lognormal 
Matched parameters 
σ = 2.361  µ = 4.879 
σ = 2.259  µ = 5.686 
σ = 2.145  µ = 6.107 
σ = 2.162  µ = 4.760 
σ = 2.156  µ = 5.672 
σ = 2.286  µ = 6.036