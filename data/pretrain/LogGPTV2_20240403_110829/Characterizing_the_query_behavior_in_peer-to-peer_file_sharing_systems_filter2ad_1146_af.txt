# Fitted Zipf-like Distribution Tail
## Query Rank, r
### Queries by Both North America & Europe
- 10
- 100

The methodology can be straightforwardly extended to more geographical regions.

## 4.7 Generating Synthetic Workloads
In this section, we outline how to apply the characteristics derived in Sections 4.1 to 4.6 to generate P2P file-sharing system workloads. Consider a system in steady state with \( N \) peers. When a peer finishes a session, it is replaced by a new peer. All peers are modeled as described in Figure 12. The evaluation is performed for a given time of day, which is selected before workload generation. For simplicity, we spell out conditional distributions for North American peers only. The algorithm can be applied to peers from other geographical regions by using the corresponding conditional distributions identified in Sections 4.1 to 4.6.

## 5. Conclusions
This paper provides a detailed characterization of the query behavior of peers in a peer-to-peer (P2P) file-sharing system. The measures include the fraction of connected sessions that are completely passive, the duration of such sessions, and for each active session, the number of queries issued, query interarrival time, time until the first query, time after the last query, and query popularity. The characterization captures the key correlations in the observed workload measures as well as correlations with geographic region and time of day, such that the measured behavior can be used in constructing realistic synthetic workloads for evaluating new P2P system designs.

### Key New Observations
1. Automated re-queries generated by the client software have a significant impact on most workload measures and thus must be filtered for characterizing user behavior.
2. The 100 most popular queries change significantly from one day to the next.
3. 97% of the queries issued from peers in North America are not issued by peers in Europe, and vice versa.
4. The number of queries per session and passive session duration are also sensitive to geographic region, with peers in Europe issuing more queries per session and having longer passive session durations, on average.
5. The time between the last query in an active session and the end of the session has a much heavier tail than the time between queries.

Future work includes characterizing the query hit rate of the peers, including the correlation of hit rate with other measures.

### Algorithm for Generating a Synthetic Workload
For each peer:
1. Select the geographical region, each with probability conditioned on the time of day as given by Figure 1.
2. Determine whether the peer is passive or active, each with the probability conditioned on the geographical region, as given by Figure 4.
3. If the peer is passive:
   - Choose the connected session length conditioned on the time of day according to Table A.I.
4. If the peer is active:
   - Determine the number of queries per session conditioned on the geographical region according to Table A.II.
   - Determine the time until the first query conditioned on the number of queries and time of day, e.g., according to Table A.III for North American peers.
   - For each query:
     - Determine the query interarrival time conditioned on the time of day, e.g., according to Table A.IV for North American peers.
     - Determine the class of the query according to Table 3.
     - Determine the rank of the query according to the distribution of rank for the query class, e.g., according to Figure 11(a) for queries by North American peers only.
   - Determine the time after the last query conditioned on the time of day according to Table A.V.

## 6. Acknowledgements
The authors thank Carey Williamson for his comments, which substantially improved the presentation of this paper.

## 7. References
[1] E. Adar and B. Hubermann, "Free Riding on Gnutella," Technical Report, Xerox PARC, 2000.
[2] R. Bhagwan, S. Savage, and G. Voelker, "Understanding Availability," Proc. 2nd Int. Workshop on P2P Systems, Berkeley, CA, 2002.
[3] Y. Chawathe, S. Ratnasamy, L. Breslau, N. Lanham, and S. Shenker, "Making Gnutella-like P2P Systems Scalable," Proc. ACM Conf. on Applications, Technologies, Architectures, and Protocols for Computer Communication (SIGCOMM '03), Karlsruhe, Germany, 2003.
[4] J. Chu, K. Labonte, and B. Levine, "Availability and Locality Measurements of Peer-to-Peer File Systems," Proc. SPIE ITCom: Scalability and Traffic Control in IP Networks, Boston, MA, 2002.
[5] E. Cohen and S. Schenker, "Replication Strategies in Unstructured Peer-to-Peer Networks," Proc. ACM Conf. on Applications, Technologies, Architectures, and Protocols for Computer Communication (SIGCOMM '02), Pittsburgh, PA, 2002.
[6] Collab.Net and Sun Microsystems, "http://www.jxta.org," 2003.
[7] Z. Ge, D. R. Figueiredo, S. Jaiswal, J. Kurose, and D. Towsley, "Modeling Peer-Peer File Sharing Systems," Proc. IEEE Conference on Computer Communications (INFOCOM '03), San Francisco, CA, 2003.
[8] Gnutella Developer Forum, "Gnutella – A Protocol for a Revolution," 2003. http://rfc-gnutella.sourceforge.net.
[9] K. Gummadi, R. Dunn, S. Saroiu, S. Gribble, H. Levy, and J. Zahorjan, "Measurement, Modeling, and Analysis of a Peer-to-Peer File-Sharing Workload," Proc. 19th ACM Symp. on Operating Systems Principles, Bolton Landing, NY, 2003.
[10] MaxMind, LLC, "Geotargeting IP Address," http://www.maxmind.com.
[11] A. Mahanti, D. Eager, and C. Williamson, "Temporal Locality Impact on Web Proxy Cache Performance," and Performance Evaluation 42, 187-203, 2000.
[12] Mutella Homepage. http://mutella.sourceforge.net.
[13] Napster Homepage. http://www.napster.com.
[14] S. Ratnasamy, P. Francis, M. Handley, R. Karp, and S. Shenker, "A Scalable Content-Addressable Network," Proc. ACM Conf. on Applications, Technologies, Architectures, and Protocols for Computer Communication (SIGCOMM '01), San Diego, CA, 2001.
[15] S. Saroiu, K. P. Grummadi, R. J. Dunn, S. D. Gribble, and H. M. Levy, "An Analysis of Internet Content Delivery Systems," Proc. 5th Symposium on Operating Systems Design and Implementation (OSDI '02), Boston, MA, 2002.
[16] S. Saroiu, K. Gummadi, and S. Gribble, "A Measurement Study of Peer-to-Peer File Sharing Systems," Proc. Multimedia Computing and Networking (MMCN '02), San Jose, CA, 2002.
[17] S. Sen and J. Wang, "Analyzing P2P Traffic Across Large Networks," Proc. 2nd Internet Measurement Workshop (IMW '02), Marseilles, France, 2002.
[18] Sharman Networks Ltd., http://www.kazaa.org.
[19] I. Stoica, R. Morris, D. Karger, F. Kaashoek, and H. Balakrishnan, "Chord: A Scalable Peer-to-Peer Lookup Service for Internet Applications," Proc. ACM Conf. on Applications, Technologies, Architectures, and Protocols for Computer Communication (SIGCOMM '01), San Diego, CA, 2001.
[20] K. Sripanidkulchai, "The Popularity of Gnutella Queries and its Implications on Scalability," Featured on O'Reilly's www.openp2p.com website, February 2001.
[21] StreamCast Networks, http://www.morpheus.com.
[22] B. Yang and H. Garcia-Molina, "Comparing Hybrid Peer-to-Peer Systems," Proc. 27th Int. Conf. on Very Large Data Bases (VLDB '02), Rome, Italy, 2001.

## Appendix
### Table A.2. Active Session Length (number of queries per session)
| Geographical Region | Fitted Distribution | Matched Parameters |
|---------------------|---------------------|--------------------|
| North America       | Lognormal           | σ = 2.502, µ = 2.108 |
| Europe              | Lognormal           | σ = 2.749, µ = 6.397 |
| Asia                | Lognormal           | σ = 2.383, µ = 2.201 |

### Table A.3. Time Until First Query for North American Peers
| Time of Day Period | Number of Queries per Session | Fitted Distribution | Matched Parameters |
|--------------------|------------------------------|---------------------|--------------------|
| Peak               | 3 queries                    | Weibull             | α = 1.477, λ = 0.005252 |
|                    |                              | Lognormal           | σ = 2.905, µ = 5.091 |
| Non-peak           | 3 queries                    | Weibull             | α = 1.261, λ = 0.01081 |
|                    |                              | Lognormal           | σ = 2.045, µ = 6.303 |

### Table A.4. Query Interarrival Time of North American Peers
| Time of Day Period | Fitted Distribution | Matched Parameters |
|--------------------|---------------------|--------------------|
| Peak               | Lognormal           | σ = 1.625, µ = 3.353 |
|                    | Pareto              | α = 0.9041, β = 103 |
| Non-peak           | Lognormal           | σ = 1.410, µ = 2.933 |
|                    | Pareto              | α = 1.143, β = 103 |

### Table A.5. Time After Last Query of North American Peers
| Time of Day Period | Number of Queries per Session | Fitted Distribution | Matched Parameters |
|--------------------|------------------------------|---------------------|--------------------|
| Peak               | 1 query                      | Lognormal           | σ = 2.361, µ = 4.879 |
|                    | 2-7 queries                  | Lognormal           | σ = 2.259, µ = 5.686 |
|                    | > 7 queries                  | Lognormal           | σ = 2.145, µ = 6.107 |
| Non-peak           | 1 query                      | Lognormal           | σ = 2.162, µ = 4.760 |
|                    | 2-7 queries                  | Lognormal           | σ = 2.156, µ = 5.672 |
|                    | > 7 queries                  | Lognormal           | σ = 2.286, µ = 6.036 |