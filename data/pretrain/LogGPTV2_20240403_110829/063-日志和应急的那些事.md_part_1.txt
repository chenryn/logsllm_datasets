æ—¥å¿—å’Œåº”æ€¥çš„é‚£äº›äº‹
åŸåˆ›æµ·å²¸çº¿çªå‡»é˜Ÿ é…’ä»™æ¡¥å…­å·éƒ¨é˜Ÿ
2020-08-19åŸæ–‡
è¿™æ˜¯ é…’ä»™æ¡¥å…­å·éƒ¨é˜Ÿ çš„ç¬¬ 63 ç¯‡æ–‡ç« ã€‚
å…¨æ–‡å…±è®¡7453ä¸ªå­—ï¼Œé¢„è®¡é˜…è¯»æ—¶é•¿20åˆ†é’Ÿã€‚
æ¦‚è¿°
å¦‚æœæŠŠåº”æ€¥å“åº”äººå‘˜ï¼Œæ¯”ä½œæ˜¯åŒ»ç”Ÿçš„è¯ï¼Œé‚£æ—¥å¿—å°±æ˜¯ç—…äººçš„è‡ªæˆ‘ç—‡
çŠ¶æè¿°ï¼Œè¶Šè¯¦ç»†ï¼Œè¶Šèƒ½äº†è§£ç—…äººçš„æƒ…å†µï¼Œå®‰å…¨ä¹Ÿæ˜¯ä¸€æ ·ï¼Œä¸€ä¸ªç³»ç»Ÿ
å¯èƒ½æœ‰å¾ˆå¤šç–‘éš¾æ‚ç—‡ï¼Œä½†åªè¦äº†è§£è¶³å¤Ÿå¤šçš„ä¿¡æ¯ï¼Œå°±èƒ½å¯¹ç—‡ä¸‹è¯ï¼Œ
åœ¨åŒ»ç”Ÿçœ‹ç—…æ—¶ç—…äººçš„æè¿°å’ŒåŒ–éªŒå•ä¸Šçš„æ•°æ®å¯¹åŒ»ç”Ÿæ˜¯éå¸¸é‡è¦çš„ã€‚
åŒç†æ—¥å¿—åœ¨å®‰å…¨ä¸“å®¶ä¸­çš„ä½œç”¨ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚
å¸¸è§çš„æ—¥å¿—åˆ†ææ‰‹æ®µï¼Œå°±æ˜¯äººå·¥æ‰‹åŠ¨å‘½ä»¤åˆ†æï¼Œè‡ªæˆ‘ç¼–å†™è„šæœ¬è¿›è¡Œ
åˆ†æï¼Œæˆ–è€…æ˜¯ä½¿ç”¨å¼€æºå·¥å…·è¿›è¡Œåˆ†æï¼Œæ‰¾å‡ºç³»ç»Ÿçš„è–„å¼±ç‚¹ï¼Œå¤–éƒ¨çš„
æ”»å‡»æ‰‹æ®µï¼Œå…¥ä¾µçš„ç—•è¿¹ï¼Œæº¯æºï¼Œç”šè‡³ä»æ—¥å¿—ä¸­å‘ç°0dayï¼Œä¸‹é¢æµ…è°ˆ
è¿™ä¸‰ç§æ–¹å¼ã€‚
æ‰‹åŠ¨æ—¥å¿—åˆ†æ
ç®€è¿°
å¯¹äºæ‰‹å·¥æ—¥å¿—æ’æŸ¥ï¼Œåªè¦shellç©çš„æºœï¼ŒLinuxçš„ä¸‰å‰‘å®¢èƒ½å¤Ÿèƒœä»»å¤§
éƒ¨åˆ†å·¥ä½œéœ€æ±‚ã€‚è¿™éƒ¨åˆ†å¾ˆå¤šå®‰å…¨äººå‘˜éƒ½äº†è§£ã€‚ä¼˜ç‚¹ç®€å•é«˜æ•ˆï¼Œèƒ½åˆ
æ­¥åˆ†æï¼Œä¸éœ€è¦ä¸€äº›é¢å¤–çš„å·¥å…·ã€‚ç¼ºç‚¹ä¹Ÿæ˜¯å¾ˆæ˜æ˜¾ï¼Œä¸èƒ½å¤§è§„æ¨¡åˆ†
æï¼Œéœ€è¦ä¸€å°å°å»çœ‹ï¼Œéœ€è¦å¯¹å‘½ä»¤ä½¿ç”¨ç‰¹åˆ«ç†Ÿæ‚‰ï¼Œå¯¹æ–°æ‰‹ä¸å¤ªå‹å¥½
ï¼Œå·¥ä½œé‡æ¯”è¾ƒå¤§ã€‚
ç®€å•åˆ†æä¸€ä¸ªé¶æœºæµ‹è¯•æ¡ˆä¾‹ï¼š
 ä½¿ç”¨awkæ¥å°†æ—¥å¿—é‡Œé¢çš„æ‰€æœ‰çš„IPç­›é€‰å‡ºæ¥ä¿å­˜åˆ°ä¸€ä¸ªæ–‡æœ¬æ–‡æ¡£
ä¸­ã€‚
awk '{print $1}' access.log >ip.txt
 å°† ip.txt æ–‡ ä»¶ ä¸­ çš„ IP è¿› è¡Œ æ’ åº ï¼Œ å» é‡ å’Œ è®¡ æ•° ã€‚ è¿™ ä¸ª
192.168.2.7
IPè®¿é—®æ¬¡æ•°è¿‡å¤šï¼Œè‚¯å®šæ˜¯æœ‰é—®é¢˜çš„,åç»­å¯¹è¿™ä¸ªipè¿›è¡Œé‡ç‚¹æ’æŸ¥
ã€‚
sort ip.txt |uniq -c
 æ ¹ æ® ä¸Š é¢ å‘ ç° ip 192.168.2.7
çŸ­æ—¶é—´å¯¹ç›®æ ‡ç½‘ç«™å‘èµ·äº†å¤§é‡çš„è¯·æ±‚ã€‚
 åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°æŠ¥å‡ºäº†å¤§é‡çš„404ï¼Œè¯·æ±‚æ–¹å¼ä¸ºHEADï¼Œæ ¹æ®è¿™äº›
å¯ä»¥åˆ¤æ–­ã€‚192.168.2.7è¿™ä¸ªIPåœ¨2020å¹´7æœˆ18æ—¥14:20:23å¯¹
ç½‘ç«™è¿›è¡Œäº†æ‰«æï¼Œä»¥æ­¤æ¥åˆ¤æ–­ç½‘ç«™å­˜åœ¨çš„ä¸€äº›æ•æ„Ÿæ–‡ä»¶ã€‚
 ä» ä¸‹ é¢ æ—¥ å¿— å¯ ä»¥ çœ‹ å‡º æ”» å‡» ip è®¿ é—® ç™» å½• æ¥ å£ ï¼Œ è¿› è¡Œ çˆ† ç ´ ï¼Œ å¹¶ åœ¨
2020 å¹´ 7 æœˆ 18 æ—¥ 16:29:35
çˆ†ç ´æˆåŠŸï¼Œè¿›è¡Œç™»å½•ï¼Œæ—¥å¿—çŠ¶æ€è¿”å›200ã€‚
 è®¿é—®äº†phpinfoæ•æ„Ÿæ–‡ä»¶ã€‚
 ä¸€èˆ¬çš„æ”»å‡»è€…ç™»å½•æˆåŠŸåï¼Œåœ¨åå°ä¸€èˆ¬éƒ½æ˜¯æ‰¾ä¸Šä¼ ç‚¹æˆ–è€…å‘½ä»¤æ‰§
è¡Œçš„åœ°æ–¹è·å–shellã€‚ä¸æƒ³è·å–shellçš„é»‘å®¢(QVQä½ æ‡‚çš„)ã€‚åŒ¹
é… è·¯ ç”± å…³ äº upload
å…³é”®è¯æ—¥å¿—å‘ç°æ”»å‡»è€…å·²æˆåŠŸä¸Šä¼ shell.phpæ–‡ä»¶ã€‚
 å¯¹ shell.php
æ–‡ä»¶è¿›è¡ŒæŸ¥çœ‹ï¼Œå‘ç°æ˜¯å†°èæœ¨é©¬ã€‚åç»­éœ€è¦å¯¹ä¸»æœºå…¥ä¾µç—•è¿¹è¿›è¡Œ
æ’æŸ¥ã€‚ï¼ˆä¸‹æ–‡ä»¥ç¼–å†™è„šæœ¬çš„æ–¹å¼è¿›è¡Œç®€å•çš„é€é¡¹æ£€æµ‹ï¼‰
ç¼–å†™è„šæœ¬è¿›è¡Œåˆ†æ
ç®€è¿°
ç¼–å†™è„šæœ¬å¯ä»¥å¯¹ä¸€äº›æ£€æµ‹çš„é¡¹è¿›è¡Œè‡ªåŠ¨åŒ–å¤„ç†ï¼Œå‡å°‘ä»»åŠ¡é‡ï¼Œæœ‰å¯
é‡å¤æ€§ç­‰ä¼˜ç‚¹ã€‚ç¼ºç‚¹å¯¹å®‰å…¨äººå‘˜è¦æ±‚ä¸€å®šçš„ç¼–ç èƒ½åŠ›ï¼Œè„šæœ¬è¦è¿›è¡Œ
å¤§é‡æµ‹è¯•ï¼Œæ¯•ç«ŸæœåŠ¡å™¨æŒ‚äº†è¿™ä¸ªé£é™©è°ä¹Ÿæ‰¿æ‹…ä¸èµ·ğŸ˜† ã€‚
å¼€æºé¡¹ç›®
ç½‘ä¸Šæœ‰å¾ˆå¤šä¼˜ç§€å¼€æºçš„é¡¹ç›®ã€‚
https://github.com/Bypass007/Emergency-Response-Notes
https://github.com/grayddq/GScan.git
æ³¨æ„äº‹é¡¹
å¦‚ä½•ç¼–å†™ä¸€ä¸ªé€Ÿåº¦å¿«ï¼Œæ‰«æå ç”¨èµ„æºå°‘ï¼Œå¯¹ç³»ç»Ÿæ²¡æœ‰å±å®³çš„çš„æ‰«æ
è„šæœ¬å‘¢ï¼Ÿ
é¦–å…ˆè¦æ³¨æ„ä»¥ä¸‹å‡ ä»¶äº‹ï¼š
1. åªéœ€è¯»æ–‡ä»¶ï¼Œä¸è¦åšä¿®æ”¹æ–‡ä»¶æ“ä½œ
2. å°½é‡ä¸è¦ç”¨å¤šå±‚é€’å½’ï¼Œå¾ªç¯ã€‚
3. å¼‚å¸¸å¤„ç†ã€‚
4. è¾“å‡ºçš„æ ¼å¼åŒ–ã€‚
5. è„šæœ¬è¿è¡Œæƒé™æœ€å¥½ä¸è¦ç”¨root
6. ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„å‘½ä»¤æˆ–è€…å·¥å…·ï¼Œå…¼å®¹å„Linuxå‘è¡Œç‰ˆæœ¬ã€‚
ä¸‹é¢è‡ªå·±ç¼–å†™çš„æµ‹è¯•ä»£ç ä¸»è¦çš„åŠŸèƒ½ï¼š
â€¢ å£ä»¤ç”Ÿå­˜å‘¨æœŸæ£€æŸ¥
â€¢ ä»¤æ›´æ”¹æœ€å°‘æ—¶é—´é—´éš”
â€¢ å£ä»¤æœ€å°é•¿åº¦
â€¢ æ£€æŸ¥ç©ºå¼±å£ä»¤
â€¢ æ£€æŸ¥sudoæƒé™å¼‚å¸¸ç”¨æˆ·
â€¢ æ£€æŸ¥ç‰¹æƒç”¨æˆ·ç»„
â€¢ å£ä»¤è¿‡æœŸè­¦å‘Šæ—¶é—´å¤©æ•°
â€¢ æ‰¾érootè´¦å·UIDä¸º0çš„è´¦å·
â€¢ æ£€æŸ¥æ˜¯å¦å…è®¸rootè´¦å·ç™»å½•
â€¢ æ£€æŸ¥æ˜¯å¦å¼€å¯æ—¥å¿—å®¡è®¡auditd
â€¢ å†å²å‘½ä»¤ä¿å­˜çš„æœ€å¤§æ¡æ•°æ£€æµ‹
â€¢ æ£€æŸ¥æ˜¯å¦å¼€å¯telnet
â€¢ æ£€æŸ¥æ˜¯å¦å¼€å¯nfsæœåŠ¡
â€¢ æ£€æŸ¥é‡è¦ç³»ç»Ÿæ–‡ä»¶æƒé™
â€¢ æ£€æŸ¥å…å¯†ç ç™»å½•
Pythonä»£ç 
#coding:utf-8
import os
import json
class Linux_Check:
def __init__(self):
ipadd="ifconfig -a | grep Bcast | awk -F "[ :]+" '{print
$4}'"
self.passmax="cat /etc/login.defs | grep PASS_MAX_DAYS |
grep -v ^# | awk '{print $2}'"
self.passmin="cat /etc/login.defs | grep PASS_MIN_DAYS |
grep -v ^# | awk '{print $2}'"
self.passlen="cat /etc/login.defs | grep PASS_MIN_LEN | grep
-v ^# | awk '{print $2}'"
self.passage="cat /etc/login.defs | grep PASS_WARN_AGE |
grep -v ^# | awk '{print $2}'"
self.uid="awk -F[:] 'NR!=1{print $3}' /etc/passwd"
self.sshd_config="cat /etc/ssh/sshd_config | grep -v ^#
|grep 'PermitRootLogin no'"
self.bash_histrory="cat /etc/profile|grep HISTSIZE|head -
1|awk -F[=] '{print $2}'"
self.Result=[]
self.ssh_authorized_user={}
## å£ä»¤ç”Ÿå­˜å‘¨æœŸæ£€æŸ¥
def check_passmax(self):
result= {"name":"å£ä»¤ç”Ÿå­˜å‘¨æœŸæ£€æŸ¥",
"level":"middle","service":[""],"user":["root"],"filename":["/et
c/login.defs"],"port":[""],"src_port":[""],"dest_port":[""],"pid
":[""],"protocol":[""],"check":True}
try:
shell_process = os.popen(self.passmax).read()
if 0=6:
result["msg"]="å£ä»¤æ›´æ”¹æœ€å°æ—¶é—´é—´éš”ä¸º%så¤©ï¼Œç¬¦åˆè¦æ±‚"
%shell_process
else:
result["check"]=False
result["msg"]="å£ä»¤æ›´æ”¹æœ€å°æ—¶é—´é—´éš”ä¸º%så¤©ï¼Œä¸ç¬¦åˆè¦æ±‚ï¼Œå»ºè®®è®¾ç½®å¤§äºç­‰
äº6å¤©" %shell_process
except Exception as e:
result["error"]=str(e)
finally:
self.Result.append(result)
## å£ä»¤æœ€å°é•¿åº¦
def check_passlen(self):
result= {"name":"å£ä»¤æœ€å°é•¿åº¦",
"level":"middle","service":[""],"user":["root"],"filename":["/et
c/login.defs"],"port":[""],"src_port":[""],"dest_port":[""],"pid
":[""],"protocol":[""],"check":True}
try:
shell_process = os.popen(self.passlen).read()
if int(shell_process)>=8:
result["msg"]="å£ä»¤æœ€å°é•¿åº¦ä¸º%s,ç¬¦åˆè¦æ±‚"
%shell_process
else:
result["check"]=False
result["msg"]="ä»¤æœ€å°é•¿åº¦ä¸º%s,ä¸ç¬¦åˆè¦æ±‚ï¼Œå»ºè®®è®¾ç½®æœ€å°é•¿åº¦å¤§äºç­‰äº8"
%shell_process
except Exception as e:
result["error"]=str(e)
finally:
self.Result.append(result)
## æ£€æŸ¥ç©ºå¼±å£ä»¤
def check_empty(self):
result= {"name":"æ£€æŸ¥ç©ºå¼±å£ä»¤",
"level":"critical","service":[""],"user":["root"],"filename":["/
etc/shadow"],"port":[""],"src_port":[""],"dest_port":[""],"pid":
[""],"protocol":[""],"check":True}
try:
shell_process = os.popen("awk -F: 'length($2)==0
{print $1}' /etc/shadow 2>/dev/null").read().splitlines()
if not shell_process:
result["msg"]="ä¸å­˜åœ¨ç©ºå¼±å£ä»¤è´¦æˆ·"
else:
result["check"]=False
result["msg"]="å­˜åœ¨ç©ºå¼±å£ä»¤è´¦æˆ·%s"%str(shell_process)
except Exception as e:
result["error"]=str(e)
finally:
self.Result.append(result)
## æ£€æŸ¥sudoæƒé™å¼‚å¸¸ç”¨æˆ·
def check_sudo(self):
result= {"name":"æ£€æŸ¥sudoæƒé™å¼‚å¸¸ç”¨æˆ·",
"level":"critical","service":[""],"user":["root"],"filename":["/
etc/sudoers"],"port":[""],"src_port":[""],"dest_port":[""],"pid"
:[""],"protocol":[""],"check":True}
try:
shell_process = os.popen("cat /etc/sudoers
2>/dev/null |grep -v '#'|grep 'ALL=(ALL)'|awk '{print
$1}'").read().splitlines()
userinfo=[]
for user in shell_process:
if user.replace("\n", "") != 'root':
userinfo.append(user)
if not userinfo:
result["msg"]="ä¸å­˜åœ¨sduoç‰¹æƒå¼‚å¸¸ç”¨æˆ·"
else:
result["check"]=False
result["msg"]="å­˜åœ¨sudoæƒé™å¼‚å¸¸ç”¨æˆ·%s"%str(userinfo)
except Exception as e:
result["error"]=str(e)
finally:
self.Result.append(result)
## æ£€æŸ¥ç‰¹æƒç”¨æˆ·ç»„
def check_gid(self):
result= {"name":"æ£€æŸ¥ç‰¹æƒç”¨æˆ·ç»„",
"level":"critical","service":[""],"user":["root"],"filename":["/
etc/passwd"],"port":[""],"src_port":[""],"dest_port":[""],"pid":
[""],"protocol":[""],"check":True}
try:
shell_process = os.popen("cat /etc/passwd | grep
'/bin/bash' | awk -F: '$4==0 {print $1}'
2>/dev/null").read().splitlines()
userinfo=[]
for user in shell_process:
if user.replace("\n", "") != 'root':
userinfo.append(user)
if not userinfo:
result["msg"]="ä¸å­˜åœ¨ç‰¹æƒç»„ç”¨æˆ·"
else:
result["check"]=False
result["msg"]="å­˜åœ¨ç‰¹æƒç»„ç”¨æˆ·%s"%str(userinfo)
except Exception as e:
result["error"]=str(e)
finally:
self.Result.append(result)
## å£ä»¤è¿‡æœŸè­¦å‘Šæ—¶é—´å¤©æ•°
def check_passage(self):
result= {"name":"å£ä»¤è¿‡æœŸè­¦å‘Šæ—¶é—´å¤©æ•°",
"level":"info","service":[""],"user":["root"],"filename":["/etc/
login.defs"],"port":[""],"src_port":[""],"dest_port":[""],"pid":
[""],"protocol":[""],"check":True}
try:
shell_process = os.popen(self.passage).read()
if int(shell_process)>=30:
result["msg"]="å£ä»¤è¿‡æœŸè­¦å‘Šæ—¶é—´å¤©æ•°ä¸º%s,ç¬¦åˆè¦æ±‚"
%shell_process
else:
result["check"]=False
result["msg"]="å£ä»¤è¿‡æœŸè­¦å‘Šæ—¶é—´å¤©æ•°ä¸º%s,ä¸ç¬¦åˆè¦æ±‚ï¼Œå»ºè®®è®¾ç½®å¤§äºç­‰äº30
å¹¶å°äºå£ä»¤ç”Ÿå­˜å‘¨æœŸ" %shell_process
except Exception as e:
result["error"]=str(e)
finally:
self.Result.append(result)
## æ‰¾érootè´¦å·UIDä¸º0çš„è´¦å·
def check_uid(self):
result= {"name":"æŸ¥æ‰¾érootè´¦å·UIDä¸º0çš„è´¦å·",
"level":"critical","service":["ssh","sshd"],"user":["root"],"fil
ename":["/etc/passwd"],"port":[""],"src_port":[""],"dest_port":[
""],"pid":[""],"protocol":[""],"check":True}
try:
shell_process =
os.popen(self.uid).read().splitlines()
if "0" not in shell_process:
result["msg"]="ä¸å­˜åœ¨érootè´¦å·çš„è´¦å·UIDä¸º0ï¼Œç¬¦åˆè¦æ±‚"
else:
result["check"]=False
result["msg"]="å­˜åœ¨érootè´¦å·çš„è´¦å·UIDä¸º0ï¼Œä¸ç¬¦åˆè¦æ±‚"
except Exception as e:
result["error"]=str(e)
finally:
self.Result.append(result)
## æ£€æŸ¥æ˜¯å¦å…è®¸rootè´¦å·ç™»å½•
def check_sshdconfig(self):
result= {"name":"æ£€æŸ¥æ˜¯å¦å…è®¸rootè´¦å·ç™»å½•",
"level":"high","service":["ssh","sshd"],"user":["root"],"filenam
e":["/etc/ssh/sshd_config"],"port":["22"],"src_port":[""],"dest_
port":[""],"pid":[""],"protocol":[""],"check":True}
try:
shell_process =
os.popen(self.sshd_config).read().splitlines()
if shell_process:
result["msg"]="rootä¸èƒ½ç¨‹ç™»å½•ç¬¦åˆè¦æ±‚"
else:
result["check"]=False
result["msg"]="rootç”¨æˆ·å¯ä»¥è¿œç¨‹ç™»å½•ä¸ç¬¦åˆè¦æ±‚"
except Exception as e: