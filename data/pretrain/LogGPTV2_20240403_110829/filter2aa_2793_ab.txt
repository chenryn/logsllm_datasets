Radare2.......................................................................................................................................115
6.2.1
简介及安装.................................................................................................................... 115
6.2.2
框架组成及交互方式.................................................................................................... 115
6.2.3
命令行工具.................................................................................................................... 118
6.2.4
r2 命令............................................................................................................................122
6.3
GDB........................................................................................................................................... 125
6.3.1
组成架构........................................................................................................................125
6.3.2
工作原理........................................................................................................................125
6.3.3
基本操作........................................................................................................................127
6.3.4
增强工具........................................................................................................................130
6.4
其他常用工具............................................................................................................................132
6.4.1
dd....................................................................................................................................133
6.4.2
file.................................................................................................................................. 133
6.4.3
ldd...................................................................................................................................134
6.4.4
objdump..........................................................................................................................134
6.4.5
readelf.............................................................................................................................135
6.4.6
socat................................................................................................................................136
6.4.7
strace&ltrace...................................................................................................................136
6.4.8
strip.................................................................................................................................137
6.4.9
strings............................................................................................................................. 138
6.4.10
xxd................................................................................................................................138
参考资料.............................................................................................................................................139
第 7 章
漏洞利用开发............................................................................................................................ 141
7.1
shellcode 开发............................................................................................................................141
7.1.1
shellcode 的基本原理....................................................................................................141
7.1.2
编写简单的 shellcode....................................................................................................141
7.1.3
shellcode 变形................................................................................................................143
7.2
Pwntools.....................................................................................................................................145
7.2.1
简介及安装....................................................................................................................145
7.2.2
常用模块和函数............................................................................................................145
7.3
zio...............................................................................................................................................152
7.3.1
简介及安装....................................................................................................................152
7.3.2
使用方法........................................................................................................................153
参考资料.............................................................................................................................................155
第 8 章
整数安全.................................................................................................................................... 156
目录 ┃ XII
8.1
计算机中的整数........................................................................................................................ 156
8.2
整数安全漏洞............................................................................................................................157
8.2.1
整数溢出........................................................................................................................157
8.2.2
漏洞多发函数................................................................................................................158
8.2.3
整数溢出示例................................................................................................................159
参考资料.............................................................................................................................................161
第 9 章
格式化字符串............................................................................................................................ 162
9.1
格式化输出函数........................................................................................................................ 162
9.1.1
变参函数........................................................................................................................162
9.1.2
格式转换........................................................................................................................162
9.2
格式化字符串漏洞.................................................................................................................... 164
9.2.1
基本原理........................................................................................................................164
9.2.2
漏洞利用........................................................................................................................166
9.2.3
fmtstr 模块..................................................................................................................... 174
9.2.4
HITCON CMT 2017：pwn200......................................................................................176
9.2.5
NJCTF 2017：pingme................................................................................................... 178
参考资料.............................................................................................................................................182
第 10 章
栈溢出与 ROP........................................................................................................................ 183
10.1
栈溢出原理..............................................................................................................................183
10.1.1
函数调用栈..................................................................................................................183
10.1.2
危险函数......................................................................................................................186
10.1.3
ret2libc..........................................................................................................................186
10.2
返回导向编程..........................................................................................................................187
10.2.1
ROP 简介..................................................................................................................... 187
10.2.2
ROP 的变种................................................................................................................. 189
10.2.3
示例..............................................................................................................................191
10.3
Blind ROP................................................................................................................................ 192
10.3.1
BROP 原理...................................................................................................................192
10.3.2
HCTF 2016：brop........................................................................................................193
10.4
SROP........................................................................................................................................200
10.4.1
SROP 原理...................................................................................................................200
10.4.2
pwntools srop 模块.......................................................................................................204
10.4.3
Backdoor CTF 2017：Fun Signals.............................................................................. 204
10.5
stack pivoting............................................................................................................................206
10.5.1
stack pivoting 原理.......................................................................................................206
10.5.2
GreHack CTF 2017：beerfighter.................................................................................209
10.6
ret2dl-resolve............................................................................................................................213
目录 ┃ XIII
10.6.1
ret2dl-resolve 原理.......................................................................................................213
10.6.2
XDCTF 2015：pwn200............................................................................................... 217
参考资料.............................................................................................................................................222
第 11 章
堆利用...................................................................................................................................... 224
11.1
glibc 堆概述............................................................................................................................. 224
11.1.1
内存管理与堆.............................................................................................................. 224
11.1.2
重要概念和结构体...................................................................................................... 226
11.1.3
各类 bin 介绍...............................................................................................................229
11.1.4
chunk 相关源码........................................................................................................... 231
11.1.5
bin 相关源码................................................................................................................235
11.1.6
malloc_consolidate()函数.............................................................................................237
11.1.7
malloc()相关源码.........................................................................................................239
11.1.8
free()相关源码............................................................................................................. 248
11.2
TCache 机制.............................................................................................................................251
11.2.1
数据结构......................................................................................................................251
11.2.2
使用方法......................................................................................................................252
11.2.3
安全性分析.................................................................................................................. 255
11.2.4
HITB CTF 2018：gundam...........................................................................................257
11.2.5
BCTF 2018：House of Atum.......................................................................................263
11.3
fastbin 二次释放...................................................................................................................... 268
11.3.1
fastbin dup.................................................................................................................... 268
11.3.2
fastbin dup consolidate................................................................................................. 273
11.3.3
0CTF 2017：babyheap.................................................................................................275
11.4
house of spirit........................................................................................................................... 283
11.4.1
示例程序......................................................................................................................284
11.4.2
LCTF 2016：pwn200...................................................................................................287
11.5
不安全的 unlink.......................................................................................................................291
11.5.1
unsafe unlink................................................................................................................ 292
11.5.2
HITCON CTF 2016：Secret Holder............................................................................295
11.5.3
HITCON CTF 2016：Sleepy Holder...........................................................................303
11.6
off-by-one................................................................................................................................. 307
11.6.1
off-by-one.....................................................................................................................307
11.6.2
poison null byte............................................................................................................ 310
11.6.3
ASIS CTF 2016：b00ks...............................................................................................313
11.6.4
Plaid CTF 2015：PlaidDB...........................................................................................320
11.7
house of einherjar..................................................................................................................... 325
11.7.1
示例程序......................................................................................................................325
11.7.2
SECCON CTF 2016：tinypad..................................................................................... 328
目录 ┃ XIV
11.8
overlapping chunks...................................................................................................................336
11.8.1
扩展被释放块.............................................................................................................. 336
11.8.2
扩展已分配块.............................................................................................................. 339
11.8.3
hack.lu CTF 2015：bookstore......................................................................................342
11.8.4
0CTF 2018：babyheap.................................................................................................349
11.9
house of force........................................................................................................................... 353
11.9.1
示例程序......................................................................................................................353
11.9.2
BCTF 2016：bcloud.................................................................................................... 356
11.10
unsorted bin 与 large bin 攻击................................................................................................363
11.10.1
unsorted bin into stack................................................................................................363
11.10.2
unsorted bin attack......................................................................................................367
11.10.3
large bin 攻击............................................................................................................. 370
11.10.4
0CTF 2018：heapstorm2........................................................................................... 374
参考资料.............................................................................................................................................381
第 12 章
Pwn 技巧................................................................................................................................. 383
12.1
one-gadget................................................................................................................................ 383
12.1.1
寻找 one-gadget........................................................................................................... 383
12.1.2
ASIS CTF Quals 2017：Start hard...............................................................................385
12.2
通用 gadget 及 Return-to-csu...................................................................................................388
12.2.1
Linux 程序的启动过程................................................................................................388
12.2.2
Return-to-csu................................................................................................................390
12.2.3
LCTF 2016：pwn100.................................................................................................. 392
12.3
劫持 hook 函数........................................................................................................................ 395
12.3.1
内存分配 hook.............................................................................................................396
12.3.2
0CTF 2017 - babyheap................................................................................................. 397
12.4
利用 DynELF 泄露函数地址.................................................................................................. 401
12.4.1