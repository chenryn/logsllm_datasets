暴富后的圈套 酒仙桥六号
_
部队
- MdEditor
“ 暴富后的圈套
圈套诱因
近些年虚拟币越发的⽕爆，以及各种虚拟币相关的平台也
层出不穷的出现，当然圈套也层次不穷出现在我们身边，
近⽇穷得不⾏的我，也接到了来⾃声称能够带我⼀夜暴富
的电话，为了⼀探究竟，我就开始了卧薪尝胆之旅。
通过电话的指引，⼀名声称为客服的⼈，加上了我的微
信，并拉我进⼊了⼀个微信群，可以看到这个群的⼈也不
少，⾄于有多少⼈进⼊这场局不得⽽知。
进⼊群内有各⾊声称币圈⼤佬和⽼玩家的身影，在群内活
跃，⾄于这些⼈的身份真假，我也不敢说，我也不敢问。
但是没过⼏天群内群主号称某平台的客服开始出现，并推
出⼀种虚拟币的玩法，福利⼗分诱⼈，也是这引起了我的
兴趣。
这鲜明的标题，诱⼈的回报，让我这打⼯⼈是⼼动不已，
也正是这夸张的宣传，也暴露了它这平台的不可靠的感
觉。所以，为了揭开这场局完整的套路，就开始了⼀场艺
术之旅。
踩点圈套
起⼿就是 顿框架 端⼝ ⽬录 ⼦域名扫描操作猛如
起⼿就是⼀顿框架、端⼝、⽬录、⼦域名扫描操作猛如
⻁。
端⼝发现三个，基本可以确定是台 linux 的机器。
⽐较遗憾没有发现框架，可能是⼆开或者⾃写的平台、
⼦域名也⼀⽆所获 ···
⽬录扫描既然都没中，有可能是 waf 拦截或者路径是开
发作者定制过的，⽐较遗憾，直接 getshell 估计是没啥
希望了，就先攒着吧，细节有时决定成败。
艺术控权
踩点完毕，开始游⾛此带⼈暴富的平台。
由于没有注册账号功能，所以只好碰碰运⽓，看看有没有
遗留下来的测试账号未删除。
随⼿ 试 13888888888 提示账号不存在
随⼿⼀试 13888888888，提示账号不存在。。。
因为以前刷 SRC 有过蒙对⼿机号的经历，所以这⾥也试
了⼀下，直接 Burp 设置两个参数跑⼀下，还真就跑到⼀
个测试账号：13100000000/123456
登陆后发现给的好像是代理权限，没有发现可以上传的功
能，继续寻找漏洞点。
隐藏的⽐较深，在交易中⼼，买⼊卖出记录那⾥，点击记
录详情时抓包，会在 POST 包⾥抓到 id 参数，这个参数
存在 sql 注⼊。
判断为时间盲注，平常只有 60 左右。
加个 sleep() 试试，可以看到直接飙升到了 5000 多。
本想 sqlmap ⼀把梭，然鹅。。。
也就是下⾯这个⻚⾯。
找到先知社区发的⽂章试了试结果还真可以，运⽓真不
错。https://xz.aliyun.com/t/7522
部分 payload 形式参考：
and if(ascii(substr((/\*!50000%53elect\*/column_name f
information_schema.columns where table_schema=database
table_name='xxxx' limit 0,1),1,1))\>96,1,sleep/\*\*/(5
最终⼀点点注⼊拿到数据库名，表名，字段名，管理员⽤
户，密码 md5。
找了半天后台也没找到，后来发现竟然能从前台登录进
去，普通⽤户或者代理只有个⼈中⼼权限，只有具有超级
管理员权限的⽤户才有⼀个管理中⼼的权限，点击既可跳
转⾄后台。
在后台发现功能还挺多，但是有⽤的没多少。。。全是
money，找到⼀个上传图⽚的位置。
上传就⽐较好绕过了，⼀是⽹站后端写的垃圾，⼆是好像
没有 waf 啥事，应该是没有设置⽂件上传的相关的防
护。
前端 js 绕过，直接抓包改后缀即可，上传成功后返回了
路径。
权限提升
拿到 webshell 之后，尝试继续深⼊，但是发现只有列⽹
站⽬录的权限，⽽且⽆法执⾏命令。
看了下 phpinfo 发现过滤了很多函数。
看来没那么容易，需要 bypass disable_function，这⾥
打算试试蚁剑的 b 插件
打算试试蚁剑的 bypass 插件。
https://github.com/Medicean/as_bypass_php_disabl
e_functions
GC 模式直接 bypass 成功。
追溯⿊⼿
既然服务器已经拿了，那接下来进⼀步获取这个机器的信
息，由于我们权限不⾜，先看⼀下 / var/log/lastlog 和
/ var/log/wtmp 这两个⽂件（都是有记录登录 ip
的）。
然⽽，全是空的，此时⼼态有点崩。
看来这个平台的⼈还是⽐较谨慎，隐藏的很深，怀疑是后
台跑着什么脚本⾃动把⽇志全清了。
尝试⼀下 SUID 提权。
常⻅的可⽤于 SUID 提权的命令：Nmap、Vim、Find、
Bash、More、Less、Nano、Cp。
这⾥推荐⼀个⽹站：https://gtfobins.github.io/
bypassdisable_function 后的 shell 不知道为啥 find 搜
不到具有 SUID 权限的⽂件，所以⼿动试了试碰碰运⽓。
尝试了⼏个都失败了，后来发现 find 本身就存在
SUID，神奇。
提权后虽然权限⾼了，但是我的⽬的是想溯源到这个机器
所有者的真实信息，以 root 身份⼜逛了⼀圈，结果也没
有什么发现，事实证明在 root ⽬录下确实有个某脚本⽂