title:blackhat:asia-20 3d Red Pill:  A Guest-to-Host Escape on QEMU/KVM Virtio Device
As a critical para-virtualized driver platform for the hypervisor, virtio has been widely adopted in qemu/kvm virtual machine for better I/O performance. Vulnerabilities that have been explored so far fail to carry out guest-to-host escape, the impacts of which are relatively minor (e.g., crashing a virtual machine). In this talk, we demonstrate how our 3dRedPill exploit breaks the security measures of virtio-gpu devices, achieving a full guest-to-host escape exploitation. To our knowledge, this is the first guest-to-host escape exploit in the context of virtio device exploitation.Particularly, our 3dRedPill is based on a heap-overflow vulnerability (CVE-2019-18389), discovered in a known third-party library, virglrenderer, which is supposed to provide virtual 3D GPU for the guest machine. Although address space layout randomization (ASLR) is enforced by default, 3dRedPill was able to bypass it and hijack the control flows of victim programs. Here are the procedures: (i) Initially, our exploit obtains the leaked information from shared memory and search for hypervisor addresses, in order to bypass ASLR.(ii) Afterward, a victim structure is selected, and with the heap spray technique, the exploit can overwrite arbitrary data by manipulating data pointers.(iii) Finally, it hijacks the control flow by overwriting a specified pointer from hypervisor.While this vulnerability has been reported by us and patched soon after, nobody knows when and how other vulnerabilities against virtio devices will be exposed. With regards to lessons learned, our talk also highlights a few interesting topics that are closely related to our work. For example, the stateful fuzzing technique, which contributes to our vulnerability discovery, will be discussed. We will offer some approaches allowing the customized fuzzer to achieve better performance. We believe that the technique insights we present will benefit the researchers who are working on the same area.