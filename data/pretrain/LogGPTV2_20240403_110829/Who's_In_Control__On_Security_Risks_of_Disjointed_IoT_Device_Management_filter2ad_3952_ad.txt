Flaw 1
Flaw 2
Flaw 2
Flaw 2
Flaw 5
Flaw 1
Flaw 1
Flaw 1
Google Play
App Installs
5k+
10k+
500k+
100k+
5k+
10k+
500k+
500k+
10,000k+
500k+
5,000k+
50k+
Device
Abode Alarm Hub
Aqara
Camera G2H
August Smart Lock
Pro Gen3
iHome plug
ismartgate
garage controller
Koogeek plug
LIFX bulb
Meross Smart Plug Mini
MiHome Lamp
Philips Hue BLE bulb
Philips Hue BLE plug
Philips Hue
bridge
Refoss Smart Wi-Fi
Garage Door Opener
Yeelight
Lightstrip Plus
MiHome
Yeelight
Flaw 4
1,000k+
M stands for m-DMC, H for HomeKit, Z for Z-channel, S for smart speaker.
Note that for the five devices with “N/A” fields in the table, once
the owner/victim uses HomeKit, the dangling m-DMC becomes
not even usable by legitimate users since the device manufacturer’s
mobile apps can no longer discover or bind with the device. This
might be due to functionality bugs rather than a security design,
since for the same devices, if the owner uses m-DMC, our exploits
using HomeKit succeeded as shown in the table. Note that the
dangling m-DMC on such devices may still be exploited with addi-
tional engineering efforts of the adversary. For example, although
MiHome Lamp’s m-DMC no longer advertises its service/existence
to the local area network after its HomeKit DMC is used (so the
MiHome mobile app cannot automatically discover the device), the
m-DMC is not closed and we were able to use a crafted program (by
modifying the MiHome mobile app’s binding process) to manually
connect with the device on its m-DMC, configure and control it.
Discussion. Device events (i.e., push notifications shown on mobile
phones when an IoT device is operated) are not a solution to rely on
to address Codema threats. Typically the events are not available
(with mainstream vendors such as August, ismartgate, LIFX, Philips,
and Google-Home) or do not provide timely support for mitigating
Codema threats. Above all, all Codema flaws enable attackers to
gain device-control unaware by the owner. When the control is
exercised (e.g., turning off a plug/siren/door), harms could have
immediately been done to the owner even if events are issued (e.g.,
turning off the alarm/lock during a midnight break-in).
Moreover, for most exploits (18/25) we performed, under the
apps’ default setting, no notification events were observed. For
other six exploits, the owner/victim uses HomeKit-DMC that pushes
notifications for device operations, and might notice exploits have
occurred. However, to receive HomeKit notifications remotely, the
owner must configure a separate Apple-TV/iPad as a HomeKit-
hub [42] in her house. Such a hardware/configuration requirement
raises the bar for using notification as Codema warning. Also, in
our study, the only m-DMC app that pushes notifications for device-
operations is Refoss app when the Refoss garage door has a status
change. Again, the notification is after-exploit (after the garage
door is already opened by the adversary) and the miscreants could
have entered the building leveraging the Codema exploit.
4 ATTACK FEASIBILITY STUDY
The Codema risk is related to human behaviors: e.g., whether the
owner of an IoT device leaves open unused DMCs, whether she
tends to grant the access to the device to the party not fully trusted
and whether she is informed of the risk. In this section, we present
a study that seeks the answers to these questions, from both the
device owner’s perspective (the way she configures and shares the
device) and the manufacturer’s perspective (the way its customers
have been instructed).
4.1 The User Perspective
We performed an on-site user study to investigate two key issues
for understanding the significance of Codema: (1) how a typical
user configures and uses her IoT devices with multiple DMCs, and
(2) how likely our pre-conditions for each attack in Section 3 can
be satisfied in practice. Such conditions are summarized as follows:
• C1 (All Flaws): The owner leaves her unused DMC at its factory
setting. That is, the device owner opts for some but not all DMCs
to manage a device.
• C2 (Flaw 1, 3, 4): The adversary can access the target device’s Wi-Fi
network.
• C3 (Flaw 3, 4): The owner grants the adversary a temporary access
to the target device.
Recruitment. Under an IRB approval, we recruited 24 participants
from our organizations, based on their IoT experience, education
background, etc.1 Particularly, most participants (18/24) have IoT
experience. All of them have a technical or related education back-
ground (e.g., pursuing a Bachelor or graduate degree in Computer
Science). Their ages range from 18 to 40 (<20: 4 people; 20-30: 19
1Due to COVID-19, we carefully arranged our study to follow the CDC guidelines,
keeping social distancing, limiting the number of individuals in a room, etc.
Session 5A: Control System SecurityCCS ’21, November 15–19, 2021, Virtual Event, Republic of Korea1296people; 30-40: one person). 8/24 are female and 16/24 are male.
These individuals were selected since we believe that ones with
IoT experience and proper technical background are more likely to
securely configure and use devices than an average user. Note that
this selection bias tends to make our findings more conservative
when estimating the impact of the Codema risk.
Procedure of the user study. Our user study took each partici-
pant 20-30 minutes to finish the assigned task, with a compensation
of 15 US dollars. During the study, each participant was asked to
freely configure and use an IoT device with user manuals provided
(chosen by the participant from a MiHome lamp pro, LIFX bulb,
and Aqara camera). These devices all support both HomeKit and
m-DMC and the experiment was conducted in a home-like envi-
ronment. After they finished setting up the device, we recorded the
DMC(s) that was/were configured and the time it took to finish the
configuration.
Then we asked the participants to complete a questionnaire,
which covers the following key issues (among others): (1) why
they did or did not configure/use both DMCs;
(2) under what
circumstances they would share Wi-Fi and IoT devices with others.
All survey questions are detailed in Appendix A.
Results. This user study shows that the preconditions for Codema
attacks can be easily met in practice, which poses a realistic threat
to a big portion of IoT users. We elaborate on the findings below:
C1: 20 participants (83.3%) configured only one DMC. The aver-
age time for configuring a DMC is nine minutes for all participants,
and thus, most of them had enough time to set up another DMC
should they intend to do so. Interestingly, when we asked how
much time they expect to spend in configuring a device before use,
54.2% of the participants answered “less than 5 minutes”, with 37.5%
of them indicating “5 to 10 minutes”. This suggests that an ordi-
nary IoT user might not want to take additional time to configure
another DMC.
We also explicitly asked the participants whether they want
to use both DMCs (both apps) to control a device. 95.8% of them
preferred not, with comments such as “it is enough with one app”.
This is expected, since many mainstream vendors such as Apple
have long been advocating low-hassles even “zero configuration”
device setup [9, 22]. Hence, we believe that when the vendors
support multiple DMCs, they aim to provide their users flexibility,
not the burden to configure and use all channels.
Also interestingly, 12 participants (50%) stated that they never
noticed that the device could be controlled by multiple apps during
the setup and device use (although the user manuals do advertise
this feature). The above results indicate that in a real-world scenario
a substantial portion of IoT users would not configure or manage
all DMCs, leaving them dangling.
C2: Our survey results show that most participants are willing
to share their Wi-Fi with others when necessary, including Airbnb
guests (58.3%), tenants (62.5%), babysitters (62.5%), temporary work-
ers (33.3%) (e.g., a plumber), neighbors (29.2%), and even strangers
who seek for help (8.3%). Even after sharing the Wi-Fi, most partic-
ipants (79.2%) expect that other users should not be able to access
their IoT devices in the same Wi-Fi network, unless they explicitly
grant them the access. Note that, this expectation is in line with the
mainstream DMCs’ security policies assumed by device vendors,
but Codema attacks invalidate such a security property.
Worse still, our user study also shows that most people do not
change Wi-Fi passwords for a long time (for months: 16.7% of users;
for years: 33.3%; never: 45.8%), which gives the attacker a large
attack window after he gets the Wi-Fi access. Interestingly, one
participant with significant IoT experiences stated that “I almost
never change the Wi-Fi password because I have to re-configure
all the IoT devices again after a reset of the Wi-Fi password.”
C3: Based on the recent study [61], IoT users are willing to share
smart home devices with other people, e.g., Airbnb guests, babysit-
ters, visitors. One of our attacks (Flaw 3) require the adversary to
get the temporary permission for editing devices, which is found
to be completely realistic: the participants we interviewed were
willing to grant such an access right to Airbnb guests (25%), tenants
(29.2%), babysitters (29.2%), and workers(12.5%). This indicates that
the Codema risks are indeed high, for example, considering the
large number of Airbnb hosts and tenants in the wild.
4.2 The Vendor Perspective
To understand whether the vendors are aware of the Codema risks
and help their users avoid the risks, we inspected both the speci-
fications and apps of all 14 devices we studied. Results show that
vendors provide limited guidance (if any) to users.
Specifications. After inspecting the manuals of the IoT devices that
support multiple DMCs, we found that they only provide instruc-
tions for configuring individual device DMCs without requiring the
users to set up all channels. This clearly shows that the vendors are
not aware of the Codema risks, let alone to instruct their customers
to avoid the risks.
Worse still, some manuals even miss DMCs their devices support,
possibly due to the complexity of the IoT supply chain. For example,
the manual of MiHome Lamp (branded and sold by Xiaomi) states
that the device can be managed by HomeKit and MiHome; however,
we found that it also includes the Yeelight DMC, which can be
abused to acquire unauthorized device access. It turns out that
Yeelight is one of Xiaomi’s original equipment manufacturers and
MiHome Lamp reuses its firmware, thereby inheriting its DMC,
even though the manual fails to mention this hidden channel. Also
interesting is the observation that device manuals could become
out-dated after the firmware updates. We found that some vendors
(Abode and Yeelight) use firmware updates to add additional DMCs
to their devices, but users likely will fail to get informed about such
changes. For example, Abode upgrades the firmware of the hub to
support HomeKit, which can leave the device owner (especially
who uses an Android phone) vulnerable to Flaw 4 (Section 3).
As mentioned earlier, Codema attacks on HomeKit require its
setup code. Such codes are on the printed labels of all devices
(except Abode and Yeelight Lightstrip) we studied, as suggested by
Apple [19], yet none of the device vendors inform their users of the
importance of the codes and ask them to keep the codes confidential.
Instead, the only instruction we found from the manufacturers is:
“Please do not lose the code that is at the bottom of the device.
Adding the device back will need the setup code after factory reset.”
Manufacturer app. Also by inspecting all IoT appliances’ com-
panion apps, we discovered the significant differences between a
Session 5A: Control System SecurityCCS ’21, November 15–19, 2021, Virtual Event, Republic of Korea1297device’s Android app and iOS app, which exposes it to Codema risks.
Specifically, none of the Android apps provide interfaces for man-
aging HomeKit, rendering the channel vulnerable to the exploits
unnoticed to Android users. Also interesting is the observation
that Koogeek’s iOS app only works with HomeKit, not even its
own m-DMC. As a result, the iOS user inevitably leaves Koogeek’s
m-DMC dangling.
Further, we found that Philips Hue provides two official apps,
the Philips Hue [27] app (old) and the Philips Hue Bluetooth [28]
app (new). The new app is meant to control its new Bluetooth-
enabled devices through the BLE DMC, a functionality missing in
the old app. Therefore, those who use the old app to control their
Bluetooth-enabled Philips devices are not aware of the presence of
the BLE channel, and therefore vulnerable to attacks (Section 3.1).
5 MITIGATING CODEMA
Given the serious impact of Codema on the IoT ecosystem, find-
ing effective mitigation becomes imperative. In this section, we
describe the design (Section 5.2) and implementation (Section 5.3)
of a new protection mechanism called CGuard that enables the
first systematic and also practical cross-DMC access control. We
thoroughly evaluated CGuard’s usability, performance overhead,
effectiveness and feasibility for real-world deployment (Section 5.4).
5.1 Goals and Challenges of Protection
Root causes of Codema risks. Our user study shows that a user
typically does not bother configuring all supported DMCs on her
device and tends to leave some DMCs open. As a result, she cannot
have full control and visibility over her device. Actually no tech-
nique today empowers her to conveniently and effectively manage
unused DMCs, nor is she offered any assurance that the DMCs that
she does not choose pose no threat to her device control.
Ideal solution and challenges. Considering both security and us-
ability, an ideal design of multiple-DMC IoT is expected to have the