经过进一步调查，我们发现该域名自2018年3月4日开始，就一直处于活跃状态，并且由同一个托管服务提供商托管在3个不同的服务器上。
我们与托管服务提供商取得了联系，并在10月5日共同关闭了这台服务器。仅仅1天之后，该恶意活动就立刻更换了另一个域名gazanew.com。令人惊讶的是，新域名来自于相同的托管网络。
于是，我们再次要求服务提供商关闭该服务器。此后，攻击者就开始与我们玩起了“猫鼠游戏”。
在我们关停第二个域名之后不久，攻击者就开始禁用大量的管理接口，并将SSH和TELNET端口移动到TCP/10022和TCP/10023，这一点出乎我们的意料，甚至用户都可能不会注意到这一点。除此之外，攻击者还不断缩小他的暴露目标。例如，现在几乎不会连接到Telnet端口。此外，一旦使用泄露的凭据成功连接，几乎会立即断开连接。
## 持续追踪攻击者
我们仍然在追击攻击者的过程中。然而，由于受感染的路由器数量庞大，因此很难进行有效的溯源。互联网上，甚至出现了一个Google文档的电子表格，跟踪被感染路由器上的所有挖掘活动：
该文档位于：
。
[@bad_packets](https://github.com/bad_packets
"@bad_packets")收集了来自Shodan、Censys和其他类似来源的挖矿统计数据，并进行分析。分析结果表明，用于某种挖矿活动的路由器总数已经超过421000台。并且，由于没有简单的方法能够获取关于CoinHive密钥的统计信息，我们在下面展示了能够获得加密货币余额的密钥活动。
其中一个分布式密钥的挖矿活动快照（xmr.omine.org）：
其中一个分布式密钥的挖矿活动快照（MoneroOcean Pool）：
## 影响用户范围
下图展现了在Avira用户群体中，MikroTik路由器的固件版本分布情况。事实上，目前仅有4.89%的用户使用了最新版本的固件（6.43.2），85.48%的用户仍然容易受到CVE-2018-14847
WinBox漏洞利用。
## 造成的危害
从表面上看，这一恶意活动的危害在于非法使用路由器的计算能力来挖掘加密货币，但事实并非如此。实际上，连接到受感染路由器上的所有计算机都会为攻击者执行挖矿任务，而并非仅有路由器。只要用户尝试访问不安全的Web地址（HTTP），路由器都会为用户提供一个恶意挖矿工具，从而实现这一目的。然而，更大的问题在于，一旦用户的路由器遭到入侵，用户将无法确定攻击者利用路由器具体做了什么，他们可以嗅探流量，也可以向用户提供恶意页面。
如下图所示，用户可以使用Avast Wi-Fi Inspector来查看自己的网络是否受到这一攻击的影响。此外，Wi-Fi
Inspector还可以检测MikroTik路由器服务（例如Telnet和FTP）的弱密码或默认密码，或者检测特定的HTTP篡改。
## 恶意活动溯源
由于有多个恶意活动同时运行，因此很难对攻击者进行追溯。实际上，对这一系列恶意活动的溯源过程是一场噩梦，因为易受攻击的路由器被不同的恶意活动一遍又一遍的利用，所以这些路由器上就存在一个又一个恶意活动的运行痕迹。然而，我们仍然在密切关注一个疑似攻击者发起的特定活动。截至目前，我们暂时没有得出明确的结论，请继续关注我们接下来的更新。
## 被感染用户的清除方法
尽管该漏洞源于路由器，但由于MikroTik及时发出了补丁和通告，因此不应该将被感染的责任归咎于他们。在这里，最主要的问题在于大部分用户都没有及时安装补丁。如果用户受到感染，可以采用以下步骤：
1、检查自己是否使用了MikroTik路由器。即使用户没有使用MikroTik路由器，也可能会受到这一漏洞的影响。如果确认没有使用，那么证明可能是ISP（互联网服务提供商）受到感染。如果是这种情况，请立即与ISP取得联系，以便让他们尽快解决这一问题。
2、确认是否能够使用WinBox、TELNET或SSH，从内部网络连接到路由器。
3、如果无法通过上述任一端口连接，请尝试使用攻击者的备用端口。针对TELNET和SSH，分别被修改为TCP/10023和TCP/10022端口。
4、如果仍然无法连接，唯一的方法是将路由器恢复出厂设置。在重置后，立即对固件进行更新。在此之后，如果再次进行重置，那么所有默认设置都保证是安全的，因为最新版本的MikroTik路由器默认已经关闭了外部对路由器的访问。MikroTik发表过一篇非常不错的文章（
），我们可以按照文章中的描述，或者通过WinBox应用程序中的Quick Set选项来安装最新的固件，并设置一个新的密码，这一过程比较简单。
5、如果已经成功连接到路由器，首先需要关闭外部对路由器接口的访问。
6、随后，查看路由器中是否存在任何文末IoC中记录的脚本/文件/用户名/PPP挑战口令或计划任务。如果存在，则删除相应内容。借助调度程序，这些任务可以重新运行，导致路由器再次沦陷。
7、禁用Web代理和SOCKS（如果不需要），或检查其配置是否符合安全要求，同时检查防火墙规则是否符合安全要求。
8、在工具菜单中，检查数据包嗅探器（Packet Sniffer）。
9、如果不需要使用PPTP服务器功能，请关闭。
10、检查所有用户账户，删除其中的可疑账户，并为所有启用的账户设置强密码。
11、将路由器的固件更新到最新版本。
## IOC
域名：
gazanew.com
mining711.com
srcip.com
src-ips.com
srcips.com
hostingcloud.science
meaghan.pythonanywhere.com
计划任务名称：
DDNS
CrtDDNS
UpDDNS
Setschedule[1-9]_
upd[113-116]
system[111-114]
ip
a
u[3-6]
与恶意活动相关的用户账户：
toto
dodo
路由器上的恶意文件：
i113.rsc
i114.rsc
I116.rsc
exsvc.rsc