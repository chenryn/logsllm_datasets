---
title: LinkedHashMap æºç åˆ†æ
category: Java
tag:
  - Javaé›†åˆ
---
## LinkedHashMap ç®€ä»‹
`LinkedHashMap` æ˜¯ Java æä¾›çš„ä¸€ä¸ªé›†åˆç±»ï¼Œå®ƒç»§æ‰¿è‡ª `HashMap`ï¼Œå¹¶åœ¨ `HashMap` åŸºç¡€ä¸Šç»´æŠ¤ä¸€æ¡åŒå‘é“¾è¡¨ï¼Œä½¿å¾—å…·å¤‡å¦‚ä¸‹ç‰¹æ€§:
1. æ”¯æŒéå†æ—¶ä¼šæŒ‰ç…§æ’å…¥é¡ºåºæœ‰åºè¿›è¡Œè¿­ä»£ã€‚
2. æ”¯æŒæŒ‰ç…§å…ƒç´ è®¿é—®é¡ºåºæ’åº,é€‚ç”¨äºå°è£… LRU ç¼“å­˜å·¥å…·ã€‚
3. å› ä¸ºå†…éƒ¨ä½¿ç”¨åŒå‘é“¾è¡¨ç»´æŠ¤å„ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥éå†æ—¶çš„æ•ˆç‡å’Œå…ƒç´ ä¸ªæ•°æˆæ­£æ¯”ï¼Œç›¸è¾ƒäºå’Œå®¹é‡æˆæ­£æ¯”çš„ HashMap æ¥è¯´ï¼Œè¿­ä»£æ•ˆç‡ä¼šé«˜å¾ˆå¤šã€‚
`LinkedHashMap` é€»è¾‘ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå®ƒæ˜¯åœ¨ `HashMap` åŸºç¡€ä¸Šåœ¨å„ä¸ªèŠ‚ç‚¹ä¹‹é—´ç»´æŠ¤ä¸€æ¡åŒå‘é“¾è¡¨ï¼Œä½¿å¾—åŸæœ¬æ•£åˆ—åœ¨ä¸åŒ bucket ä¸Šçš„èŠ‚ç‚¹ã€é“¾è¡¨ã€çº¢é»‘æ ‘æœ‰åºå…³è”èµ·æ¥ã€‚
![LinkedHashMap é€»è¾‘ç»“æ„](https://oss.javaguide.cn/github/javaguide/java/collection/linkhashmap-structure-overview.png)
## LinkedHashMap ä½¿ç”¨ç¤ºä¾‹
### æ’å…¥é¡ºåºéå†
å¦‚ä¸‹æ‰€ç¤ºï¼Œæˆ‘ä»¬æŒ‰ç…§é¡ºåºå¾€ `LinkedHashMap` æ·»åŠ å…ƒç´ ç„¶åè¿›è¡Œéå†ã€‚
```java
HashMap  map = new LinkedHashMap  ();
map.put("a", "2");
map.put("g", "3");
map.put("r", "1");
map.put("e", "23");
for (Map.Entry  entry: map.entrySet()) {
    System.out.println(entry.getKey() + ":" + entry.getValue());
}
```
è¾“å‡ºï¼š
```java
a:2
g:3
r:1
e:23
```
å¯ä»¥çœ‹å‡ºï¼Œ`LinkedHashMap` çš„è¿­ä»£é¡ºåºæ˜¯å’Œæ’å…¥é¡ºåºä¸€è‡´çš„,è¿™ä¸€ç‚¹æ˜¯ `HashMap` æ‰€ä¸å…·å¤‡çš„ã€‚
### è®¿é—®é¡ºåºéå†
`LinkedHashMap` å®šä¹‰äº†æ’åºæ¨¡å¼ `accessOrder`(boolean ç±»å‹ï¼Œé»˜è®¤ä¸º false)ï¼Œè®¿é—®é¡ºåºåˆ™ä¸º trueï¼Œæ’å…¥é¡ºåºåˆ™ä¸º falseã€‚
ä¸ºäº†å®ç°è®¿é—®é¡ºåºéå†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¼ å…¥ `accessOrder` å±æ€§çš„ `LinkedHashMap` æ„é€ æ–¹æ³•ï¼Œå¹¶å°† `accessOrder` è®¾ç½®ä¸º trueï¼Œè¡¨ç¤ºå…¶å…·å¤‡è®¿é—®æœ‰åºæ€§ã€‚
```java
LinkedHashMap map = new LinkedHashMap<>(16, 0.75f, true);
map.put(1, "one");
map.put(2, "two");
map.put(3, "three");
map.put(4, "four");
map.put(5, "five");
//è®¿é—®å…ƒç´ 2,è¯¥å…ƒç´ ä¼šè¢«ç§»åŠ¨è‡³é“¾è¡¨æœ«ç«¯
map.get(2);
//è®¿é—®å…ƒç´ 3,è¯¥å…ƒç´ ä¼šè¢«ç§»åŠ¨è‡³é“¾è¡¨æœ«ç«¯
map.get(3);
for (Map.Entry entry : map.entrySet()) {
    System.out.println(entry.getKey() + " : " + entry.getValue());
}
```
è¾“å‡ºï¼š
```java
1 : one
4 : four
5 : five
2 : two
3 : three
```
å¯ä»¥çœ‹å‡ºï¼Œ`LinkedHashMap` çš„è¿­ä»£é¡ºåºæ˜¯å’Œè®¿é—®é¡ºåºä¸€è‡´çš„ã€‚
### LRU ç¼“å­˜
ä»ä¸Šä¸€ä¸ªæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°é€šè¿‡ `LinkedHashMap` æˆ‘ä»¬å¯ä»¥å°è£…ä¸€ä¸ªç®€æ˜“ç‰ˆçš„ LRUï¼ˆ**L**east **R**ecently **U**sedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ ç¼“å­˜ï¼Œç¡®ä¿å½“å­˜æ”¾çš„å…ƒç´ è¶…è¿‡å®¹å™¨å®¹é‡æ—¶ï¼Œå°†æœ€è¿‘æœ€å°‘è®¿é—®çš„å…ƒç´ ç§»é™¤ã€‚
![](https://oss.javaguide.cn/github/javaguide/java/collection/lru-cache.png)
å…·ä½“å®ç°æ€è·¯å¦‚ä¸‹ï¼š
- ç»§æ‰¿ `LinkedHashMap`;
- æ„é€ æ–¹æ³•ä¸­æŒ‡å®š `accessOrder` ä¸º true ï¼Œè¿™æ ·åœ¨è®¿é—®å…ƒç´ æ—¶å°±ä¼šæŠŠè¯¥å…ƒç´ ç§»åŠ¨åˆ°é“¾è¡¨å°¾éƒ¨ï¼Œé“¾è¡¨é¦–å…ƒç´ å°±æ˜¯æœ€è¿‘æœ€å°‘è¢«è®¿é—®çš„å…ƒç´ ï¼›
- é‡å†™`removeEldestEntry` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª boolean å€¼ï¼Œå‘ŠçŸ¥ `LinkedHashMap` æ˜¯å¦éœ€è¦ç§»é™¤é“¾è¡¨é¦–å…ƒç´ ï¼ˆç¼“å­˜å®¹é‡æœ‰é™ï¼‰ã€‚
```java
public class LRUCache extends LinkedHashMap {
    private final int capacity;
    public LRUCache(int capacity) {
        super(capacity, 0.75f, true);
        this.capacity = capacity;
    }
    /**
     * åˆ¤æ–­sizeè¶…è¿‡å®¹é‡æ—¶è¿”å›trueï¼Œå‘ŠçŸ¥LinkedHashMapç§»é™¤æœ€è€çš„ç¼“å­˜é¡¹(å³é“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ )
     */
    @Override
    protected boolean removeEldestEntry(Map.Entry eldest) {
        return size() > capacity;
    }
}
```
æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼Œç¬”è€…åˆå§‹åŒ–ç¼“å­˜å®¹é‡ä¸º 2ï¼Œç„¶åæŒ‰ç…§æ¬¡åºå…ˆåæ·»åŠ  4 ä¸ªå…ƒç´ ã€‚
```java
LRUCache  cache = new LRUCache  (2);
cache.put(1, "one");
cache.put(2, "two");
cache.put(3, "three");
cache.put(4, "four");
for (int i = 0; i  **ğŸ› ä¿®æ­£ï¼ˆå‚è§ï¼š[issue#2147](https://github.com/Snailclimb/JavaGuide/issues/2147)ï¼‰**ï¼š
>
> é“¾è¡¨ä¸Šçš„èŠ‚ç‚¹ä¸ªæ•°è¾¾åˆ°æ ‘åŒ–çš„é˜ˆå€¼æ˜¯ 8 è€Œé 7ã€‚å› ä¸ºæºç çš„åˆ¤æ–­æ˜¯ä»é“¾è¡¨åˆå§‹å…ƒç´ å¼€å§‹éå†ï¼Œä¸‹æ ‡æ˜¯ä» 0 å¼€å§‹çš„ï¼Œæ‰€ä»¥åˆ¤æ–­æ¡ä»¶è®¾ç½®ä¸º 8-1=7ï¼Œå…¶å®æ˜¯è¿­ä»£åˆ°å°¾éƒ¨å…ƒç´ æ—¶å†åˆ¤æ–­æ•´ä¸ªé“¾è¡¨é•¿åº¦å¤§äºç­‰äº 8 æ‰è¿›è¡Œæ ‘åŒ–æ“ä½œã€‚
>
> ![](https://oss.javaguide.cn/github/javaguide/java/jvm/LinkedHashMap-putval-TREEIFY.png)
è€Œ `LinkedHashMap` æ˜¯åœ¨ `HashMap` çš„åŸºç¡€ä¸Šä¸º bucket ä¸Šçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹å»ºç«‹ä¸€æ¡åŒå‘é“¾è¡¨ï¼Œè¿™å°±ä½¿å¾—è½¬ä¸ºçº¢é»‘æ ‘çš„æ ‘èŠ‚ç‚¹ä¹Ÿéœ€è¦å…·å¤‡åŒå‘é“¾è¡¨èŠ‚ç‚¹çš„ç‰¹æ€§ï¼Œå³æ¯ä¸€ä¸ªæ ‘èŠ‚ç‚¹éƒ½éœ€è¦æ‹¥æœ‰ä¸¤ä¸ªå¼•ç”¨å­˜å‚¨å‰é©±èŠ‚ç‚¹å’Œåç»§èŠ‚ç‚¹çš„åœ°å€,æ‰€ä»¥å¯¹äºæ ‘èŠ‚ç‚¹ç±» `TreeNode` çš„è®¾è®¡å°±æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ£˜æ‰‹çš„é—®é¢˜ã€‚
å¯¹æ­¤æˆ‘ä»¬ä¸å¦¨æ¥çœ‹çœ‹ä¸¤è€…ä¹‹é—´èŠ‚ç‚¹ç±»çš„ç±»å›¾ï¼Œå¯ä»¥çœ‹åˆ°:
1. `LinkedHashMap` çš„èŠ‚ç‚¹å†…éƒ¨ç±» `Entry` åŸºäº `HashMap` çš„åŸºç¡€ä¸Šï¼Œå¢åŠ  `before` å’Œ `after` æŒ‡é’ˆä½¿èŠ‚ç‚¹å…·å¤‡åŒå‘é“¾è¡¨çš„ç‰¹æ€§ã€‚
2. `HashMap` çš„æ ‘èŠ‚ç‚¹ `TreeNode` ç»§æ‰¿äº†å…·å¤‡åŒå‘é“¾è¡¨ç‰¹æ€§çš„ `LinkedHashMap` çš„ `Entry`ã€‚
![LinkedHashMap å’Œ HashMap ä¹‹é—´çš„å…³ç³»](https://oss.javaguide.cn/github/javaguide/java/collection/map-hashmap-linkedhashmap.png)
å¾ˆå¤šè¯»è€…æ­¤æ—¶å°±ä¼šæœ‰è¿™æ ·ä¸€ä¸ªç–‘é—®ï¼Œä¸ºä»€ä¹ˆ `HashMap` çš„æ ‘èŠ‚ç‚¹ `TreeNode` è¦é€šè¿‡ `LinkedHashMap` è·å–åŒå‘é“¾è¡¨çš„ç‰¹æ€§å‘¢?ä¸ºä»€ä¹ˆä¸ç›´æ¥åœ¨ `Node` ä¸Šå®ç°å‰é©±å’Œåç»§æŒ‡é’ˆå‘¢?
å…ˆæ¥å›ç­”ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ `LinkedHashMap` æ˜¯åœ¨ `HashMap` åŸºç¡€ä¸Šå¯¹èŠ‚ç‚¹å¢åŠ åŒå‘æŒ‡é’ˆå®ç°åŒå‘é“¾è¡¨çš„ç‰¹æ€§,æ‰€ä»¥ `LinkedHashMap` å†…éƒ¨é“¾è¡¨è½¬çº¢é»‘æ ‘æ—¶ï¼Œå¯¹åº”çš„èŠ‚ç‚¹ä¼šè½¬ä¸ºæ ‘èŠ‚ç‚¹ `TreeNode`,ä¸ºäº†ä¿è¯ä½¿ç”¨ `LinkedHashMap` æ—¶æ ‘èŠ‚ç‚¹å…·å¤‡åŒå‘é“¾è¡¨çš„ç‰¹æ€§ï¼Œæ‰€ä»¥æ ‘èŠ‚ç‚¹ `TreeNode` éœ€è¦ç»§æ‰¿ `LinkedHashMap` çš„ `Entry`ã€‚
å†æ¥è¯´è¯´ç¬¬äºŒä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨ `HashMap` çš„èŠ‚ç‚¹ `Node` ä¸Šç›´æ¥å®ç°å‰é©±å’Œåç»§æŒ‡é’ˆ,ç„¶å `TreeNode` ç›´æ¥ç»§æ‰¿ `Node` è·å–åŒå‘é“¾è¡¨çš„ç‰¹æ€§ä¸ºä»€ä¹ˆä¸è¡Œå‘¢ï¼Ÿå…¶å®è¿™æ ·åšä¹Ÿæ˜¯å¯ä»¥çš„ã€‚åªä¸è¿‡è¿™ç§åšæ³•ä¼šä½¿å¾—ä½¿ç”¨ `HashMap` æ—¶å­˜å‚¨é”®å€¼å¯¹çš„èŠ‚ç‚¹ç±» `Node` å¤šäº†ä¸¤ä¸ªæ²¡æœ‰å¿…è¦çš„å¼•ç”¨ï¼Œå ç”¨æ²¡å¿…è¦çš„å†…å­˜ç©ºé—´ã€‚
æ‰€ä»¥ï¼Œä¸ºäº†ä¿è¯ `HashMap` åº•å±‚çš„èŠ‚ç‚¹ç±» `Node` æ²¡æœ‰å¤šä½™çš„å¼•ç”¨ï¼Œåˆè¦ä¿è¯ `LinkedHashMap` çš„èŠ‚ç‚¹ç±» `Entry` æ‹¥æœ‰å­˜å‚¨é“¾è¡¨çš„å¼•ç”¨ï¼Œè®¾è®¡è€…å°±è®© `LinkedHashMap` çš„èŠ‚ç‚¹ `Entry` å»ç»§æ‰¿ Node å¹¶å¢åŠ å­˜å‚¨å‰é©±åç»§èŠ‚ç‚¹çš„å¼•ç”¨ `before`ã€`after`ï¼Œè®©éœ€è¦ç”¨åˆ°é“¾è¡¨ç‰¹æ€§çš„èŠ‚ç‚¹å»å®ç°éœ€è¦çš„é€»è¾‘ã€‚ç„¶åæ ‘èŠ‚ç‚¹ `TreeNode` å†é€šè¿‡ç»§æ‰¿ `Entry` è·å– `before`ã€`after` ä¸¤ä¸ªæŒ‡é’ˆã€‚
```java
static class Entry extends HashMap.Node {
        Entry before, after;
        Entry(int hash, K key, V value, Node next) {
            super(hash, key, value, next);
        }
    }
```
ä½†æ˜¯è¿™æ ·åšï¼Œä¸ä¹Ÿä½¿å¾—ä½¿ç”¨ `HashMap` æ—¶çš„ `TreeNode` å¤šäº†ä¸¤ä¸ªæ²¡æœ‰å¿…è¦çš„å¼•ç”¨å—?è¿™ä¸ä¹Ÿæ˜¯ä¸€ç§ç©ºé—´çš„æµªè´¹å—ï¼Ÿ
```java
static final class TreeNode extends LinkedHashMap.Entry {
  //ç•¥
}
```
å¯¹äºè¿™ä¸ªé—®é¢˜,å¼•ç”¨ä½œè€…çš„ä¸€æ®µæ³¨é‡Šï¼Œä½œè€…ä»¬è®¤ä¸ºåœ¨è‰¯å¥½çš„ `hashCode` ç®—æ³•æ—¶ï¼Œ`HashMap` è½¬çº¢é»‘æ ‘çš„æ¦‚ç‡ä¸å¤§ã€‚å°±ç®—è½¬ä¸ºçº¢é»‘æ ‘å˜ä¸ºæ ‘èŠ‚ç‚¹ï¼Œä¹Ÿå¯èƒ½ä¼šå› ä¸ºç§»é™¤æˆ–è€…æ‰©å®¹å°† `TreeNode` å˜ä¸º `Node`ï¼Œæ‰€ä»¥ `TreeNode` çš„ä½¿ç”¨æ¦‚ç‡ä¸ç®—å¾ˆå¤§ï¼Œå¯¹äºè¿™ä¸€ç‚¹èµ„æºç©ºé—´çš„æµªè´¹æ˜¯å¯ä»¥æ¥å—çš„ã€‚
```bash
Because TreeNodes are about twice the size of regular nodes, we
use them only when bins contain enough nodes to warrant use
(see TREEIFY_THRESHOLD). And when they become too small (due to
removal or resizing) they are converted back to plain bins.  In
usages with well-distributed user hashCodes, tree bins are
rarely used.  Ideally, under random hashCodes, the frequency of