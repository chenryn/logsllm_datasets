### 作者：安比实验室 & AnChain.ai  
### 公众号：[安比实验室SECBIT](https://mp.weixin.qq.com/s/YBG8YyPwh374HbGWcUKTdQ)

#### 安比（SECBIT）实验室创始人郭宇：

2009年，中本聪创造了一个去中心化的虚拟世界。这个新世界仿佛是一片流着奶与蜜的应许之地，吸引了无数人的热情参与。然而，正如所有生态系统一样，有生命就有捕食者。随着区块链应用的不断进化，攻击者也在不断升级。我们将揭示区块链世界的另一面——那些暗流涌动的现象。

### Last Winner 游戏引发以太坊网络拥堵

Last Winner（类似于 Fomo3D 的游戏）在短时间内迅速火爆，导致以太坊网络异常拥堵，Gas 费用暴涨。大量资金涌入该游戏。

北京时间 2018 年 8 月 10 日凌晨 1:38（加州时间 9 日上午 10:38），安比（SECBIT）实验室收到合作伙伴 AnChain.ai 的预警信息，发现部分游戏合约出现大量交易且存在异常的资金流动。随后，安比实验室团队立即对相关合约和交易进行了观察、跟踪和分析。

### 安比（SECBIT）实验室简介

安比（SECBIT）实验室由中国科学技术大学博士郭宇创建，从密码学、代码语义、形式化验证、博弈论、编译器等多种理论角度切入，在智能合约安全技术上开展了全方位深入研究。

### AnChain.ai 简介

AnChain.ai 由辛辛那提大学计算机博士方春生（Victor Fang）创建，方博士曾是硅谷上市网络安全公司 FireEye 的首席数据科学家，负责 AI 产品研发。AnChain.ai 专注于安全威胁情报和区块链态势感知，凭借 AI 技术助力区块链生态安全。

### 敏感地址处理

下文中的敏感地址只保留前 4 位。文末附有 **三个彩蛋** ，敬请智能合约爱好者关注。

## 一、悄然上线：莫名火爆的 Last Winner

Last Winner 是一款基于以太坊智能合约的 DApp 游戏，于 2018 年 8 月 6 日上线。这款游戏一经推出便异常火爆，短短六天内产生了超过 27 万笔交易。甚至在 8 月 8 日和 9 日，由于 Last Winner 和 Fomo3D 的大规模交易，以太坊未确认交易数量创年内新高，平均 Gas 费用一度飙升至正常水平的 10 倍以上。

该游戏第一轮奖池金额为 1.6 万多个以太币，而玩家总投资额超过 10 万以太币。目前，游戏第一轮已结束，第二轮奖金池已累积至 7000 多个以太币。

## 二、疑团重重：前期大量参与者的资金来历不明

据知名媒体“区块律动”报道，Last Winner 由名为“蚁群传播”的资金盘传销组织推广运营，拥有众多会员和强大的推广能力 [1]。另一款热门游戏 Fomo3D 的开发团队称，Last Winner 仿制了 Fomo3D，并准备了 20 万 ETH 进行自动刷量交易。因此，Last Winner 的火爆背后可能是一场精心布局的传销游戏，初期利用机器人批量交易伪造活跃假象，吸引新用户入场。

## 三、疯狂推广、仅面向国人，合约源码却从未公开

Last Winner 在各大论坛、媒体及微信群中广泛推广，但相关英文资料极少，显然是针对中国用户的。游戏提供了适配安卓和 iPhone 的 App，简化了操作流程，降低了参与门槛。然而，令人怀疑的是，作为一款基于智能合约的游戏，Last Winner 却没有公开其合约源代码，这是一个非常危险的信号。

## 四、安全性存疑：实则是 Fomo3D 山寨版

Last Winner 宣传自己是首款完全去中心化的类 Fomo3D 游戏 DApp，完全基于以太坊智能合约原生开发。然而，通过逆向分析，安比（SECBIT）实验室发现其合约代码函数名称与 Fomo3D 高度相似，疑似直接抄袭 Fomo3D 源码，并新增了 10 余个可疑未知函数。尽管 Fomo3D 在 Etherscan 公开了源代码，但这并不意味着任何人都可以随意使用。

## 五、前情回顾：类 Fomo3D 游戏空投机制存漏洞

Fomo3D 游戏的参与形式是用以太币购买游戏道具，除了最后一个购买的人可以获得巨额大奖外，平时参与者还有机会获得“空投”奖励。所有进入游戏的以太币中有 1% 会进入副奖池。每次购买道具都有概率获得空投，空投概率从 0% 开始，每增加一笔不小于 0.1 ETH 的销售订单，空投概率会增加 0.1%。同时，空投奖金额与购买金额挂钩，如果购买 0.1 ~ 1 ETH，就有概率赢得 25% 副奖池奖金，购买更多则比例越大。

早在 7 月 24 日，安比（SECBIT）实验室和派盾（PeckShield）科技分别预警 Fomo3D 游戏的智能合约存在随机数漏洞，可被利用。经逆向分析，Last Winner 游戏空投奖励代码与 Fomo3D 相似度达 91%，可能存在同样漏洞。

## 六、不能说的秘密：黑客制造秘密武器攫取高额收益

通过区块链态势感知系统，我们发现一些可疑地址紧密围绕 Last Winner 合约，吞噬游戏内的资金。这些地址的行为模式类似：不停地向某合约地址发起交易，附带 0.1 个以太币；不少交易状态为失败；成功的交易涉及大量复杂的内部交易，并伴随大量合约的创建和自毁。安比（SECBIT）实验室初步结论是，这些不明合约是黑客用来攻击 Last Winner 的秘密武器。

## 七、案发现场：大量类似交易，超高回报率

一个占地面积最大的嫌疑地址 0xae58 引起了我们的注意。8 月 9 日当天，该地址余额超过 300 个以太币，并大量向地址 0x5483 发起交易，每笔转账金额都是 0.1 Ether。表面上看是 0xae58 向 0x5483 转账 0.1 Ether，但实际上涉及了一大堆地址间的相互转账，最终 0.189 个 Ether 转移回 0xae58 的账户中。攻击者投入 0.1 个以太币，最终收获 0.189 个，瞬间回报率高达 89%。此外，还有四个地址持续不断地向 0x5483 合约发起类似交易，持续获得高额回报。失败的交易仅消耗 27712 燃料（Gas），成本损耗极低。

## 八、暴利：数据面前我们再次震惊

8 月 13 日，当我们沉浸在研究黑客攻击合约的各种细节优化和精巧设计时，黑客攻击数据全景分析新鲜出炉。