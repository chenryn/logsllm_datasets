服务，因为那些 eNB 只为 UE 的单个 S-TMSI 维护单个 RRC 连接。
## 0x07 Attacks Exploting MME
###  A. 远程注销攻击
1) **攻击者模型** ：攻击者应该能够向注册受害 UE 的 MME 发送恶意 NAS 消息。通常，MME 管理分布在大地理区域中的多个
eNB。攻击者还知道受害 UE 的
S-TMSI。特别是，对于利用消息重放的攻击，攻击者必须在发起攻击之前捕获相应的消息。获取受害UE的控制平面消息有两种方式。
• 攻击者可以操作恶意 LTE 网络来捕获受害 UE 的控制平面消息，同时在 UE 和网络之间转发这些消息。  
• 攻击者可以在 UE 上安装具有控制平面消息记录功能的恶意应用程序。
我们通过利用恶意 LTE 网络捕获受害 UE
的控制平面消息来实施攻击。在这种情况下，对手无法解密消息。但是，我们可以仅通过检查消息的顺序和长度来正确识别加密消息的类型。  
2) **攻击过程** ：如下图所示，①敌手首先建立一个 RRC 连接，伪装成受害者 UE（使用 UE 的 S-TMSI）。②攻击者向为受害者提供服务的
MME 发送精心设计的初始纯请求、无效的安全保护消息或重放消息。在这种情况下，一旦对手通过伪造的 RRC 连接发送消息，提供服务的 eNB 就会通过检查
S-TMSI 将消息转发给为受害者服务的 MME。③ MME 不恰当地处理从攻击者那里收到的消息。因此，MME 在没有通知他们的情况下断开注册受害 UE
的连接。
3） **实现** ：我们使用srsLTE UE堆栈实现了攻击。一旦建立了欺骗的 RRC 连接，她就会发送易受攻击的 NAS 消息。  
4) **验证** ：我们通过利用无效的明文消息、安全保护消息或重放消息，演示了针对可操作的 LTE
网络的远程注销攻击。我们确认攻击者可以通过连接到任何能够与为受害者 UE 服务的同一个 MME 通信的 eNB
来执行此攻击。与对应运营商的访谈显示，无论地理区域如何，eNB 都可以与任何 MME
通信，这取决于特定运营商的运营政策。在这种情况下，只有当对手成功获得有效的 GUTI
时，对手才能远程注销订阅了运营商的任意用户，而不管用户的位置如何。请注意，获得有效的 GUTI 并不困难。消息重放的一个值得注意的情况是，一旦 MME
接受重放的 NAS PDN 断开请求，攻击者可以选择性地拒绝用户的服务（例如，攻击者盲目地断开受害 UE 的数据服务，而语音服务继续可用）。
###  B. 短信钓鱼攻击
1) **攻击者模型** ：在这种情况下，攻击者通过使用受害者 UE2 的电话号码欺骗消息发送者，向受害者 UE1 发送 SMS 消息。为此，攻击者知道
UE2 的 S-TMSI 以欺骗发送者。实际 SMS 消息发送到的 UE1 的电话号码也是已知的。此外，我们假设目标 LTE 网络通过 NAS 层提供
SMS。  
2) **攻击过程** ： ①攻击者首先使用 UE2 的 S-TMSI 建立欺骗性 RRC 连接。②然后，生成SMS 内容并在 NAS 上行链路NAS
传输中。③在 RRC 连接建立之后，攻击者立即将生成的 NAS 上行链路NAS 传输发送到服务 MME。收到消息后，MME 将这个受控的 SMS 发送给
UE1。  
3） **实现** ：我们通过修改srsLTE实现来实现这种攻击。特别是，我们只是添加了支持通过 NAS 发送短信的功能。  
4) **验证** ：我们的测试结果证实我们成功地对运营商进行了这次攻击，因为 MME1 不验证 NAS 上行链路 NAS 传输消息的序列号，而 MME2
接受所有无效消息（明文、无效 MAC 和重放）。
## 0x08 Attack Exploiting UE: AKA Bypass Attack
1) **攻击模型** ：攻击者距离受害 UE 足够近，以触发从现有 eNB 到对手的恶意 LTE 网络的切换。为此，恶意 LTE 网络以比商用 eNB
更高的传输功率传输 LTE 信号。此外，攻击者必须知道跟踪区域 (TA) 列表才能将恶意 LTE 网络伪装成商用网络。可以通过两种方式轻松获取有效的 TAC
：
• 如果攻击者订阅了与受害者相同的运营商，则可以通过检查控制平面消息（例如Attach Accept）来获取TA 列表。  
• 如果攻击者只拥有一个恶意 LTE 网络，他首先随机选择一个 TA。一旦目标 UE 连接到恶意 LTE 网络，它就会发送 TAU 请求，因为连接网络的
TA 不在其 TA 列表中。在收到来自UE的TAU请求后，攻击者可以通过解析该请求来获得UE之前的TAC。请注意，TAU 请求仅受完整性保护。
2) **攻击过程** ：如下图所示，攻击者构建恶意 LTE 网络并配置其运行参数，使其与受害者的运行网络相同。①如果流氓 eNB 的发射功率高于提供服务的
eNB，则处于 RRC IDLE 状态的受害者会重新同步到对手的 eNB。在这种情况下，由于恶意 eNB 的 TAC 包含在受害 UE 的 TA
列表中，因此 UE 不会触发 NAS TAU 过程。因此，②当 UE 正在发送传出数据（即，通过呼叫某人或浏览网页）或从恶意 LTE
网络接收寻呼时，它会建立 RRC 连接并发送 NAS 服务请求。在收到来自 UE 的有效完整性保护服务请求后，正常 eNB 执行 RRC
安全模式过程以重新生成 RRC 层和用户数据的密钥。然而，我们的恶意 LTE 网络忽略了这个过程，并立即准备通过发送一个普通的 RRC
连接重新配置来创建一个无线电隧道（也称为数据无线电承载 (DRB)）。收到这个请求后，UE 创建 DRB 并回复一个正常的 RRC
连接重新配置完成消息。最后，UE 通过该隧道与流氓 LTE 网络传输和接收未受保护的用户数据，而不会收到任何通知。
3) **实施** ：我们使用一台 USRP B210 作为无线电收发器，并使用 openLTE 作为恶意 LTE 网络。攻击者的恶意 LTE 网络不会为
RRC 层和用户数据协商安全算法以响应来自受害者 UE 的连接请求。此外，在没有安全保护的情况下执行 RRC
重新配置过程，这违反了3GPP标准中的安全指南。  
4) **验证** ：我们验证了 AKA Bypass 攻击可以使多个智能手机型号（例如，LG G2 和三星 Galaxy
S4/S5，均使用高通基带）上现有 UE 的用户数据的现有加密无效。由于我们的恶意 LTE 网络将 TAC 配置为受害 UE 的 TA 列表，因此该 UE
在首次与我们的 eNB 同步时没有触发 TAU 请求。有趣的是，一些模型在攻击期间频繁发起 NAS TAU 请求。然而，如果恶意 LTE 网络在收到来自
UE 的请求后没有回复，则受害者 UE 通过发送 NAS 服务请求重新连接。这证明即使在这种情况下，我们的攻击仍然有效。
## 0x09 Countermeasures
**利用 eNB 的攻击。** 在 BTS 资源耗尽攻击的情况下，eNB 无法区分攻击者的 RRC 连接请求和合法 RRC
连接请求。这种攻击的一种可能缓解措施是减少不活跃计时器值，以允许对身份验证请求无响应的 RRC
连接到期。虽然它不是一个根本的解决方案，但它可以削弱这种攻击的影响，因为它最大限度地减少了对手可以建立的虚假 RRC
连接的数量。然而，如果运营商将不活跃定时器配置得不恰当，则UE可能会执行频繁的RRC连接过程，那么这将增加 eNB 和 MME
侧的信令负载。另一方面，当收到多个使用相同 S-TMSI 的 RRC 连接请求时，对 Blind DoS 攻击的可能缓解可能是重新分配
S-TMSI。根据3GPP标准，MME可以通过两种方式触发S-TMSI的重新分配。第一种是直接向UE发送安全保护的NAS
GUTI重新分配命令。然而，这并不能阻止 Blind DoS 攻击，因为在攻击期间 UE 不会收到消息。另一种方法是使用 UE 的 IMSI 广播寻呼。由于
Paging 在小区覆盖的整个区域上广播，因此 UE 将接收它并在收到 Paging 消息后启动与 IMSI 的附着过程，这将增加信令开销。  
 **利用 MME 和 UE 的攻击。** 远程注销攻击和短信网络钓鱼攻击都源于操作 MME 的不正确实现。因此，应严格遵循 3GPP 标准来谨慎实施这些
MME。 AKA 绕过攻击也源于 UE 错误地处理了强制安全程序。因此，在成功完成强制安全程序之前，UE不应进行任何控制平面程序。
## 0xA Councluding Remarks and Future Work
在本研究中，我们通过动态测试运营 LTE
网络中的控制平面组件来调查潜在的安全问题。半自动化动态测试的过程包括三个步骤：基于规范分析创建安全属性、生成和执行违反安全属性的测试用例，以及对有问题的用例进行分类。结果，LTEFuzz
在不同运营商和设备供应商之间成功识别了 15 个已发现的漏洞和 36 个新的设计和实施漏洞。调查结果分为五种漏洞类型。我们还演示了几种可用于拒绝各种 LTE
服务、发送网络钓鱼消息和窃听/操纵数据流量的攻击。我们通过审查相关标准和采访运营商的合作者，对发现的问题进行根本原因分析。  
总之，LTEFuzz 是发现运营商和设备供应商造成的设计和实现漏洞的有效工具。我们的发现在两个方面很有趣：1) 即使在一个运营商中，两个
MME（可能来自不同的供应商）也有不同的漏洞，2）由一个设备供应商制造的两个
MME（在两个运营商中）有不同的漏洞。这说明设备供应商和运营商都没有仔细检查其网络组件的安全性。此外，LTEFuzz
能够发现高通和海思基带芯片组中的漏洞，它们在 2017 年的市场份额排名第一和第四。我们计划在不久的将来向这些运营商和供应商私下发布
LTEFuzz。未计划公开发布，因为 LTEFuzz 可用于恶意目的。