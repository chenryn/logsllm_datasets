### Problem 8
**What is the FQDN of the compromised website?**

本题的问题是：受感染网站的完全限定域名（FQDN）是什么？

到目前为止，我们尚未确定Tom在上网时被感染的具体源头。为了找到他访问了哪个站点导致主机被感染，我们继续过滤流量，寻找包含`gate`站点的信息：

```plaintext
ip contains solution.babyboomershopping.org
```

在一条从IP `64.34.173.208` 到受害主机 `10.1.25.119` 的流量中，发现了`solution.babyboomershopping.org`。跟踪该条TCP流后，我们得知受感染网站的FQDN为`shotgunworld.com`。

攻击者采用了相同的方法，通过iframe将受害者重定向至`solution.babyboomershopping.org`，再由该中间站点将用户重定向至EK服务器。因此，整个攻击链如下：

> **_shotgunworld.com — > solution.babyboomershopping.org —> EK server_**

### Problem 9
**The compromised website contains a malicious JS that redirects the user to another website. What is the variable name passed to the “document.write” function?**

提示：OX_

答案很简单。从上一题追踪到的TCP流中，我们可以看到，当页面加载时，执行了JS代码并将iframe写入页面。因此，本题的答案为`OX_7f561e63`。

至此，对本流量包的分析暂时告一段落。

## Malware Traffic Analysis-2

流量包：[链接]，提取码：0099。

这道题没有提供具体场景，直接给出了一个pcap数据包和几个问题。我们将直接开始分析。

### 分析过程

### Problem 1
**What is the IP address of the Windows VM that gets infected?**

首先，我们需要找出被感染主机的IP地址。拿到流量包后，先上传至VirusTotal进行扫描，结果显示该数据包触发了11条Snort警报和23条Suricata警报。进一步分析显示，受害主机被Exploit-Kit感染。

使用Brim工具分析数据包，发现许多文件与Exploit-Kit相关。过滤出所有文件流量：

```plaintext
_path=files
```

所有目标IP均为`172.16.165.165`。在Wireshark中进一步过滤：

```plaintext
http.request
```

源IP地址均为`172.16.165.165`。同样过滤响应流量：

```plaintext
http.response
```

目的地址也均为`172.16.165.165`。因此，本题答案为：受害主机IP为`172.16.165.165`。

### Problem 2
**What is the hostname of the Windows VM that gets infected?**

要查找主机名，只需过滤DHCP流量即可。选择第一条源地址为受害主机的DHCP流量，可以轻松得到主机名为`K34EN6W3N-PC`。另外，也可以通过过滤`nbns`流量来获取主机名。

### Problem 3
**What is the MAC address of the infected VM?**

求受害主机的MAC地址很简单，只需过滤与受害主机IP相关的流量。例如，过滤：

```plaintext
ip.src==172.16.165.165
```

或者过滤ARP流量，查看发起ARP广播的相关信息。最终得出受害主机的MAC地址为`f0:19:af:02:9b:f1`。

### Problem 4
**What is the IP address of the compromised web site?**

从VirusTotal的扫描结果看，受害主机是在网上冲浪时被Exploit-Kit感染，但具体感染方式尚不清楚。通过分析受害主机发出的HTTP请求，我们找到了一些候选站点：

| IP              | Host                       |
|-----------------|----------------------------|
| 82.150.140.30   | www.ciniholland.nl         |
| 185.53.178.9    | adultbiz.in                |
| 188.225.73.100  | 24corp-shop.com            |
| 37.200.69.143   | stand.trustandprobaterealty.com |

从流量包中提取恶意软件，选择`File->Export Objects->HTTP`，保存所有文件并用Clam扫描。共提取出37个文件，其中4个被识别为恶意软件：

```plaintext
index.php%3freq=swf&num=809&PHPSSESID=njrMNruDMhvJFIPGKuXDSKVbM07PThnJko2ahe6JVg%7cZDJiZjZiZjI5Yzc5OTg3MzE1MzJkMmExN2M4NmJiOTM
index.php%3freq=swf&num=7533&PHPSSESID=njrMNruDMhvJFIPGKuXDSKVbM07PThnJko2ahe6JVg%7cZDJiZjZiZjI5Yzc5OTg3MzE1MzJkMmExN2M4NmJiOTM
index.php%3freq=jar&num=3703&PHPSSESID=njrMNruDMhvJFIPGKuXDSKVbM07PThnJko2ahe6JVg%7CZDJiZjZiZjI5Yzc5OTg3MzE1MzJkMmExN2M4NmJiOTM
index.php%3freq=jar&num=9229&PHPSSESID=njrMNruDMhvJFIPGKuXDSKVbM07PThnJko2ahe6JVg%7CZDJiZjZiZjI5Yzc5OTg3MzE1MzJkMmExN2M4NmJiOTM
```

从中提取关键信息：

```plaintext
req=swf&num=809
req=swf&num=7533
req=jar&num=3703
req=jar&num=9229
```

虽然不清楚`num`参数的意义，但至少知道这些恶意软件是SWF格式的Flash文件和JAR包。过滤相关HTTP流量：

```plaintext
ip contains "req=swf&num=809" or ip contains "req=swf&num=7533" or ip contains "req=jar&num=3703" or ip contains "req=jar&num=9229"
```

返回4条记录，目的地址均为`37.200.69.143`，对应域名为`stand.trustandprobaterealty.com`。因此，提供Exploit-Kit的是`stand.trustandprobaterealty.com`。

现在我们找到了攻击链中的最后一个设备——EK服务器。接下来需要找到攻击链中的第一环节，即受感染网站。过滤EK服务器的流量：

```plaintext
ip contains stand.trustandprobaterealty.com
```

结果显示该域名仅存在于受害主机和EK服务器之间的流量中。继续分析之前过滤出的4条流量，右键追踪HTTP流，在请求头中发现`Referer`字段为`http://24corp-shop.com`，对应IP为`188.225.73.100`。

更新攻击链：

> **_unknown Compromised website — > … gate —> gate [24corp-shop.com] —> EK server [stand.trustandprobaterealty.com]_**

过滤`24corp-shop.com`相关的HTTP流量：

```plaintext
http.request and ip.addr==188.225.73.100
```

追踪HTTP流，发现`Referer`字段为`http://www.ciniholland.nl`，对应IP为`82.150.140.30`。攻击者通过iframe劫持将用户重定向至`24corp-shop.com`，再重定向至`stand.trustandprobaterealty.com`。

最终攻击链为：

> **_Compromised website [www.ciniholland.nl] — > gate [24corp-shop.com] —> EK server [stand.trustandprobaterealty.com]_**

用IP地址表示为：

> **_82.150.140.30 — > 188.225.73.100 —> 37.200.69.143_**

本题答案为：`82.150.140.30`。

### Problem 5
**What is the FQDN of the compromised website?**

上一题已分析过，受感染网站的完全限定域名为`ciniholland.nl`。

### Problem 6
**What is the IP address of the server that delivered the exploit kit and malware?**

根据之前的分析，提供Exploit-Kit和恶意软件的服务器IP地址为`37.200.69.143`。