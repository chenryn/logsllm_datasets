Complete Guide to Shodan
Collect. Analyze. Visualize. Make Internet Intelligence Work
for You.
John Matherly
Thisbookisforsaleathttp://leanpub.com/shodan
Thisversionwaspublishedon2017-08-23
ThisisaLeanpubbook.LeanpubempowersauthorsandpublisherswiththeLeanPublishing
process.LeanPublishingistheactofpublishinganin-progressebookusinglightweighttoolsand
manyiterationstogetreaderfeedback,pivotuntilyouhavetherightbookandbuildtractiononce
youdo.
©2015-2017Shodan,LLC
Tweet This Book!
PleasehelpJohnMatherlybyspreadingthewordaboutthisbookonTwitter!
Thesuggestedhashtagforthisbookis#shodan.
Findoutwhatotherpeoplearesayingaboutthebookbyclickingonthislinktosearchforthis
hashtagonTwitter:
https://twitter.com/search?q=#shodan
Contents
Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1
AllAbouttheData. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1
DataCollection . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3
SSLInDepth . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4
BeyondtheBasics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7
WebInterfaces . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 10
SearchQueryExplained . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 10
IntroducingFilters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 11
ShodanSearchEngine . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 12
ShodanMaps . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 18
ShodanExploits . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 25
ShodanImages . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 26
Exercises:Website . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 28
ExternalTools . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 29
ShodanCommand-LineInterface . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 29
MaltegoAdd-On . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 40
BrowserPlug-Ins . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 40
Exercises:Command-LineInterface . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 41
DeveloperAPI . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 42
UsageLimits . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 42
IntroducingFacets . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 43
GettingStarted . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 44
Initialization . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 44
Search . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 44
HostLookup . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 46
Scanning . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 46
Real-TimeStream . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 47
NetworkAlert . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 48
Example:PublicMongoDBData . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 51
Exercises:ShodanAPI . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 56
CONTENTS
IndustrialControlSystems . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 57
CommonAbbreviations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 57
Protocols . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 57
SecuringInternet-ConnectedICS . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 59
UseCases . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 59
AppendixA:BannerSpecification . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 69
GeneralProperties . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 69
ElasticProperties . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 70
HTTP(S)Properties . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 70
LocationProperties . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 70
SMBProperties . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 71
SSHProperties . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 71
SSLProperties . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 71
ISAKMPProperties . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 72
SpecialProperties . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 72
Example . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 73
AppendixB:ListofSearchFilters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 75
GeneralFilters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 75
HTTPFilters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 75
NTP Filters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 76
SSLFilters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 76
TelnetFilters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 77
AppendixC:SearchFacets . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 78
GeneralFacets . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 78
HTTPFacets . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 78
NTP Facets . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 78
SSHFacets . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 79
SSLFacets . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 79
TelnetFacets . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 79
AppendixD:ListofPorts . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 81
AppendixE:SampleSSLBanner . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 87
ExerciseSolutions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 90
Website . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 90
Command-LineInterface . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 90
ShodanAPI . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 91
Introduction
Shodan is a search engine for Internet-connected devices. Web search engines, such as Google and
Bing, are great for finding websites. But what if you’re interested in finding computers running a
certain piece of software (such as Apache)? Or if you want to know which version of Microsoft IIS
isthemostpopular?OryouwanttoseehowmanyanonymousFTPserversthereare?Maybeanew
vulnerabilitycameoutandyouwanttoseehowmanyhostsitcouldinfect?Traditionalwebsearch
enginesdon’tletyouanswerthosequestions.
All About the Data
Banner
The basic unit of data that Shodan gathers is the banner. The banner is textual information that
describes a service on a device. For web servers this would be the headers that are returned or for
Telnetitwouldbetheloginscreen.
The content of the banner varies greatly depending on the type of service. For example, here is a
typicalHTTPbanner:
HTTP/1.1 200 OK
Server: nginx/1.1.19
Date: Sat, 03 Oct 2015 06:09:24 GMT
Content-Type: text/html; charset=utf-8
Content-Length: 6466
Connection: keep-alive
The above banner shows that the device is running the nginx web server software with a version
of 1.1.19. To show how different the banners can look like, here is a banner for the Siemens S7
industrialcontrolsystemprotocol:
Introduction 2
Copyright: Original Siemens Equipment
PLC name: S7_Turbine
Module type: CPU 313C
Unknown (129): Boot Loader A
Module: 6ES7 313-5BG04-0AB0 v.0.3
Basic Firmware: v.3.3.8
Module name: CPU 313C
Serial number of module: S Q-D9U083642013
Plant identification:
Basic Hardware: 6ES7 313-5BG04-0AB0 v.0.3
The Siemens S7 protocol returns a completely different banner, this time providing information
aboutthefirmware,itsserialnumberandalotofdetaileddatatodescribethedevice.
Youhavetodecidewhattypeofserviceyou’reinterestedinwhensearchinginShodanbecausethe
bannersvarygreatly.
Note: Shodan lets you search for banners - not hosts. This means that if a single IP
exposesmanyservicestheywouldberepresentedasseparateresults.
Device Metadata
In addition to the banner, Shodan also grabs meta-data about the device such as its geographic
location, hostname, operating system and more (see Appendix A). Most of the meta-data is
searchable via the main Shodan website, however a few fields are only available to users of the
developerAPI.
IPv6
As of October 2015, Shodan gathers millions of banners per month for devices accessible on IPv6.
ThosenumbersstillpaleincomparisontothehundredsofmillionsofbannersgatheredforIPv4but
itisexpectedtogrowoverthecomingyears.
Introduction 3
Data Collection
Frequency
The Shodan crawlers work 24/7 and update the database in real-time. At any moment you query
theShodanwebsiteyou’regettingthelatestpictureoftheInternet.
Distributed
Crawlersarepresentincountriesaroundtheworld,including:
• USA(EastandWestCoast)
• China
• Iceland
• France
• Taiwan
• Vietnam
• Romania
• CzechRepublic
Data is collected from around the world to prevent geographic bias. For example, many system
administratorsintheUSAblockentireChineseIPranges.DistributingShodancrawlersaroundthe
worldensuresthatanysortofcountry-wideblockingwon’taffectdatagathering.
Randomized
Thebasicalgorithmforthecrawlersis:
1. GeneratearandomIPv4address
2. GeneratearandomporttotestfromthelistofportsthatShodanunderstands
3. ChecktherandomIPv4addressontherandomportandgrababanner
4. Goto1
This means that the crawlers don’t scan incremental network ranges. The crawling is performed
completelyrandomtoensureauniformcoverageoftheInternetandpreventbiasinthedataatany
giventime.
Introduction 4
SSL In Depth
SSLisbecominganevermoreimportantaspectofservingandconsumingcontentontheInternet,so
it’s only fit that Shodan extends the information that it gathers for every SSL-capable service. The
banners for SSL services, such as HTTPS, include not just the SSL certificate but also much more.
All the collected SSL information discussed below is stored in the ssl property on the banner (see
AppendixAandAppendixE).
Vulnerability Testing
Heartbleed
IftheserviceisvulnerabletoHeartbleedthenthebannercontains2additionalproperties.opts.heartbleed
containstherawresponsefromrunningtheHeartbleedtestagainsttheservice.Notethatforthetest
thecrawlersonlygrabasmalloverflowtoconfirmtheserviceisaffectedbyHeartbleedbutitdoesn’t
grabenoughdatatoleakprivatekeys.ThecrawlersalsoaddedCVE-2014-0160totheopts.vulnslist
if the device is vulnerable. However, if the device is not vulnerable then it adds“!CVE-2014-0160”.
If an entry in opts.vulns is prefixed with a ! or - then the service is not vulnerable to the given
CVE.
{
"opts": {
"heartbleed": "... 174.142.92.126:8443 - VULNERABLE\n",
"vulns": ["CVE-2014-0160"]
}
}
Shodanalsosupportssearchingbythevulnerabilityinformation.Forexample,tosearchShodanfor
devicesintheUSAthatareaffected byHeartbleeduse:
country:US vuln:CVE-2014-0160
FREAK
If the service supports EXPORT ciphers then the crawlers add the “CVE-2015-0204” item to the
opts.vulnsproperty:
Introduction 5
"opts": {
"vulns": ["CVE-2015-0204"]
}
Logjam
The crawlers try to connect to the SSL service using ephemeral Diffie-Hellman ciphers and if the
connectionsucceedsthefollowinginformationisstored:
"dhparams": {
"prime": "bbbc2dcad84674907c43fcf580e9...",
"public_key": "49858e1f32aefe4af39b28f51c...",
"bits": 1024,
"generator": 2,
"fingerprint": "nginx/Hardcoded 1024-bit prime"
}
Version
Normally, when a browser connects to an SSL service it will negotiate the SSL version and cipher
thatshouldbeusedwiththeserver.TheywillthenagreeonacertainSSLversion,suchasTLSv1.2,
andthenusethatforthecommunication.
Shodan crawlers start out the SSL testing by doing a normal request as outlined above where they
negotiatewiththeserver.However,afterwardstheyalsoexplicitlytryconnectingtotheserverusing
a specific SSL version. In other words, the crawlers attempt to connect to the server using SSLv2,
SSLV3, TLSv1.0, TLSv1.1 and TLSv1.2 explicitly to determine all the versions that the SSL service
supports.Thegatheredinformationismadeavailableinthessl.versionsfield:
{
"ssl": {
"versions": ["TLSv1", "SSLv3", "-SSLv2", "-TLSv1.1", "-TLSv1.2"]
}
}
Iftheversionhasa-(dash)infrontoftheversion,thenthedevicedoesnotsupportthatSSLversion.
If the version doesn’t begin with a -, then the service supports the given SSL version. For example,
theaboveserversupports:
Introduction 6
TLSv1
SSLv3
Anditdeniesversions:
SSLv2
TLSv1.1
TLSv1.2
The version information can also be searched over the website/ API. For example, the following
search query would return all SSL services (HTTPS, POP3 with SSL, etc.) that allow connections
usingSSLv2:
ssl.version:sslv2
Follow the Chain
The certificate chain is the list of SSL certificates from the root to the end-user. The banner for
SSL services includes a ssl.chain property that includes all of the SSL certificates of the chain in
PEM-serializedcertificates.
Introduction 7
Beyond the Basics
For most services the crawlers attempt to analyze the main banner text and parse out any useful
information.AfewexamplesarethegrabbingofcollectionnamesforMongoDB,takingscreenshots
from remote desktop services and storing a list of peers for Bitcoin. There are 2 advanced data
analysistechniquesShodanusesthatI’dliketohighlight:
Web Components
The crawlers try to determine the web technologies that were used to create a website. For the
http and https modules the headers and HTML are analyzed to breakdown the components of the
website. The resulting information is stored in the http.components property. The property is a
dictionary of technologies, where the key is the name of the technology (ex. jQuery) and the value
isanotherdictionarywithapropertyofcategories.Thecategoriespropertyisalistofcategoriesthat
areassociatedwiththetechnology.Forexample:
"http": {
...
"components": {
"jQuery": {
"categories": ["javascript-frameworks"]
},
"Drupal": {
"categories": ["cms"]
},
"PHP": {
"categories": ["programming-languages"]
}
},
...
},
The http.components property indicates that the website is running the Drupal content manage-
ment system, which itself uses jQuery and PHP. The Shodan REST API makes the information
Introduction 8
searchablevia the filterhttp.componentand 2 facets (http.componentand http.component_cat-
egory). To get a full list of all the possible component/ category values please use the new facets.
Forexample,togetafulllistofallthepossiblecategoriesusethefollowingshodancommand:
$ shodan stats --facets http.component_category:1000 http
Top 47 Results for Facet: http.component_category
javascript-frameworks 8,982,996
web-frameworks 1,708,503
programming-languages 1,409,763
font-scripts 1,280,397
Cascading
IfabannerreturnsinformationaboutpeersorotherwisehasinformationaboutanotherIPaddress
thatrunsaservice thenthecrawlerstryto perform abannergrabon thatIP/service.Forexample:
thedefaultportforthemainlineDHT(usedbyBittorrent)is6881.ThebannerforsuchaDHTnode
looksasfollows:
DHT Nodes
97.94.250.250 58431
150.77.37.22 34149
113.181.97.227 63579
252.246.184.180 36408
83.145.107.53 52158
77.232.167.126 52716
25.89.240.146 27179
147.23.120.228 50074
85.58.200.213 27422
180.214.174.82 36937
241.241.187.233 60339
166.219.60.135 3297
149.56.67.21 13735
107.55.196.179 8748
Previously, a crawler would grab the above banner and then move on. With cascading enabled for
theDHTbannergrabberthecrawlernowlaunchesnewbannergrabbingrequestsforallofthepeers.
In the above example, the crawler would launch a scan for IP 54.70.96.157 on port 61770 using the
dht banner grabber, IP 85.82.92.188 on port 42155 and so on. I.e. a single scan for an IP can cause a
cascadeofscansiftheinitialscandatacontainsinformationaboutotherpotentialhosts.
Tokeeptrackoftherelationshipbetweentheinitialscanrequestandanychild/cascadingrequests
we’veintroduced2newproperties:
Introduction 9
• _shodan.id: A unique ID for the banner. This property is guaranteed to exist if a cascading
request could get launched from the service, though it doesn’t necessarily mean that any
cascadingrequestssucceeded.
• _shodan.options.referrer: Provides the unique ID of the banner that triggered the creation
ofthecurrentbanner.I.e.thereferreristheparentofthecurrentbanner.
Web Interfaces