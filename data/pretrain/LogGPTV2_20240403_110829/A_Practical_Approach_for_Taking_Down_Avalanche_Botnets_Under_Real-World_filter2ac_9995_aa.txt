title:A Practical Approach for Taking Down Avalanche Botnets Under Real-World
Constraints
author:Victor Le Pochat and
Tim Van hamme and
Sourena Maroofi and
Tom van Goethem and
Davy Preuveneers and
Andrzej Duda and
Wouter Joosen and
Maciej Korczynski
A Practical Approach for Taking Down
Avalanche Botnets Under Real-World Constraints
Victor Le Pochat∗, Tim Van hamme∗, Sourena Marooﬁ§, Tom Van Goethem∗,
Davy Preuveneers∗, Andrzej Duda§, Wouter Joosen∗, Maciej Korczy´nski§
∗imec-DistriNet, KU Leuven
§Univ. Grenoble Alpes, CNRS, Grenoble INP, LIG
{ﬁrstname.lastname}@kuleuven.be
{ﬁrstname.lastname}@univ-grenoble-alpes.fr
Abstract—In 2016, law enforcement dismantled the infrastruc-
ture of the Avalanche bulletproof hosting service, the largest
takedown of a cybercrime operation so far. The malware families
supported by Avalanche use Domain Generation Algorithms
(DGAs) to generate random domain names for controlling their
botnets. The takedown proactively targets these presumably mali-
cious domains; however, as coincidental collisions with legitimate
domains are possible, investigators must ﬁrst classify domains to
prevent undesirable harm to website owners and botnet victims.
The constraints of this real-world takedown (proactive deci-
sions without access to malware activity, no bulk patterns and no
active connections) mean that approaches from the state of the
art cannot be applied. The problem of classifying thousands of
registered DGA domain names therefore required an extensive,
painstaking manual effort by law enforcement investigators. To
signiﬁcantly reduce this effort without compromising correctness,
we develop a model that automates the classiﬁcation. Through
a synergetic approach, we achieve an accuracy of 97.6% with
ground truth from the 2017 and 2018 Avalanche takedowns; for
the 2019 takedown, this translates into a reduction of 76.9%
in manual
investigation effort. Furthermore, we interpret the
model to provide investigators with insights into how benign and
malicious domains differ in behavior, which features and data
sources are most important, and how the model can be applied
according to the practical requirements of a real-world takedown.
I.
INTRODUCTION
On November 30, 2016, a global consortium of law
enforcement agencies and Internet stakeholders completed a
four-year investigation aimed at dismantling the Avalanche
infrastructure [31], which has been called “the world’s largest
and most sophisticated cybercriminal syndicate law enforcement
has encountered” [94]. For seven years, this ‘bulletproof hosting
service’ [13] offered services to cybercriminal operations
through a ‘crime-as-a-service’ model [94], fully managing all
technical aspects of carrying out malware attacks, phishing,
and spam campaigns. It supported a botnet of a massive scale:
Avalanche was responsible for two thirds of all phishing attacks
in the second half of 2009 [8], and ultimately affected victims
in over 180 countries with estimations of its monetary impact
reaching hundreds of millions of euros worldwide [6]. The
takedown operation in 2016 was supported by authorities from
30 countries and culminated in ﬁve arrests, 260 servers being
taken ofﬂine and the suspension of over 800,000 domains [31].
Network and Distributed Systems Security (NDSS) Symposium 2020
23-26 February 2020, San Diego, CA, USA
ISBN 1-891562-61-4
https://dx.doi.org/10.14722/ndss.2020.24161
www.ndss-symposium.org
As part of this dismantling, a large domain takedown effort
sought to disable the botnet’s communication infrastructure.
This effort targets the large sets of domains that the malware
families of Avalanche generate through domain generation
algorithms (DGAs). Through this ‘domain ﬂuxing’ [71], in-
fected hosts attempt to contact all generated domains, whereas
the botnet master only needs to register one to continue
operating the malware, decreasing the likelihood of blacklisting
and takedown. However, as security researchers have reverse-
engineered several of these DGAs [71], law enforcement is
able to identify upfront which domains the malware will try,
after which these can be blocked or seized. Over four yearly
iterations of the Avalanche takedown, more than 4.3 million
domains were thus prevented from being abused, making it the
largest domain takedown so far [7].
Previous work related to DGAs focused on detecting
malicious domains in regular trafﬁc, relying on strong indicators
of ongoing malware activity, to discover new malware families
or ﬁnd infected hosts inside a network [16], [82], [100]. In
this paper, we address the orthogonal issue that the Avalanche
takedown faces: given – presumably malicious – DGA domains
that will be generated in the future and should proactively
be taken down, we seek to detect those that accidentally
collide with benign domains. In particular, we assess how
we can effectively support law enforcement investigators with
an automated domain classiﬁcation to inform the appropriate
takedown action in a real-world use case. This reduces the
extensive manual effort previously invested in this classiﬁcation,
while still maintaining the high accuracy required in such a
sensitive operation. Taking down benign domains may cause
prejudiced service interruption and harm their owners. At the
same time, we have to guarantee that no malicious domain is
left untouched, as this would allow malicious actors to target
infected users once again.
We are the ﬁrst to develop an approach that can be used to
effectively identify the domains registered with malicious intent,
within the constraints of a real-world takedown operation. First,
bulk patterns no longer apply, both for domains that are benign
(due to the accidental uncoordinated collisions) and malicious
(due to the low number of required domains). Second, as the
takedown is proactive, we cannot search for malicious activity
(any ongoing activity would mean that infected machines are
implicated in actual attacks and defeat the proactive purpose
of the takedown). Third, we cannot actively contact domains
so that the takedown can occur stealthily (otherwise attackers
could evade detection and undermine the takedown). Instead, we
rely on capturing more generic differences in how benign and
DGA-generated malicious domains are registered and operated.
We design a machine learning-based model for classifying
benign and malicious domains, and we evaluate it on ground
truth from the 2017 and 2018 iterations. Using a human-in-
the-loop approach that combines automated classiﬁcation and
manual investigation targeted at the most difﬁcult domains, we
achieve an accuracy of 97.6% for the real-world Avalanche
use case, ensuring high correctness while still vastly reducing
manual effort: in the 2019 iteration, our approach reduced
this effort by 76.9%. However, we go beyond reporting this
metric with an extensive analysis of the beneﬁts and limitations
brought by the machine learning approach as well as the real-
world setting. We provide an interpretation for the factors that
impact the decisions of the model, giving insight into how the
owners of benign and malicious domains behave differently and
how the model uses this information to make decisions. These
insights can help law enforcement in their choices regarding
the acceptable performance and reliability of the model.
Malware creators increasingly employ techniques that make
the takedown of their command and control infrastructure more
complex, and the scale of malicious operations continually
increases. Further automation of the takedown process with
our classiﬁer of malicious and benign domains can support law
enforcement in coping with the increased complexity. However,
we need to carefully design, evaluate, and analyze such an
approach to cope with the constraints of a real-world application
as to avoid any adverse effect on the legitimacy of the operation.
This enables law enforcement to continue disrupting malware
infrastructure and protecting potential victims.
In summary, our contributions are the following:
• We assess to what extent an automated approach can assist
law enforcement investigators in correctly detecting the
collisions with benign domains among registered domains
implicated in the Avalanche takedown, without the ability
to rely on bulk malicious registrations, ongoing malware
activity or actively collected trafﬁc.
• We develop a technique where we complement a machine
learning model with targeted manual labeling of the most
informative and difﬁcult domains, to maintain performance
across multiple takedown iterations while still vastly
reducing the required manual investigative effort.
• We evaluate how well this approach performs and transfers
for the 2017 and 2018 takedowns: we obtain an accuracy
of 97.6%. The predictions of our model were used in the
2019 takedown, and we ﬁnd a subsequent reduction in
manual investigative effort of 76.9%.
• We critically examine the factors that impact the perfor-
mance and decision-making process of our model. We ﬁnd
that time-based features are the most important ones, which
at the same time are the most costly to evade. In terms
of data set availability, WHOIS data greatly improves
accuracy, which shows its importance for conducting
effective cybercrime investigations.
II. BACKGROUND
A. Domain generation algorithms
Machines in a botnet such as Avalanche communicate
with the malicious actor through command and control (C&C)
servers. Early malware hard coded the domain names or IP
addresses of their C&C servers, so it was easy to obtain this
TABLE I.
EXAMPLES OF DOMAINS GENERATED BY AVALANCHE DGAS.
Domain
Malware Validity
1 0a85rcbe2wb5n5fkni4i4y[.]com CoreBot
Matsnu
2 researchmadness[.]com
Nymaim Mar 9, 2018
3 arbres[.]com
4 sixt[.]com
Nymaim always
Jan 21, 2018
Jan 28-31, 2018
information and either blacklist the servers or even take over
the corresponding infrastructure (by pointing for instance the
domains to ‘safe’ IP addresses and/or having hosting providers
take C&C servers down), effectively stopping the malware from
further malicious operation [18]. Malware has therefore evolved
from hard coding the C&C server information to dynamically
creating or updating it.
One technique of this dynamic approach is ‘domain ﬂuxing’,
in which domain generation algorithms (DGAs) create up to
thousands of algorithmically generated domains (AGDs) every
day [71]. The malware will then attempt to contact these
domains and ignore the unavailable ones: the botnet owner
therefore only needs to set up one of the generated domains to
host a C&C server [18]. Avalanche combined this technique
with ‘fast ﬂuxing’, in which compromised machines hosting a
proxy to the C&C server as well as the corresponding DNS
entries of the AGDs rapidly switch [41], thus further evading
blacklisting and takedown [31].
DGAs take as seeds parameters known to both the malware
owner and the infected host, so that they both generate the
same set of domains [18], [71]. These parameters such as the
length of domains, top-level domains (TLDs) to use, or seeds
for pseudo random number generators can be hard coded. More
complex algorithms may depend on time: one of the inputs
to the DGA is then the current time, either from the system
clock or retrieved from a common source (e.g., GET requests
to legitimate sites [99]). In this way, the DGA creates domains
having a certain validity period: the time frame during which the
seed timestamps make the DGA generate that domain, which
the infected machines then attempt to reach. For Avalanche
malware families, these validity periods range from 1 day (e.g.
Nymaim) to indeﬁnitely (e.g. Tiny Banker).
We can further distinguish between deterministic DGAs
that know all parameters upfront and non-deterministic DGAs
that know some parameters only at the time of generating the
domains: e.g., the DGA of the Bedep family uses exchange
rates as seeds [79]. Avalanche did not use any non-deterministic
DGAs so for successfully reverse-engineered DGAs [3], [71],
we can generate all potential AGDs ahead of their validity, by
varying the timestamp that serves as input to the DGA.
Table I lists example names generated by DGAs, from
malware hosted by Avalanche. While Example 1 appears
random (a long name with many digits and no discernible
words), certain DGAs generate names that look much more like
legitimate domains. Example 2 shows a name generated based
on a word list yielding domains that may correspond to a regular
domain name. Example 3 shows a short yet randomly generated
name for which there is a high probability of generating either a
valid word or a plausible abbreviation. These last two examples
have a high probability of generating domains that collide with
existing benign domains.
2
Finally, certain malware families alter domain resolution on
the infected host, generating trafﬁc to hard-coded and otherwise
benign domains that actually resolve to malicious IP addresses
to circumvent domain-based ﬁlters [40]. While these domains
are not algorithmically generated, they are present in malware
code and trafﬁc and must therefore also be classiﬁed as part of
the takedown operation, to distinguish them from other hard-
coded and actually malicious domains. Example 4 is one such
instance using the domain of the Sixt car rental site. We include
these domains in our classiﬁcation, but for brevity, we refer to
all domains to be classiﬁed as the ‘registered DGA domains’.
TABLE II.
NUMBER OF BENIGN AND MALICIOUS DOMAINS PER
ITERATION. *: ACCORDING TO OUR CLASSIFICATION.
Benign
Malicious
Classiﬁed
Sinkholed
Total
2017
1397
1145
2542
1177
3719
2018
1014
402
1416
594
2010
2019–2024*
4945
1053
5998
2293
8291
III. PROBLEM STATEMENT
B. Taking down the Avalanche infrastructure
A. Making accurate takedown decisions
The perpetrators behind the Avalanche infrastructure offered
two services for rent by cyber criminals: registering domain
names as well as hosting a layered network of proxy servers
through which malware actors could control infected hosts
and exﬁltrate stolen data [3]. Avalanche thereby supported the
operation of 21 malware families [5], controlling a botnet of
an estimated one million machines at the time of takedown [3].
Prosecutors completed the ﬁrst iteration of the takedown
in November 2016, where the whole infrastructure was dis-
mantled through arrests, server seizures, and domain name
takedowns [31]. For the latter,
iteration targeted
live C&C domains, but also those that would be generated
by the DGAs in the coming year, preemptively blocking
these to prevent Avalanche from respawning. This effort has
been repeated every year since, as in January 2020 infected
machines on over two million IPs still contacted the Avalanche
network [1], highlighting the potential damage if Avalanche
were to respawn.
the ﬁrst
Coupled with the large number of malware families and the
extensive amount of domains that these DGAs generate, this
results in a large number of DGA domains to be processed.
For the three yearly iterations from 2016 to 2018, this amounts
to around 850,000 domains per year [5], [7], while the 2019
iteration looks ahead ﬁve years and therefore treats almost 2
million domains: this means more than 4.3 million targeted
domains have been processed in total. For the DGA domains
in the Avalanche takedown, law enforcement took one of three
actions on the takedown date [4]:
• Block registration: for a not yet registered domain, the TLD
registry blocks registration. This is the case for the vast
majority of domains.
• Seize domain: for a domain registered by a seemingly
malicious actor, it is seized from the original owner and
‘sinkholed’, i.e. it is redirected to servers of the Shadowserver
Foundation. Optionally, domains are also transferred to
the “Registrar of Last Resort”. Through sinkholing, law
enforcement can then track how many and which infected
hosts attempt to contact the domains [1] and aid in mitigation
through notiﬁcations to network operators and infected
users [22]. Domain seizures require a legal procedure such