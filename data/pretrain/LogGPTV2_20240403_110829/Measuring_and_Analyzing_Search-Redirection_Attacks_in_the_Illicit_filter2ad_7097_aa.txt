title:Measuring and Analyzing Search-Redirection Attacks in the Illicit
Online Prescription Drug Trade
author:Nektarios Leontiadis and
Tyler Moore and
Nicolas Christin
Measuring and Analyzing Search-Redirection Attacks
in the Illicit Online Prescription Drug Trade
Nektarios Leontiadis
Carnegie Mellon University
Tyler Moore
Harvard University
Nicolas Christin
Carnegie Mellon University
Abstract
We investigate the manipulation of web search re-
sults to promote the unauthorized sale of prescription
drugs. We focus on search-redirection attacks, where
miscreants compromise high-ranking websites and dy-
namically redirect trafﬁc to different pharmacies based
upon the particular search terms issued by the consumer.
We constructed a representative list of 218 drug-related
queries and automatically gathered the search results
on a daily basis over nine months in 2010-2011. We
ﬁnd that about one third of all search results are one
of over 7 000 infected hosts triggered to redirect to a
few hundred pharmacy websites. Legitimate pharmacies
and health resources have been largely crowded out by
search-redirection attacks and blog spam. Infections per-
sist longest on websites with high PageRank and from
.edu domains. 96% of infected domains are connected
through trafﬁc redirection chains, and network analysis
reveals that a few concentrated communities link many
otherwise disparate pharmacies together. We calculate
that the conversion rate of web searches into sales lies
between 0.3% and 3%, and that more illegal drugs sales
are facilitated by search-redirection attacks than by email
spam. Finally, we observe that concentration in both the
source infections and redirectors presents an opportunity
for defenders to disrupt online pharmacy sales.
1
Prescription drugs sold illicitly on the Internet arguably
constitute the most dangerous online criminal activity.
While resale of counterfeit luxury goods or software are
obvious frauds, counterfeit medicines actually endanger
public safety.
Independent testing has indeed revealed
that the drugs often include the active ingredient, but in
incorrect and potentially dangerous dosages [48].
Introduction and background
In the wake of the death of a teenager, the US Congress
passed in 2008 the Ryan Haight Online Pharmacy Con-
sumer Protection Act, rendering it illegal under federal
law to “deliver, distribute, or dispense a controlled sub-
stance by means of the Internet” without an authorized
prescription, or “to aid and abet such activity” [35]. Yet,
illicit sales have continued to thrive in the nearly two
years since the law has taken effect.
In response, the
White House has recently helped form a group of regis-
trars, technology companies and payment processors to
counter the proliferation of illicit online pharmacies [19].
Suspicious online retail operations have, for a long
time, primarily resorted to email spam to advertise their
Figure 1: Example of the search-redirection attack. Only
two of the results actually belong to online pharmacies. The rest are
unrelated .com or .edu sites that had been compromised to redirect to
online pharmacies, or have been populated with spam. The top search
result (framed) was still infected at the time of this writing.
products. However, the low conversion rates (realized
sales over emails sent) associated with email spam [22]
has led miscreants to adopt new tactics. Search-engine
manipulation [47], in particular, has become widely used
to advertise products. The basic idea of search-engine
manipulation is to inﬂate the position at which a speciﬁc
retailer’s site appears in search results by artiﬁcially link-
ing it from many websites. Conversion rates are believed
to be much higher than for spam, since the advertised site
has at least a degree of relevance to the query issued.
In this paper, we focus on a particularly pernicious
variant of search-engine manipulation involving compro-
mised web servers, which we term search-redirection at-
tacks. Analyzing measurements collected over a nine-
month interval, we show that search-redirection attacks
are fast becoming the search engine manipulation tech-
nique of choice for online miscreants.
1.1 Search-redirection attacks
Figure 1 illustrates the attack. In response to the query
“cialis without prescription”, the top eight results include
ﬁve .edu sites, one .com site with a seemingly unre-
lated domain name, and two online pharmacies. At ﬁrst
glance, the .edu and one of the .com sites have abso-
lutely nothing to do with the sale of prescription drugs.
However, clicking on some of these links, including the
top search result framed in Figure 1, takes the visitor not
to the requested site, but to an online pharmacy store.
The attack works as follows. The attacker ﬁrst iden-
tiﬁes high-visibility websites that are also vulnerable to
code injection attacks.1 Popular targets include outdated
versions of WordPress [49], phpBB [38], or any other
vulnerable blogging or wiki software. The code injected
on the server intercepts all incoming HTTP requests to
the compromised page and responds differently depend-
ing on the type of request.
Requests originating from search-engine crawlers, as
identiﬁed by the User-Agent parameter of the HTTP re-
quest, return a mix of the compromised site’s original
content plus numerous links to websites promoted by the
attacker (e.g., other compromised sites, online stores).
This technique, “link stufﬁng,” has been observed for
several years [34] in non-compromised websites.
Requests originating from pages of search results,
for queries deemed relevant to what the attacker wants
to promote, are redirected to a website of the at-
tacker’s choosing. The compromised web server au-
tomatically identiﬁes these requests based on the Re-
ferrer ﬁeld that HTTP requests carry [14]. The Re-
ferrer actually contains the complete resource identiﬁer
(URI) that triggered the request. For instance, in Fig-
ure 1, when clicking on any of the links, the Referrer
ﬁeld is set to http://www.google.com/search?
q=cialis+without+prescription. Upon de-
tecting the pharmacy-related query, the server sends an
HTTP redirect with status code 302 (Found) [14], along
with a location ﬁeld containing the desired pharmacy
website or intermediary. The upshot is that the end user
unknowingly visits a series of websites culminating in a
fake pharmacy without ever spending time at the original
site appearing in the search results. A similar technique
has been extensively used to distribute malware [40],
while web spammers have also used the technique to hide
the true nature of their sites from investigators [33].
All other requests, including typing the URI directly
into a browser, return the original content of the website.
Therefore, website operators cannot readily discern that
their website has been compromised. As we will show
in Section 4, as a result of this “cloaking” mechanism,
some of the victim sites remain infected for a long time.
While each of the components (link stufﬁng, redirec-
tion chains) of the search-redirection attack has been pre-
viously observed, to our knowledge, no study has inves-
tigated the combined attack itself, its effect on search re-
1We defer the study of the speciﬁc exploits to future work. Our
focus in this paper is the outcome of the attack, not the attack itself.
sults, or the potential harm it inﬂicts.
Three classes of websites are involved in search-
redirection attacks. Source infections are innocent web-
sites that have been compromised and reprogrammed
with the behavior just described; redirectors are inter-
mediary websites that receive trafﬁc from source infec-
tions; and retailers (here, pharmacies) are destination
websites that receive trafﬁc from redirectors.
It
is not
immediately obvious who the victim is
in search-redirection attacks.
Unlike in drive-by-
downloads [40], end users issuing pharmacy searches
are not necessarily victims, since they are actually often
seeking to illegally procure drugs online. In fact, here,
search engines do provide results relevant to what users
are looking for, regardless of the legality of the products
considered. However, users may also become victims
if they receive inaccurately dosed medicine or danger-
ous combinations that can cause physical harm or death.
The operators of source infections are victims, but only
marginally so, since they are not directly harmed by redi-
recting trafﬁc to pharmacies. Pharmaceutical companies
are victims in that they may lose out on legitimate sales.
The greatest harm is a societal one, because laws de-
signed to protect consumers are being openly ﬂouted.
1.2 Summary of our contributions
Our study contributes to the understanding of online
crime and search engine manipulation in several ways.
First, we collected search results over a nine-month
interval (April 2010–February 2011). The data com-
prises daily returns from April 12, 2010–October 21,
2010, complemented by an additional 10 weeks of data
from November 15th 2010–February 1st 2011. Com-
bining both datasets, we gathered about 185 000 dif-
ferent universal resource identiﬁers (pharmacies, benign
and compromised sites), of which around 63 000 were
infected. We describe our measurement infrastructure
and methodology in details in Section 2, and discuss the
search results in Section 3.
Second, we show that a quarter of the top 10 search
results actively redirect from compromised websites to
online pharmacies at any given time. We show infected
websites are very slowly remedied: the median infection
lasts 46 days, and 16% of all websites have remained in-
fected throughout the study. Further, websites with high
reputation (e.g., high PageRank) remain infected and ap-
pear in the search results much longer than others.
Third, we provide concrete evidence of the existence
of large, connected, advertising “afﬁliate” networks, fun-
neling trafﬁc to over 90% of the illicit online pharmacies
we encountered. Search-redirection attacks play a key
role in diverting trafﬁc to questionable retail operations
at the expense of legitimate alternatives.
Fourth, we analyze whether sites involved in the phar-
2
maceutical trade are involved in other forms of sus-
picious retail activities, in other security attacks (e.g.,
serving malware-infested pages), or in spam email cam-
paigns. While we ﬁnd occasional evidence of other ne-
farious activities, many of the pharmacies we inspect ap-
pear to have moved away from email spam-based adver-
tising. We discuss infection characteristics, afﬁliate net-
works, and relationship with other attacks in Section 4.
Fifth, we derive a rough estimate of the conversion
rates achieved by search-redirection attacks, and show
they are considerably higher than those observed for
spam campaigns. We present this analysis in Section 5.
Sixth, we consider a range of mitigation strategies that
could reduce the harm caused by search-redirection at-
tacks in Section 6.
In addition to these contributions, we compare our
study with related work in Section 7, before concluding
in Section 8, where we also describe ongoing work track-
ing the promotion of other types of fraudulent goods.
2 Measurement methodology
We now explain the methodology used to identify search-
redirection attacks that promote online pharmacies. We
ﬁrst describe the infrastructure for data collection, then
how search queries are selected, and ﬁnally how the
search results are classiﬁed.
2.1
The measurement infrastructure comprises two distinct
components: a search-engine agent that sends drug-
related queries and a crawler that checks for behavior
associated with search-redirection attacks.2
Infrastructure overview
The search-engine agent uses the Google Web Search
API [2] to automatically retrieve the top 64 search re-
sults to selected queries. From manually inspecting some
compromised websites, we found that search-redirection
attacks frequently also work on other search engines.
Every 24 hours, the search-engine agent automatically
sends 218 different queries for prescription drug-related
terms (e.g., “cialis without prescription”) and stores all
13 952 (= 64 × 218) URIs returned. We explain how we
selected the corpus of 218 queries in Section 2.2.
The crawler module then contacts each URI collected
by the search-engine agent and checks for HTTP 302
redirects mentioned in Section 1.1. The crawler emulates
typical web-search activity by setting the User-Agent and
Referrer terms appropriately in the HTTP headers. Ini-
tial tests revealed that some source infections had been
programmed to block repeated requests from a single IP
address. Consequently, all crawler requests are tunneled
through the Tor network [11] to circumvent the blocking.
2All results gathered by the crawler are stored in a mySQL database,
available from http://arima.ini.cmu.edu/rx.sql.gz.
2.2 Query selection
Selecting appropriate queries to feed the search-engine
agent is critical for obtaining suitable quality, coverage
and representativeness in the results. We began by issu-
ing a single seed query, “no prescription vicodin,” cho-
sen for the many source infections it returned at the time
(March 3, 2010). We then browsed the top infected re-
sults posing as a search engine crawler. As described in
Section 1.1, infected servers present different results to
search-engine crawlers. The pages include a mixture of
the site’s original content and a number of drug-related
search phrases designed to make the website attractive
to search engines for these queries. The inserted phrases
typically linked to other websites the attacker wishes to
promote, in our case other online pharmacies.
We compiled a list of promoted search phrases by vis-
iting the linked pharmacies posing as a search-engine
crawler and noting the phrases observed. Many phrases
were either identical or contained only minor differences,
such as spelling variations on drug names. We reduced
the list to a corpus of 48 unique queries, representative
of all drugs advertised in this ﬁrst step.