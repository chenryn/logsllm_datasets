---
## Page 533
网络安全进阶笔记
(4）计费管理和安全管理
计费管理功能为网络管理者提供了分配网络资源使用费用的依据，主要包括使用事件报告
以及数据操作软件通知用户有关费用：允许对被管理资源的使用设置计费限制：当使用多种资
源实现所需通信时，可以将各种费用综合在一起。安全管理设施则使得网络系统管理者能够为
通信资源提供访问保护。
3.企业网管系统的选购技巧
因此，网管系统不单单是网管软件的事，还与被管理的网络设备密切相关。网络设备必须
能够收集、保存设备及其连接网络线路的相关故障和性能参数，网管工作站上的网管软件负责
定期、自动采集这些参数，并正确处理它们，使之对用户有用。然后，定期主动轮询，获取数
据：也可以被动接收网络设备发出的 SNMPTrap、syslog以获取报警数据。从技术角度而言，
网管软件数据采集模块的设计优劣是影响其性能、可扩展性的重要因素，也是考察网管软件的
重要指标。
目前市场销售的网络管理软件也可以按功能划分为网元管理、网络层管理、应用层管理3
个层次，其中网元管理是最基础的。现在，不同厂家都纷纷推出自己的网管软件，那么，如何
选择一个网管系统呢？
（1）以业务为中心，把握网管需求。最根本的一条，我们必须知道网络使用的设备类型，
网络是如何组织的。因此，首先要列出所有的网管需求，其中哪些是想要的，哪些是不想要的。
通过需求表，可以清楚地知道现在到底需要哪些功能。毕竞，花很大的代价购买自己并不需要
的服务是很浪费的。一般面言，具体的需求有：向管理员报告服务器上的流量状况、路由器上
的流量过载或者网络出现瓶颈：能通过基于策略的网络管理主动采取行动，如重新启动停止的
流程等：还应该能向有关人员发出警报，如通过电子邮件或寻呼等：能够提供方便面且强大的
方法，显示将受影响的业务过程、业务部门甚至个人。
(2）为应用软件和服务提供环境。SLA（服务水平协议）是反映当前服务状况的一个重要指
标，并且逐渐被当作网管产品的重要特性来看待。“一千个读者，就有一千个哈雷姆特”，同
样，一千个企业，就有一千个具体的服务水平，如联机股票交易所的任务是保证数百万小时实
时处理100%的准确性，所以，深刻理解网管产品中的这个重要指标具有重大的意文，有利于
衡量服务水平与企业需要之间的匹配程度，从而使之用于报告、趋势分析和容量规划。
(3）可扩展性、易用性和集成性的结合。网络设备多，故障类型多，是网管实践中的一个
典型问题。因此，能够集成第三方产品提供的功能是很重要的，因为大部分厂商都依赖于第三
方厂商提供一些补充，来使它们的系统变得更为完整。因此，可扩展性成为用户选择网络管理
解决方案的一个重要标准。另外，从管理的方便性考虑，一些实用的网络管理手段也必须考虑
到，才能提高网络管理的效率。值得一提的是，目前很多网管产品都提供试用版本，我们可以
向一些企业提出试用申请，只有亲身体会到可扩展、易用、高集成的特点后，才能有的放矢地
进行产品定型。
（4）性能价格比。购买网管产品时，我们不仅追求功能强大，还要效率高面且成本、开发
费用和硬件需求低。从目前的市场行情看，国外软件占据着大份额市场，如CA的系统强调把
网管和系统管理集成在一起：HP的OpenView把重点放在通过大量的第3方软件支持等。但
这些国外软件的界面采用英文，推广和使用有一定的困难，经常需要一个专业的技术团队来管
---
## Page 534
第11章企业网络安全进阶
理这些大型网管系统，实施和应用非常复杂。相比之下，国内网管软件几乎全部是中文界面，
针对国内开发使用，有本土化优势，不需要专业的人员也可维护操作，适合国内客户。这些产
品价格便宜，可以有良好的售后服务保证，以及较低的维护和使用成本，有很好的性能价格比。
但我们也应该看到，国内网管软件刚刚起步，还存在许多不完善的地方。
（5）标准支持和协议的独立性。SNMP等标准已经成熟，所有人都可用它们制作产品。真
正的全面网络管理解决方案应支持现有甚至新兴的标准，将其纳入自己的体系结构。不仅要支
持SNMP，还要支持DHCP（动态主机配置协议）和DNS、DMI（桌面管理规范）及CIM（公共信息
管理）。这样，无论网络管理员以后选择哪种技术或设备，解决方案都能监视和管理整个网络。
因此，真正的企业网络管理解决方案应支持所有网络协议，应能在各种类型的硬件和操作系统
上运行，而不仅仅贴近某个厂商或某种操作系统。
（6）长远规划和二次开发。我们从技术上探讨了一些选购的原则，实现网络管理是一个渐
进的过程，在规划网管系统时，要重点考虑能方便升级额外的功能：符合工业标准，最好是基
于SNMP的管理系统：支持第三方插件的能力，允许应用开发人员开发其他的模块，以支持其
他公司的产品：支持专用数据库：数据库的统一等，另外，在实际应用中，并不能完全依赖于
网管产品，由于网络系统的复杂和多变，现成的产品往往难以解决所有的网管问题，在条件允
许的情况下，还要考虑二次开发的可能性。
实际使用和选购中，要本着“量体裁衣”的原则，尽量根据单位网络的实际情况，选择合
适的网络管理产品。在目前的安全产品中，防火墙、IDS入侵检测系统等已经成为十分通用的
产品。下面，主要针对企业网络安全产品的部署进行讲解。
11.2.4防火墙特点及安全部署
如果直接将一个未经安全保护的企业网络放到互联网上，无疑会带来很多威胁。通过访间
控制策略，防火墙能够屏蔽和允许指定的数据通讯，从面实现合法的通讯。但是，目前防火墙
的种类很多，不同类型的防火墙也有很大的功能差异。在实际应用中，应该如何选购并部署防
火墙呢？
目前，主要的防火墙有包过滤防火墙、基于状志的包过滤防火墙、应用代理（网关）防火墙
下面逐一分析这些防火墙的差异。
1.包过滤防火墙
包过滤防火墙最常见的例子就是互联网上的路由设备，如常见的Cisco路由器，这类防火
墙通常工作在OSI的三层及三层以下，使用者可以通过定制访问控制列（ACL）来对路由器进出
端口的数据包进行控制。包过滤防火墙的可控内容主要包括：报文源地址、报文目标地址、服
务类型，以及第二层数据链路层可控的MAC地址等。
包过滤防火墙适合放在局域网的前端，如控制进入局域网的数据包的可信任IP，对外界开
放尽量少的端口等。这种防火墙的整端也是显而易见的，比较关键的几点如下。
（1）由于无法对数据包及上层的内容进行核查，因此无法过滤审核数据包的内容。此类防
火墙生成的日志常常只是包括数据包捕获时间，三层的IP地址，四层的端口等非常原始的信
息。以下是一个典型的日志记录：
531
---
## Page 535
网络安全进阶笔记
Nov1122:13:05y.y.y.y IPmon[10841]:22:13:04.733237hme0.40:13bx.x.x.x,4131
->y·y.y.y.3389 PR tcp 1en 2048-S IN
这条信息十分简单，它表示防火墙在11月11日22点13分阻止了源IP地址为x.x.xx
源端口为4131，目的IP地址是y.y-y-y、目的端口是3389的数据包，包头为20字节，净荷长
度为28字节。
(2）如上所述，在数据传输过程中，所有有可能用到的端口都必须静态放开，增加了被攻
击的可能性。
(3）如果网络结构比较复杂，配置ACL将是一件非常复杂的事情。尤其是当网络发展到
一定规模时，ACL几乎肯定会出错，无疑增加了管理的难度。
2.基于状态的包过滤防火墙
当被防火墙保护的设备与外界通讯时，绝大多数应用要求发出请求的系统本身提供一个端
口，用来接收外界返回的数据包，面且这个端口一般是在1023~16384之间不定的。但是，如
果不放开这些端口，通讯将无法完成。通常情况下，设置为开放1023以上的全部端口，允许
这些端口的数据包自由进出。这样的设置，使得防火墙的功能大打折扣，攻击者设置可以利用
这个弱点轻松地对目标系统进行攻击。
那么，能够在包过滤防火墙的基础上，增加对OSI第4层的支持吗？是否可以考虑在防火
墙自身缓存或内存中对状态表进行处理呢？答案是肯定的，因为基于状态的包过滤防火墙可以
解决这个同题，
现在，焦点集中这样一个疑间：这个动态的状态表包括什么内容，又是如何产生的呢？一
千个莎士比亚就有一千个哈姆雷特，一千个厂家也会有一千种实现方式。一般米说，防火墙中
状态表的内容包括：数据包的来源/目的IP地址、来源/目的端口、时间，以及数据包的Sequence
Number(对于TCP连接）、数据包的标志符等（对于TCP连接）。
如同在保密局门口的哨兵查验证件一样，当来访者达到门口的时候，哨兵会检查证件是否
合法，如果属于合法的身份证明，则会对来访进行接待，当来访者和哨兵建立一种互信关系后，
他们之间的下一次访问控制就会更加高效。
同理，在基于状态的包过滤防火墙中，当有数据包到达防火墙时，状态表中的参数将决定
数据包是否属于一个已经合法的会话。如果防火墙接收到一个初始化TCP连接的带syn标志包，
这个包会首先被防火墙的访问控制列检查，如果数据包符合某条访问控制规则，那么就会在状
态表中建立一个新的会话。如果后续的数据包在某个设定的超时后依然没有到达，则此次会话
就会被去弃。
通过上面的分析可以看到，在防火墙规则中，只要打开某一个特定的端口即可。这样可以
明显提供安全性，而且也提升了防火墙的效率。对系统管理员而言，配置访问规则时需要考虑
的内容也更加简单，大大降低了出错的可能性。
3.应用代理（网关）防火墙
相对以上防火墙，应用代理（网关）防火墙是基于软件的，它将OSI七层的应用层也包含进
来。说得更通俗一点，这种防火墙就是一个外部网络和内部网络之间的翻译器。
就像某个特务头子的贴身秘书一样，秘书收到对方的机密信息之后，首先会进行判断，如
52
---
## Page 536
三
第11章企业网络安全进阶
果符合规定，就会将信息转给特务头子，特务头子进行回复之后，由秘书再转交给对方。在这
个过程中，贴身秘书起着代理的作用，直接与对方进行联系，面特务头子则可以很好地通过这
个代理来保护自己。
在应用代理（网关）防火墙中，防火墙会截获所有的通讯内容，如果连接符合预定的访问控
制规则，则代理将数据转发给目标系统，目标系统回应给代理：然后代理再将传回的数据送回
客户机，这类防火墙提供了更多的功能，尤其是提供了更加复杂的访问控制，如严格的认证机
制，甚至还可以包含数字证书：通过对内容进行过滤，阻止特定的攻击：通过日志功能，记载
通讯过程等。
不过，这类防火墙的速度有所降低，因为所有的连接请求在代理网关上都要经过软件的接
受、分析、转换、转发、审查等工作。
4.选购和使用防火墙
在选购和使用防火墙时，还需要考虑以下问题。
(1）最全的不一定是最好的，最贵的不一定是最好的，在选购防火墙之前，首先要明白企
业的需求才是重要的，一味地贪大求全，往往会适得其反，在安全上也会大打折扣。
(2）不要过分迷信厂家的配置。目前，很多单位都是依靠防火墙厂家的技术人员提供技术
支持，但应当警惕的是，厂家的技术人员对公司的业务了解往往不全面，在短期内很难实现精
心定制及实底安全策路，这就需要进行动态跟踪，产防网络的安全漏润。
(3）避免“一次配置，长期运行”。很多单位在初次配置成功之后，将防火墙落在一边，
面忽视了动态的安全需求。实际上，安全是相对的，这就需要根据企业的安全需求，动态地更
改访问策略。否则，就像在一座戒备森严的宫殿里挖了条秘密地道样，再好的防火墙也无
法起到保护作用。
11.2.5分布式拒绝服务攻击及防范
一位资深的安全专家给了个形象的比喻：DDoS就好像有1000个人同时往你家里打电话，
这时候你的朋友还打得进来吗？拒绝服务攻击（DoS）就是利用合理的服务请求来占用过多的服
务资源，从而使合法用户无法得到服务的响应。
1.分布式拒绝服务攻击原理
单一的DoS攻击一般是采用一对一方式的，当攻击目标CPU速度低、内存小或者网络带
宽等各项性能指标不高时，它的效果是明显的。但是，如果攻击软件每秒钟可以发送5.000个
攻击包，但现在的主机与网络带宽每秒钟可以处理18,000个攻击包，这样攻击就没什么效果了。
这时候分布式的拒绝服务攻击手段（DDoS）就应运而生了。试想，如果攻击者使用10台、
100台呢？DDoS就是利用更多的倪偏机，以更大的规模来进攻受害者。被DDoS攻击时，通
常会有以下现象：网络中充斥着大量无用的数据包，源地址为假：被攻击主机上有大量等待的
TCP连接：制造高流量无用数据，造成网络拥塞：利用受害主机提供的服务或传输协议上的缺
陷，反复高速地发出特定的服务请求，使受害主机无法及时处理所有正常请求：严重时会造成
系统死机。
---
## Page 537
网络安全进阶笔记
以下是典型的攻击运行原理，如图11.20所示。
3
2
图11.20分布式拒绝服务攻击体系结构
通过观察，可以看到DDoS攻击体系可以分成4大部分。第1部分是黑客，这是藏在幕后
的指使者：第2和第3部分则被用于控制和实际发起攻击：第4部分则是这次攻击的受害者。
在这个结构图中，DDoS的实际攻击包是从第3部分攻击倪倡机上发出的，第2部分的控制机
只发布命令而不参与实际的攻击。在平时，这些恢倡机器并没有什么异常，只是一旦黑客连接
到它们进行控制，可能就会在无形之中成为黑客的“爪牙”了。
2.一次DDoS攻击过程分析
一般来说，黑客进行DDoS攻击时会经过下面这样的步骤。
（1）搜集并了解目标的情况。事先搜集情报对DDoS攻击者来说是非常重要的，这关系到
使用多少台愧机才能达到效果的问题。这些情报通常包括：被攻击目标主机的数目、地址情
况：目标主机的配置、性能：目标的带宽。
（2）占领愧机。通需情况下，黑客最感兴趣的是链路状态好、性能好、安全管理水平差
的主机。为了占领愧机，黑客往往会随机地或者是有针对性地利用扫描器去发现互联网上那