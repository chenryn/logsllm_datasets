Labs. Learning Modules all cover specific penetration testing concepts or techniques, while
Challenge Labs require the learner to apply the skills acqsuired via the Modules.
Learning Modules are divided into Learning Units: atomic pieces of content that help the learner
o
achieve specific Learning Objectives.
In this Learning Module we will cover the following Learning Units:
n
• Getting Started with PWK
i
• How to Approach the Course
z
• Summary of PWK Learning Modules
D
2.1 Getting Started with PWK
This Learning Unit covers the following Learning Objectives:
• Take inventory over what’s included in the course
• Set up an Attacking Kali VM
• Connect to the PWK VPN
Much like learning to play a musical instrument, security training requires equal parts of
conceptual knowledge and hands-on practice. In this Learning Unit we’ll learn what kind of
material is included with PWK, how to set up our attacking Kali VM, and how to reach the PWK
labs over a VPN connection.
2.1.1 PWK Course Materials
The course includes online access to the Learning Modules and their accompanying course
videos. The information covered in the Modules and the videos overlap, meaning you can read the
Modules and then watch the videos to fill in any gaps or vice versa. In some cases, the book
modules are more detailed than the videos. In other cases, the videos may convey some
information better than the Modules. It is important that you pay close attention to both.
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 16
Made in Morocco
Penetration Testing with Kali Linux
The Learning Modules also contain various exercises. Completing the Module exercises will help
you become more efficient with discovering and exploiting the vulnerabilities in the lab machines.
Some Module exercises have a simple question-and-answer where the learner is tasked with
retrieving the solution from the text. Other Module exercises have three components: a question,
a machine (or a group of machines), and a flag. In these cases, the question asks you to perform
a specific action or set of actions on the provided machine. Once you have successfully
completed the objective, you will receive a flag in the form OS{random-hash}. You can then
submit the flag into the OffSec Learning Portal (OLP), which will tell you if you have inserted the
correct flag or not. The OLP will then save your progress, and track the number of your correct
submissions provided to date.
It is worth noting that flags are dynamically generated at machine boot and expire at machine
shutdown. If the solution is obtained to a question and the machine is reverted, and only after the
revert the original answer is submitted, the OLP will not accept the flayg.
k
The flag must be submitted before reverting or powering off the machine.
s
As an additional note, the way Module exercises are implemented allows us to use the same
o
remote IP and port multiple times. On the Module Exercise VMs that require an SSH connection,
we suggest issuing the SSH command with a couple of extra options as follows:
n
ssh -o "UserKnownHostsFile=/dev/null" -o "StrictHostKeyChecking=no"
PI:EMAIL
Listing 1 - The recciommended way to SSH into Module Exercise VMs
z
The UserKnownHostsFile=/dev/null and StrictHostKeyChecking=no options have been added to
prevent the known-hosts file on our local Kali machine from being corrupted.
D
Module Exercises are currently supported on the x86-64 Kali Linux version
exclusively
We will go over the design of different kinds of Module exercises in a section below.
2.1.2 Student Mentors and Support
Discord,1 our community chat platform, can be accessed via the Profile drop-down at the upper
right hand corner of the OffSec Learning Portal. Live Support will allow you to directly
communicate with our Student Mentors and Student Technical Services Teams.
The Technical Services Team is available to assist with technical issues, while the Student
Mentors will be able to clarify items in the course material and exercises. In addition, if you have
tried your best and are completely stuck on an exercise or lab machine, Student Mentors may be
able to provide a small hint to help you on your way.
1 (OffSec, 2023), https://discord.gg/offsec
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 17
Made in Morocco
Penetration Testing with Kali Linux
Remember that the information provided by the Student Mentors will be based on the amount of
detail you are able to provide. The more detail you can give about what you’ve already tried and
the outcomes you’ve been able to observe, the more they will be able to help you.
2.1.3 Setting up Kali
The Module Exercises and Challenge Labs are to be completed using virtual machines (VMs)
operating in our lab environment. When we refer to a lab environment, we mean the combination
of the following components:
• Your Kali Linux VM
• The OffSec Learning Portal
• A lab containing deployable target machines
y
• A VPN connection between your Kali VM and the lab
Let’s look at these components individually. k
Kali Linux2 is an operating system (like Windows or macOS) that comes with a curated set of
s
tools that are specifically useful for penetration testing and other information security activities.
Kali Linux is open source and free to use.
o
If you’re already familiar with cybersecurity, you may have Kali Linux installed and can skip ahead
to the next section.
n
If not, we strongly recommend installing Kali on a VM, which provides the functionality of a
physical computer system running another operating system (OS) within a program called a
i
hypervisor. The benefit of using a VM is that it allows us to run a guest OS within a host OS.
Although we could physically instzall Kali on a dedicated machine, it is more convenient, safe, and
efficient to install Kali within our host system. Among other reasons, this ensures that we have
easy access to all the tools Davailable to both.
For example, we may be using a desktop computer running Windows or a laptop running macOS.
We could install VMware Workstation Player on our Windows machine or VMware Fusion on our
Mac to install the Kali Linux VMware image. When this virtual image is installed, Kali will run
alongside our primary operating system in a window, or full-screen if we like. If configured
properly, Kali Linux will have access to the network with its own IP address and will behave as if
it’s installed on a dedicated machine for the most part.
From a terminology standpoint, we call the physical system running Windows or
macOS our host machine and we call the Kali VM a guest machine.
The VMware image that we recommend is a default 64-bit build of Kali Linux. We recommended
using the latest VMware image available on the OffSec VM image download page.3 Note that
2 (OffSec, 2023), https://help.offsec.com/hc/en-us/articles/360049796792-Kali-Linux-Virtual-Machine
3 (OffSec, 2023), https://help.offsec.com/hc/en-us/articles/360049796792-Kali-Linux-Virtual-Machine
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 18
Made in Morocco
Penetration Testing with Kali Linux
although the VirtualBox image, the Hyper-V image, or a dedicated installation of Kali should work,
we can only provide support for the indicated VMware images.
In the next section, we’ll set up the VPN connection that will connect us to the lab.
2.1.4 Connecting to the PWK Lab
Many of the Module exercises and all of the lab machines will require you to connect to a Virtual
Private Network (VPN).
A VPN essentially creates an encrypted tunnel that allows your data to traverse an open network
such as the public Internet, and connect to another otherwise isolated network securely.
We’ll connect to the VPN from our Kali machine, granting us access to the lab. When a learner
connects to the lab, the specific segment of the network they connect to is private to them. In
y
other words, each connection is to a unique environment in which the learner can work at their
own pace without worrying about interrupting, or being interrupted by, other learners.
k
Even though each lab is private, it is prudent to consider the labs as a hostile environment and you
should not store sensitive information on the Kali Linux virtual machine used to connect to the
s
VPN. Client-to-client VPN traffic is strictly forbidden and could result in termination of access
from the course and its materials.
o
Fortunately, connecting to a VPN is a quick and easy process. If you’re using Kali as a VM, go
ahead and start the machine. Then on the Kali machine, open up a browser and navigate to the
n
OffSec Learning Portal and sign in.
Next, let’s navigate to the Course drop-down menu and select the PEN200 course. This will take
i
us to the main course page. At the top right corner of the page but to the left of your account
z
name, you’ll see the download drop-down menu for VPN. Clicking this option will generate a VPN
pack for this course and download it in the form of a .ovpn text file. Be sure to note the location of
D
the download.
Next, let’s use the Kali Linux terminal to connect to the VPN. Clicking the black terminal icon at the
top-left of the Kali VM will present a window like this:
┌──(kali㉿kali)-[~]
└─$
Listing 2 - The kali terminal
If we chose a different username during setup, our prompt will include that name:
┌──(ArtVandelay㉿kali)-[~]
└─$
Listing 3 - The kali terminal with a different username
In some cases, your screen may differ from what’s shown in the course material.
This is rarely problematic, but we will often point out these potential
inconsistencies.
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 19
Made in Morocco
Penetration Testing with Kali Linux
C p
This is the command prompt, which accepts our user commands. For simplicity we will switch to
a less-complex version of the terminal with + as shown in Listing 4.
kali@kali:~$
Listing 4 - Switching to the one-line command prompt
Next, we’ll focus on the VPN pack (i.e., the .ovpn file we downloaded). We should have
downloaded it to the Kali VM, but if it was downloaded to the host machine, we should either copy
it over or re-download it from Kali. Let’s use updatedb and locate to find the file.
kali@kali:~$ sudo updatedb
[sudo] password for kali:
kali@kali:~$ locate pen200.ovpn
/home/kali/Downloads/pen200.ovpn
Listing 5 - Finding the .ovpn file y
Note that we used the sudo command to invoke updatedb, because this particular command
k
requires elevated permissions. The updatedb command creates or updates a database that is
used by the locate command to find files across the entire filesystem. The sudo command will
require us to enter our password. Note that the cusrsor will not move and no I asterisk (*)
characters will appear as we type the password. We’ll type in our password and press .
o
Based on this output, we are using the filename pen200.ovpn. We can check the browser’s
download history to determine the exact name of the file.
n
Once we have located the .ovpn file, we’ll cd to its directory, which is /home/kali/Downloads in
this case.
i
kali@kali:~$ cd /home/kali/Dowznloads
kali@kali:~/Downloads$
D
Listing 6 - Changing Directories with cd
Although this command doesn’t produce any output (unless we entered the command
incorrectly), we can check for the .ovpn file with ls, which lists files in this directory. Note that the
output of the below command on your machine may appear different depending on what files are
in the Downloads directory.
kali@kali:~/Downloads$ ls
pen200.ovpn
Listing 7 - Listing file contents with ls
Executing files from Downloads can be a little bit messy, since that particular directory can
change so often. Instead, let’s create a new directory and move the .ovpn file there.
kali@kali:~/Downloads$ mkdir /home/kali/offsec
kali@kali:~/Downloads$ mv pen200.ovpn /home/kali/offsec/pen200.ovpn
kali@kali:~/Downloads$ cd ../offsec
kali@kali:~/offsec$
Listing 8 - Creating a new directory and moving the .ovpn file
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 20
Made in Morocco
Penetration Testing with Kali Linux
Here we create a new directory using mkdir, move the .ovpn file with mv and then change our
working directory with cd.
We’re now ready to connect to the VPN. We’ll connect with the openvpn command followed by
the full name of the .ovpn file. Once again we must use sudo, since openvpn requires elevated
permissions. Note that sudo caches our password for a short time. If we enter this second sudo
command shortly after the first, we will not need to re-enter the password.
kali@kali:~/offsec$ sudo openvpn pen200.ovpn
2021-06-28 10:20:12 Note: Treating option '--ncp-ciphers' as '--data-ciphers'
(renamed in OpenVPN 2.5).
2021-06-28 10:20:12 DEPRECATED OPTION: --cipher set to 'AES-128-CBC' but missing in --
data-ciphers (AES-128-GCM). Future OpenVPN version will ignore --cipher for cipher
negotiations. Add 'AES-128-CBC' to --data-ciphers or change --cipher 'AES-128-CBC' to
--data-ciphers-fallback 'AES-128-CBC' to silence this warning.
y
2021-06-28 10:20:12 OpenVPN 2.5.1 x86_64-pc-linux-gnu [SSL (OpenSSL)] [LZO] [LZ4]
[EPOLL] [PKCS11] [MH/PKTINFO] [AEAD] built on May 14 2021
2021-06-28 10:20:12 library versions: OpenSSL 1.1.1k 25 Mar 2021, LZO 2.10
k
2021-06-28 10:20:12 TCP/UDP: Preserving recently used remote address:
[AF_INET]192.95.19.165:1194
2021-06-28 10:20:12 UDP link local: (not bound) s
2021-06-28 10:20:12 UDP link remote: [AF_INET]192.95.19.165:1194
2021-06-28 10:20:12 [offsec.com] Peer Connection Initiated with
o
[AF_INET]192.95.19.165:1194
2021-06-28 10:20:13 TUN/TAP device tun0 opened
2021-06-28 10:20:13 net_iface_mtu_set: mtu 1500 for tun0
n
2021-06-28 10:20:13 net_iface_up: set tun0 up
2021-06-28 10:20:13 net_addr_v4_add: 192.168.49.115/24 dev tun0
2021-06-28 10:20:13 WARNING: this configuration may cache passwords in memory -- use
i
the auth-nocache option to prevent this
z
2021-06-28 10:20:13 Initialization Sequence Completed
Listing 9 - Connecting to the labs VPN
D
The output of Listing 9 may seem intimidating at first. For now, simply note that the last line of
the output reads “Initialization Sequence Completed”, indicating that we have connected
successfully to the VPN. Make sure that you can find it on your own connection!
We must leave this command prompt open. Closing it will disconnect the VPN connection.
We can open another terminal tab by clicking File > New Tab.
Once we are connected to the PWK VPN, we will be provided with a TUN0 network interface,
which we can view with the ip a command. The address assigned to the TUN0 interface will be
192.168.119.X, where X is some value between 1 and 255. Every time we reconnect to the VPN,
we might get assigned a different value for X.
In addition, all lab machines within the PWK environment will have addresses that follow the
format 192.168.X.Y, where X is the same value as the third octet of our TUN0 address, and Y is
the specific octet associated with the machine.
In the course material, we will be using different IP addresses for our TUN0 network interface as
well as for the lab machines. Please make sure you are using the IP addresses assigned to you
via TUN0 and via the OLP so that you can access the machines properly.
Lab time starts when your course begins and is metered as continuous access.
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 21
Made in Morocco
Penetration Testing with Kali Linux
If your lab time expires, or is about to expire, you can purchase a lab extension at any time. To
purchase additional lab time, use the Extend link available at top right corner of the OffSec
Training Library. If you purchase a lab extension while your lab access is still active, you can
continue to use the same VPN connectivity pack. If you purchase a lab extension after your
existing lab access has ended, you will need to download a new VPN connectivity pack via the
course lab page in the OffSec Learning Portal
learners who have purchased a subscription will have access to the lab as long as the
subscription is active. Your subscription will be automatically renewed, unless cancelled via the
billing page.
2.2 How to Approach the Course
This Learning Unit covers the following Learning Objectives:
y
• Conceptualize a learning model based on increasing uncertainty
ink
• Understand the different learning components included PWK
2.2.1 A Model of Increasing Uncertainty s
Penetration testing - and information security in general - is fundamentally about reasoning under
o
uncertainty. Consider how a game like chess is different from a game like poker. In chess, you
know everything that your opponent does about the game state (and vice versa). You may not
know what they are thinking, but you can mnake predictions about their next move based on the
exact same information that they are using to determine it. When playing poker, however, you do
not have all of the information that your opponent possesses, so you must make predictions
i
based on incomplete data.
z
In this regard, penetration testing is a lot closer to poker than chess. When we simulate an attack,
we will never know everything there is to know about the machine/system/network/organization
D
we are targeting. We therefore must make assumptions and estimate probabilities - sometimes
implicitly and sometimes explicitly. Conversely, as the defender, we will not be aware of every
potential attack vector or vulnerability we might be exposed to. We therefore need to hedge our
bets and make sure that our attack surfaces that are most likely to be vulnerable are adequately