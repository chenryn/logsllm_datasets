DstPort
Fixed
Fixed
Fixed
Fixed
Port Scan
Fixed/Random
Fixed
Random Sequential
FlowSize
Fixed (10 Kbps), 1 ﬂow per packet
Random (300-400 Kbps), 1 ﬂow per host
1-3 packets (10% response rate)
1-3 packets (10% response rate)
1-3 packets (10% response rate)
Table 5: Taxonomy of synthetic anomalies used in our evaluation.
e
r
o
c
s
t
l
e
e
v
a
W
 20
 18
 16
 14
 12
 10
 8
 6
 4
 2
 0
 0
FSD
SrcPorts
DstPorts
DstAddr
SrcAddr
OutDeg
InDeg
 1
 1.5
 0.5
% of DDos Traffic to Non-Attack Traffic
(a) DDoS ﬂood.
 2
e
r
o
c
s
t
l
e
e
v
a
W
 9
 8
 7
 6
 5
 4
 3
 2
 1
 0
 0
DstPorts
DstAddr
SrcPorts
SrcAddr
FSD
OutDeg
InDeg
 100
 150
 50
% of Flood Traffic to Non-Attack Traffic
(b) Bandwidth ﬂood.
 200
e
r
o
c
s
t
l
e
e
v
a
W
 10
 9
 8
 7
 6
 5
 4
 3
 2
 1
 0
InDeg
FSD
SrcPorts
DstPorts
DstAddr
SrcAddr
OutDeg
 1
 10
 100
% of Scan Flows to Non-Attack Flows
(c) Multiple scanners.
Figure 2: Synthetic anomaly results.
detect the anomaly (i.e., the score is ≥ α = 2) only when
the anomaly has signiﬁcantly increased in magnitude. The
degree distributions are unaﬀected by this anomaly.
Bandwidth Flood: In a bandwidth ﬂood, a small num-
ber of hosts send large amounts of traﬃc to a single destina-
tion. The key diﬀerences with respect to the DDoS attack
are that the number of hosts involved is an order of mag-
nitude smaller than the DDoS, and that each attack ﬂow
is a single high-volume ﬂow. We vary the number of hosts
involved in ﬂooding a single target IP address. The rate
of traﬃc from each host varies uniformly in the range of
300 to 400 Kilobits per second with a ﬁxed packet size of
57 bytes. The target IP is chosen at random within the
university with a speciﬁc destination port (e.g., port 80 on
a webserver). Again, the results were independent of the
choice of port and destination host.
Figure 2(b) shows that the behavioral features, FSD, source
port, and source address are unaﬀected. Since each source
generates a single ﬂow (and the size of each ﬂow is random),
FSD is not eﬀective at detecting this anomaly. As expected,
destination ports and addresses exhibit the greatest devia-
tion. However, traﬃc volume can detect this anomaly just
as well given that, at a detection threshold α = 2, the total
traﬃc has increased by 25%.
Network Scans: We consider two types of scanning ac-
tivity: a single host scanning the entire university address
space and distributed scanning activity from a set of random
source addresses. To model the properties of real scanning
activity (e.g., responses probability), we sample 10,000 in-
bound scan ﬂows to port 445 (associated with many known
vulnerabilities [13]) from the traﬃc trace. We observe that
scans receive responses to probes approximately 10% of the
time for a ﬂow size of 3 packets, else they are single-packet
ﬂows (just a SYN packet). We ﬁnd that no distribution is
able to detect a single scanner. Even with a host scanning
200 hosts per second, which is approximately 6% of total
traﬃc, no distribution is able to detect it. To detect such
isolated scan activity, more ﬁne-grained per-host analysis
(e.g., ﬂag any host contacting more than X unique desti-
nations in Y seconds [1]) and incorporating other aspects of
scanning behavior (e.g., failed connections [6]) are necessary.
In a coordinated scan, multiple hosts (e.g., part of a bot-
net) scan a particular network (e.g., worm or botnet activ-
ity). Each participating host scans at a low rate to avoid
detection.7 We ﬁx the scan rate to 30 hosts per second, and
vary the number of hosts generating scanning activity. Fig-
ure 2(c) shows that we need to introduce an additional 10%
of the total ﬂows before the wavelet score reaches α = 2.
This implies that even in coordinated scans, entropy-based
anomaly detection may not be suﬃcient.
We also explored several synthetic port scans. The results
are similar to the network scans, except that the degree-
based metrics are ineﬀective. A single scanner with a mod-
erate scan rate (30 scans per second) is not detected by any
of the entropy metrics. With an increased scan rate (> 1000
scans per second), FSD is the only metric that detects the
port scan.
IMPLICATIONS
5.
Choice of features: Our analysis suggests that the selec-
tion of traﬃc distributions in entropy-based anomaly detec-
tion should be made judiciously, and in particular we should
look beyond simple port and address based distributions.
The results also suggest a natural approach for choosing
traﬃc features: select traﬃc distributions that complement
one another and provide diﬀerent views into the underlying
traﬃc structure. For example, the behavioral distributions
and the FSD, which are qualitatively diﬀerent from the port
and address distributions, provide distinct and often bet-
ter anomaly detection capabilities. These complementary
distributions can also detect multiple anomalies that occur
simultaneously (Sections 3 & 4) .
Computing distributions: Section 3.3 shows that a uni-
directional traﬃc accounting can introduce biases in com-
puting traﬃc distributions. Obtaining bi-directional mea-
surements may involve additional overhead and instrumen-
tation of current traﬃc monitoring infrastructure, but recent
thrusts for bi-directional ﬂow export [17] may help. This
7Worm outbreaks produce similar behavior. With a ran-
dom scanning worm, the number of
incoming scans is
InfectedHosts ∗ ScanRate ∗ InternalAddressSpace
TotalIPAddressSpace .
may be diﬃcult in large networks when traﬃc monitors are
distributed across the network or when the traﬃc rates are
high enough that sampling is necessary. For enterprise net-
works, however, the monitor is often a single vantage point
co-located with the border router; in this case, bi-directional
semantics are easier to obtain and should be preferred.
Leveraging correlations for anomaly detection: The
stability of correlations in the entropy values during normal
time periods suggests a new anomaly detection technique.
We compute the correlations over a ﬁnite time window T
and detect anomalies over the timeseries of correlation val-
ues (computed over a sliding window of size T ).
In the
CMU-2005 dataset, almost all non-trivial anomalies signiﬁ-
cantly decrease the entropy correlations between source ad-
dress (port) and destination address (port) pairs. Addition-
ally, new events are introduced which do not manifest in
the wavelet deviation scores. Exploring this observation to
strengthen anomaly detection is an interesting avenue for
future work.
6. RELATED WORK
The use of entropy and distributions of traﬃc features
has recently received a lot of attention. Feinstein et al. [5]
consider the use of entropy of the distribution of source
addresses seen at a network ingress point for DDoS detec-
tion. Lakhina et al. [10] augment the PCA framework with
entropy based metrics and show that this detects anoma-
lies that cannot be identiﬁed using volume based analysis
alone. These approaches show the promise of entropy-based
anomaly detection. Our work studies the selection of traﬃc
feature distributions for entropy based anomaly detection.
Lee and Xiang [12] propose information-theoretic mea-
sures for intrusion detection. Entropy has also been to au-
tomatically cluster traﬃc patterns [20]. Wagner et al. [18]
use entropy for worm detection by evaluating the compress-
ibility of ﬂow data during attacks.
There is a large body of work related to the accuracy of
estimating distributional properties. These include the work
on streaming algorithms for estimating the ﬂow size distri-
bution [9] and distribution entropy [11]. Brauckhoﬀ et al. [4]
evaluate how packet sampling aﬀects the ﬁdelity of entropy
based anomaly detection and show that sampling does not
aﬀect the accuracy of detecting the Blaster worm [13].
7. CONCLUSIONS
Entropy-based methods have recently been suggested as
good candidates for ﬁne-grained anomaly detection and traf-
ﬁc classiﬁcation. The goal of our measurement study is to
understand the analysis and detection capabilities provided
by diﬀerent entropy based metrics.
We ﬁnd that the port and address distributions are strongly
correlated both in their entropy timeseries and detection ca-
pabilities. The behavioral metrics (in- and out-degree) and
the ﬂow size distribution provide detection abilities that are
distinct from other distributions. Using synthetic anoma-
lies, we further conﬁrmed that the port and address distri-
butions have limited utility in anomaly detection: they are
ineﬀective for scanning attacks, and the ﬂood anomalies they
detect are large enough to be volume anomalies.
Our results have two main implications. First, we should
look beyond port and address distributions for ﬁne-grained
anomaly detection.
In particular, we should consider dis-
tributions that complement each other in their detection
capabilities. Second, to avoid the biases arising from uni-
directional auditing, it is prudent to use bi-directional ﬂow
abstractions for computing traﬃc distributions.
Acknowledgments
We thank Nick Feamster for providing us access to the addi-
tional datasets used in our evaluation, as well as Mukarram
Bin Tariq for helping us parse the data. We also thank John
Payne for helping us understand the correlations between
the entropy timeseries. This work was supported in part by
grant CNS-0619525 from the National Science Foundation.
8. REFERENCES
[1] Snort. http://www.snort.org.
[2] Argus. http://qosient.com/argus/.
[3] Barford, P., Kline, J., Plonka, D., and Ron, A. A signal
analysis of network traﬃc anomalies. In Proc. of IMW (2002).
[4] Brauckhoff, D., Tellenbach, B., Wagner, A., Lakhina, A.,
and May, M. Impact of traﬃc sampling on anomaly detection
metrics. In Proc. of ACM/USENIX IMC (2006).
[5] Feinstein, L., Schnackenberg, D., Balupari, R., and Kindred,
D. Statistical Approaches to DDoS Attack Detection and
Response. In Proc. of DARPA Information Survivability
Conference and Exposition (2003).
[6] Jung, J., Paxson, V., Berger, A. W., and Balakrishnan, H.
Fast Portscan Detection Using Sequential Hypothesis Testing.
In Proc. of the IEEE Symposium on Security and Privacy
(2004).
[7] Karamcheti, V., Geiger, D., Kedem, Z., and Muthukrishnan,
S. Detecting malicious network traﬃc using inverse
distributions of packet contents. In Proc. of ACM SIGCOMM
MineNet (2005).
[8] Kazaa. www.kazaa.com.
[9] Kumar, A., Sung, M., Xu, J., and Wang, J. Data streaming
algorithms for eﬃcient and accurate estimation of ﬂow
distribution. In Proc. of ACM SIGMETRICS (2004).
[10] Lakhina, A., Crovella, M., and Diot, C. Mining anomalies
using traﬃc feature distributions. In Proc. of ACM
SIGCOMM (2005).
[11] Lall, A., Sekar, V., Xu, J., Ogihara, M., and Zhang, H. Data
streaming algorithms for estimating entropy of network traﬃc.
In Proc. of ACM SIGMETRICS (2006).
[12] Lee, W., and Xiang, D. Information-theoretic measures for
anomaly detection. In Proc. of IEEE Symposium on Security
and Privacy (2001).
[13] Morrison, J. Blaster revisited. ACM Queue vol. 2 no. 4, June
2004.
[14] Cisco Netﬂow. http://www.cisco.com/warp/public/732/Tech/
nmp/netflow/index.shtml.
[15] Nychis, G., Sekar, V., Andersen, D. G., Kim, H., and Zhang, H.
An Empirical Evaluation of Entropy-Based Traﬃc Anomaly
Detection. Tech. Rep. CMU-CS-08-145, Computer Science
Department, Carnegie Mellon University, 2008.
[16] Phaal, P., Panchen, S., and Mckee, N. InMon Corporation’s
sFlow: A Method for Monitoring Traﬃc in Switched and
Routed Networks. RFC 3176, 2001.
[17] Trammell, B., and Boschi, E. Bidirectional Flow Export Using
IP Flow Information Export (IPFIX). RFC 5103, 2008.
[18] Wagner, A., and Plattner, B. Entropy Based Worm and
Anomaly Detection in Fast IP Networks. In Proc. IEEE WET
ICE (2005).
[19] Xu, J., Fan, J., Ammar, M. H., and Moon, S. B.
Preﬁx-preserving IP Address Anonymization:
Measurement-based Security Evaluation and New
Cryptography-based Scheme. In Proc. of IEEE ICNP (2002).
[20] Xu, K., Zhang, Z., and Bhattacharyya, S. Proﬁling internet
backbone traﬃc: Behavior models and applications. In Proc. of
ACM SIGCOMM (2005).