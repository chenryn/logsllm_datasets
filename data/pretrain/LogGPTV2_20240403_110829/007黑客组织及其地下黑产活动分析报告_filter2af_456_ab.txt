攻击者主要依托即时通讯工具进行恶意代码传播,从目前捕获到的情况主要分为直接发送PE可执行程序,另一种是QQ群共享。该方法针对性强,但也容易被受害者感知到。
图 13通过QQ传播的文件形态示例
图 14通过YY传播的文件形态示例
由于Windows系统默认是不开启显示后缀和隐藏文件的。所以受害者们接收到这些文件压缩包解压后,发现木马文件里面只含有“BMP格式”的图片(实则是指向病毒程序的快捷方式),而真正含有恶意代码的文件则被隐藏起来
(二)网站
1)假冒游戏平台网站
攻击者会搭建虚假的游戏平台,并通过搜索引擎、弹窗等手段推广。假冒的游戏平台网站与官方网站外观一致,受害者很难分辨真伪。攻击者会将虚假的恶意安装包放置到假冒的网站上,当用户访问网站下载并执行相应虚假安装包则会被攻击者控制。
下图是我们在某知名搜索引擎上搜索凤凰山庄的搜索结果。可以看到,第一页的两条推广结果为假冒的网站。
图 15“凤凰山庄”搜索结果
图 16假冒凤凰山庄网站(左),凤凰山庄官网(右)
上图假冒凤凰山庄和官网的对比截图,我们可以看出除了网址不同,其他页面外观均一致。很难分辨真伪。
攻击者不是单一选择一款游戏平台进行假冒伪装。我们可以从下表看出,攻击者假冒了很多游戏平台。具体参看下表:
假冒游戏平台名称 | 虚假恶意网站 | 备注说明  
---|---|---  
199游戏 |  |  
235游戏中心 | game235.top |  
883XX游戏中心 | game88369.com.cn |  
| www.game88369.gyemw.com |  
| www.game88369.zxshy.com |  
| www.game88369.nmqzx.com |  
| www.game88369.yjfjn.cn | 该系列其他名称还有  
| www.ycttcy.net | 88370-88381,总共12个  
K7豫游游戏中心 | qipai007.aliapp.com |  
凤凰游戏山庄 | fhgame.sdforging.com.cn |  
| tlwt1258.cn |  
| vikodrive.cn |  
| fhgame.sdforging.com.cn |  
汉游天下安装包 | shlvxun.gamr89.com |  
集结号游戏中心 | www.jjhggame.com |  
建德游戏 | www.byjd571.net |  
宁波游戏大厅 | www.nbgame.org |  
四川游戏家园 | 28qp.com.tw |  
天妃游戏 |  |  
网狐游戏家园 | foxuc.com.cn |  
| foxuc.com.tw |  
襄阳同城游戏 | 0710yx.aliapp.com |  
| www.hnzcs.com |  
| 0710yx.xmwwy.com |  
| cng.minsun.cc |  
| 07l0yx.co |  
| 07l0.gamr89.com |  
| 0710yx.yksyx.org |  
| 0710yx.asia |  
云海游戏 | yunhai78.07l0yx.co |  
众安棋牌89游戏中心 | fjtu123.gamr89.com |  
| www.ftqp888.com |  
2)官方网站安装包被替换表 3假冒游戏平台网站列表
我们捕获到从某些游戏平台官方网站下载的安装包被替换为包含恶意代码的虚假游戏平台安装包。
进一步我们分析官方可信网站存在恶意虚假安装包这种情况,可能由以下两种情况导致:
第一、相关官方可信网站被攻陷,正常安装包被攻击者替换;
第二、官方可信网站的相关工作人员可能刻意替换放置恶意虚假安装包。
从我们的分析来看,更倾向于第一种情况。下面是凤凰游戏山庄网站存在恶意虚假安装包的情况:
凤凰游戏山庄官方网站  
---  
时间
|
2015-09-15 19:03:20  
父页面
|
http://game.fhgame.com/download.html  
下载URL
|
http://down.fhgame.com/fhgame/FHGameLobby/FHGameLobby.exe  
恶意文件MD5
|
ef749aecd9a292cd0c6873840d6f9115  
表4被替换恶意虚假安装包具体信息
三、持续对抗
该组织持续与安全厂商进行对抗,至少针对包括360在内的3款国内安全软件,以及卡巴斯基、比特梵德等国外相关安全产品采取过针对性技术措施,对抗行为最早可以追溯到2008年。对抗手段从实体文件到通信协议进行相关对抗,主要针对本地静态扫描、云查杀、主动防御策略和网络层等环节的检测。另外值得注意的是该组织成员会主动联系安全厂商,目的是申请将恶意程序添加白名单或者探测安全厂商检测机制。单就Hook007这个家族,我们对相关产品进行了多次升级或检测策略调整。以下将从静态查杀、动态检测、网络监控和探测厂商检测,这四个方面逐一展开相关对抗手法的介绍
(一)静态查杀
图 17静态查杀对抗相关发展变化趋势
从上图可以清晰看出Hook007在静态查杀相关对抗发展历程,如字符串从明文更新到加密字符串,最后为无字符串特征。
早期的Hook007家族是通过暴风白利用,然后再扩展到其他厂商(如迅雷等)白文件利用。所谓“白利用”通常指的是病毒利用正规厂商的正常程序作为掩护,通过这些程序在判断逻辑上的一些缺陷利用其加载木马作者的提供的恶意代,用以逃避安全软件的查杀。最近一段时间,该族系木马则改为利用微软的rundll32.exe文件运行含有恶意代码的dll文件。
(二)动态检测
1)使用特殊浮点指令bypass虚拟机查杀
2)LDTDetect:检测LDT基址位于0x0000时为真实主机,否则为虚拟机
3)GDTDetect:检测GDT基址位于0xFFXXXXXX时说明处于虚拟机中,否则为真实主机
4)VMwareDetect:检测VMware特权指令来检测虚拟机
5)起初是自启动,之后进一步更新为一次性
6)逐渐阉割Gh0st后门敏感功能
(三)网络监控
1)使用3322上线->其他动态域名->顶级域名->直接ip->微博,网盘中转
2)Gh0st上线协议->修改协议头->逐渐修改成无特征协议
图 18恶意代码与服务器通信变化趋势
(四)探测安全厂商检测机制
为了木马能更有效的避免安全厂商检测,该组织成员有主动提交相关样本,来探测安全厂商检测机制的活动。
攻击者探测的方式主要通过给安全厂商样本上报邮箱发送邮件和通过安全厂商官方论坛反馈问题和样本。下图是攻击者给比特梵德、卡巴斯基和360安全厂商发送的探测邮件截图。
图 19攻击者探测(通过邮件1)
图 20攻击者探测(通过邮件2)
被探测的厂商
|
相关被探测的邮箱地址  
---|---  
比特梵德
|
sample   
卡巴斯基
|
newvirus   
360
|
opensoft   
表5被探测相关安全厂商列表
下面两张图片是该组织在2013年12月和2015年9月分别提交的两个贴,均提交到360论坛问题反馈子板块。
图 21攻击者探测(通过论坛反馈1)
参考链接:[http://bbs.360safe.com/thread-3248178-1-1.html](http://bbs.360safe.com/thread-3248178-1-1.html)
图 22攻击者探测(通过论坛反馈2)
参考链接:
四、制作和更新
007组织在开发的恶意代码工具种类比较多,其中以给力远程控制工具和给力免杀器为主。而相关更新维护则主要是针对Hook007家族进行相关更新。
(一)007相关恶意软件
图 23 Hook007相关恶意软件种类
从上图我们可以看出007组织会涉及到制作或传播给力免杀、给力远控、盗号木马、DDOS、漏洞扫描、下载者和其他远控,其中给力免杀和给力远控是007组织主要开发和维护的工具。
以下主要是该组织核心成员开发的相关工具的截图。作者在工具上都会留下自己的昵称(早期为小寡妇007,后期主要是Hook007)和QQ号(24585329)。
图 24 remote007工具截图
图 25大牛B下载者生成器截图
图 26阿凡提远程控制软件截图
图 27毁灭者DDOS界面
图 28相关捆绑工具截图
(二)Hook007远程控制(给力远控)
我们一直持续跟踪监控的Hook007家族,其生成器作者命名为“给力”远控。
图 29给力远程协助工具
图 30给力远程协助工具登录验证工具
图 31给力免杀器
(三)Hook007远程控制迭代更新
该组织制作的恶意代码主要以伪装图片或文档,虚假安装包这两种形态,这两种最终后门程序均为Hook007家族,是基于Gh0st进行修改的版本。
图 32恶意代码更新记录
Hook007家族主要更新变化趋势
2012