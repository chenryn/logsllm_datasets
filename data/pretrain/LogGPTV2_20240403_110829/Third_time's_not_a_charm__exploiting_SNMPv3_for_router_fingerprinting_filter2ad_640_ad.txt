interface IP addresses have PTR records and we necessarily exclude
these. We then coalesce those names into routers that have both
IPv4 and IPv6 interfaces with PTR records where the hostnames
match (the interface names need not match). In total, using these
regexes, we obtain 12.4k dual-stack non-singleton alias sets contain-
ing 63.8k IP addresses, i.e., 5.2 addresses per alias set. This dataset
is overall significantly smaller compared to our 838k non-singleton
alias sets. Even when looking at dual-stack non-singleton alias sets
we identify more than 2.5x (31.2k). We compare the content of the
alias sets identified by both approaches and find only 9 exactly
matching alias sets. When looking for partial matches we identify
5.9k partially overlapping alias sets, i.e., at least one IP address
from CAIDA’s Router Names dataset is in one of the SNMPv3 alias
sets. This finding shows that the SNMPv3 approach partially covers
about half of all Router Names alias sets. In summary, we conclude
that both alias sets are complementary, as they contain only par-
tially overlapping addresses. This is likely due to the different used
techniques, e.g., some routers may not have useful rDNS entries,
while others might not respond to SNMPv3. Overall, however, the
SNMPv3 technique is able to identify significantly more alias sets.
5.3 Comparison with ITDK
Next we compare our alias set results with CAIDA’s ITDK, namely
the March 2021 MIDAR dataset [34] for IPv4 and the Speedtrap
dataset [38] for IPv6. Those datasets leverage the presence of a
monotonically increasing IP ID value to identify aliases. MIDAR
identifies 8.4M IPv4 alias sets of which the overwhelming majority
are singletons. There are 94k non-singleton sets containing about
363k IP addresses, i.e., 3.9 IPs per alias set. Speedtrap groups IPv6
addresses into 525k alias sets—again, the majority are singletons,
with only 5.3k alias sets with more than one address containing
13.6k addresses. Our identified sets find 222k and 4.3k perfectly
overlapping alias sets in MIDAR and Speedtrap, respectively. More
than 95% of those overlaps are singleton sets. Finally, we identify
partial overlaps for 1.1M MIDAR and 533k Speedtrap alias sets,
with the vast majority being singletons. To summarize, MIDAR
and Speedtrap also provide complementary views of aliased routes,
likely due to different support of the used techniques. Overall, we
find almost a magnitude more non-singleton alias sets compared
to both sets.
5.4 SNMPv3 Coverage
To assess how many IPv4 addresses per AS we can de-alias, we
define coverage as the ratio of responsive SNMPv3 router IPv4
addresses compared to the total number of IPv4 addresses per AS
within the IPv4 union router dataset containing 3.1M addresses
(cf. Table 2). Overall, we find that 16% of the IPv4 router addresses
respond to SNMPv3 probes. In Figure 10 we plot the empirical
CDF of SNMPv3 coverage for ASes with thresholds of at least 2,
5, 10, 50, and 100 IPs in our dataset. The number of ASes for each
threshold are 11.8k, 9.1k, 7.9k, 2.9k, and 1.8k, respectively. The main
observation in Figure 10 is that SNMPv3 coverage is slightly better
for ASes with fewer IPs than those with higher ones. The coverage
also deviates substantially across different networks. Regardless
of the threshold, the coverage is less than 10% for about a quarter
of the networks, and is more than 80% for top 10% of the covered
networks. Recall, MIDAR contains around 94k non-singleton sets
that consist of 362k router IPv4 addresses. 28.4% of those addresses
also respond to SNMPv3. Further, more than 461k router addresses
respond to SNMPv3 with only 22% overlapping with MIDAR’s non-
singleton sets. Overall, when combining both techniques one can
potentially increase the coverage of de-aliased router IPv4 addresses
from 11.7% (MIDAR only) or 14.8% (SNMPv3 only) up to 23%.
157
100101102103104Number of IPs per Alias Set0.00.20.40.60.81.0ECDF: Fraction of Alias SetsIPv6 Alias SetsRouters OnlyIPv4 Alias Sets0.00.20.40.60.81.0SNMPv3 Coverage per AS: IP-Level0.00.20.40.60.81.0ECDF: Fraction of ASesASes with 2+ IPsASes with 5+ IPsASes with 10+ IPsASes with 50+ IPsASes with 100+ IPsThird Time’s Not a Charm: Exploiting SNMPv3 for Router Fingerprinting
IMC ’21, November 2–4, 2021, Virtual Event, USA
Figure 11: Vendor popularity.
Figure 12: Router vendor popularity.
6 ROUTER FINGERPRINTING
Our technique offers the unique opportunity to identify the vendor
of millions of devices, including routers. These fresh insights allow
us to estimate the market share of infrastructure vendors at an
unprecedented scale with our lightweight and accurate method.
6.1 Baseline Results
In Figure 11 we report the popularity of major network equipment
vendors as unveiled with our method. In total, we are able to de-alias
4,617,690 devices (aka alias sets). As illustrated in the figure, the ma-
jority of these devices use exclusively IPv4. The largest fraction of
the devices are UNIX-based (Net-SNMP). Major network equipment
vendors are also in the top 10 list, including Cisco (more than 900k
devices), Broadcom (580k devices), Huawei (220k devices), and H3C
(5k devices). In the top 10 vendors there are also home and office
network equipment vendors such as Thomson (580k devices) and
Netgear (420k devices). Thus, our technique provides a view into
many popular edge devices. Unfortunately, attackers will also have
this view when they send unauthorized and unsolicited requests
and can exploit known vulnerabilities. The count of devices be-
longing to a given vendor drops drastically past the top 10 vendors.
Indeed, the top 10 vendors are responsible for more than 80% of the
devices we identify with our technique.
Next, we study the vendor popularity for the routers we identi-
fied with our method. To compile the set of routers, we consider all
the alias sets as before, but we also require that the IPs in these alias
sets are present in the most recent ITDK and RIPE Atlas datasets,
from March 2021 and April 2021, respectively. In total, we identify
346,951 routers. The large majority are IPv4-only (307,404), while
there were 24,641 IPv6-only routers and 14,906 dual-stack routers.
These numbers show that the fraction of IPv6 only and dual-stack
routers is significantly higher for routers as compared to the overall
set of devices. This is also visible in Figure 12, where we show the
popularity of router vendors by protocol. In this figure it is also
clear that when we consider routers there is higher vendor con-
solidation compared to the overall devices. Indeed, the four major
vendors, namely Cisco, Huawei, Juniper, and H3C, are responsible
for more than 95% of routers we identified with our method. Cisco
158
is the most popular with around 240k routers followed by Huawei
with 52k routers.
6.2 Validation
6.2.1 Lab testing. To better understand the default behavior and
configuration of Cisco devices running SNMPv3, we setup Cisco
routers running IOS 15.2(4)S7 (released in 2015) and IOS XR 6.0.1 in
a controlled environment. We use Net-SNMP to issue queries from a
Linux machine directly connected to the router and passively mon-
itor the network traffic via a packet capture. By default, the Cisco
router does not run SNMP and answers neither v2 nor v3 queries.
We enable SNMP via a single line of configuration snmp-server
community pass123 RO which sets the SNMP read community
string to a private value. We then confirm that the router answers
SNMPv2 queries using this private community string by querying
for the sysDescr MIB value and receiving the response.
Next, we issue an SNMPv3 query, again for the sysDescr MIB
object, using the username noAuthUser and the security level
noAuthNoPriv, i.e., the same unauthenticated query we issue in
our Internet-wide measurements. While the query is rejected with
a “unknown user name” error as expected, for both versions of
Cisco IOS, the response packet includes a Cisco OUI MAC address
within the engine ID field. The router has multiple interfaces, each
with different MAC and assigned IP addresses. Regardless of the IP
address queried, the router returns the same MAC address in the
engine ID response. This MAC address corresponds to the “first”
interface as reported by the routers via the command-line manage-
ment interface. This MAC in the engine ID was not the numerically
smallest MAC address among all the interfaces, which contradicts
the guidance in the SNMPv3 behavior specification [29].
Of note is that the Cisco router responds to these SNMPv3 queries
without any specific v3 configuration. Simply configuring a read-
only community string, which is only pertinent to SNMPv2, seem-
ingly enables SNMPv3 on the router. Thus, operators may inad-
vertently be enabling SNMPv3 on their devices in the process of
setting up SNMPv2. We notified Cisco of our findings and they
directed us to several existing bugs and bugfixes which we discuss
in Section 8.
Net-SNMPCiscoBroadcomThomsonNetgearHuaweiG.IAmbitH3CRuijie0240k480k720k960kNumber of Alias SetsIPv4 OnlyIPv6 OnlyDual-StackCiscoHuaweiNet-SNMPJuniperH3COneAccessRuijieBrocadeAdtranAmbit050k100k150k200k250kNumber of Router Alias SetsIPv4 OnlyIPv6 OnlyDual-StackIMC ’21, November 2–4, 2021, Virtual Event, USA
Taha Albakour et al.
Figure 13: Distribution of time since the last reboot.
Figure 14: Number of router vendors per AS.
We replicate the same experiment with Juniper Junos (version
17.3, 2017 release). We notice that the behavior is similar to Cisco,
i.e., operation of SNMPv2 enables SNMPv3. However, Juniper re-
quires to explicitly enable services on a given interface, which may
result in less visible Juniper routers with our SNMPv3 scan.
6.2.2 Operators Survey. To validate our results, we contacted net-
work operators. In our request for comment, we shared with them
the alias sets, i.e., the set of IPs for each router and the router vendor
as we identified it with our technique. Six of them replied to our re-
quest. The network operators confirmed that we correctly de-alias
the router and identified the router vendor in all responses. We also
notice that identified “net-snmp” and “unknown vendor” devices,
typically correspond to network appliances and programmable net-
work devices, respectively. However, some of the operators pointed
out potential limitations of our method. Indeed, we were unable to
uncover some router interfaces with our SNMPv3 scans, as those
ACL interfaces drop packets sent to well-known ports.
6.2.3 Comparison with Nmap. Nmap [46] is a popular tool for
operating system and device fingerprinting. It runs up to 16 TCP,
UDP, and ICMP tests in order to generate a signature for a target,
and then attempts to match it against its database. Nmap requires
at least one open and one closed TCP port to achieve accurate
results. If Nmap is unable to run all the required tests, or find an
exact match to the resulting signature, it attempts to provide a best-
guess of the target OS. Unsurprisingly, Nmap’s approach generates
a significant amount of traffic and is not suitable for a large-scale
measurement. As such, we decide to test it only on a small subset
of all SNMPv3 responsive routers. We randomly pick a single IPv4
address from each router. We target 26.4k router IPs in total and
compare the resulting fingerprints from Nmap (version 7.60) with
the one obtained via SNMPv3.
For 22.2k routers, Nmap was unable to report any results. This
is likely due to the fact that none of those routers are running any
common TCP service (ftp, ssh, telnet, etc.) which is required for
Nmap to work properly. Note that by default, Nmap will attempt to
find an open TCP port by scanning only the top 10 services in its
database. We acknowledge that Nmap may fingerprint those routers
when using more aggressive options (such as full TCP port scan) but
we opted not to do so due to the excessive load it would generate.
Further, the Nmap fingerprint did not agree with our SNMPv3 fin-
gerprint for 1.3k routers. In all of those instances, Nmap attempted
to guess the operating system rather than providing an exact match
from its database indicating that it was unable to complete some of
its tests. Finally, 2.9k Nmap results match the fingerprint obtained
with SNMPv3; Nmap was able to provide additional information
such as OS version for the majority of those routers. Recall that
our method is not using any statistical inference as our vendor
identification is based on either the MAC address or Enterprise
ID—that are typically unique per vendor [1]—both of which can be
obtained from the SNMPv3 engine ID data. We acknowledge that
Nmap’s thorough tests and large database can fingerprint devices
beyond the vendor level. Nevertheless, contrary to Nmap the SN-
MPv3 technique allows for Internet-scale fingerprinting by sending
only a single probe packet per target address.
6.3 Time Since Last Reboot
Accurate router fingerprinting allows us to answer important ques-
tions about the status of routers in the wild. In Figure 13 we plot
the CDF for the time since the last reboot for around 346k routers
we identified with our method. Less than 25% of them had their
last reboot more than a year before our first scanning campaign
(ca. April 2021). More than 50% of the routers had a reboot since
the beginning of the year of our measurement (2021), and around
20% during the last month. These results show that, potentially, a
large fraction of routers did not recently install security updates, for
which a reboot is normally necessary. We are currently launching
more campaigns and we will continue monitoring the last reboot
time to provide more insights in the future.
6.4 Router Deployment Insights
6.4.1 Distribution of Routers per AS. We consider router deploy-
ments in 22,787 networks. In 4,059 networks we identified at least
5 routers, in 1,557 networks more than 20 routers, in 381 networks
more than 100 routers, and in 55 more than 1,000 routers using our
SNMPv3 scans. Our analysis shows that the distribution of routers
per AS is similar across different regions, see Appendix C.
159
201020122014201620182020Last Reboot Time per Router0.00.20.40.60.81.0ECDF: Fraction of Routers0102030405060# SNMPv3 Router Vendors per AS0.00.20.40.60.81.0ECDF: Fraction of ASesAll ASesASes with 5+ RoutersASes with 20+ RoutersASes with 100+ RoutersASes with 1000+ RoutersThird Time’s Not a Charm: Exploiting SNMPv3 for Router Fingerprinting
IMC ’21, November 2–4, 2021, Virtual Event, USA
Figure 15: Router vendor popularity per continent with the
total number of routers per region in parenthesis.
6.4.2 Number of Vendors per AS. In Figure 14 we report how many
different router vendors we can identify in a single AS. In 40% of
the networks with more than 5 routers all of the routers are from
the a single vendor. In less than 10% of the networks the number
of router vendors exceeds five. When we are focusing on larger
networks, with more than 100 or 1,000 routers, then we observe that
there are more routers vendors present. This is to be expected as
these networks run complex network operations and they can host
specialized routers and network equipment from different vendors.
In Section 6.4.4 we do a case study of the 10 largest networks
by number of routers and we show that although the number of
vendors may be high, the majority of the routers are from a couple
of vendors. This is also true in most of the networks with 5 routers
or more in our study.
6.4.3 Regional Vendor Popularity. We then focus on the market
share of different router vendors at different regions. In Figure 15