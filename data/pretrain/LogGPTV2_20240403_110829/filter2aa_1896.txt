Pwn the Pwn Plug:
Analyzing and Counter-Attacking
Attacker-Implanted Devices
Wesley McGrew
Assistant Research Professor
Mississippi State University
Center for Computer Security Research
McGrew Security
PI:EMAIL
Introduction
•Wesley McGrew
•Breaking things, RE, forensics, etc.
•Finally ﬁnished dissertation - Ph.D.
•Assistant Research Professor
•Mississippi State University
•NSA CAE Cyber Operations
•McGrewSecurity.com @McGrewSecurity
Attacker-Implantable 
Devices
Attacker-Implantable 
Devices
•Malicious attackers/Penetration testers
•How can you respond to one found in 
your organization?
•What’re the implications of 
vulnerabilities in attack software/
hardware?
Response
•Identiﬁcation: Network/Physical
•Found one!
Response
• Seizure, imaging, forensication
• What info/systems has it compromised?
• Attribution
• Challenge: Procedures for embedded devices
• Counter-attack
• Ofﬂine & modify vs. attack in place
• Monitor the attacker - Attribution/Motive
• Turn it into a honeypot
Pwning Pentesters
•Implantable device:
•Send it in to to do an internal test from 
comforts of “home”
•Nerdy James Bond physical pentest payload
•Re-used from test to test, client to client
•(Not leaving it there, that thing’s expensive!)
•Do you wipe it? (do you know how?)
Pwning Pentesters
•Put on your black hat.
•Hacking a pentester’s implantable 
device:
•In the ﬁeld
•On the bench
•All sorts of beneﬁts...
Implications of 
Pwning Pentesters
•Intercept: Let them do the work for you
•Modify/Filter: Keep some of the results for 
yourself
•Camouﬂage: Make your own attacks appear 
part of the test
•Competitive Intel: Steal all the 0day
•Gift that Keeps Giving: Do it again and again 
as tester reuses device between clients
Difficulties Securing 
Implanted Attack Devices
• By deﬁnition, out of your physical control
• Small/weird platforms
• Update procedure
• Underlying attack software - Software Engineering 
Practices
• Did it work? Push a release, move on
• Proof of Concept code
• Huge attack surface
Security geeks can be easy 
targets
A million bojillion Wireshark vulns
Semantics makes it hard
to use search engines
to ﬁnd exploits in exploits
and vulns in vuln tools
Case Study: Pwn Plug
Forensics & Counter-Attack
Pwn Plug Forensics
•Forensic acquisition of Pwn Plug
•(explicit detail in whitepaper)
•Create a bootable USB drive
•Convince U-Boot to boot it
•dd the root ﬁlesystem
Pwn Plug Forensics
•Analysis
•UBIFS ﬁlesystem-level analysis limited
•Compression
•Can probably forget deleted ﬁles, etc.
•mtd-utils for mounting the image
•Attached storage - Normal procedures
•More luck ﬁlesystem-level
Pwn Plug Vuln/Exploit
•plugui/Pwnix UI - Web interface for 
commercial version of the Pwn Plug
Boring, but with their 
powers combined...
XSS
CSRF
Command
Injection
(in a privileged interface)
Boring, but with their 
powers combined...
XSS
CSRF
Command
Injection
(in a privileged interface)
Injected with
a packet
Boring, but with their 
powers combined...
XSS
CSRF
Command
Injection
(in a privileged interface)
Injected with
a packet
Payload
Calls...
Boring, but with their 
powers combined...
XSS
CSRF
Command
Injection
(in a privileged interface)
Injected with
a packet
Payload
Calls...
Submits...
Boring, but with their 
powers combined...
XSS
CSRF
Command
Injection
(in a privileged interface)
Injected with
a packet
Payload
Calls...
Submits...
We get remote root!
(In some pretty realistic circumstances)
Payload to exploit packet
XSS in Passive Recon Page
passes regexp to get to page
XSS in Passive Recon Page
passes regexp to get to page
XSS Payload
CSRF in the SSH tunnel page
passes regexp to get to page
XSS Payload
CSRF’ing a form submission 
Command Injection in SSH tunnel script
passes regexp to get to page
XSS Payload
CSRF’ing a form submission 
Command injection
What do we run?
•My PoC “malware”, pwnmon
Cleans up after exploit
Installs self
Sets up persistence
Disables bash history clearing
Phones home for more code
Every so often gathers:
 - Process list
 - Command history
 - File listing
 - Network interfaces
 - Network connections
 - All log ﬁles & results
Wraps it up and sends it to 
your FTP server.
Demo
All the filez you need on the DVD
+ a floor-model Pwn Plug from the Vendor Area
(or an unsuspecting friend’s)
Conclusions
•Attacker-implanted devices can provide good 
counter-intel info for organizations
•For pentesters:
•Know your tools, test your tools, use them safely
•Monitor carefully and clean up
•For people who break things:
•Pentesting tools make great targets
Join me in the Q&A room for
questions and discussion