---
## Page 120
104第4章云计算的安全风险
4.4小结
本章概述了影响Android应用的一般安全问题。对于每类安全问题，本章都展示了一个公开
案例来帮助聚焦所带来的潜在影响。你也随着我们对两个公开Android应用进行了案例分析，每
个案例分析都非常详细地说明了如何使用通用工具来评估应用，挖掘安全漏洞，并利用这些漏洞。
第一个案例分析使用Androguard来对目标应用执行静态分析、反汇编和反编译。在完成这
些之后，你识别出了可以攻击的安全相关组件，具体面言，你找到了一个使用短信进行授权的设
备加锁/解锁功能。接下来，你使用了动态分析技术（如对应用进行调试）来扩大和确认静态分
析的发现。最后，你编写了一些概念验证攻击代码来伪造一条短信，并攻破应用的设备解锁功能。
第二个案例分析演示了使用Drozer在应用中找出与ContentProvider相关数据暴露问题的快
捷简单的方法。首先，你发现了应用暴露出一些用户Activity和敏感消息日志。然后，你看到了
对存储数据的纂改是多么简单。最后，案例分析讨论了利用SQL注入安全漏洞从应用数据库中
获取其他敏感数据的细节。
下一章将讨论Android的整体攻击面，以及如何开发Android攻击整体策略。
---
## Page 121
第5章
理解Android的攻击面
全面了解一个设备的攻击面是成功实施攻击或防御的关键，这句话不仅适用于其他计算机系
统，同样也适用于Android设备。作为一位以使用未公开安全漏洞实施攻击为目标的安全研究人
员，应该首先对设备进行安全评估，面评估过程的第一步就是枚举攻击面。类似地，对一个计算
机系统进行防御也需要理解系统可能被攻击的所有可能途径
可能你对攻击概念一无所知，但在读完本章后，你将可以看出许多Android的攻击面到底在
哪里。本章首先将清晰定义攻击向量与攻击面这两个基本概念，接下来，将讨论攻击面的相关属
性与形态，这些属性将用于根据影响对攻击面进行分类。本章余下内容将把不同攻击面分成几类，
然后讨论每一类的重要细节。你可以了解到Android设备可以被攻击的多种途径，某些途径会以
已发生的攻击作为证明。你也会学到如何使用各种不同的工具和技术，从而自己更进一步地探索
Android的攻击面。
5.1攻击基础术语
在深入分析Android攻击面之前，首先必须定义和澄清我们在本章中使用的术语。在一个计
算机网络上，用户们有可能通过发起一些动作，来破坏其他计算机系统的安全性。这种类型的动
作被称为“攻击”，而发起这些攻击的人自然就被称为“攻击者”。通常攻击者的目的是影响目标
系统的机密性、完整性或可用性，也就是所谓的CIA安全属性。成功的攻击通常依赖于目标系
统中存在着的特定安全漏洞。当讨论攻击时，最经常涉及的两个概念是攻击向量（attackvector）
和攻击面（attacksurface）。攻击向量和攻击面是紧密关联的，因而也经常被混淆，但是对于任何
一次成功攻击面言，这两者都是独立不同的元素。
注意通用安全漏润评分系统（CVSS）是一个被广泛接受用于安全漏洞信息分类与评级的标准。
它通过组合多个重要的概念最终形成一个数字评分，用于划分调查或消除不同安全温洞
的优先级。
---
## Page 122
106第5章理解Android的攻击面
5.1.1攻击向量
攻击向量通常指的是攻击者实施行动的方式，描述了用来执行攻击的方法。简单地说，它描
述了攻击者是如何到达并接触任意给定的漏洞代码的。如果再深人一点，攻击向量可以基于多个
标准进行分类，包括所需认证条件、可访问性与难度。这些标准经常用来决定如何对公开披露安
全漏洞或者正在实施的攻击进行优先度评定。例如，向目标发送一封电子邮件是非常高层次上的
攻击向量，面这个攻击动作通常不需要认证，但成功攻击则需要接收者进行某些操作，如打开这
封部件。与监听网络服务进行连接则是另一种攻击向量，在这种情况中，可能需要认证也可能不
需要，这取决于安全漏洞存在于网络服务的具体位置。
注意MITRE公司的通用攻击模式枚举和分类（CAPEC）项目的目标是对攻击进行枚举和分类，
形成政击模式库。这个项目中包含并扩展了传统攻击向量的概念。
攻击向量经常基于常见攻击的属性进行进一步分类。例如，发送带有附件的电子邮件是一种
比发送电子邮件更具体的攻击向量。你还可以再进一步指定附件的确切类型。此外，发送电子邮
件类别中更具体的一种攻击向量是攻击者在电子邮件消息中包含一个可点击URL。如果这个链
接是可点击的，好奇心可能会让接收者点击这个链接，面这一动作可能会导致对目标计算机的成
功攻击。另外一个案例是图像处理库，这个共享库中有许多函数会最终导致执行到存在安全漏润
的函数上，则这些函数都可以被认为是存在安全漏洞函数的攻击向量。类似地，共享库所暴露
API的某个子集可以触发对存在安全漏润函数的执行，那么这些API函数中任意一个都可以被认
为是一个攻击向量。最后，利用这个存在漏洞的共享库的任意程序也被视为一个攻击向量。这些
分类可以帮助防御者思考如何才能阻断攻击，也会帮助攻击者对目标进行隔离以便找到哪些才是
需要评估的代码。
5.1.2攻击面
攻击面普遍被理解为目标的“软助”，也就是使得目标易受攻击的功能特性。这是一个从物
理世界类比面来的词汇，已经被信息安全专业人员广泛采纳。在物理世界中，攻击面指的是一个
对象暴露给攻击的区域，因此必须得到防御。例如，城堡的城墙有护城河进行保护，坦克的外表
则安装看装甲，那些最为重要的人体器官则由防弹衣保护。所有这些都是在物理世界中受到防御
的攻击面。使用“攻击面”这一术语，我们可以在信息安全领域应用物理世界中已获证明的逻辑
规则，从而减少抽象化的藏念。
从更加技术性的角度来说，攻击面指的是攻击者可以执行并进面攻击的代码。与攻击向量不同
的是，攻击面并不依赖于攻击者的动作，或者要求安全漏洞必须存在。简单来讲，它描述了代码中
可能存在着尚待挖掘的安全漏洞的位置。在之前基于电子邮件的攻击的例子中，安全漏洞可能存在
于在以下地方暴露的攻击面：邮件服务器的协议解析器、邮件用户端程序的处理代码，甚至是将邮
件消息泣染输出到接收者屏幕上的代码。在一次基于浏览器的攻击中，由浏览器所支持的所有Web
---
## Page 123
5.2对攻击面进行分类107
相关技术都构成了攻击面，包括超文本传输协议（HTTP）、超文本标记语言（HTML）、层叠样式
表（CSS）和可扩展矢量图形（SVG）等。记住，从定义上来说，攻击面并不要求有安全漏洞。如
果一段代码可以被攻击者执行操作，那么它就被视为一个攻击面，必须加以相应的研究。
与攻击向量类似，攻击面也可以从通用化和逐渐具体化这两个方面进行讨论。面选择哪一层
具体的描述通常取决于不同的场景。如果某人正在高层次上讨论Android设备的攻击面，他可能
会指出无线攻击面。与此相反，如果在讨论一个特定程序的攻击面，他则会指出一个具体的函数
或AP。更进一步来说，在本地攻击的场景中，他可能会指出设备上的一个具体系统路径。在研
究一个特定的攻击面时，经常会揭示出其他的攻击面，比如那些通过多路命令处理时暴露出的攻
击面。举个例子，某个协议实现中包含多种不同类型的数据包，有一个函数用于解析该协议实现
中特定类型的数据包。则发送某一种类型的数据包会达到一个攻击面，面发送另一种类型的数据
包则会达到另一个攻击面。
5.3.1节将会讲到，互联网通信被分解到多个逻辑层次上。当数据从一层传输到下一层，它
Web服务
口
IDO
PHP解释器PHP应用程序代码
图5-1一个PHPWeb应用涉及的攻击面
在图5-1中，待分析系统最外层的攻击面包括两个Web服务器端口，如果攻击向量是一个普
通请求（面不是一个加密请求）.那么Web服务器软件以及任何服务端Web应用程序构成的底层
攻击面，都是可以被达到的。如果选择以PHPWeb应用程序作为攻击目标，那么应用程序代码
和PHP解释器都会处理不受信任的数据。当不受信任的数据流过时，更多的攻击面将会被暴露。
最后一点，一个给定的攻击面可能可以通过多个攻击向量来达到。比如，一个图像处理库中
的安全漏洞，可能可以通过电子邮件、网页、即时通信应用或其他向量触发。这在安全漏洞被修
补时是特别关键的。如果修补仅仅针对某一个向量，那么这个安全漏润对于其他向量面言仍然是
可被利用的。
5.2对攻击面进行分类
通常情况下，目标系统攻击面的大小与它和其他系统、代码、设备、用户、甚至其自身硬件
的交互多少是成正比例相关的。许多Android设备以能与任意设备进行交互作为目标。例如，
---
## Page 124
108第5章理解Android的攻击面
Verizon使用“DroidDoes"作为广告语，来宣传他们的设备可以做到许许多多的事情。一个Android
设备的攻击面是如此的广阔，因此对其进行解剖与分类是非常必要的。
5.2.1攻击面属性
安全研究人员，无论是攻击者还是防御者，都会审查攻击面的不同属性来进行决策。表5-1
描述了几个关键属性，以及它们如此重要的原因。
表5-1攻击面的关键属性
属性
推理
攻击向量
所需的用户交互和认证条件，限制了给定攻击面中发现任意安全漏润的影响后果，需要目标用户最某
些特殊操作才能实施的攻击就会变得相对不严重，可能需要结合社会工程学才能成功。相似的，某些
攻击面，在对设备已拥有访问权限或者满足某些物理接触条件时，才是可达到的
获取的权限
可能是在沙盒中以受限权限运行的
在某个给定攻击面背后的代码可能是以极高的权限运行，比如是内核空间中的代码，面另外一些代码
内存安全性
以非内存安全的语言（如C和C++）编写的程序，比起C内存安全的言（如Java）编写的程序，可
能存在更多类型的安全漏洞
复杂性
复杂的代码，算法和协议更难于管理，因此也增加了程序员犯错的可能性
理解和分析这些属性有助于指导安全研究的优先级，并提升研究的整体效能。专注于那些特
别高风险的攻击面（要求低、高权限、非内存安全以及高复杂度等），一个系统可以更快地被攻
击或者加固。一般面言，攻击者会尝试以尽可能少的代价获取尽可能多的权限。因此，特别高风
险的攻击面在逻辑上是最害要关注的。
5.2.2分类决策
因为Android设备拥有如此广阔和复杂的攻击面，所以非常有必要基于一些通用属性将它们
进行分组。基于达到给定攻击面所需的访问级别，本章剩余内容划分为几节。像攻击者那样，我
们也会先从最危险同样也是最吸引人的攻击面开始分析。按照需要，许多节还会进一步划分成更
细粒度的小节，来讨论一些更深入的攻击面。对于每个攻击面，我们会提供一些背景信息，如意
图提供的功能。在有些情况下，我们将提供一些工具和技术，用于发现攻击面暴露出的底层代码
的一些特定属性。最后，我们将讨论利用攻击面中安全漏洞的一些已知攻击与攻击向量。
5.3远程攻击面
Android设备，或者其他任意的计算系统，所暴露的最大也是最具吸引力的攻击面就是远程
的事实。攻击者可以通过一个计算机网络（通常是因特网）来发起攻击。以这种类型攻击面为目
标的攻击是特别具有危害性的，因为它们可以让一位未知攻击者攻陷设备。
更近距离观察，远程攻击面可以基于一些属性，将其进一步切分成一些更独特的分组。某些
---
## Page 125
5.3远程攻击面109
远程攻击面是始终可达的，而其他一些仅仅在目标发起网络通信时才是可达的。无需任何用户交
互的安全漏润是特别危险的，因为它们可以用于传播网络虫。需要少量交互（如点击一个链接）
的安全漏洞也可以用来传播蜗虫，但是这类虫传播速度会慢一些。其他一些攻击面在仅当攻击
者处于一个特权位置时才可达，比如与目标处于同一个局域网中。另外，某些攻击面仅针对已经
被移动运营商或谷歌等中间人处理过的数据。
下一小节将概要介绍一些重要网络概念，并说明移动设备的一些关键差异。紧随其后的几个
小节会对Android设备暴露的各种不同类型的远程攻击面进行详细讨论。
5.3.1网络概念
掌握基本的网络概念对于真正理解各种通过计算机网络实施的攻击是非常必要的。诸如开放
系统互联（OSI）模型、客户端一服务器模型等概念描述了用来对网络进行概念化的抽象构件。
典型的网络配置限制了可以实施的攻击类型，从面也限制了暴露的攻击面。无论是攻击者还是防
御者，知道这些限制以及绕过它们的方法都可以增大成功的机会。
1.因特网
由美国国防先进研究项目局（DARPA）创立的因特网，是一个计算机系统的互联网络。家
庭计算机和移动设备是这个网络上最外层的节点，在这些节点之间是大量的称为路由器的后端系
统。当一部智能手机连网时，一系列使用不同协议的数据包会通过网络传输，对请求的服务器进
行定位、联系和交换数据。在两个端点之间的计算机，每一台被称为一跳（hop），构成了一条网
络路径。手机通信网络与之十分类似，只不过手机与最近基站是通过无线进行传输的。当用户在
移动时，他的设备所连接的基站也会相应改变。基站构成了移动设备连接因特网路径中的第一跳。
2.OSI模型
OSI模型描述了网络通信中涉及的7层协议。图5-2显示了这些协议层，以及这些协议层是
如何堆栈的。
口第1层—物理层描述了两台计算机之间是如何传输数据的。在这一层上，数据都是以
二进制方式传输的。以太网和Wi-Fi的物理部分在这一层上操作；
口第2层数据链路层对物理层传输数据增加了纠错能力。以太网和Wi-Fi的剩余部分以
及逻辑链路控制（LLC）和地址解析协议（ARP）属于这一层；
口第3层—网络层是因特网协议（IP）、因特网控制消息协议（ICMP）和因特网网关消息
协议（IGMP）运行的层次。网络层的目标是提供路由机制，使数据包能够被发送到它们
的目标节点上；
口第4层一传输层的目标是为底层的数据传输增加可靠性。传输控制协议（TCP）和用户
数据报协议（UDP）在这一层上运行：
口第5层—正如其名，会话层管理网络主机之间的会话。传输层安全协议（TLS）和安全
套接字层（SSL）在这一层上工作；
口第6层表示层处理主机之间如何表达数据的语法协定。这一层上的协议很少，面多
---
## Page 126