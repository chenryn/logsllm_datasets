---
## Page 44
获取：
可以按照下面的方法从源码安装：
nsenter工具
例如进人到刚创建的容器中，并启动一个bash：
exec命令
30
nsenter工具在util-inux包2.23版本后包含。如果系统中util-linux包没有该命令，
Docke自1.3版本起，提供了一个更加方便的工具éxec，
root
root
root
hello world;sleep 1;
#通过ps-ef命令可以看到容器中运行的进程
USER
root@ce554267d7a4:/#
243c32535da7
CONTAINER ID
$sudo docker ps
243c32535da7d142fb0e6df616a3c3ada0b8ab417937c853a9e1c251f499f550
$sudo docker run -idt ubuntu
下面给出一个完整的例子：
Jp17seconds
通过这个PID，就可以连接到这个容器：
PID=s(dockerinspect--format"({.State.Pid }}")
为了使用nsenter连接到容器，还需要找到容器的进程的PID，
root@243c32535da7:/#
$sudo docker exec-ti 243c32535da7
coot
11:07:36up
coot@243c32535da7:/#
0981
sudo nsenter
PID=s(docker-pid243c32535da7)
make nsenter && sudo cp nsenter /usr/local/bin
cd/tmp;curlhttps://www.kernel.org/pub/1inux/utils/util-linux/v2.24/util-
./configure
第一部分Docker入门
716
699
PID
717
3:14,
--without-ncurses
PPID
699
-target 10981
ubuntu:latest
IMAGE
FROM
0
011:07
W
011:07
011:07
done
CSTIME TTY
users,
COMMAND
心
心
load average: 0.00, 0.02, 0.05
--mount
LOGIN@
nostalgic_hypatia
"/bin/bash"
CREATED
--uts--ipc--net--pid
/bin/bash
00:00:00ps-ef
00:00:00sleep1
00:00:00/bin/bash
00:00:00
TIMECMD
IDLE
STATUS
/bin/sh -c while true; do echo
JCPU
可以直接在容器内运行命令。
18 seconds ago
PCPU WHAT
PORTS
可以通过下面的命令
容人我
NAMES
---
## Page 45
导出容器
4.5
器，终止其中的应用：
[OPTIONS]CONTAINER[CONTAINER...】。支持的选项包括：
4.4
，可以使用dockerexport命令，
$sudo docker ps-a
查看所有的容器如下所示：
导出容器是指导出一
可以使用dockerrm命令删除处于终止状态的容器，命令格式为dockerrm
2ae
$sudo docker rm-f 2ae
2014/11/03 04:05:24 Error: failed toremove one or more containers
Error
$sudo docker rm 2ae
2aed76caf8292c7da6d24c3c7f3a81a135af942ed1707a79f85955217d4dd594
$sudo docker run -d ubuntu /bin/sh -c"while true;do echo hello world; sleep
如果要删除一个运行中的容器，
1;done"
$ce554267d7a4
$sudo docker rm ce554267d7a4
Exited (0) 3 minutes ago
e812617b41f6
Aboutanhourago
d58050081fe3
Exited （-1) 13 seconds ago
ce554267d7a4
CONTAINER ID
$sudo docker ps -a
例如，查看处于终止状态的容器并删除如下所示：
'-□
□-1,
导入和导出容器
删除容器
response from daemon:You cannot remove a running container. Stop the
--volumes=false删除容器挂载的数据卷。
--link=false删除容器的连接，但保留容器。
--force=false强行终止并删除一个运行中的容器
ubuntu:latest
一个已经创建的容器到一个文件，不管此时这个容器是否处于运行状
ubuntu:latest
IMAGE
ubuntu:latest
berserk_brattain
COMMAND
，可以添加-f参数。Docker会发送SIGKILL信号给容
，该命令格式为docker exportCONTAINER。
"/bin/bash"
determined_pike
"echo'hello!I amh2 hours ago
/bin/sh-c
CREATED
About an hour ago
STATUS
第4章容器31
3minutes ago
PORTS
Exited（0）
NAMES
---
## Page 46
以快速切换到其他容器，还可以自动重启故障容器。
（高可靠性）机制，例如使用HAProxy工具来代理容器访问，这样在容器出现故障时候，
命令。
4.6本章小结
保存完整记录，体积也要大。此外，从容器快照文件导入时可以重新指定标签等元数据信息。
文件将丢弃所有的历史记录和元数据信息（即仅保存容器当时的快照状态），而镜像存储文件将
使用dockerimport命令来导人一个容器快照到本地镜像库。这两者的区别在于容器快照
导入容器
32第一部分Docker入门
在生产环境中，因为容器自身的轻量级特性，笔者推荐使用容器时在容器前段引人HA
通过本章内容的介绍和示例，相信已经掌握了对容器整个生命周期进行管理的各项操作
容器是直接提供应用服务的组件，也是Docker实现快速的启停和高效服务性能的基础。
实际上，既可以使用dockerload命令来导人镜像存储文件到本地的镜像库，又可以
读者可能会记得，笔者在之前章节曾介绍过使用dockerload命令来导人一个镜像文件。
$sudodocker images
导出的文件又可以使用docker import命令导人，成为镜像，例如：
可将这些文件传输到其他机器上，在其他机器上通过导人命令实现容器的迁移。
$ sudo docker export e81 >test_for_stop.tar
$ sudo docker export ce5 >test_for_run.tar
分别导出ce554267d7a4容器和e812617b41f6容器到test_for_run.tar文件
test/ubuntu
REPOSITORY
$cat test_for_run.tar|sudo docker import-test/ubuntu:vl.0
test_for_run.tar test_for_stop.tar
$1s
test_for_run.tar
Sls
Exited（0) 3 minutes ago
e812617b41f6
ago
d58050081fe3
Exited(-1)13 seconds ago
ce554267d7a4
CONTAINER ID
Exited (O) About an hour ago
v1.0
TAG
ubuntu:latest
ubuntu:latest
ubuntu:latest
IMAGE
9d37a6082e97
IMAGEID
COMMAND
silly_leakey
"echo 'hello! I am h"
berserk_brattain
"/bin/bash"
determined_pike
"/bin/sh-c'whilet"
CREATED
Abouta minute ago
CREATED
STATUS
PORTS
171.3MB
VIRTUAL SIZE
2hours ago
About anhour
3minutes ago
NAMES
可
---
## Page 47
基本操作
册成功后，本地用户目录的．dockercfg 中将保存用户的认证信息。
登录
的镜像。
5.1
建和使用私有仓库的基本操作。
行登录、
ubuntu来说，dl.dockerpool.com是注册服务器地址，ubuntu是仓库名。
仓库可以被认为是一个具体的项目或目录。例如对于仓库地址dl.dockerpool.com/
具体服务器，每个服务器上可以有多个仓库，而每个仓库下面有多个镜像。从这方面来说，
仓库又分公共仓库和私有仓库，在本章笔者将分别展示如何使用DockerHub官方仓库进
用户无需登录即可通过docker search命令来查找官方仓库中的镜像，并利用
可以通过执行docker
目前Docker官方维护了一个公共仓库https://hub.docker.com，其中已经包括15000多个
一个容易与之混淆的概念是注册服务器（Registry）。
仓库（Repository）是集中存放镜像的地方。
，大部分需求都可以通过在Docker Hub中直接下载镜像来实现，如图5-1所示。
Docker Hub
、下载等基本操作，以及使用DockerPool社区提供的仓库下载镜像；最后还将介绍创
login命令来输人用户名、密码和邮箱来完成注册和登录。注
实际上注册服务器是存放仓库的
仓
第5章
库
Choypters
---
## Page 48
name／来指定使用某个用户提供的镜像，比如tianon用户的镜像前缀为tianon/。
并维护的，带有用户名称为前缀，表明是某用户的某仓库。可以通过用户名称前缀user
往往使用单个单词作为名字。
像，称为基础或根镜像。这些镜像是由Docker公司创建、验证、支持、提供。这样的镜像
为关键词进行搜索：
dockerpull命令来将它下载到本地。
34
还有一种类型，比如tianon/centos镜像，它是由DockerHub的用户tianon创建
下载官方centos镜像到本地如下所示：
另外，在查找的时候通过-SN参数可以指定仅显示评价为N星以上的镜像。
根据是否为官方提供，可将这些镜像资源分为两类。一种是类似centos这样的基础镜
blalor/centos
$ sudo docker search centos
在搜寻镜像的章节，已经具体介绍了如何使用dockerpull命令。例如以centos
tutum/centos-6.4 DEPRECATED.Use tutum/centos:6.4 instead...
saltstack/centos-6-minimal
tianon/centos
centos
NAME
第一部分Docker入门
docker
Whatis Docker
appliations fordevelopers and sysadmins
AnyApp,Anywhere
Build, Ship and Run
Docker-An open platform for distributed
Build
Bare-bones base Centos 6.5 image
Centos 5 and 6,created using rinse instea..
The official build of Centos.
DESCRIPTION
Tylt
图5-1DockerHub
Use Cases
Ship
Trye
STARS
Install&Docs
Browse
OFFICIAL
Logn
Run
AUTOMATED
SignUp
L
9
28
[OK
[OK]
[OK]
[OK]
---
## Page 49
镜像的下载管理服务，如图5-2所示。
5.2
BitBucket）上的项目，一旦项目发现新的提交，则自动执行创建。
候，
自动创建
而自动创建功能使得用户通过DockerHub指定跟踪一个目标网站（目前支持GitHub或
，用户创建了镜像，安装了某个软件，如果软件发布新版本则需要手动更新镜像。
之后，可以在DockerHub的“自动创建”页面中跟踪每次创建的状态。
4）指定Dockerfle的位置，并提交创建。
3）选取一个目标网站中的项目（需要含Dockerfile）和分支。
2）在DockerHub中配置一个自动创建。
1）创建并登录DockerHub，以及目标网站；*在目标网站中连接帐户到DockerHub。
要配置自动创建，
自动创建（AutomatedBuilds）功能对于需要经常升级镜像内程序来说十分方便。有时
用户也可以在登录后通过docker push 命令来将本地镜像推送到Docker Hub。
7064731afe90:Downloadcomplete
511136ea3c5a:
539c0211cd76:Download
0b443ba03958:Downloadcomplete
Pulling repository centos
$ sudo docker pull centos
DockerPool简介
热门文章
Docker入门到实践
最专业的Docker技术服务社区，专注Devops核心技术和热点方向。
一站式Docker服务
DockerPool
、包括如下的步骤：
complete
complete
图5-2Docker Pool
热门镜像
tu:12.04
12.04
5
第5章仓
库
35
---
## Page 50
镜像文件存放在本地的指定路径上。
环境：
使用registry镜像创建私有仓库
5.3
是搭建本地的仓库服务器，将在后续章节予以介绍。
址dl.dockerpool.com:5000。
CentOS、Ubuntu、Java、Mongo、MySQL、Nginx等热门仓库和镜像。
下载镜像
查看镜像
36
安装Docker后，可以通过官方提供的registry镜像来简单搭建一套本地私有仓库
.下载镜像也是使用dockerpull命令，但是要在镜像名称前添加注册服务器的具体地
访间http://www.dockerpool.com/downloads，
例如下面的例子将上传的镜像放到/opt/data/registry目录：
默认情况下，会将仓库创建在容器的/tmp/registry目录下。可以通过-v参数来将