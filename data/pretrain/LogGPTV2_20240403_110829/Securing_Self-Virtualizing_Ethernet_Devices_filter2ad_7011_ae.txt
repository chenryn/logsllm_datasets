pers are based on weak security implementations of soft-
ware (e.g., a hypervisor) or hardware (a chipset system
error reporting mechanism) that are internal to the host.
Our attack exploits different design aspects of SRIOV
devices: it targets the interoperability of SRIOV devices
with software and hardware external to the host.
There are ongoing efforts of the Data Center Bridging
Task Group, which is a part of the IEEE 802.1 Working
Group, to standardize conﬁguration, management and
communication of virtual stations connected to the adja-
cent bridge. The working group proposed the 802.1Qbg
Edge Virtual Bridging [10] and 802.1BR Bridge Port
Extension [11] standards. Both standards concentrate
on conﬁguration and management of the bridge services
for virtual stations, leaving the ﬂow control of virtual
stations out of their scope. To the best of our knowl-
edge, our work is the ﬁrst to present the problem of self-
virtualizing devices in converged enhanced Ethernet en-
vironments with ﬂow control, and the ﬁrst to suggest a
solution for it.
11 Conclusions and Future Work
Self-virtualizing devices with SRIOV lie at the founda-
tion of modern enterprise data centers, cloud comput-
ing, and high-performance computing setups. We have
USENIX Association  
24th USENIX Security Symposium  347
shown that SRIOV, as currently deployed on current Eth-
ernet networks, is incompatible with required function-
ality such as ﬂow control. This is because ﬂow control
relies on the assumption that each endpoint is trusted,
whereas with SRIOV, each network endpoint is com-
prised of multiple, possibly untrusted, virtual machines.
We show how to overcome this ﬂaw by teaching the
NIC about virtual functions. We present the prototype of
such a system, VANFC, and its evaluation. Our prototype
is 100% effective in securing SRIOV against this ﬂaw
while imposing no overhead on throughput or latency-
oriented workloads.
Future work includes continuing to investigate the
security of SRIOV devices; extending our work from
Ethernet to other networking technologies such as In-
ﬁniBand and Fiber Channel; looking at the security of
direct-assigned self-virtualizing devices other than NICs,
such as high-end NVMe SSDs and GPGPUs; develop-
ing VF co-residency detection techniques; and using the
hypervisor to solve the problem of VM ring buffer ex-
haustion. Handling this with software without losing per-
formance will be challenging. On VANFC speciﬁcally,
we plan to continue our evaluation and to explore what
an eventual hardware-based implementation would look
like.
Acknowledgments
We would like to thank the anonymous reviewers, our
shepherd, Srdjan Capkun, Shachar Raindel from Mel-
lanox, David H. Lorenz and Ilya Lesokhin from Tech-
nion, and Sharon Kessler for insightful comments. This
research was supported, in part, by the Ministry of Sci-
ence and Technology, Israel, grant #3-9609. Any opin-
ions, ﬁndings, and conclusions in this paper are those of
the authors only and do not necessarily reﬂect the views
of our sponsors.
References
[1] Apache HTTP server
https:
//httpd.apache.org/docs/2.2/programs/ab.html.
[Accessed Jul, 2014].
benchmarking
tool.
[2] High Performance Computing (HPC) on Amazon Elastic Com-
pute Cloud (EC2) . Online : https://aws.amazon.com/
hpc/. [Accessed Jun, 2014].
[3] Iperf - The TCP/UDP Bandwidth Measurement Tool. http:
//iperf.sourceforge.net. [Accessed Jul, 2014].
[4] Linux
Ethernet
Bridge.
http://
www.linuxfoundation.org/collaborate/
workgroups/networking/bridge.
2014].
[Accessed Jul,
[5] Tcpreplay: Pcap editing and replay tools for Unix systems.
http://tcpreplay.synfin.net/. [Accessed Jul, 2014].
[6] IEEE Standards for Local and Metropolitan Area Networks: Sup-
plements to Carrier Sense Multiple Access With Collision Detec-
tion (CSMA/CD) Access Method and Physical Layer Speciﬁca-
tions - Speciﬁcation for 802.3 Full Duplex Operation and Physi-
cal Layer Speciﬁcation for 100 Mb/s Operation on Two Pairs of
Category 3 Or Better Balanced Twisted Pair Cable (100BASE-
T2).
IEEE Std 802.3x-1997 and IEEE Std 802.3y-1997 (Sup-
plement to ISO/IEC 8802-3: 1996; ANSI/IEEE Std 802.3, 1996
Edition) (1997), 1–324.
[7] IEEE Standard for Local and metropolitan area networks–Media
Access Control (MAC) Bridges and Virtual Bridged Local Area
Networks. IEEE Std 802.1Q-2011 (Revision of IEEE Std 802.1Q-
2005) (Aug 2011), 1–1365.
[8] IEEE Standard for Local and metropolitan area networks–Media
Access Control (MAC) Bridges and Virtual Bridged Local Area
Networks–Amendment 17: Priority-based Flow Control. IEEE
Std 802.1Qbb-2011 (Amendment to IEEE Std 802.1Q-2011 as
amended by IEEE Std 802.1Qbe-2011 and IEEE Std 802.1Qbc-
2011) (Sept 2011), 1–40.
[9] IEEE Standard for Ethernet - Section 2.
IEEE Std 802.3-2012
(Revision to IEEE Std 802.3-2008) (Dec 2012), 752–762.
[10] IEEE Standard for Local and metropolitan area networks–Media
Access Control (MAC) Bridges and Virtual Bridged Local
Area Networks–Amendment 21: Edge Virtual Bridging.
IEEE
Std 802.1Qbg-2012 (Amendment to IEEE Std 802.1Q-2011 as
amended by IEEE Std 802.1Qbe-2011, IEEE Std 802.1Qbc-2011,
IEEE Std 802.1Qbb-2011, IEEE Std 802.1Qaz-2011, IEEE Std
802.1Qbf-2011, and IEEE Std 802.aq-2012) (July 2012), 1–191.
[11] IEEE Standard for Local and metropolitan area networks–Virtual
Bridged Local Area Networks–Bridge Port Extension. IEEE Std
802.1BR-2012 (July 2012), 1–135.
[12] AGMON BEN-YEHUDA, O., BEN-YEHUDA, M., SCHUSTER,
A., AND TSAFRIR, D. The Rise of RaaS: The Resource-as-a-
Service Cloud. Communications of the ACM (CACM) (2014).
[13] ALIZADEH, M., ATIKOGLU, B., KABBANI, A., LAKSH-
MIKANTHA, A., PAN, R., PRABHAKAR, B., AND SEAMAN, M.
Data Center Transport Mechanisms: Congestion Control Theory
and IEEE Standardization. In 46th Annual Allerton Conference
on Communication, Control, and Computing (2008), IEEE.
[14] ALTUNBASAK, H., KRASSER, S., OWEN, H., GRIMMINGER,
J., HUTH, H.-P., AND SOKOL, J. Securing Layer 2 in Local
Area Networks. In 4th International Conference on Networking,
Lecture Notes in Computer Science. Springer, 2005.
[15] AMIT, N., BEN-YEHUDA, M., TSAFRIR, D., AND SCHUSTER,
A. vIOMMU: efﬁcient IOMMU emulation. In USENIX Annual
Technical Conference (ATC) (2011).
[16] AMIT, N., BEN-YEHUDA, M., AND YASSOUR, B.-A. IOMMU:
Strategies for Mitigating the IOTLB Bottleneck. In Workshop on
Interaction between Operating Systems & Computer Architecture
(WIOSCA) (2010).
[17] ARTEMJEV, O. K., AND MYASNYANKIN, V. V. Fun with the
Spanning Tree Protocol. Phrack 11 (2003), 61.
[18] ASSOCIATION, I. T. InﬁniBand Architecture Speciﬁcation Re-
lease 1.2.1, Volume 1. InﬁniBand Trade Association (2007).
[19] ASSOCIATION, I. T. InﬁniBand Architecture Speciﬁcation Re-
lease 1.2.1, Volume 1, Annex A16: RoCE. InﬁniBand Trade As-
sociation (2010).
348  24th USENIX Security Symposium 
USENIX Association
[20] BARHAM, P., DRAGOVIC, B., FRASER, K., HAND, S.,
HARRIS, T., HO, A., NEUGEBAUER, R., PRATT, I., AND
WARFIELD, A. Xen and the Art of Virtualization. ACM SIGOPS
Operating Systems Review (2003).
[36] FOONG, A. P., HUFF, T. R., HUM, H. H., PATWARDHAN, J. P.,
AND REGNIER, G. J. TCP Performance Re-visited. In Interna-
tional Symposium on Performance Analysis of Systems and Soft-
ware (2003), IEEE.
[21] BEN-YEHUDA, M., BOROVIK, E., FACTOR, M., ROM, E.,
TRAEGER, A., AND YASSOUR, B.-A. Adding Advanced Stor-
age Controller Functionality via Low-Overhead Virtualization.
In USENIX Conference on File & Storage Technologies (FAST)
(2012).
[22] BEN-YEHUDA, M., MASON, J., KRIEGER, O., XENIDIS,
J., VAN DOORN, L., MALLICK, A., NAKAJIMA, J., AND
WAHLIG, E. Utilizing IOMMUs for Virtualization in Linux and
Xen. In Ottawa Linux Symposium (OLS) (2006).
[23] BEN-YEHUDA, M., XENIDIS, J., OSTROWSKI, M., RISTER,
K., BRUEMMER, A., AND VAN DOORN, L. The Price of Safety:
Evaluating IOMMU Performance. In Ottawa Linux Symposium
(OLS) (2007).
[24] BIRKENHEUER, G., BRINKMANN, A., KAISER, J., KELLER,
A., KELLER, M., KLEINEWEBER, C., KONERSMANN, C.,
NIEHRSTER, O., SCHFER, T., SIMON, J., AND WILHELM, M.
Virtualized HPC: a contradiction in terms? Software: Practice
and Experience (2012).
[25] BRADNER, S., AND MCQUAID, J. Benchmarking methodology
for network interconnect devices. RFC 2544, Internet Engineer-
ing Task Force, Mar. 1999.
[26] BROADCOM CORPORATION. Broadcom BCM57810S NetXtreme
II Converged Controller, 2010. [Accessed February 2015].
[27] CHEN, Y., GRIFFITH, R., LIU, J., KATZ, R. H., AND JOSEPH,
A. D. Understanding TCP Incast Throughput Collapse in Data-
center Networks. In 1st ACM workshop on Research on Enter-
prise Networking (2009), ACM.
[28] CLARK, D. D., JACOBSON, V., ROMKEY, J., AND SALWEN,
H. An analysis of TCP processing overhead. Communications
Magazine, IEEE, 6 (1989).
[29] CONGDON, P.
Enabling Truly Converged Infrastructure.
http://sysrun.haifa.il.ibm.com/hrl/wiov2010/
talks/100313-WIOV-Congdon-dist.pdf, 2010.
[30] CONGDON, P., FISCHER, A., AND MOHAPATRA, P. A Case for
In 2nd Workshop on
VEPA: Virtual Ethernet Port Aggregator.
Data CenterConverged and Virtual Ethernet Switching (2010).
[31] CONGDON, P., AND HUDSON, C.
Edge Virtual Bridging–proposal
//www.ieee802.org/1/files/public/docs2009/
new-evb-congdon-vepa-modular-0709-v01.pdf,
2009.
to move forward.
Modularization of
http:
[32] DE SCHUYMER, B.,
Ebta-
Interaction On A Linux-Based Bridge.
[Accessed
bles/Iptables
http://ebtables.sourceforge.net, 2003.
Jul, 2014].
AND FEDCHIK, N.
[33] DONG, Y., YANG, X., LI, X., LI, J., TIAN, K., AND GUAN,
H. High performance network virtualization with SR-IOV.
In
IEEE International Symposium on High Performance Computer
Architecture (HPCA) (2010).
[34] FIELDING, R. T., AND KAISER, G. The Apache HTTP Server
Project. IEEE Internet Computing, 4 (1997).
[35] FITZPATRICK, B. Distributed Caching with Memcached. Linux
Journal, 124 (2004).
[37] GAVRILOVSKA, A., KUMAR, S., RAJ, H., SCHWAN, K.,
GUPTA, V., NATHUJI, R., NIRANJAN, R., RANADIVE, A., AND
SARAIYA, P. High-Performance Hypervisor Architectures: Vir-
tualization in HPC Systems. In Workshop on System-level Virtu-
alization for HPC (HPCVirt) (2007).
[38] GORDON, A., AMIT, N., HAR’EL, N., BEN-YEHUDA, M.,
LANDAU, A., SCHUSTER, A., AND TSAFRIR, D. ELI: bare-
metal performance for I/O virtualization. In ACM Architectural
Support for Programming Languages & Operating Systems (AS-
PLOS) (2012), ACM.
[39] HAR’EL, N., GORDON, A., LANDAU, A., BEN-YEHUDA, M.,
TRAEGER, A., AND LADELSKY, R. Efﬁcient and Scalable Par-
avirtual I/O System.
In USENIX Annual Technical Conference
(ATC) (2013).
[40] HAWLEY, A., AND EILAT, Y. Oracle Exalogic Elastic Cloud:
Advanced I/O Virtualization Architecture for Consolidating
High-Performance Workloads. An Oracle White Paper (2012).
[41] HUANG, S., AND BALDINE, I. Performance Evaluation of 10GE
NICs with SR-IOV Support:
I/O Virtualization and Network
Stack Optimizations. In 16th International Conference on Mea-
surement, Modelling, and Evaluation of Computing Systems and
Dependability and Fault Tolerance (2012), Springer-Verlag.
[42] INTEL CORPORATION.
Intel 82599 10 GbE Controller
Datasheet, 2014. Revision 2.9. [Accessed August 2014].
[43] INTEL CORPORATION. Intel I350 10 GbE Controller Datasheet,
2014. Revision 2.2. [Accessed February 2015].
[44] JACOBSON, V., LERES, C., AND MCCANNE, S.
Tcp-
dump: a powerful command-line packet analyzer. http://
www.tcpdump.org. [Accessed Jul, 2014].
[45] JONES, R.
The Netperf Benchmark.
//www.netperf.org. [Accessed Jul, 2014].
http:
[46] KAY, J., AND PASQUALE, J. The importance of non-data touch-
ing processing overheads in TCP/IP. ACM SIGCOMM Computer
Communication Review (1993).
[47] KIRAVUO, T., SARELA, M., AND MANNER, J. A Survey of Eth-
ernet LAN Security. Communications Surveys Tutorials, IEEE
(2013).
[48] KISSEL, E., AND SWANY, M. Evaluating High Performance
Data Transfer with RDMA-based Protocols in Wide-Area Net-
works. In 14th International Conference on High Performance
Computing and Communication & 9th International Confer-
ence on Embedded Software and Systems (HPCC-ICESS) (2012),
IEEE.
[49] KISSEL, E., SWANY, M., TIERNEY, B., AND POUYOUL, E.
Efﬁcient Wide Area Data Transfer Protocols for 100 Gbps Net-
works and Beyond. In 3rd International Workshop on Network-
Aware Data Management (2013), ACM.
KVM:
[50] KIVITY, A., KAMAY, Y., LAOR, D., LUBLIN, U.,
the Linux Virtual Ma-
AND LIGUORI, A.
In Ottawa Linux Symposium (OLS)
chine Monitor.
(2007).
http://www.kernel.org/doc/ols/2007/
ols2007v1-pages-225-230.pdf. [Accessed Apr, 2011].
Virtual Ethernet Bridg-
http://www.ieee802.org/1/files/public/
[51] KO, M., AND RECIO, R.
ing.
docs2008/new-dcb-ko-VEB-0708.pdf, 2008.
USENIX Association  
24th USENIX Security Symposium  349
[68] RICHTER, A., HERBER, C., RAUCHFUSS, H., WILD, T., AND
HERKERSDORF, A. Performance Isolation Exposure in Virtual-
ized Platforms with PCI Passthrough I/O Sharing. In Architecture
of Computing Systems (ARCS). Springer International Publishing,
2014.
[69] RUSSELL, R. virtio: towards a de-facto standard for virtual I/O
devices. ACM SIGOPS Operating Systems Review (OSR) (2008).
[70] STEPHENS, B., COX, A. L., SINGLA, A., CARTER, J., DIXON,
C., AND FELTER, W. Practical DCB for Improved Data Center
Networks. In International Conference on Computer Communi-
cations (INFOCOM) (2014), IEEE.
[71] SUGERMAN, J., VENKITACHALAM, G., AND LIM, B.-H. Vir-
tualizing I/O Devices on Vmware Workstation’s Hosted Virtual
Machine Monitor.
In USENIX Annual Technical Conference
(ATC) (2001).
[72] TIERNEY, B., KISSEL, E., SWANY, M., AND POUYOUL, E. Ef-
ﬁcient Data Transfer Protocols for Big Data. In 8th International
Conference on E-Science (2012), IEEE Computer Society.
[73] TREJO, L. A., MONROY, R., AND MONSALVO, R. L. Spanning
Tree Protocol and Ethernet PAUSE Frames DDoS Attacks: Their
Efﬁcient Mitigation. Tech. rep., Instituto Tecnolgico de Estudios
Superiores de Monterrey, ITESM-CEM, 2006.
[74] WILLMANN, P., SHAFER, J., CARR, D., MENON, A., RIXNER,
S., COX, A. L., AND ZWAENEPOEL, W. Concurrent Direct Net-
work Access for Virtual Machine Monitors.
In IEEE Interna-
tional Symposium on High Performance Computer Architecture
(HPCA) (2007).
[75] WONG, A., AND YEUNG, A. Network Infrastructure Security.
In Network Infrastructure Security. Springer, 2009.
[76] YASSOUR, B.-A., BEN-YEHUDA, M., AND WASSERMAN, O.
Direct Device Assignment for Untrusted Fully-Virtualized Vir-
tual Machines. Tech. Rep. H-0263, IBM Research, 2008.
[77] YASSOUR, B.-A., BEN-YEHUDA, M., AND WASSERMAN, O.
On the DMA Mapping Problem in Direct Device Assignment.
In Haifa Experimental Systems Conference (SYSTOR) (2010),
ACM.
[78] ZHUANG, M., AND AKER, B. Memslap: Load Test-
ing and Benchmarking Tool
http:
//docs.libmemcached.org/bin/bin/memslap.html.
[Accessed Jul, 2014].
for memcached.
[52] LEVASSEUR, J., UHLIG, V., STOESS, J., AND G ¨OTZ, S. Un-
modiﬁed Device Driver Reuse and Improved System Dependabil-
ity via Virtual Machines.
In Symposium on Operating Systems
Design & Implementation (OSDI) (2004).
[53] LIU, J. Evaluating standard-based self-virtualizing devices: A
In
performance study on 10 GbE NICs with SR-IOV support.
IEEE International Parallel & Distributed Processing Sympo-
sium (IPDPS) (2010).
[54] LOCKWOOD, G. SR-IOV: The Key to Fully Virtualized HPC
Clusters. Online : http://insidehpc.com/2013/12/
30/sr-iov-key-enabling-technology-fully-
virtualized-hpc-clusters/.
Presented on SC13:
International Conference for High Performance Computing,
Networking, Storage and Analysis. [Accessed Jun, 2014].
[55] MARKATOS, E. P. Speeding up TCP/IP: faster processors are
not enough. In 21st International Conference on Performance,
Computing, and Communications (2002), IEEE.
[56] MARRO, G. M. Attacks at the Data Link Layer. Master’s thesis,
University of California, Davis, 2003.
[57] MELLANOX TECHNOLOGIES. Mellanox OFED for Linux User
Manual, 2014. Revision 2.2-1.0.1. [Accessed July 2014].
[58] NAGLE, D., SERENYI, D., AND MATTHEWS, A. The Panasas
Activescale Storage Cluster: Delivering Scalable High Band-
width Storage.
In ACM/IEEE conference on Supercomputing
(2004), IEEE.
[59] PCI SIG. PCI Express Base Speciﬁcation, Revision 3.0, 2010.
[60] PCI SIG. Single Root I/O Virtualization and Sharing 1.1 Speci-
ﬁcation, 2010.
[61] P ´EK, G., LANZI, A., SRIVASTAVA, A., BALZAROTTI, D.,
FRANCILLON, A., AND NEUMANN, C. On the Feasibility of
Software Attacks on Commodity Virtual Machine Monitors via
Direct Device Assignment. In 9th ACM Symposium on Informa-
tion, Computer and Communications Security (2014), ACM.
[62] PHANISHAYEE, A., KREVAT, E., VASUDEVAN, V., ANDER-
SEN, D. G., GANGER, G. R., GIBSON, G. A., AND SESHAN,
S. Measurement and Analysis of TCP Throughput Collapse in
Cluster-based Storage Systems. In USENIX Conference on File
& Storage Technologies (FAST) (2008).
[63] POSTEL, J. B. Transmission control protocol. RFC 793, Internet
Engineering Task Force, Sept. 1981.
[64] RAJ, H., AND SCHWAN, K. High Performance and Scalable
I/O Virtualization via Self-Virtualized Devices. In International
Symposium on High Performance Distributed Computer (HPDC)
(2007).
[65] RAM, K. K., SANTOS, J. R., TURNER, Y., COX, A. L., AND
RIXNER, S. Achieving 10Gbps using Safe and Transparent Net-
work Interface Virtualization.
In ACM/USENIX International
Conference on Virtual Execution Environments (VEE) (2009).
[66] REGNIER, G., MAKINENI, S.,
IYER, R.,
MINTURN, D., HUGGAHALLI, R., NEWELL, D., CLINE, L.,
AND FOONG, A. TCP Onloading for Data Center Servers. Com-
puter Magazine, IEEE (2004).
ILLIKKAL, R.,
[67] REN, Y., LI, T., YU, D., JIN, S., ROBERTAZZI, T., TIERNEY,
B., AND POUYOUL, E. Protocols for Wide-Area Data-Intensive
Applications: Design and Performance Issues. In International
Conference on High Performance Computing, Networking, Stor-
age and Analysis (SC) (2012).
350  24th USENIX Security Symposium 
USENIX Association