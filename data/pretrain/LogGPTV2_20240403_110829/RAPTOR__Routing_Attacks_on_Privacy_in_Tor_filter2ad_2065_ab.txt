dresses (anonymity set) associated with a guard relay
(and the target connection to the sensitive Web server).
We note that in a preﬁx-hijack attack, the captured
trafﬁc is blackholed, and the client’s connection to the
guard is eventually dropped. Thus, it may not be pos-
sible to perform ﬁne-grained trafﬁc analysis to infer the
true client identity from this anonymity set. However, the
identiﬁcation of a reduced anonymity set (as opposed to
the entire set of Tor users) is already a signiﬁcant amount
of information leakage, and can be combined with other
contextual information to break user anonymity [18]. In
Section 5, we uncover several real-world BGP hijack at-
tacks in which Tor relays were among the target preﬁxes.
2.4 BGP Interception
Our BGP hijack attack discussed above allows adver-
saries to capture trafﬁc destined towards a target Tor
preﬁx, but the captured trafﬁc is blackholed, resulting
entry
client
AS2
AS1
dest
entry
AS3
AS5
AS4
AS6
10.0.0.0/16
Path: 6
10.0.0.1
exit
client
AS3
AS5
AS2
AS1
dest
10.0.0.0/16
Path: 3 2 5 6
AS4
10.0.0.0/16
Path: 6
AS6
10.0.0.1
exit
Figure 3: BGP interception attack enables ASes to selec-
tively put themselves on some path. Here, AS3 only sees
trafﬁc between the client and the entry relay (left). By
intercepting the preﬁx containing the exit relay (right),
AS3 also sees trafﬁc towards the exit relay, enabling it to
deanonymize the Tor communication.
in the connecting being dropped. Next, we discuss a
more sophisticated routing attack called BGP intercep-
tion attack [16], that allows adversaries to perform exact
deanonymization of Tor users.
A preﬁx interception attack allows the malicious AS to
become an intermediate AS in the path towards the guard
relay, i.e., after interception, the trafﬁc is routed back to
the actual guard relay. Such an interception attack al-
lows the connection to be kept alive, enabling the ma-
licious AS to exactly deanonymize the client via asym-
metric trafﬁc analysis.
Similar to the previous discussion, let us consider an
adversary trying to deanonymize the user connecting to
a sensitive website (the adversary already sees the traf-
ﬁc towards the website). The adversary can ﬁrst uncover
the identity of the guard relay using existing attacks [39]
(as before), and then launch a preﬁx interception attack
against the guard relay. Since the adversary routes the
trafﬁc back to the guard relay, the client’s connection is
kept alive, allowing the adversary to launch asymmetric
trafﬁc correlation attacks. Note that in contrast to BGP
hijack attacks, BGP interception attacks can perform ex-
act deanonymization of Tor clients.
These attacks enable malicious ASes to deanonymize
user identity corresponding to a monitored target connec-
tion. Similarly, ASes that already see the client’s trafﬁc
to its guard can position themselves to observe the trafﬁc
between the server and the exit relay by launching inter-
ception attacks against exit relays. Figure 3 illustrates
this attack scenario.
Finally, we note that a remote adversary can launch in-
terception attacks against both guard relays and exit re-
lays simultaneously, to perform general surveillance of
the Tor network. In Section 5, we demonstrate a real-
world BGP interception attack against a live Tor relay by
collaborating with autonomous system operators.
274  24th USENIX Security Symposium 
USENIX Association
4
3 Asymmetric Trafﬁc Analysis
In this section, we experimentally show that asymmet-
ric trafﬁc analysis attacks are feasible. We use the live
Tor network for our experiments. To protect the safety
of real Tor users, we generate our own trafﬁc through the
Tor network. Our goal is to investigate the accuracy of
asymmetric trafﬁc analysis in deanonymizing our gener-
ated trafﬁc.
Experimental Setup:
In order to generate our own
trafﬁc through the live Tor network, we use Planet-
Lab nodes as clients and Web servers. PlanetLab is an
open platform for networking research, that provides ac-
cess to hundreds of geographically distributed machines.
We randomly pick 100 machines on PlanetLab, located
across United States, Europe, and Asia. We installed Tor
clients on 50 of those machines, and used the Privoxy
tool (www.privoxy.org) to conﬁgure wget requests to
tunnel over Tor. The remaining 50 machines were setup
to be Web servers, each containing a 100MB image ﬁle.
We use the default Tor conﬁguration on the 50 client
machines. We launch wget requests on the 50 clients
at the same time, each requesting a 100MB image ﬁle
from one of the 50 web servers, respectively. We use
tcpdump to capture data for 300 seconds at the clients
and the servers during this process.
Asymmetric correlation analysis: In each packet trace,
we ﬁrst extract the TCP sequence number and TCP ac-
knowledgment number ﬁelds in the TCP header. Us-
ing the TCP sequence and acknowledgment numbers, we
next compute the number of transmitted data bytes per
unit time. For each pair of observed traces, we com-
pute the correlation between the vector of transmitted
data bytes over time. For our analysis, we use the Spear-
man’s rank correlation coefﬁcient (other correlation met-
rics could also be applicable). For each client, our asym-
metric trafﬁc analysis attack selects the server trace with
the highest correlation as the best match.
Results: Figure 4 illustrates our asymmetric analysis
computed between a client server pair that is commu-
nicating. We can see high correlation in all four ob-
servation scenarios discussed in Section 2. Figure 5 il-
lustrates our asymmetric analysis computed between a
client server pair that is not communicating with each
other. We can see that incorrectly matched pairs have
poor correlation in all four observation scenarios. Fig-
ure 6 illustrates the detection accuracy rate grows as the
duration of attack increases, especially in the ﬁrst 30 sec-
onds.
We computed the detection accuracy of our asymmet-
ric trafﬁc analysis attacks in all four scenarios after 300
seconds (by selecting the highest correlated pair), and
obtained an average accuracy of 95% (Table 2). The er-
ror matches are all false negatives, for which the client
client
server
)
B
M
(
a
t
a
D
4
3
2
1
0
client
server
)
B
M
(
a
t
a
D
4
3
2
1
0
0
50
100
150
200
250
300
0
50
100
150
200
250
300
Time (s)
Time (s)
(a) Client: ACK, Server: ACK
(b) Client: ACK, Server: Data
client
server
)
B
M
(
a
t
a
D
4
3
2
1
0
client
server
)
B
M
(
a
t
a
D
4
3
2
1
0
0
50
100
150
200
250
300
0
50
100
150
200
250
300
Time (s)
Time (s)
(c) Client: Data, Server: ACK
(d) Client: Data, Server: Data
Figure 4: Asymmetric trafﬁc analysis shows high corre-
lation between a matched client/server pair
has insigniﬁcant correlation coefﬁcients with all servers,
so it fails to be matched to any servers. We did not ob-
serve any false positives in our results.
Client ACK/
Server ACK
Client ACK/
Server Data
Client Data/
Server ACK
Client Data/
Server Data
Overall
False negative
False positive
96%
4%
0%
94%
6%
0%
96%
4%
0%
94%
6%
0%
Table 2: Asymmetric trafﬁc analysis accuracy rate
In addition to the actual observed error rate above, we
also performed a statistical tests to compute the 95% con-
ﬁdence interval on our error rate, given our sample size
of 50 client machines and 50 server machines. Table 3
illustrates the conﬁdence intervals on our error rates.
Client ACK/
Server ACK
Client ACK/
Server Data
Client Data/
Server ACK
Client Data/
Server Data
False negative
False positive
0.48% –
13.71%
0% –
0.15%
1.25% –
16.54%
0% –
0.15%
0.48% –
13.71%
0% –
0.15%
1.25% –
16.54%
0% –
0.15%
Table 3: Asymmetric trafﬁc analysis error rate conﬁ-
dence interval
4 Natural Churn
In this section, we study and evaluate how routing dy-
namics, or churn, increase the power of AS-level adver-
saries in anonymity systems such as Tor. We start with
an exhaustive control-plane analysis using collected BGP
USENIX Association  
24th USENIX Security Symposium  275
5
client
server
)
B
M
(
a
t
a
D
4
3
2
1
0
client
server
)
B
M
(
a
t
a
D
4
3
2
1
0
0
50
100
150
200
250
300
0
50
100
150
200
250
300
Time (s)
Time (s)
(a) Client: ACK, Server: ACK
(b) Client: ACK, Server: Data
client
server
)
B
M
(
a
t
a
D
4
3
2
1
0
client
server
)
B
M
(
a
t
a
D
4