See discussions, stats, and author profiles for this publication at: https://www.researchgate.net/publication/360345762
Real-time Statistical Log Anomaly Detection with Continuous AIOps Learning
Conference Paper · April 2022
DOI: 10.5220/0011069200003200
CITATIONS READS
2 796
4 authors, including:
Lu An Xiaotong Liu
North Carolina State University IBM Research-Almaden
15 PUBLICATIONS 165 CITATIONS 30 PUBLICATIONS 425 CITATIONS
SEE PROFILE SEE PROFILE
Rama Akkiraju
IBM
104 PUBLICATIONS 2,882 CITATIONS
SEE PROFILE
All content following this page was uploaded by Lu An on 03 May 2022.
The user has requested enhancement of the downloaded file.
Real-time Statistical Log Anomaly Detection with Continuous AIOps
Learning
LuAn a,An-JieTu,XiaotongLiuandRamaAkkiraju
IBMWatson,555BaileyAve,SanJose,U.S.A.
Keywords: AIforITOperations,LogAnomalyDetection,OnlineStatisticalLearning,ErrorEntityExtraction,Continu-
ousModelUpdating.
Abstract: AnomalydetectionfromlogsisafundamentalInformationTechnologyOperations(ITOps)managementtask.
Itaimstodetectanomaloussystembehavioursandfindsignalsthatcanprovidecluestothereasonsandthe
anatomyofasystem’sfailure.Applyingadvanced,explainableArtificialIntelligence(AI)modelsthroughout
theentireITOpsiscriticaltoconfidentlyassess,diagnoseandresolvesuchsystemfailures. Inthispaper,we
describeanewonlineloganomalydetectionalgorithmwhichhelpssignificantlyreducethetime-to-valueof
LogAnomalyDetection. ThisalgorithmisabletocontinuouslyupdatetheLogAnomalyDetectionmodel
atrun-timeandautomaticallyavoidpotentialbiasedmodelcausedbycontaminatedlogdata. Themethods
describedherehaveshown60%improvementonaverageF1-scoresfromexperimentsformultipledatasets
comparingtotheexistingmethodintheproductpipeline, whichdemonstratestheefficacyofourproposed
methods.
1 INTRODUCTION tional LAD methods were mostly manual operations
and rule-based methods, while such methods were
The exploding growth of Information Technology no long suitable for the large-scale IT systems with
(IT) systems and services make the systems and ap- sophisticated system incidents. In the recent years,
plications become increasingly more complex to op- with the development of AI technologies, machine
erate,manageandmonitor. Byutilizinglogprocess- learning based anomaly detection methods have re-
ing, machine learning and other advanced analytics ceived more and more attention. For instance, some
technologies,ArtificialIntelligenceforITOperations works utilized unsupervised clustering-based meth-
(AIOps)(Lerner,2017)providesapromisingsolution ods(Giventaletal.,2021a;Giventaletal.,2021b)to
toenhancethereliabilityoftheIToperations. Today, detectoutliers. Thoughsuchmethodsdonotrequire
mostplanet-scaleserviceoperatorsemploytheirown labeled data for training, the anomaly detection per-
AIOpstocollectlogs, tracesandtelemetrydata, and formance is not guaranteed and unstable. Moreover,
analyze the collected data to enhance their offerings it is hard to apply such methods onto streaming log
(Levinetal.,2019).OneofthecriticaltasksinAIOps dataasthelogpatternsarechangingovertime.
istheanomalydetectionwhichistheessentialstepto Another popular and widely used LAD approach
detectanomaloussystembehavioursandfindsignals is to first collect enough labeled training data during
thatcanprovidecluestothereasonsandtheanatomy the system’s normal operation period and adopt log
of a system’s failure (Goldberg and Shan, 2015; Gu templates-based method for feature engineering, and
etal.,2017;Chandolaetal.,2009). then employ Principal Component Analysis (PCA)
As system logs are records of the system states based methods to learn normal log patterns from
and events at various critical points and log data is labeled training data and find anomalous log pat-
universally available in nearly all IT systems, it is a terns during inference streaming log data (Liu et al.,
valuable resource for the AIOps to process, analyze 2020; Liuetal., 2021). EventhoughthePCA-based
and perform anomaly detection algorithms. We call method is successful in certain scenarios, it still suf-
the anomaly detection methods utilizing logs as data fersfromsomelimitationinpractice.Firstly,logtem-
sourceasLogAnomalyDetection(LAD).Thetradi- plates learning often requires customers to provide
one week’s worth of training logs without incidents
a https://orcid.org/0000-0003-4050-3625
223
An,L.,Tu,A.,Liu,X.andAkkiraju,R.
Real-timeStatisticalLogAnomalyDetectionwithContinuousAIOpsLearning.
DOI:10.5220/0011069200003200
InProceedingsofthe12thInternationalConferenceonCloudComputingandServicesScience(CLOSER2022),pages223-230
ISBN:978-989-758-570-8;ISSN:2184-5042
Copyright c 2022bySCITEPRESS–ScienceandTechnologyPublications,Lda.Allrightsreserved
(cid:13)
CLOSER2022-12thInternationalConferenceonCloudComputingandServicesScience
Log Anomaly Training
Log Parsing Feature Engineering PCA Model Training
Sampled Templates Learning Aggregation Normal Patterns
Historical
Logs
Embedding Extraction Encoding Anomaly Thresholds
Data Lake - AI Models
Log Anomaly Detection
Trained Log Parser Trained Feature Extractor PCA Model Inference
Streaming Templates Learning Aggregation Anomaly Detection Alerts
Logs
Embedding Extraction Encoding
Figure1:LADpipelineforPCA-basedMethod.
which may need some time to collect thus training 2 LAD SYSTEM DESCRIPTION
data is not available on Day 0. Moreover, the cus-
tomers sometimes may not know if the training logs In this section, we introduce the major steps of the
theyprovidedarepurenormallogs. Secondly,thelog LAD pipeline and how the new RSM algorithm af-
templateslearningprocesstakeshoursordaystofin- fected the steps of log anomaly detection compared
ish,dependingonthesizeofthedatasets. withthePCA-basedmethod.
In this paper, we propose a Real-Time Statisti-
cal Model (RSM) based LAD method, which aims 2.1 PCA-basedMethod
to reduce the training time and achieve faster “time-
to-value”whileperformingexcellentonlineanomaly ThePCA-basedmethodisillustratedinFig. 1andit
detection. The major contributions of this new algo- mainlyincludesthefollowingsteps:
rithminclude:
(i)Weintroduceafasterrorentityextractionmethod 1)LogAnomalyTraining: Wefirstingestedhistori-
toextractdifferenttypesoferrorentitiesincludinger- calnormallogdatafromlogaggregatorsorstreaming
rorcodesandexceptionsatrun-time. Inaddition,this data from Apache Kafka. Then the data preparation
method is able to quickly categorize if an incoming componentwillapplydatapreprocessingtogenerate
logcontainsanyfaults. aclean,normalizedlogdataanduploadthemintothe
(ii)Insteadofutilizinglogtemplatesforfeatureengi- clusterforfurtherlogtemplatetraining. Atree-based
neering,theRSMalgorithmadoptstheextractederror templateslearningalgorithmisthenappliedontothe
entitiestobuildfeaturecountvectorstolearnnormal selected training logs to generate log templates, and
logpatterns. these templates are used for feature engineering and
(iii) The proposed RSM method is able to keep the buildingtemplate/embeddingcountvectors.
model up-to-date by kick-starting the accumulative After such count vectors are generated, they will
retraining periodically, so that the model is able to beaggregatedandencodedforaPCAmodeltraining
continuously improve itself by learning from more where the model learns the normal patterns and the
andmorelogdata. anomaly threshold from the training logs. After the
(iv) We introduce an automatic skipping mechanism model training, such models will be stored in the
in the model updating which can help avoid biased clusterforfutureinference.
modelgeneratedbycontaminatedlogdata.
2) Log Anomaly Detection: During the inference,
The remainder of the paper is organized as fol-
the data preparation component first utilizes the
lows: Section 2 outlines the log anomaly detection
trainedlogtemplatesgeneratedinthetrainingstepto
system. Section 3 describes the technical details of
perform feature engineering on the streaming infer-
theRSMmethod. Section4showstheexperimentre-
ence log data. Such template/embedding count vec-
sultsoftheproposedRSMmethodonmultiplebench-
torsareaggregatedandencodedandthensenttothe
markdatasets. Finally,Section5concludesthepaper
loganomalydetectorwithothermetadata.
andsummarizesthefuturedirectionsofthework.
224
Real-timeStatisticalLogAnomalyDetectionwithContinuousAIOpsLearning
Log Anomaly Detection
Data Preperation Feature Engineering RSM Inference
Streaming RSM entity Extraction Aggregation Model Update Alerts
Logs
Embedding Extraction Encoding Anomaly Detection
Retrieve
Historical data
Save encoded Load latest
&
historical data RSM models
Update RSM
models
Data Lake - Historical Log Data & AI Models
Figure2:LADpipelineforRSM-basedMethod.
Log anomaly detector then retrieves the relative Ifyes,theinferencelogswillbetaggedasanomalies
PCA models from the cluster and applies them onto andgeneratealerts.
theencodedinferencedata.Thoseinferencelogswith From the above description of PCA-based and
PCA scores exceeding the trained threshold will be RSM-based methods, we can notice that the log
taggedasanomalies. anomalytrainingstepinPCA-basedmethodwillneed
customers to provide some normal training log data.
2.2 RSM-basedMethod On the one hand, one week log data is typically
required to guarantee a good quality of log train-
By introducing the RSM-based method into the ing. On the other hand, larger size of dataset may
product pipeline, the training step is eliminated and causelongtimetemplatelearningandmodeltraining.
the major phases of the LAD pipeline become as While in the RSM-based method, the online learn-
followsandareshowninFig. 2: ing method utilizes entity extraction instead of log
templates learning so that the time-consuming train-
1) Data Preparation: In RSM-based method, data ing step is eliminated which can significantly reduce
preparation component will directly apply entity ex- “time-to-value”oftheLADpipeline.
traction algorithm onto the streaming inference data.
Instead of utilizing log templates, these extracted
entities will be aggregated and encoded to generate
3 THE DESIGN OF RSM-BASED
feature count vectors. Along with other metadata,
METHOD
the encoded feature count vectors will be stored into
the clusters and sent out to log anomaly detector
simultaneouslyforinference. In this section, we will discuss the technical key-
points of the Real-Time Statistical Model based log
2) Model Updating: After a preset time period,
anomaly detection method proposed in this work in
the LAD is able to retrieve all the encoded log data
details.
from the cluster ingested during the last time period
and compute the statistical distribution for all the 3.1 LogEntityExtraction
entities. Such statistical distribution information for
both entity and embedding count vectors are stored
as RSM models in the cluster for future anomaly
detection. The model updating is scheduled to
happen periodically unless contaminated log data
wasdetectedinthelastperiod. Moreover,themodel
Figure 3: A log example from WebSphere Application
updating is accumulative so that the latest model
Server.
alwaysrepresentsallthehistoricaldatatheLADhas
seen. The RSM-based LAD product pipeline utilizes log
entities for feature engineering. Such log entities
3) Log Anomaly Detection: Once the initial RSM
could be the domain information from specific types
modelsareavailable,theloganomalydetectorisable
oflogs,e.g. thelogsfromIBMWebSphereApplica-
to load the latest models from the cluster and utilize
tionServer(IBM,2022). Inaddition,thelogentities
themtoperformstatisticaltestinganddetermineifthe
couldbespecificerrors,suchasHTTPerrorresponse
inference logs contain significantly different entities
codeorspecificexceptionswhichcanbethecauseor
or embedding distributions than the normal patterns.
225
CLOSER2022-12thInternationalConferenceonCloudComputingandServicesScience
Error Code
Exception type
Figure4:Anexampleoferrorentityextractionforgenerallogs.
symptomsforsystemincidents. Duringthedatapre- cianellaetal.,2010). Wehavediscardedsomenouns
processing phase, the data preparation component in candidates and added some words denoting negation
the LAD pipeline is responsible for extracting such because in log data, negative sentiments are mostly
logentitiesinreal-timeandthenaggregatinganden- associated with actions which mostly comprise of
codingthemtoformthefeaturecountvectorsforfur- verbs,adverbsoradjectives.
theranomalydetection. In addition, the relation and cause extraction are
performed to extract any detected error codes and
3.1.1 WebSphereLogs exceptions. Relation extraction includes the follow-
ing steps: (1) Dependency parsing; (2) Verb filtra-
TheIBMWebSphereApplicationServerisaflexible, tion and Clause/Predicate selection; (3) Extension
security-richJavaserverruntimeenvironmentforen- of Noun phrase; (4) Negative sentiment; (5) Rela-
terprise applications. Each WebSphere log contains tion clause/phrase generation. For cause extraction,
adesignatedmessageIDorloglevel,orboth. Fig. 3 we consider the following four rules: (1) Presence
showsanexampleofaWebSpherelogwhichcontains of Causative Verbs; (2) Presence of Phrasal Verbs;
aspecificmessageID“SRVE0315E”andtheloglevel (3) Presence of prepositional Adjective or Adverbial
“SEVERE”.Basedonthepriordomainknowledgeof Phrases;(4)AbsenceofNounPhrase.
theWebSphere,suchmessageID’sandloglevelsare With the above sentiment analysis, relation and
indicators of specific types of abnormal system be- cause extraction tools, we are able to extract error
haviors. The task of the data preparation component codes,exceptions’typesfromthelogsifpresent,and
istoidentifyifanincominglogisfromaWebsphere alsoidentifyifalogmessageindicateserroneoussys-
Application Server and then extract any shown mes- tem behaviour based on symptoms or negative sen-
sageID’sandloglevelsforfeatureengineering. timent dictionaries. Fig. 4 shows an example of the
entityextractionforgenerallogs.FromFig.4,wecan
3.1.2 GeneralLogs
observethattheextractederrorcodeis“500”andthe
exception type is “java.lang.IllegalStateException”
For all other non-WebSphere types of logs, during
andthislogmessageisidentifiedasanerroneouslog
thelogdatapreparationstage,weutilizetheSystemT
basedonthesentimentandsymptoms.
framework(Krishnamurthyetal.,2009)todefinethe
rulesforlogentityextraction(Mohapatraetal.,2018;
3.2 FeatureEncoding
Aggarwal et al., 2021; Aggarwal and Nagar, 2021).
First, the sentiment analysis is performed on the log
By employing the above proposed log entity extrac-
aslogmessagesusuallycontainmissingorfaultyat-
tion method, the data preparation component is able
tributeswhileencounteringanysystemerrors. Inor-
toextractmessageID’sandloglevelsforWebSphere
der to satisfy the run-time analysis requirement, we
logs and extract error entities for general erroneous
adopt a dictionary-based approach as opposed to a
logs. Those general logs without any error entities
full-blown machine learning approach. The nega-
will be tagged as “normal” logs. We use these ex-
tivesentimentdictionaryusedinourproductpipeline
tractedentitiestobuildthefeaturecountvectors.
was built based on our technical domain leveraging
To build the feature count vectors, we first group
on open-source sentiment dictionaries such as Vader
any logs that occurred in a preset time period T to-
(Hutto and Gilbert, 2014) and SentiWordNet (Bac-
226
Real-timeStatisticalLogAnomalyDetectionwithContinuousAIOpsLearning
gether,e.g.every10seconds,thusalllogsinonetime 3.4 RSMAnomalyDetection
period forms a time window. Assuming there are M
logs in the time windowt, labeled as L 1,L 2,···,L M, RSM anomaly detection is comprised of two inde-
andtherearetotalofN differentpossibleentitiesthat pendentanomalydetectionmethods: anentity-based
canbeextractedoutforallthelogsintimewindowt. detection method and an embedding-based detection
Ifthenth entityisextractedfromthemth logL m,then method. Theentity-basedmethodusesthestatistical
wedenoteden =1,otherwiseen =0. Thus,thefea- metricsfromextractedentitiesshowninSection3.1,
m m
turecountvectorforthistimewindowtisconstructed while the embedding-based detection method uses
asX t =[x 1,x 2,···,x N]wherethecountofthenthfea- thestatisticalmetricsfromextractedembeddings(Liu
tureisgivenby: etal.,2020). Theinferenceresultsfromthetwoindi-
vidual detection methods are aggregated together to
M
x = ∑ en. (1) produceasingleoutputthatformstheRSManomaly
n m
detection’sfinalinferenceresult.
m=1
3.3 RSMModelUpdate 3.4.1 Entity-basedDetection
Afterthecustomerconnectsstreaminglogstothesys- In a RSM model M, using historical data, we store
tem, LAD will start running with an empty statisti- the sample mean µ en, the sample standard deviation,