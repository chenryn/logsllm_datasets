### Optimized Text

Our deployment achieved a combined entry weight of approximately 1.2% and a combined exit weight of approximately 2.1%. This is an improvement over previous results, which were collected using 7 relays with an entry weight of 0.13% and an exit weight of 0.94% [26]. Additionally, we configured a custom exit policy to ensure that our exit relays would observe a representative sample of the types of traffic typically transported by Tor. This custom policy is more permissive than the default exit policy, allowing traffic to ports commonly associated with file sharing, which are typically blocked by the default policy.

#### 2.2.3 Privacy Settings

We configured our deployment to use the privacy budget allocation techniques outlined by Jansen and Johnson [22], but with slight modifications to the privacy parameters. Our approach employs an operator-based privacy model, where each operator adds sufficient noise across the relays they manage to meet differential privacy requirements. Thus, only one honest operator (with uncompromised relays) is necessary for our deployment to add the full amount of noise required for differential privacy. If no compromises occur during our measurements, the protections on our counters will be even stronger, as our final counters will contain three times the necessary noise. Each operator set the privacy parameter δ = 10−3, providing an upper bound on the noise value chosen by DCs that could violate ϵ-differential privacy. For entry-based statistics, we used ϵ = 0.3, and for exit-based statistics, we relaxed this parameter to ϵ = 1.0 to improve relative accuracy for histogram-based counters while maintaining adequate privacy.

Our deployment provides privacy according to the daily action bounds in Table 1, from which privacy sensitivities can be calculated. For general measurements (Section 3), we protect one simultaneously-open entry connection for the entire measurement period, consistent with the default behavior of a Tor client. We also protect 144 circuits of any type per day, sufficient to create one circuit every 10 minutes (the default circuit lifetime) over the measurement period. According to httparchive.org, 95% of web pages result in 90 or fewer connections; thus, we protect 9,000 web streams (to port 80 or 443), which could be used to browse 100 pages. We also protect 80 streams to ports officially associated with file sharing, allowing for twice as many connections as a new BitTorrent client typically attempts to establish [7]. In our BitTorrent traffic model, we observed a maximum of 74 opened connections while downloading each torrent. Therefore, 80 streams should protect at least one torrent download. We provide the same protections for traffic on other uncategorized ports, as past research has found that the majority of non-web traffic corresponds to file sharing [8, 26, 39]. Finally, we protect 10 MiB of data transferred on streams, covering 95% of web pages according to httparchive.org.

Note that histogram-based counters are sensitive to changes in the number of inputs rather than their values. Therefore, we use twice the number of inputs that can change as the sensitivity for histogram-based counters. For example, we use 288 as the sensitivity for the histogram of streams per circuit, as each circuit would cause an increment to a histogram bin counter, and a drop in one bin would raise the count in another.

During our hidden Markov model (HMM) measurements (Section 4), we adjust our action bounds under the assumption that circuits in Tor are unlinkable (one of Tor's design goals [11]). We protect 1 circuit during HMM measurements, which we believe will allow for reasonable accuracy across HMM counters. We also protect 31 streams and 2 MiB, which covers over 90% of circuits according to our general measurement results (see Section 3).

#### 2.3 Measurement Process

We conducted measurements to update and improve the accuracy of previously reported Tor entry and exit statistics [26] and to learn hidden Markov models of Tor traffic. Our measurements were divided into two main phases: a general measurement phase and a traffic model measurement phase. Each phase included several 24-hour measurement periods. The purpose of each measurement and the mean combined entry or exit consensus weight of our deployment during each measurement are summarized in Table 2.

During the general measurement phase, we focused on a few key statistics to avoid distributing the privacy budget too widely and to ensure the highest possible accuracy. In our earlier measurements, we focused on overall totals of the number of clients, circuits, streams, and bytes, and their breakdown into traffic classes. This was done to identify the most important traffic classes, which we then further investigated using histogram-type counters. Histogram counters consume twice as much privacy budget as regular counters, so we ensured that the traffic classes for which we collected histograms constituted a significant portion of Tor traffic to maintain reasonable accuracy.

Our general measurements were conducted between 2017-10-22 and 2017-12-01, and between 2018-01-10 and 2018-01-21. Initially, we used previously published statistics as traffic estimates for allocating our privacy budget [26], and updated these estimates in later measurement periods using results from earlier periods. Section 3 presents the results from 7 general measurement periods, 2 of which were used to collect entry-based statistics (rows 1 and 2 in Table 2) and 5 of which were used to collect exit-based statistics (rows 3 through 7 in Table 2).

During the traffic model measurement phase, we focused on measuring stream and packet hidden Markov traffic models. We measured counters for each model over 14 sequential 24-hour periods. At the end of each period, the counter results were fed back into the model to refine it to better fit the observed traffic. Traffic model measurements were conducted between 2018-03-19 and 2018-04-25, using only exit-based observations (rows 8 and 9 in Table 2) because individual TCP streams can only be observed at Tor exit relays due to Tor's multiplexing of streams over circuits. Section 4 presents the results from our 28 traffic model measurement periods, along with additional details about our model learning techniques.

#### 2.4 Ethical Considerations and User Safety

User safety was a primary goal during the measurement process. We followed the techniques set out by recent privacy-preserving Tor measurement research [13, 14, 26, 38] and utilized state-of-the-art tools for measuring Tor to maintain user privacy and the security of the measurement process [26]. We also considered the safety guidelines published by the Tor Research Safety Board and discussed our plans with several board members before starting our measurements. Our tools and techniques adhere to many safety guidelines, including data minimization, collecting only what is safe to publish, taking reasonable security precautions (each operator had exclusive access to their machines), and limiting the granularity of data by adding noise. We believe that the benefits of our measurements outweigh the risks to user safety, given our privacy and security guarantees and the potential for our results to benefit Tor experimentation across a wide range of research areas.

#### 3 Measuring Traffic Statistics

Our measurements focused on the number of clients, circuits, streams, and bytes, as well as their distributions. PrivCount counts the number of unique clients at the end of every 10-minute period to limit the time that client IP addresses are stored in RAM. For consistency, all measurements are reported as 10-minute means by dividing the daily count total by 144 (the number of 10-minute periods in a 24-hour measurement period).

##### 3.1 Entry Statistics

Entry relays have a limited view of Tor traffic types since they do not directly observe stream information. However, they can observe clients and circuits, providing insight into the distribution of circuits per client, which is useful for accurate Tor client models. Table 3 shows the results from our measurement of the total number of unique clients and circuits in a 10-minute interval, as well as the breakdown into active and inactive classes. The error associated with the addition of privacy-preserving noise is shown with 95% confidence.

From the results, it is evident that Tor users typically use only a handful of circuits in an average 10-minute period, suggesting that many Tor Browser users are lightly browsing the web. Notably, about 34% and 47% of clients build zero circuits, indicating that some users may not be actively using Tor during the measurement period.