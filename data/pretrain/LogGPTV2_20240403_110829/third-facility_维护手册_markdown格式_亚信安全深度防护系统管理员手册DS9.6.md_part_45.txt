• "*.java" 匹配 "test.java"
如果将特征码应用到以下路径：
/abc/123456/test.java
则：
• "a?c" 匹配 "abc"
• " 123" 无法匹配 "123456"，因此不会执行更多匹配操作
"**" 符号特征码匹配零个或多个部分，因此：
/abc/**/*.java
既匹配 "abc/123/test.java"，又匹配 "abc/123456/test.java"。它还匹配 "abc/test.java" 和 "abc/123/456/test.java"。
语法和概念
本节将提供一些完整性监控规则示例。这些示例将使用 FFiilleeSSeett 实体集，但所述的主题和组件对于所有实体集都是通用的。最小完整性监
控规则可能如下所示：
"base" 属性指定 FileSet 的基本目录。关于此规则的其他所有信息都是相对于该目录的。如果未向规则添加其他内容，则 "base" 下的
所有内容（包括子目录）的更改情况都将受到监控。
注意： "*" 和 "?" 通配符可用于 "base" 属性字符串，但仅限基本目录的最后一个路径组件。因此，以下形式有效：
base="C:\program files\CompanyName * Web Server"
但以下形式则是无效的：
base="C:\* files\Microsoft Office"
在实体集内，"include" 和 "exclude" 标记可用于控制特征码匹配。这些标记都具有 "key" 属性，用于指定要匹配的特征码。key 的源
因实体集而异。例如，对于文件和目录，源为其路径；对于端口，源为唯一的协议/IP/端口号元组。
注意： 如果包含/排除规则中提供的路径从语法角度讲无效，则客户端将生成“完整性监控规则编译问题”客户端事件，并提供
规则 ID 和路径（扩展后）作为参数。无效路径的示例为 C:\test1\D:\test2 ，因为文件名不可以包含两个卷标识
符。
219
亚信安全服务器深度安全防护系统 9.6 管理员指南 完整性监控规则语言
Include
include 标记实质上是一张白名单。使用此标记意味着仅包括由此标记（或其他 include 标记）匹配的实体。通过添加 include 标记，
以下规则现在仅监控对 "C:\Program Files\MySQL" 文件夹和子文件夹中名为 "*.exe" 的文件所进行的更改：
可以对 "Includes" 进行组合。以下规则将监控对 "C:\Program Files\MySQL" 文件夹和子文件夹中名为 "*.exe" 和 "*.dll" 的文件所
进行的更改：
还可以将多个条件组合到单个 include 块中，其中对于要包含的给定实体而言，所所有有条件都必须满足。以下 "include 标记要求包含以
".exe" 结束且以 "sample" 开头的实体。虽然可以更简洁地表达此要求，但在主要特征码与实体的其他功能结合时，此表达方式的实用性
会更加明显，如以下“功能”部分中所述。
下面是同一要求的另一种表达方式：
Exclude
exclude 标记用作文件黑名单，用于从集中移除文件，否则将返回这些文件。以下（不太可能）示例将使除临时文件之外的所有内容都受
到监控。
以下规则用于从 EXE 和 DLL 集中排除 "MySQLInstanceConfig.exe"：
与 "include" 标记相同，可编写 "exclude" 标记以要求多个条件。以下示例显示了一个多条件 "exclude" 标记。
220
亚信安全服务器深度安全防护系统 9.6 管理员指南 完整性监控规则语言
区分大小写
可以使用 "casesensitive" 属性控制 include/exclude 标记的特征码匹配是否区分大小写。该属性具有三个允许值：
• ttrruuee
• ffaallssee
• ppllaattffoorrmm
该属性的缺省值为 "platform"，表示特征码是否区分大小写将视运行该特征码的平台而定。在以下示例中，在 Windows 系统上将返回
"Sample.txt" 和 "sample.txt"，但在 Unix 系统上仅返回 "Sample.txt"：
在此示例中，Windows 和 Unix 系统上都只返回 "Sample.txt"：
注意： 对于大多数对象名称，区分大小写设置 "true" 在不区分大小写的平台上（如 Windows）的使用是受限制的。
功能
对于某些实体类型，也支持基于功能（而不是 "key"）包含和排除实体。功能集因实体类型而异。以下示例将包括所有可执行文件。与前
一个示例使用文件扩展名不同，此示例不依赖文件扩展名，而是将检查文件的前几百个字节以确定该文件是否可以在给定的操作系统上执
行。
功能属性必须显示在 "include" 或 "exclude" 标记中。要将这些功能属性用作多条件 include/exclude 的一部分，必须将其指定为封闭
include/exclude 标记的属性。以下示例包括名称中含有字符串 "MySQL" 的所有可执行文件：
前一个示例可以更简洁地表示为：
某些功能属性仅仅与其中一个实体属性值相匹配。在这种情况下，有时会支持使用 "*" 和 "?" 的通配符匹配。各实体集的帮助页面指示
哪些属性可以此方式用于 include/exclude 规则，以及这些属性是支持通配符匹配还是支持简单字符串匹配。
注意： 当支持通配符匹配时，要注意此匹配针对属性的字符串值并且没有执行任何规范化，这很重要。适用于实体项匹配（如
"**"）的构造以及用来分隔层次结构组件的"/"并不适用。匹配Windows上的路径名称需要使用"\"，因为该字符是出
现在正被测试的属性值中的字符，而 Unix 系统将在路径值中使用 "/"，所以匹配 Unix 路径需要使用 "/"。
下面是使用 "state" 属性的功能匹配的示例：
221
亚信安全服务器深度安全防护系统 9.6 管理员指南 完整性监控规则语言
注意： 在状态匹配中不支持通配符。
以下示例匹配二进制文件路径以 "\notepad.exe" 结束的任何进程：
以下示例匹配命令行以 "/sbin/" 开头的任何进程：
注意： 请慎重使用通配符。通配符表达式（如 "**"）将查看 "base" 下每个子目录中的各个文件。为此类表达式创建基线会消
耗很多时间和资源。
AND 和 OR
可通过使用多条件 include/exclude 和多个 include/exclude 来表示逻辑 AND 和 OR。
使用多条件 include/exclude 来表示 AND 的方式有多种。最直接的方式是将多个条件包括在单个封闭标记内。以下示例显示了一个简单
的多条件 AND 过程：
同样，作为多条件要求的一部分，表示为包括标记属性的任意条件将会与封闭条件进行组合。以下示例显示了前一个以此方式重写的多条
件 "include"：
最后，如果多个条件被表示为 include/exclude 的属性，则会将这些条件视为 AND：
OR 可以通过包含多个 include/exclude 标记简单地进行表达。以下代码可包括扩展名为 ".exe" 或 ".dll" 的文件：
评估顺序
无论规则中表面顺序如何，都会先处理所有 "includes"。如果一个对象名称匹配至少一个 "include" 标记，则会针对 "exclude" 标记对
此名称进行测试。如果此对象名称匹配至少一个 "exclude" 标记，则系统会从受监控的对象集中移除此对象。
实体属性
给定的实体具有一组可以监控的属性。如果没有为实体集指定任何属性（例如不存在属性包装标记），则假定该实体具有 STANDARD 属性
集。（有关各实体集的信息，请参阅速记属性部分。）
但是，对于给定的实体集，只有特定的实体属性才用于完整性监控。例如，最可能认为有必要并允许的是对日志文件内容的更改。但是，
应该报告对权限或所有权进行的更改。
222
亚信安全服务器深度安全防护系统 9.6 管理员指南 完整性监控规则语言
实体集的 "attributes" 标记允许表达此内容。"attributes" 标记包含一组枚举有用属性的标记。允许的 "attribute" 标记集会发生变
化，具体取决于应用这些标记的实体集。
注意： 如果 "attributes" 标记存在，但不包含任何条目，则系统只监控是否存在由规则定义的实体。
以下示例监控 "C:\Program Files\MySQL" 中名称包含 "SQL" 的可执行文件的“上次修改时间”、“权限”以及“所有者”属性所发生的
更改：
以下示例监控 "C:\Program Files\MySQL" 中日志文件的“权限”和“所有者”属性：
在以下示例中，STANDARD 属性集将会受到监控。（请参阅下面的“速记属性”）
在以下示例中，没有任何属性将受到监控。仅跟踪实体的存在是否发生更改。
速记属性
速记属性提供了一种使用单个更高级别属性指定一组属性的方式。与常规属性相似，允许的值集会发生变化，具体取决于应用这些值的实
体集。