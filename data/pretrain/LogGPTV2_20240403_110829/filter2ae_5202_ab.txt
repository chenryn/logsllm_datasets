2019-10-14 | 185.172.110.210 | bins/Cloud.arm6 | Linux arm | elf mirai  
2019-10-14 | 185.172.110.210 | bins/Cloud.sh4 | Linux sh4(日立微处理器) | elf mirai  
2019-10-14 | 185.172.110.2107 | bins/Cloud.arm | Linux arm | elf mirai  
2019-10-14 | 185.172.110.210 | bins/Cloud.m68k | Linux m68(摩托罗拉) | elf mirai  
2019-10-14 | 185.172.110.210 | bins/Cloud.ppc | Linux ppc | elf mirai  
2019-10-14 | 185.172.110.210 | bins/Cloud.mpsl | Linux mpsl | elf mirai  
2019-10-14 | 185.172.110.210 | bins/Cloud.x86 | Linux x86 | elf mirai  
2019-10-14 | 185.172.110.210 | bins/Cloud.arm | Linux arm | elf mirai  
2019-10-14 | 185.172.110.210 | bins/Cloud.spc | Linux spc | elf mirai  
2019-10-14 | 185.172.110.210 | bins/Cloud.arm5 | Linux arm | elf mirai  
2019-10-14 | 185.172.110.210s | bins/Cloud.mip | Linux mip | elf mirai  
表2 文件托管服务器上恶意文件列表
从表2中我们可以看出，“海毒蛇”组织长期保持着对物联网攻击的兴趣，他们在过去一年时间里持续使用Gafgyt、Mirai等物联网僵尸以获取物联网攻击资源。从物联网僵尸的上传记录来看，他们至少从2019年6月（这个时间应该会更早，因为我们并不能看到该黑客组织的所有基础设施的使用记录)开始就利用Gafgyt、Mirai等物联网僵尸入侵物联网设备，以构建僵尸网络。2020年7月，使用OneDrive云存储空间作为媒介向目标投放AgentTesla窃密木马。2020年8月，开始利用钓鱼邮件向各企业投放Remcos
RAT木马。这期间这些服务器同时依然存放着黑客的物联网攻击代码以供活跃的僵尸程序使用。
为了掌握更多的信息，我们加大了对该组织使用的物联网僵尸的收集，关联出1384个该组织使用的攻击样本，并通过ADLab物联网自动化分析平台对这些样本进行自动化分析，进一步关联出了100多个C&C服务器。分析结果表明，该组织以往几年常常利用华为HG532系列路由器漏洞CVE-2017-17215、爱尔兰公司“Eir”的D1000调制解调器TR064服务漏洞CVE-2016-10372、Realtek路由器漏洞CVE-2014-8361、D-Link
Devices HNAP SOAPAction-Header命令注入漏洞CVE-2015-2051、D-Link DSL-2750B
系统命令注入漏洞等主流的物联网设备漏洞攻击并控制设备。图5是某个样本的攻击代码片段。
图5 样本使用的物联网漏洞
我们对这些样本的活跃数量和活跃时间进行关联统计，绘制了物联网僵尸活跃时间分布图，见图6。从这批样本的攻击时间来看，至少从2018年1月开始，攻击者就开始利用Gafgyt、Mirai组建物联网僵尸网络，然后利用组建好的僵尸网络进行DDoS攻击牟利。2019年3月攻击开始活跃，2019年10月出现了一个小高峰，攻击的最高峰则出现在2020年8月。
图6 物联网僵尸的活跃时间分布图
攻击者通过弱口令爆破或者漏洞利用成功攻击路由器、调制解调器等物联网设备后，使用shellcode下载shell脚本，再通过shell脚本下载基于多个系统平台的Gafgyt、Mirai木马程序感染目标设备，进而利用这些木马组建庞大的物联网僵尸网络。如图7，攻击者曾在2020年6月利用Gafgyt变种向HooToo路由器（包含有远程命令执行漏洞CVE-2018-20841）发起过持续一个月的网络攻击活动。
图7 利用Gafgyt攻击HooToo路由器
2020年7月前后，攻击者扩展了攻击活动，其在恶意文件托管服务器上增加了新的目录用于存放AgentTesla木马，然后利用OneDrive云存储空间传播并向攻击目标投放该木马（见图8）。
图8 利用OneDrive云存储空间传播AgentTesla木马
紧接着在2020年8月前后，也就是我们在8月中旬发现的这起攻击事件前后，该攻击者又开始利用鱼叉式网络钓鱼邮件向商业公司投放带有漏洞利用（CVE-2017-0199、CVE-2017-8570）或恶意宏代码的诱饵文档，进而向目标投放Remcos
RAT木马。
“海毒蛇”黑客组织持有大量恶意域名和用于托管恶意文件的虚拟主机等网络基础设施，我们对掌握的该黑客组织持有的142个基础设施资源进行了地理位置分布统计，发现它们主要分布在21个国家和地区，其中分布较为密集的国家为荷兰、美国、加拿大、俄罗斯和德国，尤以“荷兰”和“美国”最为密集，分别是55个和31个，图9是我们绘制的
海毒蛇黑客组织基础设施全球分布图。
图9 海毒蛇黑客组织基础设施全球分布图
#### 2.3 攻击目标
从攻击目标上看，“海毒蛇”组织是以获取经济利益为目的，因此其攻击目标应该是不限制的。虽然其同时瞄准了物联网设备，但从使用的恶意代码上来看，应该主要以构建僵尸网络为目的，最终也是以提供攻击服务为目标，所以具体攻击目标是不受限制的。但是，近期开始活跃的定向攻击看起来是有一定目标导向的，比如上文提到的攻击者伪装成美国银行和美国大通银行发起的定向攻击,因此这里我们主要以此类攻击为主进行攻击目标的确定。通过对近期攻击事件的分析，我们得到了31种不同的诱饵文档。这些诱饵文档的攻击目标主要集中在金融机构、政府事业单位、精密仪器、酒店与旅游等相关实体。
图10 攻击目标
攻击目标包含著名的商业金融公司“ENGS”、政府事业机构“Huntsville Utilities”，精密仪器设计公司“Precision
Connector Design
(Pcd)”等等。攻击使用的诱饵文档大多以“保密协议”、“预算表”、“付款通知”、“采购订单”、“订单确认”、“住客名单”、“发票”和“汇款”等命名，使用了包含英语、德语、波兰语、保加利亚语、罗马尼亚语、葡萄牙语、加利西亚语、意大利语、西班牙语以及马耳他语等十多种语言，可以说攻击者的攻击目标遍布全球。诱饵文档的内容有如酒店订单图片、行政客户预订时间表、预算图片，也有故意模糊化以诱使目标用户启用宏查看更清晰的图片。图11是我们绘制的攻击目标语种分布图，从图中可以看到占比最大的分别是英语、葡萄牙语和西班牙语。
图11 攻击目标语种分布图
#### 2.4 黑客组织溯源
由于黑客的基础设施基本都做了隐私保护和CDN防护，在没有更进一步的数据和线索的情况下无法更深入地去深挖黑客组织。因此，我们希望从恶意代码入手来挖掘线索，寻找突破口，然后通过黑客对恶意代码的操作时间来做时区定位分析，确定黑客所在区域。
首先，该组织投放的诱饵文档是我们首要关注的，这些诱饵文档一般都是由黑客组织内部人员制作和分发。在恶意代码分析过程中，我们发现很多诱饵文档（大部分都是excel或者word文档）的创建者都来自同一个人——“Eng
Moha”。一般情况下，诱饵文档的创建者都是黑客伪造的，但如果黑客未做这方面的考虑，该名称就会是黑客主机的用户名。起初我们也没太注意这个信息，直到我们在其中一款恶意代码上发现实际有效的证据。该名称位于恶意代码中未被清除的PDB路径中（见图12），该路径中明确指示了制作该恶意代码的计算机用户名，那么可以肯定“Eng
Moha”就是“海毒蛇”黑客组织的关键成员。同时，我们还通过其他手段印证了该组织在制作、升级、修改和发布诱饵文档时，几乎都没有做诱饵文档的隐私数据处理。
图12 恶意代码中未被清除的PDB路径
编译时间也暗示我们该黑客是在2020年7月21日生成的该恶意代码，并在接下来的时间构建了一套完整攻击方案。接下来我们将“Eng
Moha”作为重要线索来追踪并得到了一批更广泛的攻击样本，通过分析确认这些样本采用的攻击手法和本次攻击非常相似。更重要的是我们在这批样本中找到了该黑客组织的其他成员（“mnb
joker”、“Lye Gomes”、“ Joselio Bonin”、“Emanoel Brito”和“aSmarany”等）。
这一系列攻击文档大部分都由“Eng Moha”创建，最早可追溯到2015年6月。通过创建时间溯源推断“Eng
Moha”制作了最初的攻击模板文件，然后将模板文件分发给其他成员，这些成员会对恶意文件进行配置并传播出去。我们为什么会将他们认定为同一组织的成员呢？主要有以下三个原因：
1）这些诱饵文档都是向攻击目标投放Remcos RAT和AgentTesla木马程序；
2）他们都使用了高度一致的多阶段嵌套下载技术和极为相似的加密和混淆脚本来投递木马；
3）这些诱饵文档被某个黑客创建的时间和被其他成员修改的时间非常接近。比如：攻击文件“Ostatnia notatka.docx”是“Eng
Moha”在2020/4/1 4:07创建的一个包含有漏洞（cve-2017-0199）的docx诱饵文档，而一分钟后，该文档就被“mnb
joker”编辑修改；另外一个攻击文件的文件信息显示“mnb joker”在2019/8/8
18:13创建一个包含恶意宏代码的ppt文档，一天后该文档又被“Joselio
Bonin”编辑。类似地我们找到了至少有5个黑客之间存在类似这样的关系，如表3。
诱饵文档名称 | 制作者 | 发布者 | 制作时间 | 配置时间  
---|---|---|---|---  
Ostatnia notatka.docx | Eng Moha | mnb joker | 3/10/20 22:23 | 3/10/20 22:24  
Споразумение за неразгласяване.docx | Eng Moha | mnb joker | 3/11/20 23:41 |
3/11/20 23:42  
Noul PO pentru AEC Amersham Pharma Ltd.docx | Eng Moha | mnb joker | 4/1/20
04:07 | 4/1/20 04:08  
CNH.ppt | mnb joker | Joselio Bonin | 8/8/19 18:13 | 8/12/19 02:13  
Order.dotm | mnb joker | aSmarany | 5/25/20 06:09 | 5/25/20 06:09  
… | … | … | … | …  
表3 黑客关联关系
经验表明，如果这个几名黑客属于不相干的组织关系或者产业链的上下游关系，他们操作同一个恶意代码的时间不会如此接近，最短时间甚至只差几分钟，同时攻击手法也不会如此相似，因此我们推断这几个关联出来的黑客属于同一个组织，并且他们都是“海毒蛇”组织的成员。同时可以肯定的是，“Eng
Moha”是该黑客组织负责漏洞利用和恶意代码编写的工程师，他为组织提供攻击代码，而其他成员负责维护基础设施、定制诱饵文档和攻击工具、分发和投放恶意代码等工作（见图13）。
图13 黑客成员协作关系图
更进一步的证据是，我们此后还发现这些黑客成员曾经使用同一个C&C服务器地址“gritodopovo.com.br”来控制恶意代码，当该C&C被曝光后，他们开始使用不同的经过隐私保护的域名作为C&C。此外，我们还发现这样的C&C服务器地址也曾经被APT组织Gorgon使用过，或许他们之间存在着某种关联，而且通过时区定位法发现他们同属于一个时区，但是我们依然没有证据证明两个组织之间的关系，因为他们的攻击目标和使用的武器差异都比较大。或许他们之间存在某种程度上的合作，那么极有可能“海毒蛇”组织和“Gorgon”APT组织一样位于巴基斯坦，后续我们会通过时区定位法来确定其所属的国家。（注：“Gorgon”APT组织是一个被认为来自巴基斯坦的攻击组织，在过去的2年里，该组织成员针对英国、西班牙、俄罗斯和美国的政府部门发动了一系列攻击）。
为了进一步确定“海毒蛇”组织所在的区域，我们对黑客的活动时间做了一个时区定位分析。首先我们尽可能多地收集了黑客基础设施上的文件创建时间、修改时间以及所有诱饵文档的原始时间，然后祛除日期信息保留时分秒信息，并将留取的时间数据归化成为UTC时间（见图14）。
图14 黑客活动时间分布
这里我们通过黑客活动时间来估算黑客可能的作息时间，以确定黑客所在地的时区。从图14中我们可以看出，黑客的休息时间主要集中在6:30到11:30，活动时间主要集中在11:30到19点之间(该分布时间是累积时间，即使黑客偶尔会打乱作息时间，但并不影响统计结果)。正常人晚上睡觉时间为23:30，起床时间为第二天凌晨6:30，那我们将这个时间映射到时区地图上便是深红色区域的国家（UTC+5时区左右，见图15），其中包括俄罗斯、巴基斯坦、哈萨克斯坦、乌兹别克斯坦、塔吉克斯坦等国家。
图15 黑客时区映射图
单纯通过时区定位法，我们是无法更进一步确认“海毒蛇”组织所在的具体国家的，但是从他们与来自巴基斯坦的“Gorgon”APT组织共用过同一个基础设施上来看，“海毒蛇”组织似乎位于巴基斯坦的可能性更大，我们此后还将持续跟踪，希望能够找到进一步的证据。
### 三、最新攻击案例分析
在此次攻击活动中，“海毒蛇”黑客组织使用了新型的恶意代码隐身技巧来隐藏恶意代码。在以往的此类攻击中，攻击者大多将恶意代码或数据存放在excel电子表格的单元格内容中隐藏显示，或者隐藏到VBA工程中的用户控件里，也有黑客将恶意代码放入文档的内建属性中。而在本次攻击中，黑客将恶意代码加密存放在了电子表格空白单元格的批注内容里，这种恶意代码隐藏方式在此类攻击中还是首次出现。恶意代码执行后，会通过多阶段的嵌套下载和解密执行来向受害者主机植入Remcos