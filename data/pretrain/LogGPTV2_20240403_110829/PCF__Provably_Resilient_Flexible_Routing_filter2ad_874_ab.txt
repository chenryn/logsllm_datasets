case performance under failures is intractable [10]. Thus, a central
challenge that PCF tackles is one of carefully crafting response
strategies that are (i) amenable to formal worst-case guarantees;
and yet (ii) perform closer to the networkâ€™s intrinsic capability.
PCF achieves the above by (i) developing tractable optimization
formulations that are inspired by practical response mechanisms
PCF: Provably Resilient Flexible Routing
SIGCOMM â€™20, August 10â€“14, 2020, Virtual Event, NY, USA
Figure 1: Example to illustrate FFCâ€™s coarse
modeling of network structure.
Figure 2: Throughput guarantee
with FFC for different
tunnel
choices compared to the optimal.
Figure 3: Example to illustrate how
tunnel-based reservations can be ineffi-
cient
in networking and conservatively estimate network capability; and
(ii) providing explicit response mechanisms that achieve the esti-
mated capability. Moreover, PCF allows the network architect to
incrementally dial-in additional flexibility in response as desired.
Roadmap. We introduce notation (Â§3.1), and present PCF-TF
(Â§3.2), which uses FFCâ€™s response mechanism but better models
network structure. We show that PCF-TF out-performs FFC, and
achieves better performance with more tunnels. Despite these ben-
efits, we show that PCF-TF (like FFC) can perform arbitrarily worse
than optimal. We introduce a more flexible approach based on the
logical sequence abstraction, and formally show the performance
benefits over PCF-TF (Â§3.3). We present further generalizations in
Â§3.4, and show how to practically realize the schemes (Â§4).
3.1 Notation and preliminaries
Consider a network topology, represented as a graph ğº = âŸ¨ğ‘‰ , ğ¸âŸ©.
Each link ğ‘’ âˆˆ ğ¸ is associated with a link capacity ğ‘ğ‘’. For each node
pair (ğ‘ , ğ‘¡) on the graph, we are given a traffic demand ğ‘‘ğ‘ ğ‘¡, and a
set of tunnels ğ‘‡ (ğ‘ , ğ‘¡) to route the traffic. Each tunnel ğ‘™ consists of a
set of links ğœğ‘™ âŠ† ğ¸. Below, we present a formulation for bandwidth
allocation with tunnels,
Î˜(ğ‘§)
ğ‘ğ‘™ (1 âˆ’ ğ‘¦ğ‘™) â‰¥ ğ‘§ğ‘ ğ‘¡ğ‘‘ğ‘ ğ‘¡ âˆ€ğ‘ , ğ‘¡ âˆˆ ğ‘‰ ,âˆ€ğ‘¦ âˆˆ ğ‘Œ
s.t. 
(ğ‘ƒ1) max
ğ‘§,ğ‘
(1)
ğ‘™âˆˆğ‘‡ (ğ‘ ,ğ‘¡)
ğ‘ğ‘™ â‰¥ 0 âˆ€ğ‘ , ğ‘¡ âˆˆ ğ‘‰ , ğ‘™ âˆˆ ğ‘‡ (ğ‘ , ğ‘¡)

âˆ€ğ‘ ,ğ‘¡ âˆˆğ‘‰ ,ğ‘™âˆˆğ‘‡ (ğ‘ ,ğ‘¡)
ğ‘ğ‘™ğ›¿(ğ‘’ âˆˆ ğœğ‘™) â‰¤ ğ‘ğ‘’ âˆ€ğ‘’ âˆˆ ğ¸.
(2)
(3)
Here, ğ›¿(ğ‘’ âˆˆ ğœğ‘™) = 1 if ğ‘’ âˆˆ ğœğ‘™ and 0 otherwise. The formulation deter-
mines ğ‘ğ‘™ and ğ‘§ğ‘ ğ‘¡ , where ğ‘ğ‘™ represents the amount of reservation on
tunnel ğ‘™, and variable ğ‘§ğ‘ ğ‘¡ represents the fraction of traffic from ğ‘  to
ğ‘¡ that can be satisfied. Note that we use slightly different notation
than FFC (see Table 2 in appendix). ğ‘Œ stands for the set of tunnel
failure scenarios of interest, and ğ‘¦ğ‘™ indicates whether tunnel ğ‘™ fails
or not in a failure scenario (ğ‘¦ğ‘™ = 1 indicates tunnel ğ‘™ fails and ğ‘¦ğ‘™ = 0
otherwise.) We later discuss how ğ‘Œ is modeled). Î˜(ğ‘§) is the metric
function we want to optimize. For tractability, we assume Î˜(ğ‘§)
is a concave function, and note that this model covers common
metrics such as overall throughput and maximum link utilization.
For example, Î˜(ğ‘§) =ğ‘ ,ğ‘¡ min{1, ğ‘§ğ‘ ğ‘¡}ğ‘‘ğ‘ ğ‘¡ models overall throughput.
ğ‘ ,ğ‘¡
{ğ‘§ğ‘ ğ‘¡}, and the optimal value is Î˜âˆ—,
Alternately, when Î˜(ğ‘§) = min
the model guarantees that Î˜âˆ— fraction of each flow can be sent in
every failure scenario. This also means that using 1/Î˜âˆ— of each
linkâ€™s capacity is sufficient to send all the flows. Hence, the inverse
of this Î˜âˆ— is the utilization of the most congested link, also known
as the Maximum Link Utilization (MLU). Thus, Î˜(ğ‘§) = min
{ğ‘§ğ‘ ğ‘¡}
minimizes the MLU.
ğ‘ ,ğ‘¡
3.2 Modeling network structure
We now discuss how to model the set of failure scenarios ğ‘Œ. If at
most ğ‘ğ‘ ğ‘¡ tunnels between ğ‘  and ğ‘¡ share a common link, FFC assumes
that upto ğ‘“ ğ‘ğ‘ ğ‘¡ tunnels can fail under ğ‘“ link failures, and plans for
all possible combinations of ğ‘“ ğ‘ğ‘ ğ‘¡ tunnel failures. As discussed in
Â§2, this is conservative â€“ e.g., for the network shown in Fig. 1, FFC
considers the simultaneous failure of ğ‘™1 and ğ‘™2 even though this
is impossible under single link failure. To address this, PCF more
accurately models ğ‘Œ by better relating link and tunnel failures. Let
ğ‘¥ğ‘’ indicate if link ğ‘’ fails (ğ‘¥ğ‘’ = 1 indicates link ğ‘’ fails and ğ‘¥ğ‘’ = 0
otherwise). Then, PCF models ğ‘Œ as:
The first constraint bounds the maximum number of simultaneous
link failures. The second ensures that the failure of an underlying
link will cause the tunnel to fail. The third ensures that a tunnel
only fails when at least one underlying link fails. We denote (P1)
with ğ‘Œ modeled by (4) as PCF-TF. Observe that we do not explicitly
impose that ğ‘¥ğ‘’ âˆˆ {0, 1} because, just as for FFC, the failure set ğ‘Œ
may contain too many scenarios to enumerate. Instead, we con-
servatively relax this requirement to ğ‘¥ğ‘’ âˆˆ [0, 1]. Then, the model
PCF-TF (and all other models presented in this paper) can be solved
using dualization to ensure the number of constraints is polynomial
in the size of the network, a technique that has been widely used
in prior networking papers [9, 26, 37]. Details are presented in the
Appendix. Yet, we prove that (i) PCF-TF performs at least as well
ğ‘¥ğ‘’ â‰¤ ğ‘“

ğ‘¦ğ‘™ âˆ’
ğ‘’âˆˆğ¸
ğ‘¥ğ‘’ âˆ’ ğ‘¦ğ‘™ â‰¤ 0 âˆ€ğ‘™, ğ‘’ âˆˆ ğœğ‘™
ğ‘¥ğ‘’ â‰¤ 0 âˆ€ğ‘™
0 â‰¤ ğ‘¥ğ‘’ â‰¤ 1 âˆ€ğ‘’ âˆˆ ğ¸
0 â‰¤ ğ‘¦ğ‘™ â‰¤ 1 âˆ€ğ‘™ .
ğ‘’âˆˆğœğ‘™
(4)
Link capacity: 1                   Link capacity: 1/2 Tunnelss13t 24l1l2l3l4e2e3stuLink capacity: 1 Link capacity: 1/3 e4e5e1SIGCOMM â€™20, August 10â€“14, 2020, Virtual Event, NY, USA
Chuan Jiang, Sanjay Rao, and Mohit Tawarmalani
as FFC; and (ii) unlike FFC, the performance of PCF-TF does not
degrade as more tunnels are added.
Proposition 1. The feasible region (the set of all possible values
of the variables that satisfy the constraints) of FFC is contained in the
feasible region of PCF-TF, so PCF-TF performs at least as well as FFC
(i.e., achieves the same objective or higher) for any metric.
Proof. FFC models ğ‘Œ as
ğ‘¦ğ‘™ â‰¤ ğ‘“ ğ‘ğ‘ ğ‘¡ âˆ€ğ‘ , ğ‘¡ âˆˆ ğ‘‰
ğ‘™âˆˆğ‘‡ (ğ‘ ,ğ‘¡)
0 â‰¤ ğ‘¦ğ‘™ â‰¤ 1 âˆ€ğ‘™ .
(5)
Let ğ‘Œ0 be the set of tunnel failure scenarios considered by FFC
(constrained by (5)) and let ğ‘Œ1 be the set of tunnel failure scenarios
considered by PCF-TF (constrained by (4)). We show that projğ‘¦ğ‘Œ1 âŠ†
ğ‘Œ0, where projğ‘¦ denotes projection of the set to ğ‘¦ variables. For any
ğ‘ , ğ‘¡ âˆˆ ğ‘‰ , we sum the third constraint in (4) over all ğ‘™ âˆˆ ğ‘‡ (ğ‘ , ğ‘¡) to get
ğ‘™âˆˆğ‘‡ (ğ‘ ,ğ‘¡)(ğ‘¦ğ‘™ âˆ’ğ‘’âˆˆğœğ‘™
ğ‘¦ğ‘™ â‰¤ 



ğ‘™âˆˆğ‘‡ (ğ‘ ,ğ‘¡)
ğ‘¥ğ‘’
ğ‘’âˆˆğœğ‘™
ğ‘™âˆˆğ‘‡ (ğ‘ ,ğ‘¡)
ğ›¿(ğ‘’ âˆˆ ğœğ‘™),

ğ‘¥ğ‘’) â‰¤ 0. Then,


ğ‘¥ğ‘’ =
ğ‘™âˆˆğ‘‡ (ğ‘ ,ğ‘¡)
ğ‘’âˆˆğ¸
=
ğ‘’âˆˆğ¸
ğ‘™âˆˆğ‘‡ (ğ‘ ,ğ‘¡)
ğ‘’âˆˆğ¸ ğ‘¥ğ‘’ is the total number of link failures, which is no more
than ğ‘“ . Andğ‘™âˆˆğ‘‡ (ğ‘ ,ğ‘¡) ğ›¿(ğ‘’ âˆˆ ğœğ‘™) is the number of tunnels from ğ‘ 
ğ‘™âˆˆğ‘‡ (ğ‘ ,ğ‘¡) ğ‘¦ğ‘™ â‰¤ ğ‘“ ğ‘ğ‘ ğ‘¡, which shows that any scenario in ğ‘Œ1 also
to ğ‘¡ traversing link ğ‘’, which is no more than ğ‘ğ‘ ğ‘¡ . Hence, we have
satisfies (5). Since FFC imposes (1) for each ğ‘¦ âˆˆ ğ‘Œ0 while PCF-TF
imposes (1) for each (ğ‘¥, ğ‘¦) âˆˆ ğ‘Œ1, PCF-TF is less constrained than
FFC. â–¡
The above proof does not depend on the objective function in the
optimization problem, which means that the proposition holds for
any metric. We next show that unlike FFC, PCF-TFâ€™s performance
does not degrade with more tunnels. The intuition behind this is that
when more tunnels are added to PCF-TF, the set of constraints that
need to be satisfied does not increase. Hence, any solution feasible
when fewer tunnels are employed remains feasible when tunnels
are added (though new and better solutions may be possible). Thus
the performance cannot get worse.
Proposition 2. As we provide more tunnels, PCF-TFâ€™s perfor-
mance cannot decrease.
Proof. Let {ğ‘‡0(ğ‘ , ğ‘¡) | âˆ€ğ‘ , ğ‘¡ âˆˆ ğ‘‰ } and {ğ‘‡1(ğ‘ , ğ‘¡) | âˆ€ğ‘ , ğ‘¡ âˆˆ ğ‘‰ } be two
sets of tunnels, and ğ‘‡0(ğ‘ , ğ‘¡) âŠ† ğ‘‡1(ğ‘ , ğ‘¡) for all ğ‘ , ğ‘¡ âˆˆ ğ‘‰ . Then, we show
that the optimal value for (P1) with ğ‘‡ = ğ‘‡1 will not be worse than
the optimal solution to (P1) with ğ‘‡ = ğ‘‡0. Let (ğ‘âˆ—, ğ‘§âˆ—) be the optimal
solution to (P1) with ğ‘‡ = ğ‘‡0. We construct (ğ‘â€², ğ‘§â€²) in the following
way,
ğ‘™
âˆ€ğ‘ , ğ‘¡ âˆˆ ğ‘‰ , ğ‘™ âˆˆ ğ‘‡0(ğ‘ , ğ‘¡)
ğ‘™ = ğ‘âˆ—
ğ‘â€²
ğ‘â€²
ğ‘™ = 0 âˆ€ğ‘ , ğ‘¡ âˆˆ ğ‘‰ , ğ‘™ âˆˆ ğ‘‡1(ğ‘ , ğ‘¡) âˆ’ ğ‘‡0(ğ‘ , ğ‘¡)
ğ‘§â€²
ğ‘ ğ‘¡ = ğ‘§âˆ—
ğ‘ ğ‘¡ âˆ€ğ‘ , ğ‘¡ âˆˆ ğ‘‰ .
(6)
Let ğ‘Œ0 denote (4) with ğ‘‡ = ğ‘‡0 and ğ‘Œ1 denote (4) with ğ‘‡ = ğ‘‡1. It is
easy to see that projection of ğ‘Œ1 onto the space of variables {ğ‘¥ğ‘’}ğ‘’âˆˆğ¸
and {ğ‘¦ğ‘™}ğ‘™âˆˆğ‘‡0 is contained in ğ‘Œ0, since all the constraints in ğ‘Œ0 are
ğ‘¥ğ‘’ğ›¿(ğ‘’ âˆˆ ğœğ‘™)
for real networks.
Figure 4: A topology with ğ‘š nodes generalized from the pre-
vious example.


ğ‘™âˆˆğ‘‡1(ğ‘ ,ğ‘¡)
ğ‘â€²
ğ‘™ (1 âˆ’ ğ‘¦ğ‘™) =
present in ğ‘Œ1. Now for each ğ‘¦ âˆˆ ğ‘Œ1,
ğ‘âˆ—
ğ‘™ (1 âˆ’ ğ‘¦ğ‘™) â‰¤ ğ‘§âˆ—
where the first equality is because ğ‘â€²
ğ‘™ = 0 for ğ‘™ âˆ‰ ğ‘‡0(ğ‘ , ğ‘¡), the first
inequality is because (ğ‘âˆ—, ğ‘§âˆ—) is feasible forğ‘‡ = ğ‘‡0 and the projection
of ğ‘Œ1 is contained in ğ‘Œ0 and the last equality is by construction. Since
ğ‘§ is not altered, the objective value remains the same. â–¡
ğ‘ ğ‘¡ğ‘‘ğ‘ ğ‘¡ = ğ‘§ğ‘ ğ‘¡ğ‘‘ğ‘ ğ‘¡ ,
ğ‘™âˆˆğ‘‡0(ğ‘ ,ğ‘¡)
We later show in Â§5 that PCF-TF performs much better than FFC
3.3 Modeling more flexible response
While PCF-TF is guaranteed to out-perform FFC, we begin by pre-
senting a theoretical result that shows the performance of PCF-TF
can still be arbitrarily worse than optimal because of the inflexi-
bility of tunnel-based reservations. We then discuss PCFâ€™s more
flexible approach.
Proposition 3. The throughput guaranteed by PCF-TF (and hence
that guaranteed by FFC) can be arbitrarily worse than the optimal
even with exponentially many tunnels.
Proof. Consider the topology in Fig. 4 (the example in Fig. 3 is
a special case where ğ‘ = 3, ğ‘› = 2 and ğ‘š = 2). Under any failure
involving ğ‘› âˆ’ 1 links, the network can carry 1 âˆ’ ğ‘›âˆ’1
ğ‘ units of traffic
if it responded optimally. This is because under any such failure,
the network can carry (i) at least 1 unit of traffic between ğ‘ ğ‘– and
ğ‘ ğ‘–+1, ğ‘– > 0; and (ii) at least 1 âˆ’ ğ‘›âˆ’1
ğ‘ units of traffic between ğ‘ 0 and