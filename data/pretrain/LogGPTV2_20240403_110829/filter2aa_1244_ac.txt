$referer = $_SERVER['HTTP_REFERER'];
// Get query strings
$query_string = $_SERVER['QUERY_STRING'];
// Anything else
imagejpeg($im);
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Doing the dirty
// Create an image from the handle and send to browser
header("Content-type: image/jpeg");
// Write Cookie
setcookie("TestCookie", $value);
// Read Cookie
$old_cookie = $HTTP_COOKIE_VARS["TestCookie"];
// Get referer variable
$referer = $_SERVER['HTTP_REFERER'];
// Get query strings
$query_string = $_SERVER['QUERY_STRING'];
// Anything else
imagejpeg($im);
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Doing the dirty
// Create an image from the handle and send to browser
header("Content-type: image/jpeg");
// Write Cookie
setcookie("TestCookie", $value);
// Read Cookie
$old_cookie = $HTTP_COOKIE_VARS["TestCookie"];
// Get referer variable
$referer = $_SERVER['HTTP_REFERER'];
// Get query strings
$query_string = $_SERVER['QUERY_STRING'];
// Anything else
imagejpeg($im);
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Doing the dirty
// Create an image from the handle and send to browser
header("Content-type: image/jpeg");
// Write Cookie
setcookie("TestCookie", $value);
// Read Cookie
$old_cookie = $HTTP_COOKIE_VARS["TestCookie"];
// Get referer variable
$referer = $_SERVER['HTTP_REFERER'];
// Get query strings
$query_string = $_SERVER['QUERY_STRING'];
// Anything else
imagejpeg($im);
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Doing the dirty
// Create an image from the handle and send to browser
header("Content-type: image/jpeg");
// Write Cookie
setcookie("TestCookie", $value);
// Read Cookie
$old_cookie = $HTTP_COOKIE_VARS["TestCookie"];
// Get referer variable
$referer = $_SERVER['HTTP_REFERER'];
// Get query strings
$query_string = $_SERVER['QUERY_STRING'];
// Anything else
imagejpeg($im);
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
MySpace doesn't allow them!
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Fooling apache to execute .JPGs
In the .htaccess file
Tells apache to parse all files 
(in this or subsequent directories) with the .jpg 
extension as though they were PHP scripts!
AddType application/x-httpd-php .jpg
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Fooling apache to execute .JPGs
Once done, you can reference your 
executable images like this…
The Executable Image Exploit
www.schrenk.com
Example: Dynamic JPG
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Applications
Can be used on many (web 2.0) websites that let
you post comments.
– Craigs List
– Ebay
– MySpace
– Fark
– PayPal (payment page)
Also on non-web environments
– Newsgroups (NNTP)
– Email
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Applications
Can be used on many (web 2.0) websites that let
you post comments.
– Craigs List
– Ebay
– MySpace
– Fark
– PayPal (payment page)
Also on non-web environments
– Newsgroups (NNTP)
– Email
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Tracking people on MySpace
The Executable Image Exploit
www.schrenk.com
Add an inline
(executable) 
image in a
MySpace 
comment
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Tracking people on MySpace
When one checks 
new messages or
new comments
and the comment/message contains
a executable image…
The userID is in $_SERVER['HTTP_REFERER'];
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Tracking people on MySpace
The userID lets you associate a cookie with their 
identity:
http://profile.myspace.com/index.cfm?
fuseaction=user.viewprofile&friendid=userID
Anytime they revisit, you can track them.
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Other MySpace fun
You can write an application that shows the 
viewing habits of all your friends by sending 
them each a message that contains a executable 
image.
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Other MySpace fun
You can show one set of pictures to your 
MySpace friends, and another to set of images 
to non-friends.
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Other MySpace fun
You can use these same cookies to track people’s 
movement on other sites (eBay, Craigslist, etc).
Since your cookies all belong to the domain that 
your executable image is on, your cookies will 
“appear” to function across domains.
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Spanning domains
The Executable Image Exploit
www.schrenk.com
Your Browser
eBay Cookie
eBay.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Spanning domains
The Executable Image Exploit
www.schrenk.com
Your Browser
eBay Cookie
Myspace cookie
eBay.com
MySpace.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Spanning domains
The Executable Image Exploit
www.schrenk.com
Your Browser
eBay Cookie
Your  Cookie
Myspace cookie
eBay.com
MySpace.com
ex img
ex img
Your Server
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Third Party Cookies
The Executable Image Exploit
www.schrenk.com
First party cookie
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Third Party Cookies
The Executable Image Exploit
www.schrenk.com
First party cookie
Third party cookie
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Other Web 2.0 Fun
Show high quality images to members of your 
site and poor quality images to everyone else
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Other Web 2.0 Fun
Embed identifying watermarks in images  to
track unauthorized use
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Other Web 2.0 Fun
Create eBay auctions with images that
change as you near the end of the auction
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Other Web 2.0 Fun
Show different images in your eBay auction
after people see your similar ad on Craigs List
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Other Web 2.0 Fun
Evaluate 
websites you
want to 
advertise on
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Other Web 2.0 Fun
Receive an
acknowledgement when
an email is read
nonrepudiation  
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Other Web 2.0 Fun
Develop images with expiration dates
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Getting ideas
Focus on applications where images can be loaded 
from your server (think across domains)
Use:
• Cookies
• Referrer variables to catch query strings
Images are easy to manipulate with PHP & GD
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Getting ideas
Focus on applications where images can be loaded 
from your server (think across domains).
Use:
• Cookies
• Referrer variables to catch query strings
Images are easy to manipulate with PHP & GD
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Getting ideas
Focus on applications where images can be loaded 
from your server (think across domains).
Use:
• Cookies
• Referrer variables to catch query strings
Images are easy to manipulate with PHP & GD
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Defences
Watch what you put in query strings
• Sessions may be stolen if all of the session variable is 
in a query string
Allow people to upload images instead of
referencing them
• Takes more server space & bandwidth
• Removes the “executable” from images.
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Defences
Watch what you put in query strings
• Sessions may be stolen if all of the session variable is 
in a query string
Allow people to upload images instead of
referencing them 
• Takes more server space & bandwidth
• Removes the “executable” from images.
The Executable Image Exploit
www.schrenk.com
Thank You!