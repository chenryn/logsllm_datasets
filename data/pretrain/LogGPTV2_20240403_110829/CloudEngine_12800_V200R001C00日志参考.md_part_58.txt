MSTP/4/MSTPLOG_PROLOOPBACK_DETECTED:The MSTP process's port has been set
to discarding state because of detecting loopback. (ProcessID=[ProcessID],
InstanceID=[InstanceID], PortID=[PortID], IfIndex=[IfIndex], PortName=[PortName],
PwName=[PwName])
日志含义
MSTP进程的端口因为检测到环回而进入阻塞状态。
日志参数
参数名称 参数含义
ProcessID MSTP进程ID。
InstanceID 实例ID。
PortID 端口ID。
IfIndex 端口索引。
PortName 端口名称。
PwName PW名称。
可能原因
原因1：设备上使能STP的端口检测到环回。
处理步骤
l 原因1：设备上使能STP的端口检测到环回。
文档版本 06 (2017-09-12) 华为专有和保密信息 529
版权所有 © 华为技术有限公司
CloudEngine 12800系列交换机
日志参考 54 MSTP
a. 查看产生日志的端口是否配置了本地环回。
n 如果是，则请执行步骤3。
n 如果不是，则请执行步骤2。
b. 排查网络中是否有Hub、集线器的连线自环。
n 如果是，则请执行步骤4。
n 如果不是，则请执行步骤5。
c. 删除本地环回的配置，查看问题是否解决。如果未解决，则请执行步骤5。
d. 拔出自环的网线，查看问题是否解决。如果未解决，则请执行步骤5。
e. 收集告警信息、日志信息和配置信息，并联系技术支持人员。
----结束
54.4 MSTP/4/MSTPLOG_PROLOST_ROOT_PRIMARY
日志信息
MSTP/4/MSTPLOG_PROLOST_ROOT_PRIMARY:MSTP process is no longer the root
bridge of the instance. (ProcessID=[ProcessID], InstanceID=[InstanceID])
日志含义
本桥不再是实例的根桥。
日志参数
参数名称 参数含义
ProcessID MSTP进程ID。
InstanceID 实例ID。
可能原因
原因1：网络拓扑发生变化，有新的链路加入。
原因2：网络拓扑有节点的优先级发生变化。
处理步骤
l 原因1：网络拓扑发生变化，有新的链路加入。
a. 请检查新加入的物理链路是否是需要的物理链路。
n 如果是需要的物理链路，则请执行步骤2。
n 如果是不需要的物理链路，则请执行步骤3。
b. 执行命令display stp [ process process-id ] [ instance instance-id ] [ interface
interface-type interface-number | slot slot-id ] [ brief ]查看各个端口是否符合协
议计算结果。
n 如果符合协议计算结果，则无需处理。
n 如果不符合协议计算结果，则请执行步骤4。
文档版本 06 (2017-09-12) 华为专有和保密信息 530
版权所有 © 华为技术有限公司
CloudEngine 12800系列交换机
日志参考 54 MSTP
c. 请正确部署网络拓扑，查看问题是否解决。如果未解决，请执行步骤4。
d. 请收集告警信息、日志信息和配置信息，并联系技术支持人员。
l 原因2：网络拓扑有节点的优先级发生变化。
a. 执行命令display stp [ process process-id ] [ instance instance-id ] [ interface
interface-type interface-number | slot slot-id ] [ brief ]检查网络拓扑中优先级更
改操作是否是正常操作。
n 如果是正常操作，则无需处理。
n 如果是非正常操作，则请执行步骤2。
b. 请在系统视图下执行命令stp [ instance instance-id ] priority priority，根据实
际需要重新配置本桥的优先级，或者执行命令undo stp [ instance instance-id ]
priority、undo stp [ instance instance-id ] root将桥优先级还原成缺省值。查看
问题是否解决。如果未解决，请执行步骤3。
c. 请收集告警信息、日志信息和配置信息，并联系技术支持人员。
----结束
54.5 MSTP/4/MSTPLOG_PROPORT_BPDU_GUARDED
日志信息
MSTP/4/MSTPLOG_PROPORT_BPDU_GUARDED:The MSTP process's edge port with
BPDU protection enabled will be shut down, because it received a BPDU packet.
(ProcessID=[ProcessID], PortID=[PortID], IfIndex=[IfIndex], PortName=[PortName])
日志含义
使能BPDU保护功能的边缘端口上收到了BPDU报文，将被shutdown。
日志参数
参数名称 参数含义
ProcessID MSTP进程ID。
PortID 端口ID。
IfIndex 端口索引。
PortName 端口名称。
可能原因
原因1：使能BPDU保护功能的边缘端口上收到了BPDU报文。
处理步骤
l 原因1：使能BPDU保护功能的边缘端口上收到了BPDU报文。
a. 请查看端口是否应该被规划为边缘端口。
n 如果应该被规划为边缘端口，则请执行步骤2。
n 如果不应该规划为边缘端口，则请执行步骤3。
文档版本 06 (2017-09-12) 华为专有和保密信息 531
版权所有 © 华为技术有限公司
CloudEngine 12800系列交换机
日志参考 54 MSTP
b. 请检查端口上BPDU报文的来源，确认是否有恶意攻击。
n 如果有恶意攻击，则请执行步骤4。
n 如果没有恶意攻击，则请执行步骤3。
c. 在接口视图下，执行命令undo stp edged-port和undo shutdown去除边缘端口
配置，重新启用端口，查看问题是否解决。如果未解决，请执行步骤4。
d. 请收集告警信息、日志信息和配置信息，并联系技术支持人员。
----结束
54.6 MSTP/4/MSTPLOG_PROPORT_LOOP_GUARDED
日志信息
MSTP/4/MSTPLOG_PROPORT_LOOP_GUARDED:The loop protection port in the
instance of the MSTP process did not receive BPDU packets within prescriptive time.
(ProcessID=[ProcessID], InstanceID=[InstanceID], PortID=[PortID], IfIndex=[IfIndex],
PortName=[PortName], PwName=[PwName])
日志含义
启用了环路保护的端口在规定时间内没有收到BPDU报文。
日志参数
参数名称 参数含义
ProcessID MSTP进程ID。
InstanceID 实例ID。
PortID 端口ID。
IfIndex 端口索引。
PortName 端口名称。
PwName PW名称。
可能原因
原因1：对端设备的生成树功能被关闭。
原因2：与对端相连的链路拥塞。
处理步骤
l 原因1：对端设备的生成树功能被关闭。
a. 请在相邻设备上执行命令display stp [ process process-id ] [ instance instance-
id ] [ interface interface-type interface-number | slot slot-id ] [ brief ]，检查相邻
设备端口上STP功能是否关闭。
n 如果相邻设备端口上STP功能关闭，则请执行步骤2。
n 如果相邻设备端口上STP功能未关闭，则请执行步骤3。
文档版本 06 (2017-09-12) 华为专有和保密信息 532
版权所有 © 华为技术有限公司
CloudEngine 12800系列交换机
日志参考 54 MSTP
b. 请在接口视图下执行命令stp enable，使能STP功能，查看问题是否解决。如
果未解决，请执行步骤3。
c. 请收集告警信息、日志信息和配置信息，并联系技术支持人员。
l 原因2：与对端相连的链路拥塞。
a. 请检查本设备与相邻设备间的链路是否有链路拥塞。
n 如果拥塞，则请执行步骤2。
n 如果未拥塞，则请执行步骤3。
b. 请正确修复设备间的链路，查看问题是否解决。如果未解决，请执行步骤3。
c. 请收集告警信息、日志信息和配置信息，并联系技术支持人员。
----结束
54.7 MSTP/4/MSTPLOG_PROPORT_ROOT_GUARDED
日志信息
MSTP/4/MSTPLOG_PROPORT_ROOT_GUARDED:The root protection port of the
instance of the MSTP process received a superior message. (ProcessID=[ProcessID],
InstanceID=[InstanceID], PortID=[PortID], IfIndex=[IfIndex], PortName=[PortName],
PwName=[PwName])
日志含义
MSTP进程实例中启用了根保护功能的端口上收到了优先级较高的消息。
日志参数
参数名称 参数含义
ProcessID MSTP进程ID。
InstanceID 实例ID。
PortID 端口ID。
IfIndex 端口索引。
PortName 端口名称。
PwName PW名称。
可能原因
原因1：配置了根保护的指定端口收到了比本桥优先级高的BPDU报文。
原因2：网络拓扑有节点优先级发生变化。
处理步骤
l 原因1：配置了根保护的指定端口收到了比本桥优先级高的BPDU报文。
a. 请检查新加入的物理链路是否是需要的物理链路。
文档版本 06 (2017-09-12) 华为专有和保密信息 533
版权所有 © 华为技术有限公司
CloudEngine 12800系列交换机
日志参考 54 MSTP
n 如果新加入的物理链路是需要的物理链路，则请执行步骤2。
n 如果新加入的物理链路不是需要的物理链路，则请执行步骤3。
b. 执行命令display stp [ process process-id ] [ instance instance-id ] [ interface
interface-type interface-number | slot slot-id ] [ brief ]查看各个端口是否符合协
议计算结果。
n 如果各个端口符合协议计算结果，则无需处理。
n 如果各个端口不符合协议计算结果，则请执行步骤4。
c. 请正确部署网络拓扑，查看问题是否消除。如果未消除，则请执行步骤4。
d. 执行命令display stp [ process process-id ] [ instance instance-id ] [ interface
interface-type interface-number | slot slot-id ] [ brief ]查看网络中是否有端口被
规划为根保护端口。
n 如果有端口被规划为根保护端口，则请执行步骤5。
n 如果没有端口被规划为根保护端口，则请执行步骤6。
e. 在接口视图下，执行命令undo stp root-protection去除根保护配置，查看告警
是否消除。如果未消除，则请执行步骤6。
f. 请收集告警信息、日志信息和配置信息，并联系技术支持人员。
l 原因2：网络拓扑有节点优先级发生变化。
a. 执行命令display stp [ process process-id ] [ instance instance-id ] [ interface
interface-type interface-number | slot slot-id ] [ brief ]查看网络拓扑中优先级的
更改操作是否是正常操作。
n 如果是正常操作，则请执行步骤3。
n 如果不是正常操作，则请执行步骤2。
b. 请在系统视图下执行命令stp [ instance instance-id ] priority priority，根据实
际需要重新配置本桥的优先级。或者执行命令undo stp [ instance instance-id ]
priority、undo stp [ instance instance-id ] root将桥优先级还原成缺省值。查看
告警是否消除。如果告警未消除，则请执行步骤3。
c. 执行命令display stp [ process process-id ] [ instance instance-id ] [ interface
interface-type interface-number | slot slot-id ] [ brief ]查看网络中是否有端口被
规划为根保护端口。
n 如果有端口被规划为根保护端口，则请执行步骤4。
n 如果没有端口被规划为根保护端口，则请执行步骤5。
d. 在接口视图下，执行命令undo stp root-protection去除根保护配置，查看问题
是否消除。如果未消除，则请执行步骤5。
e. 请收集告警信息、日志信息和配置信息，并联系技术支持人员。
----结束
54.8 MSTP/4/MSTPLOG_PROROOT_CHANGED
日志信息
MSTP/4/MSTPLOG_PROROOT_CHANGED:The root bridge of MSTP process changed.
(ProcessID=[ProcessID], InstanceID=[InstanceID], RootPortName=[PortName],
PreviousRootBridgeID=[PreRootBridgeID], NewRootBridgeID=[NewRootBridgeID],
RootPwName=[PwName])
文档版本 06 (2017-09-12) 华为专有和保密信息 534
版权所有 © 华为技术有限公司
CloudEngine 12800系列交换机
日志参考 54 MSTP
日志含义
MSTP进程的根桥发生变化。
日志参数
参数名称 参数含义
ProcessID MSTP进程ID。
InstanceID 实例ID。
RootPortName 根端口名称。
PreviousRootBridgeID 原来的根桥ID。
NewRootBridgeID 新根桥ID。
RootPwName 根PW端口名称。
可能原因
原因1：新加入了设备，该设备的桥ID最小。
原因2：修改了原有网络中设备的优先级或域配置。
处理步骤
l 原因1：新加入了设备，该设备的桥ID最小。
a. 请检查新加入的物理链路是否是需要的物理链路。
n 如果是需要的物理链路，则请执行步骤2。
n 如果不是需要的物理链路，则请执行步骤3。
b. 在新加入的设备上，执行命令display stp [ process process-id ] [ instance
instance-id ] [ interface interface-type interface-number | slot slot-id ] [ brief ]查看
桥ID是否为整个网络最小。
n 如果是整个网络最小，则请执行步骤3。
n 如果不是整个网络最小，则请执行步骤5。
c. 请确认新加入设备的桥ID是否应该规划为整网中最小ID。
n 如果应该规划为整网中最小ID，则无需处理。
n 如果不应该规划为整网中最小ID，则请执行步骤4。
d. 请按照网络拓扑正确配置。查看问题是否消除。如果未消除，则请执行步骤
5。
e. 请收集告警信息、日志信息和配置信息，并联系技术支持人员。
l 原因2：修改了原有网络中设备的优先级或域配置。
a. 执行命令display stp [ process process-id ] [ instance instance-id ] [ interface
interface-type interface-number | slot slot-id ] [ brief ]查看该实例的优先级向量
或者域配置的更改是否是正常操作。如果不是正常操作，则请执行步骤2。
b. 请按照网络拓扑正确配置，查看问题是否消除。如果未消除，则请执行步骤
3。
c. 请收集告警信息、日志信息和配置信息，并联系技术支持人员。
----结束
文档版本 06 (2017-09-12) 华为专有和保密信息 535
版权所有 © 华为技术有限公司
CloudEngine 12800系列交换机
日志参考 54 MSTP
54.9 MSTP/4/MSTPLOG_PROTC_GUARDED
日志信息
MSTP/4/MSTPLOG_PROTC_GUARDED:With the TC protection enabled, if TC BPDUs
were received after the number of TC BPDUs received by an instance exceeded the threshold,
these TC BPDUs were processed after the TC protection time expires.
(ProcessID=[ProcessID], InstanceID=[InstanceID])
日志含义
MSTP进程上收到的超过阈值的TC消息将被延迟到TC保护时间超时后处理。
日志参数
参数名称 参数含义
ProcessID MSTP进程ID。
InstanceID 实例ID。
可能原因
原因1：MSTP进程单位时间内收到的TC消息超过了TC保护的阈值。
处理步骤
l 原因1：MSTP进程单位时间内收到的TC消息超过了TC保护的阈值。
a. 请检查是否有网络拓扑振荡。
n 如果有网络拓扑振荡，则请执行步骤3。
n 如果没有网络拓扑振荡，则请执行步骤2。
b. 请执行命令display stp [ process process-id ] [ instance instance-id ] [ interface
interface-type interface-number | slot slot-id ] [ brief ]查看端口上TC报文计数是
否超过设置的阈值。
n 如果端口上TC报文计数超过设置的阈值，则请执行步骤4。
n 如果端口上TC报文计数没有超过设置的阈值，则请执行步骤7。
c. 请检查网络拓扑振荡的原因并修复。查看问题是否消除。如果未消除，则请
执行步骤2。
d. 在MSTP进程视图下执行命令stp tc-protection threshold threshold，重新设置
MSTP进程处理TC类型BPDU报文的数量。查看问题是否消除。如果未消除，
则请执行步骤5。
e. 请确认是否存在恶意攻击。
n 如果存在恶意攻击，则请执行步骤6。
n 如果不存在恶意攻击，则请执行步骤7。
f. 请找出攻击源并进行排除，查看问题是否消除。如果未消除，则请执行步骤
7。
文档版本 06 (2017-09-12) 华为专有和保密信息 536
版权所有 © 华为技术有限公司
CloudEngine 12800系列交换机
日志参考 54 MSTP
g. 请收集告警信息、日志信息和配置信息，并联系技术支持人员。
----结束
文档版本 06 (2017-09-12) 华为专有和保密信息 537
版权所有 © 华为技术有限公司
CloudEngine 12800系列交换机
日志参考 55 ND
55