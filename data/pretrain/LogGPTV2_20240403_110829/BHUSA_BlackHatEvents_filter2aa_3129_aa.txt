#BHUSA @BlackHatEvents
The Battle Against the Billion-Scale Internet 
Underground Industry: Advertising Fraud Detection 
and Defense 
Zheng Huang | Chief Architect of Security Department, Baidu
Shupeng Gao | Senior Security Researcher, Baidu
Yakun Zhang | Senior Security Researcher, Baidu
Hai Yang | Senior Security Researcher, Baidu
Jie Gao | Senior Security Researcher, Baidu
#BHUSA @BlackHatEvents
Information Classification: General
Agenda
• Background
• Advertising fraud and anti-fraud
• In-depth analysis of typical cases
• Crowd and key tech analysis 
• Detection and defense
• Summary and recommendations
#BHUSA @BlackHatEvents
Information Classification: General
Advertising 
Alliance
Platform
Advertiser
Advertiser
Advertiser
Website
APP
We Media
Mini Program
Advertising Style
splash 
ad
news 
feed ad
banner 
ad
incentive 
video ad
Background
H5 ad
#BHUSA @BlackHatEvents
Information Classification: General
CPC (Cost Per Click)
OCPC (Optimized Cost 
per Click)
CPM (Cost Per Mille)
CPA (Cost Per Action)
PV (Page View)
Advertising 
Alliance
one 
hundred 
thousand
advertiser
one 
hundred 
thousand
APP
a billion 
MAU
Advertising 
Alliance
Advertising 
Alliance
Advertising 
Alliance
Background
#BHUSA @BlackHatEvents
Information Classification: General
Agenda
• Background
• Advertising fraud and anti-fraud
• In-depth analysis of typical cases
• Crowd and key tech analysis 
• Detection and defense
• Summary and recommendations
#BHUSA @BlackHatEvents
Information Classification: General
Advertising 
Alliance
Platform
Advertiser
Advertiser
Advertiser
Website
APP
We Media
Mini Program
Advertising Style
splash 
ad
news 
feed ad
banner 
ad
incentive 
video ad
Advertising fraud and anti-fraud
H5 ad
1
2
3
#BHUSA @BlackHatEvents
Information Classification: General
Agenda
• Background
• Advertising fraud and anti-fraud
• In-depth analysis of typical cases
• Crowd and key tech analysis 
• Detection and defense
• Summary and recommendations
#BHUSA @BlackHatEvents
Information Classification: General
• A data analysis company, well trusted by many developers
• Their SDK was merged into many popular APPs
• The big data analysis SDK loading malware DEX dynamic from network
CASE 1: Malware in mobile big data analysis SDK
In-depth analysis of typical cases
#BHUSA @BlackHatEvents
Information Classification: General
Server A
Server B
Server C
Server D
Server E
patch.jar
① Request latest patch.
req hotpatch
req cloudZ.jar
cloudZ.jar
② Request step1 jar. 
(encrypted, needs 
decrypt and 
decompress)
cloudL
cloudE
encoded
decode
③ Include two resources. 
“cloudE” jar decodes 
“cloudL”.
cloudE.jar
req plugin
plugE.jar
req script
auto-click script
④ Request plugin jar. ⑤ Get auto-click script 
and parameters.
CASE 1: Malware in mobile big data analysis SDK
In-depth analysis of typical cases
#BHUSA @BlackHatEvents
Information Classification: General
• Download config, inject auto-click script into invisible webview, scroll, wait, click…
Invisible
webview
CASE 1: Malware in mobile big data analysis SDK
dispatch 
task
In-depth analysis of typical cases
#BHUSA @BlackHatEvents
Information Classification: General
• Use ActivityContainer technology
- Hook ActivityThread start Activity invisible
- Hook IWindowSession proxy sWindowSession
- Custom WindowManager and ViewRootImpl
- Cut off WindowManager with PhoneWindow
• Load native advertise in invisible activity
- Simulate user interaction to click on an ad
- Misleading users to click on ads
- Transfer user interaction to activity
CASE 1: Malware in mobile big data analysis SDK
In-depth analysis of typical cases
#BHUSA @BlackHatEvents
Information Classification: General
Popular Mobile Apps
Mobile advertising 
platforms
Advertising 
monetization 
platforms
Well-known big-
data analysis 
company
Media
Profit channel
Well-known 
application 
development 
companys
C&C Server
Sale channels
Provide backdoor
Provide Sdk
Using invisible webview and activity
Automatically click for ad fraud
CASE 1: Malware in mobile big data analysis SDK
Dispatch 
backdoor
Customs
In-depth analysis of typical cases
#BHUSA @BlackHatEvents
Information Classification: General
Case 2: malware in PC bundled software installer 
In-depth analysis of typical cases
#BHUSA @BlackHatEvents
Information Classification: General
Case 2: malware in PC bundled software installer 
In-depth analysis of typical cases
#BHUSA @BlackHatEvents
Information Classification: General
Case 2: malware in PC bundled software installer 
In-depth analysis of typical cases
#BHUSA @BlackHatEvents
Information Classification: General
Case 2: malware in PC bundled software installer 
In-depth analysis of typical cases
Hijack user’s 
browser, using 
JSONP api to add 
fans to wemedia
#BHUSA @BlackHatEvents
Information Classification: General
Case 2: malware in PC bundled software installer 
In-depth analysis of typical cases
Hijack user’s browser, 
replace/add profit 
channel in request
#BHUSA @BlackHatEvents
Information Classification: General
Case 3: Variety of malicious ad click tools
In-depth analysis of typical cases
#BHUSA @BlackHatEvents
Information Classification: General
JingYi web browser library in EPL (Easy 
Programming Language) , based on
miniblink, support simulation:
- navigator.maxTouchPoints
- navigator.platform
-navigator.hardwareConcurrency
- screen.height
- screen.availWidth
- screen.availHeight
- screen.pixelDepth
- touch screen
- useragent
In-depth analysis of typical cases
Case 3: Variety of malicious ad click tools
#BHUSA @BlackHatEvents
Information Classification: General
Case 3: Variety of malicious ad click tools
In-depth analysis of typical cases
#BHUSA @BlackHatEvents
Information Classification: General
Captain module in EPL (Easy 
Programming Language)：
- Tag as China Puppeteer
- Free, stable, open source
- Various camouflages: UA, 
geolocation, mobile mode, screen size, 
device orientation, cpu throttling, touch 
support
- Fingerprint plugins disguise browser 
fingerprints
- Support javascript injection
- Manual-grade keyboard and mouse, 
not system commands but chrome 
commands
In-depth analysis of typical cases
Case 3: Variety of malicious ad click tools
#BHUSA @BlackHatEvents
Information Classification: General
• mobile version keypress genius software integrated with Android simulator
In-depth analysis of typical cases
Case 3: Variety of malicious ad click tools
#BHUSA @BlackHatEvents
Information Classification: General
Case 3: Variety of malicious ad click tools
In-depth analysis of typical cases
#BHUSA @BlackHatEvents
Information Classification: General
Agenda
• Background
• Advertising fraud and anti-fraud
• In-depth analysis of typical cases
• Crowd and key tech analysis
• Detection and defense
• Summary and recommendations
#BHUSA @BlackHatEvents
Information Classification: General
Crowd analysis on underground industry practitioners
• High-level underground industry group characteristic
- Corporatized operation, dozens to hundreds of people involved
- Some of them have registered a large number of companies
- They claim to be advertising monetization platforms, SSP platforms
- Some of them Wearing the coat of a high-tech company
- The underground industrial chain has a clear division of labor
- Cheat technology develop, malware, profit channels are separated
- Strong technical ability and high intensity of anti analysis and detection
- Huge profit scale, huge infected user base, and bad social impact
Crowd and key tech analysis 
#BHUSA @BlackHatEvents
Information Classification: General
Crowd analysis on underground industry practitioners
• Low-level underground industry group characteristic
- Individual or small team, small scale group 
- Mostly their education level are junior high school and high school
- Skilled in writing script: python, nodejs, ruby, EPL, MQ, etc.
- Weak legal awareness, no fear, no rules, most of them are poor
- Low technical ability, but very diligent in order to make a profit
- They produce tools that sell for less and don't make much profit
- They also have a technology exchange, tool procurement ecosystem
- They can also lead to massive damage and bad social impact
Crowd and key tech analysis 
#BHUSA @BlackHatEvents
Information Classification: General
Tech analysis on underground industry practitioners
• High-level underground industry group technology summarize
• Mobile Phone Platform
- Reverse engineering and repackage/wrap ad platform SDK
- Anti-debugging, anti-analysis, obfuscation, dynamic loading of dex/jar
- Highly custom developed webview, usually using JSBridge for control
- Using backdoors to control the phones of a large number of real users
- Some gangs could silently rooting user's phone with android exploits
- Invisible ad presentation and automatic click simulation
•
PC Platform
- Highly customized browsers or browser extensions hijack and modify traffic
- Some gangs use drivers or local proxies to hijack and modify traffic
Crowd and key tech analysis 
#BHUSA @BlackHatEvents
Information Classification: General
Tech analysis on underground industry practitioners
• Low-level underground industry group technology summarize
- Using PC simulation mobile phone：Chrome F12 device emulator
- Using PC browser library：CEFSharp，CEF，minibrowser
- Headless/ automated browser：Puppeteer，Selenium，Playwright
- Cloud mobile phone with automatic operation plug-in
- Group control mobile phone, proxy server, VPN
- Key Press Genius：PC & mobile
- Flow Wizard(流量精灵)、 Flow treasure(流量宝)
Crowd and key tech analysis 
#BHUSA @BlackHatEvents
Information Classification: General
Agenda
• Background
• Advertising fraud and anti-fraud
• In-depth analysis of typical cases
• Crowd and key tech analysis 
• Detection and defense
• Summary and recommendations
#BHUSA @BlackHatEvents
Information Classification: General
About Project Heracles
• Vision/Motivation
- To identify and separate typical cheating and fraudulent traffic
- Track and trace ad-fraud underground industry practitioners
• Detection targets
- All technology involved in high-level and low-level groups
• Who is the main R&D
- Security researchers
• Execution path
- Fingerprint? Information leak?
Detection and defense
#BHUSA @BlackHatEvents
Information Classification: General