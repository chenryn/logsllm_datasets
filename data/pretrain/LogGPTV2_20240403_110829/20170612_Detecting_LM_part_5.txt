When Execution is Successful
Points to be Confirmed
Log Generation Additional
Communication Log Type and Name Acquired Information Details
Location Settings
Event ID: 4688 (A new process has been created)
4689 (A process has exited)
- Process Information -> Process Name: "[File Name (PwDump7.exe)]"
Event Log
- Points to be Confirmed
- Required
- Process Start/End Time and Date: Log Date
Security
- Name of User Who Executed the Process: Subject -> Account Name
- Domain of User Who Executed the Process: Subject -> Account Domain
- Presence of Privilege Escalation at Process Execution: Process Information -> Token Escalation Type
- Process Return Value: Process Information -> Exit Status
Event ID: 1 (Process Create)
Host
- 5 (Process Terminated)
(Windows)
- Image: "[File Name (PwDump7.exe)]"
Event Log
- - Confirmable Information Required
Sysmon - Process Start/End Time and Date (UTC): UtcTime
- Process Command Line: CommandLine *The used option is recorded as an argument.
- User Name: User
- Process ID: ProcessId
File name:
Execution History C:\Windows\Prefetch\[Executable File(PWDUMP7.EXE)]-[RANDOM].pf
- -
- Confirmable Information (the following can be confirmed using this tool: WinPrefetchView)
Prefetch
- Last Execution Time and Date: Last Execution Time
Remarks
Additional Event Logs That Can Be Output -
26
3.3.2. PWDumpX
Basic Information
Tool Name PWDumpX Legend
Category Password and Hash Dump - Acquirable
Tool Overview Acquires a password hash from a remote host Information
Tool - Event ID/Item Name
Example of This tool uses the acquired hash to perform attacks such as pass-the-hash.
- Field Name
Presumed Tool Use - Source host: PWDumpX execution source
- "Field Value"
During an Attack - Destination host: The destination logged in by PWDumpX
- Source host: Standard user
Authority
- Destination host: Administrator
Targeted OS Windows
Operating
Domain Not required
Condition
Communication
135/tcp, 445/tcp
Protocol
Service -
- Both hosts: Execution history (Prefetch)
Information Standard Settings
- Destination host: The fact that the PWDumpX service has been installed and executed is recorded.
Acquired from
- The fact that the PWDumpX service has been sent from the source host to the destination host and then executed is recorded.
Log Additional Settings
- The fact that a text file is used to create and receive hash information is recorded.
Evidence That Can Be Confirmed
- Source host: If has been created, it is considered that it was successfully executed.
"[Path to Tool]\[Destination Address]-PWHashes.txt"
When Execution is Successful
Points to be Confirmed
Log Generation Additional
Communication Log Type and Name Acquired Information Details
Location Settings
Event ID: 4688 (A new process has been created)
4689 (A process has exited)
- Process Information -> Process Name: " [File Name (PWDumpX.exe)]"
- Confirmable Information
- Process Start/End Time and Date: Log Date
- Name of User Who Executed the Process: Subject -> Account Name
- Domain of User Who Executed the Process: Subject -> Account Domain
- Presence of Privilege Escalation at Process Execution: Process Information -> Token Escalation Type
- Process Return Value: Process Information -> Exit Status
A temporary file is created.
Event ID: 4663 (An attempt was made to access an object)
- Process Information -> Process Name: " [File Name (PWDumpX.exe)]"
- Object -> Object Name: "[Path to Tool]\[Destination Address]-PWHashes.txt"
*Data is written to the above file multiple times.
Event Log
- Required
Security
Event ID: 4663 (An attempt was made to access an object)
- Process Information -> Process Name: " [File Name (PWDumpX.exe)]"
- Object -> Object Name: "[Path to Tool]\[Destination Address]-PWHashes.txt.Obfuscated"
- Confirmable Information
- Handle ID: Object -> Handle ID *Used for association with other logs.
*Data is written to the above file multiple times.
Source host
The temporary file is deleted.
Event ID: 4663 (An attempt was made to access an object)
- Process Information -> Process Name: " [File Name (PWDumpX.exe)]"
- Object -> Object Name: "[Path to Tool]\[Destination Address]-PWHashes.txt.Obfuscated"
- Confirmable Information
- Handle ID: Object -> Handle ID *Used for association with other logs.
- Process Details: Access Request Information -> Access ("DELETE")
OS: Windows
user
↓ Event ID: 1 (Process Create)
OS: Windows 5 (Process Terminated)
administrator - Image: " [File Name (PWDumpX.exe)]"
Event Log
- - Confirmable Information Required
Sysmon - Process Start/End Time and Date (UTC): UtcTime
- Process Command Line: CommandLine *The destination host or used account is taken as an argument.
- User Name: User
- Process ID: ProcessId
File name:
Execution History C:\Windows\Prefetch\[File Name (PWDUMPX.EXE)]-[File Name].pf
- -
- Confirmable Information (the following can be confirmed using this tool: WinPrefetchView)
Prefetch
- Last Execution Time and Date: Last Execution Time
Event ID: 4688 (A new process has been created)
4689 (A process has exited)
- Process Information -> Process Name: "[File Name (DumpSvc.exe)]"
- Confirmable Information
- Process Start/End Time and Date: Log Date
- Name of User Who Executed the Process: Subject -> Account Name
- Domain of User Who Executed the Process: Subject -> Account Domain
- Presence of Privilege Escalation at Process Execution: Process Information -> Token Escalation Type
- Process Return Value: Process Information -> Exit Status
Event Log
Event ID: 5145 (A network share object was checked to see whether client can be granted desired access)
Destination host - Required
- Network Information -> Source Address: "[Source host]"
Security
- Shared Information -> Share Name: "\\*\ADMIN$"
- Shared Information -> Relative Target Name: "system32\DumpSvc.exe"/"system32\DumpExt.dll"
Event ID: 4663 (An attempt was made to access an object)
- Process Information -> Process Name: "C:\Windows\System32\lsass.exe"
- Object -> Object Name: "C:\Windows\System32\PWHashes.txt"
"C:\Windows\System32\PWHashes.txt.Obfuscated"
- Confirmable Information
- Handle ID (Used for Association with Other Logs): Object -> Handle ID
*Data is written to the above file multiple times.
27
Log Generation Additional
Communication Log Type and Name Acquired Information Details
Location Settings
Event ID: 4663 (An attempt was made to access an object)
- Process Information -> Process Name: "C:\Windows\System32\lsass.exe"
Event Log
- Object -> Object Name: "C:\Windows\System32\PWHashes.txt.Obfuscated"/"C:\Windows\System32\PWHashes.txt"
-
"C:\Windows\System32\DumpExt.dll" "C:\Windows\System32\DumpSvc.exe"
Security / Required
(Continued from the
- Confirmable Information
previous entry)
- Handle ID: Object -> Handle ID *Used for association with other logs.
- Process Details: Access Request Information -> Access ("DELETE")
Event ID: 1 (Process Create)
5 (Process Terminated)
- Image: "C:\Windows\System32\DumpSvc.exe"
- Confirmable Information
- Process Start/End Time and Date (UTC): UtcTime
Event Log
OS: Windows
- Process Command Line: CommandLine
- Required
user - User Name: User
Sysmon
↓ - Process ID: ProcessId
Destination host
OS: Windows
(Continued from the
administrator
previous entry)
(Continued from Event ID: 8 (CreateRemoteThread detected:)
- Image: "C:\Windows\System32\DumpSvc.exe"
the previous
- TargetImage: "C:\Windows\System32\lsass.exe"
entry)
Event ID: 7045 (A service was installed in the system)
- Service Name: ("PWDumpX Service")
- Service File Name: "%windir%\system32\DumpSvc.exe")
Event Log (
- -
System
Event ID: 7036 (The [Service Name] service entered the [Status] state)
- Service Name: ("PWDumpX Service")
* The "PWDumpX Service" service enters the "Executing" state before executing a remote process, and
enters the "Stopped" state after the execution.
File name:
C:\Windows\Prefetch\DUMPSVC.EXE-DB3A90FA.pf
Execution History
-
Prefetch - Confirmable Information (the following can be confirmed using this tool: WinPrefetchView)
- Last Execution Time and Date: Last Execution Time
Remarks
Additional Event Logs That Can Be Output -
28
3.3.3. Quarks PwDump
Basic Information
Tool Name Quarks PwDump Legend
Category Password and Hash Dump - Acquirable
Acquires the NTLM hash of a local domain account and cached domain password. Information
Tool Overview
Tool Information in a machine including NTDS.DIT files can be specified and analysed. - Event ID/Item Name
Example of Presumed - Field Name
Tool Use During an This tool is used to perform logon authentication on other hosts using the acquired hash information. - "Field Value"
Attack
Authority Administrator
Targeted OS Windows
Operating Domain Not required
Condition Communication
-
Protocol
Service -
Information Standard Settings - Execution history (Prefetch)
Acquired from - Execution history (Sysmon / audit policy)
Additional Settings
Log - A record that the temporary file ("SAM-[Random Number].dmp") has been created
Evidence That Can Be Confirmed
- A temporary file ("SAM-[Random Number].dmp") was created and deleted.
When Execution is Successful
Points to be Confirmed
Log Generation Additional
Communication Log Type and Name Acquired Information Details
Location Settings
Event ID: 4688 (A new process has been created)
4689 (A process has exited)
- Process Information -> Process Name: "[File Name (QuarksPwDump.exe)]"
- Confirmable Information
- Process Start/End Time and Date: Log Date
- Name of User Who Executed the Process: Subject -> Account Name
- Domain of User Who Executed the Process: Subject -> Account Domain
- Presence of Privilege Escalation at Process Execution: Process Information -> Token Escalation Type
- Process Return Value: Process Information -> Exit Status *"0x0" if successful, or
another value if failed.
Event ID: 4656 (A handle to an object was requested)
4663 (An attempt was made to access an object)
4658 (The handle to an object was closed)
- Process Information -> Process Name: "[File Name (QuarksPwDump.exe)]"
Event Log
- Required
- Confirmable Information
Security
- Targeted File: Object -> Object Name "C:\Users\[User Name]\AppData\Local\Temp\SAM-[Random Number].dmp"
( )
- Handle ID: Object -> Handle ID *Used for association with other logs.
- Process Details: Access Request Information -> Access ("WriteData (or AddFile)")
Event ID: 4656 (A handle to an object was requested)
4660 (An object was deleted)
Host
- 4658 (The handle to an object was closed)
(Windows)
- Process Information -> Process Name: "[File Name (QuarksPwDump.exe)]"
- Process Information -> Process ID: "[Process ID of the Tool]"
- Object -> Object Name: "C:\Users\[User Name]\AppData\Local\Temp\SAM-[Random Number].dmp"
- Confirmable Information
- Handle ID: Object -> Handle ID *Used for association with other logs.
- Requested Process: Access Request Information -> Access / Reason for Access ("DELETE")
- Success or Failure: Keywords ("Audit Success")
Event ID: 1 (Process Create)
5 (Process Terminated)
- Image: "[File Name (QuarksPwDump.exe)]"
Event Log
- - Confirmable Information Required
Sysmon - Process Start/End Time and Date (UTC): UtcTime
- Process Command Line: CommandLine *The specified option (the type of the acquired password) is recorded as an argument.
- User Name: User
- Process ID: ProcessId
File name:
Execution History C:\Windows\Prefetch\[File Name (QUARKSPWDUMP.EXE)]-[RANDOM].pf
- -
- Confirmable Information (the following can be confirmed using this tool: WinPrefetchView)
Prefetch
- Last Execution Time and Date: Last Execution Time
Remarks
Additional Event Logs That Can Be Output -
29
3.3.4. Mimikatz (Obtaining Password Hash)
Basic Information
mimikatz > sekurlsa::logonpasswords Legend
Tool Name
mimikatz > lsadump::sam -Acquirable
Category Password and Hash Dump Information
Tool Tool Overview Steals recorded authentication information -Event ID/Item Name
Example of Presumed -Field Name
Tool Use During an This tool is executed to acquire passwords or escalate the privileges to the domain Administrator privileges. -"Field Value"
Attack
Authority Administrator
Targeted OS Windows
Operating Domain Not required
Condition Communication
-
Protocol
Service -
Information Standard Settings - Execution history (Prefetch)
Acquired from Additional Settings - Execution history (Sysmon / audit policy)
Evidence That Can Be Confirmed
The successful execution of the tool cannot be determined from event logs or execution history.
When Execution is Successful
Points to be Confirmed
Log Generation Additional
Communication Log Type and Name Acquired Information Details
Location Settings
Event ID: 4688 (A new process has been created)
4689 (A process has exited)
- Process Information -> Process Name: "[File Name (mimikatz.exe)]"
Event Log
- Confirmable Information
- Required
- Process Start/End Time and Date: Log Date
Security
- Name of User Who Executed the Process: Subject -> Account Name
- Domain of User Who Executed the Process: Subject -> Account Domain
- Presence of Privilege Escalation at Process Execution: Process Information -> Token Escalation Type
- Process Return Value: Process Information -> Exit Status
Event ID: 1 (Process Create)
Host
- 5 (Process Terminated)
(Windows)
- Image: "[File Name (mimikatz.exe)]"
Event Log
- - Confirmable Information Required
Sysmon - Process Start/End Time and Date (UTC): UtcTime
- Process Command Line: CommandLine *The used option is recorded as an argument.
- User Name: User
- Process ID: ProcessId
File name:
Execution History C:\Windows\Prefetch\[Executable File(MIMIKATZ.EXE)]-[RANDOM].pf
- -
- Confirmable Information (the following can be confirmed using this tool: WinPrefetchView)
Prefetch
- Last Execution Time and Date: Last Execution Time
Remarks
Additional Event Logs That Can Be Output -
30
3.3.5. Mimikatz (Obtaining Ticket)
Basic Information
Tool Name mimikatz > sekurlsa::tickets Legend
Category Password and Hash Dump -Acquirable
Tool Overview Acquires tickets for all sessions in a host Information
Tool -Event ID/Item Name
Example of
-Field Name
Presumed Tool Use This tool is used to acquire tickets to remotely execute a command.
-"Field Value"
During an Attack
Authority Administrator
Targeted OS Windows
Operating Domain Not required
Condition Communication
-
Protocol
Service -
Information Standard Settings - Execution history (Prefetch)
Acquired from Additional Settings - Execution history (Sysmon / audit policy) *The fact that a file that output a ticket was generated is recorded.
Evidence That Can Be Confirmed
- If a file that output a ticket is generated, it is considered that the process was successful.