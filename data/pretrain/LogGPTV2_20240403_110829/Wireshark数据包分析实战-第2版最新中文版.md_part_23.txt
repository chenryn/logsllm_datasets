（攻击者截获流量）
172.16.0.1位于00:25:b3:bf:91:ee
00:21:70:c0:56:0
00:21
00:21:70:c0:56:f0
00:25.b3:bf:91:ee
目的MAC
目的MAC
源MAC
:cO:56:f0
00:21:70:c0:56f0
受害者
(Dell)
受害者
---
## Page 243
10.2.3
远程访问特洛伊木马
anter
BInt
571906795172.160.107e560742595.147H
国
国
Total
versfon:4
Source:
Protocol:TCP（6）
verston:
在下一个案例中，
He
checksum:
ONOZ
De11
1.
rotoc0）.5r172.16.0:107(172.16.0.107）.0:4.125.95.1(4125.5142)
offset:0
172
otocol.
图10-18
CDont
16.0.
cisco
946
888
52
:1726.0.107（1721601071529
88820
88
Del
31
0:95:03
:07
1998
MAC地址的变化说明这次攻击是成物的
ZA33
我们将像分析真正的网络威胁一样，从一个简单的警报
0
(00:21:70
107
190托
_HTGET
56
8208
第10章安全领域的数据包分析229
g
0.0
---
## Page 244
注意
TCP TTL:128 T0S:0x0 ID:6526 IpLen:20 DgmLen:54 DF
[Classification:A Network Trojan was detected] [Priority:1]
[] [1:132456789:2) CyberEYE RAT Session Establishment **]
414E4142494C47497C时，就产生警报。这个内容转换成可读的ASCII码是
sid:132456789:rev:2;）
content:"
content:
机上的恶意应用程序，它连接到攻击者，使攻击者能远程管理受害者的机器。
程访问木马（Remote-access Trojan，RAT）的出现。RAT 是秘密运行在受害者计算
ANABILGI。当检测到这个字符串时，警报就会响起，这可能预示着CyberEYE远
其文字，表示“基本信息”的意思。
索Snort规则中提到的十六进制字符串，直接跳到关键部分。
这个规则是这样定义的：当它发现一个进入内网的数据包含有十六进制内容
下一步我们将查看触发此次警报的特征规则。
CyberEYE是来自土耳其的工具，用于产生RAT程序和管理“肉鸡”。有趣
898
2.选择HexValue单选按钮
1.选择Edit->Find Packet。
4.单击Find
3.
141
8p8
在文本框输入414E4142494C47497C。
10
SrC
A1
PorL:
8
443
7C1;
店
---
## Page 245
ZNameresolution
172.160114
172360.114
172360114
172160114
ep
72360.114
72160114
所示。
过查看Conversations 窗口的TCP标签，我们可以确认存在多个会话，如图10-20
据包。
1.在Packet List 面板上面的过滤器栏里，输入过滤器（tcpgsn=1）&
我们可以给捕获文件里的不同会话刷上不同颜色，将它们从视觉上分开。
4.
3.
17216.0111
sedpcap
172.160111
172360111
172.160111
172.16.0.111
172160311
选择TCP，然后选择一种颜色。
为剩下的SYN数据包重复这个过程，分别选择不同的颜色。
图10-20攻击者和受害者之间存在3个独立的会诺
12091537
TCPConvers
Lmttu dpyti
电
19
第10章安全领域的数据包分析231
酒
---
## Page 246
232Wireshark数据包分析实战（第2版）
Stmem.Contrnt
ENGLIM?
A
Liep
REEN60”O，并出现了6次。
KENGO
LNDO
选项。
®
29发起了一个新会话。
很快，我们看到攻击者给受害者发送了文本字符串“ANABILGI556”0
的开头部分通常就包含它。
图10-21第一个会话产生了有超的结果
ASEBCHoxDuCA
Filter Out Thas Sream
Llose
就能
---
## Page 247
alolowTCPSurn
SuremContent
S&BrntEntie coestin3 tyte
b.ty.
各个过滤器的数据点。
到这里，我们可以负责任地说，攻击者发起新会话是为了传输这个IPG图
4.将y轴的单位改成Bytes/Tick
图10-23显示了结果图像。
1.选择Statistics->IOGraphs.
tu
41.
图10-22攻击者发起了对一个JPG文件的请求
4:305-500000000000000000
o 
第10章安全领域的数据包分析239
Hr Oa h Sn
---
## Page 248
234Wireshark数据包分析实战（第2版）
bytes)
外的信息，
Wh10Ghe
3.选择SaveAs按钮保存数据，确保扩展名是jpg。
Color
导致它不能打开图片。
图10-23该图像显示同样活动重复了多次
Ftrtpstemegf
Fter
tp.stemeq
tcpsttemeg
mq3
40
60s
Style
Style Lioe
Style Linr
Style Line
5
Tick intalec
Unit
Yiewa tme of dey
Pils per ticc
V.A
100s
Auto
100000
50000
务
---
## Page 249
WinHex-(CAPSCREENp)
Pape1333
Drtiontene
CAPSCREENZpO
Dosnase
Feste
循的典型步骤。
无关数据
CAPSCR2JPG
Des
这些通信序列完成之后，
04/1/2011
04/11211
图10-24特洛伊木马增加的额外数据导致文件无法正确打开
101
100
品
00000000
ottsel
1
Ortses
口
图10-25移除JPG文件中的附加字节
020
88
通信就随着正常TCP拆除顺序而结束了
50
第10章安全领域的数据包分析235
---
## Page 250
10.3小结
·在“肉鸡”泄露更多敏感信息之前，控制局面。
查看警报及触发它的签名。
 CAPSCREENjpgWindow PhotoViewe
查看流量，找出攻击者对“肉鸡”动了什么手脚。
在恰当的上下文中确定签名确实在流量中。
Hle
图10-26发送的JPG文件是受害者计算机的屏幕截图
BumQper
C
---
## Page 251
11.1
物理因素
无线网络数据包分析
获和访问数据增加了新的限制
和物理层的本质属性，数据链路层变得尤为重要。这给我们捕
型最底层时，游戏便发生了一点变化。在这里，由于无线网络
仍然在处理TCP、IP等常见的通信协议，但是当移到OSI模
与传统有线网络相比，无线网络稍微有些不同，虽然我们
第
---
## Page 252
11.1.1
注意
238
一次噢探一个信道
注意
8Wireshark数据包分析实战（第2版）
通过不可见的无线电波通信，数据包就从我们身边飞过。
Electronics
分进行操作。
这是很重要的，因为WLAN同时只能操作一个信道，就意味着我们只能同时嘎
无线频谱的一部分。在美国，有1个信道可用（有些国家允许使用更多的信道）
“WLAN”等术语均指802.11标准中的网络
系统配置成捕获信道6的流量。
从而高效地噢探多个信道
空间上的分离是通过将频谱划分为不同信道实现的。一个信道只是802.11
无线客户端
（11个倍道）
无线规谱
3
N3
8
无线AP
---
## Page 253
11.1.2
11.1.3 检测和分析信号干扰
无线信号干扰
2.402GHz
叠信道，所以你可能不会遇到这个问题，但以防万一，你还是要了解这是
据包。通常，同一地域上的多个网络被设置成使用1、6和11这3个不重
5上都有流量，当你在其中一个信道上噢探时，会捕获到另一个信道上的数
有限，信道间有些许重叠，如图11-2所示。这意味着，如果信道4和信道
有个小小的忠告：无线频谱被分为多个不同的传输信道，但因为频谱空间
导致数据包丢失、数据包重复或数据包损坏，
可以显示频谱上的数据或干扰。
怎么回事。
输出如图11-3所示。
同时你还要考虑信道间干扰。虽然同一时刻只能噢探一个信道，但还是
HN
图11-2由于频谱空间有限，信道之间有重叠
22MHz
第11章无线网络数据包分析239
但对于日常使用则有更好
2483GHz
信道中心频率
西
---
## Page 254
11.2
无线网卡模式
网卡的驱动程序依赖WAP管理整个通信过程。
无线网卡一共有4种工作模式。
图11-3这个Chanalyzer显示同一地点有多个WLAN在工作
Brots
2
---
## Page 255
注意
种模式如何工作。
式（也叫RFMON模式）
产品
无线客户端