INDEX
A ASLR(AddressSpaceLayout
Randomization),8,53–54,87
AddressSanitizer(ASan),55
authentication
AddressSpaceLayoutRandomization
biometrics,231–232
(ASLR),8,53–54,87
fingerprintauthentication,
advertisingIdentifier,235
safetyof,232
advertisingTrackingEnabled,235
HTTPbasicauthentication,
AESalgorithm,226–227
110–111,119–121
AFNetworking,122–124
LocalAuthenticationAPI,231–232
alloc,19
TouchID,231–232
.appdirectory,78–79
LAContext,231–232
AppleSystemLog(ASL),161–164
autocorrection,175–177
applicationanatomy,27–38
AutomaticReferenceCounting
Bundle directory,33–34
(ARC),19
Datadirectory,34–37
autoreleasepool,19
devicedirectories,32–33
Documentsdirectory,34–35
Shared directory,37 B
applicationDidEnterBackground,20,167, backtrace(bt)command,65–66
179–180,183 BEASTattack,117
applicationextensions,140–144 biometrics,231–232
extensionPointIdentifier,144 black-boxtesting,77
extensionpoints,140 blacklisting,200
NSExtensionActivationRule,142 blocks,Objective-C
NSExtensionContext,143 declaring,18
NSExtensionItem,143 exposingtoJavaScript,150–151
shouldAllowExtensionPoint BluetoothLowEnergy(BTLE),244
-Identifier,143 BluetoothPAN,125
third-partykeyboards,144 Bonjour,125
ApplicationSupport directory,35 BootROM,4
applicationWillResignActive,180 breakpoints,62
applicationWillTerminate,20,167,183 actions,70–72,164
appreview,3–4,10–12 conditions,72
evading,11–12 enabling/disabling,64
AppStore,3–4, setting,62–64
reviewprocess,10–12 brute-forcing,PINs,214
bypassing,11–12 bt(backtrace)command,65–66
ARC(AutomaticReference BTLE(BluetoothLowEnergy),244
Counting),19 bufferoverflows,12,193–196
ASan(AddressSanitizer),55 example,194–195
ASIHTTPRequest,122,124–125 preventing,195–196
ASL(AppleSystemLog),161–164 Bundle directory,33–34
bundleID,33,138
iOS Application Security: The Definitive Guide for Hackers and Developers
© 2016 David Thiel
bundleseedID,218–219 Cordova,150,154–157
BurpSuite,43–47 Cordova.plist,156
CoreBluetooth,246
C CoreData,204,223
CRIMEattack,118
CA(certificateauthority),114–115
cross-sitescripting(XSS),199–200
CAcertificate,44
inputsanitization,200–201
certificatemanagement,47
outputencoding,201–202
certificatepinning,114–117,124
cryptid,81,86–90
defeating,96–97
cryptoff,86–90
cachemanagement,170–171
cryptsize,86–90
removingcacheddata,171–174
cURL,78
Cachesdirectory,35–36
certificates,93–94
caching,36
Cycript,90,93–94
CALayer,182–183
Cydia,31,77
canonicalname(CN),128–129
CydiaSubstrate,78,97–100
canPerformAction,168–169
categories,Objective-C,22–23
D
CBPeripheralManager,246
CCCrypt,186,226 DAC(discretionaryaccess
CCHmac,229 control),4–5
CCRespring,79 Datadirectory,34–37
certificateauthority(CA),114–115 dataleakage,161–188
certificateHandler,126 AppleSystemLog,161–164
CFArrayRef,112–113 autocorrection,175–177
CFBundleURLSchemes,133 breakpointactions,164
CFDataRef,113 cachemanagement,170–174
CFPreferences,36,178 dynamic-text.dat,177
CFStream,48,107,128–129 ephemeralsessions,173
chflagscommand,42 HTTPcaches,169–174
clang,51–53 localstorage,174
class-dumpcommand,90,92–93 iCloud,161
CLBeaconRegion,244,246 avoidanceof,188
CLLocationManager,240,244 keylogger,177
CN(canonicalname),128–129 NSLog,161–164
Cocoa,14 disabling,163
CocoaTouch,14 NSURLSession,173
codesegment,193–195 pasteboards,164–169
codesigncommand,82 canPerformAction,168
CommonCrypto,151,230,230 disablingcopy/paste,168–169
CCCrypt,226 pasteboardDBfile,165–167
CompleteUnlessOpen,222–223 pasteboardWithUniqueName,165–167
CompleteUntilFirstUser- protectingdata,167–169
Authentication,220 UISearchBar,165
cookieAcceptPolicy,237 wiping,167
cookies,36 snapshots,178–184
acceptancepolicy,237–238 applicationDidEnterBackground,
theftof,114 179–180
Cookiesdirectory,36 preventingsuspension,183–184
copy/paste,disabling,168–169 screenobfuscation,179–183
250 INDEX iOS Application Security: The Definitive Guide for Hackers and Developers
© 2016 David Thiel
statepreservation,184–187 .default_created.plist,32
restorationIdentifier,184–185 Default-Portrait.png,179
userpreferences,178 defaultscommand,42
DataProtectionAPI,7–8,219–225 delegation,20
ClassKey,220 DESalgorithm,226
CompleteUnlessOpen,222–223 deserialization,21
CompleteUntilFirstUser- developerteamID,138
Authentication,220 devicedirectories,32–33
DataProtectionClass,223 DeviceKey,7
DataProtectionentitlement, device.plist,32
223–224 didFinishNavigation,159–160
delegatemethods,224 didmessages,20
detecting,225 didReceiveCertificate,126
FileProtectionComplete,220–221 disassembly,withHopper,94–96
isProtectedDataAvailable,225 discretionaryaccesscontrol
protectionlevels,220–223 (DAC),4–5
DataProtectionClassentitlement,157 Documentsdirectory,34–35
datasegment,193–195 DoNotTrack,236–237
dataTaskWithRequest,18 dpkgcommand,96,99–101
datatheft,161 DTrace,55,61
ddcommand,88 dumpdecryptedcommand,80
debugging,61–75 _dyld_get_image_name,10
breakpoints,62 dylibs,10
actions,70–72 dynamicanalysis,55
conditions,72 dynamicpatching,11–12
enabling/disabling,64
setting,62–64 E
DebugNavigator,65
emulator,see Simulator
debugserver,81–84
encodewithcoder,21–22
connectingto,83
encryptedsegment,84–90
installing,81–82
encryption,211–230
faultinjection,72–73
AES,CCBmode,226–227
framesandvariables,64–68
badalgorithms,226
lldb,62–75
CommonCrypto,225,230
backtrace(bt)command,65–66
CCCrypt,226
exprcommand,69
Curve25519,222
frame selectcommand,66–67
DataProtectionAPI,5,7–8,
frame variablecommand,66
219–225
image list,87
ClassKey,220
print objectcommand,67–68
CompleteUnlessOpen,222–223
objectinspection,68
CompleteUntilFirstUser-
tracingdata,74
Authentication,220
variablesandproperties,69–70
DataProtectionClass,223
DebugNavigator,65
DataProtectionentitlement,
debugserver,81–84
223–224
connectingto,83
delegatemethods,224
installing,81–82
detecting,225
decodeRestorableStateWithCoder,184
FileProtectionComplete,220–221
decryptingbinaries,80–90
iOS Application Security: The Definitive Guide for Hackers and Developers INDEX 251
© 2016 David Thiel
encryption,DataProtectionAPI, F
continued
faultinjection,72–73
FileProtectionCompleteUnless- FileJuicer,169,174
Open,222
FileKey,7
isProtectedDataAvailable,225
FileProtectionComplete,220–221
protectionlevels,220–223
filesystemmonitoring,58–59
DESalgorithm,226
Finder,42
DeviceKey,7
fingerprintauthentication,
diskencryption,5–7
safetyof,232
EllipticCurveDiffie-Hellman
forensicattackers,161
algorithm,222
formatstringattacks,190–193
entropy,227
NSString,192–193
FileKey,7
preventing,191–193
fulldiskencryption,5–7
Foundationclasses,14
hashing,228–230
framesandvariables,68
HMAC(HashMessage
frame selectcommand,66–67
AuthenticationCode),
frame variablecommand,66
229–230
FullDiskEncryption,5–7
initializationvector(IV),226–227
fuzzing,55
Keychain,6–7,113,186,211–219
API,7
G
backups,212
iCloudsynchronization,219 garbagecollection,18
itemclasses,214 gdb,62
keyhierarchy,6–7 geolocation,238
kSecAttrAccessGroup,218–219 accuracy,239
protectionattributes,212–214 CLLocationManager,240
SecItemAdd,219 risks,238–239
sharedKeychains,218–219 get-task-allow,82
usage,214–217 GoogleToolboxforMac,202
wrappers,217–218 GPS,238
keyderivation,227–228
keyquality,227–228 H
Lockbox,217
handleOpenURL,136
OpenSSL,228–229
hashing,228–230
RNCryptor,230
HashMessageAuthenticationCode
SecRandomCopyBytes,227
(HMAC),229
TLS(TransportLayerSecurity),
hasOnlySecureContent,159–160
127–129
HealthKit,240–241
entitlements,218,223
heap,8,53–54,193
entitlements.plist,81–82
hiddenfiles,41–42
entropy,227
HMAC(HashMessageAuthentication
EricaUtilities,31,78
Code),229
/etc/hosts,49
Homebrew,46,88,94,99
EXC_BAD_ACCESS,191
hooking
eXecuteNever(XN),8–9
withCydiaSubstrate,97–100
exprcommand,69
withIntrospy,100–103
extensionPointIdentifier,144
Hopper,94–96
extractIdentityAndTrust,112–113
252 INDEX iOS Application Security: The Definitive Guide for Hackers and Developers
© 2016 David Thiel
HTMLentities,201 Introspy,100–103
encoding,see outputencoding iOS-targetedwebapps,147–160
HTTPbasicauthentication,110–111, IPAInstallerConsole,78
119–121 .ipapackages,80
HTTPlocalstorage,174 IPC(interprocesscommunication),
HTTPredirects,113–114 131–145
applicationextensions,131,140
I extensionPointIdentifier,144
extensionpoints,140
iBeacons,244–247
isContentValid,143
CBPeripheralManager,246
NSExtensionActivationRule,142
CLBeaconRegion,244–246
NSExtensionContext,143
CLLocationManager,244
NSExtensionItem,143
startMonitoringForRegion,244
shouldAllowExtensionPoint
iBoot,4
-Identifier,143
iCloud,35,111,161,212,219
third-partykeyboards,143–144
avoidanceof,187
canOpenURL,138
IDAPro,94
handleOpenURL,136
identifierForVendor,234
isContentValid,143
iExplorer,28–29
openURL,132–137
iGoat,178
sourceApplication,136
image list,87
UIActivity,139–140
implementation,declaring,16–17
UIPasteboard,144
Info.plist,33
universallinks,137–138
init,19
URLschemes,132–133
initializationvector(IV),226–227
CFBundleURLSchemes,133
initWithCoder,21–22
defining,132–133
initWithContentsOfURL,206
hijacking,136–137
injectionattacks,199–207
validatingURLsandsenders,134
cross-sitescripting(XSS),199–202
iproxycommand,84
inputsanitization,200–201
isContentValid,143
outputencoding,200–202
IV(initializationvector),226–227
displayinguntrusteddata,202
ivars,15–17,91
predicateinjection,204–205
SQLinjection,203–204
J
parameterizedSQL,203–204
SQLite,203–204 jailbreakdetection,9–10
XMLinjection,207 futilityof,9
XMLexternalentities,205–206 jailbreaking,4,9–10,77
XPath,207 JavaScript,11
inputsanitization,200–201 executinginCordova,154–157
installipacommand,80 executinginUIWebView,149–150
InstaStock,12 stringByEvaluatingJavaScriptFrom-
Instruments,55–57 String,149–150
integeroverflow,196–198 JavaScript–Cocoabridging,150–157
example,197–198 JavaScriptCore,150–154
preventing,198 blocks,150–151
interface,declaring,15–16 JSContext,152–154
interprocesscommunication,see IPC JSExport,151–152
(interprocesscommunication) Jekyll,12
iOS Application Security: The Definitive Guide for Hackers and Developers INDEX 253
© 2016 David Thiel
just-in-time(JIT)compiler,8–9,149 linkidentityeditor(LDID),97
JRSwizzle,25 lipocommand,78,85
JSContext,152–154 lldb,62–81,83–84,191
JSExport,151–152 backtrace(bt)command,65–66
breakpoints,62
K actions,70–72,164
conditions,72
kCFStreamSSLLevel,129
enabling/disabling,64
KeychainAPI,6–7,113,186,211
setting,62–64
backups,212
exprcommand,69
iCloudsynchronization,219