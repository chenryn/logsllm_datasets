# EISS2021-办公网零信任安全建设实践
|
##### 译文声明
本文是翻译文章
译文仅供参考，具体内容表达以及含义原文为准。
## 一、背景
大家好，非常高兴给大家分享《办公网零信任安全建设》这个话题。
分享之前我想先简单介绍一下我们公司，趣加是一家游戏公司，主要了是面向海外市场，所以有很多同学了可能没有听过我们公司；但喜欢玩游戏的同学可能听过一个战队，就做fpx那其实就是我们公司的一个战队。
## 二、分享内容
我今天要分享的内容主要是三点
首先是我们为什么要做零信任安全建设，前面很多老师讲过了零信任的一些应用场景和零信任的理念,这里了我简单提一下我们趣加为什么要去做零信任建设;第二个是我们如何去设计零信任架构，零信任建设主要是结合业务去实现，这里了我想以趣加为例子，分享一下我们的建设思路；第三点是我们在建设实践过程当中具体如何去做的，做了哪些事情以及一些细节性的问题；
## 三、为何要做
首先让我们为什么要去做零信任建设，很多重视安全的公司了需求来源分为两类，一类是外部的驱动，另一类是内部驱动；这里我们我们趣加其实就是内部驱动，然后去做一些安全方面的事情事情
为什么这么说呢？因为我们是一个游戏公司，游戏公司是非常重视安全问题的；所以我们本身就有安全方面的一些需求，第二个的就是我们整个团队的都对安全是比较重视的，因为一款游戏的安全是可以决定游戏的生命周期的，在推广零信任的时候了团队的配合程度也是非常重要的；第三点就是我们把零信任安全建设方案那么跟领导汇报之后，领导也是非常支持我们去做这样一件事情。
###  3.1 安全需求
刚才说到了我们是有安全需求的，那我们趣加为什么有这样的安全需求呢，这里我举一个例子。
####  3.1.1 网络架构
我们公司主要将网络了分为两个网络，分别是内部的办公网络，和面向公众的网络。
基于这两个网络建设的安全体系，其中内部办公网了默认认为是可信网络，也就是说你只要连接到这个办公网络；你访问内部的一些服务，他都认为是可信的，你只需要经过简单的一些身份验证就可以进行操作；但是这里有一些问题，比如说在去年2020年哪疫情期间，很多同事都在家办公，在家办公要访问内部办公系统就得通过vpn去连接内部网络；这样的网络架构其实是有一些弱点的；
VPN只能保证这个身份的可信，但是并不能保证设备的安全性，另外很多时候连接了VPN，但访问的流量并不需要使用VPN；比如说微信以及访问一些非办公网内的网页，其实是浪费vpn的资源；我们在想如何不使用vpn，保证安全性的同时又能访问到内部办公网内部的服务，这个时候零信任的理念其实是非常合适的。
####  3.1.2 零信任理念
这里了我总结了几点零信任的一些理念，这里列了四条
第一点是默认不信任，默认不信任用户也不信任设备以及不信网络，我们之前的一个办公网的结构了其实就是默认信任网络，以及默认信任所有设备；这一条理念其实是可以补齐我们的一些短板
第二点是动态的访问权限，我们之前的内部办公网只要你连接到这个网络，并且身份经过简单的一次校验就可以操作后面的权限，这里也能加强我们的身份验证，因为它在登录之后还是一直是持续在验证；比如说我认为某个用户不合法，我随时可以把这个用户删除，它之后的访问就立即给他前端了。
第三点是减少资源的暴露面，缩小攻击的范围，之前我们要访问内部服务，只需要链接办公网就可以直接连接服务，然后服务自己去权限控制，有一些服务其实安全性是挺弱的，比如说弱口令等等，攻击的范围还是是比较广泛的
第四点也就是持续的评估与安全响应，通过多个维度来判断某一个请求是否足够安全。
####  3.2.3 建设目标
结合网络现状和零信任的一些理念相结合，我们提出了三点建设目标
首先是让员工更安全和便捷的访问公司内部服务，第二点是确保访问者的身份和网络环境是安全的才允许访问，第三点是解决访问日志分散无法追溯用户的行为，那么主要是要做到这三点，这是我们建设的初衷。
###  3.2 重视安全
前面提到了我们游戏公司非常重视安全，注重安全的原因主要是安全能够直接影响公司的收入，这里我举两个游戏行业的例子
####  3.2.1 源码泄露场景
首先说一下源码泄露案例，如果源码泄露会发生什么事情
很多同学可能听过传奇私服或者玩过这个传奇，在2002年的9月份传奇的源码通过意大利服务器源码泄露了，很快就传到国内，在短短的半年里就有500多家私人搭建传奇服务器，很多玩家开始从官服转到私服中去，传奇运营商收入大大受到影响，因此不再给传奇的开发商支付代理费用，导致这个开发商面临破产风险，后来甚至被收购。从这个例子里可以看到一款游戏的安全可以决定它的生命周期。
####  3.2.2 高危漏洞场景
还有一个高危漏洞场景,在美国Def Con 2017的会议上，有一个黑客跟媒体透露他在过去二十年里面，利用网络游戏漏洞去赚钱的一些方法
并且现场演示在调试器中输入命令，给他游戏里的账户增加了很多很多的金币；不同的游戏使用不同的方法增加货币，相同的是添加的金币或者道具主要通过第三方市场进行交易来获利；在这个例子中可以看到一款游戏的安全性，可以直接影响公司收入营收；所以我们团队本身是非常重视安全的，老板的安全重视程度也给我们强有力的支撑，让我们能够安安心心的去建设零信任安全。
## 四、架构设计
在确定好做零信任建设的事情之后，我们主要做了三件事情
第一点是确定理想的一个目标，确定好目标之后就是熟悉现有网络架构；因为零信任并不是一个产品，把这个产品开发完成完就完事了，它非常贴合业务线，所以要熟悉当前的网络结构，然后再把目标和现状两者相结合得到一个可以实施的目标方案；
###  4.1 理想中的目标
这张图是我们理想中的目标效果，在图中可以看到我希望所有的访问用户的都通过安全网关代理去访问这些内部服务
在代理访问之前，我们会去验证访问者的身份是否合法，同时验证这个设备是否为内部设备，以及他的请求参数当中有没有非法请求，另外了还有一些他的一些异常行为，比如说他平时都是在工作时间去访问这个服务，突然有一天他在凌晨一点两点去访问这个服务，这个时候了我们就会将他的这个安全等级变低，需要他二次验证来提升安全评分；
实现这些目标，需要做到左边的几项，比如说资源统一管理和统一控制外部访问，比如说我们需要去统一管理这些用户，统一控制这些设备，统一让用户通过安全网关进行访问内部服务；所以这些业务需要配置一些防火墙限制，只允许安全网关去访问它；另外两点是希望动态调整访问控制策略以及希望能减少VPN的使用。
###  4.2 熟悉现有架构
确定好理想目标后，得熟悉一下现有的网络结构，目前的网络现状主要是网络可信和身份验证两个机制，所以我着重了解这两个。
####  4.2.1 网络准入
先来说一下pc设备，比如说windows mac
linux这些设备要接入内部网络可以有三种方式，首先是在家办公的场景会通过vpn去连接，连接vpn的时候需要登录账号，第二个是在公司办公的场景一般是通过wifi连接我们的网络，连接wifi之后还会需要通过访问登录账号和密码来确认身份，最后一种是办公网的网线接入；其实手机之类的移动设备接入方式和电脑基本一致，还有一些哑巴设备比如说打印机摄像头主要是通过网线去连接内部网络。
这里了讲一下目前网络的几点问题
第一点是一个用户连接到我们内部往来之后，如果他也想访问某一个服务，完全是靠这个服务本身进行权限控制，没有统一的身份去控制它是否能够访问；有一些系统是有一些弱口令或者薄弱账号的，这是从安全性角度思考；
第二点是vpn的稳定性无法保证，比如有些员工在高铁上，需要访问办公网内部的服务，这个时候得先通过VPN连接到内部往来，VPN是个长链接不一定稳定一直稳定；同时还有一些流量并不是需要通过vpn才能访问的，但都通过VPN显然增加了网络直接耗费；