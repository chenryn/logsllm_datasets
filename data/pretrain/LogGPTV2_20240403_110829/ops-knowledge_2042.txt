User: 请解答这个和日志有关的问题How to inspect remote SMTP server's TLS certificate? We have an Exchange 2007 server running on Windows Server 2008.  Our client uses another vendor's mail server.  Their security policies require us to use enforced TLS.  This was working fine until recently.

Now, when Exchange tries to deliver mail to the client's server, it logs the following:


  A secure connection to domain-secured domain 'ourclient.com' on connector 'Default external mail' could not be established because the validation of the Transport Layer Security (TLS) certificate for ourclient.com failed with status 'UntrustedRoot. Contact the administrator of ourclient.com to resolve the problem, or remove the domain from the domain-secured list.


Removing ourclient.com from the TLSSendDomainSecureList causes messages to be delivered successfully using opportunistic TLS, but this is a temporary workaround at best.

The client is an extremely large, security-sensitive international corporation.  Our IT contact there claims to be unaware of any changes to their TLS certificate.  I have asked him repeatedly to please identify the authority that generated the certificate so that I can troubleshoot the validation error, but so far he has been unable to provide an answer.  For all I know, our client could have replaced their valid TLS certificate with one from an in-house certificate authority.

Does anyone know a way to manually inspect a remote SMTP server's TLS certificate, as one can do for a remote HTTPS server's certificate in a web browser?  It could be very helpful to determine who issued the certificate and compare that information against the list of trusted root certificates on our Exchange server.

Assistant: You can use OpenSSL. If you have to check the certificate with STARTTLS, then just do

openssl s_client -connect mail.example.com:25 -starttls smtp


or for a standard secure smtp port:

openssl s_client -connect mail.example.com:465