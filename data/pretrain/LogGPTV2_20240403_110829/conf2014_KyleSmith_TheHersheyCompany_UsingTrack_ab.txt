  due 
  to 
  lack 
  of 
  events 
  within 
  those 	?me 
  buckets 
  Must 
  be 
  the 
  first 
  command 
  of 
  a 
  search 
  (useful 
  with 
  map 
  ) 
  “Suppor?ng 
  Search” 
  -­‐ 
  no 
  real 
  use 
  case 
  for 
  basicreal 
  use 
  case 
  for 
  basic 
  searching 
  Can 
  be 
  used 
  to 
  show 
  different 
  “top” 
  fields 
  over 
  a 
  ?mechart! 
16 
gen?mes 
  – 
  How 
  to 
  Use 
  It 
|  | |gentimes start=10/1/2013 end=10/2/2013  |  |
|---|---|---|
|  |increment=1h  | |
|  |  | |
|  |Syntax: (MM/DD/YY)?:(HH:MM:SS)?|  | |
|  |Description: Indicate the time, for  | ||  |example: 10/1/07:12:34:56 (for October 1,  | |
|  |2007 12:34:56) or -5 (five days ago)  | |
17 
gen?mes 
  – 
  How 
  to 
  Use 
  It 
 |gentimes start=-1 end=0 increment=1h | map maxsearches=24 search="search earliest= $starttime$ latest=$endtime$  | bucket _time span=1h | top 
useother=t limit=5  by _time | fields - percent" | timechart sum(count) by hRp://answers.splunk.com/answers/154723/?mechart-­‐other-­‐category-­‐per-­‐span 
18 
BONUS 
  SEARCH! 
 `find_asa_vpn_events`| `combine_user_names`|eventstats min(_time) as earliest max(_time) as latest by asaUser |
convert ctime(earliest) as et timeformat="%m/%d/%Y:%H:%M: %S" | convert ctime(latest) as lt timeformat="%m/%d/%Y:%H: %M:%S"| map maxsearches=5000 search="|gentimes start=$et$ end=$lt$ increment=1h | eval asaUser=\"$asaUser$\"  | eval _time = starttime "| fields _time asaUser | timechart span=1h dc(asaUser) as "ASA Users"RUNNING 
  THIS 
  OVER 
  LARGE 
  TIME 
  RANGES 
  WILL 
  TAKE 
  A 
  LONG 
  TIME 
  TO 
  COMPLETE ( 
  This 
  one 
  took 
  9.7 
  minutes 
  to 
  run 
  ) 
19 
BONUS 
  SEARCH! 
Connect 
  event: 
Sep 
  5 
  08:22:09 
  asadevice.example.com 
  :Sep 
  05 
  12:22:09 
  UTC: 
  %ASA-­‐auth-­‐6-­‐113004: 
  AAA 
  user 
  authentication 
  Successful 
  : 
  server 
  = 10.140.41.8: 
  server 
  = 10.140.41.8 
  : 
  user 
  = 
  myuser100 
Disconnect 
  event: 
Sep 
  5 
  09:03:01 
  asadevice.example.com 
  :Sep 
  05 
  13:03:01 
  UTC: 
  %ASA-­‐auth-­‐4-­‐113019: 
  Group 
  = 
  DefaultWEBVPNGroup, 
  Username 
  = 
  myuser100, IP 
  = 
  192.168.100.100, 
  Session 
  disconnected. 
  Session 
  Type: 
  SSL, 
  Duration: 
  16h:00m:05s, 
  Bytes 
  xmt:16h:00m:05s, 
  Bytes 
  xmt: 
  58502687, 
  Bytes 
  rcv: 
  15322893, Reason: 
  Max 
  time 
  exceeded 
Fields 
  being 
  passed 
  to 
  map 
  command: 
20 
BONUS 
  SEARCH! 
21 
BONUS 
  Karma! 
 Free 
  Karma? 
  How?
1.Login 
  to 
  answers.splunk.com 	(create 
  an 
  account 
  if 
  needed) 2.Find 
  the 
  Answer 
  where 
  I 
  used 	this 
  image 
3.Up 
  vote 
  theimage 
3.Up 
  vote 
  the 
  answer 
4.I’ll 
  give 
  the 
  first 
  person 
  today 	to 
  up 
  vote 
  100 
  Karma 
  points! 
22 
xyseries 
 xyseries [grouped=]   ... [sep=] [format=] 
Converts results into a format suitable for graphing 
  Email 
  flow 
  [ 
  xyseries 
  email_domain 
  email_direc?on 
  count 
  ]   Oneemail_direc?on 
  count 
  ]   One 
  to 
  many 
  rela?onships 
  [ 
  example 
  Weather 
  Icons 
  ]   Any 
  data 
  that 
  has 
  values 
  INDEPENDENT 
  of 
  the 
  field 
  name 	–host=myhost 
  domain=splunk.com 
  metric=kbps 
  metric_value=100 	–xyseries 
  domain 
  metric 
  metric_value 
  Works 
  great 
  for 
  categorical 
  field 
  comparison 
23 
xyseries 
  – 
  How23 
xyseries 
  – 
  How 
  to 
  Use 
  It 
 `weather_data` | xyseries icon weather weather 
24 
foreach 
 foreach  [fieldstr=] [matchstr=] [matchseg1=] [matchseg2=] [matchseg3=]  
Runs a templated streaming subsearch for each field in a wildcarded field list. 
  Rapidly 
  perform 
  evalua?ons 
  and 
  other 
  commands 
  onand 
  other 
  commands 
  on 
  a 
  series 
  of 
  fields   Can 
  help 
  calculate 
  Z 
  scores 
  (sta?s?cal 
  inference 
  comparison) 
  Reduces 
  the 
  number 
  of 
  evals 
  required 
Example. Equivalent to ... | eval foo="foo" | eval bar="bar" | eval baz="baz" 
... | foreach foo bar baz [eval > = ">"] 
25 
foreach 
  – 
  How 
  to 
  Use 
  Itforeach 
  – 
  How 
  to 
  Use 
  It 
 `per60m_firewall_actions` 
| timechart span=60m sum(countaction) by action 
| streamstats window=720   mean(*) as MEAN* stdev(*) as STDEV* 
| foreach * [eval Z_> = ((>-MEAN>) / STDEV>)] | fields _time Z* 
26 
foreach 
  – 
  How 
  to 
  Use 
  It 
 `per60m_firewall_actions` 
| timechart span=60m sum(countaction) by action| streamstats window=720   mean(*) as MEAN* stdev(*) as STDEV* 
| foreach * [eval Z_> = ((>-MEAN>) / STDEV>)] | eval Z_PROB=3.2 | fields _time Z* 
27 
cluster 
 cluster [slc-option]* 
Cluster similar events together 
  Find 
  common 
  and/or 
  rare 
  events 
  Great 
  for 
  “WAG” 
  searching 
  Finds 
  anomalies 
  (outliers) 
  in 
  your 
  web(outliers) 
  in 
  your 
  web 
  logs, 
  security 
  logs, 
  etc 
  by 	checking 
  for 
  cluster_counts 
  Find 
  common 
  errors 
  in 
  event 
  logs 
28 
cluster 
  – 
  How 
  to 
  Use 
  It 
 index=_internal source=*splunkd.log* log_level!=info | cluster showcount=t | table cluster_count _raw | sort -cluster_count 
29 
autoregress29 
autoregress 
 autoregress field [AS ] [p=[-]] Sets up data for calculating the moving average. 
A Moving Average is a succession of averages calculated from successive events (typically of constant size and 
overlapping) of a series of values. 
  Allows 
  advanced 
  sta?s?cal 
  calcula?ons 
  based 
  on 
  previous 
  values 
  Moving 
  averages 
  of 
  numericalaverages 
  of 
  numerical 
  fields 
	–Network 
  bandwidth 
  trending 
  -­‐ 
  kbps, 
  latency, 
  dura?on 
  of 
  connec?ons 
	–Web 
  analy?cs 
  trending 
  -­‐ 
  number 
  of 
  visits, 
  dura?on 
  of 
  visits, 
  average 
  download 	size 
	–Malicious 
  traffic 
  trending 
  -­‐ 
  excessive 
  connec?on 
  failures 
30 
	autoregress 
  – 
  How 
  to 
  Useautoregress 
  – 
  How 
  to 
  Use 
  It `temperature_data` | autoregress temp_f | table _time temp_f temp_f_p1 
31 
	autoregress 
  – 
  How 
  to 
  Use 
  It 
`temperature_data` | autoregress temp_f | eval diff = abs(temp_f - temp_f_p1) |  timechart span=15m eval(avg(diff)) as 
"Average Difference" 
32 
CLI 
  Commands 
  $SPLUNK_HOME/bin/splunk 
  reload 
  index 
–Reloads 
  indexreload 
  index 
–Reloads 
  index 
  configura?on, 
  making 
  immediately 
  effec?ve 
  all 
–"add/edit/enable/disable 
  index" 
  commands 
  since 
  last 
  reload 
  or 
  Splunk 
  restart 
  Why? 
–Adding 
  a 
  new 
  app 
–Changing 
  a 
  frozen 
  ?me 
  period 
–New 
  loca?on 
  for 
  data 
33 
CLI 
  Commands 
  $SPLUNK_HOME/bin/splunk 
  cmd 
  pcregextest 
	–Useful 
  forcmd 
  pcregextest 
	–Useful 
  for 
  tes?ng 
  modular 
  regular 
  expressions 
  for 
  extrac?ons 
splunk cmd pcregextest mregex="[[ip:src_]] [[ip:dst_]]" ip="(?\d+[[dotnum]]{3})" 	dotnum="\.\d+" test_str="1.1.1.1 2.2.2.2" 
Original Pattern: '[[ip:src_]] [[ip:dst_]]' 
Expanded Pattern: '(?\d+(?:\.\d+){3}) (?\d+(?:\.\d+){3})' 
Regex compiled successfully. Capture group count = 2. Named capturing groups = 2.SUCCESS - match against: '1.1.1.1 2.2.2.2' 
#### Capturing group data ##### 
Group |            Name | Value 
-------------------------------------- 
	 1 |          src_ip | 1.1.1.1 
	 2 |          dst_ip | 2.2.2.2 
34 
CLI 
  Commands 
  $SPLUNK_HOME/bin/splunk 
  cmd 
  btool 
	êBtool 
  allows 
  you 
  to 
  inspect 
  configura?ons 
  and 
  what 
  is 
  actually 
  being 
  applied 
  toactually 
  being 
  applied 
  to 
  your 	sourcetypes 
  splunk 
  cmd 
  btool 
  -­‐-­‐debug 
  props 
  list 
  wunderground 
  | 
  grep 
  -­‐v 
  "system/default" 
/opt/splunk/etc/apps/TA-wunderground/default/props.conf [wunderground] 
/opt/splunk/etc/apps/TA-wunderground/default/props.conf KV_MODE = json 
/opt/splunk/etc/apps/TA-wunderground/default/props.conf MAX_EVENTS = 100000/opt/splunk/etc/apps/TA-wunderground/default/props.conf MAX_TIMESTAMP_LOOKAHEAD = 30 /opt/splunk/etc/apps/TA-wunderground/default/props.conf REPORT-extjson = wunder_ext_json /opt/splunk/etc/apps/TA-wunderground/default/props.conf SHOULD_LINEMERGE = true 
/opt/splunk/etc/apps/TA-wunderground/default/props.conf TIME_PREFIX = observation_epoch /opt/splunk/etc/apps/TA-wunderground/default/props.conf TRUNCATE = 100000035 
Resources 
  and 
  Ques?ons 
  IRC 
  #splunk 
  on 
  efnet.org 
  (look 
  for 
  alacer) 
  docs.splunk.com 
  answers.splunk.com 
  (I’m 
  alacercogitatus 
  -­‐ 
  can 
  I 
  haz 
  karma?)   wiki.splunk.com 
36 
THANK 
  YOU 
alacercogitatus 
  – 
Did 
  I 
  men?on 
  Karma?