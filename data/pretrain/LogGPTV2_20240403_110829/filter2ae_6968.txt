# EOS节点远程执行代码漏洞

## 译文声明
本文为翻译文章，仅供参考。具体内容及含义以原文为准。

## 漏洞报告者
- Yuki Chen, Qihoo 360 Vulcan Team
- Zhiniang Peng, Qihoo 360 Core Security

## 漏洞描述
我们发现了一个存在于EOS区块链系统中的越界写缓冲区溢出漏洞，该漏洞发生在解析智能合约WASM文件的过程中。通过此漏洞，攻击者能够上传恶意智能合约至节点服务器。一旦节点服务器解析了这些恶意合约，攻击者便可以在该服务器上执行任意代码，并获得完全控制权。在掌控了某个节点后，攻击者可以将恶意合约打包进新的区块中，进而感染并控制其他新节点，最终达到全面接管整个EOS网络的目的。

## 漏洞时间线
- **2018年5月11日**：发现EOS越界写缓冲区溢出漏洞。
- **2018年5月28日**：开发完成了针对EOS超级节点的完整漏洞利用程序。
- **同日**：向厂商报告了漏洞详情。
- **2018年5月29日**：
  - 厂商在GitHub上的源码库中修复了漏洞，并关闭了相关的问题跟踪项。
  - 提醒厂商存在未完全修复的部分。

### 与Daniel Larimer的沟通细节
我们尝试通过Telegram联系Daniel来报告此问题。Daniel表示，在没有彻底修复之前不会发布新版EOS，并请求我们在公开测试前先提交漏洞报告给他。他还提供了一个官方邮件地址供我们使用。最后，Daniel承诺将在漏洞修复后给予公开致谢。

## 漏洞技术细节
这是一个位于`libraries/chain/webassembly/binaryen.cpp`第78行处的缓冲区溢出越界写漏洞，具体出现在`binaryen_runtime::instantiate_module`函数内。当处理某些特定类型的输入时，程序可能会尝试访问超出分配给表（table）向量的内存边界之外的数据区域，从而导致潜在的安全风险。

### 重现步骤
1. 编译最新版本的EOS代码：`./eosio-build.sh`
2. 启动并配置好EOS节点。
3. 设置一个包含已知缺陷的WASM合约作为测试用例。
4. 使用以下命令部署该合约：`cd poc; cleos set contract eosio ../poc -p eosio`

如果一切顺利，您将会看到`nodeos`进程因段错误而崩溃。

### 利用场景
攻击者可以通过上传特制的恶意合约到目标节点上来触发此漏洞，随后利用越界写入技术覆盖关键内存区域，实现对受影响系统的远程控制。此外，他们还可以进一步扩散这种影响，通过将恶意合约嵌入新区块的方式去攻击更多的节点，直到整个网络都处于其掌控之下。

## 漏洞修复情况
尽管Bytemaster已在GitHub上创建了编号为#3498的问题条目来跟进此事，并且初步实施了一些修正措施，但根据Yuki的反馈，当前补丁尚不足以完全解决问题——特别是在32位架构下的环境中仍可能存在安全隐患。

请注意查看相关讨论链接获取更多详细信息。