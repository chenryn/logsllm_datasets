zrh2-ch 1404 (26.1%) 3900 (72.5%) 0 (0%) 74 (1.4%)
of the interfaces in each path were the in-bound interface for at least half of the
VP’s traceroutes for 7 of the 8 VPs. This is a lower bound on the actual fraction
of in-bound interfaces for these VPs because some routers do not respond to
our preﬁxscan probes that we use to infer pt2pt links. In particular, many paths
from the Ark node in Amsterdam (ams3-nl) traverse AS7018 (AT&T), but none
of AT&T’s routers will respond to probes.
We next examine the classiﬁcation made using the technique from [14] for
the addresses we inferred to represent the in-bound interface on the router for
paths that traversed a pt2pt link. Of the 77,348 interfaces that embedded 1-3
timestamps in the pre-speciﬁed timestamp option in response to ICMP B|BBBB
probes, we inferred 29,930 (38.7%) of these to represent the in-bound interface
on the router on at least one pt2pt link. However, the majority of UDP G|BBBB
probes across these pt2pt links obtain zero timestamps and would be classiﬁed
by [14] as oﬀ-path. In our data, between 77.1% and 90.0% of interfaces visited
embedded zero timestamps, depending on the VP. Techniques relying on pre-
speciﬁed timestamps to infer oﬀ-path addresses are unreliable.
A Second Look at Detecting Third-Party Addresses in Traceroute Traces
53
F
D
C
C
 0.7
 0.6
 0.5
 0.4
 0.3
 0.2
 0.1
 0
 1
1,104 (5.6%)
mixed N=1247
off−path N=19727
on−path N=8956
 10
 100
 1K
Number of source−destination pairs probed with UDP G|BBBB
Fig. 4. CCDF of the number of source-destination pairs an interface was observed in
a traceroute path, grouped by classiﬁcations made with UDP G|BBBB probes and the
technique from [14]. 1,104 (5.6%) of interfaces always inferred to be oﬀ-path using the
technique from [14] that we infer to represent the in-bound interface of the router were
traversed in at least eight source-destination pairs in our data.
Because hop B might be observed in multiple traceroutes to destinations G1,
G2, GN , and therefore be counted N times, particularly for interfaces close
to our VP [11], we next examine the variability of classiﬁcations made using
pre-speciﬁed timestamps. Table 2 reports the number of interfaces that behave
consistently regardless of the destination probed; 70.9% – 74.5% do not insert a
timestamp when the in-bound interface is visited regardless of the destination
probed. This result partly explains Marchetta et al.’s surprising result that most
classiﬁed addresses in traceroute paths are oﬀ-path: it seems routers that insert
1-3 timestamps when probes are addressed to them with ICMP B|BBBB probes
often do not insert timestamps when they forward UDP G|BBBB probes.
We next investigate the possibility that the prevalence of oﬀ-path inferences
are due to load-balancing routers. As with Marchetta et al. [14], the UDP probes
for the traceroute towards G contain no IP options, while the UDP probes
G|BBBB to infer on- and oﬀ- path interfaces do. Routers that per-ﬂow load-
balance IPv4 packets using bytes 20-23 (where the transport header would be
located if the IP header contained no options) may forward probes based on the
ﬁrst four bytes of a pre-speciﬁed timestamp option rather than on the ﬁrst four
bytes of the UDP header (source and destination ports). However, this explana-
tion is unlikely to explain the prevalence of oﬀ-path inferences for two reasons.
First, per-destination load-balancers are the most common form of load balancer,
i.e. they do not consider bytes 20-23 when forwarding a packet. Augustin et al.
reported that 70% of source-destination pairs traversed such a load balancer in
their data, while 39% traversed a per-ﬂow load balancer [3]. Second, ﬁgure 4
presents a CCDF of the number of source-destination pairs an interface was ob-
served in a traceroute, grouped by the classiﬁcations made using the technique
from [14]. 5.6% of interfaces were consistently inferred to be oﬀ-path despite
being traversed by at least eight source-destination pairs with UDP G|BBBB
probes. We are at least 99% conﬁdent the hop prior to B did not per-ﬂow load
balance these probes on a path avoiding B. Figure 5 shows a scatter-plot of
interfaces that we inferred to be received on the in-bound interface on a pt2pt
54
M. Luckie and k. claﬀy
)
h
t
a
p
−
f
f
o
(
s
p
m
a
t
s
e
m
i
t
o
r
e
Z
10K
1K
100
10
1
1
2−3
4−10
>10
139
437
 1
102
 10
1−3 timestamps (on−path)
 100
Fig. 5. Scatter plot of in-bound interfaces inferred to be on-path toward some desti-
nations and oﬀ-path toward others (i.e. have mixed timestamp behavior). The symbol
shape reﬂects the frequency of the on-path:oﬀ-path ratio in our data. Most interfaces
are inferred to be on-path for just one source-destination pair using the technique
from [14] despite being the in-bound interface of a pt2pt link.
link, but which were inferred to be on-path for some source-destination pairs and
oﬀ-path for others using the technique from [14]; that technique infers the major-
ity of interfaces to be on-path for a few destinations, and oﬀ-path for most. We
attempted to traverse some interfaces with hundreds of UDP G|BBBB probes;
the technique from [14] inferred these interfaces to be on-path only a few times.
4 Conclusion and Future Work
Traceroute has an important role in overcoming the visibility issue of AS topol-
ogy data because we have no other way of uncovering some peerings. However,
researchers must ﬁrst overcome traceroute artifacts such as third-party addresses
which cause us to deduce false AS links and paths. Using traceroutes from eight
Ark monitors to 80K randomly chosen destinations and a method derived from
ﬁrst principles, we showed (counter to the result in [14]) that the majority of IP
addresses in traceroute paths are the in-bound interface on a pt2pt link, and that
current techniques using pre-speciﬁed timestamps to infer third-party addresses
are not reliable. We also release our code used to collect these measurements so
others can reproduce our work. In future work, we plan to use these eight Ark
VPs with public BGP data available to investigate incongruities between BGP
and traceroute paths where the incongruity is inferred on a pt2pt link. Deriving
a technique that accurately infers AS links from traceroute paths remains an
important and currently unsolved problem.
Acknowledgments. The work was supported by U.S. NSF grant CNS-0958547,
DHS S&T Cyber Security Division (DHS S&T/CSD) BAA 11-02 and SPAWAR
A Second Look at Detecting Third-Party Addresses in Traceroute Traces
55
Systems Center Paciﬁc via N66001-12-C-0130, and by Defence Research and
Development Canada (DRDC) pursuant to an Agreement between the U.S. and
Canadian governments for Cooperation in Science and Technology for Critical
Infrastructure Protection and Border Security. This material represents the po-
sition of the author and not of NSF, DHS, or DRDC.
References
1. IP address hitlist, PREDICT ID USC-LANDER/internet address hitlist it52w
(January 2, 2013), http://www.isi.edu/ant/lander
2. Ager, B., Chatzis, N., Feldmann, A., Sarrar, N., Uhlig, S., Willinger, W.: Anatomy
of a large European IXP. In: SIGCOMM 2012 (2012)
3. Augustin, B., Friedman, T., Teixeira, R.: Measuring load-balanced paths in the
Internet. In: IMC 2007 (2007)
4. Augustin, B., Krishnamurthy, B., Willinger, W.: IXPs: Mapped? In: IMC 2009
(2009)
5. Bender, A., Sherwood, R., Spring, N.: Fixing Ally’s growing pains with velocity
modeling. In: IMC 2008 (2008)
6. Giotsas, V., Zhou, S., Luckie, M., Claﬀy, K.: Inferring multilateral peering. In:
CoNEXT 2013 (2013)
7. Govindan, R., Tangmunarunkit, H.: Heuristics for Internet map discovery. In: IN-
FOCOM 2000 (2000)
8. Heidemann, J., Pradkin, Y., Govindan, R., Papadopoulos, C., Bartlett, G., Ban-
nister, J.: Census and survey of the visible Internet. In: IMC 2008 (2008)
9. Hyun, Y., Broido, A., Claﬀy, K.: On third-party addresses in traceroute paths. In:
PAM 2003 (2003)
10. Keys, K., Hyun, Y., Luckie, M., Claﬀy, K.: Internet-scale IPv4 alias resolution with
MIDAR. IEEE/ACM Transactions on Networking 21(2) (April 2013)
11. Lakhina, A., Byers, J.W., Crovella, M., Xie, P.: Sampling biases in IP topology
measurements. In: INFOCOM 2003 (2003)
12. Luckie, M.: Scamper: a scalable and extensible packet prober for active measure-
ment of the Internet. In: IMC 2010 (2010)
13. Luckie, M., Dhamdhere, A., Claﬀy, K., Murrell, D.: Measured impact of crooked
traceroute. CCR 14(1) (January 2011)
14. Marchetta, P., de Donato, W., Pescap´e, A.: Detecting third-party addresses in
traceroute traces with IP timestamp option. In: Roughan, M., Chang, R. (eds.)
PAM 2013. LNCS, vol. 7799, pp. 21–30. Springer, Heidelberg (2013)
15. Oliveira, R., Pei, D., Willinger, W., Zhang, B., Zhang, L.: In search of the elusive
ground truth: the Internet’s AS-level connectivity structure. In: SIGMETRICS
2008 (2008)
16. Oliveira, R., Zhang, B., Zhang, L.: Observing the Evolution of Internet AS Topol-
ogy. In: SIGCOMM 2007 (2007)
17. Postel, J.: Internet protocol (September 1981)
18. Sherry, J., Katz-Bassett, E., Pimenova, M., Madhyastha, H.V., Anderson, T., Krish-
namurthy, A.: Resolving IP aliases with prespeciﬁed timestamps. In: IMC 2010 (2010)
19. Spring, N., Mahajan, R., Wetherall, D.: Measuring ISP topologies with Rocketfuel.
In: SIGCOMM 2002, Pittsburgh, PA, USA (2002)
20. Zhang, Y., Oliveira, R., Zhang, H., Zhang, L.: Quantifying the pitfalls of traceroute
in AS connectivity inference. In: Krishnamurthy, A., Plattner, B. (eds.) PAM 2010.
LNCS, vol. 6032, pp. 91–100. Springer, Heidelberg (2010)