# 【技术分享】移动应用：进入物联网的后门？
|
##### 译文声明
本文是翻译文章，文章来源：virusbulletin.com
原文地址：
译文仅供参考，具体内容表达以及含义原文为准。
****
****
**翻译：**[ **shan66**](http://bobao.360.cn/member/contribute?uid=2522399780)
**预估稿费：300RMB（不服你也来投稿啊！）**
******投稿方式：发送邮件至**[ **linwei#360.cn**](mailto:PI:EMAIL) **，或登陆**[
**网页版**](http://bobao.360.cn/contribute/index) **在线投稿******
**摘要**
现在，每天都有大量新设备接入物联网，但是迫于市场的压力，这些设备的安全性和隐私性往往没有得到足够的重视。为了评估和改善这些设备的安全状况，研究人员需要对它们进行逆向工程。不幸的是，这可不是一个容易的任务，因为他们需要面对各种不同的智能对象，并且它们经常使用定制的硬件、固件、操作系统和协议，这意味着每次逆向工程都需要从头开始，这是相当费时费力的。
在本文中，我们将解决这个问题，并提出一个更容易的方法来逆向智能对象。我们的思路是，在许多情况下无需关注对象本身，而是关注相关的移动应用程序。我们详细介绍了该方法在三个智能对象上的应用，结果表明这种方法的效果非常棒。实验的设备包括：智能牙刷、智能手表和家用安全报警器。
**引言**
在牛津英语词典中，将物联网（IoT）定义为“互联网的进一步拓展，能让日常生活中的所有对象互联互通，允许它们发送和接收数据”。现在，物联网正在逐步走入我们的生活。2014年，约有20亿个物联网设备，这已经超过了笔记本电脑和台式电脑的数量（15亿），并且与智能手机的数量（18亿）相当。一些最常见的物联网对象包括：智能手表（请注意，截止2015年第4季度，智能手表的出货量就已经超过了瑞士手表）、健身腕带（通常用于人类，但也可用于猫和狗的设备，如奥托宠物系统）、智能电视和智能眼镜。但这些只是其中的很少一部分，物联网设备实际上涉及广泛的领域：
**娱乐领域** ，例如Archos公司的音乐智能比尼帽，Mattel公司的智能芭比娃娃Hello Barbie。
**高科技领域** ，例如Recon Instruments公司的增强现实防雪面罩，Narrative公司的可穿戴相机等。
**时尚领域** ，例如Volvorii公司的物联网高跟鞋或服装。
**农业领域** ，例如奶牛授精。
**健康和安全领域** ，例如Netatmo June公司的皮肤暴露检测仪，Vigo公司的睡眠检测仪，Glow-Cap公司的药物提醒帽。等等。
然而，这些设备的隐私和安全问题却非常让人担忧。迫于市场压力，这些物联网设备通常会急不可耐的尽早面世，因此，通常都没有经过适当的安全审查，有时甚至缺乏正确的安全设计。例如，HP研究发现，90％的IoT设备至少会收集一条个人信息，70％的设备使用未加密的网络，10个UI中有6个设备容易受到诸如XSS和弱凭证的威胁。根据这些现状，IDC预测到2016年12月，90％的IT网络将因IoT的安全漏洞而遭受威胁。在消费者方面，埃森哲咨询公司在28个不同国家对28,000个人进行了调查结果表明，47％的消费者对IoT存在隐私和安全担忧。
为了评估智能对象的安全性和隐私性，研究人员需要密切分析它们的具体实现。但是，由于技术文档很少，所以第一步通常需要对相关设备进行逆向工程。逆向工程本来就不是一个轻松的任务，对于物联网设备来说，就更加困难了，因为（i）它们使用的组件越特殊，人们对它的了解就越少，以及（ii）因为智能对象彼此差异很大。前者需要了解陌生领域的专业知识（例如，Riot，Contiki，Brillo等操作系统），而后者则意味着需要逆向智能对象，但是逆向一个智能对象的经验，在逆向其他对象的时候帮助不大。例如，智能手表的逆向工程与智能牙刷的逆向工程几乎没有共同之处。因此，在第一个任务期间获得的经验对第二个任务几乎没有帮助。
这些正是本文要解决的问题。我在这里提出了一种简单的方法，并且我已经多次实践，证明该方法确实有效。这种方法能够使得逆向过程的前面几步更加简单，从而有助于研究人员更快地了解设备本身。此外，它还能提供许多有价值的信息，可以使进一步的逆向工作更集中、更有针对性。
在本文中，我们首先讨论这个主题的前期工作（第2节），然后解释我们使用的方法（第3节）。然后，通过三种不同智能对象举例说明我们的方法：智能牙刷（第4节）、智能手表（第5节）和（第6节）。最后，我们将对这种方法进行总结。
**发展现状**
虽然物联网已经开始流行，但是，其安全研究仍处于早期阶段，相关的出版物也远少于其他领域，如操作系统安全。我们可以引用的文献有NEST恒温器、WeMo电源插座、健康输液泵中的漏洞、在Fitbit
Flex
dongles中注入任意代码、蓝牙扫描、婴儿监视器等等。一方面，这些研究为逆向物联网设备提供了有趣的线索，同时，也说明了不同的智能对象的差距是多么大，以及研究人员为了了解它们而需要做的工作量有多么大。
参考文献[14]将这项任务比作CTF竞赛，这看起来是非常合适的，因为每个挑战是不同的而且非常耗时，并且在网络上也找不到立即可用的解决方案。
在学术界，一些研究人员提出了相关的方法或自动化方法来帮助逆向固件。文献[15]给出了物联网不同攻击面的详细清单。该清单有助于在安全审核/渗透测试时防止遗漏某些领域。然而，它对逆向工程本身没有提供帮助，只是旨在帮助我们涵盖安全相关的所有方面。对于自动化框架和工具，它们是有发展潜力的，但目前仍处于早期阶段，因此现在还难以在实践中大展拳脚。
**方法论**
为了简化物联网设备的逆向工程，本文提出了以下方法：这种方法不是直接逆向智能对象本身，而是首先侧重于逆向与它们打交道的移动应用程序。
许多物联网设备都是通过相关的移动应用程序来进行控制、监督或与之交互的。例如，Meian公司的安全报警器就提供了相应的Android应用程序，帮助最终用户启动、停止设备，获取状态或设置警报区域。类似地，Beam牙刷也配备了与智能牙刷等通信的iOS或Android应用程序。当有这样的移动应用程序可用时，那就为我们提供了很大的优势：
**更简单** 。有许多工具可以用来逆向移动应用程序（例如apktool、baksmali、clutch以及IDA
Pro）。反病毒分析师经常使用这些工具来考察移动病毒，因此我们会有一个良好的支持社区。
**安全性**
。物联网供应商开发这些移动应用程序（因为它们对最终用户很有吸引力）通常是处于营销的角度来考虑的，所以不会将它们完全集成到其安全设计中（如果有的话）。因此，我们通常有机会访问这些移动应用程序未经混淆的源代码，更有甚者，我们还能在这些应用中找到危及智能对象本身的安全漏洞，具体参考第6节。
**退可守**
。如果针对移动应用的分析不足以解决问题，则研究人员总是可以将逆向智能对象作为研究的第二步。在第一阶段收集的信息很可能有助于在第二阶段进行更有针对性的逆向工程。
**Beam牙刷**
**概述**
智能牙刷的问世已经有一段时间了，但直到2015年才引起了相关媒体的关注，因为当时Beam在一份围绕其联网设备的牙科保险计划中提到了它。每支Beam牙刷都纳入了牙科保险计划，并且每支牙刷有自己的特殊优惠（例如免费牙膏）和附属牙医。
与胰岛素泵或起搏器相比，牙刷可能还涉及不到最敏感的健康数据。然而，一旦与保险单挂钩，就会引发多个问题，无论从安全教育角度还是从隐私角度考虑，考察该牙刷的工作原理都是非常有趣的。
该牙刷除了提供其商品规格：蓝牙LE
4.0（BLE）、声波电机、尺寸和颜色之外，没有提供其他技术信息。此外，也没有用户论坛，没有开发者社区，也没有学术出版物。不幸的是，这种情况对于物联网设备来说是非常常见的：我们必须从头开始，因为没有信息可供利用。
面对这种处境，一条路是拆卸牙刷的硬件：拆开它，拿到电子组件，探测测试点等。但是，这里我们决定重点探索该设备相关的iOS和Android移动应用。
**逆向iOS应用程序**
在逆向iOS应用程序的时候，它的架构对我们是很有帮助的。因为应用程序会使用名为BeamBrushData.sqlite的sqlite数据库，其中包含多个表，如BrushEvent、ClientDevice和ClientSession（请参见图1），所以，我们可以通过在函数名称中搜索关键字“primaryKey”来列出这些表。
图1：Beam牙刷的移动应用程序所使用的SQL表。
每个表的内容都是由mappings命名的函数进行描述的，例如Insured表的[Insured mappings]。
了解每个表的字段对于掌握哪些数据被存储以及哪些数据可能泄露给对手是非常有用的。例如，BTStarCardInfo表包含最终用户的积分的变化情况：name，beforeValue，afterValue，starCount，lastTotalStars，totalStars。积分是最终用户完成指定挑战（例如连续刷牙超过两分钟）时授予终端用户的虚拟点数。攻击者当然可以尝试修改这里的值来获取积分——当然，还可能存在其他相关的检查，例如在远程服务器上的检查事项等。
存储在这些表中的信息对于广告工具包或广告软件来说，可能是非常有价值的。例如，Insured表保存被保险用户的称谓，名字，中间名，姓氏，性别和出生日期，当然用户也可能是家庭中的成年人（通常是父亲或母亲）。然后，User表为家庭的其他成员（例如儿童）提供相同的信息。因此，通过分析这些表中包含的数据，间谍软件可以了解特定家庭的组成成员，然后给他们发送有针对性的广告等。
除了数据库结构之外，通过反汇编iOS应用程序还能揭示它实现的类的结构。移动应用程序二进制文件的objc节提供了每个类的方法和字段的完整概述。例如，图2示出了UserSummary类的字段——也称为属性（例如，beamScore，numberOfBrushDaysLeft）和方法（例如，beamScoreRoundedInteger）。此外，IDA
Pro中的注释也特别有用，甚至为每个字段的类型和方法都提供了签名。
图2：IDA Pro显示了UserSummary类的方法和属性。属性的注释显示了该字段的具体类型。
从这里我们可以了解到：
牙刷提供了加速度计和陀螺仪。两者都在BTBrushData类中提供了一个三轴向量。牙刷就是通过它们来了解最终用户是否正在刷牙，如果是的话，当前位于哪个象限（口腔被分为四个区域，或象限：左上，右上，右下，左下）。
固件的空中下载服务。BTFirmwareUpdater类的内容表明，该固件提供了通过空中下载进行的更新服务。更新固件时，会将新固件的字节发送到牙刷，直到写入所有字节为止。
    char *firmware;
    unsigned int totalLength;
    unsigned int written;
    unsigned int toWrite;
    unsigned int loopCount;
    int state;
    CBService *otaService;
    CBCharacteristic *otaControlPoint, *otaDataPoint;
这些积分只是软件而已。特定最终用户的积分数量并不存储在牙刷本身上，而是存储在移动电话上（并且可能在远程服务器数据库上）。事实上，类BTBrushData，BTBrushEvent，Device和ClientDevice中没有积分相关的字段。从这些类的内容可以看出，牙刷是由固件、硬件、序列号、闪光灯、电池电量、电动机（其速度是可控的）、三轴陀螺仪、三轴加速度计、自动关闭定时器和具有BLE功能的芯片构成的。
**逆向Android应用程序**
通过逆向该Android应用程序，我们可以获得更多的详细信息。例如，虽然我们知道牙刷导出了几种BLE服务和characteristic（参见图3），但是除了标准的服务之外，大多数都是未知的。
图3：牙刷的BLE characteristic。