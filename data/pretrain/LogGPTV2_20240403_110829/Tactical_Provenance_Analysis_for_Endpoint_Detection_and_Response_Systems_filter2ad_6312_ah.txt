ba6b01
b464e4
8d88e3
d68b64
3fb85e
ae5f39
e448f1
0c1d5e
False Alarm
True Attack
False Alarm
False Alarm
True Attack
False Alarm
False Alarm
False Alarm
False Alarm
True Attack
False Alarm
False Alarm
False Alarm
False Alarm
True Attack
True Attack
Threat
Scores
125000
116640
25000
15625
14400
7350
5250
4375
3750
3750
3125
3125
1600
1600
1440
1350
Threat
Alerts
54
992
30
52403
26
12
26
45
11
77
127
16
44
64
13
48
Longest Ordered Subsequence of Tactics
execution, persistence, privilege-escalation, defense-evasion, discovery, lateral-movement,
command-and-control
execution, persistence, privilege-escalation, defense-evasion, credential-access, discovery
execution, persistence, privilege-escalation, defense-evasion, discovery, lateral-movement
execution, persistence, privilege-escalation, defense-evasion, lateral-movement, exﬁltration
persistence, privilege-escalation, defense-evasion, discovery, lateral-movement
execution, persistence, privilege-escalation, defense-evasion, discovery
persistence, privilege-escalation, defense-evasion, discovery, exﬁltration
execution, persistence, privilege-escalation, lateral-movement, exﬁltration
execution, persistence, privilege-escalation, defense-evasion, discovery
persistence, privilege-escalation, defense-evasion, discovery, exﬁltration
execution, persistence, defense-evasion, discovery, exﬁltration
initial-access, execution, persistence, defense-evasion, exﬁltration
execution, persistence, lateral-movement, exﬁltration
execution, persistence, lateral-movement, command-and-control
execution, defense-evasion, discovery, lateral-movement
execution, defense-evasion, discovery, lateral-movement
Path: c:/windows/system32/spool/drivers/x64/3/sandcat.go-windows
T1105
RemoteFileCopy_SND_PECreation
command-and-control,
lateral-movement
T1086
PS_Launch,eAccountDiscovery
execution
PROCESS_LAUNCH
powershell.exe
powershell.exe
powershell.exe
powershell.exe
cmd.exe
T1049
Nbtstat
discovery
T1082
SystemInformationDiscovery
discovery
T1070
Wevtutil
defense-evasion
T1086
PS_Launch
execution
powershell.exe
c:/windows/system32/nbtstat.exe
c:/windows/system32/gpresult.exe
c:/windows/system32/wevtutil.exe
c:/windows/system32/svchstpfdr.exe
T1086
PS_Launch,eAccountDiscovery
execution
powershell.exe
powershell.exe
T1047
WindowsManagementInstrumentation
execution
wmic.exe
powershell.exe
T1003
PS_mimikatz
credential-access
T1086
PS_Launch,eSvcExecution
execution
T1076
RemoteDesktopProtocol
lateral-movement
powershell.exe
powershell.exe
powershell.exe
powershell.exe
powershell.exe
T1033
Whoami
discovery
src: 100.119.193.104:51636
dst: 100.119.194.151:3389
T1086
PS_Launch
execution
powershell.exe
T1086
PS_Launch
execution
 c:/windows/system32/whoami.exe
T1002
CompressedFileCreation
exﬁltration
Path: c:/windows/system32/spool/drivers/x64/3/pstools.zip
(a)
n
o
i
t
a
e
r
C
E
P
_
D
N
S
_
y
p
o
C
e
t
n
e
m
e
v
o
m
-
l
a
r
e
t
a
l
,
l
o
r
t
n
o
c
-
d
n
a
-
d
n
a
m
m
o
c
t
n
e
m
e
v
o
m
-
l
a
r
e
t
a
l
,
l
l
i
F
e
t
o
m
e
R
5
0
1
1
T
n
o
i
t
a
e
r
C
E
P
_
D
N
S
_
y
p
o
C
e
o
r
t
n
o
c
-
d
n
a
-
d
n
a
m
m
o
c
l
i
F
e
t
o
m
e
R
5
0
1
1
T
Path: c:/windows/system32/pstools/pspasswd.exe
Path: c:/windows/system32/pstools/psinfo.exe
Path: c:/windows/system32/pstools/pspasswd64.exe
Path: c:/windows/system32/pstools/pslist.exe
Path: c:/windows/system32/pstools/pssuspend64.exe
Path: c:/windows/system32/pstools/psping64.exe
Path: c:/windows/system32/pstools/psservice.exe
Path: c:/windows/system32/pstools/psﬁle.exe
Path: c:/windows/system32/pstools/psloggedon64.exe
Path: c:/windows/system32/pstools/psﬁle64.exe
Path: c:/windows/system32/pstools/psservice64.exe
Path: c:/windows/system32/pstools/pslist64.exe
Path: c:/windows/system32/pstools/psloggedon.exe
Path: c:/windows/system32/pstools/psping.exe
Start
T1086
ePS_Launch
execution
T1076
RemoteDesktopProtocol
lateral-movement
T1105
RemoteFileCopy_SND_PECreation
command-and-control,lateral-movement
T1086
PS_Launch
execution
WindowsManagementInstrumentation
T1047
execution
T1086
PS_Launch
execution
PS_Launch,eSvcExecution
T1086
execution
T1086
PS_Launch
execution
T1049
Nbtstat
discovery
PS_Launch,eAccountDiscovery
T1086
execution
T1223
PFDR_CHMFile
defense-evasion,execution
T1105
RemoteFileCopy_SND_PECreation
command-and-control,lateral-movement
T1002
CompressedFileCreation
exfiltration
SystemInformationDiscovery
T1082
discovery
T1086
PS_Launch
execution
T1033
Whoami
discovery
T1086
PS_Launch
execution
T1070
Wevtutil
defense-evasion
T1003
PS_mimikatz
credential-access
T1086
PS_Launch
execution
(b)
Fig. 17: Caldera attack scenario. (a) IIP Vertex graph generated by RapSheet. We have omitted some of the edges and vertices from the
graph for presentation. Complete IIP graph consists of 49 edges and 50 vertices. (b) Tactical Provenance Graph for Caldera attack after
applying readability pass. RapSheet will choose the maximum ordered tactic sequence from this TPG for the ﬁnal threat score assignment.
As a ﬁrst step, we manually installed the client agent on one
machine. This is a realistic scenario, since the initial infection
stage is often missed by deployed defenses, either because
a zero-day vulnerability is exploited or because the agent is
installed by an unsuspecting, legitimate user. We then conﬁg-
ured the command-and-control server to issue commands to
discover other machines on the network, attempt to log in to
those machines using stolen credential, copy the agent to any
machines it successfully logged into, search for document ﬁles
on all infected machines, zip up any found ﬁles and exﬁltrate
the ﬁles by sending the stolen ﬁle archives to the command
and control server.
This covers a variety of ATT&CK techniques, from System
User Discovery (T1033) to Remote File Copy (T1105), and
several tactics including credential access, lateral movement,
and exﬁltration on the victim hosts. The IIP vertex graph and
tactical provenance graph for one of the victim machines are
shown in Figure 17.
Authorized licensed use limited to: Tsinghua University. Downloaded on March 19,2021 at 09:41:13 UTC from IEEE Xplore.  Restrictions apply. 
1189