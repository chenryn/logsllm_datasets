title:Component-Based Formal Analysis of 5G-AKA: Channel Assumptions and
Session Confusion
author:Cas Cremers and
Martin Dehnel-Wild
Component-Based Formal Analysis of 5G-AKA:
Channel Assumptions and Session Confusion
Cas Cremers
Martin Dehnel-Wild
CISPA Helmholtz Center for Information Security, Germany
Department of Computer Science, University of Oxford
cremers@cispa.saarland
PI:EMAIL
Abstract—The 5G mobile telephony standards are nearing
completion; upon adoption these will be used by billions across
the globe. Ensuring the security of 5G communication is of the
utmost importance, building trust in a critical component of
everyday life and national infrastructure.
We perform ﬁne-grained formal analysis of 5G’s main au-
thentication and key agreement protocol (AKA), and provide
the ﬁrst models to explicitly consider all parties deﬁned by the
protocol speciﬁcation. Our analysis reveals that the security of
5G-AKA critically relies on unstated assumptions on the inner
workings of the underlying channels. In practice this means that
following the 5G-AKA speciﬁcation, a provider can easily and
‘correctly’ implement the standard insecurely, leaving the protocol
vulnerable to a security-critical race condition. We provide the
ﬁrst models and analysis considering component and channel
compromise in 5G, whose results further demonstrate the fragility
and subtle trust assumptions of the 5G-AKA protocol.
We propose formally veriﬁed ﬁxes to the encountered issues,
and have worked with 3GPP to ensure these ﬁxes are adopted.
I.
INTRODUCTION
The 5th Generation (5G) mobile networks and telecom-
munications standard is currently under development, and are
nearly ﬁnalised. A crucial building block in this standard is the
“5G Authentication and Key Agreement” (5G-AKA) protocol.
This protocol is developed by 3GPP, and is an evolution
of the AKA variants used in 3G and 4G, and is used to
authenticate and establish keys between the involved parties.
These parties include the subscribers, the networks within close
range (referred to as Serving Networks), and the subscribers’
carriers (referred to as Home Networks). The security of all
5G communication therefore crucially relies on 5G-AKA.
Traditionally, security protocols standards were not devel-
oped in tandem with rigorous security analysis, leading to many
vulnerabilities being found after deployment. More recently,
there has been a positive trend in which rigorous scientiﬁc
analysis has been part of the development process; most notably
IETF’s TLS 1.3 protocol [25], which has beneﬁted from being
developed in tandem with a range of analysis methods [24].
Given the extremely wide deployment of 5G in the near future,
it seems prudent to perform state-of-the-art analysis for this
standard as well.
Network and Distributed Systems Security (NDSS) Symposium 2019
24-27 February 2019, San Diego, CA, USA
ISBN 1-891562-55-X
https://dx.doi.org/10.14722/ndss.2019.23394
www.ndss-symposium.org
Methodology Our work aims to provide rigorous formal
analysis and to improve the security of the 5G-AKA stan-
dard. Our approach uses formal symbolic modeling with the
TAMARIN prover [21], which has been successfully used during
the development of major protocols such as TLS 1.3 [16].
Several aspects of the 5G-AKA protocol complicate formal
analysis. The ﬁrst is the sheer complexity of the speciﬁcation
documentation, which spans hundreds of pages. The second
is the complexity of the protocol, which involves four parties,
depends on sequence counters for its security, and complex
channel assumptions. The third is the informal nature of the
security requirements, which mean the modeler has to make
complex assumptions on the basis of the possible use cases.
We closely model the 5G-AKA speciﬁcation: in particular,
we explicitly model all four main parties in the speciﬁcation,
in which Home Networks include a separate component for
credential storage that may be implemented in e.g., a hardware
security module. We explicitly model possible assumptions on
the channels connecting these four parties. We then analyse
the resulting system model with respect to a range of threat
models, including compromised components and channels.
Related work Previous versions of AKA have been analysed
after deployment, and typically used simpliﬁed models.
The original 3G AKA protocol was manually analysed in
1999 [1], using TLA and BAN Logic. Both these methods
consider abstract models that are much coarser than modern
techniques, only considering very weak threat models.
In 2012, Tsay and Mjølsnes presented a vulnerability [26]
on the older UMTS-AKA and LTE-AKA protocols. This attack
allows for a violation of authentication properties based upon
session confusion. The attack in [26] was found indirectly
through use of CryptoVerif [13]. We will return to the relation
between this work and ours in VIII.
Køien [19] proposes improvements to 4G’s AKA, achieving
full mutual online authentication. Previous AKA protocols
delegate authority from the home network to a serving network
by forwarding up to 5 irrevocable authentication vectors,
allowing the home network to be ofﬂine during the challenge-
response phase of the protocol: this requires too high a level of
trust between network operators, hence they propose a modiﬁed
protocol which is fully online for all parties. 5G-AKA now
only forwards one authentication vector at a time.
Arapinis et al. [9] analyse 3G’s authentication protocols, dis-
covering attacks against the privacy and linkability of subscriber
identities. This modelling and analysis uses ProVerif, formally
verifying the proposed solutions achieving unlinkability and
anonymity. O’Hanlon et al. [23] consider the interaction
between 4G’s authentication protocols and operator-backed
WiFi services; they detail how the interaction between these can
enable serious privacy violations, as well as their experiences
reporting the discovered issues to the relevant stakeholders.
Hussain et al. [18] combine symbolic model checking with
cryptographic protocol veriﬁcation for 4G’s attach, detach, and
paging procedures, discovering 10 new attacks, including an
authentication relay attack, allowing an adversary to spoof the
location of a legitimate user.
In recent concurrent work [11], Basin et al. use a similar
approach to ours to analyse 5G-AKA, but focus on different
aspects. Basin et al. model and analyse a 3-party interpretation
of the 5G-AKA protocol and its security properties, merging
two major components (the AUSF and ARPF) to form a single
‘Home Network’ entity, similar to previous AKA versions.
They discovered the authentication issues created by lack of
integrity protection on the serving network’s ID. In contrast, we
model all four parties as deﬁned in the protocol’s speciﬁcation,
and consider a range of compromise models. In this sense,
our results are orthogonal: we focus on a more ﬁne-grained
model with a large range of compromise models, while Basin
et al.’s models put more focus on detailed analysis of the
counter re-synchronisation method and the privacy guarantees
of 5G-AKA. They additionally model and analyse the ‘Elliptic
Curve Integrated Encryption Scheme’ which 5G-AKA uses
for SUPI concealment to ensure subscriber privacy. Beyond
simple conﬁrmation of these results, we do not consider privacy-
speciﬁc properties within 5G. While in theory one would like
to model all aspects at once in a single model, the analysis of
the individual models is already very complex using current
technology: analysing a combined model does not yet seem
feasible. In practice, this means that the individual models
cover partially overlapping, but different classes of attacks. For
example, our model does consider attacks on privacy, whereas
the attack we detail later is not visible in the model from [11].
Contributions: We provide three main contributions. First,
we propose a ﬁne-grained formal model of the 5G-AKA
standard that enables a detailed view of the interaction between
the various security-critical components.
Second, we perform symbolic analysis of this model with
respect to a range of threat models. Our analysis conﬁrms
many already discovered issues and subtle assumptions and
requirements to achieve security in 5G-AKA.
Third, our analysis reveals that the security of 5G-AKA
critically relies on unstated assumptions on the inner workings
of the underlying channels. In particular, the automated analysis
discovers an attack that exploits a potential race condition.
We additionally show that solving the race condition for the
honest case does not necessarily prevent the attack. In practice
this means that solely based on the 5G-AKA speciﬁcation, a
provider can implement the standard insecurely. We propose
ﬁxes and prove that they prevent the attack. We have reported
our ﬁndings to the 3GPP SA3 working group and are working
with a major provider to integrate a ﬁx to the standard.
The complete TAMARIN models can be found at [15].
Overview: We structure our work in three main parts.
In the ﬁrst part, we describe the protocol (Section II), the threat
model implied by the standard (Section III), security properties
(Section IV), and its formalisation (Section V and VI.)
In the second part, we formalise and model a basic threat
model, and perform analysis in Sections VII to IX. We then
consider the modelling, analysis, results, and consequences of
stronger threat models that involve channel and component
compromise in Section X.
Finally, in the third part, we discuss the potential impli-
cations of these results, we discuss our interaction with the
3GPP working groups and upcoming changes to the standard
(TS 33.501 [5]) in Section XI, before concluding in Section XII.
II. THE 5G-AKA PROTOCOL
The 5G-AKA protocol is the “Authentication and Key
Agreement” protocol within the newly proposed 5G standard,
and therefore is the core building block for the security
guarantees of the standard. 5G-AKA has evolved from the EPS-
AKA protocol as used by 4G/LTE [7]. The 5G-AKA protocol
is speciﬁed within §6.1.3.2 of 3GPP Technical Speciﬁcation
33.501 [5]; here we model version v0.7.0.
We distinguish between the “home network”, e.g., the
network that the user signed up with, and the “serving network”,
which is the actual network that the phone connects to. While
the home network can be the same as the serving network, they
are different in a roaming scenario.
The 5G-AKA protocol establishes authentication and key
agreement between a mobile device, a serving network, and
the device’s home network. The standard additionally spec-
iﬁes a credential repository, which resides within the home
network. The protocol is therefore speciﬁed as a sequence of
communications between four roles:
• UE:
the ‘User Equipment’. This can be e.g., mobile phones
or USB dongles. Each UE is uniquely identiﬁed by its
SUbscription Permanent Identiﬁer (SUPI). In 5G, the SUPI
replaces the ‘IMSI’ in pre-5G standards.
the ‘Security Anchor Function’. In the roaming
context, this is within the serving network, e.g., the network
that the phone connects to in a remote location.
• SEAF:
• AUSF:
the ‘Authentication Server Function’. This falls
within the home network, e.g., the network of the phone’s
service provider.
the ‘Authentication credential Repository and
Processing Function’. In the home network. Often resides in
a secure location, e.g., a Hardware Security Module.
• ARPF:
See Figure 1 for a diagram illustrating the parties and channels
in the 5G-AKA protocol; in this example, a mobile phone user
Insecure
Secure
Secure
Insecure
UE
SEAF
Secure
AUSF
Secure
ARPF
e.g., Mobile Phone Authentication for
serving network
Authentication for
home network
Credential Store for
home network
Parties and channels involved in the 5G-AKA protocol. The dashed
Fig. 1.
box represents the 5G core network; dashed channels are considered ‘secure’.
2
is roaming, communicating back to their home network.
The UE and ARPF alone share the user’s long-term
secret symmetric key, K. The SUPI should never be exposed
publicly: a ‘SUbscription Concealed Identiﬁer’ or SUCI is
used to achieve this. The SIDF, or the Subscriber Identity
De-concealing Function is used to decrypt a SUCI value into
a SUPI: this functionality is co-located with the ARPF.
At the end of a successful run of the protocol, all parties
can derive and agree upon an ‘anchor key’ KSEAF, from which
session keys for communication between the mobile device and
base station(s) within the local network are derived. After the
protocol, all communication between UE and the core network
uses this key or keys derived from it. The secrecy of the key
KSEAF is therefore crucial to ensure the security of subsequent
operations and communications.
Normal execution of the 5G-AKA protocol
We give an overview of the core of the 5G-AKA protocol
execution, as described in [5, §6.1.3.2]. We give the correspond-
ing message sequence chart in Figure 2.
1) SUCI, HN: The UE sends its encrypted ‘concealed ID’
(SUCI, encrypted with a variant of the Elliptic Curve
Integrated Encryption Scheme) and the name of its home
network to a SEAF in the serving network. In the case that
the SUPI is not concealed, it just sends the SUPI value
unencrypted.
2) 5G-AIR: The SEAF sends a 5G-AIR message containing
the previous message and the name of the serving network
to an AUSF in the relevant home network.
3) Auth-Info Request: The AUSF then transmits this
information in an ‘Auth-Info Request’ message to
the home network’s ARPF.
4) Auth-Info Response: The ARPF a) Requests de-
concealment of the SUCI into its respective SUPI from
the Subscriber Identity De-concealing Function, or SIDF.
b) The ARPF retrieves the relevant K for this user, and
c) Generates a 128-bit random number ‘RAND’, a single
AUTN value derived from RAND and the user’s long-
term key K, an ‘Expected Response’ value (XRES*), and
a session key for the AUSF, KAUSF. These are sent to
the AUSF in an ‘Auth-Info Response’ message. The
‘Expected Response’ value is a hash of the derived keys,
RAND, and SNID (i.e., the ID of the serving network being
used); possession of it enables other parties (which may not
know K) to verify that the user responded correctly.
5) 5G-AIA: The AUSF sends a 5G-AIA message containing
AUTN, a hash of the ‘Expected Response’ (i.e., HXRES*),
the new ‘anchor key’ KSEAF derived from KAUSF, and the
SUPI of the intended recipient.
6) Auth-Req: The SEAF sends RAND and AUTN to the UE
in an Auth-Req message.
7) Auth-Resp: The UE proves its identity, and implicitly,
ownership of K, by responding to the SEAF with RES*
(i.e., the ‘Response’) within an Auth-Resp message; the
UE can now calculate the keys KAUSF and KSEAF.
8) 5G-AC and 5G-ACA: The SEAF calculates the hash of
RES* (i.e., HRES*) received from the UE and checks it
matches the hash of the ‘Expected Response’, HXRES*
from the AUSF. If so, the SEAF considers the authentica-
tion successful, and sends an Authentication Conﬁrmation
(5G-AC) message containing the user’s SUPI, the serving
network’s ID, and the response, to the AUSF. The AUSF
acknowledges this, replying with a 5G-ACA message.