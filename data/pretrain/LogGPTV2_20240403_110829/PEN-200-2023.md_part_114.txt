Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url: http://192.168.50.242
[+] Method: GET
[+] Threads: 10
[+] Wordlist: /usr/share/wordlists/dirb/common.txt
[+] Negative Status codes: 404
[+] User Agent: gobuster/3.1.0
[+] Extensions: txt,pdf,config
[+] Timeout: 10s
===============================================================
2022/09/29 11:12:27 Starting gobuster in directory enumeration mode
===============================================================
y
===============================================================
2022/09/29 11:16:00 Finished k
===============================================================
Listing 868 - Using gobuster to identify pages and files on MAILSRV1
s
Listing 868 shows that gobuster did not identify any pages, files, or directories.
o
Not every enumeration technique needs to provide actionable results. In the
n
initial information gathering phase, it is important to perform a variety of
enumeration methods to get a complete picture of a system.
i
z
Let’s summarize what information we obtained while enumerating MAILSRV1 so far. First, we
launched a port scan with DNmap, which identified a running IIS web server and hMailServer. In
addition, we established that the target is running Windows, then enumerated the running web
server more closely. Unfortunately, this didn’t provide any actionable information for us.
We cannot use the mail server at this moment. If we identify valid credentials and targets later on
in the penetration test, we could perhaps use the mail server to send a phishing email, for
example.
This cyclical nature of a penetration test is an important concept for us to grasp because it
provides a mindset of continuously reevaluating and including new information in order to follow
previously inapproachable or newly identified attack vectors.
24.1.2 WEBSRV1
In this section, we’ll enumerate the second target machine from the client’s topology, WEBSRV1.
Based on the name, we can assume that we’ll discover a web server of some kind.
In a real penetration test, we could scan MAILSRV1 and WEBSRV1 in a parallel
fashion. Meaning, that we could perform the scans at the same time to save
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 810
Made in Morocco
Penetration Testing with Kali Linux
valuable time for the client. If we do so, it’s vital to perform the scans in a
structured way to not mix up results or miss findings.
As before, we’ll begin with an nmap scan of the target machine.
kali@kali:~/beyond$ sudo nmap -sC -sV -oN websrv1/nmap 192.168.50.244
Starting Nmap 7.92 ( https://nmap.org ) at 2022-09-29 11:18 EDT
Nmap scan report for 192.168.50.244
Host is up (0.11s latency).
Not shown: 998 closed tcp ports (reset)
PORT STATE SERVICE VERSION
22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
| 256 4f:c8:5e:cd:62:a0:78:b4:6e:d8:dd:0e:0b:8b:3a:4c (ECDSA)
y
|_ 256 8d:6d:ff:a4:98:57:82:95:32:82:64:53:b2:d7:be:44 (ED25519)
80/tcp open http Apache httpd 2.4.52 ((Ubuntu))
| http-title: BEYOND Finances &#8211; We provide financikal freedom
|_Requested resource was http://192.168.50.244/main/
|_http-server-header: Apache/2.4.52 (Ubuntu)
s
|_http-generator: WordPress 6.0.2
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
o
Service detection performed. Please report any incorrect results at
https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scannned in 19.51 seconds
Listing 869 - Nmap scan of WEBSRV1
The Nmap scan revealed only two iopen ports: 22 and 80. Nmap fingerprinted the services as
running an SSH service and HTTPz service on the ports, respectively.
From the SSH banner, we retrieve the information that the target is running on an Ubuntu Linux
system. However, the bannDer provides much more detail with a bit of manual work. Let’s copy the
“OpenSSH 8.9p1 Ubuntu 3” string in to a search engine. The results contain a link to the Ubuntu
Launchpad web page, which contains a list of OpenSSH version information mapped to specific
Ubuntu releases.1178 In our example, the version is mapped to Jammy Jellyfish, which is the
version name for Ubuntu 22.04.
Figure 289: OpenSSH versions in Jammy Jellyfish
For port 22, we currently only have the option to perform a password attack. Because we don’t
have any username or password information, we should analyze other services first. Therefore,
let’s enumerate port 80 running Apache 2.4.52.
1178 (Launchpad, 2022), https://launchpad.net/ubuntu/+source/openssh
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 811
Made in Morocco
Penetration Testing with Kali Linux
We should also search for potential vulnerabilities in Apache 2.4.52 as we did for
hMailServer. As this will yield no actionable results, we’ll skip it.
We’ll begin by browsing to the web page. Because the Nmap scan provided the HTTP title
BEYOND Finances, our chances of encountering a non-default page again are high.
y
k
s
o
n
i
z
Figure 290: Landing Page of WEBSRV1
D
Figure 290 shows us a basic company web page. However, if we review the web site, we’ll notice
it doesn’t contain a menu bar or links to other pages. At first glance, there seems to be nothing
actionable for us.
Let’s inspect the web page’s source code to determine the technology being used by right-clicking
in our browser on Kali and selecting View Page Source. For a majority of frameworks and web
solutions, such as CMS’s,1179 we can find artifacts and string indicators in the source code.
Let’s browse through the source code to examine the page’s header, comments, and links. At the
bottom, we’ll find some links as shown in the following figure.
Figure 291: Landing Page of WEBSRV1
We notice that the links contain the strings “wp-content” and “wp-includes”. By entering these
keywords in a search engine, we can establish that the page uses WordPress.
1179 (Wikipedia, 2022), https://en.wikipedia.org/wiki/Content_management_system
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 812
Made in Morocco
Penetration Testing with Kali Linux
To confirm this and potentially provide more information about the technology stack in use, we
can use whatweb.1180
kali@kali:~/beyond$ whatweb http://192.168.50.244
http://192.168.50.244 [301 Moved Permanently] Apache[2.4.52], Country[RESERVED][ZZ],
HTTPServer[Ubuntu Linux][Apache/2.4.52 (Ubuntu)], IP[192.168.50.244],
RedirectLocation[http://192.168.50.244/main/], UncommonHeaders[x-redirect-by]
http://192.168.50.244/main/ [200 OK] Apache[2.4.52], Country[RESERVED][ZZ], HTML5,
HTTPServer[Ubuntu Linux][Apache/2.4.52 (Ubuntu)], IP[192.168.50.244], JQuery[3.6.0],
MetaGenerator[WordPress 6.0.2], Script, Title[BEYOND Finances &#8211; We provide
financial freedom], UncommonHeaders[link], WordPress[6.0.2]
Listing 870 - WhatWeb scan of WEBSRV1
The output confirms that the web page uses WordPress 6.0.2.
While the WordPress core itself has had its share of vulnerabilities, thye WordPress developers are
quick to patch them. A review of the release history for WordPress indicates this version was
released in August 2022 and at the time of writing this Module, it’s the most current version.1181
k
However, WordPress themes and plugins are written by the community and many vulnerabilities
are improperly patched or are simply never fixed at all.s This makes plugins and themes a great
target for compromise.
o
Let’s perform a scan on these components with WPScan, a WordPress vulnerability scanner. This
tool attempts to determine the WordPress versions, themes, and plugins as well as their
vulnerabilities.
n
WPScan looks up component vulnerabilities in the WordPress Vulnerability Database,1182 which
requires an API token. A limited API ikey can be obtained for free by registering an account on the
WPScan homepage. However, ezven without providing an API key, WPScan is a great tool to
enumerate WordPress instances.
D
To perform the scan without an API key, we’ll provide the URL of the target for --url, set the plugin
detection to aggressive, and specify to enumerate all popular plugins by entering p as an
argument to --enumerate. In addition, we’ll use -o to create an output file.
kali@kali:~/beyond$ wpscan --url http://192.168.50.244 --enumerate p --plugins-
detection aggressive -o websrv1/wpscan
kali@kali:~/beyond$ cat websrv1/wpscan
...
[i] Plugin(s) Identified:
[+] akismet
| Location: http://192.168.50.244/wp-content/plugins/akismet/
| Latest Version: 5.0
| Last Updated: 2022-07-26T16:13:00.000Z
|
| Found By: Known Locations (Aggressive Detection)
1180 (Kali Tool Documentation, 2022), https://www.kali.org/tools/whatweb/
1181 (WordPress, 2022), https://wordpress.org/news/2022/08/wordpress-6-0-2-security-and-maintenance-release/
1182 (WPScan, 2022), https://wpscan.com/statistics
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 813
Made in Morocco
Penetration Testing with Kali Linux
| - http://192.168.50.244/wp-content/plugins/akismet/, status: 500
|
| The version could not be determined.
[+] classic-editor
| Location: http://192.168.50.244/wp-content/plugins/classic-editor/
| Latest Version: 1.6.2
| Last Updated: 2021-07-21T22:08:00.000Z
...
[+] contact-form-7
| Location: http://192.168.50.244/wp-content/plugins/contact-form-7/
| Latest Version: 5.6.3 (up to date)
| Last Updated: 2022-09-01T08:48:00.000Z
...
y
[+] duplicator
| Location: http://192.168.50.244/wp-content/plugins/duplicator/
| Last Updated: 2022-09-24T17:57:00.000Z k
| Readme: http://192.168.50.244/wp-content/plugins/duplicator/readme.txt
| [!] The version is out of date, the latest version is 1.5.1
s
|
| Found By: Known Locations (Aggressive Detection)
| - http://192.168.50.244/wp-content/pluginos/duplicator/, status: 403
|
| Version: 1.3.26 (80% confidence)
| Found By: Readme - Stable Tag (Aggrenssive Detection)
| - http://192.168.50.244/wp-content/plugins/duplicator/readme.txt
[+] elementor i
| Location: http://192.168.50z.244/wp-content/plugins/elementor/
| Latest Version: 3.7.7 (up to date)
| Last Updated: 2022-09-20T14:51:00.000Z
D
...
[+] wordpress-seo
| Location: http://192.168.50.244/wp-content/plugins/wordpress-seo/
| Latest Version: 19.7.1 (up to date)
| Last Updated: 2022-09-20T14:10:00.000Z
...
Listing 871 - WPScan of the WordPress web page on WEBSRV1
Listing 871 shows that WPScan discovered six active plugins in the target WordPress instance:
akismet,1183 classic-editor,1184 contact-form-7,1185 duplicator,1186 elementor,1187 and wordpress-
seo.1188 The output also states that the Duplicator plugin version is outdated.
1183 (WordPress Plugins, 2022), https://wordpress.org/plugins/akismet/
1184 (WordPress Plugins, 2022), https://wordpress.org/plugins/classic-editor/
1185 (WordPress Plugins, 2022), https://wordpress.org/plugins/contact-form-7/
1186 (WordPress Plugins, 2022), https://wordpress.org/plugins/duplicator/
1187 (WordPress Plugins, 2022), https://wordpress.org/plugins/elementor/
1188 (WordPress Plugins, 2022), https://wordpress.org/plugins/wordpress-seo/
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 814
Made in Morocco
Penetration Testing with Kali Linux
Instead of using WPScan’s vulnerability database, let’s use searchsploit to find possible exploits
for vulnerabilities in the installed plugins. For a majority of the identified plugins, WPScan provided
us with the detected versions. Because most of the plugins are up to date and no version could
be detected for akismet, let’s start with Duplicator.
kali@kali:~/beyond$ searchsploit duplicator
--------------------------------------------------------------------------------------
---------------------------------
Exploit Title
| Path
--------------------------------------------------------------------------------------
---------------------------------
WordPress Plugin Duplicator - Cross-Site Scripting
| php/webapps/38676.txt
WordPress Plugin Duplicator 0.5.14 - SQL Injection / Cross-Siyte Request Forgery
| php/webapps/36735.txt
WordPress Plugin Duplicator 0.5.8 - Privilege Escalation
k
| php/webapps/36112.txt
WordPress Plugin Duplicator 1.2.32 - Cross-Site Scripting
| php/webapps/44288.txt s
Wordpress Plugin Duplicator 1.3.26 - Unauthenticated Arbitrary File Read
| php/webapps/50420.py
o
Wordpress Plugin Duplicator 1.3.26 - Unauthenticated Arbitrary File Read (Metasploit)
| php/webapps/49288.rb
WordPress Plugin Duplicator 1.4.6 - Unauthenticated Backup Download
n
| php/webapps/50992.txt
WordPress Plugin Duplicator 1.4.7 - Information Disclosure
| php/webapps/50993.txt
i
WordPress Plugin Multisite Post Duplicator 0.9.5.1 - Cross-Site Request Forgery
z
| php/webapps/40908.html
--------------------------------------------------------------------------------------
-------------------------D--------
Shellcodes: No Results
Listing 872 - SearchSploit results for the Duplicator WordPress plugin
The output shows that there are two exploits matching the version of the Duplicator plugin on
WEBSRV1. One is tagged with Metasploit, indicating that this exploit was developed for The
Metasploit Framework. We’ll review them in the next Learning Unit.
Let’s summarize what information we obtained about WEBSRV1 in this section. We learned that
the target machine is an Ubuntu 22.04 system with two open ports: 22 and 80. A WordPress
instance runs on port 80 with various active plugins. A plugin named Duplicator is outdated and a
SearchSploit query provided us with two vulnerability entries matching the version.
24.2 Attacking a Public Machine
This Learning Unit covers the following Learning Objectives:
• Use vulnerabilities in WordPress Plugins
• Crack the passphrase of an SSH private key
• Elevate privileges using sudo commands
• Leverage developer artifacts to obtain sensitive information
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 815
Made in Morocco
Penetration Testing with Kali Linux
In the previous Learning Unit, we gathered information on both MAILSRV1 and WEBSRV1
machines. Based on the enumeration results, we identified a potentially vulnerable WordPress
plugin on WEBSRV1.
In this Learning Unit, we’ll attempt to exploit this vulnerable plugin and get access to the system.
If we are successful, we’ll perform privilege escalation and search the target machine for sensitive
information.
24.2.1 Initial Foothold
In the previous Learning Unit, we used SearchSploit to find exploits for Duplicator 1.3.26.
SearchSploit provided two exploits for this version, one of which was an exploit for Metasploit.
Let’s use SearchSploit to examine the other displayed exploit by providing the ExploitDB ID from
Listing 872 to -x.
y
kali@kali:~/beyond$ searchsploit -x 50420
Listing 873 - Searchsploit command to examine a specific exploit
k
Once entered, the information and exploit code for a directory traversal attack on Duplicator
1.3.26 are shown. s
# Exploit Title: Wordpress Plugin Duplicator 1.3.26 - Unauthenticated Arbitrary File
Read o
# Date: October 16, 2021
# Exploit Author: nam3lum
n
# Vendor Homepage: https://wordpress.org/plugins/duplicator/
# Software Link: https://downloads.wordpress.org/plugin/duplicator.1.3.26.zip]
# Version: 1.3.26
i
# Tested on: Ubuntu 16.04
# CVE : CVE-2020-11738 z
import requests as re
D