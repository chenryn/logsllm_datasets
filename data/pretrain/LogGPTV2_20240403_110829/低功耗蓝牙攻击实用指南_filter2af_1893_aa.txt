# 低功耗蓝牙攻击实用指南
|
##### 译文声明
本文是翻译文章，文章原作者 attify，文章来源：blog.attify.com
原文地址：
译文仅供参考，具体内容表达以及含义原文为准。
众所周时，蓝牙是当下无线网络技术中最受欢迎和常用一种。伴随着蓝牙技术在物联网中的发展，蓝牙技术联盟以信标、医疗保健、娱乐、健身为核心不断努力提升传输速度。
低功耗功耗蓝牙（BLE）是蓝牙4.0规范的一部份，它还包含传统蓝牙和蓝牙高速传输协议。与传统蓝牙相比，BLE 在保持相同的通信范围的同时，功耗更低。BLE
是一种“总是关闭”的技术，期间只需传输少量的数据。这大大降低了功耗，使其非常适合在需要具有低数据速率的持久长连接的情况下使用。蓝牙非常适合做电视遥控，但是不适合需要传输大量数据的无线流媒体设备。
我们现在使用的很多设备内置有低功耗蓝牙。从智能手机、智能电视、医疗设备等先进技术到咖啡机等基本设备都是用了蓝牙。
BLE 源自于诺基亚一个名为“WIBREE“的内部项目，后期被蓝牙技术联盟(SIG)接管。BLE的设计着重于更好的配对速度和能源效率。
## 什么让BLE如此突出?
  * 支持多平台通信：能够轻松的在 Android、IOS、Linux、Windows Phone、 Windows 8 以及 OS X 等平台的大量设备上通信。
  * 更快的匹配速度
  * 有助于维持较长时间的连接
  * 显著降低实施成本
  * 节能
## BLE 听起来不错，它真的那么好吗？
从安全的角度来看，这是个很好的问题。事实是——BLE只是一个协议。这取决与制作商在他们设备上安全的实现
BLE。由于随机数生成器不够“随机”，即使是最强的加密协议也会失败。BLE 也同样适用。可以这么说，BLE 的安全掌握在他的实现者手上。
虽然所有的蓝牙低功耗设备都是以增强用户体验为主要目的开发的，在开发过程中，安全是否退居次要地位?
让我们看看 BLE 可能会让用户暴露的三个主要漏洞:
  1. **窃听：** 顾名思义，窃听是指第三方设备监听两个已配对设备之间的数据交换。两个已经匹配的设备之间的连接建立了信任链。当其中一个设备被移除，信任链就会断开。攻击者可以使用这个设备的单元号取得与另一个蓝牙设备的访问权限。即使此设备的加/解密密钥一倍删除，攻击者仍然可以使用蓝牙嗅探器暴力破解 PIN 码。一旦得到 PIN码，设备极易被劫持。
2. **中间人攻击：** 中间人攻击中第三方设备伪装成合法设备，欺骗两个合法的设备，让它们相信它们之间是相互连接的。事实上，合法的设备被连接到攻击设备上。此中攻击攻击者更够访问正常设备之间的所有交互的数据，以及在数据在到达接收端之前通过删除或者修改方式来伪造数据。
3. **拒绝服务 &模糊攻击（Fuzzing）：**由于目前大多数无线设备都使用内置的电池组，这些设备面临着遭受拒绝服务攻击(DoS)的风险。DoS攻击时系统频繁崩溃，从而导致电池完全耗尽。模糊攻击也会导致系统崩溃，因为攻击者发送畸形的数据到设备的蓝牙广播并检查其响应，最终导致系统崩溃。
## BLE核心概念
BLE 的两个基本概念。
  * **GAP** 通用访问配置文件(Generic Access Profile)
  * **GATT** 通用属性配置文件(Generic Attribute Protocol)
###  通用访问配置文件(GAP)
GAP 用于设备连接和广播通信（advertising）。GAP 负责蓝牙设备对外可见性，并在决定设备如何与其他设备交互时起到重要作用。
以下是 GAP 内部较为重要要两个概念：
**外围设备：** 这些小型低功耗设备可以连接到更为复杂、强大的中心设备。心率检测器就是一个典型的外围设备。
**中心设备：** 此类设备大多是手机或者拥有更大内存、更强处理能力的设备。
####  广播流程（Advertising process）
下图形象的展示了广播和扫描响应是如何工作的。
外围设备每隔2秒发送一次广播数据。如果中心设备监听到了来自外围设备的广播数据，他将回复扫描 **响应请求** 。
作为对该请求的响应，外围设备会发送扫描响应数据。至此，外围中心设备与外围设备均取得了广播，并相互建立了连接。
###  通用属性配置文件(GATT)
GATT 使用一种称为属性协议的通用数据协议，它定义了两个 BLE 设备如何使用服务和属性两个概念进行数据交换。该协议使用蓝牙技术联盟指定的16 位 ID
将所有服务和属性存储在查找表中。需要注意的是，GATT 只有在 GAP 广播流程结束之后才能初始化。
GATT 的两个主要概念：
  * 服务（Services）
  * 属性（Characteristics）
####  服务
服务被简单地定义为一个可以容纳许多抽屉的柜子，这些抽屉又被称为属性。一个服务可以有多个属性。每个服务可以使用官方16位的通用唯一识别码（UUID）或128位自定义的通用唯一识别码（UUID）。
####  属性
属性是 GATT 事务中最基本的概念。属性包含单个数据点，与服务类似，每个属性都有一个用于与其他属性相区别的 ID 或
UUID。例如，健康手环的心率传感器。
这里是BLE设备[
**属性**](https://www.bluetooth.com/specifications/gatt/characteristics)和[
**服务**](https://www.bluetooth.com/specifications/gatt/services)的 SIG 规范。SIG
正式采用的 UUID 在任何一个 BLE 设备中都必须在应用程序中使用他们指定的 ID。
例如，SIG 规定的官方的TX Power 的 UUID 是`0x1804`。
nRF Connect应用扫描的信标(稍后将详细介绍)必须与 SIG 规范中的TX power 的 UUID 保持一致。
###  BLE 利用工具
Linux 对 BLE 提供了很好支持。为了使用 BLE,我们需要安装蓝牙栈（blueZ）。使用以下命令安装BlueZ。
    sudo apt-get install bluez
我们将使用已安装有 bluez 的台式/笔记本电脑。它将作为中心网关与其他外围设备之间通信。BlueZ 的目标是编写和实现蓝牙无线标准规范。在安装好
BlueZ 之后，我么需要两个工具去扫描、连接以及读写数据。
  1. **hcitool**
  2. **gattool**
在开始之前，我们需要周围的 BLE 设备。如果我们需要搞清楚怎么连接 BLE 设备、如何读取数据以及发现设备的漏洞，那么hcitool 必不可少。
####  hcitool
它利用笔记本电脑的主机控制器接口与BLE设备进行通信和读写更改。因此，hcitool在发现可用的广播受害者BLE设备，并在连接后更改值时非常有用。
####  gattool
如上一段所述，gatttool主要用来帮助发现可用 BLE 设备的服务和属性，以便根据攻击者读取/写入受害者的数据。
###  命令手册
####  常用指令
命令 | 功能  
---|---  
hciconfig | 用于配置蓝牙设备。我们可以运行这个命令来列出连接到我们计算机的 BLE 适配器以及它们的基本信息。  
hciconfig hciX up | 启用名为 hciX 的蓝牙设备  
####  Hcitool 命令
hcitool 用于配置蓝牙连接，并向蓝牙设备发送一些特殊命令。
命令 | 功能  
---|---  
hcitool -i hciX | 使用 hciX 接口，如果不指定，默认使用第一个可用接口。  
hcitool -i hciX | 扫描处于发现模式的传统蓝牙设备。  
hcitool lescan | 扫描 BLE 设备。  
更多命令：
####  Gattool 命令
GATT 代表通用属性，定义了用于组织特征和属性的数据结构。
命令 | 功能  
---|---  
gatttool -I | 以交互模式启动 gatttool。  