machine learning &
knowledge extraction
Article
VloGraph: A Virtual Knowledge Graph Framework for
Distributed Security Log Analysis
KabulKurniawan1,2,* ,AndreasEkelhart3,4 ,ElmarKiesling1 ,DietmarWinkler5 ,GeraldQuirchmayr2
andAMinTjoa5
1 InstituteforData,ProcessandKnowledgeManagement,ViennaUniversityofEconomicsandBusiness,
1020Vienna,Austria;PI:EMAIL
2 ResearchGroupMultimediaInformationSystems,UniversityofVienna,1090Vienna,Austria;
PI:EMAIL
3 ResearchGroupSecurityandPrivacy,UniversityofVienna,1090Vienna,Austria;
PI:EMAIL
4 SBAResearch,1040Vienna,Austria
5 InformationandSoftwareEngineering,ViennaUniversityofTechnology,1040Vienna,Austria;
PI:EMAIL(D.W.);PI:EMAIL(A.M.T.)
* Correspondence:PI:EMAIL
Abstract:Theintegrationofheterogeneousandweaklylinkedlogdataposesamajorchallengein
manylog-analyticapplications.Knowledgegraphs(KGs)canfacilitatesuchintegrationbyproviding
aversatilerepresentationthatcaninterlinkobjectsofinterestandenrichlogeventswithbackground
knowledge.Furthermore,graph-patternbasedquerylanguages,suchasSPARQL,cansupportrich
loganalysesbyleveragingsemanticrelationshipsbetweenobjectsinheterogeneouslogstreams.
Constructing,materializing,andmaintainingcentralizedlogknowledgegraphs,however,poses
significantchallenges. Totacklethisissue,weproposeVloGraph—adistributedandvirtualized
(cid:1)(cid:2)(cid:3)(cid:1)(cid:4)(cid:5)(cid:6)(cid:7)(cid:8)(cid:1)
(cid:1)(cid:2)(cid:3)(cid:4)(cid:5)(cid:6)(cid:7) alternative to centralized log knowledge graph construction. The proposed approach does not
involveanyaprioriparsing,aggregation,andprocessingoflogdata,butdynamicallyconstructsa
Citation:Kurniawan,K.;Ekelhart,A.;
virtuallogKGfromheterogeneousrawlogsourcesacrossmultiplehosts.Toexplorethefeasibility
Kiesling,E.;Winkler,D.;Quirchmayr,
ofthisapproach, wedevelopedaprototypeanddemonstrateitsapplicabilitytothreescenarios.
G.;Tjoa,A.M.VloGraph:AVirtual
KnowledgeGraphFrameworkfor Furthermore,weevaluatetheapproachinvariousexperimentalsettingswithmultipleheterogeneous
DistributedSecurityLogAnalysis. logsourcesandmachines;theencouragingresultsfromthisevaluationsuggestthattheapproachcan
Mach.Learn.Knowl.Extr.2022,4, enableefficientgraph-basedad-hocloganalysesinfederatedsettings.
371–396. https://doi.org/10.3390/
make4020016 Keywords:semanticloganalysis;virtualloggraphs;dynamiclogextraction;decentralizedlogquerying;
forensics
AcademicEditor:JánParalicˇ
Received:25February2022
Accepted:3April2022
Published:8April2022 1. Introduction
Publisher’sNote:MDPIstaysneutral Logdataanalysisisacrucialtaskincybersecurity,e.g.,whenmonitoringandaudit-
withregardtojurisdictionalclaimsin ingsystems,collectingthreatintelligence,conductingforensicinvestigationsofincidents,
publishedmapsandinstitutionalaffil- andpro-activelyhuntingthreats[1]. Currentlyavailableloganalysissolutions,suchas
iations. Security Information and Event Management (SIEM) systems, support the process by
aggregatinglogdataaswellasstoringandindexinglogmessagesinacentralrelational
database[2]. Withtheirstrictschemas,however,suchdatabasesarelimitedintheirability
to represent links between entities [3]. This results in a lack of explicit links between
Copyright: © 2022 by the authors.
heterogeneouslogentriesfromdispersedlogsourcesinturnmakesitdifficulttointegrate
Licensee MDPI, Basel, Switzerland.
thepartialandisolatedviewsonsystemstatesandactivitiesreflectedinthevariouslogs.
This article is an open access article
Furthermore,thecentrallogaggregationmodelisalsobandwidth-intensiveandcompu-
distributed under the terms and
tationallydemanding[2,4,5],whichlimitsitsapplicabilityinlarge-scaleinfrastructures.
conditionsoftheCreativeCommons
Withoutadedicatedcentralizedloginfrastructure,however,theprocessnecessarytoac-
Attribution(CCBY)license(https://
quire,integrateandquerylogdataaretediousandinefficient,whichposesakeychallenge
creativecommons.org/licenses/by/
forsecurityanalystswhooftenfacetimecriticaltasks.
4.0/).
Mach.Learn.Knowl.Extr.2022,4,371–396.https://doi.org/10.3390/make4020016 https://www.mdpi.com/journal/make
Mach.Learn.Knowl.Extr.2022,4 372
To illustrate the issue, consider the example in Figure 1. It is based on log data
producedbymulti-stepattacksasdescribedin[6]. Theselogdatasetswillalsobeusedin
ascenarioinSection7. Thevariousstepsoftheattackarereflectedinalargenumberof
logmessagesinadiversesetoflogsourcesdispersedacrossmultiplehostsandfiles(e.g.,
Syslog,ApacheLog,AuthLog,MailLogetc.). VulnerabilityScan,forinstance—whichscansa
systemforknownvulnerabilities—leavessometracesinmultiplelogsourcessuchasSyslog
andApacheLogonHost1andHost3,respectively. UserEnumeration—anactivitythataimsto
guessorconfirmvalidusersinasystem—alsoleavessometracesin(AuthLog,MailLogetc.)
storedonHost1andHost2. Asthisexampleshows,asingleattacksteptypicallyresultsina
largenumberoflogeventsthatcapturecomprehensiveinformation. Thisinformationcan
beusedforloganalysisandattackinvestigation,butcorrelating,tracing,andconnecting
the individual indicators of compromise—e.g., through timestamps, IP addresses, user
names,processesandsoforth—istypicallyachallengingandoftentime-consumingtask.
Thisispartlyduetotheweakstructureoflogsourcesandtheirinconsistentformatand
terminologies. Consequently,itisdifficulttogetacompletepictureofsuspiciousactivities
andunderstandwhathappenedinagivenattack—particularlyinthefaceoffastevolving,
largevolume,andhighlyscatteredlogdata.
Figure1.Motivatingexampleillustratingthatattackstepsleavetracesinvariouslogsourcesacross
multiplehosts,makingitdifficulttoreconstructwhathappened.
Totacklethesechallenges,weproposeVloGraph,adecentralizedframeworktocontex-
tualize,link,andquerylogdata. Weoriginallyintroducedthisframeworkin[7];inthis
paper,weextendthispriorworkwithadetailedrequirementsspecification,evaluation
withtwoadditionalapplicationscenarios,andasectionreflectingupongraph-basedlog
integrationandanalysis,decentralizationandvirtualization,anddiscussingapplications
andlimitations.
Morespecifically,weintroduceamethodtoexecutefederated,graphpattern-based
queriesoverdispersed,heterogeneousrawlogdatabydynamicallyconstructingvirtual
knowledgegraphs[8,9]. Thisknowledge-basedapproachisdesignedtobedecentralized,
flexibleandscalable. Tothisend,it(i)federatesgraph-patternbasedqueriesacrossend-
points,(ii)extractsonlypotentiallyrelevantlogmessages,(iii)integratesthedispersedlog
eventsintoacommongraph,and (iv)linksthemtobackgroundknowledge.
All of these steps are executed at query time without any up-front ingestion and
conversionoflogmessages.
Figure2illustratestheproposedapproach;thevirtuallogknowledgegraphatthe
centerofthefigureisconstructeddynamicallyfromdispersedlogsourcesbasedonanalysts’
queriesandlinkedtoexternalandinternalknowledgesources.
Mach.Learn.Knowl.Extr.2022,4 373
Figure2.Conceptoverview.
Akeyadvantageofthegraph-basedmodelofthisvirtualknowledgegraphisthat
itprovidesaconcise,flexible,andintuitiveabstractionfortherepresentationofvarious
relations such as, e.g., connections in networked systems, hierarchies of processes on
endpoints,associationsbetweenusersandservices,andchainsofindicatorsofcompromise.
These connections automatically link log messages that are related through common
entities (such as users, hosts, and IP addresses); such links are crucial in cybersecurity
investigations,asthreatagentactivitiestypicallyleavetracesinvariouslogfilesthatare
often spread across multiple endpoints in a network, particularly in discovery, lateral
movement,andexfiltrationstagesofanattackATT&CKMatrixforEnterprise[10].
Incontrasttotraditionalworkflowsthatstorelogmessagesinacentralizedrepos-
itory, VloGraph shifts the log parsing workload from ingestion to analysis time. This
makesitpossibletodirectlyaccessanddynamicallyintegratethemostgranularrawlog
datawithoutanylossofinformationthatwouldoccurifthelogswerepre-filteredand
aggregated—typicalstepsperformedbeforetransferringthemtoacentralarchive.
VloGraphtacklesanumberofpressingchallengesinsecurityloganalysis(discussed
inSection4)andfacilitates(i)ad-hocintegrationandsemanticanalysesonrawlogdata
withoutpriorcentralizedmaterialization,(ii)thecollectionofevidence-basedknowledge
fromheterogeneouslogsources,(iii)automatedlinkingoffragmentedknowledgeabout
systemstatesandactivities,and (iv)automatedlinkingtoexternalsecurityknowledge
(suchas,e.g.,attackpatterns,threatimplications,actionableadvice).
Theremainderofthispaperisorganizedasfollows: Section2introducesbackground
knowledgeasconceptualfoundation,includingsemanticstandardsandvirtualknowledge
graphs. Section3providesanoverviewofrelatedworkinthisarea,andinSection4,we
discusschallengesinloganalysisandderiverequirementsforourapproach. Section5
introducestheproposedVloGrapharchitectureanddescribesthecomponentsforvirtual
log knowledge graph construction in detail. In Section 6 we present a prototypical im-
plementationofthearchitectureandillustrateitsuseinthreeapplicationscenarios. We
evaluateourapproachonasystematicallygeneratedlogdatasetinSection7anddiscuss
benefitsandlimitationsofthepresentedapproachinSection8. Finally,weconcludewith
anoutlookonfutureworkinSection9.
2. Background
Inthissection,wefirstprovideabriefbackgroundonlogfilesandformatsandthen
introduceknowledgegraphsasaconceptualfoundationofourapproach.
LogFileFormats
Typically,softwaresystems(operatingsystems,applications,networkdevices,etc.)
producetime-sequencedlogfilestokeeptrackofrelevantevents. Theselogsareusedby
rolessuchasadministrators,securityanalysts,andsoftwaredeveloperstoidentifyand
diagnoseissues. Variousloggingstandardsareinusetoday,oftenfocusedonaspecific
applicationdomain,suchasoperatingsystemlogs(e.g.,syslogd[11]andWindowsEvent
Logs[12]),webserverlogs(e.g.,W3CExtendedlogfileformat[13],NGINXlogging[14]),
databaselogs,firewalllogs,etc.
Mach.Learn.Knowl.Extr.2022,4 374
Logentriesareoftenstoredassemi-structuredlinesoftext,comprisingstructured
parts(e.g.,timestampandseveritylevel)andunstructuredfieldssuchasamessage. While
the structured parts are typically standardized, the content of the unstructured fields
contains context specific information and lacks uniformity. Before plain text log lines
canbe(automatically)analyzed, theymustbesplitintotheirrelevantparts, e.g.,intoa
key-valuebasedrepresentation. Thispre-processingstepoftenreliesonpredefinedregular
expressions. Otherstandards,suchastheWindowsEventLog(EVTX),arealreadyhighly
structuredandsupportXMLorJSON.Despitestandardizationattempts,heterogeneous
logformatsarestilloftenanimpedimenttoeffectiveanalysis. Currentresearchalsostrives
toautomaticallydetectstructureinlogfiles[15]andtoestablishasemanticunderstanding
oflogcontentssuchas[16,17].
KnowledgeGraphs
Aknowledgegraphisadirected,edge-labelledgraphG = (V,E)whereV isasetof
vertices(nodes)andEisasetofedges(properties). Asinglegraphisusuallyrepresented
asacollectionoftriplesT=wheresisasubject, pisapredicate,andoisanobject.
RDF,RDF-S,OWL
ResourceDescriptionFramework(RDF)isastandardizeddatamodelthathasbeen
recommendedbytheW3C[18]torepresentdirectededge-labelledgraphs. InRDF,asubject
is a resource identified by a unique identifier (URI) or a blank-node, an object can be a
resource,blank-nodeorliteral(e.g.,String,number),andpredicateisapropertydefinedin
anontologyandmustbeaURI.
Figure3showsanexcerptofalogknowledgegraphthatexpressesasingleApachelog
eventinRDF.Totheleft,itshowsagraphicalrepresentationofthislogeventandtotheright
arepresentationofthesamegraphinTURTLE[19]serialization. Thesubject:logEntry-24eis
characterizedbyanumberofpropertiesthatspecifyitstype(cl:ApacheLog),thetimestamp
ofcreation,theoriginatehostofthelogevent,theclientthatmadetherequest,andthe
requeststring. Furthermore,thehighlightedIP-Address(inthevisualization)indicatethat
theobjectslinktootherentitiesinthegraph.
Figure3.ExcerptofanRDFloggraphgeneratedfromanApachelogevent.
RDF-S(ResourceDescriptionFrameworkSchema)[20]isaW3Cstandarddatamodel
forknowledgerepresentation. ItextendsthebasicRDFvocabularywithasetofclasses
andRDFSentailment(inferencepatterns)[21]. OWL(OntologyWebLanguage)[22]isalso
aW3Cstandardforauthoringontologies.
SPARQL
SPARQL[23]isaW3CquerylanguagetoretrieveandmanipulatedatastoredinRDF.
Itoffersrichexpressivityforcomplexqueriessuchasaggregation,subqueries,andnegation.
Furthermore,SPARQLprovidescapabilitiestoexpressqueriesacrossmultipledistributed
datasourcesthroughSPARQLqueryfederation[24]. Inthesecuritycontext,thisisamajor
benefit, as security-relevant information is typically dispersed across different systems
andnetworksandrequirestheconsiderationofe.g.,differentlogsources,ITrepositories,
andcyberthreatintelligencesources[25].
Mach.Learn.Knowl.Extr.2022,4 375
VirtualKnowledgeGraphs
TheVirtualKnowledgeGraph(VKG)paradigmfordataintegrationistypicallyused
toprovideintegratedaccesstoheterogeneousrelationaldata. Theapproach—alsoknown
in the literature as Ontology-based Data Access—aims to replace the rigid structure of
tablesintraditionaldataintegrationlayerswiththeflexibilityofgraphs. Thismakesit
possibletoconnectdatasilosbymeansofconceptualgraphrepresentationsthatprovide
anintegratedviewonthedata. Tothisend,VKGsintegratethreemainideas[9]:
• DataVirtualization(V),i.e.,theyprovideaconceptualviewthatavoidsexposingend
userstotheactualdatasources. Thisconceptualviewistypicallynotmaterializedin
ordertomakeitpossibletoquerythedatawithoutpayingapriceintermsofstorage
andtimeforthedatatobemadeaccessible.
• DomainKnowledge(K),i.e.,thegraphscanbeenrichedandcontextualizedwithdomain
knowledgethatmakesitpossibletoderivenewimplicitknowledgefromtheasserted
factsatthetimeaqueryisexecuted.
• GraphRepresentation(G),i.e.,thedataarerepresentedasgraphwhereobjectanddata
values are represented as nodes, and properties of those object are represented as
edges. Comparedtotraditionalrelationalintegrationtables,thegraphrepresentation
providesflexibilityandthroughmappingandmergingmakesiteasiertolinkand
integratedata.
Inthispaper,wefollowtheseprinciplesandgeneralizetheVKGparadigmtoweakly
structuredlogdata.
3. RelatedWork
In this section, we organize the related literature—from general to specific—into
threecategories:
LogManagementandAnalytics
Therisingnumber,volumeandvarietyoflogshascreatedtheneedforsystematic
computersecuritylogmanagement[26]andmotivatedthedevelopmentofawiderange
oflog-analytictechniquestoderiveknowledgefromtheselogs[27],includinganomaly
detection[28,29],clustering[30],and rule-baseintrusiondetection[31].
Inthecontextofourwork,approachesthataimtointegrateandanalyzelogdataacross
multiplesourcesareparticularlyrelevant. SecurityInformationandEventManagement
(SIEM)arewidelyusedtoprovideacentralizedviewonsecurity-relevanteventsinsidean
organizationandfocusondataaggregation,correlation,andtypicallyrule-basedalerting.
Theseideasareoutlinedinnumerousguidelinesandindustrialbestpracticessuchasthe
NISTCybersecurityFramework[32]andNISTSP800-92GuidetoComputerSecurityLog
Management[33]. Inthiscurrentstateofpractice,variouscommercialofferingsprovide
centralizedsolutionse.g. GartnerMagicQuadrantforSIEM2021[34].
WhereasSIEMsfacilitatecentralizedlogaggregationandmanagement,however,they
lackasemanticfoundationforthemanagedlogdataandconsequentlytypicallydonot
makeiteasytolink,contextualize,andinterpreteventsagainstthebackgroundofdomain
knowledge. Totacklethesechallenges,Ref.[35]createsafoundationforsemanticSIEMs
thatintroducesaSecurityStrategyMeta-Modeltoenableinterrelatinginformationfrom
different domains and abstraction levels. In a similar vein, Ref. [2] proposes a hybrid
relational-ontologicalarchitecturetoovercomecross-domainmodeling,schemacomplexity,
and scalability limitations in SIEMs. This approach combines existing relational SIEM
datarepositorieswithexternalvulnerabilityinformation,i.e.,CommonVulnerabilitiesand
Exposures(CVE)[36].
Graph-BasedLogIntegrationandAnalysis