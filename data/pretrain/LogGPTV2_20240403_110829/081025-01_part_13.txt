类型 例行操作运维部署工具 例行操作运维配置工具 例行操作运维监控工具 日志分析工具
Puppet Nagios
Kickstart Func Zabbix Splunk
Cobbler C<ef Cacti Loggly
工具
OpenQRM Cfengine Gandia Airbrake
SpaceWalk Capistrano Hyperic Graylog
ControlTiger OpenNMS
1．典型例行操作运维配置工具
当系统环境稳定运行后，可采用运维配置工具辅助管理网络、服务器、应用程序、后台程
序及各种服务，帮助运维人员更加方便地完成升级软件包、管理配置文件、系统服务、计划执
行任务、添加新的配置、修复错误等重复工作。另一方面，随着IT产业向云计算迈进，配置管
理工具除了在提高效率方面发挥作用外，也会成为一种更有效的使用云计算的方式。
当前主流的运维自动化配置管理工具大部分为开源软件，主要包括Puppet、Func、C<ef、
Cfengine及Capistrano等，其中以Puppet、Func和C<ef最为常用，如表3-32所示。
表3-32 主要运维配置工具Puppet、Func和Chef
工具名称 来源 特 点
主流运维集中配置管理系统，也是目前应用最为广泛的一个运维工具。典型用户
包括淘宝、新浪、Google、RedHat、Amazon等。Puppet能够采用自己的声明语言
Puppet 开源
自动化重现任意的系统，其最大的优势在于简单，运维人员几乎可以通过使用
Puppet来处理所有的管理细节
全称为Fedora Unified Network Controller，可以用在RedHat系列产品上，是为了
解决统一管理问题而设计开发的自动化的远程服务器管理框架。该工具的优势在
Func 开源
于可让运维人员在主控机上一次管理任意多台服务器，或任意多个服务器组，另
外，通过Func的命令行可以直接发送远程命令或者远程获取数据
是—个系统集成配置框架，可以用Ruby等代码完成服务器的管理配置并编写自己
C<ef 开源
的库。典型用户包括Twitter、Amazon等
2．典型例行操作运维监控工具
信息系统设施运维通常采取基于反应的问题解决方案，但往往效率低下，而设施运维监控
工具能够通过对各种设施的监测及数据的采集，及时对影响设施运行性能的事件（包括故障）
发送告警，以便采取相应的处理措施，保证设施的正常安全运行。一个相对完善的运维监控工
具应能够记录基础设施中运行的所有服务器和机器，能够在小问题变大之前发出警告；能从一
168 信息系统运行管理员教程（第2版）
个中心地点运行，而减少必须到每台物理设施才能解决问题的需求；能提供有关全系统状态、
未解决问题等直观视图。
但是，没有任何的监控工具可以监视运维所需的一切内容，因此首先需要根据需求制定明
确的监控策略。
1）设施运维监控基本策略
为更好、更有效地保障系统上线后的稳定运行，对于信息系统设施中的硬件资源、性能、
带宽、端口、进程、服务等都必须有一个可靠和可持续的监测策略和机制，需要明确定义监控
的对象、方式，设定告警的优先级、标准等，具体策略包括以下内容。
（1）监控对象：在一个规模较大的网络中，监控的对象可能包括服务器、防火墙、交换机、
路由器等设备及运行在各对象上的服务，不需要将所有的对象都放到监控系统中，监控策略的
设计首先应明确监控对象。
（2）故障告警方式：对监控系统而言，一定要有合适的故障告警机制。目前常用的告警机
制包括邮件、短信、MSN、Web页面显示等几种手段，这几种手段中，短信告警最佳。
（3）告警时效和间隔的选择：由于网络通信等不可控因素，可能存在故障误报的情况，不
应将告警发送设置成一次探测不成功就发送。此外，故障告警开始发送以后，在收到确认排除
前会持续发送，因此需要合理设置告警发送的间隔。
告警时效和间隔的策略参考建议：探测4次失败开始告警，告警间隔10分钟，总共发送8
次，然后停止发送，假如第3次没有人去处理，监控工具电话通知，没有回应则取消该对象的
监控，并记录该次事件。
（4）监控平台地点的选择：对于一个规模较大的网络，为解决南北互连问题一般会采取在
多个地点建立数据中心的方法，这时需要对不同地理位置的服务器进行监控，也会遇到访问慢
的问题。解决这个问题有几种方式：①选择一个到各个位置访问都顺畅的数据机房；②采取分
布式监控平台，各处自己收集监控信息，然后到一处汇总；③各数据中心单独建立监控平台。
（5）定义告警优先级策略：对于监控到的事件，通常将访问网页出错、连接不到 Socket
等故障设置为优先告警。此外，对返回的延时、内容的信息，如访问网页的时间、访问网页取
到的内容及其他数据指标等，可自定义告警条件，如对Ping监控的返回延时一般是10～30ms，
当延时大于100ms时，表示网络或者服务器可能出现问题，引起网络响应慢，需要立即检查是
否有流量过大或者服务器CPU太高等问题；当监控到磁盘空间超过一个阈值时，可能会引起数
据库损坏，服务响应变慢等问题，需要告警进行检查和处理。
（6）定义告警信息内容标准：当服务器或应用发生故障时告警信息内容非常多，如告警运
行业务名称、服务器IP、监控的线路、监控的服务错误级别、出错信息、发生时间等。预先定
义告警内容及标准能使收到的告警内容具有规范性及可读性。这一点对于用短信接收告警内容
特别有意义，短信内容最多是70个字符，要用70个字符完全明确故障内容比较困难，更需要
预先定义内容规范。例如，“视频直播服务器10.0.211.65 在2012-10-18 13:00电信线路监控到
第1次失败”，清晰明了地告知故障信息。
第3章 信息系统设施运维 169
（7）通过邮件接收汇总报表：设计固定周期收到网站服务器监控的汇总报表邮件，运维人
员只需花很少的时间就能大致了解网站和服务器状态。
（8）定义故障告警主次：对于监控同一台服务器的服务，需要定义一个主要监控对象，当
主要监控对象出现故障时，只发送主要监控对象的告警，其他次要的监控对象暂停监控和告警。
例如，用Ping来做主要监控对象，如果Ping不通出现Timeout，表示服务器已经宕机或者断网，
这时只发送服务器Ping告警并持续监控Ping，因为再继续监控和告警其他服务已经没有必要。
这样既能大大减少告警消息数量，又可以让监控更加合理、更加有效率。
（9）规范本地部署的监控脚本，并归纳总结：对在本地部署的监控脚本要进行统一规范的
部署并记录到知识管理系统中以便沉淀及优化。
（10）实现对常见性故障业务自我修复功能：实现对常见性故障业务自我修复功能脚本进
行统一部署，并对修复后的故障进行检查，一般告警检查频次不多于3次。
（11）对监控的业务系统进行分级：如设置类似“一级系统 7×24 小时告警，二级系统
7×12小时告警，三级系统5×8小时告警”这样的业务系统分级标准。
2）常用运维监控工具
当前主流的运维监控工具主要包括 Nagios、Zabbix、Cacti、Gandia、Hyperic 等，其中以
Nagios、Zabbix和Cacti最为常用，如表3-33所示。
表3-33 主要运维监控工具Nagios、Zabbix和Cacti
工具名称 来源 特 点
是一个监控系统运行状态和网络信息的监控系统，能有效监控系统、应用、服务
及各种进程的运行状况，目前已经成为很多公司必备的监控工具；告警机制包括
短信、邮件等，可由用户自行定义。主要功能包括：① 监控网络服务（SMTP、
POP3、HTTP、NNTP、PING 等）；② 监视本地或者远程主机资源（内存、进
程、磁盘等）；③ 允许用户编写自己的插件来监控特定的服务；④ 具备定义网
Nagios 开源
络分层结构的能力，用“Parent”主机定义来表达网络主机间的关系，这种关系
可被用来发现和明晰主机宕机或不可达状态；⑤ 具备定义事件句柄功能，可以
在主机或服务的事件发生时获取更多问题定位；⑥ 自动的日志回滚；⑦ 可支持
对主机的冗余监控；⑧ 可选Web界面用于查看当前的网络状态、通知和故障历
史、日志文件等
基于 Web界面的用于监控网络上的服务器/服务及其他网络设备状态的网络管理
系统，能监视各种网络参数，保证服务器系统的安全运营；并提供柔软的通知机
制以让系统管理员快速定位/解决存在的各种问题；由两部分构成：zabbix server
与可选组件zabbix agent。zabbix server可以通过SNMP、zabbix agent、ping、端
Zabbix 开源
口监视等方法提供对远程服务器/网络状态的监视、数据收集等功能。zabbix agent
须安装在被监视的目标服务器上，它主要完成对硬件信息或与操作系统有关的内
存、CPU等信息的收集，主要功能包括：① 监控CPU负荷；② 监控内存使用；
③ 监控磁盘使用；④ 监控网络状况；⑤ 监控端口和日志
是基于PHP、MySQL、SNMP及rrdtool的网络流量监测图形分析工具，能统计
网络设备的流量、CPU、系统负载等参数，也可以自定义监测的指标，提供非常
Cacti 开源
强大的数据和用户管理功能，运用 SNMP采集数据，使用 rrdtool绘图；可以让
运维人员在主控机上一次管理任意多台服务器，或任意多个服务器组
170 信息系统运行管理员教程（第2版）
3．典型优化运维工具——日志分析
日志在信息系统中是一个非常广泛的概念，任何程序都有可能输出日志，如操作系统内核、
各种应用服务器等。日志分析工具是运维人员在响应支持运维中进行问题定位的有效辅助工
具，也可以作为优化改善中预防性改进的有效辅助，越来越为运维人员所重视。
当前主流的运维日志分析工具包括Splunk、Loggly、Airbrake、Graylog等，其中以 Splunk
和Loggly最为常用，如表3-34所示。
表3-34 主要运维日志分析工具Splunk和Loggly
工具名称 来 源 特 点
能够实时从日志文件获取事件，能够监听syslog或获取Windows事件，并
且采用通用方式索引任何内容格式的数据，不需要连接器。主要功能包括：
① 搜索和报表，问题定位：可与 Nagios 配合使用，如 Nagios 告警某台
RegionServer端口不可达，系统收到Notification后，登录Splunk，直接搜
索s<utdown和<ost名称，找到RegionServer退出的日志，单击详细信息，
Splunk 非开源
分析日志，就能快速定位问题。② 日志分析预警：可以通过日志分析实现
事件预警，如利用Splunk实时检测日志中的关键字，定义关键字规则，如
监控“s<utdown”等，一旦出现，利用Splunk的Notification功能，通知管
理员，管理员通过Splunk定位问题，就可以在系统真正出现问题之前对系
统进行调整，防患于未然
将机器生成的日志文档整理为可进行搜索的格式，可以分析日志数据，进