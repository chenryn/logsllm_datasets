### 优化后的文本

---

#### Honeypot-Based Port Scan Detection

**优点：**
- 该方法无论扫描是从WAN还是LAN发起，都能进行有效检测。
- 不会产生误报（No False-Positives）。
- 可以应对带有BYOD/IoT设备的恶意软件。
- 即使扫描速度极慢，也能被检测到。

**缺点：**
- 如果A没有扫描到H怎么办？
- 检测到扫描行为后，下一步应如何处理？
- 防火墙可以立即阻止，但H呢？

---

#### 实验设置
为了简化实验环境，我们将以下设备连接到同一台SDN交换机上：
- 被感染的主机（Bot-infected host）
- 用于反扫描的蜜罐（Honeypot）

---

#### SDN Switch + Honeypot

![OpenFlow交换机](http://bradhedlund.s3.amazonaws.com/2011/openflow-scale/openflow-switch.png)

**实验拓扑结构：**
- **SDN Switch**
- **私有云**
- **SDN控制器**
- **虚拟机（被感染的主机）**
- **虚拟机（反扫描蜜罐）**

---

#### SDN SW + Honeypot (扫描阻挡率)
- 反应时间：0.6秒
- 阻挡率：98.5%
- 误报率：0%

**但是，我们还有更好的方法。**
- 或许在HITCON 2015会上会有更多讨论。

---

#### 关于局域网端口扫描检测的小结
- 使用SDN交换机和蜜罐来检测局域网内的端口扫描是一种有效的方案。
- 具体表现如下：
  - 反应时间：0.6秒
  - 阻挡率：98.5%
  - 误报率：0%

---

#### Anti-Botnet项目的长期观察
- 2009年，由于Anti-Botnet项目的需求，我部署了一个基于蜜罐的端口扫描检测器（影武者）。
- 通过分析扫描到影武者的IP地址，我们可以生成bot-like主机分布图。
- Anti-Botnet项目虽然在2013年结束，但我保留了自2009年以来的日志数据。

**日志统计：**
- 共有177,084个IP地址进行了扫描。
- 扫描到了23,273个TCP端口（总命中次数：1,036,624次）。
- 扫描到了1,479个UDP端口（总命中次数：179,250次）。

**热门TCP端口：**
| 排名 | 端口号 | 命中次数 | 比例 |
| --- | --- | --- | --- |
| 1 | 1433 (MS SQL Server) | 201,395 | 19.43% |
| 2 | 445 (SMB) | 185,436 | 17.89% |
| 3 | 9415 (PPLive open proxy) | 64,894 | 6.26% |
| 4 | 1080 (Socks Proxy or Back Door) | 43,778 | 4.22% |
| 5 | 80 | 31,769 | 3.06% |
| 6 | 22 | 28,751 | 2.77% |
| 7 | 135 (Remote Procedure Call (RPC)) | 24,874 | 2.40% |
| 8 | 3306 (MySql) | 24,745 | 2.39% |
| 9 | 3389 (Windows RDP) | 22,039 | 2.13% |
| 10 | 8080 | 19,998 | 1.93% |

**热门UDP端口：**
| 排名 | 端口号 | 命中次数 | 比例 |
| --- | --- | --- | --- |
| 1 | 29285 (2009~2012) | 132,937 | 74.16% |
| 2 | 22722 | 7,701 | 4.30% |
| 3 | 137 (netbios-ns) | 4,818 | 2.69% |
| 4 | 161 (snmp) | 4,767 | 2.66% |
| 5 | 5060 (SIP) | 4,669 | 2.60% |
| 6 | 53 | 4,091 | 2.28% |
| 7 | 5724 (Operations Manager - SDK Service) | 2,969 | 1.66% |
| 8 | 7793 | 2,041 | 1.14% |
| 9 | 19 (chargen) | 1,113 | 0.62% |
| 10 | 33348 | 618 | 0.34% |

**当RDP发生问题MS12-020时(2012/03/13)：**
- TCP 3389在整个统计区间的比例为2.13%。
- 但在2012年3月，比例上升至4%。
- 2012年2月，比例为3.4%。
- 2012年1月，比例回落至2.0%。
- 这表明在MS12-020发布前，攻击者可能已经开始利用这一漏洞。

---

#### 适应新的安全威胁时代
- 在WAN中有Internet扫描，在LAN中有BYOD/IoT问题。
- 设备需要升级，人的知识也需要更新。
- 我有一个梦想，当我的冰箱对外部TCP 6667端口建立连接时，防火墙能够发出警告。
- 除了在防火墙的WAN端，LAN也是一个重要的战场。
- SDN交换机在保护LAN内部攻击方面应该能提供帮助。
- 如果我们足够幸运，基于蜜罐的端口扫描检测器也可以作为零日漏洞的预警工具。

---

#### 总结
- 我们不仅可以进行事后处理，还可以在面对各种攻击时，通过IDS/IPS/FW进行实时防护。
- 除了在防火墙的WAN端，LAN也是重要的战场。
- SDN交换机在保护LAN内部攻击方面应该能提供帮助。
- 如果我们足够幸运，基于蜜罐的端口扫描检测器也可以作为零日漏洞的预警工具。
- 未来，除了智能家电外，还会有智能网络安全设备出现。
- 因此，在网络攻击发生之前，我们仍然可以采取一些措施。

---

#### Q&A

---

#### 关于BOT2014

---

#### 附录
- 相关的基于蜜罐的端口扫描检测器代码将在今年十月中旬发布在GitHub上。
  - [PortScanDetector GitHub仓库](https://github.com/canaankao/PortScanDetector)

---

#### 参考资料
- 长尾分布图引用自[此处](http://1.bp.blogspot.com/_UfxPP3QC4us/SbVjYX-QbiI/AAAAAAAAAY0/v1a7zLipdfQ/s400/long-tail.png)。

---