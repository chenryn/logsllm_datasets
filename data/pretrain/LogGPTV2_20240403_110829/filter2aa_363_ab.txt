• 这个方法有个好处
• 不管 scan 是 from WAN 或 from LAN，都可以侦
测。
• NO False-Positive 
• 对付 Malware with BYOD/IoT 也行。
• 扫再慢都抓得到 
• 这个方法的缺点
• 万一 A 没扫到 H 呢？
• 侦测到有人在扫，下一步呢？
• FW 可以马上挡，H 呢？
2014/8/22
SOME THINGS BEFORE NETWORK ATTACK
35
HONEYPOT-BASED PORT SCAN DETECTION
话说当今世上有个神器，叫 SDN SWITCH
http://bradhedlund.s3.amazonaws.com/2011/openflow-scale/openflow-switch.png
2014/8/22
SOME THINGS BEFORE NETWORK ATTACK
36
HONEYPOT-BASED PORT SCAN DETECTION
实验
• 为了简化环境，我们把
• Bot-infected host
• Honeypot (Anti-Scanning)
• 都接在同一台 SDN switch上。
2014/8/22
SOME THINGS BEFORE NETWORK ATTACK
37
HONEYPOT-BASED PORT SCAN DETECTION
SDN SW + HONEYPOT
2014/8/22
SOME THINGS BEFORE NETWORK ATTACK
38
SDN 
Switch
Private Cloud
SDN Controller
VM (Bot-infected)
VMs (Anti-scanning)
1
1
2
3
4
HONEYPOT-BASED PORT SCAN DETECTION
SDN SW + HONEYPOT (THE SCAN BLOCKING RATE)
2014/8/22
SOME THINGS BEFORE NETWORK ATTACK
39
HONEYPOT-BASED PORT SCAN DETECTION
SDN SW + HONEYPOT (THE RESPONSE TIME)
2014/8/22
SOME THINGS BEFORE NETWORK ATTACK
40
ABOUT LAN PORT SCAN DETECTION
小结
2014/8/22
SOME THINGS BEFORE NETWORK ATTACK
41
• 这样看来针对 LAN  LAN 的 Scan，用
• SDN SW + Honeypot 或许是一招
• 0.6s 的反应时间
• 98.5% 的阻挡率
• 0% FP rate
• But, 我们还有更好的方法 
• Maybe HITCON 2015?
同场加映
2014/8/22
SOME THINGS BEFORE NETWORK ATTACK
42
• A Long Time Observation
• A legacy of Anti-Botnet Project (2009-2013)
• http://www.anti-botnet.edu.tw/
ABOUT ANTI-BOTNET PROJECT
THE FLOW OF AUTO-BOTNET-RULE GEN
2014/8/22
SOME THINGS BEFORE NETWORK ATTACK
43
ABOUT ANTI-BOTNET PROJECT
BOTNET DETECTION RULE SERVICE
2014/8/22
SOME THINGS BEFORE NETWORK ATTACK
44
ABOUT ANTI-BOTNET PROJECT
THE FORENSIC OF BOT NETWORK TRAFFIC
2014/8/22
SOME THINGS BEFORE NETWORK ATTACK
45
A LONG TIME OBSERVATION
(A LEGACY OF ANTI-BOTNET PROJECT)
• 这故事是这样，在2009年的时候，因为
Anti-Botnet Porject 的需要，我放了一个
HoneyPot-based port scan detector (影武者)….
• 因为会扫到影武者的，基本上都可以假设
居心不良，所以我们用这个来产生 bot-like 
host distribution map。
2014/8/22
SOME THINGS BEFORE NETWORK ATTACK
46
A LONG TIME OBSERVATION
(WHERE IS TAIWAN?)
2014/8/22
SOME THINGS BEFORE NETWORK ATTACK
47
A LONG TIME OBSERVATION
(A LEGACY OF ANTI-BOTNET PROJECT)
• Anti-Botnet Porject 在 2013 年结束， 但是一
些相关的设施并没有完全撤除，我在前一
些日子发现我有保留它自 2009 年以来的
log….
• 大数据分析？不，只是久数据。
2014/8/22
SOME THINGS BEFORE NETWORK ATTACK
48
A LONG TIME OBSERVATION
(大约有 1.2M 笔 LOGS)
2014/8/22
SOME THINGS BEFORE NETWORK ATTACK
49
A LONG TIME OBSERVATION
这些年的一些统计
• 有 177,084 个 IP 扫到我们
• 有 23,273 个 TCP ports 被扫到 (Total:1,036,624 hits)
• 有 1,479 个 UDP ports 被扫到 (Total:179,250 hits)
2014/8/22
SOME THINGS BEFORE NETWORK ATTACK
50
A LONG TIME OBSERVATION
比较热门的 TCP PORTS
Rank
Port #
Hit #
Ratio
1
1433, MS SQL Server ?
201395
19.43%
2
445, SMB?
185436
17.89%
3
9415, PPLive open proxy ?
64894
6.26%
4
1080, Socks Proxy or Back Door?
43778
4.22%
5
80
31769
3.06%
6
22
28751
2.77%
7
135, Remote Procedure Call (RPC)?
24874
2.40%
8
3306, MySql?
24745
2.39%
9
3389, Windows RDP?
22039
2.13%
10
8080
19998
1.93%
2014/8/22
SOME THINGS BEFORE NETWORK ATTACK
51
A LONG TIME OBSERVATION
比较热门的 UDP PORTS
2014/8/22
SOME THINGS BEFORE NETWORK ATTACK
52
Rank
Port #
Hit #
Ratio
1
29285 (2009~2012)
132937
74.16%
2
22722
7701
4.30%
3
137, netbios-ns?
4818
2.69%
4
161, snmp?
4767
2.66%
5
5060, SIP?
4669
2.60%
6
53
4091
2.28%
7
5724, Operations Manager - SDK Service? 2969
1.66%
8
7793
2041
1.14%
9
19, chargen?
1113
0.62%
10
33348
618
0.34%
A LONG TIME OBSERVATION
当 RDP 发生问题 MS12-020 时(2012/03/13)
• TCP 3389 在整个统计区间的 ratio 是 2.13% .
• 但是在 2012/03 那个月却是 4%.
• 再往前看 2012/02 那个月已先涨到 3.4%
• 再往前看 2012/01 那个月就回到基本盘 2.0%
• 坏人在 MS12-020 发布前就已经先拿出来打？
• 如果我们够 lucky 就可以先被打到 
2014/8/22
SOME THINGS BEFORE NETWORK ATTACK
53
A LONG TIME OBSERVATION
(A LEGACY OF ANTI-BOTNET PROJECT)
• 以上就是 Anti-Botnet 计画的遗产，
• 让我在计画结束一年后，还有些东西可以
跟大家分享 
2014/8/22
SOME THINGS BEFORE NETWORK ATTACK
54
ADAPT TO THE NEW ERA OF 
SECURITY THREATS.
• It was the best of times, it was the worst of times.
• 在 WAN 有 Internet Scanning，在 LAN 有
BYOD / IoT issues。
• 设备需要升级，人脑也需要升级。
• 我有一个梦，当我的冰箱有对外的 TCP 
6667 连线时，FW 能警告我，那有多好 
• 人补 脑 需要更久的时间。
2014/8/22
SOME THINGS BEFORE NETWORK ATTACK
55
SUMMARY
• 我们不是只能做事后处理，而是我们面对各种攻
击时，IDS / IPS / FW 因为各种先天不良、后天失调
的结果可能不会叫。(不是叫大家不要买啦)
• 除了在 FW 的 WAN 的端，LAN 也是战场了。
• SDN switch 在 LAN  LAN Attack 的保护上应该帮得
上忙。
•
如果我们够幸运的话， HoneyPot-based port scan 
detector 也可以当成 0-day 的预警。(久数据的妙用?)
• 在未来，除了智慧家电外，应该也会有智慧网安
的设备出现。
• 所以，在网路攻击发生之前，我们还是可以做点
事 
2014/8/22
SOME THINGS BEFORE NETWORK ATTACK
56
Q&A
2014/8/22
SOME THINGS BEFORE NETWORK ATTACK
57
ABOUT BOT2014
2014/8/22
SOME THINGS BEFORE NETWORK ATTACK
58
ONE MORE THING
• 大约今年的十月中
• 相关 Honeypot-based PortScanDetector 会放在
• https://github.com/canaankao/PortScanDetector
2014/8/22
SOME THINGS BEFORE NETWORK ATTACK
59
REFERENCE
2014/8/22
SOME THINGS BEFORE NETWORK ATTACK
60
•
长尾分布的图是引用自
•
http://1.bp.blogspot.com/_UfxPP3QC4us/SbVjYX-
QbiI/AAAAAAAAAY0/v1a7zLipdfQ/s400/long-tail.png