# 探索一切、攻破一切
**[ Hacker@KCon ]**
9/6/2016 3:01:52 PM

## 伪基站高级利用技术
——彻底攻破短信验证码  
**演讲者：Seeker, BD4ET**  
9/6/2016 3:01:54 PM

### 日程
- 个人简介
- 手机通信安全概述
- LTE伪基站的实现
- GSM MITM攻击的实现
- 短信验证码的脆弱性
- 安全建议
9/6/2016 3:01:54 PM

### 个人简介
- 连续创业失败的创业导师
- 伪天使投资人
- 某非知名私立大学创办人兼校长
- 业余时间在本校通信安全实验室打杂
- 个人微信：70772177
9/6/2016 3:02:42 PM

### Part. 01 手机通信安全概述

#### 研究电信网安全漏洞的必要性
- 大量终端更换或更新补丁成本过高，导致漏洞长期存在。
- WIFI与3G/4G蜂窝数据互操作带来的安全风险。
- 2G/3G/4G电信业务互操作引发的安全隐患。
- 最薄弱环节在于WIFI和2G网络。
- 除了WIFI，其他领域也值得关注。

#### LTE手机的脆弱点
- **WIFI**: 在包交换层面，WIFI与蜂窝数据之间的互操作性。
- **2G**: 在网络覆盖和电路交换层面，LTE与2G/3G的互操作性。

#### 本次话题：攻破短信验证码
- 短信验证码广泛使用成为一大安全隐患。
- 拦截短信是快速入侵的首选方法。
- 此外，该攻击可以低成本实现。

#### 短信侦听和拦截现状
1. **联通、电信和移动的4G**: 可通过LTE伪基站将目标手机重定向至3G或2G网络。
2. **重定向到3G**: 利用FemtoCell实现短信侦听和拦截。
3. **重定向到2G CDMA**: 同样利用FemtoCell实现短信侦听和拦截。
4. **重定向到2G GSM**: 可实现旁路短信侦听，通过MITM（中间人攻击）可实现拦截，也可通过Race Condition部分拦截。

### 移动通信的演进
| 标准 | 速率 |
| --- | --- |
| cdmaOne, GSM, TDMA, PDC (2G) | 9.6 - 14.4 kbps |
| CDMA2000 1x, GPRS, EDGE (evolved 2G) | 64–144 kbps |
| WCDMA, CDMA2000 1x EV/DO (3G) | 384 kbps - 2 Mbps |
| HSPA, LTE, LTE-A (4G) | >1 Gbps |

### 空闲态移动性
- **小区重选**:
  - **LTE与3G互操作**: 提高用户在不同网络间的移动体验。
  - **语音回落 (CS Fall Back)**: 由于LTE不支持CS域，因此CS业务需要回落到2G/3G网络承载。
  - **多种互操作流程**: UE在E-UTRA/GERAN/UTRA之间采用不同的互操作策略。

### Part. 02 LTE伪基站的实现

#### 实现步骤
1. **LTE测试环境搭建**:
   - **硬件**: 高性能PC, BladeRF（或USRP B2x0）+ 天线, 测试用LTE手机。
   - **软件**: Linux, OpenAirInterface, 手机路测软件。
2. **LTE RRC重定向的实现**:
   - **RRC重定向**: 历史悠久，始见于3G通信标准，广泛应用于LTE CSFB。
   - **核心功能**: 包含redirectedCarrierInfo信息的RRC Connection Release消息。
3. **RIM流程介绍**:
   - **实质**: 在LTE与2G系统间建立一条信令交互通路。
   - **功能**: LTE网络提前获取周围2G邻区系统广播并下发至终端。
   - **改造需求**: 需要对LTE和2G核心网、无线网网元进行相应升级。
4. **LTE CSFB重定向的消息序列**:
   - **L3信令**: 包括RRCConnectionRelease消息中的redirectedCarrierInfo信息。
5. **LTE RRC重定向的利用**:
   - **步骤**:
     1. 手机重选到我们的LTE伪基站。
     2. UE发起TAU Request，伪基站拒绝。
     3. UE发起Attach Request，伪基站拒绝。
     4. 伪基站发送RRCConnectionRelease消息，指示手机重定向到我们架设的GSM伪基站。
     5. 关键点: 在启动安全验证之前下发RRCConnectionRelease。
6. **代码实现**:
   - **OAI代码修改**: 需要修改MME和eNodeB的代码，增加相应逻辑。
7. **L3信令流程**:
   - **实现后的终端输出**: 显示具体的L3信令流程和终端输出结果。

### LTE小区重选（Cell Reselection）流程
- **优先级与质量**:
  - **同频与异频等优先级**:
    - 服务小区与邻小区的优先级和无线电质量比较。
  - **异频和跨系统**:
    - 服务小区与邻小区的优先级和无线电质量比较，以及阈值设置。

通过上述内容，我们可以深入了解如何利用伪基站技术攻破短信验证码，并探讨相关的安全措施。