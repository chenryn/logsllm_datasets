the EDNS support results in a larger response, it may dwarf the size of the OPT
record and increase the ampliﬁcation factor. Accordingly, we measure ampliﬁca-
tion, both with and without EDNS enabled (indicating a maximum application
layer packet size of 4096 bytes as recommended by RFC 6891).
We also issued queries for AAAA records associated with IPv6. However, they
were not widely used and did not provide a meaningful ampliﬁcation over the
other queries types. Accordingly, we omit any further discuss of these records.
In summary, we issued the following DNS queries for each domain: (1) A record
without EDNS or DNSSEC support, (2) A record with EDNS and DNSSEC sup-
port, (3) ANY record without EDNS or DNSSEC support, and (4) ANY record with
EDNS and DNSSEC support.
We issued the queries from July 29, 2013 to Aug. 1, 2013. To perform the
massive number of queries quickly, we used a dedicated querying process and a
separate packet capture process to collect and store each of the DNS responses
sent to our server. Some packets may have been dropped, but for expediency, we
accepted these losses and did not attempt a retransmission. Accordingly, each
of the results we report will be conservative estimates of possible ampliﬁcation.
20
D.C. MacFarland et al.
3.2 Analysis of Servers and DNS Responses
We now examine the DNS responses. We exclude analysis of malformed packets,
since we are unable to properly parse them, which amounts to 0.07 % of the data
set. In Table 1, we show the overall success rates of our queries and statistics
on the degree of ampliﬁcation resulting from each. We calculated all packet
sizes at the application layer (i.e., the DNS headers and payload). This excludes
extraneous factors, such as the IPv4/IPv6 or UDP/TCP headers, and focuses on
DNS. In Fig. 1, we show the ampliﬁcation factor distribution for each of the data
sets. For each query type, the attacker receives at least a 129 % increase in traﬃc
volume at the application layer using DNS reﬂection. However, only 0.35 % of
A record queries and 1.54 % of ANY queries had a packet size greater than the
512 byte limit when EDNS was enabled. Accordingly, the query overhead of
using EDNS reduced the average ampliﬁcation factor for both the A and the
ANY groups. Simply put, an attacker does not beneﬁt from using EDNS in the
average case since few responses must be shortened to ﬁt within 512 bytes.
Table 1. DNS Responses to Queries. Results are presented in the aggregate along with
statistics on the top 1 million largest responses of each group.
Query Type
Record Uses EDNS
Response Top Million Queries Ampliﬁcation Ratio
Rate
Total (MB)
Sent Received
All Queries Top 1 million
A
A
ANY
ANY
no
yes
no
yes
90 %
89 %
84 %
85 %
34
44
35
44
485
725
534
1,444
2.74
2.29
6.22
5.03
14.42
16.37
15.32
32.77
While this degree of ampliﬁcation may be worthwhile for an attacker, a more
potent strategy may be to focus on the queries and responses that yield the
greatest ampliﬁcation factor. To highlight the beneﬁts of doing so, we provide
statistics on the top 1 million packets, by response size, of each data set in
Table 1. These packets make up roughly 0.3 % of each data set. Additionally,
while EDNS did not help an attacker sending queries to random domains, it
does beneﬁt the attacker who focuses on those providing the most ampliﬁcation.
In both groups, EDNS yielded a notable increase in ampliﬁcation among the
million largest amplifying responses. This selective querying can help an attacker
increase the ampliﬁcation ratio to over 14.42 in the worst case and up to 32.77
in the best case.
The attacker receives the best ampliﬁcation while using ANY queries, but
we note that this record type may raise suspicions. An attacker that wishes to
use A record queries to avoid detection can still achieve an ampliﬁcation factor
of 16.37. As an anecdotal result, in issuing the roughly 1.5 billion DNS queries
associated with this study, our organization was contacted only once by a queried
Characterizing Optimal DNS Ampliﬁcation Attacks and Eﬀective Mitigation
21
Fig. 1. Cumulative distribution func-
tion of the ampliﬁcation ratio com-
pared to the percent of queries for each
data set.
Fig. 2. Ampliﬁcation ratios ordered
from the most amplifying server to the
least. Some data points are aggregated
for readability.
organization. That report was from an automated system indicating that the
ANY query it received from our querying host may be the result of an attacker
launching a reﬂection attack against us. Organizations may begin ﬁltering ANY
queries to reduce the ampliﬁcation factor, but the ampliﬁcation potential of A
queries is unlikely to change.
To provide context for these results, we consider the theoretical maximum
ampliﬁcation, at the application layer, for DNS with EDNS using the recom-
mended maximum response size of 4096 bytes. The DNS header itself is 12
bytes, with an additional n + 5 bytes for a query record, with a domain name of
length n, and another additional 11 bytes for the OPT record to enable EDNS.
The average maximum ampliﬁcation with EDNS can then be expressed as 4096
N +28
where N is the average domain name length in the queries. In our dataset, the
average domain name length was 17 characters, which yields a maximum aver-
age ampliﬁcation of roughly 91.02. Our overall ampliﬁcations are much lower
than this, indicating most queried systems are not providing maximum-sized
responses. However, looking at our top 10 % of amplifying name servers, we
see an ampliﬁcation of 78.13 indicating longer domain names on average with
nearly maximum length responses. These highly amplifying servers are closer
to the ratios reported in Rossow’s DN SN S set [13]. However, our dataset-wide
averages are much lower than those in Rossow’s data set. These are likely due to
our diﬀerent methodologies: Rossow used the Common Crawl project while we
used the zone ﬁles themselves. Our data sets are larger and we did not pre-ﬁlter
based on the deployment of DNSSEC, reducing potential sources of bias.
While attackers want to maximize the ampliﬁcation factors associated with
attacks, they must also ensure they use a large, distributed base of reﬂectors. If
the attackers focus on a small number of highly amplifying reﬂectors, the reﬂector
bandwidth may become a bottleneck. Even worse, the defenders may be able to
ﬁlter a small number of reﬂector IP addresses with little collateral damage. To
highlight this point, we note that although we received responses from 669, 090
reﬂecting name servers, a much smaller pool of servers are responsible for the
22
D.C. MacFarland et al.
1 million highest amplifying queries. For the top 1 million A record queries, the
number of servers ranges from 24, 782 in the “without EDNS” group to 24, 841
servers in the “with EDNS” group. For the top 1 million ANY queries, the number
of servers ranges from 22, 508 in the “without EDNS” group to 28, 101 in the
“with EDNS” group. In other words, less than 3.8 % of authoritative name servers
are associated with the highest degrees of ampliﬁcation. In Fig. 2, we demonstrate
the ampliﬁcation ratios associated with each name server.
3.3
Impact of Record Type on Response Size
In Table 2, we show the contributions each resource record makes to the typical
DNS packet from the Top 1 million EDNS groups. Attackers may consider which
record types have the largest payload for the response and compose queries
to elicit these responses. Not all record types are present in each packet. For
example, the SOA record typically signals that no valid records are being returned.
Thus, it is unsurprising it typically represents a large percentage of the responses
where it appears. Likewise records associated with DNSSEC tend to be large,
constituting a majority of the packet size in the instances where those records
occur.
Interestingly, the use of DNSSEC to ensure the authenticity of DNS records
has the unintended consequence of improving DNS ampliﬁcation attacks. As
one countermeasure, DNS servers may choose to apply rate-limiting separately
to DNSSEC records. If a server continually asks for a response, the servers may
discontinue providing DNSSEC records in duplicate responses before cutting the
server oﬀ entirely. This would eﬀectively decrease the ampliﬁcation factor of an
attack. However, it would limit clients’ ability to get authenticated records in
cases of high DNS packet loss. Operators may wish to consider these tradeoﬀs.
Table 2. Average number of bytes by resource record type for Top 1 million EDNS
groups, as well as the occurrence percentages. We omit negligible results for readability.
Record Type Packet Bytes (Percent)
Packet Occurrence %
A
AAAA
NS
SOA
TXT
A
ANY
A
171 (22.13 %)
115 (7.63 %)
87.2 %
158 (19.60 %)
181 (15.76 %) 60.7 %
220 (28.54 %)
126 (8.39 %)
85.9 %
70 (11.10 %)
63 (3.37 %)
12.5 %
-
141 (9.17 %)
-
All DNSSEC 623 (71.3 %)
1,688 (84.1 %)
40.2 %
RRSIG
DNSKEY
NSEC3
ANY
97.7 %
48.8 %
99.5 %
67.1 %
19.1 %
60.0 %
60.0 %
47.4 %
590 (67.5 %)
1,308 (65.2 %)
40.2 %
-
444 (20.8 %)
-
89 (14.4 %)
-
11.8 %
-
Characterizing Optimal DNS Ampliﬁcation Attacks and Eﬀective Mitigation