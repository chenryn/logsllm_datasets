## Page 512
像下面这样读取这些文件，并将它们复制为test数据库的相应文件：
other_db 数据库里有一个名为x的 MyISAM表。该表由x.frm、x.MYD 和x.MYI三个文件表示。
步骤演示了具体的做法。
们，不仅如此，具有FILE 权限的任何客户端用户也可以通过网络连接读取到它们！下面几个
的密码文件的内容：
据
用
限的用户能够做些什么：
OPTION权限，则他们可以让彼此的访问权限变得更强大。
着
情
数
例如，在user 表的某个行里启用了DELETE权限，那么与该行相关联的那个账户便可以在任何
限都是全
定用户的连接主机范围的同时，也会扩大冒名顶替者的闯入范围。
禁用该模式，但有助于防止非恶意用户犯错。
不安全的新账户。也就是说，如果某个账户不存在，那么GRANT会执行失败，并且不会创建账
492
与表相对应的那些文件都可以被公开读取，那么在服务器上拥有账户的任何用户都可以读取它
库产
月户便可以通过网络访问服务器主机上潜在的很大一部分文件系统。
为名字。如果用户是从远程主机进行连接的，其最终效果便是，在授予用户FILE权限时，该
FILE权限特别危险，不要轻易地将它授予其他用户。下面这个示例可以说明拥有FILE 权
他能够执行所有你能想到的账户管理语句。
库表的权限，便等同于给了该用户所有的全局权限。如果该用户能够直接修改表，也就意味
数据库对象，如表或存储例程。对于这一原则，有如下两个例外情况。
况下最好是不授予全局权限，可以授予特定级别的权限，以限制用户只能访问特定的数据库
据库里删除任何表的任何行。因为在user 表里指定的权限都是超级用户权限，所以在一般
如果在权限上对系统里的那个数据目录限制不够严格，那么FILE权限还可能对其中的数
那条LOAD DATA语句里的/etc/passwd可被替换为服务器主机上的任何一个公共可读文件
一定要小心使用GRANTOPTION权限。对于两个拥有不同权限的用户，如果都拥有GRANT
超级用户权限需要小范围授予。也就是说，不要在user 表的行里启用这些权限。这些权
除非真的需要在主机名说明符里使用模式，否则，在设置账户时要避免这样做。在扩大给
(2）使用该表来读取每个与你想要窃取的那个表相对应的文件的内容。假设，某个用户在
CREATE TABLE tmp (b LONGBLOB);
（1）创建一个包含LONGBLOB列的表：
SELECT *FROM etC_paSSwd;
街
LOAD DATA INFILE/etc/paSSwd'INTO TABLE etc_pasSwd;
CREATE TABLE etc_passwd (pwd_entry TEXT);
不要授予mysql数据库的权限。因为这个数据库包含授权表，对该数据库拥有权限的用户
USE test;
口其次，有些特定的全局权限通常可以安全地授予。如与临时表创建、表锁定，以及（在
口首先，像root这样的超级用户和其他管理账户需要全局权限来操作服务器。这些账户
生威胁。这也是应该将数据目录的内容设置为只能由服务器读取的一个主要原因。如果
执行这些语句之后，该用户便可以通过执行 SELECT语句，访问到存储在服务器主机上
全局性的，会使该用户对服务器的运作产生影响，或者使他能够对所有数据库进行访问。
这些权限，而其他需要严格控制的权限则不会被随便授予。
往往很少。
第13章安全性与访问控制
---
## Page 513
语句，而这些语句很可能会被滥用。例如：
的语句。利用 SUPER 权限，用户还可以清空日志文件、执行其他危害服务器运作的操作。
其
可以使用SHOWPROCESSLIST来查看服务器正在执行的那些语句的文本。这使得用户可以窥
MySQL服务器创建这些文件的用户便可以完全更改服务器主机的行为。
/etc/hosts.equiv、/etc/hosts.lpd 或/etc/sudoers 中的某一个不存在，那么能够让
器
的）也可以让服务器这样估
以在文件系统里的任何位置创建文件，而具有FILE权限的用户（即使是从远程主机进行连持
那种做法就很不明智，更何况还有一个FILE权限，其带来的后果可想而知。因为root 用户市
表有关的信息。
SHOW DATABASES和 SHOW TABLES 命令，进而使用户无法找到与他们不该访问的那些数据库和
--skip-show-database 选项。这样，可以防止用户对那些他们没有访问权限的数据库使月
要采取一个措施，即避免将 SHOWDATABASE权限授予其他用户，并且在运行服务器时带
的副本。
请不要把RELOAD权限授予那些不需要它的人。RELOAD权限允许用户执行FLUSH和RESET
他用户，从而有可能看到应该保持私密的信息。拥有SUPER权限的用户，可以取消其他用
如果以root 用户身份运行MySQL服务器，那么 FILE 权限的危险会被进一步放大。首先，
为防止这种攻击，可以使用13.1.2节描述的指导方法设置数据目录的许可权限。另外还需
口拥有RELOAD权限的用户可以通过使用FLUSHPRIVILEGES或FLUSHUSER_RESOURCES语
PROCESS和 SUPER权限只应被授予那些被信任的 MySQL账户。拥有PROCESS 权限的用户
为避免这些问题，请不要以root身份运行mysqld。（更多相关信息请参考12.2.1.1节。）
口
(3）在执行这些语句之后，test数据库目录也会包含名为x.frm、x.MYD和x.MYI的文件。
SELECT
LOAD DATA INFILE
口
口
DELETE FROM tmp;
SELECT
DELETE FROM tmp;
SELECT*
LOAD DATA INFILE './other_db/x.frm' INTO TABLE tmp
FIELDS ESCAPED BY
FIELDS ESCAPED
FIELDS ESCAPED
RESET MASTER语句会导致复制主服务器删除其所有的二进制日志文件，即使这些文件
FIELDS
仍在使用中也会被删除，这会阻止从服务器正确地复制。
则会失去查询缓存所带来的好处。
止服务器利用缓存，从而降低服务器的性能。类似地，反复使用RESETQUERY CACHE
FLUSHTABLES语句会导致服务器将其打开表的缓存保存至磁盘。
为零。
句重新加载权限表，使资源管理机制失效。这两条语句都可以将资源管理计数器重量
户可以反复地刷新日志，这会导致服务器创建大量的文件。
志，那么每一条FLUSHLOGS语句都会创建序列中的下一个文件。拥有RELOAD权限的月
二进制日志文件和中继日志文件的名字都是由编号序列构成的。如果启用了这些！
FROM tmp
FROM tmp INTO OUTFILE 'x.frm
ESCAPED BY
BY
'./other_db/x.MYI'INTOTABLE
BY
BY
./other_db/x.MYDINTO TABLE
INTO
做。服务器不会创建已存在的文件，但是有时也可能创建出改变服务
LINES TERMINATED BY 1;
OUTFILE
LINES TERMINATED BY;
OUTFILE
LINES TERMINATED BY ;
LINES TERMINATED BYi;
LINES TERMINATED BY1
IAW'X
"X.MYD
tmp
tmp
13.2管理MySQL用户账户
反复使用它时，会阻
493
用
日
户
探
务
和
T
---
## Page 514
定如何将该用户映射到某一个被代理用户。假设，像下面这样创建了一个账户：
的值。也就是说，当代理用户进行连接时，插件会检查那个认证字符串，并解释其内容，以硕
赖于插件的具体实现。通常情况下，插件会使用在创建代理用户账户时指定的那个auth_string
插件如何确定是否需要将代理用户映射成另一个被代理用户以及以何种方式进行映射，完全依
是否认证通过返回给服务器，还要返回被代理用户B的名字(用于检查用户A应该具有的权限)。
被允许执行的所有操作。
使用A的账户来连接服务器，那么用户A便可以拥有用户B的所有权限，并且可以执行用户B
理用户），就可以被当成另一个用户B（被代理用户)。如果用户A是用户B的代理，并且现在
13.2.7.2，创建代理用户
器允许任何客户端无需进行身份认证便可以进行连接。
搜索的地方，那么调用客户端程序时可以使用--plugin-dir选项来指定该位置。
连接服务器时，并不需要指定使用哪个客户端插件。但是，
过指定的插件对该客户端进行认证，接着会调用该插件，并将authentication_string 的值
可以根据12.4节的操作指导加载它。假设auth_plugin已被加载，服务器在user权限表里创
下所示（与GRANT的语法格式相同）：
13.2.7.1使用身份认证插件
如何使用身份认证插件提供更详细的信息。其中，还将涉及代理用户-
IDENTIFIED BY 来指定密码，也可以使用 IDENTIFIED WITH 来指定身份认证插件。本节将对
安
客
客
传
建
13.2.7
名为table1，从而与你的初衷相违背。
但是不能访问table2。另一个拥有ALTER 权限的用户则可以通过 ALTER TABLE 将table2更
494
如果用--skip-grant-tables 选项启动服务器，则不会使用身份认证插件，因为这时服务
装客户端插件，连接就会失败。如果插件位于其他地方，没在客户端程序在默认情况下会去
户端程序进行通信，确定应该调用哪个客户端插件执行身份认证过程。正因为如此，当用）
户端身份认证是否正确。如果不正确，服务器会拒绝该连接。
专递给它。该插件会与客户端程序进行通信，以接收客户端的身份认证凭证，并向服务器表明
建了一个行，并将 auth_plugin 和 auth_string 的值分别存储在了该行的 plugin 列和
一项附加功能，它允许一个用户获得另一用户的权限。
CREATE USER'@'localhost
并不是所有身份认证插件都支持代理。为支持代理功能，在编写插件时，不仅要把用户A
MySQL里的身份认证插件使用户代理成为可能。这样一来，连接到服务器的用户A（即代
对于服务器端的身份认证插件，在客户端都有对应的插件，并且每个服务器端插件都会！
当客户端通过该账户尝试连接服务器时，服务器根据user表的plugin值就会知道应该通
在与 CREATEUSER一起用于指定身份认证插件时，IDENTIFIED WITH子句的语法格式如
正如13.2.1.3节所述，在为CREATEUSER 和GRANT语句提供身份认证信息时，既可以使用
为了让服务器能知道某个身份认证插件的存在，必须先加载它。如果该操作尚未完成，则
CREATE USER account IDENTIFIED WITH auth_plugin [AS'auth_string']
ALTER权限的某些使用方式可能是你意想不到的。假设，你想让某个用户能够访问table1，
第13章安全性与访问控制
userl=proxied_userl;user2=proxied_user2';
插入式身份认证和代理用户
，如果客户端主机的插件目录里没有
一这是认证插件所带来
确
户
与
---
## Page 515
my_user:
防止客户端在未认证的情况下直接连接到该账户。）
进行审核的过程中都会执行这些语句。（请注意，我们为被代理账户分配了一个密码。这样可以
子句既可以指定一个密码，也可以指定一个身份认证插件。
PROXY权限。下面是一组允许代理时常用的语句序列：
账户之外，还要求被代理用户所对应的账户必须存在，并且代理用户对被代理账户需要拥有
工作方式如下所示。
个假想的插件来创建代理用户。
参考手册。）社区的MySQL发行版本并没有这种插件。因此，接下来讨论的内容是如何使用某
或proxied_user2，并且会拒绝来自其他客户端用户名的连接尝试。
将--user 的值指定为user1或user2,那么插件可能会将该客户端分别映射为 proxied_user1
用户名与某些更为具体的localhost 账户实际上并不匹配。对于这样的连接尝试，如果客户端
你可能会问,为何要这么费力地把user2映射到 my_user。为何不直接把权限分配给user2
CREATE USER
现在，当user2连接MySQL服务器时，不管my_user 拥有什么样的权限，在对用户会话
对于代理用户，
前面的讨论还不够全面。在代理时，除了需要支持代理的身份验证插件和针对代理用户的
假设，我们有一个名为 unix_auth 的身份认证插件，它是专为Unix系统而设计的，它的
用于将user2创建为my_user的代理用户的所有语句如下所示：
CREATE USERproxy_user auth_info;
目前，只有商业MySQL的发行版本才有支持代理的插件。（更多详细信息请参考MySQL
CREATE USER
GRANT PROXY
GRANT PROXY
CREATE USER'user2'@'localhost' IDENTIFIED WITH unix_auth AS'my_user';
GRANT PROxY ON proxied_user TO proxy_user;
口如果想在无代理的情况下使用此插件，那么在创建账户时就不要指定身份认证字符串：
口此插件允许用户使用自己的Unix账户密码来连接MySQL服务器。在使用它时，可以不
在这种情况下，账户名将使用空用户名，并且会匹配来自本地主机的各种连接尝试，其中，
CREATEUSER
口女
my_user。
此时，user2会使用user2的Unix密码来连接服务器，而代理后的MySQL账户为
如果想在使用插件时支持代理，则可以指定一个身份认证字符串，并在其中列出客户
的Unix登录名，并发送到服务器。
在命令行里并没有指定用户名。我们假设客户端插件可以通过检查执行环境来确定当前
账户进行身份认证：
在这种情况下，user1的连接过程为，先指定user1的Unix密码，然后使用同名的MySQL
端应该代理的那个MySQL用户的名字。例如：
Enterpassword：...此处输入Unix用户userl的密码...
mysql-p
使用用户代理，但是它支持这种功能。
，auth_info子句必须指定一个支持用户代理的插件。对于被代理用户，该
auth
info;
IDENTIFIEDBY
To'user3'@'localhost';
13.2
管理MySQL用户账户
495
---
## Page 516
因为它们与账户管理无关。
表还有几个用于身份认证、SSL 连接和资源管理的列。这些列只存在于 user 表里，因为其作
列，用于确定何时应用于行；另一个是权限列，用于确定某个行授予了哪些权限。对于系统管
照列的类型进行了拆解）。每个权限表包含两种基本类型的列：一个是访问范围（scope-of-access）
句只是扶
够对各类权限问题进行诊断。
你便可以通过直接修改权限表的方式来增加、删除或修改用户权限。在你检查这些表时，也能
它们来确定访问权限的相关事宜有所了解，则会对上述情况有所帮助。在了解这些内容之后，