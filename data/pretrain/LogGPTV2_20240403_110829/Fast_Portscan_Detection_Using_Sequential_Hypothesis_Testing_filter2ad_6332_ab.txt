74,383
116,386
ICSI
161,122
512
217
29,528
7
69
15
29,437
non-HTTP worms), and they are blocked by the (very lim-
ited) ﬁrewalls at each site.2 It is important to note that the
Bro monitor at LBL was located outside the ﬁrewall, and so
would see this trafﬁc; while that at ICSI monitored inside
the ﬁrewall, so it did not see the trafﬁc, other than a trickle
that came from other nearby sites that were also within the
ﬁrewall.
We will refer to the collection of the scanners, HTTP
worms, and other bad collectively as known bad.
Table 1. Summary of datasets
3.1. Separating Possible Scanners
Both sites run the Bro NIDS. We were able to obtain a
number of datasets of anonymized TCP connection sum-
mary logs generated by Bro. Each log entry lists a times-
tamp corresponding to when a connection (either inbound
or outbound) was initiated, the duration of the connection,
its ultimate state (which, for our purposes, was one of “suc-
cessful,” “rejected,” or “unanswered”), the application pro-
tocol, the volume of data transferred in each direction, and
the (anonymized) local and remote hosts participating in the
connection. As the need arose, we were also able to ask the
sites to examine their additional logs (and the identities of
the anonymized hosts) in order to ascertain whether partic-
ular trafﬁc did indeed reﬂect a scanner or a benign host.
Each dataset we analyzed covered a 24-hour period. We
analyzed six datasets to develop our algorithm and then
evaluated it on two additional datasets. Table 1 summa-
rizes these last two; the other six had similar characteris-
tics. About 4.4% and 42% of the address space is populated
at LBL and ICSI respectively. Note that the number of ac-
tive hosts is estimated from the connection status seen in the
logs, rather than an absolute count reported by the site: we
regard a local IP address as active if it ever generated a re-
sponse (either a successful or rejected connection).
Among the 190,928 and 29,528 remote hosts that sent
at least one packet to the corresponding site, the Bro sys-
tem at the site ﬂagged 122 (LBL) and 7 (ICSI) as scan-
ners, using the algorithm described in the previous section
with  (cid:0) (cid:1)(cid:2). Row 6 in Table 1 lists the number of remote
hosts that were identiﬁed as attempting to spread either the
“Code Red” or “Nimda” HTTP worm. Those remote hosts
that happened to ﬁnd a local Web server and sent it the in-
fection payload were caught by Bro based on the known sig-
natures for the worms. However, it is important to note that
the datasets may contain many more remote HTTP worms
that were undiagnosed by Bro because in the course of their
random scanning they did not happen to ﬁnd a local HTTP
server to try to infect.
The other bad row in Table 1 corresponds to re-
mote hosts that sent any packet to one of the following
ports: 135/tcp, 139/tcp, 445/tcp, or 1433/tcp. These corre-
spond to Windows RPC, NetBIOS, SMB, and SQL-Snake
attacks (primarily worms, though Bro lacks detectors for
As mentioned in the Introduction, the available datasets
give us a limited form of “ground truth,” in that the re-
mote hosts tagged as scanners very likely do reﬂect hostile
scanners, and many (but surely not all) of the remote hosts
tagged as benign are in fact benign. However, to soundly ex-
plore the data we need to have as strong a notion of ground
truth as possible. In particular, we need some sort of de-
termination as to which of the large number of remainder
entries (row 8 of Table 1) are indeed undetected scanners
that we then need to separate out from the set of otherwise-
presumed-benign hosts before evaluating the effectiveness
of any algorithm we develop.
This is a difﬁcult but crucial problem. We need to ﬁnd a
way to bootstrap our assessment of which of the remainder
are likely, but undetected (due to their lower level of activ-
ity), scanners. Ideally, the means by which we do so would
be wholly separate from our subsequently developed detec-
tion algorithm, but we were unable to achieve this. Conse-
quently, our argument is nearly circular: we show that there
are properties we can plausibly use to distinguish likely
scanners from non-scanners in the remainder hosts, and
we then incorporate those as part of a (clearly imperfect)
ground truth against which we test an algorithm we develop
that detects the same distinguishing properties. The sound-
ness of doing so rests in part in showing that the likely scan-
ners do indeed have characteristics in common with known
malicious hosts.
We ﬁrst attempt to detect likely scanners by looking for
remote hosts that make failed connection attempts to a dis-
proportionate number of local addresses, comparing the dis-
tribution of the number of distinct inactive local hosts ac-
cessed by known bad hosts vs. those accessed by the as-
yet undifferentiated remainder. Ideally, the distribution for
remainder would exhibit a sharp modality for which one
mode resembles known bad hosts and the other is quite
different. We could then use the mode as the basis for dis-
tinguishing undiagnosed scanners from benign hosts, con-
structing a more accurate ground truth.
2
The ﬁrewall conﬁgurations at the two sites differ, but for brevity we
omit the details.
Proceedings of the 2004 IEEE Symposium on Security and Privacy (S&P’04)  
1081-6011/04 $ 20.00 © 2004 IEEE 
4
)
s
t
s
o
h
e
t
o
m
e
r
f
o
#
(
F
D
C
)
s
t
s
o
h
e
t
o
m
e
r
f
o
#
(
F
D
C
 1
 0.9
 0.8
 0.7
 0.6
 0.5
 0.4
 0.3
 0.2
 0.1
 0
 1
 0.9
 0.8
 0.7
 0.6
 0.5
 0.4
 0.3
 0.2
 0.1
)
s
t
s
o
h
t
e
o
m
e
r
f
o
0
10
100
1000
10000
remainder
known_bad
# of inactive local hosts 
(a) LBL
#
(
f
D
C
)
s
t
s
o
h
e
t
o
m
e
r
f
o
#
(
f
D
C
remainder
known_bad
 1
 0.8
 0.6
 0.4
 0.2
 0
 0
 20
 40
 60
 80
 100
% of inactive local hosts 
(a) LBL
remainder
known_bad
 1
 0.8
 0.6
 0.4
 0.2
0
10
100
1000
10000
remainder
known_bad
# of inactive local hosts 
(b) ICSI
 0
 0
 20
 40
 60
 80
 100
% of inactive local hosts 
(b) ICSI
 1
 0.8
 0.6
 0.4
 0.2
 0
 1
 0.8
 0.6
 0.4
 0.2
 0
Figure 1. Cumulative distribution of the number
of remote hosts over the number of distinct lo-
cal addresses to which a remote host unsuc-
cessfully attempted to connect (# of inactive lo-
cal hosts). The vertical dotted line at (cid:0) (cid:0) (cid:1)(cid:2) cor-
responds to the threshold used by the Bro NIDS
at the sites.
Figure 1 plots this comparison. Unfortunately, we do not
see the desired modality for remainder. Furthermore, the
distribution of known bad is such that in order to detect
most of them solely on the basis of their failed access at-
tempts, we would need to use a threshold signiﬁcantly lower
than 20; and doing so will also ﬂag a non-negligible por-
tion3 of remainder without us knowing whether this judg-
ment is correct. Finally, we note that a basic reason for the
large spread in the distributions in Figure 1 (note that the
(cid:1)-axis is log-scaled) is due to the very large spread we ob-
serve for the rate at which different scanners scan.
However, we do ﬁnd a strong modality if we instead ex-
3 Recall that there are 10’s of thousands of remainder, so even a small
absolute portion of them can reﬂect a large number of hosts.
Figure 2. Cumulative distribution of the number
of remote hosts over the percentage of the lo-
cal hosts that a given remote host has accessed
for which the connection attempt failed (% of in-
active local hosts)
amine the ratio of hosts to which failed connections are
made vs. those to which successful connections are made.
Deﬁne inactive pct as the percentage of the local hosts
that a given remote host has accessed for which the connec-
tion attempt failed (was rejected or unanswered). Figure 2
shows the distribution of inactive pct for each dataset.
Figure 2(a) shows that about 99.5% of LBL’s known bad
remotes hit nothing but inactive hosts (expected, due to the
ﬁrewall for most of the ports such hosts attempt to access).
For ICSI, the proportion is spread between 60%–100%, but
this still shows a clear tendency that known bad hosts are
likely to hit many non-existent hosts or hosts that do not
support the requested service.
On the other hand, we see that in both cases, the re-
mainder are sharply divided into two extreme sets—either
0% inactive pct, or 100% inactive pct—which
Proceedings of the 2004 IEEE Symposium on Security and Privacy (S&P’04)  
1081-6011/04 $ 20.00 © 2004 IEEE 
5
Total unique remote hosts
known bad
scanners
HTTP worms
remainder