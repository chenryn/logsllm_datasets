# 图表说明

## 图5：控制器在10小时（顶部）和4天（底部）内每秒收到的流设置请求频率。
- 时间（小时）：0, 2, 4, 6, 8, 10
- 请求频率（次/秒）：0, 200, 400, 600, 800
- 时间（小时）：0, 24, 48, 72, 96

## 图6：控制器负载下的流设置时间。
- 控制器负载（次/秒）：0, 2000, 4000, 6000, 8000, 10000
- 流设置时间（秒）：0, 0.2, 0.4, 0.6, 0.8, 1, 1.2, 1.4, 1.6
- 数据包大小分别为64B、128B和256B，分布均匀。

## 部署情况
我们的Ethane原型部署在一个100Mb/s以太网网络中。我们安装了11个有线和8个无线Ethane交换机。目前，该网络上大约有300个主机，在任何5分钟的时间窗口内平均有120个主机活跃。我们创建了一个网络策略，以紧密匹配并通常超越现有的连接控制。我们通过查看VLAN使用、终端主机防火墙配置、NAT和路由器ACL来整合现有策略。我们发现，现有的配置文件中经常包含与当前网络状态无关的规则，这些规则未被纳入Ethane策略中。

简要来说，根据我们的政策，非服务器（工作站、笔记本电脑和手机）受到来自服务器的出站连接保护，而工作站之间的通信不受限制。连接到Ethane交换机端口的主机必须注册MAC地址，但不需要用户身份验证。受WPA和密码保护的无线节点不需要用户身份验证，但如果主机MAC地址未注册（在我们的网络中这意味着它们是访客），则只能访问少数服务（HTTP、HTTPS、DNS、SMTP、IMAP、POP和SSH）。我们的开放式无线接入点要求用户通过大学范围内的系统进行身份验证。VoIP电话被限制与非电话设备通信，并且静态绑定到单个接入点以防止移动性（符合E911位置合规要求）。我们的策略文件有132行。

## 性能和可扩展性
部署Ethane使我们对集中管理网络的操作有了很多了解，并使我们能够评估其性能和可扩展性的许多方面，尤其是在用户数量、终端主机数量和交换机数量方面。我们首先研究Ethane在我们网络中的表现，然后利用我们的测量数据和其他人的数据，尝试推断更大网络的性能。

### 控制器可扩展性
我们的Ethane原型目前由大约300个主机使用，在任何5分钟的时间窗口内平均有120个主机活跃。从这些主机中，我们看到每秒30-40个新的流请求（见图5），峰值为每秒750个流请求。图6显示了控制器在负载下的表现：对于每秒高达11,000个流的负载——大于我们观察到的峰值负载——最坏情况下流设置时间小于1.5毫秒，并且CPU负载几乎可以忽略不计。

我们的结果表明，一个单独的控制器可以舒适地处理每秒10,000个新的流请求。如果我们专注于优化设计，我们完全期望这个数字会增加。考虑到这一点，值得问一下这种负载对应多少终端主机。

我们考虑了两个最近的数据集：一个是来自劳伦斯伯克利国家实验室（LBL）的8,000主机网络，另一个是斯坦福大学的22,000主机网络。如[12]所述，LBL跟踪数据中的最大活动流数从未超过每秒1,200个（见图7）。斯坦福数据集的最大新流请求率为每秒不到9,000个（见图8）。

令人惊讶的是，我们的结果显示，一个单独的控制器可以舒适地管理超过20,000个主机的网络。实际上，在持续负载达到每秒6,000个的情况下，流设置延迟小于0.6毫秒，相当于斯坦福网络内DNS请求的平均延迟。对于每秒低于2,000个请求的负载，流设置延迟为0.4毫秒，这大致相当于我们校园网络中不同子网之间主机的平均往返时间。

当然，在实际应用中，规则集会更大，物理实体的数量也会更多。然而，控制器轻松处理这些流量的能力表明还有改进的空间。这并不是建议网络应该依赖单一控制器；我们预计大型网络将部署多个控制器以实现容错，使用§3.5中概述的方案之一。

### 故障期间的性能
由于我们的控制器实现了冷备份故障恢复（参见§3.5），控制器故障将导致活动流的服务中断，并在重新建立时产生延迟。为了了解重新安装流所需的时间，我们测量了275个连续HTTP请求的完成时间，总共检索了63MB的数据。在请求进行过程中，我们多次崩溃并重启控制器。表1显示每次故障都会导致总体完成时间增加约10%。当然，如果网络使用热备份或完全复制的控制器以更快地从故障中恢复（参见§3.5），这种惩罚可以大大消除。

在Ethane中，链路故障要求所有未决流重新联系控制器以重新建立路径。如果链路使用频繁，控制器将收到大量请求，其性能将下降。我们创建了一个具有冗余链路的拓扑结构来测试这种情况。