服务器地址（见图11），我们对其解密后为：111.240.228.234:8833。
图11 攻击者注册的百度账户页面
##### 4.3 窃取用户设备信息和状态信息
恶意木马连接 C&C
服务器成功后，会发送受害用户手机相关信息，包括：android_id、系统版本、手机版本+显示屏参数、是否root、关机状态、sim卡是否处于就绪状态、用户手机号码、IMEI、手机中账户信息（见图12、图13）。除了发送用户手机相关信息，还会再次发送用户手机的相关状态信息（见图14）。
图12 连接 C&C 服务成功后，发送用户手机信息
图13 具体发送的手机信息
图14 发送用户手机当前状态信息
图15是以上通信的日志信息。可以清楚地看到连接的 C&C 服务器地址，连接成功后，更新用户手机状态信息到 C&C 服务器。
图15 更新用户手机状态信息的日志
##### 4.4 通过 C&C 服务器下发命令和回传任务
该恶意木马使用加密的 WebSocket 协议来和 C&C 服务器通信，恶意木马和 C&C 服务器各自实现了自己的 RPC
函数供对方调用（其中图16是恶意木马实现的 RPC 函数），通信双方利用这些RPC函数来达到数据窃取和远程控制的目的。恶意木马实现的 RPC
函数可发送短信（目标地址和内容由 C&C 服务器提供）、锁定用户手机、获取手机通讯录、发送钓鱼信息给手机联系人等（具体见表2）。
 图16恶意木马实现的RPC函数
表2 该恶意木马实现的 RPC 函数
图17是该恶意木马和 C&C 服务器通信部分，恶意木马解析 C&C 服务器发送过来的网络数据，执行对应的 RPC 函数，再将函数执行结果返回给 C&C
服务器。
图17 C&C 服务器和恶意木马的通信
同时，该恶意木马也会给 C&C 服务器发送请求指令，分别为：下载指定的 apk 文件、发送钓鱼到的 Google
账户凭证、得到需要更新的包列表、得到标题等显示提示（见表3）。
表3 恶意木马发送给C&C服务器的函数请求
##### 4.5 窃取用户 Google 账户信息
该恶意木马除了收集受害用户的手机硬件相关信息和手机状态信息，还会窃取受害用户的 Google
账户凭证。与常见的利用远程服务器钓鱼页面不同的是，该恶意木马在受感染手机本地开启了一个 Httpserver
服务，并利用该本地服务页面完成对受害用户的账户凭证钓鱼后，再将其通过加密的 WebSocket 协议转发到C&C服务器。在恶意木马筛选出 google
账户后（见图18），会弹出警告对话框，等受害用户点击确定后，恶意木马就会打开浏览器，跳转到自定义的本地钓鱼页面（见图19）。
图18 筛选Google账户
图19 弹出警告窗口
该恶意木马在本地创建 HttpServer 服务，本地 HttpServer 服务启用线程来处理钓鱼到的 Google 账户信息（见图20）。
图20 恶意木马利用本地服务来处理钓鱼到的Google账户信息
恶意木马将钓鱼到的 Google 账户凭证发送到 C&C 服务器（见图21）。
图21 恶意木马将钓鱼到的Google账户凭证信息发送到C&C服务器
##### 4.6 下载伪装银行类 APP
该恶意木马会遍历受害用户本机安装的 APP 信息，以确定受害用户是否安装有特定的银行类 APP。如果有的话，该恶意木马就会从 C&C
服务器下载对应的银行类木马，待对应的木马下载完成后，就提示用户有新的升级。银行类木马运行后，会卸载掉受害用户本机原始合法的 APP
来偷梁换柱。显而易见，对受害用户真正的钓鱼攻击才刚刚开始。
遍历用户手机应用，检查是否有内置指定的银行类 APP，有的话，从 C&C 服务器下载对应的银行木马 APP（见图22）。
图22 遍历受害用户手机应用
如果用户手机存在指定的银行类 APP，则从 C&C 服务器下载对应的银行木马 APP（见图23）。
图23 从 C&C 服务器下载指定的银行木马 APP
表4为恶意木马内置的要伪装的银行类 APP 包名
表4 恶意木马要伪装的银行类 APP 包名
银行类恶意木马 APP 下载完成后，会弹出提示框，诱使用户更新（见图24）。
图24 诱使用户安装下载到的银行类木马
银行类恶意木马运行后，会卸载掉受害用户原来合法的银行类 APP（见图25）。
图25 下载下来的木马偷梁换柱
##### 4.7 传播
该恶意木马通过向受害用户的通讯录联系人发送钓鱼信息来传播（见图26）。
图26 该恶意木马的传播途径
#### 5、总结及建议
虽然该恶意木马是针对韩国用户，但也不排除后续针对其他国家实施攻击的可能。用户除了对热门的 APP 下载和更新不能大意外， 对系统自带的 APP
的更新也应保持警惕。建议用户不要轻易点击短信中的不明链接，不要安装不明来源的 APP。对申请可疑权限尤其是短信读写、打电话以及需要激活设备管理器的 APP
要特别留意，涉及到金钱的操作要格外谨慎。遇到操作异常，应当及时使用杀毒软件查杀或找专人处理。目前互联网上也充斥着形形色色的第三方 APP
下载站点，很多甚至成了恶意应用的批发集散地。用户应特别留意不要轻易地在一些下载站点下载 APP，尽量从官网下载所需 APP
应用，在不得不从第三方下载站点下载软件时，要保持高度警惕，认真甄别，防止误下恶意应用，给自己造成不必要的麻烦和损失。
* * *
**启明星辰积极防御实验室（ADLab）**
ADLab成立于1999年，是中国安全行业最早成立的攻防技术研究实验室之一，微软MAPP计划核心成员。截止目前，ADLab通过CVE发布Windows、Linux、Unix等操作系统安全或软件漏洞近300个，持续保持亚洲领先并确立了其在国际网络安全领域的核心地位。实验室研究方向涵盖操作系统与应用系统安全研究、移动智能终端安全研究、物联网智能设备安全研究、Web安全研究、工控系统安全研究、云安全研究。研究成果应用于产品核心技术研究、国家重点科技项目攻关、专业安全服务等。
* * *