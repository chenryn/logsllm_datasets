**作者：w2ning**

本文为作者投稿，Seebug Paper 期待你的分享。凡经采用即有礼品相送！ 投稿邮箱：PI:EMAIL

## 引言
本文汇总并分析了2022年上半年发生的三个独立攻击事件。尽管这些攻击的漏洞原理各不相同，但它们有一个共同点：攻击者不再仅仅依赖于Flash Loan来执行Single-Transaction-Attack（这一术语由作者自创），而是投入数百万美元真金白银操纵价格，制造触发漏洞的前置条件，最终成功实施恶意攻击。如果2022年之前的攻击者还只是通过代码漏洞空手套白狼的“穷小子”，那么2022年之后的他们不仅更加专业，而且资金充裕，可以说达到了“人均索罗斯”的水平。这种大环境对众多DApp的安全性和鲁棒性提出了更高的要求，曾经被认为安全的经济模型可能需要重新审视——高昂的攻击成本是否仍能阻止心怀恶意的人。

以下是对这三个事件按时间顺序的详细描述：

## Fortress
2022年5月9日，攻击者利用预言机合约`Chain.sol`中的`submit()`函数未授权调用的问题，恶意操纵了`FTS`的价格，并用低价值的`FTS`抵押借出了多种高价值Token后离场。实际上，攻击者的准备工作早在4月份就已经开始：
1. 4月27日，大量购买`FTS`。
2. 5月2日，发布恶意提案，提议将`FTS`添加到抵押物名单中（在此之前，`FTS`并非官方认可的抵押物）。
3. 5月9日，提案通过后，部署攻击合约，在一次交易中同时完成提案执行、价格篡改、质押添加及借出其他Token的操作。

## DEUS
2022年4月28日，DEUS所使用的`Muon VWAP`预言机被恶意操纵，导致`DEI`价格翻了20倍。攻击者用`DEI`超额借出约1300万美元资产后离场。具体步骤如下：
1. 跨链转入超过两百万的`USDC`作为预备资金。
2. 在`USDC/DEI`交易对上精心构造了一笔`200万USDC`兑换`10万DEI`的swap，以操纵`Muon VWAP`预言机的价格。
3. 使用22次不同DEX和池子的闪电贷，几乎借空了Fantom链上的1.4亿`USDC`，再次在`USDC/DEI`交易对上兑换`DEI`，确保与预言机价格一致。
4. 最终抵押`USDC/DEI`的LP Token，借走1700万`DEI`，换回`USDC`，归还所有闪电贷，并带着约1300万美元的利润跨链离场。

这次攻击展示了攻击者在前期准备、闪电贷嵌套调用以及对链下预言机和链上交易对运行机制的深刻理解方面的高水平。

## INVERSE
2022年4月2日，`INV`的价格被恶意操纵，导致损失约1500万美元。攻击过程如下：
1. 从混币器中取出900个`ETH`作为预备资金。
2. 在`INV-WETH`交易对上进行swap操作，用500个`ETH`换取1700个`INV`，部分操纵了价格。
3. 由于Inverse Finance使用的是`Sushi Twap`预言机，会采样每个块的第一笔与`INV`有关的历史交易价格，加权平均计算当前价格，因此攻击者需在多个区块内维持扭曲价格。为此，攻击者通过多个地址发布垃圾交易，挤占整个区块，确保扭曲价格生效。
4. 随后，攻击者质押`INV`，借出价值1500万美元的`wbtc`、`YFI`和`DOLA`后离场。

### 结论
这些攻击者在财务自由之前已经实现了财务自由。许多以前被认为成本过高而不太可能发生的攻击手段正在现实中一一上演。DApp开发者在设计协议时，可能需要重新定义“假想敌”的画像，以应对日益复杂和专业的攻击方式。