atthetrafÔ¨Åcsourcesisthemostintuitiveandeffectivecontrolfortheoverloadprotection.Thevariantsofthiscooperativedefensemechanism(approachesliketraceback[9],[16],[18],pushback[5],andPi[19]etc.)requiresomemodiÔ¨ÅcationsinthecoreoftheInternet.However,InternetServiceProviders(ISPs)arereluctanttoinstalltheproposedmodiÔ¨Åcationswithoutsomeextremelycompellingreasonsorincentives;tillthen,thesemechanismshavealimitedorverylittlechanceofreal-worlduse.TherearemanyIETFworkingdrafts[4],[14]proposingoverloadingindicatorstoupstreamelementsbyintroducingnewheaders.However,thesemethodsaremoresuitableamongtrustedcorenetworkelements.Inthispaper,ourmainfocusisonoverloadingconditionsduetonumerousSIPendpointsdistributedovertheInternet.Inacademiatherearemanyefforts[10],[17]todetectandprotectVoIPnetworksfromDDoSattacks,whileÔ¨Çashcrowdsstillremainoverlooked.Further,ifwecloselylookattheIPtelephonyservice,weÔ¨Åndthatreal-timeandessentialnatureofthetelephonyservicemakesitdifferentfromotherregularInternet-basedservices.Consequently,themostpopularandlargelydeployedoverloadingprotectionmechanismssuchasrequestratethrottling,randomdroppingofrequests,andblackholingarenotappropriatefortelephonyservices.OperatingunderthesepracticalrequirementsoftheIPtelephonyserviceandstillbeabletodetectanddistinguishallaspectsofanINVITEsurgethatdiffersinintentonlyisnotatrivialtaskandobviouslysetsanambitiousgoal.,AJA?JLAH=@EC>O>IAHLECIEC=ECJH=BBE?IJHA=1IEJ=B=ID?HM@H,,5=JJ=?)FFO==FFHFHE=JALAH=@EC?JHA?D=EI/AJJDABAA@>=?BIAHLAHIFAHBH=?A>O>IAHLECIEC=ECJH=BBE?IJHA==@?=AHI?=>AD=LEH1IEJ=EE?HOHKJ=JEC=JJ=?5JAF,AJA?JE+=IIEBE?=JE5JAF 2HJA?JE5JAF!.AA@>=?4A?JEBE?=JEIEC=ECJH=BBE?;AI;AI)MA@J=??AII512IAHLAHHAIKH?AIFig.1.OverviewofOverloadingDefenseMechanismOverviewofourapproach.Figure1showsouroverloadingdefensemechanismasathreestepprocess.IntheÔ¨Årststep,wedetectanddistinguishoverloadingconditions.Thepro-posedanomalydetectionsensor(ADS)isbasedonasimpleobservationthatdespitetheunpredictableandburstinessofpacket-levelInternettrafÔ¨Åc,transaction-likeVoIPsignalingtrafÔ¨ÅcgeneratedbySIPprotocolstillmaintainsaninherentattributecorrelation.WeshowthatDDoSattacksandÔ¨Çashcrowds,whilesimilarinthenumberofINVITEsandmessagestructure,exhibitdifferenttrafÔ¨Åcpatterns.Thisdifferentiationisneededsothatinthesecondstep,differentresponsestrategiescanbeinvoked.IntheDDoSattack,INVITEmessagesareblockedsincemostINVITEsareassumedtobelongtotheattacktrafÔ¨Åc.Whereas,inÔ¨Çashcrowd,aslightlydifferentprobabilisticINVITEdroppingtechniqueisusedtoincreasethelikelihoodthatlegitimateuserswilleventuallybeserved.BeingbasedonSIPprotocol‚Äôsreliabilitymechanismandexponentialbackofftimervalues,wedonotexpectanymodiÔ¨ÅcationswithinthenetworkoroftheSIPentities.Finally,thethirdstepisgatheringoffeedbackandrectifyingtheappliedcontrolmechanism.Tocircumventdetection,insteadofrelyingonbandwidthattacks,attackersmaytrytomimicnormaluserbehavior.Afteranoverloadingcontrolisappliedinstep2,inthe3rdstep,weobservechanges(aftereffects)ofthecallers‚Äôcallbehavior.Theentropymeasurementofcalldu-rationsgivesanimportantcluetodistinguishbetweenhumansandzombiescallbehavior.Infact,step3isaperiodicprocessthattriestoidentifymimicryattackandpossiblemutationsintheoverloadingattack.AfterdiscoveringanydiscrepancyintheearlierattackidentiÔ¨Åcation,protectionmechanismevolvesandappliesanappropriateoverloadingcontrolmechanism.Organizationofthepaper.Theremainderofthispaperisstructuredasfollows.SectionIIpresentsexamplesofSIP-relatedoverloadingthreats.SectionIIIdescribesVoIPsignalingtrafÔ¨Åcbehaviorandsimulatednetworktopology.SectionsIVgivethedeÔ¨ÅnitionofHellingerdistanceandhowitcouldbeappliedtoVoIPsignalingtrafÔ¨Åcstreamstodetectoverloadingconditions.SectionVpresentsadetaileddescriptionofoverloadingpreventionmechanisms.SectionVIshowstheuseentropymeasurementofcalldurationtodetectthoseDDoSattacksthatmasqueradeasÔ¨Çashcrowds.Finally,SectionVIIconcludesthepaper.II.THETHREATMODELSessionInitiationProtocol(SIP)[15]isatransactionalprotocol,inwhicheachtransactionconsistsofarequestanditscorrespondingresponses.SIPcoresortransactionusers(TUs)attheSIPentity(exceptstatelessproxy)maintainthetransactionstateforsometime.Forexample,aSIPproxymaintainsINVITEtransactionstateaslongasthereisaprovisionalresponsewithinevery3minutes.Similarly,whenanUAS1acceptsanINVITErequest,TUgeneratesa2XXresponseandwaitsfortheACKwhilemaintainingthetransactionstate.IfUASretransmitsthe2XXresponsefor64‚àóT1sec.(defaultvalueoftimerT1is500ms)withoutreceivinganACK,thesessionshouldbeterminatedbysendingaBYEmessage.Inalltheseandotherexamples,TU‚ÄôsÔ¨ÅnitecapacityofmaintainingstateforthetransactioncouldeasilybeexploitedbyÔ¨Çoodingwithspuriousrequests.ItshouldalsobenotedthatthoughtheIPtelephonyisnotanopen-accesssystemlikewebsites,stillitispossibletolaunchDDoSattacks.Themisbehaviorofauthenticatedusers,exploitingthedigestweaknesses,replayofpre-recordedINVITEmessages,bot-generatedboguscopiesofINVITEmessages,andintertwiningofspoofedINVITEmessagescarryingwrongcredentialsintheauthenticationcycleofINVITEmessageexchangearesomeoftheexamplesofspuriousINVITErequestsusedtolaunchattacks.III.VOIPSIGNALINGTRAFFICBEHAVIORWeconductextensivestatisticalanalysistoproÔ¨ÅlethenormalbehaviorsofSIPprotocolattributesinVoIPsignalingtrafÔ¨ÅcobtainedfromourrealisticVoIPtestbed.HerewedeÔ¨ÅneprotocolattributesasthemessagetypesappearinginVoIP1Enddevicesareconsidereduseragents(UAs).EachUAisacombinationoftwoentities,theuseragentclient(UAC)andtheuseragentserver(UAS).DuringasessiontheUAswitchesbackandforthbetweenaUACandaUAS.978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
421
-JAHFHEIAAJMH)1JAHAJ-JAHFHEIAAJMH+#EEIA?=JA?O" 2=?AJII5122HNO5AHLAH156-6-JAHFHEIAAJMH*-JAHFHEIAAJMH,2=?AJ+=FJKHA)JJ=?6H=BBE?/AAH=JH0500100015002000250030003500020406080100120time(second)Call Arrival Rate01020304050600500100015002000SIP Normal Traffic Behavior01020304050600500100015002000time (minutes)Number of PacketsINVITE BYE 100 Trying ACK 200 OK (a.)SimulatedNetworkTopology(b.)CallArrivals(c.)NormalTrafÔ¨ÅcBehaviorFig.2.NormalSIPSignalingTrafÔ¨ÅcBehavior(10SecondsBin)signalingtrafÔ¨Åc.Forexample,SIP‚ÄôsrequestandresponsemessagessuchasINVITE,200OK,ACKandBYEetc.areconsideredasprotocolattributes.Inthissection,wediscusstheexistenceofaninherentcorrelationamongprotocolattributesattheapplicationlayer.A.ExperimentSetupInordertostudyVoIPsignalingtrafÔ¨Åcbehavior,webuildatestbedconsistingofaSIPproxyserverandIP-basedsoft-phones.ThetestbedconsistsofeightPCsequippedwithLinuxoperatingsystemactingasSIPUAs,SIPproxyserver,arouterwithwideareanetworkemulatorandanattackerwithINVITEÔ¨ÇoodtrafÔ¨Åcgenerator.Figure2(a)showsthelayoutofthetestbedusedtogenerateVoIPtrafÔ¨Åcandtoevaluatetheperformanceofproposeddetectionandprotectionmechanisms.OurSIPproxyserverisbasedonSER(i.e.,SIPExpressRouter[6]),anopensourcesoftwareproject.WeinstalledanddeployedSIPserverontoasinglePC(1.8GHzIntelPentiumIVwith512MbytesofRAM).EnterprisenetworksA,B,CandDaresimulatedbyPCs(866MHzPentiumIIIPCwith256MbytesRAM)equippedwithSIPtrafÔ¨ÅcgeneratorsthatbehaveasmultipleUAsaretryingtomakecallstoUAsintheotherenterprisenetworks.Thetalktime(i.e.,callduration)betweenanytwosubscribersisexponentiallydistributedwithmeantalktimeof120seconds.Thewideareanetworkemulator(‚ÄúNISTNet‚Äù[1])connectsenterprisenetworksandSIPserverwitheachotherusing100MbpsEthernetlinks.TheNISTpackagerunsonaLinuxrouter(633MHzPentiumIIIPCwith128MbytesRAM)inwhichpacketdelaydistributions,congestion,loss,bandwidthlimitationetc.areconÔ¨Ågurable.WesettheInternetdelayto50msandthepacketlossrateto0.42%inourexperiments.Normalbehavior.Figure2(c)plotsthenormalSIPtrafÔ¨Åcbe-haviorasobservedbytheADSneartheSIPproxyserver.ADSmonitorsbothto-and-frosignalingtrafÔ¨ÅcbetweensubscribersandtheSIPproxyserver(e.g.,seeFigure2(a)).Therefore,end-to-endmessagesareseentwicebytheADS.SIPsignalingmessagesarecarriedbyUDPandUAsusethedefaultT1timervalueof500ms.Inordertoemulatearealisticnormalcallbehavior,weassumePoissondistributedphonecallarrivals.Inourexperiments,weusethreeindependentPoissonprocessesN1(t),N2(t)andN3(t)withmeanarrivalratesof30,30and15callspersecond(CPS),respectively.TomimicdiurnalcallbehaviorasshowninFigure2(b),duringanhourexperimentrun,theinitialandlast25minutesrepresentday-timepeakcallrate(generatedbyallthreeindividualprocesses)andthein-between10minutesrepresentsoff-peakhourssuchasnighttimeortheweek-end(generatedbyN3processonly).AsshowninFigure2(c),theSIPprotocolattributesINVITE,(100Trying),(200OK),ACKandBYEcurvesshownear-idealnormalbehavior.Itshouldbenotedthatinthispaper,the(200OK)messagescorrespondtoINVITEsonly.Duringanhourexperimentalrun,weobserve975and11760INVITEretransmissionsfromtheclientsandSIPproxyserverrespectively.Thereare2044(200OK),4006ACKand12490BYEretransmissionsfromtheSIPproxyserver.BecauseoftheInternetnetworkconditionsandprocessingdelaysattheserver,thestrictone-to-onerelationshipbetweenINVITEandothercallsetupmessages,suchas(200OK),ACKetc.areviolated.However,undernormalconditionsthesedeviationsfromidealbehavioraresmallandexhibitstrongpositivecorrelationsamongcallsetupmessages.BehaviorunderÔ¨Çashcrowd.Figure3plotstheSIPsessionestablishmentbehaviorunderÔ¨Çashcrowds.Duringtheinitial10minutes,theSIPproxyserverisloadedwithaPoissoncallrate(withmeanof75CPS).Inthisperiod,thecallsetupmessagesdemonstrateone-to-onerelationshipwithoccasionalpacketdropsandretransmissions.InordertosimulateaÔ¨Çashcrowdevent,atthestartingof10thminute,additional375,400and425CPSareintroduced,bringingtheoverallcallrateto450,475and500CPSrespectively.TheSIPproxyservershowsremarkableresiliencyandtriestobehavenormallyforthenextcoupleofminutes(dependingupontheseverityofÔ¨ÇashcrowdasshowninFigure3).Asweknow,atransactionstatefulserverkeepsacopyofthereceivedrequestforsometimeandatransactioncontexttypicallyconsumes(cid:3)3KBytes(dependingonmessagetypeandmemorymanagementover-head)[2].Therefore,aftermaintainingacertainnumberoftransactioncontexts,theSIPproxyserver‚Äôsperformancedegrades.Atthistransitionpoint,thecallthroughputfallsquicklyandbecauseoftheresourceexhaustionandprocessingdelays,weobserveasuddenjumpinINVITEand(200OK)retransmissionsbytheSIPUAs.TheexistingINVITEtransactionsintheserveralsostarttimingout(bysendingout[408Timeout]messages).BehaviorunderINVITEÔ¨Çooding.Figure4plotstheSIPsessionestablishmentbehaviorunderDDoSattack.Atthe978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
422
0510152025303540024x 104Flash Crowd: INVITE Surge From 75 to 450 CPS05101520253035400123x 10405101520253035400   200040006000time (minutes)Number of PacketsINVITE 200 OK ACK 100 Trying 408 Timeout 500 Server Error 0510152025303540024x 104Flash Crowd: INVITE Surge From 75 to 475 CPS05101520253035400123x 10405101520253035400200040006000time (minutes)Number of PacketsINVITE 200 OK ACK 100 Trying 408 Timeout 500 Server Error 0510152025303540024x 104Flash Crowd: INVITE Surge From 75 to 500 CPS5101520253035400123x 10405101520253035400200040006000time (minutes)Number of PacketsINVITE 200 OK ACK 100 Trying 408 Timeout 500 Server Error (a.)FlashCrowd(75to450CPS)(b.)FlashCrowd(75to475CPS)(c.)FlashCrowd(75to500CPS)Fig.3.SIPTrafÔ¨ÅcBehaviorUnderFlashCrowd(10SecondsBin)051015202530012x 104INVITE Flood (50 per sec.)05101520253005000051015202530012x 1040510152025300200400time (minutes)Number of PacketsINVITE 200 OK ACK 100 Trying 408 Timeout 500 Server Error 051015202530012x 104INVITE Flood (75 per sec.)05101520253005000051015202530012x 1040510152025300200400time (minutes)Number of PacketsINVITE 200 OK ACK 100 Trying 408 Timeout 500 Server Error 051015202530012x 104INVITE Flood (150 per sec.)05101520253005000051015202530012x 1040510152025300200400time (minutes)Number of PacketsINVITE 200 OK ACK 100 Trying 408 Timeout 500 Server Error (a.)DDoSAttack(50SpoofedCPS)(b.)DDoSAttack(75SpoofedCPS)(c.)DDoSAttack(150SpoofedCPS)Fig.4.SIPTrafÔ¨ÅcBehaviorUnderINVITEFloodingAttack(10SecondsBin)startingof10thminute,theinitialPoissoncallrate(withthemeanof75CPS)ismixedwithadditionalcallsattherateof50,75and150CPSwithspoofedsourceIPaddresses.First,theSIPproxyservertriestobehavenormallybysending(100Trying)messagesforeachofthereceivedINVITErequestsandbymaintainingtheirtransactionstate.ForeachoftheacceptedspoofedINVITErequests,theSIPproxyservertransmits7INVITEmessagestowardstheunreachabledestinationIPaddressbeforetimingoutthetransactionstate.Secondly,astheÔ¨Çoodingrateincreases,themajorpartofserverresourcesareheldupbythespoofedrequestsandthesearemadeavailableforfurtherreuseonlywhenthetransactionstimeout.Attheexhaustionofserverresourcesandduetoprocessingdelays,thenumberof(100Trying)declinesandafractionofnewINVITErequestsisrefusedtobeservicedbysending(500ServerError)messages.Becauseofthetimeouts(i.e.,removalofexistingtransactions)and(500ServerError)(i.e.,refusalofacceptingnewtransactions)messages,theproxyservertriestorecoverandacceptsnewrequests,butduetounabatedDDoStrafÔ¨Åc,theserver‚Äôsperformancedegradesagain,showinganoscillatorybehaviorofrecoveryanddegradation.DifferencebetweenÔ¨ÇashcrowdandDDoSattack.Themaindifferencebetweenthesetwoeventsisinthenature(i.e.,intent)ofINVITErequeststhatresultsintotwodifferentobservableprotocolbehavior.InsteadofanalyzingINVITErequestsinisolation,ourapproachstudiescallsetuptransac-tions(e.g.,bothINVITEandACK)revealingmanyuniquecharacteristics.Forexample,1)InÔ¨Çashcrowdtheproxyservertriestobehavenormallyandiftherequestarrivalsremainunabatedthenonlyaftersometime(dependinguponitsseveritylevel)server‚Äôsperformancedegrades.Whereas,inÔ¨Çoodingattack,ithappensmuchquicker.ThespoofedINVITEmessagesdonothavecorresponding(200OK)andACKmessagesandthereforeserverresourcesareexhaustedmuchfaster.2)Becauseofthelockupofserverresources(e.g.,transactionsarenotcompleted),INVITEÔ¨ÇoodingattackismoreharmfulevenatsmallerratecomparedtoÔ¨Çashcrowd.3)InINVITEÔ¨Çoodingattack,thelockupofserverresourcesandafterwardsitsrelease(byrejectingnewcallrequestsandtimingoutexistingtransactions)causeanoscillatorybehaviorofrecoveryanddegradation.Whereas,inÔ¨ÇashcrowdthecallthroughputfallstozeroandremainssametilltheÔ¨Çashcrowdsubsides.IV.STEP1:OVERLOADINGDETECTIONMECHANISMADSdetectsanomaliesincollectionsofpacketstreams,goingthroughacyclicbehaviorconsistingoftwophases.Duringthetrainingphase,thetrainingdatasetconsistingoftheattributesetiscollectedovernsamplingperiodsofduration(cid:4)t(=10sec.)overnormaltrafÔ¨Åcstreams.Thisinitialtrainingdatasetisassumedtobedevoidofanyattacksandactsasabaseforcomparisonwiththenext(n+1)thperiodofthetestingdataset.UsingtheHellingerdistance,wemeasurethedistancebetweenthesetwodatasets.Ifthemeasureddistanceexceedsathreshold,analarmisraised,andotherwisethetestingdatasetisincludedintheimmediatelypreceding(n‚àí1)sampledtrafÔ¨Åcdatatoderiveanewtrainingdataset.ThemovingwindowmechanismhelpsthetrainingdatasettoadaptwiththedynamicnatureofthenetworktrafÔ¨Åc.978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
423