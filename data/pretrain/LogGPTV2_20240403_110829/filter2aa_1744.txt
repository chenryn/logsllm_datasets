Linux-Stack Based V2X Framework: All You Need to
Hack Connected Vehicles
Duncan Woodbury, Nicholas Haltmeyer
{PI:EMAIL, PI:EMAIL}
July 29, 2017
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
1 / 38
State of the World: (Semi)Autonomous Driving
Technologies
Vehicular automation widespread in global industry
Automated driving technologies becoming accessible to general public
Comms protocols used today in vehicular networks heavily ﬂawed
New automated technologies still using CANBUS and derivatives
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
2 / 38
Stages of Autonomy
Today: Stage 2 Autonomy - Combined Function Automation
V2X: Stage 3 Autonomy - Combined Function Automation
) Leverage vehicular ad hoc mesh network for exchange of safety
and actor/world state information
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
3 / 38
Critical Aspects of V2X
Reliable high-throughput ad hoc mesh networking and exchange in a
real-time cyberphysical environment
Standardization of Stage 3 automation in federal and consumer
transportation systems
Enhanced safety and traﬃc optimization technologies leveraging V2X
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
4 / 38
Technologies Using V2X
Collision avoidance (Forward Collision Warning) systems
Advanced Driver Assistance Systems (ADAS)
Cooperative adaptive cruise control
Automated ticketing and tolling
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
5 / 38
Impact of V2X: Why Care?
Most importantly: self-driving cars are shiny
Your children will (would) ride in these
Enables safety functions not possible with onboard systems
V2X technologies applicable across range of cyberphysical systems
NHTSA V2V NPRM: V2V to be standardized in light vehicles
It‘s happening: You want in?
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
6 / 38
Tangible Beneﬁts
According to the USDOT,
Safety
Prevent 25,000 to 592,000 crashes annually
Save 49 to 1,083 lives
Avoid 11,000 to 270,000 injuries
Prevent 31,000 to 728,000 property damaging crashes
Travel time
27% reduction for freight
23% reduction for emergency vehicles
42% reduction on freeway (with cooperative adaptive cruise control &
speed harmonization)
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
7 / 38
Impact on Automotive Security
Will drive adoption and development of autonomous vehicles
Homogeneous use of WAVE and V2X enables unprecedented
complexity in transportation systems
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
8 / 38
V2X Protocol Stack
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
9 / 38
IEEE 802.11p
Wireless Access in Vehicular Environments
Amendment to IEEE 802.11-2012 to support WAVE/DSRC
PHY layer of V2X stack
No association, no authentication, Wildcard BSSID = {↵:↵:↵:↵:↵:↵}
5.8-5.9GHz OFDM
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
10 / 38
IEEE 1609
WAVE Short Message Protocol (WSMP)
1609.2 Security Services
PKI, cert revocation, misbehavior reporting
1609.3 Networking Services
Advertisements, message ﬁelds
1609.4 Multi-Channel Operation
Channel sync, MLMEX
1609.12 Identiﬁer Allocations
Provider service IDs
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
11 / 38
IEEE 1609.3: WSM
Packets encoded as WAVE Short Messages (WSMs)
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
12 / 38
IEEE 1609.3: WSM Example
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
13 / 38
IEEE 1609.3: WSA
Participants broadcast WAVE Service Advertisements (WSAs)
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
14 / 38
IEEE 1609.4: Channel Synchronization
Control and service channels (CCH and SCH)
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
15 / 38
SAE J2735
DSRC message set and data elements
ASN1 UPER encoding (latest rev does not compile)
Basic Safety Message (BSM), Emergency Vehicle Alert (EVA), etc.
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
16 / 38
Subtleties in Protocol Speciﬁcations
Ambiguous parse rules for certain frames (Information Element
Extension)
Services are gated only by PKI permissions
Proprietary applications using ad hoc permissions
Messages leak S/PII
Misbehavior reporting just randomizes the send address in an attempt
at privacy
WSA ﬁngerprinting prevents privacy
Channel switching for single-antenna systems desync
>0.1s delay with 200 cars/km2
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
17 / 38
State of V2X Standards
IEEE 802.11-2012 details 802.11p
Not supported by majority of COTS WiFi hardware
IEEE 1609.{3,4} stable, under development
IEEE 1609.2 (PKI, misbehavior reporting) incomplete, under
development
SAE J2735 stable, under development
SAE J2735 ASN1 (2016) not stable
Example of PKI Brilliance: ‘Another aspect of the privacy and
non-tracking of vehicles becomes apparent here as the MAC address
needs to be randomly changed to prevent vehicle tracking.’
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
18 / 38
Possibly Unintentional Obfuscation of the Standards
Removal of message CRC from J2735
Continued revisions would likely make in-the-ﬁeld devices obsolete
WSMPv3 (current) has no backwards compatibility
Standards vague in best practices, favoring proprietary
implementations
Consider:
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
19 / 38
Major Changes to the Standards
Standards still in development after decades
Spectrum allocated by the FCC in 1999
WAVE ﬁrst codiﬁed in 2005
J2735 in 2006
Rewrites of security services to change certiﬁcate structure
Rewrites of management plane to add services (P2PCD)
Incomplete safety message dictionary
No standards for application-layer services
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
20 / 38
Physical Manifestations of V2X: Deployment
Three USDOT pilot studies: NYC, Tampa (THEA), Wyoming
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
21 / 38
V2X in the Linux Networking Subsystem
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
22 / 38
802.11p: Driver and Kernel Tree Modiﬁcations
WiFi driver modiﬁcations:
Add support for ITS-G5 channel spectrum, 5/10MHz-width channels
Add support and error checking for OCB mode
Force usage of user-speciﬁed regulatory domain
/net/wireless modiﬁcations:
Add support wildcard broadcast transmission
Add support for 5/10MHz-width channels, channel state deﬁnitions for
OCB mode
Force usage of user-speciﬁed regulatory domain
mac80211 modiﬁcations:
Add (ﬁx) support and error checking for OCB mode
Initialization and de-initialization
Channel ﬁlter conﬁguration, disable beaconing and association
cfg80211 modiﬁcations:
Channel ﬁlter conﬁguration for OCB mode
Add support for 5/10MHz-width channels
nl80211 modiﬁcations:
Channel ﬁlter conﬁguration for OCB mode
Add support for 5/10MHz-width channels
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
23 / 38
IEEE 1609: 1609 in the Linux Kernel
Kernel module to pack, parse, and broadcast messages
Relevant data structures
WSM, WSA, WRA, SII, CII, IEX
Full control of ﬁelds
subtype, TPID, PSID, chan, tx power, data rate, location, etc.
Operating modes for setting degree of compliance to standard (strict,
lax, loose)
Channel sync, dispatch
Netlink socket interface to userspace (af wsmp)
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
24 / 38
Error Checking and Corrections Implemented
Parser short circuiting
Domain checks on each ﬁeld
Operating modes for standard compliance
Will reject messages where domain is non-compliant
Relevant error handling (EBADMSG, EINVAL, EFAULT, etc.)
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
25 / 38
SAE J2735: Userspace J2735 Message Dictionary
socketv2v utility suite: v2vsend, v2vdump, v2vsni↵er
Fully implements BSM, EVA, RSA, CSR J2735 message formats
Communicates with 1609 kernel module via Netlink socket
Enables VANET participation with generic Linux box and 5GHz WiFi
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
26 / 38
Platform Requirements: Linux!
V2X stack integrated in mainline Linux kernel
No proprietary DSRC hardware/software required
V2X stack current - deployed V2X ‘solutions’ obsolete
Currently supports ath9k/ath9k htc, rtlwiﬁ
Fully implements 802.11p, IEEE 1609.{3,4} in Linux networking
subsystem
IEEE 1609.2 to be integrated upon completion
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
27 / 38
Capabilities Leveraging V2X Stack: Hacking Connected
Vehicles
Rapidly prototype new V2V applications
Penetrate commercial implementations
Analyze real V2V network data
Pilot studies, protocol analysis
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
28 / 38
Developing Connected Vehicle Technologies
Widespread access enables engagement of security (1337) community
in standards development
History lesson: CANBUS sucks (for automotive)
Interact with existing V2X infrastructure
Pressure manufacturers and OEMs to implement functional V2V
Deploy ahead of market - experimental platforms
UAS, maritime, orbital, heavy vehicles
Opportunity for empirical research: See what you can break
Straightforward to wardrive
Hook DIY radio (Pi Zero with 5GHz USB adapter) into CANBUS (for
science ONLY)
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
29 / 38
(You can) Use J2735 DSRC over 802.11p with Linux
Participate in connected VANETS
v2vsend: Craft and inject messages into ITS spectrum
v2vsni↵er: Sni↵ particular messages from speciﬁc actors
v2vdump: Sni↵ all communications on ITS channels
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
30 / 38
DSRC Sniﬃng/Wardriving
DSRC is a broadcast protocol
Dimensions, directionality, orientation, acceleration, display etc.
provide means to easily ﬁngerprint and track participants
From the SAE DSRC Implementation Guide:
‘The VII Probe Data Service collects anonymous probe data from all
Mobile Users, and distributes it to any authorized Network User or
Roadside Infrastructure User that requests it.’
‘Applications are initialized by matching the locally registered AID with
an advertised AID (application announcement) received on the radio
link’
Highly distributed infrastructure - attacks propagate across the
network easily
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
31 / 38
Understanding the Adversary
Passive
Determine trajectory of cars within some radius
Few stations required to monitor a typical highway
Determine services provided by peers
Characterize network traﬃc for regions of the road
Uniquely ﬁngerprint hardware being used
RF signature
Probe responses
Active
Deny service
Manipulate misbehavior reports
Exploit bad hardware/software to access CANBUS
Di↵erent regional conﬁgurations can lead to undeﬁned behavior
Disrupt vehicle traﬃc
Parade as a moving toll station
Ad hoc PKI for application-layer services
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
32 / 38
Hacking ITS
Level 1: Denial of Service
Single-antenna DSRC systems susceptible to collision attack
Level 2: DSRC spectrum sweep, enumerate proprietary (custom)
services available per participant
Level 3: Impersonate an emergency vehicle
Level 4: Become mobile tollbooth
Level 1337: Remotely execute platooning service
Assume direct control
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
33 / 38
Protocol Exploitation
Use design ﬂaws in the VANET to create rapidly propagating e↵ects
Privacy mitigations put in as an afterthought
PKI/trust management doesn’t scale
XML-driven J2735 safety message dictionary
Any RSU deployed is a single point of failure for the region
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
34 / 38
Global Access to V2X
Provides vehicle to streamline testing and development of V2X
Mainline Linux kernel integration ⌘ V2X stack easily applied to UAS,
maritime, heavy truck, communications systems, etc.
V2X now tangible, scalable, accessible: Now it is up to us to ﬁx it!
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
35 / 38
What: V2X in Your Hands
Shape the future development of ITS
Fix/mitigate systemic issues in VANET security
Push toward free as in freedom solutions
Reduce global attack surface through engineering of good standards
Engage and participate in public VANET (hack the planet)
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
36 / 38
Acknowledgments
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
37 / 38
References
Check me out on github: https://github.com/p3n3troot0r/Mainline-80211P
Estimated Beneﬁts of Connected Vehicle Applications – Dynamic Mobility
Applications, AERIS, V2I Safety, and Road Weather Management Applications –
U.S. Department of Transportation, 2015
Vehicle-to-Vehicle Communications: Readiness of V2V Technology for Application
– U.S. Department of Transportation, National Highway Traﬃc Safety
Administration, 2014
William Whyte, Jonathan Petit, Virendra Kumar, John Moring and Richard Roy,
”Threat and Countermeasures Analysis for WAVE Service Advertisement,” IEEE
18th International Conference on Intelligent Transportation Systems, 2015
E. Donato, E. Madeira and L. Villas, ”Impact of desynchronization problem in
1609.4/WAVE multi-channel operation,” 2015 7th International Conference on
New Technologies, Mobility and Security (NTMS), Paris, 2015, pp. 1-5.
p3n3troot0r, ginsback
DEFCON V2X
July 29, 2017
38 / 38