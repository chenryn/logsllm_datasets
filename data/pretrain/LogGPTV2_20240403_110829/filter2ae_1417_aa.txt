**作者：FA1C0N@RPO-Official  
相关阅读：[《ATT&CK 初探--侦察阶段》](https://paper.seebug.org/1583/ "《ATT&CK 初探--侦察阶段》")**
# 介绍
RPO是一个信息安全爱好者成立的小组，我们致力于找到有趣且好玩，充满挑战性的东西。
## 前言
ATT&CK（Adversarial Tactics, Techniques, and Common Knowledge
）是一个攻击行为知识库和模型，主要应用于评估攻防能力覆盖、APT情报分析、威胁狩猎及攻击模拟等领域。从2013年MITRE首次提出这个概念，2015年ATT&CK框架正式发布。在2016年到2020年的一份Excel电子表格发展到如今的社区知识集合。简单的说ATT&CK就是一张表，红蓝双方按照表中的区块对企业设施展开对抗，从而发现安全的薄弱点。我们未来会不断更新整个框架的技术细节和利用/防御方式。
## 正篇
### 资源开发利用阶段（Resource Development）
攻击者在试图建立可以用来支持他们进行下一步行动的资源（基础）。资源开发包括攻击者创建、购买或破坏/窃取可用于渗透目标的资源的技术。此类资源包括基础设施、帐户或功能。攻击者可以利用这些资源在整个攻击周期的其他阶段提供帮助。
由于整个资源开发阶段的实施都与攻击者自己部署的服务有关，所以防守方很难在相关的环节采取措施阻止和预防攻击。因此我们只会在有有效缓解措施的攻击方式下介绍缓解措施。
#### 一 获取基础设施 （Acquire Infrastructure）
攻击者在渗透目标期间可以购买或租用可使用的基础设施。基础架构解决方案包括物理或云服务器、域和第三方 Web 服务。此外，僵尸网络也可供出租或购买。
##### 域（Domains）
攻击者会购买可在定位期间使用的域。域名可以指向一个或多个 IP
地址。攻击者可以购买或者在某些情况下免费获得。攻击者可以将购买的域用于各种目的，包括网络钓鱼、入侵和命令与控制（C2）。攻击者可以选择与合法域相似的域，包括通过使用相近的字母和数字变换，相同含义的不同表述或使用不同的顶级域
(一级域名，例：com，xyz，org等)。
[误植域名攻击](https://baike.baidu.com/item/%E8%AF%AF%E6%A4%8D%E5%9F%9F%E5%90%8D/22748905?fr=aladdin)（URL劫持）可用于借助[Drive-by
Compromise](https://blog.csdn.net/sojrs_sec/article/details/105634010)（例如某些XSS平台：beef-xss）的方式交付有效载荷。
**使用方式**
攻击者还可以使用国际化域名 (IDN，某国语言+顶级域名的形式) 来创建视觉上相似的域以用于操作。
每个域名注册商都维护一个可公开查看的数据库，该数据库显示每个注册域名的相关信息。但是攻击者可能会使用域名隐私保护功能来掩盖相关信息。攻击者还可能会通过使用不同的注册信息和向不同的域注册商购买域来进一步阻断跟踪其基础设施的工作。
**防守方缓解措施**
相关企业可以有意注册与自己相似的域并且时刻关注域名的状态，以阻止攻击者创建相近域名或域名抢注。
##### DNS服务器（DNS Server）
攻击者可以设置自己的DNS服务器。在入侵成功之后的活动期间，攻击者可能会将 DNS
流量用于各种任务来降低被受害方发现的概率（DNS隧道），包括命令与控制（C2）。
攻击者可以选择配置和运行自己的 DNS 服务器来支持操作，而不是劫持现有的 DNS 服务器。使用自己的DNS服务器难度会低得多。
通过运行自己的 DNS 服务器，攻击者可以更好地控制他们管理C2流量。通过对 DNS 服务器的控制，攻击者可以配置 DNS
应用程序以提供对恶意软件的条件响应，并且通常在基于 DNS 的 C2 通道结构方面具有更大的灵活性。
**使用方式**
现在有很多现成的工具可以用来搭建DNS隧道，例如[dnscat2](https://github.com/iagox86/dnscat2)等。
##### 虚拟专用服务器（Virtual Private Server）
攻击者可以租用可在渗透目标期间使用的虚拟专用服务器
(VPS)。目前有多家云服务提供商将虚拟机/容器作为服务进行销售。使用云基础设施可以让攻击者更轻松地配置、修改、移动甚至销毁他们的基础设施。
获取 VPS 也可用于攻击的后期阶段，例如命令与控制（C2）。攻击者还可以从 VPS 服务提供商那里获取基础设施，这些服务提供商以极少的注册信息租用 VPS
而闻名，从而允许更多地匿名获取基础设施。
常见的VPS服务提供商有搬瓦工，AWS，vultr等。
##### 服务器（Server）
攻击者在渗透目标期间可以购买、租用可使用的物理服务器。与VPS不同，攻击者可以选择配置和运行自己的物理服务器来执行攻击，这使得搭建相关基础设施时具有更高的自定义空间。高配置的物理服务器往往能表现出比VPS更好的性能。但相对而言，物理服务器的配置和移动没有VPS轻松。
##### 僵尸网络（Botnet）
攻击者可以购买、租用可在渗透目标期间使用的已被侵入可被控制的网络。僵尸网络是受感染系统的网络，可以指示其执行协调任务。借助僵尸网络，攻击者可能会执行后续活动，例如钓鱼或DDOS。
一些僵尸网络掌握者往往通过出让僵尸网络的资源来获取收益（挖矿，DDOS等）。
##### WEB服务（Web Services）
攻击者可能会注册可使用的 Web 服务。存在多种流行网站供攻击者注册基于 Web
的服务，这些服务可能会在攻击者渗透周期的后期阶段被滥用，例如在命令与控制（C2）或通过web服务渗透。
**使用方式**
利用社交工具的动态信息、个性签名等来向已被控制的受害者机器发号施令。
**相关工具**
[twittor](https://github.com/PaulSec/twittor)：利用twitter做C2的工具
[gcat](https://github.com/byt3bl33d3r/gcat)：一个隐秘的基于 Python 的后门，使用 Gmail
作为命令和控制服务器
[gdog](https://github.com/maldevel/gdog)：一个隐秘的基于 Python 的 Windows 后门，使用 Gmail
作为命令和控制服务器
#### 二 盗取账户 （Compromise Accounts）
攻击者可能会盗取帐户。对于包含社会工程的操作，在线角色的利用会很重要。攻击者可能会破坏，入侵现有帐户，而不是创建帐户。如果潜在受害者与被入侵账户的角色有一定的关系，则利用该角色可能会在潜在受害者群体中产生一定程度的信任（更有利于社工的展开）。
存在多种方法来盗取帐户，例如通过网络钓鱼收集凭据、从第三方站点购买凭据或通过暴力破解凭据（重用密码）。在入侵，盗取帐户之前，攻击者可能会进行侦察，以确定要入侵哪些帐户来执行进一步操作的决策。
##### 社交媒体账户（Social Media Accounts）
角色可能存在于单个站点或跨多个站点（例如：Facebook、LinkedIn、Twitter、Google
等）。被盗取的账户信息可能需要一定的修改，这可能包括填写或修改个人资料信息、进一步开发社交网络。
##### Email账户（Email Accounts）
攻击者可能会直接利用被盗用的电子邮件帐户进行社工攻击（网络钓鱼等）。
#### 三 攻陷基础设施（Compromise Infrastructure）
与获取基础设施不同，直接攻陷基础设施并作为自己的资源进行下一步操作可以隐藏攻击者的行踪（避免直接接触，除非溯源者可以攻陷跳板），也会节省很多成本。但被攻陷的基础设施建设起来也相当费力（如果不想被溯源者攻陷）
##### 域（Domains）
攻击者会在攻击目标期间劫持目标的域或者子域。域名劫持注册是未经原始注册人许可便更改域名注册，攻击者通过获取域所有者邮箱账号，进而发送忘记密码的邮件给域名注册商，从而更改域注册。攻击者还可以借助社会工程学域名，续订过期域名的方式实现攻击。比如因名称空间冲突造成的困扰，微软以高价买下了魔鬼域名corp.com。还存在一些比如[恶意抢注别的公司到期的域名](https://www.donews.com/news/detail/4/3037654.html)，然后高价卖回去的操作。
当组织有指向不存在或取消分配资源的 DNS 条目时，可能会发生子域名接管。在这种情况下攻击者可以控制子域进行操作，而该域名相关联的信托也受益。
##### DNS服务器（DNS Server）
攻击者会通过攻击第三方DNS服务器，在 post-compromise期间，攻击者会利用DNS协议作为C2协议等其他利用方式。
通过攻击DNS服务器，攻击者可以更改DNS记录这种攻击可以导致流量的重定向，攻击者可以从中收集信息和凭证。攻击者也可以将DNS解析到恶意服务器，而不是实际指向的位置。
**使用方式**
DNS污染和DNS劫持
##### 虚拟专用服务器（Virtual Private Server）
攻击者可能会随机/针对性的对VPS服务器进行攻击，获取权限后将其作为基础设施，从而隐蔽自己的攻击IP，从而逃避防守方的溯源。
##### 服务器（Server）
与上文中`虚拟专用服务器`的操作相似，故略过
##### 僵尸网络（Botnet）
攻击者会破坏很多第三方系统，形成一个僵尸网络。僵尸网络是一个受破坏的网络系统，可以执行调度任务，比如16年的Mirai网络。攻击者也可能对现有的僵尸网络进行接管，例如将机器重定向到C2服务器上。除了这些，攻击者还可以利用僵尸网络实现大规模网络钓鱼或DDOS攻击。
##### WEB服务（Web Services）
与上文中`WEB服务`的操作相似，故略过。
#### 四 开发能力（Develop Capabilities）
攻击者需要具备自行开发工具的能力，而不是购买、下载甚至窃取。这是识别开发要求和构建解决方案（例如恶意软件、漏洞和自签名证书）的过程。攻击者可能会依赖自己的开发能力在接下来的步骤中发挥一定的作用。
开发能力可能需要不同的技能组合。所需的技能可能位于内部，也可能需要外包。
##### 恶意软件（Malware）
构建恶意软件可能包括开发负载、装载器（droppers）、后渗透工具、后门、免杀工具（packers）、C2
协议以及创建受感染的可移动媒体。攻击者可能会开发恶意软件来支持他们的操作，从而创建一种方法来持久化控制、绕过防御和后渗透的行为。
##### 代码签名证书（Code Signing Certificates）
代码签名证书往往是具有迷惑性的东西。攻击者可能会创建自签名代码签名证书使被签名的软件具有一定的迷惑作用。代码签名是对可执行文件和脚本进行数字签名以确认软件作者并保证代码未被更改或损坏的过程。代码签名为开发人员的程序提供了一定程度的真实性，并保证程序未被篡改。用户或安全工具相对于未签名的代码会更信任签名的代码，即使他们不知道证书的颁发者或作者是谁。
在代码签名之前，攻击者可能会开发自签名证书以用于操作。
##### 数字证书（Digital Certificates）
攻击者可以创建自签名/证书机构签发的SSL/TLS证书。如果攻击者窃取到受害者证书的密钥，那么他们可以知道用该密钥进行沟通的对话内容。攻击者也可以用证书加密C2流量。