9.5Windows操作系统的特征
备驱动。大家购买的新的硬件设备中，通常都会附带着软盘或CD
ROM，里面通常都收录着该硬件的设备驱动。
有时DLL文件也会同设备驱动文件一起安装。这些DLL文件中存
储着用来利用该新追加硬件的API（函数集）。通过API，可以制作出
运用该新硬件的应用。
可以任意追加设备驱动和API的机制使Windows操作系统变得非
常灵活。这里所说的灵活，是指可以事后再对新追加的硬件进行处理。
本章中，为了明确区分应用和操作系统，在解说的过程中，当遇
到想用“这个程序…”来表达的地方时，我们特意使用了“这个应
用”。这是因为、程序是操作系统、中间件、应用等所有软件的统
称。因此，通常程序员制作的应该都是应用，而不是操作系统。不过，
既然是应用，那么就肯定会通过某种形式来利用操作系统的功能。程
序员一定要注意到这一点。例如，如果应用没有正常运行的话，那么
很有可能就不是硬件的问题，而是操作系统的使用方法出现了偏差。
面中间件和设备驱动，大家也可以把它们看作是操作系统的一部分。
在本书的解说中，到目前为止，“本地代码”这个术语已经出现过
很多次。假如能用本地代码直接编写程序的话，那么程序的运行机制
想必也就一目了然了。不过，能够直接用本地代码编写程序的人，实
际上并不多见。大家的普遍做法都是使用汇编语言来代替本地代码。
在接下来的下一章，我们将通过用汇编语言编写程序，来看一下程序
的实际运行机制。
---
## Page 184
CoLUMN
如果是你，
你会怎样介绍？
向超喜欢手机的女高中生讲解
操作系统的作用
笔者：你有手机吗？
擅长的领域了。
女高中生：有啊。
笔者：呵呵，这不是挺好的吗。计
笔者：什么机型啊？
算机是运行程序的设备，这个你
女高中生：Docomo的最新版。
是知道的吧？
笔者：是吗，真不错啊！那么，你
女高中生：知道啊。我用过计算机。
都用手机做什么呢？
笔者：虽然手机不是手提电脑，但
女高中生：当然是跟好朋友通电话
它里面也是有程序的。正是因为
了啊。有时候也会发邮件、查查
有了这些程序，手机才可以连网。
音乐会信息等。
显示文字和图片等也都是通过程
笔者：这样啊。不过，手机也是电
序来实现的。
话对吧。为什么这个电话能发邮
女高中生：这个当然啊，这个话题
件、查看音乐会信息呢？你知道
真没意思。
原因吗？也就是说电话是如何连
笔者：（不妙.换个话题看看）
接互联网的呢？
对了，用过iApp 吗？
女高中生：因为是电话，所以能连
女高中生：用过！用过！通过它就
接互联网啊！
可以在手机中玩游戏了。
笔者：这么说也没错，但最近的手
笔者：（有戏有戏，那就从这里进
机并不是单纯的电话，更像是具
入主题吧）iApp的i以及iMode
有电话功能的计算机。因此，可
的i，都是 Intemet 的i.App 指的
以把手机看作是便携式计算机
是Application，就是应用。
女高中生：感党话题要转到大叔您
女高中生：应用是什么啊？
---
## Page 185
笔者：问得好。我们总是笼统地说
程序，其实程序可以根据功能的
不同分为操作系统和应用。
女高中生：操作系统和应用？
笔者：iApp中有各种游戏对吧。一
个醇戏程序是不是需要具备制定游
戏规则的功能、使手机按键反应的
功能、显示文字和图片的功能呢？
戏的时候，只用下载游戏程序也
女高中生：？？？
就是应用并安装到手机上就可以
笔者：游戏种类不同的话。当然游
了。游戏结束后，应用就消失了。
戏的规则也会不同，不过按键的响
不过操作系统是不会消失的。
应功能及显示文字和图片的功能在
女高中生：额，有点明白，又有点
任何游戏中都是相同的，没错吧？
不明白.
女高中生：我怎么感觉不太一样
笔者：那么，以计算机为例再来说
呢…..
明一下。在计算机中，程序同样
笔者：对编写程字的来人说，是一样
分为操作系统和应用。Windows
的！明明是同样的功能。可是如果
知道吧。Windows就是操作系统。
每开发一个游戏都要生成一遍，就很
后面安装上的文字处理软件及游
浪费时间对吧。因此我们就可以把
戏等就是应用。
所有游戏共同的功能集合起来做成
女高中生：Windows 中也自带纸牌
一个独立的程序，这个程序就称为
游戏啊。
操作系统。而像游戏的规则这种各
笔者：那个是Windows的附件中自
游戏独有的程序，就是应用。
带的应用，并不是操作系统本身。
女高中生：程序就这样分成了两种
女高中生：嗯
类型了？
笔者：怎么样，都明白了吗？
笔者：对，正是如此！手机中都会
女高中生：差不多吧。
提前安装上操作系统。想要玩游
更多资料请关注裁的新浪体客
---
## Page 187
10
第
章
通过汇编语言了解
程序的实际构成
热身向答
阅读正文前，让我们先回答下面的问题来热热身吧。
1.本地代码的指令中，表示其功能的英语缩写称为什么？
2.汇编语言的源代码转换成本地代码的方式称为什么？
3.本地代码转换成汇编语言的源代码的方式称为什么？
4.汇编语言的源文件的扩展名，通常是什么格式？
5.汇编语言程序中的段定义指的是什么？
6.汇编语言的跳转指令，是在何种情况下使用的？
---
## Page 188
第10章通过汇编诉言了解程序的实际构成
怎么样？是不是发现有一些问题无法简单地解释清楚呢？下面
是笔者的答案和解析，供大家参考。
1.助记符
2.汇编
3.反汇编
4..asm
5.构成程序的命令和数据的集合组
6.将程序流程跳转到其他地址时需要用到该指令
1.汇编语言是通过利用助记符来记述程序的。
2.使用汇编器这个工具来进行汇编。
3.通过反汇编，得到人们可以理解的代码。
4.asm是assembler（汇编器）的略写。
5.在高级编程语言的源代码中，即使指令和数据在编写时是分散
的，编译后也会在段定义中集合汇总起来。大家看过汇编语言
的源代码后，就会清楚了。
6.在汇编语言中，通过跳转指令，可以实现循环和条件分支。
---
## Page 189
10.1汇编语首和本地代码是一对应的
本章
重点
笔者在学生时代曾写过比较C语言源代码和汇编
语言源代码的报告。这个报告的研究方法是，把C语
言的各种语法变换成汇编语言，然后对这些内容进行调查。通过研究，
笔者对程序的运行机制有了深刻的了解。
希望各位读者看完本章内容也能有同样的收获。在本章的前半部
分，我们会对CPU解释运行的本地代码和汇编语言的一对一关系、汇
编语言的源代码中包含的用来指示汇编器的伪命令、栈的push/pop以
及调用函数的机制进行说明。
在本章的后半部分，会向大家介绍一下局部变量和全局变量的不同、
循环等流程控制的实现方式等。在研究对象方面，我们选取了Pentium
等x86系列CPU用的汇编语言，编程工具则依然使用前面章节中用到
的BorlandC++。本章的内容相比其他章节多了不少，请大家耐心地阅
读下去。
10.1汇编语言和本地代码是一一对应的
接下来就让我们进入到本章的前半部分。在前面章节中已经多次
提到，计算机CPU能直接解释运行的只有本地代码（机器语言）程序。
用C语言等编写的源代码，需要通过各自的编译器编译后，转换成本
地代码。
通过调查本地代码的内容，可以了解程序最终是以何种形式来运
行的。但是，如果直接打开本地代码来看的话，只能看到数值的罗列。
如果直接使用这些数值来编写程序的话，还真是不太容易理解。因而
就产生了这样一种想法，那就是在各本地代码中，附带上表示其功能
---
## Page 190
第10章通过汇编语言了解程序的实际构成
的英语单词缩写。例如，在加法运算的本地代码中加上add（addition
的缩写）、在比较运算的本地代码中加上cmp（compare的缩写）等。这
些缩写称为助记符，使用助记符的编程语言称为汇编语言。这样，通
过查看汇编语言编写的源代码，就可以了解程序的本质了。因为这和
查看本地代码的源代码，是同一级别的。
不过，即使是用汇编语言编写的源代码，最终也必须要转换成本
地代码才能运行。负责转换工作的程序称为汇编器，转换这一处理本
身称为汇编。在将源代码转换成本地代码这个功能方面，汇编器和编
译器是同样的。
用汇编语言编写的源代码，和本地代码是一一对应的。因而，本
地代码也可以反过来转换成汇编语言的源代码。持有该功能的逆变换
程序称为反汇编程序，逆变换这一处理本身称为反汇编（图10-1）。
汇编语言的源代码
本地代码
AON
dord ptr [ebp-4],7Bh
C7 45 FC 7B 0000 00
mov
dword ptr [ebp-8],1cah
汇编
C7 45 F8 C8 01 00 00
nov
add
[-da]xd pop
eax,dword ptr [ebp-4]
8B45 FC
0345 F8
edg
sub
eax,edx
反汇编
2BC2
99
sar
eax.1
D1 F8
mov
dword ptr [ebp-0ch],eax
8945 F4
图10-1汇编语言的源代码和本地代码是一一对应的
哪怕是用C语言编写的源代码，编译后也会转换成特定CPU用的
本地代码。面将其反汇编的话，就可以得到汇编语言的源代码，并对
其内容进行调查。不过，本地代码变换成C语言源代码的反编译，则
要比反汇编困难。这是因为，C语言的源代码同本地代码不是一一对应
---
## Page 191
10.2通过编译鑫瑜出汇编请言的源代码
的，因此完全还原到原始的源代码是不太可能的
10.2通过编译器输出汇编语言的源代码
除了将本地代码进行反汇编这一方法外，通过其他方式也可以获
取汇编语言的源代码。大部分C语言编译器，都可以把利用C语言编
写的源代码转换成汇编语言的源代码，而不是本地代码。利用该功能，
就可以对C语言的源代码和汇编语言的源代码进行比较研究。笔者在
学生时代的报告中，使用的便是该功能。BorlandC++中，通过在编译
器的选项中指定“-S”，就可以生成汇编语言的源代码了。大家也可以
实际尝试一下。
用Windows的记事本等文本编辑器编写如代码清单10-1所示的C
语言源代码，并将其命名为Sample4.c进行保存。C语言源文件的扩展
名，通常用“e”来表示。该程序是由返回参数的两个整数值之和的
AddNum函数和调用AddNum函数的MyFunc函数构成的。因为没有
包含程序运行起始位置的main函数部分，这种情况下直接编译是无法
运行的。大家只需把它看成是学习汇编语言的一个示例即可。
代码清单10-1由两个函数构成的C语言的源代码
7/返回两个参数值之和的函数
int Addum(int a, Int b)
为“反向工程”。市场上销售的款件程序等，有时会在其使用说明书中明确