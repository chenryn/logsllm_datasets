workloadmixturedeterminedinthelastworkloadmappingstage.
sinceitslightlyoutperformsthefourknobsetting.Itsperformance
Bothtuningtoolsusetheincrementalknobapproachtodecidehow
continues to improve after 400 min as it expands the number of
manyknobstotuneduringeachobservationperiod(seeSect.5.3).
knobsthatitexamines. Thisisbecausetheincrementalapproach
ThedifferenceisthatiTunedstartsusingthisapproachonlyafterit
allowsOtterTunetoexploreandoptimizetheconfigurationspace
hasfinishedrunningitsinitialsetofexperiments.
for a small set of the most impactful knobs before expanding its
scopetoconsidertheothers. TPC-C: The results in Fig. 6 show that both OtterTune and
iTunedfindconfigurationsearlyinthetuningsessionthatimprove
Vector:AsshowninFig.5c,OtterTuneachievesthebesttuning
performance over the default configuration. There are, however,
performancewiththeeight,16,andtheincrementalknobsettings.
two key differences. First, OtterTune finds this better configura-
IncontrasttoMySQLandPostgres, tuningonlyfourknobsdoes
tionwithinthefirst30minforMySQLand45minforPostgres,
notprovidethebesttuningperformance. Thisisbecausesomeof
whereasiTunedtakes60–120mintogenerateconfigurationsthat
Vector’smoreimpactfulknobsarepresentintheeightknobsetting
provide any major improvement for these systems. The second
butnotinthefourknobone. Thetopfourknobstunethelevelof
observationisthatOtterTunegeneratesabetterconfigurationthan
parallelismforqueryexecution,thebufferpool’ssizeandprefetch-
iTunedforthisworkload.InthecaseofMySQL,Fig.6ashowsthat
ingoptions,andtheSIMDcapabilitiesoftheDBMS.Thereisone
OtterTune’s best configuration achieves 85% lower latency than
knobthatreplacesVector’sstandardLRUbufferreplacementalgo-
iTuned. WithPostgres, itis75%lower. Bothapproacheschoose
rithmwithapolicythatleveragesthepredictabilityofdiskpageac-
similarvaluesforsomeindividualknobs, butiTunedisunableto
cesspatternsduringlong-runningscans.Thisknobcanincurover-
findtheproperbalanceformultipleknobsthatOtterTunedoes.Ot-
headduetocontentionwaitingformutexes. Sincetheeightknob
terTunedoesabetterjobatbalancingtheseknobsbecauseitsGP
settingalwaysdisablesthisknob,itislikelytheonethatprevents
modelshaveabetterunderstandingoftheconfigurationspacesince
thefourknobsettingfromachievingcomparableperformance.
theyweretrainedwithmoredata.
1017
iTuned OtterTune
600 500 4800 4700 )sm(emitnurlatoT )sm(emitnurlatoT
)sm(elit-%ht99 )sm(elit-%ht99
500 400 4700 4600
4500
400 4600
300
4400
300 4500
200
0 50 100 150 200 250 300 0 50 100 150 200 250 300 0 50 100 150 200 250 300 0 50 100 150 200 250 300
Tuningtime(minutes) Tuningtime(minutes) Tuningtime(minutes) Tuningtime(minutes)
(a)MySQL (b)Postgres (a)Vector(TPC-H#1) (b)Vector(TPC-H#2)
Figure 6: Tuning Evaluation (TPC-C) – A comparison of the OLTP Figure8: TuningEvaluation(TPC-H)–Performancemeasurementsfor
DBMSsfortheTPC-Cworkloadwhenusingconfigurationsgeneratedby Vectorrunningtwosub-setsoftheTPC-Hworkloadusingconfigurations
OtterTuneandiTuned. generatedbyOtterTuneandiTuned.
500 400 600 )sm(elit-%ht99 )sm(elit-%ht99 )ces(emitnoitucexE
Workloadexecution
400 300
400 Prep&reloadconfig
300 200 Workloadmapping
200 Configgeneration
200 100
0 50 100 150 200 250 300 0 50 100 150 200 250 300
0
Tuningtime(minutes) Tuningtime(minutes) MySQL Postgres Vector
(a)MySQL (b)Postgres
Figure9:ExecutionTimeBreakdown–Theaverageamountoftimethat
Figure7: TuningEvaluation(Wikipedia)–AcomparisonoftheOLTP
OtterTunespendsinthepartsofthesystemduringanobservationperiod.
DBMSsfortheWikipediaworkloadwhenusingconfigurationsgenerated
byOtterTuneandiTuned. load for the current target from its repository. This corre-
spondstoStep#1fromSect.6.1.
Wikipedia: We next compare the two tuning approaches on
MySQLandPostgresusingamorecomplexworkload. Likewith • Config Generation: The time that OtterTune’s tuning man-
TPC-C,theresultsinFig.7showthatOtterTunehasthesamere- ager takes to compute the next configuration for the target
duction in the transaction latency over the default configuration DBMS.ThisincludesthegradientdescentsearchandtheGP
withinthefirst15minoftheWikipediabenchmark. Postgreshas modelcomputation.ThisisStep#2fromSect.6.2.
thesimilargradualreductioninthelatencyovera100minperiod. TheresultsinFig.9showthebreakdownoftheaveragetimes
WefoundthatagainiTunedfailedtogenerateagoodconfiguration thatOtterTunespendsduringatuningsession. Theworkloadex-
forthemostimportantknobsatthebeginningofitstuningsession ecution time is the largest portion of OtterTune’s total time for
becauseithadtopopulateitsinitializationset. Intotal,OtterTune MySQLandPostgres.ThisisexpectedsincebothoftheseDBMSs
isabletoachievelowerlatencyforbothDBMSs. execute the target workload for the 5 min observation period. In
TPC-H:Inthislastexperiment,wecomparetheperformanceof contrast,VectorexecutesasequenceofTPC-Hqueriesthattakean
theconfigurationsgeneratedbythetwotuningtoolsfortwoTPC-H averageof5sectofinish. TheseresultsshowthatittakesOtter-
workloadmixturesrunningonVector. Fig.8showthatonceagain Tune’scontroller62sectorestartMySQLforeachnewconfigu-
OtterTuneproducesbetterconfigurationsthaniTuned,butthatthe ration,whereasPostgresandVectortakeanaverageof3minand
difference is less pronounced than in the OLTP workloads. The 6.5mintorestart,respectively. Postgres’longerpreparationtime
reasonisthatVectorislesspermissiveonwhatvaluesthetuning is a result of running the vacuum command between observation
tools are allowed to set for its knobs. For example, it only lets periodstoreclaimanystoragethatisoccupiedbyexpiredtuples.
theDBAsetreasonablevaluesforitsbufferpoolsize,otherwiseit ForVector,thepreparationtimeislongerbecausealldatamustbe
willreportanerrorandrefusetostart. Comparethistotheother unloadedandthenreloadedintomemoryeachtimetheDBMSis
DBMSsthatweevaluatewheretheDBAcansetthesekeyknobs restarted. AllthreeDBMSstakebetween30–40secand5–15sec
toalmostanything. Thus,tuningVectorisasimpleroptimization tofinishtheworkloadmappingandconfigurationrecommendation
task than tuning MySQL or Postgres since the space of possible steps,respectively.Thisisbecausethereisapproximatelythesame
configurationsissmaller. amountofdataavailableinOtterTune’srepositoryforeachofthe
workloadsthatareusedtotrainthemodelsinthesesteps.
7.5 ExecutionTimeBreakdown
7.6 EfficacyComparison
TobetterunderstandwhathappenstoOtterTunewhencomput-
ing a new configuration at the end of an observation period, we Inourlastexperiment,wecomparetheperformanceofMySQL
instrumenteditstuningmanagertorecordtheamountoftimethat andPostgreswhenusingthebestconfigurationselectedbyOtter-
itspendsinthedifferentpartsofitstuningalgorithmfromSect.6. TuneversusonesselectedbyhumanDBAsandopen-sourcetuning
WeusedTPC-CforMySQLandPostgres,andTPC-HforVector. advisortools.14 WealsocompareOtterTune’sconfigurationswith
Thefourcategoriesoftheexecutiontimeareasfollows: those created by a cloud database-as-a-service (DBaaS) provider
thatarecustomizedforMySQLandPostgresrunningonthesame
• WorkloadExecution:ThetimethatittakesfortheDBMSto
EC2instancetypeastherestoftheexperiments. Weprovidethe
executetheworkloadinordertocollectnewmetricdata.
configurationsfortheseexperimentsinAppendixB.
• Prep&ReloadConfig: ThetimethatOtterTune’scontroller EachDBAwasprovidedwiththesameEC2setupusedinallof
takestoinstallthenextconfigurationandpreparetheDBMS ourexperiments.Theywereallowedtotuneanyknobstheywanted
forthenextobservationperiod(e.g.,restartingifnecessary). butwerenotallowedtomodifythingsexternaltotheDBMS(e.g.,
• Workload Mapping: The time that it takes for OtterTune’s
dynamicmappingschemetoidentifythemostsimilarwork- 14 WewereunabletoobtainasimilartuningtoolforVectorinthisexperiment.
1018
OSkernelparameters). Ontheclientinstance,weprovidedthem DBAandOtterTunechosesimilarsizesforthebufferpoolandlog
with a script to execute the workload for the 5 min observation file. The DBA modified other settings, like disabling MySQL’s
periodandagenerallogfullofpreviouslyexecutedqueriesforthat monitoringtools,buttheyalsomodifiedknobsthataffectwhether
workload. TheDBAswerepermittedtorestarttheDBMSand/or MySQL ensures that all transactions are fully durable at commit
theworkloadasmanytimesastheywanted. time.AsdiscussedinSect.3.2,OtterTuneisforbiddenfromtuning
For the DBaaS, we use the configurations generated for Ama- suchknobs.
zon RDS. We use the same instance type and DBMS version as
Postgres: ForthenextDBMS,ourhumanexpertwasthelead
theotherdeploymentsintheseexperiments. Weinitiallyexecuted
DBAforamid-westernjudicialcourtsystemintheUnitedStates.
the workloads on the RDS-managed DBMSs, but found that this
They have over six years of experience and have tuned over 100
didnotprovideafaircomparisonbecauseAmazondoesnotallow
complexproductiondatabasedeployments. Theycompletedtheir
youtodisablethereplicationsettings(whichcausesworseperfor-
tuningtaskin20minandmodifiedatotalof14knobs.
mance). Toovercomethis,weextractedtheDBMSconfigurations ThePostgrestuningtool(PGTune[4])islesssophisticatedthan
fromtheRDSinstancesandevaluatedthemonthesameEC2setup
theMySQLoneinthatitonlyusespre-programmedrulesthatgen-
as our other experiments. We disable the knobs that control the
erateknobconfigurationsforthetargethardwareanddoesnotcon-
replicationsettingstobeconsistentwithourotherexperiments.
sidertheDBMS’smetrics.Wefound,however,thatusingthePost-
MySQL:OurfirstDBAisthepremiereMySQLtuningandop- grestuningtoolwaseasierbecauseitwasbasedontheamountof
timizationexpertfromLithuaniawithover15yearsofexperience RAM available in the system and some high-level characteristics
andalsoworksatawell-knownInternetcompany. Theyfinished aboutthetargetworkload(e.g.,OLTPvs. OLAP).Ittook30sec-
tuninginunder20minandmodifiedatotalofeightknobs. ondstogeneratetheconfigurationandweneverhadtorestartthe
The MySQL tuning tool (MySQLTuner [2]) examines the same DBMS.Itchangedatotalofeightknobs.
kindofDBMSmetricsthatOtterTunecollectsandusesstaticheuris- ThelatencymeasurementsinFig.11bshowthattheconfigura-
tics to recommend knob configurations. It uses an iterative ap- tionsgeneratedbyOtterTune,thetuningtool,theDBA,andRDS
proach: we execute the workload and then run the tuning script. all achieve similar improvements for TPC-C over Postgres’ de-
Thescriptemitssuggestionsinsteadofexactsettings(e.g.,setthe fault settings. This is likely because of the overhead of network
buffer pool size to be at least 2 GB). Thus, we set each knob to round-tripsbetweentheOLTP-BenchclientandtheDBMS.Butthe
its recommended lower bound in the configuration file, restarted throughputmeasurementsinFig.11showthatPostgreshas∼12%
theDBMS,andthenre-executedtheworkload. Werepeatedthis higherperformancewithOtterTunecomparedtotheDBAandthe
untilthescriptstoppedrecommendingsettingstofurtherimprove tuningscript,and∼32%higherperformancecomparedtoRDS.
theconfiguration. Thisprocesstook45min(i.e.,eightiterations) Unlike our MySQL experiments, there is considerable overlap
beforeitranoutofsuggestions,andmodifiedfiveknobs. betweenthetuningmethodsintermsofwhichknobstheyselected
Fig.10showsthatMySQLachievesapproximately35%better and the settings that they chose for them. All of the configura-
throughputand60%betterlatencywhenusingthebestconfigura- tions tune the three knobs that OtterTune finds to have the most
tiongeneratedbyOtterTuneversustheonegeneratedbythetun- impact. Thefirstoftheseknobstunesthesizeofthebufferpool.
ingscriptforTPC-C.Weseethatthetuningscript’sconfiguration Allconfigurationssetthevalueofthisknobtobebetween2–8GB.
providestheworstperformanceofallofthe(non-default)config- Thesecondknobprovidesa“hint”totheoptimizeraboutthetotal
urations. Thereasonisthatthetuningscriptonlymodifiesoneof amount of memory available in the OS and Postgres’ buffers but
thefourmostimpactfulknobs,namely,thesizeofthebufferpool. doesnotactuallyallocateanymemory. TheDBAandRDSselect
Theotherknobsthatthetuningscriptmodifiesarethenumberof conservativesettingsof10GBand7GBcomparedtothesettings
independentbufferpoolsandthequerycachesettings. Wefound, of 18 GB and 23 GB chosen by OtterTune and the tuning script,
however,thattheseknobsdidnothaveameasurableeffect. These respectively. Thelattertwooverprovisiontheamountofmemory
resultsareconsistentwithourfindingsinSect.7.3thatshowhow available whereas the settings chosen by the DBA and RDS are
mostoftheperformanceimprovementforMySQLcomesfromtun- moreaccurate.
ingthetopfourknobs. The last knob controls the maximum number of log files writ-
Both the latency and the throughput measurements in Fig. 10 tenbetweencheckpoints. Settingthisknobtoolowtriggersmore
show that MySQL achieves ∼22% better throughput and ∼57% checkpoints,leadingtoahugeperformancebottleneck. Increasing
better latency when using OtterTune’s configuration compared to thevalueofthisknobimprovesI/Operformancebutalsoincreases
RDS. RDS modified three out of the four most impactful knobs: therecoverytimeoftheDBMSafteracrash.TheDBA,thetuning
thesizeofthebufferpool,thesizeofthelogfile,andthemethod script,andAWSsetthisknobtovaluesbetween16and64. Otter-
usedtoflushdatatodisk. Still,weseethattheperformanceofthe Tune, however, sets this knob to be 540, which is not a practical
RDSconfigurationisonlymarginallybetterthanthatofthetuning valuesincerecoverywouldtaketoolong. ThereasonthatOtter-
script. An interesting finding is that RDS actually decreases the Tunechosesuchahighvaluecomparedtotheotherconfigurations
sizeofthelogfile(andotherfiles)tobesmallerthanMySQL’sde- is a result of it using the latency as its optimization metric. This
faultsetting. Weexpectthatthesesettingswerechosentosupport metriccapturesthepositiveimpactthatminimizingthenumberof