Fun with SOHO Router 
101
by Jhe@HITCON-CMT
Who am I ?
● Jhe
● Co-founder of UCCU
● know a little 
○ Web security
○ Binary exploitation
○ Parseltongue (python)
Firmware overview
Reversing engineering
Common vulnerabilities
Real world case
UCCU
What is SOHO Router
Firmware overview
Reversing engineering
Common vulnerabilities
Real world case
UCCU
What is SOHO Router
What is SOHO Router
● Small Office / Home Office
● functions
○ NAT, VPN, Dynamic DNS, 
○ Port forwarding, Firewall, Wireless
○ DHCP, MAC filter,  Remote Mgt.
○ Ad. block
What is SOHO Router
● Small Office / Home Office
● functions
○ NAT, VPN, Dynamic DNS, 
○ Port forwarding, Firewall, Wireless
○ DHCP, MAC filter,  Remote Mgt.
○ Ad. block
Firmware overview
Reversing engineering
Common vulnerabilities
Real world case
UCCU
What is SOHO Router
Firmware overview
Two ways to debug
● Hardware
○ JTAG, Serial / UART console … 
● Software
○ Just download it from official 
website
Firmware overview
Two ways to debug
● Hardware
○ JTAG, Serial / UART console … 
● Software
○ Just download it from official 
website
Firmware overview
● File system
○ SquashFS, JFFS2, cramfs, YAFFS … 
● Architecture
○ MIPS/MIPSEL,ARM,PPC,x86,x86-64 … 
● Bootloader
Firmware overview
Reversing engineering
Common vulnerabilities
Real world case
UCCU
What is SOHO Router
Reversing engineering
● Static analysis
○ firmware extraction
○ reversing binary (IDA Pro … )
○ something hardcode
○ open source code
○ known vulnerabilities
Reversing engineering
● Dynamic analysis
○ firmware extraction
○ run with emulator(QEMU,Gdb,IDA Pro)
○ port scanning
○ Web security testing
Reversing engineering
Prerequisite
● binwalk
○ analysis, reverse engineering, 
extracting
Reversing engineering
Prerequisite
● binwalk
● fmk (firmware mod kit)
○ build firmware,unsquash,uncramfs …
Reversing engineering
Prerequisite
● binwalk
● fmk
● Linux
Reversing engineering
Extraction
Reversing engineering
Extraction
Reversing engineering
Extraction
Reversing engineering
Extraction
Reversing engineering
Extraction
Reversing engineering
Extraction
Some of you 
may have 
this
It is true
But not that 
easy
Example
build emulation environment
● QEMU(arm, mips, mipsel)
● Cross-compilation
Example
repair runtime environment
1. run with QEMU
2. if ERROR_ECCURRED then 
function hijacking with LD_PRELOAD
goto 1
Firmadyne
● System for emulation and dynamic 
analysis of Linux-based firmware
● Toolchain
● Console
● Nvram
● Testing with metasploit framework
Firmware overview
Reversing engineering
Common vulnerabilities 
Real world case
UCCU
What is SOHO Router
Common vulnerabilities
● XSS, CSRF
● Command Injection
● Denial of Service
● Information Disclosure
● Weak / Default Password
Common vulnerabilities
● Broken Authentication
● Buffer overflow
● Backdoor
Common vulnerabilities
● Broken Authentication
● Buffer overflow
● Backdoor
Firmware overview
Reversing engineering
Common vulnerabilities
Real world case
UCCU
What is SOHO Router
Real world case
BR_6430nS_v1.15
● why this one ?
Real world case
BR_6430nS_v1.15
● why this one ?
● short story
Real world case
BR_6430nS_v1.15
● why this one ?
● short story
Real world case
BR_6430nS_v1.15
● why this one ?
● short story
Real world case
BR_6430nS_v1.15
● why this one ?
● short story
Real world case
Real world case
Real world case
Real world case
Real world case
Real world case
Real world case
Real world case
Real world case
Real world case
Real world case
Real world case
Real world case
Real world case
Currently defined functions:
arping, ash, basename, cat, chmod, 
cp, crond, cut, date, echo,ether-wake,
expr, ftpput, grep, halt, head, httpd,
ifconfig, init, ip, ipcalc, kill,
Killall, linuxrc, ln, logread, ls,
mkdir, mknod, mount, pidof, ping,
poweroff, ps, reboot, rm, route,
sh, sleep, syslogd, tail, tr,
udhcpc, udhcpd, umount, wc, wget
Real world case
● For debug == For hacker
Real world case
● For debug == For hacker
● After that ?
Real world case
Shodan
Real world case
Censys
Real world case
Zoomeye
Firmware overview
Reversing engineering
Common vulnerabilities
Real world case
UCCU
What is SOHO Router
UCCU
problems you may encounter
UCCU
problems you may encounter
● different version, different output ?
UCCU
problems you may encounter
● different version, different output ?
● new stuff or old stuff ?
You may have heard about ...
You may have heard about ...
This is just beginning ...
IoT is coming ...
● SOHO Router
IoT is coming ...
● SOHO Router
● Web Cam
IoT is coming ...
● SOHO Router
● Web Cam
● Car
IoT is coming ...
● SOHO Router
● Web Cam
● Car
● anything smart device
IoT is coming ...
● SOHO Router
● Web Cam
● Car
● anything smart device
● anything Internet-connected
Questions ?