f) IPv6路由协议攻击：RIPng/PIM依赖IPsec，OSPFv3协议不提供认证功能，而是使用IPv6的安全机制来保证自身报文的合法性，未配置IPv6安全机制，OSPFv3路由器存在仿冒的安全威胁；  
g) 移动IPv6仿冒伪造攻击：移动IPv6节点能够在不改变IP地址的情况下,在任何地方接入网络都能够直接与其他节点通信，在提供可移动性及方便通信的同时,由于移动节点的不固定性,也给不法分子提供了攻击的机会，存在伪造绑定更新消息等安全威胁；
h) MLD仿冒及泛洪攻击。  
3. IPv6协议报文格式新增安全威胁
IPv6 协议相关RFC标准在不断的发展更新，协议自身也存在漏洞，所有遵循IPv6协议的设备都会受到该漏洞的影响，新增安全威胁如下：  
a)协议自身存在漏洞，如IPv6协议Type0路由头拒绝服务漏洞，该漏洞已于2007年12月由RFC 5095修补，禁用了IPv6扩展头中的Type 0路由头；  
b) IPv6分片攻击   
c) IPv6扩展头攻击  
d) ND DAD攻击（Duplicate Address Detection）  
e) ND Router Advertisement仿冒、DoS、中间人攻击  
4. IPv6自身实现新增安全威胁
IPv6 和IPv4协议一样，设备与应用在实现对IPv6协议的支持时，不同的系统开发商因软件开发能力的不同，在IPv6协议软件开发、各种算法实现也会引入各种可能的安全漏洞。  
从下一代互联网国家工程中心全球IPv6测试中心11月份发布的《2017 IPv6支持度报告》来看：  
目前的操作系统中，75%左右都默认安装IPv6协议栈，65%左右支持DHCPv6，50%左右支持ND RNDSS。其中手机操作系统支持IPv6协议已经从实验室走向了应用阶段，Android 4.2、IOS 4.1、Windows Phone 6.5、Symbian 7.0都已经支持IPv6，并且默认安装IPv6，自以上各手机系统版本后推出的新版本均支持IPv6。在DHCPv6功能上，IOS支持得比较好，从V4.0开始支持stateless DHCPv6，V4.3.1支持Stateful DHCPv6。Windows Phone支持DHCPv6 Lite，Android系统不支持DHCPv6。在邻居发现(ND)选项RDNSS功能上，IOS目前已经支持ND RDNSS，Android 5.0以上已经支持ND RDNSS。若一个操作系统不支持DHCPv6和ND RDNSS，则无法在纯IPv6网络环境中自动配置查询域名服务器。  
各种应用软件也逐渐开始支持IPv6以应对广大用户的需求。但是目前并不普遍，只有一些基础应用软件已经支持IPv6。  
基础应用软件中有一小部分已可以支持IPv6，其中浏览器软件，如IE系列、Chrome、Firefox和Opera等都支持IPv6；下载软件和邮件客户端软件，如FileZilla3、SmartFTP4以及Outlook等都支持IPv6。但是国内自主研发的基础应用软件，除浏览器外，其他诸如下载软件、即时通讯软件等都尚无法在IPv6环境下正常使用。  
各类软件安全实现不当都可能引入IPv6协议安全漏洞，需要做好安全编码及质量保障活动。  
如下为典型的IPv6协议栈实现方面的漏洞。  
1、Python getaddrinfo() remote IPv6 buffer overflow  
2、Apache remote IPv6 buffer overflow  
3、Postfix IPv6 unauthorized mail relay vulnerability  
4、Openbsd remote code execution in IPv6 stack  
……
5. IPv4向IPv6演进过程中新增安全威胁
IPv4向IPv6的过渡是一个长期的过程，在IPv4与IPv6共存时期，为解决两者间互通所采取的各种措施将带来新的安全风险。例如，隧道方式下存在的拒绝服务攻击、中间人攻击，NAT-PT技术下存在的拒绝服务攻击等。  
IPv4向IPv6的演进过程中涉及到双栈、隧道以及翻译技术，主要安全威胁如下：  
a) 双栈技术：许多操作系统都支持双栈，IPv6默认是激活的，但并没有向IPv4一样加强部署IPv6的安全策略，支持自动配置，即使在没有部署IPv6的网络中，这种双栈主机也可能受到IPv6协议攻击。  
b) 隧道技术：几乎所有的隧道机制都没有内置认证、完整性和加密等安全功能，攻击者可以随意截取隧道报文，通过伪造外层和内层地址伪装成合法用户向隧道中注入攻击流量，存在仿冒以及篡改泛洪攻击安全威胁。  
c) 翻译技术：涉及载荷转换，无法实现端到端IPsec，存在受到NAT设备常见的地址池耗尽等DDoS攻击安全威胁。  
## 0x04 互联网IPv6网络安全保障体系及策略探讨
随着基于IPv6的下一代网络中应用的增加、速度的加快和规模的变大，IPv6网络面临着新的安全风险。  
对于互联网网络，安全是保证网络健康发展的重要因素，IPv6网络安全保障体系的配套建设作为IPv6网络建设的重要方面，在IPv6网络设计阶段对网络安全需要进行通盘考虑，提升网络架构的整体安全性。  
网络安全保障体系可分为静态安全防护体系以及动态安全运营体系两个层面。  
静态安全防护体系根据ITU-T X.805标准（端到端通信系统安全框架），网络可分为基础设施层、业务层和应用层，每个网络层次可以划分为管理、控制和数据三个平面。采用多种技术手段隔离管控，并在每个平面实施相应安全防护措施，从而使每个平面在安全方面都具备访问控制、鉴别、不可抵赖、数据保密性、通信安全、完整性、可用性和隐私性8个属性防护能力。  
动态安全运营体系通过安全检测和响应等安全基础设施和相关安全管理组织、制度和流程的配套建设，可实现对网络安全风险的动态发现和管理。  
与IPv4相比，可以共用相同的网络整体安全保障体系，但在IPv4基础网络的前提下需要确定升级演进到IPv6的策略，基于IPv6的特点和安全威胁分析，识别IPv6安全产品缺失的现状并补齐，确定改造节奏，包括LVS、DNS等各类型服务器、网络设备、DDoS设备、防火墙等，升级安全系统，结合业务实际利用好IPv6协议本身的安全增强技术手段，增强IPv6安全防护，同时加强IPv6环境各业务领域特别是新兴领域物联网、云计算、大数据、人工智能等的网络安全技术、管理及机制研究，促进新的安全业务和应用的开展，形成全球领先的下一代互联网技术产业体系。  
## 0x05 IPv6网络安全加固建议
虽然IPv6相对于IPv4来说增强了自身的安全机制，但一个新协议的引入必然会引入新的安全问题，对已有的网络安全技术体系造成影响，因此熟悉已有业务及网络、IPv6现状及其安全性并针对性部署安全加固非常重要。  
针对不同的IPv6网络安全风险，有不同的安全应对技术、措施和方法，需要采取合适自身的IPv6安全解决方案及措施，构筑IPv6网络安全及IPv6环境下新兴领域安全保障能力。  
如下典型的IPv6网络安全加固建议供参考。  
a) 做好IPv6网络各层各面和各安全域的隔离及访问控制，将安全影响控制到最小；  
b) 合理管控IPv6管理、控制和数据平面之间的资源互访，在各平面安全域根据各域的特点辅以相应的安全保护和控制措施，实施双栈的情况建议在IPv4/6双栈设备上采用严格的网络过滤和访问控制，防范IPv4和IPv6安全问题的相互影响；  
c) 做好管理和控制平面IPv6网络接入的认证与鉴权，制定完善的边界防护策略，防止恶意设备及用户的接入，结合业务实际情况有效利用IPv6协议的IPsec特性、源地址过滤技术等加强平面内的安全保护；  
d) 控制平面做好新增ICMPv6协议安全防护，建议根据实际情况选择合适的安全措施，例如配置ACL白名单，仅允许必须的ICMPv6等报文通过，接口关闭ICMPv6重定向、端口停止发送RA消息，关闭发送ICMP不可达信息，关闭源路由防止Type 0 Routing Header攻击等；  
e) 控制平面通过IPsec、认证以及白名单策略等做好IPv6网络路由等协议安全防护；  
f) 管理平面与IPv4网络类似，通过白名单策略、禁用不使用的IPv6服务等，确保攻击面最小；  
g) 数据平面与IPv4网络类似，配置ACL白名单策略，关闭不必要的服务、禁止源路由，部署IPv6 uRPF等；  
h) DNS做好IPv6扫描及嗅探的安全检测及防护；  
i) 建议严格限制IPv6同一片报文的分片数目，设置合理的分片缓冲超时时间；  
j) 建议配置端口的最大ND表项学习数量，限制扩展头的数量和同一类型扩展头实例的数目；  
k) IPv6网络涉及各类服务器、终端、网络设备及应用软件等，设计及开发需要遵从成熟的安全工程方法及规范，确保IPv6协议栈安全质量，同时做好已知漏洞的安全检测及修复；  
l) IPv6协议攻击的实施目前已有很成熟的开源安全工具套件，例如THC-IPv6、Si6 Networks ipv6-toolkit等，IPv6网络及协议上线运行时，需要提前做好网络中各部分IPv6协议栈健壮性测试、安全渗透测试及安全质量评估，及时削减安全风险；  
m) 基于IPv6的特点和安全威胁分析，确定IPv4升级演进到IPv6的策略，识别IPv6安全产品缺失的现状并补齐，确定改造节奏，升级安全系统。  
## 0x06 参考文档:
[1]IPv6的发展和安全性研究  
[2]Atlasis, IPv6 Extension Headers: New Features, and New Attack Vectors, IPv6 Security Summit,  
Troopers 13, Heidelberg, 11-15 March 2013  
[3]RFC 2460: Internet Protocol, Version 6 (IPv6) Specification  
[4]RFC 3756: IPv6 Neighbor Discovery (ND) Trust Models and Threats  
[5]RFC 4291: IP Version 6 Addressing Architecture  
[6]RFC 4443: Internet Control Message Protocol (ICMPv6) for the Internet Protocol Version 6 Specification  
[7]RFC 4941: Privacy Extensions for Stateless Address Autoconfiguration in IPv6  
[8]RFC 4942: IPv6 Transition/Coexistence Security Considerations  
[9]下一代互联网国家工程中心-全球IPv6测试中心-《2017 IPv6支持度报告》