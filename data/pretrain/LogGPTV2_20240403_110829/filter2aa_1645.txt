### 与业务融合的漏洞检测之路

#### 关于我
- **乌云白帽子**：猪猪侠
- **8年信息安全从业经历**
- **信息安全领域爱好者**
- **专业领域**：安全测试、数据挖掘
- **微博**：@ringzero

---

### 漏洞检测示例

#### 示例1：WEB2.0服务端
- **问题**：复杂的用户认证机制导致传统漏洞扫描器无法与业务功能交互。
- **演示视频**：[观看视频](http://v.youku.com/v_show/id_XODc0NjYyODg0.html)

#### 示例2：移动客户端
- **问题**：功能封闭，导致漏洞扫描器无法与业务功能交互。
- **演示视频**：[观看视频](http://v.youku.com/v_show/id_XODc0Njc1MzI0.html)

#### 旁路传感器还原数据分析
- **技术说明**：在使用业务系统时，通过分析数据流量来检测业务流程中的漏洞。

---

### 什么是业务安全？
- **定义**：保护信息在交换过程中的完整性、可用性和保密性。
- **关键点**：
  - **IT基础设施**：操作系统、数据库、应用代码等。
  - **业务数据**：真正需要保护的对象。

---

### 如何查找业务系统的漏洞？

#### 方法概述
- **跟随业务系统内的每一个功能**：智能检测缺陷，但规则过多且错误率高，需要人机互动。
- **代码设计（关系型数据库）**：
  - **增删改查（CRUD）**：
    - 创建（Create）：例如发布一条微博。
    - 删除（Delete）：例如删除一条微博。
    - 更新（Update）：例如修改用户资料。
    - 读取（Retrieve）：例如查看好友们最新发布的微博。

#### 具体案例
- **案例1**：有排序的地方
  - 示例URL：[查看示例](http://apps.2012.qq.com/guess/list-tid--stat-4?sort=desc,if%28%281=2%29,1,%28select/**/1/**/from/**/INFORMATION_SCHEMA.TABLES%29%29%20asc)
- **案例2**：有分页的地方
- **案例3**：有搜索的地方
- **案例4**：有分类的地方
- **案例5**：有选择的地方
  - 示例URL：[查看示例](http://life.tenpay.com/cgi-bin/mobile/mobile_order_query.cgi?g_tk=1233447418&tid=01001004&showtry=1&chgmobile=13800138000&uin=uid&startdate=20130108&enddate=20130408&state=0/**/union/**/select/**/1,2,3,4,5,6,7,user%28%29,9,0%23)

---

### 安全是一个整体
- **核心理念**：保证安全不在于强大的地方有多强大，而在于真正薄弱的地方在哪里。
- **具体例子**：
  - **DNS安全**：万网（这不是XSS）
  - **找回密码设计**：业务流程安全

---

### 技术实现

#### 基础技术栈
- **开源工具**：Python, MySQL, Linux, PhantomJS, Redis, Celery, Nmap, PHP
- **架构设计**：
  - **Redis**：数据存储和进程通信
  - **Worker模型**：多个工作线程并行处理任务
  - **分布式框架**：异步任务队列管理

#### 模块关系
- **监控后台**：下达命令、执行命令、报告状态、查看状态
- **数据代理**：放入任务、处理任务、查询优先级、错误处理

#### 异步检测队列工作原理
- **任务队列**：控制台分析数据并向队列压入任务
- **Redis队列系统**：等待Worker取任务
- **Worker**：执行任务并将结果存储到数据库

#### 任务队列的Redis存储设计
- **任务存储**：使用MD5索引和Hash结构
- **队列管理**：任务队列和错误队列一一对应，方便管理

#### Worker管理
- **扫描线程**：多线程并发处理
- **指令线程**：管理线程调度、杀死/取消进程

---

### 简单与复杂
- **摩尔定律的影响**：带来生产力释放和社区开放
- **漏洞规则库**：包含330个漏洞利用脚本，不断更新中

#### 部分脚本示例
- Apache Geronimo Default Administrative Credentials.script
- Apache httpOnly Cookie Disclosure.script
- Apache mod negotiation Filename Bruteforcing.script
- ...（更多脚本待审核）

---

### 致谢
- **感谢**：所有无私分享的白帽子们
- **欢迎加入**：白帽子阵营，共同解决互联网安全问题

---

**感谢大家的支持！**