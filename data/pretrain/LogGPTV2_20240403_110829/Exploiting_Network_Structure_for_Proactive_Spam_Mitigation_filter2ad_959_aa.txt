title:Exploiting Network Structure for Proactive Spam Mitigation
author:Shobha Venkataraman and
Subhabrata Sen and
Oliver Spatscheck and
Patrick Haffner and
Dawn Song
Exploiting Network Structure for Proactive Spam Mitigation
Shobha Venkataraman
†
, Oliver Spatscheck
, Patrick Haffner
†
, Dawn Song
∗
∗
, Subhabrata Sen
∗
Carnegie Mellon University,
†
†
AT&T Research
PI:EMAIL, {sen,spatsch,haffner}@research.att.com, PI:EMAIL
Abstract
E-mail has become indispensable in today’s networked
society. However, the huge and ever-growing volume
of spam has become a serious threat to this important
communication medium. It not only affects e-mail re-
cipients, but also causes a signiﬁcant overload to mail
servers which handle the e-mail transmission.
We perform an extensive analysis of IP addresses and
IP aggregates given by network-aware clusters in order
to investigate properties that can distinguish the bulk of
the legitimate mail and spam. Our analysis indicates that
the bulk of the legitimate mail comes from long-lived IP
addresses. We also ﬁnd that the bulk of the spam comes
from network clusters that are relatively long-lived. Our
analysis suggests that network-aware clusters may pro-
vide a good aggregation scheme for exploiting the his-
tory and structure of IP addresses.
We then consider the implications of this analysis for
prioritizing legitimate mail. We focus on the situation
when mail server is overloaded, and the goal is to maxi-
mize the legitimate mail that it accepts. We demonstrate
that the history and the structure of the IP addresses can
reduce the adverse impact of mail server overload, by in-
creasing the number of legitimate e-mails accepted by a
factor of 3.
1 Introduction
E-mail has emerged as an indispensable and ubiquitous
means of communication today. Unfortunately, the ever-
growing volume of spam diminishes the efﬁciency of e-
mail, and requires both mail server and human resources
to handle.
Great effort has focused on reducing the amount of
spam that the end-users receive. Most Internet Service
Providers (ISPs) operate various types of spam ﬁlters [1,
4, 5, 13] to identify and remove spam e-mails before they
are received by the end-user. E-mail software on end-
hosts adds an additional layer of ﬁltering to remove this
unwanted trafﬁc, based on the typical email patterns of
the end-user.
Much less attention has been paid to how the large
volume of spam impacts the mail infrastructure within
an ISP, which has to receive, ﬁlter and deliver them ap-
propriately. Spammers have a strong incentive to send
large volumes of spam – the more spam they send, the
more likely it is that some of it can evade the spam ﬁl-
ters deployed by the ISPs.
It is easy for the spammer
to achieve this – by sending spam using large botnets,
spammers can easily generate far more messages than
even the largest mail servers can receive. In such con-
ditions, it is critical to understand how the mail server
infrastructure can be made to prioritize legitimate mail,
processing it preferentially over spam.
In this context, the requirements for differentiating be-
tween spam and non-spam are slightly different from
regular spam-ﬁltering. The primary requirement for reg-
ular spam-ﬁltering is to be conservative in discarding
spam, and for this, computational cost is not usually a
consideration. However, when the mail server must pri-
oritize the processing of legitimate mail, it has to use a
computationally-efﬁcient technique to do so. In addition,
in this situation, even an imperfect distinction criterion
would be useful, as long as a signiﬁcant fraction of the
legitimate mail gets classiﬁed correctly.
In this paper, we explore the potential of using the
historical behaviour of IP addresses to predict whether
an incoming email is likely to be legitimate or spam.
Using IP addresses for classiﬁcation is computationally
substantially more efﬁcient than any content-based tech-
niques. IP address information can also be collected eas-
ily and is more difﬁcult for a spammer to obfuscate. Our
measurement studies show that IP address information
provides a stable discriminator between legitimate mail
and spam. We ﬁnd that good mail servers send mostly
legitimate mail and are persistent for signiﬁcant periods
of time. We also ﬁnd that the bulk of spam comes from
IP preﬁxes that send mostly spam and are also persis-
USENIX Association
16th USENIX Security Symposium
149
tent. With these two ﬁndings, we can use the properties
of both legitimate mail and spam together, rather than us-
ing the properties of only legitimate mail or only spam,
in order to prioritize legitimate mail when needed.
We show that these measurements are valuable in an
application where legitimate mail must be prioritized.
We focus on the situation when mail servers are over-
loaded, i.e., they receive far more mail than they can pro-
cess, even though the legitimate mail received is a tiny
fraction of the total received. Since mail typically gets
dropped at random when the server is overloaded, and
spam can be generated at will, the spammer has an in-
centive to overload the server. Indeed, the optimal strat-
egy for the spammer is to increase the load on the mail
infrastructure to a point where the most spam will be ac-
cepted by the server; this kind of behaviour has been ob-
served on the mail servers of large ISPs. In this paper, we
show an application of our measurement study to design
techniques based on the reputations of IP addresses and
their aggregates and demonstrate the beneﬁts to the mail
server overload problem.
The contributions of this paper are two-fold. We ﬁrst
perform an extensive measurement study in order to un-
derstand some IP-based properties of legitimate mail and
spam. We then perform a simulation study to evaluate
how we can use these properties to prioritize legitimate
mail when the mail server is overloaded.
Our main results are the following:
• We ﬁnd that a signiﬁcant fraction of legitimate mail
comes from IP addresses that last for a long time,
even though a very signiﬁcant fraction of spam
comes from IP addresses that are ephemeral. This
suggests that the history of “good” IP addresses,
that is, IP addresses that send mostly legitimate
mail, could be used for prioritizing mail in spam
mitigation.
• We explore network-aware clusters as a candidate
aggregation scheme to exploit structure in IP ad-
dresses. Our results suggest that IP addresses
responsible for the bulk of the spam are well-
clustered, and that the clusters responsible for the
bulk of the spam are persistent. This suggests that
network-aware clusters may be good candidates to
assign reputations to unknown IP addresses.
• Based on our measurement results, we develop a
simple reputation scheme that can prioritize IP ad-
dresses when the server is overloaded. Our simula-
tions show that when the server receives many more
connection requests than it can process, our policy
gives a factor of 3 improvement in the number of
legitimate mails accepted.
We note that the server overload problem is just one
application that illustrates how IP information could be
used for prioritizing email. This information could be
used to prioritize e-mail at additional points of the mail
server infrastructure as well. However, the kind of struc-
tural information that is reﬂected in the IP addresses may
not always be a perfect discriminator between spammers
and senders of legitimate mail, and this is, indeed, re-
ﬂected in the measurements. Such structural IP informa-
tion could, therefore, be used in combination with other
techniques in a general-purpose spam mitigation system,
and this information is likely to be useful by itself only
when an aggressive and computationally-efﬁcient tech-
nique is needed.
The remainder of the paper is structured as follows.
We present our analysis of characteristics of IP addresses
and network-aware clusters that distinguish between le-
gitimate mail and spam in Sections 2 and 3 respectively.
We present and evaluate our solution for protecting mail
servers under overload in Section 4. We review related
work in Section 5 and conclude in Section 6.
2 Analysis of IP-Address Characteristics
In this section, we explore the extent to which IP-based
identiﬁcation can be used to distinguish spammers from
senders of legitimate e-mail based on differences in pat-
terns of behaviour.
2.1 Data
Our data consists of traces from the mail server of a large
company serving one of its corporate locations with ap-
proximately 700 mailboxes, taken over a period of 166
days from January to June 2006. The location runs a
PostFix mail server with extensive logging that records
the following: (a) every attempted SMTP connection,
with its IP address and time stamp, (b) whether the con-
nection was rejected, along with a reason for rejection,
(c) if the connection was accepted, results of additional
mail server’s local spam-ﬁltering tests, and if accepted
for delivery, the results of running SpamAssassin.
Fig. 1(a) shows a daily summary of the data for six
months. It shows four quantities for each day: (a) the
number of SMTP connection requests made (including
those that are denied via blacklists), (b) the number of
e-mails received by the mail server, (c) the number of
e-mails that were sent to SpamAssassin, and (d) the
number of e-mails deemed legitimate by SpamAssassin.
The relative sizes of these four quantities on every day
illustrate the scale of the problem: spam is 20 times
larger than the legitimate mail received. (In our data set,
there were 1.4 million legitimate messages and 27 mil-
lion spam messages in total.) Such a sharp imbalance
150
16th USENIX Security Symposium
USENIX Association
indicates the potential of a signiﬁcant role for applica-
tions like maximizing legitimate mail accepted when the
server is overloaded: if there is a way to prioritize legiti-
mate mail, the server could handle it much more quickly,
because the volume of legitimate mail is tiny in compar-
ison to spam.
In the following analysis, every message that is con-
sidered legitimate by SpamAssassin is counted as a le-
gitimate message; every message that is considered spam
by SpamAssassin, the mail server’s local spam-ﬁltering
tests, or through denial by a blacklist is counted as spam.
2.2 Analysis of IP Addresses
We ﬁrst explore the behaviour of individual IP addresses
that send legitimate mail and spam, with the goal of un-
covering any signiﬁcant differences in their behavioral
patterns.
Our analysis focuses on the IP spam-ratio of an IP ad-
dress, which we deﬁne to be the fraction of mail sent
by the IP address that is spam. This is a simple, intu-
itive metric that captures the spamming behaviour of an
IP address: a low spam-ratio indicates that the IP address
sends mostly legitimate mail; a high spam-ratio indicates
that the IP address sends mostly spam. Our goal is to
see whether the historical communication behaviour of
IP addresses categorized by their spam-ratios can differ-
entiate between IP addresses of legitimate senders and
spammers, for spam mitigation.
As discussed earlier, the differentiation between the
legitimate senders and spammers need not be perfect;
there are beneﬁts to having even a partial differentiation,
especially with a simple, computationally inexpensive
feature. For example, in the server overload problem,
when all the mail cannot be accepted, a partial separa-
tion would still help to increase the amount of legitimate
mail that is received.
In the IP-based analysis, we will address the following
questions:
• Distribution by IP Spam Ratio: What is the distri-
bution of IP addresses by their spam-ratio, and what
fraction of legitimate mail and spam is contributed
by IP addresses with different spam-ratios?
• Persistence: Are IP addresses with low/high spam-
ratios present across long time periods? If they are,
do such IP addresses contribute to a signiﬁcant frac-
tion of the legitimate mail/spam?
• Temporal Spam-Ratio Stability: Do many of the IP
addresses that appear to be good on average ﬂuctu-
ate between having very low and very high spam-
ratios?
The answers to these three questions, taken together,
give us an idea of the beneﬁt we could derive in using the
history of IP address behaviour in spam mitigation. We
show in Sec. 2.2.1, that most IP addresses have a spam-
ratio of 0% or 100%, and also that a signiﬁcant amount
of the legitimate mail comes from IP addresses whose
spam-ratio exceeds zero.
In Sec. 2.2.2, we show that
a very signiﬁcant fraction of the legitimate mail comes
from IP addresses that persist for a long time, but only
a tiny fraction of the spam comes from IP addresses that
persist for a long time. In Sec. 2.2.3, we show that most
IP addresses have a very high temporal ratio-stability –
they do not ﬂuctuate between exhibiting a very low or
very high daily spam-ratio over time.
Together, these three observations suggest that iden-
tifying IP addresses with low spam ratios that regularly
send legitimate mail could be useful in spam mitigation
and prioritizing legitimate mail. In the rest of this sec-
tion, we present the analysis that leads to these observa-
tions. For concreteness, we focus on how the analysis
can help spam mitigation in the server overload problem.
SMTP handshake received
Mail received
SpamAssassin applied
Legitimate Mail
20
40
60
80
100
Time in days
120
140
160
(a) Data characteristics
x 105
4
s
e
g
a
s
s
e
m
f
o
.
o
N
3.5
3
2.5
2
1.5
1
0.5
0
1
0.8
0.6
0.4
0.2
s
e
s
s
e
r
d
d
A
P
I
f
o
n
o
i
t
c
a
r
F
0
0%
20%
40%
60%
IP spam−ratio
80%
100% 
(b) CDFs of IP spam-ratios for many days: each line is a
CDF for a different day.
Figure 1: 1(a): Daily summary of the data set over 6
months. 1(b): CDFs of IP spam-ratios for many different
days.
USENIX Association
16th USENIX Security Symposium
151
2.2.1 Distribution by IP Spam-Ratio
In this section, we explore how the IP addresses and their
associated mail volumes are distributed as a function of
the IP spam-ratios. We focus here on the spam-ratio
computed over a short time period in order to understand
the behaviour of IP addresses without being affected by
their possible ﬂuctuations in time. Effectively, this anal-
ysis shows the limits of the differentiation that could be
achieved by using IP spam-ratio, even assuming that IP
spam-ratio could be predicted for a given IP address over
short periods of time. In this section, we focus on day-
long intervals, in order to take into account possible time-
of-day variations. We refer to the IP spam-ratio com-
puted over a day-long interval as the daily spam-ratio.
Intuitively, we expect that most IP addresses either
send mostly legitimate mail, or mostly spam, and that
most of the legitimate mail and spam comes from these
IP addresses. If this hypothesis holds, then for spam mit-
igation, it will be sufﬁcient if we can identify the IP ad-
dresses as senders of legitimate mail or spammers. To
test this hypothesis, we analyze the following two empir-
ical distributions: (a) the distribution of IP addresses as
a function of the spam-ratios, and (b) the distribution of
legitimate mail/spam as a function of their respective IP
addresses’ spam-ratio.
We ﬁrst analyze the distribution of IP addresses by
their daily spam-ratios in Fig. 1(b).
For each day,
it shows the empirical cumulative distribution func-
tion (CDF) of the daily spam-ratios of individual IP ad-
dresses active on that day. Fig. 1(b) shows this daily CDF
for a large number of randomly selected days across the
observation period.
Result 1. Distribution of IP addresses: Fig. 1(b) indi-