### 文档头部
```
.\" Copyright 1998 Andries E. Brouwer (PI:EMAIL)
.\"
.\" May be distributed under the GNU General Public License
.\" Rewritten for 2.1.117, aeb, 981010.
.\"
.TH MKSWAP 8 "25 March 1999" "Linux 2.2.4" "Linux Programmer's Manual"
```

### 名称
**mkswap** - 创建一个 Linux 交换区

### 概述
```
mkswap [选项] 设备 [大小]
```

### 描述
`mkswap` 命令用于在一个设备或文件上创建一个 Linux 交换区。创建后的交换区需要通过 `swapon` 命令启用。通常，交换区会在 `/etc/fstab` 文件中列出，以便在系统启动时通过某些启动脚本中的 `swapon -a` 命令启用。

- **设备**：通常是磁盘分区（如 `/dev/hda4` 或 `/dev/sdb7`），也可以是一个文件。
- **大小**：可选参数，指定以 1024 字节为单位的交换区大小。如果未指定，`mkswap` 将使用整个分区或文件。

#### 交换区类型
Linux 支持两种类型的交换区：旧类型和新类型。

- **旧类型**：第一页的最后 10 个字节是 "SWAP_SPACE"，其余部分是位图，表示可用页面。最大可用区域取决于页面大小：
  - i386 上（S=4096）：约 128 MB
  - alpha 和 sparc64 上（S=8192）：约 512 MB

- **新类型**：第一页的最后 10 个字节是 "SWAPSPACE2"，使用整数表示交换区大小，并列出坏块。最大可用区域取决于具体架构：
  - i386, PPC, m68k, ARM：约 2 GB
  - sparc：约 1 GB
  - mips：约 512 MB
  - alpha：约 128 GB
  - sparc64：约 3 TB

注意：在 2.1.117 内核之前，每页分配一个字节，现在为两个字节，因此 2 GB 的交换区可能需要 2 MB 的核心内存。

目前，Linux 允许最多 8 个交换区。正在使用的交换区可以从 `/proc/swaps` 文件中查看（从 2.1.25 起）。

`mkswap` 不允许小于 10 个页面的区域。要查询机器的页面大小，可以使用 `cat /proc/cpuinfo` 命令。

#### 创建交换文件
在执行 `mkswap` 之前，需要先创建交换文件。例如：
```sh
# dd if=/dev/zero of=swapfile bs=1024 count=65536
```
注意：交换文件不能包含任何空洞，因此不能使用 `cp` 命令创建该文件。

### 选项
- **-c**：在创建交换区之前检查设备（如果是块设备）的坏块。如果发现任何坏块，将打印出坏块总数。
- **-f**：强制执行，即使命令看起来不合理。允许创建比所在文件或分区还大的交换区。在 SPARC 上，强制创建交换区。没有此选项时，`mkswap` 将拒绝在包含有效 SPARC 超级块的设备上创建交换区，因为这可能会删除分区表。
- **-v0**：创建旧类型的交换区。
- **-v1**：创建新类型的交换区。

如果没有指定 `-v` 选项且交换区大小不超过旧类型的最大值，并且当前内核版本低于 2.1.117（且 PAGE_SIZE 小于 2048），`mkswap` 将默认创建旧类型的交换区。如果引导分区或磁盘卷标在第一块，新类型的头部不会接触这些部分，因此在这种情况下创建新类型交换区可能是更好的选择。

### 参考
- **fdisk(8)**
- **swapon(8)**