> allows employee access.
Let\'s take a look at an example of how this module is used. We interact
with our agent and run the command as shown as follows:
> **usemodule exfiltration/exfil_dropbox**
To view the details of the module, we type the info command:
> ![](media/image783.jpeg)
>
> This requires the path of the file we wish to transfer and the Dropbox
> API key, along with the target filename.
>
> ![](media/image784.jpeg)
Once everything is set we execute the module as shown following, and the
agent will then transfer the file to Dropbox using the Dropbox API. All
this is done inside the memory itself, thereby making it harder to
detect.
> ![](media/image785.jpeg)
>
> Viewing our Dropbox account, we can see that a folder is created and
> inside the folder we should have our password file, which we wanted to
> transfer:
>
> ![](media/image786.jpeg)
As shown in the following screenshot, the password file has been
successfully uploaded:
> ![](media/image787.jpeg)
# Summary
> In this chapter, we learned about data exfiltration and why it is
> needed. Then, we learned some basic ways of transferring data using
> simple tools like Netcat, OpenSSL, and PowerShell. Next, we jumped
> into transforming the data using text-based steganography to avoid
> detection, as well as looking at the usage of the CloakifyFactory
> tool. We also learned about extracting data via DNS from a victim
> machine to our server. Lastly, we explored how to exfiltrate data
> using Dropbox API to avoid detection, suspicion, and for bypassing
> firewalls.
Our journey with you ends here. We hope that you have enjoyed reading
these chapters and that you have learned from them as well.
We would love to hear your feedback on this book. You can reach us on
LinkedIn at the following links:
> 
>
> 
>
> Email: 
# Questions
1.  Are there other ways to exfiltrate data? Are these techniques
    > totally undetectable?
2.  What is a frequency analysis attack?
3.  What other tools can be used for Data exfiltration?
# Further reading
> For more information on the topics discussed in this chapter, please
> visit the following links:
>
> 
>
> 
> 
>
> [https://blog.trendmicro.com/trendlabs-security-intelligence/data-exfiltration-in-tar
> geted-attacks/](https://blog.trendmicro.com/trendlabs-security-intelligence/data-exfiltration-in-targeted-attacks/)
>
> 
> 
# Assessment
> []{#_bookmark243 .anchor}**Chapter 1: Red-Teaming and Pentesting**
1.  OWASP, OSSTMM, ISSAF.
2.  Different phases of PTES are: Reconnaissance Compromise
> Persistence
>
> Command and control Privilege escalation Pivoting
>
> Reporting and cleanup
3.  Difference between red-teaming and pentesting is:
> Red-teaming involves finding and exploiting only those vulnerabilities
> that help to achieve our goal, whereas pentesting involves finding and
> exploiting vulnerabilities in the given scope, which is limited to
> digital assets.
>
> Red-teaming has an extremely flexible methodology, whereas, pentesting
> has fixed static methods.
>
> During red-teaming, the security teams of the organizations have no
> information about it, whereas during pentesting, security teams are
> notified.
>
> Red-teaming attacks can happen 24/7, while pentesting activities are
> mostly limited to office hours.
>
> Red-team is more about measuring the business impact of the
> vulnerabilities, whereas, pentesting is about finding and exploiting
> vulnerabilities.
4.  Key elements of a report are: Criticality of the bug
> Steps of reproduction of the bug Patch suggestions
5.  The main objective of red-teaming is to assess and obtain the real
    > level of risk a company has at that moment of time. In this
    > activity, networks,
> applications, physical, and people (social engineering) are tested
> against weaknesses.
# Chapter 2: Pentesting 2018
1.  When generating a simple payload in msfvenom, you need to include
    > many options in it. This is definitely a confusing and
    > time-consuming process because each time when you need to generate
    > a payload, you will be typing a long command for it. MSFPC just
    > does what msfvenom does, but with fewer words to type.
2.  It all depends upon the creator but in the meantime, if you feel
    > that some features are missing, you can always fork the script and
    > contribute to the community.
3.  When you don\'t know what device the victim will use, you can
    > generate all these types of payload and download these files from
    > your web server to the victim\'s system (Phishing, Drive-by,
    > Ewhoring, and so on). You need to obfuscate/encrypt the files to
    > avoid AV detection.
4.  No. However, it\'s already packaged in Kali rolling. You can install
    > MSFPC in Kali by executing the following command:
> **apt install msfpc -y**
5.  Unlike Empire (which is based on Python & PowerShell ) or Metasploit
    > (the payload signatures are publicly available for easy
    > detection), Koadic uses Windows Script Host Utility for in-memory
    > payload execution, which is enough to bypass some AV detections.
6.  Koadic implants are based on JavaScript/VBScript, which don\'t have
    > as many functionalities as PowerShell. So just give it some time
    > and wait for the creator to add more implants.
7.  In the upcoming chapters, you\'ll be getting hands-on experience
    > with tools that can be used as a replacement for Metasploit
    > (msfconsole) and we\'ll be seeing how by using those tools, we can
    > perform a red-team exercise.
# Chapter 3: Foreplay -- Metasploit Basics
1.  It\'s up to you. The nightly builds contain version 4. However, if
    > you want to try out the latest version (version 5), it can be
    > manually downloaded and configured from their official repository.
2.  Integration of Metasploit with slack is not mandatory. However, in
    > most Red Teaming activity, you may find it pretty useful as you
    > may not always be in a situation where you will have your laptop
    > in your hand to check and confirm sessions, especially when social
    > engineering is being used. The slack app can be easily configured
    > on your phone and getting notified of every new session becomes
    > very easy.
3.  Yes! Cortana scripts can be created and loaded easily based on the
    > requirements of your activity.
4.  Although the official website says that team server is not supported
    > on Windows, we can install and run team server on a Windows
    > machine via bash, which was released for Windows some time ago.
5.  The Metapsloit Framework community edition is free to use and is
    > open source. However, Metasploit also has a paid version that
    > provides a better UI and a lot more features. More can be read
    > about this here: [https://www.rapi
    > d7.com/products/metasploit/.](https://www.rapid7.com/products/metasploit/)
# Chapter 4: Getting Started with Cobalt Strike
1.  Yes. It is necessary to plan the attack because you may get only one
    > shot in which you have the advantage of the element of surprise.
    > You need to know exactly when you\'ll be attacking the server and
    > carry on with the operation.
2.  Cobalt Strike is not free, but you can download the trial version
    > online. A little bit of Googling may help here.
3.  Yes, you can. However, for that you need to change the port in the
    > team server script. Furthermore, running two team servers on the
    > same instance will have a listener\'s port conflict. This can be
    > avoided by using different ports for listeners during setup.
4.  You could be connecting to someone else\'s team server with your
    > credentials. It\'s highly unlikely but possible that you\'re in an
    > MITM attack phase.
5.  The older version of Cobalt Strike required MSF, but new versions
    > don\'t require it at all. That\'s the beauty of it.
6.  This will be shown in the upcoming chapters. Many new things will
    > also be covered in later chapters.
7.  It\'s up to your own imagination. You can customize the script to
    > redirect the Cobalt Strike error logs to a file and get an alert
    > system set up so that whenever the team server crashes or gets an
    > error in one of its modules, you will find out.
# Chapter 5: ./ReverseShell
1.  Yes, it is. Not understanding the tool can be much more problematic
    > than learning to understand it. Also, you can think of unique
    > solutions in a red- team engagement.
2.  Yes, if you don\'t want the organization to detect your presence in
    > the network.
3.  You can either buy MSF Pro, which comes with the GUI web interface,
    > where you can generate the payloads, or you can also use the venom
    > tool (source:  for a
    > partial GUI in Metasploit payload generation.
4.  You can download the Cryptcat source code for Windows and compile it
    > using Visual Studio 2005.
5.  Yes, you can. But make sure the encoder you will be using is
    > supported for this operation.
6.  It\'s recommended that you do because it will get much harder for
    > the organization\'s defenders to detect you in this way.
7.  Yes, it is. However, it also has a premium access that you can
    > purchase just in case you want to use an SSL tunnel.
# Chapter 7: Age of Empire -- The Beginning
1.  Yes. Empire is an open source tool available on GitHub.
2.  Yes, it does, but only when the listener is SSL-enabled.
3.  Yes, it does. There\'s an official Empire GUI, but this can only
    > work with the Empire 3.0 beta version for now. There\'s also
    > another Empire GUI tool which is covered in the next chapter.
# Chapter 8: Age of Empire -- Owning Domain Controllers
1.  There are many different techniques which can be used to get access
    > into the Domain Controller but not all are recommended. It\'s
    > better to impersonate the Domain Controller using \'DCSync\' to
    > extract the password hashes without requiring interactive logon or
    > copying the Active Directory database file (ntds.dit).
2.  You can either try other UAC modules in Empire for privilege
    > escalation or you can look for a local vulnerability using
    > privesc/powerup/allchecks module or a *Unquoted Service Path
    > Vulnerability* to escalate the privileges manually.
3.  DeathStar follows a series of checklist to look for the credentials.
    > If the standard way didn\'t work, you need to do some manual
    > reconnaissance to move further.
4.  It\'s not mandatory to retrieve the passwords in plain-text. We can
    > always use Pass-The-Hash (PTH) technique for lateral movement.
5.  A local account cannot communicate with the Domain Controller
    > because the local account would be in a different domain
    > (WORKGROUP). So, to communicate with the Domain Controller for
    > enumeration and reconnaissance we need to have access to a domain
    > user account.
# Chapter 9: Cobalt Strike -- Red Team Operations
1.  No, Cobalt strike is a paid software which costs about USD 3500 per
    > annum and renewal of license is USD 2500.
2.  Yes , Cobalt Strike has an external C2 module in it which allows
    > other programs to act as a middle-man between Cobalt Strike and
    > its Beacon payload.
3.  Cobalt Strike\'s beacon have a mallable C2 profile which define how
    > the communication happens and the data is stored. There are a
    > different C2 profiles which can be downloaded from GitHub and used
    > to avoid detection.
    > .
4.  Older versions of Cobalt Strike used Metasploit Framework, but the
    > new versions are independent and do not depend on Metasploit
    > Framework.
# Chapter 10: C2 -- Master of Puppets
1.  We can use different platforms such as Gmail, Twitter, and different
    > protocol suits like HTTP 2.0, DNS, and so for communication.
2.  It\'s recommended that you create a new account because sometimes
    > Dropbox can disable your account as we\'re using their features in
    > a simulated attack.
3.  Well you can but you need your system to be connected to the
    > internet at all times because you never know when the agent will
    > be connecting to you. It\'s recommended that you setup the C2
    > server on a cloud service like AWS for efficient usage.
4.  Yes there are tools which can be used for automated configuration
    > and setup. Refer to
    > [https://rastamouse.me/2017/08/automated-red-team-infrastructure-dep
    > loyment-with-terraform\-\--part-1/.](https://rastamouse.me/2017/08/automated-red-team-infrastructure-deployment-with-terraform---part-1/)
5.  We can use Ansible to deploy and monitor our C2 servers. Refer to
    > [https://r
    > astamouse.me/2017/08/automated-red-team-infrastructure-deployment-with-terraform\-\--p
    > art-1/ for more
    > details.](https://rastamouse.me/2017/08/automated-red-team-infrastructure-deployment-with-terraform---part-1/)
# Chapter 11: Obfuscating C2s -- Introducing Redirectors
1.  Yes. you can use a Windows based redirector, provided you have socat
    > installed for dumb pipe redirection or XAMPP/WAMP installed for
    > smart redirection.
2.  We\'re not the actual attacker here. There are a set of rules that
    > even a red teamer has to follow. We should configure and install
    > our own redirectors unless the organization asked us to use
    > theirs. Remember, If the motivation behind the engagement is
    > negative, then it\'s just another cyber attack and not a simulated
    > one.
3.  You can use any web server which supports web request redirection.
    > You can also use NGINX instead of Apache for robust connections.
4.  Only if it is allowed by the organization and mentioned in the RoE
    > and if by any chance the red teamers took things too far, the
    > organization\'s legal advisors will be available to make things
    > clear.
5.  We can setup the redirectors on any cloud-based Virtual Private
    > Server (VPS) services such as Digital Ocean, AWS, etc. It\'s just
    > a plain Linux server with some additional tools installed.
# Chapter 13: Data Exfiltration
1.  Yes, there are alternative methods such as FTP, SSH, Gmail, Twitter,
    > and so on. A lot of tools and PoC codes can be found on the
    > internet for exfiltration of data. And, it\'s not totally
    > undetectable, these techniques help you avoid detection to a
    > certain level, but we should consider the fact that Blue team may
    > also know about these tools and might be monitoring tool-specific
    > channels for any activity.
2.  Frequency analysis is one of the known ciphertext attacks. This is
    > based on the study of the frequency of letters or groups of
    > letters in a ciphertext. Frequency analysis is used for breaking
    > substitution ciphers. The general idea is to find the popular
    > letters in the ciphertext and to try to replace them with the
    > common letters in the used language.
3.  There are a lot of tools which are released every day for the same
    > purpose, such as the Data Exfiltration Toolkit and so on.
# Other Books You May Enjoy
> If you enjoyed this book, you may be interested in these other books
> by Packt:
>
> ![](media/image788.png)
>
> **Cybersecurity -- Attack and Defense Strategies**
>
> Yuri Diogenes, Erdal Ozkaya ISBN: 978-1-78847-529-7
>
> Learn the importance of having a solid foundation for your security
> posture
>
> Understand the attack strategy using cyber security kill chain
>
> Learn how to enhance your defense strategy by improving your security
> policies, hardening your network, implementing active sensors, and
> leveraging threat intelligence
>
> Learn how to perform an incident investigation
>
> Get an in-depth understanding of the recovery process
>
> Understand continuous security monitoring and how to implement a
> vulnerability management strategy
>
> Learn how to perform log analysis to identify suspicious activities
>
> ![](media/image789.png)
>
> **Hands-On Cybersecurity for Architects**
>
> Neil Rerup, Milad Aslaner ISBN: 978-1-78883-026-3
>
> Understand different security architecture layers and their
> integration with all solutions
>
> Study SWOT analysis and dig into your organization's requirements to
> drive the strategy
>
> Design and implement a secure email service approach Monitor the age
> and capacity of security tools and architecture Explore growth
> projections and architecture strategy
>
> Identify trends, as well as what a security architect should take into
> consideration
# Leave a review - let other readers know what you think
> Please share your thoughts on this book with others by leaving a
> review on the site that you bought it from. If you purchased the book
> from Amazon, please leave us an honest review on this book\'s Amazon
> page. This is vital so that other potential readers can see and use
> your unbiased opinion to make purchasing decisions, we can understand
> what our customers think about our products, and our authors can see
> your feedback on the title that they have worked with Packt to create.
> It will only take a few minutes of your time, but is valuable to other
> potential customers, our authors, and Packt. Thank you!