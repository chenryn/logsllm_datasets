apps.
Table 152 on page 1384 describes the list of tcam-apps that use TCAM resources.
1384
Table 152: Features Using TCAM Resource
TCAM Apps/TCAM Users Feature/Functionality TCAM Stage
bd-dtag-validate Bridge domain dual-tagged validate Egress
NOTE: This feature is not supported on ACX5048 and ACX5096
routers.
bd-tpid-swap Bridge domain vlan-map with swap tpid operation Egress
cfm-bd-filter Connectivity fault management implicit bridge-domain filters Ingress
cfm-filter Connectivity fault management implicit filters Ingress
cfm-vpls-filter Connectivity fault management implicit vpls filters Ingress
NOTE: This feature is supported only on ACX5048 and ACX5096
routers.
cfm-vpls-ifl-filter Connectivity fault management implicit vpls logical interface filters Ingress
NOTE: This feature is supported only on ACX5048 and ACX5096
routers.
cos-fc Logical interface level fixed classifier Pre-ingress
fw-ccc-in Circuit cross-connect family ingress firewall Ingress
fw-family-out Family level egress firewall Egress
fw-fbf Firewall filter-based forwarding Pre-ingress
fw-fbf-inet6 Firewall filter-based forwarding for inet6 family Pre-ingress
fw-ifl-in Logical interface level ingress firewall Ingress
1385
Table 152: Features Using TCAM Resource (Continued)
TCAM Apps/TCAM Users Feature/Functionality TCAM Stage
fw-ifl-out Logical interface level egress firewall Egress
fw-inet-ftf Inet family ingress firewall on a forwarding-table Ingress
fw-inet6-ftf Inet6 family ingress firewall on a forwarding-table Ingress
fw-inet-in Inet family ingress firewall Ingress
fw-inet-rpf Inet family ingress firewall on RPF fail check Ingress
fw-inet6-in Inet6 family ingress firewall Ingress
fw-inet6-family-out Inet6 Family level egress firewall Egress
fw-inet6-rpf Inet6 family ingress firewall on a RPF fail check Ingress
fw-inet-pm Inet family firewall with port-mirror action Ingress
NOTE: This feature is not supported on ACX5048 and ACX5096
routers.
fw-l2-in Bridge family ingress firewall on Layer 2 interface Ingress
fw-mpls-in MPLS family ingress firewall Ingress
fw-semantics Firewall sharing semantics for CLI configured firewall Pre-ingress
fw-vpls-in VPLS family ingress firewall on VPLS interface Ingress
ifd-src-mac-fil Physical interface level source MAC filter Pre-ingress
1386
Table 152: Features Using TCAM Resource (Continued)
TCAM Apps/TCAM Users Feature/Functionality TCAM Stage
ifl-statistics-in Logical level interface statistics at ingress Ingress
ifl-statistics-out Logical level interface statistics at egress Egress
ing-out-iff Ingress application on behalf of egress family filter for log and syslog Ingress
ip-mac-val IP MAC validation Pre-ingress
ip-mac-val-bcast IP MAC validation for broadcast Pre-ingress
ipsec-reverse-fil Reverse filters for IPsec service Ingress
NOTE: This feature is not supported on ACX5048 and ACX5096
routers.
irb-cos-rw IRB CoS rewrite Egress
lfm-802.3ah-in Link fault management (IEEE 802.3ah) at ingress Ingress
NOTE: This feature is not supported on ACX5048 and ACX5096
routers.
lfm-802.3ah-out Link fault management (IEEE 802.3ah) at egress Egress
lo0-inet-fil Looback interface inet filter Ingress
lo0-inet6-fil Looback interface inet6 filter Ingress
mac-drop-cnt Statistics for drops by MAC validate and source MAC filters Ingress
mrouter-port-in Multicast router port for snooping Ingress
1387
Table 152: Features Using TCAM Resource (Continued)
TCAM Apps/TCAM Users Feature/Functionality TCAM Stage
napt-reverse-fil Reverse filters for network address port translation (NAPT) service Ingress
NOTE: This feature is not supported on ACX5048 and ACX5096
routers.
no-local-switching Bridge no-local-switching Ingress
ptpoe Point-to-Point-Over-the-Ethernet traps Ingress
NOTE: This feature is not supported on ACX5048 and ACX5096
routers.
ptpoe-cos-rw CoS rewrite for PTPoE Egress
NOTE: This feature is not supported on ACX5048 and ACX5096
routers.
rfc2544-layer2-in RFC2544 for Layer 2 service at ingress Pre-ingress
rfc2544-layer2-out RFC2544 for Layer 2 service at egress Egress
NOTE: This feature is not supported on ACX5048 and ACX5096
routers.
service-filter-in Service filter at ingress Ingress
NOTE: This feature is not supported on ACX5048 and ACX5096
routers.
Monitoring TCAM Resource Usage
You can use the show and clear commands to monitor and troubleshoot dynamic TCAM resource usage.
Table 153 on page 1388 summarizes the command-line interface (CLI) commands you can use to
monitor and troubleshoot dynamic TCAM resource usage.
1388
Table 153: Show and Clear Commands to Monitor and Troubleshoot Dynamic TCAM
Task Command
Display the shared and the related applications for a particular show pfe tcam app
application
Display the TCAM resource usage for an application and stages (egress, show pfe tcam usage
ingress, and pre-ingress)
(ACX5448) show pfe filter hw
summary
Display the TCAM resource usage errors for applications and stages show pfe tcam errors
(egress, ingress, and pre-ingress)
Clears the TCAM resource usage error statistics for applications and clear pfe tcam-errors
stages (egress, ingress, and pre-ingress)
Example: Monitoring and Troubleshooting the TCAM Resource
This section describes a use case where you can monitor and troubleshoot TCAM resources using show
commands. In this use case scenario, you have configured Layer 2 services and the Layer 2 service-
related applications are using TCAM resources. The dynamic approach, as shown in this example, gives
you the complete flexibility to manage TCAM resources on a need basis.
The service requirement is as follows:
• Each bridge domain has one UNI and one NNI interface
• Each UNI interface has:
• One logical interface level policer to police the traffic at 10 Mbps.
• Multifield classifier with four terms to assign forwarding class and loss-priority.
• Each UNI interface configures CFM UP MEP at the level 4.
• Each NNI interface configures CFM DOWN MEP at the level 2
Let us consider a scenario where there are 100 services configured on the router. With this scale, all the
applications are configured successfully and the status shows OK state.
1. Viewing TCAM resource usage for all stages.
1389
To view the TCAM resource usage for all stages (egress, ingress, and pre-ingress), use the show pfe tcam
usage all-tcam-stages detail command. On ACX5448 routers, use the show pfe filter hw summary
command to view the TCAM resource usgae.
user@host> show pfe tcam usage all-tcam-stages detail
Slot 0
Tcam Resource Stage: Pre-Ingress
--------------------------------
Free [hw-grps: 3 out of 3]
No dynamic tcam usage
Tcam Resource Stage: Ingress
----------------------------
Free [hw-grps: 2 out of 8]
Group: 11, Mode: SINGLE, Hw grps used: 3, Tcam apps: 2
Used Allocated Available Errors
Tcam-Entries 800 1024 224 0
Counters 800 1024 224 0
Policers 0 1024 1024 0
App tcam usage:
----------------
App-Name Entries Counters Policers Precedence State
Related-App-Name ..
-----------------------------------------------------------------
cfm-filter 500 500 0 3 OK
cfm-bd-filter 300 300 0 2 OK
Group: 8, Mode: DOUBLE, Hw grps used: 2, Tcam apps: 1
Used Allocated Available Errors
Tcam-Entries 500 512 12 0
Counters 500 1024 524 0
Policers 0 1024 1024 0
App tcam usage:
----------------
App-Name Entries Counters Policers Precedence State
Related-App-Name ..
-----------------------------------------------------------------
fw-l2-in 500 500 0 2 OK
fw-semantics 0 X X 1 OK
1390
Group: 14, Mode: SINGLE, Hw grps used: 1, Tcam apps: 1
Used Allocated Available Errors
Tcam-Entries 200 512 312 0
Counters 200 512 312 0
Policers 100 512 412 0
App tcam usage:
----------------
App-Name Entries Counters Policers Precedence State
Related-App-Name ..
-----------------------------------------------------------------
fw-ifl-in 200 200 100 1 OK
Tcam Resource Stage: Egress
---------------------------
Free [hw-grps: 3 out of 3]
No dynamic tcam usage
2. Configure additional Layer 2 services on the router.
For example, add 20 more services on the router, thereby increasing the total number of services to
120. After adding more services, you can check the status of the configuration by verifying either the
syslog message using the command show log messages, or by running the show pfe tcam errors command.
The following is a sample syslog message output showing the TCAM resource shortage for Ethernet-
switching family filters for newer configurations by running the show log messages CLI command.
[Sat Jul 11 16:10:33.794 LOG: Err] ACX Error
(dfw):acx_dfw_check_phy_slice_availability :Insufficient phy slices to accomodate grp:13/
IN_IFF_BRIDGE mode:1/DOUBLE
[Sat Jul 11 16:10:33.794 LOG: Err] ACX Error (dfw):acx_dfw_check_resource_availability :Could
not write filter: f-bridge-ge-0/0/0.103-i, insufficient TCAM resources
[Sat Jul 11 16:10:33.794 LOG: Err] ACX Error
(dfw):acx_dfw_update_filter_in_hw :acx_dfw_check_resource_availability failed for filter:f-
bridge-ge-0/0/0.103-i
[Sat Jul 11 16:10:33.794 LOG: Err] ACX Error (dfw):acx_dfw_create_hw_instance :Status:1005
Could not program dfw(f-bridge-ge-0/0/0.103-i) type(IN_IFF_BRIDGE)! [1005]
[Sat Jul 11 16:10:33.794 LOG: Err] ACX Error (dfw):acx_dfw_bind_shim :[1005] Could not create
dfw(f-bridge-ge-0/0/0.103-i) type(IN_IFF_BRIDGE)
[Sat Jul 11 16:10:33.794 LOG: Err] ACX Error (dfw):acx_dfw_bind :[1000] bind failed for
filter f-bridge-ge-0/0/0.103-i
1391
If you use the show pfe tcam errors all-tcam-stages detail CLI command to verify the status of the
configuration, the output will be as shown below:
user@host> show pfe tcam errors all-tcam-stages detail
Slot 0
Tcam Resource Stage: Pre-Ingress
--------------------------------
Free [hw-grps: 3 out of 3]
No dynamic tcam usage
Tcam Resource Stage: Ingress
----------------------------
Free [hw-grps: 2 out of 8]
Group: 11, Mode: SINGLE, Hw grps used: 3, Tcam apps: 2
Used Allocated Available Errors
Tcam-Entries 960 1024 64 0
Counters 960 1024 64 0
Policers 0 1024 1024 0
App tcam usage:
----------------
App-Name Entries Counters Policers Precedence State
Related-App-Name ..
-----------------------------------------------------------------
cfm-filter 600 600 0 3 OK
cfm-bd-filter 360 360 0 2 OK
Group: 8, Mode: DOUBLE, Hw grps used: 2, Tcam apps: 1
Used Allocated Available Errors
Tcam-Entries 510 512 2 18
Counters 510 1024 514 0
Policers 0 1024 1024 0
App tcam usage:
----------------
App-Name Entries Counters Policers Precedence State
Related-App-Name ..
-----------------------------------------------------------------
fw-l2-in 510 510 0 2 FAILED
fw-semantics 0 X X 1 OK
1392
App error statistics:
----------------------
App-Name Entries Counters Policers Precedence State
Related-App-Name ..
-----------------------------------------------------------------
fw-l2-in 18 0 0 2 FAILED
fw-semantics 0 X X 1 OK
Group: 14, Mode: SINGLE, Hw grps used: 1, Tcam apps: 1
Used Allocated Available Errors
Tcam-Entries 240 512 272 0
Counters 240 512 272 0
Policers 120 512 392 0
App tcam usage:
----------------
App-Name Entries Counters Policers Precedence State
Related-App-Name ..
-----------------------------------------------------------------
fw-ifl-in 240 240 120 1 OK
Tcam Resource Stage: Egress
---------------------------
Free [hw-grps: 3 out of 3]
No dynamic tcam usage
The output indicates that the fw-l2-in application is running out of TCAM resources and moves into a
FAILED state. Although there are two TCAM slices available at the ingress stage, the fw-l2-in
application is not able to use the available TCAM space due to its mode (DOUBLE), resulting in
resource shortage failure.
3. Fixing the applications that have failed due to the shortage of TCAM resouces.
The fw-l2-in application failed because of adding more number of services on the routers, which
resulted in shortage of TCAM resources. Although other applications seems to work fine, it is
recommended to deactivate or remove the newly added services so that the fw-l2-in application
moves to an OK state. After removing or deactivating the newly added services, you need to run the
show pfe tcam usage and show pfe tcam error commands to verify that there are no more applications in
failed state.
1393
To view the TCAM resource usage for all stages (egress, ingress, and pre-ingress), use the show pfe tcam
usage all-tcam-stages detail command. For ACX5448 routers, use the show pfe filter hw summary
command to to view the TCAM resource usage.
user@host> show pfe tcam usage all-tcam-stages detail
Slot 0
Tcam Resource Stage: Pre-Ingress
--------------------------------
Free [hw-grps: 3 out of 3]
No dynamic tcam usage
Tcam Resource Stage: Ingress
----------------------------
Free [hw-grps: 2 out of 8]
Group: 11, Mode: SINGLE, Hw grps used: 3, Tcam apps: 2
Used Allocated Available Errors
Tcam-Entries 800 1024 224 0
Counters 800 1024 224 0
Policers 0 1024 1024 0
App tcam usage:
----------------
App-Name Entries Counters Policers Precedence State
Related-App-Name ..
-----------------------------------------------------------------
cfm-filter 500 500 0 3 OK
cfm-bd-filter 300 300 0 2 OK
Group: 8, Mode: DOUBLE, Hw grps used: 2, Tcam apps: 1
Used Allocated Available Errors
Tcam-Entries 500 512 12 18
Counters 500 1024 524 0
Policers 0 1024 1024 0
App tcam usage:
----------------
App-Name Entries Counters Policers Precedence State
Related-App-Name ..
-----------------------------------------------------------------
fw-l2-in 500 500 0 2 OK
fw-semantics 0 X X 1 OK
1394
Group: 14, Mode: SINGLE, Hw grps used: 1, Tcam apps: 1
Used Allocated Available Errors
Tcam-Entries 200 512 312 0
Counters 200 512 312 0
Policers 100 512 412 0
App tcam usage:
----------------
App-Name Entries Counters Policers Precedence State
Related-App-Name ..
-----------------------------------------------------------------
fw-ifl-in 200 200 100 1 OK
Tcam Resource Stage: Egress
---------------------------
Free [hw-grps: 3 out of 3]
No dynamic tcam usage
To view TCAM resource usage errors for all stages (egress, ingress, and pre-ingress), use the show pfe
tcam errors all-tcam-stages command.
user@host> show pfe tcam errors all-tcam-stages detail
Slot 0
Tcam Resource Stage: Pre-Ingress
--------------------------------
No tcam usage
Tcam Resource Stage: Ingress
----------------------------
Group: 11, Mode: SINGLE, Hw grps used: 3, Tcam apps: 2
Errors Resource-Shortage
Tcam-Entries 0 0
Counters 0 0
Policers 0 0
Group: 8, Mode: DOUBLE, Hw grps used: 2, Tcam apps: 1
Errors Resource-Shortage
Tcam-Entries 18 0
Counters 0 0
Policers 0 0
1395
Group: 14, Mode: SINGLE, Hw grps used: 1, Tcam apps: 1
Errors Resource-Shortage
Tcam-Entries 0 0
Counters 0 0
Policers 0 0
Tcam Resource Stage: Egress
---------------------------
No tcam usage
You can see that all the applications using the TCAM resources are in OK state and indicates that the
hardware has been successfully configured.
NOTE: As shown in the example, you will need to run the show pfe tcam errors and show pfe tcam
usage commands at each step to ensure that your configurations are valid and that the
applications using TCAM resource are in OK state. For ACX5448 routers, use the show pfe filter
hw summary command to view the TCAM resource usage.
Monitoring and Troubleshooting TCAM Resource in ACX Series Routers
The dynamic allocation of Ternary Content Addressable Memory (TCAM) space in ACX Series efficiently
allocates the available TCAM resources for various filter applications. In the dynamic TCAM model,
various filter applications (such as inet-firewall, bridge-firewall, cfm-filters, etc.) can optimally utilize the
available TCAM resources as and when required. Dynamic TCAM resource allocation is usage driven and
is dynamically allocated for filter applications on a need basis. When a filter application no longer uses
the TCAM space, the resource is freed and available for use by other applications. This dynamic TCAM
model caters to higher scale of TCAM resource utilization based on application’s demand. You can use
the show and clear commands to monitor and troubleshoot dynamic TCAM resource usage in ACX
Series routers.
NOTE: Applications using the TCAM resource is termed tcam-app in this document.
Dynamic Ternary Content Addressable Memory Overview shows the task and the commands to monitor
and troubleshoot TCAM resources in ACX Series routers
1396
Table 154: Commands to Monitor and Troubleshoot TCAM Resource in ACX Series
How to Command
View the shared and the related applications for a show pfe tcam app (list-shared-apps | list-related-
particular application.
apps)
View the number of applications across all tcam stages. show pfe tcam usage all-tcam-stages
View the number of applications using the TCAM show pfe tcam usage tcam-stage (ingress | egress |
resource at a specified stage.
pre-egress)
View the TCAM resource used by an application in show pfe tcam usage app  detail