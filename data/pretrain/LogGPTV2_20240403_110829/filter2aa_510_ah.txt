Admin GUI application.
adminCommands:serverRole
The authentication role played by the server. Can be set to:
"standalone"
"domainmember"
"primarydomaincontroller"
Corresponds to the Role pop-up menu in the General pane of 
Windows service settings in the Server Admin GUI application.
domain master
Whether the server is providing domain master browser 
service. Can be set to:
yes | no
Corresponds to the Domain Master Browser checkbox in the 
Advanced pane of Window service settings in the Server 
Admin GUI application.
dos charset
The code page being used. Can be set to:
CP437  (Latin US)
CP737  (Greek)
CP775  (Baltic)
CP850  (Latin1)
CP852  (Latin2)
CP861  (Icelandic)
CP866  (Cyrillic)
CP932  (Japanese SJIS)
CP936  (Simplified Chinese)
CP949  (Korean Hangul)
CP950  (Traditional Chinese)
CP1251  (Windows Cyrillic)
Corresponds to the Code Page pop-up menu on the Advanced 
pane of Windows service settings in the Server Admin GUI 
application.
LL2354.book  Page 82  Monday, October 20, 2003  9:47 AM
Chapter 8    Working With File Services
83
local master
Whether the server is providing workgroup master browser 
service. Can be set to:
yes | no
Corresponds to the Workgroup Master Browser checkbox in 
the Advanced pane of Window service settings in the Server 
Admin GUI application.
log level
The amount of detail written to the service logs. Can be set to:
0  (Low:  errors and warnings only)
1  (Medium:  service start and stop, authentication failures, 
browser name registrations, and errors and warnings)
2  (High:  service start and stop, authentication failures, 
browser name registration events, log file access, and errors 
and warnings)
Corresponds to the Log Detail pop-up menu in the Logging 
pane of Window service settings in the Server Admin GUI 
application
map to guest
Whether guest access is allowed. Can be set to:
"Never"  (No guest access)
"Bad User"  (Allow guest access)
Corresponds to the “Allow Guest access” checkbox in the 
Access pane of Window service settings in the Server Admin 
GUI application
max smbd processes
The maximum allowed number of smb server processes. Each 
connection uses its own smbd process, so this is the same as 
specifying the maximum number of SMB connections.
0  means unlimited.
This corresponds to the “maximum” client connections field in 
the Access pane of the Windows service settings in the Server 
Admin GUI application.
netbios name
The server’s NetBIOS name. Can be set to a maximum of 15 
bytes of UTF-8 characters.
Corresponds to the Computer Name field in the General pane 
of the Windows service settings in the Server Admin GUI 
application.
server string
Text that helps identify the server in the network browsers of 
client computers. Can be set to a maximum of 15 bytes of 
UTF-8 characters.
Corresponds to the Description field in the General pane of the 
Windows service settings in the Server Admin GUI application.
wins support
Whether the server provides WINS support. Can be set to:
yes | no
Corresponds to the WINS Registration “Off” and “Enable WINS 
server” selections in the Advanced pane of the Windows 
service settings in the Server Admin GUI application.
Parameter (smb:)
Description
LL2354.book  Page 83  Monday, October 20, 2003  9:47 AM
84
Chapter 8    Working With File Services
List of SMB serveradmin Commands
You can use these commands with the serveradmin tool to manage SMB service.
Listing SMB Users
You can use the serveradmin getConnectedUsers command to retrieve information 
about connected SMB users. For example, you can use this command to retrieve the 
session IDs you need to disconnect users.
To list connected users:
$serveradmin command smb:command = getConnectedUsers
wins server
The name of the WINS server used by the server.
Corresponds to the WINS Registration “Register with WINS 
server” selection and field in the Advanced pane of the 
Windows service settings in the Server Admin GUI application.
workgroup
The server’s workgroup. Can be set to a maximum of 15 bytes 
of UTF-8 characters.
Corresponds to the Workgroup field in the General pane of the 
Windows service settings in the Server Admin GUI application.
Parameter (smb:)
Description
smb:command=
Description
disconnectUsers
Disconnect SMB users. See “Disconnecting SMB Users” on page 85.
getConnectedUsers
List users currently connected to an SMB service. See “Listing SMB 
Users” on this page.
getHistory
List connection statistics. See “Listing SMB Service Statistics” on 
page 86.
getLogPaths
Show location of service log files. See “Viewing SMB Service Logs” 
on page 87.
syncPrefs
Update the service to recognize changes in share points. See 
“Updating Share Point Information” on page 86.
writeSettings
Equivalent to the standard serveradmin settings command, 
but also returns a setting indicating whether the service needs to 
be restarted. See “Determining Whether a Service Needs to be 
Restarted” on page 19.
LL2354.book  Page 84  Monday, October 20, 2003  9:47 AM
Chapter 8    Working With File Services
85
Output
The following array of settings is displayed for each connected user:
smb:usersArray:_array_index:i:disconnectID = 
smb:usersArray:_array_index:i:sessionID = 
smb:usersArray:_array_index:i:connectAt = 
smb:usersArray:_array_index:i:service = 
smb:usersArray:_array_index:i:loginElapsedTime = 
smb:usersArray:_array_index:i:name = ""
smb:usersArray:_array_index:i:ipAddress = ""
Disconnecting SMB Users
You can use the serveradmin disconnectUsers command to disconnect SMB users. 
Users are specified by session ID.
To disconnect users:
$ sudo serveradmin command
smb:command = disconnectUsers
smb:sessionIDsArray:_array_index:0 = sessionid1
smb:sessionIDsArray:_array_index:1 = sessionid2
smb:sessionIDsArray:_array_index:2 = sessionid3
[...]
Control-D
Output
smb:command = "disconnectUsers"
smb:status = 
Value returned by getConnectedUsers
(smb:usersArray:_array_index::)
Description
An integer that identifies the user session.
The date and time when the user connected to 
the server.
The share point the user is accessing.
The elapsed time since the user connected.
The user’s name.
The user’s IP address.
Parameter
Description
sessionidn
The session ID of a user you want to disconnect. To list the session 
IDs of connected users, use the getConnectedUsers 
command. See “Listing SMB Users” on page 84.
Value
Description
A command status code:
0 = command successful
LL2354.book  Page 85  Monday, October 20, 2003  9:47 AM
86
Chapter 8    Working With File Services
Listing SMB Service Statistics
You can use the serveradmin getHistory command to display a log of periodic 
samples of the number of SMB connections. Samples are taken once each minute.
To list samples:
$ sudo serveradmin command
smb:command = getHistory
smb:variant = v1
smb:timeScale = scale
Control-D
Output
smb:nbSamples = 
smb:samplesArray:_array_index:0:vn = 
smb:samplesArray:_array_index:0:t = 
smb:samplesArray:_array_index:1:vn = 
smb:samplesArray:_array_index:1:t = 
[...]
smb:samplesArray:_array_index:i:vn = 
smb:samplesArray:_array_index:i:t = 
smb:v1Legend = "CONNECTIONS"
smb:currentServerTime = 
Updating Share Point Information
After you make a change to an SMB share point using the sharing tool, you need to 
update the SMB service information.
To update SMB share point information:
$ sudo serveradmin command smb:command = syncPrefs
Parameter
Description
v1
The number of connected users (average during sampling period).
scale
The length of time in seconds, ending with the current time, for 
which you want to see samples. For example, to see 30 minutes of 
data, you would specify smb:timeScale = 1800.
Value displayed by getHistory
Description
The total number of samples listed.
A textual description of the selected statistic. 
"CONNECTIONS" for v1
"THROUGHPUT" for v2
The numerical value of the sample.
For connections (v1), this is integer average number of users.
For throughput, (v2), this is integer bytes per second.
The time at which the sample was measured. A standard UNIX time 
(number of seconds since Sep 1, 1970.) Samples are taken every 60 
seconds.
LL2354.book  Page 86  Monday, October 20, 2003  9:47 AM
Chapter 8    Working With File Services
87
Viewing SMB Service Logs
You can use tail or any other file listing tool to view the contents of the SMB service 
logs.
To view the latest entries in a log:
$ tail log-file
You can use the serveradmin getLogPaths command to see where the current SMB 
logs are located.
To display the log paths:
$ sudo serveradmin command smb:command = getLogPaths
Output
smb:fileServiceLog = 
smb:nameServiceLog = 
Value
Description
The location of the SMB service log. Default = 
/var/log/samba/log.smbd
The location of the name service log. Default = 
/var/log/samba/log.nmbd
LL2354.book  Page 87  Monday, October 20, 2003  9:47 AM
LL2354.book  Page 88  Monday, October 20, 2003  9:47 AM
9
89
9 Working With Print Service
Commands you can use to manage the Print service in 
Mac OS X Server.
Starting and Stopping Print Service
To start Print service:
$ sudo serveradmin start print
To stop Print service:
$ sudo serveradmin stop print
Checking the Status of Print Service
To see summary status of Print service:
$ sudo serveradmin status print
To see detailed status of Print service:
$ sudo serveradmin fullstatus print
Viewing Print Service Settings
To list Print service configuration settings:
$ sudo serveradmin settings print
To list a particular setting:
$ sudo serveradmin settings print:setting
To list a group of settings:
You can list a group of settings that have part of their names in common by typing 
only as much of the name as you want, stopping at a colon (:), and typing an asterisk 
(*) as a wildcard for the remaining parts of the name. For example, to see all settings for 
a particular print queue:
$ sudo serveradmin settings print:queuesArray:_array_id:queue-id:*
where queue-id is an id such as 66F66AdA-060B-5603-9024-FCB57AAB24B1.
LL2354.book  Page 89  Monday, October 20, 2003  9:47 AM
90
Chapter 9    Working With Print Service
Changing Print Service Settings
To change a setting:
$ sudo serveradmin settings print:setting = value
To change several settings:
$ sudo serveradmin settings
print:setting = value
print:setting = value
print:setting = value
[...]
Control-D
Print Service Settings
Use the following parameters with the serveradmin command to change settings for 
the Print service.
Parameter
Description
setting
A Print service setting. To see a list of available settings, type
$ sudo serveradmin settings print
or see “Print Service Settings” on this page.
value
An appropriate value for the setting.
Parameter (print:)
Description
serverLogArchiveIntervalDays
Default = 7
See “Queue Data Array” on page 91.
serverLogArchiveEnable
Default = no
jobLogArchiveIntervalDays
Default = 7
jobLogArchiveEnable
Default = no
LL2354.book  Page 90  Monday, October 20, 2003  9:47 AM
Chapter 9    Working With Print Service
91
Queue Data Array
Print service settings include an array of values for each existing print queue. The array 
is a set of 14 parameters that define values for each queue.
 is the queue ID, for example, 29D3ECF3-17C8-16E5-A330-84CEC733F249.
Parameter (print:)
Description
queuesArray:_array_id::
quotasEnforced
Default = no
queuesArray:_array_id::
sharingList:_array_index:0:
service
Default = "LPR"
queuesArray:_array_id::
sharingList:_array_index:0:
sharingEnable
Default = no
queuesArray:_array_id::
sharingList:_array_index:1:
service
Default = "SMB"
queuesArray:_array_id::
sharingList:_array_index:1:
sharingEnable
Default = no
queuesArray:_array_id::
sharingList:_array_index:2:
service
Default = "PAP"
queuesArray:_array_id::
sharingList:_array_index:2:
sharingEnable
Default = no
queuesArray:_array_id::
shareable
Default = yes.
Cannot be changed.
queuesArray:_array_id::
defaultJobPriority
Not used.
Default = "NORMAL"
queuesArray:_array_id::
printerName
Default = ""
Cannot be changed using serveradmin.
queuesArray:_array_id::
defaultJobState
Not used.
Default = "PENDING"
queuesArray:_array_id::
printerURI
Default = 
Format depends on type of printer.
Cannot be changed using serveradmin.
queuesArray:_array_id::
registerRendezvous
Default = yes
queuesArray:_array_id::
printerKind
Default = ""
Cannot be changed using serveradmin.
queuesArray:_array_id::
sharingName
Default = ""
LL2354.book  Page 91  Monday, October 20, 2003  9:47 AM
92
Chapter 9    Working With Print Service
Here is an example of a queue array parameter block:
print:queuesArray:_array_id:29D3ECF3-17C8-16E5-A330-
84CEC733F249:quotasEnforced = no
print:queuesArray:_array_id:29D3ECF3-17C8-16E5-A330-
84CEC733F249:sharingList:_array_index:0:service = "LPR"
print:queuesArray:_array_id:29D3ECF3-17C8-16E5-A330-
84CEC733F249:sharingList:_array_index:0:sharingEnable = no
print:queuesArray:_array_id:29D3ECF3-17C8-16E5-A330-
84CEC733F249:sharingList:_array_index:1:service = "SMB"
print:queuesArray:_array_id:29D3ECF3-17C8-16E5-A330-
84CEC733F249:sharingList:_array_index:1:sharingEnable = no
print:queuesArray:_array_id:29D3ECF3-17C8-16E5-A330-
84CEC733F249:sharingList:_array_index:2:service = "PAP"
print:queuesArray:_array_id:29D3ECF3-17C8-16E5-A330-
84CEC733F249:sharingList:_array_index:2:sharingEnable = no
print:queuesArray:_array_id:29D3ECF3-17C8-16E5-A330-84CEC733F249:shareable = 
yes
print:queuesArray:_array_id:29D3ECF3-17C8-16E5-A330-
84CEC733F249:defaultJobPriority = "NORMAL"
print:queuesArray:_array_id:29D3ECF3-17C8-16E5-A330-84CEC733F249:printerName 
= "Room 3 Printer"
print:queuesArray:_array_id:29D3ECF3-17C8-16E5-A330-
84CEC733F249:defaultJobState = "PENDING"
print:queuesArray:_array_id:29D3ECF3-17C8-16E5-A330-84CEC733F249:printerURI 
= "pap://*/Room%203%20Printer/LaserWriter"
print:queuesArray:_array_id:29D3ECF3-17C8-16E5-A330-
84CEC733F249:registerRendezvous = yes
print:queuesArray:_array_id:29D3ECF3-17C8-16E5-A330-84CEC733F249:printerKind 
= "HP LaserJet 4100 Series "
print:queuesArray:_array_id:29D3ECF3-17C8-16E5-A330-84CEC733F249:sharingName 
= "Room 3 Printer"
LL2354.book  Page 92  Monday, October 20, 2003  9:47 AM
Chapter 9    Working With Print Service
93
Print Service serveradmin Commands
You can use the following commands with the serveradmin application to manage 
Print service.
Listing Queues
You can use the serveradmin getQueues command to list Print service queues.
$ sudo serveradmin command print:command = getQueues
Pausing a Queue
You can use the serveradmin setQueueState command to pause or release a queue.
To pause a queue:
$ sudo serveradmin command
print:command = setQueueState
print:status = PAUSED
print:namesArray:_array_index:0 = queue
Control-D
To release the queue:
$ sudo serveradmin command
print:command = setQueueState
print:status = ""
print:namesArray:_array_index:0 = queue
Control-D
print:command=
Description
getJobs
List information about the jobs waiting in a queue. See “Listing 
Jobs and Job Information” on page 94.
getLogPaths
Finding the locations of the Print service and job logs. See “Viewing 
Print Service Log Files” on page 95.
getQueues
List Print service queues. See “Listing Queues” on this page.
setJobState
Hold or release a job. See “Holding a Job” on page 94.
setQueueState
Pauses or release a queue. See “Pausing a Queue” on this page.
writeSettings
Equivalent to the standard serveradmin settings command, 
but also returns a setting indicating whether the service needs to 
be restarted. See “Determining Whether a Service Needs to be 
Restarted” on page 19.
Parameter
Description
queue
The name of the queue. To find the name of the queue, use the 
getQueues command and look for the value of the print 
setting. See “Listing Queues” on this page.
LL2354.book  Page 93  Monday, October 20, 2003  9:47 AM
94
Chapter 9    Working With Print Service
Listing Jobs and Job Information
You can use the serveradmin getJobs command to list information about print jobs.
$ sudo serveradmin command
print:command = getJobs
print:maxDisplayJobs = jobs
print:queueNamesArray:_array_index:0 = queue
Control-D
For each job, the command lists:
• Document name
• Number of pages
• Document size
• Number of sheets
• Job ID
• Submitting user
• Submitting host
• Job name