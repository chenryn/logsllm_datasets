L=8
L=16
)
p
(
f
/
]
)
0
(
X
E
[
t
u
p
h
g
u
o
r
h
t
d
e
z
i
l
a
m
r
o
N
0
_
a
t
e
h
t
h
f
o
V
C
d
e
r
a
u
q
S
1.1
1.08
1.06
1.04
1.02
1
0.98
0.96
0.94
0.25
0.2
0.15
0.1
0.05
SQRT
PFTK-standard
PFTK-simplified
0
0.05
0.1
0.15
0.2
0.25
Loss Event Ratio p
SQRT
PFTK-standard
PFTK-simplified
0.05
0.1
0.15
0.2
0.25
Loss Event Ratio p
0
0
0.02
0.04
0.06
0.08
Loss Event Ratio p
0.1
0.12
0.14
Figure 13: Upper graph shows normalized throughput versus
the loss event ratio as attained by a source with constant packet
rate, but controlled packet sizes. The connection goes through
a loss module where packet loss occurs. The length of the loss
event interval estimator is L = 4. The lower graph shows
squared coefﬁcient of variation of (ˆθn)n.
1.1
1
0.9
0.8
0.7
0.6
0.5
0.4
0.3
0
0.1
0.05
0
-0.05
)
p
(
f
/
]
)
0
(
X
E
[
t
u
p
h
g
u
o
r
h
t
d
e
z
i
l
a
m
r
o
N
]
0
_
a
t
e
h
t
,
h
0
_
a
t
e
h
t
[
v
o
C
d
e
z
i
l
a
m
r
o
N
-0.1
0
0.02
0.04
0.06
0.08
Loss Event Ratio p
0.1
L=2
L=4
L=8
L=16
0.12
0.14
Figure 12: Same setting as with Fig. 10, but function f is SQRT.
(cid:2)
ration of timescales argument; we assume the congestion process
evolves more slowly than the timescale of the control (remember
that the control is clocked by the loss events). We base our further
discussion on this limit loss event ratio, i.e.
¯pi ¯xiπi
¯xiπi
(cid:2)
(cid:2)
¯p →
(15)
.
i∈E
i∈E
If our source is non-adaptive (call it “Poisson”) then ¯xi = ¯x is
independent of i. The resulting loss event ratio ¯pP =
i∈E πi ¯pi
can be thought of as the time-average of the network loss event ra-
tio; except for possible aliasing effects, it should be close to what a
constant bit rate (CBR) source would experience. Now if, like TCP,
our source is very responsive, i.e., follows the hidden congestion
process pretty closely, then ¯xi depends on i in the following way:
¯xi is large for “good” states (¯pi small) and small for bad states (¯pi
large). Thus we should have a smaller ¯p. For TCP, this is conﬁrmed
by measurements in [14]. The more responsive the source is, the
more pronounced this should be; now TCP is expected be more re-
sponsive than our adaptive source, whose responsiveness depends
on the averaging window L. We summarize this as follows (see
Fig. 15 for an illustration).
CLAIM 3. The loss event ratios for TCP (¯pT ), our adaptive
equation based rate controlled source (¯pE), and a non-adaptive
source (Poisson) (¯pP ) should be in the relation
¯pT ≤ ¯pE ≤ ¯pP .
The more responsive source E is, the closer ¯pE should be to ¯pT .
SQRT
PFTK-standard
PFTK-simplified
0
0.05
0.1
0.15
0.2
0.25
Loss Event Ratio p
)
p
(
f
/
]
)
0
(
X
E
[
t
u
p
h
g
u
o
r
h
t
d
e
z
i
l
a
m
r
o
N
0
_
a
t
e
h
t
h
f
o
V
C
d
e
r
a
u
q
S
1.1
1.08
1.06
1.04
1.02
1
0.98
0.96
0.94
0.25
0.2
0.15
0.1
0.05
SQRT
PFTK-standard
PFTK-simplified
0.05
0.1
0.15
0.2
0.25
Loss Event Ratio p
0
0
Figure 14: Same setting as in Fig. 13, but with the length of the
loss event interval estimator L = 8.
5.2 Putting Things Together
Claim 3 tells us that our adaptive source sees a higher loss event
ratio than TCP, which drives it in the TCP-friendly direction, on
top and above the factors mentioned earlier. Assuming (as is most
common) that the conditions for conservativeness in Section 3 ap-
ply, we would have ¯xA ≤ f (¯pE) ≤ f (¯pT ), (the latter is because f
is decreasing). This makes our adaptive source TCP-friendly under
the assumption that TCP does satisfy its equation. Unfortunately,
this is only approximately true. Fig. 16 shows an experiment where
TCP is below the formula PFTK-standard for light load and above
for high loads. Fig. 17 shows that, as a result, TFRC ﬂows have
higher throughput for medium load than TCP. This is in spite of
TFRC being conservative (Fig. 9) and experiencing higher loss than
TCP (Fig. 15), as predicted by our theory. This illustrates the im-
portance of separating the 3 factors identiﬁed in this paper.
113L=2 (TFRC)
L=2 (TCP)
L=2 (Poisson)
L=4 (TFRC)
L=4 (TCP)
L=4 (Poisson)
L=8 (TFRC)
L=8 (TCP)
L=8 (Poisson)
L=16 (TFRC)
L=16 (TCP)
L=16 (Poisson)
0.14
0.12
0.1
0.08
0.06
0.04
0.02
p
o
i
t
a
R
t
n
e
v
E
s
s
o
L
0
0
50
100
200
Number of TFRC and TCP Connections
150
250
300
Figure 15: Loss event ratio as experienced by TFRC, TCP, and
Poisson connections versus N (number of TFRC and number
TCP connections in one bottleneck). We have ¯pT ≤ ¯pE ≤ ¯pP
as expected. Also, the smoother the TFRC ﬂows (larger L), the
higher the loss event ratio.
6. CONCLUSION
Our study should help designers of TCP-friendly equation-based
rate control better understand the trade-offs that have to be taken.
First, it is important to separately verify the three elements: (1)
conservativeness, (2) TCP loss event ratio versus this protocol’s
loss event ratio, and (3) TCP’s obedience to its own formula. Fail-
ing to do so blurs the setting of parameters. Second, one should be
aware of the strong dependency on the nature of function f; SQRT
behaves differently than PFTK. If PFTK is used, and under some
conditions on the loss process deﬁned in Claim 1, very pronounced
conservativeness should be expected for heavy loss. Under some
other conditions (Claim 2), the opposite may hold. In any case, the
more variable the estimator is, the more pronounced the effect is.
This might lead a protocol designer to change some parameters of
her protocol, in order to correct either effect. Understanding why
and when the effects occur is essential to avoid undesired correc-
tions. By their general nature, and because they are based on anal-
ysis, our results should apply to a large class of situations including
dynamically varying environments.
There are three directions for further work. First, our ﬁndings
should be confronted with measurements; in particular, the autoco-
variance property of loss event intervals will be of interest. Second,
the impact of the variation of round trip time needs to be incorpo-
rated; this can be done using the same approach as we used for the
other factors. Third, we focused in this paper on the relation be-
tween loss event ratio and throughput, leaving aside any prediction
of which values these variables may take, in a given setting; it will
be interesting to study this in more detail, in particular the existence
of stable points.
7. ACKNOWLEDGEMENTS
We would like to thank Chadi Barakat and Catherine Boutre-
mans for sharing with us their ns simulator expertise. We also thank
anonymous reviewers for their valuable comments.
)
c
e
s
/
s
t
k
p
(
e
c
r
u
o
S
1
k
c
a
S
P
C
T
r
o
-
f
]
)
0
(
X
E
[
250
200
150
100
50
0
0
Average for a Single Connection
Average over the Connections
50
100
150
200
250
f(p) (pkts/sec)
Figure 16: f (¯p) for PFTK-standard formula versus ¯x =
E[X(0)] for TCP Sack1 sources. For medium throughputs,
TCP Sack1 is below the formula.
8. REFERENCES
[1] Francois Baccelli and Pierre Br´emaud. Elements of Queueing
Theory, volume 26. Applications of Mathematics, Springer-Verlag,
1991.
[2] Deepak Bansal, Hari Balakrishnan, Sally Floyd, and Scott Shenker.
Dynamic Behavior of Slowly-responsive Congestion Control
Algorithms. In Proc. of ACM Sigcomm’01, San Diego, California,
USA, August 2001.
[3] C. Barakat. TCP/IP Modeling and Validation. IEEE Network,
15(3):38–47, May-June 2001.
[4] C. Boutremans and J.-Y. Le Boudec. Adaptive Delay Aware Error
Control for Internet Telephony. In Proc. of 2nd IP-Telephony
Workshop, pages 81–92, Columbia University, New York, April
2001.
[5] Neal Cardwell, Stefan Savage, and Thomas Anderson. Modeling
TCP Latency. In Proc. of the IEEE INFOCOM’2000, Tel-Aviv,
Israel, March 2000.
[6] William Feller. An Introduction to Probablity Theory and Its
Applications, volume 2. John-Wiley & Sons, 2 edition, 1966.
[7] Sally Floyd. Best Control Principles, September 2000. rfc-2914,
www.ietf.org.
[8] Sally Floyd and Kevin Fall. Promoting the Use of End-to-end