日志分析之昨天今天与明天 
关于我 
• 安全爱好者 
• 安全防御研究 
• 2012-2015 当当网 网信金融 
• 2015-今 万达电商 
日志的价值 
我们遇到的日志 
议程 
• 昨天 
• 今天 
• 明天 
昨天 
• 那些年，还是iis的天下 
• 0day? 
• 注入，我喜欢    :) 
向当年的软件作者致敬 
• awk 
• grep 
• wc 
• uniq 
• sort 
• 统计top n 
• 关键字过滤 
确定入侵时间 
状态码过滤 
类型过滤 
IP分析 
确定入侵文件 
IP访问 
确定时间 
状态码过滤 
–Johnny Appleseed 
日志展示界面（可视化） 
今天 
• 文件上传 
• 平行权限 
• LFI 
• 命令执行 
• Nday 
工具 
E.L.K 
FLUME 
FLUTEND 
• 频率分析 
• 关联分析 
频率分析 
基线与伐值 
数据值 
• IP 访问次数 
• url 被访问次数  
url深度 
200比例 
反问离散度 
url 参数 
关联分析 
IDS 
日志 
FW 
扫描器 
关联分析 
IP 关联 
• Event E1 
• Event E2 
• E2.Srcip==E1.Dstip 
NIDS 发现有webshell连接，同时HIDS 发现文件变更操作 
状态关联 
• Event E1 
• Event E2 
• E2.somestatus is success (or something) 
• 基于漏洞关联 
• 基于特征关联 
• 基于异常关联 
了解攻击者 
• 什么时间 
• 访问了哪些站点 
• 做了什么 
• 是否成功 
• 水平如何  
• 采用了什么技术 （代理 扫描器 手工？自动。。。
） 
更加强力的工具 
来自唯品会：孟诚 
• 入侵不一定在时间上是连续的 
• 日志的存储 
• 特征值更新 
明天 
• APT 
• 0Day 
• 未知威胁 
关联分析优缺点 
• 优点：准确，误报率低 
• 缺点：完全依靠经验 
创建规则 
发现攻击 
建立模型 
分析攻击  
• 弥补关联分析的不足 
• 感知异常 
• 将更多的精力用在更重要的地方 
URL特性 
访问频率 
GEOIP/PROX
Y 
访问内容 
….. 
日志 
结果 
U
R
L
特
性 
访
问
频
率 
G
E
O
IP
/P
R
O
X
Y 
访
问
内
容 
…
.. 
日
志 
结
果 
U
R
L
特
性 
访
问
频
率 
G
E
O
IP
/P
R
O
X
Y 
访
问
内
容 
…
.. 
日
志 
结
果 
U
R
L
特
性 
访
问
频
率 
G
E
O
IP
/P
R
O
X
访
问
内
容 
…
.. 
日
志 
结
果 
U
R
L
特
性 
访
问
频
率 
G
E
O
IP
/P
R
O
X
访
问
内
容 
…
.. 
日
志 
结
果 
URL特性 
访问频率 
GEOIP/PROX
Y 
访问内容 
….. 
日志 
结果 
机器学习 
• 贝叶斯 
来自 腾讯  －－江虎 
机器学习 
• 预测sql注入 
机器学习 
• 预测机器注册 
• SVM 
• K-means 
• HMM 
• 决策树 
格式化／去噪音 
获取数据 
数据分析 
结果 
计算 
回馈 
Thank you ! 
PI:EMAIL