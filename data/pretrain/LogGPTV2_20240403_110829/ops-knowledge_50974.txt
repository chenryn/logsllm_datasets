User: 请回答以下安全问题允许用户输入HTML的安全子集我最近在代码审查上发布了这个问题，建议我向你们询问。
基本上，这将用于允许用户生成格式化的内容。它被放在HTML标记中，所以我不必担心攻击者会破坏属性。如果这还不清楚，下面是一个例子：
&lt；div&gt；
生成的内容
&lt/div&gt；
编辑：我没有将内容插入到属性中，所以转义引号不是一个问题。我知道我仍然需要检查用户生成的内容中是否有不好的属性，这就是脚本的大部分内容。
我已经确定我很容易受到攻击者发布恶意链接或跟踪图片的攻击，但我愿意接受这一点。我认为如果没有白名单URL，你无法阻止这种情况的发生，这也会大大减少用户的自由度。如果有一种可行的方法来修复这个漏洞，我很想听听。
我已经阅读了OWASP XSS的备忘单，我想我已经涵盖了所有这些基础。
除了那张备忘单，我还有什么要担心的？我错过了什么吗？我的代码经得起未来考验吗？我是不是有点过头了？我应该直接切换到BBCode还是Markup？
当前代码

Assistant: 在白名单的过程中，你走的是正确的道路，但实现它的防弹是很棘手的。
也就是说，你的链接可以被愚弄来执行JS，只需写：
&lt；a href=“JAVASCRIPT:xxx”&gt；xss&lt/a&gt；
此外，特别是较旧的浏览器可能会在img src等中执行JS。
我建议你使用HTMLPurifier，除了XSS，它还可以帮助你处理损坏的HTML（标签嵌套等）。