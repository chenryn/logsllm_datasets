ğ‘š,ğ‘)) âŠ— (âƒ—ğ‘ğ‘ Â· ğœ (âƒ—ğ‘ğ‘¡
ğ‘)))
= ğ¼ğ‘š/ğ‘ âŠ— ğ‘ Â· Trğ‘,1(âƒ—ğ‘ğ‘ Â· âƒ—ğ‘ğ‘¡
ğ‘)
= ğ¼ğ‘š/ğ‘ âŠ— (ğ¼ğ‘âˆ’1 + 1) .
3.3.2 Two-Index Transforms and Values
We now consider transforms and special values relating the ğ‘šth and ğ‘šâ€²th cyclotomic
rings, for ğ‘š|ğ‘šâ€². These are used for computing the embed and twace functions, the relative
powerful basis, and the relative CRT set.
Prime-Power Factorization
As in the subsection 3.3.1, every transform of interest for arbitrary ğ‘š|ğ‘šâ€² factors into the
tensor product of the corresponding transforms for prime-power indices having the same
prime base. More speciï¬cally, let ğ‘‡ğ‘š,ğ‘šâ€² denote the matrix of any of the linear transforms
67
we consider below. Suppose we have factorization ğ‘š = âˆï¸€
â„“ where
â„“ is a power of a distinct prime ğ‘â„“ (so some ğ‘šâ„“ may be 1). Then we have the
â„“ ğ‘šâ„“, ğ‘šâ€² = âˆï¸€
â„“ ğ‘šâ€²
each ğ‘šâ„“, ğ‘šâ€²
factorization
â¨‚ï¸
ğ‘‡ğ‘š,ğ‘šâ€² =
ğ‘‡ğ‘šâ„“,ğ‘šâ€²
â„“
,
â„“
which follows directly from the Kronecker-product factorizations of the powerful and
decoding bases, and the mixed-product property. Therefore, from this point onward we deal
only with prime-power indices ğ‘š = ğ‘ğ‘’, ğ‘šâ€² = ğ‘ğ‘’â€² for a prime ğ‘ and integers ğ‘’â€² > ğ‘’ â‰¥ 0.
We mention that for the transforms we consider below, the fully expanded matrices ğ‘‡ğ‘š,ğ‘šâ€²
have very compact representations and can be applied directly to the input vector, without
computing a sequence of intermediate vectors via the sparse decomposition. For efï¬ciency,
our implementation does exactly this.
Coefï¬cients in Relative Bases
We start with transforms that let us represent elements with respect to relative bases, i.e., to
represent an element of the ğ‘šâ€²th cyclotomic as a vector of elements in the ğ‘šth cyclotomic,
with respect to a relative basis. Due to the Kronecker-product structure of the powerful,
decoding, and CRT bases, it turns out that the same transformation works for all of them.
The coeffs method of Tensor implements this transformation.
One can verify the identity (âƒ—ğ‘¥ âŠ— âƒ—ğ‘¦)ğ‘¡ Â· a = âƒ—ğ‘¥ğ‘¡ Â· ğ´ Â· âƒ—ğ‘¦, where ğ´ is the â€œmatricizationâ€ of
the vector a, whose rows are (the transposes of) the consecutive dim(âƒ—ğ‘¦)-dimensional blocks
of a. Letting âƒ—ğ‘â„“ denote either the powerful, decoding, or CRT basis in the â„“th cyclotomic,
which has factorization âƒ—ğ‘ğ‘šâ€² = âƒ—ğ‘ğ‘šâ€²,ğ‘š âŠ— âƒ—ğ‘ğ‘š, we have
ğ‘šâ€² Â· a = âƒ—ğ‘ğ‘¡
âƒ—ğ‘ğ‘¡
ğ‘šâ€²,ğ‘š Â· (ğ´ Â· âƒ—ğ‘ğ‘š).
68
Therefore, ğ´ Â·âƒ—ğ‘ğ‘š is the desired vector of ğ‘…-coefï¬cients of ğ‘ = âƒ—ğ‘ğ‘¡
ğ‘šâ€² Â· a âˆˆ ğ‘…â€². In other words,
the ğœ™(ğ‘š)-dimensional blocks of a are the coefï¬cient vectors (with respect to basis âƒ—ğ‘ğ‘š) of
the ğ‘…-coefï¬cients of ğ‘ with respect to the relative basis âƒ—ğ‘ğ‘šâ€²,ğ‘š.
Embed Transforms
We now consider transforms that convert from a basis in the ğ‘šth cyclotomic to the same
type of basis in the ğ‘šâ€²th cyclotomic. That is, for particular bases âƒ—ğ‘ğ‘šâ€²,âƒ—ğ‘ğ‘š of the ğ‘šâ€²th and
ğ‘šth cyclotomics (respectively), we write
âƒ—ğ‘ğ‘¡
ğ‘š = âƒ—ğ‘ğ‘¡
ğ‘šâ€² Â· ğ‘‡
for some integer matrix ğ‘‡ . So embedding a ring element from the ğ‘šth to the ğ‘šâ€²th cyclotomic
(with respect to these bases) corresponds to left-multiplication by ğ‘‡ . The embedB methods
of Tensor, for B âˆˆ {Pow, Dec, CRT}, implement these transforms.
We start with the powerful basis. Because âƒ—ğ‘ğ‘šâ€² = âƒ—ğ‘ğ‘šâ€²,ğ‘š âŠ— âƒ—ğ‘ğ‘š and the ï¬rst entry of âƒ—ğ‘ğ‘šâ€²,ğ‘š
is unity,
âƒ—ğ‘ğ‘¡
ğ‘š = (âƒ—ğ‘ğ‘¡
= âƒ—ğ‘ğ‘¡
ğ‘š Â· ğ¼ğœ™(ğ‘š))
ğ‘šâ€²,ğ‘š Â· e1) âŠ— (âƒ—ğ‘ğ‘¡
ğ‘šâ€² Â· (e1 âŠ— ğ¼ğœ™(ğ‘š)) ,
where e1 = (1, 0, . . . , 0) âˆˆ Zğœ™(ğ‘šâ€²)/ğœ™(ğ‘š). Note that (e1 âŠ— ğ¼ğœ™(ğ‘š)) is the identity matrix stacked
on top of an all-zeros matrix, so left-multiplication by it simply pads the input vector by
zeros.
For the decoding bases âƒ—ğ‘‘ğ‘šâ€², âƒ—ğ‘‘ğ‘š, an identical derivation holds when ğ‘š > 1, because
ğ‘ Â· v, where
âƒ—ğ‘‘ğ‘šâ€² = âƒ—ğ‘ğ‘šâ€²,ğ‘š âŠ— âƒ—ğ‘‘ğ‘š. Otherwise, we have âƒ—ğ‘‘ğ‘šâ€² = âƒ—ğ‘ğ‘šâ€²,ğ‘ âŠ— âƒ—ğ‘‘ğ‘ and âƒ—ğ‘‘ğ‘¡
ğ‘š = (1) = âƒ—ğ‘‘ğ‘¡
69
v = (1,âˆ’1, 0, . . . , 0) âˆˆ Zğœ™(ğ‘). Combining these cases, we have
ğ‘š = âƒ—ğ‘‘ğ‘¡
âƒ—ğ‘‘ğ‘¡
ğ‘šâ€² Â·
â§âªâªâ¨âªâªâ©e1 âŠ— ğ¼ğœ™(ğ‘š)
e1 âŠ— v
if ğ‘š > 1
if ğ‘š = 1.
For the CRT bases âƒ—ğ‘ğ‘šâ€², âƒ—ğ‘ğ‘š, because âƒ—ğ‘ğ‘š = âƒ—ğ‘ğ‘šâ€²,ğ‘š âŠ— âƒ—ğ‘ğ‘š and the sum of the elements of
any (relative) CRT basis is unity, we have
ğ‘š = (âƒ—ğ‘ğ‘¡
âƒ—ğ‘ğ‘¡
ğ‘š Â· ğ¼ğœ™(ğ‘š))
ğ‘šâ€²,ğ‘š Â· 1) âŠ— (âƒ—ğ‘ğ‘¡
ğ‘šâ€² Â· (1 âŠ— ğ¼ğœ™(ğ‘š)) .
= âƒ—ğ‘ğ‘¡
Notice that (1 âŠ— ğ¼ğœ™(ğ‘š)) is just a stack of identity matrices, so left-multiplication by it just
stacks up several copies of the input vector.
Finally, we express the relative powerful basis âƒ—ğ‘ğ‘šâ€²,ğ‘š with respect to the powerful
basis âƒ—ğ‘ğ‘šâ€²; this is used in the powBasisPow method of Tensor. We simply have
âƒ—ğ‘ğ‘¡
ğ‘šâ€²,ğ‘š = (âƒ—ğ‘ğ‘¡
ğ‘šâ€²,ğ‘š Â· ğ¼ğœ™(ğ‘šâ€²)/ğœ™(ğ‘š)) âŠ— (âƒ—ğ‘ğ‘š Â· e1)
ğ‘šâ€² Â· (ğ¼ğœ™(ğ‘šâ€²)/ğœ™(ğ‘š) âŠ— e1) .
= âƒ—ğ‘ğ‘¡
Twace Transforms
We now consider transforms that represent the twace function from the ğ‘šâ€²th to the ğ‘šth
cyclotomic for the three basis types of interest. That is, for particular bases âƒ—ğ‘ğ‘šâ€²,âƒ—ğ‘ğ‘š of the
ğ‘šâ€²th and ğ‘šth cyclotomics (respectively), we write
Twğ‘šâ€²,ğ‘š(âƒ—ğ‘ğ‘¡
ğ‘šâ€²) = âƒ—ğ‘ğ‘¡
ğ‘š Â· ğ‘‡
70
for some integer matrix ğ‘‡ , which by linearity of twace implies
Twğ‘šâ€²,ğ‘š(âƒ—ğ‘ğ‘¡
ğ‘šâ€² Â· v) = âƒ—ğ‘ğ‘¡
ğ‘š Â· (ğ‘‡ Â· v).
In other words, the twace function (relative to the these bases) corresponds to left-multiplication
by ğ‘‡ . The twacePowDec and twaceCRT methods of Tensor implement these transforms.
To start, we claim that
Twğ‘šâ€²,ğ‘š(âƒ—ğ‘ğ‘šâ€²,ğ‘š) = Twğ‘šâ€²,ğ‘š(âƒ—ğ‘‘ğ‘šâ€²,ğ‘š) = e1 âˆˆ Zğœ™(ğ‘šâ€²)/ğœ™(ğ‘š).
(3.3.4)
This holds for âƒ—ğ‘‘ğ‘šâ€²,ğ‘š because it is dual to (conjugated) âƒ—ğ‘ğ‘šâ€²,ğ‘š under Twğ‘šâ€²,ğ‘š, and the ï¬rst
entry of âƒ—ğ‘ğ‘šâ€²,ğ‘š is unity. It holds for âƒ—ğ‘ğ‘šâ€²,ğ‘š because âƒ—ğ‘ğ‘šâ€²,ğ‘š = âƒ—ğ‘‘ğ‘šâ€²,ğ‘š for ğ‘š > 1, and for ğ‘š = 1
one can verify that
Twğ‘šâ€²,1(âƒ—ğ‘ğ‘šâ€²,1) = Twğ‘,1(Twğ‘šâ€²,ğ‘(âƒ—ğ‘ğ‘šâ€²,ğ‘) âŠ— âƒ—ğ‘ğ‘,1) = (1, 0, . . . , 0) âŠ— Twğ‘,1(âƒ—ğ‘ğ‘,1) = e1.
Now for the powerful basis, by linearity of twace and Equation (3.3.4) we have
Twğ‘šâ€²,ğ‘š(âƒ—ğ‘ğ‘¡
ğ‘šâ€²) = Twğ‘šâ€²,ğ‘š(âƒ—ğ‘ğ‘¡
ğ‘šâ€²,ğ‘š) âŠ— âƒ—ğ‘ğ‘¡
ğ‘š Â· ğ¼ğœ™(ğ‘š))
ğ‘š
= (1 Â· eğ‘¡
ğ‘š Â· (eğ‘¡
1) âŠ— (âƒ—ğ‘ğ‘¡
1 âŠ— ğ¼ğœ™(ğ‘š)) .
= âƒ—ğ‘ğ‘¡
An identical derivation holds for the decoding basis as well. Notice that left-multiplication
by the matrix (eğ‘¡
1 âŠ— ğ¼ğœ™(ğ‘š)) just returns the ï¬rst ğœ™(ğ‘šâ€²)/ğœ™(ğ‘š) entries of the input vector.
Finally, we consider the CRT basis. Because ğ‘”ğ‘šâ€² = ğ‘”ğ‘ (recall that ğ‘šâ€² â‰¥ ğ‘), by deï¬nition
of twace in terms of trace we have
Twğ‘šâ€²,ğ‘š(ğ‘¥) = ( Ë†ğ‘š/ Ë†ğ‘šâ€²) Â· ğ‘”âˆ’1
ğ‘š Â· Trğ‘šâ€²,ğ‘š(ğ‘”ğ‘ Â· ğ‘¥).
(3.3.5)
71
Also recall that the traces of all relative CRT set elements are unity: Trğ‘šâ€²,â„“(âƒ—ğ‘ğ‘šâ€²,â„“) =
1ğœ™(ğ‘šâ€²)/ğœ™(â„“) for any â„“|ğ‘šâ€². We now need to consider two cases. For ğ‘š > 1, we have ğ‘”ğ‘š = ğ‘”ğ‘,
so by Equation (3.3.5) and linearity of trace,
Twğ‘šâ€²,ğ‘š(âƒ—ğ‘ğ‘šâ€²,ğ‘š) = ( Ë†ğ‘š/ Ë†ğ‘šâ€²) Â· 1ğœ™(ğ‘šâ€²)/ğœ™(ğ‘š) .
For ğ‘š = 1, we have ğ‘”ğ‘š = 1, so by âƒ—ğ‘ğ‘šâ€²,1 = âƒ—ğ‘ğ‘šâ€²,ğ‘ âŠ— âƒ—ğ‘ğ‘,1 and linearity of trace we have
Twğ‘šâ€²,1(âƒ—ğ‘ğ‘šâ€²,1) = ( Ë†ğ‘š/ Ë†ğ‘šâ€²) Â· Trğ‘,1(Trğ‘šâ€²,ğ‘(âƒ—ğ‘ğ‘šâ€²,ğ‘) âŠ— (ğ‘”ğ‘ Â· âƒ—ğ‘ğ‘,1))
= ( Ë†ğ‘š/ Ë†ğ‘šâ€²) Â· 1ğœ™(ğ‘šâ€²)/ğœ™(ğ‘) âŠ— Trğ‘,1(ğ‘”ğ‘ Â· âƒ—ğ‘ğ‘,1) .
Applying the two cases, we ï¬nally have
Twğ‘šâ€²,ğ‘š(âƒ—ğ‘ğ‘¡
ğ‘šâ€²) = (1 Â· Twğ‘šâ€²,ğ‘š(âƒ—ğ‘ğ‘¡
= âƒ—ğ‘ğ‘¡
ğ‘š Â· ( Ë†ğ‘š/ Ë†ğ‘šâ€²) Â·
â§âªâªâ¨âªâªâ©1ğ‘¡
ğ‘šâ€²,ğ‘š)) âŠ— (âƒ—ğ‘ğ‘¡
ğ‘š Â· ğ¼ğœ™(ğ‘š))
ğœ™(ğ‘šâ€²)/ğœ™(ğ‘š) âŠ— ğ¼ğœ™(ğ‘š)
ğœ™(ğ‘šâ€²)/ğœ™(ğ‘) âŠ— Trğ‘,1(ğ‘”ğ‘ Â· âƒ—ğ‘ğ‘¡
1ğ‘¡
if ğ‘š > 1
if ğ‘š = 1.
ğ‘,1)
Again because Trğ‘,1(âƒ—ğ‘ğ‘,1) = 1ğœ™(ğ‘), the entries of Trğ‘,1(ğ‘”ğ‘ Â· âƒ—ğ‘ğ‘,1) are merely the CRT coefï¬-
cients of ğ‘”ğ‘. That is, the ğ‘–th entry (indexed from one) is 1 âˆ’ ğœ”ğ‘–
for the
value of ğœ”ğ‘šâ€² used to deï¬ne the CRT set of the ğ‘šâ€²th cyclotomic.
ğ‘, where ğœ”ğ‘ = ğœ”ğ‘šâ€²/ğ‘
ğ‘šâ€²
3.3.3 CRT Sets
In this ï¬nal subsection we describe an algorithm for computing a representation of the
relative CRT set âƒ—ğ‘ğ‘šâ€²,ğ‘š modulo a prime-power integer. CRT sets are a generalization of CRT
bases to the case where the prime modulus may not be 1 modulo the cyclotomic index (i.e.,
it does not split completely), and therefore the cardinality of the set may be less than the
dimension of the ring. CRT sets are used for homomorphic SIMD operations [SV14] and in
72
the bootstrapping algorithm of [AP13]. See subsection 2.2.6 for the necessary background
information.
Computing CRT Sets
We start with an easy calculation that, for a prime integer ğ‘, â€œliftsâ€ the mod-ğ‘ CRT set to the
mod-ğ‘ğ‘’ CRT set.
Lemma 3.3.1. For ğ‘… = ğ’ªğ‘š, a prime integer ğ‘ where ğ‘ (cid:45) ğ‘š, and a positive integer ğ‘’, let
(ğ‘ğ‘–)ğ‘– be the CRT set of ğ‘…ğ‘ğ‘’, and let Â¯ğ‘ğ‘– âˆˆ ğ‘… be any representative of ğ‘ğ‘–. Then (Â¯ğ‘ğ‘
ğ‘– mod ğ‘ğ‘’+1ğ‘…)ğ‘–
is the CRT set of ğ‘…ğ‘ğ‘’+1.
Corollary 3.3.2. If Â¯ğ‘ğ‘– âˆˆ ğ‘… are representatives for the mod-ğ‘ CRT set (ğ‘ğ‘–)ğ‘– of ğ‘…ğ‘, then
(Â¯ğ‘ğ‘ğ‘’âˆ’1
ğ‘– mod ğ‘ğ‘’ğ‘…)ğ‘– is the CRT set of ğ‘…ğ‘ğ‘’.
Proof of Lemma 3.3.1. Let ğ‘ğ‘… =âˆï¸€
pğ‘– âŠ‚ ğ‘…. By hypothesis, we have Â¯ğ‘ğ‘– âˆˆ ğ›¿ğ‘–,ğ‘–â€² + pğ‘’
ğ‘–â€² for all ğ‘–, ğ‘–â€². Then
ğ‘– pğ‘– be the factorization of ğ‘ğ‘… into distinct prime ideals
ğ‘– âˆˆ ğ›¿ğ‘–,ğ‘–â€² + ğ‘ Â· pğ‘’
Â¯ğ‘ğ‘
ğ‘–â€² + pğ‘’ğ‘
ğ‘–â€² âŠ† ğ›¿ğ‘–,ğ‘–â€² + pğ‘’+1
ğ‘–â€²
,
because ğ‘ divides the binomial coefï¬cient(ï¸€ğ‘
)ï¸€ for 0 < ğ‘˜ < ğ‘, because ğ‘ğ‘… âŠ† pğ‘–â€², and because
ğ‘˜
ğ‘–â€² âŠ† pğ‘’+1
pğ‘’ğ‘
ğ‘–â€²
.
CRT sets modulo a prime. We now describe the mod-ğ‘ CRT set for a prime integer ğ‘,
and an efï¬cient algorithm for computing representations of its elements. To motivate
the approach, notice that the coefï¬cient vector of ğ‘¥ âˆˆ ğ‘…ğ‘ with respect to some arbitrary
Zğ‘-basis âƒ—ğ‘ of ğ‘…ğ‘ can be obtained via the twace and the dual Zğ‘-basis âƒ—ğ‘âˆ¨ (under the twace):
ğ‘¥ = âƒ—ğ‘ğ‘¡ Â· Twğ‘…ğ‘/Zğ‘(ğ‘¥ Â· âƒ—ğ‘âˆ¨).
73
In what follows we let âƒ—ğ‘ be the decoding basis, because its dual basis is the conjugated
powerful basis, which has a particularly simple form. The following lemma is a direct
consequence of Equation (2.2.6) and the deï¬nition of twace (Equation (2.2.4)).
Lemma 3.3.3. For ğ‘… = ğ’ªğ‘š and a prime integer ğ‘ (cid:45) ğ‘š, let âƒ—ğ‘ = (ğ‘ğ‘–) be the CRT set of ğ‘…ğ‘,
let âƒ—ğ‘‘ = âƒ—ğ‘‘ğ‘š denote the decoding Zğ‘-basis of ğ‘…ğ‘, and let ğœ (âƒ—ğ‘) = (ğ‘âˆ’1
ğ‘— ) denote its dual, the
conjugate powerful basis. Then
âƒ—ğ‘ğ‘¡ = âƒ—ğ‘‘ğ‘¡ Â· Twğ‘…ğ‘/Zğ‘(ğœ (âƒ—ğ‘) Â· âƒ—ğ‘ğ‘¡) = âƒ—ğ‘‘ğ‘¡ Â· Ë†ğ‘šâˆ’1 Â· TrF
ğ‘ğ‘‘ /Fğ‘(ğ¶),
where ğ¶ is the matrix over Fğ‘ğ‘‘ whose (ğ‘—, Â¯ğš¤)th element is ğœŒÂ¯ğš¤(ğ‘”ğ‘š) Â· ğœŒÂ¯ğš¤(ğ‘âˆ’1
ğ‘— ).
Notice that ğœŒÂ¯ğš¤(ğ‘âˆ’1
ğ‘— ) is merely the inverse of the (Â¯ğš¤, ğ‘—)th entry of the matrix CRTğ‘š
over Fğ‘ğ‘‘, which is the Kronecker product of CRTğ‘šâ„“ over all maximal prime-power divisors
of ğ‘š. In turn, the entries of CRTğ‘šâ„“ are all just appropriate powers of ğœ”ğ‘šâ„“ âˆˆ Fğ‘ğ‘‘. Similarly,
ğœŒÂ¯ğš¤(ğ‘”ğ‘š) is the product of all ğœŒÂ¯ğš¤ mod ğ‘šâ„“(ğ‘”ğ‘šâ„“) = 1 âˆ’ ğœ”Â¯ğš¤
ğ‘šâ„“. So we can straightforwardly compute
the entries of the matrix ğ¶ and takes their traces into Fğ‘, yielding the decoding-basis
coefï¬cient vectors for the CRT set elements.
Relative CRT sets. We conclude by describing the relative CRT set âƒ—ğ‘ğ‘šâ€²,ğ‘š modulo a
prime ğ‘, where ğ‘… = ğ’ªğ‘š, ğ‘…â€² = ğ’ªğ‘šâ€² for ğ‘š|ğ‘šâ€² and ğ‘ (cid:45) ğ‘šâ€². The key property of âƒ—ğ‘ğ‘šâ€²,ğ‘š is that
the CRT sets âƒ—ğ‘ğ‘šâ€², âƒ—ğ‘ğ‘š for ğ‘…ğ‘, ğ‘…â€²
ğ‘ (respectively) satisfy the Kronecker-product factorization
âƒ—ğ‘ğ‘šâ€² = âƒ—ğ‘ğ‘šâ€²,ğ‘š âŠ— âƒ—ğ‘ğ‘š .
(3.3.6)
The deï¬nition of âƒ—ğ‘ğ‘šâ€²,ğ‘š arises from the splitting of the prime ideal divisors pğ‘– (of ğ‘ğ‘…) in ğ‘…â€²,
as described next.
Recall from above that the prime ideal divisors pâ€²
ğ‘–â€² âŠ‚ ğ‘…â€² of ğ‘ğ‘…â€² and the CRT set
ğ‘šâ€²/âŸ¨ğ‘âŸ©, and similarly for pğ‘– âŠ‚ ğ‘… and âƒ—ğ‘ğ‘š = (ğ‘ğ‘–). For