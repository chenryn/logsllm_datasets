Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A c" 414 456 "-" "-" 
13 
Network Defense 
• 
Carrier (ISP) 
–  Often mixed capabilities 
–  Blacklisting malicious IP addresses 
–  Limit packets/sessions/bandwidth per second per IP 
–  Blackhole protocol/port (e.g. discard traffic from UDP Floods) 
• 
IPS (e.g. Snort) 
–  IPS rules are often ideal for dropping layer 7 DDoS traffic before it reaches the 
webserver 
–  For our example, we will be using Snort inline 
• 
Load Balancers (e.g. F5) 
–  iRules can be used to drop traffic and mitigate many layer 7 DDoS attacks 
• 
Firewalls (e.g. iptables) 
–  Blacklisting malicious IP addresses 
• 
Geographically or by type can be useful or useless depending on adversaries 
• 
SX blacklists egihosting.com for example 
–  Limit packets/sessions/bandwidth per second per IP 
Remember our good skid friend VoXLulz1? 
209.73.151.188 - - [16/May/2013:07:12:47 -0400] "GET /?= HTTP/1.1” 403 1199 "http://
www.google.com/?q=" "Fuck You motherfucker - TANGO DOWN (+http://twitter.com/VoXLulz1” 
14 
Network Defense Examples 
• 
Blocking VoxLulz1 with snort inline 
drop tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"HTTP VoxLulz UA detected";  
flow:to_server,established; 
content:"User-Agent|3A 20|Fuck You motherfucker - TANGO DOWN (+http|3A|//twitter.com/VoXLulz1"; 
http_header; fast_pattern:only; 
reference:url,soldierx.com/defcon22/dont_ddos_me_bro-blake_cisc0ninja.ppt; 
classtype:web-application-attack; sid:x; rev:1;) 
• 
Blocking VoxLulz1 with F5 iRules 
when HTTP_REQUEST { 
 if {([HTTP::header "User-Agent"] matches "Fuck You motherfucker - TANGO DOWN (+http://twitter.com/
VoXLulz1")}  
        { log local0. "HTTP VoxLulz UA detected [IP::client_addr]" 
          drop 
        } 
} 
• 
Blocking VoxLulz1 via egihosting.com block 
root@shinra:/# iptables -A INPUT -s 68.68.96.0/24 -j DROP 
• 
Limiting connections with iptables 
Block IPs that do > 20 connections in 10 minutes: 
iptables -I INPUT -p tcp --dport 80-i eth0 -m state --state NEW 
 -m recent --set 
iptables -I INPUT -p tcp --dport 80-i eth0 -m state --state NEW 
 -m recent --update --seconds 600 --hitcount 20 -j DROP 
15 
Network Defense - Blocking TOR 
• 
Isn’t TOR too slow to take you offline? 
–  It took hack3r.com offline 
• 
https://www.soldierx.com/bbs/201306/Attacks-against-hack3rcom 
• 
Is blocking TOR wrong? 
–  Many attacks come from TOR and your site may not make sense to be TOR 
reachable (such as a shopping site or banking site) 
#!/bin/bash 
# Block Tor Exit nodes 
IPTABLES_TARGET="DROP" 
IPTABLES_CHAINNAME="TOR” 
if ! iptables -L TOR -n >/dev/null 2>&1 ; then 
 iptables -N TOR >/dev/null 2>&1 
 iptables -A INPUT -p tcp -j TOR 2>&1 
fi 
cd /tmp/ 
echo -e "\n\tGetting TOR node list from dan.me.uk\n" 
wget -q -O - "https://www.dan.me.uk/torlist/" -U SXTorBlocker/1.0 > /tmp/full.tor 
sed -i 's|^#.*$||g' /tmp/full.tor 
iptables -F TOR 
CMD=$(cat /tmp/full.tor | uniq | sort) 
for IP in $CMD; do 
 let COUNT=COUNT+1 
 iptables -A TOR -s $IP -j DROP 
done 
iptables -A TOR -j RETURN 
echo -e "\n\tiptables is now blocking TOR connections\n” 
rm /tmp/full.tor 
16 
Network Monitoring 
• 
IDS (e.g. Snort) 
–  IDS rules can be used for detection in place of blocking. For our example, we will 
be using Snort: 
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"HTTP VoxLulz UA detected";  
flow:to_server,established; 
content:"User-Agent|3A 20|Fuck You motherfucker - TANGO DOWN (+http|3A|//twitter.com/VoXLulz1"; 
http_header; fast_pattern:only; 
reference:url,soldierx.com/defcon22/dont_ddos_me_bro-blake_cisc0ninja.ppt; 
classtype:web-application-attack; sid:x; rev:1;) 
• 
Load Balancers (e.g. F5) 
–  iRules can be used to log traffic of many layer 7 DDoS attacks 
when HTTP_REQUEST { 
 if {([HTTP::header "User-Agent"] matches "Fuck You motherfucker - TANGO DOWN (+http://twitter.com/
VoXLulz1")}  
        { log local0. "HTTP VoxLulz UA detected [IP::client_addr]" 
          #drop 
        } 
} 
• 
Monitoring Software (e.g. RoboAmp) 
–  Runs on a Raspberry Pi 
–  Uses  - URL of site to check 
–  s  - String to look for to verify site is offline 
–  l  - Use 16x2 LCD (Raspberry PI) 
–  g  - Gmail address for google voice SMS notification 
–  t  - Seconds to wait between checks (defaults to  
–  v - Turns on extra verbosity 
–  Example Usage: 
./RoboAmp -d -u https://www.soldierx.com/admin -s 'Site off-line' -g PI:EMAIL -t 120 
./RoboAmp -p -u http://www.soldierx.com -g PI:EMAIL -t 300 
18 
Web Defense 
•  We will be focusing on Apache2 as this is the web server 
that SX currently uses, but many techniques will work on 
other webservers 
•  .htaccess 
–  Protect files/directory listings 
–  Block user agents 
–  Other clever things like redirecting bad requests/user agents back 
to themselves, or somewhere like fbi.gov 
•  mod_evasive (equivalent of IIS Dynamic IP Restrictions) 
–  Creates an internal dynamic hash table of IP Addresses and URIs 
•  Limit number of requests per file per time interval (seconds) 
•  Limit number of overall site requests per time interval (seconds) 
•  Default returns 403 for the blocking period, can also run a system command 
•  Provides ability to notify via email when attacks occur 
•  Great for driving up attacker costs 
•  Do these methods really work? 
19 
Web Defense – Know Your Enemy 
•  Yes, these methods have worked well for SX (and others) 
•  Why? 
20 
Web Defense – Apache2 Examples 
• 
.htaccess 
Block him: 
SetEnvIf User-Agent ”.*Fuck.*" Skid=1 
Deny from env=Skid 
• 
.htaccess + mod_rewrite 
Redirect him to himself: 
RewriteCond %{HTTP_USER_AGENT} ^.*Fuck.*$ 
RewriteRule .* http://%{REMOTE_ADDR}/ [R,L] 
Redirect him somewhere more interesting: 
RewriteCond %{HTTP_USER_AGENT} ^.*Fuck.*$ 
RewriteRule .* http://www.fbi.gov/ [R,L] 