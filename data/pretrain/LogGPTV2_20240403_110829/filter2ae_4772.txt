## 0x00 前言
DanderSpritz 是由美国国家安全局（NSA）开发的一款图形化远程控制工具，基于 FuzzBunch 框架。运行 Start.jar 即可启动该工具。由于缺乏详细的说明文档，在实际测试过程中可能会遇到多种问题，并且一些细节值得深入研究。本文旨在解答这些问题，分享测试心得，并结合木马特点分析防御策略。

## 0x01 简介
本文将涵盖以下内容：
- `pc_prep` 无法获得回显的原因及解决方法
- Pc 与 Pc2.2 的区别
- Level3 和 Level4 木马的含义及其使用方法
- 各类型木马的区别
- DLL 木马的利用方式
- Windows 单条日志删除功能
- 木马查杀思路

## 0x02 实际测试
### 测试环境
- 操作系统：Windows 7 x86
- 安装工具：
  - Python 2.6
  - pywin32
  - JDK

### 1. 下载 FuzzBunch
请参考相关链接进行下载。需要注意的是，我 fork 了公开的 FuzzBunch 项目，并添加了一些内容以修复一个已知 bug。具体细节将在后续章节中介绍。

### 2. 直接运行 Start.jar
如图所示，设置启动参数时，Log Directory 需要采用固定格式 `c:\logs\xxx`（其中 `xxx` 可为任意名称）。如果路径格式不正确，则会出现错误提示。

**注**：有些在线资源建议先通过 `fb.py` 生成日志文件，再让 `Start.jar` 指向该目录。但实际上，只要路径格式正确即可直接运行。

### 3. 执行 `pc_prep` 配置木马
输入 `pc_prep` 应当能够获取到回显。然而，很多用户在测试时发现无法收到回显，原因在于从特定链接下载的 FuzzBunch 工程可能缺少某些必要文件。正确的下载地址如下：

[此处插入正确下载链接]

此外，我 fork 的工程已经补充了缺失文件，您可以通过访问我的 GitHub 仓库来获取完整版本。

**补充**：在早期测试阶段，即使使用存在缺陷的版本，虽然 `pc_prep` 不起作用，但 `pc2.2_prep` 仍能生成木马。不过，这些木马无法成功回连。这可能是由于 Pc 版本高于 Pc2.2，后者已被弃用。

### 4. 木马分类
以下是 DanderSpritz 提供的各种木马选项列表。它们按照平台、文件格式、通信协议、功能以及级别（Level）进行分类。
- 平台：x86, x64
- 文件格式：exe, dll
- 通信协议：Standard TCP, HTTP Proxy
- 功能：Standard, AppCompat-enabled, UtilityBurst-enabled, WinsockHelperApi-enabled
- 级别：Level3, Level4

**注**：经实测验证，Level 数字表示不同的回连机制。例如，Level3 表示反向连接（即控制端监听等待目标主机发起连接），而 Level4 则表示正向连接（即目标主机监听等待控制端主动连接）。

### 5. 木马测试
我们将选择几种代表性配置进行测试，并简述其操作流程。具体步骤包括但不限于配置生成、执行命令行指令以及检查网络状态等。

## 0x03 木马功能
一旦木马成功连接至目标系统，它会自动开始收集信息并向用户报告详细情况。此外，还提供了一系列命令用于执行各种任务，如编辑或清除事件日志记录等。

### 日志操作功能
- **eventlogquery**：查询指定类型的日志条目
- **eventlogfilter**：过滤并显示指定数量的日志条目
- **eventlogedit**：修改单个日志条目的内容
- **eventlogclear**：清空某一类别下的所有日志条目

## 0x04 木马查杀思路
DanderSpritz 使用预定义模板文件生成最终的恶意软件负载。这些模板位于 `ResourcesPcLevel3` 和 `ResourcesPcLevel4` 目录下。目前主流的安全软件已经能够识别并拦截这些模板文件。因此，对于普通用户而言，定期更新操作系统补丁和安全软件病毒库是防范此类攻击的有效措施之一。

## 0x05 小结
本文总结了对 DanderSpritz 进行技术研究的一些经验和见解。为了防止滥用此工具，文中省略了一些具体的实施细节。希望读者们能够从中受益，加深对该领域的理解。
>本文为 3gstudent 原创稿件，授权嘶吼独家发布，未经许可禁止转载；如若转载，请注明原文地址：