    }
上述这段代码直接导致了Fomo3d薅羊毛事件的诞生。真实世界损失巨大，超过数千eth。
[8万笔交易“封死”以太坊网络，只为抢夺Fomo3D大奖？](https://mp.weixin.qq.com/s/5nrgj8sIZ0SlXebG5sWVPw)
[Last Winner ](https://paper.seebug.org/672/)
### 三、漏洞影响范围
使用Haotian平台智能合约审计功能可以准确扫描到该类型问题。
![
](https://images.seebug.org/content/images/2018/09/8892acc5-ae40-4b7b-9d7e-78a564d0aabf.png-w331s)
基于Haotian平台智能合约扫描功能规则，我们对全网的公开的共42538个合约代码进行了扫描，其中35107个合约存在地址初始化问题，4262个合约存在判断函数问题，173个合约存在余额判断问题，930个合约存在转账函数问题，
349个合约存在弱随机数问题，2300个合约调用了block.timestamp，过半合约涉及到这类安全风险。
#### 1、地址初始化问题
截止2018年9月21日，我们发现了35107个存在地址初始化问题的合约代码，存在潜在的安全隐患。
#### 2、判断函数问题
截止2018年9月21日，我们发现了4262个存在判断函数问题的合约代码，存在潜在的安全隐患。
#### 3、余额判断问题
截止2018年9月21日，我们发现了173个存在余额判断问题的合约代码，其中165个仍处于交易状态，其中交易量最高的10个合约情况如下：
![
](https://images.seebug.org/content/images/2018/09/b83c7c25-d56e-4d27-8818-354c556f122b.png-w331s)
#### 4、转账函数问题
截止2018年9月21日，我们发现了930个存在转账函数问题的合约代码，其中873个仍处于交易状态，其中交易量最高的10个合约情况如下：
![
](https://images.seebug.org/content/images/2018/09/8d7046d5-8f76-4710-9c6f-5d0a8c830ea8.png-w331s)
#### 5、弱随机数问题
截止2018年9月21日，我们发现了349个存在弱随机数问题的合约代码，其中272个仍处于交易状态，其中交易量最高的10个合约情况如下：
![
](https://images.seebug.org/content/images/2018/09/e0b018c7-8d5b-4052-ae57-5ce2b79ab9c8.png-w331s)
截止2018年9月21日，我们发现了2300个存在调用了block.timestamp的合约代码，其中2123个仍处于交易状态，其中交易量最高的10个合约情况如下：
![
](https://images.seebug.org/content/images/2018/09/7772bb6a-c7b7-498f-9385-44e77a6f58ea.png-w331s)
### 四、修复方式
#### 1、地址初始化问题
涉及到地址的函数中，建议加入require(_to!=address(0))验证，有效避免用户误操作或未知错误导致的不必要的损失
#### 2、判断函数问题
对于正常的判断来说，优先使用`require`来判断结果。
而对于固定变量的检查，使用assert函数可以避免一些未知的问题，因为他会强制终止合约并使其无效化，在一些固定条件下，assert更适用
#### 3、余额判断问题
不要在合约任何地方假设合约的余额，尤其是不要通过创建时合约为0来判断合约初建状态，攻击者可以使用多种方式强制转账。
#### 4、转账函数问题
在完成交易时，默认推荐使用transfer函数而不是send完成交易。
#### 5、代码外部调用设计问题
对于外部合约优先使用pull而不是push。如上述的转账函数，可以通过赋予提取权限来将主动行为转换为被动行为
    contract auction {
        address highestBidder;
        uint highestBid;
        mapping(address => uint) refunds;
        function bid() payable external {
            if (msg.value   
联系电话：(086) 136 8133 5016(沈经理，工作日:10:00-18:00)
欢迎扫码咨询：
**区块链行业安全解决方案**
黑客通过DDoS攻击、CC攻击、系统漏洞、代码漏洞、业务流程漏洞、API-Key漏洞等进行攻击和入侵，给区块链项目的管理运营团队及用户造成巨大的经济损失。知道创宇十余年安全经验，凭借多重防护+云端大数据技术，为区块链应用提供专属安全解决方案。
欢迎扫码咨询：
* * *