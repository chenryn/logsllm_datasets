• z/OS traces
For more information, see “Other types of trace on z/OS” on page 403.
Related tasks
“Collecting troubleshooting information for IBM Support” on page 302
When you open a case with IBM, you can include additional IBM MQ troubleshooting information
(MustGather data) that you have collected to help with investigating the problem. In addition to the
IBM MQ troubleshooting and support 395
information described in this section, IBM Support might request further information on a case by case
basis.
Using the GTF with IBM MQ global trace
On z/OS, you can obtain information about MQI calls and user parameters passed by some IBM MQ calls
on entry to, and exit from, IBM MQ. To do this, use the IBM MQ global trace in conjunction with the z/OS
generalized trace facility (GTF).
Starting and stopping the GTF
On z/OS, you can use the generalized trace facility (GTF) to record and diagnose system and program
problems.
About this task
You can obtain information about MQI calls and user parameters passed by some IBM MQ calls on entry
to, and exit from, IBM MQ. To do this, use the global trace in conjunction with the z/OS generalized trace
facility (GTF).
Procedure
• Start the GTF at the console by entering a START GTF command.
When you start the GTF, specify the USRP option. You are prompted to enter a list of event identifiers
(EIDs). The EIDs used by IBM MQ are:
5E9
To collect information about control blocks on entry to IBM MQ
5EA
To collect information about control blocks on exit from IBM MQ
Sometimes, if an error occurs that you cannot solve yourself, you might be asked by your IBM support
center to supply other, internal, trace information for them to analyze. The additional type of trace is:
5EE
To collect information internal to IBM MQ
You can also use the JOBNAMEP option, specifying the batch, CICS, IMS, or TSO job name, to limit the
trace output to specific jobs. The following example shows a sample startup for the GTF, specifying the
four EIDs, and a jobname. The lines shown in bold are the commands that you enter at the console;
the other lines are prompts and responses. For more information about starting the GTF trace, see the
MVS Diagnosis: Tools and Service Aids documentation.
START GTFxx.yy
#HASP100 GTFxx.yy ON STCINRDR
#HASP373 GTFxx.yy STARTED
*01 AHL100A SPECIFY TRACE OPTIONS
R 01,TRACE=JOBNAMEP,USRP
TRACE=JOBNAMEP,USRP
IEE600I REPLY TO 01 IS;TRACE=JOBNAMEP,USRP
*02 ALH101A SPECIFY TRACE EVENT KEYWORDS - JOBNAME=,USR=
R 02,JOBNAME=(xxxxMSTR,xxxxCHIN,zzzzzzzz),USR=(5E9,5EA,5EE)
JOBNAME=(xxxxMSTR,xxxxCHIN,zzzzzzzz),USR=(5E9,5EA,5EE)
IEE600I REPLY TO 02 IS;JOBNAME=(xxxxMSTR,xxxxCHIN,zzzzzzzz),USR=(5E9,5EA,5EE)
*03 ALH102A CONTINUE TRACE DEFINITION OR REPLY END
R 03,END
END
IEE600I REPLY TO 03 IS;END
AHL103I TRACE OPTIONS SELECTED-USR=(5E9,5EA,5EE)
AHL103I JOBNAME=(xxxxMSTR,xxxxCHIN,zzzzzzzz)
*04 AHL125A RESPECIFY TRACE OPTIONS OR REPLY U
R 04,U
U
IEE600I REPLY TO 04 IS;U
AHL031I GTF INITIALIZATION COMPLETE
396 Troubleshooting and Support for IBM MQ
where
– xx is the name of the GTF procedure to use (optional)
– yy is an identifier for this occurrence of GTF trace
– xxxx is the name of the queue manager
– zzzzzzzz is a batch job or CICS region name
Up to 5 job names can be listed.
When using GTF, specify the primary job name (CHINIT, CICS, or batch) in addition to the queue
manager name (xxxxMSTR).
• Stop the GTF at the console.
When you enter the stop command for the GTF, include the additional identifier (yy) that you used at
startup, as shown in the following example:
STOP yy
Related information
Generating IBM MQ GTF trace on IBM z/OS
Using IBM MQ global trace
On z/OS, you can control IBM MQ trace by using MQSC commands.
Before you begin
To use any of the trace commands, you must have one of the following:
• Authority to issue start and stop trace commands (trace authority).
• Authority to issue the display trace command (display authority).
Note:
1.The trace commands can also be entered through the initialization input data sets.
2.The trace information produced will also include details of syncpoint flows - for example PREPARE and
COMMIT.
Procedure
1.To start writing IBM MQ records to the GTF, use the START TRACE command, specifying trace type
GLOBAL.
You must also specify dest(GTF) as shown in the following example:
/cpf start trace(GLOBAL)class(2,3)dest(GTF)
To define the events that you want to produce trace data for, use one or more of the following classes:
CLASS Event traced
2 Record the MQI call and MQI parameters when a completion code other
than MQRC_NONE is detected.
3 Record the MQI call and MQI parameters on entry to and exit from the
queue manager.
2.After the trace has started, use the following MQSC commands to display information about or alter
the properties of the trace:
• Use DISPLAY TRACE to display a list of active traces.
IBM MQ troubleshooting and support 397
• Use ALTER TRACE to change the trace events being traced for a particular active queue manager
trace. ALTER TRACE stops the specified trace, and restarts it with the altered parameters.
3.To stop tracing, use the STOP TRACE command.
For example:
/cpf STOP TRACE(GLOBAL) DEST(GTF) CLASS(*) RMID(*)
In this command, /cpf refers to the command prefix for the IBM MQ subsystem.
Formatting and identifying the control block information on z/OS
After capturing a trace, the output must be formatted and the IBM MQ control blocks identified.
• Formatting the information
• Identifying the control blocks associated with IBM MQ
• Identifying the event identifier associated with the control block
Formatting the information
To format the user parameter data that is collected by the global trace, use either the batch job that is
shown in Figure 59 on page 398 or the IPCS GTFTRACE USR( xxx ) command, where xxx is:
5E9
To format information about control blocks on entry to IBM MQ MQI calls.
5EA
To format information about control blocks on exit from IBM MQ MQI calls.
5EE
To format information about IBM MQ internals.
You can also specify the JOBNAME(jobname) parameter to limit the formatted output to specific jobs.
//S1 EXEC PGM=IKJEFT01,DYNAMNBR=20,REGION=4096K
//IPCSPARM DD DSN=SYS1.PARMLIB,DISP=SHR
//IPCSDDIR DD DSN=thlqual.ipcs.dataset.directory,DISP=SHR
//SYSTSPRT DD SYSOUT=*,DCB=(LRECL=137)
//IPCSTOC DD SYSOUT=*
//GTFIN DD DSN=gtf.trace,DISP=SHR
//SYSTSIN DD *
IPCS
SETDEF FILE(GTFIN) NOCONFIRM
GTFTRACE USR(5E9,5EA,5EE)
/*
//STEPLIB DD DSN=thlqual.SCSQAUTH,DISP=SHR
Figure 59. Formatting the GTF output in batch
Identifying the control blocks associated with IBM MQ
The format identifier for the IBM MQ trace is D9. This value appears at the beginning of each formatted
control block in the formatted GTF output, in the form:
USRD9
Identifying the event identifier associated with the control block
The trace formatter inserts one of the following messages at the start of each control block. These
messages indicate whether the data was captured on entry to or exit from IBM MQ:
• CSQW072I ENTRY: MQ user parameter trace
398 Troubleshooting and Support for IBM MQ
• CSQW073I EXIT: MQ user parameter trace
Related tasks
“Starting and stopping the GTF” on page 396
On z/OS, you can use the generalized trace facility (GTF) to record and diagnose system and program
problems.
Interpreting the trace information on z/OS
The GTFTRACE produced by IBM MQ can be examined to determine possible errors with invalid
addresses, invalid control blocks, and invalid data.
When you look at the data produced by the GTFTRACE command, consider the following points:
• If the control block consists completely of zeros, it is possible that an error occurred while copying data
from the user's address space. This might be because an invalid address was passed.
• If the first part of the control block contains non-null data, but the rest consists of zeros, it is again
possible that an error occurred while copying data from the user's address space, for example, the
control block was not placed entirely within valid storage. This might also be due to the control block
not being initialized correctly.
• If the error occurred on exit from IBM MQ, it is possible that IBM MQ might not write the data to the
user's address space. The data displayed is the version that it was attempting to copy to the user's
address space.
The following tables show details of the control blocks that are traced.
Table 28 on page 399 illustrates which control blocks are traced for different MQI calls.
Table 28. Control blocks traced for IBM MQ MQI calls
MQI call Entry Exit
MQCB MQCBD, MQMD, MQGMO MQCBD, MQMD, MQGMO
MQCLOSE None None
MQGET MQMD, MQGMO MQMD, MQGMO, and the first 256 bytes
of message data
MQINQ Selectors (if SelectorCount is greater Selectors (if SelectorCount is greater
than 0) than 0)
Integer attributes (if IntAttrCount is
greater than 0)
Character attributes (if
CharAttrLength is greater than 0)
MQOPEN MQOD MQOD
MQPUT MQMD, MQPMO, and the first 256 bytes MQMD, MQPMO, and the first 256 bytes
of message data of message data
MQPUT1 MQMD, MQOD, MQPMO, and the first MQMD, MQOD, MQPMO, and the first
256 bytes of message data 256 bytes of message data
MQSET Selectors (if SelectorCount is greater Selectors (if SelectorCount is greater
than 0) than 0)
Integer attributes (if IntAttrCount is Integer attributes (if IntAttrCount is
greater than 0) greater than 0)
Character attributes (if Character attributes (if
CharAttrLength is greater than 0) CharAttrLength is greater than 0)
IBM MQ troubleshooting and support 399
Table 28. Control blocks traced for IBM MQ MQI calls (continued)
MQI call Entry Exit
MQSTAT MQSTS MQSTS
MQSUB MQSD, MQSD.ObjectString, MQSD, MQSD.ObjectString,
MQSD.SubName, MQSD.SubUserData, MQSD.SubName, MQSD.SubUserData,
MQSD.SelectionString, MQSD.SelectionString,
MQSD.ResObjectString MQSD.ResObjectString
MQSUBRQ MQSRO MQSRO
Note: In the special case of an MQGET call with the WAIT option, a double entry is seen if there is no
message available at the time of the MQGET request, but a message subsequently becomes available
before the expiry of any time interval specified.
This is because, although the application has issued a single MQGET call, the adapter is performing the
wait on behalf of the application and when a message becomes available it reissues the call. So in the
trace it appears as a second MQGET call.
Information about specific fields of the queue request parameter list is also produced in some
circumstances. The fields in this list are identified as follows:
Identifier Description
Action Requested action
BufferL Buffer length
CBD Address of callback descriptor
CompCode Completion code
CharAttL Character attributes length
DataL Data length
Hobj Object handle
Hsub Subscription handle
IntAttC Count of integer attributes
pObjDesc Object descriptor
Oper Operation
Options Options
pBuffer Address of buffer
pCharAtt Address of character attributes
pCTLO Address of control callback options
pECB Address of ECB used in get
pGMO Address of get message options
pIntAtt Address of integer attributes
pMsgDesc Address of message descriptor
pPMO Address of put message options
pSD Address of subscription descriptor
pSelect Address of selectors
400 Troubleshooting and Support for IBM MQ
Identifier Description
pSRQOpt Address of subscription request options
pSTS Address of status structure
Reason Reason code
RSVn Reserved for IBM
SelectC Selector count
Thread Thread
Type Requested type
UOWInfo Information about the unit of work
Userid CICS or IMS user ID, for batch or TSO this is zero
Using the channel initiator trace
The channel initiator trace can help to determine why a problem is happening in the CHIN address space,
whether the cause of the problem is in IBM MQ, the operating system, or the network.
About this task
See Figure 46 on page 270 for information about how to get a dump of the channel initiator address
space. Note that dumps produced by the channel initiator do not include trace data space. The trace data
space, which is called CSQXTRDS, contains trace information. You can request this by specifying it on a
slip trap or when you use the dump command.
Procedure
1.To run the trace, use the START TRACE command.
You can also set this trace to start automatically using the TRAXSTR queue manager attribute. For
more information about how to do this, see ALTER QMGR.
2.To display this trace information, enter the IPCS command:
LIST 1000. DSPNAME(CSQXTRDS)
3.To format the trace, use the command:
CTRACE COMP(CSQXssnm)
where ssnm is the subsystem name.
Related tasks
“Collecting troubleshooting information for IBM Support” on page 302
When you open a case with IBM, you can include additional IBM MQ troubleshooting information
(MustGather data) that you have collected to help with investigating the problem. In addition to the
information described in this section, IBM Support might request further information on a case by case
basis.
Using line trace
A wrap-around line trace exists for each channel. This trace is kept in a 4 KB buffer for each channel in
the channel initiator address space. Trace is produced for each channel, so it is ideal for problems where a
IBM MQ troubleshooting and support 401
channel appears to be hung, because information can be collected about the activity of this channel long
after the normal trace has wrapped.
About this task
The line trace is always active; you cannot turn it off. It is available for both LU 6.2 and TCP channels and
should reduce the number of times a communications trace is required.
You can view the trace as unformatted trace that is written to CSQSNAP.
You can display the trace by following these steps:
Procedure
1.Ensure that the CHIN procedure has a SNAP DD statement.
2.Start a CHIN trace, specifying IFCID 202 as follows:
START TRACE(CHINIT) CLASS(4) IFCID(202)
3.Display the channel status for those channels for which the line trace is required:
DISPLAY CHSTATUS(channel) SAVED
This dumps the current line for the selected channels to CSQSNAP. For more information, see “Snap
dumps on z/OS” on page 286.
The line trace buffer is unformatted. Each entry starts with a clock, followed by a time stamp, and an
indication of whether this is an OUTBOUND or INBOUND flow. Use the time stamp information to find
the earliest entry.
Notes:
a.The addresses of the storage dump are incorrect because the CSQXFFST mechanism takes a copy
of the storage before writing it to CSQSNAP.
b.The dump to CSQSNAP is only produced the first time you run the DISPLAY CHSTATUS SAVED
command. This is to prevent getting dumps each time you run the command.
4.To obtain another dump of line trace data, stop and restart the current trace.
a.You can use a selective STOP TRACE command to stop just the trace that was started to gather the
line trace data. To do this, note the TRACE NUMBER assigned to the trace as shown in this example:
+ssid START TRACE(CHINIT) CLASS(4) IFCID(202)