# OCR Output
## Page 1
滴滴运维架构演进史
陆沛
滴滴
---
## Page 2
About me
2010－2013百度贴吧
2013－至今滴滴打车
---
## Page 3
大纲
·背景
·运维的演进
·远古
·石器时代
青铜时代
黑铁时代
回顾与总结
核心运维平台介绍
·服务树
监控系统
部署系统
运维系统建设的思考
展望白银时代
Q&A
---
## Page 4
背景
滴滴的运维发展阶段
白银时代
黑铁时代
青铜时代
石器时代
2013/05
2014/03
2015/05
2016
---
## Page 5
远古 2012－2013/04
·规模
·服务器：4台
流量：PV不超过500w
团队：5个研发，无运维
）问题
·机房稳定性
监控缺失
安全性
---
## Page 6
石器时代2013/05－2014/02
运维架构
APP
业务架构
VPN
运维管理
LVS
接入层
Nagios
监控
逻辑/
php、C
展示层
自动化运
维工具
mysql、
存储层
mongodb
机房管理
服务器
Kickstart
机房
网络
iDRAC
Excel
资产管理
---
## Page 7
石器时代2013/05－2014/02
·规模
服务器：100台
流量：PV小于3000万
团队：2000台
）流量：PV大于5亿
）业务：出租车、专车
团队：>300个研发，8个运维
问题
监控的问题：
·性能
·维护成本
·有效性
部署的问题：
·增量
业务个性需求
迭代过快的变更冲突
·非静态文件
·数据的问题
业务同质化严重，迭代需求多
业务扩容效率低
配置管理，关联关系
---
## Page 10
黑铁时代2015/05
运维架构
APP
业务架构
OTP
运维管理
LVS
接入层
Odin 3.0
Huston2.0
router
监控
部署系统
初始化
数据配送
平台
平台
逻辑/
php、C、
php、C、
Java、Golang
Java、Golang
展示层
自动化运
维工具
内部交互层
服务树
mysql、
存储层
redis
机房管理
服务器
CMDB
机房
资产管理
网络
故障管理
---
## Page 11
黑铁时代2015/05
·规模
服务器：>1w台
流量：PV大于50亿
业务：10多个业务
团队：>1000个研发，25个运维
问题
过多的业务需求导致运维人力无法及时有效响应
监控
·有效性
覆盖率
监控指标量化
部署
多集群部署需求
·部署接入耗时过长
·扩容效率
预案管理
，成本问题
---
## Page 12
回顾与总结
·基础设施的规划 (突增的业务需求)
·公有云IDC租赁
·业务高速迭代下的版本迭代（人力、稳定性、迭代需求)
）上线流程+标准化打包+自助上线+灰度发布
·业务同质化与差异性（维护成本）
·标准化：语言、部署方式、监控上报、通用组件版本及选型
·规范化：日志规范、部署架构
·报警与定位 (及时发现与快速定位)
·报警分级：Mail、SMS、Phone
·服务大盘
·BI数据
·关联关系（快速扩容与故障恢复）
）配置管理+中间层(LB)
预案
·降级措施+对外通报渠道
·异地双活+快速切换措施
---
## Page 13
服务树
叶子节点包含资源组
-机器
运维平台
机器管理
监控系统?
节点资源
-初始化策略
devops
节点
监控系统》监控展示
-监控采集
搜索节点
日品com
I(ns) :
-报警策略
IPIP 日
搜索机器
白devops
搜索监控
Z3
初始化策略
控
alarm
部署策略
alarm-
资源文本存储
alive
日志监控
!de
资源变更版本记录
端口监控
cmdb
dispatch
进程监控
目录结构即树
podsup
 event
插件监控
父节点包含模板，创建子
exception
hugin
coredump
白influxdb
节点时继承
中uunxqp
co1eqnub
gnaju
excebgiou
盗街
---
## Page 14
服务树
批量处理
处理资源变化Event.比如新上线一台机器，自动安装 Agent
MQ
Pull Request
Event
Write
MasterTree
Gitlab
Sync
User(OP/RD/...)
Sync
Api
Read
SlaveTree
SlaveTree
api.devops.didi.com
获取机器列表（NameService）
machine.a
collect.api.devops.didi.com
获取监控采集列表
deploy.api.devops.didid.com
获取部署策略列表
---
## Page 15
服务树
machine
I--
_meta_._data.
-
monitor-influxdb-beatles00.qq._data.
一-
monitor-influxdb-beatles01.qq._data_
monitor-influxdb-beatles02.qq._data_
_meta_._data.
monitor
cpu.idle._data.
cpu.loadavg.15._data_
cpu.loadavg.1._data_
-
cpu.loadavg.5._data_
disk.inodes.used.percent._data.
-
disk.used.percent._data_
io.await._data_
io.util._data_
com/didi/devops$11
kernel_log_monitor._data_
machine.heartbeat._data_
total 140
mem.buffers._data_
drwxrwxr-x1
10xiaojuxiaoju4096Jul2916:31alarm
mem.free._data_
drwxrwxr-x
10 xiaojuxiaoju4096 Jul 29 16:31alarm-proxy
！
mem.total._data_
drwxrwxr-x
10 xiaoju xiaoju 4096 Jul 29 16:31 alive
mem.used._data_
mem.used.percent._data_
11
xiaoju xiaoju 4096A
Aug
17 11:57cmdb
_meta._._data.
drwxrwxr-x
10
xiaoju
1xiaoju
4096
Jul
29 16:31 dispatch
=
net.tcp.timewait._data_
drwxrwxr-x
10
xiaoju xiaoju4
4096
18
312:06 dnspod
Aug
drwxrwxr-x
12
xiaoju xiaoju 4096
Aug
28
16:27
event
10 xiaoju xiaoju 4096
Jul
16:31 exception
drwxrwxr-x 1
29
10 xiaoju xiaoju 4096
29
Jul
16:31
hugin
drwxrwxr-x 14 xiaoju xiaoju 4096
Aug
28
16:37
influxdb
-rw-rw-r--
1 xiaoju xiaoju
149
Jul
29
16:31
_meta_._data
X-XMX
10 xiaoju xiaoju
4096
Aug
31
17:18
mon-api
drwxrwxr-x
10 xiaoju xiaoju 4096
Aug
31
20:59
mon-net
10 xiaoju xiaoju 4096
Aug
312
20:52 mon-page
drwxrwxr-x
drwxrwxr-x
10 xiaoju xiaoju 4096
Jul
29
16:31 munin
drwxrwxr-x 1
10 xiaoju xiaoju 4096
Jul
29
16:31 notify
---
## Page 16
监控系统
集群监控：
聚合、Tag、同环比
订阅监控
聚合：均值
刷新
2016/04/13 01:27:48 - 2016/04/14 01:27:47
口同比
环比Delta(A）
host
status (1)
Selectall
Search
200
elect all
206
s-api-ct00.eb
301
S-api-preweboo.qq
302
s-api-sfcommonoo.(
304
---
## Page 17
监控系统
监控回调
采集指标
disk.used.percent 
触发条件
值条件，连续出现▼
多个条件间且关系
值条件
80
连续出现
连续出现
3
发送报警
执行动作
agent自动处理
插件地址
git@
com:odin-plugins/clear_log.git
运行账户
xiaoju
运行参数
params=foo
执行超时
120
秒
通知我自己开发的系统
---
## Page 18
监控系统
服务监控沉淀
Dashboard:
订阅：OFF
点
节点
om
!P!p 
capacity-inrouter-bh
capa_test
influxdb-related
codis
beatles
gs
dba
dache
kafka-odin-portal
odin服务存活情况
influxdb-ng
13
3
---
## Page 19
监控系统
InfluxDBProxy
NSQ
InfluxDBCluster1
NSQProxy
NSQ
InfluxDBCluster2
OdinAgent
Event1
Event2
Event3
LogAgent
Zooke
AlarmProxy(Consistent Hash)
eper
Alarm1
Alarm2
Alarm3
Channels
WorldTree
Callback
SMS
IRC
滴滴打车
---
## Page 20
部署系统
部署发单
上线发单
查看上线单
oi-test
标题
不能为空
ommon
driver
rpm包名
gs-api-driver-status-online-166-20160413224940.x86_6
获取rpm包
order
web
不能为空
ermes-api
!de
api
节点空间(ns)
deploy.api-web.gs.didi.com
api-script
发单人
lupei
审批人
请选择审批人
审批人添加请取
影响范围
!de
---
## Page 21
部署系统
部署动作：CLI
iaoju@hustono1:~shuston -h
sage: huston
[4-]
{deploy,revert,query,info,list_deploy,create_deploy,list,host}
)sitional arguments:
{deploy,revert,query,info,list_deploy,create_deploy,list,host}
deploy
deploy help
revert help
revert
query
stage help
info
info help
list_deploy
list_deploy help
create_deploy
create_deploy help
list
list help
host
host help
)tional
arguments:
show this help message and exit
-h, --help
---
## Page 22
部署系统
部署流程：
构建、工单、发布
构建
Jenkins
YUM源
编译打包
获取安装包
获取包版本
部署
工单
Deploy
部署模板
部署策略
服务树
---
## Page 23
运维系统建设的思考
·开源与自研的权衡
·阶段性选择
·选择性吸收
业务需求与系统建设速度的匹配
·开着飞机换引擎
·Plan B
团队建设的痛点
·纯研发运维研发
·运维人员的成长
---
## Page 24
展望白银时代
成本：
稳定性：
容器化
异地多活
部署：
监控：
动态调度
指标量化
多集群
覆盖率
---
## Page 25
Join us
PI:EMAIL
随手写的
北京海淀
---
## Page 26
THANKYOU
滴滴
---