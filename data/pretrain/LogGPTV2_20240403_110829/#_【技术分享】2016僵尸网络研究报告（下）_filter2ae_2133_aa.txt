# 【技术分享】2016僵尸网络研究报告（下）
|
##### 译文声明
本文是翻译文章，文章来源：cyren.com
原文地址：
译文仅供参考，具体内容表达以及含义原文为准。
****
****
****
**翻译：**[ **pwn_361**
****](http://bobao.360.cn/member/contribute?uid=2798962642)
**预估稿费：300RMB**
**投稿方式：
发送邮件至[linwei#360.cn](mailto:PI:EMAIL)，或登陆[网页版](http://bobao.360.cn/contribute/index)在线投稿**
****
**  
**
**传送门**
* * *
[**【技术分享】2017僵尸网络研究报告（上）**](http://bobao.360.cn/learning/detail/3412.html)
**十、在Necurs僵尸网络生命的前24小时**
Necurs是一个臭名昭著、极端危险的僵尸网络，在全球传播像“wildfire”这样的恶意软件，直到2015年十月份，在一个国际执法部门的努力下，它被下线了。然而，几个月后，这个神秘的僵尸网络又出现了，并开始传播Dridex和Locky恶意软件，在2016年六月份又一次消失了。几周之后，又出现了，并开始传播Locky恶意软件。为了更好的理解Necurs，及它是如何工作的，Cyren的安全专家重现并分析了一个真实的Necurs僵尸网络前24小时的活动。
**第一天：**
**9:46 AM.传送**
僵尸恶意软件通过邮件方式到达欧洲的一台计算机，“crashreporter.exe”恶意软件作为邮件的附件，并伪装成“Mozilla基金会”。这个僵尸恶意软件属于Necurs僵尸网络，Cyren将其作为“w32/necurs.c.gen!eldorado”，成功的探测到。
**10:03 AM.感染**
未加怀疑的受害人打开了邮件和邮件附件。
**10:05 AM.环境感知**
在启动以后，僵尸程序运行的第一阶段是搜索已知的虚拟环境指标、及调试器、和其它的监控工具，如果发现存在这样的环境或工具，根据僵尸软件的运行流程，它会将自己结束掉。
**10:05-10:08 AM.创建一个合适的工作环境**
在这个例子中，僵尸程序将自己复制到以下几个位置：
并将自己复制到临时文件夹：
然后，检查机器的语言环境(有些情况下，当检测到某些语言环境时，恶意软件将会主动结束)，比如，Locky勒索软件不会在俄语系统中运行。在这个例子中，该僵尸软件检测到这个机器是英语环境，接下来，它做了以下几件事：
a. 给syshost.exe程序创建一个服务，名称为“syshost32”(对于受害人，这个名称可能不会引起注意)，然后启动服务。
b. 删除之前创建的临时文件。
c. 通过几个命令，绕过计算机的防火墙和白名单。
**10:08 AM.连接控制端**
僵尸程序开始确定计算机能否联网，通过连接DNS服务器，并访问“Facebook.com”，如果DNS服务器解析了“Facebook.com”域名，僵尸程序为了找到一个响应的C&C服务器，会立即发起域名生成算法(DGA)，并首先尝试以下四个域名：
如果上面四个域名无法连接，接下来，僵尸程序为了连接到C&C服务器，会实施B计划。
**10:09-10:19 AM.尝试一个新计划**
在检查了正确的时间后，僵尸程序为了找到C&C服务器，开始第二次尝试，首先对“qcmbartuop.bit”中的数据进行57次尝试解析，如果失败，就对“Microsoft.com”进行尝试解析，如果还是失败，就进行C计划。C计划是使用域名生成算法，尝试连接2076个域名。以上所有都失败的话，还会有一个D计划，它会尝试连接一个C&C服务器，IP地址作为硬编码已经被写入到了程序中。在10.12分，从该IP服务器上得到了回应，这个机器正式沦陷了。
**10:20 AM.联通**
最后，从一个硬编码的IP服务器得到了回应，僵尸主机成功上线，成功连接到了一个位于乌克兰的C&C服务器。僵尸主机将机器的有关信息进行加密，并上传给C&C服务器，然后僵尸主机随时等候下一步的命令。
**11:13-4:30 PM.接收任务数据**
乌克兰的C&C服务器向僵尸主机发送大量的数据。包括软件的升级、目标地址、及稍后要发送的垃圾邮件的内容。此外，僵尸主机还尝试连接了其它C&C服务器，但都失败了。
**10:21-11:14 PM.开始发动垃圾邮件攻击**
该僵尸主机根据当天收到的指令，开始发送垃圾邮件。时间似乎是经过选择的，确保在美国的工作时间中。首先，僵尸主机开始寻找能用于发送垃圾邮件的SMTP服务器。起初尝试连接Gmail
MX和Yahoo的服务器，但是都被拒绝了。几次尝试之后，成功连接到Yahoo和Hotmail的服务器，然后开始发动垃圾邮件攻击。
在11:14，“live.com”通知僵尸主机：“我们对于每小时和每天发送的消息数量是有限制的”，然后僵尸主机主动停止了当天的攻击。
**第二天：**
**10:47 AM.勒索软件攻击**
在晚上已经收到了附加的加密信息，该僵尸主机开始通过发送钓鱼邮件的方式传播Locky勒索软件，邮件包含一个附件，该附件是一个经过压缩的JavaScript下载者。
**11:00 AM.完成了一天的工作**
在最初的24小时里发生了很多事情,想像一下，在僵尸网络所有僵尸主机的共同努力下，这是一个怎样的效果啊。
**经验教训**
在前24小时的生命中，该僵尸恶意软件被安装到计算机中，然后找到C&C服务器、自身软件升级、传播垃圾邮件、和Locky勒索软件。包含了三个关键点：
1.僵尸主机尝试了成千上万种不同的选择，非常执着的找到了一个C&C服务器。
2.这个已经有两年的旧恶意软件成功的被一个工作的C&C服务器所管理，C&C服务器迅速对其进行了升级，证明了潜在威胁的弹性。
3.该僵尸程序在相当长的一段时间中是不活跃的，可能由于以下几个原因：(a)等待更长的时间会自动防止沙箱的检测；(b)非活跃状态可以减少被感染计算机的资源使用；或者(c)僵尸程序的垃圾邮件/恶意软件活动是针对一个特殊的目标。
**十一、躲在暗处：僵尸网络如何掩盖通信**
僵尸网络最大的弱点在于僵尸主机需要和C&C服务器进行通信，因为通过网络流量可以发现它。因此，网络犯罪分子使用各种方法来混淆僵尸网络通信，使它更难检测到僵尸主机的存在。多年以来，网络犯罪分子已经探索和发展了一系列越来越复杂的方法，来确保他们的非法网络能共享关键信息和指令。
基于Tor的僵尸网络：Tor是一个众所周知的匿名通信工具，引导用户的互联网流量通过一个免费的、被设计成跳转数千次的全球网络，用来躲避各种类型的监控或分析，从而隐藏用户的位置和习惯。最近，犯罪份子已经使用Tor来隐藏C&C服务器了，并运行在IRC协议之上。因为Tor是匿名的，用户的身份是隐藏的。在加上，所有的Tor流量都是加密传输的，因此，它能避过入侵检测系统，而且使用Tor网络是合法的。但是Tor网络也有一些缺点，这些缺点也影响到了僵尸网络，包括延迟、减速、和不可靠。
域名生成算法(DGA):因为C&C服务器的域名通常是作为硬编码写入到程序中的，安全方案可以相对容易的找到并阻止它们。为了避免被阻止，一些僵尸网络采用了域名生成算法，可以生成大量域名，从而使安全方案阻止它们变得很难。当然，并不是所有域名都会起作用，僵尸程序通常会遍历这个列表，直到找到一个能正常通联并使用的C&C服务器的域名。就像前面我们讲到过的，Necurs僵尸网络就使用了DGA。
互联网中继聊天(IRC)僵尸网络：IRC协议被第一代僵尸网络采用并用于犯罪目的。在一个IRC僵尸网络中，僵尸主机会作为一个客户端去连接IRC，并自动执行功能。IRC僵尸主机比较容易创建和管理，但安全专家通常有能力识别出这些服务器和僵尸控制者、并关闭僵尸网络。最近，IRC僵尸网络经历了一个小的复苏，得益于某些技术的发展，如使用多个C&C服务器，这使快速关闭IRC僵尸网络的机会变得少了。
加密/复杂协议：不仅仅是对消息进行加密，而且最好使用特殊的僵尸网络协议。就像后面我们要讲到的例子一样，任何通信字符串前都有多个报头和代码，这使得理解僵尸网络数据变得非常难。一些僵尸网络恶意软件，比如Gameover
Zeus的木马，传播的恶意软件和C&C的通讯都会被加密。在这个例子中，从被控服务器下载恶意软件时用了SSL进行加密，恶意软件被安装后，僵尸主机和C&C服务器的通信数据也会被加密。
社交网络：为了有效的躲避探测，新的恶意软件使用了社交网络，和基于WEB邮件的C&C通信。安全研究人员已经发现有些恶意软件从tweets和Pinterest的评论中接收C&C的数据。