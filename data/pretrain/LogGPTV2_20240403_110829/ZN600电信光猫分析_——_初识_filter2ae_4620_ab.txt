这里有一个小问题，电信的工程师或者乙方工程师有考虑过OpenWrt的开源软件许可权吗？OpenWrt是遵循GNU GPL
v.2许可的，按理说，相关基于OpenWrt二次开发的源代码以及用于管理Lxc容器的saf程序的源代码都应该是要公开的吧？
## 0x02：与PT632光猫的软件对比分析
###  1、关于“Linux tc”
之前，team一直都以为天翼网关用的是Tiny Core
Linux，简称tcLinux，但是这个“事实”似乎遭受到了挑战。从参考文章[3]来看，电信研究院定制开发了自己的“智能”操作系统。在电信ZN600光猫上，执行uname命令得到如下信息：
很明显，系统用的是Linux而不是Unix，其中那个“tc”到底对应什么？我们team开始产生分歧了，我个人 觉得应该是Tiny
Core这个单词中tc的缩写，但是他们都认为就是Tele前缀和communication这个单词的首字母缩写。当然，这个好像对于hacking而言没有太大关系。再者，人电信说是“智能”操作系统也没问题啊，小米的路由跑上OpenWrt不也就变身“智能”路由了吗？当然，如果天翼网关中跑的是Tiny
Core Linux的话，那从内核信息来看，这应该是从一个很老的Tiny Core Linux系统fork过来的版本了。
总的来说，不论天翼网关的操作系统是否为Tiny Core
Linux，在天翼网关从1.0版本升级到最新的4.0版本，系统本身并没有多大变化，依旧在使用自己定义的xml格式配置文件存储信息，依旧在使用tcapi命令来读写这个xml配置文件，依旧在使用那一套老的Web
App来进行光猫的管理与配置。
###  2、Busybox略有升级
Busybox依旧是“阉割”过的版本，没有alias，没有find，没有ftpd，当然也有一些升级，比如把grep添加进来了。在telnet远程连接到ZN600时，有grep过滤一下，可以更加从容的处理想要的信息了。其实，我们在讨论为什么grep会拿进来？莫非是电信工程师们也觉得在debug的时候，或者在查看、修改配置文件的时候，面对一堆的输出结果很费眼？
当然，我们还是觉得电信工程师在Busybox的“阉割”上是做得非常好的，不出意外应该是三大里头做得最好的，毕竟多暴漏一个对于自己没有意义的命令就算不会便宜那帮“黑客”，但至少对自己没任何好处啊。。。至于移动、联通的猫嘛，等master买回来了我们会一一为大家解剖的。
###  3、Boa原地踏步
其实，严格意义上讲，电信天翼网关 4.0跑了两个HTTP
Server，一个是boa，另一个则是OpenWrt项目中的Luci。对于后者，大家应该很熟悉，因为OpenWrt火啊，再者登录自己天翼网关的时候都会看到类似:
[http://192.168.1.1/cgi-bin/luci这样的链接，其中cgi-bin/luci就是Luci](http://192.168.1.1/cgi-bin/luci%E8%BF%99%E6%A0%B7%E7%9A%84%E9%93%BE%E6%8E%A5%EF%BC%8C%E5%85%B6%E4%B8%ADcgi-bin/luci%E5%B0%B1%E6%98%AFLuci) HTTP
Server的web根目录。然而，对于boa的话，熟悉的人应该不多，虽然我们在之前PT632光猫的文章里也讲过，但是boa这个项目似乎已经流产了，没有更进一步的信息。
可能是碍于Boa已死的事实，电信工程师也赖得对boa进行升级了，只要保证系统能够正常使用（GPON终端）能够正常使用就行，当一天和尚撞一天钟嘛，何必跟自己认真呢？至于“智能”化的责任嘛，那就全部丢给了后面的OpenWrt吧。。。
###  4、Lxc开天辟地
前面，我们说到了电信在天翼网关中引入了容器技术，这举动应该是运营商里头最为激进的。这话是master说的，他是在分析最新的移动和电信光猫之后得出的结论，但是我觉得有点突突，毕竟咱team不是还没碰联通的猫吗？
当然，电信工程师在天翼网关中引入容器技术的确很超前（相对于另外两个龟速选手），但是也不至于像中国电信上海研究院领导PPT里头讲的那么夸张，“先进的容器隔离技术”。Linux
Container，lxc，仅仅是一种操作系统级别的虚拟化技术，而且都已经玩儿了十几年了，怕谈不上先进吧？
再者，不得不再次表扬电信工程师们，把lxc也给无情的“阉割”了，“阉割”了，“阉割”了。。。Lxc默认安装之后，lxc软件包里头原本有许多个命令，如下图所示：
结果，电信工程师们把Lxc给“阉割”得啥也不是啊，比太监都还不如啊，就只剩下了四个命令，如下图：
如果你们认为电信工程师们就这点狠劲儿的话，那你们太小看他们了。除此之外，他们还专门写一个叫做“saf”的容器管理程序，专门用来管理名为saf的容器（OpenWrt的母体）。我们team头脑风暴了好几次，始终没明白这个“saf”是啥意思？关键是，这个程序的console选项需要输入密码！密码！密码！而且，这个密码不是电信超级用户密码。
由于Lxc被阉割，没办法通过lxc-attach或者lxc-console命令进入OpenWrt容器，那么也就没法安装OpenWrt插件。这一切都是拜saf所赐！当然，牛人无处不在，chinadsl.net上的大牛songee就自己写了一个脚本绕过saf，实现了在某些型号的天翼网关上跑新版OpenWrt，拜一个先！！！
###  5、OpenWrt顺应发展
在我们看来，天翼网关3.0开始以来，电信工程师们就试图在人员有限的情况下找到一条对抗互联网公司试图“逼宫”的出路。毕竟，猫才是千家万户接入互联网的第一个隘口，小米，360，极路由啥的寄希望于在“王”的背后建立起另一个国中国，并试图从三大抢走资源与用户，这个不是摆明了找死吗？电信研究院能眼看着地盘被抢吗？于是，一场不是你死就是我活的决斗开始了。电信工程师取了个巧，确切地说是跟着学，用成熟的OpenWrt框架作为自己路由功能的技术依托和支撑，然后借助OpenWrt庞大的生态（相比其他软路由）来解决自己人员不足的问题，这么一来其他什么“智能路由”或者“傻瓜路由”都没活路了。。。
貌似跑题了。。。
从技术上来说，为了能够减小所需付出的研发成本，然后以最快的时间解决战斗，电信工程师们选择基于
“先进的容器技术”——Lxc容器技术，为自己猫武装上OpenWrt。
## 0x03：小结
本以为一篇文章就能够把ZN600说清楚，但是拿到猫之后发现两个代际的变化真不是盖的，很多东西需要静下心来仔细分析，认真的品一品电信工程师们的技术路线更迭。当然，总的来说电信的新款光猫给人的感觉依旧是“虽然不咋地，但是三大我第一”。
1、在技术上电信光猫的确走在了前头（相比于另外两只乌龟），不论是出于市场的需要，还是图自己省事儿的“初心”，总之采用“先进的容器隔离技术”让原本索然无味的光猫有了一丝嚼劲儿。
2、OpenWrt的引入让光猫这个原本定位清晰的EPON终端变得更加鬼魅，当然也顺势通过“全屋Wi-Fi”的概念抢走了一大块儿市场蛋糕。
3、在安全的考量上电信光猫无疑是做得非常好的。当然，这个“好”并不是单纯指技术，更重要的是在busybox等软件的“约束”上体现出了很严谨的软件安全思维。master他老人家说，这一点非常值得我这种脚本小子和网安小白虚心学习。
## 0x04：参考
1、《PT632电信“老猫”分析》.   
2、ZN600@深圳兆能科技有限公司.
3、《打造智慧家庭连接新生态，中国电信明年推天翼网关3.0版本》.   
4、《F650/F450、HS8145等ARM平台，LXC容器内运行 OpenWrt 19.07.1 子系统》.