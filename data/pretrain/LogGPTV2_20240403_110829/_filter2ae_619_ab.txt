【友情提示】andrax一直没有把traceroute命令集成到系统之中，而且也不允许用户自行安装软件，因此只要麻烦一点，用nethunter来执行traceroute命令追踪路由。  
在这个学校的xx物联网大楼大厅中有一个休息区，有桌子和椅子，身为肥宅的我选择坐下慢慢玩耍。打开电脑，连接部署在一加手机上的Andrax，这样就可以避免在电脑上跑Kali或者Andrax（PC版本），对于IoT环境下的hacking而言，控制电能损耗格外重要。
第一步，在andrax上执行nmap扫描：  
nmap -sS -p21,22,23,53,80,139,445,1433,3306,3389,8080 -oX scitc_iot.nmap —min-hostgroup 32 192.168.10.85/24
为了加快扫描速度，我使用了—min-hostgroup选项，并设置了一个特别高的数值，可能还会有误报，但是快啊。
192.168网段端口开放情况如下：
因为发现了172.31网段，自己的心思就没放到192.168网段上。通过nmap扫描，得到了172.31段的主机及端口信息，这个段果挺有意思的，设备丰富，内容多彩。
与此同时，我通过以下命令对发现的10.10网段进行了扫描：  
nmap -Pn -p21,22,23,25,80,139,443,445,1433,3389,8080 -oX _*_ c_iot_10.10.nmap
—min-hostgroup 256 10.10.0.0/16
虽然我已经把—min-hostgroup调到了256，但是直到下午比赛快开始的时候，才刚刚扫完，因此对于这个网段没有进行任何的横向扩展操作，仅仅是nmap扫描。下面给出的是开放了ssh或者telnet服务的主机。内网中一般只有网关设备会打开telnet或者ssh服务，再加之对这些主机IP的地址分析，很容易辨别出哪些是网关设备。
另外，从10.10网段的扫描结果中，我们发现了445端口。由于电信运营商封锁了445端口，因此从这个扫描结果我们可以进一步证实10.10网段不是电信的大内网，而是这个学校自己的校园网。
## 0x04:一个Wi-Fi密码引发的“血案”
因为扫描操作十分耗时，因此如前所述，我没有机会触碰到10.10的校园网。然而，在这个172.31网段中，却有一些意外之喜。
在这个网络中，我们发现了一台网络打印机。与其他部署于企业内部网络的打印机一样，这个打印机连最基本的权限管理都没有设置，通过默认密码即可登录管理员界面，查看设备状态，查看系统日志（包括留有文件名称的文件打印日志）以及证书（厂商预置的，应该没什么用）。
另外，在这个172.31网段中发现了至少3种IP摄像头，其中包括下面这个海康威视的设备。这台设备的admin账户登录是需要密码的，而且并不是厂商预设的默认密码，并且开启了登录尝试限制。尝试了admn，admin123，123456之后，已经完全没有抱任何幻想了，于是尝试了最后一把，即Wi-Fi密码，“ ** _*_** 1”。搞定，浏览器很痛快的给出了admin界面。
之前，还从来没碰过海康威视的IP摄像头，只是听说功能强大，能够支持网络存储。这次算是开了眼啦（当然，如果厂商愿意资助我们team做研究的话，不胜感激）。
从海康威视的Web管理界面来看，这些监控视频是可以下载的，不过都挺大的。
因为时间原因，整个hacking过程持续了接近3个小时。其实，有一半多的时间耗费在了寻找校园网接入的阶段，不仅要到处瞎逛，还得蹲在那儿测试。
## 0x05:案例总结
这个基于安卓手机的近源渗透案例其实没有什么技术含量，主要是利用了这个学校在校园网建设过程中存在的网络接入管理不严格等问题。
再者，网络管理员对于内网设备的管理是存在明显漏洞的，且不说那台默认密码的网络打印机（毕竟，几乎所有内网都是这个鬼模样，也不能过多强求）。但是，摄像头的登录密码无论如何不应该与Wi-Fi密码一致，里面存的可都是监控视频啊，指不定什么时候还可能作为呈堂证供。要是哪个黑客给一锅全删除了，那网管可就真凉凉了哦。。。
最后，这次近源渗透给我最大的启发或者说自己的些许感受，那应该是master说的那句：不要轻言轻易，坚持一下，哪怕再坚持一下，一切就有转机了。
## 0x06:参考
1、 andrax官方网站.   
2、 Kali Nethunter官方文档.   
3、 海康威视网络摄像机默认密码.
4、 海康威视硬盘硬盘录像机系列.