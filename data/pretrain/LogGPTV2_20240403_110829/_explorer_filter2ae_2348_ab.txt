访问http://msupdate.info/uni/MD5/explorerx64.exe.md5，获取最新矿机、木马ps1脚本MD5值，然后对比本地矿机、木马ps1脚本MD5值决定是否更新，若有更新，则创建任务计划”update”将文件下载到c:windowsfontstemp，然后覆盖旧文件。
更新办法：
19、根据硬件UUID，判断硬件性能，选择挖矿模式
20、测试连接矿池703端口，poolstemp.txt来源于pools.txt，根据配置和矿池连通性，从中选取一条配置，创建配置信息$GeneralPathconfig.json。
21、接着再释放一段加密代码，到c:windowssystem32driversen-USGpCheck.ps1，同上面方法，代码中的iex改为echo，解密代码，发现其作用是维护更新文件、端口转发、防火墙策略、测试矿池连通性等。
22、写入xml文件到c:windowsfonttemptask.xml，该文件作用是利用任务计划创建gpcheck，调用gpcheck.ps1
23、释放加密代码到c:windowsSystem32driversWmiPrvSE.ps1，同上方法解密其代码
首先使用wmi创建了挖矿进程 c:windowsFontsttfexplorer.exe
一旦发现分析工具，则中止挖矿进程
24、再次释放了一个精简版gpcheck.ps1，其主要功能不变但精简了不少检查。
**从第23个步骤开始进入explorer挖矿分支，矿机会监听999端口，通过本地访问可以获得矿机状态信息。**
账户adm，密码14370
## 四、IOCS
**URL**
http://msupdate.info/uni/explorerx64.exehttp://msupdate.info/uni/explorerx86.exehttp://msupdate.info/uni/visual.ziphttp://msupdate.info/test.txthttp://msupdate.info/uni/MD5/explorerx64.exe.MD5
http://msupdate.info/uni/MD5/explorerx86.exe.MD5
http://msupdate.info/uni/MD5/explorerx86.exe.md5
http://msupdate.info/uni/MD5/explorerx64.exe.md5
**File**
C:WindowsFontsarialC:WindowsFontsLogsC:WindowsFontstempC:WindowsFontsttfc:windowsSoftwareDistributionconfig.xml
c:windowssystem32driversen-USGpCheck.ps1
c:windowsSystem32driversWmiPrvSE.ps1
C:WindowsSystem32driversetcservices
C:WindowsSystem32driversetcprotocol
C:WindowsSystem32driversetcnetworks
C:WindowsSystem32driversetclmhosts.sam
C:WindowsSystem32driversetchosts
**Domain/Ip**
msupdate.info（185.48.59.45:80）185.48.59.52:34444185.48.59.51:24444185.48.59.50:14444
追踪：查询矿池代理服务器为俄罗斯IP，服务器也是俄语操作系统
所有IP都属同一个C段，相信这至少是一个长期的据点。
## 五、处置方案
### 1、进程清理
清理转发规则：
Powershell运行以下命令
> Start-Process PowerShell.exe -ArgumentList(“-c &{netsh interface portproxy
> delete v4tov4 listenport=757;netsh interface portproxy delete v4tov4
> listenport=703;pause}”) -Verb runas
清理带有System32driversWmiPrvSE.ps1文件路径的进程（可能已经退出）
### 2、注册表清理
病毒配置：HKEY_LOCAL_MACHINESYSTEMSoftwareMicrosoftDriversPath
防火墙配置清除
检查防火墙配置HKLM:SOFTWAREPoliciesMicrosoftWindows
DefenderExclusions，将防火墙策略配置修改为正常状态
修改HKLMSYSTEMCurrentControlSetControlSecurityProvidersWDigestUseLogonCredential
为0为0
### 3、文件清理
删除目录及文件
C:WindowsFontsarial
C:WindowsFontsLogs
C:WindowsFontstemp
C:WindowsFontsttf
c:windowsSoftwareDistributionconfig.xml
c:windowssystem32driversen-USGpCheck.ps1
c:windowsSystem32driversWmiPrvSE.ps1
C:WindowsSystem32driversetcservices
C:WindowsSystem32driversetcprotocol
C:WindowsSystem32driversetcnetworks
C:WindowsSystem32driversetclmhosts.sam
C:WindowsSystem32driversetchosts
若为域则要清除\$domainsysvol$domainPolicies及其子目录下的explorer.exe
正常情况下文件资源管理器是看不到logs目录的，而且显示了隐藏文件夹（win10和winserver2008下）也看不到，但可以在cmd或者powershell可以探测到
使用PCHUNTER强行删除，或者进入安全模式下删除，或者使用强力的杀毒软件对指定目录进行清除。
### 4、服务清理
服务名cspsvc，显示名为Cryptographic Service Providers。
### 5、任务计划清理
任务计划GpCheck
### 6、批量排查
Nmap批量扫描999端口
账户adm，密码14370