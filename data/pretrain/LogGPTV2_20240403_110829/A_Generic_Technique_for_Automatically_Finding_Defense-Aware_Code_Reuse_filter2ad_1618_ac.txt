.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
4-6 System-call-based implementations of backdoor and reverse backdoor .
. .
. 41
.
.
.
.
.
.
.
.
. 17
. 27
. 28
. 30
. 35
. 35
. 37
. 39
.
.
.
.
.
.
.
.
.
. 42
. 44
. 44
. 46
. 53
. 55
. 59
. 60
. 61
4-7 ROP gadget for connect(fd, &addr, 0x10) . .
4-8 Reverse Backdoor using NSPR .
4-9 Downloader using APR .
.
.
.
4-10 Self-Modifying While Loop .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
4-11 Generic self-modifying Return-into-Libc while loop .
4-12 Self-modifying while loop in APR .
5-1 Control ﬂow graph for sort
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
5-2 Search from a vulnerable function to a call of execv .
6-1 Assembly code to call system from LYCopyFile .
6-2 Payload to call system . .
.
.
.
.
.
.
.
.
.
6-3 Assembly code for gadgets used by uploader .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
. .
.
.
.
.
.
.
.
.
.
. .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
. .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
6-4 Injected stack frame to upload a ﬁle. Pseudocode for the gadgets is given
on the right.
. . . . . . . .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
. 62
9
6-5 Assembly code for gadgets used by the downloader .
.
.
.
.
.
.
.
.
.
.
.
. 64
6-6 Injected stack frame to download a ﬁle. Pseudocode for the gadgets is given
on the right.
. . . . . . . .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
6-7 Assembly code for gadgets used by the root inserter .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
. 65
. 66
6-8 Injected stack frame to open a ﬁle in append mode before downloading.
Pseudocode for the gadgets is given on the right .
.
A-1 ROP gadget for dup2 (duplicate a ﬁle descriptor) .
A-2 ROP gadget for accept . .
.
A-3 ROP gadget for sendfile .
A-4 ROP gadget for bind . . .
.
A-5 ROP gadget for execve . .
A-6 ROP gadget for listen . .
A-7 ROP gadget for open . . .
.
A-8 ROP gadget for socket . .