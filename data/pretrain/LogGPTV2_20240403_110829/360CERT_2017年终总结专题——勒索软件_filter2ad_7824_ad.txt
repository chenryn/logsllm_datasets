自“Shadow
Brokers”发布泄漏的文件后已经超过大半年的时间，而微软公司也早就发布安全补丁。但是实际情况是今年利用永恒系列漏洞的勒索软件已经出现过多次，且每次都在全球范围引起了不小的轰动。然而让人无奈的是依然还有大量设备未对漏洞进行修复，这也是自
WannaCry 以来能够多次爆发蠕虫的原因。
###  针对各类数据库勒索事件
## 0x01 简介
2016年12月末至2017年1月初，国外部分用户发现自己MongoDB数据库的数据被黑客删除并发推引起了互联网的注意。黑客把数据库里的数据都删除了，并留下一张“warning”的表，里面写着如果想“赎”回数据，就给0.2比特币（约等于200$）到某比特币账户地址。
在接下来的时间中，陆续有更多的MongoDB数据库被黑事件曝光。该事件最早是由Harak1r1黑客组织发起的，后续有多达20个黑客组织跟进，他们勒索的赎金从0.1到1比特币不等，短短数天时间已有约3万多MongoDB中招；据不完全统计，3天之内被删除的MongoDB数据量超过100TB。
在接下来的一年中陆续发生了针对ElasticSearch、Hadoop、MySQL、Redis、PostgreSQL、CouchDB等数据库系统的入侵勒索事件。
这些公网上存在漏洞的数据库，被攻击者删除了数据库中的存储数据，并留下勒索信息，要求用户支付赎金。更有甚者直接清空数据库，并没有对数据进行保存，即使支付赎金也无法挽回损失。
## 0x02 攻击技术细节
在针对MongoDB、MySQL、Redis、ElasticSearch、CouchDB、Cassandra等数据库的攻击中，大多数的攻击只是利用了数据库软件本身的缺陷：如未授权访问、用户弱口令。在未授权进入数据库后一般会删除数据并留下联系方式进行勒索，甚至利用数据库本身的特性或者漏洞进行后续的攻击。
例如在开启MongoDB服务后，如不添加任何参数，默认是没有权限验证的。登录的用户可以通过默认端口无需密码对数据库进行任意操作（包括增、删、改、查等高危动作），而且可以远程访问数据库。
在针对MySQL的大规模勒索中，攻击者攻击以“root”密码暴力破解开始，一旦成功登陆，该黑客会获取已有MySQL数据库及其表的列表，TA在已有的数据库中新建一个名为“WARNING”的表，插入信息包括一个邮箱地址、比特币地址和支付需求。
在针对Redis的攻击中，主要是结合Redis未授权访问漏洞以及利用Redis写入文件的技巧，在用户目录下写入一个ssh的私钥，从而不用输入密码即可登录Redis所在服务器。
在针对ElasticSearch的攻击中主要利用利用了未授权访问漏洞。由于默认情况下没有任何身份认证，在建立连接之后可以通过相关API对ElasticSearch服务器上的数据进行增删查改等任意操作。攻击者会删除Elasticsearch所有索引信息，并创建一个名为warning的索引，勒索者写入需要支付0.2比特币才给受害者发送数据（目前按照比特币市场价格，约等于150美元），并留下邮箱地址。
针对Hadoop的勒索中利用HDFS的Web端口50070直接在公网上开放。因此攻击者可以简单使用相关命令来操作机器上的数据。
CouchDB会默认会在5984端口开放Restful的API接口，用于数据库的管理功能。任何连接到服务器端口上的人，都可以调用相关API对服务器上的数据进行任意的增删改查。其中通过API修改local.ini配置文件，可进一步导致执行任意系统命令，获取服务器权限。
## 0x03 事件影响
针对MongoDB的勒索中，通过当时Shodan网络空间搜索引擎得到的数据和显示：2017年初的勒索事件有近3W台MongoDB服务器受到影响。
针对ElasticSearch的勒索中被删除的数据至少500亿条，被删除数据至少450TB。在勒索事件发生后，有1%的Elasticsearch启用了验证插件，另外有2%则关闭了Elasticsearch。
在后续针对各类数据库的攻击中，每次均有成百上千的数据库遭到攻击，数据被全部清除，造成了无法挽回的损失。
## 0x04 小结
360 CERT于2017年7月对MongoDB勒索情况进行了复查，发现仍然有数千个数据库存在漏洞，并且绝大多数的数据库已被删库勒索。
同时也针对Apache
Solr的未授权访问情况作了调查，发现公网存在大量未授权访问的数据库系统，其中涉及数据上百TB。（下图为360CERT以发现的Apache
Solr未授权访问漏洞在全球的分布状况）
针对数据库系统的勒索行为不断发生，其勒索的方式主要是利用系统的未授权访问、弱口令以及自身的漏洞获取数据库权限，然后删除其中数据，并留下联系方式进行勒索。
传播方式与蠕虫、病毒感染有所区别，主要是通过各类扫描与指纹搜索引擎，找到匹配的产品后进行针对性的攻击。
通过360CERT与360网络安全研究院的数据显示，各类数据库在世界范围内拥有广泛的使用，同时针对各类数据库的扫描和攻击也从未停止。
由于数据库本身安全性问题和用户数据的高价值性，当下数据库已经成为一个被常态化的攻击目标。
## 总结与未来趋势
WannaCry是2017年度影响范围最大的新型勒索软件，通过利用漏洞，迅速传播至全球。在WannaCry爆发后不久，新变种的Petya、Bad
Rabbit卷土重来，并综合了更多网络传播方式，破坏性也更强。
从今年的几起重大勒索事件看出，勒索事件的整体模式并无太大变化，但能够大范围传播的重要因素是利用了NSA（美国国家安全局）泄露出的黑客工具，通过利用其中0/N
day漏洞，造成感染量呈几何级增长并向全球蔓延，最终给众多用户造成严重威胁。
另一方面，勒索软件最早诞生于1989年，近三十年间一直存在。近年来才变得愈发猖獗，其中一个关键因素是2009年后以比特币为首的大量高匿名性货币的流行。
同时我们也发现勒索软件在向路由器、工业控制设备、智能家居等IoT设备方向蔓延，涉及的系统也开始多元化，勒索的对象也开始产生针对性。以下将会是勒索软件发展的趋势：
  * **勒索软件攻击事件常态化**
在未来一段时间内，这种攻击手段在短时间内是不会消失的，因为勒索软件能够给攻击者带来巨额的利润。
  * **漏洞传播将成为趋势**
漏洞利用勒索这种方式暴力、有效、影响范围广，能让攻击者短时间内达到目的。
  * **IoT** **物联网新兴设备受到的威胁增加**
物联网在当下已经越来越普及，这部分设备受到攻击的风险也会越来越大。
  * **针对性攻击将越来越多**
针对国家、企业的攻击比个人的更有价值，带来的后果也更是难以预料的。
## 防护建议
  1. **通过合作与情报共享**
随着“大安全时代”概念的提出，安全这个话题的核心不再是某一个点、一个人、一家厂商的安全，而是互联网整体生态的安全。通过加强官方与厂商、厂商与厂商之间的合作，能够及时有效地对某一安全事件进行感知和预警。360协助美国FBI破获Mirai僵尸网络正是这样的例子。
  2. **通过技术保障**
不论如何，通过技术进行保障都是必不可少的。我们给出如下建议：
针对企业：
  * 定期备份重要文件，并离线存储独立设备。
  * 对内部网络进行严格划分，防止恶意软件的内网传播；定期对企业内部各个系统进行安全扫描与系统升级。
  * 加强员工安全意识培训。
  * 不要盲目给勒索者付赎金，有些勒索软件加密后根本无法解密
针对个人:
  * 安装反病毒软件，定期查杀病毒；及时更新系统或第三方软件补丁，避免勒索软件利用漏洞进行传播感染。
  * 对非可信来源的邮件、链接保持警惕，不要轻易下载运行文件、邮件附件或浏览邮件中的不明链接。
  * 在可靠的软件宝库/软件源/商店下载应用程序。
## 参考引用
2017勒索软件威胁形势分析报告
[http://zt.360.cn/1101061855.php?dtid=1101062360&did=490927082](http://zt.360.cn/1101061855.php?dtid=1101062360&did=490927082)
《MongoDB勒索事件现状调查报告》
《Apache Solr 已知版本漏洞现状基本调查报告》
《MongoDB的勒索攻击者瞄准了ElasticSearch 中国已有受害者》
《WanaCrypt0r勒索蠕虫完全分析报告》
https://www.anquanke.com/post/id/86092
《360天眼：WannaCry（想哭勒索蠕虫）技术分析》
《Petya勒索蠕虫完全分析报告》
《Petya变种勒索蠕虫启动代码分析》
《NotPetya勒索病毒Salsa20算法实现的缺陷分析》
《坏兔子勒索病毒事件基本分析报告》
《KSB_Story_of_the_Year_Ransomware_FINAL_eng.pdf》