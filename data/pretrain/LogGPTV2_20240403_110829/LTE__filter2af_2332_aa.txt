# 触不可及：LTE 控制平面的动态安全分析
|
##### 译文声明
本文是翻译文章，文章原作者 Hongil Kim,Jiho Lee,Eunkyu Lee,Yongdae Kim，文章来源：eee-security.org
原文地址：
译文仅供参考，具体内容表达以及含义原文为准。
本文基于运营商的长期演进 (LTE) 网络中控制组件的动态测试，进行了对控制平面程序安全方面的广泛研究。对于 LTE
网络中的动态测试，我们通过使用用户可以完全控制的开源 LTE 软件，实现了一个名为 LTEFuzz
的半自动化测试工具。我们通过仔细分析标准定义三个基本安全属性，系统地生成了测试用例。
LTEFuzz基于安全属性生成测试用例并将其发送到目标网络，仅通过监控设备端日志，对问题行为进行分类。因此，我们发现了 36
个之前未披露的漏洞。这些发现分为对五种类型的不当处理：(1)未受保护的初始化过程，(2) 精心制作的明文请求，(3) 缺乏有效完整性保护的消息，(4)
重放的消息，以及 (5) 安全过程绕过。我们通过演示针对运营 LTE 网络的PoC攻击确认了这些漏洞。攻击的影响是拒绝向合法用户提供 LTE 服务、欺骗
SMS 消息或窃听/操纵用户数据流量。还提供了精确的根本原因分析和解决这些问题的潜在对策。蜂窝运营商部分参与维护道德标准并验证我们在商用 LTE
网络中的发现。
## 0x01 Introduction
长期演进 (LTE) 是迄今为止最先进的电信技术。与全球移动通信系统 (GSM) 和通用移动电信系统 (UMTS)
等老一代网络相比，它不仅可以提供更快的数据传输和低延迟，还可以确保针对意外故障的高可靠性和鲁棒性。移动网络运营商正在积极部署 LTE 基础设施；截至
2018 年，已有 200 个国家的 600 家运营商部署了 LTE 网络，全球用户超过 32 亿。  
除了促进数据和语音通话等传统电信服务外，LTE
还被认为是在新兴行业（例如自动驾驶汽车和物联网）和全国通信基础设施中提供始终在线的移动连接的关键推动因素（例如，用于铁路通信的公共安全 LTE 和
LTE-R）。通常，这些应用程序对安全至关重要，需要高可用性和稳健性。这意味着，如果这些应用程序因 LTE
服务的意外断开而出现故障，用户的安全可能会面临重大威胁。因此，调查可能因事故或攻击者而导致意外故障的对 LTE 服务程序的潜在威胁至关重要。  
第三代合作伙伴计划 (3GPP) 是 LTE
的事实标准，它定义了所有网络组件的行为，包括与早期网络相比已显着改进的安全功能（例如，更强的加密和完整性保护算法、强制使用完整性控制平面协议中的保护）。此外，它还为商用
LTE 芯片组提供一致性测试套件，以确保符合规范。  
尽管为消除意外错误的风险做出了许多努力，但最近的研究仍发现了 LTE 网络控制平面程序中的各种安全漏洞。例如，主动攻击者可以在移动设备和网络之间中继 LTE
通信以劫持设备的位置或重定向设备的 DNS 请求 。使用伪基站的攻击可以通过利用设备端设计缺陷和实现错误来跟踪用户设备的位置或拒绝 LTE 服务
。然而，这些研究都没有专注于分析运营 LTE 网络中的网络侧问题，尽管这种性质的漏洞一旦被利用就会影响其许多用户。  
由于 LTE 中的控制平面组件仍未得到充分探索，我们通过动态分析精心设计的恶意输入导致的核心网络响应，调查了运营商 LTE
网络中控制平面程序的潜在问题。一般而言，动态测试网络行为具有挑战性，因为：①使用商用智能手机利用控制平面协议非常困难。这是因为商业设备在基带芯片组上实现控制平面协议，很难从中生成任意消息。
②部署的运营商网络是封闭系统。它们的配置是专有的，控制平面日志对设备不可用。因此，很难在设备端正确确定已识别问题的根本原因。
③根据运营商和国家/地区的规定，不允许使用未经认证的设备将信号传输到运营网络。  
我们通过将开源 LTE 工具用于测试目的来克服这些挑战。为此，我们通过使用完全可控的 LTE 开源软件实现了一个名为 LTEFuzz
的半自动化测试工具，该工具 1) 动态生成测试用例并将其发送到目标网络或设备，此外，2 )
通过仅检查来自目标的测试器和受害设备中的响应来对有问题的行为进行分类。其次，我们与运营商合作避免道德问题。对于每一个关键测试用例，我们采访了运营商以确定它是否会干扰
LTE 网络。单独处理可能干扰其他用户的可疑用例。关于使用许可频段的规定，我们的测试设备就像一个单一的 LTE
设备一样，单独执行测试消息。因此，附近合法用户的 LTE 服务不会受到任何干扰、性能下降和故障。此外，我们还使用 LTE
手机的身份发送了欺骗性消息。因此，如果我们的测试用例被目标网络接受，只有我们的手机可能会遇到预期的故障。最后，我们根据 1) 对 3GPP 标准的审查和
2) 与运营商的交谈来确认我们的发现，找出根本原因。  
为了系统地生成测试用例，我们首先通过广泛分析网络组件的正确行为及其 3GPP
规范中规定的安全要求，创建了三个安全属性。使用这些安全属性，我们确定了目标消息的范围并为特定测试用例生成了规则。然后，测试用例生成器在商用网络的控制平面日志的数据集中变异随机输入，我们在全球范围内收集了大约一年。仅考虑商用日志中的输入的原因是为了防止由于解析错误而导致接收节点意外崩溃。测试用例总数包括
13 条用于检查网络节点行为的消息和 29 条用于检查商用设备行为的消息。  
通过对运营网络进行测试，我们发现了 51 个漏洞（36 个新漏洞和 15
个已知漏洞），主要是由于未受保护的初始程序处理不当、精心设计的明文请求、具有无效完整性保护的消息、重放消息，和安全程序绕过。我们还通过利用我们在运营网络中发现的漏洞并严格遵守道德规范来展示所有攻击。我们的攻击可以①拒绝向目标用户或任意用户提供各种
LTE 服务，② 欺骗控制平面消息以泄露隐私，③发送欺骗性短消息服务 (SMS)，以及④窃听和操纵数据通信。
## 0x02 Background
###  A. LTE网络架构
下图说明了 LTE 网络架构，它由用户设备 (UE)、演进节点 B (eNB) 和演进分组核心 (EPC) 组件组成。
**UE** 是指一种移动设备，它可以通过连接到基站，为合法用户提供订阅的数据和语音通话等服务。 UE 由国际移动站设备标识 (IMEI) 唯一标识。 UE
的一个显着特征是使用通用用户身份模块 (USIM)，这是一种可以物理插入 UE 的智能卡，其中包括称为国际移动用户身份 (IMSI)
的用户标识符、加密密钥、和算法。  
 **eNB** 是 LTE 中的基站收发信台 (BTS)，它使 UE 能够与 LTE 网络建立无线连接。一个典型的 eNB
有一个基带单元（BBU）负责处理基带信号，它连接到多个远程无线电单元（RRU），直接处理射频信号的发送和接收。每个 RRU
覆盖一个扇区（也称为小区），因此，一个 eNB 可以覆盖多个小区站点。 eNB 连接到移动管理实体（MME），用于控制平面通信和 4G 网关（
GW）用于控制平面和用户平面数据传输。  
 **MME** 是LTE网络中的关键控制节点。它对 UE 进行身份验证并管理订户和演进分组系统 (EPS) 承载的移动性状态。用于验证和保护 UE
的密钥包含在归属用户服务器 (HSS) 中。 MME 使用从 HSS 接收的密钥信息通过称为演进分组系统认证和密钥协议 (EPS-AKA) 的认证协议执行
UE 认证。 MME也参与EPS承载的激活/去激活过程，一个逻辑隧道在 UE 和 GW
之间的会话期间创建，用于为互联网连接提供服务。因此，它通过建立和终止会话来管理用户网络访问。用户移动性通过跟踪存储在 MME 中的每个用户的状态（例如，UE
是否连接到网络）来管理，并以小区为单位跟踪 UE 的位置。这些小区被分组到一个跟踪区 (TA) 中。  
 **4G GW** 由两种类型的 LTE 网关组成：服务网关 (S-GW) 和 PDN 网关 (P-GW)。这些 GW 保证 UE
的移动性并提供互联网服务。当UE从一个基站移动到另一个基站时，S-GW成为锚点，称为切换，P-GW分配IP地址并管理UE的计费数据。它还可以将 UE
连接到互联网。
###  B. LTE服务流程
1) **UE附着过程：** UE附着到网络的初始过程（如下图所示）与连接RAN（eNB）和EPC网络（MME）有关。
UE必须先与eNB建立无线连接，然后再附着到EPC网络，通过LTE网络完全连接到互联网。
UE和eNB之间的连接。当UE开机时，它首先根据USIM卡和设备调制解调器中的配置（例如，运营商特定代码、LTE频段和频道）通过侦听来自附近基站的广播消息来找到合适的小区。一旦UE找到合适的小区，(1)它发起随机接入(RA)过程以获得上行链路资源分配和定时信息。然后，它从选定的小区保存称为临时小区无线电网络临时标识符（临时
C-RNTI）的分配标识。利用该临时 C-RNTI 和上行链路分配，(2) UE 尝试通过发送 RRC 连接请求来建立无线电资源控制 (RRC) 连接。
(3) eNB收到请求后，回复RRC Connection setup，包括专用无线资源分配信息和C-RNTI值，用于区分UE进行后续无线通信。
(4)最后，UE通过向小区发送RRC连接建立完成消息，完成连接建立。一旦执行完所有这些步骤，UE 将在上行链路和下行链路中与小区同步。此外，UE 和 eNB
都将其 RRC 状态从 IDLE 更改为 CONNECTED，如 3GPP 标准中所定义那样。在 RRC CONNECTED 状态下，UE 使用 RRC
协议与连接的小区进行通信以进行控制平面过程。在第五节A中，我们表明在这些初始程序中通常不采用安全措施，从而导致目标 eNB 出现严重问题。  
UE和MME之间的连接。一旦 UE 成功连接到附近的 eNB，它必须连接到 EPC 网络才能获得 LTE 服务。首先，(4) UE 将 NAS Attach