Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
中添加负载均衡策略配置即可。这里以Linux客户端为例进行介绍。
关系，因此也就不需要在集群节点进行任何设置，只要在客户端机器上的tmsnames.ora文件
务器端的负载均衡。
功能。负载均衡在RAC中分为两种：一种是基于客户端连接的负载均衡：另一种是基于服
据库时，通过指定的分配算法将请求分配到集群的任一节点上，这就是RAC数据库完成的
13.8.1
据库已经实现了这些功能呢？下面就对此进行功能测试。
13.8
Oracle Database 1lg Bnterprise Bdition Release 11.1.0.6.0 - Production
(2）查看RAC数据库的service_names
编辑/etc/hosts文件，将RAC数据库相关的IP地址信息添加进去。例如：
（1）修改/etc/hosts文件
客户端连接的负载均衡配置起来非常简单，与RAC数据库的实例负载和监听没有任何
1.RAC客户端负载均衡
RAC数据库的负载均衡是指对数据库连接的负载均衡，当一个新的会话连接到RAC数
With the Partitioning, Real Application Clusters,OLAP, Data Mining
Copyright
192.168.12.231
OracleRAC是一个集群数据库，可以实现负载均衡和故障无缝切换。如何知道RAC数
[oraclesnode-racl ~]$ sqlplus"/as sysdba"
92.168.12.240
192.168.12.232
[oraclesnode-racl
oracle@node-
[oracleanode-racl ~]$ srvct1
使数据库服务对某个实例可用：
test PREF:racdb1 racdb2 AVAIL:
oracle@node-racl -]$ srvctl remove service-d racdb -s test-i racdb2
从某个实例节点移除一个服务：
Service test is running on instance(s) racdb2
测试RAC数据库集群的功能
负载均衡测试
www.Linuxidc .com
(c）1982,2007,Oracle.
-racl
~]$
srvctl
node-vip2
node-racz
node-racl
start
All rights reserved.
service
-dracdb-8 test
PDG
---
## Page 440
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
而不是实例名，也就是SERVICE_NAME必须设置为“SERVICE_NAME=racdb”。
继续开启第二个sqlplus连接，执行如下操作：
instance_name
and Real Application Testing options
Copyright
[oracle@client -]$ sqlplus
在客户端开启一个sqlplus连接，执行如下操作：
（4）在客户端测试负载均衡
SERVICE_NAME= racdb,
口LOAD_BALANCE=yeS，表示启用连接负载均衡。在默认情况下“LOAD_BALANCE
这个配置文件的说明如下：
RACDB=
(3）修改Oracle客户端的配置文件tnsnames.ora
这里需要说明的是，在配置RAC负载均衡时，客户端连接的是RAC数据库的服务名，
service_names
IAME
and Real Application Testing options
ME
th the
直使用该监听。
么SQLNet会按照ADDRESS_LIST列表中的顺序选择监听，只要这个监听正常就一
分发到此监听上，通过这种方式完成负载均衡。如果“LOAD_BALANCE=no"，那
均衡后，SQLNet会随机选择ADDRESS_LIST列表中的任意一个监听，然后将请求
=no"，因此如果要配置负载均衡，必须添加设置“LOAD_BALANCE=yes”。启用负载
(ADDRESS_LIST
(DESCRIPTION=
CONNECT_DATA=
(LOAD_BALANCE = yes)
(ADDRESS
ADDRESS
：Partitioning,Real Application Clusters,OLAP,Data Mining
(SERVICE_NAME = racdb)
www.Linuxidc .com
to:
(c)1982,2008,0racle.Al1 rights reserved.
string
(PROTOCOL
TYPE
DEDICATED)
string
TYPE
------
system/xxxxxx@racdb
，这个“racdb”是RAC数据库的服务名，而非实例名。
TCP)(HOST =node-vip1)(PORT = 1521))
TCP)(HOST =node-vip2)（PORT =1521))
racdb1
VALUE
racdb
VALUE
第13章
Production
PDG
---
## Page 441
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
接到各个节点进行监听的配置，然后在初始化参数中设置remote_listener即可。
式，RAC数据库实现了真正的负载均衡。
刻通知监听程序，最后由监听程序来决定将新的客户端连接分配到哪个节点上，通过这种方
中每个节点的负载信息及连接数写人service_register中，当节点的负载发生变化时，将会立
均衡，并且使客户端连接的负载均衡与服务器端的负载均衡可以配合使用，互不影响。
请求分配到集群中负载较低、连接数较少的节点上来，这样就从根本上实现了数据库的负载
Oracle10g开始，服务器端负载均衡就可以根据RAC中各节点的负荷及连接数情况，将新的
会增加新的连接，这样就可能导致RAC节点无法真正做到负载均衡。不过幸运的是，从
并不知道RAC数据库集群中各个节点的繁忙状态和连接信息，因此负荷较大的节点仍然
和racdb2之间变化，
426
服务器端负载均衡配置也非常简单，只需在各节点的tmsnames.ora文件中添加一个对连
每个集群节点的负载情况是由PMON进程来定期更新的。PMON进程每3秒会将集群
NAME
查看RAC数据库的参数remote_listener：
（2）修改参数remote_listener
ADDRESS=（PROTOCOL
LISTENERS_RACDB =
只需添加如下内容即可：
（1）修改服务器端的tnsnames.ora
客户端的负载均衡解决了连接数据库的负载问题，但是由于连接是由客户端发起的，它
2.服务器端的负载均衡
按照这种方法，
(ADDRESS_LIST
instance_name
TAME
With the Partitioning,Real Application Clusters,OLAP，Data Mining
Oracle Database 11g Enterprise Edition Release 11.1.0.6.0- Production
Connected
Copyright (c) 1982,2008,Oracle.Al1 rights reserved.
[oracleaclient-]$ sqlplussystem/xxxxxx@racdb
WwW.
(PROTOCOL
to:
TYPE
，这样就实现了RAC数据库连接的负载均衡。
陆续打开多个sqlplus连接，
string
TYPE
=TCP)(HOST = node-vip1)(PORT = 1521))
=TCP)(HOST = node-vip2)(PORT =1521）)
=*=
VALUE
Linuxidc.com
racdb2
VALUE
-- = 
，可以看到，每次连接到的实例都在racdb1
PDG
---
## Page 442
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
客户端负载均衡功能，
例，而这个过程对应用程序是不可见的。
一个实例；透明应用是指客户端应用程序在连接失败后可以自动重新连接到另一个数据库实
TAF包含两层意思：失败切换是指客户端连接到某个实例，如果连接失败，可以连接到另外
13.8.2
口TYPE，用于指定FAILOVER_MODE的类型，有3种类型可选，分别是SESSION、
要使用TAF功能，只需修改客户端的tnsnames.ora文件中的设置即可。结合前面介绍的
其中的几个参数的含义如下：
RACDB=
透明应用失败切换（TransparentApplicationFailover，
这样，服务器端的负载均衡就配置完成了。
SQL> alter system set remote_listener='LISTENERS_RACDB'sid='node-rac2';
SQL> alter system set remote_listener='LISTENERS_RACDB' sid='node-rac1';
如果remote_listener的值为空，可以通过如下命令修改每个实例的remote_listener参数：
OSELECT，表示如果正在连接的实例发生故障，将使用游标和之前的快照继续执行
OSESSION，表示当
SELECT和NONE。
可以看到，remote_listener已经设置为“LISTENERS_RACDB”了。
remote_listener
的SQL需要重新执行。
到其他可用的实例，而应用程序无需再次发起连接请求，但是实例故障时正在执行
(ADDRESS_LIST
(DESCRIPTION
CONNECT DATA =
(LOAD_BALANCE = yes)
（ADDRESS=（PROTOCOL-TCP)(HOST = node-vip1)（PORT =1521）)
透明应用失败切换测试
www.Linuxidc.com
(SERVICE_NAME=racdb)
(SERVER=DEDICATED)
一个包含负载均衡和TAF功能的客户端设置如下：
string
(DEALY=5)
(RETRY=3)
(MODE=BASIC)
(TYPE=SELECT)
(FAILOVER_MODE
当一个正在连接的会话实例发生故障时，
LISTENERS_RACDB
TAF)，这是客户端的一种功能。
系统可以自动将会话切换
群427
---
## Page 443
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
13.9
现了故障自动切换功能。
如下：
428
本章主要讲述了OracleRAC集群系统的搭建、使用和维护过程。首先介绍了RAC数据
至此，关于RAC数据库的功能测试已经验证完毕了。
从输出可以看到，上面的SQL会话已经切换到了node-racl的实例racdb1上，也就是实
racdb1
INSTANCE_
关闭node-rac2节点的racdb2实例后，继续执行与前面那个SQL命令相同的语句，结果
[oracle@node-rac2 ~]$ srvctl stop instance -d racdb -i racdb2
此时，不断开此连接，然后在RAC数据库的任意一个节点上执行如下语句：
and Real
With the Partitioning, Real Application Clusters,OLAP,Data Mining
Copyright
SQL*Plus: Release 11.1.0.7.0 - Production on Sun Sep 12 23:23:15 2010
设置完客户端监听后，重启客户端服务，然后执行下面的操作：
口DELAY：表示两次尝试之间等待的秒数。
口RETRY：表示当前节点失败后，失败切换功能尝试连接备用节点的次数。
口MODE，表示连接模式，有两种类型，分别是BASIC和PRECONNECT。
racdb2
-===.
NSTANCE
QL>
QL>COLUMN
QL>
OPRECONNECT表示在建立初始连接时就连接到主节点和备用节点。
OBASIC表示在建立初始连接时仅连接到一个节点，并且只有在发生节点故障时才连
ONONE，这个是客户端默认值，表示禁止SQL接管功能。
本章小结
method,NULL AS failed_over FROM vSinstance UNION SELECT NULL,NULL,
>
接到备用节点。
SELECT操作，其他操作必须要重新执行。
COLUMN
www.Linuxidc.com
NAME
failover_method,
(c)1982,2008,Oracle.
instance
instance_name
node-rac1
HOST NAME
node-rac2
*......
HOST NAME
SELECT
FAILOVER_TYPE
SELECT
FAILOVER_TYPE
failed_over FROM v$session WHERE username
All rights reserved.
NULL AS failover_type,
BASIC
FAILOVER_METHOD
BASIC
FAILOVER METHOD
YES
FAILED OVER
NO
FAILED OVER
NULL AS failover
'SYSTEM'
failover
---
## Page 444
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
尝试一下Oracle的RAC数据库。
高端业务的需求，还能够降低管理和投人成本。如果您的数据库在性能方面存在问题，不妨
的基本操作也是要掌握的基本内容，而RAC数据库的体系结构与特点只需了解即可。
用srvctl管理和维护RAC数据库。
高可用软件CRS的管理与维护；接下来介绍了ASM的基本操作与维护；最后介绍了如何使
的系统设置，安装OracleClusterWare，安装与创建OracleRAC数据库：接着介绍了Oracle
库的体系结构和进程；然后深人介绍了安装OracleRAC数据库的过程，具体包括安装前期
目前OracleRAC集群构架方案已经广泛应用于各个行业，通过这个方案不仅可以满足
纵观全章，安装OracleRAC数据库是本章学习的重点，另外，CRS软件的维护、ASM
www.Linuxidc.com
果群429
PDG
---
## Page 445
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
所示。
以保证数据库服务器在硬件或软件出现故障时服务继续可用。
高可用性是无可厚非的。有很多解决方案能实现不同的SLA（服务水平协定），这些方案可
14.1
案搭建MySQL集群环境。
均衡，是一个完美而又廉价的企业应用解决方案。各大门户网站（如新浪等）都在利用此方
操作的负载均衡。整个方案在读写方面进行了分离，融合了写操作的高可用和读操作的负载
节点写操作的高可用性，而通过MySQL+LVS实现MySQL数据库的主从复制和MySQL读
heartbeat+DRBD+LVS是一套成熟的集群解决方案，通过heartbeat+DRBD完成MySQL的主
第14章
这几种方案与SLA的关系如图14-1
口MySQLCluster的标准版和电信版
口共享存储+MySQL的复制功能可
口MySQL+heartbeat+DRBD的复制功
ON
口MySQL的复制功能是通过在建立复制关系的两台或多台机器环境中，一台机器出现
目前比较流行的高可用解决方案有如下几种：
数据库作为最基础的数据存储服务之一，在整个系统中有着非常重要的地位，需要具备
本章主要介绍MySQL高可用集群环境的搭建和应用。在企业应用中，MySQL+
可以达到99.999%的SLA。
以实现99.990%的SLA。
能可以实现99.900%的SLA。
件可以实现95.000%的SLA。
MySQL的复制功能加一些集群软
90.000%的SLA。
证一定程度的可用性，可以实现
故障就切换到另一台机器上来保
MySQL高可用集群概述
www.Linuxidc .com
构建MySQL+heartbeat+DRBD+LVS
集群应用系统
图14-1MySQL几种高可用解决方案和SLA的关系
MySQL高可用解决方案与SLA关系
SLA
MySQL复制
MySQL复制+集群软件
MySQL复制+集群软件+DRBD
MySQL复制+共享存储+集群软件
MySQL企业级集群标准版
MySQL企业级集群电信版
MySQL解决方案
PDG
---
## Page 446
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
地磁盘。
否存活。
存着相同的数据，可以接替主节点继续提供数据。两个节点之间使用heartbeat来检测对方是