with the six optimization levels, e.g., libbrillo, libbacktrace,
libtextclassiﬁer, and libmediaplayerservice. In total, we obtain
2,108 library binary ﬁles containing 2,037,772 function feature
samples. For this dataset, we compiled all binaries with a
debug ﬂag to establish ground truth based on the symbol
names. For our problem setting, we strip all binaries before
processing them with PATCHECKO.
Dataset II: Since we perform vulnerability assessment, we
generated a vulnerability database that
includes the static
feature vectors and dynamic feature vectors for vulnerable
versions and patched versions of functions. The vulnerable
function dataset comes from Android Security Bulletins [34].
We collect the vulnerabilities from 07/2016 to 11/2018. In
total,
including 1,351 high
vulnerabilities and 381 critical vulnerabilities.
Dataset III: To evaluate PATCHECKO, we collected different
ﬁrmware images, which included different versions of An-
droid, Android Things, and IOS. In particular, we select two
ﬁrmware images from Android Things 1.0 and Google Pixel
there are 2,076 vulnerabilities,
(cid:8)(cid:24)(cid:17)(cid:28)(cid:2)(cid:18)(cid:11)(cid:21)(cid:19)(cid:16)(cid:11)(cid:7)(cid:15)(cid:16)(cid:18)(cid:14)(cid:22)
(cid:6)(cid:9)(cid:23)(cid:10)(cid:15)(cid:12)(cid:11)(cid:28)(cid:2)(cid:18)(cid:11)(cid:21)(cid:19)(cid:16)(cid:11)(cid:7)(cid:15)(cid:16)(cid:18)(cid:14)(cid:22)
(cid:8)(cid:24)(cid:17)(cid:28)(cid:6)(cid:16)(cid:26)(cid:12)(cid:17)(cid:32)
(cid:6)(cid:9)(cid:23)(cid:10)(cid:15)(cid:12)(cid:11)(cid:28)(cid:6)(cid:16)(cid:26)(cid:12)(cid:17)(cid:32)
(cid:30)(cid:27)(cid:32)(cid:35)
(cid:30)(cid:27)(cid:32)
(cid:30)(cid:27)(cid:31)(cid:35)
(cid:30)(cid:27)(cid:31)
(cid:30)(cid:27)(cid:30)(cid:35)
(cid:12)
(cid:23)
(cid:9)
(cid:21)
(cid:1)
(cid:12)
(cid:25)
(cid:16)
(cid:23)
(cid:16)
(cid:22)
(cid:19)
(cid:20)
(cid:12)
(cid:22)
(cid:17)
(cid:1)
(cid:9)
(cid:5)
(cid:30)
(cid:3)(cid:8)(cid:4)(cid:28)(cid:32)(cid:30)(cid:31)(cid:36)(cid:28)(cid:31)(cid:33)(cid:32)(cid:36)(cid:38)
(cid:3)(cid:8)(cid:4)(cid:28)(cid:32)(cid:30)(cid:31)(cid:36)(cid:28)(cid:31)(cid:33)(cid:32)(cid:36)(cid:37)
(cid:3)(cid:8)(cid:4)(cid:28)(cid:32)(cid:30)(cid:31)(cid:36)(cid:28)(cid:31)(cid:33)(cid:32)(cid:36)(cid:37)
(cid:3)(cid:8)(cid:4)(cid:28)(cid:32)(cid:30)(cid:31)(cid:36)(cid:28)(cid:31)(cid:33)(cid:32)(cid:35)(cid:32)
(cid:3)(cid:8)(cid:4)(cid:28)(cid:32)(cid:30)(cid:31)(cid:36)(cid:28)(cid:31)(cid:33)(cid:32)(cid:30)(cid:37)
(cid:3)(cid:8)(cid:4)(cid:28)(cid:32)(cid:30)(cid:31)(cid:36)(cid:28)(cid:31)(cid:33)(cid:31)(cid:37)(cid:32)
(cid:3)(cid:8)(cid:4)(cid:28)(cid:32)(cid:30)(cid:31)(cid:36)(cid:28)(cid:31)(cid:33)(cid:31)(cid:37)(cid:30)
(cid:3)(cid:8)(cid:4)(cid:28)(cid:32)(cid:30)(cid:31)(cid:36)(cid:28)(cid:31)(cid:33)(cid:32)(cid:35)(cid:33)
(cid:3)(cid:8)(cid:4)(cid:28)(cid:32)(cid:30)(cid:31)(cid:36)(cid:28)(cid:31)(cid:33)(cid:32)(cid:31)(cid:30)
(cid:3)(cid:8)(cid:4)(cid:28)(cid:32)(cid:30)(cid:31)(cid:36)(cid:28)(cid:31)(cid:33)(cid:32)(cid:30)(cid:38)
(cid:3)(cid:8)(cid:4)(cid:28)(cid:32)(cid:30)(cid:31)(cid:36)(cid:28)(cid:31)(cid:33)(cid:31)(cid:36)(cid:37)
(cid:3)(cid:8)(cid:4)(cid:28)(cid:32)(cid:30)(cid:31)(cid:36)(cid:28)(cid:31)(cid:33)(cid:32)(cid:33)(cid:32)
(cid:3)(cid:8)(cid:4)(cid:28)(cid:32)(cid:30)(cid:31)(cid:37)(cid:28)(cid:38)(cid:34)(cid:38)(cid:31)
(cid:3)(cid:8)(cid:4)(cid:28)(cid:32)(cid:30)(cid:31)(cid:37)(cid:28)(cid:38)(cid:34)(cid:36)(cid:30)
(cid:3)(cid:8)(cid:4)(cid:28)(cid:32)(cid:30)(cid:31)(cid:37)(cid:28)(cid:38)(cid:34)(cid:35)(cid:31)
(cid:3)(cid:8)(cid:4)(cid:28)(cid:32)(cid:30)(cid:31)(cid:37)(cid:28)(cid:38)(cid:34)(cid:34)(cid:30)
(cid:3)(cid:8)(cid:4)(cid:28)(cid:32)(cid:30)(cid:31)(cid:37)(cid:28)(cid:38)(cid:34)(cid:32)(cid:36)
(cid:3)(cid:8)(cid:4)(cid:28)(cid:32)(cid:30)(cid:31)(cid:37)(cid:28)(cid:38)(cid:34)(cid:32)(cid:34)
(cid:3)(cid:8)(cid:4)(cid:28)(cid:32)(cid:30)(cid:31)(cid:37)(cid:28)(cid:38)(cid:34)(cid:32)(cid:30)
(cid:3)(cid:8)(cid:4)(cid:28)(cid:32)(cid:30)(cid:31)(cid:37)(cid:28)(cid:38)(cid:34)(cid:31)(cid:32)
(cid:3)(cid:8)(cid:4)(cid:28)(cid:32)(cid:30)(cid:31)(cid:37)(cid:28)(cid:38)(cid:34)(cid:31)(cid:31)
(cid:3)(cid:8)(cid:4)(cid:28)(cid:32)(cid:30)(cid:31)(cid:37)(cid:28)(cid:38)(cid:34)(cid:31)(cid:30)
(cid:3)(cid:8)(cid:4)(cid:28)(cid:32)(cid:30)(cid:31)(cid:37)(cid:28)(cid:38)(cid:33)(cid:34)(cid:35)
(cid:3)(cid:8)(cid:4)(cid:28)(cid:32)(cid:30)(cid:31)(cid:37)(cid:28)(cid:38)(cid:33)(cid:34)(cid:30)
(cid:3)(cid:8)(cid:4)(cid:28)(cid:32)(cid:30)(cid:31)(cid:37)(cid:28)(cid:38)(cid:34)(cid:38)(cid:38)
(cid:3)(cid:8)(cid:4)(cid:28)(cid:32)(cid:30)(cid:31)(cid:37)(cid:28)(cid:38)(cid:34)(cid:38)(cid:37)
(cid:3)(cid:8)(cid:4)(cid:1)(cid:13)(cid:24)(cid:18)(cid:10)(cid:23)(cid:16)(cid:19)(cid:18)(cid:22)
Fig. 7: False positive rate on Android Things and Google Pixel
2 XL with vulnerable and patched versions.
(cid:5)(cid:2)(cid:13)(cid:10)(cid:5)
(cid:5)(cid:2)(cid:13)(cid:9)(cid:10)
(cid:5)(cid:2)(cid:13)(cid:9)(cid:7)
(cid:5)(cid:2)(cid:13)(cid:8)(cid:12)
(cid:14)
(cid:5)(cid:2)(cid:13)(cid:8)(cid:8)
(cid:14)
(cid:7)
(cid:6)
(cid:12)
(cid:13)
(cid:7)
(cid:7)
(cid:4)
(cid:3)(cid:2)(cid:4)(cid:7)(cid:8)
(cid:3)(cid:2)(cid:4)(cid:6)(cid:8)
(cid:11)
(cid:11)
(cid:10)
(cid:4)
(cid:3)(cid:2)(cid:4)(cid:5)(cid:8)
(cid:11)
(cid:3)(cid:2)(cid:4)(cid:4)(cid:8)
(cid:3)(cid:2)(cid:4)(cid:3)(cid:8)
(cid:5)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:7)(cid:2)(cid:9)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:9)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:11)(cid:2)(cid:9)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:6)(cid:5)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:6)(cid:7)(cid:2)(cid:9)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:6)(cid:9)
(cid:5)(cid:10)(cid:11)(cid:8)(cid:1)(cid:2)(cid:9)(cid:3)
(cid:3)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:5)(cid:2)(cid:8)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:8)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:9)(cid:2)(cid:8)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:4)(cid:3)(cid:1)(cid:1)(cid:1)(cid:1)(cid:1)(cid:4)(cid:5)(cid:2)(cid:8)(cid:1)(cid:1)(cid:1)(cid:1)(cid:4)(cid:8)
(cid:5)(cid:8)(cid:9)(cid:6)(cid:1)(cid:2)(cid:7)(cid:3)
(a) Accuracy for training the deep
learning model
(b) Loss for training the deep
learning model
Fig. 8: Deep learning training results
2 XL (Android 8.0) as our targets. For vulnerability detection,
we considered the vulnerabilities which were patched in 2018
and focus on version 8.0 and 8.1. Finally, we choose 25
different CVE vulnerabilities from our database to evaluate
our solution on Android Things and Google Pixel 2 XL.
B. Training Details
Our deep learning model is ﬁrst trained using Dataset I.
We adapt the sequential model with 6 layers. We ﬁrst specify
the inputs for each layer. The ﬁrst layer in our sequential
model needs to receive information about its input shape. In
our case, it is 96. We split Dataset I into three disjoint subsets
of functions for training (1,222,663), validation (407,554), and
testing (407,555), respectively.
C. Testing Devices
We evaluate PATCHECKO in two different devices: Android
Things and Google Pixel 2 XL. For Android Things, we use
Android Things 1.0–which includes a 05/2018 security patch
as well as a previous security patch. For Google Pixel 2 XL,
its system version is Android 8.0 and it includes a 07/2017
security patch as well as a previous security patch.
Authorized licensed use limited to: Tsinghua University. Downloaded on March 19,2021 at 11:28:40 UTC from IEEE Xplore.  Restrictions apply. 
381
TABLE VI: The accuracy for deep learning and dynamic
execution for Android Things based on vulnerable function.
Dp: Deep learning; DA: Dynamic analysis
TABLE VII: The accuracy for deep learning and dynamic
execution for Android Things based on patched function. Dp:
Deep learning; DA: Dynamic analysis
Dynamic Analysis Engine
Execution
Ranking
Dynamic Analysis Engine
Execution
Ranking
Time(s)
Deep Learning Classiﬁcation
TN
1155
1113
951
354
107
105
1421
867
894
609
609
541
561
421
2164
595
178
13598
723
725
1060
540
571
5393
5050
Total
1183
1183
987
357
116
116
1433
1020
1020
617
617
617
617
467
2538
653
180
13729
735
735
1181
594
594
5646
5646
FP
27
69
35
2
8
10
11
152
125
7
7
75
55
45
373
57
1
130
11
9
120
53
22
252
595
FN
0
0
0
0
0
0
0
1
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
FP(%)
2.28%
5.83%
3.55%
0.56%
6.90%
8.62%
0.77%
14.90%
12.25%
1.13%
1.13%
12.16%
8.91%
9.64%
14.70%
8.73%
0.56%
0.95%
1.50%
1.22%
10.16%
8.92%
3.70%
4.46%
10.54%
6.16%
CVE
CVE-2018-9451
CVE-2018-9340
CVE-2017-13232
CVE-2018-9345
CVE-2018-9420
CVE-2017-13210
CVE-2018-9470
CVE-2017-13209
CVE-2018-9411
CVE-2017-13252
CVE-2017-13253
CVE-2018-9499
CVE-2018-9424
CVE-2018-9491
CVE-2017-13278
CVE-2018-9410
CVE-2017-13208
CVE-2018-9498
CVE-2017-13279
CVE-2018-9440
CVE-2018-9427
CVE-2017-13178
CVE-2017-13180
CVE-2018-9412
CVE-2017-13182
Average
TP
1
1
1
1
1
1
1
0
1
1
1
1
1
1
1
1
1
1
1
1
1
1
1
1
1
D. Accuracy
5
6
5
1
1
2
4
9
8
7
5
6
7
3
20
22
1
7
6
4
9
15
5
38
72
N/A
1
1
2
1
1
1
1
1
2
2
1
1
1
2
1
1
1