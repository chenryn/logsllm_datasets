Defense	
  by	
  Numb3r5	
Making	
  problems	
  for	
  script	
  k1dd13s	
and	
  scanner	
  monkeys	
@ChrisJohnRiley	
“THE	
  WISEST	
  MAN,	
  IS	
  HE	
WHO	
  KNOWS,	
  THAT	
  HE	
KNOWS	
  NOTHING”	
SOCRATES:	
  APOLOGY,	
  21D	
TL	
  ;DR	
Goals	
  for	
  this	
  talk	
Describe	
  the	
defensive	
  uses	
  of	
HTTP	
  status	
  codes	
1)  What	
2)  Why	
3)  How	
4)  Goals	
5)  Bringing	
  it	
  together	
6)  Review	
#1	
]	
[	
  WHAT ? 
HTTP	
  STATUS	
  CODES	
Seems	
  like	
  such	
  a	
Small	
  detail	
…	
  small	
  detail,	
big	
  impact	
This	
  talk	
  contains:	
  - Numbers 
 - Bad Jokes 
 - Traces of peanuts 
 - Did I mention numbers? 
HTTP	
  Status	
  Codes	
§  Majority	
  part	
  of	
  RFC	
  2616	
  (HTTP/1.1)	
§  5	
  main	
  classes	
  of	
  response	
§  1XX	
  informaOonal	
§  2XX	
  success	
§  3XX	
  redirecOon	
§  4XX	
  client	
  error	
§  5XX	
  server	
  error	
HTTP	
  Status	
  Codes	
§  Proposed	
  RFC*	
  for	
  7XX	
  codes	
§  Examples:	
§  701	
  Meh	
§  719	
  I	
  am	
  not	
  a	
  teapot	
§  721	
  Known	
  unknowns	
§  722	
  Unknown	
  unknowns	
§  732	
  Fucking	
  Unic☐de	
*	
  h]ps://github.com/joho/7XX-­‐rfc	
BASICS	
AKA:	
  THE	
  BORING	
  THEORY	
  BIT	
#1.1	
1XX	
  Informaeonal	
§  Indicates	
  response	
  received	
§  Processing	
  is	
  not	
  yet	
  completed	
§  100	
  Conenue	
§  101	
  Switching	
  Protocols	
§  102	
  Processing	
  (WebDAV	
  RFC	
  2518)	
2XX	
  Success	
§  Indicates	
  response	
  received	
§  Processed	
  and	
  understood	
§  200	
  OK	
§  201	
  Created	
§  202	
  Accepted	
§  203	
  Non-­‐Authoritaeve	
  Informaeon	
§  204	
  No	
  Content	
2XX	
  Success	
  (cont.)	
§  205	
  Reset	
  Content	
§  206	
  Pareal	
  Content	
§  207	
  Mule-­‐Status	
  (WebDAV	
  RFC	
  4918)	
Codes	
  not	
  supported	
  by	
  Apache	
§ 
208	
  Already	
  Reported	
§ 
226	
  IM	
  Used	
§ 
250	
  Low	
  on	
  Storage	
  Space	
3XX	
  Redireceon	
§  Aceon	
  required	
  to	
  complete	
  request	
§  300	
  Muleple	
  Choices	
§  301	
  Moved	
  Permanently	
§  302	
  Found	
  /	
  Moved	
  Temporarily	
§  303	
  See	
  Other	
§  304	
  Not	
  Modiﬁed	
3XX	
  Redireceon	
  (cont.)	
§  305	
  Use	
  Proxy	
§  306	
  Switch	
  Proxy	
§  307	
  Temporary	
  Redirect	
Codes	
  not	
  supported	
  by	
  Apache	
§ 
308	
  Permanent	
  Redirect	
4XX	
  Client	
  Error	
§  Client	
  caused	
  an	
  error	
§  400	
  Bad	
  Request	
§  401	
  Unauthorized	
§  402	
  Payment	
  Required	
§  403	
  Forbidden	
§  404	
  Not	
  Found	
§  405	
  Method	
  Not	
  Allowed	
4XX	
  Client	
  Error	
  (cont.)	
§  406	
  Not	
  Accessible	
§  407	
  Proxy	
  Authenecaeon	
  Required	
§  408	
  Request	
  Timeout	
§  409	
  Conﬂict	
§  410	
  Gone	
§  411	
  Length	
  Required	
4XX	
  Client	
  Error	
  (cont.)	
§  412	
  Precondieon	
  Failed	
§  413	
  Request	
  Enety	
  Too	
  Large	
§  414	
  Request-­‐URI	
  Too	
  Long	
§  415	
  Unsupported	
  Media	
  Type	
§  416	
  Request	
  Range	
  Not	
  Saesﬁable	
§  417	
  Expectaeon	
  Failed	
§  418	
  I’m	
  a	
  Teapot	
  (WebDAV	
  RFC	
  2324)	
4XX	
  Client	
  Error	
  (cont.)	
§  419	
  /	
  420	
  /	
  421	
  Unused	
§  422	
  Unprocessable	
  Enety	
  (RFC	
  4918)	
§  423	
  Locked	
  (RFC	
  4918)	
§  424	
  Failed	
  Dependency	
  (RFC	
  4918)	
§  425	
  No	
  Code	
  /	
  Unordered	
  Colleceon	
§  426	
  Upgrade	
  Required	
  (RFC	
  2817)	
4XX	
  Client	
  Error	
  (cont.)	
Codes	
  not	
  supported	
  by	
  Apache	
§ 
428	
  Precondieon	
  Required	
§ 
429	
  Too	
  Many	
  Requests	
§ 
431	
  Request	
  Header	
  Fields	
  Too	
  Large	
§ 
444	
  No	
  Response	
  (NGINX)	
§ 
449	
  Retry	
  With	
  (Microsoo)	
§ 
450	
  Blocked	
  by	
  Win.	
  Parental	
  Controls	
§ 
451	
  Unavailable	
  For	
  Legal	
  Reasons	
§ 
494	
  Request	
  Header	
  Too	
  Large	
  (NGINX)	
§ 
495	
  Cert	
  Error	
  (NGINX)	
§ 
496	
  No	
  Cert	
  (NGINX)	
§ 
497	
  HTTP	
  to	
  HTTPS	
  (NGINX)	
§ 
499	
  Client	
  Closed	
  Request	
  (NGINX)	
5XX	
  Server	
  Error	
§  Server	
  error	
  occurred	
§  500	
  Internal	
  Server	
  Error	
§  501	
  Not	
  Implemented	
§  502	
  Bad	
  Gateway	
§  503	
  Service	
  Unavailable	
§  504	
  Gateway	
  Timeout	
§  505	
  Method	
  Not	
  Allowed	
5XX	
  Server	
  Error	
  (cont.)	
§  506	
  Variant	
  Also	
  Negoeates	
  (RFC	
  2295)	
§  507	
  Insuﬃcient	
  Storage	
  (WebDAV	
  RFC	
  4918)	
§  508	
  Loop	
  Detected	
  (WebDAV	
  RFC	
  5842)	
§  509	
  Bandwidth	
  Limit	
  Exceeded	
  (apache	
  ext.)	
§  510	
  Not	
  Extended	
  (RFC	
  2274)	
Codes	
  not	
  supported	
  by	
  Apache	
§ 
511	
  Network	
  Authenecaeon	
  Required	
  (RFC	
  6585)	
§ 
550	
  Permission	
  Denied	
§ 
598	
  Network	
  Read	
  Timeout	
  Error	
  (Microsoo	
  Proxy)	
§ 
599	
  Network	
  Conneceon	
  Timeout	
  Error	
  (Microsoo	
  Proxy)	
OMG	
  Enough	
  with	
the	
  numb3rs	
already!!!!	
#2	
]	
[	
  WHY ? 
It	
  started	
  as	
  a	
  simple	
  idea…	
?	
?	
?	
…	
  and	
  started	
  to	
  think	
SCREW	
  WITH	
SCANNERS	
…	
  AND	
  SCRIPT	
K1DD13S	
THAT	
  SOUNDS	
LIKE	
  FUN!	
@thegrugq	
  26	
  Feb	
  2013	
@thegrugq	
  26	
  Feb	
  2013	
INCREASE	
ATTACKER	
  COSTS	
$	
$	
$	
WASTE	
ATTACKER	
  TIME	
-­‐ 
When	
  the	
  tables	
  turn	
  (2004)	
-­‐ 
Roelof	
  Temmingh,	
  Haroon	
  Meer,	
  Charl	
  van	
  der	
  Walt	
-­‐ 
h]p://slideshare.net/sensepost/strikeback	
-­‐ 
Stopping	
  Automated	
  A]ack	
  Tools	
  (2006)	
-­‐ 
Gunter	
  Ollmann	
-­‐ 
h]p://www.technicalinfo.net/papers/
StoppingAutomatedA]ackTools.html	
Prior	
  Art	
-­‐ 
mod-­‐security	
  mailing	
  list	
  (2006)	
-­‐ 
Status	
  Code	
  503	
  together	
  with	
  Retry-­‐Aoer	
  header	
-­‐ 
Ryan	
  BarneW	
-­‐ 
h]p://bb10.com/apache-­‐mod-­‐security-­‐user/
2006-­‐12/msg00042.html	
Prior	
  Art	
SecFilterDefaultAceon	
  "deny,log,status:503"	
SecFilter	
  ".*"	
Header	
  set	
  Retry-­‐Aoer	
  "120"	
#3	
]	
[	
  HOW ? 
BROWSERS	
  HAVE	
TO	
  BE	
  FLEXIBLE	
THIS	
  LEADS	
  TO	
INTERPRETATION	
…	
  which	
  leads	
  to	
  the	
  dark-­‐side	
RFCS…	
THEY’RE	
  MORE	
  OF	
  A	
GUIDELINE	
  REALLY	
WHAT COULD POSSIBLY GO 
WRONG! 
TESTING	
THE	
  HOW	
  OF	
  THE	
  THING!	
#3.1	
§  Restricted	
  research	
  to	
  the	
  big	
  3	
§  Internet	
  Explorer	
§  Chrome	
  /	
  Chromium	
§  Firefox	
NO…	
  SAFARI	
  ISN’T	
IN	
  THE	
  TOP	
  10	
  3	
OPERA	
  JUMPED…	
…or	
  was	
  it	
  pushed!	
LYNX	
THE	
  UNREALISTIC	
  OPTION	
§  MITMproxy	
  /	
  MITMdump	
§  Python-­‐based	
§  Simple	
  to	
  setup	
  proxy	
  /	
  reverse	
  proxy	
§  Script-­‐based	
  aceons	
§  PHP	
§  Ability	
  to	
  set	
  response	
  code	
§  Must	
  be	
  at	
  the	
  top	
  of	
  the	
  PHP	
  code	
§  Can	
  be	
  added	
  to	
  php.ini	
§  auto-­‐prepend-­‐ﬁle	
  =	
  /full/path	