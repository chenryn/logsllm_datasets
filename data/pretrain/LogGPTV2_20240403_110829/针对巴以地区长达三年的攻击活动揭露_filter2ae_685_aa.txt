# 针对巴以地区长达三年的攻击活动揭露
##### 译文声明
本文是翻译文章
译文仅供参考，具体内容表达以及含义原文为准。
## 0x01 主要发现
近期，360烽火实验室发现一起针对巴以地区攻击活动，攻击者使用了多种商业间谍软件，同时也基于开源代码构建了独有的间谍软件。通过分析，我们发现该攻击活动自2018年开始，并持续至今。根据攻击者使用的伪装对象，我们推测攻击目标可能为巴以地区。
## 0x02 伪装对象
攻击者通过将合法的应用打包进间谍软件进行伪装，伪装对象为各种社交应用、阿克萨电台、阿克萨清真寺、耶路撒冷指南、PDF查看器等应用。
图1 伪装对象图标
## 0x03 载荷投递
### 社交工具
Threema是一款付费的开源端到端加密即时通讯应用程序，我们发现攻击者会将间谍软件伪装成Threema应用进行攻击活动。通过伪装对象的CC信息，我们发现了疑似攻击者使用的钓鱼链接，该钓鱼链接伪装成Facebook网站。我们推测攻击者可能使用了Facebook进行传播钓鱼网站。下图为开源项目pihole-blocklists中记录的疑似攻击者使用的钓鱼网站。
图2 pihole-blocklists部分内容
另外，在部分受害者手机中，样本出现在WhatsApp文档路径中，进一步说明攻击者使用社交工具进行载荷投递。
图3 文件路径
### Google Drive
在关联溯源中，我们发现一个名为“تسريب-اجتماع-القائد-محمد-دحلان-و-المخابرات-المصريه.pdf（Mohammed Dahlan 指挥官和埃及情报会议 (MoM)
泄漏.pdf）”的文档，该文档内容模糊不清，并包含一个阿拉伯语段落，旨在引诱受害者点击Google Drive链接下载Adobe
Reader更新。其中Google Drive 链接指向一个名为”com.adobe.reader.apk”的恶意APK文件。文档内容如下图所示。
图4 文档内容
## 0x04 样本分析
攻击者使用了多个商业间谍软件进行攻击活动，包括SpyNote、Mobihok、WH-RAT、888RAT。除此之外还用了开源渗透测试框架Metasploit。
我们还发现攻击者自研的间谍软件EsecretRAT，EsecretRAT是攻击者开发的一款间谍软件，由于该间谍软件伪装成secret
chat应用，并且APK包名中包含 Esecret 字符串，我们将该间谍软件命名为EsecretRAT。
### SpyNote
SpyNote 是一款功能强大的商业间谍软件，具有强大的的功能，以及管理平台。其主要功能为：
– 文件管理
– 短信管理
– 通话记录管理
– 联系人管理
– 位置管理
– 账号管理
– 键盘记录
– 手机设置
– 拨打电话
– 拍照、录音、录像
– 实时录音
– 实时录像
– 获取应用列表
– 执行 shell 命令
– 聊天功能
SpyNote控制端界面如下图所示：
图5 SpyNote控制端
### Mobihok
Mobihok是一款基于SpyNote源码修改的商业间谍软件，除了具备SpyNote强大的功能外，还进行了一些免杀处理。其主要功能与SpyNote类似，控制端界面如下图所示：
图6 Mobihok控制端
### WH-RAT
WH-RAT是一款包含Android和Windows的远控工具，Android平台远控工具基于SpyNote源码二次开发，Windows平台远控基于NjRAT源码二次开发，其Android远控主要功能与SpyNote基本一致。控制端界面如下图所示：
图7 WH-RAT Android 控制端
图8 WH-RAT Windows 控制端
### 888RAT
888RAT是一款支持Windows、Android和Linux平台的商业远控工具，其Android 远控主要有以下功能：
– 文件管理
– 拍照、录音、录像
– GPS位置跟踪
– 获取联系人
– 获取短信
– 获取通话记录
– 获取已安装应用
– 电量监控
– 执行shell命令
– 获取设备信息
– 弹出通知消息
– 播放音频
– Facebook钓鱼
– 账号管理
– 非ROOT权限截图
下图为其官网的部分功能介绍：
图9 888RAT功能介绍
控制端界面如下图所示：
图10 888RAT控制端
### Metasploit
Metasploit是一个开源的渗透测试框架，它本身附带数百个已知软件漏洞的专业级漏洞攻击工具，通过它可以很容易地获取、开发并对计算机软件漏洞实施攻击。Metasploit
Android payload 则是Metasploit框架针对Android
系统的一个有效负载，可以针对Android设备的渗透工具。攻击者将Metasploit打包进正常的APK中进行攻击活动，其包结构如下图所示。
图11 插入Metasploit的包结构
该APK通过动态加载恶意模块实现隐私窃取功能，其主要功能有：
– 获取通话记录
– 获取联系人
– 获取短信
– 隐藏图标
– 获取位置
– 设置壁纸
– 获取已安装应用列表
– 启动应用
– 卸载应用（API的方式）
– 剪切板管理
– 文件管理
– 录音、录像、拍照
– 实时录音
– 实时录像
– 获取设备信息
– 获取网络信息
– 截图
– 检测ROOT权限
恶意模块源码结构如下图所示：
图12 Metasploit payload源码结构
### EsecretRAT
EsecretRAT是基于开源的ChatAppTutorial开发的间谍软件，攻击者在ChatAppTutorial原有的代码的基础上添加了部分恶意代码，实现了间谍软件功能。下图为ChatAppTutorial
和 EsecretRAT 的包结构：
图13 左边为ChatAppTutorial，右边为EsecretRAT
EsecretRAT主要恶意功能为：
– 获取联系人
– 获取短信
– 获取设备IMEI
– 获取位置信息