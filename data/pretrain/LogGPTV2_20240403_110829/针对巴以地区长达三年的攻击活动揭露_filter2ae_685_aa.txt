# 针对巴以地区长达三年的攻击活动揭露

## 译文声明
本文为翻译文章，译文仅供参考。具体内容及含义请以原文为准。

## 主要发现
近期，360烽火实验室发现了一起针对巴以地区的持续性攻击活动。该活动自2018年起一直持续至今。攻击者不仅使用了多种商业间谍软件，还基于开源代码构建了独有的间谍软件。根据攻击者使用的伪装对象，我们推测其主要目标是巴以地区的用户。

## 伪装对象
攻击者通过将合法应用打包进间谍软件进行伪装，这些伪装对象包括各种社交应用、阿克萨电台、阿克萨清真寺、耶路撒冷指南以及PDF查看器等。

**图1：伪装对象图标**

## 载荷投递
### 社交工具
攻击者将间谍软件伪装成Threema（一款付费的开源端到端加密即时通讯应用程序）进行传播。通过分析伪装对象的CC信息，我们发现了疑似攻击者使用的钓鱼链接，这些链接伪装成Facebook网站。这表明攻击者可能利用Facebook来传播钓鱼网站。下图为开源项目pihole-blocklists中记录的疑似攻击者使用的钓鱼网站。

**图2：pihole-blocklists部分内容**

此外，在部分受害者的手机中，样本出现在WhatsApp文档路径中，进一步证明了攻击者通过社交工具进行载荷投递。

**图3：文件路径**

### Google Drive
在关联溯源过程中，我们发现了一个名为“تسريب-اجتماع-القائد-محمد-دحلان-و-المخابرات-المصريه.pdf”（Mohammed Dahlan指挥官和埃及情报会议泄漏.pdf）的文档。该文档内容模糊不清，并包含一段阿拉伯语文本，旨在引诱受害者点击Google Drive链接下载Adobe Reader更新。然而，该链接指向一个名为“com.adobe.reader.apk”的恶意APK文件。

**图4：文档内容**

## 样本分析
攻击者使用了多个商业间谍软件，包括SpyNote、Mobihok、WH-RAT和888RAT，同时利用了开源渗透测试框架Metasploit。此外，攻击者还自主研发了一款名为EsecretRAT的间谍软件。

### SpyNote
SpyNote是一款功能强大的商业间谍软件，具有以下主要功能：
- 文件管理
- 短信管理
- 通话记录管理
- 联系人管理
- 位置管理
- 账号管理
- 键盘记录
- 手机设置
- 拨打电话
- 拍照、录音、录像
- 实时录音
- 实时录像
- 获取应用列表
- 执行shell命令
- 聊天功能

**图5：SpyNote控制端界面**

### Mobihok
Mobihok是基于SpyNote源码修改的商业间谍软件，除了具备SpyNote的所有功能外，还进行了免杀处理。其控制端界面如下所示：

**图6：Mobihok控制端界面**

### WH-RAT
WH-RAT是一款支持Android和Windows平台的远控工具。其Android平台的远控工具基于SpyNote源码二次开发，而Windows平台的远控则基于NjRAT源码二次开发。其主要功能与SpyNote基本一致。

**图7：WH-RAT Android控制端界面**
**图8：WH-RAT Windows控制端界面**

### 888RAT
888RAT是一款支持Windows、Android和Linux平台的商业远控工具。其Android平台的主要功能包括：
- 文件管理
- 拍照、录音、录像
- GPS位置跟踪
- 获取联系人
- 获取短信
- 获取通话记录
- 获取已安装应用
- 电量监控
- 执行shell命令
- 获取设备信息
- 弹出通知消息
- 播放音频
- Facebook钓鱼
- 账号管理
- 非ROOT权限截图

**图9：888RAT功能介绍**
**图10：888RAT控制端界面**

### Metasploit
Metasploit是一个开源的渗透测试框架，附带数百个专业级漏洞攻击工具。Metasploit Android payload是针对Android系统的有效负载，可以用于渗透Android设备。攻击者将Metasploit打包进正常的APK中进行攻击活动。其包结构如下所示：

**图11：插入Metasploit的包结构**

该APK通过动态加载恶意模块实现隐私窃取功能，其主要功能包括：
- 获取通话记录
- 获取联系人
- 获取短信
- 隐藏图标
- 获取位置
- 设置壁纸
- 获取已安装应用列表
- 启动应用
- 卸载应用（API的方式）
- 剪切板管理
- 文件管理
- 录音、录像、拍照
- 实时录音
- 实时录像
- 获取设备信息
- 获取网络信息
- 截图
- 检测ROOT权限

**图12：Metasploit payload源码结构**

### EsecretRAT
EsecretRAT是基于开源ChatAppTutorial开发的间谍软件。攻击者在原有代码基础上添加了部分恶意代码，实现了间谍软件功能。下图为ChatAppTutorial和EsecretRAT的包结构对比：

**图13：左边为ChatAppTutorial，右边为EsecretRAT**

EsecretRAT的主要恶意功能包括：
- 获取联系人
- 获取短信
- 获取设备IMEI
- 获取位置信息