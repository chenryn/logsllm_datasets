title:blackhat:asia-22 AutoSpear: Towards Automatically Bypassing and Inspecting Web Application Firewalls
The web application firewall (WAF) is widely employed to protect web applications like websites from various web attacks like SQL injection (SQLi) and cross-site-scripting (XSS). In particular, the WAF-as-a-service, as one of the off-the-shelf security services in the cloud, is increasingly used by more and more websites. Although these WAF-as-a-services normally claim that they can be timely updated by captured attack traffic, one natural question is, are existing WAFs and WAF-as-a-services indestructible? Generally, to demonstrate the security vulnerability of a WAF, attackers usually manually mutate the original payload (e.g., URL) that is previously blocked by the WAF, such that the mutated payload can successfully bypass the WAF. Although several tools like sqlmap provide some candidate mutation operations (e.g., case substitution, adding comments), attackers cannot automatically choose a set of mutation operations and directly apply them to generate the mutated payload, which might invalidate its original semantics, i.e., functionality and maliciousness.Taking the SQLi attack as a representative case, we design and implement AutoSpear to automatically bypass and inspect the existing WAFs in the wild. AutoSpear first represents the original SQLi payload with a hierarchical tree for semantic-level analysis, and then utilizes a weighted mutation algorithm based on the context-free grammar to generate numerous semantic-equivalent payloads. To guide the exploration among the generated semantic-equivalent payloads, AutoSpear employs an enhanced Monte-Carlo-Tree-Searching to output the final payload for bypassing and inspecting the target WAF.To quantify the security vulnerability of WAFs, we evaluate 7 WAF-as-a-services from mainstream vendors (including AWS, Cloudflare, etc.) on a rich real-world dataset with multiple request methods. Comprehensive experiments show they are all vulnerable to AutoSpear. In particular, AutoSpear achieves an attack success rate of over 89% against AWS WAFs. More importantly, the respective vendors have acknowledged our disclosures quickly and are in the process of fixing them.