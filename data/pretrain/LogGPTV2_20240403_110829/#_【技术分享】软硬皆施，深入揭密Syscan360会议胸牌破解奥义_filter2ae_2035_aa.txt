# 【技术分享】软硬兼施：深入揭秘Syscan360会议胸牌破解

#### 译文声明
本文为翻译文章，原文来自阿里先知。具体表达及含义以原文为准。
原文链接：[此处插入原文链接]

**作者：谢君（阿里安全IoT安全研究）**

## 背景
在2023年11月的上海Syscan360安全会议上，360独角兽团队设计了一款电子胸牌供参会者进行破解挑战。这个活动类似于美国Defcon上的解密谜题比赛。参与者需要在胸牌上输入正确答案才能进入下一关，总共九道题目。本文将从硬件和软件两个层面解析这款胸牌的功能，并介绍如何在不依赖谜面的情况下快速找到答案。

## 初识篇
胸牌由两块板组成，一块黑色，另一块红色。以下是黑色胸牌的硬件配置：
- **MCU**: 德州仪器TI CC1310 (型号CC1310F64RGZ)，采用VQFN (48)封装，尺寸7.00 mm × 7.00 mm
- **处理器**: ARM Cortex-M3，时钟频率高达48 MHz
- **存储**: 64 KB片上可编程Flash，20 KB静态内存SRAM，30个GPIO口
- **无线功能**: RF Core支持1 GHz以下的无线信号收发
- **外置存储器**: Winbond 25Q32bvsig，提供32 Mbits存储空间
- **显示**: LCD液晶屏
- **其他组件**: 四个LED灯、若干电阻和电容、六个按键和开关

### 使用方法
- 六个按键分别用于切换ASCII码字符、删除、确认和返回等功能。
- 只有通过所有关卡后，才能解锁控制LED灯闪烁和发送红外信号关闭电视的功能。

## 硬件篇
为了深入了解胸牌的工作原理，我们需要获取其内部代码逻辑。根据CC1310芯片的数据手册，该芯片支持JTAG仿真调试。我们只需连接支持ARM的仿真器即可访问整个内存空间并进行动态调试。以下是JTAG接口的引脚分配：
- TMS: 引脚24
- TCK: 引脚25
- TDO: 引脚26
- TDI: 引脚27
- GND: 任意接地引脚

使用万用表可以轻松找到这些引脚的位置。接下来，我们将这些引脚与FT2232H Mini Module仿真器连接。连接图如下：

- 右侧是Mini Module CN-2接口的引脚
- 左侧是CC1310的引脚
- GND接地

完成连线后，即可开始调试。

## 软件篇
硬件连接完成后，我们使用OpenOCD和Arm-none-eabi-gdb进行片上调试。首先需要准备CC1310的调试配置文件`cc1310.cfg`，可以从[这里](http://openocd.zylin.com/gitweb?p=openocd.git;a=blob;f=tcl/target/cc1310.cfg;h=8f86bd4b965a02922ae1abc98f53c8a4c65f9711;hb=27c749394270555698e3f5413082d5c6898d8151)下载。

启动OpenOCD后，运行`telnet localhost 4444`进入命令行界面，执行`halt`命令暂停CPU。然后在gdb中执行`target remote localhost:3333`进行远程调试连接。接下来，我们导出固件、Flash和SRAM数据：
- Flash: `dump binary memory cc1310_flash.bin 0 0x10000`
- BootROM: `dump binary memory cc1310_brom.bin 0x10000000 0x10020000`
- SRAM: `dump binary memory cc1310_sram.bin 0x20000000 0x20005000`

合并这三个文件并在IDA中反汇编，进行地址重定位。

## 逆向篇
通过IDA中的字符串分析，我们找到了每道题的答案。以下是详细说明：
- 每道题的提示和答案以及用户自定义ID存储在Flash的0xe000区域，总长度为0xe2字节。
- 运行时会将这部分数据读取到SRAM中进行操作，再写回Flash以保存进度。
- 数据结构如下：
  - 0xe000 — 0xe010: 用户设置的ID
  - 0xe014 — 0xe015: 存储用户已通过的关卡数（直接改为9即可通关）

### 九道题的答案
1. UR1NMYW0RLD!
2. 42
3. ORDREDUTEMPLE
4. FQJPVDPOK
5. VYTX
6. LOYAL
7. GNILCS
8. FIBONACHI
9. WORLD

通关后的结果显示在屏幕上。

## 探秘TVB Gone功能
当所有关卡通过后，会解锁两项新功能：
- LED Light: 控制前部两个LED灯显示三种颜色。
- TVB Gone: 通过红外信号远程关闭不同品牌的电视。

TVB Gone功能通过发射不同品牌和频率的红外控制信号来实现。板载存储了80组红外控制信号数据，每组数据包含发射频率、数据对数量、每对信号承载的比特数等信息。

例如，一组数据结构如下：
- 0x9600: 发射频率38400 Hz
- 0x1a: 需要发送的数据对数量
- 0x02: 每对信号承载2个比特数据
- 0x9e38: 存储时间对的指针地址
- 0x97b4: 发送数据的指针地址

通过这种方式，胸牌能够实现多种遥控功能。

希望本文能帮助你更好地理解Syscan360会议胸牌的设计和破解方法。