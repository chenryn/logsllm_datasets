前前言言
为什么用 Python 写网络爬虫？Python 这种稍严谨而流行库又非常多的语言, 大大弱化了计算机运行速度对程序
的影响, 强化了为程序员容易思考而打造的特性，所以选择 Python 来实现网络爬虫。
本教程简单的介绍如何使用 Python 的相关模块如 urllib2 来实现网络爬虫。
适适用用人人群群
想要效率的截取网络素材，有批量抓取需求的开发者。
学学习习前前提提
学习本教程前，我们假设你已经了解 Python 这门语言。
版版本本信信息息
书中演示代码基于以下版本：
语语言言//框框架架 版版本本信信息息
Python 2.7.5
鸣谢：http://blog.csdn.net/column/details/why-bug.html
目目录录
前前言言 .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. 11
第第 11 章章 抓抓取取网网页页的的含含义义和和 UURRLL 基基本本构构成成 .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. 55
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
第第 22 章章 利利用用 uurrlllliibb22 通通过过指指定定的的 UURRLL 抓抓取取网网页页内内容容.. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. 1122
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
第第 33 章章 异异常常的的处处理理和和 HHTTTTPP 状状态态码码的的分分类类 .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. 1199
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
第第 44 章章 OOppeenneerr 与与 HHaannddlleerr 的的介介绍绍和和实实例例应应用用.. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. 2266
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
第第 55 章章 uurrlllliibb22 的的使使用用细细节节与与抓抓站站技技巧巧 .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. 3333
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
第第 66 章章 一一个个简简单单的的百百度度贴贴吧吧的的小小爬爬虫虫 .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. 4466
第第 77 章章 PPyytthhoonn 中中的的正正则则表表达达式式教教程程.. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. 4499
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
第第 88 章章 糗糗事事百百科科的的网网络络爬爬虫虫（（vv00..33））源源码码及及解解析析((简简化化更更新新)) .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. 6655
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
第第 99 章章 百百度度贴贴吧吧的的网网络络爬爬虫虫（（vv00..44））源源码码及及解解析析.. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. 7711
第第 1100 章章 一一个个爬爬虫虫的的诞诞生生全全过过程程（（以以山山东东大大学学绩绩点点运运算算为为例例）） .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. 7799
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
第第 1111 章章 亮亮剑剑！！爬爬虫虫框框架架小小抓抓抓抓 SSccrraappyy 闪闪亮亮登登场场！！.. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. 9999
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
第第 1122 章章 爬爬虫虫框框架架 SSccrraappyy 的的第第一一个个爬爬虫虫示示例例入入门门教教程程 .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. 111100
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
#. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
11
抓抓取取网网页页的的含含义义和和 UURRLL 基基本本构构成成
第 1 章 抓取网页的含义和 URL 基本构成 | 6
##
网络爬虫的定义
网络爬虫，即 Web Spider，是一个很形象的名字。
把互联网比喻成一个蜘蛛网，那么 Spider 就是在网上爬来爬去的蜘蛛。
网络蜘蛛是通过网页的链接地址来寻找网页的。
从网站某一个页面（通常是首页）开始，读取网页的内容，找到在网页中的其它链接地址，
然后通过这些链接地址寻找下一个网页，这样一直循环下去，直到把这个网站所有的网页都抓取完为止。
如果把整个互联网当成一个网站，那么网络蜘蛛就可以用这个原理把互联网上所有的网页都抓取下来。
这样看来，网络爬虫就是一个爬行程序，一个抓取网页的程序。 网络爬虫的基本操作是抓取网页。
那么如何才能随心所欲地获得自己想要的页面？
我们先从 UR L开始。
第 1 章 抓取网页的含义和 URL 基本构成 | 7
##
浏览网页的过程
抓取网页的过程其实和读者平时使用IE浏览器浏览网页的道理是一样的。 比如说你在浏览器的地址栏中输入 ww
w.baidu.com 这个地址。
打开网页的过程其实就是浏览器作为一个浏览的“客户端”，向服务器端发送了 一次请求，把服务器端的文
件“抓”到本地，再进行解释、展现。
HTML 是一种标记语言，用标签标记内容并加以解析和区分。
浏览器的功能是将获取到的 HTML 代码进行解析，然后将原始的代码转变成我们直接看到的网站页面。
第 1 章 抓取网页的含义和 URL 基本构成 | 8
##
URI 和 URL 的概念和举例
简单的来讲，URL 就是在浏览器端输入的 wiki.jikexueyuan.com 这个字符串。
在理解 URL 之前，首先要理解 URI 的概念。
什么是 URI？
Web 上每种可用的资源，如 HTML 文档、图像、视频片段、程序等都由一个通用资源标志符(Universal Resou
rce Identifier，URI)进行定位。
URI 通常由三部分组成：
①访问资源的命名机制；
②存放资源的主机名；
③资源自身的名称，由路径表示。
如下面的 URI：
http://www.why.com.cn/myhtml/html1223/
我们可以这样解释它：
①这是一个可以通过 HTTP 协议访问的资源，
②位于主机 www.webmonkey.com.cn 上，
③通过路径“/html/html40”访问。
第 1 章 抓取网页的含义和 URL 基本构成 | 9
##
URL 的理解和举例
URL 是 URI 的一个子集。它是 Uniform Resource Locator 的缩写，译为“统一资源定位 符”。
通俗地说，URL 是 Internet 上描述信息资源的字符串，主要用在各种 WWW 客户程序和服务器程序上。
采用 URL 可以用一种统一的格式来描述各种信息资源，包括文件、服务器的地址和目录等。
URL 的一般格式为(带方括号[]的为可选项)：
pprroottooccooll :://// hhoossttnnaammee[[::ppoorrtt]] // ppaatthh // [[;;ppaarraammeetteerrss]][[??qquueerryy]]##ffrraaggmmeenntt
URL 的格式由三部分组成：
①第一部分是协议(或称为服务方式)。
②第二部分是存有该资源的主机 IP 地址(有时也包括端口号)。
③第三部分是主机资源的具体地址，如目录和文件名等。
第一部分和第二部分用“://”符号隔开。
第二部分和第三部分用“/”符号隔开。
第一部分和第二部分是不可缺少的，第三部分有时可以省略。
第 1 章 抓取网页的含义和 URL 基本构成 | 10
##
URL 和 URI 简单比较
URI 属于 URL 更低层次的抽象，一种字符串文本标准。
换句话说，URI 属于父类，而 URL 属于 URI 的子类。URL 是 URI 的一个子集。
URI 的定义是：统一资源标识符；
URL 的定义是：统一资源定位符。
二者的区别在于，URI 表示请求服务器的路径，定义这么一个资源。
而 URL 同时说明要如何访问这个资源（http://）。
下面来看看两个 URL 的小例子。
1. HTTP 协议的 URL 示例：
使用超级文本传输协议 HTTP，提供超级文本信息服务的资源。
例： http://www.peopledaily.com.cn/channel/welcome.htm
其计算机域名为 www.peopledaily.com.cn 。
超级文本文件(文件类型为.html)是在目录 /channel 下的 welcome.htm。
这是中国人民日报的一台计算机。
例： http://www.rol.cn.net/talk/talk1.htm
其计算机域名为 www.rol.cn.net 。
超级文本文件(文件类型为.html)是在目录 /talk 下的 talk1.htm。 这是瑞得聊天室的地址，可由此进入瑞得聊天室
的第 1 室。
1. 文件的 URL
用 URL 表示文件时，服务器方式用 file 表示，后面要有主机 IP 地址、文件的存取路 径(即目录)和文件名等信
息。
有时可以省略目录和文件名，但“/”符号不能省略。
例： file://ftp.yoyodyne.com/pub/files/foobar.txt
第 1 章 抓取网页的含义和 URL 基本构成 | 11
上面这个 URL 代表存放在主机 ftp.yoyodyne.com 上的 pub/files/目录下的一个文件，文件名是foobar.txt。
例： file://ftp.yoyodyne.com/pub
代表主机 ftp.yoyodyne.com 上的目录/pub。
例： file://ftp.yoyodyne.com/
代表主机 ftp.yoyodyne.com 的根目录。
爬虫最主要的处理对象就是 URL，它根据 URL 地址取得所需要的文件内容，然后对它进行进一步的处理。
因此，准确地理解 URL 对理解网络爬虫至关重要。
22
利利用用 uurrlllliibb22 通通过过指指定定的的 UURRLL 抓抓取取网网页页内内容容
第 2 章 利用 urllib2 通过指定的 URL 抓取网页内容 | 13
版本号：Python2.7.5，Python3 改动较大，各位另寻教程。所谓网页抓取，就是把 URL 地址中指定的网络资
源从网络流中读取出来，保存到本地。类似于使用程序模拟 IE 浏览器的功能，把 URL 作为 HTTP 请求的内容
发送到服务器端， 然后读取服务器端的响应资源。
在 Python 中，我们使用 urllib2 这个组件来抓取网页。urllib2 是 Python 的一个获取 URLs(Uniform Resourc
e Locators)的组件。它以 urlopen 函数的形式提供了一个非常简单的接口。最简单的 urllib2 的应用代码只需要
四行。我们新建一个文件 urllib2_test01.py 来感受一下 urllib2 的作用：
import urllib2
response = urllib2.urlopen('http://www.baidu.com/')
html = response.read()
print html
按下 F5 可以看到运行的结果：
第 2 章 利用 urllib2 通过指定的 URL 抓取网页内容 | 14
我们可以打开百度主页，右击，选择查看源代码（火狐 OR 谷歌浏览器均可），会发现也是完全一样的内容。也
就是说，上面这四行代码将我们访问百度时浏览器收到的代码们全部打印了出来。这就是一个最简单的 urllib2 的
例子。
除了"http:"，URL同样可以使用"ftp:"，"file:"等等来替代。HTTP 是基于请求和应答机制的：客户端提出请
求，服务端提供应答。
urllib2 用一个 Request 对象来映射你提出的 HTTP 请求。在它最简单的使用形式中你将用你要请求的地址创建
一个 Reques t 对象，通过调用 urlopen 并传入 Request 对象，将返回一个相关请求 response 对象，这个应
答对象如同一个文件对象，所以你可以在 Response 中调用 .read()。
第 2 章 利用 urllib2 通过指定的 URL 抓取网页内容 | 15
我们新建一个文件 urllib2_test02.py 来感受一下：
import urllib2
req = urllib2.Request('http://www.baidu.com')
response = urllib2.urlopen(req)
the_page = response.read()
print the_page
可以看到输出的内容和 test01 是一样的。 urllib2 使用相同的接口处理所有的 URL 头。例如你可以像下面那样创
建一个 ftp 请求。
req = urllib2.Request('ftp://example.com/')
在 HTTP 请求时，允许你做额外的两件事。
第 2 章 利用 urllib2 通过指定的 URL 抓取网页内容 | 16
##
发送 data 表单数据
这个内容相信做过 Web 端的都不会陌生，有时候你希望发送一些数据到 URL(通常 URL 与 CGI[通用网关接
口]脚本，或其他 WEB 应用程序挂接)。 在 HTTP 中，这个经常使用熟知的 POST 请求发送。这个通常在你提
交一个 HTML 表单时由你的浏览器来做。并不是所有的 POSTs 都来源于表单，你能够使用 POST 提交任意的
数据到你自己的程序。一般的 HTML 表单，data 需要编码成标准形式。然后做为 data 参数传到 Request 对
象。编码工作使用 urllib 的函数而非 urllib2。我们新建一个文件 urllib2_test03.py 来感受一下：
import urllib
import urllib2