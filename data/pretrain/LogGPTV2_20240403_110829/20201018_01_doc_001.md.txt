### 为什么饿了么网上订餐不会凉凉 & 牛顿发现万有引力有关?

#### 作者简介
- **昵称**: 德哥
- **职务**: 阿里云数据库产品经理
- **擅长领域**: PostgreSQL、全文检索、模糊搜索、化学分析、人脸识别、相似推荐、时空调度、向量搜索等
- **愿景**: 没有MyBase解决不了的问题，如果有，就多买几台
- **格言**: 公益是一辈子的事
- **业余爱好**: 写博客、写专利、分享、乐于助人
- **GitHub**: [https://github.com/digoal](https://github.com/digoal)

#### 最近作品
- 《亿级用户量的实时推荐数据库到底要几毛钱?》
- 《在数据库中跑全文检索、模糊SQL会不会被开除?》
- 《刷脸支付会不会刷到别人的钱包?》
- 《为什么打车和宇宙大爆炸有关?》
- 《大话数据库终局之战》

#### 目录
1. 为什么要讨论这个问题?
2. 牛顿告诉我们为什么真相离我们越来越远
3. 懒人改变历史 - 网上订餐凉凉史
4. 顿顿给了饿了么什么启发?
5. 没有MyBase PG解决不了的问题, 如果有, 就多买几台

### 为什么要讨论这个问题?
技术的发展与我们的日常生活息息相关。本文将探讨牛顿的万有引力理论如何影响现代生活中的外卖配送系统。

### 牛顿告诉我们为什么真相离我们越来越远
独立思考是解决问题的关键。牛顿通过观察苹果落地的现象发现了万有引力定律，这一发现改变了人类对自然界的认知。同样，在现代生活中，我们需要通过独立思考来优化复杂的技术问题。

### 懒人改变历史 - 网上订餐凉凉史
- **为什么会凉凉?**
  - 骑手收入不足
  - 骑手调度算法不优
  - 调度算法存在缺陷
  - 未使用保温箱
  - 骑手薪资与配送时间、单数不挂钩

### 顿顿给了饿了么什么启发?
- **核心指标:**
  - 缩短配送时间
  - 提高能效，降低“单数/骑手”比例
- **具体措施:**
  - 使用图算法（如pgrouting）优化骑手路径
  - 避免或减少骑手有未完成订单时安排新订单
  - 避免保温箱超载
  - 避免呼叫远离卖家的骑手

### 没有MyBase PG解决不了的问题, 如果有, 就多买几台
- **查询示例:**
  ```sql
  SELECT * FROM (
      SELECT * FROM tbl_pos 
      WHERE att1 IN (?,?,?) 
        AND att2 = ANY(array[?, ?]) 
        AND st_contains(geometry(ST_Buffer(geography(st_setsrid(st_makepoint(x?, y?), 4326)), dis?)), pos)
      ORDER BY pos <-> st_setsrid(st_makepoint(x?, y?), 4326) LIMIT 100
  ) AS t
  ORDER BY att1;
  ```
- **性能提升:**
  - 更新频率: 9.6万/s
  - 查询响应时间: 5000/s, RT 11毫秒
  - 数据量: 2000万骑手
  - 机器配置: 26c

### 总结
- **顿顿的最大启发是什么?** 用一首歌来形容就是：既要又要还要。
- **MyBase PG的核心优势:**
  - Ganos (PostGIS 增强)
  - btree_gist
  - intarray

### 顿顿喊你用
- **咨询砖家**: 加入钉钉群，免费进行中！
- **周周红包雨**: [https://www.aliyun.com/product/apsaradb/cddc](https://www.aliyun.com/product/apsaradb/cddc)

希望本文能够帮助大家更好地理解技术如何影响我们的日常生活，并提供一些实用的解决方案。