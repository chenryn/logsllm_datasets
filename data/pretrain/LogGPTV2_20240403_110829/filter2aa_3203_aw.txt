The TCP/IP component of Windows uses a local IPv4 routing table to determine the route used to 
forward the packet. From the chosen route, the next-hop IPv4 address and interface are determined. 
IPv4 hands the packet to ARP to resolve the next-hop address to a MAC address and send the packet. 
You can use the route print command to view the IPv4 routing table for the TCP/IP component of 
Windows. 
Rather than use routes for the address prefixes of every subnet in your network, you can use route 
summarization to advertise a summarized address prefix that includes all the subnets in a specific 
region of your network. 
An IPv4 host is configured with a default gateway. IPv4 static routers are configured with either subnet 
routes or summarized routes. IPv4 dynamic routers are configured with the settings that allow them to 
exchange routing information with neighboring routers. 
A network address translator (NAT) is an IPv4 router that can translate the IP addresses and TCP/UDP 
port numbers of packets as they are forwarded. A NAT allows a small network to share a single public 
IPv4 address. 
The IPv6 component of Windows uses a local IPv6 routing table to determine the route used to forward 
the packet. From the chosen route, IPv6 determines the next-hop IPv6 address and interface. IPv6 
hands the packet to the Neighbor Discovery process to resolve the next-hop address to a MAC address 
and send the packet. You can use the route print or netsh interface ipv6 show routes command to 
view the routing table for the IPv6 component of Windows. 
IPv6 hosts automatically configure themselves with routing information based on the receipt of Router 
Advertisement messages. You must use netsh interface ipv6 commands to manually enable and 
configure routers running the IPv6 component of Windows to advertise address prefixes and routes. 
You use the Route and Netsh tools to manage IP routing tables. You use the Ping tool to test basic 
reachability. You use the Tracert tool to show the path that a packet takes from source to a destination. 
You use the Pathping tool to test for link and router reliability in a path from a source to a destination. 
Chapter 5 – IP Routing 
TCP/IP Fundamentals for Microsoft Windows  
Page: 156 
Chapter Glossary 
default gateway – A configuration parameter for TCP/IP in Windows that is the IPv4 address of a 
neighboring IPv4 router. Configuring a default gateway creates a default route in the IPv4 routing table.  
default route – A route that summarizes all possible destinations and is used for forwarding when the 
routing table does not contain any other more specific routes for the destination. For example, if a 
router or sending host cannot find a subnet route, a summarized route, or a host route for the 
destination, IP selects the default route. The default route is used to simplify the configuration of hosts 
and routers. For IPv4 routing tables, the default route is the route with the network destination of 0.0.0.0 
and netmask of 0.0.0.0. For IPv6 routing tables, the default route has the address prefix ::/0. 
direct delivery – The delivery of an IP packet by an IP node to the final destination on a directly 
attached subnet.  
distance vector – A routing protocol technology that propagates routing information in the form of an 
address prefix and its “distance” (hop count). 
host route – A route to a specific IP address. Host routes allow packets to be routed on a per-IP 
address basis. For IPv4 host routes, the route prefix is a specific IPv4 address with a 32-bit prefix 
length. For IPv6 host routes, the route prefix is a specific IPv6 address with a 128-bit prefix length. 
indirect delivery – The delivery of an IP packet by an IP node to an intermediate router.  
link state – A routing protocol technology that exchanges routing information consisting of a router’s 
attached subnet prefixes and their assigned costs. Link state information is advertised upon startup and 
when changes in the network topology are detected. 
longest matching route – The algorithm used to select the routes in the routing table that most closely 
match the destination address of the packet being sent or forwarded. 
NAT – See network address translator (NAT). 
network address translator (NAT) – An IPv4 router that translates addresses and ports when forwarding 
packets between a privately addressed network and the Internet. 
next-hop determination – The process of determining the next-hop address and interface for sending or 
forwarding a packet, based on the contents of the routing table. 
Open Shortest Path First (OSPF) – A link state-based routing protocol for use within a single 
autonomous system. An autonomous system is a portion of the network under the same administrative 
authority. 
OSPF – See Open Shortest Path First (OSPF). 
path vector – A routing protocol technology that exchanges sequences of hop information that indicate 
the path for a route. For example, BGP-4 exchanges sequences of autonomous system numbers. 
RIP – See Routing Information Protocol (RIP). 
route determination process – The process of determining which single route in the routing table to use 
for forwarding a packet. 
Chapter 5 – IP Routing 
TCP/IP Fundamentals for Microsoft Windows  
Page: 157 
route summarization – The practice of using address prefixes to summarize the address spaces of 
regions of a network, rather than using the routes for individual subnets. 
router – An IPv4 or IPv6 node that can forward received packets that are not addressed to itself (also 
called a gateway for IPv4). 
Router Advertisement – For IPv4, a message sent by a router that supports ICMP router discovery. For 
IPv6, an IPv6 Neighbor Discovery message sent by a router that typically contains at least one Prefix 
Information option, from which hosts create stateless autoconfigured unicast IPv6 addresses and 
routes. 
router discovery – For IPv4, the ability of hosts to automatically configure and reconfigure a default 
gateway. For IPv6, a Neighbor Discovery process in which a host discovers the neighboring routers on 
an attached link. 
Routing Information Protocol (RIP) – A distance vector-based routing protocol used in small and 
medium sized networks. 
routing protocols – A series of periodic or on-demand messages that contain routing information that is 
exchanged between dynamic routers. 
routing table – The set of routes used to determine the next-hop address and interface for IP traffic sent 
by a host or forwarded by a router. 
static routing – The use of manually configured routes in the routing tables of routers. 
supernetting – The obsolete use of route summarization to assign blocks of Class C address prefixes 
on the Internet.  
Chapter 5 – IP Routing 
TCP/IP Fundamentals for Microsoft Windows  
Page: 158 
Chapter 6 – Dynamic Host Configuration Protocol 
TCP/IP Fundamentals for Microsoft Windows  
Page: 159 
Chapter 6 – Dynamic Host Configuration Protocol 
Abstract 
This chapter describes the details of the Dynamic Host Configuration Protocol (DHCP) and its use to automatically 
allocate unique IPv4 address configurations to DHCP client computers. Network administrators must understand how 
DHCP works so that they can correctly configure the components of a DHCP infrastructure to allocate IPv4 addresses 
and other configuration options for DHCP clients on one or more subnets. This chapter also describes how IPv6 hosts 
use address autoconfiguration and the DHCP for IPv6 (DHCPv6) protocol and how you can manage IP configuration 
with the Ipconfig tool. 
Chapter 6 – Dynamic Host Configuration Protocol 
TCP/IP Fundamentals for Microsoft Windows  
Page: 160 
Chapter Objectives 
After completing this chapter, you will be able to: 
Describe the function of DHCP. 
Explain how DHCP works. 
Install and configure the DHCP Server service. 
Configure a DHCP scope, a superscope, and scope options. 
Describe the function of DHCP user and vendor classes. 
Install and configure a DHCP relay agent. 
Describe how IPv6 address autoconfiguration works. 
Describe how DHCPv6 works. 
Configure a DHCPv6 scope. 
Install and configure a DHCPv6 relay agent. 
Use the Ipconfig tool to view IP configurations and to manage DHCP-allocated IPv4 address 
configurations. 
Chapter 6 – Dynamic Host Configuration Protocol 
TCP/IP Fundamentals for Microsoft Windows  
Page: 161 
DHCP Overview 
DHCP is a TCP/IP standard that reduces the complexity and administrative overhead of managing 
network client IPv4 addresses and other configuration parameters. A properly configured DHCP 
infrastructure eliminates the configuration problems associated with manually configuring TCP/IP.  
A DHCP infrastructure consists of the following elements: 
DHCP servers 
Computers that offer dynamic configuration of IPv4 addresses and related configuration parameters 
to DHCP clients. 
DHCP clients 
Network nodes that support the ability to communicate with a DHCP server to obtain a dynamically 
leased IPv4 address and related configuration parameters. 
DHCP relay agents 
Network nodes, typically routers, that listen for broadcast and unicast DHCP messages and relay 
them between DHCP servers and DHCP clients. Without DHCP relay agents, you would have to 
install a DHCP server on each subnet that contains DHCP clients. 
Each time a DHCP client starts, it requests IPv4 addressing information from a DHCP server, including: 
IPv4 address 
Subnet mask 
Additional configuration parameters, such as a default gateway address, Domain Name System (DNS) 
server addresses, a DNS domain name, and Windows Internet Name Service (WINS) server 
addresses. 
When a DHCP server receives a request, it selects an available IPv4 address from a pool of addresses 
defined in its database (along with other configuration parameters) and offers it to the DHCP client. If 
the client accepts the offer, the IPv4 addressing information is leased to the client for a specified period 
of time. 
The DHCP client will typically continue to attempt to contact a DHCP server if a response to its request 
for an IPv4 address configuration is not received, either because the DHCP server cannot be reached 
or because no more IPv4 addresses are available in the pool to lease to the client. For DHCP clients 
that are based on Microsoft Windows XP or Windows Server 2003 operating systems, the DHCP Client 
service uses the alternate configuration when it cannot contact a DHCP server. The alternate 
configuration can be either an Automatic Private IP Addressing [APIPA] address or an alternate 
configuration that has been configured manually. 
Requests for Comments (RFCs) 2131 and 2132 define the operation of DHCP clients and servers. RFC 
1542 defines the operation of DHCP relay agents. All DHCP messages are sent using the User 
Datagram Protocol (UDP). DHCP clients listen on UDP port 67. DHCP servers listen on UDP port 68. 
DHCP relay agents listen on both UDP ports. 
Chapter 6 – Dynamic Host Configuration Protocol 
TCP/IP Fundamentals for Microsoft Windows  
Page: 162 
Benefits of Using DHCP 
To understand why DHCP is beneficial in configuring TCP/IP on client computers, it is useful to contrast 
the manual configuration method with the DHCP method. 
Configuring TCP/IP Manually 
Correct operation of TCP/IP on a host computer requires careful configuration of an IPv4 address, 
subnet mask, and default gateway before the client can communicate with other network nodes. If the 
configuration is incorrect, the following might happen: 
A user who configures a random IPv4 address, instead of getting a valid IPv4 address from a network 
administrator, can create network problems that are difficult to troubleshoot.  
An error in typing one of the numbers for the IPv4 address, subnet mask, or default gateway can also 
lead to problems. These problems can range from trouble communicating using TCP/IP (if the default 
gateway or subnet mask is wrong) to problems with attempting to use a duplicate IPv4 address.  
If the network node moves to another subnet, the IPv4 address, subnet mask, and default gateway are 
no longer valid and cannot be used for TCP/IP-based connectivity. 
Correct manual configuration is especially important for wireless LANs. For example, a wireless user 
using a wireless-enabled laptop computer moves from one building to another in a corporate campus. 
When the user and their laptop change buildings, they might switch to another subnet. Without 
automated configuration, the user must manually type a different IPv4 address, subnet mask, and 
default gateway for the new subnet to restore TCP/IP connectivity. 
Configuring TCP/IP Using DHCP 
Using DHCP to automatically configure IPv4 address configurations means the following: 
Users no longer need to acquire IPv4 address configurations from a network administrator to properly 
configure TCP/IP.  
When a DHCP client is started, it automatically receives an IPv4 address configuration that is 
correct for the attached subnet from a DHCP server. When the DHCP client moves to another 
subnet, it automatically obtains a new IPv4 address configuration for that subnet. 
The DHCP server supplies all of the necessary configuration information to all DHCP clients.  
As long as the DHCP server has been correctly configured, all DHCP clients of the DHCP server 
are configured correctly. 
Chapter 6 – Dynamic Host Configuration Protocol 
TCP/IP Fundamentals for Microsoft Windows  
Page: 163 
How DHCP Works 
DHCP uses the following basic process to automatically configure a DHCP client: 
1. When the TCP/IP protocol initializes and has DHCP enabled on any of its interfaces, the DHCP client 
sends a DHCPDiscover message to find the DHCP servers on the network and to obtain a valid IPv4 
address configuration. 
2. All DHCP servers that receive the DHCPDiscover message and that have a valid IPv4 address 
configuration for the client send a DHCPOffer message back to the DHCP client.  
3. The DHCP client selects an IPv4 address configuration to use from the DHCPOffer messages that it 
receives and sends a DHCPRequest message to all the DHCP servers, requesting the use of the 
selected configuration.  
The DHCPRequest message identifies the server that sent the offer that the DHCP client selected. 
The other DHCP servers that receive the DHCPRequest message that sent offers place their offered 
IPv4 addresses back into the available pool of addresses. 
4. The selected DHCP server assigns the IPv4 address configuration to the DHCP client and sends a 
DHCPAck (acknowledgment) message to the DHCP client. 
The DHCP client computer finishes initializing the TCP/IP protocol on the interface. Once complete, the 
client can use all TCP/IP services and applications for normal network communications and connectivity 
to other IPv4 hosts. 
Figure 6-1 shows the basic DHCP process. 
Figure 6-1  The basic DHCP process 
If a computer has multiple network adapters, the DHCP process occurs separately over each network 
adapter that is configured for automatic TCP/IP addressing until each network adapter in the computer 
has been allocated a unique IPv4 address configuration. 
DHCP Messages and Client States 
The DHCP client can go through six states in the DHCP process:  
Initializing 
Chapter 6 – Dynamic Host Configuration Protocol 
TCP/IP Fundamentals for Microsoft Windows  
Page: 164 
Selecting 
Requesting 
Bound 
Renewing 
Rebinding 
DHCP clients and servers use the following messages to communicate during the DHCP configuration 
process: 
DHCPDiscover (sent from client to server) 
DHCPOffer (sent from server to client) 
DHCPRequest (sent from client to server) 
DHCPAck (sent from server to client) 
DHCPNak (sent from server to client) 
DHCPDecline (sent from client to server) 
DHCPRelease (sent from client to server) 
Figure 6-2 shows DHCP client states and messages, which are discussed in detail in the following 
sections. 
Figure 6-2  DHCP states and messages 
Computers running Windows XP or Windows Server 2003 use an additional DHCP message, the 
DHCPInform message, to request and obtain information from a DHCP server for the following 
purposes: 
To detect authorized DHCP servers in an environment that includes the Active Directory® directory 
service. 
Chapter 6 – Dynamic Host Configuration Protocol 
TCP/IP Fundamentals for Microsoft Windows  
Page: 165 
To obtain updated addresses for DNS servers and WINS servers and a DNS domain name when 
making a remote access connection. 