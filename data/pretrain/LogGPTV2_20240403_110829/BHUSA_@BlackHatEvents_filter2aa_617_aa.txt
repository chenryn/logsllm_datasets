#BHUSA @BlackHatEvents
DNSSEC Downgrade Attacks
Haya Shulman, Elias Heftrig, Michael Waidner
#BHUSA @BlackHatEvents
Information Classification: General
Why DNSSEC Downgrade Attacks?
DNS is involved in virtually all transactions on  the Internet and many mechanisms rely on its security
➢ when determining which IP host to send packets to
➢ password recovery
➢ ACME/Domain Validation for obtaining X.509/HTTPS Certificates
➢ authorization of X.509 CAs and authentication of certificates
➢ also: SSH host key fingerprints, IPSec Keys, …
DNSSEC is the go-for solution to achieve DNS record security
➢ while everybody here has probably heard of downgrade attacks on TLS
➢ downgrade attacks on DNSSEC have not seen much attention up until now
#BHUSA @BlackHatEvents
Information Classification: General
Agenda
➢ DNS(SEC) Refresher
➢ DNSSEC Downgrade Attacks
➢ Attacks to Weaken Security
➢ Attacks to Break Security
➢ Recommendations
#BHUSA @BlackHatEvents
Information Classification: General
Agenda
➢ DNS(SEC) Refresher
➢ DNSSEC Downgrade Attacks
➢ Attacks to Weaken Security
➢ Attacks to Break Security
➢ Recommendations
#BHUSA @BlackHatEvents
Information Classification: General
DNS Resolution – Common Setup
Stub Resolver
Forwarder
Recursive Resolver
.
ing.
bank.ing.
Authoritative Name Server
Application
gethostbyname(“www.bank.ing.”)
www.bank.ing. IN A?
bank.ing. 3600 IN NS ns.bank.ing.
1
2
3
4
5
6
7
8
9
A
B
C
#BHUSA @BlackHatEvents
Information Classification: General
DNS Poisoning
Stub Resolver
Forwarder
Recursive Resolver
.
ing.
bank.ing.
Authoritative Name Server
Application
gethostbyname(“www.bank.ing.”)
www.bank.ing. IN A?
www.bank.ing. 2600 IN A 6.6.6.6
➢ Attack on DNS Record Authenticity
#BHUSA @BlackHatEvents
Information Classification: General
DNS Poisoning
Stub Resolver
Forwarder
Recursive Resolver
.
ing.
bank.ing.
Authoritative Name Server
Application
gethostbyname(“www.bank.ing.”)
www.bank.ing. IN A?
www.bank.ing. 2600 IN A 6.6.6.6
➢ Attack on DNS Record Authenticity
#BHUSA @BlackHatEvents
Information Classification: General
Secure DNS in Practice
Stub Resolver
Forwarder
Recursive Resolver
.
ing.
bank.ing.
Authoritative Name Server
Application
Local Host
DoH/DoT
DoU + DNSSEC
➢ Session maintenance too expensive for recursive-to-authoritative communication
#BHUSA @BlackHatEvents
Information Classification: General
DNSSEC
Protection Goals Provided For
➢ data origin authenticity
➢ integrity of data
➢ NOT confidentiality
Basic Principle
➢ protection of DNS data using cryptographic signatures
➢ trust in public keys delegated via a PKI
➢ built into and aligned with the DNS hierarchy
#BHUSA @BlackHatEvents
Information Classification: General
DNSSEC Chain of Trust
“RRSIG” Signature Records
➢ cover record sets (“RRset”; same name, type and class)
DNSKEY Records
➢ carry public key material for verification
DS “Delegation Signer” Records
➢ carry digest of individual child zone DNSKEY
➢ conform to “certificates” in other PKIs
All DNSSEC records specify signature algorithm numbers.
DS records specify digest type numbers.
.
DS: org.
2 → 13
DNSKEY: .
8
8
example.org.
A: www.example.org.
1.2.3.4
DNSKEY: example.org.
8
org.
DS: example.org.
DNSKEY: org.
13
13
2 → 8 4 → 8
8
13
8
#BHUSA @BlackHatEvents
Information Classification: General
Protection of (Non-)Existence
Authenticated Denial of Existence
➢ uses (signed) NSEC-type records to mark empty intervals in the name space
➢ specifies record types present at interval boundaries
➢ does not protect record presence at the level of signature algorithms
DNSSEC Record Presence Requirement for Signature Algorithms
DS → DNSKEY → RRSIGs on all zone data
•
∃ 𝐷𝑅 𝑤𝑖𝑟ℎ 𝑎𝑙𝑔𝑙𝑟𝑖𝑟ℎ𝑙 𝑎 ⇒ ∃ 𝐷𝑁𝑅𝐾𝐷𝑌 𝑤𝑖𝑟ℎ 𝑎𝑙𝑔𝑙𝑟𝑖𝑟ℎ𝑙 𝑎
•
∃ 𝐷𝑁𝑅𝐾𝐷𝑌 𝑤𝑖𝑟ℎ 𝑎𝑙𝑔𝑙𝑟𝑖𝑟ℎ𝑙 𝑎 ⇒ ∀ 𝑅𝑅𝑟𝑒𝑟𝑟 𝑖𝑙 𝑧𝑙𝑙𝑒: ∃ 𝑅𝑅𝑅𝐼𝐺 𝑤𝑖𝑟ℎ 𝑎𝑙𝑔𝑙𝑟𝑖𝑟ℎ𝑙 𝑎
#BHUSA @BlackHatEvents
Information Classification: General
DNSSEC Signature Algorithms
Number
Mnemonics
DNSSEC Signing 
DNSSEC Validation 
1
RSAMD5
MUST NOT
MUST NOT
3
DSA
MUST NOT
MUST NOT
5
RSASHA1
NOT RECOMMENDED
MUST
6
DSA-NSEC3-SHA1
MUST NOT
MUST NOT
7
RSASHA1-NSEC3-SHA1
NOT RECOMMENDED
MUST
8
RSASHA256
MUST
MUST
10
RSASHA512
NOT RECOMMENDED
MUST
12
ECC-GOST
MUST NOT
MAY
13
ECDSAP256SHA256
MUST
MUST
14
ECDSAP384SHA384
MAY
RECOMMENDED
15
ED25519
RECOMMENDED
RECOMMENDED
16
ED448
MAY
RECOMMENDED
253
PRIVATE
(MAY)
(MAY)
254
PRIVATE (OID)
(MAY)
(MAY)
➢ Rules for Algorithm Support in DNSSEC Software, acc. [RFC8624]
ECDSA
EdDSA
private
~ more secure
phasing out
phasing in
SHA1
RSA
#BHUSA @BlackHatEvents
Information Classification: General
DNSSEC DS Digest Types
Number
Mnemonics
DNSSEC Delegation 
DNSSEC Validation 
1
SHA-1
MUST NOT
MUST
2
SHA-256 
MUST
MUST
3
GOST R 34.11-94 
MUST NOT
MAY
4
SHA-384
MAY
RECOMMENDED
➢ Rules for DS Digest Type Support in DNSSEC Software, acc. [RFC8624]
in active use
#BHUSA @BlackHatEvents
Information Classification: General
Investigated Domains
Signed Domains
➢ 1373 Top-Level Domains (of 1487)
➢ 20083 Tranco Domains (of Top 500k)
➢ disregarding app. 9k domains without a validation path from the DNS root 
92.33%
7.77%
Signed TLDs
Signed
Insecure
4.02%
95.98%
Signed Tranco Top 500k
Signed
Insecure
#BHUSA @BlackHatEvents
Information Classification: General
Investigated Resolvers
Resolvers
➢ 9 resolvers in the lab (Bind, Unbound, Knot, PowerDNS; 5 Windows Server Versions)
➢ 8 popular open resolver services (Google, Cloudflare, …)
➢ 15k openly accessible resolvers from a port scan on the IPv4 address space (app. 3k validating resolvers)
79.91%
20.09%
Validating Open Resolvers
Insecure
Validate
#BHUSA @BlackHatEvents
Information Classification: General
Agenda
➢ DNS(SEC) Refresher
➢ DNSSEC Downgrade Attacks
➢ Attacks to Weaken Security
➢ Attacks to Break Security
➢ Recommendations
#BHUSA @BlackHatEvents
Information Classification: General
Downgrade Attacks on DNSSEC
Attacker Model: On-path Attacker (~ Threat Model of DNSSEC)
➢ positioned between the resolver and the authoritative server
➢ can send, read, modify, duplicate, delay, suppress, … messages
➢ does not know cryptographic secrets
Further Assumptions (to keep explanations simple)
➢ attacker can cause trigger resolution by the resolver
➢ empty caches
Recursive Resolver
Authoritative Name Server
#BHUSA @BlackHatEvents
Information Classification: General
Downgrade Attacks on DNSSEC
Recursive Resolver
Authoritative Name Server
ns.bank.ing. A?
ns.bank.ing
bank.ing. DNSKEY?
ns.bank.ing. A?
www.bank.ing. A?
1
2
3
4
5
8
9
7
6
#BHUSA @BlackHatEvents
Information Classification: General
Agenda
➢ DNS(SEC) Refresher
➢ DNSSEC Downgrade Attacks
➢ Attacks to Weaken Security
➢ Attacks to Break Security
➢ Recommendations
#BHUSA @BlackHatEvents
Information Classification: General
Attacks to Weaken Security
Goal
➢ make the resolver use the weakest possible validation path
➢ and attack that weakest link in the chain of trust
➢ (very) roughly conforms to downgrade to “Export” in SSL
Presented here
➢ Downgrading to a weaker DS digest
➢ Downgrading to a weaker signature
#BHUSA @BlackHatEvents
Information Classification: General
The Case of SHA-1 in DNSSEC
A Note on SHA-1
➢ “broken” in terms of cryptanalysis
➢ practical attacks on DNSSEC are expected in the near future
➢ attacks for non-DNSSEC cases have been demonstrated in 2019
SHA-1 in DNSSEC
➢ being phased out since about 2019, but still widely used
➢ algorithms 5 and 7 (“NOT RECOMMENDED”)
➢ digest type 1 (“MUST NOT”)
➢ resolvers must still support it
➢ virtually all do
➢ Shares of Secure Zones using SHA-1
DS
DNSKEY
TLDs
any
8.64%
4.10%
exclusively
0.22%
3.30%
Tranco
any
11.33%
6.22%
exclusively
3.38%
5.81%
#BHUSA @BlackHatEvents
Information Classification: General