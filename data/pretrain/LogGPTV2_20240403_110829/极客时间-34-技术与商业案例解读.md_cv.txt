# 116 \| Databricks之Spark的数据金砖王国说起大数据的创业公司，我们一定都会提到 Databricks这公司，而这家公司知名的原因，一大部分来自于它的开源产品 Spark。Spark 是Hadoop生态圈里大红大紫的项目，事实上，它甚至已经取代了新一代的经典运行框架：HadoopMapReduce。所以，想要了解 Databricks 这家创业公司，我们就需要先了解 Spark 这个Apache 开源项目。Spark 是一个大数据计算框架，它诞生于加州大学伯克利分校AMP 实验室，是当时的博士生马泰·扎哈里亚（Matei Zaharia）的博士论文课题。2010 年，Spark 在 BSD License 下开源。经过几年发展以后，在 2013 年成立了Databricks，同年，它被 Databricks 捐献给 Apache基金会，并将开源模式转向了 Apache 2.0，从此，Spark 正式成为 Apache家族里顶级开源项目之一。Spark 是目前整个 Hadoop 的生态系统里最为活跃的计算框架，它已经取代了Hadoop 原来 MapReduce 框架的地位，目前，只有 Flink的计算框架尚能与它平分秋色（有关 Flink的情况，我们会在后面的文章里详细介绍）。Spark 框架下支持SQL、机器学习、图计算、流计算等各种各样的计算模型，应用起来十分广泛。它不仅在开源社区里广受追捧，在大公司里也常常被拿来应用，IBM现在已经把自己的大数据计算引擎押宝在 Spark 上了。``{=html}介绍完 Spark，我们来看看它背后的 Databricks公司，这家公司是由加州大学伯克利分校 AMP实验室的原班人马组建的，它成立的目的主要是为了推广 Spark 和 Spark的生态圈。Databricks 的管理层可谓明星荟萃。CTO 马泰·扎哈里亚是 Apache Spark最初的创作者，同时也是斯坦福大学的教授。CEO 是阿里·格霍西（AliGhodsi）是加州大学伯克利分校的兼职教授，执行总裁艾恩·斯塔卡（IonStoica）也是学校的全职教授，他还是 CTO马泰·扎哈里亚的导师。另外一位联合创始人是华人雷诺·辛（ReynoldXin），他现在是首席架构师。Databricks 的核心，主要是 Spark。如果我们把 Spark理解成为一个计算平台的话，那么围绕着 Spark 生态圈做的东西则是 Databricks的核心价值。对 Databricks 来说，首先要做的事情，是把 Spark的开源项目越做越大。作为做大 Spark 的一部分，Databricks 对 Spark发展方向的掌控在开源社区是出了名的强势。自从 Databricks 成立以来，对Spark 技术的演进一直都是有自己的路线图的。近些年来，无论是 SparkSQL、DataFrame 的推出，还是基于 Mini-batch 的Spark Streaming 的工作开展，都是 Spark这个计算框架下面非常重要的项目。如果没有 Databricks的推动和首肯，这些项目几乎不可能进到 Spark 的发行版里。因此，我们总结一下 Databricks 的商业模式：壮大 Spark 社区，掌控和引导Spark 的技术走向。然而仅仅做大 Spark 开源项目，对 Databricks来说还是不够的，这些不足以带给 Databricks盈利；而一个公司是否成功，最终还是取决于这个公司的赚钱能力。从这个角度上来讲。壮大Spark 是 Databricks 盈利的一个基础，但是却不是 Databricks 盈利的根本。那么说，Databricks 是怎么盈利的呢？**Databricks的第一条盈利方式就是：选择在这些基石上面，开发附加产品来赚钱。**其中第一个产品，也是 Databricks 现阶段正在努力的方向，就是提供云上搭建的Spark 计算平台。我们来看看这个产品具体是如何赚钱的。Spark 团队在一开始设计 Spark 产品的时候，就遵循了一条原则：它和 Hadoop整个体系保持松耦合，所有的相关服务都抽象成接口，再通过接口调用。这样做的好处在于，如果 Spark哪一天决定和另外一套类似的系统对接，那么只要针对另外一套系统重新实现一下接口就好了，Spark自身的代码则完全不需要改动。这样，它一方面可以和 Hadoop 做到有效整合，借助业已壮大的 Hadoop平台和生态圈推广自己。另外一方面，如果万一哪天 Hadoop 被别家取代了，或者Spark需要针对某些企业内部系统（比如对微软、谷歌内部大数据系统）进行整合的话，改动工作也会非常容易。果不其然，深谋远虑的 Spark 团队十分生财有道。他们在开源了支持 Hadoop的社区版以外，还专门开发了直接对接云厂商的版本，比如亚马逊 AWS 版的Spark。这个版本的 Spark 按照 Databricks 公布的数据，针对 AWS 优化的 Spark的效率比开源版高 5 倍以上，但是，这个版本却不是开源的。Databricks 又把这个不开源的版本做成云服务卖给用户。由于这个版本的 Spark比开源版的要更快，很多企业愿意付钱买，这也就成了目前 Databricks最重要的盈利途径。**Databricks 的第二条盈利方式是对建立在 Apache Spark平台上的应用进行认证，并确保这些应用和 Spark 的兼容性。**这种认证当然不是免费的，由于 Spark社区的成功，这方面的认证开展工作也是如火如荼。**Databricks 的第三条盈利方式是：给使用了 Spark技术的各大公司提供技术支持。** 简单来说，Spark 虽然开源，但是用好 Spark的公司，不一定都有技术实力读、改源代码来适应自己的应用场景。这个时候买了Databricks 的技术支持服务的话，Databricks 就可以提供支持了。由于 Databricks 对 Spark 的源代码非常熟悉，Databricks的技术支持往往能够解决很多企业非常重要的紧急问题。而有些公司不缺钱，也愿意付钱给Databricks，这门生意对 Databricks 来说也是重要的赚钱途径。这三块服务是不是足够支撑 Databricks 呢？我想这个问题的答案有点复杂。第一块业务非常实际，这是可以大规模推广的赚钱方式。一部分开源，一部分不开源，通过开源来圈用户，通过提供更高性能的服务来赚钱。这个生意做得比较成功。这个生意里最大的问题是，Databricks自身并不拥有云平台，它的云平台主要运行在亚马逊的云服务上面，这就造成了亚马逊自己一旦也想做类似服务的话，Databricks就很难抵抗。所以多做几个云厂商上面的服务，这也许是一个好主意，起码可以不把全部筹码压在一个平台的身上。后面两块业务的市场取决于 Spark 到底有多重要，以及 Databricks 到底有多懂Spark。首先，我觉得 Spark 的重要性毋庸置疑，大企业比如 SAP，IBM都在其产品里面用 Spark 和引入对 Spark 的支持。这证明了 Spark的市场占有率是巨大的。其次，Databricks 的几个创始人基本上奠定了 Spark的架构。在很多情况下，某些特定的东西 Spark为什么是这样设计的，也只有做架构的人才能回答了。所以恐怕市面上不存在一家比Databricks 更懂 Spark 的商业机构。从这一点来看，Databricks的基本盘是很稳妥的，所以这两个业务也能赚到钱。但是，Databricks目前面临的一个大问题是机器学习，尤其是深度学习的潮流。Spark 是用 Scala写的，并在 JVM 上运行。这就意味着，基于 Spark的机器学习平台并不能有效地利用 GPU。这样一来，这个问题就大了。机器学习作为 Spark 最初也是最重要的应用之一，在 Spark社区占有很重要的地位。Databricks是否能够有效解决这个问题，对自己的是否能成功和 Spark将来会怎么发展，都非常的重要。Databricks 的另外一个考验是需要应对 Flink这个后起之秀的进攻。我想，Databricks 的前途是光明的，但是也会充满竞争和曲折。![](Images/e7329c467700f5b952da4bc227396c50.png){savepage-src="https://static001.geekbang.org/resource/image/ec/bb/ec0948decf6b89fbe778bfc82bea62bb.jpg"}
# 117 \| Data Artisans：浴火重生的新一代大数据计算引擎Flink2014 年，数据库领域的顶级会议 VLDB在杭州召开。柏林理工大学的教授沃克尔·马尔科（VolkerMarkl）做了一场关于大数据计算平台的专题报告，这场报告讲的是一个叫做Flink 的系统。沃克尔和他的团队从事大数据研究已经很多年了，他们最初开始做的是一个叫做Stratosphere 的项目。这个系统并不出名，既无 Hadoop 的声势浩大，也没有Spark 的迅速扩张。后来，沃克尔吸取了早年 Stratosphere系统的教训，并调研了市场上现存的系统不足，经过了重新设计，才制作出了这个叫Flink 的新系统。Flink以非常先进的流计算引擎思想为基本，同时还结合了传统大数据和数据库的优点。于是，这个系统一进入Apache 软件基金会以后，就迅速火爆了，甚至连 Capital One和国内的阿里巴巴集团银行都开始相继使用。Flink 从一出现就获得了很多的关注，这是自 Spark 项目出现以来，所有 Apache项目里面最受关注的一个。最主要的原因就是 Flink 的理念非常先进，而且Flink是基于流模型的一个计算平台，它所使用的流计算模型，又是目前市面上所有开源项目里最为先进的。"先进""实时""流计算"，这些词语被放在一起，就给Flink 带来了无限的光辉。``{=html}Flink 一时风头无两，网上很快出现了 Spark 是不是会被 Flink取代的言论。在美版知乎 Quora 和程序员非常喜欢的 Stack Overflow上面，这个问题屡次被提出来讨论。实际上这个问题却没有一个定论，业内大部分的人都觉得 Spark 和 Flink的竞争中，前者很成熟，商业化也不错；后者的理念先进，也有一定的支持，究竟谁能胜出，还是要看后续的发展。介绍完了 Flink的概况，我们再来聊聊它背后的公司。和加州大学伯克利学院对待 Spark一样，柏林理工 Flink 的主要开发者们，也为 Flink 成立了一家大数据公司Data Artisans，它的总部位于欧洲柏林，在硅谷设有分公司。从某种程度上，Data Artisans 和 Databricks 很像，区别只是前者的主打项目是Flink，后者是 Spark 而已。Data Artisans 的运营模式和盈利模式和 Databricks也很像，他们也提供一个基于 Flink 的云计算平台，叫做 dAPlatform。这个平台有开源的Flink，还有不开源的应用管理器，平台不开源的部分就是他们的增值服务。此外，公司同时提供了对Flink 的培训和咨询服务。如果我们把 Flink 换成Spark，忽略主打项目的不同，那么我们几乎可以看到两家公司几乎一样的商业运营模式。而这两个公司唯一的区别是：DataArtisans 目前不做认证服务。那么说，两个极其相似的产品之间，后来者 Data Artisans是不是会有一些不利之处呢。首先，它的竞争对手 Databricks 已经运营很久了。何况 Databricks的前身，加州大学伯克利分校的 AMP实验室也已经和工业界有非常紧密的联系，更不要说，Spark在整个社区里已经建立非常强劲的生态环境。其次，Flink作为一个新产品，又出自一个远离湾区的德国柏林的公司，它的境遇自然就要差一些了。先不去谈时间上的短板，仅仅因为它是欧洲公司出品的产品，就可以令它在湾区的使用率被打一个折扣。所以对于Flink，很多公司一直都是站着看戏的态度。这让 Flink在号称互联网中心的北美地区推广并不顺利。最后，虽然 Flink的产品在理念上很先进，但是理念从来都不是一切，理念之外，还需要有这个产品的实现。这方面，后来的Data Artisans 比起 Databricks 要差了不少，所以 Flink 实现起来，Bug会多一些，代码对于大规模的并行处理效率也要更低，有很多的瓶颈等等。不过，虽然 Flink 有诸多不利之处，但是它先进的流计算引擎思想，代表着比Spark更光明的未来。这不妨碍一些公司，尤其是自身学术能力不一定强，但是有着强大工程开发能力和开发资源的公司去支持Flink。Data Artisans的第一个强大的"后盾"就是阿里巴巴。阿里巴巴集团内部组建了一支自己的队伍，在数据库专家蒋晓伟的带领下，对Flink 的代码进行了大量的改动，这些改动在工程实现上让 Flink有了一个质的飞跃。这款克隆版的 Flink 就是我们在前面文章中讲到过的Blink。我们之前也讲到过，Flink 社区和阿里巴巴的 Blink团队的合作非常紧密。阿里巴巴把很多自己做的改动都重新贡献回 Flink，这让Flink 的发展迅速地走向了康庄大道。到今天为止，阿里巴巴是世界上对 Flink贡献代码第二多的公司，仅次于 Data Artisans。Data Artisans 和阿里巴巴的结合，让我们对 Flink 的未来多了很多信心。另外，在北美也有一家公司在支持着 Data Artisans，它就是 Capital One公司。Capital One 公司也是 Flink 目前在北美的最大使用者，它对 Flink的表现还是相当满意的。此外，公开支持 Flink 的还有谷歌。支持 Flink的原因是谷歌开源了它的数据流定义平台 ApacheBeam，而在开源这一平台的过程中，谷歌表示只有 Flink 这个引擎具备了 Beam需要的所有特性，其他引擎，包括 Spark 在内，都还是差了那么一点。这些都让 Flink 赢得了一些关注，但是不管怎么样，Flink在北美的发展，总体上仍然举步维艰。我们常常说"成就都是站在巨人的肩膀上取得的"，我们还常常会说"失败是成功之母"。Flink在某种程度上是这两句话的完美体现。Flink很晚才被开发出来，所以一方面，它继承了一个失败项目的优点，并规避了缺点。另外一方面，它参考了市场上已有的引擎，学习它们的长处与不足。简而言之，Flink的起点很高。但是晚出来的产品也有坏处。如果之前有一个很好的产品基本上已经占据了市场，那么晚出的产品想要得到市场的认可，不但需要技术要非常强大，还需要看自身的运气。而它的前辈Spark，的确是一个非常厉害的产品。所以说，Flink 能不能够抢占一整块市场，这一点不太好说。至于它能不能彻底把Spark 取代了，那更是痴人说梦。只要 Databricks 自己不犯错，Data Artisans要想取得胜利，实在是一件不容易的事情。但是我想，市场那么大，DataArtisans 应该也能分得自己的一块蛋糕。你又是怎么看待站在巨人的肩上这个问题呢？你可以给我留言，我们一起讨论。![](Images/e7329c467700f5b952da4bc227396c50.png){savepage-src="https://static001.geekbang.org/resource/image/ec/bb/ec0948decf6b89fbe778bfc82bea62bb.jpg"}