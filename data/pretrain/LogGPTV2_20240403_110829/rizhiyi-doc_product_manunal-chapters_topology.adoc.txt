== 拓扑图
日志易提供拓扑图，支持对各业务节点的状态采用卷帘式布局展示黄金指标，同时用户可自定义阀值进行变色提醒。还支持钻取，点击节点时跳转到自定义URL。
=== 拓扑图管理
通过"查询分析"\->"拓扑图"，进入拓扑图列表页。在拓扑图列表页可以通过应用、标签、名称过滤拓扑图，可以对拓扑图进行新建、查看、编辑、删除、重命名、设置标签、授权操作，也可以批量添加资源标签、批量删除拓扑图。
点击"新建"，弹出新建拓扑图窗口，按提示填入配置。
image::images/topology-new.png[]
新建成功后点击名称，进入拓扑图编辑页面。
image::images/topology-icon.png[]
如上图所示，右上角图标分别代表：
1. 添加输入项：把输入作为变量，在节点的搜索语句或其他输入项中输入${token}，即可引用变量。
2. 拓扑图设置项，分别为：
* 编辑拓扑图：默认关闭状态。启用编辑拓扑图后，可以在画布上添加、编辑、删除节点、连线和分组。
* 显示输入项：默认关闭状态。启用后在画布左上角可以看到和使用输入项功能。
* 全屏展示：使用全屏展示拓扑图，按ESC退出全屏。
* 手动刷新
* 自动刷新：启用后可以选择提供的刷新时间，30秒、1分钟、3分钟、5分钟、10分钟，也可以自定义刷新时间。
==== 添加节点
启用"编辑拓扑图"，在画布右侧选择"节点"，拓扑图节点类型有：矩形、圆形、椭圆、菱形、业务节点、图片节点。前4种类型只展示节点标签，我们可以配置配置填充颜色、填充可见度、描边颜色、描边线宽、描边线型。右击节点选择删除，即可删除节点。
image::images/topology-add-node.png[]
===== 添加业务节点
当节点需要展示搜索结果时，我们可以添加业务节点。业务节点除了可以配置节点标签，填充和描边外，还支持数据配置，如下图：
image::images/topology-value-node.png[]
单击'添加系列'添加数据。一个业务节点可以添加多个数据系列，每个值占一行，依次向下排列。
image::images/topology-add-value.png[]
单击"点击配置"，选择搜索的事件范围，在弹出框中输入spl，spl具体语法请查看《日志易检索参考》。
image::images/topology-add-value-2.png[]
如果搜索语句中包含timechart命令，则自动使用sparkline的形式展示搜索结果。如下图展示最近1小时的事件趋势:
image::images/topology-timechart.png[]
在弹出框完成搜索后，单击"更新节点数据"。然后：
* 选择图标类型：指标，流量，错误率。
* 输入名称：用于区分多个系列。
* 选择搜索返回结果中的字段。
* 输入单位，展示在字段值右侧。
* 配置告警：可是设置不同的告警区间，分别对应不同的告警级别，最多支持高，中，低三个级别，对应展示红色，橙色，黄色。
* 配置钻取：支持无钻取动作和跳转到自定义URL。自定义URL支持相对或者绝对URL，支持在URL中使用变量${click.name}和${click.value}，其中前者表示节点分组名，后者表示节点名。例如输入URL为http://www.baidu.com/s?w=${click.name}，关闭编辑状态，点击节点，则跳转到新页面，页面URL为https://www.baidu.com/s?wd=[节点名称]。
点击"更新"按钮，成功添加业务节点。
===== 添加图片节点
节点类型还支持图片节点，图片来自于系统内置3张图片和图片库，用户可以在拓扑图列表点击图片库，进入图片管理页，上传图片。
image::images/topology-add-icon.png[]
==== 配置边
业务分析中经常需要连接节点，这时按住shift键，点击节点，出现连线，连接到目的节点即可。选中边，在右侧编辑边的类型、标签、接入点、边样式。
image::images/topology-line-start.png[]
选中边点击右键，选择"删除"，即可删除边。
==== 配置分组
分组也是业务关系中经常用到的概念，在这里我们需要先创建分组，然后把需要加入分组的节点拖到分组内，也可以向分组中添加分组。拖动分组内的节点到其他位置，分组的方框会自动扩大。
image::images/topology-fenzu.png[]
==== 输入项配置
点击添加输入项图标，弹出配置窗口。拓扑图的输入项与仪表盘的输入项类似，都可以把输入作为变量，在节点的搜索语句或其他输入项中使用${token}，即可引用变量。
示例：点击'添加输入项'，配置动态菜单，默认值是200，如下图
image::images/topology-input-token.png[]
在节点的搜索语句和钻取 URL 中均可引用变量。例如节点搜索语句为apache.status:${status} | stats count()，
则选择不同的输入值，节点展示的结果随之变化。
输入项可通过 URL 传参方式自动赋值。如：`http://192.168.1.141/topology/1/?filter1=aaa`。
文本菜单和下拉框菜单配置类似，可参考仪表盘的输入项配置说明。
=== 图片库管理
在拓扑图列表页右上角，点击"图片库"，进入图片库管理页面。
image::images/topology-photo.png[]
点击"上传"，在图片上传弹层中，拖入文件，或点击打开文件选择器，找到对应图片文件上传。拓扑图图片库仅支持 png 格式图片，文件必须小于 100KB，并建议使用分辨率为 80*80px 的图片。
图片库中的图片，在任意拓扑图中均可共享使用。
如果不再需要该图片，在图片左下角勾选以后，点击删除即可。