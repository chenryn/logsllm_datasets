 57451 | p157     | relation      |    13285 |  1921938 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p153     | relation      |    13285 |  1921906 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p47      | relation      |    13285 |  1921058 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p66      | relation      |    13285 |  1921210 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p21      | relation      |    13285 |  1920850 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p84      | relation      |    13285 |  1921354 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p241     | relation      |    13285 |  1922610 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p41      | relation      |    13285 |  1921010 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p19      | relation      |    13285 |  1920834 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p235     | relation      |    13285 |  1922562 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p255     | relation      |    13285 |  1922722 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p130     | relation      |    13285 |  1921722 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p219     | relation      |    13285 |  1922434 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p140     | relation      |    13285 |  1921802 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p188     | relation      |    13285 |  1922186 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p138     | relation      |    13285 |  1921786 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p212     | relation      |    13285 |  1922378 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p61      | relation      |    13285 |  1921170 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p249     | relation      |    13285 |  1922674 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p155     | relation      |    13285 |  1921922 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p114     | relation      |    13285 |  1921594 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p53      | relation      |    13285 |  1921106 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p136     | relation      |    13285 |  1921770 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p23      | relation      |    13285 |  1920866 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p16      | relation      |    13285 |  1920810 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p222     | relation      |    13285 |  1922458 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p239     | relation      |    13285 |  1922594 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p183     | relation      |    13285 |  1922146 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p93      | relation      |    13285 |  1921426 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p204     | relation      |    13285 |  1922314 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p224     | relation      |    13285 |  1922474 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p221     | relation      |    13285 |  1922450 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p105     | relation      |    13285 |  1921522 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p151     | relation      |    13285 |  1921890 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p100     | relation      |    13285 |  1921482 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p133     | relation      |    13285 |  1921746 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p254     | relation      |    13285 |  1922714 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p174     | relation      |    13285 |  1922074 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p124     | relation      |    13285 |  1921674 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p120     | relation      |    13285 |  1921642 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p40      | relation      |    13285 |  1921002 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p146     | relation      |    13285 |  1921850 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p195     | relation      |    13285 |  1922242 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p139     | relation      |    13285 |  1921794 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p70      | relation      |    13285 |  1921242 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p57      | relation      |    13285 |  1921138 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p49      | relation      |    13285 |  1921074 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p172     | relation      |    13285 |  1922058 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
 57451 | p145     | relation      |    13285 |  1921842 |      |       |            |               |         |       |          | 3/60843            | 57451 | RowExclusiveLock | t       | f  
(261 rows)  
```  
## 性能对比  
256个分区，写入测试。  
```  
vi test.sql  
\set id random(1,1000000000)  
insert into p values (:id,md5(random()::text),now()) on conflict(id) do nothing;  
```  
### 1、PG 11  
```  
pgbench -M prepared -n -r -P 1 -f ./test.sql -c 32 -j 32 -T 120 -h /tmp -p 8001 -U postgres postgres  
transaction type: ./test.sql  
scaling factor: 1  
query mode: prepared  
number of clients: 32  
number of threads: 32  
duration: 120 s  
number of transactions actually processed: 1361828  
latency average = 2.820 ms  
latency stddev = 0.831 ms  
tps = 11348.115169 (including connections establishing)  
tps = 11348.492358 (excluding connections establishing)  
statement latencies in milliseconds:  
         0.001  \set id random(1,1000000000)  
         2.818  insert into p values (:id,md5(random()::text),now()) on conflict(id) do nothing;  
```  
### 2、PG 12  
```  
/home/digoal/pg12/bin/pgbench -M prepared -n -r -P 1 -f ./test.sql -c 32 -j 32 -T 120 -h /tmp -p 3335 -U postgres postgres  
transaction type: ./test.sql  
scaling factor: 1  
query mode: prepared  
number of clients: 32  
number of threads: 32  
duration: 120 s  
number of transactions actually processed: 32093836  
latency average = 0.119 ms  
latency stddev = 0.058 ms  
tps = 267447.357761 (including connections establishing)  
tps = 267456.481028 (excluding connections establishing)  
statement latencies in milliseconds:  
         0.000  \set id random(1,1000000000)  
         0.119  insert into p values (:id,md5(random()::text),now()) on conflict(id) do nothing;  
```  
## 性能提升23.57倍  
版本 | TPS  
---|---  
PG 11 | 11348  