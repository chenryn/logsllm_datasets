# Protocol - Exploits
`注:本分类里内容并非全是协议的 bug,部分 "基于、使用" 这个协议的应用所存在的漏洞也算在其中,例如 dns 域传送漏洞,其并非 dns 协议本身的漏洞,为服务部署时的配置问题,但应用与 DNS 相关的业务,故此分类`
`补充和相关协议有关的知识点,不知道怎么分类,就放到这个部分了,例如:ja3,Shadow-TLS`
---
## 免责声明
`本文档仅供学习和研究使用,请勿使用文中的技术源码用于非法用途,任何人造成的任何负面影响,与本人无关.`
---
## 大纲
* [DNS](#dns)
* [ipv6](#ipv6)
* [LDAP](#ldap)
* [RTSP](#rtsp)
* [SMB](#smb)
* [PPTP](#pptp)
* [SMTP](#smtp)
* [SNMP](#snmp)
* [SSH](#ssh)
* [SSL](#ssl)
* [VNC](#vnc)
* [Other](#other)
    * [Ripple20](#ripple20)
---
## DNS
**关于 DNS**
- [DNS](../../../Integrated/Network/应用层/DNS.md)
**CVE-1999-0532 dns 域传送漏洞**
- 简介
    DNS 服务器分为：主服务器、备份服务器和缓存服务器，在主备服务器之间同步数据库，需要使用 “DNS 域传送”。
    域传送是指后备服务器从主服务器拷贝数据，并用得到的数据更新自身数据库。若 DNS 服务器配置不当，可能导致匿名用户获取某个域的所有记录。造成整个网络的拓扑结构泄露给潜在的攻击者，包括一些安全性较低的内部主机，如测试服务器。
- 相关文章
    - [DNS域传送漏洞](http://www.lijiejie.com/?s=DNS%E5%9F%9F%E4%BC%A0%E9%80%81%E6%BC%8F%E6%B4%9E)
- POC | Payload | exp
    ```bash
    dig @dns.xxx.edu.cn axfr xxx.edu.cn
    # @ 指定域名服务器;
    # axfr 为域传送指令;
    # xxx.edu.cn 表示要查询的域名;
    ```
### 子域接管漏洞
**什么是子域接管**
子域名接管是注册不存在的域名以获得对另一个域的控制权的过程
1. 域名（例如 sub.ffffffff0x.com）将 CNAME 记录用于另一个域（例如 sub.ffffffff0x.com CNAME f0x.com）。
2. 在某个时间点, f0x.com 到期并可供任何人注册。
3. 由于未从 ffffffff0x.com DNS 区域删除 CNAME 记录，因此注册 f0x.com 的任何人都可以完全控制 sub.ffffffff0x.com，直到删除 DNS 记录。
通过使用子域接管，攻击者可以从合法域中发送网络钓鱼电子邮件，执行跨站点脚本（XSS）或发布不实言论信息等恶意行为。
子域接管不仅限于 CNAME 记录。NS，MX 甚至 A 记录（均不受此限制）也将受到影响。
**相关文章/案例**
- [EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz/)
- [HackerOne 漏洞案例 | 子域名劫持漏洞的挖掘指南](https://www.freebuf.com/articles/web/183254.html)
- [A Guide To Subdomain Takeovers | HackerOne](https://www.hackerone.com/blog/Guide-Subdomain-Takeovers)
- [Subdomain Takeover](https://echocipher.github.io/2019/08/14/Subdomain-takeover/)
- [利用 Cloudflare Partner 劫持域名](https://mp.weixin.qq.com/s/K4vzPAmGCiDzqs6eREAsOg)
- [HOW I hacked thousand of subdomains](https://medium.com/@moSec/how-i-hacked-thousand-of-subdomains-6aa43b92282c)
- https://0xpatrik.com/
- [Subdomain Takeover 子域名接管漏洞](https://mp.weixin.qq.com/s/a1hQX4J_oNa8GU2y82ZU6w)
- [子域名接管漏洞是怎么回事儿](https://mp.weixin.qq.com/s/J_P3zWBseGZKNkZF2DvVxw)
**相关资源**
- [EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz)
**相关工具**
- [elceef/dnstwist](https://github.com/elceef/dnstwist) - 快速扫描成百上千个可能的域名组合，并提取与域名匹配的 IPv4 或 IPv6 地址
- [haccer/subjack](https://github.com/haccer/subjack) - Subdomain Takeover tool written in Go
- [Echocipher/Subdomain-Takeover](https://github.com/Echocipher/Subdomain-Takeover) - 一个子域名接管检测工具
- [LukaSikic/subzy](https://github.com/LukaSikic/subzy) - Subdomain takeover vulnerability checker
### DNS Rebinding
- [DNS Rebinding](../Web安全/Web_Generic/SSRF.md#dns-rebinding)
---
## ipv6
**相关文章**
- [浅谈 IPv6 的入侵与防御](https://www.freebuf.com/articles/web/202901.html)
- [“失控”的 IPv6：观察 IPv6 网络环境安全现状](https://paper.seebug.org/1277/)
- [谁不想要 2^64 个 IP 的代理池 ？](https://zu1k.com/posts/tutorials/http-proxy-ipv6-pool/)
- [利用IPV6绕过B站的反爬](https://blog.yllhwa.com/2022/09/05/%E5%88%A9%E7%94%A8IPV6%E7%BB%95%E8%BF%87B%E7%AB%99%E7%9A%84%E5%8F%8D%E7%88%AC/)
- [用 ipv6 构造一个代理 ip 池](https://v2ex.com/t/833075)
**相关工具**
- [vanhauser-thc/thc-ipv6](https://github.com/vanhauser-thc/thc-ipv6) - IPv6 攻击工具箱
- [fgont/ipv6toolkit](https://github.com/fgont/ipv6toolkit) - SI6网络的IPv6工具包
- [sfan5/fi6s](https://github.com/sfan5/fi6s) - IPv6 network scanner designed to be fast
---
## LDAP
**描述**
轻量级目录访问协议，是一种在线目录访问协议，主要用于目录中资源的搜索和查询，是 X.500 的一种简便的实现。
LDAP 是一种运行于TCP/IP之上的在线目录访问协议，主要用于目录中资源的搜索和查询。使用最广泛的LDAP服务如微软的ADAM(Active Directory Application Mode)和OpenLDAP.
**相关文章**
- [LDAP 协议入门（轻量目录访问协议）](https://zhuanlan.zhihu.com/p/147768058)
**相关工具**
- https://directory.apache.org/studio/
### LDAP注入
**相关文章**
- [LDAP注入与防御剖析](http://drops.xmd5.com/static/drops/tips-967.html)
- [初探 LDAP 安全 [ 一 ] ](https://klionsec.github.io/2017/12/20/ldap-sec/)
- [从一次漏洞挖掘入门Ldap注入](https://xz.aliyun.com/t/5689)
---
## MQTT
> fofa: port="1883" && protocol="mqtt
**描述**
MQTT(Message Queuing Telemetry Transport,消息队列遥测传输协议)。可以以极少的代码和有限的带宽，为远程设备提供实时可靠的消息服务，一种低开销、低带宽占用的即时通讯协议。MQTT协议运行于TCP之上，属于应用层协议。
**相关文章**
- [MQTT安全分析](https://mp.weixin.qq.com/s/SNJy5rgJSZlO-GoePb4VRw)
- [网络空间测绘——MQTT服务篇](https://mp.weixin.qq.com/s/b_ZgX8CM25R7uE4RGjtDRg)
**MQTT 相关工具**
- [mosquitto](https://mosquitto.org/download/) - MQTT服务端程序
    ```bash
    apt-get install mosquitto
    apt-get install mosquitto-clients
    mosquitto -v
    mosquitto_sub -h 127.0.0.1 -t debug
    ```
- mqtt.fx
- [thomasnordquist/MQTT-Explorer](https://github.com/thomasnordquist/MQTT-Explorer) - An all-round MQTT client that provides a structured topic overview
- [emqx/MQTTX](https://github.com/emqx/MQTTX) - Elegant Cross-platform MQTT 5.0 Desktop Client
- [node-red/node-red](https://github.com/node-red/node-red) - Low-code programming for event-driven applications
**暴力破解**
- [zombiesam/joffrey](https://github.com/zombiesam/joffrey) - Stupid MQTT Brute Forcer
---
## RTSP
**描述**
实时流媒体协议（RTSP）是一种网络控制协议，设计用于娱乐和通信系统，以控制流媒体服务器。该协议用于建立和控制终端之间的媒体会话。媒体服务器的客户端发出 VHS 风格的命令，如播放、录制和暂停，以方便实时控制媒体流从服务器到客户端（视频点播）或从客户端到服务器（语音录制）。
流媒体数据的传输本身不是 RTSP 的任务。大多数 RTSP 服务器使用实时传输协议 (RTP) 与实时控制协议 (RTCP) 相结合来传输媒体流。
**暴力破解**
- [Tek-Security-Group/rtsp_authgrinder](https://github.com/Tek-Security-Group/rtsp_authgrinder)
---
## SMB
**相关文章**
- [SMB协议（445端口）渗透测试](https://mp.weixin.qq.com/s/_SGJWfjHhR3m_Ky31ZGSxQ)
**信息收集**
- MSF 模块
    ```bash
    use auxiliary/scanner/smb/smb_version
    use exploit/multi/samba/usermap_script
    ```
- nmblookup
    ```bash
    nmblookup -A 
    ```
- ngrep
    ```bash
    "ngrep -i -d tap0 's.?a.?m.?b.?a.*[[:digit:]]'
    smbclient -L \\\\"
    ```
- nmap脚本
    ```bash
    nmap --script smb-vuln* -p139,445 -T4 -Pn 
    ```
**枚举用户**
- nmap脚本
    ```bash
    nmap --script smb-enum-users.nse -p 445 
    ```
- rpcclient
    ```bash
    rpcclient -U '' 
        querydominfo
        enumdomusers
        queryuser 
    ```
- enum4linux
    ```bash
    enum4linux 
    ```
**获取共享**
- smbmap
    ```bash
    smbmap -H   -R 
    ```
- smbclient
    ```bash
    echo exit | smbclient -L \\\\$ip
    "smbclient \\\\\\"
    smbclient -L // -N
    ```
- nmap
    ```bash
    nmap --script smb-enum-shares -p139,445 -T4 -Pn 
    ```
**空会话**
- smbmap
    ```bash
    smbmap -H 
    ```
- rpcclient
    ```bash
    rpcclient -U "" -N $ip
    ```
- smbclient
    ```bash
    smbclient ///IPC$ -N