User: 请解答这个和日志有关的问题e1000e Reset adapter unexpectedly / Detected Hardware Unit Hang I have a Dell 1U Server with Intel(R) Xeon(R) CPU L5420 @ 2.50GHz, 8 cores running Ubuntu Server Kernel Version 3.13.0-32-generic on x86_64. It has dual 1000baseT networking cards. I have it set up to forward packets from eth0 to eth1. 

I have noticed that in my kern.log file it keeps hanging then resting. This is happening often. This happens every few second then maybe it will be ok for a few minutes then back to every few seconds.   

Here is the log file dump:

 [118943.768245] e1000e 0000:00:19.0 eth0: Detected Hardware Unit Hang:
 [118943.768245]   TDH                  &lt;45&gt;
 [118943.768245]   TDT                  &lt;50&gt;
 [118943.768245]   next_to_use          &lt;50&gt;
 [118943.768245]   next_to_clean        &lt;43&gt;
 [118943.768245] buffer_info[next_to_clean]:
 [118943.768245]   time_stamp           &lt;101c48d04&gt;
 [118943.768245]   next_to_watch        &lt;45&gt;
 [118943.768245]   jiffies              &lt;101c4970f&gt;
 [118943.768245]   next_to_watch.status &lt;0&gt;
 [118943.768245] MAC Status             &lt;80283&gt;
 [118943.768245] PHY Status             &lt;792d&gt;
 [118943.768245] PHY 1000BASE-T Status  &lt;7800&gt;
 [118943.768245] PHY Extended Status    &lt;3000&gt;
 [118943.768245] PCI Status             &lt;10&gt;
 [118944.780015] e1000e 0000:00:19.0 eth0: Reset adapter unexpectedly


Here is the info from ethtool:

Settings:

Settings for eth0:

Supported ports: [ TP ]
Supported link modes:   10baseT/Half 10baseT/Full 
                        100baseT/Half 100baseT/Full 
                        1000baseT/Full 
Supported pause frame use: No
Supports auto-negotiation: Yes
Advertised link modes:  10baseT/Half 10baseT/Full 
                        100baseT/Half 100baseT/Full 
                        1000baseT/Full 
Advertised pause frame use: No
Advertised auto-negotiation: Yes
Speed: 1000Mb/s
Duplex: Full
Port: Twisted Pair
PHYAD: 1
Transceiver: internal
Auto-negotiation: on
MDI-X: off (auto)
Supports Wake-on: pumbg
Wake-on: g
Current message level: 0x00000007 (7)
               drv probe link
Link detected: yes


Driver info:

ethtool -i eth0

driver: e1000e
version: 2.3.2-k
firmware-version: 1.4-0
bus-info: 0000:00:19.0
supports-statistics: yes
supports-test: yes
supports-eeprom-access: yes
supports-register-dump: yes
supports-priv-flags: no


What could be causing this? Is this just a bug in the software or a actual hardware issue?  I have seen many other having similar issues but no real solution and this also leads me to believe that its a software issue? 

Maybe someone can shed some light on this for me?

Assistant: Ok so after posting this question last night night I continued to do some research the only real solution I came across seems to have taken care of the problem. 

Disabling TSO, GSO and GRO using ethtool:

ethtool -K eth0 gso off gro off tso off


According to a post found here: http://ehc.ac/p/e1000/bugs/378/

From what I understand this will or can cause a reduction in performance.

I also noticed another solution was to disable Active-State Power Management

pcie_aspm=off


According to this post on serverfault: Linux e1000e (Intel networking driver) problems galore, where do I start?

I haven’t tried this solution yet. I will try it and see if that makes a difference and post back my findings.

EDIT: 

Ok so I have tried turning off Active-State Power Management, pcie_aspm=off and this didn't have any effect. I continued to notice errors in my log file. 

This may still work for some as some of the Intel nics have issues with different kernels of falling asleep when power management is enabled.