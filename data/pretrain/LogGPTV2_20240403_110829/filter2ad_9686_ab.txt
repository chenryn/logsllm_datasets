Android 设备管理器对于一个普通 APP 而言并不太常用，但在很多病毒中十分常见。一旦应用被激活成为系统管理员，则在设置->应用程序下无法直接删除该
APP ，只有取消激活后才能卸载。所以对于不了解的应用，千万不可乱激活。见下图：
运行结果如下图：当用户点击激活后，钓鱼木马就获得了设备管理员权限，这样会导致普通用户很难卸载掉该钓鱼木马。
**4.3.3、接管短信应用**  
钓鱼木马接着引导用户设置自己为系统短信应用，接管短信服务，以获得对短信数据库的操作权限（见下图）。Android 4.4 及其以后，只能设置一个默认的
SMS 短信 APP ，当短信到达后会首先通知设置的默认 APP ，并且只有该APP对短信数据库有修改的权限和短信的发送权限。
运行效果如下图，当用户点击“是”后，钓鱼木马即成功接管短信服务，拿到了对短信数据库的操作权限。
**4.3.4、实施钓鱼**  
以上准备完成后，钓鱼木马会每隔1秒检测感染设备当前活动界面是否是：中国邮政储蓄银行、交通银行、招商银行的 APP 。如果是，则打开对应的钓鱼页面.
我们下面仅列出针对招商银行的钓鱼页面代码。可以看到钓鱼木马利用钓鱼页面窃取用户的 sim 卡序列号、手机号码、登录密码等后，以 json 的格式 post
到 C&C 服务器http://103.55.26.147/servlet/CMBSubmit ，见下图。
**4.3.5、监控用户短信**  
钓鱼木马使用内容观察者模式，监视用户短信。当短信内容是`000#`，设置配置文件`inter`的值为1，删除短信；当短信内容是`0#`，设置配置文件`inter`的值为0，删除短信；当短信内容是`555#`，删除短信，并收集用户本机所有短信，企图邮件回传。并且，如果短信内容为控制命令`000#`时，就以
json 格式 post 用户手机 sim 卡序列号、手机号码、短信内容，发送者、发送时间到 C&C
服务器：http://103.55.26.147/servlet/SendMassage2 。见下图。
攻击者控制用户手机后，每发起一笔交易，银行的验证码和消费回执信息就会被拦截窃取再行删除（见下图），这样等于破解了银行的双重验证机制，并在用户没有丝毫察觉的情况下完成交易。对用户的财产安全构成严重威胁。
**4.3.6、服务常驻**  
钓鱼木马还定义了广播接收器，用于自启动。当用户手机重启或者解锁时，启动钓鱼服务，继续其侵害过程。
**4.3.7、检测杀毒软件**  
除了以上功能之外，该钓鱼木马还内置有检测杀毒软件的功能，判断感染设备是否安装有360杀软相关应用（见下图）。现在在很多恶意样本中都能看到针对杀毒软件的处理函数，一般是判断某流行杀软是否存在，如果存在，就后台静默卸载。不过该函数未在该版本中调用。所以初步推断该钓鱼木马目前还处于前期的开发调试阶段，后续极有可能大规模感染，我们应该给予持续的关注和跟进。
#### 5、溯源
###### 5.1、邮箱信息
我们尝试使用钓鱼木马配置文件中的攻击者邮箱和密码来登录攻击者的126邮箱，但目前已无法正常登录（见下图），应该是攻击者已经修改了密码。
###### 5.2、C&C 服务器信息
通过以上分析我们知道该钓鱼木马的C&C为103.55.26.147，目前该C&C的IP依然有效，但是通过反查的域名并没有发现有价值的线索。
###### 5.3、其他线索
我们尝试在 appscan.io
中查询攻击者邮箱`PI:EMAIL`，结果发现除了我们分析的当前钓鱼木马，还有其他3个相关应用（见下图）。`文档.apk`样本变化不大，我们试图从`录像.apk`入手寻找线索。经分析发现，`录像.apk`部分代码结构和代码逻辑与本文分析的银行类钓鱼木马高度相似，可以断定这两个
apk 为同一个作者。
我们在`录像.apk`的 so
文件中，得到了一组邮箱密码和一个手机号码（见下图）。经分析该邮箱为攻击者控制的信息回传邮箱。该手机号码为攻击者短信回传的目的手机号码。
我们尝试登录该126邮箱，登录成功！
我们发现此邮箱确为攻击者控制的信息回传邮箱。并且在其网盘里发现了一个`视频.apk`恶意文件。邮箱里面记录了窃取到的用户手机通讯录列表、短信列表、截获到的短信等敏感数据（见下图）。这些信息最早日期是2015年11月30日，最晚为2016年10月11日且都处于未被打开状态，但从信息数量来看并不大。我们可以推断，“视频.apk”为该时间段攻击者的一个测试样本，并未全面使用。
另外，从邮箱的其他收信内容来看，该邮箱注册的重要账户有：Apple
ID、支付宝、淘宝、微博、Facebook、Turo租车等。从关联到的微博账户和Facebook账户内容来看，初步判断该邮箱很有可能是被攻击者盗用的一个受害者邮箱账户。
在其网盘发现的一个`2015视频.apk`文件，显示时间为2015年9月20日。
窃取到的受害人敏感信息：
截获到的新短信：
窃取到的短信列表：
窃取到的通讯录：
再来看看手机号码：183****5246，我们在支付宝中未查到该手机注册相关账户，但在微信中倒是查找到一个关联用户（见下图）。
###### 5.4、溯源总结
通过简单的溯源分析，我们找到了攻击者使用的一个控制邮箱并在登录成功后，查看到了其回传的受害者敏感信息。但还没有准确定位到攻击者本身。我们通过内置手机号码分别在支付宝和微信上查找注册信息，最终找到了微信上关联的一个用户。根据现有的线索，对攻击者的信息溯源目前就到此为止。因为该钓鱼木马还是一个前期测试样本，相信在后续的跟进中会挖掘出更多的攻击者相关信息。
#### 6、总结及建议
###### 6.1、技术总结
与大部分采用 java 层代码加密和方法混淆技术的 Android 恶意代码不同的是，该 Android
银行钓鱼木马采用了类似于加固(加壳)保护的技术，将真正的恶意实体进行加密并隐藏起来，在恶意软件运行时通过 SO
动态解密并加载执行真实的恶意软件实体。这样不仅可以绕过杀毒软件的查杀，还增加了安全研究人员的逆向分析难度。可以预见，随着攻防的不断升级，越来越多的恶意软件开始使用加壳技术来自我保护，安全分析工作任重而道远。
###### 6.2、安全建议
目前由于该银行类钓鱼木马的 C&C
服务器无法连接，故其还处于无法正常使用状态。不过，从代码逻辑和功能来看，有部分功能代码并没有调用，比如检测360杀毒软件。可以判定，该恶意软件仍然处于开发调试阶段，并不成熟，我们将持续关注和跟进。
对于 Android 用户，建议不安装不明来源的 APP，对申请可疑权限尤其是短信读写、打电话以及需要激活设备管理器的 APP
要特别留意。涉及金钱的操作要格外谨慎，遇到操作异常或扣费异常，要及时联系银行冻结账户或者拨打110报警，避免遭受更大损失。
* * *
**启明星辰积极防御实验室（ADLab）**
ADLab成立于1999年，是中国安全行业最早成立的攻防技术研究实验室之一，微软MAPP计划核心成员。截止目前，ADLab通过CVE发布Windows、Linux、Unix等操作系统安全或软件漏洞近300个，持续保持亚洲领先并确立了其在国际网络安全领域的核心地位。实验室研究方向涵盖操作系统与应用系统安全研究、移动智能终端安全研究、物联网智能设备安全研究、Web安全研究、工控系统安全研究、云安全研究。研究成果应用于产品核心技术研究、国家重点科技项目攻关、专业安全服务等。
* * *