Generatepatternβ ∪α withsupport=minsupportofnodesinβ
end
end
else
foreachα intreedo
i
Generatepatternβ =α ∪α withsupport=α .support
i i
Constructβ’sconditionalpatternbaseandβ’sconditionalFP-treeT
β
ifT (cid:44)ϕ then
β
callFB-Growth(T ,β)
β
end
end
end
Afterfindingthefrequentitem-setsinthedataset,weexaminehowstronglytheitem-setscan
differentiatepositive(e.g.failedhardware/jobs)samplesfromthenegativeones.Weuselift,defined
Proc.ACMMeas.Anal.Comput.Syst.,Vol.4,No.2,Article31.Publicationdate:June2020.
31:10 Lin,etal.
inSection3.1,tofilteroutitem-setsthatarefrequentinthefailurestatebutnotparticularlyuseful
indecidingifasamplewillfail.Forexample,anitem-setcanbefrequentinbothnon-failureand
failurestates,andtheevaluationbasedonliftwouldhelpusremovethisitem-setfromtheoutput
becauseitisnotveryusefulindecidingwhethersamplesinthatitem-setwouldfailornot.
3.5 Pre-andPost-ProcessingforPerformanceOptimization
Weincorporatedmultipleoptimizationsaspre-andpost-processingtoscaletheRCAframework
foraccommodatingnearreal-timeinvestigations,whichareimportantinrespondingtourgent
systemissuesquickly.Manyentitiesinaproductionlogareidentical,exceptthecolumnsthatare
uniqueidentifiersoftheentitiessuchasthetimestamps,hostnames,orjobIDs.UtilizingScuba’s
scalableinfrastructure[1],wequerypre-aggregated datawhicharealreadygroupedbythedistinct
combinationsofcolumnvalues,withanadditionalweight columnthatrecordsthecountofthe
identicalentities.Tohandlethiscompactrepresentationofthedataset,wemodifiedthealgorithms
toaccountfortheweights.Thispre-aggregationsignificantlyreducestheamountofdatathatwe
needtoprocessinmemoryandwouldreducetheruntimeofourproductionanalysesby>100X.
ColumnsthatareuniqueidentifiersabouttheentitiesneedtobeexcludedbeforetheScuba
query.TheaggregationinScubaisonlymeaningfulafterexcludingthesecolumns,otherwisethe
aggregationwouldreturnoneentityperrowduetothedistinctvaluesperentity.Theframework
allows users to specify columns to be excluded in the dataset, as well as automatically checks
toexcludecolumnswiththenumberofdistinctvalues > D portionofthenumberofsamples.
Empirically,weuseD =2%inoneofourapplications,andthepropersettingofD highlydepends
onthenatureofthedataset.
AddingmultithreadingsupporttothealgorithmfurtherimprovesApriori’sperformance,asthe
algorithmgeneratesalargenumberofcombinationsandtestthemagainstthedata.Bytesting
thesecombinationsinparallel,wecanscaleupwiththenumberofavailablecores.However,we
foundthatFP-GrowthoutperformsApriorievenwhenAprioriisoptimizedwithmultithreading.
3.6 InterpretabilityOptimization
In production datasets, it is common that there exist a large number of distinct items, and the
lengthsofthefindingsaretypicallymuchsmallerthanthenumberoftheone-hotencodedfeature
columns(asdiscussedinSection3.3).Asaresult,therecanbemultiplefindingsdescribingthe
samegroupofsamples.Toimprovethequalityoftheresult,weimplementedtwofilteringcriteria
forremovinguninterestingresultsasdescribedbelow:
Filter1:Anitem-setT isdroppedifthereexistsapropersubsetU,(U ⊂T)suchthatlift(U)∗
H ≥lift(T),whereH ≥ 1
lift lift
If there exist shorter rules with similar or higher lift, longer rules are pruned because they
arelessinteresting.H isamultiplierthatcanbetunedbasedonthenatureofthedataset,to
lift
removemorelongerrules,asitmakestheconditioneasiertobesatisfied.Thisfilteraddressesthe
ubiquitousitemsdiscussedin[6].Asthereexistsashorterrulewithsimilarorhigherlift,theone
containingtheubiquitousitemwillbefilteredout.Considertworules:
{ kernel A, server type B} => failure Y with lift 5
{ kernel A, server type B, datacenter C} => failure Y with lift 1.5
Proc.ACMMeas.Anal.Comput.Syst.,Vol.4,No.2,Article31.Publicationdate:June2020.
FastDimensionalAnalysisforRootCauseInvestigation 31:11
Itislikelythatdescribingtheserverandkernelinteractionismoresignificantthanfilteringby
datacenter,thereforethesecondruleispruned,eventhoughtheliftvaluesfrombothrulesmeet
ourthresholdontheminimumlift.
Filter2:Anitem-setT isdroppedifthereexistsapropersupersetS,(S ⊃T)suchthatsupp(S)∗
H ≥supp(T)andlift(S)>lift(T)∗H ,whereH ≥ 1andH ≥ 1
supp lift supp lift
Ifarulehasasupersetwhichdescribesasimilarnumberofsamples,i.e.similarsupport,and
thesuperset’sliftishigher,therulewillbedroppedasthesupersetisamorepowerfulrulethat
describesmostorallofthesamples.Similarly,H isappliedtoloosenthecomparisoncriteria
supp
forsupport,andH isappliedtoensurethattheliftdifferenceissufficientlylargebasedonthe
lift
usecase.Forexample,considertworules:
{ datacenter A} => failure Y with support 0.8 and lift 2
{ datacenter A, cluster B, rack C} => failure Y with support 0.78
and lift 6
Inthisscenario,almostallofthesamplesindatacenterAarealsoinclusterBandrackC.When
tryingtounderstandtherootcauseofthefailures,thelongeritem-setwithahigherliftanda
similarsupportismoreinformative,sowekeepitandremovetheshorteritem-set.
Insummary,weprefertokeepshorteritem-setswhentheliftvaluesaresimilar.Whenalonger
item-set’sliftvalueissignificantlyhigherthanthatofasubset,andthesupportvaluesaresimilar,
wekeepthelongeritem-set.
3.7 TheProposedFramework
Ourfinalimplementationincorporatingtheabove-mentionedimprovementsisillustratedinFigure1.
UtilizingScuba’sscalable,in-memoryinfrastructure[1],wequerydatathatisaggregatedbythe
group-byoperationbasedonthedistinctvaluecombinationsinasetofcolumns.Theaggregation
isdoneexcludingcolumnsthattheusersspecifyasnotuseful,andcolumnsthatourcheckfindsto
havetoomanydistinctvaluestosatisfyapracticalminimumsupportthreshold.One-hotencoding
isthenappliedtothequerieddataforconvertingthecolumn-valuepairstoBooleancolumns,or
items.WeapplyfrequentpatternminingtechniquessuchasAprioriandFP-Growthonthedataset
toidentifyfrequentitem-sets,whicharethenfilteredbyliftbecauseinRCAweareonlyinterested
initem-setsthatareusefulinseparatingthetargetlabels,e.g.specificfailurestates,fromtherest
ofthelabelvalues,e.g.successfulsoftwaretaskstates.FinallythefilteringcriteriainSection3.6
areappliedtofurthercondensethereportforbetterinterpretability.
Inourframeworkwechoosetofiltertheassociationrulesbyliftandsupportaftertherulesare
minedwithFP-Growth,insteadofpruningtheassociationrulesduringthetreeconstructionas
theSTUCCOalgorithmdoesinacontrastsetminingproblem[4,5,11].Thishelpsusfindmore
granularitem-setswithhighliftthatwouldotherwisebemissed.Forexample,ifassociationrule
{A,B} ⇒Y hasahighlift(orthe χ2 statisticasinSTUCCO),butboth {A} ⇒Y and {B} ⇒Y
havelift(or χ2 statistic)valuesbelowthepruningthreshold,{A,B} ⇒Y wouldnotbefoundif
weprunethetreebasedonbothsupportandlift(or χ2 statistic)asSTUCCOdoes.InSTUCCO,
everynodeneedstobesignificant basedonchi-squaretestsandlargebasedonsupportforitto
havechildnodes[5].Ontheotherhand,asFP-Growthminesfrequentitem-setsonlybasedon
support,aslongas{A} ⇒Y,{B} ⇒Y,and{A,B} ⇒Y haveenoughsupport,theywouldallbe
reportedasfrequentitem-sets.Then {A} ⇒Y and {B} ⇒Y willbefilteredoutduetolowlift
while{A,B} ⇒Y willbereportedinthefinalresult.
Proc.ACMMeas.Anal.Comput.Syst.,Vol.4,No.2,Article31.Publicationdate:June2020.
31:12 Lin,etal.
User-Specified Filters
Variability-Based Filters
Query and Dedup (Scuba)
One-Hot Encoding
Frequent Pattern Mining (Apriori / FP-Growth)
Initial Pattern Filtering Using Lift
Further Filtering for Interpretability
Fig.1. TheproposedframeworkfortheFastDimensionalAnalysis.
4 EXPERIMENTALRESULTS
Inthissectionwepresenttheoptimizationresultforruntimeandinterpretability,basedontheir
relationshipswiththemin-supportandmax-lengthparametersduringitem-setmining,aswellas
themin-liftduringitem-setfiltering.Weexperimentedontwoproductiondatasets:
• AnomalousServerEvents
Thisisadatasetaboutanomalousbehaviors(e.g.rebootedserversnotcomingbackonline)
onsomehardwareandsoftwareconfigurations(moredetailscanbefoundinSection5.1).
Wecompiledthedatasetwithmillionsofevents,eachdescribedby20features.Thefeatures
expandtoabout1500distinctitemsafterone-hotencoding,withtensofthousandsofdistinct
validitem-sets.Approximately10%ofthedataarepositivesamples,i.e.anomalousbehaviors.
ForsimplicitywerefertothisdatasetasASEintherestofthepaper.
• ServiceRequests
Thisisadatasetthatlogstherequestsbetweenservicesinalarge-scalesystem.Eachrequest
isloggedwithinformationsuchasthesourceanddestination,allocatedresource,service
specifications,andauthentication(moredetailscanbefoundinSection5.2).Forexperimenta-
tion,wecompiledadatasetthatcontainsmillionsofrequests,eachdescribedby50features.
Thefeaturesexpandtoabout500distinctitemsafterone-hotencoding,with7000distinct
validitem-sets.Approximately0.5%ofthedataarepositivesamples.Forsimplicitywerefer
tothisdatasetasSRintherestofthepaper.
Asthedatasetsaredifferentbyanorderofmagnitudeintermsoftheproportionofpositive
samples,weexpectourrangeoflifttovaryconsiderably.Additionally,theASEdatasetcontains
almost5X thenumberofdistinctfeaturevaluesastheSRdatasetdoes,whichwouldaffectthe
countandlengthofitem-setsminedwithrespecttomin-support.Wedemonstratetheresultsbased
onthesetwodatasetswiththedifferentcharacteristicsbelow.
4.1 PerformanceImprovement
4.1.1 Data Pre-Aggregation. As described in Section 3.5, many events in production logs are
identical,exceptfortheuniqueidentifierssuchasjobIDs,timestamps,andhostnames.Thepre-
aggregationofthedatacouldeffectivelyreducethesizeoftheASEdatasetby200X andtheSR
Proc.ACMMeas.Anal.Comput.Syst.,Vol.4,No.2,Article31.Publicationdate:June2020.
FastDimensionalAnalysisforRootCauseInvestigation 31:13
datasetby500X,whichsignificantlyimprovesboththedatapreparationtimeandtheexecution
timeoftheFP-Growthalgorithm.
Table 2 shows the runtime needed for querying the data and grouping the entries with and
withoutthepre-aggregationusingScuba’sinfrastructure.Withoutthepre-aggregationstepin
Scuba,thedataisqueriedfromScubaandgroupedinmemorybeforeourframeworkconsumesit.
Withoutpre-aggregation,thelargeamountofdatathatistransferredhasasignificantperformance
impactonthequerytime.Overallthedatapreparationtimeisimprovedby10X and18X forthe
ASEandSRdatasets.
Table2. Datapreparationtimewithandwithoutpre-aggregationinScuba(inseconds)
Scubaquerytime Groupingtime Totaltime
(includingpre-agg.time) (inmemory)
ASE(withoutpre-agg.) 3.00 0.94 3.94
ASE(withpre-agg.) 0.39 - 0.39
SR(withoutpre-agg.) 3.35 0.71 4.06
SR(withpre-agg.) 0.22 - 0.22
Afterthedataisgrouped,weexecuteourmodifiedFP-Growthalgorithmwhichtakesthecount
ofsamplesperuniqueitem-set,asaweightforadditionalinput.Thedetailsofthemodificationis
discussedinSection3.5.Theadditionalweightvalueisusedincalculatingthesupportandliftof
anitem-set,andhasnegligibleoverheadonthealgorithm’sruntime.Effectively,thismeansthe
algorithmnowonlyneedtohandle200X and500X fewersamplesfromtheASEandSRdatasets.
Hence,thepre-aggregationofthedataiscriticalforenablingautomaticRCAatthisscaleinnear
real-time.Thisisoneofthemajorfeaturesofthispaper,asmostofthepriorworksmentionedin
Section2.3didnotincorporateanyoptimizationusingaproductiondatainfrastructure,andcould
nothandlelarge-scaledatasetsinnearreal-time.
4.1.2 OptimizingforNumberofItem-Sets. Item-setgenerationisthebiggestfactorinruntime
oftheproposedframework.Wefirstexaminetherelationshipbetweenthenumberofreported
frequentitem-setsandmin-supportandmax-lengthinFigure2.Notethattheverticalaxesarein
logscale.
InFigure2a,basedontheanomalousserverevent(ASE)dataset,weseeanexponentialdecrease
inthenumberofitem-setsasweincreasemin-support.Theoretically,thenumberofcandidate
item-setsisboundedby(cid:205)max−lenдth (cid:0)numberofitems(cid:1)
.Inpractice,however,thenumberofcandidates
k=1 k
ismuchlowerbecausemanyitemsaremutuallyexclusive,i.e.someitem-setswouldneverexistin
production.Thenumberofitem-setsbasedonthethreemax-lengthvaluesconvergetowithinan
orderofmagnitudewhenmin-supportisaround0.4,meaningagreaterproportionofitem-sets
withsupportgreaterthan0.4canbecoveredbyitem-setsatlength3.
Checkingtheconvergencepointhelpsusdecidethepropermax-length,givenadesiredmin-
support.Forexample,inausecasewherethegoalistoimmediatelyrootcauseamajorissuein
production,wewouldbeinterestedinitem-setswithhighersupports.IntheASEexample,ifour
desiredmin-supportisgreaterthantheconvergencepointinFigure2a,say0.95,weonlyneed
toruntheanalysiswithmax-lengthsetto3,toavoidunnecessarycomputationsforoptimized
performance.
Proc.ACMMeas.Anal.Comput.Syst.,Vol.4,No.2,Article31.Publicationdate:June2020.
31:14 Lin,etal.
Max-length 3 Max-length 4 Max-length 5
10000 stes-meti
)elacs-gol(
1000
fo
100 rebmuN
10
0.2 0.4 0.6 0.8 1
Min-support
(a)ASEdataset
Max-length 3 Max-length 4 Max-length 5