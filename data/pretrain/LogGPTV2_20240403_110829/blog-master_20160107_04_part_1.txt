## EXT4 vs XFS us iozone      
### 作者                                                                                         
digoal                                       
### 日期                                         
2016-01-07                                      
### 标签                                       
PostgreSQL , xfs , ext4 , 性能 , iozone                      
----                                      
## 背景                                     
之前使用PostgreSQL测试了xfs和ext4在tpc-b方面的性能，XFS完胜。  
接下来使用专业的io测试软件iozone测试一下。  
安装参考  
[《安装iozone on CentOS 7 x64》](../201511/20151130_02.md)  
测试case:  
2G文件，单个请求8K到16MB分布，测试所有的iozone case，全程使用O_DIRECT。  
```  
[root@digoal current]# ./iozone -Ra -I -+u -y 8k -q 16m -g 2G -n 2G -f /data01/test -b /data01/test.wks  
```  
详细的参数请参考iozone -h  
测试结果如下  
```  
./iozone -Ra -I -+u -y 8k -q 16m -g 2G -n 2G -f /data01/test -b /data01/test.wks  
```  
附图  
蓝色表示XFS胜出  
桔色表示EXT4胜出  
![pic](20160107_04_pic_001.png)  
![pic](20160107_04_pic_002.png)  
详细报告  
XFS  
```  
        Iozone: Performance Test of File I/O  
                Version $Revision: 3.434 $  
                Compiled for 64 bit mode.  
                Build: linux-AMD64   
        Contributors:William Norcott, Don Capps, Isom Crawford, Kirby Collins  
                     Al Slater, Scott Rhine, Mike Wisner, Ken Goss  
                     Steve Landherr, Brad Smith, Mark Kelly, Dr. Alain CYR,  
                     Randy Dunlap, Mark Montague, Dan Million, Gavin Brebner,  
                     Jean-Marc Zucconi, Jeff Blomberg, Benny Halevy, Dave Boone,  
                     Erik Habbinga, Kris Strecker, Walter Wong, Joshua Root,  
                     Fabrice Bacchella, Zhenghua Xue, Qin Li, Darren Sawyer,  
                     Vangel Bojaxhi, Ben England, Vikentsi Lapa,  
                     Alexey Skidanov.  
        Run began: Thu Jan  7 17:59:58 2016  
        Excel chart generation enabled  
        Auto Mode  
        O_DIRECT feature enabled  
        CPU utilization Resolution = 0.001 seconds.  
        CPU utilization Excel chart enabled  
        Using Minimum Record Size 8 kB  
        Using Maximum Record Size 16384 kB  
        Using maximum file size of 2097152 kilobytes.  
        Using minimum file size of 2097152 kilobytes.  
        Command line used: ./iozone -Ra -I -+u -y 8k -q 16m -g 2G -n 2G -f /data01/test -b /data01/test.wks  
        Output is in kBytes/sec  
        Time Resolution = 0.000001 seconds.  
        Processor cache size set to 1024 kBytes.  
        Processor cache line size set to 32 bytes.  
        File stride size set to 17 * record size.  
                                                              random    random     bkwd    record    stride                                      
              kB  reclen    write  rewrite    read    reread    read     write     read   rewrite      read   fwrite frewrite    fread  freread  
         2097152       8   302780   377134    66085    66086    65899   378147    65958    424867     66352  1407308  1959254  4947523  4982930  
         2097152      16   378066   522817   118667   115340   116747   555536   121143    696183    117449  1455236  2018312  5378334  5432910  
         2097152      32   625998   935764   145075   145643   143402   933884   152171    919700    155973  1619490  2152179  5800401  5886013  
         2097152      64   983484   996429   208602   209404   210336  1040297   194347   1056566    199639  1541149  2215495  6074457  6058925  
         2097152     128  1412045  1679360   226034   222070   225817  1266871   233858   1489087    239126  1584144  2157921  5986816  5980584  
         2097152     256  1328638  1209635   295854   295790   295640  1240760   304604   1542956    315133  1602108  2166535  5593419  5606007  
         2097152     512  1410465  1251243   489365   477461   477315  1557249   516092   1362570    530192  1582109  2154786  5519488  5612986  
         2097152    1024  1281738  1259321   729780   729545   729038  1402951   747338   1370643    852760  1513685  1862678  5563032  5669741  
         2097152    2048  1279582  1179331   946818   945858   946072  1439000   967089   1204443    993627  1338416  1699702  5613781  5716504  
         2097152    4096  1177561  1163739  1137381  1136753  1134887  1172911  1134894   1158890   1155744  1362270  1713459  5821962  5841289  
         2097152    8192  1467529  1141385  1208999  1209200  1207000  1130459  1234770   1147701   1265787  1263009  1539101  5682246  5723743  
         2097152   16384  1328546  1136956  1296081  1290361  1289615  1134010  1319002   1139023   1342644  1194928  1448339  3271897  3275725  
iozone test complete.  
Excel output is below:  
"Writer report"  
        "8"  "16"  "32"  "64"  "128"  "256"  "512"  "1024"  "2048"  "4096"  "8192"  "16384"  
"2097152"   302780  378066  625998  983484  1412045  1328638  1410465  1281738  1279582  1177561  1467529  1328546   
"Re-writer report"  
        "8"  "16"  "32"  "64"  "128"  "256"  "512"  "1024"  "2048"  "4096"  "8192"  "16384"  
"2097152"   377134  522817  935764  996429  1679360  1209635  1251243  1259321  1179331  1163739  1141385  1136956   
"Reader report"  
        "8"  "16"  "32"  "64"  "128"  "256"  "512"  "1024"  "2048"  "4096"  "8192"  "16384"  
"2097152"   66085  118667  145075  208602  226034  295854  489365  729780  946818  1137381  1208999  1296081   
"Re-Reader report"  
        "8"  "16"  "32"  "64"  "128"  "256"  "512"  "1024"  "2048"  "4096"  "8192"  "16384"  
"2097152"   66086  115340  145643  209404  222070  295790  477461  729545  945858  1136753  1209200  1290361   
"Random read report"  
        "8"  "16"  "32"  "64"  "128"  "256"  "512"  "1024"  "2048"  "4096"  "8192"  "16384"  
"2097152"   65899  116747  143402  210336  225817  295640  477315  729038  946072  1134887  1207000  1289615   
"Random write report"  
        "8"  "16"  "32"  "64"  "128"  "256"  "512"  "1024"  "2048"  "4096"  "8192"  "16384"  
"2097152"   378147  555536  933884  1040297  1266871  1240760  1557249  1402951  1439000  1172911  1130459  1134010   
"Backward read report"  
        "8"  "16"  "32"  "64"  "128"  "256"  "512"  "1024"  "2048"  "4096"  "8192"  "16384"  
"2097152"   65958  121143  152171  194347  233858  304604  516092  747338  967089  1134894  1234770  1319002   
"Record rewrite report"  
        "8"  "16"  "32"  "64"  "128"  "256"  "512"  "1024"  "2048"  "4096"  "8192"  "16384"  
"2097152"   424867  696183  919700  1056566  1489087  1542956  1362570  1370643  1204443  1158890  1147701  1139023   
"Stride read report"  
        "8"  "16"  "32"  "64"  "128"  "256"  "512"  "1024"  "2048"  "4096"  "8192"  "16384"  
"2097152"   66352  117449  155973  199639  239126  315133  530192  852760  993627  1155744  1265787  1342644   
"Fwrite report"  
        "8"  "16"  "32"  "64"  "128"  "256"  "512"  "1024"  "2048"  "4096"  "8192"  "16384"  
"2097152"   1407308  1455236  1619490  1541149  1584144  1602108  1582109  1513685  1338416  1362270  1263009  1194928   
"Re-Fwrite report"  
        "8"  "16"  "32"  "64"  "128"  "256"  "512"  "1024"  "2048"  "4096"  "8192"  "16384"  
"2097152"   1959254  2018312  2152179  2215495  2157921  2166535  2154786  1862678  1699702  1713459  1539101  1448339   
"Fread report"  
        "8"  "16"  "32"  "64"  "128"  "256"  "512"  "1024"  "2048"  "4096"  "8192"  "16384"  
"2097152"   4947523  5378334  5800401  6074457  5986816  5593419  5519488  5563032  5613781  5821962  5682246  3271897   
"Re-Fread report"  
        "8"  "16"  "32"  "64"  "128"  "256"  "512"  "1024"  "2048"  "4096"  "8192"  "16384"  
"2097152"   4982930  5432910  5886013  6058925  5980584  5606007  5612986  5669741  5716504  5841289  5723743  3275725   