C
C
101
102
# Servers to which local client connects
(a)
10âˆ’2
Local Client
Local Server
Local Host
103
101
102
Num hosts
(b)
Fig. 1. (a) Scatterplot of 151 local hosts: Clients using the local host as a server and the local host
talking to servers as a client. (b) CCDF:local host communication for total 11 week period
to 2.6 TBytes worth of network traf(cid:2)c. We will characterize only the set of 151 local
hosts, but consider all their interactions, with both other local and internal hosts.
3.1 Community of Interest Set Size
First we evaluate the COI of the set of local hosts in our data set based on the broadest
de(cid:2)nition of COI. Speci(cid:2)cally we consider the number of other hosts that each local
host interact with. We look at the total number of such hosts and then do a breakdown
based on whether the target local host was acting as a client or a server.
We (cid:2)rst perform this analysis for all hosts over the entire measurement period. Fig-
ure 1(a) shows a scatter plot of the in/out-degree of the set of 151 local hosts considering
all observed traf(cid:2)c. The Y-axis shows the number of clients connecting to the local host
acting as a server (i.e., in-degree). The X-axis shows the number of servers that the lo-
cal host connects to acting as a client (i.e., out-degree). Observe from Figure 1(a) that
most hosts act as both client and server over the observation period. Indeed for the total
traf(cid:2)c breakdown shown, all hosts act as both client and server during the measurement
period. The general observation that most hosts act as both client and server, hold when
data is analyzed on a per-protocol basis. Speci(cid:2)cally, counting the number of hosts that
acted purely as clients on a per protocol basis we get only 3 for TCP, 2 for UDP and
1 for ICMP. Similarly, counting the number of hosts acting purely as servers on a per
protocol basis we get none for TCP, 2 for UDP and 5 for ICMP. Further, as indicated
by the density below the diagonal line, the majority of local hosts are mostly acting as
clients. For the plot shown, 111 hosts are below and 35 hosts above the diagonal line.
The implication of the simple observation that most hosts act as both clients and servers,
is that security schemes that rely on hosts acting exclusively as clients or servers, are
likely to be infeasible in current enterprise networks.
Figure 1(b) shows the empirical Complementary Cumulative Distribution Function
(CCDF) of the number of machines that our local hosts communicate with for all traf(cid:2)c
over the entire 11 week measurement period. The (cid:147)Local Host(cid:148) curve corresponds to
the total number of hosts (either local or internal) that a particular local host interacts
W. Aiello et al.
90
100
10âˆ’1
F
D
C
C
100
10âˆ’1
F
D
C
C
10âˆ’2
Local Client
Local Server
Local Host
101
102
Max Daily Num. hosts
(a) Maximum
10âˆ’2
Local Client
Local Server
Local Host
10âˆ’1
Num hosts (Norm. Std. Dev.)
100
(b) Normalized standard-deviation
Fig. 2. CCDFs for the number of hosts communicated with on daily basis
with, whether as a client or as a server. The plot shows that each of the local hosts com-
municates with a fairly small community of other hosts even over a period of several
weeks. For example, 90% of the local hosts talks to fewer than 186 other hosts. Consid-
ering the client/server breakdown, the same holds true with local hosts interacting with
a fairly small number of servers and clients. The (cid:2)nal 10% of the (cid:147)Local Server(cid:148) curve
shows that a small number of local machines acting as servers have higher numbers of
clients talking to them than the other 90% of the local servers. These machines most
likely correspond to (cid:147)real(cid:148) servers that serve a signi(cid:2)cant client population as opposed
to hosts that are servers on the basis of the protocol interaction only.
We next look at the COI of each host on a daily basis and examine the statistical
properties of these daily values over the complete observation period. First, Figure 2(a)
shows the CCDF of the maximum daily number of hosts that each local host commu-
nicates with over the entire eleven weeks. These maximum number per day CCDFs are
similar to those for the maximum over the entire measurement period, Figure 1(b), but
the numbers are lower (i.e., the curves are (cid:147)shifted(cid:148) to the left). For example, the 90th
percentile number for the (cid:147)Local Host(cid:148) curve in Figure 2(a) is only 77 compared with
186 for the same percentile in Figure 1(b). Also similar to Figure 1(b), there is an in(cid:3)ec-
tion at the 10% point in Figure 2(a) for the (cid:147)Local Server(cid:148) (and (cid:147)Local Host(cid:148)) curves
which is likely caused by (cid:147)real(cid:148) servers.
The relatively small sizes of the total number of hosts communicated with over the
entire period as well as the small per-day maximums for the vast majority of hosts,
suggest that a simple anomaly detection approach based on monitoring the normal COI
size, has the potential to detect abnormal activities like port scans and worm spreads.
These anomalies are often marked by a host communicating with a large number of
other machines within a very short time span.
Next we consider the variability of the per-day COI size for each local host over
the entire measurement period. Figure 2(b) shows the resulting CCDF of the normal-
ized standard deviation (normalized by the mean for each local host). Note that some
of the variability is a result of hosts being inactive on some days, one contributing rea-
son being telecommuting users. Hosts for these users might either be inactive because
Analysis of Communities of Interest in Data Networks
91
they are not being used, or in the case of notebooks, might not be visible to our moni-
toring infrastructure. The graph shows that approximately 70% of the local hosts have
normalized standard-deviations in their per-day COI size that is less than
. Assuming
that all of the traf(cid:2)c in our data set was indeed legitimate, this would mean a simplistic
approach to detect abnormal behavior for these hosts, based on a policy that restricts
(cid:147)normal(cid:148) per-day COI size to
times the respective per-day means, would result in
false alarms being generated only 5% of the time. Note also from Figure 2(b) that the
standard deviation for the (cid:147)Local Client(cid:148) curve is less skewed than the (cid:147)Local Server(cid:148)
curve. This suggests that on a daily basis the number of servers which a local client
talks to, is more stable than the number of clients that talk to a local server. The impli-
cation of this is that network management policies derived from observations close to
the initiator of communication (client) is likely to be more stable than policies derived
from traf(cid:2)c close to the communication responder (server).
3.2 Core Communities of Interests
We next explore our two example core COI de(cid:2)nitions Popularity and Frequency core
COIs and their interactions.
300
250
200
150
100
50
t
e
s
n
i
s
r
e
v
r
e
S
#
0
100
week 1
week 4
week 7
week 11
101
# Threshold (%)
102
Fig. 3. Size of Popularity COI set for all traf(cid:2)c
over some period of interest
Popularity COI: Recall that for the Popularity COI we consider a host to be part of
the COI for a group of target-hosts if the percentage of target-hosts interacting with it
exceeds a threshold
. Here we identify the Popularity
weeks in our data
COI of the local hosts from a client view point, for each of the
is one week). Figure 3 shows the size of the Popularity core COI set as a
set (i.e.,
weeks, for
function of the threshold
traf(cid:2)c across all protocols. The graphs shows the expected decline of the set size as one
progresses from a threshold of 0% (which would include all hosts) to a threshold of
100% at which point the size is expected to be very small as it would require all target-
hosts to communicate with each member of the set. We observe that the size of the core
COI set as a function of the threshold is very similar across the different weeks. This
equally spaced weeks out of the total
for





92
W. Aiello et al.
700
600
500
400
300
200
100
t
e
s
n
i
s
r
e
v
r
e
S
.
m
u
N
0
100
Union(T=5%)
Union(T=10%)
Union(T=20%)
Union(T=30%)
Intersection(T=5%)
Intersection(T=10%)
Intersection(T=20%)
Intersection(T=30%)
Union(11 weeks)
Union(6 weeks)
Union(3 weeks)
week 1
Intersection(3 weeks)
Intersection(6 weeks)
Intersection(11 weeks)
250
200
150
100
50
t
e
s
n
i
s
r
e
v
r
e
S
.
m
u
N
101
Threshold (%)
(a)
102
0
1
2
3
4
7
5
Time period (weeks)
6
8
9
10
11
(b)
Fig. 4. Popularity COI: Union and intersection set size (a) As a function of threshold
function of length of time window
weeks (
)
(b) As a
 !
suggests that, deviations from the Popularity COI size distribution, for a set of hosts
monitored over time, would be a strong indication of a network anomaly.
While the stability in the core COI set size is encouraging, we are also interested
in the stability and predictability of the core COI set membership. To evaluate this, we
determine the core COI set for each week in our data and then explore how the mem-
bership of these sets change over the measurement period. We do this by calculating
the union (the set of servers that belong to the core set in at least one week) and the
intersection (the set of servers that belong to the core set in every week) of the COI sets.
For any two sets the difference between the size of the union and intersection represents
a measure of the (cid:147)churn(cid:148) between the two sets - that is the total number of elements that
needs to be added or removed from one set to transform it to the other set. Therefore,
COI sets, the difference between the union and intersection of all the
for a window of
. By looking
sets, represents an upper bound on the churn between any two pairs in
at this bound we get a worst case estimate of how much the COI membership changes
over the time window (
). By progressively increasing the length of the time window,
we determine how this worst case estimate changes over time.
Figure 4(a) depicts the sizes of the union and intersection of core COI sets for weeks
for all traf(cid:2)c. For comparison
1 to 3, 1 to 6 and 1 to 11, as a function of the threshold
the core COI set size for week 1 is also shown. For all curves (i.e., for all time periods
considered), the difference between the union and intersection set sizes, i.e., the churn,
tends to decrease as the threshold increases. Figure 4(b) shows the same data, but in this
case we show the union and intersection set sizes for selected thresholds for increasing
time windows
, i.e., 1 to 2 weeks,
1 to 3 weeks, etc. As expected, the union set size size increases and the intersection
set size decreases for a given threshold as the time window increases. Notice though
from Figure 4(b) that for any threshold, the union and intersection set sizes change in a
sub-linear fashion with increasing
. In fact the intersection seems to (cid:3)atten within 6 to
8 weeks. While the union set size shows a continued small growth, the maximum union
set size, for the thresholds considered, did not increase beyond a factor of 2.5 over the
weeks), starting from week
of interest (
#
to


"
"
"
"


"
Analysis of Communities of Interest in Data Networks
93
700
600
500
e
z
S
i
t
e
S
400
300
200
100
0
0
Union Size(11 weeks)
Union Size(6 weeks)
Union Size(3 weeks)
Set Size (week 1)
Intersection Size (3 weeks)
Intersection Size (6 weeks)
Intersection Size (11 weeks)
10
20
30
40
Bin Size (Hours)
50