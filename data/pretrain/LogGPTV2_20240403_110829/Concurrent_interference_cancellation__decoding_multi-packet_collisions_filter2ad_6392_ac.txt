CICâ€™s performance is adversely affected by loss of spectral reso-
lution as dictated by Hiesenbergâ€™s Time-Frequency uncertainty
principle.
5.1 Time-Frequency Uncertainty
Heisenbergâ€™s time-frequency uncertainty principle states that es-
timating frequencies over signals with short time-spans result in
poor frequency resolution. Specifically, estimating the frequency
spectrum using a sub-symbol with a smaller time-span ğ‘‡ğ‘ 
ğ¾ , will re-
duce the spectral resolution to ğµ
ğ¾ (ğµ is the bandwidth of the signal
and ğ¾ is a constant), making it difficult to distinguish between two
symbols whose frequencies are less than ğµ
ğ¾ apart.
Fig 15: Heisenbergâ€™s Principle
This is illustrated in Figure 15, which shows the spectrum esti-
mated for a signal with 5 interfering symbols using progressively
smaller sized time-spans ğœ. As seen in Figure 15, when ğœ is large
(ğ‘‡ğ‘ /2), all the five peaks corresponding to the five symbols are
distinct. However, as ğœ decreases, the frequency resolution of the
spectrum decreases and the peaks merge into a single peak at ğœ = ğ‘‡ğ‘ 
8 .
This loss of resolution adversely effects CIC, as the peaks in spectral
estimates merge into one another when using sub-symbols with a
short time-span.
5.2 Spectral Intersection
CIC attempts to find the common frequency across all sub-symbols
in an ICSS, each estimated with a different frequency resolution
since their time-spans may be different. The process of extracting
frequencies in spectra is achieved by detecting peaks in the spectra;
it requires careful choice of thresholds to reject false peaks arising
out of noise, without missing the right ones, and can be error
prone. Finding constituent frequency peaks separately for each of
the spectra in an ICSS and then set intersection results in errors
incurred at each step to accumulate, leading to poor cancellation.
Rather than extract peaks for each of the spectra separately, CIC
first computes a Spectral Intersection by computing the minimum
energy across all the spectra at each frequency. Spectral intersection
is illustrated for Strawman-CIC in Figure 11, where, after taking the
minimum energy in the spectra of Î¦1 and Î¦2 at each frequency, only
peaks that are located at common frequencies ğ‘“ ğ‘ and ğ‘“ ğ‘ remain.
Now peak detection needs to be performed only once to extract the
common frequencies, making the process less error prone. Note
that, prior to computing the intersection, all estimated spectra must
be normalized to have unit energy to eliminate scaling effects due
507
SIGCOMM â€™21, August 23â€“28, 2021, Virtual Event, USA
M. Osama, M. Phillipose, K. Chintalapudi, S. Banerjee, B. Krishnaswamy
Fig 12: Collision
Fig 13: Effect of loss of resolution in Straw-
man CIC
Fig 14: Interference Cancellation in CIC
to different sized windows. In this paper, we shall use Î¦1 âˆ© Î¦2 to
denote the spectral intersection operation using minimum.
Properties of Spectral Intersection. Spectral intersection has
some key properties that CIC exploits in its design.
â€¢ P1 : it is commutative and associative, as inherited from the
â€¢ P2 : when two spectra have different frequency resolutions, the
operation preserves the higher resolution at each constituent
frequency.
Minimum operation.
The illustration in Figure 11 provides an intuition into property P2.
In Figure 11, Î¦1 has a lower resolution estimate on frequency ğ‘“ ğ‘
but a higher resolution estimate for ğ‘“ ğ‘ while the vice-versa is true
for Î¦2. Computing the spectral intersection takes the minimum at
each frequency and hence preserves the best resolution for both
frequencies.
5.3 Effect of Poor Frequency Resolution on
Strawman-CIC
ğ‘
In order to motivate our design of CIC we start by showing how
time-frequency uncertainty adversely effects Strawman-CIC. The
time-spans of ğ‘Ÿ1â†’2(ğ‘¡) and ğ‘Ÿğ‘â†’ğ‘+1(ğ‘¡) are ğœ1 and ğ‘‡ğ‘  âˆ’ ğœğ‘ respec-
tively. Assuming that the symbol start times of all colliding trans-
missions are uniformly distributed in the interval (0,ğ‘‡ğ‘ ), the ex-
pected values of ğœ1 and ğ‘‡ğ‘  âˆ’ ğœğ‘ are both ğ‘‡ğ‘ 
3. Consequently, the
corresponding spectral estimates have a frequency resolution of
ğµ
ğ‘ , making it hard to separate two constituent frequencies that are
within this resolution. Figure 10 illustrates the effect of this lower
frequency resolution estimates on CIC, where energy from each
frequency spills over in its neighborhood. Instead of a clean sharp
peak as illustrated in Figure 9, the resulting spectrum comprises
multiple wide interfering peaks in Figure 10, rendering cancellation
ineffective.
5.4 Design of CIC
CIC aims to pick an ICSS that best preserves the frequency resolu-
tion for each of the constituent frequencies. This choice not only
preserves the maximum resolution for ğ‘“ 1, making it easy to extract
its peak, but also aids in sharply canceling the other interfering
peaks.
3The expectation of the minimum of ğ‘ uniform random variables
508
Fig 16: Canceling a single interferer in CIC
ğ‘‡ğ‘ 
ğ‘ğ‘Ÿğ‘’ğ‘£ and ğ‘“ ğ‘–
How to cancel a specific interfering transmission at the best
possible resolution. An interfering frequency ğ‘“ ğ‘–
ğ‘ğ‘Ÿğ‘’ğ‘£ is present
throughout the section ğ‘Ÿ1â†’ğ‘–(ğ‘¡) - a time-span of ğœğ‘–. Thus, the maxi-
mum achievable frequency resolution for ğ‘“ ğ‘–
ğ‘ğ‘Ÿğ‘’ğ‘£ can be obtained in
the spectrum estimate Î¦(ğ‘Ÿ1â†’ğ‘–(ğ‘¡)) is given by ğµ ğœğ‘–
ğ‘‡ğ‘  . Similarly, the
best frequency resolution for ğ‘“ ğ‘–
ğ‘›ğ‘’ğ‘¥ğ‘¡ is achieved from the spectrum
estimate Î¦(ğ‘Ÿğ‘–â†’ğ‘+1(ğ‘¡)) is given by ğµ ğ‘‡ğ‘ âˆ’ğœğ‘–
. As depicted in Figure 16,
ğ¹(ğ‘Ÿ1â†’ğ‘–(ğ‘¡)) does not have ğ‘“ ğ‘–
ğ‘›ğ‘’ğ‘¥ğ‘¡ since the transmission only switches
ğ‘›ğ‘’ğ‘¥ğ‘¡ for ğ‘¡ > ğœğ‘–. Similarly, ğ¹(ğ‘Ÿğ‘–â†’ğ‘+1(ğ‘¡)) does not have ğ‘“ ğ‘–
to ğ‘“ ğ‘–
ğ‘ğ‘Ÿğ‘’ğ‘£ since
the the transmission has already switched to ğ‘“ ğ‘–
ğ‘›ğ‘’ğ‘¥ğ‘¡ at ğ‘¡ = ğœğ‘–. Thus,
ğ¹(ğ‘Ÿ1â†’ğ‘–(ğ‘¡)) âˆ© ğ¹(ğ‘Ÿğ‘–â†’ğ‘+1(ğ‘¡)) will not have the frequencies ğ‘“ ğ‘–
ğ‘ğ‘Ÿğ‘’ğ‘£ and
ğ‘›ğ‘’ğ‘¥ğ‘¡. Further, Î¦(ğ‘Ÿ1â†’ğ‘–(ğ‘¡)) and Î¦(ğ‘Ÿğ‘–â†’ğ‘ (ğ‘¡)) will also have the high-
ğ‘“ ğ‘–
est possible frequency resolutions for ğ‘“ ğ‘–
ğ‘›ğ‘’ğ‘¥ğ‘¡, following
property P2 of spectral intersection, Î¦(ğ‘Ÿ1â†’ğ‘–(ğ‘¡)) âˆ© Î¦(ğ‘Ÿğ‘–â†’ğ‘+1(ğ‘¡))
will remove ğ‘“ ğ‘–
ğ‘›ğ‘’ğ‘¥ğ‘¡ at their respective maximum possible
frequency resolutions.
The Optimal Choice for ICSS. CIC constructs ICSS with 2ğ‘ âˆ’ 1
sub-symbols, comprising all pairs ğ‘Ÿ1â†’ğ‘–(ğ‘¡), ğ‘Ÿğ‘–â†’ğ‘+1(ğ‘¡) for 2 â‰¤ ğ‘– â‰¤ ğ‘
and finally ğ‘Ÿ(ğ‘¡) itself. Each pair, ğ‘Ÿ1â†’ğ‘–(ğ‘¡), ğ‘Ÿğ‘–â†’ğ‘+1(ğ‘¡) cancels the ğ‘–ğ‘¡â„
transmission at their corresponding highest possible frequency
resolutions. Following properties P1 and P2 of spectral intersection,
computing a spectral intersection over the ICSS will cancel all
frequencies at their highest possible frequency resolutions. Finally,
the inclusion of ğ‘Ÿ(ğ‘¡) ensures that ğ‘“ 1 is recovered at the highest
possible resolution. Thus, CIC computes the spectral intersection
ğ‘ğ‘Ÿğ‘’ğ‘£ and ğ‘“ ğ‘–
CIC : Decoding Multi-Packet Collisions in LoRa
SIGCOMM â€™21, August 23â€“28, 2021, Virtual Event, USA
This shows that even after CIC, one or more peaks may only be
partially cancelled and in case of a strong interfering transmission,
they may be hard to discard.
5.6 Spectral Edge Difference (SED)
CIC may only be able to cancel certain symbols partially when Î”ğœ
and Î”ğ‘“ are small. This can be seen in Figure 14, where while the
peak corresponding to ğ‘“ 1 is the significant highest peak, some of
the interfering peaks with high transmit powers (indicated by red
circles) remain. In such a case, CIC has more than one potential
candidate and CIC must pick one among them. For this, CIC com-
putes the Spectral Edge Difference (SED), the absolute difference
in energies of the candidate frequency spectra between left and
right halves of ğ‘Ÿ(ğ‘¡), for each candidate frequency. It then picks the
frequency with the least value of SED. The key intuition behind
computing SED is that, SED will be zero only for ğ‘“ 1 since unlike in-
terfering symbols, this frequency exists uniformly across the entire
symbol.
2 âˆ’ğœğ‘–
ğ‘‡ğ‘ 
1 âˆ’ ğœğ‘–
ğ‘‡ğ‘ 
(cid:18) ğ‘‡ğ‘ 
ğ‘›ğ‘’ğ‘¥ğ‘¡) = ğ¸ğ‘–
We illustrate the intuition into SED in Figure 18 for the symbol
ğ¶ğ‘–
ğ‘›ğ‘’ğ‘¥ğ‘¡. Let ğ¸ğ‘– be the total energy per symbol in the ğ‘–ğ‘¡â„ packet (based
on the received signal strength). ğ‘Ÿğ‘™â„(ğ‘¡) and ğ‘Ÿğ‘Ÿâ„(ğ‘¡) represent the
left and right halves of ğ‘Ÿ(ğ‘¡). Since the total duration that ğ¶ğ‘–
ğ‘›ğ‘’ğ‘¥ğ‘¡ is
2 âˆ’ ğœğ‘–, the energy of the peak corresponding to
present in ğ‘Ÿğ‘™â„(ğ‘¡) is ğ‘‡ğ‘ 
ğ‘›ğ‘’ğ‘¥ğ‘¡ denoted by ğœ†ğ‘™â„(ğ‘“ ğ‘–
ğ‘“ ğ‘–
ğ‘›ğ‘’ğ‘¥ğ‘¡ is
continuously present in the entire right half ğ‘Ÿğ‘Ÿâ„(ğ‘¡), consequently,
the energy of the peak in this half, ğœ†ğ‘Ÿâ„(ğ‘“ ğ‘–
2 . The SED
ğ‘›ğ‘’ğ‘¥ğ‘¡) for this frequency is given by |ğœ†ğ‘Ÿâ„(ğ‘“ ğ‘–
Î›(ğ‘“ ğ‘–
ğ‘›ğ‘’ğ‘¥ğ‘¡)|=
ğ‘‡ğ‘  . Since, ğ‘“ 1 is present in both halves completely, ğœ†ğ‘Ÿâ„(ğ‘“ 1) =
1
ğœğ‘–
2 ğ¸ğ‘–
2 ğ¸1 and Î›(ğ‘“ 1) = 0. SED exploits this difference and
ğœ†ğ‘™â„(ğ‘“ 1) = 1
picks the candidate with the least Î›(ğ‘“ ).
To make the SED estimate robust, instead of relying only on a
single pair (left and right), in practice, CIC uses multiple sliding
windows of span (ğ‘‡ğ‘ 
2 ) over the signal (10 in our implementation)
from the left and right ends of the symbol and computes their
spectral intersection.
2 ğ¸ğ‘–
ğ‘›ğ‘’ğ‘¥ğ‘¡) = ğ¸ğ‘–
ğ‘›ğ‘’ğ‘¥ğ‘¡) âˆ’ ğœ†ğ‘™â„(ğ‘“ ğ‘–
= 1
. ğ‘“ ğ‘–
(cid:19)
(cid:17)
(cid:16)
Î›(ğ‘“ ) = |ğœ†ğ‘Ÿâ„(ğ‘“ ) âˆ’ ğœ†ğ‘™â„(ğ‘“ )|
ğœ†ğ‘™â„(ğ‘“ ) =
ğ‘Ÿ(ğ‘¡).ğ‘Š
Î¦
(15)
(16)
(cid:18)
(cid:32)
ğ‘–=ğ‘›
ğ‘–=ğ‘›
ğ‘–=1
(cid:18) 2(ğ‘¡ âˆ’ ğ‘–ğœ–)
(cid:19)(cid:19)
(cid:32) 2(ğ‘¡ + ğ‘–ğœ– âˆ’ ğ‘‡ğ‘ 
ğ‘‡ğ‘ 
2 )
(cid:33)(cid:33)
ğ‘Ÿ(ğ‘¡).ğ‘Š
ğœ†ğ‘Ÿâ„(ğ‘“ ) =
Î¦
ğ‘‡ğ‘ 
ğ‘–=1
(17)
In Eqn 16 and 17, ğ‘Š (ğ‘¡) is the rectangular window function as
defined in Eqn 7.
5.7 Using Additional Features in CIC
Prior work has exploited the uniqueness of features such as CFO [14]
and received power [16] for each packet to group symbols. These
features can also be used to pick out the appropriate symbol in the
event of multiple candidates. We estimate CFO and RSSI from the
preambles (as described in Section 5.8) and use these as additional
features to filter out partially cancelled interfering symbols. In our
implementation, we use the technique in Choir [14] to estimate
the fractional CFO for each of the candidate symbols and eliminate
as,
Î¦ğ¶ğ¼ğ¶(ğ‘Ÿ(ğ‘¡)) =
(cid:34)ğ‘–=ğ‘
ğ‘–=1
Fig 17: Cancellation in CIC
(cid:35)
âˆ© Î¦(ğ‘Ÿ(ğ‘¡)) (12)
(Î¦(ğ‘Ÿ1â†’ğ‘–(ğ‘¡)) âˆ© Î¦(ğ‘Ÿğ‘–â†’ğ‘+1(ğ‘¡))
To provide an intuition into how CIC removes interfering sym-
bols, Figures 12, 13,and 14 depicts demodulation of 6 colliding trans-
missions (at SF=8) using COTS LoRa devices using Standard LoRa,
Strawman-CIC, and CIC respectively. Red circles indicate interfer-
ing transmissions while the green circle indicates the true peak.
In Figure 12, four interfering peaks have higher energy than the
true peak corresponding to the symbol being decoded. This oc-
curs because, the received powers of the interfering transmissions
can be stronger than the one being decoded. While Strawman-CIC
does eliminate some of interfering symbols, it suffers due to lack
of frequency resolution (Figure 13). However, CIC is able to ex-
tract the correct frequency while preserving the highest frequency
resolution.
5.5 Extent of CIC Cancellation
In this section we try and answer the question, â€œHow much can-
cellation can CIC offer and what factors does it depend on?â€ The