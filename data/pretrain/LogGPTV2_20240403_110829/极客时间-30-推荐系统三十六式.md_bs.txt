### 2. 离线模拟测试 {#33.html#2-}其次，就是在离线模拟测试。这是一种军事演习式的测试。模拟测试当然无法代替真实数据，但是也能暴露一些问题。通常做法是先收集业务数据，也就是根据业务场景特点，构造用户访问推荐接口的参数。这些参数要尽量还原当时场景，然后拿这些参数数据去实时访问推荐推荐，产生推荐结果日志，收集这些结果日志并计算评测指标，就是离线模拟测试。显然，离线模拟测试是失真的测试，并且评测指标也有限，因为并不能得到用户真实及时的反馈。但是仍然有参考意义。这些模拟得到的日志可以统称为曝光日志，它可以评测一些非效果类指标，例如推荐覆盖率，推荐失效率，推荐多样性等。关于这些指标具体含义，稍后再讲。那是不是离线模拟测试就对效果一无所知、无法模拟呢？也并不是，有一种办法是，利用历史真实日志构造用户访问参数，得到带评测接口的结果日志后，结合对应的真实反馈，可以定性评测效果对比。比如，可以评测推荐结果的 TopK 的准确率，或者排序效果AUC。这些模型效果类指标，虽然不能代表最终关注的商业指标，但是两者之间一般存在一定的相关性。通常来说 TopK 准确率高，或者 AUC 高于 0.5越多，对应的商业指标就会越好，这是一个基本假设。通过离线模拟评测每一天的模型效果指标，同时计算当天真实的商业指标，可以绘制出两者之间的散点图，从而回归出一个简单的模型，用离线模型效果预估上线后真实商业指标。
### 3. 在线对比测试 {#33.html#3-}第三种测试方法就是真正的实战了，那就是ABTest，即在线对比测试，分流量做真实的评测。这需要一个支持流量正交切分的ABTest 框架，在前面的文中已经讲到过。ABTest在样本充分的前提下，基本上可以定性新的推荐系统是否比老的推荐系统更加优秀。
### 4. 用户访谈 {#33.html#4-}最后一种测试方法就是用户访谈，或者说用户调查。前面三种测试方法，背后的思想是数据驱动。然而正如我在本文开篇时所说，数据测量的是系统外在表现，并不反映系统原理，而且数据指标是人设计的，是存在主观性和片面性的，人的认知广度和深度各有不同。因此，除了要紧紧团结在"数据驱动"这个核心思想周围，还需要深入用户，对用户做最直接的交流，对用户访谈，更重要的意义不是评测推荐系统，而是评测推荐系统的指标，设计是否合理，是否其高低反映了你预先的设定。除此之外，通过前面三种测试方法如果得知系统表现不好，那么结合直接真实的用户调查和访谈，可以为系统优化找到真实原因。这种方法类比一下就是：维修下水道时，你需要钻进下水道。
## 常用指标 {#33.html#-}推荐系统有很多指标。你之前如果阅读过一些介绍推荐系统指标的文献或书籍，想必会对繁多的指标望而却步，总之就是各种率。实际上所有指标就是在回答两个问题：系统有多好，还能好多久？这两个问题恰恰就是推荐系统里面一个老大难问题的反映：探索利用问题。系统有多好？这就是想问问：对数据利用得彻底吗？还能好多久？这个问题就是想问问：能探索出用户新的兴趣吗？这样就能继续开采利用了。也好比在职场中看一个人，除了看他现在的经验和解决问题能力有多强，还要看他学习能力有多强，毕竟世界是变化的，朝阳也会变成夕阳。下面我分别说说这两类指标有哪些。
### 1. 系统有多好？ {#33.html#1-}检测系统到底有多好，其实，也有两类，一类是深度类，一类是广度类。把数据看做是一座矿山，推荐系统是一个开采这座矿山的器械，"系统有多好"这个问题就是在关心开采得好不好，所以其实就看现有矿山上开采得深不深，开采得到不到位。广度类指标就是指在矿山上打满了钻井，而不仅仅盯着一处打钻井。深度类指标，就是看推荐系统在它的本职工作上做得如何。还记得推荐系统的本职工作是什么吗？就是预测用户和物品之间的连接，预测的方法又有评分预测和行为预测。因此深度类指标就指在检测系统在这两个工作上是否做得到位，有针对离线模型的指标，也有在线的指标，下面我分别说一说。1\. 评分准确度。通常就是均方根误差RMSE，或者其他误差类指标，反映预测评分效果的好坏。在讲协同过滤时已经详细说过这个指标。这里不再赘述。2\.排序。检测推荐系统排序能力非常重要，因为把用户偏爱的物品放在前面是推荐系统的天职。由于推荐系统输出结果是非常个人化的，除了用户本人，其他人都很难替他回答哪个好哪个不好，所以通常评价推荐系统排序效果很少采用搜索引擎排序指标，例如MAP，MRR，NDCG。搜索引擎评价搜索结果和查询相关性，具有很强的客观属性，可以他人代替评价。推荐系统评价排序通常采用AUC。也在前面介绍 BPR 模型时，专门讲到过。3\.分类准确率。这个指标也是针对行为预测的，而行为预测就是分类问题，所以评价准确度就很自然。在推荐系统中，评价准确度略微特殊，一般评价 TopK 准确率，与之对应还有TopK 召回率，这里的 K和实际推荐系统场景有关，就是实际每次推荐系统需要输出几个结果。TopK 准确度计算方式如下：如果日志中用户有 A、B两个物品有正反馈行为，推荐系统推出一个物品列表，长度为K，这个列表中就有可能包含 A、B两个物品中的一个或多个，下面这个表格就说明了 TopK 准确率和 TopK召回率的含义。![](Images/b8bef52acf6d81446628ceba42139e69.png){savepage-src="https://static001.geekbang.org/resource/image/14/5d/1432a007cb7484fea3f3c659f052455d.png"}这三个指标，比较直观地反映了推荐系统在"预测"这件事上对数据开采的深度，实际上由于模型不同，还可以有不同的指标，也可以自己设计指标，这里不再赘述。但这三个指标也属于比较初期的指标，距离最终商业指标还有一定的距离。通常检测推荐系统的商业指标有：点击率，转化率。其实把用户从打开你的应用或者网站开始，到最终完成一个消费，中间要经历数个步骤，也是大家常说的漏斗转化过程。推荐系统如果在其中某个环节起作用，那么就要衡量那个环节的转化率，这个相比前面三个指标，更加接近真实效果。除了比例类的商业指标，还要关注绝对量的商业指标，常见的有：社交关系数量，用户停留时长，GMV（成交金额），关注绝对数量，除了因为它才是真正商业目标，还有一个原因，是要看推荐系统是否和别的系统之间存在零和博弈情况。假如推荐系统导流效果提升，搜索引擎导流下降，从整个平台来看，因为整个平台的商业目标并没有那么成绩喜人，也需要警惕。讲完深度类指标，下面进入广度类指标。4\.覆盖率。这项指标就是看推荐系统在多少用户身上开采成功了，覆盖率又细分为UV 覆盖率和 PV 覆盖率。UV 覆盖率计算方法是。]{.MathJax_Preview style="color: inherit; display: none;"} {.MathJax_Display style="text-align: center;"}``{=html}[[C[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"}]{#33.html#MathJax-Span-3.mistyle="font-family: MathJax_Math-italic;"}[O]{#33.html#MathJax-Span-4.mistyle="font-family: MathJax_Math-italic;"}[V[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.191em;"}]{#33.html#MathJax-Span-6.mistyle="font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1000.75em, 4.144em, -999.998em); top: -3.998em; left: 0em;"}[u]{#33.html#MathJax-Span-9.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[v]{#33.html#MathJax-Span-10.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}]{#33.html#MathJax-Span-8.mrow}]{#33.html#MathJax-Span-7.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; top: -3.856em; left: 0.567em;"}]{style="display: inline-block; position: relative; width: 1.414em; height: 0px;"}]{#33.html#MathJax-Span-5.msubsup}[=]{#33.html#MathJax-Span-11 .mostyle="font-family: MathJax_Main; padding-left: 0.285em;"}[[[[N[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.096em;"}]{#33.html#MathJax-Span-14.mistyle="font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1000.9em, 4.144em, -999.998em); top: -3.998em; left: 0em;"}[l]{#33.html#MathJax-Span-17.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[\>]{#33.html#MathJax-Span-18.mostyle="font-size: 70.7%; font-family: MathJax_Main;"}[c]{#33.html#MathJax-Span-19.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}]{#33.html#MathJax-Span-16.mrow}]{#33.html#MathJax-Span-15.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; top: -3.856em; left: 0.802em;"}]{style="display: inline-block; position: relative; width: 1.932em; height: 0px;"}]{#33.html#MathJax-Span-13.msubsup}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1001.93em, 4.332em, -999.998em); top: -4.656em; left: 50%; margin-left: -0.986em;"}[[N[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.096em;"}]{#33.html#MathJax-Span-21.mistyle="font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1000.9em, 4.144em, -999.998em); top: -3.998em; left: 0em;"}[u]{#33.html#MathJax-Span-24.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[v]{#33.html#MathJax-Span-25.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}]{#33.html#MathJax-Span-23.mrow}]{#33.html#MathJax-Span-22.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; top: -3.856em; left: 0.802em;"}]{style="display: inline-block; position: relative; width: 1.649em; height: 0px;"}]{#33.html#MathJax-Span-20.msubsup}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1001.65em, 4.285em, -999.998em); top: -3.292em; left: 50%; margin-left: -0.798em;"}[[]{style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.073em; height: 0px;"}[]{style="display: inline-block; width: 0px; height: 1.085em;"}]{style="position: absolute; clip: rect(0.896em, 1002.07em, 1.226em, -999.998em); top: -1.315em; left: 0em;"}]{style="display: inline-block; position: relative; width: 2.073em; height: 0px; margin-right: 0.144em; margin-left: 0.144em;"}]{#33.html#MathJax-Span-12.mfrac style="padding-left: 0.285em;"}]{#33.html#MathJax-Span-2.mrow}[]{style="display: inline-block; width: 0px; height: 2.355em;"}]{style="position: absolute; clip: rect(0.849em, 1006.64em, 3.344em, -999.998em); top: -2.351em; left: 0em;"}]{style="display: inline-block; position: relative; width: 6.638em; height: 0px; font-size: 125%;"}[]{style="display: inline-block; overflow: hidden; vertical-align: -1.115em; border-left: 0px solid; width: 0px; height: 2.885em;"}]{#33.html#MathJax-Span-1.mathstyle="width: 8.332em; display: inline-block;"}``{=html}[$$COV_{uv} = \frac{N_{l > c}}{N_{uv}}$$]{.MJX_Assistive_MathML.MJX_Assistive_MathML_Blockrole="presentation"}]{#33.html#MathJax-Element-1-Frame .MathJaxtabindex="0" style="text-align: center; position: relative;"mathml="COVuv=Nl>cNuv"role="presentation"}$$$$解释一下，首先要定义有效推荐，就是推荐结果列表长度保证在 C个之上，独立访问的用户去重就是UV，有效推荐覆盖的独立去重用户数除以独立用户数就是 UV 覆盖率。PV覆盖率计算方法类似，唯一区别就是计算时分子分母不去重。]{.MathJax_Preview style="color: inherit; display: none;"} {.MathJax_Display style="text-align: center;"}``{=html}[[C[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"}]{#33.html#MathJax-Span-28.mistyle="font-family: MathJax_Math-italic;"}[O]{#33.html#MathJax-Span-29.mistyle="font-family: MathJax_Math-italic;"}[V[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.191em;"}]{#33.html#MathJax-Span-31.mistyle="font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1000.75em, 4.144em, -999.998em); top: -3.998em; left: 0em;"}[p]{#33.html#MathJax-Span-34.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[v]{#33.html#MathJax-Span-35.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}]{#33.html#MathJax-Span-33.mrow}]{#33.html#MathJax-Span-32.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; top: -3.856em; left: 0.567em;"}]{style="display: inline-block; position: relative; width: 1.367em; height: 0px;"}]{#33.html#MathJax-Span-30.msubsup}[=]{#33.html#MathJax-Span-36 .mostyle="font-family: MathJax_Main; padding-left: 0.285em;"}[[[[N[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.096em;"}]{#33.html#MathJax-Span-39.mistyle="font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1000.9em, 4.144em, -999.998em); top: -3.998em; left: 0em;"}[∗]{#33.html#MathJax-Span-42.mostyle="font-size: 70.7%; font-family: MathJax_Main;"}]{#33.html#MathJax-Span-41.mrow}]{#33.html#MathJax-Span-40.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.532em, 1000.43em, 4.096em, -999.998em); top: -4.327em; left: 0.944em;"}[l]{#33.html#MathJax-Span-45.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[\>]{#33.html#MathJax-Span-46.mostyle="font-size: 70.7%; font-family: MathJax_Main;"}[c]{#33.html#MathJax-Span-47.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}]{#33.html#MathJax-Span-44.mrow}]{#33.html#MathJax-Span-43.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.391em, 1001.13em, 4.191em, -999.998em); top: -3.668em; left: 0.802em;"}]{style="display: inline-block; position: relative; width: 1.932em; height: 0px;"}]{#33.html#MathJax-Span-38.msubsup}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1001.93em, 4.52em, -999.998em); top: -4.798em; left: 50%; margin-left: -0.986em;"}[[N[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.096em;"}]{#33.html#MathJax-Span-49.mistyle="font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1000.9em, 4.144em, -999.998em); top: -3.998em; left: 0em;"}[∗]{#33.html#MathJax-Span-52.mostyle="font-size: 70.7%; font-family: MathJax_Main;"}]{#33.html#MathJax-Span-51.mrow}]{#33.html#MathJax-Span-50.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.532em, 1000.43em, 4.096em, -999.998em); top: -4.327em; left: 0.944em;"}[p]{#33.html#MathJax-Span-55.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[v]{#33.html#MathJax-Span-56.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}]{#33.html#MathJax-Span-54.mrow}]{#33.html#MathJax-Span-53.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.532em, 1000.75em, 4.285em, -999.998em); top: -3.856em; left: 0.802em;"}]{style="display: inline-block; position: relative; width: 1.602em; height: 0px;"}]{#33.html#MathJax-Span-48.msubsup}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1001.6em, 4.426em, -999.998em); top: -3.292em; left: 50%; margin-left: -0.798em;"}[[]{style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.073em; height: 0px;"}[]{style="display: inline-block; width: 0px; height: 1.085em;"}]{style="position: absolute; clip: rect(0.896em, 1002.07em, 1.226em, -999.998em); top: -1.315em; left: 0em;"}]{style="display: inline-block; position: relative; width: 2.073em; height: 0px; margin-right: 0.144em; margin-left: 0.144em;"}]{#33.html#MathJax-Span-37.mfrac style="padding-left: 0.285em;"}]{#33.html#MathJax-Span-27.mrow}[]{style="display: inline-block; width: 0px; height: 2.355em;"}]{style="position: absolute; clip: rect(0.708em, 1006.59em, 3.485em, -999.998em); top: -2.351em; left: 0em;"}]{style="display: inline-block; position: relative; width: 6.591em; height: 0px; font-size: 125%;"}[]{style="display: inline-block; overflow: hidden; vertical-align: -1.291em; border-left: 0px solid; width: 0px; height: 3.179em;"}]{#33.html#MathJax-Span-26.mathstyle="width: 8.238em; display: inline-block;"}``{=html}[$$COV_{pv} = \frac{N_{l > c}^{\ast}}{N_{pv}^{\ast}}$$]{.MJX_Assistive_MathML.MJX_Assistive_MathML_Blockrole="presentation"}]{#33.html#MathJax-Element-2-Frame .MathJaxtabindex="0" style="text-align: center; position: relative;"mathml="COVpv=Nl>c∗Npv∗"role="presentation"}$$$$5\. 失效率。失效率指标衡量推荐不出结果的情况。也分为 UV 失效率和 PV失效率。UV 失效率计算方法是。]{.MathJax_Preview style="color: inherit; display: none;"} {.MathJax_Display style="text-align: center;"}``{=html}[[L]{#33.html#MathJax-Span-59 .mistyle="font-family: MathJax_Math-italic;"}[O]{#33.html#MathJax-Span-60.mistyle="font-family: MathJax_Math-italic;"}[S[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"}]{#33.html#MathJax-Span-61.mistyle="font-family: MathJax_Math-italic;"}[T[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.144em;"}]{#33.html#MathJax-Span-63.mistyle="font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.202em, 1000.71em, 4.144em, -999.998em); top: -3.998em; left: 0em;"}[u]{#33.html#MathJax-Span-66.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[v]{#33.html#MathJax-Span-67.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}]{#33.html#MathJax-Span-65.mrow}]{#33.html#MathJax-Span-64.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; top: -3.856em; left: 0.567em;"}]{style="display: inline-block; position: relative; width: 1.414em; height: 0px;"}]{#33.html#MathJax-Span-62.msubsup}[=]{#33.html#MathJax-Span-68 .mostyle="font-family: MathJax_Main; padding-left: 0.285em;"}[[[[N[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.096em;"}]{#33.html#MathJax-Span-71.mistyle="font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1000.9em, 4.144em, -999.998em); top: -3.998em; left: 0em;"}[l]{#33.html#MathJax-Span-74.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[=]{#33.html#MathJax-Span-75.mostyle="font-size: 70.7%; font-family: MathJax_Main;"}[0]{#33.html#MathJax-Span-76.mnstyle="font-size: 70.7%; font-family: MathJax_Main;"}]{#33.html#MathJax-Span-73.mrow}]{#33.html#MathJax-Span-72.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; top: -3.856em; left: 0.802em;"}]{style="display: inline-block; position: relative; width: 1.979em; height: 0px;"}]{#33.html#MathJax-Span-70.msubsup}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1001.98em, 4.332em, -999.998em); top: -4.656em; left: 50%; margin-left: -0.986em;"}[[N[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.096em;"}]{#33.html#MathJax-Span-78.mistyle="font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1000.9em, 4.144em, -999.998em); top: -3.998em; left: 0em;"}[u]{#33.html#MathJax-Span-81.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[v]{#33.html#MathJax-Span-82.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}]{#33.html#MathJax-Span-80.mrow}]{#33.html#MathJax-Span-79.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; top: -3.856em; left: 0.802em;"}]{style="display: inline-block; position: relative; width: 1.649em; height: 0px;"}]{#33.html#MathJax-Span-77.msubsup}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1001.65em, 4.285em, -999.998em); top: -3.292em; left: 50%; margin-left: -0.798em;"}[[]{style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.12em; height: 0px;"}[]{style="display: inline-block; width: 0px; height: 1.085em;"}]{style="position: absolute; clip: rect(0.896em, 1002.12em, 1.226em, -999.998em); top: -1.315em; left: 0em;"}]{style="display: inline-block; position: relative; width: 2.12em; height: 0px; margin-right: 0.144em; margin-left: 0.144em;"}]{#33.html#MathJax-Span-69.mfrac style="padding-left: 0.285em;"}]{#33.html#MathJax-Span-58.mrow}[]{style="display: inline-block; width: 0px; height: 2.355em;"}]{style="position: absolute; clip: rect(0.849em, 1007.3em, 3.344em, -999.998em); top: -2.351em; left: 0em;"}]{style="display: inline-block; position: relative; width: 7.296em; height: 0px; font-size: 125%;"}[]{style="display: inline-block; overflow: hidden; vertical-align: -1.115em; border-left: 0px solid; width: 0px; height: 2.885em;"}]{#33.html#MathJax-Span-57.mathstyle="width: 9.132em; display: inline-block;"}``{=html}[$$LOST_{uv} = \frac{N_{l = 0}}{N_{uv}}$$]{.MJX_Assistive_MathML.MJX_Assistive_MathML_Blockrole="presentation"}]{#33.html#MathJax-Element-3-Frame .MathJaxtabindex="0" style="text-align: center; position: relative;"mathml="LOSTuv=Nl=0Nuv"role="presentation"}$$$$分子是推荐结果列表长度为 0覆盖的独立用户数，分母依然是去重后的独立访问用户数。PV失效率也一样，区别是不去重。]{.MathJax_Preview style="color: inherit; display: none;"} {.MathJax_Display style="text-align: center;"}``{=html}[[L]{#33.html#MathJax-Span-85 .mistyle="font-family: MathJax_Math-italic;"}[O]{#33.html#MathJax-Span-86.mistyle="font-family: MathJax_Math-italic;"}[S[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"}]{#33.html#MathJax-Span-87.mistyle="font-family: MathJax_Math-italic;"}[T[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.144em;"}]{#33.html#MathJax-Span-89.mistyle="font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.202em, 1000.71em, 4.144em, -999.998em); top: -3.998em; left: 0em;"}[p]{#33.html#MathJax-Span-92.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[v]{#33.html#MathJax-Span-93.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}]{#33.html#MathJax-Span-91.mrow}]{#33.html#MathJax-Span-90.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; top: -3.856em; left: 0.567em;"}]{style="display: inline-block; position: relative; width: 1.367em; height: 0px;"}]{#33.html#MathJax-Span-88.msubsup}[=]{#33.html#MathJax-Span-94 .mostyle="font-family: MathJax_Main; padding-left: 0.285em;"}[[[[N[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.096em;"}]{#33.html#MathJax-Span-97.mistyle="font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1000.9em, 4.144em, -999.998em); top: -3.998em; left: 0em;"}[∗]{#33.html#MathJax-Span-100.mostyle="font-size: 70.7%; font-family: MathJax_Main;"}]{#33.html#MathJax-Span-99.mrow}]{#33.html#MathJax-Span-98.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.532em, 1000.43em, 4.096em, -999.998em); top: -4.327em; left: 0.944em;"}[l]{#33.html#MathJax-Span-103.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[=]{#33.html#MathJax-Span-104.mostyle="font-size: 70.7%; font-family: MathJax_Main;"}[0]{#33.html#MathJax-Span-105.mnstyle="font-size: 70.7%; font-family: MathJax_Main;"}]{#33.html#MathJax-Span-102.mrow}]{#33.html#MathJax-Span-101.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.391em, 1001.18em, 4.144em, -999.998em); top: -3.668em; left: 0.802em;"}]{style="display: inline-block; position: relative; width: 1.979em; height: 0px;"}]{#33.html#MathJax-Span-96.msubsup}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1001.98em, 4.473em, -999.998em); top: -4.798em; left: 50%; margin-left: -0.986em;"}[[N[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.096em;"}]{#33.html#MathJax-Span-107.mistyle="font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1000.9em, 4.144em, -999.998em); top: -3.998em; left: 0em;"}[∗]{#33.html#MathJax-Span-110.mostyle="font-size: 70.7%; font-family: MathJax_Main;"}]{#33.html#MathJax-Span-109.mrow}]{#33.html#MathJax-Span-108.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.532em, 1000.43em, 4.096em, -999.998em); top: -4.327em; left: 0.944em;"}[p]{#33.html#MathJax-Span-113.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[v]{#33.html#MathJax-Span-114.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}]{#33.html#MathJax-Span-112.mrow}]{#33.html#MathJax-Span-111.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.532em, 1000.75em, 4.285em, -999.998em); top: -3.856em; left: 0.802em;"}]{style="display: inline-block; position: relative; width: 1.602em; height: 0px;"}]{#33.html#MathJax-Span-106.msubsup}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1001.6em, 4.426em, -999.998em); top: -3.292em; left: 50%; margin-left: -0.798em;"}[[]{style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.12em; height: 0px;"}[]{style="display: inline-block; width: 0px; height: 1.085em;"}]{style="position: absolute; clip: rect(0.896em, 1002.12em, 1.226em, -999.998em); top: -1.315em; left: 0em;"}]{style="display: inline-block; position: relative; width: 2.12em; height: 0px; margin-right: 0.144em; margin-left: 0.144em;"}]{#33.html#MathJax-Span-95.mfrac style="padding-left: 0.285em;"}]{#33.html#MathJax-Span-84.mrow}[]{style="display: inline-block; width: 0px; height: 2.355em;"}]{style="position: absolute; clip: rect(0.708em, 1007.25em, 3.485em, -999.998em); top: -2.351em; left: 0em;"}]{style="display: inline-block; position: relative; width: 7.249em; height: 0px; font-size: 125%;"}[]{style="display: inline-block; overflow: hidden; vertical-align: -1.291em; border-left: 0px solid; width: 0px; height: 3.179em;"}]{#33.html#MathJax-Span-83.mathstyle="width: 9.085em; display: inline-block;"}``{=html}[$$LOST_{pv} = \frac{N_{l = 0}^{\ast}}{N_{pv}^{\ast}}$$]{.MJX_Assistive_MathML.MJX_Assistive_MathML_Blockrole="presentation"}]{#33.html#MathJax-Element-4-Frame .MathJaxtabindex="0" style="text-align: center; position: relative;"mathml="LOSTpv=Nl=0∗Npv∗"role="presentation"}$$$$6\.新颖性。对于用户来说，"总是看到你这张老脸"会让他们审美疲劳，所以对用户来说，推荐的物品要有一定的新颖性。直观理解就是用户没见过。所以新颖性需要讲粒度，物品粒度、标签粒度、主题粒度、分类粒度等等。每个粒度上评价用户没见过的物品比例。对于物品级别的新颖性，更多是靠直接过滤保证，这在前面章节已经专门讲到了对应的过滤算法。7\.更新率。检测推荐结果更新程度。如果推荐列表每天几乎一样，显然不可取，尤其是新闻资讯类，要求每次刷新都不一样，对更新率要求更高。更新率可以有很多衡量方式，有一种是衡量每个推荐周期和上个周期相比，推荐列表中不同物品的比例。这个周期，可以是每次刷新，也可以是每天。]{.MathJax_Preview style="color: inherit; display: none;"} {.MathJax_Display style="text-align: center;"}``{=html}[[U[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.096em;"}]{#33.html#MathJax-Span-117.mistyle="font-family: MathJax_Math-italic;"}[P[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.096em;"}]{#33.html#MathJax-Span-118.mistyle="font-family: MathJax_Math-italic;"}[D]{#33.html#MathJax-Span-119.mistyle="font-family: MathJax_Math-italic;"}[A]{#33.html#MathJax-Span-120.mistyle="font-family: MathJax_Math-italic;"}[T[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.144em;"}]{#33.html#MathJax-Span-121.mistyle="font-family: MathJax_Math-italic;"}[E[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"}]{#33.html#MathJax-Span-122.mistyle="font-family: MathJax_Math-italic;"}[=]{#33.html#MathJax-Span-123.mostyle="font-family: MathJax_Main; padding-left: 0.285em;"}[[Δ]{#33.html#MathJax-Span-126.mistyle="font-family: MathJax_Main;"}[[[N[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.096em;"}]{#33.html#MathJax-Span-130.mistyle="font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1000.9em, 4.144em, -999.998em); top: -3.998em; left: 0em;"}[d[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"}]{#33.html#MathJax-Span-133.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[i]{#33.html#MathJax-Span-134.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[f[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"}]{#33.html#MathJax-Span-135.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[f[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"}]{#33.html#MathJax-Span-136.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}]{#33.html#MathJax-Span-132.mrow}]{#33.html#MathJax-Span-131.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; top: -3.856em; left: 0.802em;"}]{style="display: inline-block; position: relative; width: 2.261em; height: 0px;"}]{#33.html#MathJax-Span-129.msubsup}]{#33.html#MathJax-Span-128 .mrow}]{#33.html#MathJax-Span-127.texatom}]{#33.html#MathJax-Span-125.mrow}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1003.11em, 4.426em, -999.998em); top: -4.751em; left: 50%; margin-left: -1.551em;"}[[N[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.096em;"}]{#33.html#MathJax-Span-138.mistyle="font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1000.9em, 4.144em, -999.998em); top: -3.998em; left: 0em;"}[l]{#33.html#MathJax-Span-141.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[a]{#33.html#MathJax-Span-142.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[s]{#33.html#MathJax-Span-143.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[t]{#33.html#MathJax-Span-144.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}]{#33.html#MathJax-Span-140.mrow}]{#33.html#MathJax-Span-139.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; top: -3.856em; left: 0.802em;"}]{style="display: inline-block; position: relative; width: 2.073em; height: 0px;"}]{#33.html#MathJax-Span-137.msubsup}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1002.07em, 4.285em, -999.998em); top: -3.292em; left: 50%; margin-left: -1.033em;"}[[]{style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 3.202em; height: 0px;"}[]{style="display: inline-block; width: 0px; height: 1.085em;"}]{style="position: absolute; clip: rect(0.896em, 1003.2em, 1.226em, -999.998em); top: -1.315em; left: 0em;"}]{style="display: inline-block; position: relative; width: 3.202em; height: 0px; margin-right: 0.144em; margin-left: 0.144em;"}]{#33.html#MathJax-Span-124.mfrac style="padding-left: 0.285em;"}]{#33.html#MathJax-Span-116.mrow}[]{style="display: inline-block; width: 0px; height: 2.355em;"}]{style="position: absolute; clip: rect(0.755em, 1009.46em, 3.344em, -999.998em); top: -2.351em; left: 0em;"}]{style="display: inline-block; position: relative; width: 9.461em; height: 0px; font-size: 125%;"}[]{style="display: inline-block; overflow: hidden; vertical-align: -1.115em; border-left: 0px solid; width: 0px; height: 3.003em;"}]{#33.html#MathJax-Span-115.mathstyle="width: 11.861em; display: inline-block;"}``{=html}[$$UPDATE = \frac{\Delta N_{diff}}{N_{last}}$$]{.MJX_Assistive_MathML.MJX_Assistive_MathML_Blockrole="presentation"}]{#33.html#MathJax-Element-5-Frame .MathJaxtabindex="0" style="text-align: center; position: relative;"mathml="UPDATE=ΔNdiffNlast"role="presentation"}$$$$
### 2. 还能好多久？ {#33.html#2-}除了关注系统表现有多好外，你还需要忧虑另一件事，你的系统还能好多久？也就是系统是否健康。在推荐系统中，需要数据不断更新，这样系统才是一个活系统，用户兴趣客观上会变迁，数据源客观上也是会用光的一天，所以推荐系统如果不能应对这两个变化，就好不了太久。``{=html}衡量推荐系统是否健康的指标常用的有三个。1\.个性化。虽然说到推荐系统时，言必称个性化，但实际上能做到真正个性化很难，那要求用户每个人都独立思考、爱好明确、不受群体影响。但是个性化程度的确能够反映推荐系统的健康程度，按照我们在专栏第一篇"是否需要推荐系统"中提出的那个公式来看：]{.MathJax_Preview style="color: inherit; display: none;"} {.MathJax_Display style="text-align: center;"}``{=html}[[[[[[Δ]{#33.html#MathJax-Span-149.mi style="font-family: MathJax_Main;"}c]{#33.html#MathJax-Span-152.mistyle="font-family: MathJax_Math-italic;"}[o]{#33.html#MathJax-Span-153.mistyle="font-family: MathJax_Math-italic;"}[n]{#33.html#MathJax-Span-154.mistyle="font-family: MathJax_Math-italic;"}[n]{#33.html#MathJax-Span-155.mistyle="font-family: MathJax_Math-italic;"}[e]{#33.html#MathJax-Span-156.mistyle="font-family: MathJax_Math-italic;"}[c]{#33.html#MathJax-Span-157.mistyle="font-family: MathJax_Math-italic;"}[t]{#33.html#MathJax-Span-158.mistyle="font-family: MathJax_Math-italic;"}[i]{#33.html#MathJax-Span-159.mistyle="font-family: MathJax_Math-italic;"}[o]{#33.html#MathJax-Span-160.mistyle="font-family: MathJax_Math-italic;"}[n]{#33.html#MathJax-Span-161.mistyle="font-family: MathJax_Math-italic;"}]{#33.html#MathJax-Span-151.mrow}]{#33.html#MathJax-Span-150 .texatom}]{#33.html#MathJax-Span-148.mrow}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1005.6em, 4.144em, -999.998em); top: -4.656em; left: 50%; margin-left: -2.821em;"}Δ]{#33.html#MathJax-Span-163.mi style="font-family: MathJax_Main;"}u]{#33.html#MathJax-Span-166.mistyle="font-family: MathJax_Math-italic;"}[s]{#33.html#MathJax-Span-167.mistyle="font-family: MathJax_Math-italic;"}[e]{#33.html#MathJax-Span-168.mistyle="font-family: MathJax_Math-italic;"}[r]{#33.html#MathJax-Span-169.mistyle="font-family: MathJax_Math-italic;"}]{#33.html#MathJax-Span-165.mrow}]{#33.html#MathJax-Span-164 .texatom}[×]{#33.html#MathJax-Span-170.mostyle="font-family: MathJax_Main; padding-left: 0.238em;"}[Δ]{#33.html#MathJax-Span-171.mistyle="font-family: MathJax_Main; padding-left: 0.238em;"}i]{#33.html#MathJax-Span-174.mistyle="font-family: MathJax_Math-italic;"}[t]{#33.html#MathJax-Span-175.mistyle="font-family: MathJax_Math-italic;"}[e]{#33.html#MathJax-Span-176.mistyle="font-family: MathJax_Math-italic;"}[m]{#33.html#MathJax-Span-177.mistyle="font-family: MathJax_Math-italic;"}]{#33.html#MathJax-Span-173.mrow}]{#33.html#MathJax-Span-172 .texatom}]{#33.html#MathJax-Span-162.mrow}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1006.92em, 4.144em, -999.998em); top: -3.292em; left: 50%; margin-left: -3.48em;"}[[]{style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 7.061em; height: 0px;"}[]{style="display: inline-block; width: 0px; height: 1.085em;"}]{style="position: absolute; clip: rect(0.896em, 1007.06em, 1.226em, -999.998em); top: -1.315em; left: 0em;"}]{style="display: inline-block; position: relative; width: 7.061em; height: 0px; margin-right: 0.144em; margin-left: 0.144em;"}]{#33.html#MathJax-Span-147.mfrac}]{#33.html#MathJax-Span-146.mrow}[]{style="display: inline-block; width: 0px; height: 2.308em;"}]{style="position: absolute; clip: rect(0.755em, 1007.34em, 3.155em, -999.998em); top: -2.304em; left: 0em;"}]{style="display: inline-block; position: relative; width: 7.344em; height: 0px; font-size: 125%;"}[]{style="display: inline-block; overflow: hidden; vertical-align: -0.938em; border-left: 0px solid; width: 0px; height: 2.709em;"}]{#33.html#MathJax-Span-145.mathstyle="width: 9.179em; display: inline-block;"}``{=html}[$$\frac{\Delta{connection}}{\Delta{user} \times \Delta{item}}$$]{.MJX_Assistive_MathML.MJX_Assistive_MathML_Blockrole="presentation"}]{#33.html#MathJax-Element-6-Frame .MathJaxtabindex="0" style="text-align: center; position: relative;"mathml="ΔconnectionΔuser×Δitem"role="presentation"}$$$$如果没有个性化，那么分子上增加的连接数，其实是不受分母上增加的物品数影响的，因为所有人都只消费那少数几个物品，那么你其实不需要推荐系统。个性化如何检测呢？有一个直观的方法，取一天的日志，计算用户推荐列表的平均相似度，如果用户量较大，对用户抽样。2\.基尼系数。基尼系数衡量推荐系统的马太效应，反向衡量推荐的个性化程度。把物品按照累计推荐次数排序，排在位置i 的物品，其推荐次数占总次数为 []{.MathJax_Previewstyle="color: inherit; display: none;"}[``{=html}[[[[[p]{#33.html#MathJax-Span-181.mistyle="font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.438em, 1000.52em, 4.332em, -999.998em); top: -3.998em; left: 0em;"}[i]{#33.html#MathJax-Span-184.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}]{#33.html#MathJax-Span-183.mrow}]{#33.html#MathJax-Span-182.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; top: -3.856em; left: 0.52em;"}]{style="display: inline-block; position: relative; width: 0.802em; height: 0px;"}]{#33.html#MathJax-Span-180.msubsup}]{#33.html#MathJax-Span-179.mrow}[]{style="display: inline-block; width: 0px; height: 2.308em;"}]{style="position: absolute; clip: rect(1.744em, 1000.8em, 2.638em, -999.998em); top: -2.304em; left: 0em;"}]{style="display: inline-block; position: relative; width: 0.802em; height: 0px; font-size: 125%;"}[]{style="display: inline-block; overflow: hidden; vertical-align: -0.291em; border-left: 0px solid; width: 0px; height: 0.944em;"}]{#33.html#MathJax-Span-178.mathstyle="width: 1.038em; display: inline-block;"}``{=html}[$p_{i}$]{.MJX_Assistive_MathMLrole="presentation"}]{#33.html#MathJax-Element-7-Frame .MathJaxtabindex="0" style="position: relative;"mathml="pi"role="presentation"}$$。那么基尼系数为：]{.MathJax_Preview style="color: inherit; display: none;"} {.MathJax_Display style="text-align: center;"}``{=html}[[G]{#33.html#MathJax-Span-187 .mistyle="font-family: MathJax_Math-italic;"}[i]{#33.html#MathJax-Span-188.mistyle="font-family: MathJax_Math-italic;"}[n]{#33.html#MathJax-Span-189.mistyle="font-family: MathJax_Math-italic;"}[i]{#33.html#MathJax-Span-190.mistyle="font-family: MathJax_Math-italic;"}[=]{#33.html#MathJax-Span-191.mostyle="font-family: MathJax_Main; padding-left: 0.285em;"}[1]{#33.html#MathJax-Span-193.mnstyle="font-family: MathJax_Main;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.202em, 1000.43em, 4.144em, -999.998em); top: -4.656em; left: 50%; margin-left: -0.233em;"}[[n]{#33.html#MathJax-Span-194.mistyle="font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.438em, 1000.57em, 4.144em, -999.998em); top: -3.292em; left: 50%; margin-left: -0.28em;"}[[]{style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.708em; height: 0px;"}[]{style="display: inline-block; width: 0px; height: 1.085em;"}]{style="position: absolute; clip: rect(0.896em, 1000.71em, 1.226em, -999.998em); top: -1.315em; left: 0em;"}]{style="display: inline-block; position: relative; width: 0.708em; height: 0px; margin-right: 0.144em; margin-left: 0.144em;"}]{#33.html#MathJax-Span-192.mfrac style="padding-left: 0.285em;"}[∑]{#33.html#MathJax-Span-196.mostyle="font-family: MathJax_Size2; vertical-align: 0em;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(2.92em, 1001.37em, 4.614em, -999.998em); top: -3.998em; left: 0em;"}[i]{#33.html#MathJax-Span-199.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[=]{#33.html#MathJax-Span-200.mostyle="font-size: 70.7%; font-family: MathJax_Main;"}[1]{#33.html#MathJax-Span-201.mnstyle="font-size: 70.7%; font-family: MathJax_Main;"}]{#33.html#MathJax-Span-198.mrow}]{#33.html#MathJax-Span-197.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.391em, 1001.09em, 4.238em, -999.998em); top: -2.915em; left: 0.144em;"}[n]{#33.html#MathJax-Span-204.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}]{#33.html#MathJax-Span-203.mrow}]{#33.html#MathJax-Span-202.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.438em, 1000.43em, 4.144em, -999.998em); top: -5.127em; left: 0.52em;"}]{style="display: inline-block; position: relative; width: 1.461em; height: 0px;"}]{#33.html#MathJax-Span-195.munderoverstyle="padding-left: 0.191em;"}[[[p]{#33.html#MathJax-Span-208 .mistyle="font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.438em, 1000.52em, 4.332em, -999.998em); top: -3.998em; left: 0em;"}[[i]{#33.html#MathJax-Span-209.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; top: -3.856em; left: 0.52em;"}]{style="display: inline-block; position: relative; width: 0.802em; height: 0px;"}]{#33.html#MathJax-Span-207.msubsup}[∗]{#33.html#MathJax-Span-210 .mostyle="font-family: MathJax_Main; padding-left: 0.238em;"}[(]{#33.html#MathJax-Span-211.mostyle="font-family: MathJax_Main; padding-left: 0.238em;"}[2]{#33.html#MathJax-Span-212.mn style="font-family: MathJax_Main;"}[i]{#33.html#MathJax-Span-213 .mistyle="font-family: MathJax_Math-italic;"}[−]{#33.html#MathJax-Span-214.mostyle="font-family: MathJax_Main; padding-left: 0.238em;"}[n]{#33.html#MathJax-Span-215.mistyle="font-family: MathJax_Math-italic; padding-left: 0.238em;"}[−]{#33.html#MathJax-Span-216.mostyle="font-family: MathJax_Main; padding-left: 0.238em;"}[i]{#33.html#MathJax-Span-217.mistyle="font-family: MathJax_Math-italic; padding-left: 0.238em;"}[)]{#33.html#MathJax-Span-218.mo style="font-family: MathJax_Main;"}]{#33.html#MathJax-Span-206.mrow}]{#33.html#MathJax-Span-205 .texatomstyle="padding-left: 0.191em;"}]{#33.html#MathJax-Span-186.mrow}[]{style="display: inline-block; width: 0px; height: 2.355em;"}]{style="position: absolute; clip: rect(0.661em, 1012.99em, 3.673em, -999.998em); top: -2.351em; left: 0em;"}]{style="display: inline-block; position: relative; width: 13.085em; height: 0px; font-size: 125%;"}[]{style="display: inline-block; overflow: hidden; vertical-align: -1.526em; border-left: 0px solid; width: 0px; height: 3.591em;"}]{#33.html#MathJax-Span-185.mathstyle="width: 16.379em; display: inline-block;"}``{=html}[$$Gini = \frac{1}{n}\sum\limits_{i = 1}^{n}{p_{i} \ast (2i - n - i)}$$]{.MJX_Assistive_MathML.MJX_Assistive_MathML_Blockrole="presentation"}]{#33.html#MathJax-Element-8-Frame .MathJaxtabindex="0" style="text-align: center; position: relative;"mathml="Gini=1n∑i=1npi∗(2i−n−i)"role="presentation"}$$$$看这个公式可以知道，如果推荐次数越不平均，那么基尼系数就越趋近于 1。3\.多样性。多样性不但要在推荐服务吐出结果时需要做一定的保证，也要通过日志做监测。多样性可能会损失一些效果指标，但是从长远上来看，对推荐系统所在平台是有利的。多样的推荐结果也会让产品显得生机勃勃，提升品牌形象。多样性衡量方式通常要依赖维度体系选择，例如常见的是在类别维度上衡量推荐结果的多样性。方法是下面这样的。]{.MathJax_Preview style="color: inherit; display: none;"} {.MathJax_Display style="text-align: center;"}``{=html}[[D]{#33.html#MathJax-Span-221 .mistyle="font-family: MathJax_Math-italic;"}[i]{#33.html#MathJax-Span-222.mistyle="font-family: MathJax_Math-italic;"}[v]{#33.html#MathJax-Span-223.mistyle="font-family: MathJax_Math-italic;"}[=]{#33.html#MathJax-Span-224.mostyle="font-family: MathJax_Main; padding-left: 0.285em;"}[[[[[∑]{#33.html#MathJax-Span-228.mostyle="font-family: MathJax_Size1; vertical-align: 0em;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.108em, 1000.99em, 4.379em, -999.998em); top: -3.998em; left: 0em;"}[n]{#33.html#MathJax-Span-231.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}]{#33.html#MathJax-Span-230.mrow}]{#33.html#MathJax-Span-229.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.532em, 1000.52em, 4.144em, -999.998em); top: -4.468em; left: 1.038em;"}[i]{#33.html#MathJax-Span-234.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[=]{#33.html#MathJax-Span-235.mostyle="font-size: 70.7%; font-family: MathJax_Main;"}[1]{#33.html#MathJax-Span-236.mnstyle="font-size: 70.7%; font-family: MathJax_Main;"}]{#33.html#MathJax-Span-233.mrow}]{#33.html#MathJax-Span-232.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.391em, 1001.23em, 4.144em, -999.998em); top: -3.715em; left: 1.038em;"}]{style="display: inline-block; position: relative; width: 2.261em; height: 0px;"}]{#33.html#MathJax-Span-227.munderover}−]{#33.html#MathJax-Span-239 .mostyle="font-family: MathJax_Main;"}[p]{#33.html#MathJax-Span-241 .mistyle="font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.438em, 1000.52em, 4.332em, -999.998em); top: -3.998em; left: 0em;"}[[i]{#33.html#MathJax-Span-242.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; top: -3.856em; left: 0.52em;"}]{style="display: inline-block; position: relative; width: 0.802em; height: 0px;"}]{#33.html#MathJax-Span-240.msubsup}[∗]{#33.html#MathJax-Span-243 .mostyle="font-family: MathJax_Main; padding-left: 0.238em;"}[l]{#33.html#MathJax-Span-244.mistyle="font-family: MathJax_Math-italic; padding-left: 0.238em;"}[o]{#33.html#MathJax-Span-245.mistyle="font-family: MathJax_Math-italic;"}[g[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"}]{#33.html#MathJax-Span-246.mistyle="font-family: MathJax_Math-italic;"}[(]{#33.html#MathJax-Span-247.mo style="font-family: MathJax_Main;"}[p]{#33.html#MathJax-Span-249.mistyle="font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.438em, 1000.52em, 4.332em, -999.998em); top: -3.998em; left: 0em;"}[[i]{#33.html#MathJax-Span-250.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; top: -3.856em; left: 0.52em;"}]{style="display: inline-block; position: relative; width: 0.802em; height: 0px;"}]{#33.html#MathJax-Span-248.msubsup}[)]{#33.html#MathJax-Span-251 .mostyle="font-family: MathJax_Main;"}]{#33.html#MathJax-Span-238.mrow}]{#33.html#MathJax-Span-237 .texatomstyle="padding-left: 0.191em;"}]{#33.html#MathJax-Span-226.mrow}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.061em, 1007.81em, 4.426em, -999.998em); top: -4.751em; left: 50%; margin-left: -3.951em;"}n]{#33.html#MathJax-Span-253.mistyle="font-family: MathJax_Math-italic;"}[∗]{#33.html#MathJax-Span-254.mostyle="font-family: MathJax_Main; padding-left: 0.238em;"}[l]{#33.html#MathJax-Span-255.mistyle="font-family: MathJax_Math-italic; padding-left: 0.238em;"}[o]{#33.html#MathJax-Span-256.mistyle="font-family: MathJax_Math-italic;"}[g[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"}]{#33.html#MathJax-Span-257.mistyle="font-family: MathJax_Math-italic;"}[(]{#33.html#MathJax-Span-258.mo style="font-family: MathJax_Main;"}[n]{#33.html#MathJax-Span-259 .mistyle="font-family: MathJax_Math-italic;"}[)]{#33.html#MathJax-Span-260.mo style="font-family: MathJax_Main;"}]{#33.html#MathJax-Span-252.mrow}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.108em, 1004.14em, 4.379em, -999.998em); top: -3.292em; left: 50%; margin-left: -2.115em;"}[[]{style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 8.049em; height: 0px;"}[]{style="display: inline-block; width: 0px; height: 1.085em;"}]{style="position: absolute; clip: rect(0.896em, 1008.05em, 1.226em, -999.998em); top: -1.315em; left: 0em;"}]{style="display: inline-block; position: relative; width: 8.049em; height: 0px; margin-right: 0.144em; margin-left: 0.144em;"}]{#33.html#MathJax-Span-225.mfrac style="padding-left: 0.285em;"}]{#33.html#MathJax-Span-220.mrow}[]{style="display: inline-block; width: 0px; height: 2.355em;"}]{style="position: absolute; clip: rect(0.661em, 1011.34em, 3.438em, -999.998em); top: -2.351em; left: 0em;"}]{style="display: inline-block; position: relative; width: 11.344em; height: 0px; font-size: 125%;"}[]{style="display: inline-block; overflow: hidden; vertical-align: -1.232em; border-left: 0px solid; width: 0px; height: 3.238em;"}]{#33.html#MathJax-Span-219.mathstyle="width: 14.214em; display: inline-block;"}``{=html}[$$Div = \frac{\sum\limits_{i = 1}^{n}{- p_{i} \ast log(p_{i})}}{n \ast log(n)}$$]{.MJX_Assistive_MathML.MJX_Assistive_MathML_Blockrole="presentation"}]{#33.html#MathJax-Element-9-Frame .MathJaxtabindex="0" style="text-align: center; position: relative;"mathml="Div=∑i=1n−pi∗log(pi)n∗log(n)"role="presentation"}$$$$多样性衡量实际上在衡量各个类别在推荐时的熵，一共有 n个类别，分母是各个类别最均匀，都得到一样的推荐次数情况下对应的熵。分子则是实际各个类别得到的推荐次数，[]{.MathJax_Previewstyle="color: inherit; display: none;"}[``{=html}[[[[[p]{#33.html#MathJax-Span-264.mistyle="font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.438em, 1000.52em, 4.332em, -999.998em); top: -3.998em; left: 0em;"}[i]{#33.html#MathJax-Span-267.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}]{#33.html#MathJax-Span-266.mrow}]{#33.html#MathJax-Span-265.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; top: -3.856em; left: 0.52em;"}]{style="display: inline-block; position: relative; width: 0.802em; height: 0px;"}]{#33.html#MathJax-Span-263.msubsup}]{#33.html#MathJax-Span-262.mrow}[]{style="display: inline-block; width: 0px; height: 2.308em;"}]{style="position: absolute; clip: rect(1.744em, 1000.8em, 2.638em, -999.998em); top: -2.304em; left: 0em;"}]{style="display: inline-block; position: relative; width: 0.802em; height: 0px; font-size: 125%;"}[]{style="display: inline-block; overflow: hidden; vertical-align: -0.291em; border-left: 0px solid; width: 0px; height: 0.944em;"}]{#33.html#MathJax-Span-261.mathstyle="width: 1.038em; display: inline-block;"}``{=html}[$p_{i}$]{.MJX_Assistive_MathMLrole="presentation"}]{#33.html#MathJax-Element-10-Frame .MathJaxtabindex="0" style="position: relative;"mathml="pi"role="presentation"}$$ 是类别 i被推荐次数占总推荐次数的比例，计算它的熵。两者求比值是为了在类别数增加和减少时，可以互相比较。这种计算多样性是一个整体的评价，还可以具体评价每次推荐的多样性，每个用户的多样性，也就是PV 多样性和 UV 多样性。