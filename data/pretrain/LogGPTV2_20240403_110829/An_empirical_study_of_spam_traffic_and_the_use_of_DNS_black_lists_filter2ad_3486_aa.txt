title:An empirical study of spam traffic and the use of DNS black lists
author:Jaeyeon Jung and
Emil Sit
An Empirical Study of Spam Trafﬁc and the Use
of DNS Black Lists
Jaeyeon Jung
PI:EMAIL
Emil Sit
PI:EMAIL
MIT Computer Science and Artiﬁcial Intelligence Laboratory
32 Vassar Street, Cambridge, MA 02139, USA
ABSTRACT
This paper presents quantitative data about SMTP trafﬁc to MIT’s
Computer Science and Artiﬁcial Intelligence Laboratory (CSAIL)
based on packet traces taken in December 2000 and February 2004.
These traces show that the volume of email has increased by 866%
between 2000 and 2004. Local mail hosts utilizing black lists gen-
erated over 470,000 DNS lookups, which accounts for 14% of all
DNS lookups that were observed on the border gateway of CSAIL
on a given day in 2004. In comparison, DNS black list lookups
accounted for merely 0.4% of lookups in December 2000.
The distribution of the number of connections per remote spam
source is Zipf-like in 2004, but not so in 2000. This suggests that
black lists may be ineffective at fully stemming the tide of spam.
We examined seven popular black lists and found that 80% of spam
sources we identiﬁed are listed in some DNS black list. Some DNS
black lists appear to be well-correlated with others, which should
be considered when estimating the likelihood that a host is a spam
source.
Categories and Subject Descriptors
C.2.2 [COMPUTER-COMMUNICATION NETWORKS]: Net-
work Protocols
General Terms
Measurement
Keywords
Spam trafﬁc, DNS black lists, Zipf-like distribution
1.
INTRODUCTION
Unsolicited bulk email (“spam”) is a major fraction of mail sent
and received on the Internet [9]. One of the commonly deployed
techniques to block spam is address-based ﬁltering, using which
one can refuse to accept mail from hosts that are believed to send
spam. Once identiﬁed, the IP address of a host engaged in spam de-
livery is registered in centrally maintained databases. This database
Permission to make digital or hard copies of all or part of this work for
personal or classroom use is granted without fee provided that copies are
not made or distributed for proﬁt or commercial advantage and that copies
bear this notice and the full citation on the ﬁrst page. To copy otherwise, to
republish, to post on servers or to redistribute to lists, requires prior speciﬁc
permission and/or a fee.
IMC’04, October 25–27, 2004, Taormina, Sicily, Italy.
Copyright 2004 ACM 1-58113-821-0/04/0010 ...$5.00.
is made available via the Internet DNS and hence often called do-
main name system black lists (DNSBLs). Mail recipients can query
this database using standard DNS lookups and deny any mails from
the hosts that are listed in the database.
Over the past several years, an increasing number of DNSBLs
are offering various lists of IP addresses based on some criteria
— for example, each IP address may be an open relay, a virus
source, or an actual spam source caught by a spam trap. In this
paper, we ﬁrst provide a classiﬁcation of DNSBLs, which shows
that DNSBLs vary widely in terms of their focus and the coverage
of IP addresses and one should factor in this difference when using
DNSBLs to assign the mail’s spam score.
We then analyze SMTP and DNSBL trafﬁc, based on a pair of
packet traces taken at the MIT Computer Science and Artiﬁcial
Intelligence Laboratory (CSAIL). Data from two traces, taken in
2000 and 2004, are used to provide a comparison of trafﬁc patterns
over time. We extensively analyzed the 2000 trace in our previous
work [11]. This paper re-analyzes the 2000 trace for SMTP speciﬁc
activity and compares it with a trace taken in February 2004.
In analyzing these traces, this paper makes the following contri-
butions:• We characterize the incoming SMTP workload and resulting
outgoing DNSBL workload between 2000 and 2004. In our
February 2004 (2000) trace, 73,601 (4,553) remote hosts ini-
tiated 776,363 (28,909) incoming SMTP connections to 183
(151) hosts at CSAIL per day. In response, local mail hosts
utilizing some form of black lists issued 472,644 (2,153)
DNS lookups, which accounts for 14.09% (0.4%) of all DNS
lookups recorded at the border gateway of CSAIL.
• We observed the existence of machines that receive many
SMTP connection attempts despite not running mail trans-
fer agents; we use these machines as spam traps and show
that the distribution of spam sources is Zipf-like in 2004 but
not in 2000. The heavy-tailedness of Zipf-like distribution
results from the signiﬁcant increase of the number of spam
sources that made less than 10 connections to the monitoring
network in 2004. The considerable increase of these low-
proﬁle spam sources may cause DNSBLs difﬁculty identify-
ing spam sources.
• We show that a black list that aggressively blocks “open re-
lays” includes 80% of hosts that sent mail to our spam traps.
Using conditional probabilities, we show that some lists, like
SORBS [5] and DSBL [3], are highly correlated to each
other, which should be factored in estimating the likelihood
that a given host is a spam source.
The rest of this paper is structured as follows. In Section 2, we
provide a brief overview of the different classes of DNS black lists
and how they are used to combat spam. We describe our collection
methodology and data set in Section 3. We analyze the membership
and relationships of several black lists in Section 4. We brieﬂy
summarize our results and future work in Section 5.
2. BACKGROUND
While “spam” itself is difﬁcult to deﬁne precisely, most people
know what spam is when presented with it. Loosely, it is any un-
solicited email that is sent to a large number of recipients. In some
cases, this mail may be commercially oriented (e.g., an advertise-
ment), but much of mail termed “spam” is actually not commercial,
but rather some scam or virus.
2.1 Mail Life-cycle
Spam, as a subset of email, is technically delivered just like any
other piece of email. After it is composed, the sender hands off the
mail to a local mail transfer agent (MTA) that assumes responsi-
bility for delivering the mail to the ﬁnal destination. This MTA is
known as the injection point. If the sender is part of a large network,
the local MTA may transfer the mail to additional hosts within the
same administrative domain, allowing aggregation of mail within
an organization. Each host is said to relay the mail.
Eventually, one of the MTAs in the sender’s organization (pos-
sibly the local injection MTA) will identify a host responsible for
receiving mail for the recipient’s domain, and relay the mail to that
host. This host is known as the domain’s mail exchanger, and is
speciﬁed via a DNS MX record. At this point, the MTA on the re-
cipient’s mail exchanger may relay the message internally within
the organization, ultimately arriving at an MTA that performs de-
livery, storing the message in a local mailbox for the recipient. In
some cases, the recipient may choose to have his local MTA au-
tomatically perform some ﬁltering to select the appropriate local
mailbox for a given message.
MTAs relay mail between each other using the Simple Mail
Transfer Protocol (SMTP) [12]. This protocol allows the receiving
MTA to weakly authenticate and authorize the sending MTA and
reject the transaction if desired. Additionally, MTAs annotate each
mail message with a received header which identiﬁes both parties
involved in the exchange, and the time at which it occurred. This
header adds accountability and aids in debugging mail problems.
2.2 Black Lists
Originally, spammers sent spam just like regular email from
their own accounts. However, with a limited number of actual
senders [16], it became easy to block the addresses of the senders
and also to trace them back to origin server and request that the ac-
count of the sender be revoked. To get around this “problem” and
to get free bandwidth and CPU cycles, spammers started relaying
mail through hosts that would accept responsibility for delivering
anyone’s mail — these hosts are called open relays. More recently,
spammers are believed to be using compromised client machines
to directly deliver mail [13]. We call any machine used to deliver
spam a spam source.
Various lists of spam sources are maintained, with data culled
from dedicated and casual participants, and are centrally adminis-
tered and disseminated. These lists are called black lists because
people typically choose to refuse all mail originating from a listed
host: recipients or mail transfer agents consult one or more of these
databases to determine if the remote peer is believed to be a spam
source.
We classify black lists based on two axes. First, we iden-
tify the focus of the list (e.g., RFC compliance, open relays, ac-
tual spam sources, country/ISP net blocks, virus sources, veriﬁed
senders/spammers, etc.). Second, we consider how aggressively
addresses are added to the lists. The level varies from active prob-
ing (e.g., testing for open relays), to manual entry (e.g., verifying
hosts before adding), and to passive monitoring (e.g., only adding
hosts that send mail to spam traps). We summarize 31 widely used
black lists in Table 1. Compared to in 2000 when there were only
5 black lists actively used within CSAIL, there are now many more
black lists in use.
While some of these lists can be downloaded locally and used
with tools such as OpenBSD’s spamd [10], most people access
these lists via the Domain Name System (DNS). For this reason,
these black lists are typically called DNS black lists. The DNS
provides an efﬁcient and scalable way for providing geographically
distributed clients with the ability to test whether a given host is a
member of the set of black-listed hosts. The test for whether a host
a.b.c.d is on a given list is simple: a DNS lookup is done for
the A record of the name d.c.b.a.blacklist-name. This is
similar to the in-addr.arpa style of reverse DNS lookups.
2.3 DNSBL Clients
DNS black list clients are typically either built into MTAs or sep-
arate programs invoked when mail is ﬁltered into mailboxes during
ﬁnal delivery.
MTAs check DNS black lists to determine whether the party re-
laying the mail is listed. Multiple lists may be checked, as each
black list is targeted differently. At this point, the MTA can choose
to refuse to accept the mail, end the transaction with an appropri-
ate error code, and terminate the connection. This activity happens
before the mail is accepted locally.
Sometimes, ﬁltering is performed after mail is accepted; the en-
tire body has been received and programs like SpamAssassin [14]
run a variety of tests to determine if the mail is spam. Each test in-
ﬂuences the mail’s “spam score”; when performing ﬁnal delivery,
the user’s ﬁlter can use this score to determine if the mail is spam.
SpamAssassin contains tests that parse the “Received” headers of
a given piece of mail and check if the mail has transited any black-
listed hosts. These tests have been available since the 0.3 release
of SpamAssassin in June 2001, and have expanded from checking
three black lists to checking thirty-ﬁve lists hosted at eleven sites
(in the 2.6.3 release).
3. DATA
We collected traces in December 2000 and in February 2004 at
a link connecting MIT Computer Science and Artiﬁcial Intelligent
Laboratory (CSAIL) to the rest of the world. The trace contains
bidirectional TCP SYN/FIN/RST packets, outgoing DNS query
packets and incoming DNS response packets. The details of the
collection methodology are described in our previous paper [11];
in the intervening time, the network topology remained unchanged
but the access link was upgraded from a single symmetric 100Mbps
link to two parallel 100Mbps links.
3.1 DNS Trafﬁc
DNSBL related trafﬁc now is a considerable source of DNS
lookups from within CSAIL. As in our previous work [11], we de-
ﬁne a DNS lookup as a series of packets, related to a single domain
name from the initial query to the ﬁnal answer. We identify DNSBL
related lookups using the following two-step process.
• We ﬁrst obtain a set of DNSBLs that our local hosts queried
by examining all the DNS A queries for a host of the form
[1-255].[1-255].[1-255].[1-255].name. We manu-
ally checked each name and excluded those that were not
black lists.
Table 1: Classiﬁcation of DNSBLs used within CSAIL: BLs marked with † only appeared in 2000; those with ∗ appeared in both
2000 and 2004. All others appeared only in 2004
Focus
Known spammers
Open proxies
Open relays
Maintenance
Conservative
Conservative
Conservative
Open relays
Aggressive
Virus/Exploit attackers Aggressive
Country/ISP netblocks
Aggressive
RFC violators
Mix
Commercial
Mix
Mix
Commercial
Unknown
Unknown
†
∗
,
,
list.dsbl.org,
multihop.dsbl.org,
relays.osirusoft.com,
Blacklists
sbl.spamhaus.org,
opm.blitzed.org,
∗
rbl.maps.vix.com
relays.mail-abuse.org
relays.visi.com, relays.orbs.org
unconfirmed.dsbl.org, dnsbl.sorbs.net,
xbl.spamhaus.org, cbl.abuseat.org,
{argentina,att,...}.blackholes.us,
dul.dnsbl.sorbs.net,
blackholes.easynet.nl, dialups.mail-abuse.org,
{dsn,ipwhois,whois,abuse,postmaster,bogusmx}.rfc-ignorant.org,
sbl-xbl.spamhaus.org, bl.spamcop.net, dnsbl.njabl.org,
hil.habeas.com, sa-hil.habeas.com, query.bondedsender.org,
sa-other.bondedsender.org, sa-trusted.bondedsender.org,
†
rbl.dorkslayers.com
†
,
dul.maps.vix.com
dynablock.easynet.nl,
, relays.ordb.org,
, rbl.debian.net,
Table 2: Statistics for DNSBL-related DNS trafﬁc
Total DNS lookups
DNSBL-related lookups
Total root lookups
DNSBL-related root lookups
Total DNS packets
DNSBL-related packets
7 Dec 2000
572,936
2,238 (0.39%)
38,184
2 (0.01%)
1,196,042
2,396 (0.20%)
8 Dec 2000
519,422
2,069 (0.40%)
35,369
0 (0.00%)
1,091,130
2,169 (0.20%)
19 Feb 2004
3,428,816
487,077 (14.21%)
301,042
45 (0.01%)
5,618,333
519,415 (9.25%)
20 Feb 2004
3,282,231
458,211 (13.96%)
286,324
49 (0.02%)
5,245,229
488,859 (9.32%)
• Using the resulting 31 DNSBLs, we identify a lookup as
DNSBL related if a DNS query name is of the form listed
above or ends with dsn.rfc-ignorant.org (a black
list that operates on domain names).
Table 2 summarizes DNSBL related DNS lookups seen in each
trace.1 While DNSBL related lookups are only less than 0.4% of
the total number of lookups in December 2000, they are now about
14% of all DNS lookups, which makes up about 9% of the entire
DNS trafﬁc in February 2004.
DNSBLs do not affect the root servers much — most DNSBLs
have well replicated name servers, and each client has cached con-
tact information of an authoritative server for each DNSBL. As
shown in Table 2, DNSBL related root lookups account for less
than 0.02% of the total root lookups in 2004 even though DNSBL
related lookups are almost 14% of total DNS lookups. The dis-
proportionate increases between DNSBL related root lookups and
DNSBL lookups is due to name server caching, which we discussed
in detail in our previous paper [11]. In fact, the time-to-live (TTL)
for most DNSBLs’ authoritative name server records is on the or-
der of 1 to 2 days. This long TTL allows clients to directly con-
nect to one of the DNSBL’s authoritative name servers in resolving
DNSBL queries, bypassing the root-servers.
3.2 Inbound SMTP Trafﬁc
We use Bro [15] to pre-process raw TCP packet traces, which
provides a succinct summary of each TCP connection including a
source IP address, a destination IP address, bytes transmitted by
each end point, and the connection status. We consider only estab-
1We noticed that IPv6 related lookups increased tremendously in
February 2004 datasets, most of which failed to elicit an answer.
Given the query names of these IPv6 lookups, we believe that they
are “sysqueries” from BIND8/9 asking for IPv6 addresses of au-
thoritative name servers.
lished or rejected inbound Simple Mail Transfer Protocol (SMTP)
connections for this analysis. While our trace includes unanswered
SYN packets, those are most likely generated by port scanners, and
not by the remote mail servers that we wish to characterize in this
study.
3.2.1 SMTP Growth
Inbound SMTP trafﬁc to CSAIL increased signiﬁcantly between
December 2000 and February 2004. Comparing daily inbound
SMTP trafﬁc to CSAIL between those two collection periods, we
see that the email trafﬁc volume increased by 8.7 times (row 6 in
Table 3). The number of successful inbound SMTP connections2
increased by 11.9 times (row 5 in Table 3). We expect that most of
these inbound connections are likely spam-related. This hypothesis
is supported by statistics from a major anti-spam company indicat-
ing that as of April 2004, 64% of all mail sent over the Internet is
spam, up from 48% in May 2003 [9].
We ﬁnd that more than 70,000 distinct remote hosts attempted
to make an SMTP connection to less than 200 local CSAIL hosts
in February 2004 (row 1 in Table 3). This is 15.2 times more re-
mote hosts than observed in December 2000 when fewer than 5,000
remote hosts attempted to deliver emails through the local hosts at
CSAIL. Figure 1 shows the number of inbound connection attempts
(including rejected connection attempts) per each remote host ini-
tiating them. Both plots from December 2000 and February 2004
traces show a very long tail; over 80% of remote hosts made less
than 10 connection attempts across all datasets, 40% of which made
only one connection attempt per day. We note that this large num-
ber of distinct remote hosts initiating inbound SMTP connections
results in signiﬁcant amount of outbound DNS trafﬁc to DNS black
lists.
2We consider a connection attempt successful if the connection is
established and then later terminated with FIN packets.
Table 3: Summary of inbound SMTP trafﬁc
1
2
3
4
5
6
Remote hosts initiating inbound connections
Local hosts answering inbound connections
Total attempted inbound connections
Total rejected inbound connections
Total successful inbound connections
Total Kbytes transmitted
7 Dec 2000
4,334
117
29,303
4,513