这里以节点node-racl为例。下面是操作过程：
2）执行删除脚本。首先在集群中的所有节点上执行SORA_CRS_HOME/install/rootdelete.
1）在卸载CRS之前，必须停止CRS服务，即执行：
安装CRS非常简单，但是如果CRS出现问题，需要重新安装时，卸载CRS并不是一件
0485760 bytes (10 MB) copied,3.84383 seconds,2.7 MB/s
2560+0 records
560+0 records
Verifying existence of ocr.loc file
[root@node-rac1 instal1]#/app/oracrs/product/11.0.6/crs/instal1/rootdeinstal1.sh
然后重启系统。
/etc/init.d/init.crs disable
如果无法停止CRS服务，那么就将CRS服务禁用，即执行：
/etc/init.d/init.crs stop
7）用“crsctl start crs”命令启动CRS服务。
6）检查OCR设置信息，看是否增加成功。
5）执行“ocrconfig-import”命令将OCR备份信息导入磁盘。
4）修改/etc/oracle/ocr.loc文件，添加新增的RAW设备，例如：
3）执行“ocrconfig-export”命令导出OCR的信息。
着，在集群中的任意一个节点上执行$ORA_CRS_HOME/instal/rootdeinstall.sh。
60+0
emoving contents
local_only=FALSE
ocrmirrorconfig_loc=/dev/raw/raw1
ocrconfig_loc=/dev/raw/raw1
[oracleanode-racl-]$more /etc/oracle/ocr.loc
快速卸载CRS
www.Linuxidc.com
out
5
out
from
OCR device
copied, 3.90308 seconds, 2.7 MB/s
n OCR mirror device
---
## Page 426
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
且也优化了性能。同时，利用ASM可以在线增加数据库的大小，而无需关闭数据库。
13.6.1
也提供了文件系统到卷管理器的集成。
ASM管理数据文件，DBA不用再担心I/O性能问题，也不需要知道文件的名称，同时ASM
13.6ASM基本操作维护
手动删除未卸载的一些文件。在集群的所有节点上执行如下删除命令：
ASM可以在所有可用的磁盘中自动调整I/O负载，不但避免了人工调整I/O的难度，而
1.自动调整V/O负载
ASM（自动存储管理）是一个专门为Oracle数据库服务的数据文件存储机制，通过
所有操作执行完毕后，重启集群的每个节点，重新安装CRS即可。
rm -f /etc/oratab
4）CRS卸载程序可以删除大部分安装程序，但是并不能完全卸载安装程序，所以需要
cm
/bin/rm
/bin/rm-rf
-rf
ASM的特点
-f/etc/oraInst.loc
www.Linuxidc.com
Click“Installe
/var/tmp/.oracle
Welcome
Youhave the fcllewng Oracle
Con
Beip
图13-61卸载CRS
duc11.06/cr
Inventory
please
Dtans..
checkthe
Remove
items
so
ionof
118
集群411
---
## Page 427
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
磁盘组中存储的文件。图13-63显示了ASM的一般体系结构。
还可以向数据库实例传递有关文件布局的信息。通过这种方式，数据库实例就可以直接访问
实例不会装载数据库，启动它的目的是为了管理磁盘组和保护其中的数据。同时，ASM实例
分个Oracle数据块的。
的最小连续磁盘空间，因此，ASM是不允许跨分配单元拆
这个结构的底层是Oracle数据块，由于AU是ASM分配
ASM磁盘按照AU进行分区，每个AU的大小为1MB：
（分配单元），AU是ASM磁盘组分配的最小连续磁盘空间
组，但每个ASM磁盘只能属于一个磁盘组；接着是AU
三部分是ASM磁盘，多个ASM磁盘组成了ASM磁盘
并且单个数据库可以使用来自多个磁盘组的存储空间；第
一个磁盘组中可以包含属于多个数据库的多个ASM文件，
文件，每个ASM文件只能包含在一个磁盘组中，不过，
实例和数据库实例可以直接访问这些磁盘组：然后是ASM
13.6.2ASM的体系结构与后台进程
再需要，就会被自动删除。但是，ASM不管理二进制文件、跟踪文件、预警日志和口令文件。
还可以调节数据的负载均衡速度。
均分配每个文件的AU。
从图13-62可以看出，在顶层是ASM磁盘组，ASM
图13-62显示了ASM的物理构成。
ASM存储支持Oracle数据文件、日志文件、控制文件、归档日志、RMAN备份集等。
6.支持各种Oracle数据文件
ASM通过磁盘组镜像可以实现数据余，不需要第三方工具。
5.数据余
在ASM存储管理中，Oracle数据文件是ASM自动管理的。ASM创建的任何文件一且不
4.自动管理数据库文件
当共享存储设备有变化时，，
3.在线自动负载均衡
ASM将文件分为多个分配单元（AllocationUnits，AU）进行存储，并在所有磁盘间平
2.条带化存储
要使用ASM，需要在启动数据库实例之前，先启动一个名为“+ASM”的实例，ASM
Linuxidc.com
ASM中的数据会自动均匀分配到现有存储设备中。同时，
图13-62
AU（分配单元）
ASM的物理构成
物理数据块
ASM磁盘
ASM文件
ASM磁盘组
---
## Page 428
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
已有讲述，这里不再多说。第二种方法是用命令行方式创建ASM实例，下面进行简单介绍。
ConfigurationAssistant（DBCA），然后根据提示即可创建一个ASM实例，此种方式在前面
色，即SYSASM，此角色只用于管理ASM实例。
理功能，对ASM实例进行管理需要具备SYSDBA权限，在Oracle1lg中可以使用一个新角
13.6.3
ASMB。RBAL负责打开磁盘组中所有磁盘和数据，而ASMB负责和ASM实例进程通信
程，例如LGWR、SMON、PMON、DBWR、CKPT等。
盘组的重新平衡活动。除此之外，ASM实例还有一些与数据库实例中的进程相同的后台进
个实例之间就可以通过这条连接定期交换信息，同时这也是一种心跳监控机制。
过CSS获得管理该磁盘组的ASM实例连接串，然后建立一个到ASM的持久连接，这样两
运行在每个数据库实例上，是两个实例间信息交换的通道。ASMB进程先利用磁盘组名称通
在使用ASM作为数据存储时，ASM实例管理显得非常重要，Oracle提供了丰富的管
如果一个数据库实例使用ASM作为存储，那么它将多出两个后台进程，即RBAL和
另外，在ASM实例中还存在另外一个新的进程，即RBAL，此进程负责规划和协调磁
可以使用RAID划分的LUN、分区和裸设备等来创建ASM磁盘，但是在使用LUN、分
（1）创建ASM磁盘
创建ASM实例有两种方法，第一种是利用dbca创建，这种方法只需运行Database
1.创建ASM实例
从图13-63可以看出，ASM实例与数据库实例进行通信的桥梁是ASMB进程，此进程
管理ASM实例
www.Linuxidc.com
DBWR
RBAL
数据
SM磁
库实例
图13-63
SID=racdb1
ASMB
ASM的一般体系结构
SID=+ASM
ASM实例
RBAL
ASM磁
413
---
## Page 429
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
让另外一个节点来获取这种变化。
备
是否已经自动加载。
讲述这种方法。
过。另外一种简单的方法就是使用Oracle提供的ASMLib来完成ASM磁盘的创建，下面将
区或裸设备时，要注意将属主和属组改为Oracle用户及其对应的组，这个在前面已经讲述
414
在创建ASM实例之前，首先应该确保节点上已经安装了ASMlib包，同时确认ASMLib
到此为止，ASM磁盘已经创建完毕了。
[root@node2 ~]#/etc/init.d/oracleasm scandisks
在RAC环境中，要注意另外一个节点是否能够发现对应的ASM磁盘，执行如下命令，
Removing ASM disk “ASMdisk5"[OK ]
[root@nodel ~]#/etc/init.d/oracleasm deletedisk ASMDISK5
如果要删除ASM磁盘可通过以下命令：
ASMDISK5
ASMDISK4
ASMDISK1
[root@node1 -]#service oracleasm listdisks
也可以通过如下方式查看：
orw-rW--
brw-rw-..-
orw-rw----
[root@node1~]#11/dev/oracleasm/disks/AsMDIsK*
可以采用的命令如下：
创建完ASM磁盘后，
Marking disk "/dev/sdc9"as an ASM disk[OK ]
[root@node1 -]#/etc/init.d/oracleasm createdisk ASMdisk5 /dev/sdc9
Marking disk "/dev/sdc8"
[root@nodel -]#/etc/init.d/oracleasm createdisk AsMDISK4
Marking disk
[root@nodel -]#/etc/init.d/oracleasm
Marking disk "/dev/sdc6"
Marking disk "/dev/sdc5" as an ASM disk [ OK ]
[root@node1 -]#/etc/init.d/oracleasm createdisk ASMDISK1 /dev/sdc5
然后，通过ASMlib提供的oracleasm将已经划分好的磁盘分区转化为ASM磁盘。例如：
oracleasm
[root@node1 -]#1smod
www.Linuxidc.com
1
1
1 oracle
1 oracle oinstal1 8,21 Sep 10 23:40
oracle oinstall 8,
oracle
"/dev/sdc7"
oinstall
oinstall
oinstall
可以查看系统的/dev/oracleasm/disks/目录下是否已经生成磁盘设
|grep
46356
an ASM disk [
8.
8,
oracleasm
25 Sep
22Sep
Sep
10 23:40/dev/oracleasm/disks/ASMDISK5
10
23:40
23:40
OK
OK
/dev/oracleasm/disks/ASMDISK4
/dev/oracleasm/disks/AsMDISK
/dev/oracleasm/disks/AsMDISK2
/dev/oracleasm/disks/ASMDISK1
：ASMDISK3 /dev/sdc7
/dev/sdc
---
## Page 430
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
务，否则，在启动ASM实例时会报如下错误：
启动CRS后CSS已经运行，而在单实例环境下，需要以root用户运行脚本，初始化CSS服
自动分配和自动管理。
ORA-29701:unable to connect to Cluster Manager
无论在RAC环境中还是单实例环境，ASM实例都需要用到CSS进程，在RAC环境中，
2.启动ASM实例
oracle@nodel
oracle@nodel~]
（4）创建目录结构
oracle@node1-]$orapwd file=orapw+ASM
oracle@node1~]$ cd $ORACLE_HOME/dbs
[oracle@node1 -]Ssu-oracle
（3）创建密码文件
asm_diskstring，
口asm_diskgroups，指定实例启动时可用的ASM磁盘组，ASM实例将在启动时自动挂
口ASM_POWER_LIMIT，该参数用来控制ASM中数据的负载均衡速度。
口DB_UNIQUE_NAME，指定ASM实例的名称，默认是+ASM。
口cluster_database，指定是否是数据库集群，true表示是ASM集群。
口instance_type，指定实例的类型，对于ASM实例，
每个参数的含义如下：
asm_diskstring='/dev/oracleasm/disks/*1
sm_diskgroups=′FLASH_DISK','ARCH_DISK','DATA_DISK
large_pool_size=60M
ASMPOWER_LIMIT=1
DB_UNIQUE_NAME=+ASM
cluster_database=true
instance_type=asm
下面介绍ASM实例初始化参数。
启动ASM实例只需要如下几个参数即可，利用这些参数可以实现ASM实例的内存的
oracle@node1
oracle@node1
oracle@nodel
oracle@nodel
NULL，则ASM实例可见的所有磁盘都可以成为创建磁盘组的可选磁盘。
（2）初始化参数
载这些磁盘组。
的，因此large_pool_size至少要8MB，建议越大越好。
www.Linuxidc.com
L
L
：用于限制ASM实例可用于创建磁盘组的磁盘设备。如果该值为
$mkdir
$mkdir -p $ORALCE_BASE/admin/+ASM/adump
$mkdir -p SORALCE_BASE/admin/+ASM/bdump
$cd $ORACLE HOME/dbs
$su -
oracle
-p SORALCE_BASE/admin/+ASM/cdump
password=oracle
，应设置为ASM。
群
415
---
## Page 431
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
除现有的磁盘组。
加新的磁盘组，可以修改现有的磁盘组，在其中添加一个磁盘或者删除一个磁盘，也可以删
SQL> create diskgroup DATA_DIsK normal redundancy disk /dev/oracleasm/disks/
Diskgroup created.
Diskgroup created.
SQL> create diskgroup FLASH_DISK external redundancy disk/dev/oracleasm/disks/
（1）添加磁盘组
ASM磁盘组是作为逻辑单元进行统一管理的一组磁盘，在ASM实例中，可以创建和添
3.管理ASM磁盘组
因为首次启动ASM实例并没有创建ASM磁盘组，所以显示15110错误是正常的。
ORA-15110: no diskgroups mounted
Variable Size
Fixed Size
Total System
[oracle@node1 ~]Sexport ORACLE_SID=+ASM
然后启动ASM实例。
Cluster Synchronization Services is active on all the nodes
Cluster Synchronization Services is active on these nodes
Checking the status of n
Adding
Cleaning up Network socket directories
Configuration for local css has been initialized
Operation successful.
Vetc/oracle does not exist.Creating it now.
[root@node1-]#$ORACLE_HOMB/bin/localconfigadd
执行初始化脚本的过程如下：
ASMDISK4'
ASMDISK2'name archdisk1;
ASMDISK1'name flashdisk;
node1
create diskgroup ARCH_DIsK external redundancy disk
to inittab
name datadiskl,
Global Area
started
~]$sqlplus/ as sysdba
mons to be up within 600 seconds.
to init within 30 seconds
'/dev/oracleasm/disks/ASMDISK5'name datadisk2;
25165824 bytes
107833780 bytes
1218124 bytes
134217728 bytes
'/dev/oracleasm/disks/
---
## Page 432
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。