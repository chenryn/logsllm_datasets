# OSPF Vulnerability to Persistent Poisoning Attacks: A Systematic Analysis

**Authors:**
- Gabi Nakibly, CS Department, Technion - IIT
- Adi Sosnovich, CS Department, Technion - IIT
- Eitan Menahem, Cyber Security Labs, Ben-Gurion University (Currently at IBM’s Cyber Security Center of Excellence, Israel)
- Ariel Waizel, Cyber Security Labs, Ben-Gurion University
- Yuval Elovici, Cyber Security Labs, Ben-Gurion University

## Abstract
Open Shortest Path First (OSPF) is one of the most widely deployed interior gateway routing protocols on the Internet. The primary attack vector against OSPF involves spoofing routing advertisements on behalf of a remote router. OSPF employs a self-defense "fight-back" mechanism to quickly revert the effects of such attacks. However, certain attacks can evade this mechanism, allowing for persistent falsification of routing advertisements. These attacks pose a significant threat as they enable an attacker to gain persistent control over network traffic routing.

This paper systematically analyzes the OSPF specification, both manually and through formal verification, to identify additional vulnerabilities in the fight-back mechanism. Our analysis uncovered a fundamental security flaw that allows an attacker to evade the fight-back mechanism. Major router vendors have acknowledged the existence of this vulnerability in their products. Our findings strongly suggest that no other vulnerabilities in the fight-back mechanism are likely to exist.

**Categories and Subject Descriptors:**
- C.2.2 [Computer Systems Organization]: Computer Communications Networks—Network Protocols, Routing Protocols
- C.2.0 [Computer Systems Organization]: General—Security and Protection
- D.2.4 [Software]: Software Engineering—Software Verification, Model Checking

**General Terms:**
- Security, Verification

**Keywords:**
- Routing Security, OSPF, Formal Verification

## 1. Introduction
Open Shortest Path First (OSPF) is one of the most popular interior gateway routing protocols on the Internet. It enables routers within a single autonomous system (AS) to construct their routing tables dynamically, adapting to changes in the AS's topology. OSPF is widely used and was developed and standardized by the IETF's OSPF working group. This work focuses on version 2 of the protocol, designed for IPv4 networks, while version 3, designed for IPv6, has seen limited deployment.

OSPF is a link-state routing protocol, where each router advertises its links and associated costs to neighboring routers. These advertisements, known as Link State Advertisements (LSAs), are flooded throughout the AS. Each router builds an identical database of LSAs, which it uses to construct a complete view of the AS topology and calculate the least-cost paths using Dijkstra's algorithm. This process forms the router's routing table.

The most common attack vector against OSPF is LSA falsification, where an attacker advertises false link information. This can poison the routers' view of the AS topology, affecting their routing tables. While the fight-back mechanism in OSPF is designed to counter such attacks, vulnerabilities in this mechanism can allow persistent poisoning. This paper presents a systematic analysis to uncover and validate these vulnerabilities.

## 2. OSPF Basics
OSPF is a link-state routing protocol where each router advertises its links and associated costs to neighboring routers. These advertisements, known as Link State Advertisements (LSAs), are flooded throughout the AS. Each router compiles all received LSAs into a single database, from which it constructs a complete view of the AS topology and calculates the least-cost paths using Dijkstra's algorithm. Each router is identified by a unique router ID, typically the IP address of one of its interfaces.

### 2.1 OSPF's Security Strengths
OSPF has several security strengths that make it difficult for an attacker to persistently and significantly poison the routing table of a router it does not control:

1. **Flooding:** Every LSA is flooded throughout the AS, ensuring that a false LSA will eventually be received by the router on whose behalf it was advertised.
2. **Fight-Back Mechanism:** When a router receives a false instance of its own LSA, it immediately advertises a newer instance, canceling out the false one.

These properties, combined, should prevent an attacker from persistently and stealthily falsifying an LSA of a router it does not control.

## 3. Threat Model
We adopt a common threat model found in the literature, assuming the attacker can send LSAs to at least one valid router in the AS, which processes them as valid. This can be achieved by an insider who gains control over a single router in the AS. We do not assume the compromised router is centrally located or a core router.

## 4. Known Attacks
Several known attacks exploit vulnerabilities in the design of OSPF's fight-back mechanism. These attacks allow an attacker to persistently control the routing tables of all routers in the AS, potentially diverting traffic for eavesdropping or alteration. Two such vulnerabilities were discovered in recent years, highlighting the need for a thorough analysis of the OSPF specification.

## 5. Manual Analysis
Our manual analysis began by characterizing the general properties a vulnerability must have to allow an attacker to evade the fight-back mechanism. This was followed by a targeted manual analysis of the specification, which uncovered a new security weakness. This weakness is even more powerful and simpler than previously known vulnerabilities. We verified the vulnerability on Cisco and RouterOS, and it has been reported to CERT/CC, who relayed it to major OSPF router vendors. Many vendors acknowledged the vulnerability and released appropriate patches. The vulnerability is identified by CVE-2013-0149.

### 5.1 Comparison with Previous Vulnerabilities
The newly discovered vulnerability is more powerful and simpler compared to previously known vulnerabilities. It allows an attacker to persistently control the routing tables of all routers in the AS, making it a significant threat.

### 5.2 Severity and Mitigation
The severity of this vulnerability is high, as it allows an attacker to gain complete control over the routing of traffic within the AS. Mitigation measures include implementing stronger authentication mechanisms and regular security audits.

## 6. Formal Verification
To formally validate that no other fight-back evasion vulnerabilities exist in OSPF, we modeled the fight-back mechanism and used a model checker to search for the same properties identified in the manual stage. The model checker confirmed the newly discovered vulnerability and did not find any additional vulnerabilities, providing strong evidence that there are no other weaknesses in the OSPF specification.

## 7. Conclusion
This paper presents a systematic analysis of the OSPF specification, uncovering a fundamental security flaw that allows an attacker to evade the fight-back mechanism. Major router vendors have acknowledged this vulnerability, and appropriate patches have been released. Our formal verification provides strong evidence that no other vulnerabilities in the fight-back mechanism are likely to exist.

---

**Permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page. To copy otherwise, to republish, to post on servers or to redistribute to lists, requires prior specific permission and/or a fee.**

**ACSAC December 8-12, 2014, New Orleans, Louisiana, USA. Copyright is held by the owner/author(s). Publication rights licensed to ACM. Copyright 2014 ACM 978-1-4503-3005-3/14/12. http://dx.doi.org/10.1145/2664243.2664278 ...$15.00**