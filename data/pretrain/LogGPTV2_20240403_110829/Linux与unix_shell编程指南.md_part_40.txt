浏览上述表单并使用p o s t方法来发送数据：
h t t p : / /  / c g i - b i n / b o o k a . c g i
图2 9 - 11显示了我所输入的信息。
在输入一些信息之后，点击“发送”按钮，结果如图 2 9 - 1 2所示。
该脚本检查各个变量，看是否有相应的信息输入。还可以做进一步的改进，检查所有变
量的值，如果用户没有在某个输入域输入任何信息，那么就重新向用户显示该表单，要求用
户重新输入。如果用户提供了填写正确的表单，可以把它们附加在一个文件的末尾，创建一
加入java编程群：524621833
343
第29章 cgi 脚 本
下载
个微型的数据表。
图29-11 使用post方法的cgi表单
图29-12 使用post方法所获得的数据被完全解码
3. 一个更为实用的c g i脚本
我们现在创建一个更为实用的脚本。这里我们虚构一个名为 Wonder Gifts的公司，按照用
加入java编程群：524621833
344
第五部分 高级s h e l l编程技巧
下载
户的选择显示该公司的报表。
一个会计文件包含了该公司 1 9 9 8年每一个季度每一个部门的销售额。该文件中包含下列
部门：文具、图书、礼品。
我们的任务是按照用户的选择生成一个报表。用户可以按照季度或部门进行选择。收到
用户选择后的处理过程就是，将所选择的部门和季度中所有月份的销售额加在一起。输出可
以是屏幕、打印机或两者皆有。
我们的表单有两个下拉式列表框，一个用来选择部门，一个用来选择季度。有一个单选
框用于选择输出形式。使用单选框时，用户只能选择其中之一。实际上报表只输出到屏幕上，
这里的单选框只是一个演示。
下面就是原始的数据文件，它包含以下的域：
部门：年：季度：该季度1至3月份的销售额
下面是表单脚本。
加入java编程群：524621833
345
第29章 cgi 脚 本
下载
其中，变量d e p t将保存用户所选择的部门；而变量 q t r用于保存用户所选择的季度。变量
s t d o u t可能出现的值有p r i n t e r、s c r e e n、b o t h，缺省为屏幕(缺省值由关键字C H E C K E D指定)。
下面的脚本用于处理所接收到的信息。
加入java编程群：524621833
346
第五部分 高级s h e l l编程技巧
下载
该脚本的第一部分和其他使用p o s t方法的表单处理脚本没有什么区别。由于这里没有 1 6进
制字符需要转换(因为输入域都是预定义的下拉式列表框 )，就不需要使用p r i n t f命令，不过你
完全可以使用该命令。这里有意思的部分就是从q t r _ 1 9 9 8 . t x t文件中读入信息的一段。
在w h i l e循环中分别将原始文件中的几个域赋给变量D E P T、Y E A R、Q、P 1、P 2、P 3、P 4。
然后比较$ d e p t (这个值是由用户给出)和变量D E P T的值；如果匹配，再比较$ q t r (这个值由用户
给出)和变量Q的值，如果也匹配，那么就将这一行中的所有数据相加。
现在我们已经有了表单脚本和处理表单所发送的信息的脚本，现在来试着运行它。在浏
览器的U R L框中输入如下的U R L (或在主页中加入另外一个链接)：
h t t p : / /  / c g i - b i n / g i f t s . c g i
结果如图2 9 - 1 3所示。
图29-13 选择季度信息供进一步处理
加入java编程群：524621833
347
第29章 cgi 脚 本
下载
对用户输入信息处理后返回的页面如图2 9 - 1 4所示。
图29-14 处理结果
29.5.3 填充列表项
要想使页面成为真正的动态页面，可能需要动态地使用某个文件中的信息来填充列表项，
而不是把它们编写进c g i脚本。
在下面的脚本中，下拉式列表框中的选项是由 l i s t文件中的信息填充的，该文件位于 We b
服务器根目录下的t e m p目录中。在这个脚本中，使用了一个w h i l e循环来读入文件中的内容(一
次读入一行)，并将读入的信息填充到列表框选项中。相应的填充语句为：
echo "$LINE"
被用户选择的项赋给变量m e n u _ s e l e c t i o n。
下面就是填充下拉式列表框的脚本，这里没有指定表单的操作。
加入java编程群：524621833
348
第五部分 高级s h e l l编程技巧
下载
29.5.4 自动刷新页面
在使用c g i脚本实现监视或看门狗功能时，如果能够让页面不断自动刷新就方便多了。想
要实现这样的功能，需要不断调用自己的脚本或页面。下面的命令将每隔 6 0秒刷新一次
d f s p a c e . c g i脚本。
这里的关键字是R e f r e s h。这样We b服务器就知道应该重载该页面。c o n t e n t = 6 0则表示每次
刷新的间隔秒数。只要在U R L中包含相应的脚本名就能够不断刷新该页面。
我有好几个监视脚本在实时运行，它们不断轮询网络中所有的主机，这样我一眼就能够
看出每个机器是处在运行状态还是关闭状态。为了更美观，我使用了一个红色的小球和一个
绿色的小球来分别代替文字o n和o ff。
下面的脚本在一张表中显示出d f命令输出中的两列：磁盘占用情况和文件系统名。
下面的一段只显示了表头。在使用表格显示系统命令输出结果时，需要经过反复调整才
能达到令人满意的效果。
c e l l s p a c i n g设置了表格内框和外框的间距。 b o r d e r则用于控制表格的边框宽度。 c o l s决定
了表中所显示的列数。
下面是该脚本的实质部分：
在上面一段脚本中，使用d f命令显示文件系统的情况，并将结果通过管道传递给 s e d命令，
删除其中的题头，然后再通过管道将结果传递给a w k命令，取其中的第5、6列，将结果分别赋
给变量p e r c e n t和m o u n t。
T R代表表格行，T D代表表格数据。这是表格中存放信息的地方。
的确，对于监视文件系统来说， 6 0秒刷新一次有些太夸张了，但是如果你正在文件系统
间进行大文件的迁移，这个脚本就能够使你掌握每一分钟的最新情况！
下面就是该脚本。
加入java编程群：524621833
349
第29章 cgi 脚 本
下载
在你浏览器的U R L框中输入如下的U R L：
h t t p : / /  / c g i - b i n / d f s p a c e . c g i
你就会看到如图2 9 - 1 5所示的输出(在你的机器上所看到的文件系统状态多半与此不同 )。
图29-15 使用表格实时显示df命令的输出
29.6 小结
使用c g i脚本可以创建更为有趣的用户界面。H T M L页面可以作为任何处理过程的前端界面。
我们可以编写用于监视、显示、数据库查询等的脚本。 H T M L现在已经成为很多应用程
序文挡的标准格式。
加入java编程群：524621833
下载
附录 常用shell命令
本附录中列举了一些有用的 s h e l l命令。这里并没有完全列出每个命令的各种选项，不过
对于理解该命令是足够了。
这些命令的其他一些例子散布于本书的各个部分。
basename
格式：
basename path
b a s e n a m e命令能够从路径中分离出文件名。通常用于s h e l l脚本中，请看下面的例子：
如果上面的语句是脚本m y s c r i p t中的一部分，那么它的输出应为：
myscript: give me a file
其中，$ 0是一个包含当前脚本全路径的特殊变量。
cat
格式：
cat options files
选项：
- v：显示控制字符。
c a t是最常用的文本文件显示命令。
$ cat myfile
上面的命令用于显示m y f i l e文件。
$ cat myfile myfile2 >>hold_file
上面的命令把两个文件( m y f i l e和m y f i l e 2 )合并到h o l d _ f i l e中。
在脚本中c a t命令还可以用于读入文件。
compress
格式：
加入java编程群：524621833
351
附录 常用s h e l l命令
下载
compress options files
选项：
- v：显示压缩结果。
c o m p r e s s命令可以用来压缩文件。压缩后的文件名具有‘. Z’后缀。还可以使用该命令解
压文件。
cp
格式：
cp options file1 file2
选项：
- i：在覆盖文件之前提示用户，由用户确认。
- p：保留权限模式和更改时间。
- r：拷贝相应的目录及其子目录。
要将文件m y f i l e拷贝到m y f i l e 1 . b a k，使用：
$ cp myfile1 myfile1.bak
要将文件g e t . p r d从/ u s r / l o c a l / s y b i n目录拷贝到/ u s r / l o c a l / b i n目录，使用：
要将/ l o g s目录下的所有文件及子目录拷贝到/ h o l d / l o g s目录中，使用：
$ cp -r /logs /hold/logs
diff
格式：
diff options file1 file2
选项：
- c：按照标准格式输出(见下面的例子)。
- I：忽略大小写。
我们使用c o m m命令中的例子，d i ff命令将显示两个文件中不一致的行。
d i ff命令显示出两个文件中的第2行和第3行，它们的第3列不一致。
dircmp
格式：
加入java编程群：524621833
352
附录 常用s h e l l命令
下载
dircmp options directory1 directory2
选项：
- s：不显示相同的文件。
d i r c m p命令与d i ff命令十分相似—它比较并显示两个目录中的不同。
dirname
格式：
dirname pathname
该目录正好和b a s e n a m e相反，它返回路径部分：
du
格式：
du options directory
选项：
- a：显示每个文件的大小，不仅是整个目录所占用的空间。
- s：只显示总计。
d u显示的磁盘空间占用是以5 1 2字节的块来表示的。它主要用于显示目录所占用的空间。
在本例中，/ v a r目录所占用的空间为1 4 9 2 9块(每块5 1 2字节)。
file
格式：