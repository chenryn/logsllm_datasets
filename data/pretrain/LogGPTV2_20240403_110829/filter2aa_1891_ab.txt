   RHOST    172.16.194.134   yes       The target address 
   RPORT    445              yes       Set the SMB service port 
   SMBPIPE  BROWSER          yes       The pipe name to use (BROWSER, 
SRVSVC) 
Exploit target: 
   Id  Name 
   --  ---- 
   0   Automatic Targeting 
msf exploit(ms08_067_netapi) > check 
[*] Verifying vulnerable status... (path: 0x0000005a) 
[*] System is not vulnerable (status: 0x00000000) 
[*] The target is not exploitable. 
msf  exploit(ms08_067_netapi) > 
connect 
msfconsole 有一个小型的 netcat 克隆体，支持 SSL，proxies，pivoting，file 
sends。’connect’命令加 IP 地址和 Port，你就可以在 msfconsole 中与远程主机
建立连接，等效于 netcat 和 telnet。 
msf > connect 127.0.0.1 21 
[*] Connected to 127.0.0.1:21 
id 
uid=0(root) gid=0(root) groups=0(root) 
使用”connect –h”查阅具体参数列表 
msf > connect -h 
Usage: connect [options]   
Communicate with a host, similar to interacting via netcat, taking 
advantage of 
any configured session pivoting. 
OPTIONS: 
    -C        Try to use CRLF for EOL sequence. 
    -P   Specify source port. 
    -S   Specify source address. 
    -c   Specify which Comm to use. 
    -h        Help banner. 
    -i   Send the contents of a file. 
    -p   List of proxies to use. 
    -s        Connect with SSL. 
    -u        Switch to a UDP socket. 
    -w   Specify connect timeout. 
    -z        Just try to connect, then return. 
msf >  
info 
’info’命令可以查看模块的具体信息，包括所有选项，目标主机和一些其他的信息。在使用模块
前，阅读模块相关的信息，有时候会达到不可预期的效果。 
Info 获取的信息有: 
作者和证书信息 
漏洞参考(例如: CVE, BID 等) 
模块使用攻击载荷时的限制 
msf > info exploit/windows/smb/ms10_061_spoolss  
       Name: Microsoft Print Spooler Service Impersonation 
Vulnerability 
     Module: exploit/windows/smb/ms10_061_spoolss 
    Version: 15518 
   Platform: Windows 
 Privileged: Yes 
    License: Metasploit Framework License (BSD) 
       Rank: Excellent 
Provided by: 
  jduck  
  hdm  
Available targets: 
  Id  Name 
  --  ---- 
  0   Windows Universal 
Basic options: 
  Name     Current Setting  Required  Description 
  ----     ---------------  --------  ----------- 
  PNAME                     no        The printer share name to use on 
the target 
  RHOST                     yes       The target address 
  RPORT    445              yes       Set the SMB service port 
  SMBPIPE  spoolss          no        The named pipe for the spooler 
service 
Payload information: 
  Space: 1024 
  Avoid: 0 characters 
Description: 
  This module exploits the RPC service impersonation vulnerability  
  detailed in Microsoft Bulletin MS10-061. By making a specific DCE  
  RPC request to the StartDocPrinter procedure, an attacker can  
  impersonate the Printer Spooler service to create a file. The  
  working directory at the time is %SystemRoot%\system32. An attacker  
  can specify any file name, including directory traversal or full  
  paths. By sending WritePrinter requests, an attacker can fully  
  control the content of the created file. In order to gain code  
  execution, this module writes to a directory used by Windows  
  Management Instrumentation (WMI) to deploy applications. This  
  directory (Wbem\Mof) is periodically scanned and any new .mof files  
  are processed automatically. This is the same technique employed by  
  the Stuxnet code found in the wild. 
References: 
  http://www.osvdb.org/67988 
  http://cve.mitre.org/cgi-bin/cvename.cgi?name=2010-2729 
  http://www.microsoft.com/technet/security/bulletin/MS10-061.mspx 
msf > 
irb 
使用命令’irb’，就可以进入 Ruby 的 shell 接口，这个特性有助于了解 Metasploit 的内部框
架. 
msf > irb 
[*] Starting IRB shell... 
>> puts "Metasploit-Ruby Shell" 
Metasploit-Ruby Shell 
=> nil 
>> Framework::Version 
=> "4.5.0-dev" 
>> framework.modules.keys.length 
=> 255 
>> 
jobs 
任务指那些运行在后台的模块，’jobs’可以用于列举和终止这些任务。 
msf > jobs -h 
Usage: jobs [options] 
Active job manipulation and interaction. 
OPTIONS: 
    -K        Terminate all running jobs. 
    -h        Help banner. 
    -i   Lists detailed information about a running job. 
    -k   Terminate the specified job name. 
    -l        List all running jobs. 
    -v        Print more detailed info.  Use with -i and -l 
msf >  
load 
load 命令用于从 Metasploit’s 插件目录加载一个插件.使用”key=val”形式来传递
参数. 
msf > load 
Usage: load  [var=val var=val ...] 
Loads a plugin from the supplied path.  If path is not absolute, fist 
looks 
in the user's plugin directory (/root/.msf4/plugins) then 
in the framework root plugin directory (/opt/metasploit/msf3/plugins). 
The optional var=val options are custom parameters that can be passed 
to plugins. 
msf > load pcap_log 
[*] PcapLog plugin loaded. 
[*] Successfully loaded plugin: pcap_log 
loadpath 
’loadpath’命令可以使用指定的路径，加载第三方的模块. 
msf > loadpath /home/secret/modules 
Loaded 0 modules. 
unload 
解除先前加载的模块和扩展的命令。 
msf > unload pcap_log 
Unloading plugin pcap_log...unloaded. 
resource 
’resource’命令可以执行资源(批量)文件 
msf > resource 
Usage: resource path1 [path2 ...] 
Run the commands stored in the supplied files.  Resource files may also 
contain 
ruby code between  tags. 
See also: makerc 
msf > 
有些类似 Karmetasploit 这样的攻击，使用资源文件(karma.rc)来执行一系列的命令。稍后
我们会探讨如何使用。 
msf > resource karma.rc 
[*] Processing karma.rc for ERB directives. 
resource (karma.rc)> db_connect msf3:PASSWORD@127.0.0.1:7175/msf3 
resource (karma.rc)> use auxiliary/server/browser_autopwn 
...snip... 
批量处理的文件极大的加快了开发测试和自动化大量任务的进度，我们也可以使用’-r’来指定一
个批量文件. 
root@kali:~# echo version > version.rc 
root@kali:~# msfconsole -r version.rc 
 _                                                      _ 
/  \  / \        __                          _   __    /_/ __ 
| |\ /  | _____  \ \            ___   _____ | | /   \  _   \ \ 
| | \/| | | ___\ |- -|   /\    / __\ | -__/ | | | |  || | |- -| 
|_|   | | | _|__  | |_  / -\ __\ \   | |    | |_ \__/ | |  | |_ 
      |/  |____/  \___\/ /\  \___/   \/      \__|     |_\  \___\ 
       =[ metasploit v4.5.0-dev [core:4.5 api:1.0] 
+ -- --=[ 936 exploits - 500 auxiliary - 151 post 
+ -- --=[ 252 payloads - 28 encoders - 8 nops 
      =[ svn r15767 updated today (2012.08.22) 
[*] Processing version.rc for ERB directives. 
resource (version.rc)> version 
Framework: 4.4.0-dev.15205 
Console  : 4.4.0-dev.15168 
msf >  
route 
’route’命令，允许通过已建立的会话，建立 route 套接字，提供基本的隧道特性。 
meterpreter > route -h 
Usage: route [-h] command [args] 
Display or modify the routing table on the remote machine. 
Supported commands: 
   add    [subnet] [netmask] [gateway] 
   delete [subnet] [netmask] [gateway] 
   list 
meterpreter > 
meterpreter > route 
Network routes 
============== 
    Subnet           Netmask          Gateway 
    ------           -------          ------- 
    0.0.0.0          0.0.0.0          172.16.1.254 
    127.0.0.0        255.0.0.0        127.0.0.1 
    172.16.1.0       255.255.255.0    172.16.1.100 
    172.16.1.100     255.255.255.255  127.0.0.1 
    172.16.255.255   255.255.255.255  172.16.1.100 
    224.0.0.0        240.0.0.0        172.16.1.100 
    255.255.255.255  255.255.255.255  172.16.1.100 
search 
msfconsole 包含一个基于正则查询的功能.如果你知道你想要查找的内容，你可以通过‘关键字’
来搜索。下面的输出，表明我们完成了一次 MS Bulletin MS09-011 的搜索.这个查询方法会通
过字符串来定位模块名，描述，参考等. 
msf > search ms08_067 
Matching Modules 
================ 
   Name                                 Disclosure Date          Rank   Description 
   ----                                 ---------------          ----   ----------- 
   exploit/windows/smb/ms08_067_netapi  2008-10-28 00:00:00 UTC  great  Microsoft Server 
Service Relative Path Stack Corruption 
help 
你可以使用内置关键字进一步优化你的操作. 
msf > help search 
Usage: search [keywords] 
Keywords: 
  name      :  Modules with a matching descriptive name 
  path      :  Modules with a matching path or reference name 
  platform  :  Modules affecting this platform 
  type      :  Modules of a specific type (exploit, auxiliary, or post) 
  app       :  Modules that are client or server attacks 
  author    :  Modules written by this author 
  cve       :  Modules with a matching CVE ID 
  bid       :  Modules with a matching Bugtraq ID 
  osvdb     :  Modules with a matching OSVDB ID 
Examples: 
  search cve:2009 type:exploit app:client 
msf >  
name 
使用 name 做为关键字进行查询 
msf > search name:http_enum 
Matching Modules 
================ 
   Name                                   Disclosure Date  Rank    Description 
   ----                                   ---------------  ----    ----------- 
   auxiliary/scanner/http/enum_delicious                   normal  Del.icio.us Domain Links (URLs) 
Enumerator 
   auxiliary/scanner/http/enum_wayback                     normal  Archive.org Stored Domain URLs 
msf > 
path 
使用 path 进行关键字查询. 
msf > search path:scada 
Matching Modules 
================ 
   Name                                                 Disclosure Date  Rank     Description 
   ----                                                 ---------------  ----     ----------- 
   auxiliary/admin/scada/igss_exec_17                   2011-03-21       normal   Interactive Graphical SCADA System 
Remote Command Injection 
   exploit/windows/scada/citect_scada_odbc              2008-06-11       normal   CitectSCADA/CitectFacilities ODBC 
Buffer Overflow 
...snip... 
platform 
使用 platform 作为关键字，查找指定平台可用模块. 
msf > search platform:osx 
Matching Modules 
================ 
   Name                                    Disclosure Date          Rank       Description 
   ----                                    ---------------          ----       ----------- 
   exploit/multi/browser/java_rhino        2011-10-18 00:00:00 UTC  excellent  Java Applet Rhino 
Script Engine Remote Code Execution 
   exploit/osx/browser/safari_file_policy  2011-10-12 00:00:00 UTC  normal     Apple Safari file:// 
Arbitrary Code Execution 
type 
使用 type 做为关键字，指定模块类型为 auxiliary， post， exploit 等进行查询. 
msf > search type:post 
Matching Modules 
================ 
   Name                                                  Disclosure Date          Rank    Description 
   ----                                                  ---------------          ----    ----------- 
   post/aix/hashdump                                                              normal  AIX Gather Dump Password 
Hashes 
   post/cisco/gather/enum_cisco                                                   normal  Gather Cisco Device General 
Information 
   post/linux/gather/checkvm                                                      normal  Linux Gather Virtual 
Environment Detection 
   post/linux/gather/enum_configs                                                 normal  Linux Gather Configurations 
author 
以”author”做为关键字查询你最喜欢的作者. 
msf > search author:PI:EMAIL 
Matching Modules 
================ 
   Name                                                Disclosure Date          Rank       Description 
   ----                                                ---------------          ----       ----------- 
   auxiliary/admin/vmware/poweroff_vm                                           normal     VMWare Power Off Virtual 
Machine 
   auxiliary/admin/vmware/poweron_vm                                            normal     VMWare Power On Virtual 
Machine 
   auxiliary/admin/vmware/tag_vm                                                normal     VMWare Tag Virtual Machine 
   auxiliary/admin/vmware/terminate_esx_sessions                                normal     VMWare Terminate ESX Login 
Sessions 
   auxiliary/scanner/mssql/mssql_hashdump  
                                      normal     MSSQL Password Hashdump 
multiple 
可以使用多个关键字进行查询， 
msf > search cve:2011 author:jduck platform:linux 
sessions 