[译] 渗透测试实战第三版(红队版)
译者：Snowming（雪茗） 时间：北京时间 2019-03-17
本书英文名：The Hacker Playbook 3
阅读
在 Github 上阅读本书
免责声明
@Snowming 纯粹出于学习目的与个人兴趣翻译本书。本人承诺绝不用此译文谋取任何形式的经济利益。也坚决拒绝
其他任何人以此牟利。
本译文只供学习研究参考之用，不得用于商业用途。@Snowming 保留对此版本译文的署名权及其它相关权利。
若有人使用本译文进行侵权行为或者违反知识产权保护法的任何行为，与本译者无关。译者坚决反对此类行为。
任何转载必须注明出处。
译者的话
这本书是 The Hacker Playbook  的第三版，通常我们也说它是红队版。因为本书是以红蓝对抗中红队的视角来撰
写的。
首先要说一声抱歉，因为我的翻译可能并不是特别好。首先，整本书是在三周的时间仅由我一个人翻译完的，因为本
人临近硕士毕业，不可能花太多时间来作这件事情。而且这本书的专业程度比较高，并不是一本科普读物。而译者的
专业水平有限，所以可能对本书的理解上也受限于我的专业水平。但是，译者尽力以最大的诚意，来完成此书的翻
译。我寻求的效果是：完成本书作者与中文读者之间的连接。基于此目标，我的翻译原则有以下几条:
1. 对每一个句子，我并非在词义的层面上简单的译为中文,而是按照自己的理解翻译的。我有一种观点：如果那样
的话，与谷歌翻译有什么区别呢？所以我会在词义的基础上，去理解作者的每一句话，查阅相关资料，结合词
义、句意、专业知识背景来翻译。所以读者可以看到，我在一些地方贴出了一些补充资料。我希望我的翻译既
保留作者原意，也更符合中文。其中若有不明之处，我跟几位比我从业经验丰富的安全行业朋友进行了讨论，
毕竟我资历尚浅，若是因为自己的肤浅理解而误导读者，那可真是我的过错了。对每一个句子，只有我自己让
我是可以读懂的，我才会贴上来。
2. 因为中文和英文的确存在差异，并非每一句英文的意思都可以用中文完全表达出同样的意思，不可避免的存在
些个翻译出来比较奇怪的词语。对于这种情况，我会去互联网上基于关键词进行搜索，参考诸如微软中文文档
之类的翻译，最好是遵循他们的翻译惯例。因为毋庸置疑的，专业的微软文档工程师肯定比我的水平高。
3. 译文中所有的链接我自己都点过一遍，虽然我拿到的英文 PDF 有些链接自己都无法访问，但是我尽力还原作者
原意，通过网络搜索找到正确链接贴上。对于其他的过期链接我也会更附上说明。这里必须说明，事实上，不
断的有一些链接失效，仅仅我翻译的这三周，到我今天定稿，就很多失效了。我也只能尽量贴上最新的链接。
4. 一些专业术语保留英文常用习惯，因为毕竟本书不是一本科普书。我身边很多安全从业者，不会把 payload 说
成攻击载荷。所以本书中除第一次遇到 payload 会附注攻击载荷，后面一律使用payload。类似的专业术语还
包括 beacon、POC、AD 等。
5. 一些工具里面的选项保留英文。因为若翻译为中文，可能导致读者无法找到该选项，操作不便，反而弄巧成
拙。
6. 关于【译者注】：我思故我惑。书里也有很多我读不懂的、不太理解的知识盲区。读的时候我会查找相关资
料，但是我就会想，为什么不把我找到的觉得不错的资料分享给读者呢？这就是我的翻译中那些【译者注】的
由来。因为我把这个翻译当作书+笔记本来用了，所以有很多连接那是因为我自己也要看。如果你不看，请忽
略。并且，既然这是中文翻译，所以我分享的参考资料以中文资料为主。英文链接是我觉得特别好的文章才会
附上。
7. 我拿到的英文 PDF 版本，上面的一些代码存在问题。比如这一句书中的原代码 python SharpShooter.py —
interactive 。但是 —  其实应该是 -- 。本书中有多个这种错误。所以根据译者经验： —  如果你跑不通的话，
读者可以自行替换为 -  或 --  来试试，或许就可以跑通了。实在再跑不通的话，可以在网上进行搜索。
8. PDF 版本中，如果用 []  括起来的链接无法访问，请观察 URL，根据情况删除 ] ，一般就可以访问了。
阅读建议
1. 先大概理解每一章讲的是什么，比如：
第一章 环境搭建
第二章 信息收集
第三章 web漏洞利用
第四章 内网横向移动和权限提升
...... 
在心里有个这种朴素的目录，能帮助你读完本书后对红队工作流程心中有数。
2. 根据用途对本书中提到的所有你觉得好的工具建一个速查清单。我觉得你可以参考这篇来建：适用于渗透测试
不同阶段的工具收集整理
3. 本书毕竟是一本外语书，有的工具不适合国内环境。大家自行取舍。
对于本书的一些想法
技术的发展日新月异，所以本书中的一些工具可能有些过时了。我们对本书中的内容无需盲从，可以结合一些自己的
思考。
比如，第七章的内容可能会有些跟不上时代。但其实第七章中重新编译 msf 其实就是为了：
1. 尽可能消除 msf 的流量指纹特征；
2. 强化 msf 的 payload 的一些静态免杀能力；
3. 自定义添加一些功能（和 C2 交互方面，动态执行方面，流量优化方面）。
如果想清楚这个，那么看懂并理解它的操作会简单很多。现在针对攻击框架的二次开发基本都是在这么做，思路一
致，只是实现方式各有不同，但万变不离其宗，我们依然可以从书中的二次开发思路中获得一些启示。
而且本书作者的一个观点，我认为非常有趣。他说：红队的技术是基于 OSI 七层的不断轮回。作者甚至额外加了一个
第八层——社会工程学攻击。如果你看完本书，就会发现，的确，工具有基于物理层的、传输层的......一直到社会工
程学攻击。作者认为，当一切防御措施都做得接近完美的时候，我们仍然可以利用第八层，社会工程学攻击去进行渗
透。而随着新的技术的发展、不断地趋于大和复杂，一些曾经出现过的旧的漏洞又会出现。传统的攻击方法会迸发出
新的生机。
这大概就是我们阅读此类书的目的吧。与其授人以鱼不如授人以渔，一些工具病毒出来不久，就会被安全厂商逆向、
签名。但是如果我们习得了屠龙之术，那么就能以不变应对万变。我从本书中作者的循循善诱中学到了很多，作者不
仅逐步深入，还会跟我们讲为什么编程能力对安全人员很重要、为什么我们需要理解底层......我相信如果你认真读
了，你会跟我一样收获颇多。
关于译文中的错误处理
不可避免的，本书的翻译仍然存在很多问题，大家可以积极提 issue 给我，包括标点符号全角半角的问题也可以提给
我。在此先行感谢。
另外错误的改正情况也会在本仓库的 UPDATE 页面进行实时更新。
特别感谢
在这本书的翻译过程中，我也收获了友谊。为了一个词我们可以讨论很久，这样的同行，让我深深的觉得我没有选错
方向。感谢以下的小伙伴帮我提供校对支持：
哈姆太郎
匿名jack
Victor Zhu
鸫
leitbogioro
也感谢以下的小伙伴原意跟我讨论书上的问题：
鸫
哈姆太郎
匿名jack
googu0
在此对你们提供的帮助表示真诚的谢意。
协议
CC BY-NC-SA 4.0
前言
译者：@Snowming
这是《渗透测试实战》一书的第三版。以下会给出一个基于第二版新增的漏洞和攻击的总结。除了新的内容，本书保
留了之前的版本中现今仍然可以用的攻击和技术，这是为了避免让你再去翻以前的书。除了从以前的书里提取的内
容，这本书还有什么新的内呢？新的内容包括一些过去几年提出来的新话题:
利用活动目录
利用 Kerberos 协议
高级 Web 攻击
更好的横向移动方式
云计算相关漏洞
更快/更高效的密码破解
Living oﬀ the land 技术（意思是入侵者使用系统凭据和合法的软件管理工具访问系统，感染和收集有价值的数
据）
内网漫游攻击
多个定制的实验
较新的 Web 语言漏洞
物理攻击
特权升级
PowerShell 攻击
勒索软件攻击
红队 VS 渗透测试
建立红队基础设施
可用的红队指标
编写恶意软件和免杀
以及更多
此外, 我还试图采纳所有从第一版和第二版书的读者那里收到的评论和建议。我想再次重申, 我不是一个专业作家。我
只是喜欢安全并且想要交流安全, 这本书仅仅是我的兴趣项目。我希望你喜欢它。
本书还将更深入地介绍如何搭建一个测试攻击的实验环境, 以及渗透测试的最新技巧和姿势。最后, 我试图使这个版本
更容易去实践, 因为许多学校已经把这本书纳入他们的课程。 我尽量添加了实验部分, 来给读者提供测试漏洞或利用
漏洞的实践机会。
和其他两本书一样, 我尽量贴近真实的网络环境。我也试图远离理论攻击, 从实际的渗透经验出发。从渗透测试工程师
到红队, 我认为这个行业发生了重大的转变。 我想把这种转变展示给你看, 而不是仅仅告诉你为什么有这些转变。正
如我之前所说, 我的热情是教导和挑战他人。所以我写这本书有两个目的: 第一, 让读者理解攻击者的思维方式，了解
攻击的 "方式"; 第二, 我想让习得学到的工具和技术, 并且扩展他们。阅读和复现实验只是学习任务的一部分。我最想
教给你的是——让你的工作为你的才能代言。我真心觉得,如果你想要在安全方面找到工作。想要与其绞尽脑汁的写
简历 (当然, 你肯定需要准备一个简历), 还不如你的 Github 有丰富的内容，很多公共 Github 项目或者安全方面有影
响力的技术博客。无论你是防御的蓝队成员还是进攻的红色成员，参与安全公共社区，积极分享都是至关重要的。
对于那些没有阅读我以前的两本书的读者, 你可能想了解我的技术背景和经验。我的背景包括超过12年的渗透为主要
金融机构、大型公用事业公司、财富500强公司、娱乐公司和政府组织提供安全测试。我也花了多年的时间在大学教
攻击性的网络安全, 在多个安全会议上发言,在许多安全出版物中引用, 在全国各地教授的课程, 运行了多个公开的 ctf
比赛, 并开始了我自己的安全学校。我的一大兴趣项目是建立一个自由和开放的位于南加州的安全社区，叫做
LETHAL (meetup.com/lethal)。现在, 拥有800多名会员, 每月举行会议, ctf 比赛, 它已成为一个令人兴奋的环境, 人们
在此社区中分享, 学习和成长。
需要提醒读者的是, 在本书中，我同时使用商业工具和开源工具。对于每一个提到的商业工具, 我尽量提供一个对应的
开源工具。我以前听到一些渗透测试工程师说他们只使用开源工具。作为一个专业的渗透测试工程师, 我认为这个说
法难以接受。如果你试图去模仿一个 "真实世界" 的攻击, 骇客们没有这些限制。因此, 你需要使用任何可以完成任务