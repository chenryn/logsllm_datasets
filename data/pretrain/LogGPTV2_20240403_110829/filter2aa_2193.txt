Weaponizing the Web
More Attacks on User Generated Content
Saturday, August 1, 2009
Black Hat USA 2009
Comrades
Citizen: Nathan Hamiel
Senior Consultant - Idea InfoSec
Associate Prof @UAT, Hexagon Security Group
23rd Degree Mason, LavaRolling Enthusiast
Citizen: Shawn Moyer
Principal Consultant - FishNet Security
Douchebag with microphone, self-styled Wikipedian
Shot a man in Reno just to watch him die
Saturday, August 1, 2009
Black Hat USA 2009
Preview for the ADHD
★ Navel gazing and rants 
★
Democratization of misinformation
★
Trust, integration, and shared exposure
★
Features arms race, emerging attack surface
★ Actual information and content
★
A nifty (we think) approach to an old bug
★
Tool release, ensuing demos o' fail
★
Stupid API tricks and multi-site mayhem
★
Sorry, you have to listen to rants first. =)
Saturday, August 1, 2009
Black Hat USA 2009
Voice of the people
★ User-Generated Content
★
User-driven, social, collaborative content
★
Blogs, wikis, socnets, web communities
★
Increasingly bolted onto “old” web media
★ Integrated, Aggregated, Dynamic
★
Offsite content, syndication, shared APIs
★
Aggregation points, feeds, personal portals
★
Increasing client-side logic (REST, JSON, etc)
Saturday, August 1, 2009
Black Hat USA 2009
What could possibly go wrong?
★ Moot is Time's person the year
★
Lulzy example. Larger problem.
★
Time: “Feh. Internet polls aren't trusted.” Oh.
Saturday, August 1, 2009
Black Hat USA 2009
What could possibly go wrong?
★ Post-MJ celebrity death hoaxes
★
Some “real” news outlets picked up.
★
iReport, uReport, you are on notice.
★
Note: Please stop Rickrolling. Please.
Saturday, August 1, 2009
Black Hat USA 2009
What could possibly go wrong?
★ NYT aggregation fail
★
HTML injection article propagates HTML injection
★
Aggregation, syndication, shared exposure
Saturday, August 1, 2009
Black Hat USA 2009
What could possibly go wrong?
★ DailyKos trolls twittering dittoheads
★
Fake economy / budget numbers
★
$3 million for replacement tires for 1992-1995 Geo Metros.
★
$750,000 for an underground tunnel connecting a middle school 
and high school in North Carolina.
★
$4.7 million for a program supplying public television to K-8 
classrooms.
★
$2.3 million for a museum dedicated to the electric bass guitar.
Saturday, August 1, 2009
Black Hat USA 2009
Shared exposure
★ The emerging socialized web
★ Multi-site aggregation = Attacker ROI
★ Multipoint attack surfaces, APIs, “Digg this!”, etc
★ (n)th-parties and shared exposure
★ “Malware-like” legit functionality
★ Silent updates, presence announcements
★ Offsite links and wrapped external content
★ Try blocking .js for googleapis.com. I dare you.
Saturday, August 1, 2009
Black Hat USA 2009
Unite for problems
Saturday, August 1, 2009
Black Hat USA 2009
Top BOTSites
Saturday, August 1, 2009
Black Hat USA 2009
Bolting On fail
★ Retrofitting the Thing of The Now
★
More FF fail. No, srsly.
Saturday, August 1, 2009
Black Hat USA 2009
Exposing Yourself
Saturday, August 1, 2009
Black Hat USA 2009
Exposing Yourself
★ APIs are the New Hotness
★ Integrate other site functions (Your tweets in my 
Facebook? Awww....)
★ Hooks into fluffy clouds of amorphous love
★ googleapis, amazonws, others
★ Crossdomain content, sandboxing 
★ Two major types of APIs
★ For consumption of application services
★ For integration of app on another site
Saturday, August 1, 2009
Black Hat USA 2009
API Stacking
Application
API
Application
API
Application
★ Your app is so ugly its APIs have APIs
★
How far away from what we are using do we need to 
be?
★ = WTF. Complexity breeds exposure.
Saturday, August 1, 2009
Black Hat USA 2009
API as anon proxy
★ Attacks anonymization via shared APIs
Saturday, August 1, 2009
Black Hat USA 2009
no place like 127.0.0.1
★ Hi5 API localhost dev page. Opps1!1
Saturday, August 1, 2009
Black Hat USA 2009
api Redirect loops
★ Triangle of Death
★ (Rectangle|Pentagon|Hexagram|Octagon) of 
Death
Saturday, August 1, 2009
Black Hat USA 2009
now we break some stuff
★ CSRF / Session Riding / XSRF
★ Well understood. Pete Watkins, 2001
★ Often tough to audit for, nuanced
★ Typically described as a “static” attack
★ Per-user forgeries usually only via XSS
★ Can be silly, bad, or really, really bad 
★ Our continued move to webeverything(tm)
★ Classical mitigations: Referrer, POSTs, tokens
Saturday, August 1, 2009
Black Hat USA 2009
do you use a browser for it?
Saturday, August 1, 2009
Black Hat USA 2009
CLASSICAL CSRF
Saturday, August 1, 2009
Black Hat USA 2009
CLASSICAL CSRF (via POST)
Saturday, August 1, 2009
Black Hat USA 2009
“Dynamic” CSRF
★ “Dynamic” CSRF.
★ Per-request, per-session, per-user forgeries
★ Watkins described in 2001, but no one noticed 
★ Samy, recent bit.ly XSS, other XSS worms
★ Again, well understood as XSS side effect
★ Lots of “complex” CSRF gets ignored
★ POST-based, tokenized, per-user requests
★ Still exploitable, but higher bar
★  gets 
old after the 30 times or so.
Saturday, August 1, 2009
Black Hat USA 2009
“Dynamic” CSRF
★ “Dynamic” CSRF.
★ We wanted to automate “complex” CSRF
★ Needed more logic than just redirects / tags 
★ Many non-trivial CSRF are ignored
★ Devs often think SOP saves them (it might)
★ See also: http://securethoughts.com/2009/07/
hacking-csrf-tokens-using-css-history-hack/
Saturday, August 1, 2009
Black Hat USA 2009
Dynamic CSRF
Saturday, August 1, 2009
Black Hat USA 2009
Enter the fist.
★ MonkeyFist: PoC Dynamic CSRF Tool 
★ http://hexsec.com/labs
★ Small Python web server
★ Creates payload / patterns based on referrer
★ Automates per-request, “dynamic” CSRF
★ Constructs hidden POSTs, redirects, refreshes 
★ Makes requests for tokens or steals from referrer
Saturday, August 1, 2009
Black Hat USA 2009
MF Payload Options
★  - Payload with number
★  - Site entry w/ domain
★  - Attack method (GET, POST, PAGE)
★  - Session data to grab
★  - URL to send attack to
★  - Header to add to POST request
★  - Value for defined header
★  - POST Variable name
★  - Value for defined POST variable
★  - Destination for meta refresh
Saturday, August 1, 2009
Black Hat USA 2009
Payloads.xml
Saturday, August 1, 2009
Black Hat USA 2009
Dynamic Redirect Attack
Saturday, August 1, 2009
Black Hat USA 2009
POST Construct
Saturday, August 1, 2009
Black Hat USA 2009
Dynamic Page
Saturday, August 1, 2009
Black Hat USA 2009
Fist Full of Fail
Saturday, August 1, 2009
Black Hat USA 2009
What you just saw
★ MF “Dynamic” CSRF of anon Wikipedia edit
★
Requests were replayable, but unique
★
WPEdittime, WPStarttime, other session values
★
MF requested session values, hidden POST
★
We think this is pretty nifty.
OMGTHETANS!
Saturday, August 1, 2009
Black Hat USA 2009
Hrmm.
Saturday, August 1, 2009
Black Hat USA 2009
Hrmm.
★ CSRF mitigations are well understood
★ Still, you have to LOTS of things right
★ No bolt on fixes, sorry.
★ Look at your code! Forget SOP.
★ Thanks for listening. Send bugfixes.
★ Nathan’s blog: http://www.neohaxor.org
★ Shawn hates blogs.
Saturday, August 1, 2009