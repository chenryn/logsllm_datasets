2） 反向代理网关方式（无终端Agent）
反向代理网关指的是在零信任网关实现上，通过七层HTTP协议反向代理方式，通过将后端业务域名解析
到网关上，实现对资源访问的拦截和转发，无终端Agent模式和有终端Agent模式差异如下图：
零 信 任 实 现 方 案
零 信 任 实 战 白 皮 书
零信任产业标准工作组
在技术实现过程中，主要需要注意几点：
a）由于无零信任Agent，因此主要的安全控制在网关和安全控制中心；
b）安全控制中心主要对用户身份进行认证和授权。
该方式下零信任实现上，主要优势：
a）由于无用户端Agent，实现相对简单，方便提供给协作或者管理不受控的终端用户；
b）由于是七层HTTP代理，因此可以基于应用进行细颗粒的授权控制，可以深入到对特定应用，特定资源
的控制；
c）由于所有的请求对网关是透明的，因此可以对内容进行分析、审计，提高安全检测能力；
d）由于都是HTTP协议，请求效率较高，可靠性强。
除了以上优势外，该方式也有一些劣势，如下：
a）由于没用零信任Agent，因此无法得知终端设备安全情况，也无法建立用户到设备的可信授权，不能完
整的实现零信任核心目标；
b）此外对于非HTTP的业务，如C/S应用难以支持，对于全场景的办公需求支持难度较大；
实现原理示意：
零 信 任 实 战 白 皮 书
零 信 任 实 现 方 案
零信任产业标准工作组
3）应用层代理网关方式
应用层代理模式指的是在零信任网关实现上，通过七层应用代理方式，将对后端应用的访问通过本地应用
层代理配置，将应用层请求发至应用层代理网关中，由应用层代理网关进行拦截、转发，如下图：
该模式下的简化访问过程如下：
a）用户通过零信任终端Agent进行设备注册和授权；
b）终端Agent进行安全基线加固，以及上传终端设备安全状态；
c）用户通过零信任终端Agent（或可信集成的浏览器），来设置本地应用层代理配置，指定特定资源的访
问由应用层代理发至应用层代理网关中；
d）应用层代理网关通过安全控制中心，进行认证和鉴权；
e）应用层代理网关鉴权通过后，将请求转发给应用系统，获取请求资源；
f）应用层代理网关将资源转发给零信任终端，完成资源请求。
实现原理示意：
零 信 任 实 现 方 案
零 信 任 实 战 白 皮 书
零信任产业标准工作组
实现描述：
a）0-1配置不同第三方应用程序兼容性，系统代理设置、浏览器设置、环境变量配置，以及其他可以通过
插件支持配置的软件；
b）2-4本地启动一个代理服务劫持所有发生的访问请求，进行安全检查身份检查和访问授权，如果是需要
转发的，则加密转发到对应的应用代理网关，否则直接通过物理网卡直连出去；
c）5网关代理做二次的授权控制，身份-访问资源的合法性校验，合法则进行流量代理；
d）6网关代理需要守护和安全检查，必须对本地代理的请求做严格的数据来源合法性校验和保护。
该模式下零信任实现上，除了零信任自身的一些优点还具有以下优势：
a）由于是应用层代理，因此可以基于应用进行细颗粒的授权控制，可以深入到对特定应用，特定资源的
控制；
b）由于所有的请求对网关是透明的，因此可以对内容进行分析、审计，提高安全检测能力；
除了以上优势外，该模式也有一些劣势，如下：
a）对于非HTTP的业务，部分开放设置能力的CS应用客户端可以支持配置，大部分CS架构的客户端都是
不支持的，对于全场景的办公需求支持难度较大；
4）流量代理网关方式
流量代理方式在实现上，主要是通过零信任Agent通过hook、虚拟网卡、网络过滤驱动等方式，将本地流
量转发给零信任网关，零信任网关负责流量的拦截和转发，如下图：
零 信 任 实 现 方 案
零 信 任 实 战 白 皮 书
零信任产业标准工作组
实现描述：
a）1-2认证之后，Agent利用本地流量劫持的方式，通过网卡设备驱动或者网卡系统过滤驱动，劫持所有
的TCP和UDP流量。涉及到的需要转发的URL、IP的流量检查，同时兼容具体的业务进程发起的访问，对业务
进程进行白名单安全性检查。
b）3本地流量劫持的服务进程或者代码，对发起访问的应用进程白名单或者可信检查，同时身份-访问业
务系统的合法性的检查，也可以增加获取本机当前的安全基线状态，确认之后分配到对应的授权加密附带授权
信息，转发到网关。没有分配到授权则直接提供物理网卡对外直连。
c）4本地劫持服务对网关直接提供加密信道，内容包含对应访问授权和原始数据的加密。
d）5-6进行授权二次访问控制确认，合法流量解密还原成为原始流量，负载发送给到具体的业务系统。
该模式下的简化访问过程如下：
a）用户通过零信任终端Agent进行设备注册和授权；
b）终端Agent进行安全基线加固，以及上传终端设备安全状态；
c）用户通过零信任终端Agent的hook方式、虚拟网卡、网络过滤驱动方式，将对资源发起访问请求转发到
流量代理网关上；
d）流量代理网关通过安全控制中心，进行认证和鉴权；
e）流量代理网关鉴权通过后，将请求转发给应用系统，获取请求资源；
f）流量代理网关将资源转发给零信任终端，完成资源请求。
实现原理示意：
零 信 任 实 战 白 皮 书
零 信 任 实 现 方 案
零信任产业标准工作组
该模式下零信任实现上，除了零信任自身的一些优点还，具有以下优势：
a）由于是四层流量代理，因此可以实现全局代理，无论是B/S应用，还是C/S应用都可以通过流量代理网
关进行控制和授权；
b）此外该模式下，C/S应用不需要改造，可以直接接入进零信任体系中，对业务干扰较小；
c）由于是全局流量代理，因此可以实现更多数据分析，提高安全检测能力。
除了以上优势外，该模式也有一些劣势，如下：
a）由于是四层流量代理，因此对于加密的请求，解密成本较大，因此不易实现精细化的权限控制，例如
针对垂直的WEB流量，需要额外用垂直的WEB流量网关，基于HTTP协议层做对应更加细化的访问控制。
b）另外对于加密数据，如果安全上需要做数据分析，对应消耗更多分析性能。
c）另外全流量代理模式下，容易出现和其他安全类流量劫持软件冲突，需要对应修复支持工具。
5）混合网关方式
通过1-4的实现方式可以看出，单一的实现方式都有其弊端和优势，例如用了全流量代理可能导致无法识
别内容，无法对特定应用进行解析和精细的权限控制，因此也可以将技术实现方式进行融合，融合点主要是在
网关对上述多个能力进行整合，用全流量代理网关作为统一入口，对特定应用的控制由应用代理模块进行控
制，在实现上同时拥有全流量代理、Web应用反向代理、应用层代理（其他RDP、SSH、IOT等）能力，如下
图：
零 信 任 实 战 白 皮 书
零 信 任 实 现 方 案
零信任产业标准工作组
该模式下的简化访问过程如下：
a）用户在访问资源时，根据所访问的资源类型，将请求转发到流量代理网关上；
b）流量代理网关通过安全控制中心对用户进行认证和鉴权；
c）流量网关根据请求的资源类型，鉴权通过后将请求转发，向后转发中分为以下情景：
直接转发：如果没有特定应用代理模块，请求将直接转发到应用中，例如C/S应用；
转发到应用代理模块：有特定应用控制的模块时，将请求转发到应用代理模块中，由应用代理模块进
一步进行更细粒度的鉴权，例如对SSH服务进行零信任控制和授权，对Web应用进行零信任控制和授
权，或是更特定业务协议的场景，IOT的零信任控制授权。
d）流量代理网关将资源转发给终端，完成资源请求响应。
混合实践举例：有Agent和无Agent的场景，满足不同的权限控制需要：
a）提供一套流量网关服务器和Agent，提供给企业内部职员终端安全访问，实现强终端安全防护和管控目
标；
b）同时部署一套对外提供反向代理网关，通过DNS解析将部分业务代理出去，提供给合作商，针对一些
敏感数据泄漏风险较低的系统，用户可以不用安装客户端直接由WEB Portal方式，经身份认证鉴权后访问。
该方式下零信任实现上，除了零信任自身的一些优点还，具有以下优势：
a）由于混合代理方式，如果业务要求全部场景，可以使用全流量代理模式，处理C/S和B/S系统的终端应
用；
b）如业务方需要对特定业务实现更精细对权限控制，例如对SSH、RDP登录或是WEB应用进行零信任控
制和授权，需要应用代理的应用解析能力，因此可以基于应用进行细颗粒的授权控制，可以深入到特定应用
中，对特定资源进行零信任的授权控制；
c）由于兼顾了全流量代理和特定应用的应用层代理，因此可以获取到全流量和特定应用的数据提取，提
高安全检测能力。
零 信 任 实 战 白 皮 书
零 信 任 实 战 白 皮 书
零 信 任 实 现 方 案