本资料仅供内部使用！
大数据可视化智能门户
系统设计说明书
2018 年 08 月 21 日
修改记录
  -------------- -------------- ------------- -------- -------- -------------- -------- -------- --------
  *制定日期*     *生效日期*     *制定 / 修订  *页数*   *版本*   *拟稿*         *审查*   *批准*   *版本*
                                内容摘要*                                                        
  *2018-08-21*   *2018-08-21*   *初稿*                          *2018-08-21*                     *V1.0*
  -------------- -------------- ------------- -------- -------- -------------- -------- -------- --------
一、 简介 [3](#简介)
1\. 规格目的 [3](#规格目的)
2\. 范围 [3](#范围)
3\. 参考资料 [3](#参考资料)
二、 总体设计 [3](#总体设计)
1\. 总体设计思路 [3](#总体设计思路)
2\. 开发环境 [3](#开发环境)
3\. 测试环境 [3](#测试环境)
4\. 运行环境 [4](#运行环境)
5\. 系统架构 [4](#系统架构)
1\) 设计约束 [4](#_Toc293934478)
2\) 需求约束 [4](#_Toc293934479)
3\) 隐含约束 [4](#_Toc293934480)
4\) 设计策略 [4](#设计策略)
5\) 系统总体结构 [4](#系统总体结构)
三、 模型/数据库设计 [4](#系统架构视图)
四、 接口设计 [5](#接口设计)
1\. 外部硬件接口 [5](#外部硬件接口)
2\. 外部软件接口 [5](#_Toc293934486)
3\. 接口内容细化 [5](#_Toc293934487)
五、 功能设计 [6](#功能设计)
1\. 功能清单 [6](#功能清单)
2\. 功能模块1 [6](#_Toc293934490)
3\. 功能模块2 [6](#_Toc293934491)
六、 模块命名规则 [7](#功能概述-18)
七、 模块设计（功能设计细化） [14](#_Toc293934493)
1\. 模块功能清单 [14](#_Toc293934494)
2\. 功能模块1 [15](#_Toc293934495)
1\) 操作界面 [15](#_Toc293934496)
2\) 模块流程 [15](#_Toc293934497)
3\) 关联模块 [15](#_Toc293934498)
4\) 设计说明 [15](#_Toc293934499)
5\) 引用的数据库表 [16](#_Toc293934500)
6\) 测试要点 [16](#_Toc293934501)
3\. 功能模块2 [16](#_Toc293934502)
八、 公用模块（功能设计细化） [16](#_Toc293934503)
1\. 公用模块1 [16](#_Toc293934504)
九、 用户界面规范设计 [16](#用户界面规范设计)
十、 安全性 [16](#安全性)
十一、 系统性能 [17](#系统性能)
十二、 备份设计 [17](#性能监控)
十三、 恢复设计 [18](#恢复设计)
十四、 系统出错处理设计 [18](#系统出错处理设计)
1\. 出错信息 [18](#出错信息)
2\. 补救措施 [19](#补救措施)
# 简介
本章将简要地说明项目系统设计说明书(以下简称本规格)的目的、范围、名词定义和参考文件。
## 规格目的
编写该文档的目的在于在《需求分析规格说明书》的基础上通过抽象和分解方法将项目分解成模块，并从总体设计的角度明确大数据可视化功能与自助报表功能创建项目(以下简称北京银行大数据可视化智能门户)的技术、功能、约束、处理模式和接口，使项目开发人员和产品管理人员明确产品功能，可以有针对性的进行项目开发、测试、验收等各方面的工作。
## 范围
本规格的内容涵盖了本项目需要使用到的技术，项目的总体功能及功能说明，接口约定，约束条件，开发、测试环境。
本文档的读者为用户代表、数据库设计人员、详细设计人员、开发人员、测试人员和项目相关手册编写人员。
## 参考资料
《北京银行大数据可视化智能门户项目相关架构图v0.4.vsdx》
## 名词定义
  ---------- -------------------------------------- --------------------------
  **编号**   **术语、缩略语以及英文缩写**           **名词定义含义**
  1          北京银行大数据可视化智能门户           
  ---------- -------------------------------------- --------------------------
# 总体设计
## 总体设计思路
近几年，随着大数据平台的逐步兴起，数据类平台与集市的进一步优化与整合，加快了数据驱动的业务发展模式，并已基本完成我行智慧数据生态圈的基础雏形搭建工作，为进一步挖掘数据应用价值，打通与生态圈的一站式应用服务，更好地响应业务需求，拓展与占领市场先机，需建立智能化、可视化的综合服务平台，为我行业务人员提供可视化、智能化的门户，优质的数据服务，满足我行统计分析，财务管理、营销服务、战略规划、监管报送等数据类应用需求，夯实我行信息化建设，紧跟市场发展步伐，助力京行发展。
报表订阅模块，业务人员可登陆该模块，可像普通报表交互模式相同，进行参数的输入，于此同时，可进行报表结果反馈方式（excel等），反馈时间（月初，月末，T+1等），后台接收到请求信号后，进行智能化调度排队策略，预定时间内，除法报表运算服务，将生成好的查询结果投入到指定地点。
自助报表模块为根据我行发展现状，提供包括可拖拉拽的灵活性较强的透视分析与组合分析，以及数据画布式的可视化分析，此次智能化门户为该类服务提供栏位，应用层面包含原报表平台CUBE系列服务的前台数据展示，主要实现方式底层调用原报表平台可视化分析模块的升级版框架服务。
大数据可视化模块主要功能为大数据平台产出产品及人工智能产品提供前台展示服务，平台会根据大数据产品接口规范对大数据+产品（征信，营销，指数）等进行集成。产品集成后可支持统一权限管理，可帮助用户及时获取企业准确信息，对银行信贷、投资业务提供参考，对银行营销工作提供精准营销。
统一身份认证服务系统的基本应用模式是统一认证模式，它是以统一身份认证服务为核心的服务使用模式。用户登录统一身份认证服务后，即可使用所有支持统一身份认证服务的管理应用系统。
## 开发环境
操作系统：Windows7
数据库平台：Oracle11g
应用软件：Eclipse, NotePad, Erwin4, PLSQL, IE8, Google, Firefox, Apache
Tomcat6, JDK1.6
## 测试环境
操作系统：Windows7
数据库平台：Oracle11g
应用软件：Apache Tomcat6, IE8, WAS8.5, JDK1.6
## 运行环境 
系统上线运行环境，严格遵循行里总体技术架构建设的要求，运行在Windows操作系统上，具体情况如下：
硬件资源为：Oracle数据库服务器、应用服务器、Control-M调度服务器、ETL服务器、润干集算器、润干V4.5应用服务器、润干V5应用服务器。
软件资源为：Oracle11g、Control-M 9，F5，东方通、WebSphere
8.5.5、润干V4.5、润干V5。
5.  ## 系统架构 
    1.  ### 设计策略 {#设计策略 .样式3}
> 扩展策略：使用SPRING框架需要扩展时添加方法即可；
>
> 复用策略：相同近似方法时复制方法即可。
2.  ### 系统总体结构  {#系统总体结构 .样式3}
    1.  ### 系统架构视图  {#系统架构视图 .样式3}
        1.  ### 逻辑架构 {#逻辑架构 .样式3}
系统逻辑架构描述系统内部各功能模块之间的关系，以及与外部系统之间的关系，北京银行大数据可视化智能门户的逻辑架构图如下：
![clipboard_1566200380936](media/image1.png){width="6.2625in"
height="5.842361111111111in"}
北京银行大数据可视化智能门户作为一个综合性门户系统，集成固定报表、自助报表、报表订阅、大数据可视化、数据填报、数据答疑、个人专区、系统管理各大模块的功能。
-   本系统报表数据源：
北京银行大数据可视化智能门户中报表的数据源有北京银行新数据报表平台（ODS）、ASP老报表平台（SQLServer报表集市）。
-   北京银行新数据报表平台（ODS）
北京银行新数据报表平台中，数据由数据源系统加载到ODS系统的各个数据层中，并通过接口文件提供给如smartbi自助报表平台等其他系统使用。数据采集范围包括：核心系统。
-   ASP老报表平台报表集市（SQLServer）
ASP老报表平台的数据集集市是SQLServer的cube，为绩效考核报表提供数据来源。
-   北京银行大数据可视化智能门户
本期智能门户系统仅为展现层，展现层数据取自其他系统，如smartbi自助报表平台、大数据可视化平台、ASP老报表平台。
-   本系统功能模块与报表来源、数据源之间的关系
+----------------+----------------+------------------+----------------+
| **功能模块**   | **报表来源**   | **报表数据源**   | **描述**       |
+----------------+----------------+------------------+----------------+
| 固定报表       | ASP平台报表    | ODS系统、S       | 数据经过ODS与S |
|                |                | QLServer报表集市 | QLServer报表集 |
|                | V4.5润干报表   |                  | 市加工整合后供 |
|                |                |                  | 报表工具使用。 |
|                | V5润干报表     |                  |                |
+----------------+----------------+------------------+----------------+
| 自助报表       | S              | ODS系统          |                |
|                | martbi平台报表 |                  |                |
+----------------+----------------+------------------+----------------+
| 报表订阅       | 润干集         | ODS系统、S       | 数据经         |
|                | 算器开发的报表 | QLServer报表集市 | 过ODS与SQLServ |
|                |                |                  | er报表集市加工 |
|                |                |                  | 整合后供润干集 |
|                |                |                  | 算器工具使用。 |
+----------------+----------------+------------------+----------------+
|                |                |                  |                |
+----------------+----------------+------------------+----------------+
-   本系统功能模块与数据来源之间的关系
  ----------------- ----------------- ------------------------------------------------------
  **功能模块**      **数据来源**      **描述**
  系统管理          系统内部          门户系统的权限管理、日志管理等其他功能
  个人专区          系统内部          个人专区模块是通过配置的方式自定义一些功能模块专区。
  ----------------- ----------------- ------------------------------------------------------
### 开发架构 {#开发架构 .样式3}
![](media/image2.emf)
技术架构说明：
1)  维护类功能：
-   展现层：主要采用Easyui\\Ajax\\Jquery\\JS\\Html\\Css实现页面展现。
-   控制器：采用Controller处理页面跳转。
-   业务逻辑层：使用Service\\Impl处理实现业务逻辑。
-   持久层：采用hibernate处理数据库访问。
2)  定时任务：
-   发送邮件：使用smtp认证的方式实现邮件的发送。
-   组织机构与人员信息加载：ODS通过东方通下发组织机构和人员信息的数据后，后台通过定时任务的调度的方式把数据加载到数据库中。
-   数据就绪状态判定：报表订阅模块判定DTS和ODS数据准备就绪的校验；集算器完成数据文件状态的校验。
3)  自助报表：使用smartBI实现电子银行和绩效报表的展示
4)  固定报表：
-   润干V4.5工具
-   润干V5工具
-   ASP平台报表
    1.  ### 数据架构 {#数据架构 .样式3}
![](media/image3.emf)上图是报表订阅后台数据流向说明：
-   ODS系统通过东方通下发数据文件后，通过后台的定时任务比对txt和verf来校验数据文件是否传输完成，传输成功后通过ftp的方式把数据文件推送到共享磁盘下，Control-M通过调用Per脚本判断共享磁盘下的文件是否准备就绪，验证通过调用集算器的脚本通知集算器可以开始生成订阅的数据文件，在数据文件生成完成时集算器会存储一条完成状态的信息在日志报表中，后台定时调度程序轮询日志表判断数据文件是否生成完成，验证通过后小于10M的数据文件会通过调用邮件接口发送邮件至订阅人邮箱。大于等于10M的数据文件在"我的订阅"模块中去下载获取。
-   DTS平台数据准备就绪后会更新数据状态日志表，Control-M通过调用Per脚本判断数据是否准备就绪，验证通过调用集算器的脚本通知集算器可以开始生成订阅的数据文件，在数据文件生成完成时集算器会存储一条完成状态的信息在日志报表中，后台定时调度程序轮询日志表判断数据文件是否生成完成，验证通过后小于10M的数据文件会通过调用邮件接口发送邮件至订阅人邮箱。大于等于10M的数据文件在"我的订阅"模块中去下载获取。
    1.  ### 运行架构 {#运行架构 .样式3}
本章节重点描述调度跑批频度，跑批时间，首作业触发机制，跑批任务和前端访问冲突处理机制，重跑机制设计，资源分配，性能问题，负载均衡。具体如下：
1)  **调度跑批频度：**每天Control-M调度作业自动跑批。
2)  **跑批各个时间点**：
    a.  跑批翻盘时间：下午17:00；
    b.  跑批起始时间：T+1日凌晨3:00；
    c.  分行抽数轮询截止时间：T+1日凌晨9:00；
    d.  ODS轮询截止时间：T+1日下午19:00；
3)  **跑批时长估计：**
数据文件一旦准备完毕后，跑批加载、校验、数据库备份时间累计约0.5小时左右。
如果排除ODS下发数据晚正常情况下8:30跑批基本结束，用户可以在前端界面上看到最新跑批结果。
4)  **首作业触发机制：**
5)  **跑批任务和前端访问冲突处理机制：**
6)  **Control-M调度重跑机制：**
> 后端实现功能顺序1：Control-M调度作业 --\> Perl脚本
7)  **性能：**