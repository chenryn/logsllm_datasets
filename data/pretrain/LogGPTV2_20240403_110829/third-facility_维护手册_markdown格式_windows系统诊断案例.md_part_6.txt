> 填写想要监控的进程，之后勾选如下。在 dump folder location 填写存放
> dump 的路径。点击确定后重启机器生效。
4.  之后如果进程被终止，会在应用程序日志中有如下记录：
![](media/image121.jpeg){width="4.973357392825897in"
height="1.1666666666666667in"}
> 刚才设置的 dump 路径也会生成以进程命名的 dump 文件：
![](media/image122.jpeg){width="4.898483158355206in"
height="1.5609372265966754in"}
## [进程 crash 报错 1000](#_bookmark1)
> 简介：进程 crash，在应用程序日志里看到有 1000 的报错。
### 问题现象
> 进程 crash，在应用程序日志里看到有 1000 的报错。
>
> 2008R2 之后的系统可以配置 WER，收集进程 dump 进一步分析，配置步骤：
1.  运行 regedit.exe 去创建 LocalDumps key:
2.  在新建的 LocalDumps key, 创建一下键值：
> Value: 希望创建 Dump 的路径 . 默认路径是：
>
> 排查阶段我们需要设置 full dump 以获取足够信息。
![](media/image123.jpeg){width="4.862925415573053in"
height="2.7041666666666666in"}
## [windows 桌面显示黑屏或者蓝屏](#_bookmark1)
> 简介：windows 机器登录后桌面显示蓝屏。
### 问题现象
> windows 机器登录后桌面显示蓝屏。
![](media/image124.png){width="4.89500656167979in"
height="2.8508333333333336in"}
### 处理方案
1.  ctrl+alt+delete 调出任务管理器，之后查看是否存在 explorer.exe。
> ![](media/image125.png){width="4.848961067366579in"
> height="3.1354166666666665in"}
2.  exploer.exe 不存在的情况下，文件》新建任务，输入 explorer.exe
    > 后可以正常看到桌面。
![](media/image126.png){width="4.903127734033246in"
height="2.1656244531933506in"}
> ![](media/image127.png){width="3.653441601049869in"
> height="2.53125in"}
3.  explorer.exe 存在的情况下，先将 explorer.exe 全都结束，再新建
    explorer. exe。
![](media/image128.jpeg){width="4.80844050743657in" height="3.105in"}
4.  以上操作无效的话，启动 cmd
    运行以下命令行（这个命令行的作用是检查系统是否存在系统文件损坏，若有会尝试修复）：
> sfc /scannow
![](media/image129.png){width="4.856272965879265in"
height="2.027082239720035in"}
## [windows 异常问题 - 怀疑中毒](#_bookmark1)
> 简介：windows
> 中毒迹象一般都表现在服务，进程和启动项里，分享该异常的排查步骤。windows
> 中毒迹象一般都表现在服务，进程和启动项里，参考如下步骤排查：
1.  运行 msconfig，查看启动项。
![](media/image130.png){width="4.9500360892388455in" height="1.2975in"}
2.  任务管理器查看进程，查看》选择列，勾选命令行。
![](media/image131.png){width="3.653124453193351in" height="1.26875in"}
> 以命令行排序，查看是否有异常路径和进程。
![](media/image132.jpeg){width="4.84003937007874in" height="0.64625in"}
3.  查看是否有异常服务（主要从服务名称和可执行文件的路径来判断）。
![](media/image133.jpeg){width="4.9360378390201225in"
height="3.208124453193351in"}
### 以下是具体案例分析
#### 案例 1
> 重启后卡在"正在应用 scripts 策略"。
![](media/image134.png){width="2.7641655730533685in"
height="0.8008333333333333in"}
#### 排查
1.  开机按 F8
    > 进入安全模式，可以正常启动，查看是否配置了开机或者登陆脚本，
    > 本案例并没有配置脚本。
> （gpedit.msc\> 计算机配置》windows 设置\> 脚本 和 用户配置\>windows
> 设置\> 脚本）
![](media/image135.png){width="4.875017497812774in" height="2.84375in"}
2.  尝试禁用三方服务和启动项，重启仍然卡住。
> [https://support.microsoft.com/zh-cn/help/929135/how-to-perform-a-]{.underline}
> [clean-boot-in-windows]{.underline}
3.  安全模式没问题
    说明肯定是三方问题，把三方服务和启动项禁用没有用，就说明大概率不是正常三方应用的问题。查看服务，发现有很多命名异常的服务，查看服务属性
    \> 可执行文件的路径，可以看到是创建了计划任务。
> 这些异常服务信息基本可以确认服务器已经中毒。
>
> ![](media/image133.jpeg){width="4.084998906386701in"
> height="2.6549989063867017in"}
#### 案例 2
> windows 激活失败，报错如下
![](media/image136.png){width="2.3833377077865268in"
height="1.3958333333333333in"}
#### 排查
1.  查看 software protection 是运行中状态（其实这个报错并不是指 software
    protection 服务没启动， 如果是 software protection 未启动，
    报错码应该是0x80070422）
> ![](media/image137.jpeg){width="4.461663385826772in"
> height="1.6614577865266842in"}
2.  google 查看 80070426 多是跟补丁安装有关，查看 windows update
    > 服务未启动，尝试启动失败。
> 查看 windows update 属性，依存关系不对，而且 systems
> 服务对应一个异常进程。
![](media/image138.png){width="3.1275054680664915in"
height="1.1774989063867016in"}![](media/image139.png){width="2.330766622922135in"
height="2.4578116797900265in"}![](media/image140.png){width="2.311871172353456in"
height="2.4018744531933507in"}
## [Windows 数据恢复 - 动态盘显示无效](#_bookmark1)
### 背景
> 很多客户在使用磁盘时选择了动态盘，又对这块动态盘创建了快照，之后在数据恢复或其他场景下用快照创建了新的磁盘，将新磁盘挂载到相同实例时，发现新磁盘显示无效。
![](media/image141.png){width="4.3109492563429574in"
height="2.1322911198600174in"}
### 问题原因
> 动态盘通过 LDM 进行管理，对于 mbr 分区，LDM 保存在磁盘的最后 1MB(
> 如下图所示），这 1MB 空间保存了磁盘信息，分区信息以及磁盘 id，group id
> 等，由于源磁盘和新磁盘最后 1MB 空间是一样的，两块盘的 ldm
> 数据库完全相同，对应的磁盘 id，group id
> 也是完全相同，导致系统只能识别一块磁盘。
>
> ![](media/image142.png){width="3.8515616797900263in" height="1.105in"}
>
> ![](media/image143.png){width="4.274998906386702in"
> height="4.514998906386702in"}可以通过微软的 LDMDump 工具查看 LDM
> database 的具体信息：
> [https://docs.microsoft.com/en-us/sysinternals/downloads/ldmdump]{.underline}
### 解决方案
> 将新磁盘在无损数据的前提下从动态盘转换到基本盘：重新配置分区表并将
> system id 从 dynamic 改为 ntfs。需要借助 diskprobe 工具（包含在
> Windows XP Service Pack 2 Support
> Tools）[[https://www.microsoft.com/en-us/download/details.]{.underline}](https://www.microsoft.com/en-us/download/details.aspx?id=18546)
> [[aspx?id=18546]{.underline}](https://www.microsoft.com/en-us/download/details.aspx?id=18546)
>
> Drives 找到对应的磁盘，选择 Set Active（以 drive2 为例）
![](media/image144.png){width="4.9408344269466316in"
height="2.975728346456693in"}
> 首先读取 sector0 的信息，view 以 partition table 展示， 其中 relative
> 表示起始扇区，total sectors 表示总扇区数。从截图看到起始扇区是
> 63，总扇区数是 41940929，总扇区数 = 结束扇区 - 开始扇区
> +1，因此结束扇区是 41940991。
>
> ![](media/image145.png){width="4.940939413823272in"
> height="2.9807283464566927in"}
![](media/image146.png){width="4.859388670166229in"
height="3.1718744531933507in"}
> 之后判断起始扇区和结束扇区是否正确，查看 sector 63 和 sector 41940991
> 都是空，说明起始和结束扇区不正确，需要在偏移位 3 的位置用 ntfs
> 标志查找起始和结束扇区，分别是 2048 和 41938943。
>
> ![](media/image147.png){width="4.859375546806649in"
> height="2.7656244531933507in"}
![](media/image148.png){width="4.8927045056867895in"
height="3.4890616797900265in"}
> 转到 sector 2048，View 以 NTFS BootSector 展示，Hidden sector
> 设置为起始扇区 2048，Total sectors 设置为结束扇区 - 起始扇区
> =41936895。
>
> ![](media/image149.png){width="4.513544400699913in"
> height="3.0406244531933506in"}
>
> 最后查看 sector0，View 以 Partition table 展示，relatvie
> 设置为起始扇区 2048， Total Sectors 为结束扇区 - 起始扇区
> +1=41936896。
![](media/image150.png){width="4.405833333333334in" height="3.23in"}
> sector 0 以 Bytes 显示，将 42 改为 07（42 表示的是动态分区，07 表示是
> NTFS 分区 ），write sector 进行保存。
![](media/image151.png){width="4.940837707786526in"
height="3.745728346456693in"}
![](media/image152.png){width="4.179998906386702in" height="2.585in"}
> 重新扫描磁盘后，可以看到磁盘显示为一个基本盘，可以进行数据读取写入操作。
![](media/image153.png){width="4.8437456255468065in" height="1.51125in"}
## [WMI 异常问题要如何重置？](#_bookmark1)
> 简介：分享一个 WMI 异常问题，重置 WMI 的案例。
### 问题现象
1.  系统属性显示不可用。
![](media/image154.jpeg){width="3.206830708661417in" height="2.2725in"}
2.  msinfo32 提示不能访问 WMI。
![](media/image155.png){width="4.885265748031496in"
height="1.8759372265966754in"}
### 修复方案
> 注：以下操作可能会对客户环境产生影响，建议客户先进行快照。
#### windows Server 2008R2
> 右击 cmd，选择以管理员身份运行，运行以下命令行：
#### Windows Server 2012 及以后版本
> 右击 cmd，选择以管理员身份运行，运行以下命令行：
>
> []{#_bookmark34 .anchor}提示权限有问题？3步修改注册表搞定 \ 一般这种报错都是提示权限有问题，我们可以手动修改注册表权限。
![](media/image156.jpeg){width="4.405024059492564in" height="1.21in"}
> 注：此方案同样适用于新建 /
> 修改文件时报错无权限情况（可参考如下步骤修改对应的文件权限），具体步骤如下：
>
> 首先比对这个注册表和正常服务器的权限，如果不一致，按如下步骤进行修改（以下示例以
> TimeProviders 为例）：
1.  右击相应注册表，选择权限 ,
    > 点击高级，将所有者改为当前登录的用户（示例以管理员为例），之后点击
    > OK，关闭所有窗口。
![](media/image157.png){width="4.9029155730533684in"
height="1.8663538932633421in"}
2.  再次右击注册表，选择权限，赋予刚才更改的用户完全控制。
    > 若没有此用户，先点击添加。之后点击 OK，关闭所有窗口。
![](media/image158.jpeg){width="4.878150699912511in"
height="1.7171872265966754in"}
3.  重复第 2 步，参考正常机器，添加剩余用户的权限。
> ![](media/image2.png){width="1.0041338582677166in" height="0.9225in"}
![](media/image3.png){width="1.0332338145231845in"
height="1.033332239720035in"}![](media/image4.png){width="1.0385356517935258in"
height="1.0499989063867017in"}![](media/image5.png){width="1.015624453193351in"
height="1.015624453193351in"}
> 云服务技术大学 云产品干货高频分享
>
> 云服务技术课堂和大牛零距离沟通
>
> 阿里云开发者"藏经阁" 海量免费电子书下载