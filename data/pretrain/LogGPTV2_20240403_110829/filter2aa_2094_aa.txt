Fuzzing on train: 
AI制导PDF文件生成技术的探索之旅
邹权臣
中国信息安全测评中心博士后
马金鑫
中国信息安全测评中心副研究员
个人简介
马金鑫
中国信息安全测评中心 副研究员
北京邮电大学硕士生导师
研究方向：软件安全、漏洞分析
主持多项国家、省部级科研项目，发表20余篇学术论文，获
得软件著作权5项，发明专利2项，曾发现多个0Day漏洞。
邹权臣
中国信息安全测评中心 博士后
研究方向：自动化漏洞分析
负责、参与多项国家、省部级科研项目，发表
多篇学术论文。
PI:EMAIL
PI:EMAIL
目录
研究背景
方案设计
实验分析
结论与展望
研究背景
高结构化样本与PDF文件
AI&样本生成
LEARN&FUZZ
高结构化样本与PDF文件
高结构化样本结构复杂，通过规定的语法、语义检查才能被各类解析工具执行
语法检查
语义检查
语法规则
语义规则
PDF、XML、XSL、
JavaScript、HTML等
测试输入
解析执行
Foxit Reader、Adobe Reader、 
Chrome、Edge、Firefox等
不通过
通过
通过
不通过
结束
结束
完成
高结构化样本与PDF文件
xref
0 257
0000000000 65535 f
0000000017 00000 n
0000000212 00000 n
0000000231 00000 n
0000000251 00000 n
0000000825 00000 n
0000000876 00000 n
trailer
]>>
startxref
320283
%%EOF
%PDF-1.3
8 0 obj
>
endobj
Header
Body
Cross-
reference table
Trailer
PDF文件所遵从的
版本号
间接对象地址索引表
由一系列的PDF间接对象组成，如字体、页面、图像等，构成了PDF
文件的具体内容（按大类可分为带stream不带stream的obj）
指明根对象(Catalog)，保存了加密等安全信息，
并声明交叉引用表的地址
Adobe Systems Incorporated. PDF Reference, 6th edition, Nov.2006. 
http://www.adobe.com/content/dam/Adobe/en/devnet/acrobat/pdfs/pdf 
reference 1-7.pdf
1310页
209 0 obj
> 
Stream
…
endstream
endobj
AI&样本生成
AI制导
基于变异的模糊测试
AFL、VUzzer等
基于生成的模糊测试
Peach、Spike、
Jsfunfuzz等
样本合法性弱
人工参与度高
自动化
程度高
合法性
强
具有多
样性
AI&样本生成
arXiv’ 18
S&P’ 17
arXiv’ 17
arXiv’ 18
arXiv’ 17
ASE’ 17
Q-Learning
GAN
PCSG
LSTM
LSTM/BLSTM/seq2seq
CNN
LEARN&FUZZ
•
数据集来源：Windows fuzzing team
•
初始测试集：63,000 non-binary PDF objects out of 
534 PDF files (seed minimization)
•
实验数据集：1,000 PDF objects
•
模型：LSTM with 2 hidden layers
•
实验环境：4-core 64-bit Windows 10 VMs with 20GB 
of RAM
•
训练时长：50 epoch 10 hours
•
生成PDF数量：1,000 per 10 epoch
•
测试结果（Edge）：Pass rate(70%-97%)、
Instruction coverage、Bugs(1)
方案设计
研究方案
数据集构建
模型训练
生成
研究方案
Pdf 
dataset
Build 
model
Model
Pdf objs
Extract 
obj/stream
New objs
Attach to 
pdf host
New pdf 
files
Pdf 
streams
Prefix 
string
LSTM, BLSTM, 
Attention, etc.
Effectiveness 
measure
Coverage
Bugs 
Structure, parameters
1. Dataset 
construction
2. Training
3. Generation
4. Testing
Testsuit
Seed 
minimization
Fuzzing
Initial 
samples
Target 
APP
Foxit Reader, Adobe Reader, 
Mupdf, Chrome, Edge et al.
Cut the text
Load 
model
predict
Vectorization
Training
Crawler
Vectorization
Fuzzing
Save 
dict
dictionary
数据集构建（DATASET CONSTRUCTION）
初始PDF样本集：（Testsuite+Fuzzing）
Stillhq.com PDF Database/Mikail's PDF database
QualityLogic’s PDF 1.7 Application Test Suite
Adobe PDF test suites
Ghent Working Group Test Suites
PDF cabinet of horrors
Pdfium_tests
… … 
初始样本集
最小集
代码覆盖率
20000+
251
37.996%
obj总数：71,779
stream总数：23,521
32.77%是带stream的obj
验证
集
测试集
训练
集
Pdf 
dataset
Pdf objs
Extract 
obj/stream
Pdf 
streams
1. Dataset 
construction
Testsuit
Seed 
minimization
Fuzzing
Initial 
samples
Crawler
Save 
dict
dictionary
2,956
13,765
55,058
obj分配
语料字典
OBJ字典
{"0": "\n", "1": " ", "2": "!", "3": "\"", "4": "#", "5": "$", "6": "%", "7": "&", "8": "'", "9": "(", 
"10": ")", "11": "*", "12": "+", "13": ",", "14": "-", "15": ".", "16": "/", "17": "0", "18": "1", 
"19": "2", "20": "3", "21": "4", "22": "5", "23": "6", "24": "7", "25": "8", "26": "9", "27": ":", 
"28": ";", "29": "", "32": "?", "33": "@", "34": "A", "35": "B", "36": "C", 
"37": "D", "38": "E", "39": "F", "40": "G", "41": "H", "42": "I", "43": "J", "44": "K", "45": "L", 
"46": "M", "47": "N", "48": "O", "49": "P", "50": "Q", "51": "R", "52": "S", "53": "T", "54": "U", 
"55": "V", "56": "W", "57": "X", "58": "Y", "59": "Z", "60": "[", "61": "\\", "62": "]", "63": "^", 
"64": "_", "65": "`", "66": "a", "67": "b", "68": "c", "69": "d", "70": "e", "71": "f", "72": "g", 
"73": "h", "74": "i", "75": "j", "76": "k", "77": "l", "78": "m", "79": "n", "80": "o", "81": "p", 
"82": "q", "83": "r", "84": "s", "85": "t", "86": "u", "87": "v", "88": "w", "89": "x", "90": "y", 
"91": "z", "92": "{", "93": "|", "94": "}", "95": "~"}
corpus length：11,913,817
total chars: 96
模型训练（TRAINING）
对OBJ进行文本切分，并转换成向量，然后训练模
型，对每一轮的训练结果做离线存储
Build 
model
Model
Pdf objs
LSTM, BLSTM, 
Attention, etc.
Structure, parameters
2. Training
Cut the text
Vectorization
training
文本切分（CUT THE TEXT）
总字符数：11,913,817
参数设置：maxlen = 50，step = 3
切分后总序列数：3,803,562(Training:3,042,849, validation:760,713)
obj
>
/Contents 2 0 R
>>
endobj
sentences
next_chars
'obj\n<<\n  /Type /Page\n  /Parent 33 0 R\n  /Resources'
' '
'\n<<\n  /Type /Page\n  /Parent 33 0 R\n  /Resources 70'
' '
'\n  /Type /Page\n  /Parent 33 0 R\n  /Resources 70 0 '
'R'
……
……