1ibtidy-0.99.0-19.20070615.1.e16.x86_64
libi
图16-12
PHP-FPM的配置如下：
shell# vim/etc/php.ini
date.timezone=Asia/Shanghai
max_execution_time = 300
post_max_size=16M
max input time=300
memory_1imit = 128M
mbstring.func_overload =2
shell# service php-fpm restart
用RPM包安装，如图16-13所示。
ory/etc/nginx/conf.d/bak':File exists
Startingpl
图16-13
下面进行Web页面的配置，访问地址如下：
http://zabbix-gui.itnihao.com/inex.php-#界面如图16-14所示
zabbix-guiitnihac.com/intlexph
ZABBIX
Welcome to
Zabbix 2.2
www.zabbk.con
图16-14
329
---
## Page 346
Zabbix企业级分布式监控系统
如果出现数据库无法连接，则需正确配置数据库，如图16-15所示。
ZABBIX
3.Co
Press Testconr
nectionbuttoniwhs
Databasetype
MYSOL
tdetails
Databasehost
192.168.0.240
Database port
3306usedefau pt
zabbix
User
zabbix
Password
*.....
图16-15
填写虚拟的IP地址：192.168.0.5，如图16-16所示，图16-17显示了当前的
配置环境信息。
ZABBIX
4.Zabbix
andportnumber of Zabbuservey,
Host
192.160.0.5
Port
10051
Name
图16-16
ZABBIX
5.Pre-Installtion summary
leasecheck
arameters
Database type
MVSQL
Database server
192.168.0.240
Database port
3306
auruaseqeeg
xiQqRz
zabbox
Zabbix server
192.160.0.5
Zabblx server port
10051
zabix
www.zabbix.com
Liciensen under GPLVZ
Cancel
图16-17
330
---
## Page 347
第16章大型分布式监控案例
提示无法写入，如图16-18所示。
ZABBIX
6.Install
Conhiguration file
conf.ohp
created,Fall
Retry
detail
Inabletosreatetheconfgur
Pre-Installation s
6. TnstaR
ave it as
图16-18
查看文件夹权限，如图16-19所示。
troot@zabb1x-gui-]#11/usr/share/zabbix/conf/
图16-19
查看Nginx和PHP的权限，如图16-20所示。
[roo
-efIgrep php
nobody
dyddaj600:00:00
（-gui~]#
5234
5348
4235
023:31pts/1
图16-20
可以看到，Nginx和PHP运行在两个用户中，所以无法写入，解决的办法是
将PHP用户也改为Nginx，如图16-21所示。
Note:
will be used.
nginx
group =nginx
图16-21
安装完毕后（如图16-22所示为安装成功后的界面），需要对Zabbix数据库
进行分表操作。第3章已经讲解过了，此处不重复。有关配置参数的优化、模板
的优化、触发器的优化等内容，在前面章节已经讲解。
331
---
## Page 348
Zabbix企业级分布式监控系统
←zabbix-gui.itnihao.com/dashboard.php#
ZABBIX
History:Dashboard Configuration of proxies Dashboard
回肉
Status of Zabbhx
回恩
No graphs added.
Parameter
Value Details
Zabbix server isrunning
Yes
192.168.0.5:10051
Number of hosts（monitored/not monitored/templates)39
0/1/38
回肉
Number of items（monitored/disabled/not supported)
0
0/0/0
No screens added.
Number of triggers(enabled/disabled)[problem/ok]
0/0[0/0]
Scre
Number of users (online)
2
1
回图
Requiredserverperformance,newvaluespersecond
0
Noimapsadded
ed:07:48:54
回肉
图16-22
16.3.5
安装Zabbix-Proxy
Zabbix-Proxy的规划如表16-7所示。
表16-7
角
色
IP地址
域
名
运行的服务
Zabbix-Proxy
192.168.0.6
zabbix-proxy.itnihao.com
Zabbix-proxy
MySQLServer
安装Zabbix-Proxy，语句如下。
shell# rpm-ivh
zabbix-proxy-2.2.2-0.el6.zbx.x86_64.rpm
安装Zabbix-MySQL，语句如下。
shell#rpm-ivh
zabbix-mysql-2.2.2-0.e16.zbx.x86_64.rpm
安装Percona数据库软件。
安装步骤请参考16.3.2节的内容。
创建Zabix-Proxy数据库，如图16-23所示。
xy character set utf8；
mysql grant all.privileg
sonzabbix_proxy.tozabbix@localhost identified byzabbix;
mysql>flush.privileges;
fected(o.05 sec)
/sql>use
zabbix_proxy:
Database changed
mysql>source./usr/share/zabbix-database/mysq1/schema.sql:
图16-23
332
---
## Page 349
第16章大型分布式监控案例
修改zabbix_proxy.conf配置。
xoxd xzxq #dx #
ProxyMode=0
Server=192.168.0.5
Hostname=Zabbix proxy
LogFile=/var/log/zabbix/zabbix_proxy.log
LogFileSize=0
PidFile=/var/run/zabbix/zabbix_proxy.pid
DBName=zabbix_proxy
DBUser=zabbix
DBPassword=zabbix
DBSocket=usr/1ocal/Percona-Server-5.6.15-rel63.0-519-static-open
ssl-1.0.1e.Linux.x86_64/var/run/mysql.sock
ExternalScripts=/etc/zabbix/externalscripts
启动Zabbix-Proxy服务。
shell# /etc/init.d/zabbix-proxy start
检查日志，查看启动是否成功，是否有报错等，如图16-24所示。
Tro
9120:20140225:155950.823Cann0t
xy#6sta
ted [poller.#3]
9127
20140225:155951.255
#5started [poller#
SAS
#1
图16-24
配置Zabbix-Proxy，如图16-25所示。单击Administration→DM→Proxies→
Create proxy。
History:Dashboard Configuration of proxies Configuration of user groupsConfiguration of users Configur
COKFIGURATIOOFPROXIES
Zabbix prox
Proxyname
Proxy modeActive
Hosts Proxy hosts
Other hosts
Zabbixserver
Save
Clone
Delele
Cancel
图16-25
333
---
## Page 350
Zabbix企业级分布式监控系统
注意，图16-25 中的 Poryx name来自zabbix_proxy.conf下的Hostname，每个
Zabbix-Proxy应该具有唯一的名称，不可重复，如图16-26所示。
Server=192.168.0.5
Hostmame=Zabbix proxy
LogFile=/var/log/zabbixzabbix_proxy.log
图16-26
添加自动注册的Actions，如图16-27到图16-29所示。
History:Configuration of host groupsConfiguration of discovery rulesConfiguration of hostsConf
CONFIGURATION OF ACTIONS
Action
ConditionsOperations
Nameautoregistration
Default subject Autoregistration:(HOST.HOST)
Default message
Host name:{HOST.HOST)
HostIP:{HOST.IP}
Agent port:{HOST.PORT}
Enabled
Save
Clone
Delete
Cancel
图16-27
Action
Conditions
Operations
Conditions
Label
Name
Action
(A)
Proxy=Zabbixproxy
Remove.
图16-28
CONFIGURATION OF ACTIONS
ActionConditions
Operations
Action operations
Details
Addhost
Add to host groups:DevOPS
Link to templates:Template OsLin
New
图16-29
添加完成后的结果如图16-30所示。
334
---
## Page 351
第16章
大型分布式监控案例
ent.itnihao.com Applications (10) Items (32) Iriqgers (15) Graphs (5)Qiscovery (2) Web (0) 10.10.10.10: 10050
Template_Qs.Lil
ZabbixAqent)
图16-30
16.3.6
配置Zabbix-Agent
修改/etc/zabbix/zabbix_agentd.conf，语句如下。
ServerActive=127.0.0.1:10051,10.10.10.2:10051
注意：10.10.10.2为Zabbix-Proxy的内网IP地址。
业务相关的配置
16.4
16.4.1月
用户的配置
通过单击Administration→Users→Users groups→Create user group，创建需要
的业务组用户，如图16-31所示。
ZABBIX
Help|Get support|Print|Profile| Logout
zabbix
DH
lMe
Search
History:Configuration of users>Configuration of user groupsConfiguration of usersConfiguration of user groupsConfiguration of users
iUserqroupsCreateusergroup
Usergroups
aying1to19of19found
Name
Members
Status
Frontend access
Debug mode
Boss
Users(1)
boss (boss wu Mr wu)
Enabled
System defauit
Disabled
Users(1)
userl(userluserl)
Enabled
System defaut
Disabled!
Users (1)
user2(user2user2)
Enabled
System default
Disabled
business manager group3
Users (1)
user3(user3user3)
Enabled
Systemdefaut
Disabled
DevOPS
Users(1)
Devops Li (Luming Mr Li)
Enabled
Svstem default
Disabled
Dey web aop group1
Users (1)
Webl Song(Sonq weiMr Song
Enabled
Systemdiefault
Disabled
Devwebappqroup2
Users(1)
web2Zhao (Zhao ming MrZhao)
Enabled
System default
Disabled
Dey web app group3
Users(1)
web3 Iang (Tang.zong Mr Tano)
Enablesd
System default
Disabled
Qisabled
Users (0)
Disabled
Systemdefauilt
Disabled
Enabled debug mode
Users()
Ernabled
Systemdefaut
Enabled
Guests
Users (1)
Enabled
System default
Disabled
quest
Network OPs
Users(1)
NetworkHu(HuweiMr Ho
Enabled
System defaul
No access to the frontend
Users (0)
Enabled
Disabled
Disabled
Securty
Users (0)
Enabled
Systemdefaus
Disabled
SY5OPSqroup1
Users(0)
Enabled
System default
Disabled
SYSOPSqrQuD2
Users (0)
Enabled
System.defauk
Disabled
图16-31
通过单击Administration→Users→Users→Create user，依次创建需要的用户，
如图16-32所示。
335
---
## Page 352
Zabbix企业级分布式监控系统
ZABBIX
Users
Createuser
olaying1to11of11found
Allas
Namie
Surname
Usertype
Groups
Isonline?
Debugmode
Status
Adtmin
Zabblx
Administrator
Zabbix Super
Zabbrx administrators
25Feb201419:03 24-0900)
Ok
Srstemderault