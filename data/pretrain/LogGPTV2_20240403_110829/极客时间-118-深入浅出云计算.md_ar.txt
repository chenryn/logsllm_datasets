# 16 \| 云上AI服务：云AI能从哪些方面帮助构建智能应用？你好，我是何恺铎。欢迎来到我们课程中 PaaS篇的最后一讲，今天，我们来讨论**云上的 AI服务**。近十年以来，从机器学习到深度学习，AI技术的理论体系和软件生态获得了跨越式的大发展，也把很多不可能变成了可能，开始深刻地影响着我们的生活。2016年谷歌的 AlphaGo和李世石的巅峰对决，更是让"人工智能"声名大噪、家喻户晓。技术的突破催生出了巨大的市场和需求，所以各大云计算厂商都非常重视在 AI这方面的投入，致力于全方位地为人工智能应用赋能。不少云计算品牌在自己的名称中也加上了"智能"二字，对于AI 的重视程度可见一斑。我猜你也一定被云 AI铺天盖地的广告宣传轰炸过。不过作为开发者，我们不能仅仅停留于宣传口径的话术，而是要切实地了解云上AI究竟有哪些能力，知道怎样让它与应用程序的开发和运行集成。**那么，云 AI能从哪些方面帮助我们构建智能应用呢？**可以这样说，**云对于 AI的支持，是从不同层面以多种形式体现的**。比如在基础设施的层面，我们在第 3 讲中也提到过，带有强悍 GPU的虚拟机机型已经纷纷登场了。你可以随时用上最新最酷的 GPU硬件，再配合一些云厂商预置的专用虚拟机镜像（比如 Azure 的 Data ScienceVirtual Machine 和 AWS 的 Deep Learning AMI），就可以用单机开展一些 AI方面的工作了。当然，我们这一讲的重点，是 AI 相关的 PaaS服务。它们其实也大致分为两类：**一类是各种成熟能力的开放，是云厂商已经构建好的现有模型和API；另一类则是机器学习的全生命周期管理支撑平台，可以帮助你构建属于自己的机器学习模型**。开箱即用的 AI 服务我们先来看一看，云上可以"拿来即用"的现成 AI能力。 各家云都推出了很多不同种类、适合不同场景的内置 AI 服务，比如在 Azure云上，它们被统称为 Azure 认知服务（CognitiveServices)。这类服务使用起来非常方便，门槛较低，你不需要掌握那些高深的模型构建知识，就可以站在巨人的肩膀上，把这些高大上的能力接入你的应用程序。这类服务的特点，一般是将**非结构化数据**处理分析的通用需求场景，进行了封装和开放。你可以通过云端标准的API 和 SDK来进行调用，一般会按调用次数进行收费。这里所谓的非结构化数据，指的是图像、视频、语音、文本等包含丰富信息的常见数字化内容。对于这些内容的理解，用传统的程序逻辑很难解决，但这恰好是人工智能的强项，它可以深入分析这些内容，并进行信息提取和转换。不同的非结构化数据类型，对应着不同的人工智能研究领域，也对应着相关的各种云上AI 服务。 比如**[计算机视觉 slate-object="mark"}**，就擅长处理图形图像，它衍生出了人脸识别、物体检测、OCR（光学字符识别）、安全扫描等很多细分的能力，也催生出了多种多样的云上图片分析服务。你可以想象，从线下的安防监控和门禁闸机，到线上对用户上传图片证照的扫描和处理，图片服务的应用场景是非常广泛的。在近期疫情肆虐的背景下，有云厂商还迅速推出了人脸口罩检测的 AI服务，体现了云厂商的快速应变能力和社会责任感。下面的 Java代码片段，就展示了通过官方 SDK来调用阿里云上**人脸口罩检测API**，这可以判断给定图片中的人物有没有佩戴口罩。    //设定账号的AccessKey和地域信息    DefaultProfile profile = DefaultProfile.getProfile("cn-shanghai", "", "");    IAcsClient client = new DefaultAcsClient(profile);    //构造人脸口罩识别请求    DetectMaskRequest request = new DetectMaskRequest();    request.setRegionId("cn-shanghai");    //设置待识别的图片路径    request.setImageURL("http://yourbucket.oss-cn-shanghai.aliyuncs.com/mytestimage1.jpg");    //发送请求，获取识别结果    DetectMaskResponse response = client.getAcsResponse(request);    System.out.println(new Gson().toJson(response));这段并不复杂的调用代码，也大致说明了使用一个云上 AI服务的过程，主要就是设置好输入的图片和一些辅助参数，然后就能通过 Web请求来进行图片分析了。这里我测试了一张网络上路人佩戴口罩的照片，执行之后的结果输出如下所示：    {        "RequestId": "F24CXXXX-14B6-4E46-AAF8-C11E2E54XXXX",        "Data": {            "Mask": 2,            "FaceProbability": "0.76107993841171265"        }    }可以看到，返回的 JSON 格式结果中，Mask 字段的值为2，就说明了图片中检测出了人脸并且佩戴了口罩。补充：该 API 返回值为 0 代表未检出人脸，1代表人脸未佩戴口罩。甚至它还能判断有口罩但没有正确佩戴的场景，相应的返回值为3。具体请参见阿里云相关文档。slate-object="mark"}**[自然语言处理 slate-object="mark"}**（Natural Language Processing，NLP），也是一大类非常热门的AI 服务，它主要处理的对象是**文本**。借助这方面的云上能力，你能够进行情感判断、命名实体识别、机器翻译等和文本分析有关的复杂功能，非常有助于构建舆情监测、用户评论分析之类的应用程序。由于语言之间的显著差异，在调研这类 NLP服务时，你要注意它们对于不同语种的具体支持情况。不同厂商的服务，可能在语言上面有不同的侧重。一般来说，国际厂商会先强化对于英语的支持，而国内厂商则通常会很重视处理中文文本的能力。**[语音类智能服务 slate-object="mark"}**，同样是一个很受关注的领域，它能识别声音中的内容信息，尤其是把音频转换成文字。还有一种有趣的反向转换服务是**语音合成**，也就是把文本转化为语音，现在也已经是越来越成熟的技术。比如说，AWS技术博客上的大多数文章，网页上方基本都有一个音频的版本，它的朗读效果非常接近真人，但它其实都是用AWS 上的 Amazon Polly服务来自动生成的。人工智能服务还可以**[处理视频信息 slate-object="mark"}**。你可以把视频分解为一帧一帧的图片和一段一段的音频，然后通过组合上述的各类服务来进行处理和整合；你也可以使用一些直接支持视频内容的云AI 服务，如 AWS Rekognition和阿里云"视频内容分析"来进行视频分析。这些视频分析服务，能输出视频中的场景、文本、面孔和各类物体或常见标识，你可以用在监控视频分析、用户内容审查等常见的应用场景。当然，对于每一个细分领域的模型，想要训练成一个成熟准确的智能模型，其实都很不容易，这需要大量的训练数据，和旷日持久的调优与迭代。这些开箱即用的服务如果满足你需求的话，其实是非常简单而有效的选择。你也不需要对模型的内部实现有任何了解，把它放心地交给云厂商就好了。构建你自己的 AI 模型前面提到的那些现成的 AI服务，大多是以**黑盒**的形式来提供能力的。所以，当这些内置服务不能满足我们需求的时候，那就需要我们"自己动手，丰衣足食"了。我还是拿口罩识别的场景来给你举个例子。假如你不仅需要识别口罩，还想进一步判断口罩的类型，看它是普通医用口罩，还是高防护级别的N95口罩，这样的需求恐怕就需要你自己来定制了。所以说，按照特定的需求来构建自己的定制模型，也是普遍而常见的场景，它也有助于应用端形成自己的特色和核心竞争力。补充：有的时候，成本也是一个驱动应用端自行训练模型的因素，尤其当业务需求规模大、调用次数相当频繁的时候。这时内置AI服务的按次付费模式就会显得比较昂贵了。slate-object="mark"}很多的公司都选择了组建自己的团队，有针对性地构建自有模型。不过呢，在尝试AI 工作一段时间以后，大家普遍容易遇到的现实问题，就是 **AI工作的随意性**，没有形成体系和章法。比如，构建过程的信息分散而混乱，核心代码和脚本存储在个人PC 上；数据和模型得不到妥善的管理，甚至会因人员离职导致丢失；还有 GPU训练资源紧张，模型成品部署困难、运行不稳定等等。当云厂商们发现这些痛点之后，就逐渐地开始对云上的机器学习基础设施服务进行布局和投入，致力于帮助用户构建自己的模型。现在这一块已经成为了云厂商们新的争夺热点，代表性的服务，就有AWS 的 SageMaker，Azure 的 Machine Learning，以及阿里云的机器学习平台PAI 等。 无论你想要构建哪种模型，包括经典机器学习和深度学习，它们共性的地方在于，都有一个类似的流程和步骤，包括数据准备和标注、模型训练、模型部署等。**云上机器学习服务，它的目标就是非常精准地支撑和赋能这些重要环节，帮助你进行贯穿全生命周期的模型构建和管理。**所以，这类平台非常适合数据科学家和算法工程师日常使用，也很适合团队的管理者了解和把控AI 研发端的总体情况。**那么，这类平台究竟是如何服务机器学习任务中的各个主要步骤的呢？****首先是****[数据准备 slate-object="mark"}****的环节。**机器学习服务能够让你注册、管理和标注数据集，这些数据集通常位于对象存储当中。尤其是数据标注工作，你应该知道，它是机器学习工作中极为重要的一个步骤，是一切模型构建的基础。可是数据标注又偏偏非常枯燥，而且往往需要多人协作、交叉验证，才能保证标注结果的质量。好在，机器学习平台为我们集成了数据标注相关的功能，让这件复杂的事情变得十分简单。你可以直接在云提供的网站门户中，来进行数据标注的工作，甚至可以组织团队分配任务，并回收那些正确的结果。这些功能的存在，几乎能够抵得上一个小小的"众包平台"了。为了给你一个直观的印象，我在 AWS S3 中上传了几张口罩的图片，然后用AWS SageMaker 的标注模块 **Ground Truth**创建了一个"标注口罩"的图片标注任务。你可以参考下面这个真实的工作台截图：![](Images/642506786497ce29e031f024d9e9b51f.png)savepage-src="https://static001.geekbang.org/resource/image/38/be/38431ad06f36e144c51efd8eff17cfbe.jpg"}AWS SageMaker Ground Truth图片标注功能示例slate-object="mark"}**其次，是尤为关键的****[模型训练 slate-object="mark"}****环节。**在这个环节，机器学习平台一般都提供了许多内置的常见机器学习和深度学习算法，分别适用于不同的应用场景。你可以基于这些内置算法，使用自有数据训练出符合你需要的模型。你可以在平台提供的类似 Jupyter Notebook的开发环境中撰写编程脚本，来控制模型选择、参数配置和训练数据输入等在模型训练中，一系列的关键逻辑和设置。这些工作大多是使用Python 语言，厂商也一般会提供相应的 PythonSDK，来帮助你和云上机器学习平台交互。补充：也有部分厂商提供了可视化的环境，允许你在画布上拖拉控件和使用流程图的方式来训练模型，比较适合机器学习的初学者和没有编程背景的用户。slate-object="mark"}接下来，我就以 **AWS SageMaker**为例，带你看下如何调用内置的算法来进行模型训练。    from sagemaker.amazon.amazon_estimator import get_image_uri    
# 获取内置算法对应的镜像    training_image = get_image_uri(region_name, 'builtin-algorithm-name')    
# 创建Estimator实例    estimator = sagemaker.estimator.Estimator(training_image,        role,        train_instance_count=1,        train_instance_type='ml.c4.xlarge',        output_path=s3_output_location,        sagemaker_session=sess)    