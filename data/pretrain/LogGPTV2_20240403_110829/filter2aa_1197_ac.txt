hitecture
is
ro
oted
in
the
trust
p
eripherals
of
eac
h
la
y
er
ha
v
e
in
eac
h
others.
F
or
instance,
the
rm
w
are
of
a
cdrom
PCI
device
can
absolutely
con
trol
a
PCI
net
w
ork
card.
And
in
the
same
w
a
y
,
an
ISA
rm
w
are
can
con
trol
an
other
ISA
device.
This
b
eha
vior
cannot
b
e
c
hanged
:
this
is
ho
w
IBM
PCs
w
ork.
It
is
also
w
orth
noting
that
the
T
rusted
Platform
Mo
dule[21
â„„
(TPM)
is
t
ypically
connected
to
the
south
bridge,
v
ery
far
from
the
cpu.
Moreo
v
er,
it
is
a
passiv
e
comp
onen
t,
meaning
that
soft
w
are
can
c
hose
to
use
it
or
not,
but
that
the
cpu
cannot
enforce
its
use.
This
is
a
serious
w
eakness
of
the
whole
arc
hitecture
as
w
e
will
see
later
in
this
pap
er.
As
one
migh
t
exp
ect,
the
rm
w
ares
em
b
edded
in
BIOSes
or
PCI
devices
(PCI
exp
ension
R
OMs)
are
v
endor
sp
ecic
and
totally
not
standard.
The
whole
purp
ose
of
this
pap
er
is
to
explain
ho
w
to
gener-
ically
mo
dify
suc
h
rm
w
ares
to
create
a
bac
kdo
or
that
can
not
b
e
detected
from
user
land
once
a
k
ernel
has
b
een
loaded
in
RAM
and
a
switc
h
to
protected
mo
de
has
b
een
p
erformed.
Because
the
BIOS
rm
w
are
is
strictly
sp
eaking
the
rst
piece
of
soft
w
are
to
b
e
executed
on
the
computer,
and
b
ecause
it
giv
es
early
con
trol
to
eac
h
PCI
exp
ension
R
OM
during
early
b
o
ot
(b
efore
switc
hing
to
protected
mo
de),
an
y
malicious
action
routine
executed
at
this
stage
enjo
ys
full
access
to
hardw
are
resources.
In
particular,
it
is
w
orth
reminding
that
real
mo
de
is
not
capable
of
m
ultitasking,
and
that
suc
h
routines
therefore
ha
v
e
access
to
100
p
er
cen
t
of
the
resources
of
the
mac
hine.
4
Designing
the
p
erfect
bac
kdo
or
:
scop
e
of
w
ork
The
author
of
this
whitepap
er
do
esn't
usually
sp
end
time
writting
malw
ares.
T
o
the
opp
osite,
he
sp
en
t
quite
a
signican
t
part
of
his
life
studying
and
rev
ersing
them.
But
to
pro
v
e
our
p
oin
t,
let's
pretend
w
e'd
really
lik
e
to
design
a
prop
er
bac
kdo
or
to
b
e
used
in
the
wild.
W
e'd
also
lik
e
to
underline
the
fact
that
w
e
b
eliev
e
most
of
the
comm
unication
in
v
olving
malw
are,
if
not
all
of
it,
coming
from
ma-
jor
an
tivirus
v
endors
and
happily
rela
y
ed
b
y
servile
media
is
blatan
tly
tain
ted
with
FUD
3
.
Instead
of
arguing
on
w
ether
Flame
and
Stuxnet
could
ha
v
e
b
een
written
b
y
amateurs
instead
of
nation
states,
let's
see
ho
w
an
attac
k
er
can
write
a
nation
state
qualit
y
bac
kdo
or
on
a
budget.
This
shall
also
serv
e
as
a
go
o
d
exemple
of
ho
w
a
v
endor
man
ufacturer
could
design
a
prop
er
bac
kdo
or
with
similar
in
tend.
First
of
all,
w
e'd
lik
e
our
bac
kdo
or
to
b
e
p
ersistan
t.
Not
simply
p
ersistan
t
b
et
w
een
reb
o
ots,
but
also
in
case
the
user
of
the
computer
w
as
to
replace
the
en
tire
op
erating
system,
p
ossibly
ev
en
p
ortions
of
3
F
ear,
Uncertain
t
y
,
Doubt.
6
the
hardw
are
(replacing
the
hard
driv
e
or
the
net
w
ork
card
for
instance),
ash
the
BIOS
or
an
y
other
rm
w
are
on
the
motherb
oard
and
p
eripherals.
T
o
ac
hiev
e
this
goal,
w
e
will
a
v
oid
ha
ving
a
single
p
oin
t
of
failure
and
will
hence
need
some
degree
of
redundancy
.
Of
course,
the
bac
kdo
or
should
b
e
as
stealth
as
p
ossible.
Needless
to
sa
y
it
shall
not
b
e
detected
b
y
an
y
an
tivirus
on
the
mark
et.
It
shall
also
b
e
p
ortable
:
ideally
,
w
e'd
lik
e
it
to
b
e
totally
op
erating
system
indep
endan
t.
Because
a
signican
t
p
ortion
of
the
IT
budget
of
companies
go
es
in
to
exp
ensiv
e
(and
quite
inecian
t
4
)
detection
gear
suc
h
as
In
trusion
Detection
Systems
(IDS),
In
trusion
Prev
en
tion
systems
(IPS)
and
rew
alls,
w
e'll
need
our
bac
kdo
or
to
b
e
capable
to
break
the
net
w
ork
p
erimeter
of
large
companies
in
some
w
a
y
or
an
other.
In
terms
of
functionalit
y
,
w
e'd
lik
e
the
bac
kdo
or
to
allo
w
remote
up
dates
and
pro
vide
remote
access.
This
implies
some
degree
of
net
w
ork
a
w
areness.
Finally
,
if
w
e
w
an
t
to
matc
h
nation
state
qualit
y
bac
kdo
ors,
w
e
need
our
creation
to
oba
y
t
w
o
golden
rules
alw
a
ys
emplo
y
ed
b
y
secret
services
around
the
w
orld
:
plausible
deniabilit
y
and
non
attribution.
the
rst
one
is
a
mean
to
oer
an
alternativ
e
explanation
in
case
the
bac
kdo
or
w
as
to
b
e
disco
v
ered
in
spite
of
our
b
est
eorts
to
mak
e
it
as
stealth
as
p
ossible.
By
ha
ving
a
second
credible
alternativ
e
to
explain
the
presence
of
the
bac
kdo
or
in
the
system,
nation
states
can
den
y
an
y
wrong
doing
and
qualify
their
detractors
of
sheer
b
eliev
ers
of
conspirationist
theories.
Non
attribution
is
equaly
imp
ortan
t
and
is
the
feature
of
not
allo
wing
the
bac
kdo
or
to
b
e
link
ed
to
an
y
individual
or
state
in
particular.
It
is
v
ery
m
uc
h
in
the
air
for
nation
states
to
claim
"it
w
asn't
me
!
...
it
w
as
China".
Needless
to
sa
y
the
bac
kdo
or
shall
also
b
e
c
heap
:
it
shall
therefore
b
e
blatan
t
that
a
skilled
individual
can
indeed
create
bac
kdo
ors
so
far
b
eliev
ed
to
b
e
only
p
ossibly
crafted
b
y
states
in
the
story
telling
of
the
media,
and
ev
en
tually
put
in
p
ersp
ectiv
e
the
FUD
that
is
serv
ed
daily
to
b
oth
citizens
and
decision
mak
ers
in
the
corp
orate
as
w
ell
as
p
olitical
w
orlds.
5
Implemen
tation
details
:
Rakshasa
The
quadruple
constrain
t
:
c
heap
dev
elopmen
t,
v
ast
features
(suc
h
as
net
w
ork
stac
k),
hard
detection
and
non
attribution
dicate
one
direction
for
our
implemen
tation
:
free
and
op
en
source
soft
w
are.
As
a
matter
of
fact,
the
direction
tak
en
b
y
virtually
an
y
malw
are
so
far
to
rely
on
custom
co
de
en
tirely
is
a
bad
idea
as
it
oers
a
large
attac
k
surface
to
an
tivirii
in
terms
of
detection,
is
often
attributable
if
co
de
is
reused
accress
m
ultiple
malw
are,
and
is
no
where
near
c
heap.
T
o
the
opp
osite,
using
non
malicious
free
and
op
en
source
soft
w
are
as
the
core
of
the
bac
kdo
or
pro
vides
little
angle
of
detection
to
an
tivirii,
is
non
attributable
(the
source
co
de
is
a
v
ailable
to
an
y
one
on
the
in
ternet),
is
as
c
heap
as
it
gets.
Plus
it
oers
free
main
tenance
from
the
comm
unit
y
to
the
malw
are
author.
In
order
to
ac
hiev
e
b
oth
p
ersistance
and
stealthness,
it
w
as
c
hosen
to
target
primarily
the
BIOS.
But
to
oer
redundancy
in
case
the
BIOS
w
as
ev
er
ashed,
it
has
b
een
decicded
to
also
pro
vide
an
infection
mec
hanism
through
PCI
exp
ension
R
OMs,
b
y
targetting
the
rm
w
are
em
b
edded
in
ethernet
net
w
ork
cards
5
.
Rakshasa
is
comprised
of
a
custom
v
ersion
of
Coreb
o
ot
for
the
BIOS
bac
k
end,
of
a
custom
SeaBIOS
BIOS-pa
yload
to
create
and
IVT,
of
a
set
of
PCI
exp
ension
R
OMS
(SV
GA
driv
er
and
a
custom
iPXE
4
F
rom
his
h
um
ble
exp
erience
with
vulnerabilities
and
0da
ys,
the
author
strongly
b
eliev
es
lo
oking
for
bugs
and
getting
them
xed
is
the
only
reasonable
protection
against
0da
ys.
Unlik
e
the
aforemen
tioned
net
w
ork
gadgets
(including
an
tivirii/IDS/IPS),
static
analysis
and
fuzzing
ha
v
e
pro
v
ed
to
w
ork.
Sym
b
olic
execution
is
also
a
promising
eld
of
researc
h
ev
en
though
exp
onen
tial
path
explosion
seems
una
v
oidable
in
the
curren
t
state
of
the
art.
W
e
strongly
recommende
companies
to
in
v
est
in
those
tec
hniques
instead
of
silv
er-bullet-an
ti-0da
y-detection
to
ols,
whic
h
w
ork
neither
in
theory
nor
in
practice.
5
Lik
e
men
tioned
previously
,
the
rm
w
are
con
troling
a
net
w
ork
card
could
actually
b
e
placed
in
an
y
other
PCI
device.
Also
ashing,
sa
y
,
the
cdrom
rm
w
are
with
the
v
ery
same
infected
rm
w
are
w
ould
oer
ev
en
greater
redundancy
.
7
R
OM),
plus
a
custom
activ
e
b
o
otkit
whic
h
is
retreiv
ed
from
the
net
w
ork.
Coreb
o
ot
b
y
itself
isn't
a
full
BIOS
:
it
is
only
resp
onsible
for
detecting
the
hardw
are
presen
t
on
the
ma-
c
hine,
p
erform
a
BIOS
POST