上图中红色为创世区块，而绿色为主链，其他颜色为分叉。
而整个区块链上的确有许多不同的分支，并且长度不一，主链可能是他们中任意的一支。
但是我们能发现，图中主链却十分好认。我们只需寻找最长链即可。
而对于Pow共识，由于在工作量证明区块链中需要现实的算力资源来生产区块，因此链长度可以有效地反映出分支上凝聚的工作量，最长链原则也就是说凝聚了最多工作量的分支便是主链。
也就是说，倘若系统使用的时Pow算法，那么除非遭受了51%攻击，否则不可能有其它从创世区块开始并与当前主链存在潜在竞争关系的分支链。那些攻击者倘若要想替换掉主链，那么它需要使自己的分支链达到相应的长度，这也是十分耗费算力的。所以对采取工作量证明协议的区块链，最长链原则已经足够解决弱主观性问题了。
#### 2 Pos中的长程攻击
由于Pos中依据的是无代价模拟的模式，所以最长链原则并不能成为判断主链的依据。
由于在权益证明区块链网络中没有矿工，所以也就不需要消耗算力来进行计算与挖矿。并且其系统基于对验证人进行信任，相信他们会诚实的对主链进行持续的投资、记账。
在Pos中，验证者仅仅是从交易池中取交易，打包到区块中，然后广播出去，仅此而已。所以说，无代价模拟就是几乎不消耗算力资源来创建一条从创世区块开始的长分支链的能力。
在任何区块链中，新加入的节点会收到许多条分支。在Pos系统中，其中大部分的分支长度是相同的。所以我们仅仅依凭最长链原则不足以判断哪一条是主链。长程攻击恰恰利用了权益证明协议区块链的这两个特点。
#### 3 简单攻击
开始的时候我们先简单的介绍一下长城攻击中的简单攻击：在本例中，整个验证池中有三个验证者，A，B，C。简单起见，设定他们的初始持权数额均为 33.3% 。
权益证明协议区块链的简版，在这种场景下，节点不会去检查区块时间戳。
在权益证明协议正常的一轮周期内，每一个验证者都有机会验证区块（即出块）。
而创世区块中记录了验证者和它们各自的持权信息。A决定实施一次长程攻击，并且创建了一条分支链。她回溯到创世区块，开始生成她的分支链。
由于创世区块中保存了验证者的信息，所以攻击者就不能比主链更新的更快，所以最好的情况就是支链出块速度与主链一致。所以A只能提前产生区块。
上图中，下方为主链，而上方为A伪造的分支，此时分支与主链长度相同，也就是说成为主链的概率与主链一致。
之后A进行时间戳的伪造，并且由于A是这条分支链的唯一活跃持权验证人，这样做并没有什么风险。在不验证时间戳的权益证明协议区块链中，所有的分支链都是有效的。
### 五、变节攻击
我们假设时间戳已经无法被篡改，所以A需要在相同的时间内生成比主链更多的区块数量。但是这如何做到呢？
所以A想到利用B来帮助他生成。这时候就该引入一个名为验证者轮换的概念。
我们知道在权益证明系统中为了保证系统公平，验证者必须是轮换更替的。
验证者应当可以选择退出，并且区块链系统在某些情况下能轮换更替验证者或是把验证者移除出系统。
在这里，我们假设B在出块999个后选择退出了区块链系统。此时他的私钥也就没有往日那么重要了（因为他已经成为了一个平民）。
然而我们知道，虽然B退出了验证者这个位置，但是他的私钥仍然可以为999区块之前的区块签名，并且具有合法效应。
既然 Bob 在系统中没有任何质押的权益，他就没有任何负向激励不对区块链发动攻击。于是A可以盗取B的私钥，或者贿赂B，迫使B加入到攻击中。
当A得到了B的私钥，他就可以像B一样为区块进行签名，也就是说B帮助A更快速的生成了区块数量，用以赶超主链出块速度。我们称这样的攻击为变节攻击。
### 六、权益流损
长程攻击的第三种类型被称为权益流损。
与上文中提到的内容一样，A作为主链的验证者同时他边记账边密谋从创始区块开始构建自己的分支链。由于验证者的初始信息在创世区块中早已经写好。所以在分支链没有超过主链长度之前，A不会讲分支链广播出去。
为了增加攻击的成功率，A开始主动拖延主链的正常运行速度。也就是说，倘若A的权益占比足够多，这种行为可能会演变为一次活性冻结攻击。每当 A
被选举为主链上的区块验证者时，她都会跳过该块，放弃自己的区块验证的身份。然而这并不会有其他验证者代替其工作，反而在该区块位置不会有新的区块加入到主链中。
然而这样会导致A不能从系统中获得区块验证奖励。但是A会不断从从主链上复制交易并在自己的分支链上广播出去。这样会增加其权益占比。
通过采用这样的策略，一方面拖延主链的出块速度，一方面在分支链上尽可能广播更多的区块，Malory最终可以在自己的分支链上获得绝大部分的权益，并且比主链更快地产生区块。一旦他的分支链长度超过了主链，他就将发布最后一笔交易，将自己的权益交易给其他的验证者，并且紧接着广播发布自己的分支链。
### 七、浪子漏洞
Prodigal Contracts
浪子合约是指交易资金因为漏洞返还给所有者、交易者过去发送给以太网的地址，以及特定地址。这种漏洞就像是空手套白狼，买家得到商品，而卖家无法得到加密货币。
合约可向攻击者指定地址发送以太币，而员工地址变量由于调用消息赋值的工资分发函数缺乏对调用者的检验而导致了资金返还，但是交易却产生了。
对于此漏洞的防御措施如下： 1. 消息发送者地址不在合约存储中且在合约中没有Ether。 2. 调用了CALL(且发生了Ether交换),
DELEGATECALL或SUICIDE。所以要对此类函数进行严格的过滤措施。
### 八、自杀漏洞
智能合约的拥有者可以在以太坊发生故障时选择退回，类似于微信中的撤回选项。但是这个指令也可以被其他人执行，使得交易失败。
而引起此类漏洞的关键就是suicide函数，suicide函数可被攻击者调用 eg： 调用suicide前未检查调用者身份/授权用户列表可被修改。
如攻击函数库，可导致大量依赖合约异常。
而此类攻击的特征如下：执行代码中包含suicide，且消息发送者不在合约存储中。
### 九、参考资料
  * 1 
  * 2 
  * 3 
  * 4 
  * 5 
  * 6 [https://mp.weixin.qq.com/s?__biz=MzIwODA3NDI5MA==&mid=2652526411&idx=1&sn=552c14476376eb813f0a60fe96facb83&chksm=8ce65416bb91dd00c736314e3a61fc173cadb604dbfb3ee28f49b17e0626a9a6c2d7e403307a&scene=21#wechat_redirect](https://mp.weixin.qq.com/s?__biz=MzIwODA3NDI5MA==&mid=2652526411&idx=1&sn=552c14476376eb813f0a60fe96facb83&chksm=8ce65416bb91dd00c736314e3a61fc173cadb604dbfb3ee28f49b17e0626a9a6c2d7e403307a&scene=21#wechat_redirect)
**本稿为原创稿件，转载请标明出处。谢谢。**