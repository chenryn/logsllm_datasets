# OCR Output
## Page 1
云计算与虚拟化技术
第10讲： Analyzing and Optimizing
阮晓龙
13938213680/ PI:EMAIL
http://cloud.xg.hactcm.edu.cn
http://www.51xueweb.cn
河南中医药大学信息管理与信息系统教研室
信息技术学院网络与信息系统科研工作室
2021.11
---
## Page 2
2
讨论提纲
vSphere Monitoring and Performance
性能监控图表
■性能监控工具：resxtop、esxtop、vimtop
■VM optimization
vRealize Operations
■ Intro VMware vRealize Operations (vROps)
■Installation
■ vRealize Operations analytics
■ vRealize Operations integrations
Log management
 Intro VMware vRealize Log Insight
Installation
■
■ Dashborrds and Interactive Analytics
Third-party tools
■使用 SNMP 监控vSphere
河南中医药大学 ／阮晓龙 /13938213680 / http://cloud.xg.hactcm.edu.cn /http://www.51xueweb.cn
---
## Page 3
3
Monitor
Analyzation
建的成
看得见
管的住
用的好
Optimization
Security
Simple
---
## Page 4
中华人民共和国教育部
信息名称
21-0013-1生成日期：
发文机构：教育部办公厅工业和信息化部助公厅
教科信厅函（2021）33号信息类别：教育信息化
内容概述：
教育部办公厅、工业和信息化部办公厅发布《关于理高高等学校网培管理和服务质量的通知》
五、强化校园网络运维服务能力
教育部办公厅工业和信息化部办公厅关于
提高高等学校网络管理和服务质量的通知
数科信厅通〔2021]33号
高等学校应加强校园网络运维保障，对校园网络运行进行监测，配置专业、稳定的运维队伍，保障网络访问流
各省、自治区、直辖市教育厅（教委）、通信管
畅
为更新升级设施、购买服务等工作提供稳定的经费支持，
保障校园网络正常运行；应建立用户服务与支持机
高等学校、部省合硅各高等学校
制，及时排查、处理用户网络故障，提升教职员工和学生的上网体验。鼓励高等学校和基础电信企业进行服务质量
保障校园网络安全，现就有关事项通知如下
监测，建立以用户为导向的服务质量考评机制，提高校园网络服务水平。鼓励高等学校通过购买社会服务的方式引
一、加强校园网络管理统等协调
入外部资源，提供质优价廉的网络服务保障。
由教育行政部门牵头，会同本地电信主管部门建立协同工作机制，
加强
对高等学校和基础电信企业相关行为的规范管理，全面掌据学校校园网络建设和应用情况。离等学校应加强对校园
网络的统筹管理，建立由网信职能部门牵头，基建、后勤，资产、学工等多部门协同配合的工作机制，明确职责分
工.加强与基础电信企业的沟通协调，形成重大事项协商机制，明确各自工作职责，共同提升校园网络质量。
二、提高校园网络环境建设水平
亮等学校应会同基础电信企业加强对校园网络的总体规划，组织科学论证，统筹通信管道、光项、基站、室内
分布系统等设施建设布局，保障校园网络服务质量，推进基础设施共建共享，邀免重复建设。鼓励高等学校建设校
园局域网，统筹有线宽带和无线局域网，由学校统一为教职员工和学生接入校园局域网，再由校园局域网统一接入
公用通信网络。学校新建的建筑应按照《公共建筑光纤宽带接入工程技术标准》等要求，同步设计、部著宽带网络
---
## Page 5
5
虚拟化数据中心基础运维需要关注的问题
· How to monitor and optimize your vSphere environment
VM optimization
 Log management
 vRealize Operations Analytics
Third-party monitoring tools
---
## Page 6
6
VMware提供的监控工具：
，性能图表
、可查看多种系统资源（包括CPU、内存、存储等等）的性能数据。
性能监控命令行实用程序
·可通过命令行访问系统性能的详细信息。
主机运行状况
·可快速识别处于运行状况的主机和出现问题的主机。
事件、警示和警报
·可配置警示和警报并指定触发警示和警报时系统应采取的操作。
系统日志文件
系统日志中包含有关vSphere环境中活动的其他信息
---
## Page 7
7
1.vSphere监控与性能
1.1性能监控图表
vSphere统计信息子系统可收集资源使用情况的数据
■可以周起性的收集一系列衡量指标的数据，对这些数据进行处理后存储到
vCenter Server 数据库中。
）可以通过命令行监控实用程序或通过查看vSphereWebClient中的性能
图表来访问统计信息。
！性能图表只显示已打开电源的主机和虚拟机的实时数据。
阅读：vSphere监控与性能
https://docs.vmware.com/cn/VMware-vSphere/6.7/com.vmware.vsphere.monitoring.doc/GUID-A8B06BE0-
E5FC-435C-B12F-A31618B21E2C.html
河南中医药大学／阮晓龙/13938213680/http://cloud.xg.hactcm.edu.cn /http://www.51xueweb.cn
---
## Page 8
8
vm
 vSphere Client
O、在所有环境中搜索
口
目
 VM-APP-10.10.1.239-Cacti-CentOS 8.4.2105
10.10.1.250
摘要 
监控
配置
权限
数据存储
网络
更新
阻 BBT-Datacenter
问题与警报
最近天
2021/11/20下午1:55:00-2021/11/21下午1:50:00
查看：概览
10.10.115
所有问题
已触发的警报
CPU
内存
10.10.1.16 (待机)
10.10.1.17 (待机)
性能
100
2000k
0
 10.10.1.18
概览
 Group-Manage-Pool 
高级
▼任务和事件
B Application-MIS-vApp
 VM-APP-10.10.1 239-Cacti-CentOS 8.4.2105
任务
 VM-VMware vCenter Server Appliance-10.10.1250
事件
利用率
2021,:00:20
20218:00:20
2120020
2024:08/20
2年012022120620
VM-APP-10.10.1.239-Cacti-CentOS8.4.2105准备就结
VM-APP-10.10.1.239-Cacti-CentOS 8.4.2105使用情况
使用情况(MHz)
已消耗
一扩展
VM-APP-10.10.1.239-C
-CentO58.4.2105使用情况
内存速率
磁盘
2024:0:0
2212:060
240:80
2214010
2024.00:00
2021:10/:20 0
2021210:30 
25240:30 
20212100:30
换入速率
一换出速率
最长延迟
 VM-APP-10.10.1.239-Cacti-CentOS 8.4.2105 使用情况
近期任务
警报
---
## Page 9
9
性能图表类型
性能衡量指标在不同类型的图表中显示，具体取决于衡量指标类型和对象。
表 1-1． 性能图表类型
图表类型
描述
线图
图表可以包含两条线：一条线显示接收的数据包数量，另一条显示传输的数据包数量。
条形图
显示选定数据中心中数据存储的存储衡量指标。在图表中，每个数据存储都会使用条状图形表示。每个条状图
形基于文件类型来显示衡量指标：虚拟磁盘、快照、交换文件和其他文件。
饼图
基于文件类型或虚拟机显示单个对象的存储衡量指标。例如，数据存储的饼图可以显示由占据最大空间的虚拟
机所占据的存储空间总量。
堆栈图
显示具有最高统计值的子对象的衡量指标。所有其他对象将进行汇总，总和数值在其他字样下显示。例如，一
台主机的堆栈CPU使用情况图表显示该主机上消耗最多CPU 的10个虚拟机的CPU使用情况衡量指标。其他
数值包含其余虚拟机的总计CPU使用情况。
主机自身的衡量指标以单独的线图进行显示。
堆栈图在比较多台主机或虚拟机的资源分配和使用情况时十分有用。默认情况下可以显示具有最高数据计数器
值的10个子对象。
---
## Page 10
vSphere中的衡量指标组
10
指标。性能衡量指标是基于对象或对象设备使用逻辑组进行组织的。在一个图表中可以显示一个或多个衡量
指标的统计信息。
表 1-3．衡量指标组
衡量指标组
描述
群集服务
通过使用vSphereDistributed ResourceScheduler、vSphere High Availability或两者配置的群集的性能统计信息。
CPU
每个主机、虚拟机、资源池或计算资源的CPU利用率。
数据存储
数据存储利用率的统计信息。
磁盘
每个主机、虚拟机或数据存储的磁盘利用率。磁盘衡量指标包括IO性能（比如延迟时间和读/写速度）以及作为
有限资源的存储的利用率衡量指标。
内存
每个主机、虚拟机、资源池或计算资源的内存利用率。获取的值为以下之一：
■对于虚拟机，内存指的是客户机物理内存。客户机物理内存是在虚拟机创建时作为虚拟硬件组件提供给虚拟
机并在虚拟机运行时可供其使用的物理内存量。
■对于主机，内存指的是计算机内存。计算机内存是在组成主机的硬件中安装的内存。
网络
物理和虚拟网络接口控制器(NIC)和其他网络设备的网络利用率。可支持所有组件（例如，主机、虚拟机、
VMkernel）之间连接性的虚拟交换机。
电源
每个主机的能量使用情况统计信息。
存储适配器
每个主机总线适配器(HBA)的数据流量统计信息。
存储路径
每个路径的数据流量统计信息。
系统
总体系统可用性，比如系统检测信号和正常运行时间。这些计数器可直接从主机和vCenter Server获得。
虚拟磁盘
虚拟机的磁盘利用率和磁盘性能衡量指标。
虚拟闪存
虚拟闪存计数器。
虚拟机操作
群集或数据中心内的虚拟机电源和置备操作。
vSphere
由VMwarevCenterSiteRecoveryManager执行的虚拟机复制的统计信息。
Replication
---
## Page 11
11
表 1-4．收集时间间隔
收集时间间隔/存档时间
长度
收集频率
默认行为
1天
5分钟
实时统计信息在累计时每5分钟创建1个数据点。因此，每个小时将创建12个数
据点，每天创建288个数据点。30分钟后，收集的6个数据点将汇总并累计为1
周时间范围的数据点。
通过配置统计信息设置，可以更改1天收集时间间隔的间隔持续时间和存档时间长
度。
1周
30分钟
1天统计信息在累计时每隔30分钟创建1个数据点。因此每天可以创建48个数据
点，每周336个数据点。每2小时，收集的12个数据点将汇总和累计为1个月时
间范围的数据点。
不能更改1周收集时间间隔的默认设置。
1个月
2小时
1 周统计信息在累计时每2个小时创建1个数据点。因此每天可以创建 12个数据
点，每月360个数据点（假定每个月30 天）。24小时后，收集的12个数据点将
汇总并累计为1年时间范围的数据点。
不能更改1个月收集时间间隔的默认设置。
1年
1天
1个月统计信息在累计时每天创建1个数据点。因此，每年可创建365个数据点。
您可以 通过配置统计信息设置，更改1年收集时间间隔的存档时间长度。
---
## Page 12
12
数据集合级别
每个收集时间间隔都有一个默认的集合级别，用以确定收集的数据量以及可用于在图表中显示的计数器。集
合级别也称为统计级别。
表 1-5．统计级别
级别
衡量指标
最佳做法
1级
■群集服务（VMwareDistributed Resource Scheduler）－所有指标
在不需要设备统计信息时用于长期性能监
CPU－ cpuentitlement, totalmhz, usage （平均值）, usagemhz
控。
■
磁盘 - capacity, maxTotalLatency, provisioned, unshared, usage
级别1是所有收集时间间隔的默认集合级
（平均值），used
别。
内存 － consumed, mementitlement, overhead, swapinRate,
swapoutRate,swapused, totalmb,usage（平均值）,vmmemctl（虚
拟增长）
网络－usage（平均值），IPv6
■
系统 － heartbeat, uptime
虚拟机操作 － numChangeDS, numChangeHost,
numChangeHostDS
2级
级别1衡量指标
在不需要设备统计信息但希望监控基本统
 CPU - idle, reservedCapacity
计信息以外的信息时，用于长期性能监
■
控。
磁盘－所有指标，不包括numberRead和numberWrite。
■
内存－所有指标，不包括 memUsed 以及最大和最小汇总值。
虚拟机操作－ 所有衡量指标
3级
级别1和级别 2 衡量指标
在遇到问题后或需要设备统计信息时，用
所有计数器的衡量指标，但不包括最小和最大累计值。
于短期性能监控。
■
设备衡量指标
由于检索和记录的故障排除数据量较大,
因此请将级别3用于最短时间期限（日或
周收集时间间隔）。
4级
vCenter Server支持的所有衡量指标，包括最小和最大累计值。
在遇到问题后或需要设备统计信息时，用
于短期性能监控。
由于检索和记录的故障排除数据数较大，
因此请将级别4 用于最短的时间期限。
---
## Page 13
13
表1-6.性能图表视图（按清单对象）
对象
查看列表项目
数据中心
存储所使用的存储空间。
■群集－每个群集的CPU和内存图表的缩略图，以及数据中心内CPU和内存整体使用情况的堆栈图。此视
图是默认视图。
数据存储和数据
■空间－按数据存储的空间使用情况图表：
存储群集
■按文件类型的空间使用情况
■空间使用情况（按虚拟机）
■空间使用情况
注仅当连接到数据存储的所有主机均为ESX/ESXi4.1或更高版本时，数据存储的“性能”视图才可用。仅当启
群集
■主页-群集的CPU和内存图表。
■资源池和虚拟机－资源池和虚拟机的缩略图图表，以及群集内CPU和内存整体使用情况的堆栈图。
■主机－群集内每个主机的缩略图图表，以及总CPU、内存、磁盘使用情况和网络使用情况的堆栈图。
主机
■主页－主机的CPU、内存、磁盘和网络图表。
虚拟机－虚拟机的缩略图图表，以及主机上CPU及内存整体使用情况的堆栈图。
资源池和vApp
主页－资源池的CPU和内存图表。
资源池和虚拟机－资源池和虚拟机的缩略图图表，以及资源池或vApp中CPU和内存使用情况的堆栈图。
虚拟机
存储器－按虚拟机的空间使用情况图表：按文件类型列出的空间，按数据存储列出的空间，以及总空间大小
(GB)。
FaultTolerance－显示容错型主要虚拟机和辅助虚拟机的比较衡量指标的CPU和内存图表。
■主页－CPU、内存、网络、主机（缩略图表），以及虚拟机的磁盘使用情况图表。
---
## Page 14
14
1. vSphere
监控与性能
1.2 性能监控工具
esxtop
vimtop
resxtop
vSphere Cli
ESXi Shell
vCenterServerAppliance
Remote
Local
Local
河南中医药大学 ／阮晓龙/ 13938213680 /http://cloud.xg.hactcm.edu.cn ／http://www.51xueweb.cn
---
## Page 15
15
1.vSphere监控与性能
1.2性能监控工具
esxtop
■在 ESXi Shell中运行，实现对 ESXiHost的监控。
■命令格式：
 esxtop [-h] [-v] [-b] [-s] [-a] [-c config file] [-R vm-support_dir_path] [-d delay] [-n iterations]
resxtop
■ resxtop 是 vSphere CLI 命令。
必须先下载和安装vSphere CLI包，或将 vSphere Management Assistant (vMA)
部署到ESXi主机或vCenter Server 系统，才可以使用。
■命令格式：
 resxtop --server  --username 
vimtop
■监控vCenter Server Appliance 中运行的vSphere 服务。
■类似于 esxtop，在 vCenter Server Appliance 环境中运行。
河南中医药大学 ／阮晓龙 /13938213680 /http://cloud.xg.hactcm.edu.cn /http://www.51xueweb.cn
---
## Page 16
16
2:10:54pm up 39 days 11:52,749 worlds, 1 VMs, 2 vCPUs; CPU load average: 0.01, 0.01, 0.01
PCPUUSED（%):0.20.30.30.1103.12.50.00.60.40.20.10.20.20.00.1AVG:1.2
PCPU UTIL(%) : 0.7 0.6 1.7 0.1 7.7 5.1 4.5 0.1 2.2 1.0 0.7 0.4 @.4 0.3 0.0 0.3 AVG: 1.6
四
ID
GID NAME
NWLD
%USED
%RUN
%SYS
WAIT%VMWAIT
%RDY
WT
2345410
2345410eSxtop.2546574
24
6.32
7.92
0.00
95.41
0.00
0.00
0.00
0.00
0.00
0.00
501006
501006 VM-VMware vCent
5.99
9.53
0.03 2400.00
0.00
0.06
197.56
0.02
0.00
0.00
0.00
1 system
1.02 1600.00
0.00 29730.72
——
44.89
0.00
0.70
0.00
0.00
0.00
8helper
169
0.26
023
00'0
16900.00
0.02
0.00
0.00
0.00
0.00
0.00
4659
4659 ioFilterVPServe
2
0.20
0.01
200.00
0.00
0.00
0.00
0.00
0.00
0.00
461134
461134 fdm.2197854
8
0.15
0.20
0.00 3800.00
0.10
0.00
0.00
0.00
0.00
0.00
453516
453516Vpxa.2196794
88
0.08
0.15
0.00
3800.00
0.06
0.00
0.00
0.00
0.00
0.00
6232
6232 hostd.2098772
31
0.07
0.11
0.00
3100.00
0.07
0.00
0.00
0.00
0.00
0.00
10838
10838 dcui.2099429
4
0.06
0.15
0.00
400.00
0.01
0.00
0.00
0.00
0.00
0.00
1097
1097 vmsyslogd.20975
7
0.04
0.04
0.00
700.00
0.00
0.00
0.00
0.00
0.00
0.00
6393 rhttpproxy.2098
27
0.03
0.04
0.00
2700.00
0.01
0.00
0.00
0.00
0.00
0.00
2345330
2345330 sshd.2546564
1
0.03
0.03
0.00
100.00
0.00
0.00
0.00
0.00
0.00
0.00
5869
5869 hostdCgiServer.
12