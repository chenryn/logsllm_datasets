The Black Art of Wireless 
Post-Exploitation:
Bypassing Port-Based Access Controls Using 
Indirect Wireless Pivots
DEF CON
Gabriel “solstice” Ryan
net user author /domain
Gabriel Ryan
Security Engineer @ Gotham Digital Science
Appsec | Infrastructure Testing | Red Team | Research
@s0lst1c3
PI:EMAIL
PI:EMAIL
New in this presentation:
Hostile Portal Attacks:
§ Steal Active Directory creds from WPA2-EAP networks without network access
Indirect Wireless Pivots:
§ Use Rogue AP attacks to bypass port-based access control mechanisms
WPA2-EAP
Wireless Theory: Evil Twin Attacks
Rogue access point attacks:
§ Bread and butter of modern wireless penetration tests
§ Stealthy MITM attacks
§ Steal RADIUS credentials
§ Captive portals
Evolution of Rogue Access Point Attacks
2002 - Evil Twin attacks documented in “Wireless LAN Security FAQ” - C. W. Klaus [1]
2003 – asleap - Joshua Wright [2]
2004 - Karma Attacks - Dino Dai Zovi and Shane Macaulay  [3]
2008 - Freeradius-wpe - Joshua Wright and Brad Antoniewitz [4]
2014 - Improved Karma Attacks (Mana) - Dominic White and Ian de Villiers [5]
2017 – Lure10 Attacks – George Chatzisofroniou [30]
Evolution of Rogue Access Point Attacks
Rogue AP attacks primarily used to fill two roles:
1. MITM attacks (stealing creds)
2. Breaching WPA/WPA2 networks (gaining access to WLAN)
In this talk: rogue AP attacks as a means of lateral movement. 
Evil Twin Attacks Against WPA2-EAP
WPA2-EAP
Logically:
§ Authentication occurs between supplicant and authentication server [6][7][8]
Wireless Theory: EAP
Without secure tunnel, auth process can be sniffed:
§ Attacker sniffs challenge and response then derives password offline
§ Legacy implementations of EAP susceptible to this (i.e. EAP-MD5… eapmd5hash by 
Joshua Wright in 2008 [13])
The attack: 
§ freeradius-wpe by Brad Antoniewicz in 2008 [4]
§ Force supplicant to authenticate with attacker using evil twin attack [4]
Cracking MS-CHAPv2
Dictionary Attack:
§ success rate inversely proportional to strength of the password [31]
MS-CHAPv2
Divide and Conquer Attack (Moxie Marlinspike and David Hulton, 2012): 
§ MS-CHAPv2 uses same 56-bit DES encryption as NTLMv1 [31] [32]
§ Security reducible to the strength of a single DES encryption [31] [32]
§ Goal: recover NT hash rather than plaintext password [31]
§ 100% success rate in less than 24 hours when using an FPGA cracking rig such as 
Crack.sh (previously Cloudcracker) [33]
Solution: EAP-TLS
§ Introduced in 2008 (wow!) by RFC 5216 [10]
§ Mutual authentication using x.509 certifications a requirement for most 
implementations [10]
§ Strength lies in the use of client-side certificates
Poor adoption rate:
§ Wildly unpopular [11]
§ Client-side certs make EAP-TLS seem considerably more difficult to integrate into 
existing network architecture (more on this later)
§ Classic security vs. convenience scenario
Security vs. Convenience
Network administrators forced to choose between:
§ authentication mechanisms with known weaknesses 
OR
§ a highly secure yet seemingly impractical authentication mechanism
Market Gap
Market gap created for products that meet the following requirements:
§ can be used to compensate for the security issues found in EAP-PEAP/EAP-TTLS
§ are easy to use 
The “solution”:
The current trend:
§ Focus on breach containment, rather than breach prevention
Containment vs. Prevention
Does this actually work? 
Classic WLAN Access Control Mechanisms
Using NACs For WLAN Breach Containment
Network Access Control (NAC) Mechanisms:
§ One of the most popular methods of containing wireless breaches
§ Distinguish between authorized and unauthorized network endpoints [12]
Using NACs For WLAN Breach Containment 
1. New endpoint is added to the wireless network
2. NAC identifies whether new endpoint is authorized or unauthorized device
3. If unauthorized, placed in quarantine VLAN
Two varieties of NAC:
§ Agent-based [12]
§ Agentless [12]
Agent-based NACs:
§ Software component installed on authorized endpoints [12] 
§ Agents communicate with “brain” of NAC [12] 
§ Highly effective
§ Nearly as impractical as EAP-TLS
Agentless NACs:
§ Passive fingerprinting [12]
§ Active scanning [12] 
§ Easier to deploy than agent-based NACs [12] 
§ Unable to examine internals of network components [12]
§ Can be bypassed by masquerading as an authorized device [12]
Recurring dilemma: 
insecurity vs. impracticality
Yet another market gap:
High demand for a solution that offers the deep interrogation capabilities of an agent-based 
NAC, but without the additional overhead. [13]
Next Generation NACs: The Best Of Both 
Worlds?
§ Uses WMI to interrogate new devices [14]
§ Capable of performing internal checks without the use of an agent
§ Authenticates over SMB using a single administrative service account [14]
§ Service account given remote login privileges to all authorized devices at the Group 
Policy level [14]
§ Allows aaaaaaaaa
to perform deep interrogations without the use of an agent [14]
[NOPE]
Single Point of Failure
§ Attempts to authenticate with any new endpoint placed on the network using special 
service account [14]
§ Service account has access to nearly everything on the network
… i.e. - Godmode hashes sent to any new device that is added to the network.
Background Info: SMB Relay Attacks
SMB Relay Attacks
NTLM is a simple authentication protocol:
§ challenge/response mechanism… remember EAP-PEAP? ;)
SMB Relay Attacks
NTLM authentication process:
1. Client attempts to authenticate
2. Server issues challenge to client (string of characters)
3. Client encrypts the challenge using its password hash (uh oh)
4. Client sends encrypted challenge back to server as response
5. Server decrypts response using same password hash (oh no)
6. If decrypted response === challenge, then auth attempt succeeds
SMB Relay Attacks
SMB Relay Attack:
1. Attacker uses MITM or similar to intercept/view NTLM traffic
2. Attacker waits for client to authenticate using NTLM
3. Auth attempt relayed by the attacker to the target server
4. Target server sends challenge back to attacker, which is relayed to client
5. Client response is relayed back to target server
6. Attacker is authenticated with server
Risks: SMB Relay Attacks
§ SMB signing disabled by default on everything but the domain controller (Group Policy 
is downloaded over SMB) [15]
§ No MITM required: the NAC appliance is trying to authentication with you
SMB Signing
§ The SMB Relay issue can be mitigated by digitally signing packets
§ SMB Signing: digitally signing packets to confirm their authenticity
§ Does not address the issue of hashes being sent directly to untrusted endpoints
§ Can be installed to remediate this issue
§ Is essentially a form of agent
§ aaaaaaaaa
chief selling point is that no agent is required
[NOPE]
No magic bullet
§ “Security With Convenience” – this is a paradox
What about Client Isolation?
Wireless Client Isolation
§ Prevents wireless clients from communicating with each other
§ Often used as a security control
§ Typical use case: open networks [16]
How 802.11 Is Supposed To Work:
§ AP mediates all communication on network [16]
§ In theory, client isolation would work [16]
[16]
The Problem:
§ Client isolation is a logical control, not a physical control
§ The problem: “how do you prevent radio transceivers from communicating with one 
another?” [16]
§ Cedric Blancher in 2005: You can’t. [17] 
Introducing Wifitap:
§ First released by the late Cedric Blancher in 2005 [17]
§ Revived by Oliver Lavery of Gotham Digital Science in 2013 [16] 
Introducing Wifitap:
§ Reads packets from victim to AP using WiFi interface in monitor mode [16]
§ Injects responses to those packets as if they came from the AP [16]
Introducing Wifitap: how it works
§ Bridges a Linux tun/tap device with a WiFi interface in monitor mode [16]
§ To interact with network, you interact with the tun/tap interface [16]
§ Allows you to communicate directly with wireless clients without associating with the 
AP [16]
Later tools (that do even more stuff):
Aircrack Suite:
§ airtun-ng (supports WEP) [18]
§ tkiptun-ng (supports WPA1) [19]
Theoretical Attacks:
Considerable debate as to whether these actually work. Worth mentioning for the lulz.
§ Hole 196 [16]
Food for thought
What if we’re missing the point?
NAC Isn’t The Only Problem
The role of NAC in containing WLAN breaches:
§ Used to prevent attackers from accessing sensitive resources after breach occurs
NAC Isn’t The Only Problem
When an unauthorized endpoint is detected, one of two actions is typically taken:
§ Endpoint is placed in quarantine
§ Port is blocked
The role of NAC in a wireless environment: