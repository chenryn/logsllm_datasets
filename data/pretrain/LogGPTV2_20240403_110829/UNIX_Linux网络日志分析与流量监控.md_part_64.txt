NUL
NUL
NUL
body
---
## Page 370
Maxmind网站（www.maxmind.com）查阅相关信息。
库不准，至少国内的IP定位不太精准，但收费服务的效果要比免费的强许多，大家可以到
息。这里面的技术不算难题，关键是要有个精准的数据库。但是免费提供的Maxmind数据
其中包含了每个点的经度（Longitude）、纬度（Latitude）甚至高度（Altitude）。
Language，是一种基于XML 语法和格式的语言，主要用来描述地理信息的点、线等信息。
客户端，通过在KML文件中寻找坐标并定位出路线。这里的KML全称是Keyhole Markup
maxmind.com/download/geoip/database/.
M
连接两台计算机节点。
Xplico系统从抓包获得的 irc_1.pcap 数据包文件中提取出KML 文件，导入到谷歌地球
GeoIP就是通过来访者的IP，定位它的经纬度、国家/地区、省市甚至街道等位置信
IP 地址的定位需要用到一个名为 GeoIP 的数据库。Geolp 的最新地址是 http://geolite.
注意：
（2）用Google Earth 打开KML文件即可看到效果，如图 13-25所示。图中由一条绿线
Search
范桌
图13-25用谷歌地球软件打开KML文件的效果卧出
地球国岸1
防老记米
图13-24保存KML信息
likethis
cancelok
兰第13章网络流量监控347
文国财
S.2.8
1.2.81
香县
9618
---
## Page 371
和网段分割的办法来预防嗅探。
的 HUB 替换成以太网交换机。目前 HUB 这种设备已被淘汰，这时我们通常可采取数据加密
企业的接入层设备多为集线器（HUB），对于这种设备，防止嗅探的最好方式是，将共享式
13.5.2网络嗅探的预防
该数据帧，并对其做出了响应，就说明它工作在混杂模式。
字节是否为广播地址，如果是全F，则认为是广播包。当 Windows 操作系统的驱动程序收到
来的数据包，并将它们传递给内核。当处在混杂模式下时，驱动程序只检测以太网地址的首
会对该数据包做出相应的响应动作。这时就可通过检测计算机是否发回了响应数据包，来确
丢弃该数据帧。但是如果处在混杂模式下，网卡会将该数据帧提交给相应的协议栈，系统将
址的数据包。可以通过该特性检测该计算机是否处在混杂模式下。
13.5.1嗅探器的检测
内是否存在网卡被设为混杂模式的计算机。
才能正常工作，而一般正常服务的网卡都不在该模式下，因此检测嗅探器就等同于检测网络
网络攻击、黑客入侵而开发的。事实上，由于网络分析器具有检查低层传输数据包的能力，
后，用户需要注册一个key，并导入后即可开始使用。具体使用体验可参考http://chenguang.
后启动数据库Postgresql。访问方法是在浏览器中输入http://localhost:9877，当显示登录界面
方便。在DEFT8中的启动方法是，首先启动Apache服务，然后启动Cap Analysis服务，最
化后，新版本还增加了对国内主流邮箱的WebMail协议的支持，并且添加了对即时通信软件
和FTP协议的支持，并且已经可以运用到实际环境中。另外对XPlico系统进行了改进和优
348UNIX/Linux网络日志分析与流量监控
认该计算机是否存在嗅探器。
所以我们可以很方便地使用分析器来对网络进行诊断。由于噢探器必须将网卡设为混杂模式
13.5
blog.51cto.com/350944/1325742。
协议的支持，功能更加完善。
防止网络嗅探器攻击并不是一件很困难的事情，在十几年前，网络结构较为简单，很多
如果发送非法目的MAC地址（例如88:88:88:88:88:88的数据帧），在正常模式下网卡将
接下来简单介绍另一款Cap 数据包分析工具CapAnalysis，它也是B/S 架构，使用非常
了解了网络分析器的工作原理之后，读者应该认识到网络分析器（嗅探器）并不是专为
Xplico 系统具备了基础的上网行为审计和分析功能，包括对HTTP协议、SMTP、POP3
在正常模式下，网卡只接收本机网卡的地址或以太网广播地址（FF:FF:FF:FF:FF:FF）发
（2）Windows操作系统下的检测方法
在正常模式下，网卡会过滤和丢弃那些MAC地址不是广播地址且不是该网卡MAC地
（1）Linux操作系统下的检测方法
对于Linux与Windows 操作系统来说，嗅探器的检测方法并不一样。
网络嗅探器的检测及预防
---
## Page 372
看用户操作的完整视频内容。
审计工具，应用这种工具后，当管理人员登录到ObserveIT后台点击视频回放，就能轻松查
SSH/RDP的方式，这时就得用到国外的一款商业软件ObserveIT，这是业界著名的加密协议
流。如果发现了在某一网络地址段有嗅探器，也很容易确定是哪些人设置的。
计算机。通过网络分割，使得安装了嗅探器的计算机仅能够捕获有限范围内计算机的信息
PC、工作站或服务器都可以配置成网桥或路由器，同一个网络地址段内最好都是互相信任的
了。一般可以采用交换机来划分网段，并使用网桥或网络路由器来划分子网。实际上普通
一步划分网络，减小嗅探器能够监听的范围，这样网络的其余部分就可避免嗅探器的攻击
络广播时，信息包只能被同一网络地址段中的噢探器捕获。所以可以利用网络分割技术，进
那么账号和安全密码被捕获的概率将大大降低。
方式，适合所有的通信。SSH曾是加密安全通信的主要协议。如果网络系统中使用了SSH，
算法建立连接验证过程结束后，所有的信息都采用IDEA技术加密，这是一种典型的强加密
听者从网络上截取各种数据包的相关信息后，通过分析或脱壳解密得到其想要的东西。
有找到比穷尽算法更有效的破解办法。这两种办法实现起来较简单，可它们不能完全阻止监
一个迭代值和一个种子值计算出本次登录的密码。
（One TimePassword，OTP）系统。在使用OTP的系统中，用户在登录时会根据主机提出的
通常人们所能接受的防止嗅探器攻击的办法是使用安全的网络拓扑结构。我们知道，
有些特殊部门需要对远程连接到服务器的人员所做的操作进行记录，他们一般会选择
举个实例，SSH是基于C/S模型的，标准的SSH服务端口为22，SSH采用RSA加密
：如果需要保护电子邮件免遭窃取，可以对邮件使用PGP加密软件，对该算法目前还没
2.网段分割
注意：
如果仅需要防止远程登录时用户账号和安全密码被截取，则可以在主机上安装动态密码
1.数据加密
第13章网络流量监控349
区
---
## Page 373
图14-1所示。
的核心工作在于集成和关联各种开源的安全产品提供的信息，同时进行相关功能的整合。如
Nmap、OpenVAS、Nessus及Ntop等开源软件），把它们集成在开放的体系中。OSSIM项目
并不是要开发一个新的功能，而是充分利用丰富的、强大的各种程序（包括Mrtg、Snort、
能够更好地进行监测和显示的框架式系统。OSSIM明确定位为一个集成解决方案，其目标
从而提供一种能够实现安全监控功能的基础平台。它的目的是提供一种集中式、有组织的，
件、蠕虫、网络钓鱼等，严重威胁着网络安全。而OSSIM系统通过将开源产品进行集成，
越高，已不再局限于传统病毒、木马、僵户网络、间谍软件、流氓软件、网络诈骗、垃圾邮
14.1.1概况
14.1
网络威胁已经从传统的病毒进化到蠕虫和拒绝服务等恶意攻击，而且攻击复杂程度越来
QQ
Snort
OpenVAS)
Nessus)
QC
Nmap)
POF
NOp
HIDS
OSSIM的产生
NIDS
扫描/渗透工具集
条坊10业有美一快国候
站回告点合edO使录整员人Sensor
第14章
监控
DS
图14-1OSSIM整体结构
OSSIM综合应用
OSSIM
—架构
Databases
Servers
Consoles
H22
资产管理OCS
排序功能
整合功能
MySQL
系统配置
风险监控
风险评估
组件
日志统计分析
NIDS模块
异常探测
异常探测
IDS
应用程序管理
服务管理
主机名管理
操作系统管理
---
## Page 374
开源两种解决方案，本章介绍的OSSIM系统就是SIEM的开源解决方案。
管理这一概念。原来也有人称之为安全事件管理（SEM）或安全信息管理（SIM），现在简称
析，例如寻找拒绝服务攻击或者蠕虫病毒之类特定威胁等。对于这种需求逐渐产生了安全事件
中需要将大量看似正常的日志收集起来，并从中快速筛选可疑的网络事件，以供进一步调查分
路由器、服务器，以及应用程序（数据库、客户关系管理系统等），如图14-2所示。实践工作
食源太
它只是从不同类型的系统、设备上收集并保存日志，其中系统和设备涵盖了交换机、防火墙、
14.1.3安全信息和事件管理（SIEM）
地减少IT系统故障可能导致的损失，提高工作效率，进而降低运维成本。
各个安全防御系统的协作，通过对已有安全信息系统的合理分析，可以发现威胁事件，有效
理、网络安全到系统维护等统一协调管理，将现有的监控和维护手段有机地联系起来，实现
后获得了三千多万美元的投资，旗下的OSSIM产品开发非常迅速。
提高安全防护水平。2012 年的全球 IT 市场对 SIM的需求十分强劲，例如 AlienVault 公司先
生，它可以结合网络中心的现状，实现网络、系统、环境、安全等集中式的综合管理，最终
孤岛，难以发现安全隐患。所以，
但也引发了一个新的问题一
描系统及各种各样的防病毒系统，这些部署应用确实在很大程度上起到了安全防御的作用，
章的案例中有生动说明）。为了应对各种安全挑战，企业开始部署防火墙、IDS/IPS、漏洞扫
既包括企业外部各种入侵行为，也包括企业内部的各种违规操作，以及信息的泄露（在前几
同IT安全领域常面临着很多无法掌控的复杂局面，这必然会导致安全风险出现，这些风险
14.1.2从SIM到OSSIM
OSSIM可以从各种应用程序和设备收集日志，通过对安全态势的充分了解，将各个监
日志管理是网络安全的基础工作之一。通常情况下日志管理并不涉及数据分析与挖掘，
OSSIM（OpenSource+SIM），通过建设统一的综合管理平台体系，从而实现从机房管
目前，市场上没有哪家的系统能把上述这些设备都统一起来，防护设备就是一个个安
各类服务器日志
一整套防御系统给企业网络环境带来难以承受的复杂性。
图14-2OSSIM日志收集途径
AlienVault
网站
路由、交换机、无线设备日志
量第14章OSSIM综合应用351
一
趣型热克Mle20
）全
---
## Page 375
采集数据的目标系统是Windows，则需要考虑使用WMI协议，在Windows上进行相关配
系统都安装有 Snmp 与 Syslog 工具，所以采集数据时不需要再额外安装其他工具软件。如果
进行所采集数据的抓取；Syslog 协议则被动接收采集数据。在 UNIX/Linux 环境下，大部分
Syslog、WMI 等协议进行数据的采集。其中 Snmp 与 WMI 协议需要 Agent 采集数据时主动
（monitor）插件两种。每个插件都有 ID 号和 SID号。Detector 插件，主要通过 Snmp、
听业商
飞
（Database）、Web 框架（Framework）共5个子系统构成。逻辑结构图如14-3所示。
14.2.1OSSIM架构
与所受到的威胁和用户身份信息相关联，以提供切实可行的解决方案。
了云时代的一大特征，不仅能够每天处理企业中庞大的各类网络事件，而且能够将这些事件
更为全面的病毒库资源，准确地提供解决方案。OSSIM中提供的SIEM这一特点无疑体现出
法做到提前预警，更谈不上真正做到防患于未然。
拦截、隔离、清除的具体方式方法上各有千秋，但受限于技术条件，这些安全领域的企业无
面。针对病毒、木马、网络攻击，基本都采用“兵来将挡、水来土掩”的方式。虽然在实施
纵观国内不少企业信息化已部署了安全防线，这在很大程度上仍属于“事已发而后知”的局
控节点联系起来，形成一个数据链，经过关联分析就能对黑客攻击行为向管理员发出预警。
352UNIX/Linux网络日志分析与流量监控
OSSIM系统由安全插件（Plugins）、
14.2
如今，云查杀正在取代传统的单机病毒库，它可以将数据及时反馈到云端服务器，利用
OSSIM系统里插件非常之多，可以将它们划分为检测（detector）插件和监视
1.安全插件（Plugins）
OSSIM架构与原理
Sensor
LOG
111
图14-3OSSIM系统逻辑结构
、代理进程（Agent）、关联引擎（Server）、数据库
rve
Te
MIE
---
## Page 376
进行解释：
Agents 查看。其结构如图 14-4 所示。下面对图中关键信息
WebUI界面下的Analysis→Detection下的HIDS标签中
ossim/agent/config.cfg。OSSIM系统的代理信息可通过在
插件目录在/etc/ossim/agent/plugins/，配置文件路径：/etc/
是数据库的3306端口。
agent/config.cfg 配置文件的选项[output-server]中端口设置能看出通信端口为40001），另一
去。Agent 会主动连接两个端口与外界通信，一个是 Server 的40001 端口（在/etc/ossim)
实时，收集的事件信息通常会在 Agent 端缓存一段时间，经过预处理后才会发送到 Server 端
确保日志不丢失也不漏发。在免费版的OSSIM系统中，其日志处理大部分情况下很难做到
和 Server之间的网络中断、拥堵、丢包，以及 Server端可能接收不过来甚至死掉等情况下，
化处理，然后有序地传送给OSSIM的 Server。它的功能很复杂,因为它的设计要考虑Agent
将采集到的各类信息统一格式存储，再将这些数据传至 Server。
行）将运行在单个或多个主机上，负责从各安全设备采集相关信息（比如报警日志等），并
项中也详细列出了monitor和检测插件detector分别有哪些内容。由备
达式（RegExp）。在今后安装过程中选择多少插件系统就在开机时加载多少。要查看插件详
“.cfg”的文本文件，可以用任何编辑器修改。在每个插件配置文件中最难理解的就是正则表
plugins/目录中，如果你配置过Nagios 插件，对OSSIM 插件就不会陌生，它们是扩展名为
OSSIM将它们集成起来，这是安全集成的目的所在。OSSIM主要安全插件如表14-1所示。