Norton互联网Security
迈克菲公司（McAfee）
Total Protection
互联网Security
卡巴斯基公司（Kaspersky）
互联网Security
图5-4
Windows防火墙例外选项卡的设置（WindowsXP）
indows 防火始
常规例外高级
Vindons 防火增正在帮助保护您的电前
0（
在这里开启防火墙
不允许例外（）
在不大安金的止到公共网时请项
上的选择
哄，在时
X
关闭（不推荐））
了解Yindows防火描的其他信息
确定取消
防火墙
常规例外高级
i外程能程东里好除工程，富碍席扣服多圣处的传入网络连接。添
程序和服务
名称
话通
HomeShare
MyIE2 Web Brow
没有勾选的应用程序在与外部
通信时，会被Windows防火
udate Micr
基础类应用程序
Pn框架
墙拦截
宽带拨号客户端
网络娱乐内容平台
口文件和打印机共享
口远程协助
添加程序添加端口编辑
册除
Windos防火墙阻止程序时通知我D
允许例外存在什么风险？
确定取消
---
## Page 254
240|第5章防火墙功能与防范威胁的对策
图5-5Windows防火墙高级选项卡的设置（WindowsXP）
indows防火始
常规例外高级
网路连接设置
1
外下选摔的接接息用革置防火，为每个连接单独添加例
1394连接
设置（）
本地连接
宽带连接
回宽市注接d：Conter
安主日志记录
②
您可以创建用于疑难解答的日志文件。
设置）
默认设置-
④
确定取消
表5-5
Windows防火墙详细选项卡的设置内容
设置内容
说明
①网络连接设置
对每一个同Internet连接的网络接口进行访问控制配置，配置内容包括可能访问本地
计算机的外部网络服务或ICMP等。这里的网络服务可以是指本地计算机对外提供
FTP、Telnet、HTTP等服务的情况，也可以包括本地计算机为作为远程桌面使用时，
能够被外部访问的各个目标应用程序
②安全日志记录
通过设置该项，Windows防火墙能够记录丢弃的分组日志以及连接成功的日志
③ICMP
以计算机为单位，设置是否允许接收ICMP通信，还能够进行EchoRequest接收以
及TimeExceeded发送等ICMP类型的设置。在“网络连接配置”中，也可以对每
个网络接口进行同样的设置
④默认设置
还原Windows防火墙的默认设置
网关型防火墙
在计算机网络的网关中设置类似防火墙设备的功能，从而对网络中通信流量进行策略控制，
这种类型的防火墙即为网关型防火墙。
网关型防火墙分为两类，一类是在Windows、Linux等通用操作系统上安装并运行
FireWall-1软件的软件型网关防火墙，一类是使用专用设备的硬件型网关防火墙。
个人防火墙主要监控所有到达个人计算机的通信流量，而网关型防火墙则需要监控来自多数
不特定终端设备的通信流量，并在它们通过网关时实施策略控制。
---
## Page 255
05.03防火墙如何分类|241
表5-6个人防火墙与网关型防火墙的主要区别
个人防火墙
网关型防火墙
安装位置
用户的个人计算机上
Windows或Linux等服务器上
网络上的位置
终端处
网关处
安全监测对象
流入终端的通信流量
流经网关的所有通信流量
加密通信
在终端上解密后检查
不能检查（有时也能够对SSL通信等进行解密）
压缩文件检查
解压后检查
对解压方式、解压级别有限制
对附带口令文件的检查
输入口令后解压检查
不能检查
05.03.02
硬件型防火墙
硬件型防火墙是指通过硬件设备实现的防火墙，外形同路由器形状类似，但网络接口类型一
般只支持以太网，包括10/100/1000BASE-T的RJ-45以及支持千兆以太网、万兆以太网收发器的
接口模块（表5-7）。
表5-7
主要的硬件防火墙产品
厂商名称
产品名称
照片
思科公司
ASA系列
ASA5540
Juniper 公司
SSG系列
SRX系列
SSG20
SRX210
CheckPointSoftwarePower-1系列
Technologies公司
IP安全设备系列
IP1285
PaloAltoNetworks公司
PA系列
PA-5050
Fortinet公司
FortiGate系列
FortiGate-300C
---
## Page 256
242|第5章防火墙功能与防范威胁的对策
05.04
防火墙技术类型
防火墙在网络边界判断充许进行的通信和不被允许的通信，作为其判断依据的技术类型按表
5-8的顺序逐步演进。
表5-8防火墙技术类型的演进
防火墙技术类型
年代
说明
分组过滤型
1988年
属于第一代防火墙技术，在尚没有专用防火墙设备时，一般由路由器实现该
功能
参考网络上传送的IP分组首部以及TCP/UDP分组首部，获取发送源的IP地址
和端口号，以及目的地的IP地址和端口号，并将这些信息作为过滤条件，决定
是否将该分组转发至目的地网络
分组过滤的执行需要设置访问控制列表。访问控制列表也可以称为安全策略（简
称策略）或安全规则（简称规则）
有关安全策略的详细信息请参考05.07节
应用网关型
1989年
属于第二代防火墙技术。不再以分组为单位进行通信过滤，而是由网络中既存
的网关（防火墙）特定的应用程序会话
电路层网关型
1990年
防火墙不再根据IP分组首部和TCP分组首部进行过滤，而是在传输层上进行连
接中继（第四层代理），具体通过SOCKS协议实现
当内网终端连接外部网络时，将会针对电路层网关建立TCP连接，从而在网关
和外部网络服务器之间建立新的TCP连接
通过使用电路层网关，无需在策略中设置安全认证端口信息和NAT，即可从拥
有私有地址的内网终端连接至外部网络
状态检测型
1993年
动态分组过滤的一种，通过检测TCP的连接状态阻挡来路不明的分组，英文缩
写为SPI。使用状态分组检测能够有效抵抗下面这些类型的攻击
·伪装IP地址或者端口，发送附带TCP的RST或FIN标志位的分组，随意中止
正常通信的攻击
·在允许通信的范围内发送附带TCP的ACK标志位的分组，从而入侵内部网络
·在FTP通信时，无论是否建立控制连接，都会创建数据连接进而入侵内部网络
新一代防火墙
2007年
不仅根据端口号或协议号识别应用程序，也不仅根据IP地址识别用户信息，而
是根据上述所有信息执行安全策略来进行防御。例如，在传统的防火墙中会记
录“允许进行10.1.1.1的IP地址到端口80的通信”这一安全策略，但在新一代
的内容
网络路径上只要有防火墙，就会存在不少为了回避防火墙、查找开放端口而
开发的端口扫描程序，这类应用程序无法通过基于端口的防火墙防御。另外，
综上所述，以应用程序为单位进行通信控制非常重要，因此诞生了新一代防火
墙技术
---
## Page 257
05.04防火墙技术类型|243
■代理服务器
代理服务器是应用网关型防火墙的一种。
在Linux所使用的代理服务器中，有一款叫做Sguid的免费软件。
代理服务器的硬件设备有BlueCoatSystems公司开发的SG系列。
另外，还有一些应用了代理服务器功能的设备产品兼顾了网关型防毒功能和URL过滤功能
等（如趋势科技公司的IWSM、DigitalArt公司的D-SPA系列等）。
什么是代理
例如，HTTP代理对应的网关在从用户（客户端）处收到HTTP通信请求后，自身将代替客
户端向HTTP服务器发送HTTP通信请求。从客户端的角度来看，网关即其通信终端。由此，在
客户端与网关，网关与HTTP服务器之间分别生成两个会话（如图5-6所示）。如果像这样网关
成为客户端的代理，由代理和真正的服务器之间进行通信的话，就会实现以下情况。
·从客户端收到的请求或从服务器端得到的响应会在应用层进行检查，如果发生异常则放弃
通信或者发送出错信息。
·由于网关是会话的起点，因此可以对互联网上的外部服务器隐藏客户端的IP地址。
图5-6代理（应用层网关）和其他硬件的不同
经由代理服务器的情况
TCP连接
代理中介
客户端PC
代理服务器
Web服务器
·经由防火墙的情况
TCP连接
除了应用网关型之外的防火墙
客户端PC
Web服务器
---
## Page 258
244|第5章防火墙功能与防范威胁的对策
图5-7经由代理路径的分组的变化
③
发送源
目的地
发送源目的地
发送源
目的地
发送源目的地
IP地址
IP地址
端口号端口号
IP地址
IP地址
口口
192.168.1.5192.168.1.252123458080
10.1.1.25210.1.1.52345680
客户端PC向代理服务器发送目的地端口
Web服务器从代理服务器处接收到HTTP
为8080的HTTP请求
请求并进行处理，而来自PC客户端的
L3、L4首部信息并不到达Web服务器
客户端PC
代理服务器
Web服务器
192.168.1.5 192.168.1.252
10.1.1.252
10.1.1.5
②代理服务器向端口为80的Web服务器转发客户
端PC的HTTP请求
分组过滤型的防火墙以所有使用IP或TCP/UDP的通信为对象，判断是否充许通信。而应
用网关型的防火墙仅以通过网关的应用程序为对象，具体而言就是将FTP、HTTP、Telnet、DNS
等作为处理对象的应用程序来进行判断。
与在传输层进行数据检查的分组过滤型不同，应用网关型防火墙在应用层进行数据检查，因
此处理速度相对较慢。
05.05什么是防火墙的网络接口模式
防火墙功能设备网络接口模式的种类如表5-9所示。有些功能设备在一个机框内能组合出多
种模式，但是只能使用其中的一种接口模式。L1~L3模式如图5-8所示，是将需要防火墙控制的
链路进行“串行”连接，这样的拓扑结构称为内联（inline）连接，英语为on-a-stick，所以防火墙
的“串行”也称为Firewall-on-a-stick，如果是路由器的“串行”则称为Router-on-a-stick。
TAP?模式正如图5-9所示，该模式仅有一条来自交换机的链路构成，这样的链路组成结构
也称为单臂（one-arm或者one-armed）拓扑。
①这里的TAP是指能够提供一种方式访问在计算机网络之间流动的数据的装置。——译者注
---
## Page 259
05.06防火墙能够预防的威胁|245
表5-9网络接口模式的种
接口模式
说明