### 晶片卡弱点分析

**演讲者：倪万升 (Anderson Ni)**
**日期：2010年7月1日**

---

### 议程
1. MIFARE 安全漏洞探讨
2. ATM 卡与网路ATM安全漏洞探讨
3. 台北国际花博览会门票安全漏洞探讨

---

### MIFARE 安全漏洞探讨

#### MIFARE 介绍
- **RFID (ISO 14443-3 Type A with MIFARE, 13.56 MHz, 距离10厘米)**
- **存储卡 (S50: 1K字节, S70: 4K字节)**
- **扇区结构 (每个扇区64字节)**
  - 数据块 (Block 0, Block 1, Block 2: 各16字节)
  - 密钥块 (Block 3: 16字节)
  - 总共16个扇区，每个扇区64字节，总计1024字节 (1K字节)

#### MIFARE 的弱点
1. **密钥长度**
   - MIFARE Key A/B的密钥长度为48位
   - 相比之下，Triple DES的密钥长度为112或168位，AES的密钥长度为128、192或256位
   - 即使密钥验证失败多次，卡片也不会锁定
   - **暴力破解攻击**：研究表明，使用100个读取器同时工作可以在两周内破解一个密钥。

2. **随机数生成器**
   - 随机数生成器基于32位线性反馈移位寄存器 (LFSR)
   - 种子值由计时器决定，计时器从通电开始计数
   - 如果能够控制时间，就可以控制随机数

3. **Crypto 1 算法**
   - 使用48位LFSR和表查找进行加密
   - 加密算法存在弱点，容易被破解

#### MIFARE 对抗弱点的方法
- **防伪验证码** (使用DES或Triple-DES)
- **黑名单机制与卡片锁卡标志**
- **摄像头监控** (用于大多数交通应用和小额消费)

---

### ATM 卡与网路ATM安全漏洞探讨

#### ATM 卡介绍
- **个人数据** (账户、银行ID等)
- **用户PIN码**
- **银行与卡之间的认证密钥**
- **支持DES、Triple-DES和TAC算法**
- **EAL 4+级安全硬件**

#### ATM 卡交易流程
1. **验证PIN**
2. **选择文件并获取数据**
3. **生成TAC**
4. **账户转账**

#### ATM 卡的安全弱点
1. **PIN明文传输**
2. **验证PIN后可以生成多次TAC**
3. **中心未提供必要的信息给ATM卡以生成TAC**

#### 中间人攻击
- 黑客通过中间人攻击篡改交易数据
  1. 用户在PC屏幕上看到的是数据A
  2. Web ATM将数据A发送到ATM卡，但恶意软件将其改为数据B
  3. ATM卡生成数据B的TAC
  4. Web ATM发送数据A | TAC B
  5. 浏览器发送数据B | TAC B
  - **结果**：转账成功

#### 结论
- **不要使用网路ATM**

---

### 台北国际花博会门票安全漏洞探讨

#### 门票介绍
- **票种**：一日票、三日票、Easy Card 和 CHT NFC
- **一日票和三日票使用MIFARE Ultra Light**
  - 存储卡 (仅64字节)
  - 无密钥区块

#### MIFARE Ultra Light 结构
- **UID (7字节)**
- **OTP Flag (3字节)**
- **OTP Data (48字节)**

#### 门票示例
- **示例1**
  - UID: 1474B85B02CB1B8052
  - OTP Flag: 480000
  - OTP Data: 6C72DBD0 ... F181B21A
- **示例2**
  - UID: 04845481E2AD1B80D4
  - OTP Flag: 480000
  - OTP Data: 490ECB35 ... F1CE2D3A

#### 门票攻击方法
1. **克隆攻击**
   - 先购买团体票，然后复制所有数据，制作多张相同的卡片
   - 若无黑名单机制，克隆卡可无限重置继续使用

2. **修改卡片内容**
   - 将一日票或三日票修改为三天票
   - 进场后若未记录出场时间或未关闭OTP flag，可以清除数据或将原始数据写入，变成一张未使用的卡

---

### 问答环节

谢谢大家！