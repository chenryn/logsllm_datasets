晶片卡弱点分析
MIFARE, ATM Card & 花博门票
Anderson Ni 倪万升
2010/07/01
Agenda
 MIFARE 安全漏洞探讨
 ATM Card与网路ATM安全漏洞探讨
 台北国际花博览会门票安全漏洞探讨
Sector (64 bytes)
Sector (64 bytes)
Sector (64 bytes)
Introduction of MIFARE
 RF ID (ISO 14443-3 Type A with MIFARE,13.56 MHz, 
Distance 10 cm)
 Memory Card (S50 1K bytes, S70 4K bytes)
Sector (64 bytes)
Block 0 (Data Block, 16 bytes)
Block 1 (Data Block, 16 bytes)
Block 2 (Data Block, 16 bytes)
Block 3 (Key Block, 16 bytes)
Sector 0
Sector 1
…
Sector 15
Key A(6 bytes)
Access Con.
Key B(6 bytes)
16 * 64 = 1024 bytes = 1K bytes
Weakness I of MIFARE
Key Length
 Key Length of MIFARE Key A/B is 48 bits
 Key length of Triple DES is 112 or 168 bits and key length of 
AES is 128 , 192 or 256 bits
 Key won’t lock even if key 
authentication failed too 
many times!
Brute Force Attack!!!!!                   (图片来自于网路)
=> By the thesis, we can use 100 reader at the same time to 
get 1 key in 2 weeks…
Weakness II of MIFARE
Random Number Generator
 The Random Number Generator is 
designed by LFSR-32 bits…
 But… the seed is decided by the value of 
timer… and the timer will start to count 
from power on…
 If We can control the timing… we can 
control the random number!
Weakness III of MIFARE
Crypto 1 Algorithm
LFSR 48
Table
+
+
+
LFSR 16 
expend to 32 bit
Key Stream
Ntag
Ntag
Tag UID
NR
Key A/B
Three Pass Authentication
TAG
Reader
Auth Block (Key A / B)
Ntag
Nr ^ KS1,  Suc2(Ntag) ^ KS2
Suc3(Ntag) ^ KS3
Anti-Collision & Select Card (UID)
MIFARE Against from Weakness
 防伪验证码 (by DES or Triple-DES)
 黑名单机制与卡片锁卡旗标
 除特定消费方式,大部分交通应用或小额
消费均有摄影机…
Introduction of ATM Card
 Personal Data (Account, Bank ID.. etc)
 User PIN
 Authentication Keys between Bank and 
Card
 Supporting DES, Triple-DES and TAC 
algorithm
 Secured Hardware with EAL 4+
Transaction of ATM Card
ATM 
Card
Server of 
Bank
Verify PIN
Response
Select File
and Get Data
Response
Generate TAC
TAC
Response
Account
Transfer
Weakless : PIN明码传输
Weakless : Verify PIN后可
产生多次TAC
Weakless : 中心无提
供必要资讯给ATM Card
作为产生 TAC 用
Transaction of ATM Card
ATM 
Card
Server of 
Bank
Verify PIN
Response
Select File
and Get Data
Response
Generate TAC
(with Server Data)
TAC
Response
Account
Transfer
Transaction number, 
Random Number, 
Unix Time
Transaction
Request
交易资讯部分由Server决定,
除了随机性且具有唯一性!!
Middle-Man-Attack on ATM Card
ATM 
Card
Server of 
Bank
User
Hacker
SSL to protect the data transfer…
But Hacker uses Middle-Man-Attack…
1.Transaction on PC 
screen is Data A
2. Web ATM will send Data A to ATM card,
but the Troja will change the Data A to B
3. ATM Card will generate the TAC of Data B…
4.Web ATM send Data A | TAC B
5. Browser send Data B | TAC B
Troja to attack ATM 
Card and Web ATM
转帐成功!!!!!!!!
Conclusion of Web ATM and 
ATM Card
不要使用网路ATM…
2010台北国际花博门票介绍
 一日票, 三日票, Easy Card and CHT 
NFC 
 一日,三日票使用MIFARE Ultra Light
 Memory Card (64 bytes only)
 无金钥区块
MIFARE Ultra Light (64 Data bytes only)
Data Bank (48 bytes)
Data Bank Flag + OTP Data
UID(7 bytes)
Example 1 of 花博门票
MIFARE Ultra Light (64 Data bytes only)
UID
1474B85B02CB1B8052 
OTP Flag
480000 
OTP Data
6C72DBD0 
578EC8870000000000000C080000F303
00000000000001020801100000000001
FD3A00000000000000000000F181B21A
Example 2 of 花博门票
MIFARE Ultra Light (64 Data bytes only)
UID
04845481E2AD1B80D4 
OTP Flag
480000 
OTP Data
490ECB35
934492FB0000000000000C080000F303
00000000000001020801100000000001
FD3A00000000000000000000F1CE2D3A
Attacking of 花博门票 - Clone
 Clone Card – 事先购买团体票后,进行卡
片所有资料之Clone… 并且伪造相同资料
之卡片,即可有两张同资料之卡片可供使
用
(若无黑名单机制,Clone之卡可无限进行
重置继续使用)
Attacking of 花博门票- Change
 修改卡片内容 – 将卡片内注记为一日或
三日卡的部份修改为3日
 若进场后,注记进场时间,但未注记出场时
间或未将OTP flag关闭,可将本资料清除
或将原始卡片资料写入,又是一张未使用
的卡
 其他
Thank You!!
Q & A