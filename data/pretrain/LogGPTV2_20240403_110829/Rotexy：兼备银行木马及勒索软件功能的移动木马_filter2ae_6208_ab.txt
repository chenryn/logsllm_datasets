  * ALLMSG – 向C&C发送用户收到和发送的所有短信，也包括存储在手机内存中的所有短信。
  * ALLCONTACTS – 将手机内存中的所有联系人发送到C&C服务器。
  * ONLINE – 将木马当前状态相关信息发送给C&C服务器：是否具有设备管理员权限、当前显示的HTML页面、屏幕处于打开还是关闭状态等。
  * NEWMSG – 将SMS写入设备存储器，其中包含从C&C发送的文本和发件人号码。
  * CHANGE_GCM_ID – 更改GSM ID。
  * BLOCKER_BANKING_START – 显示网络钓鱼HTML页面，用来输入银行卡详细信息。
  * BLOCKER_EXTORTIONIST_START – 显示勒索软件的HTML页面。
  * BLOCKER_UPDATE_START – 显示伪造为更新页面的HTML页面。
  * BLOCKER_STOP – 阻止显示所有HTML页面。
Rotexy的C&C服务器不仅可以由Web服务器来承担，还可以由任何可以发送SMS的设备来承担。
木马会拦截传入的SMS消息，并可以从这些消息中接收以下命令：
  * “3458” — 从应用程序撤消设备管理员权限；
  * “hi”, “ask” — 启用和禁用移动互联网；
  * “privet”, “ru” — 启用和禁用Wi-Fi；
  * “check” — 将`install: *[device IMEI]*`文本发送到发送该短信的电话号码；
  * “stop_blocker” — 停止显示所有已阻止的HTML页面；
  * “393838” — 将C&C服务器地址更改为SMS中指定的地址。
Rotexy执行的所有操作相关信息均记录在本地数据库中，并会发送到C&C服务器。随后服务器会返回响应数据，其中包含下一步要执行的操作。
### 显示HTML页面
现在让我们来分析一下Rotexy可以显示的HTML页面，以及木马会使用这些页面执行哪些操作。
1、木马显示一个伪造的HTML更新页面（`update.html`），可以长时间挡住设备的屏幕。
2、木马显示敲诈设备的敲诈页面（`extortionist.html`），并要求用户支付勒索赎金以解除设备阻止。该屏幕截图中的色情图片已被打上黑色马赛克。
3、木马显示一个网络钓鱼页面（`bank.html`），提示用户输入银行卡详细信息。该页面模仿合法的银行页面，并挡住设备屏幕，直到用户输入所有信息为止。木马甚至拥有自己的虚拟键盘，假装可以保护受害者不受键盘记录器的影响。
在`{text}`标记的区域中，Rotexy会显示从C&C服务器收到的文本。通常该字段为一条消息，声称用户已收到汇款，必须输入用户的银行卡详细信息，才能将钱转移到用户的帐户中。
然后木马会检查用户输入的数据，还还根据C&C服务器命令中发送的数据来检查银行卡号的最后四位数字。具体攻击中可能会出现以下这种情况：根据收到的SMS消息的处理模板，Rotexy会拦截来自银行的消息，该消息中包含与用户电话号码绑定的银行卡的最后四位数字。木马将这些数字发送给C&C服务器，C&C服务器又会返回命令，显示伪装的数据输入窗口以检查这四位数字。如果用户提供了另一张卡的详细信息，则会显示以下窗口：
图 显示提示消息：“您输入的卡片不正确，请输入尾号为1234的银行卡“
这样一来，用户只能输入正确的卡号，因为木马会检查输入的号码是否与攻击者之前收到的银行卡详细信息相匹配。
当用户输入所有必要的银行卡详细信息，并且恶意软件通过卡号检查后，会将所有信息上传到C&C服务器。
## 0x03 如何解锁手机
现在还是有一些好消息可以告诉大家：Rotexy并不具备一个设计精良的模块，用来处理包含在SMS消息中命令。
这意味着在某些情况下，当手机被上述几个HTML页面锁定时，我们还是可以解除手机锁定状态。
我们可以通过SMS消息将“3458”文本发送到被锁定的设备来解锁，这将撤销木马的管理员权限。之后，我们还需要将“stop_blocker”文本发送到相同的号码：这将禁止设备显示敲诈并锁定屏幕的HTML页面。Rotexy可能会通过无限循环再次请求设备管理员权限，在这种情况下，请以安全模式重启设备并删除恶意程序。
但是，如果攻击者能够对尝试删除木马的行为快速做出反应，则这种方法可能无法奏效。在这种情况下，我们首先需要通过SMS消息将文本“393838”发送到被感染的设备，然后重复上述操作。这条短信会将C&C服务器地址更改为“://”，这样一来手机将不再接收来自实际C&C服务器的命令。
请注意，这些解锁指令只适用于当前版本的Rotexy，并已做过解锁测试。但是，在未来版本的木马中，所使用的命令集可能会发生变化。
## 0x04 Rotexy攻击的地理区域
根据我们观测到的数据，98%的Rotexy攻击针对的都是俄罗斯用户。实际上，这个木马明确针对的是以俄语为母语的用户。乌克兰、德国、土耳其和其他几个国家的用户也会受到影响。
适用于Android系统的Kaspersky Internet Security和Sberbank Online应用程序可保护用户免受此木马攻击。
## 0x05 IOC
SHA256
    0ca09d4fde9e00c0987de44ae2ad51a01b3c4c2c11606fe8308a083805760ee7
    4378f3680ff070a1316663880f47eba54510beaeb2d897e7bbb8d6b45de63f96
    76c9d8226ce558c87c81236a9b95112b83c7b546863e29b88fec4dba5c720c0b
    7cc2d8d43093c3767c7c73dc2b4daeb96f70a7c455299e0c7824b4210edd6386
    9b2fd7189395b2f34781b499f5cae10ec86aa7ab373fbdc2a14ec4597d4799ba
    ac216d502233ca0fe51ac2bb64cfaf553d906dc19b7da4c023fec39b000bc0d7
    b1ccb5618925c8f0dda8d13efe4a1e1a93d1ceed9e26ec4a388229a28d1f8d5b
    ba4beb97f5d4ba33162f769f43ec8e7d1ae501acdade792a4a577cd6449e1a84
    ba9f4d3f4eba3fa7dce726150fe402e37359a7f36c07f3932a92bd711436f88c
    e194268bf682d81fc7dc1e437c53c952ffae55a9d15a1fc020f0219527b7c2ec
C&C服务器地址
2014–2015：
  * secondby.ru
  * darkclub.net
  * holerole.org
  * googleapis.link
2015–2016：
  * test2016.ru
  * blackstar.pro
  * synchronize.pw
  * lineout.pw
  * sync-weather.pw
2016：
  * freedns.website
  * streamout.space
2017–2018：
  * streamout.space
  * sky-sync.pw
  * gms-service.info