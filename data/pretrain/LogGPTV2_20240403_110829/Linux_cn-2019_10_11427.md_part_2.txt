不是所有的东西都包含在内核中，也不是所有的东西都可以作为内核模块使用。在某些情况下，你需要下载一个由供应商编写并绑定好的特殊驱动程序，还有一些情况，你有驱动程序，但是没有配置驱动程序的前端界面。
有两个常见的例子是 HP 打印机和 [Wacom](https://linuxwacom.github.io) 数位板。如果你有一台 HP 打印机，你可能有能够和打印机通信的通用的驱动程序，甚至能够打印出东西。但是通用的驱动程序却不能为特定型号的打印机提供定制化的选项，例如双面打印、校对、纸盒选择等等。[HPLIP](https://developers.hp.com/hp-linux-imaging-and-printing)（HP Linux 成像和打印系统）提供了选项来进行任务管理、调整打印设置、选择可用的纸盒等等。
HPLIP 通常包含在包管理软件中；只要搜索“hplip”就行了。
![HPLIP in action](/data/attachment/album/201910/06/114011gmkdaqop6zsssro6.jpg "HPLIP in action")
同样的，电子艺术家主要使用的数位板 Wacom 的驱动程序通常也包含在内核中，但是例如调整压感和按键功能等设置只能通过默认包含在 GNOME 的图形控制面板访问。但也可以作为 KDE 上额外的程序包“kde-config-tablet”来访问。
这里也有几个类似的个别例子，例如内核中没有驱动程序，但是以 RPM 或 DEB 文件提供了可供下载并且通过包管理软件安装的 kmod 版本的驱动程序。
### 打上补丁并编译你的内核
即使在 21 世纪的未来主义乌托邦里，仍有厂商不够了解开源，没有提供可安装的驱动程序。有时候，一些公司为驱动程序提供开源代码，而需要你下载代码、修补内核、编译并手动安装。
这种发布方式和在 kmod 系统之外安装打包的驱动程序拥有同样的缺点：对内核的更新会破坏驱动程序，因为每次更换新的内核时都必须手动将其重新集成到内核中。
令人高兴的是，这种事情变得少见了，因为 Linux 内核团队在呼吁公司们与他们交流方面做得很好，并且公司们最终接受了开源不会很快消失的事实。但仍有新奇的或高度专业的设备仅提供了内核补丁。
官方上，对于你如何编译内核以使包管理器参与到升级系统如此重要的部分中，发行版有特定的习惯。这里有太多的包管理器，所以无法一一涵盖。举一个例子，当你使用 Fedora 上的工具例如 `rpmdev` 或 `build-essential`，Debian 上的 `devscripts`。
首先，像通常那样，找到你正在运行内核的版本：
```
$ uname -r
```
在大多数情况下，如果你还没有升级过内核那么可以试试升级一下内核。搞定之后，也许你的问题就会在最新发布的内核中解决。如果你尝试后发现不起作用，那么你应该下载正在运行内核的源码。大多数发行版提供了特定的命令来完成这件事，但是手动操作的话，可以在 [kernel.org](https://www.kernel.org/) 上找到它的源代码。
你必须下载内核所需的任何补丁。有时候，这些补丁对应具体的内核版本，因此请谨慎选择。
通常，或至少在人们习惯于编译内核的那时，都是拿到源代码并对 `/usr/src/linux` 打上补丁。
解压内核源码并打上需要的补丁：
```
$ cd /usr/src/linux
$ bzip2 --decompress linux-5.2.4.tar.bz2
$ cd  linux-5.2.4
$ bzip2 -d ../patch*bz2
```
补丁文件也许包含如何使用的教程，但通常它们都设计成在内核源码树的顶层可用来执行。
```
$ patch -p1  /boot/vmlinuz
$ sudo mv /boot/System.map /boot/System.map.stock
$ sudo cp System.map /boot/System.map
```
到目前为止，你已经打上了补丁并且编译了内核和它的模块，你安装了内核，但你并没有安装任何模块。那就是最后的步骤：
```
$ sudo make modules_install
```
新的内核已经就位，并且它的模块也已经安装。
最后一步是更新你的引导程序，为了让你的计算机在加载 Linux 内核之前知道它的位置。GRUB 引导程序使这一过程变得相当简单：
```
$ sudo grub2-mkconfig
```
### 现实生活中的编译
当然，现在没有人手动执行这些命令。相反的，参考你的发行版，寻找发行版维护人员使用的开发者工具集修改内核的说明。这些工具集可能会创建一个集成所有补丁的可安装软件包，告诉你的包管理器来升级并更新你的引导程序。
### 内核
操作系统和内核都是玄学，但要理解构成它们的组件并不难。下一次你看到某个技术无法应用在 Linux 上时，深呼吸，调查可用的驱动程序，寻找一条捷径。Linux 比以前简单多了——包括内核。
---
via: 
作者：[Seth Kenlon](https://opensource.com/users/seth) 选题：[lujun9972](https://github.com/lujun9972) 译者：[LuMing](https://github.com/LuuMing) 校对：[wxy](https://github.com/wxy)
本文由 [LCTT](https://github.com/LCTT/TranslateProject) 原创编译，[Linux中国](https://linux.cn/) 荣誉推出