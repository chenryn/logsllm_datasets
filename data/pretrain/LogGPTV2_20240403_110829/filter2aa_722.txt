Abusing Certificate Transparency
Or how to hack Web Applications before Installation
Hanno BÃ¶ck 
https://hboeck.de/
1
HTTPS
2
Certificate Authorities
3
Can we trust Certificate
Authorities?
4
No
5
CAs are bad, we need to get rid of them 
Popular Infosec opinion
6
Reality
Nobody has a feasible plan how to replace CAs
7
Improving the CA system
8
Baseline Requirements
9
HTTP Public Key Pinning (HPKP)
10
Certificate Authority
Authorization (CAA)
11
Certificate Transparency
12
Public logs
13
CT Details
Merkle Hash Trees, Signed Certificate Timestamps
(SCT), Signed Tree Head (STH), Precertificates,
Monitors, Gossip, ...
14
Certificate logging
Next year (April) logging will be required for all
certificates
15
Today
16
The CA watchdog
Everyone can check logs for suspicious activity
17
18
19
20
https://crt.sh
21
Certificate Transparency is also a
data source
22
Feed of new host names
23
Let's talk about something else
24
Web applications
25
Installers
26
No authentication!
27
Old: Google dorking web
installers
28
New idea
There is a time window between uploading files and
completing the installer
29
Remember: We have a feed of newly created host
names
30
Attack
31
Monitor CT logs, extract host
names
32
Check hosts for common
installers
33
If installer found: Install the
application
34
Upload a plugin with code
execution backdoor
35
Revert installation
36
Database credentials
Use external database host
37
Demo
38
Challenges
Logged certificates aren't immediately public (around
30 minutes)
39
Optimizations
Instead of checking sites once one could check them
multiple times
40
Numbers
5000 Wordpress installations within three months.
500 x Joomla, 120 x Nextcloud, 70 x Owncloud.
41
Protection
42
Installers need authentication
43
Challenge
Application programmers want easy installations
44
Security tokens
Webapp creates token file, user has to read token
45
Vendors
Drupal, Typo3, Owncloud
... no reaction
46
Vendors
Wordpress, Nextcloud, Serendipity participated in
cross-vendor discussion, but no action
47
48
It still allows to create an SQLite
database
Can this be exploited?
49
50
Whitelisting localhost
51
This was my idea, but I don't like
it
52
What can users do?
53
Be fast?
54
Certificate redaction?
55
.htaccess
56
Defending as a user is hard
We need fixes from vendors
57
Do attackers already use this?
58
x.x.x.x - - [09/Jul/2017:12:03:03
+0200] "GET / HTTP/1.0" 403 1664 "-"
"Mozilla/5.0 (compatible;
NetcraftSurveyAgent/1.0;
+PI:EMAIL)"
59
Takeaway
Unauthenticated installers are a security risk
60
Takeaway
No more secret hostnames
61
Takeaway
Certificate Transparency is a valuable data source for
attackers and defenders
62
Thanks for listening!
Questions? 
https://hboeck.de/
https://github.com/hannob/ctgrab
63