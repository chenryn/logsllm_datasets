these servers have connected to 220 distinct infected routers during
this period. The most prominent siteKey involved in making these
connections was hsFAjj. However our NetFlow data also shows
that SK_LCx and oDcuak-infected devices begin to make contact
to these servers towards the end of this period, suggesting a link
between these siteKeys.
Based on the connection patterns of the compromised routers
and the maintenance activities (which we discuss in Section 5.5), we
can deduct the system architecture as depicted in Figure 11. While a
handful of infected routers are performing scanning and infections
within the same prefix, compromised routers remain unconnected
among themselves. They only have two flows in common: the
connection on port 2008 to a handful of staging or Command &
Control (C&C) servers, as well as SSH flows on port 22 from a shared
origin. When a router is taken over, the new perpetrator does not
seem to always aim to eradicate a previous infection after having
replaced the proxy template and siteKey. In fact, we find numerous
examples where the routers taken over by a different siteKey keep
beaconing to staging servers associated with an unrelated actor,
who shows no other commonalities or features with the new owner.
5.4 Monetization
With the vulnerability triggered and a foothold on the routers es-
tablished, the adversaries moved to the exploitation of the routers
Figure 11: Schematic overview of the system architecture.
for monetary gain. Over the course of the study period we ob-
served the evolution of two monetization strategies. First, the use
of the routers as a (free) proxy service, and second, the injection of
cryptomining code into users’ web browsing sessions.
5.4.1 HTTP Proxies. The first use case of the compromised MikroTik
routers was the establishment of HTTP proxies. Here traffic from
a web browser to a web server is tunneled through the HTTP
proxy, thus masking the IP address of the client towards the server.
HTTP proxies are used as a basic variant of a VPN service, although
application-protocol specific and with limited authentication op-
tions if at all implemented. Starting from July 9, 2018, the first
MikroTik routers were repurposed as HTTP proxies, which we
identified from the emergence of large incoming traffic towards
specific high TCP ports, namely 36551, 53281 and 58833. This use
case remained however relatively rare, with only 3,216 of the total
1.4M infected routers being abused in this way.
Interestingly, the usage as an HTTP proxy did not seem to serve
a monetary gain, as within 3 days 95% of the routers for which
these unusual spikes appeared were posted to free public proxy
lists [29], and allowed a connection without user credentials. This
usage was only relatively short-lived, as most were disabled within
40 days, at which point SOCKS proxies were spun up at TCP 4145.
SOCKS Proxies. In contrast to HTTP proxies, SOCKS proxies
5.4.2
work at the transport layer and forward traffic transparently with
regard to the application layer protocol. This allows this proxy type
to be used in combination with any application and thus extending
the monetization potential. Shortly after the emergence of this new
use case, the HTTP proxies on the MikroTik routers are replaced
by SOCKS proxies, and 1,530 MikroTik routers remained in use as
SOCKS proxies even until the end of the study. Further character-
ization of the NetFlows is not possible, as the application traffic
itself would be forwarded inside the tunnel and the router would
rewrite the outgoing flow to an ephemeral source port. However,
we do find that the exploitation as SOCKS proxy was under the
control of a few and not deployed pervasively.
This is possible to conclude, as the use of SOCKS proxies was
never encountered alone, but only in combination with a cryptomin-
ing infection. As we discussed in the previous section, adversaries
were routinely reinfecting devices and by changing the crypto-
mining siteKeys effectively snatching the devices away from their
Adversary A(possibly proxied)CompromisedRoutersStaging/C&CServer(optional)Port 8291+ 22Port2008Table 3: Router “ownership” based on cryptomining siteKey
and corresponding SOCKS proxy activity
Table 4: Top 10 largest campaigns identified.
SiteKey
% of all SOCKS traffic
hsFAjj
53.6%
J3rjnv
29.1%
SK_LCx
7.8%
oDcuak
3.4%
d68a7a
1.2%
competitors. With the infection script reconfiguring the device in-
cluding firewall and proxy settings, we can thus assess that the
“ownership” with respect to an active cryptomining would also in-
dicate who had control over the SOCKS proxy at that point in time.
As we discuss in the next section, we identified a total of 140 crypto-
mining keys on the 1.4M MikroTik routers, but as shown in Table 3,
only five siteKeys were in use on a router whenever the device was
proxying traffic. Their impact is however huge: more than 95% of all
SOCKS activity that originates from MikroTik routers is the result
of proxies operated by these five siteKeys, with hsFAjj being one of
the early adopters of MITM-based cryptomining. The small num-
ber of siteKeys related to SOCKS proxy activity suggests a relation
between those siteKeys, as others do not exhibit this behavior.
5.4.3 Cryptojacking Proxies. While the usage as HTTP proxies
was not commercialized and only few actors repurposed a limited
number of devices as SOCKS proxies, a large number of actors
engaged in cryptojacking user connections, with a total of 140 dif-
ferent cryptomining siteKeys being installed on the routers during
the study, and a maximum of 106 different siteKeys being active at
the same time.
Mining services. Figure 12 depicts the number of infected routers
over time, categorized by the mining service provider used. As we
see in the figure, the MITM-based mining started out based on Coin-
hive, which was at that time the obvious choice to be introduced
in the MITM vector as it was the first service for cryptomining
and already widely deployed in website-based mining [2, 18, 30].
Starting in middle of September, this homogeneity shattered with
first the emergence of CoinImp, and later on Omine, all taking on
approximately equal market shares which led to a peak of cryp-
tojacking activity on December 19, 2018, as 460,618 routers were
infected concurrently. This activity continues relatively unchanged
until January 26, 2019, when suddenly mining activity disappeared
from the bulk of infected routers. The distribution of miner appli-
cations between Coinhive, CoinImp and Omine remained similar
and relatively unchanged.
Figure 12: Evolution of infections over time per service.
Service
Coinhive
Omine
Omine
Coinhive
Coinhive
Coinhive
Coinhive
Coinhive
Coinhive
Coinhive
SiteKey
hsFAjj
4983e3
f6c7f3
tD2a2P
oDcuak
48zUYB
dqorRU
9pFICA
BOvlp3
8C7UoT
Total
Total Infected Max Concurrently Date first seen
Jul 21, 2018
Nov 3, 2018
Jan 23, 2019
Aug 22, 2018
Aug 1, 2018
Sep 12, 2018
Sep 15, 2018
Sep 15, 2018
Sep 15, 2018
Sep 15, 2018
223,844
117,502
102,241
71,513
55,437
52,181
50,566
50,376
49,640
47,981
1,452,550
167,182
64,539
36,059
61,835
47,310
26,122
27,808
25,928
22,921
24,773
460,618
Interestingly, siteKeys found as related in previous analyses do
not necessarily use the same mining application, possibly to avert
risks from accounts becoming frozen by an individual cryptomining
service. Despite risk being shared across providers, several actors
also spread out their activities across multiple siteKeys, as can be
inferred when the same maintenance hosts connect to routers with
multiple siteKeys (as we will show in Section 5.5). These movements
between providers and the market shares of CoinImp and Omine
might also be explainable based on fees: while Omine charges a 2%
fee and CoinImp is entirely free, Coinhive takes a 30% cut.
Evolution of siteKeys. Figure 13 shows the evolution of siteKeys
installed on MikroTik routers between July 2018 and April 2019,
ordered by the time they were first encountered on a router. The size
of circle indicates on how many routers this siteKey was installed
on a given day. We can see that MITM-based cryptomining was
pioneered by three siteKeys: first, d68a7a emerged first but beside
a small peak remained only a minor player. Second, hsFAjj who
followed one week after, temporarily controlled 70% of all infected
routers, and introduced new strategies for controlling and otherwise
monetizing the routers, remaining a steady force until the general
decline. And third, oDcuak, like the first mover d68a7a experiencing
a small surge followed by steady but comparatively low-volume
activity.
Approximately one week after these first movers, a large number
of new siteKeys started to appear, frequently co-emerging in groups
that stay relatively similar in size. Four sequential blocks of 10
siteKeys can be clearly observed, two of them using Coinhive, the
other two are using Omine as their mining service. While all other
siteKeys never reach the same size as hsFajj’s initial deployment
(167,182 infections), each of them is able to hold control over up to
64,539 routers at a time. While we find a total of 1.4M routers to be
vulnerable and at some point infected, the perpetrators are never
rolling their cryptojacking infections out to all potential victims
simultaneously. Instead, we see a constant flux, with new routers
being infected so that the mining deployments stay consistent in
size. This is necessary, because once infected, most of the routers
are patched quickly, as shown in Figure 15. This figure shows the
cumulative density function (CDF) of the number of days a router
is infected on a logarithmic scale. We see that 50% of the devices are
patched within 18 days after compromise, whereas only 30% of the
devices remain active for more than 50 days, urging actors to con-
stantly replace disappearing routers to maintain their installation
base.
2018-07-012018-08-042018-09-082018-10-132018-11-172018-12-222019-01-262019-03-02Date0100000200000300000400000unknown-obfuscatedcryptolootcoinhivecoinpotcoinimpmonero-miningwebminepoolmineraltominewebminercoinhaveFigure 13: Evolution of detected siteKeys over time, colored per mining service.
2018-07-182018-09-262018-12-052019-02-13Dated68a7ac4cdb5hsFAjj0db6c8oDcuakk73eGtPIKZhbOgBwPQ0x4020EbaacwgE05C77188d1XvqZi0XH6V4UZopliiNaXPsFSK_LCxcPSV7LPmwMlrhHhAL7SK_WA2ff488131P4Ze0PDji4SK_MleVhl4MBSK_E4zSK_6wWSK_AFiSK_COFpRCfIZreYE7rJ3rjnvtD2a2Psm8UXuLcflZS6a9929qdWOyBqzo38T0x7e51wehDD1MAPiLWBT9k5DAvogjeHNNrXbd3j3oWX2UnCjiBl5xz102tcSbeac98H2pM18Crypto0x66150xa43a3bb7e996faa4KKAvUbHDZbD5a4TEf93bzwnOwffpOkw8avJm5jZllEOMW3DMyBIGn5iWDUHF48zUYBbFAs1SFgWWtJ9pFICAwjORhfBOvlp3dqorRU8C7UoTPytY6C9Jp1CXHjPiYW5b77e94IhUzufmj1zFzeREivpj81wd0oLauz32ea9aoiKAGE5zHUikB09gQz876iyR44tLjm096021ryZ1Dljh0GD0BcdFFhjoy1MQZsyeL0qKoXV85ROof5ByMzv3QUJpIL4JUdGzvoOuaqfZmiIVwxPBB3038aebf916f78f69bfc5a47ad76adbaff2babc5fb6ebae80d32ec897d86aVo2x9TkMzgmXGpqdO5SVf3TGc6914a7ba081c43cbeef18c8adf4be2c00d5a2007ed268f19151da1b9233RDuQVf4983e30xbdafR3jMvoI8rYivoAoN72PJTyyud6bd05PB3LBh2042f6f6c7f3x6nOfQC1gJDguFsnq5SK_WvJ59256bVcKOi461276530,000 routers90,000 routers170,000 routers Monero-mining Webminer Omine Coinhive Cryptoloot Webminepool CoinImpflattening out of the overall installation base. As we have already
seen in Figure 12, the ecosystem of router-based cryptomining
drastically changes in late January. Most apparent is the major
drop in participating devices, approximately 87% of all infected
routers disappear, which affects the installation base of all siteKeys
across all autonomous systems and countries. While such a large
and universal movement would indicate some external trigger or
cause, we could not find any evidence for a coordinated cleanup
action, for example by an ISP or a grey hat hacker (aside from one
who has taken credit for patching 100,000 routers in November
2018 [7]). Additionally, we contacted Censys whether they had
made any changes to their crawling strategy, but that was not the
case. After the sudden cut, we also see a rotation of remaining
actors towards new siteKeys, where the new siteKey f6c73 partially
takes over the efforts of 4983e3, however only a few continue to
re-establish their activities and forego previous practices, whereas
f6c73 is responsible for most new infections.
Geographical Focus. Based on the heatmap in Figure 6 and the large
deployment of MikroTik devices in certain autonomous systems
as shown in Table 2, we have seen that a number of countries
seemed prime candidates when looking for MikroTik devices, which
would logically mean that advanced adversaries should focus their
activities there. As RouterOS is used in both consumer devices and
carrier-grade routers, we would naturally expect some devices to
be more lucrative than others, immediately posing the question
whether reinfection of devices – in other words “stealing” routers
– would primarily occur in popular areas and target those devices
where a lot of money could be made.
Figure 17 shows the number of siteKeys as a function of the
amount of NetFlows on port 80 this router processed during its in-
fection. Counterintuitively, there is no trend that high-value targets
are more fought over than low-value ones. Especially routers with
much traffic tend to stick with just a low number of siteKeys. This
is surprising, as a cryptomining operation on a large router would
clearly affect more people, lead to more complaints and thus logi-
cally faster patching. The lack of a fight for high-grossing routers
can however partially be explained based on the location of the
routers, indicated by the color of the data point. While routers in
Indonesia and Brazil – the hotspots of the infection – cover the en-
tire spectrum and are changing keys considerably, the most stable
infections – and the highest grossing ones for that matter as we
will see in Section 6 – are in countries that do not appear anywhere
near the top in MikroTik installation counts, for instance, 6 out of
the 10 most grossing routers are located in Iraq. This means that
actors targeting niche markets accomplished much more valuable
deployments, as these routers mined longer for them.
5.5 Maintenance