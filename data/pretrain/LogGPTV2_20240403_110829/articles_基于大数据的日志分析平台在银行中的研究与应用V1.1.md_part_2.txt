> \(4\)
> 日志清理策略（数据脱敏等）：可以对敏感的关键字或字段，进行替换、脱敏等设置，并且可以根据不用的用户权限设置分类查看和展示。
（5）日志备份管理
为了将保存之前的日志数据，日志分析平台提供备份管理功能，备份策略可以由用户自己创建；系统提供固定的归档目录，用户可自行选择备份的带宽占用，备份数据可在需要时进行恢复。
（6）在线数据保存30天，超过30天数据转储到带库或者nas存储，且保存周期可以自定义。
## 数据检索
### 日志检索
> 提供海量数据的分布式搜索引擎，为用户提供准实时的搜索服务；
（1）支持智能检索功能，可通过输入的关键字条件快速检索到相关的日志数据，并可以进一步查看日志数据的详细信息。
（2）支持通过关键字、条件表达式、时间范围等对事件及数据进行快速检索，快速定位到运维分析人员关注的威胁事件和上下文数据，并支持查看数量趋势统计和检索结果详细数据。
（3）支持搜索保存功能，当搜索得到有价值的数据，用户可以选择保存搜索，以便后续直接使用。
（4）支持TB级别的数据量检索，检索结果返回时延在10秒内，用户UI操作时延在2秒内。
索引集群采用的分布式搜索引擎，具备高可靠性和高性能。支持时间文本索引和全文检索，提供丰富的api用于索引、检索、修改大多数配置。能够快速搜索数百亿的日志以及TB级的结构化或者非结构化的数据。
集群由2台及2台以上节点组成，其中一个为主节点，节点通过选举产生，主从节点是对于整个集群内部来说的，从外部来看整个集群，逻辑上是一个整体，与任何一个节点的通信和与整个集群通信是完全一致的。集群自动创建索引，通过配置我们可以非常方便的调整索引分片和索引副本。通过索引分片技术，一个大的索引被拆分成多个，然后分布在不同的节点上，以构成分布式搜索。索引副本的作用一是提供系统的容错性，当摸个节点摸个分片损毁或丢失时，可以从副本中恢复；二是提供查询效率，集群内部会自动实现搜索请求的负载均衡。
![C:\\Users\\ADMINI\~1\\AppData\\Local\\Temp\\jfx7185001766467909938.png](media/image4.png){width="4.429576771653544in"
height="3.602331583552056in"}
### 日志分析
日志分析功能支持搜索处理语言，可以使用关键字、字段范围和值、正则表达式、布尔值等快速检索，也可以使用搜索处理语言语句实现复杂的搜索及关联检索，同时，根据数据涉及的不同场景定义不同的分析视图、可以针对相同来源的不同事件或者多个日志之前的复杂关联分析，也可自定义统计和分析规则，实现数据关联分析，提供快速简便的方式，使运维人员可以根据需要分析展示数据，如查找攻击来源、定位漏洞、实时业务分析，支持多维度的展示过滤控制，如通过字段、范围值、时间线、关键字等对日志进行关联查询，其中搜索语言具备功能：
-   对日志字段或统计结果进行计算表达式，并将表达式值放入新增字段中。
-   将连续的值分别放入按区间分割的桶中，用于计算趋势以及数组分组变化。
-   保留查询结果中指定的字段。
-   类似sql的连接，将主管道的结果和子管道的结果连接在一起。
-   返回前n个结果，常用于限制统计结果数量。
-   重命名字段名。
-   提供各种统计函数，并可以选择按字段分组统计。
-   指定的字段对结果进行排序。
-   使用表达式对结果进行过滤。
-   将结果分组形成交易日志组合。
-   对字段进行数量和百分比统计。
日志分析平台从不同设备、不同业务模块收集到的日志,同时梳理业务的完成处理流程（比如一笔业务首先经过防火墙、交换机、负载设备、业务模块1、业务模块2、......）,根据实际业务的关联规则进行递归关联查询，检索以业务为导向的整个交易、处理过程的全部日志。实现两两模块之间的参数（比如流水号、报文号）自动传递；参考入下图：
![](media/image5.png){width="5.780555555555556in" height="1.78125in"}
图2 关联查询
## 数据可视化
提供简洁日志呈现的交互方式，如：仪表盘、自定义报表等，支持以饼状图、柱状图、序列图、矩阵热力图、和弦图、桑基图、力引导图、水球图等任意形态进行数据可视化，可展示拓扑图、提供指挥中心、地理分析、实时监控、汇报展示等多种场景模版，用更生动友好的方式呈现隐藏在日志数据背后的业务洞察，通过交互式实时可视化数据来帮助业务人员发现、诊断业务问题。
该集群主要是多主结构，各个节点完全平行，前端支持NGINX作为负载均衡器，增强了系统跨平台、快速部署等特性。
模块架构如下：
![](media/image6.png){width="4.078181321084864in"
height="3.0899781277340335in"}
## 权限管理【角色权限、资源分组、用户分组、用户管理】
权限管理建立基于 RBAC 的权限管理机制。RBAC（Role-Based Access
Control），就是用户通过角色与权限进行关联。简单地说，一个用户拥有若干角
色，每一个角色拥有若干权限。这样，就构造成"用户-角色-权限"的授权模型。
在这种模型中，用户与角色之间，角色与权限之间，一般者是多对多的关系。
为保证数据安全性应提供完善的权限管理体系，将用户、角色、资源权限做出概念分离设计，对用户的添加删改权限、日志资源分组做出严格定义，使访问入口权限得到有效管控，让整个系统的权限更有逻辑性、更有序，让不同种类用户的初始权限及权限变化都更为明确，方便用户使用数据，同时进一步保证数据的安全性和私密性，减小授权管理的复杂性，降低管理开销，灵活地支持企业的安全策略。
（1）用户：即可登陆日志分析平台的用户。
-   用户组：用户与用户组之间是多对多的关系，一个用户可以属于多个用户组，一个用户组可以包含多个用户。
```{=html}
```
-   特权管理员用户可以看到所有类型资源和所有功能的权限管理。
（2）角色：角色持有一组权限：
-   可以通过角色授权界面对一个角色持有的对应权限进行编辑。
-   角色和用户组之间是多对多的关系。
-   单个用户拥有的角色由用户所属于的用户组决定。单个用户不直接与角色相关。
```{=html}
```
-   被授予\"编辑所有角色权限\"这个功能类权限的角色可以管理所有资源类型和部分功能类权限。
-   没有被授予\"编辑所有角色权限\"这个功能权限类的角色，可以管理资源类权限，但
    -   管理的资源组范围为此用户所有有资源组编辑权限的资源组。
    -   管理的角色范围为此用户通过用户分组关联到的角色。
> （3）权限：对一个具体操作（与操作目标）的许可称为一个权限。比如下列：
-   可修改告警分组"寿险告警
    > "：在"资源分组管理"面中的编辑功能，操作仅包括修改分组的名字和备注，操作目标是"寿险告警"这个分组。
-   可为告警分组"寿险告警"赋予成员告警：操作是赋予成员告警，操作目标是"寿险告警"这个分组。
-   可读取告警分组"寿险告警"的告警：操作是读取告警，操作目标是某个"寿险告警"分组下的所有告警。
-   可创建告警：操作是创建告警，无目标。
（4）资源：权限可操作的目标被称为资源。包括：用户，用户组，告警，告警分组等。
-   资源分组：对资源进行的分组。包括：用户分组，告警分组，已存搜索分组，仪表盘分组等。
每一类资源共有八个可选权限：
-   新建资源组：可以创建对应类型的资源组，比如创建告警分组。
-   分组管理读取：可以看到对应分组。在资源列表页可看到分组信息。另：只有当勾选了此权限，才可以勾选下述的其他六个权限。
-   分组管理编辑：可以编辑分组的名字和备注，可以在授权管理页面管理此资源组的权限。关键：拥有此权限就可以在授权管理界面编辑对应的组的权限，那么这样就使得其他人可以分担权限管理员的职责，一起进行权限的管理。
-   分组管理删除：可以删除分组。
-   资源管理读取：可以读取此分组下对应的资源。比如告警分组被勾选了，对应告警分组下的告警就可以被看到。只有此权限被勾选，下述三项权限才能被勾选。
-   资源管理分配：可以将本类别的资源加入此分组。比如用户分组此权限被勾选，就可以指派此分组的用户，类似旧的用户分组管理员。
-   资源管理更新：可编辑对应资源。
-   资源管理删除：可删除对应资源。
## 监控管理【新增】
提供自定义告警规则，通过创建告警监控各种安全信息、系统指标或者健康度信息等，并实施预警以保证系统安全性、可靠性、异常问题的及时解决等问题。支持对事件数告警、字段统计告警、连续统计告警、基线对比告警、搜索语言统计结果告警等模式。提供邮件、短信、微信、rsyslog告警转发等多种告警手段。并提供告警抑制功能。
5.  **平台体系架构研究**
## 日志分析平台架构设计
建立集中制的日志分析平台，将分散的各类日志统一采集、统一处理，可以通过统一界面进行日志关联分析及复杂逻辑的实时监控告警服务，一旦发生故障技术人员无需登陆各台服务器进行人工排查，通过准实时检索快速定位，大幅度提升运维效率。日志分析平台采用如下结构：
![](media/image7.png){width="5.780555555555556in"
height="3.9784722222222224in"}