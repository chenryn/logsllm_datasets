**智能运维应用需求说明书**
  ----------------------------------- -----------------------------------
  编制人                              
  审核人                              
  编制部门                            
  ----------------------------------- -----------------------------------
**修改记录**
+------+--------------+------------+------------+--------------------+
| **   | **发版日期** | **作者**   | **审核人** | **改动的章节号**   |
| Ver. |              |            |            |                    |
| No** |              |            |            |                    |
+------+--------------+------------+------------+--------------------+
| **1  | **           | **饶琛琳** |            |                    |
| .0** | 2017.08.25** |            |            |                    |
+------+--------------+------------+------------+--------------------+
| **1  | **           | **饶琛琳** |            | **重新确定监控     |
| .1** | 2018.04.12** |            |            | 项和设备的关系；** |
|      |              |            |            |                    |
|      |              |            |            | **新加入           |
|      |              |            |            | 设备维度的展示。** |
+------+--------------+------------+------------+--------------------+
| **1  | *            | **饶琛琳** |            | **暂时去除应用部署 |
| .2** | *2018/4/23** |            |            | 和权限相关部分；** |
|      |              |            |            |                    |
|      |              |            |            | **规范             |
|      |              |            |            | 监控项操作使用；** |
|      |              |            |            |                    |
|      |              |            |            | **确               |
|      |              |            |            | 定根因分析功能。** |
+------+--------------+------------+------------+--------------------+
| **1  | *            | **饶琛琳** |            | **加入指标概念；** |
| .3** | *2018/9/25** |            |            |                    |
|      |              |            |            | **重新确定监       |
|      |              |            |            | 控项的管理方式；** |
|      |              |            |            |                    |
|      |              |            |            | **确定和外部       |
|      |              |            |            | 数据对接的方式。** |
+------+--------------+------------+------------+--------------------+
| **1  | **           | **饶琛琳** |            | **更新对接细节；** |
| .4** | 2018/11/28** |            |            |                    |
|      |              |            |            | **更新低中高       |
|      |              |            |            | 级别的计算方式。** |
+------+--------------+------------+------------+--------------------+
|      |              |            |            |                    |
+------+--------------+------------+------------+--------------------+
目 录
[1. 概述 [4](#概述)](#概述)
[1.1 名词说明 [4](#名词说明)](#名词说明)
[1.2 功能概述 [4](#功能概述)](#功能概述)
[2. 需求描述 [5](#需求描述)](#需求描述)
[3. 可选方案 [5](#可选方案)](#可选方案)
[4. 功能需求 [6](#功能需求)](#功能需求)
[4.1 功能总览 [6](#功能总览)](#功能总览)
[4.1.1 主要组成结构关系图 [6](#主要组成结构关系图)](#主要组成结构关系图)
[4.1.2 设备管理 [7](#设备管理)](#设备管理)
[4.1.3 监控项管理 [8](#指标metric管理)](#指标metric管理)
[4.1.4 服务管理 [8](#服务管理)](#服务管理)
[4.1.5 服务概览操作及钻取
[10](#服务概览操作及钻取)](#服务概览操作及钻取)
[4.1.6 服务详情展示与操作
[11](#服务详情展示与操作)](#服务详情展示与操作)
[4.1.7 设备概览操作与钻取
[13](#设备概览操作与钻取)](#设备概览操作与钻取)
[4.1.8 设备详情与性能模板展示
[14](#设备详情与性能展示)](#设备详情与性能展示)
[4.1.9 根因分析操作 [17](#_Toc512277333)](#_Toc512277333)
[4.2 功能详情 [18](#功能详情)](#功能详情)
[4.2.1 管理设备内容 [18](#管理设备内容)](#管理设备内容)
[4.2.2 管理性能模板 [20](#_Toc512277336)](#_Toc512277336)
[4.2.3 管理监控项 [22](#管理监控项)](#管理监控项)
[4.2.4 管理服务 [23](#管理服务)](#管理服务)
[4.2.5 查询和使用服务 [26](#查询和使用服务)](#查询和使用服务)
[4.2.6 查询和展示设备性能状态
[28](#查询和展示设备性能状态)](#查询和展示设备性能状态)
[4.2.7 根因分析功能 [29](#根因分析功能)](#根因分析功能)
[4.2.8 监控事件的处理 [30](#_Toc512277342)](#_Toc512277342)
[5. 整合需求 [31](#整合需求)](#整合需求)
[6. 非功能性需求 [31](#非功能性需求)](#非功能性需求)
[6.1 安全性需求 [31](#安全性需求)](#安全性需求)
[6.2 可用性需求 [31](#可用性需求)](#可用性需求)
请与以下部门/人员讨论
  -----------------------------------------------------------------------
  序号              状态              部门/人员         内容
  ----------------- ----------------- ----------------- -----------------
  1                 ☐                 机器学习研发      异常检测功能
  3                 ☐                 设计师            原型设计
  -----------------------------------------------------------------------
# 概述
## 名词说明
  --------------------------------------------------------------------------------------------------------------
  名称                说明
  ------------------- ------------------------------------------------------------------------------------------
  AIOps               基于算法的IT运维平台。利用统计学算法和机器学习算法，对IT数据持续进行异常检测和根因分析。
  异常检测            对数据集中不符合预期模式的、或者和大多数数据差别较大的数据/事件的标识过程。
  根因分析            用于确定故障或问题根源的问题解决办法。移除被认定为根因的因素可以确保问题不再复发。
  CI                  ITIL中的配置项。它是基础设施组件或者一个对象，处于或将处于配置管理的控制下。
  指标(Metric)        在IT运维领域指定期采集生成的时间序列。通常是分钟级的性能或状态值。
  监控项(KPI)         对业务全局状态造成影响的一部分关键性指标，称为监控项。
  异常事件            由异常检测标识的单个异常点。
  --------------------------------------------------------------------------------------------------------------
## 功能概述
背景：大规模IT运维环境中，传统的单一KPI监控方式不可能覆盖全部设备、系统、指标，导致运维人员被迫只关注最关键的少数几个重点KPI，放过了很多防患于未然的机会。日志易可以提供一种基于机器学习的异常检测功能，提供全方位覆盖的监控。同时，通过业务流拓扑、根因分析等功能，快速定位已发现异常事件的根源。
思路：
1.  以服务(service)作为各种监控项(KPI)的检测单元，不同监控项对服务单元的健康度定义有不同的贡献比例。服务单元之间，还存在父子依赖关系。由此构建成整个IT环境的拓扑关系。
2.  在同一个服务检测单元内，引入ITIL中的CI概念(通常而言就是设备)作为异常检测中的关键影响因子，通过设备的过滤和切分，监控项可以动态评估各自异常分值，最终得到全单元的健康度分值。
3.  实际触发的告警，支持归并和处理操作。告警事件，可以和监控项指标一起，成为故障根因分析的上下文的一部分。根因分析的另一部分，则是预定义的服务依赖拓扑。
4.  作为全局入口，可以提供topN的服务单元和KPI健康度看板；也可以提供业务链状态看板；还可以提供设备层面的健康状态看板。通常都可以用作大屏展示。
5.  最后，从实际出发，系统应该额外提供一个主动维护期的通告设置。这将大大有利于故障回顾和事后分析。
# 需求描述
+---------+--------------------+-----------------------------+--------+
| 目      | 需求描述           | 场景描述                    | 优先级 |
| 标客户  |                    |                             |        |
+=========+====================+=============================+========+
| 招行    | 希望对虚拟机平台做 | 1.  虚拟                    | 2      |
|         | 机器学习方面的探索 | 机平台日志的异常模式发现；  |        |
|         |                    |                             |        |
|         |                    | 2.  虚拟机                  |        |
|         |                    | 资源耗用的容量预测与调度。  |        |
+---------+--------------------+-----------------------------+--------+
| 上      | 希望构             | 1.  日志的异常模式发现；    | 2      |
| 海移动  | 建一个智能运维平台 |                             |        |
|         |                    | 2.  故障的根因分析。        |        |
+---------+--------------------+-----------------------------+--------+
| 安      | 设备日             | 1.  对告警关联设备、设备类  | 1      |
| 徽电力  | 志分析提供网管式的 | 型、设备所有人/电话的展示； |        |
|         | 事件处理和统计功能 |                             |        |
|         |                    | 2.  对告警的忽略/处理操作； |        |
|         |                    |                             |        |
|         |                    | 3.  对连续告警的事件归并；  |        |
|         |                    |                             |        |
|         |                    | 4.  高级别                  |        |
|         |                    | 告警处理必须填写处理说明；  |        |
|         |                    |                             |        |
|         |                    | 5.  对相                    |        |
|         |                    | 同业务类型的告警进行分级别  |        |
|         |                    | 分时段的占比和同环比分析；  |        |
|         |                    |                             |        |
|         |                    | 6.  对各负责人进行          |        |
|         |                    | 告警处理时长的及时率分析。  |        |
+---------+--------------------+-----------------------------+--------+
| 阳      | 希望为lookup库提供 | 1.  库中IP地址等可          | 3      |
| 光信保  | 类似CMDB的编辑功能 | 以从日志搜索统计自动更新；  |        |
|         |                    |                             |        |
|         |                    | 2.  关联                    |        |
|         |                    | 信息必须人工通过页面输入。  |        |
+---------+--------------------+-----------------------------+--------+
| 绍      | 业务系             |                             | 3      |
| 兴银行  | 统的模块化流程展示 |                             |        |
+---------+--------------------+-----------------------------+--------+
| 东      | 提供业务层面       |                             |        |
| 方航空  | 的健康度计算和展示 |                             |        |
+---------+--------------------+-----------------------------+--------+
| 大商所  | 同上               |                             |        |
+---------+--------------------+-----------------------------+--------+
| 视      | 提供业务           |                             |        |
| 源电子  | 层面，由多层依赖指 |                             |        |
|         | 标权重计算的健康度 |                             |        |
+---------+--------------------+-----------------------------+--------+
# 可选方案
+-----------------------+-----------------------+-----------------------+
| 方案介绍              | 优点                  | 缺点                  |
+=======================+=======================+=======================+
| Sum                   | 在异                  | 需                    |
| ologic的anomalies功能 | 常模式的基础上提供了  | 要全量日志的模型更新  |
|                       | 告警和反馈改进的流程  | ，有数量和频率限制；  |
|                       |                       |                       |
|                       |                       | 文本异                |
|                       |                       | 常的概率远低于KPI异常 |
+-----------------------+-----------------------+-----------------------+
| 银联商务的agen        | 无需维护CI项          | 无网络拓扑            |
| t地址自动关联拓扑方案 |                       | 关系的事件都会被忽略  |
+-----------------------+-----------------------+-----------------------+
# 功能需求
## 功能总览
### 主要组成结构关系图
![](media/image1.png){width="6.5in" height="4.452083333333333in"}
如上图所示，系统中的核心配置是：设备、指标、服务的管理(增删改查)。以看板、根因分析和告警三种不同维度的查看方式作为使用者的入口。而为了支撑起系统的运行，需要额外的指标数据接入、存储和监控检测等模块。
### 设备管理
![](media/image2.png){width="6.5in" height="6.094444444444444in"}
设备这里要加一个可选属性：external_id，用来填写外部CMDB里的CI id。
### 指标(Metric)管理
指标数据由数据接入模块单独对接客户的第三方监控系统，所以在智能运维应用层面，并没有涉及UI交互。
比如一个存在zabbix中的监控指标：
1.  通过Host.get获取内容：\[hostid, name\]；
2.  通过Item.get方法遍历获取每个hostid的内容：\[itemid, name, key\_,
    description, lastvalue, lastclock, ...\]；
3.  如果需要先填充一部分历史数据，可以通过History.get方法获取内容\[clock,
    itemid, ns, value\]。
根据预先同步CMDB得到的表结构，将hostname与设备对应起来，获取设备所属的服务内部标识。即可拼接得到指标最终导入的名称：\[服务内部标识\]\[指标名称\]。
服务内部标识树状结构展示：
![](media/image3.png){width="6.5in" height="3.8194444444444446in"}
而hostname作为指标的标签内容载入。
由于CMDB定期同步有较大的时间间隔，如果暂时无法对应上的指标数据，可以先丢弃不管。
指标数据的采样间隔和保存时长等参数，目前均作为全局设定，后期再细化。
### 监控项(KPI)管理
和设备、服务不太相同的是，KPI的创建不是凭空开始的。而是基于已经存入时序数据库的Metric数据进行。
即，直接在已有的指标(Metric)列表上，选定一个指标，查看其历史曲线，决策是否进行模型训练，查看测试效果，调整灵敏度等。
日志易提供三种不同的异常检测算法，不同算法的参数和测试效果不一，您需要最终选定一种。
![](media/image4.png){width="6.5in" height="5.2659722222222225in"}
在调整查看都满意以后，最后才确定它作为一个监控项，配置其告警推送插件的部分。
调整查看过程，由于模型训练耗时较多，需要考虑关闭页面以后的继续运行。所以设置为监控项以后，监控项存在多种状态：
1.  待训练