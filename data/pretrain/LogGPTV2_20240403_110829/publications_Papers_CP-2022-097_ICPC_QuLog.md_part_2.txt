deeplearningandexplainableAImethodstoevaluatethe Zookeeper 3.5.6 97K 1.2K
twoproperties. Note:LOCandNOLstandforthenumberofcodeandloglinesaccordingly.
(3) Weexperimentallydemonstratetheusefulnessofourap-
proachinautomaticsystem-agnosticlogqualityassessment, Intuitively,whendescribinganeventwiththe"error"loglevel,the
whichachieveshighaccuracyforloglevelassignment(0.88) statictextcommonlycontainswordslike"error","failure","exit",and
andahighF onsufficientlinguisticstructure(0.99)assess- similar.Wheneverthesewordsoccurwithinthestatictext,itismore
1
ments. likelythatthelevelis"error"than"info".Toverifyourassumption,
(4) Weopen-sourcethecode,datasetsandadditionalexperimen- weconsideredanapproachfrominformationtheorythatdefinesthe
talresultsinthecoderepository[2]. amountofuncertaintyofinformationinamessage[11].Inourcase,
weanalyzetherelationofwordgroups(n-grams,𝑛={1,2,3,4,5})
2 LOGINSTRUCTIONQUALITYASSESSMENT fromthestatictextinrelationtotheloglevel.Forallthen-gram
groups,wetrytoidentifytheloglevelusingn-gramsfromthe
givenstatictextoftheloginstruction.Atfirst,givenann-gram,
2.1 LogInstructionQualityProperties thereishighuncertaintyfortheassignedloglevel.Aswereceive
Toassessthequalityoftheloginstructions,weexaminedliterature moreinformationaboutthen-gram,weupdateourbeliefforits
studiesonloggingpractices.Weidentifiedtwoviews:explicit(or commonlyassignedloglevel,reducingtheentropy(uncertainty)
developers),andimplicit(oroperators).Theexplicitviewisrelated associatedwiththen-gram.Tomeasuretheuncertainty,weused
to(a.1)correctloglevelassignment,(a.2)comprehensivecontent Normalized Shanon’s entropy [20]. We calculated the log level
ofthestatictextandparameters,and(a.3)correctloginstruction entropyforeachn-gramfromalltheloginstructionsofthenine
placement[21].Theimplicitviewisrelatedtotheoperators’ex- softwaresystemsandreportedthekeystatisticsforthedistribution.
pectationsforthequalityofthelogs.Byobservingtheproperties
ofthelogs,wecanimplicitlyreasonaboutthequalityproperties Table2:Loglevelassignmentempiricalstudyresults.
oftheloginstruction.Fortheimplicitview,therearefourprop-
erties[44],givenasfollows:(b.1)trustworthiness -referstothe Min 1stQu. Median 3rdQu. Max
validmeta-informationofthelog(e.g.,correctloglevel),(b.2)the AverageEntropy 0.00 0.00 0.00 0.56 0.91
semantics/linguisticofthelog-relatesthewordchoiceinverbose
expressionoftheevent,(b.3)completeness-reflectstheco-occurring Table2summarizesthen-gramsentropydistribution.Itisseen
oflogstodescribeanevent,and(b.4)safeness-referstothelog that the majority of the static text of the log instructions have
contentbeingcompliantwithusersafetyrequirements. lowentropy.Specifically,morethan50%(themedian)ofthestatic
Sinceourgoalistoprovideanautomaticloginstructionquality textshavezeroentropy–then-gramsappearonauniquelevel.
assessment,wefirstexaminethefeasibilityofautomaticallyevalu- Therefore,thestatictexthasrelevantfeaturesusefultodiscriminate
atingtheproperties.Weobservedthatsomeoftheproperties(i.e., theloglevels,verifyingourassumption.
correctloglevelassignmentandlinguisticevaluation)dependand 2.2.2 Linguistic Quality Assessment. A quality log instruction
canbeassessedjustfromthecontentofloginstructions.There- should describe the event concisely and verbosely [6]. From a
fore,theycanbeevaluatedirrelevanttothestructureofthesource general language perspective, complete and concise short texts
codeandtheremainingloggingpractices.Toverifyourobserva- (followingthemaximsoftextquantityandquality)haveaminimal
tion,wemadeapreliminarystudyofnineopen-sourcesystems, linguisticstructure(e.g.,usageofnouns,verbs,prepositions,adjec-
withpresumablygoodloggingpractices(similarlyasinrelated tives)[14].Underthetermloglinguisticstructure,weunderstand
works[6,34,41]).Table1enliststhepropertiesoftheusedsystems. therepresentationofthestatictextbygenerallinguisticproperties
Weselectthesesystemsbecausetheyservemanyindustries,arebe- suchaslinguisticconcepts(e.g.,verbs,nouns,adjectivesetc.).For
ingdevelopedbymanyexperienceddevelopers,andconsequently, example,intheJiraissueZOOKEEPER-2126(depictedinFigure1c),
thelogshavefulfilledtheirpurposeindebuggingandmaintenance. thestatictext"EventThreadshutdown."linguisticallyiscomposed
of"nounverbparticle".Owningtothesharedpropertiesofthegen-
2.2 EmpiricalStudy eralEnglishlanguageandlanguageusedinloginstructions[22],we
2.2.1 Log Level Assignment. We assume that the static text of assumethataninformativeeventdescriptionalsohasaminimallin-
theloginstructionhasrelevantfeaturesforloglevelassessment. guisticstructure.Thefollowingexampleexplainsourintuitionfor
ICPC2022,May21–22,2022,Pittsburgh,PA,USA Bogatinovski,etal.
theassumption.IntheaforenamedJiraissue,developersreported ofsoftwaresystemsandthewaysprogramminglanguagesorga-
thattheeventinformationisinsufficient.Thisissueisresolvedby nizethesourcecode.Forexample,thesafenesspropertyrequires
statictextaugmentationwithadditionallinguisticproperties,i.e., reasoningacrossacomplexchainofmethodinvocations(e.g.,in
"EventThreadshutdownforsession:{}",linguisticallycomposedof theissueCVE-2021-44228thebugallowsexecutionofanyJava
"nounverbparticleprepositionnoun:-LRB--RRB-"(where"-LRB- methodthroughtheloginstructionfromanLDAPserverhurting
-RRB-"denotebrackets).Linguisticallyspeaking,thestatictextwith theloggingsafeness).Identifyingsafenessinthiscontextrequiresa
insufficientlinguisticstructureistransformedintostatictextwith deepunderstandingofpotentialmethodinvocationchains,which
sufficientstructure,improvingtheeventcomprehension.Examples doesnotevenrequirethemethod’spresencewithinthesource
ofotherJiraissuesrelatedtosufficientlinguisticqualitycanbe code,i.e.,requiringhumaninvolvement.Thelatterisagainstour
foundinAppendixC. effortinautomaticlogqualityassessment.Duetotheidentified
Tovalidateourassumption,weperformedthefollowingexper- relationshipsbetweenthestatictextandloglevelandsufficient
iment.Forthestatictextofeachloginstruction,wefirstextract linguisticstructureononeside,andthedependenceoftheother
theirlinguisticstructure.Todoso,weusepart-of-speech(POS) qualitypropertiesontheremainingpartsofthesourcecodeonthe
tagging–alearningtaskfromNLPresearch.Itallowsextraction otherside,weconsiderthelogqualityassessmentinthenarrower
ofthelinguisticstructureofthestatictextbylinkingthewords sense,composedoftheformertwoqualityproperties.
toanontologyoftheEnglishlanguage(OntoNote5).Wechoose
spacyimplementationofPOStaggingbecauseitsmodelshavehigh
3 QULOG:AUTOMATICAPPROACHFORLOG
performanceonthePOStaggingtask(>97%accuracyscore)[23].
Second,wegrouptheextractedlinguisticstructuressuchthatthe INSTRUCTIONQUALITYASSESSMENT
statictextwiththesamelinguisticgroupareplacedtogether.Af- Inspired by our findings in the preliminary study, we propose
terwards,thelinguisticgroupsoftherawstatictextareevaluated anapproachforautomaticsystem-agnosticloginstructionquality
bytwoexperienceddevelopersansweringtheresearchquestion: assessment.Weformulatetheprobleminthescopeof1)evaluating
"Doesthestatictextfromtheexaminedlinguisticgroupcontains thecorrectloglevelassignmentand2)evaluatingthesufficient
minimalinformationrequiredtocomprehendthedescribedevent?". linguisticstructureoftheloginstructions.Giventhestatictext
Thisquestionevaluatesourassumptionthatthequalityandself- oftheloginstruction,weapplydeeplearningmethodstolearn
sustainedstatictexthasaminimallinguisticstructurealignedwith statictextpropertiesconcerningthecorrectloglevelandsufficient
expertintuitionforacomprehensibleeventdescription. linguisticstructure.Bytrainingthemodelsonsystemswithquality
loggingproperties,theylearninformationforthelogleveland
Table3:Linguisticqualityassessmentpreliminarystudy sufficientlinguisticstructurequalities.Comparingthepredictedlog
levelsandtheloglevelsassignedbydevelopersallowsastatement
TotalLog StaticText ontheloglevelquality:thelessdeviation,thebetterthequality.
LinguisticGroup
Instructions (Example) Similarly,thesufficientlinguisticstructureincorporatesproperties
VERBNOUN 106 serializedregioninfo ofcomprehensibleloginstructions,anditspredictionsdirectlyare
VERB 67 deleted usedtoassesslinguisticquality.
VERBPUNCT 49 interupted* Figure2illustratestheoverviewoftheapproach,namedQuLog.
NOUN 47 return Logically,itiscomposedof(1)loginstructionpreprocessing,(2)deep
learningframeworkand(3)predictionexplainer.Theroleofthelog
NOUNNOUN 41 updatingheader
instructionpreprocessingistoextracttheloginstructionsfromthe
inputsourcefilesandprocessthemintoasuitablelearningformat
Table3givesthetop-5frequentlinguisticgroupsalongsiderep-
forthedeeplearningframework.Thedeeplearningframeworkis
resentativeexamples.Intotal,wefound5.9Klinguisticgroupsfrom
composedoftwoneuralnetworks(oneforeachofthetwoquality
thestudiedsystems.Then,werandomlysample361groupsbased
properties).Theneuralnetworksaretrainedseparatelyonthetwo
ona95%confidenceintervalanda5%confidencelevel[46].The
tasks.Aftertraining,thenetworkslearndiscriminativefeatures
samplingisstratifiedovertheninesystems.Thetwohumanexperts
fortheloginstructionswithdifferentloglevelsandasufficient
identified24linguisticgroupswithinsufficientlinguisticstructure.
linguisticstructure.Thepredictionexplainerexplainsacertainpre-
TheagreementbetweenthetwoexpertsassessedbyCohen’sKappa
diction.Specifically,giventhestatictextoftheloginstructionand
scoreissustainable(0.72)[42].Thehighscorevaluesshowmutual
predictedloglevel,itshowshowdifferentwordscontributetothe
agreementbetweentheexperienceddevelopersconcerningthere-
modelprediction.
lationbetweencomprehensibleeventinformationwithinthestatic
QuLoghastwooperationalphases:offlineandonline.During
textanditslinguisticstructure.Therefore,thelinguisticstructure
theofflinephase,theparametersoftheneuralnetworksandexpla-
ofthestatictextisusefulinrepresentingtheminimalinformative
nationpartarelearnedonrepresentativedatafromothersoftware
descriptionoftheloginstruction.
systems.Thistrainingprocedureallowslearningdiversedevelopers
2.2.3 OtherQualityProperties. Theremainingqualityproperties writingstyles,importantforgeneralization.Thelearnedmodelsare
(i.e.,relevantvariableselection,loginstructionplacement,safeness, stored.Intheonlinephase,thesourcefilesofthetargetsoftware
andcompleteness)dependonthedifferentprogramminglanguages, systemaregivenasQuLog’sinput.QuLogextractstheloginstruc-
designpatterns,andothersourcecodestructures.Theseproper- tions,thestatictextsandloglevels,proceedingthemtowardsthe
tiesarechallengingforassessmentbecauseoftheheterogeneity loadedmodels.AsoutputQuLogprovidesthepredictionsforthelog
QuLog:Data-DrivenApproachforLogInstructionQualityAssessment ICPC2022,May21–22,2022,Pittsburgh,PA,USA
Neural Network Framework Prediction Explainer
Learned Embeddings
Target Software Code Repository Embedding 1: [LMT] 𝑥1:[0.29, … , 0.61]
Layer: 2: connection 𝑥2:[0.01, … , 0.32]
S 17o 4u :r c ife C onod de it: T3: r ke ef nu is ze ad 𝑥3:[0.31, … , 0.69] 2 3: c reo fn un se ec dt i 𝑥o 3n 𝑥2
c i on==False: o tion :
175: log.error(“connection refused %f !”, time) Multi-head Log Level Assignment
Self-attention NN: Self-attention NN SHAP
Shapley values for
Log Instruction Preprocessing Output Layer: {𝑖𝑛𝑓𝑜,𝑤𝑎𝑟𝑛𝑖𝑛𝑔,𝑒𝑟𝑟𝑜𝑟} individual vectors
Log Instruction Extractor:
𝑡2 𝑡3
P (lo “r ceg op.e nar r nr ao etr i c( o“ tnc io:o nnn re ec ft uio sn e dr ”e ,fused %f !”, time) Embe Ld ad yi en rg : 1 2 3: : : [ n vL eoM ru bnT] 𝑥 𝑥 𝑥1 2 3: : :[ [ [0 0 0. . .1 3 49 1 1, , , … … … , , , 0 0 0. . .7 2 82 4 9] ] ] A Fg ug nre cg tia ot nio sn
error, Tokenization 𝑡2: connection𝑡3:refused
“noun, verb”) Multi-head Linguistic Structure Token Importance Scores
Self-attention NN: Assessment Self-attention NN favorable for info
non-favorable for info
Output Layer: {"𝑠𝑢𝑓𝑓𝑖𝑐𝑖𝑛𝑒𝑡","𝑖𝑛𝑠𝑢𝑓𝑓𝑖𝑐𝑖𝑛𝑒𝑡"}
Figure2:InternalarchitecturaldesignofQuLog
levels,sufficientlinguisticstructure,andpredictionexplanations 3.1.2 Preparation. Thegoalofthepreparationmoduleistopre-
as word importance scores. Therefore, QuLog serves as a stan- parethedatainasuitablelearningformat.Asinput,itreceivesthe
dalonerecommendationapproachtoaiddevelopersinimproving setofloginstructionsfromtheextractor.Thepreparationmodule
thequalityoftheloginstructions.Thedevelopersmayreconsider firstiteratesovertheloginstructionsandseparatesthestatictext
improvingtheloginstructionsgivenQuLog’ssuggestionsorreject oftheloginstructionsfromtheloglevel.Thediverseprogramming
them.Inthefollowing,wedelineatethedetailsofthethreeQuLog’s languagesusedifferentnamesfortheloglevels.Forexample,Log4j
components. (aJava’slogginglibrary)usesthetag”𝑤𝑎𝑟𝑛”forwarninglogs,while