### Number of Sets of Bits and Parity Disclosure
The fourth metric, the non-randomness measure, currently serves as a placeholder until randomness testing is integrated into the system. We anticipate that this testing will yield a measure in the form of a number of bits by which to shorten the string.

### Transparent Eavesdropping in QKD
Information from transparent eavesdropping is not uniformly treated within the Quantum Key Distribution (QKD) community. This category encompasses all eavesdropping that does not introduce errors, initially thought to include only beamsplitting attacks on multi-photon pulses. Recent research, however, has revealed more general attacks of a similar nature. For example, Brassard et al. [13] have highlighted that weak coherent systems are particularly vulnerable to "Positive Operator Valued Measure" (POVM) attacks. The amount of information leaked can be proportional to the number of transmitted bits times the multi-photon probability, rather than the number of bits received by Bob. In contrast, with entangled-photon links, the information Eve may obtain is proportional to the number of received bits times the multi-photon probability.

### Non-Transparent Eavesdropping
An unresolved issue is the amount of information Eve can obtain through non-transparent eavesdropping. Following Slutsky et al. [21], we refer to these as defense functions. Several defense functions have been published for quantum cryptographic systems, with two of the most well-known being those by Bennett et al. [1] and Slutsky et al. [21]; see the Appendix for details. Neither appears to be entirely accurate—Bennett’s estimate does not account for all the information Eve can gather from indirect attacks with an error rate below 25%, while Slutsky’s estimate, though asymptotically correct, is overly conservative for finite-length blocks.

### Entropy Estimates and Defense Functions
Given our expectation to refine entropy estimates in the future and compare different systems under similar assumptions, we provide a choice of defense functions. Currently, we support both Bennett and Slutsky. Both estimates include a margin for certainty based on the standard deviation. Bennett’s estimate uses 5 standard deviations, including the standard deviation of the multi-photon probability. Slutsky’s estimate is parameterizable in terms of the probability of a successful attack but does not include multi-photon probabilities. For consistency, we separate out the standard deviation of each term and combine them at the end, multiplied by a confidence parameter \( c \) (e.g., \( c = 5 \) means 5 standard deviations, or about a 10\(^{-6}\) chance of successful eavesdropping).

### IPsec Extensions
Once "finished" quantum cryptographic key material is available, it can be used as keys for one or more applications. Our first use is as standard cryptographic keys for IPsec-based Virtual Private Networks (VPNs). We have extended both the IPsec traffic processing path and its key agreement protocol (IKE) to use key material obtained via quantum cryptography. Since new key material is constantly streaming to both Alice and Bob, they can continuously update the keys used in their cryptographic algorithms. Currently, we use these keys as input to the IPsec Phase 2 hash and update the resultant AES keys approximately every minute.

### IPsec and IKE
IPsec provides a secure framework for communications within the Internet Protocol suite, defined by RFC 2401, Security Architecture for the Internet Protocol. One of its components, the Internet Key Exchange (IKE) protocol, allows two endpoints to agree on cryptographic protocols, algorithms, and keys for a given security association. IKE is defined by RFC 2409, The Internet Key Exchange (IKE).

Although IKE is a complex protocol, its basic concepts are straightforward. Figure 11 illustrates the key elements involved in an ongoing relationship between two IKE peers, providing a high-level, schematic view rather than a detailed software architecture.

### IKE and IPsec Architecture
Every security association has a maximum lifetime, which dictates how long the key material for that association can be used. This lifetime can be expressed in time (seconds) or data encrypted (kilobytes) and is configured via the Security Policy Database (SPD) entry for a given security association. When the lifetime expires, a new security association must be negotiated, bringing fresh key material. This process, known as "key rollover," replaces an older key with a newer one while still protecting the same underlying traffic flow.

### Implementation in NetBSD
Our first implementation runs on NetBSD with the 'raccoon' IKE daemon. We have modified both the kernel and the IKE daemon to introduce QKD extensions. The QKD protocol engine also runs on the same NetBSD platform.

Our extensions fall into two categories: those using QKD techniques for secret key agreement, employed as seeds for conventional symmetric ciphers (e.g., AES and 3DES) with continuous reseeding by fresh QKD bits, and those using a sequence of QKD bits as a one-time pad or Vernam cipher for message traffic. In the rapid-reseeding extension, distilled QKD bits are included in the IKE Phase 2 hash, so keys protecting IPsec Security Associations (SAs) are derived from QKD. Figure 12 shows the first instance where this extension worked with real QKD bits, creating a VPN with quantum cryptography.

### Ancillary Changes
Ancillary changes include policy mechanisms to specify when either of these extensions should be used on a per-tunnel basis and negotiation mechanisms to agree on which QKD bits will be used. Our implementation currently supports multiple VPNs per cryptographic gateway, each with its own set of cryptographic algorithms, keys, and rekey rates. Some may use conventional cryptography (e.g., AES), while others employ one-time pads, depending on the sensitivity of the traffic within a given VPN.

### IKE and QKD
Using IKE for quantum cryptography highlights some rarely-exercised parts of the IKE design that may impact our overall system. First, timeouts, especially the maximal amount of time for IKE negotiations, may need to be adjusted for QKD, as it may take longer to accumulate enough bits for a successful negotiation. Second, IKE lacks mechanisms to handle cases where Alice and Bob believe they share secret bits, but these bits are not identical due to noise on the single-photon channel. This can lead to failed security associations until a new one is established.

### Future Plans
We are now building multiple QKD links woven into an overall QKD network that connects endpoints via a mesh of QKD relays or routers. If a point-to-point QKD link fails, another link is used instead, making the network resilient against active eavesdropping or denial-of-service attacks. QKD networks can be built in several ways: one variant transports only keying material, while another transports both keying material and message traffic. These networks extend the geographic reach of quantum-secured networks and mitigate the drawbacks of point-to-point links.