返璞归真
重识物理安全与近源渗透
返璞归真
重识物理安全与近源渗透
PushEAX
CONTENTS
目录
01
02
03
第一章 ：近源威胁面分析
第三章 ： ANT Tools工具包介绍
第二章 ：近源渗透手段
近源威胁面分析
——虽然只有极少黑客选择在真实世界发起进攻， 但我们面对的威胁远不止与此。
01
谁会选择在现实世界发起攻击？
2007年，网络托管商CI Host的数据中心遭到两名蒙面男子抢劫。
劫匪在持枪劫持了一名IT员工后，盗窃了20台服务器。
黑客攻击(物理)
攻击者通过贿赂内部员工，在厂区内安装无线路由器。利用无线
信号直接连入企业内网，侵入内网中的信息系统。
通过为他人“改机、解锁”手机共9000余部，五个月违法所得
300余万元。
前员工入侵富士康网络：疯狂洗白iPhone获利300万
外部威胁
近源
威胁
高级黑客 / APT组织 / 间谍
服务提供商 / 硬件供应链
盗窃 / 数据取证
内部威胁
恶意的内部人员
因疏忽或无知造成的威胁
案例1：五十年前的键盘记录器
1970年代，苏联为窃取机密，在物
流阶段截取了美国大使馆的打字机，
植入了一个完全由机械结构构造的键
盘记录器。
案例4：数据取证技术
案例3：淘汰设备泄露数据
2019年，某互联网公司淘汰机房交换机时，未
清除设备NVRAM中的配置信息。
泄露了其中的设备登录密码的Hash、内网IP信
息、VLAN信息、BGP和OSPF配置等等。
案例2：震网的攻击源自于间谍带入
的U盘
荷兰情报机构策反了一名伊朗工程师。将带有
病毒的USB闪存驱动器带入了核电站的内部系
统。
案例5：主板内置广告软件
国内外多个笔记本电脑生产厂家，曾被发现在
主板的固件程序中内置广告、驱动管理等软
件。
即使在更换硬盘并重装系统后，在引导过程中
也会被安装特定程序。
近源渗透手段
——近源渗透不止BadUSB
02
接触时间
短
长
接触难度
低
高
第二类攻击手段：
攻击者所需的接触时间长，或接触难度大。
第一类攻击手段：
攻击者所需的接触时间短，
或接触难度小。
第三类攻击手段：
攻击者在一定时间内可以完全控制目标设备，或
者可以改变其内部硬件或固件。
第一类攻击手段
特点：所需的接触时间短，或接触难度小
攻击者：常见为红队成员、外部黑客
目标：钓鱼攻击、无线设备、裸露的接口
第二类攻击手段
特点：所需的接触时间长，或接触难度大
攻击者：带有良好的条件，常见为企业“内鬼”
目标：计算机终端、服务器KVM等
第三类攻击手段
特点：在一定时间内可以完全控制目标设备，或可以
改变其内部硬件或固件
攻击者：APT组织、恶意的硬件供应商
目标：硬件设备内部组件、设备固件
近源渗透手段
社会工程学 / 钓鱼
第二类近源攻击
攻击无线设备
植入硬件后门
第一类近源攻击
第三类近源攻击
撬锁
攻击计算机终端
数字取证
供应链投毒
终端机 / 裸露接口
一: 社会工程学攻击
身份伪装
1. 伪装为外卖员、快递员
2. 伪装为面试者、维修工
钓鱼 / 水坑攻击
1. 投递BadUSB及类似设备、植入硬件后门
2. 在公共设备上安装后门
信息收集
1. 盗取访问凭证（工牌图案及UID、文档、公章）
2. 废弃文件、设备的收集
二: 攻击无线设备
无线网络
1. 跑包握手包 / WPS Pin爆破
2. 钓鱼热点
RFID类设备
1. ID卡的拷贝、爆破
2. IC卡的破解、拷贝
无线电锁具
1. 无线信号的重放攻击
攻击无线设备——RFID锁具
主要分为ID卡和IC卡
1. ID卡较为古老，但廉价。内部只有一个ID号。
2. IC卡内部有存储器，并且可以加密数据
最广泛使用的是NXP的Mifare系列IC卡
1. 包含1K或4K的存储空间。每张卡有一个UID号
2. 由于存在多个已知漏洞，容易被破解
攻击手段
1. 使用带有NFC功能的手机进行破解
2. 使用PN532进行破解
攻击无线设备——M1卡的破解
结构
1. 含有1K存储空间
2. 分为16个扇区。每个扇区包含两个访问密钥
UID
1. 扇区0的区块0为厂商信息，原则上只读
2. 扇区0的区块0-3为卡片UID
常见安全问题
1. 门禁只校验UID，造成加密失效
2. 使用默认Key或弱Key
攻击无线设备——无线电锁具
使用无线电遥控的锁具
1. 常见于门禁、车库栏杆
2. 也可用于偷电瓶
通过某个频段的无线电进行通讯
1. 常见为315Mhz、433Mhz
2. 开锁时，遥控器会发送一段“码”
攻击手段
1. 针对固定码，可直接重放攻击
2. 针对滚动码，需要破解出码的生成规律
攻击无线设备——HACKCUBE
功能
1. EM41xx卡的读取和模拟
2. 315、433Mhz无线电信号重放、爆破
3. 通过Wi-fi远程进行HID注入
4. 1Ghz以下频段的干扰
HackCube
开源的无线电审计硬件平台
由360 UnicornTeam开发
三: 终端机、裸露接口
终端机的逃逸
1. 双击或长按呼出右键菜单
2. 通过屏幕键盘呼出cmd、Win+D键返回桌面
3. 在网页中存在浏览文件、发送邮件等链接
4. 通过报错，呼出弹窗或使得程序崩溃
5. 可遇不可求的报错或崩溃
6. 直接在设备后面关开关或拔电源线
三: 终端机、裸露接口
终端机利用
1. 安装木马或开启远程桌面等后门
2. 直接在设备上进行内网渗透
3. 在公用电脑上安装键盘记录器等后门
4. 获取网络配置、应用配置等
终端机、物联网设备、网络设备的裸露接口
1. 通过网口直接进行内网渗透
2. 在网口上安装路由器作为网络后门
3. 通过USB等接口向设备植入木马、盗取数据
4. 通过Console口控制设备
5. 通过UART等接口控制设备
Kon-Boot（开机密码绕过）
安装在U盘上。
近源渗透时，通过U盘启动计算机，运
行Kon-boot。
即可使得Windows密码失效。或安装
Shift键后门、添加新账号。
四: 攻击计算机终端
PoisonTap（网关劫持）
安装在树莓派上。
插入USB接口后，会伪装成USB网卡，
劫持计算机的网关。
可以无视锁屏抓取流量、Cookies，进
行缓存投毒。
P4wnP1（USB相关攻击）
安装在树莓派上。
多功能的USB攻击工具。
可以模拟为键盘鼠标、网卡、U盘等设
备。
可以远程进行HID攻击
Windows Lnk代码执行漏洞
安装在U盘上。
当未安装补丁的电脑打开U盘时，即出
发任意代码执行。
常用漏洞：
CVE-2020-0729、CVE-2017-8464
WiFiDuck （HID注入或称BadUSB）
硬件设备。
带有Wi-Fi的HID注入设备。
可以通过Wi-Fi操控，执行特定的键盘输
入。
用于下载并执行木马、窃取数据等。
Inception / PCILeech（DMA攻击）
安装在带有FireWire接口的计算机上。
近源渗透时，接入目标计算机的
FireWire或雷电接口。即可直接读写内
存。
可用于植入木马、绕过密码验证等。
五: 硬件后门
输入/输出设备
1. 键盘记录器、HID注入设备
2. 屏幕记录器
网络相关
1. 内网后门
2. 流量监听
固件篡改
1. 盗取访问凭证（工牌图案及UID、文档、公章）
2. 废弃文件、设备的收集
ANT Tools工具包介绍
——开源且低成本的近源渗透工具包
03
NSA ANT catalog：美国国安局的黑客工具包
2013年，安全专家Jacob Appelbaum曝光了一份
长达50页的NSA机密文档《NSA ANT catalog》，
该文档描述了一系列名目繁杂的高端网络黑客攻击
技术和项目。
据该文档内容显示，相关的网络黑客攻击技术和项
目创建于2008年前后，它们可以认为是为美国国家
安全局下属接入技术行动处（TAO）专门定制研发
的先进网络攻击武器。
Hak5: 商业化的硬件渗透测试工具
ANT Tools：开源的近源渗透工具包
包含一系列的进攻工具和硬件后门设备
目前计划有：
•
USBAirborne： USB钓鱼设备
•
GrabAccess： Windows开机密码和Bitlocker绕过工具
•
USBKeylogger：硬件键盘记录器
•
Telescreen：硬件屏幕记录器
•
RadioRaid：无线安全测试平台
死去的Autorun突然开始攻击我
Autorun
新设备接入后，自动执行某些操作。
例如插入驱动程序光盘时自动运行安装程序。
现代Windows对Autorun的安全限制
1. 只允许DRIVE_FIXED（固定设备）的CD-ROM驱动器
2. 用Autoplay替代Autorun（受害者必须有交互）
利用方法
1. 伪造一个DRIVE_FIXED的CD-ROM驱动器
2. 在其中放入autorun.inf配置文件
最终效果
受害者通过任何方
式打开该U盘
即触发Payload
USBAirborne
内置4MB存储空间
通过修改USB DBINQUITY
伪装成DRIVE_FIXED的CD-
ROM
GrabAccess：WPBT的恶意利用
GrabAccess
绕过Widnows登陆密码、Bitlocker植入木马
Windows Platform Binary Table
1. Windows在引导过程中会检查主板的固件。
如果存在WPBT条目，则会加载其中的Native
Application。
2. 该功能无视Windows登陆密码和Bitlocker。
3. 会对Native App校验签名，但可被绕过。
4. 常用于制造商植入防盗软件、驱动程序。
5. 通过修改UEFI引导过程，可以添加WPBT的
ACPI条目。
最终效果
将GrabAccess安装在U盘。
近源渗透时将计算机设置为从U盘启动。
正常开机后即会植入木马，或安装Shift键
后门
杨文韬 @PushEAX
从事信息安全咨询和风险评估工作。
目前致力于近源渗透的理论研究和工具开发。
About Me