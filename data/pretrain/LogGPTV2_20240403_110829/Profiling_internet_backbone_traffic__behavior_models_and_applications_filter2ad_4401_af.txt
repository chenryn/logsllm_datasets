z
s
r
e
t
s
u
C
l
102
0
Flows
Packets
Bytes
20
40
Cluster index
60
80
(a) BC6, BC7, BC8
(b) BC18, BC19
(c) BC2, BC20
(d) Other BC’s
Figure 7: Average cluster size (in ﬂow, packet and byte count) distributions for clusters within four groups of BC’s for srcIP
clusters on L1. Note that in (c) and (d), the lines of ﬂow count and packet count are indistinguishable, since most ﬂows in the
clusters contain a singleton packet.
well-know service port. For example, Fig. 8(a) plots the
cluster sizes (in ﬂow, packet and byte counts) of the dstPrt
TCP 80 cluster (representing aggregate behavior of all web
servers) over the 24-hour period, whereas in Fig. 8(b) we
plot the corresponding RUsrcP rt, RUsrcIP and RUdstIP of
its three free dimensions over time. We see that the dstPrt
TCP port 80 cluster is highly persistent, observed in ev-
ery time slot over the 24-hour period, with the number of
srcIP’s (web servers) fairly stable over time. The cluster
size over time shows a diurnal pattern, but otherwise does
not ﬂuctuate dramatically. In addition, the packet and byte
counts of the cluster are considerably larger than the total
number of ﬂows, indicating that on the average each ﬂow
contains at least several packets and a few hundred bytes.
i
e
z
s
r
e
t
s
u
C
l
109
108
107
106
105
104
0
Flows
Packets
Bytes
y
t
n
a
i
t
r
e
c
n
u
e
v
i
t
l
a
e
R
50
100
150
Time
200
250
300
1
0.8
0.6
0.4
0.2
0
0
RU(srcPrt)
RU(srcIP)
RU(dstIP)
50
100
150
Time
200
250
300
(a) Cluster sizes
(b) RU measures
Figure 8: Cluster sizes (in ﬂow, packet and byte
counts) and RU measures of the dstPrt 80 cluster
(aggregate web traﬃc) on L1 over time.
An overwhelming majority of the srcIP clusters in BC6,7,8
are corresponding to Web, DNS or Email servers. They
share very similar behavior characteristics, belonging to the
same BC’s, stable with relatively high frequency, and con-
taining ﬂows with diverse packet/byte counts. Among the
remaining clusters, most are associated with http-alternative
services (e.g., 8080), https(443), real audio/video servers
(7070), IRC servers (6667), and peer-to-peer (P2P) servers
(4662). Most interestingly, we ﬁnd three srcIP clusters with
service ports 56192, 56193 and 60638. They share similar
characteristics with web servers, having a frequency of 12,
9 and 22 respectively, and with diverse ﬂow sizes both in
packet and byte counts. These observations suggest that
they are likely servers running on unusual high ports. Hence,
these cases represent examples of “novel” service behaviors
that our proﬁling methodology is able to uncover.
6.2 Heavy Hitter Host Behavior Proﬁle
The second canonical behavior proﬁle is what we call the
heavy-hitter host proﬁle, which represents hosts (typically
clients) that send a large number of ﬂows to a single or a few
other hosts (typically servers) in a short period of time (e.g.,
a 5-minute period). They belong to either the popular and
non-volatile srcIP BC18 [2,0,0] or BC19 [2,0,1], or the dstIP
BC6 [0,2,0] and BC7 [0,2,1]. The frequency of individual
clusters is varied, with a majority of them having medium
frequency, and almost all of them are stable. These heavy-
hitter clusters are typically associated with well-known ser-
vice ports (as revealed by the dominant state analysis), and
contain ﬂows with highly diverse packet and byte counts.
Many of the heavy-hitter hosts are corresponding to NAT
boxes (many clients behind a NAT box making requests to a
few popular web sites, making the NAT box a heavy hitter),
web proxies, cache servers or web crawlers.
For example, we ﬁnd that 392 and 429 unique srcIP clus-
ters from datasets L1 and L2 belong to BC18 and BC19.
Nearly 80% of these heavy hitters occur in at least 5 time
slots, exhibiting consistent behavior over time. The most
frequent ports used by these hosts are TCP port 80 (70%),
UDP port 53 (15%), TCP port 443 (10%), and TCP port
1080(3%). However, there are heavy-hitters associated with
In one case, we found one srcIP clus-
other rarer ports.
ter from a large corporation talking to one dstIP on TCP
port 7070 (RealAudio) generating ﬂows of varied packet and
byte counts. It also has a frequency of 11. Deeper inspec-
tion reveals this is a legitimate proxy, talking to an Audio
server. In another case, we found one srcIP cluster talking
to many dstIP hosts on TCP port 6346 (Gnutella P2P ﬁle
sharing port), with ﬂows of diverse packet and byte counts.
This host is thus likely a heavy ﬁle downloader. These re-
sults suggest that the proﬁles for heavy-hitter hosts could
be used to identify these unusual heavy-hitters.
6.3 Scan/Exploit Proﬁle
Behaviors of hosts performing scans or attempting to spread
worms or other exploits constitute the third canonical pro-
ﬁle. Two telling signs of typical scan/exploit behavior [30]
are i) the clusters tend to be highly volatile, appearing and
disappearing quickly, and ii) most ﬂows in the clusters con-
tain one or two packets with ﬁxed size, albeit occasionally
they may contain three or more packets (e.g., when per-
forming OS ﬁngerprinting or other reconnaissance activi-
ties). For example, we observe that most of the ﬂows using
TCP protocol in these clusters are failed TCP connections
on well-known exploit ports. In addition, most ﬂows using
UDP protocol or ICMP protocol have a ﬁxed packet size
that matches widely known signature of exploit activities,
e.g., UDP packets with 376 bytes to destination port 1434
(Slammer Worm), ICMP packets with 92 bytes (ICMP ping
probes). These ﬁndings provide additional evidence to con-
ﬁrm that such clusters are likely associated with scanning
or exploit activities.
A disproportionately large majority of extracted clusters
fall into this category, many of which are among the top
in terms of ﬂow counts (but in general not in byte counts,
cf. Fig. 7). Such prevalent behavior signiﬁes the sever-
ity of worm/exploit spread and the magnitude of infected
hosts (cf. [7, 8]). On the plus side, however, these hosts
manifest distinct behavior that is clearly separable from
the server/service or heavy hitter host proﬁles: the srcIP
clusters (a large majority) belong to BC2 [0,0,2] and BC20
[2,0,2], corresponding to hosts performing scan or spreading
exploits to random dstIP hosts on a ﬁxed dstPrt using ei-
ther ﬁxed or random srcPrt’s; the dstIP clusters (a smaller
number) belong to BC2 [0,0,2] and BC8 [0,2,2], reﬂecting
hosts (victims of a large number of scanners or attacks) re-
sponding to probes on a targeted srcPrt. Using speciﬁc
dstPrt’s that are targets of known exploits, e.g., 1434 (used
by SQL Slammer), the aggregate traﬃc behavior of exploits
is also evidently diﬀerent from that of normal service traﬃc
behavior (e.g., web): the dstPrt clusters typically belong
to BC23 [2,1,2], but sometimes to BC2 [0,0,2], BC5 [0,1,2],
or BC20 [2,0,2], representing a relatively smaller number of
srcIP hosts probing a larger number of dstIP hosts on the
target dstPrt using either ﬁxed or random srcPrt’s. This is
in stark contrast with normal service traﬃc aggregate such
as web (i.e., dstPrt 80 cluster), where a much larger num-
ber of clients (srcIP’s) talk to a relatively smaller number of
servers (dstIP’s) using randomly generated srcPrt’s, thus
belonging to dstPrt BC25 [2,2,1].
In addition to those dstPrt’s that are known to have
exploits, we also ﬁnd several (srcIP) clusters that mani-
fest typical scan/exploit behavior, but are associated with
dstPrt’s that we do not know to have known exploits. For
example, we ﬁnd that in one time slot a srcIP cluster is
probing a large number of destinations on UDP port 12827,
with a single UDP packet. This host could simply engage
in some harmless scanning on UDP port 12827, but it could
also be a new form of RATs (remote access trojans) or even
a precursor of something more malicious. Further inspec-
tion is clearly needed. Nonetheless it illustrates that our
proﬁling technique is capable of automatically picking out
clusters that ﬁt the scan/exploit behavior proﬁle but with
unknown feature values. This will enable network opera-
tors/security analysts to examine novel, hitherto unknown,
or ”zero-day” exploits.
6.4 Deviant or Rare Behaviors
We have demonstrated how we are able to identify novel or
anomalous behaviors that ﬁt the canonical proﬁles but con-
tain unknown feature values (as revealed by the dominant
state analysis). We now illustrate how rare behaviors or de-
viant behaviors are also indicators of anomalies, and thus
worthy of deeper inspection. In the following, we present a
number of case studies, each of which is selected to highlight
a certain type of anomalous behavior. Our goal here is not
to exhaustively enumerate all possible deviant behavioral
patterns, but to demonstrate that building a comprehensive
traﬃc proﬁle can lead to the identiﬁcation of such patterns.
Clusters in rare behavior classes. The clusters in the
rare behavior classes by deﬁnition represent atypical behav-
ioral patterns. For example, we ﬁnd three dstPrt clusters
(TCP ports 6667, 113 and 8083) suddenly appear in the
rare dstPrt BC15 [1,2,0] in several diﬀerent time slots, and
quickly vanish within one or two time slots. Close examina-
tion reveals that more than 94% of the ﬂows in the clusters
are destined to a single dstIP from random srcIP’s. The
ﬂows to the dstIP have the same packet and byte counts.
This evidence suggests that these dstIP’s are likely experi-
encing a DDoS attack.
Behavioral changes for clusters. Clusters that exhibit
unstable behaviors such as suddenly jumping between BCs
(especially when a frequent cluster jumps from its usual BC
to a diﬀerent BC) often signify anomalies.
In one case,
we observe that one srcIP cluster (a Yahoo web server) on
L1 makes a sudden transition from BC8 to BC6, and then
moves back to BC8. Before the transition, the server is
talking to a large number of clients with diverse ﬂow sizes.
After the behavior transition to BC6, a single dstIP ac-
counts for more than 87% of the ﬂows, and these ﬂows all
have the same packet and byte counts. The behavior of the
particular client is suspicious. This example illustrates how
fundamental shifts in communication patterns can point a
network security analyst to genuinely suspicious activities.
Unusual proﬁles for popular service ports. Clusters
associated with common service ports that exhibit behaviors
that do not ﬁt their canonical proﬁles are of particular con-
cern, since these ports are typically not blocked by ﬁrewalls.
For example, we have found quite a few srcIP clusters in
BC2 and BC20 that perform scans on dstPrt 25, 53, 80,
etc. Similar to the clusters with known exploit ports, these
srcIP clusters have small packet and byte counts with very
low variability. Note that these common service ports are
generally used by a very large number of clients, thereby
making it impossible to examine the behavior of each client
individually. Our proﬁling technique, however, can auto-
matically separate out a handful of potentially suspicious
clients that use these ports for malicious activities.
7. CONCLUSIONS
Extracting signiﬁcant or interesting events from vast masses
of Internet traﬃc has assumed critical importance in light
of recent cyber attacks and the emergence of new and dis-
ruptive applications.
In this paper, we have used data-
mining and information-theoretic techniques to automati-
cally discover signiﬁcant behavior patterns from link-level
traﬃc data, and to provide plausible interpretation for the
observed behaviors. We have demonstrated the applicabil-
ity of our proﬁling approach to the problem of detecting
unwanted traﬃc and anomalies. We are currently in the pro-
cess of implementing an on-line anomaly detection system
based on our proﬁling methodology, and carefully evaluat-
ing false positives and false negatives of this methodology
using trace-driven traﬃc simulations.
In addition, we are
looking into the problems of correlating anomalies on multi-
ple links, handling changes in traﬃc patterns due to routing
updates, and addressing “stealthy” attacks that attempt to
mask their malicious activities with seemingly benign traf-
ﬁc. Finally, we also would like to understand the implica-
tions and potential beneﬁts of extending our proﬁling ap-
proach beyond ﬂow-level header information to application-
level payload carried in IP packets.
Acknowledgement
We are grateful to Jean Bolot and Travis Dawson of Sprint
ATL for valuable feedback. We would also like to thank
the anonymous reviewers for helpful comments. Kuai Xu
and Zhi-Li Zhang were supported in part by the National
Science Foundation under the grants ITR 0085824 and CNS
0435444 as well as ARDA grant AR/F30602-03-C0243.
8. REFERENCES
[1] B. Krishnamurthy, S. Sen, Y. Zhang, and Y. Chen,
“Sketch-based Change Detection: Methods,
Evaluation, and Applications,” in Proc. of
ACM/USENIX IMC, 2003.
[2] G. Cormode, F. Korn, S. Muthukrishnan and D.
Srivastava, “Finding hierarchical heavy hitters in data
streams,” in Proc. of VLDB, 2003.
[3] S. Staniford, J. Hoagland, and J. McAlerney,
“Practical automated detection of stealthy portscans,”
Journal of Computer Security, vol. 10, pp. 105–136,
2002.
[4] J. Jung and V. Paxson and A. Berger and H.
Balakrishna, “Fast portscan detection using sequential
hypothesis testing,” in Proc. of IEEE Symposium on
Security and Privacy, 2004.
[5] J. Jung, B. Krishnamurthy, and M. Rabinovich,
“Flash Crowds and Denial of Service Attacks:
Characterization and Implications for CDNs and Web
Sites,” in Proc. of International World Wide Web
Conference, 2002.
[6] N. Weaver, V. Paxon, S. Staniford and R.
Cunningham, “A taxonomy of computer worms,” in
Proc. of CCS Workshop on Rapid Malcode(WORM),
2003.
[7] V. Yegneswaran , P. Barford and J. Ullrich, “Internet
intrusions: global characteristics and prevalence,” in
Proc. of ACM SIGMETRICS, 2003.
[8] R. Pang, V. Yegneswaran, P. Barford, V. Paxson and
L. Peterson, “Characteristics of Internet Background
Radiation,” in Proc. of ACM SIGCOMM IMC, 2004.
[9] A. Lakhina, M. Crovella, and C. Diot, “Diagnosing
Network-Wide Traﬃc Anomalies,” in Proc. of ACM
SIGCOMM, 2004.
[10] A. Lakhina, M. Crovella and C. Diot,
“Characterization of Network-Wide Anomalies in
Traﬃc Flows,” in Proc. of ACM SIGCOMM IMC,
2004.
[11] P. Barford, J. Kline, D. Plonka, and A. Ron, “A signal
analysis of network traﬃc anomalies,” in Proc. of
ACM SIGCOMM IMW, 2002.
[12] “SNORT,” http://www.snort.org/.
[13] V. Paxson, “Bro: A System for Detecting Network
Intruders in Real-Time,” Computer Networks, vol. 31,
pp. 2435–2463, Dec 1999.
[14] MINDS, “Minnesota Intrusion Detection System,”
http://www.cs.umn.edu/research/minds/.
[15] A. Lazarevic, L. Ertoz, A. Ozgur, J. Srivastava and V.
Kumar, “A comparative study of anomaly detection
schemes in network intrusion detection,” in Proc. of
SIAM Conf. Data Mining, 2003.
[16] W. Lee and D. Xiang, “Information-Theoretic
Measures for Anomaly Detection,” in Proc. of IEEE
Symposium on Security and Privacy, 2001.
[17] C. Estan, S. Savage, and G. Varghese, “Automatically
Inferring Patterns of Resource Consumption in
Network Traﬃc,” in Proc. of ACM SIGCOMM,
September 2003.
[18] F. Hernandez-Campos, A. B. Nobel, F. D. Smith, and
K. Jeﬀay, “Statistical Clustering of Internet
Communication Patterns,” in Proc. of Symposium on
the Interface of Computing Science and Statistics,
2003.
[19] S. J. Stolfo, S. Hershkop, K. Wang, O. Nimeskern, and
C. Hu, “Behavior Proﬁling of Email,” in Proc. of
NSF/NIJ Symposium on Intelligence & Security
Informatics, 2003.
[20] T. Karagiannis, K. Papagiannaki and M. Faloutsos,
“BLINC: Multilevel Traﬃc Classiﬁcation in the
Dark,” in Proc. of ACM SIGCOMM, August 2005.
[21] A. Lakhina, M. Crovella and C. Diot, “Mining
Anomalies Using Traﬃc Feature Distributions,” in
Proc. of ACM SIGCOMM, August 2005.
[22] C. E. Shannon and W. Weaver, The Mathematical
Theory of Communication. University of Illinois
Press, 1949.
[23] T. Cover and J. Thomas, Elements of Information
Theory. Wiley Series in Telecommunications, 1991.
[24] k. claﬀy, H.-W. Braun, and G. Polyzos, “A
parameterizable methodology for Internet traﬃc ﬂow
proﬁling,” IEEE Journal of Selected Areas in
Communications, 1995.
[25] K. Xu, Z.-L. Zhang and S. Bhattacharyya, “Proﬁling
Internet Backbone Traﬃc: Behavior Models and
Applications,” Sprint ATL Research Report
RR05-ATL-020777, Tech. Rep., February 2005.
[26] K. Krippendorﬀ, Information theory: structural
models for qualitative data. Sage Publications, 1986.
[27] R. Cavallo and G. Klir, “Reconstructability analysis of
multi-dimensional relations: A theoretical basis for
computer-aided determination of acceptable systems
models,” International Journal of General Systems,
vol. 5, pp. 143–171, 1979.
[28] M. Zwick , “An overview of reconstructability
analysis,” International Journal of Systems &
Cybernetics, 2004.
[29] M. Jordan, “Graphical models,” Statistical Science,
Special Issue on Bayesian Statistics, vol. 19, pp.
140–155, 2004.
[30] K. Xu, Z.-L. Zhang and S. Bhattacharyya, “Reducing
Unwanted Traﬃc in a Backbone Network,” in Proc. of
Steps to Reducing Unwanted Traﬃc on the Internet
Workshop (SRUTI), July 2005.