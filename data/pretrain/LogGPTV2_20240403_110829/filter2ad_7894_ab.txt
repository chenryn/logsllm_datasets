    TaskCategory=Pipe Created (rule: PipeEvent)
### Command and Control
#### QBot 细节 -24.229.150.54//41.228.22.180
24.229.150[.]54:995 / avlhestito[.]us
    Certificate: 25:a6:ef:79:48:98:54:ee:bb:a6:bd:10:ee:c1:f2:0a:00:ad:ac:ce
    Not Before  2021/11/15 09:24:49 UTC 
    Not After  2022/11/15 13:18:32 UTC 
    Issuer Org  Rsc Inpye LLC. 
    Subject Common  avlhestito[.]us
    Public Algorithm  rsaEncryption
    JA3: c35a61411ee5bdf666b4d64b05c29e64
    JA3s: 7c02dbae662670040c7af9bd15fb7e2f
41.228.22[.]180:443 / xrhm[.]info
    Certificate:    96:39:a9:52:e9:9a:1e:29:c5:dc:b3:72:01:29:74:c4:87:db:15:d7
    Not     Before:  2021/11/12 04:34:10 UTC 
    Not After:      2022/11/12 10:08:57 UTC 
    Issuer Org:  Bqatra Bamito Inc. 
    Subject Common:  xrhm[.]info
    Public Algorithm:  rsaEncryption
    JA3:  c35a61411ee5bdf666b4d64b05c29e64
    JA3s: 7c02dbae662670040c7af9bd15fb7e2f
下面是来自[Tria.ge](https://tria.ge/211115-r554waafe6/behavioral2)的初始访问 DLL
(Qbot)信息
[
Cobalt Strike细节-5.255.98[.]144
这个Cobalt Strike服务器于2021年11月16日被添加到我们的[Threat
Feed](https://thedfirreport.com/services/)。
5.255.98.144:8888 / 5.255.98.144:443 / 5.255.98.144:8080 / dxabt[.]com
    Certificate: [25:fe:be:6d:0e:8d:48:5a:94:cf:46:84:d7:7e:ff:bf:47:aa:04:5c ]
    Not Before: 2021/11/07 03:00:53 UTC     
    Not After: 2022/02/05 03:00:52 UTC      
    Issuer Org: Let's Encrypt   
    Subject Common: dxabt[.]com [dxabt[.]com,ns1.dxabt[.]com,ns2.dxabt[.]com,ns3.dxabt[.]com,ns4.dxabt[.]com
    Public Algorithm: rsaEncryption
    JA3: 0eecb7b1551fba4ec03851810d31743f
    JA3s: ae4edc6faf64d08308082ad26be60767
配置:
    {
        "x64": {
            "uri_queried": "/tRPG",
            "sha256": "dec25fc2fe7e76fe191fbfdf48588c4325f52bfe2769fbc88a5614541c1075eb",
            "config": {
                "HTTP Method Path 2": "/faq",
                "Jitter": 79,
                "C2 Server": "dxabt[.]com,/case",
                "Spawn To x86": "%windir%\\syswow64\\runonce.exe",
                "Method 1": "GET",
                "C2 Host Header": "",
                "Method 2": "POST",
                "Watermark": 426352781,
                "Spawn To x64": "%windir%\\sysnative\\runonce.exe",
                "Beacon Type": "8 (HTTPS)",
                "Port": 443,
                "Polling": 53988
            },
            "time": 1637416040175.3,
            "md5": "30cc71d5b5d7778774c54486558690d3",
            "sha1": "5f36c6cffdbae0d631c8889b4d9bad1248f899b3"
        },
        "x86": {
            "uri_queried": "/Mr0m",
            "sha256": "a992d57b2f6164e599952ea3c245962824ad17166684ed45e987efe80ebe611f",
            "config": {
                "HTTP Method Path 2": "/faq",
                "Jitter": 79,
                "C2 Server": "dxabt[.]com,/case",
                "Spawn To x86": "%windir%\\syswow64\\runonce.exe",
                "Method 1": "GET",
                "C2 Host Header": "",
                "Method 2": "POST",
                "Watermark": 426352781,
                "Spawn To x64": "%windir%\\sysnative\\runonce.exe",
                "Beacon Type": "8 (HTTPS)",
                "Port": 443,
                "Polling": 53988
            },
            "time": 1637416038974.9,
            "md5": "c1fd49c043894c1dff8bc02b17f8942c",
            "sha1": "e915f74be310b1687db6b290af2f78583a981512"
        }
    }
### 泄露
当攻击者在环境中活动时，我们收到了3个不同的警告，声称有人从 IP 地址
91.193.182[.]165打开了canary文档。这些警报告诉我们，数据确实是从环境中泄露出来的。
[
攻击者最感兴趣的是有关财务报表、勒索软件报告和薪水数据的文件。
c2通道被加密了 ，并与内部文件服务器建立了多个连接。没有观察到可能的外泄的其他通信，我们得出结论，C2通道是用来进行信息提取的。
[
时间17:35，Cobalt Strike信标被部署在文件服务器上。
根据每分钟从 File Server 到 c2的连接数，我们可以得出结论，信息泄露是在时间17:52到18:00之间完成的。
[
文件共享服务器到 Cobalt Strike 命令和控制服务器的流量高峰。
### IOCs
### Network
    QBOT
    24.229.150[.]54:995  - avlhestito[.]us
    41.228.22[.]180:443 - xrhm[.]info 
    Cobalt Strike
    5.255.98[.]144:8888 / dxabt[.]com
    5.255.98[.]144:443 / dxabt[.]com
    5.255.98[.]144:8080 / dxabt[.]com
### File
    Intial Exec Qbot DLL
    MD5:53510e20efb161d5b71c4ce2800c1a8d
    SHA1:2268178851d0d0debb9ab457d73af8a5e50af168
    SHA2:e2bc969424adc97345ac81194d316f58da38621aad3ca7ae27e40a8fae582987
    QBot DLL (extracted from registry):
    MD5:312e52b4109741893f17bc524084100f
    SHA1:7ca650945223eab088f43fd472e3592be2ed9d32
    SHA2:4d3b10b338912e7e1cbade226a1e344b2b4aebc1aa2297ce495e27b2b0b5c92b
    cool.exe
    MD5:59E7F22D2C290336826700F05531BD30
    SHA1:3B2A0D2CB8993764A042E8E6A89CBBF8A29D47D1
    SHA256:F63E17FF2D3CFE75CF3BB9CF644A2A00E50AAFFE45C1ADF2DE02D5BD0AE35B0
## Detections
### Network (More ET rules coming 2/23/22)
    ET POLICY Powershell Activity Over SMB - Likely Lateral Movement
    ET POLICY Command Shell Activity Using Comspec Environmental Variable Over SMB - Very Likely Lateral Movement
    ET RPC DCERPC SVCCTL - Remote Service Control Manager Access
    ET CNC Feodo Tracker Reported CnC Server group 15
    ET CNC Feodo Tracker Reported CnC Server group 16
    The following rules may cause performance issues (and are disabled by default) according to @ET_Labs
    ET EXPLOIT Possible Zerologon NetrServerReqChallenge with 0x00 Client Challenge (CVE-2020-1472) - 2030870
    ET EXPLOIT Possible Zerologon NetrServerAuthenticate with 0x00 Client Credentials (CVE-2020-1472) 2030871 
    ET EXPLOIT [401TRG] Possible Zerologon (CVE-2020-1472) UUID flowbit set - 2030888
    ET EXPLOIT [401TRG] Possible Zerologon (CVE-2020-1472) M2 - 2030889
### Sigma
    title: Scheduled task executing powershell encoded payload from registry
    status: Experimental
    description: Detects the creation of a schtask that executes a base64 encoded payload stored in the Windows Registry using PowerShell.
    author: @Kostastsale, @TheDFIRReport
    references: 
      - https://thedfirreport.com/2022/02/21/qbot-and-zerologon-lead-to-full-domain-compromise/
    date: 2022/02/12
    logsource:
      product: windows
      category: process_creation
    detection:
      selection1:
        Image|endswith: '\schtasks.exe'
        CommandLine|contains|all:
          - '/Create'
          - '/SC'
      selection2:
        CommandLine|contains|all:
          - 'FromBase64String'
          - 'powershell'
          - 'Get-ItemProperty'
          - 'HKCU:'
      condition: selection1 and selection2
    falsepositives:
      - Uknown
    level: high
    tags:
      - attack.execution
      - attack.persistence
      - attack.t1053.005
      - attack.t1059.001
    title: Execution of ZeroLogon PoC executable
    status: Experimental
    description: Detects the execution of the commonly used ZeroLogon PoC executable.
    author: @Kostastsale, @TheDFIRReport
    references: 
      - https://thedfirreport.com/2021/11/01/from-zero-to-domain-admin/
      - https://thedfirreport.com/2022/02/21/qbot-and-zerologon-lead-to-full-domain-compromise/
    date: 2022/02/12
    logsource:
      product: windows
      category: process_creation
    detection:
      selection1:
        ParentImage|endswith: 