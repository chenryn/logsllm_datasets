to have small prime divisors. The rejection of 2047-bit RSA
keys increased the average key generation time even more – to
141 seconds. The generation of both ID card key pairs alone,
would have extended the renewal process by approximately
ﬁve minutes on average, and, in worst-case scenarios, even
more time as shown in Figure 15b.
For the jTOP SLE78-powered ID cards the worthless prac-
tice of using a random public exponent was ended. The aver-
age time of 13 seconds (see Figure 16 for distribution) was
deemed to be acceptable in the initial key generation process
as well as for ID card renewal in PPA customer service points.
Later, the switch to ECC using curve P-384 decreased the
on-card key generation time to 0.37 seconds on average.
The fact that the same key was imported in two different
ID cards renewed in different PPA customer service points
suggests that the keys were generated in the manufacturer’s
backend and imported in the ID card over the Internet. Even
if the keys were sent over an end-to-end encrypted channel,
the logs and the symmetric card management keys could be
used by the manufacturer to recover imported private keys.
The manufacturer’s unauthorized modiﬁcation of the
EstEID applet also has far-reaching implications on the valid-
ity of digital signatures made with the affected platform. Since
this modiﬁed version of the EstEID applet never passed the
secure-signature-creation device (SSCD) conformity assess-
ment as required by the eSignature Directive 1999/93/EC [36],
this ID card platform never had the SSCD status, which is the
legal prerequisite for a digital signature to have handwritten
signature status.
(a) e = 65537
(b) Random 4-byte e
Figure 15: jTOP SLE66: time distribution of 2048-bit RSA
key generation (CRT form)
Figure 16: jTOP SLE78: time distribution of 2048-bit RSA
key generation (CRT form, e = 65537)
Incident response
5.4
After receiving our analysis, the authorities decided to recall
the jTOP SLE66-powered ID cards renewed in PPA customer
service points. From more than 74 000 renewed ID cards,
only 12 500 were still valid.
USENIX Association
29th USENIX Security Symposium    1795
050100150200250Time (s)050100150200250Time (s)020406080100Time (s)On 2018-05-17, PPA went public announcing that 12 500
ID cards did not meet the security requirements, because their
private keys had been generated outside the chip. These cards
would be replaced under warranty and on 2018-06-01 the
affected certiﬁcates would be revoked. [37]
On the same day, the affected cardholders received email
notiﬁcation to apply for the replacement. The cardholders
had to respond, specifying the PPA customer service point
where they would collect the new card. As a replacement, the
cardholders received jTOP SLE78-powered ID cards with the
same expiration date as the original. The replacement card,
however, was not issued if the original expiration date was in
less than three months. [37, 38]
On 2018-06-01, the certiﬁcates of 11 100 non-replaced ID
cards were revoked, with 3 300 cardholders waiting to re-
ceive the replacement card [39]. The legal basis for certiﬁcate
revocation was the EITSETA act [40], clause 19 (4) 2): “a
possibility of using the private key corresponding to a public
key contained in the certiﬁcate without the consent of the
certiﬁcate holder” [41].
We note that even if the authorities had not considered this
to be a security issue, there was a non-compliance issue, and
hence the certiﬁcates could also have been revoked based on
the EITSETA act clause 19 (4) 12): “appearance of an error in
the certiﬁcate or in the data entered in the certiﬁcate”, as the
certiﬁcates had not been issued in accordance with the CA’s
certiﬁcate policy referenced in the certiﬁcate.
5.5 Claim against the manufacturer
According to PPA, in the internal audit it was found that
the state had not asked and was not aware that Gemalto was
generating keys outside the card [41]. After receiving our
initial analysis, PPA submitted a claim to Gemalto. A response
from Gemalto denying violation, however, was only received
the night before the announcement for the ID card recall [42].
On 2018-05-18, the day after PPA’s announcement,
Gemalto announced that PPA’s statements were a surprise,
and that it had fulﬁlled the ID card contract and the obligations
agreed therein [42]. The state was then put in an unfortunate
situation. It was evident that the ID card manufacturer could
not be trusted, but contractually they had to produce ID cards
until the end of 2018, when the new manufacturer IDEMIA
would take over.
On 2018-09-26, after failing to reach an agreement, PPA
brought Gemalto to court demanding a contractual penalty in
the amount of 152 million EUR for generating keys outside
the chip [2]. This claim, however, has to be viewed in context
with other ongoing litigations with Gemalto – the PPA’s claim
of 300 000 EUR from Gemalto for their failure to inform the
state about the ROCA ﬂaw [43] and Gemalto’s appeal about
the results of ID card procurement [44]. The court decisions
on these cases are yet to be seen.
6 Certiﬁcates with corrupted RSA public keys
In 2012, Heninger et al. [45] published an efﬁcient method
for testing RSA public keys for shared prime factors. This
method was used to ﬁnd that 103 RSA keys from Taiwan’s
Citizen Digital Certiﬁcates share prime factors [46]. We used
the same method to test the RSA public keys from Estonian
ID card certiﬁcates for shared prime factors and found several
small common factors (e.g., 3, 5, 7) in the output of pairwise
GCD computation. By using trial division with small primes
we found 14 certiﬁcates whose public key moduli could be
divided by one or several small factors. Since the public key
modulus of 2048-bit RSA is generated by multiplying two
distinct random 1024-bit primes, the public key moduli in-
cluded in the certiﬁcates evidently had been corrupted. This
corruption seemed to only affect the jTOP SLE78 platform, as
all the certiﬁcates with the corrupted moduli had been issued
for ID cards powered by the jTOP SLE78 platform.
We used the software utility YAFU [47] with the GMP-
ECM implementation of the elliptic curve method (ECM) to
test all RSA keys in our dataset for small factors. The keys
were tested up to t-level3 t20. This, however, did not ﬁnd
any additional corrupted keys. Two of the corrupted keys had
an obvious anomaly – the length of the modulus was 2040
bits. We found one more anomalous 2040-bit modulus in our
dataset and by applying more ECM testing to it (about t40) we
were able to ﬁnd a 132-bit prime factor. Later, when Nemec
et al. [18] published a method to detect moduli generated by
the vulnerable Inﬁneon’s key generation algorithm, we were
able to identify 8 more presumably corrupted moduli. These
were discovered when we observed that these certiﬁcates,
which according to the certiﬁcate revocation date, had been
revoked due to the ROCA ﬂaw and hence had been issued for
jTOP SLE78-powered ID cards, did not have the structure of
ROCA keys. The full set of 23 identiﬁed certiﬁcates is listed
in Table 2.
6.1 Full factorization
The issuance of ID card certiﬁcates with corrupted public
key moduli means that the cardholders of these ID cards will
not be able to use the cryptographic functionality, since the
private key that resides in their ID card does not correspond
to the public key in the certiﬁcate. The corruption of the pub-
lic key, however, also has critical security consequences. By
recovering all the prime factors from the corrupted modulus,
it is possible to calculate the corresponding private exponent
and perform private key operations with the key. If the mod-
ulus has 2048 bits, we can expect to factorize the corrupted
modulus efﬁciently with a probability of 12 – 22% for an
arbitrary corruption [48].
3T-level is the terminology used to express how much ECM testing the
number has received. For instance, the work of t20 implies that the probability
of a 20-digit factor being missed by ECM is about exp(−1) = 37%.
1796    29th USENIX Security Symposium
USENIX Association
No Date of cert issuance Cardholder (cert type)
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
Svetlana B. (sign)
Imre (auth)
Imre (sign)
2014-12-30 08:41:14 Toomas (auth)
2014-12-30 09:57:22 Raja (auth)
2014-12-30 16:03:43 Valentina (auth)
2014-12-30 16:05:23 Valentina (sign)
2015-01-05 11:25:19 Raisa (auth)
2015-01-27 13:48:40 Lennart (auth)
2015-02-19 09:19:21
2015-03-13 12:27:40
2015-03-13 12:27:45
2015-03-27 09:21:51 Vyacheslav (sign)
2015-06-01 12:07:45
Svetlana S. (auth)
2015-07-21 12:52:10 Rasmus (auth)
2015-08-06 14:18:44 Armand (sign)
2015-09-11 12:30:06
2015-11-04 11:27:25 Vambola (auth)
2015-12-02 10:10:37 Erki (sign)
2016-01-18 09:07:15
Pentti (auth)
2016-05-10 10:13:54 Laura (auth)
2016-06-20 10:29:55
2017-06-16 14:13:04 Vladislav (auth)
2017-06-16 14:13:26 Vladislav (sign)
2017-06-16 16:28:30
2017-06-16 16:28:55
Paul (sign)
Ilja (auth)
Pirgit (auth)
Pirgit (sign)
N
2048
2040
2048
2048
2040
2048
2048
2048
2048
2048
2040
2048
2048
2048
2048
2048
2048
2048
2048
2048
2048
2048
2048
–
Work N-res
2048
t45.76
1713
t54.58
2048
t45.76
2048
t47.06
t54.52
1958
t54.70
1937
t47.47
t54.55
t54.86
t54.75
t54.54
t56.46
t54.42
t54.29
t55.00
t54.34
t46.44
t56.49
t54.58
t45.76
t45.99
t45.86
t45.73
1895
1757
1808
1924
1844
1884
1973
1604
2011
2048
2002
1819
2048
2048
2048
2048
Factors (min / max) Date of revocation
0
3 (132-bit / 196-bit)
0
0
4 (3-bit / 38-bit)
4 (2-bit / 56-bit)
7 (9-bit / 1762-bit)
6 (2-bit / 81-bit)
7 (2-bit / 133-bit)
9 (7-bit / 110-bit)
2 (25-bit / 92-bit)
4 (3-bit / 161-bit)
7 (11-bit / 50-bit)
4 (2-bit / 69-bit)
6 (2-bit / 172-bit)
2 (2-bit / 35-bit)
0
5 (3-bit / 17-bit)
9 (2-bit / 124-bit)
0
0
0
0
Corruption of N
?
2017-11-03 23:59:59
117th byte missing
2015-08-26 16:37:53
?
2017-11-03 23:59:59
?
2017-11-03 23:59:59
27th byte missing
2017-06-09 14:07:57
64th byte changed
2016-07-01 09:36:57