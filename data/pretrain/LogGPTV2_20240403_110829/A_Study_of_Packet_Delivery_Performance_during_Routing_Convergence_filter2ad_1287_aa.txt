# A Study of Packet Delivery Performance during Routing Convergence

## Authors
- Dan Pei, Lan Wang (UCLA CSD)
- Daniel Massey (USC/ISI)
- S. Felix Wu (UC Davis CSD)
- Lixia Zhang (UCLA CSD)

### Abstract
Internet measurements have shown that network failures occur frequently, and existing routing protocols can take multiple seconds or even minutes to converge after a failure. During these convergence periods, in-flight packets may encounter routing loops, delays, and losses. However, there is limited understanding of the packet delivery performance during these periods.

In this paper, we study the impact of topological connectivity and routing protocol design on packet delivery during routing convergence. We examine three distributed routing protocols: RIP, Distributed Bellman-Ford (DBF), and BGP, through protocol analysis and simulation experiments. Our study reveals that packet delivery ratios improve with richer network connectivity. However, differences in routing protocol designs affect their ability to fully utilize topological redundancy. Two key factors in routing protocol design—maintaining alternate path information at each router and quickly propagating new reachability information—significantly influence packet delivery behavior during convergence.

## 1. Introduction
Advancements in Internet technology have greatly benefited society and increased productivity, but they have also made us critically dependent on the reliability of Internet services. At a fundamental level, all applications rely on the Internet's routing infrastructure for packet delivery. In today's Internet, routers forward data packets hop-by-hop towards their destinations based on forwarding tables built by dynamic routing protocols such as BGP, OSPF, and RIP. Paul Baran suggested that adequate redundancy in network connectivity, combined with dynamic routing protocols, should enable reliable data delivery even in the face of severe component failures.

In practice, the Internet is a large-scale, complex, loosely-coupled distributed system composed of many imperfect components. Measurement results show that faults of various scales and severities occur frequently. Although routing protocols can adapt to these failures, it takes time to detect a failure and propagate the necessary update messages. Studies have shown that existing routing protocols may take multiple seconds or even minutes to converge after a failure. During this convergence period, in-flight packets may encounter looping, delays, or losses. However, there has been no systematic study of packet delivery performance during these periods.

Two recent technological advancements further highlight the need to understand packet delivery during routing convergence. First, a rapid decrease in bandwidth costs has resulted in richer Internet connectivity, increasing the potential to deliver packets over alternate paths after a failure. Second, rapid increases in link bandwidth have led to more in-flight packets at any given time, including during routing convergence. This paper presents a systematic study of packet delivery performance during routing convergence periods.

We define a routing convergence period as the time between fault detection and the restoration of new path information at all routers. We use simulations to examine the performance of three routing protocols: RIP, DBF, and BGP. Our primary focus is on the packet delivery rate during convergence, as other factors like delay or jitter are only meaningful when packets are delivered.

Our study shows that the network must have adequate physical redundancy to ensure reliable packet delivery in the face of component failures. The packet delivery ratio improves with richer network connectivity, but different protocol designs can lead to significant differences in exploiting this connectivity. For example, with the same topology and packet generation rate, RIP dropped 250 packets while a specially parameterized version of BGP (BGP') dropped fewer than 5 packets. We identified two key factors in routing protocol design that significantly impact packet delivery performance during convergence: maintaining alternate path information at each router and quickly propagating new reachability information.

The remainder of the paper is organized as follows. Section 2 reviews related work. Section 3 provides a brief introduction to the three routing protocols studied. Section 4 identifies and analyzes the factors that impact packet delivery during routing convergence. Section 5 presents the simulation results. Section 6 concludes the paper and discusses future work.

## 2. Related Work
It is generally believed that a shorter routing convergence time reduces packet losses. Previous efforts in routing protocol design have focused on speeding up convergence and preventing routing loops. These approaches often achieve loop-free routing by delaying the propagation of routing updates. For example, the ExDBF algorithm avoids long-lived routing loops by computing the complete path to a destination using predecessor information. The DUAL algorithm prevents routing loops by running a "diffusion" process before switching to a longer path. Our study differs from previous work by focusing on packet delivery performance during routing convergence. Our results show that the shortest convergence time does not necessarily lead to the highest packet delivery rate. An ideal routing protocol should balance convergence overhead and time while maximizing the packet delivery rate during convergence.

Previous studies have simulated the convergence behaviors of several routing protocols, measuring convergence time, the number of routing messages, and routing loops after node or link failures, but not packet delivery during convergence. Other studies have used off-line analysis of traces to detect loops, observing that forwarding loops are rare and that the delay of packets escaping a loop is increased by 25 to 1300 milliseconds. Our study examines how link failures affect routing and packet forwarding by analyzing forwarding and routing trace files, identifying the causes of routing loops in each circumstance.

## 3. A Brief Introduction to RIP, DBF, and BGP
In this paper, we consider three distributed routing protocols: RIP, DBF, and BGP. All three are variants of classic distance vector routing protocols. We selected these protocols from the same algorithm family to better correlate differences in design with observed packet delivery dynamics.

**RIP (Routing Information Protocol)**: Each router periodically advertises its shortest distance to each destination. Based on the distances learned from neighbors, a router selects the next hop that leads to the shortest path to a given destination and discards reachability information from other neighbors. Routing updates are sent every 30 seconds, and a routing entry is removed if it does not receive an update within 180 seconds. Triggered updates are sent immediately upon detecting a route change. A damping timer, randomly chosen between 1 and 5 seconds, spaces out consecutive update messages.

In our simulation, RIP is enhanced with the "split horizon with poison reverse" loop prevention scheme: if a node A uses B as the next hop to reach destination D, A sends B an "infinity" distance (16) to D.

**Distributed Bellman-Ford (DBF)**: The main difference between DBF and RIP is that a DBF router keeps a cache of the latest routing update learned from each neighbor. If a router cannot reach a destination through the current next hop, it can immediately select an alternate next hop. DBF also adopts the "split horizon with poison reverse" loop prevention mechanism and sends triggered updates upon routing changes.

**BGP (Border Gateway Protocol)**: BGP is a path vector protocol where each node announces the best path (a sequence of nodes) to each destination. A router keeps a copy of the latest best path received from each neighbor. BGP uses TCP for reliable delivery between neighbors, and routes to all destinations are advertised once only. A router sends an update only upon route changes and an explicit withdrawal message when it cannot reach a previously reachable destination. BGP uses a Minimum Route Advertisement Interval (MRAI) timer to space out consecutive updates, with a recommended average MRAI value of 30 seconds and a jitter interval of 5 seconds. In our simulation, we implemented both the recommended MRAI value and a modified average MRAI value of 3 seconds with a jitter interval of 2 seconds, naming this version BGP'. The MRAI timer is set on a per-neighbor basis rather than per (neighbor, destination).

BGP path information is used to prevent routing loops. If a node A receives a path from neighbor B that contains A as one of the nodes, A discards this path, similar to the "split horizon with poison reverse" loop prevention scheme in RIP and DBF.

## 4. Routing Protocols During Convergence
In large-scale networks, there will be periods when the route to a particular destination has not converged, yet hop-by-hop routing protocols continue to forward packets. IP packets carry a Time To Live (TTL) field specifying the maximum number of hops. As long as a packet's TTL value is greater than zero and the router knows some next hop to reach the destination, the packet is forwarded, and the TTL value is decremented by 1. Although the sequence of next hops traversed by a packet during a routing convergence period (called "transient forwarding path") may be sub-optimal or contain transient loops, the packet may still reach its destination.

Figure 1 illustrates an example of packet delivery during routing convergence. Initially, R1 sends packets to R4 along the shortest path. When the link (R5 R4) fails, R1 continues to forward packets to R5, which transmits them over the failed link. R5 then detects the link failure and switches to forwarding packets to R6. Unaware of the connectivity changes, R1 continues to forward packets to R5, causing them to follow a non-shortest path. Finally, R1 converges to the new shortest path and forwards packets to R2. In this example, packets are only dropped between the link failure and the time R5 switches to forwarding packets to R6. During the subsequent convergence period, packets successfully reach the destination via a non-shortest path. This example shows that a longer routing convergence period does not necessarily imply higher packet losses.

Understanding the relationship between routing convergence and packet delivery raises new challenges for routing protocol design. In the remainder of this section, we identify factors that significantly impact packet delivery during convergence.