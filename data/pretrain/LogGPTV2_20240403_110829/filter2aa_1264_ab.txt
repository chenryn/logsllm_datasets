Internet domain, your SMTP service delivers the outgoing messages to the other 
domain’s mail service.
Simple Mail Transfer Protocol (SMTP)
SMTP is a protocol used to send and transfer mail. SMTP queues outgoing mail 
messages from the user These messages are transferred along the Internet to their 
destinations, to be picked up by the incoming mail protocols.
Mac OS X Server uses Postfix (www.postfix.org) as its mail transfer agent (MTA). Postfix 
fully supports the Internet standard SMTP protocol. Your email users will set their email 
applications’s outgoing mail server to your Mac OS X Server running Postfix, and access 
their own incoming mail from a Mac OS X Server running incoming mail service.
If you choose to use another MTA (such as Sendmail), you won’t be able to configure 
your mail service with Mac OS X Server administration tools. 
If you want to use the Sendmail program instead of Postfix, you must disable current 
SMTP service through Postfix, and then install and configure Sendmail. For more 
information about Sendmail, see the web site www.sendmail.org.
Incoming Mail
Mail is transferred from incoming mail storage to the email recipient’s inbox by a local 
delivery agent (LDA). The LDA is responsible for handling local delivery, making mail 
accessible by the user’s email application. There are two different protocols available 
from Mac OS X Server’s mail access agent:  POP and IMAP.
Mac OS X Server uses Cyrus (asg.web.cmu.edu/cyrus) to provide POP and IMAP service.
Post Office Protocol (POP)
POP is used only for receiving mail, not for sending mail. The mail service of Mac OS X 
Server stores incoming POP mail until users have their computers connect to the mail 
service and download their waiting mail. After a user’s computer downloads POP mail, 
the mail is stored only on the user’s computer. The user’s computer disconnects from 
the mail service, and the user can read, organize, and reply to the received POP mail. 
The POP service is like a post office, storing mail and delivering it to a specific address.
LL2349.Book  Page 10  Friday, August 22, 2003  2:47 PM
Chapter 1    Mail Service Setup
11
An advantage of using POP is that your server doesn’t need to store mail that users 
have downloaded. Therefore, your server doesn’t need as much storage space as it 
would using the IMAP protocol. However, because the mail is removed from the server, 
if any client computers sustain hard disk damage and lose their mail files, there is no 
way to recover these files without using data backups.
Another advantage of POP is that POP connections are transitory. Once the mail is 
transferred, the connection is dropped and the load on both the network and the mail 
server is removed.
POP is not the best choice for users who access mail from more than one computer, 
such as a home computer, an office computer, and a laptop while on the road. When a 
user fetches mail via POP, the mail is downloaded to the user’s computer and is usually 
completely removed from the server. If the user logs in later from a different computer, 
he or she won’t be able to see previously downloaded mail.
Internet Message Access Protocol (IMAP)
IMAP is the solution for people who need to use more than one computer to receive 
mail. IMAP is a client-server mail protocol that allows users to access their mail from 
anywhere on the Internet. Users can send and read mail with a number of IMAP-
compliant email clients.
With IMAP, a user’s mail is delivered to the server and stored in a remote mailbox on 
the server; to users, mail appears as if it were on the local computer. A key difference 
between IMAP and POP is that with IMAP the mail is not removed from the server until 
the user deletes it.
The IMAP user’s computer can ask the server for message headers, ask for the bodies of 
specified messages, or search for messages that meet certain criteria. These messages 
are downloaded as the user opens them. IMAP connections are persistent and remain 
open, maintaining load on the server and possibly the network as well.
User Interaction With Mail Service
Mail is delivered to its final recipient using a mail user agent (MUA). MUAs are usually 
referred to as “email clients” or “email applications.” These email clients often run on 
each user’s local computer. Each user’s email application must be configured to send 
messages to the correct outgoing server and receive messages from the incoming 
server. These configurations can affect your server’s processing load and available 
storage space.
LL2349.Book  Page 11  Friday, August 22, 2003  2:47 PM
12
Chapter 1    Mail Service Setup
Where Mail Is Stored
Mail is stored in either an outgoing queue awaiting transfer to a remote server or in a 
local mail store accessible by local mail users.
Outgoing Mail Location
Outgoing mail messages are stored, by default, in the following spool directory on the 
startup disk:
/var/spool/postfix
This location is temporary, and the mail is stored until it’s successfully transferred out to 
the Internet. These locations can be moved to any accessible volume (either local or 
NFS mounted) and symlinked to by the mail administrator. 
Incoming Mail Location
The mail service keeps track of incoming email messages with a small database 
(BerekeleyDB.4.1), but the database doesn’t contain the messages themselves. The mail 
service stores each message as a separate file in a mail folder for each user. Incoming 
mail is stored on the startup disk in the following directory:
/var/spool/imap/[user name]
Cyrus puts a database index file in the folder of user messages. You can change the 
location of any or all of the mail folders and database indexes to another folder, disk, or 
disk partition. You can even specify a shared volume on another server as the location 
of the mail folder and database, although using a shared volume incurs performance 
penalties. The incoming mail remains on the server until deleted by an MUA.
Maximum Number of Mail Messages per Volume
Because the mail service stores each email message in a separate file, the number of 
messages that can be stored on a volume is determined by the total number of files 
that can be stored on the volume.
The total number of files that can be stored on a volume that uses Mac OS Extended 
format (sometimes referred to as HFS Plus format) depends on the following factors:
• The size of the volume
• The sizes of the files
• The minimum size of a file, which by default is one 4K block
For example, a 4 GB HFS Plus volume with the default block size of 4KB has one million 
available blocks. This volume could hold up to a million 4KB files, which means a 
million email messages that were 4KB or less apiece. If some email messages were 
larger than 4KB, this volume could hold fewer of them. A larger volume with the same 
default block size could hold proportionately more files.
LL2349.Book  Page 12  Friday, August 22, 2003  2:47 PM
Chapter 1    Mail Service Setup
13
What Mail Service Doesn’t Do
Mac OS X Server’s mail service does not provide the following mail add-ons:
• Virus filtering
• Unsolicited commercial email (spam) identification
• Email content filtering
Each one of these add-on services can be configured to work with Mac OS X Server’s 
mail service and can be obtained from various developers.
Using Network Services With Mail Service
Mail service makes use of network services to ensure delivery of email. Before sending 
an email, your mail service will probably have a Domain Name System (DNS) service 
determine the Internet Protocol (IP) address of the destination. The DNS service is 
necessary because people typically address their outgoing mail by using a domain 
name, such as example.com, rather than an IP address, such as 198.162.12.12. To send an 
outgoing message, your mail service must know the IP address of the destination. The 
mail service relies on a DNS service to look up domain names and determine the 
corresponding IP addresses. The DNS service may be provided by your Internet Service 
Provider (ISP) or by Mac OS X Server, as explained in the network services 
administration guide.
Additionally, an mail exchanger (MX) record can provide redundancy by listing an 
alternate mail host for a domain. If the primary mail host is not available, the mail can 
be sent to the alternate mail host. In fact, an MX record can list several mail hosts, each 
with a priority number. If the lowest priority host is busy, mail can be sent to the host 
with the next lowest priority, and so on.
Mail services use DNS like this:
1 The sending server looks at the email recipient’s domain name (it’s what comes after 
after the @ in the To address).
2 The sending server looks up the MX record for that domain name to find the receiving 
server.
3 If found, the message is sent to the receiving server.
4 If the lookup fails to find an MX record for the domain name, the sending server often 
assumes that the receiving server has the exact same name as the domain name. In 
this case, the sending server does an Address (A) lookup on that domain name, and 
attempts to send the file there.
Without a properly configured MX record in the DNS, mail may not reach your 
intended server.
LL2349.Book  Page 13  Friday, August 22, 2003  2:47 PM
14
Chapter 1    Mail Service Setup
Configuring DNS for Mail Service
Configuring DNS for mail service is enabling MX records with your own DNS server. If 
you have an ISP that provides you with DNS service, you will need to contact the ISP so 
that they can enable your MX records. Only follow these steps if you provide your own 
DNS Service using Mac OS X Server.
To enable MX records:
1 In Server Admin, select DNS in the Computers & Services pane.
2 Click Settings.
3 Select the Zones tab.
4 Select the Zone you want to use.
5 Click the Add button under the Records pane.
6 Choose MX from the Type pop-up menu.
7 Enter the domain name (like ‘example.com’) in the From field.
8 Enter the name of the mail server (like ‘mail.example.com’) in the To field.
9 If you will have more than one mail server, enter a precedence number for that server.
A lower number indicates that mil server will be chosen first, if available, to receive 
mail.
10 Click OK.
If you need to set up multiple servers for redundancy, you will need to add additional 
MX records. See the network services administration guide for more information.
How Mail Service Uses SSL
Secure Sockets Layer (SSL) connections ensure that the data sent between your mail 
server and your users’ mail clients is encrypted. This allows secure and confidential 
transport of mail messages across a local network. SSL transport does not provide 
secure authentication, just secure transfer from your mail server to your clients. See the 
Open Directory administration guide for secure authentication information.
For incoming mail, the mail service supports secure mail connections with mail client 
software that requests them. If a mail client requests an SSL connection, the mail 
service can automatically comply, if that option has been enabled. The mail service still 
provides non-SSL (unencrypted) connections to clients that don’t request SSL. The 
configuration of each mail client determines whether it connects with SSL or not.
For outgoing mail, the mail service supports secure mail connections between SMTP 
servers. If an SMTP server requests an SSL connection, the mail service can 
automatically comply, if that option has been enabled. The mail service still can allow 
non-SSL (unencrypted) connections to mail servers that don’t request SSL.
LL2349.Book  Page 14  Friday, August 22, 2003  2:47 PM
Chapter 1    Mail Service Setup
15
Enabling Secure Mail Transport With SSL
The mail service requires some configuration to provide SSL connections automatically. 
The basic steps are as follows:
• Generate a Certificate Signing Request (CSR) and create a keychain.
• Use the CSR to obtain an SSL certificate from an issuing authority.
For more information on enabling SSL from the web technologies administration guide 
and the Open Directory administration guide.
If you already have generated a certificate in a previous version of Mac OS X Server, it 
won’t be compatible with the current mail service.
For detailed instructions for allowing or requiring SSL transport, see the following 
sections:
• “Configuring SSL Transport for POP Connections” on page 20
• “Configuring SSL Transport for IMAP Connections” on page 21
• “Configuring SSL Transport for SMTP Connections” on page 23
Before You Begin
Before setting up mail service for the first time:
• Decide whether to use POP, IMAP, or both for incoming mail.
• If your server will provide mail service over the Internet, you need a registered 
domain name. You also need to determine whether your ISP will create your MX 
records or you will create them in your own DNS service.
• Identify the people who will use your mail service but don’t already have user 
accounts in a directory domain accessible to your mail service. You must create user 
accounts for these mail users.
• Determine mail storage requirements, and ensure you have enough disk space for 
your anticipated mail volume.
• Determine your authentication and transport security needs.
How User Account Settings Affect Mail Service
In addition to setting up mail service as described in this chapter, you can also 
configure some mail settings individually for everyone who has a user account on your 
server. Each user account has settings that do the following:
• Enable or disable mail service for the user account, or forward incoming mail for the 
account to another email address.
• Specify the server that provides mail service for the user account.
• Set a quota on the amount of disk space for storing the user account’s mail on the 
server.
• Specify the protocol for the user account’s incoming mail:  POP, IMAP, or both.
LL2349.Book  Page 15  Friday, August 22, 2003  2:47 PM
16
Chapter 1    Mail Service Setup
Moving Mail Messages From Apple Mail Server to Mac OS X  
Server Version 10.3
If you have upgraded your server from a version previous to Mac OS X Server v.10.3, and 
you have an existing Apple Mail Server database, you must migrate your mail database 
to Mac OS X Server v.10.3 mail service. 
For more detailed instructions and tool descriptions, see “Converting the Mail Store 
and Database From an Earlier Version” on page 36, and “Using Amsmailtool” on 
page 36
Overview of Mail Service Tools
The following applications help you set up and manage mail service:
• Server Admin:  Use to start, stop, configure, and monitor mail service when you 
install Mac OS X Server.
• Workgroup Manager:  Use to create user accounts for email users and configure each 
user’s mail options.
• Terminal:  Use for tasks that involve UNIX command-line tools, such as migrating and 
restoring the mail database.
Setup Overview
You can have mail service set up and started automatically as part of the Mac OS X 
Server installation process. An option for setting up mail service appears in the Setup 
Assistant application, which runs automatically at the conclusion of the installation 
process. If you select this option, mail service is set up as follows:
• SMTP, POP, and IMAP are all active and using standard ports.
• Standard authentication methods are used (not Kerberos), with POP and IMAP set for 
clear-text passwords (APOP and CRAM MD-5 turned off) and SMTP authentication 
turned off.
• Mail is only delivered locally (no mail sent to the Internet).
• Mail relay is restricted.
LL2349.Book  Page 16  Friday, August 22, 2003  2:47 PM
Chapter 1    Mail Service Setup
17
If you want to change this basic configuration, or if you have not set up your mail 
service, these are the major tasks you perform to set up mail service:
Step 1:  Before you begin, make a plan
See “Before You Begin” on page 15 for a list of items to think about before you start full-
scale mail service.
Step 2:  Set up MX records
If you want users to be able to send and receive mail over the Internet, you should 
make sure DNS service is set up with the appropriate MX records for your mail service. 
• If you have an ISP that provides DNS service to your network, contact the ISP and 
have the ISP set up MX records for you. Your ISP will need to know your mail server’s 
DNS name (such as mail.example.com) and your server’s IP address. 
• If you use Mac OS X Server to provide DNS service, create your own MX records as 
described in “Configuring DNS for Mail Service” on page 14.
• If you do not set up an MX record for your mail server, your server may still be able to 
exchange mail with some other mail servers. Some mail servers will find your mail 
server by looking in DNS for your server’s A record. (You probably have an A record if 
you have a web server set up.)
Note:  Your mail users can send mail to each other even if you do not set up MX 
records. Local mail service doesn’t require MX records.
Step 3:  Configure incoming mail service
Your mail service has many settings that determine how it handles incoming mail. for 
instructions, see “Configuring Incoming Mail Service” on page 19.
Step 4:  Configure outgoing mail service
Your mail service also has many settings that determine how it handles outgoing mail. 
For instructions, see “Configuring Outgoing Mail Service” on page 22.
Step 5:  Secure your server
If your server exchanges mail with the rest of the Internet, make sure you’re not 
operating an open relay. An open relay is a security risk and enables junk-mail senders 
(spammers) to use your computer resources for sending unsolicited commercial email. 
For instructions see “Limiting Junk Mail” on page 29, and “Restricting SMTP Relay” on 
page 30.
Step 6:  Configure additional settings for mail service
Additional settings that you can change affect how mail service stores mail, interacts 
with DNS service, limits junk-mail (spam), and handles undeliverable mail. See the 
following sections for detailed instructions:
• “Working With the Mail Store and Database” on page 35
• “Limiting Junk Mail” on page 29
• “Working With Undeliverable Mail” on page 42
LL2349.Book  Page 17  Friday, August 22, 2003  2:47 PM
18
Chapter 1    Mail Service Setup
Step 7:  Set up accounts for mail users
Each person who wants mail service must have a user account in a directory domain 
accessible by your mail service. The short name of the user account is the mail account 
name and is used to form the user’s mail address. In addition, each user account has 
settings that determine how your mail service handles mail for the user account. You 
can configure a user’s mail settings when you create the user’s account, and you can 
change an existing user’s mail settings at any time. For instructions, see “Supporting 
Mail Users” on page 24, and “Configuring Email Client Software” on page 25
Step 8:  Create a postmaster account (optional, but advised)
You need to create a user account named “postmaster.” The mail service may send 
reports to the postmaster account. When you create the postmaster account, make 
sure mail service is enabled for it. For convenience, you can set up forwarding of the 
postmaster’s mail to another mail account that you check regularly. Other common 
postmaster accounts are named “abuse” (used to report abuses of your mail service) 
and “spam” (used to report unsolicited commercial email abuses by your users). The 
user management guide tells you how to create user accounts.
Step 9:  Start mail service
Before starting mail service, make sure the server computer shows the correct day, 
time, time zone, and daylight-saving settings in the Date & Time pane of System 
Preferences. Mail service uses this information to timestamp each message. An 
incorrect timestamp may cause other mail servers to handle a message incorrectly.
Also, make sure you’ve enabled one or more of the mail service protocols (SMTP, POP, 
or IMAP) in the Settings pane.
Once you’ve verified this information, you can start mail service. If you selected the 
Server Assistant option to have mail service started automatically, stop mail service 
now, and then start it again for your changes to take effect. For detailed instructions, 
see “Starting and Stopping Mail Service” on page 33.
Step 10:  Set up each user’s mail client software
After you set up mail service on your server, mail users must configure their mail client 
software for your mail service. For details about the facts that users need when 
configuring their mail client software, see “Supporting Mail Users” on page 24.
LL2349.Book  Page 18  Friday, August 22, 2003  2:47 PM
Chapter 1    Mail Service Setup
19
Configuring Incoming Mail Service
The mail service has settings for requiring various authentication methods for POP and 
IMAP connections, as well as data transport over SSL.
Enabling Secure POP Authentication
Your POP mail service can protect users’ passwords by allowing Authenticated POP 
(APOP), or Kerberos. When a user connects with APOP or Kerberos, the user’s mail client 
software encrypts the user’s password before sending it to your POP service. Before 
configuring your mail service to require secure authentication, make sure that your 
users’ email applications and user accounts support the method of authentication you 
choose. 
Before enabling Kerberos authentication for incoming mail service, you must integrate 
Mac OS X with a Kerberos server. If you’re using Mac OS X Server for Kerberos 
authentication, this is already done for you. For instructions, see the Open Directory 