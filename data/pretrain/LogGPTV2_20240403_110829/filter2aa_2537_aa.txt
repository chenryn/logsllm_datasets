Stealing The Internet
An Internet-Scale 
Man In The Middle Attack 
Defcon 16, Las Vegas, NV - August 10th, 
2008
Alex Pilosov – Pure Science
Chairman of IP Hijacking BOF
ex-moderator of NANOG mailing list
PI:EMAIL
Tony Kapela – Public Speaking Skills
CIO of IP Hijacking BOF
PI:EMAIL
Why Should You Care?
• Because your inbound traffic can be passively 
intercepted 
• Because your outbound traffic to specific 
destinations can also be intercepted
• Because your data can be stored, dropped, 
filtered, mutilated, spindled, or modified 
• Because this cannot be solved without provider 
cooperation
• Because it’s unlikely to be noticed, unless you’re 
looking for it
Agenda
• BGP & Internet 101
• Old Hijackings
• The main monkey business
– MITM method, explained
– Graphs, etc
– Live Demo
BGP 101
 How is the Internet ‘glued’ together? 
• No central “core”
• Individual networks (identified by ASN) interconnect and 
“announce” IP space to each other
• Announcement contains IP prefix, AS-PATH, 
communities, other attributes
• AS-PATH is a list of who has passed the announcement 
along; used to avoid loops (important for our method)
• Fundamental tenet in IP routing: More-specific prefixes 
will win – e.g. 10.0.0.0/24 wins over 10.0.0.0/8
..if we had to 
whiteboard it
graphic courtesy jungar.net
Network Relationship Norms
• Peer: No money changes hands, routes 
are not redistributed to transits and other 
peers – 1:1 relationship
• Customer: Pays transit provider to accept 
their announcement, sends routes to 
peers and transits
On Prefixes…
• Internet routing is inherently trust-based
– No “chain of trust” in IP assignments
• ICANN assigns space to Regional Internet 
Registries (RIRs - ARIN/RIPE/AFRINIC)
• RIRs assign to ISPs or LIRs (in RIPE 
region)
• No association between ASN and IP for 
most assignments (except RIPE)
State The problem
Various levels of sophistication in Route/Prefix Filtering
• Customer:
– Often unfiltered BGP: max-prefix and sometimes AS-
PATH
– Smaller carriers and smaller customers – static prefix-list, 
emails or phone calls to update
• Verification by “whois”
– Larger carriers: IRR-sourced inter-AS filters
• Peer:
– Typically none beyond max-prefix and scripts to complain 
when announcing something they shouldn’t (rare)
– Many don’t even filter their own internal network 
routes coming from external peers
The IRR (Internet Routing Registry)
A Modest Proposal
• Way for ISP’s to register their routes and routing policy
• Distributed servers that mirror each other
• Filtering based on IRR will prevent some ‘accidental’ 
hijackings
• Caveats
– Your routers might not scale as well when crunching 100k 
entry prefix-lists per-peer, for all peers
– Full of cruft - no janitors
– Insecure - anyone can register (nearly) any route
An IRR Update
…Which Should Have Been Questioned
From: PI:EMAIL
To: PI:EMAIL
ReplyTo: PI:EMAIL
Subject: Forwarded mail.... (fwd)
Sent: Aug 7, 2008 9:48 PM
Your transaction has been processed by the
IRRd routing registry system.
Diagnostic output:
--------------------------------------------------
----------
The submission contained the following mail 
headers:
- From: PI:EMAIL
- Subject: Forwarded mail.... (fwd)
- Date: Thu, 7 Aug 2008 21:48:53 -0400 (EDT)
- Msg-Id: 
ADD OK: [route] 24.120.56.0/24 AS26627
----------------------------------------
If you have any questions about ALTDB,
please send mail to db-admin@altdb.net. 
Traditional Hijacking Uses
• Non-Malicious use: was popular in 2001, 
faster than getting IPs legitimately from ARIN
• Fly-by spammers: Announce space, spam, 
withdraw, avoid abuse complaints
• Malicious DoS or outage - silence your 
competitors
• Target impersonation - could hijack 
128.121.146.0/24 (twitter) and put up 
something else
Criminality
• If nobody is using it, is it really illegal?
• IP prefix is just a number
• No prosecutions for non-malicious 
announcements that we are aware of
• Worst case scenario for non-malicious 
hijack: ARIN/RIPE pull PTR records and 
transits shut you off (eventually)
How-To Hijack
• Full hijacking, apparent authority to announce
– This was cool in 2001
– Find IP Network (using whois) with contact email 
address in @hotmail.com or at domain that has 
expired
– Register domain/email
– Change contact 
• Or just announce the network since nobody is 
filtering anyway
– Upstream providers too busy & big to care
– You’re paying them to accept routes, so they do
Historical Hijackings
• AS7007 – ’97, accidental bgp->rip->bgp redistribution 
broke Internet (tens of thousands of new 
announcements filled router memory, etc)
• 146.20/16 – Erie Forge and Steel (how apropos)
• 166.188/16 – Carabineros De Chile (Chile Police) – 
hijacked twice, by registered “Carabineros De Chile LLC, 
Nevada Corporation”
• More details available on completewhois.com
• Accidental hijackings happen frequently – low chance of 
getting caught
02/08 Youtube Hijack Saga
• YouTube announces 5 prefixes:
– A /19, /20, /22, and two /24s
– The /22 is 208.65.152.0/22
• Pakistan’s government decides to block YouTube
• Pakistan Telecom internally nails up a more specific route 
(208.65.153.0/24) out of YouTube’s /22  to null0 (the routers 
discard interface)
• Somehow redists from static  bgp, then to PCCW
• Upstream provider sends routes to everyone else… 
• Most of the net now goes to Pakistan for YouTube, gets 
nothing!
• YouTube responds by announcing both the /24 and two more 
specific /25s, with partial success
• PCCW turns off Pakistan Telecom peering two hours later
• 3 to 5 minutes afterward, global bgp table is clean again
Pakistan Govt. Notice
Of Interest…
IP Hijacking BoF
• Un-official event at NANOG conference
• We test security of Internet routing 
infrastructure
• Recent exercises:
– Hijacked 1.0.0.0/8: 90% success
– Hijacked 146.20.0.0/16: 95% success
– Attempted to announce networks longer than /
24: from /25 down to /32 with cooperation of 
large CDN’s. 40% successful overall
Routing Security Is Complicated
• No answer yet, due to lack of chain of trust from ICANN 
on down
• “Weakest link” problem: Until everyone filters everyone 
perfectly, this door is still open
• Best practice today is “Alerting” systems that look for 
rogue announcements (PHAS, RIPE MyASN, Renesys, 
etc)