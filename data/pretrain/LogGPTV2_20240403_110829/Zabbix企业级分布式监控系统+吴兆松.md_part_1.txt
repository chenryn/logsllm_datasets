# OCR Output
## Page 1
cadview
51CT0传媒
uiow.oomLcl
本书从入门到高级应用，从Zabbix基本应用到安装包定
制、协议、API，全面部析、应有尽有
包含大量监控案例，详解触发器、告警等Zabbix监控中令
人头疼的问题，学到的不止是技术，还有思路和方法
企业级开源监控系统必选
Zabbix
企业级分布式监控系统
0010111011010101010101010101010710
100110010101001010
吴兆松编著
11101010
100110010010101010101
100101010101010101015
子工业出版社
---
## Page 2
博文视点·T出版旗舰品牌
Broadview
技术凝聚实力·专业创新出版
【业内力荐】
运维离不开监控，就像鱼离不开水，一款功能强大的监控系统可以有力地保证业务性能的稳定。近
几年各种监控系统层出不穷，Zabbix作为监控系统的新兴贵族迅速崛起，不过有关它的中文资料
还比较少，itnihao作为Zabbix监控系统国内领先的使用者，厚积薄发撰写了此书，大家可以通过
这本书详细了解Zabbix的各方面。
窦喆（@南非蜘蛛）中国最大开源社区ChinaUnix创始人之一
对于略具规模的T系统而言，监控组件通常都是其运维管理工具箱中核心组件的排头兵。在开源
运动硕果累累的今天，监控工具领域也是百花齐放，然而，Zabbix作为后来者，却迅速成为一枝独
秀，甚至由于愈加完善的特性和丰富的功能以及越来越多企业或组织的青而冠盖群芳。相信不
少初次使用Zabbix的人都是从itnihao公开的且不断丰富和完善的Zabbix技术文档开始的，许多
网友也坦言是itnihao和他的文档伴随自己走过了Zabbix资料匮乏、使用经验缺少的“蛮荒”时代
由此，我们有理由相信，他这次把多年的研究成果及实践经验精心打造并集结成册的这本《
Zabbix企业级分布式监控系统》，一定会成为Zabbix学习者的案头必备宝典。
马永亮（@马哥教育）马哥Linux运维培训创始人
本书是作者在运维领域多年实践的精彩总结，没有花哨的语言，不是大而全的砖头书。从头至
尾，循序渐进，抽丝剥茧，会让你对Zabbix的基本操作及其原理有全面、系统的认识。作者大部
分篇幅都采用图例加脚本实例阐述，相信这也是他对Zabbix架构的深刻理解，只有掌握了扎实的
原理架构，才能让实战操作井井有条，避免出现一些人为的低级错误。本书一定能给Zabbix学习
者带来帮助。
黄小路（@ZERO_O）PPS高级运维工程师
作为开源监控系统的一员，Zabbix提供了AllinOne的解决方案，使用户能够快速构建出企业级的
监控平台，让运维环境变得可知可控。本书作为第一本中文Zabbix书籍，非常系统地讲解了Zabbix
的各方面，从功能到部署和使用，从原理到案例技巧，几乎所有关于Zabbix的问题都可以从中找到
答案或启发，值得一读！
姚炫伟（@绿小小肥）中国SaltStack用户组发起
本书理论与实践相结合，包含Zabbix的各项技术细节，由浅入深。无论是新手还是老用户，看
本书后，一定能给你带来技术和思路的拓展，正如作者所言，本书学的不止是技术，而是解决
题的思路。
邝玲高级系统运维工程
上架建议：计算机/监控运维
新浪微博
ISBI
-23877-2
博文视点Broadview
@博文视点Broadview
责任编辑：李利健
封面设计：李玲
定价：59.00元
---
## Page 3
Zabbix
企业级分布式监控系统
吴兆松编著
电子王业出版社
Publishing House of Electronics Industry
北京·BEIJING
---
## Page 4
内容简介
本书从运维（OPS）角度对Zabbix的各项功能进行了详细介绍，以自动化运维视角为出发
点，对Zabbix的安装配置、自动化功能、监控告警、性能调优、ZabbixAPI、Zabbix协议、RPM
安装包定制，结合saltstack实现自动化配置管理等内容进行了全方位的深入剖析。
全书分为初级内容、中级内容、高级内容和附录部分，分别由浅入深地讲解乙abbix监控系
统这个开源软件。从最简单的安装配置，到复杂的高级使用，详细讲解了数据库分表、高可用、
性能调优、架构设计，以及大量的监控案例，对即将构建Zabbix监控系统，或者已经在使用
Zabbix的用户具有非常高的参考价值。
本书适合想了解、学习和规划构建监控系统的人员阅读，可以作为学习Zabbix的工具书，
也适合有一定基础，想更深入学习Zabbix的读者，通过大量的案例，让读者真正理解Zabbix。
未经许可，不得以任何方式复制或抄袭本书之部分或全部内容。
版权所有，侵权必究。
图书在版编目（CIP）数据
Zabbix企业级分布式监控系统/吴兆松编著.一北京：电子工业出版社，2014.8
ISBN978-7-121-23877-2
I.①Z.II.①吴III.①计算机监控系统IV.①TP277
中国版本图书馆CIP数据核字（2014）第169485号
责任编辑：李利健
印刷：北京季蜂印刷有限公司
装订：北京季蜂印刷有限公司
出版发行：电子工业出版社
北京市海淀区万寿路173信箱邮编：100036
开本：720×10001/16
印张：22.25字数：440千字
版次：2014年8月第1版
印
次：2014年8月第1次印刷
定
价：59.00元
凡所购买电子工业出版社图书有缺损问题，请向购买书店调换。若书店售缺，请与本社发
行部联系，联系及邮购电话：（010）88254888。
质量投诉请发邮件至PI:EMAIL，盗版侵权举报请发邮件至PI:EMAIL。
服务热线：（010）88258888。
---
## Page 5
前言
为何要写这本书
“运筹惟之中，决胜千里之外。”在IT运维中，监控占据着重要的地位，按
比例来算，说30%一点儿也不为过。对IT运维工程师来说，构建一个真正可用的
监控告警系统是一项艰巨的任务。在监控系统的开源软件中，可供选择的工具众
多，然而真正符合自己需求，能够真正解决自己业务问题的监控系统软件却风毛
麟角。
笔者在运维从业生涯中用过的监控系统有Cacti、Nagios，以及笔者公司开发
的监控告警系统，直到接触了Zabbix，才发现这个灵活而强大的自动化监控工具
正是笔者以前所寻找的。乙abbix灵活的设计为用户提供了易用的二次开发接口，
让用户既可以使用Zabbix本身提供的功能，又可以自定义更多的监控项功能，从
硬件监控，到操作系统，再到服务进程，以及网络设备，其无所不能的监控功能
令人叹为观止，笔者不禁要为这么优秀的开源工具而震撼。
在Zabbix的使用过程中，也会遇到很多问题，包括：配置使用、架构设计、
性能调优、大规模部署和应用等。由于Zabbix是一个集众多功能于一体的工具，
自带的功能实在太多，一般用户往往仅用到其基本的功能，对更高级的功能并未
使用到。然而随着使用的加深，会遇到更多的问题，这其中最大的问题是告警和
数据存储。本书对这两部分内容都有深入的讲解。
笔者从2012年12月开始学习并使用Zabbix，在此过程中，通过对Zabbix官
网的学习，将Zabbix的部署和配置，以及其丰富的功能整理成文档，并对外公开，
已在网络上公开过两个版本《Zabbix使用手册V1.4》和《Zabbix使用手册V2.0》，
对不少学习Zabbix的朋友有所帮助。为了将Zabbix的功能更加详细地展示出来，
于是有了本书的出现。本书以简洁通俗的方式将Zabbix的各项功能展现给读者，
使读者即学即用，以此来节省读者宝贵的时间。
本书将不会开源电子书PDF版本，但笔者将来会对《Zabbix使用手册》做更
多的更新，本书的所有代码和软件是开源的。另外，笔者开源的Zabbix安装包定
制项目对重新打包Zabbix的RPM安装包有一定的参考价值，其地址为
https://github.com/itnihao/zabbix-rpm，希望对大家有所帮助。
---
## Page 6
Zabbix企业级分布式监控系统
如何阅读本书
本书从运维（OPS）角度对Zabbix的各项功能进行了详细介绍，以自动化运
维视角为出发点，对自动化功能、高可用、监控告警、性能调优、ZabbixAPI、
Zabbix协议、RPM安装包定制等进行了深入浅出的探讨。
第1部分为基础部分，包括第1~6章，介绍监控系统的原理，让初次接触监
控的读者了解监控的组成架构，从宏观上认识监控系统，接下来讲解了Zabbix的
架构、Zabbix的安装、监控配置、自定义监控项、告警配置、告警脚本等功能。
这部分内容适合初学者系统地学习Zabbix监控系统，对稍有经验的使用者来说，
重点掌握3.9节中Zabbix对数据存储的处理，以及第5章和第6章的内容。
第2部分为中级部分，包括第7~11章，对Zabbix的多种监控方式进行了详
述（如IPMI、SNMP、JMX等），对Zabbix的自动化功能进行了深入讲解，介绍
了分布式监控系统，并有大量自定义脚本的监控案例，对自动化发现LLD功能进
行了深入的讲解，适合对Zabbix有一定基础的读者深入学习。通过对这部分的学
习，读者将会深入理解Zabbix的自动化功能。
第3部分为高级部分，包括第12~16章，介绍Zabbix的性能调优，解决Zabbix
在使用过程中遇到性能瓶颈的问题，并让读者学会使用ZabbixAPI、Zabbix协议
来扩展Zabbix，从而为构建运维平台提供了更多的扩展性。同时，也讲解了如何
定制RPM包，以及如何使用SaltStack来自动化部署和配置，最后用一个实例来
讲解如何构建企业级分布式监控系统，适合对Zabbix非常熟悉的读者进行深入应
用。通过对这部分的学习，读者应该能够深入理解Zabbix。
第4部分为附录部分，介绍Zabbix的源码安装和Zabbix的升级，仅供读者
参考。在介绍Zabbix的安装时，作者极力推荐在RHEL这类系统中使用RPM包
的安装方式，但网络中大部分资料都采用源码安装，且在多种书籍中均有使用源
码安装的习惯，从而误导了读者，认为源码安装才是真正地懂Linux，以此造成
部分用户以使用源码安装为荣，让源码安装具有“优越感”。使用源码安装导致部
分初学者连最基本的安装和配置都会遇到很多麻烦，甚至安装一个软件都需要几
天才能完成。当然，这里并不排斥使用源码安装，笔者只是为了纠正一个观念，
请读者尽量使用自己打包的RPM这种适合大规模安装的方式去部署Zabbix程序。
本书将RPM定制的内容作为单独的一章进行介绍，让读者深入理解安装和定制
的过程。
读者对象
●中/高级Linux系统管理员
·系统运维工程师
·运维开发工程师
IV
---
## Page 7
前言
●系统集成商
●运维监控系统工程师
·监控系统软件开发（设计）人员
·IT管理人员
·架构设计人员
勘误和支持
因作者水平有限，书中的错误或不妥之处难免，恳请读者批评、指正。如果
读者有任何宝贵的意见或建议，可以发送邮件到PI:EMAIL，我们将尽快
给予反馈。
本书所有的代码和安装软件将放在GitHub中托管，地址为https://github
com/itnihao/zabbix-book/，读者可以自行下载并使用。另外，本书的勘误也会在该
链接中得到反馈。
声明
本书采用的Zabbix版本为2.0和2.2，因此对Zabbix1.8不再讨论，Zabbix2.4
将在未来两年内会发布，其功能与Zabbix2.2将有所不同（例如，Zabbix2.4中的
分布式模式会去掉node架构等）。本书采用的操作系统以RHEL（CentOS）、
Windows为主，对于其他系统，其配置方法类似，请读者举一反三。本书对部分
不重要的内容只是简略地介绍，希望能起到抛砖引玉的作用。
另外，本书在编写过程中，参考了以下网址中的内容，并对官方网站的部分
内容进行了翻译和整理，后面不再单独声明。
https://www.zabbix.com/documentation/2.2/manual
https://www.zabbix.org/wiki/
http://pengyao.org/zabbix-triggers-functions.html
鸣谢
本书在编写过程中得到了众多朋友的支持。在这里要感谢姚炫伟、陈益超、
窦喆、冯颖聪等对本书的技术问题进行审校；感谢电子工业出版社编辑任晓露和
李利健对本书的精心指导，更正了书稿中的很多错误，本书才得以与读者见面。
特别感谢以下朋友对作者的支持与鼓励：伊杨林、吴华、黄小路、芮峰云、罗坤、
温宏强、曾兵、范仁更、邝玲、张克元（网名Geek）、沈灿、薛群、李佃田、罗
苗、杨晨、焦婷婷、KissPuppet（网名）、司鼎任、汤永全、罗伟、水喜云、唐文
军、李彬（网名彬彬）、高鹏程、唐博、罗涛（网名MormingSong）等。注意，以
上排名不分先后（使用Linux命令sort-R随机生成排序）。感谢SJCloud公司的全
体成员，感谢公司领导金剑、陶永国、付自强在笔者工作期间给予的支持和帮助。
V
---
## Page 8
Zabbix企业级分布式监控系统
另外，也要感谢史应生、李庆雷、姚仁捷、邓磊、马哥（马永亮）、孙科伟、
虚拟的现实（网名）等分享的有关Zabbix的技术文档、视频录制和讲座等内容，
这些内容对促进Zabbix在国内的推广和发展有很大帮助。很多网友也写了大量有
关 Zabbix的博客文章，相关链接会放在本书的GitHub项目中。
本书的代码示例规范
（1）在Shell环境中使用，Shell命令用黑体加粗。
shell# vim /etc/php.ini
（2）在MySQL环境中使用，SQL命令用黑体加粗。
mysql> flush privileges;
（3）在本书中，Zabbix-Server表示zabbix-server服务或进程，其他Zabbix-
Agent、Zabbix-Get、Zabbix-Proxy 情况类似；代表 zabbix-server、zabbix-agent、
zabbix-get、zabbix-proxy、zabbix-sender等程序名称本身时，一律采用小写：程序
配置文件中的字段，如Hostname=Zabbix proxy、Hostname=Zabbix server，统一采
用原配置文件中的风格，后面不再声明。
（4）重要参数的解释，用灰色底纹表示。
·Proxy name, 即zabbix-Proxy的hostname。
·Proxymode，即zabbix-Proxy的工作模式，被动或主动，默认是主动模式。
作者（网名itnihao）
VI
---
## Page 9
目
录
第1部分基础部分
第1章监控系统简介…·
1.1为何需要监控系统
1.2监控系统的实现…
1.3监控系统的开源软件现状
1.3.1MRTG...
1.3.2Cacti....
1.3.3SmokePing'
1.3.4 Graphite...
1.3.5Nagios
1.3.6 Zenoss Core"
1.3.7 Ganglia .
8
1.3.8 OpenTSDB
1.3.9Zabbix.
·10
1.4监控系统的原理探究
·11
第2章Zabbix简介
·14
2.1Zabbix的客户.
·14
2.2使用Zabbix的准备….
.15
2.3Zabbix为何物..
.15
2.4选择Zabbix的理由·
16
2.5Zabbix的架构..
17
2.6Zabbix的运行流程·
18
2.7Zabbix的功能特性..
19
第3章
安装与部署
21
3.1
安装环境概述
21
---
## Page 10
Zabbix企业级分布式监控系统
3.1.1硬件条件
21
3.1.2软件条件.
3.1.3部署环境的考虑
25
3.2Zabbix-Server服务器端的安装
3.2.1
安装Zabbix-Server......
.26
3.2.2
安装MySQL数据库服务
27
3.2.3
配置zabbix_server.conf...
28
3.2.4
防火墙、Selinux和权限的设置
.30
3.2.5配置Web界面
3.2.6
故障处理
3.3Zabbix-Agent客户端的安装.
3.3.1
安装Zabbix-Agent“
.39
3.3.2
防火墙的设置
39
3.3.3配置zabbix_agentd.conf..
3.4S
SNMP监控方式的配置..
.40
3.5
在Windows中安装Zabbix-Agent“
.40
3.6
其他平台的安装…··
.43
3.7
Zabbix-Get的使用
.43
3.8Z
Zabbix相关术语（命令）
.44
3.9
Zabbix-Server对数据的存储
"45
3.9.1Zabbix对数据存储...
3.9.2MySQL表分区实例…
.51
3.10Zabbixinit脚本解释.
3.11
高可用和安全
3.12Zabbix数据库的备份
57
第4章
快速配置和使用
59
4.1
配置流程·
59
4.2
主机组的添加.…·
..61
4.3
模板的添加··
63
4.4
添加主机
4.5
Graphs的配置
68
4.6
Screen的配置
74
4.7
Slideshows的配置
78
4.8Z
Zatree的使用·
VIII
---
## Page 11
目
录
4.9Map的配置..
80
4.10Web监控..
...85
4.10.1Web监控的原理
85
4.10.2Web监控指标
·85
4.10.3Zabbix中Web监控的配置
4.10.4
认证的支持
89
4.10.5触发器的设置.
91
4.10.6排错..
..91
4.11IT服务
92
4.12报表·
95
4.13资产管理.
.97
第5章深入配置和使用·
5.1Items的添加.
99
5.1.1Items 的含义..
5.1.2如何添加 Items 
.99
5.2Itemskey的添加.…
105
5.3Items 的类型.
…109
5.3.1 Zabbix-Agent...
109
5.3.2 Simple check
5.3.3
日志监控方式·
115
5.3.4
监控项计算（Calculated）
"120
5.3.5
聚合检测（Aggregate）
124
5.3.6
内部检测（Intermal）
127
5.3.7SSH、Telnet和扩展检测
5.4
宏的配置
.·129
5.5
维护时间
·131
5.6
事件确认·
132
5.7
数据的导入/导出配置