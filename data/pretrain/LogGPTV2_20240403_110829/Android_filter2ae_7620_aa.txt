# Android勒索软件研究报告
|
##### 译文声明
本文是翻译文章，文章来源：​360移动安全团队
译文仅供参考，具体内容表达以及含义原文为准。
2016年4月8日
摘 要
²手机勒索软件是一种通过锁住用户移动设备,使用户无法正常使用设备,并以此胁迫用户支付解锁费用的恶意软件。其表现为手机触摸区域不响应触摸事件,频繁地强制置顶页面无法切换程序和设置手机PIN码。
²手机勒索软件的危害除了勒索用户钱财,还会破坏用户数据和手机系统。
²手机勒索软件最早从仿冒杀毒软件发展演变而来,2014年5月Android平台首个真正意义上的勒索样本被发现。
²截至2016年第一季度,勒索类恶意软件历史累计感染手机接近90万部,从新增感染手机数据看,2015年第三季度新增感染手机接近35万部。
²截至2016年第一季度,共捕获手机勒索类恶意样本7.6万余个。其中国外增长迅速,在2015年第三季度爆发式增长,季度捕获量接近2.5万个;国内则稳步上升。
²国外最常伪装成色情视频、Adobe Flash Player和系统软件更新;国内则最常伪装成神器、外挂及各种刷钻、刷赞、刷人气的软件。
²从手机勒索软件的技术原理看,锁屏主要利用构造特殊的悬浮窗、Activity劫持、屏蔽虚拟按键、设置手机PIN码和修改系统文件。解锁码生成方式主要是通过硬编码、序列号计算、序列号对应。解锁方法除了直接填写解锁码,还能够通过短信、联网和解锁工具远程控制解锁。
²制作方面,主要使用合法的开发工具AIDE,通过QQ交流群、教学资料、收徒传授的方式进行指导。
²传播方面,主要通过QQ群、受害者、贴吧、网盘等方式传播。
²制马人通过解锁费、进群费、收徒费等方式获取非法所得,日收益在100到300元不等,整个产业链收益可达千万元。
²从制马人人群特点看,年龄分布呈现年轻化,集中在90后和00后。一方面自己制作勒索软件;另一方面又通过收徒的方式像传销一样不断发展下线。
²从被敲诈者人人群特点看,主要是一些经常光顾贴吧,以及希望得到各种“利器”、“外挂”的游戏QQ群成员。
²从预防的角度,可以通过软件大小、名称、权限等方式进行甄别,同时需要提高个人安全意识,养成良好的使用手机习惯。
²在清除方法上,可以通过重启、360手机急救箱、安全模式、ADB命令、刷机等多种方案解决。
关键词:手机勒索软件、锁屏、产业链
目 录
第一章Android平台勒索软件介绍… 1
一、勒索软件定义…. 1
二、勒索软件表现形式…. 1
三、勒索软件的危害…. 4
四、勒索软件历史演变…. 5
第二章Android平台勒索软件现状… 6
一、勒索类恶意样本感染量…. 6
二、勒索类恶意样本数量…. 6
三、常见伪装对象…. 7
四、用户损失估算…. 7
第三章Android平台勒索软件技术原理… 8
一、锁屏技术原理…. 8
二、解锁码生成方式…. 10
三、常见解锁方法…. 12
第四章Android平台勒索软件黑色产业链… 14
一、制作…. 14
(一)制作工具…. 14
(二)交流群…. 14
(三)教学资料…. 16
(四)收徒传授…. 16
二、传播…. 17
(一)QQ群…. 18
(二)借助受害者…. 18
(三)贴吧…. 19
(四)网盘…. 20
三、收益…. 20
(一)收益来源…. 21
(二)日均收益…. 23
(三)产业链收益…. 24
四、制马人人群特点…. 25
(一)制马人年龄分布…. 25
(二)制马人人员架构…. 25
五、被敲诈人人群特点…. 26
第五章Android平台勒索软件的预防… 27
一、勒索软件识别方法…. 27
二、提高个人安全意识…. 27
第六章Android平台勒索软件清除方案… 28
一、手机重启…. 28
二、360手机急救箱…. 28
三、安全模式…. 28
四、ADB命令…. 28
五、刷机…. 29
附录一:参考资料… 30
第一章Android平台勒索软件介绍
一、勒索软件定义
手机勒索软件是一种通过锁住用户移动设备,使用户无法正常使用设备,并以此胁迫用户支付解锁费用的恶意软件[1]。
二、勒索软件表现形式
1)主要通过将手机触摸屏部分或虚拟按键的触摸反馈设置为无效,使触摸区域不响应触摸事件。
2)频繁地强制置顶页面,造成手机无法正常切换应用程序。
3)设置手机锁定PIN码,无法解锁进入手机系统。
三、勒索软件的危害
1)敲诈勒索用户钱财
2)加密手机文件,破坏用户数据
3)清除手机应用,破坏手机系统
四、勒索软件历史演变
2013年06月Android.Fakedefender[2],仿冒杀毒软件恐吓用户手机存在恶意软件要求付费并且顶置付费提示框导致无法清除。
2014年05月Android.Koler[3],Android平台首个真正意义上的勒索样本。
2014年06月Android.Simplocker[4],首个文件加密并且利用洋葱网络的勒索样本。
2014年06月Android.TkLocker[5],360发现首个国内恶作剧锁屏样本。
2014年07月Android.Cokri[6],破坏手机通讯录信息及来电功能的勒索样本。
2014年09月Android.Elite[7],清除手机数据并且群发短信的锁屏样本。
2015年05月Android.DevLocker[8],360发现国内出现首个设置PIN码的勒索样本。
2015年09月Android.Lockerpin[9],国外出现首个设置PIN码的勒索样本。
第二章Android平台勒索软件现状
一、勒索类恶意样本感染量
截至2016年第一季度,勒索类恶意软件历史累计感染手机接近90万部,通过对比2015到2016年季度感染变化趋势,可以看出2015年第三季度新增感染手机接近35万部。
二、勒索类恶意样本数量
截至2016年第一季度,共捕获勒索类恶意样本7.6万余个,通过对比2015到2016年季度变化情况,可以看出国外勒索类恶意软件增长迅速,并且在2015年第三季度爆发式增长,季度捕获量接近2.5万个;反观国内勒索类恶意软件增长趋势,虽然没有爆发式增长,但是却呈现出稳步上升的趋势。
三、常见伪装对象
对比国内外勒索类恶意软件最常伪装的软件名称可以看出,国外勒索类恶意软件最常伪装成色情视频、Adobe Flash
Player和系统软件更新这类软件。而国内勒索类恶意软件最常伪装成神器、外挂及各种刷钻、刷赞、刷人气的软件,这类软件往往利用了人与人之间互相攀比的虚荣心和侥幸心理。
四、用户损失估算
2015年全年国内超过11.5万部用户手机被感染,2016年第一季度国内接近3万部用户手机被感染。每个勒索软件的解锁费用通常为20、30、50元不等,按照每位用户向敲诈者支付30元解锁费用计算,2015年国内用户因此遭受的损失达到345万元,2016年第一季度国内用户因此遭受的损失接近90万。
第三章Android平台勒索软件技术原理
一、锁屏技术原理
1)利用WindowManager.LayoutParams的flags属性
通过addView方法实现一个悬浮窗,设置WindowManager.LayoutParams的flags属性,例如,“FLAG_FULLSCREEN”、“FLAG_LAYOUT_IN_SCREEN”配合“SYSTEM_ALERT_WINDOW”的权限,使这个悬浮窗全屏置顶且无法清除,造成手机屏幕锁屏无法正常使用。
2)利用Activity劫持
通过TimerTask定时监控顶层Activity,如果检测到不是自身程序,便会重新启动并且设置addFlags值为“FLAG_ACTIVITY_NEW_TASK”覆盖原来程序的Activity,从而利用Activity劫持手段,达到勒索软件页面置顶的效果,同时结束掉原来后台进程。目前Android5.0以上的版本已经采取了保护机制来阻止这种攻击方式,但是5.0以下的系统仍然占据绝大部分。
3)屏蔽虚拟按键
通过改写onKeyDown方法,屏蔽返回键、音量键、菜单键等虚拟按键,造成不响应按键动作的效果,来达到锁屏的目的。
4)利用设备管理器设置解锁PIN码
通过诱导用户激活设备管理器,勒索软件会在用户未知情的情况下强制给手机设置一个解锁PIN码,导致用户无法解锁手机。
5)利用Root权限篡改系统文件
如果手机之前设置了解锁PIN码,勒索软件通过诱导用户授予Root权限,篡改/data/system/password.key文件,在用户不知情的情况下设置新的解锁PIN码替换旧的解锁PIN码,达到锁屏目的。
二、解锁码生成方式
1)解锁码硬编码在代码里
有些勒索软件将解锁码硬编码在代码里,这类勒索软件解锁码唯一,且没有复杂的加密或计算逻辑,很容易找到解锁码,比较简单。
2)解锁码通过序列号计算
与硬编码的方式相比,大部分勒索软件在页面上都显示了序列号,它是恶意软件作者用来标识被锁住的移动设备编号。一部分勒索软件解锁码是通过序列号计算得出,例如下图中的fkey代表序列号,是一个随机生成的数;key代表解锁码,解锁码是序列号*3-98232计算得出。这仅是一个简单的计算例子,这种方式解锁码随序列号变化而变化,解锁码不唯一并且可以使用复杂的计算逻辑。
3)解锁码与序列号键值对关系
还有一部分勒索软件,解锁码与序列号都是随机生成,使用键值对的方式保留了序列号和解锁码的对应关系。这种方式序列号与解锁码没有计算关系,解锁码会经过各种加密变换,通过邮件等方式回传解锁码与序列号的对应关系。