queries such that:
length of
key
the
be
ğ‘˜
Adv
muAE
ChaCha20-Poly1305[ğœ‹](A) â‰¥ ğ‘ğ‘‘
2ğ‘˜+2 .
The previous attack can be adapted to verification queries instead
of encryption queries, yielding the following variant.
Proposition 7.3. Let
the
ChaCha20-Poly1305 AEAD scheme. There exists an adversary A,
that makes one permutation query and ğ‘ğ‘£ â‰¤ 2ğ‘˜ verification queries
such that:
length of
key
the
be
ğ‘˜
Adv
muAE
ChaCha20-Poly1305[ğœ‹](A) â‰¥ ğ‘ğ‘£
2ğ‘˜+1 .
Session 6D: Authentication and Privacy CCS â€™21, November 15â€“19, 2021, Virtual Event, Republic of Korea1990Key collision attack. The key recovery attacks above can be modi-
fied to obtain key collision attacks. Instead of using permutation
queries, these rely on encryption queries to detect key collisions
between users. While this does not allow key recovery, it suffices
to distinguish between the real and ideal games.
This modification applied to the attack from Proposition 7.2 gives
us the attack in Proposition 7.4, which can also be seen as an adap-
tation of the key collision attack of [10] for a ğ‘‘-repeating adversary.
We note that, although stated here as an attack against ChaCha20-
Poly1305, it extends to a generic attack against any deterministic
AE scheme with positive ciphertext expansion in the multi-user
setting, similar to the one of [10].
Proposition 7.4. Let
the
be
ChaCha20-Poly1305 AEAD scheme. There exists a ğ‘‘-repeating ad-
versary A, that makes 2 â‰¤ ğ‘ğ‘’ â‰¤ 2ğ‘˜+1
ğ‘‘âˆ’1 encryption queries such that:
length of
key
the
ğ‘˜
muAE
ChaCha20-Poly1305[ğœ‹](A) â‰¥ ğ‘ğ‘’(ğ‘‘ âˆ’ 1)
2ğ‘˜+3
.
Adv
Block collision attack. Finally, the following attacks distinguish the
output of the ChaCha20 block function from the output of a random
function due to block collisions. By construction, the ChaCha20
block function outputs can have collisions for different inputs, but
there cannot be collisions among the outputs of the ChaCha20
permutation. The first attack is a direct application of the idea that,
for a single user, we can detect collisions by canceling the feed
forward and looking at the difference between two values ğ¶ğ‘– âŠ• ğ‘€ğ‘–.
In the second attack, we exploit the encryption queries of multiple
users, looking only at the non-key parts of ğ¶ğ‘– âŠ• ğ‘€ğ‘–. This gives
us access to a truncated part of the ChaCha20 permutation and
reduces to the problem of distinguishing a truncated permutation
from a random function.
Proposition 7.5. Let ğ‘›, ğ‘˜ be the block and key length of the
ChaCha20-Poly1305 AEAD scheme. There exists an adversary A
that encrypt at most ğµ blocks per user for a total number of ğœğ‘’ â‰¤ 2ğ‘›+1
ğµâˆ’1
encrypted blocks across all users such that:
Proposition 7.6. Let ğ‘›, ğ‘˜ be the block and key length of the
ChaCha20-Poly1305[ğœ‹] AEAD scheme, where the underlying
ChaCha20 permutation ğœ‹ is modeled as an ideal random permu-
tation. There exists an adversary A encrypting a total number of
ğœğ‘’ â‰¤ min(cid:16)2 ğ‘›âˆ’ğ‘˜
2
.
muAE
ChaCha20-Poly1305[ğœ‹](A) â‰¥ ğœğ‘’(ğµ âˆ’ 1)
2ğ‘›+2
, 2ğ‘›âˆ’ğ‘˜âˆ’1(cid:17)
ChaCha20-Poly1305[ğœ‹](A) â‰¥ ğœğ‘’(ğœğ‘’ âˆ’ 1)
2ğ‘›+2
blocks such that:
muAE
.
Adv
Adv
Matching the bound. The presented attacks closely match the
most significant and some further terms in the bound of Theo-
rem 6.1:
Proposition 7.1: first term, â‰ˆ ğ‘ğ‘£Â·ğ‘Â·â„“ğ‘š2ğ‘¡
Proposition 7.2: first half of second term, â‰ˆ ğ‘ğ‘‘
2ğ‘˜ ,
2ğ‘˜ , up to a factor of 2(ğ‘› âˆ’ ğ‘˜).
Proposition 7.4: second half of second term, â‰ˆ ğ‘ğ‘’ğ‘‘
2ğ‘˜ .
Proposition 7.3: fourth term, â‰ˆ ğ‘ğ‘£
Proposition 7.6: fifth term, â‰ˆ ğœ2
2ğ‘˜ , up to a factor of 2(ğ‘› âˆ’ ğ‘˜ + 4ğ‘¡).
ğ‘’2ğ‘› , up to a factor of 4.
and third term â‰ˆ ğ‘
.
7.2 Nonce randomization
The record protocols of TLS 1.3 [29], DTLS 1.3 [30] and QUIC [31]
use a nonce-randomization technique to counter large-scale multi-
user attacks. Analyzing this technique for the GCM mode, Bellare
and Tackmann [4] provided the first multi-user treatment. Hoang,
Tessaro, and Thiruvengadam [15] captured the nonce-randomization
mechanism as a generic transform XN, which we recall in Fig-
ure 6. The XN transform turns an AEAD scheme ğ›± into a nonce-
randomized scheme ğ›±âˆ—, and [15] showed that a generic adversary
against the multi-user security of ğ›±âˆ— can be reduced to the secu-
rity of ğ›± against a strongly ğ‘‘-repeating adversary via an adaptive
balls-into-bins argument.
We reuse our Lemma A.1 to obtain a generalization of [15,
Lemma 4.1 and Theorem 4.2]; their version emerges from our The-
orem 7.7, when setting ğ›¿ = 1/2. The proof of the following theorem
can be found in Appendix D.
Theorem 7.7 (Multi-user security of the XN transform).
Let ğ›±[ğœ‹] = (K, E, D) be a nonce-based AEAD scheme with nonce
length ğ‘ defined on top an ideal permutation ğœ‹, and let ğ›±âˆ—[ğœ‹] =
XN(ğ›±[ğœ‹]) for the XN transform defined in Figure 6. Let A be a nonce-
respecting adversary against ğ›±âˆ— making at most ğ‘ğ‘’ Enc queries and
ğ‘ğ‘£ Vf queries. Then, for some fixed ğ›¿ > 0, we can construct an
adversary B of the same concrete query complexity as A which is
â€¢ ğ‘‘-repeating for ğ‘‘ =
â€¢ strongly ğ‘‘-repeating for ğ‘‘ =
2ğ‘ Â· (ğ›¿+1)Â·ğ‘
(cid:109) âˆ’ 1, if ğ‘ğ‘’ â‰¤ 2ğ‘ Â· (ğ›¿+1)Â·ğ‘
(cid:109)âˆ’1, if ğ‘ğ‘’ +ğ‘ğ‘£ â‰¤
max(1,ğ‘âˆ’log2(ğ‘ğ‘’+ğ‘ğ‘£))
max(1,ğ‘âˆ’log2(ğ‘ğ‘’))
(ğ›¿+1)Â·ğ‘
(ğ›¿+1)Â·ğ‘
(cid:108)
(cid:108)
3
3
such that
Adv
ğ›±âˆ—[ğœ‹](A) â‰¤ Adv
muAE
muAE
ğ›± [ğœ‹] (B) + 1
2ğ›¿ğ‘
.
Note that both ğ‘‘ and ğ‘‘ are less or equal to (ğ›¿ + 1) Â· ğ‘, even for
a number of queries above 2ğ‘, improving over [15] even when
ğ›¿ = 1/2.
We can combine Theorem 7.7 with our multi-user AE security
result for ChaCha20-Poly1305 in Theorem 6.1 to obtain the follow-
ing bound for the nonce-randomized usage of ChaCha20-Poly1305
(where ğ‘› = 512, ğ‘˜ = 256, ğ‘¡ = 128, and ğ‘ = 96), against an adversary
that is not necessarily ğ‘‘-repeating. We emphasize that to obtain
this result, we only need to use Theorem 7.7 with a reduction ad-
versary B that is ğ‘‘-repeating and not strongly ğ‘‘-repeating, as this
assumption is enough to use Theorem 6.1.
Theorem 7.8 (Multi-user security of nonce-randomized
ChaCha20-Poly1305). Let ChaCha20-Poly1305[ğœ‹] be the AEAD
scheme described in Figure 3 having parameters ğ‘›, ğ‘˜, ğ‘¡, ğ‘, ğ‘ and its
underlying permutation ğœ‹ modelled as a random permutation. Let A
be an adversary against the multi-user AE security of XN(ChaCha20-
Poly1305[ğœ‹]) making at most ğ‘ ideal permutation queries, ğ‘ğ‘’ encryp-
tion queries totaling at most ğœğ‘’ encrypted blocks, and ğ‘ğ‘£ verification
queries. Further, let â„“ğ‘š denote the maximum size in ğ‘¡-bit blocks (in-
cluding associated data) that A is allowed to query to its encryption
Session 6D: Authentication and Privacy CCS â€™21, November 15â€“19, 2021, Virtual Event, Republic of Korea1991procedure Kâˆ—()
1 : ğ¾ â†$ K
2 :
3 :
ğ½ â†$ {0, 1}ğ‘Ÿ
return ğ¾ âˆ¥ğ½
procedure Eâˆ—(ğ¾âˆ¥ğ½, ğ‘ , ğ´ğ·, ğ‘€)
1 : ğ‘ âˆ— â† ğ‘ âŠ• ğ½
2 : ğ¶ â† E(ğ¾, ğ‘ âˆ—, ğ´ğ·, ğ‘€)
3 :
return ğ¶
procedure Dâˆ—(ğ¾âˆ¥ğ½, ğ‘ , ğ´ğ·, ğ¶
1 : ğ‘ âˆ— â† ğ‘ âŠ• ğ½
2 : ğ‘€ â† D(ğ¾, ğ‘ âˆ—, ğ´ğ·, ğ¶)
3 :
return ğ‘€
Figure 6: The XN transform of an AEAD scheme ğ›± = (K, E, D) into a nonce-randomized AEAD scheme ğ›±âˆ— = (Kâˆ—, Eâˆ—, Dâˆ—).
and verification oracles. Then:
2ğ‘¡
2ğ‘˜
muAE
Adv
+2ğ‘ Â· (ğ‘› âˆ’ ğ‘˜)
XN(ChaCha20-Poly1305[ğœ‹])(A) â‰¤ ğ‘ğ‘£(ğ‘â„“ğ‘š + 3)
+ 2ğ‘ğ‘£ Â· (ğ‘› âˆ’ ğ‘˜ + 4ğ‘¡)
2ğ‘˜
+ 1
22ğ‘¡âˆ’2 +
+ ğ‘‘(ğ‘ + ğ‘ğ‘’)
+ (ğœğ‘’ + ğ‘ğ‘’)2
2ğ‘›+1
2ğ‘›âˆ’ğ‘˜âˆ’2 + 1
1
ğ‘ Â· 22ğ‘¡âˆ’1.
Â· 2ğ‘›âˆ’ğ‘˜(cid:17)
where ğ‘‘ =
In the above we further require that: ğ‘› âˆ’ ğ‘˜ â‰¤ 2ğ‘˜âˆ’2, ğœğ‘’ â‰¤ ğ‘›âˆ’ğ‘˜
6
ğ‘ğ‘’ â‰¤ 2ğ‘ Â· (ğ›¿+1)Â·ğ‘
, ğ‘ğ‘£ â‰¤ 2ğ‘›âˆ’2, ğ‘ â‰¤ min(cid:16) 2ğ‘¡âˆ’1
(cid:109) âˆ’ 1, for any 0 < ğ›¿ â‰¤ ğ‘¡
max(1,ğ‘âˆ’log2(ğ‘ğ‘’))
Â· 22ğ‘¡ , ğ‘›âˆ’ğ‘˜âˆ’1
6
(cid:108)
3
,
2ğ›¿ğ‘
Â· 2ğ‘›âˆ’ğ‘˜,
.
2ğ‘˜
(ğ›¿+1)Â·ğ‘
6
Note that as long as ğ›¿ â‰¤ ğ‘¡
ğ‘ Â· 22ğ‘¡âˆ’1, the restriction on ğ‘‘ from
Theorem 7.7 is satisfied. We will next discuss and interpret the above
bound for nonce-randomized ChaCha20-Poly1305. In particular, we
will see how to pick ğ›¿ such that the term 1
2ğ›¿ğ‘ induced through nonce
randomization does not dominate the overall bound.
7.3 Interpreting the Bounds
The dominant term. A closer look at Theorems 6.1 and 7.7 tells us
that the most significant term in our bounds for practical scenarios
is likely to be ğ‘ğ‘£Â·ğ‘Â·â„“ğ‘š2ğ‘¡
. This is mainly due to the fact that for current
ChaCha20-Poly1305 parameters, the block size is large (ğ‘› = 512)
and the key size ğ‘˜ = 256 of ChaCha20 is twice as big as the tag size
ğ‘¡ = 128 of Poly1305, where the latter is effectively further reduced
by the factor ğ‘ = 3 Â· 224 due to the clamping of 22 bits in the hash
key ğ‘Ÿ (cf. Definition 3.1 and Theorem 3.4). Hence, for the ChaCha20
-Poly1305 parameters, this term in practical scenarios dominates
the second-most significant term: ğ‘ğ‘£Â·ğ‘Â·â„“ğ‘š2ğ‘¡
, as long as the