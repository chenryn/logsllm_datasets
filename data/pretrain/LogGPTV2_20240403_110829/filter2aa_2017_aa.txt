Pentesting ICS 101 
By Arnaud SOULLIE 
Who am I? 
Arnaud 
soullié 
Senior security auditor 
 Windows Active Directory 
Can a Windows AD be secured ? JSSI 2014 
(French, sorry) 
 SCADA (BHEU14, HIP15, BruCon, BSLV15, 
DC24) 
 Wine  tasting  / Motorbike riding 
(we’re not going to talk about it today) 
 Sorry for the French accent 
interests 
@arnaudsoullie 
LAB PREREQUISITE 
vm? 
KALI LINUX 
 MODBUSPAL 
 MBTGET 
 PLCSCAN 
 SNAP7 
 … 
ADDITIONAL TOOLS 
 PCAP SAMPLES 
 SCRIPTS 
SKELETONS 
 … 
SCRIPTS 
LAB 
http://tinyurl.com/dc24-ics101 
Agenda 
Introduction to ICS 
 wrong with ICS security ? 
Programming plcs 
Pentesting PLCs  
Capture the flag ! 
Securing ics 
1h 
1h30 
1 
2 
3 
4 
5 
6 
1h30 
DEFCON 24 ICS WORKSHOP 
ICS Introduction 
Where do we find Industrial Control Systems ? 
Manufacturing plants 
Food 
Power plants 
Building automation 
systems (AC/HVAC/..) 
Water treatment 
Pharmaceutical 
manufacturing 
Chemical plants 
But also…swimming 
pools, building heating 
system, dams, etc. 
What is an Industrial Control System (ICS)? 
Group WAN 
Production 
management 
ERP server 
Corporate IT 
Corporate network 
Data Historian / 
Scada server 
Maintenance 
laptops 
Supervision 
consoles 
Supervision network / 
SCADA 
PLCs 
RTUs 
Production network 
ICS 
PLC 
Wireless industrial 
networks 
Corporate IS handle data 
≠ 
ICS handle interfaces data with physical world (cyber-physical systems) 
What about IoT / smart stuff ? 
 Not in the scope of this training 
Fit the definition of « cyber-physical » systems 
•
Cardio-meter for your smartphone 
•
« Smart » electrical plugs 
By the way, « smart » clearly isn’t the right word 
http://weputachipinit.tumblr.com/ 
Evolution of ICS 
 Started with electrical relays  hard wired automation, no update possible 
 Then moved to programmable electronics 
 Then to IP-network enabled devices 
 Now and future is more and more COTS 
ICS evolution timeline 
 From 1700s  : Industrial revolution 
 1900s : use of relays to control remote systems 
 1950s : use of punch paper tape to control machines 
 1960s : use of distributed control to control a plant 
 1969 : First PLCs 
 1973 : Modbus invented 
 1986 : PLCs controled by PCs 
 1992 : TCP/IP for PLCs 
 2003 : web servers for PLCs 
 ~2010s : Brace yourselves, AD is coming ! 
 Then what for the 10 next years ?? 
Future of ICS (well at least, current trends) 
Now and future is more and more COTS 
Active Directory domains 
Soft-PLCs : CodeSYS under Windows computers 
This is what happens when you star using too much IT in OT 
A bit of vocabulary 
ICS (Industrial Control System) 
= 
IACS (Industrial Automation and Control Systems) 
~= 
SCADA (Supervisory Control And Data Acquisition) 
~= 
DCS (Distributed Control System) 
Nowadays, people tend to say “SCADA” for anything related to ICS 
SCADA vs DCS 
▪ SCADA : event / data acquisition 
driven 
▪ Used across several sites (even at 
the country scale) 
▪ Can work even when offline 
▪ Low response time 
▪ DCS : process driven 
▪ Limited to local process monitoring 
▪ DCS works as standalone system 
▪ Dedicated products by the vendors 
for specific industries / process 
▪
In the real world,you’ll find some PLCs even when DCS is used 
▪
Today, SCADA manufacturer tend to have DCS functionnality, while DCS systems 
response time is lowering to be comparable to traditional SCADA response time 
In theory … 
In reality … 
SCADA vs DCS 
Siemens vision (1/3) 
From « DCS or PLC? Seven Questions to Help You Select the Best Solution” 
http://w3.siemens.com/mcms/process-control-
systems/SiteCollectionDocuments/efiles/pcs7/support/marktstudien/PLC_or_DCS.pdf 
SCADA vs DCS 
Siemens vision (2/3) 
SCADA vs DCS 
Siemens vision (3/3) 
ICS COMPONENTS 
▪ Sensors and actuators: allow interaction with the 
physical world (pressure sensor, valves, motors, …) 
▪ Local HMI: Human-Machine Interface, permits the 
supervision and control of a subprocess 
▪ PLC: Programmable Logic Controller : manages the 
sensors and actuators 
▪ Supervision screen: remote supervision of the 
industrial process 
▪ Data historian: Records all the data from the 
production and Scada networks 
▪ RTU : Remote Terminal Unit (standalone PLC) 
▪ IED : Intelligent Electronic Device (smart sensor) 
CIM pyramid 
Level 3 : Orders and stock management, clients and accounting  Handled by the ERP 
Level 2 : Management of products : storage, moving, etc 
Level 1 : Automation 
Level 0 : Sensors and actuators 
▪ Computer Integrated Manufacturing 
Industrial protocols 
 At the beginning, specific protocols on specific physical layer 
(RS232, RS285, 4-20 current loop) 
 Some protocols were adapted to TCP/IP, like Modbus, and other 
were developped to allow interoperability. 
 Currently, the most used seem to be  :  
 HART / Wireless HART 
 Profibus 
 Modbus 
 Profinet / S7 
 DNP3 
 For the field protocols (used by the PLCs, and some « intelligent » 
sensors/actuators) 
 OPC for data echanged with the corporate network / Windows-
based systems 
ICS vendors 
Number of employees 
Siemens : 362 000 
ABB : 150 000 
Emerson : 115 000 
Rockwell : 22 500 
Schneider Electric : 152 000 
http://www.controlglobal.com/assets/00_images/2014/12/CG1412-Top50AutoVendors.pdf 
IT vs OT 
 The essential criteria for ICS security is availability, 
not confidentiality 
 ICS were designed to be isolated, but today need 
to communicate with the outside world 
 The use of COTS and standard protocols is 
relatively new 
 Lifetime of components span over decades 
 No security awareness 
IT vs OT 
IT 
OT 
Availability : My system is working correctly 
Integrity : My system is working as expected 
OT cares more about safety 
Applied regularly on standards systems 
Security 
patches 
Only recently provided by vendors. Applied 
once a year tops 
Deployed on all Windows machines, centrally 
managed 
Antivirus 
Sowly starting to show up. Some vendors used 
to / stil forbid AV usage (lack of support if AV is 
installed) 
Not managed 
Centralized, dedicated teams, standard operations 
and procedures 
System 
Administration 
Lack of local skills, heterogeneous 
environments, lots of different tools to use, 
vendor support is mandatory 
Nominative accounts 
IAM 
Generic, shared accounts, no password policy 
Service interuptions are OK, especially outside 
business hours 
Availability 
Real-time operations, downtime is 
unacceptable or very costly 
Standard, TCP/IP protocols that include 
authentication and encryption 
Protocols 
Lot of vendor-specific protocol 
no security built in 
No people endangered 
Impact 
Possible impact of people, environnent, 
industrial gear 
Who cares ? 
<2011 
SCADA SECURITY AWARENESS TIMELINE (SIMPLIFIED) 
Who cares ? 
OMG ! 
STUXNET !!! 
2011 
<2011 
SCADA SECURITY AWARENESS TIMELINE (SIMPLIFIED) 
Who cares ? 
OMG ! 
STUXNET !!! 
Under control 
2011 
<2011 
SOME day ? 
SCADA SECURITY AWARENESS TIMELINE (SIMPLIFIED) 
ICS security awareness is growing 
At the government level 
In industrial companies 
For the general audience 
Regulations 
policies 
fear 
Vendors Cyber-Security offer 
Most ICS vendors have know understood the client’s 
worries about security and offer different kinds of 
dedicated products and/or services 
That DOES NOT mean that vendors’ staff has the required 
 knowledge and training about ICS security 
Quizz! 
Q1 : 
between a plc and a rtu ? 
Q2 : Name 3 major ics 
vendors 
Q3 : 
for ? 
Q4 : whats the mean 
response time for a plc ? 
Q5 : what do popale use plc 
and not standard pc ? 
Module 2 : WHAT IS WRONG WITH CURRENT ICS 
security? 
Network 
segmentation 
security 
supervision 
Organization 
& awareness 
Vulnerability 
management 
third paRty 
management 
security  
In protocols 
Organization & awareness 
 ICS security does not have the same level of maturity as 
IT in general 
 You will often face situation were nobody is in charge of 
ICS security 
 Sometimes, there is even nobody in charge of IT 
(computers, switches) 
 Someone is in charge of ICS safety, but not security 
 ICS are often still out of the CISO perimeter 
Awareness : misconceptions 
 SAFETY != SECURITY 
 Our ICS are not connected 
 Proprietary protocols are safer 
 I have an Antivirus, I am safe 
 $BIG_VENDOR products are certainly secure 
 The safety systems will prevent anything bad from 
happening 
Network segmentation 
 Mostly a fail 
 Nothing is air-gapped, ever (well, almost) 
 « It is segmented because my laptop can’t connect to both 
networks at the same time » 
 Often, poorly configured ACLs on routers 
 Wide access to the ICS from the  
Port 80 allowed to everyone 
Spoiler alert : port 80 allows to do plenty of nasty 
things 
 How good is your network segmentation if you directly 
copy files from the office network to the ICS network ? 
Reconnaissance : exposure 
 Exposure on the Internet : Shodan 
 What’s cool about Shodan is that it doesn’t require any 
validation from the client (mostly free, but features like 
export are paid options) 
 How do it work : Shodan scans the whole Internet at 
regular times and gives you access to the results 
 YOU do not send a single packet to the client’s 
infrastructures 
 Can give you information about the type of technologies 
used 
 Most of the time, client is not aware that systems are 
exposed to the Internet... 
Finding scada systems on 
the internet 
I 
▪
Shodan is a search engine dedicated to find devices exposed to the Internet 
▪
It regularly scans the whole Internet IPV4 range (~4,3 billions IPs) 
▪
Results are partially free (you have to pay to export the results) 
▪
All kinds of connected devices 
▪
PLCs 
▪
Webcams 
▪
Smart-things (fridge, TV, …) 
▪
Things you can’t even imagine… 
▪
Example ICS report : 
https://www.shodan.io/report/l7VjfVKc 
What can you find? 
▪
Scan the Internet yourself 
(Zmap, Massscan) 
▪
Other online 
services/surveys 
ALTERNATIVES? 
FUNNy things you can find on teh 
interwebs 