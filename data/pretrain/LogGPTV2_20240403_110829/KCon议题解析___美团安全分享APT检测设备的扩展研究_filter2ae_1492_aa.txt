# KCon议题解析 | 美团安全分享APT检测设备的扩展研究
##### 译文声明
本文是翻译文章
译文仅供参考，具体内容表达以及含义原文为准。
8月23日-25日，一年一度的KCon
黑客大会在北京昆泰嘉瑞文化中心成功举办，本届大会以“无界”为主题，通过汇聚全球黑客的智慧，探索技术的无穷奥秘，突破边界外的边界，创造不可能的可能。
作为安全领域内拥有丰富实战经验和技术积累的安全团队，美团安全研究院成员受邀参加KCon黑客大会，并针对目前主流厂商在移动平台（iOS、Android）的APT检测设备明显不足的现状，分享了关于“APT检测设备的扩展研究”的议题。
现场议题围绕业界现状分析、C相关设备的动态沙箱（蜜罐）技术等几个方面，充分展示美团安全团队对APT检测设备的扩展研究成果。
## 议题解读“APT检测设备的扩展研究”
演讲者 | JU ZHU
目前就职于美团（高级安全研究员），有着9+年的安全研究经验，其中7+年主要从事高级威胁的研究，包括0Day、nDay
和漏洞挖掘。他一直致力于使用自动化系统来 Hunt 野外的高级威胁，曾多次获得 CVE，且受到 Google、Apple、Facebook
等厂商的致谢，也多次作为 Speaker 受邀参加 BlackHat、CodeBlue、CSS 等国内外的顶级安全会议。
## 1\. 现状分析
###  1.1 业界主流APT检测设备选型对比
APT检测设备的选择一般是参考Gartner报告挑出备选，再结合实际情况做适应性检测对比。
平台支持性：
我们统计了某天内网接入设备的操作系统类型（见图1），并根据这些类型对三个备选厂商进行了平台相关性检测（见图2）。
图1 内网接入设备的操作系统类型统计
|
Windows
|
MacOS
|
iOS
|
Android
|
其它  
---|---|---|---|---|---  
厂商1
|
✔
|
✘
|
✘
|
✘
|
✘  
厂商2
|
✔
|
✘
|
✘
|
✘
|
✘  
厂商3
|
✔
|
✘
|
✘
|
✔
|
✘  
图2 各厂商的平台支持对比
从图1和图2可以看出，大部分厂商只是对Windows平台的支持比较好，或者也提供Android沙箱。然而这和内网接入设备的多元化还有很大差距，需要我们自己进行进一步的扩展开发。
文件类型支持性：
有些厂商对于平台的支持可能受到某些限制，所以他们通过更多的文件类型支持来进行能力补充（见图3）。
|
PE
|
Office
|
PDF
|
Mach-O
|
plist
|
APK  
---|---|---|---|---|---|---  
厂商1
|
✔
|
✔
|
✔
|
✘
|
✘
|
✘  
厂商2
|
✔
|
✔
|
✘
|
✘
|
✘
|
✘  
厂商3
|
✔
|
✔
|
✘
|
✔
|
✘
|
✔  
图3 各厂商的文件类型支持对比
在选型测试中，我们特地增加了plist文件格式的样本，这源于之前发现的在野的iOS Ransomware（Death
Profile[[1]](/Users/xuting16/Desktop/SRC/Kcon/%E7%BE%8E%E5%9B%A2%E5%AE%89%E5%85%A8Kcon%E9%BB%91%E5%AE%A2%E5%A4%A7%E4%BC%9A-20190826%E7%BB%88%E7%89%88.docx#_ftn1)）。它是一种基于iOS的Configuration
Profile，常用于企业为办公设备推送各类配置信息（如Wi-Fi、VPN设置等），是一种常见的公司内部交换文件格式。
从图3看，各厂商几乎覆盖了基于Windows平台的文件格式（诸如PE、Office等），只有少量厂商支持基于MacOS/iOS平台的Mach-O文件（经过实测，他们基本上采用的是静态分析方式），而plist格式目前并未有厂商支持。因此对于文件格式的支持性，还有很大的空间可提升。
###  1.2 可参考的解决方案对比
对于甲方来说，APT检测的解决方案一般以采购为主，但也不乏根据实际情况进行部分自研。我们选取了一些可参考的（除Windows外）动态沙箱技术解决方案来进行对比（见图4）。
|
MacOS
|
iOS
|
Android  
---|---|---|---  
可参考的动态沙箱
|
Darling
或
Cuckoo Sandbox
|
Corellium
|
Anbox
或
Cuckoo Droid  
使用方式（云或本地）
|
本地
|
云
|
本地  
开源？
|
是
|
否
|
是  