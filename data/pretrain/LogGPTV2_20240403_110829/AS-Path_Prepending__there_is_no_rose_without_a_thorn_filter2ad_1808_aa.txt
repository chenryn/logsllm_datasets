title:AS-Path Prepending: there is no rose without a thorn
author:Pedro de B. Marcos and
Lars Prehn and
Lucas Leal and
Alberto Dainotti and
Anja Feldmann and
Marinho P. Barcellos
AS-Path Prepending: there is no rose without a thorn
Pedro Marcos∗
Lars Prehn∗
Lucas Leal
UFRGS
PI:EMAIL
Marinho Barcellos
University of Waikato
PI:EMAIL
FURG
PI:EMAIL
Alberto Dainotti
CAIDA, UC San Diego
PI:EMAIL
MPI for Informatics
PI:EMAIL
Anja Feldmann
MPI for Informatics
PI:EMAIL
ABSTRACT
Inbound traffic engineering (ITE)—the process of announcing routes
to, e.g., maximize revenue or minimize congestion—is an essential
task for Autonomous Systems (ASes). AS Path Prepending (ASPP) is
an easy to use and well-known ITE technique that routing manuals
show as one of the first alternatives to influence other ASes’ routing
decisions. We observe that origin ASes currently prepend more than
25% of all IPv4 prefixes.
ASPP consists of inflating the BGP AS path. Since the length of
the AS path is the second tie-breaker in the BGP best path selec-
tion, ASPP can steer traffic to other routes. Despite being simple
and easy to use, the appreciation of ASPP among operators and
researchers is diverse. Some have questioned its need, effectiveness,
and predictability, as well as voiced security concerns. Motivated by
these mixed views, we revisit ASPP. Our longitudinal study shows
that ASes widely deploy ASPP, and its utilization has slightly in-
creased despite public statements against it. We surprisingly spot
roughly 6k ASes originating at least one prefix with prepends that
achieve no ITE goal. With active measurements, we show that ASPP
effectiveness as an ITE tool depends on the AS location and the
number of available upstreams; that ASPP security implications are
practical; identify that more than 18% of the prepended prefixes
contain unnecessary prepends that achieve no apparent goal other
than amplifying existing routing security risks. We validate our
findings in interviews with 20 network operators.
CCS CONCEPTS
• Networks → Network measurement.
ACM Reference Format:
Pedro Marcos, Lars Prehn, Lucas Leal, Alberto Dainotti, Anja Feldmann,
and Marinho Barcellos. 2020. AS-Path Prepending: there is no rose without
a thorn. In ACM Internet Measurement Conference (IMC ’20), October 27–
29, 2020, Virtual Event, USA. ACM, New York, NY, USA, 15 pages. https:
//doi.org/10.1145/3419394.3423642
∗Both authors have contributed equally to the paper.
Permission to make digital or hard copies of all or part of this work for personal or
classroom use is granted without fee provided that copies are not made or distributed
for profit or commercial advantage and that copies bear this notice and the full citation
on the first page. Copyrights for components of this work owned by others than the
author(s) must be honored. Abstracting with credit is permitted. To copy otherwise, or
republish, to post on servers or to redistribute to lists, requires prior specific permission
and/or a fee. Request permissions from permissions@acm.org.
IMC ’20, October 27–29, 2020, Virtual Event, USA
© 2020 Copyright held by the owner/author(s). Publication rights licensed to ACM.
ACM ISBN 978-1-4503-8138-3/20/10...$15.00
https://doi.org/10.1145/3419394.3423642
1 INTRODUCTION
Many Internet Autonomous Systems (ASes) receive significantly
more traffic than they send. They often use inbound traffic engineer-
ing (ITE) to influence the link through which they receive traffic
based on economic considerations (e.g., transit cost) or operational
demands (e.g., latency, packet loss, capacity). ITE has become even
more important, as there are more options for inter-AS connectivity
due to, e.g., IXPs (Internet eXchange Points), PNIs (Private Network
Interconnects), and an overall increase of peering [9, 70, 73? , 74].
Border Gateway Protocol (BGP)-enabled ITE techniques include
AS-Path Prepending (ASPP) [15, 22, 75], selective or more-specific
prefix announcements [27], BGP communities [23, 62], or Multi
Exit Discriminator (MED) values [25, 41].
In this paper, we focus on understanding ASPP deployment and
the potential issues associated with it. ASPP is a straightforward,
easy-to-use technique that is often mentioned among the first ITE
techniques by router vendors [19, 21, 26, 35, 43]. It is a technique
where an AS artificially inflates the BGP AS path by inserting (sub-
sequent) duplicate entries of its ASN. Since the length of an AS
path is the second most important tie-breaker in BGP best path se-
lection, ASPP may steer traffic from one route to another. However,
its effect depends on route propagation and the routing decisions
made by other ASes. Despite (or because of) its simplicity and its
inherent limitations, the appreciation of ASPP among operators
and researchers is mixed. On the one hand, ASPP—unlike other ITE
techniques—does not need any support from other ASes, nor deag-
gregatable prefixes. On the other hand, its need, effectiveness, and
predictability have been questioned [37, 50, 64]. In addition, there
have been concerns about the extent to which ASPP can amplify
existing routing insecurities [38, 39, 63], and reports of improper
ASPP configurations triggering bugs in router software [78, 79].
Motivated by the mixed views about the ASPP method, we inves-
tigate the current use of ASPP and find that more than 30% of ASes
use it. Thus, to contribute to an informed discussion, we address
three fundamental questions:
(i) How do ASes use prepending? To put effectiveness and risk
into context, we first identify and characterize the policies ASes
apply (i.e., the number of prepends used for each prefix) when
using ASPP. Even when using data from all route collectors over
the last decade, limited route visibility [16, 29, 47] poses a significant
challenge. We deal with it by conducting interviews with more than
20 operators and by cross-checking our results with private data
sources from large Internet players.
(ii) How effective is prepending? Among both operators and
academics, the opinion on whether ASPP is effective as an ITE
IMC ’20, October 27–29, 2020, Virtual Event, USA
Pedro Marcos et al.
technique diverges and often depends on the position of an AS
in the routing ecosystem. For example, Quoitin et al. [50] showed
that ASPP is unpredictable using their vantage point. We claim
that the effectiveness of ASPP is indeed diverse—it depends on the
vantage point within the routing system and the number of available
upstreams. We highlight this behavior by actively testing a large
number of vantage points and varying the number of upstreams.
(iii) Does prepending amplify existing routing security risks?
Often, a “malicious” route needs to be the shortest path in order
to be adopted. ASPP facilitates the spreading of malicious routes
by making the legitimate paths longer. While one may observe
malicious routes in public BGP data, the lack of suitable what-
if scenarios (i.e., how would the scenario change with a larger
prepend size) poses a significant challenge. We shed light on this
topic by systematically emulating numerous prefix hijacks from
many vantage points.
We approach these questions using both active and passive mea-
surements. We use passively collected routing information from
Isolario [34], RIPE RIS [1], and RouteViews [2] to perform a longi-
tudinal study. We then use the PEERING testbed [57, 58] to system-
atically explore ASPP from a large number of vantage points and
emulate many scenarios through targeted BGP route announce-
ments and probing traffic.
We summarize our main contributions as follows:
• We perform a longitudinal characterization of ASPP utiliza-
tion and identify that, despite the community mixed opin-
ions, its utilization has been steadily increasing. We find
that, on May 2020, 30% of the ASes prepend at least one of
their prefixes, resulting in 25% of the IPv4 prefixes being
originated with ASPP (see § 4).
• We also identify that ASes mainly originate their prefixes
with two distinct prepending sizes (e.g., without prepend
and with two extra prepends) to indicate their preference
for inbound traffic. Surprisingly, we also find that roughly
6k ASes originate a total of more than 28k prefixes with a
single prepending size (different than zero), thus resulting
in no ITE effect (see § 5).
• We discover that in scenarios with only two upstreams, ASPP
effectiveness is strongly dependent on the vantage point. Yet,
when using many upstreams, ASPP shifts traffic from most
incoming sources (see § 6).
• Using active experiments, we identify that prefixes with
three prepends are highly suitable for prefix hijacking. Today,
ASes originate more than 15k prefixes with at least three
prepends, increasing the risks of widespread route leaks or
prefix hijacking with no apparent ITE benefit (see § 7).
We discuss ethical considerations in Appendix § A, and to foster
reproducibility and research on ASPP, we make all of our analysis
code available to the research community.1
2 PRIMER ON PATH PREPENDING
ASPP is an ITE technique in which an AS adds its own AS number
n extra times (n ≥ 1) before originating/propagating a BGP route,
thus artificially increasing the resulting AS-Path length by n. We
refer to n as the prepend size. Whenever an AS receives a route
1https://gitlab.mpi-klsb.mpg.de/lprehn/imc20_aspp
announcement, it chooses the best path according to a list of tie-
breaking rules. The first rule relies on local preference. To affect
the route selection of remote ASes [52], an AS uses ASPP to inflate
the AS Path to influence the second tie-breaking rule: to prefer the
shortest AS path. (If the tie persists, route origin and MED values
are among the remaining tie-breakers.)
In Figure 1a, we illustrate the use of ASPP by an AS with two
neighbors. AS A announces a prefix P to both neighbors with dif-
ferent prepend sizes. By making one path longer, AS A attempts
to influence remote ASes to send traffic through AS B. The success
of this attempt will depend on how remote ASes will receive the
announcements. In Figure 1b, we depict a case where ASPP can
influence the decision of AS F. Even though the path traversing
AS C has fewer ASes than the one going through AS B, AS F prefers
the second path as it is the shortest. In Figure 1c, we show a case
where the ASPP by AS A cannot influence the decision of AS F as
it has fewer prepends—AS F prefers the path traversing AS C as it
has the smallest AS path length. These cases underline that ASPP
cannot guarantee remote route changes and the resulting ingress
traffic distribution.
We distinguish two forms of prepending. If the AS prepending
is the originator, we refer to it as origin-prepending; otherwise, we
refer to it as intermediate-prepending. When an AS prepends on be-
half of another AS, we refer to this particular form of intermediate-
prepending as remote-prepending. In such cases, ASes can use BGP
communities or web interfaces to ask the other ASes to prepend.
ASes use remote-prepending to affect path choices that are beyond
the reach of origin-prepending.
ASes can use ASPP for load balancing among upstreams, to
minimize transit cost (by moving traffic away from an expensive
upstream), or to establish backup links. Among the reasons men-
tioned by operators for ASPP popularity are its ease of use on
commercial routers, its efficiency in steering incoming traffic, and
the requirements and shortcomings of alternate mechanisms.
3 DATASETS AND DATA SANITATION
To analyze ASPP utilization, we rely on (BGP) MRT data publicly
available from Isolario2 [34], RIPE RIS[1], and Route Views [2]. We
use the following datasets in our analyses.
BGPContinuous : This dataset contains RIB snapshots from all avail-
able BGP collectors on March 1st, 2020 at 0:00 UTC+0. In addition,
it contains all subsequent update files until April 1st, 2020, at 0:00
UTC+0. If an update file is missing in a collector’s repository, we
add the next available RIB snapshot to capture potentially missed
changes.
BGPWeekly : This dataset contains data for each Monday between
January 1st, 2018, and May 4th, 2020. For each day, we use the RIB
snapshots from all available BGP collectors at 0:00 UTC+0 and all
consecutive updates for that day. We, again, compensate for missing
files.
BGPMonthly : This dataset contains data for the 15th day of every
month between January 15th, 2010, and April 15th, 2020. We gen-
erate the data of a single day in the same way as for the previous
dataset.
2Isolario was hit by lightning on July 30th, 2019, leading to some missing files until
August 16th, 2019 —we find that the impact to our analysis is minimal.
AS-Path Prepending: there is no rose without a thorn
IMC ’20, October 27–29, 2020, Virtual Event, USA
(a) AS A announces the prefix P with ASPP to
one of its neighbors.
(b) ASPP in effect.
(c) Route adoption regardless of ASPP.
Figure 1: AS-Path Prepending behavior.
ROAS: Rather than using tools (such as Routinator [45]) to pre-
process RPKI data, we take advantage of the preprocessed data
provided by Chung et al. [18]. We use data for the same days as in