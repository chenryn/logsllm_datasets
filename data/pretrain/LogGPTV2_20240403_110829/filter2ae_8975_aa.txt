Author：爱奇艺技术产品团队
    地址：https://mp.weixin.qq.com/s?__biz=MzI0MjczMjM2NA==&mid=2247483836&idx=1&sn=d46875c957289d8e035345992ad7053e
### 01 普遍业务风险 ——行业的共同的问题
爱奇艺在快速发展过程中, 业务越来越多，越来越复杂，用户的权益和信息价值越来越高, 我们面临的业务安全的挑战也就越来越大。
除了传统的网络黑客的入侵，攻击以外，新的业务形态带来的新型风险: 比如撞库盗号，盗播盗看，很多的营销活动招引大量的薅羊毛的行为, 刷量, 刷人气,
恶意发布不良信息等风险, 社交场景下的拉粉和不良信息恶意传播, 支付场景下的欺诈, 所有这些风险一旦被黑产利用, 都可能对企业的稳定运营带来大的冲击。
以下总结了各种业务会遇到的风险
01 会员：撞库盗号，账号分享，批量注册  
02 视频：盗播盗看，广告屏蔽，刷量作弊  
03 活动：薅羊毛  
04 直播：挂站人气，恶意图文  
05 电商：恶意下单，订单欺诈  
06 支付：盗号盗卡，洗钱，恶意下单，恶意提现  
07 其他：钓鱼邮件，恶意爆破，短信轰炸
### 02 解决方案 ——安全+风控
针对新的业务形态会遇到的问题，除了一方面是要用常规安全解决方案去解决，另外我们也要对业务做充分的风险评估和及时控制。
常规安全解决方案是加强安全制度和体系建设，推动安全开发和安全运维，关注边界安全, 数据安全和纵深防御。
后者是我们要重点为给公司带来核心价值的关键业务，从风险管控上保护好他们。
### 03 业务上线运营——问题多多
业务在上线运营以后, 不是说没有关注风险评估和控制，但是以前的做法存在有非常多的问题，这里举四类主要的问题:
#### 一. 各自为战
1 各业务方多以安全事件驱动, 多数仅做事前单点防御, 经验数据无法共享
2 单点防御容易被黑产各个击破, 无法做到跨业务跨团队的联防联控
3 低水平重复建设, 平台资源浪费
#### 二. 拍脑袋"规则"
1 大量的风控规则是专家决策为主,阈值基本拍脑袋而定
2 没有引入数据分析或者机器学习等能力, 对事件本质缺乏足够认识及数据支撑, 造成正常用户误杀, 损伤用户体验, 导致用户流失
#### 三. 反应过慢
1 不能快速识别攻击变化进行调整,无法进行积极对抗
2 业务代码耦合,依赖业务开发, 测试和上线,占用业务排期
3 某些前置/内置规则容易成为业务关键路径, 对业务稳定性造成影响
#### 四. 手段单一
1 可用特征维度不多, 严重依赖于IP, 公共出口误杀严重,引发投诉
2 以限频, 限流, 黑白名单, 图文验证为主, 黑白名单难以维护, 无生命周期
### 04 目标风控系统——用云服务来解决业务的问题
要解决业务在上线运营以后遇到的问题，我们需要将风控服务，以云服务的方式提供业务,让业务关注业务本身, 让跨业务支持的统一风控云服务来对其进行保障。
到底要提供给业务团队怎么样的风控服务呢?
这里列一下我们的设计目标, 这些目标的达成也就能解决前面说的问题。
#### 一. 联防联控
1各业务联合, 在模型,规则,数据等方面进行共享, 联合布控协同防御
#### 二. 数据驱动, 智能对抗
1 全站全网数据支撑, 基于数据进行决策
2 利用机器学习实现智能异常特征发现
#### 三. 策略灵活, 有效对抗
1 独立服务, 快速迭代
2 支持业务的风险多样运营需求
3 模型,规则, 策略快速实施, 快速反应
#### 四. 维度和拦截手段多样
1 不依赖单一维度和单一行为
2 云和端结合, 多种拦截手段应对
#### 五. 延迟可控, 低耦合可降级
1 在实时风控场景下, 快速决策, 不能明显增加业务延迟, 自身有问题情况下, 不能影响业务
#### 六. 快速实现, 高效部署
1 能够快速完成架构. 实现和持续迭代
2 能够面向私有云的复杂拓扑, 快速部署
### 05 风控服务的架构
#### 一. 风控服务组成
我们的风控服务是由三大子服务组成：
麦哲伦（Magellan）主要包括业务接入(接入层)，三大服务引擎(数据查询，规则执行，模型调用)，面向风控团队的管理平台(服务资源管理,
模型规则管理，生命周期管理，上下线管理，维度数据管理)，面向业务方的运营平台(风险事件管理，仿真，风险处置，监控预警，数据查询和仪表盘，规则清单)。
哥伦布（Columbus）主要面向对业务数据的特征工程，大规模异常检测和深度学习，知识图谱，实时特征，离线特征，环境特征以及安全画像，并对外提供模型可实时调用接口或者模型输出缓存。
郑和（Zhenghe）是安全知识仓库，是面向业务风控和其他安全控制所需的各类安全基础数据和威胁情报。
#### 二. 风控 - 部署
利用云平台能力高效构建和发布：
2.5*4个人月从零开始开发构建上线服务,
并对外提供了基于HTTP/RPC的实时风控和近实时风控以及基于离线数据的离线风控.如何把风控服务在复杂的云环境部署下去。
我们会在一个主IDC里，部署运营中心和管理平台。这一块可以快速切换IDC部署，如果这个主IDC有问题,
可以快速切换到另一个IDC。对于真正贴近业务的三大服务引擎，则是基本上所有有受保护的业务的IDC都有进行部署, 以保证业务可以就近访问, 降低访问延。
#### 三. 风控 - 引擎
查询引擎
1 Magellan子服务的的核心，主要负责进行实时和离线数据批量查询及聚合
2 构建为参数/特征组合提供给规则引擎, 模型引擎
规则引擎
1负责进行规则匹配
2支持自定义执行策略如: 命中退出, 全部执行, 条件退出等
3支持多种规则类型, 如:评分卡, 决策树, 决策表, 普通规则等
模型引擎
1通过查询引擎查上来的一些参数特征，负责进行特征处理及算法执行，以达到和Columbus子服务的协同, 并服务于规则引擎。
#### 四. 风控 - 运营
业务如果把风险评估交付给风控，Magellan必须满足其复杂的运营需求：
一 风控服务
业务风险评估,接入登记,根据场景实施初始规则和模型,逐步迭代。
二 事件查询/处置/回溯
查询被识别为风险案例的上下文,特征,模型结果,数据标注等信息.供运营进行案例分析及后续仿真
三 事件监控和报警
业务/风险数据监控看板,智能报警
四 adhoc/Daily数据分析
Adhoc/Daily数据报表,风险数据分析,模型/规则贡献度分析,仿真效果分析等
五 离线/在线仿真
基于案例库中的正/反例,结合仿真环境进行模型/策略仿真.利用数据平台进行贡献度, 线上效果比对等分析。
六 审批上线
规则模型变更及时通知业务方,风控运营团队,相关业务方,相关负责人确认审批上线。
### 五.风控 - 数据
风控最重要的还是数据。
风控通过Columbus子服务从业务方获取的海量的近实时或者离线业务数据, 并把数据进行清洗和特征工程,形成基础数据，这些基础数据存在HDFS-HBase里面，通过数据分析和机器学习的方法, 产生各类标签，画像和模型, 经过安全专家确认, 产出的安全规则和可用的模型缓存。
针对业务数据获取和处理, 对于实时数据 ,利用Apache Flink构建, 实现图特征工程, 多维频次特征工程, 多数据流Complex Event
Processing处理, 达到毫秒级延时.
Columbus的多渠道业务数据采集和处理
1 实时数据:基于Apache Flink
构建: 图特征工程, 多维频次特征，多数据流Complex Event Processing，毫秒级延时
2 近实时数据:基于Apache Spark
构建:异常检测,流式特征工程,，秒级延时
3 离线数据: 基于Apache Spark，Impala/Hive
构建:安全画像，用户画像，全业务数据， 小时/天级延时
**安全画像**
Columbus的安全画像  
对全站业务数据分析和提炼以后  
形成海量的多维度标签刻画  