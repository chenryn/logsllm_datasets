/ _查看安装的域名和数据库密码：cat /ewomail/config.ini_ /  
  9. 到这一步时，安装已经完成了，还有一个事情要做，添加个解析,把下边那一条加进去，这里我认为vps上也可以加一下
        vim /etc/hosts
        127.0.0.1   mail.xxxx.com smtp.xxxx.com imap.xxxx.com
  10. 我们访问一下后台，默认账号密码admin/ewomail123，进去先改一下密码。
  11. 已经绑定好后缀域名了，我们首先添加邮箱用户，这块可以自己看着起名，PI:EMAIL，或者PI:EMAIL，设置好账号密码后可以去
  1. 有时候我们搭建好了发现需要换域名的办法，需要替换两个地方,第一个是web管理平台绑定的域名，第二个是配置文件如下图，马赛克部分便是需要改的域名：
        vim /ewomail/www/ewomail-admin/core/config.php
* * *
## 3\. mip22搭建
  1. 先简单介绍一下mip22这个工具，集钓鱼网页、邮件服务、隧道技术于一身，通过网页访问可以捕获不少东西，是一套完整的网页钓鱼工具，但是缺少一点图形化展示，数据结果不够直观，不适合做演练，也因为我菜（根本原因）。这里我们主要是用他的钓鱼页面，可以直接套进gophish使用。  
  2. 好的，话不多说我们直接上手
        sudo su 
    cd ~
    git clone https://github.com/makdosx/mip22.git
    chmod -R 777 mip22 
    cd mip22
    bash mip22.sh
  3. 启动后如图，【1】Attack Default：是他的内置的钓鱼页面，九十多个，网页惟妙惟肖，可以直接用于钓鱼，而且最重要的整体格式都是...,因为gophish只有在这种样式下才能获取到钓鱼网页中的数据。
>
> /*不得不说一下我的血泪史，我一开始用gophish克隆网页，无数网站中挑了一个合适的网页克隆，然后调完内容调样式，有的还能用他的样式，有的还得自己写，调完样式换图片，最后咔咔上线，点击上传发现没数据，师从百度，一问发现是表单问题，行我改，改完发现以前的样式不能用了，还得从头再来，我
> **。
>
> 
  4. 我们选“1”，进去后挑一个自己中意的，不知道选中的是什么样式对吧，请看下一步  
  5. 哈无所谓中意，可以随便选一个，回车，这时候需要注意一下，选好克隆网页后之后，他会让你选一下是本地访问（localhost），还是对外（localhostrun），或者cf（cloudflared）还有ngrok，我们选第二个，他生成的链接是一个临时链接。 **这边需要注意下，有时候选择完没有生成链接的话，需要在你敲”2“之后，手动敲一个yes ，再回车，原因可能是有的字段没显示出来，操作如图**  
  6. 生成链接成功  
  7. 访问测试，成功抓到访问信息，IP地址，设备信息等，如果你属于提交数据的话，也会显示出来，然后会自动跳转到真的官网，数据会记录在两个txt文本中。
> 我们的搭建与调试就结束了
* * *
# 三、联动与利用
## 1.邮件服务器与gophish
  1. 邮件服务器是部署在内网的，我们想让他跑起来需要映射出去，这里我们用到frp去做一个映射，需要在vps与虚拟机上都安装，代码如下：
        wget https://github.com/fatedier/frp/releases/download/v0.42.0/frp_0.42.0_linux_amd64.tar.gz
    tar zxvf frp_0.42.0_linux_amd64.tar.gz
  2. frp分客户端和服务端，vps是服务端server，虚拟机是客户端client。双方需要配置的文件分别是frps.ini，frpc.ini，我们先配一下服务端，比较简单。
        vim frp_0.42.0_linux_amd64/frps.ini
        [common]
    bind_addr = 0.0.0.0
    bind_port = 7000
    bind_udp_port = 7001
    kcp_bind_port = 7000
    vhost_http_port = 80
    vhost_https_port = 443
    dashboard_addr = 0.0.0.0
    dashboard_port = 7777   /*管理页面*/
    dashboard_user = admin
    dashboard_pwd = !@#$QWER....
  3. 启动服务端服务,调试完成后可以nohup ./frps -c frps.ini & 后台运行。
        ./frps -c frps.ini
  4. 客户端配置， 各位在配置映射端口时候，建议netstat -anp先查一下你的vps端口使用，别冲突了，然后开始配置:
        [common]
    server_addr = 你的vps
    server_port = 7000
    [smtp]
    type = tcp
    local_ip = 127.0.0.1
    local_port = 25
    remote_port = 9999  /*大于1000的端口不冲突的都可以*/
    [web1]
    type = http
    local_ip = 127.0.0.1
    local_port = 8010
    remote_port = 8010
    custom_domains=mail.xxx.com:8010 /*邮件服务器，xxx.com是你的邮件服务器域名*/
    [web2]
    type = http
    local_ip = 127.0.0.1
    local_port = 8000
    remote_port = 8000
    custom_domains=mail.xxx.com:8000
  5. 启动服务端，调试完成后可以nohup ./frpc -c frpc.ini & 后台运行.
        ./frpc -c frpc.ini
6.这时候我们已经可以通过vps的IP去访问邮件服务器了，可以尝试VPSIP:8000/8010，测试访问,可以直接登陆进去给自己的qq邮箱发邮件测试一下，域名做dns解析后，访问的时候便可以用域名访问。接下来我们就需要配置gophish了，配置前我先简介一下涉及到的功能模块。
  1. 我们先看发送配置，一些重要的点：from中：”别名[PI:EMAIL](mailto:PI:EMAIL)“写法是带别名的写法，X-mailer 是发送端名字，改一下可能会绕过一些拦截规则，host便是邮件服务器映射的服务器和端口，如果dns解析了也可以写smtp.xxx.com：端口。  
 8\.
配置完可以点左下角测试发送邮件。然后我们来配置一下文案，有一些需要注意的点 ：
{{.URL}}可以自动替换为钓鱼链接。打对勾处会自动添加一个图片，当打开邮件时候会自动加载图片用以反馈邮件状态，outlook禁止图片加载，可能会影响数据读取。需要做超链接的话，可以在其他邮件客户端设置一个包含超链接的邮件，再导入gophish，平台会自动把超链接转换为钓鱼网页，导入方法：把导出的eml文件以文本打开，复制文本到ImportEmail，之后想修改文案的话，在HTML模式下修改即可
## 2.mip22与gophish
  1. mip22功能刚刚简单介绍了，我主要是用它自带的网页，减少工作量，生成网页之后复制链接到gophish这里直接克隆一下，如图
  2. 克隆好之后会出现在你的html框中，然后自定义改一些格式还有css，加一些表单也都可以，我这里不演示了，我们可以通过点击source来查看修改后的页面，这两个框记得打对勾，分别是抓取数据和抓取密码，这些抓取的数据最终都会出现在数据面板中
## 3.整合利用
  1. 事已至此，我们只差小白兔来上钩了，新建组，在组中添加小白兔邮箱，它自带导入模板，如果数量大，可以用导入。
  2. 一切准备好，我们便可以钓鱼了，新建事件，配置一下我们的参数就启动吧，图中少写一个字，什么时候发送完。不想截图改了，手动狗头。  
## 4.猎杀时刻
  1. 一个字，等。gophish在发送邮件时候，会给每一个邮箱用户启一个rid，rid是唯一的，所以谁点击，谁上传，都可以追踪到，最后锁定到安全意识差的小白兔身上。  
* * *
# 总结
还是有点问题没考虑好，就是发送邮件时候，没考虑拦截机制，解决办法，邮件服务器映射IP还有邮箱名多换几个，发送数量匀一下，发送速度调慢，gophish在新建事件时候配合send
email by，发快了容易被拦截。
* * *
# 声明
仅作技术交流，请勿用于非法用途。