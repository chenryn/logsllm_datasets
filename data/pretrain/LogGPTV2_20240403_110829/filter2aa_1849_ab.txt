0D
01 0D
6D
DG14
EF.DG14
0E
01 0E
6E
DG15
EF.DG15
0F
01 0F
6F
DG16
EF.DG16
10
01 10
70
Document Security Object
EF.SOD
1D
01 1D
77
Common
EF.CARDACCESS
1C
01 1C
Common
EF.ATR/INFO
01
2F 01
Common
EF.CardSecurity
1D
01 1D
è¯»å– EF.CardAccess
â€¢ [30 0d [06 08 04 00 7f 00 07 02 02 02] [02 01 02]] 
â€¢ [30 0f  [06 0a  04 00 7f 00 07 02 02 03 02 02] [02 01 02]] 
â€¢ [30 12 [06 0a 04 00 7f 00 07 02 02 04 02 04] [02 01 02] 
[02 01 12]] 
â€¢ [30 17 [06 06 67 81 08 01 01 05] [02 01 01] [06 0a 04 00 
7f 00 07 01 01 04 01 03]] 
â€¢ [30 19 [06 09 04 00 7f 00 07 02 02 03 02] [30 0c [06 07 04 
00 7f 00 07 01 02] [02 01 12]] 
â€¢ 90 00
Type
Tag encoding
Boolean
0x01
Integer
0x02
Bitstring
0x03
Octetstring
0x04
Null
0x05
Object identifier
0x06
Sequence
0x30
Sequence of
0x30
Set
0x31
Set of
0x31
UTCTime
0x17
id-PACE-ECDH-GM-AES-CBC-CMAC-256
v2
p521
id-TA
v2
id-CA-ECDH-AES-CBC-CMAC-128
Active Authentication protocol
id-CA-ECDH
bsiEcKeyType
ecdsa-plain-SHA256
OID Repository
27
28
Learning from JMRTD
ä» JMRTD ä¸­å­¦ä¹ 
30
Authentication Process
é‰´åˆ«ç¨‹åº
31
Read EF.CardAccess (Required)
è¯»å– EF.CardAccess (å¿…è¦)
Read EF.DIR (Optional)
è¯»å– EF.DIR (éå¿…è¦)
Authenticate with PACE
ä½¿ç”¨ PACE è¿›è¡Œé‰´åˆ«
Authenticate with BAC
ä½¿ç”¨ BAC è¿›è¡Œé‰´åˆ«
Starting 1 January 2018, eMRTD chips implementing PACE only
2018/1/1 åçš„ eMRTD æ™¶ç‰‡åªå®ä½œ PACE
32
Process of BAC
BAC çš„è¿ä½œç¨‹åº
IFD
IC
1. Get Challenge
2. RND.IC
RND.IFD and K.IFD
S = RND.IFD || RND.IC || K.IFD
EIFD = E(KEnc, S)
MIFD = MAC(KMAC, EIFD)
3. External Authenticate
K.IC
R = RND.IC || RND.IFD || K.IC
EIC = E(KEnc, R).
MIC = MAC(KMAC, EIC).
EIC || MIC.
KSEnc and KSMAC
KS.SEED = K.IFD XOR K.IC
EIFD || MIFD
EIC || MIC
4. Communicate with Session Key
The biggest issue of BAC is 
using 3DES?
BAC æœ€å¤§çš„é—®é¢˜åº”è¯¥æ˜¯ç”¨
3DES åŠ å¯†?
Process of PACE GM
PACE GM çš„è¿ä½œç¨‹åº
34
IFD
IC
PACEInfo has been obtained
ä¹‹å‰å·²å–å¾— PACE å‚æ•°
MSE:AT Set Parameter
è®¾å®šå‚æ•°
Get a Encrypted Nonce
å–å¾—åŠ å¯†ä¹±æ•°
Nonce Generation
äº§ç”Ÿä¹±æ•°
Generate temporary keys 
for mapping
äº§ç”Ÿæš‚æ—¶æ˜ å°„ç”¨é‡‘é’¥
Exchange Generated Public Keys
äº¤æ¢äº§ç”Ÿçš„å…¬å¼€é‡‘é’¥
Generate keys for key 
agreement with nonce
äº§ç”Ÿäº§ç”Ÿåè®®é‡‘é’¥ç”¨é‡‘é’¥
Generate keys for key 
agreement with nonce
äº§ç”Ÿäº§ç”Ÿåè®®é‡‘é’¥ç”¨é‡‘é’¥
Exchange Generated Public Keys
äº¤æ¢äº§ç”Ÿçš„å…¬å¼€é‡‘é’¥
Generate temporary keys 
for mapping
äº§ç”Ÿæš‚æ—¶æ˜ å°„ç”¨é‡‘é’¥
Generate Agreement Key 
and Token
äº§ç”Ÿåè®®é‡‘é’¥ä¸ Token
Generate Agreement Key 
and Token
äº§ç”Ÿåè®®é‡‘é’¥ä¸ Token
Token Exchange
äº¤æ¢ Token
35
Password
Encoding
MRZ
SHA-1(DOC Number || DoB || DoE)
CAN
ISO 8859-1 Encoded String
KDFâˆ(f(âˆ),3)
z = E (Kâˆ,RND.IC)
IC
IPS
z
RND.IC = D (Kâˆ, z)
D = Map(DIC, RND.IC, â€¦.)
D = Map(DIC, RND.IC, â€¦.)
Choose (SKDH,IPS, PKDH,IPS)
Based on D
Choose (SKDH,IC, PKDH,IC)
Based on D
PKDH,IC
PKDH,IPS
K=KA(PKDH,IC, SKDH,IPS)
K=KA(SKDH,IC, PKDH,IPS)
Generate KSEnc, KSMAC
Generate KSEnc, KSMAC
TIC = MAC(KSMAC, PKDH,IPS)
[AIC = E(KSENC, CAIC)]
TIPS = MAC(KSMAC, PKDH,IC)
TIC [,AIC]
TIPS
[PKDH,IC ?= KA(CAIC, PKIC, D)]
36
DG11
â€¢ 6B70[5F040BE69FB3F0A98D9CF0A795A6][5F0500][5F060B[4C49552C44554F2D54554F]][5F070
A53323330383932373338][5F08083139363731313231][5F090130][5F0A09415430303030303035]
[5F0B083230333031303135][5F0C083230323031303135][5F0D103130303039303139353231303
0323339]000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000009000
37
LIU,DUO-TUO
S230892738
19671121
AT0000005
20301015
20201015
1000901952100239
DG12
â€¢ 6C3D[5F0E0120][5F0F36E696B0E58C97E5B882E7919EE88AB3E58D80E9BE8DE5B1B1E9878C
303130E984B0E980A2E794B2E8B7AFEFBC92EFBC98EFBC90E8999F]00000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000009000
38
æ–°åŒ—å¸‚ç‘èŠ³åŒºé¾™å±±é‡Œ010é‚»é€¢ç”²è·¯ï¼’ï¼˜ï¼å·
IFD
Select Card Application
é€‰å–å¡ç‰‡åº”ç”¨ç¨‹å¼
Set Parameter
è®¾å®šå‚æ•°
PACE
Active Authentication
ä¸»åŠ¨é‰´åˆ«
Data Access
è¯»å–èµ„æ–™
IFD
Select Card Application
é€‰å–å¡ç‰‡åº”ç”¨ç¨‹å¼
Set Parameter
è®¾å®šå‚æ•°
PACE
Chip Authentication
æ™¶ç‰‡é‰´åˆ«
Terminal Authentication
è¿›è¡Œ TA é‰´åˆ«è¯»å¡è£…ç½®
Data Access
é€‰å–ä¸è¯»å–èµ„æ–™
From Accessing Public Data Zone to Encrypted Data Zone
ä»å…¬å¼€åŒºåˆ°åŠ å¯†åŒº
Chip Authentication Process
CA è®¤è¯ç¨‹åº
40
IC
IPS
DIC, SKIC, PKIC
TIC, rIC
DIC, PKIC
à·«
SKIPS
CA , à·«
ğ‘ƒKIPS
CA
K=KA( à·«
SKIPS
CA , PKIC, DIC)
à·«
ğ‘ƒKIPS
CA
K=KA(SKIC, à·«
ğ‘ƒKIPS
CA , DIC)
rIC
TIC=MAC(KMAC, à·«
ğ‘ƒKIPS
CA )
Terminal Authentication Process
TA è®¤è¯ç¨‹åº
41
IC
IPS
Choose rIC randomly
éšæœºé€‰æ‹© rIC
rIC
sIPS = Sign(SKIPS,IDICâˆ£âˆ£rICâˆ£âˆ£
Comp(PKIPS)) 
sIPS
Signature Verification
éªŒè¯ç­¾ç« 
42
MSE AT: Set Parameter
(MANAGE SECURITY ENVIRONMENT command with Set 
Authentication Template function)
00 22 c1 a4 27
80 0a 04 00 7f 00 07 02 02 04 02 04
83 01 03
7f 4c 12 06 09 04 00 7f 00 07 03 01 02
02 53 05 00 00 00 60 00
84 01 12
PACE
Read Certificate from EF.CardSecurity
Send DV and AT Cert to Card
Set MSE:SET AT External Authentication
OID || Holder for AT ||
Temporary Public Key
Get Challenge
External Authentication
Sign (Temporary IC Public Key in
PACE process || challenge ||
Temporary Public Key)
43
Certified Host
è®¤å¯å•ä½
EID Center
EID ä¸­å¿ƒ
DV å‡­è¯ä¸ AT å‡­è¯
[0]   Version: 3
SerialNumber: 28156782072750167572079822468317946189
IssuerDN: C=TW,O=è¡Œæ”¿é™¢,OU=å†…æ”¿éƒ¨,OU=æˆ·æ”¿å¸,CN=CSCA
Start Date: Fri Sep 25 11:37:12 CST 2020
Final Date: Tue Mar 25 23:59:59 CST 2031
SubjectDN: C=TW,O=è¡Œæ”¿é™¢,OU=å†…æ”¿éƒ¨,OU=æˆ·æ”¿å¸,CN=DS202009250001
Public Key: EC Public Key [c6:7c:fb:e1:c8:4f:e3:4a:4d:23:2a:ab:2e:06:57:77:5e:27:d6:b4]
X: 7db0dd8864840f9856c957715162c28c346c936cc92fdff9c1ffb110c09dac3e7ae067ba4a0b8e93bd86451b860377b85d67da133ee5d10bafaa7068dc88c76056
Y: 96139cc7cfe114c851e96b0d03b851fd16d19b5d61e3cbccf7a135f69e047f7765771600bc6afc633bb17aa8953a7a4ea8cfe22a3b179b8b1b66f8b1340b7d97dd
Signature Algorithm: SHA256withECDSA
Signature: 308188024201cce9925eccee1a00ba46625a6c13c0a70c3dc9bb368253c6917c3f399bc4c20087e0f3f1595ae193ee474cafebc386f8a40aa5040103
2060314d2b400ed66b20ad0242008800e154df65aeb9bae33d7bb45f1fd6800a8e335c2a21eba5ae033c56f06e29384ac5308654ca0fbd98b19e5e29
cdace675d157c66e09a49fa69b5be91d2b3f25
Extensions: 
critical(false) 2.5.29.16 value = Sequence