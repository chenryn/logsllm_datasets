0D
01 0D
6D
DG14
EF.DG14
0E
01 0E
6E
DG15
EF.DG15
0F
01 0F
6F
DG16
EF.DG16
10
01 10
70
Document Security Object
EF.SOD
1D
01 1D
77
Common
EF.CARDACCESS
1C
01 1C
Common
EF.ATR/INFO
01
2F 01
Common
EF.CardSecurity
1D
01 1D
读取 EF.CardAccess
• [30 0d [06 08 04 00 7f 00 07 02 02 02] [02 01 02]] 
• [30 0f  [06 0a  04 00 7f 00 07 02 02 03 02 02] [02 01 02]] 
• [30 12 [06 0a 04 00 7f 00 07 02 02 04 02 04] [02 01 02] 
[02 01 12]] 
• [30 17 [06 06 67 81 08 01 01 05] [02 01 01] [06 0a 04 00 
7f 00 07 01 01 04 01 03]] 
• [30 19 [06 09 04 00 7f 00 07 02 02 03 02] [30 0c [06 07 04 
00 7f 00 07 01 02] [02 01 12]] 
• 90 00
Type
Tag encoding
Boolean
0x01
Integer
0x02
Bitstring
0x03
Octetstring
0x04
Null
0x05
Object identifier
0x06
Sequence
0x30
Sequence of
0x30
Set
0x31
Set of
0x31
UTCTime
0x17
id-PACE-ECDH-GM-AES-CBC-CMAC-256
v2
p521
id-TA
v2
id-CA-ECDH-AES-CBC-CMAC-128
Active Authentication protocol
id-CA-ECDH
bsiEcKeyType
ecdsa-plain-SHA256
OID Repository
27
28
Learning from JMRTD
从 JMRTD 中学习
30
Authentication Process
鉴别程序
31
Read EF.CardAccess (Required)
读取 EF.CardAccess (必要)
Read EF.DIR (Optional)
读取 EF.DIR (非必要)
Authenticate with PACE
使用 PACE 进行鉴别
Authenticate with BAC
使用 BAC 进行鉴别
Starting 1 January 2018, eMRTD chips implementing PACE only
2018/1/1 后的 eMRTD 晶片只实作 PACE
32
Process of BAC
BAC 的运作程序
IFD
IC
1. Get Challenge
2. RND.IC
RND.IFD and K.IFD
S = RND.IFD || RND.IC || K.IFD
EIFD = E(KEnc, S)
MIFD = MAC(KMAC, EIFD)
3. External Authenticate
K.IC
R = RND.IC || RND.IFD || K.IC
EIC = E(KEnc, R).
MIC = MAC(KMAC, EIC).
EIC || MIC.
KSEnc and KSMAC
KS.SEED = K.IFD XOR K.IC
EIFD || MIFD
EIC || MIC
4. Communicate with Session Key
The biggest issue of BAC is 
using 3DES?
BAC 最大的问题应该是用
3DES 加密?
Process of PACE GM
PACE GM 的运作程序
34
IFD
IC
PACEInfo has been obtained
之前已取得 PACE 参数
MSE:AT Set Parameter
设定参数
Get a Encrypted Nonce
取得加密乱数
Nonce Generation
产生乱数
Generate temporary keys 
for mapping
产生暂时映射用金钥
Exchange Generated Public Keys
交换产生的公开金钥
Generate keys for key 
agreement with nonce
产生产生协议金钥用金钥
Generate keys for key 
agreement with nonce
产生产生协议金钥用金钥
Exchange Generated Public Keys
交换产生的公开金钥
Generate temporary keys 
for mapping
产生暂时映射用金钥
Generate Agreement Key 
and Token
产生协议金钥与 Token
Generate Agreement Key 
and Token
产生协议金钥与 Token
Token Exchange
交换 Token
35
Password
Encoding
MRZ
SHA-1(DOC Number || DoB || DoE)
CAN
ISO 8859-1 Encoded String
KDF∏(f(∏),3)
z = E (K∏,RND.IC)
IC
IPS
z
RND.IC = D (K∏, z)
D = Map(DIC, RND.IC, ….)
D = Map(DIC, RND.IC, ….)
Choose (SKDH,IPS, PKDH,IPS)
Based on D
Choose (SKDH,IC, PKDH,IC)
Based on D
PKDH,IC
PKDH,IPS
K=KA(PKDH,IC, SKDH,IPS)
K=KA(SKDH,IC, PKDH,IPS)
Generate KSEnc, KSMAC
Generate KSEnc, KSMAC
TIC = MAC(KSMAC, PKDH,IPS)
[AIC = E(KSENC, CAIC)]
TIPS = MAC(KSMAC, PKDH,IC)
TIC [,AIC]
TIPS
[PKDH,IC ?= KA(CAIC, PKIC, D)]
36
DG11
• 6B70[5F040BE69FB3F0A98D9CF0A795A6][5F0500][5F060B[4C49552C44554F2D54554F]][5F070
A53323330383932373338][5F08083139363731313231][5F090130][5F0A09415430303030303035]
[5F0B083230333031303135][5F0C083230323031303135][5F0D103130303039303139353231303
0323339]000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000009000
37
LIU,DUO-TUO
S230892738
19671121
AT0000005
20301015
20201015
1000901952100239
DG12
• 6C3D[5F0E0120][5F0F36E696B0E58C97E5B882E7919EE88AB3E58D80E9BE8DE5B1B1E9878C
303130E984B0E980A2E794B2E8B7AFEFBC92EFBC98EFBC90E8999F]00000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000009000
38
新北市瑞芳区龙山里010邻逢甲路２８０号
IFD
Select Card Application
选取卡片应用程式
Set Parameter
设定参数
PACE
Active Authentication
主动鉴别
Data Access
读取资料
IFD
Select Card Application
选取卡片应用程式
Set Parameter
设定参数
PACE
Chip Authentication
晶片鉴别
Terminal Authentication
进行 TA 鉴别读卡装置
Data Access
选取与读取资料
From Accessing Public Data Zone to Encrypted Data Zone
从公开区到加密区
Chip Authentication Process
CA 认证程序
40
IC
IPS
DIC, SKIC, PKIC
TIC, rIC
DIC, PKIC
෫
SKIPS
CA , ෫
𝑃KIPS
CA
K=KA( ෫
SKIPS
CA , PKIC, DIC)
෫
𝑃KIPS
CA
K=KA(SKIC, ෫
𝑃KIPS
CA , DIC)
rIC
TIC=MAC(KMAC, ෫
𝑃KIPS
CA )
Terminal Authentication Process
TA 认证程序
41
IC
IPS
Choose rIC randomly
随机选择 rIC
rIC
sIPS = Sign(SKIPS,IDIC∣∣rIC∣∣
Comp(PKIPS)) 
sIPS
Signature Verification
验证签章
42
MSE AT: Set Parameter
(MANAGE SECURITY ENVIRONMENT command with Set 
Authentication Template function)
00 22 c1 a4 27
80 0a 04 00 7f 00 07 02 02 04 02 04
83 01 03
7f 4c 12 06 09 04 00 7f 00 07 03 01 02
02 53 05 00 00 00 60 00
84 01 12
PACE
Read Certificate from EF.CardSecurity
Send DV and AT Cert to Card
Set MSE:SET AT External Authentication
OID || Holder for AT ||
Temporary Public Key
Get Challenge
External Authentication
Sign (Temporary IC Public Key in
PACE process || challenge ||
Temporary Public Key)
43
Certified Host
认可单位
EID Center
EID 中心
DV 凭证与 AT 凭证
[0]   Version: 3
SerialNumber: 28156782072750167572079822468317946189
IssuerDN: C=TW,O=行政院,OU=内政部,OU=户政司,CN=CSCA
Start Date: Fri Sep 25 11:37:12 CST 2020
Final Date: Tue Mar 25 23:59:59 CST 2031
SubjectDN: C=TW,O=行政院,OU=内政部,OU=户政司,CN=DS202009250001
Public Key: EC Public Key [c6:7c:fb:e1:c8:4f:e3:4a:4d:23:2a:ab:2e:06:57:77:5e:27:d6:b4]
X: 7db0dd8864840f9856c957715162c28c346c936cc92fdff9c1ffb110c09dac3e7ae067ba4a0b8e93bd86451b860377b85d67da133ee5d10bafaa7068dc88c76056
Y: 96139cc7cfe114c851e96b0d03b851fd16d19b5d61e3cbccf7a135f69e047f7765771600bc6afc633bb17aa8953a7a4ea8cfe22a3b179b8b1b66f8b1340b7d97dd
Signature Algorithm: SHA256withECDSA
Signature: 308188024201cce9925eccee1a00ba46625a6c13c0a70c3dc9bb368253c6917c3f399bc4c20087e0f3f1595ae193ee474cafebc386f8a40aa5040103
2060314d2b400ed66b20ad0242008800e154df65aeb9bae33d7bb45f1fd6800a8e335c2a21eba5ae033c56f06e29384ac5308654ca0fbd98b19e5e29
cdace675d157c66e09a49fa69b5be91d2b3f25
Extensions: 
critical(false) 2.5.29.16 value = Sequence