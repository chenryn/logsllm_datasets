法简介”部分。
4.3 字段操作
日志格式化处理之后才会进行存储，且日志搜索也是基于处理之后的日志进行的。日志被
格式化处理成什么样子了呢？
点击日志条目前的小三角，可以查看日志被解析之后的形态。
日志被解析之后，会呈现下面的样子。可以看出，日志被解析成了一个个的字段及字段值
的形式。字段也对应了日志解析之后的存储格式。
43
日志学院
我们可以通过日志易产品“选定字段”功能，点击对应的字段，选择相关操作，以实现日
志处理。
选择“最大值”，即可求出该日志中磁盘使用率的最大值。
44
日志学院
4.4 制作一个分析图形
在得到搜索结果之后，我们可以基于某一字段值绘制一个简单的展示图形，以便更直观地
对日志进行分析展示。
点击搜索结果框处的“统计”，可以看到日志易绘图界面。选择想要展示的内容，简单点
击即可绘制出一个展示图形。
如将inode号的剩余情况展示出来，可选择“数值分段”， 选择字段值为
“json.disk.inodes_free”。假设inode数量低于20000应快速处理，inodes数量低于
200000应引起注意，则可将数值分段分别设为0-20000，20000-200000，200000-
200000000（一个较大数值即可），点击“生成”，即可生成inode剩余数量的区间图。
从上图可知，该Linux主机某些磁盘的inode数量虽然近期没有需要处理的状况，但也应
引起注意了。
注：实际生产环境中，inode数量的分析还应结合具体情况。如数据存储文件夹，inode数
量应给到足够大，但不常用的文件夹，inode数量够用即可。
45
日志学院
思考：你能看出下面的图形有什么用吗？
4.5 制作一个仪表盘
4.5.1 保存趋势图
如果我们想将刚刚做好的图形保存下来，以便今后时时查看。我们可以点击上图的“保存
为”按钮，选择“趋势图”。
46
日志学院
在弹出的页面中添加名称、描述信息，选择分组，点击“确定”。这样趋势图就添加成功
了。
点击日志易顶部菜单中的“趋势图”，可以看到我们曾添加过的所有图表。
4.5.2 创建仪表盘
当我们点进趋势图后，可以看到我们添加过的图表信息，但却不能直接看到图表的展示情
况。这是因为趋势图仅保存了图表的数据过滤配置及展现规则，而系统需要根据这些规则
获取数据并将其转化成图表进行展示。
日志易的仪表盘可根据趋势图中定义的规则，实时获取数据并将其进行展示。点击日志易
顶部菜单栏中的“仪表盘”按钮可进入仪表盘配置页。在弹出的页面中添加名称，选择分
组，点击“确定”，一个仪表盘就算创建成功了。但这个时候，仪表盘还是空的。
点击仪表盘名称，系统会提示我们新建标签页。创建一个标签页后，我们就可以在这里添
加图表了。
点击右上方的“添加”按钮，选择“添加图表”，勾选保存的趋势图，点击“确认”即
可。
47
日志学院
这样，一个简单的仪表盘就算完成了。
仪表盘添加时，图表的高度是默认的，可按住鼠标左键拖动仪表盘，调整图表高度到一个
合适值（使y轴的区间更加直观形象）。
48
日志学院
4.6 仪表盘上的基本操作
4.6.1 时间控制
生成仪表盘以后，图表的数据显示仅仅是趋势图所设置的数据。在前面的图表中，我们的
趋势图定义好了时间范围，而当我们的时间范围发生变化，每天都有新的数据导入的话，
能否像数据搜索时一样，对仪表盘获取数据的时间范围进行设置呢？
1. 我们可以通过日志易自带的过滤按钮来控制标签页内所有图表的时间范围，做统一处
理。
49
日志学院
如当我们指定时间范围为“10分钟”时，该仪表盘标签页内的所有图表的时间范围都
为最近10分钟，图表会从最近10分钟采集的日志中执行定义好的过滤及处理规则。
2. 也可以单独指定某个图表的查询时间范围，图表框内附带的工具栏提供针对该图表时
间控制功能，如下图:
4.6.2 图表配置
生成仪表盘之后，我们是否还能对仪表盘的各种配置项及参数进行修改呢？答案是肯定
的。
仪表盘可通过各图表内部的设置按钮，对数据查询指令与可视化图表的类型及配置参数进
行修改，如下图。
50
日志学院
在通用配置中，可以通过修改这些配置信息调整图表的标题、查询语句、时间范围、日志
来源等信息。
从图中可以看到，我们点击生成的趋势图已经由系统自动处理成了一个查询语句。可以修
改这个查询语句从而调整图表的显示效果，那么如何修改这个语句以实现更多样化的图表
展示呢？这个我们会在《简单日志分析》章节简要介绍。
4.6.3 仪表盘其他配置
仪表盘右上方的菜单栏除了过滤按钮外，还有一排其他按钮，通过这些按钮我们可以调整
仪表盘显示效果。
1. 仪表盘默认显示为“白天模式”，我们可以通过下面的按钮将其调整为“夜间模
式”。
2. 此外，仪表盘还能进行全屏展示、定时刷新，通过这些按钮，我们还可以进行仪表盘
内图表的增删改查，或将仪表盘上的图表一键存为报表。
本章我们简单了解了日志搜索及分析的一些用法。我们现在是否就能开始日志分析了呢？
一些细心的同学可能会有下面的疑问：
l 为什么日志默认搜索时间为最近十分钟？
51
日志学院
l 日志分析的目的主要是故障排查和业务分析，通过关键字全文搜索可快速定位故障
点。那么，业务分析应该如何来做？
l 仪表盘时间控制、定时刷新功能有必要吗？
4.7 报表发送
如果想不进入日志易界面就能接收已配置好的趋势图，可以使用日志易的报表功能制作报
表。通过报表可定时推送某些趋势图到指定邮箱。
由于报表的元素是趋势图，报表的制作又可分以下步骤：
1、趋势图保存：同上面3.5部分趋势图的保存。
2、新建报表：从导航栏的“报表”标签进入报表的列表页面，并点击右上角的“新建”
按钮。
3、报表配置：依次配置好报表参数。如下图所示，注意邮件主题按照提示格式填写；在
“执行计划”处填入参数，对邮件的发送频率进行配置。
4、添加趋势图：点击下一步，选择加入报表的趋势图。如果报表是PDF类型，还可以选
择每页内容的趋势图布局安排。
52
日志学院
5、保存报表：点击保存，即完成报表制作。该邮箱会在设定时间收到日志易发送的报表
邮件，报表会以PDF格式加在附件中。
6、查看已生成报表：日志易支持界面查询完整的报表生成历史，点击右上角按钮“已生
成报表”打开记录页面。点击文件名，还可以下载单次报表生成的PDF结果到本地。
7、报表列表：在列表页，您不仅可以更改设置信息，也可以直接删除报表。若您不想要
再接受相关邮件，可在列表页将对应报表开关关闭即可。
若想了解更多关于报表的配置内容，可参考《日志易使用手册》第5章节的报表部分。
发件邮箱设置
设置发件邮箱设置较为简单：选择“系统”下的“系统配置”，进行各项邮箱相关的配置
即可。
以腾讯企业邮箱设置为例，该发件邮箱配置如下所示：
53
日志学院
本章习题：
1、针对以上上传的日志，还能做出哪些分析图表？请做出3个以上的图表，将其添加到
仪表盘中。
2、说明上题做出的各个图表的含义。
思考：
如果这些数据是实时的，利用这些数据能够实现什么效果？
54
日志学院
五、权限管理
以上操作我们都是使用admin用户执行的。然而，admin的权限较大，使用风险也较大。
出于企业安全管理的考虑，有时候我们需要对用户的权限进行系统管理。
如何授权某用户权限，使该用户能够查看我们上面创建的所有内容呢？
5.1 权限管理说明
首先，这个用户要能够登陆我们的系统。
其次，用户要有能够访问我们所创建的以上内容（日志易中称之为“资源”）的权限。
与一项业务系统相关的资源即资源分组。资料创建时，往往通过资源分组同时创建一组资
源。
在我们创建的这组资源中，除了“仪表盘”、“趋势图”、“搜索”外，日志易顶部导航
栏还有“定时任务”、“监控”、“报表”、“知识”等资源，如果我们仅想要该用户查
看我们刚刚创建的“仪表盘”、“趋势图”以及刚刚上传的日志，而不想让他看到其他的
内容，那我们该怎么做呢？
其实，这需要权限精细化管理。将访问一项资源的权限称之为一个权限的话，用户访问
“仪表盘”、“趋势图”，就需要两个权限。有时用户还需要更多权限，在日志易系统
中，我们将这些权限的集合称之为“角色”。
Linux中会直接将一组权限（如读写权限）授权给用户，而这有时会导致普通用户权限过
大，从而造成系统的安全隐患。日志易的使用人员主要是企业级用户，相同部门的人员需
要的权限往往相同，同时出于企业数据安全考虑，权限不会直接授权于用户，而是通过用
户分组的方式赋予，同一个用户分组内的用户的权限相同。
55
日志学院
有时，一个企业的不同部门所涉及的业务不同，他们所能查看的日志范围也不相同。如运
维人员需要查看系统运维日志，研发人员需要查看软件的运行日志，二者日志查看的范围
不能交叉，这时，还需要通过设置日志来源对二者能够查看日志的范围进行区分。
日志来源可以理解为多种类型的日志的集合。区分日志来源主要借助日志入库时的标签，
即appname、tag、ip、hostname等。
当我们前面使用“本地上传”上传日志时，我们指定了日志的appname和tag。而当日志
量过大时，日志采集器较多时，我们还需要使用hostname来识别日志来源。上面使用
“本地上传”时，该日志的hostname自动识别成了我们访问该日志易系统所使用的IP地
址。
56
日志学院
5.2 权限管理流程
在创建用户，并对用户赋予权限时，一般可按以下流程进行操作：
1、 创建日志来源：首先确定该用户所能查看的日志范围，根据tag和appname限定该日
志来源内的日志类型；
2、 创建角色并授权：即限定该用户的权限范围，角色是一组权限的集合，可以在创建角
色时同时创建该角色对应的专属资源组。专属资源组包括仪表盘、监控、报表、日志
来源等资源组，通过对这些资源组授于不同权限可达到限定权限的目的；
3、 创建用户分组：即创建好用户所属的用户分组，并指定用户分组的权限大小，即将用
户分组与角色绑定；
4、 创建用户：需要设置用户名、邮箱、密码，并指定用户分组；
5、 登录测试。
5.3 权限管理实战
规划
在开始我们的授权实战之前，将我们所需要设置的信息进行一个规划，这会让我们后续的
操作事半功倍。
角色 用户分组 用户 日志来源 appname tag
tmprole tmpgroup tmp1 tmplog topinfo test
57
日志学院
创建日志来源
1、设置 à 数据（日志来源）à 新建；
2、创建tmplog时，填写appname及log（或hostname）。
创建角色并授权
1、设置 --> 权限（角色权限）--> 新建；
58
日志学院
2、创建tmprole时，同时创建对应的专属资源组（即tmprole包含哪些资源，这里可以全
部勾选，授权时具体赋予各资源的权限即可）；
59
日志学院
3、资源分组授权：角色创建成功后，点击授权，可看到各种资源分组的授权列表：
每一类资源共有八个可选权限：新建资源组、分组管理读取、分组管理编辑、分组管理删
除、资源管理读取、资源管理分配、资源管理更新（除用户分组外的权限）、资源管理删
除。
一般情况下，资源权限保持默认即可。如果想让tmprole下属的用户组拥有名副其实的只
读权限，可以在这里修改资源分组的权限，只保留分组读取和资源读取两项。
“功能”可赋予用户一些特殊权限，一般情况下，普通用户勾选可使用离线任务、可导入
导出日志来源树状结构、可使用告警分析、可使用模式学习、可使用资源包导入导出、可
使用结算管理、可下载搜索结果即可。
“URL访问”权限可以控制用户具体能访问哪些功能入口。用户无权访问的功能入口，会
直接在日志易菜单栏上消失，最低权限下，用户只能看到自己的“个人设置”页面。一般
情况下，授予授予角色URL访问权限可以除资源分组、角色权限、用户分组、用户管理、
日志来源、路由配置、系统配置之外全选。如果我们只想让tmprole下属的用户组只能看