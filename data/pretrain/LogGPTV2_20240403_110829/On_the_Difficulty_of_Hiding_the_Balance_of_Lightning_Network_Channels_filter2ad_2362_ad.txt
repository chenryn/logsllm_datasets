ing functionality, able to mask capacity and throughput of the nodes
with either discrete and continuous time constraints. We shall also
make sure that the addition and subtraction of masking resources
holds the minimal possible impact to the payment network, e.g.,
in terms of service disruption. Of course, this solution will require
an important effort for its implementation in current payment net-
works such as the Lightning Network. It might require to redesign
how payment networks work and provide means to allow the ab-
sorption of negative balances somehow by interested parties. A
more straightforward approach could be the use of private chan-
nels between nodes (channels not announced to the whole network)
that allow for such negative balance to be privately compensated.
6 RELATED WORK
There are a number of studies that investigate adversarial issues,
in terms of privacy and information disclosure, in current cryp-
tocurrencies and routing literature. We survey next some examples,
structuring the existing work in such two main research lines.
In terms of blockchain analysis, and since any blockchain in-
cludes, by definition, all the transactions performed by the system,
deanonymization may take advantage of such information. A sim-
ple analysis of the blockchain may provide information such as from
which Bitcoin addresses the money comes from, and to which Bitcoin
addresses it goes to [29]. Since users in the Bitcoin ecosystem can cre-
ate any number of addresses, a more powerful tool to deanonymize
transactions is to cluster all addresses in the blockchain that be-
long to the same user. Different proposals exist to conduct address
analysis, such as clustering and similar techniques [2, 22, 30, 34].
From shadow address analysis to multiple input clustering and
also behavior-based clustering techniques like k-means and Hi-
erarchical Agglomerative Clustering can be used to enhance the
cluster creation. Once the clustering set for one user is large enough,
deanonymization becomes possible by using external information
on Bitcoin addresses (e.g., posts, forums, markets, and market ex-
changes) that could identify at least one of the addresses.
With regard to traffic analysis, we recall that transactions in Bit-
coin are transmitted through a P2P network [12]. Hence, metadata
such as TCP or IP headers, which can be obtained by using tradi-
tional network analysis tools, can also be used as an underlying base
for novel deanonymization tools [20]. Transaction eavesdropping
can be performed to, e.g., discovering the IP addresses correspond-
ing to those nodes that are broadcasting a transaction for the first
time. To match an IP address with a Bitcoin address, the problem
can be modeled as an evaluation of association rules, identifying
the corresponding confidence scores and the support counts for
the rule. Deanonymization of Bitcoin transactions can also benefit
from the existence of Bitcoin sessions, initiated by nodes that get
unreachable after a given period of time [21], e.g., nodes that are
hidden behind NAT (Network Address Translation) and TOR (The
Onion Router) connections, by identifying transaction patterns via
fingerprinting techniques to characterize and highlight weaknesses
in terms of pseudonymity models for Bitcoin users.
6.1 Cryptocurrencies Literature
Traditionally, anonymity in Bitcoin-like cryptocurrencies relies
on pseudonymity, i.e., users creating any number of anonymous
account addresses that are used later on, to identify the transactions.
However, an underlying, non-anonymous, Internet infrastructure,
together with the availability of transactions meta-data stored in
a blockchain, allows the development of deanonymization tools.
We follow four main recent literature classifications [10, 17]: (1)
blockchain analysis, (2) network monitoring, (3) attacks to mixing
protocols, and (4) balance disclosure.
Mixing protocol attacks exist in the literature [6, 7, 23, 25]. Mix-
ing protocols are tools designed to enhance the anonymity of Bit-
coin transactions by, e.g., shuffling the information in order to
hinder the relation between the input and the output values of the
transactions. Bitcoin users send Bitcoins from one address to a mix
service and receive from the mix service the Bitcoins to another
address that could not be linked with the original one. The effec-
tiveness of such systems has been analyzed by different authors.
They found a clear structure that allow understanding how this
services work and may be used for deanonymization. Modeling and
analysis of the P2P Bitcoin networking stack in term of anonymity
properties, by providing source inference over graphs via epidemic
Session 8: Blockchain SecurityAsiaCCS ’19, July 9–12, 2019, Auckland, New Zealand610source finding [24], has identified that the real Bitcoin P2P network
topology offers a low degree of anonymity [15].
The work in [1] addresses the risk of leakage w.r.t. the currency
balance of Bitcoin addresses and claim the necessity of hiding trans-
action values as well as address balances in Bitcoin, e.g., for those
users who opt-out from exchanging assets. The work builds upon
the assumption that Bitcoin traders may end accepting transactions
immediately without waiting the necessary confirmations. This
exposes them to traditional risks in terms of double spending, even
for clients that are not miners [19]. The feasibility of such kind of
attacks relies on directly broadcasting to the seller double-spending
transactions, but in a different location of the network, within a
similar time window frame. Countermeasures to the attack lead
to new designs in which much more control about the precise bal-
ances of every node in the network is guaranteed. This additional
control has as collateral consequences a higher likelihood in terms
of deanonymization of Bitcoin users. The authors developed ad-
ditional means to address the collateral consequences by hiding
the balance of transactions by moving to alternative cryptocurren-
cies like Zerocash [33], with much stronger privacy guarantees in
terms of anonymity, via zero knowledge proof techniques, while
guaranteeing functionality and efficiency.
Finally, the feasibility of deanonymizing Internet privacy ser-
vices such as Tor, due to leakage information of Bitcoin technologies
has also been discussed in the recent literature. Authors in [18]
provide deanonymization techniques to show that using Bitcoin
as a payment method may leak sensitive information to disclose
Tor hidden services. The techniques rely on the possibility of an
adversary to link those Bitcoin users who publicly share their Bit-
coin addresses on online social networks, with hidden services, and
which publicly share the mapping about their Bitcoin addresses on
their onion landing pages.
6.2 Routing Literature
In the previous section, we have listed existing related work in
cryptocurrencies literature. An increasing number of research work
deals with privacy issues to cryptocurrencies users, such as trace-
ability of both application and network-layer data, and the limi-
tation of mixing services. Beyond the realm of cryptocurrencies,
a large number of existing literature on different areas, from dis-
tributed computing to ad hoc and sensor networking literature,
shows similar issues to those uncovered in this paper. Transaction
meta-data disclosure, e.g., unauthorized reporting of balance ac-
counts on distributed networks, beyond the scope of Bitcoin and
the Lightning Network, deal with similar findings and problems.
Secure routing techniques have been reported vulnerable to similar
adversarial probing attacks. Attacks to routing in ad hoc and sen-
sor networks, like black-holing and vampire-like attacks [36], aim
at draining the battery life of autonomous sensor nodes, to affect
the routing capabilities of the whole system. In such attacks, the
adversary perpetrates similar learning and discovery phases as the
ones discussed in our work, prior to conducting the final attack.
For instance, the adversary conducts a discovery phase to learn
the accumulative energy dynamics of the network, by probing and
estimating the level of available battery on each individual node of
the system. Countermeasures to the attack, like those in [16, 27]
are similar to some of the ideas discussed in Section 5.
Likewise, energy-driven literature on smart-grid and smart-mete-
ring environments share similarities to the issues and solutions dis-
cussed in our work. The privacy-preserving techniques discussed
in [4], related to smart-metering privacy scenarios, show similar
adversaries trying to estimate user energy consumption and billing
functionalities by collectively collecting smart-metering metadata.
Solutions are proposed in order to get adversaries concealed by
new data-processing functionality. The approach relies on the addi-
tion of synthetic computing and storage functionalities, to avoid
fine-grained collection of users’ information. This kind of solutions
can moreover be randomized as the approaches presented in [3, 35].
In the end, the goals is to increase the difficulty of adversarial mon-
itoring tasks, to retrieve information about consumption channels.
Identification and learning techniques by the adversary can still be
put in place, by transforming the process in a two-stage transfor-
mation of data, hence starting with a fine-grained processing; then,
moving to a coarse-grained processing.
7 CONCLUSION
In this paper, we have addressed privacy issues related to the Bit-
coin Lightning Network. Today, to preserve users’ privacy between
two channel payment points of the Bitcoin Lightning Network, the
precise balance (i.e. the bandwidth of the precise channel points, in
each direction), is kept secret. Since the balances are not announced,
second-layer nodes probe routes iteratively, until they find a suc-
cessful route to the destination for the amount required, if any.
Such feature makes the routing discovery protocol less efficient,
but preserves the privacy of channel balances. Publicly disclos-
ing the updated balance of channels each time they are updated
would allow users to efficiently discover routes in the network,
without having to probe a route in order to ensure the channels
do have enough balance to support a payment. However, it would
also allow adversaries to trace payments through the network, by
observing how balances fluctuate. On the contrary, not providing
any information about a channel’s state would provide privacy to
users, but would render the network unusable to route multihop
payments. Public disclosure of balances implies thus a trade-off be-
tween payment privacy and route finding efficiency in the network
(and therefore usability).
Our work uncovers a balance discovery attack that can be used by
Lightning Network adversaries, in order to deanonymize network
payments. We have presented an analysis, complemented by ex-
perimental results that validate our claims. We have also discussed
some potential countermeasures to handle the problem uncovered
by our work and conducted a responsible disclosure to the develop-
ers of the Lightning Network. Disclosure issues remain unanswered.
Acknowledgements — The authors gratefully acknowledge financial sup-
port from the BART (Blockchain Advanced Research & Technologies) ini-
tiative (cf. http://bart-blockchain.fr/), as well as the Cyber CNI chair of
the Institut Mines-Télécom and the H2020 SPARTA project, under grant
agreement 830892, and the Spanish Government, under grants RTI2018-
095094-B-C22 CONSENT and TIN2014-57364-C2-2-R SMARTGLACIS. C.
Pérez-Solà was affiliated to Universitat Rovira i Virgili during part of the
time while this work was done.
Session 8: Blockchain SecurityAsiaCCS ’19, July 9–12, 2019, Auckland, New Zealand611REFERENCES
[1] E. Androulaki and G. O. Karame. Hiding transaction amounts and balances in
bitcoin. In International Conference on Trust and Trustworthy Computing, pages
161–178. Springer, 2014.
[2] E. Androulaki, G. O. Karame, M. Roeschlin, T. Scherer, and S. Capkun. Evaluating
user privacy in bitcoin. In International Conference on Financial Cryptography
and Data Security, pages 34–51. Springer, 2013.
[3] M. Backes, I. Goldberg, A. Kate, and E. Mohammadi. Provably secure and practical
onion routing. In 2012 IEEE 25th Computer Security Foundations Symposium, pages
369–385. IEEE, 2012.
[4] M. Backes and S. Meiser. Differentially private smart metering with battery
recharging. In Data Privacy Management and Autonomous Spontaneous Security,
pages 194–212. Springer, 2014.
[5] R. Bar-Yehuda and S. Even. A local-ratio theorem for approximating the weighted
vertex cover problem. Annals of Discrete Mathematics, 25:27–46, 1985.
[6] G. Bissias, A. P. Ozisik, B. N. Levine, and M. Liberatore. Sybil-resistant mixing for
bitcoin. In Proceedings of the 13th Workshop on Privacy in the Electronic Society,
pages 149–158. ACM, 2014.
[7] J. Bonneau, A. Narayanan, A. Miller, J. Clark, J. A. Kroll, and E. W. Felten. Mixcoin:
Anonymity for bitcoin with accountable mixes. In International Conference on
Financial Cryptography and Data Security, pages 486–504. Springer, 2014.
[8] S. Brânzei, E. Segal-Halevi, and A. Zohar. How to charge lightning. CoRR,
abs/1712.10222, 2017.
[9] S. Castillo-Pérez and J. Garcia-Alfaro. Onion routing circuit construction via
latency graphs. Computers & Security, 37:197–214, 2013.
[10] M. Conti, S. Kumar, C. Lal, and S. Ruj. A survey on security and privacy issues of
bitcoin. IEEE Communications Surveys & Tutorials, 2018.
[11] C. Decker and R. Wattenhofer. A fast and scalable payment network with bitcoin
duplex micropayment channels. In Symposium on Self-Stabilizing Systems, pages
3–18. Springer, 2015.
[12] J. A. D. Donet, C. Pérez-Sola, and J. Herrera-Joancomartí. The bitcoin P2P network.
In International Conference on Financial Cryptography and Data Security, pages
87–102. Springer, 2014.
[13] C. Dwork. Differential privacy: A survey of results. In International Conference
on Theory and Applications of Models of Computation, pages 1–19. Springer, 2008.
[14] Elements Project. c-lightning – a lightning network implementation in C. https:
//github.com/ElementsProject/lightning, 2019.
[15] G. Fanti and P. Viswanath. Deanonymization in the bitcoin P2P network. In
Advances in Neural Information Processing Systems, pages 1364–1373, 2017.
[16] E. Gelenbe and Y. M. Kadioglu. Energy life-time of wireless nodes with network
attacks and mitigation. In 2018 IEEE International Conference on Communications
Workshops (ICC Workshops), pages 1–6. IEEE, 2018.
[17] J. Herrera-Joancomartí. Research and challenges on bitcoin anonymity. In Data
Privacy Management, Autonomous Spontaneous Security, and Security Assurance,
pages 3–16. Springer, 2014.
[18] H. A. Jawaheri, M. A. Sabah, Y. Boshmaf, and A. Erbad. When a small leak sinks a
great ship: Deanonymizing tor hidden service users through bitcoin transactions
analysis. arXiv preprint arXiv:1801.07501, 2018.
[19] G. O. Karame, E. Androulaki, and S. Capkun. Double-spending fast payments in
bitcoin. In Proceedings of the 2012 ACM conference on Computer and communica-
tions security, pages 906–917. ACM, 2012.
[20] P. Koshy, D. Koshy, and P. McDaniel. An analysis of anonymity in bitcoin using
P2P network traffic. In International Conference on Financial Cryptography and
Data Security, pages 469–485. Springer, 2014.
[21] I. D. Mastan and S. Paul. A new approach to deanonymization of unreachable
bitcoin nodes. In International Conference on Cryptology and Network Security,
pages 277–298. Springer, 2017.
[22] S. Meiklejohn, M. Pomarole, G. Jordan, K. Levchenko, D. McCoy, G. M. Voelker,
and S. Savage. A fistful of bitcoins: characterizing payments among men with no
names. In Proceedings of the 2013 conference on Internet measurement conference,
pages 127–140. ACM, 2013.
[23] I. Miers, C. Garman, M. Green, and A. D. Rubin. Zerocoin: Anonymous distributed
e-cash from bitcoin. In Security and Privacy (SP), 2013 IEEE Symposium on, pages
397–411. IEEE, 2013.
[24] C. Milling, C. Caramanis, S. Mannor, and S. Shakkottai. On identifying the
causative network of an epidemic. In Communication, Control, and Computing
(Allerton), 2012 50th Annual Allerton Conference on, pages 909–914. IEEE, 2012.
[25] M. Moser, R. Bohme, and D. Breuker. An inquiry into money laundering tools in
the bitcoin ecosystem. In eCrime Researchers Summit (eCRS), 2013, pages 1–14.
IEEE, 2013.
[26] J. Poon and T. Dryja. The bitcoin lightning network: Scalable off-chain instant
payments, 2015.
[27] C. Pu and S. Lim. A light-weight countermeasure to forwarding misbehavior in
wireless sensor networks: design, analysis, and evaluation. IEEE Systems Journal,
12(1):834–842, 2018.
[28] A. Ranchal-Pedrosa, M. Potop-Butucaru, and S. Tucci-Piergiovanni. Lightning
factories. Cryptology ePrint Archive, Report 2018/918, 2018. https://eprint.iacr.
org/2018/918.
[29] F. Reid and M. Harrigan. An analysis of anonymity in the bitcoin system. In
Security and privacy in social networks, pages 197–223. Springer, 2013.
[30] D. Ron and A. Shamir. How did dread pirate roberts acquire and protect his
bitcoin wealth? In International Conference on Financial Cryptography and Data
Security, pages 3–15. Springer, 2014.
[31] A. Samokhvalov, J. Poon, and O. Osuntokun. Lightning Network In-Progress
Specifications. BOLT 11: Invoice Protocol for Lightning Payments, 2018.
[32] A. Samokhvalov, J. Poon, and O. Osuntokun. The lightning network daemon,
https://github.com/lightningnetwork/lnd, 2018.
[33] E. B. Sasson, A. Chiesa, C. Garman, M. Green, I. Miers, E. Tromer, and M. Virza.
Zerocash: Decentralized anonymous payments from bitcoin. In 2014 IEEE Sym-
posium on Security and Privacy (SP), pages 459–474. IEEE, 2014.
[34] M. Spagnuolo, F. Maggi, and S. Zanero. Bitiodine: Extracting intelligence from
the bitcoin network. In International Conference on Financial Cryptography and
Data Security, pages 457–468. Springer, 2014.
[35] D. Sy, R. Chen, and L. Bao. Odar: On-demand anonymous routing in ad hoc
networks. In Mobile Adhoc and Sensor Systems (MASS), 2006 IEEE International
Conference on, pages 267–276. IEEE, 2006.
[36] E. Y. Vasserman and N. Hopper. Vampire attacks: draining life from wireless ad
hoc sensor networks. IEEE transactions on mobile computing, 12(2):318–332, 2013.
Session 8: Blockchain SecurityAsiaCCS ’19, July 9–12, 2019, Auckland, New Zealand612