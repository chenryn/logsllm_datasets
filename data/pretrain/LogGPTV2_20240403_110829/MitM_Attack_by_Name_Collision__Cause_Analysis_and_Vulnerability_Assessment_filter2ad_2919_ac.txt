n
e
e
v
ork
 0
.site
Popular first label in NXD queries
Fig. 2: The most popular ﬁrst labels in root NXD trafﬁc.
servers. Furthermore, the number will only increase as more
new gTLD strings continue to be delegated (as of 2016/03/20,
27.2% (201) more new gTLDs have been delegated since this
study was conducted).
B. Leak Cause Analysis
1) Major Leak Source ASes: To identify the cause, we
start by measuring where the leaks originate. We ﬁrst break
down the leaked WPAD trafﬁc into country level according
to their query IP addresses. Fig. 4 shows the country codes
ranked by their average daily leak percentage in our root NXD
WPAD dataset from January to July 2015. As shown, U.S.
(United States) dominates the leaked trafﬁc with nearly 70%
worldwide, and its share is over 6× more than that of the
country ranked the second. In the following analysis, our focus
is mainly on the leaked query trafﬁc from the U.S.
Within the U.S., we further characterize the query trafﬁc ac-
cording to ASes. Fig. 5 shows the ASes with top average daily
WPAD query leaks from January to July, 2015. As shown, the
overall distribution exhibits a long tail, in which nearly 2000
ASes have leaked queries, but the majority of these queries
come from only a few top ASes. The top 12 ASes account for
85% of all the leaks, and their names are listed in Table II.
In the table, we denote these ASes A1 to A12 to obfuscate
the actual AS in our data. As shown, 10 out of the 12 ASes
are home access network ASes. The remaining two ASes both
operate open (publicly accessible) DNS resolvers, and we ﬁnd
that the queries come predominantly from source IP addresses
within the IP address ranges listed as open DNS resolver
servers on their websites. Thus, both ASes are associated with
open resolver usage, which is also commonly conﬁgured by
home access network users. These results suggest the major
cause of WPAD query leaks is user behavior at home instead
of in corporate networks.
2) Leak Domain Sufﬁxes: To investigate why WPAD
queries are leaked from home, we closely examine the domains
of leaked WPAD queries in these home access network ASes.
Surprisingly, instead of being dominated by a few popular
home device domain names as we expected, we found that
Popular delegated new gTLDs in NXD WPAD queries
Fig. 3: The most popular delegated new gTLDs observed in
root NXD WPAD queries.
AS code name
Home access network related
A1
A2
A3
A4
A5
A6
A7
A8
A9
A10
A11
A12
Yes
Yes
Yes
Likely
Yes
Yes
Likely
Yes
Yes
Yes
Yes
Yes
TABLE II: AS code names (used in Fig. 5 and Fig. 6) of the
top 12 WPAD query leak ASes in the U.S., accounting for
85% of total leak queries. We anonymize the AS names for
privacy consideration.
 100
 10
 1
 0.1
 0.01
 0.001
 0.0001
%
k
a
e
l
y
r
e
u
q
D
A
P
W
 80
 70
 60
 50
 40
 30
 20
 10
 0
 0
 50
 100  150  200
US AU NL CN RU PL CA GB TR FR DE BR
Country code ranked by WPAD query leak perc.
Fig. 4: Countries ranked by WPAD query leak percentage.
The ﬁgure inset shows the complete probability distribution,
illustrating the long tail.
the leaked queries have on average more than 10,000 different
domain sufﬁxes in these 12 ASes. For example, home access
network AS A1 originated WPAD queries with more than
70,000 different domain sufﬁxes, with the most popular one
accounting only for 0.28% of all leaked queries. Moreover, we
680680
Authorized licensed use limited to: IEEE Xplore. Downloaded on March 18,2021 at 12:18:12 UTC from IEEE Xplore.  Restrictions apply. 
 100
 10
 1
 0.1
 0.01
 0.001
 0.0001
S
U
n
i
%
k
a
e
l
y
r
e
u
q
D
A
P
W
 30
 25
 20
 15
 10
 5
 0
0
2
4
6
8
1
1
1
1
1
2
0
0
0
0
0
2
4
6
8
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
A1 A2 A3 A4 A5 A6 A7 A8 A9 A10A11A12
AS ranked by WPAD query leak perc.
Fig. 5: ASes ranked by WPAD query leak percentage in US.
Domain sufﬁx
Query
Home network
Corporate network
string
(cid:2)defense contractor(cid:3)
.master.
corp.local.
(cid:2)marketing(cid:3).local.
root.local.
(cid:2)manufacture(cid:3).inc.
(cid:2)town name(cid:3).local.
prod.dca.
(cid:2)consulting(cid:3).local.
us.local.
(cid:2)real estate(cid:3).local.
(cid:2)computer(cid:3).lan.
(cid:2)bank(cid:3).ubc.
datacenters.ww.
(cid:2)marketing(cid:3).intraxa.
root.corp.
%
0.28
0.26
0.22
0.21
0.15
0.14
0.13
0.13
0.13
0.12
0.11
0.11
0.11
0.10
0.09
related
No
No
No
Unclear
No
No
No
No
related
Unclear
Yes
Yes
Unclear
Yes
Yes
Yes
Yes
Unclear
Unclear
No
No
No
No
No
No
Yes
Yes
Yes
Yes
Yes
Yes
TABLE III: Top domain sufﬁxes of the leaked WPAD queries
in home access network AS A1. For privacy consideration,
we anonymize some company or institution names with their
business types in brackets.
 12
 10
 8
 6
 4
 2
 0
y
p
o
r
t
n
e
x
i
f
f
u
s
y
r
e
u
Q
 12
 11.5
 11
 10.5
 10
 9.5
 9
 8.5
0
2
4
6
8
1
1
1
1
1
2
0
0
0
0
0
2
4
6
8
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
A4 A1 A7 A13 A2 A3 A6 A5 A10 A12 A8
AS ranked by entropy
Fig. 6: ASes ranked by their domain sufﬁx entropy scores.
Home access networks with top leak query volume (Table II)
are also high-entropy ASes. A13 is the only exception that did
not appear in the top 12 WPAD query leak ASes.
manually classify the top domain sufﬁxes and ﬁnd that they are
almost all corporate internal network sufﬁxes instead of home
681681
device domains. Table III lists the top 15 leaked query domain
sufﬁxes from A1. As before, we obfuscate the details of the
domain names for discretion. As shown, none are domains for
home devices such as routers. Based on the labels, e.g., “corp”,
“inc”, 12 of them are related to corporate internal networks
that are unlikely to be hosted in home networks. This suggests
that a potential cause of WPAD query leaks can be attributed
to individuals using corporate devices on their home networks.
To further validate this cause, we measure the average
daily domain query entropy of each leak source AS. The
intuition is that home access networks with end-user machines
using different internal network domain sufﬁxes should have
higher entropy due to the sufﬁx diversity. In this analysis, we
measure the daily query domain sufﬁx entropy using equation
entropy(ASi) = −
suf ∈S psuf ln psuf , where S is the set
of distinct 2-level domain sufﬁxes (e.g., company.ntld in
Fig. 1) appearing in AS ASi in a day, and psuf is the query
percentage of 2-level domain sufﬁx suf ∈ S.
(cid:2)
Fig. 6 shows the leak source ASes ranked by their average
daily domain sufﬁx entropy scores from January to July, 2015.
As shown, the home access network ASes with top leak query
volume are also high-entropy ASes. Moreover, the top 12 high
leak volume ASes are all ranked top 15 in entropy scores out
of over 2000 ASes in total, which supports our hypothesis.
Thus, the major cause of the WPAD leaks is very likely
using devices conﬁgured with internal domain names outside
of internal networks, e.g., using corporate laptops at home.
3) Device-side Causes: From this cause, the major problem
is on the device side: why does a corporate device still issue
corporate internal WPAD queries when the device is actually
not in the corporate network? In fact, with the support of
DHCP, a device should be able to automatically update domain
sufﬁxes when the network changes. To ﬁnd out the causes, we
set up a local testbed to perform controlled experiments.
Experiment setup. We use VirtualBox to launch a virtual
machine running different testing OSes on a host machine us-
ing NAT (Network Address Translation) conﬁguration. In our
experiments, we choose Mac OS X, Ubuntu 12.04, Windows
XP, Vista, 7, 8, 8.1, and 10 as testing OSes.
The host machine can be connected to 3 different network
environments. Two of them have 2 different domain sufﬁxes
conﬁgured in DHCP, which are automatically propagated to
the host. The third environment does not have a domain sufﬁx,
which is created using the tethering feature of a smartphone on
a cellular network. In our experiment, we switch the network
of the host machine among the 3 environments to simulate
network condition changes on the testing OSes, e.g., from
corporate to home network.
Results. As summarized in Table IV, we ﬁnd several
common OS settings under which internal query leaks can
happen even with automatic domain conﬁguration from DHCP.
The ﬁrst case is setting the domain of a computer, which
can be found in the control panel of Windows OSes. This
conﬁguration is recommended for businesses and schools,
since it can remotely manage laptops they provide to their
employees and students with their domain controller over VPN
Authorized licensed use limited to: IEEE Xplore. Downloaded on March 18,2021 at 12:18:12 UTC from IEEE Xplore.  Restrictions apply. 
OS conﬁguration
Affected OSes
Set Windows PC domain
Hardcode domain search list
Windows XP/Vista/7/8/8.1/10
Windows XP/Vista/7/8/8.1/10,
Mac OS X, Ubuntu 12.04
Change from a network with
Windows Vista
domain to a network without domain
TABLE IV: Common OS conﬁgurations that can cause a
device to mistakenly issue internal queries when the device