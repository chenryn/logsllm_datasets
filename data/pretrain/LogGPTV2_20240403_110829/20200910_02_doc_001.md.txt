亿级用户量的实时推荐数
据库到底要几毛钱?
Digoal
我是谁?
江湖名号: 德哥
帮会: PostgreSQL社区
帮会不正当职务: 校长
擅长武器: PostgreSQL
雕虫小技: 全文检索、模糊搜索、化学分析、
人脸识别、相似推荐、时空调度、向量搜索...
必杀技: 删库跑路
正经职务: 阿里云数据库产品经理
愿景: 没有MyBase解决不了的问题,如果有,就多买几台
格言: 公益是一辈子的事
业余爱好: 写博、写专利、分享、毁人不倦
github: https://github.com/digoal
联系方式:
我的助理是谁?
龙哥
性别: 男
必杀技: 红包雨
前面都是废话, 现在进入重点
实时推荐的核心诉求
•
通用解决方案的痛点
•
“几毛钱”的牛逼方案
•
“我思故我在”有奖思考
土豪方案需要多少钱?
•
有技术追求的牛逼方案需要"几毛钱"?
•
体现个人价值的牛逼方案用了什么产品技术?
•
场景
没有 的讨论都是刷流氓
内容(视频为例). 位置, 特征(打标), 热度, 权重, 评论
•
用户. 位置, 喜好, 比例, 已阅, Like, 评论
•
主播. 内容提供
•
实时推荐的核心诉求
天下武功 唯快不破
•
推荐快
•
知晓快
•
准确性
•
指哪打哪
•
通用解决方案的痛点
数据量大,按资源拆, 多库查
询, 交互次数指数级增加, 返
喜好维度多, 交互 每个用户的已读列表几十万级,
回结果需要多台合并排序,性
次数 SQL文巨大, 查询filter无法使用 能低下O(n)
并发高
成倍增加 索引, 大量资源浪费.
1、请求推荐
关系数据库
2、按位置、喜好(比例)、权重排序、过滤已读
高频更新
(资源亿+、已读
查询维度多,无法采用单一索引, 权 ,
用户 调
费
付
无法精准过滤 标 ,
打
A I 权 百万亿+)
调
度
热 6、更新视频热度
7、更新个人喜好权重
5、批量已读入库
3、过滤实时已读 内存数据库
(亿+) 4、写入已读 内存数据库 已读列表长, 大
内存数据库
量重复存储 布朗运动
同步
(百万亿级) 逻辑同步
延迟大
主播
土
豪:
能
用
钱
解
决 只读实例
先 的
来 问
1 题
万 都
台 不
服 是
务 问
器. 题.
“几毛钱”NB方案:MyBase PG
并发高, 当出现性能
分BOX, 分池, 不管数据
喜好维度多,
HLL存储已读列表, SQL小.
问题(基本不会出现):
多大, 查询次数O(1)
CTE+subquery
按内容ID哈希分片随机搜索, 无
算法退化(采样查询,
单次交互
效过滤降低至少1个数量级.
单台百万QPS)
1、请求推荐
关系数据库
2、按位置、喜好(比例)、权重排序、过滤已读
实时+自动降级,
(资源亿+、已读 队列合并更新
box分区, 喜好索引精准过滤 权 ,
用户 调
费
付
标 ,
打
A I 权 亿+)
调
度
热 6、更新视频热度
7、更新个人喜好权重
5、批量已读入库
3、过滤实时已读 内存数据库
(亿+) 内存数据库
4、写入已读
内存数据库 已读列表HLL存储,
手机端过滤实时已读, 减 记录数降低百万倍. 同步
流复制,
少一次内存数据库交互.
延迟ms级
主播
有
技
用 术
户: 情
4 怀
台 的 只读实例
M
搞 y
B
定, a
s
平 e
均
5
m
s
响
应.
“几毛钱”NB方案:MyBase PG
产品技术 Summary
•
MyBase PG, 重点
•
HLL近似计算, 几十KB存储上亿ID: 已读缩小百万倍.
•
又快、
• 实时推荐,单次推荐N条, 平均5ms响应. 又准、
又稳!
地域池化, 交互降低到O(1)
•
CTE, subquery, 消除多标签多次交互, 降低 RT 20ms 以上.
•
物理流复制, ms级只读延迟.
•
4台64C数据库服务器(包括HA、只读实例)
•
防雪崩措施之一, 算法退化(基本用不上)(随机采样单台可支撑百万级QPS)
•
这个
群抢红包
前面还是废话, 快进
动脑抢答有奖!!!!!!
•
• 土豪方案需要多少钱?
• 牛逼方案需要几毛钱?
• 牛逼方案用了什么产品和技术?
• 今天是什么日子?
详细方案入群 咨询砖家
•
期待下一期
•
每周四晚, 聊数据库、下红包雨
•