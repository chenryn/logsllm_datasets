此外，该擦除模块还存在一个白名单的进程列表，为了防止意外发生，其不会对这些进程进行强制关闭的操作。擦除模块内置的白名单进程列表如下。
###### 4\. 104.dll 模块分析
该模块实现了 IEC-104 规约中定义的协议，首先该模块读取配置文件，并根据配置文件中的指令进行指定操作。由于该模块主要实现了 IEC-104
的协议通信，所以有必要对 IEC-104 协议的格式和规约做一些背景介绍。
IEC-104 规约是厂站与调度主站间通讯的规约，以以太网为载体，采用平衡传输，TCP/IP 网络通信端口号为2404。IEC-104 规约以 0x68
为启动字符，紧接 APDU 长度和4个8位控制域，之后是用户数据。
名称解释：
  * APDU:应用规约数据单元 
  * APCI:应用规约控制信息 
  * ASDU:应用服务数据单元 
 启动字符
0x68 定义了数据流中的起点，APDU 的长度域定义了 APDU 体的长度，它包括 APCI 的四个控制域八位位组和 ASDU
，控制域定义了保护报文不至丢失和重复传送的控制信息、报文传输启动/停止、以及传输连接的监视等控制信息。
IEC-104规约帧分为三种类型：
a)可计数的信息传输功能的帧，简称I帧或者I格式帧。 b)可计数的确认功能的帧，简称S帧或者S格式帧。 c)启动、停止、测试功能的帧，简称U帧或者U格式帧。
I格式帧常常包含 APCI 和 ASDU 两个部分，其控制域第一个八位组的比特1=0，I帧包含特定信息，类型和内容较多。
S格式的帧只有 APCI，其控制域第一个八位组的比特 1=1 并且比特 2=0 。用于确认接收到对方的帧，但本身没有信息发送的情况。
U格式的帧也只有 APCI，其控制域第一个八位组的比特 1=1 并且比特 2=1 ，U帧仅有三种类型：启动帧、测试帧、停止帧。
IEC 60870-5-3 描述了远动系统传输帧中的基本应用数据单元，并定义了用于配套标准中的应用服务数据单元(ASDU)结构如图：
应用服务数据单元(ASDU)由数据单元标识符和一个或多个信息对象组成。类型标识定义了后续信息对象的结构、类型和格式。可变结构限定词定义了信息元素的数目和信息体地址类型，长度为一个字节。公共体地址即为
RTU 地址，长度2个字节，低位在前。
主站发送的类型标识列表：
从站返回信息帧的类型标识列表：
主站发送的传输原因：
从站发送的传输原因：
对该协议有一定了解后，我们继续对该模块做进一步分析。当该模块的 Crash 函数被 Launcher 加载运行时，会将配置文件读入到内存（配置文件由参数
Crash 参数指定）读取到内存的配置参数。
下表是配置文件中各域解释：
该模块首先会读取 `stop_comm_service` 域并判定其是否为1，如果为1，则结束 `stop_comm_service_name`
域所指定的进程。
执行完以上操作后，该模块会根据 IEC-104 规约构造数据包向配置文件中指定的目标主机IP端口发送启动帧。构造启动帧数据包代码如下：
该恶意模块（主站）连接从站(RTUs)，并构造启动帧发送给从站(RTUs)。
恶意模块(主站)发送U帧启动帧：
从站（RTUs）会返回一个U帧确认帧：
当成功获取到从站（RTUs）返回的确认帧后，该模块会根据配置文件中 operation 域提供的操作方法操作RTU。
当前 operation 域支持三种方式，分别为range、sequence、shift。
range 模式即为攻击者指定信息对象地址范围，主站读取配置文件中 range
域填充攻击者指定的信息对象地址向从站发送单点遥控选择信息，从站（RTUs）返回单点遥控确认信息，然后恶意模块(主站)向从站（RTUs）发送单点遥控执行请求，根据返回的信息确认信息对象地址。当得到正确的信息对象地址后，该模块会循环向从站发送单点遥控选择及单点遥控确认请求。
构造单点遥控选择数据包：
恶意模块(主站)发送的数据为：  
68（`启动符`）0E（`长度`）00 00（`发送序号`）00 00（`接收序号`）2D（`类型标示`）01（`可变结构限定词`）06
00（`传输原因`）00 00（`公共地址即RTU地址`）0A 00 00（`信息体地址`）81（`遥控性质`）  
当前类型标识为0x2d传输原因为0x06表示主站发送单点遥控，其中遥控性质为0x81表示向从站发送单点遥控选择
从站（RTUs）返回数据，  
68（`启动符`）0E（`长度`）00 00（`发送序号`）02 00（`接收序号`）2D（`类型标示`）01（`可变结构限定词`）07
00（`传输原因`）01 00（`公共地址即RTU地址`）0A 00 00（`信息体地址`）81（`遥控性质`）  
当前类型标识为0x2d传输原因为0x07标识从站发送单点确认
恶意模块(主站)发送单点遥控执行合闸  
68（`启动符`）0E（`长度`）02 00（`发送序号`）02 00（`接收序号`）2D（`类型标示`）01（`可变结构限定词`）06
00（`传输原因`）00 00（`公共地址即RTU地址`）0A 00 00（`信息体地址`）01（`遥控性质`）  
注释  
遥控性质字段解释：  
`bit7` 为1表示选择，等于0标识执行  
`bit1` `bit0` 为01表示合闸，为00表示分闸  
`bit65432` 为1表示短脉冲，为2表示长脉冲，为3表示持续。
sequence 模式为当攻击者知道从站的信息对象地址值时，根据配置文件中的攻击指令，向从站（RTUs）循环发送单点遥控选择及单点遥控执行请求。
shift 模式与 range 模式类似，首先会枚举 range 域指定的信息对象地址范围，完成后，会通过 shift 域生成新的信息对象地址范围进行与
range 模式相同的操作。
当配置文件中的silence域为1时会开启命令行输出。
启动帧与确认帧：
单点遥控选择与确认：
单点遥控执行请求：
#### 四、其他模块功能说明
该恶意软件在攻击过程中可以下发任何可能的攻击模块，根据 ESET
的报告，我们将其他的攻击模块以及其核心功能归纳如下（以下内容根据ESET的报告编译总结而成）：
###### 1\. 101
这个 payload DLL 名为 101.dll ，以 IEC 101(即IEC 60870-5-101)
命名，这也是一种国际标准的用于监控和控制电力系统的协议。该协议常用于工业控制系统和远程终端单元（RTUs）之间的通信。实际通信是通过串行连接传输的。
101 payload 组件在一定程度上实现了 IEC 101 标准中所描述的协议，并且能够与 RTU 或者任何支持该协议的设备进行通信。一旦被执行，101
payload 组件解析存储在 ini 文件中的配置信息，配置信息可能包含：进程名、Windows 设备名称（通常是 COM