其中1≤ j  tmax秒给系统一个重置的机会。然后我们计算所有集合的交集来提取少量可能的
TMSIs。我们注意到，根据寻呼信道流量模式和 TMSI 重新分配策略，可能会得到0或更多 TMSIs。我们已经观察到 TMSI
的任务往往持续几个小时，这使得我们很有可能获得至少一个短暂的 TMSI，这是在200秒左右。我们只需要一个 n 的小数字，通常是2或3来缩小精确的
TMSI。最后，为了使测试成功，攻击者必须能够听到受害者设备的寻呼请求。根据经验，T-Mobile LAC 747d
的覆盖面积超过100平方公里，并在该区域内的每个 BTS 重复所有传呼请求。
### D. 缺席测试
先前发现的一个自然延伸是缺席测试，以确定移动台是否不在该区域。得到的交集会产生一个空集。如果移动设备的缺失也表明用户的缺失，那么这些信息对攻击者来说也是有用的。从上面提到的显示
TMSI 的方法开始，假设 TMSI 在攻击测量期间不发生变化，我们以每次读取之间延迟一个 td 的时间间隔运行攻击 n 次，并重新获得 TMSI
集I1,I2,...,In。在这种情况下，如果 I1∩ I2∩ ... ∩ In = ∅，我们可以合理地得出结论，移动设备没有在当前 LAC
中注册，如果启动，设备在该区域之外。快速测试可以通过打电话完成。如果设备被关闭，电话会转到语音信箱的速度比设备响铃的速度快。
### E. 同一个 BTS 上的存在测试
一旦攻击者确定目标设备的 LAC 与他的相同，下一步就是确定设备是否在监听相同的 BTS。回忆一下，PCCH
下行链路载有传呼请求和即时分配讯息，但即时分配讯息中的识别项是由移动站选择，并以我们不知道的频道请求传送。因此，我们开发了一种技术，通过观察即时分配和触发寻呼请求之间的时间差，来确定我们是否与受害者在同一个塔上。  
我们用 TMSI 监听了受害者手机的传呼请求，在我们观察 PCCH 上下一条即时分配信息之前，测量了时间延迟。我们检查了三种情况，试验台距离受害者10米:
  1. 和受害者在同一个 ARFCN 上驻留，使用 PSTN 呼叫触发寻呼请求
  2. 和受害者在不同的 ARFCN 上驻留，使用 PSTN 呼叫触发寻呼请求
  3. 在任意的 ARFCN 上驻留，从随机时间开始取样 PCCH。
我们用 tp作为表示目标设备的寻呼请求的时间戳，用 ta表示下一个即时分配消息的时间戳。我们要比较以上的3个测试用例的时间差 δt = ta-tp 。  
对于每个测试，在第一种情况下，样本容量为46，我们观察到平均时间差 t = 0.177秒，标准差 t = 0.0572。在第二种情况下，当我们收听另一个
ARFCN 时，样本容量为43，我们观察到 t = 1.99秒，标准差 t = 3.42。最后，在样本量为40的第三个例子中，我们在 ARFCN 上随机取样
PCCH，观察到 t = 0.517秒，标准差 t = 0.582。结果如下图所示。
我们的目标是能够区分，我们在同一座 ARFCN 塔上的情况，和我们在同一个 LAC
但在不同塔上的情况。假设我们和受害者在同一个信号塔上，我们会听到那个设备的即时分配信号，这个信号会在很接近寻呼请求的时候发出，以便提供快速服务。因此，我们设置了如下的零假设:  
µs = µd，µs = µr，其中
  * µs测试条件1(同塔)的平均时间差
  * µd测试条件2(不同塔台)的平均时间差
  * µr测试条件3(随机)的平均时间差
为了比较我们的测试所得到的时间差异，我们使用韦尔奇两个样本 t-test，对小样本和不同分布的总体是稳健的。结果如下。比较µs和 µd得到了 p
值0.001199。比较µs和 µr得到的 p
值是0.0006942。这两个结果都表明，找到一个测试统计数据同样或更极端是非常不可能的。因此我们可以用如此低的 p
值来拒绝两个零假设。因此，我们的结论是，可能存在一个有意义的差异，使我们能够通过查看寻呼请求和即时分配消息的到达时间，区分在同一个 ARFCN
上收听或在不同的 ARFCN 上收听的情况。
### F. 移动物体
我们证实了我们的身份识别方法，对于平均时速105公里穿过一个LAC
的设备是有效的。设备在同一个LAC里停留了8分钟，我们只用了2分钟就显示了TMSI。很明显，我们的”同一个塔”测试，不适用于快速移动的物体。移动电台倾向于驻留在同一个
ARFCN 上，直到它们移动超过1公里。我们的测试需要每个 ARFCN 5秒钟完成。根据不同的区域，可能有3到5个 ARFCNs 具有足够高的 RSSI
值来测试。因此，如果受害者在塔的1公里范围内逗留几分钟，我们的攻击就会成功。如果受害者的物理路径是已知的，也可以预测受害者在经过一段时间后会在哪里。
## 0x05 Carrying Out The Attack In Practice
我们需要了解 LACs
的地理覆盖范围，以及基站的分布情况。我们绘制了紫外线辐射区域的地图，采集了目标的紫外线辐射区域周围的样本数据，结果覆盖了大约100平方公里的区域。在那个
LAC，我们绘制了一个小得多的区域，来确定信号塔的位置和每个 ARFCN 对这些信号塔的覆盖范围。
### A. 测绘 LAC
我们用打了补丁的 T-Mobile G1手机来记录来自基带的 GSM 信息，还有 GPS 追踪我们在 LAC 747d
的位置。然后我们沿着一堵近似的墙走，在道路允许的情况下，把 LAC 747d 的边缘当作一堵墙。如下图，与 LAC 747d
对应的区域是灰色的。该地区北部的红线长约10公里。整个区域面积超过100平方公里。
### B. 信号塔位置
因为我们能进行的最高粒度的测试，就是确定我们在同一个塔上，精确地知道那个塔的位置很重要。我们使用爬山法，目标是最大限度地提高射频领域的目标塔。我们用修改过的
G1来进行场强的点测量，然后我们沿着经典爬山算法的变体进入场地，我们超过最大点50米或更多，然后回溯到垂直方向，以确保我们不会因为不均匀的射频信号衰减而陷入局部极小值。下图显示了我们爬山的例子，以及检测到的手机信号塔的结果。
### C. 测绘塔和 ARFCNs
接下来，我们要在移动站切换到另一个信号塔之前确定一个信号塔与它之间的距离。这一次，我们沿着目标区域的，每一个街区行进。我们记录了5个最强的 RSSI
和相应的 ARFCNs。下图显示了使用上述爬山法对3个 RSSI 值最高的 ARFCNs 以及推断出的手机塔的结果。
一个移动站将尝试在最高的 RSSI 的 ARFCN
上驻留。因此我们确定受害者很可能在它所连接的信号塔周围1平方公里的范围内，这取决于我们调查区域内的信号衰减。我们还注意到有几个地区，我们可以在多个
ARFCNs
上驻留。因此，攻击者可以一次检查多个塔，而受害者必须接近塔。在这个特殊的实验中，一个实验台能够在一个地点监控所有3座塔，占2.5×2.5公里的总面积。
### D. 无声水印暴露 TMSI
为了避免检测，需要引发一个带有目标 TMSI
的寻呼请求，而不会在移动站上引起任何用户可观察到的副作用。我们的方法是从公众电话号码发起一个常规电话，在移动站响起第一声之前中止通话。已知从 PSTN
上的呼叫启动到 PCCH
上的寻呼请求出现之间的时间延迟平均约为2.94秒，在中位数情况下，设备上的实际环路需要约7.0秒。另外5秒内挂断电话，可以避免设备响铃。因此，我们可以安全地在4秒钟后挂断，以便在不通知用户的情况下，悄悄地发出寻呼请求和即时分配消息。
## 0x06 Mitigations
### A. 呼叫多个LAC
服务提供商会尽量限制有限的无线电资源的消耗。因此，在寻找设备时，它只会在设备最可能位置的地方寻呼
LAC。然而，这使得缺席测试成为可能。显然，对所有设备的所有 LACs 进行呼叫是非常浪费的。因此，我们建议只在设备大部分时间出现的地方寻呼一组 LACs。
### B. 频繁的 TMSI 变化和 TMSI 分配
TMSI 的部分目标是隐藏来自 PSTN 和 PCCH 的消息之间的对应关系。  
在编号、寻址和识别规范条款中的 GSM 规范除了防止使用0xffffffff 之外，并没有为 TMSI 规定特定的结构。因此，操作员可以自由选择 TMSI
的值，因为它只与 VLR 相关。通过对 AT&T 网络51小时的观察，我们发现使用 TMSIs 的211,094个寻呼请求中，只有59,329个独立
TMSIs，所以 TMSI 平均被重用3.56次。很明显， TMSI 有232-1的可能性，仍然有足够的空间分配 TMSI。对于那个 AT&T 网络，大多数
TMSIs 的值都在0x90000000以上，大部分在0xbe000000到0xfb0000000之间。  
我们对 TMSIs 的攻击之所以有效，是因为与两次通话之间的短延迟相比，TMSI 的分配时间较长。通过使 TMSI
分配的时间短于两个呼叫之间的时间延迟，TMSI 现在变得无法识别。也可以在成功接收到一个寻呼后进行重新分配。
### C. 连续时间混合应用到 PCCH
即使电话号码和 TMSIs
之间按位不连接，仍然有可能应用流量分析技术来确定概率，如果我们看到的Paging是由我们的呼叫造成的，特别是在安静时期。在流量率较低的情况下，满足 tmin
≤ tTMSI ≤ tmax 不等式的候选 TMSI 集非常小。  
为了防止所讨论的基于时间的流量分析，我们建议在 BTS 上延迟发出的寻呼请求消息。考虑到 TMSI
分配空间利用率很低，在低流量条件下，可以通过引入由包含未指定 TMSIs
的诱骗paging组成的覆盖流量来提高到达率。通过将总流量保持在150页/分钟以上，即使对于小时延参数µ≥2，也可以保持高匿名性。
## 0x07 Conclusion
我们已经证明有足够的信息从 GSM
通信栈的底层泄漏，使攻击者能够对受害者的设备进行位置测试。我们已经展示了这些测试可以在用户不知道的情况下悄悄执行，方法是在测试完成之前中止 PSTN
调用。我们最后提出了一些解决方案，通过应用低成本的技术，具有良好的匿名性能的 GSM 栈，而无需硬件改造。