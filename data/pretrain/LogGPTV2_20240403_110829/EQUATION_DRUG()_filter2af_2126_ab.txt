### 图 10：本次泄露版本的主要功能代码

通过上述分析比较，可以得出结论：本次泄露的恶意代码样本应为较低版本。无论是从版本信息还是功能上看，该版本均低于之前曝光的版本。在影子经纪人泄露出的文件“DanderSpritz_All_Find.txt”中，GROK的版本号也清楚地说明了这一点。影子经纪人所释放出的只是GROK组件的低版本部分文件，而高版本仍然被其掌握。

### 图 11：GROK组件的不同版本号

#### 4.2 Processinfo插件遍历进程模块

**4.2.1 样本标签**

**4.2.2 主要功能**

本插件用于实现对指定进程的模块遍历，并调用上层模块预设的回调函数。具体包括以下四个基于序号导出的函数：

- **图 12：1号导出函数** - 设置上层模块回调函数
- **图 13：3号导出函数** - 返回核心功能函数地址
- **图 14：4号导出函数** - 获取插件版本信息
- **图 15：遍历指定进程，默认为当前进程**
- **图 16：遍历指定进程模块，计算模块对应文件HASH（SHA1）**

#### 4.3 kill_Implant插件杀进程模块

**4.3.1 样本标签**

**4.3.2 主要功能**

该模块接收调用者传递进来的进程ID，利用`OpenProcess`函数获取句柄，再通过`TerminateProcess`函数结束对应进程。

- **图 17：结束进程**

### 5. 小结

此次“影子经纪人”释放的Equation Group中的61个文件，对于全球网络安全研究者分析和厘清EQUATION相关攻击平台的组成和架构提供了重要帮助。通过综合分析相关曝光信息，我们发现了更多关于该攻击平台的信息，例如数百个攻击插件以及“DanderSpritz”攻击平台。

通过对相关文件的分析，安天分析小组判断其中部分组件与之前卡巴斯基曝光的GROK组件为同类样本，且这些组件为早期的低版本。此外，我们的分析结果表明，“DanderSpritz”与Equation Drug使用相同的组件和架构设计，因此“DanderSpritz”可能就是方程式组织使用的Equation Drug攻击平台。

由于时间仓促，目前我们仅披露了部分文件和泄露信息的相关分析成果。后续我们将继续进行深入分析。

五年前，在安天针对Flame蠕虫的马拉松式分析过程中，有专家曾提醒我们不要“只见树叶，不见森林”。这让我们深刻反思了传统分析工程师“视野从入口点开始”的局限性，并开始尝试建立从微观见宏观的分析视野。

对于安天来说，过去四年来对方程式组织的持续跟踪分析，为我们提供了极为难得的机会来了解最高级别的攻击者（即A2PT，“高级APT”）。深入研究这种具有超级成本支撑和先进理念引领的超级攻击者，对于改善安天探海、智甲、追影等高级威胁检测防御产品的防御能力至关重要。然而，应对A2PT攻击者需要更多的协同和接力式分析，而不是反复重复发明轮子。正是基于这种共同认知，在不久前的第四届安天网络安全冬训营上，安天和360企业安全等安全企业向部分与会专家介绍了能力型安全厂商分析成果互认的部分尝试。只有中国的机构用户和能力型安全厂商形成一个积极互动的体系，才能更好地防御来自各方面的危险。

我们警惕，但并不恐惧。对于一场防御战来说，除了扎实的架构、防御和分析工作之外，必胜的信念是一个前提。

无形者未必无影，安天追影，画影图形！

### 附录一：参考资料

1. 安天：修改硬盘固件的木马 探索方程式（EQUATION）组织的攻击组件
2. 安天：方程式（EQUATION）部分组件中的加密技巧分析
3. 安天：从“方程式”到“方程组” EQUATION攻击组织高级恶意代码的全平台能力解析
4. THESHADOWBROKERS CLOSED, GOING DARK
5. Stolen NSA "Windows Hacking Tools" Now Up For Sale!
6. Kaspersky：Equation: The Death Star of Malware Galaxy
7. Kaspersky：Inside the EquationDrug Espionage Platform
8. Equation Group Cyber Weapons Auction – Invitation
9. The Equation giveaway
10. I just published “TheShadowBrokers Message #3”
11. Shadow Brokers reveals list of Servers Hacked by the NSA
12. ANTProductData2013
13. Kaspersky：A Fanny Equation: "I am your father, Stuxnet"
14. Kaspersky：Equation Group: from Houston with love
15. Kaspersky：Equation_group_questions_and_answers
16. Kaspersky：The Equation giveaway

### 附录二：关于安天

安天从反病毒引擎研发团队起步，目前已发展成为以安天实验室为总部，以企业安全公司、移动安全公司为两翼的集团化安全企业。安天始终坚持以安全保障用户价值为企业信仰，崇尚自主研发创新，在安全检测引擎、移动安全、网络协议分析还原、动态分析、终端防护、虚拟化安全等方面形成了全能力链布局。安天的监控预警能力覆盖全国，产品与服务辐射多个国家。

安天将大数据分析、安全可视化等方面的技术与产品体系有效结合，以海量样本自动化分析平台延展工程师团队作业能力、缩短产品响应周期。结合多年积累的海量安全威胁知识库，综合应用大数据分析、安全可视化等方面经验，推出了应对高级持续性威胁（APT）和面向大规模网络与关键基础设施的态势感知与监控预警解决方案。

全球超过三十家以上的著名安全厂商、IT厂商选择安天作为检测能力合作伙伴。安天的反病毒引擎得以为全球近十万台网络设备和网络安全设备、超过五亿部手机提供安全防护。安天移动检测引擎是全球首个获得AV-TEST年度奖项的中国产品。安天技术实力得到行业管理机构、客户和伙伴的认可，安天已连续四届蝉联国家级安全应急支撑单位资质，亦是中国国家信息安全漏洞库六家首批一级支撑单位之一。

安天是中国应急响应体系中重要的企业节点，在红色代码、口令蠕虫、震网、破壳、沙虫、方程式等重大安全事件中，安天提供了先发预警、深度分析或系统的解决方案。