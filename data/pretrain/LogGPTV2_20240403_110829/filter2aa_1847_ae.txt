10.0.1.2.
LL2351.Book  Page 39  Monday, September 8, 2003  2:47 PM
40
Chapter 2    DNS Service
If you are using Mac OS X Server as your DHCP Server:
1 In Server Settings, click the Network tab, click DHCP/NetBoot, and choose Configure 
DHCP/NetBoot.
2 On the Subnet tab, select the subnet on the built-in Ethernet port and click Edit.
3 In the General tab, enter the following information:
Start:  10.0.1.3 
End:  10.0.1.254
Subnet Mask:  255.255.255.0
Router:  10.0.1.1
4 Click the DNS tab and enter the following information:
Default Domain:  example.com
DNS Servers:  10.0.1.2
5 Click the Save button and log out of Server Settings.
Note:  The client computers may not immediately populate with the new IP 
configuration information. This will depend upon when their DHCP leases expire. It may 
be necessary to restart the client computers for the changes to populate.
Check Your Configuration
To verify the steps were successful, open Terminal, located in /Applications/Utilities and 
enter the following commands (substituting the local domain name for 
“server.example.com” as appropriate):
dig server.example.com
dig -x 10.0.1.2
Note:  If this generic configuration example does not meet your needs, Apple 
recommends that you don’t attempt to configure DNS on your own and that you seek 
out a professional consultant or additional documentation.
Using DNS With Dynamically Assigned IP Addresses
Dynamic DNS is a mechanism that lets you modify the IP address/domain name list 
without directing the name server to reload the edited list. This means you can update 
the name server remotely and easily modify DNS data.
You can use dynamic DNS with DHCP service. DHCP assigns each client computer a 
dynamic IP address when the computer starts up. Because a DHCP server may assign IP 
addresses randomly, it can be useful to assign meaningful DNS names to these 
addresses on the fly.
LL2351.Book  Page 40  Monday, September 8, 2003  2:47 PM
Chapter 2    DNS Service
41
For instance, if “Bob” walks into work in the morning and starts up his computer, and 
the DHCP server assigns his computer a dynamic IP address, a DNS entry 
“bob.example.com” can be associated with that IP address. Even though Bob’s IP 
address may change every time he starts up his computer, his DNS name remains the 
same. This lets users communicate with Bob’s computer without knowing the IP 
address.
You can also use dynamic DNS to provide static host names for users who connect to 
the Internet through a modem. An ISP can set up dynamic DNS so a home computer 
has the same host name every time it connects.
Where to Find More Information
For more information on DNS and BIND, see the following:
• DNS and BIND, 4th edition, by Paul Albitz and Cricket Liu (O’Reilly and Associates, 
2001)
• The International Software Consortium website:
www.isc.org and www.isc.org/products/BIND/
• The DNS Resources Directory:
www.dns.net/dnsrd/ 
Request For Comment Documents
Request for Comments (RFC) documents provide an overview of a protocol or service 
and details about how the protocol should behave. If you’re a novice server 
administrator, you’ll probably find some of the background information in an RFC 
helpful. If you’re an experienced server administrator, you can find all the technical 
details about a protocol in its RFC document. You can search for RFC documents by 
number at the website www.faqs.org/rfcs.
• A, PTR, CNAME, MX -For more information, see RFC 1035
• AAAA- For more information, see RFC 1886.
LL2351.Book  Page 41  Monday, September 8, 2003  2:47 PM
LL2351.Book  Page 42  Monday, September 8, 2003  2:47 PM
3
43
3 IP Firewall Service
Firewall service is software that protects the network applications running on your 
Mac OS X Server. Turning on firewall service is similar to erecting a wall to limit access. 
Firewall service scans incoming IP packets and rejects or accepts these packets based 
on the set of filters you create. You can restrict access to any IP service running on the 
server, and you can customize filters for all incoming clients or for a range of client IP 
addresses.
The illustration below shows an example firewall process.
Is there a filter
for port 80?
Locate the
Any Port filter
with the most
specific range
that includes
the address
10.221.41.33.
A computer with IP
address 10.221.41.33
attempts to connect to
the server over the
Internet (port 80).
The server begins
looking for filters.
Is there a filter
containing
IP address
10.221.41.33?
Yes
Connection
is refused.
Yes
What does the
filter specify?
Connection
is made.
Allow
No
Deny
LL2351.Book  Page 43  Monday, September 8, 2003  2:47 PM
44
Chapter 3    IP Firewall Service
Services such as Web and FTP are identified on your server by a Transmission Control 
Protocol (TCP) or User Datagram Protocol (UDP) port number. When a computer tries to 
connect to a service, firewall service scans the filter list for a matching port number.
• If the port number is in the filter list, the filter applied is the one that contains the 
most specific address range.
• If the port number is not in the list, the Default filter that contains the most specific 
address range is used.
The port filters you create are applied to TCP packets and can also be applied to UDP 
packets. In addition, you can set up filters for restricting Internet Control Message 
Protocol (ICMP), Internet Group Management Protocol (IGMP), and NetInfo data.
If you plan to share data over the Internet, and you don’t have a dedicated router or 
firewall to protect your data from unauthorized access, you should use firewall service. 
This service works well for small to medium businesses, schools, and small or home 
offices.
Large organizations with a firewall can use firewall service to exercise a finer degree of 
control over their servers. For example, individual workgroups within a large business, 
or schools within a school system, may want to use firewall service to control access to 
their own servers.
IP Firewall also provides stateful packet inspection which determines whether an 
incoming packet is a legitimate response to an outgoing request or part of an ongoing 
session, allowing packets that would otherwise be denied.
Mac OS X Server uses the application ipfw for firewall service.
Important:  When you start firewall service the first time, most all incoming TCP 
packets are denied until you change the filters to allow access. By default, only the 
ports essential to remote administration are available. These include access by 
Remote Directory Access (625), Server Administration via Server Admin (687), and 
Secure Shell (22). For any other network service, you must create filters to allow 
access to your server. If you turn firewall service off, all addresses are allowed access 
to your server.
LL2351.Book  Page 44  Monday, September 8, 2003  2:47 PM
Chapter 3    IP Firewall Service
45
Understanding Firewall Filters
When you start firewall service, the default configuration denies access to all incoming 
packets from remote computers except ports for remote configuration. This provides a 
high level of security. You can then add new IP filters to allow server access to those 
clients who require access to services.
To learn how IP filters work, read the following section. To learn how to create IP filters, 
see “Managing Firewall Service” on page 49.
What is a Filter?
A filter is made up of an IP address and a subnet mask, and sometimes a port number 
and access type. The IP address and the subnet mask together determine the range of 
IP addresses to which the filter applies, and can be set to apply to all addresses.
IP Address
IP addresses consist of four segments with values between 0 and 255 (the range of an 8 
bit number), separated by dots (for example, 192.168.12.12). The segments in IP 
addresses go from general to specific (for example, the first segment might belong to 
all the computers in a whole company, and the last segment might belong to a specific 
computer on one floor of a building).
Subnet Mask
A subnet mask indicates which segments in the specified IP address can vary on a 
given network and by how much. The subnet mask is given in Classless Inter Domain 
Routing (CIDR) notation. It consists of the IP address followed by a slash (/) and a 
number from 1 to 32, called the IP prefix. An IP prefix identifies the number of 
significant bits used to identify a network.
For example, 192.168.2.1 /16 means the first 16 bits (the first two numbers separated by 
periods) are used to represent the network (every machine on the network begins with 
192.168) and the remaining 16 bits (the last two numbers separated by periods) are 
used to identify hosts (each machine has a unique set of trailing numbers).
LL2351.Book  Page 45  Monday, September 8, 2003  2:47 PM
46
Chapter 3    IP Firewall Service
Addresses with subnet masks in CIDR notation correspond to address notation 
subnet masks.
CIDR
Corresponds to Netmask
Number of addresses 
in the range
/1
128.0.0.0
4.29x109
/2
192.0.0.0
2.14x109
/3
224.0.0.0
1.07x109
/4
240.0.0.0
5.36x108
/5
248.0.0.0
1.34x108
/6
252.0.0.0
6.71x107
/7
254.0.0.0
3.35x107
/8
255.0.0.0
1.67x107
/9
255.128.0.0
8.38x106
/10
255.192.0.0
4.19x106
/11
255.224.0.0
2.09x106
/12
255.240.0.0
1.04x106
/13
255.248.0.0
5.24x105
/14
255.252.0.0
2.62x105
/15
255.255.0.0
1.31x105
/16
255.255.255.0
65536
/17
255.255.128.0
32768
/18
255.255.192.0
16384
/19
255.255.224.0
8192
/20
255.255.240.0
4096
/21
255.255.248.0
2048
/22
255.255.252.0
1024
/23
255.255.254.0
512
/24
255.255.255.0
256
/25
255.255.255.128
128
/26
255.255.255.192
64
/27
255.255.255.224
32
/28
255.255.255.240
16
/29
255.255.255.248
8
/30
255.255.255.252
4
/31
255.255.255.254
2
/32
255.255.255.255
1
LL2351.Book  Page 46  Monday, September 8, 2003  2:47 PM
Chapter 3    IP Firewall Service
47
Using Address Ranges
When you create filters using Server Admin, you enter an IP address and the CIDR 
format subnet mask. Server Admin shows you the resulting address range, and you can 
change the range by modifying the subnet mask. When you indicate a range of 
possible values for any segment of an address, that segment is called a wildcard. The 
following table gives examples of address ranges created to achieve specific goals.
Rule Mechanism and Precedence
The filter rules in the General panel operate in conjunction with the rules shown in the 
Advanced panel. Usually, the broad rules in the Advanced panel block access for all 
ports. These are lower-priority rules and take effect after the rules in the General panel. 
The rules created with the General panel open access to specific services, and are 
higher priority. They take precedence over those created in the Advanced panel. If you 
create multiple filters in the Advanced panel, a filter’s precedence is determined by the 
rule number which is the rule’s order in the Advanced panel. Rules in the advanced 
panel can be re-ordered by dragging the rule within the list.
For most normal uses, opening access to designated services in the advanced panel is 
sufficient. If necessary, you can add additional rules using the Advanced panel, creating 
and ordering them as needed.
Multiple IP Addresses
A server can support multiple homed IP addresses, but firewall service applies one set 
of filters to all server IP addresses. If you create multiple alias IP addresses, then the 
filters you create will apply to all of those IP addresses.
Goal
Sample
IP address
Enter this in the 
address field:
Address range 
affected
Create a filter that specifies a 
single IP address.
10.221.41.33
10.221.41.33 or
10.221.41.33/32
10.221.41.33 
(single address)
Create a filter that leaves the 
fourth segment as a wildcard.
10.221.41.33
10.221.41.33/24
10.221.41.0 to 
10.221.41.255
Create a filter that leaves part of 
the third segment and all of the 
fourth segment as a wildcard.
10.221.41.33
10.221.41.33/22
10.221.40.0 to 
10.221.43.255
Create a filter that applies to all 
incoming addresses.
Select “Any”
All IP addresses
LL2351.Book  Page 47  Monday, September 8, 2003  2:47 PM
48
Chapter 3    IP Firewall Service
Setting Up Firewall Service for the First Time
Once you’ve decided which filters you need to create, follow these overview steps to 
set up firewall service. If you need more help to perform any of these steps, see 
“Managing Firewall Service” on page 49 and the other topics referred to in the steps.
Step 1:  Learn and plan
If you’re new to working with IP Firewall, learn and understand firewall concepts, tools, 
and features of Mac OS X Server and BIND. For more information, see “Understanding 
Firewall Filters” on page 45.
Then plan your IP Firewall Service by planning which services you want to provide 
access to. Mail, web, and FTP services generally require access from computers on the 
Internet. File and print services will most likely be restricted to your local subnet. 
Once you decide which services you want to protect using firewall service, you need to 
determine which IP addresses you want to allow access to your server, and which IP 
addresses you want to deny access to your server. Then you can create the appropriate 
filters.
Step 2:  Start firewall service
In Server Admin, select Firewall and click Start Service. By default, this blocks all 
incoming ports except those used to configure the server remotely. If you’re 
configuring the server locally, turn off external access immediately.
Step 3:  Create an IP address group that filters will apply to