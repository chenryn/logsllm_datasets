title:Modeling and understanding end-to-end class of service policies in
operational networks
author:Yu-Wei Eric Sung and
Carsten Lund and
Mark Lyn and
Sanjay G. Rao and
Subhabrata Sen
Modeling and Understanding End-to-End Class of Service
Policies in Operational Networks
Yu-Wei Eric Sungy, Carsten Lundz, Mark Lyn?, Sanjay Raoy, and Subhabrata Senz
{sungy,sanjay}@ecn.purdue.edu, {lund,sen}@research.att.com, PI:EMAIL
yPurdue University, zAT&T Labs – Research, ?AT&T Inc.
ABSTRACT
Business and economic considerations are driving the extensive use
of service differentiation in Virtual Private Networks (VPNs) op-
erated for business enterprises today. The resulting Class of Ser-
vice (CoS) designs embed complex policy decisions based on the
described priorities of various applications, extent of bandwidth
availability, and cost considerations. These inherently complex
high-level policies are realized through low-level router con(cid:2)gu-
rations. The con(cid:2)guration process is tedious and error-prone given
the highly intertwined nature of CoS con(cid:2)guration, the multiple
router con(cid:2)gurations over which the policies are instantiated, and
the complex access control lists (ACLs) involved. Our contribu-
tions include (i) a formal approach to modeling CoS policies from
router con(cid:2)guration (cid:2)les in a precise manner; (ii) a practical and
computationally ef(cid:2)cient tool that can determine the CoS treat-
ments received by an arbitrary set of (cid:3)ows across multiple routers;
and (iii) a validation of our approach in enabling applications such
as troubleshooting, auditing, and visualization of network-wide CoS
design, using router con(cid:2)guration data from a cross-section of 150
diverse enterprise VPNs. To our knowledge, this is the (cid:2)rst effort
aimed at modeling and analyzing CoS con(cid:2)gurations.
Categories and Subject Descriptors: C.2.3 [Network Operations]:
Network Management
General Terms: Design, Management, Measurement
Keywords: Con(cid:2)guration modeling, differentiated service
1.
INTRODUCTION
Service differentiation using Class of Service (CoS) is being in-
creasingly adopted in a wide variety of network settings including
enterprise Virtual Private Networks (VPNs). The need to support
CoS differentiation arises from several considerations: (i) IP net-
works today carry traf(cid:2)c from a diverse set of applications with
very different performance needs such as low delay and low loss
for Voice over IP (VoIP) traf(cid:2)c, and high throughput for bulk data
transfer like FTP; (ii) different applications can have very differ-
ent relative importance to an enterprise customer, e.g., web service
transactions supporting a vital work(cid:3)ow are likely to be accorded
Permission to make digital or hard copies of all or part of this work for
personal or classroom use is granted without fee provided that copies are
not made or distributed for pro(cid:2)t or commercial advantage and that copies
bear this notice and the full citation on the (cid:2)rst page. To copy otherwise, to
republish, to post on servers or to redistribute to lists, requires prior speci(cid:2)c
permission and/or a fee.
SIGCOMM’09, August 17(cid:150)21, 2009, Barcelona, Spain.
Copyright 2009 ACM 978-1-60558-594-9/09/08 ...$10.00.
much higher priority compared to traf(cid:2)c associated with brows-
ing external web sites; and (iii) economic considerations drive the
need to optimize the usage of existing network infrastructures un-
der (cid:2)nite capacity and cost constraints, while ensuring good perfor-
mance for important applications.
CoS designs embed inherently complex policy decisions based
on the described priorities of various applications, extent of band-
width availability, and cost considerations. Realizing these pol-
icy objectives involves con(cid:2)guring multiple routers in low-level,
device-speci(cid:2)c con(cid:2)guration languages. Troubleshooting customer
complaints regarding poor performance involves tracing the con-
(cid:2)gured CoS treatment of individual (cid:3)ows by looking across router
con(cid:2)guration (cid:2)les, each of which can contain thousands of com-
mand lines. Miscon(cid:2)guration could potentially lead to violations
of the service level agreements (SLAs), business service disrup-
tions for the enterprise, and penalties for the service provider. The
problem is daunting considering the large number of enterprise net-
works managed, their large size and geographical span, and the di-
versity of services and con(cid:2)guration options.
While managing network con(cid:2)guration is hard in general, CoS
con(cid:2)guration poses several unique challenges. First, CoS con(cid:2)g-
uration is highly intertwined, with dependencies across different
parts of a con(cid:2)guration (cid:2)le. Second, the overall CoS treatment
seen by a (cid:3)ow between two end-points may be impacted by policy
blocks (i.e., parts of the con(cid:2)guration specifying CoS policy rules)
instantiated in multiple device, possibly on both input and output
interfaces of each device, and by multiple policy blocks even on a
single interface. Third, each policy block can transform a packet
before it enters the next policy block (cid:150) for instance, a router may
mark a packet at the inbound interface to indicate the priority class,
and the actions of the router’s outbound interface or a downstream
router may depend on the marking. Finally, each policy block clas-
si(cid:2)es (cid:3)ows into different classes using multiple access control lists
(ACLs), each of which can have hundreds of inter-dependent rules.
1.1 Contributions
In this paper, we make the following contributions:
(cid:15) We draw attention to the prevalence of CoS, and the complexity
inherent in managing CoS con(cid:2)guration, a topic that is little known
outside the operational community. Our understanding has been
gleaned from repeated inspections of router con(cid:2)guration (cid:2)les from
a large number of enterprise VPNs, and through close interactions
with network designers. We believe our efforts pave the way for
the research community to further engage in the area.
(cid:15) We propose a formal representation of CoS policies that is inde-
pendent of the underlying con(cid:2)guration syntax. This representation
is easily derivable from low-level con(cid:2)gurations and can enable
us to systematically compose CoS policies across multiple policy
blocks within a single router and across multiple routers.
219Enterprise VPN
LA ˘ Dallas branch traffic
LA
CER1
PER1
PER3
New York
CER3
LA
CER1
PER1
PER2
CER2
P routers
Dallas
CER4b
San Diego
MPLS 
Backbone
CER4
PER4
PER2
CER: Customer-Edge Router
PER: Provider-Edge Router
Dallas
CER2
CER5
Houston
Figure 1: An enterprise VPN spanning multiple sites.
(cid:15) Based on our framework, we have built a query tool that enables
operators to determine how an arbitrary set of (cid:3)ows are treated on
an (cid:147)end-to-end(cid:148) basis. We use the term (cid:147)end-to-end(cid:148) throughout
this paper to refer to the fact that the tool can model the net ef-
fect that a (cid:3)ow would see if it were to traverse a given sequence
of devices, each of which could potentially have multiple CoS pol-
icy blocks. The set of devices of interest is assumed to be known,
though in the future, routing table information could be incorpo-
rated to automate the discovery of the devices involved. The tool
leverages binary decision diagrams (BDD) [14], a practical and ef-
(cid:2)cient data structure for manipulating boolean operations. With
our tool, the computation time for query resolution is in the order
of seconds for the real-world datasets we considered.
While we believe our modeling approach is itself more general,
the current implementation of the tool is targeted at Cisco IOS con-
(cid:2)gurations, and enterprise VPN settings. Further, the focus is on
CoS policies instantiated in routers at the customer and provider
edge, at both the ingress and egress. We focus on these policies as
they re(cid:3)ect unique requirements of individual customers and tend
to change frequently. CoS policies in the core are not considered
as they re(cid:3)ect provider policies which are relatively homogeneous
and stable, and do not involve IP packet transformations.
(cid:15) We have evaluated our tool on a cross-section of 150 differ-
ent enterprise VPNs. Even though the VPNs are managed by the
same provider, their CoS designs show signi(cid:2)cant diversity across
enterprises, perhaps re(cid:3)ecting the different application mixes and
cost considerations of each enterprise. Further, their designs show
a large degree of heterogeneity in terms of how different routers
within an enterprise are con(cid:2)gured, re(cid:3)ecting the different func-
tionality offered by sites within an enterprise (e.g., a VoIP cus-
tomer service center may be con(cid:2)gured differently than a data cen-
ter). The results also con(cid:2)rm the importance and effectiveness of
our approach in assisting operators to reason about network-wide
CoS operations. In particular, our tool enables operators to audit
the overall CoS design, identify potentially anomalous (cid:3)ow treat-
ments and con(cid:2)guration lines that are never triggered, and derive a
network-wide view of the CoS design which summarizes the traf(cid:2)c
classes that can be exchanged between every pair of VPN sites.
The rest of the paper is organized as follows. §2 presents the
background on CoS in enterprise VPN settings and motivates our
formal modeling approach. §3 describes a framework for modeling
CoS con(cid:2)guration. §4 outlines the design and key implementation
aspects of our CoS query tool. §5 describes potential usage sce-
narios for the tool. §6 studies CoS usage in practice and evaluates
the effectiveness of the tool in troubleshooting, auditing, and deriv-
ing network-wide CoS designs. §7 summarizes related works. §8
discusses some open issues, and (cid:2)nally §9 concludes the paper.
2. BACKGROUND AND MOTIVATION
Enterprise networks are increasingly moving from using dedi-
cated private lines to using VPNs, especially layer-3 Multi Protocol
Packets are 
marked 
inbound off 
LAN – given 
DSCP setting 
for appropriate 
CoS.
Packets are policed 
depending on whether 
they are conforming or 
non-conforming.
Packets are scheduled 
using various queuing 
disciplines and 
congestion avoidance 
mechanisms.
MPLS VPN Backbone
DSCP-based CoS
EXP-based CoS
Packets are still marked 
with the same DSCP 
value as they were when 
they left CER1.
Packets are scheduled 
using various queuing 
disciplines and 
congestion avoidance 
mechanisms.
Figure 2: CoS treatment along an end-to-end path.
Label Switching (MPLS) VPN technology, to connect geographi-
cally disparate sites. In this architecture (see Fig. 1), each site has
one or more customer edge routers (CER), which can be jointly
con(cid:2)gured by the enterprise customer and service provider. Each
CER connects to the provider network via one or more provider
edge routers (PER). Customer IP traf(cid:2)c from a CER is encapsu-
lated by MPLS labels at the ingress PER, carried over MPLS tun-
nels across core routers (referred to as Provider or P routers) in the
MPLS provider backbone, decapsulated by a remote egress PER,
and sent to the appropriate destination CER. Such provider-based
VPNs provide a scalable and secure way for service providers to
support different customers across a common MPLS backbone.
2.1 Service differentiation in VPNs
A primary consideration for service providers in designing en-
terprise VPNs is to satisfy various application needs such as delay,
jitter, and bandwidth. In this architecture, both the enterprise and
provider are faced with supporting traf(cid:2)c for applications with dif-
ferent performance requirements and service priorities over a com-
mon network infrastructure. Furthermore, in the provider back-
bone, services with different requirements such as VPNs, Internet,
multicast, and VoIP may coexist. At the edge of the network, be-
tween the enterprise and the provider, limited available bandwidth
capacity coupled with the high cost of deploying and provision-
ing additional capacity means that bandwidth needs to be carefully
managed across the applications competing for it. While the core is
typically overprovisioned, bandwidth must still be carefully man-
aged under failure scenarios.
Service differentiation is essential to traf(cid:2)c management in such
a heterogeneous environment. A provider and an enterprise cus-
tomer enter into service level agreements (SLAs) that describe the
agreed-to requirements on performance for different applications (cid:150)
this involves complex choices based on application requirements
and behaviors, the relative priorities of applications used by that
enterprise, and cost. The routers in the VPN need to then be con-
(cid:2)gured appropriately to honor the SLAs. SLA violations can have
adverse consequences, potentially involving disruption of critical
enterprise activity and heavy penalties for the service provider.
2.2 Realizing service differentiation using CoS
Class of Service (CoS) is a way of realizing service differen-
tiation, by grouping traf(cid:2)c with similar service requirements and
treating each group as a class with its own level of service priority.
The Type of Service (ToS) (cid:2)eld of the IP header of each packet in-
dicates the priority class to which it belongs. Typically, the (cid:2)rst 6
bits of the ToS (cid:2)eld encodes the class information, and these bits
are referred to as the Differentiated Services Code Point (DSCP)
bits. The DSCP bits are directly used by the CERs and PERs in
deciding the treatment that a packet must receive on the CER-PER
2201 class-map match-any REALTIME
2 match access-group VOICE
3 match access-group INTERACTIVE-VIDEO
4 match ip dscp 46
5 class-map match-all ... ! OTHER class-maps
6 !
7 policy-map REALTIME-POLICER
8 class REALTIME
9
police 30000 conform-action set-dscp-transmit 46
exceed-action drop
10 policy-map CRITICAL-DATA-POLICER
11 class ROUTING
12
13 class OTHER-CRITICAL-DATA
14
set ip dscp 48
police 15000 conform-action set-dscp-transmit 26
exceed-action set-dscp-transmit 28
15 policy-map BEST-EFFORT-MARKER
16 ...
17 !
18 policy-map WAN-EGRESS-POLICER-QUEUE
19 class REALTIME
20
priority percent 35
service-policy REALTIME-POLICER
21
22 class CRITICAL-DATA
23
24
25 class class-default
26
bandwidth percent 40
service-policy CRITICAL-DATA-POLICER
bandwidth percent 25
service-policy BEST-EFFORT-MARKER
! LAN INGRESS MARKING POLICY
27
28 !
29 interface Ethernet0/1 ! INTERFACE TO LA BRANCH’s LAN
30 ...
31 !
32 interface Serial1/0
33 service-policy output WAN-EGRESS-POLICER-QUEUE