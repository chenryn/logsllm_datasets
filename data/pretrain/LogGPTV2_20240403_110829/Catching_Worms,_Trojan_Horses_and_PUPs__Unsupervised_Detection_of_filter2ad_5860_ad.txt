a separate group. In some cases we cannot identify the real
publisher behind the lockstep, as the downloader is an archive
extractor (Winzip). These correspond to the unknown group.
Table II describes the distribution of these lockstep groups.
While we are able to label some locksteps in this manner,
we observe that most locksteps involve downloaders that are
difﬁcult to place in a speciﬁc category, as many locksteps have
mixed rep-pubs.
We therefore perform a second labeling step, based on the
payloads that the locksteps distribute. We distinguish between
malware and PUP payloads with the method described in
Section III-B. The labeling is conducted in two steps. First, the
downloaders are labeled by the payloads they distribute within
the lockstep. We say a downloader is malware downloader
(MD), if it distributes at least one malware.13 In a similar
fashion, we label a downloader as PUP downloader (PD) if
it downloads PUP payloads but no malware. A downloader is
labeled as Benign downloader (BD) if it downloads a benign
payload but no suspicious (malware, PUP) download. The rest
are placed as unknown downloader (UD). As the next step, we
label the locksteps. The locksteps that include at least one MD
are labeled as malware downloader lockstep (MDL). Similarly,
we label a lockstep as PUP downloader lockstep (PDL) if
it contains PDs but no MDs. We label the locksteps with
no suspicious (MD, PD) downloader as unknown downloader
lockstep (UDL). We note that, as malware families sometimes
evade detection for extended periods of time, not every UDLs
13This is an aggressive labeling policy, as even benign downloaders may
be tricked into downloading malware occasionally. However, this labeling
produces a conservative estimate of our false positive rate (as discussed in
Section II, we do not aim to measure false negatives).
MDL
PDL
BDL
UDL
typedlr:dom
54,497 (81.22%)
7,800 (11.63%)
3,231 (4.82%)
1,566 (2.33%)
typedom:dlr
51,831 (85.81%)
6,901 (11.43%)
1,500 (2.48%)
169 (0.28%)
correspond to benign download activities. Therefore, we try
to identify the benign downloader locksteps (BDL) among the
UDLs. Similar to the deﬁnition of MDLs and PDLs, the BDL
should contain at least one BD.
We present the result of the labeling in Table III. For
both lockstep types, MDL occupy more than 80% of the total
number of locksteps while benign are 4.82% and 2.48% for
typedlr:dom and typedom:dlr, respectively. Our higher success
rate in labeling with payloads, compared to labeling only with
downloaders, reﬂects our community’s focus on detecting and
labeling malware, rather than on understanding the client-side
distribution infrastructure.
Identifying campaigns. As discussed in Section II, we sep-
arate the campaigns within the lockstep by nδt. By setting
n = 3, we identify 1,292,141/71,424/27,145/6,233 campaigns
corresponding to MDL/PDL/BDL/UDL. On average there are
12.2/4.9/5.7/3.6 campaigns per lockstep for MDL/PDL/BDL.
A. Relationships among representative publishers
The locksteps allow us to determine the business rela-
tionships between rep-pubs and payloads and among groups
of rep-pubs. We focus on PPI and PUP providers, which
distribute other executables intentionally. We collect PUP
and PPIs from the top 10 rep-pubs with a high percent-
age of MDLs within their locksteps. Each of these rep-
pubs conducted at least 40 campaigns. We also include the
known PPI providers Amonetize Ltd., Conduit Ltd.
and OutBrowse LTD to this list.
We investigate which publishers appear frequently to-
gether in lockstep with these 13 rep-pubs. As the down-
loaders signed by these publishers simultaneously utilize the
same server side infrastructure,
this likely reﬂects a rela-
tionship among the corresponding distribution networks. We
also determine whether one of these downloaders was itself
downloaded by one of the the downloaders in the lockstep,
which suggests a closer business connection. We therefore
term such relationship between the publishers as partner. For
example, we observe such partnership relations among some
PPI providers, e.g. Outbrowse Ltd. that frequently de-
livers downloaders from Somoto Ltd.. Additional frequent
partners of Somoto Ltd. include Mindad media Ltd.,
8
# of Locksteps (Log Scale)Locksteps (dlr:dom)Locksteps (dom:dlr)Histogram bucket size = 50102103104# of Nodes in the Lockstep050100150200250300350# of LockstepsLocksteps (dlr:dom)Locksteps (dom:dlr)Histogram bucket size = 10103104Life Cylce (i.e. age) of the Lockstep (# of windows)020406080100120# of LockstepsLocksteps (dlr:dom)Locksteps (dom:dlr)Histogram bucket size = 5010,00020,00030,000Lockstep Emergence (# of windows)020406080100120IronInstall, betwlkx, and Multiply ROI, which
suggests a stable business relationship with these organiza-
tions.14 The cases where we cannot establish a downloaded-by
relationship among the downloaders in the lockstep may point
to an organization that uses multiple code signing certiﬁcates
to evade attribution or to relationships with a common third
party. We term such relationship as neighbor. We illustrate
some of these business relationships in Figure 5. The nodes
are the publishers and the edge between publishers indicate a
business relationship, either partner or neighbor. The thickness
of the edge indicates the frequency of that relationship.
To further illuminate this ecosystem, we employ a com-
munity detection algorithm [7] to the graph illustrated in
Figure 5(a). This algorithm identiﬁes 7 communities. Within
each community, we determine the rep-pub with the highest
betweenness centrality [15], which is the number of shortest
paths between any two nodes that pass through the rep-pub.
This graph centrality measure singles out a node that likely
acts a bridge between other nodes from each community.
• Community #1: OutBrowse. This community represents the
advertisers or the afﬁliates of the Outbrowse PPI. The
PUPs Multiply ROI and Mindad media Ltd. are
frequently in lockstep with the rep-pub. The other publish-
ers in this community represent variants of the rep-pub’s
certiﬁcate: OutBrowse LTD and OutBrowse.
• Community #2: Somoto. This community belongs to So-
moto, which is also a PPI provider. Beside Somoto’s
certiﬁcates (Somoto Ltd. and Somoto Israel), this
community includes 12 other publishers. International
News Network Limited, a known PUP distributor, is
tightly connected with the publishers in this community,
suggesting a close relationship.
• Community #3: raonmedia. 22 publishers belong to this
community. Three PUP publishers including raonmedia,
Pacifics Co., and CIDA showed high centrality in this
community. All three publishers were located in Busan,
Korea and the certiﬁcates were issued by Thawte, Inc.,
which suggests these publishers could belong to the same
group.
#4:
Sendori. Although we
PPI
Conduit Ltd. within the community, PUP Sendori
has a higher centrality. At 77 publishers, this is the largest
community. Sendori was is tightly connected to most
of
the publishers within the group, which reﬂects an
aggressive distribution strategy of this PUP.
see
• Community
#5: Amonetize. This
represents
Amonetize Ltd. and several PUPs.
In particular,
Shetef Solutions & Consulting (1998) Ltd.
is known to be the advertiser15 of Amonetize.
• Communities #6 & #7. These communities are small and
group
include the InstallX PPI and the Wajam PUP.
These results suggest that the partner and neighbor relation-
ships can expose organizations that utilize distinct code signing
certiﬁcates for different activities, e.g. PPI and PUP. Addition-
ally, the graph communities capture close relationships among
• Community
14Several of these publishers attended the 2014 Afﬁliate Summit in Las
Vegas (http://afﬁliatesummit.com/).
15https://www.reasoncoresecurity.com/signer-shetef-solutions-consulting-
1998-ltd-40812da0f7cb2ecd4955fd76e0a6c493.aspx
the publishers, such as delivery networks that rent the server-
side infrastructure from a third party or publishers that engage
in aggressive distribution campaigns using multiple providers.
The graph also includes instant messengers and ﬁle sharing
software, which are likely involved in locksteps resulting from
spam campaigns.
B. Malware and PUP delivery ecosystems
Downloaders that appear in locksteps with different labels
provide the opportunity to analyze the overlap of different
software distribution ecosystems. 36.7% of the downloaders
(3,345 out of 9,103) are present in both MDLs and PDLs.
These downloaders are associated with 7,635 and 6,886 of
typedlr:dom and typedom:dlr PDLs, which account for 97.8%
and 99.8% of all the PDLs. 100 of these downloaders dropped
payloads known to be malicious, while the other ones down-
loaded other ﬁles in lockstep with the malware droppers. The
PUP publishers from Figure 5 distributed 13 trojan fami-
lies, including vundo, pasta, symmi, crone, pahador,
pecompact, scar, dapato, renum, jorik, fareit,
llac, and kazy. We also observed generic trojans, induc
(virus), zeroaccess (botnet), onescan (fakeAV), pincav
(keystroke logger), dnschanger, startpage, and several
worms delivered through these publishers.
To further illuminate the connection of the malware and
PUP delivery ecosystems, we compare the publishers from our
locksteps to the ones from the Malsign blacklist of certiﬁcates
used to sign PUP and malware payloads [23]. In this way,
we identify 1,926 downloaders signed by 212 publishers from
malsign, which were involved in 70,984 and 5,468 of MDLs
and PDLs respectively. This suggests that many publishers
thought to belong to the PUP category are also involved in
malware delivery. Considering that many of the unknown ﬁles
in our data set may be malware samples (83% of our payloads
were never submitted to VirusTotal), the number of MDLs is
likely higher.
These results contradict
two recent studies [22], [38],
which did not ﬁnd a substantial overlap between the mal-
ware and PUP delivery ecosystems. The key distinction is
these studies analyzed direct download relationships
that
between publisher pairs, while lockstep detection allows us
to identify indirect relationships, through the neighbor links
discussed in Section V-A. These indirect
links can over-
come evasive strategies such as certiﬁcate polymorphism
or utilizing unsigned downloaders for malicious payloads.
In particular,
in Somoto’s locksteps, 90.6% of the down-
loaders, on average, are either unsigned or have invalid
certiﬁcates. We also observe several PUPs with over 50%
ratio,
including Strongvault Online Storage LLC,
Save Valet, and LLC Mail.Ru. Variations in experimen-
tal methods may further explain the different results. Thomas
et al. [38] milk PPI downloaders on hosts located in the
US, while our data set
includes hosts from 72 countries.
Geographical targeting has been reported previously for PPI
providers [8]. Additionally, their data set covers a different
observation period. In contrast, Kotzias et al. [22] analyze
data from WINE from a time span that largely overlaps with
our observation period. However, they focus on 70 malware
families, excluding for instance trojans that received generic
labels from anti-virus vendors.
9
Fig. 5: Business relationship: (a) Both partner and neighbor, (b) partner relationship for PPIs. (node color red/orange/blue/gray
corresponds to PPI/PUP/benign/other).
Fig. 6: Approximate FP Tree Level of the MDLs.
C. Properties of MDLs
We identify a total of 54,497 and 51,831 locksteps of
typedlr:dom and typedom:dlr, respectively, that download at
least one malware. These MDLs come from 246 and 169
rep-pub each. In addition to the PPI and PUP delivery vec-
tors discussed above, we observed that malware is some-
times distributed through compromised software updates. We
identiﬁed a malware distribution campaign involving the
KMP Media Co., which is a legitimate media player. The
campaign distributed trojan dofoil. The version of the media
player involved in the MDL is 3.6.0.87, which is known
to have a stack overﬂow vulnerability16 that was exploited
in the wild.17 Additionally, while experimenting with larger
values for ∆t, we observed a Hewlett-Packard software updater
deliver the hexzone ransomware.18
16https://www.krcert.or.kr/data/secNoticeView.
do?bulletin writing sequence=2147&queryString=
cGFnZT0xJnNvcnRfY29kZT0mc2VhcmNoX3NvcnQ9a2V5d29y
ZCZzZWFyY2hfd29yZD1pb3M=
17https://www.virustotal.com/en/ﬁle/ff49e145515bdecbca61b7d9
7439959be5b04b1c29d77a0e8c42a1c1bed42aa8
18We did not ﬁnd evidence that HP’s code signing certiﬁcate was compro-
mised; it is more likely that the malware was able to infect the server-side
infrastructure involved in software updates. This is consistent with prior reports
of a trojan that was signed by HP after it infected the company’s systems, but
without having compromised any certiﬁcates [24].
We observe several features that distinguish MDLs from
other locksteps. Figure 6 illustrates the approximate FP tree
level where the MDLs reside. As each node in the FP tree
corresponds to a lockstep, the typical level of MDLs indicates
the region of the FP tree where we are most likely to ﬁnd
evidence of malware distribution. This is an approximation, as
we may add or subtract a level when computing near-bicliques,
as described in Section IV-E. The median FP tree level where
locksteps reside is 5, for both typedlr:dom and typedom:dlr. In
other words, the median number of downloaders in a MDL
is 5. This is relatively close to the root of the FP tree, as
malware delivery networks rely on only a few downloaders
within a time window. This observation helps us improve the
performance of Beewolf in streaming mode, as discussed in
Section VII.
We also observe that MDLs tend to have a large number of
nodes, as illustrated in Figure 7(a). In contrast, although we
see a few large PDLs, around 90% PDLs have fewer than
25 nodes and over 90% BDLs have fewer than 75 nodes.
Figure 7(b) illustrates the number of domains per day for each
locksteps. We observed MDLs showing aggressive domain
churn (more than 7 domains per day). Figure 7(c) illustrates
the number of downloaders per day for each lockstep. On
average, a new downloader appears for every 5.8/16.7/11.8
days for MDLs/PDLs/BDLs respectively. We also observed
MDLs showing aggressive downloader repacking (more than