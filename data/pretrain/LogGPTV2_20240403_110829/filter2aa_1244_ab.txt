• Images may be referenced by index or by 
name.
• Useful when web servers lack file 
permissions to read/write files
Executable image example #1
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
The Executable Image Exploit
www.schrenk.com
• Doesn’t require any special graphics 
libraries
• Image must be previously stored in 
database as a blob
• Images may be referenced by index or 
by name.
• Useful when web servers lack file 
permissions to read/write files
Executable image example #1
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
The Executable Image Exploit
www.schrenk.com
• Doesn’t require any special graphics 
libraries
• Image must be previously stored in 
database as a blob
• Images may be referenced by index or 
by name.
• Useful when web servers lack file 
permissions to read/write files
Executable image example #1
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
The Executable Image Exploit
www.schrenk.com
Executable image example #2
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
You can identify the image to display in a query 
string.
The Executable Image Exploit
www.schrenk.com
Executable image example #2
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
The Executable Image Exploit
www.schrenk.com
Executable image example #2
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
The Executable Image Exploit
www.schrenk.com
Executable image example #2
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
The Executable Image Exploit
www.schrenk.com
Executable image example #2
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
The Executable Image Exploit
www.schrenk.com
Executable image example #2
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
The Executable Image Exploit
www.schrenk.com
Executable image example #2
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
The Executable Image Exploit
www.schrenk.com
http://localhost/defcon/show_referenced.php?id=alexispark.jpg
http://localhost/defcon/show_referenced.php?id=riviera.jpg
You can identify the image to display in a 
query string.
Executable image example #2
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
The Executable Image Exploit
www.schrenk.com
http://localhost/defcon/show_referenced.php?id=alexispark.jpg
http://localhost/defcon/show_referenced.php?id=riviera.jpg
You can identify the image to display in a 
query string.
Why do this?
Because it’s an executable program!
It mimics the actions of a real image
Executable image example #2
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
The Executable Image Exploit
www.schrenk.com
http://localhost/defcon/show_referenced.php?id=alexispark.jpg
http://localhost/defcon/show_referenced.php?id=riviera.jpg
You can identify the image to display in a 
query string.
Why do this?
Because it’s an executable program!
It mimics the actions of a real image
// Create an image handle from an actual JPG image
$im = imagecreatefromjpeg( $_GET['id'] );
// Define font and font color
$font = 'arial.ttf';
$color = imagecolorallocate ($im, 255, 120, 0);
// Define executable content
$text = date("M d, Y h:m:s A", time());
$angle = rand(0, 90);
imagettftext($im, 20, $angle, 11, 301, $color, $font, $text);
// Create an image from the handle and send to browser
header("Content-type: image/jpeg");
imagejpeg($im);
// Destroy the old image (no longer needed)
imagedestroy($im);
exit;
Executable image example #3
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
The Executable Image Exploit
www.schrenk.com
// Create an image handle from an actual JPG image
$im = imagecreatefromjpeg( $_GET['id'] );
// Define font and font color
$font = 'arial.ttf';
$color = imagecolorallocate ($im, 255, 120, 0);
// Define executable content
$text = date("M d, Y h:m:s A", time());
$angle = rand(0, 90);
imagettftext($im, 20, $angle, 11, 301, $color, $font, $text);
// Create an image from the handle and send to browser
header("Content-type: image/jpeg");
imagejpeg($im);
// Destroy the old image (no longer needed)
imagedestroy($im);
exit;
Executable image example #3
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
The Executable Image Exploit
www.schrenk.com
// Create an image handle from an actual JPG image
$im = imagecreatefromjpeg( $_GET['id'] );
// Define font and font color
$font = 'arial.ttf';
$color = imagecolorallocate ($im, 255, 120, 0);
// Define executable content
$text = date("M d, Y h:m:s A", time());
$angle = rand(0, 90);
imagettftext($im, 20, $angle, 11, 301, $color, $font, $text);
// Create an image from the handle and send to browser
header("Content-type: image/jpeg");
imagejpeg($im);
// Destroy the old image (no longer needed)
imagedestroy($im);
exit;
Executable image example #3
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
The Executable Image Exploit
www.schrenk.com
// Create an image handle from an actual JPG image
$im = imagecreatefromjpeg( $_GET['id'] );
// Define font and font color
$font = 'arial.ttf';
$color = imagecolorallocate ($im, 255, 120, 0);
// Define executable content
$text = date("M d, Y h:m:s A", time());
$angle = rand(0, 90);
imagettftext($im, 20, $angle, 11, 301, $color, $font, $text);
// Create an image from the handle and send to browser
header("Content-type: image/jpeg");
imagejpeg($im);
// Destroy the old image (no longer needed)
imagedestroy($im);
exit;
Executable image example #3
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
The Executable Image Exploit
www.schrenk.com
// Create an image handle from an actual JPG image
$im = imagecreatefromjpeg( $_GET['id'] );
// Define font and font color
$font = 'arial.ttf';
$color = imagecolorallocate ($im, 255, 120, 0);
// Define executable content
$text = date("M d, Y h:m:s A", time());
$angle = rand(0, 90);
imagettftext($im, 20, $angle, 11, 301, $color, $font, $text);
// Create an image from the handle and send to browser
header("Content-type: image/jpeg");
imagejpeg($im);
// Destroy the old image (no longer needed)
imagedestroy($im);
exit;
Executable image example #3
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
The Executable Image Exploit
www.schrenk.com
Executable image example #3
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Result of executable image #3
The Executable Image Exploit
www.schrenk.com
• Dynamic Example
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Executable images Can:
• Display images stored in databases
• Programmatically select images to display
• Dynamically produce image content
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Executable images Can:
• Display images stored in databases
• Programmatically select images to display
• Dynamically produce image content
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Executable images Can:
• Display images stored in databases
• Programmatically select images to display
• Dynamically produce image content
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Executable images Can:
• Do anything a script can do:
– Read referrer variables, 
• To see the page previous to viewing you image’s page
• To see the query string on the previous page
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Executable images Can:
• Do anything a script can do:
– Read referrer variables, 
• To see the page previous to viewing you image’s page
• To see the query string on the previous page
– Read & write cookies
• To track individuals
• Works across domains
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Executable images Can:
• Do anything a script can do:
– Read referrer variables, 
• To see the page previous to viewing you image’s page
• To see the query string on the previous page
– Read & write cookies
• To track individuals
• Works across domains
– Access databases
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Executable images Can:
• Do anything a script can do:
– Read referrer variables, 
• To see the page previous to viewing you image’s page
• To see the query string on the previous page
– Read & write cookies
• To track individuals
• Works across domains
– Access databases
– Communicate via email, SMS, etc.
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Doing the dirty
// Create an image from the handle and send to browser
header("Content-type: image/jpeg");
// Write Cookie
setcookie("TestCookie", $value);
// Read Cookie
$old_cookie = $HTTP_COOKIE_VARS["TestCookie"];
// Get referer variable
$referer = $_SERVER['HTTP_REFERER'];
// Get query strings
$query_string = $_SERVER['QUERY_STRING'];
// Anything else
imagejpeg($im);
The Executable Image Exploit
www.schrenk.com
The Executable Image Exploit
DEFCON XV Las Vegas Nevada
PI:EMAIL
Doing the dirty
// Create an image from the handle and send to browser
header("Content-type: image/jpeg");
// Write Cookie
setcookie("TestCookie", $value);
// Read Cookie
$old_cookie = $HTTP_COOKIE_VARS["TestCookie"];
// Get referer variable