User: 请回答以下安全问题我的API用户使用passport-GitHub“使用GitHub登录”安全吗？我知道OAuth2的设计目的是将授权授予委托给特定的资源，它本身并不是一个身份验证协议。然而，护照github自述指出，
该模块允许您在Node.js应用中使用GitHub进行身份验证。通过插入Passport，GitHub身份验证可以轻松而不引人注目地集成[…]
GitHub身份验证策略使用GitHub帐户和OAuth 2.0令牌对用户进行身份验证。
通过在我的HelloAPI中使用passport github，最终用户将被引导到github的授权服务器，以启动三格authorization_code流：
首先，用户使用GitHub进行身份验证，并授予对HelloAPI的有限访问权限。
GitHub使用预先注册的redirect_uri将用户代理（浏览器）重定向回HelloAPI。重定向URI包括授权码，以及可选的用于跨站点请求伪造检测的状态参数。
HelloAPI使用client_secret作为向GitHub验证HelloAPI的手段，快速地将代码交换为访问令牌。（在这里，我也应该包括一个状态参数。）
最后，HelloAPI使用该令牌来获取与该令牌相关联的GitHub配置文件。
在这里，我们假设令牌不是由其他客户端创建的，随后作为模仿GitHub资源所有者的攻击重放到HelloAPI。通过检查状态参数，我认为这是一个安全的假设，但是https://oauth.net/articles/authentication/警告不要这样做：
OAuthAPI不为返回的信息提供任何受众限制机制。换言之，很有可能获得一个天真的客户端，将来自另一个客户端的（有效）令牌交给它，并让天真的客户端将其视为“有效”令牌；登录”；事件毕竟，令牌是有效的，对API的调用将返回有效的用户信息。当然，问题是用户没有做任何事情来证明他们在场，在这种情况下，他们甚至没有授权天真的客户端。
因此，这是我在使用passport github时的犹豫：它使用OAuth2令牌进行身份验证，这正是专家们所警告的。包含一个状态参数似乎可以保护这个服务器到服务器的authorization_code流，但我不确定。
我错过了什么？护照github身份验证安全吗；使用GitHub登录&quot；功能安全？

Assistant: 我不认为GitHub OAuth2实现支持您的用例来验证用户，所以从安全性和可维护性的角度来看，我认为这不是一个好主意。从文件的第一段来看：
OAuth2是一种协议，允许外部应用在不获取密码的情况下请求对用户GitHub帐户中的私人详细信息的授权。
我在下面讨论中的假设是，GitHub OAuth2实现中的授权代码和访问令牌对您的客户端是不透明的。
在GitHub场景中，我们有以下OAuth角色：
资源服务器-提供用户配置文件信息的GitHub服务器
客户端-您的HelloAPI
授权服务器-GitHub身份验证服务器
资源所有者-您的应用最终用户
passport github实现通过使用客户端作为OAuth2流的一部分获得的访问令牌来验证用户，然后从位于的github资源服务器请求用户配置文件信息https://api.github.com/user.
例如：
Joe Bloggs通过客户端重定向登录GitHub。
您的客户端接收的访问令牌是不透明的，不包含有关Joe身份的信息。
您从客户端向GitHub资源服务器发出请求，以检索与访问令牌关联的配置文件
Joe的配置文件由资源服务器返回，您假设Joe是向您的客户端提供访问令牌的实体。
对我来说，问题是，在这个过程中，没有直接的“证据”来确保作为OAuth流的一部分向GitHub进行身份验证的身份与在应用中用于做出身份验证决定的配置文件信息中返回的身份相同。对我来说，从信息完整性的角度来看，这是一个失败，所以我不认为这是“安全的”。
考虑到passport github实现似乎不是github支持的身份验证场景，如果github以任何方式更改其实现，也会产生风险。最好使用支持的协议，并将API用于其预期目的，以确保安全性和可维护性。