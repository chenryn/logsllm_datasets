ldapsearch -H ldap://test.local -b DC=test,DC=local 
"(objectclass=group)" 
ldapsearch -H ldap://test.local -b DC=test,DC=local 
"(&(objectclass=group)(name=[groupname]))" 
ldapsearch -H ldap://test.local -b DC=test,DC=local 
"(&(objectclass=group)(name=*admin*))" 
Domain Information: 
dsconfigad -show 
  LDAP: 
ldapsearch -H ldap://test.local -b DC=test,DC=local 
"(objectclass=trusteddomain)" 
M
M 
MACOS_Defend 
BLUE TEAM 
FORENSICS 
MacOS 
Evidence Collection Order of Volatility (RFC3227) 
• 
Registers, cache 
• 
Routing table, arp cache, process table, kernel statistics, 
memory 
• 
Temporary file systems 
• 
Disk 
• 
Remote logging and monitoring data that is relevant to the 
system in question 
• 
Physical configuration, network topology 
• 
Archival media 
MacOS FORENSIC/DEFENSIVE TOOLS 
VENATOR 
macOS tool for proactive detection 
REFERENCE: 
https://github.com/richiercyrus/Venator 
164 
https://posts.specterops.io/introducing-venator-a-macos-tool-for-proactive-
detection-34055a017e56 
Google Santa Process Whitelisting 
Santa is a binary whitelisting/blacklisting system for macOS. 
REFERENCE: 
https://github.com/google/santa 
KNOCK KNOCK 
See what's persistently installed on your Mac. KnockKnock uncovers 
persistently installed software in order to generically reveal 
malware. 
REFERENCE: 
https://objective-see.com/products.html 
LuLu 
LuLu is the free, open firewall for Macs that can protect your 
network connections and detect malicious activity. 
REFERENCE: 
https://objective-see.com/products.html 
BlockBlock 
BlockBlock provides continual protection by monitoring persistence 
locations. Any new persistent component will trigger a BlockBlock 
alert, allowing malicious items be blocked. 
REFERENCE: 
https://objective-see.com/products.html 
Netiquette 
Netiquette, a network monitor, allows one to explore all network 
sockets and connections, either via an interactive UI, or from the 
commandline. 
REFERENCE: 
https://objective-see.com/products.html 
mac_apt 
mac_apt is a DFIR tool to process Mac computer full disk images (or 
live machines) and extract data/metadata useful for forensic 
investigation. 
REFERENCE: 
https://github.com/ydkhatri/mac_apt 
OSXCollector 
The collection script runs on a potentially infected machine and 
outputs a JSON file that describes the target machine. OSXCollector 
gathers information from plists, SQLite databases and the local 
file system. 
REFERENCE: 
https://github.com/Yelp/OSXCollector 
REVERSING MacOS MALWARE 
165 
#Install Apple Command Line Tools 
Tools include:  
strings -string decoder 
file, nm, xattr, mdls -file analysis utilities  
hexdump, od, xxd -hex editors 
otool -static disassembler 
lldb -debugger, memory reader and dynamic disassembler 
#File type the malware sample: 
file malware_file 
xattr -l malware_file 
ls -al@ malware_file 
#If signed check _CodeSignature for IoCs. 
codesign -dvvvv -r - malware_file.app/ 
#Look for TeamIdentifier & Bundle Identifier 
#Check is certificate is still valid or revoked: 
spctl --verbose=4 --assess --type execute malware_file.app 
#Application Bundle Enumeration 
putil -p malware_file.app/Contents/Info.plist 
#PageStuff & nm to look at internal structure 
nm -m malware_file.app/MacOS/malware_file 
pagestuff malware_file.app/MacOS/malware_file -a 
#Dump Strings to a file for review 
strings - malware_file > malwareStrings.txt 
#Use otool to find shared library links, method names, & 
disassembly 
otool -L malware_file >  malwareLibs.txt 
otool -oV malware_file > malwareMethods.txt 
otool -tV malware_file > malwareDisassembly.txt 
MacOS MISC 
Show System Logs 
logs show > logs.txt 
sudo logs collect  --output  
MacOS ARTIFACT LOCATIONS 
AUTORUN LOCATIONS 
Launch Agents files 
/Library/LaunchAgents/* 
166 
" 
/System/Library/LaunchAgents/* 
" 
%%users.homedir%%/Library/LaunchAgents/* 
Launch Daemons 
files 
/Library/LaunchDaemons/* 
" 
/System/Library/LaunchDaemons/* 
Startup Items file 
/Library/StartupItems/* 
" 
/System/Library/StartupItems/* 
SYSTEM LOGS 
System Log files 
main folder 
/var/log/* 
Apple System Log 
/var/log/asl/* 
Audit Log 
/var/audit/* 
Installation log 
/var/log/install.log 
Mac OS X utmp and 
wmtp login record 
file 
/var/log/wtmp 
" 
/var/log/utmp 
Mac OS X lastlog 
file 
/var/log/lastlog 
Mac OS X 10.5 utmpx 
login record file 
/var/run/utmpx 
Apple Unified 
Logging and 
Activity Tracing 
/var/db/diagnostics/*.tracev3 
" 
/var/db/diagnostics/*/*.tracev3 
" 
/var/db/uuidtext/*/* 
SYSTEM PREFERENCES 
System Preferences 
plist files 
/Library/Preferences/** 
Global Preferences 
plist file 
/Library/Preferences/.GlobalPreferences.pli
st 
Login Window Info 
/Library/Preferences/com.apple.loginwindow.
plist 
Bluetooth 
Preferences and 
paierd device info 
/Library/Preferences/com.apple.Bluetooth.pl
ist 
Time Machine Info 
/Library/Preferences/com.apple.TimeMachine.
plist 
Keyboard layout 
plist file 
/Library/Preferences/com.apple.HIToolbox.pl
ist 
System 
configuration 
preferences plist 
file 
/Library/Preferences/SystemConfiguration/pr
eferences.plist 
SYSTEM 
SETTINGS/INFO 
OS Installation 
time 
/var/db/.AppleSetupDone 
OS name and version 
/System/Library/CoreServices/SystemVersion.
plist 
167 
Users Log In 
Password Hash Plist 
/var/db/dslocal/nodes/Default/users/*.plist 
SLEEP/HYBERNATE 
SWAP 
Sleep Image File 
/var/vm/sleepimage 
Swap Files 
/var/vm/swapfile# 
KERNEL EXTENSIONS 
Kernel extension 
(.kext) files 
/System/Library/Extensions/* 
" 
/Library/Extensions/* 
SOFTWARE 
INSTALLATION 
Software 
Installation 
History 
/Library/Receipts/InstallHistory.plist 
Software Update 
/Library/Preferences/com.apple.SoftwareUpda
te.plist 
SYSTEM INFO MISC. 
Local Time Zone 
configuration 
/etc/localtime 
Mac OS X at jobs 
/usr/lib/cron/jobs/* 
Cron tabs 
/etc/crontab 
" 
/usr/lib/cron/tabs/* 
Periodic system 
functions scripts 
and configuration 
/etc/defaults/periodic.conf 
" 
/etc/periodic.conf 
" 
/etc/periodic.conf.local 
" 
/etc/periodic/**2 
" 
/usr/local/etc/periodic/**2 
" 
/etc/daily.local/* 
" 
/etc/weekly.local/* 
" 
/etc/monthly.local/* 
" 
/etc/periodic/daily/* 
" 
/etc/periodic/weekly/* 
" 
/etc/periodic/monthly/* 
NETWORKING 
Hosts file 
/etc/hosts 
Remembered Wireless 
Networks 
/Library/Preferences/SystemConfiguration/co
m.apple.airport.preferences.plist 
USER ARTIFACTS 
AUTORUN 
Login Items 
%%users.homedir%%/Library/Preferences/com.a
pple.loginitems.plist 
USERS 
Users directories 
in /Users 
/Users/* 
USER DIRECTORIES 
Downloads Directory 
%%users.homedir%%/Downloads/* 
168 
Documents Directory 
%%users.homedir%%/Documents/* 
Music Directory 
%%users.homedir%%/Music/* 
Desktop Directory 
%%users.homedir%%/Desktop/* 
Library Directory 
%%users.homedir%%/Library/* 
Movies Directory 
%%users.homedir%%/Movies/* 
Pictures Directory 
%%users.homedir%%/Pictures/* 
Public Directory 
%%users.homedir%%/Public/* 
Applications 
/Applications/* 
PREFERENCES 
User preferences 
directory 
%%users.homedir%%/Library/Preferences/* 
iCloud user 
preferences 
%%users.homedir%%/Library/Preferences/Mobil
eMeAccounts.plist 
Sidebar Lists 
Preferences 
%%users.homedir%%/Library/Preferences/com.a
pple.sidebarlists.plist 
" 
%%users.homedir%%/Preferences/com.apple.sid
ebarlists.plist 
User Global 
Preferences 
%%users.homedir%%/Library/Preferences/.Glob
alPreferences.plist 
Dock database 
%%users.homedir%%/Library/Preferences/com.a
pple.Dock.plist 
Attached iDevices 
%%users.homedir%%/Library/Preferences/com.a
pple.iPod.plist 
Quarantine Event 
Database 
%%users.homedir%%/Library/Preferences/com.a
pple.LaunchServices.QuarantineEvents 
" 
%%users.homedir%%/Library/Preferences/com.a
pple.LaunchServices.QuarantineEventsV2 
LOGS 
User and 
Applications Logs 
Directory 
%%users.homedir%%/Library/Logs/* 
Misc. Logs 
/Library/Logs/* 
Terminal Commands 
History 
%%users.homedir%%/.bash_history 
Terminal Commands 
Sessions 
%%users.homedir%%/.bash_sessions/* 
USER'S ACCOUNTS 
User's Social 
Accounts 
%%users.homedir%%/Library/Accounts/Accounts
3.sqlite 
iDEVICE BACKUPS 
iOS device backups 
directory 
%%users.homedir%%/Library/Application 
Support/MobileSync/Backup/* 
iOS device backup 
information 
%%users.homedir%%/Library/Application 
Support/MobileSync/Backup/*/info.plist 
iOS device backup 
apps information 
%%users.homedir%%/Library/Application 
Support/MobileSync/Backup/*/Manifest.plist 
iOS device backup 
files information 
%%users.homedir%%/Library/Application 
Support/MobileSync/Backup/*/Manifest.mbdb 
iOS device backup 
status information 
%%users.homedir%%/Library/Application 
Support/MobileSync/Backup/*/Status.plist 
169 
RECENT ITEMS 
Recent Items 
%%users.homedir%%/Library/Preferences/com.a
pple.recentitems.plist 
Recent Items 
application 
specific 
%%users.homedir%%/Library/Preferences/*LSSh
aredFileList.plist 
MISC 
Application Support 
Directory 
%%users.homedir%%/Library/Application 
Support/* 
Keychain Directory 
%%users.homedir%%/Library/Keychains/* 
User Trash Folder 
%%users.homedir%%/.Trash/* 
macOS 
NotificationCenter 
database 
/private/var/folders/[a-z][0-
9]/*/0/com.apple.notificationcenter/db2/db 
" 
/private/var/folders/[a-z][0-
9]/*/0/com.apple.notificationcenter/db/db 
" 
%%users.homedir%%/Library/Application 
Support/NotificationCenter/*.db 
KnowledgeC User and 
Application usage 
database 
%%users.homedir%%/Library/Application 
Support/Knowledge/knowledgeC.db 
" 
/private/var/db/CoreDuet/Knowledge/knowledg
eC.db 
APPLICATIONS 
ARTIFACTS 
iCLOUD 
iCloud Accounts 
%%users.homedir%%/Library/Application 
Support/iCloud/Accounts/* 
SKYPE 
Skype Directory 
%%users.homedir%%/Library/Application 
Support/Skype/* 
Skype User profile 
%%users.homedir%%/Library/Application 
Support/Skype/*/* 
Skype Preferences 
and Recent Searches 
%%users.homedir%%/Library/Preferences/com.s
kype.skype.plist 
Main Skype database 
%%users.homedir%%/Library/Application 
Support/Skype/*/Main.db 
Chat Sync Directory 
%%users.homedir%%/Library/Application 
Support/Skype/*/chatsync/* 
SAFARI 
Safari Main Folder 
%%users.homedir%%/Library/Safari/* 
Safari Bookmarks 
%%users.homedir%%/Library/Safari/Bookmarks.
plist 
Safari Downloads 
%%users.homedir%%/Library/Safari/Downloads.
plist 
Safari Installed 
Extensions 
%%users.homedir%%/Library/Safari/Extensions
/Extensions.plist 
" 
%%users.homedir%%/Library/Safari/Extensions
/* 
170 
Safari History 
%%users.homedir%%/Library/Safari/History.pl
ist 
" 
%%users.homedir%%/Library/Safari/History.db 
Safari History 
Index 
%%users.homedir%%/Library/Safari/HistoryInd
ex.sk 
Safari Last Session 
%%users.homedir%%/Library/Safari/LastSessio
n.plist 
Safari Local 
Storage Directory 
%%users.homedir%%/Library/Safari/LocalStora
ge/* 
Safari Local 
Storage Database 
%%users.homedir%%/Library/Safari/LocalStora
ge/StorageTracker.db 
Safari Top Sites 
%%users.homedir%%/Library/Safari/TopSites.p
list 
Safari Webpage 
Icons Database 
%%users.homedir%%/Library/Safari/WebpageIco
ns.db 
Safari Webpage 
Databases 
%%users.homedir%%/Library/Safari/Databases/
* 
Safari Cache 
Directory 
%%users.homedir%%/Library/Caches/com.apple.
Safari/* 
Safari Cache 
%%users.homedir%%/Library/Caches/com.apple.
Safari/Cache.db 
Safari Extensions 
Cache 
%%users.homedir%%/Library/Caches/com.apple.
Safari/Extensions/* 
Safari Webpage 
Previews 
%%users.homedir%%/Library/Caches/com.apple.
Safari/Webpage Previews/* 
Safari Cookies 
%%users.homedir%%/Library/Cookies/Cookies.b
inarycookies 
Safari Preferences 
and Search terms 
%%users.homedir%%/Library/Preferences/com.a
pple.Safari.plist 
Safari Extension 
Preferences 
%%users.homedir%%/Library/Preferences/com.a
pple.Safari.Extensions.plist 
Safari Bookmark 
Cache 
%%users.homedir%%/Library/Caches/Metadata/S
afari/Bookmarks/* 
Safari History 
Cache 
%%users.homedir%%/Library/Caches/Metadata/S
afari/History/* 
Safari Temporary 
Images 
%%users.homedir%%/Library/Caches/com.apple.
Safari/fsCachedData/* 
FIREFOX 
Firefox Directory 
%%users.homedir%%/Library/Application 
Support/Firefox/* 
Firefox Profiles 
%%users.homedir%%/Library/Application 
Support/Firefox/Profiles/* 
Firefox Cookies 
%%users.homedir%%/Library/Application 
Support/Firefox/Profiles/*/Cookies.sqlite 
Firefox Downloads 
%%users.homedir%%/Library/Application 
Support/Firefox/Profiles/*/Downloads.sqlite 
Firefox Form 
History 
%%users.homedir%%/Library/Application 
Support/Firefox/Profiles/*/Formhistory.sqli
te 
171 
Firefox History 
%%users.homedir%%/Library/Application 
Support/Firefox/Profiles/*/Places.sqlite 
Firefox Signon 
%%users.homedir%%/Library/Application 
Support/Firefox/Profiles/*/signons.sqlite 
Firefox Key 
%%users.homedir%%/Library/Application 
Support/Firefox/Profiles/*/key3.db 
Firefox Permissions 
%%users.homedir%%/Library/Application 
Support/Firefox/Profiles/*/permissions.sqli
te 
Firefox Add-ons 
%%users.homedir%%/Library/Application 
Support/Firefox/Profiles/*/addons.sqlite 
" 
%%users.homedir%%/Library/Application 
Support/Firefox/Profiles/*/addons.json 
Firefox Extension 
%%users.homedir%%/Library/Application 
Support/Firefox/Profiles/*/extensions.sqlit
e 
" 
%%users.homedir%%/Library/Application 
Support/Firefox/Profiles/*/extensions.json 
Firefox Pages 
Settings 
%%users.homedir%%/Library/Application 
Support/Firefox/Profiles/*/content-
prefs.sqlite 
Firefox Cache 
%%users.homedir%%/Library/Caches/Firefox/Pr
ofiles/*.default/Cache/* 
" 
%%users.homedir%%/Library/Caches/Firefox/Pr
ofiles/*.default/cache2/* 
" 
%%users.homedir%%/Library/Caches/Firefox/Pr
ofiles/*.default/cache2/doomed/* 
" 
%%users.homedir%%/Library/Caches/Firefox/Pr
ofiles/*.default/cache2/entries/* 
CHROME 
Chrome Main Folder 
%%users.homedir%%/Library/Application 
Support/Google/Chrome/* 
Chrome Default 
profile 
%%users.homedir%%/Library/Application 
Support/Google/Chrome/default/* 
Chrome History 
%%users.homedir%%/Library/Application 
Support/Google/Chrome/*/History 
" 
%%users.homedir%%/Library/Application 
Support/Google/Chrome/*/Archived History 
" 
%%users.homedir%%/Library/Application 
Support/Google/Chrome Canary/*/Archived 
History 
" 
%%users.homedir%%/Library/Application 
Support/Google/Chrome Canary/*/History 
Chrome Bookmarks 
%%users.homedir%%/Library/Application 
Support/Google/Chrome/*/Bookmarks 
Chrome Cookies 
%%users.homedir%%/Library/Application 
Support/Google/Chrome/*/Cookies 
Chrome Local 
Storage 
%%users.homedir%%/Library/Application 
Support/Google/Chrome/*/Local Storage/* 
172 
Chrome Login Data 
%%users.homedir%%/Library/Application 
Support/Google/Chrome/*/Login Data 
Chrome Top Sites 
%%users.homedir%%/Library/Application 
Support/Google/Chrome/*/Top Sites 
Chrome Web Data 
%%users.homedir%%/Library/Application 
Support/Google/Chrome/*/Web Data 
Chrome Extensions 
%%users.homedir%%/Library/Application 
Support/Google/Chrome/*/databases/* 
" 
%%users.homedir%%/Library/Application 
Support/Google/Chrome/*/databases/Databases
.db 
" 
%%users.homedir%%/Library/Application 
Support/Google/Chrome/*/Extensions/**10 