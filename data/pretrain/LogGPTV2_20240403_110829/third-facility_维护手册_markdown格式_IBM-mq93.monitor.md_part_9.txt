UnrecordedActivities MQCFIN
DiscontinuityCount MQCFIN
MaxActivities MQCFIN
Accumulate MQCFIN
Forward MQCFIN
Deliver MQCFIN
Descriptions of each parameter in the TraceRoute PCF group follows:
Detail
Specifies the detail level of activity information that is to be recorded. The value can be any of the
following values:
MQROUTE_DETAIL_LOW
Only activities performed by user application are recorded.
MQROUTE_DETAIL_MEDIUM
Activities specified in MQROUTE_DETAIL_LOW should be recorded. Additionally, activities
performed by MCAs are recorded.
MQROUTE_DETAIL_HIGH
Activities specified in MQROUTE_DETAIL_LOW, and MQROUTE_DETAIL_MEDIUM should be
recorded. MCAs do not record any further activity information at this level of detail. This option is
only available to user applications that are to record further activity information. For example,
72 Monitoring and Performance for IBM MQ
if a user application determines the route a message takes by considering certain message
characteristics, the information about the routing logic could be included with this level of detail.
RecordedActivities
Specifies the number of recorded activities performed on behalf of the trace-route message. An
activity is considered to be recorded if information about it has been written to the trace-route
message, or if an activity report has been generated. For every recorded activity, RecordedActivities
increments by one.
UnrecordedActivities
Specifies the number of unrecorded activities performed on behalf of the trace-route message. An
activity is considered to be unrecorded if an application that is enabled for trace-route messaging
neither accumulates, nor writes the related activity information to an activity report.
An activity performed on behalf of a trace-route message is unrecorded in the following
circumstances:
• The detail level of the performed activity is less than the level of detail specified by the parameter
Detail.
• The trace-route message requests an activity report but not accumulation, and the queue manager
is not enabled for activity recording.
• The trace-route message requests accumulation but not an activity report, and the queue manager
is not enabled for trace-route messaging.
• The trace-route message requests both accumulation and an activity report, and the queue
manager is not enabled for activity recording and trace route messaging.
• The trace-route message requests neither accumulation nor an activity report.
For every unrecorded activity the parameter, UnrecordedActivities, increments by one.
DiscontinuityCount
Specifies the number of times the trace-route message has been routed through a queue manager
with applications that were not enabled for trace-route messaging. This value is incremented by the
queue manager. If this value is greater than 0, only a partial message route can be determined.
MaxActivities
Specifies the maximum number of activities that can be performed on behalf of the trace-route
message.
The total number of activities is the sum of RecordedActivities, UnrecordedActivities, and
DiscontinuityCount. The total number of activities must not exceed the value of MaxActivities.
The value of MaxActivities can be:
A positive integer
The maximum number of activities.
If the maximum number of activities is exceeded, the trace-route message is rejected with
feedback MQFB_MAX_ACTIVITIES. This can prevent the trace-route message from being
forwarded indefinitely if caught in an infinite loop.
MQROUTE_UNLIMITED_ACTIVITIES
An unlimited number of activities can be performed on behalf of the trace-route message.
Accumulate
Specifies the method used to accumulate activity information. The value can be any of the following
values:
MQROUTE_ACCUMULATE_IN_MSG
If the queue manager is enabled for trace-route messaging, activity information is accumulated in
the message data of the trace-route message.
If this value is specified, the trace-route message data consists of the following:
• The TraceRoute PCF group.
IBM MQ Monitoring and performance 73
• Zero or more Activity PCF groups.
MQROUTE_ACCUMULATE_AND_REPLY
If the queue manager is enabled for trace-route messaging, activity information is accumulated in
the message data of the trace-route message, and a trace-route reply message is generated if any
of the following occur:
• The trace-route message is discarded by an IBM WebSphere MQ 6 or later queue manager.
• The trace-route message is put to a local queue (target queue or dead-letter queue) by an IBM
WebSphere MQ 6 or later queue manager.
• The number of activities performed on the trace-route message exceeds the value of
MaxActivities.
If this value is specified, the trace-route message data consists of the following:
• The TraceRoute PCF group.
• Zero or more Activity PCF groups.
MQROUTE_ACCUMULATE_NONE
Activity information is not accumulated in the message data of the trace-route message.
If this value is specified, the trace-route message data consists of the following:
• The TraceRoute PCF group.
Forward
Specifies where a trace-route message can be forwarded to. The value can be:
MQROUTE_FORWARD_IF_SUPPORTED
The trace-route message is only forwarded to queue managers that will honor the value of the
Deliver parameter from the TraceRoute group.
MQROUTE_FORWARD_ALL
The trace-route message is forwarded to any queue manager, regardless of whether the value of
the Deliver parameter will be honored.
Queue managers use the following algorithm when determining whether to forward a trace-route
message to a remote queue manager:
1.Determine whether the remote queue manager is capable of supporting trace-route messaging.
• If the remote queue manager is capable of supporting trace-route messaging, the algorithm
continues to step “4” on page 74.
• If the remote queue manager is not capable of supporting trace-route messaging, the algorithm
continues to step “2” on page 74
2.Determine whether the Deliver parameter from the TraceRoute group contains any unrecognized
delivery options in the MQROUTE_DELIVER_REJ_UNSUP_MASK bit mask.
• If any unrecognized delivery options are found, the trace-route message is rejected with
feedback MQFB_UNSUPPORTED_DELIVERY.
• If no unrecognized delivery options are found, the algorithm continues to step “3” on page 74.
3.Determine the value of the parameter Deliver from the TraceRoute PCF group in the trace-route
message.
• If Deliver is specified as MQROUTE_DELIVER_YES, the trace-route message is forwarded to the
remote queue manager.
• If Deliver is specified as MQROUTE_DELIVER_NO, the algorithm continues to step “4” on page
74.
4.Determine whether the Forward parameter from the TraceRoute group contains any unrecognized
forwarding options in the MQROUTE_FORWARDING_REJ_UNSUP_MASK bit mask.
• If any unrecognized forwarding options are found, the trace-route message is rejected with
feedback MQFB_UNSUPPORTED_FORWARDING.
74 Monitoring and Performance for IBM MQ
• If no unrecognized forwarding options are found, the algorithm continues to step “5” on page
75.
5.Determine the value of the parameter Forward from the TraceRoute PCF group in the trace-route
message.
• If Forward is specified as MQROUTE_FORWARD_IF_SUPPORTED, the trace-route message is
rejected with feedback MQFB_NOT_FORWARDED.
• If Forward is specified as MQROUTE_FORWARD_ALL, trace-route message can be forwarded to
the remote queue manager.
Deliver
Specifies the action to be taken if the trace-route message reaches its intended destination. User-
written applications must check this attribute before placing a trace-route message on its target
queue. The value can be any of the following values:
MQROUTE_DELIVER_YES
On arrival, the trace-route message is put on the target queue. Any application performing a get
operation on the target queue can retrieve the trace-route message.
MQROUTE_DELIVER_NO
On arrival, the trace-route message is not delivered to the target queue. The message is
processed according to its report options.
Setting up a common queue for trace-route reply messages
To determine the locations of the trace-route reply messages related to a specific message when the
reports are delivered to the local system queue, it is more efficient to use a common queue on a single
node
Before you begin
Set the ROUTEREC parameter to enable the queue manager for trace-route messaging and to
specify that any trace-route reply messages generated are delivered to the local system queue
SYSTEM.ADMIN.TRACE.ROUTE.QUEUE.
About this task
If a number of queue managers in a queue manager network are set to deliver trace-route reply messages
to the local system queue, it can be time consuming to determine the locations of the trace-route reply
messages related to a specific message. Alternatively, use a single node, which is a queue manager that
hosts a common queue. All the queue managers in a queue manager network can deliver trace-route
reply messages to this common queue. The benefit of using a common queue is that queue managers do
not have to deliver trace-route reply messages to the reply-to queue specified in a message and, when
determining the locations of the trace-route reply messages related to a message, you query one queue
only.
To set up a common queue, perform the following steps:
Procedure
1.Select or define a queue manager as the single node
2.On the single node, select or define a queue for use as the common queue
3.On all queue managers that forward trace-route reply messages to the common queue, redefine the
local system queue SYSTEM.ADMIN.TRACE.ROUTE.QUEUE as a remote queue definition
a)Specify the name of the single node as the remote queue manager name
b)Specify the name of the common queue as the remote queue name
IBM MQ Monitoring and performance 75
Acquiring and using recorded information
Use any of the following techniques to acquire recorded activity information for a trace-route message
Note that the circumstances in which activity information is not acquired apply also to trace-route reply
messages.
Activity information is not recorded when a trace-route message is processed by a queue manager that is
disabled for both activity recording and trace-route messaging.
Acquiring information from trace-route reply messages
To acquire activity information you locate the trace-route reply message. Then you retrieve the message
and analyze the activity information.
About this task
You can acquire activity information from a trace-route reply message only if you know the location of the
trace-route reply message. Locate the message and process the activity information as follows:
Procedure
1.Check the reply-to queue that was specified in the message descriptor of the trace-route message. If
the trace-route reply message is not on the reply-to queue, check the following locations:
• The local system queue, SYSTEM.ADMIN.TRACE.ROUTE.QUEUE, on the target queue manager of
the trace-route message
• The common queue, if you have set up a common queue for trace-route reply messages
• The local system queue, SYSTEM.ADMIN.TRACE.ROUTE.QUEUE, on any other queue manager in the
queue manager network, which can occur if the trace-route message has been put to a dead-letter
queue, or the maximum number of activities was exceeded
2.Retrieve the trace-route reply message
3.Use the IBM MQ display route application to display the recorded activity information
4.Study the activity information and obtain the information that you need
Acquiring information from trace-route messages
To acquire activity information you locate the trace-route message, which must have the appropriate
parameters in the TraceRoute PCF group. Then you retrieve the message and analyze the activity
information.
About this task
You can acquire activity information from a trace-route message only if you know the location of the
trace-route message and it has the parameter Accumulate in the TraceRoute PCF group specified as either
MQROUTE_ACCUMULATE_IN_MSG or MQROUTE_ACCUMULATE_AND_REPLY.
For the trace-route message to be delivered to the target queue the Deliver parameter in the TraceRoute
PCF group must be specified as MQROUTE_DELIVER_YES.
Procedure
1.Check the target queue. If the trace-route message is not on the target queue, you can try to locate the
trace-route message using a trace-route message enabled for activity recording. With the generated
activity reports try to determine the last known location of the trace-route message.
2.Retrieve the trace-route message
3.Use the IBM MQ display route application to display the recorded activity information
4.Study the activity information and obtain the information that you need
76 Monitoring and Performance for IBM MQ
Acquiring information from activity reports
To acquire activity information you locate the activity report, which must have the report option specified
in the message descriptor. Then you retrieve the activity report and analyze the activity information.
About this task
You can acquire activity information from an activity report only if you know the location of the activity
report and the report option MQRO_ACTIVITY was specified in the message descriptor of the trace-route
message.
Procedure
1.Locate and order the activity reports generated for a trace-route message.
When you have located the activity reports, you can order them manually or use the IBM MQ display
route application to order and display the activity information automatically.
2.Study the activity information and obtain the information that you need
Additional activity information
As a trace-route message is routed through a queue manager network, user applications can record
additional information by including one or more additional PCF parameters when writing the Activity group
to the message data of the trace-route message or activity report.
Additional activity information can help system administrators to identify the route taken by a trace-route
message took, or why that route was taken.
If you use the IBM MQ display route application to display the recorded information for a trace-route
message, any additional PCF parameters can only be displayed with a numeric identifier, unless the
parameter identifier of each parameter is recognized by the IBM MQ display route application. To
recognize a parameter identifier, additional information must be recorded using the following PCF
parameters. Include these PCF parameters in an appropriate place in the Activity PCF group.
GroupName
Table 13. Group name
Description Grouped parameters specifying the additional information.
Identifier MQGACF_VALUE_NAMING.
Data type MQCFGR
Parameters in ParameterName
group
ParameterValue
ParameterName
Table 14. Parameter name
Contains the name to be displayed by the IBM MQ display route application,
Description
which puts the value of ParameterValue into context.
Identifier MQCA_VALUE_NAME.
Data type MQCFST
Included in PCF GroupName.
group:
Value: The name to be displayed.
IBM MQ Monitoring and performance 77
ParameterValue
Table 15. Parameter value
Description Contains the value to be displayed by the IBM MQ display route application.
Identifier: The PCF structure identifier for the additional information.
Data type: The PCF structure data type for the additional information.
Included in PCF GroupName.
group:
Value: The value to be displayed.
Examples of recording additional activity information
The following examples illustrate how a user application can record additional information when
performing an activity on behalf of a trace-route message. In both examples, the IBM MQ display route
application is used to generate a trace-route message, and display the activity information returned to it.
Recording additional activity information: Example 1
Additional activity information is recorded by a user application in a format where the parameter identifier
is not recognized by the IBM MQ display route application.
1.The IBM MQ display route application is used to generate and put a trace-route message into a queue
manager network. The necessary options are set to request the following:
• Activity information is accumulated in the message data of the trace-route message.
• On arrival at the target queue the trace-route message is discarded, and a trace-route reply message
is generated and delivered to a specified reply-to queue.
• On receipt of the trace-route reply message, the IBM MQ display route application displays the
accumulated activity information.
The trace-route message is put into the queue manager network.
2.As the trace-route message is routed through the queue manager network a user application, that is
enabled for trace-route messaging, performs a low detail activity on behalf of the message. In addition
to writing the standard activity information to the trace-route message, the user application writes the
following PCF parameter to the end of the Activity group:
ColorValue
Identifier
65536
Data type
MQCFST
Value
'Red'
This additional PCF parameter gives further information about the activity that was performed,
however it is written in a format where the parameter identifier is not recognized by the IBM MQ
display route application.
3.The trace-route messages reaches the target queue and a trace-route reply message is returned to the
IBM MQ display route application. The additional activity information is displayed as follows:
65536: 'Red'
The IBM MQ display route application does not recognize the parameter identifier of the PCF
parameter and displays it as a numeric value. The context of the additional information is not clear.
For an example of when the IBM MQ display route application does recognize the parameter identifier
of the PCF parameter, see “Recording additional activity information: Example 2” on page 79.
78 Monitoring and Performance for IBM MQ
Recording additional activity information: Example 2
Additional activity information is recorded by a user application in a format where the parameter identifier
is recognized by the IBM MQ display route application.
1.The IBM MQ display route application is used to generate and put a trace-route message into a queue
manager network in the same fashion as in “Recording additional activity information: Example 1” on
page 78.
2.As the trace-route message is routed through the queue manager network a user application, that is
enabled for trace-route messaging, performs a low detail activity on behalf of the message. In addition
to writing the standard activity information to the trace-route message, the user application writes the
following PCF parameters to the end of the Activity group:
ColorInfo
Table 16. Color information
Description Grouped parameters specifying information about a color.
Identifier: MQGACF_VALUE_NAMING.
Data type: MQCFGR.
Parameters in ColorName
group:
ColorValue
ColorName
Table 17. Color name
Contains the name to be displayed by the IBM MQ display route
Description
application which puts the value of ColorValue into context.
Identifier: MQCA_VALUE_NAME.
Data type: MQCFST.
Included in PCF ColorInfo.
group:
Value: 'Color'
ColorValue
Table 18. Color value
Contains the value to be displayed by the IBM MQ display route
Description
application.
Identifier: 65536.
Data type: MQCFST.
Included in PCF ColorInfo.
group:
Value: 'Red'
These additional PCF parameters gives further information about the activity that was performed.
These PCF parameters are written in a format where the parameter identifier is recognized by the IBM
MQ display route application.
IBM MQ Monitoring and performance 79
3.The trace-route messages reaches the target queue and a trace-route reply message is returned to the
IBM MQ display route application. The additional activity information is displayed as follows:
Color: 'Red'
The IBM MQ display route application recognizes that the parameter identifier of the PCF
structure containing the value of the additional activity information has a corresponding name. The
corresponding name is displayed instead of the numeric value.
IBM MQ display route application
Use the IBM MQ display route application ( dspmqrte ) to work with trace-route messages and activity
information related to a trace-route message, using a command-line interface. The IBM
MQ display route application is not shipped on IBM MQ for z/OS, but you can run it from a distributed
installation and connect it as a client to an IBM MQ for z/OS queue manager by specifying the -c
parameter when issuing the dspmqrte command.
You can use the IBM MQ dspmqrte display route application for the following purposes:
• To configure, generate, and put a trace-route message into a queue manager network.
By putting a trace-route message into a queue manager network, activity information can be collected
and used to determine the route that the trace-route message took. You can specify the characteristics
of the trace-route messages as follows:
– The destination of the trace-route message.
– How the trace-route message mimics another message.
– How the trace-route message should be handled as it is routed through a queue manager network.
– Whether activity recording or trace-route messaging are used to record activity information.
• To order and display activity information related to a trace-route message.
If the IBM MQ display route application has put a trace-route message into a queue manager network,
after the related activity information has been returned, the information can be ordered and displayed
immediately. Alternatively, the IBM MQ display route application can be used to order, and display,
activity information related to a trace-route message that was previously generated.
Related reference