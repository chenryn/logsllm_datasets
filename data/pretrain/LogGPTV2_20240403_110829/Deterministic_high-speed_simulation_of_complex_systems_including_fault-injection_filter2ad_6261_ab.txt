213
non-deterministicbehavior,i.e.simulationrunswhichcanvirtuallyneverbereproducedidentically.3.3.AutomatedtestingFAUmachinealreadyprovidesthemeanstosetupandrunautomatedtests,includingthespeciﬁcationofuserbe-haviorandthespeciﬁcationoffaultstobeinjected[19,22,4,10].Simulatableuserbehaviorincludesrecognitionofel-ementsofbothtext-basedandgraphicalscreensandgenera-tionofkeyboardandmouseevents.Forthis,VHDLscriptsdeﬁnethestimulifortheinteractingcomponentsinquiteaﬁnegranularmanner.Therealsoexistsaprogramminglan-guagefromwhichbehavioralVHDLscriptscangetgener-ated,whichhelpsuserstocreatesequentialtestsequencesinastraightforwardmanner[18](seeﬁgure1foranex-ample).Currently,theVHDLinterpreterexpectwilltakecareoftheinteractionoftheteststimuliwiththesimulatedcomponents.Toachievethis,commoninterfacesbetweenthesimulatedcomponentsarealreadyapartofFAUma-chine.TheseinterfacesaremappedtoVHDLsignalsand/orVHDLprocedurecallsinsideofexpect.Enrichingthisen-vironmentwithameanstoruntestsdeterministicallyseemsaworthwhilegoal:Automatedtestscanthenbeusedtodoregressiontestsduringthedevelopmentprocessofsoftwaresystemsbeingdeployedtocomplexhardwaresetups.Run-ningsuchtestsbothwithandwithoutfaultinjection,willprovidetheadditionalbeneﬁtofbecomingenabledtospotregressionsinrelationtofaulttolerance,whilebeingsuretoperformtestswhicharecompletelyrepeatableaswell.4.DeterministicsimulationTorunsimulationsdeterministically,therearesomepre-conditionsforthespeciﬁcationofsuchexperimentsthathavetobekeptintheﬁrstplace.Theexperimentsmustnotuseanyofthebridgestorealhardwareorgraphicaluserinterfacedescribedinsection3.2,whichcouldintro-ducespontaneous,unpredictableeventsintothesimulatedsystem,especiallyfromtherealnetwork,mouse,keyboard,andthelike.Toachievethis,ofcourse,alloftheuserinter-actionwiththesystemundersimulationmustbegeneratedbyexpect(cf.section3.3).BesidesthistherearesomeextensionsandmodiﬁcationstoFAUmachine,whichwerenecessarytoenabledetermin-isticsimulation.Itisnowpossibletoprovideaninitialtimefortherealtimeclock(RTC)toensurethatallrunsofanexperimentstartatthesamepointinsimulatedrealtime.Next,thesynchronizationofexternalrealtimeandsimu-lated(real)timecanbeswitchedoff.Thisisimportant,be-causethesynchronizationalgorithmhasaninﬂuenceonthenumberofpre-compiledcodeblocksthatareexecutedbe-tweentworunsofthemainloopofthesimulator.ThemaincdrominsertKnoppix-4.0.2-CDpoweronwaitascboot:2mintype"knoppix2vga=normalnousbnopcmciatype"nofirewirenoaudionodhcp\0d"waitascroot@tty1[/]#15mintype"date\0d"waitascThuJan107:02:18EST200910seclogexperimentsuccessful.poweroffdelay1secFigure1.ScriptforsimpleRTC-experimentloopschedulesbetweenthedifferentlight-weightprocessesandtimer-calledfunctions,whichsimulateseveralpartsofthehardwareaswellasthebehavioroftheuser.Byturningoffsynchronization,externalstimuliwillalwaysbegener-atedatthesamepointin(simulated)timeandtheexecutionorderof,ﬁrst,simulatortaskswhichaffectthesystemundertestand,second,pre-translatedcodeblocks,isalwaysthesame.Finally,FAUmachinecurrentlysimulatesthewholesysteminoneprocessofthehostmachine,usingitsownna-tivecooperativelight-weightthreadconceptforthediffer-enthardwarecomponentstoensurethatprocessschedulingisalwayspredictable.ThecombinationofthementionedprecautionsforthespeciﬁcationofexperimentsandthemodiﬁcationsofFAU-machinethenleadstocompletelyreproducibleruns.Assimulatedtimeandrealtimeareusuallynotsyn-chronousindeterministicmode(sometimesseemingtoruntoofast,sometimestooslowly),itispossibletorecordthevideoandaudiooutputduringsimulation.Thetimestampsoftheserecordingsarerelativetothesimulatedtimeandthus,whentherecordingsareplayedbackaftertherunhasﬁnished,theobservabletime(e.g.aclockshowinginasta-tusbar)isadvancingatnormal,realtimespeed.Becausethesystemundertestisexperiencingthead-vancementoftimeequallyduringdifferentrunsofthesameexperiment,itisnowevenpossibletotestforrealtimecon-straints.5.ExamplesToexamineanddemonstratethenewdeterministicsim-ulationcapabilitieswesetupaverysimpletestforthead-vancementofsimulatedrealtime(section5.1)andamorecomprehensivetestenvironmenttoconductandanalyzese-riesoffaultinjectionexperiments(section5.2).Insec-tion5.3,wewillgiveashortdiscussionoftheresults.5.1.SimpleRTCExperimentFigure1showsascriptdeﬁningthestepsofasimpleex-perimenttestingtherealtimeclock.Whenstartedatasim-978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
214
Figure2.ScreenshotofsimpleRTC-experimentNOTE:1970-01-0101:00:01.000000waitingforMainboardTools(60000ms)NOTE:1970-01-0101:00:04.430769MainboardTools:foundandcompleted!NOTE:1970-01-0101:00:04.630769waitingforMemtest86+(60000ms)NOTE:1970-01-0101:00:04.630769Memtest86+:foundandcompleted!NOTE:1970-01-0101:00:04.830769waitingfor07550bf4(90000ms)NOTE:1970-01-0101:00:07.368000injectingbitflipfaultto0x07550bf4,bit5NOTE:1970-01-0101:00:07.75384507550bf4:foundandcompleted!NOTE:1970-01-0101:00:08.753845screenshottaken.NOTE:1970-01-0101:00:13.753845Installationfinished.Figure3.expect-logofmemoryexperimentulatedrealtimeof1,230,793,261secondsaftertheUNIXepoch,whichis2009-01-01,07:01:01,itbootsintoaliveLinuxsystem[14]andchecksthecurrentdateandtimebyrunningthedateprogram.Ifrunningdeterministically,itwillalwaysprintthedateshowninthescript.Theﬁnalscreenofonerunofthisexperimentcanbeseeninﬁgure2.5.2.SeriesofMemoryFaultExperimentsWesetupascriptedtestenvironmentwhichallowstorunseriesofstandardizedfault-injectionexperimentsrunningmemtest86+[6]asguestwhichcandetectinjectedmemoryfaults.Eachexperimentisparametrizableastothepointoftimewhenthefaultisinjected,thememorylocationofthefault,andthekindoffault(oneofbitﬂip,stuck-at-0,orstuck-at-1).ItisguaranteedthatallrunsstartatthesameRTC-timeanddonotuseanyinputfromtherealworld(i.e.network,mouse,keyboard,etc.;cf.section4).Eachseriesofrunsofasetofexperimentsisparametrizablewithre-specttothenumberofdifferentexperimentstoperform,thenumberofrunsperexperiment,andwhetherthetestseriesistoberundeterministicallyornon-deterministically.Eachrunofanexperimentinsuchaseriesyieldsdif-ferentkindsofoutputdatawhichissavedbythetestscripts.First,thereisalogﬁleoftheexperimentcontroller(,,expect-log”),containingentriesforstringssearchedforandfoundbythepatternmatcheronthesimulatedscreen,andinformationabouttheinjectedfaults.EachentrybearsaFigure4.Screenshotofmemoryexperimenttimestampsignifyingthepointoftimewhentheeventtookplace,relativetothestartofthesimulation.Figure3showsanexamplelogﬁleofanexperimentinjectingabitﬂipfaultintomemory.Second,ascreenshotofthevirtualmonitoristakenattheendofeachrun,i.e.assoonasthefaultinmem-oryhasbeendetectedoratimeoutoccurred,whateverhap-penedﬁrst.Figure4showsthescreenshotcorrespondingtotheabovelogﬁle.Afterhavingrunaseriesofexperiments,thetestenvironmentcomparesalloftherunsforeachex-periment.Thisisdonebycomparingbothscreenshotsandexpect-logsofeachpairofrunsforequality.Figure5.Histogramof128deterministicrunsofonememoryexperimentTorepresenttheresultsinahumanreadableway,ata-bleisgeneratedforeachexperiment.Inthesetables,eachcellstandsforapairofrunsandcontainsacolorcodesym-bolizingthedegreeofequalitybetweenbothruns.Apartfromthat,twodiagramsaregeneratedforeachexperiment.Theﬁrstonecontainstwohistogramsshowingthenumberofrunsagainsttheirduration(truncatedtofullseconds)re-gardingthesimulatedtimeoftheguestandtherealruntime978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
215
Figure6.Sumof128deterministicrunsofonememoryexperimentFigure7.Histogramof128non-deterministicrunsofonememoryexperimentatthehost.Figures5and7showexamplesofhistograms,presentingtheresultsofthesameexperimentwhichwasrun128timesindeterministicmodeand128timesinnon-deterministicmode,respectively.Theseconddiagramisderivedfromthesamedata,butshowsforeachdurationthenumberofrunstakingatmostthatlongwithoutroundingthetimevalues.Inﬁgures6and8examplescanbefoundforthiskindofdiagram,whicharecorrespondingtoﬁgures5and7.5.3.DiscussionAfterhavingrunnumerousseriesofexperiments(withatotalofseveralthousandsingleruns)inbothdeterministicandnon-deterministicmode,wenoticed,asexpected,thatactuallyallrunsofagivenexperimentarecompletelyequalindeterministicmode,independentoftheloadofthehostFigure8.Sumof128non-deterministicrunsofonememoryexperimentmachine.Thiscanalsoberecognizedfromthediagramsinﬁgures5,wherethesinglespikeintheguest-partofthehistogramshowsthatallrunstookthesametimewhereasthehost-timepartlydiffersbetweenruns.Furthermore,thereisvirtuallynopairoutofalargenum-berofrunsofoneexperimentinnon-deterministicmode,forwhichbothscreenshotsandlogsareequal,eventhoughthisistheoreticallypossible.Nevertheless,intherunsoftheexperimentbelongingtoﬁgure7,about0.33%ofallpairsareequalwithrespecttotheirlogsbutnottothescreen-shots;inthesecases,bytheway,thescreenshotstypicallydifferinthevaluesofthemeasuredmemoryperformance.Finally,whencomparinghostruntimesofdeterministicandnon-deterministicrunsofthesameexperiments,wecanstatethatbothmodesofsimulationgenerallyrankinverysimilarordersofperformance,ascanbeseenwhencompar-ingthehost-linesinﬁgures6and8.Thesigniﬁcantlyhigherdurationsofabout40%oftherunsinnon-deterministicmode(cf.theregionaround100secondsinﬁgure8)re-sultfromthefactthatthememoryfaultsometimescannotbedetectedwhenrunningnon-deterministicallyandthusatimeoutoccursafterapproximately90secondsofsimulatedrealtime.6.ConclusionThispaperpresentedthenewfunctionalityofdetermin-istichigh-speedsimulationofcomplexhardware/softwaresystemsprovidedbyFAUmachine.Enrichedwiththecapa-bilityoffaultinjectionintothesimulatedhardwarecompo-nentsofFAUmachine’svirtualmachineandtheautomaticexperimentcontroller,itwillenabledeveloperstodesignandtestfaulttolerantsoftwaresystemswhicharedeployedtocomplexhardwarestructures–eveninthepresenceofrealtimeconstraints–byrunningfastreproducibletests.978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
216
7.OutlookOneofourfutureeffortswillbetore-enabletheabilityofFAUmachinetosimulatecomplexsystemsinadistributedmanner.Inthismode,differentcomponentsoftheguestsystemorevenwholecomputersarespreadacrossmultiplehostmachineswhichareinterconnectedoverapotentiallyunreliablenetwork.Toachievethis,alotofconceptualproblemsstillhavetobesolved,sincepredictableschedul-ingbetweensimulationprocessesinthewaymentionedinsection4isnotpossible,orrathernotpracticable,inthiscase.Inadditiontothis,thereiscurrentlyanefforttointe-grateVHDL-basedsimulationofadd-on-components(likePCI-cards)intoFAUmachinewhichwillprovidetrueco-simulationabilitiesandthusallowrealco-designofhard-wareandsoftware[17].References[1]P.Barham,B.Dragovic,K.Fraser,S.Hand,T.L.Harris,A.Ho,R.Neugebauer,I.Pratt,andA.Warﬁeld.Xenandtheartofvirtualization.InSOSP,pages164–177,2003.[2]D.Bauer,G.Yaun,C.D.Carothers,M.Yuksel,andS.Kalyanaraman.SimulationoflargescalenetworksIII:ROSS.Net:optimisticparallelsimulationframeworkforlarge-scaleinternetmodels.InWSC’03:Proceedingsofthe35thconferenceonWintersimulation,pages703–711.WinterSimulationConference,2003.[3]F.Bellard.QEMU,afastandportabledynamictranslator.InATEC’05:ProceedingsoftheUSENIXAnnualTechnicalConference2005onUSENIXAnnualTechnicalConference,pages41–46,Berkeley,CA,USA,2005.USENIXAssocia-tion.[4]K.Buchacker,M.DalCin,H.H¨oxer,R.Karch,V.Sieh,andO.Tsch¨ache.Reproducibledependabilitybenchmarkingex-perimentsbasedonunambiguousbenchmarksetupdescrip-tions.InProceedingsoftheInternationalConferenceonDependableSystemsandNetworks,pages469–478,2003.[5]C.R.G.deFarias,L.F.Pires,W.L.deSouza,andC.E.Mor´on.Speciﬁcationandvalidationofareal-timeparal-lelkernelusingLOTOS.InMASCOTS,pages7–14.IEEEComputerSociety,2001.[6]S.Demeulemeester.memtest86+.URL:http://www.memtest.org/,2008.[7]FAUmachineTeam.FAUmachine.URL:http://www.FAUmachine.org/,2003–2008.[8]U.HatnikandS.Altmann.UsingModelSim,Mat-lab/SimulinkandNSforsimulationofdistributedsystems.InPARELEC’04:Proceedingsoftheinternationalcon-ferenceonParallelComputinginElectricalEngineering,pages114–119,Washington,DC,USA,2004.IEEECom-puterSociety.[9]H.H¨oxer,M.Waitz,andV.Sieh.AdvancedvirtualizationtechniquesforFAUmachine.InR.Spenneberg,editor,11thInternationalLinuxSystemTechnologyConference,Erlan-gen,Germany,September7-10,2004,pages1–12,2004.[10]H.H¨oxer,M.Waitz,andV.Sieh.Fastsimulationofstuck-atandcouplingmemoryfaultsusingFAUmachine.InSup-plementtoProc.HASE2005:InternationalSymposiumonHighAssuranceSystemsEngineering(NinthIEEEInterna-tionalSymposiumonHighAssuranceSystemsEngineeringHeidelberg,Germany12-14October2005),pages1–2,Oct.2005.[11]innotekGmbH.VirtualBox.URL:http://www.virtualbox.org/,2008.[12]R.R.Iyer.OnModelingandAnalyzingCacheHierarchiesusingCASPER.InMASCOTS,pages182–187.IEEECom-puterSociety,2003.[13]A.E.Kamal.Discrete-timemodelingofTCPRenoun-derbackgroundtrafﬁcinterferencewithextensiontoRED-basedrouters.Perform.Eval.,58(2-3):109–142,2004.[14]K.Knopper.Knoppix.URL:http://www.knoppix.org/,2000–2008.[15]MentorGraphicsCorp.ModelSim–acomprehensivesim-ulationanddebugenvironmentforASICandFPGAdesign.URL:http://www.model.com,2007.[16]A.Over,P.Strazdins,andB.Clarke.Cycleaccuratemem-orymodelling:Acase-studyinvalidation.InMASCOTS’05:Proceedingsofthe13thIEEEInternationalSympo-siumonModeling,Analysis,andSimulationofComputerandTelecommunicationSystems,pages85–96,Washington,DC,USA,2005.IEEEComputerSociety.[17]S.PotyraandV.Sieh.High-speedhardware/softwarecosim-ulationofcomplexsystemsincludingfault-injectionofde-tailedVHDL-modelsforPC-components.InSupplementtoProc.SeventhEuropeanDependableComputingConfer-ence,Kaunas,Lithuania,May7-9,2008,pages59–62.Vy-tautasMagnusUniversity,2008.[18]S.Potyra,V.Sieh,andM.DalCin.Evaluatingfault-tolerantsystemdesignsusingFAUmachine.InEFTS’07:Proceed-ingsofthe2007workshoponEngineeringfaulttolerantsys-tems,page9,NewYork,NY,USA,2007.ACM.[19]V.SiehandK.Buchacker.Testingthefault-toleranceofnet-workedsystems.InU.Brinkschulte,K.-E.Grosspietsch,C.Hochberger,andE.W.Mayr,editors,InternationalCon-ferenceonArchitectureofComputingSystemsARCS2002,WorkshopProceedings,pages37–46,2002.[20]SourceForge.BochsIA-32emulatorproject.URL:http://bochs.sourceforge.org/,2001.[21]B.K.Szymanski,Y.Liu,andR.Gupta.Parallelnetworksimulationunderdistributedgenesis.InPADS’03:Pro-ceedingsoftheseventeenthworkshoponParallelanddis-tributedsimulation,pages61–68,Washington,DC,USA,2003.IEEEComputerSociety.[22]O.Tsch¨ache.Dependabilitybenchmarkingoflinuxbasedsystems.InProceedingsInformatik2003,Beitr¨agedesSchwerpunktsSicherheit-SchutzundZuverl¨assigkeit,en-glish,pages237–248,2003.[23]VMwareInc.VMware.URL:http://www.vmware.com/,2001.[24]G.Yaun,C.D.Carothers,andS.Kalyanaraman.Large-scaleTCPmodelsusingoptimisticparallelsimulation.InPADS’03:ProceedingsoftheseventeenthworkshoponPar-allelanddistributedsimulation,pages153–162,Washing-ton,DC,USA,2003.IEEEComputerSociety.