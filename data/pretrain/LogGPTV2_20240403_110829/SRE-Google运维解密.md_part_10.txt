介绍了一些后续章节将会反复提到的名词及含义。
也有坏处，本章将详细讨论Google数据中心建设中遇到的机遇与挑战。同时，本章还
Google数据中心与其他传统数据中心和小型服务器集群相比非常不同。这些差异有好处
代表一个对外提供服务的软件系统。
代表具体的硬件（有时候也代表一个VM虚拟机）。
会同时存在几种不同选代周期产生的硬件产品，我们有时候也会修改某个现有数据中心的硬件配置。
Google生产环境
但是也有例外情况，
竞：SRE视角
作者：JCvan Winkel
编辑：BetsyBeyer
例如有些数据中心可能
第2章
13
/，这个BNS地址最终将会被解析为IP地址：端口。
举例如下，一个BNS地址可能是这样一个字符串：/bns///<任务
用BNS名称建立连接，BNS系统负责将这个名称转换成具体的IP地址和端口进行连接。
个系统称之为Borg名称解析系统（BNS）。当其他任务实例连接到某个任务实例时，
Borg启动某一个任务的时候，它会给每个具体的任务实例分配一个名字和一个编号，
口来指代某一个具体任务实例。为了解决这个问题，我们增加了一个新的抽象层。每当
因为任务实例与机器并没有一对一的固定对应关系，
在另外一台物理服务器上重启。
监控这些实例，如果发现某个实例出现异常，其会终止该实例，并且重启它，有时候会
系统和开源的Lustre，以及Hadoop文件系统（HDFS）类似。
供选择作为永久性存储。甚至我们的临时文件存储也在向集群存储模型迁移。这些存储
任务实例可以利用本地硬盘存储一些临时文件，但是我们有几个集群级别的存储系统可
我们发现，
3.构建于Colossus之上，有几个类似数据库的服务可供选择：
2.
1.最底层由称为D的服务提供（D代表磁盘Disk，但是D可以同时使用磁盘和
功能。Colossus是GFS的改进版本（参见文献[Ghe03]）。
系统。Colossus文件系统提供传统文件系统的操作接口，
D 服务的上一层被称之为Colossus，Colossus建立了一个覆盖了整个集群的文件
层做的事情。
用户具体访问某个数据时并不需要记住具体到哪个服务器上去获取，这就是下一
SSD）。D是一个文件服务器，几乎运行在整个集群的所有物理服务器上。然而，
第2章Google生产环境：SRE视角
，所以我们不能简单地用IP地址和端
，同时还支持复制与加密
府
这
---
## Page 57
迁移问题（参见文献[Kum15]）。
降低成本。利用中心化的路由计算，可以解决以前在分布式路由模式下难以解决的流量
（BandwidthEnforcer，BwE）负责管理所有可用带宽。优化带宽的使用的目的不仅仅是
网络带宽也需要合理分配。就像Borg给每个任务实例分配计算资源一样，带宽控制器
从而降低成本。
算网络中的最佳路径。我们可以将整个集群的复杂路由计算从具体交换硬件上分离开来，
了普通的非智能交换组件结合集中化（有备份的）的控制器连接方式。该控制器负责计
OpenFlow协议的软件定义网络（SDN）。我们没有选择使用高级智能路由器，而是采用
Google的网络硬件设备是由以下几种方式控制的。如前文所述，我们使用一个基于
网络
图2-3:Google存储系统（部分）
c.另外几种数据库系统，例如 Blobstore也可用。每一种数据库都有自己的优势
a.Bigtable（参见文献[Cha06]）是一个NoSQL数据库。它可以处理高达数PB
b.
球数据库。
Spanner（参见文献[Corl2]）是可以提供SQL接口以及满足一致性要求的全
原始字节存储的。Bigtable支持“最终一致”的跨数据中心复制模型。
射表。它使用RowKey、Column Key以及时间戳做索引。映射表中的值是按
的数据。Bigtable是一个松散存储的、分布式的、有顺序的、持久化的多维映
与劣势。
D
本地硬盘
Colossus
Blobstore
大文件
管理物理服务器的系统管理软件
小文件
Bigtable
<18
---
## Page 58
使用监控系统：
这些监控指标可以被用来触发警报。也可以存储起来供以后观看。主要有以下几种方式
监控程序实例（具体描述参见10章）。Borgmon定期从监控对象抓取监控指标（Metric）
监控系统是服务运维中不可或缺的部分。因此，我们在数据中心中运行了多个Borgmon
监控与警报系统
BNS路径与IP地址：端口的对应关系。
Chubby适合存放那种对一致性要求非常高的数据。例如BNS服务就使用Chubby存放
进行自动选举，选择一个实例成为主实例。
余实例在同时运行，但是只有一个实例可以处理对外请求，
Chubby是实现主实例选举（Master-Election）过程的关键组件。例如，
致性（具体描述参看第23章）。
Chubby可以处理异地、跨机房级别的锁请求。Chubby 使用Paxos协议来提供分布式一
Chubby（参见文献[Bur06]）集群锁服务提供一个与文件系统类似的API用来操作锁
分布式锁服务
其他几个运行在数据中心中的组件也很重要。
其他系统软件
将用户流量导向到合适的位置。
每个BNS地址可用的容量（通常，容量的单位是QPS，每秒请求数量）。GSLB会自动
每个服务的管理者在配置文件中给服务起一个名称，同时指定一系列的BNS地址，以及
我们的全球负载均衡系统（GSLB）在三个层面上负责负载均衡工作：
集群的服务延迟，我们希望能够将用户指派给距离最近的、有空余容量的数据中心处理。
有些服务包括运行在不同集群上的任务，这些集群通常是遍布全球的。为了降低分布式
·对比服务更新前后的状态变化：新的版本是否让软件服务器运行得更快了？
●对真实问题进行报警。
·利用地理位置信息进行负载均衡DNS请求（例如 www.google.com的解析，具体
·在远程调用（RPC）层面进行负载均衡（具体描述参见第20章）。
在用户服务层面进行负载均衡，例如 YouTube和Google Maps。
描述参见第19章）。
第2章Google生产环境：SRE视角
一般的做法是通过Chubby
一个服务有5个
---