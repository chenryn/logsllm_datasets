### Management During and Beyond the COVID-19 Pandemic
In *NSDI*, 217–231 (2020).

### References

1. **Yen, J.Y.** (1971). Finding the k shortest loopless paths in a network. *Management Science* 17, 11 (1971), 712–716.

2. **Yoshida, Y., Maruta, A., Kitayama, K.-I., Nishihara, M., Tanaka, T., Takahara, T., Rasmussen, J.C., Yoshikane, N., Tsuritani, T., Morita, I., Yan, S., Shu, Y., Yan, Y., Nejabati, R., Zervas, G., Simeonidou, D., Vilalta, R., Munoz, R., Casellas, R., Martinez, R., Aguado, A., Lopez, V., and Marhuenda, J.** (2015). SDN-Based Network Orchestration of Variable-Capacity Optical Packet Switching Network Over Programmable Flexi-Grid Elastic Optical Path Network. *Journal of Lightwave Technology* 33, 3 (Feb 2015), 609–617.

3. **Zang, H., Jue, J.P., Mukherjee, B., et al.** (2000). A review of routing and wavelength assignment approaches for wavelength-routed optical WDM networks. *Optical Networks Magazine* 1, 1 (2000), 47–60.

4. **Zhang, C., Li, J., Wang, H., Guo, A., and Janz, C.** (2019). Evaluation of Dynamic Optical Service Restoration on a Large-Scale ROADM Mesh Network. *IEEE Communications Magazine* 57, 4 (2019), 138–143.

5. **Zhong, Z., Ghobadi, M., Balandat, M., Katti, S., Kazerouni, A., Leach, J., McKillop, M., and Zhang, Y.** (2021). BOW: First Real-World Demonstration of a Bayesian Optimization System for Wavelength Reconfiguration. In *2021 Optical Fiber Communications Conference (OFC)*.

6. **Zhong, Z., Hua, N., Tornatore, M., Li, J., Li, Y., Zheng, X., and Mukherjee, B.** (2019). Provisioning Short-Term Traffic Fluctuations in Elastic Optical Networks. *IEEE/ACM Transactions on Networking* 27, 4 (2019), 1460–1473.

7. **Zyskind, J. and Srivastava, A.** (2011). Optically amplified WDM networks. Academic Press.

8. **Jin, X., Li, Y., Wei, D., Li, S., Gao, J., Xu, L., Li, G., Xu, W., and Rexford, J.** (2016). Optimizing bulk transfers with software-defined optical WAN. In *Proceedings of the 2016 ACM SIGCOMM Conference*. 87–100.

9. **Jinno, M., Kozicki, B., Takara, H., Watanabe, A., Sone, Y., Tanaka, T., and Hirano, A.** (2010). Distance-adaptive spectrum resource allocation in spectrum-sliced elastic optical path network [topics in optical communications]. *IEEE Communications Magazine* 48, 8 (2010), 138–145.

10. **Junio, J., Kilper, D.C., and Chan, V.W.S.** (2012). Channel power excursions from single-step channel provisioning. *IEEE/OSA Journal of Optical Communications and Networking* 4, 9 (2012), A1–A7.

11. **Kanai, T., Senoo, Y., Asaka, K., Sugawa, J., Tamai, H., Saito, H., Minato, N., Oguri, A., Sumita, S., Sato, T., et al.** (2018). Novel automatic service restoration technique by using self-reconfiguration of network resources for a disaster-struck metro-access network. *Journal of Lightwave Technology* 36, 8 (2018), 1516–1523.

12. **Kang, N., Ghobadi, M., Reumann, J., Shraer, A., and Rexford, J.** (2015). Efficient traffic splitting on commodity switches. In *Proceedings of the 11th ACM Conference on Emerging Networking Experiments and Technologies*. 1–13.

13. **Khanna, G., Zhu, S., Filer, M., Gkantsidis, C., Parmigiani, F., and Karagiannis, T.** (2020). Towards all optical DCI networks. In *Optical Fiber Communication Conference (OFC) 2020*. W2A.33. https://doi.org/10.1364/OFC.2020.W2A.33

14. **Kilper, D., Bhopalwala, M., Rastegarfar, H., and Mo, W.** (2015). Optical power dynamics in wavelength layer software defined networking. In *Photonic Networks and Devices*. Optical Society of America, NeT2F–2.

15. **Kodian, A. and Grover, W.D.** (2005). Failure-independent path-protecting p-cycles: Efficient and simple fully preconnected optical-path protection. *Journal of Lightwave Technology* 23, 10 (2005), 3241.

16. **Kumar, P., Yu, C., Yuan, Y., Foster, N., Kleinberg, R., and Soulé, R.** (2018). YATES: Rapid prototyping for traffic engineering systems. In *Proceedings of the Symposium on SDN Research*. 1–7.

17. **Kumar, P., Yuan, Y., Yu, C., Foster, N., Kleinberg, R., Lapukhov, P., Lim, C.L., and Soulé, R.** (2018). Semi-oblivious traffic engineering: The road not taken. In *NSDI'18*. 157–170.

18. **Lahav, D., Moshe, H., Menscher, A., and Lezerovitz, A.** (2006). Combined SONET/SDH and OTN architecture. US Patent 7,106,968 (Sept. 12, 2006).

19. **Lee, Y., Seok, Y., Choi, Y., and Kim, C.** (2002). A constrained multipath traffic engineering scheme for MPLS networks. In *ICC (2002)*. IEEE, 2431–2436.

20. **Leopold, G.** (2017). Building Express Backbone: Facebook’s new long-haul network. http://code.facebook.com/posts/1782709872057497/. (2017).

21. **Li, Y. and Kilper, D.C.** (2018). Optical physical layer SDN. *Journal of Optical Communications and Networking* 10, 1 (2018), A110–A121.

22. **Liu, H.H., Kandula, S., Mahajan, R., Zhang, M., and Gelernter, D.** (2014). Traffic engineering with forward fault correction. In *Proceedings of the 2014 ACM conference on SIGCOMM*. 527–538.

23. **Mukherjee, B.** (2006). Optical WDM networks. Springer Science & Business Media.

24. **Mukherjee, B., Banerjee, D., Ramamurthy, S., and Mukherjee, A.** (1996). Some principles for designing a wide-area WDM optical network. *IEEE/ACM transactions on networking* 4, 5 (1996), 684–696.

25. **Gurobi Optimization.** (n.d.). Gurobi optimizer. http://www.gurobi.com.

26. **Pan, Y., Kilper, D.C., Morea, A., Junio, J., and Chan, V.W.S.** (2012). Channel power excursions in GMPLS end-to-end optical restoration with single-step wavelength tuning. In *OFC/NFOEC*. IEEE, 1–3.

27. **Coriant White Paper.** (n.d.). The role of OTN switching in 100G & beyond transport networks. https://www.ofcconference.org/getattachment/90c0e6a4-08c1-45fb-a7f2-2957d444dc7d/The-Role-of-OTN-Switching-in-100G-Beyond-Transpo.aspx.

28. **Pathak, A., Zhang, M., Hu, Y.C., Mahajan, R., and Maltz, D.** (2011). Latency inflation with MPLS-based traffic engineering. In *Proceedings of the 2011 ACM SIGCOMM conference on Internet measurement conference*. 463–472.

29. **Raghavan, P. and Tompson, C.D.** (1987). Randomized rounding: a technique for provably good algorithms and algorithmic proofs. *Combinatorica* 7, 4 (1987), 365–374.

30. **Ramamurthy, B. and Ramakrishnan, A.** (2000). Virtual topology reconfiguration of wavelength-routed optical WDM networks. In *GLOBECOM*.

31. **Ramamurthy, S. and Mukherjee, B.** (1999). Survivable WDM mesh networks. II. Restoration. In *1999 IEEE International Conference on Communications (Cat. No. 99CH36311)*, Vol. 3. IEEE, 2023–2030.

32. **Roberts, K.B., Harley, J., and Boertjes, D.** (2020). Adjustment of control parameters of section of optical fiber network. US Patent 10,784,980 (Sept. 22, 2020).

### Appendix

#### A.1 Path Inflation and Modulation Change After Restoration

**Fiber Path Length Inflation.** An important factor in Arrow is the potential path inflation when the length of the surrogate restoration fiber path (R-path) is significantly longer than the original primary fiber path (P-path). Figure 17 plots the cumulative distribution function (CDF) of the path inflation ratio (restoration path length divided by primary path length) for Arrow to perform optical restoration with and without frequency tuning at Facebook. Interestingly, the figure shows that, on average, 50% of IP links’ restoration paths are shorter than the corresponding primary paths. This means the modulation formats of the restored wavelengths do not need to be reconfigured, thus simplifying Arrow’s operations. For the remaining IP links whose restoration paths are longer than their primary path, we plot the top 10 longest restoration paths in Figure 17(b) (with transponder frequency tuning) and Figure 17(c) (without transponder frequency tuning). We observe that all restoration fiber paths are shorter than 5,000 km; hence, they can support 100 Gbps modulation based on our device datasheet in Table 6. Higher data rates may be possible for some shorter paths, and restoring such highly-modulated wavelengths to a longer restoration fiber path may trigger the change of modulation formats. Prior work has demonstrated that modulation change latency in WANs is 70 seconds using commodity hardware and can be improved to 35 ms [77].

**WAN Transponders Data Rate vs. Reach.** We use the following specifications from our optical device vendors to plan and manage the optical layer at Facebook. For the same wavelength slot, higher capacity is achieved with more aggressive modulation, thus requiring shorter transmission distance [34, 76, 77]. Note that advanced modulation techniques, e.g., probabilistic constellation shaping, could even extend the optical reach with finer-granularity data rates [24].

| Data Rate (Gbps) | Reach (km) |
|------------------|------------|
| 100              | 5000       |
| 200              | 3000       |
| 300              | 1500       |
| 400              | 1000       |

**Table 6:** Terrestrial long-haul optical transponder specification sheet at Facebook.

#### A.2 Routing and Wavelength Assignment (RWA) Formulation

The RWA is a classical problem in optical networking [88]. Here, we show the RWA formulation used in Arrow.

**Separation of Routing and Wavelength Assignment.** Routing and wavelength assignment problems can be combined into one formulation, but Arrow separates the routing step from the wavelength assignment step. The RWA problem is known to be computationally intractable because it requires jointly optimizing a wavelength’s routing path length and the wavelength’s frequency and modulation assignment. Arrow’s separation significantly reduces the formulation complexity, making the problem solvable for large topologies like Facebook within several minutes, while not compromising optimality because routing paths are pre-computed respecting wavelengths’ modulation format maximum transmission reach as noted in Table 6. Note that our RWA is solved on a provisioned brown-field (some wavelengths are already populated to carry live traffic) optical network for restoring the failed wavelengths only, while prior proposals are for green-field optical network planning (the network uses dark fibers, and no wavelengths are populated). This is another reason why our RWA can be solved within several minutes.

**Routing the Restored Wavelengths.** Consider a fiber cut scenario where a set of IP links \( E \) is lost. To restore each IP link \( e \in E \) and revive its IP layer capacity, we run the k-shortest-path algorithm [86] to find its k surrogate fiber paths \(\{P_1^e, P_2^e, ..., P_k^e\}\) with path-length upper bounds based on the modulation format of the failed IP links. Note that we allow multiple restored wavelengths of an IP link to be routed over multiple surrogate restoration fiber paths because their IP-layer bandwidth capacity can be aggregated thanks to the link aggregation protocol (IEEE 802.3ad LACP) [44]. We then represent the routing information using a binary parameter \(\pi_{e,k}^\phi\) as 1 if a fiber \(\phi \in P_k^e\) and 0 otherwise.

**Wavelength Assignment of the Restored Wavelengths.** After obtaining the routing path for restored wavelengths, we need to assign a frequency to each restored wavelength. Consider a fiber \(\phi\) on the optical layer topology; its spectrum occupancy can be represented by a binary vector \(\phi.spectrum = [0, 0, 1, ..., 1, 0]\) (e.g., 96 wavelength slots under ITU-T DWDM standard [38]), where 0 means this wavelength slot is already utilized by some working wavelengths carrying live traffic, and 1 means this wavelength slot is available for hosting the reconfigured wavelength for optical restoration. Under one failure scenario, we define a binary variable \(\xi_{e,k}^{\phi,w}\) as 1 if the restored IP link \( e \)'s k surrogate restoration fiber path uses wavelength slot \( w \) on fiber \(\phi\) and 0 otherwise. We further define an integer variable \(\lambda_k^e\) that represents the number of restored wavelengths of failed IP link \( e \) on its k surrogate restoration fiber paths. Hence, the wavelength assignment of all restored wavelengths for each restored IP link \( e \) should follow the following constraints when maximizing the total restored wavelength number \(\sum_e \sum_k \lambda_k^e\):

\[
\sum_e \sum_k \xi_{e,k}^{\phi,w} \leq \phi.spectrum[w] \quad \forall \phi, w
\]

\[
\sum_w \xi_{e,k}^{\phi,w} = \lambda_k^e \times \pi_{e,k}^\phi \quad \forall e, k, \phi
\]

\[
\xi_{e,k}^{\phi,w} = \xi_{e,k}^{\phi',w} \quad \forall e, k, w \text{ if } \phi, \phi' \in P_k^e
\]

\[
\sum_k \lambda_k^e \leq \gamma_e \quad \forall e
\]

**Constraint (1)** ensures each available wavelength on surrogate restoration fibers can only be used once. **Constraint (2)** formulates the relationship between the restored capacity \(\lambda_k^e\) of IP link \( e \) routed on its k surrogate restoration fiber path \( P_k^e \) and the wavelength assignment on fibers \(\phi \in P_k^e\). **Constraint (3)** is the wavelength continuity constraint that ensures the occupied wavelength slots are the same all along the fiber path [12]. **Constraint (4)** ensures the failed IP link \( e \)'s total restored wavelength number on all k surrogate restoration fiber paths \(\lambda_e = \sum_k \lambda_k^e\) does not exceed the initial wavelength number \(\gamma_e\) of failed IP link \( e \).

**Figure 17:** Path length inflation analysis (R-path is short for restoration path, and P-path is short for primary path). 50% of IP links’ restoration path is shorter than their primary paths. Hence, no modulation change needed. The length ratio between restoration path and primary path has implications for both transponder modulation on the optical layer [50] and service latency on the IP layer [69].