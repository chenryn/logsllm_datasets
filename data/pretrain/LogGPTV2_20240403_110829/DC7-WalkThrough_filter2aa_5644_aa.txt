# DC7-WalkThrough
---
## 免责声明
本文档仅供学习和研究使用。请勿将文中的技术或源码用于非法用途。任何由此造成的负面影响与本人无关。

---
### 靶机地址
- https://www.vulnhub.com/entry/dc-7,356/

### 说明
DC-7 是一个专为渗透测试经验积累而设计的易受攻击的实验环境。虽然这个挑战不是特别复杂，但也不是轻易可以完成的。尽管它在某种程度上是早期某个 DC 版本（具体版本不透露）的逻辑延续，但它引入了一些新概念，需要你自己去探索。如果你依赖于暴力破解或字典攻击，很可能不会成功。你需要跳出常规思维模式来解决问题。最终目标是获取 root 权限并读取唯一的标志文件。Linux 操作技能和基本的渗透测试工具使用经验是必须的。对于初学者来说，Google 可以提供很大帮助，你也可以通过 @DCAU7 在 Twitter 上向我求助，但请注意，我不会直接给出答案，而是会给你一些前进的方向性建议。

### 技术信息
DC-7 是基于 Debian 64 位构建的 VirtualBox 虚拟机，但在大多数 PC 上运行时应无问题。我已在 VMware Player 上进行了测试，如果在 VMware 中运行此虚拟机遇到问题，请参考相关文档。目前该虚拟机配置为桥接网络模式，但你可以根据需要调整设置。网络配置采用 DHCP 方式。安装过程非常简单：下载、解压，然后导入到 VirtualBox 或 VMware 即可开始使用。

### 知识点
- PHP 弹壳
- 通过定时任务提权

### 实验环境
- VMware® Workstation 15 Pro - 15.0.0 build-10134415
- Kali Linux: NAT 模式, IP 地址 192.168.141.134
- 靶机: NAT 模式
*注：环境仅供参考*

---
# 前期-信息收集
首先进行 IP 探测：
```bash
nmap -sP 192.168.141.0/24
```
通过排除法去掉自身 IP、宿主机 IP 和网关 IP 后，`192.168.141.142` 就是我们的目标 IP。
接着扫描开放端口：
```bash
nmap -T5 -A -v -p- 192.168.141.142
```
结果显示 SSH 和 Web 服务处于开启状态，其中网站是由 Drupal 构建的。尝试了几个已知漏洞均未成功。尝试爆破账户和目录也未有收获。经 Google 搜索后发现，需前往推特查找用户名 "DC7USER" 的相关信息，并在其 GitHub 仓库 (https://github.com/Dc7User/staffdb) 中找到了包含 MySQL 凭证的 `config.php` 文件：
```
用户名: dc7user
密码: MdR3xOgB7#dW
```
然而，由于数据库端口并未对外开放，因此无法直接连接 MySQL。转向之前扫描出的 SSH 服务，尝试登录成功。进一步检查系统中是否存在可利用资源，发现了一个加密的数据库文件及一封邮件。邮件内容显示存在定期备份脚本 `/opt/scripts/backups.sh`，每 15 分钟执行一次，保存数据库 dump 至 `/home/dc7user/backups/website.sql` 并尝试对其进行 GPG 加密。然而，由于文件已存在，加密操作失败。这为我们提供了潜在的攻击途径。

---

希望以上优化后的文本能够更好地传达信息，并且更加清晰连贯。如果有更多细节需要补充或修改，请随时告知！