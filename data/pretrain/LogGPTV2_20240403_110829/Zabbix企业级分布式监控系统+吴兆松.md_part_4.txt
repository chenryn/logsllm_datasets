## Page 31
第2章Zabbix简介
上万台设备，每秒可以处理1.5万次请求，理论上可以支持5万台设备。
Zabbix自身的定位是中型企业和大型企业，如果在特大型环境中（如图2-2
发、大压力的问题，这对使用者提出了更高的要求。
Hlstory: Custom graphs  Custom screens Dashboard  Custom screens  Dashboard
STATUSOFZABBIX
Parameter
Value
Details
Zabbix server isrunning
Yes
localhost:10051
Number of hosts(monitored/notmonitored/templates)
10024
10001/0/23
Number of Items(monitored/disabied/not supported)
450081
450077/0/4
Numberof triggers(enabled/disabled)(probiem/unknown/ok]170041
170041/0[10057/0/159984]
Numberof users（online)
2
Requlredserver performance,newvaluespersecond
1439.4
图2-2
2.2使用Zabbix的准备
乙abbix使用起来很简单，读者稍加学习即可上手，如果你以前从未接触过任
何监控系统，从零基础开始学习，也是一件相对容易的事情。
这里暂且把Zabbix的用户分为如下三类（这样分不一定恰当）。
·入门用户：以前从未接触过任何监控系统，也不懂Linux。学会Zabbix的安装和配置
即可（安装可以用RPM，源码安装也很容易）。
·中级用户：有Linux基础，熟悉LAMP和LNMP环境搭建、MySQL数据库、Shell脚本，
以及简单的英文阅读能力，主要难点在于触发器、数据库调优和API的使用。
·高级用户：熟悉PHP、C等一门脚本语言，具备二次开发能力，能修改源码，对Zabbix
从代码级别进行优化和扩展。前提是对Zabbix的各个功能十分熟悉，或者至少熟悉
需要改进的功能。
对一般用户和运维人员来说，达到中级用户使用水平，即可满足基本的使用
需求。本书主要讲解前两类用户需要的知识，对第三类用户所需的知识也有涉及。
2.3Zabbix为何物
Zabbix官方网站信息如下：
Zabbix官网
http://www.zabbix.com
官方论坛
http://www.zabbix.com/forum/
代码托管地址
http://sourceforge.net/projects/zabbix/files/
Wiki
https://www.zabbix.com/wiki
Zabbix体验地址
https://zabbix.org/zabbix/dashboard.php
15
---
## Page 32
Zabbix企业级分布式监控系统
Zabbix是一个企业级的高度集成开源监控软件，提供分布式监控解决方案，
可以用来监控设备、服务等的可用性和性能，其产品不分企业版和社区版，是一
个真正的源代码开放产品，用户可以自由下载并使用该软件。
ZabbixSIA公司是Zabbix的官方技术团队成立的公司，其运作模式是商业软
件的开源一软件的使用免费，服务收费。其为用户提供咨询、技术支持服务（定
制开发、解决方案、人员培训等），如图2-3所示。
咨询
模板
专业
与专家交流
培训
定制
获取知识
添加独特的设备
外包服务
得到新版本
升级
交钥匙
方案
技术指导
优化
技术
开发
获取协助
支持
远程
故障排错
可 Zabbix 2013 | 52
图2-3
注：该图来自史应生的Zabbix讲座《Zabbix监控概述》中的PPT文件截图。
2.4选择Zabbix的理由
对比同类监控产品，有以下理由选择使用Zabbix。
①Zabbix是一个自由开放源代码的产品，用户可以对源代码进行任意修改和
二次开发。Zabbix采用GNUGeneralPublicLicense（GPL)version 2开源协议。
②安装和配置简单，用户仅仅需要一些简单的学习，即可完成监控的搭建工作。
③搭建环境简单，基于开源软件构建平台，仅需要Linux、Apache/Nginx、
MySQL/PostgreSQL/Oracle、PHP即可，无须专用操作系统支持，也无须专用硬件。
④Zabbix-Agent 完全支持Linux、UNIX、Windows、AIX、BSD和Solaris
的监控，Server和Agent都采用C语言编码，对系统的资源占用非常小，数据采
集的性能和速度非常快。
16
---
## Page 33
第2章Zabbix简介
5将数据采集持久存储到数据库，便于对监控数据的二次分析。
非常丰富的扩展能力，很轻松地自定义监控项和实现数据采集，几乎能监
控所有的数据。例如，可以监控网站的访问次数，监控UPS和天气温度等。毫不
夸张地说，在Zabbix的世界里，往往有你想不到的事情，没有办不到的事情。
开源社区的运作模式，有各种论坛、邮件列表、IM及时沟通等。
因此，如果你是一个系统管理员、网络管理员和运维人员，想要构建一套自
己的监控系统环境，Zabbix将会是最佳的选择。如果你是开发人员，想基于开源
软件开发一套属于自己的监控系统，Zabbix也是比较好的选择。
2.5Zabbix的架构
Zabbix的版本大致可以分为：1.0、1.1、1.4、1.6、1.8、2.0、2.2这几大发行
版本（如图2-4所示）。对外的首个发行版本为Zabbix1.0alphal，其发行时间为
2001年4月7日，随着版本的升级，其功能特性也在不断增强和完善。从Zabbix
1.8开始，增强了很多新的功能和特性，如对JMX、自动发现、Lowleveldiscovery
功能的支持，而当前的Zabbix2.2则有了进一步的完善，性能相比Zabbix2.0提
高了5倍，成为当前功能最强大的版本，支持对VMware的监控，可以动态加载
模板，Web 能够模板化配置。下一个版本是2.4，目前Zabbix官方正在规划中。
V2.2
V2.0
V1.8
V.6
LLD
Web可
V1.4
Muilne
棋长化
配#
V1.1
问题升
JMO
更高的
级存
设
核动
新养面
控
zabbo
留动资
Souite
Zabbi
Froxy
持正
#络发
代理
LDAFS
BMDE
WEB
正
2支持
以表盘
可计算
维护根
UTFB
项目
GPL
IPV6的
电话
1958
图2-4
Zabbix的通用架构是Client/Server架构，分布式架构为Client/Proxy/Server
或Client/Node/Server，Zabbix-Server将采集到的数据持久地存储到数据库中，用
17
---
## Page 34
Zabbix企业级分布式监控系统
前端UI友好地展示给用户，图2-5展示的是用Agent采集数据，Proxy做代理，
Server处理数据的架构模式。
Web browser
zabbix
Server A
Seryer C
zabbix
proxy
agentd
zabbix
Apache
server
PHP
Server Z
zabbix_get
zabbix
agentd
ServerB
zabbix_
sender
Repository
Device
Database
MySQL
Database
(MySQL,
PostgreSQL,
Oracle,
SQLlite)
图2-5
正如前面提到的，Zabbix数据的采集不仅可以使用Agent方式，也可以使用
其他方式，如SNMP、SSH、Telent、IPMI等多种协议。
Zabbix-Server的处理进程如图2-6所示。
Zabbix-Server处理进程
watchdog
pinaer
housekeeper
dbconfia_syncer
alerter
db data svncer
poller
nodewatcher
httopoller
timer
discoverer
escalator
图2-6
2.6
Zabbix的运行流程
Zabbix的运行流程可以用图2-7来表示。
18
---
## Page 35
第2章
Zabbix简介
添加监控主机
配置监控项
存入数据库
Zabbix-Agent
Zabbix-Server
主动和被动模式
Zabbix-Server对告警触发条件进行分析
数据采集
用户在UI交互，读取数据库，前端显示数据
Zabbix-front
达到条件触发告警机
告警
图2-7
2.7Zabbix的功能特性
Zabbix有常见的商业监控软件所具备的功能，如主机的性能监控、网络设备
性能监控、数据库性能监控、FTP等通用协议监控、多种告警方式、详细的报表
图表绘制、分布式、可扩展能力、API等。
（1）数据收集
●可用、性能检测。
●支持Agent、SNMP（包括Trapping 和Polling）、IPMI、JMX、SSH、Telnet等。
●自定义的检测。
·自定义收集数据的频率。
·服务器端/代理端和客户端模式。
（2）灵活的触发器
可以定义非常灵活的告警阈值和多种告警相关联的条件。
（3）高度可定制的告警
·发送通知，可定制包括告警级别、动作升级、收件人和媒体类型。
●通知可以使用全局宏变量和自定义的变量。
●自动处理功能包括远程命令的自动调用和执行。
（4）实时的绘图功能
监控项将数据实时绘制在图形上。
（5）Web监控能力
Zabbix可以模拟浏览器请求一个网站，并检查返回值和响应时间。
（6）多种可视化的展示
·可以自定义监控的展示图，将多种监控数据集中展示到一张图中。
19
---
## Page 36
Zabbix企业级分布式监控系统
●网络拓扑图。
·自定义的Screens和Slide shows可以将多种图形集中展示。
●报表功能。
●资源使用情况的监控展示。
（7）历史数据的存储
·数据存储在数据库中。
·历史数据的存放周期可配置。
·定期删除过期的历史数据。
（8）配置非常容易
配置比较简单，只需要以下两步即可。
第一步：添加设备。
第二步：应用模板即可完成监控。
（9）使用模板
●模板可以分组。
·模板具有可继承性。
（10）网络发现
·支持自动发现网络设备和服务器（可以通过配置自动发现服务规则实现）。
·Agent 自动注册。
·支持自动发现（Lowlevel discovery）实现动态监控项的批量监控（支持自
定义），内置的自动发现包括文件系统、网络接口、SNMPOID，可定制自
动发现。
（11）快速的访问接口
●Web页面基于PHP。
·远程访问。
●日志审计。
（12）API功能
应用API功能可以方便地和其他系统结合，包括手机客户端的使用。
（13）系统权限
●不同的用户展示监控的资源不同。
·对用户的身份认证。
（14）程序特性
用C语言编写，其性能和内存开销非常小。
（15）大型环境的支持
利用Zabbix-Proxy方式即可轻松构建远程监控。
20
---
## Page 37
第3章安装与部署
本章介绍Zabbix的安装和配置，这是在一个Server/Agent的架构环境中进行
部署的，采用RPM包安装，适合零基础入门的读者。对于源码安装，请读者参
考本书附录部分。另外，还将介绍乙abbix 安装的软/硬件环境、容量规划等一些
基础知识，对从头开始构建Zabbix监控系统的读者具有实际的指导意义。
3.1安装环境概述
Zabbix服务器运行的环境为Linux(UNIX)+PHP+WebService+DataBase，这里的
Web Service 可以为Nginx、Apache，DataBase 可以为MySQL、Oracle、PostgreSQL等。
3.1.1硬件条件
1．硬件配置
官方推荐的最小硬件配置如表3-1所示。
表3-1
环
境
平
CPU/内存
数据库
硬盘
监控主机数量
小型
Ubuntu Linux
PII350MHz
256MB
SQLite
普通
20
中型
UbuntuLinux 64bit
AMDAthlon32002GB
MySQLInnoDB
普通
500
MySQLInnoDB
RAID10
大型
Ubuntu Linux 64bit
Intel Dual Core64004GB
>1000
或PostgreSQL
SAS或SSD
MySQL InnoDB
RAID10
超大型
RedHat Enterprise
Intel Xeon2xCPU8GB
>10000
或PostgreSQL
SAS或SSD
硬件需求与监控的机器数量和监控的数据量大小等有密切关系，对于硬盘的
要求，建议采用SAS硬盘RAID10，因为其性能和安全都很好。当然，实际环境
中也有可能采用虚拟机来搭建Zabbix监控系统环境。在整个Zabbix监控系统的
搭建和维护中，磁盘I/O、数据库性能将成为整个监控系统运行良好的关键因素。
2.磁盘容量大小
Zabbix-Server的数据库大小取决于NVPS（Numberofprocessedvaluesper
---
## Page 38
Zabbix企业级分布式监控系统
second)，如图3-1所示，NVPS从总体上反映了处理速度，与监控项的数目、监
控的类型、取值间隔、History的保留时间和Trends 的保留时间有直接关系。
Required server performance,ewvalueserecond
2070.41
图3-1
（1）历史数据的保存
NVPS值是每秒处理的平均数量，假设有60000个监控项，刷新周期为60秒，
那么每秒需要处理的数据为60000/60=1000（条），表示此时每秒将会向数据库中
新增1000条数据，这些数据根据设置的历史存储时间保存。例如，保存周期为
90天，每秒处理1000条，计算方法为：
历史数据大小=天数x每秒处理的数据x一天24小时x一小时3600秒x50Bytes
则需要占用的空间为：
（90×24×3600）×1000×50=388800000000（B）（约362GB，假设保存为一年，
则有362×4=1448GB）
（2）趋势数据的保存
每一个Items趋势的数据大约为128B，这取决于数据库类型。
假设有60000个Items，保存一年的趋势数据，其计算方法为：
趋势数据大小=监控项x每天24小时×一年365天×128B
则需要的空间为：
60000×24×365×128=67276800000B（约67GB）
（3）事件数据的保存
每个事件占用130B空间，假设保存一年，则需要的空间为：
1x24×3600×365x130=4099680000B（约4GB)
即60000个监控项，周期为60秒更新数据，保存一年需要362+67+4=443（GB）
磁盘空间，实际上，比这占用得更多，需要保存其他更多的数据，因此，应该会
超过500GB的数据空间。
（4）需要的空间计算方法
磁盘空间的计算方法如表3-2所示。
表3-2
选项
需要的磁盘空间（单位B）
Zabbix配置数据
约10MB
daysx（items/刷新时间）x24x3600xbytes
items：item的数量
历史数据
days：历史天数
refreshrate：监控项的平均取值周期
bytes：单个值的大小，取决于数据库引擎，通常情况下为50B
22
---
## Page 39
第3章安装与部署
续表
选
项
需要的磁盘空间（单位B）
daysx(items/3600)x24x3600xbytes
items：items的数量
历史趋势数据
days：历史数据的天数
bytes：取决于数据库引擎，通常为128B
daysxeventsx24x3600xbytes
events：每秒的事件数量
事件数据
days：历史数据的天数
bytes：取决于数据库引擎，通常为130B
所以，总共需要的磁盘空间大小计算公式为：
Total space=Configuration+History+Trends+Events
可以看到，由于Items、取值间隔、历史数据等各因素的不同，将会使磁盘空
间的使用量不同。对数据库来说，巨大的数据量会造成数据库查询的压力增大，
这将在后面探讨。因此，对监控系统进行规划之前，必须要考虑到硬盘性能、监
控数据的存放周期等因素。
3.1.2
软件条件
1.Zabbix支持的操作系统平台
Zabbix支持Linux、UNIX、Windows系统，如表3-3所示，列出了Zabbix各
模块所能支持的操作系统。
表3-3
系统发行版
Zabbix-Server
Zabbix-Proxy
Zabbix-Agent
支持
支持
支持
AIX
FreeBSD
支持