k , uk}kâˆˆ[0,log m],
Ld, Rd, S1, S2, e, lâ€², râ€², ğœ„â€², ğœŒâ€², ğœâ€²),
(77)
Otherwise they should yield a non-trivial discrete logarithm relation
between (U, H).
Construct vector z from {uk}log m
k=0 with a binary counting struc-
u0u1 . . . ulog m
uâ€“1
0 u1 . . . ulog m
...
z =
(cid:169)(cid:173)(cid:173)(cid:173)(cid:173)(cid:173)(cid:173)(cid:171)
(cid:170)(cid:174)(cid:174)(cid:174)(cid:174)(cid:174)(cid:174)(cid:172) ,
(66)
(68)
(69)
(70)
(71)
(72)
and note that l, r and {li, ri}iâˆˆ[2m] are related by the relation that
(67)
zi Â· li,
Â· ri,
zâ€“1
i
where zi is the i-th element of z. Similarly, Ext can construct {ğœ„i, ğœŒi}iâˆˆ[2m]
from ğœ„, ğœŒ s.t.
ğœ„i Â· H.
log m
zâ€“1
i
iâˆˆ[m]
jâˆˆ[m]
Â· ğœŒi.
iâˆˆ[2m]
iâˆˆ[2m]
iâˆˆ[2m]
iâˆˆ[2m]
iâˆˆ[2m]
iâˆˆ[2m]
zi Â· ğœ„i,
uâ€“1
0 uâ€“1
1 . . . uâ€“1
Recall the definition of L
When a transcript is accepting, it must hold that
Equations (69) and (70) imply that for i âˆˆ [m]
l = 
ğœ„ = 
r = 
ğœŒ = 
zi Â· âŸ¨li, GâŸ© + 
L = âŸ¨l, GâŸ© + ğœ„ Â· H = 

L = 
wi Â·(cid:0)zi Â· Aij + zi+m Â· Cij
(cid:1) Â· Vj.
âŸ¨li, GâŸ© + ğœ„i Â· H = wi Â· 
âŸ¨li+m, GâŸ© + ğœ„i+m Â· H = wi Â· 
li+m = wi Â· 
li = wi Â· 
ri = 
Aij Â· vj, 
(cid:11) â€“(cid:10) 
Aij Â· Vj.
Cij Â· Vj.
Assume Vj = âŸ¨vj, GâŸ© + ğœˆj Â· H, then it should hold that
According to (65), it must hold that
Bij Â· vj â—¦ yn,
Bij Â· vj â—¦ yn
ri+m = yn.
Aij Â· vj,
jâˆˆ[m]
jâˆˆ[m]
jâˆˆ[m]
jâˆˆ[m]
jâˆˆ[m]
Cij Â· vj.
Otherwise it yields a non-trivial discrete logarithm relation among
(H, G). Similarly, there are
iâˆˆ[m]
jâˆˆ[m]
(cid:10) 

wiÂ·(cid:169)(cid:173)(cid:171)
Aij Â· vj, 
(cid:10) 
(cid:16) 
jâˆˆ[m]
jâˆˆ[m]
Aij Â· vj
jâˆˆ[m]
jâˆˆ[m]
(cid:11) â€“(cid:10) 
(cid:17)
â€“ 
jâˆˆ[m]
Bij Â· vj
jâˆˆ[m]
Bij Â· vj â—¦ yn
(cid:17) â—¦(cid:16) 
jâˆˆ[m]
(73)
(cid:11)(cid:170)(cid:174)(cid:172) = 0.
(74)
(75)
Cij Â· vj, yn
jâˆˆ[m]
(cid:11) = 0.
Cij Â· vj, yn
Cij Â· vj = 0.
(76)
Using a fixed y and m different w challenges, we can infer that
Then using n different y challenges, we can infer that
Session 11B: Zero Knowledge II CCS â€™21, November 15â€“19, 2021, Virtual Event, Republic of Korea3019and the distribution is indistinguishable from that produced by an
honest P interacting with an honest V. Sim uses Vâ€™s randomness,
and runs as follows.
ğœ„â€², ğœŒâ€², ğœâ€² $â† Fp,
$â† G
S1
(cid:1) Â· Vj,
si+m Â· âŸ¨1, GâŸ©,
lâ€², râ€² $â† Fn
p,
$â† G,
Vj
T +
k , T â€“
k
iâˆˆ[m]
jâˆˆ[m]


$â† G, âˆ€ k âˆˆ [0, log m],
L â† 
wi Â·(cid:0)si Â· Aij + si+m Â· Cij
R â† 
(cid:1) Â· Vj + 
(cid:0)si Â· Bij
Ld â† eâ€“1 Â·(cid:0)âŸ¨lâ€², GâŸ© + ğœ„ Â· H â€“ L(cid:1) ,
Rd â† eâ€“1 Â·(cid:16)âŸ¨râ€² â—¦ yâ€“1
(cid:17)
S2 â† eâ€“2 Â·(cid:0)âŸ¨lâ€², râ€²âŸ© Â· U + ğœâ€² Â· H(cid:1) + eâ€“1 Â· S1
(cid:17)
(cid:16)
log 2m
n , GâŸ© + ğœŒ Â· H â€“ R
jâˆˆ[m]
iâˆˆ[m]
iâˆˆ[m]
k Â· T +
u2
k + uâ€“2
k Â· T â€“
k
,
.
â€“ eâ€“2 Â·
k=0
(78)
k , T â€“
It is straightforward to see that such a proof produced by Sim will
be accepted by an honest V. lâ€², râ€², ğœ„â€², ğœŒâ€², ğœâ€² are randomly distributed
over Fp. Due to the prefect hiding property of Pedersen commit-
ment, Ld, Rd, {T +
k }, S1, S2 are also random elements of G, apart
from the relation defined by the verification procedure. Therefore,
the transcript given by (78) is indistinguishable from an honestly
computed proof with uniformly sampled challengers.
E Proof for Theorem 4.1
Theorem 4.1 states that ZKCPlus is secure if the embedded CP-NIZK
argument Î Com satisfies completeness, computational knowledge
soundness and zero-knowledge, where by secure we mean:
â€¢ (buyer fairness) for any possibly malicious seller Sâˆ—, if its balance
increases with non-negligble probability, then the buyer B learns
some xâ€² s.t. ğœ™(xâ€²) = 1;
â€¢ (seller fairness) for a seller S interacting with a possibly mali-
cious buyer Bâˆ—, if Sâ€™s balance does not increase, then except for
negligible probability, Bâˆ— learns no information of x, apart from
what can be inferred from ğœ™.
For buyer fairness, If B interacts with a possibly malicious Sâˆ—,
and Sâˆ—â€™s balance increases, then it must be the case that all three
of the following conditions are met
1. in the â€œvalidateâ€ phase, B receives ğœ‹ s.t.
Î Com.Verify(ğœ, (ğœ™, cx), ğœ‹) = 1;
2. by the end of the â€œdeliverâ€ phase, z, h and (ğœ‹z) s.t.
Î Com.Verify(ğœ, (z, h, cx), ğœ‹z) = 1;
3. in the â€œfinalizeâ€ phase, J gets k s.t. H(k) = h.
Due to the computational knowledge soundness of Î Com, for con-
dition 2. to hold, there exists an extractor Ext which except for
probability negl(ğœ†), outputs (xâ€², kâ€²)
Enck(xâ€²) = z âˆ§ h = H(kâ€²).
Similarly for condition 1. to hold, there must exist an extractor Ext
which except for probability negl(ğœ†), outputs xâ€²â€² s.t.
ğœ™(xâ€²â€²) = 1.
Due to the binding property of Com, except for negligible probabil-
ity, there is xâ€²â€² = xâ€², and hence ğœ™(xâ€²) = 1. Assume that at the end
of protocol execution, Sâˆ—â€™s balance increases, but B does not learn
xâ€², then it must be the case that in the â€œfinalizeâ€ phase J receives
some k different from kâ€² but H(k) = h. This breaks the collision
resistance of H.
In Section 4.2.2, we propose using commitment ck instead of h.
Then B loses its funds but learns a wrong x iff in the â€œfinalizeâ€ phase
J learns a pair (k, rk) s.t. k â‰  kâ€² but Check(pp, ck, (k Â· 1), rk) = 1.
This breaks the binding property of the commitment scheme Com.
For seller fairness, if S interacts with a possibly malicious Bâˆ—,
and Sâ€™s funds do not increase, we can construct a simulator SimBâˆ—
which runs on input (cx, z, h), and for Bâˆ— it is indistinguishable
from an honest seller S. The simulator SimBâˆ— works as follows:
1. in â€œvalidateâ€ phase, SimBâˆ— runs Î Comâ€™s simulator Sim, sends
2. in â€œdeliverâ€ phase, SimBâˆ— runs Î Comâ€™s simulator Sim, gets ğœ‹â€²
z â†
ğœ‹â€² â† Sim(ğœ, (s, cx));
Sim(ğœ, (z, cx, h)), sends (z, h, ğœ‹â€²
z);
3. in â€œrevealâ€ phase, SimBâˆ— aborts.
Due to the zero-knowledge property of Î Com, ğœ‹â€² and ğœ‹â€²
z are in-
distinguishable from that sent by an honest S. Moreover, on the
premise that Sâ€™s funds does not increase, either Bâˆ— aborts, or S sees
a transaction tx posted by Bâˆ— which contains some h s.t. H(k) â‰  h,
in which case S must abort in â€œrevealâ€ phase.
Moreover, due to preimage resistance of H, it is infeasible for Bâˆ—
to infer k from h, so it cannot decrypt z to x. Similar conclusion
holds when we use ck instead of h, due to the hiding property of
Com.
F Pay to sudoku solution by ZKCPlus
Herein we describe how ZKCPlus adapts to the scenario of exchang-
ing sudoku solutions. Assume a sudoku puzzle of dimension D Ã— D.
The protocol starts with the â€œcommitâ€ phase where the seller S
makes commitment to the solution x âˆˆ FD2
p . Weâ€™ve described how
the data-parallel CP-NIZK argument in Section 3 applies to the
â€œdelivierâ€ phase of ZKCPlus; what is not so obvious is that it also
applies to the â€œvalidateâ€ phase for a sudoku solution as well. To
convince the buyer that x is correct, S has to prove that of the
D Ã— D solution, each row ri, column ci, and sub-grid si for i âˆˆ [D]
is a permutation of digits {1, . . . , D}, namely
isPermD(ri) = 1,
isPermD(ci) = 1,
(79)
hold for all i âˆˆ [D]. This constitutes a data-parallel computation
with 3D copies of function isPerm running in parallel. Besides, S
has to prove that {ri} are consistent the committed x. It can be
accomplished by a CP-NIZK argument for inner products
isPermD(si) = 1
âŸ¨ri, yiâŸ© = 0,
(80)
âŸ¨x, yâŸ© â€“ 
iâˆˆ[D]
where y $â† FD2
p , and y = (y1|| . . . ||yD). The Schwartz-Zippel lemma
states that except for error D2
|Fp|, (80) holds iff x and {ri} are consistent.
Similar arguments apply to {ci} and {si}. In addition, S has to prove
that x is consistent with the puzzle setting p, that at position i
where the digit is open, there is xi = pi. With binary mask b âˆˆ FD2
p
Session 11B: Zero Knowledge II CCS â€™21, November 15â€“19, 2021, Virtual Event, Republic of Korea3020(cid:40)1 position i is open,
where
to prove it.
bi =
(81)
the consistency between x and p translates into an equation xâ—¦ b =
p. Again S can use an inner product argument for
0 otherwise,
âŸ¨x â—¦ b, yâŸ© = âŸ¨p, yâŸ©
(82)
With the â€œvalidateâ€ phase and â€œdeliverâ€ phase separated, one
may optionally incorporate a data compression procedure. Since
each element of x is a digit in the range of [1, D], encoding it as
an element of field Fp is somewhat wasteful. Alternatively, with
l marking the bit length of Fp, and k = âŒˆlog(D + 1)âŒ‰ marking the
bit length of each digit in [1, D], S may group t = âŒŠl/kâŒ‹ digits
into one element of Fp, and reform a solution x of length D2 into
xâ€² of length âŒˆD2/tâŒ‰. To justify the consistency between x and xâ€²,
$â† FâŒˆD2/tâŒ‰
S may randomly sample yâ€²
, and by a length t vector
t = [1, 2k,Â· Â· Â· , 2(tâ€“1)k] construct y as
2k
p
y = [yâ€²
1 Â· 2k
t ,Â· Â· Â· , yâ€²
(83)
i is the i-th element vector of yâ€², and then employ an inner
p
,
âŒˆD2/tâŒ‰ Â· 2k
t ] âˆˆ FâŒˆD2/tâŒ‰Â·t
where yâ€²
product argument for
âŸ¨x, yâŸ© â€“ âŸ¨xâ€², yâ€²âŸ© = 0,
(84)
with x padded with zeros into the same length as y. With the
compression on, the â€œdeliverâ€ phase runs on xâ€² instead of x, which
is t times more efficient.
G Other evaluation results
We also measure computational cost of the on-chain arbiter in
ZKCPlusâ€™s â€œfinalizeâ€ phase, i.e., the gas cost of the smart contract.
In our protocol the contract takes charge of commitment opening
and concurrent transferring, and by storing a prepared group el-
ement, the computational complexity can be reduced to O(1) (see
Section 4.2.2 for details).
Our evaluation shows that the total on-chain gas cost of the smart
contract in â€œfinalizeâ€ phase is quite economical, around 156,770 gas
independent of data size. Among all these consumed gas, trans-
ferring payment and updating the ledgerâ€™s state (i.e., writing to
storage) account for the majority of the computational cost by
102,082 gas, and commitment opening costs only about 15,900 gas,
10.14% of the total gas. Considering ZKCP, computing hash on chain
is cheaper than commitment opening, but actually it does not help
much to overall on-chain gas cost, since either hash computation or
commitment opening accounts for only a minor portion of overall
gas cost.
Session 11B: Zero Knowledge II CCS â€™21, November 15â€“19, 2021, Virtual Event, Republic of Korea3021