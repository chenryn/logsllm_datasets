title:NATting Else Matters: Evaluating IPv6 Access Control Policies in Residential
Networks
author:Karl Olson and
Jack Wampler and
Fan Shen and
Nolen Scaife
NATting Else Matters: Evaluating IPv6
Access Control Policies in Residential
Networks
Karl Olson(B), Jack Wampler(B), Fan Shen(B), and Nolen Scaife(B)
University of Colorado Boulder, Boulder, USA
{karl.olson,jack.wampler,fan.shen,scaife}@colorado.edu
Abstract. Customer edge routers are the primary mode of connection
to the Internet for a large portion of non-commercial users. As these con-
sumer networks migrate from IPv4 to IPv6, stateful ﬁrewalls are needed
to protect devices in the home. However, policy details crucial to the
implementation of these inbound access controls are left to the discre-
tion of the device manufacturers. In this paper, we survey ten customer
edge routers to evaluate how manufacturers implement ﬁrewalls and user
controls in IPv6. The result is a systemic, demonstrable failure among all
parties to agree upon, implement, and communicate consistent security
policies. We conclude with future research directions and recommen-
dations for all parties to address these systemic failures and provide a
consistent model for home security.
Keywords: IPv6 · Consumer gateway · Network address translation ·
Security
1 Introduction
For over twenty years, IPv4 network address translation (NAT) dictated a com-
mon operational template for customer edge (CE) routers across a diverse set of
hardware manufacturers. Fueled by Internet growth and address scarcity rather
than intended design, the ubiquitous usage of NAT, combined with RFC 1918
addressing, provides consumers and developers with a common behavioral stan-
dard [20,21]. While unintentional, NAT meaningfully isolates devices inside the
network from those outside it. This allows device manufacturers, and consumers
by proxy, to beneﬁt from automatic and default attack surface reduction.
In contrast, IPv6 provides enough address space that individual devices
receive their own public, globally-routable addresses. This model eliminates the
need for NAT and allows other devices on the Internet to communicate directly
with devices in the home. The IETF provides little guidance or standard for
ﬁrewall conﬁgurations [3,16], allowing router manufacturers to implement ﬁlter-
ing policies at their own discretion. With approximately two-thirds of consumer
devices maintaining default settings [6] or failing to keep up with system or
security updates [17], internal devices’ exposure to external threats becomes
dependent on the router’s design. Without a default security perimeter in place,
once “secured” devices within a home network now rely on the consumer to
c(cid:2) Springer Nature Switzerland AG 2021
O. Hohlfeld et al. (Eds.): PAM 2021, LNCS 12671, pp. 373–389, 2021.
https://doi.org/10.1007/978-3-030-72582-2_22
374
K. Olson et al.
either individually maintain each device or to implement a technical solution,
such as detailed ﬁrewall rules, on their own.
In this work, we perform the ﬁrst study of IPv6 CE routers to examine how
manufacturers are implementing ﬁltering and access control for IPv6 residential
networks. We assess ten popular CE routers to evaluate their default ﬁrewall
policies and the ability for consumers to implement custom rules. Our ﬁndings
show inconsistency in the implementation of default conﬁgurations, overexposure
of services, and an overall lack of messaging to consumers about the baseline
policy of a device. As a result, in cases where no default ﬁrewall is enabled,
consumers may be unaware of the exposure of their devices and developers may
have incorrectly assumed that a device’s services are not exposed to the Internet.
The remainder of this paper is structured as follows: In Sect. 2, we provide a
short overview of IPv6 features, operation considerations and competing security
paradigms. We then present our methodology for assessing IPv6 implementation
in CE routers across a spectrum of features and conﬁgurations in Sect. 3 before
presenting our results in Sect. 4. We discuss the necessity for a single device
baseline standard and recommend consistent messaging in Sect. 5. Finally, we
conclude in Sect. 6.
2 Background
Although functionally similar to IPv4, IPv6 provides a few small but impactful
changes to the typical consumer network. In this section, we give a brief history
of the transition from IPv4 to IPv6 before covering some key diﬀerences between
the two protocols and their potential impact on consumers.
2.1
IPv4 NAT
NAT shaped the CE routing environment for two primary reasons: First, the
scalability of NAT delayed the eventual address exhaustion of IPv4 in a period
of explosive Internet growth and provided a simple path to connect signiﬁcantly
more devices to the Internet. Internet Service Providers (ISPs), who manage
public address distribution in their networks, eﬀectively required CE routers to
support NAT by allocating exactly one public IP to each household gateway [8].
Second, the simplicity of NAT lowered the barrier for non-technical users to
operate their own network. Home networks are often unmanaged or rely heavily
on default conﬁgurations to meet the needs of non-technical users [3,4,20]. By
adopting NAT, CE routers were able to provide simple or automatic initializa-
tion that required minimal conﬁguration beyond Service Set Identiﬁer (SSID),
Wi-Fi Protected Access (WPA) password, and any ISP-speciﬁc settings (such as
a PPPoE username/password) [4]. Once established, a suite of protocols (UPnP,
STUN, etc.) provide an interface for connected devices to negotiate with the
router directly such that the user would rarely need to interact with the net-
work [7,16,19]. NAT also removed the need to deﬁne and manage an ingress
ﬁltering policy, as the one public address is multiplexed for use by all inter-
nal hosts. The prevalence and ubiquity of NAT are now synonymous with the
NATting Else Matters: Evaluating IPv6 Access Control Policies
375
default-deny ingress policy that has become the de facto security model of CE
networks, a policy that is often the only ingress access control deployed.
However, the motivation for the adoption of NAT in IPv4 is negated by a core
feature in the design of IPv6: there is no longer an addressing shortage meaning
we again have the ability to assign one or more addresses to each device. With
this transition, inbound access controls are now discretionary; IPv6 allows CE
networks to operate without the network perimeters and default access control
necessitated by NAT.
While the IETF explicitly acknowledges that care should be taken in design-
ing the baseline operation of CE routers, they avoid proposing default conﬁgura-
tions due to a constructive tension between the desires for transparent end-to-end
connectivity on the one hand, and the need to detect and prevent intrusion by
unauthorized public Internet users on the other [20]. The strongest recommen-
dation provided by the IETF is for manufactures to include a toggle to allow
customers to choose between an open, unﬁltered gateway where security is left
to endpoint devices, or a closed perimeter approach, similar to NAT, where traf-
ﬁc is ﬁltered and only allowed through careful exception [3,20]. In the absence
of eﬀorts by manufacturers to provide standardization or documentation of the
defaults that they implement, consumers are left to assess whether the security
model that their network implements is suﬃcient.
2.2 IPv6 Reachability
A signiﬁcant consideration in the adoption of IPv6 is the ability to uniquely
address each device that joins the Internet. No longer deﬁned by NAT archi-
tectures and private subnets, this addressing allows for every device to be glob-
ally reachable. Devices designed for the home environment often pose a serious
risk when exposed to the open Internet [2,9,10]. However, globally reachable
does not automatically imply a device is globally accessible.
The IETF’s RFCs give router manufacturers discretion for handling unso-
licited inbound traﬃc in IPv6. The two basic options for default policies are:
– Default Deny: drop all unsolicited WAN-to-LAN inbound traﬃc. To permit
inbound traﬃc, users can either manually add ﬁrewall exceptions or rely on
protocols that allow exceptions to be negotiated directly with the router. This
policy resembles the existing model of IPv4 networks instrumented with NAT
and UPnP.
– Default Permit: allow unsolicited inbound WAN-to-LAN traﬃc. Devices are
globally accessible, oﬄoading the responsibility for ﬁltering unwanted traﬃc
to each individual device. The advantage of this model is that developers can
easily design and deploy their Internet-capable devices without consideration
for including and maintaining additional security mechanisms such as ﬁre-
walls, hole punching mechanisms, or their associated user interface controls.
Whichever default policy is used, the mental model that a user employs must
change from that of IPv4. If a user wishes to manually conﬁgure an exception
376
K. Olson et al.
Fig. 1. IPv6 network layout – IPv6 represents a fundamental shift in the addressing
of local networks. In (A) NAT, computers follow a one-to-one mapping of local network
private IP with a single globally-routable IP shared by many internal devices. In (B)
IPv6, devices can have many addresses depending on operational scope. Additionally,
IP addresses are unique and can be routed globally if it has the correct scope – a direct
contrast to IPv4 NAT.
to the ingress policy that their router implements, the subtle diﬀerence between
NAT and individually globally-addressed devices is signiﬁcant. For example, indi-
vidual devices in IPv6 can have more than one address assigned concurrently,
and those addresses may be link-local or transient as demonstrated in Fig. 1. In
order to administer their IPv6 network in a manner equivalent to IPv4, users
must understand technical details about IPv6 operation and ﬁrewall behavior.
This is further complicated by the fact that the control interfaces provided by
manufacturers and across devices have no common nomenclature or abstrac-
tions for conﬁguration tasks. A study of enterprise IPv6 networks found that
enterprise operators likewise have diﬃculty implementing appropriate controls
in these networks [5]. These challenges should not imply that there is anything
inherently wrong with IPv6 - the same model provided by IPv4 NAT can simi-
larly be implemented in IPv6 [18] - but further demonstrate the need to provide
a common expectation for baseline operation.
The ﬂexibility of implementation among CE routing devices combined with
globally reachable addressing creates a potential issue: unlike IPv4 networks
where the de facto model is eﬀectively required, in IPv6 CE routers are free
to expose all internal endpoints. Furthermore, as devices transition from IPv4
to IPv6, this exposure could occur without any communication to the end user
as they attempt to administrate their network. Because inbound access control
implementation is left to the discretion of manufacturers, we suspect that there
NATting Else Matters: Evaluating IPv6 Access Control Policies
377
is variance among implementations. In the next section, we describe our method-
ology for evaluating a set of oﬀ-the-shelf CE routers to assess how IPv6 access
control is implemented in practice.
3 Methodology
Our study aims to measure the security implementation of consumer grade gate-
ways and the conﬁguration options that they provide for IPv6. In this section,
we describe our methodology for selecting and evaluating these routers.
3.1 Router Selection and Network Conﬁguration
In order to choose routers that are representative of those deployed in real net-
works, we rely on the work of Kumar et al., who provide insight into the most
commonly used global gateways by manufacturer and region [10]. Out of 4.8K
router vendors globally, we selected 12 routers which covered 25.2% of the most
commonly deployed global brands. Only routers that speciﬁcally mention com-
patibility with IPv6 were chosen for our comparison. We were unable to ﬁnd any
routers that advertise or provide messaging about ﬁltering policies. To evalu-
ate the potential diﬀerences within a manufacturer we include multiple Linksys
(EA3500, and EA6350) routers. Two of the selected routers (the Tenda AC18 and
the Wavlink Aerial G2) were excluded because they did not actually support
IPv6 upon arrival. The remaining ten devices used in our assessment are shown
in Sect. 4, Table 1.
Our architecture consists of four key elements marked with letters in Fig. 2.
Two vantages were established to assess traﬃc ﬂows: an external host located on
a public cloud provider (A) scanning across a public ISP toward the ﬁrewall (B)
or internal host (C), and an internal vantage (D) which conducted the same
scans focused outbound (with the exception of targeting an external host due
to the ubiquitous outbound permit policy of the ﬁrewalls). All devices sending
and receiving probes associated with scans were under our control at all times
and at no time did we perform any scanning or analysis of public or private
systems outside of our controlled scope. This architecture allowed us to pass
traﬃc across the public internet via local consumer grade ISPs and through the
assessed routers from diﬀerent vantages to analyze real-world operational modes.
3.2 Evaluation Methodology
In order to allow unsolicited inbound connections (e.g., peer-to-peer connec-
tions), IPv4 routers must provide the ability to port forward; the router estab-
lishes a list of port numbers and destination (internal) addresses. When a packet
is received on the public interface at a port in the list, the router bypasses any
NAT lookup and immediately rewrites the destination address and forwards the
packet internally. Forwarding is common in IPv4; devices rely on the UPnP
and NAT-PMP protocols to automate the setup of forwarding rules. Without
378
K. Olson et al.
these protocols, users would need to manually create such rules, a technical task
requiring knowledge of IP addresses and TCP/UDP ports.
Forwarding is eﬀectively meaningless in IPv6 without NAT as devices can be
addressed directly. Instead, routers must provide a mechanism to create ﬁrewall
exceptions if a ﬁrewall is implemented. While these rules can be as simple as
port forwarding rules (e.g., a destination IP and a port number), how they
are implemented and the options available to users may vary. We evaluate the
following basic characteristics of each router:
– Default IPv6. We ﬁrst check if each router supports IPv6 and whether it
enables that support by default. When IPv6 is enabled by default, IPv6-
capable devices on the internal network automatically request addresses.
Default IPv6 support requires that the upstream ISP also supports IPv6.
It is notable that router support for IPv6 and default enable state can be
changed in a ﬁrmware update pushed remotely by the manufacturer, and ISPs
can (and do) add support for IPv6 without notifying consumers. Therefore,
devices in the home environment can transition to IPv6 overnight without the
user’s knowledge.
– Firewall Present. Next, we evaluate whether or not the device implements
a ﬁrewall. In cases where a ﬁrewall is not present, the device will pass all
traﬃc to internal hosts.
– Firewall Enabled. If a ﬁrewall is present, we evaluate whether or not it is
enabled (i.e., ﬁltering) by default.
– One-Click Open. While RFC 7084 refrains from proposing a default IPv6
ingress ﬁlter policy for consumer gateways, it advises that gateways imple-
ment a single button to toggle all ﬁrewall ingress ﬁltering [16]. We evaluate
whether or not the device includes this functionality.
– Security Warning. When the One-Click Open option is used, we evaluate
if there is any warning or communication to the user about the danger of
disabling the ﬁrewall.
– Rule Generation. We evaluate whether each device includes the ability to
create exceptions to the default ﬁrewall policy. Such rules may be necessary
for allowing speciﬁc services or applications to function in the presence of a
ﬁrewall. Because we are comparing to existing functionality in IPv4 networks,
we speciﬁcally exclude examining more expressive ﬁrewall capabilities than
IP/device/port tuples.
– IP Speciﬁcation. We evaluate whether or not rule creation speciﬁes an
individual IP as the destination.
– Device Speciﬁcation. As IPv6 devices are often assigned multiple addresses
(in some cases, one per application), creating a rule may be complicated by
device/address identiﬁcation. We evaluate whether rules can be created by
specifying a device (e.g., by MAC address or another identiﬁer) rather than
a speciﬁc IP address.
– IPv6 UPnP Support. Finally, we evaluate the router’s capability to oﬀer
automatic rule generation. Devices on the local network can use UPnP to
create ﬁrewall rules programmatically if the router oﬀers this capability.
NATting Else Matters: Evaluating IPv6 Access Control Policies
379
Since routers do not explicitly advertise their ﬁrewall policies, we conduct a
series of black-box scans in order to establish the default ﬁltering model, ﬁre-
wall ﬁltering policies, and hosted router services. We designed and built a cus-
tom traﬃc monitor on the internal host to ensure accurate collection of packets
arriving through the ﬁrewall. During a scan, this monitor would listen for and
record inbound IPv6 traﬃc with a timestamp, arrival port, protocol and scan-
ning source IP. We reconciled the packets received with packets sent from the
scanner to ﬁlter unwanted traﬃc and verify correct operation.
Scans were conducted using Nmap against the most common 1,000 TCP and
UDP ports (as deﬁned by the scanner). This scope was chosen due to inter-
est in exposure of the most common ports and scan duration considerations.
A complete assessment of each CE router involved nine total scans from two
sources, each conducted with the ﬁrewall on and oﬀ as shown in Fig. 2: First,
scan (1) is conducted from the external vantage to the internal host establishing
the inbound ﬁltering strategy of the ﬁrewall. Scan (2) probes the external router
interface from the external vantage to identify open ports and exposed services;
(3) repeats this scan on the internal interface to determine if this traditionally
concealed interface is exposed under IPv6. For each interface, we conduct a ban-
ner scan against exposed ports (4 and 5). This process is repeated from the
internal vantage ﬁrst targeting the exposed services on each router interface (6
and 7) before conducting the same banner grab on exposed services (8 and 9).
Fig. 2. Scanning protocol – To fully evaluate the security policy of each router we
scan from two vantage points (A) and (D) against three targets: (C) an internal host,
and (B) the ﬁrewall internal and external interfaces. In total, we conducted 9 unique
scans for each router.
The combination of sources and targets allowed complete measurement of
IPv6 ﬁltering policies, exposure, and default operational model of the CE router.
These results were then compared with our evaluation of basic router character-
istics to complete a holistic router assessment, presented in Sect. 4: Results.
380
K. Olson et al.
s
e
c
i
v
e
d
e
h
t
g
n
o
m
a
s
n
o
i
t
a
r
u
g
ﬁ
n
o
c
t
l
u
a
f
e
d
d
n
a
s
n
o
i
t
p
o
t
n
e
m
e
g
a
n
a
m
f
o
e
r
u
t
a
n
s
u
o
e
n
e
g
o
r
e
t
e
h
e
h
t
s
y
a
l
p
s
i
d
e
l
b
a
t
s
i
h
T
–
s
r
e
t
u
o
R
.
1
e
l
b
a
T
.
t
l
u
a
f
e
d
y
b
d
e
l
b
a
n
e
s
i
6
v
P
I
d
n
a
y
c
i
l
o
p
l
l
a
w
e
r
ﬁ
t
i
m
r
e
p
-
t
l
u
a
f
e
d
a
s
t
n
e
m
e
l
p
m
i
r
e
t
u
o
r
e
h
t
t
a
h
t
e
t
a
c
i
d
n
i
s
e
m
a
n
e
c
i
v
e
d
d
e
d
l
o
B
.
d
e
t
a
u
l
a
v
e
.
T
A
N
6
v
P
I
d
e
s
u
e
c
i
v
e
d
o
N
.
s
e
h
s
a
d
h
t
i
w
d
e
k
r
a
m
e
r
a
s
e
r
u
t
a
e
f
d
e
t
r
o
p
p
u
s
n
u
r
o
f
s
n
o
i
t
p
o
n
o
i
t
a
r
u
g
ﬁ
n
o
C
t
r
o
p
p
u
s
-
a
c
i
f
i
c
e
p
s
n
o
i
t
a
c
n
o
i
t
a
r
e
g
n
i
n
r
a