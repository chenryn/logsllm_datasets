Active Directory的安全始于能确保安全地配置域控制器（DC）。在今年夏天的BlackHat
USA大会上，我非常专业的提到了AD的安全，并提供了关于如何能够最好程度上保护Active
Directory安全的一些提示。这篇文章主要关注域控制器的安全性和一些跨越Active
Directory的安全性。毕竟我的博客被称为“ADSecurity” …
本文将会涵盖一些通过保护域控制器（简称“域控”）来保护Active Directory安全性的最佳方法，包括以下几个部分：
    1. 默认域和域控制器策略
    2. 创建域和域控制器安全基线GPO
    3. 修补域控制器
    4. 保护域控制器
    5. 域控制器推荐的组策略设置
    6. 配置域控制器审查模式（事件日志）
    7. 需要监控的域控制器事件（事件日志）
    8. 关键域控制器安全项
与基础架构的任何重大更改一样，请在部署更改之前进行测试。以免发生意外。
**默认域和域控制器组策略（GPO）**
当首次创建Active Directory域时，默认情况下会创建两个GPO：
    默认域策略 - GUID：{31B2F340-016D-11D2-945F-00C04FB984F9}
    默认域控制器策略 - GUID：{6AC1786C-016F-11D2-945F-00C04FB984F9}
请注意，这些GPO GUID对于每个Active Directory域实例都是相同的。
这是为了确保Windows可以快速找到这些GPO，如果它们被删除，则需要被恢复或重新创建。 [Active
Directory最佳实践分析工具](https://technet.microsoft.com/en-us/library/dd391875\(v=ws.10).aspx)查找默认GPO以确保其被正确应用。 GPO
GUID与AD对象GUID不同，因为某些GPO GUID需要相同的跨AD实例。
默认域策略应只包含以下设置：
    1. 密码策略
    2. 帐户锁定策略
    3. Kerberos策略
Windows Server 2012 R2的默认域策略的默认设置如上图所示。
默认域控制器策略应只包含以下设置：
  1. 用户权限分配
  2. 一些安全选项
Windows Server 2012 R2的默认域控制器策略的默认设置如上图所示。
**创建域和域控制器安全基准GPO**
将自定义设置放入默认GPO是非常吸引人的。 请抵制住这种冲动，因为它能更好地在新的GPO中添加一层额外的安全层（并且更容易进行变更管理）。
请注意，域密码策略实际上是一个具有链接到域的最高链接顺序的GPO，因此可以使用自定义密码策略设置创建新的GPO，链接到域，并将链接顺序移动到第一的位置上（如下图所示）。
据说，许多组织只是在默认域策略GPO中定制密码策略，这很好。不过，不要添加新的设置到默认域策略GPO; 尽量保持卫它的原样。
默认域策略GPO中的默认密码策略的设置有很多不足之处。 我建议收紧这些设置，使它们更安全。
如果有需要较少限制要求的帐户，请使用细粒度密码策略为异常提供更多宽松的密码设置。
  1. 强制密码历史记录：24（默认值很好）
  2. 密码最大年龄：60 – 180，取决于组织要求和最小密码长度。
  3. 密码最小年龄：1
将其设置为1或更高，以便用户不能简单地继续循环其新密码，直到他们翻阅密码历史记录以回到他们最喜欢的密码。
  1. 最小密码长度：14
有趣的是：通过组策略管理控制台（GPMC）设置的唯一可接受的值是数字0到14。即使手动设置在SYSVOL中关联的组策略设置文件，也无法设置更高的值因为这是不受支持的设置。更好的想法是在此处将其设置为14，然后使用[细粒度密码策略](https://blogs.technet.microsoft.com/canitpro/2013/05/29/step-by-step-enabling-and-using-fine-grained-password-policies-in-ad/)应用于组，并确保你希望将此设置应用的用户在此用户组中。
  1. 密码必须满足复杂性要求：启用
  2. 使用可逆加密存储密码：禁用
如果将此设置为启用，则在启用此设置时更改其密码的任何用户的密码都以可反转的方式存储在AD数据库（NTDS.dit文件）中，这意味着用户的密码可以提取。
  1. 帐户锁定持续时间：1 – 90分钟
设置一些值以缓解密码猜测尝试的攻击方式
  1. 帐户锁定阈值：5 – 20次登录尝试无效
设置以配置在锁定帐户之前需要多少次无效的登录尝试。
  1. 在多长时间后重置帐户锁定计数器：5 – 60分钟
设置以配置在无需帮助台帮助的情况下帐户自动解锁需要多长时间。
**第一步是创建两个新的GPO（这些只是示例）**
    1. 域安全策略基准
    2. 域控制器安全策略基准
域安全策略基准应包含应用于整个域的设置。
创建安全域策略和域控制器安全策略的最佳方法是下载Microsoft安全合规性管理器（当前版本为4.0），并在要为其创建安全基准的操作系统版本下选择“安全合规性”选项GPO。查看选项，根据需要进行更改，并导出为GPO备份（文件夹）。在域中创建新的空白GPO，并从SCM
GPO备份中“导入设置”，以便新的GPO具有与SCM导出的GPO有相同的设置。然后将此GPO应用于你的域控制器。如果你已配置了最小的安全设置，这将改进你的DC安全基线，特别是如果你还没有为现有的DC配置过GPO。
大多数包含的设置会在本文中的“保护域控制器”和“推荐的组策略设置”章节部分中进行标识和描述。
Microsoft SCM域安全合规性策略
（在部署之前请查看设置和测试）
Microsoft SCM域控制器安全合规策略
如果其中一个模板包含了FIPS合规加密，则需要验证是否需要设置此模板，因为Microsoft在2014年不推荐使用此模板。如果你不确定是否需要它，请最好不要启用它。
FIPS兼容加密实际上可能会导致一些问题。一些政府系统需要它，但请首先对应用程序进行广泛地测试。
作为开发安全基线的一部分，有几个大型组织花费时间和金钱来确定了什么才是“安全”：
    DoD STIG：http://iase.disa.mil/stigs/os/windows
    澳大利亚信息安全手册：
    http://www.asd.gov.au/infosec/ism/index.htm
    CIS基准：
    https://benchmarks.cisecurity.org/downloads/browse/?category=benchmarks.os.window