# 【技术分享】CSRF 攻击场景分析与重现学习

#### 译文声明
本文为翻译文章，原文来源：安全客。译文仅供参考，具体内容及含义以原文为准。
- 译者：[myles007](http://bobao.360.cn/member/contribute?uid=749283137)
- 预估稿费：300RMB
- 投稿方式：发送邮件至linwei#360.cn，或登录网页版在线投稿

### 学习概要
本文旨在通过实战案例深入浅出地讲解CSRF漏洞的定义、成因及其在实际场景中的利用方式，并介绍一些常用的Web安全测试插件和工具。文中将具体展示两个CSRF攻击场景：
1. 密码修改过程中的CSRF漏洞及利用
2. 后台管理添加过程中的CSRF漏洞及利用

此外，还简要列举了当前常用的防范CSRF漏洞的方法。

### 1. CSRF 基本概念
**CSRF（跨站请求伪造）**是一种攻击手段，攻击者利用已登录用户的身份，诱使其访问预先构造好的恶意链接或页面，在用户不知情的情况下，以用户的名义执行非法操作。这种攻击也被称为"One Click Attack"或"Session Riding"。相较于XSS攻击，CSRF攻击虽然不那么流行但更难以防范，因此被认为更具危险性。

### 2. CSRF 学习理解
一个成功的CSRF攻击通常需要三个关键因素：

1. **存在无需后台验证的数据修改或新增请求漏洞**
   - 关键词：跨站请求漏洞（CSR: Cross Site Request）
   - 目标站点或系统中必须存在可以进行数据修改或新增的操作，并且该操作在提交过程中未提供任何身份识别或校验参数。常见的场景包括密码修改、地址更改或后台管理员账户的添加等。

2. **伪装数据操作请求的恶意链接或页面**
   - 关键词：伪装请求（F: Forgery）
   - 恶意攻击者会构造一个看似正常的“数据修改或新增”请求，诱导受害者在其cookie有效期内点击该链接，从而触发CSRF漏洞。

3. **用户非本意的操作**
   - 关键词：非本意操作
   - 受害者在不知情的情况下访问了黑客精心设计的页面或链接，导致其个人信息被篡改，如密码变更或新管理员账号的创建。

### 3. CSRF 场景重现
接下来，我们将通过实际案例来演示如何发现并利用CSRF漏洞。

#### 3.1 密码修改之CSRF漏洞场景重现
用户信息数据修改是CSRF漏洞频发的区域之一，尤其是密码修改。以下将以DVWA平台为例，详细介绍CSRF漏洞在密码修改过程中的产生机制以及如何构建恶意链接和HTML页面。

##### 3.1.1 DVWA漏洞环境搭建
关于DVWA漏洞平台的搭建，请参考相关教程。准备完成后，使用默认账号（admin/password）登录开始实验。

##### 3.1.2 CSRF漏洞之密码修改过程
- 进入密码修改界面：设置安全级别为low后，点击CSRF进入密码修改页面。
- 修改当前用户admin的密码：输入新密码并确认提交。
- 登录验证：登出后重新登录，确认密码是否已成功更改。

##### 3.1.3 CSRF漏洞之发现分析
通过专业抓包工具（如Burp Suite）对密码修改过程中的网络请求进行分析，可以发现整个过程中仅有几个关键参数被传递而无额外验证机制，这正是CSRF攻击得以实施的原因所在。

###### 3.1.3.1 Burp Suite抓包分析
- 工具准备：Firefox浏览器、FoxyProxy代理插件、Burp Suite工具箱。
- FoxyProxy配置：搜索下载安装插件，选择工作模式启用代理服务器，配置IP地址与端口。
- 抓包详解：开启拦截模式，观察到密码修改请求仅包含password_new、password_conf、Change以及PHPSESSID、Security这几个字段，缺乏必要的身份验证。

###### 3.1.3.2 Tamper Data抓包分析
另一种方法是使用Tamper Data插件进行HTTP请求内容的捕获与修改，同样能帮助我们理解CSRF攻击的工作原理。

希望以上内容能够帮助大家更好地理解和防御CSRF攻击。