即使不是有名的网站，只要接入到网络中，SSH 或 FTP
等端口也会受到来自世界各地的攻击。对这些端口加以访问上的限制，可以有效的抵御这种无差别攻击。具体的方法有下面两种。
-   只允许来自专线或者 VPN 的连接
-   只允许来自指定 IP 的访问
其中限定 IP 的方法有下面几种。
-   在网络入库的路由或者防火墙上进行 IP 限制设置
-   利用服务器 OS 自带的功能（Windows 防火墙，或者 iptables、TCP Wrapper
    等）进行 IP 限制
-   利用软件自身的访问限制功能
下面的例子是使用 TCP Wrapper 来限制只有本地网络才能访问 sshd
服务的例子。首先在 /etc/hosts.deny 文件里禁止所有的访问请求，之后在
/etc/hosts.allow
文件里设置允许来自本地网络的访问请求。在需要通过网络进行系统维护的时候，最好使用固定
IP 访问服务器，并在服务器里对访问 IP 进行限制，这是非常安全的方法。
> **执行示例 使用 TCP Wrapper 对 sshd 进行访问限制设置**
![{%}](Image00240.jpg)
如果出口 IP 不是固定 IP 的话，建议在最小范围内限制能访问服务器的
IP。笔者由于需要在公司外面对 Web
服务器进行远程维护，所以我在配置文件里指定了 ISP
的域名，来设置能访问服务器的远程连接请求（图中 ISP
的域名为非真实域名）。
![{%}](Image00241.jpg)
通过查看服务器的日志（/var/log/secure）可以发现，针对 SSH
服务器的大部分攻击都是来自国外的 IP
地址，所以上面的设置能遮断大部分的攻击请求。尽管如此，也还是存在绕过 IP
地址限制的可能性的，这个问题可以请参考后面的关于强化认证功能的章节。
-   **通过端口扫描确认各端口服务状态**
    可以通过端口扫描工具来方便的验证访问限制是否有效。下面的图 7-3
    就是使用端口扫描工具 Nmap[3]{.注释编号} （Windows 版）对本书附带的
    Linux 镜像进行端口扫描的结果（默认设置时的结果）。Nmap
    是有名的端口扫描工具，而且是一个开源软件。
    ![{%}](Image00242.jpg)
    **图 7-3 端口扫描**
    从上图可以看出，这个系统一共运行着 SSH、SMTP、HTTP、POP3 等 4 种服务
    [4]{.注释编号} 。这其中 SSH
    是不需要对外部公开的端口，所以需要按照前面介绍过的方法进行访问上的限制。
    此服务器内同时还运行着 PostgreSQL 服务，但是 Nmap
    的扫描结果并没有显示出来。这说明 PostgreSQL
    不会接受来自外部的连接请求。
    下面图 7-4 显示的则是对笔者个人研究用的 Windows Server
    进行端口扫描的结果。
    ![{%}](Image00243.jpg)
    **图 7-4 对笔者的研究用服务器进行端口扫描的结果**
    笔者这台研究用服务开着很多端口接受来自外部的连接请求，如果这样的状态直接接入公网的话，是非常危险的。然而根据笔者进行安全咨询的经验，像这样开着很多端口的服务器还是时不时地能见到的。
    Web
    网站在运营时需要提供哪些服务，开放哪些端口，最好在前期设计的时侯就设计好，然后在系统投入运营之前，利用端口扫描等工具进行开放端口检查
    [5]{.注释编号} 。
[3]{.注释编号下} 
[4]{.注释编号下} 443 端口为 HTTPS 所使用，Nmap 的画面上都显示为 HTTP。
[5]{.注释编号下}
端口扫描要检查的是对外部网络访问开放的端口，需要使用接入到外网环境进行扫描。
#### **提高认证强度** {line-num="222 223"}
前面已经说过，系统管理用的软件应该对访问来源的 IP
地址进行严格的限制，然而这是不够的，还需要加强管理用软件的用户认证强度。具体可以采取以下措施。
-   删除或者停止 Telnet 和 FTP 服务，只使用 SSH 服务
-   在 SSH 服务中使用公钥认证方式来代替密码认证
说起 Telnet 和 FTP
的问题，一般人都会想到到非加密通信，然而笔者认为最大的问题应该是没有采用高强度的认证方式。像之前说到的那样，针对
Telnet、FTP、SSH 等的密码暴力破解攻击一直存在。即使使用了
SSH，在采用用户 / 密码作为认证方式这一点上，SSH 和 Telnet
等并没有太大的差异，强烈建议使用公钥认证方式。
## **7.2 防范伪装攻击的对策** {#text00000.html#nav_point_101 line-num="231 232"}
网站伪装攻击也是 Web
网站的常见威胁之一。网站伪装是指攻击者将准备好的攻击网站通过一定手段伪装成正规网站，诱骗用户访问。通过网站伪装攻击，可以达到篡改正规网站内容，或者盗取用户信息的目的。本节将先对网站伪装的常见方法进行说明，然后再讲述如何防范网站伪装攻击。
网站伪装主要有两种方法，一种是网络级别的伪装，一种是只复制网站外观的钓鱼方式。
### **7.2.1 网络伪装的手段** {#text00000.html#nav_point_102 line-num="237 238"}
本节将主要针对网络级别的伪装攻击进行说明，我们将通过以下这些曾经在网络上公开报道的真实事例来介绍。
-   针对 DNS 服务器的攻击
-   ARP 欺骗攻击
#### **针对 DNS 服务器的攻击** {line-num="244 245"}
针对对 DNS 服务器的攻击主要有以下几种类型。
-   通过发动对 DNS 服务器的攻击来替换 DNS 的配置
-   DNS 缓存污染攻击
-   购入已过期域名做非法之用
就在本书的编写期间，2010 年 11 月丹麦的著名安全公司 Secunia
的网站（ ）发生了 DNS 内容被改写的事故
[6]{.注释编号}
，致使用户访问了被攻击者替换后的内容。这次攻击虽然没有带来很大的损失，但是如果攻击者想做的话，可以通过放出虚假的漏洞信息来诱骗用户下载伪装为正规防病毒软件的恶意软件，不难想象这将会带来非常大的损失。
[6]{.注释编号下}  （参考日期：2010 年 11
月 28）
DNS 缓存污染攻击则是指向用户使用的 DNS
缓存服务器不停的发送查询请求，然后抢在 DNS
缓存服务器的应答到来之前，向客户端发送伪装的应答。这样客户端得到的 Web
服务器的 IP 就是攻击者准备的伪装服务器的 IP
地址了。这之后，用户就开始和伪装网站进行通信了。
关于如何去防范针对 DNS 服务器的攻击，我们将在 7.2.3 节里进行说明。
> **专栏：VISA 域名问题**
>
> "VISA 域名问题"是一个众所周知的失效域名问题的例子。
>
> 原本 VISA.CO.JP 的域名是由域名管理商 E-ONTAP.COM 负责解析的，但是后来
> E-ONTAP.COM 破产了，所以 E-ONTAP.COM
> 这个域名也就失效了，变成了任何人都可以申请的状态。但是这时候
> VISA.CO.JP 的第二域名服务器还是指向 E-ONTAP.COM
> 的域名服务器，没有做任何修改。
>
> 如果是有人恶意买入了 E-ONTAP.COM 域名的话，就可以利用其对 VISA.CO.JP
> 域名的解析权去做非法的事情了，还好中京大学的副教授铃木常彦意识到了这个问题后买入了这个域名，最后没有发生事故。
>
> VISA
> 域名问题虽然说是域名管理企业的域名失效导致的问题，但是现实中也存在自己的域名过期失效后被第三者买入的实例。建议在公司级别上指定针对域名管理的相关规定，比如指定专门的域名管理人员，决定好如何交接等问题。
#### **ARP 欺骗攻击** {line-num="268 269"}
ARP 欺骗是指通过发送伪造的 ARP（Address Resolution
Protocal）应答，以达到伪装成其他 IP 地址的目的。利用 ARP
欺骗进行网站伪装攻击时，当被攻击服务器向网络发送网关 IP 地址的 MAC
请求（ARP 请求）时，攻击者会抢先返回伪造的 ARP
应答，来冒充网关，从而截获所有与服务器的通信内容。ARP
欺骗攻击有一个限制条件，就是要和被攻击服务器在同一物理网段内。
2008 年 6 月某著名网站托管企业的数据中心发生的安全事故，就是由于 ARP
欺骗攻击导致的攻击案例。在此次事故中，托管中的一台服务器由于感染了恶意软件，从而导致了同一网段内发生了
ARP 欺骗攻击。由于被攻击的服务器内容里被加入了 iframe
内容，进而又导致了查看了被攻击网站网页的用户也被感染了恶意软件。
关于防范 ARP 欺骗攻击的对策，我们将在 7.2.3 节里进行说明。
### **7.2.2 钓鱼攻击** {#text00000.html#nav_point_103 line-num="276 277"}
钓鱼（Phishing）是指创建一个和原网站非常像的网站，然后通过邮件等发送链接，诱骗用户访问这个假网站并让用户在假网站上输入用户名、密码或其他个人信息，从而达到收集个人信息的目的。钓鱼比起网络级别的伪装（DNS
攻击或者 ARP
欺骗攻击）来说显得技术含量不是很高，但是经常有用户上当遭受损失。在日本也经常出现一些复制著名二手货交易网站或者
SNS 网站的钓鱼网站。
钓鱼攻击原则上和正规网站没有什么直接关系，但每个网站的用户都有可能被钓鱼网站欺骗。尽管预防钓鱼网站还主要靠用户自己来防范，但是作为网站方面，也应该采取一定的措施来帮助用户预防钓鱼网站。具体的内容我们将会在下一节进行说明。
### **7.2.3 Web 网站的伪装攻击对策** {#text00000.html#nav_point_104 line-num="282 283"}
防范针对 Web 网站的伪装攻击，可以采取下面的措施。
-   网络层的对策
-   使用 SSL/TLS
-   使用便于记忆的域名
下面按顺序对这几项进行说明。
#### **网络层的对策** {line-num="292 293"}
在 7.2.1 节里我们已经说过，网络层的伪装攻击主要通过 ARP 欺骗攻击和对 DNS
服务器的攻击来进行。虽然完全抵御这些攻击比较困难，但我们还是可以采取如下措施的。
-   **同一网段内不放置可能存在漏洞的服务器**
    由于 ARP
    欺骗攻击局限于在同一网段之内，所以在网段内不放置可能存在安全漏洞的服务器是其对策之一。也就是说，对同一网段的机器，不管其作用及重要程度如何，都应该一视同仁地实行安全漏洞防范措施。
    如果租用的服务器在同一网段内还有其他公司的服务器的话，最好向提供托管服务的公司咨询一下他们预防
    ARP 欺骗攻击的情况。
-   **强化 DNS 运维**
    DNS 是互联网最基本的服务之一，但仍然会经常由于配置错误或者漏洞导致
    DNS 问题出现。如何去安全的管理、维护一个 DNS
    服务器，可以参考下面我们罗列出来的 DNS
    的书籍以及独立行政法人信息处理推进机构（IPA）的内容。另外，也可以考虑将来使用
    DNSSEC。
    DNS 缓存污染攻击主要需要用户本身去防范，作为参考，我们一并将 DNS
    缓存污染攻击的相关资料也列了出来。[7]{.注释编号}
    -   关于域名注册和 DNS 服务器配置的注意事项
    -   DNS 缓存污染攻击对策（正文为 PDF 格式）
    -   关于 DNS 缓存污染攻击漏洞的注意事项
    -   注意关于 DNS 服务器的漏洞的再次提醒
[7]{.注释编号下} 中文的相关参考资料有：\
维基百科上关于"域名服务器缓存污染"的介绍：\
DNS
缓存投毒攻击原理与防御策略：\
DNS 相关的攻击介绍：
------译者注
#### **引入 SSL/TLS** {line-num="323 324"}
SSL（Secure Sockets Layer）和 TLS（Transport Layer Security）也是防范
Web 网站伪装攻击的有效对策。在下面的说明中我们把这两个词统称为 SSL。提起
SSL
大家的第一印象一般是用来进行加密通信的，但是它还有另一个重要的功能，就是通过第三方机构（Certification
Authority，认证中心）来验证域名的合法性。如果 Web
网站的管理员和用户都能熟练的使用 SSL 的话，那么就可以通过 SSL
来达到防范网站伪装攻击的目的。
作为网站的管理人员，正确使用 SSL
功能的第一步就购买合法的数字证书。购买了合法证书的网站域名会由认证中心来公证其合法性。即使
Web
网站被伪装攻击了，那么用户也可以通过浏览器的警示意识到访问了假冒网站。图
7-5 显示的是 Internet Explorer 9
的数字证书错误的页面。这也可以通过在本书的模拟环境提供的虚拟机中启动浏览器访问
 来确认。
![{%}](Image00244.jpg)
**图 7-5 访问证书有问题时网站的警告**
电子证书可以有效地对网站伪装攻击进行防范，但如果只是以抵抗钓鱼攻击为目的，则可以根据电子证书的种类不同采取不同的使用方式。现在能购买到的证书种类有以下几种，下面是按价格从低到高的顺序排列。
-   域名认证证书
-   组织认证证书
-   EV-SSL 证书
域名认证证书的组织名一栏里会显示域名本身，不会对组织名做认证。组织认证证书则会在组织栏里显示企业、团体名称，以及个人姓名等。EV-SSL
证书则会根据 CA/Browser Forum 制定的标准 [8]{.注释编号}
对企业的真实性进行验证。
[8]{.注释编号下} 
使用 EV-SSL 会很容易分辨出伪装的网站。图 7-6 显示的是通过 HTTPS 协议访问
verisign
公司网站时的页面。这时候浏览器的地址栏会变成绿色，并且右侧多了一个带锁头图标的显示区域。锁头图标右侧就是以英语显示的企业名称等信息。
![{%}](Image00245.jpg)
**图 7-6 EV-SSL 会验证企业信息的真实性**