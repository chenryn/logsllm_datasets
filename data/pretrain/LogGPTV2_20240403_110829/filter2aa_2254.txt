1
luks 全盘加密的⼀个通⽤解密⽅法--从内存中提
取LUKS MASTER KEY
前⾔
破解LUKS全盘加密
从内存镜像中提取MASTER KEY
第⼀步 判断加密算法
第⼆步 DUMP 包含秘钥的内存
第三步 从内存寻找aes key
第四步 解密分区
第五步 解密其他分区
作者:橙⼦酱 
之前的⽂章中提到了⼀种有启动分区的情况
磁盘主引导->引导分区->引导内核->系统启动->解密挂载分区 (⼀个引导分区 +⼀个主分区) 
遇到这种情况就可以通过简单的提取⽂件系统中的秘钥解决. 
但是运⽓不好还会遇到两种更变态的情况
磁盘主引导->引导分区->引导内核->引导内核中解密挂载分区->系统启动->解密挂载分区(只有⼀个引
导分区) 
磁盘主引导->磁盘引导程序->解密分区->引导->系统启动->解密其他分区 (⼀个明⽂分区都没有) 
前⾔
2
这时,通常只能通过逆向引导程序来提取内核镜像.最终拿到镜像中的秘钥⽂件. 
这个过程⼗分的繁琐. 在没有符号表的情况逆向魔改过的linux引导内核也⾮常困难. 
那么有没有⼀个简单的⽅法解决这个问题呢? 
luks 解密进⾏磁盘后硬盘上的数据实际仍然是加密的. 
为了可以实时读写加密分区内的数据,加解密使⽤的秘钥⼀定存在于内存之中. 
破解LUKS全盘加密 
钱镜洁， 魏鹏， 沈⻓达. LUKS加密卷的离线解密技术分析[J]. 信息⽹络安
全, 2014, 14(9): 217-219.
3
挂载硬盘 使⽤cryptsetup luksDump  判断分区使⽤的加密算法 
本⽂使⽤的是 AES 256 加密 (默认加密算法)
在虚拟机第⼀个分区完成解密后,dump虚拟机完整内存 (快照 暂停 命令⾏ 均可) 
使⽤⼯具从内存寻找aes key 
https://sourceforge.net/projects/findaes/
https://github.com/mmozeiko/aes-finder 
https://www.kali.org/tools/aeskeyfind/ 
从内存镜像中提取MASTER KEY 
第⼀步 判断加密算法 
第⼆步  DUMP 包含秘钥的内存 
第三步  从内存寻找aes key 
4
选择对应⻓度的key  hex转成raw⽂件作为key 
第四步 解密分区 
5
ryptsetup luksOpen 加密的分区 --master-key-file key⽂件  挂载名 
依次尝试各个分区和各个秘钥的组合 ⽆错误返回即为解密成功. 
挂载解密后的分区,在解密后寻找⾃动挂载⽂件  /etc/crypttab 
得到其他秘钥位置. 
之后的步骤就按照之前的⽂章操作
第五步 解密其他分区