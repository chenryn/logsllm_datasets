346 DHCP Offer
5.522000
0.0.0.0
255.255.255.255
DHCP
414 DHCP Request
7
8
5.584000
192.168.100.1
192.168.0.1
DHCP
346 DHCP ACK
2
Vlanif10发现这是一个DISCOVER报文，根据管
理员配置的DHCP服务器地址，将该报文重新封
装后发给DHCP服务器（单播报文），首部地址
DHCP中继（RS-1）←→DHCP服务器
如图所示。报文中包含客户端MAC和中继的IP
No.
Time
Source
Destination
Protocol
Length Info
5
6.489000
192.168.0.254
192.168.100.1
DHCP
410 DHCP Discover
2
6
6.552000
192.168.100.1
192.168.0.254
DHCP
342 DHCP Offer
9
8.455000
192.168.0.254
192.168.100.1
DHCP
410 DHCP Request
10
8.502000
192.168.100.1
192.168.0.254
DHCP
342 DHCP ACK
Vlanif10: 192.168.0.254
DHCP服务器：192.168.100.1
Host-1获取IP：192.168.0.1
>>河南中医药大学《网络应用技术》课程教学组《
---
## Page 59
59
抓包分析DHCPRelay的工作过程
DHCP中继收到服务器发回的offer报文后，根
据报文中的客户端MAC和所分配的IP地址，对
Host-1 ←—→DHCP 中继 (RS-1)
offer报文重新封装后，发给客户端（单播）
Time
Source
Destination
Protocol
No
LengthInfo
3.525000
0.0.0.0
255.255.255.255
DHCP
414 DHCP Discover
3
4
3.619000
192.168.100.1
192.168.0.1
DHCP
346 DHCP Offer
5.522000
0.0.0.0
255.255.255.255
DHCP
414 DHCP Request
7
8
5.584000
192.168.100.1
192.168.0.1
DHCP
346 DHCP ACK
DHCP服务器从收到的discover报文中获取了
DHCP中继的IP地址和客户端的MAC地址，然后
向DHCP中继发回offer报文（单播报文），报
DHCP中继（RS-1）←→DHCP服务器
文首部的IP地址如图所示。
No.
Time
Source
Destination
Protocol
LengthInfo
5
6.489000
192.168.0.254
192.168.100.1
DHCP
410 DHCP Discover
6
6.552000
192.168.100.1
192.168.0.254
DHCP
342 DHCP Offer
9
8.455000
192.168.0.254
192.168.100.1
DHCP
410 DHCP Request
10
8.502000
192.168.100.1
192.168.0.254
DHCP
342 DHCP ACK
Vlanif10: 192.168.0.254
DHCP服务器：192.168.100.1
Host-1获取IP：192.168.0.1
>>河南中医药大学《网络应用技术》课程教学组《
---
## Page 60
60
抓包分析DHCPRelay的工作过程
Host-1发出request报文（包含所申请的地址
信息等），广播报文，该报文可到达位于三层
Host-1 →DHCP 中继 (RS-1)
交换机RS-1的DHCP中继（即vlanif10）。
Time
Source
Destination
Protocol
No
LengthInfo
3.525000
0.0.0.0
255.255.255.255
DHCP
414 DHCP Discover
3
4
3.619000
192.168.100.1
192.168.0.1
DHCP
346 DHCP Offer
5.522000
0.0.0.0
255.255.255.255
DHCP
414 DHCP Request
7
8
5.584000
192.168.100.1
192.168.0.1
DHCP
346 DHCP ACK
Vlanif10发现这是一个request报文，根据管
理员配置的DHCP服务器地址，将该报文重新封
装后发给DHCP服务器（单播报文），首部地址
DHCP中继（RS-1）←→DHCP服务器
如图所示。报文中包含客户端MAC和中继的IP
No.
Time
Source
Destination
Protocol
LengthInfo
5
6.489000
192.168.0.254
192.168.100.1
DHCP
410 DHCP Discover
6
6.552000
192.168.100.1
192.168.0.254
DHCP
342 DHCP Offer
9
8.455000
192.168.0.254
192.168.100.1
DHCP
410 DHCP Request
10
8.502000
192.168.100.1
192.168.0.254
DHCP
342 DHCP ACK
Vlanif10: 192.168.0.254
DHCP服务器：192.168.100.1
Host-1获取IP：192.168.0.1
>>河南中医药大学《网络应用技术》课程教学组>河南中医药大学《网络应用技术》课程教学组>河南中医药大学《网络应用技术》课程教学组>河南中医药大学《网络应用技术》课程教学组>河南中医药大学《网络应用技术》课程教学组
---
## Page 65
口DHCP中继案例
>>河南中医药大学《网络应用技术》课程教学组<<
---
## Page 66
DHCP中继案例
■
R-1
R-1
R-2
R-2
areao
GE0/0/0:10.0.0.1/30
GE0/0/0:10.0.0.2/30
GE 0/0/0
GE 0/0/0
GE0/0/1: 10.0.1.1/30
GE0/0/1:10.0.3.1/30
GE0/0/2:10.0.2.1/30
GE_Q041-
GE 00/2
GE 0/0/1
area2
RS-1
GE 0/0/24
area1
GE 0/0/24
GE 0/0/1
Vlanif10:192.168.0.254/24
RS-3
Vlanif11: 192.168.1.254/24
RS-1
RS-2
Vlanif100: 10.0.3.2/30
Vlanif100: 10.0.1.2/30