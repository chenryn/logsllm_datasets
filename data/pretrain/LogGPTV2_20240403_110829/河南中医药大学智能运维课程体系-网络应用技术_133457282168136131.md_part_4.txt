## DHCP Relay 工作过程分析

### 1. 概述
DHCP Relay（DHCP 中继）是一种网络设备，它允许位于不同子网的客户端与 DHCP 服务器进行通信。以下是通过抓包分析 DHCP Relay 的工作过程。

### 2. 抓包分析

#### 2.1 发现 (Discover) 阶段
- **时间**: 3.525000
- **源地址**: 0.0.0.0
- **目标地址**: 255.255.255.255
- **协议**: DHCP
- **长度信息**: 414 DHCP Discover

**描述**:
Host-1 发送一个 DHCP Discover 广播报文，请求 IP 地址分配。

- **时间**: 6.489000
- **源地址**: 192.168.0.254
- **目标地址**: 192.168.100.1
- **协议**: DHCP
- **长度信息**: 410 DHCP Discover

**描述**:
Vlanif10 (192.168.0.254) 收到 Discover 报文后，根据管理员配置的 DHCP 服务器地址 (192.168.100.1)，将报文重新封装并单播发送给 DHCP 服务器。报文中包含客户端 MAC 地址和中继的 IP 地址。

#### 2.2 提供 (Offer) 阶段
- **时间**: 3.619000
- **源地址**: 192.168.100.1
- **目标地址**: 192.168.0.1
- **协议**: DHCP
- **长度信息**: 346 DHCP Offer

**描述**:
DHCP 服务器收到 Discover 报文后，向 Vlanif10 发回一个 Offer 报文，提供一个 IP 地址 (192.168.0.1) 给客户端。报文是单播发送的。

- **时间**: 6.552000
- **源地址**: 192.168.100.1
- **目标地址**: 192.168.0.254
- **协议**: DHCP
- **长度信息**: 342 DHCP Offer

**描述**:
Vlanif10 收到 Offer 报文后，将其重新封装并单播发送给 Host-1。

#### 2.3 请求 (Request) 阶段
- **时间**: 5.522000
- **源地址**: 0.0.0.0
- **目标地址**: 255.255.255.255
- **协议**: DHCP
- **长度信息**: 414 DHCP Request

**描述**:
Host-1 收到 Offer 报文后，发送一个 DHCP Request 广播报文，确认接受提供的 IP 地址 (192.168.0.1)。

- **时间**: 8.455000
- **源地址**: 192.168.0.254
- **目标地址**: 192.168.100.1
- **协议**: DHCP
- **长度信息**: 410 DHCP Request

**描述**:
Vlanif10 收到 Request 报文后，将其重新封装并单播发送给 DHCP 服务器。

#### 2.4 确认 (ACK) 阶段
- **时间**: 5.584000
- **源地址**: 192.168.100.1
- **目标地址**: 192.168.0.1
- **协议**: DHCP
- **长度信息**: 346 DHCP ACK

**描述**:
DHCP 服务器收到 Request 报文后，向 Vlanif10 发回一个 DHCP ACK 报文，确认 IP 地址分配。

- **时间**: 8.502000
- **源地址**: 192.168.100.1
- **目标地址**: 192.168.0.254
- **协议**: DHCP
- **长度信息**: 342 DHCP ACK

**描述**:
Vlanif10 收到 ACK 报文后，将其重新封装并单播发送给 Host-1，完成 IP 地址分配过程。

### 3. 总结
- **Vlanif10**: 192.168.0.254
- **DHCP 服务器**: 192.168.100.1
- **Host-1 获取的 IP 地址**: 192.168.0.1

### 4. DHCP 中继案例
#### 4.1 网络拓扑
- **R-1**
  - GE0/0/0: 10.0.0.1/30
  - GE0/0/1: 10.0.1.1/30
  - GE0/0/2: 10.0.2.1/30
- **R-2**
  - GE0/0/0: 10.0.0.2/30
  - GE0/0/1: 10.0.3.1/30
- **RS-1**
  - Vlanif10: 192.168.0.254/24
  - Vlanif100: 10.0.3.2/30
- **RS-2**
  - Vlanif100: 10.0.1.2/30
- **RS-3**
  - Vlanif11: 192.168.1.254/24

### 5. 课程信息
- **河南中医药大学《网络应用技术》课程教学组**

---

希望以上内容能够清晰地展示 DHCP Relay 的工作过程及其在网络中的应用。如果有任何问题或需要进一步解释，请随时联系我。