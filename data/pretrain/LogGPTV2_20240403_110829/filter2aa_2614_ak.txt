4.3.3 辅助类工具及综合类工具
在日常工作中，每个人都会有一些自己特别喜爱的小工具。在API
安全方面，辅助类工具也常常被使用到，它们不一定跟安全有着强关联
关系，但因能帮助安全人员解决实际工作中的某一方面问题而被保存在
用户的工具箱里。
在前文介绍典型工具的章节中，曾多次提及API规范文件，不同的
API使用的规范描述不尽相同。当用户想将每一个API的配置信息导入
Burp Suite或SoapUI时，会遇到需要将API规范文件标准化的问题，这时
其实是需要一个协议转换器，比如将GraphQL的API转换为OpenAPI，
再导入相应的工具中。常用的协议转换器有很多，比如Apimatic API转
换器、har2openapi转换器、swagger2openapi转换器等，在这里主要推荐
一下Apimatic API转换器，因为它支持的文件格式是所有转换器工具中
最多的。
Apimatic API转换器是一个在线的SAAS服务，访问其网站后，上传
原文件（https://www.apimatic.io/transformer），可以获取需要转换的新
格式文件。目前其支持的文件格式如图4-21所示。
●图4-21 Apimatic API转换器支持的文件格式
除了转换器，数据校验器也很常用。数据校验器的功能主要是验证
API的请求和响应是否与API文档描述一致，比如创建一个API并生成随
机值，根据API规范文件描述，对值进行序列化、反序列化和验证。这
类的工具主要有OpenAPI Enforcer、oas-tools、Swagger Inspector等。
另外，API规范编辑器也是常用的辅助工具之一，比如Swagger-
Editor、graphiql等。
综合类工具与其他类工具的不同在于其包含的功能更广泛，比如既
包含API的漏洞发现，又包含API的安全防护；既包含API的研发管理，
又包含API的运维监控。这类的工具以API网关产品和API管理平台产品
为主，其中具有代表性的产品有Google公司的Apigee、开源产品Kong、
亚马逊公司的Amazon CloudWatch等。
4.4 小结
本章为读者介绍了API安全的常用工具集，并对常用的工具进行了
分类。根据各个工具在日常工作中使用频度，详细地介绍了API安全小
贴士、Burp 
Suite、Postman、SoapUI这4个工具。同时，对其他的工
具，如Imperva公司开源的自动化API攻击工具、经典网络安全工具
Acunetix WVS和Wireshark、API转换器以及API网关等也做了概要的介
绍。
通过这一章内容的学习，读者能够熟悉API日常安全工作的全貌、
各个阶段会使用到哪些工具以及各个工具的用途。接下来的章节中，笔
者将通过工具的使用，深入讲解API渗透测试过程中的诸多细节。
第5章 API渗透测试
在API生命周期管理中，渗透测试是一项很重要的工作。它与功能
测试、模糊测试不同，通过渗透测试中发起的针对目标的模拟攻击行
为，可以先于黑客攻击前发现潜在漏洞和危害，降低API安全风险，减
少因安全问题带来的损失。本章将围绕API渗透测试流程展开叙述，结
合渗透测试的关键步骤，介绍不同类型API渗透测试的特点。
5.1 API渗透测试的基本流程
API渗透测试与普通Web应用程序渗透测试类似，都是通过对资产
暴露面的分析与模拟攻击，挖掘系统中存在的安全缺陷。其基本流程也
遵循渗透测试执行标准，主要包含的步骤：前期准备、信息收集、漏洞
分析、漏洞利用、报告编撰等。结合国内渗透测试工作开展的实际情
况，这里将API渗透测试过程划分为3个阶段。
■ 前期准备阶段：这一阶段的工作是为后续渗透测试工作的真正开
展做准备，主要以甲乙双方的交流沟通为主，目前是明确渗透测试的目
标和范围、开展的周期、相关干系人、配套资源以及渗透测试授权书
等。
■ 渗透执行阶段：在了解了本次渗透的主要信息并获得授权后，即
可以开始进入渗透执行阶段。这一阶段的内容与上文所提及的渗透测试
执行标准类似，主要包含API运行环境的基本信息收集（比如IP、域
名、端口、Swagger文件、WSDL文件等）、攻击面分析、漏洞挖掘、
漏洞利用、成果汇总等。
■ 总结汇报阶段：在针对API的渗透测试工作结束后，渗透测试人
员已经获得了一些成果（比如漏洞列表、被攻陷的系统、暴露的数据
等），需要将这些成果进行汇总整理，结合业务情况进行分析，并与相
关干系人进行沟通交流，达成共识，最后输出正式的渗透测试报告，
并完成汇报。
在这3个阶段中，其技术难度主要集中在渗透执行阶段，接下来将
围绕此阶段重点展开叙述。
5.1.1 API渗透测试的关键点
熟悉项目管理的读者从渗透测试3个阶段的划分方式，可以看出，
一个渗透测试的过程其实可以对应于一个项目管理的过程。在开展渗透
测试活动时，也可以采用项目管理的思想来管理整个过程，制订实施计
划，识别和管理风险，以达到渗透测试的目的。为了保证渗透测试活动
开展的成功性，渗透测试人员需要把握以下关键点。
■ 渗透测试的目的：为什么要做渗透测试，渗透测试完成之后需要
达到什么效果，这些是渗透测试活动开展前首先要考虑的。大多数渗透
测试活动的开展都是有一定背景的，比如满足监管合规要求、配合开展
安全审计、信息系统全面的安全风险评估。总之，都是有缘由的，这是
整个事情的出发点和归宿。只有清楚了渗透测试的目的，才能在活动开
展过程中，抓大放小，理解重点，达到渗透测试活动开展的预期效果。
■ 根本原因分析：理解了渗透测试的目的，还需要做进一步的根本
原因分析。根本原因分析的前提是识别问题，发现当前环境下需要渗透
测试的信息系统或API服务存在哪些问题（比如管理上的问题、业务上
的问题、技术架构上的问题等）。正是这些问题的存在使得管理者需要
通过渗透测试来了解整体安全状况。
■ 渗透测试范围：了解了渗透测试的目的和根本原因，接下来来了
解渗透测试的范围，以便为后续具体执行方案的制定提供方向。渗透测
试范围一般是大小合适最好，范围过大导致工作量和成本增加且无法把
握重点，范围过小则达不到渗透测试的目的。渗透测试范围的界定通常
是和业务管理者、技术管理者共同商讨的结果。业务管理者对高层关注
度、业务方面的风险理解深刻，知道当前的重点和迫切需求是什么；技
术管理者对信息系统的整体架构、技术选型、资产情况、历史安全事件
理解深刻，可以提供很好的参考意见。一个成功的渗透测试范围的界
定，是联合多个干系人共同协商并达成一致的结果。
■ 可执行的实施计划：实施计划是基于根本原因分析后，为解决当
前存在的问题或措施的落地而制定的解决方案。一个可落地、可执行的
实施计划有利于早期发现问题，及时纠正；同时，也利于计划实施过程
中的跟踪和分析。实施计划的制定可以参考项目管理过程中WBS（工作
分解结构）分解的方式，先粗后细，先制定关键里程碑节点，再循序渐
进细化各个环节。制定实施计划的过程也是熟悉计划落地的过程，通过
计划制定明确进度、工期、人力、资源的投入情况。
■ 渗透测试团队组建：再好的实施计划都要依赖人去执行，渗透测
试团队的组建也是渗透测试过程中很关键的一项工作。团队成员除了专
业的渗透测试人员外，一般还要有业务人员和信息系统研发或运维人员
帮助渗透测试团队理解渗透测试环境、漏洞以及业务逻辑的相关问题。
如果公司没有专门的渗透测试人员，则需要招募外部渗透测试人员，对
于团队的管理、内外部协调也是很重要的一项工作内容。
■ 沟通汇报：在渗透测试工作开展的过程中，沟通是一项必不可少
的工作，沟通的目的是为了让相关干系人了解渗透测试工作的现状，同
步关键信息，减少无意义的误解和歧义，增强管理层、团队人员对渗透
测试工作的信心，促进渗透测试工作走向既定目标。沟通的方式有很多
种，可以选择定期的会议、每天的日报、每周的周报、口头汇报以及即
时通信工具等，通过沟通，让关系渗透测试工作的人了解他想了解的内
容，统一目标和利益关系，达成共识，为最终目的助力。
5.1.2 API渗透测试注意事项
渗透测试作为一项模拟黑客攻击的活动，与日常的IT工作存在较大
的区别，在渗透测试过程中有一些注意事项，如果疏忽，可能导致整个
渗透测试工作失败甚至更严重的后果。这些注意事项如下。
■ 书面授权：自从2017年6月1日正式施行网络安全法以来，在开展
渗透测试工作之前，首先要获得客户的书面授权已成为业界的共识。如
果企业内部有自己的渗透测试人员一般没有那么严格，但如果是外部合
作客户，在渗透测试工作开展前，拿到书面授权书既是工作进入一个新
阶段的标志，也是自我保护的一种方式，渗透测试人员尤其需要注意。
■ 专业技术人员：API渗透测试虽然和普通的Web安全类似，但仍
有一些技术不同点，尤其是当前API技术在业务系统中广泛使用，不熟
悉API技术的渗透测试人员很难通过细粒度的协议分析识别出API技术
相关的安全问题，越是熟悉技术细节的人，在渗透测试过程中，越是容
易发现不易察觉的漏洞，将整个渗透测试的效果大幅度提升。
■ 对安全的期望：渗透测试与产品研发过程中的安全测试虽然很多
情况下被视为同一项工作，但事实上并不是。渗透测试是以对API的渗
透和漏洞发现为手段，而不是像安全测试一样为了找出所有的安全问
题。也就是说没有渗透成功的API服务不一定就是安全性较高，可能是
渗透测试人员水平不够；同样渗透成功的API服务也不一定就是安全性
较差。API服务整体是否安全是结合API生命周期的一个综合性的判断
结果，这需要在渗透测试开始时跟管理层沟通，以达到与原始期望的一
致。
■ 安全告知：渗透测试工作一般都是对线上的生产系统开展的，在
渗透测试过程中会产生一些垃圾数据或对业务的运行造成影响。这需要
在渗透测试人员进场时，向业务负责人告知其风险，并选择非业务高峰
期开展渗透测试活动，避免对业务产生过大的影响。同时，作为渗透测
试人员，在渗透过程中，避免使用大面积的扫描、大流量的并发；在渗
透测试结束后，应当及时清理渗透过程中遗留在信息系统中的数据、文
件、工具或软件等。
5.2 API渗透测试步骤
前文中介绍的渗透测试的3个阶段是从项目管理的角度划分的。在
业界的渗透测试执行标准中，将渗透测试划分为标准的73个步骤：前期
交互、信息收集、威胁建模、漏洞发现、漏洞利用、后渗透或横向移
动、报告撰写。因API安全的部分步骤与传统Web安全雷同，所以在这
里重点介绍信息收集、漏洞发现、漏洞利用、报告撰写4个步骤。
5.2.1 信息收集
信息收集是整个API渗透测试阶段的入口，其收集到的数据是否准
确、全面对于其后期渗透工作的开展尤其重要。一般来说，信息收集主
要有以下3种途径。
■ 自动化收集：提供自动化工具收集被渗透对象的相关信息，比如
域名、子域名、IP、端口、DNS、路径、参数等。
■ 手工收集：除了自动化工具收集到的信息外，还有些信息需要手
工收集或整理归类，形成渗透所需要的材料。比如业务流程、组织结
构、人员职能等。
■ 情报收集：通过商业合作或其他渠道，从外部获得系列的关键信
息。这种方式随着当前网络攻防对抗强度的不断提升，在各个企业中的
应用越来越普遍。
无论是使用一种方式还是多种方式的组合，其目的都是尽可能地收
集被渗透对象的相关信息。在API渗透中，除了常规的域名、端口、服
务器banner之类的信息外，API本身所特有的信息在信息收集时需要关
注。举例如下。
API是否存在接口定义规范描述文件？
■ 如果存在，遵循的规范是什么？SOAP、Open API 2.0、Open API
3.0还是Graph QL？
■ 