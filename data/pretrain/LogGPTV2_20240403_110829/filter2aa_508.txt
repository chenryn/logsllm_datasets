# Defending Networks with Incomplete Information: A Machine Learning Approach

**Speaker: Alexandre Pinto**  
**Contact: PI:EMAIL, @alexcpsec, @MLSecProject**

## Introduction
- This talk focuses on **defending** networks, not attacking.
- No systems were harmed in the development of this presentation.
- The goal is to **build** something useful.
- This talk will involve more math than the daily recommended intake by the FDA. You have been warned!

## About the Speaker
- 12 years of experience in Information Security, covering a wide range of roles.
- Led security consultancy and monitoring teams in Brazil, London, and the US.
- Extensive experience with SIEM (Security Information and Event Management) systems.
- Researching machine learning and data science for the past year, participating in Kaggle competitions for fun.
- First-time presenter at DefCon.

## Agenda
1. **Security Monitoring: We Are Doing It Wrong**
2. **Machine Learning and the Robot Uprising**
3. **Data Gathering for InfoSec**
4. **Case Study: Model to Detect Malicious Activity from Log Data**
5. **MLSec Project**
6. **Attacks and Adversaries**
7. **Future Directions**

## The Monitoring Problem
- **Logs, Logs Everywhere**: 
  - SANS Eighth Annual 2012 Log and Event Management Survey Results indicate that current tools may not be the best fit for the job.
- **Correlation Rules**:
  - Typically, rules in SIEM solutions are based on event frequency and relationships between events.
  - Configuring SIEM involves iterating on combinations until customer satisfaction or budget constraints.
  - Behavioral rules (anomaly detection) can help but are still laborious and time-consuming.

## Not Just a Tool Problem
- Finding capable professionals to manage these tools is extremely challenging.
- The need for individuals who understand statistics, data analysis, and data science is growing.

## Enter Big Data Technologies
- **We Need an Army of Robots!**
  - Machine learning systems automatically learn programs from data.
  - These systems mimic the way the brain learns, leading to terms like "artificial intelligence."

## Applications of Machine Learning
- **Sales and Trading**
- **Image and Voice Recognition**
- **Security Applications**:
  - Fraud detection systems
  - Network anomaly detection
  - SPAM filters

## Kinds of Machine Learning
- **Supervised Learning**:
  - Classification (Neural Networks, SVM, Naïve Bayes)
  - Regression (Linear, Logistic)
- **Unsupervised Learning**:
  - Clustering (k-means)
  - Decomposition (PCA, SVD)

## Considerations on Data Gathering
- **Data Quality**:
  - Models generally improve with more data, but bias and variance must be considered.
  - Adversaries may feed bad data, creating noise or exploitable features.
- **Adversarial Exploitation**:
  - Understanding the model and the machine can help adversaries circumvent it.
  - Predictive models in InfoSec will be pushed to their limits, as seen in the evolution of SPAM engines.

## Designing a Model to Detect External Agents with Malicious Behavior
- **Data Collection**:
  - Firewall block data from SANS DShield (per day).
  - Summarized malicious data per port.
- **Model Intuition**:
  - **Proximity**: Correlation and similarity by behavior, using concepts like "Bad Neighborhoods."
  - **Temporal Decay**: Even bad neighborhoods can change over time, so a half-life decay function is used.
- **Feature Engineering**:
  - Cluster data to predict specific behaviors.
  - Create a "Badness" rank and calculate normalized ranks by IP, Netblock, and ASN.
  - Handle missing ASNs and bogons separately.

## Training the Model
- **Dataset Creation**:
  - Use blocked log files to gather "badness" data and labels.
  - Include non-malicious IPs from sources like Alexa and Chromium Top 1m Sites.
- **Algorithm Selection**:
  - Support Vector Machines (SVM) are chosen for their robustness and ability to handle numeric features.
- **Results**:
  - Training accuracy: 83% to 95%.
  - Test accuracy: 79% to 95%, increasing over time.
  - True positive rate: 70% to 92%.
  - True negative rate: 95% to 99%.

## Attacks and Adversaries
- **Challenges**:
  - IP addresses are not always reliable.
  - Dealing with anonymous proxies, Tor, and fast-flux Tor.
- **Process Design**:
  - Designed to handle different actors and clustering behaviors.

## Future Directions
- **SOC Tiers 1 and 2**:
  - Help analysts prioritize and act on data.
- **Ensemble Algorithms**:
  - Compose algorithms for increased precision.
- **SDN Systems**:
  - Implement systems to redirect detected attackers through longer paths or to honeypots.
- **Immediate Blocking**:
  - Block connections immediately based on predictive power.

## Final Remarks
- **Sign Up and Contribute**:
  - Send logs, receive reports generated by machine learning models.
  - Free and open to contributions, ideas, and skeptics.
  - Visit [MLSec Project](https://www.mlsecproject.org), message @MLSecProject, or email the speaker.

## Takeaways
- Machine learning can significantly assist in data-intensive activities like SIEM and security tool monitoring.
- The odds likelihood ratio (12x to 18x) represents a substantial gain in efficiency for monitoring teams.
- MLSec Project offers a promising start, and there is much potential for future developments.

## Q&A
- Questions and feedback are welcome.

**Alexandre Pinto**  
**Contact: PI:EMAIL, @alexcpsec, @MLSecProject**

*"Prediction is very difficult, especially if it's about the future."*  
— Niels Bohr