Top – 图标上方
Host 如果当前元素类型为Host，可选择相应的host，需要搜索
Map 如果当前元素类型为map，可选择相应的map
Trigger 如果当前元素类型为trigger，可选择相应的trigger
Host group 如果当前元素类型为Host Group，可选相应的group，需要搜索
Icon (default) 默认图标
Automatic icon selection 使用icon mapping 来决定使用哪个图标
Icons 元素在不同状态下不同的图标:
default, problem, maintenance, disabled.
Coordinate X map元素横坐标
Coordinate Y map元素纵坐标
URLs monitoring–map–你的 map–点击你的元素会出现一个菜单，如果有指定 urls，那
么 url 会出现在当前菜单中。你可以点击当前 url 来跳转到具体页面。urls 可以使用
macros: {MAP.ID}, {HOSTGROUP.ID}, {HOST.ID}, {TRIGGER.ID}
备注：大家一定要记得点击上面的“save”按钮，否则你所有的更改都白费了，zabbix这点很讨厌，不会自动保存，
我已经多次忘记点击save，然后一切重来。在我们未保存的情况下离开map页面，zabbix提示我们保存，那多好，
可惜zabbix竟然没有这么做。为什么？
批量修改 map 元素
按住Ctrl的同时，鼠标选中多个map元素，如下图：
我们批量修改了元素名称，使用macro{HOST.IP}，并且label名称在元素的左边，效果如下
map 元素相连接
网络拓扑上有了服务器、交换机、路由器，还差一条网线把他们连在一起，并且标明他们之间的链路速度。按住
Ctrl并且选中两个设备，点击上方LINK后边的”+”，在弹出的属性框最后将会增加一条链路属性，点击edit，输入
相关信息，如下：
属性说明
属性 说明
Label 线路名称，可以使用macro
Connect to 当前元素与哪个元素连接
Type (OK) 连接线风格:
Line – 细线
Bold line – 粗线
Dot – 点线
Dashed line – 虚线
Lable 线路名称
Colour (OK) 线条颜色.
Link indicators 链路状态，触发器有故障都会显示到链路上
链路效果如下
zabbix 拓扑图展示链路状况 Link indicators
介绍
上一篇文章《zabbix网络拓扑图配置》我们已经了解了如何配置zabbix map，也提到了如何连接两个map元素，这
节我们来讲两个map元素之间的链路指示配置。我们需要在链路上配置trigger，如果trigger出现问题，那么线路
颜色发生相应的变化，这样很容易判断设备的网络状况。
Link indicators 配置
首先需要连接两个设备，在弹出的链路属性上点击edit（如何连接两个map设备，请看上一篇文章），在trigger处
点击”add”，选择用于判断链路状态的trigger，例如我选择的“Zabbix agent on webserver_forttlsa is unreachable for
5 minutes”，一旦zabbix agent连不上，链路颜色将会变成红色。
链路正常图如下
链路异常如下
IT services
什么是 IT Services
服务器或者某项服务、业务的可用率，不懂技术的上级领导会过问最近服务器可用率如何、所有api的状况怎么样？
通常一些技术人员会说负载怎么样，哪些 cpu 使用率怎么样，硬盘使用情况，api 的响应速度都保持在多少、响应
时间都在多少？还没等说完，领导就打断了。他不关心这些细节，更不懂这些技术。他想要的是一个结果。比如说
服务器故障率在0.001，api的响应率在99.99%。这就是IT Services的功能。
IT service结构如下：
IT Service
|
|-Workstations
| |
| |-Workstation1
| |
| |-Workstation2
|
|-Servers
IT Sverices 示例
举个例子，API的SLA，各个子Service都有他的可用率，然后XXX网站API可以统计到整个API的可用率，当领导
过问起来，给他看这个就行了。
IT Service
|
|-XXX网站API
| |
| |-天气API
| |
| |-新闻API
| |
| |-用户API
|
| |-....xxxAPI（省略各种api）
|
|-Servers（其他services）
那这些可用率是怎么计算出来的呢？根据你的触发器，除了未分类和信息这两类，其他严重性级别，例如警告
（warnning）等等都会记入故障率
配置 IT Services
configuration->IT Services->单击root->Add services
创建服务器在线率
service说明
属性 说明
name 名称
Parent service 上级节点，这边是root
Status calculation 计算付费，共有三个选项:
algorithm Do not calculate – 不加入计算
Problem, if at least one child has a problem – 子项至少一个发生故障（一般用这个）
Problem, if all children have problems – 所有子项都发生故障，才加入计算
Acceptable SLA 可接受的可用率百分比，如果在大于这个百分比那么现实绿色，如果小于那么就是红色显示
(in %)
Trigger 触发器，可以选触发器也可以不选，不过大家要记住，可用率计算的就是这些触发器的可用
率，如果没有触发器根本无法计算。最上级的可以不选触发器，子项一定记得选择触发器，
否则就失去意义了。
添加子 service
依赖标签
这边我们不增加依赖，在后面我们专门来谈谈这个依赖
Time这边如果默认，那么就是24×7
Time说明
属性 描述
Service times 定义好的工作时间
New service time 一共有三个选项
Downtime – 在这个时间段，不计入SLA
One-time downtime – 在这个时间段，不计入SLA，指定一个时间（只有一次）
Uptime ：工作时间，在这个时间内出现故障都计入SLA
看看效果，monitoring–>IT services
IT Services 依赖
分为 hard和 soft 依赖，例如我们增加一个 C 服务器，他需要依赖其他 IT 树下的 services，首先它不能链接触
发器，在依赖那边选择其他树下依赖即可，可以添加多个，软依赖是灰色的标识，硬件依赖则是直接把整个service
挪过来。如果 C 服务器使用软依赖，那么可以直接删除 C 服务器 Service，如果是硬依赖，需要先移除依赖，才能
删除。
soft不勾选，表示为硬依赖
如下，原本“测试”和“服务器在线率”在同一个层级，都归属于root，但是加了硬依赖之后，直接到了C服务器
只下了
接着来看看软依赖,勾选soft，就是软依赖了
看下图，和硬依赖很不相同，C服务器下的测试是灰色的，并且“测试”依旧和“服务器在线率”在同一个层次。
此时你可以直接删除C服务器，但是硬依赖的情况下不行哦。zabbix IT SERVICES就到这里了，可以给领导开个权
限，这样他也可以了解到服务器整体状况了。运维们也需要经常看，毕竟这是调整的一个一句。
第九章：WEB 监控
zabbix 监控 web 服务器访问性能
在host列可以看到web(0),在以前的版本这项是独立出来的，这个主要实现zabbix对web性能的监控，通过它可以
了解web站点的可用性以及性能。最终将各项指标绘制到图形中，这样我们可以了解到一个站点的下载速度、响应
速度等。需要注意的是在安装zabbix server需要增加libcurl的支持。
我们只需要配置后web监控项，那么zabbix server会定时按照你的规则去执行性能监控。特性下，如果配置都差不
多，大家可以先创建模板，然后套用下模板即可
web 检测数据搜集说明
web整个检测中会收集如下数据
 整个web监控规则中的页面平均下载速度，秒为单位
 检测阶段发生的错误次数
 最后一个错误消息
web 检测的任何一个阶段都会收集如下数据
 每秒的下载速度
 响应时间
 响应代码（http code，如200、301等）
zabbix web 监控说明
zabbix可以检测http、https协议，而且zabbix也支持重定向，执行过程中的所有cookies也会被保留。如果需要的
话，zabbix会检索某个页面是否包含特定的字符，如果有表示成功，没有表示失败，例如检测zabbix登陆是否正常，
它会检索响应的html页面中是否包含Admin，如果有表示登陆成功。
zabbix web 数据保存
每次执行完之后的数据都会保存到 zabbix 数据中，这些数据可以用户绘制成图表以及用户 zabbix 触发器和发送报
警通知
zabbix web 监控项 item 详解
一旦我们创建好web监控之后，我们便可以查看web站点的性能状况。zabbix一共给我们提供了6个item key，实
际上就三个，分别针对单个阶段和整个阶段，三个item分别为web.test.in、web.test.fail、web.test.error，下面看看
它的具体用法。
web 方案监控项
当web监控项创建好之后，下面的key会被自动添加好
key 描述
web.test.in[Scenario,,bps] 整个阶段中的下载速度，单位字节/秒
类型: Numeric(float)
web.test.fail[Scenario] 整个检测阶段，失败的阶段个数，如果所有的阶段（step）都成功，那么返回0
类型: Numeric(unsigned)
web.test.error[Scenario] 返回最后一个错误信息（文本）
web 监控项实例
 创建触发器“Web scenario failed”,表达式如下
{host:web.test.fail[Scenario].last(0)}#0
 创建触发器“Web application is slow”,表达式如下
{host:web.test.in[Scenario,,bps].last(0)}3
说明：ZABBIX GUI是web方案的名称，Login为阶段（step）名称
web 监控项数据保留时间
web监控历史数据数据保存30天，趋势数据保存90天，老数据将被清除
zabbix 实战监控 WEB 网站性能
一直在纠结用什么实例来给大家演示呢？想来想去还是官方的好，那我们怎么用zabbix监控web性能和可用性呢？
我们这边分为几个步骤：打开网站、登陆、登陆验证、退出，一共4个小step，看实例。
检测流程
1) 打开网站：如果http code为200，并且响应的html中包含Zabbix SIA表示打开成功（zabbix页面有这个标示）
2) 登陆后台：post 用户名和密码到 index.php，如果响应 200，那表示 post 成功。并且通过正则表达式从响应的
html中匹配sid，这个sid也就是一个宏变量，退出可以使用到
3) 验证登陆：打开首页，检索html中是否包含Profile（只有登陆成功，才会有Profile出现）
4) 退出账号：传递参数sid给index.php即可退出，响应200即表示退出成功。
我们可以使用上节讲到的item key来获取每个step的速度以及响应时间或者说最新的一个错误消息，大家自己去研
究吧，不难
创建 WEB 场景
configuration->Host->你的主机->web->右上角Create scenario
属性表
属性 描述
Name 监控项的名称
Application 放到哪个应用中，《什么是Application》
Authentication 是否有http的基本认证，大部分情况下是None，难不成用户进来还需要经过一次认证？
Update interval 更新周期，默认60秒,多久跑一次
Retries 重试次数
Agent 模拟浏览器
HTTP proxy 代理，如果你的站点有多台服务器，那么请写上你目标服务器ip和端口，例如http://10.9.0.2:80,
默认端口可不是80，别忘记80了
Variables 宏变量，后面会用到。想了解请点《zabbix用户宏macro》
web监控阶段1：打开首页
对step做一个说明：
属性 说明
name 当前step名称，item key中可以用到
url 需要检测的网址
POST 你需要 post 提交上去的内容，例如 user=123&password=123456,，或者使用宏变量
user={user}&password={password}，如果支持GET，那么可以直接写到URL里面
variables 变量，这边定义宏变量后续的step可以使用
Timeout 超时时间，默认15秒
Required string 响应的内容中必须包含的字符串，否则失败
Required status 响应代码必须包含在里面，多个响应代码用逗号分隔，例如200,301,302
codes
web监控阶段2：登陆
post账号和密码上去，关于post在前面已经提过了。
WEB监控阶段3：验证登陆
WEB监控阶段4：退出账号
WEB网站检测配置完成，记得保存
查看结果
monitorning->web->筛选出你的主机->查看“WEB性能监控_FOR_TTLSA”，结果如下图，各个阶段的响应时间、速
度、返回状态码以及总的响应时间
下图是下载速度的图表，包含各个阶段
下图是响应时间的图表