• Legitimate company doesn’t normally take CC orders and isn’t 
aware of this (identity theft for companies)
• Make many small transactions at just under the floor limit 
using stolen cards
• Forward the funds to accounts controlled by the crime ring
The Carding Business (ctd)
Less obvious: Use online auctions for money laundering 
(triangulation)
• Advertise new $1000 digital camera on ebay for $800
• Buy with stolen card, get sent to ebay buyer
• Collect $800 cash
Use bot-driven cliques to defeat trust rating systems
• Set up multiple accounts
• Sell zero-value items (e.g. background GIFs for web pages) for 
1 cent each
• Provide positive feedback for each sale
• 100 positive feedbacks for $1
– Like business goodwill, trust can be monetised
The Carding Business (ctd)
Everything can be monetised
Obvious accounts: Banks, PayPal, …
Less obvious accounts: Stock brokerage accounts
• Dump the existing portfolio
• Buy microcap stocks to drive up prices in pump-and-dump
– Cuts out the need to pump the stock
The Carding Business (ctd)
No accounts at all: Botnets used for click fraud
• Advertisers like clicks, they get feedback on effectiveness
– Researchers estimate that 10-15% of clicks are fraudulent, 
representing ~$1B in billings
• Google and others boost revenue by recycling ads to other sites
– Example: Domain parkers fill parked domains with ads
• PTC/PTR (pay-to-click/pay-to-read) rings or clickbots fill the 
sites with clicks
• Handled via brokers like adspacedepot.com, 
clicksmania.net, clixmedia.biz, 
paid4clixonline.com, puppiesptr.com
– c.f. Terry Pratchett’s fire-fighting economy in Ankh-
Morpork
The Carding Business (ctd)
In 2006 the US government passed its Money Laundering 
Enabling Act
• Amendment to the Safe Port Act bans financial transactions to 
gambling sites
– Gambling continues, but now it’s via illegitimate channels
• All gamblers become money launderers
• Vastly increases the noise level of money laundering
– Fraud-related laundering hides in the noise
Spam Technical Mechanisms
Bulletproof hosting
Spam hosting from $20 per month, fraud hosting from $30 per 
month
— carderportal.org
Significant numbers of spam servers are located in China
• Highly advanced telecom infrastructure
• Cheaper bandwidth than in the West
• China has 30 – 50,000 Internet police in 700 cities…
… who carefully investigate dangerous threats like pro-
democracy web pages
Bullet-Proof server:
Fresh IPs
1024MB RAM
P4 CPU
72GB SCSI
Dedicated 100M fiber
Unlimited Data Transfer
Any software
Based China
US$599.00 monthly
May use the server for:
Bulk web Host
Direct Mailing
We also supply e-mail list according to your order and sending out 
your message for you.
Hope to service for you.
Spam Technical Mechanisms (ctd)
Spam Technical Mechanisms (ctd)
One experiment in blocking IP addresses originating 
worm/virus attacks ended up blocking
• China Anhui Province Network
• China Beijing Province Network
• China Fujian Province Network
• China Guangdong Province Network
• China Hangzhou Node Network
• China Hubei Province Network
• China Jiangmen Broadband Network
• China United Telecommunications Corporation, Beijing
• Oriental Cable Network Co, Shanghai
• Shanghai sichuan[…]gonsi Co.Ltd.
Spam Technical Mechanisms (ctd)
Spammers can do whatever they want
They simply don’t want to know — China Telecom doesn’t 
care because they’re government-owned, and there is no 
pressure coming from the government
— Steve Linford, Spamhaus
Spam Technical Mechanisms (ctd)
Use BGP route injection/AS hijacking to steal an IP block
• Break into a poorly-secured router
– NANOG 28 (June’03) ISP security BOF: 5,400 
compromised routers
• Send a BGP route update announcing that your router is now 
responsible for some currently-unused block of IP addresses
– In 5-10 minutes the entire Internet will know
– This is all the time you need
• Spam like crazy from each IP address in the block until you get 
blacklisted
Spam Technical Mechanisms (ctd)
Advertise a huge netblock, e.g. a /8
• More specific prefixes advertised in the space, e.g. a /24, won’t 
be affected (more specific takes precedence)
• Attacker gets the remaining space (unallocated, or allocated but
unused)
Advertise a legitimate netblock (someone else’s)
• Routers who don’t know or care will believe it
• Easy to spot, payoff is low, but then the cost is also low
Works because routers/AS’s are assumed to be trustworthy
• S-BGP (secure BGP) is high-overhead and little-used
• Only major peering points use it
Spam Technical Mechanisms (ctd)
Spammers routinely break into legitimate users’ PCs to 
send spam
“I don’t bother securing my [games] PC, because I doubt 
spammers are interested in my savegames”
“They’re not after your games, they’re after your network 
connection”
— slashdot
• Largest observed single bot-net had 11,000 members
• In late ’04 these were growing at 30,000 machines per day
• Peak rate was 75,000 per day during the MyDoom/Bagle virus 
group wars
Spam Technical Mechanisms (ctd)
Cost of a compromised system
• Cisco router: US$5
• Unix box: US$1-5
– Can easily turn a Unix box into a router using built-in tools
• Windows box: Too cheap to meter
Email security firm MessageLabs reports that
• Two thirds of the spam it blocks is from infected PCs
• Much of the spam comes from ADSL/cable modem IP pools
• Distributed Server Boycott list reports 350,000 compromised 
hosts on the US RoadRunner network alone
We have met the enemy and he is us…
Spam Technical Mechanisms (ctd)
IRC-based botnet
• IRC links may be encrypted (SSL)
• Communications may be over covert channels
– DNS TXT records
– HTTP
IRC
server
Bot
Controller
Bot
Bot
Bot
Bot
Spam Technical Mechanisms (ctd)
DSNX is an advanced, open source, modular, non-interactive IRC 
client (An irc robot). It provides the subsystem for a versatile 
internet technology deployment across multiple systems. Through 
the patented DSNX technology dataspy dot net INC can provide 
your fortune 500 company with the ultimate solution
— DataSpy Network X promotion
Spam Technical Mechanisms (ctd)
P2P-based botnet
• More damage-resistant than centralised IRC control
Evolution follows that of file-sharing networks
• Centralised IRC-based system allows direct control, but 
provides a single point of failure  mitigate via IRC bouncers
• Mitigate even further via completely decentralised control
Bot
Bot
Bot
Bot
Bot
Bot
Bot
Controller
Example: Agobot
Source code is freely available
• Well-written C++ implementation
• Cross-platform
• Modular design
• Easy to add new capabilities
• GPLd
Exists in many variants
• Agobot, Phatbot, Forbot, Gaobot, Xtrmbot, Polybot, …
– Hundreds of variants (depending on how you count them)
• Originally used IRC
• Some variants use P2P control, e.g. WASTE,
waste.sourceforge.net
Example: Agobot (ctd)
General capabilities
• Packet sniffing via libpcap
• Windows rootkit capabilities
• Detect debuggers and VMs
• Encrypt config data
• Disable anti-virus/firewall software
• Modify hosts file, e.g. to prevent access to antivirus sites
Example: Agobot (ctd)
Typical Agobot commands
harvest.emails
Harvest email addresses
spam.setlist
Download pre-harvested address list
spam.settemptate
Download email message template
spam.start
Start spamming
spam.stop
Stop spamming
Other commands
.keylog on
Start keylogger
.getcdkeys
Get registration keys for commercial
software
.sysinfo
Report system capabilities
.netinfo
Report network connection capabilities
Example: Agobot (ctd)
Many additional commands are available
• Macro forms of spam commands to perform the above with a 
single command
• Display spoofed pages via browser help objects (BHO’s)
• Web page redirection
• Spyware propagation
• Steal CD keys/registration codes for commercial software from 
the registry
– Includes a database of registry locations for common 
commercial software
• Search the hard drive for sensitive files, e.g. *.xls, *finance*
Example: Agobot (ctd)
Agobot variants added further commands, e.g. Gaobot
bot.unsecure
Enable shares, DCOM
ddos.type
Start assorted DDoS attacks
http.visit
Visit a web site
http.execute
Update from remote site
inst.asadd
Add an autostart entry
inst.svcadd
Add a service
pctrl.kill
Kill process
• Some are extensions of existing Agobot commands
Example: Spybot
Same pattern as Agobot, but oriented more towards 
spying/system manipulation
cachedpasswords
Retrieve passwords via
WNetEnumCachedPasswords
get file
Retrieve file
killprocess name
Kill a process (e.g. antivirus)
passwords
Retrieve RAS passwords
startkeylogger
Start keylogger
sendkeys keys
Simulate keypresses on PC keyboard
Spamware Functions
Worms install spamware
• Send-Safe.com and Direct Mail Sender (DMS) via SoBig, the 
first commercial spam virus
• Affects 80-100,000 new PCs a week
• Software hosted by MCI Worldcom (pink contract)
Act as an SMTP proxy to intercept outgoing mail (Taripox)
Run a SOCKS proxy for spammers (numerous)
Email address harvesting (several)
DDoS on spam-blockers (numerous)
• DDoS other botnets
• Much DDoS traffic is actually botnet internecine warfare
Spamware Functions (ctd)
Worms act as special-purpose spam relays (e.g. Hogle, 
MyDoom, many others)
• MyDoom infected ca. 1,000,000 PCs (F-Secure)
• Infected PCs (“fresh proxies”) are traded in spammer forums
• Spamware sends either direct from end-user PCs or routed via 
an ISP’s mail servers
– Spam comes from legitimate users or legitimate ISPs
Worm patches itself into WSOCK32.DLL (Happy99 etc)
• Intercepts the connect() and send() functions
• Checks for connections to the SMTP port
• Modifies outgoing mail as it’s sent 
• Transparently converts legitimate mail into spam
Spamware Functions (ctd)
Perpetrate click fraud on pay-per-click ads
• Botnet of 10K hosts each visit a pay-per-click site
• Site records visits from 10K unique IP addresses and pays for 
each click
Worms act as reverse HTTP proxies
• Provide a distributed fault-tolerant “web site” for spammers
• Migmaf changed the “site” every 10 minutes
– c.f. email spam frequency-hopping
Spamware Functions (ctd)
Disable anti-virus/firewall software (ProcKill, Klez, Bagle-
BK, many others)
• At one point it was possible to scan for viruses via the 
standardised code that they used to disable MSAV
Bypass firewall software
• Walk the NDIS.SYS memory image or data structures and 
patch yourself in beneath the firewall hooks
– Page in your own NDIS.SYS image from disk to avoid 
touching the live one
• Many, many variations used by different rootkits, e.g. 
FireWalk
Spamware Functions (ctd)
Modify anti-virus database files to remove detection of the 
malware (IDEA, AntiAVP)
• Alternatively, delete anti-virus database files
Block access to anti-virus vendor sites (MTX, Mydoom)
Modify anti-virus software to propagate the virus 
(Varicella)
Other Malware Functions (ctd)
Re-enable unsafe defaults in software, e.g. MS Office 
(Listi/Kallisti)
Lower browser’s security settings to unblock pop-up ads 
(Mytob)
• Mytob author Diabl0 was paid per pop-up delivered
Run multiple instances/threads that resurrect each other if 
one is killed (“resuscitators”) (Semisoft, Chiton, 
Lovegate)
Use error-correcting codes to repair the virus body if any 
portion is patched out (RDA Fighter)
Other Malware Functions (ctd)
Infect through CRC32-checksummed files (HybrisF)
• CRC32 isn’t a cryptographic checksum mechanism
• Can modify the file without affecting its CRC32 value
Install rogue CA root certificates (Marketscore)
• Because of the browser certificate trust model, Marketscore
can usurp any SSL site
Disable user rights verification by patching the kernel 
(Bolzano, FunLove)
• Two-byte patch to SeAccessCheck() in ntoskrnl.exe
Add registry entries to make an ActiveX control appear 
“safe” and digitally signed (Grew)
Other Malware Functions (ctd)
Engage users in IM chat sessions inviting them to 
download malware (IM.Myspace04.AIM)
• The worm will tell users that it’s not malware if asked
• The typical AOL “lol d00d check this out” is hardly a Turing-
test level challenge
Rewrites user-created Yahoo IM or MIRC messages to 
propagate itself (Browsesafe)
Injects itself into existing AIM, Google Talk, and Yahoo 
IM sessions (Peacomm)
Other Malware Functions (ctd)
Steal CD keys/registration codes for commercial software 
(Agobot)
• Windows .PWL files (Dumaru)
• PGP secret keyrings (Caligula)
• CuteFTP password files (Melissa)
• UBS account and PIN files (LoveLetter)
• …
Hooks into the Javascript engine to grab AJAX-based 
authentication data (Gozi)
• After FFIEC required US banks to use two-factor auth, they 
redefined “two-factor” to mean “twice as much one-factor”
• “Hey, it uses AJAX, now it’s secure!”
Other Malware Functions (ctd)
Register as a Winsock LSP to bypass SSL (Gozi)
• Bypasses SSL encryption in MSIE and other Windows apps 
(but not ones with built-in SSL) 
• Blah blah monoculture blah blah
Gozi main
MSIE
Gozi LSP
Gozi server
Winsock SSL
Bank
HTTP data
SSL data
Match     can see
through SSL
Other Malware Functions (ctd)
Prevent anti-virus/malware removal programs from 
running 
• Remove registry keys
• Block apps from starting
– Register kernel-level load image notification callback via 
PsSetLoadImageNotifyRoutine(), prevent known 
images from loading
• Close windows with titles containing phrases like “virus” and 
“remove”
• …
Other Malware Functions (ctd)
Registers itself as a critical system process so it always gets 
loaded, even in Safe Mode (CoolWebSearch, HuntBar, 
VX2)
Worms attach themselves to Winlogon using the Winlogon
notify function
• Winlogon always runs, and starts before anything else
• Malware can intercept any attempts to remove it at boot time
Steal client keys and certificates and other secrets from 
Windows Protected Storage (Gozi)
Example: Glieder trojan
Phase 1, multiple fast-deploying variants sneak past AV 
software before virus signatures can be propagated
• Disable Windows XP Firewall and Security Center
Phase 2, connects to a list of URLs to download Fantibag
malware