title:An End-to-End, Large-Scale Measurement of DNS-over-Encryption: How
Far Have We Come?
author:Chaoyi Lu and
Baojun Liu and
Zhou Li and
Shuang Hao and
Hai-Xin Duan and
Mingming Zhang and
Chunying Leng and
Ying Liu and
Zaifeng Zhang and
Jianping Wu
An End-to-End, Large-Scale Measurement of
DNS-over-Encryption: How Far Have We Come?
Chaoyi Lu1,2, Baojun Liu3, Zhou Li4, Shuang Hao5, Haixin Duan1,2,6,
Mingming Zhang1, Chunying Leng1, Ying Liu1, Zaifeng Zhang7 and Jianping Wu1
1Institute for Network Sciences and Cyberspace, Tsinghua University
2Beijing National Research Center for Information Science and Technology (BNRist), Tsinghua University
3Department of Computer Science and Technology, Tsinghua University 4University of California, Irvine
5University of Texas at Dallas 6Qi An Xin Technology Research Institute 7360 Netlab
ABSTRACT
DNS packets are designed to travel in unencrypted form through
the Internet based on its initial standard. Recent discoveries show
that real-world adversaries are actively exploiting this design vul-
nerability to compromise Internet users’ security and privacy. To
mitigate such threats, several protocols have been proposed to en-
crypt DNS queries between DNS clients and servers, which we
jointly term as DNS-over-Encryption. While some proposals have
been standardized and are gaining strong support from the industry,
little has been done to understand their status from the view of
global users.
This paper performs by far the first end-to-end and large-scale
analysis on DNS-over-Encryption. By collecting data from Internet
scanning, user-end measurement and passive monitoring logs, we
have gained several unique insights. In general, the service quality
of DNS-over-Encryption is satisfying, in terms of accessibility and
latency. For DNS clients, DNS-over-Encryption queries are less
likely to be disrupted by in-path interception compared to tradi-
tional DNS, and the extra overhead is tolerable. However, we also
discover several issues regarding how the services are operated.
As an example, we find 25% DNS-over-TLS service providers use
invalid SSL certificates. Compared to traditional DNS, DNS-over-
Encryption is used by far fewer users but we have witnessed a
growing trend. As such, we believe the community should push
broader adoption of DNS-over-Encryption and we also suggest the
service providers carefully review their implementations.
CCS CONCEPTS
• Networks → Application layer protocols; Network mea-
surement; Naming and addressing.
Haixin Duan and Ying Liu are the corresponding authors.
This work is done during Chaoyi Lu’s research internship at 360 Netlab.
Permission to make digital or hard copies of all or part of this work for personal or
classroom use is granted without fee provided that copies are not made or distributed
for profit or commercial advantage and that copies bear this notice and the full citation
on the first page. Copyrights for components of this work owned by others than the
author(s) must be honored. Abstracting with credit is permitted. To copy otherwise, or
republish, to post on servers or to redistribute to lists, requires prior specific permission
and/or a fee. Request permissions from permissions@acm.org.
IMC ’19, October 21–23, 2019, Amsterdam, Netherlands
© 2019 Copyright held by the owner/author(s). Publication rights licensed to ACM.
ACM ISBN 978-1-4503-6948-0/19/10...$15.00
https://doi.org/10.1145/3355369.3355580
KEYWORDS
Domane Name System, DNS Privacy, DNS-over-TLS, DNS-over-
HTTPS, DNS Measurement
ACM Reference Format:
Chaoyi Lu1,2, Baojun Liu3, Zhou Li4, Shuang Hao5, Haixin Duan1,2,6,
Mingming Zhang1, Chunying Leng1, Ying Liu1, Zaifeng Zhang7 and Jian-
ping Wu1. 2019. An End-to-End, Large-Scale Measurement of DNS-over-
Encryption: How Far Have We Come?. In Internet Measurement Conference
(IMC ’19), October 21–23, 2019, Amsterdam, Netherlands. ACM, New York,
NY, USA, 14 pages. https://doi.org/10.1145/3355369.3355580
1 INTRODUCTION
Domain Name System (DNS) is one of the fundamental building
blocks of the Internet, mapping a user-friendly domain name to
numerical IP addresses. According to its initial IETF standard, DNS
packets are transmitted over UDP protocol in clear-text. Therefore,
communication integrity and confidentiality are absent. Unfor-
tunately, this design makes DNS communications vulnerable to
attacks like eavesdropping and tampering [29]. In fact, real-world
adversaries have been exploiting DNS to harm Internet users. As
an example, released secret documents show that NSA has been
covertly monitoring and hijacking DNS traffic, under the MoreCow-
Bell [44] and QuantumDNS [12] projects. A recent study also shows
that network middleboxes are actively intercepting DNS packets
and rerouting them to alternative resolvers [60].
One of the mainstream approaches to mitigating such threat is
to encrypt DNS communications. To this end, various techniques
are proposed, including DNS-over-TLS (DoT), DNS-over-HTTPS
(DoH), DNS-over-QUIC and DNSCrypt. In this paper, we jointly
term them as DNS-over-Encryption (DoE). Although most of the
protocols have only been established for a few years, some have
been gaining strong support from large DNS service providers [2,
4, 14], OS [24, 56] and software [6, 38, 63].
However, despite the “top-down” effort made by the industry,
little has been done to understand the operational status of DNS-
over-Encryption from the “bottom-up” view, or from the view of
Internet users. In this paper, we aim to give a comprehensive and
end-to-end review of DNS-over-Encryption, which we believe will
provide good guidance in pushing the adoption and improving
the ecosystem of DNS-over-Encryption in the future. The research
questions we seek to answer include: 1) How many providers are
offering DNS-over-Encryption services? Are their implementations
secure? 2) What does their performance look like for users dis-
tributed globally? Is there any issue preventing access or causing
IMC ’19, October 21–23, 2019, Amsterdam, Netherlands
Chaoyi Lu et al.
errors? 3) What does the real-world usage of DNS-over-Encryption
look like?
Our Study. So far, DNS-over-TLS (DoT) and DNS-over-HTTPS
(DoH) are two standardized and extensively supported protocols to
secure the traditional DNS, and our study focuses on measuring
the two protocols. First, we perform a comparative study on the
DNS-over-Encryption protocols to outline their strengths and weak-
nesses (Section 2). Second, we launch Internet-wide scanning to
discover DNS-over-Encryption service providers and analyze their
security issues (Section 3). Third, we assess the accessibility and
performance of DNS-over-Encryption services by recruiting geo-
graphically distributed vantage points (Section 4). Getting access
to real-world DNS-over-Encryption traffic from massive vantage
points without violating participants’ privacy is challenging. We
address this challenge by running controlled experiments on a care-
fully designed Internet measurement platform. Finally, we compare
the traffic volume between traditional DNS requests and DNS-over-
Encryption requests using several large-scale datasets, including
passive DNS datasets and 18-month NetFlow data from a large ISP
(Section 5).
Findings. So far, we have obtained some unique discoveries about
the deployment of DNS-over-Encryption. On one hand, the service
quality of DNS-over-Encryption providers is satisfying in general,
suggesting the industry is prepared for large-scale real-world usage.
On the other hand, we also spot misconfigurations on some services,
and more efforts should be made to push its correct adoption. Below,
we highlight the key findings.
● We discover over 150 DoT and 17 DoH providers that offer DNS-
over-Encryption services to client users with over 1.5K addresses.
Interestingly, a lot of them do not show up in public resolver
lists. However, 25% DoT providers, including large ones (Perfect
Privacy), use invalid SSL certificates which could break the server
authentication process. Particularly, TLS inspection devices are
found to act as DoT proxies. In addition, we find that Quad9
DoH has a misconfiguration which causes DNS lookup errors.
We have reported the issue to the provider.
● Compared to traditional DNS, the reachability to DNS-over-
Encryption servers turns to be better, with only less than 1%
global clients experiencing service disruption. But still, there
are DNS-over-Encryption services disrupted by censorship (e.g.,
Google DoH blocked in China) and TLS interception, which di-
minishes the benefits brought by encrypting DNS queries.
● The extra overhead incurred by DNS-over-Encryption is toler-
● The traffic volume and active users of encrypted DNS are still at
able to global users. On average, compared to traditional DNS,
transmitting encrypted DNS queries brings several milliseconds
of extra query latency.
a small scale compared to traditional DNS. However, the usage
of DNS-over-Encryption services has been growing in recent
months. For example, Cloudflare DoT witnesses a 56% traffic
increase from Jul 2018 to Dec 2018.
The “Early” View of Ecosystem. This paper presents the first
systematic and large-scale study on the ecosystem of DNS-over-
Encryption since its proposal. One may think the ecosystem is
small, because major users still choose clear-text DNS, and the
measurement study is yet too early. We agree the study is an early
view in terms of user base, but on the other hand, the first DNS-
over-Encryption protocol has been established for around 10 years,
and many resolvers including Google and Cloudflare have started
to run DNS-over-Encryption services. We believe it is necessary
to understand the gap between the deployment and user adoption,
and identify success and pitfalls of different protocols. Such effort
can help the community to adjust the roadmap for the better future
of DNS-over-Encryption. To this end, we also publish our collected
data and results to help further studies, and will continue to monitor
the ecosystem.
Contributions. The contributions of this paper are outlined as
follows.
the first comparative study on five DNS-over-Encryption proto-
cols, which sheds light on the development of the ecosystem.
● Comparative study. Using 10 criteria under 5 categories, we present
● Methodology. Combining a suite of techniques, we design and
● Observations. Leveraging several large-scale datasets, we investi-
● Dataset release. We are continuously collecting data and measur-
deploy a large-scale measurement platform with 122,991 vantage
points in 166 countries, to understand the client-side usability of
DNS-over-Encryption services. Meanwhile, we launch Internet-
wide scanning to discover new service providers.
gate the current deployment and usage of DNS-over-Encryption.
With multi-faceted insights, we provide concrete recommenda-
tions to the DNS community.
ing the development of DNS-over-Encryption. We release our
datasets for public use at https://dnsencryption.info.
2 BACKGROUND
In this section, we first describe the privacy considerations regard-
ing DNS. We then elaborate and perform a comparative study on
current protocols to encrypt DNS communications.
2.1 DNS Privacy Considerations
DNS precedes almost all Internet activities: email senders look up
recipients’ server addresses; patients query hospital domain names;
devices use DNS to discover each other. By design, DNS packets
are sent in clear-text, which makes it vulnerable to both passive
(e.g., on-path eavesdroppers) and active attackers (e.g., rogue DNS
servers).
The unencrypted design of DNS exposes Internet users to privacy
threats. It has been known that DNS traffic can be used to fingerprint
client machines and analyze user behavior [32, 48, 54, 55]. Previous
works have also shown that client machines can be tracked across
the Internet, by simply analyzing passive DNS data [52]. What’s
worse, documents reveal that massive DNS surveillance does exist
on the Internet, such as NSA’s QuantumDNS and MoreCowBell
projects [12, 44]. In short, unprotected DNS traffic can introduce
significant privacy risks to Internet users.
2.2 DNS-over-Encryption Protocols
Driven by the concerns, the community has been devoting signifi-
cant efforts to mitigating DNS privacy issues. Shown in Figure 1,
the earliest proposal to protect DNS communications dates back
to 2009. Since 2014, IETF have established two Working Groups,
and various protocols have been proposed to secure traditional
An End-to-End, Large-Scale Measurement of DNS-over-Encryption: How Far Have We Come?
IMC ’19, October 21–23, 2019, Amsterdam, Netherlands
Figure 1: Timeline of important DNS privacy events, including DNS-over-Encryption standards (blue), IETF WGs (orange),
Informational RFC and Best Common Practice (purple).
DNS. Meanwhile, the techniques have gained support from large
industrial providers including Mozilla [62] and Google [4]. In fact,
it would be unsurprising that clear-text DNS will be replaced by the
secured format in the near future, similar to HTTPS being mandated
when visiting high-profile websites (e.g., banking site).
Adding confidentiality and authentication properties to the DNS
protocol is an effective approach to addressing DNS privacy threats.
In this work, we focus on techniques that are dedicated to securing
the stub-to-recursive link of DNS resolutions, as it’s the primary
focus of the community and most proposals [45, 49, 50]. Below we
give an overview and perform a comparative study on different
DNS-over-Encryption protocols.
Evaluation Criteria. We consider 10 criteria under 5 categories
to evaluate different DNS-over-Encryption protocols.
tional DNS or switches to a different application-layer protocol; 2)
whether it provides a fallback option when certain cryptographic
operations cannot be applied (i.e., back to non-authenticated or
clear-text connections).
● Protocol Design: 1) whether the new protocol is based on tradi-
● Security: 1) whether the protocol is based on standard crypto-
● Usability: 1) changes that client users need to make before us-
graphic protocols (e.g., TLS); 2) whether it can defend against
on-path passive DNS traffic analysis (or at least offers options
against it).
ing the protocol: no extra software needed (low), extra software
installation or configuration needed (medium), or no support-
ing software yet (high); 2) whether the protocol incurs query
overhead over traditional DNS-over-UDP (e.g., by using TCP or
requiring TLS handshake) or provides options to amortize it.
● Deployability. 1) whether the protocol is designed over standard-
● Maturity. 1) whether the protocol is currently standardized by
ized and well-supported protocols; 2) whether it is supported by
mainstream DNS software (e.g., BIND [34], Knot Resolver [6]
and Unbound [21], see Appendix A).
IETF; 2) whether it is extensively supported by DNS service
providers (e.g., large public DNS resolvers, see Appendix A).
Currently, 5 major DNS-over-Encryption protocols are proposed
to secure the stub-to-recursive link, including DNS-over-TLS (DoT),
DNS-over-HTTPS (DoH), DNS-over-DTLS, DNS-over-QUIC and
DNSCrypt. Using the criteria above, we present their evaluation in
Table 1. Each protocol is categorized under “satisfying” (denoted
as(cid:32)), “partially satisfying” (denoted as(cid:71)(cid:35)), or “not satisfying” one
criterion (denoted as(cid:35)). Below we elaborate each protocol in detail.
DNS-over-TLS (DoT). DoT is standardized by RFC7858 [49] in
2016, and its concept is straightforward: clients and servers negoti-
ate a Transport Layer Security (TLS) session before DNS lookups,
and use it to wrap wire-format DNS queries transported through
TCP. As a result, clients and recursive resolvers can exchange en-
crypted DNS messages (preventing passive monitoring), and re-
solvers can be authenticated by verifying SSL certificates (prevent-
ing man-in-the-middle attackers). By default, DoT uses port 853
for communication. The use of a dedicated port could make DoT
requests distinguishable from other traffic, but padding options
(e.g., EDNS(0) padding [61]) can be leveraged to reduce adversaries’
capability of traffic analysis.
To provide different levels of security and privacy protections,
DoT is designed with two usage profiles (i.e., Strict Privacy profile
and Opportunistic Privacy profile) for DNS clients [69], and provides
fallback mechanisms. Under the Strict Privacy profile, a DNS client
is required to both authenticate the DoT server and encrypt trans-
actions. If either requirement is not available, the DoT query will
fail. By contrast, clients using an Opportunistic Privacy profile only
attempt for best protection, and may fallback to a non-authenticated
connection or even clear-text connection.
Regarding implementation, as shown in Appendix A, DoT has
been extensively supported by OS (e.g., Android 9 [56]), DNS soft-
ware (e.g., Unbound [21] and Stubby [38]), and large public DNS
resolvers (e.g., Cloudflare [2], Google [4] and Quad9 [14]). For ser-
vice providers, current implementations reduce the cost to operate a
DoT resolver, and SSL certificates are easy to install with automated
CAs like Let’s Encrypt [8]. However, before a client uses DoT, extra