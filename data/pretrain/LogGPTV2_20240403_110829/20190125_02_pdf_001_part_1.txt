E6636BC20180234D78A0072836F0BE9042B9B20C10C36BB0A3D98931B1362BBC8B48B63811510B0922992408384685EB1D19217AC1D04B911BBFC2547F2E1FD1241D09ADF12484E784902E776A274792263CE53673BDD3EE08D8319F30A6DC28DAE6249B0E3
D A T 4 0 2
Using Performance Insights to
Optimize Database Performance
Kyle Hailey
Principal Product Manager
Amazon RDS
© 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.
E6636BC20180234D78A0072836F0BE9042B9B20C10C36BB0A3D98931B1362BBC8B48B63811510B0922992408384685EB1D19217AC1D04B911BBFC2547F2E1FD1241D09ADF12484E784902E776A274792263CE53673BDD3EE08D8319F30A6DC28DAE6249B0E3
Agenda
What is Performance Insights?
Sampling
Average active sessions (AAS)
Bottleneck analysis
Exploring Performance Insights
© 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.
E6636BC20180234D78A0072836F0BE9042B9B20C10C36BB0A3D98931B1362BBC8B48B63811510B0922992408384685EB1D19217AC1D04B911BBFC2547F2E1FD1241D09ADF12484E784902E776A274792263CE53673BDD3EE08D8319F30A6DC28DAE6249B0E3
© 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.
E6636BC20180234D78A0072836F0BE9042B9B20C10C36BB0A3D98931B1362BBC8B48B63811510B0922992408384685EB1D19217AC1D04B911BBFC2547F2E1FD1241D09ADF12484E784902E776A274792263CE53673BDD3EE08D8319F30A6DC28DAE6249B0E3
What is Amazon RDS Performance Insights?
Customers asked for
• Visibility into performance of Amazon Relational Database Service
(Amazon RDS) databases
• Want to optimize cloud database workloads
• Easy tool
• Often only part-time DBA or no DBA
• Single pane of glass
© 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.
E6636BC20180234D78A0072836F0BE9042B9B20C10C36BB0A3D98931B1362BBC8B48B63811510B0922992408384685EB1D19217AC1D04B911BBFC2547F2E1FD1241D09ADF12484E784902E776A274792263CE53673BDD3EE08D8319F30A6DC28DAE6249B0E3
First step: Amazon RDS Enhanced Monitoring
• Released 2016
• OS metrics
• Process/Thread list
• Up to 1 second granularity
© 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.
E6636BC20180234D78A0072836F0BE9042B9B20C10C36BB0A3D98931B1362BBC8B48B63811510B0922992408384685EB1D19217AC1D04B911BBFC2547F2E1FD1241D09ADF12484E784902E776A274792263CE53673BDD3EE08D8319F30A6DC28DAE6249B0E3
Introducing: Performance Insights
• Dashboard
• DB load
• Adjustable timeframe
• Filterable by attribute (SQL, User, Host, Wait)
• SQL causing load
• Phased Amazon RDS delivery
• Amazon Aurora, Amazon RDS for MySQL, PostgreSQL, Oracle, SQL Server, MariaDB
• Guided discovery of performance problems
• For both beginners & experts
• Core metric “database load”
© 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.
E6636BC20180234D78A0072836F0BE9042B9B20C10C36BB0A3D98931B1362BBC8B48B63811510B0922992408384685EB1D19217AC1D04B911BBFC2547F2E1FD1241D09ADF12484E784902E776A274792263CE53673BDD3EE08D8319F30A6DC28DAE6249B0E3
What is “database load”?
• All engines have a connections list showing
• Active
• Idle
• We sample every second
• For each active session, collect
• SQL
• State: CPU, I/O, lock, commit log wait, and more
• Host
• User
• Expose as “average active sessions” (AAS)
© 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.
E6636BC20180234D78A0072836F0BE9042B9B20C10C36BB0A3D98931B1362BBC8B48B63811510B0922992408384685EB1D19217AC1D04B911BBFC2547F2E1FD1241D09ADF12484E784902E776A274792263CE53673BDD3EE08D8319F30A6DC28DAE6249B0E3
Performance Insights dashboard
© 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.
E6636BC20180234D78A0072836F0BE9042B9B20C10C36BB0A3D98931B1362BBC8B48B63811510B0922992408384685EB1D19217AC1D04B911BBFC2547F2E1FD1241D09ADF12484E784902E776A274792263CE53673BDD3EE08D8319F30A6DC28DAE6249B0E3
© 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.
E6636BC20180234D78A0072836F0BE9042B9B20C10C36BB0A3D98931B1362BBC8B48B63811510B0922992408384685EB1D19217AC1D04B911BBFC2547F2E1FD1241D09ADF12484E784902E776A274792263CE53673BDD3EE08D8319F30A6DC28DAE6249B0E3
Sampling is like film
© 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.
E6636BC20180234D78A0072836F0BE9042B9B20C10C36BB0A3D98931B1362BBC8B48B63811510B0922992408384685EB1D19217AC1D04B911BBFC2547F2E1FD1241D09ADF12484E784902E776A274792263CE53673BDD3EE08D8319F30A6DC28DAE6249B0E3
Sampling every second
Time
User 1
User 2
User 3
Fast query run rarely
Query run often
Slow query
© 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.
E6636BC20180234D78A0072836F0BE9042B9B20C10C36BB0A3D98931B1362BBC8B48B63811510B0922992408384685EB1D19217AC1D04B911BBFC2547F2E1FD1241D09ADF12484E784902E776A274792263CE53673BDD3EE08D8319F30A6DC28DAE6249B0E3
Active session state
Time
idle Query 1 idle Query 2 idle Query 3 idle
© 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.
E6636BC20180234D78A0072836F0BE9042B9B20C10C36BB0A3D98931B1362BBC8B48B63811510B0922992408384685EB1D19217AC1D04B911BBFC2547F2E1FD1241D09ADF12484E784902E776A274792263CE53673BDD3EE08D8319F30A6DC28DAE6249B0E3
AAS load graph
User 1
User 2
User 3
User 4
© 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.
E6636BC20180234D78A0072836F0BE9042B9B20C10C36BB0A3D98931B1362BBC8B48B63811510B0922992408384685EB1D19217AC1D04B911BBFC2547F2E1FD1241D09ADF12484E784902E776A274792263CE53673BDD3EE08D8319F30A6DC28DAE6249B0E3
AAS load graph
User 1
User 2
User 3
User 4
=
Active sessions
4
3
2
1
© 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.
E6636BC20180234D78A0072836F0BE9042B9B20C10C36BB0A3D98931B1362BBC8B48B63811510B0922992408384685EB1D19217AC1D04B911BBFC2547F2E1FD1241D09ADF12484E784902E776A274792263CE53673BDD3EE08D8319F30A6DC28DAE6249B0E3
Active session
Time
1 2 3 4 5 6 7 8 9 10
User 1
Active sessions
4
3
2
1
© 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.
E6636BC20180234D78A0072836F0BE9042B9B20C10C36BB0A3D98931B1362BBC8B48B63811510B0922992408384685EB1D19217AC1D04B911BBFC2547F2E1FD1241D09ADF12484E784902E776A274792263CE53673BDD3EE08D8319F30A6DC28DAE6249B0E3
Active session
Time
1 2 3 4 5 6 7 8 9 10
User 2
User 1
Active sessions
4
3
2
1
© 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.
E6636BC20180234D78A0072836F0BE9042B9B20C10C36BB0A3D98931B1362BBC8B48B63811510B0922992408384685EB1D19217AC1D04B911BBFC2547F2E1FD1241D09ADF12484E784902E776A274792263CE53673BDD3EE08D8319F30A6DC28DAE6249B0E3
Active session
Time
1 2 3 4 5 6 7 8 9 10
User 2
User 1
Active sessions
4
3
2
1
© 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.
E6636BC20180234D78A0072836F0BE9042B9B20C10C36BB0A3D98931B1362BBC8B48B63811510B0922992408384685EB1D19217AC1D04B911BBFC2547F2E1FD1241D09ADF12484E784902E776A274792263CE53673BDD3EE08D8319F30A6DC28DAE6249B0E3
Average active session
Time
1 2 3 4 5 6 7 8 9 10
User 2
User 1