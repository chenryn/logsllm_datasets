t
a
r
t
e
a
d
p
u
f
o
e
g
n
a
t
n
e
c
r
e
P
)
s
n
b
i
r
u
o
h
e
n
o
(
 95
 90
 85
 80
 75
 70
 65
 60
 55
 50
 2
 4
 6
 8
 10
 12
 14
 16
 18
 20
Threshold (K)
avg
Fig. 7. A suppress threshold of 4,000 (and
above) already damps many fewer preﬁxes
Fig. 8. A threshold of 6,000 enables an average
churn reduction of 19%
Increasing the value of the suppress threshold above today’s default will increase
the BGP churn rate, but it will save many mice and still be less churn than a router
with RFD turned off. Figure 8 illustrates this. The x-axis is the candidate value of the
suppress threshold. On the y-axis we show the update rate on a per minute average in
60 minute bins. 100% is the churn when RFD is disabled.
Here, we try to estimate how churn could change if we activate RFD at various
thresholds. Unfortunately, we face two problems: (1) the accuracy of timestamps and
(2) we are looking at only one router and not studying interactions in complex topolo-
gies. With regard to (1) we record incoming updates via tcpdump with sub-second accu-
racy. However, the router provides us with less frequent snapshots of the penalty values.
We therefore have only an estimate of the penalty. Especially, we do not know the exact
time of onset, e.g., when an update would have been damped. Updates often come in
bursts with short inter-arrival times but the arrival process of bursts is rather uniformly
distributed in time, and thus within the snapshots. If a preﬁx has a penalty above the
considered threshold in the current snapshot, all its updates in the coming interval are
marked as being potentially removed. This provides an estimation of the update rate.
By averaging over the whole trace, the error smooths out. We tag all updates that cross
our 2K, 3K,. . . thresholds within a certain time-window. With respect to (2) we can-
not predict how MRAI and best path selection processes will or will not delay updates.
150
C. Pelsser et al.
While we believe that the overall properties of update behavior are comparable, we
leave it for future work to study the impact in complex topologies.
We observe a 47% reduction of the average update rate with a penalty of 2,000, com-
pared to a situation without RFD, in Figure 8. 4,000, 5,000 and 6,000 correspond to an
average update rate reduction between 26% and 19%. Thus, it is worthwhile changing
the default suppress threshold value. Our proposal is a very simple modiﬁcation which
is rather effective compared to more complex solutions such as [10].
We further note that the churn reduction is similar for all thresholds above 12K. Damp-
ing thresholds of 12K, 15K and 18K suppress an average of 11.26%, 9.51% and 8.12%
of the updates, which is still non negligible for such a trivial change as we propose.
To compare the really heavy hitters in the intervals 12K-15K, 15K-18K, and above
18K, we concentrate on 64 preﬁxes which have a damped duration of six hours or
longer. We notice that 53 of those 64 preﬁxes (83%) at some point pass the high point of
18K. Only nine preﬁxes (14%) stay in the 12K-15K range, and only two preﬁxes (3%)
go over 15K, but not up to 18K. This strengthens our conﬁdence that the ‘evil’ guys,
the really heavy hitters which constantly ﬂap, will be caught by almost any threshold
setting, be it 12K, 15K, or 18K.
Thus, for more conservative operators that desire to spare most of the mice and still
see around 10% churn reduction, we recommend values 12K and above. It does not
matter much which of these three values are chosen. If a preﬁx is ﬂapping so hard that
it reaches 12K, then it is also likely to go higher at some time.
5 Other Feeds
A critical question is whether the observations and recommendations in the previous
section hold for other locations in the Internet topology? Can we make a generic rec-
ommendation for the ‘suppress penalty’ value? To understand this, we replayed addi-
tional varied BGP traces from Route Views into r0 (see ‘RV/RIS Updates’ in Figure 3)
in pseudo real-time. Again, r0 logged the RFD penalties of the received routes.
We performed two additional experiments. Figure 10 describes the additional work-
load traces that were replayed to the router. These were in addition to the in vivo feeds
from the tier-1 ISP and the Exchange Point.
These experiments were designed to determine if different update patterns recorded
at different places in the Internet topology would affect our conclusions.
Figure 9 shows the penalty values for preﬁxes with the new feeds replayed from
Route Views. It shows that the distributions are exceedingly similar to those from the
live feeds. Similar to Figure 5, this plot shows a CDF of penalties assigned by r0 to the
different instances in the time-preﬁx-space. The green curve is the workload from the
live feed plus a BGP feed from an African peering point. The blue curve is the 1.5 day
live workload with the 10 additional Route Views feeds. The red curve is the one week
workload (live feed), previously shown (see Figure 5) for comparison. We observe that
all three curves have a similar shape. Adding more feeds just leads to more preﬁxes that
ﬂap but the number of ‘elephants’ is very similar.
Therefore, our damping suppression threshold recommendation does not change for
BGP feeds from varying points in the Internet topology.
Route Flap Damping Made Usable
151
Proportion of prefixes with penalty value below x (CDF)
0
1
.
.
8
0
6
0
.
.
4
0
2
0
.
0
.
0
live−feed
10 large feeds
1 small feed
0
5000
10000
15000
20000
25000
Penalty
10 large feeds: Ten Route Views [18] feeds
which received the maximum number of
updates from August 5 to mid-day August
6, 2010 (1.5 days).
1 small feed: A small selected African Ex-
change, route-views.kixp. Data were col-
lected from August 27 to September 1,
2010 (5 days).
Fig. 9. Distribution of penalty values
Fig. 10. Additional feeds
s
e
x
i
f
e
r
p
f
o
n
o
i
t
r
o
p
o
r
P
6 Conclusion
We studied the impact of RFD on the Internet. As previously observed by many other
researchers, a small fraction of preﬁxes is responsible for a signiﬁcant portion of the
update churn. RFD was developed to reduce this noise, but the current default parame-
ters do not properly take into account properties of the BGP protocol. Any path-vector
protocol is by it’s very design noisy due to path exploration.
We therefore looked at the effect of an absolutely minimal change, only adjusting
RFD parameters, to get moderate churn reduction without adversely impacting nor-
mally converging preﬁxes. Our recommendation derived from this study would be to
damp a route when it reaches a penalty above 12,000. The suppress threshold can be
set to any value between 12,000 and 18,000. Such a setting will suppress the BGP
churn of routes that ﬂap heavily while keeping paths for preﬁxes which only slightly
contribute to BGP churn. For operators extremely concerned about churn, a suppress
threshold of 4,000 to 6,000 is a far better compromise than today’s default parameters.
It may still damp some normally converging preﬁxes, but will also signiﬁcantly reduce
the BGP update rate.
We do not recommend changing the maximum suppress time, but we strongly rec-
ommend the limit of the maximum suppress threshold value be raised. A maximum
suppress time of one hour is very reasonable to achieve recovery once the ﬂapping
stops (and heavy hitters will anyway broadcast continuously), but the maximum sup-
press threshold needs to be able to allow higher values than 12,000.
Acknowledgments
We are very grateful to Cisco for the code modiﬁcation that made those measure-
ments possible, and for engineering support, equipment, and funding. Google, NTT,
and Equinix contributed signiﬁcant support. We are thankful to Matthew Roughan for
many comments on earlier versions of this idea. We would also like to thank Nate Kush-
man for the inspiring discussions.
152
C. Pelsser et al.
References
1. Basu, A., Ong, C.H.L., Rasala, A., Shepherd, F.B., Wilfong, G.: Route Oscillations in I-BGP
with Route Reﬂection. In: Proc. ACM SIGCOMM (2002)
2. Bush, R., Grifﬁn, T., Mao, Z.M.: Route Flap Damping: Harmful? RIPE 43 (2002),
http://www.ripe.net/ripe/meetings/archive/ripe-43/presentations/
ripe43-routing-flap.pdf
3. Elmokashﬁ, A., Kvalbein, A., Dovrolis, C.: BGP Churn Evolution: A Perspective from the
Core. In. In: Proceedings of INFOCOM (2010)
4. Grifﬁn, T.G., Wilfong, G.: Analysis of the MED Oscillation Problem in BGP. In: Proceedings
of the International Conference on Network Protocols (2002)
5. Grifﬁn, T.G.: What is the Sound of One Route Flapping? IPAM (2002)
6. Grifﬁn, T.G., Premore, B.J.: An Experimental Analysis of BGP Convergence Time. In: Proc.
ICNP (2001)
7. Grifﬁn, T.G., Wilfong, G.: On the Correctness of iBGP Conﬁguration. SIGCOMM Comput.
Commun. Rev. 32(4), 17–29 (2002)
8. Huston, G.: The BGP Instability Report (2006),
http://bgpupdates.potaroo.net/ instability/bgpupd.html
9. Huston, G.: BGP Extreme Routing Noise. RIPE 52 (2006),
http://www.ripe.net/ripe/meetings/ripe-52/presentations/
ripe52-plenary-bgp-review.pdf
10. Huston, G.: Update damping in BGP (2007),
http://www.potaroo.net/presentations/2007-10-25-dampbgp.pdf
11. Labovitz, C., Ahuja, A., Bose, A.: Delayed Internet Routing Convergence. In: Proceedings
of SIGCOMM, pp. 175–177 (August 2000)
12. Mao, Z.M., Bush, R., Grifﬁn, T.G., Roughan, M.: BGP Beacons. In: Proc. ACM IMC (2003)
13. Mao, Z.M., Govidan, R., Varghese, G., Katz, R.H.: Route Flap Damping Excacerbates Inter-
net Routing Convergence. In: Proceedings of SIGCOMM (August 2002)
14. Panigl, C., Schmitz, J., Smith, P., Vistoli, C.: RIPE Routing-WG Recommendation for Coor-
dinated Route-ﬂap Damping Parameters (2001),
http://www.ripe.net/ripe/docs/ripe-229.html
15. Park, J.H., Jen, D., Lad, M., Amante, S., McPherson, D., Zhang, L.: Investigating Occurrence
of Duplicate Updates in BGP Announcements. In: Krishnamurthy, A., Plattner, B. (eds.)
PAM 2010. LNCS, vol. 6032, pp. 11–20. Springer, Heidelberg (2010)
16. Rekhter, Y., Li, T.: A Border Gateway Protocol 4 (BGP-4) (2006), RFC 4271
17. Teixeira, R., Shaikh, A., Grifﬁn, T.G., Voelker, G.M.: Network Sensitivity to Hot-Potato
Disruptions. In: Proc. ACM SIGCOMM (2004)
18. University of Oregon RouteViews project, http://www.routeviews.org/
19. Villamiyar, C., Chandra, R., Govindan, R.: BGP Route Flap Damping (1998), RFC 2439
20. Wang, F., Mao, Z.M., Wang, J., Gao, L., Bush, R.: A Measurement Study on the Impact
of Routing Events on End-to-End Internet Path Performance. In: Proc. ACM SIGCOMM
(2006)