traffic (which happens as a result of the generated events).
Finally, we found that the PrivCount model requires more com-
putational and memory resources to run in Shadow compared to the
single file and protocol models. We believe this is because the Priv-
Count model contains more clients than the other models. Given
our results, we suspect that inactive clients can be excluded to save
resources without significant detrimental effect. An area of further
research would be to explore how running fewer but busier clients
affects experimental accuracy, and how changes in experimental
accuracy affects research conclusions.
7 RELATED WORK
This work focuses on the measuring and modeling of Tor traffic.
7.1 Measuring Tor
A measurement process is necessary for distributed system opera-
tors that wish to understand the usage and performance of their
system. A simple approach taken in early Tor measurement studies
from McCoy et al. [39] and Chaabane et al. [8] was to directly log
traffic and later analyze it to extract interesting statistics. Because
these studies recorded and manually analyzed sensitive data (in-
cluding packet headers and some fraction of packet payloads), they
were met with strong criticism from the privacy community. Fol-
lowing these studies, Soghoian raised ethical and legal questions
and called for better standards for safer Tor research [49].
Loesing provided guidelines for safely measuring anonymity
networks and conducted a privacy-preserving Tor measurement
study of the number of connecting clients and amount of exit traffic
by port [37]. The privacy techniques include simple rounding and
per-relay aggregation over time; secure aggregation across relays
is not considered and there is no rigorous analysis of privacy guar-
antees, both of which our measurement study benefits from due to
our use of PrivCount [26].
Despite Soghoian’s and Loesing’s work, a traffic logging ap-
proach was still later used by Ling et al. [35] to measure and classify
malicious traffic on Tor using the snort intrusion detection system.
More recently, Owen and Savage collected a list of unique hidden
service addresses by running a large number of hidden service di-
rectories and recording hidden service lookups [42]. These direct
logging studies are illuminating but are ethically questionable since
they provide no privacy protections.
There has been considerable advances in recent years in privacy-
preserving Tor measurement techniques and tools. Elahi et al. first
designed secret-sharing and distributed decryption variants of
PrivEx, a traffic statistics measurement system based on distributed
differential privacy and secure multiparty computation [13]. Jansen
and Johnson extended the secret-sharing variant of PrivEx to de-
sign and develop PrivCount, which they used to measure a wide
range of Tor traffic statistics [26]. Jansen et al. extended PrivCount
to support the classification of circuits and webpages, and used it
to measure the popularity of hidden services [28]. Our work also
extends PrivCount to support the measurement and processing of
hidden markov traffic models. Finally, Mani and Sherr developed
100101102103104105GeneratedEventCounts0.00.20.40.60.81.0CumulativeFractionStreamsPerCircuitPacketsPerStreamPacketsPerCircuit10−210−1100101102103GenerationTime(ms)0.00.20.40.60.81.0CumulativeFractionStreamsPerCircuitPacketsPerStreamPacketsPerCircuitTotalPerCircuitSession 10A: TORCCS’18, October 15-19, 2018, Toronto, ON, Canada1957Historϵ, a distributed measurement system that is robust to manipu-
lation by malicious data collectors [38], while Fenske et al. designed
Private Set-union Cardinality, a cryptographic protocol for aggre-
gating the count of unique items across data collectors [14].
7.2 Modeling Tor
Early Tor client models were created for use in single-purpose
discrete-event Tor simulators that explore the performance benefits
of Tor incentive schemes [25, 41]. Variants of these client models
that utilized some of the Tor-specific statistics measured by McCoy
et al. [39] were later adopted into higher-fidelity Tor experimenta-
tion tools [6, 22, 24]. These early models, which correspond to our
single file models from Section 5.2.1, became somewhat of an unof-
ficial standard in Tor performance research because: (i) they were
based on actual Tor measurements; and (ii) it was difficult to safely
and ethically collect new Tor measurements that could be used in
new models. We seek to better understand the accuracy and fidelity
of these previous models while also using recent privacy-preserving
measurement tools to produce newer, data-driven models that are
more representative of the current Tor network.
Models of Tor network structure, including Internet paths, la-
tency, packet loss rates, and relay and client types and distribution,
were first rigorously set out by Jansen et al. [22]. The network
topologies of these initial models were independently improved by
Wacek et al. [51], and later integrated and validated for Shadow [24]
by Jansen et al. [23]. We produce the most recent model of network
topology using real Internet measurements from RIPE Atlas and
the most recent bandwidth data available from speedtest.net. We
believe that our topology yields the best trade-off between fidelity,
measurement overhead, and processing delays during simulation
of any previous model.
8 CONCLUSION
In this paper, we conducted a significant general measurement
study of Tor, measuring clients, circuits, streams, bytes, and their
distributions for modeling purposes. Additionally, we collected
measurements that we used to dynamically learn hidden Markov
stream arrival and packet models. Using our measurements, we
designed a traffic generation model for private Tor networks and
demonstrated that our model yields a more realistic network than
previous and alternative models. We identified interesting areas
of future work, including the measurement of HMM stream and
packet models over time periods longer than 24 hours and exploring
how network accuracy affects research conclusions across a range
of network scales.
ACKNOWLEDGMENTS
We thank the anonymous reviewers for their feedback and sug-
gestions to improve the paper. We thank Tim Wilson-Brown for
running some of the Tor relays and PrivCount nodes that we used to
measure Tor, Ryan Wails for the discussion about modeling Internet
latency, and Ryan Wails and Phillip Winter for donating RIPE Atlas
credits that we used to run Atlas measurements. This work has been
partially supported by the Office of Naval Research, the National
Science Foundation under grant numbers CNS-1527401 and CNS-
1314637, and the Department of Homeland Security Science and
Technology Directorate, Homeland Security Advanced Research
Projects Agency, Cyber Security Division under agreement number
FTCY1500057. The views expressed in this work are strictly those
of the authors and do not necessarily reflect the official policy or
position of any employer or funding agency.
REFERENCES
[1] Mashael AlSabah, Kevin Bauer, Tariq Elahi, and Ian Goldberg. The path less trav-
elled: Overcoming Tor’s bottlenecks with traffic splitting. In Privacy Enhancing
Technologies Symposium (PETS), pages 143–163. Springer, 2013.
[2] Mashael AlSabah, Kevin Bauer, Ian Goldberg, Dirk Grunwald, Damon McCoy,
Stefan Savage, and Geoffrey M Voelker. Defenestrator: Throwing out windows
in Tor. In Privacy Enhancing Technologies Symposium (PETS), pages 134–154.
Springer, 2011.
[3] Mashael AlSabah and Ian Goldberg. PCTCP: Per-circuit tcp-over-ipsec trans-
port for anonymous communication overlay networks. In ACM Conference on
Computer and Communications Security (CCS), 2013.
[4] Mashael AlSabah and Ian Goldberg. Performance and security improvements for
Tor: A survey. ACM Computing Surveys (CSUR), 49(2):32, 2016.
[5] Armon Barton and Matthew Wright. DeNASA: Destination-naive AS-awareness
in anonymous communications. Proceedings on Privacy Enhancing Technologies
(PoPETs), 2016(4):356–372, 2016.
[6] Kevin S Bauer, Micah Sherr, and Dirk Grunwald. ExperimenTor: A testbed for
safe and realistic Tor experimentation. In USENIX Workshop on Cyber Security
Experimentation and Test (CSET), 2011.
[7] A. R. Bharambe, C. Herley, and V. N. Padmanabhan. Analyzing and improving a
bittorrent networks performance mechanisms. In IEEE International Conference
on Computer Communications (INFOCOM), 2006.
[8] A. Chaabane, P. Manils, and M.A. Kaafar. Digging into anonymous traffic: A deep
analysis of the Tor anonymizing network. In IEEE Network and System Security
(NSS), 2010.
[9] Bernd Conrad and Fatemeh Shirazi. Analyzing the effectiveness of dos attacks on
tor. In Proceedings of the 7th International Conference on Security of Information
and Networks, page 355. ACM, 2014.
[10] S. Dahal, Junghee Lee, Jungmin Kang, and Seokjoo Shin. Analysis on end-to-end
node selection probability in tor network. In 2015 International Conference on
Information Networking (ICOIN), pages 46–50, Jan 2015.
[11] Roger Dingledine, Nick Mathewson, and Paul Syverson. Tor: The second-
generation onion router. In USENIX Security Symposium (USENIX), 2004.
[12] Cynthia Dwork. Differential privacy. In International Colloquium on Automata,
1973.
Languages and Programming (ICALP), 2006.
[13] Tariq Elahi, George Danezis, and Ian Goldberg. PrivEx: Private collection of
traffic statistics for anonymous communication networks. In ACM Conference
on Computer and Communications Security (CCS), 2014. See also git://git-crysp.
uwaterloo.ca/privex.
[14] Ellis Fenske, Akshaya Mani, Aaron Johnson, and Micah Sherr. Distributed mea-
surement with private set-union cardinality. In ACM Conference on Computer
and Communications Security (CCS), 2017.
[15] G. D. Forney. The viterbi algorithm. Proceedings of the IEEE, 61(3):268–278, March
[16] John Geddes, Rob Jansen, and Nicholas Hopper. How low can you go: Balancing
In International Symposium on Privacy
performance with anonymity in tor.
Enhancing Technologies Symposium, pages 164–184. Springer, 2013.
[17] John Geddes, Rob Jansen, and Nicholas Hopper. IMUX: Managing Tor connections
from two to infinity, and beyond. In ACM Workshop on Privacy in the Electronic
Society (WPES), pages 181–190. ACM, 2014.
[18] John Geddes, Mike Schliep, and Nicholas Hopper. Abra cadabra: Magically
increasing network utilization in tor by avoiding bottlenecks. In Proceedings of
the 2016 ACM on Workshop on Privacy in the Electronic Society, pages 165–176.
ACM, 2016.
[19] Deepika Gopal and Nadia Heninger. Torchestra: Reducing interactive traffic
delays over Tor. In ACM Workshop on Privacy in the Electronic Society (WPES),
2012.
[20] Nicholas Hopper. Challenges in protecting tor hidden services from botnet abuse.
In Financial Cryptography and Data Security (FC), pages 316–325. Springer, 2014.
[21] Mohsen Imani, Armon Barton, and Matthew Wright. Guard sets in tor using as
relationships. Proceedings on Privacy Enhancing Technologies, 2018(1):145–165,
2018.
[22] Rob Jansen, Kevin Bauer, Nicholas Hopper, and Roger Dingledine. Methodically
modeling the Tor network. In USENIX Workshop on Cyber Security Experimenta-
tion and Test (CSET), 2012.
[23] Rob Jansen, John Geddes, Chris Wacek, Micah Sherr, and Paul F Syverson. Never
been KIST: Tor’s congestion management blossoms with kernel-informed socket
transport. In USENIX Security Symposium (USENIX), 2014.
Session 10A: TORCCS’18, October 15-19, 2018, Toronto, ON, Canada1958[24] Rob Jansen and Nicholas Hopper. Shadow: Running Tor in a box for accurate and
efficient experimentation. In Network and Distributed System Security Symposium
(NDSS), 2012. See also https://shadow.github.io.
[25] Rob Jansen, Nicholas Hopper, and Yongdae Kim. Recruiting new Tor relays with
BRAIDS. In ACM Conference on Computer and Communications Security (CCS),
2010.
[26] Rob Jansen and Aaron Johnson. Safely measuring Tor. In ACM Conference on
Computer and Communications Security (CCS), 2016. See also https://github.com/
privcount.
[27] Rob Jansen, Aaron Johnson, and Paul Syverson. LIRA: Lightweight incentivized
routing for anonymity. In Network and Distributed System Security Symposium
(NDSS), 2013.
[28] Rob Jansen, Marc Juarez, Rafael Galvez, Tariq Elahi, and Claudia Diaz. Inside Job:
Applying traffic analysis to measure Tor from within. In Network and Distributed
System Security Symposium (NDSS), 2018.
[29] Rob Jansen, Paul F Syverson, and Nicholas Hopper. Throttling Tor bandwidth
parasites. In USENIX Security Symposium (USENIX), 2012.
[30] Rob Jansen and Matthew Traudt. Tor’s been KIST: A case study of transitioning
Tor research to practice. CoRR (arXiv), abs/1709.01044, 2017.
[31] Rob Jansen, Florian Tschorsch, Aaron Johnson, and Björn Scheuermann. The
sniper attack: Anonymously deanonymizing and disabling the Tor network. In
Network and Distributed System Security Symposium (NDSS), 2014.
[32] Aaron Johnson, Rob Jansen, Nicholas Hopper, Aaron Segal, and Paul Syver-
son. PeerFlow: Secure load balancing in Tor. Proceedings on Privacy Enhancing
Technologies (PoPETs), 2017(2):74–94, 2017.
[33] Aaron Johnson, Rob Jansen, Aaron D Jaggard, Joan Feigenbaum, and Paul Syver-
son. Avoiding the man on the wire: Improving Tor’s security with trust-aware
path selection. In Network and Distributed System Security Symposium (NDSS),
2017.
[34] Dong Lin, Micah Sherr, and Boon Thau Loo. Scalable and anonymous group com-
munication with MTor. Proceedings on Privacy Enhancing Technologies (PoPETs),
2016(2):22–39, 2016.
[35] Zhen Ling, Junzhou Luo, Kui Wu, Wei Yu, and Xinwen Fu. TorWard: Discovery
In IEEE International Conference on Computer
of malicious traffic over Tor.
Communications (INFOCOM), 2014.
[36] Zhuotao Liu, Yushan Liu, Philipp Winter, Prateek Mittal, and Yih-Chun Hu.
TorPolice: Towards enforcing service-defined access policies for anonymous
communication in the Tor network.
In International Conference on Network
Protocols. IEEE, 2017.
[37] Karsten Loesing, Steven J. Murdoch, and Roger Dingledine. A case study on mea-
suring statistical data in the Tor anonymity network. In Financial Cryptography
and Data Security (FC), 2010. See also https://metrics.torproject.org.
[38] Akshaya Mani and Micah Sherr. HisTorε: Differentially private and robust
statistics collection for Tor. In Network and Distributed System Security Symposium
(NDSS), 2017.
[39] Damon McCoy, Kevin Bauer, Dirk Grunwald, Tadayoshi Kohno, and Douglas
Sicker. Shining light in dark places: Understanding the Tor network. In Privacy
Enhancing Technologies Symposium (PETS), 2008.
[40] W. Brad Moore, Chris Wacek, and Micah Sherr. Exploring the potential benefits
of expanded rate limiting in Tor: Slow and steady wins the race with tortoise. In
Annual Computer Security Applications Conference (ACSAC), ACSAC ’11, 2011.
[41] Tsuen-Wan “Johnny” Ngan, Roger Dingledine, and Dan S. Wallach. Building
incentives into Tor. In Financial Cryptography and Data Security (FC), 2010.
[42] Gareth Owen and Nick Savage. Empirical analysis of Tor hidden services. IET
Information Security, 10(3):113–118, 2016.
[43] Florentin Rochet and Olivier Pereira. Waterfilling: Balancing the tor network with
maximum diversity. Proceedings on Privacy Enhancing Technologies, 2017(2):4–22,
2017.
[44] Florentin Rochet and Olivier Pereira. Dropping on the edge: Flexibility and
traffic confirmation in onion routing protocols. Proceedings on Privacy Enhancing
Technologies, 2018(2):27–46, 2018.
[45] Fatemeh Shirazi, Claudia Diaz, and Joss Wright. Towards measuring resilience in
anonymous communication networks. In Proceedings of the 14th ACM Workshop
on Privacy in the Electronic Society, pages 95–99. ACM, 2015.
[46] Fatemeh Shirazi, Matthias Goehring, and Claudia Diaz. Tor experimentation
tools. In IEEE International Workshop on Privacy Engineering (IWPE), IWPE ’15,
pages 206–213, 2015.
[47] Padhraic Smyth. Clustering sequences with hidden markov models. In Advances
in neural information processing systems, pages 648–654, 1997.
[48] Robin Snader and Nikita Borisov. Eigenspeed: Secure peer-to-peer bandwidth
evaluation. In International Workshop on Peer-to-Peer Systems (IPTPS), 2009.
[49] Christopher Soghoian. Enforced community standards for research on users of
the Tor anonymity network. In Workshop on Ethics in Computer Security Research
(WECSR), 2011.
[50] CSL Sony and Kenjiro Cho. Traffic data repository at the wide project.
In
Proceedings of USENIX 2000 Annual Technical Conference: FREENIX Track, pages
263–270, 2000.
[51] Chris Wacek, Henry Tan, Kevin Bauer, and Micah Sherr. An Empirical Evaluation
of Relay Selection in Tor. In Network and Distributed System Security Symposium
(NDSS), 2013.
[52] The WIDE Project. Traffic trace info, 2016-07-08. http://mawi.wide.ad.jp/mawi/
samplepoint-F/2016/201607081400.html, July 2016.
[53] Lei Yang and Fengjun Li. Enhancing traffic analysis resistance for tor hidden
In International Conference on Security and
services with multipath routing.
Privacy in Communication Systems, pages 367–384. Springer, 2015.
[54] Lei Yang and Fengjun Li. mtor: A multipath tor routing beyond bandwidth
throttling. In 2015 IEEE Conference on Communications and Network Security
(CNS), pages 479–487, Sept 2015.
Session 10A: TORCCS’18, October 15-19, 2018, Toronto, ON, Canada1959APPENDIX
A ENTRY STATISTICS
Here we provide tables of entry statistics for graphical figures that