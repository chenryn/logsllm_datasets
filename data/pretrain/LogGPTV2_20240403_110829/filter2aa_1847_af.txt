By default, there is an address group created for all incoming IP addresses. Filters 
applied to this group will effect all incoming network traffic.
You can create additional groups based on source IP number or destination IP number.
See “Creating an Address Group” on page 50 for more information.
Step 4:  Add filters to the IP filter list
Read “Understanding Firewall Filters” on page 45 to learn how IP filters work and how 
to create them. You use this to further all other services, strengthen your network 
security, and manage your network traffic through the firewall.
For information about creating a new filter, see “Creating an Advanced IP Filter for TCP 
ports” on page 51.
Important:  If you add or change a filter after starting firewall service, the new filter 
will affect connections already established with the server. For example, if you deny 
all access to your FTP server after starting firewall service, computers already 
connected to your FTP server will be disconnected.
LL2351.Book  Page 48  Monday, September 8, 2003  2:47 PM
Chapter 3    IP Firewall Service
49
Step 5:  Save firewall service changes
Once you have configured your filters and determined which services to allow, save 
your changes so the new settings take effect.
Managing Firewall Service
This section gives step-by-step instructions for starting, stopping, and configuring 
firewall address groups and filters.
Starting and Stopping Firewall Service
By default, firewall service blocks all incoming TCP connections and allows all UDP 
connections. Before you turn on firewall service, make sure you’ve set up filters 
allowing access from IP addresses you choose. Otherwise, no one will have access to 
your server.
To start or stop firewall service:
1 In Server Admin, choose Firewall from the Computers & Services list.
2 Click Start Firewall.
When the service is started, the Stop Service button is available.
Opening the Firewall for Standard Services
By default, firewall service blocks all incoming TCP connections and allows all UDP 
connections. Before you turn on firewall service, make sure you’ve set up filters 
allowing access from IP addresses you choose; otherwise, no one will have access to 
your server.
You can easily allow standard services through the firewall without advanced and 
extensive configuration. Standard services include (but are not limited to):
• Web service
• Apple File service
• Windows File service
• FTP service
• Printer Sharing
Important:  If you add or change a filter after starting firewall service, the new filter 
will affect connections already established with the server. For example, if you deny 
all access to your FTP server after starting firewall service, computers already 
connected to your FTP server will be disconnected.
Important:  If you add or change a filter after starting firewall service, the new filter 
will affect connections already established with the server. For example, if you deny 
all access to your FTP server after starting firewall service, computers already 
connected to your FTP server will be disconnected.
LL2351.Book  Page 49  Monday, September 8, 2003  2:47 PM
50
Chapter 3    IP Firewall Service
• DNS/Rendezvous
• ICMP Echo Reply (incoming pings)
• IGMP (Internet Gateway Multicast Protocol)
• PPTP VPN
• L2TP VPN
• QTSS media streaming
• iTunes Music Sharing
To open the firewall for standard services:
1 In Server Admin, choose Firewall from the Computers & Services list.
2 Click Settings.
3 Select the General tab.
4 Select the Any address group.
If you want to restrict or designate IP addresses for a standard service, you should 
create an address group rather than use the Any address group. See “Creating an 
Address Group” on page 50 for more information.
5 Select the services you want to allow.
6 Click Save.
Creating an Address Group
You can define groups of IP addresses for your firewall filters. These groups are used to 
organize and target the filters. The default address group is for all addresses.
Addresses can be listed as individual addresses (192.168.2.2) or IP address and CIDR 
format netmask (192.168.2.0/24).
To create an address group:
1 In Server Admin, choose Firewall from the Computers & Services list.
2 Click Settings.
3 Select the General tab.
4 Click Add beneath the Address Group pane.
5 Enter a group name.
6 Enter the addresses and subnet mask you want the filters to effect.
7 Click OK.
Important:  If you add or change a filter after starting firewall service, the new filter 
will affect connections already established with the server. For example, if you deny 
all access to your FTP server after starting firewall service, computers already 
connected to your FTP server will be disconnected.
LL2351.Book  Page 50  Monday, September 8, 2003  2:47 PM
Chapter 3    IP Firewall Service
51
Editing or Deleting an Address Group
You can edit your address groups to change the range of IP addresses effected. The 
default address group is for all addresses. You can remove address groups from your 
firewall filter list. The filters associated with those addresses are also deleted.
Addresses can be listed as individual addresses (192.168.2.2) or IP address and CIDR 
format netmask (192.168.2.0/24).
To edit or delete an address group:
1 In Server Admin, choose Firewall from the Computers & Services list.
2 Click Settings.
3 Select the General tab.
4 Select the group name from the Address Group pane.
5 Click the Edit button beneath the Address Group pane to edit it.
Click the Delete button beneath the Address Group pane to delete it.
6 Edit the Group name or addresses as needed.
7 Click OK.
8 Click Save.
Duplicating an Address Group
You can duplicate address groups from your firewall filter list. This can help speed up 
configuration of similar address groups.
To duplicate an address group:
1 In Server Admin, choose Firewall from the Computers & Services list.
2 Click Settings.
3 Select the General tab.
4 Select the group name from the Address Group pane.
5 Click the Duplicate button beneath the Address Group pane.
Creating an Advanced IP Filter for TCP ports
You can use the Advanced Settings pane to configure very specific filters for TCP ports. 
IP filters contain an IP address and a subnet mask. You can apply a filter to all IP 
addresses, a specific IP address, or a range of IP addresses.
Addresses can be listed as individual addresses (192.168.2.2) or IP address and CIDR 
netmask (192.168.2.0/24).
LL2351.Book  Page 51  Monday, September 8, 2003  2:47 PM
52
Chapter 3    IP Firewall Service
To create an IP filter for TCP ports:
1 In Server Admin, choose Firewall from the Computers & Services list.
2 Click Settings.
3 Select the Advanced tab.
4 Click the New button.
Alternatively, you can select a rule similar to the one you want to create, and click 
Duplicate then Edit.
5 Select whether this filter will allow or deny access in the Action pop-up menu.
6 Choose TCP from the Protocol pop-up menu.
7 Choose a TCP service from the pop-up menu.
If you want to select a nonstandard service port, choose Other.
8 If desired, choose to log packets that match the filter.
9 Enter the Source IP address range you want to filter.
If you want it to apply to any address, choose Any from the pop-up menu.
If you have selected a nonstandard service port, enter the source port number.
10 Enter the Destination IP address range you want to filter.
If you want it to apply to any address, choose Any from the pop-up menu.
If you have selected a nonstandard service port, enter the source port number.
11 Choose which network interface this filter applies to.
12 Click OK.
13 Click Save to apply the filter immediately.
Creating an Advanced IP Filter for UDP Ports
You can use the Advanced Settings pane to configure very specific filters for UDP 
ports. Many services use User Datagram Protocol (UDP) to communicate with the 
server. By default, all UDP connections are allowed. You should apply filters to UDP 
ports sparingly, if at all, because “deny” filters could create severe congestion in your 
server traffic.
If you filter UDP ports, don’t select the “Log all allowed packets” option in the filter 
configuration windows in Server Admin. Since UDP is a “connectionless” protocol, every 
packet to a UDP port will be logged if you select this option.
You should also allow UDP port access for specific services, including:
• DNS
• DHCP
• SLP
• Windows Name Service browsing
LL2351.Book  Page 52  Monday, September 8, 2003  2:47 PM
Chapter 3    IP Firewall Service
53
• Remote Desktop
• NFS
• NetInfo
UDP ports above 1023 are allocated dynamically by certain services, so their exact port 
numbers may not be determined in advance.
Addresses can be listed as individual addresses (192.168.2.2) or IP address and CIDR 
netmask (192.168.2.0/24).
To easily configure UDP access for these ports, see “Opening the Firewall for Standard 
Services” on page 49. If you need more advanced firewall settings for these basic UDP 
services, use the following instructions to create them.
To create an IP filter for UDP ports:
1 In Server Admin, choose Firewall from the Computers & Services list.
2 Click Settings.
3 Select the Advanced tab.
4 Click the New button.
Alternatively, you can select a rule similar to the one you want to create, and click 
Duplicate then Edit.
5 Select whether this filter will allow or deny access in the Action pop-up menu.
6 Choose UDP from the Protocol pop-up menu.
7 Choose a UDP service from the pop-up menu.
If you want to select a nonstandard service port, choose Other.
8 If desired, choose to log packets that match the filter.
9 Enter the Source IP address range you want to filter.
If you want it to apply to any address, choose Any from the pop-up menu.
If you have selected a nonstandard service port, enter the source port number.
10 Enter the Destination IP address range you want to filter.
If you want it to apply to any address, choose Any from the pop-up menu.
If you have selected a nonstandard service port, enter the source port number.
11 Choose which network interface this filter applies to.
12 Click OK.
13 Click Save to apply the filter immediately.
LL2351.Book  Page 53  Monday, September 8, 2003  2:47 PM
54
Chapter 3    IP Firewall Service
Editing Advanced IP Filters
If you edit a filter after turning on firewall service, your changes affect connections 
already established with the server. For example, if any computers are connected to 
your Web server, and you change the filter to deny all access to the server, connected 
computers will be disconnected.
To edit advanced IP filters:
1 In Server Admin, choose Firewall from the Computers & Services list.
2 Click Settings.
3 Select the Advanced tab.
4 Select a filter and click Duplicate, Edit, or Delete. If you’re deleting a filter, you’ve 
finished.
5 Make any changes to the settings, then click Save.
Changing the Default Filter
If the server receives a packet using a port or IP address to which none of your filters 
apply, firewall service uses the Default filter. You can set the Default filter to either deny 
or allow these packets for specific IP addresses. By default the Default filter denies 
access.
If you need to change the Default filter to allow access, you can. However, you 
shouldn’t take this action lightly. Changing the default to allow means you must 
explicitly deny access to your services by setting up specific port filters for all the 
services that need protection.
It is recommended that you leave the Default filter in place and use the General panel 
to create higher priority rules which allow access to designated services.
To change the Default setting:
1 In Server Admin, choose Firewall from the Computers & Services list.
2 Click Settings.
3 Select the General tab.
4 Select Default and click Edit.
5 Make any changes to the settings, then Click Save.
LL2351.Book  Page 54  Monday, September 8, 2003  2:47 PM
Chapter 3    IP Firewall Service
55
Monitoring Firewall Service
Firewalls are a networks first line of defense against malicious computer users 
(commonly called “hackers”). To maintain the security of your computers and users, you 
need to monitor firewall activity and deter potential threats. This sections explains how 
to log and monitor your firewall.
Viewing the Firewall Status Overview
The Status Overview shows a simple summary of the firewall service. It shows whether 
or not the service is running and which filters rules are active.
To see the overview:
1 In Server Admin, choose Firewall from the Computers & Services list.
2 Click the Overview button.
Setting Up Logs for Firewall Service
You can log only the packets that are denied by the filters you set, only the packets 
that are allowed, or both. Both logging options can generate a lot of log entries, which 
can fill up disk space and degrade the performance of the server. You should use “Log 
all allowed packets” only for limited periods of time.
You can choose to log allowed packets, denied packets, and a designated number of 
packets.
To set up logs:
1 In Server Admin, choose Firewall from the Computers & Services list.
2 Click Settings.
3 Select the Logging tab.
4 Select the logging options you want.
5 Click Save to start logging.
Viewing the Firewall Log
Each filter you create in Server Admin corresponds to one or more rules in the 
underlying firewall software. Log entries show you the rule applied, the IP address of 
the client and server, and other information.
To view the log for firewall service:
1 In Server Admin, choose Firewall from the Computers & Services list.
2 Click Settings.
3 Select the Log tab.
Here are some examples of firewall log entries and how to read them.
LL2351.Book  Page 55  Monday, September 8, 2003  2:47 PM
56
Chapter 3    IP Firewall Service
Log Example 1
Dec 12 13:08:16 ballch5 mach_kernel: ipfw: 65000 Unreach TCP 
10.221.41.33:2190 192.168.12.12:80 in via en0
This entry shows that firewall service used rule 65000 to deny (unreach) the remote 
client at 10.221.41.33:2190 from accessing server 192.168.12.12 on Web port 80 via 
Ethernet port 0.
Log Example 2
Dec 12 13:20:15 mayalu6 mach_kernel: ipfw: 100 Accept TCP 
10.221.41.33:721 192.168.12.12:515 in via en0
This entry shows that firewall service used rule 100 to allow the remote client at 
10.221.41.33:721 to access the server 192.168.12.12 on the LPR printing port 515 via 
Ethernet port 0.
Log Example 3
Dec 12 13:33:15 smithy2 mach_kernel: ipfw: 10 Accept TCP 
192.168.12.12:49152 192.168.12.12:660 out via lo0
This entry shows that firewall service used rule 10 to send a packet to itself on port 660 
via the loopback device 0.
Viewing Denied Packets
Viewing denied packets can help you identify problems and troubleshoot firewall 
service.
To view denied packets:
1 In Server Admin, choose Firewall from the Computers & Services list.
2 Click Settings.
3 Select the Logging tab.
4 Make sure “Log denied packets” is checked.
5 View log entries in Server Admin by clicking Log.
Viewing Packets Logged by Filter Rules
Viewing filtered packets can help you identify problems and troubleshoot firewall 
service.
To view filtered packets:
1 Turn on logging of filtered packets in filter editing window.
See “Editing Advanced IP Filters” on page 54 if you have not turned on logging for a 
particular filter.
2 To view log entries in Server Admin, choose Firewall from the Computers & Services list.
3 Click Log.
LL2351.Book  Page 56  Monday, September 8, 2003  2:47 PM
Chapter 3    IP Firewall Service
57
Practical Examples
The IP filters you create work together to provide security for your network. The 
examples that follow show how to use filters to achieve some specific goals.
Block Access to Internet Users
This section shows you, as an example, how to allow users on your subnet access to 
your server’s Web service, but deny access to the general public on the Internet:
To do this:
1 In Server Admin, choose Firewall from the Computers & Services list.
2 Click Settings.
3 Select the General tab.
4 Select the Any address group.
5 Make sure that Web Service is disabled in the right pane.
6 Click the Add button to create an address range.
7 Name the address group.
8 Add the local network address range.
This is done by using an example address from the network with its network mask in 
CIDR notation. For example, if a user has an address of 192.168.1.20 and the network 
mask is 255.255.255.0, then enter 192.168.1.20/24.
9 Click OK.
10 Select your newly created address group.
11 Select “Web Service” in the right pane to enable web access.
12 Click Save.
Block Junk Mail
This section shows you, as an example, how to reject email from a junk mail sender 
with an IP address of 17.128.100.0 and accept all other Internet email:
LL2351.Book  Page 57  Monday, September 8, 2003  2:47 PM
58
Chapter 3    IP Firewall Service
To do this:
1 In Server Admin, choose Firewall from the Computers & Services list.
2 Click Settings.
3 Select the General tab.
4 Select the Any address group.
5 Enable “SMTP Mail” in the right pane.
6 Click the Add button to create an address range.
7 Name the address group.
8 Enter 17.128.100.0 to the address range to indicate the junk mail sender’s address.
9 Click OK.
10 Select your newly created address group.
11 Deselect “SMTP Mail” in the right pane to disable mail transfer.
12 Click Save.
Allow a Customer to Access the Apple File Server
This section shows you, as an example, how to allow a customer with an IP address of 
10.221.41.33 to access an Apple file server.
To do this:
1 In Server Admin, choose Firewall from the Computers & Services list.
2 Click Settings.
3 Select the General tab.
4 Select the Any address group.
5 Disable “Apple File Service” in the right pane.
6 Click the Add button to create an address range.