control the transmission of this TLV in CCM PDUs through configuration at the continuity-check level.
NOTE: This configuration is not mandated by IEEE 802.1ag; rather it is provided to give more
flexibility to the operator. The Junos OS receives and processes CCMs with the Interface Status
TLV, regardless of this configuration.
94
The interface status TLV configuration is shown below:
protocols {
oam {
ethernet {
connectivity-fault-management {
maintenance-domain identifier {
level number;
maintenance-association identifier {
continuity-check {
interval number;
loss-threshold number;
hold-interval number;
interface-status-tlv; # Sets the interface status TLV
}
}
}
}
}
}
}
NOTE: The Junos OS supports transmission of only three out of seven possible values for the
Interface Status TLV. The supported values are 1, 2, and 7. However, the Junos OS is capable of
receiving any value for the Interface Status TLV.
Displaying the Received Interface Status TLV
The Junos OS saves the last received Interface Status TLV from the remote MEP. If the received
Interface Status value does not correspond to one of the standard values listed in Table 11 on page 92,
then the show command displays "unknown."
You can display this last saved Interface Status TLV using the show oam ethernet connectivity-fault-management
mep-database maintenance-domain identifier maintenance-association identifier local-mep identifier remote-mep
identifier command, as in the following example:
user@host> show oam ethernet connectivity-fault-management mep-database maintenance-domain md5 maintenance-
association ma5 local-mep 2001 remote-mep 1001
95
Maintenance domain name: md5, Format: string, Level: 5
Maintenance association name: ma5, Format: string
Continuity-check status: enabled, Interval: 100ms, Loss-threshold: 3 frames
MEP identifier: 2001, Direction: down, MAC address: 00:19:e2:b2:81:4a
Auto-discovery: enabled, Priority: 0
Interface status TLV: up, Port status TLV: up
Interface name: ge-2/0/0.0, Interface status: Active, Link status: Up
Remote MEP identifier: 1001, State: ok
MAC address: 00:19:e2:b0:74:00, Type: Learned
Interface: ge-2/0/0.0
Last flapped: Never
Remote defect indication: false
Port status TLV: none
Interface status TLV: none # displays the Interface Status TLV state
Displaying the Transmitted Interface Status TLV
The Junos OS saves the last transmitted Interface Status TLV from a local MEP. If the transmission of
Interface Status TLV has not been enabled, then the show command displays "none."
You can display the last transmitted Interface Status TLV using the show oam ethernet connectivity-fault-
management mep-database maintenance-domain identifier maintenance-association identifier local-mep identifier
remote-mep identifier command, as in the following example:
user@host> show oam ethernet connectivity-fault-management mep-database maintenance-domain md5
maintenance-association ma5 local-mep 2001 remote-mep 1001
Maintenance domain name: md5, Format: string, Level: 5
Maintenance association name: ma5, Format: string
Continuity-check status: enabled, Interval: 100ms, Loss-threshold: 3 frames
MEP identifier: 2001, Direction: down, MAC address: 00:19:e2:b2:81:4a
Auto-discovery: enabled, Priority: 0
Interface status TLV: up, Port status TLV: up
Interface name: ge-2/0/0.0, Interface status: Active, Link status: Up
Remote MEP identifier: 1001, State: ok
MAC address: 00:19:e2:b0:74:00, Type: Learned
Interface: ge-2/0/0.0
Last flapped: Never
Remote defect indication: false
Port status TLV: none
96
Interface status TLV: none
MAC Status Defects
The Junos OS provides MAC status defect information, indicating that one or more of the remote MEPs
is reporting a failure in its Port Status TLV or Interface Status TLV. It indicates “yes” if either some
remote MEP is reporting that its interface is not isUp (for example, at least one remote MEPs interface is
unavailable), or if all remote MEPs are reporting a Port Status TLV that contains some value other than
psUp (for example, all remote MEPs Bridge Ports are not forwarding data). There are two show commands
you can use to view the MAC Status Defects indication.
Use the mep-database command to display MAC status defects:
user@host> show oam ethernet connectivity-fault-management mep-database maintenance-domain md6
maintenance-association ma6
Maintenance domain name: md6, Format: string, Level: 6
Maintenance association name: ma6, Format: string
Continuity-check status: enabled, Interval: 1s, Loss-threshold: 3 frames
MEP identifier: 500, Direction: down, MAC address: 00:05:85:73:7b:39
Auto-discovery: enabled, Priority: 0
Interface status TLV: up, Port status TLV: up
Interface name: xe-5/0/0.0, Interface status: Active, Link status: Up
Defects:
Remote MEP not receiving CCM : no
Erroneous CCM received : no
Cross-connect CCM received : no
RDI sent by some MEP : no
Some remote MEP's MAC in error state : yes # MAC Status Defects yes/no
Statistics:
CCMs sent : 1658
CCMs received out of sequence : 0
LBMs sent : 0
Valid in-order LBRs received : 0
Valid out-of-order LBRs received : 0
LBRs received with corrupted data : 0
LBRs sent : 0
LTMs sent : 0
LTMs received : 0
LTRs sent : 0
LTRs received : 0
Sequence number of next LTM request : 0
97
1DMs sent : 0
Valid 1DMs received : 0
Invalid 1DMs received : 0
DMMs sent : 0
DMRs sent : 0
Valid DMRs received : 0
Invalid DMRs received : 0
Remote MEP count: 1
Identifier MAC address State Interface
200 00:05:85:73:39:4a ok xe-5/0/0.0
Use the interfaces command to display MAC status defects:
user@host> show oam ethernet connectivity-fault-management interfaces detail
Interface name: xe-5/0/0.0, Interface status: Active, Link status: Up
Maintenance domain name: md6, Format: string, Level: 6
Maintenance association name: ma6, Format: string
Continuity-check status: enabled, Interval: 1s, Loss-threshold: 3 frames
Interface status TLV: up, Port status TLV: up
MEP identifier: 500, Direction: down, MAC address: 00:05:85:73:7b:39
MEP status: running
Defects:
Remote MEP not receiving CCM : no
Erroneous CCM received : no
Cross-connect CCM received : no
RDI sent by some MEP : no
Some remote MEP's MAC in error state : yes # MAC Status Defects yes/no
Statistics:
CCMs sent : 1328
CCMs received out of sequence : 0
LBMs sent : 0
Valid in-order LBRs received : 0
Valid out-of-order LBRs received : 0
LBRs received with corrupted data : 0
LBRs sent : 0
LTMs sent : 0
LTMs received : 0
LTRs sent : 0
LTRs received : 0
Sequence number of next LTM request : 0
1DMs sent : 0
Valid 1DMs received : 0
98
Invalid 1DMs received : 0
DMMs sent : 0
DMRs sent : 0
Valid DMRs received : 0
Invalid DMRs received : 0
Remote MEP count: 1
Identifier MAC address State Interface
200 00:05:85:73:39:4a ok xe-5/0/0.0
Configuring Remote MEP Action Profile Support
Based on values of interface-status-tlv and port-status-tlv in the received CCM packets, a specific action,
such as interface-down, can be taken using the action-profile options. Multiple action profiles can be
configured on the router, but only one action profile can be assigned to a remote MEP.
The action profile can be configured with at least one event to trigger the action; but the action will be
triggered if any one of these events occurs. It is not necessary for all of the configured events to occur to
trigger action.
An action-profile can be applied only at the remote MEP level.
The following example shows an action profile configuration with explanatory comments added:
[edit protocols oam ethernet connectivity-fault-management]
action-profile tlv-action {
event {
# If interface status tlv with value specified in the config is received
interface-status-tlv down|lower-layer-down;
# If port status tlv with value specified in the config is received
port-status-tlv blocked;
# If connectivity is lost to the peer */
adjacency-loss;
}
action {
# Bring the interface down */
interface-down;
}
default-actions interface-down;
}
99
# domains
maintenance-domain identifier {
# maintenance domain level (0-7)
level number;
# association
maintenance-association identifier {
mep identifier {
interface ge-x/y/z.w;
remote-mep identifier {
# Apply the action-profile for the remote MEP
action-profile tlv-action;
}
}
}
}
Monitoring a Remote MEP Action Profile
You can use the show oam ethernet connectivity-fault-management mep-database command to view the action
profile status of a remote MEP, as in the following example:
show oam ethernet connectivity-fault- management mep-database remote-mep (Action Profile Event)
user@host> show oam ethernet connectivity-fault-management mep-database maintenance-domain md5
maintenance-association ma5 remote-mep 200
Maintenance domain name: md5, Format: string, Level: 5
Maintenance association name: ma5, Format: string
Continuity-check status: enabled, Interval: 1s, Loss-threshold: 3 frames
MEP identifier: 100, Direction: down, MAC address: 00:05:85:73:e8:ad
Auto-discovery: enabled, Priority: 0
Interface status TLV: none, Port status TLV: none # last status TLVs transmitted by the router
Interface name: ge-1/0/8.0, Interface status: Active, Link status: Up
Remote MEP identifier: 200, State: ok # displays the remote MEP name and state
MAC address: 00:05:85:73:96:1f, Type: Configured
Interface: ge-1/0/8.0
Last flapped: Never
Remote defect indication: false
Port status TLV: none
Interface status TLV: lower-layer-down
100
Action profile: juniper # displays remote MEP’s action profile identifier
Last event: Interface-status-tlv lower-layer-down # last remote MEP event
# to trigger action
Action: Interface-down, Time: 2009-03-27 14:25:10 PDT (00:00:02 ago)
# action occurrence time
RELATED DOCUMENTATION
connectivity-fault-management
IEEE 802.1ag OAM Connectivity Fault Management | 21
Configuring Chassis ID TLV
In Release 16.1R2 and later, you can configure Junos OS to send the sender ID TLV along with the
packets. The sender ID TLV is an optional TLV that is sent in continuity check messages (CCMs),
loopback messages, and Link Trace Messages (LTMs), as specified in the IEEE 802.1ag standard. The
sender ID TLV contains the chassis ID, which is the unique, CFM-based MAC address of the device, and
the management IP address, which is an IPv4 or an IPv6 address.
The value of the length field in the TLV indicates whether or not the TLV contains the chassis ID
information. The possible values for the length field are zero (0) or any valid number, which indicates the
absence or presence of chassis ID information in the TLV, respectively.
You can enable Junos OS to send the sender ID TLV at the global level by using the set protocols oam
ethernet connectivity-fault-management sendid-tlv send-chassis-tlv command. If the sender ID TLV is
configured at the global level, then the default maintenance domain, maintenance association, and the
maintenance association intermediate point (MIP) half function inherit this configuration.
You can also configure the sender ID TLV at the following hierarchy levels:
• [edit protocols oam ethernet connectivity-fault-management].
• [edit protocols oam ethernet connectivity-fault-management maintenance-domain maintenance-domain-name
maintenance-association maintenance-association-name continuity-check].
The sender ID TLV configuration at the maintenance-association level takes precedence over the global-
level configuration.
NOTE: The sender ID TLV is supported only for 802.1ag PDUs and is not supported for
performance monitoring protocol data units (PDUs).
101
SEE ALSO
IEEE 802.1ag OAM Connectivity Fault Management | 21
Configuring MAC Flush Message Processing in CET Mode
IN THIS SECTION
Configuring a Connection Protection TLV Action Profile | 103
In carrier Ethernet transport (CET) mode, MX Series routers are used as provider edge (PE) routers, and
Nokia Siemens Networks A2200 Carrier Ethernet Switches (referred to as E-domain devices) that run
standard-based protocols are used in the access side. On the MX Series routers, VPLS pseudowires are
configured dynamically through label distribution protocol (LDP). On the E-domain devices, topology
changes are detected through connectivity fault management (CFM) sessions running between the E-
domain devices and the MX Series PE routers. The MX Series PE routers can bring the carrier Ethernet
interface down if there is CFM connectivity loss. This triggers a local MAC flush as well as a targeted
label distribution protocol (T-LDP) MAC flush notification that gets sent towards the remote MX Series
PEs to trigger MAC flush on them.
In CET inter-op mode, MX Series routers need to interoperate with the Nokia Siemens Networks Ax100
Carrier Ethernet access devices (referred to as A-domain devices) that run legacy protocols. Nokia
Siemens Networks A4100 and A8100 devices act as an intermediate between the MX Series PE routers
and A-domain devices. These intermediate devices perform interworking function (IWF) procedures so
that operations administration management (OAM) sessions can be run between MX Series routers and
A-domain devices. There are no VPLS pseudowires between the MX Series PE routers and the Nokia
Siemens Networks A4100 and A8100 intermediate devices, so there is no LDP protocol running
between the PE routers to send topology change notifications. In order to communicate topology
changes, MX Series routers can trigger a MAC flush and propagate it in the core. MX Series routers can
use action profiles based upon the connection protection type length value (TLV) event. The action
profile brings down the carrier edge logical interface in MX Series PE routers, which will trigger a local
MAC flush and also propagate the topology change to the core using LDP notification.
For VPLS there is no end-to-end connectivity monitored. The access rings are independently monitored
by running CFM down multiple end points (MEPs) on the working and protection paths for each of the
services between the E-domain devices and the MX Series PE routers, and between the A-domain
devices and the MX Series PE routers the IWF hosted by the Nokia Siemens Networks A-4100 devices.
When there is a connectivity failure on the working path, the Nokia Siemens Networks Ax200 devices
perform a switchover to the protection path, triggering a topology change notification (in the form of
TLVs carried in CCM) to be sent on the active path.
102
Figure 7: CET inter-op Dual Homed Topology
Figure 7 on page 102 describes the dual homed topology on MX Series PE routers connected to the A-
domain. When an A-domain device triggers a switchover, it starts switching the service traffic to the
new active path. This change is communicated in the HELLO protocol data units (PDUs) sent by that A-
domain device on the working and protection paths. When the IWF in A4100 recieves these HELLO
PDUs, it converts them to standard CCM messages and also inserts a connection protection TLV. The
“Protection-in-use” field of the connection protection TLV is encoded with the currently active path, and
is included in the CCM message. CCM messages are received by the MX Series PE routers through the
VLAN spoke in A4100. In the above dual homed scenario, one MX Series PE router monitors the
working path, and the other MX Series PE router monitors the protection path.
A MAC flush occurs when the CFM session that is monitoring the working path detects that the service
traffic has moved to the protection path or when the CFM session that is monitoring the protection path
detects that the service traffic has moved to the working path.
103
Figure 8: CET inter-op Dual Attached Topology
Figure 8 on page 103 describes the dual attached topology on MX Series PE routers connected to the A-
domain. The MAC flush mechanism used in this case is also the same as the one used for the A-domain
in the dual homed scenario (Figure 1). However in this case both the CFM sessions are hosted by only
one MX Series PE router. When Ax100 in the A-domain detects topology changes, the MX Series PE
router receives the connection protection TLV in the CCM message for the working and protection
paths with the value of “Protection-in-use” indicating which path is the active one. Based upon the
event that is generated for the CFM session, the MX Series PE router will bring down the appropriate
interface which will trigger a local MAC flush.
Configuring a Connection Protection TLV Action Profile
An action profile can be configured to perform the interface-down action based on the values of connection-
protection-tlv in the received CCM packets.
The following example shows an action profile configuration with explanatory comments added:
[edit protocols oam ethernet connectivity-fault-management]
action-profile  {
event {
# If a connection protection TLV with a “Protection-in-use” value of SET is received */
connection-protection-tlv ;
# If a connection protection TLV with a “Protection-in-use” value of RESET is received */
connection-protection-tlv ;
104
}
action {
# Bring the interface down */
interface-down;
}
}
SEE ALSO
connection-protection-tlv
IEEE 802.1ag OAM Connectivity Fault Management | 21
Example: Configuring an Action Profile Based on Connection Protection TLVs
IN THIS SECTION
Requirements | 104
Overview and Topology | 104
Configuration | 105
This example shows how to configure an action profile based on the connection protection TLV for the
purposes of triggering MAC flushes based on topology changes in a CET network.
Requirements
This example uses the following hardware and software components:
• Junos OS Release 11.2 or later
• A MX series PE router
Overview and Topology
IN THIS SECTION
Topology | 105
105
The physical topology of a CET network using MX series PE routers is shown in Figure 9 on page 105
Topology
Figure 9: Topology of CET network
The following definitions describe the meaning of the device abbreviation and terms used in Figure 9 on
page 105.
• Provider edge (PE) device—A device, or set of devices, at the edge of the provider network that
presents the provider's view of the customer site.
• E-domain—Nokia Siemens Networks Carrier Ethernet Switches that run standard based protocols
and are used in the access side.
• A-domain—Nokia Siemens Networks Carrier Ethernet Switches that run legacy protocols.
Configuration
IN THIS SECTION
Procedure | 106
106
Procedure
Step-by-Step Procedure
To configure an action profile based on the connection protection TLV, preform these tasks:
1. Configure an action profile
[edit protocols oam ethernet connectivity-fault-management]
action-profile  {
event {
2. If the connection protection TLV is received with a “Protection-in-use” value of SET, then the