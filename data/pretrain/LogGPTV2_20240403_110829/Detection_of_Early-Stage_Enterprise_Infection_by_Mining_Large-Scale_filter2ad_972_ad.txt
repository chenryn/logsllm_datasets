0
-
0
0
0
1
0
1
2
1
0
-
3
0
1
0
0
1
TABLE II: Results on LANL challenge.
Authorized licensed use limited to: Tsinghua University. Downloaded on March 19,2021 at 08:58:29 UTC from IEEE Xplore.  Restrictions apply. 
VI. EVALUATION ON ENTERPRISE DATA
We implemented a fully operational system running in
production starting from January 1 2014 to process the web
proxies logs from the AC dataset. We use the data collected
in January for training various components of the system
(e.g., the C&C detector, the domain scoring module, etc.)
and proﬁling external destinations and user-agent strings used
by enterprise hosts in HTTP communication. Starting from
February 1 the system enters into the daily operation mode, in
which it processes new web proxies logs, applies normalization
and reduction techniques, compares the data with the proﬁles
(which are also updated) and applies our detection techniques.
The algorithm is ﬁrst run in the SOC hints mode, where
we use malicious domains from the IOC list provided by
SOC as seeds. Second, we run our C&C detector to identify
suspicious domains with automated activities. Third,
these
domains are given as seed to belief propagation in the no-hint
mode. The detection results are thoroughly validated through
a combination of tools and manual analysis. The system is
conﬁgurable with different parameters (e.g., scoring thresholds,
number of iterations in belief propagation, etc.) according
to the SOC’s processing capacity. We present our validation
methodology and the results in different modes of operation.
A. Validation methodology
The domains output by our detector in both modes were
validated as follows. We ﬁrst query VirusTotal and the IOC
domain list to verify their status (three months after they were
detected – to allow anti-virus and blacklists to catch up). If
the domain is alerted upon by at least one scanner used by
VirusTotal or it’s an IOC we consider it known malicious.
For other domains, we collect additional information and hand
them to a security analyst for manual investigation.
Speciﬁcally, the analyst retrieves the associated URLs from
the log data and crawls them to examine the responses. The
URLs are also manually submitted to McAfee SiteAdvisor.
Based on the URLs, the response to our crawler and the
result from SiteAdvisor, the analyst classiﬁes the remaining
domains into four categories: new malicious (e.g., same URL
patterns as known malicious domains, returning malicious
content or ﬂagged by SiteAdvisor), suspicious (not resolvable
when crawled, parked or having some questionable activities),
legitimate (no suspicious behavior or code observed) and
unknown (504 HTTP response code, a sign of server error).
Since we only have a few unknowns (6 in total), we remove
them from the ﬁnal results. When reporting our results we use
the same precision and FPR metrics from Section V-C, and
new-discovery rate (NDR) deﬁned as the percentage of new
malicious and suspicious domains detected by our approach
(and not yet identiﬁed by VirusTotal and SOC). We present
graphs in Figure 7 and statistics of our ﬁndings in Table III.
B. Results for the SOC hints mode
We ﬁrst present results in Figure 7(a) for the belief
propagation algorithm in SOC hints mode seeded with 28
IOC domains. The graph shows the total number of detected
domains and their categories for different domain similarity
score thresholds. We do not include the seed domains in the
ﬁnal results. When computing domain registration features,
SOC hints
Score
Total
0.33
0.37
0.4
0.41
0.45
137
114
91
86
73
79
76
70
69
65
C&C communication
0.4
114
74
0.42
0.44
0.45
0.46
0.48
No hints
0.33
0.5
0.65
0.75
0.85
74
57
46
36
19
265
169
152
135
114
51
41
33
27
15
132
93
88
81
74
Malicious
known
new
Susp.
Legit.
Prec.
NDR
15
15
3
2
1
5
4
3
3
2
1
27
17
16
13
5
14
6
5
5
3
18
9
6
4
3
2
43
24
23
22
18
29
17
13
10
4
17
10
7
6
4
1
63
34
25
19
17
78.8%
85.1%
85.7%
88.4%
94.5%
85.1%
86.4%
87.7%
86.9%
88.8%
94.7%
76.2%
79.3%
83.5%
85.9%
85.1%
21.1%
18.4%
8.8%
8.1%
5.5%
20.1%
17.5%
15.8%
15.2%
13.9%
15.8%
26.4%
24.2%
25.6%
25.9%
20.2%
TABLE III: Statistics and metrics on detected domains.
we can not parse WHOIS information for 27% of domains.
For these domains, we set default values for the DomAge and
DomValidity features at average values across all other domains.
When we vary the domain similarity score threshold be-
tween 0.33 and 0.45, we detect between 137 and 73 domains,
with precision ranging from 78.8% to 94.6%. Among the 137
detected domains, 108 turn out to be malicious (either known
or new) and suspicious, which is about four times larger than
the malicious set of domains used for seeding. The FPR is low
at 3.97 · 10−4% over 7.3M domains.
Among the 108 malicious and suspicious domains, 79 are
conﬁrmed by SOC or VirusTotal, leaving 29 domains as our
new ﬁndings. We inspect the new ﬁndings and identify an inter-
esting group of domains generated through Domain Generation
Algorithm (DGA). Hosts infected with DGA malware generate
a large number of domains (using a predeﬁned algorithm) to
hide the actual rendezvous points with the C&C center, which
is only a handful of the contacted domains. The attacker knows
the DGA algorithm used by the bots, and so only registers
domains to communicate with the bots at speciﬁc times.
This group consists of 10 domains under the top-level
domain (TLD) .info and the name for each domain has
20 characters (e.g., f0371288e0a20a541328.info). Surpris-
ingly, the registration dates for most of the domains are later
than the detection time. This demonstrates that our techniques
have an advantage against attackers by inferring the next
rendezvous point and taking preventive measures early.
C. Results for C&C detector
To evaluate the C&C detector, we compute scores for all
automated domains visited daily. We vary the domain score
threshold for labeling automated connections from 0.4 to 0.48
5353
Authorized licensed use limited to: Tsinghua University. Downloaded on March 19,2021 at 08:58:29 UTC from IEEE Xplore.  Restrictions apply. 
s
n
i
a
m
o
d
d
e
t
c
e
t
e
d
f
o
r
e
b
m
u
N
 140
 120
 100
 80
 60
 40
 20
 0
VirusTotal and SOC
New malicious
Suspicious
Legitimate
0.37
0.33
0.41
Domain similarity score threshold
0.4
0.45
 120
 100
 80
 60
 40
 20
 0
VirusTotal and SOC
New malicious
Suspicious
Legitimate
0.4
0.42
0.44
0.45
0.46
0.48
Automated domain score threshold
 300
 250
 200
 150
 100
 50
 0
VirusTotal and SOC
New malicious
Suspicious
Legitimate
0.33
0.75
Domain similarity score threshold
0.65
0.5
0.85
Fig. 7: Categories of detected domains. (a) SOC hints. (b) C&C communication. (c) No hints.
and present results for domains detected as C&C domains
(with score above the threshold) in Figure 7(b). The results
demonstrate that as we increase the threshold on automated
domain scores from 0.4 to 0.48 the number of domains labeled
as C&C drops from 114 to 19, while precision increases from
85.1% to 94.7%. Though FPR is higher for threshold 0.4 (at
2.33·10−4%), more malicious domains (including 23 new ones
not known to VirusTotal or SOC) are detected.
D. Results for the no-hint case
We ﬁx the automated domain score threshold at 0.4 to
evaluate belief propagation in the no-hint mode. We vary the
domain similarity score threshold from 0.33 to 0.85 and the
result (Figure 7(c)) shows that the number of all detected
domains varies from 265 to 114, with precision ranging from
76.2% to 85.1%. Altogether in the most challenging case
(when no hint
is available), we detect 202 malicious and
suspicious domains in February, associated with 945 hosts.
Though the majority of the detected domains are already
alarmed by SOC and VirusTotal (132 for threshold 0.33), only
13 are reported in the IOC list and the remaining ones are
unknown to the enterprise. More interestingly, we identiﬁed
many new malicious and suspicious domains not known to
the community (a total of 70 new domains for threshold
0.33 resulting in an NDR of 26.4%). This result suggests
that our detector could complement existing security tools by
discovering new suspicious activities. Its main advantage is
that it has the ability to detect new campaigns without traces
of known malicious behavior.