# APT组织的聚类与攻击者活动关联

##### 译文声明
本文为翻译文章，原作者为信安之路，原文发布于信安之路。译文仅供参考，具体内容及含义以原文为准。
**文章作者**：Cherishao（信安之路威胁情报小组成员）/ ThreatPage（信安之路威胁情报小组组长）

在威胁情报分析中，将高级持续性威胁（APT）事件定性，并定位APT组织及其相关攻击活动是一项极其复杂的工作。火眼公司（FireEye）在其威胁研究报告中提出了一种基于“文档（样本）类聚模型”的方法来实现对攻击事件的汇聚和关联。该模型利用词频-逆文档频率（TF-IDF）指标和余弦相似度进行分析，前者用于识别唯一性特征，后者则用来评估相似性。通过将此模型与威胁情报相结合并进行量化处理，能够帮助情报专家发现新的威胁组织，同时根据分析师需求提供可靠的分类结果，从而提高威胁事件分析效率。

## 1. 序言
FireEye长期致力于检测、追踪并阻止攻击者行为。通过对每年数百起调查案例及数千小时的数据分析，FireEye积累了大量关于攻击者常用恶意软件、基础设施、投递机制以及其他工具和技术细节的信息（即战术、技术和程序TTP）。除了已确认特征的50个APT组织和FIN组织外，FireEye还收集了成千上万个尚未归类至特定组织的无特征“集群”。尽管这些集群目前尚未被明确关联到任何具体组织，但随着时间推移，它们对于分组跟踪相关活动仍然具有重要意义。

随着FireEye所掌握信息量日益增长且覆盖面越来越广，开发出一种能够辅助处理海量数据、识别潜在新威胁交叉重叠及组织归属关系的模型或算法变得至关重要。本文旨在概述FireEye构建此类模型所需的数据基础、涉及的主要算法以及未来可能面临的挑战。

## 2. 群集分类介绍
当检测到恶意活动时，FireEye会对其进行标记，并依据标签相似度将其分组为“群集”。这些群集代表了直接攻击行为或一系列攻击活动的一部分，可以是操作模式、基础设施配置或恶意软件等。FireEye称这类未明确分类的群体为“UNC”或“未分类”。随着时间推移，这些群集可能会扩大规模、与其他群集合并，甚至最终形成新的威胁组织如APT33或FIN7。只有当充分理解其在整个攻击生命周期中的运作方式并将之与国家支持项目或犯罪活动相联系后，才能完成这种分级过程。

针对每个群集，FireEye都会生成一份摘要文档，涵盖基础设施、恶意软件文件、通信手段等方面的信息。图1展示了如何利用不同模块化群集记录单个“攻击者”的演变过程。每个群集中——例如“恶意软件”——存在多种条目类型，但都有一个共同点：每种条目都附带计数统计，用以表示使用该术语描述群集的频率。

![图1：攻击者行为变化记录](图1链接)

## 3. 目标方向
FireEye的目标是确定某个威胁是否应归入现有群集之一，或是代表了一个全新的独特威胁实体。截至目前，关于APT组织的聚类与归因决策主要依靠人工分析完成，因为这需要高度精确性和证据支持。然而，随着FireEye收集到越来越多关于攻击者活动的数据，人工分析已成为瓶颈。“未经分析的群集”可能导致潜在关联线索断裂。因此，FireEye引入了基于机器学习的模型来辅助情报分析工作，旨在帮助发现、分析并验证这些群集或威胁组织。FireEye围绕以下三个方向展开研究：

- 在不同群集间创建可解释的单一相似性特征
- 评估过往的分析决定
- 发现新的潜在证据

![图2：突出显示两组之间的观察相似点](图2链接)

## 4. 分析模型简介
FireEye将这种方法应用于所有威胁群集分类，以便大规模地评估群集间的唯一性和相似性。首先，针对每个主题单独建模，这意味着每个主题将在群集之间产生独立的相似度范围，这些范围最终将汇总成总体相似度。

接下来将详细介绍FireEye如何将这种分类方法应用于每个群集。在每个主题内，采用“词频-逆文档频率”（TF-IDF）技术将各个不同的“词汇”转换为数值。TF-IDF是一种常用于信息检索与数据分析领域的加权技术，它通过计算字词在文档中出现次数与其在整个语料库中出现频率之间的比例来衡量其重要性。

- 如果某词汇频繁出现在特定记录中，则增加其权重；
- 若该词汇普遍存在于整个语料库中，则减少其权重。

一些罕见术语可能仅限于少数定制化恶意软件群集内出现，而像“鱼叉式网络钓鱼”这样的常见威胁事件则适用于大多数群集。

图3展示了TF-IDF应用于评估mal.sogu和mal.threebyte两个术语在“UNC599”案例中的度量情况。这两个项表示“恶意软件”主题下SOGU和THREEBYTE的使用情况，我们使用TF-IDF计算其在该主题内的值。第一个（TF）值反映了单项在所有恶意软件样本中的相对出现频率；第二个（IDF）值则是这些术语在整个群集集合中出现频率的自然对数。此外，当IDF接近1时（非常常见的项），其自然对数值趋近于零，从而降低了最终TF-IDF得分。相反，如果IDF较高，则表明该术语较为独特，相应地提高了TF-IDF得分。

![图3：针对恶意软件评估单个组时TF-IDF指标的细分](图3链接)

一旦给每个项分配了分数，每个群集现在就可以被视为由不同主题组成的集合，每个主题都是包含计算得分向量。每个向量都可以想象成箭头，指示了该群集在特定主题空间中的“指向”。

在每个主题空间内，FireEye采用另一种方法——余弦相似度来评估群集间的相似性。这是一种衡量两个向量平行程度的方法。如图4所示，在比较两个群集的恶意软件使用情况时，FireEye绘制了恶意软件向量图，并通过观察它们是否朝同一方向来判断相似性。越平行意味着越相似。

![图4：恶意软件‘空间’中两个群集的余弦相似度简化细分](图4链接)