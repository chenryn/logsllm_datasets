该模式意味着在装载期间不会创建索引。涉及的索引上会作出标记，
LOAD命令关键字解释
第6章数据移动
更多资源请访问www.ckook.com
（续表）
是
备
239
---
## Page 265
240
DUMPFILE=c:\emp.dmp
6.4.3
messages /home/db2inst1/output/load.msgreplace into sales')
循序渐进DB2-
USE
TEMPFILESPATH
STATISTICS USEPROFILE
LOCKWITHFORCE
ALLOWREADACCESS
ALLOWNOACCESS/
LOBSINFILE
2.MODIFIEDBY
1.LOBSFROMpathnames
MODIFIEDBYCHARDELX
MODIFIEDBYCOLDELX
INTOTABLEtablename
LOAD FROM emp.ixf OF IXF
例6-9
可以在命令行中直接调用ADMIN_CMD存储过程导出数据，如下所示：
3.使用ADMIN_CMD存储过程
LOAD命令关键字
装入示例
看看下面这个例子，
—DBA系统管理、运维与应用案例
REBUILD，那么此参数允许在系统临时表空间中重建索引，并在装
入操作的索引复制阶段将其复制回索引表空间
如果正在执行ALLOWREADACCESS装入并且建立索引方式为
并且由DB2实例以独占方式访问
LOAD命令的TEMPFILESPATH参数指定。默认值是数据库路径。
装入操作执行期间创建临时文件时要使用的标准路径。此名称由
操作时，才支持此选项
在装入过程中是否收集统计信息。仅当以REPLACE方式运行装入
完表，还是应该强制其他应用程序释放锁定
装入操作在继续执行之前是应该等待其他实用程序或应用程序使用
能查看装入操作之前表中已存在的数据
ACCESSREADACCESS选项允许您在进行装入操作时查询表。只
在装入操作执行过程中，是否可以查询表中预先存在的数据。
将搜索LOBSFROM路径
个关键字。参数本身包含文件名，但是不包含完整的路径名，因为
寻找LOB文件的路径。要想使用LOBSFROM子句，就必须设置这
用这个字符包围输入的字符数据（默认设置是双引号）
在所有输入数据中以这个字符分隔各个列（默认设置是逗号）
要存储数据的目标表
它演示了一个装载过程中涉及的步骤：
LOAD命令关键字解释
更多资源请访问www.ckook.com
(续表)
---
## Page 266
createtable friendsc1 INT NOT NULL,2INT,3 CHAR(8)|)
的行。如果装载成功完成，那么在D：tmp中生成的临时文件将自动被删除。
EMPEXP中。这是因为它们违反了EMPLOYEE表中第一列的唯一性约束。
行（20和40)，因为它们不符合NOTNULL和NUMERIC列定义。由于指定了DUMPFILE修
列创建的。
省TEMPFILES PATHd:AtmpINSERT INTO employee FOR EXCEPTION empexp
饰符，因此这两行的数据被记录在C：emp.dmp文件中。
在删除阶段，标为黄色的两个行（30和50）被从EMPLOYEE中删除，并插入到异常表
在装载阶段，输入文件中的所有数据被装载到EMPLOYEE中，除了标为粉色的两个
在装载的最后，您应该检查消息文件、转储文件和异常表，然后决定如何处理被拒绝
23,24,bobby
4,,mary
如果尝试将下列数据记录装入到表中：
表FRIENDS的定义如下所示：
例6-10（使用转储文件）
(3）中显示的异常表EMPEXP是使用和EMPLOYEE相同的列，再加上时间戳和消息
第一列必须是唯一的。最后一列是一个数值列，且不能为NULL。
(2）中显示的目标表EMPLOYEE是用以下列定义创建的：
（1）显示了输入源文件的内容。
在图6-13中
(1)emo.ixf
10-1
40
Input
D
一
一
X
unique
80~8
10
Table
11
图6-13装载过程
30
1
(3)empexp
Exception table
tmestampmsg
timestamp
Bsw
requirements
astcolumn
30
emp.dmp
第6章数据移动
更多资源请访问www.ckook.com
241
---
## Page 267
242
P和该插入列列表省略。
ofcursor...
1oad frommycursor of cursor method P(1,2,3）insert inta dev.table2(one,two,three)
列中22后面的某些数据。不会拒绝该记录。
"sdf”。不会拒绝该记录。另一个示例：
DEL格式不一致的初始字符的列将生成错误，将拒绝该记录。您可以将此类记录写入转储
循序渐进DB2——DBA系统管理、运维与应用案例
文件。
223,34,bob
THREEDATE
TWOCHAR(10)
ONEINT
表DEV.TABLE1有3列：结构如下
4.DEV.TABLE1可以是表、视图、别名或昵称。
3.在此示例中，由于插入列列表（one，two，three)表示默认值，所以可以将METHOD
2.对于从游标装入来说，有效的METHOD值只有P和N。
LOAD实用程序将装入22，34，"bob"并生成一条警告消息，该消息指出忽略了第一
LOAD实用程序将在表的第三列中装入"sam"，并且将会在一条警告消息中标记字符
1.在单个LOAD命令中只指定了一个游标名。即，不允许loadfrommycursl，mycurs2
24,55,"sam" sdf
22,34,"bob"
在下面这个示例中，将忽略字符定界符外部的DEL数据，但会生成警告。例如：
注意：
以下命令将DEV.TABLE1中的所有数据装入到DEV.TABLE2中：
游标MYCURSOR是按以下方式定义的：
假定源表和目标表位于同一数据库中，并且它们的定义如表6-5所示。
例6-11（从CURSOR装入）
将拒绝第二行，这是因为第一个INT是NULL，但列定义指定了NOTNULL。包含与
表6-5源表和目标表的结构
表DEV.TABLE2有3列：结构如下
THREEDATE
TWO CHAR(10)
ONEINT
更多资源请访问www.ckook.con
---
## Page 268
动或终止先前失败的对此表的LOAD操作。
作之前不允许对表进行存取。
装入该行。
中第一列数据类型为数字并等于320的行替换为："abcf”，“aaa"，"sdfg”，执行下列命令：
录出错也不行。在这种情况下，可以使用WARNINGCOUNT选项。把输入文件staff.txt
SELECTFROM STAFF1
LOAD FROM D:\STAFF.TXT OF DEL TERMINATE INTO STAFF1
解决方法为：通过分别发出带有RESTART或TERMINATER选项的LOAD来重新启
SQL3118W在行“32列1"中的字段值不能转换为SMALLINT值，但是目标列不可为空。未
包含TERMINATER的LOAD命令可以终止装入进程，使目标表恢复正常可用状态：
SQL0668N由于表USER.STAFF1上的原因代码3所以不允许操作。
此时无法对表STAFF1进行操作，例如：
包含RESTART的LOAD命令可以在源文件修改正确的时候使用，使装入进程重新
会返回：
SQL3185W
运行结果包含下面的警告：
在某些情况下，文件中的数据必须全部成功输入到目标表中才算成功，即使有一条记
SQL3502N
例6-13出现警告信息时强令装入操作失败。
staff.txt文件是我们从表staff中导出的DEL格式的文件。
注意：
用ROWCOUNT选项可以指定从文件开始处装入的记录数。例如，导入前3条记录。
例6-12限制装入行数。
NAME
实用程序遇到了”1”个警告，它超过了允许的最大警告数。
当处理输入文件的第32”行中的数据时发生先前的错误。
DEPT
JOB
YEARS
COMM
在重新启动或终止LOAD操
第6章数据移动
更多资源请访问www.ckook.com
243
---
## Page 269
244
时不允许对表数据进行访问，这个锁直到LOAD完成才释放。
的示意图。
访问表中已有的数据，但是不能访问新装载的那部分数据。图6-14是在线和离线LOAD
ONLY状态。ALLOWREADACCESS选项导致被装载的表以共享的方式锁定。我们可以
载的数据。这个选项使正在装载数据的表处于LOADINPROGRESS状态和READACCESS
有指定该选项，默认是ALLOWNOACCESS，此选项在装载完成之前，不能访问正在装
增强LOAD的可用性，我们可以指定LOAD的一个选项ALLOWREADACCESS。如果没
并且LOAD所在的表空间也处于LOADPENDING状态而无法访问。在DB2V8以后为了
6.4.4在线LOAD
DEXESALL
器确定最有效的执行SQL语句的方式。可以对表和索引产生不同详细程度的统计数据。
的效率。打开STAFF.TXT文件，把第一列等于320的行替换为：“abcf"，“aaa"，"sdfg”。
出现大量警告信息，而用户对此又不感兴趣时，可以使用该选项，这样可以大大提高装入
开始：
循序渐进DB2—DBA系统管理、运维与应用案例
通过图6-14我们可以看到ALLOWNOACCESS选项以独占方式锁定表，在装入该表
ISTRIBUTION AND DETAILEDINDEXES ALL
在DB2V8之前，当一个表被装载时，LOAD实用程序用一个超级排它锁将它锁定。
LOAD FROM D:\STAFF.TXT OF DEL REPLACE INTO STAFFI STATISTICS YES WITH D
对表和索引都产生简略的统计数据：
对表和索引产生最详细的统计数据：
使用STATISTICS选项可以在装入的过程中生成统计数据，这些统计数据可以供优化
例6-15生成统计数据。
运行结果中，第32行出错，该行无法装入，但是不产生警告信息。
使用NOROWWARNINGS文件类型修饰符可以禁止产生警告信息，当装入过程可能
例6-14防止产生警告信息。
更多资源请访问www.ckook.com
---
## Page 270
实数据前发生延迟。LOCKWITHFORCE选项用来强制有冲突的应用程序释放锁定，这样
定)。LOAD实用程序将等待所有对该表挂起了锁定的应用程序释放那些锁定。这会导致落
发生冲突。尝试读取目标表中现有数据的新应用程序也能够成功地完成操作。
后，任何对该表请求读访问锁定的应用程序都将获得该锁定，而不会与这个特殊的Z锁定
设置阶段、释放该锁定并进入装入阶段。在ALLOWREADACCESS方式的装入操作启动
装入操作就会强制其他应用程序释放锁定以避免超时。装入操作获取特殊的Z锁定、落实
等待时间长度由locktimeout数据库配置参数确定。如果指定了LOCKWITHFORCE选项，
装入操作在发生超时和失败之前将等待一段有限的时间，以允许这个不兼容的锁定被释放。
果某个应用程序在装入操作请求这个特殊的乙锁定前，对该表挂起了不兼容的锁定，那么
问机制。
始和操作结束时以外，都允许进行读访问。下面我们详细讲解ALLOWREADACCESS访
访问，但允许对预先存在的数据进行读访问。在装入操作的整个执行过程中，除了操作开
应用程序强制离开。ALLOWREADACCESS选项不允许其他应用程序对该表进行任何写
锁释放出来，可以使用LOAD命令中的LOCKWITHFORCE选项，使持有冲突锁的其他
序已经锁住了目标表，那么LOAD实用程序就必须等到这些锁被释放。为了不必等到一个
首先，在设置阶段接近结束时，装入操作将获取特殊的Z锁定并占用一小段时间。
其次，在装入操作结束时，LOAD实用程序在落实数据之前对该表获取互斥锁定（Z锁
对于ALLOWREADACCESS选项我们看到，当我们开始LOAD时，如果某个应用程
?ALLOWREADACCESS
ALLOWNOACCESS
requested
Drain
Lock
图6-14在线和离线LOAD
Lock
oadalloy
al
Time
WS
ume
read
exclusive
Super
lock
adns
commit
Load
更多资源请访问www.ckook.com
第6章
comm
Load
数据移动
如
245
---