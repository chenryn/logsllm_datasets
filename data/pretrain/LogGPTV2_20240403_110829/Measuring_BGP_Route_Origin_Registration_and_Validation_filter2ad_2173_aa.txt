title:Measuring BGP Route Origin Registration and Validation
author:Daniele Iamartino and
Cristel Pelsser and
Randy Bush
Measuring BGP Route Origin Registration
and Validation
Daniele Iamartino1,2(B), Cristel Pelsser1, and Randy Bush1
1 Internet Initiative Japan, Tokyo, Japan
2 Politecnico di Milano, Milano, Italy
PI:EMAIL
Abstract. BGP,
the de-facto inter-domain routing protocol, was
designed without considering security. Recently, network operators have
experienced hijacks of their network preﬁxes, often due to BGP mis-
conﬁguration by other operators, sometimes maliciously. In order to
address this, preﬁx origin validation, based on a RPKI infrastructure,
was proposed and developed. Today, many organizations are registering
their data in the RPKI to protect their preﬁxes from accidental mis-
origination. However, some organizations submit incorrect information
to the RPKI repositories or announce preﬁxes that do not exactly match
what they registered. Also, the RPKI repositories of Internet registries
are not operationally reliable. The aim of this work is to reveal these
problems via measurement. We show how important they are, try to
understand the main causes of errors, and explore possible solutions. In
this longitudinal study, we see the impact of a policy which discards route
announcements with invalid origins would have on the routing table, and
to a lesser extent on the traﬃc at the edge of a large research network.
1 Introduction
Mis-originations, an Autonomous System (AS) announcing an IP preﬁx to which
it has no rights, regularly appear in the Internet. Sometimes they arise from BGP
misconﬁgurations. They may also result from malice. A notorious preﬁx mis-
origination was the “YouTube incident” [9] where Pakistan Telecom advertised
one of YouTube’s IPv4 preﬁxes. The original intent was to censor traﬃc from
Pakistan destined to YouTube. However, when PT “leaked” the preﬁx to the
world, the event had a much larger impact than desired; traﬃc destined YouTube
was blackholed at global scale. A more recent example is the “Indosat event”
[17,19]. In April 2014, Indosat originated 417,038 preﬁxes normally announced by
other ASs. This is believed likely due to a mis-conﬁguration, a maintenance event
gone bad [17]. In August 2014, a bitcoin miner [16] was attacked with the goal
of diverting the traﬃc from the miners to relay the result of their computation
and divert the monetary beneﬁt of their work. The attack on bitcoin miners was
malicious. This last example shows the limitations of route origin validation.
Attackers will ﬁnd another way to perform the attack if route origin validation
is widely deployed.
c(cid:2) Springer International Publishing Switzerland 2015
J. Mirkovic and Y. Liu (Eds.): PAM 2015, LNCS 8995, pp. 28–40, 2015.
DOI: 10.1007/978-3-319-15509-8 3
Measuring BGP Route Origin Registration and Validation
29
In the current taxonomy, there are three pieces to improving BGP security,
the RPKI, RPKI-based origin validation, and in the future path validation. In
this paper, we focus on RPKI and RPKI-origin validation.
The RPKI is an X.509 based hierarchy congruent with the Internet IP
address allocation administration, the IANA on top, then Regional Internet
Registries (RIRs), and ISPs, . . . It is the substrate on which origin and path
validation are based. It is currently deployed by all ﬁve RIRs, AfriNIC, APNIC,
ARIN, LACNIC, and RIPE.
RPKI-based origin validation uses RPKI data to allow routers to verify
that the AS originating an IP preﬁx is in fact authorized to do so. This is not
crypto checked, as a BGP update message does not carry signatures, so can be
violated. But it should prevent the vast majority of accidental’hijackings’ on the
Internet today, e.g. the Pakistani accidental announcement of YouTube’s address
space. RPKI-based origin validation is in shipping code from Cisco and Juniper,
and others soon.
A Route Origination Authorization (ROA) is an RPKI object which
veriﬁably asserts that a speciﬁed AS is authorized to originate BGP announce-
ments for a given set of preﬁxes [15]. A ROA is composed of an AS number, a list
of IP preﬁxes, and for each preﬁx, a maximum length. The maximum length is
a macro to authorize the AS to advertise more speciﬁc preﬁxes than the original
preﬁx, up to the length as speciﬁed.
It is important to understand the status of deployment of route origin valida-
tion. For this purpose, we have been collecting data from the RPKI infrastructure
since April 2012. Here we analyse these data to show the scale of deployment of
ROA registrations. We ﬁnd that registration is signiﬁcantly deployed in Europe
and Latin America, but is extremely poorly deployed in north America, Asia/
paciﬁc, and Africa. We illustrate some of the events that occurred while publish-
ing entities, the RIRs, learned to operate the RPKI system. There were serious
problems regarding reliability of the RIR’s RPKI infrastructure. Overall, it var-
ied from bad to acceptable.
The incentive for operators to register ROAs is high, as it protects their
resources. In order for this to be eﬀective other operators need to deploy route
origin validation in their ASs. That is, their routers need to check the validity of
each route’s origin. The drive to do this is multifold. It protects one’s customer
traﬃc from following a bogus/malicious route and it protects one’s infrastructure
from accepting many more routes than usual from a given peer (this can lead
to a session reset or the restart of the router). It will also become common good
practice, on the same level as preﬁx ﬁltering, in that the eﬀect of misconﬁgura-
tions are contained close to the source of the event instead of aﬀecting the entire
Internet infrastructure. The second part of our study focuses on the validation
of routes based on the registered ROAs. We take the views from public BGP
monitors [8], and study the evolution of route origin validity over a 2.5 year time
period with the objective to show that mis-origination occurred and could have
been detected. In addition, we are interested in mis-matches between informa-
tion registered in the RPKI and advertised routes. We try to understand these
30
D. Iamartino et al.
as they may highlight misunderstanding of the technology by network operators
or poor tools or controls at the publishers. Does the validity of a route depend on
the location where the advertisement is received? We try to answer that question
next by looking at the validity status of routes at multiple locations.
Among the invalid preﬁxes, 81 % are covered by a valid preﬁx or a preﬁx
not registered in the RPKI. A network operator strictly enforcing route-origin
validation would not drop many preﬁxes. 54 % of the invalid preﬁxes result from
a mis-match between the preﬁx length and the MaxLength in the ROAs. The
other major issue results from ISPs not helping their multi-homed customers to
register their sub-allocations.
Last, performing route origin validation means BGP routes selected by
routers may change and thus can aﬀect traﬃc forwarding. We try to understand
the traﬃc impact by looking at the statistics of an operational router within an
American research network. The router counts traﬃc forwarded by routes with
valid, notfound, and invalid origin. This tells us the amount of traﬃc that would
be dropped by the router should diﬀerent BGP policies be adopted. It shows that
if an operator was to conﬁgure its routers to strictly drop routes with invalid
origin, the eﬀect on the traﬃc would be negligible.
The paper is organized as follows. We describe our methodology and data sets
in Sect. 2. In Sect. 3 we look ﬁrst at the extent of RPKI ROAs publication across
the diﬀerent administrative regions. Second, we study the diﬀerent causes of mis-
match between route advertisements and RPKI registrations. Third, we present
traﬃc statistics for each class of routes (valid origin, invalid, and unknown).
We present some related work in Sect. 4, and conclude in Sect. 5.
2 Methodology
2.1 Validation Process
As we are analyzing historical data, to determine the validity of a BGP route
advertisement at some point in time, the ﬁrst step is to get all the published
ROAs for a given time and build a radix tree. The radix tree will then be used
to validate the route entries of subsequent BGP RIB dumps.
Each ROA ﬁle is composed of an AS number, multiple IP preﬁxes, and a
maximum length for each preﬁx. For all X.509 validated ROA ﬁles, we extract
tuples (ASN, Preﬁx, MaxLen, Expiration time). We insert these tuples as nodes
of a radix tree where the key is the IP Preﬁx of the tuple. That is, each node of
the radix tree is identiﬁed by the IP preﬁx that it is covering. Note that more
than one ROA record might exist for a particular preﬁx. Consequently, each
node may contain more than one ROA record.
After building the radix tree, we take the BGP RIB dump following the down-
load of the ROAs from the RPKI infrastructure, and before the next download
of ROAs. We validate the content in each RIB dump separately. Each dump
gives us a view of the validity at a diﬀerent point in time. For each announce-
ment found in a RIB dump, we search for the longest preﬁx match in the radix
tree. If no such node is found, we mark the announcement as “ROA not found”.
Measuring BGP Route Origin Registration and Validation
31
Then, for each ROA present in the node, we check if the max length of the node
covers the announced preﬁx and if the AS number speciﬁed in the ROA record is
equal to the origin AS number of the announcement. If these conditions are met,
the ROA validates the route announced for the preﬁx. If no validating ROA is
found in the given node, we traverse upward to shorter preﬁxes until we either
ﬁnd a validating ROA or there is no parent node. If we moved upward in the
tree and never found a matching ROA, the route is marked as invalid, else its
origin AS is deemed valid.
In a RIB dump, there may be multiple announcements for a single preﬁx,
as a monitor may learn the same preﬁx from diﬀerent BGP peers. We validate
each announcement separately.
2.2 Datasets
This study relies on a number of datasets: (1) the download of ROAs from the
RPKI infrastructure every hour from March 2012 to August 2014, (2) BGP RIB
dumps from RouteViews [8] for the same period. RouteViews RIB dumps are
available every two hours, and (3) the marked statistics taken from a live router
in a research network. We perform most validation on the LINX RIB dumps.
To determine the sensitivity of route origin validity at diﬀerent locations we also
consider the ISC, Sao Paulo, Sidney, and WIDE RouteViews monitors.
Regarding the ﬁrst dataset, as the IANA has not been allowed to provide an
RPKI root, we chose trust anchors following the recommendation of the IETF
SIDR working group [15], using the rcynic tool [7] to download ROAs from the
RIPE, LACNIC, AfriNIC, APNIC and CA0 trust anchors, with two exceptions;
for legal reasons, we only have ARIN data starting from August 2014 and we
add the CA0 data. ARIN has a policy of providing access to the data only to
those who have signed a document. CA0 is the trust anchor for some legacy and
experimental address space that ARIN will not register.
As ROAs can not cover AS-SETs, we excluded from our study the minuscule
portion of BGP announcements which have an AS-SET for the origin AS.
When we validate the origins of advertisements in a RIB dump, we take the
ROAs gathered during the rcynic run prior but closest in time to the time-stamp
of the RIB dump.
3 Results
3.1 RPKI Deployment
First we look at the extent of RPKI registration deployment. Table 1 shows the
number of IPv4 host addresses (/32 s) covered by ROAs by each RIR publication
point. The 3rd column shows the total number of IPv4 addresses delegated by
each RIR. We observe that while ARIN has allocated most of the address space,
it lags far behind the other Northern RIRs in registrations, giving many North
Americans a distorted view of RPKI deployment. The same is true for APNIC.
32
D. Iamartino et al.
Table 1. Deployment status of the registration of IPv4 addresses on September 8, 2014
(data from [1]) compared to the allocation of IPs by these RIRs on the same day [2–6].
Publication Number of IPv4 addresses Number of IPv4 Percentage
point
covered by a ROA
allocated
coverage
RIPE NCC 125,133,312
ARIN
30,187,520
LACNIC
19,089,408
AfriNIC
APNIC
Total
2,814,464
744,960
177,969,664
797,906,680
15.68 %
1,733,372,928
1.74 %