● Interface for adding functionality to Asterisk
● Cross-Language
– Perl
– C
– PHP
– Whatever you want...
● Allows programs to communicate to asterisk via 
STDIN and STDOUT
● Second-best thing since sliced bread
A simple AGI program
#!/bin/bash
#
# Simple agi example reads back Caller ID
#
# Written by: Black Ratchet 
#
# Suck in the variables from asterisk
declare -a array
while read -e ARG && [ "$ARG" ] ; do
array=(` echo $ARG | sed -e 's/://'`)
export ${array[0]}=${array[1]}
done
checkresults() {
while read line
do
case ${line:0:4} in
"200 " ) echo $line >&2
return;;
"510 " ) echo $line >&2
return;;
"520 " ) echo $line >&2
return;;
*      ) echo $line >&2;;   #keep on reading those Invalid command
#command syntax until "520 End ..."
esac
done
}
# Say the user's Caller ID
echo "STREAM FILE yourcalleridis \"\""
checkresults
echo "SAY DIGITS " $agi_callerid  "\"\""
checkresults
How it works...
Connection
“agi_callerid: 3115552368”
“STREAM FILE agi-yourcalleridis”
“Your caller ID is...”
“200 result=0”
“200 result=0”
“200 result=0”
“SAY DIGITS “3115552368”
“3...1...1...5...5...5...2...3...6...8...”
Disconnection
HANGUP
“200 result=0”
Caller
AGI Script
Asterisk
Asterisk::AGI
● Perl module that simplifies AGI programming
– Takes care a lot of the 'dirty work'
– “Doing the work so you don't have to”
● Allows the AGI interface to be controlled via an 
object interface
● Rather old; not very well maintained
● Allows AGI to easily integrate with Perl, which 
easily integrates with almost everything in the 
known universe. 
● http://asterisk.gnuinter.net/
A simple AGI program 
w/Asterisk:AGI
#!/usr/bin/perl
#
# Simple AGI example that says the Caller ID w/Asterisk::AGI
#
# Written by: Black Ratchet 
#
use Asterisk::AGI;
$AGI = new Asterisk::AGI;
# Suck in the variables from asterisk
my %input = $AGI->ReadParse();
# Speak the user's caller ID (If they have one)
if ($input{'callerid'}) {
$AGI->stream_file('yourcalleridis');
$AGI->say_digits($input{'callerid'});
}
Wow... That was easier...
Interacting with your script - Input
● Touch Tone
– Basic
– Ubiquitous
– Easy
– Limited
● VXML
– eXtensible
– No native support
– SIPxPBX
– Numerous Commerical offerings
Interacting with your script - Output
● Text to Speech
– Festival
● Native Support
● Free
● Sounds like crap
– Cepstral
● Can easy be integrated
● Sounds great
● Not free, but cheap
Interacting with your script - Output
● Recordings
– Do it yourself
● Free
– Allison Smith
● For pay
● Lots of canned sayings
A slightly more complex script...
#!/usr/bin/perl
#
# Simple agi example that demonstrates input and output
#
# Written by: Black Ratchet 
#
use Asterisk::AGI;
$AGI = new Asterisk::AGI;
while (1){
$input = chr($AGI->stream_file('seeandsay/menu','123'));
if ($input eq "1"){
$AGI->stream_file('seeandsay/ratchet');
}elsif($input eq "2"){
$AGI-> stream_file('seeandsay/cepstralsays');
$AGI-> stream_file('seeandsay/cepstral');
}elsif($input eq "3"){
$AGI-> stream_file('seeandsay/allisonsays');
$AGI-> stream_file('seeandsay/allisonhello');
}
}
(intermission)
Part II(a):
Cool Applications
(or... what can I do with this thing?)
Caller ID Spoofing
● Asterisk allows you to set your own Caller ID, 
much like a PRI
● Certain PSTN termination providers will also set 
your Calling Party Number of your SS7 IAM to 
this number as well
● Most switches blindly accept this information, 
some more then others
– 5ESS – Caller ID
– DMS-100 – Caller ID
– GTD-5 – Caller ID with Name
Caller ID & CPN Spoofing uses...
● Confuse and Amuse your friends
– How many times have you received a call from 
“Simpson, Homer J” ?
● Activate your neighbor's credit card
● Charge calls to people you don't like
– Slightly more complex
– Requires certain phone equipment to be misconfigured
– Easiest way to do this is via a certain company's calling 
card
Caller ID & CPN Spoofing uses...
● Own Paris Hilton's voice mail
– T-Mobile upgraded their system, but is still vulnerable
● Social Engineering
– Because hey... Caller ID is always right... right?
Simple Caller ID Spoofing Scripts
● Nick84
– http://www.rootsecure.net/
● NotTheory
– http://www.bellsmind.net/
Backspoofing
● Related to Caller ID Spoofing
● Relatively new concept
– NotTheory - http://www.bellsmind.net/
– Natas - http://www.oldskoolphreak.com/
– Vox - http://xscans.united.net.kg/
● Fools the phone company into providing the name 
associated with a telephone number
– Listed and Unlisted
Backspoofing
● How it works
– Spoof Caller ID to yourself
– Your LEC looks up the number in its Caller ID 
database (CNAM)
– You get the name associated with that number
Backspoofing Uses
● Prescanning
– Allows you to prioritize the more interesting phone 
numbers.
● “NET - 5ESS”
● “OFC# 897 TEST L”
● “VERIZON INFORMA”
● “CIA, INTERNATION”
● “BOOZE”
● “UNCLAIMED MONEY”
● Uber-cheap reverse lookup
● Figure out celebrities' cell phone numbers
– Lindsay Lohan
– Nikki Hilton
Backspoofing
Super Caller ID
● Extrapolates tons of useless data from a telephone 
number
– Name and address from whitepages.com
– Switch information from LERG
● Runs on its own dedicated WYSE 150
● Hacked up in an hour by Strom Carlson
● A less customized version (non-LERG) available 
at http://www.oldskoolphreak.com/
Super Caller ID
Rigging Radio Contests...
● Radio stations have a 'hunt group' for their contest 
lines
– Hunt group – A single telephone number that 'hunts' 
for free wire pairs on a switch.
– Back in the day, crackers would busy out hunt line at 
the switch, disallowing the public to call it, while 
calling the individual lines directly
– Result: They win, public loses, line is re-enabled back 
after the contest, everyone is none the wiser.
– Dark Dante (Kevin Poulsen) used this method to win a 
Porsche
Tipping the scales in your favor...
● Shouts to Natas & NotTheory
● Certain providers allow numerous simultaneous 
outbound calls (hundreds in some cases)
– DS1 = 24 calls
– DS3 = 672 calls
● Radio station hunt groups can have around 20 lines 
on their hunt group
● What happens if they are suddenly inundated with 
300 calls?
– Won't guarantee a win, but will definitely increase your 
chances
How it works
Still some problems
● After you win, calls that are still in the queue will 
connect to the bridge if answered.
– Radio Station Guy 1: “Hey! You win”
– You: “Phonetastic!”
– Radio Station Guy 2: “Hey, we already have a 
winner!”
– Radio Station Guy 1: “Whaaaa?!”
● No easy way to fix this (?)
Other possible uses
● Rigging telephone voting contests
● Telephone DoS
● Telling PBS to wrap up their pledge break and get 
back to Red Dwarf
● Busying out lines
● Racking up 800 number charges
Nmap-by-phone
● Simple script that allows you to port scan from 
your phone
● Scan a computer from any payphone in the world
● Impress your friends
● Own microsoft.com while driving to work
● Almost but not entirely useless beyond the 
coolness factor
Your own personal assistant
● Read your e-mail over the phone
– Can't dictate messages (Yet)
● Not as cool as WildFire or Webley
– http://www.wildfire.com/
– http://www.webley.com/
● Insanely cheaper than wildfire or Webley
● VXML would make this much much cooler
Part II(b) DEFCON by phone
DEFCON by Phone
● Problem: Massive Def Con Schedule
– Hard to memorize
– Times and locations change
– “Was that presentation on Friday or Saturday?”
– “Crap! I missed So-and-So's presentation!”
– This is 2005! Who really wants to carry around a 
schedule made of dead trees?
DEFCON by Phone (cont.)
● Solution: Def Con By Phone!
– Allows searching of Def Con schedule
– Reminds users when presentations start
● Reminders can be set for up to one hour before a 
presentation, allowing the user to get in line.
– Alerts users to when a presentation changes
– Allows users to keep “in touch” with the con despite 
their location (IE: Blackjack Tables!)
– Allows users to get their very own phone call from 
Strom Carlson, phone phreak extrodanaire!
DEFCON by Phone (cont.)
● Features
– Search available to anyone that calls
– Quick reminder (Tells user what is coming in the next 
hour)
– User Registration
– Registered users can:
● Add reminders
● Delete reminders
● Be notified if event venues or times change
● Be notified if events are cancelled
DEFCON by Phone (cont.)
● How it works
– Database driven (Duh)
– Over 250 audio clips
– AGI handles user registration, searching, and 
reminders.
– Daemon checks for reminders every 10 seconds and 
generates callfiles for reminders
● Limited only by bandwith (100Mbps) and the PSTN 
termination provider (hundreds of calls)
– Web interface controls the addition of events and 
changing times of presentation.
Defcon By Phone Demo
Code and assorted info available at
http://www.blackratchet.org/
http://www.stromcarlson.com/
Part III:
Caveats
(or, why asterisk sucks)
TDM Card Flakiness
● Connecting an FXS module to a real telephone line 
can be dangerous
– If the phone line rings, the FXS module is toast
● Cards sometimes go crazy for no apparent reason
● Drivers are not entirely bug-free
Code Restrictions
● Asterisk is GPL
● All code contributed to Asterisk is owned by 
Digium
– You waive your rights
– You don't own your code
– They need to have your wavier on record to contribute
● Digium does have commericial options (?)
Termination Issues
● Proper call progression
– Supported in protocols
– Some providers (notably VoipJet) don't support it
– Tough luck if you want to hear intercepts
● Most providers have nowhere near 99.999% uptime
– Broadvoice had a large outage both inbound and 
outbound
● Some providers 'lose' your registration, requiring a 
kick to Asterisk
Part IV:
Q&A
Q&A by phone!
Call on in!
Harass us from your hotel room!
1-800-4-CATSEX
Further Reading and Resources
● http://www.asterisk.org/ 
● http://www.blackratchet.org/ 
● http://www.digium.com/ 
● http://www.stromcarlson.com/ 
● http://www.voip-info.org/ 
● http://www.voipsupply.com/