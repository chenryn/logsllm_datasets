a protocol framework, and that its scope does not extend to
issuer checks. We would argue that for any protocol speciﬁ-
cation to be valid, it must necessarily include statements of
checks that must be performed by each party on the protocol
messages. In the absence of named speciﬁcation authors
who accept responsibility, we feel
is fair to attribute
responsibility to the “Chip and PIN” system, which is after
all a marketing term that covers a whole speciﬁcation stack.
it
X. CONCLUSION
We have shown how the PIN veriﬁcation feature of the
EMV protocol is ﬂawed. A lack of authentication on the
PIN veriﬁcation response, coupled with an ambiguity in the
encoding of the result of cardholder veriﬁcation as included
in the TVR, allows an attacker with a man-in-the-middle
to use a card without the correct PIN. This attack can be
used to make fraudulent purchases on a stolen card. We
have shown that the live banking network is vulnerable by
placing a transaction using the wrong PIN, with every major
UK bank and foreign banks too. The records indeed falsely
show that the PIN was veriﬁed, and the money was actually
withdrawn from an account.
Attacks such as this could help explain the many cases in
which a card has supposedly been used with the PIN, despite
the customer being adamant that they have not divulged it.
So far, banks have refused to refund such victims, because
they assert that a card cannot be used without the correct
PIN. This paper shows that their claim is false.
We have discussed how this protocol ﬂaw has remained
undetected; not only are the public speciﬁcations complex,
but they also fail to specify security-critical details. Finally,
we have discussed ways in which this vulnerability may
be ﬁxed by issuer banks, while maintaining backwards
compatibility with existing systems. However, it is clear that
the EMV framework is seriously ﬂawed. Rather than leaving
its member banks to patch each successive vulnerability,
the EMV consortium must start planning a redesign and an
orderly migration to the next version. In the meantime, the
EMV protocol should be considered broken. We recommend
that the Federal Reserve should resit pressure from banks to
allow its deployment in the USA until it is ﬁxed.
ACKNOWLEDGMENTS
We thank the anonymous reviewers, Colin Whittaker, and
the contributors to the Light Blue Touchpaper blog for their
comments. We also thank the merchants and cardholders
who allowed us to carry out experiments, and Markus Kuhn
for photography assistance. Steven Murdoch is funded by
the Tor Project and employed part-time by Cronto Ltd.
443
[12] “BLADOX Turbo SIM,” March 2010. [Online]. Available:
http://www.bladox.com/
[13] Standard 70, Book 2 – Card Acceptor to Acquirer Interface
Standards: Messages, Data Elements and Code Values for
Real-time Systems, The UK Cards Association, October 2009.
[14] L. Gong and P. Syverson, “Fail-stop protocols: An approach
to designing secure protocols,” in International Working Con-
ference on Dependable Computing for Critical Applications,
September 1995, pp. 44–55.
[15] T. Dierks and C. Allen, “The TLS protocol,” IETF, RFC 2246,
January 1999.
[16] “Job v Halifax PLC, case number 7BQ00307, commentary
by Alistair Kelman,” in Digital Evidence and Electronic
Signature Law Review, vol. 6.
Pario Communications,
November 2009, ISBN 0-9543245-9-5; see also http://www.
alikelman.com/jobhbos.pdf.
[17] S. J. Murdoch, “Reliability of chip & PIN evidence in banking
disputes,” in Digital Evidence and Electronic Signature Law
Review, vol. 6. Pario Communications, November 2009, pp.
98–115, ISBN 0-9543245-9-5.
[18] E. V. Herreweghen and U. Wille, “Risks and potentials of
using EMV for Internet payments,” USENIX Workshop on
Smartcard Technology, May 1999.
[19] R. Anderson, M. Bond, and S. J. Murdoch, “Chip and spin,”
March 2005. [Online]. Available: http://www.chipandspin.co.
uk/spin.pdf
[20] S. Drimer and S. J. Murdoch, “Keep your enemies close: Dis-
tance bounding against smartcard relay attacks,” in USENIX
Security Symposium, August 2007.
[Online]. Available:
http://www.usenix.org/events/sec07/tech/drimer/drimer.pdf
[21] S. Drimer, S. J. Murdoch, and R. Anderson, “Thinking
inside the box: system-level failures of tamper prooﬁng,” in
IEEE Symposium on Security and Privacy (Oakland), May
2008, pp. 281–295. [Online]. Available: http://www.cl.cam.
ac.uk/∼sd410/papers/ped attacks.pdf
[22] R. Anderson, “Chip and PIN is broken,” Light Blue
Touchpaper, February 2010. [Online]. Available: http://www.
lightbluetouchpaper.org/2010/02/11/chip-and-pin-is-broken/
REFERENCES
[1] EMV – Integrated Circuit Card Speciﬁcations for Payment
Systems, Book 1: Application Independent ICC to Terminal
Interface Requirements, Version 4.2 ed., EMVCo, LLC, June
2008.
[2] EMV – Integrated Circuit Card Speciﬁcations for Payment
Systems, Book 2: Security and Key Management, Version
4.2 ed., EMVCo, LLC, June 2008.
[3] EMV – Integrated Circuit Card Speciﬁcations for Payment
Systems, Book 3: Application Speciﬁcation, Version 4.2 ed.,
EMVCo, LLC, June 2008.
[4] EMV – Integrated Circuit Card Speciﬁcations for Payment
Systems, Book 4: Cardholder, Attendant, and Acquirer In-
terface Requirements, Version 4.2 ed., EMVCo, LLC, June
2008.
[5] EMVCo, “About EMV,” November 2009. [Online]. Available:
http://www.emvco.com/about emv.aspx
[6] APACS, “2008 fraud ﬁgures announced by APACS,” March
[Online]. Available: http://www.ukpayments.org.uk/
2009.
media centre/press releases/-/page/685/
[7] Which?,
“Fraud
get
line].
fraud-victims-struggle-to-get-money-back-179150.jsp
to
back,”
[On-
http://www.which.co.uk/news/2009/06/
money
Available:
struggle
2009.
victims
June
[8] Visa Integrated Circuit Card – Card Speciﬁcation, Version
1.4.0 ed., Visa International, October 2001.
[9] S. J. Murdoch, S. Drimer, R. Anderson, and M. Bond,
“EMV PIN veriﬁcation “wedge” vulnerability,” February
2010. [Online]. Available: http://www.cl.cam.ac.uk/research/
security/banking/nopin/
[10] Maxim
Products,
Integrated
SIM/smart-card
MAX1741
μMAX ,
en/ds/MAX1740-MAX1741.pdf.
//datasheets.maxim-ic.com/en/ds/MAX1740-MAX1741.pdf
MAX1740,
in
http://datasheets.maxim-ic.com/
[Online]. Available: http:
translators
January
2001,
Inc.,
level
[11] Xilinx Inc., “Spartan-3E starter kit,” November 2009.
[Online]. Available: http://www.xilinx.com/products/devkits/
HW-SPAR3E-SK-US-G.htm
444
A. Transaction Log of MITM Attack
APPENDIX
The following log was collected during one of our man-in-the-middle experiments, where we used one of our own cards
to purchases goods in a online Chip and PIN transaction, while using the incorrect PIN. Data items which could be used
to identify the merchant who assisted us with the experiments has been redacted (xx), and unnecessary detail has been
removed for brevity (. . . ). Principals are Terminal (T), Card (C), and man-in-the-middle (M).
T → C 00 a4 04 00 0e 31 50 41 59 2e 53 59 53 2e 44 44 -
C → T 6f 1a 84 0e 31 50 41 59 2e 53 59 53 2e 44 44 46 -
T → C 00 b2 01 14 00
C → T 70 40 61 1e 4f 07 a0 00 00 00 29 10 10 50 10 4c -
49 4e 4b 20 20 20 20 20 20 20 20 20 20 20 20 87 -
01 01 61 1e 4f 07 a0 00 00 00 03 10 10 50 10 56 -
49 53 41 20 44 45 42 49 54 20 20 20 20 20 20 87 -
01 02 90 00
Read Record
Available applications: “LINK” and “VISA
DEBIT”
Opened “1PAY.SYS.DDF01” (language EN)
Select ﬁle “1PAY.SYS.DDF01”
46 30 31
30 31 a5 08 88 01 02 5f 2d 02 65 6e 90 00
T → C 00 a4 04 00 07 a0 00 00 00 03 10 10
C → T 6f 25 84 07 a0 00 00 00 03 10 10 a5 1a 50 10 56 -
49 53 41 20 44 45 42 49 54 20 20 20 20 20 20 87 -
01 02 5f 2d 02 65 6e 90 00
T → C 80 a8 00 00 02 83 00
C → T 80 0a 5c 00 08 01 01 00 10 01 04 01 90 00
T → C 00 b2 01 0c 00
C → T 70 3e 57...5f 20...9f 1f...90 00
T → C 00 b2 01 14 00
C → T 70 49 5f 25...5f 24...9f 07...5a...5f -
34...9f 0d...9f 0e...9f 0f...8e 10 00 00 -
00 00 00 00 00 00 41 03 1e 03 02 03 1f 03 90 00
T → C 00 b2 02 14 00
C → T 70 81 93 93...90 00
T → C 00 b2 03 14 00
C → T 70 81 c0 8f...9f 32...92...90 00
T → C 00 b2 04 14 00
C → T 70 48 8c 15 9f 02 06 9f 03 06 9f 1a 02 95 05 5f -
2a 02 9a 03 9c 01 9f 37 04 8d 17 8a 02 9f 02 06 -
9f 03 06 9f 1a 02 95 05 5f 2a 02 9a 03 9c 01 9f -
37 04 9f 08...5f 30...5f 28...9f 42...9f -
44...90 00
Select ﬁle “VISA DEBIT”
Opened “VISA DEBIT” (language EN)
Get Processing Options
Transaction started, 5 records available
Read Record
Record (Track 2 Equivalent Data, Cardholder
Name, Track 1 Discretionary Data)
Read Record
Signed record (Application Effective Date,
Application Expiration Date, Application Usage
Control, Application Primary Account Number,
Application Primary Account Number Sequence
Number, Issuer Action Code – Default, Issuer
Action Code – Denial, Issuer Action Code –
Online, Cardholder Veriﬁcation Method List)
Read Record
Record (Signed Static Application Data)
Read Record
Record (Certiﬁcation Authority Public Key
Index, Issuer Public Key Certiﬁcate, Issuer
Public Key Exponent, Issuer Public Key
Remainder)
Read Record
Record (Card Risk Management Data Object
List 1 (CDOL1), Card Risk Management Data
Object List 2 (CDOL2), Application Version
Number, Service Code, Issuer Country Code,
Application Currency Code, Application
Currency Exponent)
445
80 ca 9f 17 00
9f 17 01 03 90 00
T → C
C → T
T → M 00 20 00 80 08 24 00 00 ff ff ff ff ff
M → T 90 00
T → C
C → T
T → C
C → T
T → C
C → T
80 ae 80 00 1d xx xx xx xx xx xx 00 00 00 00 00 -
00 08 26 00 80 00 80 00 08 26 xx 11 09 00 xx xx -
xx xx
80 12 80 xx xx xx xx xx xx xx xx xx xx 06 01 0a -
03 a0 00 10 90 00
00 82 00 00 0a xx xx xx xx xx xx xx xx 30 30
90 00
80 ae 40 00 1f 30 30 xx xx xx xx xx xx 00 00 00 -
00 00 00 08 26 00 80 00 80 00 08 26 xx 11 09 00 -
xx xx xx xx
80 12 40 xx xx xx xx xx xx xx xx xx xx 06 01 0a -
03 60 00 10 90 00
Get Data (PIN try counter)
Remaining PIN tries = 3
Verify PIN “0000”
PIN correct
Generate AC (ARQC)
ARQC
External Authenticate
External authenticate successful
Generate AC (TC)
TC
446