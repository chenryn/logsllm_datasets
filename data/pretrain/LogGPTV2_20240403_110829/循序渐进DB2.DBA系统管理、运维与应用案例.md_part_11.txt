更多资源请访问www.ckook.com
41
---
## Page 67
用一个用户登录操作系统，这已经隐含地连接了实例。
db2detach
命令。要从实例断开，请使用DETACH命令。
用db2start时指定“/D”开关，仍可以在Windows上将DB2数据库实例作为进程运行。
db2start
性之后，默认情况下，只有DB2ADMNS和Administrators组的成员才能启动数据库。
户可以是Administrators、ServerOperators或PowerUsers组的一个成员。启用了扩展安全
户账户必须具有Windows操作系统定义的、用于启动Windows服务的正确特权。用户账
权限的用户标识或名称进行登录；或者作为实例所有者登录。在Windows上启动实例，用
至数据库或访问主机数据库。
然后才能执行下列某些任务：连接至该实例中的数据库、预编译应用程序、将程序包绑定
循序渐进DB2—DBA系统管理、运维与应用案例
db2attach to testdb2
db2attach to
在Linux或UNIX系统上启动实例之前需具有SYSADM、SYSCTRL或SYSMAINT
我们有时可能需要停止数据库管理器的当前实例。要在Linux或UNIX系统上停止实
5.停止实例
例如，要连接至节点目录中先前编目的称为testdb2的实例：
要使用命令行来与实例连接，请输入：
这两个命令我们在实际生产中很少用到，因为在Linux/UNIX环境中，我们每次都会
在所有平台上，要与另一个可能是远程的数据库管理器的实例连接，请使用ATTACH
4.连接至实例和从实例断开
使用命令行来启动实例，请输入：
在正常业务操作期间，可能需要启动或停止DB2数据库。例如，必须启动一个实例，
例如，在对testdb2实例执行维护活动后，要使用命令行从实例断开，请输入：
3.启动实例
注意：
在Windows上db2start命令将DB2数据库实例作为Windows服务来启动。通过在调
更多资源请访问www.ckook.com
---
## Page 68
那么在Windows中您可以使用操作系统的“set”命令，在UNIX中可以使用“export”或
证您下次打开窗口/会话时该值不变。但是，如果您想在给定的窗口/会话中临时更改该值，
的值更改成“DB2”。
但是如果您想创建与实例“DB2”相关的数据库，那么首先您必须将DB2INSTANCE变量
您指定当前活动实例，所有命令都将应用于该实例。例如，如果将DB2INSTANCE设置成
作系统级别上定义的变量。最常使用的DB2环境变量是DB2INSTANCE。该环境变量允许
个实例呢？这就需要使用DB2INSTANCE环境变量。环境变量是操作系统层面的，是在操
2.1.5DB2INSTANCE变量介绍
“setenv”命令。例如，在Windows平台中，
命令停止实例。
有关键性的或极重要的应用程序在运行。
组的一个成员。在停止实例之前，要停止与数据库连接的所有应用程序和用户，要确保没
作系统定义的正确特权。用户账户可以是Administrators、ServerOperators或PowerUsers
实例；或者作为实例所有者登录。在Windows停止实例的用户账户必须具有Windows操
例，必须具有SYSADM、SYSCTRL或SYSMAINT权限的用户标识或名称登录或连接至
可以使用控制面板（在Windows中）/db2profile（在UNIX中）来设置环境变量的值，将保
如果一个系统中有多个实例，那么如何在各个实例之间进行切换以及如何同时启动多
db2stop force
db2stop
使用命令行来停止实例，请输入：
在Windows上除了使用命令行外，我们还可以通过“控制面板-服务”或NETSTOP
这时所有连接上数据库未提交的应用将强制回滚。
如果我们强制所有应用程序和用户与该数据库断开。需要输入如下命令：
如果停止期间仍然有应用连接，这时会报错，如图2-7所示。
S
图2-7停止实例时仍有应用连接
DUIUEI
下面这个命令：
第2章创建实例和管理服务器
更多资源请访问www.ckook.com
---
## Page 69
44
usu>do
之前确保所有的应用已经断开实例并且实例已经停止。
2.1.6
隐含地连接了这个实例。所以相对来说在Linux/UNIX上很少用到这个变量。
在Linux/UNIX中由于每个实例都有和它同名的用户，所以当我们用这个用户登录时已经
量INFORMIXSERVER。主要用于在多个实例间进行切换。这个变量在Windows中常用，
环境变量启动多个实例。
号（=）前后留有空格。绝对不能有空格！
DB2INSTANCEDB2
循序渐进DB2—DBA系统管理、运维与应用案例
使用命令行除去实例，请输入：
要删除实例，必须具有root权限，在Windows上必须具有系统管理员权限。删除实例
举例：假设一个系统中有多个实例，下面我们来举例说明如何通过设置DB2INSTANCE
要查看该变量的当前设置，您可以使用下面三个方法中的任何一个：
会将环境变量DB2INSTANCE的值设置成“DB2”。使用set命令时常犯的错误是在等
其实DB2INSTANCE环境变量类似Oracle中的变量ORACLE_SID、Informix中的变
C:AProgram Files\IBMSQLLIB\BIN>db2ilist
db2 get instance
echo DB2INSTANCE%（Windows only）;echo $DB2INSTANCE(Linux/UNIX)
这时启动的是rod实例
C:\Program Files\IBM\SQLLIB\BIN>db2start
-db2getinstance命令用来判断当前在哪个实例下。
DB2INSTANCE-PROD
C:AProgram Files\IBM\SQLLIB\BIN>set DB2INSTANCE
C:\Program Files\IBM\SQLLIB\BIN>set
DB2INSTANCE-DB2
C:\Program Files\IBM\SQLLIB\BIN>set DB2INSTANCE
当前数据库管理器实例是：PROD
当前活动实例是DB2实例。
系统存在三个实例。
DB2
DEV
PROD
set
删除实例
DB2INSTANCE
DB2INSTANCE-PROD
量OMAT2MS80
中
更多资源请访问www.ckook.com
---
## Page 70
2.2.1
2.2
详细讲解如何合理地配置实例配置参数以使其稳定、安全、高效运行。
db2stop之后，再执行db2start时生效)。
etcg
db2 update dbm cfg using
别条目，请输入：
指定的那些值。
db2getdbcfg
这个配置文件是二进制的，只能通过命令来修改。
安全、通信、管理和资源的分配。我们可以根据需要来查看、更改和复位这个配置参数。
2.1.7
务器中删除*nfs文件，然后可除去sqllib子目录。
子目录是安装了NFS的系统，而这些文件在服务器上是受控的。必须从安装目录的文件服
说明不能除去sqlib子目录，并且正在adm子目录中生成几个具有.nfs扩展名的文件。adm
目录。所以删除实例时千万要小心，如有必要请在删除实例之前备份实例目录。
关于实例配置文件，这超出了我们本章的讨论范围，我们会在后面的章节中再给大家
可在命令行使用updatedbmconfig来更新实例配置文件。要更新实例配置文件中的个
在某些情况下，对实例配置文件的更改仅在将更改装入内存后才生效（即在执行
DAS是数据库管理服务器（DatabaseAdministrationServer)的缩写。它是一个驻留在数
要将配置参数复位为建议的默认值，请输入：
它显示在安装该产品期间指定为默认配置参数的当前值，或在先前更新配置参数期间
可使用db2getdbmcfg命令来查看当前实例配置参数。
每个实例创建后，都有一个实例配置文件（db2systm），这个实例配置文件控制实例的
注意：
db2idrop命令从实例列表中除去实例条目，并除去实例所有者home目录下的sqllib子
要查看当前实例配置参数的当前值，请输入：
在Linux和UNIX操作系统上，试图使用db2idrop命令删除实例时，会生成一条消息
管理服务器概念
管理服务器
配置实例
第2章创建实例和管理服务器
更多资源请访问www.ckook.con
45
---
## Page 71
存在。
面的工具来管理DB2，那么您可以不创建DAS，通过命令行远程地管理DB2不需要DAS
器上配置启动管理服务器。其实DAS不是必须创建的，假设您不需要远程地使用图形化界
DB2提供的图形化管理工具来管理这个北京机房的DB2，那么您必须在北京的DB2服务
须存在并被启动。DB2图形管理工具与DAS共同使诸如以下的任务得以被执行：
心）对服务器上的数据库进行本地和远程管理。事实上，为了利用这些工具，DAS实例必
可以同时管理多个实例，如图2-8所示。
在运行。
据库或随DB2产品一起提供的图形工具（例如，控制中心或任务中心），那么DAS必须正
管理工具和配置助手（CA）的请求。如果要使用“客户机配置助手”来发现（Discover）远程数
Client，DB2V9以后更名为DB2Client)。DB2管理服务器（DAS）响应来自远程DB2服务器
DB2服务器执行远程管理任务（其他远程DB2服务器需要安装DatabaseAdministration
据库服务器机器上的特殊实例。DAS是一个特殊的DB2管理控制点，它用于仅帮助其他
循序渐进DB2一DBA系统管理、运维与应用案例
DAS与实例是一对多的关系，即DB2数据库服务器中只能有一个DAS，但这个DAS
举个例子，假设您安装了DB2的数据库服务器远在北京机房，而您现在想在上海利用
·从远程客户机上管理、调度DB2或操作系统脚本以在服务器上运行
DAS允许使用DB2工具（例如ControlCenter、Client ConfigurationAssistant和任务中
DB2全局注册变量参数DB2ADMINSERVER定义了管理DB2数据库服务器的DAS：
启动或停止远程DB2实例
使用DB2Discovery自动设置客户机/服务器连接
lnstance1
oinserver
Database1
(DAS)
图2-8DAS与实例的关系
Database2
My Server
instance2
1
Database1
一
一
更多资源请访问www.ckook.com
---
## Page 72
事项：
管理服务器（DAS)的登录账户。
样将不会为登录账户设置某些必需的访问权。始终使用db2admin命令来设置或更改DB2
此命令前，您必须使用具有本地管理员权限的账户或用户标识登录计算机。
db2adminsetid和是具有本地管理员权限的账户的用户名和密码。在运行
在一个数据库服务器中只能有一个DAS。如果已经创建了DAS，那么需要通过发出
管理服务器必须位于将要被管理和被搜索的每台服务器上。每个数据库服务器机器上
在Windows上，不应使用控制面板中的服务实用程序来更改DAS的登录账户，因为这
注意：
在Windows上，创建DAS须具有本地Administrator权限。如果期望使用特定用户账
1.在Windows上创建DAS
如果在DB2安装过程中未自动创建DAS实例，那么我们必须手工创建它。在UNIX/Linux
创建管理服务器
集止此服务
DB2DAS-DB2DAS00
服务（本地）
图2-9Windows上默认创建的DAS
名称
DB2
-DB2DAS00
第2章创建实例和管理服务器
已
已...
动动
更多资源请访问www.ckook.com
本地
OI
---
## Page 73
或PowerUsers组的账户或用户标识登录至计算机。要在Linux/UNIX上手动启动或停止
2.2.3
/opt/IBM/db2/V9.5
DB2DIR/instance/dascrt-uDASuser
特定的组名和用户名，此处仅为说明作用。
使用DB2安装向导期间DB2默认生成的。
组并设置密码，一般来说我们需要创建表2-2所示的用户和组。表2-2中的用户和组只是
放DAS相关的实例目录结构。
的组。之所以需要创建用户，
db2adminsetid命令提供一个用户账户名和用户密码，来建立或修改它的所有权。
户账户”。将该账户名的密码设置为“密码永不到期”。在创建了DAS之后，就可以使用
有效，它们将标识该DAS的所有者。不要使用为DAS创建的用户标识或账户名作为“用
循序渐进DB2—DBA系统管理、运维与应用案例
其中DB2DIR是DB2安装目录。在Linux/UNIX操作系统上，默认DB2安装目录是
DB2管理服务器用户
在Windows上手动启动或停止DAS，您必须首先使用属于Administrators、ServerOperators
(3）运行dascrt命令。例如，在Linux或UNIX操作系统上：
（1）使用root权限登录（在windows上使用系统管理员账号登录）。
要使用dascrt创建实例：
而在Linux和UNIX上，要想创建DAS，必须首先创建和DAS一样的用户及该用户
2.在Linux和UNIX上创建DAS
启动和停止DB2管理服务器
当创建DAS时，可以选择是否提供用户账户名和用户密码。如果用户账户名和密码
在Windows平台上：使用具有正确的服务创建权限的账户登录想要创建DAS的计算机
管理服务器相关命令
户
，主要是因为需要该用户的home目录来作为DAS实例目录存
表2-2
示例用户名
默认生成的用户和组
dasusrl
实际生产中，我们可以根据自己需要创建自己
示例组名
dasadml