警告
新手用apt-pinning命令会造成比较大的问题。你必须避免使用这个命令除非确实需要它。
如果不想要引入推荐的特定软件包，你必须创建”/etc/apt/preferences”文件并且像如下所示的那样在文件的顶
部明确列出这些软件包。
Package: package-1
Pin: version *
Pin-Priority: -1
Package: package-2
Pin: version *
Pin-Priority: -1
2.7.9 使用带有 unstable 软件包的 testing 版本
警告
新手用apt-pinning命令会造成比较大的问题。你必须避免使用这个命令除非确实需要它。
如下是一个关于apt-pinning技术的例子，当使用testing的时候，实现unstable中的特定的较新的上游版本软件
包的日常升级。你应该按如下所示的在”/etc/apt/sources.list”文件中列出所有需要的档案库。
deb http://deb.debian.org/debian/ testing main contrib non-free
deb http://deb.debian.org/debian/ unstable main contrib non-free
deb http://security.debian.org/debian-security testing-security main contrib
按如下所示的设置”/etc/apt/preferences”文件。
Package: *
Pin: release a=unstable
Pin-Priority: 100
当想要在此配置下从 unstable 档案库中安装”package-name” 软件及它的依赖包时，你执行带有”-t” 选项
(unstable的Pin-Priority值变为990)的转换目标发行版的命令。
$ sudo apt-get install -t unstable package-name
在此配置下，执行”apt-get update”和”apt-get dist-upgrade”(或者”aptitude safe-upgrade”和”aptitude
full-upgrade”)命令,会从testing档案库升级那些从testing档案库安装的软件包并且从unstable档案库
升级那些从unstable档案库中安装的软件包。
小心
小心不要去移除”/etc/apt/sources.list” 文件中的”testing” 档案库。如果文件中没有”testing” ，
APT系统会使用更加新的unstable档案库升级软件包。
Debian参考手册 71/233
提示
我通常会在上述操作后，马上注释掉”/etc/apt/sources.list”文件中的”unstable”档案库记录。这避免了因
为处理”/etc/apt/sources.list”文件中的众多记录而造成的升级缓慢虽然同时也阻止了那些从unstable档
案库中安装的软件包通过unstable升级。
提示
如 果”/etc/apt/preferences” 文 件 中”Pin-Priority: 1” 替 代 了”Pin-Priority:100”， 即
使”/etc/apt/sources.list” 文件中的”testing” 记录被删除了，Pin-Priority 值为 100 的已安装软件包
也不会通过unstable档案库升级。
如果你希望自动跟踪unstable里某些特殊的软件包，而在安装时不再使用初始化选项”-t unstable”，你必须创
建”/etc/apt/preferences”文件，并在该文件顶部按下面的方式清晰的列出所有那些软件包。
Package: package-1
Pin: release a=unstable
Pin-Priority: 700
Package: package-2
Pin: release a=unstable
Pin-Priority: 700
如下是为每个特定的软件包设置Pin-Priority值。例如，为了使用最新的unstable的英文版”DebianReference”，你应
该在”/etc/apt/preferences”文件中写入以下条目。
Package: debian-reference-en
Pin: release a=unstable
Pin-Priority: 700
Package: debian-reference-common
Pin: release a=unstable
Pin-Priority: 700
提示
即使你使用的是stable档案库，apt-pinning技术仍然是有效的。根据我以前的经验，从unstable档案库安装
的文档包一直是安全的。
2.7.10 使用带有 experimental 软件包的 unstable 版本
警告
新手用apt-pinning命令会造成比较大的问题。你必须避免使用这个命令除非确实需要它。
这是使用apt-pinning的另一个示例，该示例主要使用 unstable源，但包含了 experimental源,该源可用于安
装上游更新的软件包. 需要包含在”/etc/apt/sources.list”文件中的列表如下:
deb http://deb.debian.org/debian/ unstable main contrib non-free
deb http://deb.debian.org/debian/ experimental main contrib non-free
deb http://security.debian.org/ testing-security main contrib
由于 experimental 源是 非自动（NotAutomatic）的源 (参见第 2.5.3 节)，其默认的 Pin-Priority 值被设置为 1
(<<100). 并不需要在”/etc/apt/preferences”文件中设置Pin-Priority值，只需要指定experimental源，除非
你需要在下次更新时自动升级时更新特定软件包.
Debian参考手册 72/233
2.7.11 紧急降级
警告
新手用apt-pinning命令会造成比较大的问题。你必须避免使用这个命令除非确实需要它。
小心
降级在Debian设计上就不被官方支持。仅仅是在紧急恢复过程中需要做的一部分工作。尽管憎恨这种情形，
但降级在很多场景下工作得也不错。对于重要系统，你应当在恢复操作后备份所有重要数据，并从零开始重
新安装一个新的系统。
你可以通过控制候选版本从新的档案库降级到旧的档案库（参见第 2.7.7 节），从而使损坏的系统恢复。下面是一种
懒惰的方法，可以避免许多冗长的“dpkg -i broken-package_old-version.deb”命令（参见第 2.6.6 节）。
搜索“/etc/apt/sources.list”文件中像下面那样使用unstable的行。
deb http://deb.debian.org/debian/ sid main contrib non-free
使用下面的行替换它，从而改为使用testing。
deb http://deb.debian.org/debian/ trixie main contrib non-free
按如下所示的设置”/etc/apt/preferences”文件。
Package: *
Pin: release a=testing
Pin-Priority: 1010
运行“apt-get update; apt-get dist-upgrade”使整个系统的软件包强制降级。
在紧急降级后，移除“/etc/apt/preferences”这个特殊的文件。
提示
这是一个好方法，移除（不是清除！）尽可能多地软件包，来减少依赖问题。你可能需要手动移除和安装一些软件
包来使系统降级。需要特别注意Linux内核、引导程序、udev、PAM、APT和网络相关的软件包以及它们的配置文
件。
2.7.12 equivs 软件包
如果你从源代码编译了一个程序来代替Debian软件包，最好将它做成一个真正的本地Debian软件包（*.deb）并使
用私人档案库。
如果你选择从源代码编译一个程序并将它安装到“/usr/local”，你可能需要使用equivs作为最后步骤来满足缺
失的软件包依赖。
Package: equivs
Priority: optional
Section: admin
Description: Circumventing Debian package dependencies
This package provides a tool to create trivial Debian packages.
Typically these packages contain only dependency information, but they
can also include normal installed files like other packages do.
.
One use for this is to create a metapackage: a package whose sole
Debian参考手册 73/233
purpose is to declare dependencies and conflicts on other packages so
that these will be automatically installed, upgraded, or removed.
.
Another use is to circumvent dependency checking: by letting dpkg
think a particular package name and version is installed when it
isn’t, you can work around bugs in other packages’ dependencies.
(Please do still file such bugs, though.)
2.7.13 移植一个软件包到 stable 系统
小心
由于系统差异，不能够保证这里描述的过程能够工作，而不需要额外的手工处理。
对于部分升级的stable系统，使用源软件包在运行环境中重新构建一个软件包是不错的选择。这可以避免因为依赖
关系导致大量软件包升级。
在stable系统的“/etc/apt/sources.list”文件中添加下列条目。
deb-src http://deb.debian.org/debian unstable main contrib non-free
如下安装编译所需的软件包并下载源软件包。
# apt-get update
# apt-get dist-upgrade
# apt-get install fakeroot devscripts build-essential
# apt-get build-dep foo
$ apt-get source foo
$ cd foo*
如果需要向后移植，可以从backport的软件包中更新一些工具链软件包，例如dpkg和debhelper。
执行下列命令。
$ dch -i
更新软件包版本，例如在“debian/changelog”中附加一个“+bp1”
像下面那样构建软件包并将它们安装到系统中。
$ debuild
$ cd ..
# debi foo*.changes
2.7.14 用于 APT 的代理服务器
因为镜像整个Debian档案库的子区会浪费硬盘和网络带宽，当你管理许多LAN上的系统时，为APT部署一个本地代
理服务器是个好主意。APT可以通过配置来使用通用web（http）代理服务器，例如squid（参见第 6.5 节），细节参
见apt.conf(5)和“/usr/share/doc/apt/examples/configure-index.gz”。环境变量“$http_proxy会
覆盖“/etc/apt/apt.conf”文件中设置的代理服务器。
这里有一些Debian档案库的专用代理工具。你应该在使用它们之前检查BTS。
小心
当Debian重构它的档案库结构时，这些专用的代理工具往往需要软件包维护者重写代码，并可能在一段时
间内无法使用。另一方面，通用web（http）代理服务器更强健并且更容易应对这种改变。
Debian参考手册 74/233
软件包 流行度 大小 说明
approx V:0,I:0 7124 缓存Debian档案库文件的代理服务器（已编译的OCaml程序）
apt-cacher V:0,I:0 266 为Debian软件包和源代码文件进行缓存代理（Perl程序）
apt-cacher-ng V:4,I:4 1816 分发软件包的缓存代理（C++编译的程序）
Table2.19: Debian档案库的专用代理工具
2.7.15 更多关于软件包管理的文档
你可以从下面的文档中了解软件包管理的更多信息。
• 软件包管理的主要文档：
– aptitude(8),dpkg(1),tasksel(8),apt(8),apt-get(8),apt-config(8),apt-secure(8),sources.list(5),
apt.conf(5),andapt_preferences(5);
– 来自apt-doc软件包的“/usr/share/doc/apt-doc/guide.html/index.html”和“/usr/share/doc/apt-doc/offline.html/index.html”；
– 来自aptitude-doc-en软件包的“/usr/share/doc/aptitude/html/en/index.html”。
• Debian档案库的官方详细文档：
– ”DebianPolicyManualChapter2-TheDebianArchive”，
– ”DebianDeveloper’sReference,Chapter4-ResourcesforDebianDevelopers4.6TheDebianarchive”，
– ”TheDebianGNU/LinuxFAQ,Chapter6-TheDebianFTParchives”。
• 为Debian用户构建一个Debian软件包的教程：
– “Debian维护者指南”。
Debian参考手册 75/233
Chapter 3
系统初始化
作为系统管理员，粗略地了解Debian系统的启动和配置方式是明智的。尽管准确的细节在安装的软件包及对应的文档
中，但这些知识对我们大多数人来说都是必须掌握的。
下面是Debian系统初始化的要点概述。由于Debian系统在不断发展，您应该参考最新的文档。
• DebianLinux内核手册是关于Debian内核的主要信息来源。