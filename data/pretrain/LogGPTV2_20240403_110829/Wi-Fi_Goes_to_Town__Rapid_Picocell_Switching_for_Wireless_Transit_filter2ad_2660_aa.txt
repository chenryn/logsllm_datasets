title:Wi-Fi Goes to Town: Rapid Picocell Switching for Wireless Transit
Networks
author:Zhenyu Song and
Longfei Shangguan and
Kyle Jamieson
Wi-Fi Goes to Town: Rapid Picocell Switching for Wireless
Transit Networks
Zhenyu Song
Princeton University
Longfei Shangguan
Princeton University
PI:EMAIL
PI:EMAIL
Kyle Jamieson∗
Princeton University
PI:EMAIL
ABSTRACT
This paper presents the design and implementation of Wi-Fi Goes
to Town, the first Wi-Fi based roadside hotspot network designed to
operate at vehicular speeds with meter-sized picocells. Wi-Fi Goes
to Town APs make delivery decisions to the vehicular clients they
serve at millisecond-level granularities, exploiting path diversity
in roadside networks. In order to accomplish this, we introduce
new buffer management algorithms that allow participating APs
to manage each others’ queues, rapidly quenching each others’
transmissions and flushing each others’ queues. We furthermore
integrate our fine-grained AP selection and queue management into
802.11’s frame aggregation and block acknowledgement functions,
making the system effective at modern 802.11 bit rates that need
frame aggregation to maintain high spectral efficiency. We have
implemented our system in an eight-AP network alongside a nearby
road, and evaluate its performance with mobile clients moving at
up to 35 mph. Depending on the clients’ speed, Wi-Fi Goes to Town
achieves a 2.4–4.7× TCP throughput improvement over a baseline
fast handover protocol that captures the state of the art in Wi-Fi
roaming, including the recent IEEE 802.11k and 802.11r standards.
CCS CONCEPTS
• Networks → Wireless access networks;
KEYWORDS
Wi-Fi, Handover, Transit Networks
ACM Reference format:
Zhenyu Song, Longfei Shangguan, and Kyle Jamieson. 2017. Wi-Fi Goes to
Town: Rapid Picocell Switching for Wireless Transit Networks. In Proceed-
ings of , Los Angeles, CA, USA, August 21-25, 2017 (SIGCOMM ’17), 13 pages.
https://doi.org/10.1145/3098822.3098846
1 INTRODUCTION
Every day, billions of commuters journey in and out of the world’s
urban centers: many by train, light rail, or underground transport,
others in vehicles that may soon become driverless in the coming
decade. Today this commute is often wasted time, but we look
∗K. Jamieson is also affiliated with University College London.
Permission to make digital or hard copies of all or part of this work for personal or
classroom use is granted without fee provided that copies are not made or distributed
for profit or commercial advantage and that copies bear this notice and the full citation
on the first page. Copyrights for components of this work owned by others than the
author(s) must be honored. Abstracting with credit is permitted. To copy otherwise, or
republish, to post on servers or to redistribute to lists, requires prior specific permission
and/or a fee. Request permissions from permissions@acm.org.
SIGCOMM ’17, August 21-25, 2017, Los Angeles, CA, USA
© 2017 Copyright held by the owner/author(s). Publication rights licensed to Associa-
tion for Computing Machinery.
ACM ISBN 978-1-4503-4653-5/17/08. . . $15.00
https://doi.org/10.1145/3098822.3098846
forward to a nearby future with great demand for high-capacity
wireless networks serving transportation corridors, allowing users
to surf the web, complete video and audio calls or teleconferences,
and stream video and music entertainment, all on the commute.
Surprisingly, compared with capacity gains from new technolo-
gies, Cooper [10] estimates—with broad consensus from cellular
wireless network operators—that the overwhelming majority of
capacity gains over the past 45 years can be attributed to simply
decreasing the size of each cell, the geographic area each access
point (AP) covers. However, moving to smaller cells immediately
sets up a tension between the two goals of capacity and range,
exacerbating the range problem mentioned above. This necessitates
a handover, where a number of APs cooperate to serve the client as
it moves from one AP to the next.
Roaming between Wi-Fi APs is standardized, with the recent
802.11r standard [22] enabling the client to make a connection with
another AP before abandoning the current: this is called make before
break. Other parts of the Wi-Fi standard, namely 802.11k [21], allow
the current AP to inform the client about other nearby APs and
channels, so that when the time comes for the client to abandon the
current AP, it may immediately begin the association process with
those APs, rather than discovering their existence from scratch.
But these solutions, and others we discuss below, are too slow for
the scenarios we consider here, necessitating larger cells and thus
clawing back smaller cells’ capacity gains.
Recently, however, two trends have arisen that may break this
stalemate: the first a reflection on recent research, the second a
consequence of Wi-Fi’s commoditization:
(1) Recent work has demonstrated that commodity Wi-Fi APs can
extract detailed channel measurements [18, 49], thus rapidly
predicting the AP or APs best suited to serve a client as it moves.
(2) Today, very low cost Wi-Fi chipsets such as the ESP8266 (Figure 1)
are arriving on the market for less than $5, making for the first
time very high-density Wi-Fi AP installations cost-feasible.
Figure 1: The ESP8266 Wi-Fi and system-on-chip module,
available ca. 2016 for $5.
In this work, we demonstrate a synergy between the above two
trends, resulting in an opportunity to transform the design of road-
side and metropolitan transit wireless networks with the wide-
spread deployment of an array of inexpensive “Wi-Fi picocell” APs,
322
SIGCOMM ’17, August 21-25, 2017, Los Angeles, CA, USA
Zhenyu Song, Longfei Shangguan, and Kyle Jamieson
15
)
B
d
(
10
R
N
S
E
5
0
AP1  
AP2  
AP3  
0
Wide-area latency
< 1 ms latency
Content 
Server
Controller
Wi-Fi APs
5 m.
25 mph
AP1
AP2
AP3
1
2
Time (s)
3
0 120 240 360
Time (ms)
Figure 3: Wi-Fi Goes to Town architecture: cars moving at
25 mph spend about 460 milliseconds in each AP’s cell.
Figure 2: The vehicular picocell regime: Constructive
and destructive wireless multipath fading as measured by
Effective SNR (upper plot) conspire with vehicular-speed
mobility to change the AP best able to deliver packets to
a mobile client (lower plot) at millisecond timescales (right
detail view). The radio coverage between APs overlaps by
around 10 m.
each covering just a few meters of a busy urban transit corridor. But
such a design faces the fundamental challenge shown in Figure 2:
the wireless capacity (achievable throughput) to each AP exhibits
two well-known wireless trends as a mobile user drives past the AP
array. First, there is fading at second-level scales due to distance,
but second, there is rapid, millisecond-level fast fading due to alter-
nating constructive and destructive multipath propagation, on the
spatial scale of an RF wavelength, 12 cm at 2.4 GHz. Furthermore,
due to the dense deployment of APs in the array (necessary to
attain good coverage), the large-scale and small-scale fades overlap
in time to make the best choice of AP (shown below in the figure)
change every millisecond. We term this combination of AP diversity,
vehicular client mobility, and meter-level AP cell size the vehicular
picocell regime.
This paper presents the design, implementation, and experimental
evaluation of Wi-Fi Goes to Town, a system that operates efficiently
in the vehicular picocell regime via a nearby controller exercising
tight control of the AP array, as shown in Figure 3. As users travel
at high speed through an underground tunnel or along a road, the
controller switches downlink traffic to several APs in the array, one
of which will be best able to deliver the packet to where the user’s
device will be tens of milliseconds later. When the packet reaches
the tail of an AP’s transmit queue and is ready for transmission
to the client, the APs communicate directly to agree which one
of them should actually attempt to deliver the packet. Since the
wireless channel is so unpredictable in the vehicular picocell regime,
with a coherence time (the period of time over which the wireless
channel remains stable) of ca. two-three milliseconds at 2.4 GHz
[47], Wi-Fi Goes to Town APs rely on lightweight channel state
information (CSI) readings from a client’s uplink transmissions,
from which they compute Effective SNR [18] (ESNR), and quickly
decide which AP should deliver the packet to the mobile. If the
chosen AP’s delivery attempt is successful, that AP cues the other
APs to dequeue and discard their copies of the delivered packet.
For traffic on the uplink from the mobile to the AP array, any AP
can receive each such packet, but the controller removes duplicate
packets in the event that more than one AP receives the same packet
from the client.
The first of two challenges involved in realizing actual wireless
performance gains in this setting stems from packet queuing, which
occurs in many network layers and software and hardware com-
ponents in Wi-Fi networks. A modest amount of queuing (ca. 20
milliseconds or 100 packets) in the operating system driver and/or
the Wi-Fi hardware itself allows modern 802.11 wireless link layers
to combine queued packets into larger aggregate packets. This ag-
gregation is critical to maintaining a high ratio of fixed per-frame
overhead (necessary to coordinate access to the wireless medium)
to useful data airtime as wireless data bit-rates increase. But frame
aggregation and sequence number-based block acknowledgements
lose their efficiency if the AP that receives a block acknowledge-
ment from a client differs from the one that sends the corresponding
downlink data. To address this problem, Wi-Fi Goes to Town intro-
duces mechanisms to share block acknowledgement state between
participating APs.
The second of the two challenges comes from packet buffering.
Buffering at higher layers, such as the operating system’s trans-
port-layer socket, allows applications to exploit asynchronous I/O.
However, while helpful in these regards, buffering at an individual
AP results in the transmission of a backlog of packets once the
controller has made a decision to switch away from that AP. As
we show in §3 (p. 5), buffering thus adds a significant latency to
the controller’s switching decision, a delay that is insignificant in
current AP handover systems and systems based on Multipath TCP
[15], but highly significant for the vehicular picocell regime. To
address the problem of controller-AP switching latency, Wi-Fi Goes
to Town maintains current amounts of buffering at APs, but intro-
duces hooks for the controller to dequeue pending packets buffered
at APs once it makes a switching decision. Microbenchmarks (§3)
quantify the performance impact of buffering and the benefits of
our fine-grained AP buffering control.
We have implemented Wi-Fi Goes to Town on commodity TP-
Link APs, with a single Linux controller running the Click modular
router [25]. Each roadside AP is equipped with a parabolic antenna
of beamwidth 21 degrees. We install the Atheros CSI Tool [49]
on each AP, which measures the CSI of each incoming frame and
forwards it to the controller for processing. Our implementation of
Wi-Fi Goes to Town is fully described in §4 below. For a comparison
323
Wi-Fi Goes to Town: Rapid Picocell Switching for Wireless Transit Networks
SIGCOMM ’17, August 21-25, 2017, Los Angeles, CA, USA
point running on the same hardware, we have also implemented
a performance-tuned version of the IEEE 802.11r and 802.11k fast
handover protocols in Click.
AP1
AP2
AP1 AP2
We have deployed eight Wi-Fi Goes to Town APs on the third
floor of an office building overlooking a nearby road. APs com-
municate with the controller via Ethernet backhaul. Experiments
compare Wi-Fi Goes to Town with a performance-tuned version
of the IEEE 802.11r and 802.11k fast handover protocol that cap-
tures the current state of the art in Wi-Fi handover techniques.
Our end-to-end experiments test three different traffic workloads
representative of commuting behavior: web surfing, video stream-
ing, and bi-directional video teleconferencing. Results show a 2.4–
4.7× improvement in TCP download performance and a 2.6–4.0×
ranges from five to 25 mph, and 2.4–2.6× improvement in TCP and
improvement in UDP download performance as vehicular speed
UDP download performance in a multi-client scenario. Microbench-
marks then investigate the effect of AP density and time hysteresis
for AP switching, presenting a sensitivity analysis of each of the
above parameters on overall system performance.
Contributions. Wi-Fi Goes to Town’s contributions are two-fold.
First, we design a fine-grained, highly responsive switching protocol
and AP selection algorithm to send packets over the best link at
millisecond-level timescales. Second, we integrate this rapid packet
switching mechanism with modern Wi-Fi’s frame aggregation and
block acknowledgement mechanisms, critical to achieving high
performance in modern 802.11 wireless networks.
Roadmap. The remainder of this paper first highlights the inability
of current state-of-the-art to operate in the regime of interest (§2),
then describes Wi-Fi Goes to Town’s design (§3). Our system’s
implementation (§4) and experimental evaluation in a real roadside
network testbed (§5) follow. §6 surveys related work in the area. §7
discusses future work, and §8 concludes.
2 WI-FI ROAMING AT DRIVING SPEED
Commercial Wi-Fi APs supporting the 802.11r [22] standard speed
client handovers from one AP to the next by allowing the client to
establish authentication with a new AP prior to de-associating with
the current AP. But 802.11r is tuned for walking speed mobility
with large cells. To understand its performance in the vehicular
picocell regime, we evaluate Linksys 802.11r-based APs [12] in
an outdoor roadside testbed (fully described in §4). The distance
between two APs is 7.5 m, and the cell size of each AP is 5.2 m. We
send a constant-rate stream of UDP packets using iperf3 [23] to an
iPhone 6S client in a car driving by first at five mph, and then at
20 mph.
Figures 4 (a) and 4 (b) plot the client’s reception of UDP packets
when it drives by AP1 and AP2 at 20 mph and 5 mph, respectively.
As a reference, we also plot the smoothed effective SNR (ESNR)
of these two client-AP links. In the 20 mph test, we identify a
re-association packet sent from the client to AP1 at around 4.6 s,
indicating that the client tries to switch to AP2. However, no acks
are identified at the client side even though the client retransmits
the re-association packet multiple times, and so the handover fails.
As the client moves further away from AP1, link quality deteriorates
significantly, with the client receiving the last packet from AP1 at
approximately 4.8 s. The handover fails because 802.11r does not
324
(a) Client moving at 20 mph.
(b) Client moving at 5 mph.
Figure 4: Received sequence number (black curves) of a con-
stant-rate UDP flow at a mobile client in a roadside network
testbed at (a) 20 mph speed, and (b) 5 mph speed, respectively.
The solid vertical line in (a) denotes the time of the last UDP
packet reception, and the dashed vertical line in (b) denotes
the time the client switches to AP2. The dashed area shows
the accumulated channel capacity loss. The average capac-
ity loss is separately 20.5 Mbit/s at 20 mph and 82.2 Mbit/s at
5 mph.
make its switching decision until it collects a long 5 s history of RSSI
measurements [1], longer than the client spends within hearing
range of AP1 at 20 mph. As a result, by the time the client has
determined it should switch, the link condition of the current AP
has already deteriorated. The client successfully switches from AP1
to AP2 only in the 5 mph case, as shown in Figure 4 (b), but as can
be seen from the ESNR curves, the handover happens significantly
later than it should, resulting in the AP needing to decrease its
bitrate, sacrificing wireless capacity.
3 DESIGN
Figure 5 shows the high-level design of Wi-Fi Goes to Town (WG-
TT). Our AP selection and downlink queue management algorithms
(§3.1) work hand-in-hand to leverage wireless path diversity at
millisecond-level timescales to speed the delivery of downlink traf-
fic as the client transitions through the grey zones of multiple
APs simultaneously. Our block acknowledgement forwarding and
packet de-duplication mechanisms (§3.2) work together with uplink
data delivery to the same path diversity at the same fine-grained
timescales to make 802.11’s frame aggregation block acknowledge-
ments more reliable, also increasing throughput.
3.1 Downlink Packet Flow
For every downlink packet to a certain client, WGTT chooses the
AP best able to deliver the packet to the client (§3.1.1), and then
carefully manages packet queues at all APs (§3.1.2) to ensure the
selected AP delivers the selected packet to the client milliseconds
later.
3.1.1 AP Selection. To operate in the vehicular picocell regime,
our AP selection algorithm needs to be simultaneously accurate
in its packet delivery rate predictions and agile enough to react in
milliseconds. To achieve these goals, we measure link quality with
the Effective SNR [17] (ESNR) metric, computed at each AP from
channel state information (CSI) extracted from a client’s uplink
transmission. Each AP measures CSI on all 56 OFDM subcarriers,
encapsulating these readings into a UDP packet, and delivering
SIGCOMM ’17, August 21-25, 2017, Los Angeles, CA, USA
Zhenyu Song, Longfei Shangguan, and Kyle Jamieson
Data plane
Control plane
Cyclic queue of client 1
Cyclic queue of client 2
De-duplication
(§3.2.2)
CSI packet
Controller
AP selection
(§3.1.1)
Block ACK
forwarding
(§3.2.1)
Queue management
(§3.1.2)
Cyclic queue
Client association
(§4.3)
Access Point (AP)
uplink
downlink
Figure 5: WGTT’s high-level design, divided into control
plane- and data plane-functionality.
this packet to the controller over the Ethernet backhaul. Upon re-
ceiving this packet, the controller extracts the CSI information and
computes ESNR. ESNR takes SNR variations across subcarriers into
account, hence more accurately predicts packet delivery probability
in the presence of a highly frequency-selective channel (i.e. when
multipath reflections are strong).
WGTT AP selection algorithm. WGTT measures the short-term
history of ESNR readings from packets received over each client-AP
link in a sliding window of duration W (we evaluate our choice of