• Product versioning, status information, and output from various other operating system commands.
If IBM Support ask you for more detailed information, you can add this by specifying the required options
with the -section parameter.
Procedure
1.To specify that the output file name starts with your case number, use the -caseno parameter.
For example:
• On UNIX and Linux:
sh> runmqras ‑caseno TS123456789
• On Windows:
C:\> runmqras ‑caseno TS123456789
• On IBM i (Qshell):
/QIBM/ProdData/mqm/bin/runmqras ‑caseno TS123456789
If you are using an earlier version of the product that does not support the -caseno parameter, use
the ‑zipfile option instead of the ‑caseno option to make the output file name start with your case
number.
• On UNIX and Linux:
sh> runmqras ‑zipfile TS123456789
• On Windows:
C:\> runmqras ‑zipfile TS123456789
• On IBM i (Qshell):
/QIBM/ProdData/mqm/bin/runmqras ‑zipfile TS123456789
2.Choose the sections that you want to gather data for.
The runmqras command uses a configuration file called isa.xml that describes which files to collect
and which commands to run. This file is organized into sections that identify the information needed to
solve different kinds of problems, and IBM adds new sections as needed.
To choose the required sections, specify the -section parameter with the appropriate options. For
example:
• On UNIX and Linux:
sh> runmqras ‑caseno TS123456789 ‑section defs,cluster,trace
304 Troubleshooting and Support for IBM MQ
• On Windows:
C:\> runmqras ‑caseno TS123456789 ‑section defs,cluster,trace
• On IBM i (Qshell):
/QIBM/ProdData/mqm/bin/runmqras ‑caseno TS123456789 ‑section defs,cluster,trace
3.Choose the queue managers that you want to gather data for.
By default the runmqras command tries to collect information about all queue managers. Use the
‑qmlist option to provide a comma-separated list of the queue managers in your current installation
that runmqras should examine. For example:
• On UNIX and Linux:
sh> runmqras ‑caseno TS123456789 ‑section defs,cluster,trace ‑qmlist QMA,QMB,QMC
• On Windows:
C:\> runmqras ‑caseno TS123456789 ‑section defs,cluster,trace ‑qmlist QMA,QMB,QMC
• On IBM i (Qshell):
===> /QIBM/ProdData/mqm/bin/runmqras ‑caseno TS123456789 ‑section defs,cluster,trace
‑qmlist QMA,QMB,QMC
Important: Do not use the ‑qmlist option on IBM MQ client installations.
If you have multiple IBM MQ installations, do not use the runmqras command from one installation to
collect information about a queue manager in a different installation. While the runmqras command
will not fail outright, some of the commands issued by runmqras will fail with the error:
AMQ6292: The queue manager is associated with a different installation
Instead, first use the setmqenv command to switch between installations. Then, in each installation,
use the ‑qmlist option of the runmqras command to collect information from the queue managers
associated with that installation.
The queue managers you choose should be running, or else some the commands issued by the
runmqras command will fail with the error
AMQ8146: IBM MQ queue manager not available
However, the runmqras command is still useful if you have a queue manager that you cannot start.
4.Choose a different directory for handling large files.
If your system has lots of FDCs or trace files to collect, or if you collect the all or QMGR sections, the
archive that the runmqras command creates can be very large. Normally, runmqras uses space in a
temporary directory to collect and zip up the files. To choose a different directory on a file system or
disk with more free space, use the -workdirectory option. The directory that you specify must be
empty. If it does not exist yet, runmqras will create it. For example,:
• On UNIX and Linux:
sh> runmqras ‑caseno TS123456789 ‑section defs,cluster,trace,QMGR ‑qmlist QMA,QMB,QMC
‑workdirectory /var/bigdata/2019‑07‑27
• On Windows:
C:\> runmqras ‑caseno TS123456789 ‑section defs,cluster,trace,QMGR ‑qmlist QMA,QMB,QMC
‑workdirectory G:\BigData\2019‑07‑27
IBM MQ troubleshooting and support 305
• On IBM i (Qshell):
===> /QIBM/ProdData/mqm/bin/runmqras ‑caseno TS123456789 ‑section defs,cluster,trace,QMGR
‑qmlist QMA,QMB,QMC ‑workdirectory /QIBM/bigdata/2019‑07‑27
5.Send the troubleshooting information that you have collected to IBM Support.
Make sure that the runmqras archive file starts with your IBM case number, for example
TS123456789‑runmqras.zip then send the file to IBM. For more information, see “Sending
troubleshooting information to IBM” on page 353..
What to do next
Important: After sending your runmqras archive file to IBM, keep a copy of it until your problem is
resolved and you have tested the solution to your satisfaction.
The runmqras command does not delete any files from your system, neither IBM MQ logs, nor FDCs, job
logs, dumps, or trace files. After collecting these files with runmqras, consider archiving or deleting them
as described in Cleaning up IBM MQ files. If you then need to collect troubleshooting information with
runmqras again at a later time, the new runmqras file will be smaller and easier to analyze because it
does not contain duplicate files and old information.
Related tasks
“Collecting troubleshooting information manually” on page 306
In some cases, you might need to collect troubleshooting information manually, for example if you are
running an older version of IBM MQ or cannot use the runmqras command to collect troubleshooting
information automatically.
“Sending troubleshooting information to IBM” on page 353
After you have generated and collected troubleshooting information for a problem, you can send it to IBM
to help with problem determination for a support case.
Collecting troubleshooting information manually
In some cases, you might need to collect troubleshooting information manually, for example if you are
running an older version of IBM MQ or cannot use the runmqras command to collect troubleshooting
information automatically.
About this task
If you need to collect troubleshooting information for IBM Support, you should in most cases use the
runmqras tool, which automates the task of collecting troubleshooting information, rather than collecting
this information manually.
These manual instructions are provided for you to use if you are unable to use the runmqras tool to
collect the information automatically, for example if you are running an older version of IBM MQ or cannot
use runmqras for any other reason.
Tip: Consider cleaning up IBM MQ files before packaging data in order to reduce the size the data and
speed up its transfer to IBM. For more information, see Cleaning up IBM MQ files.
Procedure
1.If your system has more than one IBM MQ installation, use the setmqenv command to choose the
installation with the problem before proceeding:
• On UNIX and Linux:
sh> . /path/to/mqm/bin/setmqenv -n InstallationX
306 Troubleshooting and Support for IBM MQ
• On Windows:
C:\> "C:\Program Files\IBM\MQ\bin\setmqenv" -n InstallationX
2.Record the IBM MQ version and maintenance level.
You can use the dspmqver command to display these details. For more information, see Displaying
the IBM MQ version. If you are collecting troubleshooting information for an AMS, channel, data
conversion, dead-letter queue, error message and FFST, security, or TLS channel problem, record the
version and maintenance level on both sides of the channel. Alternatively, collect the IBM MQ data
manually on both sides of the channel.
3.Record the Operating System version and maintenance level.
If you are collecting troubleshooting information for an AMS, channel, data conversion, dead-letter
queue, error message and FFST, security, or TLS channel problem, record this information for both
sides of the channel.
4.If you are collecting troubleshooting information for an AMS, channel, data conversion, dead-letter
queue, error message and FFST, security, or TLS channel problem, record the IP addresses and
hostnames of the systems on both sides of the channel.
5.Save the IBM MQ configuration information, for example, registry keys and .ini files.
6.If your system has more than one IBM MQ installation, use the dspmqinst command to record your
IBM MQ installation details:
• On UNIX and Linux:
sh> dspmqinst > /tmp/dspmqinst.txt
• On Windows:
C:\>dspmqinst > %TEMP%/dspmqinst.txt
7.On IBM MQ server installations, use the dspmq command to record the status of your queue
managers.
This step does not apply to hang and high cpu, publish/subscribe, or triggering problems.
• On UNIX and Linux:
sh> dspmq -a > /tmp/dspmq.txt
• On Windows:
C:\> dspmq -a > %TEMP%/dspmq.txt
• On IBM i (command line):
===> WRKMQM
• On IBM i (Qshell):
===> /QSYS.LIB/QMQM.LIB/DSPMQ.PGM -a > /tmp/dspmq.txt
8.On IBM MQ server installations, record the IBM MQ processes that are active on your system.
This step does not apply to triggering problems.
• On UNIX and Linux:
sh> ps -ef | grep mq > /tmp/ps.txt
IBM MQ troubleshooting and support 307
• On Windows:
C:\> TASKLIST /V > %TEMP%/tasklist.txt
• On IBM i (command line):
===> WRKACTJOB SBS(QMQM)
• On IBM i (Qshell):
===> ps -ef | grep mq > /tmp/ps.txt
9.
For a logging or recovery problem only, collect the following troubleshooting information:
a)
On UNIX, Linux, and Windows, list the contents of the queue manager LogPath directory.
For example:
• On UNIX and Linux:
sh> ls -ltR /var/mqm/log/QMA > /tmp/QMA.logfiles.txt
• On Windows:
C:\> DIR /s "C:\ProgramData\IBM\MQ\log\QMA" > %TEMP%/QMA.logfiles.txt
b)
On UNIX, Linux, and Windows, make sure that the file system or disk holding the logs is not full.
For example:
• On UNIX and Linux:
sh> df -k > /tmp/filesystems.txt
• On Windows:
C:\> DIR C: > %TEMPT/diskuage.txt
c)
On UNIX, Linux, and Windows, run the amqldmpa program against the queue manager to gather
details about the logger.
The command must be run by an IBM MQ administrator and the output file should be in a location
to which the queue manager has permission to write. For example:
• On UNIX and Linux:
sh> amqldmpa -m QMA -c H -d 8 -f /tmp/QMA.amqldmpa.logger.txt
• On Windows:
C:\> amqldmpa -m QMA -c H -d 8 -f %TEMP%\QMA.amqldmpa.logger.txt
d)On all systems, run the amqldmpa program against the queue manager to gather details about the
persistence layer.
The command must be run by an IBM MQ administrator and the output file should be in a location
to which the queue manager has permission to write. For example:
308 Troubleshooting and Support for IBM MQ
• On UNIX and Linux:
sh> amqldmpa -m QMA -c A -d 8 -f /tmp/QMA.amqldmpa.dap.txt
• On Windows:
C:\> amqldmpa -m QMA -c A -d 8 -f %TEMP%\QMA.amqldmpa.dap.txt
• On IBM i (Qshell):
===> /QSYS.LIB/QMQM.LIB/AMQLDMPA.PGM -m QMA -c A -d 8 -f /tmp/QMA.amqldmpa.dap.txt
e)
On UNIX, Linux, and Windows, collect the log file header, amqhlctl.lfh, which is found in the
active subdirectory of the queue manager's LogPath.
For example:
• On UNIX and Linux:
/var/mqm/log/QMA/active/amqhlctl.lfh
• On Windows:
C:\ProgramData\IBM\MQ\Log\QMA\active\amqhlctl.lfh
f)
On IBM i, find the Library attribute from the queue manager's qm.ini file and display its
contents. For more information about the queue manager library, see Object names on IBM i.
Alternatively, display the library QM* and select your queue manager from the list to display its
contents.
• To display the library for a given queue manager, for example QMA:
===> WRKLIB LIB(QMQMA)
• To display the library for all queue managers:
===> WRKLIB LIB(QM*)
g)
On IBM i, use the same Library value to work with the queue manager's journals.
Save the output, then use F17 to display attached journal receivers and save the output from
those screens as well. For example, to display the journals and journal receivers for queue
manager QMA:
===> WRKJRNA JRN(QMQMA/AMQAJRN)
10.On IBM MQ server installations, use the dmpmqcfg command to record the queue manager
configuration:
This step does not apply to logging or recovery problems.
• On UNIX and Linux:
sh> dmpmqcfg -m QMA >/tmp/QMA.config.txt
• On Windows:
C:\> dmpmqcfg -mQMA>%TEMP%\QMA.config.txt
IBM MQ troubleshooting and support 309
• On IBM i (Qshell):
===> /QSYS.LIB/QMQM.LIB/DMPMQCFG.PGM -mQMA > /tmp/QMA.config.txt
11.On IBM MQ server installations, use the runmqsc command to record status information from the
queue manager. For more information, see Saving IBM MQ MQSC output.
This step does not apply to logging or recovery problems.
If any command returns an error, carry on with the others:
DISPLAY PUBSUB ALL
DISPLAY QMSTATUS ALL
DISPLAY CHSTATUS(*) ALL
DISPLAY LSSTATUS(*) ALL
DISPLAY SVSTATUS(*) ALL
DISPLAY SBSTATUS(*) ALL
DISPLAY CONN(*) TYPE(*) ALL
DISPLAY QSTATUS(*) TYPE(QUEUE) ALL
DISPLAY QSTATUS(*) TYPE(HANDLE) ALL
DISPLAY TPSTATUS('#') TYPE(PUB) ALL
DISPLAY TPSTATUS('#') TYPE(SUB) ALL
DISPLAY TPSTATUS('#') TYPE(TOPIC) ALL
12.For an IBM MQ clustering or hang and high CPU problem only, record information about the cluster
objects known to the queue manager.
For an IBM MQ clustering problem, also dump the contents of the cluster repository cache.
a)Use the runmqsc command to record information about cluster objects known to the queue
manager.
If any command returns an error, carry on with the others:
DISPLAY CLUSQMGR(*) ALL
DISPLAY QCLUSTER(*) ALL
DISPLAY TCLUSTER(*) ALL
b)Dump the contents of the cluster repository cache using the amqrfdm utility.
Be sure to use the correct input file for your platform. For example:
• To dump the cluster repository cache for queue manager QMA on
UNIX and Linux:
sh> amqrfdm -m QMA  /tmp/QMA.cluster.txt
• To dump the cluster repository cache for queue manager QMA on Windows:
C:\> amqrfdm -m QMA  %TEMP%\QMA.cluster.txt
• To dump the cluster repository cache for queue manager QMA on IBM i (Qshell):
===> /QSYS.LIB/QMQM.LIB/AMQRFDM.PGM -m QMA  /tmp/QMA.cluster.txt
13.For problems with publish/subscribe only, complete the following steps:
a)On all systems, run the amqldmpa program against the queue manager to gather details about the
topics.
The command must be run by an IBM MQ administrator and the output file should be in a location
to which the queue manager has permission to write. For example:
• On UNIX and Linux:
sh> amqldmpa -m QMA -c T -d 8 -f /tmp/QMA.amqldmpa.topic.txt
• On Windows:
C:\> amqldmpa -m QMA -c T -d 8 -f %TEMP%\QMA.amqldmpa.topic.txt
310 Troubleshooting and Support for IBM MQ
• On IBM i (Qshell):
===> /QSYS.LIB/QMQM.LIB/AMQLDMPA.PGM -m QMA -c T -d 8 -f /tmp/QMA.amqldmpa.topic.txt
b)If your system has queued publish/subscribe enabled, browse the publish subscribe system
queues by using a program like the amqsbcg sample.
For example:
amqsbcg SYSTEM.PENDING.DATA.QUEUE QMA > QMA.PENDING.DATA.browse.txt
amqsbcg SYSTEM.JMS.ND.SUBSCRIBER.QUEUE QMA > QMA.JMS.ND.SUB.browse.txt
amqsbcg SYSTEM.JMS.ND.CC.SUBSCRIBER.QUEUE QMA > QMA.JMS.ND.CC.SUB.browse.txt
amqsbcg SYSTEM.JMS.D.SUBSCRIBER.QUEUE QMA > QMA.JMS.D.SUB.browse.txt
amqsbcg SYSTEM.JMS.D.CC.SUBSCRIBER.QUEUE QMA > QMA.JMS.D.CC.SUB.browse.txt
14.For a problem where a channel or client application is having difficulty connecting, use your operating
system tools to list network connections on both sides immediately before and after the connection
attempt.
This step applies to collecting troubleshooting information for the following types of problem: AMS,
channel, client application, data conversion, dead-letter queue, error message and FFST, Java and
JMS, security, or TLS channel.
• To display network connections on UNIX and Linux:
sh> netstat -an
• To display network connections on Windows:
C:\>NETSTAT -AN
• To display IPv4 and IPv6 network connections at the IBM i command line: