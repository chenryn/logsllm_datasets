title:Online detection of multi-component interactions in production systems
author:Adam J. Oliner and
Alex Aiken
OnlineDetectionofMulti-ComponentInteractionsinProductionSystemsAdamJ.OlinerandAlexAikenDepartmentofComputerScience∗StanfordUniversity{oliner,aiken}@cs.stanford.eduAbstract—Wepresentanonline,scalablemethodforinferringtheinteractionsamongthecomponentsoflargeproductionsys-tems.Wevalidateourapproachonmorethan1.3billionlinesoflogﬁlesfromeightunmodiﬁedproductionsystems,showingthatourapproachefﬁcientlyidentiﬁesimportantrelationshipsamongcomponents,handlesverylargesystemswithmanysimultaneoussignalsinrealtime,andproducesinformationthatisusefultosystemadministrators.Keywords-Systemmanagement,statisticalcorrelation,model-ing,anomalies,signalcompressionI.INTRODUCTIONWeareinterestedinautomaticsupportforunderstandinglargeproductionsystemssuchassupercomputers,datacenterclusters,andcomplexcontrolsystems.Fundamentally,admin-istratorsofsuchsystemsneedtoanswervariationsofonequestion:WhatpartsofthesystemmightaffectX?Mostobviously,Xmaybethemanifestationofasystembugandtheadministratorislookingforthecause,butadministratorsalsoneedtoanswerquestionsaboutwhataffectsresourceutilization(e.g.,toeliminateperformanceproblems),globalorlocalunexplainedbehavior(e.g.,todecidewhethertheunexpectedbehaviorisactuallyaproblemornot),andevenwhataspectsofthesystemshouldbemonitored(withtheaimofloggingallandonlyusefuldata),togivejustafewexamples.Overaperiodofseveralyearswehavelearned,usuallythehardway,thattherearesevereconstraintsonanysolutiontothisproblem:1)Lackofspeciﬁcation.Inpracticethereisnodescriptionofthecorrectbehaviorofthesystem.Infact,inallthesystemswehavestudiedthereisnotevenalistofallthesystem’scomponentsandtheirinteractions—eventheadministratorsareunawareofwhatisinsidesomepartsofthesystem(e.g.,third-partysubsystemsmaybeblackboxes).Administratorsdohaverulesofthumbandlistsofknownbadbehaviorsthattheytheywatchfor;theyalsorealizetheselistsareincomplete.2)Minimallyinvasivemonitoring.Forreasonsofcost,performance,andsystemstability,administratorsarealmostwithoutexceptionunwillingtodisturbtheinnerworkingsofsystemcomponentsforthepurposesofbettermonitoring.Itisoftenpossibletoaddnewlogging*ThisworkwassupportedinpartbyNSFgrantCCF-0915766andtheDOEHigh-PerformanceComputerScienceFellowship.ofinputsandoutputstocomponents,buteventhatnor-mallymustbejustiﬁedascost-effectiveforansweringsomeimportantquestionthatcannotbeansweredusingexistinglogs.3)Rapidturnaround.Answerstosomeofthemostimpor-tantquestionsareonlyusefuliftheycanbecomputedinreal-time.Forexample,administratorswouldliketosetstandingqueriesthattriggeranalarmwhenthesystemﬁrststraysintoapatternofbehaviorthatisknowntolikelyleadtosevereproblemsoracrash.Inpreviousworkwehaveaddressedproblems(1)and(2).Weassumeonlythatsomesubsetofthecomponentshavelogswithtime-stampedentries(everysystemwehaveseensatisﬁesthisrequirement).Theselogsareconvertedintotime-varyingsignalsthatarecorrelated,possiblywithatimedelay.Thestrengthofthecorrelationanddirectionofanydelaysallowadministratorstoanswermanyusefulqueriesabouthowandwhenvariouspartsofthesysteminﬂuenceeachother.Allofthiscomputation,however,isofﬂine[25],[27].Theprimarycontributionofthispaperisanonlinemethodforanalyzingandansweringquestionsaboutlargesystems.Ourapproachretainstheideaofcomputingcorrelationsanddelaysbetweencomponentsignals,butthesemanticandperformancerequirementsofanonlinesolutionresultinadifferentdesign.Inparticular,weuseanovelcombinationofonline,anytimealgorithmsthatmaintainconcisemodelsofhowcomponentsandsetsofcomponentsareinteractingwitheachother,includingthedelaysorlagsassociatedwiththoseinteractions.Thetypesofquestionsourmethodisabletoansweronlinewithouttheneedforspeciﬁcationsorinvasiveloggingandthescalabilityofourapproacharebothnew.Asystemconsistsofasetofcomponents,someofwhichareinstrumentedtorecordtimestampedlogentries.Theselogsareconvertedintoreal-valuedfunctionsoftimecalledanomalysignals,whichencodewhenmeasurementsdifferfromtypicalorexpectedbehavior.Theprocessofconvertingrawlogsintomeaningfulanomalysignalsishowtheuserencodeswhattheyknowaboutthesystemaswellaswhattheywanttounderstand.Forexample,ausermightwanttheanomalysignaltoinitiallyhighlightanunusualerrormessageandthenmuteitoncetheerrorisunderstood.Systemadministratorsarecomfortablewiththisnotionofanexploratorytool,whichtheycanadapttoreﬂectchangesinthesystem,intheirknowledgeofit,orinthequestionstheywanttoanswer.WhilewediscussthisfurtherinSection3.1,theprocessofconvertingrawmeasurementsintoanomalysignalsiswell-studiedforawidevarietyofdatatypes[11],[13],[15],[20],[25],[27],[39],[40]andthispaperfocusesinsteadonhowtouseanomalysignalstoefﬁcientlyinfercomponentinteractions.Ateverytime-steportick,wepassthemostrecentvalueofeveryanomalysignalthroughatwo-stageanalysis.Theﬁrststagecompressesthedatabyﬁndingcorrelatedgroupsofsignalsusinganonline,approximateprincipalcomponentanalysis(PCA)[30];wecallthesecomponentgroupssubsys-tems.Thisanalysisproducesanewsetofanomalysignals,calledeigensignals,withoneeigensignalcorrespondingtothebehaviorofeachsubsystem;inotherwords,thebehavioroftheentiresystemissummarizedusinganew,andmuchsmaller,setofsignals.Thesecondstagetakestheseeigensignals,andpossiblyasmallsetofadditionalanomalysignals(seeSectionIII-C1),andlooksforlagcorrelationsamongthemusinganonlineapproximationalgorithm[34].Althoughtheeigensignalsaremutuallyuncorrelatedbyconstruction,theymaybecorrelatedwithsomelag.Figure1showsanexamplewiththreesignalstakenfromaproductiondatabase(SQL)cluster:disk(anaggregatedsignalcorrespondingtodiskactivity),forks(correspond-ingtotheaveragenumberofforkedprocesses),andswap(correspondingtotheaveragenumberofmemorypage-ins).Theﬁrststageoftheanalysis,thePCA,automaticallyﬁndsthecorrelationbetweendiskandforksandgeneratesasingleeigensignalthatsummarizesbothoftheoriginalsignals.Thesecondstageoftheanalysistakestheeigensignalandswap’sanomalysignal,plottedinFigure2,anddiscoversacorrelation:surprisingbehaviorinthesubsystemconsistingofdiskandforkstendstoprecedesurprisingbehaviorinswap.Ouranalysis,ontheseandseveralrelatedsignals,helpedthesystem’sadministratordiagnoseaperformancebug:aburstofdiskswappingcoincidedwiththebeginningofagradualaccumulationofslowquerieswhich,overseveralhours,crossedathresholdandcrippledtheserver.Inadditiontohelpingwithadiagnosis,ourmethodcangiveenoughwarningoftheimpendingcollapsefortheadministratortotakeremedialaction(seeSectionV-D2).WedescribeourmethodinSectionIIIandevaluateitusingnearly100,000signalsfromeightunmodiﬁedproductionsystems(describedinSectionIV),includingfoursupercom-puters,twoautonomousvehicles,andtwodatacenterclusters.Ourresults,inSectionV,showthatwecanefﬁcientlyandaccuratelydiscovercorrelationsanddelaysinrealsystemsandinrealtime,andfurthermorethatthisinformationisoperationallyvaluable.II.RELATEDWORKThereisanextensivebodyofworkonsystemmodeling,especiallyoninferringthecausalordependencystructureofdistributedsystems.Ourmethoddistinguishesitselffrommostpreviousworkprimarilyinthatwelookforcorrelatedbehaviorcalledinﬂuenceratherthandependencies[2],[10],[35],[41].Twocomponentsshareaninﬂuenceifthereisacorrelationin60007000800090001000011000−202468TickValuediskforksswapFig.1:Threeexampleanomalysignals.Greaterdistancefromzero(average)correspondstomoresurprisingmeasurements.Thesignalsdiskandforksarestatisticallycorrelated.60007000800090001000011000−4−20246TickValueFirst EigensignalswapFig.2:Theﬁrsteigensignalandswap.Thedownwardspikeintheeigensignalconsistentlyhappensjustbeforethespikeinswap.theirdeviationsfromnormalbehavior;inﬂuenceisorthogonaltowhetherornotthecomponentssharedependencies.Ourpreviousworkhasshownthatinﬂuenceisstatisticallyrobusttonoisyormissingdataandcapturesimplicitinteractionslikeresourcecontention[27].Themaincontributionsofthispaperareincomputingboththestrengthanddirectionality(timedelay)ofinﬂuenceonline,scalingtotensofthousandsofsignals,andapplyingthistooltoseveraladministrationtasks.Previousworkondependencygraphstypicallyassumesthatthesystemcanbeperturbed(byaddinginstrumentationoractiveprobing),thattheusercanspecifythedesiredpropertiesofahealthysystem,thattheuserhasaccesstothesourcecode,orsomecombinationofthese(e.g.,[22],[36]).Wediscussworkthatfallsintoeachoftheseclassesingreaterdetailbelow.Inourexperience,itisoftenthecasethatnoneoftheseassumptionsholdinpractice.Onecommonthreadindependencymodelingworkisthatthesystemmustbeactivelyperturbedbyinstrumentationorbyprobing[4],[5],[8],[9],[33].Pinpoint[6],[7]andMagpie[3]trackcommunicationdependencieswiththeaimofisolatingtherootcauseofmisbehavior;theyrequireinstrumentationoftheapplicationtotagclientrequests.Inordertodeterminethecausalrelationshipsamongmessages,Project5[1]andWAP5[32]usemessagetracesandcomputedependencypaths(noneofthesystemswestudiedrecordedsuchinformation).D3S[21]usesbinaryinstrumentationtoperformonlinepredicatechecks.Otherworkleveragestightintegrationofthesystemwithcustominstrumentationtoimprovediagnosability(e.g.,theP2system[36])orrestrictthetooltoparticularkindsofsystems(e.g.,MapReduce[29]orwideareanetworks[12],[18],[19],[42]).Deterministicreplayisanothercommonapproach[14],[22]butrequiressupportinginstrumentation.Foralleightoftheproductionsystemswestudy,wecouldnotapplyanyoftheseexistingmethods,anditwasneitherpossiblenorpracticalforustoaddinstrumentation.Someapproachesrequiretheusertowritepredicatesin-dicatingwhatpropertiesshouldbechecked[21],[22],[36].Pip[31]identiﬁeswhencommunicationpatternsdifferfromexpectationsandrequiresanexplicitspeciﬁcationofthoseexpectations.Wehavenosuchcorrectnesspredicates,models,orspeciﬁcationsforanyofthesystemswestudy.Furthermore,weencounteredmanyinstanceswhereitwouldnothavebeenpossibletowriteasufﬁcientspeciﬁcationofcorrectbehaviorbeforediagnosingtheproblem—inotherwords,knowingwhatpropertytocheck(e.g.,creatingamodelsuitableformodelchecking)wasequivalenttounderstandingtherootcause.Recentworkshowshowaccesstosourcecodecanfacilitatetaskslikeloganalysis[40]anddistributeddiagnosis[16].ItisworthnotingthatXuetal.recentlyalsousedprincipalcomponentanalysisintheirwork[39];theyuseittoidentifyanomalouseventpatternsratherthanﬁndingrelatedgroupsofreal-valuedsignals.Althoughoursystemcouldbeextendedtotakeadvantageofaccesstosourcecode,manysystemsinvolveproprietary,third-party,orclassiﬁedsoftwareforwhichsourcecodeisunavailable.Apassive,black-boxtechniquelikeourshastwopotentialdrawbacksincomparisonwithusingdependencies.First,itcanonlyinfercorrelation,whichdoesnotimplycausality.Dependency-basedtechniquesactuallytrackcauseandeffectandcansaywithcertaintythatcertaineventscausedothereventstohappen.Second,thecorrelationsareonlyasgoodasthelogdata,andlessinformationaboutfewercompo-nentswilltypicallyyieldfewerandweakercorrelations.Inpractice,however,wehavefoundthatadministratorsalreadygatherenoughinformationforourapproachtodiscoverusefulcorrelationsandtoimplycausalityusingtemporalordering.InSectionsV-CandV-D,wedemonstraterealsituationsinwhichourmethodprovideshigh-quality,actionableinformation,de-spitethesepotentiallimitations.Manyinterestingproblemsinsystemsarisewhencompo-nentsareconnectedorcomposedinwaysnotanticipatedbytheirdesigners[23].Assystemsgrowinscale,thesparsityofinstrumentationandcomplexityofinteractionsincreases.Ourtechniqueinfersabroadclassofinteractionsinunmodiﬁedproductionsystems,online,usingexistinginstrumentation.OurmethodusesanonlineprincipalcomponentanalysisadaptedfromSPIRIT[30]andalagcorrelationdetectionalgorithmcalledEnhancedBRAID[34].Weselectedthesetechniquesbecausetheymakeonlyweakassumptionsabouttheinputdataandhavegoodperformanceandscalabilitychar-acteristics.Thispaperemploysthosetwomethodsinseveralnovelways:usingthePCAasadimensionalityreductiontomakethelagcorrelationscalable,analyzinganomalysignalsratherthanrawdataastheinputtopermitthecomparisonofheterogeneouscomponentsandtheencodingofexpertknowledge,addingamechanismforbypassingthePCAstagethatweuseforstandingqueries,and,ﬁnally,applyingthesetechniquesinthecontextofunderstandingproductionsystems.III.METHODOurmethodtakesadifﬁcultproblem—understandingthecomplexrelationshipsamongheterogeneouscomponentsgen-Stage 1:SignalCompressionStage 2:LagCorrelationWatch List!1!2!n...nkmEigensignals, Weights,& Watched SignalsLagsFig.3:Ourmethodtakesnanomalysignalsandpassesthemtoasignalcompressionstage(performedusingprincipalcomponentanalysis).Itthentakestheresultingkeigensignalsandthoseonthewatchlistandpassesthesemsignalstoalagcorrelationdetector.Thelistedoutputvaluesareallavailableatanytime.eratingheterogeneouslogs—andtransformsitintoawell-formedandcomputableproblem:understandingthevarianceinasetofsignals.Theinputtoourmethodisasetofsignalsforwhichvariancecorrespondstobehaviorlackingasatisfactoryexplanation.Theﬁrststageofourmethodtriestoexplainthevarianceofonesignalusingthevarianceofothersignals;thestandardtechniquefordoingthisiscalledprincipalcomponentanalysis(PCA).However,PCAwillmisssignalsthatco-varywithsomedelayorlag.Thesecondstageofourmethodidentiﬁessuchlaggedcorrelations.Furthermore,weshowhowtoencodeandanswermanynaturalquestionsaboutasystemintermsoftimevaryingsignals.Considerasystemofcomponentsinwhichasubsetofthesecomponentsaregeneratingtimestampedmeasurementsthatdescribetheirbehavior.Thesemeasurementsarerepre-sentedasreal-valuedfunctionsoftimecalledanomalysignals(seeSectionIII-A).Ourmethodconsistsoftwostagesthatarepipelinedtogether:(i)anonlinePCAthatidentiﬁesthecontributionsofeachsignaltothebehaviorofthesystemandidentiﬁesgroupsofcomponentswithmutuallycorrelatedbehaviorcalledsubsystems(seeSectionIII-B)and(ii)anonlinelagcorrelationdetector,whichdetermineswhetheranyofthesesubsystemsare,inturn,correlatedwitheachotherwhenshiftedintime(seeSectionIII-C).Figure3providesanoverviewofourapproach.A.AnomalySignalsTheinputtoourmethodistimestampedmeasurementsfromcomponents.Themeasurementsfromaparticularcomponentareusedtoconstructananomalysignal.Thevalueofananomalysignalatagiventimerepresentshowunusualorsurprisingthecorrespondingmeasurementswere:thefurtherfromthesignal’saveragevalue,themoresurprising.Aswithanyabstraction,anomalysignalsareusedtohidedetailsoftheunderlyingdatathatareirrelevantforansweringaparticularquestion.Thus,thereisnosingle“correct”anomalysignal,asanyfeatureofthelogmaybeusefulforansweringsomequestion.Theabstractionmayonlylessen,ratherthanremove,unwantedcharacteristicsandmayunintentionallymuteimportantsignals,butthepurposeoftheanomalysignalabstractionistohighlightthebehaviorswewishtounderstand,especiallywhenandwheretheyareoccurringinthesystem.Somemeasurementsrequireaprocessingsteptomakethemnumerical(seeSectionIII-A1).Intheabsenceofanyspecialknowledgeaboutthesystemorthemechanismsthatgeneratedthedata,wehavefoundthatanomalysignalsbasedonstatisticalproperties(e.g.,thefrequencyofparticularwordsinatextuallog)workquitewell.Administratorsdonottypicallyhaveacompletespeci-ﬁcationofexpectedbehavior:systemsaretoocomplicatedandchangetoofrequentlyforsuchaspeciﬁcationtobeconstructedormaintained.Instead,theyoftenhaveshortlistsofrulesaboutwhatkindsofeventsinthelogsareimportant.Anomalysignalsallowthemtoencodethisinformation(seeSectionIII-A1a).Asinglephysicalorlogicalcomponentmayproducemulti-plesignals,eachofwhichhasanassociatedname.Forexam-ple,aservernamedhost1mayberecordingbandwidthmea-surementsaswellassyslogmessages,sothecorrespondingsignalsmightbenamedhost1-bwandhost1-syslog,respectively.Asinglemeasurementstreammaybeusedtoconstructmultipleanomalysignals:atextlogmighthaveonesignalforhowunusualthemessagesare,overall,andanothersignalforthepresenceorabsenceofaparticularmessage.Conversely,wedon’tassumethatallcomponentshaveatleastonesignal,andeveryrealsystemwehaveexaminedhasmultiplecomponentsthatareuninstrumented.Infact,somecomponentswereevenunknowntotheadministrators.Forthisreason,wecan’tusetechniquesthatassumeinstrumentationforandknowledgeofallcomponentsinthesystem.1)DerivedSignals:Non-numericaldatalikelogmessagesorcategoricalstatesmustbeconvertedintoanomalysignals.Thisprocessiswell-studiedforcertaintypesofdata,e.g.,unstructuredorsemi-structuredtextlogs[39],[40].WeusetheNodeinfoalgorithm[26]fortextuallogsandaninformation-theoretictiming-basedmodel[27]fortheembeddedsystems(autonomousvehicles),asbothalgorithmshighlightirregular-itiesinthedatawithoutrequiringadeepunderstandingofit.Usersmayoptionallypreprocessnumericalsignalstoen-codewhataspectsofthemeasurementsareinterestingandwhicharenot.Forexample,dailytrafﬁcﬂuctuationsmayincreasevariance,butthisisnotsurprisingandmaybeﬁlteredoutoftheanomalysignal.Weapplynosuchﬁltering.Althoughnumericalsignalscanbeuseddirectlyandthereareexistingtoolsforgettinganomalysignalsoutofcommondatatypes,themoreexpertknowledgetheuserappliestogenerateanomalysignalsfromthedata,themorerelevantourresults.Inparticular,theadministratorsofoursystemsmaintainedlistsoflogmessagepatternsthattheybelievecorrespondtoimportanteventsandtheyhadageneralun-derstandingofsystemtopologyandfunctionality;wenowdiscusshowthatknowledgecanbeusedtogenerateadditionalanomalysignalsfromtheexistinglogdata.a)IndicatorSignals:Ausercanencodeknowledgeofinterestinglogmessagesusingasignalthatindicateswhetherapredicate(e.g.,aspeciﬁccomponentgeneratedamessagecontainingthestringERRinthelastﬁveminutes)istrueorfalse[25].Althoughthisisthesimplestwaytoencodeexpertknowledgeaboutalog,indicatorsignalshaveproventobebothﬂexibleandpowerful.SectionV-C4givesanexampleofhowindicatorsignalscanelucidatesystem-widepatterns.b)AggregateSignals:Ausercanencodeknowledgeofsystemtopology(e.g.,asetofsignalsareallgeneratedbycomponentsinasinglemachinerack)bycomputingthetime-wiseaverageofthosesignals.Thisnewsignalrepresentstheaggregatebehavioroftheoriginalsignals;thetime-averageofcorrelatedsignalswilltendtolookliketheconstituentsignalswhiletheaverageofuncorrelatedoranti-correlatedsignalswilltendtowardaﬂatline.Thishasbeenshowntobeausefulwayfortheusertodescribefunctionally-ortopologically-relatedsetsofsignals[25],andweseeinSectionV-Cthattheseaggregatesignalsoftensummarizeimportantbehaviors.B.Stage1:SignalCompressionAsystemmayhavethousandsofanomalysignals,sobeingabletoefﬁcientlysummarizethemusingonlyasmallnumberofsignals,withminimallossofinformation,isvaluabletousersofourapproachandsometimesnecessarytoachieveadequateonlineperformance.Tocompresstheanomalysignalswithminimallossofinfor-mation,theﬁrststageofouranalysisperformsanapproximate,onlineprincipalcomponentanalysis(PCA)[30].Thisstagetakesthenanomalysignals,wherenmaybelarge,andrepresentsthemasasmallnumberkofnewsignalsthatarelinearcombinationsoftheoriginalsignals.Thesenewsignals,whichwecalleigensignals,arecomputedsothattheycaptureordescribeasmuchofthevarianceintheoriginaldataaspossible;theparameterkissettobeaslargeascomputingresourcesallowtominimizeinformationloss.Thisstageisonline,any-time,single-pass,anddoesnotrequireanyslidingwindowsorbuffering.Althoughwereferthereadertotheoriginalpaperfordetails[30],weincludeabriefsummaryhereforcompleteness.ThePCAmaintains,foreacheigensignal,avectorofweightsoflengthn,wherenisthenumberofanomalysignals.Ateachtick(timestep),foreacheigensignal,avectorcontainingthemostrecentvalueofeachanomalysignalisprojectedontotheweightvectortoproduceavaluefortheeigensignal.Theeigensignalsandweightsarethenusedtoreconstructanapproximationoftheoriginalnsignals.Acheckensurestheresultingreconstructionhasanenergythatissufﬁcientlyclosetothatoftheoriginalsignals;ifnot,theweightsareadjustedsothatthey“track”theanomalysignals.ThetimeandspacecomplexityofthismethodonnsignalsandkeigensignalsisO(nk).Aneigensignalanditsweightsdeﬁneabehavioralsubsystem:alinearcombinationofrelatedsignals.RecalltheexamplefromSectionI.Theﬁrststagegroupsdiskandforksinthesamesubsystem,andinfactthesetwosignalsarehighlycorrelated.Atthispoint,however,thereisnoapparentrelationshipwiththeswapcomponent.NotethatalthoughPCAwilltendtogroupcorrelatedsignalsbecausethisefﬁcientlyexplainsvariance,twosignalsbeinginthesamesubsystemdoesnotimplythattheyarehighlycorrelated.Thisiseasilychecked,thoughweomitthedetails.Ithasbeenourexperiencethatthesignalswithsigniﬁcantweightinasubsystemareallwell-correlated,whichisalsothejustiﬁcationforpickingthemostheavilyweightedsignalinasubsystemastherepresentativeofthatsubsystem(seeSectionV-C3).1)Decay:ThePCAstagetakesanoptionalparameterthatcausesoldmeasurementstobegraduallyforgotten,sothesubsystemswillweightrecentdatamorethanolderdata.Thisdecayparameterissetto1.0bydefault,whichmeansallhistoricaldataisconsideredequallyintheanalysis.Previousworkusedadecayparameterof0.96[30].Inourexperiments,wesay‘nodecay’toindicateadecayvalueof1.0and‘decay’toindicate0.96.Note,however,thatwedonotexplicitlyretainhistoricaldata,ineithercase.Decayisusefulformorecloselytrackingrecentchanges(seeSectionV-C5)andforstudyingthosechangesovertime(seeSectionV-C1);ifneeded,aninstanceofthecompressionstagewithdecaycanberuninparalleltoonewithout.Weusenodecayexceptwhereotherwiseindicated.C.Stage2:LagCorrelationTheﬁrststageofourmethodextractscorrelationsamongsignalsthataretemporallyaligned,butdelayedeffectsorclockskewsmaycausecorrelationstobemissed.Thesecondstageperformsanapproximate,onlinesearchforsignalscorrelatedwithalag[34];thatis,signalsthatarecorrelatedwhenoneisshiftedintimerelativetotheother.Again,wedescribethelagcorrelationstagehereforcom-pleteness,butreferthereadertotheoriginalpaperfordetails[34].Thecross-correlationbetweentwosignalsgivesthecorrelationcoefﬁcientsfordifferentlags;thecross-correlationcanbeupdatedincrementally,whileretainingonlyasetofsufﬁcientstatisticsaboutthetwoinputsignals.Toreducetherunningtime,lagiscomputedonlyatasubsetoflagvalues,chosensothatsmallerlagsarecomputedmoredenselythanlargerlags.Toreducespaceconsumption,lagsarecomputedonsmoothedapproximationsoftheoriginalsignals.Theseop-timizationsyieldasymptoticspeedupsandtypicallyintroducelittletonoerror(seeSectionV-D3).Therunningtime,pertick,isO(m2),wheremisthenumberofsignals.ThespacecomplexityisO(m2logt),wheretisthenumberofticks.Oneoftheinsightsofourapproachisthat,withoutﬁrstreducingthedimensionalityoftheproblem,largesystemswouldgeneratetoomanysignalsforlagcorrelationtobepractical;oneoftheprimarypurposesofthePCAcomputationistoperformthisdimensionalityreduction.Oncetheproblemisreducedtoeigensignalsandperhapsasmallsetofothersignals(seeSectionIII-C1),lagcorrelationcanoftenbecomputedmorequicklythanthePCA(seeSectionV-A).Inotherwords,theﬁrststageofourmethodensuresm<<nandmakeslagcorrelationpracticalforlargesystems.RecalltheexamplefromSectionI.Thelagcorrelationstageﬁndsatemporalrelationshipbetweenthesubsystemconsistingofdiskandforksandthecomponentswap,speciﬁcallythatanomaliesintheformertendtoprecedethoseinthelatter.1)WatchList:Thewatchlistisasmallsetofsignalsthat,inadditiontotheeigensignals,willbecheckedforlagcorrelations.Thesesignalsbypassthecompressionstage,whichenablesustoaskquestions(standingqueries)aboutSystemCompsLogLinesTimeSpanBlueGene/L131,0724,747,963215:00:00:00Thunderbird9024211,212,192244:00:00:00Spirit1028272,298,969558:00:00:00Liberty445265,569,231315:00:00:00MailCluster33423,895,49910:00:05:00Junior2514,892,27505:37:26Stanley1623,465,67709:06:11SQLCluster9116,785,52509:00:47:00TABLEI:Thesevenunmodiﬁedproductionsystemlogsusedinourcasestudies.The‘Comps’columnindicatesthenumberoflogicalcomponentswithinstrumentation;somedidnotproducelogs.Realtimeisgivenindays:hours:minutes:seconds.speciﬁcsignalsandtoassociateresultswithspeciﬁccom-ponents.Thereareseveralwaysforasignaltoenduponthewatchlist:manualaddition(e.g.,ausercomplainsthatacertainmachinehasbeenmisbehaving),automaticadditionbyrule(e.g.,ifthetemperatureofsomecomponentexceedsathreshold),orautomaticbyselectingrepresentativesforthesubsystems(seeSectionV-C3).Asubsystem’srepresentativesignalistheanomalysignalwiththelargestabsoluteweightinthesubsystemthatisnottherepresentativeofanearlier(stronger)subsystem.Inourexperiments,weautomaticallyseedthewatchlistwiththerepresentativeofeachsubsystem.D.OutputTheoutputofourmethodisthebehavioralsubsystems,theirbehaviorovertimeaseigensignals,andlagcorrelationsbetweenthoseeigensignalsandsignalsonthewatchlist.Theﬁrststageproduceskeigensignalsandtheirweights.Thesecondstageproducesalistofpairsofsignalsfromamongtheeigensignalsandthoseonthewatchlistthathavealagcorrelation,aswellasthevaluesofthoselagsandcorrelations.Thisoutputisavailableatanytimeduringexecution.IV.SYSTEMSWeevaluateourmethodondatafromeightproductionsystems:foursupercomputers,twodatacenterclusters,andtwoautonomousvehicles.TableIsummarizesthesesystemsandlogs,describedinSectionsIV-A–IV-Candelsewhere[24],[25],[26],[28],[37],[38].Forthiswidevarietyofsystems—withoutmodifying,instrumenting,orperturbingtheminanyway—ourmethodbuildsonlinemodelsofcomponentandsubsysteminteractions,andweusetheseresultsforseveralsystemadministrationtasks.Thefocusofthispaperisonhowtoanalyzeanomalysignalsonlinetoidentifymulti-componentinteractions,ratherthanhowtogeneratethoseanomalysignalsintheﬁrstplace,so—foreverysystem—weusetheresultsofpreviousworktopickalgorithmstoconvertrawdataintoanomalysignalsandforpickingpredicatestogenerateindicatorsignals[25],[26],[27].ThesedataaresummarizedinTableII.Ithasbeenourexperiencethattheresultsofourmethodarenotstronglysensitivetochoicesofthesealgorithms;foranyreasonablechoiceofanomalysignals,ourmethodtendstogroupsimilarcomponentsanddetectsimilarlags.SystemTicksTick=SignalsAgg.Ind.BlueGene/L29851hr69,08767245Thunderbird36391hr18,395713,573Spirit11,1931hr409473569Liberty53621hr3724124MailCluster14,4051min1394102Junior488,2490.04s2500Stanley821,8970.04s1600SQLCluster13,0071min3682634TABLEII:Summaryoftheanomalysignalsforthisstudy.Weomitticksinwhichnologsweregenerated.The‘Signals’columnindicatesthetotalnumberofanomalysignals,whichincludestheaggregate(‘Agg.’)andindicator(‘Ind.’)signals.A.SupercomputersWeusepublicly-availablelogsfromsupercomputersthatwereinproductionuseatnationallaboratories[37].Thesefoursystems,namedLiberty,Spirit,Thunderbird,andBlueGene/L(BG/L),varyinsizebyseveralordersofmagnitude,rangingfrom512processorsinLibertyto131,072processorsinBG/L.Thelogswererecordedduringproductionuseofthesesystemsandwemakenomodiﬁcationstothem,whatsoever.Anextensivestudyoftheselogscanbefoundelsewhere[28].Thelogmessagesbelowweregeneratedconsecutivelybynodesn313oftheSpiritsupercomputer:Jan101:18:56sn313/sn313kernel:GM:Thereare1activesubportsforport4atclose.Jan101:19:00sn313/sn313pbs_mom:task_check,cannottm_replyto7169.sadmin2task1Weuseanalgorithmbasedonthefrequencyoftermsinlogmessages[26]togenerateanomalysignalsfromtherawdata.Thisisareasonablealgorithmtouseifnothingisknownofthesemanticsofthelogmessages;lessfrequentsymbolscarrymoreinformationthanfrequentones.Wegenerateindicatorsignalscorrespondingtoknownalertsinthelogs[26]usingaprocessdescribedindetailelsewhere[25].Thesesignalsindicatewhenthesystemorspeciﬁccom-ponentsgenerateamessagematchingaregularexpressionthatisknowntocorrespondtointerestingbehavior.Forexample,onemessagegeneratedbyBlueGene/Lreads,inpart:excessivesoftfailures,considerreplacingthecardTheadministratorsareawarethatthisso-calledDDR_EXCalertindicatesaproblem.Wegenerateoneanomalysignal,calledDDR_EXC,thatishighwheneveranycomponentofBG/Lgeneratesthisalert;foreachsuchcomponent(e.g.,node1),therearealsocorrespondinganomalysignalsthatarehighwheneverthatcomponentgeneratesthealert(callednode1/DDR_EXC)andwheneverthatcomponentgeneratesanyalert(callednode1/*).Wealsogenerateaggregatesignalsforthesupercomputersbasedonfunctionalortopologicalgroupingsprovidedbytheadministrators.Forexample,Spirithasaggregatesignalsfortheadministrativenodes(admin),thecomputenodes(compute),andtheloginnodes(login).ForThunderbirdandBG/L,wealsogenerateanaggregatesignalforeachrack.B.ClustersWealsoobtainedlogsfromtwoclustersatStanfordUni-versity:17machinesofacampusemailroutingserverclusterand9machinesofaSQLdatabasecluster.Ofthe17mailclusterservers,16recordedtwotypesoflogs:asendmailserverlogandaPureMessagelog(aspamandvirusﬁlteringapplication).Onesystemrecordedonlythemaillog.TheSQLclusterwasuniqueamongthesystemswestudiedinthatitrecorded(atotalof271)numericalmetricsusingtheMuninresourcemonitoringtool(e.g.,bytesreceived,threadsactive,andmemorymapped).Forexample,thefollowinglinesarefromthememoryswapmetric:2009-12-0523:30:006.5536000000e+042009-12-0600:00:006.3502367774e+04Eachsuchnumericallogwasusedwithoutmodiﬁcationasananomalysignal.Togenerateanomalysignalsforthenon-numericcontentoftheselogs,weusethesameterm-frequencyalgorithmasinSectionIV-A.Aswiththesupercomputers,wegenerateindicatorsignalsforthetextualpartsoftheclusterlogs.Unlikethesupercom-puters,however,therearenoknownalerts,soweinsteadlookforthestrings‘error’,‘fail’,and‘warn’andnamethesesignalsERR,FAIL,andWARN,respectively.Thesestringsmayturnouttobesubjectivelyunimportant,butaddingthemtoouranalysisisinexpensive.Wealsogenerateaggregatesignalsbasedonfunctionalgroupingsprovidedbytheadministrators.Forexample,themailclusterhasoneaggregatesignalfortheSMTPlogsandanotherforthespamﬁlteringlogs;similarly,weaggregatedisk-relatedlogsintheSQLclusterintoasignalcalleddisk,memory-relatedlogsintomemory,etc.C.AutonomousVehiclesStanleyistheautonomousdiesel-poweredVolkswagenTouaregR5developedatStanfordUniversitythatwontheDARPAGrandChallengein2003[38].Amodiﬁed2006VolkswagenPassatwagonnamedJuniorplacedsecondinthesubsequentUrbanChallenge[24].Thesedistributed,em-beddedsystemsconsistofmanysensorcomponents(e.g.,lasers,radar,andGPS),aseriesofsoftwarecomponentsthatprocessandmakedecisionsbasedonthesedata,andinterfaceswiththecarsthemselves(e.g.,steeringandbraking).Inordertopermitsubsequentreplayofdrivingscenarios,someofthecomponentswereinstrumentedtorecordinter-processcommunication.Theselogmessagesindicatetheirsource,butnottheirdestination(therearesometimesmultipleconsumers).WeusetherawlogsfromtheGrandChallengeandUrbanChallenge,respectively.ThefollowinglinesarefromStanley’sIntertialMeasurementUnit(IMU):IMU-0.001320-0.016830-0.959640-0.0127860.0110430.0034871128775373.612672rr10.046643IMU-0.002970-0.015510-0.958980-0.0162730.0058120.0017441128775373.620316rr10.051298Intheabsenceofexpertknowledge,wegenerateanomalysignalsbasedondeviationfromwhatistypical:unusualtermsintext-basedlogsordeviationfromthemeanfornumerical!!!!!!!!!!!!1e+025e+025e+035e+045e+0535404550Ticks (log scale)Ticks per Second!No DecayDecayFig.4:UsingpreﬁxesofStanley’sdata(n=16),weseethatcompressionrateisnotafunctionofthenumberofticks.!!!!!!!!5e+031e+042e+045e+041e+052e+055e+051e+060200600Ticks (log scale)Ticks per Second!No DecayDecayFig.5:Thelagcorrelationcomputationisnotafunctionofthenumberofticks(n=20).Eachpairofdatapointscorrespondstooneofourstudiedsystems.logs.Stanley’sandJunior’slogscontainedlittletextandmanynumbers,soweinsteadleverageadifferentkindofregularityinthelogs,namelytheinterarrivaltimesofthemessages.Wecomputeanomalysignalsusinganexistingmethodbasedanomalousdistributionsofmessageinterarrivaltimes[25].Wegeneratenoindicatororaggregatesignalsforthevehicles.V.RESULTSOurresultsshowthatwecaneasilyscaletosystemswithtensofthousandsofsignalsandthatwecandescribemostofasystem’sbehaviorwitheigensignalsthatareordersofmagni-tudesmallerthantheoriginaldata;thebehavioralsubsystemsandlagsourmethoddiscoverscorrespondtorealsystemphenomenaandhaveoperationalvaluetoadministrators.Inthispaper,weuseastatick=20eigensignalsratherthanattempttodynamicallyadaptthisnumbertomatchthevarianceinthedata(assuggestedelsewhere[30]).Itwasourexperiencethatsuchadaptationresultedinoverlyfrequentchangestok.Instead,wesetktothelargestvalueatwhichtheanalysisisabletokeepupwiththerateofincomingdata.Forthesystemthatgenerateddataatthehighestrate(Junior),thisnumberwasapproximately20,andweusethisvaluethroughout.AsstatedinSectionsIII-B1andIII-C1,wetestdecayvaluesof1.0(‘nodecay’)and0.96(‘decay’)inagreementwithpreviouswork,andweautomaticallyseedthewatchlistwithrepresentativesfromthesubsystems,exceptwherenoted.WeperformedallexperimentsonaMacProwithtwo2.66GHzDual-CoreIntelXeonsand6GB667MHzDDR2FB-DIMMmemory,runningMacOSXversion10.6.4,usingaPythonimplementationofthemethod.SectionV-AdescribestheperformanceofouranalysisintermsoftimeandSectionV-Bdiscussesthequalityoftheresults;wefocusinthesesubsectionsonthemechanismsoftheanalysis,ratherthantheirapplications.Then,inSectionsV-C–V-D,wediscussusecasesforourmethodwithexamplesfrom!!!!!!!!2050100200500100050002000050000010203040Signals (log scale)Ticks per Second!No DecayDecayFig.6:Therateoftickspersecondforthecompressionstagedecreasesslowlywiththenumberofsignals;autoregressiveweighting(decay)hasnoeffectonrunningtime.!!!!!!!!2050100200500100050002000050000110010000Signals (log scale)Rate Ratio (log scale)!No DecayDecayFig.7:Althoughthecompressionratedecreaseswiththenumberofsignals,largersystemstendtoupdatemeasurementslessfrequently.Theratiobetweencompressionrateandmeasurementgenerationrate,plotted,showsthatthebiggersystemsareeasiertohandlethanthe25ticks-per-seconddatarateoftheembeddedsystems.thedata.Thereareavarietyoftechniquesforvisualizingtheinformationproducedbyouranalysis(e.g.,graphs[25]);thissectionfocusesinsteadontheinformationourmethodproducesandtheusesofthatinformation.A.PerformanceOurmethodiseasilyabletokeepupwiththerateofdataproductionforallthesystemsthatwestudied.Theperformancepertickdoesnotdegradeovertime.Figures4and5showprocessingrateintickspersecondforthesignalcompressionandlagcorrelationstages,respectively.Acrossmorethanthreeordersofmagnitudeofticks,from100toaround821,000,thereisnochangeinperformance.Thisisincontrasttothena¨ıvePCAalgorithm,whoserunningtimegrowslinearlywithnumberofticks.Thecompressionstagescaleswellwiththenumberofsig-nals(seeFigure6).Forsystemswithafewdozencomponents,theentirePCAstatecanbeupdateddozensoftimespersecond.Evenwith70,000signals,oneticktakesonlyaround5seconds.Forsuchlargersystems,however,theper-componentrateatwhichinstrumentationdataisgeneratedtendstobeslower,aswell.Werequiretherateofprocessingtoexceedtherateofdatageneration.Asnotedabove,wechoseanumberofsubsystemsthatguaranteedthisrateratiowasgreaterthan1forallthesystemswestudied.Theinterestingfactisthatformanyofthelargersystemstheratiowasmuchhigher(seeFigure7).Inotherwords,thecompressionstageissufﬁcientlyfasttohandletensofthousandsofsignalsthatupdatewithrealisticfrequency.Infact,itwasJunior,oneofthesmallersystems,thathadthesmallestratioofaround1.14.Junior’s25anomalysignalswereupdating25timespersecond.Intheeventthatasystemweretoproducedatatooquickly,eitherbecauseofthetotalnumberofsignalsorbecauseoftheupdatefrequency,wecouldreducethenumberofsubsystems!!!!!!!!!1020501002005505005000Signals (log scale)Ticks / Second (log scale)!No DecayDecayFig.8:Therateoflagcorrelationprocessingdecreasesquicklywiththenumberofsignals.(Notethelog-logscale.)Ourmethoduseseigensignalsandawatchlisttokeepthenumberofsignalssmall.0e+002e+054e+056e+058e+050.00.40.8TickEnergy FractionFig.9:ThecumulativefractionoftotalenergyinStanley’sﬁrstkeigensignals.Thebottomlineshowstheenergycapturedbytheﬁrsteigensignal;thelineabovethatisfortheﬁrsttwoeigensignals,etc.(k),reducethesizeofthewatchlist,orreducetheanomalysignalsamplingrate.Thiswasnotnecessaryforanyofoursystems.Notethatburstsintherawlogdata,whichcanexceedtheaveragemessageratebymanyordersofmagnitude,areabsorbedbytheanomalysignalanddonotfactorintothisdiscussionofdatarate.Furthermore,webelievethatfutureworkcouldparallelizebothstagesofouranalysis,yieldingevenbetterperformance.AsFigure8shows,thelagcorrelationstagescalespoorlywiththenumberofsignals.Tryingtorunitonall69,087signalsfromBG/L,forexample,isintractable.Ourmethodskirtsthisproblembyfeedingthelagcorrelationstageonlymsignals:theeigensignalsandsignalsonthewatchlist.Theverticallineat40signalsrepresentsthenumberweuseformostoftheremainingexperiments:20eigensignalsand20representativesignalsinthewatchlist.Ourmethodscalestosupercomputer-scalesystemsbecausem<<n.B.EigensignalQualityPreviousworkusesameasurecalledenergytoquantifyhowwelltheeigensignalsdescribetheoriginalsignals[17],[30].Letxτ,ibethevalueofsignaliattimeτ.TheenergyEtattimetisdeﬁnedasEt:=1ttτ=1ni=1x2τ,i.Byprojectingtheeigensignalsontotheweights,wecanreconstructanapproximationoftheoriginalnanomalysig-nals.Iftheeigensignalsareideal,thentheenergyofthereconstructedsignalswillbeequaltotheenergyoftheoriginalsignals;inpractice,usingk<<neigensignalsandonlineapproximationsmeansthatthisfractionofreconstructionenergytooriginalenergywillbelessthanone.Considertheautonomousvehicle,Stanley,whichhas16originalsignals.Figure9showstheenergyratiofortheﬁrstteneigensignals;thelowestlineisfortheﬁrsteigensignalonly,thelineabovethatrepresentstheﬁrsttwoeigensignals,thentheﬁrstthree,andsoon.Figure10showstheincremental0e+002e+054e+056e+058e+050.00.40.8TickEnergy Fractionk =1234Fig.10:TheincrementaladditionalenergycapturedbyStanley’sktheigensignal,giventheﬁrstk−1.0500100015002000250030000.00.40.8TickEnergy FractionFig.11:ThecumulativefractionoftotalenergyinBG/L’sﬁrstkeigensignals.Theﬁrstteneigensignalssufﬁcetodescribemorethan90%oftheenergyinthesystem’s69,087signals.energyfraction;thatis,thelinefork=3showstheamountofincreaseintheenergyfractionoverusingk=2.Nearthebeginningofthelog,thePCAisstilllearningaboutthesystem’sbehaviors,sotheenergyfractioniserratic.Overtime,however,theratiostabilizes.Theseexperimentswerewithoutdecay,sotheenergyfractionsshowhowwellthecompressionstageisabletomodelallthedataithasseensofar.Theﬁrstteneigensignalsareabletomodelalmost100%oftheenergyofStanley’s16originalsignals(i.e.,almost38%oftheinformationintheanomalysignalswasredundant).Forlargersystems,weﬁndmoresignalstendtobecor-relatedandthenumberofeigensignalsneededperoriginalsignaldecreases.ConsiderthecumulativeenergyfractionplotforBG/LinFigure11,whichshowsthattheﬁrsteigensignal,alone,containsroughly33%ofalloftheenergyinthesystem.Figure12showswhatfractionofenergyiscapturedbytheﬁrstkeigensignalsasafunctionofkn.Inotherwords,ifwethinkoftheﬁrststageofourmethodaslossycompression,theﬁgureshowshowefﬁcientlywearecompressingthedataandwithwhatlossofinformation.ForsystemslikeBG/L,withmanycorrelatedsubsystems,wecandescribemostofthebehaviorwithatinyfractionoftheoriginaldata.Whenweletolddatadecay(seeFigure13),twentyeigensignalsisenoughtobringtheenergyfractiontonearlyone;forthelargersystems,thismeanswearecompressingbyordersofmagnitudewithminimalinformationloss.C.BehavioralSubsystemsInthissection,wediscusssomepracticalapplicationsoftheoutputoftheﬁrststageofouranalysis:thebehavioralsubsystems.Aneigensignaldescribesthebehaviorofasubsys-temovertime;theweightsofthesubsystemcapturehowmucheachoriginalsignalcontributestothesubsystem.Componentsmayinteractwitheachothertovaryingdegrees,andournotionofasubsystemreﬂectsthisfact.! !!!!!!!!!!!!!!!!
!
!
n
o
i
t
c
a
r
F
y
g
r
e
n
E
8
.
0
4
.
0
0
.
0
!
1e−05
! BG/L
Thunderbird
Spirit
Liberty
Mail
Junior
Stanley
SQL
i
t
h
g
e
W
6
.
0
4
.
0
2
.
0
0
.
0
1e−03
1e−01
1e+01
CAN2
GPS_COMP
GPS_VEL
EKF_POSE
GPS_POS
HEART
IMU
LASER2
LASER4
PLANNER_TRAJ
TEMP
LASER1
LASER3
PLANNER_INFO
TARGET
TOUAREG_ACT
Representation Size Fraction (log scale)
Fig. 12: The fraction of energy captured by the ﬁrst 20 eigensignals,
plotted versus the size of those signals as a fraction of the total input
data. (Note that Stanley only has 16 components and therefore only
16 eigensignals.)
Signal
Fig. 14: Weights for Stanley’s ﬁrst
three subsystems. The left
bar indicates the absolute weight of that signal’s contribution to
the subsystem; the second bar indicates its weight in the second
subsystem, etc.
!!!!!!
!!!!!
!
!
!
n
o
i
t
c
a
r
F
y
g
r
e
n
E
8
.
0
4
.
0
0
.
0
!
1e−05
! BG/L
Thunderbird
Spirit
Liberty
Mail
Junior
Stanley
SQL
i
t
h
g
e
W
6
.
0
4
.
0
2
.
0
0
.
0
1e−03