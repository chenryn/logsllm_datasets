对于企业级用户，入侵者主要是通过Web进行攻击，具体手段大致可分成三类：一类是针对Web应用进行攻击，主要是利用Weblogic、Apache、Dupal等前端应用存在的漏洞。第二类是攻击Web中的数据库，利用数据库进行提权，为后续攻击做好准备。第三类是直接攻击操作系统，获取管理员权限。比如著名的挖矿木马“PhotoMiner”，就是通过直接攻击服务器的方式进行传播。自2016年发现至今，已累计挖取门罗币8万枚以上，使黑客累计获得了近9千万人民币的收益。由此可见挖矿行为能为黑客带来巨大收益，因此挖矿木马攻击深受黑客青睐。
其实无论采用哪种手段，黑客都是为了窃取受害者的硬件资源搭建挖矿集群，在用户不知情的情况下进行非法挖矿。由于挖矿需要进行大量复杂的运算，因此会使硬件设备处于高负荷的运行状态，不仅会影响用户正常使用，还会严重影响硬件使用寿命导致硬件损坏。对于企业级用户，挖矿木马在影响业务系统正常运行的同时，更多的是带来了潜在的安全隐患，使得企业用户完全暴露在黑客攻击的威胁之下，随时面临着被进一步攻击的风险。因此提升信息系统安全性，保障数据安全已经刻不容缓。
针对数据库的挖矿攻击分析
一般情况下，企业级用户的服务器具有更加适合大规模运算的CPU、更大容量的内存，而且处于24小时稳定运行的状态。对于黑客而言，这意味着可以长期挖矿不断获得收益。因此通常情况下企业级用户是黑客进行挖矿木马攻击的首选。
而之所以会出现针对数据库服务器的攻击，主要有两个原因。一是黑客进行攻击时，大多以前端应用服务器(如Weblogic、Jboss等)为突破口，而用户环境中存在应用服务器的同时往往也会存在数据库。所以当攻击Web失败时，就可以利用数据库发起攻击，此时的数据库相当于一个替罪羊。二是黑客直接针对数据库进行弱口令爆破，这种情况在云环境下较为常见。从目前的情况来看，针对数据库的挖矿木马攻击过程与勒索攻击类似，为了便于研究，将其概括为
3个步骤，如下图所示。
图7 数据库挖矿木马攻击流程示意图
第一步，黑客入侵打开缺口。黑客通过弱口令爆破或其他漏洞攻击数据库，利用数据库进行提权，打开通向内网的缺口，为后续攻击做好准备。
第二步，下载木马开始攻击。在第一步成功后，黑客就能够利用Shell、CMD、PowerShell等系统内置工具与C&C服务器通信，从C&C上下载恶意工具。不同的黑客使用的恶意工具有所不同。一般会有挖矿木马，用于控制机器进行挖矿；还会有嗅探工具和漏洞利用工具，方便木马在内网传播。为了避免被杀毒软件查杀，有的木马会进行伪装，比如伪装成其他格式的文件，或者将恶意代码藏在图片中，更有甚者采用了“无文件攻击”技术，通过驻留内存的方式来隐藏自身。
第三步，内网扩散横向移动。利用第二步中下载的恶意工具，对内网中的其他机器进行横向移动攻击，控制更多机器。攻击成功后，会从数据库服务器向目标机器复制恶意工具，从而控制机器进行挖矿。据了解，在目前流行的漏洞工具中，使用最多的是出现了很长时间的“永恒之蓝”漏洞攻击武器。
经过上述操作后，攻击者就完成了对内网环境的入侵，形成了一个初具规模的僵尸网络。为了能够长期挖矿，有的挖矿木马还会监视系统进程，一旦发现存在其他木马的相关进程就将其杀死，确保独占系统资源。
对攻击者来说，成功入侵一台数据库服务器能带来诸多便利。一是数据库服务器硬件性能好，挖矿效率高。数据库服务器往往承载了核心系统的运行，与其他服务器相比硬件配置更加突出，一般是整个业务系统中配置最好的设备之一。强悍的硬件配置意味着强大的计算能力，因此数据库服务器更受黑客青睐。二是数据库服务器易于攻击。现在仍有大量的数据库存在各种安全漏洞，黑客攻击起来更加方便。三是利用数据库便于提权。在SQL
Server、MySQL、PostgreSQL等数据库中都可以通过SQL语句执行系统Shell，攻击者提权更加方便。四是黑客可以直接接触敏感数据。在数据库服务器中，可能会存有各个服务器的账号密码、公司员工内部资料、财务信息等机密信息。黑客可以利用它们扩大攻击范围入侵其他机器，还可以倒卖敏感信息造成数据泄露，甚至实施数据勒索，造成恶劣影响。
因此，要想保障信息系统的数据安全，保护数据库服务器就成为了重中之重。一旦被黑客接触核心数据，信息系统的数据安全也就无从谈起。加强防御措施，保护数据库的安全性已势在必行。
数据库挖矿木马的应对措施
数据库挖矿木马的存在会不断的窃取服务器的硬件资源，既会减少硬件寿命，也会影响业务系统的正常运行。潜藏的木马犹如定时炸弹一般为信息系统带来了安全隐患，使得用户的信息系统时刻暴露在黑客的威胁之下。对此我们提出了一些应对方法，希望能有所帮助。
对于安全问题，首先要考虑如何防御，挖矿木马也是如此。从攻击流程来看，挖矿木马在入侵数据库时仍然以弱口令爆破和漏洞攻击为主，因此可以从这两个方面进行应对。弱口令问题依赖于管理员的安全意识，关键在于设置满足安全要求的密码，并定期修改。还可以借助数据库防火墙，及时阻止密码爆破行为并进行预警。对于数据库漏洞，一般情况下厂商都会定期修复并发布漏洞补丁，因此需要及时更新软件补丁。此外，如果不确定是否存在其他未修复的漏洞，可以借助安全厂商的漏洞扫描工具进行检查。扫描工具的漏洞库越全面，扫描效果越好。
在日常维护中，需要将定期杀毒与系统监控相结合。杀毒软件是处理木马病毒等恶意软件必不可少的手段，可以通过定期杀毒的方式清除潜藏的恶意软件。然而由于恶意软件为了保护自身也采取了各种隐藏手段避免被安全软件查杀，此时就需要管理员对系统资源进行监控。一方面要监控系统的运行情况，观察CPU、内存等硬件的使用率，判断是否存在陌生进程对系统资源异常占用的情况。另一方面要观察系统日志、数据库日志，检查系统中是否存在陌生的计划任务，挖矿木马往往会利用计划任务确保自身时刻运行。
当发现数据库服务器感染了挖矿木马时，最简单、彻底的解决方式是备份数据重装系统。这种方法虽然费时费力，但是可以彻底清除木马，而且对操作人员的技术水平也没有太高的要求，操作起来较为方便。当然还可以尝试对木马定点清除，通过系统进程对其进行定位，再直接删除文件将其清理。这种方法对管理员技术水平要求较高，而且删除木马后很有可能被重复感染，因此建议交由专业的安全团队处理。
###  数据库系统漏洞的统计分析
信息安全的核心是数据安全。随着网络安全形势变得日趋严峻，各种攻击手段层出不穷，数据库安全问题也日益突出。而数据库漏洞作为数据库自身的产品缺陷，一旦被攻击者利用，将会造成严重影响。一方面，通过数据库漏洞发起的攻击会使攻击者直接接触核心数据，从而导致数据资产被恶意篡改、泄露，造成数据资产损失；另一方面，由于数据库系统往往位于IT架构核心，因此攻击者在破坏数据库系统后，还能以其为跳板向局域网中的其他设备发起攻击，从而扩大攻击范围，造成系统性风险。由于挖掘数据库漏洞需要极高的技术水平，因此，目前能够成功发现并提交数据库漏洞的技术团队以国外为主，国内团队屈指可数。到目前为止，安华金和在国内外漏洞平台上累计提交了30个数据库漏洞，为国内数据库安全研究做出了一定的贡献。与此同时，随着国产数据库的技术水平不断提高，应用范围更加广泛，在CNNVD提交的国产数据库漏洞也在逐步增加。这表明国产数据库正逐渐受到国内数据库安全研究团队的关注，各方面也愈加重视国产数据库的安全性。这有助于促进国内数据库安全水平建设，提升国产数据库的安全性。
数据库漏洞源自数据库本身，是由于编码不规范、软件设计缺陷以及编程语言的局限性等原因造成的产品缺陷，属于软件漏洞的一种。利用数据库漏洞，可以突破系统的安全策略，从而对数据库、数据库所在系统，甚至数据库所在的局域网造成破坏。此外，数据库漏洞具有一定的隐蔽性，需要经过用户的深度使用或者安全团队的深入研究才会被暴露出来，容易形成0Day漏洞造成安全隐患。因此，为了提高数据库的安全性，防护者一方面需要及时更新软件补丁，减少数据库自身的安全风险；另一方面，与其他安全手段相结合，进行合理的安全防御，提升攻击者的入侵难度，从而提高数据库系统的安全性。
**按威胁类型分布情况分析**
截止2019年4月，CVE发布的被确认的国际主流数据库漏洞共计81个，其中Oracle 9个、MySQL 65个、Postgresql 1个、IBM DB2
4个。其中Oracle被发现的9个漏洞中含1个超危漏洞，5个高危漏洞；MySQL数据库的65个漏洞中含有2个高危漏洞，62个中危漏洞；Postgresql数据库发现1个高危漏洞；DB2数据库发现4个高危漏洞。如图8所示。
图8 2019年上半年各主流数据库的漏洞分布情况
国产数据库漏洞信息会由国内的漏洞平台认证和发布。根据来自CNNVD和CNVD的漏洞信息表明，截止2019年5月共发现2个国产数据库漏洞，均来自达梦数据库，包括1个高危漏洞和1个中危漏洞。
根据对核心数据的机密性、完整性和可用性的影响程度，数据库漏洞可被分为3大类：高危漏洞、中危漏洞和低危漏洞。就严重性而言，高危漏洞会对数据库系统造成严重影响，需及时处理。而中低危漏洞虽然在当前阶段的严重性不及高危漏洞，但是也可能因为技术革新或攻击方式变化而变成高危漏洞，因此同样值得我们关注。，
截止至2019年5月，在被确认的81个漏洞中，包括超危漏洞1个，高危漏洞13个，中危漏洞65个，低危漏洞2个。从总体情况来看，超危漏洞占漏洞总数的1%，高危漏洞占总数的16%，中危漏洞数量最多占到了81%、低威胁漏洞占2%。如图9所示。据统计，超高危漏洞主要集中在Oracle数据库和DB2数据库中，此外MySQL、PostgreSQL、达梦等数据库也有高危漏洞出现。
图9 2019上半年各主流数据库漏洞的危害等级分布
即2019年上半年出现的数据库漏洞以中危漏洞为主，高危漏洞虽然数量不多，但在各个数据库厂商中仍广泛存在。因此数据库用户需要引起重视，及时对自己的数据库系统进行安全加固，防止数据库安全问题的发生。
**按受影响组件属性分类情况分析**
2019年上半年被发现漏洞最多的数据库是MySQL,高危漏洞最多的数据库是Oracle和DB2。而PostgreSQL、达梦漏洞总数不多，但是也存在高危漏洞。从受影响组件的角度来看，各数据库情况如下：
MySQL数据库因其代码的开源性，并且用户数量较多，因而更容易被黑客攻击，进而曝出较多漏洞，并且以拒绝服务型漏洞为主。
Oracle数据库除了高危漏洞外甚至还存在1个超危漏洞。目前发现的漏洞主要集中于Oracele的Core
RDBMS组件。作为Oracle数据库的最核心组件，Core
RDBMS保证了数据库的正常运行。在Windows环境下，通常以Oracle.exe服务存在，在Linux环境下，则以多个进程的形式出现。因此，当CoreRDBMS中出现漏洞时，问题极其严重。
IBM DB2可以运行在Linux、UNIX和Windows平台。此次发现的漏洞，主要位于DB2 Connect
Server组件，以缓冲区溢出为主。本地攻击者可利用该漏洞在系统上以root用户身份执行任意代码。因此虽然漏洞数据量不多，但是威胁等级较高。
PostgreSQL、达梦等数据库中存在少量高危漏洞，因此仍需警惕。值得注意的是，在传统的内网环境下，大部分漏洞无法被直接利用。而由于云环境具备一定的开放性，导致数据库系统的隐蔽性被降低，从而可能给攻击者利用漏洞提供了便利。MySQL在云平台中占据非常多的份额，云平台的用户和云服务商需要对其进行重点防护。