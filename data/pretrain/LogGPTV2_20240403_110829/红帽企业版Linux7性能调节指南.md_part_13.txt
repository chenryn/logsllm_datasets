工工具具参参考考
显示自重启以来 fork 数量。这包括 fork、vfork、和 clone 系统调用，且和创建的任务总数量
相同。根据线程使用，每个进程是由一个或多个任务代表的。显示不重复。
⁠-m
显示 slab 信息。
⁠-n
指定只会出现一次而非周期性出现的标题。
⁠-s
显示多种事件计数器和内存数据的表格。显示不重复。
⁠delay
报告之间有几秒的延迟。如果没有指定延迟，只显示一个报告，包括机器自上一次重启以来的平均
值。
⁠count
系统中报告的次数。如果没有指定 count（计数器），且定义了延迟，vmstat 无限期报告。
⁠-d
显示磁盘统计。
⁠-p
以分区名为值，为该分区报告详细统计。
⁠-s
报告定义单位输出。有效值为 k（1000 字节）、K（1024 字节）、 m（1000000 字节）、或者
M（1048576 字节）。
每个输出模式提供的输出信息请参见手册页。
$ man vmstat
A.10. x86_energy_perf_policy
x86_energy_perf_policy 工具允许管理员定义性能和能效的相对重要性。由 kernel-tools 软件包提供。
查看当前策略，运行以下命令：
# x86_energy_perf_policy -r
设置新策略，运行以下命令：
# x86_energy_perf_policy profile_name
用以下配置文件的其中之一替代配置文件名。
⁠performance
处理器不为节能而降低性能。这是默认值。
55
红红帽帽企企业业版版 Linux 7 性性能能调调节节指指南南
⁠normal
处理器能容忍由潜在的显著节能所造成的微小性能下降。对于大多数服务器和桌面而言这是合理的
节省。
⁠powersave
处理器接受潜在的显著性能下降，以便充分利用能效。
如何使用 x86_energy_perf_policy 的更多信息，请参见手册页。
$ man x86_energy_perf_policy
A.11. turbostat
turbostat 工具提供系统处于不同状态所用时间的详细信息。 Turbostat 由 kernel-tools 软件包提供。
默认设置下，turbostat 为整个系统显示计数器结果的摘要，随后每隔五秒出现计数器结果，以下列标头：
⁠pkg
处理器软件包编号。
⁠core
处理器内核编号。
⁠CPU
LinuxCPU（逻辑处理器）编号。
⁠%c0
cpu 执行完毕的指令间隔百分比。
⁠GHz
当 CPU 处于 c0 状态时，平均时钟速度。
⁠TSC
整个间隔进程中的平均时钟速度。
⁠%c1、、 %c3、、和和 %c6
处理器分别在 c1、c3 或者 c6 状态下间隔百分比。
⁠%pc3 或或者者 %pc6
处理器分别在 pc3 或者 pc6 状态下的间隔百分比。
使用 -i 选项指定计数器结果间的不同周期，例如：运行 turbostat -i 10 改为每10秒显示结果。
注注意意
即将推出的 Intel 处理器可能会添加其他 c 状态。自红帽企业版 Linux 7 起，turbostat 支持 c7、
c8、c9 和 c10 状态。
56
工工具具参参考考
A.12. numastat
numastat 由 numactl 软件包提供，并以每个 NUMA 节点为基础，为处理器和操作系统显示内存统计数据
（例如分配时断时续）。 numastat 命令的默认跟踪类别如下所示：
⁠numa_hit
成功分配至该节点的页面数量。
⁠numa_miss
因预期节内存不足分配至该节点的页面数量。每个 numa_miss 事件在另一个节点上都有相应的
numa_foreign 事件。
⁠numa_foreign
原本预期分配至此节点，而改为分配至其他节点的页面数量。numa_foreign 事件在另外节点上
有一个相应的 numa_miss 事件。
⁠interleave_hit
成功分配至该节点、交叉存取策略页面数量。
⁠local_node
由节点上进程成功分配至该节点的页面数量。
⁠other_node
由其他节点的进程分配至该节点的页面数量。
提供以下任一选项会改变按兆字节内存计算的显示单元（约两个小数位），且其他指定的 numastat 行为也
会改变，描述如下：
⁠-c
水平浓缩信息的显示表。这有助于含有大量 NUMA 节点的系统，在某种程度上列宽度和列内空间不
可预测。使用该选项时，内存的数量四舍五入到最近的兆。
⁠-m
根据单位节点，显示系统范围的内存使用信息，与 /proc/meminfo 中的信息类似。
⁠-n
使用更新的格式、兆为度量单位，显示和如下原始 numastat 命令相同信息：
（numa_hit、numa_miss、numa_foreign、interleave_hit、local_node 和
other_node）。
⁠-p pattern
为指定模式显示单位节点内存信息。如果模式的值是由数字组成的，numastat 假定它是数字进程
标识符。否则，numastat 从进程命令行查找指定的模式。
假定 -p 选项值后输入的命令行参数是附加模式，目的是将其过滤 。附加模式扩展，而非缩减过滤
器。
⁠-s
将显示的数据按降序排列，以便将最大的内存消耗者（根据所有列）列在首位。
57
红红帽帽企企业业版版 Linux 7 性性能能调调节节指指南南
您也可指定节点，这样表格将根据节点列分类。使用该选项时，节点值必须马上采用 -s 选项，具
体如下：
numastat -s2
不要在选项和其值之间使用空格符。
⁠-v
显示更多冗长的信息。即多进程的进程信息将显示每个进程的细节信息。
⁠-V
显示 numastat 版本信息。
⁠-z
从显示的信息中省略表中只为 0 值的行和列。请注意为了便于显示，一些四舍五入后接近 0 的值不
会从显示输出中被省略。
A.13. numactl
Numactl 允许管理员使用指定的调度或内存放置策略来运行进程。Numactl 也能为共享的内存段或文件设
置永久策略，以及进程的处理器关联和内存关联。
Numactl 提供许多实用的选项。此附录概述一部分选项，也为用户提供了一些使用建议，但并不详细。
⁠--hardware
显示系统中的可用节点，且包含节点间的相对距离的详细目录。
⁠--membind
确保内存只由指定节点分配。如果指定地点没有足够的可用内存，分配会失败。
⁠--cpunodebind
确保指定命令及其子进程只在指定的节点上执行。
⁠--phycpubind
确保指定的命令及其子进程只在指定的处理器上执行。
⁠--localalloc
指明内存应当始终从本地节点分配。
⁠--preferred
指定分配内存的优选节点。如果内存不能从指定的节点分配，其他的节点将被用于回退。
有关以上内容和其他参数的细节，参见手册页：
$ man numactl
A.14. numad
numad 是一个自动 NUMA 关联管理后台程序。为了动态提高 NUMA 资源分配和管理，它在系统内监控
58
工工具具参参考考
NUMA 的拓扑结构和资源使用。
注意启用 numad 时 ，其行为将替代默认的自动 NUMA 平衡的行为。
A.14.1. 在在命命令令行行使使用用 numad
将 numad 作为执行表使用，只需运行：
# numad
numad 运行的时候，其活动被记录在 /var/log/numad.log。它会持续运行直到被以下命令终止：
# numad -i 0
终止 numad 不会移除它所做的提高 NUMA 关联的变更。如果系统使用有显著的变化，再次运行 numad 能
调整关联来提高新条件下的性能。
如需将 numad 管理限制为特定进程，用下列选项来启动它：
# numad -S 0 -p pid
⁠-p pid
该选项将指定的 pid 添加到显式的包含列表中。当指定的进程达到 numad 进程的显著门限值，指
定的进程才会被管理。
⁠-S 0
它将进程扫描的类型设置为 0，这会将 numad 管理限制到显式包含的进程。
有关可用的 numad 选项的详细信息，参见numad手册页：
$ man numad
A.14.2. 作作为为一一个个服服务务来来使使用用 numad
将 numad 作为服务运行时，它尝试基于当前系统的工作负载来动态调整系统。其活动记录在
/var/log/numad.log。
如需启动服务，运行：
# systemctl start numad.service
如需重启后服务持久，运行：
# chkconfig numad on