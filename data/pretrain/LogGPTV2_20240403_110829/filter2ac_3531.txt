title:blackhat:eu-22 Breaking Kerberos&#39; RC4 Cipher and Spoofing Windows PACs
While the Active Directory implementation of Kerberos prefers to use cryptography based on AES, the deprecated Kerberos encryption type is still supported by default and widely used in practice. The property that RC4 derives its cryptographic keys from a user's NTLM hash is frequently exploited to authenticate without the original password (overpass-the-hash) or to efficiently brute-force service account passwords offline (Kerberoasting).No attacks were yet known that take advantage of the well-known weaknesses in Kerberos' RC4 implementation. Therefore I decided to take a look at this and quickly identified a relatively obvious flaw in the way it was used.However, turning this cryptographic flaw into a practical attack against Kerberos or Active Directory turned out to be far from trivial. This, in turn, resulted in a complex yet practical attack to elevate privileges during constrained delegation, bypassing several AD security features.In practice, the impact of this attack is somewhat limited: one needs to compromise some system A which can delegate to some interesting system B while B's local admins are not allowed to be delegated. Nonetheless, this research does demonstrate that the cipher is definitively broken in practice and provides a strong argument towards eventually retiring this encryption type. It also highlights the importance of taking a second look at the many legacy protocols still in active use today, and that cryptographic attacks are still relevant in 2022.