ABUSING CERTIFICATE
TRANSPARENCY
OR HOW TO HACK WEB APPLICATIONS BEFORE
INSTALLATION.
Hanno Böck 
https://hboeck.de/
1
HTTPS
2
CERTIFICATE AUTHORITIES (CAS)
3
CAN WE TRUST CERTIFICATE
AUTHORITIES?
4
NO
Many cases of illegitimate certificates in the past.
5
IMPROVE OR REPLACE?
Popular Infosec opinion:
CAs are bad, we need to get rid of them.
6
HOW?
Reality: Nobody has a feasible plan how to replace
CAs.
7
IMPROVING THE CA ECOSYSTEM
8
BASELINE REQUIREMENTS
9
HTTP PUBLIC KEY PINNING
(HPKP)
10
CERTIFICATE AUTHORITY
AUTHORIZATION (CAA)
11
CERTIFICATE TRANSPARENCY
(CT)
12
PUBLIC LOGS
Let's put all certificates into public logs that everyone
can read.
13
CT DETAILS
Merkle Hash Trees, Signed Certificate Timestamps
(SCT), Signed Tree Head (STH), Precertificates,
Monitors, Gossip, ...
It's complicated, but not relevant for this talk.
14
CERTIFICATE LOGGING
In the future logging will be required (April 2018).
15
CT TODAY
Most certificates already get logged.
16
WATCHING THE CAS
Certificate Transparency means everyone can check
logs for suspicious activity.
17
https://crt.sh
18
19
CERTIFICATE TRANSPARENCY IS
A DATA SOURCE
For researchers.
For search engines.
For attackers?
20
FEED OF NEW HOST NAMES
Certificates contain hostnames.
In other words: Certificate Transparency provides a
feed of newly created HTTPS host names.
21
SELF-HOSTED WEB
APPLICATIONS
Wordpress, Joomla, Drupal etc.
22
WEB APPLICATION INSTALLERS
23
INSTALLERS
Upload files to hoster, open in browser.
Installer asks for some settings (initial user account,
database credentials, ...).
24
INSTALLER (IN)SECURITY
Usually installing needs no authentication!
25
GOOGLE DORKING WEB
INSTALLERS
Old idea: Use Google to find unprotected installers.
26
ATTACK IDEA
During installation there is a time window between
uploading files and completing the installer without
any protection.
27
Remember: We have a stream of newly created host
names.
28
HTTPS AND CERTIFICATES
HTTPS is becoming more popular and many hosters
automatically issue certificates.
29
ATTACK (1)
Attacker monitors CT logs, extracts host names.
Compares web pages with common installers.
30
ATTACK (2)
Insaller found: Install the application.
Upload a plugin with code execution backdoor.
Revert installation, leave backdoor.
31
DATABASE CREDENTIALS
Installers oen require Database credentials for
MySQL.
But the database server can be external.
https://www.freemysqlhosting.net/
32
DEMO
33
CHALLENGES
Logged certificates aren't immediately public. Lag
around 30 minutes - 1 hour.
Still: You'll hit plenty of vulnerable installers.
34
OPTIMIZATIONS
Instead of checking sites once one could check them
multiple times.
35
NUMBERS
I could've taken over around 4000 Wordpress
installations within a month.
Much lower numbers for other apps, Joomla (~400)
and Owncloud/Nextcloud (each ~100) may still be
worth attacking.
36
PROTECTION
37
INSTALLERS NEED
AUTHENTICATION
38
CHALLENGE
Application programmers want easy installations.
39
SECURITY TOKENS
Webapp creates token, writes it to file.
User has to read token to perform installation.
40
VENDORS
Drupal
Typo3
Owncloud
... no reaction at all.
41
VENDORS
Wordpress, Nextcloud, Serendipity participated in
cross-vendor discussion, but no action.
42
JOOMLA
Security token if database server is not localhost.
43
WHITELISTING LOCALHOST
This was my idea, but I don't like it.
Attacker could already own database credentials for
localhost.
44
WHAT CAN USERS DO?
45
BE FAST
However there's no way of knowing how fast CT logs
are.
Future CT logs could be faster.
46
.HTACCESS
User can create .htaccess with password protection
before installation.
Some webapps create .htaccess themselve.
47
TAKEAWAY (1)
Unauthenticated installers need to go away.
Majority of web application developers ignored the
issue so far.
48
TAKEAWAY (2)
Certificate Transparency is a powerful tool to
strengthen the HTTPS/TLS and PKI ecosystem.
As a side eﬀect it provides an interesting data source.
Attackers have that data source, too.
49
TAKEAWAY (3)
Certificate Transparency means TLS host names are no
longer secret.
People need to be aware of that.
50
THANKS FOR LISTENING!
Questions?
https://hboeck.de/
51