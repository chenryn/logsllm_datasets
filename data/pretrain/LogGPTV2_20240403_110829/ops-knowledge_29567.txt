### 问题描述

我遇到了一个与Hyper-V虚拟机（VM）间歇性失去网络连接相关的问题。这个问题大约每两周出现一次。

#### 环境配置
- **主机**: 我运行了一个包含两个物理节点（node01 和 node02）的Hyper-V故障转移集群。
- **操作系统**: 主机上运行的是Windows Server 2008 R2 Hyper-V Server（免费版）并安装了SP1。
- **虚拟机**: 每个主机上各运行两个虚拟机，每个虚拟机运行的是Windows Server 2008 R2 Web Edition，并且都安装了SP1。
- **存储服务器**: 使用的是Windows Storage Server 2008，通过iSCSI连接。
- **网络驱动**: 所有主机和存储服务器均使用从Intel官网下载的最新网络驱动程序。

### 问题现象
99.99%的时间内，一切正常。但每隔两到三周，所有虚拟机会同时失去网络连接，包括入站和出站连接。具体表现如下：
1. 无法通过远程桌面协议（RDP）连接到任何虚拟机。
2. 可以通过RDP连接到任一主机。
3. 可以通过在故障转移群集管理器中右键点击节点并选择“连接到虚拟机”来连接到任一虚拟机。
4. 在这种情况下，即使连接到虚拟机，也无法访问任何网站或局域网中的其他机器。禁用并重新启用虚拟机内的网络连接也无法解决问题。
5. 将虚拟机迁移到另一个节点可以暂时解决问题（通常持续两周）。
6. 重启主机并将虚拟机移回原主机也可以暂时解决问题（通常持续两周）。
7. 当此问题发生时，故障转移群集不会自动将虚拟机迁移至另一节点。
8. 任何主机或虚拟机的日志中都没有异常记录。

这种情况已经发生了五次，每次症状相同。我怀疑是网络驱动或网络硬件的问题，但由于我已经安装了最新的驱动程序，所以不确定该如何解决。

### 更新
- 我找到了一个非常相似的情况：[虚拟机在网络连接中断时的问题](Virutal Machine loses network connectivity on Hyper V Cluster)
- 2011年7月29日更新：在安装了热修复补丁并更新了网络驱动后，问题仍然存在。根据评论要求提供的硬件详细信息，服务器是Intel SR1670HV，这是一个1U机箱，包含两个独立的S5500HV主板。通信通过主板上的集成NIC（Intel 82574L）进行，网络驱动版本为16.2.49.0。

### 解决方案建议
我们之前遇到过类似的问题，最终解决方案涉及以下几点：
1. **MAC地址冲突**：虚拟网络适配器被动态分配了冲突的MAC地址。固定这些MAC地址有助于解决问题。虽然这可能会使虚拟机迁移到不同主机变得困难，但在我们的案例中确实有所帮助。
2. **物理网卡配置错误**：之前的管理员错误地使用Broadcom工具将两个网卡绑定在一起以提高带宽/吞吐量。我们取消了该设置，并配置其中一个网卡在主机上没有IP地址，但仍可用于虚拟机的直通。然后，我们将每个虚拟机配置为只使用一个网卡，基于历史流量平衡负载。当然，这意味着如果某个适配器或连接出现问题，则无法实现故障转移。尽管如此，自那以后系统一直非常稳定。

希望这些信息能对你有所帮助。如果你有任何进一步的问题或需要更多细节，请告诉我。