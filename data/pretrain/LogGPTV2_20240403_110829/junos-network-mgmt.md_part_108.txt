Analytics (JSA).
Configure Off-Box Binary Security Log Files
SRX Series Firewalls have two types of log: system logs and security logs. System logs record control
plane events, for example admin login to the device. For more about system logs, please see "Junos OS
1355
System Log Overview" on page 1254. Security logs, also known as traffic logs, record data plane events
regarding specific traffic handling, for example when a security policy denies certain traffic due to some
violation of the policy. For more information about security logs, please see "Understanding System
Logging for Security Devices" on page 1331.
The two types of log can be collected and saved either on-box or off-box. The procedure below explains
how to configure security logs in binary format for off-box (stream-mode) logging.
You can configure security files in binary format using the log statement at the [security] hierarchy level.
The following procedure specifies binary format for stream-mode security logging, and defines the log
filename, path, and log file characteristics. For event-mode, on-box security logging, please see
"Configuring On-Box Binary Security Log Files" on page 1352.
1. Specify the logging mode and the format for the log file. For off-box, stream-mode logging:
set security log mode stream
set security log stream test-stream format binary host 1.3.54.22
NOTE: Off-box and on-box security logging modes cannot be enabled simultaneously.
2. For off-box security logging, specify the source address, which identifies the SRX Series Firewall that
generated the log messages. The source address is required.
set security log source-address 2.3.45.66
3. Optionally, define a log filename and a path.
NOTE: Security log filename is not mandatory. If security log filename is not configured, by
default the bin_messages file is created in the /var/log directory.
set security log file name security-binary-log
set security log file path security/log-folder
1356
4. Optionally, change the maximum size of the log file and the maximum number of log files that can be
archived. By default the maximum size of the log file is 3 MB, and a total of three log files can be
archived.
set security log file size 5
set security log file files 5
5. Optionally, select the hpl flag to enable diagnostic traces for binary logging. The prefix smf_hpl
identifies all binary logging traces.
set security log traceoptions flag hpl
6. View the content of the event-mode log file stored on the device using either Juniper Secure
Analytics (JSA) or Security Threat Response Manager (STRM).
Configure On-Box Protobuf Security Log Files in Event Mode
Protocol Buffers (Protobuf) is a data format used to serialize structured security logs. You can configure
the security log using protobuf format. Data plane use the Protobuf to encode the log and send the log
to rtlog process. The rtlog process saves the log file based on the device configuration. By default, the
log files are stored in /var/log/filename.pb directory. You can decode the file data using rtlog process.
To configure the Protobuf format in event mode:
1. Specify the logging mode and format for on-box logging.
[edit security]
user@host# set log mode event
user@host# set log format protobuf
2. Define a name and path for the log file.
[edit security]
user@host# set log file name file1.pb
user@host# set log file path /var/tmp
1357
3. Change the maximum size of the log file and the maximum number of log files that can be archived.
[edit security]
user@host# set log file size 5
user@host# set log file files 5
View the content of the protobuf log file stored on the device using the show security log file file1.pb
command.
user@host> show security log file file1.pb
1 2023-03-17T00:06:55 10.53.78.91 RT_LOG_SELF_TEST - SECINTEL_ACTION_LOG
[PI:EMAIL category="secintel" sub-category="CC" action="block" action-
detail="test" http-host="test" threat-severity="5" source-address="1.16.16.16" source-
port="16384" destination-address="2.16.16.16" destination-port="32768" protocol-id="17"
application="test" nested-application="test" feed-name="test" policy-name="test" profile-
name="test" username="Fake username" roles="test" session-id="1" source-zone-name="Fake src
zone" destination-zone-name="Fake dst zone" occur-count="3"]
1 2023-03-17T00:06:55 10.53.78.91 RT_LOG_SELF_TEST - AAMW_ACTION_LOG [PI:EMAIL
hostname="test" file-category="virus" verdict-number="5" malware-info="Test-File" action="block"
list-hit="test" file-hash-lookup="test" source-address="1.16.16.16" source-port="16384"
destination-address="2.16.16.16" destination-port="32768" protocol-id="17" application="test"
nested-application="test" policy-name="test" username="Fake username" roles="test" session-
id="1" source-zone-name="Fake src zone" destination-zone-name="Fake dst zone" sample-
sha256="da26ba1e13ce4702bd5154789ce1a699ba206c12021d9823380febd795f5b002" file-name="test_name"
url="www.test.com"]
...
Configure On-Box Protobuf Security Log Files in Stream Mode
Data plane use the Protobuf to encode the log and send the log to llmd process. The llmd process saves
the log file based on the device configuration. By default, the log files are stored in /var/traffic-log/
filename.pb directory. You can decode the log file data using uspinfo process.
To configure the Protobuf format in stream mode to file:
1358
1. Specify the logging mode and format for on-box logging.
[edit security]
user@host# set log mode stream
user@host# set log stream s1 format protobuf
2. Define a name for the log file.
[edit security]
user@host# set log stream s1 file name file2.pb
3. Change the maximum size of the log file that can be archived.
[edit security]
user@host# set log stream s1 file size 5
View the content of the protobuf log file stored on the device using the show security log stream file
file2.pb command.
user@host> show security log file file2.pb
1 2023-03-15T22:27:34 10.53.78.91 RT_FLOW - RT_FLOW_SESSION_CREATE [PI:EMAIL
source-address="1.0.0.3" source-port="38800" destination-address="4.0.0.3" destination-port="80"
connection-tag="0" service-name="junos-http" nat-source-address="1.0.0.3" nat-source-
port="38800" nat-destination-address="4.0.0.3" nat-destination-port="80" nat-connection-tag="0"
src-nat-rule-type="N/A" src-nat-rule-name="N/A" dst-nat-rule-type="N/A" dst-nat-rule-name="N/A"
protocol-id="6" policy-name="policy1" source-zone-name="trust" destination-zone-name="untrust"
session-id="69" username="N/A" roles="N/A" packet-incoming-interface="ge-0/0/0.0"
application="HTTP" nested-application="BING" encrypted="No" application-category="Web"
application-sub-category="miscellaneous" application-risk="2" application-characteristics="N/A"
src-vrf-grp="N/A" dst-vrf-grp="N/A" tunnel-inspection="Off" tunnel-inspection-policy-set="root"
source-tenant="N/A" destination-service="N/A"]
1 2023-03-15T22:27:57 10.53.78.91 RT_FLOW - RT_FLOW_SESSION_CLOSE [PI:EMAIL
reason="TCP FIN" source-address="1.0.0.3" source-port="38800" destination-address="4.0.0.3"
destination-port="80" connection-tag="0" service-name="junos-http" nat-source-address="1.0.0.3"
nat-source-port="38800" nat-destination-address="4.0.0.3" nat-destination-port="80" nat-
connection-tag="0" src-nat-rule-type="N/A" src-nat-rule-name="N/A" dst-nat-rule-type="N/A" dst-
nat-rule-name="N/A" protocol-id="6" policy-name="policy1" source-zone-name="trust" destination-
zone-name="untrust" session-id="69" packets-from-client="11129" bytes-from-client="583566"
packets-from-server="154153" bytes-from-server="218074629" elapsed-time="23" application="HTTP"
1359
nested-application="BING" username="N/A" roles="N/A" packet-incoming-interface="ge-0/0/0.0"
encrypted="No" application-category="Web" application-sub-category="miscellaneous" application-
risk="2" application-characteristics="N/A" secure-web-proxy-session-type="NA" peer-session-
id="0" peer-source-address="0.0.0.0" peer-source-port="0" peer-destination-address="0.0.0.0"
peer-destination-port="0" hostname="NA NA" src-vrf-grp="N/A" dst-vrf-grp="N/A" tunnel-
inspection="Off" tunnel-inspection-policy-set="root" session-flag="0" source-tenant="N/A"
destination-service="N/A" user-type="N/A"]
...
Configure Off-box Protobuf Security Log Files
Data plane use Protobuf format in stream and stream-event mode to encode the log and send the log to
host. The security log data is sent to host using different transport protocol and port number. The host
receives the protobuf log and save it to a file. Copy hplc_collect.py, hplc_view.py, security_log.xml and
protobuflog.proto files to the host. The hplc_collect.py is used to collect and save the log files on the host.
The protobuflog.proto is used to decode the file data on the host and you can view the data using
hplc_view.py. The files are published to /share/juniper and copied to host. The hplc_collect.py and
hplc_view.py files support latest python version 3.
To configure the Protobuf format in stream-event mode to host:
1. Specify the logging mode and log stream format for off-box logging. The Stream-event is a combination
of stream and event mode.
[edit security]
user@host# set log mode stream-event
user@host# set log stream s1 format protobuf
2. For off-box security logging, specify the source address, which identifies the SRX Series Firewall that
generated the log messages.
[edit security]
user@host# set log source-address 10.0.0.3
1360
3. Define a name and path for the log file.
[edit security]
user@host# set log stream s1 file name proto-1og.pb
user@host# set log file path /var/tmp
4. Configure the log stream s1 with host and port settings.
[edit security]
user@host# set log stream s1 host 4.0.0.3 port 514
user@host# set log stream s1 transport protocol udp
5. Change the maximum size of the log file and the maximum number of log files that can be archived.
[edit security]
user@host# set log file size 5
user@host# set log file files 5
6. Configure the log.trace file to decode and view the contents of the log.
[edit security]
user@host# set log traceoptions file log.trace
Send System Log Messages to a File
You can direct system log messages to a file on the CompactFlash (CF) card. The default directory for log
files is /var/log. To specify a different directory on the CF card, include the complete pathname.
Create a file named security, and send log messages of the authorization class at the severity level info to
the file.
To set the filename, the facility, and severity level:
{primary:node0}
user@host# set system syslog file security authorization info
1361
Configure the System to Send All Log Messages Through eventd
The eventd process of logging configuration is most commonly used for Junos OS. In this configuration,
control plane logs and data plane, or security, logs are forwarded from the data plane to the Routing
Engine control plane rtlogd process. The rtlogd process then either forwards syslog or sd-syslog-
formatted logs to the eventd process or the WELF-formatted logs to the external or remote WELF log
collector.
To send all log messages through eventd:
1. Set the eventd process to handle security logs and send them to a remote server.
{primary:node0}
user@host# set security log mode event
2. Configure the server that will receive the system log messages.
{primary:node0}
user@host# set system syslog host hostname any any
where hostname is the fully qualified hostname or IP address of the server that will receive the logs.
NOTE: To send duplicate logs to a second remote server, repeat the command with a new fully
qualified hostname or IP address of a second server.
If your deployment is an active/active chassis cluster, you can also configure security logging on
the active node to be sent to separate remote servers to achieve logging redundancy.
To rename or redirect one of the logging configurations, you need to delete and recreate it. To delete a
configuration:
{primary:node0}
user@host# delete security log mode event
1362
Release History Table
Release Description
15.1X49-D100 Starting with Junos OS Release 15.1X49-D100, the default mode for SRX1500 device is
stream mode. Prior to Junos OS Release 15.1X49-D100, the default mode for SRX1500
device was event mode.
17.4R2 Starting in Junos OS Release 17.4R2 and later, on SRX300, SRX320, SRX340, SRX345 Series
devices and vSRX Virtual Firewall instances, when the device is configured in stream mode,
you can configure maximum of eight system log hosts. In Junos OS Release 17.4R2 and earlier
releases, you can configure only three system log hosts in the stream mode. If you configure
more than three system log hosts, then the following error message is displayed error:
configuration check-out failed.
Junos OS Release The on-box reporting feature is enabled by default when you load the factory-default
15.1X49-D100 configurations on the SRX Series Firewall with Junos OS Release 15.1X49-D100 or later.
Junos OS Release Starting in Junos OS Release 19.3R1, SRX300, SRX320, SRX340, SRX345, SRX550, and
19.3R1 SRX550M devices default to stream mode.
Junos OS Release Starting in Junos OS Release 19.3R1 , the factory-default configuration does not include on-
19.3R1 box reporting configuration to increase the solid-state drive (SSD) lifetime.
Configure Syslog over TLS
SUMMARY IN THIS SECTION
Learn how to configure your device to transport Control Plane Logs | 1363
system log messages (also known as syslog
Data Plane Logs | 1368
messages) securely over the Transport Layer Security
(TLS) protocol.
1363
Control Plane Logs
IN THIS SECTION
Example: Configure Syslog over TLS | 1363
Control plane logs, also called system logs, include events that occur on the routing platform. The
system sends control plane events to the eventd process on the Routing Engine, which then handles the
events by using Junos OS policies, by generating system log messages, or by doing both. You can choose
to send control plane logs to a file, user terminal, routing platform console, or remote machine. To
generate control plane logs, use the syslog statement at the [system] hierarchy level.
Example: Configure Syslog over TLS
IN THIS SECTION
Requirements | 1363
Overview | 1364
Configuration | 1364
This example shows how to configure a Juniper Networks device to transport syslog messages (control
plane logs) securely over TLS.
Requirements
This example uses the following hardware and software components:
• Junos OS Release 21.2R1 or later
• Junos OS Evolved Release 23.4R1 or later
• Device running Junos OS or Junos OS Evolved (syslog client)
• Syslog server
1364
Overview
You use the TLS protocol to enable secure transportation of system log messages (control plane logs)
from the syslog client to the syslog server. TLS uses certificates to authenticate and encrypt the
communication.
• Server authentication (or one-way TLS)—Client verifies the identify of the server and trusts the
server.
• Mutual authentication—Both the server and client trust each other.
You can choose either server authentication or mutual authentication depending on your network. To
quickly access the information you need, click the links in Table 1 on page 1364.
Table 150: TLS Authentication Modes
Authentication Mode Procedure Section Where the Information Is
Located
Server authentication Configure PKI "Server Authentication" on page
1366
Configure the device
Configuration
IN THIS SECTION
Public Key Infrastructure (PKI) Configuration Overview | 1365
Configure Server Authentication on Your Device | 1366
Results | 1367
Verification | 1367
In the following example, we use the TLS protocol to securely transport syslog messages (control plane
logs) from the Juniper device to the remote syslog server. Figure 1 shows the basic topology used in this
example.
1365
Figure 46: Syslog over TLS
Public Key Infrastructure (PKI) Configuration Overview
To configure PKI on the device:
1. Create a certification authority (CA) profile, and associate a CA identifier with the CA profile. See
Example: Configuring a CA Profile.
2. (Optional) Create a revocation check to specify a method for validating the certificate. You can use
either certificate revocation lists (CRLs) or the Online Certificate Status Protocol (OCSP). See
Certificate Revocation.
3. (Optional) Create a trusted CA group, and add the CA profile to the trusted group. See Configuring a
Trusted CA Group.
4. Load the CA certificate on the device. You can load the certificate manually. See Example: Loading
CA and Local Certificates Manually. Based on your deployment environment, you can use either
Certificate Management Protocol version 2 (CMPv2) or Simple Certificate Enrollment Protocol (SCEP)
for online certificate enrollment. See Enrolling a CA Certificate Online Using SCEP and
Understanding Certificate Enrollment with CMPv2.
5. (Optional for mutual authentication) Load the local certificate on the device. You can load the local
certificate manually. Based on your deployment environment, you can use either CMPv2 or SCEP for
online certificate enrollment. See Enrolling a Local Certificate Online Using SCEP and Understanding
Certificate Enrollment with CMPv2.
1366
6. Verify that the certificates are loaded successfully. Use the request security pki ca-certificate verify
command to check whether the CA certificate has loaded successfully. Use the request security pki
local-certificate verify command to verify that the local certificate has loaded successfully.
Configure Server Authentication on Your Device
Step-by-Step Procedure
The following procedure requires you to navigate various levels in the configuration hierarchy. For
information about navigating the CLI, see Using the CLI Editor in Configuration Mode.
To configure the device:
1. Specify the syslog server that receives the system log messages. You can specify the IP address of
the syslog server or a fully qualified hostname. In this example, use 10.102.70.233 as the IP address
of the syslog server.
[edit]
user@host# set system syslog host 10.102.70.233 any any
2. Specify the port number of the syslog server.
[edit]
user@host# set system syslog host 10.102.70.233 port 10514
3. Specify the syslog transport protocol for the device. In this example, use TLS as the transport
protocol.
[edit]
user@host# set system syslog host 10.102.70.223 transport tls
4. Specify the name of the trusted certificate authority (CA) group or specify the name of the CA profile
to be used. In this example, use example-ca as the CA profile.
[edit]
user@host# set system syslog host 10.102.70.223 tlsdetails trusted-ca-group ca-profiles
example-ca
1367
5. Configure the device to send all log messages.
[edit]
user@host# set system syslog file messages any any
6. Commit the configuration.
[edit]
user@host# commit
Results
In configuration mode, confirm your configuration by using the show system syslog command.
[edit]
user@host# run show system syslog
host 10.102.70.223
{
port 10514;
transport tls;
tlsdetails {
local-certificate example-cert;
trusted-ca-group trusted-ca-group-name {
ca-profiles example-ca};
}
}
}
Verification
To verify that the configuration is working properly, enter the show log command on the syslog server.
SEE ALSO
tlsdetails
1368
Data Plane Logs
IN THIS SECTION
Example: Configure the TLS Syslog Protocol on SRX Series Firewalls | 1368
Data plane logs, also called security logs, include security events that are handled inside the data plane.
Security logs can be in text or binary format, and you can save them locally (event mode) or configure
your device to send the logs to an external server (stream mode). You require binary format for stream
mode. We recommend binary format to conserve log space in event mode.
Example: Configure the TLS Syslog Protocol on SRX Series Firewalls
IN THIS SECTION
Requirements | 1368
Overview | 1368
Configuration | 1369
Verification | 1372
This example shows how to configure the Transport Layer Security (TLS) syslog protocol on SRX Series
Firewalls to receive encrypted syslog events from network devices that support TLS syslog event
forwarding.
Requirements
Before you begin, enable server certificate verification and encryption or decryption capabilities.
Overview
The TLS syslog protocol enables a log source to receive encrypted syslog events from network devices
that support TLS syslog event forwarding. The log source creates a listen port for incoming TLS syslog
events and generates a certificate file for the network devices.
1369
In this example, you configure a syslog collector associated with one SSL-I profile. Each SSL-I profile
enables the user to specify things such as preferred ciphers suite and trusted CA certificates. You can
configure multiple SSL-I profiles and associate the profiles with different collector servers.
Configuration
IN THIS SECTION
Procedure | 1369
Procedure
CLI Quick Configuration
To quickly configure this section of the example, copy the following commands, paste them into a text
file, remove any line breaks, change any details necessary to match your network configuration, copy