2ğ‘›âˆ’ğ‘ . As ğ‘ â‰¤ 2ğ‘›âˆ’1, then 2ğ‘˜
2ğ‘˜
1
(ğ‘¦

Pr[ğ¸4] â‰¤ 2âˆ’(ğ‘›âˆ’ğ‘˜âˆ’1) .
(cid:104)(ğ‘¦
(32)+ ğ‘¥]ğ‘Ÿ âˆ¥([ğ‘¦
Prğ‘¦ â†$ Prim(ğ‘¥)
(15)
For any ğ´ğ·, ğ¶ âˆˆ {0, 1}âˆ—, let Throw(ğ´ğ·, ğ¶) be the throwing ex-
periment, where we view each forward ideal permutation Prim(ğ‘¥)
(32)+ ğ‘¥]ğ‘  (ğ‘¡)+ğ»ğ‘Ÿ (ğ´ğ·, ğ¶)),
with answer ğ‘¦, as throwing a ball [ğ‘¦
where ğ‘Ÿ = [ğ‘¦
(32)+ ğ‘¥]ğ‘Ÿ into one of 22ğ‘¡ possible bins. For any bin
ğ‘Ÿâˆ¥ğ‘‡ âˆˆ {0, 1}2ğ‘¡, each throw has a conditional probability of at most
(32)+ ğ‘¥) = ğ‘Ÿâˆ¥(ğ‘‡ (ğ‘¡)âˆ’ ğ»ğ‘Ÿ (ğ´ğ·, ğ¶))âˆ¥ğ‘Š(cid:105)
ğ‘Š âˆˆ{0,1}ğ‘›âˆ’2ğ‘¡
Prğ‘¦ â†$ Prim(ğ‘¥)
(32)+ ğ‘¥) = ğ‘Ÿâˆ¥(ğ‘‡ (ğ‘¡)âˆ’ ğ»ğ‘Ÿ (ğ´ğ·, ğ¶))âˆ¥ğ‘Š
â‰¤ âˆ‘ï¸
ğ‘Š âˆˆ{0,1}ğ‘›âˆ’2ğ‘¡
â‰¤ 2ğ‘›âˆ’2ğ‘¡
2ğ‘› âˆ’ ğ‘
Therefore, each throw has a conditional probability of at most
2ğ‘›âˆ’ğ‘ . As ğ‘ â‰¤ 2ğ‘›âˆ’1, then 2ğ‘›âˆ’2ğ‘¡
2ğ‘›âˆ’2ğ‘¡
1
22ğ‘¡âˆ’1 . If we consider
all forward ideal permutation queries, we throw at most ğ‘ balls
with conditional probability at most 2âˆ’(2ğ‘¡âˆ’1) into 22ğ‘¡ bins. Using
Lemma B.1, with ğ‘„ = ğ‘ and ğµ = 2âˆ’(2ğ‘¡âˆ’1), the probability that
the heaviest bin of Throw(ğ´ğ·, ğ¶) contains ğ‘š5 or more balls is at
most 2âˆ’(2ğ‘¡âˆ’1). If ğ¸5 happens, then the bin ğ‘Ÿâˆ—âˆ¥ğ‘‡âˆ— in experiment
Throw(ğ´ğ·âˆ—, ğ¶âˆ—) contains ğ‘š5 or more balls, therefore, the number
of balls in the heaviest bin of Throw(ğ´ğ·âˆ—, ğ¶âˆ—) contains ğ‘š5 or more
balls. Thus, the probability of ğ¸5 is also bounded by 2âˆ’(2ğ‘¡âˆ’1):
2ğ‘›âˆ’ğ‘ â‰¤ 2ğ‘›âˆ’2ğ‘¡
2ğ‘›âˆ’1 =
.
Pr(cid:104)ğ¸5
(cid:105) â‰¤ 2âˆ’(2ğ‘¡âˆ’1) .
(cid:12)(cid:12)(cid:12) ğ¸4âˆ§ğ¸5
Pr[Tideal âˆˆ Bad5] â‰¤ Pr(cid:104)Tideal âˆˆ Bad5
(cid:105) +
Combining (14), (15) and (16), we can bound the probability of a
transcript being in Bad5:
(16)
1
2ğ‘›âˆ’ğ‘˜âˆ’1 +
1
22ğ‘¡âˆ’1 .
(17)
Session 6D: Authentication and Privacy CCS â€™21, November 15â€“19, 2021, Virtual Event, Republic of Korea1998(32)+ ğ‘¥]ğ‘  (ğ‘¡)+ ğ»ğ‘Ÿ (ğ´ğ·, ğ¶) = ğ‘‡ , where ğ‘Ÿ = [ğ‘¦
Note that ğ¸4 is the event that for all ğ‘¤ âˆˆ {0, 1}ğ‘›âˆ’ğ‘˜, there are
strictly less than ğ‘š4 inverse ideal permutation queries such that
[ğ‘¥]ğ¾- = ğ‘¤ and ğ¸5 is the event that for any ğ´ğ·, ğ¶ âˆˆ {0, 1}âˆ— and
ğ‘‡ âˆˆ {0, 1}ğ‘¡, the number of forward ideal permutation queries veri-
fying [ğ‘¦
(32)+ ğ‘¥]ğ‘Ÿ , is strictly less
than ğ‘š5. To bound the remaining term, we now consider the case
where A is just about to query Reveal, but has already made
all its other oracle queries. In the following, we mean by Prim
and Vf, a primitive and verification query already done by A. The
verification queries already done by A.
unionVf,Prim and sumVfPrim are over all primitive and
A transcript is in Bad5, if there exists a verification and primitive
(32)+ ğ‘¥]ğ‘  = ğ‘‡ (ğ‘¡)âˆ’ ğ»ğ‘Ÿ (ğ´ğ·, ğ¶),
query such that ğ‘¥ = (ğ‘âˆ¥ğ¾ğ‘–âˆ¥0âˆ¥ğ‘) and [ğ‘¦
where ğ‘Ÿ = [ğ‘¦
(32)+ ğ‘¥]ğ‘Ÿ . To bound the probability of this event, we
split it into two, one for the event that the key part of ğ‘¥ is equal
to the key of the verification query and a second one for the rest
of the event that doesnâ€™t depend on the key. Let ğ¸6(Vf, Prim)
be the event that when querying the Reveal oracle, the key
ğ¾ğ‘– of the verification query Vf is equal to the value [ğ‘¥]ğ¾+ as-
sociated to the primitive query Prim, and ğ¸7(Vf, Prim) be the
event that [ğ‘¥]ğ¾- = (ğ‘âˆ¥0âˆ¥ğ‘) and [ğ‘¦
(32)+ ğ‘¥]ğ‘  = ğ‘‡ (ğ‘¡)âˆ’ ğ»ğ‘Ÿ (ğ´ğ·, ğ¶), where
ğ‘Ÿ = [ğ‘¦
(32)+ ğ‘¥]ğ‘Ÿ , (ğ‘ , ğ´ğ·, ğ¶,ğ‘‡) are the values associated to the verifica-
tion query Vf, and (ğ‘¥, ğ‘¦) are the values associated to the primitive
query Prim. Then, using a union bound,
(cid:105)
â‰¤ Pr
(cid:12)(cid:12)(cid:12) ğ¸4 âˆ§ ğ¸5
Pr(cid:104)Tideal âˆˆ Bad5
(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12) ğ¸4 âˆ§ ğ¸5

Pr(cid:104)ğ¸6(Vf, Prim)(cid:12)(cid:12)(cid:12) ğ¸4 âˆ§ ğ¸5 âˆ§ ğ¸7(Vf, Prim)(cid:105)
âˆ‘ï¸
â‰¤âˆ‘ï¸
Â· Pr(cid:104)ğ¸7(Vf, Prim)(cid:12)(cid:12)(cid:12) ğ¸4 âˆ§ ğ¸5
ğ¸6(Vf, Prim) âˆ§ ğ¸7(Vf, Prim)
(cid:105) .
Vf,Prim
Prim
Vf
(18)
When querying Reveal, the usersâ€™ keys are uniformly sampled,
independently from any previous queries and parameters. Thus,
for any pair Vf, Prim, the probability that ğ¾ğ‘– = [ğ‘¥]ğ¾+ is 1
2ğ‘˜ . This
event is also independent from ğ¸4, ğ¸5 and ğ¸7(Vf, Prim), which
both depend only on parameters already fixed before querying
Reveal. Thus
Pr(cid:104)ğ¸6(Vf, Prim)(cid:12)(cid:12)(cid:12) ğ¸4âˆ§ğ¸5âˆ§ğ¸7(Vf, Prim)(cid:105)
= Pr[ğ¸6(Vf, Prim)]
(19)
.
=
1
2ğ‘˜
Note that conditioned on event ğ¸4 âˆ§ ğ¸5, for any verification query
Vf there are strictly less than ğ‘š4 + ğ‘š5 primitive queries Prim
such that [ğ‘¥]ğ¾- = (ğ‘âˆ¥0âˆ¥ğ‘) and [ğ‘¦
(32)+ ğ‘¥]ğ‘  = ğ‘‡ (ğ‘¡)âˆ’ ğ»ğ‘Ÿ (ğ´ğ·, ğ¶), where
ğ‘Ÿ = [ğ‘¦
(32)+ ğ‘¥]ğ‘Ÿ , (ğ‘ , ğ´ğ·, ğ¶,ğ‘‡) are the values associated to Vf, and
(ğ‘¥, ğ‘¦) are the values associated to Prim. Hence, for a fix verification
query Vf, there are strictly less than ğ‘š4 + ğ‘š5 primitive queries
Vf
Vf
Prim
Moreover,
âˆ‘ï¸
2(ğ‘› âˆ’ ğ‘˜ âˆ’ 1)
(ğ‘š4 + ğ‘š5)
â‰¤ ğ‘ğ‘£ Â· (ğ‘š4 + ğ‘š5) .
Prim such that Pr(cid:104)ğ¸7(Vf, Prim)(cid:12)(cid:12)(cid:12) ğ¸4 âˆ§ ğ¸5
(cid:105) is not zero. Thus
Pr(cid:104)ğ¸7(Vf, Prim)(cid:12)(cid:12)(cid:12) ğ¸4 âˆ§ ğ¸5
(cid:105)
<âˆ‘ï¸
âˆ‘ï¸
(cid:24)
(cid:25)
(cid:24)
(cid:24)
(cid:24)
(cid:25)
Pr[Tideal âˆˆ Bad5] â‰¤ ğ‘ğ‘£ Â· 2(cid:16)(ğ‘› âˆ’ ğ‘˜) ğ‘ + 2ğ‘¡ ğ‘(cid:17)
and in combination with (17), (18), (19) and (20), we obtain
â‰¤ 2 Â·
= 2 Â· (ğ‘› âˆ’ ğ‘˜) ğ‘
max(1, ğ‘›âˆ’ğ‘˜âˆ’1âˆ’ log2(ğ‘))
max(1, 2ğ‘¡ âˆ’ 1 âˆ’ log2(ğ‘))
â‰¤ 2 Â·
= 2 Â· 2ğ‘¡ ğ‘
max(1, 2ğ‘¡ âˆ’ log2(2ğ‘))
max(1, ğ‘›âˆ’ğ‘˜âˆ’ log2(2ğ‘))
2(2ğ‘¡ âˆ’ 1)
(ğ‘› âˆ’ ğ‘˜)
ğ‘š4 =
ğ‘š5 =
2ğ‘¡
+
(20)
(cid:25)
(cid:25)
2ğ‘˜
1
2ğ‘›âˆ’ğ‘˜âˆ’1 + 1
22ğ‘¡âˆ’1 . â–¡
B.2.7 Bounding Bad6 transcripts probability.
.
2ğ‘¡
2ğ‘˜
+ 1
22ğ‘¡
+ ğ‘ğ‘£ Â· 2 Â· 2ğ‘¡ ğ‘‘
2ğ‘¡ + ğ‘ğ‘£ Â· ğ‘ Â· â„“ğ‘š
Lemma B.7 (Bad6).
Pr[Tideal âˆˆ Bad6] â‰¤ ğ‘ğ‘£
Proof. Bad6 is the set of all transcripts ğœ that contain two entries
(enc, ğ‘—, ğ‘ , ğ´ğ·â€², ğ‘€â€², ğ¶â€²âˆ¥ğ‘‡ â€²,
(vf, ğ‘–, ğ‘ , ğ´ğ·, ğ¶âˆ¥ğ‘‡ , false)
ğ‘¢) such that ğ¾ğ‘— = ğ¾ğ‘– and âˆƒğ‘Ÿ âˆˆ {0, 1}ğ‘¡ ,ğ‘Š âˆˆ {0, 1}ğ‘›âˆ’2ğ‘¡
0 âˆ¥ Â· Â· Â· âˆ¥ğ‘‰ â€²
ğ‘‰ â€²
such that ğ‘‰ â€²
0 = (ğ‘Ÿâˆ¥(ğ‘‡ (ğ‘¡)âˆ’ ğ»ğ‘Ÿ (ğ´ğ·, ğ¶))âˆ¥ğ‘Š ).
Recall that for an entry (enc, ğ‘—, ğ‘ , ğ´ğ·â€², ğ‘€â€², ğ¶â€²âˆ¥ğ‘‡ â€², ğ‘‰ â€²
ğ‘¢), in
0 = (ğ‘Ÿâˆ¥(ğ‘‡ â€² (ğ‘¡)âˆ’ ğ»ğ‘Ÿ (ğ´ğ·â€², ğ¶â€²))âˆ¥ğ‘Š ), with ğ‘Ÿ â†$ {0, 1}ğ‘¡
the ideal world, ğ‘‰ â€²
and ğ‘Š â†$ {0, 1}ğ‘›âˆ’2ğ‘¡. Two cases are possible. The first one is when
the two queries are made to the same user, i.e., ğ‘– = ğ‘—, and the second
one is when the two queries are made to different users, i.e., ğ‘– â‰  ğ‘—.
0 âˆ¥ Â· Â· Â· âˆ¥ğ‘‰ â€²
and
Bad6-1: case ğ‘– = ğ‘—.
0 âˆ¥ Â· Â· Â· âˆ¥ğ‘‰ â€²
In the ideal world, Bad6 for this case could be redefined as the set
of all transcripts ğœ that contain two entries (vf, ğ‘–, ğ‘ , ğ´ğ·, ğ¶âˆ¥ğ‘‡ , false)
and (enc, ğ‘–, ğ‘ , ğ´ğ·â€², ğ‘€â€², ğ¶â€²âˆ¥ğ‘‡ â€², ğ‘‰ â€²
ğ‘¢) such that ğ‘‡ (ğ‘¡)âˆ’ğ»ğ‘Ÿ (ğ´ğ·, ğ¶)
= ğ‘‡ â€² (ğ‘¡)âˆ’ ğ»ğ‘Ÿ (ğ´ğ·â€², ğ¶â€²), where ğ‘Ÿ = [ğ‘‰ â€²
0]ğ‘Ÿ . To bound the probability
of this case, we are going to use the ğ‘-almost Î”-universal prop-
erty of the function ğ». However, this property require for (ğ´ğ·, ğ¶)
and (ğ´ğ·â€², ğ¶â€²) to be distinct. We are therefore first going to bound
the probability of transcripts verifying this case when (ğ´ğ·, ğ¶) =
(ğ´ğ·â€², ğ¶â€²).
When (ğ´ğ·, ğ¶) = (ğ´ğ·â€², ğ¶â€²), if a transcript is in this case then
ğ‘‡ (ğ‘¡)âˆ’ ğ»ğ‘Ÿ (ğ´ğ·, ğ¶) = ğ‘‡ â€² (ğ‘¡)âˆ’ ğ»ğ‘Ÿ (ğ´ğ·â€², ğ¶â€²), i.e. ğ‘‡ = ğ‘‡ â€². Depending on the
order of the queries, we consider two subcases for when (ğ´ğ·, ğ¶) =
(ğ´ğ·â€², ğ¶â€²). The first one is for when the verification query is done
after the encryption query, and the second one is for the inverse
order. For the first subcase, when the verification query is done after
the encryption query and (ğ´ğ·, ğ¶) = (ğ´ğ·â€², ğ¶â€²), we cannot have that
ğ‘‡ = ğ‘‡ â€², as it would result in a non valid query. Thus the probability
of this subcase is zero. For the second subcase, when the encryption
query is done after the verification query and (ğ´ğ·, ğ¶) = (ğ´ğ·â€², ğ¶â€²),
Session 6D: Authentication and Privacy CCS â€™21, November 15â€“19, 2021, Virtual Event, Republic of Korea1999the probability that ğ‘‡ â€² = ğ‘‡ is 1
2ğ‘¡ , as encryption queries return uni-
form random strings. For each of the at most ğ‘ğ‘£ verification queries
Vf(ğ‘–, ğ‘ , ğ´ğ·, ğ¶âˆ¥ğ‘‡), there can be at most one following encryption
query Enc(ğ‘–, ğ‘ , ğ´ğ·â€², ğ‘€â€²) with answer ğ¶â€²âˆ¥ğ‘‡ â€² and the same (ğ‘–, ğ‘),
and the probability that ğ‘‡ â€² = ğ‘‡ is 1
2ğ‘¡ . Thus the probability of this
subcase is bounded by ğ‘ğ‘£2ğ‘¡ .
When (ğ´ğ·, ğ¶) â‰  (ğ´ğ·â€², ğ¶â€²), if a transcript generated by the
adversary A in the ideal augmented game is in this case, then A
has made a verification query Vf(ğ‘–, ğ‘ , ğ´ğ·, ğ¶âˆ¥ğ‘‡), an encryption
query Enc(ğ‘–, ğ‘ , ğ´ğ·â€², ğ‘€â€²) with answer ğ¶â€²âˆ¥ğ‘‡ â€², and finally a query
to Reveal that returned a ğ‘‰ â€²
0 associated to the previous encryption
query such that ğ‘Ÿ = [ğ‘‰ â€²
0]ğ‘Ÿ is a uniform random string. Hence the
probability that a transcript generated by A in the ideal augmented
game is in this case is bounded by the probability that A makes
the previously described queries. We are going to consider the case
where A is just about to query Reveal, but has already made all
its other oracle queries.
For each of the at most ğ‘ğ‘£ verification queries Vf(ğ‘–, ğ‘ , ğ´ğ·, ğ¶âˆ¥ğ‘‡)