out this section for all traces. On the other hand, a UDP
header is only 8 bytes, which leaves enough payload bytes
for eﬀective string matching on those packets.
MPLS : 60%-80% of the packets in our traces are encap-
sulated with 4-byte MPLS (Multiprotocol Label Switching)
headers. MPLS is used by this Tier1 ISP for routing and
traﬃc engineering purposes. MPLS decreases the number of
packets that can be matched against our string table since
for a signiﬁcant amount of traﬃc there is no payload (4-byte
MPLS header + 40-byte TCP header).
ISP caching : To alleviate the eﬀect of P2P traﬃc, ISPs
sometimes employ caching of P2P content [16]. P2P caching,
similar to web caching, is capable of reducing upstream traf-
ﬁc yielding large savings for ISPs.8 Naturally, P2P requests
that are served by these caches do not reach the backbone,
resulting in a limited view of P2P usage especially when
comparing with past years before P2P caching became com-
mon.
P2P versus copyrighted traﬃc: Typically, the major-
ity of P2P traﬃc is related to copyrighted material. Al-
though we cannot necessarily equate P2P with copyrighted
traﬃc, the dominance of copyrighted material in most P2P
networks is largely accepted to be true. Our study cannot
identify the trends in the use of P2P networks for exchanging
copyrighted material.
Link utilization and time of the day : Two traces
can present drastically diﬀerent characteristics, even if taken
on the same link at diﬀerent times of day. While most of
our traces are collected during business hours, we compare
traces with varying utilizations and captured at diﬀerent
time within the day. We thus compare P2P traﬃc relative
to the total volume of traﬃc in the link rather than focusing
on absolute values.
Conﬂicting traﬃc engineering goals: Because of its
large volume, ISPs are tempted to manipulate P2P traf-
ﬁc according to their economic objectives. Networks that
pay for transit have an incentive to keep traﬃc within their
boundaries or those of their non-charging peers [9]. Net-
works that charge for transit can try to attract traﬃc by
adjusting routing and/or performance metrics (some P2P
clients prefer peers with lower RTTs; some, like BitTorrent,
choose ones with highest bitrate). An increase in peering
among cable companies was recently attributed to the rise
in P2P traﬃc [25]. Pricing of international vs. domestic
traﬃc can also play a role. Competitive peering behavior
can cause unpredictable link workload changes even when
other conditions are equal.
Finally, we note that many limitations of this analysis
(e.g., varying utilization across traces), as with virtually all
Internet measurement studies, are neither new nor unique
to Internet science.
7.1 P2P trafﬁc is growing
We compare traces D09 from May 2003 (southbound and
northbound), D10 of January 2004 (southbound and north-
bound), D11 of February 2004 (southbound) and D13 of
April 2004 (southbound and northbound). (Recall that Ta-
8ISPs are usually charged based on the traﬃc they send
upstream to their own providers.
Figure 7: Estimation of the volume of P2P traﬃc using four diﬀerent payload and nonpayload methodologies.
In all cases we observe a growing trend of P2P traﬃc, validated by all methodologies. Note also that estimates
of P2P traﬃc volume increase by 20%-100% when comparing port numbers with payload. Especially in our
northbound April 2004 trace, the payload estimate is more than double the estimate produced by port
numbers.
ble 1 lists bulk volumes and utilizations.) We use both pay-
load and nonpayload analysis. We present payload ﬁndings
analytically for each step of the methodology described in
section 4 (M1-M3).
Fig. 7 demonstrates the average bitrate of P2P traﬃc as
detected by each method for both directions of all traces. To
facilitate comparison, we present P2P volume as a percent-
age relative to total traﬃc volume across each trace. Despite
the aforementioned limitations, we make the following gen-
eral observations from Fig. 7:
Signiﬁcant decline of P2P traﬃc is not corroborated : On
the contrary, P2P traﬃc in our recent traces is, if not grow-
ing, at least comparable to older traces from 2003 and Jan-
uary 2004. This trend is supported by all methodologies ex-
amined for the southbound direction. For the northbound
direction, May 2003 and January 2004 volumes are com-
parable for all methods beyond M1 (P2P rate in “known”
ports); P2P traﬃc in our April trace (even with signiﬁcantly
higher total traﬃc volume on the link) surpasses all other
traces.
Failure of conventional estimation methodologies: As de-
picted in Fig. 7, using port numbers for traﬃc classiﬁcation
is misleading. P2P traﬃc measurements based on port num-
bers results in underestimating P2P traﬃc by more than
50%, especially in recent traces. Fig. 7 also illustrates the
migration to random port numbers when comparing 2003
with 2004 traces. While for May 2003 the diﬀerence in the
estimates of M1 and M2 is minimal, it explodes in our 2004
traces. The change is the eﬀect of newer P2P clients auto-
matically randomizing the port number.
Suﬃcient payload size: Comparing payload estimations of
P2P traﬃc with 4-byte and 16-byte payload for the Febru-
ary and April 2004 traces, demonstrates that the payload
limitation is also signiﬁcant for robust identiﬁcation. While
P2P traﬃc with 16-bytes of payload is estimated at approx-
imately 17% and 25% for February and April respectively
(shown in Fig. 2), estimates using 4-bytes of payload are
considerably lower.
Increasing the captured payload size
beyond 16 bytes will potentially result in a further increase
in the estimates of P2P traﬃc. As noted in section 4, even
with 16 bytes of payload there are still conﬂicting bit strings
between web and P2P protocols. However, many factors,
among them a hardware bottleneck of our monitoring sys-
tem, limit the size of payload we can capture.
M3 vs. nonpayload methodology: Since the previous anal-
ysis suggests that our nonpayload algorithm overestimates
(compared to the payload estimates, section 6.2 ) approx-
imately 10%, M3 and nonpayload estimates in most cases
are comparable. Note that nonpayload estimates also in-
clude traﬃc from the three protocols discovered during our
nonpayload analysis, which supports our conjecture that M3
in our payload methodology more accurately estimates P2P
traﬃc.
In general, P2P traﬃc has grown to constitute a con-
siderable portion of traﬃc in our monitored backbone link,
conﬁrming our assumption that estimations of P2P traﬃc
intensity based on a limited number of P2P networks or
characteristic port numbers is unrealistic. Our ﬁndings also
illustrate the expanding software alternatives for P2P users;
three previously unknown protocols in our traces constitute
a characteristic example of this increasing diversity of pro-
tocols and networks.
8. CONCLUSIONS
This paper focused on the non payload identiﬁcation and
monitoring of a signiﬁcant and growing component of In-
ternet traﬃc, namely P2P applications. Traditionally, P2P
traﬃc has been classiﬁed by well-known port numbers unique
to each protocol. However, growing concerns due to legal
and other complications have pushed P2P networks to chal-
lenge network “standards” by randomizing their port num-
bers and in general making some eﬀort to disguise their ac-
tivity. As a result conventional measurement analyses are
bound to underestimate P2P traﬃc, and indeed, reliable
identiﬁcation of P2P traﬃc requires examination of user
payload data.
We presented a method that relies on network and trans-
port layer behavior to identify P2P traﬃc. Speciﬁcally our
algorithm is based on proﬁling ﬂow patterns of IP addresses.
In addition, to validate our methodology, we developed a
payload scheme to identify P2P ﬂows by reverse-engineering
and analyzing the nine most popular P2P protocols/networks.
A key feature of our algorithm is its ability to identify
“unknown” P2P protocols. Since the methodology is based
on the general behavior of P2P networks, prior knowledge or
analysis of protocols is not required. Indeed, our algorithm
detected three distinct P2P protocols previously unknown
to us.
We show that our methodology is able to eﬀectively pin-
point among million of ﬂows more than 95% of P2P ﬂows
and bytes in traces from an operational OC48 backbone link.
The number of false positives ranges approximately from 8%
to 12% of the total payload-based estimate. Furthermore,
we demonstrated that our algorithm has the ability to iden-
tify P2P ﬂows missed by payload analysis.
Using estimates from both methodologies, we also chal-
lenged claims of a sharp decline in P2P activity. All of
our estimates of real Internet traﬃc, even based on simplis-
tic port number analysis, conﬁrm our hypothesis that P2P
traﬃc is growing in volume and will continue to grow un-
abatedly in the future.
We consider a number of future extensions to strengthen
our algorithm. First, we wish to exploit the availability of
bidirectional traces by merging IP pairs that appear in both
directions of the link. We also want to consider additional
heuristics that use knowledge of speciﬁc packet sizes that
may reﬂect control traﬃc of P2P protocols. Additionally,
the IP ID ﬁeld may facilitate the identiﬁcation of many ex-
isting connections by observing gaps in sequence numbers.
We are in the process of extending and generalizing our
methodology for use in more general traﬃc proﬁling. Dur-
ing this study we have illustrated connection characteristics
and patterns of various popular applications. Since sim-
ple port-based application breakdown has become problem-
atic for most workload characterization tasks, extending our
methodology to general traﬃc proﬁling may oﬀer a higher
integrity alternative.
Accurate monitoring of P2P traﬃc has become an im-
portant aspect of Internet traﬃc modeling. P2P traﬃc has
already risen to a signiﬁcant percentage of the total traﬃc,
15%-20% in our monitored links. On the other hand, its
idiosyncrasies (e.g., bandwidth symmetry) portend a dra-
matic change in our approach to network provisioning and
traﬃc engineering. In our previous work [17] we predicted
that the P2P paradigm threatens the asymmetrical band-
width assumption inherent in many broadband infrastruc-
tures, e.g., DSL and cable modems, and may even result
in further increases in local peering among ISPs [25]. These
changes in business choices among providers aﬀect the global
Internet topology and routing system, not to mention com-
petitive market dynamics, in ways that we have only begun
to consider. But with eﬃcient, accurate methods of work-
load characterization in the P2P realm, we can at least head
in to the future with better vision.
Acknowledgments
We are thankful to the Coral Reef suite team that made
this study possible. Thanks are due to our colleagues Ken
Keys, Colleen Shannon, Nevil Brownlee, Daniel Andersen
and Khushboo Shah for their support throughout this work.
We would also like to thank Carey Williamson and our IMC
anonymous referees for their helpful comments.
9. REFERENCES
[1] A.Broido, Y.Hyun, R.Gao, and kc claﬀy. Their share:
diversity and disparity in IP traﬃc. In PAM, 2004.
[2] Ares. http://www.softgap.com/.
[3] R. Bhagwan, S. Savage, and G. Voelker.
Understanding Availability. In IPTPS 03, 2003.
[4] BitTorrent. http://bitconjurer.org/BitTorrent/.
[5] John Borland. RIAA threat may be slowing ﬁle
swapping. “http://news.com.com/2100-1027-1025684.html”.
[6] K. Claﬀy, H.-W. Braun, and G. Polyzos. A
Parametrizable methodology for Internet traﬃc ﬂow
proﬁling. In IEEE JSAC, 1995.
[7] Direct Connect. http://www.neo-modus.com/.
[8] C.Fraleigh e.a. Packet-Level Traﬃc Measurements
from the Sprint IP Backbone. In IEEE Network, 2003.
[9] J.E.Gabeiras e.a. Estrategias para inﬂuir en el tr´aﬁco
p2p. Telefonica Investigaci´on y Desarrollo, whitepaper,
2004.
[10] eDonkey2000. http://www.edonkey2000.com/.
[11] eMule. http://www.emule-project.net/.
[12] Endace, 2004. www.endace.com.
[13] C. Gkantsidis, M. Mihail, and A. Saberi. Random
Walks in Peer-to-Peer Networks. In INFOCOM, 2004.
[14] I.Graham, M.Pearson, J.Martens, and S.Donnelly.
Dag - a cell capture board for ATM measurement
systems, 1997. wand.cs.waikato.ac.nz.
[15] M. Izal, G. Urvoy-Keller, E.W. Biersack, P.A. Felber,
A. Al Hamra, and L. Garc’es-Erice. Dissecting
BitTorrent: Five Months in a Torrent’s Lifetime. In
PAM, 2004.
[16] Joltid. http://www.joltid.com.
[17] T. Karagiannis, A.Broido, N.Brownlee, kc claﬀy, and
M.Faloutsos. Is P2P dying or just hiding? In IEEE
Globecom 2004 - Global Internet and Next Generation
Networks, 2004.
[18] T. Karagiannis, A. Broido, N. Brownlee, kc claﬀy, and
M. Faloutsos. File-sharing in the Internet: A
characterization of P2P traﬃc in the backbone.
Technical report., 2004. http://www.cs.ucr.edu/∼tkarag.
[19] P. Karbhari, M. Ammar, A. Dhamdhere, H.Raj,
G. Riley, and E. Zegura. Bootstrapping in Gnutella: A
Measurement Study. In PAM, 2004.
[20] K. Keys, D. Moore, R. Koga, E. Lagache, M. Tesch,
and k. claﬀy. The architecture of the CoralReef:
Internet Traﬃc monitoring software suite. In PAM,
2001.
[21] K.Tutschku. A Measurement-based Traﬃc Proﬁle of
the eDonkey Filesharing Service. In PAM, 2004.
[22] N. Leibowitz, A. Bergman, Roy Ben-Shaul, and Aviv
Shavit. Are File Swapping Networks Cacheable?
Characterizing P2P Traﬃc. In 7th IWCW, 2002.
[23] D. Moore, K. Keys, R. Koga, E. Lagache, and
kc claﬀy. Coralreef software suite as a tool for system
and network administrators. In Usenix LISA, 2001.
[24] MP2P. http://www.slyck.com/mp2p.php.
[25] W. B. Norton. The evolution of the u.s. internet
peering ecosystem, 2003.
http://www.equinix.com/pdf/whitepapers/PeeringEcosystem.pdf.
[26] Pew Internet & American Life Project. Sharp decline
in music ﬁle swappers: Data memo from PIP and
comScore Media Metrix, January, 2004.
http://www.pewinternet.org/reports/.
[27] S. Saroiu, P. K. Gummadi, and S. D. Gribble. A
Measurement Study of Peer-to-Peer File Sharing
Systems. In MMCN, 2002.
[28] S. Sen, O. Spatscheck, and D. Wang. Accurate,
Scalable In-Network Identiﬁcation of P2P Traﬃc
Using Application Signatures. In WWW, 2004.
[29] S. Sen and J. Wang. Analyzing Peer-to-Peer Traﬃc
Across Large Networks. In IMW, 2002.
[30] Soulseek. http://www.slsknet.org/.
[31] tcpdump. http://www.tcpdump.org/.
[32] WinMx. http://www.winmx.com/.
[33] J. Xu, J. Fan, and M. H. Ammar. Preﬁx-Preserving
IP Address Anonymization: Measurement-based
Security Evaluation and a New Cryptography-based
Scheme. In IEEE ICNP, 2002.