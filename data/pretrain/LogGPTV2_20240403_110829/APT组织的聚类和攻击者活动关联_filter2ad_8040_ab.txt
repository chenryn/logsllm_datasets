这种方法的一个好处是不同矢量的处理方式相同 – 因此，一个新的，相对较小的 UNC 集群指向与证据充分的 APT
组织相同的方向，反映出高水平的相似性。FireEye在发现与已建立的群体具有高度相似性的新活动集群时亦采用了该方法。
FireEye 使用 TF-IDF （词频-反文档频率）和 Cosine Similarity
（余弦相似度）来计算文档语料库中每个组的主题特定相似性。最后将主题相似性组合成一个单一的集合（图 5
）。这个单一指标允许我们快速查询我们的数据“类似于X的组”或“X和 Y之间的相似性”。威胁分析聚合的难点就在于：建立这种最终相似性的最佳方法是什么？
图 5：总体模型流程（显示了各个主题的相似性以及最终相似性矩阵的聚合）
最简单的方法是采取平均值，这也正是 FireEye
所做的。但对分析师来说，这种方法与分析师的分析工作并没有很好地同步。于分析师而言，相对于分析平均值，我们更加关注这样一些东西，例如：恶意软件和TTP应该比服务器位置或目标行业更重要。因此，FireEye
采取了对每个主题提供自定义权重，但如何找到一个客观的不受分析师偏见的加权系统。FireEye的工程师想要证明这种设想：“如何使用现有的已知数据来告诉我们什么是正确的权重？”为了做到这一点，FireEye需要很多已知的
“标记”，标记类似或不同特征。
## 5．构建标记数据集
FireEye起初的建模概念是：首先找到一个标记对的大型数据集，然后拟合一个回归模型来准确地对它们进行分类。如果成功，这个模型应该能给出正确的权重。
图 6 显示了这种方法背后的一些有助于分析的直观的视角图形。首先，使用一组“标记”对，我们拟合一个最能预测数据点的函数。
图 6：示例线性回归
FireEye实际上使用了逻辑回归，但展示时使用的是一个线性模型来证明判断。FireEye 使用相同的函数来预测未标记对的聚合相似性（图 7 ）
图 7：使用训练模型预测各个主题相似性的最终相似性
FireEye
的数据在某种意义上提出了一个特别的问题：即只分析了所有潜在配对中的小部分。这些分析是手动和偶尔发生的，通常是调查突然发生的新信息最终将两个群体联系在一起的结果。作为标记数据集，已有的数据集不足以对分析方法进行任何严格的评估。FireEye
依旧需要更多标记数据。
FireEye 的两位数据专家提出了一个聪明的方法：假设我们从成熟的 APT
小组中随机抽样来创建数千个“假”群集会怎么样？因此，我们可以将来自同一组的任何两个样本标记为绝对相似，并且将来自不同组的任何两个样本标记为不相似（图 8
）。这使我们能够合成生成我们迫切需要的标记数据集。然后，使用线性回归模型，我们能够优雅地解决这个“加权平均”问题，而不是依赖于主观猜测。
图 8：使用从已知 APT 组派生的“假”集群进行的相似性测试
此外，这些合成创建的聚类为 FireEye
提供了一个数据集，可以在其上测试模型的各种迭代。如果我们删除主题怎么办？如果我们改变捕获术语的方式怎么办？使用大型标记数据集，FireEye
现在可以在更新和改进模型时对性能进行基准测试和评估。  
为了评估模型，我们观察了几个指标：
  * 回想一下我们所知道的合成集群来自同一个原始组织 – 我们有多少是对还是错？这评估了给定方法的准确性。
  * 对于单个主题，计算相关和不相关群集的相似性之间的“扩散”。这有助于我们确定哪些主题可以帮助您最好地分类。
  * 训练回归模型的准确性，作为主题所代表的相似和不相似群集之间的“信号”的代理。这可以帮助我们识别过度拟合问题。
## 6．现阶段使用场景
在FireEye
的日常运营中，该模型用于增强和协助我们的情报专家。提出客观的相似之处，它可以挑战偏见并引入以前未考虑的新调查线。当处理成千上万的集群和每天从全球分析师那里添加的新集群时，即使是经验最丰富且最有意识的Intel分析师也可能因错失潜在的潜在威胁而被责罚。但是，FireEye的模型能够根据需要向分析师提供可能的合并和相似性，从而可以帮助他们发现那些难以发现的潜在威胁。
## 7．未来工作及展望
###  7.1．完善模型
通过手动输入调查信息的方式存在标签噪音。有时攻击者的“无关”数据尚未在我们的文档中表示。
FireEye
尚未完全纳入“活动时间”，而是依赖于“记录时间”,这使得基于时间的分析变得困难。攻击者最近所做的事情可能意味着比他们五年前所做的更多。针对改弊端，FireEye
已经在完善中。
###  7.2．展望
FireEye利用客观的分析方法、算法并构建模型，对威胁研究者的分析工作进行了优化，使用算法并建立适合的智能分析模型已经被广泛用于不同领域来提升工作效率、工作质量。如：在取证数据之上构建机器学习模型可以快速突出数据建模、存储和访问的潜在改进。关于机器学习模型的利用，FireEye推荐了[2018年CAMLIS](https://www.youtube.com/channel/UCmIY4lIVsotxeUDRCQb2ZXA)会议上的一个视频。
# APTinder：一种优化的方法，可以找到完美的APT匹配
FireEye期待着智能模型能够帮助威胁研究者关联分析、聚类发现和明确更多已知的和未知的APT相关事件，并在威胁发生之前阻止攻击者。
[视频地址](https://youtu.be/zMdHGY53VEw)
## 8．思考与总结
在国内，大多安全公司和厂商主要针对于对单个APT组的溯源和追踪，像FireEye这样将网络攻击的 “数据”、“标签信息”通过TF-IDF（词频-反文档频率）算法，针对网络攻击的特殊性进行挖掘，再利用(Cosin
Similarity)余弦相似度进行同源性的汇聚还较为少见。FireEye的这个分析模型，清晰的指出了安全分析师、情报分析人员真正看重的一些东西，也明确了针对海量样本及大量的攻击事件模型可以起到的作用。
21世纪，信息时代大家都在热议：“大数据”、“人工智能”，貌似我的产品不具备这样的能力就会被市场淘汰，要进行分析，首先得有数据，有了数据怎样将关键的信息挖掘出来？怎样将我们所在乎的对象利用合理的模型给出直观的结果？当然，国内一些BAT公司已经具备了这样的能力，阿里巴巴的城市大脑，美团的订单配送系统，那么我们安全相关的威胁情报研究方面呢？还有很长的路要走，技术能让生活变得更美好，潜心做产品，低调做安全，希望本文能引发更多志趣相同的朋友的思考。
## 9．参考链接
  * 
  * 