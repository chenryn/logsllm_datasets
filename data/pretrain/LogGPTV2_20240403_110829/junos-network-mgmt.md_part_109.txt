and paste the commands into the CLI at the [edit] hierarchy level, and then enter commit from
configuration mode.
set security log mode stream
set security log format sd-syslog
set security log source-interface ge-0/0/1.0
set security log transport protocol tls
set security log transport tls-profile ssl-i-tls
set security log stream server1 format sd-syslog
set security log stream server1 category all
set security log stream server1 host 192.0.2.100
set services ssl initiation profile ssl-i-tls protocol-version all
set services ssl initiation profile ssl-i-tls trusted-ca all
set services ssl initiation profile ssl-i-tls actions ignore-server-auth-failure
Step-by-Step Procedure
The following example requires you to navigate various levels in the configuration hierarchy. For
instructions on how to do that, see Using the CLI Editor in Configuration Mode in the CLI User Guide.
To configure the TLS syslog protocol:
1370
1. Set the log mode to stream.
[edit security]
user@host# set log mode stream
2. Specify the structured system log (sd-syslog) format for remote security message logging .
[edit security]
user@host# set log format sd-syslog
3. Set the host source interface number.
[edit security]
user@host# set log source-interface ge-0/0/1.0
4. Specify TLS as the security log transport protocol to be used to log the data.
[edit security]
user@host# set log transport protocol tls
5. Specify the TLS profile name.
[edit security]
user@host# set log transport tls-profile ssl-i-tls
6. Set the log stream to use the structured syslog format for sending logs to server 1.
[edit security]
user@host# set log stream server1 format sd-syslog
7. Set the category of server 1 logging to all.
[edit security]
user@host# set log stream server1 category all
1371
8. Specify server host parameters by entering the server name or IP address.
[edit security]
user@host# set log stream server1 host 192.0.2.100
9. Define the protocol version all for the SSL initiation access profile.
[edit services]
user@host# set ssl initiation profile ssl-i-tls protocol-version all
10. Attach all CA profile groups to the SSL initiation profile to use when requesting a certificate from
the peer.
[edit services]
user@host# set ssl initiation profile ssl-i-tls trusted-ca all
11. Configure the SSL initiation access profile to ignore the server authentication failure.
[edit services]
user@host# set ssl initiation profile ssl-i-tls actions ignore-server-auth-failure
Results
In configuration mode, verify your configuration by using the show security log command. If the output
does not display the intended configuration, then repeat the configuration instructions in this example
to correct it.
[edit]
user@host# show security log
mode stream;
format sd-syslog;
source-interface ge-0/0/1.0;
transport {
protocol tls;
tls-profile ssl-i-tls;
}
stream server1 {
format sd-syslog;
1372
category all;
host {
192.0.2.100;
}
}
}
[edit]
user@host# run show configuration services ssl initiation
profile ssl-i-tls {
protocol-version all;
trusted-ca all;
actions {
ignore-server-auth-failure;
}
}
If you are done configuring the device, enter commit from configuration mode.
Verification
To verify that the configuration is working properly, enter the show log command on the syslog server.
Monitor Log Messages
IN THIS SECTION
Monitor System Log Messages | 1373
1373
Monitor System Log Messages
IN THIS SECTION
Purpose | 1373
Action | 1373
Meaning | 1374
Purpose
Display system log messages about the QFX Series. By looking through a system log file for any entries
pertaining to the interface that you are interested in, you can further investigate a problem with an
interface on the switch.
Action
To view system log messages:
user@switch1> show log messages
Sample Output
command-name
Nov 4 11:30:01 switch1 newsyslog[2283]: logfile turned over due to size>128K
Nov 4 11:30:01 switch1 newsyslog[2283]: logfile turned over due to size>128K
Nov 4 11:30:06 switch1 chassism[952]: CM ENV Monitor: set fan speed is 65 percent for Fan 1
Nov 4 11:30:06 switch1 chassism[952]: CM ENV Monitor: set fan speed is 65 percent for Fan 2
Nov 4 11:30:06 switch1 chassism[952]: CM ENV Monitor: set fan speed is 65 percent for Fan 3
...
Nov 4 11:52:53 switch1 snmpd[944]: SNMPD_HEALTH_MON_INSTANCE: Health Monitor: jroute daemon
memory usage (Management process): new instance detected (variable:
sysApplElmtRunMemory.5.6.2293)
Nov 4 11:52:53 switch1 snmpd[944]: SNMPD_HEALTH_MON_INSTANCE: Health Monitor: jroute daemon
1374
memory usage (Command-line interface): new instance detected (variable:
sysApplElmtRunMemory.5.8.2292)
...
Nov 4 12:10:24 switch1 mgd[2293]: UI_CMDLINE_READ_LINE: User 'jsmith', command 'exit '
Nov 4 12:10:27 switch1 mgd[2293]: UI_DBASE_LOGOUT_EVENT: User 'jsmith' exiting configuration
mode
Nov 4 12:10:31 switch1 mgd[2293]: UI_CMDLINE_READ_LINE: User 'jsmith', command 'show log
messages
Meaning
The sample output shows the following entries in the messages file:
• A new log file was created when the previous file reached the maximum size of
128 kilobytes (KB).
• The fan speed for Fan 1, 2, and 3 is set at 65 percent.
• Health monitoring activity is detected.
• CLI commands were entered by the user jsmith.
SEE ALSO
clear log
show log
syslog
11
PART
Network Management and
Troubleshooting
Monitoring and Troubleshooting | 1376
Troubleshooting System Performance with Resource Monitoring Methodology |
1426
Configuring Data Path Debugging and Trace Options | 1437
Using MPLS to Diagnose LSPs, VPNs, and Layer 2 Circuits | 1455
Using Packet Capture to Analyze Network Traffic | 1459
Troubleshooting Security Devices | 1488
1376
Monitoring and Troubleshooting
SUMMARY IN THIS SECTION
This section describes the network monitoring and Ping Hosts | 1376
troubleshooting features of Junos OS.
Monitor Traffic Through the Router or
Switch | 1378
Dynamic Ternary Content Addressable
Memory Overview | 1382
Troubleshooting DNS Name Resolution in
Logical System Security Policies (Primary
Administrators Only) | 1397
Troubleshooting the Link Services
Interface | 1399
Troubleshooting Security Policies | 1412
Log Error Messages used for Troubleshooting
ISSU-Related Problems | 1416
Ping Hosts
IN THIS SECTION
Purpose | 1376
Action | 1377
Meaning | 1377
Purpose
Use the CLI ping command to verify that a host can be reached over the network. This command is
useful for diagnosing host and network connectivity problems. The device sends a series of Internet
Control Message Protocol (ICMP) echo (ping) requests to a specified host and receives ICMP echo
responses.
1377
Action
To use the ping command to send four requests (ping count) to host3:
ping host count number
Sample Output
command-name
ping host3 count 4
user@switch> ping host3 count 4
PING host3.site.net (192.0.2.111): 56 data bytes
64 bytes from 192.0.2.111: icmp_seq=0 ttl=122 time=0.661 ms
64 bytes from 192.0.2.111: icmp_seq=1 ttl=122 time=0.619 ms
64 bytes from 192.0.2.111: icmp_seq=2 ttl=122 time=0.621 ms
64 bytes from 192.0.2.111: icmp_seq=3 ttl=122 time=0.634 ms
--- host3.site.net ping statistics ---
4 packets transmitted, 4 packets received, 0% packet loss
round-trip min/avg/max/stddev = 0.619/0.634/0.661/0.017 ms
Meaning
• The ping results show the following information:
• Size of the ping response packet (in bytes).
• IP address of the host from which the response was sent.
• Sequence number of the ping response packet. You can use this value to match the ping response
to the corresponding ping request.
• Time-to-live (ttl) hop-count value of the ping response packet.
• Total time between the sending of the ping request packet and the receiving of the ping response
packet, in milliseconds. This value is also called round-trip time.
• Number of ping requests (probes) sent to the host.
• Number of ping responses received from the host.
1378
• Packet loss percentage.
• Round-trip time statistics: minimum, average, maximum, and standard deviation of the round-trip
time.
Monitor Traffic Through the Router or Switch
IN THIS SECTION
Display Real-Time Statistics About All Interfaces on the Router or Switch | 1378
Display Real-Time Statistics About an Interface on the Router or Switch | 1380
For diagnosing a problem, display real-time statistics about the traffic passing through physical
interfaces on the router or switch.
To display real-time statistics about physical interfaces, perform these tasks:
Display Real-Time Statistics About All Interfaces on the Router or Switch
IN THIS SECTION
Purpose | 1378
Action | 1379
Meaning | 1379
Purpose
Display real-time statistics about traffic passing through all interfaces on the router or switch.
1379
Action
To display real-time statistics about traffic passing through all interfaces on the router or switch:
user@host> monitor interface traffic
Sample Output
command-name
user@host> monitor interface traffic
host name Seconds: 15 Time: 12:31:09
Interface Link Input packets (pps) Output packets (pps)
so-1/0/0 Down 0 (0) 0 (0)
so-1/1/0 Down 0 (0) 0 (0)
so-1/1/1 Down 0 (0) 0 (0)
so-1/1/2 Down 0 (0) 0 (0)
so-1/1/3 Down 0 (0) 0 (0)
t3-1/2/0 Down 0 (0) 0 (0)
t3-1/2/1 Down 0 (0) 0 (0)
t3-1/2/2 Down 0 (0) 0 (0)
t3-1/2/3 Down 0 (0) 0 (0)
so-2/0/0 Up 211035 (1) 36778 (0)
so-2/0/1 Up 192753 (1) 36782 (0)
so-2/0/2 Up 211020 (1) 36779 (0)
so-2/0/3 Up 211029 (1) 36776 (0)
so-2/1/0 Up 189378 (1) 36349 (0)
so-2/1/1 Down 0 (0) 18747 (0)
so-2/1/2 Down 0 (0) 16078 (0)
so-2/1/3 Up 0 (0) 80338 (0)
at-2/3/0 Up 0 (0) 0 (0)
at-2/3/1 Down 0 (0) 0 (0)
Bytes=b, Clear=c, Delta=d, Packets=p, Quit=q or ESC, Rate=r, Up=^U, Down=^D
Meaning
The sample output displays traffic data for active interfaces and the amount that each field has changed
since the command started or since the counters were cleared by using the C key. In this example, the
monitor interface command has been running for 15 seconds since the command was issued or since the
counters last returned to zero.
1380
Display Real-Time Statistics About an Interface on the Router or Switch
IN THIS SECTION
Purpose | 1380
Action | 1380
Meaning | 1381
Purpose
Display real-time statistics about traffic passing through an interface on the router or switch.
Action
To display traffic passing through an interface on the router or switch, use the following Junos OS CLI
operational mode command:
user@host> monitor interface interface-name
Sample Output
command-name
user@host> monitor interface so-0/0/1
Next='n', Quit='q' or ESC, Freeze='f', Thaw='t', Clear='c', Interface='i'
R1
Interface: so-0/0/1, Enabled, Link is Up
Encapsulation: PPP, Keepalives, Speed: OC3 Traffic statistics:
Input bytes: 5856541 (88 bps)
Output bytes: 6271468 (96 bps)
Input packets: 157629 (0 pps)
Output packets: 157024 (0 pps)
Encapsulation statistics:
Input keepalives: 42353
Output keepalives: 42320
LCP state: Opened
Error statistics:
1381
Input errors: 0
Input drops: 0
Input framing errors: 0
Input runts: 0
Input giants: 0
Policed discards: 0
L3 incompletes: 0
L2 channel errors: 0
L2 mismatch timeouts: 0
Carrier transitions: 1
Output errors: 0
Output drops: 0
Aged packets: 0
Active alarms : None
Active defects: None
SONET error counts/seconds:
LOS count 1
LOF count 1
SEF count 1
ES-S 77
SES-S 77
SONET statistics:
BIP-B1 0
BIP-B2 0
REI-L 0
BIP-B3 0
REI-P 0
Received SONET overhead: F1 : 0x00 J0 : 0xZ
Meaning
The sample output shows the input and output packets for a particular SONET interface (so-0/0/1). The
information can include common interface failures, such as SONET/SDH and T3 alarms, loopbacks
detected, and increases in framing errors. For more information, see Checklist for Tracking Error
Conditions.
To control the output of the command while it is running, use the keys shown in Table 1.
1382
Table 151: Output Control Keys for the monitor interface Command
Action Key
Display information about the next interface. The monitor interface command scrolls N
through the physical or logical interfaces in the same order that they are displayed by the
show interfaces terse command.
Display information about a different interface. The command prompts you for the name I
of a specific interface.
Freeze the display, halting the display of updated statistics. F
Thaw the display, resuming the display of updated statistics. T
Clear (zero) the current delta counters since monitor interface was started. It does not C
clear the accumulative counter.
Stop the monitor interface command. Q
See the CLI Explorer for details on using match conditions with the monitor traffic command.
Dynamic Ternary Content Addressable Memory Overview
IN THIS SECTION
Applications using Dynamic TCAM Infrastructure | 1383
Features Using TCAM Resource | 1383
Monitoring TCAM Resource Usage | 1387
Example: Monitoring and Troubleshooting the TCAM Resource | 1388
Monitoring and Troubleshooting TCAM Resource in ACX Series Routers | 1395
Service Scaling on ACX5048 and ACX5096 Routers | 1397
1383
In ACX Series routers, Ternary Content Addressable Memory (TCAM) is used by various applications like
firewall, connectivity fault management, PTPoE, RFC 2544, etc. The Packet Forwarding Engine (PFE) in
ACX Series routers uses TCAM with defined TCAM space limits. The allocation of TCAM resources for
various filter applications are statically distributed. This static allocation leads to inefficient utilization of
TCAM resources when all the filter applications might not use this TCAM resource simultaneously.
The dynamic allocation of TCAM space in ACX routers efficiently allocates the available TCAM
resources for various filter applications. In the dynamic TCAM model, various filter applications (such as
inet-firewall, bridge-firewall, cfm-filters, etc.) can optimally utilize the available TCAM resources as and
when required. Dynamic TCAM resource allocation is usage driven and is dynamically allocated for filter
applications on a need basis. When a filter application no longer uses the TCAM space, the resource is
freed and available for use by other applications. This dynamic TCAM model caters to higher scale of
TCAM resource utilization based on application’s demand.
Applications using Dynamic TCAM Infrastructure
The following filter application categories use the dynamic TCAM infrastructure:
• Firewall filter—All the firewall configurations
• Implicit filter—Routing Engine (RE) demons using filters to achieve its functionality. For example,
connectivity fault management, IP MAC validation, etc.
• Dynamic filters—Applications using filters to achieve the functionality at the PFE level. For example,
logical interface level fixed classifier, RFC 2544, etc. RE demons will not know about these filters.
• System-init filters—Filters that require entries at the system level or fixed set of entries at router's
boot sequence. For example, Layer 2 and Layer 3 control protocol trap, default ARP policer, etc.
NOTE: The System-init filter which has the applications for Layer 2 and Layer 3 control
protocols trap is essential for the overall system functionality. The applications in this control
group consume a fixed and minimal TCAM space from the overall TCAM space. The system-
init filter will not use the dynamic TCAM infrastructure and will be created when the router is
initialized during the boot sequence.
Features Using TCAM Resource
Applications using the TCAM resource is termed tcam-app in this document. For example, inet-firewall,
bridge-firewall, connectivity fault management, link fault management, and so on are all different tcam-