===========================================================================
...
D
Listing 384 - Routing table on CLIENTWK220
Listing 384 shows no routes to any previously unknown networks. However, we should always
check the routing table on a target system to ensure we don’t miss any information.
To list all active network connections we can use netstat753 with the argument -a to display all
active TCP connections as well as TCP and UDP ports, -n to disable name resolution, and -o to
show the process ID for each connection.
PS C:\Users\dave> netstat -ano
netstat -ano
Active Connections
Proto Local Address Foreign Address State PID
TCP 0.0.0.0:80 0.0.0.0:0 LISTENING 6824
TCP 0.0.0.0:135 0.0.0.0:0 LISTENING 960
TCP 0.0.0.0:443 0.0.0.0:0 LISTENING 6824
752 (Microsoft Documentation, 2021), https://docs.microsoft.com/en-us/windows-server/administration/windows-
commands/route_ws2008
753 (Microsoft Documentation, 2021), https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/netstat
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 482
Made in Morocco
Penetration Testing with Kali Linux
TCP 0.0.0.0:445 0.0.0.0:0 LISTENING 4
TCP 0.0.0.0:3306 0.0.0.0:0 LISTENING 1752
TCP 0.0.0.0:3389 0.0.0.0:0 LISTENING 1084
TCP 0.0.0.0:5040 0.0.0.0:0 LISTENING 3288
...
TCP 192.168.50.220:139 0.0.0.0:0 LISTENING 4
TCP 192.168.50.220:3389 192.168.119.4:33060 ESTABLISHED 1084
TCP 192.168.50.220:4444 192.168.119.3:51082 ESTABLISHED 2044
...
Listing 385 - Active network connections on CLIENTWK220
The output of listing 385 shows that ports 80 and 443 are listening, usually indicating that a web
server is running on the system. Additionally, an open port of 3306 is indicative of a running
MySQL754 server.
The output also shows our Netcat connection on port 4444 as welly as an RDP connection from
192.168.119.4 on port 3389. This means we are not the only user currently connected to the
system. Once we manage to elevate our privileges, we could use Mimikatz and attempt to extract
k
credentials of the user.
Next, we’ll check all installed applications. We can query stwo registry keys755 to list both 32-bit and
64-bit applications in the Windows Registry with the Get-ItemProperty756 Cmdlet. We pipe the
output to select with the argument displayname to only display the application’s names. We begin
o
with the 32-bit applications and then display the 64-bit applications.
PS C:\Users\dave> Get-ItemProperty n
"HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\*" | select
displayname
Get-ItemProperty i
"HKLM:\SOFTWARE\Wow6432Node\Mizcrosoft\Windows\CurrentVersion\Uninstall\*" | select
displayname
displayname D
-----------
KeePass Password Safe 2.51.1
Microsoft Edge
Microsoft Edge Update
Microsoft Edge WebView2 Runtime
...
Microsoft Visual C++ 2015-2019 Redistributable (x86) - 14.28.29913
Microsoft Visual C++ 2019 X86 Additional Runtime - 14.28.29913
Microsoft Visual C++ 2019 X86 Minimum Runtime - 14.28.29913
Microsoft Visual C++ 2015-2019 Redistributable (x64) - 14.28.29913
PS C:\Users\dave> Get-ItemProperty
"HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\*" | select displayname
Get-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\*" |
select displayname
754 (MySQL, 2022), https://www.mysql.com/
755 (Microsoft Devblog, 2013), https://devblogs.microsoft.com/scripting/use-powershell-to-find-installed-software/
756 (Microsoft Documentation, 2022), https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-
itemproperty?view=powershell-7.2
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 483
Made in Morocco
Penetration Testing with Kali Linux
DisplayName
-----------
7-Zip 21.07 (x64)
...
XAMPP
VMware Tools
Microsoft Visual C++ 2019 X64 Additional Runtime - 14.28.29913
Microsoft Visual C++ 2019 X64 Minimum Runtime - 14.28.29913
Listing 386 - Installed applications on CLIENTWK220
Listing 386 shows that apart from standard Windows applications, the KeePass757 password
manager, 7-Zip,758 and XAMPP759 are installed on CLIENTWK220.
As discussed in the Module “Locating Public Exploits”, we could search for public exploits for the
identified applications after we finish the situational awareness process. We could also leverage
password attacks to retrieve the master password of the password myanager to potentially obtain
other passwords, enabling us to log on as a privileged user.
k
However, the listed applications from Listing 386 may not be complete. For example, this could
be due to an incomplete or flawed installation process. Therefore, we should always check 32-bit
and 64-bit Program Files directories located in C:\. Addistionally, we should review the contents of
the Downloads directory of our user to find more potential programs.
o
While it is important to create a list of installed applications on the target system, it is equally
important to identify which of them are currently running. For this, we’ll review the running
processes of the system with Get-Process.7n60
PS C:\Users\dave> Get-Process
Get-Process i
z
Handles NPM(K) PM(K) WS(K) CPU(s) Id SI ProcessName
------- ------ ----- ----- ------ -- -- -----------
D
49 12 528 1152 0.03 2044 0 access
...
477 49 17328 23904 6068 0 httpd
179 29 9608 19792 6824 0 httpd
...
174 16 210620 29048 1752 0 mysqld
...
825 40 75804 14404 5.91 6332 0 powershell
...
379 24 6864 30236 2272 1 xampp-control
...
Listing 387 - Running processes on CLIENTWK220
Listing 387 shows a shortened list of all running processes on CLIENTWK220. It contains our
bind shell with ID 2044 and the PowerShell session we started for the enumeration process with
ID 6332.
757 (KeePass, 2022), https://keepass.info/
758 (7Zip, 2022), https://www.7-zip.org/
759 (Apache Friends, 2022), https://www.apachefriends.org/
760 (Microsoft Documentation, 2022), https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-
process?view=powershell-7.2
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 484
Made in Morocco
Penetration Testing with Kali Linux
When we review the netstat output of Listing 385 again, we can confirm that the process ID 1752
belongs to mysqld and ID 6824 to Apache displayed as httpd.
Due to the active process named xampp-control, we can infer that both Apache and MySQL were
started through XAMPP.
We gathered quite a lot of information with the previous commands. Let’s briefly summarize what
we found out about the target system:
The system is a 64-bit Windows 11 Pro Build 22000 with an active web server on ports 80 and
443, MySQL server on port 3306, our bind shell on port 4444, and an active RDP connection on
port 3389 from 192.168.119.4. Additionally, we found out that KeePass Password Manager, 7Zip,
and XAMPP are installed on the target system.
The information we gathered on users and groups as well as the target system provide a good
y
overview of the machine. In the next section, we’ll search for sensitive information on the target
system and interpret it based on the information gathered in the situational awareness process.
k
16.1.3 Hidden in Plain View
s
Based on the information found in the previous section, we can assume that the users on
CLIENTWK220 use a password manager. However, we should never underestimate the laziness
o
of users when it comes to passwords and sensitive information. What was traditionally the Post-it
note with the password under the keyboard is now quite often a text file on the desktop. While
browsing the home directory of our user or publicly accessible folders, we can retrieve various
n
pieces of sensitive information, which may provide us a vector for privilege escalation.
For example, sensitive informationi may be stored in meeting notes, configuration files, or
onboarding documents. With thez information we gathered in the situational awareness process,
we can make educated guesses on where to find such files.
D
Now, let’s search CLIENTWK220 for sensitive information. We have identified that KeePass and
XAMPP are installed on the system and therefore, we should search for password manager
databases and configuration files of these applications.
For this, we again connect to the system’s bind shell. Let’s begin our search by entering C:\ as
argument for -Path and *.kdbx as argument for -Include to search for all password manager
databases on the system with Get-ChildItem761 in PowerShell.
PS C:\Users\dave> Get-ChildItem -Path C:\ -Include *.kdbx -File -Recurse -ErrorAction
SilentlyContinue
Get-ChildItem -Path C:\ -Include *.kdbx -File -Recurse -ErrorAction SilentlyContinue
Listing 388 - Searching for password manager databases on the C: drive
Listing 388 shows that no password manager databases could be found in our search.
Next, let’s search for sensitive information in configuration files of XAMPP. After reviewing the
documentation,762 we enter *.txt,*.ini for -Include because these file types are used by the
application for configuration files. Additionally, we enter C:\xampp as argument for -Path.
761 (Microsoft Documentation, 2022), https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-
childitem
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 485
Made in Morocco
Penetration Testing with Kali Linux
PS C:\Users\dave> Get-ChildItem -Path C:\xampp -Include *.txt,*.ini -File -Recurse -
ErrorAction SilentlyContinue
Get-ChildItem -Path C:\xampp -Include *.txt,*.ini -File -Recurse -ErrorAction
SilentlyContinue
...
Directory: C:\xampp\mysql\bin
Mode LastWriteTime Length Name
---- ------------- ------ ----
-a---- 6/16/2022 1:42 PM 5786 my.ini
...
Directory: C:\xampp
Mode LastWriteTime Length Name
---- ------------- ------ ----
-a---- 3/13/2017 4:04 AM 824 passwords.tyxt
-a---- 6/16/2022 10:22 AM 792 properties.ini
-a---- 5/16/2022 12:21 AM 7498 readme_de.txt
k
-a---- 5/16/2022 12:21 AM 7368 readme_en.txt
-a---- 6/16/2022 1:17 PM 1200 xampp-control.ini
Listing 389 - Searching for sensitive information in XAMPP directory
s
Listing 389 shows us that our search returned two files that may contain sensitive information.
The file my.ini is the configuration file for MyoSQL and passwords.txt contains the default
passwords for the different XAMPP components. Let’s review them.
n
PS C:\Users\dave> type C:\xampp\passwords.txt
type C:\xampp\passwords.txt
### XAMPP Default Passwords ###
i
z
1) MySQL (phpMyAdmin):
User: root
D
Password:
(means no password!)
...
Postmaster: Postmaster (postmaster@localhost)
Administrator: Admin (admin@localhost)
User: newuser
Password: wampp
...
PS C:\Users\dave> type C:\xampp\mysql\bin\my.ini
type C:\xampp\mysql\bin\my.ini
type : Access to the path 'C:\xampp\mysql\bin\my.ini' is denied.
At line:1 char:1
+ type C:\xampp\mysql\bin\my.ini
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+ CategoryInfo : PermissionDenied: (C:\xampp\mysql\bin\my.ini:String)
[Get-Content], UnauthorizedAccessEx
ception
+ FullyQualifiedErrorId :
762 (Apache Friends, 2022), https://www.apachefriends.org/docs/
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 486
Made in Morocco
Penetration Testing with Kali Linux
GetContentReaderUnauthorizedAccessError,Microsoft.PowerShell.Commands.GetContentComman
d
Listing 390 - Review the contents of passwords.txt and my.ini
Unfortunately, the file C:\xampp\passwords.txt only contains the unmodified default
passwords763 of XAMPP. Furthermore, we don’t have permissions to view the contents of
C:\xampp\mysql\bin\my.ini.
Next, let’s search for documents and text files in the home directory of the user dave. We enter
*.txt,*.pdf,*.xls,*.xlsx,*.doc,*.docx as file extensions to search for and set -Path to the home
directory.
PS C:\Users\dave> Get-ChildItem -Path C:\Users\dave\ -Include
*.txt,*.pdf,*.xls,*.xlsx,*.doc,*.docx -File -Recurse -ErrorAction SilentlyContinue
Get-ChildItem -Path C:\Users\dave\ -Include *.txt,*.pdf,*.xls,*.xlsx,*.doc,*.docx -
File -Recurse -ErrorAction SilentlyContinue y
Directory: C:\Users\dave\Desktop
k
Mode LastWriteTime Length sName
---- ------------- ------ ----
-a---- 6/16/2022 11:28 AM 339 asdf.txt
o
Listing 391 - Searching for text files and password manager databases in the home directory of dave
Listing 391 shows we that found a text file on the desktop of dave named asdf.txt. Let’s check the
n
contents of this file.
PS C:\Users\dave> cat Desktop\asdf.txt
i
cat Desktop\asdf.txt
z
notes from meeting:
- Contractors won't delivDer the web app on time
- Login will be done via local user credentials
- I need to install XAMPP and a password manager on my machine
- When beta app is deployed on my local pc:
Steve (the guy with long shirt) gives us his password for testing
password is: securityIsNotAnOption++++++
Listing 392 - Contents of asdf.txt
Note that we used cat instead of type to display the contents of a file in the
previous listing. In fact, both commands are aliases for the Get-Content764
Cmdlet in PowerShell and therefore we can use them interchangeably.
Listing 392 shows that the file was used for meeting notes. The note states that the web
application uses local users’ credentials and that for testing “Steve’s” password
securityIsNotAnOption++++++ can be used.
763 (XAMPP, 2022), https://www.apachefriends.org/faq_windows.html
764 (Microsoft Documentation, 2022), https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-
content?view=powershell-7.2
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 487
Made in Morocco
Penetration Testing with Kali Linux
Very nice!
The information gathered in the situational awareness process comes in handy now, since we
already know that a user named steve exists on the target system.
Before we attempt to leverage the password, let’s check what groups steve is a member of. This
time, we use the command net user with the username steve to obtain this information.
PS C:\Users\dave> net user steve
net user steve
User name steve
...
Last logon 6/16/2022 1:03:52 PM
Logon hours allowed All
y
Local Group Memberships *helpdesk *Remote Desktop Users
*Remote Management Use*Users
k
...
Listing 393 - Local groups user steve is a member of
s
While the output of Listing 393 shows that steve is not a member of the group Administrators, the
user is a member of the group Remote Desktop Users.
o
Let’s connect to CLIENTWK220 with RDP as steve and open PowerShell.
n
i