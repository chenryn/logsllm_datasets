• same backdoor as 
pattern1
• strings
• BinDiff result
pattern2
pattern1
59
Copyright©2019 nao_sec All Rights Reserved.
Summary
• Using Cobalt Strike
• Unique shellcode
• Encoded multiple times 
• T1140
• Keep data in resource area
60
Copyright©2019 nao_sec All Rights Reserved.
TA505
61
Copyright©2019 nao_sec All Rights Reserved.
TA505
• This group named TA505 by ProofPoint
• TA505 has been in the cybercrime business since around 2015
• Not APT
• Early days
• Sending malspam emails that infected banking Trojans and ransomware
• Recently
• Spread document files infected with RATs and bots mainly in Korea
• An attack on Japan was also observed
62
Copyright©2019 nao_sec All Rights Reserved.
TA505 case by KRCERT
• KRCERT has published an attack flow with TA505
• However we have only spotted a part of attack.
https://www.krcert.or.kr/filedownload.do?attach_file_seq=2169&attach_file_id=EpF2169.pdf
63
Copyright©2019 nao_sec All Rights Reserved.
In Japanese case
• malspam by TA505 targeted Japan in 
February
• It pushed FlawedAmmyy
• The subject and the text are 
interesting
• It copied malspam sent by other actors the 
day before
https://twitter.com/nao_sec/status/1098069300340903936
64
Copyright©2019 nao_sec All Rights Reserved.
Excel document file
65
Copyright©2019 nao_sec All Rights Reserved.
Excel document file
66
Copyright©2019 nao_sec All Rights Reserved.
Word document file
$ python oledump.py request.doc
1:       146 '¥x01CompObj'
2:      4096 '¥x05DocumentSummaryInformation'
3:      4096 '¥x05SummaryInformation'
4:      6858 '1Table'
5:       421 'Macros/PROJECT'
6:        71 'Macros/PROJECTwm'
7: M   95423 'Macros/VBA/NewMacros'
8: m    1020 'Macros/VBA/ThisDocument'
9:     28021 'Macros/VBA/_VBA_PROJECT'
67
Copyright©2019 nao_sec All Rights Reserved.
Malware
• FlawedAmmyy
• RAT created based on leaked Ammyy source code
• Clop
• ransomware
• Amadey
• Multifunctional bot
There are also others…
68
Copyright©2019 nao_sec All Rights Reserved.
FlawedAmmyy
• Signed
69
Copyright©2019 nao_sec All Rights Reserved.
FlawedAmmyy
• Install by msiexec.exe
• Download …
70
Copyright©2019 nao_sec All Rights Reserved.
FlawedAmmyy
• Use custom packer
71
Copyright©2019 nao_sec All Rights Reserved.
Clop
• signed
72
Copyright©2019 nao_sec All Rights Reserved.
Clop
• same custom packer
as FlawedAmmyy
73
Copyright©2019 nao_sec All Rights Reserved.
Clop
• run only as a service
• In other words, service installation is supposed to use other methods
• It is mentioned in the report of KRCERT
74
Copyright©2019 nao_sec All Rights Reserved.
Clop
• Decode Resource data
• bat file
• ransom note
@echo off
vssadmin Delete Shadows /all /quiet
vssadmin resize shadowstorage /for=c: /on=c: /maxsize=401MB
vssadmin resize shadowstorage /for=c: /on=c: /maxsize=unbounded
vssadmin resize shadowstorage /for=d: /on=d: /maxsize=401MB
vssadmin resize shadowstorage /for=d: /on=d: /maxsize=unbounded
vssadmin resize shadowstorage /for=e: /on=e: /maxsize=401MB
vssadmin resize shadowstorage /for=e: /on=e: /maxsize=unbounded
vssadmin resize shadowstorage /for=f: /on=f: /maxsize=401MB
vssadmin resize shadowstorage /for=f: /on=f: /maxsize=unbounded
vssadmin resize shadowstorage /for=g: /on=g: /maxsize=401MB
vssadmin resize shadowstorage /for=g: /on=g: /maxsize=unbounded
vssadmin resize shadowstorage /for=h: /on=h: /maxsize=401MB
vssadmin resize shadowstorage /for=h: /on=h: /maxsize=unbounded
bcdedit /set {default} recoveryenabled No
bcdedit /set {default} bootstatuspolicy ignoreallfailures
vssadmin Delete Shadows /all /quiet
75
Copyright©2019 nao_sec All Rights Reserved.
Amadey
• Amadey is installed by msiexec.exe when you open a malicious 
excel file
https://app.any.run/tasks/3430e711-7bb1-49b4-ac07-86b1a6b5c784/
76
Copyright©2019 nao_sec All Rights Reserved.
Amadey
• Same custom packer as 
FlawedAmmyy and Clop
77
Copyright©2019 nao_sec All Rights Reserved.
Amadey
• Luckily, it has symbol 
information
• Multifunctional bot
• Download and execute next payload
• Gathering environmental information
• Bypass UAC
• Check Avs
• etc…
78
Copyright©2019 nao_sec All Rights Reserved.
Amadey
• some interesting encoded strings
• C2 domain
• C2 parameter
• drop name and directory name
• Check Avs name
• AutoRun command
79
Copyright©2019 nao_sec All Rights Reserved.
Summary
• Excel 4.0 
• Defense Evasion
• Install malware using msiexec.exe 
• T1218
• Signed malware
• T1116
• Custom packer
• T1140
• Used for packing multiple malware families
80
Copyright©2019 nao_sec All Rights Reserved.
Tick
81
Copyright©2019 nao_sec All Rights Reserved.
Tick
• other name
• BRONZE BUTLER
• tick is Chinese origins group that has been active since at 
2008
• It targets Japan and Korea
82
Copyright©2019 nao_sec All Rights Reserved.
[Pattern2] 2019-02
extract
Drop
%temp%¥taskmar.exe
Word Open
%APPDATA%¥Microsoft¥Word¥Startup¥winhelp.wll
C2
Drop
https[:]//www.86coding.com//flow//index.php
https[:]//www.86coding.com//img//flow//img00.jpg
83
Copyright©2019 nao_sec All Rights Reserved.
RTF
• Extensions and icons mimic doc format
• It has OLE object
---+----------+---------------------------------------------------------------
id |index |OLE Object
---+----------+---------------------------------------------------------------
0 |0005EBBDh |format_id: 2 (Embedded)
| |class name: 'Package'
| |data size: 1673928
| |OLE Package object:
| |Filename: u'8.t'
| |Source path: u'C:¥¥Aaa¥¥tmp¥¥8.t'
| |Temp path = u'C:¥¥Users¥¥ADMINI~1¥¥AppData¥¥Local¥¥Temp¥¥8.t'
| |MD5 = '026dbdbb1e525ce4b86734fa08be513d'
---+----------+---------------------------------------------------------------
84
Copyright©2019 nao_sec All Rights Reserved.
RTF
• Dummy content mimics a real company
85
Copyright©2019 nao_sec All Rights Reserved.
DLL
• winhelp.wll
• word Add-In
• %APPDATA%¥Microsoft¥Word¥Startup
• Execute when open the Word application
• It has pdb infomation
• C:¥Users¥Frank¥Desktop¥doc_dll¥Release¥DocDll.pdb
86
Copyright©2019 nao_sec All Rights Reserved.
Downloader
• %temp%¥taskmar.exe
• File size is very large
• about 78MB
• self copy 1024 times
• It has PDB information
• C:¥Users¥Frank¥Desktop¥ABK-old¥Release¥ABK.pdb
87
Copyright©2019 nao_sec All Rights Reserved.
Downloader
• Similar code with the same logic
as Pattern1
88
Copyright©2019 nao_sec All Rights Reserved.
C2
http[:]//www.ishuiyunjian.com/source/include/post/index.php
http[:]//www.ishuiyunjian.com/source/include/post/post.jpg
Has dummy PDF
[Pattern3] 2019-01
89
Copyright©2019 nao_sec All Rights Reserved.
Downloader
• It has dummy PDF in resource area
• Named “EXE"
90
Copyright©2019 nao_sec All Rights Reserved.
Downloader
• It has config in resource area
91
Copyright©2019 nao_sec All Rights Reserved.
Downloader
• There is no big change, 
but it is different in some codes
• maybe update?
92
Copyright©2019 nao_sec All Rights Reserved.
[Pattern4] 2019-05
%temp%¥taskhast.exe
C2
http[:]//www.carilite.net//Coolbee//coolbee.bmp
http[:]//www.carilite.net//Coolbee//index.php
93
Copyright©2019 nao_sec All Rights Reserved.
Dropper
• Strings Table
• only “Folder”
• It has PDB information
• C:¥Users¥Frank¥Desktop¥ABK¥
Release¥Hidder.pdb
94
Copyright©2019 nao_sec All Rights Reserved.
Downloader
• Change Check Avs
95
Copyright©2019 nao_sec All Rights Reserved.
Downloader
• Hardcode unique URLs(“//”) and Parameters
• Several parameters were added
• id=078BFBFF000406F1564309220&group=0&class=6
• It has PDB information
• C:¥Users¥Frank¥Documents¥Visual Studio 2010
¥Projects¥avenger¥Release¥avenger.pdb
96
Copyright©2019 nao_sec All Rights Reserved.
Downloader
• Download dummy bmp
• It contains Chinese notepad.exe named winlogon.exe
• %appdata%¥ ¥Microsoft¥Internet Explorer
• The implant exe is encoded
97
Copyright©2019 nao_sec All Rights Reserved.
Summary
• exe using RLO
• T1036
• Targeted advanced decoy files
• Binary padding
• T1009
• exe implant to image file
• They prefer Windows default wallpaper
• Use original downloader and rat
• ABK Downloader
• Datper
114
Copyright©2019 nao_sec All Rights Reserved.
Summary
115
Copyright©2019 nao_sec All Rights Reserved.
Summary
• Services and methods used for Hunting
• VirusTotal
• Private API
• Yara (Live & Retro Hunt)
• Hybrid Analysis
• Yara (Retro Hunt)
• ATT&CK Tactic & Technique
• ANY.RUN
• ATT&CK Technique
• Suricata SID
• Actors TTPs found from public sources
• TA544
• Gorgon Group
• OceanLotus
• TA505
• Tick
116