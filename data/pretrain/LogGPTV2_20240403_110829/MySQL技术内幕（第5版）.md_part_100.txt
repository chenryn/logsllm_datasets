或组名的 mysql替换掉。例如，你可能会因为在系统里没有专门的管理权限，而以自己的账户
418
在决定使用哪一个登录账户来运行MySQL之后，关于如何启动服务器还有多种选择。你可
尤可以像下面那样关闭“组”和“其他”权限，从而将该目录下的所有内容都设置为只有mysql
这一点，可以修改其权限，只允许mysql用户访问它。如果数据目录为/usr/local/mysql/data，
目录及其内容的所有权：
一
统里使用RPM软件包来安装MySQL，安装过程会自动创建这个账户。MacOSX系统内部自
如果你决定使用名为 mysql的账户来运行服务器，可能就不需要自己创建。如果在Linux
安装MySQL。在这种情况下，你还会以自己的身份来运行服务器，因此你应该用自己的登录
确保该用户一直被指定的最好方法是：将其列在服务器会读取的某个选项文件里。例如，
_在完成前面几个步骤之后，请记得在启动服务器时带上--user=mysql 选项，这样以 root
（3）如有必要，可以使用系统的常规账户创建步骤来为你选择的那个用户名创建登录账户。
口直接调用myeqld。这大概是最不常用的方法。本书不会对它再做过多讨论。只是想说，
如果碰巧在启动服务器时是以 mysql 身份登录的，那么当选项文件中存在有user 行时，
更多与选项文件有关的信息请参考12.2.3节。
最后两步实际上是更为全面的锁定过程的一部分，详细内容请参考13.1.2节。通过查看该
user=mysql
#chmod-Rgo-rwx/usr/local/mysql/data
(5）一种很好的安全预防措施是：将数据目录的访问模式设置为其他人都不可访问。为做到
这些命令需要以root身份来运行。
#chown-Rmysql
（4）修
-个创建好的 mysql账户。其他系统可能也是同样的情况。
[mysqld]
使用的用户和组名都是 mysql。如果想要使用不同的名字，可以将本书中所有作为用户名
(2）选择用于运行 mysqld 的登录账户。
%mysqladmin -p-uroot shutdown
（1）停止正在运行的服务器：
chgrp -R mysql
第12章MySQL的基本管理
所用。例如，
改MySQL数据目录及其下面所有子目录和文件的用户和组的所有权，让它们归
/usr/local/mysql/data
/usr/local/mysql/data
，如果数据目录为/usr/local/mysql/data，就可以像下面这样设置该
。你也可以指定一个专用于MySQL的组名。在本书
这意味着，服务器没有能力更改其用户
---
## Page 439
下的运行级目录里。如果运行的是Linux，并且是通过RPM包来安装MySQL的，那么操作到
里来启动服务器：
专门用于启动本地安装的各种服务。在基于rc的系统里,可以把下面几行内容添加到rc.local
件的名字通常是以rc 作为开头，并且很可能会有一个名为rc.local（或类似的名字）的文件，
步骤。
的操作系统的类型。请仔细阅读下面的示例，使用或调整与你的系统启动过程最为接近的指毕
说明
server 脚本。例如，LinuxRPM和Mac OSX DMG软件包便是这么做的。）
要将其复制到正确的运行级目录里，使其变得可执行。（有些安装方法会替你安装好mysql.
mysql.server 脚本可以在 support_files 目录里找到。要想使用mysql.server，你可能需
对于 BSD 风格的系统，在/etc目录里通常会有几个在启动时初始化服务的文件。这些文
如果你系统上的 mysqld_safe 路径名与此不同，则需要修改相应行。
if[-x/usr/local/bin/mysqld_safe];then
为让启动脚本在系统开机时可以执行，需要做一些安排，安排的具体内容取决于你所使月
fi
脚本 mysqld_safe和 mysqld_multi都安装在MySQL 安装目录的bin 目录里，
品
口调用mysqld_safe脚本。mysqld_safe脚本会为你调用服务器，然后监视它；当服务器意
/usr/local/bin/mysqld_safe&
脚本，
容是什么。如果你使用了其他供应商提供的MySQLRPM，那么它可能也会安装类似的启动
书仍将继续使用mysql.server 这个名字来进行讨论，以便能够清楚地表明本书所指的内
通常情况下，
对其进行详细讨论。
行控制，或者检查它是否正在运行。这个启动脚本比其他脚本复杂，因此本书将在12.9节
器列出启动参数的那个选项文件。有了它之后，你便可以对每一个服务器的启动或停止进
要想协调多个服务器，可以使用mysqld_multi脚本。这个脚本会读取你在其中为多个服务
出那个运行级时会调用的各个脚本。
的系统里使用。其中，每个目录都对应于某个特定的运行级，并且包含有当计算机进人或退
mysqld_safe包装了一下，并且常在采用System V方法将启动和停止脚本分散在多个目录
用此脚本时，可以用参数start或stop来表明是要启动服务器，还是要停止它。它只是将
调用mysql.server脚本。mysql.server脚本会通过执行mysqld_safe来启动服务器。
志文件，并重新调用 mysqld_safe。
何与导致问题出现的原因有关的有用信息！如果出现了这样的问题，
个问题，是因为在你想要通过检查出错日志来弄清问题出在哪里时，
mysqld_safe 试图写入出错日志文件时，会因“权限不足”而失败。它之所以会成为-
账户所有。在不同的时间使用不同的--user 值会引起麻烦。问题的具体表现是：
那么 mysqld_safe 脚本会设置该文件的所有权，使其归--user 选项所指定的那个登录
某个文件，产生一个出错日志；或者重定向到 syslog。如果将错误输出发送给文件，
mysqld_safe 脚本会将服务器的出错信息和其他诊断输出内容重定向到数据目录下的
系统和Mac OS X系统里，也可以通过mysql.server来调用它。
外中断时，还会重启它。
mysqld--verbose--help
面这条命令有助于找出服务器都支持哪些启动选项：
只是名字不一样而已(如使用mysqld)。
你会将 mysql.server 脚本以 mysql 这个名字安装到运行级目录下，但是本
。mysqld_safe脚本通常被用在BSD风格的Unix版本里，在非BSD
12.2安排MySQL服务器的启动和关闭
，则需要删除出错
无法在其中找到
419
而
用
调
录
---
## Page 440
条命令：
12.2.2.1在Windows里手动运行服务器
需要调试功能，则可以选择 mysqld，因为 mysql-debug 会占用更多的内存，运行速度更慢。
为 mysql-debug 的服务器，它与 mysqld 很像，不同之处在于它带有调试支持功能。如果你不
的各个示例中所使用的服务器名字均为mysqld。你手上的 MySQL发行版很可能还包含一个名
中的一个目录里。
面这几条命令：
到启动目录里。
mysql.server 脚本。下面的指导将展示如何将 mysql.server 脚本以 mysql 这个名字安装
12.2.2
Linux系统通常都有一个用于启动脚本管理的chkconfig命令，你可以用它来帮助你安装
目录的。例如，许多Linux的变体在/etc/init.d和/etc/rc.d下面都有一个目录集。这
将对它的链接放置到相应的运行级目录里。
此结束。否则，还需要在启动脚本主目录安装这个脚本(其名字可以自定)，确保其可执行，并
420
要想从命令行手动启动服务器，需要把当前位置改成服务器的安装目录，然后输入下面这
着随操作系统一同启动的那些服务所对应的子目录。MySQL官方网站为MacOSX系统提供
针对Windows的MySQL发行版包含有多种服务器程序，各自的构建选项都不相同。本书
在 Windows 系统里，可以通过命令行手动启动 MySQL服务器。还可以为 MySQL 创建一
运行级目录的布局因系统之间的差异而有所不同，因此必须检查你的系统是如何组织这些
Windows版本服务器提供的两种连接类型是Unix版本服务器里没有的。
在MacOSX里，目录/Library/StartupItems和/System/Library/StartupItems里
如果没有chkconfig，可以使用手动过程。
其输出表明该脚本程序会自动以2、3、4和5这几个运行级别自动执行。
#chkconfig --list mysql
(3）要想验证该脚本是否已正确启用，可以在运行chkconfig时带上--list选项：
（1）把mysql.server 脚本从当前位置复制到 init.d目录里，并使其可执行：
D
mysql
（2）注册脚本，并启用它：
与启用这些连接类型有关的更多信息请参考12.2.4节。
1共享内存连接。如果服务器在启动时带有--shared-memory选项，就使用此连接。
命名管道连接。如果服务器在启动时带有--named-pipe选项，就使用此连接。
1n-s/etc/init.d/mysql s99mysql
cd /etc/rc.d/rc3.d
chkconfig mysql on
chkconfig --add mysql
chmod +x /etc/init.d/mysql
cp mysql.server /etc/init.d/mysql
在Windows里运行MySQL服务器
第12章MySQL的基本管理
。
1:off
2:on
，要想使脚本以级别3的方式运行，可以使用下
3:on
4:on
5:on
6:off
包
类
---
## Page 441
service_name不为 MySQL时，会读取[service_name]组。
启动都会使用它。服务器只会从该文件里读取选项。默认读取的用户组为[mysqla]；当
用默认服务名，可以把service_name的值指定为MySQL。服务器会记住这个文件名，并且每次
file 选项，作为最后选项（要在同一行内输入命令）：
选项文件里读取哪些选项组产生影响。
因在于，可以把多个MySQL服务器作为Windows服务来运行。服务名会对服务器在启动时从
详见接下来的讨论。在创建多个MySQL服务时，这种做法尤其有用（参考12.9节)。
而只能将它们列在选项文件里（参考12.2.3节）。不过，可以把服务名和选项文件指定为参数，
运行。如果你希望创建的服务不会自动运行，那么可以把MySQL服务器安装为“手动”服务：
地方，则需要对这条命令里的路径名做出相应的修改。
12.2.2.2以Windows服务的方式运行服务器
--instal1选项的后面显式地指定一个服务名：
这是正常的。要想运行客户端程序，只需要另外打开一个控制台窗口即可。
指定其他的选项。
err 文件)，可以使用--console选项：
虽然可以在服务名的后面加上一个与--defaults-file 不同的选项，但是--defaults-
如此一来，又多出了一种提供服务器相关选项的方式。这个语法要求指定服务名。要想使
当为MySQL 创建Windows 服务时，其默认的服务名为MySQL（不区分大小写）。也可以在
服务创建命令本身实际上并不启动mysqld，它只是让mysqld在Windows 每次启动时自动
这条命令使用了 My SQL服务器程序的完整路径名。如果你的 My SQL服务器安装在其他
如果通过命令行来启动服务器，那么只有等到服务器退出时才能看到下一个命令提示符。
C:\> "C:\Program Files\MySQL\MySQL Server 5.5\bin\mysqld
在创建 MySQL 服务时，如果指定了服务名，那么还可以在命令行指定一个--defaults-
口如果既没有给出service_name参数，也没有使用服务名MySQL，那么服务器将使用默认服
每一个 Windows 服务都必须有一个唯一的名字，因此选择一个不同于 MySQL 的服务名的原
C:\>"C:\Program Files\MySQL\MySQL Server 5.5\bin\mysqld"--instal1 service_name
一般来说，当为MySQL服务器创建Windows服务时，不能在命令行里指定其他的选项，
C:\>"C:\Program Files\MysQL\MysQL Server 5.5\bin\mysqld"--instal1-manual
C:\> "C:\Program Files\MySQL\MySQL Server 5.5\bin\mysqld"--instal1
C:\>mysqladmin -p-uroot shutdown
要想停止服务器，可以使用mysqladmin：
在Windows系统里，可以用下面的命令为MySQL创建一个Windows服务：
当以控制台模式运行服务器时，可以在命令行的--console选项之后，或者选项文件里，
口女
C:\>mysqld --console
要想让出错信息进入控制台窗口，而不是进入出错日志（默认为数据目录里的HOSTNAME.
可以在命令行或选项文件里指定其他选项请参考12.2.3节。
C:\>mysqld
项文件里读取选项组[mysqld]和[service_name]。
如果service_name参数不同于MySQL，服务器会把这个名字作为服务名，并且会从标准选
务名（即MySQL），并且会从标准选项文件里读取[mysqld]选项组。
12.2安排MySQL服务器的启动和关闭
421
---
## Page 442
12.2.2.2节。）
除以Windows 服务形式存在的服务器，就无法指定启动选项。（有关例外情况的讨论请参考
例外情况，如果在命令行使用--install、--install-manual或者--remove来安装或移
在命令行列出选项的方式不起作用，因为它只支持参数 start 和 stop。此外，还存在几种
有在手动启动服务器时，或者通过mysqld-safe启动时才会起作用。对于mysql.server，
使用的是哪一种启动方法，在服务器每次启动时它们都能生效。在命令行上列出的选项，只
以查找选项，只是命令行的选项具有更高的优先级。
12.2.3指定服务器启动选项
务
命令：
说明
要在服务列表里选择其条目，然后选择相关的按钮或菜单项。
是否在运行，是以自动方式运行，还是以手动方式运行）。要想启动或停止MySQL服务器，需
Windows版本的不同而有所差异。
行来完成。如果你喜欢图形界面，也可通过Windows服务管理器来完成。服务管理器的位置因
息请参考12.2.3节。
file 选项更为灵活，因为你可以将你所需的选项全部放置在文件里。更多与选项文件有关的信
422
服务器查找选项文件的具体位置取决于MySQL的版本（参考F.2.2节）。但是，Unix系统
通常情况下，最简单的方法是使用选项文件，因为对于采用这种方式指定的选项，不管
要想从服务列表里删除MySQL服务器，得先停止它（如果它正在运行），然后调用下面的
也可以在命令行使用mysqladmin shutdown 来停止My SQL服务器。
在服务器以服务方式安装好之后，你便可以利用服务名来控制它。这个操作可以通过命令
这两种选项指定方法不会相互排斥。服务器无论是在选项文件里，还是在命令行里，都可
有关选项文件的格式和语法，以及服务器在何处可以找到它们的一般性讨论，请参考F2.2节。
口将选项列在选项文件里。当采用这种方式指定选项时，需要每行指定一个。只能使用
口在命令行上列出各个选项。在这种情况下，对于所有提供了长、短格式的选项，既可以使用
在任何一个平台里，都有两种主要的指定启动选项的方法，用于调用MySQL服务器。
C:\>mysqld --remove service_name
可以在--remove 选项的后面指定其名字：
C:\>mysqld--remove
如果你使用服务管理器，那么它会提供一个窗口，显示服务列表和附加信息（如每个服务
这
C:\> net start MySQL
要想从命令行启动或停止服务，可以使用下面的命令：
?
长格式，也可以使用短格式。例如，既可以使用--user=mysql，也可以使用-u mysql。
这条命令将删除默认服务名为MySQL的那个MySQL服务。要想显式地表明删除哪一个服
方法。在从命令行调用服务相关的命令之前，要先关闭服务管理器。
虽然使用服务管理器或者在命令行调用命令都可以控制服务，但是应该避免交错使用这两种
user=mysql
长选项形式，并且前面不能带有短横线：
>net stop MySQL
[mysqld]
第12章MySQL的基本管理，
---
## Page 443
12.2.4
service-startup-timeout 的值。
读取的那些选项组产生影响。更多详细信息请参考12.2.2.2节。