ğ‘ğ‘“ ,ğ‘¡ â‰¥ ğ‘ ğ‘“
ğ‘¡âˆˆğ‘Œâˆ—,ğ‘
âˆ€ğ‘“ :
ğ‘’
ğ‘“
ğ‘“
. For the slack variable Î”ğ‘§,ğ‘
ğ‘’
than ğ‘“ â€™s allocated bandwidth ğ‘ ğ‘“ with Constraint (1); the sum of the
bandwidth of all tunnels on a given IP link ğ‘’ should be no larger
than the link capacity ğ‘ğ‘’ with Constraint (2); and the allocated
bandwidth of flow ğ‘“ should be less than the demand of ğ‘“ with Con-
straint (3). Constraint (4) considers Arrowâ€™s restorable tunnels by
ensuring the sum of the bandwidth of both residual and restorable
tunnels for flow ğ‘“ under failure scenario ğ‘ is larger than ğ‘“ â€™s allo-
cated bandwidth ğ‘ ğ‘“ . Constraint (5) considers Arrowâ€™s restorable
links and ensures the sum of the bandwidth of all restorable tunnels
routed on link ğ‘’ does not exceed ğ‘’â€™s bandwidth capacity with a
slack variables Î”ğ‘§,ğ‘
for link ğ‘’ under
ğ‘’
scenario ğ‘ and LotteryTicket ğ‘§, we also set a bound ğ‘€ğ‘§,ğ‘ for the
sum of Î”ğ‘§,ğ‘
to ensure the total slack is within a reasonable region
ğ‘’
in Constraint (6).
Phase I output. To select the winning LotteryTicket without
solving an ILP, Phase I outputs a floating-point slack variable Î”ğ‘§,ğ‘
ğ‘’
that allows the bandwidth allocation of restorable tunnels on IP
link ğ‘’ to go beyond the linkâ€™s restorable capacity ğ‘Ÿğ‘§,ğ‘
. After solving
ğ‘’
Arrowâ€™s Phase I formulation, we run a post-processing step to find
ğ‘’ + Î”ğ‘§,ğ‘
the winning LotteryTickets. This is done by comparing ğ‘Ÿğ‘§,ğ‘
with all LotteryTickets. Then, for each failure scenario ğ‘, we select
).5 ğ‘âˆ— is
a set of size |ğ‘„| that contains the winning LotteryTickets for each
failure scenario ğ‘ âˆˆ ğ‘„. Arrow maps the restoration plan ğ‘âˆ— into
wavelengthsâ€™ reconfiguration rules and installs them on ROADM
config files.
Phase II input parameters. As shown in Table 3, Phase IIâ€™s input
parameters include the winning LotteryTicketâ€™s restorable band-
width capacity (denoted by ğ‘Ÿâˆ—,ğ‘
) and restorable tunnels (denoted
by ğ‘Œâˆ—,ğ‘
). These parameters are calculated from Arrowâ€™s Phase I
post-processing step.
Phase II optimization goal and constraints. Phase II uses the
same optimization goal (maximizing total network throughput) as
Phase I. Moreover, the Constraints (7-9) of Phase II are the same
as Constraints (1-3) in Phase I. However, Constraints (10-11) use
the LotteryTicket ğ‘§ with the minimumğ‘’âˆˆğ¸ ğ‘šğ‘ğ‘¥(0, Î”ğ‘§,ğ‘
ğ‘’
ğ‘’
ğ‘’
ğ‘“
4In our evaluations, we experiment with ğ›¼= 0.2, 0.1, and 0.05.
5This technique is similar to the ReLU function commonly used in machine learning.
ğ‘“
ğ‘’
and ğ‘Œâˆ—,ğ‘
of the winning LotteryTickets (selected by Phase
the ğ‘Ÿâˆ—,ğ‘
I) for each failure scenario ğ‘.
Phase II output. The output of the Phase II consists of two parts:
(1) the total bandwidth ğ‘ ğ‘“ that flow ğ‘“ is permitted to utilize (across
all of its tunnels in ğ‘‡ğ‘“ ); and (2) the allocation of ğ‘ ğ‘“ over flow ğ‘“ â€™s
tunnels ğ‘‡ğ‘“ , denoted by ğ‘ğ‘“ ,ğ‘¡. Arrow periodically computes the opti-
mal values of bandwidth allocations, based on the current demand
matrix. Similar to prior TE schemes, after each TE run, Arrow finds
the traffic splitting ratio for flow ğ‘“ among its tunnels, calculated
ğ‘ğ‘“ ,ğ‘¡. These traffic splitting ratios are then
as ğœ” ğ‘“ ,ğ‘¡ = ğ‘ğ‘“ ,ğ‘¡/ğ‘¡ âˆˆğ‘‡ğ‘“
installed on routers [53].6
Probabilistic optimality guarantee. Our goal is to find the opti-
mal restoration plan ğ‘§ğ‘œğ‘ğ‘¡ while maximizing throughput. However,
as discussed in Â§3.1, simply formulating a joint IP/optical formula-
tion is not scalable. As a result, Arrow relies on the LotteryTickets
abstraction. However, given that the input LotteryTicket set ğ‘ is
generated by randomized rounding, Arrowâ€™s optimality depends
on whether the optimal restoration plan appears in LotteryTickets
set ğ‘. Consequently, Arrow has a probabilistic optimality guar-
antee that depends on the probability of selecting ğ‘§ğ‘œğ‘ğ‘¡ during its
randomized rounding process. Note that we do not provide a de-
terministic optimality guarantee, hence, Arrowâ€™s solution can be
sub-optimal. We leave finding a restoration-aware TE formulation,
with a practical runtime and a deterministic optimality guarantee,
to future work.
Theorem 3.1 (Arrow Probabilistic Optimality). An Arrow
TE with |ğ‘ğ‘| LotteryTickets finds the optimal allocation under failure
scenario ğ‘ with probability
ğœŒğ‘ = 1 âˆ’ (1 âˆ’ ğœ…)|ğ‘ ğ‘|

(12)
where ğœ… is the probability of finding the optimal LotteryTicket ğ‘§ğ‘œğ‘ğ‘¡
for scenario ğ‘. This probability can be calculated as
Ã— Pr{ğ‘Ÿğ‘œğ‘¢ğ‘›ğ‘‘ ğ‘¢ğ‘/ğ‘‘ğ‘œğ‘¤ğ‘›}
(13)
where 1 â‰¤ ğ‘’ â‰¤ ğ‘› is the index of the failed IP link under scenario ğ‘
(as defined in line 4 of Algorithm 1), and Pr{round up/down} is the
probability of rounding up or down to determine each failed IP linkâ€™s
restoration option (as defined in lines 6â€“11 of Algorithm 1).
1â‰¤ğ‘’â‰¤ğ‘›
ğœ… =
1
ğ›¿
Please see Appendix A.3 for proof.
4 NOISE LOADING IN ARROW
For decades, wavelength reconfiguration in large-scale WANs has
been deemed slow and complicated, even with ROADMs being
already deployed. This is because newly reconfigured wavelengths
change the power distribution over the fiber spectrum. Hence, the
cascaded optical amplifiers along the fiber path need to adjust ac-
cordingly. This process introduces a non-trivial challenge to adjust
amplifier gain configurations to equalize wavelength power/Signal-
to-Noise Ratio (SNR) with repetitive observe-analyze-act loops
which take a few minutes per amplifier to converge (Appendix A.7).
This problem is commonly referred to as wavelength channel equal-
ization and has been studied extensively in the optics commu-
nity [7, 8, 16, 51, 55, 62, 67, 92]. Recent work used machine learning
6To avoid division by zero when the denominator is zero, in our code, we change the
tunnels with ğ‘ğ‘“ ,ğ‘¡ = 0 to ğ‘ğ‘“ ,ğ‘¡ = ğœ–, where ğœ– is a small number (i.e., 10âˆ’4).
Figure 9: Arrowâ€™s noise loading in action.
to shorten this amplifier reconfiguration delay [90], but it requires
a simulation-based firewall to ensure the parameters are safe to
deploy on live production networks.
Noise loading enables agile wavelength reconfigurations. Ar-
row bypasses the amplifier reconfiguration latency by leverag-
ing a technology called â€œnoise loadingâ€ in modern optical back-
bones [33, 35, 83]. A programmable optical noise generation device,
called the Amplified Spontaneous Emission (ASE) device [83], gen-
erates an optical noise signal for all unused wavelengths on all fibers.
As a result, from the amplifierâ€™s perspective, all wavelengths are
present at all times. Although all wavelength channels are turned
up in all fibers, some wavelengths carry noise generated by the
ASE device, and some carry IP layer data generated by routers.
Noise loading example. Consider the WAN depicted in Fig. 9.
Assume all fibers can carry eight wavelengths in total.7 In healthy
state, two of Fiber1â€™s available frequencies, ğœ†1 and ğœ†2, are connected
to router ports and carry data while the other six frequencies, ğœ†3
to ğœ†8, are loaded with noise (Fig. 9(a)). Fiber2 has four wavelengths
carrying data (ğœ†3, ğœ†4, ğœ†5, and ğœ†6), while the other frequencies (ğœ†1,
ğœ†2, ğœ†7, and ğœ†8) are carrying noise (Fig. 9(b)). Now, assume Fiber1
is cut, causing wavelengths ğœ†1 and ğœ†2 to fail. Arrow reconfigures
these two wavelengths onto Fiber2â€™s ğœ†1 and ğœ†2 slots, which are
initially loaded with noise, by configuring ROADM A and B, as
well as their noise sources (Fig. 9(d)).8 All of this is hidden from the
amplifiers on both fibers because replacing noise with data is per-
formed locally on the ROADMs (Appendix A.6). As a result, Arrow
circumvents amplifier reconfiguration latency because amplifiers
will no longer experience power changes as the total number of
powered up spectrum frequencies (i.e., eight frequencies) is the
same the entire time.
5 PRODUCTION-LEVEL TESTBED
Setup. To faithfully evaluate Arrow in a real-world setting, we
select a subset of Facebookâ€™s global WAN and separate it from pro-
duction for experimental purposes. Fig. 10 shows our testbed setup
with four ROADMs, 34 amplifiers, and over 2,160 km unidirectional
fiber. In our testbed, all hardware devices and software (control,
monitoring, failure detection and management, etc.) are identical
7In practice, todayâ€™s fibers can carry 48-96 wavelengths in the C-band range depending
on channel frequency spacing [28, 38].
8Here, reconfiguring to ğœ†1 and ğœ†2 does not need frequency tuning. If ğœ†1 and ğœ†2 on
fiber 2 are already carrying data, Arrow tunes the frequency of ğœ†1 and ğœ†2 to ğœ†7 and
ğœ†8 to avoid colliding with wavelengths carrying data.
BfailureFiber2Fiber1APower(b) Fiber2in healthy stateğœ†1 ğœ†2ğœ†3 ğœ†4 ğœ†5 ğœ†6ğœ†7ğœ†8noisePower(a) Fiber1in healthy stateğœ†1 ğœ†2ğœ†3 ğœ†4 ğœ†5 ğœ†6 ğœ†7ğœ†8Power(d) Fiber2after reconfiguration ğœ†1 ğœ†2 ğœ†3 ğœ†4 ğœ†5 ğœ†6ğœ†7ğœ†8noisePower(c) Fiber1 is cutğœ†1 ğœ†2 ğœ†3 ğœ†4 ğœ†5 ğœ†6 ğœ†7ğœ†8noisenoisenoiseROADMROADMAmplifierdatadatadataNoise sourceNoise sourceFigure 10: Arrowâ€™s production-level testbed. (a) Testbed topology emulating an optical backbone connecting 4 cites in North
America. (b) Physical topology of the testbed. (c) Photo of the testbed.
Figure 11: Restoring 2.8 Tbps of lost IP capacity with Arrow.
Figure 12: Arrowâ€™s restoration latency.
to Facebookâ€™s global WAN. This testbed demonstrates that Arrow
can be readily deployed.
A fiber cut restoration trial. Fig. 11 shows an end-to-end exper-
iment for a fiber cut restoration trial. Fig. 11(a) shows the network
in healthy state. The top topology represents the IP-layer, and the
bottom one represents optical fibers and devices (same layout as
Fig. 10(b)). The color of each IP link matches its underlying fiber
path. There are 16 wavelengths (each wavelength occupies 75 GHz
spectrum frequency width modulated at 200 Gbps bandwidth ca-
pacity) grouped into 4 port-channels to support 4 IP links: Aâ†”B
(0.4 Tbps), Aâ†”C (1.2 Tbps), Bâ†”D (1.2 Tbps), and Câ†”D (0.4 Tbps).
Fig. 11(b) shows the state of the network after fiber CD is cut. This
fiber was carrying 14 wavelengths (ğœ†3-ğœ†16) and its cut caused 3 IP
links, Aâ†”C, Bâ†”D, Câ†”D, to fail. To restore the IP-layer capacity,
Arrow reconfigures the wavelengths as shown in Fig. 11(c).
Quantifying the restoration latency. Fig. 12 compares the restora-
tion latency of Arrow with the state-of-the-art method [73]. We
first use the current amplifier reconfiguration approach in Face-
book to reconfigure the wavelengths (the same failure scenario as
in Fig. 11). Figs. 12(a) and (b) show the normalized IP layer capacity
and optical power measured on fiber AB; as the figure shows, it
requires 1,021 seconds (â‰ˆ17 mins) to restore 2.8 Tbps. We then use
Arrowâ€™s noise loading device to bypass the amplifier reconfigura-
tion latency. Figs. 12(c) and (d) show the entire restoration latency
is eight seconds; i.e., 127Ã— faster than the state-of-the-art method.
We believe this latency can be further reduced to milliseconds with
more advanced hardware, as shown in prior work [22]. Moreover,
Arrowâ€™s reconfiguration does not affect existing wavelengths (ğœ†1
and ğœ†2) running on the fiber AB, as shown in Fig. 12(d).
Other factors affecting the latency. Two other factors affect
Arrowâ€™s restoration latency in practice: 1) wavelength tuning (if
there is a frequency collision on the surrogate fiber path); 2) modu-
lation change (if the length of the surrogate fiber path increases).
Note that these two steps are optional, as appropriate, and can be
adjusted in parallel with ROADM reconfiguration because they af-
fect the transponders only. Prior work has demonstrated frequency
tuning [10, 29] and modulation change [76, 77] in milliseconds.
6 LARGE-SCALE SIMULATIONS
We use simulations to quantify the performance gains of Arrow.
Our simulation framework is implemented with the Julia program-
ming language [15] and the Gurobi solver [66]. Our code is available
online.9 We compare Arrow to the following schemes:
â€¢ FFC [63]. FFC is a failure-aware TE formulation that guarantees
zero loss for up to ğ‘˜ IP-link failure scenarios. We extend FFC to
the optical layer by considering scenarios with ğ‘˜ fiber cuts, and
evaluate both ğ‘˜ = 1 and ğ‘˜ = 2 cases and refer to them as FFC-1 and
FFC-2, respectively.
â€¢ TeaVaR [17]. TeaVaR is also a failure-aware TE formulation but
instead of absolute guarantees, it provides a probabilistic guarantee
depending on the failure probability of fibers. In our simulations,
we set TeaVaRâ€™s availability target (ğ›½) at 99.9%.
â€¢ ECMP [21]. ECMP is not a failure-aware TE and serves as a
baseline in our evaluations. It does not consider failure scenarios,
hence it does not provide any guarantees with respect to failures;
it simply assigns equal amount of traffic to all tunnels of each flow.
9http://arrow.csail.mit.edu
(b)360 km140 km200 km200 km180 kmAmplifier site (EDFA)TransponderROADM siteOptical Transponders2160 km long-haul single-mode fibers(c)Site D ROADM(a)Site DSite BSite A Site CSite C ROADMSite B ROADMSite A ROADMAmplifierDBA CAmplifier(a) Healthy networkOptical layer viewIP layer  viewRouter BRouter ARouter DRouter CÎ»1 â€“Î»2Î»3â€“Î»8Î»9 â€“Î»14Î»15â€“Î»16BADC(b) Network under fiber cut Optical layer viewIP layer  viewBADC(c) Restored networkADCBOptical layer viewIP layer  viewÎ»1 â€“Î»2Î»1 â€“Î»2Î»3â€“Î»8Î»9 â€“Î»14Î»15â€“Î»16Router BRouter ARouter DRouter CRouter BRouter ARouter DRouter C00.250.50.751Wavelength power (dBm)-20-100101021 secondsTime (seconds)(b) State-of-the-art: Optical PowerTime (seconds)Normalized IP capacity(a) State-of-the-art: IP Link Capacity0                   360                720              10800            360           720         10800                 20                 40                60Wavelength  power (dBm)Time (seconds)00.250.50.7518 secondsNormalized IP capacityTime (seconds)(d) ARROW: Optical Power(c) ARROW: IP Link Capacity-20-10010ğœ†1-ğœ†2ğœ†3-ğœ†8ğœ†9-ğœ†14ğœ†15-ğœ†16A-B linkA-C linkB-D linkC-D link0                 20                 40                 60Figure 13: Availability vs. demand scales for Arrow and state-of-the-art failure-aware TE schemes.
# Fibers
# IP links
# Traffic matrices
Availability Arrow-Naive
99.999%
99.99%
99.9%
99%
Arrowâ€™s gain in terms of satisfied demand
TeaVaR
2.3Ã—
1.6Ã—
2.4Ã—
2.0Ã—
2.0Ã—
2.3Ã—
1.8Ã—
1.9Ã—
FFC-1
2.2Ã—
2.2Ã—
2.0Ã—
1.5Ã—