    Connection: close 
    IOS: 3361ba9ec3480bcd3766e07cf6b4068a 
    Accept: */* 
    User-Agent: %D9%81%D8%A7%D9%84%D9%88%D8%A6%D8%B1%20%D8%A8%DA%AF%D9%8A%D8%B1%20%D8%A7%DB%8C%D9%86%D8%B3%D8%AA%D8%A7%DA%AF%D8%B1%D8%A7%D9%85/35 CFNetwork/893.14.2 Darwin/17.3.0 
    Accept-Language: en-gb 
    Accept-Encoding: gzip, deflate 
    Content-Length: 0
如果版本不是最新版本，则应用程序会将用户重定向到andromedaa商店：
该商店包含最新版本的应用程序并且具有验证开发人员证书的过程。商店也允许开发人员在任何时间点更新证书信任和应用程序。
#### Ozvbegir（ozvdarozv）应用
Ozvbegir应用程序的目的是增加用户电报频道的成员数量。 这个程序保证用户只会来自伊朗。
我们分析了Android版本的应用程序。 申请包由自签名证书签署，该证书有效期至3014年。
同一应用程序的早期版本也使用了自签名证书，但发行者和主题信息都显然是错误的。
就像之前的应用程序一样，Ozvbegir应用程序被重新打包，其中包含了Telegram应用程序中的原始类。
实际上，我们在清单中发现了最初Telegram包的标志，但是该包被更改为适应应用程序代码。清单上使用的名称和标签引用了Telegram原始应用程序，甚至用于Android
Maps应用程序的API密钥也保持不变。
就像之前的应用程序一样，这个应用程序也通过对ndrm.ir域执行HTTP请求来检查新版本。
如果应用程序不是最新版本，它将同时收到消息和链接以获取最新版本，而该版本是经过攻击者自行设置的。
在这种情况下，它来自一个伊朗的Android应用程序商店--`cafebazaar.ir`。
ndrm.ir域与其他地址一同在同一个  
电子邮件处注册。然而这个唯一的伊朗托管的产品恰好是能够在移动设备上升级应用程序。
该应用程序的外观非常类似于原始Telegram应用程序。
就像最初的Telegram应用程序一样，用户需要在他们第一次打开应用程序时提供他们的电话号码以便在Telegram中注册。
此注册为同一设备创建一个影子会话，使应用程序可以访问完整的联系人列表和消息。
当注册过程结束时，应用程序会联系后端服务器，并提供有关用户和移动设备的信息。
    GET /users/ping.php?access_hash=[redacted]&inactive=0&flags=1107&last_name=%21%21empty%21%21&phone=[redacted]&tg_id=[redacted]&m=d&user_name=[redacted]&first_name=Pr2&network=SYMA&country=[redacted]&apk=570&imei=[redacted]&brand=motorola&api=24&version=7.0&model=Moto+G+%285%29&tut=[redacted] HTTP/1.1 
    TOKEN: ab1ccf8fd77606dda6bb5ecc858faae1 
    NUM: df27340104277f1e73142224d9cb59e8 
    HEADER: bt6 
    ADMIN: web 
    Host: v1.ozvdarozv.com 
    Connection: close 
    User-Agent: Apache-HttpClient/4.5.1 (java 1.4)
我们在Telegram频道上确定了超过100万用户，这些用户在首次打开应用程序时会自动加入应用。
与以前的开发人员不同，Bitgram_dev没有大肆进攻互联网。目前，它在Google Play上有两个已发布的应用程序--AseGram和BitGram。
而相关下载大约进行了10000次。
鉴于AseGram和BitGram的目的在于规避伊朗对电报的禁令，因此有理由认为出版商隐藏自己的足迹。
### 应用样例
#### AseGram应用
AseGram应用程序适用于某些国家、地区的Google Play商店。 即使从Google
Play商店下载此类应用，签署该软件包的证书在安全方面也是完全无用的。
Telegram应用程序被成功克隆以便拦截来自用户的所有通信。但是这个方法与常规方法有所不同：该软件使用Telegram包层定义的代理来拦截流量。
就像以前的应用程序一样，AseGram是对Android合法电报的重新打包。
这种技术减少了开发人员在开发自己的Telegram客户端时可能遇到的bug问题。
服务org.pouyadr.Service.MyService在启动时将调用原始Telegram包中的`MessagesController.getGlobalMainSettings（）`，并将更改设置以包含代理配置。
配置信息被硬编码到恶意软件中，并使用AES加密，密钥源自特定软件包的中的硬编码值。
该应用程序涉及三个域：talagram.ir，hotgram.ir和harsobh.com，这些域都在伊朗公司注册。
在这种情况下，应用程序管理员可以访问通信。
此应用程序所创建的服务只能在设备启动时启动并且只能通过手动关闭应用程序来禁用。 该服务包含安装新软件包所需的代码，但该操作由系统中的标准软件包管理器处理。
该服务还负责联系位于伊朗的IP地址。 实际上，这些使用Telegram克隆的后端称为“Advanced Telegram”或（Golden
Telegram）。 这个应用程序可以在cafebazaa.ir上获得，这是一家伊朗国家批准的Android应用程序商店。
重要的是要强调本页的第一句——“اینبرنامهدرچارچوبقوانینکشورفعالیتمیکند”（“该计划在该国法律的框架内运作”）。
我们很难找到一个合法的用例，这些应用程序为了规避禁令而联系其国家的审查克隆服务器，这些通信消息高度可疑。
该应用程序还使用了位于多个国家、地区的socks服务器代码，这些代码被用于规避禁令。 然而，在我们的研究中，我们从未见过这些代码被使用过。
另一方面，如果物理设备不在伊朗，那么我们却看到了流量发送到位于该国的服务器。这些操作似乎在试图组织伊朗电报程序的兼容。
#### 虚假网站
获得用户电报帐户访问权限的最简单方法是对用户进行社交工程，将用户名和密码输入由攻击者控制的欺诈性网站。 我们观察了域名youtubee-videos [.]
com，它模仿了Telegram的Web登录页面。
此域名在2017年7月25日注册。基于战略，技术和程序（TTP），例如域名注册模式，电子邮件地址 - nami.rosoki@gmail [.] com
-被用于注册此域名。而其他域及其域名服务器（pDNS）记录表明该域名与Charming Kitten组相关联。
这个域名与另一家网络安全公司Clearsky联系在一起。
在进一步检查网页源代码后，我们发现网站似乎是使用名为“Webogram”的GitHub项目构建的，源页面中还有字符串表示该网站的显示是为iPhone设计的。
在Talos正在研究“迷人小猫”攻击者使用的欺骗性电报网站过程中，我们发现了许多恶意域名，其中包含“移动”，“信使”等关键字，在某些情况下还包含“环聊”，这可能是一个名为Hangouts的Google聊天应用程序。
这表明这些参与者一直对获取到用户的移动设备感兴趣，特别是他们的聊天消息。
这些域也使用与2017年相同的Modus操作数进行注册。通过分析pDNS记录，Talos发现了其内容被解析为相同IP地址。
这清楚地表明，该组正在进行一项活动，于是我们需要重点关注用户凭据和消息传递应用程序。
### BGP路由异常、
#### 背景
在监控思科的边界网关协议（BGP）公告数据库BGPStream时，Talos注意到一些源自伊朗自治系统号（ASN）58224的路由异常。对于那些不熟悉此协议的人，BGP在Request
for Comments（RFC）中定义 为4271，作为“一种自治系统路由协议”。 在此上下文中，“路由被定义为目标路径属性配对的信息单元”
简而言之，该协议允许在请求位于所请求的网络或自治系统之外的资源时发生互联网通信。
在互联网上使用BGP来协助选择最佳路径路由。 而这可以在ISP级别进行操作，是否选择如此操作具体取决于各种因素，BGP允许路由选择。
BGP通过语音系统优化互联网流量的路由，RFC 4271将其定义为：
BGP语音系统的主要功能是与其他BGP系统交换网络可达性信息。 该网络可达性信息包括关于可达性自治系统（AS）列表的信息。
这些语音系统充当路由器向邻近系统发送“更新消息”的平台。
“更改路由属性的过程是通过通告替换路由来完成的。替换路由携带新的[已更改]属性，并且具有与原始路由相同的地址前缀。”
虽然这是为了解决网络问题而设计的，但它没有添加足够的安全机制来防止滥用的情况。
除了某些方法（如MD5密码，IPSec或GTSM）之外，BGP不提供安全机制。 这些都不是默认要求，因此不会被广泛使用。
但是这可以允许某人发送具有相同前缀或AS的备用路由的更新消息，即使与主路由没有关系。
这可能产生一些通过受害者的预定或次优路线。 这些路由偏差有时被称为BGP劫持会话。
BGP劫持会话的有效性是根据通过消息接收更新的BGP对等方的数量来衡量的。 接收更新消息的用户越多，通过次优路径路由的流量就可以为行为者预先配置。
#### 来自ASN 58224的预先计划路由活动
一个BGP路由异常发生在2018年6月30日07:41:28 UTC。 在此次活动中，总部位于伊朗的ASN
58224宣布更新前缀185.112.156.0/22。 而伊朗电信提供商伊朗电信公司PJS发送了更新消息的ASN。
这次劫持活动与匈牙利的互联网服务提供商（ISP）DoclerWeb
Kft有关。9个BGPmon检测机制检测到此事件。而这个事件持续了2小时15分钟，直到消息被更新。虽然此事件的规模非常小，但这可能是针对更大的BGP劫持尝试的试运行。
有更多的BGP异常来自伊朗的ASN