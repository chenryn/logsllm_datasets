业 证券行业应用安全架构设计实践
专
刊
首先讲一下本机构的网络区域划分：有互联网接入区DMZ、核心 ●…移动APP
生产网、办公网、开发测试网、业务网，其他还有托管机房区、外 ●…Web页面
联业务区、客户接入区、AWS等。 ●…Restful…API
●…管理页面入口
下面进行攻击面分析。基于部署架构图，简单画了数据流图。 ●…业务人员访问入口
… ●…DUBBO微服务间调用接口
●…敏感数据
●…数据存储，如数据库、redis
●…第三方系统调用
这么多的攻击面，如何识别威胁及消减风险，我们主要靠安全专家
经验、长期积累而形成的安全威胁库。我们并没有严格的区分安全
需求及威胁建模，这个过程我们称之为安全需求分析与架构设计，
也就是轻量级威胁建模。根据业务场景，与安全威胁库中威胁模式
可以看出，外部实体，有通过互联网APP及Web访问的外部客户， 匹配，输出安全解决方案。
也有业务人员，还有IT运维人员，以及日志平台及第三方系统。
针对本案例的金融APP的安全设计，选择部分进行详细描述。
数据流图目的，主要是为了进行攻击面分析。
1）结构安全。
首先是系统分层，系统应该采用分层部署的结构，不同的组件按功
能和重要程度分布于不同的网络区域中。
生产环境中，需要与外网（互联网）发生通信的主机，一般位于
DMZ层，禁用在生产网的核心层与外网直接通信。应用部署在
核心网，需要在DMZ部署接入层服务，禁止直接DMZ区部署
nginx反向代理接入。从安全风险角度，Web服务部署于DMZ区，
… 在DMZ区进行http协议卸载、参数过滤及协议转换，DMZ到核
从图中，可以分析出系统主要攻击面有： 心网使用tcp协议，这样，可以防止攻击payload直接打到核心网。
204 205
行
业 证券行业应用安全架构设计实践
专
刊
运营管理后台，业务运营人员采用专用的业务终端通过业务网进行 c) APP第三方代码安全。移动应用开发过程中，出于功能需求等
访问。IT人员通过堡垒机进行系统运维。后台管理页面禁止直接 原因，开发人员不可避免会集成一些其他第三方提供的代码，
开放到办公网访问（因为办公网可以访问互联网，员工存在被网络 如SDK。这些第三方代码未经测试和评估就直接嵌入到应用中
钓鱼导致机器被远控风险，从而通过后台管理页面漏洞侵入核心 直接使用，容易出现不可预料的后果。一方面是第三方代码的
网）。 安全性未经测试，可能存在安全漏洞被攻击者利用，从而威胁
整个应用的正常使用。另一方面，第三方代码额外实现了冗余
系统使用的第三方组件如tomcat，应采用无安全漏洞版本。部署 功能或者申请多余的特权，可能造成用户隐私信息泄露，或者
系统所采用的软件也应该满足安全性，版权合法且无安全漏洞。 一系列恶意行为。
2）移动安全。 对于此类威胁，安全设计方案是：集成第三方代码时，开发人
a) APP代码保护。基于目前市面上提供了很多或开源或商业的逆 员应尽可能了解第三方代码的功能，以及尽可能保证第三方代
向分析工具，如apktool，dex2jar，baksmali等，因此攻击者 码的安全性。需要在下载、集成、评估、更新升级四个阶段都
很容易就可以获得应用的反编译代码，几乎就是应用源代码。 注意安全，实现必要的安全措施：从官网安全下载和使用；对
在此基础上，进一步分析应用中存在的安全漏洞以及业务逻辑， 代码进行漏洞扫描，漏洞包括有常见Android应用漏洞，例如
并进而攻击服务端。为了提高逆向分析的门槛，可以进行代码 组件暴露、webview漏洞等；代码审计，检查第三方代码是否
混淆、dex加壳、so加壳等方式对代码进行保护。 实现多余功能或申请过多权限，审计是否有恶意代码、敏感数
据收集及传输等；升级和更新，一方面是漏洞的应急响应，对
b) APP运行时保护。对移动端应用的逆向分析还有动态调试。动 于已公布的安全漏洞有及时的响应；另一方面，更新时候需要
态调试分为Java层和native层动态调试，通过动态调试，跟踪 重新检测第三方代码新版本的安全性。
应用运行行为，猜测业务逻辑；同时，通过动态调试还可以伪
造或篡改请求/响应包，从而攻击服务器端。可以在代码中加 d) APP端业务安全。为了防止APP用户恶意注册及薅羊毛等恶
入动态调试检测来进行反调试，如调试器进程名检测、ptrace 意行为，可以在APP中加入设备指纹，进行数据埋点等，将
检测、xposed…hook框架检测等。 APP数据接入业务风控平台，进行业务反欺诈。
可以采用加固工具对Android…APP进行加固保护，防止恶意破 3）Web安全。
解、反编译、二次打包等。国内有很多提供APP加固服务厂商， 对于Web安全，关注常见的OWASP…TOP…10漏洞，如注入、身
需要注意的是，加固会造成性能的损失，严重情况下可能造成 份认证、敏感信息泄露、安全配置错误等。常见的防御措施有认证、
应用崩溃，因此需要做好兼容性和健壮性测试。 授权、加密、审计、输入验证等。
206 207
行
业 证券行业应用安全架构设计实践
专
刊
由于篇幅关系，就不做展开了。对所有攻击面进行威胁库匹配，最
终形成的就是该产品完整的安全解决方案。在实际实施过程中，业
务也会在实现安全功能的投入和安全风险间进行权衡，并不一定会
实现所有的安全设计方案。
06 平台化赋能
如今，越来越多的企业开始采用DevOps开发模式，实现价值的快
速交付，也催生出来DevSecOps理念，本机构也很早就探索并落
地DevSecOps实践。在DevSecOps中，如何实现安全架构设计
的快速交付？
4）Restful API安全。 通过自研三叉戟SDL全流程赋能平台，自动化实现基于场景的轻
Restful…API以URI方式对外提供数据服务或功能服务。外部用户 量级威胁建模。
多数情况下是程序或系统。提供的数据服务或功能服务多数情况 …
下，是非公开的，即需要对HTTP请求来源和身份做识别与认证，
再经过授权决策（访问控制）后，提供相应的数据或执行功能。
实现思路为项目组自主进行安全调查问卷的填写，平台基于调查问
推荐的安全设计参考有： 卷的业务场景，匹配安全威胁库，关联安全需求库，自动化输出安
●…互联网上暴露Restful…API(或HTTP服务接口）时，应该加密 全设计方案。安全人员负责安全威胁库及安全需求库等的完善。
（如HTTPS）；
●…采用appid、appkey或jwt等方式，来标识访问者身份；
●…非公开Restful…API服务，必须在每个端点上做认证和访问控制；
●…对接口使用情况进行监控，完整记录接口访问日志；
●…对接口调用进行流量控制，控制规则包括最大允许应用程序接
口调用并发数等，控制措施包括告警、暂停、拒绝等。
其他还要考虑的领域还有数据安全、个人隐私评估、大数据安全等，
208 209
行
业
专
刊
未来，可以借助人工智能及NLP等技术，实现自适应的智能化威
胁建模。
07 总结 证券行业安全日志的几个应用场景
本文介绍了如何进行安全架构设计，以及轻量级威胁建模实践，通
华福证券 张生
过安全左移，从源头管控安全风险，降低漏洞修复成本。行业机构
可以参考本文的实践，进行自身的安全架构设计探索和落地。
过去的问题
基于安全日志的产品在2008年时兴起SOC类安全集中管理，从海
量的安全告警日志中提取，分析对网络安全工作有价值的信息，并
快速归类处理告警事件。
自2017年国家出台《网络安全法》，明确要求“采取监测、记录网
络运行状态、网络安全事件的技术措施，并按照规定留存相关的网
络日志不少于六个月”。进一步为安全日志集中收集提供法律依据。
作者介绍 SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN 未来的问题
安全设备日渐增多，安全日志将成指数级增加，在未来对日志分析
江旺 庄飞，某证券信息安全中心负责人。
处理要求会更高。安全日志的分析除发现已知的问题之外，我们还
应该检测未知，预测已知范围之外的事情。
SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN SEC-UN
210 211
行
业 证券行业安全日志的几个应用场景
专
刊