===> NETSTAT OPTION(*CNN)
===> NETSTAT OPTION(*CNN6)
15.Manually package your files for IBM:
• “Manually packaging information on UNIX and Linux” on page 311
• “Manually packaging information on Windows” on page 313
• “Manually packaging information on IBM i” on page 313
Related tasks
“Collecting troubleshooting information automatically with runmqras” on page 303
If you need to send IBM MQ troubleshooting information to IBM Support, you can use the runmqras
command to gather the information together into a single archive.
“Sending troubleshooting information to IBM” on page 353
After you have generated and collected troubleshooting information for a problem, you can send it to IBM
to help with problem determination for a support case.
Manually packaging information on UNIX and Linux
On UNIX and Linux, you first select a directory with enough free space to hold all the data that you need
to collect. You then add the required files to a compressed file with a name beginning with your IBM case
number.
Procedure
1.Find a directory with enough free space to hold all the IBM MQ data.
IBM MQ troubleshooting and support 311
The contents of the /var/mqm/errors and /var/mqm/trace directories typically make up most
of the IBM MQ data, so check the disk usage of those directories against the free space in your file
systems using the du (disk usage) and df (display file systems) commands. For example:
sh> du -sk /var/mqm/errors /var/mqm/trace
384 /var/mqm/errors
189496 /var/mqm/trace
sh> df -k
Filesystem 1024-blocks Free %Used Iused %Iused Mounted on
/dev/hd4 393216 256536 35% 8641 12% /
/dev/hd2 8257536 1072040 88% 70803 21% /usr
/dev/hd9var 393216 126792 68% 6694 16% /var
/dev/hd3 12582912 12441980 99% 5108 2% /tmp
/dev/hd1 1310720 162560 88% 439 2% /home
/proc - - - - - /proc
/dev/hd10opt 7208960 97180 99% 64796 65% /opt
/dev/fslv00 16777216 15405312 9% 12415 1% /var/mqm
2.In the directory you chose, create a new tar file whose name begins with your IBM case number and
add the contents of the IBM MQ errors directory to it.
For example:
sh> tar -cf /tmp/TS001234567-mqdata.tar /var/mqm/errors
3.Add the IBM MQ configuration files to the tar file. Include the mqinst.ini file only if you have
installed IBM WebSphere MQ 7.1 or later on the system:
sh> tar -uf /tmp/TS001234567-mqdata.tar /var/mqm/mqs.ini /etc/opt/mqm/mqinst.ini
4.Add the IBM MQ configuration files and error logs for your queue managers.
For example:
sh> tar -uf /tmp/TS001234567-mqdata.tar /var/mqm/qmgrs/QMA/qm.ini /var/mqm/qmgrs/QMA/errors/
*.LOG
5.Add any additional files as shown in “Collecting troubleshooting information on Multiplatforms” on
page 302 and as requested by IBM Support, including files that contain output from IBM MQ and
system commands.
For example:
sh> tar -uf /tmp/TS001234567-mqdata.tar /tmp/ps.txt /tmp/ipcs.txt /tmp/mqconfig.txt
6.If you gathered an IBM MQ trace, add the trace files last of all:
sh> tar -uf /tmp/TS001234567-mqdata.tar /var/mqm/trace
7.Compress the tar file using any available compression tool on your system.
For example:
• Using compress: creates a .tar.Z file
sh> compress /tmp/TS001234567-mqdata.tar
• Using gzip: creates a .tar.gz. file
sh> gzip /tmp/TS001234567-mqdata.tar
• Using bzip2: creates a .tar.bz2 file
sh> bzip2 /tmp/TS001234567-mqdata.tar
8.After sending your data to IBM as described in “Sending troubleshooting information to IBM” on page
353, take a back up copy of your file to keep until your case is resolved then delete the file from the
system to save space.
sh> rm /tmp/TS001234567-mqdata.*
312 Troubleshooting and Support for IBM MQ
Manually packaging information on Windows
On Windows, you first select a directory in which to package the IBM MQ files. You then add the required
files to a compressed folder with a name beginning with your IBM case number.
About this task
There are a number of third party utilities for creating archives on Windows. Feel free to use one of
these if you wish, but be sure to include the case number at the beginning of the file name, for example
TS001234567-mqdata.zip. The following instructions demonstrate how to package files using only the
capabilities of Windows.
Procedure
1.Open the Windows Explorer and navigate to a directory where you will package the IBM MQ files.
For example, if you want to do so in your personal temporary directory, you can enter %TEMP% in the
Windows Explorer location bar.
Right-click in the directory and choose New > Compressed (zipped) Folder. Include the case number
at the beginning of the file name, for example TS001234567-mqdata. Windows automatically adds
the .zip extension.
2.Open a second Windows Explorer window and use it to find the Windows directories and files you wish
to include.
Most IBM MQ files will be located under a directory identified by the "WorkPath" registry key. To
determine this directory, use the amquregn program shipped with Windows and ignore the double
backslash characters in the path it returns:
C:\Program Files\IBM\MQ\bin> amquregn amquregn.ctl | FINDSTR WorkPath
.."WorkPath"="C:\\ProgramData\\IBM\\MQ"
...."WorkPath"="C:\\ProgramData\\IBM\\MQ"
If your system consists of a new installation of IBM MQ 8.0, the WorkPath may point to a
directory under C:\ProgramData rather than C:\Program Files (x86). Windows hides the
C:\ProgramData directory by default, so you must enter %PROGRAMDATA% in the Windows
Explorer location bar to navigate to that directory. Alternatively, you can modify your personal settings
in the Control Panel so that the Windows Explorer will show hidden files.
3.Add a directory or file by dragging it on top of the new compressed folder. Start by including the
top-level IBM MQ errors directory.
4.If your system has only IBM WebSphere MQ 7.1 or later installed, drag the IBM MQ .ini files to the
compressed folder.
5.Drag the IBM MQ configuration files and error logs for your queue managers to the compressed folder.
6.Add any additional files as shown in “Collecting troubleshooting information on Multiplatforms” on
page 302 and as requested by IBM Support, including files that contain output from IBM MQ and
system commands.
7.If you gathered an IBM MQ trace, add the trace files last of all.
8.After sending your data to IBM as described in “Sending troubleshooting information to IBM” on page
353, take a back up copy of your file to keep until your case is resolved then use the Windows Explorer
to delete the file from the system to save space.
Manually packaging information on IBM i
On IBM i, you package the IBM MQ files by running commands at the IBM i command line. You need to
include your IBM case number at the beginning of each save file name.
Procedure
1.Create a save file containing the top-level IBM MQ configuration files and errors directory, which might
include IBM MQ FFST files, error logs, and JOB files:
IBM MQ troubleshooting and support 313
===> CRTSAVF FILE(QGPL/P12345A) TEXT('Top-level files for PMR 12345,67R,890')
===> SAV DEV('/QSYS.LIB/QGPL.LIB/P12345A.FILE') OBJ(('/QIBM/UserData/mqm/*.ini' *INCLUDE) ('/
QIBM/UserData/mqm/errors/*' *INCLUDE)) DTACPR(*MEDIUM)
2.Create a save file which includes the qm.ini file and error logs of any queue managers involved in the
problem.
For example:
===> CRTSAVF FILE(QGPL/P12345B) TEXT('QMB files for PMR 12345,67R,890')
===> SAV DEV('/QSYS.LIB/QGPL.LIB/P12345B.FILE') OBJ(('/QIBM/UserData/mqm/qmgrs/QMB/qm.ini'
*INCLUDE) ('/QIBM/UserData/mqm/qmgrs/QMB/errors/*' *INCLUDE))
===> CRTSAVF FILE(QGPL/P12345C) TEXT('QMC files for PMR 12345,67R,890')
===> SAV DEV('/QSYS.LIB/QGPL.LIB/P12345C.FILE') OBJ(('/QIBM/UserData/mqm/qmgrs/QMC/qm.ini'
*INCLUDE) ('/QIBM/UserData/mqm/qmgrs/QMC/errors/*' *INCLUDE))
3.Create a save file which includes the system history log:
a)First, create a data base file:
===> CRTPF FILE(QGPL/QHIST) RCDLEN(132) MAXMBRS(*NOMAX) SIZE(10000 1000 100)
b)Display the system history log for the period you want to show. For example:
===> DSPLOG PERIOD(('12:00:00' '05/16/2014') ('23:59:59' '05/30/2014')) OUTPUT(*PRINT)
c)Work with spool files to find the QPDSPLOG history log information:
===> WRKSPLF
d)Copy the history log spool file into the data base file.
For example:
===> CPYSPLF FILE(QPDSPLOG) TOFILE(QGPL/QHIST) TOMBR(HISTORY)
e)Create a save file and save the data base file to it:
===> CRTSAVF FILE(QGPL/P12345H) TEXT('History log for PMR 12345,67R,890')
===> SAVOBJ OBJ(QHIST) LIB(QGPL) DEV(*SAVF) SAVF(QGPL/P12345H)
4.Create a save file which includes the IBM MQ job logs:
a)First, create a data base file:
===> CRTPF FILE(QGPL/JOBLOGS) RCDLEN(132) MAXMBRS(*NOMAX) SIZE(10000 1000 100)
b)Work with the QMQM spool files, then press F11 twice to get the job log information (File Nbr, Job,
User, and Number, listed in that order on the screen):
===> WRKSPLF SELECT(QMQM)
c)Copy each job log into the data base file. The JOB parameter for each job log should consist of the
values Number/User/Job, while the SPLNBR parameter should contain just the File Nbr value.
For example:
===> CPYSPLF FILE(QPJOBLOG) TOFILE(QGPL/JOBLOGS) JOB(135383/QMQM/RUNMQCHL) SPLNBR(1)
===> CPYSPLF FILE(QPJOBLOG) TOFILE(QGPL/JOBLOGS) JOB(135534/QMQM/AMQZXMA0) SPLNBR(1)
...
d)Create a save file and save the data base file to it.
For example:
===> CRTSAVF FILE(QGPL/P12345J) TEXT('Job logs for PMR 12345,67R,890')
===> SAVOBJ OBJ(JOBLOGS) LIB(QGPL) DEV(*SAVF) SAVF(QGPL/P12345J)
5.Create a save file that includes the trace files, if you generated a trace:
314 Troubleshooting and Support for IBM MQ
===> CRTSAVF FILE(QGPL/P12345T) TEXT('Trace files for PMR 12345,67R,890')
===> SAV DEV('/QSYS.LIB/QGPL.LIB/P12345T.FILE') OBJ(('/QIBM/UserData/mqm/trace/*' *INCLUDE)
DTACPR(*MEDIUM)
6.Add any additional files as shown in “Collecting troubleshooting information on Multiplatforms” on
page 302 and as requested by IBM Support, including files that contain output from IBM MQ and
system commands.
===> CRTSAVF FILE(QGPL/P12345X) TEXT('Extra files for PMR 12345,67R,890')
===> SAV DEV('/QSYS.LIB/QGPL.LIB/P12345X.FILE') OBJ(('/tmp/QMA.mqsc.txt' *INCLUDE) ('/tmp/
ipcs.txt' *INCLUDE))
7.While sending your data to IBM as described in “Sending troubleshooting information to IBM” on page
353, be sure to rename the files so that they contain your full problem record number, for example
from P12345A to P12345,67R,890A.SAVF and so on. This is necessary because IBM i libraries limit
names to only ten characters, but the IBM ECuRep site needs the full PMR number to associate files
with your problem record.
8.After sending your data to IBM, take back up a copy of your save files to keep until your case is
resolved then delete the save files using WRKOBJ option 4 to save space.
===> WRKOBJ OBJ(QGPL/P12345*)
Collecting information for AMS problems
If you need assistance from IBM Support to resolve a problem with AMS on Multiplatforms, you first need
to collect troubleshooting information to send to IBM Support to help find a solution.
Before you begin
Before you start this task, answer the following questions about the problem:
• What AMS error did you observe on the system?
• What is the detailed AMS message flow?
• How is AMS implemented in your design? (client-side AMS or channel, MCA interception AMS)?
• What time did the AMS problem start and when did it stop?
• Which specific users or applications and queue manager queues are involved? The IBM MQ security
policy, keystore.conf file, and certificate keystores are important for AMS to work. Provide details on
how these files are set up.
• Provide the type and full version of the IBM MQ client.
About this task
If the AMS problem is happening right now, or if you are able to reproduce it, you can generate data to
provide more information about the problem.
After collecting the troubleshooting information, you can send it to IBM.
Procedure
Generate the troubleshooting information.
1.Generate a trace of the queue manager in which the security problem occurs.
If client-side AMS is also implemented, an IBM MQ client trace might also be needed.
• “Tracing on AIX and Linux” on page 376
• “Tracing on Windows” on page 391
• “Tracing on IBM i” on page 381
2.Display information about the AMS security policy, keystore.conf file and keystores involved.
IBM MQ troubleshooting and support 315
a)Display the AMS security policies.
Run the dspmqspl command as shown in the following example:
dspmqspl -m QMGRNAME
where QMGRNAME is the name of the queue manager in which the problem occurs.
b)Provide a detailed file listing showing the keystore.conf and the certificate keystores.
The default location for the keystore.conf file is the user's home .mqs directory. If your
keystore.conf file is located elsewhere, show this location, and explain how you are telling
IBM MQ to find the keystore.conf file.
On UNIX and Linux, use the following command:
ls -alR ~/.mqs
c)Provide the contents of the keystore.conf file.
d)Provide the full type and version of the IBM MQ client. (If Javais used, provide the Java version
details also.)
e)Provide a listing of certificates and certificate details for the AMS keystores involved.
• To list the certificates in a keystore, run the runmqakm command as shown in the following
example. The certificate labels are listed.
runmqakm -cert -list -db keystorefilename -pw keystorepassword
If the keystore is of type jks, use the runmqckm command instead of the runmqakm command.
• To show details of all certificate labels in the keystore, run the runmqakm command for each label
as shown in the following example:
runmqakm -cert -details -db keystorefilename -pw keystorepassword -label labelname
If the keystore is of type jks, use the runmqckm command instead of the runmqakm command.
Update the case and collect the troubleshooting information.
3.Update the case with your answers to the initial questions.
Place the outputs/ information from Step 1 directly in the top-level IBM MQ errors directory. Both the
runmqras automation tool and the manual collection steps below collect files found there.
4.Collect the IBM MQ troubleshooting information.
You can do this either automatically or manually.
• Collect the troubleshooting information automatically by using the runmqras command as
described in “Collecting troubleshooting information automatically with runmqras” on page 303.
Be sure to collect the runmqras defs, logger and trace sections, and to specify your case
number as shown in the following example:
runmqras -section defs,logger,trace -qmlist QMA -caseno TS123456789
• Alternatively, collect the troubleshooting information manually as described in “Collecting
troubleshooting information manually” on page 306.
Send the troubleshooting information to IBM.
5.Send the information that you have collected to IBM.
A good description of the problem and the data is the most important information you can provide to
IBM. Do not send data without providing a description!
For FTP and email instructions, see Exchanging information with IBM Software Support.
To open or update a case, go to the IBM My Support site.
Note: Always update your case to indicate that data was sent.
316 Troubleshooting and Support for IBM MQ
If you need to speak with IBM Software Support, contact your country representative. If you need to
speak with IBM Software Support in the US, you can call 1-800-IBM-SERV.
Related tasks
“Troubleshooting AMS problems” on page 67
Troubleshooting information to help you identify and resolve problems relating to Advanced Message
Security (AMS).
Collecting information for channel problems
If you need assistance from IBM Support to resolve a problem when an IBM MQ channel is reporting a
problem or failing to run on Multiplatforms, you first need to collect troubleshooting information to send
to IBM Support to help find a solution.
Before you begin
Before you start this task, answer the following questions about the problem:
• What channel problem did you observe on the system?
• What time did the channel problem start and when did it stop?
• Which queue managers, channels, remote queues and transmission queues are involved?
About this task
If the channel problem is happening right now, or if you can reproduce the problem, you can generate
data to provide more information about the problem.
After collecting the troubleshooting information, you can send it to IBM.
For more information about troubleshooting channel problems, see Troubleshooting MQ Channels.
Procedure
1.Generate a trace of the queue manager while the channel problem is happening:
• Linux and UNIX
• Windows
• IBM i
2.Generate IBM MQ trace simultaneously at the other end of the channel, whether it is a remote queue
manager, a native client application, or a JMS or Java client:
• Linux and UNIX
• Windows
• IBM i
• Java and JMS client
• z/OS CHIN trace
3.
On UNIX and Linux systems, save the output from the mqconfig command.
4.Collect the IBM MQ data.
You can do this either automatically or manually:
• Collect the data automatically by using the runmqras command as described in “Collecting
troubleshooting information automatically with runmqras” on page 303. Be sure to collect the
IBM MQ troubleshooting and support 317
runmqras defs and trace (if the issue was traced) sections, and to specify your case number as
shown in the following example:
runmqras -section defs,cluster,trace -qmlist QMA -caseno TS001234567
• Alternatively, collect the data manually as described in “Collecting troubleshooting information
manually” on page 306.
5.Send the information that you have collected to IBM.
A good description of the problem and the data is the most important information you can provide to
IBM. Do not send data without providing a description!