title:Bamboozling Certificate Authorities with BGP
author:Henry Birge-Lee and
Yixin Sun and
Anne Edmundson and
Jennifer Rexford and
Prateek Mittal
Bamboozling Certificate Authorities with BGP
Henry Birge-Lee, Yixin Sun, Anne Edmundson, Jennifer Rexford,  
and Prateek Mittal, Princeton University
https://www.usenix.org/conference/usenixsecurity18/presentation/birge-lee
This paper is included in the Proceedings of the 27th USENIX Security Symposium.August 15–17, 2018 • Baltimore, MD, USAISBN 978-1-931971-46-1Open access to the Proceedings of the 27th USENIX Security Symposium is sponsored by USENIX.Bamboozling Certiﬁcate Authorities with BGP
Henry Birge-Lee
Princeton University
Yixin Sun
Princeton University
Anne Edmundson
Princeton University
Jennifer Rexford
Princeton University
Prateek Mittal
Princeton University
Abstract
The Public Key Infrastructure (PKI) protects users from
malicious man-in-the-middle attacks by having trusted
Certiﬁcate Authorities (CAs) vouch for the domain
names of servers on the Internet through digitally signed
certiﬁcates. Ironically, the mechanism CAs use to issue
certiﬁcates is itself vulnerable to man-in-the-middle at-
tacks by network-level adversaries. Autonomous Sys-
tems (ASes) can exploit vulnerabilities in the Border
Gateway Protocol (BGP) to hijack trafﬁc destined to a
victim’s domain.
In this paper, we rigorously analyze
attacks that an adversary can use to obtain a bogus cer-
tiﬁcate. We perform the ﬁrst real-world demonstration
of BGP attacks to obtain bogus certiﬁcates from top CAs
in an ethical manner. To assess the vulnerability of the
PKI, we collect a dataset of 1.8 million certiﬁcates and
ﬁnd that an adversary would be capable of gaining a bo-
gus certiﬁcate for the vast majority of domains. Finally,
we propose and evaluate two countermeasures to secure
the PKI: 1) CAs verifying domains from multiple van-
tage points to make it harder to launch a successful at-
tack, and 2) a BGP monitoring system for CAs to detect
suspicious BGP routes and delay certiﬁcate issuance to
give network operators time to react to BGP attacks.
1
Introduction
Digital certiﬁcates serve as the foundation of trust in en-
crypted communication. When a Certiﬁcate Authority
(CA) is asked to sign a certiﬁcate, the CA must estab-
lish that the client requesting the certiﬁcate is the legit-
imate owner of the domain name in question. An ad-
versary that obtains a trusted certiﬁcate can pose as the
victim’s domain and intercept/modify sensitive HTTPS
trafﬁc like bank logins and credit card information [24].
The mechanism used by CAs to verify domain owner-
ship, known as domain control veriﬁcation, is critical
to preventing adversaries from obtaining trusted certiﬁ-
cates for domains they do not control. Domain control
veriﬁcation is performed through a standardized set of
methods including http-based and email-based veriﬁca-
tion [18].
Recently,
researchers have exposed several ﬂaws
in existing domain control veriﬁcation mechanisms.
WoSign was found issuing certiﬁcates to users that could
demonstrate control of any TCP port at a domain (in-
cluding those above 50,000) as opposed to strictly requir-
ing control of traditional mail, HTTP, and TLS ports [3].
In addition, researchers have found instances of CAs
sending domain control veriﬁcation requests to email ad-
dresses that belong to ordinary users at a domain as op-
posed to bona ﬁde administrators [1]. In response, coun-
termeasures are being developed such as standardizing
which URLs on a domain’s web server can serve to ver-
ify control of that domain [11].
While these advances can defend against some attacks,
none of them help to secure domain control veriﬁcation
against network-level adversaries, i.e., Autonomous Sys-
tem (AS), that can manipulate the Border Gateway Pro-
tocol (BGP). Such adversaries can launch active BGP hi-
jack and interception attacks to steal trafﬁc away from
victims or CAs, and spoof the domain control veriﬁca-
tion process to obtain bogus certiﬁcates.
In this paper, we ﬁrst analyze and compare BGP at-
tacks on the domain veriﬁcation process to develop a tax-
onomy and present a highly effective use of the “AS-path
poisoning” attack originally performed in [39]. Next, we
launch all the BGP attacks against our own domain and
decrypt seemingly “secure” HTTPS trafﬁc within sec-
onds. To avoid harming real users, these attacks were
done in an ethical manner on domains that resolve into
our own IP preﬁx and were registered solely for the pur-
pose of the experiments. We then quantify the vulner-
ability of domain veriﬁcation to these attacks. Finally,
we propose countermeasures against these attacks. Our
main contributions are as follows:
Active BGP Attacks on Domain Veriﬁcation Pro-
USENIX Association
27th USENIX Security Symposium    833
cess: We performed ﬁve types of real-world BGP attacks
(against a domain we owned running on an IP preﬁx
we controlled) during the domain veriﬁcation process:
1) a traditional BGP sub-preﬁx attack, 2) a traditional
BGP equally-speciﬁc-preﬁx attack (like the attack theo-
rized in [22]), 3) a prepended BGP sub-preﬁx attack, 4)
a prepended BGP equally-speciﬁc-preﬁx attack, and 5)
a BGP AS-path poisoning attack (see section 2.2 for de-
tails about these attacks).
We are the ﬁrst
to demonstrate the use of
the
prepended and AS-path poisoning attacks on the PKI,
and the ﬁrst to perform any of these attacks during the
domain veriﬁcation process in the wild. We successfully
obtained bogus certiﬁcates from all of the top ﬁve CAs
(Let’s Encrypt, GoDaddy, Comodo, Symantec, Global-
Sign) [8] in our real-world attacks. Our results were a
major factor in Let’s Encrypt’s decision to start deploy-
ing the multiple-vantage-point countermeasure [37].
Quantify vulnerability of domains: We collected a
dataset of 1.8 million certiﬁcates from Google’s Certiﬁ-
cate Transparency project logs [32] and studied the do-
mains requesting those certiﬁcates. By observing the
number of domains run out of IP preﬁxes shorter than 24
bits long (/24), we found that 72% of the domains were
vulnerable to BGP sub-preﬁx hijack attacks and BGP
AS-path poisoning attacks, which could allow any AS
to get a certiﬁcate for these domains. Furthermore, the
domains were vulnerable to BGP equally-speciﬁc-preﬁx
attacks from an average of 70% of ASes.
Countermeasures against BGP attacks: We pro-
posed and developed two countermeasures to mitigate
the threat of BGP attacks: multiple vantage point veri-
ﬁcation and a live BGP monitoring system.
• Multiple Vantage Point Veriﬁcation: We propose
to perform domain control veriﬁcation from multi-
ple locations on the Internet (vantage points) to pre-
vent localized BGP attacks. We calculate the best
locations for vantage points and quantify the result-
ing security beneﬁt.
• Live BGP Monitoring System: We design and im-
plement (in the Let’s Encrypt’s CA) a monitoring
system with a novel route age heuristic to prevent
short-lived BGP attacks [19] that can quickly lead
to a bogus certiﬁcate before the attack is noticed.
Our heuristic is designed for CAs and forces adver-
saries to keep attacks active for several hours, giving
network operators time to react.
Some of the BGP attacks were brieﬂy discussed in a
short abstract [16]. In this paper, we go further by an-
alyzing the complete attack surface of BGP attacks on
PKI and performing all the attacks in the wild — with
success. We also measure the vulnerability of the current
PKI to these attacks, and propose/evaluate two effective
countermeasures to defend against the attacks.
2 BGP Attacks on the PKI
The Public Key Infrastructure (PKI) requires that all cer-
tiﬁcates be signed by a trusted certiﬁcate authority (CA).
Browsers and any other TLS clients maintain lists of pub-
licly trusted CAs. 135 organizations were recognized as
commercial CAs (other CAs, such as the government of
France, will not accept certiﬁcate signing requests from
the general public) [20]. Any CA is capable of signing a
certiﬁcate for any domain.
Domain Control Veriﬁcation. In order to verify that
an applicant requesting a certiﬁcate has control of the do-
main in question, the CA must perform domain control
veriﬁcation through a set of methods. Each method boot-
straps trust by forcing a user to demonstrate control of an
important network resource (e.g., a website or email ad-
dress) associated with the domain. Figure 1 illustrates
the domain control veriﬁcation process with HTTP veri-
ﬁcation, which requires the user to make an agreed upon
change to the root directory of the website running at the
domain. Another commonly used method is email veri-
ﬁcation, by which an email is sent to an administrator’s
email address at the domain, requiring the administrator
to visit a randomly generated URL before continuing.
Other methods include DNS TXT veriﬁcation or meth-
ods that do not rely on communication via the Internet
(e.g., ofﬁcial letters of authorization).
Figure 1: HTTP domain control veriﬁcation.
BGP Attacks on Domain Control Veriﬁcation. The
domain control veriﬁcation process creates a vulnerabil-
ity to network-level adversaries who can fake control of
the network resources in step (5) and (6) in Figure 1. An
adversary can send a certiﬁcate signing request for a vic-
tim’s domain to a CA. When the CA veriﬁes the network
resources via an HTTP GET request in step (5), the ad-
versary can use BGP attacks to hijack/intercept the trafﬁc
to the victim’s domain such that the CA’s request will be
routed to the adversary instead. The adversary can then
answer the CA’s HTTP request in step (6) and present the
834    27th USENIX Security Symposium
USENIX Association
document required for domain control veriﬁcation.
Our key contribution in this section is to explore the
broad BGP attack surface that can be used to obtain a
bogus TLS certiﬁcate in the above process. We ﬁrst de-
velop an adversary model, and then explore ﬁve types
of BGP attacks. In particular, we propose and analyze an
advanced and stealthy AS-path poisoning attack, that can
target any trusted CA that is not on the route between the
adversary and the victim. We present an in depth analy-
sis of how the intricacies of these BGP attacks affect the
current PKI.
2.1 Adversary Model
Adversary Objectives: We consider an adversary that
aims to obtain a bogus certiﬁcate for a victim’s domain
and then decrypt sensitive TLS trafﬁc for as long as pos-
sible without being detected. Thus, the slower a defense
system detects a BGP attack, the more effective the man-
in-the-middle attack is.
Because intercepting a TLS stream can cause signiﬁ-
cant damage in a couple of hours [24], detection systems
that require manual investigation to conﬁrm that an at-
tack has occurred or systems that have a signiﬁcant delay
before detection is possible are not effective at prevent-
ing these attacks . However, the adversary is incentivized
to avoid major reachability problems (that will cause a
service interruption alerting the victim to the attack) and
highly suspicious BGP announcements that might get au-
tomatically ﬁltered or immediately trigger alerts. Given
this adversary model, we aim to assess the current degree
of vulnerability of the PKI.
Realistic Constraints on Adversary Capabilities:
An adversary must compromise an AS’s border router
or control an AS to launch the attack. Assuming the
adversarial AS and victim’s domain to be ﬁxed, several
variables are beyond the control of the adversary. The
topological relationship between the adversary, the vic-
tim, and the CA, and the benign BGP announcement for
the IP preﬁx that includes the victim’s domain are con-
sidered beyond the control of adversary.
Despite these constraints, we assume adversaries can
control exactly what BGP announcement they make and
which neighboring ASes they make this announcement
to. We also assume an adversary is capable of generat-
ing trafﬁc with a source IP address that belongs to the
victim. Studies show that a signiﬁcant portion of ASes
still allows source IP spooﬁng [2, 34] due to a lack of
ingress ﬁltering. Even a strictly ﬁltered adversary can
spoof packets by gaining control of a client in one of
these networks that allow spooﬁng and use it to spoof
packets on behalf of the adversary.
Another variable the adversary can control is which IP
address to attack. The adversary can directly target the
IP address of the victim’s domain, or the IP address of
any DNS server involved in resolving the victim’s do-
main to give a bogus DNS response to the CA. This will
cause the CA to request the veriﬁcation webpage from
the adversary as opposed to the victim.
In addition, it is possible for the adversary to attack
a CA’s IP address. The adversary can intercept the re-
sponse of the victim (or a DNS server used to resolve the
victim’s IP) to the CA, modify it to contain the document
speciﬁed by the CA (or an incorrect DNS response), and
forward it to the CA. By man-in-the-middling the re-
sponses from the victim’s domain or DNS servers, the
adversary can fool the domain control veriﬁcation pro-
cess. These additional IP addresses an adversary can at-
tack increase the attack surface.
BGP Attack Properties: For an attack to be effective,
it must have two properties: viability and stealthiness.
For a given adversary, victim, and BGP attack type, vi-
ability is a binary indication of whether the adversary is
capable of launching the attack. On the other hand, the
stealthiness of an attack is determined by several proper-
ties that we group into two categories:
1. Control-plane stealthiness: this is measured through
the properties of a BGP announcement like the IP
preﬁx announced and the AS path.
2. Data-plane stealthiness:
this is measured through
the number of ASes whose connectivity to a vic-
tim’s domain is disrupted during an attack.
2.2 Taxonomy of BGP Attacks
We present the details of the following ﬁve attacks, and
discuss the tradeoff between attack stealthiness and via-
bility for each attack:
• Traditional sub-preﬁx attack: An adversary
makes a BGP announcement originating a more-
speciﬁc IP preﬁx than the victim’s preﬁx.
• Traditional equally-speciﬁc-preﬁx attack: An ad-
versary announces an equal-length preﬁx as the vic-
tim’s preﬁx.
• Prepended sub-preﬁx attack: An adversary
claims reachability to a more-speciﬁc IP preﬁx via
a non-existent connection to the victim.
• Prepended equally-speciﬁc-preﬁx attack: An ad-
versary claims reachability to the victim’s preﬁx via
a non-existent connection.
• AS-path poisoning attack: An adversary an-
nounces a valid route to a more-speciﬁc preﬁx than
the victim’s preﬁx to intercept Internet trafﬁc en
route to the victim.
Figure 2 illustrates the effects of these BGP attacks on
Internet routing, and we summarize the unique proper-
ties and implementation details of these BGP attacks in
USENIX Association
27th USENIX Security Symposium    835