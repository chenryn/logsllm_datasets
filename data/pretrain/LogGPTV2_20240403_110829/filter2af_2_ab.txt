  * 框定几个如果存在反弹shell则 **入侵者大概率会使用的** 且 **正常情况下大概率是在ssh登陆下才会使用的** 二进制文件，如ls/cat/ip等等，如果发现这些进程的 **stdin/stdout** 和 **tty** 不一致则告警
  * 框定几个如果存在反弹shell则 **入侵者大概率会使用的** 且 **正常情况下大概率是在ssh登陆下才会使用的** 二进制文件，如ls/cat/ip等等，如果发现这些进程的 **dip/dport/sip/sport** 和 **SSH_CONNECTION** 不一致则告警
如果发现了异常，如果幸运的话， **dip/dport/sip/sport**
会告诉你一些有价值的信息，当然也可能毫毫无价值，需要自己去手动排查(如：进阶版本1的情况)。
接下来是一些例子，都是通过执行ls为例，大家可以主要观察 **stdin/out** 和 **tty_name** ，
**dip/dport/sip/sport** ， **socket_process_pid/socket_process_exe** 以及
**SSH_CONNECTION** ：
**“最简单的反弹shell(2)“的AgentSmith-HIDS Execve数据：**
    {
        "uid":"0",
        "data_type":"59",
        "run_path":"/usr/bin/ls",
        "exe":"/usr/bin/ls",
        "argv":"ls ",
        "pid":"25131",
        "ppid":"25118",
        "pgid":"25117",
        "tgid":"25131",
        "comm":"ls",
        "nodename":"test",
        "stdin":"pipe:[93621]",
        "stdout":"pipe:[93622]",
        "sessionid":"11",
        "dip":"127.0.0.1",
        "dport":"233",
        "sip":"127.0.0.1",
        "sport":"36246",
        "sa_family":"2",
        "pid_tree":"1(systemd)->1565(sshd)->16471(sshd)->16475(bash)->25086(fish)->25117(nc)->25118(bash)->25131(ls)",
        "tty_name":"pts0",
        "socket_process_pid":"25131",
        "socket_process_exe":"/usr/bin/ls",
        "SSH_CONNECTION":"192.168.165.1 64289 192.168.165.152 22",
        "LD_PRELOAD":"",
        "user":"root",
        "time":"1580122709834",
        "local_ip":"192.168.165.152",
        "hostname":"test",
        "exe_md5":"a0c32dd6d3bc4d364380e2e65fe9ac64",
        "socket_process_exe_md5":"a0c32dd6d3bc4d364380e2e65fe9ac64"
    }
**“进阶版本(1)“的AgentSmith-HIDS Execve数据：**
    {
        "uid":"0",
        "data_type":"59",
        "run_path":"/usr/bin/ls",
        "exe":"/usr/bin/ls",
        "argv":"ls ",
        "pid":"25503",
        "ppid":"25495",
        "pgid":"25494",
        "tgid":"25503",
        "comm":"ls",
        "nodename":"test",
        "stdin":"pipe:[94503]",
        "stdout":"/dev/pts/0",
        "sessionid":"11",
        "dip":"192.168.165.1",
        "dport":"64289",
        "sip":"192.168.165.152",
        "sport":"22",
        "sa_family":"1",
        "pid_tree":"1(systemd)->1565(sshd)->16471(sshd)->16475(bash)->25086(fish)->25473(bash)->25495(bash)->25503(ls)",
        "tty_name":"pts0",
        "socket_process_pid":"16471",
        "socket_process_exe":"/usr/sbin/sshd",
        "SSH_CONNECTION":"192.168.165.1 64289 192.168.165.152 22",
        "LD_PRELOAD":"",
        "user":"root",
        "time":"1580123032502",
        "local_ip":"192.168.165.152",
        "hostname":"test",
        "exe_md5":"a0c32dd6d3bc4d364380e2e65fe9ac64",
        "socket_process_exe_md5":"686cd72b4339da33bfb6fe8fb94a301f"
    }
**“进阶版本(2)“的AgentSmith-HIDS Execve数据：**
    {
        "uid":"0",
        "data_type":"59",
        "run_path":"/usr/bin/ls",
        "exe":"/usr/bin/ls",
        "argv":"ls --color=auto ",
        "pid":"24697",
        "ppid":"24676",
        "pgid":"24697",
        "tgid":"24697",
        "comm":"ls",
        "nodename":"test",
        "stdin":"/dev/pts/4",
        "stdout":"/dev/pts/4",
        "sessionid":"11",
        "dip":"127.0.0.1",
        "dport":"233",
        "sip":"127.0.0.1",
        "sport":"36150",
        "sa_family":"2",
        "pid_tree":"1(systemd)->1565(sshd)->16471(sshd)->16475(bash)->16490(fish)->24675(socat)->24676(bash)->24697(ls)",
        "tty_name":"pts4",
        "socket_process_pid":"24675",
        "socket_process_exe":"/usr/bin/socat",
        "SSH_CONNECTION":"192.168.165.1 64289 192.168.165.152 22",
        "LD_PRELOAD":"",
        "user":"root",
        "time":"1580122431825",
        "local_ip":"192.168.165.152",
        "hostname":"test",
        "exe_md5":"a0c32dd6d3bc4d364380e2e65fe9ac64",
        "socket_process_exe_md5":"f639a31fa3050bc78868d35b46390536"
    }
**“msf后门“的AgentSmith-HID Execve数据：**
    {
        "uid":"0",
        "data_type":"59",
        "run_path":"/usr/bin/ls",
        "exe":"/usr/bin/ls",
        "argv":"ls ",
        "pid":"24587",
        "ppid":"18303",
        "pgid":"18289",
        "tgid":"24587",
        "comm":"ls",
        "nodename":"test",
        "stdin":"pipe:[88900]",
        "stdout":"pipe:[88901]",
        "sessionid":"11",
        "dip":"192.168.165.152",
        "dport":"233",
        "sip":"192.168.165.152",
        "sport":"46852",
        "sa_family":"2",
        "pid_tree":"1(systemd)->1565(sshd)->16471(sshd)->16475(bash)->16490(fish)->18289(backdoor)->18303(sh)->24587(ls)",
        "tty_name":"pts0",
        "socket_process_pid":"18289",
        "socket_process_exe":"/root/backdoor",
        "SSH_CONNECTION":"192.168.165.1 64289 192.168.165.152 22",
        "LD_PRELOAD":"",
        "user":"root",
        "time":"1580122376221",
        "local_ip":"192.168.165.152",
        "hostname":"test",
        "exe_md5":"a0c32dd6d3bc4d364380e2e65fe9ac64",
        "socket_process_exe_md5":"1bc2f057dab264291f7e3117ebc2d50e"
    }
#### 10.总结
还能不能绕过呢？还是可以的，还有不少方法可以绕过。不过不必担心，今天只用到了AgentSmith-HIDS的一个Hook信息进行判断而已，还有其他的不少数据供我们从不同维度检测入侵行为，敬请期待。