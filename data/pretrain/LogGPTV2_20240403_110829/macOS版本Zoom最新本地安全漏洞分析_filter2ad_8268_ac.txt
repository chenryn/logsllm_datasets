      /System/Library/Frameworks/CoreServices.framework/Versions/A/CoreServices
ç”±äºmacOSçš„ç³»ç»Ÿå®Œæ•´æ€§ä¿æŠ¤(SIP)ï¼Œæˆ‘ä»¬ä¸èƒ½æ›¿æ¢æ‰ä»»ä½•ç³»ç»Ÿåº“ã€‚  
å› æ­¤ï¼Œå¦‚æœæƒ³å¯¹ä¸€ä¸ªåº”ç”¨ç¨‹åºä½¿ç”¨dylib
proxyingï¼Œå…ˆå†³æ¡ä»¶å°±æ˜¯ç¨‹åºå¿…é¡»ä»å®ƒè‡ªå·±çš„åŒ…æˆ–å¦ä¸€ä¸ªéSIPçš„ä½ç½®åŠ è½½ä¸€ä¸ªåº“(è€Œä¸”è¿™ä¸ªåº“å¿…é¡»æ˜¯æœªç»è¿‡â€œhardened
runtimeâ€ç¼–è¯‘çš„(é™¤éå®ƒæœ‰com.apple.security.cs.disable-library-validationè¿™ä¸€entitlement)ï¼‰ã€‚
è§‚å¯ŸZoomçš„çš„åº“ä¾èµ–ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°[@rpath](https://github.com/rpath
"@rpath")/curl64.framework/Versions/A/curl64ï¼Œé€šè¿‡å¸¦-lå‚æ•°çš„otoolå·¥å…·è§£æå‡ºå…¶è¿è¡Œè·¯å¾„ï¼ˆ[@rpath](https://github.com/rpath "@rpath")ï¼‰ï¼š
    $ otool -l /Applications/zoom.us.app/Contents/MacOS/zoom.us 
    ...
    Load command 22
              cmd LC_RPATH
          cmdsize 48
             path @executable_path/../Frameworks (offset 12)
[@executable_path](https://github.com/executable_path
"@executable_path")å°†åœ¨è¿è¡Œæ—¶è§£æä¸ºäºŒè¿›åˆ¶æ–‡ä»¶çš„è·¯å¾„ï¼Œå› æ­¤dylibå°†ä»ä»¥ä¸‹ä½ç½®åŠ è½½ï¼š/Applications/zoom.us.app/Contents/MacOS/../Frameworksï¼Œæ›´å…·ä½“ä¸€ç‚¹æ˜¯/Applications/zoom.us.app/Contents/Frameworksã€‚
é€šè¿‡Zoomçš„åº”ç”¨ç¨‹åºåŒ…ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®è®¤curlçš„å­˜åœ¨ï¼ˆä»¥åŠå…¶ä»–è®¸å¤šæ¡†æ¶å’Œåº“ï¼‰ä¸”ä»–ä»¬ä¼šåœ¨Zoomå¯åŠ¨æ—¶å…¨éƒ¨åŠ è½½ï¼š  
å¯¹äºè¿è¡Œè·¯å¾„ï¼ˆ[@rpath](https://github.com/rpath
"@rpath")ï¼‰ã€æ‰§è¡Œè·¯å¾„ï¼ˆexecutable_pathï¼‰å’Œproxy dylibçš„æ›´å¤šç»†èŠ‚ï¼Œè¯·ç§»æ­¥ä»¥ä¸‹é“¾æ¥ï¼š
[â€œDylib Hijacking on OS
Xâ€](https://www.virusbulletin.com/pdf/magazine/2015/vb201503-dylib-hijacking.pdf)
ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†Zoomçš„libssl.1.0.0.dylibï¼ˆå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åº“ï¼Œè€Œä¸æ˜¯æ¡†æ¶/åŒ…ï¼‰ä½œä¸ºä¸ºæˆ‘ä»¬è¦ä»£ç†çš„åº“ã€‚
é¦–å…ˆï¼Œé‡å‘½ååˆæ³•åº“ï¼Œä¾‹å¦‚æˆ‘ä»¬åœ¨åº“æ–‡ä»¶åå‰åŠ ä¸€ä¸ªå‰ç¼€ï¼š`_libssl.1.0.0.dylib`ã€‚
ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬å†è¿è¡ŒZoomï¼Œä¼šé€ æˆæ„æ–™ä¹‹ä¸­çš„å´©æºƒï¼Œå› ä¸ºç¼ºå°‘å¿…è¦çš„åº“ï¼ˆlibssl.1.0.0.dylibï¼‰ã€‚
    patrick$ /Applications/zoom.us.app/Contents/MacOS/zoom.us 
    dyld: Library not loaded: @rpath/libssl.1.0.0.dylib
    Referenced from: /Applications/zoom.us.app/Contents/Frameworks/curl64.framework/Versions/A/curl64
    Reason: image not found
    Abort trap: 6
è¿™å®é™…ä¸Šæ˜¯ä¸ªå¥½æ¶ˆæ¯ï¼Œå› ä¸ºè¿™æ„å‘³ç€å¦‚æœæˆ‘ä»¬å°†ä»»ä½•åä¸ºlibssl.1.0.0.dylibçš„åº“æ”¾åœ¨Zoomçš„Frameworksç›®å½•ä¸‹ï¼Œdyldå°†ä¼šï¼ˆç›²ç›®åœ°ï¼‰å°è¯•åŠ è½½å®ƒã€‚
æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡è‡ªå®šä¹‰çš„constructoråˆ›å»ºä¸€ä¸ªç®€å•çš„åº“ï¼ˆåŠ è½½åº“æ—¶å°†è‡ªåŠ¨è°ƒç”¨ï¼‰ï¼š
    1__attribute__((constructor))
     2static void constructor(void)
     3{
     4    char path[PROC_PIDPATHINFO_MAXSIZE];
     5    proc_pidpath (getpid(), path, sizeof(path)-1);
     6    
     7    NSLog(@"zoom zoom: loaded in %d: %s", getpid(), path);
     8
     9    return;
    10}
å¹¶å°†å…¶ä¿å­˜è‡³/Applications/zoom.us.app/Contents/Frameworks/libssl.1.0.0.dylibã€‚
ä¹‹åï¼Œé‡æ–°è¿è¡ŒZoomï¼š
    patrick$ /Applications/zoom.us.app/Contents/MacOS/zoom.us 
    zoom zoom: loaded in 39803: /Applications/zoom.us.app/Contents/MacOS/zoom.us
å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„åº“è¢«ZoomæˆåŠŸåŠ è½½~
ä½†ç´§æ¥ç€Zoomå°±é—ªé€€æ‰äº†ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬çš„libssl.1.0.0.dylibä¸æ˜¯ä¸€ä¸ªsslåº“ï¼Œæä¾›ä¸äº†ä»»ä½•ç¨‹åºéœ€è¦çš„åŠŸèƒ½ï¼Œæ‰€ä»¥Zoomæ— æ³•å¯åŠ¨ã€‚
ä¸å¿…æ‹…å¿ƒï¼Œè¿™æ­£æ˜¯dylib proxyingçš„ç”¨æ­¦ä¹‹åœ°ã€‚
æ¥ä¸‹æ¥ï¼Œé€šè¿‡ç®€å•çš„é“¾æ¥å™¨æŒ‡ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥å‘Šè¯‰Zoomï¼Œâ€œè™½ç„¶æˆ‘ä»¬çš„åº“æ²¡æœ‰å®ç°æ‚¨è¦æŸ¥æ‰¾çš„å¿…éœ€ï¼ˆsslï¼‰åŠŸèƒ½ï¼Œä½†æˆ‘ä»¬çŸ¥é“è°å¯ä»¥æä¾›â€ï¼Œä¹‹åå°†ZoomæŒ‡å‘åŸå§‹ï¼ˆåˆæ³•ï¼‰çš„sslåº“ï¼ˆä¹Ÿå°±æ˜¯è¢«æˆ‘ä»¬é‡å‘½åä¸º_libssl.1.0.0.dylibçš„åº“ï¼‰ã€‚
æ•´ä½“æµç¨‹å›¾å¦‚ä¸‹ï¼š  
ä¸ºäº†åˆ›å»ºæ‰€éœ€çš„é“¾æ¥å™¨æŒ‡ä»¤ï¼Œæˆ‘ä»¬åœ¨Xcodeçš„â€œ`Other Linker Flags`â€ ä¸‹æ·»åŠ -XLinker
-reexport_libraryï¼Œç„¶åæ·»åŠ ç›®æ ‡ä»£ç†åº“çš„è·¯å¾„ï¼š  
è¦å®Œæˆä»£ç†åº“çš„åˆ›å»ºï¼Œæˆ‘ä»¬è¿˜å¿…é¡»æ›´æ–°åµŒå…¥å¼é‡å¯¼å‡ºè·¯å¾„reexportï¼ˆåœ¨æˆ‘ä»¬çš„ä»£ç†dylibä¸­ï¼‰ï¼Œä»¥ä¾¿å®ƒæŒ‡å‘ï¼ˆè™½ç„¶å·²é‡å‘½åï¼‰sslåº“ã€‚Appleä¸ºæ­¤æä¾›äº†install_name_toolå·¥å…·ï¼š
    patrick$ install_name_tool -change @rpath/libssl.1.0.0.dylib /Applications/zoom.us.app/Contents/Frameworks/_libssl.1.0.0.dylib  /Applications/zoom.us.app/Contents/Frameworks/libssl.1.0.0.dylib
ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ï¼ˆé€šè¿‡otoolï¼‰ç¡®è®¤æˆ‘ä»¬çš„ä»£ç†åº“å¼•ç”¨äº†åŸå§‹çš„sslåº“ã€‚å…·ä½“æ¥è¯´å°±æ˜¯æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°åœ¨ä»£ç†dylibä¸­ï¼ˆlibssl.1.0.0.dylibï¼‰åŒ…å«ä¸€ä¸ªLC_REEXPORT_DYLIBï¼Œå®ƒæŒ‡å‘åŸå§‹çš„sslåº“ï¼ˆ_libssl.1.0.0.dylibï¼‰ï¼š
    patrick$ otool -l /Applications/zoom.us.app/Contents/Frameworks/libssl.1.0.0.dylib 
    ...
    Load command 11
              cmd LC_REEXPORT_DYLIB
          cmdsize 96
             name /Applications/zoom.us.app/Contents/Frameworks/_libssl.1.0.0.dylib
       time stamp 2 Wed Dec 31 14:00:02 1969
          current version 1.0.0
    compatibility version 1.0.0
é‡æ–°è¿è¡ŒZoomç¡®è®¤æˆ‘ä»¬çš„ä»£ç†åº“ï¼ˆå’ŒåŸå§‹sslåº“ï¼‰å‡å·²åŠ è½½ï¼Œå¹¶ä¸”Zoomå¯ä»¥æ­£å¸¸åœ°è¿è¡Œï¼ğŸ”¥  
å‘Zoomæ³¨å…¥æ¶æ„åº“ä»£ç çš„é­…åŠ›åœ¨äºå…¶ï¼ˆç”¨æˆ·æˆäºˆçš„ï¼‰å¯¹éº¦å…‹é£å’Œæ‘„åƒå¤´çš„è®¿é—®æƒé™ã€‚å°†æˆ‘ä»¬çš„æ¶æ„ç¨‹åºåº“åŠ è½½åˆ°Zoomçš„è¿›ç¨‹/åœ°å€ç©ºé—´åï¼Œ
**è¯¥åº“å°†è‡ªåŠ¨ç»§æ‰¿Zoomçš„æ‰€æœ‰è®¿é—®æƒé™** ã€‚
è¿™æ„å‘³ç€ï¼Œå¦‚æœç”¨æˆ·ä¸ºZoomæä¾›äº†å¯¹éº¦å…‹é£å’Œæ‘„åƒå¤´çš„è®¿é—®æƒé™ï¼ˆä¸€ç§å¯èƒ½çš„æƒ…å†µï¼‰ï¼Œåˆ™æˆ‘ä»¬æ³¨å…¥çš„åº“ä¹Ÿæ‹¥æœ‰è®¿é—®è¿™äº›è®¾å¤‡çš„åŒç­‰æƒé™ã€‚
å¦‚æœå°šæœªæˆäºˆZoomè®¿é—®éº¦å…‹é£æˆ–æ‘„åƒå¤´çš„æƒé™ï¼Œåˆ™æˆ‘ä»¬çš„æ¶æ„åº“åº”èƒ½å¤Ÿæ£€æµ‹åˆ°è¯¥æƒ…å†µå¹¶ä½œå‡ºååº”ï¼ˆæ‚„æ‚„å…³é—­ï¼‰ã€‚æˆ–è€…æˆ‘ä»¬å¯ä»¥ç»§ç»­å°è¯•è®¿é—®è®¾å¤‡ï¼Œå› ä¸ºè®¿é—®æç¤ºå°†â€œåˆæ³•åœ°â€ä»Zoomå‘å‡ºï¼Œå› æ­¤å¾ˆå¯èƒ½ä¼šç”±ä¸çŸ¥æƒ…çš„ç”¨æˆ·æ‰¹å‡†ã€‚
ä¸ºäº†æµ‹è¯•è¿™ç§â€œè®¿é—®æƒé™çš„ç»§æ‰¿â€ï¼Œæˆ‘å‘æ³¨å…¥çš„åº“ä¸­æ·»åŠ äº†ä¸€äº›ä»£ç ï¼Œæ¥å½•åˆ¶å‡ ç§’é’Ÿçš„ç½‘ç»œæ‘„åƒå¤´è§†é¢‘ï¼š
     1 
     2  AVCaptureDevice* device = [AVCaptureDevice defaultDeviceWithMediaType:AVMediaTypeVideo];
     3    
     4  session = [[AVCaptureSession alloc] init];
     5  output = [[AVCaptureMovieFileOutput alloc] init];
     6  
     7  AVCaptureDeviceInput *input = [AVCaptureDeviceInput deviceInputWithDevice:device 
     8                                error:nil];
     9
    10  movieFileOutput = [[AVCaptureMovieFileOutput alloc] init];
    11  
    12  [self.session addInput:input];
    13  [self.session addOutput:output];
    14  [self.session addOutput:movieFileOutput];
    15  
    16  [self.session startRunning];
    17  
    18  [movieFileOutput startRecordingToOutputFileURL:[NSURL fileURLWithPath:@"zoom.mov"] 
    19                   recordingDelegate:self];
    20  
    21  //stop recoding after 5 seconds
    22  [NSTimer scheduledTimerWithTimeInterval:5 target:self 
    23           selector:@selector(finishRecord:) userInfo:nil repeats:NO];
    24  
    25  ...
åœ¨æ­£å¸¸æƒ…å†µä¸‹æ­¤ä»£ç ä¼šè§¦å‘æ¥è‡ªmacOSçš„è­¦æŠ¥ï¼Œè¦æ±‚ç”¨æˆ·ç¡®è®¤å¯¹éº¦å…‹é£å’Œæ‘„åƒå¤´çš„è®¿é—®ã€‚ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬å°†å…¶æ³¨å…¥Zoomï¼ˆå·²ç”±ç”¨æˆ·ç¡®è®¤è®¿é—®ï¼‰æ—¶ï¼Œå°†ä¸ä¼šæ˜¾ç¤ºå…¶ä»–æç¤ºï¼Œå¹¶ä¸”æ³¨å…¥çš„ä»£ç å¯ä»¥ä»»æ„å½•åˆ¶éŸ³é¢‘å’Œè§†é¢‘ã€‚
è¿™é¡¹æµ‹è¯•æ‹ä¸‹äº†è¿™é¡¹ç ”ç©¶èƒŒåçœŸæ­£çš„ä¸»å¯¼è€…ï¼ˆç‹—å¤´ä¿å‘½ï¼‰ï¼š  
æ¶æ„è½¯ä»¶æ˜¯å¦å¯ä»¥åœ¨ä»»æ„æ—¶é—´ä½¿ç”¨Zoomæ•è·éŸ³é¢‘å’Œè§†é¢‘ï¼ˆå³ç›‘è§†ç”¨æˆ·ï¼‰ã€‚å¦‚æœå®‰è£…äº†Zoomå¹¶è¢«æˆäºˆè®¿é—®éº¦å…‹é£å’Œæ‘„åƒå¤´çš„æƒé™ï¼Œé‚£ä¹ˆç­”æ¡ˆæ˜¾è€Œæ˜“è§ï¼šå¯ä»¥ï¼åŒæ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡/usr/bin/open
-j å°†ç¨‹åºéšè—èµ·æ¥ã€‚
## æ€»ç»“
æˆ‘ä»¬å‘ç°äº†ä¸¤ä¸ªå½±å“Zoomï¼ˆmacOSç‰ˆæœ¬ï¼‰æœ¬åœ°å®‰å…¨çš„æ¼æ´ã€‚é‰´äºZoomä¸€ç›´ä»¥æ¥åœ¨éšç§å’Œå®‰å…¨æ–¹é¢çš„ä¸è‰¯è¡¨ç°ï¼Œè¿™ä¹Ÿæ˜¯åœ¨æˆ‘ä»¬çš„æ„æ–™ä¹‹ä¸­ã€‚
é¦–å…ˆï¼Œæˆ‘ä»¬å±•ç¤ºäº†æ— ç‰¹æƒæ”»å‡»è€…æˆ–æ¶æ„è½¯ä»¶å¦‚ä½•åˆ©ç”¨Zoomçš„å®‰è£…å™¨è·å–rootæƒé™ã€‚
ä¹‹åï¼Œç”±äºç‰¹æ®Šçš„entitlementï¼Œæˆ‘ä»¬æˆåŠŸå±•ç¤ºäº†å¦‚ä½•å°†æ¶æ„åº“æ³¨å…¥åˆ°Zoomçš„å—ä¿¡ä»»è¿›ç¨‹ä¸Šä¸‹æ–‡ä¸­ã€‚è¿™ä½¿å¾—æ¶æ„è½¯ä»¶èƒ½å¤Ÿè®°å½•æ‰€æœ‰Zoomä¼šè®®ï¼Œç”šè‡³æ˜¯åœ¨åå°å¯åŠ¨Zoomçš„æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿåœ¨ä»»æ„æ—¶é—´è®¿é—®ç”¨æˆ·çš„éº¦å…‹é£å’Œç½‘ç»œæ‘„åƒå¤´ï¼ğŸ˜±
å‰è€…çš„é—®é¢˜åœ¨äºè®¸å¤šä¼ä¸šï¼ˆç°åœ¨ï¼‰ä½¿ç”¨Zoomæ¥ï¼ˆå¯èƒ½ï¼‰è¿›è¡Œæ•æ„Ÿçš„å•†åŠ¡ä¼šè®®ï¼Œè€Œåè€…çš„é—®é¢˜åœ¨äºå³ä½¿æ²¡æœ‰macOSè­¦æŠ¥æˆ–æç¤ºï¼Œæ¶æ„è½¯ä»¶ä»ç„¶å¯ä»¥ç§˜å¯†åœ°è®¿é—®éº¦å…‹é£æˆ–ç½‘ç»œæ‘„åƒå¤´ã€‚  
###  è§£å†³æ–¹æ³•
è€å®è¯´ï¼Œå¦‚æœæ‚¨å…³å¿ƒè‡ªå·±çš„å®‰å…¨æˆ–éšç§ï¼Œå¯ä»¥è€ƒè™‘åœæ­¢ä½¿ç”¨Zoomã€‚å¦‚æœå¿…é¡»ä½¿ç”¨Zoomï¼Œå¯ä»¥ä½¿ç”¨æˆ‘ç¼–å†™çš„ä¸€äº›å…è´¹å·¥å…·æ¥å¸®åŠ©æ£€æµ‹è¿™äº›æ”»å‡»ã€‚ğŸ˜‡
é¦–å…ˆï¼Œ [OverSight](https://objective-see.com/products/oversight.html)å¯ä»¥åœ¨ä»»ä½•äººä»»ä½•æ—¶é—´è®¿é—®æ‚¨çš„éº¦å…‹é£å’Œæ‘„åƒå¤´æ—¶æé†’æ‚¨ï¼š  
å› æ­¤ï¼Œå³ä½¿æ”»å‡»è€…æˆ–æ¶æ„è½¯ä»¶åœ¨åå°è¿è¡ŒZoomï¼ŒOverSightä¹Ÿä¼šç”Ÿæˆè­¦æŠ¥ã€‚
å¦ä¸€ä¸ªï¼ˆå…è´¹ï¼‰å·¥å…·æ˜¯ [KnockKnock](https://objective-see.com/products/knockknock.html)ï¼Œå¯ä»¥æ£€æµ‹ä»£ç†åº“ï¼š