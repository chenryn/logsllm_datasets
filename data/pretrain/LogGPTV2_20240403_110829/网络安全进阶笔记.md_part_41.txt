做他想做的任何事，比如打开珍藏的网友照片，然后将它永久删除。
现在网络上流行的木马基本上都采用的是C/S结构（客户端/服务端）。你要使用木马控制对
方的电脑，首先需要在对方的电脑中种植并运行服务端程序，然后运行本地电脑中的客户端程
序，对对方电脑进行连接，进而控制对方的电脑。此外，“木马”程序会想尽一切办法隐藏自
己。下面就是木马潜伏的一些途径，了解这些方法后，就可以进行有针对的防范：
·伪装在普通文件中，这个方法现在很流行，普通操作者很容易上当。常见的方法是把
183
---
## Page 193
网络安全进阶笔记
可执行文件伪装成图片或文本，然后把图标改成Windows的默认图片图标，再把文件
名改为*jpgexe，不注意的人一点这个图标就中木马了。
隐藏在配置文件中。利用配置文件的特殊作用，木马很容易就能在人们的计算机中运
行、发作，从而偷窥或者监视。
集成到程序中。为了不让用户能轻易地把它删除，木马常常集成到程序里，一旦用户
激活木马程序，由于木马文件和某一应用程序捆绑在一起，即可上传到服务端覆盖原
文件，因此即使木马被删除了，只要运行捆绑了本马的应用程序，木马又会被安装上
去了。若绑定到某一应用程序中，如绑定到系统文件，那么每次Windows启动均会
启动木马。
潜伏在Win.ini、System.ini、Winstart.bat等文件中。木马要想达到控制或者监视计算
机的目的，必须要运行，然而没有人会傻到自已在自已的计算机中运行这个该死的木
马。当然，木马也早有心理准备，知道人类是高智商的动物，不会帮助它工作的，因
此它必须找一个既安全又能在系统启动时自动运行的地方，于是潜伏在Win.ini、
System.ini、Winstart.bat等系统文件中。
内置到注册表中。由于注册表比较复杂，木马常常喜欢藏在这里，我们可以检查一下
[HKEY_LOCAL_MACHINESoftware'MicrosoffiWindowsCurrentVersion]下所有以“run
开头的键fl：[HKEY_CURRENT_USERSoftware\MicrosofWindowsiCurentVersion]下所
有以“nn”开头的键值：[HKEY-USERSLDefaulSoftwareMicrosoff(Windows)CurrentVersion]
下所有以“run”开头的键值。
绑在启动文件和超级连接中。即应用程序的启动配置文件，控制端利用这些文件能
启动程序的特点，将制作好的带有木马启动命令的同名文件上传到服务端覆盖该同名
文件，这样就可以达到启动木马的目的了。另外，木马的主人也会在网页上放置恶意
代码，引诱用户点击，用户点击的结果不言面喻，等于开门拇盗。
通过上面方法若发现自己的计算机中了木马，那怎么办？当然要将木马删除了。首先要将
网络断开，以排除来自网络的影响，再选择相应的方法来删除它。比较常用的方法是使用木马
的客户端程序进行删除。由先前在注册表或其他配置文件中找到的可疑文件名判断木马的名字
和版本，比如“netbus”、“netspy”、“冰河”等，端口号可由“netstat-a”命令查出来。很
显然对应的木马就是NETBUS、NETSPY、冰河。从网上找到其相应的客户端程序，下载并运
行该程序，在客户程序对应位置填入本地计算机地址，如127.0.0.1和端口号，就可以与木马程
序建立连接，再由客户端的卸除木马服务器的功能来卸除木马，这是最容易，相对来说也比较
彻底载除木马的方法。
不过，如果木马文件名改了名字，就无法通过这些特征来判断到底是什么木马。如果木马
被设置了密码，既使客户端程序可以连接得上，没有密码也登录不进本地计算机。目前木马病
毒数量众多，据说已经达到了5位数，面且新木马及其变种还在源源不断地出现，如果根据木
马针对的领域划分，我们可以把常出现的木马分成5大类，即网游类木马、广告类木马、通讯
类木马、后门类木马、网银类木马，从危害范围来看，网游木马危害最为严重，其次是广告木
马，也包含恶作剧程序，再次是即时通讯木马，接下来危害也比较大的是后门木马病毒，排在
最后的是网银木马。有了这样一个划分，我们就可以有的放矢地进行防范和清除了。
（1）网游类木马
如今国内网络游戏玩家众多，网上虚拟装备交易火爆，于是大批针对网络游戏的木马病毒
184
---
## Page 194
三
第4章拒绝惠意代码与神秘的黑客
涌现。这些木马盗窃网游的账号、密码及游戏装备，发送给它的主人，供木马使用者出售获利。
其中危害最大的有传奇男孩、剑侠南灵、蜜蜂大盗。
①传奇男孩（Troj.MirBoy）.传奇男孩是针对传奇游戏的木马病毒，专门偷取用户的传奇
账户与密码，发送到黑客指定的邮箱中，如今针对传奇游戏的木马病毒很多，而且不断出现新
变种。这类木马刚开始偷账号，现在已经发展到能阻止杀毒软件的运行，传奇男孩就是其中的
典型代表。该病毒侵入用户电脑后，会将自身拷贝到系统目录，然后在注册表中修改键值，以
使系统启动时自动加载：它还会终止系统中各类反病毒软件，如天网防火墙、ZoneAlanm等。
②蜜蜂大盗（Win32.Troj.MiFeng70）。该木马愉窃以下软件的密码：QQ、传奇、奇迹、千
年、红月、倚天、决战、大话西游、石器时代、遗忘传说、DVAQ，并将密码发到指定信箱。
木马运行后硬盘会疯狂运作，监听UDP2222端口，监视杀毒软件木马克星、瑞星。
戏的木马病毒也随之而生，剑侠离灵就是这类木马中的代表，该木马在网络中通过各种途径传
播，窃取剑网玩家的账号与密码，造成用户的隐私泄漏及系统的不稳定。本马感染系统后，会
监视系统中剑网客户端的运行，记录玩家的账号及密码，并发送给指定的E-mail地址。
（2）广告类木马
此类木马通常修改IE等网页浏览器的主页，收集系统信息发送给传播该木马的网站，其
中更恶毒者会修改网页定向，导致一些正常的网站不能登录。
(3）即时通讯类木马
此类木马利用即时通讯工具如QQ、MSN进行传播。中毒后，电脑会下载病毒作者指定的
任意程序，其危害不可确定，可导致用户的经济损失，有的还会制造恶作剧，中毒者向联系人
发送“我今天要结婚”的恶作剧消息。此类本马中危害最大的有QQ猎者、记事本离灵等。
①QQ猎者（Troj.QQmsg）.该木马会偷取传奇等游戏的密码，发送到指定的信箱中，
还可以关闭某些防毒软件和网镖等防火墙，中了该木马后，IE主页将被修改。
②记事本幽灵（Win32.TrojAxela.w）。该病毒通过QQ聊天软件，自动向用户的好友发
送含有病毒网址的消息，病毒网页上有一个Flash文件，一旦你打开该网页就会自动下载病
毒程序。
（4）后门类木马
此类木马采用了反弹端口技术，防火墙对它们也不起作用。首先来看看什么是反弹技术。
该技术解决了传统的远程控制软件不能访间装有防火墙和控制局域网内部的远程计算机的
难题。
反弹端口型软件的原理是，客户端首先登录到FTP服务器，编辑在木马软件中预先设置的
主页空间上面的一个文件，并打开端口监听，等待服务端的连接，服务端定期用HTTP协议读
取这个文件的内容，当发现是客户端让自已开始连接时，就主动连接，如此就可完成连接工作。
因此在互联网上可以访问到局域网里通过NAT（透明代理）代理上网的电脑，并且可以穿过防火
墙。与传统的远程控制软件相反，反弹端口型软件的服务端会主动连接客户端，客户端的监听
命令检查白己的端口，发现的也是类似“TCPUserIP:3015ControllerIP：httpESTABLISHED”
的情况，稍微疏忽一点就会以为是自已在浏览网页，而防火墙也会同样这样认为的。于是，与
一般的软件相反，反弹端口型软件的服务端主动连接客户端，这样就可以轻易地突破防火墙的
限制。
185
---
## Page 195
网络安全进阶笔记
这样你的系统就完全暴露在黑客手中了，黑客可以对用户进行远程文件和注册表的操作，
捕获被控制电脑的屏幕，远程重启和关闭计算机，禁用系统热键和注册表编辑器。此类木马中，
比较典型的有灰鸽子。
灰鸽子（Hack.Huigezi）是一个集成多种控制方法的黑客程序，一且用户中了此病毒，就可能
被病毒种植者控制计算机，黑客会进行一系列活动，后果非常严重。灰子的特点是“三个隐
藏”一隐藏进程、隐藏服务、隐藏病毒文件。灰鸽子感染系统后，将自身注册为系统服务，
并在同一目录下生成一组隐藏的病毒文件：病毒文件名可变，但有一定规律。灰鸽子软件界面
如图4.13所示。
图4.13国产木马灰鸽子的界面
（5）网银类木马
此类木马专门攻击网上银行，采用记录键盘和系统动作的方法，盗取网银的账号和密码，
并发送到木马制作者指定的邮箱，直接导致用户的经济损失，目前国内针对网上银行的犯罪已
经开始出现。
4.2.2隐藏在“挖掘鸡”后的社会工程学秘密
踩点是主动或被动地获取信息的情报工作。如今，网络上的踩点工具很多，不过本次测试
选择的是“挖掘鸡”，这是一款简单而快速的探测工具。按照常理，首先打开“挖掘鸡”界面，
选择常见的后缓文件并设置关键词。如果一时想不到合适的关键词，可将其留空，程序会自动
选择热门关键词。然后，单击“开始”按钮，软件就开始搜索了。片刻之后，许多结果显示在
“扫描结果”标签页内。到现在为止，几乎没有任何技术性操作，很多漏洞页面就被搜索出来
了。随便挑选一个，双击其链接即可下载数据库。很短的时间内，很多类似“mdb”的数据库
文件就被下载到本地，如图4.14所示。
毫无疑问，这只是漫无目的的搜索，也是那些游在网络上的黑客们的消遣游戏。正是这
站点的数据库文件都可以十分轻松地被下载到本地。不过，有针对性的检测就更让人担忧
了.在挖掘机中，在关键字处输入“博览会”、“××大学”条件，或单击“添加后缓”按钮，
将一些最新的漏洞文件名如“/datascadata.mdb”加入到编辑器内，寻找的目标就更加精准了。
1.86
---
## Page 196
第4章拒绝恶意代码与神秘的黑客
图4.14“挖掘鸡”软件界面
耐心是守候胜利的神奇法宝，社会工程学则是打开这些法宝的神秘钥匙，在网络中，一些
黑客或网站管理员往往习惯于在网站生成特定路径，这些路径很容易被猜解。但是，由于这些
路径在网络中孤立无链接，因此很难通过搜索引直接搜索到。小巧的“挖掘鸡”正是利用这
站根目录或bbs目录下的diy.asp上传文件，网络管理员习惯使用的admin.asp 管理文件等。也
许，只要有一点点耐心，这些潜在的安全隐患都可能被挖掘出来（见图4.15）。因此，作为一个
网络管理员或普通用户，应该对这些常用的“攻击”关键词有一些了解。
Rctae
"
图4.15利用“挖握鸡”进行搜索的结果
通过查阅可以看到一些典型的关键词，例如“f6efe297f5c4f24521263601b2bab937”、“Send
OK!”、“JavaSeriptaler（document.cookie);”等，回到“扫描结果”选项卡，继续寻
187
---
## Page 197
网络安全进阶笔记
找具有安全隐患的测试目标。此外，“挖掘鸡”还提供了很多有价值的注入点，这对于网络管
理员也是大有神益的。这也在无形之中给我们启发：比较经典的关键词也许就是一颗定时炸弹。
4.2.3吹灰之力：批量破解用户名和密码
由于数据库文件是“mdb”格式，这里直接使用Access软件打开数据表。选择其中的
SMT_admin表，可以看到SMT_nick字段和SMT_password字段。初步分析，“admin”是网
站系统的登录用户，不过密码都被MD5加密了，如图4.16所示。
TIPEITSS
2051073T1,10,11.11,0.1L,1.1,0.1.1,1
AOIACEEES
号）
图4.16使用Access软件打开数据表
为了破解其密码，首先随便找几个MD5破解站点，如http:/www.md5.org.cn/。但是，没
能破解密码。多方测试之后，在www.cmd5.com站点找到了答案。进入该网站的MD5解密界
面，输入加密后的用户密码，然后单击“MD5解密”按钮，稍等片刻就获得了明文密码
“82410119”。获取管理员账号和密码后，接下来要做的就是从后台登录了。在该漏洞网站的
顶级域名后面，加上admin目录，马上就跳转到了“后台登录”界面。现在，整个网站的“系
统设置”、“企业会员”、“个人会员”、“商贸机会”、“产品管理”等栏目，全部都暴露
在我们面前，如图4.17所示。
S8B6
R
136
1-
btcC m88)
7
30
208-10-
208-
BC I28)
1009-12-4
R25,1A81
171
299-0
209
135
IFAR:
1101-11-
09H1-