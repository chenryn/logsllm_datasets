| st/help/data |                                                       |
| collector/Us |                                                       |
| erGuide/Grap |                                                       |
| hics/icon_mo |                                                       |
| reInfo.png]( |                                                       |
| media/image8 |                                                       |
| 1.png){width |                                                       |
| ="0.12708333 |                                                       |
| 333333333in" |                                                       |
| height=      |                                                       |
| "0.127083333 |                                                       |
| 33333333in"} |                                                       |
+--------------+-------------------------------------------------------+
| Parent ID    | 生成的文档的可选父ID。 输入父ID或计算为父ID的表达式。 |
|              |                                                       |
|              | 用于在同一索引中的文档之间建立父子关系。              |
+--------------+-------------------------------------------------------+
| Routing      | 生成的文档的可选自定义路由值。                        |
|              | 输入路由值或计算结果为路由值的表达式。                |
|              |                                                       |
|              | Elasticsearc                                          |
|              | h基于为文档定义的路由值将文档路由到索引中的特定分片。 |
|              | 您可以为每个文档定义自定义值。                        |
|              | 如果未定义自定义路由值，Elas                          |
|              | ticsearch将使用父ID（如果已定义）或文档ID作为路由值。 |
+--------------+-------------------------------------------------------+
| Data Charset | 要处理的数据的字符编码。                              |
+--------------+-------------------------------------------------------+
| Default      | 如果未设置s                                           |
| Operati      | dc.operation.type记录标头属性，则执行的默认CRUD操作。 |
| on ![https:/ |                                                       |
| /streamsets. |                                                       |
| com/document |                                                       |
| ation/dataco |                                                       |
| llector/late |                                                       |
| st/help/data |                                                       |
| collector/Us |                                                       |
| erGuide/Grap |                                                       |
| hics/icon_mo |                                                       |
| reInfo.png]( |                                                       |
| media/image8 |                                                       |
| 1.png){width |                                                       |
| ="0.12708333 |                                                       |
| 333333333in" |                                                       |
| height=      |                                                       |
| "0.127083333 |                                                       |
| 33333333in"} |                                                       |
+--------------+-------------------------------------------------------+
| Unsupported  | 不支持在sdc.operation                                 |
| Operation    | .type记录标头属性中定义的CRUD操作类型时要采取的操作： |
| Handling     |                                                       |
|              | •丢弃 - 丢弃记录。                                    |
|              |                                                       |
|              | •发送到错误 - 将记录发送到管道以进行错误处理。        |
|              |                                                       |
|              | •使用默认操作 - 使用默认操作将记录写入目标系统。      |
+--------------+-------------------------------------------------------+
| Additional   | 要包含在操作语句中的额外字段。 以JSON格式指定。       |
| Properties   |                                                       |
|              | 例如，您可以使用_retr                                 |
|              | y_on_conflict字段指定在发生版本冲突时重试更新的次数。 |
|              | 要指定三次重试，请包括以下内容：                      |
|              |                                                       |
|              | "\_retry_on_conflict"：3                              |
|              |                                                       |
|              | 有关更多信息，请参阅Elasticsearch文档。               |
+--------------+-------------------------------------------------------+
(3)如果启用了安全性，请在"安全"选项卡上配置以下属性：
+----------------+-----------------------------------------------------+
| **Security     | **Description**                                     |
| Property**     |                                                     |
+================+=====================================================+
| [Mode]         | 使用的身份验证方法：                                |
| (https://strea |                                                     |
| msets.com/docu | 基本 - 使用Elasticsearch用户名和密码进行身份验证。  |
| mentation/data | 为Amazon Elasticsearch                              |
| collector/late | Service之外的Elasticsearch集群选择此选项。          |
| st/help/dataco |                                                     |
| llector/UserGu | AWS Signature V4 - 使用AWS进行身份验证。 为Amazon   |
| ide/Destinatio | Elasticsearch                                       |
| ns/Elasticsear | Service中的Elasticsearch集群选择此选项。            |
| ch.html#concep |                                                     |
| t_cxd_l1z_xfb) |                                                     |
+----------------+-----------------------------------------------------+
| Security       | Elasticsearch用户名和密码。                         |
| Use            |                                                     |
| rname/Password | 使用以下语法输入用户名和密码:                       |
|                |                                                     |
|                | \:\                           |
|                |                                                     |
|                | 使用基本身份验证时可用。                            |
+----------------+-----------------------------------------------------+
| Region         | 承载Elasticsearch域的Amazon Web Services区域。      |
|                |                                                     |
|                | 使用AWS Signature V4身份验证时可用。                |
+----------------+-----------------------------------------------------+
| [Access Key    | AWS访问密钥ID。                                     |
| ID](https:     | 不使用IAM实例配置文件凭据的IAM角色时需要。          |
| //streamsets.c |                                                     |
| om/documentati | 使用AWS Signature V4身份验证时可用。                |
| on/datacollect |                                                     |
| or/latest/help |                                                     |
| /datacollector |                                                     |
| /UserGuide/Des |                                                     |
| tinations/Elas |                                                     |
| ticsearch.html |                                                     |
| #concept_cxd_l |                                                     |
| 1z_xfb__dt-AWS |                                                     |
| -Signature-V4) |                                                     |
+----------------+-----------------------------------------------------+
| [Secret Access | AWS秘密访问密钥。                                   |
| Key](https:    | 不使用IAM实例配置文件凭据的IAM角色时需要。          |
| //streamsets.c |                                                     |
| om/documentati | 使用AWS Signature V4身份验证时可用。                |
| on/datacollect |                                                     |
| or/latest/help |                                                     |
| /datacollector |                                                     |
| /UserGuide/Des |                                                     |
| tinations/Elas |                                                     |
| ticsearch.html |                                                     |
| #concept_cxd_l |                                                     |
| 1z_xfb__dt-AWS |                                                     |
| -Signature-V4) |                                                     |
+----------------+-----------------------------------------------------+
| SSL Truststore | 信任库文件的位置。                                  |
| Path           |                                                     |
|                | 配置此属性等同于配置shield.ssl.truststore.path      |
|                | Elasticsearch属性。                                 |
|                |                                                     |
|                | Elastic Cloud集群不是必需的。                       |
+----------------+-----------------------------------------------------+
| SSL Truststore | 信任库文件的密码。                                  |
| Password       |                                                     |
|                | 配置此属性等同于配置shield.ssl.truststore.password  |
|                | Elasticsearch属性。Not necessary for Elastic Cloud  |
|                | clusters.                                           |
+----------------+-----------------------------------------------------+
#### Local FS
使用Local FS目标将记录写入本地文件系统中的文件。
配置Local
FS目标时，可以定义目录模板和时间基础，以确定目标创建的输出目录和写入记录的文件。
您可以定义文件前缀、后缀、数据时区以及定义目标何时关闭文件的属性。您可以指定记录可以写入其关联目录的时间量以及延迟记录的结果。
您可以将记录写入指定的目录，使用定义的Avro架构，并根据记录头属性滚动文件。有关更多信息，请参阅记录基于记录的写入的记录头属性。
目标可以为事件流生成事件。有关事件框架的更多信息，请参阅数据流触发器概述。
您可以使用Gzip，Bzip2，Snappy，LZ4和其他压缩格式来编写输出文件。
##### 目录模板
本地FS目标使用目录模板来创建输出和后期记录目录。
本地FS根据配置的时间基础将记录写入目录。
您也可以根据targetDirectory记录头属性将记录写入目录。
使用targetDirectory属性会禁用定义目录模板的功能。
定义目录模板时，可以使用常量，字段值和日期时间变量的混合。
您可以使用every函数以小时，分钟或秒为单位定期创建新目录。
您还可以使用record：valueOrDefault函数从字段值创建新目录或在目录模板中创建默认目录。
例如，以下目录模板根据记录的状态和时间戳创建事件数据的输出目录，其中小时为最小度量单位，每小时创建一个新目录：
*/outputfiles/\${record:valueOrDefault(\"/State\",
\"unknown\")}/\${YY()}-\${MM()}-\${DD()}-\${hh()}*
您可以在目录模板中使用以下元素：
-   常量
您可以使用任何常量，例如输出。
-   日期时间变量
您可以使用日期时间变量，例如\$ {YYYY（）}或\$ {DD（）}。
目标根据您使用的最小日期时间变量根据需要创建目录。
例如，如果最小变量是小时，则为接收输出记录的一天中的每个小时创建目录。
在表达式中使用datetime变量时，请使用其中一个年变量和要使用的最小变量之间的所有日期时间变量。
不要在进展中跳过变量。
例如，要每天创建目录，请使用年变量，月变量和日变量。
您可以使用以下日期时间变量之一：
*\${YYYY()}-\${MM()}-\${DD()}*
*\${YY()}\_\${MM()}\_\${DD()}*
有关datetime变量的详细信息，请参阅Datetime Variables。
-   every函数
您可以使用目录模板中的每个函数，以小时，分钟或秒为基础，定期创建目录。
间隔应该是60的子数或整数因子。例如，您可以每15分钟或30秒创建一个目录。
使用every函数替换模板中使用的最小日期时间变量。
例如，以下目录模板每隔5分钟创建一次目录，从小时开始：
*/HDFS_output/\${YYYY()}-\${MM()}-\${DD()}-\${hh()}-\${every(5,mm())}*
-   record:valueOrDefault 函数
您可以在目录模板中使用record：valueOrDefault函数来创建具有字段值的目录或指定的默认值（如果该字段不存在或该字段为null）：
*\$ {record：valueOrDefault（\，\）}*
例如，以下目录模板每天根据Product字段创建一个目录，如果Product字段为空或null，则在目录路径中使用Misc：
*/ \$ {record：valueOrDefault（"/ Product"，"Misc"）} / \$ {YY（）} - \$
{MM（）} - \$ {DD（）}*
此模板可能会创建以下路径：
*/Shirts/2015-07-31*
*/Misc/2015-07-31*
##### 时间基础
使用目录模板时，时间基础有助于确定何时创建目录。它还确定了本地FS在编写记录时使用的目录，以及记录是否延迟。
使用targetDirectory记录头属性写入记录时，时间基础仅确定记录是否延迟。
您可以使用以下时间作为时间基础：
-   处理时间
当您使用处理时间作为时间基础时，目标将根据处理时间和目录模板创建目录，并根据处理时间将记录写入目录。
例如，假设目录模板每分钟创建一个目录，时间基础是处理时间。然后，为目标写入输出记录的每一分钟创建目录。并且输出记录将写入该目录以进行该分钟的处理。
要将处理时间用作时间基础，请使用以下表达式：\$
{time：now（）}。这是默认时间基础。
-   记录时间
使用与记录关联的时间作为时间基础时，在记录中指定日期字段。目标根据与记录关联的日期时间创建目录，并将记录写入相应的目录。
例如，假设目录模板每小时创建一个目录，时间基于记录。然后，为与输出记录关联的每小时创建目录，并且目标将记录写入相关的输出目录。
要使用与记录关联的时间，请使用调用字段并解析为日期时间值的表达式，例如\$
{record：value（"/ Timestamp"）}。
##### 后期记录和后期记录处理
使用记录时间作为时间基础时，可以定义要写入其关联输出文件的记录的时间限制。当目标在新目录中创建新输出文件时，先前的输出文件将保持打开指定的延迟记录时间限制。当属于该文件的记录在时间限制内到达时，目标将记录写入打开的输出文件。达到延迟记录时间限制时，输出文件将关闭，并且任何超过此限制的记录都将被视为延迟。
提示：如果您使用处理时间作为时间基础，则延迟记录属性不适用。如果使用处理时间，请将延迟记录时间限制设置为一秒。
您可以将延迟记录发送到延迟记录文件或阶段以进行错误处理。将记录发送到延迟记录文件时，可以定义延迟记录目录模板。
例如，您使用记录时间作为时间基准，配置一小时的延迟记录时间限制，配置要发送到阶段以进行错误处理的延迟记录，并使用默认目录模板值：
*/tmp/out/\${YYYY()}-\${MM()}-\${DD()}-\${hh()}*
到达的第一个记录的日期时间介于02:00和02:59之间，因此写入02目录中的输出文件。当日期时间在03:00到03:59之间的记录到达时，目标在03目录中创建一个新文件。目标使文件在02目录中保持打开一小时。
如果日期时间介于02:00和02:59之间的记录在小时时间限制之前到达，则目标将记录写入02目录中的打开文件。一小时后，目标关闭02目录中的输出文件。在一小时的时间限制之后到达的日期时间在02:00到02:59之间的任何记录都被认为是迟到的。迟到的记录被发送到舞台以进行错误处理。
##### 超时关闭空闲文件
您可以配置打开的输出文件可以保持空闲的最长时间。在指定的时间内没有记录写入输出文件后，Local
FS目标将关闭该文件。
您可能希望在输出文件保持打开和空闲时间过长时配置空闲超时，从而延迟另一个系统处理文件。
由于以下原因，输出文件可能会长时间处于空闲状态：
-   您配置了要写入输出文件的最大记录数或输出文件的最大大小，但记录已停止到达。未达到最大记录数或最大文件大小的输出文件将保持打开状态，直到更多记录到达。
-   您在记录中将日期字段配置为时间基础并配置了延迟记录时间限制，但记录按时间顺序到达。创建新目录时，上一目录中的输出文件将保持打开状态，以用于配置的延迟记录时间限制。但是，没有记录写入上一目录中的打开文件。
例如，当日期时间为03:00的记录到达时，目标将在新的03目录中创建一个新文件。
02目录中的上一个文件在后期记录时间限制内保持打开状态，默认情况下为一小时。但是，当记录按时间顺序到达时，在创建03目录后，没有属于02目录的记录到达。
在任何一种情况下，配置空闲超时以便其他系统可以更快地处理文件，而不是等待配置的最大记录、最大文件大小或延迟记录条件发生。
##### 恢复
通过在管道重新启动时重命名临时文件，本地FS目标支持在管道意外停止后进行恢复。
目标使用以下格式命名临时打开输出文件：
*\_tmp\_\\_\*
其中\是为目标定义的文件前缀，\是执行管道处理的管道运行器的ID。
例如，当目标前缀定义为sdc且目标从单线程管道运行时，临时文件的名称如下：\_tmp_sdc_0。
当目标关闭文件时，无论是在完全写入之后，在空闲超时到期之后，还是在您故意停止管道时，它都会重命名该文件以删除_tmp_字符串并将管道运行程序ID替换为随机唯一标识符，如
所以：
*\\_e7ce67c5-013d-47a7-9496-8c882ddb28a0*
但是，当管道意外停止时，临时文件仍然存在。管道重新启动时，目标将扫描已定义目录模板的所有子目录，以重命名与目标的已定义前缀匹配的任何临时文件。目标重命名临时文件后，它将继续写入新的输出文件。
注意：目标重命名所有与定义的目录模板的所有子目录中定义的前缀匹配的临时文件，即使这些文件不是由该管道写入的。因此，如果您碰巧有另一个名称以相同模式开头的文件 -
\_tmp\_ \ - 目标也会重命名该文件。
在以下情况下，目标可能不会重命名所有临时文件：
-   目录模板包含一个带有record：value或record：valueOrDefault函数的表达式。
如果record：value或record：valueOrDefault函数求值为空字符串或子目录，则目标无法在管道重新启动时确定这些位置。因此，目标无法重命名写入这些位置的任何临时文件。
例如，假设目录模板定义如下：
/tmp/out/\${YY()}-\${MM()}-\${DD()}/\${sdc:hostname()}/\${record:value(\'/a\')}/\${record:value(\'/b\')}
如果表达式\$ {record：value（\'/ b\'）}计算为空字符串或子目录（例如/
folder1 / folder2），则目标无法在管道重新启动时确定这些位置。
-   该目录在targetDirectory记录头属性中定义。
在targetDirectory记录头属性中定义目录时，目标无法确定管道重新启动时在何处查找临时文件。
因此，它无法重命名临时文件。
在上述任一情况下，您都必须手动重命名临时文件。
文件恢复可能会在重新启动时减慢管道速度。