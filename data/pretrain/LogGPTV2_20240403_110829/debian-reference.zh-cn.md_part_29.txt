Debian参考手册 109/233
设置”IPaddressorhostnameoftheoutgoingsmarthost:”为”smtp.hostname.dom:587”。
设置”Hidelocalmailnameinoutgoingmail?”选项为”NO”。(或者像第 6.2.4.3 节描述的那样使用/etc/email-addresses”
代替)
选择如下所示的其中一个来回答”KeepnumberofDNS-queriesminimal(Dial-on-Demand)?”。
• ”No”如果启动的时候，系统就连上了互联网。
• ”Yes”如果启动的时候，系统没有连上互联网。
设置”Deliverymethodforlocalmail:”选项为”mboxformatin/var/mail/”。
”Splitconfigurationintosmallfiles?:”选项设为”Yes”。
通过修改”/etc/exim4/passwd.client”文件，来创建用于smarthost的密码条目。
$ sudo vim /etc/exim4/passwd.client
...
$ cat /etc/exim4/passwd.client
^smtp.*\.hostname\.dom:PI:EMAIL:password
配置exim4(8)，在”/etc/default/exim4”文件中写入”QUEUERUNNER=’queueonly’”，”QUEUERUNNER=’nodaemon’”
等等，来最小化系统资源使用。（可选的）
通过如下所示的启动exim4。
$ sudo systemctl start exim4
”/etc/exim4/passwd.client”文件中的主机名不应该是别名，你应该按如下所示的检查真正的主机名。
$ host smtp.hostname.dom
smtp.hostname.dom is an alias for smtp99.hostname.dom.
smtp99.hostname.dom has address 123.234.123.89
我在”/etc/exim4/passwd.client”文件中使用正则表达式来绕过别名问题。即使ISP更改了别名所指向的主机
名，SMTPAUTH还是可能工作的。
你能够通过如下所示的手动更新exim4配置:
• 更新”/etc/exim4/”目录下的exim4配置文件。
– 创建”/etc/exim4/exim4.conf.localmacros”来设置宏命令和修改”/etc/exim4/exim4.conf.template”
文件。(没有分割的配置）
– 在”/etc/exim4/exim4.conf.d”子目录中创建新文件或编辑已存在的文件。(分割的配置）
• 运行”systemctl reload exim4”.
小心
如果debconf询问”KeepnumberofDNS-queriesminimal(Dial-on-Demand)?”这个问题时，选择了”No”(默
认值)，那么启动exim4会花很长时间并且系统在启动的时候不会连接到互联网。
请阅读”/usr/share/doc/exim4-base/README.Debian.gz”官方指导和update-exim4.conf(8)。
警告
从所有的实践考虑，使用带STARTTLS的SMTP端口587，或者SMTPS(SSL之上的SMTP)端口465,
代替纯SMTP端口25。
Debian参考手册 110/233
命令 功能
postfix(1) Postfix控制程序
postconf(1) Postfix配置工具
postconf(5) Postfix配置参数
postmap(1) Postfix查找表维护
postalias(1) Postfix别名数据库维护
Table6.4: 重要的postfix手册页列表
6.2.4.2 带有SASL的postfix配置
对于通过smarthost的网络邮件，你应该首先阅读postfix文档和关键的手册页。
你应该按如下所示的(重新)配置postfix和sasl2-bin软件包。
$ sudo systemctl stop postfix
$ sudo dpkg-reconfigure postfix
选择”Internetwithsmarthost”。
设置”SMTPrelayhost(blankfornone):”为”[smtp.hostname.dom]:587”并按如下所示配置。
$ sudo postconf -e ’smtp_sender_dependent_authentication = yes’
$ sudo postconf -e ’smtp_sasl_auth_enable = yes’
$ sudo postconf -e ’smtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd’
$ sudo postconf -e ’smtp_sasl_type = cyrus’
$ sudo vim /etc/postfix/sasl_passwd
为smarthost创建密码条目。
$ cat /etc/postfix/sasl_passwd
[smtp.hostname.dom]:587 username:password
$ sudo postmap hush:/etc/postfix/sasl_passwd
通过如下所示的启动postfix。
$ sudo systemctl start postfix
dpkg-reconfigure 会话中使用的”[” 和”]” 和”/etc/postfix/sasl_passwd” 确保不去检查 MX 记录而是直
接使用指定的明确主机名。参见”/usr/share/doc/postfix/html/SASL_README.html”里面的”EnablingSASL
authenticationinthePostfixSMTPclient”条目。
6.2.4.3 邮件地址配置
这里有一些用于邮件传输、投递和用户代理的邮件地址配置文件。
文件 功能 应用
/etc/mailname 用于(外发)邮件的默认主机名 Debian专用的，mailname(5)
exim(8)专用的，
/etc/email-addresses 用于外发邮件的主机名伪装
exim4-config_files(5)
postfix(1)专用的，postmap(1)命令执
/etc/postfix/generic 用于外发邮件的主机名伪装
行后激活。
/etc/aliases 用于接收邮件的账户别名 通用的，newaliases(1)命令执行后激活。
Table6.5: 与邮件地址相关的配置文件列表
”/etc/mailname”文件中的mailname通常是全称域名(FQDN)，这个全程域名将会被解析成主机的IP地址。对于没
有可解析成IP地址的主机名的移动工作站，设置mailname为”hostname -f”的值。(这对于exim4-*和postfix
都是安全有效的选择。)
Debian参考手册 111/233
提示
”/etc/mailname” 中的内容被许多非 MTA 程序用作它们的默认行为。对于 mutt, 在 ~/muttrc 文件中设
置”hostname”和”from”变量来覆盖mailname值。对于devscripts软件包的程序，例如bts(1)和dch(1)，导
出环境变量”$DEBFULLNAME”和”$DEBEMAIL”的值来覆盖它。
提示
popularity-contest 软 件 包 一 般 以 FQDN 形 式 的 root 账 户 发 送 邮 件。 你 需 要
像 /usr/share/popularity-contest/default.conf 文 件 中 描 述 的 那 样 去 设 置
/etc/popularity-contest.conf 文件中的 MAILFROM 值。否则，你的邮件会被 smarthost SMTP 服务
器拒绝。尽管这些过程很乏味，这种方法比为所有通过MTA并且是以root用户发送的邮件重写源地址更安全。这
也可以被其他守护进程或者是cron脚本使用。
当设置mailname为”hostname -f”的值时，通过MTA的源邮件地址的伪装可以通过如下所示的来实现。
• 用于exim4(8)的”/etc/email-addresses”文件，exim4-config_files(5)手册页中有关于它的解释
• 用于postfix(1)的”/etc/postfix/generic”文件，generic(5)手册页中有关于它的解释
对于postfix，接下来的额外步骤需要执行。
# postmap hash:/etc/postfix/generic
# postconf -e ’smtp_generic_maps = hash:/etc/postfix/generic’
# postfix reload
你能够通过如下所示的来测试邮件地址配置。
• exim(8)用-brw, -bf, -bF, -bV, ... 选项
• postmap(1)用-q选项。
提示
Exim带有一些有用的程序，例如exiqgrep(8)和exipick(8)。参见”dpkg -L exim4-base|grep man8/”来
获得可用的命令。
6.2.4.4 基础MTA操作
这里有一些基础的MTA操作。有一些可能会通过sendmail(1)的兼容性接口来实现。
提示
往”/etc/ppp/ip-up.d/*”里写一个刷新所有邮件的脚本会是个不错的主意。
6.3 服务器远程访问和工具 (SSH)
SecureSHell(SSH)是因特网上的安全连接方式。在Debian里面，有一个叫OpenSSH的免费SSH版本，在openssh-client
和openssh-server包里。
对于用户来讲,ssh(1)功能比 telnet(1)更加智能和安全. 不像telnet命令,ssh命令不会在遇到telnet的退出
字符(初始默认是CTRL-])时停止.
虽然shellinabox不是一个SSH程序，它列在这里作为远程终端访问的一个有趣的替代。
连接到远程X客户端程序，参见：第 7.8 节。
Debian参考手册 112/233
exim命令 postfix命令 说明
sendmail sendmail 从标准输入读取邮件并且安排投递(-bm)
mailq mailq 列出带有状态和队列ID的邮件队列(-bq)
newaliases newaliases 初始化别名数据库(-I)
exim4 -q postqueue -f 刷新等待邮件(-q)
postsuper -r ALL
exim4 -qf 刷新所有邮件
deferred; postqueue -f
postsuper -r ALL;
exim4 -qff 刷新甚至已经冻结的邮件
postqueue -f
exim4 -Mg queue_id postsuper -h queue_id 通过邮件的队列ID来冻结它
exim4 -Mrm queue_id postsuper -d queue_id 通过邮件的队列ID来移除它
N/A postsuper -d ALL 移除所有邮件
Table6.6: 基础MTA操作列表
软件包 流行度 大小 工具 说明
openssh-client V:868,I:996 5821 ssh(1) SSH客户端
openssh-server V:733,I:819 1955 sshd(8) SSH服务端
ssh-askpass I:23 102 ssh-askpass请(1)求用户输入ssh-add密码(简单的X)
ssh-askpass-gnome
V:0,I:3 199 ssh-askpass请-g求no用m户e(输1)入ssh-add密码(GNOME)
ssh-askpass-fullscreen 请求用户输入ssh-add密码(GNOME)，有更好看的
V:0,I:0 48 ssh-askpass-fullscreen(1)
界面
shellinabox V:0,I:1 507 shellinabox浏d(览1)器访问VT100终端模拟器网页服务器
Table6.7: 服务器远程访问和工具列表
小心
如果你的SSH是从因特网来访问，参见第 4.6.3 节。
提示
请使用screen(1)程序来让远程shell在中断的连接上存活(参见第 9.1.2 节).
6.3.1 SSH 基础
OpenSSHSSH后台守护进程（daemon）只支持SSH2协议。
请阅读”/usr/share/doc/openssh-client/README.Debian.gz”、ssh(1)、sshd(8)、ssh-agent(1)、ssh-keygen(1)、
ssh-add(1)和ssh-agent(1).
警告
如果想要运行OpenSSH服务，”/etc/ssh/sshd_not_to_be_run”必须不存在。
不要打开基于rhost的认证(/etc/ssh/sshd_config中的HostbasedAuthentication)。
从客户端启动一个ssh(1)连接.
Debian参考手册 113/233
配置文件 配置文件描述
/etc/ssh/ssh_config SSH客户端默认,参见ssh_config(5)
/etc/ssh/sshd_config SSH服务端默认,参见sshd_config(5)
~/.ssh/authorized_keys 该账户连接到这个服务器上的客户端使用的默认SSH公钥
~/.ssh/id_rsa 用户的SSH-2RSA私钥
~/.ssh/id_key-type-name 用户的SSH-2密钥，key-type-name为ecdsa、ed25519等
Table6.8: SSH配置文件列表
命令 说明
ssh
使用默认模式连接
PI:EMAIL
ssh -v
有详细信息的默认连接模式
PI:EMAIL
ssh -o
PreferredAuthentications=password SSH2版本，强制使用密码
PI:EMAIL