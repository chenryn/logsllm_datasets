2ğ‘›âˆ’ğ‘˜
Proof. Bad2 is the set of all attainable transcripts ğœ that contain
two entries (prim, ğ‘¥, ğ‘¦, Â·) and (enc, ğ‘–, ğ‘ , ğ´ğ·, ğ‘€, ğ¶âˆ¥ğ‘‡ , ğ‘‰0âˆ¥ Â· Â· Â· âˆ¥ğ‘‰â„“)
Pr[Tideal âˆˆ Bad2] â‰¤ ğ‘ Â· 2(ğ‘› âˆ’ ğ‘˜) ğœğ‘’
such that ğ‘¦ âˆˆ(cid:110)ğ‘‰0 (32)âˆ’ (ğ‘âˆ¥ğ¾ğ‘–âˆ¥0âˆ¥ğ‘), Â· Â· Â· , ğ‘‰â„“
(32)âˆ’ (ğ‘âˆ¥ğ¾ğ‘–âˆ¥â„“âˆ¥ğ‘)(cid:111).
(cid:109)
(cid:108)
(cid:105)+ Pr[Tideal âˆˆ Bad2 âˆ§ ğ¸1]
Pr[Tideal âˆˆ Bad2]= Pr(cid:104)Tideal âˆˆ Bad2 âˆ§ ğ¸1
(cid:12)(cid:12)(cid:12) ğ¸1
(cid:105) + Pr[ğ¸1].
â‰¤ Pr(cid:104)Tideal âˆˆ Bad2
Let ğ¸1 be the event that there exist ğ‘¤ âˆˆ {0, 1}ğ‘›âˆ’ğ‘˜ such that am-
ong all encryption queries, there are ğ‘š1 =
max(1,ğ‘›âˆ’ğ‘˜âˆ’log2(ğœğ‘’+ğ‘ğ‘’))
or more values of [ğ‘‰ğ‘—]ğ¾- (32)âˆ’ (ğ‘âˆ¥ ğ‘—âˆ¥ğ‘) that are equal to ğ‘¤, where ğ‘
is the nonce associated to the encryption query of ğ‘‰ğ‘—. Then,
2(ğ‘›âˆ’ğ‘˜)
We will now bound the probability of ğ¸1, so that we only have
to consider the event Tideal âˆˆ Bad2 conditioned by ğ¸1 afterward.
Recall that in the ideal world, the ğ‘‰ğ‘— values are independent and
uniformly distributed. We can view each encryption query
Enc(ğ‘–, ğ‘ , ğ´ğ·, ğ‘€1âˆ¥ Â· Â· Â· âˆ¥ğ‘€â„“) with answer ğ¶1âˆ¥ Â· Â· Â· âˆ¥ğ¶â„“âˆ¥ğ‘‡ together
with the sampling of its associated ğ‘Ÿ,ğ‘Š ,ğ‘Š â€² parameters, as throwing
â„“ + 1 balls [ğ‘‰ğ‘—]ğ¾- (32)âˆ’ (ğ‘âˆ¥ ğ‘—âˆ¥ğ‘), for 0 â‰¤ ğ‘— â‰¤ â„“, uniformly at random
into 2ğ‘›âˆ’ğ‘˜ bins. Thus if we consider all encryption queries, we throw
at most ğœğ‘’ + ğ‘ğ‘’ balls uniformly at random into 2ğ‘›âˆ’ğ‘˜ bins. Using
Lemma B.1, with ğ‘„ = ğœğ‘’ + ğ‘ğ‘’ and ğµ = 2âˆ’(ğ‘›âˆ’ğ‘˜), the probability
that the heaviest bin contains ğ‘š1 or more balls is at most 2âˆ’(ğ‘›âˆ’ğ‘˜).
Therefore, the probability of ğ¸1 is bounded by 2âˆ’(ğ‘›âˆ’ğ‘˜). Hence,
Pr[Tideal âˆˆ Bad2] â‰¤ Pr(cid:104)Tideal âˆˆ Bad2
(10)
Note that ğ¸1 is the event that for all ğ‘¤ âˆˆ {0, 1}ğ‘›âˆ’ğ‘˜, among all
encryption queries, there are strictly less than ğ‘š1 values of [ğ‘‰ğ‘—]ğ¾- (32)âˆ’
(ğ‘âˆ¥ ğ‘—âˆ¥ğ‘) that are equal to ğ‘¤. To bound the remaining term, we
now consider the case where A is querying the Reveal oracle
and all ğ‘Ÿ,ğ‘Š ,ğ‘Š â€² parameters have been sampled, but no user keys
ğ¾ğ‘– have been sampled yet. In the following, we mean by ğ‘¦ the
value associated to a primitive query and by ğ‘— the block index
associated to an encryption query. The unionğ‘¦,ğ‘— and sumğ‘¦ğ‘—
(cid:105) + 2âˆ’(ğ‘›âˆ’ğ‘˜) .
are over all primitive and encrypted blocks already queried. A
transcript is in Bad2, if there exist a ğ‘¦ from a primitive query and
(32)âˆ’ (ğ‘âˆ¥ğ¾ğ‘–âˆ¥ ğ‘—âˆ¥ğ‘) from an encryption query that are equal. To
a ğ‘‰ğ‘—
bound the probability of this event, we split it into two, one for the
(32)âˆ’ (ğ‘âˆ¥ğ¾ğ‘–âˆ¥ ğ‘—âˆ¥ğ‘) and ğ‘¦ are equal and
event that the key part of ğ‘‰ğ‘—
a second one for the event that the remaining parts are equal. Let
(cid:12)(cid:12)(cid:12) ğ¸1
ğ¸2( ğ‘—, ğ‘¦) be the event that [ğ‘‰ğ‘—]ğ¾+ (32)âˆ’ ğ¾ğ‘– = [ğ‘¦]ğ¾+ and ğ¸3( ğ‘—, ğ‘¦) be the
event that [ğ‘‰ğ‘—]ğ¾- (32)âˆ’ (ğ‘âˆ¥ ğ‘—âˆ¥ğ‘) = [ğ‘¦]ğ¾-. Then, using a union bound,
Pr(cid:104)Tideal âˆˆ Bad2
â‰¤âˆ‘ï¸
(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12) ğ¸1
Pr(cid:104)ğ¸2( ğ‘—, ğ‘¦)(cid:12)(cid:12)(cid:12) ğ¸1 âˆ§ ğ¸3( ğ‘—, ğ‘¦)(cid:105) Â· Pr(cid:104)ğ¸3( ğ‘—, ğ‘¦)(cid:12)(cid:12)(cid:12) ğ¸1
(cid:105) â‰¤ Pr
ğ¸2( ğ‘—, ğ‘¦) âˆ§ ğ¸3( ğ‘—, ğ‘¦)
(cid:12)(cid:12)(cid:12) ğ¸1
âˆ‘ï¸
(cid:105) .

(11)
ğ‘¦,ğ‘—
ğ‘¦
ğ‘—
When querying Reveal, for any pair ( ğ‘—, ğ‘¦), the probability that
[ğ‘‰ğ‘—]ğ¾+ (32)âˆ’ ğ¾ğ‘– = [ğ‘¦]ğ¾+ is the probability that when the key is sam-
pled ğ¾ğ‘– = [ğ‘‰ğ‘—]ğ¾+ (32)âˆ’ [ğ‘¦]ğ¾+. As the keys are uniformly sampled in
Reveal, and independently from any previous queries and param-
eters, this probability is 1
2ğ‘˜ . This event is also independent from ğ¸1
and ğ¸3( ğ‘—, ğ‘¦). Thus
= Pr[ğ¸2( ğ‘—, ğ‘¦)] =
1
2ğ‘˜
.
(12)
Note that conditioned on event ğ¸1 there are strictly less than ğ‘š1
values [ğ‘‰ğ‘—]ğ¾- (32)âˆ’ (ğ‘âˆ¥ ğ‘—âˆ¥ğ‘) that are equal to one [ğ‘¦]ğ¾-, thus for
a fix ğ‘¦, there are strictly less than ğ‘š1 block indexes ğ‘— such that
Pr(cid:104)ğ¸2( ğ‘—, ğ‘¦)(cid:12)(cid:12)(cid:12) ğ¸1 âˆ§ ğ¸3( ğ‘—, ğ‘¦)(cid:105)
Pr(cid:104)ğ¸3( ğ‘—, ğ‘¦)(cid:12)(cid:12)(cid:12) ğ¸1
(cid:105) is not zero. Thus
Pr(cid:104)ğ¸3( ğ‘—, ğ‘¦)(cid:12)(cid:12)(cid:12) ğ¸1
âˆ‘ï¸
âˆ‘ï¸
(cid:108)
<âˆ‘ï¸
(cid:109) â‰¤ 2(cid:108)
Pr[Tideal âˆˆ Bad2] â‰¤ ğ‘ Â· 2(ğ‘› âˆ’ ğ‘˜) ğœğ‘’
2(ğ‘›âˆ’ğ‘˜)
(cid:105)
ğ‘¦
ğ‘¦
ğ‘—
2ğ‘˜
Moreover, ğ‘š1 =
max(1,ğ‘›âˆ’ğ‘˜âˆ’log2(2ğœğ‘’))
= 2(ğ‘› âˆ’ ğ‘˜) ğœğ‘’ and in combination with (10), (11), (12), (13), we obtain
max(1,ğ‘›âˆ’ğ‘˜âˆ’log2(ğœğ‘’+ğ‘ğ‘’))
(ğ‘›âˆ’ğ‘˜)
ğ‘š1 â‰¤ ğ‘ Â· ğ‘š1.
(13)
(cid:109)
+ 1
2ğ‘›âˆ’ğ‘˜
.
â–¡
B.2.4 Bounding Bad3 transcripts probability.
Lemma B.4 (Bad3).
Pr[Tideal âˆˆ Bad3] â‰¤ ğ‘ğ‘’(ğ‘‘ âˆ’ 1)
.
2ğ‘˜
Proof. Bad3 is the set of all attainable transcripts ğœ that con-
tain two entries (enc, ğ‘–, ğ‘ , ğ´ğ·, ğ‘€, ğ¶âˆ¥ğ‘‡ , ğ‘‰) and (enc, ğ‘—, ğ‘ â€², ğ´ğ·â€², ğ‘€â€²,
ğ¶â€²âˆ¥ğ‘‡ â€², ğ‘‰ â€²) with ğ‘ = ğ‘ â€², ğ‘– â‰  ğ‘— and ğ¾ğ‘– = ğ¾ğ‘—.
If a transcript generated by the adversary A in the ideal aug-
mented game is in Bad3, then this adversary A has made a pair
of encryption queries Enc(ğ‘–, ğ‘ , ğ´ğ·, ğ‘€) and Enc( ğ‘—, ğ‘ â€², ğ´ğ·â€², ğ‘€â€²)
with ğ‘ = ğ‘ â€² and ğ‘– â‰  ğ‘—, and a query to Reveal that returned the
two corresponding ğ¾ğ‘– and ğ¾ğ‘— being equal. Hence the probability
that a transcript generated by A in the ideal augmented game is in
Bad3 is bounded by the probability that A makes the previously
described queries.
We are again going to consider the case where A is just about
to query Reveal, but has already made all its other oracle queries.
For each of the at most ğ‘ğ‘’ encryption queries Enc(ğ‘–, ğ‘ , ğ´ğ·, ğ‘€)
done by A, there are at most ğ‘‘ âˆ’ 1 other encryption queries
Enc( ğ‘—, ğ‘ â€², ğ´ğ·â€², ğ‘€â€²) with ğ‘ = ğ‘ â€² and ğ‘– â‰  ğ‘— done by A. Thus there
are at most ğ‘ğ‘’(ğ‘‘ âˆ’ 1), possible pairs of such encryption queries
done by A. When querying Reveal, for each of these pairs, the
probability that ğ¾ğ‘– = ğ¾ğ‘— is 1
2ğ‘˜ , as the keys are uniformly sampled,
independently from any previous queries. Hence, using a union
Session 6D: Authentication and Privacy CCS â€™21, November 15â€“19, 2021, Virtual Event, Republic of Korea1997bound, the probability that for at least one of these pairs ğ¾ğ‘– = ğ¾ğ‘—,
is at most ğ‘ğ‘’ (ğ‘‘âˆ’1)
2ğ‘˜
. Thus,
Pr[Tideal âˆˆ Bad3] â‰¤ ğ‘ğ‘’(ğ‘‘ âˆ’ 1)
2ğ‘˜
.
â–¡
B.2.5 Bounding Bad4 transcripts probability.
Lemma B.5 (Bad4).
Pr[Tideal âˆˆ Bad4] â‰¤ (ğœğ‘’ + ğ‘ğ‘’)2
2ğ‘›+1
.
ğ‘¡
Proof. Bad4 is the set of all attainable transcripts ğœ that contain
(32)âˆ’ (ğ‘âˆ¥ğ¾ğ‘–âˆ¥ğ‘ âˆ¥ğ‘) = ğ‘‰ â€²
0 âˆ¥ Â· Â· Â· âˆ¥ğ‘‰ â€²
(32)âˆ’(ğ‘âˆ¥ğ¾ğ‘–âˆ¥ğ‘ âˆ¥ğ‘) = ğ‘‰ â€²
two entries (enc, ğ‘–, ğ‘ , ğ´ğ·, ğ‘€, ğ¶âˆ¥ğ‘‡ , ğ‘‰0âˆ¥ Â· Â· Â· âˆ¥ğ‘‰â„“) and
(enc, ğ‘—, ğ‘ â€², ğ´ğ·â€², ğ‘€â€², ğ¶â€²âˆ¥ğ‘‡ â€², ğ‘‰ â€²
â„“â€²) such that (ğ¾ğ‘–, ğ‘ , ğ‘) â‰ 
(32)âˆ’(ğ‘âˆ¥ğ¾ğ‘— âˆ¥ğ‘¡âˆ¥ğ‘ â€²) for 0 â‰¤ ğ‘  â‰¤ â„“
(ğ¾ğ‘— , ğ‘¡, ğ‘ â€²) and ğ‘‰ğ‘ 
and 0 â‰¤ ğ‘¡ â‰¤ â„“â€².
If a transcript generated by the adversary A in the ideal aug-
mented game is in Bad4, then A has made a Reveal query that
(32)âˆ’ (ğ‘âˆ¥ğ¾ğ‘— âˆ¥ğ‘¡âˆ¥ğ‘ â€²).
returned values verifying ğ‘‰ğ‘ 
As established above, the ğ‘‰ğ‘— values are all independent and uni-
formly distributed. Moreover, the keys ğ¾ğ‘– are also independent and
uniformly distributed. Hence, for each encryption query
Enc(ğ‘–, ğ‘ , ğ´ğ·, ğ‘€1âˆ¥ Â· Â· Â· âˆ¥ğ‘€â„“), the â„“ values ğ‘‰0 (32)âˆ’ (ğ‘âˆ¥ğ¾ğ‘–âˆ¥0âˆ¥ğ‘), Â· Â· Â· ,
(32)âˆ’ (ğ‘âˆ¥ğ¾ğ‘–âˆ¥â„“âˆ¥ğ‘) are also independent and uniformly distributed.
ğ‘‰â„“
If we consider all encryption queries, we obtain at most ğœğ‘’ + ğ‘ğ‘’
independent and uniformly distributed values, and the probability
that at least two of them are equal is at most the birthday bound,
i.e., (ğœğ‘’+ğ‘ğ‘’)2
2ğ‘›+1
. Thus,
ğ‘¡
Pr[Tideal âˆˆ Bad4] â‰¤ (ğœğ‘’ + ğ‘ğ‘’)2
2ğ‘›+1
.
â–¡
B.2.6 Bounding Bad5 transcripts probability.
Lemma B.6 (Bad5).
Pr[Tideal âˆˆ Bad5] â‰¤ ğ‘ğ‘£ Â· 2(cid:16)(ğ‘› âˆ’ ğ‘˜) ğ‘ + 2ğ‘¡ ğ‘(cid:17)
2ğ‘˜
+
1
2ğ‘›âˆ’ğ‘˜âˆ’1 +
1
22ğ‘¡âˆ’1 .
Proof. Bad5 is the set of all attainable transcripts ğœ that contain
two entries (vf, ğ‘–, ğ‘ , ğ´ğ·, ğ¶âˆ¥ğ‘‡ , false) and (prim, ğ‘¥, ğ‘¦, Â·) such that ğ‘¥ =
(ğ‘âˆ¥ğ¾ğ‘–âˆ¥0âˆ¥ğ‘) and âˆƒğ‘Ÿ âˆˆ {0, 1}ğ‘¡ ,ğ‘Š âˆˆ {0, 1}ğ‘›âˆ’2ğ‘¡ such that ğ‘¦
(32)+ ğ‘¥ =
(ğ‘Ÿâˆ¥(ğ‘‡ (ğ‘¡)âˆ’ ğ»ğ‘Ÿ (ğ´ğ·, ğ¶))âˆ¥ğ‘Š ).
The probability calculation for this case will follow the same
outline as for Bad2.
Let ğ¸4 be the event that there exist ğ‘¤ âˆˆ {0, 1}ğ‘›âˆ’ğ‘˜, such that the
number of inverse ideal permutation queries verifying [ğ‘¥]ğ¾- = ğ‘¤,
is greater or equal to ğ‘š4 =
event that there exist ğ´ğ·âˆ—, ğ¶âˆ— âˆˆ {0, 1}âˆ— and ğ‘‡âˆ—, ğ‘Ÿâˆ— âˆˆ {0, 1}ğ‘¡ such
that, the number of forward ideal permutation queries verifying
[ğ‘¦
(32)+ ğ‘¥]ğ‘Ÿ , is greater or equal
(cid:109) and ğ¸5 be the
(32)+ ğ‘¥]ğ‘  (ğ‘¡)+ğ»ğ‘Ÿâˆ—(ğ´ğ·âˆ—, ğ¶âˆ—) = ğ‘‡âˆ— and ğ‘Ÿâˆ— = [ğ‘¦
max(1,ğ‘›âˆ’ğ‘˜âˆ’1âˆ’log2(ğ‘))
2(ğ‘›âˆ’ğ‘˜âˆ’1)
(cid:108)
(cid:108)
2Â·(2ğ‘¡âˆ’1)
to ğ‘š5 =
max(1,2ğ‘¡âˆ’1âˆ’log2(ğ‘))
(cid:109). Then, in a similar way as for Bad2,
(cid:105)
Pr[Tideal âˆˆ Bad5] = Pr(cid:104)Tideal âˆˆ Bad5 âˆ§ ğ¸4 âˆ§ ğ¸5
+ Pr(cid:104)Tideal âˆˆ Bad5 âˆ§ ğ¸4 âˆ§ ğ¸5
(cid:105)
(cid:12)(cid:12)(cid:12) ğ¸4 âˆ§ ğ¸5
(cid:105) + Pr[ğ¸4 âˆ¨ ğ¸5]
(cid:12)(cid:12)(cid:12) ğ¸4 âˆ§ ğ¸5
(cid:105) + Pr[ğ¸4] + Pr[ğ¸5].
â‰¤ Pr(cid:104)Tideal âˆˆ Bad5
â‰¤ Pr(cid:104)Tideal âˆˆ Bad5
(14)
We will again bound the probability of ğ¸4 and ğ¸5, leaving us after-
ward with event Tideal âˆˆ Bad5 conditioned by ğ¸4 âˆ§ ğ¸5.
We can view each inverse ideal permutation query Primâˆ’1(ğ‘¦)
with answer ğ‘¥ as throwing a ball [ğ‘¥]ğ¾- into one of 2ğ‘›âˆ’ğ‘˜ possible
2ğ‘›âˆ’ğ‘ â‰¤
bins, with probability at most
2ğ‘˜
2ğ‘›âˆ’ğ‘˜âˆ’1 . Thus if we consider all inverse ideal permutation
2ğ‘›âˆ’1 =
queries, we throw at most ğ‘ balls with conditional probability at
most 2âˆ’(ğ‘›âˆ’ğ‘˜âˆ’1) into 2ğ‘›âˆ’ğ‘˜ bins. Using Lemma B.1, with ğ‘„ = ğ‘ and
ğµ = 2âˆ’(ğ‘›âˆ’ğ‘˜âˆ’1), the probability that the heaviest bin contains ğ‘š4 or
more balls is at most 2âˆ’(ğ‘›âˆ’ğ‘˜âˆ’1). Therefore, the probability of ğ¸4 is
bounded by 2âˆ’(ğ‘›âˆ’ğ‘˜âˆ’1):