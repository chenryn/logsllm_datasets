2𝑛−𝑘
Proof. Bad2 is the set of all attainable transcripts 𝜏 that contain
two entries (prim, 𝑥, 𝑦, ·) and (enc, 𝑖, 𝑁 , 𝐴𝐷, 𝑀, 𝐶∥𝑇 , 𝑉0∥ · · · ∥𝑉ℓ)
Pr[Tideal ∈ Bad2] ≤ 𝑝 · 2(𝑛 − 𝑘) 𝜎𝑒
such that 𝑦 ∈(cid:110)𝑉0 (32)− (𝑍∥𝐾𝑖∥0∥𝑁), · · · , 𝑉ℓ
(32)− (𝑍∥𝐾𝑖∥ℓ∥𝑁)(cid:111).
(cid:109)
(cid:108)
(cid:105)+ Pr[Tideal ∈ Bad2 ∧ 𝐸1]
Pr[Tideal ∈ Bad2]= Pr(cid:104)Tideal ∈ Bad2 ∧ 𝐸1
(cid:12)(cid:12)(cid:12) 𝐸1
(cid:105) + Pr[𝐸1].
≤ Pr(cid:104)Tideal ∈ Bad2
Let 𝐸1 be the event that there exist 𝑤 ∈ {0, 1}𝑛−𝑘 such that am-
ong all encryption queries, there are 𝑚1 =
max(1,𝑛−𝑘−log2(𝜎𝑒+𝑞𝑒))
or more values of [𝑉𝑗]𝐾- (32)− (𝑍∥ 𝑗∥𝑁) that are equal to 𝑤, where 𝑁
is the nonce associated to the encryption query of 𝑉𝑗. Then,
2(𝑛−𝑘)
We will now bound the probability of 𝐸1, so that we only have
to consider the event Tideal ∈ Bad2 conditioned by 𝐸1 afterward.
Recall that in the ideal world, the 𝑉𝑗 values are independent and
uniformly distributed. We can view each encryption query
Enc(𝑖, 𝑁 , 𝐴𝐷, 𝑀1∥ · · · ∥𝑀ℓ) with answer 𝐶1∥ · · · ∥𝐶ℓ∥𝑇 together
with the sampling of its associated 𝑟,𝑊 ,𝑊 ′ parameters, as throwing
ℓ + 1 balls [𝑉𝑗]𝐾- (32)− (𝑍∥ 𝑗∥𝑁), for 0 ≤ 𝑗 ≤ ℓ, uniformly at random
into 2𝑛−𝑘 bins. Thus if we consider all encryption queries, we throw
at most 𝜎𝑒 + 𝑞𝑒 balls uniformly at random into 2𝑛−𝑘 bins. Using
Lemma B.1, with 𝑄 = 𝜎𝑒 + 𝑞𝑒 and 𝐵 = 2−(𝑛−𝑘), the probability
that the heaviest bin contains 𝑚1 or more balls is at most 2−(𝑛−𝑘).
Therefore, the probability of 𝐸1 is bounded by 2−(𝑛−𝑘). Hence,
Pr[Tideal ∈ Bad2] ≤ Pr(cid:104)Tideal ∈ Bad2
(10)
Note that 𝐸1 is the event that for all 𝑤 ∈ {0, 1}𝑛−𝑘, among all
encryption queries, there are strictly less than 𝑚1 values of [𝑉𝑗]𝐾- (32)−
(𝑍∥ 𝑗∥𝑁) that are equal to 𝑤. To bound the remaining term, we
now consider the case where A is querying the Reveal oracle
and all 𝑟,𝑊 ,𝑊 ′ parameters have been sampled, but no user keys
𝐾𝑖 have been sampled yet. In the following, we mean by 𝑦 the
value associated to a primitive query and by 𝑗 the block index
associated to an encryption query. The union𝑦,𝑗 and sum𝑦𝑗
(cid:105) + 2−(𝑛−𝑘) .
are over all primitive and encrypted blocks already queried. A
transcript is in Bad2, if there exist a 𝑦 from a primitive query and
(32)− (𝑍∥𝐾𝑖∥ 𝑗∥𝑁) from an encryption query that are equal. To
a 𝑉𝑗
bound the probability of this event, we split it into two, one for the
(32)− (𝑍∥𝐾𝑖∥ 𝑗∥𝑁) and 𝑦 are equal and
event that the key part of 𝑉𝑗
a second one for the event that the remaining parts are equal. Let
(cid:12)(cid:12)(cid:12) 𝐸1
𝐸2( 𝑗, 𝑦) be the event that [𝑉𝑗]𝐾+ (32)− 𝐾𝑖 = [𝑦]𝐾+ and 𝐸3( 𝑗, 𝑦) be the
event that [𝑉𝑗]𝐾- (32)− (𝑍∥ 𝑗∥𝑁) = [𝑦]𝐾-. Then, using a union bound,
Pr(cid:104)Tideal ∈ Bad2
≤∑︁
(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12) 𝐸1
Pr(cid:104)𝐸2( 𝑗, 𝑦)(cid:12)(cid:12)(cid:12) 𝐸1 ∧ 𝐸3( 𝑗, 𝑦)(cid:105) · Pr(cid:104)𝐸3( 𝑗, 𝑦)(cid:12)(cid:12)(cid:12) 𝐸1
(cid:105) ≤ Pr
𝐸2( 𝑗, 𝑦) ∧ 𝐸3( 𝑗, 𝑦)
(cid:12)(cid:12)(cid:12) 𝐸1
∑︁
(cid:105) .

(11)
𝑦,𝑗
𝑦
𝑗
When querying Reveal, for any pair ( 𝑗, 𝑦), the probability that
[𝑉𝑗]𝐾+ (32)− 𝐾𝑖 = [𝑦]𝐾+ is the probability that when the key is sam-
pled 𝐾𝑖 = [𝑉𝑗]𝐾+ (32)− [𝑦]𝐾+. As the keys are uniformly sampled in
Reveal, and independently from any previous queries and param-
eters, this probability is 1
2𝑘 . This event is also independent from 𝐸1
and 𝐸3( 𝑗, 𝑦). Thus
= Pr[𝐸2( 𝑗, 𝑦)] =
1
2𝑘
.
(12)
Note that conditioned on event 𝐸1 there are strictly less than 𝑚1
values [𝑉𝑗]𝐾- (32)− (𝑍∥ 𝑗∥𝑁) that are equal to one [𝑦]𝐾-, thus for
a fix 𝑦, there are strictly less than 𝑚1 block indexes 𝑗 such that
Pr(cid:104)𝐸2( 𝑗, 𝑦)(cid:12)(cid:12)(cid:12) 𝐸1 ∧ 𝐸3( 𝑗, 𝑦)(cid:105)
Pr(cid:104)𝐸3( 𝑗, 𝑦)(cid:12)(cid:12)(cid:12) 𝐸1
(cid:105) is not zero. Thus
Pr(cid:104)𝐸3( 𝑗, 𝑦)(cid:12)(cid:12)(cid:12) 𝐸1
∑︁
∑︁
(cid:108)
<∑︁
(cid:109) ≤ 2(cid:108)
Pr[Tideal ∈ Bad2] ≤ 𝑝 · 2(𝑛 − 𝑘) 𝜎𝑒
2(𝑛−𝑘)
(cid:105)
𝑦
𝑦
𝑗
2𝑘
Moreover, 𝑚1 =
max(1,𝑛−𝑘−log2(2𝜎𝑒))
= 2(𝑛 − 𝑘) 𝜎𝑒 and in combination with (10), (11), (12), (13), we obtain
max(1,𝑛−𝑘−log2(𝜎𝑒+𝑞𝑒))
(𝑛−𝑘)
𝑚1 ≤ 𝑝 · 𝑚1.
(13)
(cid:109)
+ 1
2𝑛−𝑘
.
□
B.2.4 Bounding Bad3 transcripts probability.
Lemma B.4 (Bad3).
Pr[Tideal ∈ Bad3] ≤ 𝑞𝑒(𝑑 − 1)
.
2𝑘
Proof. Bad3 is the set of all attainable transcripts 𝜏 that con-
tain two entries (enc, 𝑖, 𝑁 , 𝐴𝐷, 𝑀, 𝐶∥𝑇 , 𝑉) and (enc, 𝑗, 𝑁 ′, 𝐴𝐷′, 𝑀′,
𝐶′∥𝑇 ′, 𝑉 ′) with 𝑁 = 𝑁 ′, 𝑖 ≠ 𝑗 and 𝐾𝑖 = 𝐾𝑗.
If a transcript generated by the adversary A in the ideal aug-
mented game is in Bad3, then this adversary A has made a pair
of encryption queries Enc(𝑖, 𝑁 , 𝐴𝐷, 𝑀) and Enc( 𝑗, 𝑁 ′, 𝐴𝐷′, 𝑀′)
with 𝑁 = 𝑁 ′ and 𝑖 ≠ 𝑗, and a query to Reveal that returned the
two corresponding 𝐾𝑖 and 𝐾𝑗 being equal. Hence the probability
that a transcript generated by A in the ideal augmented game is in
Bad3 is bounded by the probability that A makes the previously
described queries.
We are again going to consider the case where A is just about
to query Reveal, but has already made all its other oracle queries.
For each of the at most 𝑞𝑒 encryption queries Enc(𝑖, 𝑁 , 𝐴𝐷, 𝑀)
done by A, there are at most 𝑑 − 1 other encryption queries
Enc( 𝑗, 𝑁 ′, 𝐴𝐷′, 𝑀′) with 𝑁 = 𝑁 ′ and 𝑖 ≠ 𝑗 done by A. Thus there
are at most 𝑞𝑒(𝑑 − 1), possible pairs of such encryption queries
done by A. When querying Reveal, for each of these pairs, the
probability that 𝐾𝑖 = 𝐾𝑗 is 1
2𝑘 , as the keys are uniformly sampled,
independently from any previous queries. Hence, using a union
Session 6D: Authentication and Privacy CCS ’21, November 15–19, 2021, Virtual Event, Republic of Korea1997bound, the probability that for at least one of these pairs 𝐾𝑖 = 𝐾𝑗,
is at most 𝑞𝑒 (𝑑−1)
2𝑘
. Thus,
Pr[Tideal ∈ Bad3] ≤ 𝑞𝑒(𝑑 − 1)
2𝑘
.
□
B.2.5 Bounding Bad4 transcripts probability.
Lemma B.5 (Bad4).
Pr[Tideal ∈ Bad4] ≤ (𝜎𝑒 + 𝑞𝑒)2
2𝑛+1
.
𝑡
Proof. Bad4 is the set of all attainable transcripts 𝜏 that contain
(32)− (𝑍∥𝐾𝑖∥𝑠∥𝑁) = 𝑉 ′
0 ∥ · · · ∥𝑉 ′
(32)−(𝑍∥𝐾𝑖∥𝑠∥𝑁) = 𝑉 ′
two entries (enc, 𝑖, 𝑁 , 𝐴𝐷, 𝑀, 𝐶∥𝑇 , 𝑉0∥ · · · ∥𝑉ℓ) and
(enc, 𝑗, 𝑁 ′, 𝐴𝐷′, 𝑀′, 𝐶′∥𝑇 ′, 𝑉 ′
ℓ′) such that (𝐾𝑖, 𝑠, 𝑁) ≠
(32)−(𝑍∥𝐾𝑗 ∥𝑡∥𝑁 ′) for 0 ≤ 𝑠 ≤ ℓ
(𝐾𝑗 , 𝑡, 𝑁 ′) and 𝑉𝑠
and 0 ≤ 𝑡 ≤ ℓ′.
If a transcript generated by the adversary A in the ideal aug-
mented game is in Bad4, then A has made a Reveal query that
(32)− (𝑍∥𝐾𝑗 ∥𝑡∥𝑁 ′).
returned values verifying 𝑉𝑠
As established above, the 𝑉𝑗 values are all independent and uni-
formly distributed. Moreover, the keys 𝐾𝑖 are also independent and
uniformly distributed. Hence, for each encryption query
Enc(𝑖, 𝑁 , 𝐴𝐷, 𝑀1∥ · · · ∥𝑀ℓ), the ℓ values 𝑉0 (32)− (𝑍∥𝐾𝑖∥0∥𝑁), · · · ,
(32)− (𝑍∥𝐾𝑖∥ℓ∥𝑁) are also independent and uniformly distributed.
𝑉ℓ
If we consider all encryption queries, we obtain at most 𝜎𝑒 + 𝑞𝑒
independent and uniformly distributed values, and the probability
that at least two of them are equal is at most the birthday bound,
i.e., (𝜎𝑒+𝑞𝑒)2
2𝑛+1
. Thus,
𝑡
Pr[Tideal ∈ Bad4] ≤ (𝜎𝑒 + 𝑞𝑒)2
2𝑛+1
.
□
B.2.6 Bounding Bad5 transcripts probability.
Lemma B.6 (Bad5).
Pr[Tideal ∈ Bad5] ≤ 𝑞𝑣 · 2(cid:16)(𝑛 − 𝑘) 𝑝 + 2𝑡 𝑝(cid:17)
2𝑘
+
1
2𝑛−𝑘−1 +
1
22𝑡−1 .
Proof. Bad5 is the set of all attainable transcripts 𝜏 that contain
two entries (vf, 𝑖, 𝑁 , 𝐴𝐷, 𝐶∥𝑇 , false) and (prim, 𝑥, 𝑦, ·) such that 𝑥 =
(𝑍∥𝐾𝑖∥0∥𝑁) and ∃𝑟 ∈ {0, 1}𝑡 ,𝑊 ∈ {0, 1}𝑛−2𝑡 such that 𝑦
(32)+ 𝑥 =
(𝑟∥(𝑇 (𝑡)− 𝐻𝑟 (𝐴𝐷, 𝐶))∥𝑊 ).
The probability calculation for this case will follow the same
outline as for Bad2.
Let 𝐸4 be the event that there exist 𝑤 ∈ {0, 1}𝑛−𝑘, such that the
number of inverse ideal permutation queries verifying [𝑥]𝐾- = 𝑤,
is greater or equal to 𝑚4 =
event that there exist 𝐴𝐷∗, 𝐶∗ ∈ {0, 1}∗ and 𝑇∗, 𝑟∗ ∈ {0, 1}𝑡 such
that, the number of forward ideal permutation queries verifying
[𝑦
(32)+ 𝑥]𝑟 , is greater or equal
(cid:109) and 𝐸5 be the
(32)+ 𝑥]𝑠 (𝑡)+𝐻𝑟∗(𝐴𝐷∗, 𝐶∗) = 𝑇∗ and 𝑟∗ = [𝑦
max(1,𝑛−𝑘−1−log2(𝑝))
2(𝑛−𝑘−1)
(cid:108)
(cid:108)
2·(2𝑡−1)
to 𝑚5 =
max(1,2𝑡−1−log2(𝑝))
(cid:109). Then, in a similar way as for Bad2,
(cid:105)
Pr[Tideal ∈ Bad5] = Pr(cid:104)Tideal ∈ Bad5 ∧ 𝐸4 ∧ 𝐸5
+ Pr(cid:104)Tideal ∈ Bad5 ∧ 𝐸4 ∧ 𝐸5
(cid:105)
(cid:12)(cid:12)(cid:12) 𝐸4 ∧ 𝐸5
(cid:105) + Pr[𝐸4 ∨ 𝐸5]
(cid:12)(cid:12)(cid:12) 𝐸4 ∧ 𝐸5
(cid:105) + Pr[𝐸4] + Pr[𝐸5].
≤ Pr(cid:104)Tideal ∈ Bad5
≤ Pr(cid:104)Tideal ∈ Bad5
(14)
We will again bound the probability of 𝐸4 and 𝐸5, leaving us after-
ward with event Tideal ∈ Bad5 conditioned by 𝐸4 ∧ 𝐸5.
We can view each inverse ideal permutation query Prim−1(𝑦)
with answer 𝑥 as throwing a ball [𝑥]𝐾- into one of 2𝑛−𝑘 possible
2𝑛−𝑝 ≤
bins, with probability at most
2𝑘
2𝑛−𝑘−1 . Thus if we consider all inverse ideal permutation
2𝑛−1 =
queries, we throw at most 𝑝 balls with conditional probability at
most 2−(𝑛−𝑘−1) into 2𝑛−𝑘 bins. Using Lemma B.1, with 𝑄 = 𝑝 and
𝐵 = 2−(𝑛−𝑘−1), the probability that the heaviest bin contains 𝑚4 or
more balls is at most 2−(𝑛−𝑘−1). Therefore, the probability of 𝐸4 is
bounded by 2−(𝑛−𝑘−1):