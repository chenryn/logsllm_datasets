The "Permissions" set here are as follows. (Although recording file read enables a more detailed
investigation, it is excluded as doing so will increase the amount of logs.)
 Create files / write data
 Create folders / append data
 Write attributes
 Write extended attributes
 Delete subfolders and files
 Delete
 Change permissions
 Take ownership
Although configuring the above settings displays many errors as shown below, select "Continue."
76
8. Appendix B
This list describes logs recorded by default and other logs recorded by configuring additional settings, including audit policy settings and installation of Sysmon.
The list only contains selected logs that can be used for incident investigation out of all logs that can be acquired.
Acquirable Log
Target
Log How to Obtain Required Setting Identifier Event Name Overview Main Information That Can Be Acquired
104 The System log file was cleared Clearing of logs -The cleared log channel
The [Service Name] service entered the A change of the service state -Service name
7036
[Status] state (the same ID for execution and stop) -State
Security
-Service name
-Executable file name
7045 A service was installed in the system Installation of a service -Service type
-Startup type
Recorded by default Windows settings
-Service account
-Device instance ID
20001 Device Installation Installation of a device driver -Driver name
-Success or failure
-Account name, domain
System
-UUID of a shadow copy
8222 Shadow copy has been created Creation of a shadow copy -Computer name
-Source of a shadow copy
-Created shadow device name
-Security ID
-Account name, domain
-Logon ID
Used for association with other event logs
-Logon type
The main logon types include 2 = Local
Interactive, 3 = Network, and 10 =
4624 An account was successfully logged on Account logon Remote Interactive
-Process ID
-Process name
-Login source: Workstation name, source
network address,
source port
-Authentication method: Authentication
package
-Security ID
Logon/Logoff
-Account name, domain
>Auditing of Logon 4634 An account was logged off Account logoff
-Logon ID
-Logon type
-Executing account information: Subject:
-Security ID
-Account name, domain
-Logon ID
-Account whose credentials were used
-Account name, domain
A logon was attempted using explicit A specified logon attempt by a -Target server
4648
credentials particular account -Target server name
-Process information
-Process ID
-Process name
-Network information
-Network address
-Port
-Account name, domain
-Handle object: Object name
A handle request for reading or -Handle ID
4656 A handle to an object was requested
writing an object Used for association with other event logs
-Process ID
-Process name
Object access -Account name, domain
>Auditing of handle Ending the use of and releasing of a -Handle ID
4658 The handle to an object was closed
operations handle -Process ID
-Process name
-Account name, domain
-Source handle ID
An attempt was made to duplicate a Duplication of an existing handle for
4690 -Source process ID
handle to an object use in other processes
-Source handle ID
-Source process ID
-Account name, domain
-Handle ID
4660 An object was deleted Deleting an object
-Process ID
-Process name
-Account name, domain
Common to All Windows Log
Object access -Logon ID
-Object name
File System,"An attempt was made to
4663 Access made to an object -Handle ID
access an object
-Process name
-Process ID
-Requested processing
Enable each audit. Auditing of a -Account name, domain
file system additionally requires A handle request to SAM -Handle object: Object name
Security
SACL settings. Each log is Object access (Acquirable information -Handle ID
(audit policy) 4661 A handle to an object was requested
saved in "Windows Log > >Auditing of SAM is the same as that of Used for association with other event logs
Security". the event 4656) -Process ID
-Process name
-Security ID
Assignment of special privileges to a -Executing account name, domain
4672 Special privileges assigned to new logon
particular logon instance -Logon ID
-Assigned special privileges
-Security ID
Use of special privileges
-Account name, domain
Execution of a process requiring -Service name
4673 A privileged service was called
particular privileges -Process ID
-Process name
-Used privileges
-Account name, domain
-Process ID
Detailed tracking
-Process name
>Auditing of process 4688 A new process has been created Startup of a process
-Presence of privilege escalation: Token
creation
escalation type
-Parent process ID: Creator process ID
-Account name, domain
Detailed tracking
-Process ID
>Auditing of process 4689 A process has exited Process termination
-Process name
termination
-Return value: Exit status
-Executing account information: Subject:
-Security ID
-Account name, domain
-Logon ID
4720 A user account was created Account creation -Information on the account to be added: New
account:
-Security ID
Account management -Account name, domain
>Auditing of user account -Other attribute information
management -Executing account information: Subject:
-Security ID
-Account name, domain
-Logon ID
4726 A user account was deleted Account deletion
-Information on the account to be deleted:
Target account:
-Security ID
-Account name, domain
77
Acquirable Log
Target
Log How to Obtain Required Setting Identifier Event Name Overview Main Information That Can Be Acquired
-Executing account information: Subject
-Security ID
-Account name, domain
-Logon ID
Addition of a member to a group -Target user: Member
A member was added to a security-
4728 (used when a member has been -Security ID
enabled global group
added to a group on the domain) -Account name
-Target group: Group
-Security ID
Account management -Group name
>Auditing of security group -Group domain
-Executing account information: Subject
management
-Security ID
-Account name, domain
-Logon ID
Removal of a member from a group
-Target user: Member
A member was removed from a security- (used when a member has been
4729 -Security ID
enabled global group removed from a group on the
-Account name
domain)
-Target group: Group
-Security ID
-Group name
-Group domain
-Account name, domain
Account Logon -Security ID
A Kerberos authentication ticket (TGT) An authentication request for an
>Auditing of the Kerberos 4768 -Source address, source port
was requested account
authentication service -Ticket option
-Return value
-Account name, domain, logon ID
Account logon
An access authentication request for -Service name, service ID
>Auditing of Kerberos 4769 A Kerberos service ticket was requested
an account -Client address, port
service ticket operations
-Ticket option
Policy change
>Auditing of a change in A change was made to the Windows -Profile
4946 Addition of a Windows Firewall rule
the MPSSVC rule level Firewall exception list. A rule was added. -Target rule name
policy
-Security ID
-Account name, domain
-Logon ID
5140 A network share object was accessed Access to network share -Source address, source port
-Share name
-Share path
-Requested process
Windows Log Security Object access
-Security ID
(Continued (audit policy) >Auditing of file sharing
ditto -Account name, domain
from the (Continued from the 5142 A network share object was added Creation of a new network share
-Share name
previous entry) previous entry)
-Share path
-Security ID
-Account name, domain
5144 A network share object was deleted Deletion of a network share
-Share name
-Share path
Common to All -Security ID
(Continued -Account name, domain
Object access A network share object was checked to
from the Confirmation of whether a file share -Logon ID
>Detailed auditing of file 5145 see whether client can be granted desired
previous entry) point can be used -Source address, source port
sharing access
-Share name
-Share path, relative target name
-Process ID
The Windows Filtering Platform has
Port listening by an application or -Process name
5154 permitted an application or service to
service -Address, port
listen on a port for incoming connections
-Protocol number
Object access
-Process ID
>Auditing of Filtering Whether a connection is allowed by
-Process name
Platform connections the Windows Filtering Platform
The Windows Filtering Platform has -Direction (outbound, inbound)
5156 (Windows Firewall)
permitted a connection -Source address, source port
(if rejected, a different Event ID
-Destination address, destination port
(5152) will be recorded)
-Protocol number
-Process start date and time: UtcTime
-Process command line: CommandLine
The option passed to the executable file
is recorded.
1 Process Create Startup of a process If an IP address or user name of another
host is specified in the option, it is possible
Application and service log
Downloaded from the Microsoft to read it from here.
>Microsoft
website -User name: User
Sysmon >Windows
https://technet.microsoft.com/en -Process ID: ProcessId
>Sysmon
-us/sysinternals/bb842062.aspx -Process end date and time: UtcTime
>Operational 5 Process Terminated Process termination
-Process ID: ProcessId
-Thread creation date and time: UtcTime
-Caller process ID: SourceProcessId
Creating a new thread from another
8 CreateRemoteThread detected -Caller process name: SourceImage
process
-Callee process ID: TargetProcessId
-Callee process name: TargetImage
-Executing account name, domain
106 Task registered Registration of a new task
-Created task name
-Task name
200 Action started Execution of a task
Application and -Executed operation
Microsoft -Task name
Service
>Windows 129 Created Task Process Process executing in a task -Process ID
at
>TaskScheduler -Executed process
>Operational -Task name
Termination of a process executed in
201 Action completed -Terminated process
a task
-Return value
-Executing account name, domain
102 Task completed Termination of a task
-Task name
Recorded by default Windows settings
Microsoft > Windows 6 Creating WSMan Session Creation of a new session -Destination host name
WinRM / >Windows Remote
WinRS Management >
User authentication： authenticated User authentication： authenticated
Operational 169 -User name, domain
successfully successfully
-Session connection start date and time
Microsoft > Windows Remote Desktop Services: Session logon
21 New logon via RDP -Executing account name, domain
>TerminalServices succeeded
-Source network address
RDP >
-Session connection start date and time
LocalSessionManage Remote Desktop Services: Session has
24 Disconnection of an RDP session -Executing account name, domain
r > Operational been disconnected
-Source network address
78
Detecting Lateral Movement through Tracking Event Logs
Index
A N
AT ........................................................................... 23 net share ................................................................. 59
net use ..................................................................... 58
B
net user ................................................................... 57
BeginX .................................................................... 18 ntdsutil ..................................................................... 55
BITS ........................................................................ 25
P
C
PowerShell .............................................................. 14
csvde ...................................................................... 64 PsExec .................................................................... 11
PWDump7 ............................................................... 26
D
PWDumpX ............................................................... 27
dsquery ................................................................... 67
Q
F
Quarks PwDump ..................................................... 29
Fake wpad .............................................................. 40
R
Find-GPOPasswords.ps1 ....................................... 35
RDP ......................................................................... 42
G
Remote Desktop PassView ..................................... 38
gsecdump ............................................................... 33
S
H
SDB UAC Bypass .................................................... 48
Htran ....................................................................... 39 sdelete ..................................................................... 61
I T
icacls ....................................................................... 60 timestomp ................................................................ 62
L V
ldifde ....................................................................... 66 vssadmin ................................................................. 56
lslsass ..................................................................... 34
W
M
WCE .................................................................. 32, 43
Mail PassView......................................................... 36 WebBrowserPassView ............................................ 37
Mimikatz .......................................... 30, 31, 45, 52, 54 wevtutil .................................................................... 63
MS14-058 Exploit ................................................... 46 WinRM ..................................................................... 19
MS14-068 Exploit ................................................... 50 WinRS ..................................................................... 21
MS15-078 Exploit ................................................... 47 wmic ........................................................................ 13
wmiexec.vbs ............................................................ 16
79
JPCERT/CC will not be liable for any loss or damage that may arise from any information
contained in this document.
80