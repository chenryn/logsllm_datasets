great help in obtaining 
ent threats. 
tual information 
to the different 
the modus operandi 
Finally, 
a better 
we underline 
understanding 
of the differ­
the value of the contex­
mal ware groups and acquire 
of the mal ware writers. 
insights 
about 
observed 
in the SGNET dataset 
for a certain 
on mal ware propagation 
to add semantics 
Phase 4: pattern-based 
classification 
4. Results 
patterns 
discovered 
all the attack instances 
and group them into clusters. 
During this phase, the previously 
are 
used to classify 
present in the 
pat­
SGNET dataset 
Multiple 
For example, 
terns could match the same instance: 
the in­
stance 1,2,3 would be matched by both the pattern 
*,2,3 
and the pattern 
with the most specific 
All the instances 
belong to the same EPM cluster. 
pattern 
associated 
*, *, 3. Each instance 
to the same pattern 
its feature 
matching 
are said to 
values. 
is always associated 
For this work, we analyzed 
all information 
that was col­
in the period from Jan­
the deployment 
5165 of which 
lected by our SGNET deployment 
uary 2008 to May 2009. During this period, 
collected 
a total of 6353 mal ware samples, 
could be correctly 
consistent 
due to failures 
the collected  samples, 
rupted, 
and, as a consequence, 
namic analysis 
with the information 
in Nepenthes 
unfortunately, 
executed 
reported 
system. 
download modules, 
some of 
are truncated 
or cor­
cannot be analyzed 
by a dy­
in the Anubis sandbox. 
This is 
in [7]. Note that 
3.3.  Clustering 
using static  and 
behavioral 
features 
4.1. The big picture 
The EPM classification 
technique 
described 
By running the EPM classification 
technique 
described 
in Section 
the interre­
and the re­
injected 
mal ware. By looking 
between exploits, 
a fast and simple tool to explore 
payloads 
independently 
3.2 provides 
lationships 
sulting 
code and malware features, 
to group attack events into clusters. 
we will refer in the rest of the paper to E-clusters, 
P-clusters 
and M-clusters 
the same 
classification 
(E), payload (P) and 
pattern 
mal ware (M) dimension 
shell­
the EPM classification 
at exploit, 
allows us 
For the sake of clarity, 
all the groups sharing 
respectively. 
over the exploit 
to identify 
and 260 M-clusters 
3.2, we have discovered 
in Section 
27 P-clusters 
number of groups. The analysis 
teristics 
B-clusters. 
corresponding 
to the same 
of the behavioral 
charac­
of the 5165 samples led to the generation 
of 972 
a total of 39 E-clusters, 
Figure 3 graphically 
represents 
E-, P-, M-and B-clusters. 
Starting 
first layer of groups corresponds 
to the payloads, 
from top to bottom, 
the 
to the exploits, 
the second 
the third to the mal ware grouped according 
the relationships between 
978-1-4244-7501-8/101$26.00 
©2010 IEEE 
397 
DSN 2010: Leita et al. 
Authorized licensed use limited to: Tsinghua University. Downloaded on March 18,2021 at 14:00:10 UTC from IEEE Xplore.  Restrictions apply. 
2010 IEEE/IFIP International 
Conference 
on Dependable 
Systems & Networks (DSN) 
E-clusters 
P-clusters 
M-clusters 
B-clusters 
Figure 3. EPM relationships 
in the SGNET dataset and their comparison to B-clusters 
and the last one to mal ware grouped 
These problems 
information, 
to its behavior. 
to static 
according 
have represented 
grouping 
fore a simplified, 
can identify 
together 
Because of space limitations, 
we 
here only the E-, P-, M-, and B-clusters 
at least 30 attack events. 
yet, representative 
view of the reality. 
Figure 3 is there­
We 
are potentially 
very difficult 
we show how the combination 
to identify. 
of clustering 
and dynamic information 
based on both static 
in systematically 
identifying 
and filtering 
out 
In this section, 
approaches 
can be helpful 
clustering 
anomalies. 
a set of interesting 
facts: 
When going into the details 
of the relationships 
between 
• The number of exploit/payload 
combinations 
is low 
with respect 
Most malware variants 
exploitation 
to the number of different 
seem to be sharing 
routines 
for their propagation. 
M-clusters. 
few distinct 
• The same payload (P-cluster) 
(E-clusters). 
tiple exploits 
can be associated 
to mul­
• The number of B-clusters 
is lower than the number of 
M-clusters. 
to variations of 
very similar 
behavior. 
Some M-clusters 
are likely to correspond 
the same codebase, 
and, thus, maintain 
(details 
that do not appear in Fig­
we discovered 
a large 
choice), 
and B-clusters 
M-clusters 
ure 3 because of the filtering 
number ofB-clusters 
composed 
860 B-clusters 
sample and are associated 
SGNET dataset. 
of a single malware sample. 
out of 972 are composed of a single malware 
to a single attack instance 
in the 
we can identify 
these size-l B-clusters 
having a 1-1 association 
Comparing 
M-clusters, 
cluster 
These cases are likely to be associated 
ware samples whose infection 
deployment 
number of times. 
a very limited 
was observed 
with the associated 
a small number of size-l B­
with a static M-cluster. 
to infrequent 
mal­
by the SGNET 
In the following  section, 
we dig deeper into some of the 
dif­
the value 
of considering 
identified 
ferent standpoints. 
relations 
to underline 
4.2. Clustering anomalies 
In most of the other cases, instead, 
to larger M-clusters, 
larger 
profiles 
B-cluster. 
of the samples affected by this anomaly, 
By manually 
mostly associated 
to at 
at the 
looking 
the size-l B-clusters 
are associated 
least another, 
behavioral 
we could not discern 
havior of the larger 
have been incorrectly 
to be associated 
techniques 
(single 
bis clustering 
linkage 
[4]. 
substantial 
differences 
from the be­
B-cluster. 
We believe 
a bias in clustering 
these clusters 
likely 
to 
clustered, 
to the employment 
of supervised 
in Anu­
clustering) 
hierarchical 
clustering 
Clustering 
techniques 
relying 
on behavioral 
to misclassification 
due to anomalies 
features 
are 
of these features. 
in the behavioral 
On the one hand, the 
profiles of some 
known to be subject 
in the extraction 
amount of variability 
samples and their interaction 
lead to clustering 
behavior 
ability 
misclassifications. 
may be affected by 
of C&C servers) 
artifacts. 
This is corroborated 
by other information 
available 
in the 
on the names 
with clustering 
thresholds 
On the other hand, the sample 
external 
avail­
conditions 
(e.g., 
may 
that affect its profile and can lead to 
to these misclassified 
Figure 4 shows information 
SGNET dataset: 
assigned 
vendor (top), 
the SGNET dataset 
Most of the samples are classified 
samples by a popular AV 
in 
in terms of EP coordinates 
and on the propagation 
strategy 
as being different 
observed 
vari-
(bottom). 
978-1-4244-7501-8/101$26.00 
©2010 IEEE 
398 
DSN 2010: Leita et al. 
Authorized licensed use limited to: Tsinghua University. Downloaded on March 18,2021 at 14:00:10 UTC from IEEE Xplore.  Restrictions apply. 
2010 IEEE/IFIP International 
Conference 
on Dependable 
Systems & Networks (DSN) 
MD5=' *' , size=59904, 
type='MS-DOS executable PE for 
MS Windows (GUI) Intel 
80386 32-bit', 
machinetype=332, 
nsections=3, 
ndlls=l, 
osversion=64, 
linkerversion=92, 
sectionnames='.text\xOO\xOO\xOO, 
rdata\xOO\xOO\xOO, 
.data\xOO\xOO\xOO' 
importeddll='KERNEL32.dll' , 
kerne132symbols='GetProcAddress, 
LoadLibraryA' 
E=48,P=45 
 .... 
the MD5 hash is associated to 
therefore, 
say that the cluster 
features 
a "do not care" field), we can, 
is rather specific. 
(only 
Seeing the rather 
large number of invariant 
mal ware sample from this type 
of misclassification. 
to be executed. 
Among the different 
behav­
. -  
others 
Figure 4. Characteristics 
of the size-1 clus­
ters. On the top, AV names associated to the 
malware samples by a popular AV vendor. On 
the bottom, propagation 
samples in terms of combination of E and P 
clusters. 
strategy used by the 
ants of the Rahack worm (also known as Allaple), 
been all pushed with a very specific 
This P-pattern 
in which the attacker 
on a specific 
these samples seem to be highly related. 
download, 
the sample 
port, TCP port 9988. For all these reasons, 
P-pattern, 
by a PUSH-based 
forces the victim to receive 
and have 
45. 
is characterized 
P-pattern 
all 
This anomalous 
to detect by looking 
been possible 
specific 
condition 
solely at B-clusters: 
uniquely 
behaviors 
to discern 
it would not have 
associated 
to a 
would have been impossible 
We have also detected 
more subtle clustering 
anomalies 
by changes in the context 
M-cluster 
generated 
cution. For instance, 
ware associated 
is characterized 
and even by specific 
possible 
to see by looking 
to several 
by a very specific 
of the mal ware exe­
mal­
13 is a polymorphic 
different 
B-clusters. 
The cluster 
size, number of sections, 
This cluster 
is peculiar 
for the amount of similarities, 
by AV vendors as Allaple/Rahack. 
in the M dimension 
differ­
size, linker version 
is slightly 
in 
In both cases, the samples are poly­
and differences 
with the behavior 
normally 
associated 
worm. Looking at the EPM classifica­
shares the same propagation 
vector as 
symbols. 
and yet differences, 
with the Allaple 
tion, this M-cluster 
the samples  classified 
The associated 
pattern 
ent though: different 
the Kernel32 
morphic: 
Interestingly, 
ing to the SGNET data, Allaple 
attack instance, 
cluster 
address 
ple times in multiple 
attacking 
of the relevance 
is not chosen as a relevant 
constraints 
the polymorphic 
feature. 
mutates 
its content 
to the M­
while malware samples belonging 
according 
to the IP 
The same MD5 hash appears 
13 seem to mutate their content 
of the attacker. 
at each 
multi­
source towards multiple 
attack instances 
generated 
honeypots, 
by the same 
but because 
3.2, the hash 
defined in Section 
the MD5 is not an invariant 
of the cluster. 
feature 
is different:  accord­
pattern 
Looking manually 
at the different 
behavioral 
reports 
for 
we see that a number of 
clusters, 
behavior 
Upon execution, 
and download from that domain additional 
because of environmen­
they try to resolve 
the name 
is characterized 
by the download 
components 
from the mal­
site, while another 
download 
leads to the connection 
cluster 
of a single component. 
In both 
to an IRC server, 
is characterized 
one cluster 
of two separate 
some of the behavioral 
samples exhibit 
different 
tal conditions. 
"iliketay.cn", 
components 
ioral clusters, 
and execution 
ware distribution 
by the successful 
cases, the activity 
that provides 
load additional 
behavioral 
tay.cn" 
cluster, 
names for the different 
sections 
as it is 
commands instructing 
the process 
to down­
at the pattern 
invariant 
features: 
code from other web servers. 
In a different 
is unsuccessful: 
the entry was probably 
the DNS resolution 
for the name "ilike­
removed 
978-1-4244-7501-8/10/$26.00 
©2010 IEEE 
399 
DSN 2010: Leita et al. 
Authorized licensed use limited to: Tsinghua University. Downloaded on March 18,2021 at 14:00:10 UTC from IEEE Xplore.  Restrictions apply. 
20lO IEEEIIFIP International 
Conference 
on Dependable 
Systems & Networks (DSN) 
is a self-propagating 
(MS04-
and gen­
hosts over the 
to its victims, 
of the infected 
the distribution 
infection 
and improve­
over most of the IP space. The specific 
composed 
is indeed a cluster 
Allaple 
ASN.l vulnerability 
infect HTML files present 
against 
The analysis 
of several 
variants. 
the Microsoft 
of the Allaple 
modifications 
code [24], but due to the lack of a 
channel, 
Nevertheless, 
IP space, as shown in Figure 5, is very similar 
erally widespread 
case taken into consideration 
Allaple 
of multiple 
worm exploiting 
007) to propagate 
on the local system and carry on simple DoS attacks 
specific targets. 
re­
vealed the existance 
ments to the original 
Command & Control 
capability. 
sions and patches 
Internet. 
generation 
100 different 
static 
factors 
the polymorphic 
nary content 
without 
the SGNET dataset 
the same B-clusters, 
sizes. In some cases, the different 
ent linker 
versions 
modifying 
a variety 
but characterized 
codebase 
coexist 
modifications 
they generate 
of the original 
While all these different 
clusters. 
among the different 
versions, 
of the compiler. 
the size, we can detect in 
all linked to 
ver­
on the 
the 
of M-clusters, 
by the different 
of two different 
used by Allaple 
B-clusters, 
hosts infected 
Therefore, 
also have differ­
by different 
modifies the bi­
variants 
lead to 
routine 
almost 
binary 
suggesting recompilations 
with different 
One of the main differentiation 