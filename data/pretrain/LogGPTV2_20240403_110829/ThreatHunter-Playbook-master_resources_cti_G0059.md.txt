# G0059: Magic Hound

## Description
[Magic Hound](https://attack.mitre.org/groups/G0059) is an Iranian-sponsored threat group that has been active since at least 2014. The group primarily targets organizations in the energy, government, and technology sectors, with a focus on entities based in or having business interests in Saudi Arabia. (Citation: Unit 42 Magic Hound Feb 2017)(Citation: FireEye APT35 2018)

## Tactics, Techniques, and Procedures (TTPs)
The following table outlines the TTPs employed by Magic Hound, categorized by platform, tactic, technique, description, and data sources.

| Platform | Tactic | Technique | Description | Data Sources |
| --- | --- | --- | --- | --- |
| Windows, Office 365, Azure, GCP, Azure AD, AWS | Credential Access, Persistence | [Account Manipulation](https://attack.mitre.org/techniques/T1098/) | Magic Hound granted compromised email accounts read access to the email boxes of additional targeted accounts. This allowed them to authenticate to the victim's OWA (Outlook Web Access) portal and read hundreds of emails for information on Middle East organizations. | Authentication logs, API monitoring, Windows event logs, Packet capture |
| macOS, Windows | Defense Evasion | [Hidden Window](https://attack.mitre.org/techniques/T1143/) | Magic Hound malware includes a function to determine whether the C2 server wishes to execute the newly dropped file in a hidden window. | Windows event logs, PowerShell logs, Process command-line parameters, Process monitoring, File monitoring |
| Linux, Windows, macOS | Exfiltration | [Data Compressed](https://attack.mitre.org/techniques/T1002/) | Magic Hound used RAR to stage and compress local folders. | Binary file metadata, File monitoring, Process command-line parameters, Process monitoring |
| Windows, Office 365 | Collection | [Email Collection](https://attack.mitre.org/techniques/T1114/) | Magic Hound collected .PST archives. | Office 365 trace logs, Mail server, Email gateway, Authentication logs, File monitoring, Process monitoring, Process use of network |
| Windows, Linux, macOS | Credential Access | [Credential Dumping](https://attack.mitre.org/techniques/T1003/) | Magic Hound stole domain credentials from Microsoft Active Directory Domain Controllers and leveraged [Mimikatz](https://attack.mitre.org/software/S0002). | API monitoring, Process monitoring, PowerShell logs, Process command-line parameters |
| Windows, macOS, Linux | Initial Access | [Spearphishing via Service](https://attack.mitre.org/techniques/T1194/) | Magic Hound used various social media channels to spearphish victims. | SSL/TLS inspection, Anti-virus, Web proxy |
| Linux, Windows, macOS | Execution | [User Execution](https://attack.mitre.org/techniques/T1204/) | Magic Hound attempted to get users to execute malware via social media and spearphishing emails. | Anti-virus, Process command-line parameters, Process monitoring |
| Windows, macOS, Linux | Initial Access | [Spearphishing Attachment](https://attack.mitre.org/techniques/T1193/) | Magic Hound sent malicious attachments to victims over email, including an Excel spreadsheet containing macros to download Pupy. | File monitoring, Packet capture, Network intrusion detection system, Detonation chamber, Email gateway, Mail server |
| Windows, macOS, Linux, Office 365, SaaS | Initial Access | [Spearphishing Link](https://attack.mitre.org/techniques/T1192/) | Magic Hound sent shortened URL links over email to victims. The URLs linked to Word documents with malicious macros that executed PowerShell scripts to download Pupy. | Packet capture, Web proxy, Email gateway, Detonation chamber, SSL/TLS inspection, DNS records, Mail server |
| Linux, macOS, Windows | Command and Control | [Commonly Used Port](https://attack.mitre.org/techniques/T1043/) | Magic Hound malware communicated with C2 servers over port 6667 (for IRC) and port 8080. | Packet capture, Netflow/Enclave netflow, Process use of network, Process monitoring |
| Linux, macOS, Windows | Discovery | [System Owner/User Discovery](https://attack.mitre.org/techniques/T1033/) | Magic Hound malware obtained the victim username and sent it to the C2 server. | File monitoring, Process monitoring, Process command-line parameters |
| Linux, macOS, Windows, AWS, GCP, Azure | Discovery | [System Information Discovery](https://attack.mitre.org/techniques/T1082/) | Magic Hound malware used a PowerShell command to check the victim system architecture to determine if it is an x64 machine. Other malware obtained the OS version, UUID, and computer/host name to send to the C2 server. | Azure activity logs, Stackdriver logs, AWS CloudTrail logs, Process monitoring, Process command-line parameters |
| Linux, macOS, Windows | Command and Control | [Uncommonly Used Port](https://attack.mitre.org/techniques/T1065/) | Magic Hound malware communicated with its C2 server over ports 4443 and 3543. | Netflow/Enclave netflow, Process use of network, Process monitoring |
| Linux, macOS, Windows | Command and Control, Lateral Movement | [Remote File Copy](https://attack.mitre.org/techniques/T1105/) | Magic Hound downloaded additional code and files from servers onto victims. | File monitoring, Packet capture, Process use of network, Netflow/Enclave netflow, Network protocol analysis, Process monitoring |
| Windows | Execution | [PowerShell](https://attack.mitre.org/techniques/T1086/) | Magic Hound used PowerShell for execution and privilege escalation. | PowerShell logs, Loaded DLLs, DLL monitoring, Windows Registry, File monitoring, Process monitoring, Process command-line parameters |
| Linux, macOS, Windows | Command and Control | [Standard Application Layer Protocol](https://attack.mitre.org/techniques/T1071/) | Magic Hound malware used HTTP and IRC for C2. | Packet capture, Netflow/Enclave netflow, Process use of network, Malware reverse engineering, Process monitoring |
| Linux, macOS, Windows | Defense Evasion, Execution | [Scripting](https://attack.mitre.org/techniques/T1064/) | Magic Hound malware used .vbs scripts for execution. | Process monitoring, File monitoring, Process command-line parameters |
| Linux, macOS, Windows | Discovery | [System Network Configuration Discovery](https://attack.mitre.org/techniques/T1016/) | Magic Hound malware gathered the victim's local IP address, MAC address, and external IP address. | Process monitoring, Process command-line parameters |
| Linux, macOS, Windows | Discovery | [File and Directory Discovery](https://attack.mitre.org/techniques/T1083/) | Magic Hound malware can list a victim's logical drives and their type, as well as the total/free space of fixed devices. Other malware can list a directory's contents. | File monitoring, Process monitoring, Process command-line parameters |
| Linux, macOS, Windows | Execution | [Command-Line Interface](https://attack.mitre.org/techniques/T1059/) | Magic Hound used the command-line interface. | Process monitoring, Process command-line parameters |
| Linux, macOS, Windows | Defense Evasion | [File Deletion](https://attack.mitre.org/techniques/T1107/) | Magic Hound deleted and overwrote files to cover tracks. | File monitoring, Process command-line parameters, Binary file metadata |
| Linux, macOS, Windows | Collection | [Screen Capture](https://attack.mitre.org/techniques/T1113/) | Magic Hound malware can take a screenshot and upload the file to its C2 server. | API monitoring, Process monitoring, File monitoring |
| Linux, macOS, Windows | Defense Evasion | [Obfuscated Files or Information](https://attack.mitre.org/techniques/T1027/) | Magic Hound malware used base64-encoded commands and files, and also encrypted embedded strings with AES. | Network protocol analysis, Process use of network, File monitoring, Malware reverse engineering, Binary file metadata, Process command-line parameters, Environment variable, Process monitoring, Windows event logs, Network intrusion detection system, Email gateway, SSL/TLS inspection |
| Windows | Persistence | [Registry Run Keys / Startup Folder](https://attack.mitre.org/techniques/T1060/) | Magic Hound malware used Registry Run keys to establish persistence. | Windows Registry, File monitoring |
| Linux, macOS, Windows | Discovery | [Process Discovery](https://attack.mitre.org/techniques/T1057/) | Magic Hound malware can list running processes. | Process monitoring, Process command-line parameters |
| Linux, macOS, Windows | Collection, Credential Access | [Input Capture](https://attack.mitre.org/techniques/T1056/) | Magic Hound malware is capable of keylogging. | Windows Registry, Kernel drivers, Process monitoring, API monitoring |
| Linux, macOS, Windows | Command and Control, Defense Evasion | [Web Service](https://attack.mitre.org/techniques/T1102/) | Magic Hound malware can use a SOAP Web service to communicate with its C2 server. | Host network interface, Netflow/Enclave netflow, Network protocol analysis, Packet capture, SSL/TLS inspection |

This structured format provides a clear and comprehensive overview of the tactics, techniques, and procedures employed by Magic Hound, along with the relevant data sources for detection and analysis.