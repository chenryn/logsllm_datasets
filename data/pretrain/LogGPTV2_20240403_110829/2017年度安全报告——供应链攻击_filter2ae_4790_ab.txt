## 捆绑下载
### OSX/Proton后门（Elmedia Player软件）攻击事件
Elmedia Player是一款专门为Mac OS X
打造的免费媒体播放器，通过它可播放和管理Mac上的Flash影片、电影视频等等。2017年10月19日ESET注意到Elmedia
Player软件的制造商Eltima正在其官方网站上发布一个被植入OSX/Proton恶意软件的应用程序。ESET联系Eltima之后2017年10月20日Eltima官方发布安全公告，公告称旗下macOS平台下的Folx
和 Elmedia
Player两款软件的DMG因为官网被入侵而被篡改并被植入了恶意代码，具体影响到了2017年10月19日在官网下载该两款软件的用户。该软件用户数大约在100万左右。这是今年既XshellGhost和CCleaner之后又一起严重的针对供应链攻击的事件。
技术分析
C&C域名DNS请求态势
注: 时间因为标准问题，允许存在1天的误差。该图来自于360网络安全研究院
据悉，植入Eltima软件的后门代码是已知的OSX/Proton后门。攻击者通过解压Eltima软件包，并通过有效的macOS开发者签名来重新打包来保护自身，目前苹果公司已经吊销了该签名。
  * 信息窃取方面，OSX/Proton是通过持久化控制来窃取一系列用户信息的后门，主要包括如下：  
操作系统信息： 主机名，硬件序列号 ，用户名，csrutil status，网关信息，时间/时区；
  * 浏览器信息：历史记录，cookies，标签，登录信息等（包括Firefox,Chrome,Safari,Opera平台）
  * 数字钱包
Electrum: ~/.electrum/wallets  
Bitcoin Core: ~/Library/Application Support/Bitcoin/wallet.dat  
Armory: ~/Library/Application Support/Armory  
• SSH信息  
• macOS keychain信息  
• Tunnelblick VPN 配置 (~/Library/Application
Support/Tunnelblick/Configurations)  
• GnuPG 数据 (~/.gnupg)  
• 1Password 数据 (~/Library/Application Support/1Password 4 and
~/Library/Application Support/1Password 3.9)
Indicators of Compromise (IOCs)  
•URL列表  
hxxps://mac[.]eltima[.]com/download/elmediaplayer.dmg  
hxxp://www.elmedia-video-player.[.]com/download/elmediaplayer.dmg  
hxxps://mac.eltima[.]com/download/downloader_mac.dmg  
•文件哈希  
e9dcdae1406ab1132dc9d507fd63503e5c4d41d9  
8cfa551d15320f0157ece3bdf30b1c62765a93a5  
0400b35d703d872adc64aa7ef914a260903998ca  
•IP地址  
eltima[.]in / 5.196.42.123
### Chrome插件User–Agent Switcher供应链攻击事件
在信息化高速发展的今天,在BS模式的推动下,web已经成为全球第一大客户端,早已是用户生活中不可分割的一部分,在此处事件中User-Agent
Switcher为广大的攻击者提供了一种新型的供应链攻击模式—从大分发机构出发,对交付这一过程进行攻击,作者通过混淆自己的恶意代码进入图片接着在插件运行的时候再从图片中解密出恶意代码进行运行,从而绕过了Chrome商店的严格审查机制,成功的堂而皇之的登录到了Chrome应用商店,然而对用户而言,官方的应用商店无疑是代表着官方的认证,以及质量和安全,时至今日已经Chrome商店的统计数据显示:累计有458,450的用户已经安装了该插件,可以看到Chrome商店在这之中扮演着重要的角色,交付这一环节上,就让chrome成功收录了自己的应用,然后利用chrome应用商店这个更为广大的品台吸引到更多的用户进行下载使用,从而造成更大的危害。
技术细节
运作流程
DNS请求态势
uaswitcher.org&the-extension.com & api.data-monitor.info
canvas图片js代码隐藏  
那么现在直接从background.js看起
在background.js的70行处有一行经过js压缩的代码,进行beautify后。这里大部分代码的功能都是对promo.jpg这个图片文件的读取处理
值的内容都小于10,所以这就是为什么要放在A分量上,A分量的值255是完全不透明,而这部分值附加在245上.所以对图片的观感完全无影响
下载恶意payload
用户信息上传
## 升级劫持
### 全国多省爆发大规模软件升级劫持攻击
软件产品在整个生命周期中几乎都要对自身进行更新，常见的有功能更新升级、修复软件产品BUG等等。攻击者可以通过劫持软件更新的“渠道”，比如通过预先植入用户机器的病毒木马重定向更新下载链接、运营商劫持重定向更新下载链接、软件产品更新模块在下载过程中被劫持替换（未校验）等等方式对软件升级过程进行劫持进而植入恶意代码。
360安全卫士在2017年7月5日披露，有多款软件用户密集反映360“误报了软件的升级程序”，但事实上，这些软件的升级程序已经被不法分子恶意替换。
这次事件其实是基于域名bjftzt.cdn.powercdn.com的一组大规模软件升级劫持事件。用户尝试升级若干知名软件客户端时，运营商将HTTP请求重定向至恶意软件并执行。恶意软件会在表面上正常安装知名软件客户端的同时，另外在后台偷偷下载安装推广其他软件。山东、山西、福建、浙江等多省的软件升级劫持达到空前规模，360安全卫士对此类攻击的单日拦截量突破40万次。
技术分析  
近期有多款软件用户密集反映360“误报了软件的升级程序”，但事实上，这些软件的升级程序已经被不法分子恶意替换。  
下图就是一例爱奇艺客户端升级程序被劫持的下载过程：可以看到服务器返回了302跳转，把下载地址指向了一个并不属于爱奇艺的CDN服务器地址，导致下载回来的安装包变为被不法分子篡改过的推广程序。
此次被劫持升级程序的流行软件远不止爱奇艺一家，下图就是一些由于网络劫持而出现的“假软件”。
被网络劫持替换的“假软件”
以下，我们以伪造的百度网盘安装程序“BaiduNetdisk_5.5.4.exe”为例分析一下恶意程序的行为。与正常的安装程序相比，该程序不具备合法的数字签名，并且体积较大。
通过对比可以发现，两者在内容上还是有较大差别。两者只有8.7%的函数内容相同。
伪装安装程序和正常安装程序函数对比
根据360安全卫士的持续监控和拦截，该劫持行为从今年3月底就已经开始出现，360一直在持续跟进查杀，近日来则突然出现了爆发趋势，为此360安全卫士官方微博公开发布了警报。  
7月4日，也就是在360发布软件升级劫持攻击警报后，此类攻击行为出现了一定程度下降。
注：网络劫持量走势
根据已有数据统计显示，受到此次劫持事件影响的用户已经超过百万。而这些被劫持的用户绝大多数来自于山东地区。另外，山西、福建、浙江、新疆、河南等地也有一定规模爆发。
注：被劫持用户地域分布
在此提醒各大软件厂商，软件更新尽量采用https加密传输的方式进行升级，以防被网络劫持恶意利用。对于普通互联网用户，360安全卫士“主动防御”能够拦截并查杀利用软件升级投放到用户电脑里的恶意程序，建议用户更新软件时开启安全防护。
360安全卫士拦截软件升级劫持“投毒”
> 12月初，Catalin
> Cimpanu发现几起针对WordPress站点的攻击，主要通过加载恶意脚本进行键盘记录，挖矿或者挂载广告。恶意脚本从“cloudflare.solutions”域加载，该域与Cloudflare无关，只要用户从输入字段切换，就会记录用户在表单字段中输入的内容。  
>
> 攻击者攻击了WordPress站点，从主题的function.php文件植入一个混淆的js脚本，这类供应链攻击的明显区别是，他在产品交付后，用户使用前进行植入恶意程序，这样在用户使用过程中受到攻击。  
>  此次检测到的WordPress
> Keylogger事件，最早可以追溯到今年4月，期间小型攻击不断，在12月的时候攻击突然加剧。使用WordPress产品的用户，有必要进行自检，排查是否有恶意文件，及时清除。
### WordPress Keylogger事件
技术分析  
我们注意到WordPress被注入了一个混淆的js脚本，从主题的function.php文件进行植入,其中reconnecting-websocket.js用作websocket通信，cors.js中包含后门。Cors.js更改前端页面，释放javascript脚本进行输入监听，之后将数据发送给工具者（wss://cloudflare[.]solutions:8085/）。
用户WordPress首页底部有两个JS，第一个用来做websocket通信。Cors.js有混淆：
解密出：
逻辑很好理解，监听blur 事件(输入框失去焦点) 通过websocket发送用户input内容。
最后，窗口加载后执行addyandexmetrix()。该函数是一个类似cnzz，做访问统计的js。
## 总结
在未来，安全人员担心的种种安全风险会不可避免的慢慢出现，但同时我们也在慢慢的看到，一方面基础软件厂商正在以积极的态度通过联合安全厂商等途径来加强和解决自身的产品安全，另一方面安全厂商之间也已经在威胁情报和安全数据等方面方面进行更为明确化，纵深化的整合。
360CERT在实际分析跟踪中，除了看到XShellGhost中所使用的一系列精巧攻击技术外，更重要是看到了背后攻击组织在实施攻击道路上的决心。
而就Ccleaner后门事件是Xshellghost之后公开的第二起黑客入侵供应链软件商后进行的有组织有预谋的大规模定向攻击。供应链攻击是将恶意软件分发到目标组织中的一种非常有效的方法。在供应链的攻击中，攻击者主要凭借并滥用制造商或供应商和客户之间的信任关系攻击组织和个人。2017年上半年爆发的NotPetya蠕虫就显示出了供应链攻击的强大影响力。
User-Agent
Switcher在此处供应链攻击的优势就在于其通过了Chrome官方商店的认证,而对于用户来说,能够在官方商店安装和下载到的插件就一定是安全可靠的,这一个信任链对于用户来说是十分牢固的,首先针对Chrome官方商店来说,对于应用的审查应该更为严格,对于插件能够访问到浏览器的权限应该受到一些限制,User-Agent
Switcher利用图片代码隐藏技术对于chrome应用商店的审查进行逃脱.这些技术在安全领域更该受到重视,安全性才是对于用户保障的根本.对今年一年的回顾来开,浏览器中的安全受到了各界广泛的关注,尤其是对于攻击者,JS
Miner, Blue Loutus, wordpress Keylogger
这一例例的事件都将web安全这一问题再一次推向世人的面前,web作为第一大客户端,安全性更是需要更多的保障,随意web技术日新月异的发展,攻击技术的迭代更是远远超过了防御技术的迭代,所以我们对于其安全应该作出更多,更严谨的思考,指定出更为有效的规范以及守则,才能减少这些危害的影响以及发生。
Eltima被植入后门则表明MAC平台的安全问题同样不容忽视。从某些方面来说，OSX确实要比windows安全的多。但是对于供应链攻击来说OSX的安全措施同样显得无能为力。前两年的XcodeGhost掀起的轩然大波仍然历历在目，2012年年初的时候putty等SSH管理软件的汉化版带有后门程序的事件在当时影响也很大，在实际应用场景中盗版、汉化、破解等问题给信息系统制造了大量隐患。