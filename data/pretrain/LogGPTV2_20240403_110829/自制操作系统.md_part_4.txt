只猫的话，倒是可以考虑请它来帮忙按住这个键（日本的谚语：想让猫来搭把手，形容人手不足，
1
连猫爪子都想借用一下），或者也可以干脆就用透明胶把这个键粘上。
3
20
21
22
168000附近的画面
因为一下子输入到最后实在是挺花时间的，大家也许想保存一下中间结果，这时可以从菜单 7
上选择“文件”（File）→“另存为”（Save As），画面上就会弹出保存文件的对话框。我们可以
随便取个名字进行保存，笔者推荐使用“helloos.img”。当想要打开保存过的文件时，首先要启
8
动Bz.exe，从菜单上选择“文件”（File）→“打开”（Open），然后选择目标文件，这样原来保存
的内容就能显示出来了。可是这个时候不管我们怎么努力按键盘，它都一点反应也没有。这是怎
9
么回事？难道必须要一次性输入到最后吗？这个大家不必担心，其实只要从菜单里选择“编辑”
（Edit）→“只读”（Read Only）就可以进入编辑状态啦。好了，我们继续输入。
10
如果家里的猫自由散漫惯了，不肯帮忙，而大家又不想用透明胶粘键盘这种土方法的话，不
妨这样：用鼠标选择一部分0，然后从菜单选择“编辑”（Edit）→“复制”（Copy）。简简单单复
11
制粘贴几次就可以大功告成了，这工具还真方便呀。
哦，对了，差点忘记一件重要的事——在地址0001F0和001400附近还有些地方不全是00，要
12
像下图那样把它们也改过来，然后整体检查一下，确认没有输入错误。
13
14
15
0001F0附近
16
图灵社区会员 metorm 专享 尊重版权
16 …… 第1天：从计算机结构到汇编程序入门
001400附近
下面，我们把输入的内容保存下来就完成了软盘映像文件的制作，这时查看一下文件属性，
应该能看到文件大小正好是1474560字节（=1440×1024字节）。然后我们将这个文件写入软盘（具
体后述），并用它来启动电脑。如下所示，画面上会显示出“hello, world”这个字符串。目前的
程序虽然简单，但毕竟一打开电脑它就能够自动启动，还能在屏幕上显示出一句话来，已经小小
成功了哦。不过，我们现在还没有结束这个程序的方法，所以想要结束的时候，只能把软盘取出
来后切断电脑电源，或者重新启动。
至于最关键的往磁盘上写映像文件的方法，笔者已经预先准备好了一个程序。在介绍它的使
用方法之前，我们先把笔者准备的工具全都安装进来吧，这样后面讲解起来比较省事。下面我们
就来看怎么安装这些工具。
■■■■■
打开附带光盘，里面有一个名为tolset①的文件夹，把这个文件夹复制到硬盘的任意一个位置
上。现在里面的东西还不多，只有3MB左右，不过以后我们自己开发的软件也都要放到这个文件
夹里，所以往后它会越来越大，因此硬盘上最好留出100MB左右的剩余空间。工具安装到此结束，
我们既不用修改注册表，也不用设定路径参数，就这么简单。而且以后不管什么时候，都可以把
这整个文件夹移动到任何其他地方。用这些工具，我们不仅可以开发操作系统，还可以开发简单
的Windows应用程序或OSASK应用程序等。
——————————
① tool set的缩写，“工具套件”的意思。
图灵社区会员 metorm 专享 尊重版权
1 先动手操作 …… 17
接下来我们打开刚才安装的tolset文件夹，在文件夹的名字上单击鼠标右键，从弹出的菜单上
1
选择“新建”（New）→“文件夹”（Folder）。画面上会显示出缺省的文件夹名“新建文件夹”（New
Folder），我们要把它改为“helloos0”，并把前面保存的映像文件helloos.img复制到这个文件夹里。
1
另外，刚才安装的tolset文件夹下有个名为z_new_w的子文件夹，其中有!cons_9x.bat和!cons_nt.bat
这两个文件，要把它们也复制粘贴到helloos0文件夹里。
3
接着，在文件夹helloos0里单击鼠标右键，从弹出的菜单中选择“新建”（New）→“文本文
件”（Text Document），并将文件命名为“run.bat”，回车后屏幕上会显示“如果改变文件扩展名，
20
可能会导致文件不可用。确实要更改吗?”的对话框，我们选择“是”，创建run.bat文件。然后在
run.bat文件名上单击鼠标右键，在弹出的菜单上选择“编辑”（Edit），输入下面内容并保存。
21
run.bat
copy helloos.img ..\z_tools\qemu\fdimage0.bin
22
..\z_tools\make.exe -C ../z_tools/qemu
然后按照同样的步骤，创建install.bat，并将下列内容输入进去。
7
install.bat
8
.. \z_tools\imgtol.com w a: helloos.img
其实以上步骤创建的所有文件都已经给事先给大家准备好了，就放在附带光盘中名为 9
projects\01_day\helloos0的子文件夹里。所以大家只要把光盘上的helloos0复制下来，粘帖到硬盘
的tolset文件夹里，所有的准备工作就瞬间完成了。
10
■■■■■
11
好了，现在我们就来把这个有点像操作系统的软件安装到软盘上吧。随便从附近的小店里买
片新软盘来，在Windows下格式化一下（格式化方法：把软盘插入磁盘驱动器后打开“我的电脑”，
12
在“3.5吋软盘”（3.5inches Floppy）A:上单击鼠标右键，再选择“格式化”（Format）即可）。对
了，这个时候不要选择“快速格式化”选项。然后用鼠标左键双击helloos0文件夹里的 !cons_nt.bat
13
文件（Windows95/98/Me的用户需要双击!cons_9x.bat），屏幕上就会出现一个命令行窗口
（console）。我们先仔细确认一下软盘是否已经插好，然后在命令行窗口上输入“install”并回车，
这样安装操作就开始了。稍候片刻，等安装程序执行完毕，我们的操作系统启动盘也就做好了。 14
完成安装之后，也可以关闭刚才的命令行窗口了。
现在我们就用这张操作系统启动软盘来启动一下电脑试试吧，肯定跟刚才一样，会显示出 15
“hello, world”的字样来。
在这里要提醒大家几点：一是软盘虽然不要求必须用全新的，但如果太旧的话，在读写过程 16
图灵社区会员 metorm 专享 尊重版权
18 …… 第1天：从计算机结构到汇编程序入门
中容易出问题，所以最好还是不要用太旧的软盘。另外，就算是新盘，如果太便宜的话有时也用
不了，若是发现有问题，就需要再去买一张。最后一点，一旦格式化或者往软盘内安装操作系统，
就会把里面原有的东西全部覆盖掉，所以大家千万不要用存有重要文件的软盘来尝试哦。
■■■■■
看到这里，大家可能会有各种问题：“这些我都明白，可是既要专门去买张软盘，又要重启
电脑，实在太麻烦了，难道就没有什么更简单的方法吗？”、“我家的电脑根本就没有软驱呀”、
“我的电脑没有什么重启按钮，也没有关电源的开关，一旦启动了这个奇怪的操作系统，就没法
终止啦”。其实这些问题笔者已经考虑到了，所以特意准备了一个模拟器。我们有了这个模拟器，
不用软盘，也不用终止Windows，就可以确认所开发的操作系统启动以后的动作，很方便呢。
使用模拟器的方法也非常简单，我们只需要在用!cons_nt.bat（或者是!cons_9x.bat）打开的命
令行窗口中输入“run”指令就可以了。然后一个名叫QEMU的非常优秀的免费PC模拟器就会自
动运行。QEMU不是笔者开发的，它是由国外的一些天才们开发出来的。感谢他们！
“我按照你说的一步一步地做了一遍，可是不行呀！怎么回事呢？”会遇到这种情况的人肯
定是个非常认真的人，可能真的完全按照上面步骤用二进制编辑器自己做了一个helloos.img文件
出来。出现这种问题，肯定是因为文件中有输入错误的地方，虽然笔者不知道具体错在哪儿，不
过建议最好检查一下000000到000090，以及0001F0前后的数据。如果还是不行的话，那就干脆用
附带光盘中笔者做的helloos.img好了。
可能有些人嫌麻烦，懒得自己输入，上来就直接使用光盘里的helloos.img文件，这当然也没
什么不可以；但笔者认为这种体验（一点一点地输入，再千辛万苦地纠错，最终功夫不负有心人
取得成功）本身更难能可贵，建议大家最好还是亲自尝试一下。
■■■■■
就这样，我们没有去改造现成的操作系统，而是从零开始开发了一个，并让它运转了起来（当
然，如果别人承认这是个操作系统的话）。这太了不起了！大家完全可以在朋友们面前炫耀一番
了。仅学习了几个小时开发的一个初学者，就能从零开始做出一个操作系统，这本书不错吧
（笑）？这次我们考虑到从键盘直接输入比较麻烦，所以就只让它显示了一条消息；如果能再多
输入一些内容的话，那仅用这种方法就可以开发任意一个操作系统（当然最大只能到1440KB）。
现在唯一的问题是，我们还不知道之前输入的那些“EB 4E 90 48 45……”到底是什么意思（而
这也正是我们所面临的最大问题）。今天剩下的时间，以及以后的29天时间里，我们都会讲解这
个问题。
图灵社区会员 metorm 专享 尊重版权
2 究竟做了些什么 …… 19
22 究竟做了些什么
1
为什么用这种方法就能开发出操作系统来呢？现在搞清楚这个问题，会对我们今后的理解很
1
有帮助，所以在这里要稍做说明。
首先我们要了解电脑的结构。电脑的处理中心是CPU，即“central process unit”的缩写，翻
3
译成中文就是“中央处理单元”，顾名思义，它就是处理中心。如果我们把别的元件当作中心来
使用的话，那它就叫做CPU了，所以无论什么时候CPU都总是处理中心。不过这个CPU除了与别
的电路进行电信号交换以外什么都不会，而且对于电信号，它也只能理解开（ON）和关（OFF） 20
这两种状态，真是个没用的人呀（虽然它不是人吧，大家领会精神）。
21
22
7
CPU
8
我们平时会用电脑写文章、听音乐、修照片以及做其他各种各样的事情，我们用电脑所做的
这些，其实本质上都不过是在与CPU交换电信号而已，而且电信号只有开（ON）和关（OFF）
这两种状态。再说直白一点，CPU根本无法理解文章的内容，更不会鉴赏音乐、照片，它只会机 9
械地进行电信号的转换。CPU有计算指令，所以它能够进行整数的加减乘除运算，也可以处理负
数、计算小数以及10的100次方这样庞大的数值，它甚至能够处理我们初中才学到的平方根和高
10
中才学到的对数、三角函数，而且所有这些计算仅通过一条指令就能简单实现。虽然CPU功能如
此强大，但它其实根本不理解数的概念。CPU就是个集成电路板，它只是忠实地执行电信号给它
11
的指令，输出相应的电信号。
这些概念可能不太容易理解，还是让我们来看个的具体例子吧。比如说，让我们用1来表示
12
开（ON），用0来表示关（OFF），这样比较容易理解。我们可以用32×16=512个开（ON）和关（OFF）
的集合（＝电信号的集合），来显示出下面这个不甚好看的人头像。
13
14
15
16
图灵社区会员 metorm 专享 尊重版权
20 …… 第1天：从计算机结构到汇编程序入门
我们也可以用0000 0000 0000 0000 0000 0100 1010 0010 这32个电信号的集合来表示1186这个
整数。（注：用二进制表示1186的话，就是100 1010 0010）。我们还可以用0100 1011 0100 1111 0100
1111 0100 0010这32个电信号的集合来表示“BOOK”这个单词（注：这实际上就是电脑内部保
存这个单词时的电信号集合）。
CPU能看见的就只有这些开（ON）和关（OFF）的电信号。换句话说，假如我们给CPU发送
这么一串电信号:
0000 0100 0011 1000 0000 1110 0001 0000
这信号可能是一幅画的部分数据，可能是个二进制整数，可能是一段音乐旋律，可能是文章
中的一段文字，也可能是保存了的游戏的一部分数据，或者是程序中的一行代码，不管它是什么，
CPU都一窍不通。CPU不懂这些，也不在乎这些，它只是默默地、任劳任怨地按照程序的指令进
行相应的处理。
■■■■■
看到这里，或许有人会认为是先有了这么多要做的事情，所以人类才发明了CPU，而实际上
并不是这样。最早人们发明CPU只是为了处理电信号，那个时候没有人能想到它后来会成为这么
有用的机器。不过后来人们发现，一旦把电信号的开（ON）/关（OFF）与数字0和1对应起来，
就能将二进制数转换为电信号，同时电信号也可以转换回二进制数。所以，虽然CPU依然只能处
理电信号，但它从此摇身一变，成了神奇的二进制数计算机。
因为我们可以把十进制数转换成二进制数，也能把二进制数还原成十进制数，所以人们又发
明了普通的计算机。后来，我们发现只要给每个文字都编上号（即文字编码），就可以建立一个
文字与数字的对应关系，从而就可以把文字也转换成电信号，让CPU来处理文章（比如进行文字
输入或者字词检索等）。依此类推，人们接着又找到了将图像、音乐等等转换成电信号的方法，
使CPU的应用范围越来越广。不过CPU还是一如既往，只能处理电信号。
而且我们能用CPU来处理的并不仅仅只有数据，我们还可以用电信号向CPU发出指令。其实
我们所编写的程序最终都要转换成所谓的机器语言，这些机器语言就是以电信号的形式发送给
CPU的。这些机器语言不过就是一连串的指令代码，实际上也就是一串0和1的组合而已。
软盘的原理也有异曲同工之妙，简单说来，就是把二进制的0和1转换为磁极的N极和S极而
已，所以我们只用0和1就可以写出映像文件来。不仅是映像文件，计算机所能处理的各种文件最
终都是用0和1写成的。因此可以说，不能仅用0和1来表达的内容，都不能以电信号的形式传递给
CPU，所以这种内容是计算机所无法处理的。
■■■■■
而“二进制编辑器”就是用来编辑二进制数的，我们可以很方便地用它来输入二进制数，并
图灵社区会员 metorm 专享 尊重版权
2 究竟做了些什么 …… 21
保存成文件。所以它就是我们的秘密武器，也就是说只要有了二进制编辑器，随便什么文件我们 1
都能做出来。（厉害吧！）如果大家在商店里看到一个软件，很想要而又不想花那么多钱的话，那
就干脆就回家用二进制编辑器自己做一个算啦！用这个方法我们完全可以自己制作出一个与店里
1
商品一模一样的东西来。看上一个500万像素的数码相机，但是太贵了买不起？那有什么关系？
我们只要有二进制编辑器在手，就可以制作出毫不逊色于相机拍摄效果的图像，而且想做几张就
可以做几张。要是C编译器太贵了买不起，也不用郁闷。即使没有C编译器，我们也可以用二进 3
制编辑器做出一个与编译器生成文件完全一样的执行文件，而且就连C编译器本身都可以用二进
制编辑器做出来。 20
有了这么强大的工具，制作操作系统就是小菜一碟。道理就是这么简单，所以我们这次不费
吹灰之力就做了个操作系统出来也是理所当然的。或许有人会想“就为了讲这么个小事，有必要 21
长篇大论写这么多吗？”其实不然，如果我们对CPU的基础有了彻底的理解，以后的内容就好懂
多了。
22
■■■■■
7
“喂，且慢，我明白了二进制编辑器就是编辑二进制数的软件，可是在你让我输入你的
helloos.img的时候，除了0和1以外，不是还让我输入了很多别的东西吗？你看，第一个不就是E
8
吗？这哪里是什么二进制数？分明是个英文字母嘛！”……噢，不好意思，这说得一点错都没有。
虽然二进制数与电信号有很好的一一对应关系，但它有一个缺点，那就是位数实在太多了，
9
举个例子来说，如果我们把1234写成二进制数，就成了10011010010，居然长达11位。而写成十
进制数，只用4位就够了。因为这样也太浪费纸张了，所以计算机业界普遍使用十六进制数。十
进制数的1234写成十六进制数，就是4D2，只用3位就够了。 10
那为什么非要用十六进制数呢，用十进制数不是也挺好的吗？实际上，我们可以非常简便地
把二进制数写成十六进制数。 11
二进制数和十六进制数对照表
12
0000 – 0 0100 – 4 1000 – 8 1100 – C
0001 – 1 0101 – 5 1001 – 9 1101 – D
0010 – 2 0110 – 6 1010 – A 1110 – E 13
0011 – 3 0111 – 7 1011 – B 1111 – F
14
有了这个对照表，我们就能轻松进行二进制与十六进制之间的转换了。将二进制转换为十六
进制时，只要从二进制数的最后一位开始，4位4位地替换过来就行了。如：
15
100 1101 0010 → 4D2
反之，把十六进制数的4D2转换为二进制数的100 1101 0010也很简单，只要用上面的对照表
16
反过来变换一下就行了。而十进制数变换起来就没这么简单了。同理，八进制数是把3位一组的
图灵社区会员 metorm 专享 尊重版权
22 …… 第1天：从计算机结构到汇编程序入门
二进制数作为一个八进制位来变换的，这种计数法在计算机业界也偶有使用。
因此我们在输入EB的时候，实际上是在输入11101011，所以它其实是个十六进制编辑器，但
笔者习惯称它为二进制编辑器，希望大家不要见怪。
■■■■■
虽然笔者对二进制编辑器如此地赞不绝口，但用它也解决不了什么实际问题。因为这就相当
于“只要有了笔和纸，什么优秀的小说都能写出来”一样。笔和纸不过就是笔和纸而已，实际上
对创作优秀的小说也帮不上多大的忙。所以大家在写程序时，用的都是文本编辑器和编译器，没
有谁只用二进制编辑器来做程序的。大家照相用的也都是数码照相机，没有谁只用二进制编辑器