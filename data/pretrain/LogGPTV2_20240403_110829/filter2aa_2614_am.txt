现中需要多次调用API接口获取的信息，在GraphQL 
API中只需要通过
传入参数的结构控制即可获取与请求结构相应的数据，所以网络请求减
少了。
2.渗透测试要点
正是上文所述的两个特点的存在，导致GraphQL API呈现出与其他
API技术不同的安全问题。主要表现如下。
■ 
未授权访问问题。正因为“所见即所得”的“客户端请求什么，服
务器端会响应什么”的一致性，后端应用程序在应用级的权限访问控制
上存在设计错误，导致越权访问或因越权访问导致的敏感数据泄露。
■ 嵌套查询带来的性能问题。如果请求的数据格式嵌套层级过于复
杂，对服务器端处理来说会消耗很多资源，这时过多的请求会导致类似
Dos攻击的行为发生。当然，GraphQL本身也提供了超时设置、最大查
询深度、查询复杂度阈值等安全策略，但在应用程序开发过程中往往存
在安全策略设置不当的情况。
■ 
GraphQL自身安全配置错误。很多技术组件在使用时官方都会
提供相关的安全配置项说明，比如SpringBoot安全配置项、Tomcat的安
全基线。GraphQL虽然没有这些技术组件的配置复杂，但它自身也存在
一个管理入口，通常请求路径为/graphql或/graphql/console/。如果应用
程序配置错误，渗透测试人员可以尝试访问/graphql?debug=1，进入调
试模式。
5.3.3 SOAP API类
SOAP API主要是指Web Services服务接口，它的数据格式完全依赖
于XML来对内外部提供消息传递服务。与前两类API技术相比较，其安
全性已完成较好的标准框架定义，且功能丰富，易于在应用程序代码中
实现。
1.主要特性
SOAP是严格遵循XML消息定义的消息交换协议，SOAP API的主要
特性如下。
■ 在技术实现上，SOAP API的33个组成部分中，无论是SOAP协
议、UDDI还是WSDL，都是基于XML语言描述的。其中，WSDL为服
务消费者提供了Web Services接口详细描述，通过解析WSDL获取调用
参数详细描述后使用XML格式数据与服务提供者进行数据交互。这一
点，在SOAP 
API渗透测试中，成为信息收集的重要入口，如图5-3所
示。
●图5-3 利用WSDL攻击SOAP API示意图
■ SOAP API安全框架依赖开发人员去正确实现。在SOAP API的
服务提供者与消费者之间，有一系列的标准安全规范，典型的SOAP服
务安全框架如图53-4所示。
●图5-4 SOAP服务安全框架
这些安全标准依赖于接口开发者在SOAP消息中实现，但事实上
SOAP API之所以存在安全问题往往是未按照标准去实现或是错误实现
导致的。
2.渗透测试要点
因SOAP API上述的两个特性，在SOAP API的渗透测试中，其渗透
测试要点如下。
■ XML类的安全问题在SOAP API中比较常见，比如XML实体攻
击、XPath注入、XML炸弹等。
■ 基于SOAP 
API安全框架实现错误的安全问题，比如针对Web
Services身份验证的攻击、XML签名类攻击、针对算法的攻击等。导致
这些攻击的漏洞有密码在SOAP头信息中以明文形式传递、HTTP Basic
认证信息未加密、未对消息进行签名等。
■ 传统的Web安全问题仍然存在，比如SQL注入、文件上传漏洞、
DOS攻击、重放攻击等。
■ 针对WSDL的信息收集或在原URL地址后加“?wsdl”可能成为渗透
测试的快捷入口。
■ 未授权访问和业务逻辑漏洞也会在SOAP API的渗透测试中被发
现，常见的导致此攻击的漏洞有未使用身份验证、参数缺少校验或保护
导致数据篡改后的权限绕过、敏感数据保护不足等。
5.3.4 RPC及其他API类
除了前面介绍的RESTful API、GraphQL API、SOAP API外，还有
部分以其他的技术实现的API，虽然它们在使用量上占比较少，但仍具
有一定的影响力，比如RPC接口类，Java语言中被广泛使用的RMI、
Dubbo、Protobuf、JMS以及各种消息队列服务等。
1.主要特性
这类API技术的原理各不相同，在通信结构和数据交换格式上有着
鲜明的特征，如下所述。
■ 
通信协议在数据交互上大多数基于Client→Client 
stub→Server
stub→Server的对等结构。典型的如RMI接口的通信原理，如图5-5所
示。
●图5-5 RMI通信原理示意图
■ 不同的API技术使用多种数据交换格式，比如JSON格式、XML格
式、序列化数据结构等。
2.渗透测试要点
这一部分的API接口因技术特性各不相同，所以在渗透测试中具有
明显的差异，其主要的渗透测试要点如下。
■ 使用序列化数据结构的API协议，反序列化漏洞最为频繁，典型
的如Java RMI接口。
■ 不同的API协议导致在渗透测试过程中需要使用专门的协议辅助
工具，如Protobuf协议辅助工具BlackBox Burp Suite插件、AMF协议辅
助工具Blazer 
Burp 
Suite插件、MessagePack数据格式辅助工具
MessagePack Burp Suite插件等。
■ 探测默认端口或通过nmap扫描服务器开放的端口可以发现服务器
端调用入口。比如Dubbo注册服务器端的20880端口。
■ 传统的Web安全问题也是仍然存在，比如XXE、SQL注入。
5.4 API安全工具典型用法
上一章为读者介绍了多种API安全工具，每一种工具有着不同的用
途，适用于不同的场景。安全人员在API渗透测试过程中，通常会将几
种工具组合起来使用，以发挥每一种安全工具的优势，下面就为读者详
细介绍几种工具组合使用的方法。
5.4.1 SoapUI+Burp Suite使用介绍
SoapUI的优势在于内置安全扫描功能和易用的操作界面，Burp
Suite的优点在于内置多种安全套件，在手工操作的情况下可以支持许多
复杂的渗透测试场景，将SoapUI和Burp Suite组合在一起使用，既可以
利用SoapUI开展快速的漏洞扫描，又可以针对某些特定场景做定制化、
细粒度的分析验证。下面将从代理配置、漏洞扫描、特殊场景验证33个
方面，来介绍SoapUI和Burp Suite的组合使用。
1.代理配置
SoapUI和Burp Suite的基本配置中都提供了代理功能，在这个组合
中，Burp Suite充当代理服务器的角色，对SoapUI发起的请求流量转发
至目的服务器，对目的服务器响应的流量转发至SoapUI；同时，代理服
务器也记录了详细的流量信息，通过记录在Burp 
Suite中的这些信息，
可以在Burp 
Suite上做不同场景的漏洞验证。典型的工具组合后结构如
图53-6所示。
●图5-6 SoapUI+Burp Suite组合工作原理
这里，以SoapUI Pro版（即Ready API 3.2.7版本）、Burp Suite1.2.7
为例，逐步了解上图中的结构在各个工具中是如何配置的。
（1）启用Burp Suite代理设置
在Burp Suite的Proxy套件→Options标签中，提供了代理IP和端口的
设置，默认情况下为127.0.0.1:8080，如图5-7所示。
●图5-7 Burp Suite代理设置
如果不使用这个配置，可以选中配置项单击Edit按钮进行编辑，设
置为自己定义的IP地址和端口，如图5-8所示。
●图5-8 Burp Suite代理编辑
（2）设置ReadyAPI代理IP和端口
启动ReadyAPI，分别单击File→Preferences，打开首选项面板。如
图5-9所示。
在弹出的首选项面板中选择代理，单击Proxy，右侧显示代理IP地
址和端口输入框。在这里，要指定为手工设置，然后输入Burp 
Suite中
使用的IP地址和端口即可，如图5-10所示。
●图5-9 打开ReadyAPI首选项
●图5-10 ReadyAPI代理设置
通过以上两步操作，即完成了SoapUI和Burp Suite的关联配置，接
下来则可以在SoapUI中启动安全扫描功能。
2.漏洞扫描
ReadAPI中可以直接发起一个全新的API安全检测，其发起路径为
依次单击文件File→创建安全测试New Security Test，如图5-11所示。
●图5-11 在ReadAPI中创建安全测试任务
ReadAPI安全测试提供了两种入口方式，如图5-12所示。
■ 从API规范描述文件发起。
■ 从API接口的URL路径发起。
●图5-12 ReadAPI中安全测试入口方式
在这里选择从API规范描述文件开始，在弹出的对话框中，选择已
定义好的描述文件*.yaml或*.json，比如这里使用的文件为swagger编辑
器（网址为https://editor.swagger.io/）中的标准定义文件swagger.yaml，
如图5-13所示。
●图5-13 在ReadAPI中导入swagger.yaml文件
单击Next按钮后，ReadAPI将会自动解析swagger.yaml，读取文件中
各个API的定义、请求路径、参数描述等相关信息，并弹出需要选择的
安全检测内容。使用者可以根据自己的需要，选择相应的安全测试内
容，如图53-14所示，图中的每一个安全检测内容，复选框选中则表示
启用此项检测。
●图5-14 ReadAPI中选择安全测试内容
当选择完安全测试内容后，单击图53-14中的Finish按钮，在弹出的
确认对话框中单击Run按钮，即可启动安全扫描，如图5-15所示。
●图5-15 在ReadAPI中启动安全测试任务
但读者需要注意的是，这时所有的流量都是通过Burp 
Suite代理
的，所以一定要将Burp 
Suite的流量拦截按钮关闭，使其无须手工确认
自行通过。如图53-16所示方框中的文字显示为Intercept is off，如果显
示为Intercept is on则再次单击此按钮即可。
●图5-16 Burp Suite流量拦截设置
当扫描结束后，可以通过图5-17所示的两种方式获取扫描报告。
●图5-17 ReadAPI中安全测试报告获取方式
3.特殊场景验证
通过Burp Suite代理的扫描信息，在Proxy套件的历史记录中将可以