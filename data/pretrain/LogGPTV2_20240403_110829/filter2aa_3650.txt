# 流量劫持问题概述

本文旨在对流量劫持问题进行整理和归纳。如果内容涉及版权问题，请联系删除。

从攻击面来看，流量劫持大致可以分为两类：本地劫持与网络劫持。以下将按照这一分类方式展开讨论。需要注意的是，虽然某些本地劫持手段在技术实现上可归类为网络劫持（即发生在数据离开用户主机后，在各个路由网关节点间传输过程中遭遇的劫持），但为了便于理解，我们仍将其放在“本地劫持”部分进行介绍。

## 一、本地劫持

### 定义
本地劫持通常通过流氓软件实施，这类软件会安装在用户的客户端上，其行为本质上与木马无异，包括但不限于主页锁定、网页劫持、广告弹窗、流量暗刷及静默安装等。

### 案例
- **QTV系列变种**：利用浏览器插件进行流量劫持。
  ![](https://image-host-toky.oss-cn-shanghai.aliyuncs.com/20200330124309.png)
  图注：注入方式的劫持流程图
  
- **高清影视流氓病毒**：
  ![](https://image-host-toky.oss-cn-shanghai.aliyuncs.com/20200330124523.png)
  图注：流氓软件方式的劫持流程图

- **广告弹窗挂马**：原广告流量被恶意注入了网页木马，并以广告弹窗等形式触发于客户端，这种现象亦被称为“流量污染”或“流量投毒”。

## 二、DNS劫持

### 定义
DNS劫持是一种使用户访问预期之外网站的技术手段，形象地说，就是当你打算去机场时却被带到了火车站。

### 攻击方法
1. **本机DNS劫持**：攻击者通过感染用户计算机上的木马或恶意软件来修改本地DNS配置文件（如hosts文件）。
2. **路由DNS劫持**：利用默认密码未更改的路由器漏洞，入侵并篡改路由器设置。
3. **直接攻击DNS服务器**：通过对DNS服务器发起DDoS攻击或其他形式的攻击导致其服务中断或返回错误信息。

### 防护措施
1. 强化计算机安全防护，定期扫描病毒并开启防火墙。
2. 更改路由器默认密码，确保网络安全。
3. 对企业而言，准备多个备用域名以应对突发状况。
4. 使用HTTP DNS代替传统的Local DNS服务。

[引用来源]  
作者：Luxm  
链接：https://juejin.im/post/5cff858a6fb9a07ed84238ec  
来源：掘金

## 三、HTTP劫持
定义：在用户前往目标网站的过程中插入额外内容，类似于途中收到小广告。

## 四、证书劫持
HTTPS劫持常表现为中间人攻击，其中最著名的案例之一是哈萨克斯坦政府曾要求公民安装特定根证书以实施国家级别的HTTPS拦截。

## 五、链路劫持
### 定义
TCP链路劫持指的是在网络通信过程中监听并伪造TCP包，从而控制目标网络的行为。这包括非法站点访问拦截以及运营商植入广告等活动。

### 判断方法
- 应用层抓包工具（例如BurpSuite）分析响应包信息。
- 网络层抓包工具（例如Wireshark）检查HTTP/HTTPS响应是否存在异常。
- 分析TTL值变化趋势。
- 检查IP分片中的Identification字段是否正常。

### 实际案例
- [GitHub HTTPS证书劫持事件](https://blog.netlab.360.com/ongoing-websites-hijacking/)
- [某电商网站流量劫持案例](https://security.tencent.com/index.php/blog/msg/81)

## 六、运营商劫持
运营商可能采取以下三种方式进行流量劫持：DNS劫持、HTTP劫持和HTTPS劫持。尽管近年来由于加强监管，DNS劫持现象有所减少，但其他两种方式仍然较为普遍。

### 防御策略
主要集中在防止JavaScript脚本和iframe标签注入型攻击方面。

### 警惕诈骗行为
一些声称代表运营商代理的服务商可能会提供虚假流量统计数据，以此欺骗客户。面对此类情况应保持警惕，并尽量选择信誉良好的合作伙伴。

## 七、CDN缓存污染
### 定义
CDN加速技术本质上是对DNS的一种良性利用，但当关键JS文件被恶意代码污染时，则会导致严重的安全风险。

### 实例
- [百度网盟CDN缓存服务器受到攻击](https://paper.seebug.org/181/#246-cdn)

## 八、软件升级劫持
这是一种特殊的攻击类型，涉及劫持合法软件更新过程，向用户提供含有恶意代码的新版本程序。

### 典型事例
- [Petya勒索病毒乌克兰变种](https://s.tencent.com/research/report/266.html)
- [爱奇艺客户端升级程序遭篡改](https://www.easyaq.com/news/675361761.shtml)

## 结语
了解不同类型的流量劫持对于提升个人及组织信息安全水平至关重要。希望以上内容能够帮助读者更好地认识相关威胁，并采取适当措施加以防范。

---

参考资料:
- [1] 你需要知道的“DNS劫持”--web安全篇（1）
- [2] 链路劫持攻击一二三
- [3] 浅谈IP分片的大小及其原因
- [4] 干货！防运营商劫持
- [5] 互联网黑势力之流量劫持