User: 请回答以下安全问题SSL/TLS客户端身份验证-实用的客户端证书验证真正的HTTPS服务器如何验证客户端证书？我的背景是企业对企业，而不是普通的人类客户。我理解受信任的根CA证书的基本链验证。但服务器通常有某种配置来指定他们想要信任的证书的主题名称或指纹值吗？
在一种情况下，代表服务器的私人CA可以对客户端证书进行签名，以便只接受他们的证书。在另一种情况下，服务器信任由（客户端选择的）任何“常规”受信任CA在其信任存储中签名的证书。但是，如果您的系统要关闭（如在企业对企业的案例中），那么您需要额外的过滤。
我意识到，在应用级别，如果证书链可用，那么可以进行任何进一步的自定义筛选。但我只想知道，在现实世界中，开箱即用，在TLS握手期间，还有哪些额外的配置web服务器需要处理这一问题。
非常感谢。

Assistant: 当服务器使用IIS时，客户端身份验证意味着将客户端证书映射到身份，即帐户（本地帐户或域帐户，具体取决于上下文）。IIS可能应用两种不同的方法，但名称混淆：
clientCertificateMappingAuthentication:IIS将查找包含确切客户端证书副本的域帐户，或者至少查找用户主体名称属性与证书中包含的属性匹配的域帐户（作为otherName类型的Subject Alt Name，用Microsoft指定的OID标识）。UPN的使用受制于一些神秘的条件，包括将立即颁发的CA证书（而不是根CA）的副本存储在IIS服务器计算机的“企业NTAuth”证书存储中，或AD服务器的证书存储中或两者兼有。你可以使用这个博客页面来获得一些指导。
iisClientCertificateMappingAuthentication：此方法有两个子方法，IIS文档称之为“一对一映射”和“多对一映射（many-to-one mapping）”。在一对一映射中，IIS配置包含从精确证书（Base64中的完整证书）到帐户（本地或域）的显式映射。在多对一映射中，配置包含一些规则，这些规则基本上匹配IssuerDN和SubjectDN的部分，并将匹配的证书显式映射到给定的帐户。
在非Microsoft的世界中，在Apache Web服务器中，您将使用SSLEquire来实现基于从证书中提取的元素（实际上是IssuerDN和SubjectDN）的访问规则。
必须记住的是：
证书用于身份验证，而非授权。前者是关于确定谁在调用，后者是关于决定是否允许特定客户端执行请求的访问。IIS模型主要通过访问权限进行授权：一旦证书被映射到一个帐户，其余的都是AD特定的东西，与证书不再有关系；这可能是简单的文件访问权限，也可能是AzMan的细粒度授权配置，或者在最近的Windows版本中取代它的任何配置。
尝试使用证书进行授权（例如，颁发包含一些信息的客户端证书，如“可以执行操作X”）通常会以眼泪和磨牙告终。尽管微软的方法很笨拙，但它的优点是明确地将身份验证和授权分开。
始终有一个证书验证步骤，确保证书是真实的和可接受的。这包括检查所有日期、加密签名、名称链接、吊销状态。。。
可能会对路径进行额外的筛选，就像IIS在使用基于UPN的客户端证书映射时所做的那样：颁发CA在企业NTAuth存储中的存在充当了一个额外的检查，将拒绝有效的、来自接受的根但未通过预期中间CA的证书路径。