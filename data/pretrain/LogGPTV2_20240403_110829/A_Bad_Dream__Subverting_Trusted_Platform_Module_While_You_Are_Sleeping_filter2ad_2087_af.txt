The TCG speciﬁcations specify how to create and re-
tain a chain of trust based on interactions between the
TPM and the RTM. More technologies and manufactur-
ers have become involved as the speciﬁcation have been
updated, as a result, this increased complexity under-
neath the measurement process. Consequently, logical
conﬂicts and incompleteness in the speciﬁcations are ob-
scured and the speciﬁcation may provide poor guidance
to vendors as to its implementation.
In this paper, we addressed the vulnerabilities that al-
low an adversary to enable a TPM reset and forge PCRs.
USENIX Association
27th USENIX Security Symposium    1243
One vulnerability comes from a ﬂawed speciﬁcation, and
many commodity devices seem to be affected. The other
vulnerability is from an implementation defect in the
popular open source implementation of the MLE for In-
tel TXT.
We crafted attacks exploiting these vulnerabilities and
demonstrated them with commodity products. We have
informed the hardware manufacturers about our ﬁndings,
and the vendors are expected to produce and deploy a
patch. We also created a patch for correcting the error
in the open source project. This patch has already been
merged.
8 Acknowledgments
We would like to express our sincere gratitude to
Jonathan M. McCune. His constructive and priceless
advice greatly helped us improve our manuscript. We
also thank the anonymous reviewers and Junghwan Kang
for their insightful comments. This work was supported
by National IT Industry Promotion Agency (NIPA) grant
funded by the Korea government (MSIT) (No.S1114-18-
1001, Open Source Software Promotion).
References
[1] ASUS.
ASUS product
security advisory.
https:
//www.asus.com/Static_WebPage/ASUS-Product-
Security-Advisory/.
[2] BUTTERWORTH, J., KALLENBERG, C., KOVAH, X., AND HER-
ZOG, A. BIOS chronomancy: Fixing the core root of trust for
measurement. In Proceedings of the 2013 ACM SIGSAC Confer-
ence on Computer & Communications Security (2013), ACM.
[3] BUTTERWORTH, J., KALLENBERG, C., KOVAH, X., AND HER-
ZOG, A. Problems with the static root of trust for measurement.
Black Hat USA (2013).
[4] COREOS. CoreOS. https://coreos.com.
[12] INTEL. Intel Trusted Execution Technology (Intel TXT) enabling
guide. Intel White Paper (2015).
[13] INTEL. Intel 64 and IA-32 Architectures - Software Developer’s
Manual: Vol. 3B. Intel, 2016.
[14] INTEL. Intel Trusted Execution Technology (Intel TXT). Intel
White Paper (2017).
[15] INTEL.
Intel Virtualization Technology for directed I/O.
Intel
White Paper (2017).
[16] INTEL SECURITY. Intel security center. https://security-
center.intel.com.
[17] KAUER, B. OSLO: Improving the security of trusted computing.
In USENIX Security Symposium (2007).
[18] KURSAWE, K., SCHELLEKENS, D., AND PRENEEL, B. Ana-
lyzing trusted platform communication. In ECRYPT Workshop,
CRASH-CRyptographic Advances in Secure Hardware (2005).
[19] LINUX. TPM drivers.
https://github.com/torvalds/
linux/tree/master/drivers/char/tpm.
[20] MCCUNE, J. M., PARNO, B., PERRIG, A., REITER, M. K.,
AND SESHADRI, A. Minimal TCB code execution. In Security
and Privacy, IEEE Symposium on (2007), IEEE.
[21] MCCUNE, J. M., PARNO, B. J., PERRIG, A., REITER, M. K.,
AND ISOZAKI, H.
Flicker: An execution infrastructure for
TCB minimization. In ACM SIGOPS Operating Systems Review
(2008), vol. 42, ACM.
[22] MICROSOFT.
Microsoft BitLocker
drive
encryption.
http://windows.microsoft.com/en-US/windows-
vista/BitLocker-Drive-Encryption-Overview.
[23] MICROSOFT. Windows Authenticode portable executable
http://msdn.microsoft.com/en-us/
signature format.
windows/hardware/gg463180.aspx.
[24] OPEN PLATFORM TRUST SERVICES. OpenPTS. https://
github.com/openpts/openpts.
[25] PARNO, B., MCCUNE, J. M., AND PERRIG, A. Bootstrapping
Trust in Modern Computers, 1st, ed. Springer, 2011.
[26] SAILER, R., ZHANG, X., JAEGER, T., AND VAN DOORN, L.
Design and implementation of a TCG-based integrity measure-
ment architecture. In USENIX Security Symposium (2004).
[27] SEACORD, R. Secure Coding in C and C++. SEI Series in
Software Engineering. Pearson Education, 2013.
[5] COREOS. GRand Uniﬁed Bootloader. https://github.com/
[28] SHARKEY, J. Breaking hardware-enforced security with hyper-
coreos/grub.
visors. Black Hat USA (2016).
[6] CR4SH. Lenovo ThinkPad System Management Mode arbitrary
code execution 0day exploit. https://github.com/Cr4sh/
ThinkPwn.
[7] DELL EMC. Dell EMC product security response center.
https://www.emc.com/products/security/product-
security-response-center.htm.
[8] GIGABYTE. GIGABYTE technical support. http://www.
gigabyte.us/Support/Technical-Support.
S.
structure
[9] HAN,
tpm if
//sourceforge.net/p/tboot/code/ci/
521c58e51eb5be105a29983742850e72c44ed80e/.
g tpm variable.
vulnerabilities
rooted
in
https:
Fix
security
and
[10] HAN, S., SHIN, W., PARK, J.-H., AND KIM, H.
of normal pcr values for SRTM.
kkamagui/papers/blob/master/usenix-security-
2018/appendix-SRTM-pcr-values.pdf.
List
https://github.com/
[29] SKAPE, S. Bypassing PatchGuard on Windows x64. http://
www.uninformed.org/?v=3&a=3&t=pdf, 2005.
[30] SPARKS, E. R. A security assessment of trusted platform mod-
ules. Dartmouth College, USA, Tech. Rep. TR2007-597 (2007).
[31] TRUSTED COMPUTING GROUP. TPM main part 1 design prin-
ciples. TCG White Paper (2011).
[32] TRUSTED COMPUTING GROUP. TCG PC client speciﬁc imple-
mentation speciﬁcation for conventional BIOS. TCG White Paper
(2012).
[33] TRUSTED COMPUTING GROUP. TCG D-RTM architecture.
TCG White Paper (2013).
[34] TRUSTED COMPUTING GROUP. TCG PC client speciﬁc TPM
interface speciﬁcation (TIS). TCG White Paper (2013).
[35] TRUSTED COMPUTING GROUP. TCG EFI platform speciﬁcation
for TPM family 1.1 or 1.2. TCG White Paper (2014).
[11] INTEL.
Trusted Boot.
https://www.sourceforge.net/
[36] TRUSTED COMPUTING GROUP. TCG EFI protocol speciﬁca-
projects/tboot.
tion. TCG White Paper (2016).
1244    27th USENIX Security Symposium
USENIX Association
[37] TRUSTED COMPUTING GROUP. TCG trusted platform module
[44] WOJTCZUK, R., AND RUTKOWSKA, J. Attacking Intel Trusted
library part 1: Architecture. TCG White Paper (2016).
Execution Technology. Black Hat DC (2009).
[38] TRUSTED COMPUTING GROUP. TCG ACPI speciﬁcation. TCG
[45] WOJTCZUK, R., AND RUTKOWSKA, J. Attacking Intel TXT via
White Paper (2017).
SINIT code execution hijacking. Invisible Things Lab (2011).
[39] TRUSTED COMPUTING GROUP.
TCG PC client platform
ﬁrmware proﬁle speciﬁcation. TCG White Paper (2017).
[40] TRUSTEDGRUB. TrustedGRUB. https://sourceforge.
net/projects/trustedgrub.
[46] WOJTCZUK, R., RUTKOWSKA, J., AND TERESHKIN, A. An-
other way to circumvent Intel Trusted Execution Technology. In-
visible Things Lab (2009).
[41] TRUSTEDGRUB2. TrustedGRUB2. https://github.com/
Rohde-Schwarz-Cybersecurity/TrustedGRUB2.
A Appendix
[42] UNIFIED EXTENSIBLE FIRMWARE INTERFACE. Advanced con-
ﬁguration and power interface speciﬁcation. UEFI White Paper
(2017).
[43] WILSON, L. The TCG dynamic root for trusted measurement.
TCG White Paper (2016).
We attach additional pages to present detailed informa-
tion. This appendix presents results of the DRTM test
with Intel TXT and tboot support (Table A.1) and Intel
TXT logs (Figure A.1).
PC
No.
1
2
3
4
5
6
7
8
9
PC and
mainboard model
NUC5i5MYHE
Compute Stick
STK2mv64CC
TPM
Ver.
2.0
2.0
Optiplex 7040
2.0
Q170M-MK
H170-D3HP
Q170M-C
X1 Carbon 4th
Generation
ThinkCentre
m93p
2.0
2.0
2.0
1.2
1.2
Optiplex 7040
1.2
10
11
z840
H170-D3HP
1.2
1.2
Intel TXT
support
tboot
support
Y
Y
Y
Y
N
Y
Y
Y
Y
Y
N
Y
N
Y
N
N
N
N
Y
Y
N
N
DRTM
test
Y
Note
N
Y
N
N
N
N
Y
Y
N
N
The system does not support tboot.
It is rebooted while executing the SINIT AC module.
In case of BIOS 1.8.1 version, The system is
rebooted while executing SINIT AC module.
BIOS 1.4.5 version is used for the DRTM test.
The system does not support tboot.
It is rebooted while executing the SINIT AC module.
The system does not support Intel TXT.
The system does not support tboot.
It is rebooted while executing the SINIT AC module.
The system does not support tboot.
It is rebooted while executing the SINIT AC module.
For BIOS 1.8.1, The system is rebooted while
executing the SINIT AC module.
BIOS 1.4.5 is used for the DRTM test.
The system does not support tboot.
It is rebooted while executing the SINIT AC module.
The system does not support Intel TXT.
Table A.1: Results of the DRTM test with Intel TXT and tboot support
USENIX Association
27th USENIX Security Symposium    1245
Intel ( r ) TXT C o n f i g u r a t i o n R e g i s t e r s :
STS : 0 x 0 0 0 1 8 0 9 1
s e n t e r _ d o n e : TRUE
s e x i t _ d o n e : FALSE
m e m _ c o n f i g _ l o c k : FALSE
p r i v a t e _ o p e n : TRUE
l o c a l i t y _ 1 _ o p e n : TRUE
l o c a l i t y _ 2 _ o p e n : TRUE
ESTS : 0 x00
t x t _ r e s e t : FALSE
E2STS : 0 x 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 6
s e c r e t s : TRUE
E R R O R C O D E : 0 x 0 0 0 0 0 0 0 0
DIDVID : 0 x 0 0 0 0 0 0 0 1 b 0 0 5 8 0 8 6
v e n d o r _ i d : 0 x8086
d e v i c e _ i d : 0 xb005
r e v i s i o n _ i d : 0 x1
FSBIF : 0 x f f f f f f f f f f f f f f f f
QPIIF : 0 x 0 0 0 0 0 0 0 0 9 d 0 0 3 0 0 0
SINIT . BASE : 0 x a 2 e f 0 0 0 0
SINIT . SIZE : 196608 B (0 x30000 )
HEAP . BASE : 0 x a 2 f 2 0 0 0 0
HEAP . SIZE : 917504 B (0 xe0000 )
DPR : 0 x 0 0 0 0 0 0 0 0 a 3 0 0 0 0 4 1
lock : TRUE
top : 0 x a 3 0 0 0 0 0 0
size : 4 MB ( 4 1 9 4 3 0 4 B )
PUBLIC . KEY :
2 d 67 dd d7 5 e f9 33 92 66 a5 6 f 27 18 95 55 ae
77 a2 b0 de 77 42 22 e5 de 24 8 d be b8 e3 3 d d7
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
TXT m e a s u r e d launch : TRUE
s e c r e t s flag set : TRUE
PCR 17 ( alg count 1) :
PCR 17 ( alg count 1) :
P C R I n d e x : 17
Type : 0 x501
PCR 18 ( alg count 1) :
PCR 17 ( alg count 1) :
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
... o m i t t e d ...
TBOOT :
TBOOT :
TBOOT :
TBOOT :
TBOOT :
TBOOT :
TBOOT :
TBOOT :
TBOOT :
TBOOT :
TBOOT :
TBOOT :
TBOOT :
TBOOT :
TBOOT :
TBOOT :
TBOOT :
TBOOT :
TBOOT :
TBOOT :
TBOOT :
TBOOT :
TBOOT :
TBOOT :
TBOOT :
TBOOT :
TBOOT :
TBOOT :
TBOOT :
TBOOT :
... o m i t t e d ...
P C R I n d e x : 18
Type : 0 x501
P C R I n d e x : 17
Type : 0 x501
P C R I n d e x : 17
Type : 0 x501
Data : 0 bytes
Event :
Data : 0 bytes
p o l _ h a s h : ce 78 8 c 7 b 47 b2 91 85 b8 8 c 3 c a0 7 d f7 02 e3 a1 e4 60 03
VL m e a s u r e m e n t s :
alg 0004: fb b1 b9 ea b0 c9 2 a c0 9 c 28 14 f5 38 b5 ad 02 af e0 ee af
alg 0004: fb b1 b9 ea b0 c9 2 a c0 9 c 28 14 f5 38 b5 ad 02 af e0 ee af
alg 0004: 0 b 55 c6 7 a d3 89 03 8 e 2 c d3 99 17 c0 06 8 f 20 68 d4 b1 50
alg 0004: 6 b 8 d c4 2 d 1 f 54 aa 6 b 60 98 13 b8 f2 0 e 89 2 a 5 d 14 5 c e9
Event : /* The hash of a policy c o n t r o l field and policy hash */
Digest : fb b1 b9 ea b0 c9 2 a c0 9 c 28 14 f5 38 b5 ad 02 af e0 ee af
Digest : fb b1 b9 ea b0 c9 2 a c0 9 c 28 14 f5 38 b5 ad 02 af e0 ee af
Data : 0 bytes
Event : /* The hash of a kernel file ( v m l i n u z ) and c o m m a n d lines */
Digest : 0 b 55 c6 7 a d3 89 03 8 e 2 c d3 99 17 c0 06 8 f 20 68 d4 b1 50
Data : 0 bytes
Event : /* The hash of a i n i t i a l RAM disk file ( initrd ) */
Digest : 6 b 8 d c4 2 d 1 f 54 aa 6 b 60 98 13 b8 f2 0 e 89 2 a 5 d 14 5 c e9
Figure A.1: List of the txt-stat logs and extended hashes in Intel NUC5i5MYHE. Details/authorities PCR mappings
are used.
1246    27th USENIX Security Symposium
USENIX Association