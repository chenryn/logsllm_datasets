Copyright 
  © 
  2014 
  Splunk 
  Inc. 
Security 
  Ninjutsu 
Using 
  Splunk 
  for 
CorrelaEon, 
  Anomaly 
DetecEon 
  and 
Response 
  AutomaEon 
David 
  Veuve 
SE, 
  Splunk 
Who 
  Am 
  I? 
  David 
  Veuve 
  – 
  Sales 
  Engineer 
  for 
  Major 
  Accounts 
  in 
  Northern 	California 
 PI:EMAIL
  Former 
  Splunk 
  Customer 
  (For 
  3 
  years, 
  3.x 
  through3 
  years, 
  3.x 
  through 
  4.3) 
  Security 
  Guy 
  Primary 
  author 
  of 
  Splunk 
  Search 
  Usage 
  app 
  Primary 
  area 
  of 
  Splunk 
  ExperEse: 
  Search 
  Language 
  Stands 
  on 
  the 
  shoulders 
  of 
  giants 
2 
Disclaimer 
During 
  the 
  course 
  of 
  this 
  presentaEon, 
  we 
  may 
  make 
  forward 
  looking 
  statements 
  regarding 
  futurestatements 
  regarding 
  future 
  events 
  or 
  the expected 
  performance 
  of 
  the 
  company. 
  We 
  cauEon 
  you 
  that 
  such 
  statements 
  reflect 
  our 
  current 
  expectaEons 
  and esEmates 
  based 
  on 
  factors 
  currently 
  known 
  to 
  us 
  and 
  that 
  actual 
  events 
  or 
  results 
  could 
  differ 
  materially. 
  For important 
  factors 
  thatFor important 
  factors 
  that 
  may 
  cause 
  actual 
  results 
  to 
  differ 
  from 
  those 
  contained 
  in 
  our 
  forward-­‐looking 
  statements, please 
  review 
  our 
  filings 
  with 
  the 
  SEC. 
  The 
  forward-­‐looking 
  statements 
  made 
  in 
  the 
  this 
  presentaEon 
  are 
  being 
  made 
  as of 
  the 
  Eme 
  and 
  date 
  of 
  its 
  liveand 
  date 
  of 
  its 
  live 
  presentaEon. 
  If 
  reviewed 
  a^er 
  its 
  live 
  presentaEon, 
  this 
  presentaEon 
  may 
  not 
  contain current 
  or 
  accurate 
  informaEon. 
  We 
  do 
  not 
  assume 
  any 
  obligaEon 
  to 
  update 
  any 
  forward 
  looking 
  statements 
  we 
  may make. 
  In 
  addiEon, 
  any 
  informaEon 
  about 
  our 
  roadmap 
  outlinesabout 
  our 
  roadmap 
  outlines 
  our 
  general 
  product 
  direcEon 
  and 
  is 
  subject 
  to 
  change at 
  any 
  Eme 
  without 
  noEce. 
  It 
  is 
  for 
  informaEonal 
  purposes 
  only 
  and 
  shall 
  not, 
  be 
  incorporated 
  into 
  any 
  contract 
  or other 
  commitment. 
  Splunk 
  undertakes 
  no 
  obligaEon 
  either 
  to 
  develop 
  the 
  featuresto 
  develop 
  the 
  features 
  or 
  funcEonality 
  described 
  or 
  to include 
  any 
  such 
  feature 
  or 
  funcEonality 
  in 
  a 
  future 
  release. 
3 
Agenda 
•Visibility 
  – 
  Analysis 
  – 
  AcEon 
  in 
  Four 
  Scenarios 
1.Threat 
  List 
  IntegraEon 
  leads 
  to 
  Firewall 
  Blocks 2.Anomaly 
  DetecEon 
  leads 
  to 
  Opening 
  a 
  Ticket 
3.BehavioralOpening 
  a 
  Ticket 
3.Behavioral 
  Profiling 
  leads 
  to 
  Manager 
  ConfirmaEon 4.Visual 
  CorrelaEon 
  of 
  Security 
  Indicators 
4 
Being 
  Covered 
1.Tools 
  and 
  Searches 
  and 
  Demos 
2.All 
  of 
  these 
  examples 
  and 
  concepts 
  come 
  from 
  actual 
  customer 	requirements 
  and 
  actual 
  customer 
  deployments. 
  No 
  smoke 
  and 	mirrors.No 
  smoke 
  and 	mirrors. 
3.Github 
  with 
  data 
  gens 
  and 
  accoutrement 
  at 
  end 
  of 
  presentaEon 
5 
Who 
  Are 
  You? 
1.Security 
  Engineer 
  / 
  SOC 
  Analyst 
  / 
  Threat 
  Analyst 
  / 
  Someone 	Technical 
  Who 
  Cares 
  about 
  Security 
2.Splunk 
  skill 
  level 
  is 
  basic-­‐advanced 
3.No 
  Enterprise 
  Security 
  required 
  (though 
  itrequired 
  (though 
  it 
  can 
  make 
  things 
  easier 	at 
  scale) 
6 
Visibility 
  – 
  Analysis 
  – 
  AcEon 
•Framework 
  for 
  evaluaEng 
  data 
  and 
  responding 
  Splunk 
•Applies 
  to 
  all 
  exisEng 
  frameworks, 
  as 
  it’s 
  the 
  Splunk 
  side 
  of 
  the 
  loop. 
•For 
  example, 
  Let’s 
  look 
  at 
  the 
  lateral 
  movement 
  secEon 
  of 
  themovement 
  secEon 
  of 
  the 
  kill 	chain. 
  (Not 
  familiar 
  with 
  the 
  kill 
  chain? 
  It’s 
  a 
  great 
  way 
  to 
  understand 
  the 
  phases 
  of 
  an 
  agack. 
  Check 	the 
  URL 
  below.) 
•Visibility: 
  What 
  data 
  will 
  let 
  you 
  detect 
  Lateral 
  Movement? 
•Analysis: 
  What 
  will 
  you 
  do 
  to 
  that 
  data 
  to 
  come 
  to 
  adata 
  to 
  come 
  to 
  a 
  decision? •Ac2on: 
  What 
  will 
  you 
  do 
  in 
  response 
  to 
  that 
  decision? 
–Can 
  we 
  automate 
  all 
  of 
  this? 
• Kill 
  Chain: 
  hgp://www.lockheedmarEn.com/content/dam/lockheed/data/corporate/documents/LM-­‐White-­‐Paper-­‐Intel-­‐Driven-­‐Defense.pdf 
7 
Scenario 
  One 
C&C 
  DetecEon 
and 
  Blocking 
Command 
  and 
  ControlBlocking 
Command 
  and 
  Control 
  DetecEon 
  and 
  Blocking 
•New 
  threat 
  list 
  intel 
  (or 
  any 
  other 
  source 
  of 
  detecEng 
  agackers) 
  has 
  become 	available, 
  and 
  we 
  are 
  trying 
  to 
  block 
  any 
  outbound 
  Command 
  and 
  Control. •The 
  formal 
  firewall 
  policy 
  can’t 
  be 
  pushed 
  except 
  every 
  Wed 
  night 
  andevery 
  Wed 
  night 
  and 
  Sunday 	night 
  – 
  not 
  fast 
  enough. 
•Goal: 
  Take 
  in 
  the 
  firewall 
  logs, 
  leverage 
  our 
  available 
  intelligence 
  to 
  detect 	C&C 
  behavior, 
  and 
  then 
  block 
  the 
  desEnaEons, 
  all 
  in 
  near 
  realEme. 
•Visibility: 
  Firewall 
  Logs, 
  Threat 
  Intel 
  Sources •Analysis: 
  IntersecEon 
  (lookup) 
  ofIntersecEon 
  (lookup) 
  of 
  the 
  two •Ac2on: 
  Apply 
  dynamic 
  firewall 
  blocks 
9 
What 
  / 
  Where 
  is 
  Threat 
  Intelligence 
  A 
  feed 
  of 
  known 
  bad 
  IPs/DNS 
  Names/MD5s/URLs/etc 
  from 
  a vendor 
  or 
  non-­‐profit 
  that 
  specializes 
  in 
  discovering 
  Indicators of 
  Compromise. 
  Great 
  sources 
  of 
  Open 
  Source 
  Threatof 
  Open 
  Source 
  Threat 
  Intel 
  include: –Emerging 
  Threats: 
  hgp://rules.emergingthreats.net/–I-­‐Blocklist: 
  hgps://www.iblocklist.com/lists.php
–MalwareDomains: 
  hgp://www.malwaredomains.com/–Zeus 
  Tracker: 
  hgps://zeustracker.abuse.ch/
  Many 
  great 
  commercial 
  enEEes 
  too 
  (generally 
  beger 
  ranking 
  / 	quality): 
	–Norse 
  (Splunk 
  Partner),–Norse 
  (Splunk 
  Partner), 
  iSight 
  Partners, 
  Verizon 
  iDefense, 
  Commercial 10 
	Versions 
  of 
  most 
  of 
  the 
  above, 
  and 
  many 
  many 
  more 
Visibility 
	ConnecEon 
  End 
  Date 
Palo 
  Alto 
  Networks 
  Firewall 
  Log 	Src 
  and 
  Dest 
  IPs 	Firewall 
  Rule 
Sep 
  15 
  19:02:06 
  1,2014/09/15Sep 
  15 
  19:02:06 
  1,2014/09/15 
  19:02:06,0004C104559,TRAFFIC,end,1,2014/09/15 19:02:05,10.2.2.14,206.16.215.101,206.16.216.158,214.34.245.101,Internet 
  Traffic,,, salesforce-­‐base,vsys1,Trust,Untrust,ethernet1/8,ethernet1/2,MyLogForwarding, 2014/09/15 
  19:02:05,24238,1,61845,443,57339,443,0x400000,tcp,allow, 
1275,761,514,14,2014/09/15 
  19:01:31,5,any,0,358477769,0x0,19:01:31,5,any,0,358477769,0x0, 
  10.0.0.0-­‐10.255.255.255, United 
  States,0,8,6 	ApplicaEon 	To/From 
  Zone 	Dest 
  Port 
Threat 
  Intel 
  Lookup: 
bad_ip,threat_intel_source 
115.29.46.99/32,zeus_c2s 
61.155.30.0/24,cymru_hgp 
11 
	Analysis 
index=pan_logs 
  sourcetype=pan_traffic 
  src=“10.*” 
  dest!=“10.*” 
| 
  lookup 
  ThreatIntel 
  dest  | 
  search 
  ThreatList=*  Datasearch 
  ThreatList=*  Data 
  held 
  in 
  Lookup 
  Table 
	Name 
  of 
  our 
  lookup, 
  and 
	the 
  key 
  field 
•First, 
  we 
  want 
  to 
  pull 
  out 
  all 
  firewall 
  traffic 
  coming 
  from 
  inside 	our 
  network, 
  going 
  outside 
  our 
  network. 
•Then, 
  we 
  want 
  to 
  cross-­‐reference 
  that 
  data 
  with 
  our 
  Threat 
  Intel 	list. 
  This 
  isThreat 
  Intel 	list. 
  This 
  is 
  accomplished 
  in 
  the 
  Splunk 
  world 
  via 
  a 
  lookup. 
•Finally, 
  we 
  want 
  to 
  pull 
  just 
  the 
  logs 
  that 
  have 
  Threat 
  Intel 
12 
Analysis 
  -­‐ 
  Challenges 
  Performance 
  – 
  you 
  get 
  lots 
  of 
  traffic, 
  maybe 
  you 
  have 
  lots 
  of 	threat 
  intel 
  entries. 
–SoluEon: 
  Enterpriseentries. 
–SoluEon: 
  Enterprise 
  Security 
  is 
  built 
  to 
  solve 
  this 
  problem 
  at 
  scale. –Alternate 
  SoluEon: 
  data 
  models 
  help 
  substanEally 
  with 
  the 
  first 
  half. 
  You 	can 
  fragment 
  the 
  lookups 
  if 
  you 
  get 
  to 
  very 
  high 
  numbers. 
  MulEple 
  Threat 
  Lists 
  – 
  DeprioriEze 
  Open 
  source 
  threat 
  listOpen 
  source 
  threat 
  list 
  vs 	Premium 
  threat 
  list 
	–SoluEon: 
  Enterprise 
  Security 