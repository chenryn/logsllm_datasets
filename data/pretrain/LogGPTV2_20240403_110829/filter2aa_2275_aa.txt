Defense&by&Numb3r5&
&
Making'problems'for'script'k1dd13s'
and'scanner'monkeys!
@ChrisJohnRiley'
“THE'WISEST'MAN,'IS'HE'
WHO'KNOWS,'THAT'HE'
KNOWS'NOTHING”'
'
'
SOCRATES:'APOLOGY,'21D'
This&talk&contains:!
!- Numbers 
 - Bad Jokes 
 - Traces of peanuts 
 - Did I mention numbers? 
!!
TL!;DR!
Goals!for!this!talk!
Describe!the!
defensive!uses!of!
HTTP!status!codes!
1)  What&
2)  Why&
3)  How&
4)  Goals&
5)  Bringing&it&together&
6)  Review&
#1&
]!
[!WHAT ? 
HTTP!STATUS!CODES!
Seems!like!such!a!!
Small!detail!
…!small!detail,!
big!impact!
HTTP!Status!Codes!
!  Majority!part!of!RFC!2616!(HTTP/1.1)!
!  5!main!classes!of!response!
!  1XX!informaOonal'
!  2XX!success!
!  3XX!redirecOon!
!  4XX!client'error!
!  5XX!server'error!
HTTP!Status!Codes!
!  Proposed!RFC*!for!7XX!codes!
!  Examples:!
!  701!Meh'
!  719!I'am'not'a'teapot!
!  721!Known'unknowns!
!  722!Unknown'unknowns!
!  732!Fucking'Unicde'
*!h]ps://github.com/joho/7XX_rfc!
BASICS!
AKA:!THE!BORING!THEORY!BIT!
#1.1&
1XX!Informaeonal!
!  Indicates!response!received!
!  Processing!is!not!yet!completed!
!  100!Conenue!
!  101!Switching!Protocols!
!  102!Processing!(WebDAV!RFC!2518)!
2XX!Success!
!  Indicates!response!received!
!  Processed!and!understood!
!  200!OK!
!  201!Created!
!  202!Accepted!
!  203!Non_Authoritaeve!Informaeon!
!  204!No!Content!
2XX!Success!(cont.)!
!  205!Reset!Content!
!  206!Pareal!Content!
!  207!Mule_Status!(WebDAV!RFC!4918)!
Codes!not!supported!by!Apache!
! 
208!Already!Reported!
! 
226!IM!Used!
! 
250!Low!on!Storage!Space!
3XX!Redireceon!
!  Aceon!required!to!complete!request!
!  300!Muleple!Choices!
!  301!Moved!Permanently!
!  302!Found!(Moved!Temporarily)!
!  303!See!Other!
!  304!Not!Modiﬁed!
3XX!Redireceon!(cont.)!
!  305!Use!Proxy!
!  306!Switch!Proxy!(unused)!
!  307!Temporary!Redirect!
Codes!not!supported!by!Apache!
! 
308!Permanent!Redirect!
4XX!Client!Error!
!  Client!caused!an!error!
!  400!Bad!Request!
!  401!Unauthorized!
!  402!Payment!Required!
!  403!Forbidden!
!  404!Not!Found!
!  405!Method!Not!Allowed!
4XX!Client!Error!(cont.)!
!  406!Not!Accessible!
!  407!Proxy!Authenecaeon!Required!
!  408!Request!Timeout!
!  409!Conﬂict!
!  410!Gone!
!  411!Length!Required!
4XX!Client!Error!(cont.)!
!  412!Precondieon!Failed!
!  413!Request!Enety!Too!Large!
!  414!Request_URI!Too!Long!
!  415!Unsupported!Media!Type!
!  416!Request!Range!Not!Saesﬁable!
!  417!Expectaeon!Failed!
!  418!I’m!a!Teapot!(IETF!April!Fools!RFC!2324)!
4XX!Client!Error!(cont.)!
!  419!/!420!/!421!Unused!
!  422!Unprocessable!Enety!(RFC!4918)!
!  423!Locked!(RFC!4918)!
!  424!Failed!Dependency!(RFC!4918)!
!  425!No!Code!/!Unordered!Colleceon!
!  426!Upgrade!Required!(RFC!2817)!
4XX!Client!Error!(cont.)!
Codes!not!supported!by!Apache!
! 
428!Precondieon!Required!
! 
429!Too!Many!Requests!
! 
431!Request!Header!Fields!Too!Large!
! 
444!No!Response!(NGINX)!
! 
449!Retry!With!(Microsoo)!
! 
450!Blocked!by!Win.!Parental!Controls!
! 
451!Unavailable!For!Legal!Reasons!
! 
494!Request!Header!Too!Large!(NGINX)!
! 
495!Cert!Error!(NGINX)!
! 
496!No!Cert!(NGINX)!
! 
497!HTTP!to!HTTPS!(NGINX)!
! 
499!Client!Closed!Request!(NGINX)!
5XX!Server!Error!
!  Server!error!occurred!
!  500!Internal!Server!Error!
!  501!Not!Implemented!
!  502!Bad!Gateway!
!  503!Service!Unavailable!
!  504!Gateway!Timeout!
!  505!HTTP!Version!Not!supported!
5XX!Server!Error!(cont.)!
!  506!Variant!Also!Negoeates!(RFC!2295)!
!  507!Insuﬃcient!Storage!(WebDAV!RFC!4918)!
!  508!Loop!Detected!(WebDAV!RFC!5842)!
!  509!Bandwidth!Limit!Exceeded!(apache!ext.)!!
!  510!Not!Extended!(RFC!2274)!
Codes!not!supported!by!Apache!
! 
511!Network!Authenecaeon!Required!(RFC!6585)!
! 
550!Permission!Denied!
! 
598!Network!Read!Timeout!Error!(Microsoo!Proxy)!
! 
599!Network!Conneceon!Timeout!Error!(Microsoo!Proxy)!
OMG!Enough!with!
the!numb3rs!
already!!!!'
#2&
]!
[!WHY ? 
It!started!as!a!simple!idea…!
?!
?!
?!
…!and!started!to!think!
SCREW!WITH!
SCANNERS!
…!AND!SCRIPT!
K1DD13S!
THAT!SOUNDS!
LIKE!FUN!'
@thegrugq)26)Feb)2013)
@thegrugq)26)Feb)2013)
INCREASE!
ATTACKER!COSTS!
$!
$!
$!
WASTE!
ATTACKER!TIME!
_ 
When!the!tables!turn!(2004)!!
_ 
Roelof'Temmingh,'Haroon'Meer,'Charl'van'der'Walt'
_ 
h]p://slideshare.net/sensepost/strikeback!
_ 
Stopping!Automated!A]ack!Tools!(2006)!
_ 
Gunter'Ollmann'
_ 
h]p://www.technicalinfo.net/papers/
StoppingAutomatedA]ackTools.html!!
Prior!Art!
_ 
mod_security!mailing!list!(2006)!!
_ 
Status!Code!503!together!w/!Retry_Aoer!header!
_ 
Ryan'BarneW'
_ 
h]p://bb10.com/apache_mod_security_user/
2006_12/msg00042.html!
Prior!Art!
SecFilterDefaultAceon!"deny,log,status:503"!
SecFilter!".*"!
Header!set!Retry_Aoer!"120"!
#3&
]!
[!HOW ? 
BROWSERS!HAVE!
TO!BE!FLEXIBLE!
THIS!LEADS!TO!
INTERPRETATION!
…!which'leads'to'the'darkXside'
RFCS…!
!
THEY’RE!MORE!OF!A!
GUIDELINE!REALLY!
WHAT COULD POSSIBLY GO 
WRONG! 
TESTING!
THE!HOW!OF!THE!THING!!
#3.1&
!  Restricted!research!to!the!big!3!
!  Internet!Explorer!
!  Chrome!/!Chromium!
!  Firefox!
NO…!SAFARI!ISN’T!
IN!THE!TOP!10!3!
OPERA!JUMPED…!
…or'was'it'pushed?'
LYNX!
THE!UNREALISTIC!OPTION!
!  MITMproxy!/!MITMdump!
!  Python_based!
!  Simple!to!setup!proxy!/!reverse!proxy!
!  Script_based!aceons!
!  PHP!
!  Ability!to!set!response!code!
!  Must!be!at!the!top!of!the!PHP!code!
!  Can!be!added!to!php.ini!
!  auto_prepend_ﬁle!=!/full/path!
!  Limited!by!web_server!(apache)!
#!set!response!code!
Header($_server[“SERVER_PROTOCOL”].!”!$status_code”);!
!  Teseng!browsers!automaecally!
!  Created!PHP!ﬁle!to!set!status!code!
!  h]p://c22.cc/POC/respcode.php?code=XXX'
BROWSERS!
…!AND!THEIR!STATUS!CODE!HABITS!
#3.2&
Miss 
Browsers!handle!
most!things!just!like!
they!handle!a!
200&OK?!
YEP…!
MOSTLY'
!  HTML!Responses!
! 
Almost!all!response!codes!are!rendered!
by!the!browser!correctly!
!  iFrames!
! 
Some!special!cases!for!IE,!but!other!
browsers!handle!this!the!same!as!HTML!
!
!  JavaScript/CSS!
! 
Limited!accepted!status!codes!
! 
Limited!3XX!support!
! 
Chrome!is!the!excepeon!here!
! 
No!support!for!4XX/5XX!codes!
So!we!know!
what!browsers!
interpret!
diﬀerently'
What!do!
browsers!have!
in!common?!
!  1XX!code!handling!
!  Retries!
!  Confusion!
!  Chrome!/!IE6!try!to!download!the!page!!
!  Fun!on!Android…!(never!ending!download)!
!  Times!outs!(eventually)!
!  204!No!Content!
!  Um,!no!content!!
!  304!Not!Modiﬁed!
!  Again,!no!content!returned!
WHAT!ABOUT!
HEADERS?!
#3.3&
Just!because!the!RFC!says!
a!speciﬁc!status!code!
must!have!an!associated!
header…!
…doesn’t!mean!
it!HAS!to!
!  Redireceon!codes!(301_304,!307)!
! 
No!Locaeon!header,!no!redirect!
!  401!Unauthorized!
! 
No!WWW_Authenecate!header,!no!
authenecaeon!prompt!
!  407!Proxy!Authenecaeon!Required!
! 
No!Proxy_Authenecate!header,!no!prompt!
Just!because!the!RFC!says!
a!speciﬁc!status!code!
shouldn’t!have!an!
associated!header…!
!
…doesn’t!mean!
it!can’t!
!  300!Muleple!Choices!w/!Locaeon!Header!
!  Firefox!/&IE6!follows!the!redirect!
! 
Chrome!doesn’t!
!  More!research!needed!in!this!direceon!
! 
Most!headers!are!unintereseng!/&ignored!
EACH!BROWSER!
HANDLES!THINGS!A!
LITTLE!DIFFERENTLY!
I!WONDER!WHAT!
WE!CAN!DO!
WITH!THAT!!
#4&
]!
[!GOALS 
!  Each!browser!handles!things!diﬀerently!
! 
Use!known!condieons!
! 
Handled!codes!
! 
Unhandled!codes!
! 
Browser!weirdness!
BROWSER!
FINGERPRINTING!
#4.1&
! 
Doesn’t!load!JavaScript!returned!with!a!300!
‘Muleple!Choices’!status!code!
! 
Other!browsers!tested!DO!(IE/Chrome)!
!
! 
Request!JavaScript!from!server!
! 
Response!Status:!300!Muleple!Choices!
! 
If!JavaScript!doesn’t!run!in!the!browser!
! 
Firefox!
Firefox!
! 
Loads!JavaScript!returned!with!a!307!
‘Temporary!Redirect’!status!code!
! 
Other!browsers!tested!DON’T!(IE/FF)!
! 
Request!JavaScript!from!server!
! 
Response!Status:!307!Temporary!Redirect!
! 
If!JavaScript!runs!in!the!browser!
! 
Chrome!
Chrome!!
! 
Loads!JavaScript!returned!with!a!205!‘Reset!
Content’!status!code!
! 
Other!browsers!tested!DON’T!(FF/Chrome)!
! 
Request!JavaScript!from!server!
! 
Response!Status:!205!Reset!Content!
! 
If!JavaScript!runs!in!the!browser!
! 
Internet!Explorer!
Internet!Explorer !!
BROWSER!
FINGERPRINTING!
DEMO!
!  Other!opeons!to!ﬁngerprint!browsers!
! 
300!Redirect!(Chrome)!
! 
305!/&306!JavaScript!(Firefox)!
! 
400!iFrame!(Internet!Explorer)!
! 
…'