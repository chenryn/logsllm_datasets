2022/2/22 17:19
1.md
ï¬le:///Users/s3gundo/Documents/markdown/vulns/java/jira/1.md
1/18
jiraç¯å¢ƒæ­å»ºåŠå—é™â½‚ä»¶è¯»å–åŸç†å’Œæ·±æ€CVE-
2021-26086
â¼€ã€è¸©å‘
å‘å¤ªå¤šäº† è£…äº†å·®ä¸å¤šä¸ƒâ¼‹ä¸ªâ¼©æ—¶æ‰è£…å¥½ ä¹Ÿæ˜¯ç»™â¾ƒâ¼°æ‰¾â¼€äº›ç»éªŒã€‚ä¸è¿‡ä¸å¾—ä¸è¯´åœ¨è£…è½¯ä»¶çš„åŒæ—¶
ä¹Ÿå­¦åˆ°äº†â¾®å¸¸å¤šçš„ä¸œâ»„ï¼Œå®æˆ˜çš„é¡¹â½¬æ„Ÿè§‰å°±æ˜¯ä¼šæœ‰ä¸â¼€æ ·çš„æ„Ÿè§‰ã€‚å¤šåŠ¨â¼¿æ€»æ˜¯ä¼šæœ‰å¥½å¤„çš„ã€‚
æˆ‘å…ˆå‘â¼ä¸ªæ­¥éª¤ ç„¶åç½—åˆ—â¼€ä¸‹æˆ‘çŒœåˆ°çš„â¼€äº›å‘çš„ç‚¹ï¼Œç®—æ˜¯æŠŠè¿™ä¸ªç¯å¢ƒç»™è£…å¥½äº†ã€‚å› ä¸ºæˆ‘æ˜¯macç³»
ç»Ÿï¼Œå‚ç…§ç€â¼€ä¸ªæ­¥éª¤æ¥çš„ï¼Œä½†æ˜¯ä¸­é—´å¤¹åœ¨çš„å¦å¤–çš„ï¼Œå› ä¸ºä¸æ˜¯é€šâ½¤çš„ç ´è§£æ’ä»¶ï¼Œæ€•è¸©å‘äº†ã€‚
â¼€ã€å®‰è£…æ­¥éª¤
https://blog.csdn.net/pang787559613/article/details/101269073
https://www.jianshu.com/p/da0ddd124be8
å‰åŠéƒ¨åˆ†åŸºæœ¬æŒ‰ç…§ç¬¬â¼€ä¸ªé“¾æ¥ï¼ŒååŠéƒ¨åˆ†æŒ‰ç…§ç¬¬â¼†ä¸ªé“¾æ¥è¿›â¾é…ç½®ï¼š
â¼†ã€å‘ç‚¹
å…¶å®ä¸ºäº†å…¼å®¹åâ¾¯çš„è½¯ä»¶ mysql5.7çš„å®‰è£…æ˜¯â½è¾ƒå¥½çš„ï¼Œæ—¢å¯ä»¥å…¼å®¹å‰â¾¯â½¼ç‰ˆæœ¬çš„è½¯ä»¶ï¼Œåâ¾¯çš„æ–°
ç‰ˆä¹Ÿä¼šå…¼å®¹è¿™ä¸ªã€‚æ„Ÿè§‰ç›¸å½“äºjava8â¼€æ ·åœ°ä½çš„å­˜åœ¨ã€‚åœ¨è¿™â¾¥æˆ‘é€‰å–çš„æ˜¯5.7.31 å¹¶ä¸”ä¸æ˜¯â½¤
homebrewå®‰è£…çš„ï¼ˆæ„Ÿè§‰å‘è¿˜æŒºå¤šçš„ï¼‰
â¼€ã€mysqlæˆ‘åœ¨å®‰è£…çš„è¿‡ç¨‹ä¸­å…¶å®ä¼šé‡åˆ°ç»å…¸é—®é¢˜ï¼Œå°±æ˜¯ç¬¬â¼€æ¬¡ç™»å½•ä¼šæ‹’ç»ç™»å½•ï¼Œæ‰€ä»¥â¼€èˆ¬å…ˆå®‰
å…¨æ¨¡å¼å¯åŠ¨ï¼Œç„¶åä¿®æ”¹å¯†ç å¹¶ flush privilege å°±å¯ä»¥äº†ã€‚
â¼†ã€macä¸Šâ¾¯mysqlçš„å®‰è£…é»˜è®¤ä¸ä¼šâ½£æˆ /etc/my.cnf çš„é…ç½®â½‚ä»¶ï¼Œéœ€è¦â¾ƒâ¼°touchâ¼€ä¸ªå¹¶â¾ƒâ¼°å†™
â¼€ä¸ªé»˜è®¤çš„é…ç½®ã€‚ é…ç½®ä¸Šâ¾¯jiraé»˜è®¤éœ€è¦çš„å­—ç¬¦é›†å’Œsslçš„é—®é¢˜ã€‚
å› ä¸ºemojiç­‰è¡¨æƒ…ç¬¦å·çš„å‡ºç°ï¼Œæ›´â¼´æ³›çš„ç¼–ç é›†éœ€è¦æ‹¥æŠ±æ—¶ä»£çš„å˜åŒ–ï¼Œæ‰€ä»¥æˆ‘ä»¬å°½å¯èƒ½çš„å†å»æŠ›å¼ƒ
utf8è½¬å‘utf8mb4ï¼Œå°±åƒjiraé‚£æ ·(utf8mb4æ˜¯utf8çš„è¶…é›†ï¼Œç†è®ºä¸Šç”±utf8å‡çº§åˆ°utf8mb4å­—ç¬¦ç¼–ç 
æ²¡æœ‰ä»»ä½•å…¼å®¹é—®é¢˜)
https://confluence.atlassian.com/adminjiraserver/connecting-jira-applications-to-m
è¿™æ˜¯å­—ç¬¦é›†çš„è§£å†³åŠæ³• æ³¨æ„mysqldå’Œclientä¸‹â¾¯å¯¹åº”çš„é…ç½®åˆ«å†™åäº†ã€‚ 
  [client] 
  #jira config 
  default-character-set = utf8mb4 
  default-character-set=utf8mb4 
2022/2/22 17:19
1.md
ï¬le:///Users/s3gundo/Documents/markdown/vulns/java/jira/1.md
2/18
ä¸‰ã€ä¹‹å‰â¼€ç›´æŒ‰ç…§å‰â¾¯çš„æ­¥éª¤ä½¿â½¤è¯•â½¤ç‰ˆçš„å¯†é’¥ï¼Œåæ¥æˆ‘å»å®˜â½¹ä¸Šâ¾¯æŸ¥çœ‹ï¼Œä½¿â½¤å¯†é’¥æ˜¯ä¸éœ€è¦è”
â½¹çš„ï¼Œæ‰€ä»¥ä¸æ˜¯â½¹å€è¢«bançš„é—®é¢˜ï¼ˆå†µä¸”æˆ‘è¿˜æŒ‚äº†å…¨å±€ä»£ç†ï¼‰ã€‚ä¹‹åæˆ‘å°†é—®é¢˜ç¿»è¯‘ä¸ºè‹±â½‚ï¼Œå»jira
çš„ç¤¾åŒºçœ‹çœ‹ï¼š
  #password   = your_password   
  port        = 3306   
  socket      = /tmp/mysql.sock    
  # Here follows entries for some specific programs   
  # The MySQL server   
  [mysqld] 
  character-set-client-handshake = FALSE 
  character-set-server = utf8mb4
  collation-server = utf8mb4_unicode_ci 
  default-storage-engine=INNODB 
  character_set_server=utf8mb4 
  innodb_default_row_format=DYNAMIC 
  innodb_large_prefix=ON 
  innodb_file_format=Barracuda 
  innodb_log_file_size=2G 
  skip_ssl #è¿™â¾¥æ˜¯å¿½ç•¥sslå®‰å…¨è¿æ¥çš„é—®é¢˜ 
è¿™æ˜¯åˆ›å»ºjiraå¯¹åº”æ•°æ®åº“æ—¶ æ·»åŠ æ‰€éœ€è¦çš„æ•°æ®é›† 
CREATE DATABASE Jira CHARACTER SET utf8mb4 COLLATE utf8mb4_bin; 
ALTER DATABASE Jira DEFAULT CHARACTER SET = utf8mb4 DEFAULT COLLATE = utf8mb4_bin
æ£€æŸ¥ä¿®æ”¹ 
mysql> SHOW VARIABLES WHERE Variable_name LIKE 'character\_set\_%' OR Variable_nam
ä¿®å¤&ä¼˜åŒ–æ‰€æœ‰æ•°æ®è¡¨ 
> mysqlcheck -u root -p --auto-repair --optimize --all-databases 
macä¸Šâ¾¯mysqlçš„é‡å¯å‘½ä»¤ 
> sudo /usr/local/mysql/support-files/mysql.server restart
We're unable to confirm that Jira license 
https://community.atlassian.com/t5/Jira-Software-questions/We-re-unable-to-confirm
https://community.atlassian.com/t5/Jira-Software-questions/why-I-have-got-unconfi
å¾—åˆ°çš„ç­”æ¡ˆå°±æ˜¯ åº”è¯¥ä¸å¤ªå­˜åœ¨è¿™ç§æƒ…å†µï¼Œå»ºè®®çœ‹çœ‹â½‡å¿— 
You can find these in $JIRAHOME/log/atlassian-jira.log  
 $JIRAINSTALL/logs/catalina.out file.  
 ç„¶åæˆ‘å°±å»ç¿»çœ‹äº†è¿™ä¸¤ä¸ªâ½‡å¿—ï¼Œå‘ç°æ²¡æœ‰æ¿€æ´»ç›¸å…³çš„é”™è¯¯ï¼Œä½†æ˜¯æˆ‘çœ‹åˆ°äº†å…¶ä»–çš„é”™è¯¯ï¼Œæˆ‘ä¹‹å‰è®¾ç½®äº†mysqlä¸éœ€
 jdbc:mysql://address=(protocol=tcp)(host=localhost)(port=3306)/jira?useUnic
2022/2/22 17:19
1.md
ï¬le:///Users/s3gundo/Documents/markdown/vulns/java/jira/1.md
3/18
ç„¶åå»æ‰¾äº†â¼€ä¸‹æ’ä»¶çš„giteeï¼Œå‘ç°è¿™ä¸ªæ’ä»¶â¾ƒå¸¦äº†kengençš„åŠŸèƒ½ï¼Œè¿™ä¸ªæ˜¯æ’ä»¶â¾¥â¾¯çš„ç ´è§£æ­¥
éª¤ï¼š
https://www.cnblogs.com/sanduzxcvbnm/p/13809276.html
æˆ‘è¾“â¼Šçš„ï¼š
ç»¼ä¸Šï¼Œâ¼€äº›jiraç¤¾åŒºå¸®åŠ©æˆ‘è§£å†³é—®é¢˜çš„url
Atlassianå®¶æ—æ’ä»¶
java -jar atlassian-agent.jar -d -m PI:EMAIL -n s3gundo -p jira -o http://
ä¹‹åä¼šå¾—åˆ° 
https://community.atlassian.com/t5/Jira-Software-questions/The-database-setup-is-
https://community.atlassian.com/t5/Jira-Software-questions/why-I-have-got-unconfi
https://community.atlassian.com/t5/Jira-Software-questions/We-re-unable-to-confirm
https://community.atlassian.com/t5/Jira-Software-questions/WARN-Establishing-SSL-
https://community.atlassian.com/t5/Confluence-questions/SSL-errors-with-confluenc
https://community.atlassian.com/t5/Jira-Software-questions/why-I-have-got-unconfi
https://community.atlassian.com/t5/Jira-Software-questions/We-re-unable-to-confirm
https://community.atlassian.com/t5/Jira-Software-questions/The-database-setup-is-
2022/2/22 17:19
1.md
ï¬le:///Users/s3gundo/Documents/markdown/vulns/java/jira/1.md
4/18
https://gitee.com/pengzhile/atlassian-agent 
è¯·â½€æŒæ­£ç‰ˆ
â¼†ã€æ¼æ´å¤ç°è°ƒè¯•
è¿™â¾¥çš„jira homeæ˜¯æˆ‘ä»¬ä¹‹å‰è®¾ç½®è¿‡äº†çš„ï¼Œç„¶åæŠŠweb-infä¸‹â¾¯çš„libæ·»åŠ åˆ°åº“å°±å¯ä»¥äº†ï¼Œæˆ‘â¼€èˆ¬æ˜¯
æ•´ä¸ªâ½‚ä»¶å¤¹ç›´æ¥å¯¼â¼Šã€‚
CVE-2021-26086 å—é™â½‚ä»¶è¯»å–æŒ–æ˜åˆ†æ
å‚è€ƒâ½‚ç« ï¼š https://tttang.com/archive/1323/ æ¢…â¼¦é…’å¸ˆå‚…çš„ å¸ˆå‚…çš„â½‚ç« ä¸­å¯èƒ½æœ‰ä¸¤å¤„ç¬”è¯¯ã€‚1ã€
æ˜¯å¯¹urlè·¯å¾„çš„è§£æ2ã€jiraloginfilterçš„é—®é¢˜
https://xz.aliyun.com/t/10444
å…ˆæ”¾poc
set JAVA_OPTS=%JAVA_OPTS% -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=
CATALINA_OPTS="-Xdebug -Xrunjdwp:transport=dt_socket,address=60222,suspend=n,serv
/s/cfx/_/;/WEB-INF/web.xml  
/s/cfx/_/;/WEB-INF/decorators.xml  
/s/cfx/_/;/WEB-INF/classes/seraph-config.xml  
2022/2/22 17:19
1.md
ï¬le:///Users/s3gundo/Documents/markdown/vulns/java/jira/1.md
5/18
å› ä¸ºburpæŠ“ä¸åˆ°localhostå’Œ127.0.0.1çš„çš„åŒ…ï¼Œæˆ‘ä»¬å¾—å…ˆæŠ“â¾ƒâ¼°æœ¬åœ°ipçš„åŒ…ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹‹å‰è®¾ç½®jira
çš„æ—¶å€™ï¼Œipæ˜¯è®¾ç½®æˆlocalhostçš„ï¼Œæˆ‘ä»¬åœ¨burpä¸Šâ¾¯çš„å³ä¸Šâ»†æŠŠipåœ°å€æ›´æ”¹â¼€ä¸‹ï¼Œç„¶åhostçš„å€¼ä¹Ÿ
æ”¹â¼€ä¸‹ã€‚å°±å¯ä»¥è¯»å–åˆ°â½‚ä»¶äº†ã€‚
è¿™â¾¥çš„payloadæˆ‘æ”¾ä¸º /s/s3gundo/_/;anythingulike/WEB-INF/web.xml ï¼Œå…·ä½“çš„åˆ†æå¯ä»¥çœ‹ä¸‹
â¾¯ã€‚
1ã€ filterçš„åˆå§‹åŒ–
å¤ä¹ â¼€ä¸‹filterçš„åˆå§‹åŒ–
/s/cfx/_/;/META-INF/maven/com.atlassian.jira/jira-webapp-dist/pom.properties  
/s/cfx/_/;/META-INF/maven/com.atlassian.jira/jira-webapp-dist/pom.xml  
/s/cfx/_/;/META-INF/maven/com.atlassian.jira/atlassian-jira-webapp/pom.xml  
/s/cfx/_/;/META-INF/maven/com.atlassian.jira/atlassian-jira-webapp/pom.properties 
ç¨åŠ æ”¹é€ /s/everything/_/;anythingulike/WEB-INF/web.xml
    org.apache.catalina.Valve#invoke ->StandardWrapperValve.invoke 
    StandardWrapperValve ->> + ApplicationFilterFactory : 1ã€createFilterChain()åˆ›
    ApplicationFilterFactory ->> ApplicationFilterFactory : 1.1ã€åˆ›å»ºFilterChainå¹¶åˆ
    ApplicationFilterFactory -->> - StandardWrapperValve : 1.2ã€è¿”å›FilterChainå¯¹è±¡
2022/2/22 17:19
1.md
ï¬le:///Users/s3gundo/Documents/markdown/vulns/java/jira/1.md
6/18
filterchainçš„åˆå§‹åŒ–ï¼Œè·Ÿè¿› ApplicationFilterFactory.createFilterChain â½…æ³•ï¼Œå¯ä»¥çœ‹åˆ°ä»
wrapperä¸­è·å–çš„httpè¯·æ±‚â½…æ³•å’Œè·¯å¾„ï¼Œå¹¶å°†ğŸŸfiltermapä¸­åŒ¹é…å¾—åˆ°çš„è·¯å¾„ä¸è¯·æ±‚â½…æ³•ï¼ŒåŠ â¼Šåˆ°
filterChainä¸­
å¯ä»¥çœ‹åˆ°urlpatternæ˜¯/*æ˜¯è‚¯å®šä¼šè¢«åŒ¹é…ä¸Šçš„ã€‚
org.apache.catalina.core.ApplicationFilterChain#doFilter åŒ¹é…å¾—åˆ°è¿™äº›filters
å¯ä»¥çœ‹åˆ°åºå·ä¹ï¼Œç¬¬â¼—ä¸ªfilterå°±æ˜¯åâ¾¯çš„é‡ç‚¹ã€‚
2ã€ Jiraçš„æ­£å¸¸è®¿é—®/WEB-INF/å—é™
2022/2/22 17:19
1.md
ï¬le:///Users/s3gundo/Documents/markdown/vulns/java/jira/1.md
7/18
å¯ä»¥çœ‹åˆ° org.apache.catalina.core.StandardContextValve#invoke â½…æ³•ä¸­ï¼Œ
åœ¨è¿™â¾¥ï¼Œåº”è¯¥æ˜¯ä¼šå°†è®¿é—®è·¯å¾„ä¸­çš„ ; è¿›â¾å¿½ç•¥å¤„ç†ï¼Œâ½å¦‚å¯¹äºè·¯
å¾„ /s/s3gundo/_/;anythingulike/WEB-INF/web.xml å°†ä¼šâ¾¸å…ˆå– ; å‰çš„ /s/s3gundo/_/ ï¼Œå†
å– / åçš„ /WEB-INF/web.xml ï¼Œæœ€åå°†ä¸¤è€…è¿›â¾æ‹¼æ¥å¾—åˆ°: /s/s3gundo/_//WEB-INF/web.xml ã€‚
å› ä¸ºè¿™â¾¥ä¼ â¼Šçš„æ—¶å€™å¯¹urlåšäº†è½¬å‘å¤„ç†ï¼Œæ‰€ä»¥å°†å‰â¾¯çš„ /s/s3gundo ç»™åˆ å»äº†ï¼Œå¾—
åˆ° /;anythinulike/WEB-INF/web.xml ï¼Œåâ¾¯ä¼šè®²åˆ°ã€‚
è¿”å›çš„å€¼æ˜¯ //WEB-INF/web.xml
    public static String normalize(String path, boolean replaceBackSlash) { //è¿™â¾¥
        if (path == null) { 
2022/2/22 17:19
1.md
ï¬le:///Users/s3gundo/Documents/markdown/vulns/java/jira/1.md
8/18
            return null; 
        } else {
            String normalized = path; 
            if (replaceBackSlash && path.indexOf(92) >= 0) { 
                normalized = path.replace('\\', '/');  //å­˜åœ¨åæ–œæ å°±æ›¿æ¢ä¸ºæ–œæ  
            } 
            if (!normalized.startsWith("/")) { 
                normalized = "/" + normalized; 
            } 
            boolean addedTrailingSlash = false; 