2.  训练中
3.  训练失败
4.  训练完成
5.  检测中
目前暂不考虑算法模型的版本管理问题。只记录、运用和展示最新一次的结果。
对于在检测中的监控项，可以在后续查看中，进行反馈标记。如果选定的算法本身有可以事后调整的参数，比如敏感度，也可以在这里调整：
![](media/image5.png){width="6.5in" height="3.808333333333333in"}
监控项可以删除，但删除监控项不代表删除指标数据。
由于Metric是直接对接导入，可能数量较大，在树状列表上应该提供搜索过滤功能。
### 服务管理
![](media/image6.png){width="6.5in" height="6.04375in"}
服务除了名称，还有一个必填的内部ID，这个ID发挥两个作用：
1.  用来自动关联Metric。如'miui.sys.hadoop'服务，自动关联'miui.sys.hadoop.size'和'miui.sys.hadoop.qps'等Metric。
2.  用来组织服务之间的树状结构。这个和依赖不冲突。
服务和设备一样，也要有个external_id。
但只有被定义为监控项的指标才参与健康度计算。其他Metric这里只提供一个查看链接，点击到Metric管理页，带着服务id的过滤条件即可。
### 服务概览操作及钻取
![](media/image7.png){width="6.5in" height="4.188194444444444in"}
![](media/image8.png){width="6.5in" height="4.161111111111111in"}
服务暂时木有分组权限什么的设计。这里直接采用树状结构进行选择过滤操作。
### 服务详情展示与操作
![](media/image9.png){width="6.5in" height="4.165277777777778in"}
![](media/image10.png){width="6.5in" height="4.075in"}
![](media/image11.png){width="6.5in" height="6.520138888888889in"}
模式对比这里作为一个菜单。除了模式对比，还可以选择相关性对比。点击跳转到“根因分析”页面。把点击选择的“CPU使用率”作为待分析的目标带过去。
### 设备概览操作与钻取
![](media/image12.png){width="6.5in" height="3.76875in"}
设备的健康度目前固定采用平均负载来展示。后期可以加入cpu使用率、内存使用率等可100%化的数据选择。
### 设备详情与性能展示
从设备看板点击，可以打开查看单个设备的详情，以及在指标存储中，所有标记有该设备标签的指标的趋势图。
![](media/image13.png){width="6.5in" height="4.971527777777778in"}
[]{#_Toc512277333 .anchor}
### 根因分析操作
![](media/image14.png){width="6.5in" height="5.229861111111111in"}
### 决策分析操作
## 功能详情
### 管理设备内容
+---------+------------------------------------------------------------+
| 功能点1 | 手动新建一条设备                                           |
+=========+============================================================+
| 说明    | 设备属性通常应该会是ap                                     |
|         | pname、tag、hostname、source的组合，也可以是其他确定在日志 |
|         | 中会出现的字段；然后还可以附加其他在日志索引里没有的信息， |
|         | 比如操作系统类型os_type，负责人owner，手机号telephone等。  |
|         |                                                            |
|         | Title作为唯一标识符，默认等于第一个索引字段值。在更细      |
|         | 节的CI需求里可以手写。比如，要区分到服务器上具体某个应用， |
|         | 则hostname和source一起才能唯一确定。这时候可以手写title。  |
+---------+------------------------------------------------------------+
| 规则    |                                                            |
+---------+------------------------------------------------------------+
| 原型    |                                                            |
+---------+------------------------------------------------------------+
| 执行者  | admin                                                      |
+---------+------------------------------------------------------------+
| 前      | 设备列表页点击新建按钮                                     |
| 置条件  |                                                            |
+---------+------------------------------------------------------------+
| 后      | 设备列表页新增一行结果                                     |
| 置条件  |                                                            |
+---------+------------------------------------------------------------+
| 主流程  | 1.  在表单里填写：                                         |
|         |                                                            |
|         | 2.  索引属性：hostname=webserver1                          |
|         |                                                            |
|         | 3.                                                         |
|         | 补充属性：owner=raocl,telephone=15101127811,os_type=centos |
|         |                                                            |
|         | 4.  点击保存                                               |
+---------+------------------------------------------------------------+
+---------+------------------------------------------------------------+
| 功能点2 | 上传CSV文件批量创建设备                                    |
+=========+============================================================+
| 说明    | 因为CSV是平铺的二维结构，所以无法区分哪列是索引属性，      |
|         | 哪列是补充属性。在上传的预览步骤需要手动指明各列的属性类型 |
+---------+------------------------------------------------------------+
| 规则    |                                                            |
+---------+------------------------------------------------------------+
| 原型    |                                                            |
+---------+------------------------------------------------------------+
| 执行者  | admin                                                      |
+---------+------------------------------------------------------------+
| 前      | 准备一个CSV，内容如下：                                    |
| 置条件  |                                                            |
|         | hostname,ip,owner,telephone,os_type                        |
|         |                                                            |
|         | localhost,127.0.0.1,raocl,15101127811,centos               |
|         |                                                            |
|         | geeku.rizhiyi.com,192.168.1.14,geeku,13800138000,centos    |
+---------+------------------------------------------------------------+
| 后      | 设备列表页新增两行结果                                     |
| 置条件  |                                                            |
+---------+------------------------------------------------------------+
| 主流程  | 1.  CI列表页点击CSV导入按钮                                |
|         |                                                            |
|         | 2.  选择CSV文件，点击上传                                  |
|         |                                                            |
|         | 3.  查看CSV内容预览                                        |
|         |                                                            |
|         | 4.  设置hostname，ip为索引属性；                           |
|         |                                                            |
|         | 5.  设备owner、telephone、os_type为附加属性；              |
|         |                                                            |
|         | 6.  点击确定                                               |
+---------+------------------------------------------------------------+
+---------+------------------------------------------------------------+
| 功能点3 | 通过SPL搜索结果批量创建设备                                |
+=========+============================================================+
| 说明    |                                                            |
+---------+------------------------------------------------------------+
| 规则    |                                                            |
+---------+------------------------------------------------------------+
| 原型    |                                                            |
+---------+------------------------------------------------------------+
| 执行者  | admin                                                      |
+---------+------------------------------------------------------------+
| 前      |                                                            |
| 置条件  |                                                            |
+---------+------------------------------------------------------------+
| 后      | 设备列表页新增一行结果                                     |
| 置条件  |                                                            |
+---------+------------------------------------------------------------+
| 主流程  | 1.  CI列表页点击SPL导入按钮                                |
|         |                                                            |
|         | 2.  输入SPL语句如下，点击搜索                              |
|         |                                                            |
|         | > logtype:apache \| stats count() by hostname \| table     |
|         | > hostname \| eval os_type="centos"                        |
|         |                                                            |
|         | 3.  查看SPL表格内容预览                                    |
|         |                                                            |
|         | 4.  设置hostname为索引属性；                               |
|         |                                                            |
|         | 5.  设置os_type为附加属性；                                |
|         |                                                            |
|         | 6.  点击确定                                               |
+---------+------------------------------------------------------------+
+---------+------------------------------------------------------------+
| 功能点4 | 通过agent列表批量创建设备                                  |
+=========+============================================================+
| 说明    | 这个应该是我们特色选项。从日志易数据库里的Agent            |
|         | Status表导入is_server_heka为0的列表，其中索引字段值有hostn |
|         | ame、ip，附加键值对有os、status，所属服务为agent分组名称。 |
+---------+------------------------------------------------------------+
| 规则    |                                                            |
+---------+------------------------------------------------------------+
| 原型    |                                                            |
+---------+------------------------------------------------------------+
| 执行者  | admin                                                      |
+---------+------------------------------------------------------------+
| 前      |                                                            |
| 置条件  |                                                            |
+---------+------------------------------------------------------------+
| 后      | 设备列表页新增一批结果                                     |
| 置条件  |                                                            |
+---------+------------------------------------------------------------+
| 主流程  | 1.  CI列表页点击agent导入按钮                              |
|         |                                                            |
|         | 2.  查看agentstatus内容预览                                |
|         |                                                            |
|         | 3.  设置hostname，ip为索引属性；                           |
|         |                                                            |
|         | 4.  设置os_type为附加属性；                                |
|         |                                                            |
|         | 5.  点击确定                                               |
+---------+------------------------------------------------------------+
+---------+------------------------------------------------------------+
| 功能点5 | 上传CSV文件批量更新设备                                    |
+=========+============================================================+
| 说明    |                                                            |
+---------+------------------------------------------------------------+
| 规则    | title相同的行，认为是更新而非新增。无title时就是第一列。   |
+---------+------------------------------------------------------------+
| 原型    |                                                            |
+---------+------------------------------------------------------------+
| 执行者  | admin                                                      |
+---------+------------------------------------------------------------+
| 前      | 在功能点3的基础上，更新CSV内容如下：                       |
| 置条件  |                                                            |
|         | hostname,json.ip,owner,telephone,os_type                   |
|         |                                                            |
|         | localhost,192.168.1.104,raocl,15101127811,centos           |
|         |                                                            |
|         | geeku.rizhiyi.com,192.168.1.14,geeku,13800138000,centos    |
|         |                                                            |
|         | chenlinux.com,10.10.10.10,raocl,15101127811,Ubuntu         |
+---------+------------------------------------------------------------+
| 后      | CI列表页新增一行结果，且localhost行的属性更新。            |
| 置条件  |                                                            |
+---------+------------------------------------------------------------+
| 主流程  | 同功能点3                                                  |
+---------+------------------------------------------------------------+
### 管理监控项
+---------+------------------------------------------------------------+
| 功能点1 | 从指标数据创建一个监控项                                   |
+=========+============================================================+
| 说明    |                                                            |
+---------+------------------------------------------------------------+
| 规则    |                                                            |
+---------+------------------------------------------------------------+
| 原型    |                                                            |
+---------+------------------------------------------------------------+
| 执行者  | admin                                                      |
+---------+------------------------------------------------------------+
| 前      | 监控项列表页点击新建按钮。                                 |
| 置条件  |                                                            |
+---------+------------------------------------------------------------+
| 后      | 创建成功。                                                 |
| 置条件  |                                                            |
|         | 在监控列表上看到状态为：训练完成。                         |
+---------+------------------------------------------------------------+
| 主流程  | 1.  打开指标数据列表；                                     |
|         |                                                            |
|         | 2.  在树状结构中点击展开，找到miui.system.hadoop.qps指标； |
|         |                                                            |
|         | 3.                                                         |
|         | 点击选中，指标名称自动保存为监控项名称，并展示指标曲线图； |
|         |                                                            |
|         | 4.  点击执行训练。                                         |
|         |                                                            |
|         | 5.  等待训练完成后，曲线图                                 |
|         | 上出现训练和测试的分割线、测试区域的置信区间、异常点标记； |
|         |                                                            |
|         | 6.  支持调整敏感度，增减异常点数量；                       |
|         |                                                            |
|         | 7.  异常点标记支持点击选择标记为正常。                     |
+---------+------------------------------------------------------------+
+---------+------------------------------------------------------------+
| 功能点2 | 从指标数据创建一个监控项-稍后查看验证结果                  |
+=========+============================================================+
| 说明    |                                                            |
+---------+------------------------------------------------------------+
| 规则    |                                                            |
+---------+------------------------------------------------------------+
| 原型    |                                                            |
+---------+------------------------------------------------------------+
| 执行者  | admin                                                      |
+---------+------------------------------------------------------------+
| 前      | 监控项列表页点击新建按钮。                                 |
| 置条件  |                                                            |
+---------+------------------------------------------------------------+
| 后      | 看到模型在新数据上的验证效果（无训练测试切分线效果）。     |
| 置条件  |                                                            |
+---------+------------------------------------------------------------+
| 主流程  | 1.  打开指标数据列表；                                     |
|         |                                                            |