接口
CPU
共享内存
接口
接口
CPU内存
（路由表）
■低端路由器
图3-44展示了思科公司低端路由器Cisco1600系列的结构图，该系列路由器属于共享总线
型架构。
---
## Page 207
03.08路由器的架构|193
图3-44
低端路由器（Cisco1600）的架构
Cisco1600路由器
WAN接口卡
WAN接口卡插槽
启动ROM
NVRAM
CPU总线
Motorola
控制端口
M68360处理器
PCMCIA
( CPU)
DRAMSIMM
外部AC
串口、
以太网接口
板载DRAM
电源适配器
ISDN接口
NVRAM:Non-VolatileRandom-AccessMemory
PCMCIA：Flash存储卡
DRAM:DynamicRandomAccessMemory
SIMM:Single In-LineMemoryModule
大多数小型路由器均采用外部AC电源供电运行。
机框上配备了以太网接口、串口、ISDN的BRI端口。WAN系列的接口卡可以安装在WIC
（WANInterfaceCard，WAN接口卡）槽上，该接口卡上配备了串口、T1、ISDN端口和以太网接
口，各个接口通过I/O总线（Input/Output总线）连接CPU。
CPU（处理器）读取操作系统内定义的指令并执行。CPU的性能会根据总线速度的变化而变
化。CPU和内存之间通过CPU总线连接。
图3-45
Cisco1600系列的内存
Cisco1600系列的内存
DRAM
DRAMSIMM（主进程内存）
启动ROM
路由表
队列
ROMMON、RxBoot
路径缓存
缓存首部
NVRAM
板载DRAM（共享输入输出内存）
startup-config
系统缓存
发送缓存
PCMCIA
接口缓存
接收缓存
IOS镜像
图3-45记录了小型路由器的内存分配结构。DRAM内存在逻辑上分为包含路由表的主进程
内存，和包含分组、接口缓存的I/O内存两个区域。
在PCMICA闪存卡上存放了操作系统（CiscoIOS）的软件镜像。
---
## Page 208
194|第3章路由器和它庞大的功能
中端路由器
图3-46展示了中端路由器架构的代表一—Cisco3600系列的结构图。该系列同样使用共享总
线型架构，除了固定的端口以外还可以连接接口模块。
图3-46
中端路由器（Cisco
3600）的架构
Cisco3600路由器
接口模块
PCMCIA
DRAM
启动ROM
接口模块
NVRAM
总线
线
GT64010
VO总
接口模块
系统控制器
闪存
CPU总线
寄存器FPGA
Dual UART
Orion RISC
IDPROM
电源模块
处理器
通用异步收发传输器：UniversalAsynchronousReceiver/Transmitter
控制端口AUX端口
识别可编程只读存储器：IdentificationProgrammableReadOnlyMemory
中高端路由器
图3-47展示了中高端路由器的架构图。这种级别的路由器拥有电源模块余、独立路由引
擎、能够替换的风扇托盘、多个接口模块或线卡插槽以及在接口卡模块之间进行通信的背板。
图347
CisCO7200VXR系列的架构
端口适配器
端口适配器
PCI桥
PCI桥
端口适配器
PCI桥
PCI桥
端口适配器
端口适配器
PCI桥
端口适配器
PCI桥
0
电源模块
风扇托盘
VO控制器
快速以太网
PCMCIA
PCI桥
PCI桥
MII
PCI总线0
SRAM
GT64010
启动ROM
Dual UART
系统控制器
RISC处理器
CPU
/
L2缓存
NVRAM
启动闪存
EEPROM
DRAM
midplane
网络处理器引擎（NPE）
控制
AUX
端口
端口
---
## Page 209
03.08路由器的架构195
■共享总线型（分布式处理器，分布式架构）
分布式处理器是指通过在网络接口的线卡上搭载CPU，使线卡内部的数据传输不依靠中央
处理器也能进行的架构模型（图3-48）。早期的机框式高端路由器或模块型中端路由器产品均采
用该架构。在该架构中同样使用共享总线连接处于控制部分的CPU，最大传输速度依赖于总线
的容量。
图3-48分布式处理器的结构
共享总线
线卡
接口
内存
CPU
共享内存
CPU
线卡
接口
CPU内存
内存
CPU
（路由表）
纵横通路方式
使用共享总线型架构，分组的传输性能会受到总线带宽的限制。因此对传输速度有着很高要
求的高端路由器通常使用交换结构（switchfabric）的传输线路取代共享总线，来提高系统整体的
传输性能。
在箱式路由器中，端口（接口）之间的数据传输是通过交换结构实现的。
在机框式路由器中，搭载了传输引擎（CPU）和内存的线卡之间的数据传输，同样也是经由
交换结构来实现的。多数机框式路由器或交换机都使用纵横交换方式中的交换结构完成数据传
输，因此这样的架构形式也称为纵横通路（crossbar）方式。（图3-49）
交换结构直接使用半导体芯片，通过芯片完成线路电气信号的处理。
---
## Page 210
196|第3章路由器和它庞大的功能
图3-49
纵横通路方式的结构
线卡
接口
内存
CPU
CPU
纵横通路交换
(crossbar switch)
线卡
接口
CPU存储
（路由表）
内存
CPU
纵横通路交换
纵横通路交换（crossbarswitch）也称为交叉点交换或矩阵交换。在由M个输人线路、N个
输出线路组成的纵横通路交换中，会有M×N个交叉点（crosspoint），每个交叉点上会产生一个
交换（图3-50）。当交换处于开启状态时，M个输人将和N个输出直接连通。
通路（bar）是数据流动的载体，也可称为网状通道（fabricchannel）。
图3-50
纵横通路交换的结构
CrossBarSwitch
图3-51
纵横通路交换的示例
接口槽1
接口槽3
接口槽5
接口槽7接口槽9
12
56
910
1314
1718
桥ASIC
19
纵横通路
20
交换结构ASIC
3
8
1112
1516
接口槽2
接口槽4
接口槽6
接口槽8
---
## Page 211
03.08路由器的架构197
在图3-51的示例中，该架型路由器拥有9个接口槽，每个接口槽分配了两个网状通道。如
果每个通道容量为40Gbit/s、每个接口槽的传输容量达到80Gbit/s，就可以完成4端口10G以太
网或1端口40G以太网带宽的双向无阻塞处理。
线端阻塞与虚拟输出队列
线端阻塞（HOL，Headoflineblocking）是指在网络硬件中发生的缓存性能低下的现象。
由输人端口、交换结构、输出端口组成的交换机中，如果使用FIFO（First-inFirst-out）输人
缓存，会优先传输最初进入缓存（队列）的分组，但如果作为目的地的输出缓存正在使用中，就
不会转发先进入缓存的分组，进而后面进人缓存的分组也无法传送（图3-52）。
图3-52线端阻塞的形成结构
输入端口
交换结构
输出端口
解决线端阻塞的方法之一就是使用虚拟输出队列。
图3-532x2的纵横通路交换示例
0或1
0或1
b
如图3-53所示，该纵横通路交换示例中的输人输出端口各有两个。在到达输人端口a和b
的数据中，以输出端口c为目的地的数据用0表示，以输出端口d为目的的数据用1表示。
当有数据同时到达输入端口a、b时，可能会发生以下四种情况：端口a与b均为数据0
（00），端口a为数据0端口b为数据1（01），端口a为数据1端口b为数据0（10），端口a与b
---
## Page 212
198丨第3章路由器和它庞大的功能
均为数据1（1）。
输人端口的数据为00时，两个输入数据会同时传输到输出端口c上，但输出端口在单位时
间内处理的数据量有限，因此输出端口c无法做到同时对外转发这两个数据。这时2×2的交换
结构效率实际只有0.5。当输入为11时，该交换结构的效率也同样为0.5。而在输入数据为01或
10时，由于两个输出端口能够同时处理数据，因此交换结构的效率可以达到1。因为这四种模式
发生的概率相等，均为0.25，所以2×2交换结构的整体效率为0.75=（0.25×0.5+0.25×0.5+
0.25×1x2）。由此可见n×n（n>2）纵横通路交换的整体效率会呈现递减的趋势。
在图3-54中，输出端口c和d上各自配备了两个缓存作为虚拟输出队列，这时当输入端口
a和b同时传输11或00这样两个连续的数据时，输出端口也能够同时处理。以此类推，在nxn
的纵横通路交换中，如果每个输出端口都预先配备了数目为n的缓存，就可以达到纵横通路交换
中最大的整体效率。
图3-54虚拟输出队列
a
0010
b
当没有虚拟输出队列时只能处
配置了虚拟输出队列时，输出端口可以
理1个数据，从而导致发生线
等待处理，整个交换结构带宽的使用效