Machine
Learning
Protect against
tomorrowâ€™s
threats
åŸºäºŽæœºå™¨å­¦ä¹ çš„æ¶
æ„è½¯ä½“åˆ†ç±»å®žä½œ:"
Microsoft"Malware"
Classification"
Challenge"ç»éªŒè°ˆ
Trend Micro
ch0upi
miaoski
Kyle Chung
2 Dec 2016
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
ch0upi
â€¢
Staff"engineer"in"Trend"Micro
â€¢
Machine"Learning"+"Data"Analysis
â€¢
Threat"intelligence"services
â€¢
KDDCup 2014"+"KDDCup 2016:"Top10
â€¢
GoTrend:"6th in"UEC"Cup"2015
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
miaoski
â€¢
Senior"threat"researcher"in"Trend"Micro
â€¢
Threat"intelligence
â€¢
Smart"City
â€¢
SDR
â€¢
Arduino"+"RPi makers
â€¢
Loves"cats
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
4
Outline
â€¢
Why"Malware"Classification?
â€¢
Machine"Learning
â€¢
Microsoft"Challenge
â€¢
How"to"Solve"it?
â€¢
Conclusion
Machine
Learning
Protect against
tomorrowâ€™s
threats
MALWARE'
CLASSIFICATION
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
Whatâ€™s"Malware"Classification?
â€¢
Identify"malware"family
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
Why"Malware"Classification?
â€¢
Know"how"to"clean
â€¢
Possible"attribution
â€¢
Set"proper"priority
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
Current"Malware"Classification
â€¢
Manually"generated"by"researchers
â€¢
Use"signature"to"fingerprint"malware"
â€¢
YARA"rules
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
Challenge
â€¢
Manual"process"Ã¨ wrong"family
â€¢
more"and"more"malware"families
â€¢
Very"large"volume
â€¢
daily"1M+"samples
â€¢
Increasing"signatures
â€¢
Slow"in"scanning"+"need"more"storage
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
BSidesLV 2016:"VirusShare
â€¢
John"Seymour,"Labeling"the"VirusShare Corpus:"
Lessons"Learned,"BSidesLV 2016
â€¢
VirusShare Corpus:"~20M"files
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine"Learning"for
â€¢
Automation"of"malware"family"identification
â€¢
Save"researcherâ€™s"effort
Machine
Learning
Protect against
tomorrowâ€™s
threats
MACHINE LEARNING
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
13
Machine"Learning"Steps
â€¢
Prepare"Data
â€¢
Generate"Feature
â€¢
Train"Model
â€¢
Make"Prediction
â€¢
Evaluate
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
14
Fruit"Classification
â€¢
Apple
â€¢
Banana
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
15
Fruit"Features
â€¢
Color
â€¢
Shape
â€¢
Size
â€¢
Weight
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
16
Learning
â€¢
Apple
â€¢
Banana
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
17
Learned"Model"of"Fruit
â€¢
Apple
â€¢
Color:"Red
â€¢
Shape:"Round
â€¢
Banana
â€¢
Color:"Yellow
â€¢
Shape:"Long
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
18
New"Fruit"Comingâ€¦
â€¢
Apple?"Banana?
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
19
Prediction"of"Fruits
â€¢
Fruit"1
â€¢
Color:"Red"=>"Apple
â€¢
Shape:"Round"=>"Apple
â€¢
Fruit"2
â€¢
Color:"Yellow"=>"Banana
â€¢
Shape:"Long"=>"Banana
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
20
Evaluation"of"Fruit
â€¢
Accuracy:"(9+9)/20"="90%
Apple
Banana
Apple
9
1
Banana
1
9
Total
10
10
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
21
Machine"Learning"Steps
â€¢
Prepare"Data
â€¢
Generate"Feature
â€¢
Train"Model
â€¢
Make"Prediction
â€¢
Evaluate
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
22
Machine"Learning"is"...
â€¢
Mathematical"methods"and"algorithms
â€¢
From"historical"labelled"data
â€¢
Find"a"separating"hyperplane
â€¢
Apply"it"on"future"data
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
23
Feature"is"...
â€¢
Measurable"property"of"a"phenomenon"being"
observed
â€¢
Use"to"describe"entries
â€¢
Feature"vector
â€¢
input"of"machine"learning"algorithm
â€¢
Source"of"features
â€¢
data"exploring
â€¢
domain"knowledge
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
24
Model"is"...
â€¢
A"mathematical"description"of"how"to"classify"the"
data
â€¢
Parameters"tuned"by"certain"algorithm
â€¢
training
â€¢
Used"to"make"prediction
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
25
Prediction
â€¢
Identify"the"class"of"new"entities
â€¢
With"trained"model"from"training"data
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
26
Evaluation
â€¢
Review"model"result"by"some"measurements
â€¢
Cross"validation
â€¢
Evaluation"functions
â€¢
Accuracy
â€¢
logloss
â€¢
AUC
â€¢
precision,"recall,"F1
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
27
Glue"Language
â€¢
Glue"the"steps"of"Machine"Learning"Learning
â€¢
Batch"running"for"large"amount"of"data
â€¢
Integration"with"Hadoop,"Spark
â€¢
Rich"libraries/Algorithm"support
â€¢
Easy"to"develop/learn
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
28
scikit learn
â€¢
Open"source"machine"learning"library"for"python
â€¢
Various"classification,"regression"and"clustering"
algorithms
â€¢
Interoperate"with"NumPy,"SciPy,"and"underlying"
BLAS
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
29
scikit learn"cheat-sheet
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
30
Supported"Algorithm"in"scikit learn
â€¢
Classification"Algorithm
â€¢
Logistic"Regression:"linear_model.LogisticRegression()
â€¢
SVM:"svm.SVC()
â€¢
Random"Forest:"ensemble.RandomForestClassifier()
â€¢
Interface
â€¢
fit(X,"Y):"train"model
â€¢
Yp=predict(X):"make"prediction
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
31
Evaluation"Functions"in"scikit learn
â€¢
Evaluation"functions
â€¢
metrics.accuracy_score()
â€¢
metrics.log_loss()
â€¢
metrics.auc()
â€¢
metrics.f1_score()
â€¢
metrics.confusion_matrix()
â€¢
metrics.classification_report()
Machine
Learning
Protect against
tomorrowâ€™s
threats
MICROSOFT'MALWARE'
CLASSIFICATION'CHALLENGE
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
33
Microsoft"Malware"Classification"
Challenge
â€¢
Hosted"by"WWW"2015"/"BIG"2015"
â€¢
Microsoft"Malware"Protection"Center
Microsoft"Azure"Machine"Learning
Microsoft"Talent"Management
â€¢
PE"Hexdump &"Disassembled
â€¢
Training:"10,868"(compressed:"17.5GB)
â€¢
Testing:"10,873"(compressed:"17.7GB)
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
34
9 Classes
Category
Count
1
Ramnit
1541
2
Lollipop 
2478
3
Kelihos_ver3 
2942
4
Vundo
475
5
Simda
42
6
Tracur
751
7
Kelihos_ver1 
398
8
Obfuscator.ACY
1228
9
Gatak
1013
Total 
10868
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
35
Class:"Ramnit
â€¢
Steal"sensitive"personal"information
â€¢
Infected"through"removable"drivers
â€¢
Copy"itself"using"a"hard-coded"name,"or"with"a"
random"file"name"to"a"random"folder
â€¢
Inject"codes"into"svchost.exe
â€¢
Infects"DLL,"EXE,"HTML
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
36
Class:"Lollipop
â€¢
An"adware"shows"ads"when"browsing"web
â€¢
Bundle"with"third-party"software
â€¢
Auto"run"when"Windows"starting
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
37
Class:"Kelihos
â€¢
A"Trojan"family"distributes"spam"email"with"
malware"download"link
â€¢
Communicate"with"C&C"server
â€¢
Some"variants"install"WinPcap to"spy"network"
activity
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
38
PE"Hexdump w/o"Header
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
39
IDA"Pro"Dump
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
40
IDA"Pro"Dump
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
41
IDA"Pro"Dump
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
42
Evaluation"Function
pij is the submitted probability of sample i is class j
yij=1 if sample i is class j,
yij=0 for others
ð‘™ð‘œð‘”ð‘™ð‘œð‘ ð‘  = âˆ’ 1
ð‘ ) ) ð‘¦ð‘–ð‘—-log-(ð‘ð‘–ð‘—)
4
567
8
967
Machine
Learning
Protect against
tomorrowâ€™s
threats
Machine
Learning
Protect against
tomorrowâ€™s
threats
43
Evaluation"Example
â€¢
Submission
00000000,0.5,0.5,0,0,0,0,0,0,0,0
00000001,0,0,0.5,0.5,0,0,0,0,0,0
00000002,0,0,1,0,0,0,0,0,0,0
â€¢
logloss ="- (log(0.5)+log(0)+log(1))/3
â€¢
log(0)"=>"log(1e-15)
Machine
Learning