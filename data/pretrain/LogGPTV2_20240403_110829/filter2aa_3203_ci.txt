IGMP Host Membership Query message to the all-hosts IPv4 multicast address. If no responses to the 
poll are received after several polls, the router assumes no membership in that group for that network 
and stops advertising that group-network information to other routers. 
When a host leaves an IPv4 multicast group and has determined that it is the last member of that group 
on the subnet, it sends an IGMP Leave Group message. 
TCP/IP in Windows supports IGMP, IGMP version 2 (IGMP v2), and IGMP version 3 (IGMP v3). There 
is no IGMP-related configuration required for a Windows-based computer to use all three versions of 
IGMP. 
IGMP is defined in RFC 1112. IGMP v2 is defined in RFC 2236. IGMP v3 is defined in RFC 3376. 
MLD for IPv6 
MLD is the IPv6 equivalent of IGMP v2 for IPv4. MLD is a set of ICMPv6 messages exchanged by 
routers and nodes, enabling routers to discover the set of multicast addresses for which there are 
listening nodes for each attached interface. Like IGMPv2, MLD only discovers the list of multicast 
addresses for which there is at least one listener, not the list of individual multicast listeners for each 
multicast address. MLD is described in RFC 2710. 
The three types of MLD messages are: 
When a host joins a host group, it sends an MLD Multicast Listener Report message to the specific 
IPv6 multicast address declaring its membership in a specific host group. 
When a router polls a network to ensure that there are members of a specific host group, it sends an 
MLD Multicast Listener Report message to the link-local scope all-hosts IPv6 multicast address 
(FF02::1). 
When a host leaves an IPv6 multicast group and has determined that it is the last member of that group 
on the subnet, the host sends an MLD Multicast Listener Done message. 
Table A-1 lists IGMPv2 messages and their corresponding MLD equivalents. 
Appendix A – IP Multicast 
TCP/IP Fundamentals for Microsoft Windows  
Page: 495 
IGMPv2 message 
MLD equivalent 
Host Membership Report 
Multicast Listener Report 
Host Membership Query 
Multicast Listener Query 
Leave Group 
Multicast Listener Done 
Table A-1  IGMPv2 messages and their MLD equivalents 
MLD version 2 (MLDv2) is the IPv6 equivalent of IGMP v3 for IPv4. MLDv2 is described in RFC 3810. 
Windows Server 2008 and Windows Vista support MLDv2. 
Appendix A – IP Multicast 
TCP/IP Fundamentals for Microsoft Windows  
Page: 496 
IPv4 Multicast Forwarding Support in Windows Server 2008 and 
Windows Server 2003 
Multicast forwarding in Windows Server 2008 and Windows Server 2003 consists of the following: 
IPv4 multicast forwarding by the Internet Protocol Version 4 (TCP/IPv4) or Internet Protocol (TCP/IP) 
component 
The IGMP routing protocol component of Routing and Remote Access  
IPv4 Multicast Forwarding 
In Windows, IPv4 multicast forwarding is supported by the Internet Protocol Version 4 (TCP/IPv4) or 
Internet Protocol (TCP/IP) component. IPv4 multicast forwarding is enabled when you configure and 
enable Routing and Remote Access. The Internet Protocol Version 4 (TCP/IPv4) or Internet Protocol 
(TCP/IP) component maintains an IPv4 multicast forwarding table, which can be viewed from the 
Routing and Remote Access snap-in or by using the netsh routing ip show mfe command. 
Note  The Internet Protocol Version 6 (TCP/IPv6) component in Windows Server 2008 and Windows Vista 
supports IPv6 multicast forwarding, which you can enable with the netsh interface ipv6 set global 
multicastforwarding=enable command. However, at the time of the publication of this book, there is no 
mechanism to update the IPv6 multicast forwarding table.  
IGMP Routing Protocol Component 
Because there are no multicast routing protocols provided with Windows Server 2008 or Windows 
Server 2003, the maintenance of entries in the IPv4 multicast forwarding table is a function of IGMP, a 
component that is added as an IPv4 routing protocol.  
To add the IGMP routing protocol component, do the following: 
1. Click Start, click Control Panel, double-click Administrative Tools, and then double-click Routing 
And Remote Access.  
2. In the console tree, open Routing And Remote Access, the server name, and then either IPv4 or IP 
Routing. 
3. In the console tree, right-click General, and then click New Routing Protocol.  
4. In the Select Routing Protocol dialog box, click IGMP Router And Proxy, and then click OK.  
The IGMP routing protocol component might have already been added, depending on your choices in 
the Routing and Remote Access Server Setup wizard. 
Although the IGMP routing protocol component provides some limited ability to create or extend 
multicast-enabled IPv4 networks, it is not the equivalent of a multicast routing protocol, such as DVMRP 
or PIM. It is not recommended for use to create a multicast-enabled IPv4 network of an arbitrary size or 
topology. 
After the IGMP routing protocol is added, you must add router interfaces by doing the following: 
1. In the console tree of the Routing and Remote Access snap-in, open Routing And Remote Access, 
the server name, and then either IPv4 or IP Routing. 
Appendix A – IP Multicast 
TCP/IP Fundamentals for Microsoft Windows  
Page: 497 
2. In the console tree, right-click IGMP, and then click New Interface.  
3. In Interfaces, click the interface you want to enable, and then click OK. 
4. On the General tab of the IGMP Properties dialog box for the interface, verify that the Enable IGMP 
check box is selected.   
5. Under Mode, click IGMP Router or IGMP Proxy. Under IGMP Protocol Version, select the version 
of IGMP being used in your network. 
6. Click OK. 
Figure A-6 shows the General tab for the properties of an IGMP interface. 
Figure A-6  The General tab for the properties of an IGMP interface 
When you add an interface to the IGMP routing protocol component in the Routing and Remote Access 
snap-in, you must configure the interface with one of the following: 
IGMP router mode 
IGMP proxy mode 
IGMP Router Mode 
When an IGMP routing protocol interface is configured in IGMP router mode, it performs the following 
functions: 
Listens in multicast promiscuous mode. 
Listens for IGMP Host Membership Report messages and Leave Group messages. 
Sends IGMP Host Membership Queries. 
Maintains entries in the IPv4 multicast forwarding table. 
IGMP router mode can be enabled on multiple interfaces. For each interface, a specific version of IGMP 
can be configured. The default version is IGMP v3. 
Appendix A – IP Multicast 
TCP/IP Fundamentals for Microsoft Windows  
Page: 498 
IGMP Proxy Mode 
While the purpose of IGMP router mode is to act as a multicast router, the purpose of IGMP proxy 
mode is to act as a multicast proxy for hosts on interfaces on which IGMP router mode is enabled. 
When an IGMP routing protocol interface is configured in IGMP router mode, it performs the following 
functions: 
Forwards IGMP Host Membership Reports 
All IGMP Host Membership Reports received on IGMP router mode interfaces are retransmitted on 
the IGMP proxy mode interface. 
Registers multicast MAC addresses 
For shared access technologies such as Ethernet, the network adapter is left in unicast listening 
mode. For each unique group registered by IGMP Host Membership Reports forwarded on the 
IGMP proxy mode interface, the network adapter is programmed to pass up frames with the 
corresponding multicast MAC address. Each additional multicast MAC address is an entry in the 
table of interesting destination MAC addresses on the network adapter. Each network adapter has 
a maximum number of entries it can store. If the maximum number of entries is used, then the 
IGMP routing protocol enables multicast promiscuous listening mode on the network adapter. 
Adds entries to the multicast forwarding table  
When non-local multicast traffic is received on an IGMP router mode interface, the IGMP routing 
protocol adds or updates an entry to the multicast forwarding table to forward the multicast traffic 
out the IGMP proxy mode interface. The end result of this process is that any non-local multicast 
traffic received on IGMP router mode interfaces is flooded, or copied, to the IGMP proxy mode 
interface. 
Receives multicast traffic received on IGMP proxy mode interfaces  
Multicast traffic received on the IGMP proxy mode interface corresponding to the groups registered 
by hosts on IGMP router mode interfaces are forwarded to the appropriate interfaces using the IP 
protocol and the multicast forwarding table. 
The purpose of IGMP proxy mode is to connect a Windows Server 2008 or Windows Server 2003 
router to a multicast-enabled IPv4 network, such as the multicast backbone of the IPv4 Internet 
(MBone), or a private intranet that is using multicast routing protocols, such as DVMRP and PIM. Figure 
A-7 shows an example of using IGMP router mode and IGMP proxy mode to connect a small office 
network to the MBone. 
Appendix A – IP Multicast 
TCP/IP Fundamentals for Microsoft Windows  
Page: 499 
Figure A-7  Using IGMP proxy mode to connect a small office network to the MBone 
The IGMP proxy mode interface acts like a host and joins host groups on behalf of hosts on its IGMP 
router mode interfaces. Multicast traffic sent to host members on IGMP router mode interfaces are 
received on the IGMP proxy mode interface and forwarded by the Internet Protocol Version 4 
(TCP/IPv4) or Internet Protocol (TCP/IP) component. Multicast traffic sent by hosts on IGMP router 
mode interfaces are flooded on the IGMP proxy mode interface where a downstream IPv4 multicast-
enabled router can either forward the traffic or ignore it. 
IGMP proxy mode can only be enabled on a single IGMP routing protocol interface. The correct 
interface on which to enable IGMP proxy mode is the interface attached to a subnet containing a 
multicast router running multicast routing protocols. In other words, the IGMP proxy mode interface 
"points" to the multicast-enabled intranet. 
Appendix A – IP Multicast 
TCP/IP Fundamentals for Microsoft Windows  
Page: 500 
IPv4 Multicast Address Allocation with MADCAP 
The Multicast Address Dynamic Client Allocation Protocol (MADCAP) is an Internet standard for 
multicast address allocation defined in RFC 2730. The primary benefit of MADCAP is that you can use 
it to leverage your existing Windows Dynamic Host Configuration Protocol (DHCP) infrastructure to 
assign multicast IPv4 addresses in the same way that you assign unicast IPv4 addresses. 
The multicast address allocation uses the following components: 
MADCAP servers 
MADCAP servers allocate IPv4 multicast addresses. For Windows, a MADCAP server is a 
computer running Windows Server 2008 or Windows Server 2003 and the DHCP Server service. 
Using the DHCP snap-in, you must configure and activate at least one multicast scope. 
MADCAP clients 
MADCAP clients use the MADCAP protocol to request IPv4 multicast addresses from a MADCAP 
server. Windows supports a MADCAP application programming interface (API) so that an 
application can use MADCAP to request, renew, or release a unique IPv4 multicast address from a 
MADCAP server. 
An example of a MADCAP client application is a video conferencing server service that uses MADCAP 
to receive a unique multicast address and then communicate that address to connecting video clients. 
After the initial connection negotiation, the video client computer listens on the IPv4 multicast address 
for the video stream. 
Using Multicast Scopes 
A multicast scope is a range of IPv4 multicast addresses that the MADCAP server is configured to 
assign to requesting MADCAP clients. When deciding the multicast address ranges to use for multicast 
scopes on your MADCAP server, there are two ranges of addresses that are recommended: 
Administratively scoped multicast addresses are in the 239.192.0.0/14 range (from 239.192.0.1 to 
239.255.255.255) and are intended for use by an organization using multicast scopes privately for its 
own internal use. Administratively scoped multicast addresses are described in detail in RFC 2365. 
Globally scoped multicast addresses are in the range 233.0.0.0/8  (from 233.0.0.1 to 233.255.255.255) 
and are intended for use by an organization using multicast scopes on the Internet. Within the 
233.0.0.0/8 range, the second and third octets are used for the autonomous system (AS) number, 
assigned to the organization by an Internet Assigned Numbers Authority (IANA) registry. The last octet 
identifies the multicast group. For more information on AS numbering, see RFC 1930. 
The Windows Server 2008 or Windows Server 2003 DHCP Server service supports both the DHCP and 
MADCAP protocols. These protocols function separately and are not dependent on each other. To 
configure a DHCP-only server, configure DHCP scopes but no multicast scopes. To configure a 
MADCAP-only server, configure multicast scopes but no DHCP scopes. 
To create a multicast scope on a computer running Windows Server 2008 or Windows Server 2003 and 
the DHCP Server service, do the following: 
1. Click Start, click Settings, click Control Panel, double-click Administrative Tools, and then double-
Appendix A – IP Multicast 
TCP/IP Fundamentals for Microsoft Windows  
Page: 501 
click DHCP.  
2. In the console tree, click the applicable DHCP server.  
3. On the Action menu, click New Multicast Scope.  
4. Follow the instructions in the New Multicast Scope wizard.  
The New Multicast Scope wizard guides you through the configuration of the multicast address range, 
exclusions, lease duration, and scope activation. 
Appendix A – IP Multicast 
TCP/IP Fundamentals for Microsoft Windows  
Page: 502 
Reliable Multicast with Pragmatic General Multicast (PGM) 
Multicast data streams are typically sent using the User Datagram Protocol (UDP). Transmission 
Control Protocol (TCP) is not used because it is designed for one-to-one unicast streams of data. 
Multicast data streams sent over UDP are inherently unreliable because UDP does not provide 
guaranteed delivery or retransmission of lost packets. Unless reliability is provided by the upper layer 
protocol, lost packets in UDP-based multicast data streams cannot be detected or recovered.  
The Reliable Multicast Transport working group of Internet Engineering Task Force (IETF) has created 
a set of standards for the reliable transmission of multicast data streams from one or multiple senders 
to multiple receivers. There are many protocol standards that provide reliable multicast at the transport 
or application layers. Existing reliable multicast protocols fall into the following four categories: 
1. Negative acknowledgement (NACK)-only   
Receivers send NACK packets to request, from the sender, the retransmission of missing packets in 
the multicast data stream. NACK-only protocols do not require any additional support from routers in 
the network. 
2. Tree-based acknowledgement (ACK)   
Receivers send positive acknowledgments to indicate multicast data packets that are successfully 
received. 
3. Asynchronous Layered Coding (ALC)   
Senders provide forward error correction (FEC) with no messages from receivers or the routers of the 
network. 
4. Router assist   
Receivers send NACK packets. Routers in the network assist with retransmitting lost packets. 
PGM Overview 
PGM is a router assist type of reliable multicast protocol that is described in RFC 3208. PGM-enabled 
receivers use NACK packets to request the retransmission of missing packets. PGM-enabled routers in 
a network define a logical PGM topology and can facilitate the recovery of lost packets by sending them 
on behalf of the sender. The PGM topology is overlaid on top of the physical IPv4 network topology. 
PGM routers define a series of PGM hops between a sender and its receivers. Although defined in RFC 
3208, PGM routers are not required. The PGM topology of a network can consist of the single logical 
hop between the sender and the receivers.  
PGM does not provide all of the capabilities of TCP for multicast data streams. For example, PGM does 
not provide sender or receiver-side flow control, byte stream windowing, or congestion control. PGM 
provides basic reliability for PGM-enabled applications. 
PGM is a transport layer multicast protocol that runs directly over IPv4 using protocol number 113. It 
does not use TCP or UDP for its own messages or for multicast data transmission. PGM is the only 
reliable multicast protocol supported by Windows Server 2008, Windows Vista, and Windows Server 
2003. 
Appendix A – IP Multicast 
TCP/IP Fundamentals for Microsoft Windows  
Page: 503 
Adding and Using the Reliable Multicast Protocol 
To use PGM on computers running Windows Server 2008, Windows Vista, or Windows Server 2003, 
you must add the Reliable Multicast Protocol component and create PGM-enabled applications. 
Adding the Reliable Multicast Protocol 
To add the Reliable Multicast Protocol to a connection, complete the following steps: 
1. From the Network Connections folder, right-click the connection, and then click Properties. 
2. In the properties dialog box for the connection, click Install. 
3. In Select Network Feature Type or Select Network Component Type, double-click Protocol. 
4. In the Network Protocol list, click Reliable Multicast Protocol, and then click OK. 
5. To save changes to the connection properties, click Close. 
The Reliable Multicast Protocol component appears in the list of items being used by the connection, 
but has no configurable properties. 
Writing PGM-enabled Applications 
To use PGM, an application must use Windows Sockets and the PGM socket options. A sender 
application uses Windows Sockets to create a PGM socket, bind the socket to any address, and then 
connect to the multicast group address. A receiver application uses Windows Sockets to create a PGM 
socket, bind the socket to the multicast group address, post a listen on the new socket, and then use 
the accept() function to obtain a socket handle for the PGM session. 
Microsoft products that use PGM include Message Queuing (also known as MSMQ) and Automated 
Deployment Services (ADS). 
How PGM and the Reliable Multicast Protocol Works 
A receiver uses the following process: 
1. The multicast application opens a listen socket with the appropriate reliable multicast socket options. 
2. The receiver sends an IGMP Host Membership Report message to inform the local routers of the 
receiver's membership in the multicast group. 
A sender uses the following process: 
1. The multicast application opens a send socket with the appropriate reliable multicast socket options. 
2. The multicast application begins to send data. PGM packets containing data are sent beginning with 
a sequence number of 0, and are incremented by 1 for subsequent packets. 