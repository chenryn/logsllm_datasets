混部非混部集群资源使用对比图
156 > 9年双11：互联网技术超级工程
在日常情况下，我们可以把在线服务的集群的CPU利用率从非混部的10%
提升到混部的40%以上，整体的成本节省在30%以上。而在线受到的干扰在5%
以内。
混部非混部集群平均服务响应时间对比图
混部调度的架构
混部调度的架构示意图
新基础  9年双11：互联网技术超级工程
2.计算任务调度器Fuxi的特点是：
而向海量数据处理和大规模计算类型的复杂应用
●
提供了一个数据驱动的多级流水线并行计算框架，在表述能力上兼容Ma-
●
pReduce，Map-Reduce-Merge，Cascading，FlumeJava 等多种编程模式
高可扩展性，支持十万以上级的并行任务调度，能根据数据分布优化网络开
●
销。自动检测故障和系统热点，重试失败任务，保证作业稳定可靠运行完成
3.通过零层的资源协调机制，让整个集群平稳地管理并运行进来
混部集群管理
●
各调度租户之间的资源配比
●
日常与压测大促等时段的策略
●
异常检测与处理
●
混部的资源隔离
在混部中，放在首位的就是资源隔离问题，如果隔离问题没做好，竞争问题没解
决，那就很容易引发线上的问题。轻一点，让用户的感官体验变差；重一点，引发线
上故障，造成无法服务的恶劣影响。
而解决资源竞争的问题，主要从两个方面出发：
新基础  9年双11：互联网技术超级工程
日常态，计算任务占用在线服务的资源
●
大促态，在线服务占用计算任务的资源
●
1小时快速完成切换，提高资源的利用
●
3. 无损有损降级：在线服务会有一些特定的业务高峰时间，比如压测，比如大促
等。那么如何在降级计算任务的时候，带来的影响尽可能小呢？这里我们就
需要对降级的方案做特殊的处理。
新基础  9年双11：互联网技术超级工程
在线服务的内存加入共享分组
●
基于在线服务的实际内存使用，动态调整计算任务占用的内存水位
●
当在线服务压力突增时，通过迁移或Kill任务的方式，自动降级计算任务的内
●
存水位。计算任务释放内存后，内核马上进行资源回收。
当整机发生OOM时，优先杀计算任务中优先级低的任务。
●
6. 存储计算分离：在线服务是重IOPS，但是存储量不大，所以使用的都是
SSD的小盘；而计算任务都是重存储量，但IOPS不大，所以使用的都是
HDD的大盘。而在混部的时候，如果还是以本地盘的方式来处理数据，计算
混杂在一起，对于调度复杂度是几何级的提升。所以我们需要把本地盘虚拟
化成统一的存储池，通过远程的方式，根据不同的需求访问不一样的存储设
备。另外阿里也开始大规模建设25G的网络设施，整个网络能力提升，也让
远程访问变得像本地一样快。
新基础  9年双11：互联网技术超级工程
L3 Cache隔离
●
通过BDW CPU的特性CAT来进行对Cache访问的流量控制，进而达到
○
限制低优先级计算任务对CPU的占用。
内存带宽隔离
●
Memory Bandwidth Monitoring ，通过时实监控来进行策略调整
○
Cfs bandwidth control调节计算任务运行时间片长度。通过缩短时间片，
○
让高优先级任务更容易获得占用CPU的机会。
2.内存保护
内存回收隔离
●
按照不同的CGroup分配优先级
○
增加组内回收机制，避免全局内存回收干扰在线任务
○
按优先级确定内存回收的权重，在线任务的内存被回收的更少
○
OOM优先级
●
整机OOM时，优先杀低优先级任务
○
3. IO分级限制
文件级别的IO带宽隔离(上限)
●
新增blkio的控制接口
○
限制IOPS，BPS