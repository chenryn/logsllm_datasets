### 1. Introduction to the Network Map and Security Evaluation

To evaluate the security of circuits generated by TorPS against a network adversary capable of observing or controlling parts of the network infrastructure (such as network links, routers, and hosting facilities), we construct a detailed Internet map. This map, combined with path inference algorithms, allows us to identify the autonomous systems (ASes) and internet exchange points (IXPs) traversed by our simulated Tor users.

### 2. Construction of the Network Map

#### 2.1 Data Sources and Graph Construction

We construct the network map at the AS level using two primary data sources:

1. **BGP Paths**: We gather BGP paths from eight geographically distributed RouteViews routers during March 2013 [43].
2. **Traceroutes**: We supplement these BGP paths with additional links identified from traceroutes in the CAIDA IPv4 Routed /24 AS Links Dataset from December 2012 [9].

Combining these datasets, we create a graph consisting of 44,605 ASes connected by 305,381 links.

#### 2.2 Relationship Information

To obtain a near-complete set of relationship information for the AS links in our graph, we use a layered approach:

1. **Heuristic Algorithm**: We apply the heuristic algorithm originally suggested by Gao [21] to our network graph.
2. **CAIDA AS Relationships Dataset**: We then use relationships identified in the CAIDA AS Relationships Dataset for July 2012, overwriting any relationships previously identified through Gaoâ€™s algorithm as necessary [10].
3. **Sibling Relationships**: Finally, we use a set of sibling relationships heuristically identified from similarities in RIPE WHOIS records to correct misclassified sibling relationships.

This approach results in relationship assignments for 88% of the links in our dataset. Links without relationships, primarily from the CAIDA IPv4 Routed /24 AS Links dataset, are excluded from our path inference algorithm.

### 3. Autonomous System Path Inference

When considering ASes as adversaries, those capable of deanonymizing Tor traffic are those that exist on the AS path between the client and guard, as well as between the exit and destination. For each simulated client stream, we compute the AS path from the client to the guard and from the exit to the destination using the algorithm proposed by Qiu [33], which extends known AS paths drawn from BGP tables to all ASes using a shortest path variant. These computed paths are used in our network adversary analysis in Section 6.2.

### 4. Internet Exchange Point Mapping

In addition to ASes, we are interested in the prevalence of IXPs as another network administrative domain that could compromise Tor circuits. The IXP Mapping Project [4] gathers data about IXPs across the Internet and identifies the ASes that peer at each IXP. We use the IXP peerings dataset to identify locations along inferred AS paths where traffic transits through an IXP. The dataset contains 58,524 AS peers connecting through 199 distinct IXPs, representing 19.1% of the links in our network map. In cases where multiple IXPs exist as peering locations between ASes, we include both IXPs to avoid understating their potential impact.

### 5. Security Analysis of Tor

We evaluate the security of the Tor network against a range of plausible adversaries and with respect to several metrics, aiming to provide concrete numbers that are highly informative and relevant to end users.

#### 5.1 Types of Adversaries

We consider two general types of adversaries:

1. **Relay Adversary**: An adversary with the resources to run relays in the Tor network, allocating bandwidth to Tor relays to deanonymize Tor users.
2. **Network Adversary**: A network operator able to observe some portion of the underlying network over which Tor traffic is transported.

### 6. Relay Adversary Analysis

#### 6.1 Bandwidth Allocation and Adversary Resources

Adversaries who run relays represent the most plausible and well-understood threat to Tor users. We assume an adversary can contribute 100 MiB/s to the Tor network. Table 3 shows the top five families listed in the last consensus in March 2013, ordered by the smaller of their average and observed bandwidths.

To determine the best bandwidth allocation between the guard and exit relay, we conducted five experiments using TorPS, varying the allocation of 100 MiB/s of bandwidth between the guard and exit relays. The results, displayed in Figure 1, show that the expected rate of exit compromise decreases as more bandwidth is allocated to the guard. A 5:1 guard-to-exit ratio maximized the probability of compromising both sides of at least one stream during the simulation period, so we adopt this ratio for the remainder of our experiments.

#### 6.2 User Behavior and Security Implications

We consider how different user behavior can have different security implications. For instance, sending many streams over Tor increases the number of chances the adversary has to compromise one. Alternatively, specific destination addresses and ports affect the probability a malicious exit is chosen because allowed exit policies differ from relay to relay.

Using TorPS, we conduct simulations using each of the user models (described in Section 5.1.2) over a period from October 2012 to March 2013. The results, shown in Figure 2, indicate that in all user models, there is more than an 80% chance of deanonymization within 6 months by a malicious guard and exit. The median time to full compromise is always less than 70 days.

### 7. Network Adversary Analysis

Unlike the relay adversary, a network adversary does not run relays but leverages their position as a carrier of network traffic to correlate Tor traffic streams that cross their network at some point between the client and guard, and exit and destination pairs.

#### 7.1 Client Behavior and Location

We consider three types of clients in our analysis of a network-level adversary: Typical, BitTorrent, and IRC. We do not consider the WorstPort and BestPort behavior patterns, as these are highly dependent upon exit policy diversity and do not directly affect a network adversary. However, an equivalently dangerous behavior pattern exists: a client whose communication originates and terminates within the same autonomous system can be deanonymized by that autonomous system.

### 8. Conclusion

Our comprehensive analysis provides a detailed understanding of the security threats posed by both relay and network adversaries in the Tor network. By constructing a detailed Internet map and using path inference algorithms, we can identify and mitigate these threats, ultimately enhancing the security and privacy of Tor users.