0x01 前⾔
如有技术交流或渗透测试/代码审计/SRC漏洞挖掘/红队⽅向综合培训  或 红蓝对抗评估/安全产品研发/安全服务需
求的朋友
欢迎联系QQ/VX 547006660
https://github.com/J0o1ey/BountyHunterInChina
重⽣之我是赏⾦猎⼈系列，欢迎⼤家点个star
0x02 缘起
早上打开微信⽆聊⽔群，偶然间发现新上了家SRC
新上的SRC⼀般都是细⽪嫩⾁的处⼦，未经万⼈骑，得⼿也更加容易，我们来⼀探究竟
0x03 资产搜集到默认秘钥被改 ⼭穷⽔尽
简单⽤⽬标的cert信息收集了⼀下⽹络空间的资产
发现了⽬标不少的域名都采⽤“短横线命名法”，⼀般来说⼤⼚⽤这种命名法便于分辨开发、测试、⽣产环境还是蛮
多的
Wri t t en by J 0o1ey: 547006660
总结了⼀下，常⻅的开发、测试、⽣产环境域名中常⻅词如下
随后从资产列表中找到了⼀个看起来像管理api接⼝的域名进⾏访问
根据⻚⾯回显，结合之前多年的测试经验，推断此处使⽤了Apache Apisix
之前复现过Apache Apisix默认秘钥添加恶意路由导致的RCE漏洞，此处直接准备⼀试
发现直接寄了，⽬标⽣产环境的api把这个默认的key给改掉了，导致没法创建恶意路由
uat
test
dev
pre
pr
pro
...
Wri t t en by J 0o1ey: 547006660
难道就这样结束了？那显然不符合我们的⻛格
0x04 理顺思路-发现隐藏的测试环境资产
刚刚我们在进⾏资产搜集时，已经发现了⽬标域名的统⼀命名特点
那么我们完全可以借助FUZZ域名来搞出⼀点⽕花，尝试发掘隐藏资产
最终成功发现按照⽬标的⽬标的四处⾮⽣产环境的隐藏资产
./ffuf -w domain_test -u https://gateway-xxx-xxx-FUZZ.xxx.com -mc 404 -t 1
Wri t t en by J 0o1ey: 547006660
0x05 测试环境默认key的原罪到RCE
随后在下⾯四个隐藏⼦域尝试默认key添加恶意lua路由，发现均成功
添加恶意路由后，就是⼀⻢平川，直捣⻩⻰了
Wri t t en by J 0o1ey: 547006660
⽬标是运⾏在k8s上的，掐指⼀算应该是测试环境⽤了默认key的⽼镜像，运维也没做修改，导致了RCE的⼤锅
交完四处命令执⾏，奖励⾃⼰晚上吃鸡蛋肠粉加根肠
0x06 技术点总结
结合⽬标域名命名特点，发现隐藏的开发、测试环境资产
完成新突破
Wri t t en by J 0o1ey: 547006660