title:Measuring DNS over TLS from the Edge: Adoption, Reliability, and
Response Times
author:Trinh Viet Doan and
Irina Tsareva and
Vaibhav Bajpai
Measuring DNS over TLS from the Edge:
Adoption, Reliability, and Response
Times
Trinh Viet Doan(B), Irina Tsareva, and Vaibhav Bajpai
Technical University of Munich, Munich, Germany
{doan,bajpaiv}@in.tum.de, PI:EMAIL
Abstract. The Domain Name System (DNS) is a cornerstone of com-
munication on the Internet. DNS over TLS (DoT) has been standardized
in 2016 as an extension to the DNS protocol, however, its performance
has not been extensively studied yet. In the ﬁrst study that measures
DoT from the edge, we leverage 3.2k RIPE Atlas probes deployed in
home networks to assess the adoption, reliability, and response times of
DoT in comparison with DNS over UDP/53 (Do53). Each probe issues
200 domain name lookups to 15 public resolvers, ﬁve of which support
DoT, and to the probes’ local resolvers over a period of one week, result-
ing in 90M DNS measurements in total. We ﬁnd that the support for
DoT among open resolvers has increased by 23.1% after nine months in
comparison with previous studies. However, we observe that DoT is still
only supported by local resolvers for 0.4% of the RIPE Atlas probes. In
terms of reliability, we ﬁnd failure rates for DoT to be inﬂated by 0.4–
32.2% points (p.p.) when compared to Do53. While Do53 failure rates
for most resolvers individually are consistent across continents, DoT fail-
ure rates have much higher variation. As for response times, we see high
regional diﬀerences for DoT and ﬁnd that nearly all DoT requests take at
least 100 ms to return a response (in a large part due to connection and
session establishment), showing an inﬂation in response times of more
than 100 ms compared to Do53. Despite the low adoption of DoT among
local resolvers, they achieve DoT response times of around 140–150 ms
similar to public resolvers (130–230 ms), although local resolvers also
exhibit higher failure rates in comparison.
1 Introduction
The Domain Name System (DNS) faces various privacy-related issues such as
ﬁngerprinting or tracking [10,11,22,23,36] that aﬀect DNS over UDP/53 (Do53).
Consequently, DNS over TLS (DoT) was standardized in 2016 [19] to upgrade
the communication [35]: The protocol establishes a TCP connection and TLS
session on port 853, so that DNS messages are transmitted over an encrypted
channel to circumvent eavesdropping and information exposure. DoT has gained
increasing support since its standardization; e.g., it is supported on Android
devices as “Private DNS” since Android 9 (August 2018) [24]. Similarly, Apple
supports DoT and DNS over HTTPS (DoH) on their devices and services with
the recent iOS 14 (September 2020) and MacOS Big Sur (November 2020) [38].
c(cid:2) Springer Nature Switzerland AG 2021
O. Hohlfeld et al. (Eds.): PAM 2021, LNCS 12671, pp. 192–209, 2021.
https://doi.org/10.1007/978-3-030-72582-2_12
Measuring DNS over TLS from the Edge
193
Previous work [8,17,26] has studied the support and response times of DoT
(and DoH). However, the studies performed response time measurements from
proxy networks and data centers, which means that results might not appropriately
reﬂect the latency of regular home users: The measured response times are likely
overestimated due to the incurred latency overhead of proxy networks or under-
estimated due to the usage of well-provisioned data centers. We close this gap by
measuring DoT from the end user [28] perspective for multiple DoT resolvers as the
ﬁrst study to do so, using 3.2k RIPE Atlas home probes deployed at the edge across
more than 125 countries (Sect. 3). We issue DNS queries to 15 public resolvers, ﬁve
of which support DoT, to analyze and compare the reliability and response times
of Do53 and DoT resolvers. Our main ﬁndings are:
DoT Support (Sect. 2): We ﬁnd DoT support among open resolvers to have inc-
reased by 23.1% compared to previous studies [8,26]. TLS 1.3 support [15,31]
among these resolvers has increased by 15% points (p.p.), while support for
TLS 1.0 and 1.1 is increasingly dropped. For RIPE Atlas (Sect. 4), we only ﬁnd
13 (0.4%) of 3.2k home probes to receive responses over DoT from their local
resolvers.
DoT Failure Rates (Sect. 4): While overall failure rates for Do53 are between
0.8–1.5% for most resolvers, failure rates for DoT are higher with 1.3–39.4%,
i.e., higher by 0.4–32.2% points (p.p.) for individual resolvers. Failure rates are
more varying across the continents for DoT, ranging from ≤1% up to >10%,
with higher values primarily seen in Africa (AF) and South America (SA). On
the other hand, Do53 failure rates are more consistent across most resolvers and
continents (roughly 0.3–3%). Most failures occur due to timeouts (no response
within 5 s), which we suspect is due to intervening middleboxes on the path that
blackhole the connections by dropping packets destined for port 853.
DoT Response Times (Sect. 5): Comparing response times between Do53
and DoT, we ﬁnd that most DoT response times are within roughly 130–230 ms,
and are, therefore, slower by more than 100 ms, largely due to additional TCP
and TLS handshakes. For most samples of well-known DNS services (such as
Google, Quad9, or Cloudﬂare), response times of for Do53 are consistent across
the continents, while other resolvers show larger regional diﬀerences. For DoT,
only Cloudﬂare exhibits consistent response times across regions, whereas the
remaining resolvers have highly varying response times. In cases where the local
resolver does support DoT, response times are comparable to those of the faster
public resolvers (140–150 ms) and similarly inﬂated compared to Do53.
We discuss limitations (Sect. 7) and compare our ﬁndings to previous
work (Sect. 6) before concluding the study (Sect. 8). To facilitate reproducibility
of our results [1], we share the created RIPE Atlas measurement IDs, analysis
scripts, and auxiliary/supplementary ﬁles1. The measurements do not raise any
ethical concerns.
1 Repository: https://github.com/tv-doan/pam-2021-ripe-atlas-dot.
194
T. V. Doan et al.
2 DoT Background: Adoption and Traﬃc Share
DoT Adoption Among Open Resolvers. Deccio and Davis [8] study and
quantify the deployment of public DoT resolvers as of April 2019. Note that in the
context of their study, a resolver refers to an IP endpoint, which may, therefore,
include a replicated or anycasted service. They identify 1.2M open DNS resolvers
in the public IPv4 address space, out of which 0.15% (1,747) support DoT. Of
the DoT resolvers, 97% (1,701) support TLS 1.2 and 4.5% (79) support TLS
1.3, whereas older TLS versions (TLS 1.0 and 1.1) are not supported by 4.6%
(80) of the resolvers. A similar number of open DoT resolvers (1.5k) was found
by Lu et al. [26] (2019).
We repeat this scan from a research network at Technical University of
Munich (TUM) in January 2020 (i.e., nine months after Deccio and Davis [8]) for
the same set of open DNS resolvers. We ﬁnd that the number of open resolvers
supporting DoT has increased to 2,151, i.e., an increase by 23.1%. The share
of resolvers supporting TLS 1.2 has increased to 99.9% (2,149 resolvers), while
the percentage of TLS 1.3-supporting resolvers has increased to 20% even (433).
Older versions of TLS are not supported anymore by 508 resolvers (24%), which
altogether indicates that the adoption of DoT and newer TLS implementations
is increasing.
DoT Traﬃc Share. To assess the usage of DoT in terms of traﬃc, we analyze
public traﬃc traces collected from samplepoint-F of the WIDE backbone [7],
which monitors a research network link in Japan. We aggregate the daily traﬃc
traces of 2019 by month and inspect the traﬃc share of DoT, i.e., traﬃc on
TCP/853. We observe that DoT accounts for roughly 2M out of 11.8B ﬂows in
the dataset, which means that DoT accounts for around 0.017% of all ﬂows. On
the other hand, the traﬃc share of Do53 is more than 135 times as much with
271.5M ﬂows (2.3%), which indicates that DoT only contributes a very negligible
amount of traﬃc overall.
3 Methodology
Measurement Platform and Probes. We use RIPE Atlas [32] to measure
reliability and response times of Do53 and DoT from distributed vantage points;
DoT measurements are performed over TLS 1.2, as RIPE Atlas probes do not
fully support TLS 1.3 yet. For our experiment, we ﬁrst select probes that are
IPv4-capable and resolve A records correctly through the RIPE Atlas API. We
exclude anchor probes to capture the Do53 and DoT behavior for end users
more accurately. As older versions of RIPE Atlas probes (V1 and V2) exhibit
load issues [2,14], we only consider V3 probes, ultimately ﬁnding 5,229 probes
in total. For the analysis, however, we only take residential probes into account:
We use RIPE Atlas user tags [3] for the identiﬁcation of residential networks.
Additionally, we issue traceroute measurements to an arbitrary public endpoint
from all probes over IPv4: If the IP address of ﬁrst hop on the path is private [30]
Measuring DNS over TLS from the Edge
195
and the IP address of the second hop is in the public address space (i.e., the probe
is directly connected to the home gateway), we also identify the probe as resi-
dential. Combining the set of probe IDs determined from both these approaches,
we identify 3,231 home probes overall. As the number of dual-stacked residential
probes is signiﬁcantly lower (roughly 700 globally), we decide to not perform
measurements over IPv6: The low number of IPv6-capable probes overall limits
the regional analysis, since such probes are primarily deployed in Europe (EU)
and North America (NA), which would leave other continents largely underrepre-
sented. Thus, we focus on IPv4 measurements exclusively in our study, although
we suggest to repeat the measurements over IPv6 with increased deployment of
probes having native IPv6 connectivity.
DNS Resolvers. We issue the resolution of 200 domains (A records) to 15
selected IP endpoints of diﬀerent public DNS services once a day, repeated over
a period of one week (July 03–09, 2019). Out of the 15 public DNS services,
listed in Table 1, ﬁve support DoT: CleanBrowsing, Cloudﬂare, Google, Quad9,
and UncensoredDNS. For these services, we additionally issue the same DNS
lookups to the same IP endpoints using DoT for comparison. Moreover, we query
the same 200 domains using the DNS resolvers provided by a probe’s network
conﬁguration, which we will refer to as local resolver (typically operated by the
ISP and assigned via DHCP) in the following; this allows us to study the support
of DoT among ISPs. Note that probes may use multiple IP endpoints when
resolving domains locally. In particular, probe hosts may use public resolvers as
their local resolvers; thus, we exclude all occurrences of these public resolvers
from the local resolver measurements, including alternative IP endpoints which
these public DNS services may use. Among the 2,718 probes that receive at
least one successful Do53 response from a local resolver, we ﬁnd 2,257 probes
to use an endpoint in their private network as local resolver (e.g., a CPE) and
572 probes to use an ISP resolver (public IP address) for local name resolution.
However, as we do not see signiﬁcant diﬀerences in terms of response times at
the 5th percentiles of each probe (9.5 ms for CPE, 9.8 ms for ISP resolver), we
do not further distinguish between both groups.
Domains. The 200 queried domains consist of 150 websites from Alexa Top
1M [33]: We split the Top 1M list into 10 equally-sized bins of 100k each (by rank
order) and select the 15 ﬁrst domains of each bin, resulting in 150 popularity-
focused domains. The remaining 50 domains are selected from the country-based
Alexa Toplists, for which we determine 10 countries across the continents with
high numbers of probes (US, DE, GB, RU, NL, IT, JP, NZ, ZA, BR). We then