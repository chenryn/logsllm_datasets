www.it-ebooks.info
Chapter 5
Normally, giving Kali Linux a public IP address is really a bad
practice. Performing this step could mean opening up firewalls and
having Kali Linux exposed to remote attackers.
When you log into Gruyere, create a username by clicking on the Sign up button
on the upper-right hand screen, as shown in the following screenshot:
For this exercise, we created two separate accounts. Let's log in with the first account.
For our example, our first account is titled TheDude. Next, we go to the snippet
section and create a new snippet. We will enter a XSS script here as shown in the
following screenshot:
We know Gruyere has XSS vulnerabilities built into it, and therefore we are using
a script. In the real world, we could use the same script in any field on a targeted
website to test if it's vulnerable to XSS. For example, if we knew Facebook was
vulnerable to an XSS attack exploiting the middle name field, an attacker would
need to create a profile and use this script as their middle name.
[ 207 ]
www.it-ebooks.info
Attacking Authentication
Facebook is not exploitable using this attack. It is just a hypothetical example.
We entered the following code:
document.write("")
Although words may wrap around as you type the command, it needs
to be a single line command.
This is just one of many scripts that could be used to exploit a vulnerable system.
The focus of this book is leveraging tools available in Kali Linux; however, the best
Penetration Testers use a variation of industry-available tools like Kali Linux, and
custom tools, such as XSS scripts to breach targets. We suggest researching this topic
and testing new scripts against your Gruyere example target to master the ability to
build and execute custom script attacks.
Other tools
Here are some other tools that follow this chatper's theme and available in Kali
Linux:
urlsnarf
urlsnarf is a tool that outputs all requested URLs sniffed from HTTP traffic in
Common Log Format (CLF, used by almost all web servers), suitable for offline
post processing with your favorite web log analysis tool (analog, wwwstat, and
so on).
To access urlsnarf, navigate to Sniffing/Spoofing | Network Sniffers and
select urlsnarf. A Terminal will pop up showcasing use options as shown in
the following screenshot:
To use urlsnarf, type urlsnarf –i and the interface you want to monitor. urlsnarf
will display it's listening. This following screenshot shows urlsnarf listing to eth0:
[ 208 ]
www.it-ebooks.info
Chapter 5
urlsnarf will display a dump of any URL request seen on the wire. For example,
a windows user accesses www.thesecurityblogger.com. The URL requests are
displayed in urlsnarf for future use.
acccheck
acccheck is a password dictionary attack tool that targets windows authentication
using the SMB protocol. acccheck is a wrapper script around the smbclient binary,
and, as a result, is dependent on it for its execution.
hexinject
hexinject is a versatile packet injector and sniffer that provides a command-line
framework for raw network access. hexinject is designed to work together with other
command-line utilities, and for this reason it facilitates the creation of powerful
shell scripts capable of reading, intercepting and modifying network traffic in
a transparent manner. hexinject can inject anything into the network, as well as
calculate the checksum and packet size fields of TCP/IP protocols.
[ 209 ]
www.it-ebooks.info
Attacking Authentication
Patator
Patator is a multi-purpose brute force utility with a modular design and flexible
usage. Patator's capabilities include brute-forcing FTP, SSH, Telnet, SMTP, HTTP/
HTTPS, POP, IMAP, LDAP, SMB, MSSQL, Oracle, MySQL, DNS, SNMP, and
password files.
DBPwAudit
DBPwAudit performs online audits of password quality for several database
engines. The application is designed to allow for adding additional database drivers
by copying new JDBC drivers to the JDBC directory.
Summary
Compromising authentication permits an attacker to pose as an authorized person.
This can be useful when Penetration Testing web applications, because having
authorized access means bypassing most traditional security defenses.
Chapter 5, Attacking Authentication, focused on attacking how users and systems
authenticate. We started off by providing an overview of the different methods used
to confirm identity. The next section covered attacking the process of managing
authentication sessions. Next, we evaluated how session data is stored in a user's
browser by compromising cookie management. We then covered how to capture
authentication sessions by hiding between targets using various forms of man-in-the-
middle attacks. The final two sections evaluated authentication vulnerabilities web
application servers, such as SQL injection and cross-site scripting.
The next chapter will cover remote or web-based attacks on servers and clients.
[ 210 ]
www.it-ebooks.info
Web Attacks
The focus of this chapter will be on Internet-based attacks. Security administrators
for organizations are aware that there are malicious parties on the Internet,
continuously looking for ways to penetrate any network they come across and in
defense, administrators have security measures in place. Common defenses include
Firewalls, IPS/IDS, host-based security products, such as Anti-Virus, Content Filters,
etc. In the past, these defenses were sufficient; however, threats are becoming more
sophisticated nowadays, with the ability to circumvent commercial off the shelf or
"COTS" security solutions. The tools covered in this chapter will include methods in
Kali Linux, used to bypass standard security defenses from a remote location.
This chapter wraps up the Penetration Tester's attack arsenal. After reviewing material
covered in previous chapters, you should understand how to conduct reconnaissance
on a target, identify server-and client-side vulnerabilities, and techniques used for
exploiting them. This chapter will cover the final element of attack related to using web
applications as a front end. In addition, we will explore how to take advantage of the
web server itself and compromise web applications using exploits, such as browser
exploitation attacks, proxy attacks, and password harvesting. We will also cover
methods to interrupt services using denial of service techniques.
Browser Exploitation Framework – BeEF
www.it-ebooks.info
Web Attacks
Browser vulnerabilities can be exploited by malicious software to manipulate the
expected behavior of a browser. These vulnerabilities are a popular attack vector,
because most host systems leverage some form of Internet browser software. Let's
take a look at a popular tool developed to exploit browser vulnerabilities.
There are many cool Penetration Testing applications that should be included in
your hacking arsenal, such as one of our favorites known as Browser Exploitation
Framework (BeEF). BeEF is a browser-based exploit package that "hooks" one or more
browsers as beachheads for launching attacks. A user can be hooked by accessing a
customized URL and continue to see typical web traffic, while an attacker has access
to the user's session. BeEF bypasses network security appliances and host–based, anti-
virus applications by targeting the vulnerabilities found in common browsers, such as
Internet Explorer and Firefox.
BeEF is not included with the 1.0 release of Kali Linux, but can be found at
beefproject.com. We expect BeEF to be added into a future release of Kali
Linux based on its popularity in the Penetration Testing community.
To install BeEF, open a command terminal on Kali Linux as a root user and issue
the following commands:
• apt-get update
• apt-get install beef-xss
You may be asked to install, update, or overwrite some older files when you run the
apt-get update command. In most cases, you can just accept the default prompts.
When the update process is completed, you may use apt-get to install BeEF:
Once the process is complete, you will have BeEF installed on Kali Linux.
[ 212 ]
www.it-ebooks.info
Chapter 6
To start BeEF, navigate to /usr/share/beef-xss directory and type ./beef to start
the BeEF server. Once BeEF starts, the URLs to manage BeEF and hook victims will
be displayed in the terminal window:
To access the administration server, open a web browser and go to the /ui/panel
URL. When tricking a victim into being hooked by BeEF, redirect the victims to the
BeEF server hook URL listed as hook.js. You will need to develop a strategy to get
the victims to access your hook URL, such as a phishing or social engineering attack,
which redirects users to BeEF.
[ 213 ]
www.it-ebooks.info
Web Attacks
In this example, we will go to: http://172.16.86.144:3000/ui/panel.The default
username and password are both beef.
When a victim clicks on or is redirected to the "hook.js" website, the attacker on the
BeEF server will see the hooked browser. BeEF will add the new system to a list of
targets and display them if a hooked victim is online. Offline victims will become
vulnerable to attack once they reconnect to the Internet regardless if they access
the hook link prior to re-using the internet. The next screenshot shows BeEF's main
dashboard and options available to launch against a hooked system:
[ 214 ]
www.it-ebooks.info
Chapter 6
The previous example shows a hooked Windows laptop. BeEF can reveal the details,
such as whether the victim is using Firefox, Windows 32, specific browser plugins,
scripts, whether Java is enabled, and other useful information. The attacker can
execute commands on hooked machines, such as make a sound chime, grab session
cookies, capture screen shots, log keystrokes, and even use the hooked browser as
a proxy to attack other systems. Another example is having the hooked system log
into Facebook and using BeEF to capture the session cookie. An attacker can reply
to the authenticated session and have full access to the victim's Facebook account.
The possibilities for evil and destruction are endless. This beachhead could allow an
attacker unfettered access to the user's browser and all information that is needed to
access it.
BeEF provides the details of the hooked systems and logs the commands that are
executed. Both details of individual hosts and successfully executed command log
information could be copied into a final deliverable report:
[ 215 ]
www.it-ebooks.info
Web Attacks
Defending against browser-based penetration tools is difficult. The best defense is
ensuring that all browser-based software is updated with the latest versions and
security patches, along with disabling the browser from running Flash and Java. In
addition, security solutions that can detect common application-based threats such
as Next Generation Intrusion Prevention Systems (NGIPS) can provide an extra
layer of security. The majority of victims to penetration tools such as BeEF are users
who click links included in emails or social media guests posing as a trusted party
sharing things wrapped with malicious links/software/code and so on.
FoxyProxy – Firefox plugin
If you plan on using proxies for testing web applications such as Zed Attack Proxy
(ZAP) or BURP, you may want to use the Firefox plugin FoxyProxy to simplify
switching between, as well as enabling Proxy usage. FoxyProxy is a Firefox extension
that lets you to easily manage, change, enable, or disable proxy settings on Firefox.
You can download FoxyProxy from the Firefox add-on library.
Once FoxyProxy is installed, there will be an icon added on at the top of the Firefox
browser window. Click on that to open the FoxyProxy options dialog:
[ 216 ]
www.it-ebooks.info
Chapter 6
In order to add a proxy to FoxyProxy, do as following:
1. Click on the Add New Proxy button, and a new window will open.
2. Select Manual Proxy Configuration.
3. Enter the IP or Host address and the port number of the proxy server.
4. Click on OK to save the new proxy.
At this point, FoxyProxy is disabled permitting all traffic without a proxy in place, as
stated Completely disable FoxyProxy in the upper tab. To use a proxy, click the tab
and change it to your desired proxy. This feature makes it easy to switch between or
disable proxies in Firefox quickly:
[ 217 ]
www.it-ebooks.info
Web Attacks
BURP Proxy
Burp Proxy is a tool that intercepts HTTP and HTTPS traffic. It allows a Penetration
Tester to examine an application, its vulnerabilities, and the two-way traffic between
a client and a web server. Burp Proxy is very popular because of its ability to not
only examine the traffic, but also, it manipulates requests. We will examine how
Burp Proxy is used to manipulate, reply, and steal authentication.
It is important to remember that Burp Proxy is actually a part of Burp Suite, which is
a collection of tools. When a user enters a URL in their web browser such as http://
www.DrChaos.com, they expect to be directed to the website. A proxy server will
intercept that request and send it on behalf of a client. Proxy servers are usually
put in place to inspect the traffic and protect the clients from harmful data. As a
Penetration Tester, you can use a proxy server to intercept traffic from a client, copy
the request, or manipulate it:
Ask Bob what What is
the current time is the current time
Alice Proxy Bob
Bob says the The time
time is 7pm is 7pm
To launch Burp Suite, simply navigate to: Kali | Sniffing/Spoofing | Web Sniffers
and select Burp Suite.
[ 218 ]
www.it-ebooks.info
Chapter 6
Once Burp Suite is launched, you will be presented with the Burp launch dashboard:
To configure Burp, click on the Proxy tab. By default, the Intercept button is selected
in this tab. When the Intercept option is enabled, Burp stops all requests from a
web browser to the web server. The feature allows a Penetration Tester the ability to
examine a connection. The Penetration Tester can manually allow the connection to
continue once it's viewed.
The Intercept button requires manual intervention, or the request will
never make it to the web server.
The next configuration setting is found on the Options submenu. This section will
allow users to check or change the default port on which Burp is running, as well as
configure the interface or network seen by Burp. By default, Burp is set to run on the
loopback interface, as shown in the following screenshot. A loopback interface is a
special interface that usually has the IP address of 127.0.0.1 associated with it. It does
not have a physical hardware connection tied to it, but is a way for the operating
system to reference itself. In other words, when you want to communicate with
yourself in networking, you could use a loopback. If you plan on testing Burp Suite
beyond the local machine, you should add your Ethernet interface and IP address.
[ 219 ]
www.it-ebooks.info
Web Attacks
We will use the loopback interface for our example:
The next step is configuring the browser to use Burp Suite. All browsers have a
similar way of using a proxy server. In the next example, we have depicted the
settings for configuring a proxy server on Firefox:
For the following example, we will go to a URL, such as www.DrChaos.com in
Firefox. You will notice that nothing happens. This is because the Intercept feature
is enabled by default, as we discussed earlier. You can now see the Intercept tab in
Burp has changed colors to indicate a new request has been intercepted.
[ 220 ]
www.it-ebooks.info
Chapter 6
When you click on the Intercept tab, you will see the exact nature of the request.
You can now click on Forward or Drop to allow or deny the request specifically
from continuing:
When you click on the Forward button, you will see the request continuing
to the server, as well as the response from the server. Also, you should see the
webpage successfully loaded in the web browser. Some web pages have multiple
components, so you may need to select the Forward button multiple times before
the web page loads.
Another cool feature is Burp Spider. Burp Spider offers a way of mapping web
applications in an automated fashion. How Burp Spider works is that you first
setup Burp to proxy your Internet usage, as we had explained earlier. Next, you
enable Burp Spider, and while it is running, Burp will map all the requests and
offer the ability to spider any captured request to find new targets.
To use the Spider, click the Spider tab to bring up the default configuration page.
Click on the Spider is paused button to change the status to Spider is running:
[ 221 ]
www.it-ebooks.info
Web Attacks
Burp maps all requests seen by the proxy under the Target tab. Click on the Target
tab to see what has been captured. There will be a list of targets that are being used
on the proxy. URLs that are in gray means that you have not directly browsed those
targets, while URLs in black are sites to which you have explicitly browsed to:
To use the Spider function, right-click on a target and select Spider this host:
[ 222 ]
www.it-ebooks.info
Chapter 6
When you go to the Spider tab in Burp, you will notice the Spider Status counts
have changed from 0 to an accumulating number:
If Burp encounters any forms, it will prompt you to fill out the forms or ignore them.
If you fill out the forms, Burp will continue to see what else it can spider on pages
past the forms:
[ 223 ]
www.it-ebooks.info
Web Attacks
When the Spider process is complete, go back to Targets tab and find the host you
originally selected to spider. Click on the triangle next to the host to expand it. You
will see all the spider results under your original target:
Burp shows all pages and links that the Spider process has captured. In addition, it
will capture the root directory, web page styles, sub-folders, and Java scripts. The
next example shows multiple, captured sub-folders on the site www.Drchaos.com.
[ 224 ]
www.it-ebooks.info
Chapter 6
Burp has the ability to filter items using the gray Filter bar on top of the page.
When you click on the Filter button, it will expand out the options available to
filter the results:
The Spider option in Burp allows a web Penetration Tester to view how a web
application or a website is configured, what links are contained, and to where
those links lead. An analogy of this concept is being in a room with many doors
and having the ability to explore each door simultaneously.
OWASP – ZAP
ZAP is an easy-to–use, integrated Penetration Testing tool for finding the
vulnerabilities in web applications. We provided a brief overview of how to use
ZAP in Chapter 3 regarding scanning a target for possible vulnerabilities. Let's
revisit ZAP for identifying and exploiting cross-site scripting (commonly referred
to as XSS) vulnerabilities.
ZAP comes built into Kali Linux 1.0, and can be found under Sniffing/Spoofing |
Web Sniffers and selecting Owasp - ZAP, or simply opening a terminal window
and typing in zap, as shown in the following example:
[ 225 ]
www.it-ebooks.info
Web Attacks