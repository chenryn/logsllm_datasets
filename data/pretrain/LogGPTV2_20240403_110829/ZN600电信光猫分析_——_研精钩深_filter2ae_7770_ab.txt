而ZN600则是一只彻头彻尾的“太监”猫！下面第一张图是从Linux
tc上截取的，第二张图则是在容器里头OpenWrt截取的。果真是，没有对比就没有伤害啊。。。
我们team能够切入到容器里头的OpenWrt还得感谢chinadsl.net论坛的大神achaoge在文章【6】中提供的技术思路——利用Linux系统的rc.local文件实现开机自启动，然后在别的端口运行telnet服务程序。这个方法有两个好处：一是，避开电信工程师苦心编写的saf容器管理程序，不跟这货正面刚，打不赢，咱玩儿迂回包抄；二是，这个方法还解决了telnet服务自启动（持久化）。
按照achaoge在文章【6】中给出的方法，登录ZN600光猫之后，在/opt/upt/apps/apps/etc/目录下，创建rc.local文件并写入以下内容。
在重新启动光猫之后，就可以通过telnet连接ZN600光猫的1123端口，登录到OpenWrt容器中。
## 0x04：配置文件获取
###  1、光猫基本配置信息——/userfs/profile.cfg
从前面对/etc/init.d/rcS启动脚本的分析，我们可以清楚地看到，ZN600开机之后的第一件事情就是读取配置文件/userfs/profile.cfg。这个配置文件中定义了各个不同厂商的光猫硬件信息和相关的软件配置信息。这个配置文件的设计思路很简单，如果某个参数或者选项被设定了则将其对应名称的字符串值赋值为y；否则，直接用#注销掉这个参数或选项。
从我们的分析来看，这个配置文件应该是光猫厂商自己的配置文件，没有针对特定的运营商，甚至没有针对特定的地域范围。除此之外，在/userfs目录下还有一个名为romfile_f.cfg的xml格式配置文件，没有去进一步验证这两文件是不是内容一致。
再者，/etc/profile.cfg配置文件中有一个配置选项让脚本小子们差点吓出尿了。下面第一张截图是sublime截图，第二张是telnet到ZN600之后的截图。还好#妥妥的在那儿，阔怕啊。。。
###  2、天翼智能网关系统配置信息——/etc/romfile_f.cfg
这是一个xml格式的配置文件，存储了包括智能网关超级后台用户密码在内的各种系统配置信息，如下图：
很多人，包括我们这帮傻小子在内，一直以为天翼智能网关只有两个账户：一个后台超级管理账户以及一个登录Web后台的普通用户。万万没想到啊，还有“第三者”！不过，我们尝试过了各种方法，这个第三者始终无法插足Web后台。。。
###  3、其它配置文件——备胎
在/userfs目录下，还有一堆的配置文件，除了前面说到的那两个外，还有一些涉及到具体地域的配置文件。
把这些文件下载到本地之后，逐一查看，全部都是加密了的。。。
看到这些文件，心都凉了，咋整啊？没想到，下载到本地以后，file命令已查看，就是拿gzip压缩了一下而已。虚惊一场。。。
###  4、实时查看配置文件——tcapi
正如同我们在PT632光猫分析中说的那样，天翼系列智能网关实现了一个名叫tcapi的程序，它的作用就是读写及应用系统配置信息，是用以查看当前配置文件的正确解法。
## 0x05：Some Tricks
由于Linux
tc里面阉割了busybox，这个问题team的前两篇文章已经说过了，干掉find和grep命令。当然，天翼智能网关的“智能OS”自始至终就把Linux系统内置的alias命令排除在外（这一点最恶心人）。
###  1、开启telnet
关于开启电信光猫telnet的方法其实就那么一两种，在牛人一堆的chinadsl.net一搜就能找到。但是，碍于电信集采的时候选定了好几家厂商，因此各个厂商在实现上会略有区别，所以光猫开启telnet的方法因为因为厂商的不同略有差异。再者，不同地域的电信公司也会有一些奇怪的电信光猫超级后台密码管理策略，比如每隔一段时间通过TR069协议检查超级后台密码是否更改，如果更改就直接给你换个新的；再者，不同地域默认的后台超级管理密码也可能不一样，当然还需要进一步、全面的分析和验证（已经在chinadsl.net注册账号了，准备找大神和大牛们请教^_~）。
再者，前面Lxc容器技术部分也提到了如何利用rc.local文件实现容器内telnet的自启动和持久化。个人觉得这个技巧最为精妙，用最简单的方法，实现了最暴力的穿透。
###  2、物理机与OpenWrt容器之间的文件交换
是的，电信工程师“过分到”阉割vi的地步了，因此要想在上面写个东西挺难的。咋整呢？
我们可以通过在物理机里面添加rc.local文件实现与OpenWrt共享rc.local配置文件，那么同样可以添加别的文件啊！但是，文件夹的话有些问题，只能共享目录，不能在共享的目录下方共享别的文件（努力找原因…）。
再者，如果你不想去动系统相关的配置文件，那也可以在ZN600的U口上插个U盘，这样也能实现容器内外之间的文件共享。
用U盘来在交换文件可以做到容器内外双向传递！
###  3、文件下载
如果只希望下载特定文件到自己电脑进行分析的话，可以利用上一篇介绍PT632光猫文章中的方法，利用替换原本系统配置文件的方法，下载所需要的特定文件。这种方法对于急需分析某个文件而言，特别方便。
再者，如果希望下载大量文件的话，还是拷贝到U盘好使，我们一开始也是这样干的，不想去动手配置FTP服务器。
最后，可以在本地配置一个允许上传文件的FTP服务器，这样就可以用Linux tc中busybox所导出的ftpput上传文件。
## 0x04：总结
1、功能性。其实，天翼网关中涉及Moden那部分几乎没什么变化，毕竟各种底层的协议已经设计好了，而且除非电信网络有了实质性的性能提升，几乎不会有大的变动。当然，在原有的基础上加上一个LXC跑起来的OpenWrt的话，那一切就变得有意思了，毕竟那么多的插件可以用，功能性几乎是呈几何增长啊。
2、易用性。其实，绝大多数家庭都用不到那些OpenWrt插件，更别说ClamAV这样的安全插件了。不过，既然是脱胎于天翼智能网关，那么传统的那套操作界面也没有实质性变化，对于绝大多数家庭而言，也就那样吧。
3、安全性。由于引入了LXC和OpenWrt，从理论上来说，功能性增加了，攻击面也会相应的增加。还好，LXC自身是一项非常成熟的虚拟化技术，安全性还是信得过吧。再者，OpenWrt毕竟跑在Jail里，没有过硬的漏洞应该是打不穿的。还有，不得不说一下那帮电信工程师，的确是很有经验并且很在意安全的，那么严格的阉割（三大里头）也只有他们干得出来了。
## 0x05：参考
1、《决定宽带上网速率的主要因素》.   
2、《中国电信2021年天翼网关4.0集采结果公布：中兴通讯成最大赢家》.
3、《什么是Linux容器？》.   
4、《[光猫] 玩机：激活华为光猫的小宇宙-openwrt》
.  
5、《F650/F450、HS8145等ARM平台，LXC容器内运行 OpenWrt 19.07.1 子系统》
.  
6、《中兴 F450A/F650A 免 TTL 持久开 ssh》
.