针对某 架构系统的渗
C/S
透测试
这是 酒仙桥六号部队 的第 147 篇⽂章
1
前⾔
本⽂主要记录了某次⾦融类客户项⽬中遇到的⼀个
C/S 架构系统的渗透测试，多个漏洞组合最终导致的内
⽹沦陷。
2
前期准备
⾸先打开⽬标站点
默认⻚⾯⽆任何交互点, 使⽤ dirsearch 进⾏简单扫描
发现存在 / config ⽬录
访问后发现可直接列⽬录
换⽤更强⼤的⽬录字典之后, 扫描出了⼀个配置界⾯
config.jsp
通过⽹上搜索这个系统的相关⼿册得知系统默认⽤户名
为: 系统管理员 密码为: 12345
尝试登录发现默认密码已经修改, 通过 Burp 挂载
somd5top10w 字典爆破⽆果
⽬前在 Web 端暂时没发现什么问题，把注意⼒回到他
的 Index ⻚⾯上，⻚⾯下⽅写了需要运⾏ ActiveX 控
件，将浏览器调整⾄兼容模式，安装控件后弹出了客户端
安装界⾯
下载安装完成后，运⾏客户端以后发现系统默认已经显
示了⽤户号和⽤户名称等信息
尝试了默认密码 12345 以及其他常⻅弱⼝令均⽆果，
尝试修改⽤户号为 admin 发现系统会⾃动帮我删除掉，
怀疑⽤户号只能为纯数字
这个时候有意的事情就来了，当我尝试输⼊ 123、
12345 等⽤户号的时候，系统依旧会⾃动帮我删除输⼊
的内容，但是在输⼊ 01、02、9999 等⽤户号的时候，
下⾯会有信息显示
看到这个我的第⼀反应是想到了以前在学校期间研究过
的 X ⽅教务管理系统，某些版本的 X ⽅系统是内置了数
据库账号密码在程序⾥，程序直接与数据库交互的，想到
这赶紧下载个 Cain 嗅探⼀下看看
然⽽很遗憾，Cain 并没有嗅探到数据库信息，那么尝
试安装 Proxifier，将客户端的流量代理到 Burp 康康
配置好 Proxifier，将流量全部转发出去，然后 Burp
查看抓到的包
从 Burp 抓到的包来看，SQL 语句是加密传输的，但
是翻了⼏个包以后，忽然发现有个 XML 的请求，直觉告
诉我这⾥很有可能存在 XXE
3
SSRF
尝试将上⾯ Burp 抓到的 XML 请求的包内容进⾏修
改，指向⾃⼰的服务器
果然存在 XXE，但是测试了命令执⾏，⽂件读取等，
均⽆法实现，只能当作 SSRF 进⾏简单的内容探测
4
OD 调试
还是回到客户端上，客户端虽然加密传输了 SQL 语
句，但是在程序运⾏的时候，内部肯定还是要解密成明⽂
来校验的，那么可以尝试使⽤ ollydbg 来调试程序，从程
序运⾏过程中读取到他解密后的内容
最终通过 OD 抓取到了系统管理员的密码，也成功登
陆到了 Web 端的配置界⾯，在 Web 界⾯⾥可以看到使
⽤的是 SQLServer 数据库，但是数据库是内⽹地址，密
码可以通过 F12 直接查看到
5
Quake 搜索
但是问题来了，数据库是内⽹，⽬前所拥有的洞并不
⾜以链接到数据库，去反编译程序找加密算法⼜有点麻
烦，回头看了眼 Dirsearch 的扫描结果，其中有 login 相
关的接⼝，但是这个客户端明明只和 servlet 接⼝通讯，
那么这套系统肯定还存在⼀个登陆接⼝，到 Index ⻚提
取特征，使⽤ Quake 搜索互联⽹上的其他这台系统，还
真找找不少
通过对互联⽹上其他这类系统的⼿⼯测试，果然发现存
在⼀个 login.jsp 的登陆界⾯
在 Web 登陆界⾯中，输⼊⽤户编码 0000，Web ⻚⾯
也会直接返回⽤户姓名
使⽤ Burp 抓包，将地址改为⽬标 IP，发现⽬标果然
只是删除了登录⻚，但是接⼝还在
直接在 code 字段打上标识，SQLMAP ⼀把梭！
很舒服，SQLServer2008 的数据库，DBA 权限，堆
叠查询，测试了下，⽬标只能 DNS 出⽹，CS 配置
DNS，直接上线！
内⽹简单的探测了下，因为客户没有授权，所以没有继
续深⼊
6
总结
在这次渗透测试中，⽬标客户端虽然使⽤了加密传输，
但是客户端本身未做反调试，可以通过 Od 直接附加进
程。
客户服务器虽然限制了正常的出⽹，但是未对 DNS 协
议进⾏限制，导致了 CS 使⽤ DNS 协议直接上线。
在 Quake 寻找互联⽹类似系统进⾏测试找 SQL 注⼊
纯粹是因为我对逆向还不是很熟。
如果是换成其他对逆向⽐较熟悉的师傅，完全可以做到
逆向客户端找到加密算法，来实现 SQL 命令任意执⾏。
全⽂完
本⽂由 简悦 SimpRead 优化，⽤以提升阅读体验
使⽤了 全新的简悦词法分析引擎 beta，点击查看详细说明
|---|--|--|--|
| 0 |  |  |  |
| 1 |  |  |  |