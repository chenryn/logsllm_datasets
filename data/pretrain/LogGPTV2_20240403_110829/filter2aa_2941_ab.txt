Vitals	
Code	
  Name:	
   Capt.	
  Brain	
  Drain	
Filename:	
   ram32.sys	
File	
  Type:	
   PE	
  32-­‐bit,	
  Kernel	
  Driver	
Target	
  Plaborm:	
   Windows	
Key	
  Features	
• 	
  Installs	
  malware	
  as	
  a	
  rootkit	
  to	
  stay	
  hidden	
  from	
  process	
  list	
• 	
  Checks	
  all	
  running	
  processes	
  in	
  kernel	
  for	
  track	
  data	
• 	
  Output	
  dumped	
  to	
  ﬁle	
  w/	
  “HIDDEN”	
  and	
  “SYSTEM”	
  aFributes	
• 	
  Character	
  subsHtuHon	
  in	
  output	
  ﬁle	
  to	
  avoid	
  detecHon	
• 	
  At	
  set	
  Hme	
  daily,	
  malware	
  archives	
  data	
  and	
  ﬂushes	
  the	
  data	
from	
  output	
  ﬁle	
  to	
  avoid	
  duplicaHon	
  of	
  stolen	
  data	
Vic@m	
Sports	
  Bar	
  in	
  Miami	
• 	
  An	
  elite	
  locaHon	
  that	
  aFracts	
  celebriHes	
• 	
  IT	
  operaHons	
  outsourced	
  to	
  Third	
  Party	
• 	
  Owner	
  throws	
  away	
  security	
  and	
  compliance	
  noHces	
  as	
monthly	
  IT	
  expenses	
  “give	
  him	
  a	
  headache”.	
• 	
  POS	
  System	
  is	
  also	
  a	
  DVR	
  server	
Copyright Trustwave 2010 
Sample SL2009-127 – Memory Rootkit Malware 
It’s Demo Time! 
Copyright Trustwave 2010 
Sample SL2010-018 – Windows Credential Stealer 
Vitals	
Code	
  Name:	
   Don’t	
  Call	
  Me	
  Gina	
Filename:	
   fsgina.dll	
File	
  Type:	
   Win32	
  Dynamic	
  Link	
  Library	
Target	
  Plaborm:	
   Windows	
Key	
  Features	
• 	
  Loads	
  with	
  Winlogon.exe	
  process	
• 	
  Changes	
  Windows	
  AuthenHcaHon	
  screen	
  to	
  a	
  “Domain	
  login”	
screen.	
• 	
  Stores	
  stolen	
  credenHals	
  in	
  ASCII	
  ﬁle	
  on	
  system	
• 	
  Only	
  stores	
  successful	
  logins	
• 	
  AFempts	
  exporHng	
  logins	
  via	
  SMTP	
  to	
  an	
  email	
  address.	
Vic@m	
Online	
  Adult	
  Toy	
  Store	
• 	
  A	
  100	
  person	
  company	
  on	
  the	
  West	
  Coast	
  of	
  USA.	
• 	
  Outsourced	
  website	
  hosHng	
  and	
  dev	
  to	
  a	
  low	
  cost	
  provider	
• 	
  Admin	
  page	
  allows	
  uploads	
  of	
  ﬁles	
• 	
  Database	
  stores	
  card	
  data	
  for	
  10	
  minutes	
  post	
  transacHon	
Copyright Trustwave 2010 
Sample SL2010-018 – Windows Credential Stealer 
Another Demo! 
Copyright Trustwave 2010 
Sample SL2009-143 – Network Sniffer Rootkit 
Vitals	
Code	
  Name:	
   ClandesHne	
  Transit	
  Authority	
Filename:	
   winsrv32.exe	
File	
  Type:	
   PE	
  32-­‐bit	
Target	
  Plaborm:	
   Windows	
Key	
  Features	
• 	
  Components	
  of	
  malware	
  embedded	
  inside	
  it	
  -­‐	
  Ngrep,	
  RAR	
tool	
  and	
  Conﬁg	
  ﬁle	
• 	
  Uses	
  rootkit	
  to	
  hide	
  malware	
  from	
  Task	
  Manager	
• 	
  Ngrep	
  opHons	
  contains	
  Track	
  Data	
  regular	
  expression	
• 	
  At	
  the	
  end	
  of	
  the	
  day,	
  it	
  RARs	
  and	
  password	
  protects	
  the	
temporary	
  output	
  ﬁle	
  and	
  creates	
  new	
  ﬁle	
  for	
  next	
  day.	
• 	
  Exports	
  compressed	
  and	
  password	
  protected	
  data	
  via	
  FTP	
Vic@m	
Interna@onal	
  VoIP	
  Provider	
• 	
  Seven	
  person	
  company	
  (~80,000	
  acHve	
  customers)	
• 	
  2	
  methods	
  of	
  payment:	
  website	
  or	
  kiosk	
• 	
  Data	
  Center	
  was	
  in	
  barn;	
  was	
  home	
  to	
  20	
  farm	
  cats	
• 	
  Payment	
  Switch	
  support	
  outsourced	
  to	
  3rd	
  party	
Copyright Trustwave 2010 
Sample SL2009-143 – Network Sniffer Rootkit 
Demo #3! 
Copyright Trustwave 2010 
Sample SL2010-007 – Client-Side PDF Attack 
Vitals	
Code	
  Name:	
   Dwight’s	
  Duper	
Filename:	
   Announcement.pdf	
File	
  Type:	
   Portable	
  Document	
  Format	
Target	
  Plaborm:	
   Windows	
Key	
  Features	
• 	
  Malware	
  aFached	
  in	
  targeted	
  email	
  looks	
  to	
  be	
  normal	
  PDF	
• 	
  PDF	
  contains	
  0day	
  exploit	
  (in	
  January	
  it	
  was).	
• 	
  Shell	
  code	
  executes	
  upon	
  PDF	
  launch	
• 	
  Shell	
  code	
  calls	
  a	
  batch	
  ﬁle	
  which	
  steals	
  all	
  *.docx,	
  xlsx,	
  pptx	
and	
  txt	
  ﬁles	
  from	
  user’s	
  My	
  Documents	
  folder	
• 	
  Stolen	
  ﬁles	
  are	
  compressed,	
  password	
  protected	
  and	
  sent	
to	
  FTP	
  over	
  TCP	
  port	
  443	
Vic@m	
US	
  Defense	
  Contractor	
• 	
  Provides	
  analyHcs	
  service	
  to	
  US	
  Military	
• 	
  No	
  inbound	
  access	
  allowed	
  from	
  the	
  Internet	
  without	
  VPN	
• 	
  Egress	
  ﬁltering	
  set	
  to	
  only	
  allow	
  TCP	
  ports	
  80	
  and	
  443	
• 	
  Extremely	
  secure	
  environment	
  compared	
  to	
  previous	
  3	
Copyright Trustwave 2010 
Sample SL2010-007 – Client-Side PDF Attack 
Last One! 
Copyright Trustwave 2010 
Conclusions (What we learned in the past year) 
Customiza@on	
  of	
  Malware	
• 
One	
  size	
  ﬁts	
  all	
  is	
  not	
  the	
  mantra	
  of	
  aFackers	
  today	
Slow	
  and	
  Steady	
  wins	
  the	
  race	
• 
Malware	
  writers	
  are	
  not	
  in	
  for	
  quick	
  and	
  dirty	
  hacks.	
  Since	
  data	
is	
  stolen	
  in	
  transit,	
  persistency	
  is	
  the	
  key.	
An@Forensics	
• 
DetecHon	
  is	
  not	
  easy	
  for	
  these	
  new	
  age	
  malware.	
  MAC	
  Hmes	
are	
  modiﬁed;	
  random	
  events	
  conﬁgured	
  and	
  protecHon	
  from	
detecHon	
  built	
  in.	
Automa@on	
• 
AFackers	
  adding	
  layers	
  to	
  malware	
  to	
  automate	
  tasks	
  so	
  that	
they	
  don’t	
  have	
  to	
  come	
  in	
  to	
  the	
  system	
  and	
  risk	
  detecHon.	
Not	
  Slowing	
  Down	
• 
Since	
  Malware	
  Freakshow	
  last	
  year	
  at	
  DEF	
  CON	
  17,	
  the	
techniques	
  have	
  improved	
  signiﬁcantly.	
Contact Us: 
Nicholas J. Percoco / PI:EMAIL / @c7five 
Jibran Ilyas / PI:EMAIL / @jibranilyas