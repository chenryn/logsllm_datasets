## Page 409
网络安全进阶笔记
一般包括如下网络服务程序：
·chfmn—提升本地普通用户权限的程序。运行chfm，在它提示输入新的用户名时，如
果用户输入rookit密码，他的权限就被提升为root。
chsh—提升本地用户权限的程序。运行chsh，在它提示输入新的Shell时，如果用
户输入rootkit密码，他的权限就被提升为root。
passwd——和上面两个程序的作用相同。在提示你输入新密码时，如果输入rooki密
码，权限就可以变成root，
login——允许使用任何账户通过rootkit密码登录。如果使用root账户登录被拒绝，
inetd-
特洛伊inetd程序，为攻击者提供远程访间服务。
rshd——为攻击者提供远程 Shell服务.攻击者使用rsh-1 rootkitpasswordhostcommand
命令就可以启动一个远程root shell。
·shd——为攻击者提供SSH服务的后门程序。
再就是工具程序。所有不属于以上类型的程序都可以归入这个类型，它们实现一些诸如日
志清理、报文噢探以及远程Shell的瑞口绑定等功能，包括：
fix-文件属性伪造程序
。
linsniffer报文噢探器程序。
sniffchk—简单的bash shell 脚本，检查系统中是否正有一个噢探器在运行。
wtedwtmp/utmp
一日志编辑程序。你可以使用这个工具编辑所有wtmp或者utmp类
型的文件。
z2-
utmp/wtmp/lastlog日志清理工具。可以删除utmp/wtmp/lastiog 日志文件中有关
某个用户名的所有条目。不过，如果用于Linmux系统，需要手工修改其源代码，设置
日志文件的位置。
bindshell在某个编口上绑定Shell服务，默认端口是12497。为远程攻击者提供
Shell 服务。
(4)netcat
软件下载地址为 http://www,atstake.com/research/tools/network_utilities/,
这是一个简单面有用的工具，能够通过使用TCP或UDP协议的网络连接去读写数据。它
被设计成一个稳定的后门工具，能够直接由其他程序和脚本轻松驱动。同时，它也是一个功能
强大的网络调试和探测工具，能够建立你需要的几乎所有类型的网络连接，还有几个很有意思
的内置功能。
2.查找Linux下的蛛丝马迹：日志工具
对于高明的攻击者来说，进入系统后，还应了解自己的“蛛丝马迹”并清除这些痕迹，自
然就要了解一些日志工具了。
(1)logcheck
软件下载地址为 http://www.psionic.com/abacus/logcheck/,
logchek可以自动地检查日志文件，定期检查日志文件以发现违反安全规则以及异常的活
动。它先把正常的日志信息别除掉。把一些有间题的日志保留下来，然后把这些信息E-mail
给系统管理员。logcheck用logtail程序记住上次已经读过的日志文件的位置，然后从这个位置
.404.
---
## Page 410
第8章掌握实用的Linux安全工具
开始处理新的日志信息。logcheck主要有下面儿个主要的文件：
logcheck.sh—可执行的脚本文件，记录logcheck检查哪些日志文件等，我们可以把
它加入crontab中定时运行。
。
logcheck.hacking——是logcheck检查的模式文件。与下面的文件一起，按从上到下的
顺序执行，这个文件表明了入侵活动的模式。
logcheck.violations-—这个文件表示有间题，违背常理的活动的模式。优先级小于上
面的那个模式文件。
logcheck.violations.ignore—这个文件和上面i的logcheck.violations 的优先级是相对
的，是我们所不关心的问题的模式文件。
logcheck.ignore—这是检查的最后一个模式文件，如果没有和前3个模式文件匹配，
也没有匹配这个模式文件的话，则输出到报告中。
·Logtail-记录日志文件信息。
Logcheck首次运行时，读入相关的日志文件的所有内容，Logtail会在日志文件的目录下
为每个关心的日志文件建立一个logfile.offset的偏移量文件，以便于下次检查时从这个偏移量
开始检查。Logcheck执行时，将未被忽略的内容通过邮件的形式发送给logcheck.sh中系统管
理员指定的用户。
(2)logrotate
一般Linux发行版中都自带这个工具。它可以自动使日志循环，剩除保存最久的日志，它
的配置文件是/etc/logrotate.conf，我们可以在这个文件中设置日志的循环周期、日志的备份数
目以及如何备份日志等。在/etc/logrotate.d目录下，包括一些工具的日志循环设置文件，如 syslog
等，在这些文件中指定了如何根据/etc/logrotate.conf做日志循环，也可以在这里面添加其他的
文件以循环其他服务的日志。
(3)swatch
软件下载地址为 ftp:/ftp.stanford.edu/general/security-tools/swatch/。
swatch是一个实时的日志监控工具，我们可以设置感兴趣的事件。swatch有两种运行方式。
一种可以在检查日志完毕退出，另一种可以连续监视日志中的新信息，swatch提供了许多通知
方式，包括E-mail、振铃、终端输出、多种颜色等。安装前，必须确保系统支持Perl。swatch
软件的重点是配置文件swatchmessage，这个文本文件告诉swatch需要监视什么日志，需要寻
找什么触发器，和当触发时所要执行的动作。当swatch发现与swatchmessage中定义的触发器
正则表达式相符时，它将执行在swalchrc中定义的通知程序。
当然，上面所介绍的软件只是Limux大海中的儿只美丽的贝壳，随着越来越多的用户加入
到Linux大军中，我们相信，优秀的Hack也将越来越多，这反过来也将促进Linux操作系统
逐步走向成熟，我们拭目以待。
8.3寻找嗅探世界里的屠龙刀
系统管理员遇到一些网络连接方面的故障时，使用噢探软件往往会获得事半功倍的效果。
当然，黑客在需要获取重要的数据时，也可以使用同样的方法。Euercap就是这样一款局域网
405..
---
## Page 411
网络安全进阶笔记
环境下的网络监视、拦截和记录工具，它支持多种主动或被动的协议分析，有数据插入、过滤、
保持连接同步等功能。
8.3.1噢探器技术在网络中的应用
首先，我们来看看噢探技术中的一些重要名词。
1.Snifer：从“电话窃听”到“草船借箭”
Sniffer工具实际上就是一个网络上的抓包工具。在共享式的局域网中，它也可以理解为一
部电话的窃听装置，可以用来窃听双方通话的内容。可是，计算机直接传送的数据实际上是大
量的二进制数据。相对于电话窃听器，黑客几乎可以在任何连接着的网络上直接窃听到同一掩
码范围内的计算机网络数据。我们称这种窃听方式为“基于混杂模式的噢探”，Entercap最初
就是为交换网设计的Snifer，但是随着技术的发展，它也获得了越来越多的功能，成为一款有
效的、灵活的中介攻击工具。其中很吸引人的就是基于ARP的噢探技术了。
小提示：什么是基于ARP的噢探技术？一般来说，在局域网内有“IP”和“MAC”这两套地
址，为了正常地进行网络运信，TCP/IP协议必须把IP地址与具有该IP地址的网络适
配器的MAC地址对应起来，这样才能真正把数据包送给具有该IP地址的主机，ARP
协议就是为解决这一问题而设计的，而在唤探技术中，ARP欺骗则好似诸葛亮的“草
船借箭”一样，通过迷感“曹操”，即被监听的主机，从而自动发送数据给我们。
2.Ettercap简介
Erercap功能十分强大，它能够在已有连接中注入数据，可以描获SSH1连接上的用户和
口令信息，还可以监听HTTPSSL连接上的加密数据。此外，它能收集多种协议下的口令信息，
不必主动发送数据包也可以获取局域网上计算机系统的详细信息。软件的官方站点为
http://ettercap.sourceforge.net/，如果需要下载rpm安装文件，可以到http://rpmforge.net/user/
packages/ettercap/下载相应的Unix或Linux版本。在Linux下运行 Ettercap后，如图8.18所示。
r e.L1 rig 2e1-2t4at 1 %
i11
coe
图8.18在Linux下运行 Ettercap
.406
---
## Page 412
第8章掌握实用的Linux安全工具
另外，如果需要在Windows下进行测试，可以到如下地址下载最新版本：http:/sourceforge
ne/project/showfiles.php?group_id=17435。在Windows 环境下，需要安装 Winpcap 软件，其功
能在于独立于主机协议而发送和接收原始数据报，为Win32应用程序提供访问网络底层的能
力。Winpcap 软件的下载地址为 http:/www.skycn.com/sof/11534.html。Windows 下的 Ettercap
界面如图8.19所示。
ETERCAR.
）05090
图8.19Windows 下的 Etercap 界面
8.3.2Ettercap的5种监听模式
说到嗅探，自然少不了监听。Ettercap总共有5种监听模式：IPBASED、MACBASED、
ARPBASED、PUBLICARP和SMARTARP。从本质上来讲，这些模式只有两种：通过网卡全
收方式的监听和通过ARP欺骗的监听。前者通过共享网络环境接收我们感兴趣的数据流，属
于传统方式：后者则依赖于ARP欺骗技术实施“草船借箭”，把想要监听的网络数据流引导
到我们这里。
小提示：在这5种模式中，前两种模式需要把网卡设置为全收模式，它们之间的差别在于数据
包的过滤依据不同；而后3种模式则是基于ARP欺骗的，它们之间的不同在于以什
么方式进行ARP款骗
1.IPBASED模式
（1）适用范围：根据源IP-PORT和目的IP-PORT来捕获数据包，只能在共享网络环境下
使用。
（2）参数：通过选项指定这种模式，可以用“ANY”来表示IP地址，它的意思是监听
网上的所有主机。在窗口模式下，可以通过Add按钮来添加或者删除主机。如图8.20所示。
（3）特点：因为它需要把网卡设置为全收模式，所以有两个比较大的弱点，一是会在系统
操作台或系统日志中会产生一些蛛丝马迹：二是监听主机会收到大量数据包，会影响其工作效
407.
---
## Page 413
网络安全进阶笔记
率。很显然，这些都会引起管理员的注意。
?
1302
192:18
图8.20Ettercap的IP BASED模式
2.MACBASED模式
（1）适用范围：这种模式也只能在共享网络环境下使用，在交换环境中没有作用。
（2）参数：通过-m选项可以指定这种模式，实施监听时，以对应MAC地址作为过滤标准。
（3）特点：其优点在于监听通过网关的通信。如果要监听内网上一台主机与Intcmct之间
的所有数据通信，只要指定被监听的主机的IP地址和网关的IP地址就可以了.这样，一切到
外网的通信都被过滤出来了，代价是被监听主机的内网通信都被丢弃。
3.ARPBASED模式
（1）适用范围：采用了ARP编技术，可以应用于交换网络环境监听。
（2）参数：通过-a选项以及两个IP的MAC地址对来指定这种模式，它们分别代表被监听
双方的IP地址和MAC地址。
(3）特点：这种模式的一个前提是必须知道被监听的两台主机的IP地址和对应的MAC地
址。优点是Etercap可以不发送大量的ARP响应数据包，减少被网络IDS发现的机会。
4.PUBLICARP模式
（1）适用范围：通过ARP欺骗监听一台主机到所有主机之间的通信。由于采用了ARP欺
骗技术，可以应用于交换网络环境监听。
（2）参数：通过a选项以及一个IP地址米指定这种模式，如果与-z选项连用，还要指定
一个MAC地址。这里IP地址和MAC地址均为被欺验主机的地址。
（3）特点：是一种半双工的模式，即发往被监听主机的数据包会送给监听者，而被监听者
发出的数据包却被直接送往真正的主机。它不支持那些需要全双工模式的功能，如修改数据包、
监听SSH口令等，由于Ettercap采用了一种较为智能的方式，如果不存在主机表，就自动采用
PUBLICARP模式：如果存在主机表，就自动采用下面的SMARTARP模式。
408
---
## Page 414