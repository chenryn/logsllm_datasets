never-once (Fig. 7), never-twice circuits fall even more
squarely within the distribution of normal Tor routers
(the vertical spikes in the ﬁgures). In particular, the top
10% most commonly picked nodes appear roughly as of-
ten as Tor’s top 10% (the median 90th percentile is al-
most exactly equal to Tor’s 90th percentile). The median
node is slightly less likely to be selected than in Tor, in-
dicating only a small skew to more popular nodes.
6.3.3 Circuit performance
We investigate successful DeTor never-twice circuits,
once more turning to latency and expected bandwidth.
Figure 13 compares successful never-twice DeTor cir-
cuits’ RTTs to those of Tor. Compared to never-once
(Fig. 8), there are never-twice DeTor circuits with greater
RTTs. We conclude from this that never-twice avoidance
Figure 11: The distribution of the number of circuits that
DeTor is able to ﬁnd with never-twice (δ = 0.5).
has the ability to draw from a more diverse set of links—
particularly when the entry and exit legs are farther from
one another.
Figure 14 reinforces our ﬁnding that never-twice has
access to a larger set of routers, as the distribution of suc-
cessful never-twice bandwidths matches those of the full
Tor network much more closely.
6.3.4 Which circuits are more likely to succeed?
We close by investigating what inﬂuences a never-twice
DeTor circuit’s success or failure. Figure 15 shows
the fraction of possible never-twice circuits that were
found to be successful, and plots them as a function
of D(e,m,x)/D(s,e,m,x,t). This ratio represents how
much of the overall circuit’s length is attributable to the
middle: that is, everything but the entry and exit legs.
There are several interesting modes in this ﬁgure that
are worth noting. When this ratio on the x-axis is very
low, it means that almost the entire circuit is made up
of the entry and exit legs, and therefore they are very
likely to intersect—as expected, few circuits succeed at
this point. DeTor succeeds more frequently as the mid-
dle legs take on a larger fraction of the circuit’s distance,
but then begins to fail as the length of the middle legs
approaches the combined length of the entry and exit
legs. This is because, in our dataset, when the middle
legs are approximately as long as the entry and exit legs,
this tends to correspond to circuits made out of the two
clusters of nodes: one in North America and the other
in Europe. Because these clusters are tightly packed, the
probability of intersecting entry and exit legs increases.
This probability of intersection decreases when the cir-
cuits no longer come from such tightly packed groups.
When the middle legs dominate the circuit’s distance
(the ratio in the ﬁgure approaches one), we again enter
a particular regime in our dataset: These very high ra-
tio values correspond to circuits with source and entry
node both in North America (or in Europe), and with
middle legs that traverse the Atlantic (and then return).
356    26th USENIX Security Symposium
USENIX Association
 0 0.2 0.4 0.6 0.8 1100101102103104105Cummulative Fraction  of Src-Dst PairsNumber of CircuitsSuccessfulPossibleFigure 12: Nodes’ probability of be-
ing on a successful never-twice DeTor
circuit. (δ = 0.5)
Figure 13: Round-trip times for
never-twice DeTor circuits (δ = 0.5)
and regular Tor circuits.
Figure 14: Bandwidth for never-twice
DeTor circuits (δ = 0.5) and regular
Tor circuits.
ographic positions do not reﬂect the Tor network in its
entirety; our results indicate that having more Tor routers
would lead to more potential DeTor circuits and greater
overall success rates. As with any such system, the best
evaluation would be a longitudinal study with real users
on the Tor network; this would be an interesting area of
future work.
This paper is the ﬁrst step towards bringing provable
avoidance to Tor, but we believe that DeTor has the po-
tential to be a powerful building block in future defenses
against censorship and deanonymization of Tor.
Our code and data are publicly available at:
https://detor.cs.umd.edu
Acknowledgments
We thank Neil Spring, Matt Lentz, Bobby Bhattachar-
jee, the anonymous USENIX Security reviewers, and our
shepherd, Prateek Mittal, for their helpful feedback. This
work was supported in part by NSF grants CNS-1409249
and CNS-1564143.
References
[1] S. Agarwal and J. R. Lorch. Matchmaking for on-
line games and other latency-sensitive P2P systems.
In ACM SIGCOMM, 2009.
[2] M. Akhoondi, C. Yu, and H. V. Madhyastha. LAS-
Tor: A low-latency AS-aware Tor client. In IEEE
Symposium on Security and Privacy, 2013.
[3] D. G. Andersen, H. Balakrishnan, N. Feamster,
T. Koponen, D. Moon, and S. Shenker. Account-
able Internet Protocol (AIP). In ACM SIGCOMM,
2008.
[4] Anonymous. The collateral damage of Internet cen-
sorship by DNS injection. ACM SIGCOMM Com-
puter Communication Review (CCR), 42(3):21–27,
2012.
Figure 15: Success rate of never-twice DeTor circuits as
a function of how long the (e,m,x) legs of the circuit are.
In other words, to accommodate such long middle legs,
the source and entry node (and exit node and destination)
are forced into the same cluster (either North America or
Europe), which again increases the chances of intersec-
tion.
In sum, for never-twice, DeTor interestingly prefers
circuits that have middle legs that are disproportionately
large or small relative to the entry and exit legs. However,
this may be dependent on the node locations from the
Ting dataset we use, as the overall success rate of never-
twice avoidance depends on the geographical diversity of
where Tor routers are located.
7 Conclusion
In this paper, we have presented techniques that allow
end-users to provably verify when packets over their
Tor circuits have avoided traversing a geographic region
once or twice. Our system, DeTor, builds upon prior
work on provable avoidance routing [24], and extends it
(1) to work over Tor’s multiple hops, and (2) to achieve
“never-twice” avoidance. Through extensive simulations
using real Tor latency data [6], we have demonstrated
that DeTor achieves provable avoidance for most source-
destination pairs, even when avoiding large, routing-
central countries like the United States.
Although the dataset we use in evaluating DeTor
comes from live Tor measurements [6], the scale and ge-
USENIX Association
26th USENIX Security Symposium    357
 0 0.2 0.4 0.6 0.8 110-610-510-410-310-210-1100CDFProb. of Being on a Circuit50th pct.75th pct.90th pct. 0 0.2 0.4 0.6 0.8 1 0 200 400 600 800 1000 1200 1400CDFRound-trip Time (msec)DeTor circuitsTor circuits 0 0.2 0.4 0.6 0.8 1 1 10 100 1000 10000 100000Cummulative Fractionof CircuitsBandwidth (kbps)DeTor circuitsTor circuits 0 0.05 0.1 0.15 0.2 0.25 0.3 0.35 0.4 0 0.2 0.4 0.6 0.8 1Frac. of Circuits SuccessfulRatio: DistEMX / DistTotal[5] X. Cai, R. Nithyanand, T. Wang, R. Johnson, and
I. Goldberg. A systematic approach to develop-
ing and evaluating website ﬁngerprinting defenses.
In ACM Conference on Computer and Communica-
tions Security (CCS), 2014.
[6] F. Cangialosi, D. Levin, and N. Spring. Ting:
Measuring and exploiting latencies between all Tor
nodes. In ACM Internet Measurement Conference
(IMC), 2015.
[18] A. Houmansadr, C. Brubaker, and V. Shmatikov.
The parrot is dead: Observing unobservable net-
work communications. In IEEE Symposium on Se-
curity and Privacy, 2013.
[19] A. Johnson, C. Wacek, R. Jansen, M. Sherr, and
P. Syverson. Users get routed: Trafﬁc correlation
on Tor by realistic adversaries. In ACM Conference
on Computer and Communications Security (CCS),
2013.
[7] R. Clayton, S. J. Murdoch, and R. N. Watson. Ig-
In USENIX
noring the great ﬁrewall of China.
Workshop on Free and Open Communications on
the Internet (FOCI), 2006.
[20] M. Juarez, M. Imani, M. Perry, C. Diaz, and
M. Wright. Toward an efﬁcient website ﬁngerprint-
ing defense. In European Symposium on Research
in Computer Security (ESORICS), 2016.
[8] R. Dingledine, N. Mathewson, and P. Syverson.
In
Tor: The second-generation onion router.
USENIX Security Symposium, 2004.
[9] K. Dyer, S. Coull, T. Ristenpart, and T. Shrimpton.
Peek-a-Boo, I still see you: Why efﬁcient trafﬁc
analysis countermeasures fail. In IEEE Symposium
on Security and Privacy, 2012.
[10] M. Edman and P. Syverson. AS-awareness in Tor
In ACM Conference on Computer
path selection.
and Communications Security (CCS), 2009.
[11] A. Edmundson, R. Ensaﬁ, N. Feamster, and J. Rex-
ford. Characterizing and avoiding routing detours
through surveillance states.
https://arxiv.
org/pdf/1605.07685.pdf, May 2016.
[12] A. Edmundson, R. Ensaﬁ, N. Feamster, and J. Rex-
ford. A ﬁrst look into transnational routing detours.
In ACM SIGCOMM (Poster), 2016.
[13] R. Ensaﬁ, P. Winter, A. Mueen, and J. R. Crandall.
Analyzing the great ﬁrewall of China over space
and time. In Privacy Enhancing Technologies Sym-
posium (PETS), 2015.
[14] N. S. Evans, R. Dingledine, and C. Grothoff. A
practical congestion attack on Tor using long paths.
In USENIX Security Symposium, 2009.
[15] Y. Gilad and A. Herzberg. Spying in the dark:
TCP and Tor trafﬁc analysis. In Privacy Enhancing
Technologies Symposium (PETS), 2012.
[16] Global Administrative Areas (GADM) Database.
http://www.gadm.org.
[21] J. Karlin, D. Ellard, A. W. Jackson, C. E. Jones,
G. Lauer, D. P. Mankins, and W. T. Strayer. De-
coy routing: Toward unblockable Internet commu-
nication. In USENIX Workshop on Free and Open
Communications on the Internet (FOCI), 2011.
[22] J. Karlin, S. Forrest, and J. Rexford. Nation-state
routing: Censorship, wiretapping, and BGP. http:
//arxiv.org/pdf/0903.3218.pdf, Mar. 2009.
[23] A. Kwon, M. AlSabah, D. Lazar, M. Dacier, and
S. Devadas. Circuit ﬁngerprinting attacks: Pas-
sive deanonymization of Tor hidden services.
In
USENIX Annual Technical Conference, 2015.
[24] D. Levin, Y. Lee, L. Valenta, Z. Li, V. Lai,
C. Lumezanu, N. Spring, and B. Bhattacharjee. Al-
ibi routing. In ACM SIGCOMM, 2015.
[25] MaxMind GeoIP2 Databases.
https://www.
maxmind.com/en/geoip2-databases.
[26] H. M. Moghaddam, B. Li, M. Derakhshani, and
I. Goldberg. SkypeMorph: Protocol obfuscation for
Tor bridges. In ACM Conference on Computer and
Communications Security (CCS), 2012.
[27] H. M. Moghaddam, T. Reidl, N. Borisov, and
I want my voice to be heard: IP over
A. Singer.
voice-over-IP for unobservable censorship circum-
vention. In Network and Distributed System Secu-
rity Symposium (NDSS), 2013.
[28] S. J. Murdoch and G. Danezis. Low-cost trafﬁc
analysis of Tor. In USENIX Security Symposium,
2005.
[17] N. Hopper, E. Y. Vasserman, and E. Chan-Tin. How
much anonymity does network latency leak? ACM
Transactions on Information and System Security
(TISSEC), 13(2):13, 2010.
[29] S. J. Murdoch and P. Ziekl´nski. Sampled traf-
ﬁc analysis by Internet-exchange-level adversaries.
In Workshop on Privacy Enhancing Technologies
(PET), 2007.
358    26th USENIX Security Symposium
USENIX Association
[30] J. Naous, M. Walﬁsh, A. Nicolosi, M. Miller,
Verifying and enforcing net-
and A. Seehra.
In ACM Conference on
work paths with ICING.
emerging Networking EXperiments and Technolo-
gies (CoNEXT), 2011.
[31] Neustar IP Geolocation. https://www.neustar.
biz/services/ip-intelligence.
[32] R. Padmanabhan, P. Owen, A. Schulman, and
N. Spring. Timeouts: Beware surprisingly high
delay. In ACM Internet Measurement Conference
(IMC), 2015.
the
Internet
Enemies
https:
[33] Reporters Without Borders.
2013 Report.
of
//surveillance.rsf.org/en/wp-content/
uploads/sites/2/2013/03/enemies-of-
the-internet_2013.pdf, Mar. 2013.
[34] M. Schuchard, J. Geddes, C. Thompson, and
N. Hopper. Routing around decoys. In ACM Con-
ference on Computer and Communications Security
(CCS), 2012.
[35] R. Sherwood, A. Bender, and N. Spring. DisCarte:
A disjunctive Internet cartographer. In ACM SIG-
COMM, 2008.
[36] Stem Controller Library.
torproject.org.
https://stem.
[37] Tor Metrics.
org.
https://metrics.torproject.
[38] Q. Wang, X. Gong, G. T. Nguyen, A. Houmansadr,
CensorSpoofer: Asymmetric
and N. Borisov.
communication using IP spooﬁng for censorship-
In ACM Conference on
resistant web browsing.
Computer and Communications Security (CCS),
2012.
[39] Z. Weinberg, J. Wang, V. Yegneswaran, L. Briese-
meister, S. Cheung, F. Wang, and D. Boneh. Stego-
Torus: A camouﬂage proxy for the Tor anonymity
In ACM Conference on Computer and
system.
Communications Security (CCS), 2012.
[40] C. V. Wright, S. E. Coull, and F. Monrose. Trafﬁc
morphing: An efﬁcient defense against statistical
trafﬁc analysis. In Network and Distributed System
Security Symposium (NDSS), 2009.
[41] E. Wustrow, S. Wolchok, I. Goldberg, and J. A.
Halderman. Telex: Anticensorship in the network
In USENIX Security Symposium,
infrastructure.
2011.
USENIX Association
26th USENIX Security Symposium    359