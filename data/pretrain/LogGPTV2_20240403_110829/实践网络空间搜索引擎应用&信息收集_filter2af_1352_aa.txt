# 实践网络空间搜索引擎应用&信息收集
## 0x0 前言
网上很少有人去以白帽子的角度去比较众多的网络空间搜索引擎的优劣，多个搜索引擎肯定是有数据重叠的部分，那么到底有没有整合起来的必要呢?
希望这篇文章能给出这个问题一些解答。同时,下面笔者从自己平时的信息收集流程出发，与大家分享一下自己信息收集思路和一些自动化想法。
## 0x1 主流搜索引擎
笔者最常使用的是FoFa、Shodan、ZoomEye,所以下面将会以这几个为基础来进行讲解和比较。
## 0x2 信息收集思路
很多时候我们能获取到信息比较少，比如只有一个主域名->"douyu.com",那么最朴素无华的思路的第一步肯定是爆破子域名,然后就对子域名进行安全性的检测，到这里基本就完成了一个很简单的信息收集流程。
上图我标注了两个过程(1)、(2),我们可以在这两个过程里面将流程复杂化(横向和纵向都可以),从而提高我们目标资产的覆盖度。
第一步比较简单,这里简单说下我的思路。
第一步可以理解为横向挖掘资产吧, 目的是找到更多相关的主域名,比如子公司的,内网互通的公司等
介绍下我最常用的思路
**(1)天眼查的股权结构,可以获取到相关的子公司。**
**(2)备案信息的查询,可以获取到相同单位的备案信息**
**(3) 域名whois反查**
**(4)IP反查,获取到真实IP的时候可以考虑这个**
**(5) 移动端信息**
...这个自动化的思路有点难实现, 需要手工参与,不过其实也很简单。
这里有两个常用的查找APP的平台: **七麦数据** 、 **APP Store**
最专业的分析平台就是[七麦数据](https://www.qimai.cn/s)
我们可以获取同开发商的应用和同公司的应用,还有微信公众号和微信小程序。
后面直接调用apk的url提取工具就行了。
本文重点其实在第二步,就是如何挖掘已有的资产数据的归属特征和分布规律，从而发现更隐蔽、更边界的资产。
流程思路大概如下:
## 0x3 归属特征
这里归属特征我暂且定义了三个,分别是SSL信息、title信息、favicon信息。
其实这里的归属特征我一直最想处理的是网站底部的一些信息,直接进行区域相似度比较感觉就蛮不错的,但是这个误报会很大,觉得还是需要大量的项目经验积累才能去完成这个,
所以我没考虑这个。
然后,
网络空间搜索引擎比较好用和准确的搜索是基于SSL信息和favicon的搜索。
关于批量处理数据得到SSL信息和favicon信息的代码很简单。
但是比如douyu.com,我就发现了基于子域名得到的SSL信息基本全是CDN的SSL信息,作用并不是很大,然后得到的也是CDN的C段,所以如果存在CDN的话,那么就会出现很多无效的结果。
所以这里的归属特征,为了在一定程度下得到比较准确的结果，简单处理如下:
1.SSL我会写死成包含目标中文名称的关键词\主域\组织名称。
2.favicon hash直接进行查询即可。
## 0x4 整合搜索引擎
### 0x4.1 搜索语法
**SSL信息搜索:**
Shodan: `ssl:"ximalaya.com"`
ZoomEye: `ssl:"ximalaya.com"`
FoFa: `cert="ximalaya.com"`
**Favicon搜索:**
Shodan: `http.favicon.hash:214897281`
ZoomEye: `iconhash: "214897281"`
FoFa: `icon_hash="214897281"`
### 0x4.2 自动化导出结果
上面的搜索引擎都有比较完备的API和SDK,这里我们直接写个脚本进行调用就可以。
上面代码写的比较粗糙, 是Demo的代码,能跑起来就行,线上的代码的话需要根据设计来整合统一处理异常、config、重试等。
### 0x4.3 结果比较
以ximalaya.com作为查询关键字进行SSL查询
以`214897281`作为icon_hash来进行favicon的查询
**(1)SSL信息搜索**
然后可以看一下三者的重合程度。
可以看到确实有一部分重叠, 但是每个引擎的数据确实是不太一样的, 重合度并没有很高,三者之间是可以互补的。
如果合并的话,那么将会多出147个结果,所以整合多个搜索引擎的意义还是存在的。
**(2) Favicon 信息搜索**
在这方面ZoomEye确实逊色了一点。
* * *
在这个方面我只获取到IP,而在FoFa是可以搜索到hostname的,而且hostname的基本数据是三家引擎中最全的,当然这里我只是采用了一个个例进行比较分析，是缺乏权威性的，但是从一个白帽子角度出发，我觉得基于上面的结果，如果能整合3个引擎的结果的话，那么资产的覆盖度是可以显著提高的,
而这个整合模块也是我正在做的。
## 0x5 分布规律
这里我先说明下我对分布规律(主要是指目标资产的IP的分布)的理解，这里我觉得可以从几个点来交叉谈谈
**1.ASN**
**2.地域**
**3.C段**
### 0x5.1 IP的来源
**(1)最直接的来源是通过解析子域名得到IP**
但是经过我对SSL信息的提取,可以发现其实很多挂上CDN的证书的,说明是使用了CDN的服务