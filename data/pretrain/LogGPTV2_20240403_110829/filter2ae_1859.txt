### 微软发布更新修复CVE-2018-8453漏洞

#### 漏洞概述
2018年10月9日，微软发布了一项更新，旨在修复CVE-2018-8453漏洞。该漏洞是由卡巴斯基实验室在2018年8月发现的，存在于`win32k.sys`中的一个安全缺陷。

#### 发现与利用
2018年8月，卡巴斯基实验室的自动漏洞利用预防系统（AEP）检测到一起针对Windows操作系统的攻击活动。研究人员随后确认了这一0day漏洞的存在，即CVE-2018-8453。攻击者首先通过恶意软件下载器获取受害者的系统权限，以便进一步安装并维持恶意软件的驻留状态。值得注意的是，此次攻击所使用的代码具有高度兼容性，能够在多个版本的Windows上运行，包括最新的Windows 10 RS4。

目前，针对此漏洞发起的攻击事件数量较少，且主要集中在中东地区。

#### 技术细节
CVE-2018-8453是一个位于`win32kfull!xxxDestroyWindow`函数中的Use-After-Free类型的安全漏洞，其行为模式类似于CVE-2017-0263。为了更好地理解这个漏洞的工作机制，研究人员对野外捕获的样本进行了逆向工程，并重构了一个概念验证（POC）程序。

整个攻击过程涉及到了三个用户模式回调函数：`fnDWORD`、`fnNCDESTROY`以及`fnINLPCREATESTRUCT`。通过替换`KernelCallbackTable`中的函数指针，攻击者能够设置必要的hook点以触发漏洞。具体来说，在处理`WM_LBUTTONDOWN`消息时，`fnDWORD`会调用`DestroyWindow`函数，导致目标窗口被标记为可回收状态。此时，如果`fnNCDESTROY`试图修改已被释放的对象，则会导致内存使用后的错误访问问题。特别是当执行`NtUserSetWindowFNID`系统调用时，由于缺乏对`fnid`状态的有效检查，使得原本应该处于`FNID_FREED`状态的窗口结构被错误地重新分配给其他用途。

#### 内存管理绕过技术
为了成功回收已释放的内存区域，攻击者采用了一系列复杂的堆喷射策略。这些策略依据不同的Windows版本而有所调整，总共实现了五个不同版本的喷射方法。其中，在Windows 10 RS4上实现的技术尤为复杂，它利用大小不一的位图对象来耗尽内存分配器资源，从而规避现代操作系统中常见的低碎片堆保护机制。

一旦完成上述步骤，攻击者便能够获得任意内核读写权限，并最终通过篡改进程令牌的方式提升自身权限等级。此外，研究还揭示了部分用于持久化感染的高级功能，如基于SMBIOS UUID的加密算法及借助微软BITS服务进行隐蔽通信等手段。

#### 归属分析
通过对相关样本及其基础设施的研究表明，此次攻击很可能与FruityArmor APT组织有关。该结论主要基于以下几个方面：
- 攻击者曾使用一种之前仅由FruityArmor使用的PowerShell后门；
- 命令与控制服务器域名与过去记录中的FruityArmor活动存在交集。

#### 总结
这是继上次之后，再次观察到FruityArmor组织利用零日漏洞传播恶意软件的行为。虽然当前受影响范围相对较小且主要集中于中东国家，但其背后动机尚不清楚。

**IOC (Indicators of Compromise)**
- 域名:
  - weekendstrips[.]net
  - shelves-design[.]com