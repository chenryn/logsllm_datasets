通过对历史捕获挖矿案例的分析发现，云上挖矿通常是一种批量入侵方式，这种批量入侵的特性，使得黑客只能利用通用安全问题，比如系统漏洞、服务漏洞，最常见的是永恒之蓝、Redis未授权访问问题等。
云上入侵挖矿行为的感染和挖矿方式主要分为两种类型，其中一种类型是在病毒木马主体中直接实现相关的扫描、利用、感染和挖矿功能，如下图对某木马逆向可见钱包地址和矿池地址直接硬编码在程序中：
而另一种方式则是利用独立的挖矿程序，这些挖矿程序一般是来自开源程序，比如 xmrig 项目
（[https://github.com/xmrig/xmrig），](https://github.com/xmrig/xmrig%EF%BC%89%EF%BC%8C)
这类挖矿一般会在入侵后先植入 bash 或者 VBScript
脚本等，再通过脚本实现对挖矿程序的下载或者其他扫描利用程序的下载，同时通过参数指定矿池和钱包地址，以下就是其中一个 VBScript
脚本内容和启动的挖矿进程：
其中主流方式是直接启动挖矿程序进行挖矿。通过分析矿机常用的进程，也可以得到印证：
影响最大的 minerd 出自 
Windows上的 cpuminer-multi.exe 矿机源于
而 kworkers、kappre、xmrig.exe 等均编译自
集成开源矿机挖矿只需要一条命令，使得黑产行业越来越多的使用此种形式来进行挖矿。
进一步尝试统计黑客身份，针对部分数据进行进程的命令参数分析统计，提取其中挖矿钱包地址用户名发现，云上挖矿行为聚集状态，大量被黑的云主机矿机掌握在少量的黑客团伙/个人手中（其中邮箱是
minergate.com 的用户名）。
总结黑客的入侵挖矿行为发现，存在通用安全漏洞（如永恒之蓝）的云主机成为黑客主要的入侵目标，黑客通常采用批量扫描通用安全问题并入侵植入挖矿程序的方式进行恶意挖矿。一些传统企业、政府机构等行业的机器被入侵挖矿现象尤为显著，主要原因是这些行业的云主机由于维护人员缺乏安全意识，容易存在漏洞，甚至长期不登录云主机，更是变向给黑客提供了长期矿机，这些存在安全问题的云主机也是云上挖矿等恶意行为肆意繁衍的温床。所以提升安全意识，避免在云主机中引入漏洞，发现漏洞后及时修复是防止被黑客入侵挖矿的唯一方法。
## 四、安全建议
基于以上云鼎实验室对云上入侵挖矿主要特征的总结，可以发现黑客入侵挖矿的主要目标是存在通用安全漏洞的机器，所以预防入侵挖矿的主要手段就是发现和修复漏洞：
1)可以根据业务情况使用腾讯云安全组或者服务器自带防火墙关闭非业务需要的端口，对于一些部署的服务，如无必要避免开放在外网上，即使因为业务需要开放，也应该限制访问来源。
2)关注操作系统和组件重大更新，如 WannaCry 传播使用的永恒之蓝漏洞对应的 MS17-010，及时更新补丁或者升级组件。
3)为预防密码暴力破解导致的入侵，建议更换默认的远程登录端口，设置复杂的登录密码，或者是放弃使用口令登录，转而使用密钥登录。
4)自检服务器上部署的业务，有条件的话可以进行渗透测试，及早发现并修复业务漏洞，避免成为入侵点。
5)使用腾讯云云镜等安全产品，检测发现服务器上的安全漏洞并且及时修复。
另外，针对已经被入侵挖矿的情况，建议及时清理挖矿进程和恶意文件，同时排查入侵点并修复，从根本上解决问题。
## 五、附录
### 1、部分币种和矿池列表
以下为云上黑客入侵后挖矿的主要币种和矿池列表：
### 2、部分挖矿程序样本
a)94fc39140ffafbd360a4cabc64b62077
b)f068b7be8685c91bddbb186f6fad7962
c)367dc6e9c65bb0b1c0eb1a4798c5e55b
d)f594a17d37c70b0d18f33a3882e891a0
e)db87bd6bc3554e4d868b7176925dcff5
f)5b0b4ccea8b6636966610edc346fe064
g)8c9ab86572742d2323cee72ca2c0a3f2
h)367dc6e9c65bb0b1c0eb1a4798c5e55b
i)0d25d679b9845847b0c180715a52d766
### 3、部分钱包地址
a)4A7sJwfkFrWB88V8NiJ2Fi3RwsWkR48PQ5hG2qXq6hu2U7e8fcVLJ81WtTzHGdNChsejcygkvUGpbiiUXAWXprWYHnBEvqC
b)43RhXdrqL26QFnZyWyC53pcyaxKDQZent24CXGRLZ6196h6DkpzT43ZA2C1SpZGLDddAfr6hEhwqXg7F8dQpchFuDBz6Y6T
c)47bvN8Z4UVq6kLjMFo4AF5UkwFbdzdhvoKNj1EN6iTYA2BvSDAsbGoXNMNeSfZajhz6xqQHHhPqbrRacnvELqrgyQYBqnXc
d)42h3ELK47SGe4jiit28qVvTRAwpnT1R3DZ7BEnQm3Jxe9wykcvLVoFd5GqpqepwGRrCbkyKJG4kg1hssUztaVACVJGhpGAK
e)4AGF7tHM5ZpR7FRndiPMk6MxR1nSA8HnAVd5pTxspDEcCRPknAnFAMAYpw8NmtbGFAeiakw6rxNpabQ2MyBKstBY8sTXaHr
本文作者：zhenyiguo、jaryzhou、youzuzhang @腾讯安全云鼎实验室
腾讯安全云鼎实验室关注云主机与云内流量的安全研究和安全运营。利用机器学习与大数据技术实时监控并分析各类风险信息，帮助客户抵御高级可持续攻击；联合腾讯所有安全实验室进行安全漏洞的研究，确保云计算平台整体的安全性。相关能力通过腾讯云开放出来，为用户提供黑客入侵检测和漏洞风险预警等服务，帮助企业解决服务器安全问题。