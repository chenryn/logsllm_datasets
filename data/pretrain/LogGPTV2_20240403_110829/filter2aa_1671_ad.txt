www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 119  – 8 August 2015 
Audio Streams in RTP 
Find reverse will find both RTP streams (sender / receiver). 
Analyse can analyse the spectrum, Save as can save the streams. 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 120  – 8 August 2015 
DTMF Tones in RTP 
DTMF tones are encoded through the RTP events. 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 121  – 8 August 2015 
Media Transport Security 
• Secure Real-time Transfer Protocol (SRTP) 
• Encryption 
• Message Authentication 
• Integrity 
• Replay Protection 
• Key Management for SRTP 
• SDES (SIP without TLS) is still vulnerable 
• ZRTP / ZRTP/S provide Diffie–Hellman handshakes 
• MIKEY provides Public Key Encryption 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 122  – 8 August 2015 
Advanced or basic SRTP/RTP attacks can be 
used for eavesdropping 
• ARP attacks,  
• DHCP attacks  
• Proxy attacks 
• RTP information in the SIP request can be 
overwritten 
• Master key can be extracted from the SDP 
content in SIP requests 
Network MITM Attacks for RTP 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 123  – 8 August 2015 
Decoding SRTP 
Hacking VoIP – Decrypting SDES Protected 
SRTP Phone Calls 
https://www.acritelli.com/hacking-voip-decrypting-sdes-
protected-srtp-phone-calls  
• Obtain a complete call, including SIP exchange and RTP 
data, between two endpoints 
• Grab the key and filter out a single SRTP stream in 
Wireshark 
• Use srtp-decrypt (https://github.com/gteissier/srtp-
decrypt) to decrypt the SRTP 
• Replay the decrypted RTP data in Wireshark 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 124  – 8 August 2015 
Eavesdropping 
Wireshark can decode and play RTP streams 
• Different codecs and two Streams 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 125  – 8 August 2015 
Eavesdropping 
• Cain & Abel 
• UCSniff 
• Call recording using Ucsniff 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 126  – 8 August 2015 
Demonstration of SDES decryption 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 127  – 8 August 2015 
Solutions 
• RTP proxies should be in use to 
• Isolate the clients 
• Cover the various client types (PSTN, SIP, 3G/4G) 
• Avoid the client to client direct communication 
• SRTP should be implemented 
• Enforce the strong encryption 
• Don’t use key management through insecure 
channels such as SIP without TLS 
• ZRTP or MIKEY (depending on the 
implementation) 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 128  – 8 August 2015 
Cloud VoIP Solutions 
Security 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 129  – 8 August 2015 
Cloud VoIP solutions 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 130  – 8 August 2015 
Cloud VoIP environment 
• Vendors are Cisco and VOSS Solutions 
• Web based management services  
• IP Phone services (CUCDM [VOSS] IP Phone Services) 
• Tenant client services(CUCDM [VOSS] Selfcare) 
• Tenant* services (CUCDM [VOSS] Domain Manager) 
• VoIP services 
• Skinny (SCCP) services for Cisco phones 
• SIP services for other tenant phones 
• RTP services for media streaming 
• PBX/ISDN gateways, network equipment   
* Tenant => Customer of hosted VoIP service 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 131  – 8 August 2015 
Plan & Goals 
Plan 
• Discovering the cloud services as tenant 
• Attacking to the dedicated tenant services 
• Attacking to the shared services for tenants 
• Jailbreaking the cloud tenant isolation 
Goals 
• Call and toll fraud 
• Compromising all tenants in the cloud 
• Eavesdropping 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 132  – 8 August 2015 
Discovery for hosted VoIP networks 
• Discover VoIP network configuration, design 
and requirements 
• Find Voice VLAN and gain access 
• Gain access using PC port on IP Phone 
• Understand the switching security for: 
• Main vendor for VoIP infrastructure 
• Network authentication requirements 
• VLAN ID and requirements 
• IP Phone management services 
• Supportive services in use 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 133  – 8 August 2015 
Cisco Hosted Collaboration Suite 
• Cisco UC Domain Manager 
• VOSS IP Phone XML services 
• VOSS Self Care customer portal 
• VOSS Tenant services management 
• Cisco UC Manager  
• Cisco Unified Dialled Number Analyser  
• Cisco Unified Reporting  
• Cisco Unified CM CDR Analysis and Reporting 
Multiple Vulnerabilities in Cisco Unified Communications 
Domain Manager 
http://tools.cisco.com/security/center/content/CiscoSecuri
tyAdvisory/cisco-sa-20140702-cucdm    
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 134  – 8 August 2015 
Cisco CUCDM Self Care 
• Tenant user services 
• Password & PIN management 
• Voicemail configuration 
• Presence  
• Corporate Directory access 
• Extension mobility 
Weaknesses 
• Cross-site scripting vulnerabilities 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 135  – 8 August 2015 
Account details stored XSS  
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 136  – 8 August 2015 
Cisco CUCDM Service Management 
• Tenant administration services 
• User management 
• Location and dial plan management 
• CLI and number translation configuration 
Weaknesses 
• User enumeration  
• Privilege escalation vulnerabilities  
• Cross-site scripting vulnerabilities 
• SQL injections and SOAP manipulations 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 137  – 8 August 2015 
Errors, Information Leakage 
• /emapp/EMAppServlet?device=USER  
• /bvsm/iptusermgt/disassociateuser.cgi  
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 138  – 8 August 2015 
Insecure File Upload 
• /bvsm/iptbulkadmin  
• /bvsm/iptbulkloadmgt/bulkloaduploadform.cgi   
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 139  – 8 August 2015 
Privilege Escalation 
/bvsm/iptusermgt/moduser.cgi (stored XSS, change users’ role) 
/bvsm/iptadminusermgt/adduserform.cgi?user_type=adminuser  
/bvsm/iptnumtransmgt/editnumbertranslationform.cgi?id=1 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 140  – 8 August 2015 
IP Phone management 
• VOSS IP Phone XML services 
• Shared service for all tenants 
• Call forwarding (Skinny has, SIP has not) 
• Speed dial management 
• Voicemail PIN management 
http://1.2.3.4/bvsmweb/SRV.cgi?device=ID&cfoption=ACT   
Services 
• speeddials 
• changepinform 
• showcallfwd 
• callfwdmenu 
Actions 
• CallForwardAll 
• CallForwardBusy 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 141  – 8 August 2015 
IP Phone management 
• Authentication and Authorisation free! 
• MAC address is sufficient 
• Jailbreaking tenant services 
• Viproy Modules 
• Call Forwarding 
• Speed Dial 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 142  – 8 August 2015 
Demonstration of CUCDM exploitation 
viproy.com 
142 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 143  – 8 August 2015 
Solutions 
• Conduct audit from tenant and owner perspective  
• Privacy of tenants vs Toll fraud 
• Isolate the tenants for all services 
• No shared services if possible 
• Shared services should be tested for jailbreaking 
• Security updates the cloud environment 
• Enforce the strong encryption and authentication 
for tenant phones and services 
• Manage the backward compatibility 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 144  – 8 August 2015 
VoIP Client Security 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 145  – 8 August 2015 
VoIP Client Security  
• Softphones vs Handsets vs Teleconferencing 
• Information Disclosure 
• Unnecessary services and ports (SNMP, echo) 
• Weak management services (telnet, SSH, HTTP) 
• Stored credentials and sensitive information 
• Unauthorised Access 
• Password attacks 
• Compromising software using TFTP server 
• Configuration files, upgrade files, firmware 
• Weak VoIP Services 
• They may accept direct invite, register or notify 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 146  – 8 August 2015 
Plan & Goals 
Plan 
• Analysing the VoIP clients which use the 
commercial services 
• Finding the published and unpublished bugs 
on the clients 
• Trying to exploit those bugs from remote 
Goals 
• Mass compromise of clients  
• Injecting a persistent backdoor to the clients 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 147  – 8 August 2015 
Attacking a client using SIP service 
• Caller ID spoofed messages  
• to install a malicious application or an SSL certificate 
• to redirect voicemails or calls 
• Fake caller ID for Scam, Vishing or Spying 
• Manipulate the content or content-type on 
messaging 
• Trigger a crash/BoF on the remote client 
• Inject cross-site scripting to the conversation 
• Proxies with TCP/TLS interception and manipulation 
• Viproy MITM though UDP/TCP modules 
• Socat  
• Viproxy (github.com/fozavci/viproxy) 
• MITMproxy 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 148  – 8 August 2015 
Rogue Services and MITM 
• We Need a Rogue Service 
• Adding a feature to a regular SIP client 
• Collecting credentials 
• Redirecting calls 
• Manipulating CDR or billing features 
• Fuzzing servers and clients for vulnerabilities 
• Rogue Service Should be Semi-Automated 
• Communication sequence should be defined 
• Sending bogus request/result to client/server 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 149  – 8 August 2015 
Rogue Services and MITM 
• Use ARP/DNS Spoof & VLAN hopping & Manual config 
• Collect credentials, hashes, information 
• Change client's request to add a feature (eg. Spoofing) 
• Change the SDP features to redirect calls 
• Add a proxy header to bypass billing & CDR 
• Manipulate request at runtime to find BoF vulnerabilities 
• Trigger software upgrades for malwared executables  
Death Star in the Middle 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 150  – 8 August 2015 
Attacking a client using SIP trust 
• SIP server redirects a few fields to client 
• FROM, FROM NAME, Contact  
• Other fields depend on server (e.g. SDP, MIME) 
• Message content 
• Clients have buffer overflow in FROM? 
• Send 2000 chars to test it ! 
• Crash it or execute your shellcode if available 
• Clients trust SIP servers and trust is UDP based 
• Trust hacking module can be used for the trust 
between server and client too. 
• Viproy Penetration Testing Kit SIP Modules 
• Simple fuzz support (FROM=FUZZ 2000) 
• You can modify it for further attacks 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 151  – 8 August 2015 
Attacking a client using SIP trust 
192.168.1.146 
Melbourne 
192.168.1.202 
Brisbane 
192.168.1.145 - Sydney 
Production SIP Service 
UDP Trust 
Universal 
Trust 
Tatooine 
Crash! 
Adore iPhone App 
Send INVITE/MESSAGE requests with 
• IP spoofing (source is Brisbane), 
• from field contains exploit, 
the client will be your stormtrooper. 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 152  – 8 August 2015 
Exercises 
• Direct Invite requests 
• Sending bogus SMSes to trigger a crash 
• Sending bogus calls to trigger a crash 
• MITM interception and header adding 
• Memory corruption through MITM proxy 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 153  – 8 August 2015 
Solutions 
• Update the client software and handsets 
• Secure communication must be enforced 
• Strong authentication 
• Strong encryption 
• Prevent the information disclosure 
• Do not use the client data as trusted 
• Input validation must be in place 
• Use the authenticated Identity, not client’s one 
• Configure clients to reject calls not coming 
from the server registered 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 154  – 8 August 2015 
References 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 155  – 8 August 2015 
Resources for Viproy 
• Viproy VoIP Penetration and Exploitation Kit 
    Author : http://viproy.com/fozavci 
    Homepage  : http://viproy.com 
    Github: http://www.github.com/fozavci/viproy-voipkit  
• Attacking SIP Servers Using Viproy VoIP Kit 
https://www.youtube.com/watch?v=AbXh_L0-Y5A  
• VoIP Pen-Test Environment – VulnVoIP 
   http://www.rebootuser.com/?cat=371  
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 156  – 8 August 2015 
Other Tools 
• Network Analysis Tools 
• Yersinia, Cain&Abel, Wireshark, Dsniff, VoIPHopper 
• Service Analysis Tools 
• Nmap, Metasploit Framework 
• SIP Analysis Tools 
• Viproy, Sipvicious, Bluebox-NG, Metasploit 
• Proxy Attacks 
• Viproy MITM, Em-proxy, SIP Rogue, RTP Redirect 
• Free VoIP Clients 
• Jitsi, Boghe, Linphone, X-Lite, Micro SIP, Vi-Vo 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 157  – 8 August 2015 
Solutions for Cisco Networks 
• Install the Cisco security patches 
• From CVE-2014-3277 to CVE-2014-3283, CVE-2014-
2197, CVE-2014-3300 
• CSCum75078, CSCun17309, CSCum77041, CSCuo51517, 
CSCum76930, CSCun49862 
• Secure network design 
• IP phone services MUST be DEDICATED, not SHARED 
• Secure deployment with PKI 
• Authentication with X.509, software signatures 
• Secure SSL configuration 
• Secure protocols 
• Skinny authentication, SIP authentication 
• HTTP instead of TFTP, SSH instead of Telnet 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 158  – 8 August 2015 
Questions? 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 159  – 8 August 2015 
Fatih Ozavci 
Principal Security Consultant 
PI:EMAIL 
Chris Archimandritis 
Senior Security Consultant 
PI:EMAIL 
Enquiries 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 160  – 8 August 2015 
Thank you 
Recognised as Australia’s fastest growing information security and 
risk management consulting firm through the Deloitte Technology 
Fast 50 & BRW Fast 100 programs 
Head office is level 8, 66 King Street, Sydney, NSW 2000, 
Australia. Owner of trademark and all copyright is Sense of 
Security Pty Ltd. Neither text or images can be reproduced 
without written permission. 
T: 1300 922 923 
T: +61 (0) 2 9290 4444 
F: +61 (0) 2 9290 4455 
PI:EMAIL 
www.senseofsecurity.com.au