ETHICAL HACKING
AND PENETRATION
TESTING GUIDE
RAFAY BALOCH
CRC Press
Taylor & Francis Group
6000 Broken Sound Parkway NW, Suite 300
Boca Raton, FL 33487-2742
© 2015 by Taylor & Francis Group, LLC
CRC Press is an imprint of Taylor & Francis Group, an Informa business
No claim to original U.S. Government works
Printed on acid-free paper
Version Date: 20140320
International Standard Book Number-13: 978-1-4822-3161-8 (Paperback)
This book contains information obtained from authentic and highly regarded sources. Reasonable efforts have been
made to publish reliable data and information, but the author and publisher cannot assume responsibility for the valid-
ity of all materials or the consequences of their use. The authors and publishers have attempted to trace the copyright
holders of all material reproduced in this publication and apologize to copyright holders if permission to publish in this
form has not been obtained. If any copyright material has not been acknowledged please write and let us know so we may
rectify in any future reprint.
Except as permitted under U.S. Copyright Law, no part of this book may be reprinted, reproduced, transmitted, or uti-
lized in any form by any electronic, mechanical, or other means, now known or hereafter invented, including photocopy-
ing, microfilming, and recording, or in any information storage or retrieval system, without written permission from the
publishers.
For permission to photocopy or use material electronically from this work, please access www.copyright.com (http://
www.copyright.com/) or contact the Copyright Clearance Center, Inc. (CCC), 222 Rosewood Drive, Danvers, MA 01923,
978-750-8400. CCC is a not-for-profit organization that provides licenses and registration for a variety of users. For
organizations that have been granted a photocopy license by the CCC, a separate system of payment has been arranged.
Trademark Notice: Product or corporate names may be trademarks or registered trademarks, and are used only for
identification and explanation without intent to infringe.
Library of Congress Cataloging‑in‑Publication Data
Baloch, Rafay.
Ethical hacking and penetration testing guide / Rafay Baloch.
pages cm
Includes bibliographical references and index.
ISBN 978-1-4822-3161-8 (paperback)
1. Penetration testing (Computer security) I. Title.
QA76.9.A25B356 2014
005.8--dc23 2014006695
Visit the Taylor & Francis Web site at
http://www.taylorandfrancis.com
and the CRC Press Web site at
http://www.crcpress.com
Contents
Preface .............................................................................................................................xxiii
Acknowledgments .............................................................................................................xxv
Author .............................................................................................................................xxvii
1 Introduction to Hacking ..............................................................................................1
Important Terminologies ...................................................................................................2
Asset .........................................................................................................................2
Vulnerability .............................................................................................................3
Threat .......................................................................................................................3
Exploit ......................................................................................................................3
Risk ..........................................................................................................................3
What Is a Penetration Test? ......................................................................................3
Vulnerability Assessments versus Penetration Test ....................................................3
Preengagement..........................................................................................................3
Rules of Engagement ................................................................................................4
Milestones ................................................................................................................4
Penetration Testing Methodologies ...........................................................................5
OSSTMM ................................................................................................................5
NIST ........................................................................................................................6
OWASP ....................................................................................................................7
Categories of Penetration Test ............................................................................................7
Black Box ..................................................................................................................7
White Box ................................................................................................................7
Gray Box ..................................................................................................................7
Types of Penetration Tests ........................................................................................7
Network Penetration Test ................................................................................8
Web Application Penetration Test ...................................................................8
Mobile Application Penetration Test ...............................................................8
Social Engineering Penetration Test ................................................................8
Physical Penetration Test .................................................................................8
Report Writing .........................................................................................................8
Understanding the Audience ....................................................................................9
v
vi ◾ Contents
Executive Class ................................................................................................9
Management Class ..........................................................................................9
Technical Class ................................................................................................9
Writing Reports ................................................................................................................10
Structure of a Penetration Testing Report .........................................................................10
Cover Page ...............................................................................................................10
Table of Contents ....................................................................................................10
Executive Summary .................................................................................................11
Remediation Report ...............................................................................................12
Vulnerability Assessment Summary .................................................................................12
Tabular Summary ....................................................................................................13
Risk Assessment ................................................................................................................14
Risk Assessment Matrix ...........................................................................................14
Methodology ....................................................................................................................14
Detailed Findings ....................................................................................................15
Description .....................................................................................................15
Explanation ....................................................................................................16
Risk ................................................................................................................16
Recommendation ...........................................................................................16
Reports ....................................................................................................................17
Conclusion ........................................................................................................................17
2 Linux Basics ...............................................................................................................19
Major Linux Operating Systems .......................................................................................19
File Structure inside of Linux ...........................................................................................20
File Permission in Linux .........................................................................................22
Group Permission ..........................................................................................22
Linux Advance/Special Permission ................................................................22
Link Permission .............................................................................................23
Suid & Guid Permission ................................................................................23
Stickybit Permission ......................................................................................23
Chatter Permission ........................................................................................24
Most Common and Important Commands ............................................................24
Linux Scheduler (Cron Job) ..............................................................................................25
Cron Permission .....................................................................................................26
Cron Permission ............................................................................................26
Cron Files ......................................................................................................26
Users inside of Linux .......................................................................................................28
Linux Services.........................................................................................................29
Linux Password Storage ..........................................................................................29
Linux Logging ........................................................................................................30
Common Applications of Linux ......................................................................................30
What Is BackTrack? .........................................................................................................30
How to Get BackTrack 5 Running ..........................................................................31
Installing BackTrack on Virtual Box .......................................................................31
Installing BackTrack on a Portable USB ..................................................................35
Contents ◾ vii
Installing BackTrack on Your Hard Drive ..............................................................39
BackTrack Basics ....................................................................................................43
Changing the Default Screen Resolution .........................................................................43
Some Unforgettable Basics ......................................................................................44
Changing the Password .................................................................................44
Clearing the Screen .......................................................................................44
Listing the Contents of a Directory ...............................................................44
Displaying Contents of a Specific Directory ..................................................44
Displaying the Contents of a File ....................................................................45
Creating a Directory .......................................................................................45
Changing the Directories ...............................................................................45
Windows ........................................................................................................45
Linux ..............................................................................................................45
Creating a Text File ........................................................................................45
Copying a File ................................................................................................45
Current Working Directory ............................................................................45
Renaming a File..............................................................................................45
Moving a File ................................................................................................46
Removing a File .............................................................................................46
Locating Certain Files inside BackTrack .................................................................46
Text Editors inside BackTrack ..........................................................................................46
Getting to Know Your Network .......................................................................................47
Dhclient ...................................................................................................................47
Services ............................................................................................................................48
MySQL ...................................................................................................................48
SSHD .....................................................................................................................48
Postgresql ................................................................................................................50
Other Online Resources ...................................................................................................51
3 Information Gathering Techniques ............................................................................53
Active Information Gathering ...........................................................................................53
Passive Information Gathering ..........................................................................................53
Sources of Information Gathering ...................................................................................54
Copying Websites Locally ................................................................................................54
Information Gathering with Whois .........................................................................55
Finding Other Websites Hosted on the Same Server...............................................56
Yougetsignal.com .............................................................................................................56
Tracing the Location ...............................................................................................57
Traceroute ................................................................................................................57
ICMP Traceroute ....................................................................................................58
TCP Traceroute ......................................................................................................58
Usage .............................................................................................................58
UDP Traceroute .....................................................................................................58
Usage .............................................................................................................58
NeoTrace ..........................................................................................................................59
Cheops-ng .........................................................................................................................59
Enumerating and Fingerprinting the Webservers ....................................................60
viii ◾ Contents
Intercepting a Response ...................................................................................................60
Acunetix Vulnerability Scanner ..............................................................................62
WhatWeb ........................................................................................................................62
Netcraft ...........................................................................................................................63
Google Hacking .....................................................................................................63
Some Basic Parameters .....................................................................................................64
Site ..........................................................................................................................64
Example ...........................................................................................................................64
TIP regarding Filetype......................................................................................................65
Google Hacking Database ......................................................................................66
Hackersforcharity.org/ghdb...............................................................................................67
Xcode Exploit Scanner ......................................................................................................67
File Analysis ............................................................................................................68
Foca ........................................................................................................................68
Harvesting E-Mail Lists .........................................................................................69
Gathering Wordlist from a Target Website .............................................................71
Scanning for Subdomains .......................................................................................71
TheHarvester ..........................................................................................................72
Fierce in BackTrack ................................................................................................72
Scanning for SSL Version ........................................................................................74
DNS Enumeration ..................................................................................................75
Interacting with DNS Servers ..........................................................................................75
Nslookup ..........................................................................................................................76
DIG ..................................................................................................................................76
Forward DNS Lookup ............................................................................................77
Forward DNS Lookup with Fierce ...................................................................................77
Reverse DNS ..........................................................................................................78
Reverse DNS Lookup with Dig ..............................................................................78
Reverse DNS Lookup with Fierce ....................................................................................78
Zone Transfers ........................................................................................................79
Zone Transfer with Host Command................................................................................79
Automating Zone Transfers .............................................................................................80
DNS Cache Snooping .............................................................................................80
What Is DNS Cache Snooping? ........................................................................................81
Nonrecursive Method ..............................................................................................81
Recursive Method ...................................................................................................82
What Is the Likelihood of Name Servers Allowing Recursive/Nonrecursive Queries? .......83
Attack Scenario ................................................................................................................84
Automating DNS Cache Snooping Attacks .....................................................................84
Enumerating SNMP ...............................................................................................84
Problem with SNMP .......................................................................................................84
Sniffing SNMP Passwords ...............................................................................................84
OneSixtyOne ....................................................................................................................85
Snmpenum .......................................................................................................................85
SolarWinds Toolset ...........................................................................................................85
SNMP Sweep ...................................................................................................................86
SNMP Brute Force and Dictionary .................................................................................86
Contents ◾ ix
SNMP Brute Force Tool ..................................................................................................86
SNMP Dictionary Attack Tool ........................................................................................87
SMTP Enumeration ........................................................................................................87
Detecting Load Balancers .......................................................................................88
Load Balancer Detector ..........................................................................................89
Determining Real IP behind Load Balancers..........................................................89
Bypassing CloudFlare Protection ............................................................................90
Method 1: Resolvers ......................................................................................90
Method 2: Subdomain Trick .........................................................................92
Method 3: Mail Servers .................................................................................92
Intelligence Gathering Using Shodan ..............................................................................93
Further Reading...............................................................................................................95
Conclusion .......................................................................................................................95
4 Target Enumeration and Port Scanning Techniques..................................................97
Host Discovery ................................................................................................................97
Scanning for Open Ports and Services ...........................................................................100
Types of Port Scanning ..................................................................................................100
Understanding the TCP Three-Way Handshake .............................................................101
TCP Flags .......................................................................................................................101
Port Status Types ............................................................................................................102
TCP SYN Scan ...............................................................................................................102
TCP Connect Scan .........................................................................................................103
NULL, FIN, and XMAS Scans ......................................................................................104
NULL Scan ....................................................................................................................104
FIN Scan ........................................................................................................................105
XMAS Scan ....................................................................................................................105
TCP ACK Scan ..............................................................................................................105
Responses .......................................................................................................................106
UDP Port Scan ...............................................................................................................106
Anonymous Scan Types ..................................................................................................107
IDLE Scan ......................................................................................................................107
Scanning for a Vulnerable Host ......................................................................................107
Performing an IDLE Scan with NMAP .........................................................................109
TCP FTP Bounce Scan ..................................................................................................109
Service Version Detection ...............................................................................................110
OS Fingerprinting ..........................................................................................................111
POF ................................................................................................................................111
Output ............................................................................................................................112
Normal Format ......................................................................................................112
Grepable Format ....................................................................................................112
XML Format .........................................................................................................113
Advanced Firewall/IDS Evading Techniques ..................................................................113
Timing Technique ..........................................................................................................114
Wireshark Output ..........................................................................................................114
Fragmented Packets ........................................................................................................115
Wireshark Output ..........................................................................................................115
x ◾ Contents
Source Port Scan .............................................................................................................115
Specifying an MTU ........................................................................................................116
Sending Bad Checksums ................................................................................................116
Decoys ............................................................................................................................117
ZENMAP.......................................................................................................................117
Further Reading..............................................................................................................119
5 Vulnerability Assessment ..........................................................................................121
What Are Vulnerability Scanners and How Do They Work? ..........................................121
Pros and Cons of a Vulnerability Scanner ......................................................................122
Vulnerability Assessment with Nmap ............................................................................122
Updating the Database ..................................................................................................122
Scanning MS08 _ 067 _ netapi ...............................................................................123
Testing SCADA Environments with Nmap ...................................................................123
Installation ...........................................................................................................124
Usage ....................................................................................................................124
Nessus Vulnerability Scanner .........................................................................................124
Home Feed ............................................................................................................125
Professional Feed ...................................................................................................125
Installing Nessus on BackTrack ......................................................................................125
Adding a User .................................................................................................................125
Nessus Control Panel ............................................................................................126
Reports ........................................................................................................126
Mobile .........................................................................................................126
Scan ............................................................................................................127
Policies .........................................................................................................127
Users ............................................................................................................127
Configuration ..............................................................................................127
Default Policies .....................................................................................................127
Creating a New Policy ...................................................................................................128
Safe Checks....................................................................................................................128
Silent Dependencies .......................................................................................................128
Avoid Sequential Scans .........................................................................................128
Port Range ......................................................................................................................129
Credentials ............................................................................................................129
Plug-Ins .................................................................................................................129
Preferences .....................................................................................................................130
Scanning the Target ..............................................................................................130
Nessus Integration with Metasploit .................................................................................132
Importing Nessus to Metasploit ......................................................................................132
Scanning the Target ...............................................................................................133
Reporting ..............................................................................................................133
OpenVas ................................................................................................................133
Resource ........................................................................................................................134
Vulnerability Data Resources ................................................................................134
Exploit Databases ..................................................................................................135
Contents ◾ xi
Using Exploit-db with BackTrack ..................................................................................136
Searching for Exploits inside BackTrack .........................................................................137
Conclusion ......................................................................................................................138
6 Network Sniffing ......................................................................................................139
Introduction ...................................................................................................................139
Types of Sniffing .............................................................................................................140
Active Sniffing .......................................................................................................140
Passive Sniffing ......................................................................................................140
Hubs versus Switches ......................................................................................................140
Promiscuous versus Nonpromiscuous Mode ...................................................................141
MITM Attacks ...............................................................................................................141
ARP Protocol Basics .......................................................................................................142
How ARP Works ............................................................................................................142
ARP Attacks ...................................................................................................................143
MAC Flooding ......................................................................................................143
Macof ...........................................................................................................143
ARP Poisoning ......................................................................................................144
Scenario—How It Works ...............................................................................................144
Denial of Service Attacks ................................................................................................144
Tools of the Trade ...........................................................................................................145
Dsniff ....................................................................................................................145
Using ARP Spoof to Perform MITM Attacks .................................................................145
Usage .....................................................................................................................146
Sniffing the Traffic with Dsniff .......................................................................................147
Sniffing Pictures with Drifnet .........................................................................................147
Urlsnarf and Webspy ......................................................................................................148
Sniffing with Wireshark ..................................................................................................149
Ettercap ..........................................................................................................................150
ARP Poisoning with Ettercap .........................................................................................150
Hijacking Session with MITM Attack ............................................................................152