定一个特定的到期时间可以极大地加快问题的解决速度。授权人们
开展行动并给他们规定一个到期时间可以清除大量的借口和障碍，
就像大多数以目标为导向的项目一样。
12.4正确做事
在公开场合发言中，我常常要求听众考虑“遵守规定等于安全"或“安
全等于遵守规定”这两种说法。当与会者表示“这是捉弄人的问题
妈？"对我进行请难时，我回答说不是，但它们在某种程度上是反问
句，答案都是“不”。
当然，服从不等于安全。我们知道在大量的案例中，公司或机构遵
循相关的标准或要求，但在安全领域仍然存在缺陷。例如，儿个被
泄密的机构，包括CardSystems、TJX和Hannaford在遭遇泄密之前已
经通过了它们的PCIDSS审核。
类似，并不能因为一家公司是安全的，就能推断出它是遵守规定
的。在一个假设的例子中，一个实体从技术的角度可能是非常安全
的，但它可能并不遵循一个特定的安全标准或指南。
在结束本章时，我想重复自己的观点，安全应该是有计划地实现：
也就是本人所讨论的把目光瞄准在“正确做事"的文化、平衡和通信
上。在某种程度上，这个词听去更像是理想主义，而不是务实态
度。但是，我看到过一些机构实现了这三者的结合，因此它是可以
实现的。一般而言，在信息安全领域，“正确做事”意味着不仅要考
虑大量的技术因素，还需要考虑许多策略和流程问题。在后面两个
领域，常常会出现法律问题，这时候法律队伍（由机构内的律师和
外部顾问组成）就可以大显身手。
2437
---
## Page 2439
具体地说，从事安全工作的人们与律师之间的无缝关系可以扫除困
扰我们的大量问题。更通俗地说，也许不再是万变不离其宗，而且
可以实现真正的变化，完善整体的安全环境，这是不是很美呢？
第13章美丽的日志处理
取我们所负责的包括计算机、网络设备、应用程序框架、SOAWeb
基础设施甚至是目前还没有发明的未来组件在内的信息技术（IT）
组件的知识呢？这类信息最丰富的来源尽管总是可供使用，但常常
不被人们所注意。这种来源就是系统和应用程序所产生的日志和审
计跟踪。通过日志和审计跟踪以及相关的警告，信息系统常常可以
提示我们什么东西出了差错，甚至允许我们把目光投向未来，并告
诉我们什么东西将会出现差错。
日志可能还会揭露更多的脆弱性，例如在我们在控制中对规章制度
的顺应性方面的不足。它们甚至会对IT的管理产生重要影响，并可
能通过扩展影响公司的管理。因此，它们的影响范围甚至会超出IT
领域。
但是，有许多日志常常只包含了数据（有时候是垃圾数据）而没有
包含信息。我们需要付出额外的努力（有时候甚至付出需要巨大的
努力）对数据进行过滤，才能把它变成与IT和业务相关的可以付诸
行动的实用信息。
13.1安全法律和标准中的日志
在一个非常高的层次上，我们可以把日志等同于责任。这并不是一
个新思路，而是可以回溯到1983年首次发行的广受推崇的橙色书
（《Department of DefenseTrusted Computer System Evaluation
Criteria》）。在“基本需求（FundamentalRequirements）”一节，我们
找到了对日志的需求：
需求4——责任（accountability）——审核信息必须有选择地保存和
保护，使影响安全的活动可以被追踪到责任方。受信任的系统必须
能够在一个审核日志中记录安全相关事件的发生。
维基百科把"责任"定义为：
2438
---
## Page 2440
责任是一个道德概念，它具有几个含义，常常作为像负责、可应
答、实施、问责、义务以及其他与责任期望相关联的术语概念的同
义词山]。
在机构内部，还有其他许多与责任有关的机制，但在IT领域日志是
最为常见的。如果IT机构无法实现责任，那么它的业务也无法实现
责任。因此，如果对日志抱无所谓的态度，相当于对责任也抱无所
谓的态度。所有的机构都应该明白这个道理。
同时，日志对于规章制度也有看无可估量的价值。许多最近的美国
法律制订了相关的条款，要求对日志进行审核和处理。其中几个最
重要的法律是健康保险携带和责任法案（HIPAA）、Gramm-Leach-
Bliley金融服务业现代化法案（GLBA）和Sarbanes-Oxley法案
（SOX）。
例如，对HIPAA的安全规则小节164.306、164.308和164.312所列出的
安全需求和规范进行详细分析后可以推断出与审核该日志有关的条
款。具体地说，164.312（b）小节“审核保留"覆盖了患者被保护的健
康信息（PHI）的系统审核、日志和监视控制。类似地，GLBA的第
501小节、SOX的第404小节和其他条款间接规定了审核日志的收集
和审查。跨越各种系统和应用程序的中央化事件日志以及它的分析
和报告，共同提供了证明机构所实现的安全控制的存在性和有效性
的信息。这些做法也可以帮助确认和减少机构的安全弱点和漏洞所
造成的影响，并提供修补方案。随着其他标准（例如PCIDSS、
ISO2700x、ITIL和COBIT）成为必将出现的新规定的基础，日志对于
遵循规章制度的重要性只会越来越增加。
[1]我注意到负责的定义是在维基百科的"Accountability"项提供的
（http://en.wikipedia.org/wiki/Accountability），最近访问是在2009年
1月10日。
13.2聚焦日志
由于与日志有关的正规课程极为缺乏，那么该怎么讲述日志文件和
审核记录的例子呢？我们可以根据产生日志的来源对日志文件进行
分类，因为它通常粗略地确定了它们所包含的信息类型。例如，
Unix、Linux和Windows系统所产生的日志文件与Cisco、Nortel和
Lucent所生产的路由器、交换机和其他网络设备所产生的网络设备日
2439
---
## Page 2441
志显然是不同的。类似地，防火墙、入侵检测和预防系统和消息安
全设备所产生的安全设备日志与系统日志和网络日志都截然不同。
事实上，不同的安全系统在日志所记录的内容和格式方面存在很大
的区别。从简单地记录可疑的IP地址到想方设法捕捉所有的网络流
量，安全日志可能存储数量惊人的数据，有些内容具有相关性，有
些内容则是无关紧要的，甚至有些内容对于判断当时的情况具有欺
骗性。
日志术语
日志领域所使用的许多术语（包括日志的定义本身！）具有含糊，
误导或多重含义。在有些情况下，这些术语是从其他学科“借用”
的，或者不同的人有不同的用法。对于已经难以航行的海面，这种
含糊性只会把水进一步搅混。下面是我们在本章中使用的一些术语
的定义：
日志消息（有时简称消息）或日志记录对系统、网络或应用程序上
所观察的一些活动或一个事件的记录。日志或日志文件存储在一个
文件中的一条或多条日志消息的集合。这种文件可以是文本文件、
二进制格式的文件、数据库或其他存储媒介中的文件。
13.3什么时候日志是极为珍贵的
日志被认为是调查的关键部分，事实上常常是需要观察的第一手数
据。日志一旦被记录之后就不能通过正常的系统使用途径进行修
改，这意味着它们可以作为永久记录（至少在日志被保留的情况
下）。因此，它们对系统上的其他数据提供了准确的补充，因为前
者更容易被修改或破坏。（前提是管理员遵循了建议，把日志记录
到从Internet断开的系统，使它们很难被破环。）
由于日志在每条记录上都提供了时间戳，因此它们提供了事件的时
间顺序，不仅显示了发生了什么，还显示了它们是在什么时候发生
的以及是按什么顺序发生的山。
另外，记录在专用的日志收集器主机的日志提供了与最初来源隔离
的证据来源。如果最初来源上的信息的准确性被质疑（例如入侵者
可能会修改或删除日志），那么这种隔离的信息来源可能被认为是
2440
---
## Page 2442
更可靠的。来自不同来源甚至不同站点的日志可以相互提供证据，
增强每种数据来源的准确性。
另外，日志可以巩固在法庭调查期间所收集的其他证据。一个事件
的重建常常并不是根据一段信息甚至一个信息来源，而是根据各种
来源的数据：系统中的文件和时间戳、用户命令历史、网络数据和
日志。偶尔，日志可能会反驳其他证据，这意味着其他来源的信息
本身可能已经被破坏（例如，被攻击者破坏）。当一台主机被入侵
后，远程记录在其他系统上的日志可能是唯一可靠的信息来源。
正如本章后面所解释的那样，有时候日志中的证据是间接的或不完
整的。例如，一条日志记录可能显示一个特定的活动，但并没有记
录是谁进行了这个活动。例如，过程记账日志显示了用户已经运行
了什么命令，但没有记录这些命令的参数。因此，我们并不总能依
赖日志作为唯一的信息来源。
[1]记住前面所提到的修正日志时间的难度。
13.4日志所面临的困难
根据我们在日志的格式、语法和含义中所发现的混乱，日志的分析
甚至将简单的日志收集和保留以便未来之用也存在许多独特的困
滩。我们将回顾其中的一些挑战，然后讲述一个在调查中使用日志
数据的有代表性的故事。
太多的数据
这通常是在考虑日志时所面临的第一个困难。数百道防火墙（对于
大型环境而言并非罕见）和数千个桌面应用程序每大可能会产生数
以百万计的记录。即使没有其他原因，仅仅是日益增长的带宽和连
接性，都会导致每大的日志容量越来越大。
日志消息的巨大容量导致日志的分析需要大量的时间和计算资源。
在一个几G字节的文件上，即使简单地使用Unixgrep工具（它逐行查
找文件中的字符串）也需要10分钟甚至更长的时间。像数据挖掘这
种分析，可能需要几小时甚至几天才能处理完如此容量的数据。
不充分的数据
2441
---
## Page 2443
这个问题正好与前一个问题相反。对事故或事件响应的处理可能由
于应用程序或安全设备无法记录重要的数据或由于管理员没有预料
到需要收集这样的数据而受到阻碍。这个挑战常常是由于日志保留
时间太短所导致的。
信息的发布方式不佳
这与前一个问题有点相似。许多日志只是没有正确的信息或者需要
花费很大的力气才能从日志中发掘出正确的信息。例如，有些电子
邮件系统在不同的日志消息甚至不同的文件中记录已发送的电子邮
件和已接收的电子邮件，导致很难得出正确的消息序列或者很难把
一条邮件消息与它的响应相关联。
有些日志正好缺少我们感兴趣的关键数据片断。一个有名的例子是
没有提示试图进行登录的用户账户的登录失败信息。
假阳性
这个问题常见于网络入侵检测系统（NIDS），它会浪费管理员的时
间，并隐藏可能提示真正问题的更为重要的信息。除了假阳性之外
（由正常的事件所触发），管理员可能因为处理错误的警报（可能
是恶意的但不会对目标造成伤害）而应接不暇。
很难获得的数据
由于政治上或技术上的原因，分析数据的人常常无法得到他所需要
的数据，从而削弱了日志管理的功能。另一个比较罕见的原因是由
于遗留软件或硬件导致数据难以获得。例如，获得大型机的审核记
录往往是非常困难的。
沉余和不一致的数据
允余数据来自记录同一个事件的多个设备，由于它们记录这个事件
的方式不同，可能会造成混淆。对于日志分析而言，这就增加了一
个额外的步骤，因为需要执行数据的“去重复”，删除那些"表述相同
东西"的记录。
日志并没有统一的标准。大多数应用程序在记录日志时采用了它们
的创建者所开发的格式（有些显得颇有创意，有些只能用精神错乱
来形容），从而导致了很大的分析困滩。日志可能采用花样百出的