通过通道化过程，将内存特征数据、综合行为特征数据和行为频率表数字化后创建的512×512大小的向量分别匹配到红色通道、绿色通道和蓝色通道。每一个通道，其减少了特征数据的尺寸，被整合成一个单一的RGB图像并存储。图5显示了特征预处理阶段完成后，训练和测试数据集的结果。
图5. – 通过特征预处理创建的良性和恶意软件图像。
D. 特征选择和分类
下表3是本文用于训练和建立物联网恶意软件检测模型的ZFNet层名、张量大小和参数。
表3 用于构建物联网恶意软件检测模型的ZFNet结构表
DAIMD模型通过对特征图像进行训练，利用ZFNet模型对训练数据集中共840张图像进行检测，检测出物联网恶意软件。IoT恶意软件检测准确率为99.87%，实际数据与通过模型输出的数据相差0.0047。
为了验证训练后的DAIMD模型是否能准确检测物联网恶意软件，使用测试数据集中的561个文件进行测试，检测准确率为99.28%。
## 0x05 效果评估
为了检验本文提出的DAIMD是否能够准确分析和检测知名的物联网恶意软件以及智能演化的新的和变种的物联网恶意软件，进行了性能评估。用于评估所实现模型性能的指标是假良性率（FPR）、假恶性率（FNR）和准确率（ACY）。
FPR指的是物联网恶意软件被误判为良性的比率。这里，假良性(FP)是指即使是物联网恶意软件，也被归为良性文件的案例数量，真良性(TN)是指正确归为良性的案例数量。
FNR指的是良性文件被分类为恶意软件的比率。假良性(FN)是指即使是良性文件，也被错误地归类为物联网恶意软件的案例数，真良性(TP)是指正确归类为恶意软件的案例数。
最后，ACY指的是恶意软件和良性文件的分类准确度。
查看来源右键点击图中的MathML和附加特征。
图6显示了DAIMD模型的训练精度和损失值的变化，其中根据不同向量大小训练行为的特征数据。在训练基于特征向量最优大小的物联网恶意软件检测ZFNet模型中的行为图像时，采用Adam优化器算法进行优化；模型的训练是通过固定外延时间为40来进行的。图6（a）为DAIMD模型训练后测得的准确率。随着外延时间的增加，精度逐渐提高。当向量大小为224×224时，与其他向量大小相比，其准确率相对较低。图6
(b)显示了损失值，当它的向量大小为512×512时，损失曲线下降得相对缓慢。
为了对DAIMD进行验证，使用了训练数据集中的84条记录，占总记录数的10%。一个已实现的模型能否表现出最佳性能，可以通过验证来验证。图7显示了对不同向量大小的DAIMD模型进行验证时的精度和损失值。在图7(a)中，随着纪元的增加，尺寸为512×512的向量的验证精度与其他尺寸的向量相比逐渐提高，而尺寸为224×224的向量的验证精度明显低于场。此外，在尺寸为224×224和256×256的向量中，特定部分出现了过拟合现象。图7(b)显示了对不同向量尺寸进行验证时的测量损失值。当尺寸为512×512时，损耗曲线呈下降趋势
，而尺寸为448×448的向量在特定范围内振动很大，说明发生了过拟合。
当对通过训练和验证选出的最优DAIMD模型进行测试时，准确率、FPR和FNR可以用表4表示。当用大小为512×512的特征向量对DAIMD模型进行测试时，测试准确率为99.28%，并且证实了准确率比用其他大小的特征向量进行测试时要高。可以看出，当向量大小为512×512时
，属于物联网恶意代码，但被归类为非恶意文件的FPR值明显低于其他大小的特征向量。另一方面，当向量大小为448×448时，FNR为0.52%
，低于512×512向量大小的情况。由于检测物联网恶意软件最重要的指标是FPR，所以本文也非常重视所开发模型在FPR下的性能评价。
表4 不同向量大小的测试精度、FPR和FNR结果比较。
在图6、7和表4中，使用512×512大小的向量对DAIMD模型进行训练、验证和测试时，FPR值的性能和准确率都比使用不同大小的向量进行的性能好。
表5是所提出的模型与其他恶意软件检测模型的比较。为了评价模型的性能，指定了以下比较项目：在什么环境下检测恶意软件；使用了什么分析技术；测试精度和FPR值。由于没有测量周氏模型[39]的FPR值，所以没有包括在内。
表5 DAIMD与其他恶意软件检测模型的性能比较
五种类型的恶意软件检测模型均采用不同的分析技术对不同环境下的恶意软件进行了分析和检测。总体而言，各模型的准确率值均表现出95%以上的优秀检测性能。其中，DAIMD模型的准确率(99.28%)最好，它将恶意软件错误分类为良性的概率(0.63%)最低。这意味着，DAIMD模型可以准确检测威胁物联网设备的变种恶意软件。
## 0x06 结论
在嵌入式Linux环境下配置各种架构和库的物联网设备，由于其攻击点较广，市场上分布着许多易受攻击的产品，因此特别受到恶意软件作者的攻击。大多数物联网设备都配备了ARM处理器，因此针对搭载ARM处理器的物联网恶意软件样本数量也随之增加。针对这一问题，人们进行了大量的研究来分析和检测物联网恶意软件。然而，大多数研究都涉及到恶意软件分析人员的主观干预，以选择和分类具有代表性的恶意软件行为。这种方法使得在智能进化的过程中，准确检测新的和变种的物联网恶意软件有潜在的困难。此外，在基于Linux的嵌入式物联网设备中，为检测物联网恶意软件必须提取大量的行为数据，而这些数据配备了为特定目的设计的有限硬件资源，很难长期积累和存储。
因此，本文提出了一种动态分析的物联网恶意软件检测（DAIMD）方案，在虚拟嵌入式系统下和云环境下利用CNN模型动态分析物联网恶意软件，并对物联网恶意软件进行训练和分类。首先，设计并实现了基于云端的嵌套虚拟环境，在安全的环境下对物联网恶意软件进行分析和检测。然后，在云环境下按照调试、特征提取、特征预处理、特征选择和分类等阶段进行训练、验证和测试，创建了DAIMD模型。由于通过检测过程提取的行为特征数据较多，为了避免分类阶段特征数据的训练和分类存在复杂的计算问题，将其转换为图像，减少了数据的维数。此外，通过DAIMD可视化技术，全面体现了物联网恶意软件和良性文件的特征。
利用DAIMD可以防止物联网设备的感染或物联网恶意软件向其他通过互联网连接的物联网设备传播。此外，由于DAIMD利用CNN模型对行为特征进行选择和分类，不需要人为的主观干预，因此可以准确地检测出具有各种智能攻击技术的新型和变种物联网恶意软件。
本文提出的DAIMD通过执行物联网恶意软件，采用动态分析技术分析行为特征。由于一些物联网恶意软件很容易识别出它们是在虚拟机等有限的环境中执行的，它们可能会避开使用动态分析技术的恶意软件分析和检测系统。因此，今后将研究如何实现一种能够利用混合分析技术检测物联网恶意软件的模型。