  of	
  that	
  chip	
–  There’s	
  tools	
  that	
  make	
  it	
  easy	
•  hOp://www.topjtag.com/ﬂash-­‐programmer/	
•  JTAG	
  the	
  easy	
  way	
–  TopJTAG	
  Probe	
•  hOp://www.topjtag.com/probe/	
•  Pic	
–  What	
  can	
  we	
  do	
  with	
  it?	
Debugging	
  Ports	
•  Get	
  out	
  that	
  Voltmeter!	
  We’re	
  going	
  to	
idenDfy	
  the	
  TSC	
  (Test	
  Clock)	
  and	
  TMS	
  (Test	
Mode	
  Select)	
– They’re	
  both	
  aOached	
  to	
  all	
  chips	
  with	
  JTAG	
  on	
them	
  and	
  do	
  not	
  get	
  buﬀered	
  in	
  most	
  cases	
– Look	
  for	
  public	
  data	
  sheets	
  which	
  should	
  allow	
you	
  to	
  easily	
  idenDfy	
  the	
  TDO	
  and	
  TDI	
  lines	
– Probe	
  the	
  TDI/TDO	
  pin	
  on	
  each	
  device,	
  and	
  run	
through	
  the	
  provisioning	
  connector	
  to	
  see	
  where	
you	
  get	
  a	
  BEEEEEEPPPPPP!	
Debugging	
  Ports	
•  2-­‐wire	
  Unit	
  Demo	
  idenDfying	
  SPI	
  or	
  I2C	
provisioning	
  and	
  JTAG	
  connector.	
Debugging	
  Ports	
•  Other	
  Debugging	
  Interfaces	
–  Almost	
  all	
  the	
  debugging	
  interfaces	
  we’ve	
  shown	
  are	
  sDll	
in	
  use	
–  BDM	
  is	
  extremely	
  common	
  in	
  Freescale	
  based	
  devices	
•  Like	
  Joe	
  Grand’s	
  DEF	
  CON	
  badges	
•  Also	
  show	
  up	
  in	
  SONNET	
  gear	
–  Sonnet	
  controller	
–  ISP	
•  People	
  love	
  to	
  pick	
  on	
  ISP	
•  ATmel	
  used	
  it	
  on	
  all	
  it’s	
  8-­‐bit	
  Micro	
  AVR	
  line	
  (Arduino	
  too)	
•  Demo	
–  Tons	
  more	
  debug	
  interfaces	
  that	
  we	
  don’t	
  have	
  Dme	
  to	
cover	
  J	
Debugging	
  Ports	
•  A	
  note	
  on	
  Side	
  Channel	
  AOacks	
– Are	
  any	
  of	
  the	
  components	
  in	
  the	
  device	
suscepDble	
  to	
  the	
  side-­‐channel	
  aOacks	
  we’ve	
menDoned?	
•  Power	
  consumpDon	
  analysis	
•  Protocol	
  weaknesses	
•  Poorly	
  iniDalized	
  random	
  number	
  generator	
•  Timing	
  Analysis	
•  DiﬀerenDal	
  Fault	
  Analysis	
•  Data	
  Remnant	
  (hat	
  Dp	
  to	
  Major’s	
  work	
  on	
  the	
AT91SAM7XC)	
Debugging	
  Ports	
•  BeaDng	
  the	
  Hardware	
  Provisioning	
  Interface	
Drum	
  with	
  KingPin.	
•  In	
  another	
  talk	
  here:	
– Introduced	
  a	
  device	
  called	
  JTAGulator,	
  makes	
  it	
much	
  easier	
  to	
  locate	
  JTAG	
  ports	
– KingPin	
  has	
  advocated	
  securing	
  JTAG	
  ports	
  for	
years	
– People	
  should	
  listen	
  to	
  this	
  guy,	
  he’s	
  really	
  smart.	
– Full	
  props	
  to	
  him	
  on	
  all	
  his	
  hardware	
  work	
SoUware	
  AOacks	
•  SoUware	
  is	
  usually	
  the	
  weakest	
  link	
–  “If	
  civil	
  engineers	
  built	
  bridges	
  like	
  soUware	
  engineers	
  build	
programs,	
  they’d	
  all	
  fall	
  down”	
  –	
  Unknown	
–  If	
  you’re	
  going	
  aUer	
  crypto,	
  always	
  go	
  aUer	
  the	
  implementaDon,	
not	
  the	
  cryptography	
  itself.	
  –a	
  drunk	
  Bruce	
  Scheneier	
  at	
  a	
  DC	
party	
  years	
  ago.	
•  SoUware	
  can	
  be	
  defeated	
–  The	
  soUware	
  has	
  ulDmate	
  control	
  over	
  the	
  hardware	
–  SoUware	
  can	
  be	
  analyzed	
  to	
  determine	
  the	
  exact	
  purpose	
  and	
funcDons	
  of	
  the	
  hardware	
  you’re	
  analyzing	
–  Our	
  best	
  opportunity	
  for	
  compromise	
  is	
  where	
  soUware	
  and	
hardware	
  meet	
–  Most	
  soUware	
  is	
  test	
  under	
  “ideal”	
  condiDons	
–  The	
  designer	
  can	
  never	
  truly	
  test	
  their	
  own	
  design	
SoUware	
  AOacks	
•  An	
  example	
  of	
  state	
  dependency	
  for	
  operaDon	
–  This	
  device	
  was	
  used	
  to	
  meter	
  the	
  consumpDon	
  of	
  a	
  commodity.	
–  The	
  device	
  used	
  infrared	
  to	
  communicate	
  with	
  the	
  metering	
authority’s	
  data	
  collecDon	
  device.	
–  By	
  analyzing	
  the	
  protocol,	
  it	
  became	
  evident	
  that	
  certain	
  commands	
were	
  being	
  issued	
  post	
  authenDcaDon,	
  while	
  others	
  weren’t.	
–  The	
  structure	
  was	
  fairly	
  simple	
  (packeDzed	
  bytes	
  with	
  a	
  counter,	
  type	
of	
  packet,	
  ﬂags,	
  and	
  the	
  payload).	
–  One	
  of	
  the	
  ﬂags	
  was	
  set	
  only	
  post	
  authenDcaDon.	
–  By	
  changing	
  the	
  packet	
  type	
  to	
  something	
  diﬀerent	
  and	
  seVng	
  the	
“authenDcate	
  bit”	
  ,	
  the	
  security	
  challenge	
  response	
  was	
  defeated!	
–  How	
  silly	
  is	
  that?!?!	
–  This	
  is	
  a	
  common	
  occurrence	
  in	
  embedded	
  devices.	
  Why?	
•  No	
  one	
  bothers	
  to	
  look	
•  SoUware	
  is	
  oUen	
  rushed	
•  LocaDng	
  the	
  soUware	
  the	
  controls	
  a	
  device	
  by	
  physical	
analysis:	
–  Examine	
  the	
  traces	
  around	
  the	
  components	
  of	
  the	
  device	
–  Are	
  any	
  of	
  the	
  components	
  connected	
  in	
  a	
  way	
  that	
directly	
  indicates	
  what	
  processor	
  it	
  is	
  (ARM,	
  PIC,	
  Atmega,	
etc.),	
  such	
  as	
  a	
  direct	
  connecDon	
  to	
  small	
  form	
  factor	
  ﬂash	
memory	
  (like	
  an	
  SOIC8)	
–  Do	
  the	
  chip	
  numbers	
  indicate	
  that	
  some	
  the	
  components	
are	
  SPI	
  ﬂash	
  (Dead	
  giveaway)	
–  Are	
  some	
  of	
  the	
  components	
  socketed?	
•  Careful.	
  Some	
  devices	
  will	
  drop	
  the	
  contents	
  of	
  SRAM	
  (Like	
encrypDon	
  keys)	
  if	
  the	
  chip	
  is	
  unsocketed	
SoUware	
  AOacks	
SoUware	
  AOacks	
•  What	
  if	
  there	
  are	
  no	
  externally	
  visible	
methods	
  for	
  storing	
  soUware	
  or	
  conﬁguraDon	
data?	
– Some	
  devices	
  hold	
  all	
  the	
  needed	
  soUware	
  on	
  the	
main	
  processing	
  component	
  itself	
– This	
  means	
  that	
  there	
  is	
  a	
  way	
  to	
  get	
  the	
  soUware	
through	
  a	
  debug	
  connector	
– Some	
  devices	
  have	
  a	
  mask	
  ROM	
  boot	
  loader	
  that	
allows	
  upload	
  of	
  program	
  code	
  over	
  serial	
•  Terrible	
  for	
  security	
SoUware	
  AOacks	
• 
What	
  is	
  a	
  fuse?	
–  A	
  fuse	
  is	
  a	
  piece	
  of	
  the	
  hardware	
  that	
  is	
  burnt	
  in	
  order	
  to	
  prevent	
  download	
  of	
the	
  program	
  code	
  from	
  the	
  chip	
• 
What	
  if	
  I	
  ﬁnd	
  a	
  “fuse”	
  on	
  the	
  device?	
• 
There	
  are	
  ways	
  around	
  it,	
  as	
  usual	
–  The	
  most	
  common	
  is	
  voltage	
  glitching.	
  This	
  involves	
  Dming	
  a	
  drop	
  in	
  voltage	
precisely	
  such	
  that	
  the	
  chip	
  believes	
  it	
  reads	
  a	
  0	
  instead	
  of	
  a	
  1	
–  Another	
  way	
  to	
  get	
  around	
  lockouts	
  and	
  fuses	
  is	
  to	
  “erase”	
  the	
  device,	
  but	
power	
  it	
  oﬀ	
  immediately	
  aUer	
  the	
  command	
  is	
  issued	
  (milliseconds)	
•  This	
  can	
  reveal	
  the	
  contents	
  of	
  the	
  ﬂash	
  memory	
  if	
  done	
  correctly	
•  You	
  can	
  do	
  this	
  with	
  an	
  Arduino	
  in	
  a	
  lot	
  of	
  cases	
  with	
  a	
  liOle	
  custom	
  soUware	
–  ParDal	
  powering	
  of	
  the	
  device	
•  Some	
  devices	
  will	
  draw	
  power	