搜集数据分布，并负责平衡数据分布；
-   Broker（分发服务模块）
对外服务，有一份从master同步的路由信息，负责转发搜索/索引请求、合并全局结果；Broker为无状态服务，可随意扩充；
-   Datanode（存储计算模块）
维护数据，分片一般均匀分布在各个Datanode上面，负责搜索时的本地结果计算。
-   ### SPLServer（搜索统计模块）
SPLServer负责两类任务的调度工作。一类为查询层级，SPLServer
会自动对所有的 SPL
查询进行基于时间的分片，并对分片后的子任务进行公平轮询调度；另一类为结果处理层级，负责所有需要后台离线执行的查询任务的执行计划调度。
-   ### 算法服务组件模块
    算法服务组件包括
    KPIAnalyzer和LogAnalyzer；组件提供针对智能运维需求定制开发的各种AI算法。其中指标数据的消费处理和算法调用由KPIMonitor完成。日志数据的消费处理和算法调用会生成
    SparkStreaming任务在Spark组件上完成。
-   ### Manager（管理维护组件模块）
Manager负责日志分析平台集群的维护，包括各组件的部署、配置变更、性能监控告警、版本升级等等。
-   ### YottaWeb（展现和接口模块）
在搜索分析的基础上，YottaWeb负责所有的日志展现层功能。
3.2 数据接入情况
平台目前对互联网、分院专线、大楼计入等网络区域进行日志采集，接入安全设备覆盖表、主机性能日志、病历系统错误日志、中间件日志，linux安全日志、防火墙日志、数据库审计日志等，完成数据可视化监控，通过日志数据发现流量异常指标的变化，提高运维及故障排查的效率；同时对门诊电子病历、全景影像、药物审方和护理文书等关键系统进行梳理，实现对关键业务端到端及各个应用性能、状态的监控。通过日志数据既能实时监控每个应用节点运行状态，又能对用户行为进行监控，发现隐患并告警，智能定位分析故障，提高故障定位的时效性、人效性和准确性，为医院信息化运维提供有效的保障。
![处理量](media/image3.png){width="5.763194444444444in"
height="1.9506944444444445in"}
经评估目前医院日志日流量峰值已达150Gbps，按照25%性能冗余应对日后业务增长，支持每天200G日志增量存储。
4 应用场景
大数据日志分析平台通过数据采集实时获取各类设备、系统、数据库、业务数据并进行统计分析，由数据可视化技术得出图表，帮助运维人员发现网络、业务、数据库等系统异常，追踪系统性能的动态变化，及早发现问题，从而对医院关键的业务系统进行实时保障。目前接入数据情况：
![数据量](media/image4.png){width="5.760416666666667in"
height="1.675in"}
4.1运维监控
-   基础环境可用性异常监控
    对操作系统内存溢出、磁盘写入异常、关键进程退出异常、中间件数据库端口监听异常进行监控，进行响应指标的分析，监控业务健康，从而实现业务的健康监控，补全运维监控盲点，帮助运维人员先于投诉发现应用故障，应对重启系统、重启服务、清理临时文件等排障措施。
通过采集应用中间件日志，分析访问数量，错误访问状态、访问响应时长、负载均衡等建立重要指标，同时对主机cpu负荷超标情况进行统计分析，计算出主机健康度。对运维异常概览情况进行整体展示，提供cpu、内存、磁盘异常数量占比情况，标示当前主机的健康情况和异常情况，并可对高内存使用率主机数量、网络高入口流量主机数量、磁盘高使用率主机数量、网络高出口流量主机数、CPU高使用率主机数进行统计，全方位完成主机运维监控工作，可快速定位故障所在主机，加快运维效率。
![9](media/image5.png){width="5.753472222222222in"
height="2.373611111111111in"}
通过采集应用中间件日志，分析访问数量，错误访问状态、访问响应时长、负载均衡等建立重要指标，以满意度服务器平台中间件日志进行响应指标的分析，监控业务健康，从而实现业务的健康监控，补全运维监控盲点，帮助运维人员先于投诉发现应用故障，通过对黄金指标的实时监控保障业务连续性。
> ![](media/image6.png){width="5.750694444444444in"
> height="2.6180555555555554in"}
4.2行为审计
![C:\\Users\\Administrator\\Desktop\\中大附一\\中大附一部分文件\\场景说明用图\\7.png7](media/image7.png){width="5.753472222222222in"
height="3.3270833333333334in"}
通过对系统日志、堡垒机日志、VPN日志的采集，对全院332台主机资产进行审计。
![](media/image8.png){width="5.750694444444444in" height="2.275in"}
在操作系统层，通过对linux/windows系统日志的接入，对日志格式化提取出源IP，目的IP，登录时间，登录用户，登陆失败次数，登陆端口，成功登录次数等多个参数，方便在指定时间内对登陆系统信息进行用户行为审计。可统计堡垒机绕行登陆/多次错误口令尝试登陆/多次使用无效用户登陆主机等场景，检查是否存在口令猜测、暴力破解口令等违规行为。。
针对堡垒机日志，可对敏感命令进行审计，如使用rm、drop、chmod
777、userdel、cat
/etc/shadow等命令，从而进一步规范工作人员的操作过程，及时发现可能存在的安全隐患并及时响应，为调整安全管理策略提供依据。
### 针对VPN日志，同一源MAC地址登录多个VPN账号，同一VPN账号在多个MAC地址登录/同一源地址针对多个vpn用户登录失败的行为进行审计，排查账号泄露，有效防止黑客行为。
4.3安全分析
信息系统安全事件也会影响医院医疗活动的正常开展，大数据日志分析平台同时也提供安全分析保障医院信息系统的正常运行。
-   安全设备网络全链路
对网络安全设备日志进行集中采集，当前中大附一医院已经部署了网络监控、网管监控、流量监控等，但是各系统数据相互孤立，集中采集日志通过统一数据治理，可建立全链路串联模型，当故障发生时，只需要输入客户端IP，即可自动分析出连接服务器的交换机端口是否正常、准入系统是否放行、防火墙是否有策略阻断、中间件请求是否正常等问题，一键定位故障点。
![](media/image9.png){width="6.486805555555556in" height="3.5875in"}
-   防火墙日志安全分析
采用syslog方式采集深信服/华为防火墙日志，并对需要重点关注的告警日志进行特殊化展示，如对策略拒绝的源ip做top处理、展示行为趋势如"日志量趋势"、"严重日志级别趋势-IPS等，保证能够及时发现入侵并快速响应；单独分区实现五元组快速查询，可查询源地址与目标地址，以此满足针对性查询需求。
![](media/image10.png){width="5.768055555555556in"
height="6.771527777777778in"}
-   网络安全设备监控告警
结合网络安全方面建立告警监控，对"联软准入-华为防火墙"的链路异常情况、深信服AC日志分析的短信认证为失败行为、服务器在异常事件登陆成功行为、启明星辰-数据库审计-异常软件检测等设置不同等级的告警，并对深信服-waf-扫描器检测行为、防火墙-IPS防护信息建立定期检测，检测最近十分钟是否有被疑似扫描器的源IP进行访问，提醒安全人员进一步排查。
5 总结与展望
大数据是当前IT技术发展的热门方向，是一项重要的技术革新，而医院随着IT建设的进程，其日志数据也慢慢具备Volume（大量）、Velocity（高速）、Variety（多样）、Value（价值）的大数据特征，利用大数据技术分析日志数据，基于海量数据分析的视觉化以及数据管理的全新系统正在以日新月异的速度改变着医院信息化建设及维护者的分析能力，保证医疗工作的正常运行，减轻医院信息运维人员的工作负担，未来也可尝试接入处方医疗及相关科研数据，将为医院实现数字医疗、智慧医疗、健康医疗发挥重要作用。