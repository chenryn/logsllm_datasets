1. æ“ä½œå°‘é‡çš„æ•°æ®: é€‚ç”¨ `String`
2. å•çº¿ç¨‹æ“ä½œå­—ç¬¦ä¸²ç¼“å†²åŒºä¸‹æ“ä½œå¤§é‡æ•°æ®: é€‚ç”¨ `StringBuilder`
3. å¤šçº¿ç¨‹æ“ä½œå­—ç¬¦ä¸²ç¼“å†²åŒºä¸‹æ“ä½œå¤§é‡æ•°æ®: é€‚ç”¨ `StringBuffer`
### String ä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„?
`String` ç±»ä¸­ä½¿ç”¨ `final` å…³é”®å­—ä¿®é¥°å­—ç¬¦æ•°ç»„æ¥ä¿å­˜å­—ç¬¦ä¸²ï¼Œ~~æ‰€ä»¥`String` å¯¹è±¡æ˜¯ä¸å¯å˜çš„ã€‚~~
```java
public final class String implements java.io.Serializable, Comparable, CharSequence {
    private final char value[];
  //...
}
```
> ğŸ› ä¿®æ­£ï¼šæˆ‘ä»¬çŸ¥é“è¢« `final` å…³é”®å­—ä¿®é¥°çš„ç±»ä¸èƒ½è¢«ç»§æ‰¿ï¼Œä¿®é¥°çš„æ–¹æ³•ä¸èƒ½è¢«é‡å†™ï¼Œä¿®é¥°çš„å˜é‡æ˜¯åŸºæœ¬æ•°æ®ç±»å‹åˆ™å€¼ä¸èƒ½æ”¹å˜ï¼Œä¿®é¥°çš„å˜é‡æ˜¯å¼•ç”¨ç±»å‹åˆ™ä¸èƒ½å†æŒ‡å‘å…¶ä»–å¯¹è±¡ã€‚å› æ­¤ï¼Œ`final` å…³é”®å­—ä¿®é¥°çš„æ•°ç»„ä¿å­˜å­—ç¬¦ä¸²å¹¶ä¸æ˜¯ `String` ä¸å¯å˜çš„æ ¹æœ¬åŸå› ï¼Œå› ä¸ºè¿™ä¸ªæ•°ç»„ä¿å­˜çš„å­—ç¬¦ä¸²æ˜¯å¯å˜çš„ï¼ˆ`final` ä¿®é¥°å¼•ç”¨ç±»å‹å˜é‡çš„æƒ…å†µï¼‰ã€‚
>
> `String` çœŸæ­£ä¸å¯å˜æœ‰ä¸‹é¢å‡ ç‚¹åŸå› ï¼š
>
> 1. ä¿å­˜å­—ç¬¦ä¸²çš„æ•°ç»„è¢« `final` ä¿®é¥°ä¸”ä¸ºç§æœ‰çš„ï¼Œå¹¶ä¸”`String` ç±»æ²¡æœ‰æä¾›/æš´éœ²ä¿®æ”¹è¿™ä¸ªå­—ç¬¦ä¸²çš„æ–¹æ³•ã€‚
> 2. `String` ç±»è¢« `final` ä¿®é¥°å¯¼è‡´å…¶ä¸èƒ½è¢«ç»§æ‰¿ï¼Œè¿›è€Œé¿å…äº†å­ç±»ç ´å `String` ä¸å¯å˜ã€‚
>
> ç›¸å…³é˜…è¯»ï¼š[å¦‚ä½•ç†è§£ String ç±»å‹å€¼çš„ä¸å¯å˜ï¼Ÿ - çŸ¥ä¹æé—®](https://www.zhihu.com/question/20618891/answer/114125846)
>
> è¡¥å……ï¼ˆæ¥è‡ª[issue 675](https://github.com/Snailclimb/JavaGuide/issues/675)ï¼‰ï¼šåœ¨ Java 9 ä¹‹åï¼Œ`String`ã€`StringBuilder` ä¸ `StringBuffer` çš„å®ç°æ”¹ç”¨ `byte` æ•°ç»„å­˜å‚¨å­—ç¬¦ä¸²ã€‚
>
> ```java
> public final class String implements java.io.Serializable,Comparable, CharSequence {
>     // @Stable æ³¨è§£è¡¨ç¤ºå˜é‡æœ€å¤šè¢«ä¿®æ”¹ä¸€æ¬¡ï¼Œç§°ä¸ºâ€œç¨³å®šçš„â€ã€‚
>     @Stable
>     private final byte[] value;
> }
>
> abstract class AbstractStringBuilder implements Appendable, CharSequence {
>     byte[] value;
>
> }
> ```
>
> **Java 9 ä¸ºä½•è¦å°† `String` çš„åº•å±‚å®ç°ç”± `char[]` æ”¹æˆäº† `byte[]` ?**
>
> æ–°ç‰ˆçš„ String å…¶å®æ”¯æŒä¸¤ä¸ªç¼–ç æ–¹æ¡ˆï¼šLatin-1 å’Œ UTF-16ã€‚å¦‚æœå­—ç¬¦ä¸²ä¸­åŒ…å«çš„æ±‰å­—æ²¡æœ‰è¶…è¿‡ Latin-1 å¯è¡¨ç¤ºèŒƒå›´å†…çš„å­—ç¬¦ï¼Œé‚£å°±ä¼šä½¿ç”¨ Latin-1 ä½œä¸ºç¼–ç æ–¹æ¡ˆã€‚Latin-1 ç¼–ç æ–¹æ¡ˆä¸‹ï¼Œ`byte` å ä¸€ä¸ªå­—èŠ‚(8 ä½)ï¼Œ`char` å ç”¨ 2 ä¸ªå­—èŠ‚ï¼ˆ16ï¼‰ï¼Œ`byte` ç›¸è¾ƒ `char` èŠ‚çœä¸€åŠçš„å†…å­˜ç©ºé—´ã€‚
>
> JDK å®˜æ–¹å°±è¯´äº†ç»å¤§éƒ¨åˆ†å­—ç¬¦ä¸²å¯¹è±¡åªåŒ…å« Latin-1 å¯è¡¨ç¤ºçš„å­—ç¬¦ã€‚
>
> ![](https://oss.javaguide.cn/github/javaguide/jdk9-string-latin1.png)
>
> å¦‚æœå­—ç¬¦ä¸²ä¸­åŒ…å«çš„æ±‰å­—è¶…è¿‡ Latin-1 å¯è¡¨ç¤ºèŒƒå›´å†…çš„å­—ç¬¦ï¼Œ`byte` å’Œ `char` æ‰€å ç”¨çš„ç©ºé—´æ˜¯ä¸€æ ·çš„ã€‚
>
> è¿™æ˜¯å®˜æ–¹çš„ä»‹ç»ï¼š ã€‚
### å­—ç¬¦ä¸²æ‹¼æ¥ç”¨â€œ+â€ è¿˜æ˜¯ StringBuilder?
Java è¯­è¨€æœ¬èº«å¹¶ä¸æ”¯æŒè¿ç®—ç¬¦é‡è½½ï¼Œâ€œ+â€å’Œâ€œ+=â€æ˜¯ä¸“é—¨ä¸º String ç±»é‡è½½è¿‡çš„è¿ç®—ç¬¦ï¼Œä¹Ÿæ˜¯ Java ä¸­ä»…æœ‰çš„ä¸¤ä¸ªé‡è½½è¿‡çš„è¿ç®—ç¬¦ã€‚
```java
String str1 = "he";
String str2 = "llo";
String str3 = "world";
String str4 = str1 + str2 + str3;
```
ä¸Šé¢çš„ä»£ç å¯¹åº”çš„å­—èŠ‚ç å¦‚ä¸‹ï¼š
![](https://oss.javaguide.cn/github/javaguide/java/image-20220422161637929.png)
å¯ä»¥çœ‹å‡ºï¼Œå­—ç¬¦ä¸²å¯¹è±¡é€šè¿‡â€œ+â€çš„å­—ç¬¦ä¸²æ‹¼æ¥æ–¹å¼ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡ `StringBuilder` è°ƒç”¨ `append()` æ–¹æ³•å®ç°çš„ï¼Œæ‹¼æ¥å®Œæˆä¹‹åè°ƒç”¨ `toString()` å¾—åˆ°ä¸€ä¸ª `String` å¯¹è±¡ ã€‚
ä¸è¿‡ï¼Œåœ¨å¾ªç¯å†…ä½¿ç”¨â€œ+â€è¿›è¡Œå­—ç¬¦ä¸²çš„æ‹¼æ¥çš„è¯ï¼Œå­˜åœ¨æ¯”è¾ƒæ˜æ˜¾çš„ç¼ºé™·ï¼š**ç¼–è¯‘å™¨ä¸ä¼šåˆ›å»ºå•ä¸ª `StringBuilder` ä»¥å¤ç”¨ï¼Œä¼šå¯¼è‡´åˆ›å»ºè¿‡å¤šçš„ `StringBuilder` å¯¹è±¡**ã€‚
```java
String[] arr = {"he", "llo", "world"};
String s = "";
for (int i = 0; i  **æ³¨æ„**ï¼šæ¯”è¾ƒ String å­—ç¬¦ä¸²çš„å€¼æ˜¯å¦ç›¸ç­‰ï¼Œå¯ä»¥ä½¿ç”¨ `equals()` æ–¹æ³•ã€‚ `String` ä¸­çš„ `equals` æ–¹æ³•æ˜¯è¢«é‡å†™è¿‡çš„ã€‚ `Object` çš„ `equals` æ–¹æ³•æ˜¯æ¯”è¾ƒçš„å¯¹è±¡çš„å†…å­˜åœ°å€ï¼Œè€Œ `String` çš„ `equals` æ–¹æ³•æ¯”è¾ƒçš„æ˜¯å­—ç¬¦ä¸²çš„å€¼æ˜¯å¦ç›¸ç­‰ã€‚å¦‚æœä½ ä½¿ç”¨ `==` æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰çš„è¯ï¼ŒIDEA è¿˜æ˜¯æç¤ºä½ ä½¿ç”¨ `equals()` æ–¹æ³•æ›¿æ¢ã€‚
![](https://oss.javaguide.cn/java-guide-blog/image-20210817123252441.png)
**å¯¹äºç¼–è¯‘æœŸå¯ä»¥ç¡®å®šå€¼çš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯å¸¸é‡å­—ç¬¦ä¸² ï¼Œjvm ä¼šå°†å…¶å­˜å…¥å­—ç¬¦ä¸²å¸¸é‡æ± ã€‚å¹¶ä¸”ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ‹¼æ¥å¾—åˆ°çš„å­—ç¬¦ä¸²å¸¸é‡åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«å­˜æ”¾å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œè¿™ä¸ªå¾—ç›Šäºç¼–è¯‘å™¨çš„ä¼˜åŒ–ã€‚**
åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼ŒJavac ç¼–è¯‘å™¨ï¼ˆä¸‹æ–‡ä¸­ç»Ÿç§°ä¸ºç¼–è¯‘å™¨ï¼‰ä¼šè¿›è¡Œä¸€ä¸ªå«åš **å¸¸é‡æŠ˜å (Constant Folding)** çš„ä»£ç ä¼˜åŒ–ã€‚ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹ä¸­æ˜¯ä¹Ÿæœ‰ä»‹ç»åˆ°ï¼š
![](https://oss.javaguide.cn/javaguide/image-20210817142715396.png)
å¸¸é‡æŠ˜å ä¼šæŠŠå¸¸é‡è¡¨è¾¾å¼çš„å€¼æ±‚å‡ºæ¥ä½œä¸ºå¸¸é‡åµŒåœ¨æœ€ç»ˆç”Ÿæˆçš„ä»£ç ä¸­ï¼Œè¿™æ˜¯ Javac ç¼–è¯‘å™¨ä¼šå¯¹æºä»£ç åšçš„æå°‘é‡ä¼˜åŒ–æªæ–½ä¹‹ä¸€(ä»£ç ä¼˜åŒ–å‡ ä¹éƒ½åœ¨å³æ—¶ç¼–è¯‘å™¨ä¸­è¿›è¡Œ)ã€‚
å¯¹äº `String str3 = "str" + "ing";` ç¼–è¯‘å™¨ä¼šç»™ä½ ä¼˜åŒ–æˆ `String str3 = "string";` ã€‚
å¹¶ä¸æ˜¯æ‰€æœ‰çš„å¸¸é‡éƒ½ä¼šè¿›è¡ŒæŠ˜å ï¼Œåªæœ‰ç¼–è¯‘å™¨åœ¨ç¨‹åºç¼–è¯‘æœŸå°±å¯ä»¥ç¡®å®šå€¼çš„å¸¸é‡æ‰å¯ä»¥ï¼š
- åŸºæœ¬æ•°æ®ç±»å‹( `byte`ã€`boolean`ã€`short`ã€`char`ã€`int`ã€`float`ã€`long`ã€`double`)ä»¥åŠå­—ç¬¦ä¸²å¸¸é‡ã€‚
- `final` ä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹å’Œå­—ç¬¦ä¸²å˜é‡
- å­—ç¬¦ä¸²é€šè¿‡ â€œ+â€æ‹¼æ¥å¾—åˆ°çš„å­—ç¬¦ä¸²ã€åŸºæœ¬æ•°æ®ç±»å‹ä¹‹é—´ç®—æ•°è¿ç®—ï¼ˆåŠ å‡ä¹˜é™¤ï¼‰ã€åŸºæœ¬æ•°æ®ç±»å‹çš„ä½è¿ç®—ï¼ˆ>ã€\>>> ï¼‰
**å¼•ç”¨çš„å€¼åœ¨ç¨‹åºç¼–è¯‘æœŸæ˜¯æ— æ³•ç¡®å®šçš„ï¼Œç¼–è¯‘å™¨æ— æ³•å¯¹å…¶è¿›è¡Œä¼˜åŒ–ã€‚**
å¯¹è±¡å¼•ç”¨å’Œâ€œ+â€çš„å­—ç¬¦ä¸²æ‹¼æ¥æ–¹å¼ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡ `StringBuilder` è°ƒç”¨ `append()` æ–¹æ³•å®ç°çš„ï¼Œæ‹¼æ¥å®Œæˆä¹‹åè°ƒç”¨ `toString()` å¾—åˆ°ä¸€ä¸ª `String` å¯¹è±¡ ã€‚
```java
String str4 = new StringBuilder().append(str1).append(str2).toString();
```
æˆ‘ä»¬åœ¨å¹³æ—¶å†™ä»£ç çš„æ—¶å€™ï¼Œå°½é‡é¿å…å¤šä¸ªå­—ç¬¦ä¸²å¯¹è±¡æ‹¼æ¥ï¼Œå› ä¸ºè¿™æ ·ä¼šé‡æ–°åˆ›å»ºå¯¹è±¡ã€‚å¦‚æœéœ€è¦æ”¹å˜å­—ç¬¦ä¸²çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ `StringBuilder` æˆ–è€… `StringBuffer`ã€‚
ä¸è¿‡ï¼Œå­—ç¬¦ä¸²ä½¿ç”¨ `final` å…³é”®å­—å£°æ˜ä¹‹åï¼Œå¯ä»¥è®©ç¼–è¯‘å™¨å½“åšå¸¸é‡æ¥å¤„ç†ã€‚
ç¤ºä¾‹ä»£ç ï¼š
```java
final String str1 = "str";
final String str2 = "ing";
// ä¸‹é¢ä¸¤ä¸ªè¡¨è¾¾å¼å…¶å®æ˜¯ç­‰ä»·çš„
String c = "str" + "ing";// å¸¸é‡æ± ä¸­çš„å¯¹è±¡
String d = str1 + str2; // å¸¸é‡æ± ä¸­çš„å¯¹è±¡
System.out.println(c == d);// true
```
è¢« `final` å…³é”®å­—ä¿®é¥°ä¹‹åçš„ `String` ä¼šè¢«ç¼–è¯‘å™¨å½“åšå¸¸é‡æ¥å¤„ç†ï¼Œç¼–è¯‘å™¨åœ¨ç¨‹åºç¼–è¯‘æœŸå°±å¯ä»¥ç¡®å®šå®ƒçš„å€¼ï¼Œå…¶æ•ˆæœå°±ç›¸å½“äºè®¿é—®å¸¸é‡ã€‚
å¦‚æœ ï¼Œç¼–è¯‘å™¨åœ¨è¿è¡Œæ—¶æ‰èƒ½çŸ¥é“å…¶ç¡®åˆ‡å€¼çš„è¯ï¼Œå°±æ— æ³•å¯¹å…¶ä¼˜åŒ–ã€‚
ç¤ºä¾‹ä»£ç ï¼ˆ`str2` åœ¨è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šå…¶å€¼ï¼‰ï¼š
```java
final String str1 = "str";
final String str2 = getStr();
String c = "str" + "ing";// å¸¸é‡æ± ä¸­çš„å¯¹è±¡
String d = str1 + str2; // åœ¨å †ä¸Šåˆ›å»ºçš„æ–°çš„å¯¹è±¡
System.out.println(c == d);// false
public static String getStr() {
      return "ing";
}
```
## å‚è€ƒ
- æ·±å…¥è§£æ String#internï¼š
- R å¤§ï¼ˆRednaxelaFXï¼‰å…³äºå¸¸é‡æŠ˜å çš„å›ç­”ï¼š