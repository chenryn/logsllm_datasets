the nonces are easier to infer, were crucial in the success of
our attack. Indeed, all the blocks of 5 consecutive zero bits
were located between the bit indices 129 and 250 (assuming
index 0 corresponds to the lsb). And since the elliptic curve
used in the FIDO U2F protocol has a structured order q, the
bits of q at these positions consist of large sequences of zeros
and ones.
To illustrate this, we conducted the following experiment:
for every possible bit index i ranging from 1 to 250, we ran
the attack13 with the 5-bit known blocks set at index i for all
the nonces.
The success rates of these 250 attacks is plotted in red in
Figure 13. On the same ﬁgure, the dashed blue curve corre-
sponds to the function δq, deﬁned as follows:
(cid:26) 1 if q has 5 consecutive 0s or 1s at bit position i
δq(i) =
0
otherwise
The order of the curve NIST P-256 used for our attack
contains 2 runs of 5 consecutive ones in its lower part, namely
at indices 26 and 108.14 The higher part is decomposed into
12 on the same curve and where each nonce contains a single block of 5
consecutive zero bits enclosed by two unknown parts.
13Using 60 nonces and lattice reduction algorithm BKZ with block size 25
14In fact, at index 26, the order contains a run of 6 consecutive ones. Thus
to be precise we should have said “3 runs of 5 consecutive ones at indices 26,
27 and 108”.
3 long runs of ones and zeros. The ﬁrst 2 peaks on Figure 13
exactly correspond to the two runs of ones in the lower part.
Then starting at index 128 (ﬁrst long run of ones), the success
rate reaches 100% except when the 5-bit window meets the
transitions between the runs of ones and that of zeros. The
correlation between the success rate and the bit values at
these exact locations clearly indicate that there exists a strong
correlation between δq(i) and the attack success rate for a
known block at position i.
100
50
)
%
(
e
t
a
R
s
s
e
c
c
u
S
0
2
2
1
δq
0
250
250
50
50
100
100
150
150
200
200
Known Block Index
Known Block Index
Figure 13: Comparison between the success rate of EHNP
with 60 nonces and a single known block of 5 bits at a given
bit index (in red) and δq (in blue, dashed)
To the best of our knowledge, this phenomena has not been
observed before and we believe it opens new directions of
research.
First of all, it tends to show that structured elliptic curves,
for which the order contains large sequences of zeros or ones
happen to be more vulnerable to lattice-based attacks than
unstructured elliptic curves. Interestingly enough, we already
know in other contexts that these elliptic curves are not the
best choice as far as side-channel analysis is concerned as
they require more expensive countermeasures (see e.g. [35]).
It is worth mentioning that structured elliptic curves is a very
common choice in real-world protocols (like FIDO or Bit-
coin).
At this point, we do not have any theoretical explanation
for this observation. We know that ﬁnding a short vector in a
lattice necessitates that vector to be sufﬁciently short relative
to the lattice volume (at least, this is how these lattice-based
attacks were theoretically explained in the ﬁrst place [15]).
However, we did not observe major differences in the norms
of the short vector solution or the lattice volume in the fa-
vorable15 and less favorable cases. Hence, to understand the
inﬂuence of the elliptic curve order on the difﬁculty to solve
SVP in the EHNP lattice, a deeper exploration of the inner
15the so-called favorable case is when the known block position i corre-
sponds to δq(i) = 1.
244    30th USENIX Security Symposium
USENIX Association
structure of the lattice is needed. The question remains thus
open.
We believe that a clear understanding of this surprising
behaviour might be a key to improve lattice-based attacks on
ECDSA. Indeed, if we understand the structural difference
between the favorable and the generic cases, one might be
able to adapt the lattice structure in the general case and
signiﬁcantly improve the attack success rate.
7 Attack Mitigations
Several measures can be implemented to thwart the proposed
attack, at different levels.
7.1 Hardening the NXP P5x Cryptographic
Library
Straightforward ways for hardening the NXP P5x crypto-
graphic library:
• blinding of the scalar. This does not remove the sensitive
leakage but makes the attack much harder (as shown
in [13]). For instance, by addition of a random factor
of the curve order (the bit length of the random number
should be at least half the bit length of the curve order);
• re-randomizing the table lookup of precomputed points
in the comb implementation at each new access and
hence completely remove the sensitive leakage.
7.2 Use the FIDO U2F Counter to Detect
Clones
As explained in section 8.1 of [10], the counter may be
used as a signal for detecting cloned U2F devices. Thus
if a relying party of an application protected with FIDO
U2F receives a cryptographically correct authentication
response message, but with a counter value smaller or equal
to the previous counter value recorded, it means that a clone
of the U2F device has been created and used. Then the relying
party should not validate the authentication request, and lock
the account.
This countermeasure would reduce the usability of the clone
to a unique time after giving the security key back to the le-
gitimate user. Once the clone has been used (say one month
after the attack), the account will be locked by the next access
from the legitimate user.
Note that this protection would have to be implemented by
each relying party, independently of the FIDO U2F device.
References
[1] Martin R. Albrecht and Nadia Heninger. On Bounded
Distance Decoding with Predicate: Breaking the "Lat-
tice Barrier" for the Hidden Number Problem. Cryptol-
ogy ePrint Archive, Report 2020/1540, 2020. https:
//eprint.iacr.org/2020/1540.
[2] Alejandro Cabrera Aldaya, Cesar Pereida Garcia, and
Billy Bob Brumley. From A to Z: Projective Coordinates
Leakage in the Wild. IACR Transactions on Crypto-
graphic Hardware and Embedded Systems, 2020(3):428–
453, Jun. 2020.
[3] Naomi Benger, Joop van de Pol, Nigel P. Smart, and
Yuval Yarom. "Ooh Aah... Just a Little Bit" : A Small
Amount of Side Channel Can Go a Long Way. In Lejla
Batina and Matthew Robshaw, editors, Cryptographic
Hardware and Embedded Systems - CHES 2014, Bu-
san, South Korea, September 23-26, 2014. Proceedings,
volume 8731 of LNCS, pages 75–92. Springer, 2014.
[4] Dan Boneh and Ramarathnam Venkatesan. Hardness of
Computing the Most Signiﬁcant Bits of Secret Keys in
Difﬁe-Hellman and Related Schemes. In Neal Koblitz,
editor, Advances in Cryptology — CRYPTO ’96, pages
129–142, Berlin, Heidelberg, 1996. Springer Berlin Hei-
delberg.
[5] Billy Bob Brumley and Nicola Tuveri. Remote Timing
Attacks Are Still Practical. In Vijay Atluri and Clau-
dia Díaz, editors, Computer Security - ESORICS 2011,
Leuven, Belgium, September 12-14, 2011. Proceedings,
volume 6879 of LNCS, pages 355–371. Springer, 2011.
[6] Jean-Sébastien Coron. Resistance against Differen-
tial Power Analysis for Elliptic Curve Cryptosystems.
In Çetin Kaya Koç and Christof Paar, editors, Crypto-
graphic Hardware and Embedded Systems - CHES’99,
Worcester, MA, USA, August 12-13, 1999, Proceedings,
volume 1717 of LNCS, pages 292–302. Springer, 1999.
[7] Shuqin Fan, Wenbo Wang, and Qingfeng Cheng. Attack-
ing OpenSSL Implementation of ECDSA with a Few
Signatures. In Proceedings of the 2016 ACM SIGSAC
Conference on Computer and Communications Security,
CCS ’16, page 1505–1515, New York, NY, USA, 2016.
Association for Computing Machinery.
[8] Feitian. Feitian website. https://www.ftsafe.com.
[online; accessed 1-June-2021].
[9] FIDO Alliance.
FIDO U2F Raw Message For-
mats.
https://fidoalliance.org/specs/fido-
u2f-v1.2-ps-20170411/fido-u2f-raw-message-
formats-v1.2-ps-20170411.html.
[online; ac-
cessed 1-June-2021].
[10] FIDO Alliance. Universal 2nd Factor (U2F) Overview.
https://fidoalliance.org/specs/fido-u2f-
v1.2-ps-20170411/fido-u2f-overview-v1.2-
ps-20170411.pdf. [online; accessed 1-June-2021].
USENIX Association
30th USENIX Security Symposium    245
[11] Friedrich Beck. Integrated Circuit Failure Analysis: A
Guide to Preparation Techniques. John Wiley & Sons,
1998.
[12] Google. Google Titan Key. https://cloud.google.
[online; accessed 1-
com/titan-security-key/.
June-2021].
[13] Dahmun Goudarzi, Matthieu Rivain, and Damien
Vergnaud. Lattice Attacks Against Elliptic-Curve Sig-
natures with Blinded Scalar Multiplication. In Roberto
Avanzi and Howard M. Heys, editors, Selected Areas
in Cryptography - SAC 2016, St. John’s, NL, Canada,
August 10-12, 2016, Revised Selected Papers, volume
10532 of LNCS, pages 120–139. Springer, 2016.
[14] Martin Hlavác and Tomás Rosa. Extended Hidden Num-
ber Problem and Its Cryptanalytic Applications. In Eli
Biham and Amr M. Youssef, editors, Selected Areas in
Cryptography - SAC 2006, Montreal, Canada, August
17-18, 2006 Revised Selected Papers, volume 4356 of
LNCS, pages 114–133. Springer, 2006.
[15] Nick Howgrave-Graham and Nigel P. Smart. Lattice
Attacks on Digital Signature Schemes. Des. Codes
Cryptogr., 23(3):283–290, 2001.
[16] Jan Jancar, Vladimir Sedlacek, Petr Svenda, and Marek
Sys. Minerva: The Curse of ECDSA Nonces (System-
atic Analysis of Lattice Attacks on Noisy Leakage of
IACR Transactions
Bit-Length of ECDSA Nonces).
on Cryptographic Hardware and Embedded Systems,
2020(4):281–308, 2020.
[17] Don Johnson, Alfred Menezes, and Scott Vanstone. The
elliptic curve digital signature algorithm (ECDSA). In-
ternational Journal of Information Security, 1(1):36–63,
2001.
[18] Ravi Kannan. Minkowski’s convex body theorem and
integer programming. Mathematics of Operations Re-
search, 12(3):415–440, 1987.
[19] Langer.
ICR HH 250-75.
https://www.langer-
emv.de/en/product/near-field-microprobes-
icr-hh-h-field/26/icr-hh250-75-near-field-
microprobe-0-5-mhz-to-2-ghz/105, 2019.
[on-
line; accessed 1-June-2021].
[20] Langer.
ICR HH 500-6.
https://www.langer-
emv.de/en/product/near-field-microprobes-
icr-hh-h-field/26/icr-hh500-6-near-field-
microprobe-2-mhz-to-6-ghz/108, 2019.
accessed 1-June-2021].
[online;
[21] Chae Hoon Lim and Pil Joong Lee. More Flexible Ex-
ponentiation with Precomputation. In Yvo G. Desmedt,
editor, Advances in Cryptology — CRYPTO ’94, pages
95–107, Berlin, Heidelberg, 1994. Springer Berlin Hei-
delberg.
[22] S Mangard, ME Oswald, and T Popp. Power Analysis
Attacks: Revealing the Secrets of Smart Cards. Springer,
2007. Other identiﬁer: 0387308571.
[23] Gabrielle De Micheli, Rémi Piau, and Cécile Pier-
rot. A Tale of Three Signatures: Practical Attack of
ECDSA with wNAF.
In Abderrahmane Nitaj and
Amr M. Youssef, editors, Progress in Cryptology -
AFRICACRYPT 2020, Cairo, Egypt, July 20-22, 2020,
Proceedings, volume 12174 of LNCS, pages 361–381.
Springer, 2020.
[24] Daniel Moghimi, Berk Sunar, Thomas Eisenbarth, and
Nadia Heninger. TPM-FAIL: TPM meets Timing and
Lattice Attacks. In USENIX Security 20, Boston, MA,
August 2020. USENIX Association.
[25] MOUSER. NXP A700x datasheet, secure authenti-
https://www.mouser.fr/
cation microcontroller.
datasheet/2/302/a700x_fam_sds-1187735.pdf.
[online; accessed 1-June-2021].
[26] Elke De Mulder, Michael Hutter, Mark E. Marson, and
Peter Pearson. Using Bleichenbacher’s Solution to the
Hidden Number Problem to Attack Nonce Leaks in
384-bit ECDSA: extended version. J. Cryptogr. Eng.,
4(1):33–45, 2014.
[27] NS02 Q. Nguyen and Igor E. Shparlinski. The Insecurity
of the Digital Signature Algorithm with Partially Known
Nonces. J. Cryptol., 15(3):151–176, 2002.
[28] Phong Q. Nguyen and Igor E. Shparlinski. The Insecu-
rity of the Elliptic Curve Digital Signature Algorithm
with Partially Known Nonces. Des. Codes Cryptogr.,
30(2):201–217, 2003.
FIPS 186-2, Digital Signature Standard
https://csrc.nist.gov/csrc/media/
[29] NIST.
(DSS).
publications/fips/186/2/archive/2000-01-
27/documents/fips186-2.pdf, 2001.
accessed 1-June-2021].
[online;
[30] NXP. NXP LPC11U2x datasheet, 32-bit ARM Cortex-
M0 microcontroller. https://www.nxp.com/docs/
en/data-sheet/LPC11U2X.pdf. [online; accessed 1-
June-2021].
[31] NXP. NXP SmartMX family brochure. https://www.
[on-
nxp.com/docs/en/brochure/75017515.pdf.
line; accessed 1-June-2021].
[32] Oracle.
ﬁcations