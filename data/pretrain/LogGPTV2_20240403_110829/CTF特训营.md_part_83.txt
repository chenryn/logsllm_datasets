## Page 1036
CTF特训营：技术详解、解题方法与
27.7专业调试工具
1036/1144
发发'st
公开
日
大小
图片
文档
设有与度家条件匹配的项
此电脑
视续
国文
音乐
 SYSTEM (C)
MEDIA (E)
 SOFTWARE (D
GAMES (F)
VMS (G)
型T)Project Fles (npro proj)
文夹
S）
取
图27-20MDK创建工程后的保存对话框
---
## Page 1037
CTF特训营：技术详解、解题方法与
27.7专业调试工具
1037/1144
Select Device for Target ‘Target 1.
CPU
Vendor:
STMicroelectronics
Device:
STM32F103CB
Toolset:
ARM
Search:
Description:
STM32F078VB
STMicroelectronics'STM32F1 seres ofmainstreamMCUs covers the
STM32F1Series
needs ofalargevariety fappicationsinthendustrialmedicaland
consumermarkets.Highperfomance with fist-classperipherals and
lowpower.lowvoltage operationispaired withahighlevelof
STM32F101
ntegration at accessible prices with a simple architecture and easy-to
STM32F102
Typicalapplicationsincludemotor dives andapplcation control
use tools.
STM32F103
medical and handheld equipment,industrial applicationsPLs
vertersntesndcanneslmsstmsvideoinrcomVC
STM32F103C4
and home audio equipment.
STM32F103C6
LCD paralel interface,8080/6800modes
STM32F103C8
-Timer with quadrature (ncremental) encoderinput
5VtolerantI/Os
STM32F103CB
96-bit unique ID
STM32F103R4
OK
Cancel
Help
图27-21
MDK选择CPU界面
由于之前已经下载好了对应的DevicePack，所以这里直接选择
了STM32F103CB，至于尾缀可根据需要酌情选择。选择完毕后确认，
如果是5.x版本的MDK，则会弹出如图27-22所示的窗口。
---
## Page 1038
CTF特训营：技术详解、解题方法与
27.7专业调试工具
1038/1144
ManageRun-TimeEnvironment
Software Component
Sel.
Variant
Version
Board Support
MCBSTM32E
1.0.0
CMSIS
5
CMSISDriver
Device
VI
Drivers
FileSystem
MDK-Pro
6.2.0
E
Graphics
MDK-Pro
5.26.1
Network
MDK-Pro
6.2.0
n
MDK-Pro
6.2.0
L
图27-22创建工程后弹出的窗口
这个功能是开发时才需要使用的，而我们的需求并不需要这个，
所以直接Cancel即可，到这里，就完成了工程的创建了。图27-23所
示的就是工程刚刚创建好的示意图
---
## Page 1039
CTF特训营：技术详解、解题方法与
27.7专业调试工具
1039/1144
C:\Users\Jiaheng\Desktop\test\testuvproj -μVision
File
EditView
Project FlashDebug
PeripheralsToolsSVCSWindow
Help
Project
Target1
SourceGroup1
图27-23MDK主界面
接下来，在SourceGroup1上单击右键，将我们打算分析的hex
文件加入工程，操作如图27-24所示。
---
## Page 1040
CTF特训营：技术详解、解题方法与
27.7专业调试工具
1040/1144
C:\Users\Jiaheng\Desktop\test\test.uvproj-μVision
File
Edit ViewProjectFlashDebugPeripheralsTools SVCSWindowHelp
Project
Target1
Source
AOptions for Group‘Source Group1'
Alt+F7
Add New ltem to Group‘Source Group 1'.
AddExistingFilestoGroup'SourceGroup 1'
Add Group...
Remove Group‘Source Group 1’and its Files
Manage Project ltems...
Open File
Open List File
Open Map File
Open Build Log
Rebuild all target files
Build target
F7
Translate File
Stopbuild
Show IncludeFileDependencies
图27-24为工程添加文件
在弹出的对话框中，文件类型选择AllFiles（*），然后找到我们需
要的hex即可，如果是bin文件则与之同理，如图27-25所示。
---
## Page 1041
CTF特训营：技术详解、解题方法与
27.7专业调试工具
1041/1144
文件名（N）：
confusedARM.hex
Add
文件类型（T）：
All files (*.)
Close
图27-25
选择文件类型处
单击Add按钮后，会弹出一个以“GetFileTypefor.."为标题的
窗口，直接单击OK按钮即可。至此，待调试的文件就加入工程了。
接下来，我们将完成工程的最后设置。右键单击Target1，选择
OptionsforTargetTarget1'，如图27-26所示。
C:\Users\Jiaheng\Desktop\test\test.uvproj -μVision
FileEdit ViewProjectFlashDebugPeripheralsToolsSVCSWindow
←→
Project
OptionsforTargetTarge
Alt+F7
Add New ltem to Group...
Add Existing Files to Group.
Add Group..
Remove ltem
Manage Project item..
Open File
Open List File
Open Map File
Open Build Log
Rebuild all target files
Build target
---
## Page 1042
CTF特训营：技术详解、解题方法与
27.7专业调试工具
1042/1144
图27-26工程设置的打开方法
接着会弹出如图27-27所示的Options选项卡，选中Debug选项卡
在该页面中选中左上角的UseSimulator，然后去掉选项卡下方的
LoadApplicationatStartup复选框。接下来，单击OK，关闭选项卡即
可。
 Options for Target Target 1
X
Device|Target|Output|Listing|Vser|C/C++|Asn
LinkerDebugutilities
Use Smulatr
Setings
Use:ULINK2/MECotexDebugger
Setings
Lmit Speed to Real-Time
Load Application at Startup
Run to main0
Load Applicatinat Statup
Runtomain0
Initialization File:
Initialization Flle:
Edit
Restore Debug Session Settings
Breakpoints
Toobax
Breakpoints
Toobox
Watch Windows&Perfmance Analyzer
Watch Windows
do
SystemVewer
Memory Displey
SystemVewer
CPU DLL:
DriverDLL:
Parameter
SARMCM3.DLL
SARMCM3.DLL
Dialog DLL:
Pare
Dialog DLL:
Par
DARMSTM.DLLSTM32F103CB
TARMSTM.DLL
pSTM32F103CB
OK
Cancel
Defaults
Help
图27-27
工程设置界面
最后，依次选择Debug→Start/StopDebugSession或者按Ctrl+F5
---
## Page 1043
CTF特训营：技术详解、解题方法与
27.7专业调试工具
1043/1144
启动仿真调试，进入如图27-28所示的窗口。
 C\Users\Jiaheng\Desktop\test\test.uvproj - μVision
FileEdit ViewProject Flash DebugPeripheralsTools SVCSWindowHelp
Reset_Handler
国·
Registers
Disassembly
Register
Value
→0x000000000000
MOVS
r0,
Core
0x000000020000
MOVS
r0,
R0
0x00000000
0x000000040000
MOVS
r0,
R1
0x00000000
0x00000006 0000
SAON
r0,
R2
0x00000000
0x00000008
0000
MOVS
SAON
r0,
R3
0x00000000
0x000000OA
0000
0x00000000
r0,
R4
R5
0x00000000
Ox0000000C0000
SAON
r0,
R6
0x00000000
nnnnnnnE
nnAn
Me
B7
0x00000000
R8
0x00000000
R9
0:00000000
R10
0x00000000
R11
0x:00000000
R13 (SP)
R12
0x00000000
0x:00000000
R14（IR）
000000000
-Banked
0x00000000
+
Internal
Systen
Privilege
Mode
Privileged
Stack
ISP
States
0.00000000
0
See
图27-28调试窗口
最后一步，
在底部的Command窗口中，输入load
ConfusedARM.hex，如图27-29所示，回车确认即可。
---
## Page 1044
CTF特训营：技术详解、解题方法与
27.7专业调试工具
1044/1144
ProjectRegisters
Command
>load ConfusedARM.hex
图27-29
在Command窗体输入加载命令
然后，单击左上角的RST按钮：，PC指针就会回到hex文件的
入口点，如图27-30所示。
 C:Users\Jiahe
FileEditViewProject FlashDebug PeripheralsTolsSVCSWindowHelp
|||→||课能能ResHner
Regiters
口
Disassembly
Begister
value
0x080001004806
LDR
r0,[pc,124]:80x08000110
Cor
0x080001024780
0x08000104