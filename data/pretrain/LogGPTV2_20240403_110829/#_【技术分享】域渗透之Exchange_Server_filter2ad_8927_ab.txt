SP1中使用用户邮箱导出功能，只能使用EMS进行操作。而且操作的Exchange服务器管理员必须要成为“邮箱导入导出角色”。
Exchange Server 2007 可以使用 export-Mailbox cmdlet
导出邮件分为以下几个步骤:
Step1 为用户添加导出权限
Step2 导出邮件
Step3 查看导出请求及删除导出请求
**查看角色（默认只有组织管理成员才有导入/导出权限）**
使用Get-ManagementRole cmdlet 查看组织内已创建的管理角色。
    [PS] C:Windowssystem32>Get-ManagementRole
    Name                                                        RoleType
    ----                                                        --------    Mailbox Import Export                                       MailboxImportExport
Get-ManagementRoleAssignment cmdlet 检索管理角色分配。
    [PS] C:Windowssystem32>Get-ManagementRoleAssignment -role "Mailbox Import Export" | Format-List RoleAssigneeName
    RoleAssigneeName : Organization Management
    RoleAssigneeName : Administrator
    RoleAssigneeName : admin
为用户Administrator添加邮箱导入导出角色
New-ManagementRoleAssignment cmdlet 可以将管理角色分配给管理角色组、管理角色分配策略、用户或通用安全组 (USG)。
添加角色后需要重启EMS
    [PS] C:Windowssystem32>New-ManagementRoleAssignment -Name "Import Export_Domain Admins"  `
    >>-User "Administrator" -Role "Mailbox Import Export"
    >>
    DataObject                   : Import Export_Domain Admins
    User                         : ruos.org/Users/Administrator
    AssignmentMethod             : Direct
    Identity                     : Import Export_Domain Admins
    EffectiveUserName            : Administrator
删除管理角色分配
    Remove-ManagementRoleAssignment "Import Export_Domain Admins" -Confirm:$false
    New-MailboxExportRequest cmdlet 将主邮箱或存档的内容导出到 .pst 文件。
    net share 创建“读/写权限”共享文件夹
    net share sharename$=c:share /GRANT:Everyone,FULL
将user1收件箱中的所有邮件导出到 .pst
    New-MailboxExportRequest -Mailbox user1 -IncludeFolders "#Inbox#" -FilePath 10.2.2.163maildatauser1.pst
Inbox（收件箱）、SentItems（已发送邮件）、DeletedItems（已删除邮件）、Drafts（草稿）
导出用户 Tony 在 2012 年 1 月 1 日之前收到的邮件正文中包含“公司”和“利润”的邮件。
    New-MailboxExportRequest -Mailbox Tony `-ContentFilter {(body -like "*company*") `-and (body -like "*profit*") `-and (Received -lt "01/01/2012")} `-FilePath "\SERVER01PSTFileShareTony_CompanyProfits.pst"
之后你可以将其载入到Outlook中进行查看。
查看导出请求状态
    Get-MailboxExportRequest cmdlet 可以查看使用 New-MailboxExportRequest cmdlet 启动的正在执行的导出请求的详细状态。
    [PS] C:Windowssystem32>Get-MailboxExportRequest
    Name                                           Mailbox                                        Status
    ----                                           -------                                        ------    MailboxExport                                  ruos.org/Users/a                               Completed
删除全部或部分完成的导出请求
    [PS] C:Windowssystem32>Remove-MailboxExportRequest -Identity "aMailboxExport"
删除所有状态为“已完成”的导出请求
    Get-MailboxExportRequest -Status Completed | Remove-MailboxExportRequest -Confirm:$false
或者通过ECP导出，缺点是不能过滤时间，并且管理员会收到导出完成通知。
[](https://camo.githubusercontent.com/63e61be58851a95c2897d2943264e2e82adcca82/687474703a2f2f692e696d6775722e636f6d2f4c32345249384f2e6a7067)
[](https://camo.githubusercontent.com/aabac258d39f4dc709c19087cfa4648ea242f790/687474703a2f2f692e696d6775722e636f6d2f663072496c55342e706e67)
以上介绍了如何通过EMS导出用户邮件，但是谁也不能保证你不会和管理员撞个满怀。值得庆幸的是，Exchange Server支持PowerShell远程操作。
**Exchange PowerShell**
远程 PowerShell 提供了从命令行管理 Exchange Online的方式，利人又利己。
**创建用户凭证**
    $Credential = Get-Credential
但这样会弹出凭据请求输入框，使用 PSCredential 创建非交互式登陆凭据。
    $pass = ConvertTo-SecureString "PlainTextPassword" -AsPlainText -Force$Credential = New-Object System.Management.Automation.PSCredential ("Domain01User01", $pass)
**创建登陆会话**
    $Session = New-PSSession -ConfigurationName Microsoft.Exchange `-ConnectionUri http:///PowerShell/ `-Authentication Kerberos -Credential $Credential
**导入会话**
    Import-PSSession $Session
**移除会话**
    Remove-PSSession $Session
**  
**
**Scripting with the Exchange Management Shell**
通过SHELL的方式执行脚本。
适用于： Exchange Server 2013
exchange默认根目录在 :Program FilesMicrosoftExchange ServerV15bin
执行自定义脚本
需要开启远程脚本执行权限
    Set-ExecutionPolicy RemoteSigned
    Script
    # filename:test.ps1# export to pstforeach($user in "admin","user1","user2"){New-MailboxExportRequest -Mailbox $user -ContentFilter { Received -gt "11/29/2016" } -FilePath "\192.168.6.2sharename$$user.pst"Start-Sleep -Seconds 3}
从cmd启动脚本
64位系统下存在文件系统重定向机制，powershell路径为
C:windowssysnativeWindowsPowerShellv1.0powershell.exe
    PowerShell.exe -command ". 'C:Program FilesMicrosoftExchange ServerV15binRemoteExchange.ps1'; Connect-ExchangeServer -auto; C:test.ps1"
查看角色权限
    PowerShell.exe -command ". 'C:Program FilesMicrosoftExchange ServerV15binRemoteExchange.ps1'; Connect-ExchangeServer -auto; Get-ManagementRoleAssignment -role "Mailbox Import Export""
**结束语**
Exchange和AD的紧密性使得很多Cmdlet
Reference都能达到同样的目的，比如查询用户登陆的源IP地址，我们还能通过Exchange的IIS日志来查找。但有时候遗憾的是，用户虽然在使用邮箱，工作机却没有加入域中。这种情况我们就需要配合其他信息进一步确认。
[](https://camo.githubusercontent.com/aabac258d39f4dc709c19087cfa4648ea242f790/687474703a2f2f692e696d6775722e636f6d2f663072496c55342e706e67)
**参考资料**
Microsoft Exchange Server 2013 PowerShell Cookbook