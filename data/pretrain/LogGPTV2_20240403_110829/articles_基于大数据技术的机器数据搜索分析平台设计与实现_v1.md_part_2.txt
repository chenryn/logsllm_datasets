# 查询性能测试报告

## 4.1.1 数据查询性能

### 测试数据
- **第4次查询**：20170721 -- 20170722，数据量：108,492,156条，耗时：7341ms
- **第5次查询**：20170721 -- 20170722，数据量：108,492,156条，耗时：7329ms
- **第6次查询**：20170720 -- 20170722，数据量：135,446,082条，耗时：9927ms，平均耗时：10016.4ms
- **第7次查询**：20170720 -- 20170722，数据量：135,446,082条，耗时：10027ms
- **第8次查询**：20170720 -- 20170722，数据量：135,446,082条，耗时：10009ms
- **第9次查询**：20170720 -- 20170722，数据量：135,446,082条，耗时：10013ms
- **第10次查询**：20170720 -- 20170722，数据量：135,446,082条，耗时：10106ms
- **第11次查询**：20170722 -- 20170723，数据量：1,000,020条，耗时：974ms，平均耗时：1033.6ms
- **第12次查询**：20170722 -- 20170723，数据量：1,000,020条，耗时：1123ms
- **第13次查询**：20170722 -- 20170723，数据量：1,000,020条，耗时：926ms
- **第14次查询**：20170722 -- 20170723，数据量：1,000,020条，耗时：933ms
- **第15次查询**：20170722 -- 20170723，数据量：1,000,020条，耗时：1212ms

### 分析
查询耗时主要受数据量的影响，随着数据量的增加，查询耗时呈线性增长。

### 全天数据查询结果
![](media/image3.png){width="5.775in" height="1.0541666666666667in"}

### 返回时长
![](media/image4.png){width="5.770138888888889in" height="0.7548611111111111in"}

## 4.1.2 统计值查询

### 关注点
- 返回结果时间

### 测试方法
在查询界面全局时间内进行统计查询，使用 `* | stats count() by tag` 语句，观察查询消耗时间。预计2.5亿数据的查询返回时间应在8秒以内。

### 测试数据
- **第1次查询**：20170721 -- 20170722，数据量：108,492,156条，耗时：6352ms，平均耗时：6392.4ms
- **第2次查询**：20170721 -- 20170722，数据量：108,492,156条，耗时：6582ms
- **第3次查询**：20170721 -- 20170722，数据量：108,492,156条，耗时：6369ms
- **第4次查询**：20170721 -- 20170722，数据量：108,492,156条，耗时：6290ms
- **第5次查询**：20170721 -- 20170722，数据量：108,492,156条，耗时：6342ms
- **第6次查询**：20170720 -- 20170722，数据量：135,446,082条，耗时：9061ms，平均耗时：9001.6ms
- **第7次查询**：20170720 -- 20170722，数据量：135,446,082条，耗时：8845ms
- **第8次查询**：20170720 -- 20170722，数据量：135,446,082条，耗时：9159ms
- **第9次查询**：20170720 -- 20170722，数据量：135,446,082条，耗时：8754ms
- **第10次查询**：20170720 -- 20170722，数据量：135,446,082条，耗时：9189ms
- **第11次查询**：20170722 -- 20170723，数据量：1,000,020条，耗时：879ms，平均耗时：985.4ms
- **第12次查询**：20170722 -- 20170723，数据量：1,000,020条，耗时：1023ms
- **第13次查询**：20170722 -- 20170723，数据量：1,000,020条，耗时：925ms
- **第14次查询**：20170722 -- 20170723，数据量：1,000,020条，耗时：895ms
- **第15次查询**：20170722 -- 20170723，数据量：1,000,020条，耗时：1205ms

### 全天数据统计查询结果
![](media/image5.png){width="5.775in" height="1.09375in"}

### 返回时长
![](media/image6.png){width="5.771527777777778in" height="0.6590277777777778in"}

### 定量查询
- **测试方法**：在指定时间内进行查询，每次递增100万条数据，观察查询消耗时间。
- **查询语句**：`* | limit 1000000`

#### 测试数据
| 场景编号 | 场景描述         | 查询语句       | 索引时间范围     | 数据总量 | 平均耗时(单位:ms) |
|----------|------------------|----------------|------------------|----------|--------------------|
| 1.8      | 查询测试 - 定量查询 | * \| limit 1000000 | 20170809--20170810 | 1000000  | 1327.6             |
|          |                  |                |                  | 2000000  | 1423               |
|          |                  |                |                  | 3000000  | 1486.8             |
|          |                  |                |                  | 4000000  | 1569.2             |
|          |                  |                |                  | 5000000  | 1767.6             |
|          |                  |                |                  | 6000000  | 1828.4             |
|          |                  |                |                  | 7000000  | 1930.6             |
|          |                  |                |                  | 8000000  | 1940.8             |
|          |                  |                |                  | 9000000  | 1974.8             |
|          |                  |                |                  | 10000000 | 2018.8             |

### 测试结论
定量查询的返回结果时间随数据总量的增加呈线性增长。

## 4.2 指标采集能力试验

- **客户端配置**：开启3个进程，每个进程48个线程。
- **测试方法**：每个线程循环读取Apache日志，共7,000,000条，同步发送到broker，每条请求包含5000条数据。另起一个脚本监控集群的文档量，每3秒统计瞬时速度，并长期统计平均速度。

## 4.3 测试结果

- **总耗时**：2000秒
- **总数据量**：约15亿条
- **索引瞬时速度**：最大832,971 doc/s，最小617,703 doc/s
- **CPU使用率**：瞬时速度最大时单进程CPU使用率约为2300%，最小时约为1600%
- **平均速度**：725,000 doc/s
- **索引延时**：最小592ms，最大2200ms

### 性能指标
- 单个集群可搜索和统计的数据量达到数万亿条，索引大小达到2PB
- 单集群最多支持数千个业务数据实时接入
- 单集群支持的统计指标达到数万个
- 每秒吞吐量达到1000万条，峰值可达2000万条
- 索引大小为60GB时，查询时延为100ms
- 索引膨胀系数：1.69；带Replica的膨胀系数：3.4

# 结语
利用大数据技术建立机器数据搜索分析平台是电力行业运维工作的发展方向。未来还需结合电力行业数据，通过数据分析进一步研究，积累经验，完善设计方案，充分挖掘数据价值，提升运维工作效率。

# 参考文献
1. 吴秋莉. 智能电网海量数据实时搜索技术研究 [J]. 电力信息与通信技术, 2016,12.
2. 刘卫昌, 马增良. 企业综合自动化系统中实时数据库系统设计 [J]. 计算机应用研究, 2005, 22(8): 146-149.
3. 田保军, 秦昊. 实时数据存储管理的研究与设计 [J]. 内蒙古工业大学学报(自然科学版), 2010, 29(3): 180-181.
4. 王鹏, 张利. 大数据处理系统的研究进展与展望 [J]. 高技术通讯, 2015(Z1).
5. 顾荣. 大数据处理技术与系统研究 [D]. 南京：南京大学, 2016.