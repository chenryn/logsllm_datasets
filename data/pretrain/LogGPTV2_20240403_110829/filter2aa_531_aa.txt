# 绕过所有Web应用防火墙

## 目录
1. 介绍
2. 什么是WAF
3. 为什么需要WAF
4. WAF的作用
5. 如何绕过WAF
6. 问答环节

## 介绍
近年来，许多企业逐渐意识到传统的安全设备无法有效防御针对Web应用程序的攻击。因此，越来越多的企业开始部署“Web Application Firewall”（以下简称WAF）。本主题旨在强调：WAF并不是万能药，并不具备100%的防御能力。如果配置不当，WAF的存在可能形同虚设。

### 关于我
- **姓名**：OuTian
- **发音**：会念的人叫我“ㄠˋ ㄊㄧㄢ”，不会念的人可以叫我“黑糖”、“凹臀”或“熬汤”
- **现任职务**：敦阳科技 资安服务处 资安顾问
- **经历**：
  - HIT2007 – “Implementation of Web Application Firewall”
  - HIT2007/2008 0day Advisory
- **专长**：
  - 渗透测试、资安设备布署
  - DDoS攻击与防护、资安事件紧急应变

## 什么是WAF
WAF是一种网络安全设备，它能够深入解析HTTP、HTML和XML内容，处理客户端与Web服务器之间的传输数据，以防御针对动态网页应用程序的攻击，并防止敏感信息泄露。WAF可以是硬件设备或软件程序。

### 台湾地区主要WAF供应商
- **AppliCure** - dotDefender
- **Armorize** - SmartWAF
- **Barracuda** - Web Application Controller
- **Cisco** - ACE
- **Citrix** - NetScaler
- **F5** - Big-IP / ASM
- **Imperva** - SecureSphere
- **Radware** - AppWall

### 全球主要WAF供应商
- BeeWare
- BinarySEC
- Breach / ModSecurity
- Deny All
- Visonys

## 常见Web应用程序弱点
### 过滤不当
- **SQL注入**：窃取资料、入侵网站
- **跨站脚本 (XSS)**：利用网站漏洞窃取其他用户资料
- **任意文件包含**：入侵网站
- **代码/命令注入**：入侵网站
- **目录遍历**：浏览敏感信息档案
- **缓冲区溢出**：入侵网站主机

### 逻辑设计不良
- **Cookie中毒**：变换身份、提升权限
- **参数篡改**：修改参数导致应用程序出现不可预期的行为
- **上传文件处理不当**：植入网站木马
- **信息泄露**：暴露网站信息
- **弱认证机制**：脆弱的认证机制

## WAF vs. IDP/IPS
### 网页防火墙
- **正向安全模型**：白名单
- **行为模式分析**
- **SSL封包解析**：通过密钥/证书解析
- **追踪表单/Cookie**

### 入侵检测系统
- **负向安全模型**：黑名单
- **特征码识别**
- **无法解析SSL封包**
- **不追踪表单/Cookie**

## WAF的功能
### 输入验证
- **协议**：HTTP方法、头部等
- **URL**：强制浏览、配置文件等
- **参数**：SQL注入、XSS等
- **Cookie/Session**：会话劫持、Cookie中毒等

### 输出检查
- **协议**：响应头等
- **头部**：特定头部删除或修改
- **错误信息**：数据库错误、服务器错误等
- **敏感信息**：信用卡号、个人资料等

## 如何绕过WAF
### 简单技术
- **大小写转换**：多数WAF忽略大小写
- **转义字符**：某些情况下，`a = \a`
- **URL编码**：多数WAF先进行URL解码再检查

### 负向模型
- **魔术百分比**：使用特殊字符组合
- **HTTP参数污染**：插入多个相同参数
- **特殊检查**：利用特定语法或结构

### 正向模型
- **绕过条件**：满足特定条件后绕过

通过这些技术和方法，攻击者可以在一定程度上绕过WAF的防护。然而，这并不意味着WAF完全无效。合理的配置和定期更新规则库仍然是防范攻击的重要手段。

## 问答环节
欢迎提问！