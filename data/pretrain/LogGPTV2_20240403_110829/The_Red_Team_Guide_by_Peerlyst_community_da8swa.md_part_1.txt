> THE
>
> **RED**
>
> **TEAM**
>
> GUIDE
![](media/image1.jpeg)
> A practical guide for Red Teams and Offensive Security
PEERLYST
> [WWW.PEERLYST.COM](http://WWW.PEERLYST.COM/)
>
> 
>
> The Red Team Guide
>
> Authors:
-   **[Ian
    Barwise](https://www.peerlyst.com/users/ian-barwise-m-s-cissp-ceh-cnda)**
    \@z3roTrust
-   ### Chiheb Chebbi
-   [**Hamza M\'hirsi**](https://www.peerlyst.com/users/hamza-m-hirsi)
-   [**Haythem
    Arfaoui**](https://www.peerlyst.com/users/haythem-arfaoui)
-   [**Shailesh
    Rangari**](https://www.peerlyst.com/users/shailesh-rangari)
-   **Mike Art Rebultan**
-   **Mohamed Marrouchi**
-   **Elyes Chemengui**
-   **Wael belasker**
-   **Karim Hassan**
-   **Tony Kelly** \@infosectdk
> Reviewers and editors
-   ### David Frazer
-   **Alex Miller**
#### Disclaimer
> *All information on the tools and techniques within this eBook are
> strictly for educational purposes only, designed to aid and train Red
> Team participants in authorised and sanctioned vulnerability and
> penetration tests. Abuse and illegal activity actioned using the
> information found herein is strictly prohibited, and may result in
> penalties, fines and legal action.*
>
> *Peerlyst, its associates and the contributors to this eBook stress
> that none of the information within be used illegally and take no
> responsibility for the misuse and abuse of its contents, nor for the
> consequences of such action.*
>
> *When conducting any form of invasive testing, always protect yourself
> with a proper
> [contract](https://itsecurity.uiowa.edu/sites/itsecurity.uiowa.edu/files/wysiwyg_uploads/penetrationtestingagreement.pdf)
> that is signed by the target company/entity/individual allowing you
> permission to "hack" their organization for the purposes of
> pentesting/vulnerability assessment that contains the scope of the
> operation.*
>
> *Exercise due caution accordingly. You have been warned!*
## Table of Content
**Chapter** 1: Red Teaming and Red Teams Overview 6
**Chapter 2:** Phase 1: Open-Source Intelligence (OSINT) Reconnaissance
11
> **Chapter 3:** Phase 2: Enumeration 27
>
> **Chapter 4:** Phase 2a: External Recon 33
>
> **Chapter 5:** Phase 2b: Internal Recon 56
**Chapter 6:** Social Engineering Attacks (Spear phishing) 64
**Chapter 7:** Bypassing Windows User Account Control (UAC) 72
> **Chapter 8:** Powershell For Red Teams 82
>
> **Chapter 9:** Lateral Movement 92
>
> **Chapter 10:** Network Domination & Persistence 113
>
> **Chapter 11:** Evasion & Obfuscation Techniques 135
>
> **Chapter 12:** Data Exfiltration 147
>
> **Chapter 13:** Attacking Linux/Unix Environments 162
>
> **Chapter 14:** Attacking ICS/SCADA 192
>
> **Chapter 15:** Privilege Escalation 199
>
> **Chapter 16:** Virtualization Attacks 227
>
> **Further Reading** 239
>
> Chapter 1
>
> **Red Teaming and Red Teams Overview**
>
> Contributor: Tony Kelly \@infosectdk
### What is a Red Team, and where did it come from?
The origins of Red Teams are military in origin. It was realised that to
better defend there was a need to
[attack](https://www.peerlyst.com/tags/attack) your own defences to find
weak points that could then be defended better. This morphed into "War
Games" where defenders or friendly forces were denoted as BLUE and the
opposing forces were RED.
Red Teaming was seen as a useful
[tool](https://www.peerlyst.com/tags/tool) for generals to evaluate
their security posture, Red Team therefore took on the role of the
aggressors or "bad guys". The bad guys do not follow the rules but
utilized in a controlled way simulating and emulating what the bad guys
can do, Red Teaming serves to help the defenders spot, respond and stop
attacks as well as strengthen and improve.
Moving forwards to the information security realm, first and foremost,
despite their "offensive" nature, Red Team are defenders. They are also
a tool to allow organisations to better defend from hostile aggressors,
learn and improve.
#### Attack is the secret of defence; defence is the planning of an attack
> The Art of War, Sun Tzu
To better defend therefore you need to know how to attack and to stop
that attack.
Red Teaming is what most refer to as Penetration Testing. In the realm
of Information Security, Red Teaming or offensive security
[testing](https://www.peerlyst.com/tags/testing) is seen as essential in
testing the security posture of organisations. Typically, many
organisations employ Blue Team or defenders and only test their defences
once a year for compliance purposes. This way of thinking can leave
organisations vulnerable to attack. To challenge and evaluate their
posture, organisations can conduct their own testing, either with a
dedicated in-house red team function or buying in external expertise and
acting on that expertise.
So, what is the difference between Blue Team and Red Team?
Blue Teams are defenders, typically members of a SOC, they will
[monitor](https://www.peerlyst.com/tags/monitor) and look for threats,
they will then act on threats, in a way they are reactive in nature,
they are waiting for things to happen.
Red Teams are proactive, will simulate real attackers and will attempt
to penetrate defences undetected. Their role is to highlight holes in
defences and to improve detection capabilities for Blue Team.
Blue Team for example may use vulnerability scanning and testing to look
for and review patch management, depending on the organisation in
question the holes may be flagged as hypothetical *"hey this bad thing
could happen if we don\'t patch"* and not be taken seriously. Red Team
however will also use this approach in assessments, but instead take
this a stage further, they will demonstrate how the vulnerabilities
discovered can be exploited, and will exploit these and provide evidence
of success. Combined with a report detailing the vulnerability, its risk
score,
likelihood, and evidence of exploitation, this carries more weight and
will assist in getting things done.
Red Teams are used in two ways
-   External independent testing
-   Internal in-house team
Let us first look at how external Red Teaming may function
External independent pen testing teams can be engaged in different
capacities depending on a clients requirements, these can include but
are not limited to:
-   Physical
    -   Testing physical access to buildings, this includes to staff
        areas, infrastructure eg. heating/utilities, data centres
    -   Social Engineering/impersonation
    -   Lockpicking
    -   Security control evasion
-   Social Engineering
    -   Phishing attacks
    -   Impersonation
    -   Tailgating
    -   Drop Attack
-   Network Infrastructure
    -   Firewall bypass
    -   Router testing/configuration
    -   DNS footprinting
    -   Proxy Servers
    -   Vulnerability exploits
    -   Configuration
-   Web application compromise and exploitation -- physical and Cloud
-   Wireless
    -   Configuration
    -   Unauthorised access points
    -   Default passwords
    -   Encryption protocols
-   Application testing -- databases, - physical and Cloud
-   Operating system build standards
    -   Server
    -   Desktop
    -   Mobile
-   IOT
External pen testers may use White Box and Gray Box in their work, or in
full simulated attacks, operate in Black Box mode, this means that they
have to utilise their skills and knowledge to penetrate the defences as
an external attacker with minimal information, in these scenarios they
will utilise all the above methods and more to achieve their goal.
For compliance exercises, they may need to follow a scope of engagement
testing specific things. For example they may try to elevate to gain
Domain Admin rights, test workstation/server builds, check for
[patching](https://www.peerlyst.com/tags/patching), password cracking
and Firewall rule checks.
An in-house team may sit alongside the Blue team, and may work closely
with them, or they could operate in their own department, for example
Audit, and operate in an independent guise to provide probity in their
activities. In this role they may test existing defences, audit/check
logs, assess published vulnerabilities and test and evaluate their risk
and threat against their infrastructure. The internal in-house team will
have an added advantage in that they will know
the infrastructure of the organisation already, whilst independent
testers may or may not depending on the scope of the engagement.
On some occasions there can also be war games. Red vs Blue. These can
come in different forms depending on the scope of the exercise, and the
objectives being sought.
Red could be an external attacker tasked with a Black Box deployment
with minimal information and tasked with penetrating the company from
the outside and exfiltrate with specific target data. Such an exercise
is as real as it gets to simulating a real-world attack from real threat
actors.
Some consideration needs to be given to the value that can be gained
from this exercise.
An example would be if the Red Team were using social engineering and
other methods to penetrate the premises, their value to the Blue Team in
evaluation of their network defences would count for zero if the Red
Team were rumbled by a physical security
[guard](https://www.peerlyst.com/tags/physical-security) at the very
first stage. The element of surprise would also be lost, therefore the
value in a Red team exercise can be lost if the exercise is ended
prematurely.
This does depend on the business of the organisation in question. A
company that deals with defence data and high value IP may seriously
want to consider its physical security, however this could be tested as
a separate exercise, the hypothetical "what if" question can then be
asked if the attackers are then on site as a different deployment.
These deployments can take two directions -- the Blue Team are aware of
these interlopers and what their intended targets are -- so they can
monitor and attempt to stop them, or the Blue Team are not aware of the
exercise. This provides a realistic demonstration of what malicious
insider threats could do.
Such exercises provide good testing scenarios testing for Incident
response.
Whilst the Blue Team can feel an element of wounded pride if they are
beaten by Red, these are important lessons learned exercise.
In security we have the stop the bad guys 100% of the time, while the
bad guys only have to succeed once. The pressure is therefore on Blue to
succeed in detection. Red plays a pivotal role in assisting Blue in the
process of improving their processes and detections.
> Chapter 2
>
> **Open-Source Intelligence (OSINT) Reconnaissance**
>
> Contributor: Ian Barwise
Whoa, slow your roll cowboy! Before we can get to the s*hell-poppin'*
'*make sexy-time'* (joke, laugh) hacking adventures that Red Teams have
come to be known for, there is some homework to be done. A professional
pentester never goes into a job without first studying or doing
'homework' on their target. A critical first step, gathering information
about a particular target, within the scope of the operation, allows an
attacker to find potential vulnerabilities and weaknesses in an
organization's defense system that may be exploitable; be they physical,
social engineering, logical, or a combination of all three. Information
is the new exchange commodity and as such, there is literally a plethora
of information about almost any subject freely available on the
Internet. So what exactly does OSINT mean?
> *Open-source intelligence (OSINT) is using **publicly available**
> sources to collect information (i.e., intelligence) about persons or
> entities from a wide array of sources including the Internet.*
OSINT is usually performed during the Reconnaissance phase of hacking,
and information collected from this phase is carried over into the
Network Enumeration phase. Due to the vast amount of information
available on the web, attackers must have a clear and defined search
[framework](https://osintframework.com/), as well as a wide array of
OSINT collection tools to facilitate processing the data; otherwise they
risk getting lost in the overwhelming sea of information. OSINT
reconnaissance can be further broken down into the following five
sub-phases:
> ![](media/image4.jpeg)*Phases of the OSINT Process; image courtesy of
> [OSINT PROCESS]{.underline}*
-   **Source Identification**: during this initial phase, the attacker
    identifies potential information sources. Sources are internally
    documented throughout the process in detailed notes to come back to
    later if necessary.
-   **Data Harvesting**: in this phase the attacker collects and
    harvests information from the selected sources and other sources
    that are discovered throughout this phase.
-   **Data Processing and Integration**:
-   **Data Analysis**: here, the attacker performs analysis of the
    processed information using OSINT tools.
-   **Results Delivery:** in the final phase the findings are
    presented/reported to other members of the Red Team.
## OSINT Tools
There are a plethora of OSINT tools available, some of which are free
and others can cost a pretty penny. While it is outside the scope of
this chapter to cover *every single* OSINT tool, we will cover a few of
the more popular tools that you may find useful for Red Team operations.
Performing OSINT is about taking the little bits and pieces of
information that you are able to extrapolate about a particular person
or entity and running that information through OSINT tools to see what
more can be discovered.
Google Searching & Dorking
As an example, let's say you have been hired to pentest a company called
Exploration Media Group; you perform a Google search that returns the
following website domain name in the top results: