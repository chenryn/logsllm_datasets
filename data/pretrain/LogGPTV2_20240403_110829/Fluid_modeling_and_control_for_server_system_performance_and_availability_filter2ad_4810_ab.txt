Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 05:35:50 UTC from IEEE Xplore.  Restrictions apply. 
Figure1.ImpactofMPLonperformanceFigure2.ImpactofMPLonavailabilitystateofserversintermsofperformanceandavailability.Roughlyspeaking,ﬂuidapproximationconsistsinlookingatallthestatevariablesofthesystem-thataremostintegers-asrealvariablesinR.Thisenablestowritetheinﬁnitesimalvariationofcharacteristicstatevariablesofthesystemwithrespecttotime.Thosevariationscanbeseenasﬂuidﬂows,e.g.clientrequestﬂowsinthepresentcase;andarequestqueueontheserverissimilartoaﬂuidtank[1].Themodelisthereforebuiltasasetofdifferentialequations-asformostphysicalsystemsinmechanics,physics,electricity,etc.-thatdescribethetimeevolutionofstatevariables.Inthepresentcase,weidentifythreestatevariablesthatdescribeandhaveanimpactonserverperformanceandavailability,namelythecurrentnumberofconcurrentclientrequestsintheserverNe,theserverthroughputToandtheclientrequestabandonrateα.Statevariablesareusuallyinﬂuencedbythemselvesandbyinputvariables.Theinputsoftheproposedmodelare:theserverworkloadamountNandworkloadmixMexogenousinputs,andtheserverMPLtunableparameterthatcanbeusedtocontroltheadmissiontotheserver.Inadditiontoinputandstatevariables,themodelhasoutputvariablessuchastheaveragelatencyLtoprocessaclientrequestontheserver.Inthefollowing,wedescribetheproposedﬂuidmodelthroughtheformulasofitsstateandoutputvariables.AmongtheNconcurrentclientsthattrytoconnecttoaserver,admissioncontrolauthorizesNeconcurrentclientstoactuallyentertheserver,with0≤Ne≤Nand0≤Ne≤MPL.Letcr(t,t+dt)bethenumberofclientconnectionscreatedontheserverbetweentandt+dt,andcl(t,t+dt)bethenumberofclientconnectionsclosedontheserverbetweentandt+dt.Thus,abalanceonNebetweentandt+dtgivesNe(t+dt)=Ne(t)+cr(t,t+dt)−cl(t,t+dt)(1)LetTibetheincomingthroughputoftheserver,measuredasthenumberofclientconnectiondemandspersecond.Itcomesthatthenumberofconnectionscreatedbetweentandt+dtiscr(t,t+dt)=(1−α(t+dt))·Ti(t+dt)·dt(2)whereαistheabandonrateoftheserver.Similarly,letTobetheoutgoingthroughputoftheserver,measuredasthenumberofclientrequestsaserverisabletohandlepersecond.Thus,thenumberofconnectionsclosedbetweentandt+dtiscl(t,t+dt)=To(t+dt)·dt(3)Derivingfrom(1),(2)and(3),wehave˙Ne,thederivativeofNe˙Ne(t)=(1−α(t))·Ti(t)−To(t)(4)Moreover,weassumethatthesystemreachesasteadystateinareasonablyshortperiodoftime∆;thisispartic-ularlyreﬂectedinstatevariablesoutgoingthroughputToandabandonrateα.Duringthisshortperiodoftime,thework-loadisrelativelystable,whichisconsistentwithstudiessuchas[4].Thus,thedynamicsofToandαcanbeapproximatedbyﬁrstordersystemsthroughtheirderivativesasfollows˙To(t)=−1∆(cid:0)To(t)−¯To(cid:1)˙α(t)=−1∆(α(t)−¯α)where¯Toand¯αarethesteadystatevaluesofrespectivelytheoutgoingthroughputandtheabandonrateoftheserver.Thenextstepnaturallyconsistsinﬁndingtheexpressionof¯Toand¯α.Abalanceonthenumberofservedclientrequests(oroutgoingrequests)NogivesNo(t+dt)=No(t)+sr(t,t+dt)wheresr(t,t+dt)isthenumberofservedrequestbetweentandt+dt.SincethereareNeconcurrentclientsontheserverandtheaverageclientrequestlatencyisL,thenumberofservedrequestsduringdtwillbesr(t,t+dt)=dtLNe.Thus,weget˙No=NeL,thatis¯To=NeLwhichisanexpres-sionofLittle’slaw[17].Bydeﬁnition,¯αisequaltozeroifNeissmallerthanMPL,and¯αisequalto1−ToTiifNe=MPL(seeFigure3,978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
392
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 05:35:50 UTC from IEEE Xplore.  Restrictions apply. 
Figure3.Accuracyofmodeledabandonratenaivemodel).However,thestochasticnatureoftheclientre-questarrivalmayleadtosituationswherethemeasuredaver-ageNeissmallerthanMPLbutwherepunctually,thenum-berofclientsthattrytoaccesstheserverisactuallyhigherthanMPL,andthus,someclientsarerejected.Thisisillus-tratedinFigure3whichcomparestheactualmeasuredaban-donratewiththenaiveestimationoftheabandonrate,show-ingamismatchbetweenthetwo2.Inordertotakethisbehav-iorintoaccount,wechoosetowrite¯α=NeMPL·(cid:16)1−ToTi(cid:17).ThisrendersthattheprobabilitytorejectaclientconnectionishigherwhentheaverageNeisclosetoMPL.Figure3showsthatthisimprovedmethodprovidesamoreaccurateestimationoftheabandonrate.Finally,itfollowsthat˙To(t)=−1∆(cid:18)To(t)−Ne(t)L(t)(cid:19)(5)˙α(t)=−1∆(cid:18)α(t)−Ne(t)MPL(t)·(cid:18)1−To(t)Ti(t)(cid:19)(cid:19)(6)Nowthatwehavedeﬁnedthemodelstatevariables,thelaststepconsistsinexpressingthemodeloutputvariablela-tencyL.Latencyobviouslydependsonthegloballoadoftheserver,i.e.theworkloadmixMandthenumberofconcurrentclientsontheserverNe.Figure4describestheevolutionoflatencyLasafunctionofNe,foragivenworkloadmix2.OnecanseethataseconddegreepolynomialinNeisagoodapproximationofthelatencyL.Thus:L(Ne,M,t)=a(M,t)N2e+b(M,t)Ne+c(M,t)(7)Theparametercispositiveasitrepresentsthezero-loadla-tency.aandbarealsopositivesincetheymodeltheprocess-ingtimeofrequests.Insummary,theproposedﬂuidmodelisgivenbyequa-tions(4)to(7)thatreﬂectthedynamicsofthestateandout-putsofserversystemsintermsofperformanceandavailabil-ity.Section4thendescribestheproposedcontroltechniques2DetailsontheunderlyingexperimentaltestbedaregiveninSec-tion5.1.Figure4.LatencyasafunctionofNethatbuildupontheﬂuidmodelinordertoguarantyserviceperformanceandavailabilitylevelobjectives.4ControlofServerSystemsInthefollowing,westudythetradeoffbetweentheper-formanceandtheavailabilityofserversystems,andderivetheoptimaladmissioncontrolofserversystemsbasedontheproposedﬂuidmodel,thatistheoptimalnumberofcon-currentclientsadmittedtotheserverwithrespecttothistradeoff.Inparticular,weprovidetwovariantsofcontrollaws,namelyAM-CandPM-C.AM-Cisanavailability-maximizingoptimalserveradmissioncontrolthatachievesthehighestserviceavailabilitygivenaﬁxedperformancecon-straint.Symmetrically,PM-Cisaperformance-maximizingoptimalserveradmissioncontrolthatmeetsadesiredavail-abilitytargetwiththehighestperformance.Inthepresentcase,serviceavailabilityismeasuredastheclientrequestac-ceptationrate(i.e.1-α),andserviceperformanceismea-suredastheaverageclientrequestlatency(i.e.L).4.1AM-Cavailability-maximizingcontrolAM-Caimsatguarantyingatradeoffbetweenserverper-formanceandavailabilitywiththefollowingproperties:(P1)theaverageclientrequestlatencydoesnotexceedamax-imumlatencyLmax,and(P2)theabandonrateαismadeassmallaspossible.Tothatend,afeedbackcontrollawisproposedtoautomat-icallyadjusttheMPLserveradmissioncontrolparameterinordertosatisfythistradeoff.ThebasicideabehindthislawistoadmitclientsinsuchawaythattheaverageclientrequestlatencyLisclose(equal)toLmax.Byconstruction,thismax-imizesthenumberofadmittedclientsNe,whichinducesaminimizedabandonrateα.978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
393
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 05:35:50 UTC from IEEE Xplore.  Restrictions apply. 
AﬁrstapproachcouldconsistinsolvingEq.(7)insuchawaythatL=Lmax.Althroughaccuratelyreﬂectingthesys-tem,suchanapproachisunwieldysinceitrequirestheknowl-edgeofaccuratevaluesofparametera,bandcinequation7,throughanonlineidentiﬁcationoftheseparameterssincetheworkloadmaychangeovertime.Weproposeanotherapproachwhichavoidsthisonlineidentiﬁcationofmodel’sparameters.Itisobtainedviaasim-pleinput-outputlinearizationtechniqueinwhichtheconsid-eredoutputislatencyL[14].Roughlyspeaking,theapproachaimsatdetermininghowtocontroltheMPLvalueinsuchawaythat˙L=−γL(L−Lmax)(8)AssoonasγL>0,thiswillensuretheconvergenceofLtoitsmaximumLmax.FromEq.(7),wehave˙L=(2aNe+b)˙Ne.AndsinceToandαreachasteadystateinareasonablyshortperiodoftime,To(t)=¯Toandα(t)=¯αTherefore,withEq.(4)wehave˙L=(2aNe+b)(cid:18)1−NeMPL(cid:19)(cid:0)Ti−¯To(cid:1)(9)AsaresultfromEq.(8)and(9),MPLshouldbecon-trolledasfollowsMPL=Ne1+γL(2aNe+b)(Ti−¯To)(L−Lmax)Tofreeourselvesfromaandb,wechoosetouseγ0L=γL(2aNe+b)(Ti−¯To),whichproducesMPL=Ne1+γ0L(L−Lmax)(10)whereγ0L>0isatuningparameter.ItfollowsthatwithEq.(8)andcontroldescribedin(10),thedynamicevolutionofLisgivenby:˙L=−(cid:0)γ0L(2aNe+b)(Ti−¯To)(cid:1)(L−Lmax)Hereagain,LwillconvergetoLmax.Insummary,itisinterestingtonoticethatthefeedbackcontrollawgivenin(10)willreﬂectoneofthefollowingsitu-ations.IfthecurrentlatencyLishigherthanLmax,property(P1)isnotguaranteedandthecontrollawwillproduceanMPLasadecreasedvalueofthecurrentnumberofadmittedconcurrentclientsNe(since(1+γ0L(L−Lmax))>1),whichaimsatmeeting(P1).Symmetrically,ifLislowerthanLmax,property(P1)holdsbutproperty(P2)maynothold,andthecontrollawwillproduceanMPLasanincreasedvalueofNe(since(1+γ0L(L−Lmax))0.Furthermore,sincetheworkloadremainsrela-tivelystableduringashortperiodoftime,asstatedpreviously,˙Ne=0.Then,fromEq.(4)and(6),wegetα=1−ToTi˙α(t)=−1∆α(t)(1−Ne(t)MPL(t))(12)Thus,fromEq.(11)and(12)andwiththefollowingcontrolappliedtoMPL,αwillconvergetoαmaxMPL=αNeα+γ0α(α−αmax)(13)whereγ0α=γα∆.Insummary,theproposedadmissioncontroltechniquesre-quireauniqueexternalparameter,thatisγ.Thisparameterhasanimpactonboththeconvergencetimeofthecontrol(i.e.thenumberofiterationstoconvergetotheoptimalMPL)andthestabilityofthesystem.Indeed,withalowvalueofγ,theconvergencetimetowardtheoptimalMPLwouldbelong.Whereasifγistoohigh,thiscouldinducesystemos-cillations.Adifﬁcultpartresidesinchoosingtherightvalueofthisparameter,whichpartlydependsonthetimenecessaryfortheconsideredsystemQoScriteria(e.g.theabandonrateincaseofPM-C)toreachitssteadystate.5EvaluationThissectionﬁrstdescribestheenvironmentthatunderliesourexperiments,beforepresentingtheresultsoftheevalua-tionoftheproposedﬂuidmodelandfeedbackcontrollers.5.1ExperimentalsetupTestbedapplication.Theevaluationoftheproposedﬂuidmodelandfeedbackcontrollershasbeenconductedusing978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
394
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 05:35:50 UTC from IEEE Xplore.  Restrictions apply. 
theTPC-Cbenchmark[29].TPC-Cisanindustrystan-dardbenchmarkfromtheTransactionProcessingCouncilthatmodelsarealisticdatabaseserverapplicationasaware-housesystemwhereclientsrequesttransactionsonware-housesstoredonadatabaseserver.TPC-Ccomeswithaclientemulatorwhichemulatesasetofconcurrentclientsthatremotelysendrequeststothedatabaseserver.TheTPC-Cclientemulatorallowstospecifythenumberofconcurrentclientstolaunch(i.e.theworkloadamountN).Italsospeci-ﬁestheclientthinktime,thatistheinterarrivaltimebetweentwoconsecutiveclientrequests.Weextendedtheclientemu-latorinordertobeable,ontheonehand,tovarytheworkloadamountNovertime,andontheotherhand,tovarythework-loadmixMovertime.Forthelatterextension,weconsideredtwomixesofworkload,oneconsistingofread-onlyrequests,andanotherconsistingofread-writerequests.Softwareandhardwareenvironment.Ourexperimentshavebeenconductedonasetoftwocomputersconnectedviaa100Mb/sEthernetLAN,onecomputerdedicatedtothedatabaseserverandanothertotheclientemulator.ThedatabaseserverisPostgreSQL8.2.6[23].Theproposedmodelandcontrollersweredeployedasfollows.Anon-linemonitoringofthesystemallowstomaintainthestateofthemodelandwell-knownKalmanﬁlteringtechniqueswereapplied[13].Aaproxy-basedapproachwasfollowedtoimplementtheAM-CandPM-Ccontrollerswhereaproxystandsinfrontofthedatabaseservertoimplementonlinefeedbackadmissioncontrol.Inthefollowingexperi-ments,AM-CandPM-Cwereinitializedwithrespectivelyγ=0.1andγ=0.3.BothclientandservermachinesrunLinuxFedora7.Theservermachineisa3GHzprocessorwith2GBRAM,whiletheclients’computerisa2GHzpro-cessorwith512MBRAM.5.2ModelvalidationWeperformmeasurementstovalidatetheaccuracyoftheproposedﬂuidmodelanditsabilitytorenderthedynamicsofthesystem.Inparticular,weevaluatetheabilityofthemodeltoreﬂectthevariationofthestateofthesystemwheninputvariablessuchastheserverMPLandtheworkloadamountNvary.ThevariationofthestateofthesystemisdescribedbythestatevariablesNeforthenumberofconcurrentclientsadmittedintheserver,Tofortheoutgoingthroughputoftheserver,andαfortheclientrequestabandonrate.Thus,forthesamesetofinputvariables,thestatereiﬁedbythemodeliscomparedwiththeactualstateoftherealsystem.Figure5illustratesthecaseofadynamicopenloopsys-temwhereboththeworkloadamountNandtheserverMPLvaryovertime(seeFigure5(a)).Figures5(b),5(c)and5(d)presenttheevolutionovertimeofrespectivelythenumberNeofconcurrentclientsadmittedintheserver,theoutgoingthroughputToandtheabandonrateα,forboththerealsystem(a)VaryingMPLandworkloadamount(b)Admittedconcurrentclients(c)Throughput(d)AbandonrateFigure5.SystembehaviorwithvaryingMPLandworkloadamount–Realsystem(+)vs.modeledsystem(solidline)978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
395