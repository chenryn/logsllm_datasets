Digesting an Open-Source
Fair-Use TPC-E Implementation:
DBT-5
Mark Wong
Rilson Nascimento
2007-May, Ottawa
PGCon 2007
Introductions
Mark Wong
Database Performance specialist
Previously worked at OSDL (presently, Linux Foundation)
Rilson Nascimento
MSc Candidate in the Federal University of Pernambuco,
Brazil
Previously worked at Itautec Performance Lab
2
Table of Contents
TPC-E Overview
Workload Architecture
Experimental Results
Research
Future Work
3
Question Policy
Interrupt us if something is unclear
Keep long generic questions to the end
Approach us during the conference
Write us
PI:EMAIL
PI:EMAIL
4
Why TPC-E?
http://www.tpc.org/tpce/spec/TPCEpresentation.ppt
TPC-C is over 14 years old
Not practical to modify existing workload
Transaction are too lightweight by today's standards
CPU performance grew according to Moore's Law
Disk latency did not
Reduce cost/complexity of running benchmark
Encourage DB uses which is more representative of what
customer do
5
TPC-E vs. DBT-5
TPC-E is a benchmarking specification for generating
marketing collateral
DBT-5 a test kit to help improve PostgreSQL
6
TPC-E Overview
TPC-E Goals
OLTP Database-centric workload
Comparability of results
Familiar business model – easy to understand
Reduce cost of running benchmark
Enhance schema complexity
Be more representative to what customers do
7
TPC-E Overview (2)
Business Model – Financial Market
8
TPC-E Overview (3)
Business Model – Financial Market
Driver
SUT
9
TPC-E Overview (4)
Business Model – Financial Market
10
TPC-E Overview (5)
Business Model – Comparison with TPC-C
TPC-C TPC-E
Wholesale supplier Brokerage House
Organized by Organized by
Warehouses Customers
Districts Accounts
Customers Securities
Companies
11
TPC-E Overview (6)
Database Schema – Comparison with TPC-C
CC hh aa rr aa cc tt ee rr ii ss tt ii cc TT PP CC -- EE TT PP CC -- CC
TT aa bb llee ss 33 33 99
CC oo lluu mm nn ss 11 88 88 99 22
MM iinn CC oo llss // TT aa bb llee 22 33
MM aa xx CC oo llss // TT aa bb llee 22 44 22 11
DD aa tt aa TT yy pp ee CC oo uu nn tt MM aa nn yy 44
DD aa tt aa TT yy pp ee ss UU II DD ,, CC HH AA RR ,, NN UU MM ,, UU II DD ,, CC HH AA RR ,, NN UU MM ,,
DD AA TT EE ,, BB OO OO LL ,, LL OO BB DD AA TT EE
PP rr iimm aa rr yy KK ee yy ss 33 33 88
FF oo rr ee iigg nn KK ee yy ss 55 00 99
TT aa bb llee ss ww // FF oo rr ee iigg nn 22 77 77
KK ee yy ss
CC hh ee cc kk CC oo nn ss tt rr aa iinn tt ss 22 22 00
RR ee ff ee rr ee nn tt iiaa ll YY ee ss NN oo
II nn tt ee gg rr iitt yy
12
TPC-E Overview (7)
Database Tables and Scaling
C u s to m e r B ro k e r M a rk e t
A C C O U N T _ P E R M IS S IO N B R O K E R C O M P A N Y S E C T O R
C U S T O M E R C A S H _ T R A N S A C T IO N C O M P A N Y _ C O M P E T IT O R S E C U R IT Y
C U S T O M E R _ A C C O U N T C H A R G E D A IL Y _ M A R K E T
C U S T O M E R _ T A X R A T E C O M M IS S IO N _ R A T E E X C H A N G E
H O L D IN G S E T T L E M E N T F IN A N C IA L D im e n s io n
H O L D IN G _ H IS T O R Y T R A D E IN D U S T R Y A D D R E S S
H O L D IN G _ S U M M A R Y T R A D E _ H IS T O R Y L A S T _ T R A D E S T A T U S _ T Y P E
W A T C H _ IT E M T R A D E _ R E Q U E S T N E W S _ IT E M T A X R A T E
W A T C H _ L IS T T R A D E _ T Y P E N E W S _ X R E F Z IP _ C O D E
L e g e n d : F ix e d T a b le s G ro w in g T a b le s S c a lin g T a b le s
13
TPC-E Overview (8)
Transactions
14
TPC-E Overview (9)
Metrics
Performance (throughput), expressed in tpsE
Price/Performance, expressed in price/tpsE
Availability Date, when all products necessary to achieve the
stated performance will be available
15
TPC-E Overview (10)
Sample Test Configuration
16
TPC-E Overview (11)
Sample Test Configuration, Variation I
17
TPC-E Overview (12)
Sample Test Configuration, Variation II
18
TPC-E Overview (13)
Sample Test Configuration, Variation III
19
TPC-E Overview – Highlights and Benefits
Financial business model
Rich transaction set
Diverse, realistic schema
Server-centric workload with DB focus
Realistic application model
Rebalanced hardware configuration
Specification provides code where sponsor creativity is not
being tested
20
DBT-5 Architecture
21
DBT-5 Architecture - Loader
Database creation is vendor specific, but...
Database population can be vendor neutral
TPC-E includes a data generator for database loading
C++ code to generate data
Flat file generation is provided
Sponsor is free to create to customize interface
Libpqxx: C++ API for PostgreSQL
22
Experimental Results
Test bed
Processor: Intel(R) Xeon(TM) CPU 2.80GHz w/HT
Memory: 3 GB
Disk: 14 disks in hw RAID 0 (data)
Operating System: Linux 2.6.20-gentoo-r4
Database Engine: PostgreSQL 8.2.3
Database Size: 2806 MB (1000 customers, 50 ITD)
23
Experimental Results – DBT-5 Report
24
Experimental Results
Response Time (s)
Transaction % Average : 90th % Total Rollbacks %
----------------- ----- ----------------- ----------- ----------- ------
Trade Order 10.21 0.021 : 0.043 3869 38 0.99
Trade Result 9.59 0.040 : 0.083 3635 0 0.00
Trade Lookup 8.08 0.346 : 0.945 3063 0 0.00
Trade Update 1.96 0.313 : 0.677 743 0 0.00
Trade Status 19.03 0.006 : 0.010 7212 0 0.00
Customer Position 12.89 0.005 : 0.009 4885 0 0.00
Broker Volume 4.84 0.003 : 0.004 1835 0 0.00
Security Detail 14.43 0.014 : 0.018 5467 0 0.00
Market Feed 0.96 0.055 : 0.090 363 0 0.00
Market Watch 17.99 0.009 : 0.017 6817 0 0.00
Data Maintenance n/a 0.036 : 0.122 9 0 0.00
----------------- ----- ----------------- ----------- ----------- ------
2.02 trade-result transactions per second (TRTPS)
30.0 minute duration
20 total unknown errors
25
1 second(s) ramping up
Experimental Results – Response Time Plots
26
Experimental Results – System Statistics
27
Research
A scientific article portraying DBT-5 was accepted in the
27th Brazilian Computer Society Conference, that will be
held in Rio de Janeiro in June 2007
http://www.sbc.de9.ime.eb.br/en/index.php?view=wperforma
nce&from=eventos&lang=en
Rilson's Master's dissertation is employing DBT-5:
Synthesizing Representative I/O Workloads for TPC-E
28
Future Work
Update the workload to the latest TPC-E specification
EGen
Functions
Write the Functions in C (in progress)
Tune indexes/functions
Support other databases
29
Resources
DBT-5
svn co https://osdldbt.svn.sourceforge.net/svnroot/osdldbt/trunk/dbt5 dbt5
libpqxx: C++ API for PostgreSQL
http://pqxx.org/
TPC-E Specification
http://www.tpc.org/tpce/spec/TPCE-v0.32.2g.pdf (PDF)
http://www.tpc.org/tpce/spec/TPCE-v0.32.2g.doc (DOC)
30
Bibliography
TPC BENCHMARK™ E Standard Specification Version
1.0.0
TPC Site - www.tpc.org
Do Nascimento, R. O., M. Wong and P. R. M. Maciel. DBT-
5: A Fair Usage Open Source TPC-E Implementation for
Performance Evaluation of Computer Systems. XXVII
Brazilian Computer Society Conference, 2007. (to appear)
31
Thank you! :)
PI:EMAIL
PI:EMAIL
PGCon 2007, Ottawa
32