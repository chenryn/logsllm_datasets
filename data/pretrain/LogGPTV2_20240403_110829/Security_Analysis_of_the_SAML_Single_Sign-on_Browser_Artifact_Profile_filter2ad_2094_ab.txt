through a given channel with id cid
. The browser looks
up the veriﬁcation information and responds to S. Hav-
ing been convinced of the browser B’s knowledge, the
source site resolves user U’s identity idU .
(cid:1)
6. Protocol Schema
In this section we describe the protocol schema of the
SAML Single Sign-on Browser/Artifact proﬁle in detail.
We already introduced the protocol run in Section 2 and
depicted the protocol ﬂow in Figure 1.
6.1. Step 1: Contact the Source Site
TARGET=target . . . 
In the ﬁrst protocol step, browser B establishes con-
tact to source site S.
(a) B →bs cid S: ist host – GET S?
(b) S: Checks the request.
Browser B connects to the inter-site transfer URL S of S. B and S use the message transfer with
conﬁdentiality and integrity as described in Section 4.1
to send a target description target to S. In substep 1b,
source site S parses the request and initiates a new ses-
sion for it. S tries to extract a target description target
from the request’s query string.
Lack of Authentication: This connection provides no
unilateral authentication. Thus, browser B cannot nec-
essarily verify the identity of S by checking the server
certiﬁcate of S and the certiﬁcate chain to a trusted cer-
tiﬁcation authority. This lack of certiﬁcation is a corner-
stone of man-in-the-middle attacks on the communica-
tion between browser and source site (B ↔ A ↔ S). An
adversary who wants to act as man-in-the-middle at this
point only needs to break the user tracking in the subse-
quent step to succeed.
Message Format: The message sent to S is an HTTP
GET request for the path of S. It contains
the target resource target that user U wants to access
on destination site D. The SAML Single Sign-on Proﬁle
neither speciﬁes further elements of this URL nor does
it prohibit the inclusion of further elements. The proto-
col description lacks an explicit naming of protocol type
or step, which hampers the dispatching of messages to
different protocol modules. This also allows a cumula-
tion of artifacts within this URL by a malicious destina-
tion site and repetition of the protocol steps 1 to 3.
User Tracking
As source site S holds a connection to the browser at
this time, it is a canonical solution to use this connec-
tion for the user tracking. Unfortunately this connection
does not provide authentication according to the SAML
Single Sign-on Proﬁle. Therefore veriﬁcation informa-
tion cannot be bound to a certiﬁed identity. We assume
that browser B stores it by the hostname of source site
S.
(a) S →bs cid B: request for vi
(b) B →bs cid S: knowledge of vi
In the situation described a man-in-the-middle can for-
ward the communication between B and S. The two
honest parties cannot distinguish the adversary from the
Proceedings of the 19th Annual Computer Security Applications Conference (ACSAC 2003) 
1063-9527/03 $17.00 © 2003 IEEE
Authorized licensed use limited to: Tsinghua University. Downloaded on March 25,2021 at 07:49:07 UTC from IEEE Xplore.  Restrictions apply. 
intended communication partner. In general, it is a de-
sign ﬂaw that the possibility of a man-in-the-middle at-
tack is dependent on a strong user tracking. As user
tracking is unspeciﬁed in the SAML Single Sign-on pro-
tocol, we cannot assume that it is resistant against such
attacks.
6.2. Step 2: Initiating the Redirect to the Desti-
nation Site
After a successful recognition of user U, source
site S generates one or more SAML artifacts and in-
cludes them in a so-called SAML searchpart. It redirects
browser B to the artifact receiver URL D
of destination site D with the SAML searchpart as query
string.
(a) S : Determines the destination site D correspond-
ing to the target of Step 1. Looks up D in its artifact receiver table.
(b) S : Generates one or more SAML artifacts
(c) S : Generates a SAML searchpart SAM Lsp that
contains the target description and the generated ar-
tifacts.
(d) S →bs cid B :  302 i that contain its SourceIDS.
Phrase>
Location D? SAM Lsp
In substep 2a, the source site looks up the artifact re-
ceiver URL D. As the SAML Single Sign-
on protocol does not specify this procedure, we assume
that it searches for an artifact receiver URL having a
hostname equal to that of the target resource. The source
site generates a number of SAML artifacts and stores the
information that the artifacts were issued to destination
site D. As the source site does not have a certiﬁcate or
identity of D, it can only use destination site D’s host-
name or D as reference.
In this step we experience the same problems with
the message format as in Step 1. Moreover, as we can-
not rely on authentication either, the man-in-the-middle
attack between B and S is possible.
6.3. Step 3: Redirect to the Destination Site
In Step 3, browser B connects to destination site D.
B delivers the SAML artifacts to the D.
(a) B : Extracts the URL D? SAM Lsp
(b) B →bd cid D : ar host – GET D?
from the Location String of step 2 response.
SAM Lsp 
Lack of Authentication: In this protocol step we again
do not have unilateral authentication. Because the pro-
tocol does not specify short-term freshness measures or
the necessity of channel-based security, a replay attack
may be possible. An adversary can replay a message-
wise encrypted HTTP request to the D. The
lack of authentication also allows a man-in-the-middle
attack between B and D. This is critical as the SAML
Single Sign-on protocol trusts the assumption that D is
connected to browser B of user U.
6.4. Step 4: SAML Request
In step 4 the destination site establishes a secure
channel to source site S. It uses the SourceID of
the SAML artifacts received to ﬁnd the corresponding
SAML responder URL and sends a SAML request to it.
(a) D : Check that each artifact i the
(b) D : Look up S corresponding to
SAM Lsp contains the same SourceID.
SourceID
(c) Generate RequestID.
(d) D(idD) ⇒ds cid S(idS)
: sr host – SAML
request to S containing the artifacts
i
In step 4a, the destination site generates a session for
the incoming request and analyzes the URL of the re-
quest. The destination site aborts the protocol run if the
request is not intended for the D, if D can-
not parse the SAML searchpart, or if the request does not
include SAML artifacts. The destination site checks the
validity of the artifacts i in the searchpart.
All artifacts must be well formated, have a valid version
id, and contain the same non-empty SourceID. Desti-
nation site D uses this SourceID to look up the S of source site S (substep 4b). In substep 4d,
the destination site establishes a secure channel ds cid
to source site S with bilateral authentication. It sends a
SAML request with the received artifacts through this
channel.
Speciﬁcation of the Source Site Lookup: The protocol
step does not fully specify which information destina-
tion site D knows of source site S. The SAML Single
Sign-on protocol only states that destination site D can
look up S. Thus, we can assume that D can-
not look up the identity idS of S.
One-request Property of the SAML Artifact: According
to the SAML Single Sign-on protocol, SAML artifacts
can be used only once. This is enforced by the source
site in step 5, while destination site D does not store
the artifacts received. Thus, if the transfer of the SAML
Proceedings of the 19th Annual Computer Security Applications Conference (ACSAC 2003) 
1063-9527/03 $17.00 © 2003 IEEE
Authorized licensed use limited to: Tsinghua University. Downloaded on March 25,2021 at 07:49:07 UTC from IEEE Xplore.  Restrictions apply. 
artifacts to the source site fails, the artifacts are still
valid and reusable. As the SAML Single Sign-on pro-
tocol speciﬁes no resend operation upon such a failure,
it may leave free valid artifacts.
6.5. Step 5: SAML Response
In Step 5, the source site analyzes the SAML re-
quest and generates an adequate response. It sends the
response back through the channel with id ds cid gener-
ated in step 4.
(a) S : Check for artifact destination equality.
(b) S : Enforce of the one-time use of the artifacts.
(c) S : Look up or generate SAML assertions corre-
sponding to the artifacts i.
(d) S : Generate ResponseID.
(e) S(idS) ⇒ds cid D(idD) : SAML response from
S containing SSO assertions about
idU or an error code. The response references the
RequestID of the SAML request of step 4 in the
InResponseT o element.
(f) D : Verify validity of SAML response.
In substep 5a, source site S checks whether the received
artifacts were submitted from the same destination site,
to which it issued them. According to the SAML Single
Sign-on proﬁle, the source site must return a response
with no assertions if the artifacts were issued to an-
other destination site. As the source site S can only have
stored the hostname or  to which it issued
the artifacts, it will typically only compare the destina-
tion site’s hostname with the stored hostname entry. If in
substep 5b any of the artifacts have already been seen,
source site S responds with an empty response. This is
called the one-time request property of the SAML arti-
fact. Each artifact can be used only once. Then in sub-
step 5c the source site tries to determine the assertions
corresponding to the artifacts given. If one of the asser-
tions cannot be generated or looked up, S responds with
no assertions. Source site S generates a SAML response
corresponding to the request id of the request given, and
sends the SAML response back through the channel gen-
erated in step 4.
Destination site D checks the response received
checks whether
the
in
substep.
the InResponseT o element
to its own
RequestID. Then it veriﬁes the validity of the SAML
assertions. There must be at least one SAML SSO as-
sertion included in the response, and there must be
exactly one assertion for each submitted SAML arti-
fact. If these checks fail, D aborts the protocol run.
subsequent
is equal
It
Otherwise D analyzes the SAML assertions to deter-
mine U’s identity idU .
One-request Property of the SAML Artifact: The SAML
Single Sign-on protocol states a one-time usage con-
straint for the SAML artifacts: If a SAML artifact is pre-
sented to the source site again, the source site must re-
turn the same message it uses upon a query with an un-
known artifact. This property must be implemented with
care as otherwise there is the danger of race conditions
or left over valid artifacts because of protocol failures.
Multiple Services on One Host: A source site S can
only verify that it issued the artifact to the same host-
name that submitted it in step 4. If there are multiple
services on destination site D, a malicious low-security
service could use received artifacts to impersonate user
U to a high-security service. Let us consider this ex-
ample: A bank DBank hosts a stock-market analysis
toolkit stock and its e-banking application ebank on
the same host. It uses the SAML Single Sign-on for
customization of the analysis toolkit and for login to
user U’s e-banking account. A malicious stock-market
analysis tool stock
could forward the artifacts received
at DBank,stock(cid:1) to DBank,ebank
and make e-banking transactions with the permissions of
user U.
(cid:1)
6.6. Step 6: Response to the Browser
In step 6, destination site D responds to browser B’s
request. If D is convinced of user U’s identity idU , it
will present the target resource requested. Otherwise it
will typically reply with an error message.
(a) D →bd cid? B : resource page target or error mes-
sage.
Speciﬁcation of this Step: The SAML Single Sign-on
protocol does not specify step 6 precisely: It leaves un-
speciﬁed which connection to use and claims no security
properties for this connection. We assume that the des-
tination site uses the connection of step 3 identiﬁed by
bd cid to respond to the browser. We also assume that
it has the same security properties as in step 3. This as-
sumption is justiﬁed because HTTP servers normally re-
spond through the same connection through which they
received a request.
HTTP Referrer Tag: The SAML Single Sign-on proto-
col does not specify the details of the HTTP message
either. Therefore we can assume that the protocol does
not handle the referrer tag of HTTP. According to [9] it
may be set if the referrer has its own URI. This is the
case for the D to which the browser is con-
nected. As the referrer tag includes the query string, it
also contains the artifacts previously sent to D. Thus, if
Proceedings of the 19th Annual Computer Security Applications Conference (ACSAC 2003) 
1063-9527/03 $17.00 © 2003 IEEE
Authorized licensed use limited to: Tsinghua University. Downloaded on March 25,2021 at 07:49:07 UTC from IEEE Xplore.  Restrictions apply. 
artifacts were not consumed by source site S, an adver-
sary could obtain valid outstanding artifacts.
7. Attacks
We present three attacks on the SAML Single Sign-
on Browser/Artifact proﬁle that are based on the ﬂaws
identiﬁed above.
7.1. Connection Hijacking / Replay Attack
An adversary can break the SAML Single Sign-on
Proﬁle by connection hijacking and replay of an en-
crypted redirect. The technique of connection hijacking
is described in [5]. The prerequisites for this are as fol-
lows:
Prerequisites: An adversary A is capable of connec-
tion interception and can observe the connection from
browser B to artifact receiver URL D of
Step 3. In addition, the integrity property claimed in
Step 3 is interpreted as message integrity without bind-
ing to the sending party and replay prevention.
The Attack: The attack refers to the protocol schema in
Section 6. The attacker intercepts the step 3 redirect to
destination site D and replays the encrypted message.
3. B → D: Redirect p to D
A: Adversary A intercepts this redirect and ﬁnishes
the connection from B to D.
3*. AB → D: replay of redirect p to D
The adversary resends the message as seen in the
preceding step, impersonating browser B to D. It
utilizes a modiﬁed channel subprotocol that allows
already encrypted messages to be sent directly.
The destination site cannot distinguish between B
and A because of the lack of authentication. D
therefore proceeds as speciﬁed in the protocol.
4. D → S: SAML request q with SAML artifacts of
p.
5. S → D: SAML response r with assertions.
The artifacts given in the SAML request q of D
were issued to D. The SAML request is identical
to the one D would have sent if it were connected
to B.
6*. D → AB: Response to Step 3*
D will respond to AB and grant AB the same per-
missions as B with user U and certiﬁed identity
idU .
Discussion: Because of the integrity and conﬁdential-
ity property of step 3, adversary A cannot see or mod-
ify the content of the message p. But these properties
are not strong enough to prevent a replay attack. Adver-