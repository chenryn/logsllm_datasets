S S
symmetry
Article
LogLS: Research on System Log Anomaly Detection Method
Based on Dual LSTM
YiyongChen,NurbolLuktarhan*andDanLv
CollegeofInformationScienceandEngineering,XinjiangUniversity,Urumqi830046,China;
PI:EMAIL(Y.C.);PI:EMAIL(D.L.)
* Correspondence:PI:EMAIL
Abstract:Systemlogsrecordthestatusandimportanteventsofthesystematdifferenttimeperiods.
Theyareimportantresourcesforadministratorstounderstandandmanagethesystem.Detecting
anomaliesinlogsiscriticaltoidentifyingsystemfaultsintime.However,withtheincreasingsize
andcomplexityoftoday’ssoftwaresystems,thenumberoflogshasexploded.Inmanycases,the
traditionalmanuallog-checkingmethodbecomesimpracticalandtime-consuming. Ontheother
hand,existingautomaticloganomalydetectionmethodsareerror-proneandoftenuseindicesor
logtemplates.Inthiswork,weproposeLogLS,asystemloganomalydetectionmethodbasedon
duallongshort-termmemory(LSTM)withsymmetricstructure,whichregardedthesystemlog
asanatural-languagesequenceandmodeledthelogaccordingtothepreorderrelationshipand
postorderrelationship.LogLSisoptimizedbasedontheDeepLogmethodtosolvetheproblemof
poorpredictionperformanceofLSTMonlongsequences.Byprovidingafeedbackmechanism,it
implementsthepredictionoflogsthatdonotappear.ToevaluateLogLS,weconductedexperiments
ontworealdatasets,andtheexperimentalresultsdemonstratetheeffectivenessofourproposed
methodinloganomalydetection.
(cid:1)(cid:2)(cid:3)(cid:1)(cid:4)(cid:5)(cid:6)(cid:7)(cid:8)(cid:1)
(cid:1)(cid:2)(cid:3)(cid:4)(cid:5)(cid:6)(cid:7)
Keywords:systemlogs;anomalydetection;LSTM;timeseriesforecasting
Citation:Chen,Y.;Luktarhan,N.;Lv,
D.LogLS:ResearchonSystemLog
AnomalyDetectionMethodBasedon
DualLSTM.Symmetry2022,14,454.
1. Introduction
https://doi.org/10.3390/
Many log files are often produced during the operation of modern systems. They
sym14030454
reflect the running state of the system and record the activity information of specific
AcademicEditor:JuanAlberto
eventsinthesystem. Theyarevaluableresourcestounderstandthestateofthesystem.
RodríguezVelázquez
Therefore, system logs are an important data source for performance monitoring and
Received:25January2022 anomalydetectionandhavebecomearesearchhotspotinthefieldofanomalydetection[1].
Accepted:16February2022 Atpresent,loganomalydetectioncanberoughlydividedintothreecategories: rule-
Published:24February2022 based anomaly detection, unsupervised anomaly detection, and supervised anomaly
detection.
Publisher’sNote:MDPIstaysneutral
Rule-basedexceptiondetection[2]generallyrequiresamanualanalysisoflogsand
withregardtojurisdictionalclaimsin
rulecreationinadvance,andthedegreeofautomationisalsolow. Forexample,ref. [3]
publishedmapsandinstitutionalaffil-
createdrulesetsbasedonanalyzinglogtimeseriesinformation,whicheffectivelyreduced
iations.
thefalse-positiverateofthesystembutwithlowautomationandhighlaborcost.
Withtheunsupervisedanomalydetectionmethod[4], themanualconsumptionis
reduced to a large extent, and there is no need for premarked training data. Anomaly
Copyright: © 2022 by the authors. detection can be performed by judging the difference between the log sequence to be
Licensee MDPI, Basel, Switzerland. detectedandthenormallogsequence. WeiXuetal.[5]usedabstractsyntaxtrees(AST)
This article is an open access article andprincipalcomponentanalysis(PCA)toprocesstheparsedlogfeatureset,reducethe
distributed under the terms and complexityofthefeaturesettobeanalyzed,andobtaineffectiveexceptionstestresults.
conditionsoftheCreativeCommons Jian-GuangLouetal.[6,7]proposedanunstructuredloganalysistechnologyforanomaly
Attribution(CCBY)license(https:// detection,anewalgorithmforautomaticallydiscoveringprograminvariantsinlogs,and
creativecommons.org/licenses/by/
miningprograminvariantsinlogmessagegroups,whichrevealedtheinherentlinearityof
4.0/).
Symmetry2022,14,454.https://doi.org/10.3390/sym14030454 https://www.mdpi.com/journal/symmetry
Symmetry2022,14,454 2of21
theprogramworkflow. QingweiLinetal.[8]proposedamethodoflogclusteringforlog
problemidentification. Inlogclustering,eachlogsequencewasrepresentedbyavector,the
similarityvaluebetweenthetwologsequenceswascalculated,andtheclusteringhierarchy
wasapplied. Thehierarchicalclusteringgroupedsimilarlogsequencesintoclusters.
Based on the supervised anomaly detection method [9], it is necessary to use the
premarkeddatatoperformloganomalydetectionthroughapretrainedmodel. Forex-
ample,ref.[10]usedalogeventcountingvectortotrainalogisticregressionmodeland
calculated the abnormal probability of a log sequence. In reference [11], the log event
countingvectorwasinputintoasupportvectormachine(SVM)totrainthehyperplane,
andthepositionrelationshipbetweenthedetectionlogsequenceandthehyperplanewas
judgedtodeterminetheabnormallogsequence.
Withthedevelopmentofdeeplearning[12],scholarshavepromotedtheassociation
betweenneuralnetworksandlogdetection,andsomeabnormallogdetectionmethods
basedonneuralnetworkshavegraduallyemerged[13],whichhaveachievedgoodresults
inpracticalapplications. BinXiaetal.[14]proposedagenerativeadversarynetworkbased
onlongshort-termmemory(LSTM)thatusedacustomlogparsertoextractstructured
informationandconverteachlogintoanevent. MinDuetal.[15]proposedadeepneural
network model that used LSTM to model system logs as natural-language sequences.
DeepLogobtainedthelogmodelfromnormalexecutionandperformedanomalydetection
on log data through this model. Compared with machine learning methods, DeepLog
overcomesthedeficiencyoftherecurrentneuralnetwork(RNN)andhashighaccuracy.
However, themethodforanomalydetectiononlyconsiderstheimpactofthelog’spre-
eventonthecurrenteventwhileignoringthepostsequencewhenperforminganomaly
detection. Theimpactofeventsoncurrenteventsispronetodeviationsovertimeina
long sequence of events, which subsequently affects the accuracy of subsequent event
predictions,loweringtheconfidenceintheresults. Intermsofefficiencyunderdetection,
thismethodstillhasroomforimprovement.
ZhangXetal.[16]usedlogeventsemanticinformationtoextractlogsequencecontext
informationthroughabi-LSTMmodeltoeffectivelyimprovetheaccuracyofloganomaly
detection. Tosolvetheproblemoflowdetectionefficiencyoflongsequenceabnormallogs,
YangRuipengetal.[11]introducedatimeconvolutionalneuralnetworkintoabnormal
logdetectionandreplacedthefullyconnectedlayerwithadaptiveglobalaveragepooling,
whicheffectivelysolvedtheoverfittingproblemandimproveddetectionefficiency.
Tosolvetheproblemthatunstructuredlogs[17]aredifficulttodetectdirectly,this
paperaddsafilteringfunctionbasedontheSpell[18,19]methodtoparseunstructured
logsmoreaccurately,whichlaysagoodfoundationforanomalydetectionoflogsequences.
In this paper, a log path anomaly detection method based on a dual LSTM network is
proposed,whichfullyconsiderstheinteractionandlatentsymmetryinformationbetween
theeventsbeforeandafterandmakesupfortheproblemthatthelogsequenceanomaly
detection method based on deep learning ignores the log time correlation. Compared
withsimilarpreviousmethods,thismethodhasimprovedaccuracyandF1-measureon
HDFSdatasets.
Thecontributionsofthispaperareasfollows:
1. By adding a filter step on Spell, the problem that the current log template is not
accurateenoughissolved,whichismoreconducivetotheperformanceofthelater
logdetectionwork.
2. TwoLSTMmodelsareconstructedaccordingtothepreorderandpostorderrelations
ofthelogsequence.Combinedwiththetwomodels,acompleteloganomalydetection
modelisconstructed, whichfullyconsiderstheinteractionofbeforeandafterlog
eventsandsolvestheproblemofinsufficientfeatureminingoflogsequences.
3. This paper provides an update mechanism. It solves the problem of inaccurate
detectionofunseenlogsequences.
Therestofthisarticleisorganizedasfollows. InSection2,weintroducetherelated
work. In Section 3, we summarize the construction of the model from three aspects:
Symmetry2022,14,454 3of21
logparsing,featureextraction,andanomalydetection. Finally,weevaluatethemodel’s
performanceinSection4andsummarizethisarticleinSection5.
2. Preliminaries
2.1. LogParser
Thefirststepofabnormallogdetectionistocollectthelog,obtaintheoriginaldata
and preprocess it. After log collection, we preprocess the data. According to specific
requirements,invalidinformationinthelogdataisfurtherremoved,includingrepeated
informationanduselessinformation. Finally,weobtainthelogdata,asshowninFigure1.
Then, we parse the data, analyze the log structure and information, and obtain the log
templateforeacheventasthebasisforsubsequentfeatureextraction.
Figure1.HDFSloginformationsample.
Thepurposeofthelogparseristonormalizethestructuredlogdata.Byparsingthelog
filetoextractthelogkey,thelogsequenceisconstructed,andthelogdataofdifferentstruc-
turesareconvertedintologkeysequenceswiththesameformat(sometimescalledalog
eventsequence)[20]. Forexample,thelog“08110920593113INFOdfs.DataBlockScanner:
Verificationsucceededforblk_-4980916519894289629”inFigure1indicatesthatthecontent
fragmentis“Verificationsucceededforblk_-4980916519894289629”,theconstantpartis
“Verification succeeded for “, and the variable is “blk_-4980916519894289629”; variable
parameterscanbeabstractedas*. Thecommonconstantinallsimilarlogentriesiscalled
thelogkey,whichcanbeusedtoindicatethelogtype. Byreplacingitwithalogkeyk
1
(e.g.,Verificationsucceededfor(*)),weobtainasequence{k ,k ,k ,...,k }. Theparameter
1 2 3 i
valueisaveryvaluabletypeofinformationinthelogandreflectstheoperatingstatusand
performanceofthesystem. Someparametervaluescanalsobeusedastheidentificationof
theexecutionsequence,suchasblock_idintheHDFSlog,asauniqueidentifier,whichcan
extractthelogsequenceofaspecificmodule.
Atpresent,therearemanyautomaticloganalysismethodsintheindustry. CFG[21]
mainlyusescodeanalysiswithASTandCFGalgorithms. Thismethodadoptstheoffline
mode; withgeneralaccuracy,theconstructiontimecomplexityisO(n3),andthesearch
efficiencyishigh. LKE[22]firstconvertsthefree-formattextofthelogintologkeys,and
thenclusterstheobtainedkeys. Bymappingeachlogmessagetoaseriesoflogkeys,the
logmessagecanbeconvertedintoalogkeysequence. Thealgorithmusedinthismethod
isclustering,whichadoptsofflinemodeandhasaverageaccuracy. Theconstructiontime
complexity is O(n2), and the search efficiency is very low. Logarm [23] is an effective
automaticlogparsingmethodusingann-gramdictionaryinnatural-languageprocessing.
Themethodadoptstheonlinemode, theconstructiontimecomplexityisO(n), andthe
accuracyandefficiencyarerelativelyhigh.
Drain[24]usesafixed-depthtreestructuretorepresentlogmessagesandeffectively
extractcommontemplates. Themethodadoptstheonlinemode, theconstructiontime
complexityisO(n),andtheaccuracyandsearchefficiencyarerelativelyhigh. Spellisa
moreadvancedlogparsingtool. Itusesthelongestcommonsubalgorithm(LCS)toparse
logsinastream. ItisimplementedbyMIT’slogPAIteam[25,26]asanopen-sourcesystem
andcananalyzelogsonline. ThisarticleusesSpelltoparsethelogtemplatefromthelog
data,andmanuallyfilters,deduplicates,andmergestheobtainedtemplatestoobtainthe
finallogtemplatethatisusedasthebasisforloganomalydetection.
Symmetry2022,14,454 4of21
2.2. ArchitectureandOverview
ThearchitectureofloganomalydetectionisshowninFigure2. Itincludesthreemain
modules: log analysis, log key anomaly detection, and a workflow model for anomaly
detection.
Figure2.LogLSarchitecture.
Inthelogparsingstage,theparsingresultsobtainedbysimplyusingtheSpellmethod
arenotcompletelycorrect. Somelogtemplatesareduplicatedorredundant,whichleads
topooranomalydetectioneffects. Inresponsetothissituation,inthisarticle,toimprove
theSpellmethodweaddmanualfilteringtoobtainthefinallogtemplatelist. Then,the
unstructuredlogdataareparsedintologeventsaccordingtothelogtemplatelist, and
finally,thelogeventsequencefileisobtainedformodeltraining.
In the training phase, the training set is the log entries from the normal system
executionpath,i.e.,thelogeventsobtainedafterlogparsing. Fordifferentsystemlogs,
therearedifferentwaystoconstructalogeventsequence. Iftheloghasauniqueidentifier,
such as an HDFS log, the log event sequence is constructed according to the unique
identifier. Ifthereisnouniqueidentifier,suchastheBGLlog,weuseaslidingwindow
toconstructthelogeventsequence. Usingthelogeventsequenceparsedinthelogfile