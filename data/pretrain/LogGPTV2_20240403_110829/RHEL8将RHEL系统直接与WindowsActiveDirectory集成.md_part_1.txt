[]{#index.html}
::: book
::: titlepage
::: producttitle
[Red Hat Enterprise Linux]{.productname} [8]{.productnumber}
:::
# []{#index.html#idm140251753126832}将 RHEL 系统直接与 Windows Active Directory 集成 {.title}
## 了解并配置 RHEL 系统以直接与 Active Directory 连接 {.subtitle}
::: authorgroup
[Red Hat]{.orgname} [Customer Content Services]{.orgdiv}
:::
::: legalnotice
[]{#index.html#idm140251734698544}
Copyright []{.trademark}© 2021 Red Hat, Inc.
The text of and illustrations in this document are licensed by Red Hat
under a Creative Commons Attribution--Share Alike 3.0 Unported license
(\"CC-BY-SA\"). An explanation of CC-BY-SA is available at
`http://creativecommons.org/licenses/by-sa/3.0/`{.uri}. In accordance
with CC-BY-SA, if you distribute this document or an adaptation of it,
you must provide the URL for the original version.
Red Hat, as the licensor of this document, waives the right to enforce,
and agrees not to assert, Section 4d of CC-BY-SA to the fullest extent
permitted by applicable law.
Red Hat, Red Hat Enterprise Linux, the Shadowman logo, the Red Hat logo,
JBoss, OpenShift, Fedora, the Infinity logo, and RHCE are trademarks of
Red Hat, Inc., registered in the United States and other countries.
[Linux]{.trademark}® is the registered trademark of Linus Torvalds in
the United States and other countries.
[Java]{.trademark}® is a registered trademark of Oracle and/or its
affiliates.
[XFS]{.trademark}® is a trademark of Silicon Graphics International
Corp. or its subsidiaries in the United States and/or other countries.
[MySQL]{.trademark}® is a registered trademark of MySQL AB in the United
States, the European Union and other countries.
[Node.js]{.trademark}® is an official trademark of Joyent. Red Hat is
not formally related to or endorsed by the official Joyent Node.js open
source or commercial project.
The [OpenStack]{.trademark}® Word Mark and OpenStack logo are either
registered trademarks/service marks or trademarks/service marks of the
OpenStack Foundation, in the United States and other countries and are
used with the OpenStack Foundation\'s permission. We are not affiliated
with, endorsed or sponsored by the OpenStack Foundation, or the
OpenStack community.
All other trademarks are the property of their respective owners.
:::
::: abstract
**摘要**
本文档提供如何使用 SSSD 将 RHEL 系统直接与 Windows Active Directory
集成的步骤。
:::
------------------------------------------------------------------------
:::
:::
[]{#making-open-source-more-inclusive.html}
::: preface
::: titlepage
# []{#making-open-source-more-inclusive.html#making-open-source-more-inclusive}使开源包含更多 {.title}
:::
红帽承诺替换我们的代码、文档和网页属性中存在问题的语言。我们从这四个术语开始：
master、slave、blacklist 和
whitelist。这些更改将在即将发行的几个发行本中逐渐实施。如需了解更多详细信息，请参阅
[CTO Chris Wright
信息](https://www.redhat.com/en/blog/making-open-source-more-inclusive-eradicating-problematic-language){.link}。
在身份管理中，计划中的术语变化包括：
::: itemizedlist
-   使用 [**[*block list*]{.emphasis}**]{.strong} 替换
    [*blacklist*]{.emphasis}
-   使用 [**[*allow list*]{.emphasis}**]{.strong} 替换
    [*whitelist*]{.emphasis}
-   使用 [**[*secondary*]{.emphasis}**]{.strong} 替换
    [*slave*]{.emphasis}
-   [*根据上下文，master*]{.emphasis} 词语将被替换为更精确的语言：
    ::: itemizedlist
    -   使用 [**[*IdM server*]{.emphasis}**]{.strong} 替换 [*IdM
        master*]{.emphasis}
    -   使用 [**[*CA renewal server*]{.emphasis}**]{.strong} 替换 [*CA
        renewal master*]{.emphasis}
    -   使用 [**[*CRL publisher server*]{.emphasis}**]{.strong} 替换
        [*CRL master*]{.emphasis}
    -   使用 [**[*multi-supplier*]{.emphasis}**]{.strong} 替换
        [*multi-master*]{.emphasis}
    :::
:::
:::
[]{#proc_providing-feedback-on-red-hat-documentation_integrating-rhel-systems-directly-with-active-directory.html}
::: preface
::: titlepage
# []{#proc_providing-feedback-on-red-hat-documentation_integrating-rhel-systems-directly-with-active-directory.html#proc_providing-feedback-on-red-hat-documentation_integrating-rhel-systems-directly-with-active-directory}对红帽文档提供反馈 {.title}
:::
我们感谢您对文档提供反馈信息。请让我们了解如何改进文档。要做到这一点：
::: itemizedlist
-   关于特定内容的简单评论：
    ::: orderedlist
    1.  请确定您使用 [*Multi-page HTML*]{.emphasis}
        格式查看文档。另外，确定 [**Feedback**]{.strong}
        按钮出现在文档页的右上方。
    2.  用鼠标指针高亮显示您想评论的文本部分。
    3.  点在高亮文本上弹出的 [**Add Feedback**]{.strong}。
    4.  按照显示的步骤操作。
    :::
-   要提交更复杂的反馈，请创建一个 Bugzilla ticket：
    ::: orderedlist
    1.  进入
        [Bugzilla](https://bugzilla.redhat.com/enter_bug.cgi?product=Red%20Hat%20Enterprise%20Linux%208){.link}
        网站。
    2.  在 Component 中选择 [**Documentation**]{.strong}。
    3.  在 [**Description**]{.strong}
        中输入您要提供的信息。包括文档相关部分的链接。
    4.  点 [**Submit Bug**]{.strong}。
    :::
:::
:::
[]{#connecting-rhel-systems-directly-to-ad-using-sssd_integrating-rhel-systems-directly-with-active-directory.html}
::: chapter
::: titlepage
# []{#connecting-rhel-systems-directly-to-ad-using-sssd_integrating-rhel-systems-directly-with-active-directory.html#connecting-rhel-systems-directly-to-ad-using-sssd_integrating-rhel-systems-directly-with-active-directory}第 1 章 使用 SSSD 将 RHEL 系统直接连接到 AD {.title}
:::
这部分论述了使用系统安全服务守护进程(SSSD)将 RHEL 系统连接到 Active
Directory(AD)。您需要两个组件才能将 RHEL 系统连接到 Active
Directory(AD)。一个组件 SSSD 与中央身份和身份验证源和其他组件
`realmd`{.literal} 交互，可检测可用的域并配置底层 RHEL
系统服务（本例中为 SSSD）以连接到该域。
::: itemizedlist
-   [使用 SSSD
    直接集成概述](#connecting-rhel-systems-directly-to-ad-using-sssd_integrating-rhel-systems-directly-with-active-directory.html#overview-of-direct-integration-using-sssd_connecting-rhel-systems-directly-to-ad-using-sssd "使用 SSSD 直接集成概述"){.link}
-   [支持直接集成的 Windows
    平台](#connecting-rhel-systems-directly-to-ad-using-sssd_integrating-rhel-systems-directly-with-active-directory.html#supported-windows-platforms-for-direct-integration_connecting-rhel-systems-directly-to-ad-using-sssd "支持直接集成的 Windows 平台"){.link}
-   [确保支持 AD 和 RHEL
    中的通用加密类型](#connecting-rhel-systems-directly-to-ad-using-sssd_integrating-rhel-systems-directly-with-active-directory.html#ensuring-support-for-common-encryption-types-in-ad-and-rhel_connecting-rhel-systems-directly-to-ad-using-sssd "确保支持 AD 和 RHEL 中的通用加密类型"){.link}
-   [直接连接到
    AD](#connecting-rhel-systems-directly-to-ad-using-sssd_integrating-rhel-systems-directly-with-active-directory.html#connecting-directly-to-ad_connecting-rhel-systems-directly-to-ad-using-sssd "直接连接到 AD"){.link}
-   [AD 供应商如何处理动态 DNS
    更新](#connecting-rhel-systems-directly-to-ad-using-sssd_integrating-rhel-systems-directly-with-active-directory.html#con_how-the-ad-provider-handles-dynamic-dns-updates_connecting-rhel-systems-directly-to-ad-using-sssd "AD 供应商如何处理动态 DNS 更新"){.link}
-   [修改 AD 供应商的动态 DNS
    设置](#connecting-rhel-systems-directly-to-ad-using-sssd_integrating-rhel-systems-directly-with-active-directory.html#proc_modifying-dynamic-dns-settings-for-the-ad-provider_connecting-rhel-systems-directly-to-ad-using-sssd "修改 AD 供应商的动态 DNS 设置"){.link}
-   [AD
    供应商如何处理可信域](#connecting-rhel-systems-directly-to-ad-using-sssd_integrating-rhel-systems-directly-with-active-directory.html#how-the-ad-provider-handles-trusted-domains_connecting-rhel-systems-directly-to-ad-using-sssd "AD 供应商如何处理可信域"){.link}
-   [realm
    命令](#connecting-rhel-systems-directly-to-ad-using-sssd_integrating-rhel-systems-directly-with-active-directory.html#realm-commands_connecting-rhel-systems-directly-to-ad-using-sssd "realm 命令"){.link}
:::
::: section
::: titlepage
# []{#connecting-rhel-systems-directly-to-ad-using-sssd_integrating-rhel-systems-directly-with-active-directory.html#overview-of-direct-integration-using-sssd_connecting-rhel-systems-directly-to-ad-using-sssd}使用 SSSD 直接集成概述 {.title}
:::
您可以使用 SSSD
访问用户目录用于身份验证和授权，并通过带有用户缓存的通用框架进以允许离线登录。SSSD
高度可配置；提供可插拔验证模块(PAM)和名称交换服务(NSS)集成，以及用于存储本地用户以及从中央服务器检索的扩展用户数据的数据库。在把
RHEL 系统与以下身份服务器类型之一连接时，推荐使用 SSSD：
::: itemizedlist
-   Active Directory
-   RHEL 中的身份管理（IdM）
-   任何通用 LDAP 或 Kerberos 服务器
:::
::: {.note style="margin-left: 0.5in; margin-right: 0.5in;"}
### 注意 {.title}
默认情况下，直接与 SSSD 集成只能在单个 AD 林中正常工作。
:::
配置 SSSD 以将 Linux 系统直接与 AD 集成的最便捷方法是使用
`realmd`{.literal}
服务。它允许调用者以标准的方式配置网络身份验证和域成员资格。`realmd`{.literal}
服务自动发现有关可访问 domain 和 realm
的信息，且不需要高级配置就可以加入到 domain 和 realm。
您可以使用 SSSD 与 AD
进行直接和间接集成，并允许您从一个集成方法切换到另一个集成方法。直接集成是将
RHEL 系统引入 AD 环境的简单方法。但是，随着 RHEL
系统份额的增长，您的部署通常需要更好地集中管理身份相关的策略，如基于主机的访问控制、sudo
或 SELinux 用户映射。在初始阶段，您可以在本地配置文件中维护 RHEL
系统的这些配置。但是，在有大量系统的情况下，使用一个置备系统（如 Red Hat
Satellite）可以使对配置文件进行分发和管理的任务变得更为容易。当直接集成不再可以满足环境扩展的要求时，应该考虑使用间接集成。有关从直接集成（RHEL
客户端位于 AD 域中）到间接集成（带有信任到 AD 的
IdM）的更多信息，请参阅[将 RHEL 客户端从 AD 域移动到 IdM
服务器。](https://www.freeipa.org/page/V4/IPA_Client_in_Active_Directory_DNS_domain){.link}
有关哪些类型的集成与您的用例匹配的更多信息，请参阅[间接集成和直接集成](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/planning_identity_management/planning-integration-with-ad_planning-dns-and-host-names#deciding-between-indirect-and-direct-integration_planning-integration-with-ad){.link}。
::: itemizedlist
**其它资源**
-   `realm(8)`{.literal} man page。
-   `sssd-ad(5)`{.literal} man page。
-   `sssd(8)`{.literal} man page。
:::
:::
::: section
::: titlepage
# []{#connecting-rhel-systems-directly-to-ad-using-sssd_integrating-rhel-systems-directly-with-active-directory.html#supported-windows-platforms-for-direct-integration_connecting-rhel-systems-directly-to-ad-using-sssd}支持直接集成的 Windows 平台 {.title}
:::
您可以直接将 RHEL 系统与使用以下林和域功能级别的 Active Directory
网站集成：
::: itemizedlist
-   林功能级别范围：Windows Server 2008 - Windows 服务器 2016
-   域功能级别范围：Windows Server 2008 - Windows 服务器 2016
:::
在以下支持的操作系统中测试了直接集成：
::: itemizedlist
-   Windows Server 2019
-   Windows Server 2016
-   Windows Server 2012 R2
:::
::: {.note style="margin-left: 0.5in; margin-right: 0.5in;"}
### 注意 {.title}
Windows Server 2019 没有引入新的功能级别。Windows Server 2019
使用最高功能级别是 Windows Server 2016。
:::
:::
::: section
::: titlepage
# []{#connecting-rhel-systems-directly-to-ad-using-sssd_integrating-rhel-systems-directly-with-active-directory.html#ensuring-support-for-common-encryption-types-in-ad-and-rhel_connecting-rhel-systems-directly-to-ad-using-sssd}确保支持 AD 和 RHEL 中的通用加密类型 {.title}
:::
默认情况下，SSSD 支持 RC4、AES-128 和 AES-256 Kerberos 加密类型。
RHEL 8 中弃用并默认禁用 RC4 加密，因为它被视为没有较新的 AES-128 和
AES-256 加密类型安全。相反，Active Directory(AD)用户凭证和 AD
域之间的信任支持 RC4 加密，它们可能不支持 AES 加密类型。
如果没有任何常用的加密类型，RHEL 主机和 AD
域之间的通信可能无法正常工作，或者一些 AD
帐户可能无法进行身份验证。要避免这种情况，请修改以下配置之一：
::: itemizedlist
-   [**在 Active Directory 中启用 AES 加密支持（推荐选项）**]{.strong}
    ：确保 AD 林中的 AD 域信任强大的 AES 加密类型，请参阅以下 Microsoft
    文章 [AD DS: Security: Kerberos \"Unsupported etype\" error when
    access a resource in a trusted
    domain](https://support.microsoft.com/en-us/help/4492348/kerberos-unsupported-etype-error-when-authenticating-across-trust){.link}
-   在 [**RHEL 中启用 RC4 支持**]{.strong} ：在进行 AD
    域控制器身份验证的每个 RHEL 主机上：
    ::: orderedlist
    1.  除了 `DEFAULT`{.literal} 加密策略外，使用
        `update-crypto-policies`{.literal} 命令还启用
        `AD-SUPPORT`{.literal} 加密子策略。