> [Summary](#summary-7) [Questions](#questions-6)
>
> [Further reading](#further-reading-7)
9.  [Cobalt Strike - Red Team
    > Operations](#cobalt-strike---red-team-operations) [Technical
    > requirements](#technical-requirements-5)
> [Cobalt Strike listeners](#cobalt-strike-listeners) [Foreign-based
> listeners](#foreign-based-listeners)
>
> [Cobalt Strike payloads](#cobalt-strike-payloads) [Beacons](#beacons)
>
> [The beacon menu](#the-beacon-menu) [Explore menu](#explore-menu)
> [Beacon console](#beacon-console)
>
> [Pivoting through Cobalt Strike](#_bookmark190) [Aggressor
> Scripts](#aggressor-scripts)
>
> [Summary](#summary-8) [Questions](#questions-7) [Further
> reading](#further-reading-8)
10. [C2 - Master of Puppets](#c2---master-of-puppets)
> [Technical requirements](#technical-requirements-6) [Introduction to
> C2](#introduction-to-c2)
>
> [Cloud-based file sharing using
> C2](#cloud-based-file-sharing-using-c2) [Using Dropbox as the
> C2](#using-dropbox-as-the-c2) [Using OneDrive as the
> C2](#using-onedrive-as-the-c2)
>
> [C2 covert channels](#c2-covert-channels)
>
> [TCP](#tcp) [UDP](#udp)
>
> [HTTP(S)](#https) [DNS](#dns)
>
> [ICMP](#icmp)
>
> [Summary](#summary-9) [Questions](#questions-8) [Further
> reading](#further-reading-9)
11. [Obfuscating C2s - Introducing
    > Redirectors](#obfuscating-c2s---introducing-redirectors)
> [Technical requirements](#technical-requirements-7) [Introduction to
> redirectors](#introduction-to-redirectors) [Obfuscating C2
> securely](#obfuscating-c2-securely)
>
> [Short-term and long-term
> redirectors](#short-term-and-long-term-redirectors) [Redirection
> methods](#redirection-methods)
>
> [Dumb pipe redirection](#dumb-pipe-redirection) [Filtration/smart
> redirection](#filtrationsmart-redirection)
>
> [Domain fronting](#domain-fronting) [Summary](#summary-10)
> [Questions](#questions-9) [Further reading](#further-reading-10)
12. [Achieving Persistence](#achieving-persistence)
> [Technical requirements](#technical-requirements-8) [Persistence via
> Armitage](#persistence-via-armitage) [Persistence via
> Empire](#persistence-via-empire) [Persistence via Cobalt
> Strike](#persistence-via-cobalt-strike) [Summary](#summary-11)
>
> [Further reading](#further-reading-11)
13. [Data Exfiltration](#data-exfiltration)
> [Technical requirements](#technical-requirements-9) [Exfiltration
> basics](#exfiltration-basics)
>
> [Exfiltration via Netcat](#exfiltration-via-netcat) [Exfiltration via
> OpenSSL](#exfiltration-via-openssl) [Exfiltration with
> PowerShell](#exfiltration-with-powershell)
>
> [CloakifyFactory](#cloakifyfactory)
>
> [Running CloakifyFactory on
> Windows](#running-cloakifyfactory-on-windows) [Data exfiltration via
> DNS](#data-exfiltration-via-dns)
>
> [Data exfiltration via Empire](#data-exfiltration-via-empire)
> [Summary](#summary-12)
>
> [Questions](#questions-10) [Further reading](#further-reading-12)
>
> [Assessment](#assessment)
>
> [Chapter 1:&#xA0;Red-Teaming and Pentesting](#_bookmark243) [Chapter
> 2:&#xA0;Pentesting 2018](#chapter-2-pentesting-2018)
>
> [Chapter 3:&#xA0;Foreplay &#x2013; Metasploit
> Basics](#chapter-3-foreplay-metasploit-basics) [Chapter
> 4:&#xA0;Getting Started with Cobalt
> Strike](#chapter-4-getting-started-with-cobalt-strike) [Chapter
> 5:&#xA0;./ReverseShell](#chapter-5-.reverseshell)
>
> [Chapter 7:&#xA0;Age of Empire &#x2013; The
> Beginning](#chapter-7-age-of-empire-the-beginning)
>
> [Chapter&#xA0; 8:&#xA0;Age of Empire &#x2013; Owning Domain
> Controllers](#chapter-8-age-of-empire-owning-domain-controllers)
> [Chapter 9:&#xA0;Cobalt Strike &#x2013; Red Team
> Operations](#chapter-9-cobalt-strike-red-team-operations)
>
> [Chapter 10:&#xA0;C2 &#x2013; Master of
> Puppets](#chapter-10-c2-master-of-puppets)
>
> [Chapter 11:&#xA0;Obfuscating C2s &#x2013; Introducing
> Redirectors](#chapter-11-obfuscating-c2s-introducing-redirectors)
> [Chapter 13: Data Exfiltration](#chapter-13-data-exfiltration)
>
> [Other Books You May Enjoy](#other-books-you-may-enjoy)
>
> [Leave a review - let other readers know what you
> think](#leave-a-review---let-other-readers-know-what-you-think)
# Preface
> Red Teaming is used to enhance security by performing simulated
> attacks on the organization in order to detect network and system
> vulnerabilities. Hands-On
>
> Red Team Tactics starts with an overview of pentesting and Red
> Teaming, before giving an introduction of few of the latest
> **pentesting** tools. You will then move on to exploring Metasploit
> and getting to grips with Armitage. Once you have studied the basics,
> you will understand Cobalt Strike basic, usage and how to set up a
> team server of Cobalt Strike.
You will discover some common lesser known techniques for pivoting and
how to pivot over SSH, before using Cobalt Strike to pivot. This
comprehensive guide demonstrates the advanced methods of
post-exploitation using Cobalt Strike and introduces you to
Command-and-control servers (C2) and Redirectors. All this will help you
achieve persistence using Beacons and Data
Exfiltration, and will also give you the chance to run through the
methodology to use Red Team activity tools like Empire during a Red Team
activity on Active Directory and Domain Controller.
> By the end of the book, you will have learned advanced penetration
> testing tools, techniques to get reverse shells over encrypted
> channels and processes for post- exploitation. In addition to this,
> you will explore frameworks such as Empire which include maintaining
> persistent access, staying untraceable, and getting reverse
> connections over different C2 covert channels.
# Who this book is for
> Hands-On Red Team Tactics is for you if you are an IT professional,
> pentester, security consultant, or ethical hacker interested in the IT
> security domain and wants to go beyond Penetration Testing. Prior
> knowledge of penetration testing is beneficial.
# What this book covers
> [Chapter 1](#red-teaming-and-pentesting), *Red-Teaming and
> Pentesting*, helps you understand about different standards of
> pentesting followed across the industry, and we went through the seven
> phases of the PTES standard in detail.
>
> [Chapter 2](#pentesting-2018), *Pentesting 2018*, introduces you to
> MSF Payload Creator (MSFPC). We will also look at the use of resource
> files which were generated by MSFPC besides the payload file
>
> [Chapter 3](#foreplay---metasploit-basics), *Foreplay -- Metasploit
> Basics*, teaches you about team server and the Armitage client,
> including the setup and usage of Armitage.
[Chapter 4](#getting-started-with-cobalt-strike), *Getting Started with
Cobalt Strike*, starts by exploring the red-team exercise as well as the
concept of the cyber kill chain, which can be used for an attack plan.
The chapter then introduces you to Cobalt Strike, the tool that is used
for red-team operations.
> [Chapter 5](#reverseshell), *./ReverseShell*, explores what a reverse
> connection and reverse shell connection is using various tools.
> Furthermore, we will try different payloads to get reverse shell
> connections using Metasploit.
>
> [Chapter 6](#pivoting-1), *Pivoting*, dives into port forwarding and
> its uses. We will also learn about pivoting and its uses, followed by
> methods of port forwarding via SSH.
>
> [Chapter 7](#age-of-empire---the-beginning), *Age of Empire -- The
> beginning*, introduces you to Empire and its fundamentals. We will
> also cover Empire\'s basic usage and the post exploitation basics for
> Windows, Linux and OSX.
>
> [Chapter 8](#age-of-empire---owning-domain-controllers), *Age of
> Empire -- Owning Domain Controllers*, delves into some more
advanced uses of the Empire tool to get access to the Domain Controller.
> [Chapter 9](#cobalt-strike---red-team-operations), *Cobalt Strike --
> Red Team Operations*, teaches you about the listener module of Cobalt
> Strike along with its type and usage.
>
> [Chapter 10](#c2---master-of-puppets), *C2 -- Master of Puppets*,
> provides an introduction to command and control (C2) servers and
> discussed how they are used in a red team operation.
>
> [Chapter 11](#obfuscating-c2s---introducing-redirectors), *Obfuscate
> C2s -- Introducing Redirectors*, introduces you to redirectors and the
> reason why obfuscating C2s are required. We have also covered how we
> can obfuscate C2s in a secure manner so that we can protect our C2s
> from
>
> getting detected by the Blue team.
>
> [Chapter 12](#achieving-persistence), *Achieving Persistence*, dives
> into achieving persistence using Armitage\'s inbuilt exploit modules,
> then we will learn how to do the same via Empire on Windows, Linux,
> and macOS machines.
[Chapter 13](#data-exfiltration), *Data Exfiltration*, discusses about
some basic ways of transferring data using simple tools like Netcat,
OpenSSL and PowerShell. Next, we jumped into transforming the data using
text-based steganography to avoid detection, as well as looking at the
usage of the CloakifyFactory tool.
# To get the most out of this book
> The readers should have prior knowledge to networking basics, Linux
> basic commands, Penetration Testing standards and hands-on experience
> in using tools such as Metasploit, Nmap, and so on.
>
> The readers should have at least Linux installed for Red Team
> Engagement. Kali is recommended as it comes with pre-configured tools.
# Download the color images
> We also provide a PDF file that has color images of the
> screenshots/diagrams used in this book. You can download it here:
> [https://www.packtpub.com/sites/default/f
> iles/downloads/9781788995238_ColorImages.pdf.](https://www.packtpub.com/sites/default/files/downloads/9781788995238_ColorImages.pdf)
# Conventions used
> There are a number of text conventions used throughout this book.
>
> CodeInText: Indicates code words in text, database table names, folder
> names, filenames, file extensions, pathnames, dummy URLs, user input,
> and Twitter handles. Here is an example: \"Let\'s try to use the
> backdoor_lnk module by typing
>
> info.\"
>
> Any command-line input or output is written as follows: **git clone
> https://github.com/g0tmi1k/mpc**
>
> **Bold**: Indicates a new term, an important word, or words that you
> see onscreen. For example, words in menus or dialog boxes appear in
> the text like this. Here is an example: \"Click the Add an app button
> to add an application.\"
>
> ![](media/image60.png)*Warnings or important notes appear like this.
> Tips and tricks appear like this.*
# Get in touch
> Feedback from our readers is always welcome.
>
> **General feedback**: If you have questions about any aspect of this
> book, mention the book title in the subject of your message and email
> us at
>
> [customercare@packtpub.com.](mailto:PI:EMAIL)
>
> **Errata**: Although we have taken every care to ensure the accuracy
> of our content, mistakes do happen. If you have found a mistake in
> this book, we would be grateful if you would report this to us. Please
> visit
> [www.packt.com/submit-errata](http://www.packt.com/submit-errata),
> selecting your book, clicking on the Errata Submission Form link, and
> entering the details.
>
> **Piracy**: If you come across any illegal copies of our works in any
> form on the Internet, we would be grateful if you would provide us
> with the location address or website name. Please contact us at
>  with a link to the material.
>
> **If you are interested in becoming an author**: If there is a topic
> that you have expertise in and you are interested in either writing or
> contributing to a book, please visit
> [authors.packtpub.com](http://authors.packtpub.com/).
# Reviews
> Please leave a review. Once you have read and used this book, why not
> leave a review on the site that you purchased it from? Potential
> readers can then see and use your unbiased opinion to make purchase
> decisions, we at Packt can understand what you think about our
> products, and our authors can see your feedback on their book. Thank
> you!
>
> For more information about Packt, please visit
> [packt.com](http://www.packt.com/).
# Disclaimer
> The information within this book is intended to be used only in an
> ethical manner. Do not use any information from the book if you do not
> have written permission from the owner of the equipment. If you
> perform illegal actions, you are likely to be arrested and prosecuted
> to the full extent of the law. Packt Publishing does not take any
> responsibility if you misuse any of the information contained within
> the book. The information herein must only be used while testing
> environments with proper written authorizations from appropriate
> persons responsible.
# Red-Teaming and Pentesting
> Pentesting is an authorized attack on a computer system, done to
> evaluate the security of the system/network. This test is performed to
> identify vulnerabilities and the risks they possess.
>
> The 1960\'s marked the true beginning of the age of computer security.
> In this chapter, we will cover the methodology of pentesting that is
> widely used, as well as the red-teaming approach, which is now being
> adopted across different corporations.
In this chapter, we will cover the following topics:
> Pentesting 101
>
> A different approach
# Pentesting 101
> As we all know, penetration testing follows a standard. There are
> various standards, such as the **Open Web Application Security
> Project** (**OWASP**), the **Open Source Security Testing Methodology
> Manual** (**OSSTMM**), the **Information Systems Security Assessment
> Framework** (**ISSAF**), and so on. Most of them follow the same
> methodology, but the phases have been named differently. We will take
> a look at each of them in the following sections and cover the
> **Penetration Testing Execution Standards** (**PTES**) in detail.
# OWASP
> OWASP is a worldwide not-for-profit charitable organization that
> focuses on improving the security of software.
>
> It\'s a community of like-minded professionals who release software
> and knowledge-based documentation on application security, covering
> such subjects as:
>
> Information gathering
>
> Configuration and deployment management testing Identity management
> testing
>
> Authentication testing Authorization testing Session management
> testing Input validation testing Error handling Cryptography
>
> Business logic testing Client-side testing
# Open Source Security Testing Methodology Manual (OSSTMM)
> As mentioned on their official website, this is a peer-reviewed manual
> of security testing and analysis, providing verified facts. These
> facts provide actionable information that can measurably improve your
> operational security.
>
> The OSSTMM includes the following key sections:
>
> Operational security metrics Trust analysis
>
> Work flow
>
> Human security testing Physical security testing Wireless security
> testing
>
> Telecommunications security testing Data networks security testing
> Compliance regulations
>
> Reporting with the **Security Test Audit Report** (**STAR**)
# Information Systems Security Assessment Framework (ISSAF)
> ISSAF is not very active, but the guide it has provided is quite
> comprehensive. It aims to evaluate the information security policy and
> process of an organization with regard to its compliance with IT
> industry standards, along with laws and regulatory requirements. The
> current version of ISSAF is 0.2.
>
> The stages that it covers can be found at
> [https://www.owasp.org/index.php/Penetration_t
> esting_methodologies.](https://www.owasp.org/index.php/Penetration_testing_methodologies)
# Penetration Testing Execution Standard (PTES)
> This standard is the most widely used standard and covers almost
> everything related to pentesting.
PTES is divided into the following seven phases:
1.  Pre-engagement interactions
2.  Intelligence gathering
3.  Threat modeling
4.  Vulnerability analysis
5.  Exploitation
6.  Post-exploitation
7.  Reporting
Let\'s take a brief look at what each of these phases involves.
# Pre-engagement interactions
> These actions involve multiple processes to be carried out before an
> activity kicks off, such as defining the scope of the activity, which