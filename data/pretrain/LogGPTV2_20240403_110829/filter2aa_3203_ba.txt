Relay-Forward 
Sent by a relay agent to forward 
a message to a server. The 
Relay-Forward contains a client 
message encapsulated as the 
DHCPv6 Relay-Message option. 
N/A 
Relay-Reply 
Sent by a server to send a 
message to a client through a 
relay agent. The Relay-Reply 
contains a server message 
encapsulated as the DHCPv6 
Relay-Message option. 
N/A 
Table 6-2  DHCPv6 messages 
A DHCPv6 stateful message exchange to obtain IPv6 addresses and configuration settings typically 
consists of the following messages:  
1. A Solicit message sent by the client to locate the servers. 
2. An Advertise message sent by a server to indicate that it can provide addresses and configuration 
settings. 
3. A Request message sent by the client to request addresses and configuration settings from a specific 
server. 
4. A Reply message sent by the requested server that contains addresses and configuration settings. 
If there is a relay agent between the client and the server, the relay agent sends the server Relay-
Forward messages containing the encapsulated Solicit and Request messages from the client. The 
server sends the relay agent Relay-Reply messages containing the encapsulated Advertise and Reply 
messages for the client. 
A DHCPv6 stateless message exchange to obtain only configuration settings typically consists of the 
following messages:  
Chapter 6 – Dynamic Host Configuration Protocol 
TCP/IP Fundamentals for Microsoft Windows  
Page: 192 
1. An Information-Request message sent by the DHCPv6 client to request configuration settings from a 
server. 
2. A Reply message sent by a server containing the requested configuration settings. 
For an IPv6 network that has routers configured to assign stateless address prefixes to IPv6 hosts, the 
two-message DHCPv6 exchange can be used to assign DNS servers, DNS domain names, and other 
configuration settings that are not included in router advertisement message. 
DHCPv6 Support in Windows 
Windows Vista and Windows Server 2008 include a DHCPv6 client. The DHCPv6 client attempts 
DHCPv6-based configuration depending on the values of the M and O flags in received router 
advertisement messages. Therefore, to use DHCPv6, you must configure DHCPv6 servers and relay 
agents to service each IPv6 subnet and then configure your IPv6 routers to set these two flags to their 
appropriate values. If there are multiple advertising routers for a given subnet, they should be 
configured to advertise the same stateless address prefixes and values of the M and O flags. IPv6 
hosts running Windows XP or Windows Server 2003 do not include a DHCPv6 client and ignore the 
values of the M and O flags in received router advertisements. 
You can configure an IPv6 router that is running Windows Vista or Windows Server 2008 to set the M 
flag to 1 in router advertisements with the netsh interface ipv6 set interface InterfaceNameOrIndex 
managedaddress=enabled command. Similarly, you can set the O flag to 1 in router advertisements 
with the netsh interface ipv6 set interface InterfaceNameOrIndex otherstateful=enabled command. 
Windows Server 2008 supports DHCPv6 stateful and stateless configuration with the DHCP Server 
service and a DHCPv6 relay agent with the Routing and Remote Access service. 
Configuring DHCPv6 Scopes and Options 
To create a DHCPv6 scope, do the following: 
1. In the console tree of the DHCP snap-in, right-click the IPv6 node, and then click New scope.  
2. Follow the instructions in the New Scope Wizard. 
To configure a DHCPv6 scope option, do the following: 
1. In the console tree of the DHCP snap-in, open the IPv6 node, and then open the applicable scope. 
2. Right-click Scope Options, and then click Configure Options.  
3. In Available Options, select the check box for the first option that you want to configure.  
4. Under Data entry, type the information required for this option, and then click OK.  
5. Repeat the steps 3-4 for any other options you want to specify.  
Figure 6-18 shows an example of the configuration of the DNS Recursive Name Server IPv6 Address 
List scope option. 
Chapter 6 – Dynamic Host Configuration Protocol 
TCP/IP Fundamentals for Microsoft Windows  
Page: 193 
Figure 6-18  An example of configuring the DNS Recursive Name Server IPv6 Address List scope option 
Installing and Configuring the DHCPv6 Relay Agent 
To install and configure the DHCPv6 Relay Agent, do the following: 
1. In the console tree of the Routing and Remote Access snap-in, double-click the server name, and 
then click IPv6. 
2. Click IPv6 Routing, right-click General, and then click New Routing Protocol.  
3. In the Select Routing Protocol dialog box, click DHCPv6 Relay Agent, and then click OK. 
4. In the console tree, right-click DHCPv6 Relay Agent, and then click Properties. 
5. In the DHCPv6 Relay Agent Properties dialog box, add the list of IPv6 addresses that correspond 
to the DHCPv6 servers on your network.  
Figure 6-19 shows an example of the DHCPv6 Relay Agent Properties dialog box. 
Chapter 6 – Dynamic Host Configuration Protocol 
TCP/IP Fundamentals for Microsoft Windows  
Page: 194 
Figure 6-19  An example of the DHCPv6 Relay Agent Properties dialog box 
After you have installed the DHCPv6 Relay Agent and configured the list of DHCPv6 servers, you must 
enable the DHCPv6 Relay Agent on the appropriate interfaces. To enable the DHCPv6 Relay Agent on 
an additional interface, do the following: 
1. In the console tree of the Routing and Remote Access snap-in, double-click the server name, and 
then click IPv6. 
2. Double-click IPv6 Routing, right-click DHCPv6 Relay Agent, and then click New Interface.  
3. Click the interface that you want to add, and then click OK.  
4. In the DHCPv6 Relay Properties dialog box, on the General tab, verify that the Relay DHCPv6 
packets check box is selected.  
5. If needed, in Hop-count threshold and Boot threshold (seconds), click the arrows to modify the 
thresholds as needed.  
6. Click OK. 
Figure 6-20 shows an example of the DHCPv6 Relay Properties dialog box for an interface. 
Figure 6-20  An example of the DHCPv6 Relay Properties dialog box for an interface 
Chapter 6 – Dynamic Host Configuration Protocol 
TCP/IP Fundamentals for Microsoft Windows  
Page: 195 
Using the Ipconfig Tool 
You use the Ipconfig tool to display a computer’s TCP/IP configuration and to manage an IPv4 address 
configuration that was allocated using DHCP.  
Verifying the IP Configuration 
To display basic information about the TCP/IP configuration of a computer that is running Windows, 
type ipconfig at the command prompt. The basic TCP/IP configuration information includes the 
following for each interface: 
Connection-specific DNS suffix 
IP addresses (IPv4 and IPv6) 
Subnet mask (for IPv4 addresses) 
Default gateway 
To display detailed information about the TCP/IP configuration of a computer that is running Windows, 
type ipconfig /all at the command prompt. 
The detailed TCP/IP configuration information includes the following additional items for the computer: 
The host name 
The primary DNS suffix 
The NetBIOS node type 
Whether IP routing is enabled 
Whether the WINS proxy is enabled 
The DNS suffix search list 
The detailed TCP/IP configuration information also includes the following additional items for each 
interface: 
Description of the network adapter 
MAC address of the network adapter 
Whether DHCP is enabled 
Whether autoconfiguration (APIPA) is enabled 
The IPv4 address of the DHCP server that allocated the IPv4 address of this interface 
The IPv4 addresses of the primary and secondary WINS servers 
For an IPv4 address that was allocated using DHCP, when the lease was obtained and when the lease 
expires 
Renewing a Lease 
To renew a lease on an IPv4 address that was allocated using DHCP, type ipconfig /renew at the 
command prompt. The /renew parameter causes the DHCP Client service to send a DHCPRequest 
Chapter 6 – Dynamic Host Configuration Protocol 
TCP/IP Fundamentals for Microsoft Windows  
Page: 196 
message to the DHCP server to get updated options and a new lease time. If the DHCP server is 
unavailable, the client continues to use the current  configuration. 
Releasing a Lease 
To release the current IPv4 address configuration, type ipconfig /release at the command prompt. The 
/release parameter causes the DHCP Client service to send a DHCPRelease message to the DHCP 
server. This can be useful when the client is moving to a different network and will not need the 
previous lease. After you issue this command, the interfaces that previously had IPv4 address 
configurations allocated using DHCP are configured with the IPv4 unspecified address of 0.0.0.0, and 
TCP/IP communications using that interface stops.  
By default, DHCP clients running Windows do not initiate DHCPRelease messages when they shut 
down. If a client remains shut down for the length of its lease (and the lease is not renewed), the DHCP 
server can assign that client’s IPv4 address to a different client after the lease expires. By not sending a 
DHCPRelease message, the client is more likely to receive the same IPv4 address during initialization. 
Setting and Displaying the Class ID 
To set the user class ID on a computer running Windows, type ipconfig /setclassid Adapter ClassID at 
the command prompt, in which Adapter is the name of the interface in Network Connections and 
ClassID is the class ID. To remove the class ID from an interface, omit the ClassID parameter. 
To display the user class ID, type ipconfig /showclassid Adapter at the command prompt. 
Chapter 6 – Dynamic Host Configuration Protocol 
TCP/IP Fundamentals for Microsoft Windows  
Page: 197 
Chapter Summary 
The chapter includes the following pieces of key information: 
DHCP is a TCP/IP standard described in RFCs 2131 and 2132, and it allows TPC/IP hosts to 
automatically receive an IPv4 address and other configuration parameters (such as a subnet mask, 
default gateway, and others) from a centrally administered DHCP server. Using DHCP eliminates the 
administrative and technical support problems associated with users who manually configure their IPv4 
address configurations. 
DHCP clients exchange a set of messages with a DHCP server to discover the set of DHCP servers, 
obtain a set of offered IPv4 address configurations, select a specific IPv4 address configuration, and 
receive an acknowledgement. DHCP relay agents facilitate DHCP message exchanges between DHCP 
clients and DHCP servers that are located on different subnets. 
You can install the DHCP Server service in Windows Server 2003 as an optional networking 
component, and you can configure server properties, scopes and superscopes, options, and client 
reservations. 
You can install and configure the DHCP Relay Agent in Windows Server 2008 and Windows 
Server 2003 as a routing protocol component of the Routing and Remote Access service. 
Stateless address autoconfiguration for an IPv6 host is done through the router discovery process, in 
which IPv6 nodes on a subnet use Router Solicitation and Router Advertisement messages to 
automatically configure IPv6 addresses and other configuration options. 
Stateful address autoconfiguration for an IPv6 host is done through DHCPv6, based on the M and O 
flags in the received Router Advertisement messages. With DHCPv6 stateful operation, both IPv6 
address and other settings are assigned by the DHCPv6 server. With DHCPv6 stateless operation, only 
IPv6 settings are assigned by the DHCPv6 server. 
The DHCP Server service in Windows Server 2008 supports stateful and stateless DHCPv6 operation. 
You can install and configure the DHCPv6 Relay Agent in Windows Server 2008 as a routing protocol 
component of the Routing and Remote Access service. 
You can use the Ipconfig tool to view a computer’s current IP configuration and to manage the IPv4 
address configuration that was allocated using DHCP. 
Chapter 6 – Dynamic Host Configuration Protocol 
TCP/IP Fundamentals for Microsoft Windows  
Page: 198 
Chapter Glossary 
address autoconfiguration – The process of automatically configuring IPv6 addresses on an interface. 
See also stateless autoconfiguration and stateful autoconfiguration. 
BOOTP – See bootstrap protocol (BOOTP). 
bootstrap protocol (BOOTP) – A protocol that is defined in RFCs 951 and 1542 and that is used 
primarily on TCP/IP networks to configure diskless workstations. 
deprecated state – The state of an autoconfigured IPv6 address in which the address is valid but its use 
is discouraged for new communication. 
DHCP – See Dynamic Host Configuration Protocol (DHCP) 
DHCP client – Any network node that supports the ability to communicate with a DHCP server to obtain 
a leased IPv4 configuration and related optional parameters information.  
DHCP relay agent – An agent program or component that is responsible for relaying DHCP and 
BOOTP messages between a DHCP server and a DHCP client. A DHCP relay agent supports 
DHCP/BOOTP message relay as defined in RFC 1542. A DHCP relay agent can run on a router or a 
host computer. 
DHCP server – A computer that offers dynamic configuration of IPv4 addresses and related information 
to DHCP-enabled clients. 
DHCPv6 stateful – A DHCPv6 operating mode in which a DHCPv6 server assigns stateful addresses to 
IPv6 hosts. 
DHCPv6 stateless – A DHCPv6 operating mode in which a DHCPv6 server provides stateless 
configuration settings but does not assign stateful addresses to IPv6 hosts. 
Dynamic Host Configuration Protocol (DHCP) – A TCP/IP standard that offers dynamic leased 
configuration of host IPv4 addresses and other configuration parameters to DHCP clients. DHCP 
provides safe, reliable, and simple TCP/IP network configuration, prevents address conflicts, and helps 
conserve the use of client IPv4 addresses on the network.  
Dynamic Host Configuration Protocol for IPv6 (DHCPv6) – A stateful address configuration protocol that 
can provide IPv6 hosts with a stateful IPv6 address and other configuration parameters.  
exclusion range – A small range of one or more IPv4 addresses within a DHCP scope that are excluded 
for allocation to DHCP clients. Exclusion ranges ensure that DHCP servers do not offer specific 
addresses within a scope to DHCP clients.  
invalid state – The state of an autoconfigured IPv6 address in which it can no longer be used to send or 
receive unicast traffic. An IPv6 address enters the invalid state when its valid lifetime expires. 
lease – The length of time for which a DHCP client can use a dynamically assigned IPv4 address 
configuration. Before the lease time expires, the client must either renew or obtain a new lease with 
DHCP. 
option – An address configuration parameter that a DHCP server assigns to clients. Most DHCP 
options are predefined, based on optional parameters defined in RFC 2132, although vendors or users 
can add extended options.  
Chapter 6 – Dynamic Host Configuration Protocol 
TCP/IP Fundamentals for Microsoft Windows  
Page: 199 
preferred lifetime – The amount of time in which a unicast IPv6 address configured through stateless 
address autoconfiguration remains in the preferred state. 
preferred state – The state of an autoconfigured IPv6 address for which the address is valid, its 
uniqueness has been verified, and it can be used for unlimited communications. 
reservation – A specific IPv4 address that is within a scope and that has been permanently reserved for 
use by a specific DHCP client. Client reservations are based on a unique client device identifier 
(typically its MAC address)  
router discovery – An IPv6 Neighbor Discovery process in which a host discovers the routers on an 
attached link.  
scope – A range of IPv4 addresses that are available to be leased or assigned to DHCP clients by the 
DHCP service.  
stateful address configuration – The use of a stateful IPv6 address configuration protocol, such as 
DHCPv6, to configure IPv6 addresses and configuration parameters. 
stateless address configuration – The use of Router Solicitation and Router Advertisement messages to 
automatically configure IPv6 addresses and configuration parameters. 
superscope – An administrative grouping feature that supports a DHCP server's ability to use more than 
scope for a physical network. Each superscope can contain one or more member scopes.  
tentative address – A unicast IPv6 address whose uniqueness has not yet been verified. 
tentative state – The state of an autoconfigured IPv6 address in which uniqueness has not yet been 
verified. 
user class – An administrative feature that allows DHCP clients to be grouped logically according to a 
shared or common need. For example, you can define a user class and use it to allow similar DHCP 
leased configuration for all client computers of a specific type or in a specific building or site location. 
valid state – The state of an autoconfigured IPv6 address for which the address can be used for 
sending and receiving unicast traffic. The valid state includes both the preferred and deprecated states.  
vendor class – An administrative feature that allows DHCP clients to be identified and allocated 
addresses and options according to their vendor and hardware configuration type. For example, 
assigning a vendor class to a set of printers allows them to be managed as a single unit so they could 
all obtain a custom set of DHCP options. 
Chapter 6 – Dynamic Host Configuration Protocol 
TCP/IP Fundamentals for Microsoft Windows  
Page: 200 
Chapter 7 – Host Name Resolution 
TCP/IP Fundamentals for Microsoft Windows  
Page: 201 
Chapter 7 – Host Name Resolution 