问题发生后的高负载处理
4244be/4kyle
4243
8169
TID PRIO USER
1be/4root
配置sysstat
be/4kyle
be/4root
，它能够用一种简单的机制来记录系统的统计信息，如
、RAM以及I/O状态。借助这些统计信息，当有人抱怨
189.52 K/s
DISK READ DISK WRITE SWAPIN
0.00 B/s 0.00 B/s 0.00 % 0.00 %
0.00 B/s 3.79 K/s 0.00 % 0.00 %
0.00 B/s
3.79 K/s 0.00 % 0.00 %
0.00 B/s 0.00 % 0.00 %
，只能等待负载降低才能登录。
2.3问题发生后的高负载处理·27
10>
init
 cli /usr/lib/gnome-
cli /usr/lib/gnome-
rsync--server --se
COMMAND
，如何找到
---
## Page 35
2
sysstat文件，更改HISTORY选项，让它可以记录7天以上的统计
系统（如Ubuntu）中，sysstat不会自动启用，所以需要修改／etc/
看这些统计信息。默认情况下 sar会输出当天的CPU 统计信息：
查看从当前日期起，一个月以内的统计数据。使用sar工具可以查
月当前日期结尾的文件名的文件中（如 sa03）。这就意味着你可以
2.3.2
sysstat 脚本执行的，所以如果想要更改 sysstat 收集信息的频率，你
上在午夜之前，它还会分割统计文件。这些操作都是由/etc/cron.d/
们存储到/var/log/sysstat或/var/log/sa文件中。除此之外，每天晚
录每日总结。
default/sysstat文件，将
?
可以修改这个脚本文件。
信息。对于这两种系统，统计信息都可以每10分钟抓取一次并记
第2章服务器为什么这么慢？耗尽了CPU、RAM和磁盘I/O资源
sysstat 统计信息的时候，它将这些信息存储在以 sa开头、以本
一旦启用了 sysstat，它就会每10 分钟收集一次系统状态并将它
在基于Red Hat的系统上，你可能需要修改/etc/sysconfig/
$sar
更改为
ENABLED="false"
08:55:01 PM
08:45:01 PM
08:25:01PM
08:05:01 PM
07:55:01 PM
ENABLED="true"
08:35:01PM
08:15:01PM
07:45:01PM
07:44:20PMC
Linux 2.6.24-22-server (kickseed) 01/07/2012
查看CPU 统计信息
all0.20
all
CPU %user %nice %system %iowait %steal
0.23
0.22
0.49
0.20
0.49
0.54
0.00
0.00
0.00
0.00
0.00
0.00
0.00
0.00
0.00
0.540.51
0.780.50
1.66
0.75
0.98
2.15
0.72
1.12
0.54
1.26
1.21
0.62
1.08
0.00
0.00
0.00
0.00
0.00
0.00
0.00
0.00
1%idle
98.52
98.23
96.16
96.54
98.95
97.77
---
## Page 36
的信息。例如，使用-r选项就可以收集 RAM 的统计信息：
息。使用-b 选项能给出一些列磁盘 I/O 的基本信息。
2.3.4
2.3.3
相同。在最后一行，sar 还为每个值提供了平均值。
的信息。
free 命令输出的信息类似。与之不同的是，你可以及时查看之前
查看交换空间的信息以及文件缓存的信息，
sysstat 计划任务不仅可以收集CPU负载信息，还能收集很多别
从 sar中还可以获得另一个非常有用的度量指标：磁盘统计信
Ssar-r
从输出中可以发现，CPU 的很多统计信息都和 top 命令的输出
在这里可以看到使用了多少内存，空闲多少内存，
07:44:20 PMtpsrtps wtps bread/s bwrtn/s
07:44:20PMkbmemfreekbmemused%memusedkbbufferskbcachedkbswpfreekbswpused%swpusedkbswpcad
Linux 2.6.24-22-server (kickseed) 01/07/2012
Average:
09:05:01 PM a1l
09:01:18 PMa
$sar-b
09:05:01PM
09:01:18P
08:55:01PM
08:45:01 PM
08:35:01
08:25:01
08:15:01
08:05:01
07:55:01PM
07:45:01PM
Linux2.6.24-22-server （kickseed) 01/07/2012
Average:
查看磁盘统计信息
查看RAM 统计信息
1PM
a110.320.00
322064
all0.19
294804
276632
282556
284152
297669
318228
318484
281876
283284
283096
10.24
193384
220644
196964
197220
233572
238816
232164
232352
231296
217780
232892
0.00
0.00
37.52
42.81
45.31
46.33
45.18
45.04
45.08
44.
38.21
0.720.37
1.120.78
1.100.54
16056
19682
21964
20612
20072
18384
22188
17648
17152
162954
144672
142900
0.0097.78
0.0098.71
0.0098.12
173900
173896
173724
154408
144700
2.3问题发生后的高负载处理·29
173804
173780
173756
，这些信息与用top 或
88316
88316
88316
88316
88316
88316
88316
88316
88316
88316
88316
，同时还能
0.00
0.00
0.00
0.00
0.00
0.00
0.00
0.00
0.00
0.00
0.00
---
## Page 37
CPU数据，
结束时间。
内的信息，
你会只想查看一天中部分时间段内的信息。想要获得指定时间范围
2.3.5
可以了解到想要看特定的统计信息应该传入什么标志位。
出什么统计信息，之后，通过阅读 sar 的用户手册（输人 man sar),
他一些有趣值在内的统计信息。这样可以让你更加了解 sar 能够输
显示包括负载平均值、CPU负载、RAM、磁盘I/O、网络I/O和其
你可能想一次性看到所有数据。使用-A选项可以做到这点。它会
bwrtn/s 能告诉你平均每秒写入的数据量。
并非用来衡量块I/O，而是告诉你平均每秒读取的数据量。类似地，
数据量和写入的数据量（分别是 rtps 和 wtps）相加获得。bread/s 列
第2章
sar程序可以传人很多参数，输出特定的数据集，不过有的时候
当然，到目前为止，我仅仅介绍了如何查看整天的信息。有时
从这里可以看到每秒总共传输的数据量（tps），它由总共读取的
08:25:01 PM a17 0.49
08:15:01PMa11 0.49
08:05:01 PM CPU %user %nice %system %iowait %steal %idle
$sar-s20:00:00-e20:30:00
08:15:01P