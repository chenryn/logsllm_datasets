识与计算机系统的实际情况结合起来。同时，可以提高他们的自学能
力，使他们养成乐于钻研和探索的良好习惯。软件调试是从事计算机软
硬件开发等工作的一项基本功，在学校里就掌握了这门技术，对于以后
快速适应工作岗位是大有好处的。
第五，本书是写给勇于挑战软件问题的硬件工程师和计算机用户
的。他们是软件缺欠的受害者。除了要忍受软件缺欠带来的不便之外，
有时软件生产方还将责任推卸给他们，找借口说是硬件问题或使用不当
造成的bug。使用本书的工具和方法，他们可以找到很充足的证据来为
自己说话。另外，本书的大多数内容不需要很深厚的软件背景，有基本
的计算机知识就可以读懂。
或许不属于上面5种类型的读者也可以阅读本书。比如，软件公司
或软件团队的管理者、软件方面的咨询师和培训师、大学和研究机构的
研究人员、非计算机专业的学生、自由职业者、编程爱好者、黑客，等
等。
要读懂和领会本书的内容，读者应具备以下基础。
曾经亲自参与编写程序，包括输入代码、编译，然后执行。
使用过某一种类型的调试器，用过断点、跟踪、观察变量等基本调
试功能。如果对这些功能充满了好奇并且希望了解它们是如何工作
的，则更好。
参加过某个软件开发项目，对软件工程有基本的了解，承认软件的
复杂性，认为开发一个软件产品与写一个HelloWorld程序根本不是
一回事。
尽管本书给出了一些汇编代码和C/C++代码，但是其目的只是在代
码层次直截了当地阐述问题。本书的目标不是讨论编程语言和编程技
巧，也不要求读者已经具备丰富的编程经验。
第2版说明
本书的主要内容
根据读者意见，第2版将分多卷组织。第1版中的第一篇、第二篇和第五篇包含在
卷1中，第1版中的第三篇、第四篇和第六篇将包含在后续分卷中。新的结构以卷1为
公共基础，其他分卷结合各自的平台环境深入介绍。因为结构变化较大，所以此处关
于第1版内容结构的介绍删除。
第2版说明
本书的三条线索
针对第2版的变化，关于本书线索和本书阅读方法的内容略有调整。
本书的内容是按照以下三条线索来组织的。
第一条线索是软件调试的“生态”系统（ecosystem）。
第二条线索是异常（exception）。异常是计算机系统中的一个重要
概念，出现在CPU、操作系统、编程语言、编译器、调试器等多个领
域，本书逐一对其做了解析。
第三条线索是调试器。调试器是解决软件问题非常有力的工具，它
是逐步发展到今天这个样子的。第1章介绍了单纯依赖硬件的调试方
法。第4章分析了DOS下调试器的实现方法。第7章介绍硬件仿真和基于
JTAG标准的硬件调试器。后续分卷将基于不同的操作系统平台详细介
绍调试器的工作原理和用法。另外，全书很多地方都使用了调试器输出
的结果，穿插了使用调试器解决软件问题的方法。
本书的阅读方法
本书的厚度决定了不适合一口气将它看完。以下是作者给出的阅读
建议。
下载并安装WinDBG调试器。如果你还不了解它的基本用法，那么
请先参考WinDBG的帮助文件，学会它的基本用法，能读懂栈回溯结
果。有了这个工具后，你就可以尝试本书所描述的相关调试方法，自己
在系统中探索书中提到的内容。
建议选择前面提到的三条线索中的一条来阅读。如果你有充裕的时
间，那么可以按第一条线索来阅读。如果你想深入了解异常，那么可以
按第二条线索来阅读。如果你有难题等待解决，希望快速了解基本的调
试方法，那么你可以选择第三条线索，选择阅读与调试器有关的内容。
先阅读每一篇开始处的简介，了解各篇的概况，浏览主要章节，建
立一个初步的印象。当需要时，再仔细查阅感兴趣的细节。
以上建议中，第一条是希望读者遵循的，其他建议谨供参考。
第2版说明
本书的写作方式
这是一本关于软件调试的书，同时它的大多数内容也是依靠软件调
试技术来探索得到的。在作者使用的计算机系统中，一个名为Toolbox
的文件夹下保存了100多个不同功能的工具软件。当然，使用最多的还
是调试器。书中给出的大多数栈回溯结果是使用WinDBG调试器产生
的。
写作本书的一个基本原则是首先从有代表性的实例出发，然后从这
个实例推广到其他情况和一般规律。例如，在CPU方面作者选择的是
IA-32 CPU；在操作系统方面选择NT系列的Windows操作系统；在编译
器方面选择的是Visual Studio系列；在调试器方面选择的是Visual Studio
内置的调试器和WinDBG。
本书的示例、工具和代码可以从高端调试网站（advdbg.org）免费
下载，单击该网站左下方的“特别链接”中的《软件调试》即可。
第2版的电子资源网站为advdbg.org网站。
尽管作者和编辑已经尽了最大努力，但是本书中仍然可能存在这样
那样的疏漏，欢迎读者通过上面的网站反馈给我们。
第2版说明
关于封面
人们遇到百思不得其解或者难以解释清楚的问题时可能不由自主地
说：“见鬼了。”在软件开发和调试中也时常有这样的情况。钟馗是传说
中的“捉鬼”能手，因此我们选取他作为本书的封面人物，希望这本书能
够帮助读者轻松化解“见鬼了”这样的复杂问题。
第1版书出版后某月，在上海长风公园偶然购得一幅皮影材质的钟馗画像，拿回
家后把它装在玻璃镜框中，尺寸大约为50cm×38cm。在英特尔公司工作的几年里，这
幅画一直挂在我的办公桌前。
免责声明
本书的内容完全是作者本人的观点，不代表任何公司和单位。你可
以自由地使用本书的示例代码和附属工具，但是作者不对因使用本书内
容和附带资料而导致的任何直接和间接后果承担任何责任。
第2版说明
第2版说明
致谢
倏忽之间，十年过去了，重读这个致谢名单，一个个熟悉的面孔浮现在眼前。时
光流转，真情不变，对各位朋友的感激之情永存我心。
首先感谢Jack B. Dennis教授，他向我讲述了大型机时代的编程环境
和调试方法以及他和Thomas G. Stockman为TX-0计算机编写FLIT调试器
的经过，并专门为本书撰写了短文“历史回眸”。FLIT调试器是作者追溯
到的最早的调试器程序。
感谢Windows领域的著名专家David Solomon先生，他回答了我的很
多提问，并为本书第1版写了推荐序。
因为David Solomon先生所写推荐序主要与Windows系统有关，所以把该推荐序放
到了本书后续分卷中。
感谢《Showstopper》一书的作者Greg Pascal Zachary先生，他允许
我引用他书中的内容和该书的照片。
感谢CPU和计算机硬件方面的权威Tom Shanley先生，他在计算机
领域的著作有十几本，他关于IA-32架构方面的培训享誉全球。感谢他
允许我在本书中使用他绘制的关于CPU寄存器的大幅插图（因篇幅所限
最终没有使用）。
探索Windows调试子系统让我感受到了软件之美，创造这种美感的
一个主要技术专家便是Mark Lucovsky先生，感谢他在邮件中给予我的
鼓励。
感谢DOS之父Tim Paterson先生，他向我介绍了他编写8086 Monitor
的经过，并允许我使用这个调试器程序的源代码。
第2版说明
第2版说明
感谢Syser调试器的作者吴岩峰先生，我们多次讨论了如何在单机
上实现内核调试的技术细节，他始终关心着本书的进度。
感谢我的老板和同事，他们是：Kenny、Michael、Feng、Adam、
Jim、Neal、Harold、Cui Yi、Keping、Eric、Yu、Wei、Min、Fred、
Rick、Shirley、Vivian、Luke、Caleb、Christina和Starry（请原谅，我无
法列出所有名字）。
感谢我的好朋友刘伟力，我们一起加班解决了一个大bug后，他感
慨地说“断点真神奇”，这句话让我产生了写作本书的念头。
感谢曾华军（我们共同翻译了《机器学习》）与李妍帮助我翻译了
Jack B. Dennis为本书写的“历史回眸”和David Solomon为本书第1版写的
推荐序。
感谢以下朋友阅读了本书的草稿，提出了很多宝贵的意见：王毅
鹏、王宇、施佳、夏桅、周祥、李晓宁、侯伟和吴巍。
以下朋友帮助检查了第2版卷1的初稿，在此表示感谢！
感谢谭添升、彭广杰、郁丛祥、邹冠群、卜道成、金睿、Yajun Yang、张耀欣和
黎小红。
感谢本书第1版的编辑周筠和陈元玉，感谢两位编辑对我的一贯支
持，以及编辑本书所花费的大量时间。感谢本书第1版美术编辑胡文
佳，她的精心设计让本书的封面如此美丽。
特别感谢人民邮电出版社为本书安排强大的编辑团队：陈冀康、谢晓芳、吴晋
瑜，他们出色的工作让我非常感动。也要感谢我的好朋友张文杰，他为本书第2版精
心绘制了很多幅插图。
感谢我的家人，在写作本书的漫长而且看似没有尽头的日子里，她
们承担了繁重的家务，让我有时间完成本书。
最后，感谢你阅读本书，并希望你能从中受益！
张银奎（Raymond Zhang）
2008年4月于上海
2018年7月26日更新于上海863软件园
资源与支持
本书由异步社区出品，社区（https://www.epubit.com/）为您提供相
关资源和后续服务。
配套资源
本书提供如下资源：
本书源代码；
书中彩图文件。
要获得以上配套资源，请在异步社区本书页面中点击
，跳
转到下载界面，按提示进行操作即可。注意：为保证购书读者的权益，
该操作会给出相关提示，要求输入提取码进行验证。
如果您是教师，希望获得教学配套资源，请在社区本书页面中直接
联系本书的责任编辑。
提交勘误
作者和编辑尽最大努力来确保书中内容的准确性，但难免会存在疏
漏。欢迎您将发现的问题反馈给我们，帮助我们提升图书的质量。
当您发现错误时，请登录异步社区，按书名搜索，进入本书页面，
点击“提交勘误”，输入勘误信息，点击“提交”按钮即可。本书的作者和
编辑会对您提交的勘误进行审核，确认并接受后，您将获赠异步社区的
100积分。积分可用于在异步社区兑换优惠券、样书或奖品。
与我们联系
我们的联系邮箱是PI:EMAIL。
如果您对本书有任何疑问或建议，请您发邮件给我们，并请在邮件
标题中注明本书书名，以便我们更高效地做出反馈。
如果您有兴趣出版图书、录制教学视频，或者参与图书翻译、技术
审校等工作，可以发邮件给我们；有意出版图书的作者也可以到异步社
区在线提交投稿（直接访问www.epubit.com/selfpublish/submission即
可）。
如果您是学校、培训机构或企业，想批量购买本书或异步社区出版
的其他图书，也可以发邮件给我们。
如果您在网上发现有针对异步社区出品图书的各种形式的盗版行
为，包括对图书全部或部分内容的非授权传播，请您将怀疑有侵权行为
的链接发邮件给我们。您的这一举动是对作者权益的保护，也是我们持
续为您提供有价值的内容的动力之源。
关于异步社区和异步图书
“异步社区”是人民邮电出版社旗下IT专业图书社区，致力于出版精
品IT技术图书和相关学习产品，为作译者提供优质出版服务。异步社区
创办于2015年8月，提供大量精品IT技术图书和电子书，以及高品质技
术文章和视频课程。更多详情请访问异步社区官网
https://www.epubit.com。
“异步图书”是由异步社区编辑团队策划出版的精品IT专业图书的品
牌，依托于人民邮电出版社近30年的计算机图书出版积累和专业编辑团
队，相关图书在封面上印有异步图书的LOGO。异步图书的出版领域包
括软件开发、大数据、AI、测试、前端、网络技术等。
异步社区
微信服务号
第一篇 绪  论
1955年，一家名为Computer Usage Corporation（CUC）的公司诞生
了，它是世界上第一家专门从事软件开发和服务的公司。CUC公司的创
始人是Elmer Kubie和John W. Sheldon，他们都在IBM工作过。他们从当
时计算机硬件的迅速发展中看到了软件方面所潜在的机遇。CUC的诞生
标志着一个新兴的产业正式起步了。
与其他产业相比，软件产业的发展速度是惊人的。短短60余年后，
我们已经难以统计世界上共有多少家软件公司，只知道这一定是一个很
庞大的数字，而且这个数字还在不断增大。与此同时，软件产品的数量
也达到了难以统计的程度，各种各样的软件已经渗透到人类生产和生活