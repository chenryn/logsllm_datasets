**作者：安天CERT**  
**来源：[https://www.antiy.cn/research/notice&report/research_report/20190601.html](https://www.antiy.cn/research/notice&report/research_report/20190601.html)**
### **1、事件背景**
网空威胁行为体是网络空间攻击活动的来源，它们有不同的目的和动机，其能力也存在明显的层级差异。根据作业动机、攻击能力、掌控资源等角度，安天将网空威胁行为体划分为七个层级，分别是业余黑客、黑产组织、网络犯罪团伙或黑客组织、网络恐怖组织、一般能力国家/地区行为体、高级能力国家/地区行为体、超高能力国家/地区行为体（参见附件一）。其中，超高能力国家/地区行为体，或称为超高能力网空威胁行为体，拥有严密的规模建制，庞大的支撑工程体系，掌控体系化的攻击装备和攻击资源，可以进行最为隐蔽和致命的网络攻击。安天曾将这种网络攻击称之为A2PT（即高级的高级可持续性威胁）。
“方程式组织”（Equation Group）正是这样一种典型的超高能力网空威胁行为体。2015 年 2
月，由卡巴斯基实验室首次公开披露。卡巴斯基称其已活跃近 20 年，可能是当前最复杂的APT攻击组织之一[1]。安天多年来持续追踪“方程式组织”的威胁行为，从
2015 年 3
月至今，先后发布了四篇分析报告：《修改硬盘固件的木马——探索方程式组织的攻击组件》[2]，分析了其部分木马模块组件和基于硬盘固件持久化的机理；《方程式部分组件中的加密技巧分析》[3]，揭示了其资源的加密方法；《从“方程式”到“方程组”——EQUATION攻击组织高级恶意代码的全平台能力解析》[4]，揭示了其木马载荷的全操作系统平台覆盖能力，并独家曝光了其针对
Solaris 和 Linux 的样本；《方程式组织 Equation DRUG
平台解析》[5]，则形成了对其原子化作业木马的积木拼图。在这些工作中，我们最大的遗憾，莫过于这些分析依然停留在恶意代码分析的视角，我们只能对在已达成攻击目标的现场的有限提取结果，结合基于威胁情报扩线关联到的样本，来展开分析工作。从业内已发表的分析成果来看，无论对于方程式组织的活动，还是对于同样来自超高能力网空威胁行为体的“震网”[6]、“火焰”[7]、“毒曲”[8]等攻击活动，都基本建立在，对所使用漏洞的原理分析、对样本的逆向分析，以及对样本作用机理的复盘之上。尽管这些工作同样是复杂和艰难的，但并不能掩盖防御者对超高能力网空威胁行为体在战术和过程认知上的不足。这是因为，以“方程式组织”为代表的超高能力网空威胁行为体有一套完整、严密的作业框架与方法体系；拥有大规模支撑工程体系、制式化装备组合，进行严密的组织作业，高度追求作业过程的隐蔽性、反溯源性，使其攻击看似“弹道无痕”，其突破、存在、影响、持续直至安全撤出网络环境或系统的轨迹很难被察觉，导致防护者对其网空行动中实际的攻击技术、战术和过程（TTP）以及相应轨迹知之甚少，包括对于其从研究分析、信息采集、环境塑造、前期侦察，到入口突破、横向移动、持久化、隐蔽对抗、信息获取、长期控制等活动，无法在整个威胁框架视角进行全面的信息掌握和解读。
随着斯诺登的曝光，对于超高能力网空威胁行为体的相关工程体系、装备体系，有了更多可以分析的文献资料。而2017年，影子经纪人的爆料，则让一批攻击装备浮出水面。一方面，这些漏洞利用工具和恶意代码载荷的外泄，被其他低层级的网空威胁行为体快速而广泛的利用，包括酿成了魔窟（WannaCry）蠕虫大爆发等信息灾难；另一方面，这些信息也成为了安全研究者从完整的威胁框架角度去分析超高能力网空威胁行为体的攻击活动全貌的极为宝贵的研究资源。
其中在2017年4月14日，“影子经纪人”曝光的数据中包含一个名为 SWIFT 的文件夹，完整曝光了“方程式组织”针对 SWIFT
金融服务提供商及合作伙伴的两起网络攻击行动的详实信息：“JEEPFLEA_MARKET”和“JEEPFLEA_POWDER”。其中，2012 年 7 月至
2013 年 9 月期间发起的“JEEPFLEA_MARKET”攻击行动，针对中东地区最大的 SWIFT 服务提供商
EastNets，成功窃取了其在比利时、约旦、埃及和阿联酋的上千个雇员账户、主机信息、登录凭证及管理员账号；“JEEPFLEA_POWDER”攻击行动，主要针对
EastNets 在拉美和加勒比地区的合作伙伴BCG（Business Computer Group），但此次行动并未成功。
安天CERT 将多年对方程式组织的分析进展与这一文件夹中所曝光的各种信息线索进行了组合复盘，还原了“方程式组织”对 EastNets
网络的攻击过程。通过复盘我们可以看到，这是一起由超高能力网空威胁行为体发起，以金融基础设施为目标；从全球多个区域的预设跳板机进行攻击；以 0Day
漏洞直接突破两层网络安全设备并植入持久化后门；通过获取内部网络拓扑、登录凭证来确定下一步攻击目标；以“永恒”系列 0Day 漏洞突破内网
Mgmt（管理服务器） 、SAA
业务服务器和应用服务器，以多个内核级（Rootkit）植入装备向服务器系统植入后门；通过具有复杂的指令体系和控制功能平台对其进行远程控制，在SAA业务服务器上执行
SQL 脚本来窃取多个目标数据库服务器的关键数据信息的高级持续性威胁攻击事件。
安天分析小组力求以态势感知的工作思路形成过程复盘，对超高能力网空威胁行为体的攻击活动进行初步的抽丝剥茧，对接威胁框架视角的解读，为重要信息系统和关键信息基础设施的规划、建设和运维者，提供关于如何建立有效的防御体系的参考依据。
### **2、被攻击目标资产情况**
##### **2.1 SWIFT介绍**
SWIFT，全称 Society for Worldwide Interbank Financial
Telecommunications，中文名为“环球同业银行金融电信协会”，1973 年 5 月，由来自美洲和欧洲的 15 个国家的 239
家银行正式组建，总部设在比利时首都布鲁塞尔。该组织运营着世界级的金融报文网络，各国银行和其他金融机构通过其提供的安全、标准化和可信的通道与同行交换报文，从而完成金融交易。除此之外，SWIFT
还向金融机构销售软件和服务。截至 2015 年，SWIFT 的服务已经覆盖全球 200 多个国家和地区的 11000
多家银行和证券机构、市场基础设施和公司客户，每日处理的报文次数达到 1500 万。
##### **2.2 被攻击的SWIFT服务提供商介绍**
经过认证的 SWIFT 服务提供商（SWIFT Service
Bureau）为客户提供了一种高效访问完整SWIFT服务的方法，相当于客户的云提供商，目前全球共有74家。此次攻击行动的目标 EastNets
是中东地区最大的 SWIFT 服务提供商。
图 2-1 EastNets机构简介
总部设在迪拜的 EastNets 是全球领先的金融服务领域合规和支付解决方案提供商，提供多种涉及 SWIFT
交易的服务，包括合规性、了解客户以及反洗钱等。在过去的 35 年中，EastNets
利用特有的专业知识，为客户打击金融犯罪，制定和实施标准化及个性化解决方案，并提供风险管理、监控，分析及最先进的咨询服务和客户支持。EastNets
还专注于端到端支付解决方案，使金融机构能够将传统的支付挑战转化为机遇，并使其更有效，更具成本效益地运营。包括一些大型国际金融机构在内的 750 多家客户依赖
EastNets 解决方案和专业服务，270 多家企业和金融机构依靠 EastNets 提供外包 SWIFT 连接和合规软件解决方案。EastNets
在全球主要城市设有地区办事处，并由广泛的全球战略合作伙伴网络提供支持[9]。
根据 Treasury And Risk 的统计[10]，加盟到 SWIFT 中的成员，70% 会选择 SWIFT 服务提供商，来避免自建 SWIFT
产生的过高投入以及后续操作维护阶段的费用。SWIFT 服务提供商就像是客户的“云”一样，在客户间发生 SWIFT 交易以及信息交换时，由其通过 Oracle
数据库以及 SWIFT 软件来管理。正是因为可以访问所有这些银行交易，很多 SWIFT 服务提供商也可以提供合规性、了解客户以及反洗钱服务。
##### **2.3 被攻击资产简况**
分析此次“方程式组织”攻击行动可以发现，EastNets 网络环境按照不同功能特性从 VPN
接入、区域边界再到分管理服务器、应用服务器、数据库服务器等进行了一定的层次和分区设计，各个逻辑分区之间也做了基于端口、IP
的访问控制策略，部署了企业级防火墙，并且在服务器上部署了主流品牌的安全防护软件。但是即使这种具有一定的基础防护能力和防御纵深的网络信息系统，在面对超高能力网空威胁行为体的攻击时，依然被攻陷。
在此次攻击中，EastNets 网络遭受攻击的资产包括 VPN 防火墙设备、企业级防火墙设备、管理服务器、应用服务器、SWIFT
业务服务器、终端主机信息、登录凭证和安全防护软件与应用软件等资产，图2-2绘制了被攻击主要资产简况的拓扑图。
图 2 2 被攻击资产简况拓扑图
##### **2.3.1 被攻击的网络安全设备及网络设备信息**
EastNets 至少有 10 台以上的网络安全设备和网络设备被攻击或被探测，主要以 Cisco 和 Juniper
两种品牌为主，相关设备名称、软件版本、开放端口等信息，被方程式组织完全获取，并被影子经纪人泄露。详细信息如表 2-1 所示。
表 2-1被攻击的企业级防火墙设备的详细信息
##### **2.3.2 被攻击的管理服务器信息**
被攻击的管理服务器一共有 2 台，内网 IP 分别为 192.168.206.110（192.168.208.10 / 10.255.10.10） 和