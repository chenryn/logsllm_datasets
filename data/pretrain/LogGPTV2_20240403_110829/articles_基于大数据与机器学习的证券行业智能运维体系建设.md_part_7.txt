管理功能解决与多系统多种多样用户登录服务统一适配的问题。前端发起用户登
录请求，IAR 将请求转发到用户中心登录服务，登录成功后 IAR 将缓存用户名、
密码等信息（或提供用户令牌转换功能，可根据登录服务实现方式适配）,存放
在分布式缓存中，并返回给前端统一的token。
后续前端访问需要登录校验的服务时，前端只需要带上统一的token，网关
会根据token去分布式缓存查询，如果存在该会话，则将原来缓存的用户名、密
码等信息回填到业务体中，并转发请求到后端的业务服务。网关还提供跨域访问
功能，使前端部署更加灵活，访问数据服务也更加方便。
权限管理建立基于 RBAC 的权限管理机制。RBAC（Role-Based Access
Control），就是用户通过角色与权限进行关联。简单地说，一个用户拥有若干角
色，每一个角色拥有若干权限。这样，就构造成“用户-角色-权限”的授权模型。
在这种模型中，用户与角色之间，角色与权限之间，一般者是多对多的关系。
5.3.3 服务的治理和监控
微服务架构的缺点中最主要的就是由于微服务数量众多导致维护成本巨大，
服务治理为解决此问题而产生的。服务治理的作用是让维护人员从人工维护中解
放出来，由服务自维护，微服务作为服务提供方主动向服务治理中心注册，服务
的消费方通过服务治理中心查询需要的服务并进行调用。其主要功能如下：
 服务发现/服务注册
 服务节点状态监控
 服务节点内中间件状态监控（例如Mysql，RabbitMQ的状态等）
 API级别的服务请求/回复状态统计
监控是微服务的控制系统的关键部分，系统越复杂，就越难理解各个组件的
性能状态并解决相应的问题。随着微服务越来越多的被采用，以前是单个服务器
+单个服务，现在转变成是多个服务器+多个服务的模式了，出现一个异常，如何
快速找出问题根源，显然对监控能力的要求更高了。我们的系统需要能够从如下
几个方面实施监控管理：
 微服务节点健康状态
 服务节点内功能组件的健康状态
 服务节点JVM参数
 API级别的调用统计信息
5.4 物理架构
Elasticsearch 作为日志分析过程中的核心组件，原生支持对其架构中 Client
Node、Master Node、Data Node 的在线水平扩展，保证日志分析平台的持续运
行：
随着业务量和接入数据量的增长，可以根据处理实时性的要求，灵活采用不
同的组件对应用场景进行设计和实现，同时也可以根据未来 IT 运维智能化发展
的需要，在现有大数据框架的基础上实现对性能指标数据采集、单指标预测、多
指标关联分析、故障根因定位等功能场景的无缝接入。
5.5 数据安全设计
5.5.1 数据安全
根据业务信息安全等级保护的标准，由于该系统指保存一定的运维数据，并
不存放实际的业务数据。当该系统的业务信息安全被破坏时，公民、法人、其他
组织的合法权益不会被损害，公共利益不会被侵害，也不会侵害到国家安全。
该系统服务遭到破坏后，公民、法人、其他组织的合法权益不会被损害，公
共利益不会被侵害，也不会侵害到国家安全。客观方面表现得侵害结果为：信息
技术总部领导、数据中心领导无法在第一时间及时看到运维数据。考虑到该系统
为信息技术总部内部使用，不会对我司服务业务能力造成损害。
5.5.2 主机安全
在主机安全性方面，系统相关的服务器部署在服务器机房，物理部署上是安
全的。应用服务器和数据处理应用服务器、两台数据库服务器均采用双机方式，
有效消除了单点故障的隐患，保证了系统在主机层面的高可用性。
在操作系统安全性方面，根据审计检查需求，使用漏洞扫描产品，进行安全
扫描及时发现问题采取补救措施。安装防病毒软件并实时更新病毒库。及时根据
相关软件的最新版本安装补丁。
5.5.3 应用安全
 用户权限管理
权限级安全控制，根据用户，角色，权限三级控制。将可操作权限赋予具体
的角色上，将角色赋予每个具体用户上，用户根据账号和口令登录后，根据所属
角色决定能查看或者操作哪些具体功能。用户的认证通过域服务器进行认证。
 数据库权限管理
系统会对数据库操作权限进行管理，防止一般用户通过修改数据库操作指令，
越权操作。
 日志审计管理
系统日志保存到各个应用服务器上，根据设置的日志类别，分为一般日志、
错误日志、调试日志。操作日志保存到各个应用服务器上或数据库上，提供用户
管理相关的日志。访问日志保存到应用服务器上，记录了用户访问的资源的信息。
5.5.4 数据传输安全
传输加密主要通过SSL/TLS加密协议完成。如果要进行TLS/SSL的配置，首
先必须要具有来自受信CA的证书，使用该CA生成每个节点的证书，节点的所有
服务都会通过上述生成的证书进行 SSL/TLS 加密。每个节点还需要建立本地的
Java Keystore以支持SSL/TLS公钥、秘钥的存放。
智能运维管理平台的数据从客户端-处理端-数据存储都支持 SSL加密，确保
数据在传输过程中的安全，不会被恶意愿改。此外，流数据在成功处理后，才会
提交对应数据偏移量，确保当异常发生时，数据处理可以从最近一次成功处理的
开始，确保数据零丢失。
5.5.5 数据存储安全
平台底层数据存储采用分布式引擎(ElasticsearchDataNode + Hadoop
DataNode)，每条数据都存储为多个数据备份，当单个数据节点出现故障时，数
据可以及时从其他节点恢复，保证数据在存储阶段的安全可靠。
对于数据加密，HDFS和HBase都提供了对应的功能。加密数据会有额外的计
算开销，这里只建议对部分关键目录进行加密，这两种加密方式对用户来说都是
透明的，只要用户有秘钥的访问权限就能查看对应数据。
结构化数据加密：目前结构化数据都由Hive/Impala进行存储，因此直接对
/user/hive/warehouse/${database}.db/${tablename}的对应目录进行加密，
Hive端不需要进行额外配置。
非结构化数据加密：非结构化数据分为小文件和大文件进行讨论。
小文件：存放于 HBase 中，HBase 提供了数据单元（cell）级别的加密，直
接可以对部分文件的二进制加密存放。
大文件：存放于HDFS中，这部分关键文件可以使用HDFS加密的方式，建立
对应的文件加密区，进行存放。
ElasticSearch层面则可以针对索引Index针对不同的人员进行访问控制管理。
5.5.6 数据访问控制
用户对资源的访问主要是通过全局数据查询，HDFS 的文件访问，Hive／
Impala的文件访问。
 数据查询ACL：
平台设计具有以下预定义角色进行权限控制：
用户角色功能 主要功能点
超级管理员角色 默认根系统管理员，具有最高的管理权限，可管理和配置
所有用户账号（包括：管理员账号），访问和配置系统所有功能。
管理员角色 系统管理员角色，可以管理除（超级管理员、管理员用户）
以外的所有用户权限分配，可配置采集器，并默认获得所有“索
引”的访问和管理权限
高级用户角色 作为系统的“索引”级别的管理员，可创建自定义“索引”，
并在自己的“索引”具有完全控制权限，可采集数据，解析数
据，创建和管理对象等操作，并分配“索引”的使用者用户权
限
普通用户角色 数据的普通使用者，可基于被分配的权限来访问允许访问
的“索引”数据，创建自己的对象，包括“保存的搜索”，“报
表”，“仪表盘”等。
自定义用户角色 自定义用户权限，用户可自定义分配角色
可以创建自定义角色，并为您的用户分配这些角色。创建自定义角色时，会
确定以下内容：允许的搜索：您可以定义分配给角色的用户允许执行的搜索。
 HDFS ACL
HDFS本身的授权模式类似Linux的默认系统授权模式，对用户、用户组、其
他用户三个方面定义了读、写和运行权限 。另外，在这种简单授权方法之上，
HDFS 提供了进一步的 ACL 功能，支持为一个目录添加多个用户和用户组的权限
支持。在 HDFS 上部署 acl 操作需要 hdfs 用户，或者对应目录和文件的所有者。
可以使用 hadoopsetfacl 命令来目录授权，例如，要单独赋予 app2 用户和用户
组可读权限：
$>hadoop fs -setfacl -R -m user:app2:r-x,group:app2:r-x /user/app1
注意，HDFS 的权限类似 Linux 权限，列出目录下的文件需要 execute(x)权
限。因此对于一个目录，如果需要给用户权限，大部分情况都是给予 r-x 权限。
如果需要用户能够读某个路径下的文件，其父路径必须有execute权限。
需要注意的是，这些赋权操作都需要 HDFS 的超级用户来完成。因此只有集
群的数据管理员有足够的权限完成这些操作。从管理角度上考虑，所有的权限请
求都通过这个管理员来完成，这个管理员需要对集群的权限分配有统一的记录和
管理。
针对这种文件路径上的授权，目前主要考虑的单位是业务组。将业务部门映
射为系统上的用户组，业务人员则作为对应组的成员。文件或者目录的权限数属
于对应组中的数据管理组，有用读写操作，组内的其他用户组通过ACL获得读取
或者写入的不同权限。同时，对于额外需要进行读写的业务部门或者成员，可以
使用额外的ACL服务赋予对应权限。
由于有Sentry的存在，Hive的目录会自动同步按照Sentry目录的权限自动
保持同步。
 Hive/Impala权限控制
Hive/Impala 的用户权限是使用 Sentry 组件进行控制的，授权以角色为单
位的，每个用户组可以关联到多个角色从而会的不同的数据读写权限。其中角色
的权限包括：
SELECT - 能够从表或者视图中读取数据的权限，以及使用describe命令和
show table命令查看表和表描述信息的权限。
INSERT - 能够向表中写入数据的权限，具体指 INSERT 和 LOAD DATA 语句。
ALL - 能够读写的权限，也包括了创建、删除、修改表结构的权限。
基于角色的授权比单纯对用户和用户组进行授权更加灵活，对于角色可以提
前根据业务规则进行规划，定义好不同的角色类型，例如市场研究的角色可能会