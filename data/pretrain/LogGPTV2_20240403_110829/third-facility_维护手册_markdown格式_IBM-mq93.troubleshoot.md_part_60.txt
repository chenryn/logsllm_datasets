### Configuring and Using Trace in IBM MQ for IBM i

#### Parameters for Controlling Trace Output
- **TRCLEVEL**: Specifies the level of detail you want in the trace.
- **OUTPUT**: Determines the type of trace output.
- **TRCTYPE** and **-EXCLUDE**: For selective component tracing, use these parameters to reduce the amount of trace data, improving runtime performance. 
  - **TRCTYPE**: Specifies the points you want to trace.
  - **-EXCLUDE**: Specifies the points you do not want to trace.
  - If **TRCTYPE** is omitted, all trace points are enabled. If **-EXCLUDE** is omitted, all trace points specified in **TRCTYPE** are enabled.
- **MAXSTG**: Wraps the trace and specifies the maximum size of storage for the collected trace records.
- **JOB**: For selective process tracing, restricts trace generation to specified named processes.
- **DATASIZE(*NONE)**: Prevents IBM MQ from including any message data in its traces.

For more information, refer to the documentation on **TRCMQM (Trace MQ)**.

#### Notes:
- You can enter the **TRCMQM** command manually or use **F4** followed by **F9** to enable tracing using the **TRCMQM** panel.
- Additional commands for controlling the trace facility include:
  - **Starting a trace**: Use **QMQM/STRMQTRC** at the IBM i command line or **STRMQTRC** in Qshell.
  - **Ending a trace**: Use **QMQM/ENDMQTRC** at the IBM i command line or **ENDMQTRC** in Qshell.
  - **Formatting trace**: Use **DSPMQTRC** in Qshell to format binary trace files before sending them to IBM.

### Starting a Trace
You can start tracing at the IBM i command line or in Qshell with optional parameters to specify the level of tracing. Examples include:

- **Selective component tracing**:
  - **-t**: Specifies the points you want to trace.
  - **-x**: Specifies the points you do not want to trace.
  - Multiple **-t** or **-x** flags can be used, each with a valid trace type.

- **Selective process tracing**:
  - **-p**: Restricts trace generation to specified named processes.

- **Preventing message data inclusion**:
  - **-d 0**: Excludes message data from the traces.

For more information, see **strmqtrc (start trace)**.

### Ending a Trace
You can end tracing at the IBM i command line or in Qshell. To end early tracing of all processes, specify no parameters. To end a specific type of trace, include the appropriate parameter. For more information, see **endmqtrc (end trace)**.

### Formatting Trace
The trace files generated by IBM MQ are binary. Use the **DSPMQTRC** command in Qshell to format the trace output before sending it to IBM. For more information, see **dsmqtrc (display formatted trace)**.

### Procedure
1. **Start tracing**:
   - By default, all trace points are enabled, and a default-detail trace is generated. Specify the appropriate parameters to control which processes generate trace files and what kinds of data they trace.
   - Examples:
     - **Default detail trace**:
       - **Command line**: `CALL PGM(QMQM/STRMQTRC)`
       - **Qshell**: `/QSYS.LIB/QMQM.LIB/STRMQTRC.PGM`
     - **Default detail trace of queue manager QMA**:
       - **Command line**: `CALL PGM(QMQM/STRMQTRC) PARM('-m' 'QMA')`
       - **Qshell**: `/QSYS.LIB/QMQM.LIB/STRMQTRC.PGM -m QMA`
     - **Default detail trace of queue manager QMB with no message data**:
       - **Command line**: `CALL PGM(QMQM/STRMQTRC) PARM('-m' 'QMB' '-d' '0')`
       - **Qshell**: `/QSYS.LIB/QMQM.LIB/STRMQTRC.PGM -m QMB -d 0`
     - **API trace of jobs named AMQSPUT with all data**:
       - **Command line**: `CALL PGM(QMQM/STRMQTRC) PARM('-t' 'api' '-p' 'AMQSPUT' '-d' 'all')`
       - **Qshell**: `/QSYS.LIB/QMQM.LIB/STRMQTRC.PGM -t api -p AMQSPUT -d all`
     - **High detail early trace with files that wrap at 16MB**:
       - **Command line**: `CALL PGM(QMQM/STRMQTRC) PARM('-e' '-t' 'all' '-t' 'detail' '-l' '16')`
       - **Qshell**: `/QSYS.LIB/QMQM.LIB/STRMQTRC.PGM -e -t all -t detail -l 16`

2. **Reproduce the problem** while tracing is active, keeping the trace as short as possible.
   - **Check trace status**:
     - **Command line**: `CALL PGM(QMQM/STRMQTRC) PARM('-s')`
     - **Qshell**: `/QSYS.LIB/QMQM.LIB/STRMQTRC.PGM -s`

3. **Stop tracing** immediately after the problem occurs.
   - **Stop all traces**:
     - **Command line**: `CALL PGM(QMQM/ENDMQTRC) PARM('-a')`
     - **Qshell**: `/QSYS.LIB/QMQM.LIB/ENDMQTRC.PGM -a`

4. **Format the binary trace files**:
   - Use the **DSPMQTRC** command in Qshell.
   - Example: `/QSYS.LIB/QMQM.LIB/DSPMQTRC.PGM [-t FormatTemplate] [-h] [-s] [-o OutputFileName] InputFileName`
   - **InputFileName**: Required, specifies the name of the unformatted trace file.
   - **-t FormatTemplate**: Optional, specifies the template file for displaying the trace.
   - **-h**: Omits header information from the report.
   - **-s**: Extracts trace header and outputs it to stdout.
   - **-o output_filename**: Specifies the name of the file into which to write formatted data.

5. **Collect and send the traces** and other troubleshooting information to IBM.
   - **Automatically** using the **runmqras** command.
   - **Manually** as described in the documentation.

6. **Clean up the trace directory** to reclaim space and prepare for future traces.
   - **Command line**: `RMVLNK OBJLNK('/QIBM/UserData/mqm/trace/AMQ*.*')`
   - **Qshell**: `cd /QIBM/UserData/mqm/trace; rm -f AMQ*.*`

### Related Concepts
- **FFST: IBM MQ for IBM i**: Describes the First Failure Support Technology (FFST) files for IBM i systems.
- **Collecting troubleshooting information for IBM Support**: Provides additional information and steps for collecting and sending troubleshooting data to IBM.

### Using Trace with an IBM MQ Client on IBM i
- **Before you begin**: Ensure the client is installed and configured correctly.
- **Tracing commands**:
  - **Start tracing**: Use **QMQM/STRMQTRC** at the command line or **STRMQTRC** in Qshell.
  - **End tracing**: Use **QMQM/ENDMQTRC** at the command line or **ENDMQTRC** in Qshell.
  - **Format trace**: Use **DSPMQTRC** in Qshell.

### Procedure
1. **Start tracing** with the appropriate parameters.
2. **Reproduce the problem** and keep the trace as short as possible.
3. **Check trace status** using the **-s** parameter.
4. **Stop tracing** immediately after the problem occurs.
5. **Format and collect the trace files**.
6. **Send the traces** and other troubleshooting information to IBM.
7. **Clean up the trace directory** to reclaim space.

By following these steps, you can effectively use and manage trace in IBM MQ for IBM i, ensuring that you capture the necessary data for troubleshooting and support.