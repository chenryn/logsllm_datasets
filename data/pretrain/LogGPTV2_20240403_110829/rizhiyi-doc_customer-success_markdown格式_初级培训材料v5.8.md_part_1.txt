日志学院
初级培训教材
版本修订说明
5.4版本：20200318日修订，修缮3.1.9 时间分类小节结尾关于计算日志入库延时的描
述。
5.5版本：20200323日修订，完善5.1及5.3小节关于权限部分的描述，增加插图。
5.6版本：20200325日修订，更改1.6小节及3.1.9时间分类小节的顺序描述，使之与课程
讲解顺序相吻合。
5.7版本：20200408日修订，根据2020 Q1代理商培训情况优化细节，并在产品部署中新
增关于包服务器的说明。
5.8版本：20200619日修订，根据2020 Q2代理商培训情况优化细节。修订点如下：
- 统一日志易部署主机的资源要求为8核16GB；
- 1.6小节增加关于脑裂的说明；
- 11.3小节删除“Agent安装”（该功能需租户管理+前端页面进行，无法使用
Manager进行）。
1
日志学院
前言 日志搜索组件
根据企业发展规模，日志的价值挖掘的程度也会有所不同。
日志的基础价值在于资源管理、入侵检测及排障。初创型公司在公司业务发展到一定阶段
后，会有专业的运维职位，负责对公司的网站的健康度负责。这个期间，运维人员一般使
用专业的Linux服务器，并使用命令行界面来管理服务。这时，使用系统自带的日志分析
工具就可以实现基础的系统故障排查。不管是网络层面的故障，可能是安全层面、应用层
面的，基本都可以从日志中发现端倪。使用Linux系统命令行工具查看日志如下图所示。
图 使用Linux系统命令行工具查看日志
由于近些年数据的价值挖掘越来越受到重视，数据中蕴含的信息能做的事情也越来越多。
很多互联网公司通过页面埋点来获取用户信息以辅助运营，如通过用户在公司网站上的点
击记录，获取用户兴趣点，从而针对性地进行个性化的推送等。可页面埋点工作量大，且
往往需要对业务有一定认知后才能得到价值较高的数据。且这类方式对历史数据的利用较
为低效。
相比之下，日志数据的优势凸显。日志是网络监管部门用来监督企业的有力工具，日志安
全审计是众多企业业务发展的必备要求，此外，日志数据几乎覆盖了机器大部分执行动
作，通过日志能够实现运维监控、业务分析等多种统计分析的需求。
随着公司业务的不断壮大，日志数据会越来越多，从日志数据中发掘出的价值也会越来越
多，相应的，日志的作用由单纯的运维监控，逐渐往数据分析、智能运维的方向发展。
从整体上而言，日志的作用可以概括为以下几个方面。
1. 故障排查：通过日志手段可对系统进行实时健康度监控，系统日志记录程序Syslog就
是为了这个目的设计的。
2
日志学院
2. 业务分析：通过对业务系统日志进行关联分析，可以掌握业务系统整体运行情况，并
可通过日志进一步掌握用户画像分析、用户访问地域分析、用户访问热点资源分析等
信息，从而为业务平台的市场营销、销售策略等提供数据支撑。
3. 安全合规审计：根据国家等级保护要求，需要对安全设备日志进行集中存储和分析；
4. 内网安全监控：很多企业的信息泄漏起始于内部，使用日志进行用户行为分析
（UEBA），以监控内网安全，已成为行业共识。
5. 智能运维：随着大数据时代的日益深化，数据管理和分析方案越来越智能。自动化运
维已逐渐普及，而机器数据作为智能运维的基础数据，也必将在未来发挥出愈来愈重
要的作用。
如何通过日志实现上述功能？
由于日志中的信息都是由各字段组成的，对日志中的信息进行挖掘利用，就需要基于这些
字段进行。这就需要将字段信息从日志中抽取出来。对此，我们需要一个搜索引擎，像百
度、谷歌之类的搜索引擎一样，将文章或语句抽取成词，再基于词语进行检索。
日志搜索组件同时包括日志解析（分词）、存储及检索。
那么这些日志从何而来呢？对此，我们还需要构建一个日志采集系统。日志易作为一款商
业日志分析系统，它的产品架构也与此相似。这个，我们会在前面的学习中进行介绍。
由于日志易环境需要部署在客户环境内，且一般使用Linux系统进行部署，所以要求我们
对Linux运维也要有一定程度的认知。所以在本材料的第一章，会对Linux初级运维部分进
行讲解。
3
日志学院
目录
前言 日志搜索组件 ..........................................................................................................1
一、产品部署 ....................................................................................................................8
1.1 日志易网络环境说明......................................................................................................... 8
1.2 安装环境初始化 ................................................................................................................. 9
服务器硬件资源配置 ......................................................................................................................................... 9
操作系统 .............................................................................................................................................................. 10
硬盘分区 .............................................................................................................................................................. 10
LVM........................................................................................................................................................................ 10
防火墙及SELinux设置 ................................................................................................................................... 12
服务器时间 ......................................................................................................................................................... 12
服务器主机名 ..................................................................................................................................................... 12
1.3 产品安装 ........................................................................................................................... 13
安装说明 .............................................................................................................................................................. 13
安装模式介绍 ..................................................................................................................................................... 14
单机安装 .............................................................................................................................................................. 15
自动模式集群部署............................................................................................................................................ 15
指定模式集群部署............................................................................................................................................ 17
1.4 安装故障排查 ................................................................................................................... 19
1.5 产品默认密码 ................................................................................................................... 20
1.6 集群模块分布 ................................................................................................................... 21
二、日志易产品架构 ..................................................................................................... 24
2.1 数据存储 ........................................................................................................................... 24
2.2 数据查询 ........................................................................................................................... 25
三、日志关键属性 ......................................................................................................... 26
3.1 日志基本概念 ................................................................................................................... 26
3.1.1 appname ................................................................................................................................................... 26
3.1.2 tag ............................................................................................................................................................... 26
3.1.3 ip .................................................................................................................................................................. 26
3.1.4 hostname .................................................................................................................................................. 27
3.1.5 source ......................................................................................................................................................... 27
3.1.6 raw_message............................................................................................................................................ 27
3.1.7 field ............................................................................................................................................................. 27
3.1.8 logtype ....................................................................................................................................................... 27
4
日志学院
3.1.9 timestamp ................................................................................................................................................. 27
3.2 日志关键属性定义实例 .................................................................................................. 30
3.2.1 场景描述 .................................................................................................................................................. 30
3.2.2 日志接入：属性命名 ........................................................................................................................... 31
3.2.3 检索验证 .................................................................................................................................................. 32
3.2.4 日志解析：logtype命名 .................................................................................................................... 33
3.2.5 日志属性命名要点 ................................................................................................................................ 34
四、产品基础用法 ......................................................................................................... 35
4.1 快速上传日志样例 ........................................................................................................... 35
4.2 基本搜索功能示例 ........................................................................................................... 36
4.2.1 时间范围搜索 ......................................................................................................................................... 37
4.2.2 根据Tag和Appname过滤日志 ..................................................................................................... 39
4.2.3 全文检索 .................................................................................................................................................. 39
4.3 字段操作 ........................................................................................................................... 43
4.4 制作一个分析图形 ........................................................................................................... 45
4.5 制作一个仪表盘 ............................................................................................................... 46
4.5.1 保存趋势图 .............................................................................................................................................. 46
4.5.2 创建仪表盘 .............................................................................................................................................. 47
4.6 仪表盘上的基本操作....................................................................................................... 49
4.6.1 时间控制 .................................................................................................................................................. 49
4.6.2 图表配置 .................................................................................................................................................. 50
4.6.3 仪表盘其他配置 .................................................................................................................................... 51
4.7 报表发送 ........................................................................................................................... 52
发件邮箱设置 ..................................................................................................................................................... 53
五、权限管理 ................................................................................................................. 55
5.1 权限管理说明 ................................................................................................................... 55
5.2 权限管理流程 ................................................................................................................... 57
5.3 权限管理实战 ................................................................................................................... 57
5.4 权限管理补充说明 ........................................................................................................... 63
六、日志采集 ................................................................................................................. 64
6.1 Agent安装 ........................................................................................................................ 64
6.2 Agent数据采集 ................................................................................................................ 65
6.3 文件采集 ........................................................................................................................... 66
6.4 目录采集 ........................................................................................................................... 70
5
日志学院
6.5 Syslog采集 ....................................................................................................................... 75
6.6 搜索验证 ........................................................................................................................... 77
七、字段提取 ................................................................................................................. 79
7.1 正则解析 ........................................................................................................................... 80
7.1.1 常见正则字符 ......................................................................................................................................... 80
7.1.2 正则解析实例 ......................................................................................................................................... 82
7.2 时间戳识别 ....................................................................................................................... 82
7.2.1 时间戳识别 .............................................................................................................................................. 82
7.2.2 时间戳解析示例 .................................................................................................................................... 83
7.2.3 中文日期 .................................................................................................................................................. 83
7.2.4 多种日期出现在同一日志 .................................................................................................................. 84
7.2.5 日志内容没有年月日 ........................................................................................................................... 84
7.2.6 常用时间格式 ......................................................................................................................................... 84
7.3 字段提取实例 ................................................................................................................... 85
7.4 划选正则 ........................................................................................................................... 88
7.5 解析验证 ........................................................................................................................... 89
批量验证 .............................................................................................................................................................. 89
搜索验证 .............................................................................................................................................................. 90
八、统计视图分析 ......................................................................................................... 92
九、监控告警 ............................................................................................................... 143
9.1 告警类型 ........................................................................................................................ 143
9.2 创建监控项 .................................................................................................................... 143
9.3 告警方式 ........................................................................................................................ 143
十、导入APP ............................................................................................................... 147
10.1 获取APP说明 ............................................................................................................ 147
10.2 APP导入 ....................................................................................................................... 147
10.3 主机配置修改 .............................................................................................................. 148
10.3.1 规则命名 ............................................................................................................................................. 148
10.3.2 仪表盘修改 ........................................................................................................................................ 148
十一、Manager简单管理 ......................................................................................... 152
11.1 更新日志易安装包 ..................................................................................................... 152
11.2 导入Licnese................................................................................................................ 154
6
日志学院
11.3 模块管理 ...................................................................................................................... 155
7
日志学院
一、产品部署
日志易产品建议部署在CentOS 6或CentOS 7版本上（为方便后续维护升级，优先使用
CentOS 7，当然CentOS6、RedHat、Suse也行），因为产品安装及后期维护都需要对
Linux操作系统有所认知，因此日志易产品部署要求部署人员应具备Linux初级运维的能
力。
此外，产品部署期间的工作大致如下：
1、 能够按照安装手册，部署产品：注意日志系统环境初始化的几个要素（主机名及
DNS、时间同步、SELinux、防火墙等）。以上任一项没有按《日志易安装手册》进行
配置的话，都会可能造成产品安装失败，或直接影响产品的后续使用。原因大致如
下：
l 主机名及DNS：日志易模块按主机名通信，不指定会造成通信障碍。
l SELinux：Linux自身的安全检测机制较为严格，建议关闭后安装。
l 时间同步：时间同步有问题的话，会影响日志的接收。
l 防火墙：发送日志及通信使用的端口需要开启。
2、 产品部署完，根据《运维标准交付项》调整相关参数。如修改索引的保存天数。日志
易系统会长时间保存索引，默认保存索引时间为10年。一般客户用不到这么久的数
据，毕竟热数据的价值更高，如果客户的需求为保存6个月的数据，那我们的索引保
存时间修改为半年即可。
3、 Agent安装：根据Agent安装流程进行安装即可。有些客户担心Agent影响业务主机
正常运行，对此我们最好提前准备好Agent的性能说明文档、安全说明文档。
一般情况下，在入场之前，客户会为我们准备好产品部署环境（如做好Riad和 LVM ，安
装好CentOS7，各项硬件标准符合要求的主机）。特殊情况下，系统安装的工作会由日志
易售后实施人员亲自负责。这要求实施人员具备LVM创建及系统安装技能。
1.1 日志易网络环境说明
日志易多运行于客户内部网络环境内，常规情况下，日志易服务不会涉及局域网外的信息
接收。
日志易部署于客户业务集群之外，但需要在要采集日志的主机上安装Agent。对日志易集
群来说，安装Agent的客户主机是客户端，日志易集群是服务端。但除采集外，其他日志
分析工作都在日志易集群内进行，日志易集群是服务端较重的。
产品部署的第一步，也就是日志易集群的搭建。
8
日志学院
1.2 安装环境初始化
安装前环境初始化主要包括以下要点：
服务器硬件资源配置
服务器所需最低配置如下：
CPU: 8核 2.0GHz
MEM: 16GB
DISK: 100GB
IOPS: 100以上
l 索引数据、中间数据在服务器上存储的时间受限于服务器磁盘空间，磁盘容量至少
100GB；
l 请务必保证以上CPU、MEM资源
l IOPS数据会由安装脚本使用fio进行测试，无需手工测试。如果服务器IOPS低于
100，务必进行更换，过低的iops会严重影响系统稳定性/性能。
9