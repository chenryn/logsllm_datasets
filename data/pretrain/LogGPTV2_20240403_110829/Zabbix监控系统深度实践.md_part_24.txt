图10-57
FlrRese
temivees
PRocestor
ewues
had(
euno
5
---
## Page 202
所示。
图10-58所示。
件中的全局变量，配置文件的位置在 include/defines.inc.php中。默认 defines.inc.php是这样的：
10.6
conf 中的zabbix.conf.php就行。
文件，如果前端有东西需要修改，比如后端的Zabbix 数据库变更了，只需要修改 php 目录下
10.6.1全局配置参数
10.5.10
（2）ZBX_MIN_PERIOD：Graph中显示时间的最短跨度，这个滑块的最小值。如图10-59
（1）ZBX_PERIOD_DEFAULT：Graph中显示的时间跨度，单位是秒，默认是1小时，
Zabbix的前端是使用PHP开发的，和其他语言一样，前端的一些配置参数是写在配置文
define（'ZABBIXAPI VERSION',
define（'ZABBIX VERSION',
这是配置Zabbix的地方，一般安装以后是不会进人这里的。通过配置最后生成一个配置
从默认的内容就可以了解如何书写这些配置了，接下来我们看看一共有哪些配置。
0.5
%90
0.7%
0.8%
1%
1.1%
前端配置
Installation栏目
Zabbix server CPU system time(1h)
2.2.0)
'2.2.0*）;
图10-58
第10章Zabbix前端界面
187°
03.0300.02
如
---
## Page 203
·188·
默认为30秒。
PHP会向数据库请求数据，一旦请求超时，screen区域就会变暗。这里就是设置了这个超时时间，
默认为30。
有三种设置。
间跨度过长时，
THRESHOLD时，显示的数字在小数点后的位数，默认为6。
THRESHOLD时，显示的数字在小数点后的位数，默认为2。
LIMIT或者ZBX_UNITS_ROUNDOFF_LOWER_LIMIT的阈值，默认为0.01。
默认是0，即我们看到的Y轴在左侧。
Zabbix监控系统深度实践
（11）SCREEN_REFRESH_RESPONSIVENESS：由于 screen 在刷新数据时，是一个一个发
（10）SCREEN_REFRESH_TIMEOUT：在screen中，界面会自动刷新数据。每次刷新数据
（9）DEFAULT_LATEST_ISSUES_CNT:在 Dashboard 板块中的 Last n issues栏目中显示的n,
（8）ZBX_HISTORY_DATA_UPKEEP：在Graph 章节中我们说过，
（7）ZBX_UNITS_ROUNDOFF_LOWER_LIMIT：当值小于 ZBX_UNITS_ROUNDOFF_
（6）ZBX_UNITS_ROUNDOFF_UPPER_LIMIT：当值大 于 ZBX_UNITS_ROUNDOFF
（5）ZBX_UNITS_ROUNDOFF_THRESHOLD：选择使用ZBX_UNITS_ROUNDOFF_UPPER
①比0小：对于某个Item,根据其“keep in history”的设置来决定选择history表还是trends表。
（4）GRAPH_YAXIS_SIDE_DEFAULT：Graph中Y轴的位置。0表示左侧，1表示右侧。
③大于0：对于某个Item，忽略其“keep in history”的设置，而是用这里的设置。
②等于0：Zabbix只从trends表中获取数据。
（3）ZBX_MAX_PERIOD：Graph中显示时间的最长跨度。
默认为-1。
，会选择用trends表的数据来显示。这个“长”的阈值，
01400:05(now1)
图10-59
ih
，就是这里的设置。可以
当需要显示的数据的时
---
## Page 204
其他值则不显示Zabbix维护信息。
Stay tuned...';
常简单。在前端目录下的conf/maintenance.inc.php中，具体内容如下。
好能在Zabbix前端提示用户 Zabbix正在维护。Zabbix确实提供了这个功能，而且使用起来非
他们在访问Zabbix前端的时候，会发现数据出现问题，但是不知道出了什么问题。因此，最
间。单位是秒，默认为10。
送请求的，为了避免一个查询超时而堵塞了其他查询，这个参数针对每一个查询设置了超时时
10.6.2
（2）ZBX_GUI_ACCESS_IP_RANGE：允许访问Zabbix前端的IP范围，比如：192.168.1.1255。
（1）ZBX_DENY_GU_ACCESS:是否在前端显示维护状态。“1”表示显示 Zabbix 维护信息，
当 Zabbix要维护的时候，可能会给用户发送邮件告知，但不是每一个用户都会注意到提示
显示的维护信息如图10-60所示。
（3）warming_msg：当打开了在Zabbix 前端显示维护信息的时候显示的内容。
这里一共有三个可以设置的参数：
$_REQUEST['warning_msg']='We are upgrading MySQL database till 15:00.
$ZBX_GUI_ACCESS_IP_RANGE = array（'127.0.0.1');
//IP range,who allowed to connect to FrontEnd
//Maintenance mode
//MSGshowed on Warningscreen!
前端维护状态显示
Zabbix2.0.0
We are upgrading MySQL database till15:00. Stay tuned.
图10-60
第10章Zabbix前端界面
·189°
---
## Page 205
·190°
有如下三个选项。
具体如下。
如图10-62所示。
Zabbix产生报警的时候，会在PHP前端的任何界面的右上角发出提示，告诉我们发生的问题
够快速对自己当前用户进行一些配置。
该用户生效，设置界面如图10-61所示。
Zabbix监控系统深度实践
10.6.3
当右上角出现报警的时候，还伴随有警报声音，"Play sound”就是设置播放报警声音的选项，
这里主要介绍“Messageing”板块，有一个叫做“Global notification”的新功能。当
Profile设置的位置在 Zabbix 前端的右上角，单击“Profile”按钮后进人。这些设置只针对
10seconds：报警重复10秒钟。
Once：只播放一次报警声音。
进人Messging标签，这个功能的设置如图10-63所示。
User和Media标签的一些设置在Administration中都已经有了，Profile界面只是让大家能
USER PROFILE:Zabbix Administrator
Auto-logout(min90seconds)
user
Profile设置
Refresh(in seconds)
Media
URL(afterlogin)
Rowsperpage
Auto-login
Language
Password
Messaging
Save
Theme
Enqlish(en GB)
System default
Change password
Cancel
30
900
图10-61
---
## Page 206
在右上角的报警显示如图10-64所示。
 Message timeout:报警声音一直重复，直至报警在右上角消失。消失的时间是由“Message
timeout（seconds）”定义的。
Message timeout(seconds)
Frontend messaging
设定了哪些等级的 Trigger需要在前端显示，
Trigger severity
Playsound
Bate-02 Sep201316:19:31
Problem on New host
Problem onZabbix server
Problem on Zabbix server
Problem on New host
ssages.
a02Sp201310:2121
Dde02Sep 2013 18:26:30
ts:DiskUOsoverioasedonZabbax
Disaster
Recovery
口
Help|Get support|Print|Profle|Debug|Logout
High
Average
Warning
Information
Not classified
Messaqe timeout
onz
图10-63
图10-62
alarm disaster
alarm high
alamaveraqe
alarm warning
alarm information
punos ou
alarmok
Search
，以及报警声音是什么。
playstop
PlayStop
PlayStop
PlayStop
Play
PlayStop
第10章Zabbix前端界面
Stop
191°
---
## Page 207
·192°
显示的Host的操作也各有不同。
结果会罗列在下方。根据输人，一共会搜索出 Host、Hosts grouop 和 Template。再根据权限的不同，
那么可以使用 hostmname）IP 地址和 DNS,可以用Template 的名字,还可以用 Host group 的名字。
它的完整功能。
10.7
的报警。
前的报警静音；Mute/Unmute的作用是静音／取消静音所有报警；Clear的作用是清除当前显示
Zabbix监控系统深度实践
当在搜索框中输入内容的时候，Zabbix 会根据 Host 的 Hostname 进行自动补全。搜索出的
首先，我们能用什么来搜索什么呢？可以用Host中设定的Visible name（如果没有设置
在本书的一开始，介绍过右上角的全局搜索框，它可以搜索Host，在这一节中，我们讲解
右上角有三个按钮，从左到右分别是 Snooze、Mute/Unmute 和 Clear。Snooze的作用是使当
7全局搜索框
lessages
De:02 5ep201318:19:31
DelasNewhosthasustbeellestaned
Problem on New host
Dae 02 Sep 201318:21:21
Details:Disk l/Ois cwerbaded onZabt serve
ProblemonZabbixserver.
Date 02 5ep 2013 18:26:30
Problem on Zabbix server
DateDz Sep 2013 18:26:30
DetaisZabbix Eoent on New host is unteachable tor 5m nues
Problem on New host
Help|Getsuppont|Print|Profile|Debug|Logout
图10-64
Search
---
## Page 208
些服务。
中的每一个 IP进行探测，如果IP上存在某些服务，则会触发一些 Action。Zabbix 支持下面这
“Discovery”，而“添加监控”，就是前面讲过的“Action”。
到Zabbix监控。
简单来说，我们能提供IP范围，如果这个范围内出现了可以添加的服务器，那么就将其添加
实，如果服务器能够自动加人监控，岂不是更好？Zabbix的Discovery确实提供了这个功能，
然后去添加对应的监控。
来看，这的确是个挺麻烦的事。
前面几章的学习，大家应该已经知道在Zabbix中添加监控的具体过程了，以目前了解的情况
卡流量、监控每块硬盘的空余空间，那么就要针对每一块网卡、每一块硬盘来添加监控。经过
基于网络的 Discovery，指的是基于“IP”的 Discovery，即给定Zabbix一个IP范围，对其
在本章的一开始，举了两个例子，一个是网卡的自动监控，一个是硬盘的自动监控。其
幸好Zabbix 提供了这方面的功能，叫做 Discovery，它可以去“发现”我们需要的东西，
一般来说，
如果要在监控系统中实现运维自动化的理念，最麻烦的就是自动化添加监控。比如监控网
自动添加服务器有两个步骤：“发现”和“添加监控”。“发现”这一步就是
Discovery
第11章
·193°
---
## Page 209
194
Discovered、Host Lost。
分别对应 Host 和 Server两种，则一共有8种Event，具体如下。
SMTPv2 agent、SMTPv3 agent、SSH、TCP、Telnet、Zabbix agent。
的部分有以下两个。
人 FTP Servers 这个 Host group。
192.168.0.1255这个范围内，检查是否存在FTP服务的服务器，如果有，则加入监控，并加
存在事先设定的服务（可以是多个服务），并根据检查的结果，触发Aciton。比如，要在
Zabbix监控系统深度实践
在每一次检查后，会产生一个Event，Event一共有 Up、Down、Discovery、Lost 4种状态，
（5）从 Host group 中移除 Hosts
（4）将 Host 添加到 Host group
（3）开始或停止监控Hosts
（2）增加或删除 Hosts
而在Event 产生后，
Service Up、Service Down、Host Up、Host Down、Service Discovered、Server Lost、Host
（1）IP或者服务是否存在。
在了解了这个过程之后，
（1）发送通知
FTP、HTTP、HTTPS、ICMP ping、IMAP、LDAP、NNTP、POP、SMTP、SMTPv1 agent、
展开来看，Zabbix一共可以检查如下服务。
（2）Action的类型。
我们先总结一下：Discovery 就是会在给定的IP范围内，针对每一个IP，检查是否
（3）从 SNMPagent收到的信息。
（2）从Zabbix agent 收到的信息。
（1）FTP、SSH、Web、POP3、IMAP、TCP等服务。
，可以进行的Action有如下几种。
，可以展开来了解Discovery了。我们分析下前面的例子，最关键
---
## Page 210
的 Action，如图 11-2所示。
然后就可以看到配置界面了，如图11-1所示。
Host group。
绍各个参数。假设在127.0.0.1-101的IP中，将有FTP服务的Host加人FTP Servers 这个
11.2
了不会影响其他服务的检查。
Host的监控。
配置了发现服务的规则，接下来要配置发现服务后的动作。新建一个以 Discovery 为 source
本节会先从一个例子开始，让大家熟悉 Discovery 的整个流程，然后再在后面详细介
每一个检查（比如例子中检查 FTP 和 Zabbix agent）都是相互独立的，一个服务检查失败
首先配置Discovery rule。
再举个例子，可以设定在192.168.0.1-255这个IP范围内，先检查是否有FTP服务，如果有，
（7）执行 scripts
（6）连接或取消连接模板
Discovery的一个例子
Deviceuniqueness criterniaIPaddress
Discovery byproxy
(s u) e
Enabled
IPrange
SaveCloneDeleteCancel
Checks
NameFTPDiscoveryRule
127.0.0.1-101
No Droxy
Checktype
New
3600
图11-1
第11章Discovery
·195▪
---