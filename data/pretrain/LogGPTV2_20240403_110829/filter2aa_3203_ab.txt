TCP/IP Naming Schemes .................................................................................................................. 203 
Host Names Defined ...................................................................................................................... 203 
Host Name Resolution Process ......................................................................................................... 204 
Resolving Names with a Hosts File ................................................................................................ 205 
Resolving Names with LLMNR....................................................................................................... 206 
Resolving Names with a DNS Server ............................................................................................ 206 
Windows Methods of Resolving Host Names ................................................................................ 207 
The Hosts File .................................................................................................................................... 208 
IPv4 Entries .................................................................................................................................... 208 
IPv6 Entries .................................................................................................................................... 209 
The DNS Client Resolver Cache ....................................................................................................... 210 
Chapter Summary .............................................................................................................................. 212 
Chapter Glossary ............................................................................................................................... 213 
Chapter 8 – Domain Name System Overview ................................................................................... 215 
Chapter Objectives ............................................................................................................................ 216 
The Domain Name System ................................................................................................................ 217 
DNS Components .......................................................................................................................... 217 
DNS Names.................................................................................................................................... 218 
Domains and Subdomains ............................................................................................................. 218 
DNS Servers and the Internet ........................................................................................................ 219 
Zones .............................................................................................................................................. 220 
TCP/IP Fundamentals for Microsoft Windows  
Page: ix 
Name Resolution................................................................................................................................ 222 
DNS Name Resolution Example .................................................................................................... 222 
Reverse Queries ............................................................................................................................ 223 
Reverse Queries for IPv4 Addresses ......................................................................................... 224 
Reverse Queries for IPv6 Addresses ......................................................................................... 225 
Caching and TTL ............................................................................................................................ 225 
Negative Caching ........................................................................................................................... 225 
Round Robin Load Balancing ........................................................................................................ 225 
Name Server Roles ............................................................................................................................ 227 
Forwarders ..................................................................................................................................... 228 
Forwarders in Non-exclusive Mode ............................................................................................ 229 
Forwarders in Exclusive Mode.................................................................................................... 229 
Caching-Only Name Servers.......................................................................................................... 230 
Resource Records and Zones ........................................................................................................... 231 
Resource Record Format ............................................................................................................... 231 
Resource Record Types ................................................................................................................. 232 
Delegation and Glue Records..................................................................................................... 232 
The Root Hints File ......................................................................................................................... 233 
Zone Transfers ................................................................................................................................... 234 
Full Zone Transfer .......................................................................................................................... 234 
Incremental Zone Transfer ............................................................................................................. 235 
DNS Notify ...................................................................................................................................... 235 
DNS Dynamic Update ........................................................................................................................ 237 
Chapter Summary .............................................................................................................................. 238 
Chapter Glossary ............................................................................................................................... 239 
Chapter 9 – Windows Support for DNS ............................................................................................. 241 
Chapter Objectives ............................................................................................................................ 242 
The DNS Client Service ..................................................................................................................... 243 
DNS Client Configuration ............................................................................................................... 243 
DHCP Configuration of the DNS Client Service ......................................................................... 243 
Manual Configuration of the DNS Client Service Using Network Connections .......................... 243 
Manual Configuration Using Netsh ............................................................................................. 246 
TCP/IP Fundamentals for Microsoft Windows  
Page: x 
Configuration for Remote Access Clients ................................................................................... 247 
Configuration of DNS Settings Using Group Policy .................................................................... 247 
Name Resolution Behavior ............................................................................................................. 248 
Name Resolution for FQDNs ...................................................................................................... 248 
Name Resolution for Single-Label, Unqualified Domain Names ................................................ 248 
Name Resolution for Multiple-Label, Unqualified Domain Names ............................................. 249 
The DNS Server Service .................................................................................................................... 250 
Installing the DNS Server Service .................................................................................................. 251 
DNS and Active Directory ............................................................................................................... 252 
Active Directory Location Service ............................................................................................... 252 
Storage of Zones Integrated with Active Directory ..................................................................... 253 
DNS Server Service Configuration .................................................................................................... 255 
Properties of the DNS Server ......................................................................................................... 255 
Maintaining Zones .......................................................................................................................... 256 
Forward Lookup Zones ............................................................................................................... 256 
Reverse Lookup Zones ............................................................................................................... 257 
Delegation ................................................................................................................................... 258 
Zone Transfers ........................................................................................................................... 259 
Resource Records .......................................................................................................................... 259 
IPv4 Address Records ................................................................................................................ 259 
IPv6 Address Records ................................................................................................................ 260 
Pointer Records .......................................................................................................................... 260 
DNS Traffic Over IPv6 .................................................................................................................... 260 
Using Locally Configured Unicast Addresses............................................................................. 260 
Using Well-Known Unicast Addresses ....................................................................................... 261 
Dynamic Update and Secure Dynamic Update.............................................................................. 261 
How Computers Running Windows Update their DNS Names .................................................. 262 
DNS Dynamic Update Process .................................................................................................. 263 
Configuring DNS Dynamic Update ............................................................................................. 263 
Secure Dynamic Update ................................................................................................................ 265 
DNS and WINS Integration ............................................................................................................ 265 
How WINS Lookup Works .......................................................................................................... 265 
TCP/IP Fundamentals for Microsoft Windows  
Page: xi 
WINS Reverse Lookup ............................................................................................................... 266 
Using the Nslookup Tool .................................................................................................................... 267 
Nslookup Modes ............................................................................................................................. 267 
Nslookup Syntax ............................................................................................................................ 267 
Examples of Nslookup Usage ........................................................................................................ 267 
Example 1: Nslookup in Interactive Mode .................................................................................. 267 
Example 2: Nslookup and Forward Queries ............................................................................... 268 
Example 3: Nslookup Forward Query Using Another DNS Server ............................................ 268 
Example 4: Nslookup Debug Information ................................................................................... 268 
Example 5: Nslookup Reverse Query ........................................................................................ 269 
Chapter Summary .............................................................................................................................. 270 
Chapter Glossary ............................................................................................................................... 271 
Chapter 10 – TCP/IP End-to-End Delivery ......................................................................................... 273 
Chapter Objectives ............................................................................................................................ 274 
End-to-End IPv4 Delivery Process ..................................................................................................... 275 
IPv4 on the Source Host ................................................................................................................ 275 
IPv4 on the Router ......................................................................................................................... 276 
IPv4 on the Destination Host .......................................................................................................... 279 
Step-by-Step IPv4 Traffic Example .................................................................................................... 281 
Network Configuration .................................................................................................................... 281 
Web Client .................................................................................................................................. 282 
Router 1 ...................................................................................................................................... 283 
Router 2 ...................................................................................................................................... 283 
Router 3 ...................................................................................................................................... 283 
DNS Server ................................................................................................................................. 283 
Web Server ................................................................................................................................. 283 
Web Traffic Example ...................................................................................................................... 284 
DNS Name Query Request Message to the DNS Server .......................................................... 284 
DNS Name Query Response Message to the Web Client ......................................................... 286 
TCP SYN Segment to the Web Server ....................................................................................... 288 
TCP SYN-ACK Segment to the Web Client ............................................................................... 290 
TCP ACK Segment to the Web Server ....................................................................................... 291 
TCP/IP Fundamentals for Microsoft Windows  
Page: xii 
HTTP Get Message to the Web Server ...................................................................................... 292 
HTTP Get-Response Message to the Web Client ...................................................................... 293 
End-to-End IPv6 Delivery Process ..................................................................................................... 295 
IPv6 on the Source Host ................................................................................................................ 295 
IPv6 on the Router ......................................................................................................................... 296 
IPv6 on the Destination Host .......................................................................................................... 299 
Step-by-Step IPv6 Traffic Example .................................................................................................... 301 
Network Configuration .................................................................................................................... 301 
Web Client .................................................................................................................................. 302 
Router 1 ...................................................................................................................................... 302 
Router 2 ...................................................................................................................................... 302 
Router 3 ...................................................................................................................................... 302 
DNS Server ................................................................................................................................. 303 
Web Server ................................................................................................................................. 303 
Web Traffic Example ...................................................................................................................... 303 
DNS Name Query Request Message to the DNS Server .......................................................... 303 
DNS Name Query Response Message to the Web Client ......................................................... 306 
TCP SYN-ACK Segment to the Web Client ............................................................................... 309 
TCP ACK Segment to the Web Server ....................................................................................... 310 
HTTP Get Segment to the Web Server ...................................................................................... 311 
HTTP Get-Response Segment to the Web Client ...................................................................... 312 
Chapter Summary .............................................................................................................................. 314 
Chapter Glossary ............................................................................................................................... 315 
Chapter 11 – NetBIOS over TCP/IP .................................................................................................... 317 
Chapter Objectives ............................................................................................................................ 318 
NetBIOS over TCP/IP Overview ........................................................................................................ 319 
Enabling NetBIOS over TCP/IP...................................................................................................... 320 
NetBIOS Names ............................................................................................................................. 321 
Common NetBIOS Names .......................................................................................................... 322 
NetBIOS Name Registration, Resolution, and Release ................................................................. 323 
Name Registration ...................................................................................................................... 323 
Name Resolution ........................................................................................................................ 323 
TCP/IP Fundamentals for Microsoft Windows  
Page: xiii 
Name Release ............................................................................................................................ 324 
Segmenting NetBIOS Names with the NetBIOS Scope ID ............................................................ 324 
NetBIOS Name Resolution ................................................................................................................ 326 
Resolving Local NetBIOS Names Using a Broadcast .................................................................... 326 
Limitations of Broadcasts ............................................................................................................ 327 
Resolving Names with a NetBIOS Name Server ........................................................................... 327 
Windows Methods of Resolving NetBIOS Names ......................................................................... 327 
NetBIOS Node Types ........................................................................................................................ 329 
Using the Lmhosts File ...................................................................................................................... 330 
Predefined Keywords ..................................................................................................................... 330 
Using a Centralized Lmhosts File .................................................................................................. 331 
Creating Lmhosts Entries for Specific NetBIOS Names ................................................................ 332 
Name Resolution Problems Using Lmhosts ................................................................................... 333 
The Nbtstat Tool................................................................................................................................. 334 
Chapter Summary .............................................................................................................................. 335 
Chapter Glossary ............................................................................................................................... 336 
Chapter 12 – Windows Internet Name Service Overview ................................................................ 339 
Chapter Objectives ............................................................................................................................ 340 
Introduction to WINS .......................................................................................................................... 341 
How WINS Works .............................................................................................................................. 342 
Name Registration .......................................................................................................................... 342 
When a Duplicate Name Is Found .............................................................................................. 342 
When WINS Servers are Unavailable ........................................................................................ 343 
Name Renewal ............................................................................................................................... 343 
Name Refresh Request .............................................................................................................. 343 
Name Refresh Response ........................................................................................................... 343 
Name Release ................................................................................................................................ 343 
Name Resolution ............................................................................................................................ 344 
The WINS Client ................................................................................................................................ 345 
DHCP Configuration of a WINS Client ........................................................................................... 345 
Manual Configuration of the WINS Client Using Network Connections ......................................... 345 
Manual Configuration of the WINS Client Using Netsh .................................................................. 346 
TCP/IP Fundamentals for Microsoft Windows  
Page: xiv 
Configuration of the WINS Client for Remote Access Clients ........................................................ 347 
The WINS Server Service .................................................................................................................. 348 
Installing the WINS Server Service ................................................................................................ 348 
Properties of the WINS Server ....................................................................................................... 349 
Static Entries for Non-WINS Clients ............................................................................................... 350 
Database Replication Between WINS Servers .............................................................................. 351 
Push and Pull Operations ........................................................................................................... 353 
Configuring a WINS Server as a Push or Pull Partner ............................................................... 354 
Configuring Database Replication .............................................................................................. 354 
WINS Automatic Replication Partners ........................................................................................ 356 
The WINS Proxy ................................................................................................................................ 357 
How WINS Proxies Resolve Names .............................................................................................. 357 
WINS Proxies and Name Registration ........................................................................................... 358 
Configuration of a WINS Proxy ...................................................................................................... 359 
Chapter Summary .............................................................................................................................. 360 
Chapter Glossary ............................................................................................................................... 361 
Chapter 13 – Internet Protocol Security and Packet Filtering ........................................................ 363 
Chapter Objectives ............................................................................................................................ 364 
IPsec and Packet Filtering Overview ................................................................................................. 365 
IPsec .................................................................................................................................................. 366 
Security Properties of IPsec-protected Communications ............................................................... 366 
IPsec Protocols .............................................................................................................................. 367 
IPsec Modes ................................................................................................................................... 367 
Transport Mode .......................................................................................................................... 367 
Tunnel Mode ............................................................................................................................... 369 
Negotiation Phases ........................................................................................................................ 370 
Phase I or Main Mode Negotiation ............................................................................................. 371 
Phase II or Quick Mode Negotiation ........................................................................................... 372 
Connection Security Rules ............................................................................................................. 372 
IPsec Policy Settings ...................................................................................................................... 373 
General IPsec Policy Settings .................................................................................................... 373 
Rules ........................................................................................................................................... 375 
TCP/IP Fundamentals for Microsoft Windows  
Page: xv 
Default Response Rule ............................................................................................................... 376 
Filter List ..................................................................................................................................... 376 
Filter Settings .............................................................................................................................. 377 
Filter Action ................................................................................................................................. 377 
IPsec Security Methods .............................................................................................................. 379 
Custom Security Methods ........................................................................................................... 380 
Authentication ............................................................................................................................. 381 
Tunnel Endpoint .......................................................................................................................... 382 
Connection Type ......................................................................................................................... 382 
IPsec for IPv6 Traffic ...................................................................................................................... 383 
Packet Filtering .................................................................................................................................. 384 
Windows Firewall ........................................................................................................................... 384 
Configuring Rules with the Windows Firewall with Advanced Security Snap-in ........................ 385 
Configuring Windows Firewall with Control Panel ...................................................................... 385 
How Windows Firewall Works .................................................................................................... 386 
Internet Connection Firewall (ICF) ................................................................................................. 387 
TCP/IP Filtering .............................................................................................................................. 388 
Packet Filtering with Routing and Remote Access ........................................................................ 389 
Basic Firewall .............................................................................................................................. 390 
IP Packet Filtering ....................................................................................................................... 391 
IPv6 Packet Filtering ...................................................................................................................... 392 
Windows Firewall ........................................................................................................................ 393 
IPv6 Packet Filtering with Routing and Remote Access ............................................................ 393 
Basic IPv6 Firewall ..................................................................................................................... 393 
IPv6 ICF ...................................................................................................................................... 393 
Chapter Summary .............................................................................................................................. 395 
Chapter Glossary ............................................................................................................................... 396 
Chapter 14 – Virtual Private Networking ........................................................................................... 399 
Chapter Objectives ............................................................................................................................ 400 
Virtual Private Networking Overview.................................................................................................. 401 
Components of a VPN .................................................................................................................... 401 
Attributes of a VPN Connection...................................................................................................... 402 
TCP/IP Fundamentals for Microsoft Windows  
Page: xvi 
User Authentication .................................................................................................................... 403 
Encapsulation ............................................................................................................................. 403 
Encryption ................................................................................................................................... 403 
Types of VPN Connections ............................................................................................................ 403 
Remote Access ........................................................................................................................... 403 
Site-to-Site .................................................................................................................................. 405 
VPN Protocols .................................................................................................................................... 407 
Point-to-Point Protocol (PPP) ......................................................................................................... 407 
Phase 1: PPP Link Establishment .............................................................................................. 407 
Phase 2: User Authentication ..................................................................................................... 407 
Phase 3: PPP Callback Control .................................................................................................. 409 
Phase 4: Invoking Network Layer Protocol(s) ............................................................................ 409 
Data-Transfer Phase .................................................................................................................. 409 
Point-to-Point Tunneling Protocol (PPTP) ...................................................................................... 409 
Layer Two Tunneling Protocol with IPsec (L2TP/IPsec) ................................................................ 410 
Secure Socket Tunneling Protocol (SSTP) .................................................................................... 410 
Remote Access VPN Connections .................................................................................................... 412 
VPN Client Support ........................................................................................................................ 412 
Network Connections Folder ...................................................................................................... 412 
Connection Manager .................................................................................................................. 412 
VPN Server Support ....................................................................................................................... 413 
VPN Server Support in Windows Vista ....................................................................................... 414 
VPN Server Support in Windows XP .......................................................................................... 415 
IP Address Assignment and Routing and Remote Access ............................................................ 415 
Obtaining IPv4 Addresses via DHCP ......................................................................................... 415 
Obtaining IPv4 Addresses from a Static Address Pool .............................................................. 416 
The Process for Setting Up a Remote Access VPN Connection ................................................... 417 
Step 1: Logical Link Setup .......................................................................................................... 417 
Step 2: PPP Connection Setup .................................................................................................. 419 
Step 3: Remote Access VPN Client Registration ....................................................................... 419 
Site-to-Site VPN Connections ............................................................................................................ 420 