R1
R2
R3
R4
自治系统
自治系统
河南中医药大学信息技术学院互联网技术教学团队／https://internet.hactcm.edu.cn
---
## Page 169
169
6.路由选择协议
6.1有关路由选择的基本概念
互联网的两大类路由选择协议：
内部网关协议IGP （Interior Gateway Protocol） :
IRP
口在一个自治系统内部使用的路由选择协议。
·目前这类路由选择协议使用得最多，如RIP和OSPF协议。
■外部网关协议 EGP(External Gateway Protocol）：
ERP
口若源站和目的站处在不同的自治系统中，当数据报传到一个自治系统的边界时
外部网关协议EGP。
口在外部网关协议中目前使用最多的是BGP-4。
m.edu.cn
---
## Page 170
170
6.路由选择协议
6.1有关路由选择的基本概念
因特网的两大类路由选择协议：
自治系统 A
自治系统 B
用外部网关协议
(例如，BGP-4)
用内部网关协议
用内部网关协议
(例如，RIP)
(例如，OSPF)
自治系统之间的路由选择叫做域间路由选择（interdomainrouting)
自治系统内部的路由选择叫做域内路由选择（intradomainrouting)
河南中医药大学信息技术学院互联网技术教学团队／https://internet.hactcm.edu.cn
---
## Page 171
171
6.路由选择协议
6.1有关路由选择的基本概念
因特网的两大类路由选择协议：
互联网路由选择协议
域内路由选择
域间路由选择
内部网关协议 (IGP)
外部网关协议 (EGP)
距离向量
链路状态
路径向量
(Distance Vector)
(Link State)
(path vector)
RIP
OSPF
BGP
河南中医药大学信息技术学院互联网技术教学团队／https://internet.hactcm.edu.cn
---
## Page 172
R-7
R-3
Eth0/0/0:
：10.1.0.14/30
RS-9
SW-9
Host-18
GE0/0/0:
10.0.0.2/30
Host-1
SW-1
RS-1
GE 0/0/1:
Eth0/0/1:
10.1.0.17/30
10.0.0.5/30
GE 0/0/1
Eth0/0/2
Eth 0/0/1
GE 0/0/1
GE 0/0/1:
100.1.1.1/30
10.1.4.2/30
GE0/0/3:
GE 0/0/2:
GE 0/0/1
Eth 0/0/1
10.1.5.2/30
GE 0/0/1
GE 0/0/24
Eth 0/0/2
GE 0/0/24
R-4
RS-9
Host-17
Host-2
R-1
RS-1
Vlanif10:
192.168.72.254/24
GE0/0/0:
10.0.0.1/30
Eth0/0/0:
10.1.0.1/30
Vlanif02:
172.16.64.254/24
GE 0/0/1:
Eth 0/0/1:
Vlanif11:
192.168.73.254/24
10.0.1.2/30
10.1.0.18/30
Vlanif03:
172.16.65.254/24
10.0.2.2/30
GE 0/0/0:
10.1.0.10/30
Vlanif100:10.1.5.1/30
GE 0/0/2:
Vlanif100:
10.0.1.1/30
R-7
GE0/0/3:
10.0.0.10/30
GE 0/0/3:
100.1.1.2/30
/GE0/0/2
RS-8
SW-8
GE 0/0/1
Host-16
GE 0/0/24
Eth 0/0/2
Host-3
SW-2
RS-2
GE 0/0/1
R-1
R
Eth o/0/1
GE 0/0/1
Eth 0/0/1
GE 0/0/24
Eth 0/0/1
GE 0/0/1
GE 0/0/1
R
RS-8
Eth 0/0/2
GE 0/0/1
GE 0/0/2
GE0/0/0
Eth 0/0/0
Vlanifo8:
192.168.70.254/24
Host-4
192.168.71.254/24
Host-15
RS-2
Vlanif09:
GE 0/0/3
Vlanif04:
172.16.66.254/24
Vlanif100:
10.1.4.1/30
Vlanif05:
172.16.67.254/24
R-3
R-4
R-6
Eth 0/0/0
Eth 0/0/1
RS-7
SW-7
Vlanif100:
10.0.2.1/30
GE 0/0/0
GE 0/0/3
GE 0/0/0
GE 0/0/24
GE 0/0/1
Host-14
Eth0/0/2
RS-3
GE 0/0/1
R
GE 0/0/3
R
GE 0/0/0
Eth0/0/1
Vlanif06:
：172.16.68.254/24
GE 0/0/1
GE 0/0/1
Vlanif07:
172.16.69.254/24
Eth 0/0/0
RS-7
Vlanif100:
10.0.3.1/30
Eth 0/0/1
Vlanif06:
192.168.68.254/24
GE 0/0/1
Vlanif07:
192.168.69.254/24
Host-13
SW-3
RS-3
GE 0/0/0
GE 0/0/1
Vlanif100:
GE 0/0/2
Eth 0/0/1
10.1.3.1/30
Eth 0/0/1
R-2
RS-6
SW-6
Eth 0/0/2
GE 0/0/1
GE 0/0/24
R
Eth 0/0/0
GE 0/0/2
GE 0/0/1
Host-5
Eth0/0/2
R-5
Host-12
GE 0/0/3
RS-4
GE 0/0/24
GE 0/0/1
Eth0/0/1
Vlanif08:
172.16.70.254/24
R-2
R-6
GE 0/0/1
RS-6
Vlanif09:
172.16.71.254/24
GE0/0/0:
10.0.0.6/30
Eth0/0/0:
10.1.0.13/30
Vlanif04:
192.168.66.254/24
Host-6
Vlanif100:
10.0.4.1/30
GE0/0/1:
10.0.0.9/30
Eth 0/0/1:
10.1.0.6/30
Vlanif05:
192.168.67.254/24
Host-11
SW-4
RS-4
GE 0/0/2:
10.0.3.2/30
GE0/0/0:
10.1.0.9/30
Vlanif100:
10.1.2.1/30
Eth 0/0/1
GE 0/0/1
GE 0/0/24
GE 0/0/3:
10.0.4.2/30
GE 0/0/1:
10.1.3.2/30
RS-5
SW-5
Eth0/0/2
GE 0/0/24
GE 0/0/1
Eth 0/0/2
GE 0/0/1
R-5
Host-7
Eth 0/0/0:
:10.1.0.2/30
GE 0/0/1
Eth 0/0/1
Eth0/0/1:
10.1.0.5/30
Host-10
GE 0/0/1:
10.1.1.2/30
RS-5
GE 0/0/2:
10.1.2.2/30
Vlanif02:
192.168.64.254/24
Host-8
Vlanif03:
192.168.65.254/24
Vlanif100:
10.1.1.1/30
Host-9
---
## Page 173
173
6.路由选择协议
6.2内部网关协议 RIP
路由信息协议（RoutingInformationProtocol，RIP）是内部网关协议lGP
中最先得到广泛使用的协议
RIP是一种分布式的基于距离向量的路由选择协议，是因特网的标准协议。
RIP最大优点是：简单。
RIP要求网络中的每个路由器都要维护从它自己到其他每一个目的网络的距
离记录。
广泛使用很重要，一种技术只有广泛使用，才能够形成生态体系。
河南中医药大学信息技术学院
---
## Page 174
174
6.路由选择协议
6.2内部网关协议RIP
口RIP对"距离"的定义：
■从路由器到直接连接的网络的距离=1。
■路由器到非直接连接的网络的距离=所经过的路由器数+ 1。
■RIP中的"距离"也称为"跳数”（hopcount)，每经过一个路由器，跳数就加1
口好路由="距离短"的路由。
■最佳路由="距离最短"的路由。
■一条路径最多只能包含15个路由器。
■"距离"的最大值为16时即相当于不可达。
RIP不能在两个网络之间同时使用多条路由，只选择距离最短"的路由，
河南中医药大学信息技术学院
---
## Page 175
175
6.路由选择协议
6.2内部网关协议RIP
口RIP的三个特点：
■仅和相邻路由器交换信息。
交换的信息是当前本路由器所知道的全部信息，即自己的路由表。
■按固定的时间间隔交换路由信息，例如，每隔30秒，然后路由器根据收到的
路由信息更新路由表。
1当网络拓扑发生变化时，路由器也及时向相邻路由器通告拓扑变化后的路由
信息。
---
## Page 176
176
6.路由选择协议
6.2内部网关协议RIP
口路由表的建立过程：
■首先：路由器在刚刚开始工作时，路由表是空的。
■然后：路由器得出到直接连接的网络的距离，距离定义为1。
■接看：每一个路由器也只和数目非常有限的相邻路由器交换并更新路由信息。
以后：经过若干次更新后，所有的路由器最终都会知道到达本自治系统中任
何一个网络的最短距离和下一跳路由器的地址。
■RIP的收敛(convergence)过程较快，即在自治系统中所有的结点都得到正确
的路由选择信息的过程较短。
---
## Page 177
177
6.路由选择协议
6.2内部网关协议RIP
口RIP路由表的主要信息和更新规则：
■RIP 路由表的主要信息是：目的网络、距离(最短)、下一跳地址
目的网络
距离 (最短)
下一跳地址
■路由表更新规则：
口使用距离向量算法找出到达每个目的网络的最短距离。
河南中医药大学信息技术学院互联
n.edu.cn
---
## Page 178
178
6.路由选择协议
6.2内部网关协议RIP
口距离向量算法：
■对每个相邻路由器（假设其地址为X）发送过来的RIP报文，路由器：
修改RIP报文中的所有项目（即路由）：把"下一跳"字段中的地址都改为×，并
把所有的"距离"字段的值加1。
②对修改后的RIP报文中的每一个项目，重复以下步骤：
1.
若路由表中没有目的网络门，则把该项目添加到路由表中。否则
I.
若路由表中网络卜的下一跳路由器为×，则用收到的项目替换原路由表中的项目。否则
若收到项目中的距离小于路由表中的距离，则用收到项目更新原路由表中的项目。否则
IV
什么也不做。
若3分钟还未收到相邻路由器的更新路由表，则把此相邻路由器记为不可达路由
3
器，即将距离置为16（表示不可达）。
④返回。
河南中医药大学信息技术学院互联网技术教学团队／https://int
cm.edu.cr
---
## Page 179
179
6.路由选择协议
6.2内部网关协议RIP
距离向量算法：
■算法基础：
o）
算法要点
设× 是结点 A 到B 的最短路径上的一个结点。
若把路径 A→B 拆成两段路径 A→X 和×→B，则每一段路径 A→X 和×→B 也都分
别是结点 A 到 × 和结点 × 到 B 的最短路径。
最短路径
X
B
最短路径
最短路径
河南中医药大学信息技术学院
---
## Page 180
180
6.路由选择协议
6.2内部网关协议RIP
口路由器之间交换信息：
器器中
甲限目一器甲一能笔甲重共
短的（即跳数最少）。
个路由器的位置不同，它们的路由表也是不同的。
河南中医药大学信息技术学
---
## Page 181
181
6.路由选择协议
6.2内部网关协议RIP
【例】已知路由器R6有表4-8（a）所示的路由表。现在收到相邻路由器R4发来的路由
更新信息，如表4-8（b）所示。试更新路由器R6的路由表。
表 4-8(a）路由器 Rg的路由表
表4-8(b）R4发来的路由更新信息
目的网络
距离
下一跳路由器
目的网络
距离
下一跳路由器
Net2
3
R4
Net1
3
R1
Net3
4
R5
Net2
4
R2
Net3
1
直接交付
计算
距离+1，修改下一跳地址
更新
?
③
表4-8(d）路由器R,更新后的路由表
表4-8(c）修改后的表4-8(b)
目的网络
距离
下一跳路由器
目的网络