User: 请解答这个和日志有关的问题Configure nginx to proxy GitLab CE (both a docker container) The two following docker containers are running on my machine: 

nginx                     0.0.0.0:80-&gt;80/tcp, 0.0.0.0:443-&gt;443/tcp                               nginx
gitlab/gitlab-ce:latest   0.0.0.0:32782-&gt;22/tcp, 0.0.0.0:32781-&gt;80/tcp, 0.0.0.0:32780-&gt;443/tcp   gitlab


At the moment I cannot figure out how to configure nginx to reverse proxy the user request. If a user enters http://gitlab.domain.com my setup returns a 502 Bad Gateway Error.

Server config:
    server{
        listen 80;
        listen [::]:80;
        server_name gitlab.domain.com www.gitlab.domain.com;

        location / {
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header HOST $http_host;
            proxy_set_header X-NginX-Proxy true;

            proxy_pass http://gitlab:32781;
            proxy_redirect off;
        }
}

Assistant: For me worked following configuration for jwilder/nginx-proxy container.

web:
  image: 'gitlab/gitlab-ce:latest'
  hostname: 'gitlab.it-expert.com.ua'
  environment:
    GITLAB_OMNIBUS_CONFIG: |
      external_url 'https://gitlab.it-expert.com.ua'
      registry_external_url 'https://registry.it-expert.com.ua'
    VIRTUAL_HOST: gitlab.it-expert.com.ua,registry.it-expert.com.ua
    VIRTUAL_PORT: 443
    VIRTUAL_PROTO: https
  volumes:
    - './data/config:/etc/gitlab'
    - './data/logs:/var/log/gitlab'
    - './data/data:/var/opt/gitlab'


Tricky part was to figure out how containers is connected and which and who should process SSL.

For this configuration you should supply SSL certificates both for nginx-proxy and gitlab-ce containers, because communications between them is also using SSL. For gitlab-ce use ./data/config/ssl folder.

You can find out in my blog post how to quickly get valid certificate from Let's encrypt via handy docker container certbot.