time is already small. Figure 20 shows the CDF of the con-
tent download time for high and low expectation countries
before and after the roll-out. All percentiles show improve-
ment, e.g., the 75th percentile of the download time reduces
300
)
s
m
(
T
T
R
200
100
expectation
high
low
1250
1000
750
500
)
s
m
(
e
t
y
b
t
s
r
i
f
o
t
e
m
T
i
expectation
high
low
0
Jan
Feb
Mar
Apr
May
Jun
Jul
Jan
Feb
Mar
Apr
May
Jun
Jul
Figure 15: Daily Mean of Round Trip Time (RTT).
Figure 17: Daily Mean of Time to First Byte (TTFB).
s
t
n
e
m
e
r
u
s
a
e
m
M
U
R
f
o
t
n
e
c
r
e
p
e
v
i
t
l
a
u
m
u
C
100%
75%
50%
25%
0%
s
t
n
e
m
e
r
u
s
a
e
m
M
U
R
f
o
t
n
e
c
r
e
p
e
v
i
t
l
a
u
m
u
C
100%
75%
50%
25%
0%
low expectation after rollout
low expectation before rollout
high expectation after rollout
high expectation before rollout
low expectation after rollout
low expectation before rollout
high expectation after rollout
high expectation before rollout
0
200
RTT (ms)
400
600
0
1000
2000
Time to first byte (ms)
3000
Figure 16: CDFs of Round Trip Time (RTT).
Figure 18: CDFs of Time to First Byte (TTFB).
from 272 ms to 157 ms for the high expectation group and
from 192 ms to 102 ms for the low expectation one.
4.4 Why Download Performance Matters
From our results above, we can conclude that end-user
mapping provides signiﬁcant performance beneﬁts to clients
who use public resolvers, especially in those countries where
client-LDNS distances are high. Faster download times such
as those provided by end-user mapping are key to a better
Internet experience, resulting in web pages that load more
quickly and videos that start playing sooner. Better down-
load performance enhances the client’s experience of a con-
tent provider’s Web site, more satisﬁed clients in turn favor-
ably impact the business of the content provider, allowing
the content provider to invest in even greater performance
enhancements, forming a “virtuous cycle” [25]. As an ex-
ample, an oft-cited recent study by Walmart labs [12] con-
cluded that the download time of Web pages in Walmart’s
e-commerce site impacts the buying behavior of its users.
By correlating RUM performance measurements collected
for Walmart.com with back-end business metrics, the study
concluded that a 100 ms decrease in web page download
time can result in a 1% increase in revenue and a 1 sec-
ond decrease can result in up to a 2% increase in conversion
rates9. Numerous other studies show how even a few 100
ms increase in page download times of a Web site can de-
crease revenues, page views, searches per user, etc [9]. In
fact, it is widely held in industry that a Web site that is faster
than its competing sites by as little as 250 ms has a signif-
icant business advantage to be reckoned with [18]. In ad-
dition, search engines rank faster Web sites ahead of slower
ones and clients often associate greater brand reputation with
faster Web sites. Thus, the “need for speed” is a singular fo-
cus for content providers and the CDNs alike and “shaving
off” even tens of milliseconds of Web download times for
a cross-section of clients is deemed worthy and important.
Besides faster download times, the decrease in mapping dis-
tance and RTT due to end-user mapping often means that
the client-server path crosses fewer AS boundaries, peering
points and transnational cable links, hence reducing the like-
lihood of congestion and failure. Thus, end-user mapping
may result in more stable and reliable client-server paths.
4.5 The Beneﬁts of EDNS0 Adoption
To deploy end-user mapping beyond the current set of
clients, the client’s ISP needs to adopt the EDNS0 exten-
9Conversion rate is a key metric for e-commerce sites and is
the percentage of visitors to the site who buy a product.
176
400
)
s
m
(
e
m
i
t
l
d
a
o
n
w
o
d
t
n
e
t
n
o
C
300
200
100
expectation
high
low
0
Jan
Feb
Mar
Apr
May
Jun
Jul
Figure 19: Daily mean of content download time.
s
t
n
e
m
e
r
u
s
a
e
m
M
U
R
f
o
t
n
e
c
r
e
p
e
v
i
t
l
a
u
m
u
C
100%
75%
50%
25%
0%
0
low expectation after rollout
low expectation before rollout
high expectation after rollout
high expectation before rollout
250
500
Content download time (ms)
750
1000
Figure 20: CDFs of content download time.
sion for their DNS services. Our results shed light on the
performance beneﬁts such adoption would yield and pro-
vides a strong impetus for its adoption. For instance, ex-
cluding the public resolvers, we know that 6.2% of the re-
maining client demand originates from clients whose LDNS
are at least 1000 miles away. Extrapolating from our results
for similar clients using public resolvers, we could expect
a similar 50% reduction in RTT and content download time
for these clients. Likewise, excluding the public resolvers,
clients with LDNSes between 500 to 1000 miles account for
5.3% of remaining client demand. Extrapolating from sim-
ilar clients who use public resolvers, we can speculate that
these clients will see a 24% decrease in RTTs and content
download times. Of course, 54% of the remaining client
demand will see no beneﬁt at all from end-user mapping,
since they have local LDNSes. However, the fact that at least
11.5% of the remaining client demand will see a signiﬁcant
enough performance improvement is sufﬁcient impetus to
EDNS0 adoption.
more clients than there are name servers on the global In-
ternet. An end-user mapping system must perform more
ﬁne-grain network measurements and provide resolutions at
a ﬁner scale across the global Internet than a NS-based map-
ping, leading to scaling considerations discussed below.
5.1 Tradeoffs in choosing the mapping units
A mapping unit is the ﬁnest-grain set of client IPs for
which server assignment decisions are made by the map-
ping system. A traditional NS-based mapping system uses a
LDNS as the mapping unit, i.e., all clients in the client clus-
ter that use a LDNS are mapped together as a unit. An end-
user mapping system could use /x client IP blocks that parti-
tion the client IP space, where x  24. A natural ﬁrst choice
is /24 client IP blocks since LDNSes that support the EDNS0
extension currently use /24 IP blocks in their queries.
To understand the scaling issues in switching from NS-
based to end-user mapping, let us ﬁrst examine the number
of relevant /24 client IP blocks on the Internet in compari-
son to the number of relevant LDNSes. We use our NetSes-
sion data to ﬁrst compute the demand generated by clients
in each /24 client IP block. We also computed the demand
generated by each LDNS, where the LDNS demand is sim-
ply the demand generated by clients who use that LDNS.
We then sorted all the /24 client IP blocks (resp., LDNSes)
in decreasing order of demand and plotted a CDF of the de-
mand in Figure 21. In the data set, the total number of /24
client IP blocks with non-zero demand is 3.76 million, while
584 thousand LDNSes have non-zero demand. Suppose the
mapping system is required to measure and provide mapping
decisions for 95% of the total client demand on the Internet.
As the ﬁgure shows, an NS-based mapping system need only
measure and analyze the top 25,000 LDNSes with the most
demand, whereas an end-user mapping system must measure
and analyze the top 2.2 million /24 client IP blocks, which
is several magnitudes higher. Likewise, to cover 50% of the
total client demand, the top 1800 LDNSes with the most de-
mand sufﬁce, whereas nearly 430,000 of the /24 client IP
blocks with the most demand are needed.
d
n
a
m
e
d
l
a
o
t
t
f
o
t
n
e
c
r
e
p
e
v
i
t
l
a
u
m
u
C
Client IP blocks
LDNS
100%
75%
50%
25%
0%
1e+01
1e+02
1e+05
Number of client IP blocks or LDNS
1e+03
1e+04
1e+06
5. SCALING CHALLENGES
End-user mapping is challenging since it makes mapping
decisions at potentially a much ﬁner granularity than tradi-
tional NS-based mapping. There are orders of magnitude
Figure 21: Number of /24 client IP blocks or LDNSes that
produce a given percent of total global demand.
One heuristic approach to reducing the number of map-
177
d
n
a
m
e
d
t
n
e
i
l
c
l
a
o
t
t
f
o
t
n
e
c
r
e
p
e
v
i
t
l
a
u
m
u
C
100%
●
●
●
●
75%
50%
25%
0%
prefix
● /24
/22
/20
/18
/16
/14
/12
/10
/8
400000
s
r
e
t
s
u
c
f
l
o
r
e
b
m
u
N
300000
200000
100000
0
10
100
1000
Cluster radius (miles)
10000
/8
/10
/12
/14
Prefix length
/16
/18
/20
/22