行连接的物理接口和电缆。对于不同厂商的CPU，其调试端口的信号数
量和物理形式有所不同，因此也就要求JTAG工具需要有不同的接口与
之连接。但因为调试端口包含的信号中真正用到的主要是5路JTAG信
号，所以很多JTAG工具厂商都设计了各种各样的转接口，以便支持更
多的目标系统。本节下文会详细介绍与IA架构的被调试系统相连接的各
种方式。
（2）缓存和控制仪：JTAG工具的核心部件，通常是一个小盒子，
用于通过JTAG协议与目标系统的被调试芯片通信。它的面板上有一些
基本的显示和控制界面（开关等），其内部主要包含有接口电路、控制
电路和用于缓存（buffer）数据的存储器。这个小盒子的名称有几种叫
法，如JTAG调试器、JTAG仿真器等，或者干脆就称为硬件调试器。
（3）上位机接口：与调试机（debugger）连接的物理接口和电
缆。通常有两种形式：一种是通过专用的PCI插卡插入调试机的PCI插槽
中；另一种是使用USB这样的通用接口，只要插入调试机的空闲USB口
即可。
（4）调试软件：供调试人员调试目标系统的软件环境，通常是一
个增强的软件调试器，除了具备普通软件调试器的各种调试功能外，它
还具有增强的设置JTAG端口、设置硬件断点、查看目标系统的底层信
息等各种功能。
基于JTAG标准的调试工具有很多，其名称也各不相同，如××仿真
器、××ICE、××调试器等。尽管有些文档将ICE调试和JTAG调试混淆使
用，但是我们应该清楚这两个术语本质上是有差异的。ICE的内涵就是
指用调试工具“冒充”被调试系统中的某一部件（常常是微处理器）以实
现观察和调试目标系统的目的。可以将ICE理解为一种调试思想，有很
多种具体手段来实现这种思想。而JTAG调试是指基于JTAG标准（边界
扫描技术和TAP）的一种实现途径，它支持包括ICE在内的各种调试功
能。总之，ICE调试和JTAG调试是两种不同角度的命名方法，它们之间
既有联系，又有区别。
7.3.2 调试端口
调试端口（debug port是指被调试系统上用来与调试工具连接的物
理接口或接头（header）——通常是位于电路板上的一个方形接口（接
头）。以针对IA-32处理器设计的主板为例，调试端口主要有ITP（30
针）、ITP700（25针）和XDP（60针）3种（见7.4节）。
尽管大多数主板上都留有调试端口所需的电路，在开发阶段的样板
中也配有调试端口，但是在大批量生产时往往不再焊接调试接头。那
么，如果要再调试这样的系统怎么办？一种常见的方法就是使用图7-5
所示的转接头（interposer）。将该接头插到目标主板的插槽上，然后再
将CPU插在该接头上——该接头带有调试端口。对于不同的CPU插槽，
应该使用不同的转接头。
图7-5 带有调试端口的CPU转接头（interposer）
7.4 IA处理器的JTAG支持
奔腾处理器是IA处理器中最早实现JTAG支持的处理器，其后的IA-
32处理器也都包含了这一支持。下面先以P6系列处理器为例介绍IA-32
处理器的JTAG支持，然后介绍探测模式和ITP/XDP端口。
7.4.1 P6处理器的JTAG实现
首先，P6处理器的管脚包含了JTAG标准定义的所有5种信号，即测
试时钟信号TCK、测试模式选择信号TMS、测试数据输入信号TDI、测
试复位信号TRST#和测试数据输出信号TDO。
P6处理器实现了7条TAP指令，其中包括3条JTAG标准规定必须实
现的指令和4条可选指令。P6处理器的TAP指令的长度为6个比特位，其
操作码定义见表7-1。
表7-1 P6处理器的TAP指令（选自《P6系列处理器硬件开发手册》）
TAP 指令
操作码
处理器管
脚输入来
源
选中的
TAP数据
寄存器
状 态 动 作
Run-Test
/Idle
Capture-
DR
Shift-
DR
Update-
DR
EXTEST
000000 边界 扫描
单元
边界扫描
寄存器
—
对所有处理
器的管脚采
样
移位
数据
寄存
器
更新数
据寄存
器
SAMPLE/
PRELOAD 000001 —
边界扫描
寄存器
—
对所有处理
器的管脚采
样
移位
数据
寄存
器
更新数
据寄存
器
IDCODE
000010 —
设备ID
寄存器
—
加载处理器
的唯一标识
代码
移位
数据
寄存
器
—
CLAMP
000100 边界 扫描
单元
旁路 寄
存器
—
复位旁路寄
存器
移位
数据
寄存
器
—
RUNBIST
000111 边界 扫描
单元
BIST结
果寄存器
开始自检
测试
（BIST）
捕捉自检结
果
移位
数据
寄存
器
—
HIGHZ
001000 悬置
（floated）
旁路 寄
存器
—
复位旁路寄
存器
移位
数据
寄存
器
—
BYPASS
111111 —
旁路 寄
存器
—
复位旁路寄
存器
移位
数据
寄存
器
—
表7-1的第3列是相应指令执行期间处理器核心的输入来源，第4列
是指令要选中的数据寄存器，第5～8列是指在状态机的Run-Test/Idle、
Capture-DR、Shift-DR和Update-DR状态时TAP控制器所采取的动作。以
RUNBIST指令为例，其指令编码（操作码）为000111，在此指令执行
期间，处理器的输入是由边界扫描单元驱动的，RUNBIST指令会选中
BIST结果寄存器，使其与TDI和TDO形成通路，在Run-Test/Idle状态，
TAP控制器执行的操作是开始自检测试（Built-In Self Test，BIST），在
Capture-DR状态，会将自检结果捕捉到BIST结果寄存器，在Shift-DR状
态，会对BIST结果寄存器进行移位操作。
表7-2列出了P6处理器的所有TAP数据寄存器、每个寄存器的长度
和选中该寄存器的TAP指令。
表7-2 P6处理器的TAP数据寄存器
TAP数据寄存器
长  度
哪些指令会选中该寄存器
旁路寄存器
1
BYPASS、HIGHZ、CLAMP
设备ID寄存器
32
INCODE
BIST 结果寄存器
1
RUNBIST
边界扫描寄存器
159
EXTEST、SAMPLE/PRELOAD
边界扫描寄存器的长度是159个比特位，这与P6处理器的输入输出
信号的数量相吻合，也就是每个输入输出信号都配备有一个边界扫描单
元，用以控制和记录该信号。
设备ID寄存器的长度是32位，被划分成几个部分用以表示版本型号
等信息，详细定义见表7-3。
表7-3 P6处理器的设备ID寄存器