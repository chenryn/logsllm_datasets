### JTAG调试工具及其组件

#### 1. 物理接口和电缆
不同厂商的CPU调试端口在信号数量和物理形式上存在差异，因此JTAG工具需配备多种接口以实现与这些端口的连接。尽管如此，由于调试过程中主要使用的信号为5路JTAG信号，许多JTAG工具制造商设计了各种转接适配器来支持更多的目标系统。接下来的部分将详细介绍与IA架构被调试系统相连接的各种方式。

#### 2. 缓存与控制单元
作为JTAG工具的核心部件，通常表现为一个小盒子，通过JTAG协议与目标系统的待调试芯片进行通信。该设备的面板上包含基本的显示及控制界面（例如开关），内部则集成了接口电路、控制电路以及用于数据缓存的存储器。这类装置有几种不同的叫法，如JTAG调试器或仿真器，有时也被简单地称为硬件调试器。

#### 3. 上位机接口
这部分指的是连接到调试计算机（debugger）的物理接口及相应电缆。常见的连接方法有两种：一种是通过专用PCI插卡插入调试计算机的PCI插槽；另一种则是利用USB等通用接口直接接入调试计算机的空闲USB端口。

#### 4. 调试软件
这是一种专为调试人员提供的软件环境，通常基于增强版的软件调试器构建。除了具备标准软件调试器的所有功能外，它还增加了设置JTAG端口、配置硬件断点以及查看目标系统底层信息等功能。

### JTAG与ICE的区别
市场上有许多遵循JTAG标准开发的调试工具，它们可能有不同的名称，比如××仿真器、××ICE或××调试器。需要注意的是，虽然某些文档可能会混淆使用ICE调试和JTAG调试这两个术语，但两者之间实际上存在着本质上的区别。ICE技术是指用特定的调试工具代替被测系统中的某个组件（通常是微处理器），以便观察并调试整个系统的行为。可以说，ICE代表了一种调试理念，并可通过多种具体手段加以实现。相比之下，JTAG调试则是指依据JTAG标准（边界扫描技术和TAP）执行的一种特定调试方式，它能够支持包括ICE在内的多种调试需求。简而言之，ICE调试和JTAG调试是从不同角度出发的两种命名体系，既相互关联又有所区分。

### 7.3.2 调试端口
调试端口指的是位于被调试系统上用于连接调试工具的物理接口或接头——一般是在电路板上找到的一个方形接口。对于针对IA-32处理器设计的主板而言，常见的调试端口类型包括ITP（30针）、ITP700（25针）和XDP（60针）。虽然大多数主板都会预留出调试端口所需的电路布局，并且在开发阶段会安装相应的接头，但在大规模生产时往往不会焊接这些接头。如果需要对没有焊接调试接头的系统进行调试，则可以采用图7-5所示的转接器。将此转接器插入目标主板的插槽中，再将CPU安装于转接器之上即可解决问题。值得注意的是，针对不同类型的CPU插槽，应当选用相匹配的转接器。

**图7-5 带有调试端口的CPU转接器**

### 7.4 IA处理器的JTAG支持
奔腾处理器是首个引入JTAG支持的IA系列处理器，之后所有的IA-32处理器也都延续了这一特性。本节将以P6系列处理器为例介绍IA-32处理器的JTAG实现情况，并进一步探讨探测模式以及ITP/XDP端口的相关知识。

#### 7.4.1 P6处理器的JTAG实现
P6处理器在其引脚设计中包含了JTAG标准定义的所有五种信号：测试时钟信号(TCK)、测试模式选择信号(TMS)、测试数据输入信号(TDI)、测试复位信号(TRST#) 和测试数据输出信号(TDO)。
此外，P6处理器实现了七条TAP指令，其中包括三条强制性指令和四条可选指令。表7-1列出了这些指令的操作码及相关信息。

**表7-1 P6处理器的TAP指令**

| TAP 指令 | 操作码 | 处理器管脚输入来源 | 选中的TAP数据寄存器 | 状态动作 |
| --- | --- | --- | --- | --- |
| Run-Test/Idle | 000000 | 边界扫描单元 | 边界扫描寄存器 | 对所有处理器的管脚采样 |
| Capture-DR | 000001 | — | 边界扫描寄存器 | 移位数据寄存器 |
| Shift-DR | 000010 | — | 设备ID寄存器 | 更新数据寄存器 |
| Update-DR | 000100 | 边界扫描单元 | 旁路寄存器 | 复位旁路寄存器 |
| EXTEST | 000111 | 边界扫描单元 | BIST结果寄存器 | 开始自检测试 (BIST) |
| CLAMP | 001000 | 悬置 (floated) | 旁路寄存器 | 移位数据寄存器 |
| BYPASS | 111111 | — | 旁路寄存器 | — |

表7-2展示了P6处理器的所有TAP数据寄存器及其长度和相关的TAP指令。

**表7-2 P6处理器的TAP数据寄存器**

| TAP数据寄存器 | 长度 (比特) | 哪些指令会选中该寄存器 |
| --- | --- | --- |
| 旁路寄存器 | 1 | BYPASS, HIGHZ, CLAMP |
| 设备ID寄存器 | 32 | IDCODE |
| BIST 结果寄存器 | 1 | RUNBIST |
| 边界扫描寄存器 | 159 | EXTEST, SAMPLE/PRELOAD |

边界扫描寄存器的长度为159比特，正好对应P6处理器的所有输入输出信号的数量，即每个信号都配有独立的边界扫描单元以实现对该信号的控制与监测。而设备ID寄存器则由32位组成，其具体内容见表7-3。

**表7-3 P6处理器的设备ID寄存器**
（此处省略具体细节，因为原文未提供）

通过以上描述可以看出，P6处理器不仅完全符合JTAG标准的要求，而且还额外提供了若干高级特性，使得用户能够在更加复杂的应用场景下进行高效的调试工作。