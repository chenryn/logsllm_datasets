HIT2006
HIT2006
Spyware Detection : 
Spyware Detection : 
Automated Behavior Analysis System
Automated Behavior Analysis System
Birdman 
Birdman 
2006
2006--07
07--16
16
XX--Solve 
Solve 
Automated Behavior Analysis Approach, Birdman, HIT2006
Automated Behavior Analysis Approach, Birdman, HIT2006
2
Abstract 
Abstract 
分析目前流行的
分析目前流行的Spyware
Spyware设计手法与运作模型。并介绍我
设计手法与运作模型。并介绍我
们所开发的自动化的惡意程式行为分析系统与整合型
们所开发的自动化的惡意程式行为分析系统与整合型
Spyware
Spyware侦察工具，用來协助资安人员研究新的
侦察工具，用來协助资安人员研究新的Spyware
Spyware与
与
惡意程式行为模型。
惡意程式行为模型。
Birdman
Birdman
PI:EMAIL, XX--Solve
Solve
Our WebSite →Http://x-solve.com/blog
Column Writer
http://www.informationsecurity.com.tw
MSDN Flush Writer 
http://www.microsoft.com/taiwan/msdn
勇
勇
X-Solve, Inc. is a company focusing on 
developing IT Security technology for the 
reliable and high assurance detection and 
eradication of Spyware and Rootkit. 
Automated Behavior Analysis Approach, Birdman, HIT2006
Automated Behavior Analysis Approach, Birdman, HIT2006
3
Outline
Outline
What is Spyware?
What is Spyware?
The Malicious Behavior Models of Spyware
The Malicious Behavior Models of Spyware
Strategy of Spyware Analysis and Detection
Strategy of Spyware Analysis and Detection
Archon Scanner
Archon Scanner -- Spyware Detection Tools
Spyware Detection Tools
Archon Analyzer
Archon Analyzer -- Automated Malicious Behavior Analyzer
Automated Malicious Behavior Analyzer
Conclusion
Conclusion
Automated Behavior Analysis Approach, Birdman, HIT2006
Automated Behavior Analysis Approach, Birdman, HIT2006
4
What is Spyware?
What is Spyware?
Definition
Definition
Spyware is considered a malicious program in that users 
unwittingly install the product when they install something else. 
There are two types of Spyware.
There are two types of Spyware.
Commercial Purpose
 This type Spyware do track your surfing habits in order to serve ads 
related to user.
 Adware, Browser Hijacker or other unwanted software
Invasive Purpose
 This type is designed for hacker, they are more malicious than 
another type. Hacker utilizes them to collect private data of the 
certain victims or penetrate into computer system.
 Trojan Horse, Backdoor, key-logger, Rootkit and other hacking tools.
Now, we will 
discuss this one in 
the following slices.
Automated Behavior Analysis Approach, Birdman, HIT2006
Automated Behavior Analysis Approach, Birdman, HIT2006
5
Virus VS. Spyware
Virus VS. Spyware
Virus VS. Spyware
Virus
Virus
Spyware
Spyware
The Difference Between Virus & Spyware?
The Difference Between Virus & Spyware?
Active and Large
Active and Large--scale Attack
scale Attack
Low Mutation
Low Mutation
No Specific Target and Localization
No Specific Target and Localization
Do Destruction
Do Destruction
Passive, Small
Passive, Small--scale and Stealth
scale and Stealth
High Mutation, Customize
High Mutation, Customize
Specific Target, Localization
Specific Target, Localization
Do Information Collection
Do Information Collection
Automated Behavior Analysis Approach, Birdman, HIT2006
Automated Behavior Analysis Approach, Birdman, HIT2006
6
The Malicious Behavior Models of Spyware
The Malicious Behavior Models of Spyware
Traditional Spyware Behavior
Traditional Spyware Behavior
Spyware exists as independent executable programs 
Modern Spyware Behavior
Modern Spyware Behavior
EXE
DLL
DLL
EXE
EXE
SYS
SYS
Shellcode
Shellcode
Traditional Spyware
Modern Spyware
Automated Behavior Analysis Approach, Birdman, HIT2006
Automated Behavior Analysis Approach, Birdman, HIT2006
7
Case Study 1 : DLL Injection
Case Study 1 : DLL Injection
This one is a kind of DLL Injection Spyware. It 
This one is a kind of DLL Injection Spyware. It 
will inject a DLL into 
will inject a DLL into Explorer.exe
Explorer.exe and IE.
and IE.
Oh YA! ^_^
Really Happy
Oh YA! 
Oh YA! ^_^
^_^
Really Happy
Really Happy
Spyware Dropper
Comph.dll
Comph.dll
Comph.dll
Comph.dll
Comph.dll
Comph.dll
Comph.dll
Comph.dll
Comph.dll
Drop Spyware (
Drop Spyware (comph.dll
comph.dll))
Inject DLL into Explorer
Inject DLL into Explorer
Explorer Create invisible IE Process
Explorer Create invisible IE Process
Inject DLL into IE
Inject DLL into IE
Automated Behavior Analysis Approach, Birdman, HIT2006
Automated Behavior Analysis Approach, Birdman, HIT2006
8
Spyware Behavior
Spyware Behavior
EXE or Process are insufficient !
EXE or Process are insufficient !
Different from traditional Spyware, the sophisticated Spyware 
have not just one EXE. They appear many executable types, 
such as DLL, SYS even Shellcode.
It one of reason that make Anti-Virus sucks!
Common Malicious Behavior consists of three units
Common Malicious Behavior consists of three units
Deployment Unit
Launch Unit
Core Unit
 Remote-Control
 Data Collection
 Self-Protection
 Other malicious behavior
Automated Behavior Analysis Approach, Birdman, HIT2006
Automated Behavior Analysis Approach, Birdman, HIT2006
9
Common Malicious Behavior Model
Common Malicious Behavior Model
Deployment Unit
Deployment Unit
Deployment Unit
Core Unit
Core Unit
Core Unit
Launch Unit
Launch Unit
Launch Unit
Window Startup
Window Startup
Drop Files
Launch
Modify System Settings or Files
Trigger
Malicious Behavior : Collect and Upload
Malicious Behavior : Collect and Upload Data, Rootkit Function
Data, Rootkit Function…
… All 
All ““阿里不达
阿里不达”” things
things
They are so
They are so--
called Droppers.
called Droppers.
Automated Behavior Analysis Approach, Birdman, HIT2006
Automated Behavior Analysis Approach, Birdman, HIT2006
10
Strategy of Spyware Analysis and Detection
Strategy of Spyware Analysis and Detection
There are three types for Spyware Detection.
There are three types for Spyware Detection.
Before Execution
On Execution
After Execution
Static Analysis
Static Analysis
Before Execution 
Before Execution 
Signature Detection
Signature Detection
Anti-Virus, Reversing Tools
Integrity Monitor
Integrity Monitor
On Execution 
On Execution 
Behavior Monitor
Behavior Monitor
Anti-Virus, HIPS
Integrity  Check
Integrity  Check
After Execution 
After Execution 
Cross
Cross--View Check
View Check
Forensic Tools, Scanner
Automated Behavior Analysis Approach, Birdman, HIT2006
Automated Behavior Analysis Approach, Birdman, HIT2006
11
Spyware Detection 
Spyware Detection -- Archon Scanner
Archon Scanner
Rootkit Detection
Rootkit Detection
DLL Injection Backdoor Detection
DLL Injection Backdoor Detection
Malicious Behavior Analysis 
Malicious Behavior Analysis 
Zero Deployment
Zero Deployment
No monitor program need to install
No training for baseline
A Forensic tool for Scanning Spyware
A Forensic tool for Scanning Spyware
Download Trial Version Archon 
Download Trial Version Archon (2006
(2006--0701 ~ 0730)
0701 ~ 0730)
http://x-solve.com/Products/Archon_Scanner/Trial/Snapshot/Archon_1.JPG
http://x-solve.com/Products/Archon_Scanner/Trial/Snapshot/Archon_2.JPG
http://x-solve.com/Products/Archon_Scanner/Trial/ArchonScanner_1.0_Preview.zip
Automated Behavior Analysis Approach, Birdman, HIT2006
Automated Behavior Analysis Approach, Birdman, HIT2006
12
Spyware Detection 
Spyware Detection -- Archon Scanner
Archon Scanner
Spyware Domain View
Spyware Domain View
Different form other commercial Spyware Scanners, Archon Scanner is 
designed of Spyware domain view, we use over 25 aspects as malicious 
behavior features to analyze unknown Spyware or Rootkit.
Major Malicious Behavior Features
Major Malicious Behavior Features
Hidden Process Detection
Hidden Process Detection
Kernel Hooking Detection (SSDT Hook)
Kernel Hooking Detection (SSDT Hook)
User Mode Global API
User Mode Global API--Hooking Detection
Hooking Detection
Hidden Registry Key Detection
Hidden Registry Key Detection
Malicious DLL Injection Analysis
Malicious DLL Injection Analysis
Raw Socket Detection
Raw Socket Detection
LDR Modification Tricks Detection
LDR Modification Tricks Detection
Message Hooker Detection
Message Hooker Detection
Archon Scanner focus on the user mode Spyware detection.
Archon Scanner focus on the user mode Spyware detection.
Automated Behavior Analysis Approach, Birdman, HIT2006
Automated Behavior Analysis Approach, Birdman, HIT2006