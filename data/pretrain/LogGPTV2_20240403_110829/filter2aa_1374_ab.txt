192.168.1.146 
Melbourne
192.168.1.202 
Brisbane
192.168.1.145 - Sydney 
Production SIP Service
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Denial of Service attacks
32
SIP based DoS attacks 
• UDP vulnerabilities and IP spoofing 
• Too many errors, very very verbose mode 
• ICMP errors
192.168.1.146 
Melbourne
192.168.1.202 
Brisbane
192.168.1.145 - Sydney 
Production SIP Service
Alderaan
IP spoofed UDP SIP request
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Hacking SIP trust relationships
33
Send INVITE/MESSAGE requests with 
• IP spoofing (source is Brisbane), 
• from field contains Spoofed IP and Port, 
the caller ID will be your trusted host.
IP spoofed UDP SIP request 
From field has IP and Port
192.168.1.146 
Melbourne
192.168.1.202 
Brisbane
192.168.1.145 - Sydney 
Production SIP Service
UDP Trust
Universal 
Trust
Tatooine
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Attacking a client using SIP trust
34
IP spoofed UDP SIP request 
From field has bogus characters
192.168.1.146 
Melbourne
192.168.1.202 
Brisbane
192.168.1.145 - Sydney 
Production SIP Service
UDP Trust
Universal 
Trust
Tatooine
It’s a TRAP!
Send INVITE/MESSAGE requests with 
• IP spoofing (source is Brisbane), 
• from field contains special number, 
you will have fun or voicemail access.
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Toll fraud for CUCM
• Cisco UCM accepts MAC address as identity 
• No authentication (secure deployment?) 
• Rogue SIP gateway with no authentication 
• Caller ID spoofing with proxy headers  
• Via field, From field 
• P-Asserted-Identity, P-Called-Party-ID 
• P-Preferred-Identity  
• ISDN Calling Party Number, Remote-Party-ID*  
• Billing bypass with proxy headers  
• P-Charging-Vector (Spoofing, Manipulating) 
• Re-Invite, Update (With/Without P-Charging-Vector) 
!
* https://tools.cisco.com/bugsearch/bug/CSCuo51517
35
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Remote-Party-ID header
36
Source: Cisco CUCM SIP Line Messaging Guide
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Caller ID spoofing on CUCM
Remote-Party-ID header 
Remote-Party-ID: ;party=called;screen=yes;privacy=off 
!
What for? 
• Caller ID spoofing 
• Billing bypass 
• Accessing voicemail 
• 3rd party operators
37
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Caller ID fraud for all operators?
• Telecom operators trust source Caller ID 
• One insecure operator to rule them all
38
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Fake Caller ID for messages?
• Call me back function on voicemail / calls 
• Sending many spoofed messages for DoS 
• Overseas? Roaming? 
• Social engineering (voicemail notification) 
• Value added services 
• Add a data package to my line 
• Subscribe me to a new mobile TV service 
• Reset my password/PIN/2FA 
• Group messages, celebrations 
39
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Demonstration of SIP attacks
40
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
VoIP client security 
• Different Client Types 
• Mobile, Desktop, Teleconference, Handsets 
• Information Disclosure 
• Unnecessary services and ports (SNMP, FTP) 
• Weak management services (Telnet, SSH, HTTP) 
• Stored credentials and sensitive information 
• Unauthorised Access  
• Password or TFTP attacks, enforced upgrades 
• Weak VoIP Services 
• Clients may accept direct invite, register or notify
41
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Cisco VoIP clients
• Cisco IP Phones 
• Cisco IP Communicator 
• Cisco Unified Personal Communicator 
• Cisco Webex Client 
• Cisco Jabber services 
• Cisco Jabber Voice/Video 
• IM for 3rd party clients 
• Mobile, desktop, Mac 
• Jabber SDK for web
42
Source: www.arkadin.com
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Rogue services and DSITM
• Use ARP/DNS Spoof & VLAN hopping & Manual config 
• Collect credentials, hashes, information 
• Change client's request to add a feature (e.g. Spoofing) 
• Change the SDP features to redirect calls 
• Add a proxy header to bypass billing & CDR 
• Manipulate request at runtime to find BoF vulnerabilities 
• Trigger software upgrades for malwared executables 
43
Death Star in the Middle
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Attacking a client using SIP service
• Caller ID spoofed messages  
• to install a malicious application or an SSL certificate 
• to redirect voicemails or calls 
• Fake caller ID for Scam, Vishing or Spying 
• Manipulate the content or content-type on messaging 
• Trigger a crash/BoF on the remote client 
• Inject cross-site scripting to the conversation 
!
• Proxies with TLS+TCP interception and manipulation 
• Viproxy (github.com/fozavci/viproxy) 
• MITMproxy
44
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
SMS phishing using SIP messages
45
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Attacking a client using SIP trust
• SIP server redirects a few fields to client 
• FROM, FROM NAME, Contact  
• Other fields depend on server (e.g. SDP, MIME) 
• Message content 
• Clients have buffer overflow in FROM? 
• Send 2000 chars to test it ! 
• Crash it or execute your shellcode if available 
• Clients trust SIP servers and trust is UDP based 
• Trust hacking module can be used for the trust between 
server and client too. 
• Viproy Penetration Testing Kit SIP Modules 
• Simple fuzz support (FROM=FUZZ 2000) 
• You can modify it for further attacks
46
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Attacking a client using SIP trust
47
IP spoofed UDP SIP request 
From field has bogus characters
192.168.1.146 
Melbourne
192.168.1.202 
Brisbane
192.168.1.145 - Sydney 
Production SIP Service
UDP Trust
Universal 
Trust
Tatooine
Crash!
Adore iPhone App
Send INVITE/MESSAGE requests with 
• IP spoofing (source is Brisbane), 
• from field contains exploit, 
the client will be your stormtrooper.
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Attacking clients using VoIP
48
Video demo for SIP based client attacks 
• Manipulating instant messaging between clients 
• Initiate a call using fake Caller ID 
• Send a fake message from the Operator 
• Send bogus message to crash 
• Send too many calls and create a crash 
!
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Attacking Skinny services
• Cisco Skinny (SCCP) 
• Binary, not plain text 
• Different versions 
• No authentication 
• MAC address is identity 
• Auto registration 
!
• Basic attacks 
• Register as a phone 
• Disconnect other phones 
• Call forwarding 
• Unauthorised calls 
49
Source: Cisco
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Other Skinny researches
• Skinny vulnerabilities published 
http://tools.cisco.com/security/center/content/
CiscoSecurityAdvisory/cisco-sa-20120229-cucm 
by Felix Lindner 
http://www.cisco.com/c/en/us/support/docs/csa/cisco-
sa-20100303-cucm.html  
by Sipera VIPER Lab 
• IxVoice SCCP (Skinny) Test Library 
• VIPER UCSniff supports Skinny 
• VIPER LAVA has Skinny support(?) 
!
VoIP Security not found. Did you mean Jason Ostrom?  
He is not only passionate about VoIP…
50
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Attacking Skinny services
51
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Attacking Skinny services
Viproy has a Skinny library for easier 
development and sample attack 
modules 
• Skinny auto registration 
• Skinny register 
• Skinny call 
• Skinny call forwarding
52
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Attacking Skinny services
Everybody can develop a Skinny module now, even Ewoks! 
!
              Register    
                     Unauthorised Call
53
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Preparing a proper client for Skinny
• Install Cisco IP Communicator 
• Change the MAC address of Windows 
• Register the software with this MAC 
54
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Demonstration of Skinny attacks
55
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Summary
56
Hosted VoIP 101
Network Attacks
Attacking CUCDM
Attacking CUCM
Attacking SIP
Attacking 
Clients
Attacking 
Skinny
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Solutions
• Install the Cisco security patches 
• From CVE-2014-3277 to CVE-2014-3283,  
CVE-2014-2197, CVE-2014-3300 
• CSCum75078, CSCun17309, CSCum77041, 
CSCuo51517, CSCum76930, CSCun49862 
• Secure network design 
• IP phone services MUST be DEDICATED, not SHARED 
• Secure deployment with PKI 
• Authentication with X.509, software signatures 
• Secure SSL configuration 
• Secure protocols 
• Skinny authentication, SIP authentication 
• HTTP instead of TFTP, SSH instead of Telnet
57
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
References
• Viproy Homepage and Documentation 
http://www.viproy.com  
!
• Attacking SIP servers using Viproy VoIP Kit  
https://www.youtube.com/watch?v=AbXh_L0-Y5A 
!
• VoIP Pen-Test Environment – VulnVoIP  
http://www.rebootuser.com/?cat=371 
!
• Credits and thanks go to…  
Sense of Security Team, Jason Ostrom, Mark Collier, 
Paul Henry, Sandro Gauci
58
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Questions ?
59
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
                                                                     Page        of 58 –   Aug-14  
60
Thank you
Recognised as Australia’s fastest growing information security and 
risk management consulting firm through the Deloitte Technology 
Fast 50 & BRW Fast 100 programs
Head office is level 8, 66 King Street, Sydney, NSW 2000, Australia. 
Owner of trademark and all copyright is Sense of Security Pty Ltd. 
Neither text or images can be reproduced without written 
permission.
T: 1300 922 923 
T: +61 (0) 2 9290 4444 
F: +61 (0) 2 9290 4455 
PI:EMAIL 
www.senseofsecurity.com.au