T
X H U \
\
Q
D
S
H D N H G
P
R
$ WWD F N H U V H U Y H U , 3
F

/
G
D
S
*HWZSDGGDW
$WWDFNHU SUR[\ FRQILJ
:HE WUDIILF
$XWKRULWDWLYH '16
VHUYHU RSHUDƚĞĚ E\
DWWDFNHU
S Z G
D
Y
U L
W
H
H 
J 
Q
J 
D
L
Q
S
J
N
K
H
3
V
W
V
K
O L
H
D
L
D
O
\
F
F 
:HE
9LFWLP GHYLFH KDUGFRGHG
Z YXOQHUDEOH GRPDLQ
FRPSDQ\QWOG
$WWDFNHU ZHE VHUYHU
 0LW0 SUR[\
Fig. 1: Illustration of the WPAD name collision attack. If an internal namespace TLD is delegated as a new gTLD, internal
namespace WPAD query leaks can be easily exploited using MitM attack from anywhere on the Internet.
in WPAD are signiﬁcantly easier to exploit. Fig. 1 illustrates
the WPAD name collision attack, in which a malicious domain
registrant can exploit name collisions of leaked WPAD queries,
and launch MitM attacks from anywhere on the Internet. In
this attack, victim devices are assumed to be conﬁgured to use
DNS WPAD for automatic proxy discovery by issuing WPAD
queries in an internal DNS namespace, e.g., company.ntld.
Here, .ntld is assumed to be used as iTLD but also delegated
in the public DNS namespace. Under some common settings
(uncovered in §IV), such queries are mistakenly leaked out.
This allows an attacker to create name collisions for these
queries by registering the domain name company.ntld in
new gTLD .ntld. Thus, the leaked WPAD queries from
affected systems, which may be anywhere on the Internet
are sent to the attacker’s authoritative name server and get
resolved to fetch the attacker’s proxy conﬁguration ﬁle. This
causes all the subsequent web trafﬁc in the browser or trafﬁc
from the entire OS to be redirected to the proxy controlled
by the attacker. The victim user may not even recognize the
attack, since the WPAD proxy discovery is fully automated at
the browser launch time, and some OSes and browsers enable
it by default without explicit consent from users (shown in
Table I). The attacker can leverage this MitM position to not
only eavesdrop sensitive data such as conﬁdential documents
and user credentials, but also manipulate the trafﬁc to inject
malicious code, launch phishing attacks, or other malicious
impacts to vulnerable systems.
In this attack, the adversaries only need to register new
gTLD domains to direct potentially vulnerable WPAD queries
to them. This means that if a potentially colliding internal
domain is registered, the attacker can detect and respond
authoritatively to WPAD queries without the need of spooﬁng.
This frees the on-path requirement and eliminates the narrow
attack window drawback of previous WPAD attacks. More
importantly, the authoritative nature of the malicious responses
makes this attack exploitable despite DNSSEC [18], [19].
This attack is also very stealthy, since once the domain
name is registered, due to privacy protection it is difﬁcult
for both new gTLD registries and third parties to examine its
subdomains for attack attempts. Note that we do not assume
that the attacker is fully aware of the set of the vulnerable
domains (i.e., domains with leaked queries), and thus de-
liberately exploits them. The attackers can be sophisticated
registrants who know some vulnerable domains based on
their own analysis, e.g., by snifﬁng local network queries or
accessing DNS trafﬁc collected by organizations such as DNS-
OARC [8]. Meanwhile, the registrants can also be innocent at
the domain registration time, but realize and start exploitation
after observing a large number of misdirected WPAD queries.
Another possibility is that the registrant is completely honest
but the DNS servers are compromised by an attacker to exploit
these vulnerable queries.
B. Attack Surface
In order to characterize the magnitude of this newly-exposed
MitM threat, we propose a candidate methodology to quantify
the WPAD attack surface exposed by registrations of new
domain names under new gTLDs. With that, we describe a
measure of how exposed (or open) the total attack surface is
based on registration status.
Our threat model focuses on the fact that MitM attacks can
be launched against any client who issues a WPAD query to
a domain name that is controlled by an attacker. Thus, all
domain names with leaked queries to the public namespace
are vulnerable. However, we ﬁnd that most of the domains in
the leaked query trafﬁc appears infrequently with low query
volume, implying that they may not be easily exploited in
practice. For example, we ﬁnd that for the delegated new
gTLD .network, 42.3% of the domains with leaked queries
(e.g., company.ntld in Fig. 1) to two of 13 DNS root
servers appeared in less than 14 days within a one-year period.
Furthermore, less than 4% of these domains account for more
than 98% of all leaked WPAD trafﬁc observed at the two DNS
root servers. Thus, using all the domains with leaked queries as
the attack surface is an overestimate of the actual vulnerability
status in practice. Therefore, we deﬁne a notion of “highly-
vulnerable domains” based on a more accurate and useful
attack surface characterization method described as follows.
Attack surface: highly-vulnerable domains (HVDs). In
this paper, we deﬁne highly-vulnerable domains for a new
gTLD to be those WPAD query domains persistently exposing
a large number of victims. We denote these domains as the at-
tack surface for this new gTLD. These attack surface domains
678678
Authorized licensed use limited to: IEEE Xplore. Downloaded on March 18,2021 at 12:18:12 UTC from IEEE Xplore.  Restrictions apply. 
or HVDs need to have two properties: (1) high persistence,
meaning that their queries are leaked to the public namespace
frequently over a long time period, e.g., every day or days with
regular periodicity, and (2) high query volume, indicating that
once registered, many victims can be continuously exploited.
From this deﬁnition, these domains are quantiﬁably attractive
targets for adversaries, and are likely to keep exposing such
vulnerability after the delegation of their TLD strings.
This methodology deﬁnes a measurably stable set of highly-
vulnerable domain names. To quantify the attack surface based
on this deﬁnition, we ﬁrst concretely deﬁne the level of
persistence using period length p and persistence duration n.
We then balance the trade-off between persistence and high
query volume by systematically exploring p and n, detailed
later in §V-A. This quantiﬁcation method allows us to estimate
the size and composition of domains that, when registered,
constitute the bulk of the WPAD name collision vulnerabilities.
C. Dataset
We describe the datasets used in our study as follows.
New gTLD list. We obtain the new gTLD list along with
their delegation dates directly from ICANN website [16].
In this paper, we consider the new gTLDs delegated before
2015/08/25, consisting of 738 new gTLDs in total.
Root NXD WPAD. Due to the usage of non-delegated
iTLDs, the leaked internal namespace queries are captured
and replied with NXD by the DNS root servers. Thus, our
vulnerability characterization and attack quantiﬁcation mainly
rely on NXD trafﬁc collected at 2 of the 13 root servers — A
root and J root, both managed by Verisign. Both root servers
utilize IP anycasted services from a globally diverse set of
locations [6], which should reduce any signiﬁcant geographical
biases in the data collection. The leaked queries become
unobservable in this dataset after the delegation of their TLD
strings. Thus, in the analysis of each new gTLD, we only use
the data collected before its delegation date.
This dataset was collected internally by Verisign for around
2 years, spanning from September 2013 to July 2015. Since the
ﬁrst new gTLD delegation in the New gTLD Program occurred
in October 2013, this dataset covers leaked query trafﬁc for
all the new gTLDs delegated so far. To study leaked WPAD
queries, we extract the query trafﬁc with query names in
the form of wpad.(cid:2)domain name(cid:3). Considering that single
label domains, e.g., wpad.ntld are more easily defended
at the new gTLD registries, in this dataset we only include
WPAD queries with at least 2 labels in (cid:2)domain name(cid:3),
e.g., wpad.sld.ntld, wpad.3ld.sld.ntld, etc.
New gTLD zone ﬁles and WHOIS data. Once a domain
is registered, it appears in the corresponding new gTLD’s zone
ﬁles. Meanwhile, mapping from registered domains to the
domain registrants are included in the new gTLD’s WHOIS
data. To study the registration status and registration pattern
of HVDs in our attack surface, we use new gTLDs’ zone
ﬁles from ICANN Centralized Zone Data Service (CZDS) [15]
and WHOIS data from BestWhois service [1], which are both
pulled daily from 2014/02 to 2015/09.
IV. WPAD QUERY LEAKAGE CHARACTERIZATION
The WPAD name collision attack stems from the unin-
tentional leakage of internal WPAD DNS queries into the
public DNS namespace. This problem emerged soon after
the popularization of the WPAD protocol [31], [33], however
remains understudied since it was not easily exploitable until
the expansion of the new gTLDs.
To systematically characterize this newly-exposed threat and
help ﬁnd effective solutions, we need to ﬁrst have an in-
depth understanding of this fundamental leakage problem. In
this section, we ﬁrst characterize its severity by quantitative
measurements of leaked WPAD query trafﬁc seen in the DNS
root servers, and then elucidate the underlying causes of these
leaks using query trafﬁc analysis and controlled local testbed
experiments.
A. Quantiﬁcation of Leaked Queries
Fig. 2 shows the popular ﬁrst labels ranked by their average
daily query numbers in NXD trafﬁc at DNS root server A and J
from January to July in 2015. In DNS-based protocols, usually
the protocol name is the ﬁrst label. Thus, in the ﬁgure many
labels belong to popular protocols such as WPAD, ISATAP,
etc. The ﬁrst label query number distribution exhibits a very
long tail. As shown, WPAD protocol is ranked top 4 with
more than 20 million leaked queries every day, showing high
severity in terms of the query leakage problem. Using the
number of distinct IP address and WPAD query domain pairs
in our 2-year root NXD WPAD dataset, these queries are
estimated to have at least 6.6 million potential victim users
in the wild.
For these leaked WPAD queries to be exploitable in our
attack, their TLD domains need to be delegated so that the
attacker can register the SLD and create name collisions. We
study the 738 new gTLDs that have already been delegated
before 2015/08/25, and ﬁnd that 65.7% (485) of them exhib-
ited leaked WPAD queries to the 2 DNS root servers in our
dataset before their delegation, revealing a signiﬁcant attack
surface. In §V, we use a more systematic approach to quantify
the attack surface for these delegated new gTLDs based on the
deﬁnition in §III-B.
To understand the vulnerability exposed by the new gTLDs
that have already been delegated today, we measure the daily
query percentage of these delegated new gTLD strings in
the leaked queries using 1 month of root NXD WPAD data
immediately prior to the delegation of the ﬁrst new gTLD
in the New gTLD Program on 2013/10/23. Fig. 3 shows the
daily query volume and the overall query percentage in root
NXD WPAD dataset for delegated new gTLD strings with
leaked queries. As shown, even though the query percentage
is not high, some top ones such as .global already have
over 30,000 leaked WPAD queries every day. In total, 2.3%
of the daily leaked WPAD queries, which are over 238,000
queries per day on average from only 2 DNS root servers,
belong to the delegated new gTLD set. According to our threat
model, these queries are already exploitable today. Note that
these are query volumes from just 2 of the 13 DNS root
679679
Authorized licensed use limited to: IEEE Xplore. Downloaded on March 18,2021 at 12:18:12 UTC from IEEE Xplore.  Restrictions apply. 
 7e+07
 6e+07
 5e+07
 4e+07
 3e+07
 2e+07
 1e+07
#
y
r
e
u
q
y
l
i
a
d
e
g
a
r
e
v
A
 0
w
1
0
w
w
w
_ld
a
p
a
d
p
b lb d
r dr
b
%
y
r
e
u
q
y
l
i
a
d
e
g
a
r
e
v
A
 5
 4
 3
 2
 1
 0
is
_
v
ata
e
n
u
p
e
k
erb
ero
pro
s
x
y
#
y
r
e
u
q
y
l
i
a
d
e
g
a
r
e
v
A
 45000
 40000
 35000
 30000
 25000
 20000
 15000
 10000
 5000
 0
 0.4
 0.35
 0.3
 0.25
 0.2
 0.15
 0.1
 0.05
%
y
r
e
u
q
y
l
i
a
d
e
g
a
r
e
v
A
.glo
.a
b
.gro
.n
u
.d
etw
s
p
d
al
.offic
.pro
.h
d
.w
.win
b
s
c
.o
orld
.s
e
a
p