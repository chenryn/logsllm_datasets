Scenarios such as those in Figure 12, where convexity does not
hold, would happen, for example, if covariance functions oscillate.
However, a necessary condition for such oscillation is that typical
sample paths themselves oscillate in reproducible ways. We expect
this to happen only when a very few number of ﬂows with feedback
have a signiﬁcant impact on a path. As our results show, this does
not happen in the Internet core. We also note that even if R(τ ) is
not convex everywhere, it may be for some domain of interest. For
example there may be probing rates that we may be constrained
to use, resulting in the non-convex domain of R(τ ) never being
sampled in any case. In other words, practical sampling may be
above time scales (or below, when stationarity fails at very large
scales) where a lack of convexity is a problem. In all such cases,
our theorems are still very useful.
x 10−3
4
3
2
1
0
e
c
n
a
i
r
a
v
o
c
−
o
t
u
A
−1
−2
0
[TCP+Poisson,Pareto,Periodic]
[TCP+Poisson,Pareto,Poisson]
[Poisson,Pareto,Poisson]
0.04
0.035
0.03
0.025
0.02
0.015
0.01
0.005
0
e
c
n
a
i
r
a
v
o
c
−
o
u
A
t
0.5
1
1.5
Lag Values [secs]
2
2.5
−0.005
0
0.02
0.04
[TCP+Poisson,Pareto,Periodic]
[TCP+Poisson,Pareto,Poisson]
[Poisson,Pareto,Poisson]
0.06
0.08
Lag Values [secs]
0.1
0.12
Figure 11: Auto-covariance (un-normalized) function of Ix for a 3-hop system involving a combination of TCP, Poisson and Pareto
cross-trafﬁc. The left hand plot is a zoom of the right hand one, showing more points. Three results are shown depending on how
many cross-trafﬁc streams have periodic features.
6. PRACTICAL IMPLICATIONS
7. RELATED WORK
In [2], we introduced the probe separation rule as a guideline
to design probing streams. Although Gamma distributions for all
ﬁnite β do not have a lower bound above zero, as suggested by
this rule, the work in this paper is consistent with its spirit. This
is because the probability that inter-probe times are smaller than
 goes to 0 when β goes to inﬁnity for all  strictly less then the
mean inter-probe time. Apart from being generic (applicable to
probe patterns) and mixing (therefore, free of sample-path bias),
all Gamma probing streams with β > 1 are superior to Poisson
probing streams in terms of variance when R(τ ) is convex. This
endows the Gamma family with an important property that is also
suggested by the probe separation rule: tunability to enable differ-
ent trade-offs. We exploited this property in Section 4.5 to suggest
the use of Gamma probing streams with small shape values, which
would likely avoid the anomalous behavior exhibited by Gamma
probing streams with high shape values and yet be superior to Pois-
son probing.
Our results in Section 4 and Section 5 show the advantages of
Gamma probing for a wide range of metrics including mean delay,
delay quantiles and loss indicator functions. We did ﬁnd extreme
cases in which a single dominating TCP ﬂow can introduce non-
convexity for loss probing. In future work, we intend to understand
better the reasons behind such non-convexity and investigate if it
ever occurs in practice.
Throughout this paper we assumed non-intrusive probing and ig-
nored the perturbative impact of probing. As we discussed in [2],
non-intrusive results can be applied to the estimation of delay-based
metrics in practice as long as probing is rare. In [3], we showed
that similar results are valid for the estimation of loss-based met-
rics, too. The general idea is that, if a system ‘forgets it past’ fast
enough, then probes sent rarely enough emulate well non-intrusive
probing. Rare probing is one way in which our results in this pa-
per can be applied in practice. In particular, we can beneﬁt from the
low variance of Gamma probing if its perturbative effect is arguably
minimal. However, the problem of removing the impact of intru-
siveness without relying on rare probing is technically challenging
and remains open.
Delay and loss measurement has been the focus of many earlier
papers [14, 15, 18, 22]. Early measurement studies [15] focused on
end-to-end measurement, primarily using Poisson sampling. Zhang
et al. [22] used Poisson sampling to study the time-varying nature
of delay, loss and other path characteristics. In all these prior stud-
ies, Poisson sampling was justiﬁed as an application of the PASTA
principle [21]. The IETF IP Performance Metrics (IPPM) Group
[8] also recommends Poisson sampling for loss measurement.
Recently, the utility of Poisson sampling for delay was ques-
tioned [2, 17]. Empirical studies [18, 10] have also questioned this
premise. The importance of variance, in addition to bias, for good
measurements was stated in [2]. A few preliminary results show-
ing the non-optimality of Poisson probing was also provided in [2].
Techniques have been proposed for better probing. For instance,
Badabing [18] is a tool for loss measurement that proposed a partic-
ular probing process assuming that the loss process is Markovian.
In contrast, our work is quite general and provides insights into the
measurement of any metric.
8. CONCLUSIONS
We have taken a fundamental look at the issue of optimal probing
for delay and loss measurement. Given that a large variety of so-
called mixing probe processes enjoy the strong consistency prop-
erty, we investigated the mixing probing process that would mini-
mize estimation variance. In the context of non-intrusive probing,
we proved that periodic probing has the least variance if the auto-
covariance of the measured metric is convex. But periodic probing
is not mixing as it can have phase-locking issues resulting in sig-
niﬁcant sample path bias. We showed that an alternative family
of probing processes, Gamma renewal processes, provide a good
middleground - they have no sample-path bias and can achieve vari-
ance as close to periodic as possible when the auto-covariance of
the measured metric is convex. Using extensive experiments, pri-
marily on a unique set of full-router datasets, we demonstrated the
validity of this convexity condition and the sub-optimality of Pois-
son probing.
x 10−3
10
e
c
n
a
i
r
a
v
o
c
−
o
t
u
A
d
e
z
i
l
a
m
r
o
n
n
U
8
6
4
2
0
−2
0
0.5
[TCP,Pareto,Periodic]
[TCP,Pareto,Poisson]
[TCP+Poisson,Pareto,Poisson]
[TCP,Pareto,Periodic]
[TCP,Pareto,Poisson]
[TCP+Poisson,Pareto,Poisson]
0.045
0.04
0.035
0.03
0.025
0.02
0.015
0.01
0.005
0
e
c
n
a
i
r
a
v
o
c
−
o
u
A
d
e
z
t
i
l
a
m
r
o
n
n
U
1
1.5
Lag Values [secs]
2
2.5
−0.005
0
0.02
0.04
0.06
0.08
Lag Values [secs]
0.1
0.12
Figure 12: Auto-covariance (un-normalized) function of Ix for 3-hop systems involving a single high-rate TCP ﬂow that can introduce
some non-convexity. The left hand plot is a zoom of the right hand one, showing more points.
9. ACKNOWLEDGEMENTS
The full-router data was available following prior work at Sprint
ATL. We thank Tao Ye, Gianluca Iannaconne and Nicolas Hohn
for their packet matching and analysis code, and Dina Papagian-
naki, Ed Kress, Richard Gass, and Jamie Schneider for data collec-
tion and access. We also thank our sheperd, Paul Barford, for his
comments on earlier drafts of the paper.
10. REFERENCES
[1] F. Baccelli and P. Bremaud. Elements of Queueing Theory.
Springer Verlag, Applications of Mathematics, second
edition, 2003.
[2] F. Baccelli, S. Machiraju, D. Veitch, and J. Bolot. The Role
of PASTA in Network Measurement. Computer
Communication Review, Proceedings of ACM Sigcomm
2006, 36(4):231–242, 11–15 Sep 2006.
[3] F. Baccelli, S. Machiraju, D. Veitch, and J. Bolot. Loss
Measurement via Probing. Sprint ATL Technical Report No.
ATL-020124, February 2007.
[4] D. Daley and D. Vere-Jones. An Introduction to the Theory of
Point Processes. Springer-Verlag, 1988.
[5] D. Gaver and P. Lewis. First-order autoregressive gamma
sequences and point processes. Adv. Appl. Prob.,
12:727–745, 1980.
[6] L. Gradshteyn and L. Ryzhik. Table of Integrals, Series and
Products. Academic Press, sixth edition, 2000.
[7] N. Hohn, D. Veitch, K. Papagiannaki and C. Diot. Bridging
router performance and queuing theory. In Proc. of ACM
SIGMETRICS’04.
[8] I. I. P. M. (IPPM). http://www.ietf.org/html.
charters/ippm-charter.html, 2005.
[9] S. Machiraju, D. Veitch, F. Baccelli, and J. Bolot. Adding
Deﬁnition to Active Probing. In ACM Computer
Communication Review, April 2007.
[10] M.Tariq, A.Dhamdhere, C.Dovrolis, and M.Ammar. Poisson
versus Periodic Path Probing (or, Does PASTA Matter)? In
ACM Internet Measurement Conf., pages 119–124, Berkeley,
CA, Oct 2005.
[11] T. Ott. The covariance function of the virtual waiting time
process in an M/G/1 queue. Adv. App. Prob., 9, 1997.
[12] D. Papagiannaki, S. Moon, C. Fraleigh, P. Thiran, F. Tobagi
and C. Diot. Analysis of Measured Single-hop Delay from an
Operational Backbone Network In Proceedings of IEEE
Infocom, June 2002.
[13] D. Papagiannaki, D. Veitch and N. Hohn. Origins of
Microcongestion in an Access Router. In Proceedings of
Passive and Active Measurement Conference., 2004.
[14] V. Paxson. End-to-end routing behavior in the internet. In
Proceedings of ACM SIGCOMM, 1997.
[15] V. Paxson. End-to-end Internet packet dynamics. IEEE/ACM
Transactions on Networking, 7(3):277–292, 1999.
[16] K. Petersen. Ergodic Theory. Cambridge University Press,
Cambridge England, 1983.
[17] M. Roughan. A Comparison of Poisson and Uniform
Sampling for Active Measurements. IEEE Journal on
Selected Areas in Communication, 24(12):2299–2312, Dec
2006.
[18] J. Sommers, P. Barford, N. Dufﬁeld, and A. Ron. Improving
accuracy in end-to-end packet loss measurement. In ACM
SIGCOMM’05, pages 157–168, 2005.
[19] L. Takács. Introduction to the Theory of Queues. Oxford
University Press, New York, 1962.
[20] The Network Simulator - ns-2, 2004.
http://www.isi.edu/nsnam/ns/.
[21] R. Wolff. Poisson Arrivals see Time Averages. Operations
Research, 30(2):223–231, 1982.
[22] Y. Zhang, N. Dufﬁeld, and V. Paxson. On the Constancy of
Internet Path Properties. In Proceedings of the Internet
Measurement Workshop, 2001.
11. APPENDIX
11.1 Proof of Lemma 3.1
Let T ∼ Γα,λ, Z ∼ Γβ,λ be independent, and set Y = T + Z.
Then C = IE[T|Y ] = αY /(α + β) has density Γα+β,(α+β)λ/α,
with mean IE[C] = a/λ = IE[T ].
PROOF. From the scaling property of Gamma, Y ∼ Γα+β,λ.
= Pr(T = x, Z = y − x)
Since T and Z are independent, the density of (T|Y = y) is
Pr(T = x|Y = y) = Pr(T = x, Y = y)
Pr(Y = y)
Γα,λ(x)Γβ,λ(y − x)
Pr(Y = y)
Γα+β,λ(y)
Γ(α + β)
Γ(α)Γ(β)
xα−1(y − x)β−1y1−(α+β).
=
=
Z y
Recall the Beta function B(x, y) = Γ(α)Γ(β)/Γ(α + β). The
required conditional expectation is given by
IE[T|Y = y] =
=
=
y1−(α+β)
B(α, β)
y1−(α+β)
B(α, β)
α y
α + β
xα(y − x)β−1 dx
(13)
0
yα+βB(α + 1, β)
(14)
using the integral identity 3.191(1) from [6]. Now viewing y as a
sample of Y , we have C = IE[T|Y ] = αY /(α + β), which is
(cid:6)(cid:7)
Gamma as stated by the scaling property.
11.2 Calculating Auto-Covariance of Ix()
In Section 5.2, we calculate the auto-covariance of Ix(t), the
ground truth loss process. We now explain how we calculate Ix(t).
Consider a single hop in a network employing a byte-based drop-
ping policy. By deﬁnition, Ix(t) for that hop depends only on the
queue size at that hop (and x). Using a complete trace of packet
sizes and arrival times to the hop, we can compute the queue size
of that hop at any time t and, therefore, compute Ix(t), too.
Though Ix(t) is a continuous time process, it can be efﬁciently
stored. To see why, note that there are a ﬁnite set of ‘changepoints’
where the value of Ix(t) changes. These are precisely those instants
when the queue size crosses a threshold. The threshold corresponds
to that above which there are fewer than x bytes available in the
queue.
We use a similar approach to calculate Ix(t) for multi-hop paths.
However, recall that Ix(t) is an indicator function for the event that
a probe of size x, had it entered the system at time t, encounters
a queue that has less than x bytes available. Hence, in a multi-
hop path, Ix(t) depends on the buffer size of intermediate hops
at time instants that may be after t. Therefore, to calculate Ix(t),
we also compute these time instants. As with single-hop paths,
Ix(t) can be efﬁciently stored; it has a ﬁnite set of ‘changepoints’,
which correspond to the time instants when any queue along the
path crosses a threshold. As before, the threshold corresponds to
that above which there are fewer than x bytes available.
In ns-2, queue occupancy does not include the current packet
being transmitted. Hence, to obtain the ground truth loss process
for our simulations, we calculate ‘changepoints’ of this alternative
deﬁnition of queue size.