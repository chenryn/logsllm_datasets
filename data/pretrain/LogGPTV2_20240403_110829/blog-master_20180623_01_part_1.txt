## 数据库相关岗位面试准备建议 - 珍藏级
### 作者
digoal
### 日期
2018-06-23
### 标签
PostgreSQL, 数据库, 面试准备

---

## 背景
本文适用于招聘方和应聘者。通过面试问题，可以发掘应聘者的极限，并准确定位其技能层级。

## 类目
至少应包含以下内容，每一项都应包括考察范围、目的、评判标准、不同等级的差异化以及对应的深度和广谷。

## 外围能力考察
### 操作系统
- 为什么有些进程无法被杀死？原因是什么？
- 进程的状态有哪些？D状态和Z状态分别由什么引起？
- 如果进程挂起，如何排查？使用工具如pstack、gdb。
- 增加数据库并发后，性能未线性提升的原因及排查方法（例如strace, ptrace, perf, oprofile）。
- cgroup能实现哪些隔离功能？
- Linux中的虚拟化技术及其差异。
- 进程与线程间通信的技术。
- 进程、线程和协程的区别。

### 存储
- 传统文件系统。
- 卷管理。
- INODE。
- 分布式文件系统。
- DIO与BUFFER IO的区别。
- 如何测试存储性能。
- fadvise的作用。

### 网络
- 网络协议。
- 如何排查网络问题。
- 如何测试网络性能。

## 数据库能力考察
### 1. 协议
- 消息格式。
- 数据库认证过程及密码防窃取措施。
- 流复制协议。
- 逻辑复制协议。

### 2. 启动过程
- 数据库正常和异常启动过程。
- SQL处理流程解释。
- Checkpoint机制及调度算法。

### 3. 备份与恢复
- REDO的数据结构。
- 一致性逻辑备份的原理。
- 并行一致性逻辑备份的原理。
- 逻辑备份增量备份的原理。
- 物理备份。
- 物理备份增量备份的原理。
- 逻辑恢复原理，如何并行恢复及收集统计信息的重要性。
- 加速逻辑恢复的方法。
- 物理备份的PIRT原理。
- 物理增量备份的恢复原理。
- 物理恢复的一致性位点定义。

### 4. 进程结构
- 数据库中的进程及其职责。
- PostgreSQL后台进程的IPC机制。

### 5. 物理结构
- 数据库数据文件结构。
- PAGE结构。
- TUPLE结构。
- 不同索引接口的内部结构。

### 6. 优化器
- CBO与RBO的区别。
- CBO的依据。
- 执行计划创建过程。
  - Plan tree结构，节点输入输出，选择性和成本评估。
- SQL重写。
  - 何时需要SQL重写及原因。
- 统计信息收集调度。
  - 实例级和表级参数，调度算法及唤醒算法。
- 统计信息要素及其作用。
- 多值列和多列组合统计信息。
  - 为何需要这些统计信息及对优化器的影响。
- 成本计算方法。
  - 各种节点的成本计算方法。
- 成本计算算子。
  - 至少介绍几种算子及其作用。
- 行数估算方法。
- 数据库扫描方法及其细节。
- ORA: SKIP INDEX SCAN。
- Filter与Recheck的区别及原因。
- JOIN方法及其适用场景。
- Bloom filter在优化器中的应用。
- 多表JOIN顺序的选择原理。
- 遗传TSP算法。

### 7. SQL规则与触发器
- RULE。
  - 触发时机及作用。
- 触发器。
  - 多个触发器的执行顺序，参数传递及结果传递。
  - Before, After, Row, Statement的区别。
  - Batch触发的好处及使用方法。
- 事件触发器。
  - 适用场景及原理。

### 8. HOOK
- 数据库中的HOOK。
- 使用HOOK的插件。
- HOOK的作用及使用方法。

### 9. 三态
- 函数三态知识。
- 三态与MVCC的关系。
- 三态在PS中的异同。
- 优化器如何考虑三态。
- 索引扫描与三态。
- 表达式索引与三态。

### 10. 索引
- 数据库索引接口（btree, hash, gin, gist, spgist, rum, brin, bloom, bitmap等）。
- 适用场景（从数据分布、读写请求角度）。
- 数据写入时的UNDO、表、索引操作流程。
- 数据更新、删除时的UNDO、表、索引操作流程。
- UK约束的操作流程。
- 索引分裂。
- BTREE链表结构。
- HASH索引的内部结构。
- GIN索引的结构。
- 多索引时的问题及优化方法。
- 优化器如何选择多个字段索引，Bitmap Scan的原理。
- 多字段复合索引的字段顺序选择规则及原理。

### 11. 约束
- 约束类型（check, fk, uk, pk, not null, exclusive constraint）。
- 每种约束的作用。

### 12. 存储结构
- 索引接口的存储结构（meta, root等）。
- FSM, VM结构，INSERT时找到适当BLOCK的方法，避免热点插入。
- HEAP数据文件结构、BLOCK结构、TUPLE结构。
- 行存储与列存储及其适用场景。
- 列存储内核层面的优化手段。
- 分布式数据库的数据倾斜原因及解决方案。
- 分布式数据库查询倾斜原因及解决方案。
- Ora聚集表的存储结构、应用场景及缺点。

### 13. 类型
- 数据库中的数据类型及其适用业务场景。
- 不同数据类型的常用操作。
- 自定义类型的方法。

### 14. SQL语法
- CRUD操作。
- CTE。
- 递归。
- SKIP LOCK。
- MERGE。
- CUBE。
- 行列变换。
- 异步消息。
- 事务及子事务。
- 2PC。
- 会话memcontext。
- SRF。
- 聚合。
- 窗口函数。
- 自定义聚合。
- 聚合计算原理。
- 并行聚合计算原理。
- 可能重写表的操作及避免方法。

### 15. 排错
- 错误源代码定位。
- BUG上报。
- 寻求帮助的途径及网站。

### 16. 运行信息
- 关注的运行信息。
- 跟踪开关。
- 开发者开关。
- 源代码编译开关及其设置位置。
- 当前及历史运行信息。
- TOP命令。
- 等待事件。
- 系统层PROFILE。
- 审计。

### 17. 问题诊断思路

### 18. 垃圾回收
- Oracle UNDO原理。
- PostgreSQL多版本原理。
- PostgreSQL新存储引擎zheap。
- 垃圾回收原理及相关参数。
- FREEZE原理及相关参数。

### 19. 并行
- 并行创建索引的原理。
- 数据库支持的并行计算及其原理。
- 优化器对并行度的计算原理。
- 控制并行度的方法。
- JOIN并行原理（hash, merge, nestloop）。
- 并行seq scan原理。
- 并行索引扫描原理。
- 并行排序原理。
- 分区表并行JOIN和GROUP原理。
- 并行GROUP原理。
- 多阶段并行聚合原理。

### 20. 排序
- 排序算法。
- 非完全索引排序优化原理。

### 21. 锁和并发控制
- 锁类型。
- 锁冲突。
- 事务隔离级别。
- MVCC机制。
- 2PC过程。
- 垃圾回收与事务的关系。
- SNAPSHOT TOO OLD的原因。
- UNDO机制。
- 雪崩现象及防止方法。
- 分布式数据库的分布式死锁检测机制。
- 分布式数据库的快照、并发控制及隔离实现原理。
- 分布式数据库的全局一致性备份和恢复。

### 22. 流复制

希望以上内容能够帮助你更好地准备数据库相关的面试。祝你好运！