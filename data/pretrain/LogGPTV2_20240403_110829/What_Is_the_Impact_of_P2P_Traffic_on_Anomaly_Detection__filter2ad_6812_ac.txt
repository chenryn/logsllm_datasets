NETAD (without p2p)
NETAD (with p2p)
20
40
60
80
100
False Positives (%)
)
%
(
e
t
a
R
n
o
i
t
c
e
t
e
D
)
%
(
e
t
a
R
n
o
i
t
c
e
e
D
t
)
%
(
e
t
a
R
n
o
i
t
c
e
t
e
D
100
90
80
70
60
50
40
30
20
10
0
0
100
90
80
70
60
50
40
30
20
10
0
0
100
90
80
70
60
50
40
30
20
10
0
0
(e) UDP Flood (high-rate)
(f) UDP Flood (low-rate)
Fig. 3. ROCs for diﬀerent attack classes/rates; results of TRW-CB for ﬂooding attacks
are omitted as it had 0% detection rate due to random source IP address spooﬁng used
by ﬂooding attacks.
plots separate ROCs for each attack class and rate. We note that the perfor-
mance of NETAD does not degrade for ﬂooding attacks when p2p traﬃc is
introduced, but its accuracy degrades for portscans. On the other hand, perfor-
mance penalty for Maximum Entropy in case of ﬂooding attacks is much more
than that for portscans. This is mainly because of the diﬀering design principles
of these anomaly detectors. Flooding attacks are detected by NETAD because
the ﬂoods were launched on lower ports [Table 2], whereas p2p communication
10
I.U. Haq et al.
100
90
80
70
60
50
40
30
)
%
(
e
t
a
R
n
o
i
t
c
e
t
e
D
e
g
a
r
e
v
A
20
80
80
70
60
)
%
(
s
e
v
i
t
i
s
o
P
e
s
a
F
l
50
40
30
20
10
0
80
100
MaxEnt on high−rate attacks
MaxEnt on low−rate attacks
NETAD on high−rate attacks
NETAD on low−rate attacks
70
60
Ratio of p2p Traffic (%)
50
40
)
%
(
e
t
a
R
n
o
i
t
c
e
t
e
D
e
g
a
r
e
v
A
90
80
70
60
50
40
30
80
MaxEnt on high−rate attacks
MaxEnt on low−rate attacks
NETAD on high−rate attacks
NETAD on low−rate attacks
70
60
Ratio of p2p Traffic (%)
50
40
(a) Dataset with p2p traﬃc
(b) Dataset without p2p traﬃc
MaxEnt on high−rate attacks
MaxEnt on low−rate attacks
NETAD on high−rate attacks
NETAD on low−rate attacks
)
%
(
s
e
v
i
t
i
s
o
P
e
s
a
F
l
70
60
Ratio of p2p Traffic (%)
50
40
60
50
40
30
20
10
0
80
MaxEnt on high−rate attacks
MaxEnt on low−rate attacks
NETAD on high−rate attacks
NETAD on low−rate attacks
70
60
Ratio of p2p Traffic (%)
50
40
(c) Dataset with p2p traﬃc
(d) Dataset without p2p traﬃc
Fig. 4. Results of training IDSs on p2p traﬃc
was using higher ports for communication. The same attacks degrade Maxi-
mum Entropy detector’s accuracy because p2p traﬃc on higher ports increases
the variance and entropy of the port distribution, thereby resulting in a large
number of false positives from windows containing p2p activity. These results
indicate that depending on the detection principles and features employed by
an anomaly detector, the aﬀect of p2p traﬃc can be much more pronounced for
some attack classes.
We are also interested in determining how p2p traﬃc aﬀects low- and high-
rate attacks. From Figure 3, we observe that detection of low-rate attacks is
much more seriously aﬀected than that of high-rate attacks. Thus p2p traﬃc
inadvertently acts as a very eﬀective evasion cover for low-rate attacks. This
evasion cover is also provided for high-rate attacks, but the cover is blown for
the scenarios where the sustained attack connection rate overwhelms the short-
term p2p connection burst.
4.4 Can an Anomaly Detector Handle p2p Traﬃc if It Is Trained
on a Dataset Containing p2p Traﬃc?
Our performance evaluations thus far have indicated that the p2p traﬃc ad-
versely aﬀects the accuracies of all anomaly detectors evaluated in this work.
What Is the Impact of P2P Traﬃc on Anomaly Detection?
11
We now investigate whether training a detector on p2p traﬃc can mitigate this
torrent eﬀect. To this end, we develop training sets with a proportion of p2p traf-
ﬁc which has been reported in Internet study reports [1]. We vary the proportion
of p2p traﬃc in the training set from 40-80% and train NETAD and Maximum
Entropy on this training set; TRW-CB and Rate Limiting do not require training
and therefore we do not need to evaluate them in the present context. We then
evaluate accuracies of the anomaly detectors on the entire dataset (containing
all the p2p, malicious and background traﬃc).
Figure 4 shows the results for training NETAD and Maximum Entropy on
diﬀerent proportions of p2p traﬃc. It can be clearly seen from Figure 4 that
training Maximum Entropy on p2p traﬃc not only degrades its accuracy but
also increases its false positives rate. In case of NETAD, although we observe
an increase in detection rate, a 30% increase in false positive rate is induced as
we increase the amount of p2p traﬃc in the training set. This is mainly because
p2p clients communicate with each peer on diﬀerent ports and therefore it is
not possible to deﬁne an eﬀective ﬁltering rule for NETAD or derive a robust
baseline distribution for Maximum Entropy. Hence we conclude that training
these anomaly detectors on p2p traﬃc does not mitigate the torrent eﬀect mainly
because contemporary detectors are not designed to ﬁlter or incorporate the