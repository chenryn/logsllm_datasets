Sniffing Keystrokes With Lasers/Voltmeters
Sniffing Keystrokes With Lasers/Voltmeters
Side Channel Attacks Using Optical Sampling Of 
Mechanical Energy And Power Line Leakage
 Copyright 2009 Inverse Path Ltd.
Andrea Barisani
Chief Security Engineer
http://www.inversepath.com
Daniele Bianco
Hardware Hacker
Introduction
DISCLAIMER:
All the equipment and/or circuits and/or schematics provided in the 
presentation must be treated as examples, use the presented 
information at your own risk! Safety first!
Copyright 2009 Inverse Path Ltd.
               Andrea Barisani  
               Daniele Bianco  
This work is released under the terms of the Creative Commons 
Attribution-NonCommercial-NoDerivs License available at 
http://creativecommons.org/licenses/by-nc-nd/3.0.
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
Two
Unconventional Attacks
● Attack 1: Power Line Leakage detection against wired PS/2 
keyboards
● Attack 2: Optical Sampling of Mechanical Energy against 
laptop keyboards
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
Why bother ?
● Getting bored by software...hardware hacking is good fun!
● Unconventional side channel attacks
● Relatively cheap hardware
● FRIGGING LASER BEAMS!
● As always....more important: girls will melt when you show 
this...
● This is still a work in progress, we are planning to 
considerably refine the data/equipment presented in the 
next months
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
TEMPEST
● What is TEMPEST ?
Transmitted Electro-Magnetic Pulse / Energy Standards & Testing
Tiny ElectroMagnetic Particles Emitting Secret Things
The Emissions Might Produce Extremely Sweet Talks
● Investigations and studies of Compromising Emanations or 
Fortuitous Leakage
● Unintentional intelligence-bearing signals which, if 
intercepted and analyzed, may disclose information
● The term was coined in the late 60's and early 70's as a 
codename for the NSA operation to secure electronic 
communications equipment from potential eavesdroppers
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
Public Research
Relevant to Attack 1
● Van Eck, Wim (1985). "Electromagnetic Radiation from 
Video Display Units: An Eavesdropping Risk?”
● Kuhn, M.G. (2002). “Optical time-domain eavesdropping 
risks of CRT displays”
● Kuhn, M.G. (2004). “Electromagnetic Eavesdropping Risks 
of Flat-Panel Displays”
● J. Loughry, D. A. Umphress (2002). “Information Leakage 
from Optical Emanations”
● Martin Vuagnoux, Sylvain Pasini (awaiting peer review) 
“Compromising radiation emanations of wired keyboards”
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
First Attack
Theory
● Keyboard PS/2 cable carries the following wires:
● Pin 1 Data
● Pin 3 Ground
● Pin 4 +5 V DC
● Pin 5 Clock
● Pin 2/6 Unused
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
First Attack
Theory
● The wires are very close to each other and poorly shielded
● There is a fortuitous leak of information going from the data 
wire (as well as other sources) to the ground wire and/or 
cable shielding
● The ground wire is routed to the main power adapter/cable 
ground which is then connected to the power socket and 
then the electric grid
DATA
CLK
V +5
GND
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
cable shielding
First Attack
Theory
● Information about the keystrokes leaks to the electric grid
● It can be detected on the power plug, including nearby ones 
sharing the same electric line
● The clock frequency of PS/2 signal is lower than any other 
component or signal emanated from the PC (everything else 
is tipically above the MHz)
● Isolate the leakage by filtering out the signal from the noise
● Profit!
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
First Attack
Theory
● There is some documentation suggesting the possibility of 
this attack in literature, though no extensive research is 
available (maybe some government agency...)
● While working on this research we had some independent 
confirmation, the cool preliminary results of Martin 
Vuagnoux, Sylvain Pasini also suggest that “the shared 
ground may acts as an antenna and significantly improve 
the range of the attack“ (we look forward to read their 
paper!)
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
The PS/2 Signal
● Data is transmitted one byte at a time
● Each byte is sent in a frame consisting of 11-12 (h2d) bits
● Letter 'b' (scan code 32): | 0 | 01001100 | 0 | 1 |
● The clock frequency range is 10 - 16.7 kHz
 --------------- --------------- ---------------- -------------- -------------
| Start (1 bit) | Data (8 bits) | Parity (1 bit) | Stop (1 bit) | Ack (1 bit) |
 --------------- --------------- ---------------- -------------- -------------
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
            1  0  0   1    0  0   1  1   0   0   0   1    
Diagram
Keyboard
PC
GND
Mouse
PS/2
PS/2
Vin
ADC
Vref
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
~150 Ohm
REFERENCE GND
Testing the Theory
● We used a digital oscilloscope as ADC for our initial test
● We route the ground of a nearby power socket to the ADC
● We measure the current dispersed on the ground using the 
voltage potential difference between the two ends of the 
resistor
● A “reference” ground clean of electrical system noise is used 
for improving the measurement (yes, it is weird)
● “nearby” power socket refers to anything connected to the 
same electrical system
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
The Evil Power Cable
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
The Reference Ground
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
● Sinks and WC are perfect! (hint for spies: hotel rooms have 
those) ...very classy...
The Testing Lab
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
● The testing has been performed in a nuclear physics 
laboratory with lots of particle detectors, power adapters 
and other noisy equipment running
● Complex electric grid topology
● The ground was extremely noisy,
substantially more than a normal scenario
Sniffing the Signals
● Original data
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
Filtering the Noise
● We need to find our 10 – 16.7 kHz signal among a huge 
amount of noise
● A Finite Impulse Response (FIR) acting as a Band Pass filter 
selecting frequencies between 1 – 20 kHz is used
● 1 Msps / 100 ksps is a sufficient rate for the analysis
● Scilab example:
[h,filter_mag,fr] = wfir('bp',order,[.001,.02],'hm',[0,0]);
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
Filtering the Noise
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
Results
● Noisy ground signal
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
Results
● Ground noise + filtered signal comparison
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
Results
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
Results
● | 0 | 00111000 | 0 | 1 | = letter 'a'
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
●      0 0 0 1 1 1 0 0 0 0 1
Results
● Ground noise + filtered signal comparison
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
Results
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
Results
● | 0 | 00111000 | 0 | 1 | = letter 'a'
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
●      0 0 0 1 1 1 0 0 0 0 1
Results
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
Results
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
Results
● | 0 | 01001100 | 0 | 1 | = letter 'b'
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
●      0 0  1  0 0  1 1  0 0 0 1
Estimating Attenuation
● Attenuation coefficients for wire copper are often estimated 
for much higher frequencies (>1Mhz)
● Considering a typical copper cable with a coefficient of 0.1 
dB after 60m 50% of the signal survives (theoretically!)
● In our tests we didn't notice significant differences between 
the signal at 1.5m and 15m
● A typical signal has an output power of ~1 pW (10^-9 Watt)
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
Continuous Sniffing
Sniffing Keystrokes With Lasers/Voltmeters
 Copyright 2009 Inverse Path Ltd.
Keyboard
PC
GND
Mouse
PS/2
PS/2
Vin
ADC (12 bit)
1 Msps / 100 Kps
Vref
~150 Ohm
REFERENCE GND
Filtering