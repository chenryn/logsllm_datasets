AS-Path Prepending: there is no rose without a thorn
IMC ’20, October 27–29, 2020, Virtual Event, USA
Figure 16: Hijacking: Fraction of BGP monitors adopting a hijacked route.
Figure 17: Fraction of prepended pre-
fixes with ROAS.
We ran our measurements between January 13th, 2020, and
January 17th, 2020. In each round, we announce our prefix using
two different ASNs as originators. We first announce it via one
of the PEERING’s PoPs to all attached upstreams using AS61574
as originator and 0, 1, 2, or 3 prepends. Then, 15 minutes later,
we also announce the same prefix via a second PEERING PoP to
all its upstreams without prepends using AS61575.13 30 minutes
after the second announcement, we withdraw all routes for the
prefix. 30 minutes later, we repeat the experiment using a different
combination of PoPs and/or number of prepends. We select PoPs
based on their location and number of upstreams: Amsterdam, 44;
Seattle, 33; GaTech, 4; GRnet, 4; and Clemson, 1. To capture the
prefix hijack’s impact, we analyze the fraction of BGP monitors
that adopted the “hijacked route” via AS61575.
Figure 16 shows the fraction of monitors that adopted the hi-
jacked route per pair of PoPs and prepend size. The results confirm
the intuition that the likelihood of prefix hijacking succeeding in-
creases with the number of prepends. Overall, we find that if the
initial announcement used three prepends, at least 94% of the mon-
itors adopted the hijacked route, even when the hijacking location
only has single upstream (e.g., Clemson). Still, connectivity plays a
vital role in the success of prefix hijacking. For all cases where we
attempted to hijack the prefix from Amsterdam (a highly connected
PoP), we succeeded for at least 93% of the monitors. In contrast,
when we hijack via Clemson (a poorly connected PoP), we only suc-
ceed if the other PoP is prepending three times. Except for Clemson,
all other PoPs were able to hijack Seattle mostly. Also, Seattle (with
33 upstreams) had less success in hijacking routes unless they had
three prepends, which highlights the complexities of the Internet
routing ecosystem.
Our results using a uniform prepending policy are an indication
of how ASPP can increase the success of a hijacking attempt. While
in § 5 we show that ASes uniformly prepend many prefixes, most
ASes use a binary or diverse prepending policy, whereby one route is
often not prepended. This means that the increased risk of hijacking
only applies to the part of the Internet that chooses the prepended
route.
More than 18% of prepended prefixes include apparently
unnecessary prepending, which increases their exposure to
hijacking and route leaks.
While for most prepended prefixes (169k) the minimum prepend
size is 0, still many ASes originate prefixes with at least one prepend
to all their neighbors, which can increase their exposure to hijacks
and/or route leaks. For example, on May 4th, 2020, 6.9k ASes origi-
nated 38.5k prefixes with this characteristic (18.6% of all prepended
prefixes). Among these, 29.4/7.4/2k used a uniform, binary, diverse
policy. All these routes contain at least one unnecessary prepend—
all their policies can be implemented with less prepending (at least
as observable at the BGP monitors).14 To further understand such
potential risks, we use the BGPWeekly dataset to analyze the mini-
mum prepending size for all prepended prefixes. Based on results in
Figure 15, we see that the above finding holds across time, and also
that the number of affected prefixes has grown.
7.3 RPKI-covered prepended prefixes
One of the main techniques for enhancing routing security is
RPKI (Resource Public Key Infrastructure). RPKI allows ASes to
create ROAs (Route Origination Authorizations) for each of their
prefixes that other ASes can use to validate routes using ROV (Route
Origin Validation) [18, 53, 66]. Although ROV cannot avoid the re-
moval of prepends (see § 7.1), it can protect against prefix hijacking
attacks in which the hijacker alters the origin AS [17, 60]. Given
that ASPP potentially increases the exposure during hijacking at-
tacks, we analyze to which degree prepended prefixes are protected
by ROAs.
Most prepended prefixes are not covered by ROAs. We use
the ROAS dataset to check which of the prepended prefixes in the
BGPWeekly dataset has a ROA object. Figure 17 shows the coverage
by ROAs of all prefixes in which all alternatives contain prepend
and for those prefixes without prepend (none).
13The PEERING testbed requires us to add AS47065 after the originating AS to the AS
path.
14We confirmed this conclusion in our conversations with network operators.
IMC ’20, October 27–29, 2020, Virtual Event, USA
Pedro Marcos et al.
We observe first that the fraction of prefixes covered by ROAs
has been increasing in the past years. On the other hand, we note
that no more than 25% of the prefixes in each prepending class have
ROAs15. This indicates that most prepended prefixes are not even
partially protected against prefix hijacking attacks, regardless of
the minimum number of prepends.
Discussion. Our security related results confirmed the assump-
tions that most network operators shared with us. Nevertheless,
some of them argued that coming close to a specific traffic distri-
bution may be more important to some ASes than reducing the
potential impact of prefix hijacks—especially with the added secu-
rity due to the increasing ROV deployment.
8 RELATED WORK
Previous studies already focused on characterizing ASPP, under-
standing its effectiveness, and pointing out possible security as-
pects.
Characterization. To understand the characteristics of ASPP, pre-
vious work analyzed the view of ISPs [25], IXPs [10], and route
collectors [11, 27, 67, 77]. Since their numbers were inconsistent,
we refreshed and extended their findings by performing a 10-year
analysis of the main properties of ASPP. In addition, our work is the
first that focuses on prepending policies rather than only utilization
rates.
Effectiveness. Swinnen et al. found—in simulations based on a
degree-based network model—that ASPP cannot always move all
traffic [64]. This finding was later confirmed in 2004 by Quoitin
et al. when running measurements from a single vantage point
connected to two upstreams [50] (similar to our effectiveness mea-
surements). In contrast to their methodologies, we emulated and
tested more than 100 real-world location combinations and showed
that the effectiveness of ASPP varies substantially by location and
the number of upstreams through which an AS announces the
prepended prefix.
Security. Zhang et al. analyzed the potential of interception-attacks
exploiting ASPP based on simulations on an AS Graph extracted
from the public BGP data of RouteViews and RIPE RIS [76]. They
show that well-connected ASes (e.g., Tier-1 ASes) are less prone
to this type of attack and that longer prepends amplify their risks.
We actively measure the security impact that ASPP has based on
hijack emulations from various locations and experiments to iden-
tify ASes that remove prepends; we also observed that 18.6% of
prepended prefixes have unnecessary prepend sizes that increase
their exposure to attacks.
9 FINAL REMARKS
Despite mixed opinions about ASPP in the networking commu-
nity, we find that ASPP is still very present on the Internet, and
its utilization is slightly increasing. Surprised by this, we checked
with operators and found that the main reasons are the simplicity
of ASPP and the fact that it does not have any prerequisites. Our
analysis of ASPP reveals that prepending policies are mostly sta-
ble over time; that ASes are using a wide range of policies when
15We note that the fraction of prepended prefixes whose minimum number of prepends
is zero that has ROAs is similar to the ones in the plot.
announcing their prefixes; and that prepend sizes are becoming
polarized—with either one or more than three prepends.
We unexpectedly spot many ASes uniformly prepending (all)
their prefixes to all neighbors, hence not influencing any remote
routing decision. Via our conversations with operators, we identi-
fied poor housekeeping of BGP configurations, limited knowledge
about BGP, and desire for stability as the possible leading causes.
Our complementary analyses with traceroutes and cross-checks
with CDN data confirm that, the limited visibility of public route
collector projects cannot be the explanation for most of our obser-
vations.
During our interviews, many operators pointed out that using
ASPP suffices to accomplish their ITE goals. Our active measure-
ments confirm that ASPP is effective—since even small prepend
sizes can steer the traffic of multiple routes—if used with many
upstreams. When using only two upstreams, ASPP’s effectiveness
is dependent on the AS location.
We also discuss the security implications of ASPP. First, we show
through active measurements that some ASes remove prepends,
but it appears to be rare at the moment. Second, we find that ASPP
can increase the spread of prefix hijacks, since the hijacked route is
more attractive (than the actual route) to a larger fraction of ASes.
Third, we detect that ASes originate 18% of the prepended prefixes
with unnecessary prepends.
ASPP has value, and ASes are using it extensively on the In-
ternet. However, as Internet paths are getting shorter (as the core
is getting denser), the need for large prepend sizes is decreasing.
Thus, given the security implications of large prepends and the
fact that small prepends are often sufficient for moving traffic, we
recommend network operators to review their prepending policies,
removing unnecessary prepends and using small prepend sizes
when performing ITE.
ACKNOWLEDGEMENTS
We thank the anonymous reviewers and our shepherd, Rocky
Chang, for their valuable feedback on our paper. We are also very
thankful to all network operators for their valuable insights re-
garding the deployment, effectiveness, and security implications of
ASPP. We are grateful to the three CDNs and the IXP who shared
their data and the PEERING Testbed team for all their support dur-
ing our active measurements. This work was supported by National
Science Foundation grant CNS-1705024.
REFERENCES
[1] RIPE Routing Information Service. Available at http://www.ripe.net/ris/ Last
[2] Routeviews Project – University of Oregon. Available at http://www.routeviews.
accessed: May 30th, 2020.
org/ Last accessed: May 30th, 2020.
[7] B. Augustin, X. Cuvellier, B. Orgogozo, F. Viger, T. Friedman, M. Latapy, C. Mag-
nien, and R. Teixeira. Avoiding Traceroute Anomalies with Paris Traceroute. In
Proceedings of the 2006 Internet Measurement Conference, pages 153–158, 2006.
[3] AFRINIC. stats. Available at https://ftp.afrinic.net/pub/stats/afrinic/ Last accessed:
[4] AMS-IX. AMS-IX breaks through 8 Tbps barrier, 2020. Available at https://
www.ams-ix.net/ams/news/ams-ix-breaks-through-8-tbps-barrier Last accessed:
April 14th, 2020.
[5] APNIC. stats. Available at https://ftp.apnic.net/apnic/stats/apnic/ Last accessed:
[6] ARIN. stats. Available at https://ftp.arin.net/pub/stats/arin/ Last accessed: May
May 31st, 2020.
May 31st, 2020.
31st, 2020.
AS-Path Prepending: there is no rose without a thorn
IMC ’20, October 27–29, 2020, Virtual Event, USA
[8] H. Ballani, P. Francis, and X. Zhang. A Study of Prefix Hijacking and Interception
in the Internet. ACM SIGCOMM Computer Communication Review, 37(4):265–276,
2007.
[9] T. Böttger, G. Antichi, E. L. Fernandes, R. di Lallo, M. Bruyere, S. Uhlig, and
I. Castro. The Elusive Internet Flattening: 10 Years of IXP Growth. CoRR, 2018.
[10] S. H. B. Brito, M. A. Santos, R. dos Reis Fontes, D. A. L. Perez, and C. E. Rothenberg.
Dissecting the Largest National Ecosystem of Public Internet eXchange Points in
Brazil. In International Conference on Passive and Active Network Measurement,
pages 333–345. Springer, 2016.
[11] A. Broido, E. Nemeth, and k. claffy. Internet Expansion, Refinement and Churn.
European Transactions on Telecommunications, 13(1):33–51, 2002.
[12] CAIDA. Archipelago (Ark) Measurement Infrastructure. Available at https:
//www.caida.org/projects/ark/ Last accessed: June 2nd, 2020.
[13] CAIDA. The CAIDA UCSD AS Classification Dataset, 1st February 2020. Available
at https://www.caida.org/data/as-classification Last accessed: May 30th, 2020.
[14] CAIDA. The CAIDA UCSD AS to Organization Mapping Dataset, May 4th, 2020.
Available at https://www.caida.org/data/as_organizations.xml Last accessed: June
1st, 2020.
[15] R. K. Chang and M. Lo. Inbound Traffic Engineering for Multihomed ASs Using
AS Path Prepending. IEEE Network, 19(2):18–25, 2005.
[16] K. Chen, D. R. Choffnes, R. Potharaju, Y. Chen, F. E. Bustamante, D. Pei, and
Y. Zhao. Where the Sidewalk Ends: Extending the Internet AS Graph Using
Traceroutes from P2P Users. In Proceedings of the 5th International Conference on
Emerging Networking Experiments And Technologies, pages 217–228, 2009.
[17] S. Cho, R. Fontugne, K. Cho, A. Dainotti, and P. Gill. BGP hijacking classification.
In 2019 Network Traffic Measurement and Analysis Conference, pages 25–32. IEEE,
2019.
[18] T. Chung, E. Aben, T. Bruijnzeels, B. Chandrasekaran, D. Choffnes, D. Levin,
B. M. Maggs, A. Mislove, R. v. Rijswijk-Deij, J. Rula, et al. RPKI is Coming of
Age: A Longitudinal Study of RPKI Deployment and Invalid Route Origins. In
Proceedings of the 2019 Internet Measurement Conference, pages 406–419, 2019.
[19] Cisco. Influencing Inbound Path Selection by Modifying the AS_PATH Attribute,
2018. Available at https://www.cisco.com/c/en/us/td/docs/ios-xml/ios/iproute_
bgp/configuration/xe-3se/3850/irg-xe-3se-3850-book/irg-prefix-filter.html Last
accessed: April 14th, 2020.
[20] DE-CIX. Highest jump ever: DE-CIX Frankfurt reaches 9.1 Tbps, 2020. Available
at https://www.de-cix.net/de/news-events/news/de-cix-frankfurt-reaches-9-1-
tbps Last accessed: April 14th, 2020.
set as-path, 2020.
Available at https://www.dell.com/support/
manuals/de/de/debsdt1/networking-z9100/z9100-on-9.14.2.6-cli-pub/set-as-
path?guid=guid-f2652337-11a3-4dce-bc31-6bd3729bfbf3&lang=en-us
Last
accessed: April 4th, 2020.
[22] G. Di Battista, M. Patrignani, M. Pizzonia, and M. Rimondini. Towards Optimal
Prepending for Incoming Traffic Engineering. In 3rd International Workshop on