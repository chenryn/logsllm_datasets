不同视角下的网站性能
网站性能测试
用户
一
4通过屏幕看到响应信息
通过鼠标或键盘发出请求操作一
图4.1用户视角的网站性能
用户计算机
>网站在线用户数>>网站并发用户数
指系统能够同时处理请求的数目，这个数字也反映了系统的负载特性。对于网站而
指单位时间内系统处理的请求数量，体现系统的整体处理能力。对于网站，可以用
3.吞吐量
2.并发数
在系统并发数由小逐渐增大的过程中（这个过程也伴随着服务器系统资源消耗逐渐
4瞬时响应：网站的高性能架构下
37
---
## Page 59
达系统崩溃点后，系统失去响应。系统吞吐量、系统并发数及响应时间之间的关系将在
增大），系统吞吐量先是逐渐增加，达到一个极限后，随着并发数的增加反而下降，达到
最大限度利用服务器资源。
费不增反降；如果车流量继续增加，超过某个极限后，任何偶然因素都会导致高速全部
收到的高速费也相应较少；随着高速公路上车辆数目的增多，车速略受影响，但是收到
是高速公路上的正在行驶的车辆数目，响应时间是车速。车辆很少时，车速很快，但是
本章后面内容中介绍。
系统崩溃点后，系统资源耗尽，吞吐量为零。
38
中使用top命令查看，该值是三个浮点数，表示最近1分钟，10分钟，15分钟的运行队
这些指标设置报警阈值，当监控系统发现性能计数器超过阈值时，就向运维和开发人员
内存使用、CPU使用、磁盘与网络IO等指标。这些指标也是系统监控的重要参数，对
瘫痪，车走不动，费当然也收不着，而高速公路成了停车场（资源耗尽）。
的高速费增加很快；随着车辆的继续增加，车速变得越来越慢，高速公路越来越堵，收
状况：吞吐量是每天通过收费站的车辆数目（可以换算成收费站收取的高速费），并发数
列平均进程数。如图4.2所示。
程在排队等待CPU调度，表示系统资源不足，影响应用程序的执行性能。在Linux系统
目的时候，表示CPU有空闲，资源存在浪费；当Load值高于CPU数目的时候，表示进
和，是反映系统忙闲程度的重要指标。多核CPU的情况下，完美情况是所有CPU都在使
报警，及时发现处理系统异常。
用，没有进程在等待处理，所以Load的理想值是CPU的数目。当Load值低于CPU数
大型网站技术架构核心原理与案例分析
网站性能优化的目的，除了改善用户体验的响应时间，还要尽量提高系统吞吐量，
而这个过程中，响应时间则是先保持小幅上升，到达吞吐量极限后，快速上升，到
系统吞吐量和系统并发数，以及响应时间的关系可以形象地理解为高速公路的通行
SystemLoad即系统负载，指当前正在被CPU执行和等待被CPU执行的进程数目总
它是描述服务器或操作系统性能的一些数据指标。包括SystemLoad、对象与线程数、
4.性能计数器
---
## Page 60
求，以此获得系统最大压力承受能力。
不但不能提高，反而会下降。
安全临界值，如某种资源已经呈饱和状态，这时继续对系统施加压力，系统的处理能力
源可接受范围内，是否能达到性能预期。
段），这一段是网站的日常运行区间，网站的绝大部分访问负载压力都集中在这一段区间，
统运行一段较长时间，以此检测系统是否稳定。在不同生产环境、不同时间点的请求压
4.1.3
始阶段，随着并发请求数目的增加，系统使用较少的资源就达到较好的处理能力（a~b
试程序的并发请求数，一般说来，性能测试遵循如图4.3所示的抛物线规律。
最大压力承受能力的过程。所谓的增加访问压力，在系统测试环境中，就是不断增加测
对系统施加压力。
力是不均匀的，呈波浪特性，因此为了更好地模拟生产环境，稳定性测试也应不均匀地
性能测试是一个不断对系统增加访问压力，以获得系统性能指标、最大负载能力、
被测试系统在特定硬件、软件、网络环境条件下，给系统加载一定业务压力，使系
对系统不断地增加并发请求以增加系统压力，直到系统的某项或多项性能指标达到
以系统设计初期规划的性能指标为预期目标，对系统不断施加压力，验证系统在资
性能测试是一个总称，具体可细分为性能测试、负载测试、压力测试、稳定性测试。
图4.3中的横坐标表示消耗的系统资源，纵坐标表示系统处理能力（吞吐量）。在开
稳定性测试
超过安全负载的情况下，对系统继续施加压力，直到系统崩溃或不能再处理任何请
压力测试
负载测试
性能测试
top 16:36:49up 1 day,5:53,7users,load average:0.14,0.20,0.16
性能测试方法
图4.2在Linux命令行查看系统负载
4瞬时响应：网站的高性能架构
39
---
## Page 61
图4.4所示。
系统的处理能力。与性能曲线相对应的是用户访问的等待时间（系统响应时间），如
何请求，这一段被称作压力测试，测试目标是评估可能导致系统崩溃的最大访问负载压
增加，系统处理能力增加变缓，直到达到一个最大值（c点），这是系统的最大负载点，
被称作性能测试，测试目标是评估系统性能是否符合需求及设计目标；随着压力的持续
个点可以看作是系统的崩溃点，超过这个点继续加大并发请求数目，系统不能再处理任
力，系统的处理能力反而下降，而资源消耗却更多，直到资源消耗达到极限（d点），这
下，保证系统正常运行情况下能够承受的最大访问负载压力；超过这个点后，再增加压
这一段被称作负载测试。测试目标是评估当系统因为突发事件超出日常访问压力的情况
7
大型网站技术架构核心原理与案例分析
40
性能测试反应的是系统在实际生产环境中使用时，随着用户并发访问数量的增加，
响应时间
TPS
性能测试
日常运行区间
图4.4并发用户访问响应时间曲线
系统最佳运行点
图4.3性能测试曲线
负载测试
系统最大负载点
压力测试
系统前溃点
a
并发用户数
系统资源
---
## Page 62
4.1.5性能优化策略
表4.2是一个简单示例。
逐步优化。
否满足设计目标和业务要求、系统最大负载能力、系统最大压力承受能力等重要信息，
4.1.4
迟越来越大，直到系统崩溃，用户失去响应。
分析影响性能的主要因素是内存、磁盘、网络、还是CPU，是代码问题还是架构设计不
合理，或者系统资源确实不足。
理的各个环节的日志，分析哪个环节响应时间不合理、超过预期；然后检查监控数据，
各个环节进行分析，排查可能出现性能瓶颈的地方，定位问题。
过很多环节，如果测试或者用户报告网站响应缓慢，存在性能问题，必须对请求经历的
并发数
10
80
60
40
30