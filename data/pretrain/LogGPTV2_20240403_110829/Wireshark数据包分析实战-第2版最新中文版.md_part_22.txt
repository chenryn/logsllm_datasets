ZSTETETS
6433134.52
413.13452
TCPConversations
PotBPkts
ELimito dapiyfite
ByS
自然而然会想到去找一个方
Clove
---
## Page 231
但并不主动向目标发送任何流量。对黑客来说，这是最理想的操作系统指纹技
常见域及其默认值
必须为这些域定义它自己的默认值。表10-1列出了一些与操作系统实现有关的
但并没有定义这些域的默认值。这意味着不同操作系统实现的TCP/P协议栈都
的值，这完全是有可能的。虽然TCP、UDP和IP头部的各个城都有特定含义，
作系统了？这其实非常容易，由于RFC文件定义的协议并未规定全部技术参数
术，因为它非常隐蔽。
TCP
TCP
IP
IP
头部
TCP
协议
表10-1常见的被动式指纹值
那就是说，我们只需要基于主机发送的数据包，就能确定它使用哪一种操
被动式指纹技术通过分析目标发送的数据包的某些域来确定目标使用的操
10.1.2.1被动式指纹技术
SackoK
窗口大小
最长段大小
不分片标志
初始TIL
域
Notset
Set
Variable
24820
4128
16384
2920-5840
65535
0
Notset
默认值
1024-4096
1460
1440
第10章安全领域的数据包分析217
Cisce IOS.Solaris
Nmap.FreeBSD.Mac OS10.Novell
Linux.Windows.OpenBSD
Windows.
Solaris
Cisco IOs
Novell
Linux
BSD.MacOS 10
BSD.MacOS10.Linux、Soliris
Windows.Novell
Nmap
Nmap.Cisco los
Windows、Palm Os.Solaris
BSD、Mac OS 10.Linux.Novell
Cisco IOS.Palm OS. Solaris
Novell.Windows
Nmap、BSD、Mac OS 10.Linux
操作系统
---
## Page 232
218Wireshark数据包分析实战（第2版）
能性最大，而发送数据包2的设备运行Linux的可能性最大。
协议
表10-2操作系统指纹术的数据包分类
依赖被动式操作系统指纹技术得到的结果。
司
TCP
TCP
参考表10-1，我们将这些数据包的相关域分类，创建了表10-2。
图10-7这些数据包可以告诉我们它们来自哪种操作系统
窗口大小
最长段大小
不分片标志
初始TIL
SackOK
数据包1的值
Set
64240 Bytes
1440Bytes
Set
128
0（）
12.100
数据包2的值
Set
2920Bytes
1460Bytes
台
---
## Page 233
10.2.1
10.2
注意
注意
漏洞利用
极光行动
于这种方法要与受害者直接通信，它并不是最隐蔽的，但它可以做到非常高效，
包以引起响应，然后从响应数据包中获知受害者机器操作系统的技术。当然，由
方法叫做“主动式指纹技术”。它是指攻击者主动向受害者发送特意构造的数据
包的相关域，
Scanning》
引起的响应可用于识别操作系统。Nmap记录下对这些探测数据包的响应并创建
指纹扫描的例子。文件中有一些是Nmap发送的探测数据包，这些探测数据包
一个指纹，与指纹数据库对比后得出结论
捕获文件activeosfingerprinting.peap包含了使用Nmap扫描工具发起主动式
Nmap使用的主动式操作系统指纹技术十分复杂。想了解Nmap如何执行主
当被动监听流量不能得到想要的结果时，可能需要一个更直接的方法。这种
10.1.2.2主动式指纹技术
攻击者是吃饭还是喝粥，就要看漏洞利用阶段的表现了，攻击者已经研究并侦
这是Nmap 扫描器作者Gordon “Fyodor”Lyon的著作.
然后输出可能的操作系统，使用像pOf这样的工具，你不仅能了
第10章安全领域的数据包分析 219
---
## Page 234
40004512.16102069218100202TGfTP/
HOST:
192.1
这些数据包包含在文件aurora.pcap中。
常能成功。
间的三次握手开始。初始化连接的目标是80端口，这使我们相信它是HTTP流
如图10-8所示。
量。第四个数据包证实了我们的假设，它是一个对/info的HTTPGET请求O
58
ng
100
8
GET请求，如图10-10所示。
202
x-xbitnap.
图10-8受害者做了一次针对/info的GET请求
206
82280
69285
261
orVn
---
## Page 235
6cOdDa
FoliowTCFStrem
StreamContent
Content-Leaghe
Locat
Help
ept
EOT
srct
TYPE
inaoe
8
在此之后，
keep-ATtve
text/htnT
en
图10-9客户端测览器被这个数据包重定向
，事情变得十分奇怪了，攻击者对GET请求响应了一些看起来非
图10-10 发送到客户端的数据流
929
R
第10章
FaterOuaThu Saten
00:0c:29:07
165.
安全领域的数据包分析221
-rlash,
---
## Page 236
222Wireshark数据包分析实战
图10-11标签内的杂乱内容看起来像是被编码了
4.OFJEN
stringc1:
gribp3:
ASCuCA
2
Th
---
## Page 237
RreamCent
Directory of c:oc
Fo PS
FollowTCP Stream窗口的输出。
种方式，触发已经下载到受害者机器上的漏洞利用代码。
个案例中，标签引用了一个名字古怪的GIF文件如图10-13所示，当
的标志，因为这些文本出奇得长、包含不可读的随机字符串和可能被混滑过的文本。
请求O，紧接着GIF文件就被传送过来了O。这个GIF文件有可能被用来以某
受害者的浏览器发现对这个文件的引用时，它在数据包21中发送了一个GET
页面中嵌入额外内容。标签创建了一个内联帧，并不被用户察觉。在这
当受害者向攻击者的4321端口初始化连接时，文件中最奇怪的一部分出现
标签内包含了一个 iframe，这是攻击者惯用的手法，用于在 HTML
图10-13受害者请求并下载iframe中指明的GIF文件
192.188
sinentsand sectings
bytes
®
dninitstratnrLpesktoy
第10章安全领域的数据包分析223
---
## Page 238
224
机器的目录内容。
免被网络IDS发现。就其本身而言，没有对这个漏洞利用程序的事先了解，也
把计算机的完全控制权限交给了攻击者。
生了什么。幸好，我们可以从数据包捕获中辨认出恶意代码的一些蛛丝马迹。
没有该程序的代码样本，在没有进一步分析之前很难说清受害者系统上到底发
解释器
在这里，
像这样的漏洞利用程序在线路上传输信息时通常都编码成不可识别，以避
我们在这里总结一下极光漏洞利用程序是如何工作的。
里面的一个链接，向攻击者的恶意网站发送一个GET请求。
URL自动发起一个GET请求。
iframea
码，并在受害者机器上执行。
开一个从受害者向攻击者的新会话。
进行交互
也许
---
## Page 239
10.2.2
注意
ARP缓存中毒攻击
非常关键的一步。这里描述的捕获是提升编写签名技能的好方法。要想了解
还需要一些额外的调整，但这已经是个很好的开端。
ARP缓存中毒攻击是网络工程师高效实用的工具。然而，若有恶意企图，它也
nort.org/.
更多有关入侵检测和攻击特征的信息，请访问 Snort 项目主页http:/www.
以及SSL劫持
增加几列，过程如下。
通信。
对尝试防御网络未知威胁的人而言，基于恶意流量样本创建流量签名是
ARP缓存中毒攻击之所以有效，是因为特意构造的ARP数据包使两台主机
在MITM攻击中，攻击者重定向两台主机间的流量，试图在传输过程中
在第2章中，我们讨论了将ARP缓存中毒攻击作为监听主机流量的方法。
3.单击Add
1.选择Edit->Preferences
第10章安全领域的数据包分析225
---
## Page 240
Uer nterface
226Wireshark数据包分析实战（第2版）
Potacol
apturt
Caken
Fort
的两列，分别显示了数据包的来源MAC地址和目标MAC地址。
6.单击新增加的项，拖动它到Source列后面。
4.输入SourceMAC并按回车键。
8.输入DestMAC并按回车键。
7.单击Add
5.
当你完成这些步骤时，你的屏幕应该如图10-15一样。你现在应该有额外
11.单击OK使改动生效。
10.单击新增加的项，拖动它到Destination列后面。
MAC
Sourceaddress
Time (omat pecfed
Nuibe
irdomation
Pmtocol
Pippertr
Feidtype
He det adorresoed)
---
## Page 241
求的设备。在这个背景下，我们从通信序列中发现了一些奇怪的事情，如图10-16
包含特定IP地址的机器的MAC地址。接着，响应信息作为单播数据包发给请
据包有两种类型：请求和响应。
所示。
击者。
自己的。
攻击者
路由器
受害者
角色
表10-3
是什么使流量变得奇怪呢？回忆一下我们在第6章对ARP的讨论，ARP数
在进一步深入之前，注意一下这次通信中涉及的端点，由表10-3列出
监视的端点
图10-16Dell设备和HP设备间奇怪的ARP流量
HP
Cisco
Dell
设备类型
请求数据包在网络上广播给所有主机，以发现
未知
172.16.0.1
172.16.0.107
IP地址
第10章安全领域的数据包分析227
00:25:b3:b(:91:ec
00:26:06:21:07:33
00:21:70:00:56:10
MAC地址
---
## Page 242
注意
228
00:26:0b:21:07:33
Wireshark数据包分析实战（第2版）
据包
所示。
172.16.0.1
(Cisco)
路由器
们，现在的流量抵达路由器之前将被路由到攻击者。
路由器
何使用这种技术也是很重要的。
00:25:b3:bf:91:ee
攻击者
图10-17ARP欺骗导致MITM攻击
(HP)
攻击者
ARP Spoofing Result
（受害者的视角）
建立ARP欺骗