boundary constraint derived from Lemma 2, and au, bu are vectors of
constant terms for the upper boundary constraint derived from Lemma 2;
8 From the distortion vector (cid:5)δ returned from the optimization problem and
the estimated lengths(cid:8)l we compute the augmented Voronoi diagram;
9 Given the above Voronoi diagram and the offset vector (cid:5)δ returned from
the optimization problem we derive the reconstructed database by
substituting on the formulas of Lemma 5 in [33];
10 return ˜v0, . . . , ˜vn−1;
Evaluation on the Spitz Dataset. In this experiment, we
evaluate the performance of AGNOSTIC-RECONSTRUCTION-
KNN on a public real-world data set (also used in [33])
Authorized licensed use limited to: Tsinghua University. Downloaded on March 22,2021 at 04:12:16 UTC from IEEE Xplore.  Restrictions apply. 
1234
(b)
(c)
(d)
(a)
Fig. 12. Real-world dataset Spitz of a privacy-sensitive geolocation trace: (a) data for Otober 1-31, 2009; (b) mapping of the points to a Hilbert curve which
reduces the 2D data to 1D; (c) query distribution under attack, which consists of a permutation of a discretized Beta(α, β) distribution; (d) another query
distribution under attack, which is a Gaussian centered at the city of Hannover, Germany.
Sptiz Dataset 1-31 Oct., n=258, N=65536, Q=25 105
Permuted-Beta(1,1)
Permuted-Beta(1,3)
Permuted-Beta(1,5)
Permuted-Beta(1,10)
Gaussian
28
26
24
22
20
18
16
14
12
10
8
6
4
2
t
)
e
g
a
n
e
c
r
e
P
%
n
i
(
r
o
r
r
E
e
v
i
t
a
e
R
l
2
5
k value fo k-Nearest Neighbors
10
20
50
Fig. 13. Absolute relative error of AGNOSTIC-RECONSTRUCTION-KNN for
varying query distributions on the Spitz dataset.
containing the geolocation of politician Malte Spitz.1 As in [33],
we consider the geolocation data for the period October 1 to
31, 2009 and reduce the 2D data to 1D by deploying a Hilbert
curve of order 8. The resulting discretized curve has universe of
size N = 65536 and the dataset has size n = 258. The data is
shown on a super-imposed map in Figure 12(a) and its mapping
on a Hilbert curve is in Figure 12(b). The deployed query
distribution is a discretized beta for varying parameters, similar
to the experiments of the previous subsection but without any
noise, i.e., permuted over the universe of queries. We illustrate
this Permuted-Beta(α, β) query distribution with a heatmap
on the superimposed data in Figure 12(c). Finally we test a
Gaussian query distribution with mean centered at the city of
Hannover in Germany and it is illustrated in Figure 12 (d).
The number of queries that the adversary observed is set
to Q = 25 · 105 which is 100× smaller sample size than the
experiments conducted in [33]. Each attack was mounted 50
times and Figure 13 presents the average absolute relative
error. Due to the new design of our reconstruction attack we
were able to scale it to k = 50 an experiment that is not
feasible from the approach followed in [33]. As it is expected
the power-law like distribution Permuted-Beta(1,10) is the
hardest to reconstruct due to the skewness and the sample size.
Nevertheless the relative error ranges from 15% to 20% in this
challenging scenario. The reconstruction under the Gaussian
query distribution is accurate across all values of k.
Evaluation on Synthetic Dataset. We generated synthetic
databases under varying densities and query distributions for
1www.zeit.de/datenschutz/malte-spitz-data-retention
N = 103 and k = {2, 5, 10, 20, 50}. Figure 14 shows the
average of the mean absolute error of 100 repetitions with Q =
105. Note that for sparse databases, the distances between the
values are larger, hence the offset variables have “more room”
to deviate, which increases the size of the feasible region
and as a result, the number of possible valid reconstructions.
Another factor that increases the size of the feasible region
is the increase of the value k, an intuition conﬁrmed by the
MAE for k = 50 even for the uniform case Permuted-Beta(1,1)
which is easier to reconstruct. For densities larger than 20%,
the reconstruction is usually within a distance of 20 from the
plaintext value for all the tested query distributions.
80
20
10
5
2
l
)
e
a
c
s
-
g
o
l
(
l
)
e
a
c
s
-
g
o
l
(
80
20
10
5
2
l
)
e
a
c
s
-
g
o
l
(
80
20
10
5
2
140
80
20
10
5
l
)
e
a
c
s
-
g
o
l
(
r
o
r
r
E
e
t
l
u
o
s
b
A
n
a
e
M
r
o
r
r
E
e
t
l
u
o
s
b
A
n
a
e
M
r
o
r
r
E
e
t
l
u
o
s
b
A
n
a
e
M
r
o
r
r
E
e
t
l
u
o
s
b
A
n
a
e
M
Permuted-Beta(1,1)
k=2
k=5
k=10
k=20
k=50
10%
20%
40%
60%
80%
90%
Database Density
Permuted-Beta(1,3)
k=2
k=5
k=10
k=20
k=50
10%
20%
40%
60%
80%
90%
Database Density
Permuted-Beta(1,5)
k=2
k=5
k=10
k=20
k=50
10%
20%
40%
60%
80%
90%
Database Density
Permuted-Beta(1,10)
k=2
k=5
k=10
k=20
k=50
10%
20%
40%
60%
80%
90%
Database Density
Fig. 14. Performance of AGNOSTIC-RECONSTRUCTION-KNN for varying
query distributions on synthetic data.
Authorized licensed use limited to: Tsinghua University. Downloaded on March 22,2021 at 04:12:16 UTC from IEEE Xplore.  Restrictions apply. 
1235
V. RELATED WORK
For encrypted single-keyword search [4], [9], [11], [15], [23],
[31], [41], [43] the access pattern leakage of some leakage
proﬁles is vulnerable to query recovery attacks, as opposed to
the encrypted values. Speciﬁcally, Islam et al. [30], Cash et
al. [8], and Zhang et al. [45] give query-recovery attacks under
various assumptions. Encrypted systems with more expressive
queries [39] rely on different cryptographic primitives, e.g.,
order-preserving encryption, and are vulnerable to data-recovery
attacks [20], [28], [38] using only the setup leakage. In terms
of efﬁciency there is a series of works [1], [2], [10], [16], [18]
that study how the locality of searchable encryption affects
the overall efﬁciency. We review in Section I state-of-the-
art plaintext reconstruction attacks from from range queries
[27], [32], [34] and from k-NN queries [33]. Recent work
improves the asymptotic complexity of reconstruction from
range queries under uniform query distribution using search
pattern leakage [37].
VI. DISCUSSION & OPEN PROBLEMS
The proposed attacks of this work are applied successfully
to a wide range of realistic query distributions but it is worth
noting that there exist distributions where our attacks fail to
reconstruct. For example, the leakage observed in case all the
probability mass is assigned to a single query is not enough to
reconstruct the entire database. A similarly problematic case
appears when the client issues queries that touch plaintext
values from the ﬁrst half of the universe, i.e. [0, N/2], then
the adversary would never see any leakage associated with
the other half, i.e. [N/2, N ], and therefore fail to reconstruct
the entire database. We leave as an open problem the task
of characterizing the family of query distributions that are
vulnerable to our proposed attacks. Another open problem
is to analyze whether similar attacks can be mounted to the
leakage derived from querying high-dimensional data. All the
known attacks on ranges concern the quadratic scheme where
the inverted index contains an entry for every possible range
query. There exist constructions [17], [22] with much better
storage efﬁciency than the quadratic scheme that also leak
signiﬁcantly less information. An open problem is to study
whether it is possible to develop efﬁcient reconstruction attacks
for these advanced constructions for range queries. Moving on
to schemes with strictly less leakage, the so-called response-
hiding schemes store multiple copies of the same plaintext so
as not to reveal that a record participates in multiple responses,
i.e., they hide the overlap of records between responses via
paying storage overhead. These schemes are immune to all
the previous attacks as well as the attacks proposed in this
work, an open problem is to analyze whether there exist any
reconstruction attack for these schemes.
VII. CONCLUSION
This paper gives the ﬁrst attacks on range queries and
k-NN queries on encrypted databases that reconstruct the
plaintext values without any knowledge about the query or the
data distribution. Before our attacks, it was unclear whether
such a general leakage-based reconstruction is possible as all
previous approaches [27], [32], [33], [34] relied either on the
uniform query distribution assumption or the assumption that
the adversary knows both the query and the data distribution.