antenna in the RX chain has two primary leakage components from
the TX signal: one due to the direct leakage from the TX port of the
circulator to the ("isolated") RX port of the circulator, and one due
to reﬂections from impedance mismatch between the circulator and
the antenna. Because these two components travel different paths in
the circulator from TX port to RX port, they undergo different de-
lays as deduced from time domain measurements. These delays are
ﬁxed and are a function of the particular circulator and antenna we
choose to use. In our implementation we ﬁnd the delay of the direct
leakage component is 400 picoseconds, while the reﬂected compo-
nent is centered around 1.4 nanoseconds. With 16 lines we have the
capability to center the ﬁrst 8 lines to have delays around 400 pi-
coseconds, and the other 8 lines around 1.4 nanoseconds. We can
then use the interpolation trick discussed in Sec. 3.1 to cancel both
the direct and reﬂected self interference components precisely. As
expected with 8 lines, our ﬂexibility is reduced in terms of placing
our delay lines around the actual delays experienced by the self in-
terference and consequently cancellation is reduced.
5.2.3 Deconstructing Digital Cancellation
After 62dB of analog cancellation, digital cancellation needs to
clean up 48dB and 16dB of linear and non-linear self-interference
components respectively. In this section, we deconstruct the amount
of linear and non-linear cancellation achieved by our design. To con-
duct this experiment, we tune our analog cancellation circuit to pro-
vide 62dB of cancellation. We then progressively add more compo-
nents to our digital cancellation design. We ﬁrst implement only our
“linear " digital cancellation which cancels only the linear main self
interference components and multipath reﬂections from the environ-
ment. We then add the capability to model non-linear components
which we christen “non-linear cancellation" . We calculate the can-
cellation achieved by these two variants of digital cancellation tech-
niques. For comparison with prior work, we also implement only
the digital cancellation technique described in the balun based de-
sign [11]. We plot the increase in noise ﬂoor for all the techniques as
a function of Transmit power in Fig. 12.
As we can see, our full digital cancellation technique cancels ev-
erything to the thermal noise ﬂoor. Further, notice that just our linear
digital cancellation stage leaves 16 dB of self interference residue
above the thermal noise ﬂoor. Being able to model the non-linear
harmonics allows us to reduce self interference by a further 16 dB
and cleans out the non-linear distortions almost to the thermal noise
ﬂoor. In comparison, the prior work’s digital cancellation technique
falls far short, leaving nearly 18dB of self interference residue over
the noise ﬂoor since it cannot model non-linear distortions. Note
0#0.2#0.4#0.6#0.8#1#1.2#0#0.5#1#1.5#2#2.5#CDF)SNR)loss)of)RX)signal)(dB))64#QAM#16#QAM#QPSK#BPSK##256#QAM#0#0.2#0.4#0.6#0.8#1#1.2#0#0.5#1#1.5#2#2.5#CDF)SNR)loss)of)RX)signal)(dB))80#Mhz#40#Mhz##20#Mhz#-70-50-30-1010302.412.432.452.472.49Power in dBm Frequency in GHz Residual self-interference after analog Cancellation from 8 tapsResidual self-interference after analog Cancellation from 16 tapsTransmited self interference signal before Analog Cancellation45 dB 63 dB 384Figure 12: Performance of digital cancellation showing impact of different
components of the algorithm vs TX power with ﬁxed constellation = 64
QAM, bandwidth = 80MHz. Our algorithm cancels the main component,
reﬂections and harmonics, thus ensuring that self interference is completely
eliminated, and the increase in noise ﬂoor less the 1dB. Prior techniques can
not cancel harmonics, and therefore increase the noise by 18dB.
that we have given prior work the beneﬁt of an analog cancellation
of 62dB from our circuit, as we saw before in Sec. 5.1 if we used
their implementation of analog cancellation the numbers are worse.
5.2.4 Dynamic Adaptation
As environmental conditions change, the level of cancellation drops
since the values of the attenuators used will be off w.r.t to the new
conditions. In this section, we evaluate how long it takes to re-tune
analog cancellation, as well as how often it needs to be re-tuned in
our indoor environment. Note that digital cancellation is tuned on
a per-packet basic, hence it is not a concern. Analog cancellation
has to be tuned via a special tuning period during which no data is
transmitted, hence quantifying that overhead is important.
We conduct this experiment in our busy indoor environment with
other WiFi radios and students moving around. Note that an indoor
environment is the worst case scenario for full duplex, because of the
presence of a large number of reﬂectors near the transmitter. Outdoor
LTE scenarios are less likely to have such strong near-ﬁeld reﬂectors,
hence we believe our design extends relatively easily to outdoor LTE
scenarios. We place the full duplex node and conduct analog can-
cellation tuning as described in Sec. 3.3. Speciﬁcally, we use the
WiFi preamble to determine the initial settings of the attenuators to
be used to match the frequency response of the circulator and an-
tenna. Next we run a gradient descent algorithm to further improve
the cancellation from that initial point. Each iteration of the gradi-
ent descent consumes 92µs since we have 16 different directions to
compute the gradient one (corresponding to the 16 different attenu-
ators). We compute the time it takes for the analog cancellation to
converge. We repeat this experiment several times for different node
placements and environmental conditions and plot the average con-
vergence time. We also conduct an experiment where we do not use
the initial frequency based tuning and only use gradient descent from
a random starting point for the attenuator values. We show the can-
cellation achieved as function of tuning time on right side of Fig. 13.
As we can see in right side of Fig. 13, our analog tuning converges
in around 920µs, compared to the 40 or more milliseconds it takes
for a pure gradient descent based approach. The reason is that the
frequency based initial point estimation provides a point very close to
optimal, and from that point a few gradient descent iterations allow
us to ﬁnd the optimal point. Our cancellation algorithm therefore
tunes an order of magnitude faster than a simple gradient descent
based approach.
But an important question is how often do we have to tune? Ana-
log cancellation has to re-tuned when there is a change in the near-
ﬁeld reﬂections, since it cancels only the strong components (com-
ponents 50 dB above noise ﬂoor, farther out reﬂections are weaker
than this 50dB threshold). Hence the question is how often do the
Figure 13: Left ﬁgure shows CDF of near ﬁeld coherence time. This implies
that we have to retune analog cancellation on an average of every 100 mil-
liseconds. Right ﬁgure shows how long it takes for our tuning algorithm to
converge to the required cancellation, after the initiation of tuning. We ob-
serve exponential improvement compared to the gradient descent algorithm
which takes an order of magnitude longer.
Figure 14: CDF of throughput for full duplex link using TX power = 20
dBm, bandwidth = 80MHz. We see a median gain of 87% using full duplex as
compared half duplex. Further, prior full duplex with two antenna’s separated
by 40cm show gains, only in 8% of cases.
near-ﬁeld reﬂections change? As expected, this depends on the en-
vironment, for the indoor ofﬁce deployments we used in our exper-
iments we found that we needed to retune once every 100ms on av-
erage (outdoor scenarios would be easier since changes in near ﬁeld
occur less frequently, and we leave mobile hand-held scenarios to
future work). We show this experimentally in Fig. 13, the left plot
shows the amount of cancellation observed as a function of time af-
ter we have found the optimal operating point from a large collection
of different experimental runs in our testbed. We deﬁne the "near
ﬁeld coherence time" of analog cancellation as the time upto which
the receiver remains unsaturated from when it was tuned, which we
also use as the trigger to rerun the tuning algorithm. As we can see
the near ﬁeld coherence time for the cancellation is roughly 100 mil-
liseconds. In other words, we have to retune the analog cancellation
once every 100 milliseconds, which leads to an overhead of less than
1%.
5.3 Does Full Duplex Double Throughput?
This section demonstrates experimentally that our design delivers
close to the theoretically expected doubling of throughput for a full
duplex WiFi link. Note that this is a PHY layer experiment, a full
MAC design for full duplex WiFi is beyond the scope of this paper.
We conduct these experiments as follows. We place the two full
duplex nodes at different locations and send trains of 1000 packets
in full duplex mode, and then similar trains for each direction of the
half duplex mode. Each train uses a particular bitrate (from WiFi)
and we cycle through all the bitrates for each location. We pick the
bitrate with the best overall throughput for full duplex, two antenna
04812162005101520Increase in Noise floor (dB) TX power (dBm) Non Linear CancellationLinear CancellationPrior digital Cancellation18 dB  Improvement  00.20.40.60.811.2050100150CDF Time in milliseconds Coherence time of analog cancellationmedian value = 100 milliseconds median value =  ~1 millisecond median value =  40 milliseconds Time in milliseconds Near Field Coherence Time  00.20.40.60.810100200300400500600700CDF Throughput in Mbps FD SystemHD SystemTwo Antenna FD 20 cmTwo Antenna FD 40 cm1.87x 385full duplex and half duplex respectively. We repeat this experiment
for different locations. We found the SNRs of the links varied uni-
formly between 0 − 45dB across locations as we would ﬁnd in a
typical indoor deployment. We plot the CDF of the throughput for
half duplex and full duplex link in Fig. 14. Note that all of these
throughput numbers account for the overhead introduced by the pe-
riodic analog cancellation tuning. As we can see, our full duplex sys-
tem achieves a median throughput gain of 1.87× over the standard
half duplex mode. As we known from the experimental analysis in
Sec. 5.1.2 that there is a small SNR loss due to a small amount of
self interference residue. This SNR loss is the reason that instead of
the theoretical 2×, we see a slightly reduced gain of 1.87×.
How do prior designs perform? We found that in 60% of the sce-
narios, the throughput with prior full duplex techniques was zero.
This is because these designs leave at least 25dB of self-interference
residue that acts as noise and if the link SNR is below 30dB no signal
is decoded (WiFi requires a minimum of 4− 5dB to decode even the
lowest rate packet). As the half-duplex link SNR increases, perfor-
mance improves but is still not sufﬁcient to beat the system through-
put achieved by half duplex. The reason is that even if the link half-
duplex SNR is 35dB, it implies that we only have two 10dB links for
full duplex. The throughput achieved with a single 35dB half duplex
link is still higher than two 10dB links. Consequently the only region
where we could ﬁnd improvements for full duplex over half duplex
with prior techniques was when the link SNR was greater than 40dB.
6. DISCUSSION & CONCLUSION
We believe this paper marks an important step in proving that full
duplex is not only possible, but feasible and practical. Further, it
can be deployed with no overhead in terms of antennas used and yet
achieve the theoretical doubling of throughput. Below we discuss
the current design’s limitations, potential avenues of future work and
then conclude.
Size of circuit: The current analog cancellation circuit is large, our
prototype board measures 10 × 10 cm. Such a design is ﬁne for APs
and base-stations which is our initial focus, however this design is not
implementable on phones and other portable devices where size is at
a premium. To realize full duplex on such devices, we need to design
an RFIC that is sufﬁciently small (at best 20 − 30sq.mm for current
phones). The key consumers of space on our circuit are delay lines,
which we currently realize via traces on the board. For an RFIC we
expect to use different techniques to realize the same delays, such as
LC ladders and acoustic technologies such as SAW and BAW [12].
These techniques operate by slowing the speed of light, and thus true
time delays are obtained in very short form factors. However the
above discussion is speculative and is part of our future work.
LTE: Our current prototype targets WiFi frequencies in the 2.4GHz
band. However our prototype can also be used for the 2.3GHz and
2.5GHz LTE bands found in Asia and Europe. However the general
design of our system is frequency independent, the dependence in
our prototype comes from the fact that several analog components in
our cancellation board work only in speciﬁc frequency ranges (our
tunable attenuators operate only between 2-2.6GHz). However, the
same design can be used for different frequencies with correspond-
ing components that work in those frequency ranges. Further, unlike
WiFi, LTE uses smaller channels, the widest channel is 20MHz and
this makes the cancellation problem somewhat simpler. Hence we
believe our current design can be adapted to work with LTE, and this
remains future work.
MIMO: The current design targets SISO scenarios. For MIMO we
could use the same design, but a key challenge is that the cross-talk
between different antennas also has to be canceled in analog. Hence,
an analog cancellation circuit has to be designed that models not just
the distortions through a circulator and a single antenna, but also the
distortions that happen when signals travel across antennas. Design-
ing an efﬁcient space-compact circuit for this problem is part of our
current research focus.
Finally, we would like to comment that full duplex radio design
is a problem that spans three different research areas: RF circuit &
system design, digital signal processing and networking. The prob-
lem cannot be solved in any one domain alone, the solution in our
opinion requires understanding trade-offs across all these domains
and architecting it appropriately. Historically however, these com-
munities have been separate, RF system designers expect baseband
IQ samples as the interface and view their job as sending and receiv-
ing signals in RF from these baseband IQ samples. DSP designers
view their job as converting between bits and IQ samples efﬁciently
in the presence of noise. Finally, networking researchers transact in
bits and packets and design medium access while abstracting out the
underlying details. Realizing and taking advantage of full duplex
requires research that spans across these domains, and this work rep-
resents a step in that direction.
Acknowledgments: We would like to thank all the Stanford Net-
work and System Group members and the anonymous SIGCOMM
reviewers for their insightful comments.
7. REFERENCES
[1] D. W. Bliss, P. A. Parker, and A. R. Margetts. Simultaneous transmission and
reception for improved wireless network performance. In Proceeings of the 2007
IEEE Workshop on Statistical Signal Processing, 2007.
[2] S. Boyd and L. Vandenberghe. Convex Optimization. Cambridge University Press,
New York, NY, USA, 2004.
[3] J. I. Choi, M. Jain, K. Srinivasan, P. Levis, and S. Katti. Achieving single channel,
full duplex wireless communication. In Proceedings of the sixteenth annual
international conference on Mobile computing and networking, MobiCom ’10,
pages 1–12, New York, NY, USA, 2010. ACM.
[4] L. Ding. Digital predistortion of power ampliﬁers for wireless applications. 2004.
[5] M. Duarte, C. Dick, and A. Sabharwal. Experiment-driven characterization of
full-duplex wireless systems. CoRR, abs/1107.1276, 2011.
[6] M. Duarte and A. Sabharwal. Full-duplex wireless communications using
off-the-shelf radios: Feasibility and ﬁrst results. In Forty-Fourth Asilomar
Conference on Signals, Systems, and Components, 2010.
[7] E. Everett, M. Duarte, C. Dick, and A. Sabharwal. Empowering full-duplex
wireless communication by exploiting directional diversity. In Signals, Systems
and Computers (ASILOMAR), 2011 Conference Record of the Forty Fifth
Asilomar Conference on, pages 2002 –2006, nov. 2011.
[8] A. Goldsmith. Wireless Communications. Cambridge University Press, New York,
NY, USA, 2005.
[9] S. Gollakota, H. Hassanieh, B. Ransford, D. Katabi, and K. Fu. They can hear
your heartbeats: non-invasive security for implantable medical devices.
SIGCOMM Comput. Commun. Rev., 41(4), Aug. 2011.
[10] S. S. Hong, J. Mehlman, and S. Katti. Picasso: ﬂexible rf and spectrum slicing. In
Proceedings of the ACM SIGCOMM 2012 conference on Applications,
technologies, architectures, and protocols for computer communication,
SIGCOMM ’12, pages 37–48, New York, NY, USA, 2012. ACM.
[11] M. Jain, J. I. Choi, T. Kim, D. Bharadia, S. Seth, K. Srinivasan, P. Levis, S. Katti,
and P. Sinha. Practical, real-time, full duplex wireless. MobiCom ’11, pages
301–312, New York, NY, USA, 2011. ACM.
[12] T. Lee. The Design of CMOS Radio-Frequency Integrated Circuits. Cambridge
University Press, 2004.
[13] A. V. Oppenheim, R. W. Schafer, and J. R. Buck. Discrete-time signal processing
(2nd ed.). Prentice-Hall, Inc., Upper Saddle River, NJ, USA, 1999.
[14] B. Radunovic, D. Gunawardena, P. Key, A. Proutiere, N. Singh, V. Balan, and
G. Dejean. Rethinking indoor wireless mesh design: Low power, low frequency,
full-duplex. In Wireless Mesh Networks (WIMESH 2010), 2010 Fifth IEEE
Workshop on, pages 1 –6, 2010.
[15] Rohde & Schwarz. Rohde & Schwarz FSW Signal and Spectrum Analyzer User
Manual, 2012.
[16] Rohde & Schwarz. Rohde & Schwarz SMBV 100A Signal Generator User
Manual, 2012.
[17] PE 47303 Data-sheet.
http://www.psemi.com/pdf/datasheets/pe43703ds.pdf.
[18] Power Ampliﬁer Data-sheet.
http://www.minicircuits.com/pdfs/ZHL-30W-262+.pdf.
[19] US Patent 5444864. http://www.google.com/patents/US5444864.
[20] US Patent 6539204. http://www.google.com/patents/US6539204.
[21] J. Bardwell. Tech Report. http://www.connect802.com/download/
techpubs/2005/commercial_radios_E0523-15.pdf.
386