# ATMZombie: 以色列银行木马

#### 译文声明
本文为翻译文章，原文来源于360安全播报。译文仅供参考，具体内容及含义以原文为准。

2015年11月，卡巴斯基实验室的研究人员发现了一种名为ATMZombie的银行木马，这是以色列有史以来首个针对银行系统的恶意软件。该木马采用了一种称为“代理更换”（proxy-changer）的技术，通过修改浏览器的代理配置，作为中间人拦截客户端与服务器之间的流量。尽管这种技术早在2005年就被巴西网络犯罪分子用于窃取银行凭证，但直到2012年，卡巴斯基研究人员才对此类攻击进行了详细分析。

此次以色列银行攻击的独特之处在于，它不仅利用了电汇或交易凭证的漏洞，还利用了银行在线功能的一个特定漏洞，从而能够从自动取款机（ATM）中提取现金。这一过程通常涉及没有直接参与攻击的钱骡（即被诱骗帮助转移资金的人），因此该木马得名ATMZombie。

### 攻击手法
攻击者似乎在多种银行恶意软件活动中非常活跃，他注册了多个域名，包括Corebot、Pkybot和AndroidLocker等，并且还运营了一些非法在线服务，如恶意软件加密和信用卡信息转售。值得注意的是，虽然Retefe银行木马（由Palo Alto Networks于2012年8月发现）与ATMZombie有一些相似之处，但后者缺少Smoke Loader后门组件。此外，IBM Trusteer也确认了另一个类似的银行木马Tsukuba的存在。

### 技术细节
当ATMZombie植入受害者的计算机并开始解包时，它会存储常见浏览器（例如Opera、Firefox）的证书，并修改其配置以便实施中间人攻击。接着，它删除所有非恶意软件生成的代理设置，并更改缓存权限为只读模式。随后，木马使用Base64编码字符串修改注册表项，这些注册表项指向自动配置内容（如CAP文件语法下的流量捕获规则）。同时，它还会将自签名证书安装到根目录下。一旦受害者登录其银行账户，ATMZombie便能窃取其凭据，然后冒用身份进行转账操作。

通过对该恶意程序进行调试分析，我们观察到了运行时产生的虚拟内存分配过程。进一步断点分析揭示了解压缩后的可执行文件结构。检查汇编代码显示，某些关键字符串被嵌入到了数据段中，其中包括一系列对外通信URL的Base64编码字符串以及两个用于浏览器网络配置的PAC文件路径。其中一个URL解码结果为：`http://retsback.com/config/cfg.pac`，这可能是攻击者准备的备用方案，以防主要PAC失效。

### 结论
此恶意软件只是整个攻击链条中的第一步。后续步骤则需要手动登录受害者的银行账户并将资金转移到钱骡的账户上。这一环节至关重要，因为它标志着恶意软件已成功完成了其预定任务。然而，由于许多银行都采用了指纹验证等高级安全措施来保护用户免受此类威胁，所以手动登录过程同样充满了挑战。最终，在受害者察觉并向银行报告之前，攻击者已经通过钱骡的手机号码和个人身份信息（PII）将所盗款项转移出去了。

卡巴斯基实验室为此开发了一种新的防御机制，旨在抵御proxy-changer类型的攻击。更多详情请参阅[这里](https://securelist.com/analysis/publications/57891/pac-the-problem-auto-config/#attachment_63112)。