6000
5000
4000
3000
2000
1000
0
1
Prefixes shifting from SA to non−SA
Prefixes remaining as SA
Prefixes shifting from SA to non−SA
Prefixes remaining as SA
9000
8000
7000
6000
5000
4000
3000
2000
1000
s
e
x
i
f
e
r
P
f
o
r
e
b
m
u
N
5
10
15
20
25
30
Uptime of prefix (Days)
0
1
2
3
4
6
5
9
Uptime of prefix(Hours)
7
8
10
11
12
(a) March, 2002
(b) March 15, 2002
Figure 7: The number of preﬁxes which shift from SA preﬁx to non-SA preﬁx or remain as SA preﬁx for AS1
during the measuring time.
those 3 ASs. We ﬁnd that preﬁx aggregating cannot be the
main cause of SA preﬁxes.
Case 3: Selective announcing. Here, we focus on how
origin ASs export preﬁxes to their direct providers. We only
show the result for AS1 since we observe about 32% of SA
preﬁxes in its routing table.
Note that some origin ASs are single-homed ASs. They
must announce their preﬁxes to direct providers. For exam-
ple, in Fig. 8(b), AS v announces its preﬁxes to its direct
provider u1. AS u1 is the last common AS of the best path
u0u2u1v and the customer path u0u3u1v except the source
and destination ASs. Therefore, it may be due to export
policies of AS u1 or ASs before it, such as AS u3. In the
single-homed case, we investigate how the last common AS
exports preﬁxes of itself and preﬁxes learned from its cus-
tomers to its direct providers.
For each SA preﬁx in AS1, we search all paths in BGP
table to investigate how the customer (the originating AS
or the last common AS) connects with the direct provider
in the path.
If the provider is left to the customer, the
customer exports the preﬁx associated with the path to the
provider. If between the provider and the customer, there
is a upstream provider of the provider, then the customer
does not export this preﬁx to the provider. For example,
in Fig. 8(a), if we ﬁnd the path u3v, v exports its preﬁxes
to u3. If we ﬁnd the path u3u0u2u1v, v does not export its
preﬁxes to u3.
This method depends on the number of peers in Oregon
RouteView. Thus some of SA preﬁxes cannot be identiﬁed.
In AS1, about 90% of SA preﬁxes can be identiﬁed by us-
ing this method. Among those identiﬁed preﬁxes, we ﬁnd
that about 21% of customers announce their preﬁxes to the
direct provider, and about 79% of customers do not export
preﬁxes to the provider. That is, in order to control their
incoming traﬃc, some customers announce their preﬁxes or
their customers’ preﬁxes to only a subset of direct providers.
Multihomed ASs can use BGP conditional advertisement, in
which some preﬁxes are advertised to one of the providers
only if information from the other provider is missing [18].
This feature can be used to provide administrative control
over traﬃc ﬂow.
BGP community tagged with routes can explain the case
  u2
u1
u0
u3
v
Provider−to−customer
Peer−to−peer
  u2
u0
u3
u1
v
Provider−to−customer
Peer−to−peer
(a) Multihomed AS
(b) Single-homed AS
Figure 8: Examples of multihomed and single-homed ASs.
that customers can export SA preﬁxes to direct providers.
One of the important usages of BGP community attributes
is for traﬃc engineering. The well-known NO EXPORT and
NO ADVERTISE communities are employed to control pre-
ﬁx announcement [19]. Besides these values, there are some
communities that are often used to indicate that receivers
do not announce routes to a speciﬁed AS. A large number
of ASs support this kind of community, and a lot of com-
munities related to this utilization can be found in BGP
tables [20]. Therefore, it is possible that direct providers
or their upstream providers do not announce the customers’
routes because of those communities.
From these 3 cases, we ﬁnd that the major cause for SA
preﬁxes is due to selective announcing. This implies that
selective announcement policies employed by customers can
aﬀect the paths through which the top providers receive
their preﬁxes. Providers may receive its customers’ preﬁxes
from their peers. However, if those peers do not announce
these preﬁxes, providers cannot access customers. Afek et
al. [21] studied policy atoms which are groups of preﬁxes
with a common AS path at any Internet backbone router.
[21] shows that most policy atoms are created by origin ASs’
routing policies. Our work can answer the questions as to
what kind of routing policies create policy atoms in [21].
Policies for exporting to providers are the major cause for
SA preﬁxes. However, some special cases can also give rise
to SA preﬁxes. For instance, an AS has several networks
at diﬀerent areas, but this AS does not have backbone to
connect its networks. The AS will connect to the nearest
providers for each network. For example, AOL (AS1668)
belongs to this case. We will study other cases which may
aﬀect our result in the future work.
5.2 Export to Peer
It is more complicated to infer what strategy peers use
to export their preﬁxes to other peers, since a pair of peers
can deﬁne ﬂexible export policies to balance their inbound
traﬃc. Here we focus on how a peer exports its preﬁxes to
other peers.
From Oregon’s BGP table in Nov. 18, 2002, we investigate
how peers of AS1, AS3549, and AS7018 export their own
preﬁxes to those 3 ASs. Table 10 shows the ﬁnal results
for those 3 ASs. For AS1, there are only 6 peers which
do not export all of their preﬁxes directly to it. Among
them, 4 peers export most of their preﬁxes directly to AS1.
This may be due to load balancing among peer links. For
Table 10: Percentage of peers which announce their
preﬁxes to AS1, AS3549, and AS7018, respectively
AS number # of peers % of peers announcing
AS1
AS3549
AS7018
43
41
35
their preﬁxes
86%
100%
89%
AS3549, all of its peers export their preﬁxes to AS3549.
For AS7018, only 4 peers do not export their preﬁxes to
it. From Table 10, we observe that most peers export their
own preﬁxes directly to those 3 ASs. That is, peers tend to
announce their preﬁxes to other peers directly.
6. CONCLUSION
In this paper, we demonstrate how to infer the routing
policies and characterize the routing policies. We ﬁrst infer
the import policy. We ﬁnd that for most ASs routing pref-
erence conforms to AS relationships. Routes learned from
customers are typically preferred over those from providers
and peers, and routes received from peers are typically pre-
ferred over those from providers. Moreover, route preference
assignment is based on next hop ASs. Second, we present
an algorithm for inferring export policies, and characterize
export policies. Customers can export their preﬁxes to a
selected subset of providers. For 3 Tier-1 ASs, we ﬁnd a
large number of preﬁxes are exported to a selected subset of
providers. We ﬁnd that preﬁx splitting and aggregation of
preﬁx are not the main reason for the selective announce-
ment. From our study, customers announce their preﬁxes
to a subset of providers because of load balancing. Further-
more, most peers tend to export their preﬁxes to other peers
directly.
Acknowledgments
The authors would like to thank Jennifer Rexford for many
helpful discussions and comments on the paper, and for pro-
viding the AT&T routing data. We would also like to thank
anonymous reviewers for many valuable comments. This
work was supported in part by NSF grant ANI-0208116,
ANI-0085848, and the Alfred P. Sloan fellowship.
7. REFERENCES
[1] Rekhter, Y., and T., Li. Border Gateway Protocol 4
(BGP-4), RFC 1771, T.J. Watson Research Center,
IBM Corp., Cisco Systems, March 1995.
[2] Hongsuda Tangmunarunkit, Ramesh Govindan, Sugih
Jamin, Scott Shenker and Walter Willinger. Network
Topology Generators: Degree based vs. Structural,
ACM SIGCOMM 2002.
[3] Ramesh Govindan, and Hongsuda Tangmunarunkit.
Heuristics for Internet Map Discovery, IEEE
INFOCOM 2000.
[4] Michalis Faloutsos, Petros Faloutsos, and Christos
Faloutsos. On Power-Law Relationships of the
Internet Topology. In ACM SIGCOMM, Cambridge,
MA, September 1999.
[5] Paul Barford, Azer Bestavros, John Byers, and Mark
Crovella. On the Marginal Utility of Network Topology
Measurements. In Proc. of the SIGCOMM Internet
Measurement Workshop (IMW’01), November 2001.
[6] Ratul Mahajan, David Wetherall and Tom Anderson
Understanding BGP Misconﬁguration, ACM
SIGCOMM, Aug 2002.
[7] Philip Smith. BGP for Internet Service Providers,
NANOG 25, Toronto, Canada.
[8] Lakshminarayanan Subramanian, Sharad Agarwal,
Jennifer Rexford, and Randy H. Katz. Characterizing
the Internet hierarchy from multiple vantage points, in
Proc. IEEE INFOCOM, June 2002.
[9] Meirt Network. Internet routing registry,
http://www.irr.net.
[10] Merit Network. Internet routing registry mirror site,
ftp://ftp.radb.net/routing.arbiter/radb/dbase/.
[11] B.Halabi. Internet Routing Architectures (2nd
Edition), Cisco Press, August 2000.
[12] Lixin Gao. On inferring autonomous system
relationships in the Internet, ACM IEEE Transation
on Networing, Dec, 2001.
[13] G. Di Battista, M. Patrignani, and M. Pizzonia,
Computing the Types of the Relationships between
Autonomous Systems, Technical Report
RT-DIA-73-2002, Dipartimento di Informatica e
Automazione, University Roma Tre, Rome, 2002.
[14] E. Chen, T. Bates. An Application of the BGP
Community Attribute in Multi-home Routing. MCI,
cisco Systems, August 1996.
[15] G. Huston. Interconnection, peering, and settlements.
In Proc. INET, June 1999.
[16] http://www.antc.uoregon.edu/route-views/.
[17] http://www.traceroute.org
[18] Conﬁguring and Verifying the BGP Conditional
Advertisement Feature.
http://www.cisco.com/warp/public/459/cond adv.html.
[19] P. Traina, R. Chandrasekeran, and T. Li. BGP
communities Attribute. Internet Engineering Task
Force, RFC1997, August 1996.
[20] Bruno Quoitin, and Olivier Bonaventure. A survey of
the utilization of the BGP community attribute,
draft-quoitin-bgp-comm-survey-00.txt. February 2002.
[21] Yehuda Afek, Omer Ben-Shalom and Anat
Bremler-Bar. On the Structure and Application of
BGP Policy Atoms. IMW 2002.
APPENDIX
[20] shows that BGP community is widely used, and de-
scribes the most common usages of the BGP community
attributes in the global Internet. Besides the well-known
community values, one of the most common utilizations of
community values is to tag the routes received from speciﬁc
neighbor ASs. In this case, an AS deﬁnes community val-
ues for its customers, peers, and transit providers. When
border routers of the AS receive a route from its neighbors,
they tag the route with a community indicating the rela-
tionship with those neighboring ASs. Other routers within
the AS can make their routing decisions on the community.
For example, in RIPE whois database, AS12859 deﬁnes the
community values, shown in Table 11, to tag routes received
from its customers, peers, and providers.
Table 11: An example of tagging communities pub-
lished by AS12859
12859:1000 Route received from AMS-IX peer
12859:1010 Route received from OpenPeering (AMS-IX)
12859:1020 Route received from private peers at Telecity 2
12859:2000 Route received from transit link at SARA
12859:2010 Route received from transit link in Ede
12859:2020 Route received from transit link at Telecity 2
12859:4000 Route received from customer
Note that one type of relationships can be indicated by a
unique community value, such as AS12859 using “12859:4000”
to indicate all of its customers. It can also be indicated by
diﬀerent community values. For example, AS12859 uses 3
diﬀerent community values to indicate its peers, and other 3
values to indicate its providers. Therefore, diﬀerent ranges
of community values, which do not overlap, can indicate each
type of relationships. We call two community values as the
“same” if they belong to the same range of values. For exam-
ple, “12859:1010” and “12859:1020” are the “same” values
because they belong to the range of community values for
peers which is between “12859:1000” and “12859:2000”.
Given an AS, we can verify AS relationships between the
AS and its neighboring ASs by following steps:
Step 1: querying community associated with next
hop ASs. We ﬁrst select some preﬁxes announced by each
next-hop AS. Then we send “show ip bgp IP address” Cisco
IOS command to query communities tagged with those pre-
ﬁxes. For example, in AS12859, the query result shows as
follow:
> show ip bgp 80.96.180.0
BGP routing table entry for 80.96.180.0/24
Paths: (1 available, best #1)
8220 12878 5606 15471
193.148.15.101 from 213.136.31.5
Origin IGP, metric 5, localpref 210, internal, best
Community: 12859:1000
Step 2: inferring the semantics of community val-
ues. It is easy to infer the semantics of community values
when ASs publish their rules, such as registering them in
IRR database. AS12859, for example, publishes the seman-
tics of community value in IRR, and AS6667 publishes the
semantics of community values on its web page. Here we
s
e
x
i
f
e
r
p
f
o
r
e
b
m
u
N
100000
10000
1000
100
10
1
1
s
e
x
i
f
e
r
p
f
o
r
e
b
m
u
N
1e+06
100000
10000
1000
100
10
1
1
s
e
x
i
f
e
r
p
f
o
r
e
b
m
u
N
100000
10000
1000
100
10
1
1
10
100
100
Rank of AS
10
100
100
Rank of AS
10
Rank of AS
10
(a) AS1
(b) AS3549
(c) AS8736
Figure 9: Number of preﬁxes announced by the next-hop ASs of AS1, AS3549, and AS8736.
focus on how to infer the semantics if ASs do not publish
them. The main idea is that because all ASs with the same
relationship will be tagged with the same type of commu-
nity, we just identify each kind of relationships for only one
pair of ASs. Then all ASs that are tagged with the same
type of community will have the same relationship.
Based on the number of preﬁxes from next hop ASs, We
can infer AS relationships for some special ASs. Suppose an
AS has providers, it will receive full BGP tables, or partial
list of preﬁxes from them. It will also receive preﬁxes an-
nounced by customers. The big gap between the number of
preﬁxes received from a provider and a customer indicates
that one AS that announces the most preﬁxes is a provider.
The AS that announces the lest preﬁxes is a customer. If
the AS does not have providers, then the top one which
announces most preﬁxes must be a peer.
If the AS has
both providers and peers, we can distinguish one provider
by virtue of the largest number of preﬁxes it announces. All
providers should have the same type of community value,
and peers have diﬀerent one from that of providers. A peer
is the one that announces a large number of preﬁxes, and
with a diﬀerent community from providers.
For example, Fig. 9 shows the number of preﬁxes AS1
(GTE), AS3549 (Global Crossing), and AS8736 (Grapes
Network Services) received from their next hop ASs. We
sort those next hop ASs in non-increasing order according
to the number of preﬁxes they announce. Because AS1 and
AS3549 do not have providers, we conclude that the ﬁrst sev-
eral ASs (indicating in a circle in Fig. 9), which are larger
ASs, such as AS701 (UUNET), are peers. And we also can
conclude that the last several next hop ASs, indicating in
a square in Fig. 9, which announce very small number of
preﬁxes, such as 1 or 2 preﬁxes, should be customers.
In
AS8736, one next-hop AS announces more than 100k pre-
ﬁxes to it, and then we conclude that that AS is a provider.
Our conclusion for the semantics of AS3549’s community is
conﬁrmed by this AS.
Step 3: mapping community to AS relationship.
Based on the semantics of community values, we derive AS
relationships between ASs and their next-hop ASs. For the
example above, preﬁx “80.96.180.0/24” is tagged “12859:1000”
community in AS12859. According to Table 11, the relation-
ship between AS8220 and AS12859 is peer-to-peer relation-
ship.