云环境自动化入侵溯源实战
徐越 阿里云安全工程师
WHOAMI
2015
2016
2019
• @cdxy_
• 安全工程师@阿里云
• 企业安全/入侵检测与响应
• 数据分析/机器学习爱好者
响应速度是企业安全能力的核心体现
是否误报？
漏洞？攻击路线？
黑客背景？目的？
影响哪些资产和账号？
泄露哪些数据？
是否存在内部违规操作？
...
告警
安全运营
看看怎么被入侵的
200G
日志
0
日志
看看怎么被入侵的
99%
误报
又来告警了
安全运营现状
安全运营流程中的技术问题
数据缺失
系统孤立
人工检索
[ 自动化入侵回溯 ]
多源异构数据的知识表达
采集
计算
交互
云原生的数据采集方案
满足90%以上事件调查
千万级RPS实时流计算
自动寻找入侵相关信息
图结构可视化
还原入侵链路
可视化
冗余
只展示有用的信息
数十种行为细节
粗糙
离线
分钟级延时
计算流程
将行为抽象成实体，描述入侵细节
黑客IP: x.x.x.x
服务器IP: x.x.x.x
攻击
黑客IP: x.x.x.x
服务器IP: x.x.x.x
漏洞利用
执行恶意指令
写入文件
告警
基于日志的被动关系构建
主动关系推理
断链修复：关联规则挖掘
watchbog
蠕虫回溯案例
JIRA模板注入(CVE-2019-11581)
Solr RCE(CVE-2017-12629)
SSH暴力破解
CouchDB RCE(CVE-2018-8007)
挖矿程序植入方式Top
• SSH/RDP登录后写入
• WebLogic RCE
• Kubernetes API Server未授权访问
• Struts2 RCE
• Hadoop YARN 未授权访问
WEBSHELL植入方式Top
• 表单文件上传
• 老马上传新马
• WordPress插件写入
• SSH/RDP登录后写入
• Discuz插件写入
宏观入侵原因统计
自动化0day捕获
Jenkins RCE (CVE-2019-1003000)
2019-01-30 15:45:22 - 115.236.5.58
WebLogic RCE (CVE-2019-2725)
2019-04-17 18:09:45 - 211.94.162.245
04-17 
01-30 
现阶段问题
数据
复杂网络拓扑/内网
计算
长时间窗口/复杂模型
对抗
Agent被杀或定向绕过
Q&A
cdxy000
cdxy_