platforms such as the Spirent AX/4000 [8].
6The Cisco 6500 series of devices can be conﬁgured either
to run Cisco CatOS, Cisco IOS, or a hybrid of the two.
The choice depends on anticipated traﬃc, customer require-
ments, and modules installed. We conﬁgured our 6509 to
run native IOS, version 12.1(13)E6.
the router. During tests, the 6509 was connected only to
the traﬃc generation machines and to our management net-
work, over which we polled speciﬁc MIB variables via SNMP.
No other traﬃc traversed the router. The system we used to
generate the standard packet traﬃc was a Spirent AX/4000.
The AX/4000 generated traﬃc over two 1 Gbps Ethernet
links and the traﬃc returned to the AX/4000 over another
1 Gbps link. While our tests contrast Harpoon with the
AX/4000, the model of traﬃc generation in the AX/4000 is
representative of many tools that generate packets with con-
stant spacing. We therefore use the term “constant spacing
packet generator” in the discussion and graphs of results.
Our experiments were based on a series of tests described
at www.lightreading.com [41] and on benchmarking ter-
minology and methods described in RFCs 2285 [39] and
2889 [40]. These tests were designed to evaluate packet for-
warding performance of Internet backbone routers under a
variety of conditions, including the use of minimum-sized
packets, and forwarding tables comparable in size to those
found in the Internet backbone. The LightReading tests also
investigated many other performance capabilities of routers,
such as BGP table capacity, packet ﬁltering, and forward-
ing performance under unstable path conditions. Our tests
focused on packet forwarding performance and the impact
of workloads on router subsystems.
Our basic metric for comparison was packet forwarding
rate. As RFC 2285 points out, it is problematic to report
forwarding rates in the absence of packet losses as the ear-
lier RFC 1242 [20] had deﬁned. Obviously, packet loss rates
depend on the oﬀered load and router or switch implementa-
tion artifacts. Our challenge was to determine how to match
oﬀered loads between two fundamentally diﬀerent packet
generation methods. Instead of attempting to compare for-
warding rates across a broad range of oﬀered loads, we chose
two diﬀerent regimes, a “low” load and a “high” load. With
each oﬀered load, we polled the 6509 every 20 seconds using
SNMP to obtain the forwarding rate, packet loss counts and
other system utilization variables available via SNMP on
each interface. SNMP variables are updated internally every
10 seconds in the 6509. Our polling period of 20 seconds was
chosen to minimize additional load placed on the 6509 while
ensuring each SNMP request would obtain updated coun-
ters. The low and high oﬀered load regimes were roughly
tuned to 60% (≈ 600Mbps) of egress bandwidth and 90% (≈
900Mbps) of egress bandwidth, respectively7. For Harpoon,
we used the PF ileSize and PInterConnection distributions ex-
tracted from the Wisconsin data and used the algorithm of
Figure 4 to determine how many session threads should be
active to generate the intended load levels on the 6509. We
then calculated the average oﬀered load from SNMP mea-
surements of the ingress interfaces and used this average to
conﬁgure the packet-level generator. Because of this tun-
ing approach, including other application-level generators
in this evaluation would have required imprecise trial-and-
error tests to tune them to the same level. Thus, we chose
only to compare Harpoon with the constant load generator.
For all tests described in this section, Harpoon was initial-
ized with the same random number generator seed to ensure
identical sequences in input distributions.
7With a deterministic packet generation tool
like the
AX/4000, tuning the oﬀered load is straightforward. With
Harpoon, the load is tuned by adjusting the number of client
and server threads.
(a) Average packet sizes for one hour seg-
ment of Auckland data and equivalent Har-
poon trace. For the Auckland data, the
overall sample mean and standard deviation
are 610 and 629, respectively. For Harpoon,
the overall sample mean and standard devi-
ation are 1106 and 615, respectively.
(b) Time series of bytes transferred for
a 300 second segment of Auckland trace
and for Harpoon (no RTT conﬁgured in
testbed).
(c) Log-scale diagrams for one hour seg-
ment of Auckland data set (12pm-1pm, 11
June 2001) and Harpoon with two diﬀerent
IntervalDuration (ID) values and two dif-
ferent round-trip times.
Figure 11: Limitations of Harpoon related to packet volumes generated, and to matching original volumes
over a range of time scales.
We compared forwarding rates in a series of tests run for
10 minutes each using the two diﬀerent oﬀered loads while
separately changing traﬃc source burstiness, traﬃc source
packet size, and forwarding table size. Note that changes in
traﬃc source burstiness and packet size are only applicable
to the constant spacing generator; Harpoon (intentionally)
does not dictate these parameters8. Packet-level burstiness
in Harpoon arises from the distributional parameters con-
ﬁgured in Harpoon and the closed-loop dynamics of TCP.
For the constant spacing generator, we used burst sizes
of 1 (uniformly spaced packets), 232, 465, 697, and 930.
The burst size is deﬁned by RFC 2285 [39] as a sequence
of frames emitted with the minimum legal inter-frame gap,
and a maximum recommended burst size is given as 930.
The range of burst sizes we used covers 1
4 of the
maximum burst size.
2 , and 3
4 , 1
The packet sizes (number of bytes excluding link-layer
framing) used in the constant spacing generator were 40,
1500, and a trimodal distribution conﬁgured so that 61% of
the generated packets were 40 bytes, 17% were 576 bytes,
and 22% were 1500 bytes. The empirical basis for this mix
of packet sizes roughly approximates the values used in the
LightReading tests, and comes from measurements taken
at Merit Networks Inc. between 28 August, 2000 and 13
September, 2000 [33].
The sizes of forwarding tables used were 32, 1,024, 32,768,
or 65,536 entries. The two traﬃc sources (two server work-
stations in Harpoon conﬁguration, two separate GE cards
in the AX/4000) were each conﬁgured with a single IP ad-
dress. The traﬃc sink (one client workstation in Harpoon,
a single GE card in the AX/4000) was conﬁgured to use
an entire IPv4 class B address range (216 addresses). With
the AX/4000, this is simply a parameter in conﬁguring the
generated packets. With Harpoon, we created 216 interface
aliases. This address space was reached by installing static
routes on the traﬃc source workstations and the forwarding
tables on the 6509. We aliased the loopback adapter rather
than the physical Ethernet adapter to avoid ARP overhead
8It is possible to change the MTU at each interface (physi-
cal or alias) used by Harpoon, indirectly allowing Harpoon
to generate diﬀerent packet sizes. We did not modify the
default Ethernet MTU of 1500 bytes on the FreeBSD hosts
running Harpoon.
between the client host and the 6509, and to force a desti-
nation address lookup in the forwarding tables of the 6509.
6.2 Results
We begin by showing a qualitative comparison of the time
series of bit forwarding rates for Harpoon and the constant
spacing generator shown in Figure 12(a). In this test, Har-
poon was conﬁgured to generate roughly 600Mbps of traﬃc
over a 30 minute test period. The constant spacing genera-
tor was conﬁgured to match the average oﬀered load of Har-
poon and emitted 1500 byte packets with uniform spacing.
Harpoon maintains a high level of oﬀered load in the pres-
ence of variable ﬁle sizes transferred and inter-connection
times while still generating burstiness in packet traﬃc. As
expected, the constant spacing generator presents a virtu-
ally unwavering load to the router. In further tests, we ex-
plore how these fundamental diﬀerences in packet emission
processes aﬀect the performance of the router.
We examine the eﬀects of burst sizes of 1, 465, 697, and
930 on forwarding rate in the results shown in Figure 12(b).
The vertical bars on each data point indicate the range of
one standard deviation above and below the average. The
router was conﬁgured with a forwarding table size of 215
and the high regime of oﬀered load was used for these tests.
Harpoon results for a forwarding table size of 215 and high
oﬀered load are shown for comparison. The drop in bit for-
warding rate for the constant spacing generator at a burst
size of 697 accompanies a corresponding increase in the num-
ber of packets dropped at the egress line card of the router.
The drop in forwarding rate between a burst size of 465 and
a burst size of 930 is roughly 180 Mbps. This increase in
stress placed on the router does not come with an increase
in forwarding rate variability, as noted by the low variation
in the height of vertical bars drawn for the constant spacing
generator tests.
Figure 12(c) shows the eﬀects of diﬀerent packet sizes on
forwarding performance. The constant spacing generator
was conﬁgured to emit packet sizes of 40, 1500, and a tri-
modal distribution as described above. As with the burst
tests above, the router was conﬁgured with a forwarding
table size of 215 and the high regime of oﬀered load was
used for these tests. Harpoon results for a forwarding table
size of 215 and high oﬀered load are plotted for comparison.
 200 400 600 800 1000 1200 1400 0 500 1000 1500 2000 2500 3000 3500average packet size (bytes) over 60 sec intervalstime (seconds)Auckland - Mean Packet SizeHarpoon - Mean Packet Size2M1.5M1M0.5M0 0 20 40 60 80 100 120 140 160 180bytes transferred per 1 second interval (millions)time (seconds)Measured DataHarpoon 18 20 22 24 26 28 30 2 4 6 8 10 12 14 16 1865.53616.3844.0961.0240.2560.0640.0160.0040.001log2(energy)scalefinecoarseMeasured DataHarpoon - 60 sec ID - 0 msec RTTHarpoon 300 sec ID - 0 msec RTTHarpoon - 60 sec ID - 200 msec RTTHarpoon - 300 sec ID - 200 msec RTTWith minimum sized IPv4 packets, the forwarding rate of
the test router under the same oﬀered load drops by roughly
140Mbps while exhibiting very low variability. Packet loss
was measured for the 40 byte case, but there was no packet
loss measured for the 1500 byte or trimodal case.
Figure 13 shows the aﬀect of diﬀerent forwarding table
sizes on forwarding rates. The results from the low oﬀered
load test are shown in Figure 13(a) and results from high
oﬀered load test are shown in Figure 13(b). The obvious
features in the ﬁgures are the near-perfect matching of aver-
age bit forwarding rates between Harpoon and the constant
packet spacing generator at low loads, and the poor match
for the test using a high oﬀered load. Recall that the oﬀered
load used in the constant packet spacing tool was conﬁgured
using the average oﬀered load generated by Harpoon. For
the high load test shown in Figure 13(b), the diﬀerence in
forwarding rate comes as a direct result of packet loss that
occurred during the Harpoon tests, but not during the tests
using the constant spacing generator. Though the same av-
erage load is oﬀered to the router by each traﬃc generator,
the forwarding rate is clearly lower for the Harpoon test.
Another important feature of these graphs is the trend in
variance for the Harpoon tests. As the forwarding table size
increases, so does the variance in bit forwarding rate. For
the constant packet spacing generator, variance remains very
low for all tests. Since Harpoon was conﬁgured so that each
test used the same sequence of input parameters, we con-
clude that the burstiness in the traﬃc presented by Harpoon
results in distinctly diﬀerent and potentially highly variable
forwarding performance at the router.
Figure 14(a) shows time series of packet loss for selected
tests described above. All tests shown used a 215-entry for-
warding table at the router and high oﬀered load. It is clear
from Figure 14(a) that even when the constant spacing gen-
erator emits bursts of packets, the loss rate measured at
the router remains basically constant. The same is true for
the constant spacing generator test with 40 byte packets.
This observation is not surprising considering the packet-
level generator operates in an open-loop, making no adjust-
ment in oﬀered load in response to packet loss. Because
of the closed-loop nature of TCP, Harpoon is likely to gen-
erate some packet loss with almost any conﬁgured oﬀered
load, and it is likely that these losses will be correlated and
bursty [51]. Finally, we note that all packet losses measured
during our tests occurred as output buﬀer drops on the line
card connected to the Harpoon client machine or the module
on the packet-level generator acting as the data sink.
The eﬀect of four test conﬁgurations on switch fabric uti-
lization is shown in Figure 14(b)9. Surprisingly, the results
for the constant spacing generator using uniformly spaced
1500 byte packets exhibits a wider range of fabric utilization
levels than for the same generator using uniformly spaced 40
byte packets. The ﬂuctuation in utilization measured dur-
ing the 1500 byte test is likely due to limited precision of
the utilization calculation internal to the 6509 (it is simply
an integer). The highest level of switch fabric utilization
is measured during the constant packet spacing generator
test using 40 byte packets. It is interesting to note that de-
9Switch fabric utilization on the 6509 is reported for both
input and output channels to each module installed in the
chassis. We show results for the output channel on the mod-
ule where traﬃc is multiplexed on the path to the Harpoon
client machine or packet-level generator data sink module.
spite sending much larger packets on average and despite a
much lower packet loss rate (see Figure 14(a)), utilization
during the Harpoon test comes within two percent of the
highest measured fabric utilization. Fabric utilization dur-
ing the Harpoon test also exhibits much greater variability
than any of the constant spacing generator tests.
While not shown here, we ran experiments using the con-
stant spacing generator and a limited cross-product of pa-
rameters explored above (burst size, packet size, forwarding
table size, and oﬀered load). As one might expect, loss rates
when sending 40 byte packets in bursts are greater than
when sending uniformly spaced 40 byte packets. The key
observation from all these tests is that variability in bit for-
warding rate, loss rate, and switch fabric utilization remains
very low for the constant spacing generator.