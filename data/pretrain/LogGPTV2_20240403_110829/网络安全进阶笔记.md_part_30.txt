xqstr-
=Request.ServerVarlables(*QUERY_STRING*)
If xgstr..
>
xredir
*.4xgstr
Response.redirect xredir.
End If
t>
相反地，若要强迫以htp开始，则可添加如下代码：
对这些代码使用得越熟练，用户就越难以感觉出来。
4.移花接木改写URL
在QQ或者是其他即时聊天工具上，经常有人给我们发送这样一些URL，大概的形式如下：
http：//www，xxx，com8xxxooxxxx（9后面i的都是由数字构成）
http1//w.xxx, com/out1ink/http: //www.xxx.com
其特征是中间的连接比较复杂，然后有提示说可以抽奖或者是什么好玩的内容。其实，仔
细分析一下，这些地址可能是一个圈套。第一个地址后面的数字看似没什么，可是要是换成16
进制计算的话，那就是一个IP地址。还有一种可能，就是使用了网站的搜索功能。如果不小
心点了这些陌生人发来的东西，可能就连接到一个国外的网址，或者是一个病毒网站。
小知识：在HTTP规范中，网络协议名称之后的完整格式为htpc/IP：@name:pass/，其中只有第
一部分IP是必需的，“”后面是用户名参数，“：后面是密码，这使服务器可以
解析带有更多信息的完整字符串，我们最常见的通过浏览器登录FTP服务器时的URL
格式（如ftpr//PI:EMAIL:por）就是这样一种情况，如果用户名和密码包含在
URL中，真正的主机地址是从“”字符之后开始，这就可以产生欺骗
表3.1是本书撰写过程中的一些案例地址，通过这些传唤地址和实际地址的对比，我们可
以发现一些规律。
表3.1连接地址对比分析表
被伪造网站
传唤地址
实际地址
美国在线
http:/lsearch.aol.com/aolcom/redir?src=web
search&requestld=e244a572381a910e&click
edtemRank=3&userQuery=pictures&clicked
http://akfhdkfadsdfa.info/signin
ItemURN=htp:/akfhdkfadsdfa.info/signin
Amazon.com
http://www.amazon-department.com/exec/
obidos/flex-sign-in/ref-ya_hp_pi_5/-click
htp/68.142.234.35
settings/104-0220521-9331958
MSN.com
http://www.msnasstance.com/index.php
htp:/68.142.234.41
Washington
https/login.personal.wam.com/verifiation.
_Mutual Bank
asp?d=1
htp/200.101.59.26/webmail/w/index.html
Ebay.com
htp//67.18.151.194/haibace/cgi-bin/ebay
update-accout-details-info-cba-update-
http://cgi1.ebay.com/aw-cgi/ebayISAPI.dll?
uosse-epdn-fieqa-o-seap-unooe
UPdate
details-info-ebay-update-account-details-info-
chay-update-account-details-info-ebay-update-
ount-details-info/cBay/signin.html
131
---
## Page 141
网络安全进阶笔记
，
续表
被伪造网站
传唤地址
实际地址
KeyBank
https://accounts2.keybank.com/ib2/Controller
http/key.accountaxservices.com/ib2/
?requester=signon
SecureReauthController1.php
Sovereign
https:/www.site-secure.com/cgi-bin/cgig2.
Bank
cse/sovbank/SID/GetLogon
http://68.118.88.16/sovbank
VISA
http://usa.consumers.datasecurities.net/vsx-
cgi/vsapps/personal/vsactivation-
http://datasecurities.net
PayPal
htps/www.paypal.com/cgi-bin/webscr?cmd
login-run
http:/212.45.13.185/.paypal/index.php
从上面的对比可以看出，在大部分网络用户的概念里，网址就是URL（统一资源定位器，
以下简称资源定位）的中文翻译和代名词，确切地说，这也并不是错误的说法。
尤其是ASP（活动服务网页）的普遍采用，更模糊了网络地址与资源定位概念上的细微差别。
例如htp:/www.test.com是一个标准的传统意义上的网址，它直指一个页面或IP地址。但如果
是下面的地址可就要注意了：
例1http://www.microsoft.comsitem=q2093548www.test.net/pub/mskb/Q209354.asp
例2http:/PI:EMAIL/search?hi=zh-CN&ienUTP-86oe
=UrP-8sq=asp&Ir=
例1中，真正的主机是www.test.net，而www.microsoft.com在这个URL中不过是个假用
户名，服务器会忽略它。例z中，www.microsolcom将被视为Google服务器上的一个用户名
（当然，它是不存在的），实际指向后面的页面。如果这个地址是具有攻击性或感染了病毒的网
页，后果可想面知，这些URL在网络标准中都是“合法”的，它们伪装成可信任的站点，如
果有恶意行为，很难立即发现。遇到这种情况，不妨看看“@”的解释，就知道是否有问题存
在了，此外，在钓鱼式攻击者制作的网页中，还存在如下的地址欺骗。
（1）十进制格式的IP款骗。像上面例子那样的带有欺骗性的URL，是利用了我们对熟悉
的URL格式的信任，利用了用户从URL的顶级域名来判断可信度的习惯，还有另外一种欺骗
则反其道而行，用一串不知所云的数字麻痹用户.例如IP地址202.106.185.75，将这个IP地
址换算成十进制后就是3395991883，Ping这个数字后，我们会发现，居然可以Ping通，这就
是十进制IP地址的解析，它们是等价的，如图3.8所示。
（2）迷惑的虚拟域名。虚拟域名曾一度是无域名网站的最爱，但有些虚拟域名系统支持句
点分隔符，结合上述十进制IP地址，就可以通过如下的URL来制造更大的迷惑：
http://www.test.com@3633633987/
这个网址就达到了以假乱真的地步，它实际指向Redhat网站，怎么，你还以为是
www.test.com吗？因为很多的网站都把HTTP的SessionID放在URL中，来代替Cookie使用，
，
（3）名不符实的链接文字。我们知道，链接文字本身并不要求与实际网址相同，那么你可
不能只看链接的文字，面应该多注意一下测览器状态栏的实际网址了，如果该网页屏蔽了在状
132
---
## Page 142
第3章享受安全的网络办公环境
态栏提示的实际网址，你还可以在链接上右击，查看链接的“属性”。
ttedtettirpr'dtniniatrwtor?
图3.8十进制格式的IP撤骗
（4）间接寻址。利用可信站点进行网址欺骗的方法就是“间接寻址”。很多网站通过如下
格式的链接来引导访间者http://wWW.AAA.com/outsidelinks/htp://www.BBB.com，在服务器端
捕获请求信息后，再把用户重新定位到目标网站上。这使任何人都能使用这种间接寻址服务。
（5）Unicode编码。Unicode编码有安全性的漏润，这种编码本身也给识别网址带来了不
便，“%20%30”这样的天书除了浏览器认识，恐怕没有人能看出它真正的内容。除了Unicode
编码外，以上提到的几种欺骗手段都是可以察觉的，再发现可疑网址时，用户就可以用学到的
这些知识先“过滤”一番了。
5.表单伪造分析
学习表单知识之前，我们先看看Web技术原理。
户接收机及通讯协议三个部分，服务器结构中规定了服务器的传输设定、信息传输格
式及服务器本身的基本开放结构，客户机系统称为Web浏览器，用于向服务器发送
资源索取请求，并将接收到的信息进行解码和显示，Web测览器与服务器之间遵循
HTTP协议进行通讯传输，Web服务器通过Web浏览器与用户交五操作，相五来用
HTTP协议相互通信（服务器和客户端都必频安票HTTP协议）.Web服务器和Web浏
览器之间通过HTTP协议相互响应，一般情况下，Web服务器在80端口等候Web浏
览器的请求，Web浏览器通过3次握手与服务器建立起TCP/IP连接。
通过观察，我们可以发现，几乎所有的网络钓鱼式攻击者都用到了表单，表单是用于实现
网页浏览者与服务器（或者说网页所有者）之间交互的一种页面元素，在WWW上它被广泛用于
各种信息的搜集和反馈。表单通常由两类元素构成：一是普通的页面元素：二是用于接收信息
的特定页面元素，也就是所谓的表单控件。控件是表单中用于接收用户输入或处理的元素，典
型的控件有文本框、密码框、多行文本框（文本区城）、复选框、单选框、选项（下拉）菜单、按
钮、文件选择框、隐藏控件、对象控件等。
当用户填完表格，并单击了Submit提交按钮后，Web浏览器并非将用户所填的数据直接
送给Web服务器，而先要经过一定的编码处理。Web浏览器总是将数据按照“变量名-变量值”
这样的数据对格式进行编码，并且每对数据之间用一个&符号相连接。其中“变量名”就是Form
---
## Page 143
网络安全进阶笔记
的数据（即Radio、Checkbox、Option 中的Value值）。同时，Web浏览器将用户数据中的所有
六进制ASCII码。Web浏览器将Form数据经过编码后，就传送给了Web服务器，面Web服
务器并非自己处理这些数据，而是通过CGI程序来帮忙处理这些数据，然后Web服务器再把
CGI程序产生的处理结果返回给Web浏览器。
小知识：CGI与Web服务器的关系如下：首先，用户的Web服务器必须支持CGI程序，并且
CGI应用程序必须在Web服务器上运行.客户端（Web浏览器）常用Post、Get两种方
式向Web服务器提文表单数据（图、表、文字的链接等）.Web服务器采用相应的数据
传递方式向CGI应用程序传递数据，CGI对数据处理后，将动态生成的Web页面发
给Web服务器，服务器再把页面发送给发送请求数据的客户端，客户端用Post方式
递交数据，Web服务器按照标准方式向CGI输入和接受数据，CGI同样按标准方式
读取和输出数据：客户端用Get方式遥交数据，在Unix类系统中Web服务器通过环
境变量方式把数据转交给CGI应用程序，CGI应用程序须从环境变量中读入数据，输
出结果同样送到标准输出中。
了解了上述原理，我们再来看看钓鱼式攻击者所精心制作的表单，如图3.9所示。
Online Banking and Inresting
SecMre your account
图3.9钓鱼式攻击者所精心制作的表单
134
---