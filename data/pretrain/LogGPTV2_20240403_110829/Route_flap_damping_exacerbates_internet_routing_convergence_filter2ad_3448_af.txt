later (because it has to wait for the announcement following the
withdrawal to penalize the route). At most e extra withdrawal
message is propagated under the new scheme.
Finally, selective ﬂap damping also eliminates announcement
triggered suppression, which consists of successive announcements
of increasing degrees of preference. Since our scheme does not
count successive monotonic route changes as ﬂaps, both forms of
suppression are eliminated.
We have validated through simulation that selective ﬂap damping
actually eliminates withdrawal triggered suppression. As shown in
17This can be caused by sender-side loop detection, policies, or up-
date reordering.
231)
s
d
n
o
c
e
s
(
s
e
m
i
t
e
c
n
e
g
r
e
v
n
o
C
3500
3000
2500
2000
1500
1000
500
0
2
)
s
d
n
o
c
e
s
(
s
e
m
i
t
e
c
n
e
g
r
e
v
n
o
C
350
300
250
200
150
100
50
0
2
Base case
Selective flap damping
Damping disabled
4
6
8
12
10
Clique size
14
16
18
20
Base case
Selective flap damping
Damping disabled
14
16
18
20
4
6
8
10
12
Pyramid size
Figure 7: Convergence times of the clique and pyramid topol-
ogy (averaging 50 simulation runs)
Figure 7, selective ﬂap damping exhibits convergence times compa-
rable to the situation when damping is disabled both for the clique
and the pyramid topologies. In addition, we also veriﬁed this for
our realistic topology, where selective ﬂap damping exhibits the
same convergence time and number of messages as the case when
ﬂap damping is disabled.
Furthermore, we veriﬁed that selective damping can suppress ac-
tual ﬂaps. To do this, we simulated network failures by making
node 1 in each of our topologies repeatedly ﬂap (i.e., alternately
withdraw and announce the route to d) with a period of 40 sec-
onds.18 We then observed the number of additional messages it
takes for selective damping to suppress the route compared to the
unmodiﬁed route ﬂap damping implementation. Our simulation
shows it takes at most 8 additional messages for selective damping
to suppress a continuously ﬂapping route compared to the original
RFD scheme. A scheme that does not use any form of damping will
instead send an update every 40 seconds. For each topology size,
the actual number of additional messages differs. For instance, for
a clique of size 5, it takes on average 3 extra messages. For a clique
of size 20, it takes on average 6 extra messages.
8. RELATED WORK
This paper has investigated the interaction between route ﬂap
damping and BGP convergence.
Route ﬂap damping has received very little examination in the re-
search literature. In the standards world, there are two documents
most often referenced in connection with route ﬂap damping. The
route ﬂap damping standard [3] describes the rationale for route
ﬂap damping and outlines a possible implementation strategy for
the mechanism. While that document discusses some interactions
between ﬂap damping and topology, it does not discuss announce-
ment or withdrawal triggered suppression. An associated docu-
ment, the RIPE recommendations [9] tantalizingly hints that one
or both of these phenomena may have been observed in practice.
To quote
...The only explanation would be that the multiple in-
terconnections between Ebone/AS1755 and ICM/AS1800
18The maximum frequency is limited by MRAI timer value.
did multiply the ﬂaps
(advertisements/withdrawals arrived time-shifted at ICM
....This would
routers through the multiple circuits).
then potentially hold true for any meshed topology be-
cause of the propagation delays of advertisements/withdrawals.
However, it then proposes a solution that we do not believe ad-
dresses the problem, nor does it analyze the phenomenon in any
level of detail.
Also related to route ﬂap damping is a technique for damping
link state changes. Rodeheffer et al. [18] proposed a ﬁlter, called a
skeptic, that penalizes unstable link state information for a time that
increases logarithmically with the number of ﬂaps of the link state.
The details of the algorithm are different from route ﬂap damping,
and it would be interesting to compare how the two perform on
various kinds of ﬂaps.
In the academic community, there have been two threads of prior
research into the following properties of BGP: stability and conver-
gence delays.
Stability: The ﬁrst thread started with the observation that there
existed certain policy conﬁgurations which could cause persistent
route oscillations in BGP [19]. Later, Grifﬁn and Wilfong [6] showed
the intractability of determining a safe policy conﬁguration for BGP.
Finally, Rexford and Gao [20] proved that if BGP’s policy expres-
siveness is conﬁned to a simple set of policies, persistent route os-
cillations cannot occur. Independently, Labovitz et al. [21] showed
that instability could occur even without policy conﬂicts because
of implementation artifacts. Thus this ﬁrst thread conﬁrmed the
value of the route ﬂap damping standard and probably inﬂuenced
the RIPE recommendations.
Convergence Delays: The second thread of BGP research is a
careful analysis of the dynamics of BGP’s route convergence prop-
erties [7, 8] and resulted in the interesting ﬁnding that BGP’s route
withdrawal process could result in a combinatorially large number
of path explorations.
Thus our paper can be considered to be a convergence between
these two threads of research because it shows that the RFD mech-
anism used to improve stability can exacerbate convergence delays.
Other more recent prior work has explored and attempted to
solve delayed Internet routing convergence. Grifﬁn et al. [12] ex-
plored how convergence is affected by the MRAI timer setting and
addressed its impact on various topologies. In their future work,
they pointed out the potential for route ﬂap damping to be invoked
by oscillations inherent in the BGP protocol. In this work, we con-
ﬁrm their suspicion by thoroughly studying its interaction with con-
vergence.
More directly related is the work of Pei et al. [14] who attempted
to avoid path exploration during route withdrawal by using consis-
tency assertions. They showed that their approach can invalidate all
paths within one MRAI round in some cases. This is an intriguing
approach that might work, although it needs extensive experimen-
tation to be widely deployed and does not work in all cases (e.g.,
when policy is used for say trafﬁc engineering). It should be clear
from this paper that a ﬁx for withdrawal path exploration in BGP
will reduce the occurrence of the phenomenon we see in this paper.
Despite this, the value of our paper is that it provides the ﬁrst anal-
ysis of the interaction between RFD and convergence and suggests
an alternate solution for this interaction that is useful, if a general
solution to eliminate withdrawal path exploration turns out to be
hard to design and deploy.
2329. CONCLUSION
In this paper, we analyze a previously not well-studied interac-
tion between BGP’s route withdrawal process and its route ﬂap
damping mechanism for ensuring the overall stability of the In-
ternet routing system. This interaction can, depending upon the
topology, suppress up to one hour the propagation of a route that
has been withdrawn once and re-announced. We have shown that
this interaction has a number of subtle features. For instance, we
found that in the pyramid topology increasing the size of the topol-
ogy actually improved the rate of convergence.
We have proposed a simple ﬁx to this withdrawal triggered sup-
pression called selective ﬂap damping. It relies on being able to
weed out secondary ﬂaps using a monotonicity condition which se-
lectively avoids penalizing such secondary ﬂaps. Our selective ﬂap
damping mechanism successfully eliminates withdrawal triggered
suppression in all the topologies that we have analyzed.
We leave for further work the problem of accurately characteriz-
ing the network topologies and sizes which will induce withdrawal
triggered suppression. A theoretical analysis of the properties of se-
lective ﬂap damping would also be desirable. Despite this, our pa-
per together with [7, 8] makes it clear that faster convergence does
require modifying BGP. This could be done by either ﬁxing the
withdrawal path exploration phenomenon (the direction followed
in [14]) or by deploying a mechanism similar in spirit to selec-
tive ﬂap damping (as in our paper). Either way, such BGP modi-
ﬁcations could move us closer to the Holy Grail: an inter-domain
routing protocol that is stable and yet reroutes trafﬁc extremely fast
after failure.
10. ACKNOWLEDGEMENTS
We thank developers of SSFnet for making the simulator avail-
able. We especially thank BJ Premore for the BGP implementation
in SSFnet and prompt responses to our questions. We are grateful
to Tim Grifﬁn and Srdjan Petrovic for the implementation of SOS
(Scripts for Organizing Simulations). Tim Grifﬁn, Scott Shenker,
Wilson So, and Jia Wang gave us insightful comments. We are in-
debted to Sprint ATL, especially to Linda Chau, Peter Lam, Bryan
Lyles, and J. J. Yea, for their router testbed, so we can verify with-
drawal triggered suppression using commercial routers. Finally,
we also thank the SIGCOMM 2002 anonymous referees for their
feedback.
This work was supported by the California MICRO Program,
with matching support from Ericsson, Nokia, Siemens, and Sprint.
11. REFERENCES
[1] Atul Khanna and John Zinky, “The Revised ARPANET
Routing Metric,” in Proceedings of ACM SIGCOMM 1989.
[2] H. Yu C. Alaettinoglu, V. Jacobson, “Towards Milli-Second
IGP Convergence,” IETF Internet Draft:
draft-alaettinoglu-ISIS-convergence-00, November 2000.
[3] C. Villamizar, R. Chandra, and R. Govindan, “BGP Route
Flap Damping,” RFC 2439, 1998.
[4] “From private email exchanges with Randy Bush,” .
[5] Geoff Huston, “Analyzing the Internet BGP Routing Table,”
The Internet Protocol Journal, March 2001.
[6] Timothy G. Grifﬁn and Gordon Wilfong, “An Analysis of
BGP Convergence Properties,” in Proceedings of ACM
SIGCOMM 1999.
[7] C. Labovitz, A. Ahuja, A. Bose, and F. Jahanian, “Delayed
Internet Routing Convergence,” in Proceedings of ACM
SIGCOMM 2000.
[8] C. Labovitz, R. Wattenhofer, S. Venkatachary, and A. Ahuja,
“The Impact of Internet Policy and Topology on Delayed
Routing Convergence,” in Proceedings of INFOCOM 2001.
[9] Christian Panigl, Joachim Schmitz, Philip Smith, and
Cristina Vistoli, “RIPE Routing-WG Recommendations for
Coordinated Route-ﬂap Damping Parameters,” October
2001, Document ID: ripe-229.
[10] “The SSFnet Project,” http://www.ssfnet.org.
[11] Y. Rekhter and T. Li, “A Border Gateway Protocol,” RFC
1771 (BGP version 4), March 1995.
[12] Timothy G. Grifﬁn and Brian J. Premore, “An Experimental
Analysis of BGP Convergence Time,” in Proceedings of
ICNP 2001.
[13] Z. Morley Mao, Ramesh Govindan, George Varghese, and
Randy Katz, “Route ﬂap damping exacerbates internet
routing convergence,” Tech. Rep. UCB//CSD-02-1184, U.C.
Berkeley, June 2002.
[14] D. Pei, X. Zhao, L. Wang, D. Massey, A. Mankin, S. F. Wu, ,
and L. Zhang, “Improving BGP Convergence Through
Consistency Assertions,” .
[15] BGP4 Inter-Domain Routing in the Internet,
Addison-Wesley, 1999.
[16] Ripe NCC, “Routing Information Service Raw Data,” .
[17] “University of Oregon Route Views Archive Project,”
www.routeviews.org.
[18] Thomas Rodeheffer and Michael D. Schroeder, “Automatic
Reconﬁguration in Autonet,” in Proceedings of 13th ACM
Symposium on Operating System Principles.
[19] K. Varadhan, R. Govindan, and D. Estrin, “Persistent Route
Oscillations in Inter-Domain Routing,” Computer Networks,
March 2000.
[20] Lixin Gao and Jennifer Rexford, “Stable Internet Routing
Without Global Coordination,” in Proceedings of ACM
SIGMETRICS 2000.
[21] C. Labovitz, R. Malan, and F. Jahanian, “Internet Routing
Stability,” in Proceedings of ACM SIGCOMM 1997.
233