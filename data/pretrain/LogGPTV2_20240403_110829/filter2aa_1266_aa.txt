DIY Hardware implant over I2C
Part of the NSA Playset
This slide deck will change for the talk to include more information and
details!
Josh Datko and Teddy Reed
DEF CON 2
2
August 10, 2014
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
1 / 49
Outline
1
NSA Playset DEF CON Series
2
I2C Attack Points
3
I2C Module
4
Controller Device
5
GSM Module
6
WAGONBED Improvements
7
GSM Exﬁl Alternaive: Audio
8
Wrapup
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
2 / 49
NSA Playset Series
What is the NSA Playset?
We hope the NSA Playset will make cutting edge security tools more
accessible, easier to understand, and harder to forget.
NSA Playset Talks
RF Retroreﬂector
Penn & Teller
Friday
12:00
DIY Hardware Implant
Penn & Teller
Sunday
11:00
GSM Sniﬃng
Penn & Teller
Sunday
12:00
PCIe
Penn & Teller
Sunday
14:00
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
3 / 49
Inspired by the NSA
The NSA apparently has a hardware hacking catalog.1
Flip. . . Flip. . . Flip. . .
1like SkyMall for spies and without the Bigfoot.
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
4 / 49
Inspired by the NSA
The NSA apparently has a hardware hacking catalog.1
Flip. . . Flip. . . Flip. . .
Oh look honey, there’s an I2C controller board we can get. It
attaches to a computer and it’s modular, so you can add a GSM
cell phone for exﬁl.
1like SkyMall for spies and without the Bigfoot.
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
4 / 49
Inspired by the NSA
The NSA apparently has a hardware hacking catalog.1
Flip. . . Flip. . . Flip. . .
Oh look honey, there’s an I2C controller board we can get. It
attaches to a computer and it’s modular, so you can add a GSM
cell phone for exﬁl.
That’s nice dear.
1like SkyMall for spies and without the Bigfoot.
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
4 / 49
Inspired by the NSA
The NSA apparently has a hardware hacking catalog.1
Flip. . . Flip. . . Flip. . .
Oh look honey, there’s an I2C controller board we can get. It
attaches to a computer and it’s modular, so you can add a GSM
cell phone for exﬁl.
That’s nice dear.
I wonder how that works. . .
1like SkyMall for spies and without the Bigfoot.
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
4 / 49
Requirements for the implant
Reverse-engineered requirements:
Must attach over I2C to the target.
Must include GSM reachback to the implant.
Our requirements:
Easy to use.
As much commodity hardware as possible.
Fun.
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
5 / 49
Implant Control Diagram
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
6 / 49
Background: What is I2C
Serial bus.
Two-wires: (plus power and ground).2
I Data: SDA
I Clock: SCL
Multi-master.
Multi-slave.3
Addressable.
Standard speed is 100kHz (100kbps). High Speed: 3.2Mbps
theoretical max.
2Typically 5 or 3.3V
3Note to SJWs, this is the technical correct term.
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
7 / 49
Background: I2C in visual form
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
8 / 49
I2C attack surfaces
EEPROMs
PCI and PCIe
Battery controllers
Video . . .
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
9 / 49
Video I2C
Why is there I2C on your monitor adapter?
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
10 / 49
Video I2C
Why is there I2C on your monitor adapter?
How does your computer “automatically detect” monitor resolution?
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
10 / 49
Video I2C
Why is there I2C on your monitor adapter?
How does your computer “automatically detect” monitor resolution?
EDID
Extended Display Identiﬁcation Data
DDC
Data Display Channel, a.k.a. 5V I2C
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
10 / 49
EDID
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
11 / 49
$ edid-decode
ioreg -lw0 -r -c "IODisplayConnect"
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
12 / 49
EDID Extension Blocks
Tag Number
Extension Block Description
00h
Timing Extension
02h
CEA-EXT: CEA 861 Series Extension
10h
VTB-EXT: Video Timing Block Extension
20h
EDID 2.0 Extension
40h
DI-EXT: Display Information Extension
50h
LS-EXT: Localized String Extension
60h
DPVL-EXT: Digital Packet Video Link Extension
A7h, AFh, BFh
DTCDB-EXT: Display Transfer Characteristics
F0h
EXTENSION Block Map
FFh
EXTENSIONS deﬁned by the OEM
Parsing implemented by the OS-supplied VESA driver or GPU driver
manufacturer.
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
13 / 49
Exploiting EDID/EDID Extension parsing
Hacking Displays Made Interesting
Blackhat EU 2012
Andy Davis - NGS Secure
https://github.com/nccgroup/EDIDFuzzer
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
14 / 49
Exploiting EDID/EDID Extension parsing
Hacking Displays Made Interesting
Blackhat EU 2012
Andy Davis - NGS Secure
https://github.com/nccgroup/EDIDFuzzer
Simple adaptation for BeagleBone
Implemented in Python (BBIO)
https://github.com/theopolis/bone-edidfuzzer
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
14 / 49
Exploiting EDID/EDID Extension parsing
Hacking Displays Made Interesting
Blackhat EU 2012
Andy Davis - NGS Secure
https://github.com/nccgroup/EDIDFuzzer
Simple adaptation for BeagleBone
Implemented in Python (BBIO)
https://github.com/theopolis/bone-edidfuzzer
Discover proprietary EDID extensions! Moar fuzzing!
Or assume a-priori software control...
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
14 / 49
I2C everywhere IC4
A video card may have multiple I2C buses and devices. NVIDIA cards may
have I2C for the following:
EEPROM for encrypted HDCP keys
Onboard voltage regulator
Thermal sensor
TV decoder chip (older cards)
4C’mon, it’s punny
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
15 / 49
Exploring VGA I2C
Let’s start exploring our attack surface.
Pin
Name
Description
1
RED
Red Video
2
GREEN
Green Video
3
BLUE
Blue Video
...
...
...
5
GND
Ground
9
KEY
Optional +5V output from graphics card
12
SDA
I2C data
15
SCL
I2C data clock
VGA Pinout
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
16 / 49
I want my I2C 5
5Dire Straights fans, anyone?
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
17 / 49
Filling in the details
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
18 / 49
Controller Selection
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
19 / 49
Controller Selection
BeagleBone Black is the
embedded hacker’s friend:
1GHz AM3358 ARM®
Cortex-A8
512MB DDR3 RAM
Two independent
Programmable Real-Time
Units (32bit)
Crypto accelerators for
AES, SHA, MD5
UARTs, PWM, LCD,
GPMC, SPI, ADC, CAN,
Timers
Two I2C buses
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
19 / 49
CryptoCape
Let’s add some hardware security ICs:
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
20 / 49
CryptoCape
Let’s add some hardware security ICs:
Authenticators: ECC &
MAC (SHA256)
Encrypted EEPROM
(AES-128-CCM)
Battery backed up
Real-time clock
Trusted Platform
Module
ATmega328p, because
Arduino.
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
20 / 49
Add the controller
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
21 / 49
GSM Module
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
22 / 49
GSM Module
Seeed Studo GPRS Shield v2:
Arduino form factor
GSM Quad band support
TCP support