For the purpose of evaluation, we implemented the proposed
knowledge graph, as well as MalRank algorithm on a big data clus-
ter consisting of 7 physical servers (on top of Apache Spark). We
used two days of proxy and DNS logs collected from a large inter-
national organization’s SIEM to construct the proposed knowledge
graph. Next, we used publicly available OSINT to enrich entities ob-
served, and TI to label small set of nodes as malicious. After running
MalRank on the generated knowledge graph, we showed that our
approach can achieve a high accuracy (AUC = 96%). Furthermore,
proving effective to increase threat intelligence by discovering a
large number of new malicious entities.
REFERENCES
[1] 2018. ATT&CK: Standard Application Layer Protocol. https://attack.mitre.org/
[2] 2018. Loopy Belief Propagation. https://github.com/HewlettPackard/sandpiper.
wiki/Technique/T1071
Accessed: 2018-08-10.
[3] Osama Almanna. 2016. StartSSL Domain validation (Vulnerability discovered).
http://oalmanna.blogspot.com/2016/03/startssl-domain-validation.html
[4] Manos Antonakakis, Roberto Perdisci, David Dagon, Wenke Lee, and Nick Feam-
ster. 2010. Building a Dynamic Reputation System for DNS. In USENIX security
symposium. 273–290.
[5] Manos Antonakakis, Roberto Perdisci, Wenke Lee, Nikolaos Vasiloglou, and
David Dagon. 2011. Detecting Malware Domains at the Upper DNS Hierarchy.
In USENIX security symposium, Vol. 11. 1–16.
[6] Bahman Bahmani, Abdur Chowdhury, and Ashish Goel. 2010. Fast incremental
and personalized pagerank. Proceedings of the VLDB Endowment 4, 3 (2010),
173–184.
[7] Leyla Bilge, Engin Kirda, Christopher Kruegel, and Marco Balduzzi. 2011. EXPO-
SURE: Finding Malicious Domains Using Passive DNS Analysis. In Ndss.
[8] Sergey Brin and Lawrence Page. 1998. The anatomy of a large-scale hypertextual
web search engine. Computer networks and ISDN systems 30, 1-7 (1998), 107–117.
[9] Anna L Buczak and Erhan Guven. 2016. A survey of data mining and machine
learning methods for cyber security intrusion detection. IEEE Communications
Surveys & Tutorials 18, 2 (2016), 1153–1176.
[10] Qiang Cao, Michael Sirivianos, Xiaowei Yang, and Tiago Pregueiro. 2012. Aiding
the detection of fake accounts in large scale social online services. In Proceedings
of the 9th USENIX conference on Networked Systems Design and Implementation.
USENIX Association, 15–15.
[11] Duen Horng "Polo" Chau, Carey Nachenberg, Jeffrey Wilhelm, Adam Wright,
and Christos Faloutsos. 2011. Polonium: Tera-scale graph mining and inference
for malware detection. In Proceedings of the 2011 SIAM International Conference
on Data Mining. SIAM, 131–142.
[12] D Chismon and M Ruks. 2015. Threat intelligence: Collecting, analysing, evalu-
ating. MWR InfoSecurity Ltd (2015).
[13] David Cooper, Stefan Santesson, Stephen Farrell, Sharon Boeyen, Russell Housley,
and William Polk. 2008. Internet X. 509 public key infrastructure certificate and
certificate revocation list (CRL) profile. Technical Report.
[14] MITRE Corporation. 2018. ATT&CK: Commonly Used Port. https://attack.mitre.
org/wiki/Technique/T1043
[15] Brian Davison. 2006. Propagating trust and distrust to demote web spam. (2006).
[16] Dhivya Eswaran, Stephan Günnemann, Christos Faloutsos, Disha Makhija, and
Mohit Kumar. 2017. Zoobp: Belief propagation for heterogeneous networks.
Proceedings of the VLDB Endowment 10, 5 (2017), 625–636.
[17] Maryam Feily, Alireza Shahrestani, and Sureswaran Ramadass. 2009. A survey
of botnet and botnet detection. In Emerging Security Information, Systems and
Technologies, 2009. SECURWARE’09. Third International Conference on. IEEE, 268–
273.
[18] Will Hamilton, Zhitao Ying, and Jure Leskovec. 2017. Inductive representation
learning on large graphs. In Advances in Neural Information Processing Systems.
1024–1034.
[19] Taher H Haveliwala. 2003. Topic-sensitive pagerank: A context-sensitive ranking
algorithm for web search. IEEE transactions on knowledge and data engineering
15, 4 (2003), 784–796.
[20] Yonghong Huang and Paula Greve. 2015. Large scale graph mining for web
reputation inference. In Machine Learning for Signal Processing (MLSP), 2015 IEEE
25th International Workshop on. IEEE, 1–6.
[21] Glen Jeh and Jennifer Widom. 2002. SimRank: a measure of structural-context
similarity. In Proceedings of the eighth ACM SIGKDD international conference on
Knowledge discovery and data mining. ACM, 538–543.
[22] David Kempe, Jon Kleinberg, and Éva Tardos. 2003. Maximizing the spread of
influence through a social network. In Proceedings of the ninth ACM SIGKDD
international conference on Knowledge discovery and data mining. ACM, 137–146.
[23] Issa Khalil, Ting Yu, and Bei Guan. 2016. Discovering malicious domains through
passive DNS data graph analysis. In Proceedings of the 11th ACM on Asia Confer-
ence on Computer and Communications Security. ACM, 663–674.
[24] Issa M Khalil, Bei Guan, Mohamed Nabeel, and Ting Yu. 2018. A Domain is
only as Good as its Buddies: Detecting Stealthy Malicious Domains via Graph
Inference. In Proceedings of the Eighth ACM Conference on Data and Application
Security and Privacy. ACM, 330–341.
[25] Danai Koutra, Tai-You Ke, U Kang, Duen Horng Polo Chau, Hsing-Kuo Kenneth
Pao, and Christos Faloutsos. 2011. Unifying guilt-by-association approaches:
Theorems and fast algorithms. In Joint European Conference on Machine Learning
and Knowledge Discovery in Databases. Springer, 245–260.
[26] Vijay Krishnan and Rashmi Raj. 2006. Web spam detection with anti-trust rank..
In AIRWeb, Vol. 6. 37–40.
[27] Marc Kührer, Christian Rossow, and Thorsten Holz. 2014. Paint it black: Evaluat-
ing the effectiveness of malware blacklists. In International Workshop on Recent
Advances in Intrusion Detection. Springer, 1–21.
[28] Justin Ma, Lawrence K Saul, Stefan Savage, and Geoffrey M Voelker. 2009. Be-
yond blacklists: learning to detect malicious web sites from suspicious URLs.
In Proceedings of the 15th ACM SIGKDD international conference on Knowledge
discovery and data mining. ACM, 1245–1254.
[29] Justin Ma, Lawrence K Saul, Stefan Savage, and Geoffrey M Voelker. 2009. Identify-
ing suspicious URLs: an application of large-scale online learning. In Proceedings
of the 26th annual international conference on machine learning. ACM, 681–688.
[30] Dhia Mahjoub. 2013. Monitoring a fast flux botnet using recursive and passive
DNS: A case study. In eCrime Researchers Summit (eCRS), 2013. IEEE, 1–9.
[31] Grzegorz Malewicz, Matthew H Austern, Aart JC Bik, James C Dehnert, Ilan
Horn, Naty Leiser, and Grzegorz Czajkowski. 2010. Pregel: a system for large-
scale graph processing. In Proceedings of the 2010 ACM SIGMOD International
Conference on Management of data. ACM, 135–146.
[32] Pratyusa K Manadhata, Sandeep Yadav, Prasad Rao, and William Horne. 2014.
Detecting malicious domains via graph inference. In European Symposium on
Research in Computer Security. Springer, 1–18.
[33] Niels Provos Panayiotis Mavrommatis and Moheeb Abu Rajab Fabian Monrose.
2008. All your iframes point to us. In USENIX Security Symposium. USENIX. 1–16.
[34] Igor Mishsky, Nurit Gal-Oz, and Ehud Gudes. 2015. A topology based flow
model for computing domain reputation. In IFIP Annual Conference on Data and
Applications Security and Privacy. Springer, 277–292.
[35] Pejman Najafi, Andrey Sapegin, Feng Cheng, and Christoph Meinel. 2017. Guilt-
by-Association: Detecting Malicious Entities via Graph Mining. In International
Conference on Security and Privacy in Communication Systems. Springer, 88–107.
[36] Alina Oprea, Zhou Li, Ting-Fang Yen, Sang H Chin, and Sumayah Alrwais. 2015.
Detection of early-stage enterprise infection by mining large-scale log data. In
Dependable Systems and Networks (DSN), 2015 45th Annual IEEE/IFIP International
Conference on. IEEE, 45–56.
[37] Lawrence Page, Sergey Brin, Rajeev Motwani, and Terry Winograd. 1999. The
PageRank citation ranking: Bringing order to the web. Technical Report. Stanford
InfoLab.
[38] Judea Pearl. 2014. Probabilistic reasoning in intelligent systems: networks of plausi-
ble inference. Elsevier.
[39] Chengwei Peng, Xiaochun Yun, Yongzheng Zhang, Shuhao Li, and Jun Xiao.
2017. Discovering Malicious Domains through Alias-Canonical Graph. In Trust-
com/BigDataSE/ICESS, 2017 IEEE. IEEE, 225–232.
[40] J Ronald Prins and Business Unit Cybercrime. 2011. DigiNotar Certifi-
cate Authority breach ’Operation Black Tulip’.
Fox-IT, November (2011).
https://www.rijksoverheid.nl/ministeries/ministerie-van-binnenlandse-zaken-
en-koninkrijksrelaties/documenten/rapporten/2011/09/05/diginotar-public-
report-version-1
[41] Babak Rahbarinia, Roberto Perdisci, and Manos Antonakakis. 2015. Segugio:
Efficient behavior-based tracking of malware-control domains in large ISP net-
works. In Dependable Systems and Networks (DSN), 2015 45th Annual IEEE/IFIP
International Conference on. IEEE, 403–414.
[42] Paul Royal. 2012. Maliciousness in top-ranked alexa domains. Online].
https://www. barracudanetworks. com/blogs/labsblog (2012).
[43] Milivoj Simeonovski, Giancarlo Pellegrino, Christian Rossow, and Michael Backes.
2017. Who controls the internet?: Analyzing global threats using property graph
traversals. In Proceedings of the 26th International Conference on World Wide Web.
International World Wide Web Conferences Steering Committee, 647–656.
[44] Elizabeth Stinson and John C Mitchell. 2008. Towards Systematic Evaluation of
the Evadability of Bot/Botnet Detection Methods. WOOT 8 (2008), 1–9.
[45] Amarnag Subramanya and Partha Pratim Talukdar. 2014. Graph-based semi-
supervised learning. Synthesis Lectures on Artificial Intelligence and Machine
Learning 8, 4 (2014), 1–125.
[46] Acar Tamersoy, Kevin Roundy, and Duen Horng Chau. 2014. Guilt by association:
large scale malware detection by mining file-relation graphs. In Proceedings of
the 20th ACM SIGKDD international conference on Knowledge discovery and data
mining. ACM, 1524–1533.
[47] Wenpu Xing and Ali Ghorbani. 2004. Weighted pagerank algorithm. In Com-
munication Networks and Services Research, 2004. Proceedings. Second Annual
Conference on. IEEE, 305–314.
[48] Jonathan S Yedidia, William T Freeman, and Yair Weiss. 2003. Understanding
belief propagation and its generalizations. Exploring artificial intelligence in the
new millennium 8 (2003), 236–239.
[49] Yue Zhang, Jason I Hong, and Lorrie F Cranor. 2007. Cantina: a content-based
approach to detecting phishing web sites. In Proceedings of the 16th international
conference on World Wide Web. ACM, 639–648.
[50] Futai Zou, Siyu Zhang, Weixiong Rao, and Ping Yi. 2015. Detecting malware
based on DNS graph mining. International Journal of Distributed Sensor Networks
11, 10 (2015), 102687.
A EXPERIMENT DETAILS
A.1 SIEM Logs
The statistics of SIEM logs used for the purpose of this research
Table 5: The statistics of our SIEM logs for the experiment
Source
Size
#Events
DNS Logs
Prxy Logs
DHCP Logs
2TB (120GB gzip compressed)
1TB (100GB gzip compressed)
12GB (800MB gzip compressed)
2 billion
755 million
4m
A.2 Hardware Setup
Table 6: Description of the hardware used in this research
Server
Dell PowerEdge R730
Dell PowerEdge R820
Fujitsu Primergy RX600
Fujitsu Primergy RX600
Details
2x Intel Xeon E5-2690 @ 2.6GHz
(14 cores each), 768GB RAM, 1TB
SSD
2x Intel Xeon E5-4617 @ 2.90GHz
(6 cores each), 328GB RAM, 540GB
HDD
4x Intel Xeon E7-4820 @ 2.60GHz
(8 cores each), 256GB RAM, 2TB
SSD
4x Intel Xeon E7-4820 @ 2.60GHz
(8 cores each), 128GB RAM and
1TB SSD
#Servers
1x
1x
1x
4x
A.3 Vertices and Edges
Table 7: The count of each vertex and edge type loaded into the final
knowledge graph.
Edges
Vertices
#
Type
103 million Domain
#
12.4m
1.8m
0.28m
0.27m
0.12m
0.08m
0.07m
0.02m
Ipv4
Organization
X509cert
Mac
ipRange
Useragent
Asn
Type
requestedAccessTo
subDomainOf
resolvedTo
uses
aliasFor
referedTo
associatedWith
isInRange
mailServerFor
issuedBy
issuedFor
signedBy
nameServerFor
assignedTo
belongsTo
10m
7m
3m
2.5m
2m
1.7m
1.3m
1m
0.26m
0.26m
0.23m
0.12m
0.08m
0.03m
Figure 7: ROC Curve for different number of MalRank iteration based on the same testing/evaluation set and their corresponding run-time.
A.4 Number of Iterations
In the majority of our experiments, we chose 9 as maximum number
of iterations. The main reason for this choice is that; within our
knowledge graph, the inference from more than 4 hops aways does
not make much sense. Consider the requestedAccessTo edge isolated
from all the others. This edge captures the relationship between
a MAC address and a set of domain/IP nodes (shaping a bipartite
graph). In order to decide the label for a domain, it makes sense to
traverse back to the MAC address that requested this domain and
check the score for all other domains visited by that MAC (perhaps
an indication of a malware trying to reach out to malicious IPs
or Domain for C&C), i.e., inference from two hops away. It also
makes sense to check another two hops, i.e., check whether there
exist other workstations which connect to similar known malicious
nodes. However, going deeper than that loses the intuition entirely.
This could also be observed in Figure 7 which shows the ROC curve
for a different number of iterations. As shown in the figure, while
the results do not vary drastically after 7 iterations, the algorithm
runtime increases drastically. For instance, when we change from 9
to 18 iterations we increase the accuracy by 0.2% and the run-time
by 50%.