请求应答模式联机交互模式
联机交互模式有请求应答和单向消息两种模式。
请求应答模式
请求方发起请求，服务提供方接收请求，进行处理并且返回应答，请求方接收应答。一次完整的交互包括请求和应答两部分，交互过程中双方通常是一对一的关系，通过组合交易可以实现一对多的请求应答。
对于服务方，供接口接收到请求之后，实时处理，返回应答，时延很短。
对于请求方，需接口实现可以采用同步或异步的两种模式。在同步模式下，请求方发出请求后，在同一线程（或进程）阻塞等待请求返回。在异步模式下，发请求和收响应两个环节可以分开在不同线程、进程，发出请求的线程（或进程）完成发出动作后即返回，不等待响应，接收请求的线程（或进程）阻塞等待请求返回。
单向消息模式
消息发出方发出消息到队列，发送完毕即返回，不等待接收方应答。接收方从队列接收消息，进行处理。消息发出方为服务提供方（或者生产方），技术接口为供接口；接收方为服务使用方（或者消费方），技术接口为需接口。单向消息在交易路径上用单向箭头表示。消息发布模式的处理分为消息发送和接收处理两段，两段处理中间有消息队列缓冲，耦合度低，消息传输过程是单向的。
单向消息模式又可以细分为3种：
一对一模式：发出方发出通知，使用方接收通知并处理，消息发出方和接收方是一对一关系。
发布订阅模式：发出方发出消息，多个订阅方接收消息并处理，消息发出方和接收方是一对多关系，并且接收方可以定制关注的主题。
生产消费模式：发出方发出消息，多个服务使用方接收消息并处理，消息发出方和接收方是一对多关系，和发布订阅不同的是，多个接收方接收组件连接上的的所有消息。
联机交互动作
一个组件实例，跟供接口相关的联机交互动作有：供接口请求报文接收、供接口响应报文发送，如果供接口为单向消息模式，则只有供接口请求报文接收。跟需接口相关的联机交互动作有：需接口请求报文发送、需接口响应报文接收，如果需接口为单向消息模式，则只有需接口请求报文发送。
组件实例角色组件实例角色
组件实例处于交易路径中的不同位置，其对应的角色也不相同，可以分为三类：发起节点、中间节点、末端节点。
发起节点：交易发起的起始点。从归属来区分又可以分为联盟外部发起节点和联盟内部发起节点。
中间节点：在交易路径中既有供接口，又有需接口的节点。
末端节点：在交易路径中只有供接口没有需接口的节点。末端节点在一条交易路径中可能不止一个。从归属来区分又可以分为联盟外部末端节点和联盟内部末端节点。
交易路径跟踪图形化展示
交易路径跟踪拓扑图
联盟内部系统发起
联盟外部系统发起
说明
上述交易路径的图形化展示中，包含了以下各种场景：
联盟统建内部系统发起的交易的情况（A）。
联盟统建外部系统发起的交易的情况（H）。
交易路径中调用联盟统建外部系统的情况（G）。
单向消息服务调用的情况（B调用E）。
请求响应服务调用的情况。
组合交易（B调用C、D、E）。
通过消息中间件发起的服务调用（D调用H、L）。组合交易（B调用C、D、E）。
通过消息中间件发起的服务调用（D调用H、L）。
交易路径跟踪时序图
联盟内部系统发起
注：此时序图对应联盟内部系统发起拓扑图
联盟外部系统发起
注：此时序图对应联盟外部系统发起拓扑图
交易路径跟踪相关规则、规范定义
全局统一流水号规范
作用
为了能够将一个复杂的交易流程中，涉及到的多次交易调用串联起来进行分析，设置全局统一流水号字段，英文字段名：global_trace_num，放置在XML报文的报文头部分，并在各系统日志中记录，在整个交易流程中透传此流水号。
组成规范
11位应用系统编号 + 34位自定义唯一标识号
字段说明
11位应用系统编号：联盟统一规划的11位系统编号，举例：80100180000。
34位自定义唯一标识号：要求为不重复的唯一标识号，至少应保证1年内不重复，位数不足左侧补0。
使用规则
联盟统建系统内部发起的交易，统一流水号应从发起交易的组件处生成。使用规则
联盟统建系统内部发起的交易，统一流水号应从发起交易的组件处生成。
联盟统建系统外部发起的交易，统一流水号应从最早进入联盟统建系统的组件处生成。
范例
8010018000000690bb711bd2a4f8daa00ab87aa477d69
80100180000007bbd91192b3b498c873a4ce03e132667
调用路径号规范
作用
交易路径由一次或多次的服务调用组成，为了跟踪每一次的服务调用信息，需要对每一次服务调用（也就是每一段路径）进行编号，因此设置调用路径号字段，英文字段名：global_path_num，放置在XML报文的报文头部分，并在各应用系统日志中记录。
组成规范
路径层次分隔符+路径顺序号
长度：总共45位，在每层广度不超过9的情况下，最大可支持深度为23层的服务调用。
字段说明
路径层次分隔符：用“.”表示。
路径顺序号：用阿拉伯数字表示，由1开始递增。路径层次分隔符：用“.”表示。
路径顺序号：用阿拉伯数字表示，由1开始递增。
使用规则
第一层服务调用不加层次分隔符，直接用顺序号表示，例如：1；
深度递增：每增加一层服务调用，就在原调用路径号后加一个“.”，再加上顺序号，以此类推，如下图所示：
广度递增：组合交易中如果能够确定调用次序的，那么服务调用顺序号从1开始按照调用次序依次递增，如下图所示：
广度不变：如果无法确定调用次序的，例如通过消息中间件，采用发布、订阅模式的服务调用，由于消息中间件无法对顺序号做广度递增，因此这类服务调用的顺序号都相同，如下图所示：
说明：上图左侧图示为逻辑示意图，右侧为实际的交易路径拓扑图。B通过消息中间件调用C和D服务，调用路径号均为1.1，广度不变。为了与上面广度递增的情形区分开，这里使用虚线表示交易路径，代表通过消息中间件的非直接调用。长度溢出处理：交易路径上的中间节点或末端节点从报文头中解析出调用路径号后，要先进行长度判断，如果位数已达最大长度，则不再对调用路径号做更改，直接向后传递；如果位数未到最大长度，但按照规则做了递增后超过了最大长度，则截取前45位向后传递；未出现上述两种情况的，正常处理即可。
范例
第一层调用路径号：1
第二层第一次调用路径号：1.1
第三层第一次调用路径号：1.1.1
第三层第二次调用路径号：1.1.2
联机交互动作职责分解
联盟外部发起点
动作职责：无；
联盟内部发起点
需接口请求报文发送动作职责：
生成统一流水号
生成调用路径号
记录日志
需接口响应报文接收动作职责：
解析报文头中统一流水号
解析报文头中调用路径号
记录日志
中间节点
供接口请求报文接收动作职责：
如果是联盟统建外第三方系统发送的请求报文，则生成统一流水号；否则解析报文头中是否有统一流水号，有则继续向后传递，无则后续动作保持报文头此字段为空；如果是联盟统建外第三方系统发送的请求报文，则生成调用路径号；否则解析报文头中是否有调用路径号，有则继续向后按照规则传递，无则后续动作保持报文头此字段为空；
记录日志；
需接口请求报文发送动作职责：
请求报文接收点处理后的统一流水号，如果不为空，则填写到请求报文头；如果为空则保持报文头此字段为空；
请求报文接收点处理后的调用路径号，如果不为空，则做深度递增、广度递增后，填写到请求报文头；如果为空则保持报文头此字段为空；
记录日志；
需接口响应报文接收动作职责：
解析报文头中统一流水号；
解析报文头中调用路径号；
记录日志；
供接口响应报文发送动作职责：
请求报文接收点处理后的统一流水号，如果不为空，则填写到请求报文头；如果为空则保持报文头此字段为空；
请求报文接收点处理后的调用路径号，如果不为空，则填写到请求报文头；如果为空则保持报文头此字段为空；
记录日志；
联盟内部末端节点记录日志；
联盟内部末端节点
供接口请求报文接收动作职责：
如果是联盟统建外第三方系统发送的请求报文，则生成统一流水号；否则解析报文头中是否有统一流水号，有则继续向后传递，无则后续动作保持报文头此字段为空；
如果是联盟统建外第三方系统发送的请求报文，则生成调用路径号；否则解析报文头中是否有调用路径号，有则继续向后按照规则传递，无则后续动作保持报文头此字段为空；
记录日志；
供接口响应报文发送动作职责：
请求报文接收点处理后的统一流水号，如果不为空，则填写到请求报文头；如果为空则保持报文头此字段为空；
请求报文接收点处理后的调用路径号，如果不为空，则填写到请求报文头；如果为空则保持报文头此字段为空；
记录日志；
联盟外部末端节点
动作职责：无；
联机交互动作职责图解
联盟内部发起
联盟外部发起
应用场景分析
场景一：联盟统建系统内部发起的交易联盟外部发起
应用场景分析
场景一：联盟统建系统内部发起的交易
联盟统建系统内部发起的交易，统一流水号、调用路径号应从交易发起的最前端（例如：网上银行、手机银行APP、柜面系统等）生成。上图中，手机银行APP作为交易发起点，统一流水号、调用路径号应从此处生成。
说明：
H5页面、SDK等能力开放平台，作为联盟统建系统的延伸，也认为是交易发起的最前端系统。
上图中APP Server，是一个组合交易节点。
场景二：联盟端第三方系统发起的交易
联盟端第三方系统发起的交易，统一流水号、调用路径号应从第三方系统最先调用的联盟统建系统的组件处生成。