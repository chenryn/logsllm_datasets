### FOR EDUCATIONAL PURPOSES ONLY

#### References
1. **Earlence Fernandes, Amir Rahmati, Jaeyeon Jung, and Atul Prakash. 2017.** *Security Implications of Permission Models in Smart-Home Application Frameworks.* In *IEEE Security & Privacy.*
2. **Behrang Fouladi and Sahand Ghanoun. 2013.** *Honey, I’m Home!!, Hacking ZWave Home Automation Systems.* In *Black Hat.*
3. **Google. 2019.** *Cloud AutoML.* https://cloud.google.com/automl/
4. **Rachel Gunter. 2017.** *Making Sense of Samsung’s SmartThings Initiative.* https://marketrealist.com/2017/12/making-sense-samsungs-smartthings-initiative
5. **Grant Ho, Derek Leung, Pratyush Mishra, Ashkan Hosseini, Dawn Song, and David Wagner. 2016.** *Smart Locks: Lessons for Securing Commodity Internet of Things Devices.* In *Proceedings of the 11th ACM on Asia Conference on Computer and Communications Security.*
6. **IoTBench. 2017.** https://github.com/IoTBench. [Online; accessed 09-October-2018].
7. **Yunhan Jack Jia, Qi Alfred Chen, Shiqi Wang, Amir Rahmati, Earlence Fernandes, Z Morley Mao, Atul Prakash, and Shanghai JiaoTong University. 2017.** *ContexIoT: Towards Providing Contextual Integrity to Appified IoT Platforms.* In *Proceedings of The Network and Distributed System Security Symposium.*
8. **Julian Keilson. 2012.** *Markov Chain Models—Rarity and Exponentiality.* Vol. 28. Springer Science & Business Media.
9. **Changmin Lee, Luca Zappaterra, Kwanghee Choi, and Hyeong-Ah Choi. 2014.** *Securing Smart Home: Technologies, Security Challenges, and Security Requirements.* In *IEEE Conference on Communications and Network Security (CNS).*
10. **Byungho Min and Vijay Varadharajan. 2015.** *Design and Evaluation of Feature Distributed Malware Attacks Against the Internet of Things (IoT).* In *20th International Conference on Engineering of Complex Computer Systems (ICECCS).* IEEE.
11. **Mujahid Mohsin, Zahid Anwar, Ghaith Husari, Ehab Al-Shaer, and Mohammad Ashiqur Rahman. 2016.** *IoTSAT: A Formal Framework for Security Analysis of the Internet of Things (IoT).* In *IEEE Conference on Communications and Network Security (CNS).*
12. **Sukhvir Notra, Muhammad Siddiqi, Hassan Habibi Gharakheili, Vijay Sivaraman, and Roksana Boreli. 2014.** *An Experimental Study of Security and Privacy Risks with Emerging Household Appliances.* In *IEEE Conference on Communications and Network Security (CNS).*
13. **Charith Perera, Arkady Zaslavsky, Peter Christen, and Dimitrios Georgakopoulos. 2014.** *Context-Aware Computing for the Internet of Things: A Survey.* *IEEE Communications Surveys & Tutorials* 16, 1 (2014), 414–454.
14. **Michael Schiefer. 2015.** *Smart Home Definition and Security Threats.* In *Ninth International Conference on IT Security Incident Management & IT Forensics (IMF).* IEEE.
15. **Tara Seals. 2015.** *BlackHat: Critical ZigBee Flaw Compromises Smart Homes.* https://www.infosecurity-magazine.com/news/blackhatcritical-zigbee-flaw-smart/
16. **Amit Kumar Sikder, Hidayet Aksu, and A. Selcuk Uluagac. 2017.** *6thSense: A Context-Aware Sensor-Based Attack Detector for Smart Devices.* In *26th USENIX Security Symposium.*
17. **Amit Kumar Sikder, Hidayet Aksu, and A. Selcuk Uluagac. 2019.** *A Context-Aware Framework for Detecting Sensor-Based Threats on Smart Devices.* In *IEEE Transactions on Mobile Computing.*
18. **Amit Kumar Sikder, Hidayet Aksu, and A. Selcuk Uluagac. 2019.** *Context-Aware Intrusion Detection Method for Smart Devices with Sensors.* US Patent App. 15/729,092.
19. **Vijay Sivaraman, Dominic Chan, Dylan Earl, and Roksana Boreli. 2016.** *Smartphones Attacking Smart-Homes.* In *Proceedings of the 9th ACM Conference on Security & Privacy in Wireless and Mobile Networks.*
20. **Vijay Sivaraman, Hassan Habibi Gharakheili, Arun Vishwanath, Roksana Boreli, and Olivier Mehani. 2015.** *Network-Level Security and Privacy Control for Smart-Home IoT Devices.* In *11th International Conference on Wireless and Mobile Computing, Networking and Communications (WiMob).* IEEE.
21. **Statista. 2018.** *Installed Base of Home Automation/Smart Home Systems in the United States from 2012 to 2017 (in millions).* https://www.statista.com/statistics/286813/installed-base-of-smart-home-systems-us/
22. **Biljana L. Risteska Stojkoska and Kire V. Trivodaliev. 2017.** *A Review of Internet of Things for Smart Home: Challenges and Solutions.* Elsevier.
23. **Darlene Storm. 2016.** *Hackers Demonstrated First Ransomware for IoT Thermostats at DEF CON.* https://www.computerworld.com/article/3105001/security/hackers-demonstrated-first-ransomware-for-iot-thermostats-at-def-con.html
24. **Yuan Tian, Nan Zhang, Yueh-Hsun Lin, XiaoFeng Wang, Blase Ur, XianZheng Guo, and Patrick Tague. 2017.** *SmartAuth: User-Centered Authorization for the Internet of Things.* In *26th USENIX Security Symposium.*
25. **Qi Wang, Wajih Ul Hassan, Adam Bates, and Carl Gunter. 2018.** *Fear and Logging in the Internet of Things.* In *ISOC NDSS.*
26. **Nong Ye et al. [n.d.].** *A Markov Chain Model of Temporal Behavior for Anomaly Detection.* In *Proceedings of the 2000 IEEE Systems, Man, and Cybernetics Information Assurance and Security Workshop,* Vol. 166. West Point, NY, 169.
27. **Amit Kumar Sikder, Z. Berkay Celik, and Leonardo Babun. 2018.** *A Micro-Benchmark Suite to Assess the Effectiveness of Tools Designed for IoT Apps.* https://github.com/IoTBench/

### Performance Metrics
In the evaluation of Aegis, we used six different performance metrics: True Positive rate (TP), False Negative rate (FN), True Negative rate (TN), False Positive rate (FP), Accuracy, and F-score.

- **True Positive (TP) Rate:** Indicates the percentage of correctly identified benign activities.
- **False Negative (FN) Rate:** Refers to the percentage of malicious activities incorrectly identified as benign.
- **True Negative (TN) Rate:** Refers to the percentage of correctly identified malicious activities.
- **False Positive (FP) Rate:** Refers to the percentage of benign activities incorrectly identified as malicious.
- **Accuracy:** The overall correctness of the framework, calculated as the sum of true positives and true negatives divided by the total number of instances.
- **F-score:** A measure of the test's accuracy that considers both the precision and recall of the system. It is the harmonic mean of TP and TN rates.

The performance metrics are defined by the following equations:
\[
\text{TP Rate} = \frac{\text{TP}}{\text{TP} + \text{FN}}
\]
\[
\text{FN Rate} = \frac{\text{FN}}{\text{TP} + \text{FN}}
\]
\[
\text{TN Rate} = \frac{\text{TN}}{\text{TN} + \text{FP}}
\]
\[
\text{FP Rate} = \frac{\text{FP}}{\text{TN} + \text{FP}}
\]
\[
\text{Accuracy} = \frac{\text{TP} + \text{TN}}{\text{TP} + \text{TN} + \text{FP} + \text{FN}}
\]
\[
\text{F-score} = 2 \times \frac{\text{TP} \times \text{TN}}{\text{TP} + \text{TN}}
\]

### Sample Smart App for App Context
One of the features of Aegis is using app context to verify the device states in the Smart Home System (SHS). To build the app context, we used similar static analysis approaches as in prior works [6, 8]. We performed a source-to-sink taint analysis similar to [6] to extract the app context. Additionally, we considered the sources for smart apps proposed in [8, 18].

We then built the abstract syntax tree (AST) and modeled a trigger-action scenario of an app. We tracked the `Subscribe` method to represent the trigger and followed the conditional statements (e.g., `if` and `switch`) to reach the sink. This flow from the entry point (source) to a sink is used to construct the condition of an app, which is then represented in the app context. We collected 150 official Samsung SmartThings apps (available on their website) and created the app context database using this method.

**Listing 3: A code snippet of a sample smart app**

```groovy
input "contact1", "capability.contactSensor", title: "Where?"
input "light1", "capability.light"
name: "Smart Light App",
namespace: "smartthings",
author: "anonymous",
description: "Turn lights on when door is open.",
category: "Convenience",
section("When the door opens/closes...") {
}
section("Turn on/off a light...") {
}

// This is a sample smart light app for Samsung SmartThings
definition(
    name: "Smart Light App",
    namespace: "smartthings",
    author: "anonymous",
    description: "Turn lights on when door is open.",
    category: "Convenience"
) {
    preferences {
        input "contact1", "capability.contactSensor", title: "Where?"
        input "light1", "capability.light"
    }
    def installed() {
        // Initialization code
    }
    def updated() {
        // Update code
    }
    def contactHandler(event) {
        if (event.value == "open") {
            light1.on()
        } else if (event.value == "closed") {
            light1.off()
        }
    }
    subscribe(contact1, "contact", contactHandler)
}
```

**Listing 4: Trigger-Action Scenario of a Sample App**

1. **Trigger:** Contact1
2. **Action:** Switch1
3. **Logic 1:** `contact1 = on`, `light1 = on`
4. **Logic 2:** `contact1 = off`, `light1 = off`

**Listing 5: Generated App Context of a Sample App**

1. **App Context 1:** `contact1 = 1`, `Light1 = 1`
2. **App Context 2:** `contact1 = 0`, `Light1 = 0`

### List of Smart Home Devices Used in Aegis

| Device Type | Model | Description |
|-------------|-------|-------------|
| **Smart Home Hub** | Samsung SmartThings Hub | Works as a central access point for smart home entities. Supports Wi-Fi, ZigBee, and Z-Wave. |
| **Smart Light** | Philips Hue Light Bulb | Uses ZigBee to communicate with other components in SHS. |
| **Smart Lock** | Yale B1L Lock with Z-Wave Push Button Deadbolt | Supports up to 12 different sensors. Uses Z-Wave to connect with other devices. |
| **Fire Alarm** | First Alert 2-in-1 Z-Wave Smoke Detector and Carbon Monoxide Alarm | Provides built-in smoke and CO sensors. Uses Z-Wave to connect with the hub. |
| **Smart Monitoring System** | Arlo by NETGEAR Security System | Offers both live monitoring and still pictures. Uses Wi-Fi to connect with the smart home hub. |
| **Smart Thermostat** | Ecobee 4 Smart Thermostat | Can be configured with sensors. Connects with the smart home hub using Wi-Fi. |
| **Smart TV** | Samsung 6 Series UN49MU6290F LED Smart TV | Connects with the smart home hub using Wi-Fi. |
| **Motion, Light, & Temperature Sensor** | Fibaro FGMS-001 Motion Sensor | Can be configured with different devices simultaneously. Uses Z-Wave to connect with the hub. |

### Detailed Threat Model Used During Aegis Evaluation
To evaluate Aegis, we considered five different threat models (Section 3). We built five malicious apps to represent these threats. Our malicious apps cover several known threats presented by other researchers in [18, 38].

- **Threat 1:** Built a battery monitor app for smart locks that leaks the unlock code via SMS to the attacker. Realized the impersonation attack by unlocking the smart lock as an outsider using the leaked unlock code.
- **Threat 2:** Built an app that injects false smoke sensor data to trigger the fire alarm in the SHS.
- **Threat 3:** Created an app that flickered a smart light in a specific pattern while nobody was in the home.
- **Threat 4:** Developed an app that stopped the smart thermostat for a pre-defined value to perform a denial-of-service attack.
- **Threat 5:** Created an app that could generate Morse code using a smart light while no person was in the room and triggered a smart camera to take stealthy pictures.

Our malicious apps cover several existing attacks on smart home devices presented by the researchers [18, 38]. In Table 5, we mapped our threat models with existing malicious apps presented by the researchers.

### Example of SHS Layout Used During Evaluation
To collect data for Aegis, we set up three different SHS layouts where users replicated their daily activities in a smart home. In Figure 9, the single-bedroom layout of a smart home is shown, which was used to take user data in our emulator. Users clicked on different places in the layout while listing their daily activities in a timely manner. These activities were used to train and test the efficacy of Aegis.

**Figure 9: Single Bedroom Smart Home Layout Used During Evaluation.**

---

This document has been optimized for clarity, coherence, and professionalism.