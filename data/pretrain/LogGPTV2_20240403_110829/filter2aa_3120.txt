流量宝藏
01
目录
•解决数据孤岛
•时效性
背景介绍
•反入侵，防漏洞
•态势感知，主动对抗高级威胁
重点目标
•主机和应用层漏洞发现
实践探索 •挖矿，DN S安全，协议层面的分析
背景介绍
核心思想
•
多层防御体系
•
网络流量雁过留痕
流量安全分析
应用层
主机层
网络层
重点目标
02
重点目标
信息搜集
漏洞探测
漏洞利用
权限维持
持续渗透
网络流量数据
算法层
应用场景
处理层
逻辑架构
•
覆盖多种场景
•
不同的算法适配
重点目标
•
高危行为
•
高危组件覆盖
防漏洞
重点目标
•
木马流量
•
隧道流量
反入侵
实践尝试
03
实践尝试
传统主机安全检测响应EDR系
统，通过Agent方式采集主机日
志、命令操作等信息，然后上报
到控制中心进行策略建模，从而
发现主机入侵威胁。比如高风险
命令注入执行，单纯基于主机端
数据仅能知道发生了什么，若同
时能在流量层面针对这些强特征
命令字进行检测，进一步关联，
就能溯源到攻击者是如何利用的。
此外，流量层的检测能力，也能
 主机安全回溯
主机层发现的告警
流量层感知的网络路径和请求，形成关联
实践尝试
ICMP木马，进程也不会监听
端口，对主机层检测能力提出
更大挑战，由于在协议栈之前
对流量进行劫持处理，主机端
tcpdump也无法抓取。而作为
中间管道，在流量层进行检测
分析，会是更好的补充手段。 
 木马通信
从源主机向目标主机129.226.x.x进行ping操作，可以正常ping通
在目标主机上使用tcp d um p 抓取源主机1 1 5.1 59.x .x 的包，无法抓获
实践尝试
1.高危端口、高危组件和高危服务的对外开放
占据了漏洞攻击的很大部分，靠主动扫描来感
知，存在扫描周期和扫描被屏蔽的问题。
2.通过流量建立相关通信特征的检测，则可以
实现秒级响应。业务高危端口从对外开放到被
探测利用的时间只有45秒，针对资产数量较
多的大中型企业来说，很难在45秒内完成一
轮扫描。
3.网络上的大量扫描和探测会带来误报，结合
出流量关联，则能较好的解决误报问题
高危资产主动发现
实践尝试
1.漏洞扫描一般重点关注在对特征类漏洞
的发现，发送特定构造参数或payload以
触发是否存在漏洞，对于业务层面的不合
规行为或者逻辑类漏洞则覆盖不足，比如
敏感信息明文传输、越权、管理后台类等。
2. 扫描方法基于关键字，灵活性和可维护
性不高。流量分析，可以引入AI算法，模
型可以自动学习页面特征，效果远超过传
统方案。同时，引入正负反馈机制配合AI
模型训练，提升模型识别率。此外这不但
可以监测管理后台的对外开放问题，而且
也可以对存在弱口令的管理后台进行告
脆弱点/ 漏洞主动发现
JS生成的管理页面，若扫描器不能解析JS则不能主动发现
实践尝试
通过分析Mirai僵尸网络的命令与心跳包，提取出
属于Mirai僵尸网络C&C服务器与被控端之间的通
信流量，从而感知Mirai僵尸网络的规模变化
攻击指令：其中开头的"001a"代表攻击指令的长度，
紧接着的"0000001e"代表了攻击的持续时间为30
秒，"1e"之后的"00"代表了攻击的所采用的手法，
根据对大量Mirai样本的逆向，"00"代表了使用
udp进行攻击，后面的"d39fcd91"代表了攻击的目
标IP，之后的几位是攻击的配置项，
"000431343430"代表了攻击所使用的udp包大小
为1400，"070439303033"代表了攻击的目标端
口是9003
 Mirai僵尸网络
Mirai攻击指令示例
Mirai僵尸网络规模
实践尝试
流量特征：在挖矿程序与交换端点进行通讯时，采
用了jsonrpc协议，这点与门罗币挖矿相同，并且
数据包的强特征明显，可以针对数据包中的关键词
或者数据包中的结构进行检测
端口特征：Swarm项目在运行时默认使用1633，
1634，1635这三个端口来进行数据交换
加密流量：能够在握手协议和证书两个层面来做一
些事情。由于挖矿的特殊性，矿池的域名、证书是
不会轻易进行变化的，并且矿池的具有聚集属性，
即越大的矿池集合到的矿机越多，越能够保证收益
的稳定性。所以也可以针对排名较为靠前的矿池进
行域名和证书的收集，添加针对性的检测策略
SWARM挖矿
Jsonrpc协议
实践尝试
三大类域名（黑，白，灰）的明显不同的
统计特征
建立了一套基于AI+规则的DNS隧道流量
检测系统。现网检出的隧道流量大多还是
以正规厂商的DNS隧道及个人测试DNS
隧道工具为主（示例如下表所示）。可以
顺道发现一些与隧道相似（大量乱码域名
请求）的DGA域名
DNS隧道
隧道流量和普通流量信息熵
隧道流量和
普通流量域名编码特征
展望
04
展望
•
加密流量https,quic的解决
思路
•
基于黑特征的检测算法的失效
•
解决方案：接入解密网关；同
时对于某些场景，需要降低对
黑特征、关键字的依赖，综合
利用大数据、AI等手段，构建
基于行为的检测机制，比如木
马主控C&C行为的发现
挑战
THANKS
THANKS