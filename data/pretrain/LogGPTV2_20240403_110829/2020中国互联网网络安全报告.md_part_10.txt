新的DGA算法生成用于下一阶段的控制与命令操作的子域名。新生成的子域名和用
于目标上报的子域名类似，但包括扩展协议内容，增加了数据标识、时间戳、上一
步通信状态、安全产品状态等信息。通信子域名的格式如图2-43所示。
自定义Base64运算
XOR运算（key为范围内的随机值）
key: FLAG 先前DNS .eu-west-1
00 xx - 70 E1 网卡MAC地址XOR d（ o使 m时 用 ain间 M n戳 aD m5作 e运为 算k 注ey 册值 表） MachineGuid 有（ 时 后 数标 间 是 据识 戳 否 时间戳 响 （ 或应 信 值 1息反 ）为馈 0 安 品全 状产 态 .appsync-api . . .e u uu s s- - -w e ea ae s ss t tt - -- 1 22 .avsvmcloud.com
）
0 1 89字节高4位9字节低4位11字节最后1位 12
组合生成随机DGA域名
图2-43 通信子域名的格式(来源：北京启明星辰信息安全技术有限公司)
其中，前8字节为主机标识；第9字节高4位代表在时间戳字段后紧跟着的数据大
小，如果该值为0或1，则表示后面无数据；第9字节低4位到第11字节是DNS查询的
时间戳信息；第11字节最后1位被用作一个标志位，其用于标注前期的DNS请求中
的数据是否已完整传递；最后的字节数据包含安全产品及其状态。这一部分内容会
通过后门自定义的Base64进行编码。
Sunburst后门利用通信子域名进行第二轮DNS查询，C2服务器验证请求数据。
如果数据合法则会返回CNAME的DNS数据给后门，Sunburst后门则用新的C2地址进
入第二阶段的通信。
69
2020年中国互联网网络安全报告
②第二阶段为HTTP/HTTPS隐秘通信
当Sunburst后门获取用于命令与控制的C2地址后，则通过启动新线程调用
HttpHelper类的Initialize方法实现命令与控制，如图2-44所示。Sunburst后门请求方
式设计具有很强的隐蔽性。若请求方式为POST，则该请求将会伪装为检测Windows
证书吊销列表的HTTP请求与C2进行通信；若请求方式为POST外的其他方式，则
该请求将会伪装成为Orion产品的HTTP请求数据与C2通信；若请求方法是GET或
HEAD方式，则在HTTP包的头部中添加“If-None-Match”和编码后的用户ID。
图2-44 初始化HttpHelper(来源：北京启明星辰信息安全技术有限公司)
当C2服务器收到Sunburst后门请求后，将数据伪装成与.net组件相关的正常XML
隐藏在HTTP响应的正文中。后门通过正则表达式从响应正文中提取命令，先对非
HEX字符进行过滤，然后再将它们合并在一起进行HEX解码。代码执行情况如图
2-45所示。
图2-45 代码执行情况(来源：北京启明星辰信息安全技术有限公司)
70
02 网络安全专题分析
分析攻击者的命令数据，第一个DWORD值是响应消息的实际大小，紧跟其后的
是消息内容，包含用于混淆的填充数据。使用消息的首字节进行XOR运算，然后再
对其做DEFLATE解压缩。解压缩后的第一个字符就是控制指令ID号，控制参数由空
格分隔。控制指令具体的执行代码是由HttpHelper.ExecuteEngine函数实现的。控制
指令的功能见表2-1。
表2-1 SolarWinds供应链攻击事件后门控制指令功能（来源：北京奇虎科技有限公司）
序号 命令 详细功能说明
1 Exit 退出核心命令线程
设置延时秒数，第二次触发时，如果第一次设置的时间小于300 s则
2 SetTime
会进行一次加倍延时
收集计算机信息，包含SID、hostname、UserName、Windows 版本、
3 CollectSystemDescription 系统类型、安装日期、注册用户的公司名、注册用户名、系统版本
号、系统目录、系统启动时间、用户代理
4 UploadSystemDescription 根据格式构造HTTP请求
5 RunTask 启动进程
根据进程参数获取进程信息，包含进程ID、进程名、父进程ID、进
6 GetProcessByDescription
程对应用户名
7 KillTask 结束指定PID的进程
8 GetFileSystemEntries 根据参数中的正则表达式列出文件和目录信息
9 WriteFile 解密传入的Base64字符串并写入文件，写入后会触发延时函数保证
10 FileExists 判断指定路径是否存在
11 DeleteFile 删除指定路径
计算给定文件MD5，如果有传入参数（MD5值），则会判断是否相
12 GetFileHash 同。后门具备计算文件HASH与云端HASH的比对校验功能，说明攻
击者对于失陷机器中的文件有精确的搜集需求
13 ReadRegistryValue 读取注册表项的值
14 SetRegistryValue 设置注册表项的名称、类型、路径
15 DeleteRegistryValue 删除注册表项
16 GetRegistrySubKeyAndValueNames 获取所有指定项名称和数据
17 Reboot 设置状态码SeShutdownPrivilege重启
当Sunburst后门执行命令后，使用HTTP包的PUT或POST方法来回传数据，数据
包的头部会设置为"application/octet-stream"或"application/json"。若载荷数据小于或等
于10,000字节，则会转换为JSON数据进行传送；若大于10,000字节则按正常格式进行
发送。载荷内容伪装成SolarWinds合法Orion Improvement Program（OIP）消息，包含
sessionId、userId和steps等内容。攻击者通过C2服务器接收的消息解码得到窃密内容。
71
2020年中国互联网网络安全报告
③第三阶段为攻击的横向移动
Sunburst后门的攻击范围只限于采用Orion平台。因此，攻击者还会选择在部分
受害主机上投放新的攻击载荷，隐蔽安装CobalStrike窃密木马，对受害主机的内网
进行横向移动，扩大攻击范围。
2.4.3 影响分析
（1）影响范围
本次SolarWinds供应链攻击事件目标主要集中在美国，涉及美国政府机构及众
多国际知名企业。受害者范围可从多个维度开展分析。
从公开信息来看，2020年12月14日，SolarWinds公司向美国证券交易委员会
（Securities and Exchange Commission，SEC）提交的文件显示，约有18,000名客
户使用了包含Sunburst后门的Orion平台软件。2021年1月5日，美国联邦调查局
（FBI）、网络安全和基础设施安全局（CISA）、国家情报局局长办公室（ODNI）
以及国家安全局（NSA）发表联合声明，称本次供应链攻击事件的受害者包括近10
个美国政府机构以及多个知名企业。
从公开资产探测的数据情况来看，全球目前暴露在互联网上的SolarWinds Orion
软件使用的IP地址主要集中在美国。探测数据显示我国也有相关IP地址使用Orion软
件，但未发现重要政府机关和企事业单位。
从Sunburst后门DGA算法生成的avsvmcloud.com的子域名解密来看，受害组织涵
盖部分全球知名公司。DGA解密的Windows域部分示例如图2-46所示。
图2-46 DGA解密的Windows域部分示例(来源：北京启明星辰信息安全技术有限公司)
72
02 网络安全专题分析
（2）供应链攻击危害
软件供应链攻击是指通过攻击供应链上游厂商的软件、代码等，从而达到入侵
下游客户目的的攻击形式。此类攻击具有攻击成本低、隐蔽性强、涉及面广、影响
范围大等特点。具体的攻击手法包括源代码库的污染、开发工具的修改、软件更新
或分发阶段入侵等。
近些年，供应链攻击事件高发，例如，2015年苹果Xcode非官方版本恶意代码污
染事件、2017年PyPI第三方软件存储库被污染事件、2017年NetSarang公司的Xshell
远程登录软件后门事件。上述供应链攻击的目标偏向大众化，而本次攻击事件选择
了为政府、军队及国际知名企业提供网络服务的供应商SolarWinds，其所造成的影
响和危害要远大于以往。更重要的是，若攻击组织在微软等科技公司的软件中进一
步拓展攻击，将造成巨大的潜在威胁。因此，SolarWinds攻击事件被认为是目前为
止最严重的供应链攻击事件。
2.4.4 总结
SolarWinds供应链攻击事件被认为是近几年美国最严重的网络攻击事件。本次
攻击事件，一方面攻击影响大、波及范围广，受害者包括美国政府机构以及众多知
名企业；另一方面攻击过程设计精密，后门程序具有良好的攻防对抗、隐蔽通信和
远程控制能力。
在网络空间大安全的时代背景下，国家级APT组织开始把攻击目标指向了防范
更难、影响范围更大的供应链上。针对供应链安全，上游厂商需要加强软件产品的
研发、生产、运维、部署等供应链环节上的安全防护，确保源代码库、开发工具、
软硬件组件等不被植入、篡改或者替换恶意代码。对于使用产品的下游客户，尤其
是政府部门及重点企事业单位，需加强对上游产品的审查工作，建立审查机制、强
化审查流程，提升自身抗供应链攻击能力。
2.5
2020 年网络安全漏洞影响情况分析
2.5.1 Web应用
在2020年“全面推进互联网+，打造数字经济新优势”背景下，数字化经济发展
73
2020年中国互联网网络安全报告
促进了基于互联网的数字化系统和创新应用程序的快速增长。同时由于网络攻击技
术和目标类型的更新，数字化转型后业务安全面临的挑战日益严峻，其中Web应用
程序漏洞仍然是网络攻击的主要入口。
（1）漏洞分类
参照OWASP TOP10对2020年Web应用漏洞进行的分类统计数据，可以看出Web
应用漏洞主要集中在跨站脚本攻击、注入攻击、无效的身份验证、敏感数据泄露4
种类型，占据全部漏洞类型的80.4%，如图2-47所示。
不安全的反序列化，1.8% XML外部实体注入（XXE），1.1%
安全错误配置，8.1%
跨站脚本攻击，34.1%
无效的访问控制，8.6%
敏感数据泄露，10.0%
无效的身份验证，10.1%
注入攻击，26.2%
图2-47 2020年Web应用漏洞数量占比按类型分布情况（来源：新华三技术有限公司）
（2）影响分析
①利用多漏洞组合获取Getshell
2020年，WebLogic仍然被披露存在多个高危漏洞，除了针对T3协议和IIOP（互
联网内部对象请求代理协议）的反序列化黑名单的绕过利用漏洞，Console组件的漏
洞也值得关注。由于WebLogic T3反序列化漏洞的频发，很多用户面向互联网已经
禁用了T3协议，因此攻击者利用T3协议反序列化漏洞的难度增大，攻击者更多地投
入到使用HTTP的Console组件漏洞利用当中。2020年10月，WebLogic补丁中修复了
Console组件命令执行漏洞CVE-2020-14883，但是此Console组件的漏洞需要登录认
证后才能利用，远程攻击者组合利用CVE-2020-14882漏洞可绕过Console组件中的身
份验证最终执行命令接管WebLogic服务器。
在Web应用程序软件的安全迭代更新和用户的安全防护能力不断增强的背景
下，想通过利用一个漏洞直接获取服务器的控制权限将会变得越来越困难，针对
74
02 网络安全专题分析
Web应用程序的漏洞组合利用将会持续增多。
②功能性API认证缺陷带来的威胁
随着REST API的日益普及，REST已成为提供外界服务API最流行的方式，越
来越多的应用程序对外开放API以提供功能调用，但是由于API的设计存在缺陷，
可能会带来较大的安全隐患。SolarWinds Orion API远程代码执行漏洞（CVE-2020-
10148）即攻击者绕过认证访问功能性API导致远程代码执行，最终导致目标环境中
被部署SUPERNOVA恶意软件、Apache Solr文件上传漏洞（CVE-2020-13957）等的利
用，表明功能性API未经身份验证或者认证被绕过带来的安全威胁不容忽视。
2.5.2 操作系统
操作系统漏洞一直是被黑客利用的重灾区。2020年操作系统漏洞总数为2,343
个，较2019年总数（1,996个）增长17.4%。
（1）漏洞分类
操作系统最担心的漏洞便是缓冲区溢出漏洞，如果被黑客利用，容易直接控制
目标系统；同时权限提升、信息泄露、拒绝服务等安全漏洞问题也不容忽视。2020
年收录操作系统相关漏洞2,300余个，其中缓冲区溢出、权限提升、信息泄露等是操
作系统最为突出的问题，如图2-48所示。
其他，18.6% 缓冲区溢出，23.0%
跨站脚本，1.5%
安全措施绕过，1.8%
命令注入，2.3%
资源管理错误，3.3%
输入验证错误，4.6%
代码执行，5.2%
权限提升，21.5%
拒绝服务，7.4%
信息泄露，10.8%
图2-48 2020年操作系统漏洞数量占比按类型分布（来源：新华三技术有限公司）
75