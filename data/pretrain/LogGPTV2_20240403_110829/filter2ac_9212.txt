title:blackhat:asia-21 (Un)protected Broadcasts in Android 9 and 10
We discovered a systemic vulnerability affecting Android version 9, Android version 10, and Android version 11 Developer Preview that allowed third-party apps to spoof certain protected broadcast Intent messages, allowing the sending of unauthorized messages that only the Android system and privileged pre-installed apps should be authorized to send. This (un)protected broadcast vulnerability occurs when an app declares that the system must protect some broadcast Intent message from being sent by other apps, yet --- due to a bug in AOSP --- the system granted that protection only to apps installed at a specific location on the file system. In other words, unless the app is installed at a certain path on the file system, the system would silently not honor these protection requests, leaving the app's broadcast messages unprotected at runtime.Specifically, only vulnerable versions of Android, only pre-installed apps that reside in a priv-app directory (e.g., /system/priv-app/SystemUI/SystemUI.apk) can register protected broadcasts with the system. This leaves apps that are not present in a priv-app directory (e.g., other pre-installed apps or third-party apps installed from the market) unable to have their protected broadcast declarations honored by the system which provides no access control and allows them to be sent by any app co-located on the device.The lack of protection of protected broadcast Intent messages enables unauthorized parties to escalate their privileges where they can send spoofed messages to carry out functionalities, they do not have the capability or authorization to perform. This can be viewed as a confused deputy problem since the process (deputy) receiving the broadcast Intent message acts upon it as if it was from an authorized source. We identified numerous Android vendors and devices that are impacted by this vulnerability where unauthorized apps can exploit vulnerable pre-installed apps to perform highly privileged functionalities, including arbitrary command execution with system privileges, access to the logcat log, and access to Personally Identifiable Information (PII).