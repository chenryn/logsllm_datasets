·134
第6章
告警和配置
135
6.1
告警概述·
135
6.2Trigger 的配置
136
6.2.1
Trigger的状态
"136
6.2.2Trigger的配置步骤
136
IX
---
## Page 12
Zabbix企业级分布式监控系统
6.2.3Trigger 告警依赖….
6.2.4Trigger 正则中的单位….
141
6.2.5Trigger 表达式举例·
6.2.6Trigger 函数
146
6.3添加Actions
151
6.3.1
Actions概述..
151
6.3.2Actions的配置..
152
6.3.3
Conditions的配置
155
6.3.4Operations的功能.….
156
6.3.5告警消息发送的配置·
·156
6.3.6执行远程命令的配置
158
6.4邮件告警配置的实例
6.4.1
1创建Media
160
6.4.2创建用户
161
6.4.3创建Actions
162
6.5自定义脚本告警
6.6邮件告警脚本的配置实例
告警升级的机制…
6.7
169
6.8
告警配置故障排查
172
第2部分
中级部分
第7章监控方式剖析
1.76
7.1Zabbix支持的监控方式..
7.2Zabbix监控方式的逻辑.….
177
7.3Agent监控方式…
177
7.4Trapper监控方式….
177
7.4.1Trapper的配置步骤.
178
7.4.2
Trapper的配置示例
178
7.4.3
使用zabbix_sender发送数据
7.5SNMP监控方式…
180
7.5.1
SNMP概述
180
7.5.2
SNMP协议的运行
181
7.5.3
SNMP协议原理
181
7.5.4MIB简介
X
---
## Page 13
LI
录
7.5.5SNMP的相关术语
7.5.6配置Zabbix以SNMP方式监控
.186
7.6IPMI监控方式
189
7.7JMX监控方式
194
7.7.1JMX在Zabbix中的运行流程
195
7.7.2
配置JMX监控的步骤.
195
7.7.3
安装Zabbix-Java-Gateway
7.7.4
4配置Zabbix-Java-Gateway
·196
7.7.5
监控Java应用程序
196
7.7.6
自定义JMX的Key
197
7.7.7
监控Tomcat
·199
7.7.8
Weblogic的监控..
.200
7.8
命令的执行
.201
第8章
分布式监控
202
8.1
代理架构
.202
8.2
节点架构…
·205
8.3
被动模式和主动模式·
.206
8.3.1被动模式·
.206
8.3.2主动模式
207
第9章2
Zabbix与自动化运维
211
9.1
监控自动化·
211
9.2
网络发现
9.3
主动方式的自动注册
.215
9.3.1功能概述.
215
9.3.2
主动方式自动注册的配置··
.215
9.3.3
使用Hostmetadata·
·219
9.3.4关于自动注册的注意事项
9.4Low level discovery 功能·
.222
9.4.1现实案例需求
224
9.4.2Zabbix客户端配置.
.225
9.4.3Lowleveldiscovery自动发现脚本编写·
.225
9.4.4
自定义Key配置文件..
·227
9.4.5Web页面添加Lowlevel discovery
XI
---
## Page 14
Zabbix企业级分布式监控系统
9.5Zabbix与自动化配置管理工具SaltStack
238
第10章使用的经验和技巧
10.1
如何有效地设置监控告警·
10.2
监控项的使用技巧…
.246
10.3
触发器的使用技巧·
246
10.4
触发器配置·
.247
10.5
谷歌浏览器告警插件
249
数据图断图
10.6
250
第11章
监控案例
.252
11.1
监控TCP连接数
252
11.2
监控Nginx
254
11.3
监控PHP-FPM
256
11.4监控MySQL
260
11.4.1月
用自带的模板监控MySQL
260
11.4.2用Percona Monitoring Plugins 监控MySQL·
265
11.6监控DELL服务器
.272
11.7
监控Cisco路由器
*272
11.8监控VMware
275
第3部分高级部分
第12章性能优化
282
12.1Zabbix性能优化概述.
.282
12.2Zabbix性能优化的依据
·283
12.3配置文件的参数优化
.285
12.4Zabbix的架构优化
.287
12.5
Items工作模式及Trigger的优化·
287
12.6Zabbix的数据库优化
287
12.7
其他方面··
289
第13章
ZabbixAPI的使用
·290
13.1Zabbix API 简介..
290
13.2JSON-RPC
290
XII
---
## Page 15
目
录
13.3ZabbixAPI的使用流程·
293
13.3.1使用API的基本步骤
293
13.3.2如何使用官方文档获取帮助
.293
13.3.3
3用CURL模拟API的使用
294
13.3.4HTTP头部Content-Type设置
296
13.3.5
关于用户认证·
.296
13.3.6
获取主机信息（用Python写的示例）
.297
13.3.7
添加Host.
299
13.3.8删除Host
301
13.4第三方ZabbixAPI模块·
302
第14章使用Zabbix协议
14.1Zabbix协议概述.
.304
14.2Zabbix-Sender协议..
.305
14.2.1Sender数据发送
·.306
14.2.2Server对数据响应的处理
.307
14.2.3Zabbix-Sender的实例
…307
14.3Zabbix-Get协议
.310
14.4Zabbix-Agent 协议.
310
第15章定制Zabbix安装包
313
15.1为什么要定制安装包.
.313
15.2如何定制安装包·
…313
第16章
大型分布式监控案例
.316
16.1
监控系统构建概述·
.316
16.2监控环境架构图
317
16.3架构实现的过程
317
16.3.1硬件和软件需求
16.3.2ZabbixDB的安装
319
16.3.3
安装Zabbix-Server
.325
16.3.4安装Zabbix-GUI.
327
16.3.5
安装Zabbix-Proxy
·332
16.3.6配置Zabbix-Agent..
.335
16.4业务相关的配置
·335
XIII
---
## Page 16
Zabbix企业级分布式监控系统
16.4.1用户的配置·
335
16.4.2业务组的配置·
336
16.4.3监控模板的定制…
336
16.4.4自动发现的配置·
·338
16.5其他需求.
·338
附录A源码安装及相关配置
339
A.1安装Zabbix-Server
339
A.2安装 Zabbix-Agent"
341
A.3关于Zabbix的升级
342
XIV
---
## Page 17
第1部分
基础部分
---
## Page 18
第1章监控系统简介
本章阐述了监控系统的发展历程、监控系统的原理，以及监控系统的实现过
程，对现有的开源监控解决方案进行了综合分析，目的是让读者全面了解监控系
统，让读者更加深入地学习到监控系统的原理，为后面章节的学习做好准备。
1.1为何需要监控系统
在一个IT环境中会存在各种各样的设备，例如，硬件设备、软件设备，其系
统的构成也是非常复杂的，通常由如图1-1所示的模型构成。
上层应用
①类居库：MySQLMariaDB,Oracle,SQLServer,PastgreSQL，Sybase,DB2以及
NoSQL（redismemcahed等
系统类构
①操作系统：LinuxUNIXWndowsMacOS等
②以1化：VMware,KVMxENXenServer等
集群：LVS,KepalivedHAProxyRHCS,F等
底层支持
①网络：网络环境（内网环境外网环境）
硬件：服务器，存储，网络设备等
图1-1
多种应用构成复杂的IT业务系统，保证这些资源的正常运转，是一个公司IT
部门的职责。而要让这些应用能够稳定地运行，则需要专业IT人员进行设计、架
构、维护和调优。在这个过程中，为了及时掌控基础环境和业务应用系统的可用
性，需要获取各个组件的运行状态，如CPU的利用率、系统的负载、服务的运行、
端口的连通、带宽流量、网站访问状态码等信息。而这一切都离不开监控系统。
1.2监控系统的实现
存储分析告警展示部分（服务器端），如图1-2所示。这两部分构成了监控系统的
基本模型。
---
## Page 19
第1章监控系统简介
数据采集的工作模式可以分为被动模式（服务器端到客户端采集数据）和主动
模式（客户端主动上报数据到服务器端）。通常，大多数监控系统应该能同时支持
这两种模式。被动模式对服务器
Server
agent
的开销较大，适合小规模的监控
环境；主动模式对服务器的开销
图1-2
较小，适合大规模的监控环境。
采集数据的协议方式可以分为两种：专用客户端采集和公用协议采集
（SNMP、SSH、Telnet等），如图1-3所示。
对于采集到的监控数据，可以将其存储到数据库或者文本或者其他方式，具
体采用哪一种，应根据实际需求来决定。
怎么规划监控系统的架构设计呢？下面将详细分析。
（Client/Server，客户端/服务器端）架构就足够了，如图1-4所示，这种架构适合
于规模较小、处于同一地域的环境。
专用协议
模式
专用客户端
专用客户端
Agent
Server
Agent
#公用协议
SNMP
2公用协议
被动
HSS
模式
图1-3
图1-4
对于大规模的监控环境，被监控的节点多，且监控类型多，监控产生的数据
和网络连接开销会非常巨大，而且由于跨地域等多种因素，需要分布式的解决方
案，常见的方式为C/P/S（Client/Proxy/Server，客户端/代理端/服务器端）架构（如
图1-5所示)，采用中间代理将大大提高监控服务器端的处理速度，从而能支撑构
建大型分布式监控的环境。
主动
模式
1专用客户端
Server
Proxy
教据存储分析
数据通信
数据通信
Agent
代理数据采集
告警展示
2公用协议
被动
模式
图1-5