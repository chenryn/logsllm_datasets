通过配置 **set obfuscate "true";** 高度混淆内存中的代码绕过。
而对于我们使用域前置的方式，假设profile不进行任何配置，则会告警。如下图
​ 这时通过配置profile中stage的set cleanup "true";即可解决。
​ 这里风起哥将自己编写的profile文件传到了Github上，感兴趣的小伙伴可以自行下载进行个性化配置。
​ **Github:**
# 运维惯性密码
​
在很多时候我们横向拿下主机服务也不一定非要通过正面打漏洞的方式，在某次渗透项目中，我们通过推测运维密码习惯的方式拿下了23台Redis数据库，起初通过配置文件只发现了一个redis数据库密码，但是本机上部署有大量的redis数据库，但是通过对这些redis数据库的端口号与密码分析得到了一个规律。
**zzRedis63902020** 像这个密码，不难猜测密码为前后缀固定格式，中间四位为本机端口号，然后重新组合登录，然后尝试登录，发现确实如此。
​ 然后，懂得都懂。
​
值得思考的是，这样的密码组合方式拓宽权限的方式真的不要太多了。毕竟运维也是人，不可能一个服务一个密码，但是安全管理规定也要执行，所以很多时候就出现了这些富有规律的密码。
​ 所以像此类攻击获取的权限，也许不是防守方人不行，而真的是路不平了吧哈哈哈。
# 行为测绘
​
上面讲解了几个红蓝对抗中常碰到的一些Tips，其实就目前一些地方护网项目来看，与常规渗透的区别也并不是很大，所以上面讲的一些方式可能更加适用于全国HW行动中使用，因为无论是人员水准还是重视程度都差异非常大。
​ **但是不管在日常渗透中还是HW项目中，行为测绘都是非常行之有效的资产测绘手段。**
​ 首先对于梳理企业资产，我们首先需要思考三个W，也就是who? what? where? 字面来看也就是谁的？什么？哪里?
而应用于红队，目前各级护网对于资产归属的划分其实比较严格，例如资产属于总集团还是二级单位或者子公司，是否与集团内网互通？都是需要思考以及确认的点。那么我们首先从who去思考再从what谁和where在哪里去收集，资产的所属单位以及相关的网络信息，例如使用的框架、部署的业务系统、服务、开放的端口、使用的开发语言、域名等等。
​
不同的群体，可能表现出基本的独有的特征，当我们能掌握到这个特征，那么我们就能尽可能识别出这个群体里的所有个体，而这些所谓的行为特征在网络空间测绘里表现出的是这个设备各个端口协议里的banner特征。  
​ 目前在网络空间测绘里常用的通用组件指纹识别形成的指纹库就是利用了通用组件通用的默认配置特征这个“行为”来进行识别的。
​
也就是说，当我们掌握了一定的目标资产特征的时候，就可以根据我们对指纹的理解编写规则更加精准的匹配资产。并且通过资产测绘的方式也可以尽量减少主动扫描被发现的概率，因为一般的目标组织，他的对外业务服务并不会频繁的改动，所以我们得到的信息通常是较为精准的。
​ **这里我们最常提取的特征像favicon图标hash码，HTTPS证书序列号，前端代码段，服务连接banner等。**
​ 例如我们去做漏洞应急，以exploit-db上的公开漏洞举例。
​ 该举例漏洞为国外的一个WIFI摄像头设备的未授权RCE漏洞，我们可以看到公开的漏洞POC中得到了两个关键信息，该漏洞是通过连接目标设备telnet
23端口，因为default用户登录未鉴权导致。所以我们通过提取 **port:23 +"goke login:"** 这两个特征作为指纹关联受影响的资产。
​ **通过Kunyu关联资产，发现全网共有318台脆弱资产。**
​
同样对于内网中的一些隐秘资产也可以采取HOSTS碰撞的方式。这种方式也是源于在企业内网中可能使用了很多Nginx反向代理，仅能使用配置好的ServerName的内网域名进行访问，那么我们在外网使用HOSTS碰撞的方式就可以碰撞出很多仅能内网使用的业务平台，直通内网业务！
​ 这里仅做抛砖引玉的作用，更高效的企业资产收集方式可以关注 **Kunyu(坤舆)** 的使用。
**[knownsec/Kunyu: Kunyu, more efficient corporate asset collection
(github.com)](https://github.com/knownsec/Kunyu)**
# 后记
​
再次感谢各位读者的支持，我一直觉得写文章是一件很有意思的事，把自己所学的，总结的经验以文字的形式传递下去，我最初的想法也是如此，我认为哪怕只有一位师傅看到我的文章后觉得有所收获，那么我觉得我所做的就不是没有意义的。
​ 本文作为红队攻防系列的续章，大概也是末章。在我的TODO中，之后会发布一篇 **新型网络犯罪攻防研究**
对这个方向从攻击思路、情报研究到研判分析进行深入讲解，敬请期待。
​
Kunyu（坤舆），后期持续维护更新，目前已经着力于结合测绘数据进行深度信息收集，并且后续会将更新点着力于此。同样应用于打击新型网络犯罪中也有显著效果，会在之后的文章以实战的方式展示给大家。
​
**其实最近风起的心情非常不错，因为我有了一个可爱的学霸女朋友，她叫知之，我也喜欢叫她吱吱。同样也是我的初恋。我们之间非常有缘分，真的就是我心目中的理想女友，希望我们能够天长地久，她也会是我奋斗的动力，有机会一定介绍给大家认识。**
​ **最后祝大家心想事成，美梦成真！**
# Community
有想要认识一下，或者交流技术的同学，可以通过以下方式联系作者:
欢迎大家来了解一下，WgpSec狼组安全团队：