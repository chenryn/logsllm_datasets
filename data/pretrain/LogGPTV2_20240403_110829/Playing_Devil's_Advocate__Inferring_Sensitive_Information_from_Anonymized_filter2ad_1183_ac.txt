128.220.231.207
128.220.231.50
128.220.231.168
128.220.231.121
Dest.
Real
address H hostname
simnet1
skdnssec
0.93
0.93
0.87
0.85
spar
-
Table 3. Deanonymization of signiﬁcant Web
servers in local network trace
the main campus network.
It contains packets from over
26,000 TCP connections involving 38 internal hosts and
more than 1,500 external hosts. The topology inference
technique indeed ﬁnds a single observation point with sub-
nets of 128.220.231.0/24 and 128.220.116.0/26. These
subnets are the two anonymized subnets present within the
trace, which is correct given the location of the observation
point just outside of the departmental network. The infer-
ence technique also ﬁnds one router and one gateway that
are directly connected to one another, with the departmental
network behind the router. The routes discovered are trivial
considering the topology of the observation point.
We can also deanonymize many of the web servers
within the departmental network. To ﬁnd the web servers
in this database, we must ﬁrst create an estimate of the be-
havioral proﬁle for which we are looking. Table 2 shows
example behavioral proﬁles for three ‘heavy-hitters’, found
via Algorithm 1, in the department’s network.
Because all the web servers in the trace have behav-
ioral proﬁles with similar TCP ports and destination IP ad-
dresses, we must use the normalized entropy of the desti-
nation IP addresses to distinguish between the web servers
based on their popularity. More popular servers communi-
cate with a wider range of clients, and thus have a higher
normalized entropy (H) for their destination addresses. To
ﬁnd the names of the most popular web servers in the de-
partmental network and to estimate their relative popular-
ity, we use Alexa.com’s popularity-based search engine.4
By counting the number of references made to each host-
name over the ﬁrst l(= 5) pages of results, we arrive at
the following ordered ranking of web servers: (cid:104)simnet1: 30,
skdnssec: 11, spar:9(cid:105).
The rankings provide strong indication that there are ap-
4See http://www.alexa.com
7
Trace
JHU
CERT-A
CERT-B
LBNL
Type
Connections
Internal Hosts
packet trace
NetFlow
NetFlow
packet trace
2.63e+04
1.04e+05
1.40e+05
8.71e+05
38
20
24
5976
Dates
Apr 2005
Aug 2006
Aug 2006
Oct 2004 - Jan 2005
Duration
24 hr
4 hr
4 hr
60 hr
Table 4. Summary information for anonymized datasets
proximately three signiﬁcant web servers within the depart-
mental network. Due to their popularity, it is appropriate to
assume that the normalized entropy of the destination ad-
dresses they service will be nearly one, indicating a large
variety of hosts. By querying the behavioral proﬁles derived
from the local trace data for a web server with a destination
address normalized entropy greater than γ = 0.85, we ob-
tain the list of anonymized addresses shown in Table 3.
By pairing the ranking of web server addresses in the
departmental subnet found via behavioral proﬁle to the
three hostnames found via the Alexa.com search, we ob-
tain the correct mapping between the real hostnames and the
anonymized addresses, which are veriﬁed by our original,
unanonymized trace. This mapping is given in the last col-
umn of Table 3. Overall, we are able to deanonymize three
of the seven signiﬁcant web servers in the trace (43%), and
two of the three mail servers (66%). Moreover, these map-
pings have correctly deanonymized one of the discovered
anonymized subnets to 128.220.247.0/24, thereby reduc-
ing the uncertainty of the remaining anonymized hosts.
5 Evaluation
Our inference techniques are evaluated on network traces
for three distinct networks, including the Johns Hopkins
network described in Section 4. Table 4 provides a break-
down of each dataset. The anonymized dataset provided by
Pang et al. [19] is the most diverse, and contains packet
traces that were collected at Lawrence Berkeley National
Laboratory (LBNL) over the course of several months. The
LBNL traces are arranged into 131 individual trace ﬁles
anonymized by the system described in [20, 19]. Several
network and transport layer protocols are present within the
anonymized trace data, which include only the anonymized
link, network, and transport layer headers. Payload data is
deleted, and ﬁelds are anonymized per the policy deﬁned
in [19]. Pang et al. also remove the packets generated by
routers and certain security devices to prevent their discov-
ery. In addition to the anonymized trace data, Pang et al.
provide meta-data to ensure sound measurement practices.
This meta-data includes the identiﬁcation of anonymized
subnets, anonymized gateway addresses for those subnets,
and corrupt packets. This meta-data is used in our evalua-
tion only to provide a form of ground truth for our analysis.
One solution to preventing the inference of topology in-
formation is to simply publish NetFlow logs, a data format
consisting of tuples of transport and network layer infor-
mation gathered from packet headers on a per connection
basis, rather than complete packet traces. In fact, release of
anonymized NetFlow data is gaining popularity and there-
fore it seems only prudent that we validate our techniques
against both NetFlow and packet trace data. To show the
viability of our techniques on NetFlow data, we also evalu-
ate a dataset obtained from CERT containing NetFlow logs
of two distinct /24 networks taken over four hours on a
single day. To anonymize this NetFlow data, we apply
preﬁx-preserving anonymization of addresses (as speciﬁed
by Pang et al. in [19]), remove connections of less than four
packets in size to compensate for scanning behavior, and ex-
plicitly remove references to routers and network security
devices. Since this is NetFlow data, topology inference is
not possible, but we are able to apply our deanonymization
techniques just as in the LBNL dataset.
To streamline our analysis of these datasets, we parse
packet trace or NetFlow logs and automatically dump all
information about the connections (C), the ‘heavy-hitter’
hosts, topology information, and their behavioral proﬁles
into a relational database for fast and easy querying. The
database can then be queried for the features of the behav-
ioral proﬁle, the normalized entropy values, speciﬁc con-
nection information to deanonymize hosts, etc. Hence, no
active probing of the network under scrutiny is necessary.
5.1 Network Topology
To infer the network topology of LBNL, we employ the
techniques described in Section 4. Our techniques ﬁnd
29 distinct observation points with a total of 31 associ-
ated enterprise subnets. The subnets found through the
Subnet Clustering technique agreed with those provided in
the meta-data, with the exception of one subnet whose size
was overestimated, thereby providing 96% accuracy. This
overestimate appears to have occurred due to an improper
estimate of the longest common preﬁx computed from a
small number of distinct addresses within the ARP trace
data. Interestingly, the anonymization system used to pro-
vide privacy for the LBNL data makes extra effort to mask
8
(a) Uniqueness of the ee.lbl.gov subnet
(b) Deanonymization results for 3 networks
Figure 1. Deanonymization
the presence of routing devices by eliminating their traf-
ﬁc. Our inference techniques, however, are able to infer
their positioning due to the necessary presence of hardware
addresses in link layer headers. When combined with ad-
ditional information—like the placement of hosts and al-
lowed routes—maps of the network topology provide at-
tackers with information on the security posture of the pub-
lishing organization.
5.2 Deanonymization
To demonstrate the effectiveness of behavioral proﬁles
in the selective deanonymization of anonymized hosts, we
provide a deanonymization of the HTTP server for the Bro
IDS project [29] and other servers within its subnet, in-
cluding ee.lbl.gov. We pick these targets as candidates
for deanonymization since public information about these
servers is readily available—and hence, can be easily used
to unmask the anonymization.
We begin by querying DNS records for the addresses
of the Bro web server (www.bro-ids.org) and related hosts
found in public information sources. The results of these
queries show that www.bro-ids.org resides in the same sub-
net as the ee.lbl.gov domain, which includes SMTP, HTTP,
and FTP services on ee.lbl.gov and HTTP services on
ita.ee.lbl.gov. Knowledge of these services was gleaned
only from Google and Alexa searches, as well as DNS
records for the ee.lbl.gov and bro-ids.org domains.
By inferring the subnet size from the addresses provided
by DNS records, the set of possible subnets within the trace
data is reduced to ten /22 subnets out of the twenty nine total
subnets (see Figure 1(a)). Furthermore, if we consider that
the target subnet contains at least three ‘heavy-hitter’ web
servers, we ﬁnd six subnets in the dataset that match this cri-
teria. Finally, by noting that the ee.lbl.gov server provides
SMTP, HTTP, and FTP services, we ﬁnd only two subnets
that contain such a server. By combining each of the charac-
teristics of our target subnet, only one of the subnets present
in the dataset matches all criterion. In essence, the combi-
nation of required subnet size, unique services offered by
ee.lbl.gov, and the speciﬁc mix of signiﬁcant HTTP servers
ﬁngerprints the subnet within the anonymized trace.
Since the ee.lbl.gov server provides such a unique mix
of services, it is fairly easy to detect among the signiﬁcant
hosts present in the subnet. The two remaining signiﬁcant
HTTP servers exhibit similar behaviors, except with respect
to the normalized entropy for the destination address di-
mension. Thus, one host serves a wider variety of clients
than the other. Due to the nature of the www.bro-ids.org
and ita.ee.lbl.gov web servers and their respective presence
within web search engines, it seems reasonable to assume
that www.bro-ids.org serves a wider variety of hosts while
ita.ee.lbl.gov has a more narrow appeal.
Another HTTP server within this subnet handles only
a few distinct clients, but serves a large number of con-
nections overall. These connections carry relatively few
packets, thus indicating the presence of a web page or ap-
plication that performs several small HTTP connections to
retrieve data. Upon inspection of the Google results for
the ee.lbl.gov domain, we suspect this machine might be
froggy.lbl.gov. The Froggy site features a CGI web applica-
tion which generates short bursts of HTTP connections as
a function of the CGI usage. Table 5 provides some sam-
ple deanonymization results for various publicly available
services, including www.bro-ids.org. The deanonymiza-
tions are supposition, as there is no ground truth avail-
9
 	









  !"#$%&'()*+,-./01"$/%+2JHU - TotalJHU - KnownEE.LBL - TotalEE.LBL - GuessedCERT.A - TotalCERT.A - KnownCERT.B - TotalCERT.B - KnownHTTPMAILServer Type051015Number of ServersJHUJHUEE.LBLEE.LBLCERT.ACERT.ACERT.BCERT.BTarget Host
Candidate
Mappings
www.bro-ids.org
131.243.95.232
ita.ee.lbl.gov
131.243.93.0
ee.lbl.gov
131.243.94.172
Search
Criteria
CIDR Block = 131.243.0.0/16
Source Port=HTTP
( ¯H) = ( .5, > .5)
Same subnet as ee.lbl.gov
CIDR Block = 131.243.0.0/16
Source Ports=HTTP, SMTP, FTP
( ¯H) = (> .1, > .5, > .5)
co-located w/ ita.ee.lbl.gov,www.bro-ids.org
Auxiliary
Information
Knowledge of
HTTP, DNS A records
Public subnet info.
Knowledge of
SMTP, DNS A records
Public subnet info.
froggy.lbl.gov
131.243.95.168
CIDR Block = 131.243.0.0/16
Source Port=HTTP; same subnet as ee.lbl.gov
Knowledge of
HTTP protocol
lbl.gov
128.3.164.249
smtp.lbl.gov
128.3.164.248
postalnp.lbl.gov
imap4.lbl.gov
128.3.164.57
128.3.164.15
or
128.3.164.194
CIDR Block = 128.3.0.0/16
Source Ports=SMTP, ﬁnger
co-located w/ postalnp.,imap4.,smtp.lbl.gov
CIDR Block = 128.3.0.0/16
Source Port(s) = SMTP
co-located w/ lbl.gov, imap4.lbl.gov
CIDR Block = 128.3.0.0/16
Source Port(s) = IMAP, POP3
Same subnet as lbl.gov
DNS MX records,
Mail info,
public web/subnet info.
DNS MX records,
Mail, public
subnet info.
Public web info.
Table 5. Sample deanonymizations of select public services
Dataset
JHU
CERT-A
CERT-B
Observation Point
JHU
CERT-A
CERT-B
Routing Core
ee.lbl.gov
LBNL
Client Network
Dominant Source Ports
22 (SSH), HTTP (80)
20 (FTP), 21(FTP), 25 (SMTP), 53 (DNS), 80 (HTTP), 443 (HTTPS)
25 (SMTP), 53 (DNS), 80 (HTTP)
161 (SNMP)
22 (SSH), 80 (HTTP), 123 (NTP),
137 (WINS), 161(SNMP), 427 (SRVLOC),
515 (LPR), 524,793,795-800 (Unknown)
22 (SSH), 25 (SMTP), 67 (BOOTP), 68 (DHCP),
80 (HTTP), 137 (WINS), 138 (NetBIOS), 139 (NetBIOS),
161 (SNMP), 427 (SRVLOC), 445 (Microsoft-DS), 497 (Unknown),
548 (Apple Filesharing), 575:696:878 (Unknown)
Table 6. Dominant source ports for selected observations points
able, but the supporting evidence provides conﬁdence in our
deanonymization results.
For the JHU and CERT datasets, we are able to provide
a similar method of deanonymization by mapping behav-
ioral proﬁles of true hosts to their anonymized counterparts;
more importantly, we can validate these deanonymiza-
tions via ground truth.
Figure 1(b) shows our overall
deanonymization performance across the four datasets. For
each trace, the results show the number of deanonymized
servers for each protocol (“known” or,
in the case of
ee.lbl.gov, “guessed”) compared to the total number of sig-
niﬁcant servers for that protocol.
It was initially believed that information leakage attacks
of the kind presented herein were too difﬁcult for an ad-
versary to achieve in practice [19]. However, our results
indicate that behavioral proﬁling is a plausible method for
deanonymizing a variety of network traces. Our success rate
ranged from 66% to 100% for signiﬁcant SMTP servers and
28.6% to 50% for the signiﬁcant HTTP servers in the sub-