would have performed had it been chosen by the underlying
routing when queries were sent to anycast address a.
(a) C-root
(b) K-root
4.1 Selecting unicast representatives
Unicast IP addresses used for management of individual
replicas are published for C-, K-, and L-root.5 For these, we
pick one address per site as the unicast representative ad-
dress for that site. We will still evaluate below whether this
management address operates as a representative, since the
network could be engineered to route management traffic
very differently from real queries.
Other root DNS servers (e.g., D-root[35]) locate replicas
at Internet eXchange Points (IXPs). Packet Clearing House
(PCH) operates route collectors at more than 150 IXPs, and
releases the BGP routing tables collected from these route
collectors [36]. These routing tables provide us with other
(unicast) prefixes that are reachable at the IXP, and we choose
an address from the smallest unicast prefix at an IXP as the
unicast representative of the colocated anycast site.6
4.1.1 Goodness of unicast representative. Using the method
just described, we selected unicast representatives for C-, D-,
K- and L-root.7 In this section, we evaluate how well these
addresses represent their anycast sites. We compare both
the measured latency and the path overlap between unicast
5F-root publishes management addresses too, but only for replicas that are
not hosted by Cloudflare.
6E-root also uses PCH and does not publish management addresses, but
recently also started distributing via Cloudflare, making this technique of
IXP-based representatives incomplete for E.
7We omit evaluation results from L-root for space. The results for unicast
representatives of L-root are similar to those of K-root. .
(c) L-root
Figure 5: Distribution of RIPE-Atlas queries over ad-
ditional distance (compared to their closest sites) trav-
eled.
routing properties nor balances load across sites effectively.
In this section, we isolate the performance deficit into what
can be attributed to routing of anycast prefixes, typically
caused by choosing a poor site, and what can be attributed
to unicast BGP policies and peering. Intuitively, BGP may
create circuitous paths that have longer latency than the geo-
graphic distance between endpoints would require [50], and
adding anycast allows the selection not only of a circuitous
path, but one that does not even lead to a nearby replica. In
this section, we compare these two sources of path inflation.
Suppose source s sends a query to anycast address a for
a query; this query reaches site Ss→a. Our general plan is
65
 0 20 40 60 80 100< 0.50.5 ~ 11 ~ 1.51.5 ~ 22 ~ 2.52.5 ~ 33 ~ 3.53.5 ~ 44 ~ 4.54.5 ~ 5≥ 5Queries (%)Extra Distance (103 KM)AllEUUSOther 0 20 40 60 80 100< 0.50.5 ~ 11 ~ 1.51.5 ~ 22 ~ 2.52.5 ~ 33 ~ 3.53.5 ~ 44 ~ 4.54.5 ~ 5≥ 5Queries (%)Extra Distance (103 KM)AllEUUSOther 0 20 40 60 80 100< 0.50.5 ~ 11 ~ 1.51.5 ~ 22 ~ 2.52.5 ~ 33 ~ 3.53.5 ~ 44 ~ 4.54.5 ~ 5≥ 5Queries (%)Extra Distance (103 KM)AllEUUSOtherSIGCOMM ’18, August 20–25, 2018, Budapest, Hungary
Zhihao Li, Dave Levin, Neil Spring, and Bobby Bhattacharjee
(a) C-root
(b) D-root
(c) K-root
Figure 6: Unicast representatives show latency performance similar to the anycast site they represent. The “Any-
cast” line shows the difference in latency between a single sample of anycast and the median, as a baseline for
comparison. The darker line labeled “Unicast” shows the difference between a measurement of the unicast repre-
sentative and median of anycast samples.
representatives and anycast sites. Recall that the RIPE Atlas
probes query DNS root replicas and collect periodic tracer-
outes. Each of these measurements provides data about a
single site per root. We augmented these probes to also mea-
sure the latency to the unicast representative of the anycast
site chosen, and perform corresponding traceroutes.
The following results show the comparison of the latency
and path to the anycast site via its anycast address and to
the representative of the chosen anycast site via the uni-
cast representative address. This comparison shows that the
representative addresses are not routed in a way that system-
atically degrades (or improves) their performance. However,
it is necessarily the case that the representative address is
in a different prefix than the anycast address, and thus may
experience different BGP-level path selection.
Figure 6 shows how latency to the unicast representative
differs from the latency to the anycast address for C-, D-, and
K-root. L-root, not shown, was similar to K-root.
From RIPE’s built-in DNS CHAOS query measurements,
we know which probe uses which site. (We confirmed that
the affinity of a probe to a site is stable during measurement.)
We assign probes to measure the unicast representative ad-
dress corresponding to the site it used, so a different number
of probes may be used to measure different sites. For each
root, we aim to use about 2000 probes to measure their cor-
responding anycast sites and unicast representatives. We
distribute those probes across sites, limiting to at most 200
probes per site for C and D, 30 probes per site for the larger K
and L. Some sites will see measurements from fewer probes
if too few probes use that site for anycast.
From each probe, we send traceroutes to both the anycast
address and to the unicast representative of the chosen site;
these will allow us to compare the AS paths. We obtain the la-
tencies from a probe to the anycast address and to the unicast
representative address. To account for ordinary variance in
66
C-Root
Sites
bts
fra
iad
jfk
lax
mad
ord
par
qro
sin
%
Agree
90.7%
91.8%
92.9%
91.7%
91.8%
85.9%
95.7%
81.4%
100.0%
96.5%
D-Root
Sites
abva
amnl
chil
ffde
hkcn
louk
paca
tojp
viat
zuch
%
%
K-Root
Sites
at-vie
bg-sof
ch-gva
cl-scl
Agree
Agree
69.0%
96.2%
86.2%
96.1%
83.3%
97.3%
92.4%
52.3%
80.0% de-ham 96.4%
81.8%
95.5%
65.5%
99.4%
95.8%
73.3%
70.8%
96.6%
84.9%
70.0%
es-bcn
fr-par
rs-beg
us-ric
za-jnb
Table 1: AS path agreement between unicast represen-
tatives and sites; ten sites per letter are shown.
routing, we also obtain the median anycast latency from the
probe to the anycast address during the one-hour window
(leveraging RIPE’s built-in ping measurements). In Figure 6,
we compare the differences of our one-time measured laten-
cies to the median anycast latency. The comparison from
individual anycast measurement to median indicates a base-
line (blue); the comparison between individual measurement
to the unicast representative to the median anycast is a mea-
sure of representativeness (red).
The traceroute data from the RIPE Atlas probes allow us
to evaluate the similarity in AS level paths to anycast sites
versus unicast representatives. We use the method described
below in §4.2 to infer AS level paths from traceroutes.
Table 1 shows a sample of sites from different roots and
the fraction of the AS path that matches. Unicast representa-
tives show a close match overall, with over 90% for C, 90% for
D, 75% for K matching the AS paths. The AS path matches
for C- and D-root were better than for K- and L-root. One
difference between the two is C-root and D-root have single
hosting ASes (Cogent and PCH) from which unicast repre-
sentatives are drawn, while K-root and L-root have different
 0 0.2 0.4 0.6 0.8 1-20-15-10-5 0 5 10 15 20Cumulative Fraction  of ProbesDifference relative to  median anycast latency (ms)UnicastAnycast 0 0.2 0.4 0.6 0.8 1-20-15-10-5 0 5 10 15 20Cumulative Fraction  of ProbesDifference relative to  median anycast latency (ms)UnicastAnycast 0 0.2 0.4 0.6 0.8 1-20-15-10-5 0 5 10 15 20Cumulative Fraction  of ProbesDifference relative to  median anycast latency (ms)UnicastAnycastInternet Anycast: Performance, Problems, & Potential
hosting ASes at different sites. Recall that we do not expect
complete agreement, since unicast and anycast addresses are
in different prefixes that may be routed differently.
4.2 AS path inference
Section 3 shows that anycast is choosing poorly. When we
compare the path to the chosen anycast site to a path to
the representative address of (what should be) a better site,
we can determine where the two paths diverge. It is at this
“decision point” that route selection failed: although there is
a direct path to a representative address at a nearby site, a
distant site was chosen.
We must locate the “decision point” in both geography
and in the AS graph. By locating it in geography, we can
infer which might be the geographically closest site to that
decision point, even if it isn’t the better site reached. By
locating it in the AS graph, we can infer which of the two
next-hop autonomous systems was not selected, which could
be due to explicit policy or simple tie-breaking.
The first step in recognizing the decision point is to infer
AS-level paths from IP-level paths obtained from RIPE Atlas
traceroutes. Direct use of BGP routing tables, as applied in
CAIDA’s prefix-to-AS mapping [9], is challenging because of
missing hops and multiple-origin conflicts. Here we describe
how convert the traceroute path into an AS path suitable for
comparison with other paths.
Mao et al. [29] proposed a heuristic method to improve
IP-to-AS mapping. They collected traceroute and BGP tables
from the same set of vantage points, and identified process-
ing steps over the sequence of IP addresses necessary to
construct a match to the reference path from BGP. Their
approach would allow those without access to the BGP data
at a particular location (e.g., at RIPE Atlas probes) to infer the
BGP path associated with a readily-measurable traceroute
path. Particularly, we adopted the following four steps:
• If an unresponsive/unresolved IP hop from traceroutes
is between of two hops that map to the same AS, we
assume the unmapped hop belongs to the same AS as the
surrounding AS hops.
• If an unresolved IP hop is in between hops that map to
different ASes, use the domain name of the unresolved IP
hop, if available, to associate it with a neighboring AS.
• Identify prefixes that belong to IXPs. IP addresses assigned
to IXPs may appear in traceroutes and thus introduce an
extra AS hop relative to the corresponding BGP AS paths.
We identify such hops and remove them from inferred AS
path. Nomikos and Dimitropoulos provide a tool [34] to
collect IP prefixes assigned to IXPs. They collect data from
PeeringDB and PCH, including prefixes for over 1000 IXPs.
Using this dataset should yield better detection accuracy
than the algorithm for IXP detection used in [29].
SIGCOMM ’18, August 20–25, 2018, Budapest, Hungary
• Detect multiple origin ASes (MOAS). Once found a MOAS
hop, we map it to a set of ASes. For the rest of the paper,
we include these traceroutes in our comparison with other
traceroutes. We consider these traceroute hops “match”
with the corresponding hop in other traceroutes if the AS
in the other path matches any one of the ASes associated
with the MOAS hops.
Mao et al.[29] evaluated their IP-to-AS mapping algorithm.
Only about 72% of traceroutes matched the corresponding
BGP AS paths with basic IP-to-AS mapping using BGP tables.
By applying these four steps to resolve the unmapped IP
hops and IXP addresses, the matching rate increased to over
80%. Therefore, we expect that applying these processing
steps will match the AS path with 80% accuracy, and that, in
turn, this overall measure of agreement is a lower bound on
the accuracy of suffixes of the path (after the decision point).
We do not consider traceroutes that cannot be completely
resolved: if an unresponsive or unresolved IP hop lies be-
tween two different ASes, we abandon the comparison to
other paths in the group we analyze below; this affects at
least one traceroute from 20% of the probes for C and D
root and from nearly half of the probes measuring K root,
described in more detail below in §4.4.
4.3 Anycast and unicast path inflation
Unicast routing is subject to path inflation in which the path
taken is longer than necessary. Spring et al. [50] decomposed
path inflation into topology and policy at the intra-domain,
peering, and inter-domain levels, where each layer could add
to the path distance either by incomplete topology (the lack