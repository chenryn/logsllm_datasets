title:Exact temporal characterization of 10 Gbps optical wide-area network
author:Daniel A. Freedman and
Tudor Marian and
Jennifer H. Lee and
Ken Birman and
Hakim Weatherspoon and
Chris Xu
Exact Temporal Characterization of
10 Gbps Optical Wide-Area Network
Daniel A. Freedman§‡, Tudor Marian§, Jennifer H. Lee†,
Ken Birman§, Hakim Weatherspoon§, Chris Xu†
§Department of Computer Science, Cornell University, Ithaca, New York, USA
‡Department of Physics, Cornell University, Ithaca, New York, USA
†Department of Applied and Engineering Physics, Cornell University, Ithaca, New York, USA
ABSTRACT
We design and implement a novel class of highly precise net-
work instrumentation and apply this tool to perform the ﬁrst
exact packet-timing measurements of a wide-area network
ever undertaken, capturing 10 Gigabit Ethernet packets in
ﬂight on optical ﬁber. Through principled design, we im-
prove timing precision by two to six orders of magnitude over
existing techniques. Our observations contest several com-
mon assumptions about behavior of wide-area networks and
the relationship between their input and output traﬃc ﬂows.
Further, we identify and characterize emergent packet chains
as a mechanism to explain previously observed anomalous
packet loss on receiver endpoints of such networks.
Categories and Subject Descriptors
C.2.5 [Computer-Communication Networks]: Local &
Wide-Area Networks—Ethernet, High-speed, Internet; C.4
[Performance of Systems]: Measurement techniques, Per-
formance attributes
General Terms
Experimentation, Measurement, Performance, Reliability
Keywords
Wide-Area Network, Optical Network, 10 Gbps, Ethernet
1.
INTRODUCTION
In this work, we advance the state-of-the-art in Inter-
net measurement by presenting the design, implementation,
and application of a novel form of precise instrumentation
— BiFocals — that allows for the exact characterization
of network traﬃc in ﬂight. In addition to introducing our
methodology, we employ BiFocals to empirically charac-
terize a particular wide-area network path: a 15 000 km
Permission to make digital or hard copies of all or part of this work for
personal or classroom use is granted without fee provided that copies are
not made or distributed for proﬁt or commercial advantage and that copies
bear this notice and the full citation on the ﬁrst page. To copy otherwise, to
republish, to post on servers or to redistribute to lists, requires prior speciﬁc
permission and/or a fee.
IMC’10, November 1–3, 2010, Melbourne, Australia.
Copyright 2010 ACM 978-1-4503-0057-5/10/11 ...$10.00.
static route across the 10 Gbps National LambdaRail op-
tical backbone [22]. We focus our measurements upon inter-
packet timings, a fundamental metric of traﬃc ﬂows from
which many secondary characteristics can be derived (jitter,
link capacity, etc.) [23]. Further, inter-packet timings are
independently important as a practical metric [5, 2, 6, 9, 16].
Our measurements of National LambdaRail (NLR) shed
light on the puzzling phenomenon of anomalous wide-area
network (WAN) packet loss that we recently observed [20]:
even low to moderate data rates across a WAN can provoke
endpoint receiver packet loss, although the same endpoint
can service such data rates within a local-area network. As
we show, when a ﬂow traverses a WAN, the routers perturb
inter-packet spacing to such an extent that, within a few
hops, a ﬂow that entered the network with large, ﬁxed inter-
packet spacing has degenerated into a series of packet chains
(see Figure 1). We observe this phenomenon on an otherwise
lightly loaded WAN, irrespective of input data rate.
Internet traﬃc has already been shown to be bursty [14].
However, the presumption within the ﬁeld is that suﬃcient
burstiness to cause packet loss does not arise in networks
with ample excess bandwidth. Thus, the key surprise in
our study is the emphatic ﬁnding that this is not true here:
an input ﬂow, with packets homogeneously distributed in
time, becomes increasingly perturbed, so that the egress
ﬂow is transformed into a series of minimally spaced packet
chains. Packets within the chain have miniscule gaps, while
the chains themselves are separated by huge idle gaps. For
example, an ideal inﬂow, with constant data rate of 1 Gbps,
degenerates into an extremely bursty outﬂow with data rates
surging to 10 Gbps for short periods of time. Not surpris-
ingly, these can trigger packet loss even in core network
routers, and such surges can easily overwhelm an endpoint.
We should pause to explain why this matters. First, a
wide range of protocol and application research implicitly
assumes that it makes sense to measure networks with soft-
ware running on end-hosts (tomography, Internet coordi-
Figure 1: Illustration of the perturbation of the time distri-
bution of packets between homogeneous input to, and com-
pressed output from, a wide-area network.
342nates, various quality-of-service schemes, etc.). Our work
provides “ground truth” properties of the WAN and con-
tests this notion, demonstrating that previous timing char-
acterizations could be susceptible to distortions on end-host
receivers, which dwarf both ﬁne and coarse structure.
Second, many protocols assume, more or less, that if a
ﬂow enters the network satisfying some proﬁle or property,
and background traﬃc along the network path is low, then
it will emerge downstream with bounded properties [17].
For example, there has been a great deal of work on proto-
cols such as Diﬀserv [3], which pre-negotiate resources along
some route, then use edge-marking to associate packets with
service classes. Overloaded core network routers preferen-
tially retain in-proﬁle packets while dropping out-of-proﬁle
and unmarked packets. Our work makes it clear that even
if a conditioned ﬂow were in proﬁle at the point of ingress,
within a few hops, it may be far outside of the negotiated pa-
rameters. Further, some congestion-detection schemes look
at inter-packet spacing as a signal of congestion [4,1,24]; our
work makes it clear that micro-bursts can develop even in
a mostly idle network. Moreover, the chains generated by
transitting a long path can overwhelm endpoints with bursts
of high-rate data that overrun buﬀers. Thus, a deeper ap-
preciation of the dynamics of deployed high-speed networks
will likely be needed to arrive at the best possible application
architectures.
We note that our particular ﬁndings reﬂect a lightly loaded
10 Gbps network, with Quality-of-Service routing features
disabled and all packets traversing the identical path. The
situation in other settings may be diﬀerent. Just the same,
our observations here suggest that similar eﬀects are likely
present in those portions of the public Internet backbone
with similar architecture.
In summary, this work contributes to the science of net-
work measurement as follows:
Instrumentation: We design and implement novel high-
precision instrumentation, BiFocals, to enable the genera-
tion of extremely precise traﬃc ﬂows, as well as their cap-
ture and analysis. We do not use computer endpoints or
network adapters for traﬃc capture at all; rather, we gener-
ate and acquire analog traces in real-time directly oﬀ optical
ﬁber using typical physics-laboratory test-equipment (oscil-
loscopes, frequency synthesizers, lasers, etc.). We combine
these with oﬀ-line post-processing, so as to completely avoid
the non-determinism and systemic noise that confound many
conventional techniques. In doing so, we obtain six orders-
of-magnitude improvement in timing precision over existing
end-host software and two to three orders-of-magnitude rel-
ative to prior hardware-assisted solutions.
Measurements: We apply BiFocals to exactly charac-
terize the delay distribution of network traﬃc after transit
across two paths: a single isolated router, and a deployed,
but lightly used, 10 Gbps WAN path across eleven enterprise
routers and 15 000 km of optical ﬁber. While exceptionally
precise, the measurements presented here are computation-
ally non-trivial, requiring over two trillion individual sam-
ples and over 5000 processor-hours of oﬀ-line computation.
Observations: We observe that as a ﬂow traverses a
long sequence of routers, packets cluster into chains, irre-
spective of data rate. This ﬁnding clariﬁes previously un-
explained observations [20] of packet loss on endpoints of a
WAN. Further, it calls into question some basic premises of
WAN paths, notably the common (although not universal)
assumption that a well-conditioned packet ﬂow will remain
well-conditioned as it travels along a lightly loaded route.
Additionally, we characterize the stability of such packet
chains and their probability as a function of their length.
Finally, we demonstrate that these observations would not
be possible using common software techniques on commod-
ity end-hosts.
Outlook: We provide support for the view that only high-
ﬁdelity experimental work can provide ground truth and an-
swer some of the contentious questions about the behavior
of networks.
2. MOTIVATION
In order to exactly measure timing in network packet
ﬂows, BiFocals departs substantially from existing tech-
niques. This section presents a taxonomy of diﬀerent ap-
proaches to measurement, of increasing precision, and mo-
tivates the resulting architectural decisions that inform our
design of BiFocals.
As we shall see below, BiFocals’ precision derives from
its interaction with a much lower level of the network stack
than existing methodologies. Thus, to understand this mea-
surement taxonomy, we ﬁrst must review the behavior of the
Physical Layer — a portion of the network stack completely
hidden from the end-host kernel and other software. For the
ensuing discussion, we focus upon the Physical Layer of opti-
cal 10 Gigabit Ethernet (10GBase-R) [11], corresponding to
our application in Section 3. Without loss of generality, this
discussion could equally apply to other Ethernet standards,
such as the 1000Base-X [11] also implemented by BiFocals.
2.1 Physical Layer background
In a commodity end-host computer, the Ethernet con-
troller of a typical 10GBase-R network adapter accepts Eth-
ernet packets from higher layers of the network stack in the
kernel and prepares them for transmission across the phys-
ical medium of the optical ﬁber span. However, the net-
work adapter does not transmit individual Ethernet packets
across the network, but instead embeds the data bitstream of
discrete network packets within a continuously transmitted
symbolstream. The continuous characteristic of this symbol-
stream, along with the application of complex line-coding
protocols and scrambling functions (described in more detail
in Appendix B), provide critical guarantees for the proper
performance of the transmission line.1
The crucial point here is that, while the higher-layer data
bitstream involves discrete Ethernet packets, the lower-layer
symbolstream is continuous. Every symbol is the same width
in time (∼100 picoseconds) and is transmitted at the pre-
cisely identical symbol rate (∼10 GBaud), completely irre-
spective of the data rate of the actual network traﬃc.
Figure 2 depicts a comparison between the Physical Layer
symbolstream and two hypothetical data bitstreams, moti-
vating the likely loss of timing precision in the bitstreams.
The top panel shows the actual symbolstream as transmit-
ted on ﬁber, with its continuous ﬂow of symbols of equal
width at equal rate. The remaining panels demonstrate the
absence of a continuous timebase once the Ethernet pack-
ets have been extracted: the middle shows the implausible
scenario where the ﬁdelity of packet timings has been main-
1Namely, clock recovery, DC-balance, reduction of intersym-
bol interference, etc.
343arrival of each packet. Such a technique removes ambiguities
involved with kernel scheduling of the measurement appli-
cation, as well as contention across memory buses. This
method is not often used in practice due to the complexity
of kernel and application modiﬁcation; however, as discussed
below, we implement an example of this approach to serve as
a more stringent control against which we can compare our
BiFocals instrumentation. Irrespective of its improvement
over simple user-space software packet stamping, kernel in-
terrupt-handler stamping still suﬀers from the non-deter-
minism of the asynchronous interrupt-delivery mechanism2
and manifests signiﬁcant “timing slop” of the type seen in
the bottom panel of Figure 2.
Network-adapter bitstream stamping: Both commer-
cial solutions [8, 13] and academic projects [19] have been
developed to address some of the sources of error above;
the commercial varieties are primarily used by major router
design ﬁrms and bear signiﬁcant acquisition costs. These
approaches involve specialized network adapters (generally,
custom FPGAs) to enable packet time-stamping functional-
ity in the network card hardware. While these designs aim
to stamp the packets as early in their processing as pos-
sible, they still must ﬁrst extract individual packets from
the underlying Physical Layer symbolstream. However, as
suggested by Figure 2, once they do so, the accompanying
continuous timebase is lost, and the discrete packets may be
subject to buﬀering and other error-inducing logic of FPGA
gateware.
(Vendor-released error estimates are addressed
in Section 4.) As such, these techniques remain unable to
exactly characterize the timing of network packets.
On-ﬁber symbolstream stamping: Our BiFocals in-
strumentation represents a substantial departure from the
techniques enumerated above. Excluding the end-host com-
pletely and directly tapping the ﬁber transport, we record
a contiguous portion of the entire Physical Layer symbol-
stream in real-time; only later, in oﬀ-line post-processing,
do we extract the discrete Ethernet packets from this cap-
tured trace and assign time-stamps in relation to the sym-
bolstream timebase. As our precision is signiﬁcantly better
than the width of a single symbol (∼ 100 ps), our time-
stamps are exact.
We recall, as in Figure 2, the diﬀerence between the dis-
crete nature of the data bitstream, which causes “timing
slop,” and the presence of a continuous timebase in the sym-
bolstream, where every symbol is the same width and trans-
mitted at an identical symbol rate, irrespective of the data
rate of the actual network traﬃc. Therefore, the ﬁdelity of
our instrumentation is agnostic to the data rate of the net-
work traﬃc, as we always generate and capture traﬃc at
the full 10GbE symbol rate of 10.3125 GBaud of the un-
derlying Physical Layer. Whether the actual captured sym-
bolstream is embedded with no data traﬃc (only inﬁnitely
repeating “idle” codewords) or maximal traﬃc density, our
instrumentation responds identically and provides the exact
time measurement of each packet.
2.3 Instrumentation architecture