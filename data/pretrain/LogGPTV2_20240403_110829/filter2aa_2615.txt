如何有效突破
DevOps转型的临界点
张 乐
高效运维社区 合伙人
前百度资深敏捷/DevOps专家
自我介绍
张 乐
•
高效运维社区合伙人、DevOps时代联合创始人
•
前百度资深敏捷教练、DevOps专家
•
国内首批 Certified DevOps Master
•
DevOps Master 授权讲师，凤凰项目沙盘授权教练
•
全球TOP外企，国内一线互联网
•
百度云、百度金融等新技术产品敏捷转型主导者
•
DevOpsDays 大会、GOPS全球运维大会金牌讲师
DevOps 已成为发展趋势
IT 的技术革新
推进 DevOps 转型过程中经常遇到的问题
•
为什么需要DevOps转型？
•
如何明确阐述转型的价值？
转型启动
方案设计
项目试点
整体推广
•
采购和引入工具是否足够？
•
DevOps体系非常庞大，实施
难度较大，应该从何处做起？
•
项目紧急，没空做转型？
•
转型过程中团队成员不支持？
•
转型初期效果不明显怎么办？
•
效率提升了，质量却下降了？
•
试点成果规模化的路径？
•
推广的组织结构是怎样的？
鸟飞派 VS 空气动力学派
应用底层规律，理解问题实质并解决问题
查理 · 芒格
‘如果你只是孤立地记住一些事物，试
图把它们硬凑起来，那你无法真正理解
任何事情……你必须依靠模型组成的框
架来安排你的经验。’
进化论
概率论
复利效应
黄金思维圈
安全空间
系统思考
二八法则
约束理论
临界
知识
为什么需要DevOps 转型？
进化论
想要在变化的世界里生存得更好，你得在环境发生变化的时候快速响应
•
传统的软件工程方法
-
系统的应用工程方法
-
基于预测性
-
重管控、结构化
-
有时避免或拒绝合理变更
图片来源：《 DevOps is not enough 》 @ufried
•
新的方法应对VUCA挑战
-
面向业务目标
-
助力业务成功
-
快速交付价值
-
灵活响应变化
“we$didn’t$do$anything$wrong,$
but$somehow,$we$lost”
如何明确阐述转型的价值？
DevOps 需要面向业务目标，助力业务成功
采购和引入工具是否足够？
系统思考
系统不是简单的因果关系，而是回路网状关系
进行更深入的系统思考，需要从系统的互动关系入手
DevOps 道法术器
A
道
A
H
法
HH
A
术
器
E
&
实 现 I T 服 务 的 供 应 链 ， 快 速 、 高 质 量 交 付 业 务 价 值
有 效 应 对 V U C A 挑 战 ， 让 I T 成 为 业 务 发 展 的 竞 争 优 势
Reference ：Patrick Debois《Devops Areas - Codifying devops practices》
•
Automation:
Extend delivery to Production (IaC)
•
Measurement:$
Extend Operations feedback to Project (Metrics)
•
Culture :$
Embedded$Project knowledges into$Operations
(Dev wear pagers, Co-responsible)
•
Sharing:$
Embedded$Operations$knowledge into$Projects
(Monitoring, security stories into project backlog)
DevOps 之‘道’
快速交付价值，灵活响应变化
Reference ：《DevOps Master Whitepaper: Success$with$Enterprise$DevOps$》
Reference ：KK《 Why, What, and How of Continuous Delivery 》
DevOps 之‘法’
全局打通&捷开发 & 高效运维
DevOps 之‘术’
系统应用指导原则 、 最佳实践
•
•
•
•
•
•
•
•
•
•
•
•
•
•
•
DevOps 之‘术’– 持续交付框架
Continuous$Delivery$is$the$ability$to$get$changes$of$all$types—including$new$features,$configuration$changes,$bug$fixes$
and$experiments—into$production,$or$into$the$hands$of$users, safely and quickly in$a sustainable way.
--Jez Humble
张乐 （乐神 @ 高效运维社区）
发布频率
分支模型
测试
架构
发布
基础设施
数据库
每100天发布一次
每10天发布一次
每天发布
每天发布10次
每天发布100次
主干开发
为发布创建分支
在主干开发
从主干发布
拉动提交
请求到发布分支
由开发人员和测试人员共同维护自动化功能测试
所有东西 一起部署
每个产品/每种Web资源单独一个包
严格的SOA架构，向前和向后兼容
功能版本，版本火车
灰度发布、蓝绿部署、金丝雀发布
开发自己将变更部署到生产
异构，运维部门
统一管理
可以通过收版本控制管理的脚本
来准备类生产环境
标准化的PaaS或者IaaS、Caas
平台来交付
手动迁移
设计中考虑应用对数据库的前向、后向兼
容性（采用扩展或契约）
采用增量脚本变更数据库
并对回滚进行演练
在分支上开发
合并到发布分支，然后发布
后再次创建分支
由单独的质量保证部门
负责功能测试自动化
在部署流水线中组织快速、完备
的自动化单元测试和功能测试
DevOps 之‘术’– 最佳实践集合
Reference ：《Lean Enterprise 》
DevOps 之‘器’
6. Build
1. Build
4. Code Review
5. Merge To
Master
2. UT
3. Sonar
8. Build
Docker Image
7. UT
9. Deploy To
Test Env
10. Smoke Test
11. System Test
12. Deploy To
Product Env 10%
13. Deploy To
Product Env 100%
&到&工具链相互联通 & 整合
全开源端到端交付流水线 V2.0 @高效运维社区
DevOps体系非常庞大，应该从何处做起？
二八法则
在资源有限的情况下，需要找到实现高绩效的突破口
把80%的资源，用到能产出关键效益的20%的工作上
尽可能自动化一切工作
自动化是高效能团队的显著特征
•
配置管理
•
自动化测试
•
自动化部署
•
变更审批流程
投入效果：在创新和快速反馈上能投入更多时间
DevOps体系非常庞大，应该从何处做起？
约束理论
明确过程中影响绩效的瓶颈，努力去解决它们
聚焦于瓶颈的改善，达到系统各环节同步、整体改善的目标
聚焦于瓶颈的改善
项目紧急，没空做转型？
复利效应
做事情A，会导致结果B，而结果B又会加强A，不断循环
需要长期坚持，会达到临界点，实现跨越式发展
Reference： Damon Edwards 《The History of DevOps And what you need to do about it 》
转型过程中团队成员不支持？
黄金思维圈
深入思考WHY，抓住问题的关键
抓住WHY的本质，激发HOW的创意
《第五项修炼》：每个人不能只囿于自己的岗位，觉得只做好分内之职就可以了，
要对职位之间相互关联产生的结果负有一定责任
&
Reference: martinfowler.com
•
责任共担：鼓励合作的发生
•
自动化：DevOps运动及促进
合作的基石
•
内建质量：频繁和低风险发布
的基础
•
反馈：为了实现持续改进
•
推倒部门墙：早期参与、构建
合作文化
•
自组织团队：改变风险管理方
式、建立对失败的宽容环境
•
营造DevOps文化：奖励‘改
进冒险’的‘行为’
转型初期效果不明显？
概率论
在不确定性的世界中，选择不断投入成功概率最大的事情中
从长期来看，一直投入最大赔率的事情，终会有回报
= 12.5
效率提升了，质量却下降了？
安全空间
小概率事件会造成极端严重的后果
构建安全空间，保证复利效应持续起作用
方案一：增强分级测试验证，减少出错概率
•
在追求速度提升的同时，不能以牺牲质量为代价
•
如果在内建质量上投入不足，会造成更多的故障
方案二：提升系统的反脆弱性，增强容错能力
•
改进交付流水线的效率，能够快速进行故障恢复
•
主动发现弱点：‘避免失败的最好办法是经常失败’
if it hurts, 
do it more often
试点成果规模化的路径？
第一种路径
•
首先是从组织级认识到DevOps的重要
性，并开始立项做相关的准备
•
然后在工作组级开始启动相关建设，当
在团队级通过采用一些实践取得成功后，
再把这些成果扩展到工作组级
•
最终向组织级做规模化的推广
第二种路径
•
首先从团队级别做小范围的改进和建设，
然后让领导层清晰的了解我们在做
DevOps的尝试
•
直到在团队级通过采用一些实践取得成
功后，再把这些成果扩展到工作组级
•
在获得管理层的支持后，最终向组织级
做规模化的推广
推广的组织结构是怎样的？
变革推进小组
变革Sponsor
变革推进小组
变革实施团队
研发工具链
研发工具链团队
测试服务平台
测试平台团队
发布部署平台
运维平台团队
跨 职 能 产 品 团 队
IT value chain
Dev
Ops
Business Capabilities
…
跨 职 能 产 品 团 队
跨 职 能 产 品 团 队
跨 职 能 产 品 团 队
• Overall Goal
• T-shaped
• Co-located
We$choose$to$go$to$the$moon$in$this$decade$and$do$
the$other$things,$not2because2they2are2easy,2but2
because2they2are2hard,$because$that$goal$will$serve$to$
organize$and$measure$the$best$of$our$energies$and$
skills,$because2that2challenge2is2one2that2we2are2
willing2to2accept,2one2we2are2unwilling2to2postpone,2
and2one2which2we2intend2to2win,$and$the$others,$too.
We2choose2to2go2to2the2Moon
U.S.$President John$F.$Kennedy
Q & A