18 :58:15
18 :58:14
www.Linuxidc.
web2
web2
veb2
web2
web2
webz
web2
veb2
webz
web2
后，web2开始接管web1的服务和IP资源，同时释放dlm锁，GFS2文
web2
teb2
openais [2691] :
2openais[2691]:
，查看/var/log/messages日志。信息如下：
web1
openais[2691] :
openais [2691] 
openais[2691]
openais [2691]:
openais [2691]
openais[2691]
qdiskd[2714] :
openais[2691] : [TOTEM]
2 clurgmgrd[3239]: Taking over service service:webserver
openais[2691]:
openais[2691] 
openais [2691]
openais [2691]
Service service:webserver started
Aug
Aug
Aug 24 18:58:15
192.168.12.233
2418:58:32 web2
from down member web1
2418:58:29
24 18:58:29 web2
acquire journal lock..
2418:58:29
24 18:58:15
24 18:58 :15
2418:58:15
24 18:58:15
2418:58:15
124 18:58:15
：24 18:58:15
24 18:58:15
24 18:58:15
24 18:58:15
同时GFS2文件系统也将恢复读写。
24 18:58:15
2418:58:15
2418:58:15
2418:58:15
24 18:58:15
24 18:58:15
2418:58:15
18:58:15
18:58:15
24
18:58:15
18:58:15
wwW.
web2
web2
veb2
web2
web2
web2
web2
web2
web2
web2
veb2
web2
web2
web2
web2
web2
web2
web2
web2
web2
veb2
web2
web2
web2
web2
web2
one
etho.
clurgmgrd[3300]:
kernel:
fenced[2730]
openais [2691] :
openais [2691] :
fenced[2730]:
openais[2691]:
openais[2691]
openais[2691]
service
fenced[2730]:
openais
openais [2691]
openais [2691] :
openais [2691]
openais [2691]
openais [2691] :
openais[2691] :
openais [2691] :
openais[2691]:
kernel: dlm: closing
openais[2691]:[CLM
openais[2691];
openais[2691]:[CLM
avahi-daemon[3174]:Registering new address record for
kernel:
kernel:
应用
GFs2:fsid=mycluster:my-gfs2.1:jid=3:Done
B[2691]
[2691]
Linuxidc .com
GFS2:
GFS2:
fencing
[CPG
[CPG
ICPG
web1
ICLM
ICLM
[TOTEM]
[SYNC
[CLM
CLM
CLM
CLM
[CLM
 Taking over Bervice Bervice:webserver
fsid=mycluster:my-gfs2.1:jid=3:Looking at
fsid=mycluster:my-gfs2.1:
"web1
not
node
Memberg
connection to node 4
406
Members
Members
New
Membe
de
那么RHCS会进人等待状态，此时集
joinlist
"web1"
joinlist
cluster
BUCce88
joinlist
nodejoin
nodejoin
nodejoin
Configuration:
CONFIGURATION CHANGE
r(0) ip(192.168.12.230)
r(0) ip(192.168.12.240)
4
r（0)
r(0) ip(192.168.12.231)
evicted
Joined:
Left:
Joined:
Left:
is
(192.168.12,
message
message
message
ember
message
message
message
within the primary component
after
from node
from node
from node 3
192.168.12.240
192.168.12.232
192.168.12.231
jid=3:
0sec post_fail_
240)
Trying
N
to
---
## Page 366
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
看集群状态。信息如下：
过N/2取整加1得到的，其中N为所有集群节点的投票数加上表决磁盘投票值，也就是这里
接着陆续将Mysql2、Mysql1异常岩机，岩机完成后，在web2节点上通过cman_tool查
从输出可知，整个集群系统节点数已经变为一个，但是集群系统仍然可用，GFS2仍然
Node addresses:192.168.12.240
fulticast addresses: 239.192.221,146
Node name:web2
Ports Bound:0 177
Quorum:2
Quorum device votes:2
Expected votes:6
员
Cluster Generation:3100
Cluster Member: Yes
Config Version:40
Version:6.2.0
[root@web2 -]# cman_tool status
从输出可知，集群节点数变为3，同时Quorum值也由原来的4变为3。Quorum值是通
Node addresses:192.168.12.240
Multicast addresses:239.192.221.146
odeID:1
Flags:Dirty
Active subsystems:9
Quorum:3
Total votes:5
Nodes:3
Membership state:Cluster-Member
Cluster Generation:
Cluster Id:56756
Cluster Name: mycluster
luster Id:56756
ConfigVersion:40
Version:6.2.0
[root@web2 ~]# cman_tool status
deID:1
mbership state: Cluster-Member
uster Name: mycluster
de name:web2
rts Bound:0 177
www.Linuxidc.com
3092
RHCS集
群
351
PDG
---
## Page 367
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
业务实时性和稳定性需求的不断提升，RHCS的应用必将越来越广泛。
复杂，管理和维护起来比较困难，但是RHCS的可靠性和稳定性是册庸置疑的。随着人们对
即可。
件，而管理与维护RHCS要在日常工作中慢慢积累起来。至于RHCS的概念和运行机制了解
和配置RHCS是本章的重点。读者阅读完本章后，要能够熟练地安装和配置RHCS集群套
何安装和配置一套RHCS系统，以及如何管理、维护和监控RHCS的正常运行。其中，安装
12.8
会在日志中输出，然后根据错误信息可以很容易地定位问题。
是很有必要的。通过观察日志输出可以知道RHCS更加详细的切换过程，如果切换失败，也
编辑ixdba，此时会提示该文件被锁。
如下：
然后在任意节点对共享分区进行数据的读写操作。例如，在节点web2上创建一个文件ixdba
12.7.2
个节点的集群是不能工作的。
可以正常读写，这些都是qdisk的功能。在一个RHCS集群中，如果没有表决磁盘，仅剩一
352
目前，RHCS已经广泛应用在企业的各个领域。与其他HA软件相比，RHCS显得比较
本章主要讲述了RHCS的使用，具体包括RHCS的结构与组成、RHCS的运行原理、如
到这里为止，RHCS所有功能点都已经测试完成了。在测试集群功能时，观察日志信息
接着测试同时读写文件。首先在节点web1上编辑文件ixdba，然后同时在节点web2上
可以看到，写操作正常。
This is GFs2 Files test
[root@web1 gfs2]# more /gfs2/ixdba
然后在节点web1上查看此文件。
[root@web2 gfs2]#echo This is GFS2 Files test" >/gfs2/ixdba
GFS2文件系统是RHCS集群中的共享存储，在集群各个节点挂载GFS2共享文件系统，
本章小结
存储集群测试
www.Linuxidc.com
PDG
---
## Page 368
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
系统数据的一致性。
Oracle集群文件系统（OCFS）、裸设备（Raw）、网络区域存储（NAS）等来保证整个集群
终完成数据的读写。共享存储的实现方式有很多种，可以通过使用自动存储管理（ASM）、
用于监控自已的网络端口信息。所有的服务和程序通过操作系统去访问一个共享存储，最