break;
default:
为默认分支（detalt）我们不对结
//No sort setting provided,so don't sort the query
果究成任何排序。
return $search_query:
像从前一样返回Sseanch_guety，不过这一次最后全有一个
ORDERBY子句。
你现在的位置
545
---
## Page 582
测试修改后的search.php脚本
运行测试
改造Search脚本，使用这两个新的定制函数。
在search.php脚本中创建generate_sort_links（）函数，然后向build
query（)函数增加新代码，使它生成一个提供有序结果的查询。不要忘记在脚本中
调用generate_sort_links（）函数来取代回显输出结果标题的代码。
将脚本上传到你的Web服务器，在一个浏览器中打开search.html页面，尝试完
成一个搜索。现在点击搜索结果上面的标题，根据不同数据对职位排序。多次点击
同一个标题来切换升序和降序。
Risky Jobs-Search
Risky
Jubs
build_quety）函数取用户输入的搜索项，将这个查询
分解为一个数组，清除数组中的空串，并用搜索项
Danger! Your dream job is out there
和对应排序值（如果有的话）的一个ORDERBY构建
一个SQL查询。
Risky Jobs-Search
Find yourisky jo
Buli Fighiter Matador
Sona)
Risky Jobs
Risky Jobs - Search Results
senerate_sort_links()
>Job Title
Descriptioe
Matedor
State
Date Posted
数生成可点击的列标
ofADD
VT
2008-63.11
题，在各个链接的URL
Fefisher
中加入排序选项。
experiei
200805-22
Eleetric Bell
Hatks Hoeky Tocky
Kepairer
2008-11-14
现在我可以看到最平发布的那
些职位，可以看到，佛蒙特州
非常迫切想要聘请一位斗牛士。
546
第9章
---
## Page 583
串与定制函数
但是有时我试图在更大
范图搜索，结累实在太
多了。
000
Risky
JUDs
Danger! Your dream job is out there
Do you have the guts to go find it?
Risky Jobs -Search Results
Job Title
Description
State
Date Posted
这个职位清单太庞大
Custard Wallker
We need peuple willieg to test the thcory that you cati
NM
2008 07-24
了，无法一次看完。
walk on custard. Were going to fill a sari.
Shark Trainer
Traiting sharks to do cute tricks for the audiences at our Fl.
2008 04·28
new watertbeme perk. YoulI spend tim....
Voluage Checker
Youli be out in tise field shesking a.c. and d.c. voltages NC
2006 06·28
ie the range of 3 to 250 or more volts. Y'.
Actenna Installer
Youll be iestalling antsgsas and othet mctallic
RL
2008 09 04
broadcast meceiving equipmeet on the roofs of Miami.
Elephant Proctologist Needed: experienced prostologist wiisg to wodk witl:
V
2008 07·29
Targe animals. Eiephantr at our zoo (ie San Fr
Airplane Engine
Jet airplanes needing ergines cleaned.In need of elean
TX
200808-17
Cieener
minded indivicuals willing to hendle rust af...
Matador
Bustling dairy fam looking forpart-time matadorto
VT
200803-11
cntentait spirited bull with mild case of ADD...
Paparazzo
Top celebrity photography fimm lookitg for scasoeed
CA
20080324
peperazzo to stalk tempe:emacntal lip syncing pop..
BRAIN
Tiehtrope Walker
Fledgling big top looking forthe-ring professioeal
with 1-2 yean of expericece to perfoem tightr.
TX
2008·11-14
CPOWER
mais and hatc plaque? Weli, then this
FL
2008-07·14
 for you! Our crocodile farm 
fresth eow faces.Full health insurance
NY
2008-11-02
其他网站如何避免在一个页面上显示
tovided. Must love kids...
大量搜索结果？
ves on how good our pet food tastes.
MO
2008·11-09
elp make ourprocucts cven better...
waiting for your superior non-violent
ID
ills. Must pess basie bull fighti.
2008·11·14
Tonk nccds at cxperienced clectric bull
NJ
2008-07.27
Ies (after you fix it)ene hal.
Firefiglster
The City of Dutaville is hiring firefighters. No
OHI
2008-05-22
Pize Fighaer
expericecee required - yot will he trained. Non-smo.
opporent to help buili bis winting reeoed. Slow f.
MO
2008-11·14
---
## Page 584
使用分页显示结果子集
可以对结果分页
现在我们将所有结果都显示在一个页面上，如果与搜索匹配的职位过
多，这就会成问题。并不要求用户在一个庞大的页面中上下滚动来查
看所有匹配的职位，可以使用一种称为分页的技术显示搜索结果。对
结果分页时，会把匹配的职位集合分组，然后分别在单独的Web页面
每页显示5个结果，另外还提供了访
上显示各组职位，如下所示：
问其他结果页的链接。用户可以很
客易地点击各个结果页，并避兔浓
000
动页面。
Risky
JJD
Danger
900
Risky
Jubs
Risky Jobs - Search Results
Job Title
Curtanl Wslker
W'r nced pcople 
litg to
A00
Stark Trsites
Risky
Job Tiie
JUbs
Voltuye Chcsker
Des
sta lstallot
2
Matalo
Elcghatt Proctulp
Needel: 0
Piyu
Risky Jobs - Search Results
Tight
o la dalk
Job Title
Description
Stale
Datc Pested
Deyoe]
MinN
M syis pkdx peG
Fee 3fw lotne kies
NY
2008 11 02
MO
2008 11.0
用户可以利用这些链接在
Totrador
Lovely be
2003 11·1
多个结果页之间导航。
Klectri Ruil Repai
20-11-14
当前页不是链接
Firefighter
Dhe City af Dneville i tiring firefighlen. No
OH
2008 05·22
Ap
这是第2个职位结
果页。
很不错，不过怎样把结累分解为这样
的组呢？要知运，我们的SQL查淘会返
回与搜索串医配的所有结累。
分页将查询
结果分组，并
D
分别在单独的
Web页面上显
我们需要只返回一个结果子集的查询，而不是返
回全部结果。
示各组结果。
很幸运，SQL已经为此提供了一个方法：LIMIT子
句。下面再来讨论LIMIT，看看如何使用LIMIT子
句将结果分解为5个一组
548
第9章
---
## Page 585
串与定制函数
使用LIMIT只获取你需要的行
要控制在给定页面上显示哪些行，关键是要为搜索查询再增加一个子
句：LIMIT子句。如果要得到最多5行，可以在查询的最后增加LIMIT5，
如下所示：
SELECT * FROM riskyjobs
由于没有WHERE子句，这个奎询会返回数
ORDER BY job_title
据库中的所有职位，这对应于不带任何
搜索项进行搜索。
LIMIT 5
返回前5个匹配结果。
LIMT控制一个
SQL查询返回多
如果还记得，我们使用了定制buildquery（）函数来创建RiskyJobs
少行以及哪些行。
查询。为了强制只显示前5个匹配结果，只需在构建查询串之后在最
后追加LIMIT5：
$query =build_query($user_search,$sort);
$query=$query."LIMIT5";
V
在垂询最后追加一个L3M5T子句，这全限制
Custard Walker
查询返回的行数，在这里就是限制为5行。
Shark Trainer
Voltage Checker
Antenna Instoller
这对于获取前5个结果行很合适，不过之后的5行呢？再接下来的5行
Elephant Proctologist
呢？为了进一步抽取结果集中的数据行，必须对LIMIT稍做修改。但
是如何修改呢？LIMIT10会得到前10行，所以这是不行的。我们需要
Matador
Paparazzo
得到第6行到第10行，为此要使用LIMIT的另一种不同的语法。可以向
Tightrope Walker
LIMIT增加两个参数，第一个参数控制跳过多少行，第二个参数控制
Crocodile Dentist
返回多少行。例如，利用以下查询可以得到第11行到第15行，这正是
Mime
PetFood Tester
第3个结果页：
Toreador
Electric Bull Repoirer
$query=build_query($user_search,$sort);
Firefighter
$query=$query."LIMIT 10，5";
7
第一个参数告诉L3MJT骄过多
第二个参数控制返图多
少行，即跳过前10行。
少行，与前面一样，同样
是5行。
你现在的位置
549
---
## Page 586
使用LIMIT来帮助对结果分页
用LIMIT控制页面链接
分页有一个很重要的部分，就是要提供链接，从而允许用户在不同结果页
之间来回转移。可以利用LIMIT子句在每个结果页最下方建立导航链接。
例如，“下一页”（next）和“上一页”（previous）链接各自都有自己的
LIMIT。数字链接也是如此，允许用户直接跳至某一个特定的结果页。
以下是对应前3个搜索结果页的LIMIT子句，这里还提供了一些页面链接相
应的LIMIT：
e00
A00
A0O
Risky
JUbS
Risky
JUbS
Risky
Jubs
Risky Jobs - Search Results
Risky Jobs - Search Results
Risky Jobs - Search Results
Job Titie
Dscrijtioo
Joh Tii
Joh Title
Dexriptien
Curtesl Walikcr
W': sec poepie
Miee
She/k Tnisa
Pe: Food Test
nl stit
Vuliagc Chcckor
Youll be
 the reege of.3 s
Melecna lestaflier
Deztie BuZ Rn
a1.3
Eertaer Ptocto
Nerded:cxg
Frefizhter
be City ofDera
LIMIT 0,5
LIMIT 5,5
LIMIT 10,5
LIMIT 5，5
LIMIT 15,5
LIMIT 5,
5
没问题。我们只需要编写一大堆查
询，各个查淘分别包含不同的LIMIT子
句，这样就可以了，是吗？
也算是吧。根据页面和链接不同，我们需要一个不同的LIMIT，不
过LIMIT可以生成，而不必编写多个查询。
所要做的就是进一步稍稍修改build_query（)函数，在它构建的
查询最后增加正确的LIMIT。
550
---
## Page 587
串与定制函数
跟踪分页数据
为了向build_query（)增加新的分页功能，我们需要创建并跟踪一
些变量，确定要在给定页面上查询并显示哪些搜索结果。这些变量对
于确定如何在页面下方生成导航链接也很重要。
$cur_page
通过S_GET从脚本URL得到当前页$cur_Page。
如果未通过URL传递当前页，$cur_Page则设置
为第1页（1）。
$results_per_page
这是每一页上显示的结果数，可以根据页面的外观来选
择，另外要考虑页面采用这种布局时放多少个搜索结果才
合适。LIMIT子句的第2个参数就由这个变量确定。
$skip
计算开始当前页面上的行之前要跳过的行数Sskip。这个变量会控制
每一页的结果从哪里开始，并为LIMIT子句提供第一个参数。
$total
运行一个不带LIMIT获取所有行的查询，然后统计
结果数并存储在Stotal中。换句话说，这是搜索结
果总数。
$num_pages
9
用$total除以$results_per_page计算页数$num_pages。所
以对于给定的搜索，总共有$tota1个匹配行，不过一次显示一页，
每页包含$results_per_page个匹配行。共有$num_pages页，
当前页由$cur_page标识。
你现在的位置