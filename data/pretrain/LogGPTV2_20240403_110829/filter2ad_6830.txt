title:Nightlights: Entropy-Based Metrics for Classifying Darkspace Traffic
Patterns
author:Tanja Zseby and
Nevil Brownlee and
Alistair King and
kc claffy
Nightlights: Entropy-Based Metrics
for Classifying Darkspace Traﬃc Patterns
Tanja Zseby1, Nevil Brownlee2,3, Alistair King3, and kc claﬀy3
1 Vienna University of Technology, 1240 Vienna, Austria
2 University of Auckland, Auckland 1010, New Zealand
3 CAIDA, UC San Diego, CA 92093, USA
An IP darkspace is a globally routed IP address space with no active hosts. All
traﬃc destined to darkspace addresses is unsolicited and often originates from
network scanning or attacks. A sudden increases of diﬀerent types of darkspace
traﬃc can serve as indicator of new vulnerabilities, misconﬁgurations or large
scale attacks. In our analysis we take advantage of the fact that darkspace traﬃc
typically originates from processes that use randomly chosen addresses or ports
(e.g. scanning) or target a speciﬁc address or port (e.g. DDoS, worm spreading).
These behaviors induce a concentration or dispersion in feature distributions
of the resulting traﬃc aggregate and can be distinguished using entropy as a
compact representation. Its lightweight, unambiguous, and privacy-compatible
character makes entropy a suitable metric that can facilitate early warning capa-
bilities, operational information exchange among network operators, and com-
parison of analysis results among a network of distributed IP darkspaces.
Using traﬃc from ﬁve months from a large /8 darkspace monitor, we inves-
tigate the use of an entropy vector for IP darkspace traﬃc classiﬁcation. As
reference we perform an in-depth analysis with the tool iatmon [2] to classify
the traﬃc into 15 diﬀerent traﬃc types. We then compare our entropy results
to the detailed iatmon analysis. We use the approach and the formula presented
in [3] to calculate an estimate for Shannon entropy from IP address and port
(cid:4)
number distributions: H(X) = − (cid:2)N
, where i...N are the dif-
ferent bins in the frequency distribution (IP addresses or ports). ni denotes the
number of packets that belong to bin i (e.g. all packets with port number 445).
X denotes the distribution of a feature (sIP , dIP , sP ort or dP ort), formed by
the frequencies n1, ...nN of all bins N . S denotes the total number of observa-
tions (packets received) in the time interval. In the /8 darkspace we get N = 224
possible destination addresses and therefore H(dIP )max = 24.
S · log2
i=1
ni
(cid:3)
ni
S
For each time interval t we compute an entropy vector that contains the
four entropy values: H t = [Ht(sIP ), Ht(dIP ), Ht(sP ort), Ht(dP ort)]. We ex-
pect diﬀerent changes in the entropy vector (+Δh increase, −Δh decrease),
which provide a unique signature for diﬀerent darkspace events.
A multi-source horizonal scan disperses source IPs and source ports, but
concentrates the destination port distribution. H(dIP ) dispersion is already
close to the maximum (24 bits) in darkspace data, so we expect only small eﬀects
on H(dIP ) (denoted by (+Δh)): ΔH t = [+Δh, (+Δh), +Δh,−Δh]. Backscat-
ter traﬃc occurs if victims of a DoS attack are attacked with spoofed source
addresses and reply to those spoofed addresses. For backscatter we expect a
M. Faloutsos and A. Kuzmanovic (Eds.): PAM 2014, LNCS 8362, pp. 275–277, 2014.
c(cid:2) Springer International Publishing Switzerland 2014
276
T. Zseby et al.
concentration of the source IP distribution, because a lot of traﬃc is sent from
relatively few (victim) sources. We expect a source port concentration toward
the port that was used as destination port to attack the victim machine, whereas
destination ports disperses if the attacker used random source ports. Again we
expect only a small eﬀect on H(dIP ): ΔH t = [−Δh, (+Δh),−Δh, +Δh]. For
a distributed probe we expect a source address and source port dispersion,
caused by the use of bots or spoofed addresses, and a concentration of destination
address and port toward the target: ΔH t = [+Δh,−Δh, +Δh,−Δh].
We analyse darkspace traﬃc from 5 month: Nov 2008 (Conﬁcker outbreak),
Jan/Feb 2011 and Jan/Feb 2012. We ﬁrst classify the traﬃc into 15 traﬃc classes
using an in-depth analysis with iatmon [2]. The output serves as a baseline
against which to evaluate our entropy-based inferences. Then we calculate one
entropy vector for each hour interval, using the tool Corsaro1 and the statis-
tical package R2. We then compare the detailed iatmon results with the more
lightweight entropy analysis to see if new events follow the expected entropy
patterns and thus can be classiﬁed based on entropy.
Multi-Source Scans: The detailed iatmon analysis of Nov 2008 data reveals
an increase of TCP horizontal scan packets, caused by the Conﬁcker outbreak,
where hosts began to scan port 445 trying to spread the worm [1]. The outbreak
of the new worm is clearly visible in entropy vectors, following the expected
entropy pattern for a multi-source scan.
Backscatter is captured eﬀectively by the entropy vector in our experiments.
Figure 1 shows the results from Feb 2012 as an example. It shows the entropies
(1st and 2nd graph) and the amount of backscatter packets according to iatmon’s
classiﬁcation (3rd graph). As expected, if backscatter increases we observe an
increase in H(dP ort), a decrease in H(sP ort) and H(sIP ) and no signiﬁcant
changes for H(dIP ). Table 1 lists the correlation coeﬃcients between entropy
and backscatter traﬃc. The observations also conform to the expected behavior.
While the increase in backscatter traﬃc does not always aﬀect the overall packet
count (last row in table 1), it always shows signiﬁcant changes in entropy.
Table 1. Correlation coeﬃcients for time series of amount of backscatter (bs) traﬃc
(as seen by iatmon) and entropy (rows 1,2) and bs traﬃc and packet count (row 3)
corr. coeﬀ. Jan11 Feb11 Jan12 Feb12 corr. coeﬀ. Jan11 Feb11 Jan12 Feb12
bs,H(sIP)
0.44
bs,H(sPort)
0.91
bs,pktcount
-0.75 bs,H(dIP)
-0.83 bs,H(dPort)
0.76
-0.38
-0.52
0.39
-0.48
-0.60
0.28
-0.37
-0.58
0.48
0.14
0.69
0.29
0.62
0.36
0.69
Large probing events are also visible in entropy. The iatmon analysis for Jan
2011 shows a large distributed probe originating from many sources (spoofed
and/or bots) directed to a speciﬁc IP address and port. The new probe traﬃc
is clearly visible in the entropy statistics (ﬁgure 2); the increase in new sources
1
2
http://www.caida.org/tools/measurement/corsaro/
http://www.r-project.org/
Nightlights: Entropy-Based Metrics for Classifying Darkspace Traﬃc Patterns
277
y
p
o
r
t
n
e
 24
 18
 12
 6
 12
y
p
o
r
t
n
e
 8
 4
 120
 90
 60
 30
s
t
k
p
M
H(sIP)
H(dIP)
H(sPort)
H(dPort)
Backscatter
15 Feb
18 Feb
21 Feb
Fig. 1. Entropy correlation with backscatter traﬃc (February 2012), showing IP ad-
dress entropies H(sIP ), H(dIP ) (1st graph), port entropies H(sP ort), H(dP ort) (2nd
graph), amount of backscatter traﬃc according to iatmon analysis (3rd graph)
 24
 18
 12
 6
 12
 8
 4
y
p
o
r
t
n
e
y
p
o
r
t
n
e
H(sIP)
H(dIP)
H(sPort)
H(dPort)
10 Jan 11 Jan 12 Jan 13 Jan 14 Jan
Fig. 2. Entropy during TCP Probe
drives up H(sIP ). High concentration of traﬃc to one address and one port
causes H(dIP ) and H(dP ort) to drop signiﬁcantly.
Our results show that entropy-based metrics can reveal noteworthy events in
IP darkspace. We plan to further investigate the use of entropy to also detect
smaller changes or nested events, and evaluate the utility of this method for early
warning and privacy-respecting information sharing among darkspace operators.
References
1. Aben, E.: Conﬁcker/Conﬂicker/Downadup as seen from the UCSD Network Tele-
scope. Technical report, CAIDA (February 2009)
2. Brownlee, N.: One-way traﬃc monitoring with iatmon. In: Taft, N., Ricciato, F.
(eds.) PAM 2012. LNCS, vol. 7192, pp. 179–188. Springer, Heidelberg (2012)
3. Lakhina, A., Crovella, M., Diot, C.: Mining Anomalies Using Traﬃc Feature Distri-
butions. SIGCOMM Comput. Commun. Rev. 35(4), 217–228 (2005)