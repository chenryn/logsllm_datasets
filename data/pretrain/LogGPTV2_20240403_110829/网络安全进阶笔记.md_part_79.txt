软件下裁地址为 http:/www.monkey.org/dugsong/fragroute/。
这个软件和DSniff出自一家，这个工具开发的本意是去测试入侵检测系统、防火墙、基本
的TCP/IP栈的行为，因此，它是一个能够破坏入侵检测系统的强大工具。此外，它还能够截
取、修改和重写向外发送的报文，实现了大部分的IDS攻击功能。Fragroute有一个简单的规则
设置语言，通过它，可以实现延迟、复制、丢弃、碎片、重叠、打印、重排、分割、源路由或
其他一些向目标主机发送数据包的攻击。
(3)John the Ripper
软件下载地址为htp://www.openwall.com/john/。
John theRipper是一个十分强大、灵活、快速的多平台哈希口令破解器，它设计的主要目
的是用于检查Unix系统的弱口令，支持几乎所有Unix平台上经crypt 函数加密后的口令哈希
类型，也支持KerberosAFS和WindowsNT/2000/XPLM哈希等。
8.2日志分析：安全进阶的基本功
8.2.1利用日志信息防范Linux入侵
很多人小时候都看过关于西部牛仔的电视节目，还记得其中的这样一些镜头吗？跟踪者只
需将耳朵放在铁轨上就能熟练地分辨出火车何时经过，或者根据沙滩上的足迹就能准确地说出
388
---
## Page 394
第8章掌握实用的Linux安全工具
一匹马上驶了几个人。不必惊讶，你也可以成为这样的人，不过时间要调转到新世纪。记号到
处都是，而且一清二楚，你的任务就是发现它们并做出相应的解释。
如今，有关日志讨论的话题越来越多，其原因在于日志能够反映系统安全的“蛛丝马迹”，
面这也一直是操作系统开发者和使用者关注的焦点。无论是黑客入侵行为还是管理员的误操
作，都可能导致系统产生不可预见的错误。为了增加内容的鲜活度，本文所探讨的内容将集中
在Linux平台下。同时，所有的案例也来自于第一线的实战总结。
1.安全第一步：Syslog到底记录了什么内容
就像飞机需要有一个记录飞行日志的黑匣子，在管理Linux系统的过程中，系统也设置了
一个专职记录事件的 Syslog工具。通过Syslog，系统就可以方便地记录谁、在什么时间、在哪
里、做了什么事情，记录系统曾经发生过什么事情了。
在Linux系统中，日志一般存储在“/varlog”目录中，这里记录了系统维护和其他程序的
就需要仔细查看“Nar/log/”目录下的Syslog日志，当然，在保密要求很高时也可以存储在其
他的服务器上。因此，这里应该是普通用户或管理员需要经常光临的地方了。
下面是RedHatLinux系统中比较常见的日志信息。以“/var/log/boot.log”为例，该文件记
录了开启或者关闭系统的信息，记录了系统在引导过程中发生的事件，即Linux系统开机自检
过程显示的信息。“/var/log/eron”日志文件则记录了子进程的动作，前面加上用户、登录时间
和PID，以及派生出的进程的动作。此外，还有记录电子邮件活动的“/var/log/maillog”文件，
记录系统的安全信息的“/var/log/secure”等。如图8.7所示。
?
PR
carman
conmar.ie
cupi
?
9lm
mal
pm
?
saroa
vtos
epie
anda.s)
riag
口
smp
imeig
围8.7Red Hat Linux 的 log 文件夹
由此可见，Linux的日志文件与Windows有着异曲同工之妙，这也是Linux操作系统日益
受到管理员青的原因之一。
言归正传，现在可能有用户要问：怎样启动Syslog服务呢？要确定系统是否运行着这个服
务，可以用命令先测试一下，命令为“service syslog status”。如果系统中并没有运行这个服务，
309
---
## Page 395
网络安全进阶笔记
[RE]
图8.8启动Syslog服务
由此可见，Linux中的Syslog日志系统有着重要的作用，它能够详细记录系统每天发生的
各种各样的事件，管理员可以通过日志文件检查错误产生的原因或者追踪攻击者的踪迹。但众
个入侵的系统日志文件也许不能信任，因为攻击者很容易修改它。
2.实事求是：忠实记录系统的一举一动
一般来说，Syslog的主配置文件为“/etc/syslog.conf”，用户可以直接在Linux中使用vi
编辑器打开。如图8.9所示。
Fve/h6/
Vuae/liog/asi1l
s/ing/t
图8.9使用vi编辑器修改syslog.conf
就像古代的史官会遵循一定的写作体例一样，syslog.conf也有一定的记录规则，这个文件
指定了记录日志的行为，该程序在启动时查询配置文件，设置每个条目占一行，对每类消息提
供一个选择域和一个动作域，其中，选择域指明消息的类型和优先级：动作域指明接收到一个
与选择标准相匹配的消息时所执行的动作。比如“kem.emerg/varadm/kemel”表示将内核的紧
390
---
## Page 396
三
第8章掌握实用的Linux安全工具
急情况信息记录在“/var/adm/kemel”文件中。需要注意的是：可能有人会在syslogd.conf里面
设置“**/var/log/everything”，尽管可以记录所有的日志，但要想在浩如烟海的日志中找到所
需的日志信息，无疑是一件很头痛的事情。
为了方便用户操作，Syslog提供了多种方式来记录系统发生的事情。第一种是最普遍的一
般档案方式，用户可以指定档案路径与档案名称，但是必须以目录符号“/”开始，例如
定终端机或其他设备，如果将系统纪录写到终端机，则目前正在使用该终端机的使用者就会直
接在屏幕上看到系统信息。第三种方式是指定的使用者，如果这些使用者正好上线的话，就会
在终端机上看到。最后一种方式就是指定远程主机。
在日常安全部署中，对于日志信息的管理通常采用两种方法，第一种方法是将不同服务器
的日志信息都存放在各自系统内，系统管理员对各服务器进行分散管理。另一种方法是使用日
志主机系统，它可以从其他主机收集日志，并将它们存放在同一个地方。通过日志主机系统，
很容易使来自多个主机的日志条日关联起来，对其进行统一的管理、分析，甚至配合自动化工
具进行实时的监控，有效提高管理的效率，实际应用中，第一种方法往往是大多数系统管理员
的常用的方法，这种传统的管理方法在服务器数量较少时还能勉强应付，但在处理多主机状况
时就要考惠日志主机系统了。
3.兵来将挡：利用日志信息阻止Linux入侵
由于日志其有审计与监测的功能，逾过对日志信息的分析，就可以检查错误发生的原因，
监测追踪入侵者及受到攻击时留下的痕迹，甚至还能实时地进行系统状态的监控。有效利用日
志信息并对其进行分析与实时的监控管理，对于保证系统的安全性且有极为重要的作用。实际
应用中，黑客对Linux攻击最常见的手段就是：采用各种方式不断地尝试登录到Limux系统中。
下面，针对Linux网络管理中的一个典型案例进行分析。
（1）事情的起因及现象分析。现在，在RedHatLinux下，通过命令“last|more”查看在
正常情况下登录到本机的所有用户的历史记录，因为Syslog是以root身份执行的，现在发现
Syslog被非法动过，可能存在入侵事件。
(2）日志分析。众所周知，Linux中的“/var/log/secure”安全日志文件就详细记录了登入
系统存取数据的文件，如POP3、SSH、Telnet和FTP等服务日志都会记录在此文件中。由于
“/var/og/secure”记录的登录者信息有一致性，那么就可以查询到Linux服务器中登录的使用
者账号与错误信息、IP地址及登录错误被拒绝次数等。根据日志显示可以简单地判断哪些是合
法的登录，哪些是非法的登录。通过日志记录分析，很快找到了入侵者留下的蛛丝马迹：他的
IP地址是211.130.162.158。得到IP地址后，使用wHOIS（http:/www.intemic.net/whois.html）)对
相关信息进行分析。
（3）查看hosts.deny和hosts.allow文件。Linux提供一种灵活有效的方法来实现对服务请
求用户的限制，从面可以在保证安全性的基础上，使可信任用户使用各种服务。在“/ete”目
录下有两个文件，即hosts.deny和hosts.allow。通过配置这两个文件，可以指定网络中哪些计
算机可以使用这些服务，哪些不可以使用这些服务。配置这两个文件是通过一种简单的访问控
制语言来实现的，基本格式如下：
程序名列表主机名/IP地址列表
391
---
## Page 397
网络安全进阶笔记
例如“ALL：211.130.162.158”表示接受或拒绝IP为211.130.162.158的计算机运行系统程
序或服务。
（4）下载RWSecure压缩包。RWSecure实际上是一段小巧的脚本程序，可以根据实际情
况配置好这段脚本，然后通过Linux的自动运行crontab（操作每个用户的守护程序和该执行的
时间表）功能设定脚本的运行时间。程序下载地址为hutp:/linux.softpedia.com/progDownload/
RWSecure-Download-10797.html。该压缩包有rwsecure.nfo和rwsecure两个文档。其中rwsecure
文档的内容如图8.10所示，
 ga/ mot es  sm sp9 os st g 
sitber tf stterpte befere iGskinp
peLt 1ots csta.n
1
tH
y*C
图8.10rwsecure文档的内容
小技巧：RWSecure的作用.运行RWSecure后，可自动分析“ar/log'secure”里记录的非法
用户登录日志，并可以根据用户设定登录失败次数，一旦某个用户的IP登录次数和
用户设定登录失败次数相符，RWSccure将把该IP地址写入hosts.deny文件中，以阻
止该IP对Linux系统的攻击
（5）解压缩RWSecure文件包，在Linux系统中，用tar命令解压缩RWSecure压缩包到系
统的任意目录，该压缩包有rwsecure.nfo和rwsecure两个文档，参考命令为”tarxvfrwsecure.tar”。
然后，使用vi编辑器设置rwsecure文档参数。具体配置如下：
设定用户设定登录失败次数，默认次数为3次
Configure number of attempts before blocking
attenpts=3
指定安全日志路径，默认为“/var/log/secure”
#Specify your securelog path
secureLogPath=/var/log/secure
302
---
## Page 398
二
第8章掌握实用的Linux安全工具
Specify location of hosts.deny
HostsDenypatb-/etc/hosts.deny
实际应用中，可将rwsecure脚本文档加入到crontab中自动运行，例如要设定每5分钟分
析一次安全日志。如果脚本在系统中运行出错，可修改rwsecure文件的第28~30行。一般问题
出在第29行，由于其为空行，所以报错，解决方法为，将第29行空行删除，将原28和30行
代码合并即可（这里的行数以rwsecure原始文件的行数为准)。
（6）查看非法登录信息。上述脚本自动运行后，将会根据用户设定自动将非法登录IP添
细的注释。如下所示：
ALL:211.70.102.10Addedby rwsecure on Mar 15 19:42:01 2010
ALL:202.10.136.124 Added by rwsecure on Mar 16 05:42:01 2010
日志记录了系统每天发生的各种各样的事情，这些日志信息是保障系统安全过程中的重要
组成部分。通过上面的设置，可以对入侵者实施相对有效的防护，而且，这也是一种安全防范
思维的延展，即利用日志里的“蛛丝马迹”，配合安全小工具，轻松解决Linux网络管理员的
后顾之忧。不过，需要注意的是，在安全实践中，一些日志工具也可能成为攻击者的一个目标，
他们会想方设法来清除Syslog所产生的日志。因此，在实际防范中，就需要知己知彼，这样就
能形成一道稳固的安全防线了。
8.2.2TCPDump的跟踪日志及应用
据英国《观察家报》报道，在联合国安理会就伊拉克战争进行关键的表决之前，英国情报
机构曾协助美国，窃听安理会成员国代表团的电话，其中的受害者就包括中国代表团，这绝不
是危言耸听，目前，全世界窃听电话通信的专职人员约35.000人，这些窃听电话自动化程度很
高，只要目标电话开始使用，监听设备立即启动实施窃听，始叫话机的号码、通信的日期和时