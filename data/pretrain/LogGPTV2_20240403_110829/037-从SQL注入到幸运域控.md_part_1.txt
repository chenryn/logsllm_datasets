2020/7/27 从SQL注⼊到幸运域控
从SQL注⼊到幸运域控
原创 队员编号037 酒仙桥六号部队 1周前
这是 酒仙桥六号部队 的第 37 篇⽂章。
全⽂共计2124个字，预计阅读时⻓8分钟。
背背背背背背背背背背背背背背背景景景景景景景景景景景景景景景
在某个午后，接到上级的任务需要对某个授权的⽬标进⾏渗透测试，于是磨⼑霍霍向⽜
⽺。
寻寻寻寻寻寻寻寻寻寻寻寻寻寻寻找找找找找找找找找找找找找找找突突突突突突突突突突突突突突突破破破破破破破破破破破破破破破⼝⼝⼝⼝⼝⼝⼝⼝⼝⼝⼝⼝⼝⼝⼝
由于这次给的⽬标范围很窄，只有两个域名跟两个IP，本来以为突破⼝不是那么好搞
到，但拿到⽬标站点打开⼀看，⼼⾥稍微松了⼀⼝⽓，通过站点的氛围来看，应该是个
运⾏很多年的系统了。第⼀步，信息收集⾛⼀遍，端⼝扫描、⽹站敏感⽬录和⽂件、指
纹识别、站点分析......信息并不是太多
通过前期的信息收集⼯具加⼿⼯的疯狂点点点，最终汇总成⼀份信息收集的表格，仔细
的对已有信息作了筛选，在其中挑选出了两个需要重点关注的地⽅，⼀个地⽅通过⽬录
爆破出来的后台管理系统，另⼀个是xx参数的地⽅。
先是对后台管理系统做了⼿动猜⼀猜，⽆果，没有验证码，换上平时收集整理的字典，
爆破⼀波，⽆果。测试⼀波注⼊，依旧⽆果。
https://mp.weixin.qq.com/s/23t4X_gkmXjKvET_zDG6jA 1/14
2020/7/27 从SQL注⼊到幸运域控
看来我的缘分不在此处，先放⼀下，回过头来看看之前找到的xx参数的位置。
常规的⼿法探测了下sql注⼊，出现报错，⽽且还是⾮常熟悉的画⻛，⼼⾥⼀喜。
由于⽬标站点上并没有⼀些WAF之类的防护，这⾥直接上sqlmap直接去跑⼀波，看看
能不能直接搞定，经过⼀杯茶的时间，结果出来了，数据库是oracle。
https://mp.weixin.qq.com/s/23t4X_gkmXjKvET_zDG6jA 2/14
2020/7/27 从SQL注⼊到幸运域控
通过这个注⼊点，费了⽼⼤的劲在数据库中翻到了后台管理系统的登录名跟密码，由于
密码是加密的，使⽤密码cmd5解密⼀下，运⽓不错，拿到明⽂密码。
通过⽤户名跟解密出来的密码，成功登录管理员后台。
到这⼀步我们已经通过SQL注⼊进⼊了⽹站的后台，接下来我们需要通过后台来看看能
不能搞到⼀个shell。
上上上上上上上上上上上上上上上传传传传传传传传传传传传传传传拿拿拿拿拿拿拿拿拿拿拿拿拿拿拿到到到到到到到到到到到到到到到ssssssssssssssshhhhhhhhhhhhhhheeeeeeeeeeeeeeellllllllllllllllllllllllllllll
https://mp.weixin.qq.com/s/23t4X_gkmXjKvET_zDG6jA 3/14
2020/7/27 从SQL注⼊到幸运域控
在后台对每个功能模块进⾏分析，仔细查看有没有像头像吧，上传图⽚这类的地⽅，看
看能不能有什么收获，⽇站⽇多了就有感觉了，后台的⼤部分突破点会在这⼀⽅⾯上，
⼏乎不⼤⼀会⼉我就看到⼀个xx发布信息的功能，看到这种功能，肯定得测⼀测说不定
突破点就在这⾥呢！
仔细查分析了⼀下这⾥的功能，发现有个上传封⾯跟资质图⽚的地⽅，上传封⾯就是上
传图⽚嘛！遇到这种情况肯定不能⼿软，⽤准备好的⻢先来⾛⼀波，把asp⽊⻢后缀改
成jpg进⾏上传,直接上传，不成功......
不成功，没关系先来看看问题到底出在哪⾥，逐⼀的去测试看看能不能有所突破，经过
测试，发现这⾥只做了前端验证，因此⽤burpsuite拦截把jpg改成ashx后缀然后上
传，由于有两处地⽅，⼀个上传封⾯，⼀个是资质图⽚，因此两处上传都⼀样改成ashx
后缀即可上传成功。
点击Forward，逐步放包，留意上传后的路径，可以看到路径出来了。
https://mp.weixin.qq.com/s/23t4X_gkmXjKvET_zDG6jA 4/14
2020/7/27 从SQL注⼊到幸运域控
提取⼀下路径，拼接后直接访问，可以看到成功解析。
接下来换上中国菜⼑，填⼊链接，直接连，⾄此拿到⽹站的shell权限。
https://mp.weixin.qq.com/s/23t4X_gkmXjKvET_zDG6jA 5/14
2020/7/27 从SQL注⼊到幸运域控
甜甜甜甜甜甜甜甜甜甜甜甜甜甜甜⼟⼟⼟⼟⼟⼟⼟⼟⼟⼟⼟⼟⼟⼟⼟⾖⾖⾖⾖⾖⾖⾖⾖⾖⾖⾖⾖⾖⾖⾖提提提提提提提提提提提提提提提权权权权权权权权权权权权权权权
在虚拟终端中，使⽤whoami,查看当前的权限，是⼀个普通域⽤户，且操作系统版本是
windows server 2008R2。
输⼊netstat -ano查看开放了哪些端⼝，可以看到3389端⼝是开放的，这样我就想看
看能不能直接搞到密码后远程连接上它。
这⾥先使⽤SweetPotato.exe甜⼟⾖来提权，可以成功提权，在可以提权的情况下，
⽅便之后直接使⽤mimikatz抓取密码。
https://mp.weixin.qq.com/s/23t4X_gkmXjKvET_zDG6jA 6/14