L=200 ms
L=400 ms
L=600 ms
1
0.8
0.6
0.4
0.2
t
e
a
R
e
v
i
t
i
s
o
P
e
u
r
T
1
0.8
0.6
0.4
0.2
t
e
a
R
e
v
i
t
i
s
o
P
e
u
r
T
800
1000
0
0
200
400
600
Average Delay (ms)
800
1000
0
0
200
400
600
Average Delay (ms)
800
1000
0
0
200
400
600
Average Delay (ms)
L=100 ms
L=200 ms
L=400 ms
L=600 ms
800
1000
400
600
Average Delay (ms)
(a) A=500
(b) A=1000
(a) A=500
(b) A=1000
Under Web Server Traffic and  A=1500
Under Web Server Traffic and  A=2000
Under Mail Server Traffic and  A=1500
Under Mail Server Traffic and  A=2000
t
e
a
R
e
v
i
t
i
s
o
P
e
u
r
T
1
0.8
0.6
0.4
0.2
0
0
t
e
a
R
e
v
i
t
i
s
o
P
e
u
r
T
1
0.8
0.6
0.4
0.2
0
0
800
1000
t
e
a
R
e
v
i
t
i
s
o
P
e
u
r
T
1
0.8
0.6
0.4
0.2
0
0
800
1000
t
e
a
R
e
v
i
t
i
s
o
P
e
u
r
T
1
0.8
0.6
0.4
0.2
0
0
800
1000
L=100 ms
L=200 ms
L=400 ms
L=600 ms
200
400
600
Average Delay (ms)
L=100 ms
L=200 ms
L=400 ms
L=600 ms
200
400
600
Average Delay (ms)
800
1000
L=100 ms
L=200 ms
L=400 ms
L=600 ms
200
400
600
Average Delay (ms)
L=100 ms
L=200 ms
L=400 ms
L=600 ms
200
400
600
Average Delay (ms)
(c) A=1500
(d) A=2000
(c) A=1500
(d) A=2000
Figure 3. True positive rate vs. average delay
curves under Web Server trafﬁc.
Figure 4. True positive rate vs. average delay
curves under Mail Server trafﬁc.
relay packets are forwarded, then the number of true pos-
itives was incremented. This process was repeated several
times and at the end, the ratio of the true positives to the
number of all generated relay trafﬁc was declared as the true
positive rate. The same experiment was then repeated once
more but this time without blending the relay trafﬁc into the
real trafﬁc. Hence, if the system declares a relay activity
then it means a false positive and the false positive counter
was incremented. Finally the ratio of the number of false
positives to the number of all generated but not blended re-
lay trafﬁc gives the false positive rate.
3.2 Results
In this section the results of the experiments described in
the previous section are discussed. The experiments were
conducted using various time slot lengths (L), and various
(A) values which indicates the number of terms incorpo-
rated as discussed in Section 2.3 in Equation (4). The per-
formance was also investigated for various average delay
values that relay packets encounter. In the ﬁrst set of exper-
iments we used only one pair of relaying ﬂows (i.e. F = 1
in Equation (7)) and relay trafﬁc consisted of 200 incoming
packets and the corresponding 200 outgoing relayed pack-
ets. The inter-arrival times between incoming relay pack-
ets were generated according to the model in Equation (10)
where p = 0.8, µshort = 100 milliseconds, σshort = 10,
µlong = 3000 milliseconds and σlong = 500. A de-
lay value was drawn from N (µdelay, σ2
) between each
incoming packet and the corresponding forwarded packet.
Here µdelay was changed throughout the experiments but
σdelay = 50 was kept ﬁxed. Finally the resulting relay traf-
ﬁc, which typically lasts for about 150-160 seconds, was
delay
blended into the captured real trafﬁc and true positive rate
was calculated.
Figure 3 and Figure 4 plot the true positive rates vs. aver-
age delay (µdelay) of the relay trafﬁc where the relay trafﬁc
is blended into web server trafﬁc and mail server trafﬁc re-
spectively. The experiment was repeated for parameter val-
ues A = 500, 1000, 1500, 2000 and L = 100, 200, 400, 600
milliseconds. Each of the four sub-ﬁgures corresponds to
a different A value whereas each sub-ﬁgure contains four
different curves each represents a different L value.
In all experiments, regardless of the A and L values, it
is observed that the true positive rate decreases as the av-
erage delay of the relay is increased. This behavior is ex-
pected since increased delay reduces the probability of re-
laying ﬂows being active simultaneously in the same time
slot. In other words, as the delay increases, it is more likely
that the time slot during which the incoming packet is re-
ceived, elapses before the node forwards that packet. How-
ever, another interesting behavior was also observed in all
experiments. Even though the average delay value was way
greater than the length of the time slots (L), some of the re-
lay activities were still successfully detected. For instance
when the time slot length (L) was 100 milliseconds and the
average delay was 600 milliseconds, there is no way that
the incoming packets are relayed within the same time slot.
Therefore, at ﬁrst sight it can be said that the system cannot
detect these relays although it certainly can as shown in Fig-
ures 3 and 4. The reason for this behavior is that sometimes
relay packets corresponding to previous incoming packets
are transmitted within the same time slot that a new packet
arrives. Therefore, although the same content isn’t being
relayed at the same time slot, both incoming and outgoing
359359
Effect of "F" under Web Server Traffic
Effect of "F" under Mail Server Traffic
Effect of Relay Duration under Web Server Traffic
Effect of Relay Duration under Mail Server Traffic
1
0.8
0.6
0.4
0.2
e
t
a
R
e
v
i
t
i
s
o
P
e
u
r
T
0
0
F=1
F=2
F=3
F=4
F=5
200
400
600
Average Delay (ms)
1
0.8
0.6
0.4
0.2
e
t
a
R
e
v
i
t
i
s
o
P
e
u
r
T
800
1000
0
0
F=1
F=2
F=3
F=4
F=5
200
1
0.8
0.6
0.4
0.2
e
t
a
R
e
v
i
t
i
s
o
P
e
u
r
T
0
0
800
1000
50 pckt
150 pckt
250 pckt
350 pckt
450 pckt
550 pckt
200
400
600
Average Delay (ms)
400
600
Average Delay (ms)
1
0.8
0.6
0.4
0.2
e
t
a
R
e
v
i
t
i
s
o
P
e
u
r
T
50 pckt
150 pckt
250 pckt
350 pckt
450 pckt
550 pckt
200