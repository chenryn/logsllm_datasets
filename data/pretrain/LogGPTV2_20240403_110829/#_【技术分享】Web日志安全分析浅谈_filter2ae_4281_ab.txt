6.境外威胁来源国家(地区)统计
7.境内威胁来源城市统计
8.威胁严重度
9.威胁响应分析
10.恶意IP
11.恶意URL分析
12.威胁类型分析
13.威胁类型分布
14.威胁分类计数
15.威胁来源热力图
16.威胁总数
17.威胁日志占比
结果似乎挺丰富，至少比我们开始使用命令和工具得到的结果更为丰富，其实在看到这个产品之前，我们内部就尝试使用过各种方法实现过其中大部分视图结果，但是似乎还是缺少点什么
——
攻击行为溯源，也就是我们在第二节中对日志进行简单的分析的过程，得到攻击者的整个攻击路径已经攻击者执行的恶意操作。不过想要将这个过程工程化，难度可比如上17个统计视图大多了，难在哪里？请回看第三节..  
虽然安全易的产品并没有满足我对日志分析中的想法，但是也不能说它毫无价值，相反这款产品能辅助运维人员更有效率的监控、检查服务器上的安全事件，甚至他们不用懂得太多的安全知识也能帮助企业更有效率的发现、解决安全问题
**五、日志分析工程化之路 [实践篇]**
在了解了很多分析日志的工具后，也尝试过自己折腾出一个方便分析日志的工具，以便以日常工作中的应急响应场景
记得是在半年前左右，我的思路是这样的：
1.首先确认日志结构
我在Mysql中建立了如下结构的一张表来存储日志：
日志字段  
请求时间
服务器名称
客户端IP
请求方法
请求资源
服务器端口
服务器IP
浏览器信息
响应状态码
请求来源
响应长度
请求协议
2.给Web攻击进行分类
攻击类型表
攻击类型名称
危险等级
攻击/扫描
3.建立攻击规则表对应不同的攻击类型
攻击规则表
攻击规则正则表达式
攻击发生的位置
攻击规则对应的攻击类型ID
此时不得不说一下当时日志是怎么入库的，不知道大家是否知道awk命令
    echo "aa bb cc" | awk -F '{print $1}'
我们对日志采用了类似的方式，通过空格分割，然后生成出Mysql中可用的insert语句
大约为：INSERT INTO web_log VALUES
($1,$3,$4,…),至于你说其中列数是如何对应到Mysql里的表结构的,我们当时是人工核对的，为每一个不同的日志文件进行人工对应..（可想而知这活工作量多大）
扯回正题，当我们入库完毕后有了这么三张数据表，聪明的童鞋可能已经知道下一步要干什么的，那就是拿着安全规则正则表达式去逐条匹配日志表里面的日志
然后得到结果：
攻击日志ID
攻击类型ID
攻击规则ID
最后我们只需要写SQL语句，就能轻松统计各个攻击类型都分别有多少攻击请求了，如图：
最后我们思考了从各个角度来进行查询，得到了如下以下列表中的结果：
1.网站受攻击次数排名
2.网站高危请求排名
3.网站攻击者数量排名
4.网站受攻击页面排名
5.可疑文件排行
6.被攻击时间统计
7.攻击来源分布
8.高危攻击者排行
9.攻击者攻击次数排行
10.网站危险系数排行
11.攻击者数量统计
12.各站点攻击者数量统计
13.各扫描器占比
14.使用扫描器攻击者统计
由于这是一次针对多个(70+)站点的分析，所以只需突显安全趋势即可，在此次日志分析中，还并未涉及到溯源取证  
记得当时我们是用SQL语句查询出结果，然后将数据填入Execl，然后进行图标生成，整个日志分析的过程，从日志原文件到入库到匹配到统计到出数据最后到Execl出统计图表基本都需要人工参与
对了，上几张图瞧瞧吧
（篇幅原因，其他统计图不贴上来了）
可以看出，我们仅仅只是采用了一些安全攻击规则来对日志进行匹配就已经得到了不错的结果，虽然整个过程有点漫长，但是得到的这一份日志分析报告是具有实际意义和价值的，它可以帮我们发现哪些站点受到的攻击行为最多，那一类攻击最为频繁，哪些站点风险系数较高，网站管理和运维人员可以通过这份报告，来着重检查危险系数较高的请求和危险系数较高的站点，从而大大提高效率。
但是日志分析工(lan)程(duo)化(hua)之路到此结束了吗？不，远远没有。
**六、日志分析工程化之路 [进阶篇]  
**
有没有觉得像上面那样折腾太累了，虽然确实能得到一个还不错的结果。于是开始找寻一个较好的日志分析方案，最后采用了开源日志分析平台ELK,ELK分别为：
Elasticsearch 开源分布式搜索引擎
Logstash 对日志进行收集、过滤并存储到Elasticsearch或其他数据库
Kibana 对日志分析友好的Web界面,可对Elasticsearch中的数据进行汇总、分析、查询
因为它开源、免费、高可配，所以是很多初创企业作为日志分析使用率最高的日志分析平台
当理清楚ELK的搭建方式和使用流程后，我们用ELK实现了一遍第五节中的日志分析
流程大概如下：
1.编写Logstash配置文件
2.将攻击规则应用于logstash的filter插件
3.利用载入了安全分析插件后的logstash进行日志导入