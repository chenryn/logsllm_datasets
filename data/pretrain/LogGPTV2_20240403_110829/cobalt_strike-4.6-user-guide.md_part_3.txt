rangesofnumbersforcolumnsthatcontainnumbers.Usewildcardcharacters(*,?)tofilter
columnsthatcontainstrings.
The!buttonnegatesthecurrentcriteria.Pressentertoapplythespecifiedcriteriatothe
currenttable.Youmaystackasmanycriteriatogetherasyoulike.TheResetbuttonwillremove
thefiltersappliedtothecurrenttable.
Data Management
Overview
CobaltStrike’steamserverisabrokerforinformationcollectedbyCobaltStrikeduringyour
engagement.CobaltStrikeparsesoutputfromitsBeaconpayloadtoextracttargets,services,
andcredentials.
Ifyou’dliketoexportCobaltStrike’sdata,youmaydosothroughReporting->ExportData.
CobaltStrikeprovidesoptionstoexportitsdataasTSVandXMLfiles.TheCobaltStrikeclient’s
exportdatafeaturemergesdatafromalloftheteamserversyou’recurrentlyconnectedtoand
exportTSVandXMLfileswithdatainCobaltStrike'sdatamodel..
UserGuide www.helpsystems.com page:28
DataManagement/Targets
Targets
YoumayinteractwithCobaltStrike’stargetinformationthroughView->Targets.Thistab
displaysthesameinformationastheTargetsVisualization.
PressImporttoimportafilewithtargetinformation.CobaltStrikeacceptsflattextfileswith
onehostperline.ItalsoacceptsXMLfilesgeneratedbyNmap(the–oXoption).
PressAddtoaddnewtargetstoCobaltStrike’sdatamodel.
AddaTarget
ThisdialogallowsyoutoaddmultiplehoststoCobaltStrike’sdatabase.SpecifyarangeofIP
addressesoruseCIDRnotationintheAddressfieldtoaddmultiplehostsatonetime.Hold
downshiftwhenyouclickSavetoaddhoststothedatamodelandkeepthisdialogopen.
Selectoneormorehostsandright-clicktobringupthehostsmenu.Thismenuiswhereyou
changethenoteonthehosts,settheiroperatingsysteminformation,orremovethehostsfrom
thedatamodel.
Services
Fromatargetsdisplay,right-clickahost,andselectServices.ThiswillopenCobaltStrike’s
servicesbrowser.Hereyoumaybrowseservices,assignnotestodifferentservices,andremove
serviceentriesaswell.
UserGuide www.helpsystems.com page:29
DataManagement/Credentials
TheServicesDialog
Credentials
GotoView->CredentialstointeractwithCobaltStrike’scredentialmodel.
PressAddtoaddanentrytothecredentialmodel.Again,youmayholdshiftandpressSaveto
keepthedialogopenandmakeiteasiertoaddnewcredentialstothemodel.
PressCopytocopythehighlightedentriestoyourclipboard.
UseExporttoexportcredentialsinPWDumpformat.
TheCredentialModel
Maintenance
CobaltStrike’sdatamodelkeepsallofitsstateandstatemetadatainthedata/folder.This
folderexistsinthefolderyourantheCobaltStriketeamserverfrom.
ToclearCobaltStrike’sdatamodel:stoptheteamserver,deletethedata/folder,andits
contents.CobaltStrikewillrecreatethedata/folderwhenyoustarttheteamservernext.
Ifyou’dliketoarchivethedatamodel,stoptheteamserver,anduseyourfavoriteprogramto
storethedata/folderanditsfileselsewhere.Torestorethedatamodel,stoptheteamserver,
andrestoretheoldcontenttothedata/folder.
Reporting->ResetDataresetsCobaltStrike’sDataModelwithoutateamserverrestart.
UserGuide www.helpsystems.com page:30
ListenerandInfrastructureManagement/Overview
Listener and Infrastructure
Management
Overview
Thefirststepofanyengagementistosetupinfrastructure.InCobaltStrike’scase,infrastructure
consistsofoneormoreteamservers,redirectors,andDNSrecordsthatpointtoyourteam
serversandredirectors.Onceyouhaveateamserverupandrunning,youwillwanttoconnect
toit,andconfigureittoreceiveconnectionsfromcompromisedsystems.ListenersareCobalt
Strike’smechanismtodothis.
AlistenerissimultaneouslyconfigurationinformationforapayloadandadirectiveforCobalt
Striketostandupaservertoreceiveconnectionsfromthatpayload.Alistenerconsistsofa
user-definedname,thetypeofpayload,andseveralpayload-specificoptions.
Listener Management
TomanageCobaltStrikelisteners,gotoCobaltStrike->Listeners.Thiswillopenatablistingall
ofyourconfiguredpayloadsandlisteners.
Figure18.ListenerManagementTab
PressAddtocreateanewlistener.TheNewListenerpaneldisplays.
UserGuide www.helpsystems.com page:31
ListenerandInfrastructureManagement/ListenerManagement
UsethePayloaddrop-downtoselectoneoftheavailablepayload/listenertypesyouwishto
configure.Eachhasdifferentparametersandaredescribedinthefollowingsections:
DNSBeacononpage33
HTTPBeaconandHTTPSBeacononpage37
SMBBeacononpage41
TCPBeacononpage43
ExternalC2onpage45
ForeignListenersonpage46
Toeditalistener,highlightalistenerandpressEdit.Toremovealistener,highlightthelistener
andpressRemove.
UserGuide www.helpsystems.com page:32
ListenerandInfrastructureManagement/CobaltStrike’sBeaconPayload
Cobalt Strike’s Beacon Payload
Mostcommonly,youwillconfigurelistenersforCobaltStrike’sBeaconpayload.Beaconis
CobaltStrike’spayloadtomodeladvancedattackers.UseBeacontoegressanetworkover
HTTP,HTTPS,orDNS.Youmayalsolimitwhichhostsegressanetworkbycontrollingpeer-to-
peerBeaconsoverWindowsnamedpipesandTCPsockets.
Beaconisflexibleandsupportsasynchronousandinteractivecommunication.Asynchronous
communicationislowandslow.Beaconwillphonehome,downloaditstasks,andgotosleep.
Interactivecommunicationhappensinreal-time.
Beacon’snetworkindicatorsaremalleable.RedefineBeacon’scommunicationwithCobalt
Strike’smalleableC2language.ThisallowsyoutocloakBeaconactivitytolooklikeother
malwareorblend-inaslegitimatetraffic.SeeMalleableCommandandControlonpage95for
moreinformation.
Payload Staging
Onetopicthatdeservesmention,asbackgroundinformation,ispayloadingstaging.Manyattack
frameworksdecoupletheattackfromthestuffthattheattackexecutes.Thisstuffthatanattack
executesisknownasapayload.Payloadsareoftendividedintotwoparts:thepayloadstageand
thepayloadstager.Astagerisasmallprogram,usuallyhand-optimizedassembly,that
downloadsapayloadstage,injectsitintomemory,andpassesexecutiontoit.Thisprocessis
knownasstaging.
Thestagingprocessisnecessaryinsomeoffenseactions.Manyattackshavehardlimitsonhow
muchdatatheycanloadintomemoryandexecuteaftersuccessfulexploitation.Thisgreatly
limitsyourpost-exploitationoptions,unlessyoudeliveryourpost-exploitationpayloadinstages.
CobaltStrikedoesusestaginginitsuser-drivenattacks.Thesearemostoftheitemsunder
Attacks->PackagesandAttacks->WebDrive-by.Thestagersusedintheseplacesdependon
thepayloadpairedwiththeattack.Forexample,theHTTPBeaconhasanHTTPstager.TheDNS
BeaconhasaDNSTXTrecordstager.Notallpayloadshavestageroptions.Payloadswithno
stagercannotbedeliveredwiththeseattackoptions.
Ifyoudon’tneedpayloadstaging,youcanturnitoff.Setthehost_stageoptioninyourMalleable
C2profiletofalse.ThiswillpreventCobaltStrikefromhostingpayloadstagesonitsweband
DNSservers.ThereisabigOPSECbenefittodoingthis.Withstagingon,anyonecanconnectto
yourserver,requestapayload,andanalyzeitscontentstofindinformationfromyourpayload
configuration.
InCobaltStrike4.0andlater,post-exploitationandlateralmovementactionseschewstagers
andopttodeliverafullpayloadwherepossible.Ifyoudisablepayloadstaging,youshouldn’t
noticeitonceyou’rereadytodopost-exploitation.
DNS Beacon
TheDNSBeaconisafavoriteCobaltStrikefeature.ThispayloadusesDNSrequeststobeacon
backtoyou.TheseDNSrequestsarelookupsagainstdomainsthatyourCobaltStriketeam
UserGuide www.helpsystems.com page:33
ListenerandInfrastructureManagement/DNSBeacon
serverisauthoritativefor.TheDNSresponsetellsBeacontogotosleeportoconnecttoyouto
downloadtasks.TheDNSresponsewillalsotelltheBeaconhowtodownloadtasksfromyour
teamserver.
Figure21.DNSBeaconinAction
InCobaltStrike4.0andlater,theDNSBeaconisaDNS-onlypayload.ThereisnoHTTP
communicationmodeinthispayload.Thisisachangefrompriorversionsoftheproduct.
Data Channels
Today,theDNSBeaconcandownloadtasksoverDNSTXTrecords,DNSAAAArecords,orDNS
Arecords.Thispayloadhastheflexibilitytochangebetweenthesedatachannelswhileitson
target.UseBeacon’smodecommandtochangethecurrentBeacon’sdatachannel.modednsis
theDNSArecorddatachannel.modedns6istheDNSAAAArecordchannel.And,modedns-
txtistheDNSTXTrecorddatachannel.ThedefaultistheDNSTXTrecorddatachannel.
BeawarethatDNSBeacondoesnotcheckinuntilthere’sataskavailable.Usethecheckin
commandtorequestthattheDNSBeaconcheckinnexttimeitcallshome.
DNS Listener Setup
TocreateaDNSBeaconlistenerselectCobaltStrike->Listenersonthemainmenuandpress
theAddbuttonatthebottomoftheListenerstabdisplay.
TheNewListenerpaneldisplays.
UserGuide www.helpsystems.com page:34
ListenerandInfrastructureManagement/DNSBeacon
Figure22.DNSBeaconOptions
SelectBeaconDNSasthePayloadtypeandgivethelisteneraName.Makesuretogivethenew
listeneramemorablenameasthisnameishowyouwillrefertothislistenerthroughCobalt
Strike’scommandsandworkflows.
Parameters
DNSHosts-Press[+]toaddoneormoredomainstobeaconto.YourCobaltStriketeamserver
systemmustbeauthoritativeforthedomainsyouspecify.CreateaDNSArecordand
pointittoyourCobaltStriketeamserver.UseDNSNSrecordstodelegateseveral
domainsorsub-domainstoyourCobaltStriketeamserver’sArecord.
Thelengthofthebeaconhostlistinbeaconpayloadislimitedto255characters.This
includesarandomlyassignedURIforeachhostanddelimitersbetweeneachiteminthe
list.Ifthelengthisexceeded,hostswillbedroppedfromtheendofthelistuntilitfitsin
thespace.Therewillbemessagesintheteamserverlogfordroppedhosts.
UserGuide www.helpsystems.com page:35
ListenerandInfrastructureManagement/DNSBeacon
HostRotationStrategy-Thisvalueconfiguresthebeaconsbehaviorforchoosingwhichhost(s)
fromthelisttouseforegress.Selectoneofthefollowing:
round-robin:Selecttoloopthroughthelistofhostnamesintheordertheyareprovided.
Eachhostisusedforoneconnection.
random:Selecttorandomlyselectahostnamefromthelisteachtimeaconnectionis
attempted.
failover-xx:Selecttouseaworkinghostaslongaspossible.Useeachhostinthelistuntil
theyreachaconsecutivefailovercount(x)ordurationtimeperiod(m,h,d),thenuse
thenexthost.
rotate-xx:Selecttouseeachhostforaperiodoftime.Useeachhostinthelistforthe
specifiedduration(m,h,d),thenusethenexthost.
MaxRetryStategy-Thisconfiguresthebeaconsbehaviorforexitingafteranumberof
consecutivefailedconnectionattemptstotheTeamServer.Thereareseveraldefault
optionstochoosefromoryoucancreateyourownlistwiththeLISTENER_MAX_RETRY_
STRATEGIEShook.SeeLISTENER_MAX_RETRY_STRATEGIESonpage164.
none:Selecttoensurebeaconwillnotexitbecauseoffailedconnectionattempts.
exit-xxx:Thesesettingsusethesyntaxofexit-[max_attempts]-[increase_
attempts]-[duration][m,h,d].Themax_attemptvalueisthenumberof
consecutivefailedattemptsbeforebeaconwillexit.Theincrease_attemptsisthe
numberofconsecutivefailedattemptsbeforeincreasingthesleeptime.Theduration
valueisthenumberofminutes,hours,ordaystosetthenewsleeptime.
Thesleeptimewillnotbeupdatedifthecurrentsleeptimeisgreaterthanthenewly
specifieddurationvalue.Thesleeptimewillbeaffectedbythecurrentjittervalue.On
anysuccessfulconnectionthefailedattemptscountwillberesettozeroandthesleep
timewillberesettothepriorvalue.
DNSHost(Stager)-ThisconfigurestheDNSBeacon’sTXTrecordstager.Thisstagerisonly
usedwithCobaltStrikefeaturesthatrequireanexplicitstager.YourCobaltStriketeam
serversystemmustbeauthoritativeforthisdomainaswell.
Profile-AllowsabeacontobeconfiguredwithaselectedMalleableC2profilevariant.
DNSPort(Bind)-ThisfieldspecifiestheportyourDNSBeaconpayloadserverwillbindto.This
optionisusefulifyouwanttosetupportbendingredirectorsuchasaredirectorthat
acceptsconnectionsonport53butroutestheconnectiontoyourteamserveronanother
port.
DNSResolver-AllowsaDNSBeacontoegressusingaspecificDNSresolver,ratherthanusing
thedefaultDNSresolverforthetargetserver.SpecifytheIPAddressofthedesired
resolver.ThisDNSResolverisnotusedbythestageroftheDNSBeacon.
Testing
TotestyourDNSconfiguration,openaterminalandtypenslookupjibberish.beacondomain.If
yougetanArecordreplyof0.0.0.0—thenyourDNSiscorrectlysetup.Ifyoudonotgetareply,
thenyourDNSconfigurationisnotcorrectandtheDNSBeaconwillnotcommunicatewithyou.
UserGuide www.helpsystems.com page:36
ListenerandInfrastructureManagement/HTTPBeaconandHTTPSBeacon
Notes
l MakesureyourDNSrecordsreferencetheprimaryaddressonyournetworkinterface.
CobaltStrike’sDNSserverwillalwayssendresponsesfromyournetworkinterface’s
primaryaddress.DNSresolverstendtodropreplieswhentheyrequestinformationfrom
oneserver,butreceiveareplyfromanother.
l IfyouarebehindaNATdevice,makesurethatyouuseyourpublicIPaddressfortheNS
recordandsetyourfirewalltoforwardUDPtrafficonport53toyoursystem.Cobalt
StrikeincludesaDNSservertocontrolBeacon.
l TocustomizethenetworktrafficindicatorsforyourDNSbeacons,seeDNSBeaconson
page108intheMalleableC2help.
HTTP Beacon and HTTPS Beacon
TheHTTPandHTTPSbeaconsdownloadtaskswithanHTTPGETrequest.Thesebeaconssend
databackwithanHTTPPOSTrequest.Thisisthedefault.Youhaveincrediblecontroloverthe
behaviorandindicatorsinthispayloadviaMalleableC2.
HTTP(S) Listener Setup
TocreateaHTTPorHTTPSBeaconlistenerselectCobaltStrike->Listenersonthemainmenu
andpresstheAddbuttonatthebottomoftheListenerstabdisplay.
TheNewListenerpaneldisplays.
UserGuide www.helpsystems.com page:37
ListenerandInfrastructureManagement/HTTPBeaconandHTTPSBeacon
Figure19.HTTPBeaconOptions
SelectBeaconHTTPorBeaconHTTPSasthePayloadtypeandgivethelisteneraName.Make
suretogivethenewlisteneramemorablenameasthisnameishowyouwillrefertothis
listenerthroughCobaltStrike’scommandsandworkflows.
Parameters
HTTP(S)Hosts-Press[+]toaddoneormorehostsfortheHTTPBeacontocallhometo.Press
[-]toremoveoneormorehosts.Press[X]toclearthecurrenthosts.Ifyouhavemultiple
hosts,youcanstillpasteacomma-separatedlistofcallbackhostsintothisdialog.
Thelengthofthebeaconhostlistinbeaconpayloadislimitedto255characters.This
includesarandomlyassignedURIforeachhostanddelimitersbetweeneachiteminthe
list.Ifthelengthisexceeded,hostswillbedroppedfromtheendofthelistuntilitfitsin
thespace.Therewillbemessagesintheteamserverlogfordroppedhosts.
UserGuide www.helpsystems.com page:38
ListenerandInfrastructureManagement/HTTPBeaconandHTTPSBeacon
HostRotationStrategy-Thisvalueconfiguresthebeaconsbehaviorforchoosingwhichhost(s)
fromthelisttouseforegress.Selectoneofthefollowing:
round-robin:Selecttoloopthroughthelistofhostnamesintheordertheyareprovided.
Eachhostisusedforoneconnection.
random:Selecttorandomlyselectahostnamefromthelisteachtimeaconnectionis
attempted.
failover-xx:Selecttouseaworkinghostaslongaspossible.Useeachhostinthelistuntil
theyreachaconsecutivefailovercount(x)ordurationtimeperiod(m,h,d),thenuse
thenexthost.
rotate-xx:Selecttouseeachhostforaperiodoftime.Useeachhostinthelistforthe
specifiedduration(m,h,d),thenusethenexthost.
MaxRetryStategy-Thisconfiguresthebeaconsbehaviorforexitingafteranumberof
consecutivefailedconnectionattemptstotheTeamServer.Thereareseveraldefault
optionstochoosefromoryoucancreateyourownlistwiththeLISTENER_MAX_RETRY_
STRATEGIEShook.SeeLISTENER_MAX_RETRY_STRATEGIESonpage164.
none:Selecttoensurebeaconwillnotexitbecauseoffailedconnectionattempts.
exit-xxx:Thesesettingsusethesyntaxofexit-[max_attempts]-[increase_
attempts]-[duration][m,h,d].Themax_attemptvalueisthenumberof
consecutivefailedattemptsbeforebeaconwillexit.Theincrease_attemptsisthe
numberofconsecutivefailedattemptsbeforeincreasingthesleeptime.Theduration
valueisthenumberofminutes,hours,ordaystosetthenewsleeptime.
Thesleeptimewillnotbeupdatedifthecurrentsleeptimeisgreaterthanthenewly
specifieddurationvalue.Thesleeptimewillbeaffectedbythecurrentjittervalue.On
anysuccessfulconnectionthefailedattemptscountwillberesettozeroandthesleep
timewillberesettothepriorvalue.
HTTPHost(Stager)-ThiscontrolsthehostoftheHTTPStagerfortheHTTPBeacon.Thisvalue
isonlyusedifyoupairthispayloadwithanattackthatrequiresanexplicitstager.
Profile-ThisiswhereyouselectaMalleableC2profilevariant.Avariantisawayofspecifying
multipleprofilevariationsinonefile.Withvariants,eachHTTPorHTTPSlisteneryou
setupcanhavedifferentnetworkindicators.
HTTPPort(C2)-ThisfieldsetstheportyourHTTPBeaconwillphonehometo.
HTTPPort(Bind)-ThisfieldspecifiestheportyourHTTPBeaconpayloadwebserverwillbind
to.Theseoptionsareusefulifyouwanttosetupportbendingredirectors(e.g.,a
redirectorthatacceptsconnectionsonport80or443butroutestheconnectiontoyour
teamserveronanotherport).
HTTPHostHeader-Thisvalue,ifspecified,ispropagatedtoyourHTTPstagersandthrough
yourHTTPcommunication.Thisoptionmakesiteasiertotakeadvantageofdomain
frontingwithCobaltStrike.
HTTPProxy-Pressthe…buttontospecifyanexplicitproxyconfigurationforthispayload.
UserGuide www.helpsystems.com page:39
ListenerandInfrastructureManagement/HTTPBeaconandHTTPSBeacon
Manual HTTP Proxy Configuration
The(Manual)ProxySettingsdialogoffersseveraloptionstocontroltheproxyconfigurationfor
Beacon’sHTTPandHTTPSrequests.ThedefaultbehaviorofBeaconistousetheInternet
Explorerproxyconfigurationforthecurrentprocess/usercontext.
Figure20.ManualProxySettings
TheTypefieldconfiguresthetypeofproxy.TheHostandPortfieldstellBeaconwherethe
proxylives.TheUsernameandPasswordfieldsareoptional.Thesefieldsspecifythecredentials
Beaconusestoauthenticatetotheproxy.
ChecktheIgnoreproxysettings;usedirectconnectionboxtoforceBeacontoattemptits
HTTPandHTTPSrequestswithoutgoingthroughaproxy.
PressSettoupdatetheBeacondialogwiththedesiredproxysettings.PressResettosetthe
proxyconfigurationbacktothedefaultbehavior.
NOTE:
ThemanualproxyconfigurationaffectstheHTTPandHTTPSBeaconpayloadstagesonly.It
doesnotpropagatetothepayloadstagers.
Redirectors
Aredirectorisasystemthatsitsbetweenyourtarget’snetworkandyourteamserver.Any
connectionsthatcometotheredirectorareforwardedtoyourteamservertoprocess.A
redirectorisawaytoprovidemultiplehostsforyourBeaconpayloadstocallhometo.A
redirectoralsoaidsoperationalsecurityasitmakesithardertotracethetruelocationofyour
teamserver.
CobaltStrike’slistenermanagementfeaturessupporttheuseofredirectors.Simplyspecifyyour
redirectorhostswhenyousetupanHTTPorHTTPSBeaconlistener.CobaltStrikedoesnot
UserGuide www.helpsystems.com page:40
ListenerandInfrastructureManagement/SMBBeacon
validatethisinformation.Ifthehostyouprovideisnotaffiliatedwiththecurrenthost,Cobalt
Strikeassumesit’saredirector.Onesimplewaytoturnaserverintoaredirectoristousesocat.
Here’sthesocatsyntaxtoforwardallconnectionsonport80totheteamserverat
192.168.12.100onport80:
socat TCP4-LISTEN:80,fork TCP4:192.168.12.100:80
SMB Beacon
TheSMBBeaconusesnamedpipestocommunicatethroughaparentBeacon.Thispeer-to-peer
communicationworkswithBeaconsonthesamehost.Italsoworksacrossthenetwork.
WindowsencapsulatesnamedpipecommunicationwithintheSMBprotocol.Hence,thename,
SMBBeacon.
SMB Listener Setup
TocreateaSMBBeaconlistenerselectCobaltStrike->Listenersonthemainmenuandpress
theAddbuttonatthebottomoftheListenerstabdisplay.
TheNewListenerpaneldisplays.
Figure23.SMBBeacon
SelectBeaconSMBasthePayloadtypeandgivethelisteneraName.Makesuretogivethe
newlisteneramemorablenameasthisnameishowyouwillrefertothislistenerthroughCobalt
Strike’scommandsandworkflows.
TheonlyoptionassociatedwiththeSMBBeaconisthePipename(C2).Youcansetanexplicit
pipenameoracceptthedefaultoption.
UserGuide www.helpsystems.com page:41
ListenerandInfrastructureManagement/SMBBeacon
TheSMBBeaconiscompatiblewithmostactionsinCobaltStrikethatspawnapayload.The
exceptiontothisaretheuser-drivenattacks(e.g.,Attacks->Packages,Attacks->WebDrive-
by)thatrequireexplicitstagers.
CobaltStrikepost-exploitationandlateralmovementactionsthatspawnapayloadwillattempt
toassumecontrolof(link)totheSMBBeaconpayloadforyou.IfyouruntheSMBBeacon
manually,youwillneedtolinktoitfromaparentBeacon.
Linking and Unlinking
FromtheBeaconconsole,uselink[host][pipe]tolinkthecurrentBeacontoanSMBBeacon
thatiswaitingforaconnection.WhenthecurrentBeaconchecksin,itslinkedpeerswillcheck
intoo.
Toblendinwithnormaltraffic,linkedBeaconsuseWindowsnamedpipestocommunicate.This
trafficisencapsulatedintheSMBprotocol.Thereareafewcaveatstothisapproach:
1. HostswithanSMBBeaconmustacceptconnectionsonport445.
2. YoumayonlylinkBeaconsmanagedbythesameCobaltStrikeinstance.
Ifyougetanerror5(accessdenied)afteryoutrytolinktoaBeacon:stealadomainuser’stoken
orusemake_tokenDOMAIN\userpasswordtopopulateyourcurrenttokenwithvalid
credentialsforthetarget.TrytolinktotheBeaconagain.
TodestroyaBeaconlinkuseunlink[ipaddress][sessionPID]intheparentorchild.The[session
PID]argumentistheprocessIDoftheBeacontounlink.Thisvalueishowyouspecifyaspecific
Beacontode-linkwhentherearemultiplechildnBeacons.
Whenyoude-linkanSMBBeacon,itdoesnotexitandgoaway.Instead,itgoesintoastate
whereitwaitsforaconnectionfromanotherBeacon.Youmayusethelinkcommandtoresume
controloftheSMBBeaconfromanotherBeaconinthefuture.
Beacon Covert Peer-to-Peer Communication
It'shardtostayhiddenwhenmanycompromisedsystemscallouttotheinternet.UseBeacon's
peer-to-peercommunicationtosolvethisproblem.ThisfeatureletsyoulinkBeaconstoeach
other.LinkedBeaconsdownloadtasksandsendoutputthroughtheirparentBeacon.
UsemodesmbtotransformaBeaconintoapeerthatwaitsforanotherBeacontoconnect.
Uselink[ipaddress]tolinkthecurrentBeacontoapeerthatiswaitingforaconnection.When
thecurrentBeaconchecksin,itslinkedpeerswillcheckintoo.
Toblendinwithnormaltraffic,linkedBeaconsuseSMBpipestocommunicate.Thereareafew
caveatstothisapproach:
1. HostswithaBeaconpeermustacceptconnectionsonport445.
2. YoumayonlylinkBeaconsmanagedbythesameCobaltStrikeinstance.
Ifyougetanerror5(accessdenied)whenyoutrytolinktoaBeacon:stealadomainuser's
tokenoruseshellnetuse\\host/U:DOMAIN\userpasswordtoestablishasessionwiththe
UserGuide www.helpsystems.com page:42
ListenerandInfrastructureManagement/TCPBeacon
host.Anadministratoruserisnotrequiredforthis.Anyvaliddomainuserwilldo.Onceyou
haveasession,trytolinktotheBeaconagain.
TodestroyaBeaconlinkuseunlink[ipaddress]intheparentorchild.Later,youmaylinktoto
theunlinkedBeaconagain(orlinktoitfromanotherBeacon).
OnceaBeaconbecomesapeer,thereisnowaytomakeitbeaconoverHTTPorDNSagain.If
you'dliketokillaBeaconpeer,usetheexitcommand.Ifyou'dliketomakethehostbeacon
overHTTPorDNS,tasktheBeaconpeertogiveyouanotherBeaconsession.
Beacon Peer as a Payload
Somesystemscan'ttalktotheinternet.Inthesecases,it'snicetohaveawaytodeliveraready-
to-linkBeaconsoyoumayconnecttoit.Use[host]->Login->psexecor[host]->Login->