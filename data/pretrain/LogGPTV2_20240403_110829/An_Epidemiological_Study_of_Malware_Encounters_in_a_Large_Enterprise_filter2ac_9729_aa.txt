title:An Epidemiological Study of Malware Encounters in a Large Enterprise
author:Ting-Fang Yen and
Victor Heorhiadi and
Alina Oprea and
Michael K. Reiter and
Ari Juels
An Epidemiological Study of Malware Encounters
in a Large Enterprise
Ting-Fang Yen
E8 Security
PI:EMAIL
Victor Heorhiadi
University of North Carolina at
Chapel Hill
PI:EMAIL
Alina Oprea
RSA Laboratories
PI:EMAIL
Michael K. Reiter
University of North Carolina at
Chapel Hill
PI:EMAIL
ABSTRACT
We present an epidemiological study of malware encounters in a
large, multi-national enterprise. Our data sets allow us to observe
or infer not only malware presence on enterprise computers, but
also malware entry points, network locations of the computers (i.e.,
inside the enterprise network or outside) when the malware were
encountered, and for some web-based malware encounters, web
activities that gave rise to them. By coupling this data with demo-
graphic information for each host’s primary user, such as his or her
job title and level in the management hierarchy, we are able to paint
a reasonably comprehensive picture of malware encounters for this
enterprise. We use this analysis to build a logistic regression model
for inferring the risk of hosts encountering malware; those ranked
highly by our model have a > 3× higher rate of encountering mal-
ware than the base rate. We also discuss where our study conﬁrms
or refutes other studies and guidance that our results suggest.
Categories and Subject Descriptors
K.6.5 [Management of Computing and Information Systems]:
Security and Protection—Invasive Software; C.2.0 [Computer-
Communication Networks]: General—Security and Protection
Keywords
Malware encounters, enterprise security, measurement, logistic re-
gression
1.
INTRODUCTION
In this paper, we present the ﬁrst epidemiological study of mal-
ware encounters within a large enterprise. Formally, epidemiology
“deals with the incidence, distribution, and control of disease in a
population” [1] — the disease, in our setting, being malware. We
explore in this sense the patterns and causes of malware encoun-
ters within a population, namely the hosts and employees of the
enterprise under study. Our work beneﬁts from privileged access to
security logs generated within this enterprise, as well as databases
Permission to make digital or hard copies of part or all of this work for personal or
classroom use is granted without fee provided that copies are not made or distributed
for proﬁt or commercial advantage, and that copies bear this notice and the full ci-
tation on the ﬁrst page. Copyrights for third-party components of this work must be
honored. For all other uses, contact the owner/author(s). Copyright is held by the
author/owner(s).
CCS’14, November 3–7, 2014, Scottsdale, Arizona, USA.
ACM 978-1-4503-2957-6/14/11.
http://dx.doi.org/10.1145/2660267.2660330 .
Ari Juels
Cornell Tech
PI:EMAIL
containing information about the employees using the hosts on the
enterprise network. By agreement with the security administrators
of the enterprise, we omit its name from this paper.
Malware spread is a well-studied problem in consumer environ-
ments. It is far less well studied, however, in enterprise settings,
which may differ in important ways from consumer contexts. Cor-
porate computing resources are subject to tighter security policies
and beneﬁt from more expert security administration than most
consumer devices. Corporations possess digital assets, however,
including ﬁnancial data and intellectual property, far more valuable
than the data on most consumer devices. Enterprise data might
thus be subject to highly sophisticated targeted attacks in which
malware often plays a pivotal role.
Enterprise host security also merits study in its own right. Enter-
prises are interesting microcosms in which users (employees) are
assigned highly speciﬁc demographic classiﬁcations in the form of
job titles, business-unit placement, and level in the management
hierarchy. Employees are also subject to more or less uniform se-
curity policies across an enterprise and use similar (if not identi-
cal) O/S and software versions, creating a controlled environment
amenable to scientiﬁc study. As employee behavior on an enter-
prise network is subject to monitoring by the enterprise, and many
hosts are instrumented with software (e.g., anti-virus) that gener-
ates internal reports, enterprises additionally have data about the
behavior of their users unavailable in many consumer settings or
whose use would infringe upon users’ legal rights.
Our study and results: We rely on reporting by anti-virus soft-
ware (McAfee), with which 85,000+ hosts owned and managed by
the enterprise are instrumented. As these are cases where malware
was detected and presumably prevented from executing, we bor-
row from existing terminology [12] and refer to them as malware
encounters rather than infections.
We study these encounters from several distinct perspectives.
First, by examining the ﬁle system locations of detected malware
instances, we characterize the vectors by which malware gains ac-
cess to hosts (e.g., external drive, web). Second, we quantify the
frequency of “inside” encounters—those occurring while hosts are
connected to the enterprise network, either over VPN or on the
LAN—and “outside” encounters (when employees take hosts home
or to customer sites). Third, we correlate malware reports with
demographic information about hosts’ users, including their job
roles, levels in the management hierarchy of the company, and ge-
ographic locations. Finally, we examine encounters resulting from
host visits to malicious web sites, drawing on enterprise web proxy
1117logs to ascertain the browsing behavior underlying these encoun-
ters.
Many of our data sources do not provide direct indications of the
host and user behaviors of interest, and inferring these behaviors in
some cases presents interesting technical challenges. For example,
McAfee anti-virus software reports do not indicate whether hosts
are inside the enterprise network (“on-network”) or outside (“off-
network”) at the time of a malware encounter. We thus classify
encounters based on reporting delay times.
management hierarchy.
than on-network encounters.
We present a number of interesting ﬁndings, including several
that, to the best of our knowledge, reﬂect previously unstudied phe-
nomena. Some key ﬁndings in the enterprise under study are:
• Off-network encounters are roughly three times more common
• Encounter rates are lowest at the upper levels of the corporate
• External drives are the most common vector of malware en-
counters, and especially prevalent in low per-capita GDP coun-
tries.
• Roughly 31% of the web-based malware encounters (around
554 over four months, as extrapolated from encounters trace-
able to proxy logs) originate from websites classiﬁed by the
enterprise web proxy into the “business” category, and 15%
(around 266, similarly extrapolated over four months) originate
from the “travel” category.
We present these and other results and offer some conjectural ex-
planations below.
Finally, drawing together the data sources examined in our study,
we identify features (demographic and behavioral) that correlate
signiﬁcantly with a host encountering malware. We use these fea-
tures to construct a logistic regression model that estimates the en-
counter risk associated with individual hosts. This model success-
fully identiﬁes high-risk hosts: the encounter rate among the top
1,000 identiﬁed hosts is 51%, signiﬁcantly more than three times
the base rate for the enterprise as a whole.
Our contributions: Our main contributions are:
• We present the ﬁrst large-scale epidemiological study of enter-
prise malware encounters, based on analysis of a repository of
sensitive enterprise security data.
• We correlate malware encounters on hosts with a variety of de-
mographic and behavioral features for users (job roles, web
browsing behavior, etc.), many of them previously unstudied.
Our study yields a number of signiﬁcant ﬁndings.
• We build a logistic regression model across a subset of these
features that successfully identiﬁes hosts with a signiﬁcantly el-
evated risk of encountering malware.
While our ﬁndings are illuminating (and sometimes counter-
intuitive) in their own right, we believe they can also help shape
enterprise security policy, select effective security tools, and create
targeted security education programs for employees. We empha-
size that our study treats a single (albeit, large) enterprise; its wider
applicability, of course, requires further investigation. We believe
that case studies of this kind are individually informative and also
important steps toward the creation of a portfolio of real-world re-
search results that can illuminate broad practices and trends.
2. DATA
review the ethical and privacy considerations affecting our work
(Section 2.6).
2.1 Anti-Virus Reports
We examine reports collected from McAfee anti-virus agents de-
ployed on 85,000+ hosts owned and managed by the enterprise. In
addition to matching known virus signatures, the McAfee agent
also detects suspicious ﬁles using a cloud-based reputation ser-
vice (McAfee Global Threat Intelligence).1 Detection occurs in
on-access mode, where a ﬁle object is scanned as it is read into
memory, after which the suspicious ﬁle is deleted or quarantined.
Reports generated by the McAfee agent are sent from the end
hosts to a centralized data collector within the enterprise network
immediately upon generation. If the host is outside the corporate
network or the collection server is otherwise inaccessible, the agent
will buffer reports on the host and attempt to re-send every ﬁve
minutes. Due to storage and bandwidth constraints, only reports for
detected malware are collected, which excludes data about, e.g., re-
sults of virus scan on “clean” end hosts or time of the last signature
update.
Table 1 shows the ﬁelds available in each McAfee report.
In
addition to the host name, virus name, and ﬁle path, each report
also includes two timestamps: One indicating the time when the
malicious ﬁle was detected on the end host, and another the time
when this report was received at the data collection server. We note,
with conﬁrmation from the enterprise’s IT team, that no buffering
is performed during the data collection process that would affect
the timestamps we use.
Field
Host name
Virus name
File path
Detection time
Reporting time
Description
A fully-qualiﬁed domain name that
serves as an unique identiﬁer for the
end host on the enterprise network.
The name of the identiﬁed threat
(according to McAfee).
The full path of the malicious ﬁle.
Time of detection on the end host.
Time of collection at the enterprise
data collection server.
Table 1: Fields in McAfee reports.
Over a four-month period, from July 10 to November 10, 2013,
the centralized data collector received a total of 569,967 reports.
However, many of those reports appear to be redundant, with the
same {host name, virus name, ﬁle path} tuple repeated within an
interval of seconds. 87.76% of them appear less than one minute
apart from a previous, identical report. Most of these redundant
reports are due to the McAfee agent attempting to delete or quar-
antine read-only ﬁles. For reports with the same {host name, virus
name, ﬁle path} tuple, we retain the report with the earliest detec-
tion timestamp and exclude the remainder from consideration.
We also discovered an outlier host that generated over 10,000 re-
ports in four hours. The McAfee agent detected and deleted ﬁles
repeatedly created by malware on the host (but not the actual mal-
ware binary). There are also a small number of “false-positive”
reports (2,132 reports) whose detected malicious ﬁles were sample
malware from security certiﬁcation courses or research activities;
e.g., the ﬁle paths included directories names like “PenTesting” or
We leverage multiple data sources to study malware encounters
in the enterprise under study. We give details in this section on the
ﬁve major data sources in our study (Section 2.1-Section 2.5) and
1http://www.mcafee.com/us/
threat-center/technology/
global-threat-intelligence-technology.aspx
1118“CEHv8 Module”. We also ﬁlter these reports out. Our ﬁltered
dataset includes 120,161 reports from 10,941 distinct hosts.
2.2 Employee Database
The enterprise also stores information about each employee that
includes the employee’s name, the employee ID number, ofﬁce lo-
cation, business unit, job title, and manager ID number. We infer
additional information about each employee based on this dataset.
From the job title, we categorize a user’s job type as the last word
in the job title after stripping away level indicators (e.g., “engineer
I” and “engineer II” are both considered “engineers”). Given each
employee’s manager ID, we build the organization tree with the
company CEO as root. This allows us to assign a “level” to each
employee based on the number of steps down from the tree root.
2.3 Windows Authentication Logs
While the McAfee reports and employee data each contain much
useful information, correlating the two is a non-trivial task —
McAfee reports are associated with hosts, while employee data is
about users. Lacking documentation about machine assignments
in the enterprise, we draw on a third data source to bridge this gap:
Windows authentication logs from domain controllers (DC).
The DCs are responsible for validating authentication requests
to access resources on a Windows domain. For example, when a
user logs on to her corporate machine, the request is sent to the DC,
where her credentials are veriﬁed. Each authentication log includes
the user name, the host where access was requested, the timestamp,
and other ﬁelds indicating the type of logon and whether the logon
was successful.
To infer the primary user of a host, we examine Windows au-
thentication logs over one month. For every host, a list is kept
documenting the users that successfully authenticated to the host.
After this month, the user responsible for a large majority (80%) of
the logons on the host is assumed to be the primary user. If no such
user exists for a host, it is assumed to be a multi-user server and re-
moved from further consideration.2 In this way, we determined the
primary user for 62,884 enterprise-managed hosts that are instru-
mented with the McAfee client, of which 9,625 generated malware
reports during our four-month observation period. In our study, we
focus on the hosts for which a primary user can be identiﬁed.
2.4 Web Proxy Logs
In addition to anti-virus software, the enterprise network deploys
a variety of security tools to prevent unwanted software and intru-
sions. One is a Cisco IronPort web proxy that ﬁlters HTTP and
HTTPS requests. The proxy vendor provides reputation scores and
category information (e.g., business, news, sports) for known sites,
and the ﬁltering policy blocks connections to websites with low
reputation or in non-business-related categories.
In cases where a web request is made to a previously unknown
website lacking reputation and category, the proxy instead displays
a warning page to the user, stating that the site is considered higher
risk. The user is asked to acknowledge that access to the site ad-
heres to the company’s security policies before being allowed to
proceed. Once the user has acknowledged, her consent is valid for
one hour. During this time, visits to other non-categorized websites
are allowed without further prompting from the proxy.
Part of our study examines the effectiveness of the web proxy’s
ﬁltering policy at preventing malware infections. For this, we make
2Not all of the enterprise servers are instrumented with McAfee
anti-virus, unlike end hosts. Moreover, as they are multi-user, their
behaviors could not be attributed to a primary user for inclusion in
the demographics aspects of our study.
use of logs generated by the web proxy, which include the times-