# Title: An Epidemiological Study of Malware Encounters in a Large Enterprise

# Authors:
- Ting-Fang Yen, E8 Security, [EMAIL]
- Victor Heorhiadi, University of North Carolina at Chapel Hill, [EMAIL]
- Alina Oprea, RSA Laboratories, [EMAIL]
- Michael K. Reiter, University:// North Carolina at Chapel Hill, [EMAIL]
- Ari Juels, Cornell Tech, [EMAIL]

## Abstract
This paper presents an epidemiological study of malware encounters within a large, multi-national enterprise. Our data sets provide comprehensive insights into the presence and entry points of malware on enterprise computers, as well as the network locations (inside or outside the enterprise network) and web activities that led to these encounters. By integrating this data with demographic information about the primary users of each host, such as job titles and management levels, we offer a detailed picture of malware encounters in this enterprise. We use this analysis to build a logistic regression model for inferring the risk of hosts encountering malware. Hosts ranked highly by our model have a >3× higher rate of encountering malware than the base rate. We also discuss how our findings confirm or refute other studies and provide guidance based on our results.

## Categories and Subject Descriptors
- K.6.5 [Management of Computing and Information Systems]: Security and Protection—Invasive Software
- C.2.0 [Computer-Communication Networks]: General—Security and Protection

## Keywords
Malware encounters, enterprise security, measurement, logistic regression

## 1. Introduction
In this paper, we present the first epidemiological study of malware encounters within a large enterprise. Epidemiology is defined as the study of the incidence, distribution, and control of disease in a population. In our context, the "disease" is malware. We explore the patterns and causes of malware encounters within the population of hosts and employees of the enterprise under study. Our work benefits from privileged access to security logs generated within the enterprise, as well as databases containing information about the employees using the hosts on the enterprise network. By agreement with the security administrators of the enterprise, we omit its name from this paper.

### Background
Malware spread has been extensively studied in consumer environments but is less well-studied in enterprise settings, which differ significantly from consumer contexts. Corporate computing resources are subject to stricter security policies and benefit from more expert security administration than most consumer devices. However, corporations possess valuable digital assets, including financial data and intellectual property, making them targets for sophisticated attacks where malware plays a pivotal role.

### Enterprise Host Security
Enterprise host security is an important area of study. Enterprises are microcosms where users (employees) are assigned specific demographic classifications, such as job titles, business-unit placement, and management levels. Employees are subject to uniform security policies and use similar operating systems and software versions, creating a controlled environment amenable to scientific study. Additionally, employee behavior on an enterprise network is monitored, and many hosts are instrumented with software (e.g., anti-virus) that generates internal reports, providing data unavailable in many consumer settings.

### Our Study and Results
We rely on reporting by anti-virus software (McAfee), with which over 85,000 hosts owned and managed by the enterprise are instrumented. These are cases where malware was detected and presumably prevented from executing, referred to as malware encounters rather than infections.

Our study examines these encounters from several perspectives:
1. **Malware Vectors**: Characterizing the methods by which malware gains access to hosts (e.g., external drives, web).
2. **Network Location**: Quantifying the frequency of "inside" encounters (on the enterprise network) and "outside" encounters (off the network).
3. **Demographic Correlation**: Correlating malware reports with demographic information about the users, including job roles, management levels, and geographic locations.
4. **Web-Based Encounters**: Examining encounters resulting from visits to malicious websites, using web proxy logs to ascertain the browsing behavior underlying these encounters.

Many of our data sources do not provide direct indications of host and user behaviors, and inferring these behaviors presents technical challenges. For example, McAfee anti-virus reports do not indicate whether hosts are inside or outside the enterprise network at the time of a malware encounter. We classify encounters based on reporting delay times.

### Key Findings
- **Off-Network Encounters**: Off-network encounters are roughly three times more common than on-network encounters.
- **Encounter Rates by Management Level**: Encounter rates are lowest at the upper levels of the corporate management hierarchy.
- **Common Vectors**: External drives are the most common vector of malware encounters, especially prevalent in low per-capita GDP countries.
- **Web-Based Encounters**: Approximately 31% of web-based malware encounters (around 554 over four months) originate from websites classified by the enterprise web proxy into the "business" category, and 15% (around 266) originate from the "travel" category.

### Logistic Regression Model
Drawing together the data sources examined in our study, we identify features (demographic and behavioral) that correlate significantly with a host encountering malware. We use these features to construct a logistic regression model that estimates the encounter risk associated with individual hosts. This model successfully identifies high-risk hosts: the encounter rate among the top 1,000 identified hosts is 51%, significantly more than three times the base rate for the enterprise as a whole.

### Contributions
- **First Large-Scale Epidemiological Study**: We present the first large-scale epidemiological study of enterprise malware encounters, based on a repository of sensitive enterprise security data.
- **Correlation with Demographic and Behavioral Features**: We correlate malware encounters on hosts with a variety of demographic and behavioral features for users, many of which were previously unstudied.
- **Logistic Regression Model**: We build a logistic regression model that successfully identifies hosts with a significantly elevated risk of encountering malware.

While our findings are illuminating and sometimes counterintuitive, they can help shape enterprise security policy, select effective security tools, and create targeted security education programs for employees. We emphasize that our study treats a single, albeit large, enterprise; its wider applicability requires further investigation. Case studies like this are individually informative and important steps toward the creation of a portfolio of real-world research results that can illuminate broad practices and trends.

## 2. Data
In this section, we review the ethical and privacy considerations affecting our work (Section 2.6) and detail the five major data sources used in our study (Sections 2.1-2.5).

### 2.1 Anti-Virus Reports
We examine reports collected from McAfee anti-virus agents deployed on over 85,000 hosts owned and managed by the enterprise. The McAfee agent detects known virus signatures and suspicious files using a cloud-based reputation service (McAfee Global Threat Intelligence). Detection occurs in on-access mode, where a file object is scanned as it is read into memory, after which the suspicious file is deleted or quarantined. Reports are sent from the end hosts to a centralized data collector within the enterprise network immediately upon generation. If the host is outside the corporate network or the collection server is inaccessible, the agent buffers reports on the host and attempts to re-send every five minutes. Only reports for detected malware are collected, excluding data about clean end hosts or the last signature update.

**Table 1: Fields in McAfee Reports**
| Field               | Description                                                                 |
|---------------------|-----------------------------------------------------------------------------|
| Host name           | A fully-qualified domain name that serves as a unique identifier for the end host on the enterprise network. |
| Virus name          | The name of the identified threat (according to McAfee).                    |
| File path           | The full path of the malicious file.                                         |
| Detection time      | Time of detection on the end host.                                          |
| Reporting time      | Time of collection at the enterprise data collection server.                |

Over a four-month period, from July 10 to November 10, 2013, the centralized data collector received a total of 569,967 reports. Many reports appear redundant, with the same {host name, virus name, file path} tuple repeated within seconds. 87.76% of these reports appear less than one minute apart from a previous, identical report. Most redundant reports are due to the McAfee agent attempting to delete or quarantine read-only files. For reports with the same {host name, virus name, file path} tuple, we retain the report with the earliest detection timestamp and exclude the remainder.

We also discovered an outlier host that generated over 10,000 reports in four hours. The McAfee agent detected and deleted files repeatedly created by malware on the host (but not the actual malware binary). There are also a small number of "false-positive" reports (2,132 reports) whose detected malicious files were sample malware from security certification courses or research activities. We filter these reports out, resulting in a dataset of 120,161 reports from 10,941 distinct hosts.

### 2.2 Employee Database
The enterprise stores information about each employee, including their name, employee ID number, office location, business unit, job title, and manager ID number. We infer additional information about each employee based on this dataset. From the job title, we categorize a user's job type as the last word in the job title after stripping away level indicators (e.g., "engineer I" and "engineer II" are both considered "engineers"). Given each employee’s manager ID, we build the organization tree with the company CEO as the root, allowing us to assign a "level" to each employee based on the number of steps down from the tree root.

### 2.3 Windows Authentication Logs
While the McAfee reports and employee data each contain useful information, correlating the two is non-trivial. McAfee reports are associated with hosts, while employee data is about users. Lacking documentation about machine assignments, we use Windows authentication logs from domain controllers (DCs) to bridge this gap. DCs validate authentication requests to access resources on a Windows domain. Each authentication log includes the user name, the host where access was requested, the timestamp, and other fields indicating the type of logon and whether the logon was successful.

To infer the primary user of a host, we examine Windows authentication logs over one month. For every host, a list is kept documenting the users that successfully authenticated to the host. After this month, the user responsible for a large majority (80%) of the logons on the host is assumed to be the primary user. If no such user exists, the host is assumed to be a multi-user server and removed from further consideration. This way, we determined the primary user for 62,884 enterprise-managed hosts instrumented with the McAfee client, of which 9,625 generated malware reports during our four-month observation period. Our study focuses on the hosts for which a primary user can be identified.

### 2.4 Web Proxy Logs
In addition to anti-virus software, the enterprise network deploys a variety of security tools, including a Cisco IronPort web proxy that filters HTTP and HTTPS requests. The proxy vendor provides reputation scores and category information (e.g., business, news, sports) for known sites, and the filtering policy blocks connections to websites with low reputation or in non-business-related categories.

For previously unknown websites lacking reputation and category, the proxy displays a warning page to the user, stating that the site is considered higher risk. The user is asked to acknowledge that access to the site adheres to the company’s security policies before being allowed to proceed. Once the user has acknowledged, their consent is valid for one hour, allowing visits to other non-categorized websites without further prompting.

Part of our study examines the effectiveness of the web proxy’s filtering policy at preventing malware infections. We use logs generated by the web proxy, which include the times of web requests, to analyze these encounters.