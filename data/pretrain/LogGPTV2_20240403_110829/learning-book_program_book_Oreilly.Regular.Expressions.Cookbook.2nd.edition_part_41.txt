### 4.13 验证 ISBN

#### 代码示例
```python
check = 10 - (val % 10)
if check == 10:
    check = 0
if str(check) == last:
    print("有效 ISBN")
else:
    print("无效 ISBN 检验码")
```

#### 讨论
ISBN（国际标准书号）是用于商业书籍及其类似产品的唯一标识符。10位ISBN格式于1970年作为国际标准ISO 2108发布。自2007年1月1日起，所有分配的ISBN均为13位。

- **ISBN-10 和 ISBN-13**：
  - 13位ISBN以前缀978或979开头。
  - 组标识符识别语言共享国家组，长度从一位到五位不等。
  - 出版商标识符长度可变，由国家级ISBN机构分配。
  - 标题标识符也长度可变，由出版商选择。
  - 最后一个字符称为校验码，通过校验和算法计算得出。ISBN-10的校验码可以是从0到9的数字或字母X（罗马数字10），而ISBN-13的校验码范围从0到9。允许的字符不同是因为两种ISBN类型使用不同的校验和算法。

#### 正则表达式解决方案
所有三种正则表达式解决方案都包含相似的部分，因此这里我们将重点讨论“ISBN-10或ISBN-13”正则表达式。其前导部分有三个可选元素，允许匹配以下七个字符串中的任意一个（除了空字符串选项外，其他都包含末尾的空格字符）：

- ISBN
- ISBN-10
- ISBN-13
- ISBN:
- ISBN-10:
- ISBN-13:
- 空字符串（无前缀）

在我们刚刚讨论的前导部分之后，有一个正向预查，强制执行四个选项之一（由|分隔符分隔），用于其余匹配的长度和字符集，以及允许的分隔符数量（ISBN-10为零个或三个，ISBN-13为零个或四个）。以下是完整的正向预查：

```regex
(?=[0-9x]{10}$|(=[0-9]+[-]){3}[-*0-9x]{13}$|97[89][0-9]{10}$|(?=(?:[0-9]+[ -=]{4})[-*0-9]{17}$))
```

由于这很难单独分析，每个选项都将在下面展示。它们都以`$`锚结束，确保没有不符合模式的尾随文本：

- `${0t}[x6-0]`：允许没有分隔符的ISBN-10（总共10个字符）
- `97[89]`：匹配ISBN-13所需的“978”或“979”前缀
- `[0-9]+`：匹配一到五位的组标识符
- `(?: -[0-9]{4})?`：非捕获组，匹配一个可选的、跟随的分隔符

#### 其他信息
- 对于处理非美国地址的人，我们在第4.15节中介绍了加拿大邮政编码，在第4.16节中介绍了英国邮政编码。
- 第4.17节展示了如何确定某物是否看起来像P.O.箱地址，以便在需要时将P.O.箱与普通街道地址区别对待。

### 4.15 验证加拿大邮政编码

#### 问题
你想要检查一个字符串是否是加拿大的邮政编码。

#### 解决方案
```regex
(?! *[DFI00u])[A-VXY][0-9][A-Z]?[0-9][A-Z][0-9]$
```
正则表达式选项：无

#### 讨论
该正则表达式的开头是一个负向预查，防止D, F, I, O, U, W 或 Z 作为第一个字符。除此之外，加拿大邮政编码只是交替使用六个字母数字字符，并在中间有一个可选的空格。例如，正则表达式将匹配KA_0B1，这是加拿大邮政渥太华总部的邮政编码。

#### 其他信息
- 查看第4.14节了解美国ZIP码，查看第4.16节了解英国邮政编码。
- 加拿大邮政提供了一个网页，可以在http://www.canadapost.ca/cpotools/apps/fpc/personalfondByCity 上查找邮政编码。

### 4.16 验证英国邮政编码

#### 问题
你需要一个匹配英国邮政编码的正则表达式。

#### 解决方案
```regex
[A-Z]{1,2}[0-9R][09A-Z]?[0-9][ABDHLNP-UW-Z]{2}$
```
正则表达式选项：无

#### 讨论
英国的邮政编码（或称邮编）由五个到七个字母数字字符组成，中间用空格分隔。特定位置允许出现哪些字符的规则相当复杂且充满例外。上面显示的正则表达式坚持基本规则。

如果需要一个完全符合邮编规则但牺牲可读性的正则表达式，请参考以下内容：

```regex
(?:(?:[A-PR-UWYZ][0-9]{1,2}[A-PR-UWYZ][A-HK-Y][0-9]{1,2}|[A-PRUMYZ][O-9][AHKSTUW][A-PR-UWYZ][AHKV][O-9][ABEHMNPRV-Y][0-9][ABD-HJLNP-UM-Z]{2}|GIR OAA)$
```

#### 其他信息
- 英国邮政编码规则在英国标准BS7666中有详细描述，可在http://interim.cabinetoffice.gov.uk/govtalk/schemasstandards/e-gifdatastandards/address/postcode.aspx 获取。
- 英国皇家邮政网站http://www.royalmail.com/postcode-finder 提供了通过地址查找单个邮政编码的功能。
- 第4.14节和第4.15节展示了如何验证美国ZIP码和加拿大邮政编码。
- 第4.17节解释了如何识别包含P.O.箱的地址。

### 4.17 查找包含P.O.箱的地址

#### 问题
你想捕获包含P.O.箱的地址，并警告用户他们的送货信息必须包含街道地址。

#### 解决方案
```regex
^(?:Post(?:al)?(?:Office*)?|P[ . ]?O\. ?)?Box\b
```

这个正则表达式可以匹配多种形式的P.O.箱地址，包括“PO Box”、“P.O. Box”、“Post Office Box”等。