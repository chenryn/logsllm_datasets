19. Click the Next button immediately without modifying any options 
20. Set the Administrator password when prompted 
Advanced Wireless Attacks Against Enterprise Networks 
Step 6 - Install Domain Controller 
© 2017 Gabriel Ryan All Rights Reserved 
20 
We’re now finished with installing the Domain Controller. 
Advanced Wireless Attacks Against Enterprise Networks 
Step 7 - Install Guest Additions on Domain Controller 
© 2017 Gabriel Ryan All Rights Reserved 
21 
STEP 7 - INSTALL GUEST ADDITIONS ON DOMAIN CONTROLLER 
Next, we need to install VirtualBox guest additions the domain controller. The following steps illustrate how to do 
this on the Windows DC virtual machine, although they should work on each of your other Windows machines as 
well. 
1. Start the Windows DC VM 
2. Press [ctrl]+[alt]+[delete] to logon. 
a. Note to Mac users: since your delete key is actually a backspace, you must press [right 
command]+[fn]+[delete]. If that doesn’t work select Input > Keyboard > Insert Ctrl-Alt-Del from 
the menu bar at the top of the screen.  
3. If prompted to automatically connect to devices such as printers and TVs, select “No” 
4. In the toolbar at the top of your VirtualBox window, select Devices > Insert Guest Additions CD Image 
5. As shown in the screenshot below, go to File Explorer > This PC > CD Drive (D:) VirtualBox Guest Additions 
Advanced Wireless Attacks Against Enterprise Networks 
Step 7 - Install Guest Additions on Domain Controller 
© 2017 Gabriel Ryan All Rights Reserved 
22 
6. As shown in the screenshot below, right click VBoxWindowsAdditions-amd64 and select “Run As 
Administrator” 
Advanced Wireless Attacks Against Enterprise Networks 
Step 7 - Install Guest Additions on Domain Controller 
© 2017 Gabriel Ryan All Rights Reserved 
23 
7. Follow the prompts to install VirtualBox guest additions, then select “Reboot Now” when finished 
Advanced Wireless Attacks Against Enterprise Networks 
Step 8 - Configure Active Directory 
© 2017 Gabriel Ryan All Rights Reserved 
24 
STEP 8 - CONFIGURE ACTIVE DIRECTORY 
Before you begin, make sure to download the AWAE Active Directory setup scripts from the following link and 
place them on your Windows Server virtual machine.  
▪ 
https://github.com/s0lst1c3/awae-ad-setup-scripts/archive/master.zip 
As with the previous section, your PFSense virtual machine must remain running throughout the duration of this 
section. 
STEP 1 - SET POWERSHELL EXECUTION POLICY ON DOMAIN CONTROLLER. 
First, we need to configure Powershell to allow us to run scripts from the command line. To do 
this, open a new Powershell prompt as administrator and run the following command:  
Please note that due to security concerns, this is not something you’d want to do in a production 
environment. 
STEP 2 - INSTALL PREREQUISITES 
Next, run the following script using your Powershell command prompt: 
▪ 
Install-PreReq.ps1 
PS> set executionpolicy unrestricted 
Advanced Wireless Attacks Against Enterprise Networks 
Step 8 - Configure Active Directory 
© 2017 Gabriel Ryan All Rights Reserved 
25 
Once your computer has rebooted, open the following file in Notepad. 
▪ 
C:\poshlog\featurelog 
The contents of the file should be similar to what is shown in the screenshot below. If it isn’t, 
stop and contact the instructor for assistance.  
Advanced Wireless Attacks Against Enterprise Networks 
Step 8 - Configure Active Directory 
© 2017 Gabriel Ryan All Rights Reserved 
26 
STEP 3 - INSTALL ACTIVE DIRECTORY FEATURES 
Next, we need to install the following items to the domain controller: 
▪ 
Active Directory Domain Services role 
▪ 
DNS Server role 
▪ 
Group Policy management feature 
To do this, run the following script: 
▪ 
Add-ADFeatures.ps1 
Once the script has finished executing, open the following file in Notepad as before: 
▪ 
C:\poshlog\featurelog 
The contents of the file should be similar to what is shown in the screenshot below. If it isn’t, 
stop and contact the instructor for assistance.  
Advanced Wireless Attacks Against Enterprise Networks 
Step 8 - Configure Active Directory 
© 2017 Gabriel Ryan All Rights Reserved 
27 
STEP 4 - SETUP ACTIVE DIRECTORY 
Next, we need to create a new forest and promote our server to the role of Domain Controller. 
To do this, run the following Powershell script: 
▪ 
InstallNewForest.ps1 
Advanced Wireless Attacks Against Enterprise Networks 
Step 8 - Configure Active Directory 
© 2017 Gabriel Ryan All Rights Reserved 
28 
The script will prompt you to set your Active Directory recovery password. Set this to something 
memorable. When prompted to reboot, click accept. 
At this point it’s important to make sure DNS is still working, so try pinging google.com from the 
command line as follows: 
If you can’t ping google.com, contact the instructor for assistance. 
PS> ping google.com 
Advanced Wireless Attacks Against Enterprise Networks 
Step 8 - Configure Active Directory 
© 2017 Gabriel Ryan All Rights Reserved 
29 
STEP 5 - CONFIGURE DHCP 
Next we need to add the DCHP role to our Domain controller. To do this, run the following 
Powershell script as Administrator: 
▪ 
Setup-DHCP.ps1 
Once again, this probably isn’t something you’d want to do in a production environment because it creates a single 
point of failure. For our lab, however, it works just fine. 
STEP 6 - DISABLE WINDOWS FIREWALL 
Using a firewall is generally a good thing. However, in the interest of spending more time 
hacking and less time troubleshooting, let’s disable Windows Firewall for all computers within 
the domain using a Group Policy Object.  
To do this, first open up your Powershell prompt as Administrator and run the following 
command: 
Advanced Wireless Attacks Against Enterprise Networks 
Step 8 - Configure Active Directory 
© 2017 Gabriel Ryan All Rights Reserved 
30 
This will create a new Group Policy Object named “DisableFirewall” and link it to our 
example.com domain.  
Next, we apply the appropriate firewall configuration to the Group Policy Object that we just 
created:  
Finally, we use the Invoke-GPUpdate cmdlet to pull our newly created Group Policy Object: 
Note that it may take some time for these changes to take effect, so don’t be alarmed if 
Windows Firewall does not become disabled immediately. 
PS> New-GPO DisableFirewall | New-GPLink -Target “DC=example.com,DC=com” -
LinkEnabled yes 
PS> Set-NetFirewallProfile -Profile Domain,Public,Private -Enabled False -PolicyStore 
example.com\DisableFirewall 
PS> Invoke-GPUpdate 
Advanced Wireless Attacks Against Enterprise Networks 
Step 8 - Configure Active Directory 
© 2017 Gabriel Ryan All Rights Reserved 
31 
STEP 7 – ADD DOMAIN ADMIN USER 
This part is pretty simple. Just create a new user and promote it to Domain Admin using the 
following two commands: 
Feel free to use a different username and password.  
net user jcena Passw0rd! /add /domain 
net group “Domain Admins” jcena /add /domain 
Advanced Wireless Attacks Against Enterprise Networks 
Step 9 - Add Windows Workstations To Domain 
© 2017 Gabriel Ryan All Rights Reserved 
32 
STEP 9 - ADD WINDOWS WORKSTATIONS TO DOMAIN 
Congrats. You’ve made it through what is by far the most time consuming section of this setup guide. Give yourself 
a pat on the back before you move on. 
Before proceeding any further, make sure that both your PFSense virtual machine and your Domain Controller are 
running. 
ADD WINDOWS 10 WORKSTATION 
It’s time to add workstations to our Active Directory environment. We’ll start by adding our Windows 10 
workstation using the following steps:  
1. Extract the zip archive that we downloaded in Step 1 – Download a Windows 10 Developer VM. 
2. Open VirtualBox 
3. From the VirtualBox main menu, select File > Import Appliance as shown in the screenshot below. 
4. Select the path of your Windows 10 virtual machine (the .ovf you just extracted). If you can, give the 
virtual machine at least 2 GB of RAM. Then click “Import”.  
Advanced Wireless Attacks Against Enterprise Networks 
Step 9 - Add Windows Workstations To Domain 
© 2017 Gabriel Ryan All Rights Reserved 
33 
5. When the VM import process is complete, select the new Windows 10 virtual machine in the list to the 
left. Then go to Settings > General and change the virtual machine’s name to “Windows 10 AD Victim”. 
6. Next, navigate to the Settings > Network > Adapter 1 as shown in the screenshot below. Then perform the 
following configurations as shown in the screenshot below: 
a. Ensure that the “Enable Network Adapter” box is checked. 
b. Set “Attached to” to “Host-only Adapter”. 
c. 
Set “name” to vboxnet0. 
Advanced Wireless Attacks Against Enterprise Networks 
Step 9 - Add Windows Workstations To Domain 
© 2017 Gabriel Ryan All Rights Reserved 
34 
7. Click “OK” to return to the main VirtualBox menu. 
8. Power-on the Windows 10 Ad Victim virtual machine. 
9. Go to Explorer > This PC > Properties as shown in the screenshot below. 
Advanced Wireless Attacks Against Enterprise Networks 
Step 9 - Add Windows Workstations To Domain 
© 2017 Gabriel Ryan All Rights Reserved 
35 
10. In the Properties window, click on “Change Settings” as shown in the screenshot below. 
11. In the popup window, go to the “Computer Name” tab then click the “Change” button. 
Advanced Wireless Attacks Against Enterprise Networks 
Step 9 - Add Windows Workstations To Domain 
© 2017 Gabriel Ryan All Rights Reserved 
36 
12. In the popup window that appears, do the following as shown in the screenshot below: 
d. Set the “Computer Name” to whatever you want 
e. Select the “Domain” radio button 
f. 
Set the “Domain” field to “example.com” 
g. Click “OK” 
13. You will be prompted to enter credentials. Enter the username and password for the Domain Admin 
account you created earlier. 
14. If the authentication is successful, you will see a prompt similar the one shown in the screenshot below. 
Click “OK”. 
Advanced Wireless Attacks Against Enterprise Networks 
Step 9 - Add Windows Workstations To Domain 
© 2017 Gabriel Ryan All Rights Reserved 
37 
15. You will be issued a prompt stating that a reboot is necessary. When this occurs, click “Restart Now”. 
16. Finally, install VirtualBox guest additions using the same steps you followed in Step 7 - Install Guest 
Additions on Domain Controller. 
ADD WINDOWS 8 WORKSTATION 
Repeat each of the steps you followed to add the Windows 10 workstation to your domain, but this time use your 
Windows 8 virtual machine instead. Make sure that you give your Windows 8 machine a unique hostname and 
name it something other than “Windows 10 AD Victim”.
Advanced Wireless Attacks Against Enterprise Networks 
Step 9 - Add Windows Workstations To Domain 
© 2017 Gabriel Ryan All Rights Reserved 
38 
Congratulations. You have completed the lab setup guide.