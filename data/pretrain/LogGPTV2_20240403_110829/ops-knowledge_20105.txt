User: 请解答这个和日志有关的问题WDS error: Windows cannot install required files. Make sure all files required for installation are available, and restart the installation I have a Windows 8.1 x64 image that I sysprep'd and captured onto a Windows 2008R2 WDS server.
When attempting to install it on a fresh client, the first action "Copying Windows Files" happens in about 2 seconds, showing a successful green checkmark.  Then the second action (Getting files ready for installation) ends up displaying the following message:

Windows cannot install required files.  Make sure all files required for installation are available, and restart the installation.

I have read through a lot of forums, and the closest I found was someone had the same issue because there was a file called WinPEPGE.sys was lodged in the image.  But even that didn't show a symptom of the files being copied in a matter of seconds.

Two facts that might be pertinent:  The client I am installing to is a non-UEFI (BIOS) system so the partitions being created in the unattend.txt do not include a EFI type partition.  Also, the first system that Windows 8.1 was originally installed, sysprep'd, and captured from was a UEFI system.

Here is the setuperr.log that I pulled from the drive being installed to:

2013-11-01 17:11:22, Error      [0x0b0039] WDS    GetAdaptersAddresses failed; result:0x0000006f status:0x8007006f
2013-11-01 17:11:22, Error      [0x0b003b] WDS    QueryAdapterStatus failed (status 0x8007006f); will retry
2013-11-01 17:11:23, Error      [0x0b003a] WDS          [gle=0x0000276d]
2013-11-01 17:11:23, Error      [0x0b003a] WDS          [gle=0x0000276d]
2013-11-01 17:11:23, Error      [0x0b003a] WDS          [gle=0x0000276d]
2013-11-01 17:11:23, Error      [0x0b003a] WDS          [gle=0x0000276d]
2013-11-01 17:11:23, Error      [0x0b003a] WDS          [gle=0x0000276d]
2013-11-01 17:11:23, Error      [0x0b003a] WDS          [gle=0x0000276d]
2013-11-01 17:11:23, Error      [0x0b003a] WDS          [gle=0x0000276d]
2013-11-01 17:11:23, Error      [0x0b003a] WDS          [gle=0x0000276d]
2013-11-01 17:11:23, Error      [0x0b003a] WDS          [gle=0x0000276d]
2013-11-01 17:11:23, Error      [0x0b003a] WDS          [gle=0x0000276d]
2013-11-01 17:11:23, Error      [0x0b003a] WDS          [gle=0x0000276d]
2013-11-01 17:11:23, Error      [0x0b003a] WDS          [gle=0x0000276d]
2013-11-01 17:11:23, Error      [0x0b003a] WDS          [gle=0x0000276d]
2013-11-01 17:12:18, Error      [0x0600a7] IBS    MoveOldOSFiles:Failed to move [C:\$WINDOWS.~BT\] to [C:\Windows.old\$WINDOWS.~BT\].[gle=0x00000005]
2013-11-01 17:12:18, Error      [0x06009d] IBS    DeployImage:MoveOldOSFiles failed; hr = 0x80070005[gle=0x00000005]
2013-11-01 17:12:18, Error      [0x060082] IBS    Callback_ImageTransfer:Failed to lay down the OS image; hr = 0x80070005[gle=0x00000005]

Assistant: I had run a refresh on the operating system because I was having issues sysprep'ing it.  I had deleted the windows.old folder that was left over, but I didn't realize that it also creates a $WINDOWS.~BT folder.  This is also the folder that WinPE uses from WDS to perform the windows installation from.  Because this folder existed in the .WIM image, it was attempting to move this folder into Windows.old before starting the install.  This of course, failed.

I fixed it by following these steps:


Stop the WDS service
Mount the WIM image using ImageX.exe: ImageX.exe /mountrw image.wim 1 c:\mounted_image
Delete the c:\mounted_image\$WINDOWS.~BT folder and all subfolders.
Unmount and recapture the changes using ImageX.exe: ImageX.exe /unmount /commit c:\mounted_image
Restart the WDS service


This seemed to cure the problem, as the remaining install steps are running through successfully now.