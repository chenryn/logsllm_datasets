Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
sOfT7: Revealing the Secrets 
of the 
Siemens S7 PLCs
Sara Bitan | Alon Dankner
Joint work with Professor Eli Biham, Maxim Barsky and Idan Raz
Faculty of Computer Science, Technion – Israel Institute of Technology
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
Who are we?
Founder and CEO of CyCloak: Secure 
system design and audit
Sara Bitan
Alon Dankner
2
Senior researcher at the Technion 
Hiroshi Fujiwara Cyber Security 
Research Center
Advisors:  Prof. Eli Biham, Dr. Sara Bitan
Security researcher
M.Sc. graduate from the Technion
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
PLCs turn rogue…
Stuxnet
(Anonymous author)
• Exploit a vulnerable 
Siemens Step7 
engineering station/ 
WinCC HMI client
• Inject a rogue control 
program, and tamper 
with HMI outputs
Rogue7: Rogue 
Engineering-Station 
attacks on S7 Simatic 
PLCs
(Biham, et al) 
• A phyton script 
impersonating an 
engineering WS
• All S7 PLCs from the 
same model and 
firmware version share 
the same key
Doors of Durin: The 
Veiled Gate to Siemens 
S7 Silicon
(Abbasi, et al)
• Siemens S7-1200 PLC 
Bootloader Arbitrary 
Code Execution
• Siemens S7 firmware is 
using Adonis kernel
The Race to Native Code 
Execution in PLCs
(Keren)
• Remote arbitrary code 
execution on Siemens 
S7-1500
• Exploiting memory 
protection vulnerability 
to escape  the control 
program sandbox
3
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
ICS architectures are evolving
4
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
Software PLCs
Smart Manufacturing
• New requirements from PLC 
vendors
• New features: IDEs, new 
protocols, extensive cloud 
communication
Vendor Requirements
• Agility and flexibility
• Preserve existing IP and 
technology
• The solution: software PLCs
New PLC architecture
• Generic functions: GP OS –
updatable, flexible→ Standard 
hardware
• Legacy functions : proprietary 
OS - closed and hardened
• Virtualization: isolation and 
separation
5
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
Siemens ET 200SP open controller
• The PC-based version of SIMATIC S7-
1500
• Introduced in January 2015
• Combines PLC functionality with a PC-
based platform using virtualization
• Isolation between Windows and control 
logic
• Supports Windows updates and reboot 
without interruption to the control logic
• The controller continues to work even if 
Windows crashes
• DUT: CPU 1515SP PC2
6
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
The quest…
7
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
The boot process
8
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
• The GRUB configuration file
The boot process
9
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
Open controller boot sequence
BIOS
GRUB 
Boot-
loader
1st Stage 
VMM
2nd Stage 
VMM
SWCPU
Windows 
Embedded
10
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
• Surprisingly, the VMM binary, grub configuration and CPU.elf files are also 
accessible from Windows
• RW by admin
The boot process
11
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
The quest…
12
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
Finding the ELF decryption code
13
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
The quest…
14
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
The quest…
15
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
The “Int 3” debugger
16
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
• Found the decompression/decryption 
function
• Static analysis – very complex
• Debugging
• Using Int3 debugger
• We have the decrypted swcpu in memory
• But cannot export it from the PLC, for analysis
Intermediary status check
17
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
Stealing the vault
18
SUCCESS!
We moved the vault to our own 
powerful attack environment
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
• The VMM is an x86 binary → We run it on 
standard Linux (Ubuntu)
• Challenge: different execution environment
• VMM runs in hypervisor mode, we run it in user 
mode
• Siemens proprietary VMM run time library vs. 
standard CRT
• Solution: dynamic binary instrumentation
• Start from a specific instruction
• Replace VMM functions
• Add our code
• We used Intel Pin to run the VMM 
decryption
Unlocking the vault
19
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
Decryption Loop
VMM_print()
VMM_alloc()
Start of VMM code
Decrypt()
Load_elf()
goto printf()
goto malloc()
Decompress()
Rest of VMM Code
goto Write_elf()
VMM entry point
Decryption entry
point
PLC binary instrumentation
printf()
malloc()
Call_load_elf()
Prepare environment
Write_elf()
PIN_CallApplicationFunction()
main()
IMG_AddInstrumentFunction()
RIP
PLC Binary 
(VMM 2nd Stage)
20
Our
S7 Decryptor
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
Environment
Input
Stack
Temp buffer
RDI
RSI
RDX = Sizeof(SWCPU)
RCX
R8 = 0x1000
R9 = Check_elf()
Function pointer
RSP
A long-enough 
buffer
SWCPU
Output 
buffer
21
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
Revealing S7 Siemens PLCs secrets
Decryption Loop
VMM_print()
VMM_alloc()
Start of VMM code
Decrypt()
Load_elf()
goto printf()
goto malloc()
Decompress()
Rest of VMM Code
goto Write_elf()
call VMM_alloc()
VMM entry point
Decryption entry
point
VMM binary instrumentation
S7 
Decryptor
printf()
malloc()
Call_load_elf()
Prepare environment
Write_elf()
PIN_CallApplicationFunction()
main()
IMG_AddInstrumentFunction()
VMM
2nd Stage
RIP
1
2
4
5
6
3
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
PLC binary instrumentation
Decryption Loop
VMM_print()
VMM_alloc()
Start of VMM code
Decrypt()
Load_elf()
goto printf()
goto malloc()
Decompress()
Rest of VMM Code
goto Write_elf()
call VMM_alloc()
VMM entry point
Decryption entry
point
printf()
malloc()
Call_load_elf()
Prepare environment
Write_elf()
PIN_CallApplicationFunction()
main()
IMG_AddInstrumentFunction()
6b9dce3d0a80300c
05e01c2507909a54
041da583ab509c9d
aa16fc431df4485e
⋮
c39359757012c16f
08191ebca7ad694d
3781ca72e490160d
0f49822241ee5211
Ciphertext
.ELF....
........
........
....4...
⋮
.>8.....
4. ...(.
........
........
Plaintext
ELF Header
Program Header Table
.adonis_memory_table
.data_kernel
.bss_kernel
⋮
.text_kernel
⋮
RIP
23
PLC Binary 
(VMM 2nd Stage)
Our
S7 Decryptor
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
• Running PLC binary (VMM 
2nd stage) on our Ubuntu 
machine
Demo
24
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
The quest…
Built-in Key
25
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
The quest…
26
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
The Decrypted firmware
• Our initial research shows that SWCPU is based on the Adonis Linux
• Contains far more than the basic kernel + PLC code:
• Stand-alone libc.so
• openSSL
• tar archive called “winac_bb_soc1” with a MIPS ELF inside
• Strings from other S7 Simatic PLCs
27
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
The quest…
Built-in key
28
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
The quest…
29
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
The quest…
SECURE BOOT
TPM
DM CRYPT
30
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
Separating the key from the 
code:
prevents decryption with PIN
Mitigations
SECURE BOOT
TPM
DM CRYPT
Prevents INT3 debugging
Prevents static code reversing
31
Prevents Ubuntu booting
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
PLC firmware leakage exposes the full Simatic S7 product line
• Via exploitation of known vulnerabilities
• The horses may have already left the stable…
Recent finding (future publication)
• An attacker who gains admin rights on the Windows VM can replace the PLC 
firmware with his own crafted rogue PLC firmware
• We shared the full details with Siemens
Customer impact
32
!
!
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
Soft7 Summary
Siemens PLC 
market share
(2019) 
31%
Power plants, water facilities, 
transportation systems, 
nuclear reactors
Deployment
Firmware leakage
Exposure to known 
unpatched vulnerabilities
A design flaw 
No easy solution
33
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
Message to the community
• Secure binding to hardware and large-scale key 
management are tough operational problems
• This is challenge to the security & research community
• Especially important since ICS architecture currently shifting 
from walled garden to open and cloud-oriented environments
• A solution is crucial!!!
Message to the 
security & research 
community
34
!
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
Message to customers
35
• You are the assets owners!
• You will suffer from the impact!
• Demand the security you need from the ICS vendors!
• Otherwise, you get “generic” security features that do not fit 
your full requirements
Message to the 
customers
of all ICS vendors
!
Soft7: Revealing Siemens’ S7 PLCs secrets | #BHUSA @BlackHatEvents
Thank you!
Sara Bitan | Alon Dankner
PI:EMAIL | PI:EMAIL
36