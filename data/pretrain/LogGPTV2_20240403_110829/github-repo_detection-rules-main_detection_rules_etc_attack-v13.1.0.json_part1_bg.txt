{"created": "2022-03-30T14:26:51.864Z", "created_by_ref": "", "description": "Monitor for newly executed processes that may interact with the Windows Registry to gather information about the system, configuration, and installed software.\n\n Implementation 1 : Suspicious Processes with Registry keys \n\nDetection Pseudocode\nsuspicious_processes = filter processes where (EventId == \"1\" OR EventId == \"4688\") AND((ProcessCommandLine LIKE '%reg%' AND ProcessCommandLine LIKE '%query%') OR (ProcessCommandLine LIKE '%Registry%' AND (ProcessCommandLine LIKE '%HKEY_CLASSES_ROOT%' OR ProcessCommandLine '%HKCR%'))) \n\nDetection Notes\n\n- The New-PSDrive PowerShell cmdlet creates temporary and persistent drives that are mapped to or associated with a location in a data store, such a registry key (PSProvider \u201cRegistry\u201d). The Get-ChildItem gets the items in one or more specified locations. By using both, you can enumerate COM objects in one or more specified locations.\n- For Security Auditing event id 4688, depending on Windows version, you might need to enable Administrative Templates\\System\\Audit Process Creation\\Include command line in process creation events group policy to include command line in process creation events.\n- For Windows Sysmon event id 1, installation of application with configuration file is required.\n- For Windows Sysmon event id 1, addition of ProcessCreate events in config file is required.\n    \n Implementation 2 : reg.exe spawned from suspicious cmd.exe\n\nDetection Pseudocode\nreg_processes = filter processes where (EventId == \"1\" OR EventId == \"4688\") AND (ProcessFilePath LIKE '%reg.exe%' AND ProcessParentFilePath LIKE '%cmd.exe%')\n\ncmd_processes = filter command_line where (event_id == \"1\" OR event_id == \"4688\") AND (ProcessFilePath LIKE '%cmd.exe%' AND ProcessParentFilePath NOT LIKE '%explorer.exe%') \n\nsuspicious_processes = \nSELECT r.ProcessGuid, r.ProcessFilePath, c.ProcessFilePath AS ProcessParentFilePath\nFROM reg_processes r\nINNER JOIN cmd_processes c\nON r.ProcessParentGuid = c.ProcessGuid \n\nDetection Notes\n\n\n- For Security Auditing event id 4688, depending on Windows version, you might need to enable Administrative Templates\\System\\Audit Process Creation\\Include command line in process creation events group policy to include command line in process creation events.\n- For Windows Sysmon event id 1, installation of application with configuration file is required.\n- For Windows Sysmon event id 1, addition of ProcessCreate events in config file is required.\n    \n\nImplementation 3 : Rare LolBAS command lines\n\nDetection Pseudocode\n\ncount_lolbas_processes = filter processes where (EventId == \"1\" OR EventId == \"4688\") AND ProcessFilePath IN ('FilePathToLolbasProcess01.exe','FilePathToLolbasProcess02.exe')\nGROUP BY ProcessFilePath\n\nnumber_standard_deviations = 1.5\n\nsuspicious_processes = \nSELECT ProcessFilePath, ProcessCount, \n       AVG(ProcessCount) Over() - STDEV(ProcessCount) Over() * number_standard_deviations as LowerBound \nFROM count_lolbas_processes\nWHERE\n  ProcessCount \n\nDetection Notes\n\n- Replace FilePathToLolbasProcessXX.exe with lolBAS process names that are used by your organization.\n- The number_standard_deviations parameter should be tuned accordingly.\n- Identifying outliers by comparing distance from a data point to the average value against a certain number of standard deviations is recommended for data values that are symmetrical distributed. If your data is not distributed, try a different algorithm such as the Interquartile Range (IQR).\n- For Security Auditing event id 4688, depending on Windows version, you might need to enable Administrative Templates\\System\\Audit Process Creation\\Include command line in process creation events group policy to include command line in process creation events.\n- For Windows Sysmon event id 1, installation of application with configuration file is required.\n- For Windows Sysmon event id 1, addition of ProcessCreate events in config file is required.", "id": "", "modified": "2023-04-21T12:50:18.490Z", "object_marking_refs": ["marking-"], "relationship_type": "detects", "revoked": false, "source_ref": "x-mitre-data-", "target_ref": "attack-", "type": "relationship", "x_mitre_attack_spec_version": "3.1.0", "x_mitre_deprecated": false, "x_mitre_modified_by_ref": "", "x_mitre_version": "0.1"}
{"created": "2019-06-17T19:35:16.095Z", "created_by_ref": "", "description": "[Tropic Trooper](https://attack.mitre.org/groups/G0081) has installed a service pointing to a malicious DLL dropped to disk.(Citation: PWC KeyBoys Feb 2017)", "external_references": [{"description": "Parys, B. (2017, February 11). The KeyBoys are back in town. Retrieved June 13, 2019.", "source_name": "PWC KeyBoys Feb 2017", "url": "https://web.archive.org/web/20211129064701/https://www.pwc.co.uk/issues/cyber-security-services/research/the-keyboys-are-back-in-town.html"}], "id": "", "modified": "2023-03-23T15:22:36.381Z", "object_marking_refs": ["marking-"], "relationship_type": "uses", "revoked": false, "source_ref": "intrusion-", "target_ref": "attack-", "type": "relationship", "x_mitre_attack_spec_version": "3.1.0", "x_mitre_deprecated": false, "x_mitre_modified_by_ref": "", "x_mitre_version": "1.0"}
{"created": "2020-10-08T20:15:21.341Z", "created_by_ref": "", "description": "[FIN6](https://attack.mitre.org/groups/G0037) has used encoded PowerShell commands.(Citation: Visa FIN6 Feb 2019)", "external_references": [{"description": "Visa Public. (2019, February). FIN6 Cybercrime Group Expands Threat to eCommerce Merchants. Retrieved September 16, 2019.", "source_name": "Visa FIN6 Feb 2019", "url": "https://usa.visa.com/dam/VCOM/global/support-legal/documents/fin6-cybercrime-group-expands-threat-To-ecommerce-merchants.pdf"}], "id": "", "modified": "2023-03-22T03:50:39.584Z", "object_marking_refs": ["marking-"], "relationship_type": "uses", "revoked": false, "source_ref": "intrusion-", "target_ref": "attack-", "type": "relationship", "x_mitre_attack_spec_version": "3.1.0", "x_mitre_deprecated": false, "x_mitre_modified_by_ref": "", "x_mitre_version": "1.0"}
{"created": "2017-12-14T16:46:06.044Z", "created_by_ref": "", "description": "[APT32](https://attack.mitre.org/groups/G0050) has performed code obfuscation, including encoding payloads using Base64 and using a framework called \"Dont-Kill-My-Cat (DKMC). [APT32](https://attack.mitre.org/groups/G0050) also encrypts the library used for network exfiltration with AES-256 in CBC mode in their macOS backdoor.(Citation: FireEye APT32 May 2017)(Citation: GitHub Invoke-Obfuscation)(Citation: ESET OceanLotus)(Citation: Cybereason Oceanlotus May 2017)(Citation: Cybereason Cobalt Kitty 2017)(Citation: ESET OceanLotus Mar 2019)(Citation: ESET OceanLotus macOS April 2019)", "external_references": [{"description": "Bohannon, D.. (2017, March 13). Invoke-Obfuscation - PowerShell Obfuscator. Retrieved June 18, 2017.", "source_name": "GitHub Invoke-Obfuscation", "url": "https://github.com/danielbohannon/Invoke-Obfuscation"}, {"description": "Carr, N.. (2017, May 14). Cyber Espionage is Alive and Well: APT32 and the Threat to Global Corporations. Retrieved June 18, 2017.", "source_name": "FireEye APT32 May 2017", "url": "https://www.fireeye.com/blog/threat-research/2017/05/cyber-espionage-apt32.html"}, {"description": "Dahan, A. (2017, May 24). OPERATION COBALT KITTY: A LARGE-SCALE APT IN ASIA CARRIED OUT BY THE OCEANLOTUS GROUP. Retrieved November 5, 2018.", "source_name": "Cybereason Oceanlotus May 2017", "url": "https://www.cybereason.com/blog/operation-cobalt-kitty-apt"}, {"description": "Dahan, A. (2017). Operation Cobalt Kitty. Retrieved December 27, 2018.", "source_name": "Cybereason Cobalt Kitty 2017", "url": "https://cdn2.hubspot.net/hubfs/3354902/Cybereason%20Labs%20Analysis%20Operation%20Cobalt%20Kitty.pdf"}, {"description": "Dumont, R. (2019, March 20). Fake or Fake: Keeping up with OceanLotus decoys. Retrieved April 1, 2019.", "source_name": "ESET OceanLotus Mar 2019", "url": "https://www.welivesecurity.com/2019/03/20/fake-or-fake-keeping-up-with-oceanlotus-decoys/"}, {"description": "Dumont, R.. (2019, April 9). OceanLotus: macOS malware update. Retrieved April 15, 2019.", "source_name": "ESET OceanLotus macOS April 2019", "url": "https://www.welivesecurity.com/2019/04/09/oceanlotus-macos-malware-update/"}, {"description": "Folt\u00fdn, T. (2018, March 13). OceanLotus ships new backdoor using old tricks. Retrieved May 22, 2018.", "source_name": "ESET OceanLotus", "url": "https://www.welivesecurity.com/2018/03/13/oceanlotus-ships-new-backdoor/"}], "id": "", "modified": "2023-03-21T21:07:11.693Z", "object_marking_refs": ["marking-"], "relationship_type": "uses", "revoked": false, "source_ref": "intrusion-", "target_ref": "attack-", "type": "relationship", "x_mitre_attack_spec_version": "3.1.0", "x_mitre_deprecated": false, "x_mitre_modified_by_ref": "", "x_mitre_version": "1.0"}
{"created": "2018-04-18T17:59:24.739Z", "created_by_ref": "", "description": "[CORALDECK](https://attack.mitre.org/software/S0212) searches for specified files.(Citation: FireEye APT37 Feb 2018)", "external_references": [{"description": "FireEye. (2018, February 20). APT37 (Reaper): The Overlooked North Korean Actor. Retrieved March 1, 2018.", "source_name": "FireEye APT37 Feb 2018", "url": "https://www2.fireeye.com/rs/848-DID-242/images/rpt_APT37.pdf"}], "id": "", "modified": "2020-03-17T00:47:20.090Z", "object_marking_refs": ["marking-"], "relationship_type": "uses", "source_ref": "", "target_ref": "attack-", "type": "relationship", "x_mitre_modified_by_ref": "", "x_mitre_version": "1.0"}
{"created": "2020-05-26T16:17:59.750Z", "created_by_ref": "", "description": "[Rocke](https://attack.mitre.org/groups/G0106) used malware to download additional malicious files to the target system.(Citation: Talos Rocke August 2018)\t", "external_references": [{"description": "Liebenberg, D.. (2018, August 30). Rocke: The Champion of Monero Miners. Retrieved May 26, 2020.", "source_name": "Talos Rocke August 2018", "url": "https://blog.talosintelligence.com/2018/08/rocke-champion-of-monero-miners.html"}], "id": "", "modified": "2020-05-26T16:17:59.750Z", "object_marking_refs": ["marking-"], "relationship_type": "uses", "source_ref": "intrusion-", "target_ref": "attack-", "type": "relationship", "x_mitre_modified_by_ref": "", "x_mitre_version": "1.0"}
{"created": "2018-10-17T00:14:20.652Z", "created_by_ref": "", "description": "[GravityRAT](https://attack.mitre.org/software/S0237) executes commands remotely on the infected host.(Citation: Talos GravityRAT)", "external_references": [{"description": "Mercer, W., Rascagneres, P. (2018, April 26). GravityRAT - The Two-Year Evolution Of An APT Targeting India. Retrieved May 16, 2018.", "source_name": "Talos GravityRAT", "url": "https://blog.talosintelligence.com/2018/04/gravityrat-two-year-evolution-of-apt.html"}], "id": "", "modified": "2020-03-20T02:28:59.226Z", "object_marking_refs": ["marking-"], "relationship_type": "uses", "source_ref": "", "target_ref": "attack-", "type": "relationship", "x_mitre_modified_by_ref": "", "x_mitre_version": "1.0"}
{"created": "2020-03-20T19:12:22.367Z", "created_by_ref": "", "description": "[Turla](https://attack.mitre.org/groups/G0010) RPC backdoors can be used to transfer files to/from victim machines on the local network.(Citation: ESET Turla PowerShell May 2019)(Citation: Symantec Waterbug Jun 2019)", "external_references": [{"description": "Faou, M. and Dumont R.. (2019, May 29). A dive into Turla PowerShell usage. Retrieved June 14, 2019.", "source_name": "ESET Turla PowerShell May 2019", "url": "https://www.welivesecurity.com/2019/05/29/turla-powershell-usage/"}, {"description": "Symantec DeepSight Adversary Intelligence Team. (2019, June 20). Waterbug: Espionage Group Rolls Out Brand-New Toolset in Attacks Against Governments. Retrieved July 8, 2019.", "source_name": "Symantec Waterbug Jun 2019", "url": "https://www.symantec.com/blogs/threat-intelligence/waterbug-espionage-governments"}], "id": "", "modified": "2020-03-20T19:12:22.367Z", "object_marking_refs": ["marking-"], "relationship_type": "uses", "source_ref": "intrusion-", "target_ref": "attack-", "type": "relationship", "x_mitre_modified_by_ref": "", "x_mitre_version": "1.0"}
{"created": "2021-02-22T16:46:22.940Z", "created_by_ref": "", "description": "[Waterbear](https://attack.mitre.org/software/S0579) has the ability to decrypt its RC4 encrypted payload for execution.(Citation: Trend Micro Waterbear December 2019)", "external_references": [{"description": "Su, V. et al. (2019, December 11). Waterbear Returns, Uses API Hooking to Evade Security. Retrieved February 22, 2021.", "source_name": "Trend Micro Waterbear December 2019", "url": "https://www.trendmicro.com/en_us/research/19/l/waterbear-is-back-uses-api-hooking-to-evade-security-product-detection.html"}], "id": "", "modified": "2021-02-22T16:46:22.940Z", "object_marking_refs": ["marking-"], "relationship_type": "uses", "source_ref": "", "target_ref": "attack-", "type": "relationship", "x_mitre_modified_by_ref": "", "x_mitre_version": "1.0"}
{"created": "2019-07-09T17:42:44.986Z", "created_by_ref": "", "description": "[HyperBro](https://attack.mitre.org/software/S0398) has used HTTPS for C2 communications.(Citation: Unit42 Emissary Panda May 2019)", "external_references": [{"description": "Falcone, R. and Lancaster, T. (2019, May 28). Emissary Panda Attacks Middle East Government Sharepoint Servers. Retrieved July 9, 2019.", "source_name": "Unit42 Emissary Panda May 2019", "url": "https://unit42.paloaltonetworks.com/emissary-panda-attacks-middle-east-government-sharepoint-servers/"}], "id": "", "modified": "2021-10-12T19:21:39.352Z", "object_marking_refs": ["marking-"], "relationship_type": "uses", "source_ref": "", "target_ref": "attack-", "type": "relationship", "x_mitre_modified_by_ref": "", "x_mitre_version": "1.0"}
{"created": "2019-08-30T19:53:25.231Z", "created_by_ref": "", "description": "[admin@338](https://attack.mitre.org/groups/G0018) has sent emails with malicious Microsoft Office documents attached.(Citation: FireEye admin@338)", "external_references": [{"description": "FireEye Threat Intelligence. (2015, December 1). China-based Cyber Threat Group Uses Dropbox for Malware Communications and Targets Hong Kong Media Outlets. Retrieved December 4, 2015.", "source_name": "FireEye admin@338", "url": "https://www.fireeye.com/blog/threat-research/2015/11/china-based-threat.html"}], "id": "", "modified": "2019-09-04T19:48:17.678Z", "object_marking_refs": ["marking-"], "relationship_type": "uses", "source_ref": "intrusion-", "target_ref": "attack-", "type": "relationship", "x_mitre_modified_by_ref": "", "x_mitre_version": "1.0"}
{"created": "2018-10-17T00:14:20.652Z", "created_by_ref": "", "description": "[QUADAGENT](https://attack.mitre.org/software/S0269) used the PowerShell filenames Office365DCOMCheck.ps1 and SystemDiskClean.ps1.(Citation: Unit 42 QUADAGENT July 2018)", "external_references": [{"description": "Lee, B., Falcone, R. (2018, July 25). OilRig Targets Technology Service Provider and Government Agency with QUADAGENT. Retrieved August 9, 2018.", "source_name": "Unit 42 QUADAGENT July 2018", "url": "https://researchcenter.paloaltonetworks.com/2018/07/unit42-oilrig-targets-technology-service-provider-government-agency-quadagent/"}], "id": "", "modified": "2020-03-18T15:37:23.765Z", "object_marking_refs": ["marking-"], "relationship_type": "uses", "source_ref": "", "target_ref": "attack-", "type": "relationship", "x_mitre_modified_by_ref": "", "x_mitre_version": "1.0"}