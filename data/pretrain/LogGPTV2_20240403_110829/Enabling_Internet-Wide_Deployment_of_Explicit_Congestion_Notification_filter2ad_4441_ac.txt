202
B. Trammell et al.
Table 3. Relationship between ECN IP and TCP ﬂags (expected cases in italics)
IPv4 (N = 581711)
ECN
315605
693
1995
8998
IPv6 (N = 17028)
Reﬂect No ECN ECN Reﬂect No ECN
0
7780
3
4
11
5
11
0
0
1
0
1
2
0
0
46
17
16
7
0
5
1
1
0
4
89
0 10
7
0
0
0
23 66
22
2013
0
5
46
7
82
12
31
48
39
87
3694
Marking
Only ect(0)
ect(0) + ect(1)
ect(0)on syn ack
Only ect(1)
ect(1)on syn ack
Only ce
ce + ect
ce on syn ack
none
6939 1343
243150
Table 4. Marking on ﬂows without ECN negotiation attempt
Codepoint IPv4 (N = 581711)
IPv6 (N = 17028)
ect(0)
ect(1)
ce
Once Always syn ack Once Always syn ack
4592 104
101
179
68
2
21
21
18
17
18
17
116
162
76
12
39
94
There are a few additional anecdotes to take from this analysis. The inci-
dence of IPv6 negotiation anomalies (15.20 %) is an order of magnitude higher
than in IPv4 (1.93 %), indicating that, although negotiation is supported by a
higher proportion of IPv6 than IPv4 servers, ECN support in IPv6 in hosts and
middleboxes is less mature. Many of these can be traced to speciﬁc providers: a
single ISP in the Netherlands, for instance, is responsible for all 22 of the hosts
that mark ce on the syn ack for IPv6 when negotiating ECN. Of ﬁve IPv4 hosts
which send both ce and ect marked packets, indicating the potential presence
of a ce-marking router, there is only one (www.grandlyon.com, 213.162.51.7,
as seen from London on 4 September and Singapore on 9 September 2014) for
which we cannot rule out this hypothesis. In neither trial was the connection
long enough to observe a cwr acknowledging the resulting ece.
4.3
IP ECN Connectivity and ECN Echo Tests
To further verify correct ECN signaling end-to-end, we ran ce and ect blackhole
experiments on 24 September, and ece and cwr response tests on 23 September
2014, both from the London vantage point.
In the blackhole experiment, 4791 (0.82 %) IPv4 hosts and 104 (0.61 %) IPv6
hosts fail to connect when at least one ECN codepoint is set on the syn. Of these,
Enabling Internet-Wide Deployment of Explicit Congestion Notiﬁcation
203
2006 IPv4 and 12 IPv6 hosts are among those which also failed to connect from
all vantage points when ECN was requested (see Sect. 3.1). 287 IPv4 and 17 IPv6
hosts fail to connect regardless of the ECN codepoint set. In this experiment,
the magnitude of transient failure is comparable to that in Sect. 3.
The ece response test succeeded for IPv4 in 94.8 % (309,842 hosts) of all
ECN-enabled cases in Table 2. In contrast, the cwr response test succeeded
only in 44.3 % (144,290 hosts) of the cases. Further, we found 690 IPv4 hosts
responding with ece and 351 hosts responding with cwr even though ECN was
not successfully negotiated. There also appears to be signiﬁcant impairment or
implementation error in ECN signaling for IPv6, with only 7 hosts responding
ece and 9 cwr.
Reasons for ece response test failures include clearing of the ce codepoint
along the forward path or clearing of the ece ﬂag along the reverse path. Reasons
for cwr test failures include clearing of the ece ﬂag along the forward path,
clearing of the cwr ﬂag along the reverse path, or termination of the ﬂow before
cwr could be sent by the sender. As the median size of responses from hosts
that did set cwr in the test was 3168 bytes, while the median size from those
that did not was only 864 bytes (i.e., smaller than MSS), we do not consider our
cwr results as a reliable indication of impairment on path.
Therefore, while the ECN IP-related connectivity risk is proportional to that
related to ECN TCP signaling, the correct handling of ece and cwr signaling
after negotiation seem to be more impaired. Even worse, signaling is signiﬁcantly
more impaired on IPv6 than on IPv4.
5 Conclusions, Outlook, and Future Work
We have shown that while webservers support for ECN continues to increase,
there does not appear to have been any appreciable reduction in the proportion
of potential connectivity failure linked to ECN since 2011. The vast majority of
connectivity problems we found with ECN negotiation were close to the server,
i.e., cases in which routing changes during a connection would not lead to connec-
tion failure in the middle of an ECN-enabled ﬂow. The fallback behavior deﬁned
in RFC 3168 eliminates connectivity risk for these cases, such that enabling ECN
by default would lead only to increased connection latency when attempting to
connect to about ﬁve of every thousand websites.
Verifying and localizing ECN path dependency in the remaining cases proves
to be quite diﬃcult. Bauer et al [5] used a tomography-based approach (as in
e.g. Tracebox [11]) for localizing ect mark clearing to an Autonomous System
(AS); an approach that is unfortunately not applicable to our case. The ICMP
Time Exceeded message contains no TCP ﬂag information, making it impossible
to verify path-dependent negotiation failures. Traceroute artifacts and on-path
blocking of traceroute make it similarly impossible to diﬀerentiate connectiv-
ity issues from traceroute issues. Correlation of data-plane and control-plane
routing information (e.g. from http://stat.ripe.net/) is a promising approach,
but in none of our path-dependent connectivity cases did it yield a most-likely
204
B. Trammell et al.
AS for the connectivity failure. We therefore leave further investigation of path
dependency to future work, potentially leveraging existing wide-area distributed
measurement platforms such as RIPE Atlas5 to probe the set of paths through
the Internet more comprehensively, using the volume of data to make up for the
drawbacks of the traceroute-based tomography methods.
Our study shows that while it is safe for operating system vendors to activate
ECN on the client-side by default presuming they implement RFC 3168 fallback,
we cannot yet unreservedly recommend doing so. For a tiny minority of sites
(15 of 598,766, or about 1 in 40,000) we cannot rule out path-dependent con-
nectivity issues. A similar proportion of sites exhibit indiscriminate ce marking,
which would cause throughput degradation with use of ECN. These numbers
are small enough that targeted collaboration with the operations community
based on additional measurement is a viable way forward. We encourage other
researchers to use the tools and dataset made available at http://ecn.ethz.ch
to continue these investigations, and to guide the eventual elimination of ECN-
unfriendly middleboxes, in order to move toward full deployment of ECN.
Acknowledgments. This work was materially supported by the European Commis-
sion though the Seventh Framework Grant Agreements mPlane (FP7-318627) and
Reducing Internet Transport Latency (RITE) (FP7-317700); no endorsement of the
work by the Commission is implied. Thanks to Stephan Neuhaus for his guidance
during the development of ECN Spider, to Daniel Borkmann and Florian Westphal
for discussions on Linux kernel modiﬁcations for RFC 3168 Fallback, and to Stuart
Cheshire for his feedback.
References
1. Ramakrishnan, K., Floyd, S., Black, D.: The Addition of Explicit Congestion Noti-
ﬁcation (ECN) to IP. RFC 3168, IETF (2001)
2. K¨uhlewind, M., Neuner, S., Trammell, B.: On the state of ECN and TCP options
in the internet. In: Proceedings of the Passive and Active Measurement 2013, Hong
Kong SAR, China (2013)
3. Baker, F., Fairhurst, G.: IETF Recommendations Regarding Active Queue Man-
agement: draft-ietf-aqm-recommendation-08. Internet-draft, IETF (2014) (Work in
Progress)
4. K¨uhlewind, M., Wagner, D.P., Espinosa, J.M.R., Briscoe, B.: Using data center
TCP (DCTCP) in the internet. In: Proceedings of the third IEEE Globecom Work-
shop on Telecommunication Standards: From Research to Standards (2014)
5. Bauer, S., Beverly, R., Berger, A.: Measuring the state of ECN readiness in servers,
clients, and routers. In: Proceedings of the Internet Measurement Conference, pp.
171–177 (2011)
6. Honda, M., Nishida, Y., Raiciu, C., Greenhalgh, A., Handley, M., Tokuda, H.:
Is it still possible to extend TCP? In: Proceedings of the Internet Measurement
Conference, pp. 181–194 (2011)
7. Medina, A., Allman, M., Floyd, S.: Measuring the evolution of transport protocols
in the Internet. SIGCOMM Comput. Commun. Rev. 35(2), 37–52 (2005)
5 https://atlas.ripe.net/.
Enabling Internet-Wide Deployment of Explicit Congestion Notiﬁcation
205
8. Trammell, B., Hildebrand, J.: Evolving transport in the internet. IEEE Internet
Comput. 18(5), 60–64 (2014)
9. Craven, R., Beverly, R., Allman, M.: Middlebox-cooperative TCP for a non end-
to-end Internet. In: Proceedings of ACM SIGCOMM 2014 Conference, Chicago,
IL, USA (2014)
10. Trammell, B., Gugelmann, D., Brownlee, N.: Inline data integrity signals for passive
measurement. In: Proceedings of the Sixth International Wksp on Traﬃc Measure-
ment and Analysis, London, England (2014)
11. Detal, G., Hesmans, B., Bonaventure, O., Vanaubel, Y., Donnet, B.: Revealing
middlebox interference with Tracebox. In: Proceedings of the 2013 Internet Mea-
surement Conference IMC ’13, pp. 1–8, Barcelona, Spain (2013)