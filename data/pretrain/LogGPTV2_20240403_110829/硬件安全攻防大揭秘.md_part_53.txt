433
---
## Page 446
无班
B
10P
70.00
00'68 *
图9-128OpenWrt核心板（2)
越复杂成本越高的板子，选择核心板厂商时越要慎重，有些厂商核心板做得不错，但技
术支持不够好。国内有几个提大的核心板厂，出核心板的速度非常快，通常官方的方案稳定
了，他们的核心板就出了。请注意，如果你的用量不大，或者方案还没确定，就别贪图他们
的速度快了，越是复杂越是强大的芯片方案，越需要技术支持。
9.3.4项目实施过程
选型确定后，就是Demo验证了，再到试产，再到量产，这个阶段通常比较长，一般的
过程如下。
（1）可行性验证：使用官方Demo板或者买的开发板，再使用杜邦线或者飞线连接别的
模块、扩展板，完成初步的可行性评估。
（2）功能性评估：开始制板，或者用核心板、模块等外加底板的模式，进一步完成可行
性及功能性验证。
（3）性能评估：功能基本定好，不会再有新的需求，自已画板设计打样生产，和最终发
布的版本区别不大。
（4）成本控制：依据性能评估测试结果，调整芯片、元件的用料或者参数，从面缩减成
本，定下最终的 Alpha版本，和发布版本只是有无调试接口的差异。
（5）试产：发布版本小批量试产，在生产线监督测试产品的生产及出厂测试。
（6）量产：产品大批量生产，到这里硬件的实施基本到了尾声，做好品质控制即可。
当然，这只是一个逻辑上的简约流程，实际上整个项目是需要有明确时间计划的，而且
434
---
## Page 447
第9章打造专属硬件工具
要根据实际情况随时调整，把控好整个项目的进度，这就是产品经理的职责。而且，这里也
只说了硬件部分的流程，实际上还有外壳ID设计、开模、元器件备料、资质认证、商务合同
等，这些都是相互交叉、相互关联的，任何一个环节的失误，都可能导致项目的延期或者失
败。
9.3.5小结
硬件产品的生产，远比软件产品的开发有难度！在这里作者提几点建议。
（1）别赶时间，慢工出细活。前期计划越详细越好，考虑越全面越好。
（2）时刻跟进。计划永远赶不上变化，要紧跟一线，依据实际情况调整工作，如果产品
经理不是内行人，那就必须有懂得所有流程的人协助指导，纸上谈兵要不得
（3）避免外行指导内行。硬件设计的生产过程很多方面外行很难理解，比如PCB生产、
备料、SMT的时间周期，真要有实力、有能力也是能赶工的。
（4）该花的钱必须花，该省的钱也必须省。必须有内行监督，硬件产品设计生产中的弹
性很大，不管是外壳ID设计、开模、生产还是元器件物料采购、SMT生产测试、包装出厂
都是必须花钱的地方。成本控制不做好，产品很可能天折，
（5）商务谈好，技术保护好，产品在设计生产各个环节的技术保密要做好，知识产权非
常重要。VCD有过血淋淋的教训，商务条款也要谈好，谈判是一个互相妥协的过程，都是趋
利避害，在不影响项目计划的前提下，尽量争取优势条款
（6）硬件产品很烧钱！没有足够的实力，别轻易入坑。这个实力不仅体现在金钱方面，
例如有些众筹的硬件产品，要么没做完钱花完了，要么做到一半人心散了。最后，即使产品
做好，也可能卖不出去，因为别人或许做得更好，或者成本控制最低，或者渠道做得更好！
做硬件要谨慎
最后，祝愿玩硬件的读者，在自已玩High之后，还能够孵化出产品造福大家！
9.4个性USB名片
这里讲的USB名片，可不是名片形状的U盘，面是一款特殊硬件，插入计算机后，通过
按几次大小写切换，就能自动打开记事本并且在上面显示信息的“电子名片”，如图9-129
所示。
435
---
## Page 448
硬件安全攻防大揭托
Zhao
rank
tacieir
ao.com
图9-129USB名片
9.4.1设计原理
在前面讲USB 相关内容时，讲过 SyScan360 2013 Badge的隐藏功能，用Atmega8单片机
模拟USB键盘，实现自动使用快捷键打开记事本并输入预存信息的功能。USB名片的原理相
同。
为了减小体积，当然不用Atmega8这么大封装的芯片，我们可以采用8脚的小封装AVR
单片机，例如1 Atmel Attiny85,如图 9-130 所示，也就是 Digispark USB Development Board,
如图9-131所示。所用的主控芯片体积小，而且内置品振，2.7V~5.5V宽电压供电，Flash 和
EEPROM 都够用。
图9-130 Atmel Attiny85
图9-131Digispark USB Development Board
前面讲USB时提过原理，AVR单片机可以利用AVRUSB库，将两个I/O接口模拟USB
接口的D+和ID-信号线，从面实现USB HID 协议功能。所以，在原理图设计时只需要任意两
436
---
## Page 449
第导量打造专展发件工具
个1/O接口就可以，但与USB的 D+和D-中间需要串一个 68Q的电阻，而且D+和D-的电平
需要在3.6V，简单起见直接用两只3.6V稳压管稳压到3.6V，同时D-信号线还需要1.8K电阻
上拉，再在电源和地中间加一个0.1uF滤波电容。最后，再在USB供电线加一个500mA的自
恢复保险丝，当电流过大时自动断开连接，保护计算机的USB接口不被损坏。
因为 Attiny25、Atiny45和Attiny85 封装相同。所以按照这个设计可以很轻松地绘制出原
理图，如图9-132所示。
图9-132原理图
9.4.2PCB设计
板子很简单，设计没有太多要求，读者可以按照个人喜好自行设计，想做成名片形状也
可以，其他各种奇形怪状都没问题，色彩可以搭配丝印、金色沉金或者白色喷锡，以及板子
的阻焊一共三种颜色，好好发挥审美细胞，做出最个性化的专属名片。
当然，如果想恶作剧，就尽量往小了设计。本节演示一个恶作剧，做一个很小的USB插
头，直接塞进电脑的USB口，用PCB做USB接口，芯片放在USB触点背面，不露头，很陷
蔽。
最终的PCB设计（如图9-133~图9-135所示）长9mm宽12mm，生产PCB时厚度选用
1mm，加上芯片厚度，刚好可以插入USB口。可以适当地将PCB长度加长，这样就可以像
无线键鼠的接收器那样插拔。
437
---
## Page 450
9.00
9.4.3固件代码
用AVRUSB 代码库中的代码就行，至于实现的功能，可以有很多种，例如随机开关
CapsLock大小写锁定键，随机移动鼠标、随机敲击键盘按键、干扰目标的正常按键输入。可
以想象，当你打开QQ准备聊天时，突然键盘聊天窗口自动输入“I'mGay！1Love You！”
然后自动发送
如果觉得代码烧写很麻烦，前面讲“ThinkPad BIOS白名单实战”时提到编程夹具，用它
就可以，或者根据自己的喜好，做得体积大一点，将烧写引脚留出来也不无不可。
总之，这就是一个USBHID的简单应用，9.5节中我们将继续在此基础上进行拓展。
9.5私人定制版大黄鸭
前面讲了硬件设计、生产的基本方法，从本节开始，我们讲如何打造“专属武器”。不
会涉及太多的详细步骤，更多是通过启发思考的方式，讲述设计思路，读者可以依据自己的
想法发挥个人的创意进行设计。
9.5.1Teensy、大黄鸭、烤鹅与BadUSB
Teensy系列产品曾经非常火热，如图9-136所示。在大黄鸭出来之前，这是USB HID攻
438
---
## Page 451
第9章打造专属硬件工具
击的最佳工具，前面介绍 BadUSB时提到过它的原理，所以本节只介绍怎么DIY一个私人定
制版大黄鸭。
32 Bit Teensy Boards
8 Bit Teensy Boards
0
图9-136Teensy系列
Teensy 的版本有很多，Teensy 2.0时代用的还是8位的 ATmel 单片机，之后换成了32位
的ARM单片机，如图9-137所示。图9-138所示的大黄鸭（USBRUBBERDUCKY）用的也
是32位的ARM单片机，只不过是ATmel的。之后的RadioWar基于Teensy++2.0设计了烧
鹅（FireGoose），如图9-139所示，号称中国人自己的HID HackingDevice，不过本质都是
USB 单片机外加 TF卡。Teensy 2.0 加了 hub、Flash 芯片和个 USB 的 MTK7601 Wi-Fi 模块。
至于BadUSB，是基于现有U盘。
ATMEGA32U4
AT9OUSB1286
SGEAR
MK200X128
32 bit ARM
MK200X25
16 MHz
8 bit AVR
32 bit ARIV
Flash 1/e
32256
130048
131072
262144
RAM tler
2560
8192
16384
65536
EEPROM
1024
4096
2048
2048
UO
25. 5 Vot
46. 5 Vt
34. 3.3 Vot
Analog 
12
34. 3 3V. 5V to
14
21
WWd
7
10
12
UART(2C.SPI1.1,1
1.1.1
011
3.2.1
Pice
$16.00
$24.00
519.00
519.80
图9-137Teensy系列参数对比
439
---
## Page 452
经件安全攻防大码税
图9-138大黄鸭
图9-139烧鹅
当然，这些都不是能直接拿来用的。有的说是开源，也只是开放PDF原理图外加删减版
的Gerber文件而已，如果想更深入地修改，只能自己设计画板。
9.5.2方案规划
首先，USB功能是必需的，芯片自带的USB或者外扩的USB都可以，但最好是内置的，
控制更方便。其次，自带nand或者emmc也可以考虑，但最好有TF卡外扩。再次，可以考
虑白带无线、Wi-Fi或者RF射频，远程操控更酷炫。最后，体积要小。
依据这些需求，我们大概可以理出一个思路。首先需要一个高性能的USB单片机，性能
太弱读写Flash或者TF卡太慢，处理能力太弱没法玩，基本上可以确认需要使用带USB接口
的ARM 单片机。无线方面可以考虑用专有的 2.4GHz、ZigBee或者Sub-1G，Wi-Fi 的干扰太
大而且目标太明显。当然，如果想用，肯定不能用烧鹅那样外挂Hub的方案。
比如TICC2538（如图9-140所示），芯片具备ARMCortex-M3内核、32MHz主频、
512KB Flash、32KB RAM，性能不是特拔尖，但毕竞是 32位处理器，而且它还支持IEEE
802.15.4、6LoWPAN和ZigBee通信协议，USB 等接口齐全，内置 AES、SHA2 加密，它的
扩展性很强，除了可以做USB HID 攻击，还能做2.4GHzIEEE 802.15.4、6LoWPAN和
ZigBee的无线分析工具或者攻击工具。
440
---
## Page 453
第9章打造专属硬件工具
CC2538适用于2.4GHz IEEE 802.15.4、6LoWPAN和 ZigBee°用]
的强大无线微控制器片上系统
12瓶
1.1特
RM" Cortex
-M
- 414
1
32
168
S20(12
E(UART)
4ACR月]
R,2 748m
SHA/2
AES-128256.
R],RT: ECC-128/254. RSA
图9-140T1 CC2538 Datasheet
再比如原来的FSL现在NXP的KW2xD系列射频单片机，使用的是ARM Cortex-M4内
核，性能没得说，还集成了射频和USB，完全可以满足需求，如图9-141所示。
ore
2.40
图9-141NXPKW2xD系列芯片功能框图
当然，Atmel 肯定也有类似的芯片，比如 Atmel SAM R21系列，使用ARM Cortex-M0+
内核、USB接口、射频一应俱全，如图9-142所示。
441
---
## Page 454
硬件安全攻防大橱秘
优势
·F ARM Cotex-RD +  MCU InER
富.e 2.4GH 元 Cortex
·基之 25k8 B入
5128式期行闪学的OTA
开会 tE 802.15.4 9次方常