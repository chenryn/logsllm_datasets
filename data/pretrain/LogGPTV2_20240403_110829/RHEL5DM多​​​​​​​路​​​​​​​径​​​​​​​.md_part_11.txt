|                      | ​​​​​​​加​​​​​​​权​​​​​​​是​​​​​​​相​​​​​​​等​​​​​​​的​​​​​​​。​​​​​​​默​​​​​​​认​​​​​​​值​​​​​​​为​​​​​​​ `uniform`{.literal}。​​​​​​​  |
|                      |   -------------------                         |
|                      | --------------------------------------------- |
|                      | --------------------------------------------- |
|                      | --------------------------------------------- |
|                      | --------------------------------------------- |
|                      | --------------------------------------------- |
|                      | --------------------------------------------- |
|                      | --------------------------------------------- |
|                      | --------------------------------------------- |
|                      | --------------------------------------------- |
|                      | --------------------------------------------- |
|                      | --------------------------------------------- |
+----------------------+-----------------------------------------------+
| ` no_pa              |   -----------------------                     |
| th_retry `{.literal} | --------------------------------------------- |
|                      |   这​​​​​​​个​​​​​​​属​​​​​​​性​​​​​​​的​​​​​​​数​​​​​​​字​​​​​​​值​​​​​​​指​​​​​​​定​​​​​​​系                      |
|                      | ​​​​​​​统​​​​​​​在​​​​​​​禁​​​​​​​用​​​​​​​队​​​​​​​列​​​​​​​前​​​​​​​应​​​​​​​该​​​​​​​试​​​​​​​图​​​​​​​使​​​​​​​用​​​​​​​失​​​​​​​败​​​​​​​的​​​​​​​路​​​​​​​径​​​​​​​的​​​​​​​次​​​​​​​数​​​​​​​。​​​​​​​  |
|                      |   `fail`{.literal} 值​​​​​​​表​​​​​​​明​​​​​​​立​​​​​​​即​​​​​​​失​​​​​​​败​​​​​​​，无​​​​​​​需​​​​​​​排​​​​​​​队​​​​​​​。​​​​​​​ |
|                      |   `queu                                       |
|                      | e`{.literal} 值​​​​​​​表​​​​​​​明​​​​​​​在​​​​​​​路​​​​​​​径​​​​​​​修​​​​​​​复​​​​​​​前​​​​​​​不​​​​​​​应​​​​​​​停​​​​​​​止​​​​​​​排​​​​​​​队​​​​​​​。​​​​​​​ |
|                      |   默​​​​​​​认​​​​​​​至​​​​​​​为​​​​​​​（空​​​​​​​白​​​​​​​）。​​​​​​​                          |
|                      |   -----------------------                     |
|                      | --------------------------------------------- |
+----------------------+-----------------------------------------------+
| `                    |   ----------------------                      |
| failback `{.literal} | --------------------------------------------- |
|                      | --------------------------------------------- |
|                      |   指​​​​​​​定​​​​​​​路​​​​​​​径​​​​​​​组​​​​​​​群​​​​​​​出​​​​​​​错​​​​​​​切​​​​​​​换​​​​​​​。​​​​​​​                      |
|                      |   数​​​​​​​值​​​​​​​ 0 或​​​​​​​者​​​​​​​ `immediat                       |
|                      | e`{.literal} 指​​​​​​​定​​​​​​​一​​​​​​​旦​​​​​​​存​​​​​​​在​​​​​​​优​​​​​​​先​​​​​​​权​​​​​​​高​​​​​​​于​​​​​​​现​​​​​​​有​​​​​​​路​​​​​​​径​​​​​​​组 |
|                      | ​​​​​​​群​​​​​​​的​​​​​​​路​​​​​​​径​​​​​​​组​​​​​​​群​​​​​​​，那​​​​​​​么​​​​​​​系​​​​​​​统​​​​​​​将​​​​​​​切​​​​​​​换​​​​​​​到​​​​​​​那​​​​​​​个​​​​​​​路​​​​​​​径​​​​​​​组​​​​​​​群​​​​​​​。​​​​​​​  |
|                      |   大​​​​​​​于​​​​​​​ 0 的​​​​​​​数​​​​​​​字​​​​​​​值​​​​​​​指​​​​​​​定​​​​​​​推​​​​​​​迟​​​​​​​出​​​​​​​错​​​​​​​切​​​​​​​换​​​​​​​，以​​​​​​​秒​​​​​​​表​​​​​​​示​​​​​​​。​​​​​​​ |
|                      |   `manual`{.litera                            |
|                      | l} 值​​​​​​​表​​​​​​​明​​​​​​​只​​​​​​​能​​​​​​​在​​​​​​​操​​​​​​​作​​​​​​​员​​​​​​​介​​​​​​​入​​​​​​​时​​​​​​​才​​​​​​​会​​​​​​​发​​​​​​​生​​​​​​​出​​​​​​​错​​​​​​​切​​​​​​​换​​​​​​​。​​​​​​​ |
|                      |   ----------------------                      |
|                      | --------------------------------------------- |
|                      | --------------------------------------------- |
+----------------------+-----------------------------------------------+
| ` r                  | 指​​​​​​​定​​​​​​​在​​​​​​​当                                      |
| r_min_io `{.literal} | ​​​​​​​前​​​​​​​路​​​​​​​径​​​​​​​组​​​​​​​群​​​​​​​中​​​​​​​切​​​​​​​换​​​​​​​到​​​​​​​下​​​​​​​一​​​​​​​个​​​​​​​路​​​​​​​径​​​​​​​前​​​​​​​指​​​​​​​向​​​​​​​一​​​​​​​个​​​​​​​路​​​​​​​径​​​​​​​的​​​​​​​  |
|                      | I/O 请​​​​​​​求​​​​​​​数​​​​​​​目​​​​​​​。​​​​​​​默​​​​​​​认​​​​​​​值​​​​​​​为​​​​​​​ 1000。​​​​​​​                 |
+----------------------+-----------------------------------------------+
| ` flush_on_          | （在​​​​​​​ RHEL 5.3                                 |
| last_del `{.literal} | 以​​​​​​​及​​​​​​​之​​​​​​​后​​​​​​​的​​​​​​​版​​​​​​​本​​​​​​​中​​​​​​​）如​​​​​​​果​​​​​​​将​​​​​​​其​​​​​​​设​​​​​​​定​​​​​​​为​​​​​​​              |
|                      | `yes`{.literal}，`multipathd`{.command}       |
|                      | 守​​​​​​​护​​​​​​​进​​​​​​​程​​​​​​​将​​​​​​​在​​​​​​​删​​​​​​​除​​​​​​​了                            |
|                      | ​​​​​​​最​​​​​​​后​​​​​​​一​​​​​​​个​​​​​​​到​​​​​​​某​​​​​​​个​​​​​​​设​​​​​​​备​​​​​​​的​​​​​​​路​​​​​​​径​​​​​​​时​​​​​​​禁​​​​​​​用​​​​​​​查​​​​​​​询​​​​​​​。​​​​​​​默​​​​​​​认​​​​​​​值​​​​​​​为​​​​​​​  |
|                      | `no`{.literal}。​​​​​​​                              |
+----------------------+-----------------------------------------------+
| ` product_b          | 根                                            |
| lacklist `{.literal} | ​​​​​​​据​​​​​​​产​​​​​​​品​​​​​​​指​​​​​​​定​​​​​​​用​​​​​​​来​​​​​​​将​​​​​​​设​​​​​​​备​​​​​​​列​​​​​​​入​​​​​​​黑​​​​​​​名​​​​​​​单​​​​​​​的​​​​​​​常​​​​​​​规​​​​​​​表​​​​​​​达​​​​​​​式​​​​​​​。​​​​​​​  |
+----------------------+-----------------------------------------------+
:::
:::
::: para
以​​​​​​​下​​​​​​​示​​​​​​​例​​​​​​​显​​​​​​​示​​​​​​​了​​​​​​​多​​​​​​​路​​​​​​​径​​​​​​​配​​​​​​​置​​​​​​​文​​​​​​​件​​​​​​​的​​​​​​​ `device`{.literal} 条​​​​​​​目​​​​​​​。​​​​​​​
:::
``` screen
#	}
#	device {
#		vendor			"COMPAQ  "
#		product			"MSA1000         "
#		path_grouping_policy	multibus
#		path_checker		tur
#		rr_weight		priorities
#	}
#}
```
:::
:::
[]{#MPIO_admin-troubleshoot.html}
::: chapter
::: titlepage
# [⁠]{#MPIO_admin-troubleshoot.html#MPIO_admin-troubleshoot}第 5 章 DM-Multipath 管​​​​​​​理​​​​​​​及​​​​​​​故​​​​​​​障​​​​​​​排​​​​​​​除​​​​​​​ {.title}
:::
::: para
本​​​​​​​章​​​​​​​提​​​​​​​供​​​​​​​了​​​​​​​在​​​​​​​运​​​​​​​行​​​​​​​的​​​​​​​系​​​​​​​统​​​​​​​中​​​​​​​管​​​​​​​理​​​​​​​ DM-Multipath 的​​​​​​​信​​​​​​​息​​​​​​​，其​​​​​​​中​​​​​​​包​​​​​​​括​​​​​​​以​​​​​​​下​​​​​​​部​​​​​​​分​​​​​​​：
:::
::: {.itemizedlist xmlns:d="http://docbook.org/ns/docbook"}
-   ::: para
    The Multipath Daemon
    :::
-   ::: para
    Issues with Large Number of LUNs
    :::
-   ::: para
    Issues with queue_if_no_path feature
    :::
-   ::: para
    Multipath Command Output
    :::
-   ::: para
    Multipath Queries with multipath Command
    :::
-   ::: para
    Multipath Command Options
    :::
-   ::: para
    用​​​​​​​ dmsetup 命​​​​​​​令​​​​​​​进​​​​​​​行​​​​​​​多​​​​​​​路​​​​​​​径​​​​​​​查​​​​​​​询​​​​​​​
    :::
-   ::: para
    Troubleshooting with the multipathd Interactive Console
    :::
:::
::: section
::: titlepage
# [⁠]{#MPIO_admin-troubleshoot.html#multipath_daemon}5.1. The Multipath Daemon {.title}
:::
[]{#MPIO_admin-troubleshoot.html#idm140667712034992 .indexterm}
::: para
If you find you have trouble implementing a multipath configuration, you
should ensure that the multipath daemon is running, as described in
[第 3 章 *安​​​​​​​装​​​​​​​ DM-Multipath*](#mpio_setup.html){.xref}. The
`multipathd`{.command} daemon must be running in order to use
multipathed devices.
:::
:::
::: section
::: titlepage
# [⁠]{#MPIO_admin-troubleshoot.html#many_luns}5.2. Issues with Large Number of LUNs {.title}
:::
::: para
当​​​​​​​在​​​​​​​某​​​​​​​个​​​​​​​节​​​​​​​点​​​​​​​中​​​​​​​添​​​​​​​加​​​​​​​大​​​​​​​量​​​​​​​ LUN 时​​​​​​​，使​​​​​​​用​​​​​​​多​​​​​​​路​​​​​​​径​​​​​​​设​​​​​​​备​​​​​​​可​​​​​​​明​​​​​​​显​​​​​​​延​​​​​​​长​​​​​​​ `udev`{.literal}
设​​​​​​​备​​​​​​​过​​​​​​​滤​​​​​​​器​​​​​​​为​​​​​​​其​​​​​​​生​​​​​​​成​​​​​​​设​​​​​​​备​​​​​​​节​​​​​​​点​​​​​​​所​​​​​​​用​​​​​​​的​​​​​​​时​​​​​​​间​​​​​​​。​​​​​​​如​​​​​​​果​​​​​​​您​​​​​​​遇​​​​​​​到​​​​​​​过​​​​​​​这​​​​​​​个​​​​​​​问​​​​​​​题​​​​​​​，您​​​​​​​可​​​​​​​在​​​​​​​
`/etc/udev/rules.d/40-multipath.rules`{.filename}
文​​​​​​​件​​​​​​​中​​​​​​​删​​​​​​​除​​​​​​​以​​​​​​​下​​​​​​​行​​​​​​​解​​​​​​​决​​​​​​​这​​​​​​​个​​​​​​​问​​​​​​​题​​​​​​​：
:::
``` screen
KERNEL!="dm-[0-9]*", ACTION=="add", PROGRAM=="/bin/bash -c '/sbin/lsmod | /bin/grep ^dm_multipath'", RUN+="/sbin/multipath -v0 %M:%m"
```
::: para
这​​​​​​​行​​​​​​​会​​​​​​​在​​​​​​​每​​​​​​​次​​​​​​​向​​​​​​​该​​​​​​​节​​​​​​​点​​​​​​​中​​​​​​​添​​​​​​​加​​​​​​​块​​​​​​​设​​​​​​​备​​​​​​​时​​​​​​​让​​​​​​​ `udev`{.literal} 设​​​​​​​备​​​​​​​管​​​​​​​理​​​​​​​器​​​​​​​运​​​​​​​行​​​​​​​
`multipath`{.literal}。​​​​​​​虽​​​​​​​然​​​​​​​删​​​​​​​除​​​​​​​了​​​​​​​这​​​​​​​一​​​​​​​行​​​​​​​，`multipathd`{.command}
守​​​​​​​护​​​​​​​进​​​​​​​程​​​​​​​仍​​​​​​​将​​​​​​​自​​​​​​​动​​​​​​​生​​​​​​​成​​​​​​​多​​​​​​​路​​​​​​​径​​​​​​​设​​​​​​​备​​​​​​​，在​​​​​​​引​​​​​​​导​​​​​​​过​​​​​​​程​​​​​​​中​​​​​​​仍​​​​​​​将​​​​​​​为​​​​​​​带​​​​​​​多​​​​​​​路​​​​​​​径​​​​​​​根​​​​​​​文​​​​​​​件​​​​​​​系​​​​​​​统​​​​​​​的​​​​​​​节​​​​​​​点​​​​​​​调​​​​​​​用​​​​​​​
`multipath`{.literal}。​​​​​​​唯​​​​​​​一​​​​​​​的​​​​​​​改​​​​​​​变​​​​​​​就​​​​​​​是​​​​​​​没​​​​​​​有​​​​​​​运​​​​​​​行​​​​​​​ `multipathd`{.command}
守​​​​​​​护​​​​​​​进​​​​​​​程​​​​​​​不​​​​​​​再​​​​​​​自​​​​​​​动​​​​​​​生​​​​​​​成​​​​​​​多​​​​​​​路​​​​​​​径​​​​​​​设​​​​​​​备​​​​​​​，对​​​​​​​大​​​​​​​多​​​​​​​数​​​​​​​多​​​​​​​路​​​​​​​径​​​​​​​用​​​​​​​户​​​​​​​来​​​​​​​说​​​​​​​应​​​​​​​该​​​​​​​不​​​​​​​是​​​​​​​个​​​​​​​问​​​​​​​题​​​​​​​。​​​​​​​
:::
:::
::: section
::: titlepage
# [⁠]{#MPIO_admin-troubleshoot.html#queueifnopath_issues}5.3. Issues with queue_if_no_path feature {.title}
:::
::: para
If `features "1 queue_if_no_path"`{.literal} is specified in the
`/etc/multipath.conf`{.filename} file, then any process that issues I/O
will hang until one or more paths are restored. To avoid this, set the
`no_path_retry`{.literal} *`N`* parameter in the
`/etc/multipath.conf`{.filename} file (where *`N`* is the number of
times the system should retry a path). When you do, remove the
`features "1 queue_if_no_path"`{.literal} option from the
`/etc/multipath.conf`{.filename} as well.
:::
::: para
If you need to use the `features "1 queue_if_no_path"`{.literal} option
and you experience the issue noted here, use the `dmsetup`{.command}
command to edit the policy at runtime for a particular LUN (that is, for
which all the paths are unavailable). For example, if you want to change
the policy on the multipath device `mpath2`{.literal} from
`"queue_if_no_path"`{.literal} to `"fail_if_no_path"`{.literal}, execute
the following command.
:::
``` screen
dmsetup message mpath2 0 "fail_if_no_path"
```
::: para
请​​​​​​​注​​​​​​​意​​​​​​​：您​​​​​​​必​​​​​​​须​​​​​​​指​​​​​​​定​​​​​​​ `mpath`{.literal}*`n`* 别​​​​​​​名​​​​​​​而​​​​​​​不​​​​​​​是​​​​​​​该​​​​​​​路​​​​​​​径​​​​​​​。​​​​​​​
:::
:::
::: section
::: titlepage