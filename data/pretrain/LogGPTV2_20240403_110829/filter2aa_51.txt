Measuring*the*IQ*of*your*Threat*
Intelligence*Feeds*(#TIQtest)*
Alex%Pinto%
MLSec%Project%%
@alexcpsec%
@MLSecProject!
Kyle%Maxwell%
Researcher%
@kylemaxwell!
Alex%Pinto%
•  Science%guy%at%MLSec%Project%
•  ML%trainer%
•  Network%security%aﬁcionado%%
•  Tortured%by%SIEMs%as%a%child%
•  Hacker%Spirit%Animal™:%
CAFFEINATED%CAPYBARA!
whoami(s)*
Kyle%Maxwell%
•  Researcher%at%[REDACTED]%
•  Math%Smuggler%
•  Recovering%Incident%Responder%
•  GPL%zealot%
•  Hacker%Spirit%Animal™:%
AXIOMATIC%ARMADILLO!
(hUps://secure.ﬂickr.com/photos/kobashi_san/)%
(hUp://www.langorigami.com/art/gallery/
gallery.php?tag=mammals&name=armadillo)%
•  Threat%Intel%102%
•  Measuring%Intelligence%
•  Data%Preparaaon%
•  Tesang%the%Data%
•  Tools:%
•  COMBINE%
•  TIQcTEST%
•  Some%parang%ideas%
Agenda*
(hUp://www.savagechickens.com/2008/12/iqctest.html)%
Threat*Intel*102:*Capability*and*
Intent*
•  What%are%they%able%to%do?%
•  What%are%they%intending%to%do?!
Threat*Intel*102:*Cage*Matches*
•  Signatures%vs%Indicators%
•  Data%vs%Intelligence%
•  Tacacal%vs%Strategic%
•  Atomic%vs%Composite%
Threat*Intel*102:*Pyramid*of*Pain*
“Simple”%and%“easy”%aren’t%always%
(David%Bianco%–%Pyramid%of%Pain)%
What*about*IP*addresses?*
•  Approximately%same%value%as%hostnames%(APT%vs%DGA)%
•  Finite%resource%(unal%IPv6,%that%is)%
• 
Managed%/%controlled%by%orgs%
• 
Diﬃculty%/%economic%incenaves%/%implied%“cost”%
• 
Also,%recyclable%%
(hUps://xkcd.com/865/)%
Given&IP&addresses&harvested&from&
TI&feeds,&can&we&measure&how&
much&they&“help”&our&defense&
metrics?!
Introducing*TIQGTEST*
•  All%these%tests%are%available%as%R%funcaons%at%%
• 
hUps://github.com/mlsecproject/aqctest%
• 
Have%fun,%prove%me%wrong,%suggest%stuﬀ%
•  Tools%that%implement%those%tests%
•  Sample%data%+%R%Markdown%ﬁle%
•  The%excuse%to%learn%a%staasacal%language%you%were%waiang%
for!%
Data*Sources*–*Types*of*data*
•  Extract%the%“raw”%informaaon%from%indicator%feeds%
•  Both%IP%addresses%and%hostnames%were%extracted%
Data*Sources*–*Feeds*Selected*
•  Data%was%separated%into%“inbound”%and%“outbound”%
Data*PreparaLon*and*Cleansing*
•  Convert%the%hostname%data%to%IP%addresses:%
• 
Acave%IP%addresses%for%the%respecave%date%(“A”%query)%
• 
Passive%DNS%from%Farsight%Security%(DNSDB)%
•  We%removed%noncpublic%IPs%from%the%dataset%(RFC1918)%%
• 
Yeah,%we%know%it%is%a%“parking%technique”%
(hUps://xkcd.com/742/)%
Data*PreparaLon*and*Cleansing*
•  For%each%IP%record%(including%the%ones%from%hostnames):%
• 
Add%asnumber%and%asname%(from%MaxMind%ASN%DB)%
• 
Add%country%(from%MaxMind%GeoLite%DB)%
• 
Add%rhost%(again%from%DNSDB)%–%most%popular%“PTR”%
•  The%experiments%will%be%around%ASNs%and%Geolocaaon%
Data*PreparaLon*and*Cleansing*
•  However,%we%will%NOT%be%using%maps.%Just%let%it%go.%
Data*PreparaLon*and*Cleansing*
•  Small%enriched%sample:!
TesLng*the*Data*
•  Let’s%generate%some%interesang%metrics:%
• 
NOVELTY%–%How%oxen%do%they%update%themselves?%
• 
OVERLAP%–%How%do%they%compare%to%what%you%got?%
• 
POPULATION%–%what%is%in%them%anyway?%
•  Populaaon%is%tricky:%
• 
Could%mean%the%enare%world%(all%IPv4%space)%
• 
Should%ideally%mean%YOUR%world%
But*WHAT*IS*THE*IQ?!??1?*
•  We%will%withhold%judgment%
•  The%best%data%composiaon%is%the%best%one%for%you%
•  We%will%do%our%best%to%explain%results%so%you%can%decide.%
•  Maybe%on%further%(or%more%private)%research…%
%
%
Novelty&Test&–&measuring%added%
and%dropped%indicators!
Novelty*Test*(1)*
Novelty*Test*(2)*
Overlap&Test&–&More%data%is%beUer,%
but%make%sure%it%is%not%the%same%
data!
Overlap*Test*
Overlap*Test*
Overlap*Test*
PopulaLon*Test*
•  Let%us%use%the%ASN%and%
GeoIP%databases%that%we%
used%to%enrich%our%data%as%a%
reference%of%the%“true”%
populaaon.%%
•  But,%but,%human%beings%are%
unpredictable!%We%will%
never%be%able%to%forecast%
this!%
%
%
Can*we*get*a*beSer*look?*
•  Don’t%like%squinang%either%
•  Staasacal%inferencecbased%comparison%models%
(hypothesis%tesang)%
• 
Exact%binomial%tests%(when%we%have%the%“true”%pop)%
• 
Chicsquared%proporaon%tests%(similar%to%
independence%tests)%
%
Can*we*get*a*beSer*look?*
•  We%can%beUer%esamate,%with%conﬁdence%intervals,%our%
measures%of%error.%
•  Also,%pcvalues!%(with%apologies%to%Alex%HuUon)%
•  We%promise%to%be%very%conservaave%in%using%them.%
%
Hacker*Spirit*Animal™*Guide*
•  US%–%Eagle%
•  CA%–%Moose%
•  FR%–%Frog%
•  GB%–%Bulldog%
•  AU%–%Koala%
•  BR%–%Capybara%/%Toucan%
•  Texas%–%Armadillo%
•  Disclaimer:%we%do%not%endorse%Geolocaaoncbased%aUribuaon%
Trend*Comparison*
Introducing*COMBINE*
•  Harvesang%feeds%
takes%some%work.%
•  Most%of%us%let%
somebody%else%do%it%
without%thinking%
about%what%it%
actually%takes.%
Introducing*COMBINE*
hUps://github.com/mlsecproject/combine%
Introducing*COMBINE*
•  Components:%
1.  Reaper%gathers%the%threat%data%directly%from%feeds.%
2.  Thresher%normalizes%it%into%a%simplisac%data%model.%
3.  Winnower%opaonally%performs%basic%validaaon%or%
enrichment.%
4.  Baler%transforms%the%data%into%CybOX,%CSV,%JSON,%and%
CIM.%(Only%CSV%and%JSON%work%right%now).%Could%also%
write%others%fairly%easily.%(nudge%nudge,%wink%wink)%
Introducing*COMBINE*
•  Always%trying%to%feed%
it%more.%Lots%of%
possibiliaes,%
including%your%own%
data%sources.%
•  We%clearly%do%NOT%
endorse%any%included%
feeds.%%
Introducing*COMBINE*
•  Enrichments%c%think%
metadata.%%
•  AS,%geolocaaon%
•  DNS%resoluaons%
courtesy%of%Farsight%
DNSDB%%
•  Ask%them%for%an%
API%key%to%test%it,%tell%
them%Alex%Pinto%
sent%you%;)%%
MLSec*Project*
•  Both%projects%have%been%released%as%GPLv3%by%MLSec%Project%
•  Will%replace%the%internal%versions%we%have%on%the%main%code%
%
•  Looking%for%paracipants%and%data%sharing%agreements%
•  Liked%TIQcTEST?%We%can%benchmark%your%private%feeds%using%
these%and%other%techniques%
%
•  Visit%hSps://www.mlsecproject.org%,%message%@MLSecProject%
or%just%ecmail%me.!
Take*Aways*
•  Analyze%your%data.%%
•  Extract%value%from%it!%
•  Try%before%you%buy!%Diﬀerent%test%
results%mean%diﬀerent%things%to%
diﬀerent%orgs.%
•  Use%the%tools!%Suggest%new%tests!%
•  Share%data%with%us!%We%take%good%
care%of%it,%make%sure%it%gets%
proper%exercise.%%
Thanks!*
•  Q&A?%
•  Feedback!%
Alex%Pinto%%
@alexcpsec%
@MLSecProject%
”The%measure%of%intelligence%is%the%ability%to%change."%%
%
%
%
%%
%
%c%Albert%Einstein%%
Kyle%Maxwell%
@kylemaxwell%