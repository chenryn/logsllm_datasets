ThesecondpartisOtterTune’stuningmanager. Itreceivesthe ThisprocesscontinuesuntiltheDBAissatisfiedwiththeimprove-
informationcollectedfromthecontrollerandstoresitinitsreposi- mentsovertheinitialconfiguration.
torywithdatafromprevioustuningsessions. Thisrepositorydoes
notcontainanyconfidentialinformationabouttheDBMSsortheir 3.2 Assumptions&Limitations
databases; it only contains knob configurations and performance
ThereareseveralaspectsofOtterTune’scapabilitiesthatwemust
data.OtterTuneorganizesthisdatapermajorDBMSversion(e.g.,
address.Foremostisthatweassumethatthecontrollerhasadmin-
Postgresv9.3dataisseparatefromPostgresv9.4). Thisprevents
istrativeprivilegestomodifytheDBMS’sconfiguration(including
OtterTune from tuning knobs from older versions of the DBMS
restartingtheDBMSifnecessary). Ifthisisnotpossible,thenthe
that may be deprecated in newer versions, or tuning knobs that
DBAcandeployasecondcopyofthedatabaseonseparatehard-
only exist in newer versions. The manager is also supported by
wareforOtterTune’stuningtrials. ThisrequirestheDBAeitherto
backgroundprocessesthatcontinuouslyanalyzenewdataandre-
replayaworkloadtraceortoforwardqueriesfromtheproduction
fine OtterTune’s internal ML models. These models allow it to
DBMS.Thisisthesameapproachusedinprevioustools[24].
identifytherelevantknobsandmetricswithouthumaninput,and
Restarting the DBMS is often necessary because some knobs
findworkloadsintherepositorythataresimilartothetarget.
onlytakeeffectafterthesystemisstoppedandstarted.Someknobs
alsocausetheDBMStoperformextraprocessingwhenitcomes
3.1 Example
back on-line (e.g., resizing log files), which can potentially take
At the start of a new tuning session, the DBA tells OtterTune severalminutesdependingonthedatabaseandthehardware. Ot-
what metric to optimize when selecting a configuration (e.g., la- terTune currently ignores the cost of restarting the DBMS in its
tency,throughput). TheOtterTunecontrollerthenconnectstothe recommendations.Wedefertheproblemofautomaticallyidentify-
target DBMS and collects its hardware profile and current knob ingtheseknobsandtakingthecostofrestartingintoconsideration
configuration. We assume that this hardware profile is a single whenchoosingconfigurationsasfuturework.
identifierfromalistofpre-definedtypes(e.g.,aninstancetypeon BecauserestartingtheDBMSisundesirable,manyDBMSssup-
AmazonEC2).Wedefertheproblemofautomaticallydetermining port changing some knobs dynamically without having to restart
thehardwarecapabilitiesofaDBMSdeploymenttofuturework. thesystem. OtterTunestoresalistofthedynamicknobsthatare
The controller then starts the first observation period. This is availableoneachoftheDBMSversionsthatitsupports,aswellas
someamountoftimewherethecontrollerwillobservetheDBMS theinstructionsonhowtoupdatethem. ItthenrestartstheDBMS
and measure DBMS-independent external metrics chosen by the onlywhenthesetofknobsbeingtunedrequiresit. TheDBAcan
DBA(e.g.,latency). TheDBAmaychoosetoexecuteeitheraset also elect to tune only dynamic knobs at the start of the tuning
ofqueriesforafixedtimeperiodoraspecificworkloadtrace. If session. This is another alternative that is available to the DBA
theDBAchoosesthefirstoption,thenthelengthoftheobservation when restarting the DBMS is prohibited. We maintain a curated
period is equal to the fixed time period. Otherwise, the duration black-listofknobsforeachDBMSversionthatissupportedbyOt-
depends on how long it takes for the DBMS to replay the work- terTune. TheDBAisprovidedwiththisblack-listofknobsatthe
loadtrace. Fixedobservationperiodsarewell-suitedforthefast, startofeachtuningsession. TheDBAispermittedtoaddtothis
simplequeriesthatarecharacteristicofOLTPworkloads,whereas listanyotherknobsthattheywantOtterTunetoavoidtuning.Such
variable-lengthperiodsareoftennecessaryforexecutingthelong- knobs could either be ones that do not make sense to tune (e.g.,
running,complexqueriespresentinOLAPworkloads. path names of where the DBMS stores files), or ones that could
At the end of the observation period, the controller then col- havehiddenorseriousconsequences(e.g.,potentiallycausingthe
lectsadditionalDBMS-specificinternalmetrics.Examplesinclude DBMS to lose data). Again, automatically determining whether
MySQL’s counters for pages read to or written from disk. Other changingaknobwillcausetheapplicationtopotentiallylosedata
DBMSs provide similar metrics, but OtterTune does not require isbeyondthescopeofourworkhere.
anyinformationfromtheDBAabouttheirmeaning,whetherthey Lastly,wealsoassumethatthephysicaldesignofthedatabase
areindicativeofgoodorbadperformance,orwhethermetricswith isreasonable. ThatmeansthattheDBAhasalreadyinstalledthe
differentnamesmeanthesamethingindifferentDBMSs. Wedis- proper indexes, materialized views, and other database elements.
cussthismetriccollectioninfurtherdetailinSect.4,alongwithour Therehasbeenaconsiderableamountofresearchintoautomatic
approachtoranktheDBMS’sknobsbytheirimportanceinSect.5. databasedesign[16]thattheDBAcanutilizeforthispurpose. As
1011
Workload Characterization Knob Identification Automatic Tuner
Metrics Distinct Metrics Phase 1
selpmaS
Knobs Knobs
Metrics selpmaS
Configs GPs Importance
Data AF na ac lyto sr is Factors CK l- um ste ea rin ns g Phase 2 WM oa rp kp loe ad d
Repository scirteM
Lasso
New
Observations
Figure3: OtterTuneMachineLearningPipeline–ThisdiagramshowstheprocessingpathofdatainOtterTune. Allpreviousobservationsresideinits
repository. ThisdataisfirstthenpassedintotheWorkloadCharacterization(Sect.4)componentthatidentifiesthemostdistinguishingDBMSmetrics.
Next,theKnobIdentification(Sect.5)componentgeneratesarankedlistofthemostimportantknobs. AllofthisinformationthenfedintotheAutomatic
Tuner(Sect.6)componentwhereitmapsthetargetDBMS’sworkloadtoapreviouslyseenworkloadandgeneratesbetterconfigurations.
discussedinAppendixC,weplantoinvestigatehowtoapplythese granularities.Butaswewillshow,OtterTune’smodelconstruction
sametechniquestotunethedatabase’sphysicaldesign. algorithmsdonotrequiremetricstobelabeled.
Inthesectionsthatfollow,wedescribehowOtterTunecollects 4.1 StatisticsCollection
runtimemetricsfromtheDBMSduringatuningsession. Itthen
creates models from this data that allow it to (1) select the most OtterTune’s controller supports a modular architecture that en-
impactfulknobs,(2)mappreviouslyunseendatabaseworkloadsto ablesittoperformtheappropriateoperationsfordifferentDBMSs
knownworkloads,and(3)recommendknobsettings.Westartwith tocollecttheirruntimestatistics.Atthebeginningofeachobserva-
discussinghowtoidentifywhichofthemetricsgatheredbythetun- tionperiod,thecontrollerfirstresetsallofthestatisticsforthetar-
ingtoolbestcharacterizeanapplication’sworkload. Anoverview getDBMS.Itthenretrievesthenewstatisticsdataattheendofthe
ofthisentireprocessisshowninFig.3. period.SinceatthispointOtterTunedoesnotknowwhichmetrics
areactuallyuseful,itcollectseverynumericmetricthattheDBMS
makesavailableandstoresitasakey/valuepairinitsrepository.
4. WORKLOADCHARACTERIZATION The main challenge in this collection process is how to repre-
sent metrics for sub-elements of the DBMS and database. Some
Thefirststepinthetuningsystemistodiscoveramodelthatbest
systems, like MySQL, only report aggregate statistics for the en-
representsthedistinguishingaspectsofthetargetworkloadsothat
tireDBMS.Othersystems,however,provideseparatestatisticsfor
itcanidentifywhichpreviouslyseenworkloadsintherepository
tables or databases. Commercial DBMSs even maintain separate
aresimilartoit.ThisenablesOtterTunetoleveragetheinformation
statisticsforindividualcomponents(e.g.,IBMDB2tracksstatistics
thatithascollectedfromprevioustuningsessionstohelpguidethe
perbufferpoolinstance). Theproblemwiththisfine-graineddata
searchforagoodknobconfigurationforthenewapplication.
isthattheDBMSprovidesmultiplemetricswiththesamename.
Wemightconsidertwoapproachestodothis.Thefirstistoana-
Onepotentialsolutionistoprefixthenameofthesub-element
lyzethetargetworkloadatthelogicallevel.Thismeansexamining
tothemetric’sname.Forexample,Postgres’metricforthenumber
thequeriesandthedatabaseschematocomputemetrics,suchasthe
ofblocksreadforthetable“foo”wouldbestoredintherepository
numberoftables/columnsaccessedperqueryandtheread/writera-
asfoo.heap_blks_read.Butthisapproachmeansthatitisunable
tiooftransactions.Thesemetricscouldbefurtherrefinedusingthe
tomapthismetrictootherdatabasessincetheywillhavedifferent
DBMS’s “what-if” optimizer API to estimate additional runtime
namesfortheirtables.OtterTuneinsteadstoresthemetricswiththe
information[15], likewhichindexesareaccessedthemostoften.
samenameasasinglesumscalarvalue.ThisworksbecauseOtter-
Theproblemwiththisapproach, however, isthatitisimpossible
Tunecurrentlyonlyconsidersglobalknobs. Wedefertheproblem
todeterminetheimpactofchangingaparticularknobbecauseall
oftuningtable-orcomponent-specificknobsasfuturework.
of these estimates are based on the logical database and not the
actualruntimebehaviorofqueries. Furthermore,howtheDBMS 4.2 PruningRedundantMetrics
executesaqueryandhowthequeryrelatestointernalcomponents
The next step is to automatically remove the superfluous met-
thatareaffectedbytuningknobsisdependentonmanyfactorsof
rics.ItisimportanttoremovesuchelementssothatOtterTuneonly
thedatabase(e.g.,size,cardinalities,workingsetsize).Hence,this
hastoconsiderthesmallestsetofmetricsthatcapturethevariabil-
informationcannotbecapturedjustbyexaminingtheworkload.
ity in performance and distinguishing characteristics for different
A better approach is to use the DBMS’s internal runtime met-
workloads. Reducingthesizeofthissetreducesthesearchspace
ricstocharacterizehowaworkloadbehaves. AllmodernDBMSs
ofMLalgorithms,whichinturnspeedsuptheentireprocessand
expose a large amount of information about the system. For ex-
increasesthelikelihoodthatthemodelswillfitinmemoryonOt-
ample,MySQL’sInnoDBengineprovidesstatisticsonthenumber
terTune’s tuning manager. We will show in subsequent sections
of pages read/written, query cache utilization, and locking over-
thatthemetricsavailabletoOtterTunearesufficienttodistinguish
head. OtterTunecharacterizesaworkloadusingtheruntimestatis-
betweenworkloadsforDBMSsdeployedonthesamehardware.
tics recorded while executing it. These metrics provide a more
RedundantDBMSmetricsoccurfortworeasons. Thefirstare
accurate representation of a workload because they capture more
onesthatprovidedifferentgranularitiesfortheexactsamemetricin
aspectsofitsruntimebehavior. Anotheradvantageofthemisthat
thesystem. Forexample,MySQLreportstheamountofdataread
theyaredirectlyaffectedbytheknobs’settings.Forexample,ifthe
intermsofbytes3 andpages.4 Thetwometricsarethesamemea-
knobthatcontrolstheamountofmemorythattheDBMSallocates
surementjustindifferentunits, thusitisunnecessarytoconsider
toitsbufferpoolistoolow, thenthesemetricswouldindicatean
increase in the number of buffer pool cache misses. All DBMSs 3 MySQLMetric:innodb_data_read
providesimilarinformation,justwithdifferentnamesanddifferent 4 MySQLMetric:innodb_pages_read
1012
both of them. The other type of redundant metrics are ones that
representindependentcomponentsoftheDBMSbutwhosevalues
are strongly correlated. For example, we found from our experi-
ments that the Postgres metric for the number of tuples updated5
movesalmostinunisonwiththemetricthatmeasuresthenumber
ofblocksreadfromthebufferforindexes.6
Weusetwowell-studiedtechniquesforthispruning.Thefirstis
adimensionalityreductiontechnique,calledfactoranalysis(FA)[5],
that transforms the (potentially) high dimensional DBMS metric
data into lower dimensional data. We then use the second tech- (a)MySQL(v5.6) (b)Postgres(v9.3)
nique, called k-means [6], to cluster this lower dimensional data Figure4: MetricClustering–GroupingDBMSmetricsusingk-means
basedonhowsimilartheyaretoeachotherasidentifiedbyFactorAnalysis
into meaningful groups. Using a dimensionality reduction tech-
andplottedbytheir(f1,f2)coordinates. Thecolorofeachmetricshows
nique is a preprocessing step for many clustering algorithms be- itsclustermembership.Thetrianglesrepresenttheclustercenters.
causetheyreducetheamountof“noise”inthedata[31,30]. This
intothesamecluster.InFig.4bweseethatOtterTuneselectseight
improvestherobustnessandthequalityoftheclusteranalysis.
clusters for Postgres’ metrics. Like MySQL, the metrics in each
Givenasetofreal-valuedvariablesthatcontainarbitrarycorre-
cluster correspond to similar measurements. But in Postgres the
lations,FAreducesthesevariablestoasmallersetoffactorsthat
metricsareclusteredonspecificcomponentsinthesystem,likethe
capturethecorrelationpatternsoftheoriginalvariables. Eachfac-
backgroundwriter10,11andindexes.12,13
torisalinearcombinationoftheoriginalvariables;thefactorco-