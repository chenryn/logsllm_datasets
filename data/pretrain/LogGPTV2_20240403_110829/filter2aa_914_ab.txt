20
GameOver/Zeus
GameOver / Zeus attempted to 
obfuscate its activities by 
leveraging P2P protocols to avoid 
single points of failure similar to 
how traditional P2P filesharing
services work (loosely based on 
Kademlia DHT techniques
Zeus leveraged basic rolling XOR 
for packet payloads to make 
signature based IDS difficult.  UDP 
Payloads
− Emphasizes the point that often 
times the malware authors will just 
attempt to stay one step ahead of 
security solutions rather than 
implement the most state of the art 
attacks.
Further Reading:  https://www.sans.org/reading-room/whitepapers/detection/analysis-gameover-zeus-network-traffic-35742
21
Dridex using Pastebin as C2 (aka Blind Drop)
Virtually any cloud service 
can be used for C2.  in this 
example Pastebin is 
leveraged.  
While sites like Pastebin
might be simple to turn off, 
Twitter, Amazon, and 
Facebook may have 
legitimate business 
purposes.
Malware may hide in 
comments, images, video 
and uploaded content.
22
Dalexis: ToR as a C2 Channel
After an initial infection, 
malware hops to TOR2Web 
a clientless TOR 
implementation for C2 
Activity
TOR allows botnet 
operators to evade 
communication snooping in 
intermediate systems.
Initial 
Compromise
Probing 
for TOR 
Endpoint
C2 
Connection 
via 
Tor2Web
23
AridViper
Targeted malware which leverages basic HTTP over standard ports to blend in.
This stream is composed of initial client registration to C2 server, along with post 
registration activity to validate interesting files on the system.
Arid Viper originally focused on Israeli targets 
Source: Proofpoint: https://www.proofpoint.com/us/threat-insight/post/Operation-Arid-Viper-Slithers-Back-Into-View
24
C2 Trends and Projections: Encryption
Encryption:
− SSL adoption has rapidly gained steam in 
the last few years, SandVine Projects 
70% encryption in 2016
− Let’s Encrypt could be huge game 
changer for malware
− Previously cost/overhead was high for 
SSL, Let’s Encrypt eliminates this 
limitation.
− Won’t impact state sponsored or targeted 
attacks much, but will impact Crimeware 
heavily.
Source: Ilya Grigorik, Google:  https://plus.google.com/+IlyaGrigorik/posts/GboyXCXxjGr
Source: Let’s Encrypt:  https://letsencrypt.org/stats/
Source: SandVine Spotlight Encrypted Traffic Report:  https://www.sandvine.com/trends/encryption.html
25
C2 Trends and Projections: IPv6
IPv6
− Today IPv4 is still the predominate routed protocol on 
the internet, particularly outside of APAC and 
universities.  This is changing.
− IPv6 presents a big challenge because of the 
massive number of IPv6 addresses.  E.g. Hurricane 
Electric will give you your own /48 of IPv6.  That’s 
65535 /64 networks, each with 
18,446,744,073,709,551,616 hosts!!!
− IPv6 also may expose weaknesses in security 
software that does not support it yet or has underlying 
flaws and vulnerabilities.
− It is enabled by default in virtually every modern OS!  
Source: Google:  https://www.google.com/intl/en/ipv6/statistics.html
Source: Hurricane Electric:  https://tunnelbroker.net/
Source: Jaws, Roy Schneider 1975
26
C2 Trends and Projections: TOR
TOR
− We’re already seeing an 
increase in malware using 
TOR
− Ideal channel for 
concealment of the C2 
− TOR can even be 
implemented without a 
client using Tor2Web.
Source: Proofpoint ET Intelligence, Unique Malware Samples leveraging TOR
Source: Tor2Web Project: https://www.tor2web.org/
27
Leveraging Cloud Apps
Hiding C2 in Cloud/Web Apps
− This is likely to be a continuing trend.  It 
helps to solve the attacker challenge of 
hosting and potential blacklisting of 
standalone C2 infrastructure by overlaying 
it on top of cloud applications which often 
have business legitimacy.
− This makes it harder to detect and harder 
for organizations to take action on 
because they cannot block these apps.
− Puts the onus on Cloud providers to 
detect malicious activity.  The 
effectiveness will vary widely depending 
on how invested these providers are.
− Cloud apps can be deployed with little 
more than an email address, often free 
compute infrastructure for attackers!
Source: Alexa Top Websites: https://en.wikipedia.org/wiki/List_of_most_popular_websites
28
Layered Evasions: Ripe for the Picking
Layered Evasions
− Stacking numerous evasions from the IP level up the chain into the application layer to try 
to evade malicious activity detection by trying to fool detection capabilities (similar to 
traditional IDS layering evasion techniques.
IP Fragmentation
TCP Segment Overlaps
SSL Encryption
HTTP: Chunking, GZIP, Base64, 
Embedded Content (Encoding, Compression, 
Metadata, Dynamic Content)
IP Protocol 41 (IPv6 in IPv4)
29
Steg Adoption
Steganography
− Hiding in plain sight really is a 
powerful covert channel.  
− Attackers may choose to take 
techniques which are not 
computationally difficult to 
generate, but are computationally 
difficult to detect, especially in real 
time network streams.
− Trends will likely be dictated by 
pace of security industry defenses
•
Further Reading: http://embeddedsw.net/doc/Thwarting_audio_steganography_attacks_in_cloud_storage_systems.pdf
•
http://embeddedsw.net/doc/Data_hiding_and_steganography_annual_report_2012.pdf
•
Image Source: Inception, Christopher Nolan, 2010
30
C2 Detection Is Critical!
High fidelity Indicator
May prevent malware from successfully executing
May prevent escalation to attack other hosts inside/outside the network
May prevent sensitive data from making it out
Makes more hoops for the attacker to jump through and therefore more 
opportunities to make a mistake.
31
Defense Mechanisms Part 1
Eliminate the Known Bad
− Block access to known bad IP’s, countries
− Block Access to Malicious Domains/URL’s
Minimize the network attack surface
− Restrict FW/NGFW to least privilege including
• Restrict Firewall Ports!, no any any any policy
• Block unnecessary / undesirable L7 applications with an NGFW/IPS
• E.g. ToR, ToR2Web, Unknown Binary Strings
• Block unknown / unknown encrypted applications at the perimeter with an NGFW/IPS
• NGFW’s can identify low hanging fruit with AppID, IPS can help to identify potential protocol 
anomalies used when malware attempts to masquerade over HTTP/HTTPS ports.
78.23%
4.00%
1.84%
15.93%
0.00%
10.00%
20.00%
30.00%
40.00%
50.00%
60.00%
70.00%
80.00%
90.00%
TCP Port 80
TCP Port 443
TCP/UDP Port 
1024
Malware C2 Channels by Port
32
Defense Mechanisms Part 2
Fingerprint Known Malware
− Where possible, identify 
malware with both pattern 
matching and behavioral 
identification from a high 
fidelity source.  If you can 
accurately identify malware 
itself, then you can have a 
higher degree of confidence 
of an infection.
− Especially if you can identify 
the malware by it’s C2 
channel
33
Defense Mechanisms Part 3
Eliminate SSL Blind Spot with Interception
− SSL Interception is an increasingly important function if it can be leveraged.
− It allows you to not only inspect encrypted streams, but also breaks any malware that uses 
predefined certificates / unsupported configurations.
− Try to limit Trusted CA certs wherever possible, especially on SSL Proxy and on endpoints.  
This can help to mitigate malware being able to connect to suspicious systems signed by 
low trust partners.
− Restrict SSL MiTM to using strong ciphers to potentially break malware using weak / 
outdated ciphers.
Detect/Block Known Bad SSL Certs
− Where possible, use IDS or other technology to detect known malicious SSL certs which 
provide high fidelity indicators of an attack (even if SSL MiTM isn’t possible)
− Record TLS Certificates observed on network with tools like Suricata or Bro.
− Abuse.CH!
34
Defense Mechanisms Part 4
Heuristics / Anomaly Detection
− Heuristics/Pattern matching is not a perfect catch all for identifying suspicious activity due to 
highly evasive techniques, especially when it can be corroborated with other IOC’s.  
− One high fidelity indicator of compromise can be to examine DNS data to try to identify 
domain generation algorithms used by modern malware.  
− Some IDS can also identify this activity, but placement is very important because it needs to 
be between the client and the DNS server, otherwise all attacks will look like they are 
coming from the DNS server.
Network Anomaly Detection:
− By itself a low fidelity indicator and FP prone, when combined with other techniques, 
anomaly detection can provide valuable insight.  Particularly when network based 
steganography and evasion techniques are used, a good IDS anomaly engine will light up 
like a Christmas tree.
35
Defense Mechanisms:  Part 5
Review, Tune, and Listen to your Security 
Infrastructure!  (Give a shit)
−
As we’ve seen with many high profile breaches, it is often the 
case that malicious activity is detected, but it isn’t acted upon.
−
Most off the shelf malware and attacks provide many IOC’s to 
key on which can be detected by freely available software 
and systems.
−
There are commercial and open source solutions available 
that can help to solve the problem of the signal to noise, 
auxiliary endpoint verification, and end to end IR 
containment.
36
Most Importantly
Get Involved!
− Contribute to ET Open, Free Open Source IDS Rules for Suricata and 
Snort
– http://doc.emergingthreats.net/bin/view/Main/EmergingFAQ
– PI:EMAIL
− Contribute to OISF / Suricata Development
– https://oisf.net/
– https://suricata-ids.org/
37
Summary
− In modern computer security, it’s not a matter of if, but when, and what they will take, and 
how much it will cost you to deal with it.  
− The attack surface is simply too massive, to put all of your hopes in the fact that you might 
be able to keep malware out.  
− In taking the fight to the attackers, we need to be smart, and to holistically detect breaches.  
Not only on the initial phases, but perhaps where the attackers are most exposed and we 
have the most defensive capabilities to detect them by detecting the C2 channels.  
− As we continue to up our game, we should expect that the malicious actors will do the 
same, and come up with even more creative ways to leverage the same technology which 
can be used for incredible good for their own malicious purposes. 
− But at the very least, we can keep them on their game, and further tip the economics of 
hacking by making their job that much harder. We’ll do it by exploiting them for a change; at 
their weakest point, the command and control channel.
38
Thank You!