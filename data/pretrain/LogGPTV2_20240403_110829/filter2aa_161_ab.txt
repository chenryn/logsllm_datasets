•  Used,to,update,user,conﬁgura:ons,
–  User,Name/Password,
–  Descrip:on,of,Account,
Copyright,2016,Trend,Micro,Inc.,
30,
Easy,steps,to,exploita:on,
1.  Login,known,account,and,click,‘Project,user,property’.,
– 
http:///broadWeb/user/upAdminPg.asp?uname=known&return=bwpro=
2.  Set,uname,to,vic:m,account,name.,
– 
http:///broadWeb/user/upAdminPg.asp?uname=victim&return=bwproj=
3.  View,the,source,in,page,return,and,examine,the,password,
of,the,user.,
=
=
=Password=
=
==
=
=
==
==
=
Copyright,2016,Trend,Micro,Inc.,
31,
Exploita:on,Demo,
Copyright,2016,Trend,Micro,Inc.,
32,
Insecure,Defaults,
• 
12%,of,iden:ﬁed,vulnerabili:es,
• 
Common,vulnerability,types,
–  Cleartext,Transmission,of,Sensi:ve,,
Informa:on,
–  Missing,Encryp:on,of,Sensi:ve,Info,
–  Unsafe,Ac:veX,Control,Marked,
Safe,For,Scrip:ng,
• 
Zero,Day,Ini:a:ve,case,study,
–  Schneider,Electric,DS'NVs,,
Rvctl.RVControl.1,SetText,,
Remote,Code,Execu:on,Vulnerability,
Copyright,2016,Trend,Micro,Inc.,
33,
,
Schneider,Electric,Pelco,DS'NVs,,
•  ICS'CERT,states:,
–  “products,contain,vulnerable,DLL”,
•  Iden:ﬁers,
–  CVE'2015'0982,
–  ZDI'15'090,
–  ICSA'15'071'01,
•  CVSS,
–  7.5,
•  Disclosure,Timeline,,
–  2014–08–13,',Reported,to,vendor,,
2015–03–12,–,Coordinated,release,
•  Credit,
–  Discovered,by:,rgod,and,kimiya,
–  Disclosed,by:,Zero,Day,Ini:a:ve,
Copyright,2016,Trend,Micro,Inc.,
34,
Ac:veX,Control,Semngs,
Copyright,2016,Trend,Micro,Inc.,
35,
Proof,of,Concept,Demo,
Copyright,2016,Trend,Micro,Inc.,
36,
Creden:al,Management,
•  19%,of,iden:ﬁed,vulnerabili:es,
•  Common,vulnerability,types,
–  Use,of,Hard'coded,Creden:als,
–  Storing,Passwords,in,a,Recoverable,
Format,
–  Insuﬃciently,Protected,Creden:als,
•  Zero,Day,Ini:a:ve,case,study,
–  GE,MDS,PulseNET,Hidden,Support,Account,
Remote,Code,Execu:on,Vulnerability,
,
Copyright,2016,Trend,Micro,Inc.,
37,
,
GE,MDS,PulseNET,Case,Study,
•  ICS'CERT,states:,
–  “The,aﬀected,products,contain,a,hard'coded,support,account,with,
full,privileges.”,
•  Iden:ﬁers,
–  CVE'2015'6456,
–  ZDI'15'440,
–  ICSA'15'258'03,
•  CVSS,
–  9.0,
•  Disclosure,Timeline,,
–  2015–05–14,',Reported,to,vendor,,
2015–09–16,–,Coordinated,release,
•  Credit,
–  Discovered,by:,Andrea,Micalizzi,(rgod),
Disclosed,by:,Zero,Day,Ini:a:ve,
Copyright,2016,Trend,Micro,Inc.,
38,
User,Management,Panel,
Copyright,2016,Trend,Micro,Inc.,
39,
Actual,User,Database,
Copyright,2016,Trend,Micro,Inc.,
40,
Undocumented,ge_support,Account,
•  Exists,in,the,sec_user,table)by)default)
•  Password,for,this,account:,
–  <![HDATA[MD5$8af7e0cd2c76d2faa98b71f8ca7923f9,
–  “Pu1seNET”,
•  Account,oﬀers,full,privileges,
Copyright,2016,Trend,Micro,Inc.,
41,
Exploita:on,Demo,
Copyright,2016,Trend,Micro,Inc.,
42,
Memory,Corrup:on,
•  20%,of,iden:ﬁed,vulnerabili:es,
•  Common,vulnerability,types,
–  Stack'based,Buﬀer,Overﬂow,
–  Heap'based,Buﬀer,Overﬂow,
–  Out'of'bounds,Read/Write,
•  Zero,Day,Ini:a:ve,case,study,
–  Advantech,WebAccess,webvrpcs,Service,
BwOpcSvc.dll,WindowName,,
sprin~,Stack'Based,Buﬀer,Overﬂow,
Remote,Code,Execu:on,Vulnerability,
Copyright,2016,Trend,Micro,Inc.,
43,
,
Advantech,WebAccess,Case,Study,
•  ICS'CERT,states:,
–  “There,are,many,instances,where,the,buﬀer,on,the,stack,can,be,
overwriken”,
•  Iden:ﬁers,
–  CVE'2016'0856,
–  ZDI'16'048,
–  ICSA'16'014'01,
•  CVSS,
–  9.3,
•  Disclosure,Timeline,,
–  2015–09–17,',Reported,to,vendor,,
2016–02–05,–,Coordinated,release,
•  Credit,
–  Discovered,by:,Anonymous,
–  Disclosed,by:,Zero,Day,Ini:a:ve,
Copyright,2016,Trend,Micro,Inc.,
44,
,
Advantech,WebAccess,HMI,Solu:on,
Copyright,2016,Trend,Micro,Inc.,
45,
Remotely,Accessible,Services,,
•  Launches,a,service,,webvrpcs.exe,,in,the,context,of,a,local,
administra:ve,users,
•  Services,listens,on,TCP,port,4592,,by,default,,and,may,be,
accessed,over,an,RPC'based,protocol,
•  Applica:on,interface,is,structured,to,resemble,the,Windows,
Device,IoControl,func:on,
–  Each,func:on,contains,a,ﬁeld,similar,to,an,IOCTL,
Copyright,2016,Trend,Micro,Inc.,
46,
Prototype,of,RPC,func:on,
Copyright,2016,Trend,Micro,Inc.,
47,
IOCTL,0x0001388B,
•  Inside,BwOpcSvc.dll,(which,is,loaded,into,webvrpc.exe),,
rou:ne,with,an,exported,entry,name,of,BwSvcFunc:on,
which,processes,a,number,of,entry,points,,using,a,jump,
table.,
•  Flaw,exists,within,the,implementa:on,of,IOCTL,0x0001388B,,
•  Stack'based,buﬀer,overﬂow,exists,in,a,call,to,sprin~,using,
WindowsName,parameter,
Copyright,2016,Trend,Micro,Inc.,
48,
Vulnerable,Code,
Copyright,2016,Trend,Micro,Inc.,
49,
Stack,Layout,
Copyright,2016,Trend,Micro,Inc.,
50,
Applica:on,Crash,
Copyright,2016,Trend,Micro,Inc.,
51,
Exploita:on,Demo,
Copyright,2016,Trend,Micro,Inc.,
52,
Patch,Analysis,
•  _sprin~,is,in,the,list,of,MicrosoT,banned,APIs,list,
–  First,published,in,2007,
–  hkps://msdn.microsoT.com/en'us/library/bb288454.aspx,,,,
•  Advantech,should,implement,MicrosoT,banned,APIs,and,
remove,all,of,them,from,shipping,code,
•  What,did,they,do…,
Copyright,2016,Trend,Micro,Inc.,
53,
Patch,Analysis,
•  WindowName,ﬁeld,in,the,stack,buﬀer,is,0x80,bytes,
•  _snprin~,Length,parameter,is,0x7f,bytes,
Copyright,2016,Trend,Micro,Inc.,
54,
Variant,Analysis,
1. 
ZDI'16'049,',Advantech,WebAccess,webvrpcs,Service,BwOpcSvc.dll,WindowName,sprin~,Stack'Based,Buﬀer,Overﬂow,Remote,Code,Execu:on,Vulnerability,
2. 
ZDI'16'050,',Advantech,WebAccess,webvrpcs,Service,BwOpcSvc.dll,WindowName,sprin~,Stack'Based,Buﬀer,Overﬂow,Remote,Code,Execu:on,Vulnerability,
3. 
ZDI'16'051,',Advantech,WebAccess,webvrpcs,Service,BwOpcSvc.dll,WindowName,sprin~,Stack'Based,Buﬀer,Overﬂow,Remote,Code,Execu:on,Vulnerability,
4. 
ZDI'16'052,',Advantech,WebAccess,webvrpcs,Service,BwOpcSvc.dll,sprin~,Uncontrolled,Format,String,Remote,Code,Execu:on,Vulnerability,
5. 
ZDI'16'053,',Advantech,WebAccess,webvrpcs,Service,BwBASScdDl.dll,TargetHost,strcpy,Stack'Based,Buﬀer,Overﬂow,Remote,Code,Execu:on,Vulnerability,
6. 
ZDI'16'054,',Advantech,WebAccess,webvrpcs,Service,WaDBS.dll,TagName,strcpy,Stack'Based,Buﬀer,Overﬂow,Remote,Code,Execu:on,Vulnerability,
7. 
ZDI'16'055,',Advantech,WebAccess,webvrpcs,Service,BwpAlarm.dll,sprin~,Stack'Based,Buﬀer,Overﬂow,Remote,Code,Execu:on,Vulnerability,
8. 
ZDI'16'056,',Advantech,WebAccess,webvrpcs,Service,BwpAlarm.dll,sprin~,Stack'Based,Buﬀer,Overﬂow,Remote,Code,Execu:on,Vulnerability,
9. 
ZDI'16'057,',Advantech,WebAccess,webvrpcs,Service,BwpAlarm.dll,ProjectName,strcpy,Stack'Based,Buﬀer,Overﬂow,Remote,Code,Execu:on,Vulnerability,
10. 
ZDI'16'058,',Advantech,WebAccess,webvrpcs,Service,BwpAlarm.dll,ProjectName,strcpy,Globals,Overﬂow,Remote,Code,Execu:on,Vulnerability,
11. 
ZDI'16'059,',Advantech,WebAccess,webvrpcs,Service,BwpAlarm.dll,ProjectName,strcat,Stack'Based,Buﬀer,Overﬂow,Remote,Code,Execu:on,Vulnerability,
12. 
ZDI'16'060,',Advantech,WebAccess,webvrpcs,Service,BwpAlarm.dll,HostName/ProjectName/NodeName,strcpy,Stack'Based,Buﬀer,Overﬂow,Remote,Code,Execu:on,Vulnerability,
13. 
ZDI'16'061,',Advantech,WebAccess,webvrpcs,Service,BwpAlarm.dll,sprin~,Stack'Based,Buﬀer,Overﬂow,Remote,Code,Execu:on,Vulnerability,
14. 
ZDI'16'062,',Advantech,WebAccess,webvrpcs,Service,BwpAlarm.dll,ProjectName/NodeName,sprin~,Stack'Based,Buﬀer,Overﬂow,Remote,Code,Execu:on,Vulnerability,
15. 
ZDI'16'063,',Advantech,WebAccess,webvrpcs,Service,BwpAlarm.dll,strcpy,Stack'Based,Buﬀer,Overﬂow,Remote,Code,Execu:on,Vulnerability,
16. 
ZDI'16'064,',Advantech,WebAccess,webvrpcs,Service,BwpAlarm.dll,strcpy,Heap'Based,Buﬀer,Overﬂow,Remote,Code,Execu:on,Vulnerability,
17. 
ZDI'16'065,',Advantech,WebAccess,webvrpcs,Service,BwpAlarm.dll,strcpy,Heap'Based,Buﬀer,Overﬂow,Remote,Code,Execu:on,Vulnerability,
18. 
ZDI'16'066,',Advantech,WebAccess,webvrpcs,Service,BwpAlarm.dll,strcpy,Heap'Based,Buﬀer,Overﬂow,Remote,Code,Execu:on,Vulnerability,
19. 
ZDI'16'067,',Advantech,WebAccess,webvrpcs,Service,BwpAlarm.dll,Backup,RPC,Hostname,strcpy,Heap'Based,Buﬀer,Overﬂow,Remote,Code,Execu:on,Vulnerability,
20. 