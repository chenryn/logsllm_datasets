§  Limited	
  by	
  web-­‐server	
  (apache)	
#	
  set	
  response	
  code	
Header($_server[“SERVER_PROTOCOL”].	
  ”	
  $status_code”);	
§  Teseng	
  browsers	
  automaecally	
§  Created	
  PHP	
  ﬁle	
  to	
  set	
  status	
  code	
§  -­‐	
  h]p://c22.cc/POC/respcode.php?code=XXX	
BROWSERS	
…	
  AND	
  THEIR	
  STATUS	
  CODE	
  HABITS	
#3.2	
Miss 
Browsers	
  handle	
most	
  things	
  just	
  like	
they	
  handle	
  a	
200	
  OK?	
YEP…	
MOSTLY	
§  HTML	
  Responses	
§ 
Almost	
  all	
  response	
  codes	
  are	
  rendered	
by	
  the	
  browser	
  correctly	
§  iFrames	
§ 
Some	
  special	
  cases	
  for	
  IE,	
  but	
  other	
browsers	
  handle	
  this	
  the	
  same	
  as	
  HTML	
§  JavaScript/CSS	
§ 
Limited	
  accepted	
  status	
  codes	
§ 
Limited	
  3XX	
  support	
§ 
Chrome	
  is	
  the	
  excepeon	
  here	
§ 
No	
  support	
  for	
  4XX/5XX	
  codes	
So	
  we	
  know	
what	
  browsers	
interpret	
diﬀerently	
What	
  do	
browsers	
  have	
in	
  common?	
§  1XX	
  code	
  handling	
§  Retries	
§  Confusion	
§  Chrome	
  /	
  IE6	
  try	
  to	
  download	
  the	
  page!	
§  Fun	
  on	
  Android…	
  (never	
  ending	
  download)	
§  Timeouts	
§  Eventually	
§  204	
  No	
  Content	
§  Um,	
  no	
  content!	
§  304	
  Not	
  Modiﬁed	
§  Again,	
  no	
  content	
  returned	
WHAT	
  ABOUT	
HEADERS?	
#3.3	
Just	
  because	
  the	
  RFC	
  says	
a	
  speciﬁc	
  status	
  code	
must	
  have	
  an	
  associated	
header…	
…doesn’t	
  mean	
it	
  HAS	
  to	
§  Redireceon	
  codes	
  (301-­‐304,	
  307)	
§ 
No	
  Locaeon	
  header,	
  no	
  redirect	
§  401	
  Unauthorized	
§ 
No	
  WWW-­‐Authenecate	
  header,	
  no	
authenecaeon	
  prompt	
§  407	
  Proxy	
  Authenecaeon	
  Required	
§ 
No	
  Proxy-­‐Authenecate	
  header,	
  no	
  prompt	
Just	
  because	
  the	
  RFC	
  says	
a	
  speciﬁc	
  status	
  code	
shouldn’t	
  have	
  an	
associated	
  header…	
…doesn’t	
  mean	
it	
  can’t	
§  300	
  Muleple	
  Choices	
  w/	
  Locaeon	
  Header	
§  Firefox	
  /	
  IE6	
  follows	
  the	
  redirect	
§ 
Chrome	
  doesn’t	
§  More	
  research	
  needed	
  in	
  this	
  direceon	
§ 
Most	
  are	
  unintereseng	
EACH	
  BROWSER	
HANDLES	
  THINGS	
  A	
LITTLE	
  DIFFERENTLY	
I	
  WONDER	
  WHAT	
WE	
  CAN	
  DO	
WITH	
  THAT!	
#4	
]	
[	
  GOALS 
§  Each	
  browser	
  handles	
  things	
  diﬀerently	
§ 
Use	
  known	
  condieons	
§ 
Handled	
  codes	
§ 
Unhandled	
  codes	
§ 
Browser	
  weirdness	
BROWSER	
FINGERPRINTING	
#4.1	
§ 
Doesn’t	
  load	
  JavaScript	
  returned	
  with	
  a	
  300	
‘Muleple	
  Choices’	
  status	
  code	
§ 
Other	
  browsers	
  tested	
  DO	
  (IE/Chrome)	
§ 
Request	
  JavaScript	
  from	
  server	
§ 
Response	
  Status:	
  300	
  Muleple	
  Choices	
§ 
If	
  JavaScript	
  doesn’t	
  run	
  in	
  the	
  browser	
§ 
Firefox	
Firefox	
§ 
Loads	
  JavaScript	
  returned	
  with	
  a	
  307	
‘Temporary	
  Redirect’	
  status	
  code	
§ 
Other	
  browsers	
  tested	
  DON’T	
  (IE/FF)	
§ 
Request	
  JavaScript	
  from	
  server	
§ 
Response	
  Status:	
  307	
  Temporary	
  Redirect	
§ 
If	
  JavaScript	
  runs	
  in	
  the	
  browser	
§ 
Chrome	
Chrome	
§ 
Loads	
  JavaScript	
  returned	
  with	
  a	
  205	
  ‘Reset	
Content’	
  status	
  code	
§ 
Other	
  browsers	
  tested	
  DON’T	
  (FF/Chrome)	
§ 
Request	
  JavaScript	
  from	
  server	
§ 
Response	
  Status:	
  205	
  Reset	
  Content	
§ 
If	
  JavaScript	
  runs	
  in	
  the	
  browser	
§ 
Internet	
  Explorer	
Internet	
  Explorer 	
§  Other	
  opeons	
  to	
  ﬁngerprint	
  browsers	
§ 
300	
  Redirect	
  (Chrome)	
§ 
305	
  /	
  306	
  JavaScript	
  (Firefox)	
§ 
400	
  iFrame	
  (Internet	
  Explorer)	
§ 
…	
BROWSER	
FINGERPRINTING	
DEMO	
USER-­‐AGENTS	
CAN	
  BE	
SPOOFED	
BROWSER	
TRAITS	
  CAN’T	
PROXY	
DETECTION	
#4.2	
§ 
Chrome	
  handles	
  proxy	
  conﬁguraeon	
diﬀerently	
  to	
  other	
  browsers	
§ 
407	
  status	
  code	
  isn’t	
  rendered	
§ 
Unless	
  an	
  HTTP	
  proxy	
  is	
  set!	
§ 
Allows	
  us	
  to	
  detect	
  if	
  an	
  HTTP	
  proxy	
  is	
  set	
§ 
Just	
  not	
  which	
  proxy	
§ 
Can	
  only	
  detect	
  HTTP	
  proxies	
  ;(	
Chrome	
  Proxy	
  Deteceon	
§  Request	
  page	
  from	
  server	
§  Response	
  Status:	
  407	
  Proxy	
  Authenecaeon	
§  w/o	
  Proxy-­‐Authenecate	
  header	
§  If	
  Chrome	
  responds	
  HTTP	
  proxy	
  is	
  set	
Chrome	
  Proxy	
  Deteceon	
§  Privoxy	
  3.0.20	
  (CVE-­‐2013-­‐2503)	
§  407	
  Proxy	
  Authenecaeon	
  Required	
§  w/	
  Proxy-­‐Authenecate	
  header	
§  User	
  prompted	
  for	
  user/pass	
§  Prompt	
  appears	
  to	
  be	
  from	
  Privoxy	
§  Privoxy	
  passes	
  user/pass	
  to	
  remote	
  site	
§  Proﬁt???	
Side-­‐Eﬀect:	
  Owning	
  Proxies	
§  Not	
  just	
  Privoxy	
  that’s	
  eﬀected	
§ 
Any	
  transparent	
  proxy	
§ 
e.g.	
  Burp,	
  ZAP,	
  …	
§ 
Not	
  really	
  a	
  vuln	
  for	
  most	
§ 
Works	
  as	
  designed!	
Side-­‐Eﬀect:	
  Owning	
  Proxies	
#5	
]	
[	
BRINGINGITALL 
TO GETHER 
What	
  we	
  have	
§  Status	
  codes	
  all	
  browsers	
  treat	
  as	
  content	
§  Status	
  codes	
  all	
  browsers	
  can’t	
  handle	
§  1XX,	
  etc..	
§  Lots	
  of	
  browser	
  quirks	
What	
  can	
  we	
  do	
§  F*ck	
  with	
  things	
§  Screw	
  with	
  scanner	
  monkeys	
§  Make	
  RFC	
  lovers	
  cry	
  into	
  their	
  beer	
§  Break	
  things	
  in	
  general	
Let’s	
  try	
  to…	
§  Use	
  what	
  we’ve	
  discovered	
  to…	
§  Break	
  spidering	
  tools	
§  Cause	
  false	
  posieves	
  /	
  negaeves	
§  Slow	
  down	
  a]ackers	
§  The	
  fun	
  way!	
§  Blocking	
  successful	
  exploitaeon	
BREAKING	
SPIDERS	
#5.1	
Simplisec	
  view	
of	
  spiders	
§  Access	
  target	
  URL	
§  Read	
  links	
  /	
  funceons	
§  Test	
  them	
  out	
§  If	
  true:	
  conenue	
§  What	
  is	
  TRUE?	
§  What	
  happens	
  if:	
§  Every	
  response	
  is	
§  200	
§  404	
§  500	
200	
  OK	
§  IF	
  200	
  ==	
  True:	
§  Problems!	
§  Never-­‐ending	
  spider	
404	
  Not	
  Found	
§  IF	
  404	
  ==	
  False:	
§  What	
  website?	
500	
  Internal	
  Server	
  Error	
§  Skipﬁsh	
  !=	
  happy	
  ﬁsh	
False	
Posieves	
  /
Negaeves	
#5.2	
§  Most	
  scanners	
  use	
  status	
  codes	
§  At	
  least	
  to	
  some	
  extent	
§  Inieal	
  match	
  (prior	
  to	
  more	
  costly	
  regex)	
§  Speed	
  up	
  deteceon	
§  Easy	
  solueon	
§  What	
  happens	
  if:	
§  Every	
  response	
  is	
§  200	
§  404	
§  500	
§  raNd0M*	
*	
  Using	
  codes	
  that	
  are	
  accepted	
  by	
  all	
  browsers	
  as	
  content	
Vulnerability	
  Baseline	
§  w3af	
§  Informaeon	
  Points	
  à	
  79	
§  Vulnerabiliees	
  à	