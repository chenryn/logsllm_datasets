洞。而本节将介绍开源技术的安全漏洞扫描方法。实验环境为OSSIM4.1系统。
的案例中体现得淋漓尽致，大多数是管理员疏忽，被动地等待攻击者入侵，从而发现系统漏
例，获取部分shellcode代码如图14-100所示。
将得到的源码展现在Web界面中。它还能绘制出 shellcode代码执行的流程图。我们看个实
用Perl 将获取的 shellcode 写入一个二进制文件，然后再利用反汇编工具进行反汇编，最后
构在Debian系统之上，其中包含了Perl和一些反汇编、反编译的工具，所以OSSIM系统利
14.14OSSIM在漏洞扫描中的应用
扫描、渗透、提权和执行 shellcode 等这些攻击都和漏洞密切相关，这一点在前面介绍
●装载运行指令的过程，总共有多少指令。
OSSIM系统对截获shellcode也会产生误报，对这种误报的代码无法进行流程分析。)
●读入指令块后，观看静态代码的同时了解程序动态执行的流程。
●在这个界面下绘制出刚刚执行过的指令块及其调用关系。
图14-100能显示以下信息：
OSSIM中有个重要功能，它可以分析shellcode代码，我们知道OSSIM系统其实就是架
注意：
注意：
这时，可以选中某个shellcode日志报警查看详情。
i
保
0x0041723475F9
00
88
00
0000000
99
050
0
0
00000
05
166666
图14-100绘制 shellcode 代码执行流程图
090000090
0x004172233CO0
C00000800000000
0
666
8800
0
0000
8
00
iodsbh
666
66
82
00
050
000900090
00
00
0002000000000000009
xor6ox.0ox
第14章OSSIM综合应用429
：
LINEO
n·000417269
---
## Page 453
都能在里面查询到。
产品的漏洞。因此我们可以形象地将CVE 比喻成一本巨大的漏洞字典，绝大多数漏洞信息
识，使得用户和厂商对漏洞有统一的认识，从而更加快速而有效地去鉴别、发现和修复软件
库之一，也是目前在国际上最具公信力的安全弱点披露单位，其使命是对漏洞进行统一标
称DHS）建立的，由非盈利组织MITRE公司管理和维护。CVE是国际上著名的漏洞知识
本就不知道。
这些开放的脆弱性数据库，还存在大量的没有对公众开放的脆弱性数据库，有的可能大家根
的系统脆弱性数据库网络安全工作就显得极为重要。但是CVE并没有囊括所有漏洞，除了
CVE和XForce。当网络出现安全事故，入侵检测系统(IDS)产生警报时，像CVE这类标准
Nessus 工具或者 eEyeDigital Security 的 Retina工具，开源的有 OpenVAS 等。
序。当信息收集工作和列举工作完成后，现在可以在目标系统上检测漏洞了。
什么端口。端口在漏洞评估中扮演了一个很关键的角色，因为它确保将漏洞对应到各应用程
1024个）被称为熟知端口。仍然使用Nmap，我们用它的-sV 选项来确定什么应用程序位于
的过程。在确定操作系统后，下一步就是确定运行于主机上的应用程序。端口0~1023（共
应用程序。
信息后，收集/发现的工作就完成了。接着进行枚举并确定目标主机运行了什么操作系统和
进行查询。
的漏洞进行评估。实施漏洞评估的步骤为：信息收集/发现、枚举和检测。cd邓势
允许通信的通道，那么防火墙就没有帮助了。这时我们该做些什么呢？我们需要对现有设备
火墙可以阻止一些威胁，尤其是目前的高档防火墙集成了很多功能，但是如果威胁来自一个
速率不同的网络线路连接起来，我们在短期间内根本无法获得漏洞评估结果。另一方面，防
那样是起不了多大作用的。因为现在的企业拥有成千上万台主机，这些主机和服务器又通过
14.14.1漏洞评估方法
430UNIX/Linux网络日志分析与流量监控
14.14.2漏洞库
性。
我们可使用Nmap软件，通过它能够很快确定网络上哪些主机是在线的。一旦确定主机
在企业网络中查找漏洞需要付出很大的努力，不能简单地在主机上安装漏洞扫描软件，
1.CVE
，目前许多欧美的国际安全组织都按照自己的分类准则建立了漏洞数据库，主流的有
CVE（CommonVulnerabilities and Exposures，通用漏洞披露）是由美国国土安全局（简
为了检测漏洞，我们需要使用一个漏洞评估工具。商业的有TenableNetwork Security的
检测用来确定一个系统或应用程序是否易受攻击。检测过程只是报告漏洞出现的可能
枚举是用来判断目标系统运行的操作系统，获取操作系统指纹和位于目标上的应用程序
3.检测
2.枚举
包括为查找目标域名而进行的whois查询，我们可通过www.arin.net 对可能的目标地址
1.信息收集/发现
---
## Page 454
包含着相关工具的网络扫描器。其核心部件是一个服务器，包括一套网络漏洞测试程序，
14.14.3采用OpenVAS扫描
据，它的准确性和公正性无庸置疑。
的招数。OSSIM 系统漏洞扫描模块综合了 CVE+OSVDB+BugTraq 这三个权威组织提供的数
因为这里可以抢先获得关于软件、系统漏洞和缺陷的信息，还可以学到修补漏洞和防御反击
在网络安全领域，BugTraq 相当于最权威的专业杂志。大多数安全技术人员订阅Bugtraq，
称
典，而 OSVDB 为每一条脆弱性提供了详尽的信息，不过，OSVDB 也需要参考 CVE 的名
的。它由安全事业爱好者来维护。两者的差异在于CVE提供标准名称，可以理解为数据与
个独立于开发商的脆弱性数据库实现方案。和CVE一样OSVDB 数据库也是开源并且免费
据库。它最早是在2002 年的 BlackHat和Defcon 安全会议上提出的一项服务。它提供了
可以免费阅读和下载。
个委员会的成员来自美国许多著名的安全组织、软件开发商、大学研究机构等，而且CVE
1161”的条目表示2004年第1161号脆弱性。如图14-101所示。
OSSIM系统通过OpenVAS 来进行漏洞扫描，它是一个开放式漏洞评估系统，还是一个
BugTraq 是由SecurityFocus管理的Internet 邮件列表，现在已被赛门铁克公司收购
3.OSVDB
CVE数据库在目前互联网上是最权威的，它的内容是CVE编辑委员会合作的成果。这
CVE 的标准命名方式是由“CVE”、时间和编号共同组成。例如，命名为“CVE-2004-
4.BugTraq
2.CVE标准命名A
0000000
000000
StartDate
AI
2012-0
2012-08-2410:36:16Gainashelremotely-Check forthemoteOpenSHversion
Defined On
Lrem
图14-101列出漏洞库信息
otelv
ChecksforhreeHve
Searchresults for this criteria
SOLLH
CVEId
Aeu
第14章
OSSIM综合应用431
RiskFactor
CVE-2004-1162
CVEId
40
---
## Page 455
14.14.4分布式漏洞扫描
用，漏洞扫描库是否准备好，Nmap 是否可用这几个参数，如图14-103所示。
系统提供了非常详细的计划任务列表。
就要选择相应网段中的传感器，然后选择扫描方式选项，包括立即执行，每天/每周执行。
扫描时间可以选择网段中某几台主机分批扫描，每次最好不要超过25台主机或网络设备。
的扫描任务，如图14-102所示。
正常，两者缺一不可。
件。需要注意的是确保传感器可用，也就是要处于启动状态，而且系统中Nmap 进程要运行
以检测远程系统和应用程序中的安全问题，接下来介绍一下OpenVAS的使用方法。
432UNIX/Linux网络日志分析与流量监控
首先将OSSIM系统升级，这一工作建议在系统刚架设完毕就做，然后升级OpenVAS插
（2）从上到下依次输入任务名称，例如“Serverl”，选择关联引擎，如果是分布式系统
OSSIM 系统中的漏洞扫描系统（OpenVAS,Nessus 等）采用集中控制式，它由中心控制
（3）最后，确保满足以下要求：扫描检查结果包含目标IP和主机名，传感器是否启
（1）选择Anaylysis→Vulnerabilities，然后单击“new scan job”按钮，开始创建一个新
图中显示了用OpenVAS开始对192.168.0.0/16这个网段进行扫描。实际工作中为了节约
操作步骤如下：
Target
TargetAll
号
司
192.168.120.169 alewvau
192.168.120.169[ali
图14-102扫描网段
图14-103
Hour23]
口
Create ScanJob
Every[da）
Senaor AlowedValn ScannerNmap ScanLoad
nection
Minutes4
日2AVO果
168
0.0/16)
nT81
aTgua
---
## Page 456
到扫描结果，如图14-106所示。
式扫描拓扑如图14-104所示。
将扫描的压力分摊到各个探测器上。在 Web 界面上也能同时看到两个 Sensor 的存在。分布
行漏洞扫描，然后将扫描结果汇总到主服务器端，进行分析并集中存储扫描结果。这样可以
连接服务器。
较多时服务器端会成为瓶颈，从而导致整个系统性能下降，严重时远程控制端无法通过Web
节点或服务器负责进行漏洞扫描并存放结果，这种方式最严重的缺点就是当扫描的目标主机
当扫描结束后，可以在 OSSIM 系统首页控制面板和 Analysis→Vulnerabilities 菜单中看
在扫描前要选择扫描器，在 Deployment→Main 高级选项中的 Vulnerability
如果有多个网段，大量主机需要漏洞扫描时，应分别在每个监控网段部署一个探测器进
注意：
Lan-
rBina
图14-105选择OpenVAS 版本
aryloc
hos
Logi
图14-104分布式扫描拓扑
应用务器
Yes
1
黛蕴量第14章OSSIM综合应用433
-nvt-
Ossim深测器
Scanner
---
## Page 457
所示。
的服务。深红色的区域表示高危主机，有严重的漏洞，需要管理员立即处理。如图14-107
434UNIX/Linux网络日志分析与流量监控
正器
图中列出了自动生成的漏洞分布饼图，它显示出当前被扫描主机的安全等级和有漏洞
Sadrn
Situationat Awareness
Assets
tnidents
Deployment
Intelligence
Dashboards
Profle:
Scan
Vewfalse
timie
Cog:
positives
gTCP:er
Host-000c4d0e2aa
2013-05-1409:33.27
lostname
2012-12-2309:36:47
2013-05-14093:27
By SeverityBy Services-Top 10
2013-05-1409:34:43
Vuln Name
Date/Time
SeousH
图14-106查看扫描结果
-Trueresut-Falseposit
Job Name
图14-107扫描结果
testz
new-2
New
abilities
back...Host-000c438b4obe
Host-000c9e6b2744
Medm
DtemeJo Name HotNeFind
4d0e2aa
Targets