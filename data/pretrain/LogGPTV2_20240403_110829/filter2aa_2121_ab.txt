Event 
Logger
LSA
Service
lsasrv.dll
SAM 
Service
samsrv.dll
Local Security Subsystem (LSASS)
MSV1_0.dll
LSA 
Policy
RPC
Credential Management
WINLOGON
A U T H E N T I C A T I O N 
R 4 W S E C . C O M
 @r4wd3r
S U B O R N E R
SAM
Security 
Log
Executive
User mode
Kernel mode
Security Reference Monitor (SRM)
ALPC
Event 
Logger
LSA
Service
lsasrv.dll
SAM 
Service
samsrv.dll
Local Security Subsystem (LSASS)
MSV1_0.dll
LSA 
Policy
Credential Management
WINLOGON
A U T H E N T I C A T I O N 
LOGON SID
R 4 W S E C . C O M
 @r4wd3r
S U B O R N E R
SAM
Security 
Log
Executive
User mode
Kernel mode
Security Reference Monitor (SRM)
ALPC
Event 
Logger
LSA
Service
lsasrv.dll
SAM 
Service
samsrv.dll
Local Security Subsystem (LSASS)
MSV1_0.dll
LSA 
Policy
Credential Management
WINLOGON
A U T H E N T I C A T I O N 
LOGON SID
LsaLogonUser
R 4 W S E C . C O M
 @r4wd3r
S U B O R N E R
SAM
Security 
Log
Executive
User mode
Kernel mode
Security Reference Monitor (SRM)
ALPC
Event 
Logger
LSA
Service
lsasrv.dll
SAM 
Service
samsrv.dll
Local Security Subsystem (LSASS)
MSV1_0.dll
LSA 
Policy
Credential Management
WINLOGON
A U T H E N T I C A T I O N 
LOGON SID
R 4 W S E C . C O M
 @r4wd3r
S U B O R N E R
SAM
Security 
Log
Executive
User mode
Kernel mode
Security Reference Monitor (SRM)
ALPC
Event 
Logger
LSA
Service
lsasrv.dll
SAM 
Service
samsrv.dll
Local Security Subsystem (LSASS)
MSV1_0.dll
LSA 
Policy
Credential Management
WINLOGON
A U T H E N T I C A T I O N 
LOGON SID
R 4 W S E C . C O M
 @r4wd3r
S U B O R N E R
SAM
Security 
Log
Executive
User mode
Kernel mode
Security Reference Monitor (SRM)
ALPC
Event 
Logger
LSA
Service
lsasrv.dll
SAM 
Service
samsrv.dll
Local Security Subsystem (LSASS)
MSV1_0.dll
LSA 
Policy
Credential Management
WINLOGON
A U T H E N T I C A T I O N 
LOGON SID
R 4 W S E C . C O M
 @r4wd3r
S U B O R N E R
SAM
Security 
Log
Executive
User mode
Kernel mode
Security Reference Monitor (SRM)
ALPC
Event 
Logger
LSA
Service
lsasrv.dll
SAM 
Service
samsrv.dll
Local Security Subsystem (LSASS)
MSV1_0.dll
LSA 
Policy
Credential Management
WINLOGON
A U T H O R I Z A T I O N
LOGON SID
LUID
R 4 W S E C . C O M
 @r4wd3r
S U B O R N E R
SAM
Security 
Log
Executive
User mode
Kernel mode
Security Reference Monitor (SRM)
ALPC
Event 
Logger
SAM 
Service
samsrv.dll
Local Security Subsystem (LSASS)
MSV1_0.dll
LSA 
Policy
Credential Management
WINLOGON
A U T H O R I Z A T I O N
LOGON SID
LUID
LSA
Service
lsasrv.dll
R 4 W S E C . C O M
 @r4wd3r
S U B O R N E R
LSA
Service
lsasrv.dll
SAM
Security 
Log
Executive
User mode
Kernel mode
Security Reference Monitor (SRM)
ALPC
Event 
Logger
SAM 
Service
samsrv.dll
Local Security Subsystem (LSASS)
MSV1_0.dll
LSA 
Policy
Credential Management
WINLOGON
A U T H O R I Z A T I O N
LOGON SID
LUID
R 4 W S E C . C O M
 @r4wd3r
S U B O R N E R
LSA
Service
lsasrv.dll
SAM
Security 
Log
Executive
User mode
Kernel mode
Security Reference Monitor (SRM)
ALPC
Event 
Logger
SAM 
Service
samsrv.dll
Local Security Subsystem (LSASS)
MSV1_0.dll
LSA 
Policy
Credential Management
WINLOGON
S U C C E S S !
R 4 W S E C . C O M
 @r4wd3r
S U B O R N E R
G O A L S
∙ Understand authentication/authorization for local accounts
∙ Create a local account writing directly to the SAM
∙ Make it invisible!
R 4 W S E C . C O M
 @r4wd3r
S U B O R N E R
W H A T    I S    T H E    M I N I M U M ?
Username
Password
Permissions
R 4 W S E C . C O M
 @r4wd3r
S U B O R N E R
B U T    W H E R E ?
R 4 W S E C . C O M
 @r4wd3r
S U B O R N E R
T R A V E L    B A C K    T O    T I M E
R 4 W S E C . C O M
 @r4wd3r
S U B O R N E R
T R A V E L    B A C K    T O    T I M E
R 4 W S E C . C O M
 @r4wd3r
S U B O R N E R
V ?
00
01
02
03
04
05
06
07
0000 00
00
00
00
f4
00
00
00
0008 03
00
01
00
f4
00
00
00
0010 12
00
00
00
00
00
00
00
0018 08
01
00
00
12
00
00
00
0020 00
00
00
00
1c
01
00
00
0028 16
00
00
00
00
00
00
00
0030 34
01
00
00
00
00
00
00
0038 00
00
00
00
34
01
00
00
0040 00
00
00
00
00
00
00
00
0048 34
01
00
00
00
00
00
00
0050 00
00
00
00
34
01
00
00
0058 00
00
00
00
00
00
00
00
0060 34
01
00
00
00
00
00
00
0068 00
00
00
00
34
01
00
00
0070 00
00
00
00
00
00
00
00
0078 34
01
00
00
00
00
00
00
0080 00
00
00
00
34
01
00
00
0088 00
00
00
00
00
00
00
00
0090 34
01
00
00
08
00
00
00
0098 01
00
00
00
3c
01
00
00
00A0 18
00
00
00
00
00
00
00
00A8 54
01
00
00
38
00
00
00
00B0 00
00
00
00
8c
01
00
00
00B8 18
00
00
00
00
00
00
00
00C0 a4
01
00
00
18
00
00
00
00C8 00
00
00
00
01
00
14
80
.
.
.
01B0 01
02
00
00
00
00
00
05
01B8 20
00
00
00
20
02
00
00
01C0 73
00
75
00
62
00
6f
00
01C8 72
00
6e
00
65
00
72
00
01D0 24
00
00
00
73
00
75
00
01D8 62
00
6f
00
72
00
6e
00
01E0 65
00
72
00
24
00
b1
e7
01E8 44
00
45
00
53
00
43
00
01F0 52
00
49
00
50
00
54
00
01F8 49
00
4f
00
4e
00
87
f9
0200 01
02
00
00
07
00
00
00
0208 02
00
02
00
00
00
00
00
0210 9d
c3
60
5f
3b
ab
d7
00
0218 9d
c0
96
0e
68
d9
ef
70
0220 02
00
02
00
10
00
00
00
0228 ba
6f
a0
e7
a9
6b
70
36
0230 b6
fb
9b
05
4e
cd
09
c2
0238 4f
60
37
1b
5d
b1
2b
2b
0240 c4
53
61
53
88
36
fc
01
0248 0c
29
a5
7c
18
83
f9
6f
0250 50
0e
16
fb
7c
8b
9d
22
0258 02
00
02
00
00
00
00
00
0260 4c
b3
84
ca
78
54
8c
be
0268 62
33
20
5c
1a
eb
66
37
0270 02
00
02
00
00
00
00
00
0278 d5
fa
d4
73
25
7f
00
b4
0280 59
ae
c2
57
0c