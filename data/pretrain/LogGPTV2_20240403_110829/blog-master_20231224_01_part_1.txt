## PostgreSQL pg_idkit: å„ç§ UUID ç”Ÿæˆæ–¹æ³•å‡½æ•°å¤§é›†åˆ                
### ä½œè€…                                                                  
digoal                                                                  
### æ—¥æœŸ                                                                  
2023-12-24                                                              
### æ ‡ç­¾                                                                  
PostgreSQL , PolarDB , DuckDB , pg_idkit , uuid , é›†åˆ                                 
----                                                                  
## èƒŒæ™¯     
pg_idkitæ˜¯rustå†™çš„ä¸€ä¸ªPostgreSQL UUIDç”Ÿæˆæ–¹æ³•å‡½æ•°å¤§é›†åˆæ’ä»¶.    
https://github.com/VADOSWARE/pg_idkit    
åŽæœŸå°†é›†æˆåˆ°å®‡å®™æœ€å¼ºPostgreSQLå­¦ä¹ é•œåƒä¸­.     
[ã€Š2023-PostgreSQL/DuckDB/MySQL/PolarDB-X Dockeré•œåƒå­¦ä¹ çŽ¯å¢ƒ ARM64ç‰ˆ, å·²é›†æˆçƒ­é—¨æ’ä»¶å’Œå·¥å…·ã€‹](../202308/20230814_02.md)           
[ã€Š2023-PostgreSQL/DuckDB/MySQL/PolarDB-X Dockeré•œåƒå­¦ä¹ çŽ¯å¢ƒ AMD64ç‰ˆ, å·²é›†æˆçƒ­é—¨æ’ä»¶å’Œå·¥å…·ã€‹](../202307/20230710_03.md)           
## å®‰è£…pg_idkit    
å…‹éš†é¡¹ç›®    
```    
docker exec -ti pg bash    
cd /tmp    
git clone --depth 1 https://github.com/VADOSWARE/pg_idkit.git    
```    
é…ç½®cargoæº, å‚è€ƒ: https://mirrors.ustc.edu.cn/help/crates.io-index.html    
```    
# export CARGO_HOME=/root      
# mkdir -vp ${CARGO_HOME:-$HOME/.cargo}      
# vi ${CARGO_HOME:-$HOME/.cargo}/config      
[source.crates-io]      
replace-with = 'ustc'      
[source.ustc]      
registry = "sparse+https://mirrors.ustc.edu.cn/crates.io-index/"      
```    
å®‰è£…pg_idkitæ’ä»¶    
```    
cd /tmp/pg_idkit    
cargo install cargo-get cargo-pgrx just    
# å¦‚æžœå¯¹pgrxæœ‰ç‰ˆæœ¬è¦æ±‚è¯·å‚è€ƒä¿®æ”¹, ä¾‹å¦‚:
  # grep pgrx Cargo.toml 
  # cargo install --locked --version 0.10.2 cargo-pgrx
cargo pgrx init    # create PGRX_HOME åŽ, ç«‹å³ctrl^c é€€å‡º    
cargo pgrx init --pg14=`which pg_config`    # ä¸ç”¨ç®¡æŠ¥è­¦    
PGRX_IGNORE_RUST_VERSIONS=y cargo pgrx install --pg-config `which pg_config`     
```    
```    
  Installing extension    
     Copying control file to /usr/share/postgresql/14/extension/pg_idkit.control    
     Copying shared library to /usr/lib/postgresql/14/lib/pg_idkit.so    
 Discovering SQL entities    
  Discovered 35 SQL entities: 0 schemas (0 unique), 35 functions, 0 types, 0 enums, 0 sqls, 0 ords, 0 hashes, 0 aggregates, 0 triggers    
     Writing SQL entities to /usr/share/postgresql/14/extension/pg_idkit--0.2.1.sql    
    Finished installing pg_idkit    
```    
ä½¿ç”¨pg_idkit:    
```    
postgres=# create extension pg_idkit ;    
CREATE EXTENSION    
postgres=# \dx    
                                                  List of installed extensions    
   Name   | Version |   Schema   |                                         Description                                              
----------+---------+------------+----------------------------------------------------------------------------------------------    
 pg_idkit | 0.2.1   | public     | multi-tool for generating new/niche universally unique identifiers (ex. UUIDv6, ULID, KSUID)    
 plpgsql  | 1.0     | pg_catalog | PL/pgSQL procedural language    
(2 rows)    
postgres=# \df    
                                          List of functions    
 Schema |                Name                 |     Result data type     | Argument data types | Type     
--------+-------------------------------------+--------------------------+---------------------+------    
 public | idkit_cuid2_generate                | text                     |                     | func    
 public | idkit_cuid2_generate_text           | text                     |                     | func    
 public | idkit_cuid_extract_timestamptz      | timestamp with time zone | val text            | func    
 public | idkit_cuid_generate                 | text                     |                     | func    
 public | idkit_cuid_generate_text            | text                     |                     | func    
 public | idkit_ksuid_extract_timestamptz     | timestamp with time zone | val text            | func    
 public | idkit_ksuid_generate                | text                     |                     | func    
 public | idkit_ksuid_generate_text           | text                     |                     | func    
 public | idkit_ksuidms_extract_timestamptz   | timestamp with time zone | val text            | func    
 public | idkit_ksuidms_generate              | text                     |                     | func    
 public | idkit_ksuidms_generate_text         | text                     |                     | func    
 public | idkit_nanoid_generate               | text                     |                     | func    
 public | idkit_nanoid_generate_text          | text                     |                     | func    
 public | idkit_pushid_generate               | text                     |                     | func    
 public | idkit_pushid_generate_text          | text                     |                     | func    
 public | idkit_timeflake_extract_timestamptz | timestamp with time zone | val text            | func    
 public | idkit_timeflake_generate            | text                     |                     | func    
 public | idkit_timeflake_generate_text       | text                     |                     | func    
 public | idkit_timeflake_generate_uuid       | uuid                     |                     | func    
 public | idkit_ulid_extract_timestamptz      | timestamp with time zone | val text            | func    
 public | idkit_ulid_from_uuid                | text                     | uuid uuid           | func    
 public | idkit_ulid_from_uuid_text           | text                     | uuid text           | func    
 public | idkit_ulid_generate                 | text                     |                     | func    
 public | idkit_ulid_generate_text            | text                     |                     | func    
 public | idkit_uuidv6_extract_timestamptz    | timestamp with time zone | val text            | func    
 public | idkit_uuidv6_generate               | text                     |                     | func    
 public | idkit_uuidv6_generate_text          | text                     |                     | func    
 public | idkit_uuidv6_generate_uuid          | uuid                     |                     | func    
 public | idkit_uuidv7_extract_timestamptz    | timestamp with time zone | val text            | func    
 public | idkit_uuidv7_generate               | text                     |                     | func    
 public | idkit_uuidv7_generate_text          | text                     |                     | func    
 public | idkit_uuidv7_generate_uuid          | uuid                     |                     | func    
 public | idkit_xid_extract_timestamptz       | timestamp with time zone | val text            | func    
 public | idkit_xid_generate                  | text                     |                     | func    
 public | idkit_xid_generate_text             | text                     |                     | func    
(35 rows)    
postgres=# select idkit_ksuidms_generate();    
   idkit_ksuidms_generate        
-----------------------------    
 2ZyFFpsNplQfZLzuFpXvi0vSEhH    
(1 row)    
postgres=# select idkit_ksuidms_generate();    
   idkit_ksuidms_generate        
-----------------------------    
 2ZyFG60s2KHkrAnwHgDG7UFIbmj    
(1 row)    
```    
# æ›´å¤šå‚è€ƒpg_idkit README.md    
  ðŸ˜ ðŸªª `pg_idkit`    
```    
postgres=# CREATE EXTENSION pg_idkit;    
CREATE EXTENSION    
postgres=# SELECT idkit_uuidv7_generate();    
        idkit_uuidv7_generate    
--------------------------------------    
 018c106f-9304-79bb-b5be-4483b92b036c    
```    
## Description    
`pg_idkit` is a [Postgres][postgres] extension for generating many popular types of identifiers:    
| Methodology               | Function                                    | Crate                                | Description                                              |    
|---------------------------|---------------------------------------------|--------------------------------------|----------------------------------------------------------|    
| [UUID v6][uuidv6]         | `idkit_uuidv6_generate()`                   | [`uuidv6`][crate-uuidv6]             | UUID v6 ([RFC 4122][rfc-4122-update])                    |    
|                           | `idkit_uuidv6_generate_uuid()`              |                                      |                                                          |    
|                           | `idkit_uuidv6_extract_timestamptz(TEXT)`    |                                      |                                                          |    
| [UUID v7][uuidv7]         | `idkit_uuidv7_generate()`                   | [`uuid7`][crate-uuid7]               | UUID v7 ([RFC 4122][rfc-4122-update])                    |    
|                           | `idkit_uuidv7_generate_uuid()`              |                                      |                                                          |    
|                           | `idkit_uuidv7_extract_timestamptz(TEXT)`    |                                      |                                                          |    
| [nanoid][nanoid]          | `idkit_nanoid_generate()`                   | [`nanoid`][crate-nanoid]             | NanoID, developed by [Andrey Sitnik][github-ai]          |    
| [ksuid][ksuid]            | `idkit_ksuid_generate()`                    | [`svix-ksuid`][crate-svix-ksuid]     | Created by [Segment][segment]                            |    
|                           | `idkit_ksuid_extract_timestamptz(TEXT)`     |                                      |                                                          |    
| [ksuid][ksuid]            | `idkit_ksuidms_generate()`                  | [`svix-ksuid`][crate-svix-ksuid]     | Same as `ksuid` but with millisecond precision           |    
|                           | `idkit_ksuidms_extract_timestamptz(TEXT)`   |                                      |                                                          |    
| [ulid][ulid]              | `idkit_ulid_generate()`                     | [`ulid`][crate-ulid]                 | Unique, lexicographically sortable identifiers           |    
|                           | `idkit_ulid_extract_timestamptz(TEXT)`      |                                      |                                                          |    
| [Timeflake][timeflake]    | `idkit_timeflake_generate()`                | [`timeflake-rs`][crate-timeflake-rs] | Twitter's Snowflake + Instagram's ID + Firebase's PushID |    
|                           | `idkit_timeflake_extract_timestamptz(TEXT)` |                                      |                                                          |    
| [PushID][pushid]          | `idkit_pushid_generate()`                   | [`pushid`][crate-pushid]             | Google Firebase's PushID                                 |    
| [xid][xid]                | `idkit_xid_generate()`                      | [`xid`][crate-xid]                   | XID                                                      |    
|                           | `idkit_xid_extract_timestamptz(TEXT)`       |                                      |                                                          |    
| [cuid][cuid] (deprecated) | `idkit_cuid_generate()`                     | [`cuid`][crate-cuid]                 | CUID                                                     |    
|                           | `idkit_cuid_extract_timestamptz(TEXT)`      |                                      |                                                          |    
| [cuid2][cuid2]            | `idkit_cuid2_generate()`                    | [`cuid2`][crate-cuid2]               | CUID2                                                    |    
This Postgres extension is made possible thanks to [`pgrx`][pgrx].    
[crate-uuidv6]: https://crates.io/crates/uuidv6    
[crate-uuid7]: https://crates.io/crates/uuid7    
[crate-nanoid]: https://crates.io/crates/nanoid    
[crate-svix-ksuid]: https://crates.io/crates/svix-ksuid    
[crate-svix-ksuid]: https://crates.io/crates/svix-ksuid    
[crate-ulid]: https://crates.io/crates/ulid    
[crate-timeflake-rs]: https://crates.io/crates/timeflake-rs    
[crate-pushid]: https://crates.io/crates/pushid    
[crate-xid]: https://crates.io/crates/xid    
[crate-cuid]: https://crates.io/crates/cuid    
[crate-cuid2]: https://crates.io/crates/cuid2    
## Quickstart    
You can try out `pg_idkit` incredibly quickly by using `docker`, and a previously [released package of `pg_idkit`][released-packages]:    
```console    
docker run \    
    --rm \    
    -e POSTGRES_PASSWORD=replace_this \    
    -p 5432 \    
    --name pg_idkit \    
    ghcr.io/vadosware/pg_idkit:0.2.1-pg16.1-alpine3.18-amd64    
```    
> [!WARNING]    
> Currently only amd64 (x86_64) images are present/supported (See [`pg_idkit` packages][released-packages]).    
>    
> Work to support more platforms is described in [issue #30](https://github.com/VADOSWARE/pg_idkit/issues/30)    
Once the postgres server is running, open another shell and connect to the dockerized Postgres instance running on port `5432`:    
```console    
âžœ docker exec -it pg_idkit psql -U postgres    
psql (16.1)    
Type "help" for help.    
postgres=# CREATE EXTENSION pg_idkit;    
CREATE EXTENSION    
postgres=# SELECT idkit_uuidv7_generate();    
        idkit_uuidv7_generate    
--------------------------------------    
 018c106f-9304-79bb-b5be-4483b92b036c    
(1 row)    
```    
## Installing `pg_idkit`    
ðŸ“ƒ From Source    