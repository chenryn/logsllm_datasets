title:Geolocating IP Addresses in Cellular Data Networks
author:Sipat Triukose and
Sebastien Ardon and
Anirban Mahanti and
Aaditeshwar Seth
Geolocating IP Addresses in Cellular Data
Networks
Sipat Triukose1, Sebastien Ardon1, Anirban Mahanti1, and Aaditeshwar Seth2
1 NICTA, Locked Bag 9013, Alexandria, NSW, Australia
{sipat.triukose,sebastien.ardon,anirban.mahanti}@nicta.com.au
2 IIT Delhi, New Delhi, India
PI:EMAIL
Abstract. Smartphones connected to cellular networks are increasingly
being used to access Internet-based services. Using data collected from
smartphones running a popular location-based application, we examine
IP address allocation in cellular data networks, with emphasis on un-
derstanding the applicability of IP-based geolocation techniques. Our
dataset has GPS-based location data for approximately 29,000 cellu-
lar network assigned IP addresses in 50 diﬀerent countries. Using this
dataset, we provide insights into the global deployment of cellular net-
works. For instance, we ﬁnd that Network Address Translation (NAT)
is commonplace in cellular networks. We also ﬁnd several instances of
service diﬀerentiation with operators assigning public IP addresses to
some devices and private IP addresses to other devices. We also evalu-
ate the error of geolocation databases when determining the position of
the smartphones, and ﬁnd that the error is 100km or more for approx-
imately 70% of our measurements. Further, there is potential for errors
at the scale of inter-country and inter-continent distances. We believe
this dataset may be of value to the research community, and provide a
subset of the dataset to the community.
1
Introduction
Estimating the geographical location of Internet hosts has many applications
including targeted marketing, user proﬁling, fraud detection, regulatory com-
pliance, digital rights management, and server or content distribution network
performance tuning. For instance, to comply with region-speciﬁc licensing ar-
rangements, many streaming media services restrict content access based on the
user’s geographic location. One popular approach to geolocation is the use of
database services such as Maxmind [2] and IPinfoDB [1] that maintain an ex-
haustive table of IP preﬁx to location matches. However, dynamic assignment
of IP addresses, increased fragmentation of IP address blocks, and extensive use
of middleboxes make IP-based geolocation extremely challenging.
In this paper, we examine IP address allocation in cellular data networks, with
emphasis on understanding the feasibility of IP-based geolocation techniques. We
believe this is an important problem as smartphones connected to cellular net-
works are increasingly being used to access Internet-based services. Of course,
N. Taft and F. Ricciato (Eds.): PAM 2012, LNCS 7192, pp. 158–167, 2012.
c(cid:2) Springer-Verlag Berlin Heidelberg 2012
Geolocating IP Addresses in Cellular Data Networks
159
customized smartphone applications can use the built-in Global Position Sys-
tems (GPS) receiver to obtain accurate location information. However, in cases
where a service is accessed through the phone’s browser1 or when GPS-based
tracking is disabled (e.g., by the user because of privacy concerns), alternative
geolocation techniques are necessary. The IP geolocation problem has not re-
ceived much attention in the context of cellular data networks, and we ﬁll this
void by instrumenting a popular location-based iOS application to collect and
subsequently analyze a dataset that has GPS-based location data for approx-
imately 29,000 cellular network assigned IP addresses, obtained from several
thousand individual smartphones spread across 50 countries.
This paper oﬀers several contributions. First, we characterize the dataset and
oﬀer insights on the global deployments of cellular data networks. For instance,
we ﬁnd that NAT and other middleboxes are widely deployed in cellular networks
worldwide. We also provide evidence of service diﬀerentiation, where a provider
assigns publicly visible IP addresses to some users, while other users are behind
NAT boxes. Second, we study whether or not geolocation databases provide
good location estimates and show that the error is 200km or more in 50% of our
measurements. Further, we observe some large errors, owing to mobile operator’s
implementation of roaming functionality. This can be expected to become a
commonplace problem as roaming traﬃc charges drop. Finally, we provide an
original dataset to the community, with an unprecedented number of ground
truth measurements of IP to geolocation mapping for cellular data networks.
The remainder of this paper is organized as follows. Section 2 present an
overview of related work. Our data collection method and a preliminary analysis
of the dataset is present in Section 3. An analysis of the IP addresses observed
in our dataset is presented in Section 4. Section 5 presents concluding remarks.
2 Related Work
The problem of geolocating hosts in networks has been widely studied [8]. Tech-
niques range from measuring packet latencies to landmark nodes and then esti-
mating their location relative to these nodes [6–8], applying machine learning to
ground truth datasets [5], or using tabular storage of IP preﬁxes and associated
locations (‘GeoIP databases’) [1, 2]. The accuracy of GeoIP databases has also
been debated [9, 10]. For instance, Poese et al. [9] recently evaluated the ac-
curacy of several GeoIP databases using ground truth information from several
POP locations from one European wired ISP and found that while most GeoIP
databases can claim accuracy at the country level, their databases are heavily
biased towards few countries.
1 The HTML5 Geolocation API [3] allows browsers to report a device’s position. The
source of location data is implementation-dependent, and can be obtained from GPS
receivers, WiFi network location databases, or other means. It is still early days for
this solution, and geolocation databases are likely to be a popular method for many
reasons, including privacy concerns associated with ﬁne-grained location tracking.
160
S. Triukose et al.
Data
Unique ID
Timestamp
Table 1. Dataset details
Description
Per device, unique id (fully anonymised)
Interface IP Address
Observed IP Address Device IP address, as observed at the application’s server
Time at server when measurement was recorded
IP address assigned to the Cellular Data interface
Location
Latitude / Longitude coordinates
Horizontal Accuracy
Accuracy, in meters, of the location measurement
Closely related to our work are recent studies by Balakrishnan et al. [4], Xu et
al. [12], and Wang et al. [11]. For mobile devices connected through 3G networks,
Balakrishnan et al. [4] studied the accuracy of GeoIP databases, the client/server
latencies, and the IP address ‘stickiness’. Their study, while comprehensive, is
based on three datasets with a maximum of about 100 devices, over a single
mobile operator network in the US. Xu et al. [12] combined several data sources
to discover cellular network infrastructure. Their work relied on server logs, DNS
request logs, and publicly available routing updates to characterize four major
US cellular carrier networks. Xu et al. evaluated the cellular network diameter,
and demonstrate how this could aﬀect content placement strategies. Wang et
al. [11] characterized NAT, ﬁrewall, and other security policies deployed in more
than 100 cellular IP networks.
We believe our work complements these recent eﬀorts [4, 11, 12]. Our novel
dataset has ground truth information on the location of mobile devices, and thus
allows us to evaluate how well GeoIP databases may perform for IP addresses
assigned by cellular networks. Further, our dataset provides an opportunity to
study IP address assignment at a larger scale than that of previous studies, and
across carriers in many diﬀerent countries.
3 Dataset and Preliminary Analysis
3.1 Dataset
Use of third-party smartphone applications has exploded in recent years, owing
to the phenomenal success of the ‘App Store’ model. These third-party appli-
cations present an unprecedented opportunity for crowd-sourcing network mea-
surements from mobile networks. For this work, we partnered with the developer
of a location-based iOS application2 to add minimal instrumentation code such
that the application’s Internet-based server logs reported the device’s local IP
address. This reporting is only done when the device is using the 3G/GPRS
interface for communication.
2 The application is available only on Apple devices running the iOS operating system,
and has been downloaded by 140,000 users from 50 countries, and is particularly
popular in Germany and Australia.
Geolocating IP Addresses in Cellular Data Networks
161
The application developer provided us with processed data from their server
logs. In particular, the raw dataset consists of 29,043 measurement points, col-
lected from 11,230 unique smartphones between May and August 2011. The
information available is detailed in Table 1.
This dataset may be obtained by contacting the authors. For privacy rea-
sons, the released dataset will not provide the location data and instead provide
the corresponding country and city-level information available from the Google
reverse geocoding service. In addition, the released dataset will include the ob-
served IP address but not the Interface IP address. Instead, we include a set of
two boolean ﬂags, to indicate respectively whether the device IP address was
in the private IANA space, and whether it was diﬀerent from the observed IP
address. Finally the device id and horizontal accuracy are also removed. This
transformation on the data improves the users privacy while providing the in-
formation required to conﬁrm the key results of this paper, and develop many
new ﬁndings.
3.2 Geographical Coverage
Before analyzing the collected data, we applied a few simple ﬁltering rules. Note
that the number of measurements from a particular device depends on the fre-
quency with which the owner of the device interacts with the application. As
we are not interested in recording multiple instances of identical information,
for each smartphone we discard a measurement point only if all the following
conditions are met, with respect to the previous measurement point: i) both
the device and observed IP address are unchanged, ii) the distance between the
measurements locations is less than 1km3, and iii) the time elapsed since the
previous measurement is less than 3 hours. Following this preprocessing, we are
left with 27,328 measurements. Next, we applied the Google reverse-geocoding
service to obtain city and country information from the GPS coordinates. We
successfully looked up 26,566 dataset entries. The remainder of this paper fo-
cuses on this ﬁltered dataset. In total, we have measurements from 1,924 cities
in 50 diﬀerent countries as summarized in Table 2 and illustrated in Figure 1.
Devices running iOS use a proprietary ‘Assisted GPS’ method to optimize the
device location computation, using a combination of GPS data and a proprietary
WiFi geo-database. The 3G iPhone’s Assisted GPS typically has horizontal ac-
curacy errors of 10-15 m [13]. The iOS application programmer can retrieve the
accuracy level, in meters, associated with any GPS location measurement. This
horizontal accuracy value was available for 97% of our measurement points, and
these indicate that 78% of the GPS location information are accurate to 100m,
and 93% are accurate to at least 1km.
3 Condition (ii) captures mobility and uses 1km as the threshold since more than 90%
of the measurements have horizontal accuracy of at least 1km.
162
S. Triukose et al.
Table 2. Reverse geocoding of measurement locations
Continent
Countries
Australia (2)
Europe (26) DE,FR,SE,AT,CH,GB,ES,IT,PL
TR,LU,DK,BE,GR,NL,HU,RO
RS,FI,CZ,HR,NO,IE,LI,PT,SK
AU,NZ
Asia (14)
TW,SG,JP,MY,CN,HK,KW
KH,CY,OM,IN,AE,KR,LB
America (3)
Others (5)
US,CA, CR
MO,AR,CO,PR,ZA
# of Cities Total Entries
18,211
7,036
166
1482
158
104
14
991
282
46
Fig. 1. All measurement locations
3.3 Limitations
Our dataset constitutes a sample of smartphone locations worldwide, the IP ad-
dress assigned by the cellular data network to these smartphones, and the IP
address from which these devices are visible on the Internet. The main draw-
back of this application-driven measurement method is the spatial and temporal
sampling bias introduced as the measurement occurrences are driven by: i) the
adoption rate of the smartphone type/OS on which the application is available,
ii) the application adoption rate and the spatial distribution of its adopters, and
iii) the application usage rate and spatial pattern, which is dependent on the
application’s intended use. This dataset is, however, to our knowledge, the ﬁrst
of its kind to be available to the research community.
4 Cellular Networks: View from the IP Level
4.1 Public IPs, Private IPs, and Middleboxes
With the number of Internet-enabled smartphones exploding, and the increased
scarcity of available IPv4 address space, mobile operators are likely to rely on
Geolocating IP Addresses in Cellular Data Networks
163
Table 3. IP allocation statistics for the top 15 networks in the dataset
Network Name
Country
OPTUSINTERNET-AU
CUSTOMERS-DE
AU
DE,IT,HR,
FR,PT,NL
TELSTRAINTERNET42-AU AU
VODAFONE
AU
AU
H3GAIPNET
DE,ES,NL,CH,
DE-D2VODAFONE
FR,IT,DK,GR
AU,NL
VODAFONE-PACIFIC-AU
E-PLUS-MOBILES-BLOCK-6 DE
o2-Germany-NAT-Pool2-FRA DE
o2-Germany-NAT-Pool1-DUS DE,ES
o2-Germany-NAT-Pool1-BER DE
DE-D2VODAFONE-20101118 DE
ORANGE-FR
FR
FR,BE
SFR-INFRA
EMOME-NET
TW
total # devices with # devices with
devices only private IP only public IP
1958
135
11
1134
2039
1337
1122
1101
789
702
486
342
300
283
265
217
183
163
162
1119