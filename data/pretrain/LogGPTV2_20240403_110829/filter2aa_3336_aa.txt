1
Cryptanalysis in real 
life
周立平 等研究团队
Do u understand real hackers ?
第3页
纲目
第一章
绪论
第二章
Mifare Classic Card介绍
第三章
Mifare Classic Card现有
攻击方式
第四章
二代卡的特性
第五章
自然人凭证
第4页
RFID
RFID
非接触式
Smart Card
第一章
绪论
攻击背景
Reader
Tag
010101
YoYo卡
一卡通
i-cash
第5页
第一章
绪论
攻击手段
Reader
Tag
加密
解密
窃听
第6页
第一章
绪论
现状
新/旧卡
改良方式
新卡
用3DES etc
旧卡
改善弱点 增加金钥长度 etc
成本??
0.8美元/张，全球已发行约10亿张
第7页
第二章
Mifare Classic Card介绍
第一节
Mifare Classic Card规格
与结构
第二节
Mifare Classic Card认证
协定
第三节
Crypto-1加密演算法
第四节
Mifare Classic Card弱点
第8页
第二章
Mifare Classic Card介绍
第一节
Mifare Classic Card规格与结构
规格与特性
1.操作频率：13.56 MHz。
2.传输速度：106 Kbps。
3.传输距离：10cm。
第9页
第二章
Mifare Classic Card介绍
第一节
Mifare Classic Card规格与结构
资料储存结构
Sector
Block 0
Block 1
Block 2
Block 3
0
Manufacturer Code
Data Block
Data Block
Key A, Access Conditions, Key B
1
Data Block
Data Block
Data Block
Key A, Access Conditions, Key B
2
Data Block
Data Block
Data Block
Key A, Access Conditions, Key B
3
Data Block
Data Block
Data Block
Key A, Access Conditions, Key B
4
Data Block
Data Block
Data Block
Key A, Access Conditions, Key B
5
Data Block
Data Block
Data Block
Key A, Access Conditions, Key B
6
Data Block
Data Block
Data Block
Key A, Access Conditions, Key B
7
Data Block
Data Block
Data Block
Key A, Access Conditions, Key B
8
Data Block
Data Block
Data Block
Key A, Access Conditions, Key B
9
Data Block
Data Block
Data Block
Key A, Access Conditions, Key B
10
Data Block
Data Block
Data Block
Key A, Access Conditions, Key B
11
Data Block
Data Block
Data Block
Key A, Access Conditions, Key B
12
Data Block
Data Block
Data Block
Key A, Access Conditions, Key B
13
Data Block
Data Block
Data Block
Key A, Access Conditions, Key B
14
Data Block
Data Block
Data Block
Key A, Access Conditions, Key B
15
Data Block
Data Block
Data Block
Key A, Access Conditions, Key B
第10页
第二章
Mifare Classic Card介绍
第一节
Mifare Classic Card规格与结构
记忆体储存结构
UID，BCC，Manufacturer Code
(制造厂商资料)
0x00
DATA Block(资料区块)
0x01
DATA Block(资料区块)
0x02
Sector 0x00
4 block,
64bytes
Key A, Access Conditions(存取条件), Key B
0x03
DATA Block(资料区块)
0x04
DATA Block(资料区块)
0x05
DATA Block(资料区块)
0x06
Sector 0x01
4 block,
64bytes
Key A, Access Conditions, Key B
0x07
…
DATA Block(资料区块)
0xf0
…
共有16block
256bytes
Key A, Access Conditions, Key B
0xff
UID，BCC，Manufacturer Code
(制造厂商资料)
0x00
DATA Block(资料区块)
0x01
DATA Block(资料区块)
0x02
Sector 0x00
4 block,
64bytes
Key A, Access Conditions(存取条件), Key B
0x03
DATA Block(资料区块)
0x04
DATA Block(资料区块)
0x05
DATA Block(资料区块)
0x06
Sector 0x01
4 block,
64bytes
Key A, Access Conditions, Key B
0x07
…
DATA Block(资料区块)
0xf0
…
共有16block
256bytes
Key A, Access Conditions, Key B
0xff
第11页
第二章
Mifare Classic Card介绍
第一节
Mifare Classic Card规格与结构
通讯流程
询卡
认证
卡片
防碰撞机制
选卡
读区块
写区块
加值
回存
减值
Halt
传送
第12页
第二章
Mifare Classic Card介绍
第二节
Mifare Classic Card认证协定
一、Mifare Classic卡认证流程
2.Nt
3.{Nr}、{Ar}
4.{At}
1.UID(卡号)
READER
TAG
{}表示加密状态
第13页
第二章
Mifare Classic Card介绍
第二节
Mifare Classic Card认证协定
二、通讯范例
Step
发 送 者
H e x ( 1 6 进 位 内 容 )
I S O
1 4 4 4 3
指 令
注
解
0
RD
26
REQUEST
Hi, I am Reader, Is 
any card here ?
1
TAG
04 00  
AWAKE
Hello, I am here.
2
RD
93 20
Polling
Who are you ?  
3
TAG
9C 59 9B 32 6C
UID  
I am 9C 59 9B 32 6C
4
RD
93 70 9C 59 9B 32 6C 6B 
30
ANTI COLL
OK, I want to talk to 
you 9C 59 9B 32 6C
5
TAG
08 B6 DD
TAG TYPE  
Ok. My card type is 
Mifare Classic 1K
6
RD
60 00 F5 7B
AUTH    
开始认证 , 请问 00 
Block
7
TAG
82 A4 16 6C
Nt  
明文 Nt
8
RD
EF EA 1C DA 8D 65 73 4B
Nr + Nt'  
密文 {Nr} + {Ar}
9
TAG
9A 42 7B 20  
Nt"  
密文 {At}
第14页
第二章
Mifare Classic Card介绍
第三节
Crypto-1加密演算法
一、LFSR (Linear Feedback Shift 
Registers) 线性反馈位移暂存器