（5）弱密钥攻击：即利用诸如WEP等加密算法漏洞实施暴力破解，逐个字节破译
马超根据IDS报警发现公司内网财务网段的服务器端口被人扫描，顿时警觉起来。经过
（4）中间人攻击：通过网络窃听以获取网络中的敏感数据信息，进而在目标接入点附近
马超是公司的系统管理员。当周末快下班时，他收到了网络运作中心管理员小夏的电话。
坐落在清华科技园的某企业是一家中型软件公司，公司办公场所位于相邻的两栋大厦
（3）拒绝服务攻击（DoS）：无线DoS攻击与有线网络中的DoS攻击一样，安全危害巨
电话那边告诉马超，在大约 30分钟前，内部入侵检测系统的探测器开始发出警告。当时
网络工程组与安全组协同工作，确保采取所有合理的措施来保护无线网络的安全。例如
故事人物：马超（系统管理员）、小夏（值班网管）、攻击者丁某、项某（丁某的网
难度系数：★★★★
可使网络陷入瘫痪。DoS攻击方式多样，而且易于实施，防治策略有限，是攻击者极为
0122
案例十九：无线网遭受的攻击
VPNGateway
图11-1网络结构
Firewal
接入网络
笔记本（带无线网）
MAIVT
---
## Page 324
无线接入点，并发现了可疑网卡的IP地址。而且，马超意外地在他所登录的这台AP上发现
Bell并没有在大厦内，随即又查到了他的手机，并拨通电话向他确认这一点。接着马超登录
厦内，于是他来到大厦的保安室开始查询。然后继续查看了大厦控制系统的访问日志，发现
局地址列表，确认此用户是Bell。此时马超想到需要检查一下门禁日志确认 Bell是否还在大
网页接口，发觉只有一个用户登录，并且这个用户使用了非法IP地址。
讲，在晚上，无线网络仅启用一段短暂的时间，通常没有大的流量。马超连接上VPN 管理
括 ICMP、TCP、UDP、RAW SOCKET。
IDS日志，主要是检查/var/log/snort/alert的内容。结果发现了以下三段可疑的日志：
原本计划周末晚上和女朋友去看电影。因此他不得不推掉约会，朝办公室走去。他检查了
扫描行为引发的。
发报警。马超询问了关于IDS报警的性质。小夏告诉马超，报警是由于会计网络的某些端口
公司还在假期中，很多人这周都没有上班，又恰好赶上网络系统升级。这时网络升级也可能引
马超通过 VPN 后台查询到登入的账号名为 Bell。马超查阅了 Windows 系统中 AD 域全
马超查找那个可疑IP地址（10.5.88.62），
在敏感网段发生了扫描事件，马超不得不去调查这个警报。这给马超带来不便，因为他
典型的 ping 程序使用的是 ICMP 回显请求来测试，而 Hping 可以使用任何 IP 报文，包 
注意：
第三段日志
第二段日志
第一段日志
[Xref=>http://www.whitehats.com/info/IDS162]
Type:8Code:0ID:7007Seq:8960ECHO
ICMPTTL:58TOS:0x0ID:37213IpLen:20DgmLen:28
07/05-11:17:19.49121210.5.88.62->10.7.1.8
[Classification: Attempted Information Leak] [Priority: 3]
[**][1:468:1] ICMPNmap4.11 orHPING2Echo[**]
[Xref=>http://www.whitehats.com/info/IDS162]
Type:8Code:0ID:7007Seq:7680ECHO
ICMPTTL:58TOS:0x0ID:15132IpLen:20DgmLen:28
07/05-11:17:19.480825 10.5.88.62 ->10.7.1.7
[**][1:468:1] ICMPNmap4.11 or HPING2Echo[**]
[Xref=>http://www.whitehats.com/info/IDS162]
Type:8Code:0ID:7007Seq:6400ECHO
ICMPTTL:58TOS:0x0ID:48444IpLen:20DgmLen:28
07/05-11:17:19.47085610.5.88.62->10.7.1.6
[**] [1:468:1] ICMPNmap4.11 orHPING2 Echo [**]
[Classification:AttemptedInformationLeak][Priority:
[Classification:AttemptedInformationLeak][Priority:3]
，发现它属于无线VPN的地址范围。一般来
第11章WLAN案例分析301
---
## Page 325
锁定了攻击者的方位。
信号强度。比较信号强度记录，确定目标 AP 所在的位置，即测得最强信号的区域。他终于
走到第二个角，记录信号强度；走到第三个角并记录信号强度；然后走到最后一个角并记录
索区域想象成一个大矩形，然
距离AP的距离就越近）。他不停地在现场走动，同时利用强度仪监控信号强度：首先将搜
借来了手持信号强度测试仪（射频功率计），来测量来自恶意AP的射频信号（信号越强，
题可以采用收敛法解决。收敛法示意图如11-2所示。
寻找非法AP接人点
用于追踪无线攻击者的全向天线。
了无线网络，并在连接上接入点的网络上附加了一个IDS和一个嗅探器。马超又标记出了那
网络攻击者，他给经理打了个电话汇报此事。随后，马超断开了Bell这个用户的连接，重启
马超，他已经超过一周没有使用这块无线网卡了。综合以上情报，马超现在断定这肯定是个
个叫Kate 的用户。接着他给Kate拨了个电话，然而Kate 也没有在这栋大厦内。Kate 告知
AP的日志
了如下三行可疑日志。
302UNIX/Linux网络日志分析与流量监控
些危害安全的访问点的无线覆盖范围。当攻击者重返网络时，IDS开始发送警报。随后值班
发现有非法 AP 接入，
马超发现可疑者在与2号大厦相邻的公寓楼5层。这两栋楼相距十几米，但是没有人曾
马超的一台网管笔记本就配备了标准无线LAN网卡（带全向天线），这时他到朋友那里
马超查阅了无线网卡和IP的电子对照表格，发现这个可疑网卡的物理地址属于另外一
00:04:09(Info):Station004096500e61Authenticated
00:04:09(Info):Station 004096500e61Associated
00:03:56(Info):Deauthenticating 004096500e61,reason“Inactivity"
然后将其分为四个象限。走到搜索区域的一角，记录信号强度；
，这才是刚刚开始，接下来要找出这个接入点的位置，对于这种问
图11-2收敛法的示意图
201
测试点
BTIMO
---
## Page 326
Windows计算机，其中4台计算机以默认方式共享文件和打印机。
枚举每一台计算机。于是他发现了许多装着WindowsXP的计算机，在此WLAN中有20
这个网络，因此他不愿意在取得这样的突破之后空手而归。接着他开始扫描整个无线网络，
接，所以他实际上能够访问的是一个死胡同一样的末梢网络。丁某已经花了大量的时间侵入
术，很快他就发现了漏洞。在经过数次测试和编码之后，丁某破译了接入点的 WAP 加密密
这里开会，很多人在漫长会议期间使用他们的无线网卡。丁某开始研究WAP加密编码技
接。随后丁某开始研究如何接入到对方公司的无线网。接下来他开始监听网络流量，研究目
这家公司的网络（也就是马超所在公司的网络），他就能得到一个更快的、免费的Intermet
间发现了马超公司会议室发出的无线信号，而且强度很好。丁某认为，如果他能够设法连接
四层小楼里。丁某为了能同邻居共享ADSL上网，购买了无线接入端。他在使用过程中无意
将几段事件还原暗
等。同样的，由于马超所在公司的无线网刚刚建成，没有安全加固措施，因而攻击者很容易
络监听程序，或是经过明文电子邮件消息和简单的文档处理所造成的敏感文档的信息泄
互动问答
想过无线信号能传这么远。
码，院
标网络。
扑结
丁某处在一个收集数据包的理想地点，在他的公寓对面就是公司的会议室，公司经常在
攻击者丁某是一名在公司附近工作的程序员，他的住所正好处在公司会议室对面的一
个54MB/s甚至更高的连接，但是由于访问Internet和公司内部网络都需要通过VPN连
丁某连接到这个公司WLAN网络后，却非常失望。他本来希望WLAN和Intermet 之间
随后渗透到了马超公司的WLAN中。
整个过程是如何发生、发展的呢？看完下面的分析大家就能够明白。
构进行推测。在WLAN环境中攻击者可以通过多种方法收集所需的信息，比如基于网
此次攻击事件由于缺少日志记录，这时马超还无法确定攻击时间，但是可以通过网络
？
1.1
如何管理好WiFi网络？
还有更快的方式能准确定位AP吗？
攻击者是如何侵入VPN的？
攻击者是如何突破WEP和MAC访问控制的？
TA
TI
泄露的无线信号
与自文（文全日）
公寓
图11-3相距很近的两栋建筑物
号
第11章WLAN案例分析303
（
整网版益
连
栋
家
---
## Page 327
后台管理和用户信息管理。图11-4是FreeRadius工作效果。
使用比较广泛而且成熟的一套开放源码软件FreeRadius，采用Radius Manager来实现管理员
trap命令：
法。但前提是事先打开AP的 SNMP 设置功能。登录AP 后台管理界面，然后启用 SNMP
Trap 数据就能知道每一使用者进出 AP 的信息。利用 Trap来判断位置信息是个不错的定位方
AP通信范围时，AP会发送 Disassociation Trap。所以我们发现，只要有网管工作站所接收的
（Association）时，会以SNMP发出AssociationTrap通知网管工作站，当使用者断线或远离
Bridge MIB的方式以提供网管人员对AP的控制。一般而言，AP 在使用者要求建立联机
Windows上的VPN静态密码很容易破解。
观察所有流量，找到一个当前未使用的MAC地址，并假冒该地址。
使用airsnort和WEPCrack，从而得到MAC地址。一旦掌握了这些地址，攻击者可以被动地
可以防范被动监听了。无线通信的被动监听能使攻击者得到足够的信息去破解WEP，例如
监听网络并枚举整个网络获得访问权限。除了限制信号泄漏到大楼外部以外，没有其他措施
疑点解析
的各个网段进行扫描，其中就包括了会计网段，从而引发了管理人员的关注。
有对内部网络进行端口扫描，则丁某所做的一切就不会察觉，但项某却利用此方法在公司中
来的账号开始非法扫描内部网络。事情就这样发生了。我们回到故事的一开始，如果项某没
安装程序。他安装了VPN 客户软件，尝试着接入网络。使他高兴的是，VPN 软件很容易地
网关的IP 地址。花了大半天时间之后，丁某在一台被攻破的计算机上，找到了VPN的客户
序，然后就去睡觉了。第二天清晨，他获得了4个用户名和密码，并找到了内部访问VPN
304UNIX/Linux网络日志分析与流量监控
1）WEP和MAC的限制虽然能加强访问控制，效果却不十分理想。攻击者可以被动地
丁某心中充满了成就感。他将连接某公司网络的信息告诉了好友项某。项某拿着轻易得
安装上了并且第一次连接就成功了。
2）攻击者应该无法攻破TDES IPSecVPN（使用TDES 算法加密的VPN），但是
搭建RADIUS服务器时，采用以下关键步骤：
目前，无线网认证的方案比较多，为了更好地管理无线网络用户，这里给大家介绍目前
（1）更改MAC、IP、GATEWAY、NameServer，
3）通过SNMP快速定位非法AP。
他迅速将这些计算机上的pwl（口令文件）文件放到自己的计算机上，并启动了解密程
（5）安装RadiusManager。
（4）
（3）
（2）安装基础服务组件。
目前市面上大部分的WLANAP（AccessPoints）都支持SNMP，能够使用SNMP轮询
建立MySQL数据库并作设置。
安装及配置FreeRadius。
ap1200(config)#snmp-server enable traps wlan-wep
，并关闭 SELinux。
---
## Page 328
定的方法。
11.2.2用开源NAC阻止非法网络访问
NAT日志文件压缩后传输到分组域日志服务器。
中提出所需字段信息，统一格式后写入 NAT日志文件。周期性生成 NAT 日志文件后，将
息，给出在该时间内使用该IP用户的账号或手机号。
相关日志保存90天，并在国家有关机关依法查询时，根据查询的IP地址、访问时间等信
改进现状，管理员在公司楼宇内需要对WLAN无线上网用户提供上网日志留存查询。即将
IEEE802.1x标准实现端口访问控制，所以RADIUS服务器适合于保护无线网络的安全。为
11.2.1WIFI上网日志的收集
知管理员有可疑的活动。
全配置，不应该使用默认安装。此外，尽量使用防火墙，这有助于减少攻击的有效性并能通
盗用的概率。最后一步是强化无线上网电脑的安全防范。使用无线网络的计算机应该经过安
在传统方法里，为了防止外来设备接入企业网，可以采用在交换机上设置IP-MAC绑
换，如果有可能的话，应该使每个会话拥有一个WEP密钥。这将减小WEP密钥被破译、
于攻击的目标。另外一个预防性的步骤是采取WEP密钥的轮换机制。WEP密钥应该定期轮
登录凭证的可靠程度等同于最弱的存储机制的强度，本案中WindowsXP计算机就是一个易
不好的密码策略却成为了致命弱点。使用一次性的密码或者数字证书可以防止这类入侵。
VPN，使用3次DES加密和MD5认证。攻击者应该无法攻破这种加密强度的VPN，但是
信号泄漏的壁纸，从而降低建筑物周围接入点的信号强度。
无线设备，可是这样增大了信号泄漏的风险。我们可以合理选择AP的位置或使用防止WiFi
预防措施
RADIUS/AAA（Authentication、
接下来的问题是处理不可靠的VPN连接。某公司只是根据常识实现了基于IPSec的
日志采集设备实时接收防火墙上报的原始日志信息，并实时解析采集到的原始日志，从
本案中需要处理的第一个问题是无线信号的泄漏问题。
4.
口口口
line
users
。下面将介绍两款开源的NAC系统，它们分别是PacketFence和FreeNAC。
2012-01-16
vicos
aers
Dnline time Download upload IP address
HAS
AP
CMTsIpools
14.6GB8
26.1GB14GB
Authorization、Accounting）服务器的目的是基于
12345678>>last
830.
cials
第11章WLAN案例分析305
人们总是想选用发射信号强大的
ES
-64
username:
Va
H8
被
---
## Page 329
库，方便今后统一管理。
PacketFence系统将局域网内所有计算机设备通过注册方式记录到系统里，形成一个数据
接的未注册计算机则会显示为“unreg”，并通过图 11-6 显示出一张更详细的图表。利用
管理内网节点效果如图11-5所示。
的旁路访问方式。还有一种接法就是串接在防火墙之后，不过这样容易造成单点故障。用
Web界面方法为https://ip:1443/。
一块网卡用于收集接在交换机的SPAN口信息），对交换机的要求为可网管交换机。访问
的一体化VMware虚拟机文件来直接使用，可到http://www.packetfence.org/download/zen.html
RHEL和CentOS、Debian系统中运行。可以下载它的二进制文件包来安装，也可以下载它
管理功能完全可以满足目前大部分中小企业的网络访问控制的需求。PacketFence可以在
们提供一种和有线网络相同的安全控制方式。可以通过Web和命令行界面来管理它。这些
产的可网管交换机。PacketFence 通过FreeRADIUS模块提供对802.1x无线的支持，能为我
分不同VLAN来阻止不安全的终端接入网络，这些交换机包括H3C、Cisco、Dell等厂商生
并给出相应的警告。PacketFence支持对许多厂商的可网管交换机进行VLAN设置，通过划