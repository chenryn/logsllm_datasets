Page 81  – 8 August 2015 
Invite, CDR and Billing Tests 
Invite / Ack / Re-Invite / Update (FROM, TO, VIA, Credentials) 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 82  – 8 August 2015 
Toll fraud for CUCM 
• Cisco UCM accepts MAC address as identity 
• No authentication (secure deployment?) 
• Rogue SIP gateway with no authentication 
• Caller ID spoofing with proxy headers 
• Via field, From field 
• P-Asserted-Identity, P-Called-Party-ID 
• P-Preferred-Identity  
• ISDN Calling Party Number, Remote-Party-ID*  
• Billing bypass with proxy headers  
• P-Charging-Vector (Spoofing, Manipulating) 
• Re-Invite, Update (With/Without P-Charging-Vector) 
* https://tools.cisco.com/bugsearch/bug/CSCuo51517   
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 83  – 8 August 2015 
Caller ID spoofing on CUCM 
Remote-Party-ID header 
Remote-Party-ID: ;party=called;screen=yes;privacy=off 
• Caller ID spoofing 
• Billing bypass 
• Accessing voicemail 
• 3rd party operators 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 84  – 8 August 2015 
Caller ID fraud for all operators? 
• Telecom operators trust source Caller ID 
• One insecure operator to rule them all 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 85  – 8 August 2015 
Fake Caller ID for messages? 
• Call me back function on voicemail / calls 
• Sending many spoofed messages for DoS 
• Overseas 
• Roaming 
• Social engineering (voicemail notification) 
• Value added services 
• Add a data package to my line 
• Subscribe me to a new mobile TV service 
• Reset my password/PIN/2FA 
• Group messages, celebrations 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 86  – 8 August 2015 
Exercises  
• SIP service discovery 
• User and extension enumeration for SIP 
services 
• Brute force attacks against SIP services 
• Register tests with/without authentication 
• Invite tests for call analysis 
• Message tests for SMS analysis 
• Call Spoofing exercises  
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 87  – 8 August 2015 
Advanced SIP Attacks 
Unified Communications infrastructure and 
commercial subscriber services may be 
susceptible to the advanced attacks. 
• SIP Proxy Bounce Attacks 
• SIP Trust Relationship Hacking 
• DoS and DDoS Tests 
• Fuzzing 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 88  – 8 August 2015 
SIP Proxy Bounce Attack 
• SIP Proxies Redirect Requests to the Others  
• We can access and scan them via SIP proxy 
• We can scan inaccessible servers 
• URI field is useful for this scan 
• Business Impact 
• SIP trust relationship hacking 
• Attacking inaccessible servers 
• Attacking the SIP software and protocol 
• Software, Version, Type, Realm 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 89  – 8 August 2015 
SIP Proxy Bounce Attack (Headers) 
OPTIONS sip:10.1.1.1:5060 SIP/2.0 
Via: SIP/2.0/UDP 192.168.0.11:5065;rport;branch=branchkUk5jYbvQk 
Max-Forwards: 70 
From: ;tag=FCXdqAEChY;epid=Fho7Ha8vX4 
To:  
Call-ID: callQOAFEvMfOoMfe1mwJDDJeOvr6nydEb 
CSeq: 1234 OPTIONS 
Contact:  
User-Agent: Viproy Penetration Testing Kit - Test Agent 
Allow: PRACK, INVITE ,ACK, BYE, CANCEL, UPDATE, SUBSCRIBE,NOTIFY, REFER, 
MESSAGE, OPTIONS 
Expires: 3600 
Accept: application/sdp 
Content-Length: 0 
Client IP 
Scan Target 
no SIP proxy address in the request 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 90  – 8 August 2015 
SIP Proxy Bounce Attack 
192.168.1.146 
Melbourne 
192.168.1.202 
Brisbane 
192.168.1.145 - Sydney 
Production SIP Service 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 91  – 8 August 2015 
Denial of Service Tests 
• Locking All Customer Phones and Services for 
Blackmail 
• Denial of Service Vulnerabilities of SIP Services 
• Multiple responses for bogus requests → DDOS 
• Concurrent registered user/call limits 
• Voice Message Box, CDR, VAS based DOS attacks 
• Bye and cancel tests for call drop 
• Locking all accounts if account locking is active for 
multiple fails 
• Multiple Invite (With/Without Register, Via Trunk) 
• Calling all numbers at same time  
• Overloading SIP server's call limits 
• Calling expensive gateways, targets or VAS 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 92  – 8 August 2015 
Distributed Denial of Service Tests 
• SIP Amplification Attack 
• SIP Servers Send Errors Many Times (10+) 
• We Can Send IP Spoofed Packets 
• SIP Servers Send Responses to Victim 
• => 1 packet for 10+ Packets, ICMP Errors 
(Bonus) 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 93  – 8 August 2015 
Distributed Denial of Service Tests 
SIP based DoS attacks 
• UDP vulnerabilities and IP spoofing 
• Too many errors, very very verbose mode 
• ICMP errors 
192.168.1.146 
Melbourne 
192.168.1.202 
Brisbane 
192.168.1.145 - Sydney 
Production SIP Service 
Alderaan 
IP spoofed UDP SIP request 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 94  – 8 August 2015 
Hacking SIP Trust Relationships 
• NGN/UC SIP Services Trust Each Other 
• Authentication and TCP are slow, they need 
speed. UDP is the solution. 
• IP and port based trust is most effective way 
• What We Need 
• Target number to call (cell phone if service is 
public) 
• Tech magazine, web site information, news 
Hacme Telecom proudly announces the new 
cheap call services supported by OverSeas 
Telecom.  
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 95  – 8 August 2015 
Hacking SIP Trust Relationships 
Steps: 
• Finding Trusted SIP Networks (Mostly B Class) 
• Sending IP Spoofed Requests from Each IP:Port 
• Each Call Should Contain IP:Port in "From" Section  
• If We Have a Call, We Have The Trusted SIP Gateway 
IP and Port 
• Initiate unauthorised calls after obtaining the 
trusted IP:Port pair 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 96  – 8 August 2015 
Hacking SIP Trust (Headers) 
INVITE sip:1000@192.168.1.1 SIP/2.0 
Via: SIP/2.0/UDP 10.1.1.1:5060;branch=branchkjBzDAQuaX;rport 
Max-Forwards: 70 
From: "10.1.1.1:5060" ;tag=tagnO4D1aHiEb 
Contact:  
To:  
Call-ID: call0oLhjWR0Cc@10.1.1.1 
CSeq: 1 INVITE 
User-Agent: Test Agent 
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY, INFO 
Expires: 3600 
Supported: replaces, timer 
Content-Type: application/sdp 
Content-Length: 218 
SIP Server IP 
Scanning Target IP and 
Port 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 97  – 8 August 2015 
Hacking SIP Trust (Content) 
v=0 
o=root 1716603896 1716603896 IN IP4 10.1.1.1 
s=Test Source 
c=IN IP4 10.1.1.1 
t=0 0 
m=audio 10024 RTP/AVP 0 101 
a=rtpmap:0 PCMU/8000 
a=rtpmap:101 telephone-event/8000 
a=fmtp:101 0-16 
a=ptime:20 
a=sendrec 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 98  – 8 August 2015 
Hacking SIP Trust Relationships 
Send INVITE/MESSAGE requests with 
• IP spoofing (source is Brisbane), 
• from field contains Spoofed IP and Port, 
the caller ID will be your trusted host. 
Universal 
Trust 
Tatooine 
192.168.1.146 
Melbourne 
192.168.1.202 
Brisbane 
192.168.1.145 - Sydney 
Production SIP Service 
UDP Trust 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 99  – 8 August 2015 
Attacking a client using SIP trust 
Universal 
Trust 
Tatooine 
It’s a TRAP! 
Send INVITE/MESSAGE requests with 
• IP spoofing (source is Brisbane), 
• from field contains special number, 
you will have fun or voicemail access. 
192.168.1.146 
Melbourne 
192.168.1.202 
Brisbane 
192.168.1.145 - Sydney 
Production SIP Service 
UDP Trust 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 100  – 8 August 2015 
Hacking SIP Trust – Business Impact 
• Denial of Service 
• Calling all numbers at same time  
• Overloading SIP server's call limits 
• Overloading VAS service or international limits 
• Overloading CDR records with spoofed calls 
• Short Message Service and Billing Attacks 
• Attacking Server Software 
• Crashing/exploiting inaccessible features 
• Call redirection (working on it, not yet :/) 
• Attacking a Client? 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 101  – 8 August 2015 
Fuzzing 
• Fuzzing as a SIP Client | SIP Server | Proxy | MITM 
• SIP Server Software 
• SIP Clients  
• Hardware devices, IP phones, Video Conference systems 
• Desktop application or web based software 
• Mobile software 
• Special SIP Devices/Software 
• SIP firewalls, ACL devices, proxies 
• Connected SIP trunks, 3rd party gateways 
• MSAN/MGW 
• Logging software (indirect) 
• Special products: Cisco, Alcatel, Avaya, ZTE... 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 102  – 8 August 2015 
Old School Fuzzing vs Smart Fuzzing 
• Request Fuzzing 
• SDP features 
• MIME type fuzzing 
• Response Fuzzing  
• Authentication, Bogus Messages, Redirection 
• Static vs Stateful  
• How about Smart Fuzzing 
• Missing state features (ACK,PHRACK,RE-INVITE,UPDATE) 
• Fuzzing after authentication (double account, self-call) 
• Response fuzzing (before or after authentication) 
• Missing SIP features (IP spoofing for SIP trunks, proxy headers) 
• Numeric fuzzing for services is NOT memory corruption 
• Dial plan fuzzing, VAS fuzzing  
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 103  – 8 August 2015 
Demonstration for the SIP attacks 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 104  – 8 August 2015 
Exercises  
• SIP Proxy Bounce Attack 
• SIP Trust Relationship Hacking 
• Sending malicious SMSes 
• Sending malicious calls 
• DoS and DDoS Tests 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 105  – 8 August 2015 
Solutions 
• Use SIP over TCP or SCTP 
• Enable the Transport Layer Security (TLS) 
• Do not use IP based SIP trunks 
• OAuth for SIP 
• Session tokens in the SIP headers 
• Digital certificate based authentication 
• Implement input validation for SIP headers 
• Customise the error messages 
• Don’t proxy the unauthorised IPs and Domains 
• Don’t accept proxy headers on client requests 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 106  – 8 August 2015 
Skinny Signalling 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 107  – 8 August 2015 
Attacking Skinny services 
• Cisco Skinny (SCCP) 
• Binary, not plain text 
• Different versions 
• No authentication 
• MAC address is identity 
• Auto registration 
• Basic attacks 
• Register as a phone 
• Disconnect other phones 
• Call forwarding 
• Unauthorised calls  
Source: Cisco 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 108  – 8 August 2015 
Attacking Skinny services 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 109  – 8 August 2015 
Attacking Skinny services 
• Viproy has a Skinny library for easier 
development and sample attack modules 
• Skinny auto registration 
• Skinny register 
• Skinny call 
• Skinny call forwarding 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 110  – 8 August 2015 
Attacking Skinny services 
Register                          Unauthorised Call 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 111  – 8 August 2015 
Preparing a proper client for Skinny 
• Install Cisco IP Communicator 
• Set “Use this Device Name” for Spoofed MAC 
• Register the software 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 112  – 8 August 2015 
Demonstration of Skinny attacks 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 113  – 8 August 2015 
Exercises  
• Cisco Skinny register tests 
• Cisco Skinny call tests 
• Cisco Skinny call forwarding 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 114  – 8 August 2015 
Solutions 
• Implement the secure deployment of 
Cisco 
• Digital certificate based authentication 
• Signature for updates and configuration files 
• Encrypt the configuration files 
• Don’t allow concurrent connections 
• Install the IP phone and software updates 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 115  – 8 August 2015 
Media Transport Security 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 116  – 8 August 2015 
Media Transport Essentials 
• Media transport is essential for the VoIP 
communications (audio and video) . 
• RTP is the major protocol in use for decades. 
• Real-time Transfer Protocol (RTP) 
• Highly vulnerable to MITM attacks 
• Encryption is not enabled on many implementations 
• It can be recorded and decoded easily 
• Codecs may change based on the implementation 
• DTMF tones are coded separately as RTP events 
• RTP Control Protocol (RTCP) may be in use for 
monitoring and QoS  
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 117  – 8 August 2015 
Plan & Goals 
Plan 
• Performing the MITM attacks 
• Obtaining unauthorised access to the media 
transport 
• Decoding the RTP stream to extract the raw 
audio/video of the conversation 
Goals 
• Eavesdropping 
• Injection audio or video to the conversations 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 118  – 8 August 2015 
Media Transport Flow 
SIP Server 
1- REGISTER 
1- 200 OK 
2- INVITE 
3- INVITE 
3- 183 Trying 
3- 200 OK 
4- ACK 
RTP 
Proxy 
RTP 
Phone A 
Phone B 
RTP 
4- 200 OK 
RTP 
RTP 
Proxy 
RTP 