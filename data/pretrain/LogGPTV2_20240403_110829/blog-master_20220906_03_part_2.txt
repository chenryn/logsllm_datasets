 2015-10-30 | 12.44 | 10.8264 |              14.02 | 102500 | 117777.02 |     15277.02 |       387  
 2015-11-02 | 12.09 | 10.8325 |              10.84 | 103000 | 114956.59 |     11956.59 |       390  
 2015-11-03 | 12.39 | 10.8400 |              13.31 | 103500 | 118298.83 |     14798.83 |       391  
 2015-11-04 | 12.88 | 10.8499 |              17.38 | 104000 | 123459.71 |     19459.71 |       392  
 2015-11-05 | 12.88 | 10.8596 |              17.24 | 104500 | 123942.30 |     19442.30 |       393  
 2015-11-06 | 13.39 | 10.8716 |              21.41 | 105000 | 129322.96 |     24322.96 |       394  
 2015-11-09 | 14.25 | 10.8876 |              28.32 | 105500 | 138081.01 |     32581.01 |       397  
 2015-11-10 | 14.69 | 10.9056 |              31.74 | 106000 | 142783.97 |     36783.97 |       398  
 2015-11-11 | 15.15 | 10.9255 |              35.28 | 106500 | 147679.84 |     41179.84 |       399  
 2015-11-12 | 14.81 | 10.9436 |              32.16 | 107000 | 144802.76 |     37802.76 |       400  
...  
 2015-12-08 |  15.4 | 11.2300 |              31.74 | 116000 | 159074.52 |     43074.52 |       426  
 2015-12-09 | 15.09 | 11.2465 |              29.14 | 116500 | 156313.64 |     39813.64 |       427  
 2015-12-10 |  15.2 | 11.2634 |              29.74 | 117000 | 157891.67 |     40891.67 |       428  
 2015-12-11 | 15.06 | 11.2796 |              28.45 | 117500 | 156880.92 |     39380.92 |       429  
 2015-12-14 | 15.28 | 11.2965 |              29.73 | 118000 | 159610.14 |     41610.14 |       432  
 2015-12-15 | 15.41 | 11.3139 |              30.45 | 118500 | 161402.16 |     42902.16 |       433  
 2015-12-16 | 15.68 | 11.3322 |              32.19 | 119000 | 164656.07 |     45656.07 |       434  
 2015-12-17 | 15.83 | 11.3510 |              33.03 | 119500 | 166652.92 |     47152.92 |       435  
 2015-12-18 | 15.84 | 11.3698 |              32.84 | 120000 | 167180.46 |     47180.46 |       436  
 2015-12-21 | 16.55 | 11.3912 |              37.57 | 120500 | 175070.86 |     54570.86 |       439  
 2015-12-22 | 17.03 | 11.4145 |              40.72 | 121000 | 180526.68 |     59526.68 |       440  
```  
```  
     c1     | price |  round  | revenue_year_ratio | invest |  v_value  | v_make_money | keep_days   
------------+-------+---------+--------------------+--------+-----------+--------------+-----------  
 2017-09-26 | 17.22 | 12.1651 |              13.98 | 328500 | 465000.50 |    136500.50 |      1084  
(1 row)  
```  
- 600719 | ST热电  
```  
 2015-11-06 | 14.57 |  9.5301 |              48.87 |  65500 | 100139.28 |     34639.28 |       394  
 2015-11-09 | 14.32 |  9.5664 |              45.57 |  66000 |  98796.16 |     32796.16 |       397  
 2015-11-10 | 14.17 |  9.6010 |              43.53 |  66500 |  98146.78 |     31646.78 |       398  
 2015-11-11 | 14.46 |  9.6372 |              45.66 |  67000 | 100528.79 |     33528.79 |       399  
 2015-11-12 | 14.14 |  9.6706 |              42.07 |  67500 |  98696.12 |     31196.12 |       400  
 2015-11-13 | 13.44 |  9.6983 |              35.03 |  68000 |  94234.99 |     26234.99 |       401  
 2015-11-16 | 14.16 |  9.7309 |              41.02 |  68500 |  99678.59 |     31178.59 |       404  
 2015-11-17 | 14.28 |  9.7638 |              41.58 |  69000 | 100915.21 |     31915.21 |       405  
 2015-11-18 |  14.7 |  9.7994 |              44.85 |  69500 | 104256.89 |     34756.89 |       406  
 2015-11-19 |  15.0 |  9.8365 |              46.96 |  70000 | 106745.29 |     36745.29 |       407  
 2015-11-20 | 16.11 |  9.8810 |              56.26 |  70500 | 114943.41 |     44443.41 |       408  
 2015-11-23 |  15.9 |  9.9234 |              53.36 |  71000 | 113761.64 |     42761.64 |       411  
 2015-11-24 | 15.31 |  9.9610 |              47.46 |  71500 | 109894.55 |     38394.55 |       412  
 2015-11-25 |  16.2 | 10.0044 |              54.60 |  72000 | 116588.99 |     44588.99 |       413  
 2015-11-26 | 16.19 | 10.0470 |              53.78 |  72500 | 116828.01 |     44328.01 |       414  
 2015-11-27 | 15.22 | 10.0825 |              44.71 |  73000 | 110197.25 |     37197.25 |       415  
...  
 2017-04-06 | 10.18 |  8.3120 |               8.99 | 237500 | 290875.38 |     53375.38 |       911  
 2017-04-07 | 10.02 |  8.3156 |               8.19 | 238000 | 286782.60 |     48782.60 |       912  
 2017-04-10 | 10.18 |  8.3195 |               8.91 | 238500 | 291836.89 |     53336.89 |       915  
 2017-04-11 | 10.05 |  8.3231 |               8.26 | 239000 | 288588.52 |     49588.52 |       916  
 2017-04-12 |  9.62 |  8.3258 |               6.18 | 239500 | 276728.84 |     37228.84 |       917  
 2017-04-13 |  9.67 |  8.3286 |               6.40 | 240000 | 278654.14 |     38654.14 |       918  
 2017-04-14 |  9.41 |  8.3309 |               5.14 | 240500 | 271653.47 |     31153.47 |       919  
 2017-04-17 |  9.47 |  8.3332 |               5.39 | 241000 | 273876.26 |     32876.26 |       922  
 2017-04-18 |   9.3 |  8.3352 |               4.57 | 241500 | 269453.08 |     27953.08 |       923  
 2017-04-19 |   8.9 |  8.3364 |               2.67 | 242000 | 258361.41 |     16361.41 |       924  
 2017-04-20 |   8.7 |  8.3371 |               1.72 | 242500 | 253054.59 |     10554.59 |       925  
```  
```  
     c1     | price | round  | revenue_year_ratio | invest |  v_value  | v_make_money | keep_days   
------------+-------+--------+--------------------+--------+-----------+--------------+-----------  
 2017-04-06 | 10.18 | 8.3120 |               8.99 | 237500 | 290875.38 |     53375.38 |       911  
(1 row)  
```  
## 注意, 定投的止盈点计算方法  
前面例子计算年化收益的方法实际上是不准确的, 因为不是每一笔钱都和第一笔一样投入了 `(c1-start_c1+1)/365.0` 年.   
实际年化收益大约是2倍于以上算法:    
```  
-- 年化收益率     
round(100 * ((price-cost_avg)/cost_avg) / ((c1-start_c1+1)/365.0), 2) as revenue_year_ratio,   
```  
为什么呢?   
假设每天投入100元, 按日计息, 一笔钱存1年的年化收益为5%.    
1年后实际得到的利息为:     
```  
postgres=# select sum(500), -- 总投入   
sum(500)*0.05,   -- 第一天就全部存入的年化收益   
sum(500*0.05*(during/365.0))  -- 每天定投的年化收益   
from generate_series(1,365) as during;  
  sum   | ?column? |             sum               
--------+----------+-----------------------------  
 182500 |  9125.00 | 4575.0000000000000000000000  
(1 row)  
```  
得到结果:  
- 1年共投入 182500  
- 如果第一天一次性投入 182500, 那么利息是 9125  
- 如果是每天投入 500, 那么利息是 4575  
```  
postgres=# select 9125.00/4575.0;   
      ?column?        
--------------------  
 1.9945355191256831  
(1 row)  
```  
所以, 定投的实际年化利息目标大概应该设置为一把梭哈的一半左右.    
定投的止盈点正确计算方法   
例如你期望的年化收益是10%, 那么按本文提供的算法, 定投的止盈点应该设置为5%就卖出.    
如果再考虑复利, 那么止盈点是动态变化的, 例如未考虑复利的止盈点是5%, 那么考虑复利则和持有年限有关.   
```
postgres=# select (1.05^5 - 1)/5;
        ?column?        
------------------------
 0.05525631250000000000  -- 持有5年, 考虑复利止盈点 ~= 5.5% 
(1 row)
postgres=# select (1.05^10 - 1)/10;
        ?column?        
------------------------
 0.06288946267774414000  -- 持有10年, 考虑复利止盈点 ~= 6.3% 
(1 row)
```
#### [期望 PostgreSQL 增加什么功能?](https://github.com/digoal/blog/issues/76 "269ac3d1c492e938c0191101c7238216")
#### [PolarDB for PostgreSQL云原生分布式开源数据库](https://github.com/ApsaraDB/PolarDB-for-PostgreSQL "57258f76c37864c6e6d23383d05714ea")
#### [PostgreSQL 解决方案集合](https://yq.aliyun.com/topic/118 "40cff096e9ed7122c512b35d8561d9c8")
#### [德哥 / digoal's github - 公益是一辈子的事.](https://github.com/digoal/blog/blob/master/README.md "22709685feb7cab07d30f30387f0a9ae")
![digoal's wechat](../pic/digoal_weixin.jpg "f7ad92eeba24523fd47a6e1a0e691b59")
#### [PolarDB 学习图谱: 训练营、培训认证、在线互动实验、解决方案、生态合作、写心得拿奖品](https://www.aliyun.com/database/openpolardb/activity "8642f60e04ed0c814bf9cb9677976bd4")
#### [购买PolarDB云服务折扣活动进行中, 55元起](https://www.aliyun.com/activity/new/polardb-yunparter?userCode=bsb3t4al "e0495c413bedacabb75ff1e880be465a")
#### [About 德哥](https://github.com/digoal/blog/blob/master/me/readme.md "a37735981e7704886ffd590565582dd0")