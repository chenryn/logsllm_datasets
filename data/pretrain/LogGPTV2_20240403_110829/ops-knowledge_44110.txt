User: Please answer the question How to use prometheus to monitor Kubernetes? How to configure
Assistant: 1. Install Prometheus You can download the binary file from the Prometheus official website, or use the package manager to install it. For example, on a CentOS system you can use the following command to install: ``` $ sudo yum install wget $ sudo tar -xzf prometheus-2.30.3.linux-amd64.tar.gz $ sudo mv prometheus-2.30.3.linux-amd64 /usr/local/prometheus ``` 2. Configure Prometheus Add the following content to the Prometheus configuration file to periodically collect metrics from kube-state-metrics: ``` - job_name: 'kubernetes-pods' kubernetes_sd_configs: - role: pod relabel_configs: - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape] action: keep regex: true - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path] action: replace target_label: __metrics_path__ regex: ( .+) - source_labels: [__address__, __meta_kubernetes_pod_annotation_prometheus_io_port] action: replace target_label: __address__ regex: ( .+):(?:\\d+);(\\d+) replacement: $1:$2 - action: labelmap regex: __meta_kubernetes_pod_label_(.+) - source_labels: [__meta_kubernetes_namespace] action: replace target_label: kubernetes_namespace - source_labels: [__meta _kubernetes_pod_name ] action: replace target_label: kubernetes_pod_name ``` 3. Install kube-state-metrics kube-state-metrics is an official component used to collect Kubernetes state information. Binaries can be downloaded from the kube-state-metrics GitHub repository, or installed using a package manager. For example, on a CentOS system, you can use the following command to install: ``` $ sudo yum install kube-state-metrics ``` 4. Configure Kubernetes Create a ServiceMonitor object in Kubernetes to tell Prometheus which services to monitor. For example, to monitor a Deployment named myapp: ``` apiVersion: monitoring.coreos.com/v1 kind: ServiceMonitor metadata: name: myapp-monitor labels: team: frontend spec: selector: matchLabels: app: myapp endpoints: - port : web path: /metrics ``` 5. Configure Prometheus and Grafana Configure data sources and dashboards in Prometheus and Grafana to display collected metrics and graphs.