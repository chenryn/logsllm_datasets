EDB Postgres Replication Server User’s Guide
Note: The preceding example assumes the publication server and the subscription server
are running on the same host, hence the single entry for database edb. If the publication
server and subscription server are running on separate hosts, then the pg_hba.conf file
on the publication database server would look like the following:
# TYPE DATABASE USER ADDRESS METHOD
# "local" is for Unix domain socket connections only
local all all md5
# IPv4 local connections:
host edb pubuser 192.168.2.22/32 md5
host edb pubuser 192.168.2.24/32 md5
host all all 127.0.0.1/32 md5
# IPv6 local connections:
host all all ::1/128 md5
# Allow replication connections from localhost, by a user with the
# replication privilege.
#local replication enterprisedb md5
#host replication enterprisedb 127.0.0.1/32 md5
#host replication enterprisedb ::1/128 md5
In addition, the preceding examples assume publication database edb is using the trigger-
based method of synchronization replication. If the log-based method is used, the
pg_hba.conf file must contain an additional entry with the DATABASE field set to
replication for pub_dbname, pub_dbuser, and pub_ipaddr to allow replication
connections from the publication server on the host on which it is running.
The following shows a modification of the preceding example with this additional entry
as the last line in the file:
# TYPE DATABASE USER ADDRESS METHOD
# "local" is for Unix domain socket connections only
local all all md5
# IPv4 local connections:
host edb pubuser 192.168.2.22/32 md5
host edb pubuser 192.168.2.24/32 md5
host all all 127.0.0.1/32 md5
# IPv6 local connections:
host all all ::1/128 md5
# Allow replication connections from localhost, by a user with the
# replication privilege.
#local replication enterprisedb md5
#host replication enterprisedb 127.0.0.1/32 md5
#host replication enterprisedb ::1/128 md5
host replication pubuser 192.168.2.22/32 md5
See sections 2.2.10 and 5.1.2 for additional information on synchronization replication
with the log-based method.
Reload the configuration file after making the modifications.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 161
EDB Postgres Replication Server User’s Guide
Choose Reload Configuration (Expert Configuration, then Reload Configuration on
Advanced Server) from the Postgres application menu. This will put the modified
pg_hba.conf file into effect.
Postgres Subscription Database
For a Postgres subscription database, the following entries are needed to allow access to
the subscription database:
host sub_dbname sub_dbuser pub_ipaddr/32 md5
host sub_dbname sub_dbuser sub_ipaddr/32 md5
The values you substitute for sub_dbuser and sub_dbname are the subscription
database user name and the subscription database name you created in steps 1 and 2 of
Section 5.1.5.1.
For a Postgres subscription database named subdb, the resulting pg_hba.conf file
appears as follows:
# TYPE DATABASE USER ADDRESS METHOD
# "local" is for Unix domain socket connections only
local all all md5
# IPv4 local connections:
host subdb subuser 192.168.2.22/32 md5
host all all 127.0.0.1/32 md5
# IPv6 local connections:
host all all ::1/128 md5
# Allow replication connections from localhost, by a user with the
# replication privilege.
#local replication enterprisedb md5
#host replication enterprisedb 127.0.0.1/32 md5
#host replication enterprisedb ::1/128 md5
Note: The preceding example assumes that the publication server and the subscription
server are running on the same host hence, only one entry is needed for database subdb.
If the publication server and subscription server are running on separate hosts, then the
pg_hba.conf file on the subscription database server looks like the following:
# TYPE DATABASE USER ADDRESS METHOD
# "local" is for Unix domain socket connections only
local all all md5
# IPv4 local connections:
host subdb subuser 192.168.2.22/32 md5
host subdb subuser 192.168.2.24/32 md5
host all all 127.0.0.1/32 md5
# IPv6 local connections:
host all all ::1/128 md5
# Allow replication connections from localhost, by a user with the
# replication privilege.
#local replication enterprisedb md5
#host replication enterprisedb 127.0.0.1/32 md5
#host replication enterprisedb ::1/128 md5
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 162
EDB Postgres Replication Server User’s Guide
Reload the configuration file after making the modifications.
Choose Reload Configuration (Expert Configuration, then Reload Configuration on
Advanced Server) from the Postgres application menu. This will put the modified
pg_hba.conf file into effect.
5.2 Creating a Publication
Creating your first publication requires the following steps:
 Registering the publication server
 Adding the publication database
 Creating a publication by choosing the tables and views for the publication along
with creating any optional filter clauses
Once the publication database has been added, as many publications can be created as
there are available tables and views that are readable by the publication database user and
that meet the criteria outlined in sections 2.4.2 and 2.4.3.
5.2.1 Registering a Publication Server
When you register a publication server, you are identifying the network location, admin
user name, and password of a specific, running, publication server instance that you want
to use to manage all aspects of the publications you will be creating subordinate to it.
It is important that you record the login information for the publication server as you
must always use this same publication server instance to manage all publications created
subordinate to it as represented in the xDB Replication Console replication tree.
Step 1: Start the publication server if it is not already running.
Note: If you are using Oracle publication or subscription databases, and the publication
server has not been restarted since copying the Oracle JDBC driver to the lib/jdbc
subdirectory of your xDB Replication Server installation, you must restart the publication
server.
For Linux only: You can verify the publication server is running by using the
systemctl command for CentOS 7 or RHEL 7, and the service command for
previous Linux versions.
Use the following command for CentOS 7 or RHEL 7:
systemctl status edb-xdbpubserver
Use the following command for previous Linux versions:
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 163
EDB Postgres Replication Server User’s Guide
service edb-xdbpubserver status
If the publication server is running and you wish to restart it, use the restart option.
For CentOS 7 or RHEL 7:
systemctl restart edb-xdbpubserver
For previous Linux versions:
service edb-xdbpubserver restart
If the publication server is not running, use the start option.
For CentOS 7 or RHEL 7:
systemctl start edb-xdbpubserver
For previous Linux versions:
service edb-xdbpubserver start
Similarly, use the stop option to stop the publication server.
For Windows only: Open Control Panel, System and Security, Administrative Tools,
and then Services. The publication server runs as a service named Publication
Service for xDB Replication Server.
Figure 5-1 - Windows publication service
Use the Start or Restart link for the service.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 164
EDB Postgres Replication Server User’s Guide
If the publication server fails to start, see Section 10.3.2.4 for information.
Step 2: Register the publication server. Open the xDB Replication Console from the
system’s application menu. For xDB Replication Server installed from an xDB RPM
package, the xDB Replication Console is started by invoking the script
XDB_HOME/bin/runRepConsole.sh.
Figure 5-2 - xDB Replication Console menu option
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 165
EDB Postgres Replication Server User’s Guide
Figure 5-3 - xDB Replication Console
Step 3: Select the top level Replication Servers node. From the File menu, choose
Publication Server, and then choose Register Server. Alternatively, click the secondary
mouse button on the Replication Servers node and choose Register Publication Server.
The Register Publication Server dialog box appears.
Enter the values you supplied during the installation of xDB Replication Server unless
otherwise specified.
 Host. Network IP address of the host running the publication server. This is the
network IP address used for pub_ipaddr in the pg_hba.conf file in Section
5.1.6.3. (Do not use localhost for this field.)
 Port. Port number the publication server is using. This is the port number you
specified on the Publication Server Details screen in Step 16 of Section 3.1.
 User Name. Admin user name that is used to authenticate your usage of this
publication server. This is the user name you specified on the xDB Admin User
Details screen in Step 15 of Section 3.1.
 Password. Password of the admin user given in the User Name field.
 Save login information. Check this box if you do not want to re-register the
publication server each time you open the xDB Replication Console. See Section
4.2 for additional information on the advantages and disadvantages of saving
server login information.
Note: The user name and password combination you enter is authenticated against the
admin user name and password in the xDB Replication Configuration file residing on the
host with the IP address you enter in the Host field.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 166
EDB Postgres Replication Server User’s Guide
Figure 5-4 - Register Publication Server dialog box
Click the Register button after you have filled in the fields. A Publication Server node
appears in the replication tree of the xDB Replication Console. Expand the Publication
Server node to expose the SMR and MMR type nodes.
Figure 5-5 – Replication tree after registering a publication server
Continue to build the single-master replication system under the SMR type node.
5.2.2 Adding a Publication Database
The database in which publications are to reside must be identified to xDB Replication
Server. This is done by creating a publication database definition.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 167
EDB Postgres Replication Server User’s Guide
After the publication database definition is created, a Publication Database node
representing that publication database definition appears in the replication tree of the
xDB Replication Console. Publications that are to contain tables and views residing
within this database can then be created under the Publication Database node.
You must enter database connection information such as the database server network
address, database identifier, and database login user name and password when you create
the publication database definition. The connection information is used by the publication
server to access the publication tables and views when it performs replication.
Step 1: Make sure the database server in which the publication database resides is
running and accepting client connections.
Step 2: Select the SMR type node under the Publication Server node. From the
Publication menu, choose Publication Database, and then choose Add Database.
Alternatively, click the secondary mouse button on the SMR type node and choose Add
Database. The Publication Service – Add Database dialog box appears.
Step 3: Fill in the following fields:
 Database Type. Select Oracle, SQL Server, PostgreSQL, or Postgres Plus
Advanced Server for the type of publication database. For an Advanced Server
Oracle compatible installation, select the Postgres Plus Advanced Server option.
For PostgreSQL or an Advanced Server PostgreSQL compatible installation,
select the PostgreSQL option.
 Host. IP address of the host on which the publication database server is running.
 Port. Port on which the publication database server is listening for connections.
 User. The publication database user name created in Step 1 of Section 5.1.4.
 Password. Password of the database user.
 Service ID (For Oracle). Enter the Oracle System Identifier (SID) of the Oracle
instance running the publication database if the SID radio button is selected. Enter
the net service name of a connect descriptor as defined in the TNSNAMES.ORA file
if the Service Name radio button is selected. Note (For Oracle 12c Pluggable
Database): Use the service name.
 Database (For Postgres or SQL Server). Enter the Postgres or SQL Server
database name.
 URL Options (For SSL connectivity). Enter the URL options to establish SSL
connectivity to the publication database. See Section 7.11 for information on
using SSL connections.
 Changeset Logging (For Postgres). Select Table Triggers to use the trigger-
based method of synchronization replication. Select WAL Stream to use the log-
based method of synchronization replication. See Section 2.2.9 for information on
the trigger-based method. See Section 2.2.10 for information on the log-based
method.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 168
EDB Postgres Replication Server User’s Guide
Figure 5-6 - Publication Service - Add Database dialog box
Note: If the controller database is an Oracle or a SQL Server publication database, then a
second Oracle or SQL Server publication database cannot be added to create a second
single-master replication system. In order for xDB Replication Server to run more than
one single-master replication systems consisting of Oracle or SQL Server publication
databases, a Postgres publication database must be designated as the controller database.
See Section 2.3.1.12 for information on the controller database.
The following is the Publication Service – Add Database dialog box for a Postgres
database that shows the Changeset Logging option for selecting either the trigger-based
method or the log-based method of synchronization replication.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 169
EDB Postgres Replication Server User’s Guide
Figure 5-7 - Publication Service - Add Database dialog box for Postgres
Step 4: Click the Test button. If Test Result: Success appears, click the OK button, then
click the Save button.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 170
EDB Postgres Replication Server User’s Guide
Figure 5-8 - Successful publication database test
If an error message appears investigate the cause of the error, correct the problem, and
repeat steps 1 through 4.
When the publication database definition is successfully saved, a Publication Database
node is added to the replication tree under the Publication Server node.
Figure 5-9 – Replication tree after adding a publication database
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 171
EDB Postgres Replication Server User’s Guide
For Oracle only: Multiple Oracle databases can be added as publication databases by
completing the Add Database dialog box for each database. It is also permissible to add
the same Oracle database as two or more distinct publication database definitions if you
use different publication database user names for each publication database definition.
For Postgres or SQL Server: Multiple Postgres or SQL Server databases can be added
as publication databases by completing the Add Database dialog box for each database.
However, unlike Oracle, a given Postgres or SQL Server database can only be added
once as a publication database definition.
5.2.3 Adding a Publication
Subordinate to a publication database definition, you create publications that contain
tables and views of the database identified in the publication database definition.
Step 1: Select the Publication Database node. From the Publication menu, choose Create
Publication. Alternatively, click the secondary mouse button on the Publication Database
node and choose Create Publication. The Create Publication dialog box appears.
Step 2: Fill in the following fields under the Create Publication tab:
 Publication Name. Enter a name that is unique amongst all publications.
 Snapshot-only replication. Check the box if replication is to be done by snapshot
only. Tables included in a snapshot-only publication do not require a primary key.
Tables included in publications on which synchronization replication is to be used
must have primary keys.
 Publish. Check the boxes next to the tables that are to be included in the
publication. If the Snapshot-Only Replication box is checked, then views appear
in the Publish list as well. Alternatively or in addition, click the Use Wildcard
Selection button to use wildcard pattern matching for selecting publication tables.
 Select All. Check this box if you want to include all tables and views in the
Available Tables list in the publication.
 Use Wildcard Selection. Click this button to use the wildcard selector to choose
tables for the publication. See Section 7.1 for information on the wildcard
selector.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 172
EDB Postgres Replication Server User’s Guide
Figure 5-10 - Create Publication dialog box
If you wish to use table filters during replications from this publication, follow the
directions in the next step to define the initial set of available table filters, otherwise go
on to Step 4.
Step 3 (Optional): Table filters consist of a set of filter rules that control the selection
criteria for rows replicated to the subscription tables during a snapshot or a
synchronization replication.
Note: See Section 2.2.12.3 for table setup requirements for a log-based replication
system as well as general restrictions on the use of table filters.
A filter rule consists of a filter name and a SQL WHERE clause (omitting the WHERE
keyword) called the filter clause, which you specify for a table or view that defines the
selection criteria for rows that are to be included during a replication.
Multiple filter rules may be defined for each table or view in the publication. If no filter
rule is defined for a given table or view, then no filtering can be later enabled on a
corresponding subscription table associated with that publication table.
After filter rules have been defined for a publication table or view, you can later choose
whether or not to enable those filter rules on any subscription that you associate with that
publication in accordance with the following rules.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 173
EDB Postgres Replication Server User’s Guide
 At most one filter rule can be enabled on a given table in a given subscription.
 The same filter rule may be enabled on the same given table in several, different
subscriptions.
 Different filter rules may be enabled on the same given table but in different
subscriptions.
If you want to define table filters on the publication tables or views, click the Table
Filters tab. Select the table or view from the Table/View drop-down list for which you
wish to add a filter rule. Click the Add Filter button.