Capacity Planning
The number of NetBoot client computers your server can support depends on how 
your server is configured, when your clients routinely start up, the server’s hard disk 
space, and a number of other factors. When planning for your server and network 
needs, consider these factors:
• Ethernet speed:  100Base-T or faster connections are required for both client 
computers and the server. As you add more clients, you may need to increase the 
speed of your server’s Ethernet connections. Ideally you want to take advantage of 
the Gigabit Ethernet capacity built in to your Mac OS X server hardware to connect 
to a Gigabit switch. From the switch you should connect Gigabit Ethernet or 100 Mb 
Ethernet to each of the NetBoot clients.
• Hard disk capacity and number of images:  Boot and install images occupy hard disk 
space on server volumes, depending on the size and configuration of the system 
image and the number of images being stored. Images can be distributed across 
multiple volumes or multiple servers. For more information, see “Performance and 
Load Balancing” on page 45.
• Hard disk capacity and number of users:  If you have a large number of Mac OS 9 or 
Mac OS X diskless clients, consider adding a separate file server to your network to 
store temporary user documents. Because the system software for a disk image is 
written to a shadow image for each client booting from the disk image, you can get 
a rough estimate for the required hard disk capacity required by multiplying the size 
of the shadow image by the number of clients. 
• Number of Ethernet ports on the switch:  Distributing NetBoot clients over multiple 
Ethernet ports on your switch offers a performance advantage. Each port must serve 
a distinct segment.
LL2348.Book  Page 16  Thursday, August 21, 2003  10:58 AM
Chapter 1    About System Image Administration
17
Setup Overview
Here is an overview of the basic steps for setting up NetBoot service.
Step 1:  Evaluate and update your network, servers, and client computers as 
necessary
The number of client computers you can support using NetBoot is determined by the 
number of servers you have, how they’re configured, hard disk storage capacity, and 
other factors. See “Capacity Planning” on page 16.
Depending on the results of this evaluation, you may want to add servers or hard disks, 
add Ethernet ports to your server, or make other changes to your servers. You may also 
want to set up more subnets for your BootP clients, depending on how many clients 
you support.
You may also want to implement subnets on this server (or other servers) to take 
advantage of NetBoot filtering. See “Restricting NetBoot Clients by Filtering Addresses” 
on page 38.
If you plan to provide authentication and personalized work environments for NetBoot 
client users by using Workgroup Manager (Mac OS X clients) and Macintosh Manager 
(Mac OS 9 clients), you should set this up and import users from the Mac OS X Server 
Users & Groups database before you create disk images. Make sure you have at least 
one Macintosh Manager user assigned to the System Access workgroup for Mac OS 9 
clients and the Workgroup Manager for Mac OS X clients.
Step 2:  Create disk images for client computers
You can set up both Mac OS 9 disk images and Mac OS X disk images for client 
computers to start up from. A preconfigured Mac OS 9 image is supplied with 
Mac OS X Server on the NetBoot for Mac OS 9 CD, available separately. The Mac OS 9 
disk image can be modified. If you’re supporting new client computers that were 
released after Mac OS X Server version 10.0.3, you’ll need to modify the Mac OS 9 disk 
image to support the new clients. See “Modifying a Mac OS 9 Boot Image” on page 25. 
To create Mac OS X disk images, you use Network Image Utility. See “Creating a 
Mac OS X Boot Image” on page 19.
To create application packages that you can add to an image, use PackageMaker. 
Application software packages can be installed by themselves or along with Mac OS X 
system software. See “Creating Packages” on page 30.
Step 3:  Set up DHCP
NetBoot requires that you have a DHCP server running either on the local server or 
another server on the network. Make sure that you have a range of IP addresses 
sufficient to accommodate the number of clients that will be using NetBoot at the 
same time.
LL2348.Book  Page 17  Thursday, August 21, 2003  10:58 AM
18
Chapter 1    About System Image Administration
If your NetBoot server is also supplying DHCP service, you might get better 
performance if you configure your server as a gateway. That is, configure your subnets 
to use the server’s IP address as the router IP address.
Be sure DHCP service is started.
Step 4:  Configure and turn on NetBoot service
You use the NetBoot settings in Server Admin to configure NetBoot on your server. 
See Chapter 3, “Setting Up NetBoot Service.”
You turn on NetBoot service using Server Admin. See “Starting NetBoot and Related 
Services” on page 34 and “Enabling Images” on page 34.
Step 5:  Set up Ethernet address filtering (optional) 
NetBoot filtering is done by client computer hardware address. Each client’s 
hardware address is automatically registered the first time the client attempts to start 
up from a NetBoot disk image. You can allow or disallow specific clients by address. 
See “Restricting NetBoot Clients by Filtering Addresses” on page 38.
Step 6:  Test your NetBoot setup
Because there is risk of data loss or bringing down the network (by misconfiguring 
DHCP), it is recommended that you test your NetBoot setup before implementing it on 
all your clients. You should test each different model of Macintosh that you’re 
supporting. This is to make sure that there are no problems with the boot ROM for a 
particular hardware type. 
Step 7:  Set up all client computers to use NetBoot
When you’re satisfied that NetBoot is working on all types of client computers, then 
you can set up the client computers to start up from the NetBoot disk images. 
Clients running Mac OS 9:  Use the Startup Disk control panel to select a startup disk 
image on the server, then restart the computer. See “Selecting a NetBoot Boot Image 
(Mac OS 9)” on page 40.
Note:  You may have to update the Startup Disk control panel on client computers 
running Mac OS 9 from their local hard disks so they can view NetBoot disk images in 
the control panel. See “Updating the Startup Disk Control Panel” on page 39.
Clients running Mac OS X version 10.2 or later:  Use the Startup Disk System Preference 
pane to select a startup disk image on the server, then restart the computer. 
See “Selecting a NetBoot Boot Image (Mac OS X)” on page 40.
Any client:  Restart the computer and hold down the N key until the NetBoot icon starts 
flashing on the screen. The client starts up from the default image on the NetBoot 
server. See “Starting Up Using the N Key” on page 42.
LL2348.Book  Page 18  Thursday, August 21, 2003  10:58 AM
2
19
2 Creating Boot and Install Images
This chapter provides step-by-step instructions for 
preparing boot or install images that can be used with 
NetBoot service.
Creating Mac OS X Boot Images
The instructions in this section show how to create boot images of the Mac OS X 
operating system that you can use to start up client computers over the network. 
For help creating Mac OS 9 images, see “Creating Mac OS 9 Boot Images” on page 25.
Creating a Mac OS X Boot Image
You use Network Image Utility to create Mac OS X NetBoot images.
Note:  You must purchase an OS user license for each client that starts up from a 
NetBoot disk image.
To create a boot image:
1 Log in to the server as an administrative user.
2 Open Network Image Utility and click New Boot.
3 In the General pane, type a name for the image you’re creating.
This name will identify the image in the Startup Disk preferences pane on client 
computers.
4 Type an Image ID.
To create an image that is unique to this server, choose an ID in the range 1–4095.
To create one of several identical images to be stored on different servers for load 
balancing, use an ID in the range 4096–65535. Multiple images of the same type with 
the same ID in this range are listed as a single image in a client’s Startup Disk 
preferences panel.
5 (Optional) Type notes or other information that will help you characterize the image in 
the Description field. Clients can’t see what you type.
LL2348.Book  Page 19  Thursday, August 21, 2003  10:58 AM
20
Chapter 2    Creating Boot and Install Images
6 (CD source only) Choose the default language for the system. (Available only if you 
have already inserted the CD and chosen it as the source.)
7 Choose whether the image is to be delivered using NFS or HTTP.
If you’re not sure which to choose, choose NFS.
8 Click Contents and choose the source for the image.
You can choose an install CD, a mounted boot volume, or an existing disk image. 
If you’re creating the image from CDs, be sure it is inserted.
Important:  If you have created a standard disk image (.dmg file) from an OS install CD 
and want to use that image as the source for a NetBoot image, double-click the .dmg 
file in the Finder to mount the image, then choose it from the pop-up menu.
9 (Optional) Click the Add (+) button below the Other Items list to add an application 
package, system update package, or script to the image.
10 (CD source only) Click Default User, type a user name, short name, and password (in 
both the Password and Verify fields) for the system’s default user account. You can log 
in to a booted client using this account.
11 Click Create Image.
If the Create button is not enabled, make sure you have entered an image name and 
ID, chosen an image source, and entered a default user name with a password that is at 
least four characters long.
12 In the Save As dialog, choose where to save the image.
If you don’t want to use the image name you typed earlier, you can change it now by 
typing a new name in the Save As field.
If you’re creating the image on the same server that will serve it, choose a volume from 
the “Serve from NetBoot share point on” pop-up menu.
To save the image somewhere else, choose a location from the Where pop-up menu or 
click the triangle next to the Save As field and navigate to a folder.
13 Click Save.
To check progress, look in the lower-left corner of the window. If you need to insert 
another CD, you’ll be prompted there. To create the image without including the 
contents of a subsequent CD, click Finish when you are prompted to insert it.
Important:  Don’t open the .nbi folder in /Library/NetBoot/NetBootSPn while the image 
is being created; clients won’t be able to use the resulting image.
From the Command Line
You can also create a boot image using commands in Terminal. For more information, 
see the system image chapter of the command-line administration guide.
LL2348.Book  Page 20  Thursday, August 21, 2003  10:58 AM
Chapter 2    Creating Boot and Install Images
21
Installing the Classic Environment on a Mac OS X Disk Image
You can install the Classic environment onto a Mac OS X image by copying a 
Mac OS 9.2.2 system folder into an “unlocked” NetBoot image. You must also specify the 
Mac OS X image as the Classic startup volume and start the Classic environment from 
the image using the System 9 preference pane to complete the integration.
Don’t try to install the Classic environment onto Network Install images. This procedure 
works only for NetBoot images.
To install the Classic environment on a Mac OS X boot image:
1 Make sure the disk image file (.dmg) is unlocked. 
If there is a small lock on the file’s icon in the Finder (in /Library/NetBoot/NetBootSPn), 
log in to the server as the root user, select the image file, choose Get Info from the 
Finder’s File menu, and deselect the Locked checkbox.
2 Double-click the image file to mount it.
3 Drag a Mac OS 9 System Folder to the disk image.
You can use the System Folder from the NetBoot for Mac OS 9 CD (available separately) 
or use another Mac OS 9 version 9.2.2 System Folder that has been previously run as 
the Classic environment under Mac OS X.
4 In your server’s System Preferences, open the Classic preferences pane and select the 
disk image as the startup volume for the Classic environment.
5 Click Start to start up the Classic environment.
6 Shut down the Classic environment, then eject the image file.
Configuring Directory Access for a Boot Image
If you are not using DHCP to provide NetBoot clients with Open Directory information, 
you can set up directory access information and copy it to a boot image.
To add directory access information to a boot image:
1 Open Directory Access (in /Applications/Utilities) on a running system and configure 
directory settings as you want them for your booted clients.
2 Mount the boot image and copy the directory /Library/Preferences/DirectoryService/ 
from the running system you just configured into the same location in the boot image.
Warning:  Don’t modify a disk image that is in use by any NetBoot clients. Doing so 
will result in unpredictable behavior for the clients. Before modifying a disk image, 
make sure no one is using the image or make a copy of the file and modify the copy.
LL2348.Book  Page 21  Thursday, August 21, 2003  10:58 AM
22
Chapter 2    Creating Boot and Install Images
Adding an OS Update Package to a Mac OS X Boot Image
You can add a Mac OS X system update package to an existing NetBoot image so that 
your clients start up from the latest available system.
To apply a Mac OS X update to a NetBoot image:
1 Open Server Admin and select NetBoot in the Computers & Services list.
2 Disable the image you want to update to prevent access while you’re modifying it.
Click Settings, click Images, deselect Enabled for the image, and click Save.
3 Open Network Image Utility and click Images.
4 Select the image and click Edit.
5 In the Contents tab, click the Add (+) button and choose the OS update package.
6 Click Save.
7 Reenable the image in the Images pane of Server Admin NetBoot settings.
From the Command Line
You can also update a boot image using commands in Terminal. For more information, 
see the system image chapter of the command-line administration guide.
Creating a Mac OS X Boot Image From an Existing System
If you already have a client computer set up to suit your users, you can use Network 
Image Utility to create a boot image that is based on that client’s configuration.
You need to boot from a volume other than the one you’re using as the image source 
(boot from an external FireWire hard disk or a second partition on the client’s hard disk, 
for example). You can’t create the image on a volume over the network.
To create a boot image based on an existing system:
1 Boot the computer from a partition other than the one you’re using for the image 
source.
2 Copy the Network Image Utility to the client computer.
3 Open the Network Image Utility on the client and click New Boot.
4 Click the Contents tab and choose the partition you want to use from the Image Source 
pop-up list.
5 Enter the remaining image information in the other panes as usual, then click Create.
6 After the image has been created on the client, export it to the server.
Click Images, select the image in the list, and click Export.
From the Command Line
You can also create a boot image clone of an existing system using the hdiutil 
command in Terminal. For more information, see the system image chapter of the 
command-line administration guide.
LL2348.Book  Page 22  Thursday, August 21, 2003  10:58 AM
Chapter 2    Creating Boot and Install Images
23
Synchronizing an Image With an Updated Source Volume
If you create an image from a system volume and later update the original volume, you 
can automatically apply the updates to the image without re-creating it.
Important:  Be sure you synchronize the image with the correct original volume. The 
updated original volume must be a local volume on the server where the image is 
being edited.
To sync an image with an updated source volume:
1 Open Server Admin and select NetBoot in the Computers & Services list.
2 Disable the image you want to update to prevent access while you’re modifying it.
Click Settings, click Images, deselect Enabled for the image, and click Save.
3 Open the Network Image Utility (in /Applications/Server).
4 Choose Network Image Utility > Preferences, enable “Add items and sync with source 
when editing,” and close the preferences window.
5 Click Images, select the image, and click Edit.
6 Click Contents and choose the updated source volume from the Image Source pop-up 
menu.
7 Click Save.
8 Reenable the image using Server Admin.
Choosing the Protocol Used to Deliver an Image
You can use either NFS or HTTP to send images from the server to a client. You can 
choose this protocol when you create the image using the Network Image Utility or 
later when the image is listed in Server Admin.
To choose the protocol when you create the image, choose either NFS or HTTP in the 
General pane in the Network Image Utility.
To choose the protocol for an existing image, choose the NetBoot service in Server 
Admin, click Settings, and choose a protocol from the pop-up list next to the image in 
the Images pane.
From the Command Line
You can also change the delivery protocol by modifying the image’s 
NBImageInfo.plist file using Terminal. For more information, see the system image 
chapter of the command-line administration guide.
LL2348.Book  Page 23  Thursday, August 21, 2003  10:58 AM
24
Chapter 2    Creating Boot and Install Images
Compressing Images to Save Disk Space
You can create compressed images by setting a preference in the Network Image 
Utility.
To create compressed images:
1 Open Network Image Utility.
2 Choose Network Image Utility > Preferences and select “Compress image when 
creating or editing.”
Be sure the volume on which you’re creating the image has enough free space for both 
the uncompressed image and the compressed image.
From the Command Line
You can also compress images using the hdiutil command in Terminal. For more 
information, see the system image chapter of the command-line administration guide.
Changing How Mac OS X NetBoot Clients Allocate Shadow Files
By default, a Mac OS X NetBoot client places its shadow files in a NetBootClientsn share 
point on the server. If no such share point is available, the client tries to store its 
shadow files on a local hard disk.
For Mac OS X version 10.3 and later images set for diskless booting, you can change 
this behavior by using a text editor to specify a value for the NETBOOT_SHADOW variable 
in the image’s /etc/hostconfig file. These values are allowed:
Note:  This value is set in the /etc/hostconfig file in the image .dmg file, not in the 
server’s hostconfig file.
Value of NETBOOT_SHADOW
Client shadow file behavior
-NETWORK-
(Default) Try to use a server NetBootClientsn share point for storing 
shadow files. If no server share point is available, use a local drive.
-NETWORK_ONLY-
Try to use a server NetBootClientsn share point for storing shadow 
files. If no server share point is available, don’t boot.
-LOCAL-
Try to use a local drive for storing shadow files. If no local drive is 
available, use a server NetBootClientsn share point.
-LOCAL_ONLY-
Try to use a local drive for storing shadow files. If no local drive is 
available, don’t boot.
LL2348.Book  Page 24  Thursday, August 21, 2003  10:58 AM
Chapter 2    Creating Boot and Install Images
25
Creating Mac OS 9 Boot Images
You can’t use the Network Image Utility to create Mac OS 9 images. However, you can 
use the image provided on the NetBoot for Mac OS 9 CD (available separately).
Installing a Mac OS 9 Boot Image
To install the preconfigured Mac OS 9 disk image, log in as root, then open 
NetBoot.pkg on the NetBoot for Mac OS 9 CD (available separately).
The Installer installs the Mac OS 9 NetBoot image folder in the 
/Library/NetBoot/NetBootSPn/DefaultMacOS92.nbi directory (where n is 
the volume number).
Modifying a Mac OS 9 Boot Image
To install software on, or change, the preconfigured Mac OS 9 disk image, you need to 
start up from a NetBoot client computer, connect to the NetBoot server volume, and 
open the NetBoot Desktop Admin program. Your changes are not available to you or 
other users until after the last time the NetBoot client computer running NetBoot 
Desktop Admin restarts.
Before you start this procedure, be sure to have the name and password of a user with 
read/write access to the NetBoot server volume (for example, the administrator).
The following procedure requires that you restart the client computer several times. 