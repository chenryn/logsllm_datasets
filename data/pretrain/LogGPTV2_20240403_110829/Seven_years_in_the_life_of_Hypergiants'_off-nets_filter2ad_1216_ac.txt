Hypergiant’s fingerprint. To assign an IP to an AS we use standard
IP-to-AS mapping techniques described in Appendix A.1. We also
annotate HGs’ on-nets and off-nets as described in Appendix A.2.
4.6 Datasets
Certificate datasets. Rapid7 collects X.509 certificates observed
in IPv4-wide scans on port 443 [67]. We use datasets from once
every three months from Oct. 2013 to Apr. 2021, which include
127,812,006 unique certificates. We supplement with port 443 scans
from Censys [36] from Nov. 2019 to Apr. 2021. We exclude cer-
tificates that we cannot translate to the X.509 format and those
missing critical information.
HTTP(S) headers. We use the corpus of available HTTP(S) head-
ers from Rapid7 from Oct. 2013 to Apr. 2021.
List of hypergiants. We compile a list of HGs using previously
published surveys [18, 19, 32, 64, 112], then select the 23 that claim
on their website to have a CDN and for which we were able to iden-
tify a certificate with a matching Organization. Examined HGs:
Akamai, Alibaba, Amazon, Apple, Bamtech, Highwinds, CDN77,
Cachefly, Cdnetworks, Chinacache, Cloudflare, Disney, Facebook,
Fastly, Google, Hulu, Incapsula, Limelight, Microsoft, Netflix, Twit-
ter, Verizon and Yahoo.
5 VALIDATION
We find that our scans and measurement techniques are accurate,
then validate our results against information from Hypergiants
and results from earlier approaches, finding that our results are
trustworthy.
Comparison of Scanning Corpuses. Most results in our paper
rely on Rapid7 scans, and so we first evaluate its completeness
compared to Censys and an active scan we conducted (Nov. 21-25,
520
2019) of the entire publicly-routable non-bogon IPv4 address space
for SSL/TLS certificates on port 443. We use a modified version
of the certigo tool [97] to perform TLS handshakes with servers
to fetch their certificates. Our scan fetches 13,156,080 unique end-
entity certificates.
Table 2 compares our scan and Rapid7 and Censys scans from
November 2019. The number of IP addresses with certificates in
Rapid7 and Censys is very similar. However, our certigo scan
found around 20% more addresses, which we attribute to two causes.
First, both Rapid7 and Censys have to respond to complaints and
remove IP addresses from their scans [12, 29, 110]. As both scans
have run for years, more address space is excluded over time. A
second reason for this difference is that our scan took almost four
days to execute, which may trigger less rate limiting than the other,
faster scans.
However, when we turn our attention to the total number of
ASes that host at least one HG (column 6), the numbers across all
three datasets are very similar, as they are for the four Hypergiants
with the largest footprints (Google, Netflix, Facebook, and Akamai)
reported in the last four columns. Another observation is that the
number of IP addresses per HG is not relevant to the size or the
distribution of the corresponding HGs’ off-nets, as each HG has a
different strategy on how to assigns IP to servers [42]). We have
confirmed that some HGs have only a few front-end IP addresses
for multiple servers, and others have multiple IP addresses for one
server. For instance, in our active scan (Nov. 2019) we collected
Facebook certificates from 33,769 IP addresses in 1,708 off-net ASes.
At the same campaign, we collected Akamai certificates from many
more IP addresses (105,686) although Akamai’s off-net footprint is
smaller, with 1,194 off-net ASes. Thus, for the rest of the paper, we
will focus on the off-net AS footprint of each Hypergiant.
Ethical Considerations. In our scan, we remain “good Internet
citizens” by following best practices [37] to avoid triggering any
kind of alarm. We maintain a blacklist and use clients with appro-
priate rDNS names, websites, and abuse contacts. Therefore, this
work does not raise any ethical issues.
Active Measurement Validation. We provide additional valida-
tion of our inferences using active measurements. To accomplish
this we use the ZGrab2 [115] tool which provides rapid capture
of HTTP(S) banners including HTTP headers and TLS certificate
validation. We provide an input list of (IP address, domain) pairs
and ZGrab2 correctly sets the HTTP Host header and TLS SNI field
while performing a GET request for the default document.
In this analysis, we assert that, if we correctly infer a server to be
an off-net for a particular Hypergiant, it should not serve requests
for domains which the Hypergiant does not host (i.e. TLS validation
should fail). To test this, for each IP address that we inferred as an
off-net for a particular Hypergiant, we randomly select 10 other
Hypergiants and, for each, scan the IP address requesting one of
the 50 most popular domains served by the other Hypergiant. Sur-
prisingly, we found that only 89.7% of the inferred off-nets did not
validate for the randomly selected domains. Of the 10.3% that cor-
rectly validated requests, we inferred 97% as belonging to Akamai,
and the request domains (LinkedIn, KDDI, Disney) were for ones
known to be also served by third-party CDNs such as Akamai. This
result highlights a challenge in understanding the content delivery
SIGCOMM ’21, August 23–27, 2021, Virtual Event, USA
P. Gigis et al.
Scan
(abbreviation)
Date
Rapid7 (R7)
Censys (CS)
Certigo (AC)
Nov. 18, 2019
Nov. 19, 2019
Nov. 21-25, 2019
1,737
1,746
1,762
Table 2: Statistics for the three scan corpuses of certificates in our study in November 2019.
84
211
519
any
3,788
3,974
3,802
Google
3,137
3,355
3,149
Netflix
1,760
1,689
1,715
#IPv4 IPs
w/ certs
35,009,714
34,235,590
41,357,388
#ASes
w cert
57,769
58,183
59,178
1,235
1,248
1,236
#ASes
unique
# ASes w/ Hypergiant Certificates
Facebook Akamai
ecosystem: Large content providers may select a combination of
self-hosted and external CDNs for redundancy and additional ca-
pacity (§3). Nevertheless, Akamai is the exception in our analysis,
as it does not create its own content or have its own users, and its
platform delivers the content of other companies, very much like a
“cloud provider” for delivery of content.
In this analysis, we assert that servers outside of HG address
space should not serve HG domains unless we inferred them to
be off-nets. Using the November 2020 Rapid7 and Censys datasets,
we selected a random 25% sample out of 57 million IP addresses
with responsive web servers that we did not infer to be Hypergiant
on-nets. Then for each selected IP address, we select 10 random HG
domains as described in the previous analysis. From our random
sample, we found 0.1% (17,029) IP addresses in 844 ASes with valid
TLS responses. Of those, 98% were servers we had correctly inferred
as HG off-nets. We believe the remaining 2% are customer origins
of CDN-hosted sites.
Validation from Hypergiants. We surveyed HG operators fol-
lowing a similar approach to earlier work on mapping ISPs [98].
The survey questions are presented in Appendix A.4. Four HGs
replied to our request for validation, including some of the four
largest. All four agreed that the estimation of the off-net footprint is
very good. One HG operator indicated that 6% of ASes we identified
as hosting the HG’s off-nets were not on the HG’s list, and 11%
from the HG’s list were not uncovered by our technique (while
also indicating that the HG’s list may not be 100% correct). For
the other three HGs, we underestimated the HG footprint by 5%
(one HG) or around 10% (two HGs). Our technique may miss or
misidentify ASes hosting HG off-nets because of errors in IP-to-AS
mapping, because of ASes that have opted out of TLS scans (e.g.,
Table 2 shows that different scans reveal different coverage), or
because of churn between when we measure and when validation
was done. The off-nets we missed were in a mix of different types
of networks. Our results are in-line with Akamai’s public reports
for the duration of our study [4].
Comparison to Earlier Results. Our technique works over ex-
isting datasets, which enables the comparison of our results with
prior studies using different methodologies.
Google: We compare our results with the latest results from a pre-
viously published approach to uncovering Google off-nets [22],
which reported 1445 ASes hosting Google off-nets in April 2016.
Of the 1445 ASes, our approach identified 1421 (98%), while also
identifying an additional 283 (68 of which the earlier technique
identified prior to April 2016).
Facebook: To the best of our knowledge, the only previous work
which reports numbers for Facebook’s CDN belongs to a team
that participated in a hackathon [13] in March 2018 and posted
updated results in August 2018, in November 2019 [14], and in April
2021 [15]. The team mapped Facebook servers globally by guessing
Hyper-Giant Name
Google
Facebook
Netflix
Akamai
Alibaba
Cloudflare
Amazon
Cdnetworks
Limelight
1.
2.
3.
4.
5.
6.
7.
8.
9.
10. Apple
11. Twitter
Number of ASes with HG off-nets
2013/10
(only certs)
1044 (1105)
0 (8)
47 (143)
978 (1013)
0 (0)
0 (2)
0 (147)
0 (4)
0 (1)
0 (113)
0 (101)
Max
[Snapshot]
3810
2214
2115
1463
184
110*
112
51
42
6
4
[2021/04]
[2021/04]
[2021/04]
[2018/04]
[2018/01]