13.3.3 设置Paragraph和Run对象
12.9 公式 ........................................... 234 的样式 ............................. 255
12.10 调整行和列 ............................ 235
13.3.4 创建带有非默认样式的
12.10.1 设置行高和列宽 ........... 235 Word文档 ........................ 257
12.10.2 合并和拆分单元格 ....... 236 13.3.5 Run属性 .......................... 257
12.10.3 冻结窗格 ....................... 237 13.3.6 写入Word文档 ............... 258
12.10.4 图表 ............................... 238 13.3.7 添加标题 ......................... 260
12.11 小结 ......................................... 240 13.3.8 添加换行符和换页符 ..... 261
12.12 习题 ........................................ 240 13.3.9 添加图像 ......................... 261
12.13 实践项目 ................................ 241 13.4 小结 .......................................... 262
12.13.1 乘法表 ........................... 241
目 录
13.5 习题 ........................................... 262 第4步：类似程序的想法 ........... 277
13.6 实践项目 .................................. 263 14.6 小结 .......................................... 277
13.6.1 PDF偏执狂 ..................... 263 14.7 习题 .......................................... 277
13.6.2 定制邀请函，保存为Word 14.8 实践项目.................................. 277
文档 ................................. 263
第15章 保持时间、计划任务和启动
13.6.3 暴力PDF口令破解 程序 ............................................ 279
程序 ................................. 264 15.1 time模块 ................................. 279
第14章 处理CSV文件和JSON数据 .... 265 15.1.1 time.time()函数 ............... 279
14.1 csv模块 .................................... 265 15.1.2 time.sleep()函数 .............. 280
14.1.1 Reader对象 ..................... 266 15.2 数字四舍五入 ......................... 281
14.1.2 在for循环中，从Reader 15.3 项目：超级秒表 ..................... 282
对象读取数据 ................. 267 第1步：设置程序来记录时间 ..... 282
14.1.3 Writer对象 ...................... 268 第2步：记录并打印单圈时间 ..... 283
14.1.4 delimiter和lineterminator 第3步：类似程序的想法 ........... 283
关键字参数 ..................... 269 15.4 datetime模块 .......................... 284
14.2 项目：从CSV文件中删除 15.4.1 timedelta数据类型.......... 285
表头 .......................................... 269 15.4.2 暂停直至特定日期 ......... 286
第1步：循环遍历每个CSV 15.4.3 将datetime对象转换为
文件 ............................... 270 字符串 ............................. 287
第2步：读入CSV文件 ............. 270 15.4.4 将字符串转换成datetime
第3步：写入CSV文件，没有 对象 ................................. 288
第一行 ........................... 271 15.5 回顾Python的时间函数 ....... 288
第4步：类似程序的想法 ........... 272 15.6 多线程 ...................................... 289
14.3 JSON和API ............................ 272 15.6.1 向线程的目标函数传递
14.4 json模块 ................................... 273 参数 ................................. 290
14.4.1 用loads()函数读取 15.6.2 并发问题 ......................... 291
JSON ............................... 273 15.7 项目：多线程XKCD下载
14.4.2 用dumps函数写出 程序 .......................................... 291
JSON ............................... 273 第1步：修改程序以使用函数 ..... 292
14.5 项目：取得当前的天气数据 ... 274 第2步：创建并启动线程 ........... 293
第1步：从命令行参数获取 第3步：等待所有线程结束 ....... 293
位置 ............................... 274 15.8 从Python启动其他程序 ....... 294
第2步：下载JSON数据............ 275 15.8.1 向Popen()传递命令行
第3步：加载JSON数据并打印 参数 ................................. 295
天气 ............................... 275 15.8.2 Task Scheduler、launchd和
目 录
cron .................................. 296 邮件地址 ......................... 313
15.8.3 用Python打开网站 ........ 296 16.4.9 从原始消息中获取正文 .... 314
15.8.4 运行其他Python脚本 .... 296 16.4.10 删除电子邮件 ............... 315
15.8.5 用默认的应用程序打开 16.4.11 从IMAP服务器断开 .... 315
文件 ................................. 297 16.5 项目：向会员发送会费提醒
15.9 项目：简单的倒计时程序 ..... 298 电子邮件 ................................. 316
第1步：倒计时 ........................... 298 第1步：打开Excel文件 ............ 316
第2步：播放声音文件 ............... 298 第2步：查找所有未付成员 ....... 317
第3步：类似程序的想法 ........... 299 第3步：发送定制的电子邮件
15.10 小结 ........................................ 299 提醒 ............................... 318
15.11 习题 ......................................... 300 16.6 用Twilio发送短信 ................ 319
15.12 实践项目 ................................ 300 16.6.1 注册Twilio账号 ............. 319
15.12.1 美化的秒表 ................... 300 16.6.2 发送短信 ......................... 320
15.12.2 计划的Web漫画下载 ... 301 16.7 项目：“只给我发短信”
第16章 发送电子邮件和短信 ................. 303 模块 .......................................... 321
16.1 SMTP ........................................ 303 16.8 小结 .......................................... 322
16.2 发送电子邮件 .......................... 304 16.9 习题 .......................................... 323
16.2.1 连接到SMTP服务器 ..... 304 16.10 实践项目 ............................... 323
16.10.1 随机分配家务活的电子
16.2.2 发送SMTP的“Hello”
消息 ................................. 305 邮件程序 ....................... 323
16.2.3 开始TLS加密 ................ 306 16.10.2 伞提醒程序 ................... 324
16.2.4 登录到SMTP服务器 ..... 306 16.10.3 自动退订 ....................... 324
16.2.5 发送电子邮件 ................. 306 16.10.4 通过电子邮件控制你的
16.2.6 从SMTP服务器断开 ..... 307 电脑 ............................... 324
16.3 IMAP ........................................ 307 第17章 操作图像 ..................................... 327
16.4 用IMAP获取和删除电子 17.1 计算机图像基础 ..................... 327
邮件 .......................................... 307 17.1.1 颜色和RGBA值 ............ 328
16.4.1 连接到IMAP服务器 ..... 308 17.1.2 坐标和Box元组 ............. 329
16.4.2 登录到IMAP服务器 ..... 309 17.2 用Pillow操作图像 ................ 330
16.4.3 搜索电子邮件 ................. 309 17.2.1 处理Image数据类型 ..... 331
16.4.4 选择文件夹 ..................... 309 17.2.2 裁剪图片 ......................... 332
16.4.5 执行搜索 ......................... 310 17.2.3 复制和粘贴图像到其他
16.4.6 大小限制 ......................... 312 图像 ................................. 333
16.4.7 取邮件并标记为已读 ..... 312 17.2.4 调整图像大小 ................. 335
16.4.8 从原始消息中获取电子 17.2.5 旋转和翻转图像 ............. 336
目 录
17.2.6 更改单个像素 ................. 338 第3步：获取并打印鼠标坐标 ...... 356
17.3 项目：添加徽标 ...................... 339 18.5 控制鼠标交互 ......................... 357
第1步：打开徽标图像 ............... 340 18.5.1 点击鼠标 ......................... 357
第2步：遍历所有文件并打开 18.5.2 拖动鼠标 ......................... 357
图像 ............................... 341 18.5.3 滚动鼠标 ......................... 359
第3步：调整图像的大小 ........... 341 18.6 处理屏幕.................................. 360
第4步：添加徽标，并保存 18.6.1 获取屏幕快照 ................. 360
更改 ............................... 342 18.6.2 分析屏幕快照 ................. 360
第5步：类似程序的想法 ........... 343 18.7 项目：扩展mouseNow程序 ... 361
17.4 在图像上绘画 .......................... 344 18.8 图像识别.................................. 362
17.4.1 绘制形状 ......................... 344 18.9 控制键盘.................................. 363
17.4.2 绘制文本 ......................... 346 18.9.1 通过键盘发送一个
17.5 小结 ........................................... 347 字符串 ............................. 363
17.6 习题 ........................................... 348 18.9.2 键名 ................................. 364
17.7 实践项目 .................................. 348 18.9.3 按下和释放键盘 ............. 365
17.7.1 扩展和修正本章项目的 18.9.4 热键组合 ......................... 365
程序 ................................. 348 18.10 复习PyAutoGUI的函数 ..... 366
17.7.2 在硬盘上识别照片 18.11 项目：自动填表程序 ........... 367
文件夹 ............................. 349 第1步：弄清楚步骤 ................... 368
17.7.3 定制的座位卡 ................. 350 第2步：建立坐标 ....................... 368
第3步：开始键入数据 ............... 370
第18章 用GUI自动化控制键盘和
鼠标 ............................................ 351 第4步：处理选择列表和单选
18.1 安装pyautogui模块 ............... 351 按钮 ............................... 371
18.2 走对路 ...................................... 352 第5步：提交表单并等待 ........... 372
18.2.1 通过注销关闭所有程序 .... 352 18.12 小结 ........................................ 372
18.2.2 暂停和自动防故障装置 .... 352 18.13 习题 ........................................ 373
18.3 控制鼠标移动 .......................... 353 18.14 实践项目 ............................... 373
18.3.1 移动鼠标 ......................... 354 18.14.1 看起来很忙 ................... 373
18.3.2 获取鼠标位置 ................. 354 18.14.2 即时通信机器人 ........... 373
18.14.3 玩游戏机器人指南 ....... 374
18.4 项目：“现在鼠标在
哪里？” .................................. 355 附录A 安装第三方模块 ............................ 375
第1步：导入模块 ....................... 355 附录B 运行程序 ........................................ 377
第2步：编写退出代码和无限
附录C 习题答案 ....................................... 381
循环 ............................... 355
目 录
第一部分
Python 编程基础
1
第 章
Python 基础
2
Python编程语言有许多语法结构、标准库函数和交互式开
发环境功能。好在，你可以忽略大多数内容。你只需要学习部
分内容，就能编写一些方便的小程序。
但在动手之前，你必须学习一些基本编程概念。就像魔法
师培训，你可能认为这些概念既深奥又啰嗦，但有了一些知识
和实践，你就能像魔法师一样指挥你的计算机，完成难以置信
的事情。
本章有几个例子，我们鼓励你在交互式环境中输入它们。交互式环境让你每次执行
一条Python 指令，并立即显示结果。使用交互式环境对于了解基本Python 指令的行为
是很好的，所以你在阅读时要试一下。做过的事比仅仅读过的内容，更令人印象深刻。
1.1 在交互式环境中输入表达式
启动IDLE就运行了交互式环境，这是和Python一起安装的。在Windows上，
打开“开始”菜单，选择“All ProgramsPython 3.3”，然后选择“IDLE（Python GUI）”。
在OS X上，选择“ApplicationsMacPython 3.3IDLE”。在Ubuntu上，打开新的
终端窗口并输入idle3。
一个窗口会出现，包含>>>提示符，这就是交互式环境。在提示符后输入2 + 2，
让Python做一些简单的算术。
>>> 2 + 2
4
IDLE窗口现在应该显示下面这样的文本：
Python 3.3.2 (v3.3.2:d047928ae3f6, May 16 2013, 00:06:53) [MSC v.1600 64 bit
(AMD64)] on win32
Type "copyright", "credits" or "license()" for more information.
>>> 2 + 2
4
>>>
在Python中，2 + 2称为“表达式”，它是语言中最基本的编程结构。表达式包
含“值”（例如 2）和“操作符”（例如+），并且总是可以求值（也就是归约）为单
个值。这意味着在Python代码中，所有使用表达式的地方，也可以使用一个值。
在前面的例子中，2 + 2被求值为单个值4。没有操作符的单个值也被认为是一
个表达式，尽管它求值的结果就是它自己，像下面这样：
>>> 2
2
错误没关系！
如果程序包含计算机不能理解的代码，就会崩溃，这将导致 Python 显示错
误信息。错误信息并不会破坏你的计算机，所以不要害怕犯错误。“崩溃”只是
意味着程序意外地停止执行。
如果你希望对一条错误信息了解更多，可以在网上查找这条信息的准确文本，
找到关于这个错误的更多内容。也可以查看 http://nostarch.com/automatestuff/，这里
有常见的Python错误信息和含义的列表。
Python表达式中也可以使用大量其他操作符。例如，表 1-1 列出了Python的所
有数学操作符。
表1-1 数学操作符，优先级从高到低
操作符 操作 例子 求值为
** 指数 2 ** 3 8
% 取模/取余数 22 % 8 6
// 整除/商数取整 22 // 8 2
/ 除法 22 / 8 2.75
* 乘法 3 * 5 15
- 减法 5 - 2 3
+ 加法 2 + 2 4
数学操作符的操作顺序（也称为“优先级”）与数学中类似。**操作符首先求
值，接下来是*、/、//和%操作符，从左到右。+和-操作符最后求值，也是从左到右。
Python编程快速上手——让繁琐工作自动化
如果需要，可以用括号来改变通常的优先级。在交互式环境中输入下列表达式：
>>> 2 + 3 * 6
20
>>> (2 + 3) * 6
30
>>> 48565878 * 578453
28093077826734
>>> 2 ** 8
256
>>> 23 / 7
3.2857142857142856
>>> 23 // 7
3
>>> 23 % 7
2
>>> 2 + 2
4
>>> (5 - 1) * ((7 + 1) / (3 - 1))
16.0
在每个例子中，作为程序员，你必须输入表达式，但Python完成较难的工作，
将它求值为单个值。Python将继续求值表达式的各个部分，直到它成为单个值，如
图1-1所示。
图1-1 表达式求值将它归约为单个值
将操作符和值放在一起构成表达式的这些规则，是 Python 编程语言的基本部
分，就像帮助我们沟通的语法规则一样。下面是例子：