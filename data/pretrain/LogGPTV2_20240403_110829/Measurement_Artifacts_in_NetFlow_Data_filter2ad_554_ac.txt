number of incorrectly counted bytes lies around 0.2% of the total number of
bytes in both cases. The impact of this artifact on accounting applications is,
therefore, very small.
Non-TCP Flow Records With TCP ACK Flag Set – Our analysis has
shown that only ﬂow data from older Cisco devices (i.e., Exporter 1, 2 and 4)
contains this artifact. On average, the number of non-TCP ﬂow records with
TCP ACK ﬂag set accounts for approximately 1% of the total number of ﬂow
records on Exporter 1 and 2.
When analysis applications do not use properly-deﬁned ﬁlters on ﬂow data
containing this artifact, this can lead to unexpected results and misconceptions.
4 The CAIDA UCSD Anonymized Internet Traces 2012 - 16 February 2012
http://www.caida.org/data/passive/passive_2012_dataset.xml
8
R. Hofstede et al.
Flow records
Flow learn failures
 4
 3
 2
 1
)
k
(
s
m
0
0
1
/
s
d
r
o
c
e
R
Flow records
 12
 9
 6
 3
)
k
(
s
/
s
t
e
k
c
a
P
 1.2
 0.9
 0.6
 0.3
)
k
(
s
m
0
0
1
/
s
d
r
o
c
e
R
 0
07:20
07:30
07:40
 0
07:50
 0
09:00
09:10
09:20
09:30
(a) Flow learn failures
(b) NetFlow packet loss
Fig. 2. Impact of ﬂow learn failures and NetFlow packet loss on ﬂow time-series
For example, a ﬁlter for ﬂow records with the TCP ACK-ﬂag set includes also
UDP ﬂows in the case of Exporter 1, 2 and 4. Popular analysis applications,
such as nfdump, accept these ﬁlters without showing any warning to the user.
As long as the transport-layer protocol is speciﬁed in the ﬁlter together with the
ﬂags, this artifact will not have any semantic impact on data analysis.
Gaps – In this section we characterize the eﬀects of ﬂow learn failures on ﬂow
data. This helps to understand whether this artifact is also present in data from
other exporters, without having access to any ﬂow cache statistics. Our experi-
ments have shown that the ﬁrst packets of ﬂows are more likely to be subject to
ﬂow learn failures, because subsequent packets of accounted ﬂows are matched
until the records are expired. Smaller ﬂows are therefore more likely not to be
accounted at all, while larger ﬂows may have only their ﬁrst packets lost. Fig. 2a
shows a time-series of the number of ﬂow records in intervals of 100ms. This
data has been collected early in the morning, when Exporter 1 normally starts
to run out of capacity. A constant stream of ﬂow records without gaps can be
observed until around 7:25, when the number of records increases. Simultane-
ously, ﬂow learn failures (in packets/s) start to be reported by SNMP agents,
and several short gaps appear in the time-series. Note that the series are slightly
out of phase, because of the higher aggregation of the SNMP measurements.
Interestingly, the gaps caused by ﬂow learn failures are periodic, especially
when the network load is constantly above the exporter’s capacity. When analyz-
ing data from Exporter 1 for two weeks, we have observed that the distribution
of the time between gaps is concentrated around multiples of 4s. Furthermore,
gaps are not larger than 2s in 95% of the cases. This conﬁrms our assumption
about the presence of a cyclic process for expiring records from the ﬂow cache.
Gaps can also be caused by other factors, such as the loss of NetFlow pack-
ets during their transport from exporters to collectors, or packet loss on the
monitored link. Both are typically random events that tend to result either in
a homogenous reduction in the number of ﬂow records, or in non-periodic gaps.
Fig. 2b illustrates the example NetFlow packet loss by showing the time-series of
ﬂow records observed at a highly overloaded collector. NetFlow packet sequence
number analysis conﬁrms that more than 5% of the NetFlow packets have been
Measurement Artifacts in NetFlow Data
9
lost by the collector during this interval. Several short periods with a reduced
number of ﬂow records can be observed, but the series never reaches zero in this
example. This demonstrates that gaps in ﬂow data cannot be irrefutably traced
back to ﬂow learn failures.
We can conﬁrm the existence of gaps in ﬂow data from Exporter 1 and 2.
Exporter 3-5 could not be tested, either because they are in production networks
or because we were not able to exhaust their ﬂow capacity. Exporter 6 handles
collisions in software using linked lists and is, therefore, not subject to ﬂow learn
failures. Under extreme load, it exports ﬂow records earlier, ignoring timeout
parameters completely.
Although this artifact has a severe impact on any analysis because of the
resulting incomplete data set, we discuss only two examples: anomaly detection
and bandwidth estimation. The detection of anomalies (especially ﬂooding at-
tacks) is often based on large sets of small ﬂows. Since the ﬁrst packets of a ﬂow
are especially susceptible to ﬂow learn failures, they are more likely to be lost
during the ﬂow export process. Anomalies can therefore stay undetected. Besides
dropped ﬂow records, peaks in the network traﬃc may be smoothed due to the
load-dependency of the artifact. Since the identiﬁcation of peaks is essential for
bandwidth estimation, traﬃc analysis may provide invalid estimates.
5 Conclusions
In this paper we have identiﬁed, analyzed and quantiﬁed several artifacts occur-
ring in ﬂow data exported by six diﬀerent devices. These artifacts are related to
the way such devices handle the ﬂow expiration, TCP ﬂags and byte counters,
and to imprecisions in the number of exported ﬂow records.
Our analysis shows that the impact of the identiﬁed artifacts on the quality
of ﬂow data varies, and that in some cases mitigation and recovery procedures
can be considered. For example, non-TCP ﬂow records with TCP ACK ﬂag set
can be repaired easily. The imprecise ﬂow record expiration artifact can in many
cases be ignored if the ﬂow collector aggregates records belonging to the same
ﬂow before analysis. However, the remaining artifacts cannot easily be mitigated
and they adversely impact the quality of the exported ﬂow data.
The severity of the identiﬁed artifacts ultimately depends on their impact on
the applications that are using the data. Analysis applications are usually built
to be generic and applicable to any ﬂow data. However, the experience gained
during this study convinced us that a better way for designing ﬂow-based appli-
cations would be to take data artifacts into account. Since the types of artifacts
diﬀer from exporter to exporter, we believe that researchers and operators need
to be aware of these artifacts to build more robust analysis applications.
One of the areas that remained untouched in this work is the inﬂuence of
packet sampling on the ﬂow data artifacts, which we plan to address in future
work. Also, we plan to work on a data cleanup tool that aims at detecting and
repairing artifacts in ﬂow data.
10
R. Hofstede et al.
Acknowledgements. This work has been supported by the EU FP7-257513
UniverSelf Collaborative Project and SURFnet’s GigaPort3 project for Next-
Generation Networks. Special thanks to Jeroen van Ingen Schenau and Roel
Hoek (University of Twente, NL), Jan Vykopal and Tomas Plesnik (Masaryk
University, CZ), and Luuk Oostenbrink (SURFnet, NL), for their valuable con-
tribution to the research.
References
1. Cisco Systems, Inc.: Catalyst 6500 Series Switch Cisco IOS Software Conﬁguration
Guide (2009), http://www.cisco.com/en/US/docs/switches/lan/catalyst6500/
ios/12.2SXF/native/configuration/guide/122sxscg.pdf (accessed on Decem-
ber 14, 2012)
2. Claise, B.: Cisco Systems NetFlow Services Export Version 9. RFC 3954 (Informa-
tional) (2004)
3. Cunha, ´I., Silveira, F., Oliveira, R., Teixeira, R., Diot, C.: Uncovering Artifacts of
Flow Measurement Tools. In: Moon, S.B., Teixeira, R., Uhlig, S. (eds.) PAM 2009.
LNCS, vol. 5448, pp. 187–196. Springer, Heidelberg (2009)
4. de Oliveira Schmidt, R., Sperotto, A., Sadre, R., Pras, A.: Towards Bandwidth
Estimation Using Flow-Level Measurements. In: Sadre, R., Novotn´y, J., ˇCeleda,
P., Waldburger, M., Stiller, B. (eds.) AIMS 2012. LNCS, vol. 7279, pp. 127–138.
Springer, Heidelberg (2012)
5. Duﬃeld, N., Lund, C., Thorup, M.: Properties and Prediction of Flow Statistics
from Sampled Packet Streams. In: Proceedings of the 2nd ACM SIGCOMM Work-
shop on Internet Measurement, pp. 159–171 (2002)
6. Duﬃeld, N., Lund, C., Thorup, M.: Estimating Flow Distributions from Sampled
Flow Statistics. IEEE/ACM Transactions on Networking 13(5), 933–946 (2005)
7. Follett, J.H.: Cisco: Catalyst 6500 The Most Successful Switch Ever (2006),
http://www.crn.com/news/networking/189500982/cisco-catalyst-6500-the-
most-successful-switch-ever.htm (accessed on December 14, 2012)
8. Gu, Y., Breslau, L., Duﬃeld, N.G., Sen, S.: On Passive One-Way Loss Measure-
ments Using Sampled Flow Statistics. In: INFOCOM 2009, pp. 2946–2950 (2009)
9. K¨ogel, J.: One-way Delay Measurement based on Flow Data: Quantiﬁcation and
Compensation of Errors by Exporter Proﬁling. In: Proceedings of the 25th Inter-
national Conference on Information Networking (ICOIN 2011), pp. 25–30 (2011)
10. Kompella, R.R., Estan, C.: The Power of Slicing in Internet Flow Measurement.
In: Proceedings of the 5th ACM SIGCOMM Conference on Internet Measurement
(IMC 2005), pp. 105–118 (2005)
11. Sadasivan, G., Brownlee, N., Claise, B., Quittek, J.: Architecture for IP Flow In-
formation Export. RFC 5470 (Informational) (2009)
12. Sommer, R., Feldmann, A.: NetFlow: Information loss or win? In: Proceedings of
the 2nd ACM SIGCOMM Workshop on Internet Measurement, pp. 173–174 (2002)
13. Sperotto, A., Schaﬀrath, G., Sadre, R., Morariu, C., Pras, A., Stiller, B.: An
Overview of IP Flow-Based Intrusion Detection. IEEE Communications Surveys
& Tutorials 12(3), 343–356 (2010)
14. Trammell, B., Tellenbach, B., Schatzmann, D., Burkhart, M.: Peeling Away Tim-
ing Error in NetFlow Data. In: Spring, N., Riley, G.F. (eds.) PAM 2011. LNCS,
vol. 6579, pp. 194–203. Springer, Heidelberg (2011)