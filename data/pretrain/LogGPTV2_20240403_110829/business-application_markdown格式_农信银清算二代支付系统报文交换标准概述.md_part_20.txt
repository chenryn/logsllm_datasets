\
\
\201111110080000001\
\2011-11-11T09:30:47\
\
\103100000018\
\103100000018\
\
\
\100000000000\
\100000000000\
\
\NPS\
\I003\
\01\
\备注\
\
\
\201111110080000023\
\103100000018\
\NPS.311.001.01\
\
\
\
\3D1A3C0B\ // 报文体的签名校验值
\
**注：**namespace_string的值为该报文所对应的schema文件中定义的名字空间值。
5.  MFE发给行内系统
\
\
\
\02\
\ // 报文控制信息
\**NPS.312.001.01**\ // 报文编号
\NPS\ // 发起方业务系统编码
\100000000000\ // 发起方行号
\20111111\ // 发起日期
\093047001\ // 发起时间
\MPS\ // 接收系统
\103100000018\ // 接收方行号
\00000000000000000002\ // 通信级标识号
\00000000000000000001\ // 参考通信级标识号
\
\
\
\
\
\201111110080000001\
\2011-11-11T09:30:47\
\
\100000000000\
\100000000000\
\
\
\103100000018\
\103100000018\
\
\NPS\
\I003\
\01\
\备注\
\
\
\201111110080000023\
\103100000018\
\
\
\RJ09\
\
\
\ //
具体业务报文结构参看《第二代农信银支付清算系统报文交换标准（报文结构规范分册）》
\3D1A3C0B\ // 报文体的签名校验值
\
**注：**namespace_string的值为该报文所对应的schema文件中定义的名字空间值。
6.  格式检查
每个报文都有对应的schema文件用来进行报文格式检查，schema文件名称与报文编号相同，使用ISO20022标准的报文则采用ISO20022发布的schema文件。
参与机构发送报文给NCS2时，应将待发送往帐报文的报文体使用XML
Schema进行格式检查，检查通过后，才能提交给MFE。
参与机构从MFE接收报文后，应使用XML
Schema对收到的来帐报文的报文体进行格式检查，检查通过后，才能提交给行内系统进行业务处理。对检查失败的来帐报文，如报文可以解析并能获取返回业务级回应报文需要的报文数据时，返回"已拒绝"回执报文，否则丢弃该报文，留待日终对账解决。
7.  []{#_Toc406512373 .anchor}数字签名域
8.  加签要素和数字签名编制
第二代农信银支付清算系统使用数字签名保证业务数据的可靠性和防抵赖性。数字签名由业务发起方编制，ESB和业务接收方核验。编制业务数字签名的做法如下：
1.  按报文中业务要素出现的顺序，将各加签业务要素值后附"\|（竖线）"后顺序拼接成签名要素串；例如"102100033452\|CNY1234.56\|"。最后一个业务要素值后面也有"\|（竖线）"；取金额字段作为加签要素时，应包括该金额对应的货币符号，例如格式CNY1234.56；取含有TAG标识符字段（格式为"/tag/value"）时，只使用value部分的内容，不包括/tag/字符。
```{=html}
```
3.  使用本行的数字证书（私钥）对签名要素串签名，签名的校验算法使用SM2算法；
4.  将签名值使用BASE64转码后填写到报文的数字签名域。
    各加签业务要素值，指业务要素对应的XML报文域数据，包括该域除XML标签外的所有字符，无须补齐位数，并截断两端空白字符。空白字符，指空格（0x20）、制表(0x09)、回车(0x0d)、换行(0x0a)四个字符。
    如加签业务要素没有在报文中出现，或其值为全空白（即截断两端空白字符后长度为0），则拼接签名要素串时忽略该加签业务要素。
5.  数字证书绑定通知报文使用带签名者证书（公钥）的数字签名（PKCS#7），非数字证书绑定通知报文使用无签名者证书（公钥）的数字签名（PKCS#1，裸签）
```{=html}
```
9.  签名域范例
数字签名域在报文体内的signature标签域中。
\
\
\\...\
\\... \
***[\String\]{.underline}***
\
10. 特殊字符的说明
数字签名经BASE64转码后放置到报文的数字签名域，由于BASE64转码后的值可以包含回车符，因此在把数字签名加入到报文中时，应避免使用Dom的API操作，否则Dom的API可能会对数字签名中的特殊字符进行转义，从而导致接收方核签失败。例如，Dom
API将数字签名的回车符转换为"&#13;"。
11. []{#_Toc396300567 .anchor}报文编号
12. 编号规则
报文编号规则为 "xxxx.nnn.nnn.nn"
表示系统编号，三或四位大写字母
表示报文编号，三位数字
预留， 固定填写001
版本号， 两位数字
13. 编号范围
```{=html}
```
6.  编号范围列表
+------+-----------+------------------------------------+--------------+
| **序 | **名称**  | **小分类**                         | **编号范围** |
| 号** |           |                                    |              |
+======+===========+====================================+==============+
| 1.   | 支        | 银行汇票业务                       | 100-119      |
|      | 付类业务  |                                    |              |
+------+-----------+------------------------------------+--------------+
|      |           | 电子汇兑业务                       | 120-139      |
+------+-----------+------------------------------------+--------------+
|      |           | 通存通兑业务                       | 140-169      |
+------+-----------+------------------------------------+--------------+
|      |           | 即时转账业务                       | 170-199      |
+------+-----------+------------------------------------+--------------+
|      |           | 第三方转账业务                     | 200-219      |
+------+-----------+------------------------------------+--------------+
|      |           | 网络支付业务                       | 220-239      |
+------+-----------+------------------------------------+--------------+
|      |           | 消费/预授权业务                    | 240-269      |
+------+-----------+------------------------------------+--------------+
|      |           | 其他支付类业务                     | 270-299      |
+------+-----------+------------------------------------+--------------+