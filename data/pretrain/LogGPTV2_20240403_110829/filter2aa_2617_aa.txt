Spyware
Spyware Forensic With 
Forensic With 
Reversing and Static Analysis
Reversing and Static Analysis
PK
PK
TWCERT/CC
TWCERT/CC
2
Abstract
Abstract
目前危害个人机密资料、系统安全的惡意程式，以各种方
目前危害个人机密资料、系统安全的惡意程式，以各种方
式、无孔不入的进入我们电脑，当我们上网下载程式、接
式、无孔不入的进入我们电脑，当我们上网下载程式、接
收电子邮件等，往往会遇到不知档案是否为惡意程式，但
收电子邮件等，往往会遇到不知档案是否为惡意程式，但
防毒软体也未出现警告的情况，在这场我们会讲解一些案
防毒软体也未出现警告的情况，在这场我们会讲解一些案
例以及介绍静、动态分析未知程式的技巧。
例以及介绍静、动态分析未知程式的技巧。
About PK
About PK
TWCERT/CC-鉴識实务班讲师
Mail: pk46(at)aptg.net
3
Outline
Outline
Computer Forensics
Computer Forensics
Why 
Why Spyware
Spyware Forensics
Forensics
Reverse Code Engineering
Reverse Code Engineering
Anti
Anti--Reversing
Reversing
Spyware
Spyware Reversing 
Reversing 
Conclusion
Conclusion
4
Computer Forensics
Computer Forensics
What is Computer Forensics
What is Computer Forensics？
？
Forensics Process Overview
Forensics Process Overview
5
Computer Forensics
Computer Forensics
DEFINITION:
DEFINITION: 电脑鉴識是一种运用专业的分析与调查技
电脑鉴識是一种运用专业的分析与调查技
术，将可能成为证据的资料
术，将可能成为证据的资料((又称數位证据
又称數位证据))进行收集、鉴
进行收集、鉴
别、分析与保存的一个过程，用以呈现于法院。狭义的說
别、分析与保存的一个过程，用以呈现于法院。狭义的說
就是从电脑安全事件发生后
就是从电脑安全事件发生后，
，所进行的一系列寻找數位证
所进行的一系列寻找數位证
据的活动。
据的活动。
數位证据为任何可能的资讯，并能够以二进位
數位证据为任何可能的资讯，并能够以二进位((數位
數位))的方
的方
式传输或储存，包括：网路封包、數位照片、电子邮件、
式传输或储存，包括：网路封包、數位照片、电子邮件、
记忆体资料等。
记忆体资料等。
6
Forensics Process Overview
Forensics Process Overview
Acquisition(
Acquisition(收集
收集))
Live Data Collection (Volatile/Non-
Volatile)
Collecting Network-based Evidence
Preservation(
Preservation(保存
保存))
Forensics Duplication
Evidence Handling (Hash、Tag)
Identification(
Identification(鉴定
鉴定))
Forensic Analysis
Investigation Windows/Unix System
Analyzing Network Traffic
Evaluation(
Evaluation(评估
评估))
Forensic Intuition/Sense
Presentation(
Presentation(呈现
呈现))
Writing Computer Forensic Report
DFWS,2002
7
Why 
Why Spyware
Spyware Forensics
Forensics
Rogue 
Rogue Web Sites
Web Sites
Rogue Application
Rogue Application
Spyware
Spyware Forensic
Forensic
8
Rogue, Bad Guy
Rogue, Bad Guy
Rogue 
Rogue Web Sites
Web Sites
哪裡有流氓网站？有多流氓？
你是否知道自己上的是流氓网站？
Rogue Application
Rogue Application
我的电脑怪怪的，但是我又不知道发生了何事？而我的防毒软体
也并没有出现任何異狀或警讯！
电脑资源始终用不够？难道我的电脑有怪兽？还是小马？
http
http://
://www.xgdown.com
www.xgdown.com//
http://
http://www.zerodaycn.com
www.zerodaycn.com
9
Spyware
Spyware Forensics
Forensics
DEFINITION:
DEFINITION: Spyware
Spyware Forensics
Forensics算是
算是Computer Forensics
Computer Forensics的一环，主要针
的一环，主要针
对一些未知档案或是程式的鉴定分析，
对一些未知档案或是程式的鉴定分析，当我们进行一些电脑安全事件调查
当我们进行一些电脑安全事件调查
时，如：
时，如：Hacking Case
Hacking Case，可能会遇到骇客所部署的惡意程式，此时我们就必
，可能会遇到骇客所部署的惡意程式，此时我们就必
须手动的鉴别出这些档案并对其分析的过程称为
须手动的鉴别出这些档案并对其分析的过程称为Spyware
Spyware Forensics
Forensics或称
或称
Malware
Malware Forensics
Forensics。
。
Perform
Perform Static Analysis
Static Analysis of 
of Spyware
Spyware
Reviewing  the ASCII and Unicode strings
Disassembling Code
Determining 
Determining the Type of File
the Type of File
PE/NE/ELF/COFF
Perform
Perform Dynamic Analysis
Dynamic Analysis of 
of Spyware
Spyware
Debugging
Monitoring (Create the Sandbox Environment)
Perform 
Perform Online Research
Online Research
Determine if the tool is publicly available on computer security or hacker sites.
Perform 
Perform Source Code Review
Source Code Review
If you either have the source code or believe you have identified the source code 
via online research.
10
RReverse 
everse CCode 
ode EEngineering
ngineering
What is RCE
What is RCE
Type Of RCE
Type Of RCE
Reversing
Reversing Tools
Tools
11
What is RCE
What is RCE
Reverse engineering (RE)
Reverse engineering (RE)
Reverse Engineering is the process of analyzing a subject 
system to create representations of the system at a higher level 
of abstraction. 
The process of discovering the technological principles of a 
mechanical application through analysis of its structure, function 
and operation. 
Reverse Code Engineering (RCE)
Reverse Code Engineering (RCE)
RCE can be defined as analyzing and disassembling a software 
system in order understand its design, components, and inner-
workings. 
RCE also allows us to see hidden behaviors that cannot be 
directly observed by running the program or those actions that 
have yet to be activated. 
12
Types Of RCE
Types Of RCE
Security-Related Reversing
Malicious Software
Reversing Cryptographic Algorithms
Digital Rights Management
Auditing Program Binaries
Reversing in Software Development
Reversing in Software Development
Achieving Interoperability with Proprietary Software
Developing Competing Software
Evaluating Software Quality and Robustness
13
Reversing
Reversing Tools
Tools
Hex Editors 
Hex Editors 
UltraEdit
Hex Workshop
WinHex
Disassemblers
Disassemblers
IDA Pro
W32DASM
Decompilers
Decompilers
DeDe
DJ Decompiler
Debuggers
Debuggers
OllyDbg
Soft-ICE
System Monitors 
System Monitors 
API Monitor
FileMon
RegMon
PE Tools
PE Tools
PEiD
PEDitor
LoadPE
14
Anti
Anti--Reversing
Reversing
Eliminating Symbolic Information
Obfuscating the Program
Embedding Anti-debugger Code
Code Encryption
15
Anti
Anti--Reversing
Reversing
Eliminating Symbolic Information
Clear Symbol Name
Export  Functions by Ordinals 
Obfuscating the Program
Junk code
Virtual Machine
Embedding Anti-debugger Code
isDebuggerPresent API
CreateFIleA API
Code Encryption
Simple XOR/ADD Encryption
Packer and Protector
Packing
Unpacking
16
Code Encryption
Simple XOR/ADD Encryption
Simple XOR/ADD Encryption
A xor 0 =A
A xor B =C
A xor C =B
Packer and Protector
Packer and Protector
Win32 Packer
ASPack
PECompact
UPX
FSG
Petite
PE-PACK
Win32 Protector：
ASProtect
ACProtect
Armadillo
EXECryptor
EXE Stealth
FoxLock
Krypton
tElock
SDProtector
Themida
VMProtect
Xtreme-Protector
~Advantages~
1) The physical file size is usually smaller.
2) Resistant to the cracker.
3) Resistant to pattern-based Anti-Virus program.
17
What is Packing (
What is Packing (加壳
加壳)?  
)?  
PE File
PE File
Hard Disk
PE File
PE File
packing
Hard Disk
Reducing Size
Unpack stub
Unpack stub
When Execution
PE File
PE File
Unpack stub
Unpack stub
Memory
decompress PE File
PE File
When decompress ok jump to OEP
PE Loader
Memory
Increasing Size
18