# 28 \| 知名大厂如何搭建大数据平台？专栏第 26期，我介绍了一个常规的大数据平台架构方案，这种架构方案是基于大数据平台Lamda架构进行设计的。事实上，业界也基本是按照这种架构模型搭建自己的大数据平台。今天我们来看一下淘宝、美团和滴滴的大数据平台]{.orange}，一方面进一步学习大厂大数据平台的架构，另一方面也学习大厂的工程师如何画架构图。通过大厂的这些架构图，你就会发现，不但这些知名大厂的大数据平台设计方案大同小异，架构图的画法也有套路可以寻觅。
## 淘宝大数据平台淘宝可能是中国互联网业界较早搭建了自己大数据平台的公司，下图是淘宝早期的Hadoop 大数据平台，比较典型。![](Images/6da701c47e13ae44a8e8783298f31b07.png){savepage-src="https://static001.geekbang.org/resource/image/cb/66/cb45bdbe16771738adf04e76b91ffc66.png"}淘宝的大数据平台基本也是分成三个部分，上面是数据源与数据同步；中间是云梯1，也就是淘宝的 Hadoop大数据集群；下面是大数据的应用，使用大数据集群的计算结果。数据源主要来自 Oracle 和 MySQL的备库，以及日志系统和爬虫系统，这些数据通过数据同步网关服务器导入到Hadoop 集群中。其中 DataExchange 非实时全量同步数据库数据，DBSync实时同步数据库增量数据，TimeTunnel实时同步日志和爬虫数据。数据全部写入到 HDFS 中。![](Images/0f932e3f18ead754b391cc4333b03bc6.png){savepage-src="https://static001.geekbang.org/resource/image/72/81/72e8b66653211df4aa0c33a786340081.png"}在 Hadoop中的计算任务会通过天网调度系统，根据集群资源和作业优先级，调度作业的提交和执行。计算结果写入到HDFS，再经过 DataExchange 同步到 MySQL 和 Oracle数据库。处于平台下方的数据魔方、推荐系统等从数据库中读取数据，就可以实时响应用户的操作请求。``{=html}淘宝大数据平台的核心是位于架构图左侧的天网调度系统，提交到 Hadoop集群上的任务需要按序按优先级调度执行，Hadoop集群上已经定义好的任务也需要调度执行，何时从数据库、日志、爬虫系统导入数据也需要调度执行，何时将Hadoop执行结果导出到应用系统的数据库，也需要调度执行。可以说，整个大数据平台都是在天网调度系统的统一规划和安排下进行运作的。DBSync、TimeTunnel、DataExchange这些数据同步组件也是淘宝内部开发的，可以针对不同的数据源和同步需求进行数据导入导出。这些组件淘宝大都已经开源，我们可以参考使用。
## 美团大数据平台美团大数据平台的数据源来自 MySQL 数据库和日志，数据库通过 Canal 获得MySQL 的 binlog，输出给消息队列 Kafka，日志通过 Flume 也输出到 Kafka。![](Images/c31f30d42f46ec0472e1c84a9d7d77ab.png){savepage-src="https://static001.geekbang.org/resource/image/24/08/249bfac48d6b191a452ecc6634e02a08.png"}Kafka 的数据会被流式计算和批处理计算两个引擎分别消费。流处理使用 Storm进行计算，结果输出到 HBase 或者数据库。批处理计算使用 Hive进行分析计算，结果输出到查询系统和 BI（商业智能）平台。数据分析师可以通过 BI产品平台进行交互式的数据查询访问，也可以通过可视化的报表工具查看已经处理好的常用分析指标。公司高管也是通过这个平台上的天机系统查看公司主要业务指标和报表。美团大数据平台的整个过程管理通过调度平台进行管理。公司内部开发者使用数据开发平台访问大数据平台，进行ETL（数据提取、转换、装载）开发，提交任务作业并进行数据管理。
## 滴滴大数据平台滴滴大数据平台分为实时计算平台（流式计算平台）和离线计算平台（批处理计算平台）两个部分。实时计算平台架构如下。数据采集以后输出到 Kafka消息队列，消费通道有两个，一个是数据 ETL，使用 Spark Streaming 或者Flink 将数据进行清洗、转换、处理后记录到 HDFS中，供后续批处理计算。另一个通道是Druid，计算实时监控指标，将结果输出到报警系统和实时图表系统 DashBoard。![](Images/60ac36682bd03b935f12afa8f6a4642c.png){savepage-src="https://static001.geekbang.org/resource/image/db/ce/db71097f009f6dd53910cc984ed96fce.png"}离线计算平台架构如下。滴滴的离线大数据平台是基于 Hadoo2（HDFS、Yarn、MapReduce）和 Spark 以及 Hive构建，在此基础上开发了自己的调度系统和开发系统。调度系统和前面其他系统一样，调度大数据作业的优先级和执行顺序。开发平台是一个可视化的SQL 编辑器，可以方便地查询表结构、开发 SQL，并发布到大数据集群上。![](Images/3d0018c933251f845d4d2a87986baf58.png){savepage-src="https://static001.geekbang.org/resource/image/23/4b/239dd0686a1b8edce3cac6fb82027c4b.png"}此外，滴滴还对 HBase重度使用，并对相关产品（HBase、Phoenix）做了一些自定义的开发，维护着一个和实时、离线两个大数据平台同级别的HBase 平台，它的架构图如下。![](Images/f95287eebca78e1f4f62d16b1af4beb1.png){savepage-src="https://static001.geekbang.org/resource/image/66/77/66bfbc37ac0cb63ae9f3b5a6c098c777.png"}来自于实时计算平台和离线计算平台的计算结果被保存到 HBase中，然后应用程序通过 Phoenix 访问 HBase。而 Phoenix 是一个构建在 HBase上的 SQL 引擎，可以通过 SQL 方式访问 HBase 上的数据。