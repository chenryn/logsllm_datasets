on successful 
SGNET sensors 
information 
interaction 
and provides 
leveraging 
and, through 
algorithm 
protocol 
based on 
code injec­
to the sensors 
the 
memory tainting, 
are, therefore, 
The memory tainting 
information 
generated 
by Argos, 
with simple heuristics, 
combined 
to identify injected 
of part of the Nepenthes 
tended behavior 
network actions 
of the observed 
associated 
to it. 
shellcodes. 
[2] modules to understand 
and emulate 
the 
shellcodes 
the in­
allows SGNET honeypots 
SGNET takes advantage 
metadata 
on the attacking 
All the information 
collected 
during the interaction 
is stored in  a database, 
enrichment 
component 
of 
and 
[18] that is 
sources, 
SGNET entities 
on the collected 
the different 
fed into an information 
in charge of adding additional 
sources, and 
ent information 
the behavioral 
AV detection 
ery mal ware sample collected 
is, in fact, automatically 
and the resulting 
dataset 
analyzed 
reports 
to enrich the knowledge 
analysis 
the most relevant 
malware. 
Among the differ­
to this work are 
by Anubis [6], and the 
information generated 
statistics 
[25]. Ev­
by VirusTotal 
generated 
by to these two services, 
are stored in the SGNET 
about the injection 
event. 
by the SGNET infrastructure 
• Payload (7f). The set of network bytes to which the 
the usage of 
flow through 
redirects 
the control 
attacker 
E and I. 
• Malware (p). The binary content 
uploaded 
to the vic­
of 7f, and that allows the at­
operations 
that would 
the execution 
tim through 
tacker to run more sophisticated 
be impossible 
to the payload 7f. 
in the limited 
space normally 
available 
it is neces­
introduced 
by the 
In order to exploit 
the SGNET information, 
propagation 
strategies. 
techniques 
sary to cope with the degree of variation 
different 
tion is the polymorphic 
tent of the payload and of the malware. 
have even simpler 
filename in the FTP request 
sample to the victim. 
An example of this varia­
used to mutate the con­
we can 
However, 
cases, such as the usage of a random 
used to download 
the mal ware 
clustering 
Because of the unique characteristics 
is intentionally 
simple, 
tech­
Section 
several 
existing 
2 discussed 
techniques 
for the 
samples starting 
from 
of the 
features. 
described 
to be applied 
at our disposal, 
and to introduce 
of polymorphic 
EPM clustering. 
a new, simple pattern 
in [13] and used in the con­
sufficiently 
shellcode 
generic 
and malware features. 
we have chosen not to reuse these 
discov­
indepen­
We call 
The EPM clustering 
of the multidimensional 
quick classification 
static 
dataset 
techniques, 
ery technique, 
dently to exploit, 
this technique 
nique is a simplification 
technique 
by lulisch 
text of IDS alerts. 
This technique 
and could be easily evaded in the future by more sophis­
ticated 
simple, 
the current sophistication 
served in the SGNET dataset. 
the assumption 
tacker has a limited 
phic or randomization 
ability 
Since the randomization 
attacker, 
take into account 
detect a certain 
a certain 
of the code injection 
has a cost for the 
to 
to 
we can assume that it will always be possible 
large amount of features 
scope. We assume that any polymor­
aims at introducing 
engines. 
it proved to be sufficient 
EPM clustering 
performed 
polymorphic 
in practice, 
ob­
is based on 
by the at­
although 
it is 
to deal with 
that any randomization 
amount of invariants 
Nevertheless, 
class of attacks. 
of each feature 
a sufficiently 
only in certain 
technique 
features 
vari­
attacks. 
level of the malware samples 
useful for recognizing 
3.2. EPM clustering 
The SGNET dataset 
provides 
information 
on the differ­
ent phases of each observed 
we show that SGNET is structured upon 
pi-mu (EGPM) model, an extension 
an epsilon-gamma­
of the model initially 
code injection 
attack. 
In [17], 
978-1-4244-7501-8/10/$26.00 
©201O IEEE 
395 
DSN 2010: Leita et al. 
Authorized licensed use limited to: Tsinghua University. Downloaded on March 18,2021 at 14:00:10 UTC from IEEE Xplore.  Restrictions apply. 
2010 IEEEIIFIP International 
Conference 
on Dependable 
Systems & Networks (DSN) 
Dim.  Feature 
Epsilon FSM path identifier 
# invariants 
50 
3 
6 
Pi 
Mu 
(FfPIHTTP/ ... ) 
interaction  22 
interaction 4 
type (PUSHlPULLIcentral) 5 
57 
95 
to Jibmagic signatures 7 
in protocol 
Destination 
port 
Download protocol 
Filename in protocol 
Port involved 
Interaction 
File MDS 
File size in bytes 
File type according 
(PE) Machine type 
(PE) Number of sections 
(PE) Number of imported DLLs 
(PE) as version 
(PE) Linker version 
(PE) Names of the sections 
(PE) Imported DLLs 
(PE) Referenced 
Keme132.dll 
7 
43 
11 
symbols  15 
1 
8 
7 
Table 1. Selected features 
For instance, 
we observed 
that polymorphic 
worm [10] obfuscate 
and ran­
techniques 
perform more expensive 
operations 
of the executable 
files, 
such as that of the Allaple 
domize the data and code sections 
but do not normally 
such as relinking, 
Executable 
Portable 
EPM clustering 
or leaving 
(PE) headers. 
is composed by 4 different 
pattern 
dis­
is 
of 
invariant 
classification. 
The technique 
dimensions 
to the three distinct 
discovery, 
phases, 
definition, 
namely feature 
covery and pattern-based 
applied 
the EGPM model: E,  7r and p.' 
independently 
invariants 
when looking 
at the 
Phase 1: feature definition 
definition 
phase consists 
The feature 
tures that have proven to be useful in our experiments 
characterize 
of features 
terize 
Pi-Mu space. 
class. Table 1 shows the list 
to charac­
of the Epsilon­
of defining a set of fea­
to 
that we have taken into consideration 
the code injections 
in each dimension 
activity 
a certain 
Most of the exploit 
classification 
is based on the infor­
with the 
FSM models. Because of the way FSM models 
of the attacker 
by the interaction 
mation provided 
ScriptGen 
are built [20], a given FSM path incorporates 
and specificities 
tocol features 
If all the network interactions 
username, 
parameters 
differentiated 
or the same NetBios connection 
will be part of the generated 
of a certain 
take advantage 
from other exploit 
model, and will be 
of the same 
such 
identifiers, 
implementations. 
together 
pro­
implementation. 
we distinguish 
protocol 
and the in­
with the victim, 
(when available) 
on the involved 
in the interaction 
port. Depending 
interacting 
requested 
volved "server" 
and on the entity 
also between three types of interaction: 
in which the attacker 
pushes the sample. 2) PULL-based 
home), in which the victim is forced to connect 
attacker 
repository, 
interacts 
with a third party different 
to the victim and 
(also known as phone­
back to the 
and download the sample. 3) Based on a central 
download 
in the case in which the PULL-based 
from the attacker 
connects 
actively 
1) PUSH-based, 
itself. 
The malware dimension, 
because of the extensive 
use of 
a higher number of at­
samples. We have 
such as its 
simple file properties, 
information 
Executable 
extracted 
of the PEfile [8] library. 
requires 
classify 
in order to correctly 
non-polymorphic 
polymorphic  techniques, 
tributes 
taken into consideration 
size, as well as Portable 
from the samples taking advantage 
In order to identify 
of the sample was also considered 
Looking at the level of sophistication 
ware collection, 
difficult 
These characterictics, 
tinguish 
likely 
the existing 
to mutate over different 
to a modification 
to be associated 
codebase. 
variants, 
different 
PE header characteristics 
polymorphic 
seem to be more 
instances. 
thus, are good discriminants 
to dis­
since a change in their value is 
of 
or recompilation 
samples, 
as a possible 
the MD5 
invariant. 
of the SGNET mal­
taken into account 
for the clas­
by the mal ware writer 
approach. 
More com­
approaches 
might appear in 
randomized 
clustering 
could be easily 
all of the features 
Clearly, 
sification 
in order to evade our static 
plex (and costly) 
the future leading 
techniques. 
ing on the collection 
the study of its future evolution. 
This justifies 
polymorphic 
to the need to generate 
of data on the threat 
the interest 
more sophisticated 
in continuously 
carry­
landscape 
and on 
Phase 2: invariant 
discovery 
in the previous phase, 
the 
for all the invariant 
searches 
in multiple 
(it is witnessed 
For each of the features defined 
algorithm 
ant value is a value that is not specific 
instance 
in the dataset), 
same value is used by multiple 
instances) 
tiple honeypot 
stances). 
that can be used to characterize 
that is not specific 
and is not specific 
An invariant 
IPs witness 
a certain 
to a certain 
attackers 
values. 
to a certain 
An invari­
attack 
attacks 
code injection 
to a certain 
attacker 
(the 
in different 
attack 
(mul­
destination 
the same value in different 
a "good" value 
value is, therefore, 
in­
event type. 
The Nepenthes 
shellcode 
analyzer 
provides 
information 
on the intended 
behavior 
of each shellcode 
Such information 
SGNET deployment. 
of protocol 
in the interaction 
(e.g., 
well as some Nepenthes-specific 
involved 
collected 
by the 
the type 
includes 
protocols), 
the filename 
FTP, HTTP, as 
'We do not consider I in the classification 
due to lack of host-based 
information 
in the SGNET dataset. 
The definition 
of invariant 
value is threshold-based: 
this work, we consider 
at least 10 different 
Throughout 
it was seen in 
was used by at least three different 
on at least three honeypot 
invariant 
values discovered 
a value as invariant 
if 
attack instances, 
and if it 
attackers 
and witnessed 
IPs. Table 1 shows the amount of 
for each dimension. 
978-1-4244-7501-8/10/$26.00 
©201O IEEE 
396 
DSN 2010: Leita et al. 
Authorized licensed use limited to: Tsinghua University. Downloaded on March 18,2021 at 14:00:10 UTC from IEEE Xplore.  Restrictions apply. 
Figure 2. Pattern discovery  starting  from  a 
limited number of invariants 
(in bold) 
Phase 3: pattern discovery 
representation 
The clustering 
mechanism 
of Anubis has been described 
More concretely, 
the system 
two samples based on their behavioral 
clustering 
system that 
system for cap­
behavior. 
in detail 
in [4]. It is a behavior-based 
makes use of the Anubis dynamic analysis 
turing a sample's 
works by comparing 
The behavioral 
profile. 
behavior 
of a program's 
state-of-the-art 
analysis 
the tracking 
of sensitive 
system is scalable 
distances. 
Clusters 
techniques 
compare operations. 
the computation 
of events associated 
profile is an abstract 
that is obtained 
by avoiding 
with the help of 
and 
such as data tainting 
to the same behavior 
ac­
will be re­
cording to Anubis behavior-based 
ferred to as B-clusters 
clustering 
in the rest of this paper. 
we explore 
In the next session, 
The clustering 
of all O(n2) 
at our dis­
the information 
We 
by means of EPM relations. 
of approaches 
based on static 
of mal ware samples can be of 
characteristics 
2010 IEEE/IFIP International 
Conference 
on Dependable 
Systems & Networks (DSN) 
MD5 
b666137cOf3f63c08bd4f42 
51 ae2cf41 
09461 eb9bb930abf66f9c335 
3262d7ec241c75891471e7309436254f 
18777613abafd7d76ba8a7bfe7260b8a 
18777613abafd7d76ba8a7bfe7260b8a 
rsiZe"'  'Nsect 
59904 3  kernel32.dll 
8aeabd6a 59904 3  kernel32.dll 
59904 3  kernel32.dll 
65402 4  kernel32.dll 
65402 4  kernel32.dll 
Dlls 
'---'  '----' 
of its propagation 
behavior-based 
6]. 
In parallel 
to the EPM classification 
strategies, 
we take into consideration 
malware clustering 
provided 
of the mal ware and 
the 
by Anubis [1, 
values are defined on each attack  fea­
Once the invariant 
ture, we look at the way by which the different 
have been composed together, 
tures. As exemplified 
tuple T =  Vi, V2, ... , 
for the specific 
value for that dimension 
Vn where n is the number of features 
an invariant 
features 
of fea­
patterns 
a 
in Figure 2, we define as pattern 
and Vi is either 
EPM dimension 
generating 
or is a "do not care" value. 
phase looks at all the code injec­
The pattern 
discovery 
tion attacks 
period, 
criminant 
and looks at all the possible 
combinations 
of dis­
values for the different 
features. 
posal in the SGNET dataset 
show how the combination 
or behavioral 