 Role name | Attributes |     Member of      | Description 
-----------+------------+--------------------+-------------
 ro        |            | {pg_read_all_data} | 
postgres=> \c postgres postgres 
You are now connected to database "postgres" as user "postgres".
postgres=# create role rw login;
CREATE ROLE
postgres=# grant pg_write_all_data to rw;
GRANT ROLE
postgres=# \c postgres rw
You are now connected to database "postgres" as user "rw".
postgres=> insert into tbl values (1,'test', now());
INSERT 0 1
postgres=> select * from tbl limit 1;
ERROR:  permission denied for table tbl 
```
2、默认使用 SCRAM-SHA-256 认证方法, 提升安全性, 完全规避md5可能的密钥泄露和协议攻击问题  
- 场景: 通用  
- 价值: 提高认证方式和密码认证安全性  
- DEMO:
```
postgres=# select rolname, rolpassword from pg_authid;
          rolname          |                                                              rolpassword                                                              
---------------------------+---------------------------------------------------------------------------------------------------------------------------------------
 pg_database_owner         | 
 pg_read_all_data          | 
 pg_write_all_data         | 
 pg_monitor                | 
 pg_read_all_settings      | 
 pg_read_all_stats         | 
 pg_stat_scan_tables       | 
 pg_read_server_files      | 
 pg_write_server_files     | 
 pg_execute_server_program | 
 pg_signal_backend         | 
 ro                        | 
 rw                        | 
 postgres                  | SCRAM-SHA-256$4096:HQ/MO4C1qFcdRonv2hiG0Q==$Cgif0D/DtZQwwQNtOtvDs3LQtTZs6C2mPoKT9bcjbdw=:2YD87hpH+x/FudOeFtLQAqVHlwYBo/iCR8nZdhhsP4c=
(14 rows)
postgres=# select * from pg_settings where name='password_encryption';
-[ RECORD 1 ]---+------------------------------------------------
name            | password_encryption
setting         | scram-sha-256
unit            | 
category        | Connections and Authentication / Authentication
short_desc      | Chooses the algorithm for encrypting passwords.
extra_desc      | 
context         | user
vartype         | enum
source          | default
min_val         | 
max_val         | 
enumvals        | {md5,scram-sha-256}
boot_val        | scram-sha-256
reset_val       | scram-sha-256
sourcefile      | 
sourceline      | 
pending_restart | f
```
3、pg_hba.conf clientcert 支持 verify-ca 或 verify-full 校验客户端证书真伪, 检验证书DN内容是否匹配连接的数据库用户  
- 场景: 通用  
- 价值: 提高客户端SSL证书检测安全性  
4、SSL 客户端证书校验增加clientname CN DN 提取选项, 遵循 RFC2253  
- 场景: 通用  
- 价值: 增加SSL证书 CN DN内容的可用范围  
5、libpq协议层支持数据库状态判断(standby or primary)  
- 场景: 读写分离、多数据源场景  
- 价值: 提高判断数据库角色的效率, 不需要发起SQL即可判断数据库处于 读写 还是 只读 角色  
6、libpq支持target_session_attrs属性配置: "any", "read-only", "read-write", "primary", "standby", and "prefer-standby".  
- 场景: 读写分离、多数据源场景  
- 价值: 在多数据源场景中, 支持根据状态选择是否要连接该目标. 可以根据SQL分配不同的角色, 用于balance.   
- DEMO:
```
postgresql://host1:123,host2:456/somedb?target_session_attrs=any&application_name=myapp
```  
### 详见  
1、PostgreSQL 14 adds the ability to give users universal "read only" and "write only" privileges on tables/views/sequences through the use of the pg_read_all_data and pg_write_all_data predefined roles, respectively.   
- [《PostgreSQL 14 preview - 新增角色 pg_read_all_data (MySQL 兼容性之 - 读写用户的只读影子用户 - 默认读权限  ) , pg_write_all_data (写权限)》](../202104/20210406_03.md)      
2、This release also defaults to using SCRAM-SHA-256 for password management on new PostgreSQL instances.   
3、Additionally, the clientcert parameter in the pg_hba.conf must now use either the values of verify-ca or verify-full instead of the legacy values.  
4、PostgreSQL 14 can use a certificate's "distinguished name" (DN) for certificated-based authentication with clientname=DN parameter in the pg_hba.conf file.  
- [《PostgreSQL 14 preview - SSL 客户端证书校验增加clientname CN DN 提取选项, 遵循 RFC2253》](../202103/20210330_01.md)      
5、libpq 协议优化:    
- [《PostgreSQL GUC_REPORT+libpq 实现客户端决策链路 - multi host + 客户端 target_session_attrs + 发起连接时即刻获取PG数据库当前状态 - libpq 协议级 驱动级 failover balance》](../202103/20210304_02.md)        
- Enhance libpq's target_session_attrs parameter options (Haribabu Kommi, Greg Nancarrow, Vignesh C, Tom Lane)      
    - New options are "read-only", "primary", "standby", and "prefer-standby".      
# ii. 所有特性详情 
## 一、Server  
- [《PostgreSQL 14 preview - kill 会话增加超时等待. pg_wait_for_backend_termination(pid, ms), 发送terminate信号给进程, 并等待若干ms, 如果PID未被kill, 则返回false和warning.》](../202104/20210408_10.md)    
- [《PostgreSQL 14 preview - VACUUM: ignore indexing operations with CONCURRENTLY  (getoldestxmin优化, 更多垃圾可以被回收, 防止long create index导致膨胀)》](../202102/20210224_01.md)    
- [《PostgreSQL 14 preview - System Versioned Temporal Table - flashback闪回、跟踪、审计 record/row/tuple历史版本》](../202010/20201010_06.md)    
- [《PostgreSQL 14 preview - BYPASS_THRESHOLD_PAGES vacuum 优化, 避免每次都需要vacuum index, 当LP_DEAD覆盖的page较少时, 跳过index vacuum》](../202104/20210408_01.md)    
- [《PostgreSQL 14 preview - Add "pg_database_owner" default role. 表示数据库owner》](../202103/20210327_01.md)    
- [《PostgreSQL 14 preview - 新增角色 pg_read_all_data (MySQL 兼容性之 - 读写用户的只读影子用户 - 默认读权限  ) , pg_write_all_data (写权限)》](../202104/20210406_03.md)    
- [《PostgreSQL 14 preview - client_connection_check_interval , 协议层支持心跳包, 如果客户端已离线 可以 快速中断 运行中的长SQL - Detect POLLHUP/POLLRDHUP while running queries》](../202104/20210403_01.md)    
- [《PostgreSQL 14 preview - 支持startup(恢复)进程与backend(用户)进程死锁检测 - backpatch到9.6版本》](../202101/20210107_03.md)    
- [《PostgreSQL 14 preview - 自动清理临时文件 after backend crash restart - GUC remove_temp_files_after_crash》](../202105/20210519_01.md)  
因为没有regress test被打回的TDE特性如下:   
- [《PostgreSQL 14 preview - TDE cluster_key_command 配置例子》](../202012/20201229_01.md)    
- [《PostgreSQL 14 preview - 支持TDE功能, 支持加密数据文件, 支持加密WAL日志文件》](../202012/20201228_01.md)    
### 1、分区表  
- [《PostgreSQL 14 preview - 分区表attach, detach分区支持无锁(短暂锁) - 基于2阶段routines管理》](../202103/20210326_04.md)    
- [《PostgreSQL 14 preview - 分区表性能增强, Avoid creating duplicate cached plans for inherited FK constraints. 节约cache》](../202103/20210311_01.md)    
- [《PostgreSQL 14 preview - 分区表性能再次增强 - ExecInitModifyTable 分区裁剪精细化》](../202104/20210407_01.md)    
- [《PostgreSQL 14 preview - 优化器增强 Rework planning and execution of UPDATE and DELETE. (减少传导不必要的列value、避免为每个分区生成subplan)》](../202104/20210401_04.md)    
### 2、Indexes  
- [《PostgreSQL 14 preview - 频繁更新索引列引起的索引分裂和膨胀问题大幅度缓解, Enhance nbtree index tuple deletion - bottom-up index deletion》](../202101/20210116_01.md)    
- [《PostgreSQL 14 preview - gist和sp-gist索引AM支持sort接口, 大幅加速GiST和SP-GiST 索引build速度》](../202104/20210408_07.md)    
- [《PostgreSQL 14 preview - SP-GiST 索引新增 index 叶子结点 include column value 功能 支持》](../202104/20210406_04.md)    
- [《PostgreSQL 14 preview - brin 索引内存优化》](../202103/20210324_01.md)    
- [《PostgreSQL 14 preview  GiST 索引新增openapi: sortsupport - 加速gist索引创建, 紧凑组织gist index page.》](../202009/20200920_02.md)    
- [《PostgreSQL 14 preview - BRIN (典型IoT 时序场景) 块级索引支持 bloom filter - 随机,大量distinct value, 等值查询》](../202103/20210326_02.md)    
- [《PostgreSQL 14 preview - BRIN (典型IoT 时序场景) 块级索引支持 multi-range min-max  - 分段范围索引》](../202103/20210326_01.md)    
### 3、优化器  
- [《PostgreSQL 14 preview - 增强or, and多条件选择性评估 - 使用multiple extended statistics》](../202012/20201209_02.md)    
- [《PostgreSQL 14 preview - Extended statistics on expressions 优化器增强: 自定义扩展统计信息支持 指定 表达式 - 按 表达式 收集统计信息组合》](../202103/20210327_02.md)    
### 4、通用性能提升  
- [《PostgreSQL 14 GetSnapshotData 高并发优化, 以及 64位xid避免xid wrap优化》](../202008/20200812_01.md)    
- [《PostgreSQL 14 preview - 增加 结果缓存 exexutor node - GUC 开关 enable_resultcache - 提高join loop性能》](../202104/20210401_01.md)    
- [《PostgreSQL 14 preview - Hybrid Hash/Nested Loop joins and caching results from subplans  - cache用于join的innter table中间结果》](../202011/20201110_05.md)    
- [《PostgreSQL 14 preview - FDW 支持异步执行接口, postgres_fdw 支持异步append - sharding 性能增强 - 未来将支持更多异步操作》](../202103/20210331_02.md)    
- [《PostgreSQL 14 preview - analyze 支持prefetch 加速IO》](../202103/20210317_01.md)    
- [《PostgreSQL 14 并行优化 - seqscan io chunk优化, 避免离散IO》](../202007/20200727_03.md)    
- [《PostgreSQL 14 preview - drop、truncate大量对象, recovery时需要遍历shared buffer导致的性能问题patch(崩溃恢复慢、standby延迟等问题) - DropRelFileNodeBuffers 增强》](../202101/20210113_01.md)    
- [《PostgreSQL 14 preview - Speed up rechecking if relation needs to be vacuumed or analyze in autovacuum.》](../202012/20201209_01.md)    
- [《PostgreSQL 14 preview - 支持window function的incremental sort》](../202009/20200916_01.md)    
- [《PostgreSQL 14 preview - 一些SQL标准函数调用parser 增强 - OVERLAPS , OVERLAY , SUBSTRING , SIMILAR , NORMALIZE , AT TIME ZONE , POSITION ...》](../202011/20201107_04.md)    
- [《老外惊呼: 世界变化快! PostgreSQL 14 on ARM 8.1 加上LSE patch性能飙升到140万tps》](../202104/20210430_01.md)    
- [《PostgreSQL 14 preview - 强制 vacuum 加速patch, 避免heap truncate多余的动作》](../202104/20210414_02.md)    
- [《PostgreSQL 14 preview - 支持 vacuum 强制加速参数 vacuum_failsafe_age , vacuum_multixact_failsafe_age.  防止 xid wraparound》](../202104/20210408_03.md)    
- [《PostgreSQL 14 preview - TOAST 支持 lz4 压缩算法 - --with-lz4 , 新增GUC default_toast_compression》](../202103/20210320_01.md)    
- [《PostgreSQL 14 preview - copy from 导入数据支持 batch, 大幅减少conversion/verification function calls, 支持并行处理》](../202104/20210402_01.md)    
- [《PostgreSQL 14 preview - copy freeze 增强, pgbench 支持copy freeze 大幅提升导入性能》](../202103/20210311_04.md)    
- [《PostgreSQL 14 preview - COPY 支持visibility map及时更新》](../202101/20210118_03.md)    
- [《PostgreSQL 14 减少系统调用 - Use pg_pread() and pg_pwrite() for data files and WAL - Use pg_pread() and pg_pwrite() in slru.c》](../202008/20200803_01.md)    
- [《PostgreSQL 14 preview - 向量化IO功能 (pwritev, preadv) , IO性能增强》](../202101/20210111_01.md)    
- [《PostgreSQL 14 preview - Improve performance of Unicode {de,re}composition in the backend》](../202010/20201024_01.md)    
- [《PostgreSQL 14 preview - 大表search IN ( consts ) - linear search TO hash table probe (consts 个数>= MIN_ARRAY_SIZE_FOR_HASHED_SAOP)》](../202105/20210519_02.md)  
- Improve the performance of COPY FROM in binary mode (Bharath Rupireddy, Amit Langote)  
### 5、监控  
- [《PostgreSQL 14 preview - 支持 SQL 指纹(规则化, 唯一ID): query id - GUC : compute_query_id》](../202104/20210408_04.md)    
- [《PostgreSQL 14 preview - log_connections 支持打印更多内容, pg_hba第几行, 使用什么认证方法等, 方便判断客户通过什么方式在与数据库进行登陆认证》](../202104/20210407_07.md)    
- [《PostgreSQL 14 preview - 查看backend process的memory context》](../202011/20201110_01.md)    
- [《PostgreSQL 14 preview - 打印其他会话的memory context, 诊断内存消耗问题 - pg_backend_memory_contexts(pid)》](../202104/20210407_06.md)    
- [《PostgreSQL 14 preview - autovacuum 打印更多信息, 每个索引的stats被打印》](../202103/20210324_02.md)    
- [《PostgreSQL 14 preview - log增强 : auto-vacuum and auto-analyze 记录IO timing以及analyze read|dirty rate》](../202103/20210317_02.md)    
- [《PostgreSQL 14 preview - automatic analyze: readahead - add "IO read time" log message》](../202011/20201110_03.md)    
### 6、系统视图  
- [《PostgreSQL 14 preview - pg_stat_progress_copy增强 , COPY 导入数据支持进度监控 , 导入多少行, 排除多少行(where filter)》](../202103/20210310_02.md)    
- [《PostgreSQL 14 preview - 支持copy命令进度查询 - pg_stat_progress_copy》](../202101/20210107_05.md)    
- [《PostgreSQL 14 preview - 新增pg_stat_wal统计信息视图》](../202010/20201003_02.md)    
- [《PostgreSQL 14 preview - pg_stat_wal 支持实例级wal统计wal_records, wal_fpi and wal_bytes》](../202012/20201202_02.md)    
- [《PostgreSQL 14 preview - pg_locks 增加 wait_start 字段, 跟踪锁等待开始时间》](../202102/20210207_01.md)    
- [《PostgreSQL 14 preview - SaaS特性 - 会话建立、资源消耗时间片 统计 - pg_stat_database 指标增加》](../202101/20210118_01.md)    
- [《PostgreSQL 14 preview - pg_stat_database 新增会话消耗统计 - 如何分析数据库有没有性能瓶颈, 瓶颈是什么? top瓶颈是什么? 如何优化?》](../202103/20210301_01.md)    
- [《PostgreSQL 14 preview 新增 replication slot 监控 - pg_stat_replication_slots》](../202010/20201010_01.md)    
- [《PostgreSQL 14 支持绑定变量语句(prepared statements)的 custom_plans 与 generic_plans 次数统计》](../202007/20200720_01.md)    
- [《PostgreSQL 14 preview - 新增sql feature支持 - 函数,存储过程 对象依赖跟踪 - Routine usage information schema tables》](../202102/20210218_01.md)    
- [《PostgreSQL 14 preview - pg_stat_activity 显示 walsender 进程流复制command》](../202009/20200920_03.md)    
- [《PostgreSQL 14 preview - Add information of total data processed to replication slot stats - 逻辑复制槽统计信息增加处理事务数和数据量计数器 total_txns  total_bytes》](../202104/20210417_01.md)    
- [《PostgreSQL 14 preview - 活跃会话pg_stat_activity、进程进度条pg_stat_progress\* 、等待事件wait_event等 信息 从 pgstat 代码 拆出》](../202104/20210404_01.md)    
打回特性:  
- [《PostgreSQL 14 preview - 统计 generic/custom plan in pg_stat_statements - 硬解析、软解析统计》](../202011/20201110_02.md)    
- [《PostgreSQL 14 preview - 支持 lwlock blocking 诊断 - 增加 pg_lwlock_blocking_pid》](../202011/20201110_04.md)    
### 7、认证  