PowerShot Basic
Oren Isacson, Alfredo Ortega
August 1, 2010
Abstract
An (incomplete) speciﬁcation of the Basic language included in several
Canon Powershot Cameras.
1
Contents
0.1
Executing Scripts . . . . . . . . . . . . . . . . . . . . . . . . . . .
14
0.1.1
Format of the SD card . . . . . . . . . . . . . . . . . . . .
14
0.1.2
Script extend.m . . . . . . . . . . . . . . . . . . . . . . . .
14
0.1.3
Starting the script . . . . . . . . . . . . . . . . . . . . . .
14
0.1.4
Automatic script . . . . . . . . . . . . . . . . . . . . . . .
14
0.2
Language constructs . . . . . . . . . . . . . . . . . . . . . . . . .
15
0.2.1
operators
. . . . . . . . . . . . . . . . . . . . . . . . . . .
15
0.2.2
Dim . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
15
0.2.3
for-next . . . . . . . . . . . . . . . . . . . . . . . . . . . .
16
0.2.4
do-while . . . . . . . . . . . . . . . . . . . . . . . . . . . .
16
0.2.5
subroutines . . . . . . . . . . . . . . . . . . . . . . . . . .
16
0.3
Common functions() . . . . . . . . . . . . . . . . . . . . . . . . .
16
0.3.1
ExMem.View() . . . . . . . . . . . . . . . . . . . . . . . .
17
0.3.2
ExMem.AllocUncacheable() . . . . . . . . . . . . . . . . .
17
0.3.3
ExMem.FreeUncacheable()
. . . . . . . . . . . . . . . . .
17
0.3.4
ExMem.AllocCacheable() . . . . . . . . . . . . . . . . . .
17
0.3.5
ExMem.FreeCacheable() . . . . . . . . . . . . . . . . . . .
17
0.3.6
StartCameraLog() . . . . . . . . . . . . . . . . . . . . . .
17
0.3.7
ShowCameraLog() . . . . . . . . . . . . . . . . . . . . . .
17
0.3.8
ShowCameraLogInfo() . . . . . . . . . . . . . . . . . . . .
18
0.3.9
StopCameraLog()
. . . . . . . . . . . . . . . . . . . . . .
18
0.3.10 PutsCameraLogEvent() . . . . . . . . . . . . . . . . . . .
18
0.3.11 OpLog.Create() . . . . . . . . . . . . . . . . . . . . . . . .
18
0.3.12 drysh()
. . . . . . . . . . . . . . . . . . . . . . . . . . . .
18
0.3.13 NewTaskShell() . . . . . . . . . . . . . . . . . . . . . . . .
18
0.3.14 ExMem() . . . . . . . . . . . . . . . . . . . . . . . . . . .
18
0.3.15 StartRedirectUART()
. . . . . . . . . . . . . . . . . . . .
19
0.3.16 SS.Create() . . . . . . . . . . . . . . . . . . . . . . . . . .
19
0.3.17 SetUSBToDCPMode() . . . . . . . . . . . . . . . . . . . .
19
0.3.18 InitializeDCPClassFunctions()
. . . . . . . . . . . . . . .
19
0.3.19 LoadScript()
. . . . . . . . . . . . . . . . . . . . . . . . .
19
0.3.20 UnLoadScript() . . . . . . . . . . . . . . . . . . . . . . . .
19
0.3.21 Printf() . . . . . . . . . . . . . . . . . . . . . . . . . . . .
20
0.3.22 RomCheckSum() . . . . . . . . . . . . . . . . . . . . . . .
20
0.3.23 PostLogicalEventToUI() . . . . . . . . . . . . . . . . . . .
20
0.3.24 PostLogicalEventForNotPowerType()
. . . . . . . . . . .
20
0.3.25 PostEventShootSeqToUI() . . . . . . . . . . . . . . . . . .
20
0.3.26 ShowLogicalEventName() . . . . . . . . . . . . . . . . . .
20
0.3.27 SetAutoShutdownTime()
. . . . . . . . . . . . . . . . . .
20
2
0.3.28 LockMainPower()
. . . . . . . . . . . . . . . . . . . . . .
21
0.3.29 UnlockMainPower()
. . . . . . . . . . . . . . . . . . . . .
21
0.3.30 HardwareDefect()
. . . . . . . . . . . . . . . . . . . . . .
21
0.3.31 HardwareDefectWithRestart()
. . . . . . . . . . . . . . .
21
0.3.32 MechaUnRegisterEventProcedure() . . . . . . . . . . . . .
21
0.3.33 Mecha.Create() . . . . . . . . . . . . . . . . . . . . . . . .
21
0.3.34 DispDev EnableEventProc()
. . . . . . . . . . . . . . . .
21
0.3.35 SystemEventInit() . . . . . . . . . . . . . . . . . . . . . .
22
0.3.36 System.Create()
. . . . . . . . . . . . . . . . . . . . . . .
22
0.3.37 UI RegistDebugEventProc() . . . . . . . . . . . . . . . . .
22
0.3.38 UI.Create() . . . . . . . . . . . . . . . . . . . . . . . . . .
22
0.3.39 FA.Delete() . . . . . . . . . . . . . . . . . . . . . . . . . .
22
0.3.40 Capture.Create() . . . . . . . . . . . . . . . . . . . . . . .
22
0.3.41 EngineDriver.Create() . . . . . . . . . . . . . . . . . . . .
22
0.3.42 StartTransferOrderMenu() . . . . . . . . . . . . . . . . . .
23
0.3.43 StartDirectTransferManager() . . . . . . . . . . . . . . . .
23
0.3.44 StartDtConﬁrmMenu()
. . . . . . . . . . . . . . . . . . .
23
0.3.45 StoptDtConﬁrmMenu()
. . . . . . . . . . . . . . . . . . .
23
0.3.46 StartDtExecuteMenu() . . . . . . . . . . . . . . . . . . . .
23
0.3.47 StopRedirectUART()
. . . . . . . . . . . . . . . . . . . .
23
0.3.48 RefreshUSBMode() . . . . . . . . . . . . . . . . . . . . . .
23
0.3.49 UI.CreatePublic()
. . . . . . . . . . . . . . . . . . . . . .
24
0.3.50 StoptDtExecuteMenu()
. . . . . . . . . . . . . . . . . . .
24
0.3.51 TerminateDCPClassFunctions() . . . . . . . . . . . . . . .
24
0.3.52 UiEvnt StopDisguiseCradleStatus()
. . . . . . . . . . . .
24
0.4
OpLog.Create() . . . . . . . . . . . . . . . . . . . . . . . . . . . .
24
0.4.1
OpLog.Show()
. . . . . . . . . . . . . . . . . . . . . . . .
24
0.4.2
OpLog.Play() . . . . . . . . . . . . . . . . . . . . . . . . .
25
0.4.3
OpLog.ReadFromROM()
. . . . . . . . . . . . . . . . . .
25
0.4.4
OpLog.ReadFromSD() . . . . . . . . . . . . . . . . . . . .
25
0.4.5
OpLog.WriteToSD() . . . . . . . . . . . . . . . . . . . . .
25
0.4.6
OpLog.WriteToROM() . . . . . . . . . . . . . . . . . . . .
25
0.4.7
OpLog.Get()
. . . . . . . . . . . . . . . . . . . . . . . . .
25
0.4.8
OpLog.Stop() . . . . . . . . . . . . . . . . . . . . . . . . .
26
0.4.9
OpLog.Start()
. . . . . . . . . . . . . . . . . . . . . . . .
26
0.5
Driver.Create() . . . . . . . . . . . . . . . . . . . . . . . . . . . .
26
0.5.1
GetAdVBattBottom() . . . . . . . . . . . . . . . . . . . .
26
0.5.2
GetAdChValue() . . . . . . . . . . . . . . . . . . . . . . .
26
0.5.3
BeepDrive() . . . . . . . . . . . . . . . . . . . . . . . . . .
26
0.5.4
LEDDrive() . . . . . . . . . . . . . . . . . . . . . . . . . .
27
0.5.5
VbattGet() . . . . . . . . . . . . . . . . . . . . . . . . . .
27
0.5.6
ShowPhySwStatus() . . . . . . . . . . . . . . . . . . . . .
27
0.5.7
SetRawSWCheckMode() . . . . . . . . . . . . . . . . . . .
28
0.5.8
OnPrintPhySw() . . . . . . . . . . . . . . . . . . . . . . .
28
0.5.9
OﬀPrintPhySw() . . . . . . . . . . . . . . . . . . . . . . .
28
0.5.10 GetSwitchStatus() . . . . . . . . . . . . . . . . . . . . . .
28
0.5.11 ShowSDStatus()
. . . . . . . . . . . . . . . . . . . . . . .
28
0.5.12 GetSDDetect() . . . . . . . . . . . . . . . . . . . . . . . .
28
0.5.13 GetSDProtect() . . . . . . . . . . . . . . . . . . . . . . . .
29
0.5.14 SetIgnoreAVJACK() . . . . . . . . . . . . . . . . . . . . .
29
3
0.5.15 GetDialEventId() . . . . . . . . . . . . . . . . . . . . . . .
29
0.5.16 SetSDPwrPort()
. . . . . . . . . . . . . . . . . . . . . . .
29
0.6
System.Create()
. . . . . . . . . . . . . . . . . . . . . . . . . . .
29
0.6.1
Driver EnableEventProc() . . . . . . . . . . . . . . . . . .
29
0.6.2
Driver.Create() . . . . . . . . . . . . . . . . . . . . . . . .
30
0.6.3
strcpy() . . . . . . . . . . . . . . . . . . . . . . . . . . . .
30
0.6.4
strlen()
. . . . . . . . . . . . . . . . . . . . . . . . . . . .
30
0.6.5
strcmp() . . . . . . . . . . . . . . . . . . . . . . . . . . . .
30
0.6.6
sprintf() . . . . . . . . . . . . . . . . . . . . . . . . . . . .
30
0.6.7
memcpy() . . . . . . . . . . . . . . . . . . . . . . . . . . .
30
0.6.8
memset() . . . . . . . . . . . . . . . . . . . . . . . . . . .
31
0.6.9
memcmp()
. . . . . . . . . . . . . . . . . . . . . . . . . .
31
0.6.10 sscanf() . . . . . . . . . . . . . . . . . . . . . . . . . . . .
31
0.6.11 atol()
. . . . . . . . . . . . . . . . . . . . . . . . . . . . .
31
0.6.12 Open()
. . . . . . . . . . . . . . . . . . . . . . . . . . . .
31
0.6.13 Read() . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
31
0.6.14 Write()
. . . . . . . . . . . . . . . . . . . . . . . . . . . .
32
0.6.15 Close()
. . . . . . . . . . . . . . . . . . . . . . . . . . . .
32
0.6.16 Lseek()
. . . . . . . . . . . . . . . . . . . . . . . . . . . .
32
0.6.17 Fopen Fut,Fclose Fut,Fread Fut,Fwrite Fut,Fseek Fut . .
32
0.6.18 CreateCountingSemaphore()
. . . . . . . . . . . . . . . .
32
0.6.19 DeleteSemaphore() . . . . . . . . . . . . . . . . . . . . . .
33
0.6.20 TakeSemaphore() . . . . . . . . . . . . . . . . . . . . . . .
33
0.6.21 GiveSemaphore() . . . . . . . . . . . . . . . . . . . . . . .
33
0.6.22 GetTimeOfSystem() . . . . . . . . . . . . . . . . . . . . .
33
0.6.23 CreateTask() . . . . . . . . . . . . . . . . . . . . . . . . .
33
0.6.24 ExitTask()
. . . . . . . . . . . . . . . . . . . . . . . . . .
33
0.6.25 SleepTask() . . . . . . . . . . . . . . . . . . . . . . . . . .
34
0.6.26 CPrintf()
. . . . . . . . . . . . . . . . . . . . . . . . . . .
34
0.6.27 CPutChar() . . . . . . . . . . . . . . . . . . . . . . . . . .
34
0.6.28 GetCh() . . . . . . . . . . . . . . . . . . . . . . . . . . . .
34
0.6.29 OpenConsole() . . . . . . . . . . . . . . . . . . . . . . . .
34
0.6.30 CloseConsole() . . . . . . . . . . . . . . . . . . . . . . . .
34
0.6.31 GetStringWithPrompt() . . . . . . . . . . . . . . . . . . .
35
0.6.32 RotateConsoleZOder() . . . . . . . . . . . . . . . . . . . .
35
0.6.33 ExecuteEventProcedure() . . . . . . . . . . . . . . . . . .
35
0.6.34 ExportToEventProcedure() . . . . . . . . . . . . . . . . .
35
0.6.35 DeleteProxyOfEventProcedure()
. . . . . . . . . . . . . .
35
0.6.36 CreateProxyOfEventProcedure() . . . . . . . . . . . . . .
35
0.6.37 WriteToRom()
. . . . . . . . . . . . . . . . . . . . . . . .
36
0.6.38 EraseSectorOfRom() . . . . . . . . . . . . . . . . . . . . .
36
0.6.39 EraseSignature() . . . . . . . . . . . . . . . . . . . . . . .
36
0.6.40 GetSystemTime()
. . . . . . . . . . . . . . . . . . . . . .
36
0.6.41 ShowAllTaskInfo() . . . . . . . . . . . . . . . . . . . . . .
36
0.6.42 memShow() . . . . . . . . . . . . . . . . . . . . . . . . . .
37
0.6.43 Wait() . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
37
0.6.44 AllocateMemory()
. . . . . . . . . . . . . . . . . . . . . .
38
0.6.45 FreeMemory()
. . . . . . . . . . . . . . . . . . . . . . . .
38
0.6.46 Poke32() . . . . . . . . . . . . . . . . . . . . . . . . . . . .
38
0.6.47 Poke16() . . . . . . . . . . . . . . . . . . . . . . . . . . . .
38
4
0.6.48 Poke8() . . . . . . . . . . . . . . . . . . . . . . . . . . . .
38
0.6.49 Peek32() . . . . . . . . . . . . . . . . . . . . . . . . . . . .
39
0.6.50 Peek16() . . . . . . . . . . . . . . . . . . . . . . . . . . . .
39
0.6.51 Peek8() . . . . . . . . . . . . . . . . . . . . . . . . . . . .
39
0.6.52 Dump() . . . . . . . . . . . . . . . . . . . . . . . . . . . .
39
0.6.53 Dump32() . . . . . . . . . . . . . . . . . . . . . . . . . . .
39
0.6.54 SDump()
. . . . . . . . . . . . . . . . . . . . . . . . . . .
39
0.6.55 MonSelEvent() . . . . . . . . . . . . . . . . . . . . . . . .
40
0.6.56 exec() . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
40
0.6.57 MakeBootDisk()
. . . . . . . . . . . . . . . . . . . . . . .
40
0.6.58 MakeScriptDisk() . . . . . . . . . . . . . . . . . . . . . . .
40
0.6.59 Printf() . . . . . . . . . . . . . . . . . . . . . . . . . . . .
40
0.6.60 LoadScript()
. . . . . . . . . . . . . . . . . . . . . . . . .
40
0.6.61 UnLoadScript() . . . . . . . . . . . . . . . . . . . . . . . .
41
0.6.62 GetBuildDate() . . . . . . . . . . . . . . . . . . . . . . . .
41
0.6.63 GetBuildTime()
. . . . . . . . . . . . . . . . . . . . . . .
41
0.6.64 GetFirmwareVersion() . . . . . . . . . . . . . . . . . . . .
41
0.6.65 CheckSumAll() . . . . . . . . . . . . . . . . . . . . . . . .
41
0.6.66 MemoryChecker()
. . . . . . . . . . . . . . . . . . . . . .
41
0.6.67 VerifyByte()
. . . . . . . . . . . . . . . . . . . . . . . . .
42
0.6.68 StartWDT()
. . . . . . . . . . . . . . . . . . . . . . . . .
42
0.6.69 StopWDT() . . . . . . . . . . . . . . . . . . . . . . . . . .
42
0.6.70 EraseLogSector() . . . . . . . . . . . . . . . . . . . . . . .
42
0.6.71 GetLogToFile() . . . . . . . . . . . . . . . . . . . . . . . .
42
0.6.72 AdditionAgentRAM() . . . . . . . . . . . . . . . . . . . .
42
0.6.73 System delet()
. . . . . . . . . . . . . . . . . . . . . . . .
43
0.7
UI.CreatePublic() . . . . . . . . . . . . . . . . . . . . . . . . . . .
43
0.7.1
SetScriptMode()
. . . . . . . . . . . . . . . . . . . . . . .
43
0.7.2
UIFS StopPostingUIEvent() . . . . . . . . . . . . . . . . .
43
0.7.3
UIFS RestartPostingUIEvent() . . . . . . . . . . . . . . .
43
0.7.4
UIFS SetCaptureModeToP()
. . . . . . . . . . . . . . . .
43
0.7.5
UIFS SetCaptureModeToTv()
. . . . . . . . . . . . . . .
44
0.7.6
UIFS SetCaptureModeToM() . . . . . . . . . . . . . . . .
44
0.7.7
UIFS SetCaptureModeToMacro() . . . . . . . . . . . . . .
44
0.7.8
UIFS SetCaptureModeToISO3200()
. . . . . . . . . . . .
44
0.7.9
UIFS Capture()