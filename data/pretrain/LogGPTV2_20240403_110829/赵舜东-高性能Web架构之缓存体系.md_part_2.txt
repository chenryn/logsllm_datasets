Storage in use:
122KD
Storage disk location:
C:\usersjanc
List Cashe Entries
北京
---
## Page 25
控制台HTMLCSS本DOM网络
P在同培量
Ceolies
e
消除保持
全部HTMLCSSJavaScriptXHR图片插件媒体字体
GOPS2017
URL
状态
大小
远程IP
Beiing
GET alidns.com
2000%
aldrs.com
3.28110.75.69.72:00
8.5ms
头有息用ISHIML提存
响应头信磨
Connection kp-alive
Content-Encoding rsis
基于
Content-Type teat/html
Date Stn.27 Mar201601:16:26GMT
Last-HodifiedFr1:11 Jul 2014 03:25:04 GMT
Server Tentint/1.46
Transfer-Encoding chunked
Last-Modified
请求头信息
Accept txt/hl,xpplfeation/shtl.aplieatfen/ml:=0.9,*/=0.8
Accept Encoding cip oetlate
缓存协商
Accept-Language
h-CX：g=0.8.0S:=0.5.n=0.3
Cache-Control
no-cache
Connection
kepralir
Host alidns.coe
Pragma
no-encht
User-Agent Moz1iia/s.0（1ndos T 6.1:T0m4:rv4o)Cec/201c01o1 Flrefox/44.0
 GET globales
200 OK
ddrs.com
12.9
110.75.69.72:00
GET jquery.min.js
2000K
aldrs.com
90.99
110.75.69.72:80
美 GET jqueryslider.min.js
200 OK
aldns.com
2.7K8
110.75.69.72:80
GET jquery.alinav.js
200OK
aldrs.com
3.5KB
110.75.69.72:80
 GET site.js
200K
aldrs.com
4.1
110.75.69.72:80
GETwb.js
0062
ts.sjs.sinajs.on
12.2K8
124.165.204.43:80
GET logo.png
200OK
aldns.com
17,9KB
110.75.69.72:80
北京
---
## Page 26
Coakies
清除保特全部HTMLCSSJavaScriptXHR图片插件媒体李体
GOPS2017
URL
状态
过
大小
远程IP
时间线
Beiing
GET alldns.com
alidns.com
3.2KB
110,75.69.72180
34ms
头信息响应HTML提存
响应头信息
Connection
keep-alive
基于
Date
Su,27Mar201601:48:37GMT
Last-Modified Fr1,11 Jui201403:25:01 CIt
Server Tengine/l.4.6
请求头信息
Last-Modified
Acceptt+xt/ht.aolfeatfen/tl+l.applieatin/xml:=0.9，*/*=0.8
Accept-Encoding czip. deflate
Accept-Language
zh-aNzh：q=0.8,en-US:q=0.5,en:q=0.3
Cache-Control
max-are=O
缓存协商
Connection
keop-allve
Host alidnr.com
If-Modifed-SinceFr411Ju1201403:25:04 G
User-Agent Mosi11a/5:0（Fnder NT 61: Wom64: rv:44.0) Gcke/20100o: Firefez/44.0
来自级存的响应头信息
GET global.css
PPOINOE
aidrs.com
12.9KB
110,75.69.72:80
GET jquery.min.js
30HNo Mocfe
aidrs.com
90.9KB
110.75.69.72:80
GET jquery.slider.min.js
aidns.com
2.7KB
110,75.69.72:60
GETjquery.ainav.js
XH
aldrs.com
3.5KB
110,75.69.72:80
GET sibe.js
Sooodid
alidns,com
4.1B
110,75.69.72:80
GET wb.js
tssjs,snas.cn
12.2K
124,167,222,38:60
GETlogo.png
ouo
aidns,.com
17,9 KB
110.75,69.72:80
GET22-bg.png
alidns.com
1.9KB
110.75.69.72:80
运维
0
北京
---
## Page 27
GOPS2017
Beifing
URL
状态
域
GET support.html
200OK
linuxhot,com
头信息
响应
HTML
缓存
Cookies
基于Etag
回响应头信息
缓存协商
Connection
keep-alive
Content-Encoding
ezip
Content-Type text/html
Date Thu, 27 Ju1 2017 08:23:49 GMT
Etag W/*58b7565e-2fd7*
Last-Modified Wed, 01 Mar 2017 23:16:44 GMT
Server
openresty
Transfer-Encoding
chunked
Vary
Accept-Encoding
OPS
全球运维大
---
## Page 28
回请求头信息
GOPS2017
Beifing
Accept text/html,application/xhtml-ml,aoplication/xml;o=0. 9,*/*n=0.8
Accept-Encoding ezip.deflate,br
Accept-Language zh-CN, zh,q=0. 8, en-US q=0. 5, en a=0. 3
基于Etag
Cache-Control max-aze=0
Connection keep-alive
Cookie Hm_lyt_9278c07b1e6ab84d8b45b99c33fac1bs=1500713774, 1500714105, 150111
缓存协商-请求头
:Hn_1yt_994e57aedfo1779e135da9839e946ed9=1484831974;Hn_1vt_e14e18c
wp-settines-I=mfo1d3Do%261ibraryContent%SDhrowse%26editor%3Dtinyn
%3D1aree: wp-settings-time-i=149543176l; qqmsil_alias-workweixin222s
=1501144422; mb-referrer hostmame-ww linuxhot.com; nh-start-page-ur
%2Fsupport.html
Host ww.linuxhot.com
If-None-Matdh *5979a52c-2fd7
Upgrade-Insecure-Requests 1
User-Agent Mozilla/5.0 (Windows NT 6.1: WOW64; rv:53.0) Gecko/20100101 Firefox/
---
## Page 29
GOPS2017
响应头信息
Beifing
Cache-Control
max-age=315360000
Date
Fr1, 28 J01 2017 07:17:56 GMT
Expires
Mon, 26 Ju1 2027 01:15:16 GMT
基于Expires
Server
JDWS/2. 0
Via http/1.1 BJ-CM-1-JCS-117 ( [cRs f ])
X-Firefox-5pdy h2
缓存协商
请求头信息
Accept */*
彻底消灭连接
Accept-Encoding ezip. deflate, br
Accept-Language zh-CN, zh:q=0. 8, en-US:q=0. 5. eniq=0.3
Cache-Control max-age=0
Connection keep-alive
Host img10.360buyimg.com
If-Modified-5ince Fri,28 Ju12017 01:15:16 GMT
Referer https://item. jd. com/4031578. htm1
User-Agent Mozilla/5.0 (Windows NT 6.1: WOW64: rv:53.0) Gecko/20100101 Firefox/53.0
球运维一
---
## Page 30
你真的会刷新吗？
GOPS2017
Beifing
1.在地址栏中输入网址后按回车或点击转到按钮。
浏览器会对所有没有过期的内容直接使用本地缓存，这个时候Last-Modified-
Etag、和Expires均不会受刷新的影响。
2.按F5或浏览器刷新按钮。
浏览器会在请求中附加必要的缓存协商，这个时候Last-Modified、ETag就要受
影响，要发起缓存协商的动作，但是对Expires无效。
3.按Ctrl+F5或按Ctrl并点击刷新按钮。
每次浏览器都发起一个全新的请求，不使用任何缓存。
---
## Page 31
如何不便用浏览器缓存？
GOPS2017
Beifing
1．直接修改文件名
2. /
使用时间戳
http://www.example.c0m/js/code.js?20160101
全球运维力
---
## Page 32
目录
GOPS2017
Beifing
Web缓存知识体系
Buffer与Cache详解
DNS与浏览器缓存
CDN与反向代理缓存
Web服务器与分布式缓存
数据库与操作系统缓存
全球运维大
---
## Page 33
2.DNS递归查询
www.test.com.cdn.dnsv1.com
GOPS2017
Beifing
TencentDNS
3.返回最佳接入节点IP
CDN
1.DNS解析
源站
Local DNS
www.test.com
7.转发请求
请求流程
4.返回最佳接入节点IP
8.返回数据
5.发起请求
6.内部路由
User
CDN中间源
10.用户获取数据
请求http://www.test.com/1.jpg
9.CDN节点获取数据并缓存
CDN接入节点
全球运维大
201
北京
---
## Page 34
CDN关键技术
GOPS2017
Beifing
内容路由 （请求调度）
内容分发
（PUSH（分发）、PULL（回源））
内容存储
（内容源存储、Cache节点存储）
内容管理
---
## Page 35
反向代理缓存现状
GOPS2017
Beifing
Nginx+Lua
(Openresty
Squid
Varnish
ATS
OPS
全球运维大
201
北京
---
## Page 36
Nginx反向代理缓存
GOPS2017
Beifing
[root@www ~]# vim /usr/local/nginx/conf/proxy.conf
#CDN+
proxy_temp_path /data/cdn_cache/proxy_temp_dir;t
max_size=1g:t
proxy_connect_timeout 5;
proxy_read_timeout 60;t
proxy_send_timeout 5;t
proxy_buffer_size 16k;-
proxy_buffers 4 64k;
proxy_busy_buffers_size 128k;
proxy_temp_file_write_size 128k;t
proxy next upstream error timeout invalid_headerhttp_500http_502 http_503 http_404;
201
---
## Page 37
GOPS2017
Beifing
#Use Proxy Cachet
Nginx
proxy_cache cache_one;t
反向代理缓存
proxy_cache_key "$host$request_uri";
add_header Cache "$upstream_cache_status";
proxy_cache_valid
1200304301302 8h;+
proxy_cache_valid 404 1m;t
proxy_cache_valid any 2d;t
全球运维子
---
## Page 38
Firebug -
控利合HTML
CSS本
DOM
网络
Cookies
GOPS2017
全部HTMLCSS
Beiing
清除
保持
JavaScript XHR
图片
插件
媒体字体
URL
状态
大小
远程IP
时间线
GETIndex.html
304Not 1MoO0
example.com
24B
192,168,56.11:80
头信息明应HTML绿存
反向代理缓存
8喻应头信息
Cache HIr
Connection keep-alive
Date Mon,28 Mar 2016 16:41:45 GNT
Etag
18-52438f7899228
Last-Modiied Fr1,04 Mar 2016 13:19:37 GMT
Server nzinz/1.9.12
8请求头信息
Accept
text/htnl,applieation/xhtl+xnl，applieaticn/xnl:q=0.9,*/*q=0.8
Accept-Encoding rzip,deflate
Accept-Language zh-Cif,zh:q=0.8.en-uS:a=0.5.en:q=0.3
Cache-Control max-are=0
Connection keep-alive
Host m.exanple.com
If-Modified-Since Fri.04 Mar 2016 13:19:37 CT
If-Mone-Match
“18-52d387899228
User-Agent Mozil1a/5.0（windous NT 6.1:0n64:rv:44.0) Gecko/20100101 Firetoz/44.0
来自缓存的响应头信息
1个请求
24B（24B来自振存）
---
## Page 39
目录
GOPS2017
Beifing
Web缓存知识体系
Buffer与Cache详解
DNS与浏览器缓存
CDN与反向代理缓存
Web服务器与分布式缓存
数据库与操作系统缓存
OPS
全球运维大
---
## Page 40
Web服务器缓存
GOPS2017
Beifing
缓存动态内容输出 (SSI慎用)
页面静态化
OpCode 缓存
应用程序本地缓存
全球运维力
---
## Page 41
页面静态化
GOPS2017
Beifing
用户
浏览器（缓
存）
CDN
回原
img1.shopimg.
js1.shopimg.co
passport, shop
item.shop.com
cart.shop.com
price.shop.com
m
.com
css1.shopmg c
search shop co
xuibu
xuibu
tuan.shop.com
club.shop.com
wo
m
Java、PHP应
Java、PHP应
Java、PHP应
MooseFS
MooseFS
MooseFS
用
用
用
请求动动贝
CMS
DB
OPS
全球运维力
2017
---
## Page 42
FastcGICacheFeow
GOPS2017
Beifing
Cache
HTTPRequest
Redis
Hit?
FastCGI
Cache Hit?
Nginx
Yes
No
Yes
No
Nginx
PHP-FPM
MySQL
FastCGl
缓存
HTTP
Response
OPS
全球运维大
---
## Page 43
应用代码执行缓存
GOPS2017
Beifing
编译型
解释型
混合型
JavaScript
JAVA
c++
Python
C#
GO
Ruby
Swift
PHP
Object-C
Perl
Pascal
Erlang
OPS
全球运维大
---
## Page 44
PHP Script
GOPS2017
Execute
Beifing
CheckOpCodeCache
NotCached
Cached
Parse
ReadfromSharedMemory
PHP OpCache
Compile to OpCodes
SavetoSharedMemory
Execute(Zend Engine)
Output
---
## Page 45
PHPOpCache缓存
GOPS2017
Beifing
PHP5.5.0之前版本
1.使用APC（AlternativePHP Cache）扩展
2.修改php.ini增加extension=/full/path/to/php_apc.so
3.修改php.ini配置相关参数
PHP5.5.0及后续版本
1.编译时增加--enable-opcache
2.修改php.ini增加zend_extension=/full/path/to/opcache.so
3.修改php.ini配置相关参数