title:BGP Beacons, Network Tomography, and Bayesian Computation to Locate
Route Flap Damping
author:Caitlin Gray and
Clemens Mosig and
Randy Bush and
Cristel Pelsser and
Matthew Roughan and
Thomas C. Schmidt and
Matthias W&quot;ahlisch
BGP Beacons, Network Tomography, and Bayesian Computation
to Locate Route Flap Damping
Caitlin Gray
PI:EMAIL
University of Adelaide
Australia
Clemens Mosig
clemens.mosig@fu-
Freie UniversitÃ¤t Berlin
berlin.de
Germany
Randy Bush
PI:EMAIL
Arrcus / IIJ
USA /Japan
Cristel Pelsser
PI:EMAIL
UniversitÃ© de Strasbourg
France
Matthew Roughan
matthew.roughan@ade
laide.edu.au
University of Adelaide
Australia
Thomas C. Schmidt
t.schmidt@haw-
hamburg.de
HAW Hamburg
Germany
Matthias Wahlisch
PI:EMAIL
Freie UniversitÃ¤t Berlin
Germany
ABSTRACT
Pinpointing autonomous systems which deploy specific inter-domain
techniques such as Route Flap Damping (RFD) or Route Origin Val-
idation (ROV) remains a challenge today. Previous approaches to
detect per-AS behavior often relied on heuristics derived from pas-
sive and active measurements. Those heuristics, however, often
lacked accuracy or imposed tight restrictions on the measurement
methods.
We introduce an algorithmic framework for network tomog-
raphy, BeCAUSe, which implements Bayesian Computation for
Autonomous Systems. Using our original combination of active
probing and stochastic simulation, we present the first study to
expose the deployment of RFD. In contrast to the expectation of the
Internet community, we find that at least 9% of measured ASs enable
RFD, most using deprecated vendor default configuration parame-
ters. To illustrate the power of computational Bayesian methods
we compare BeCAUSe with three RFD heuristics. Thereafter we
successfully apply a generalization of the Bayesian method to a
second challenge, measuring deployment of ROV.
CCS CONCEPTS
â€¢ Mathematics of computing â†’ Bayesian computation; â€¢ Net-
works â†’ Public Internet; Routing protocols.
KEYWORDS
Metropolis-Hasting, Hamiltonian Monte Carlo, RFD, RPKI
ACM Reference Format:
Caitlin Gray, Clemens Mosig, Randy Bush, Cristel Pelsser, Matthew Roughan,
Thomas C. Schmidt, and Matthias Wahlisch. 2020. BGP Beacons, Network
Tomography, and Bayesian Computation to Locate Route Flap Damping.
Permission to make digital or hard copies of all or part of this work for personal or
classroom use is granted without fee provided that copies are not made or distributed
for profit or commercial advantage and that copies bear this notice and the full citation
on the first page. Copyrights for components of this work owned by others than ACM
must be honored. Abstracting with credit is permitted. To copy otherwise, or republish,
to post on servers or to redistribute to lists, requires prior specific permission and/or a
fee. Request permissions from permissions@acm.org.
IMC â€™20, October 27â€“29, 2020, Virtual Event, USA
Â© 2020 Association for Computing Machinery.
ACM ISBN 978-1-4503-8138-3/20/10...$15.00
https://doi.org/10.1145/3419394.3423624
492
In ACM Internet Measurement Conference (IMC â€™20), October 27â€“29, 2020,
Virtual Event, USA. ACM, New York, NY, USA, 14 pages. https://doi.org/
10.1145/3419394.3423624
1 INTRODUCTION
In the mid â€™90s, many global backbone BGP-speaking routers were
under-powered and began to experience damaging CPU load in the
presence of BGP churn, frequent announcements and withdrawals
of the same prefix. Some core operators met with vendors to design
Route Flap Damping (RFD) and codified it in RFC 2439 [43]. With
RFD, routers maintain a penalty value per prefix per session. Pre-
fixes with a penalty above a given threshold are damped, e.g., newly
received announcements are suppressed and not considered as
suitable alternatives to reach a destination.
In 2002-2003, it was shown by Mao et al. [24] that RFD was too
aggressive and had a negative affect on Internet routing. Routers
in 2006 were more powerful so it was presumed that operators
followed best practice and removed RFD from their configurations
[5]. In 2011, Pelsser et al. [30] showed that more considered settings
of the RFD parameters were safe and helpful, and consequently it
was believed that operators would re-enable RFD. But at no time in
all this history was the actual deployment of RFD measured.
Understanding RFD deployment and parameters is important
because RFD can cause problems reaching Internet destinations [9,
24] and can obscure active and passive control plane measurements
for researchers. More importantly, RFD is the poster child for a
range of problems: those where we localise routing properties in the
Internet ecosystem from external measurements. Heuristics [32, 41]
have been used to tackle specific cases of such problems but we
seek here to create a general approach.
Such problems fall under the heading of network tomography: in-
ference about internal network behavior from end-to-end measure-
ments. We present a new tomographic approach hereâ€”BeCAUSeâ€”
which is adapted to this class of problems. BeCAUSe uses computa-
tional Bayesian techniques, which have large advantages but have
sometimes been discarded in favour of heuristics because naive
approaches (e.g., Gibbâ€™s sampling) to computational Bayes are com-
putationally costly. In this paper, we show how more advanced
approaches (Metropolis-Hastings [22, 25] and Hamiltonian Monte
IMC â€™20, October 27â€“29, 2020, Virtual Event, USA
C. Gray, C. Mosig et al.
Figure 1: Overview of Measurement Infrastructure and BeCAUSe.
Carlo [13]) can find RFD ASs from path measurements. From this
we can learn much about the existing deployment of RFD.
The paper makes the following key contributions:
(1) We present a new group of network tomography algorithms
adapted to the problem of large-scale routing inference chris-
tened BeCAUSe (BayEsian Computation for AUtonomous
SystEms)â€”see Â§ 3 and Â§ 5.
(2) We develop a measurement infrastructureâ€”RFD Beaconsâ€”to
provide the inputs to the tomography problemâ€”see Figure 1
and Â§ 4.
(3) We perform the first large-scale study of the deployment
of RFD in the wild, based on more than 2 months of data.
The results suggest that RFD is used more widely and less
carefully than one would hope or expectâ€”see Â§ 6.
We test BeCAUSe on the RFD and Route Origin Validation infer-
ence problems. We have limited ground truth data, but on that
data BeCAUSe has a precision of 100% and a recall of 87%. More
importantly, BeCAUSe reports not just a number, but also provides
a degree of certainty in its estimates.
2 BACKGROUND
This section briefly introduces Route Flap Damping (RFD), which
is our major measurement object, and binary network tomography.
We explain how to apply binary network tomography inference of
damping ASs from practical Internet measurement.
2.1 Route Flap Damping in BGP
A router configured to use RFD maintains a penalty value per prefix
per BGP session that defines when a prefix should be suppressed
or released. This value is additively increased with each announce-
ment or withdrawal for that prefix, and decreases exponentially
in between. When the penalty exceeds a threshold the prefix is
suppressed until the penalty decays below a second threshold.
We illustrate the RFD mechanics and the interplay of the key con-
figuration parameters in Figure 2. At ğ‘¡0, the penalty is initialised
to 0, and increases by a constant (1000) with each received an-
nouncement (green) or withdrawal (orange). Between each update,
the penalty decreases based on the half-life parameter. When the
penalty surpasses the suppress-threshold at ğ‘¡1 the prefix is with-
drawn. At ğ‘¡2, the prefix stops oscillating and therefore the penalty
reaches the reuse-threshold at ğ‘¡3, leading to the release of the previ-
ously damped prefix.
RFD was introduced 25 years ago. Its patchy history is illustrated
in Figure 3. Much has been learned about RFDâ€™s mechanics [5, 17,
24, 30], but little is known about its deployment.
RFD may not be uniformly deployed throughout an AS. A net-
work operator can limit RFD to specific peers, e.g., only customers.
Reasons may be that some neighbors have proven to be particu-
larly noisy while others provide the only transit to some part of
the Internet and damping its routes may have major implications.
RFD can also be configured differently depending on the prefix
length. We encountered configurations where shorter prefixes were
damped more aggressively in one network and less aggressively in
a different AS.
We develop a method to perform controlled experiments (see
Â§ 4) to identify paths that contain RFD ASs. Having identified RFD
for certain paths, only leaves us with the problem of tracing back
the originating AS(s) on each path. The ideal measurement setup is
a direct peering between measurement probe and vantage point,
which is completely impractical given more than 70k ASs managed
by almost the same number of different organisations across the
globe. Luckily, pinpointing ASs that deploy RFD using path data
can be formulated as a binary network tomography problem.
Figure 2: RFD router perspective: The penalty for a pre-
fix that oscillates between announcement (green) and with-
drawal (orange). The dashed, horizontal lines represent sup-
press and reuse-threshold. While RFD is active, the prefix is
not advertised to neighboring routers, i.e., a withdrawal is
sent just after ğ‘¡1, and only rescinded at ğ‘¡3.
493
Input Signal(RFD Beacons)Data Source(BGP Dumps)Measurement Infrastructure (Â§4)Results (Â§6)Pinpoint ASsNetwork TomographyBeCAUSe (Â§3)Route Flap Damping (Â§5)RPKI Route Origin Validation (Â§7)DAEFCBPath LabelsRFD: yesRFD: noRFD: noABCAEFDFBAS Network100020003000Penalty[Number]RFDActiveSuppressReuset0t1t2t3TimeSentReceivedBGP Beacons, Network Tomography, and Bayesian Computation
IMC â€™20, October 27â€“29, 2020, Virtual Event, USA
Cisco RFD implementation
available [43]
Mao et al. [24]: RFD
exacerbates
convergence
Pelsser et al. [30] publish
improved RFD parameters
IETF publishes relaxed RFD
parameters [17]
1998
2006
2013
2020
1995
2002
RFC 2439
specifies RFD [43]
RIPE recommends
disabling RFD [38]
2011
2015
RIPE recommends relaxed RFD
parameters [5]
Current
measurements
Figure 3: Timeline of Route Flap Damping.
2.2 AS Inference Problems in General
RFD is one of a wider class of problems where we seek to localise
particular routing policies or techniques in the inter-AS network.
Other problems in this space include finding ASs that use a partic-
ular community (some communities are transitive) or that black
hole a particular type of traffic for instance traffic whose origin
(signed through the RPKI) does not validate correctly. Apart from
understanding RFD, we seek to be able to solve a range of such
problems. To that end, we will also test the approach proposed here
on RPKI origin validation.
2.3 Binary Network Tomography
In network measurement it is often impractical to interrogate net-
work artefacts directly, either because of expensive overhead or
(as in our case) because the artefacts have diverse owners who in
many cases are competitors, and who have little interest in sharing
such information. Network tomography can come to the rescue
in these situations. However, our setting is unlike typical network
tomography. In our problem the node properties we seek to find
are not â€œproblemsâ€ per se, so our approach is different though the
differences may appear subtle at first.
The essential nature of network tomography is to reveal inter-
nal characteristics of a network from external observations. For
example, we observe path properties, and wish to infer link or node
properties.
Typical tomography is quantitative, e.g., we observe volume of
traffic, or size of delays, in which case the relationship between node
and path properties are represented as linear equations, however,
there is a strand of work on binary (or Boolean) tomography, which
appears applicable here. Each node (each AS) is considered to either
have property A or not. Paths have property A if at least one node
on the path has property A, and if no nodes have the property, then
the path will not.
We express this mathematically by defining variable ğ‘¥ğ‘– where,
(cid:40)0 if node ğ‘– has property A,
ğ‘¥ğ‘– =
1 if node ğ‘– does not have property A.
Then, path ğ‘— consisting of a set of nodes ğ‘ ğ‘— ideally satisfies

ğ‘–âˆˆğ‘ ğ‘—
ğ‘¦ ğ‘— =
ğ‘¥ğ‘–,
(1)
(2)
494
(cid:40)0 if path j has property A,
where
ğ‘¦ ğ‘— =
1 if path j does not have property A.
(3)
The result is a set of equationsâ€”one for each measurement1.
Ideally, solving these equations would solve the localisation problem
and reveal the damping ASs.
While simple in theory, most tomography problems have a num-
ber of challenges:
(1) There are rarely enough path measurements to obtain a
unique solution and so some side information is needed to
help refine solutions. Steering towards the sparsest solution
is a common strategy when looking for network problems
(which are hoped to be rare) but is not applicable here where
one of the core goals is to identify the ASs that exhibit a
property, not just localise a problem.
(2) The noise inherent in (any set of) measurements may mean
the equations are inconsistent and hence have no solution.
Robust approaches will look for approximate matches, but
once again they often do so by introducing a model (e.g., Gauss-
ian noise) that is not appropriate in routing policy inference.