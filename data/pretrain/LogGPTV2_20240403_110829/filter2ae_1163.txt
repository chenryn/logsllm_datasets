### 内网渗透中的信息收集：Windows工作组篇

#### 引言
据Micropoor所说，渗透测试的核心在于信息搜集。对于目标主机的信息收集越深入，就越能持续地掌握后渗透阶段的权限。

本文旨在对内网渗透过程中针对Windows工作组环境下的信息收集方法进行一个简要总结。请注意，以下内容可能存在不足之处，欢迎各位专家指正。

#### 渗透流程概览
在执行内网渗透时，通常会经历以下几个关键步骤：
- **打点**：初步入侵。
- **提权/维权**：获取或保持高级别访问权限。
- **信息收集**：深入挖掘有价值的数据。

这些步骤往往需要反复操作直至达到最终目的。

#### 常用命令汇总
为了高效地完成上述任务，这里列出了一些常用的命令行工具及其用途：

- `whoami` - 显示当前登录用户的名称及所拥有的权限。
- `systeminfo` - 提供系统详细信息（包括已安装的补丁）以及是否加入了域。
- `hostname` - 获取当前计算机的主机名。
- `net user` - 列出所有用户账户，有助于构建定制化密码字典。
- `quser` - 检查哪些用户正在使用该机器，并特别注意是否有管理员在线。
- `cmdkey /l` - 展示保存在网络上的凭证信息，同时也能显示可访问的IP地址。
- `netstat -nao` - 查看网络连接状态，帮助判断使用的IP段及可能存在的出站限制端口。
- `ipconfig /all` - 完整展示本机的网络配置情况，同样可以用来确认是否属于某个特定域。
- `arp -a` - 显示ARP缓存表中记录的重要通信条目。
- `route print` - 输出路由表信息。

#### 自动探测脚本
下面提供了一个用于自动发现内部网络存活IP段的批处理脚本示例：

```batch
@echo off
rem [Windows] 内网存活段自动发现脚本
rem By Klion
rem 2020.7.1
setlocal enabledelayedexpansion
for /l %%i in (0,1,255) do (
  for /l %%k in (0,1,255) do (
    ping -w 1 -n 1 10.%%i.%%k.1 | findstr "TTL=" >nul || ping -w 1 -n 1 10.%%i.%%k.254 | findstr "TTL=" >nul
    if !errorlevel! equ 0 (echo 10.%%i.%%k.0/24 is alive ! >> alive.txt ) else (echo 10.%%i.%%k.0/24 May be sleeping ! )
  )
)
...
```

此脚本将尝试ping通指定范围内的每个子网的第一个和最后一个IP地址，并根据响应结果将活动网络段写入文件`alive.txt`中。

#### 其他实用技巧
- **获取无线网络密码**：通过解析`netsh wlan show profiles`命令输出来提取并显示已保存的Wi-Fi网络密钥。
- **离线破解远程桌面协议(RDP)密码**：利用Procdump与Mimikatz组合从内存转储中恢复RDP凭据。
- **浏览器密码窃取**：推荐使用开源项目如HackBrowserData实现跨平台的浏览器数据泄露。
- **其他应用程序解密器**：例如SharpDecryptPwd可用于解码Xshell等软件中存储的敏感信息。
- **本地哈希值导出**：采用多种手段从SAM数据库或LSASS进程中提取密码哈希值以备后续分析。
- **网站配置文件定位**：熟悉常见办公自动化(OA)系统的默认文件路径，以便快速找到包含重要设置的*.config文件。

以上只是基础入门指南的一部分，更多进阶知识和技术细节可以在互联网上进一步学习。感谢所有贡献者无私分享的经验与智慧。