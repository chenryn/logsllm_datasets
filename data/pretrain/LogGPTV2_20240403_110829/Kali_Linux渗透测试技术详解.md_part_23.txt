Vendor updates are available. Please see the references for more
References
CVE: CVE-2004-2687
CERT: Warning: database not avalable
Other: http://distcc.samba.org/security.hml
http://web.mvd.nist.gov/view/vuln/detail?vulnld=CVE-2004-2687
http://www.osvdb.org/13378
http://archives.neohapsis.com/archives/bugtraq/2005-03/0183.hml
High (CVSs: 10.0)
slock (0ID: 1.3.6.1.4.1.25623.1.0.103549
图5.47漏洞消息
（8）该界面显示的信息很多，由于篇幅的原因，这里只截取了其中一个较严重的漏洞。
从该界面可以看到192.168.41.142目标主机上存在非常严重的漏洞。漏洞信息包括目标主
机所开发的端口、OID和解决方法等。关于漏洞的报告可以使用前面介绍过的方法进行下载。
5.2.6扫描指定Windows系统漏洞
本小节将介绍使用OpenVAS扫描指定Windows系统漏洞。这些漏洞信息来自在一个
· 145 •
---
## Page 158
第2篇信息的收集及利用
目标网络内指定的Windows目标系统。这里推荐的目标系统为WindowsXP和Windows7。
使用OpenVAS扫描指定Windows系统漏洞的具体操作步骤如下所示。
（1）新建名为Windows Vulnerabilities 的Scan Config。
（2）添加所需的扫描类型，如表5-7所示。
表5-7扫描的类型
Brute force attacks
暴力攻击
Buffer overflow
扫描缓存溢出漏洞
Compliance
扫描Compliance漏洞
Databases
扫描数据库漏洞
Default Accounts
扫描默认用户账号漏洞
Denial of Service
扫描拒绝服务漏洞
FTP
扫描FTP服务器漏洞
Gain a shell remotely
扫描获取远程Shell的漏洞
General
扫描General 漏洞
Malware
扫描网络操作系统漏洞
NMAP NSE
扫描NMAPNSE漏洞
Port Scanners
扫描端口漏洞
Privilege Escalation
扫描提升特权漏洞
Product Detection
扫描产品侦察漏洞
RPC
扫描RPC漏洞
Remote File Access
扫描远程文件访问漏洞
SMTP Problems
扫描SMTP问题漏洞
SNMP
扫描SNMP漏洞
Service detection
扫描服务侦察漏洞
Web Servers
扫描Web服务漏洞
Windows
扫描Windows系统漏洞
Windows:Microsoft Bulletins
扫描Windows系统微软公告漏洞
（3）创建名为WindowsVulnerabilities目标系统。
（4）创建名为WindowsScan扫描任务。
（5）扫描完成后，结果如图5.48所示。
Tasks 1-4of 4（total:4)
Filter: apply_overrides=0 rows=10 first=1 sort=name
Name
Status
Reports
First
Last
Threat
ictions
Local Vulnerabilities
2Apr 26 2014
Apr 26 2014
None
→
Windows Scan
Apr26 2014
Medum
图5.48扫描结果
（6）从该界面可以看到WindowsScan扫描已完成，漏洞情况为Medium。可以在该界
面单击（TaskDetails）图标查看详细信息，如图5.49所示。
（7）从该界面可以了解扫描任务的设置及扫描报告信息，如扫描完成的时间、漏洞情
况及日志。如果想查看更详细的报告，使用前面介绍过的方法下载扫描报告。
· 146 ·
---
## Page 159
第5章
漏洞扫描
Task Details国
Name:
Windows Scan
ID:
cd33c9b3-81b2-4228-9498-1a9c5252f96
Last Modite: Sat.Apr 26 05:81:52 2014
Cneated:
Sat.Apr 26 05:41:27 2014
Scan Config:
Wind
wsvulnerabilit
Alerts:
Schedule:
(Next due: over)
Target:
Slave:
Status:
Reports:
1 (Finished: 1)
Obser
Add to Asset:
Scan Intensity
Maximum concurrently executed NVTs per host: 4
am concurrently scanned hosts:
20
ws Sca
Scan Result
Sat Apr 26 06:41:46 2014
X
图 5.49Task Details
· 147 ·
---
## Page 160
第6章漏洞利用
漏洞利用是获得系统控制权限的重要途径。用户从目标系统中找到容易攻击的漏洞，
然后利用该漏洞获取权限，从而实现对目标系统的控制。为了便于用户练习，本章将介绍
Metasploit发布的Metasploitable2。用户可以将其作为练习用的Linux操作系统。本章将利
用Metasploitable系统上存在的漏洞，介绍各种渗透攻击，如MySQL数据库、PostgreSQL
数据库及Tomcat服务等，其主要知识点如下：
口Metasploitable操作系统；
Metasploit基础；
控制Meterpreter;
口渗透攻击应用：
口免杀Payload生成工具Veil。
6.1Metasploitable操作系统
Metasploitable是一款基于UbuntuLinux的操作系统。该系统是一个虚拟机文件，从
http://sourceforge.net/projects/metasploitable/files/Metasploitable2/网站下载解压之后可以直
接使用，无需安装。由于基于Ubuntu，所以Metasploitable使用起来十分得心应手。
Metasploitable就是用来作为攻击用的靶机，所以它存在大量未打补丁漏洞，并且开放了无
数高危端口。本节将介绍安Metasploitable虚拟机的使用。
安装Metasploitable2的具体操作步骤如下所示。
（1）下载Metasploitables 2，其文件名为Metasploitable-Linux-2.0.0.zip。
（2）将下载的文件解压到本地磁盘。
（3）打开VMwareWorkstation，并依次选择“文件”丨“打开”命令，将显示如图6.1
所示的界面。
图6.1选择Metasploitable 2启动
---
## Page 161
第6章漏洞利用
（4）在该界面选择Metasploitable.vmx，然后单击“打开”按钮，将显示如图6.2所示
的界面。
Metasploitable2-Linux
设备
内存
处理荐
512 MB
8 08
G01 aAG/0
仅建机境式
NAT
UsB控制器
在
hs is
虚拟机洋细信息
配省文件：IW
件董容: Werkstatien 6.5-7x 或N机
图6.2安装的Metasploitable系统
6.2
2Metasploit基础
Metasploit是一款开源的安全漏洞检测工具。它可以帮助用户识别安全问题，验证漏
洞的缓解措施，并对某些软件进行安全性评估，提供真正的安全风险情报。当用户第一次
接触Metasploit渗透测试框架软件（MSF）时，可能会被它提供如此多的接口、选项、变
量和模块所震撼，而感觉无所适从。Metasploit软件为它的基础功能提供了多个用户接口，
包括终端、命令行和图形化界面等。本节将介绍Metasploit下各种接口的使用方法。
6.2.1Metasploit的图形管理工具Armitage
Armitage组件是Metasploit框架中一个完全交互式的图形化用户接口，由Raphael
Mudge所开发。Armitage工具包含Metasploit控制台，通过使用其标签特性，用户可以看
到多个Metasploit控制台或多个Meterpreter会话。
使用Armitage工具。具体操作步骤如下所示。
（1）启动Metasploit服务。在使用Armitage工具前，必须将Metasploit服务启动。否
则，无法运行Armitage工具。因为Armitage需要连接到Metasploit服务，才可以启动。在
令启动Metasploit服务，将输出如下所示的信息：
· 149 ·
---
## Page 162
第2篇信息的收集及利用
[ok]Starting PostgreSQL 9.1 database server:main.
Configuring Metasploit...
Creating metasploit database user 'msf3'..
Creating metasploit database'msf3"..
insserv: warning: current start runlevel(s) (empty) of script *metasploit' overrides LSB defaults (2 3
4 5).
insserv:warning:current stop runlevel(s)(0 1 2 3 4 5 6)of script metasploit overrides LSB
defaults (0 1 6).
从输出的信息中可以看到PostgreSQL9.1数据库服务已启动，并创建了数据库用户和
数据库。
（2）启动Armitage工具。在Kali桌面依次选择“应用程序”KaliLinux“漏洞利用工
具集”丨“网络漏洞利用”armitage命令，如图6.3所示。或者在终端运行armitage命令启
动Armitage工具，如下所示：
root@kali:~# armitage
应用程序量园
4月28日星期一20:28
 办公
Q、信息农量
号
电子
We程序
互联网
密码政击
通用访闪
无线取击
湖润利用工具票
@ BeEF XSS Fram
系线工具
Giscolk由
业余无线电
权限维持
影音
连向工程
其E
压力测试
 H
数字
漏河利用
接告工
LINUX
图6.3启动 armitage 界面
（3）启动armitage工具后，将显示如图6.4所示的界面。
（4）在该界面显示了连接Metasploit服务的基本信息。在该界面单击Connect按钮，
将显示如图6.5所示的界面。
Connect...
-口x
Host
127.0.0.1
Start Metasploit?
X
Port
55553
A Metasploit RPC server is not running or
msf
not accepting connetionsyet Would you
se
like me to start Metaspleit's RPC se'ver
Pass
****
for you?
ConnecHep
图6.4连接Metasploit 界面
图6.5启动Metasploit
（5）该界面提示是否要启动Metasploit的RPC服务。单击“是（Y）”按钮，将显示如
• 150 ·
---
## Page 163
第6章漏洞利用
图6.6所示的界面。
（6）该界面显示了连接Metasploit的一个进度。当成功连接到Metasploit服务的话，
将显示如图6.7所示的界面。
-ox
进度.
B
Connecting to 127.0.0.1:55553
va.netConnectException: Eie速猫
取消
C
图6.6连接Metasploit 界面
图6.7Armitage 初始界面
（7）该界面共有三个部分，这里把它们分别标记为A、B和C。下面分别介绍这三部分。
口A：这部分显示的是预配置模块。用户可以在模块列表中使用空格键搜索提供的模块。
口B：这部分显示活跃的目标系统，用户能执行利用漏洞攻击。
口C：这部分显示多个Metasploit标签。这样，就可以运行多个Meterpreter命令或控
制台会话，并且同时显示。
【实例6-1】演示使用Armitage工具做渗透测试。具
输入
体操作步骤如下所示。
（1）启动Armitage工具，界面如图6.7所示。双该界
192.168.41.0/24
面可以看到默认没有扫描到任何主机。这里通过扫描，找
到本网络中的所有主机，
(2）在Armitage工具的菜单栏中依次选择Hosts|Nmap
图6.8输入扫描范围
ScanQuickScan命令，将显示如图6.8所示的界面。
（3）在该界面输入要扫描的网络范围，这里输入的网络范围是192.168.41.0/24。然后
单击“确定”按钮，将开始扫描。扫描完成后，将显示如图6.9所示的界面。
192.168.41.1
192.168.41.2
192.168.41.146
i
Scse Csmpite
n.192.168
1.235 ar
图6.9扫描结果
· 151 *
---
## Page 164
第2篇信息的收集及利用
（4）从该界面可以看到，弹出了一个扫描完成对话框，此时单击“确定”按钮即可。
并且在目标系统的窗口中，显示了三台主机。这三台主机就是扫描到的主机。从扫描完成
的对话框中可以看到提示建议选择AttacksFindAttacks命令，将可以渗透攻击目标系统。
（5）在菜单栏中依次选择AttacksFindAttacks命令，运行完后将显示如图6.10所示的
界面。
消息
X
Attack Analysis Complete
You will now see an 'Attack' menu attached
to each host in the Targets windov
Happy huntingl
确定
图6.10消息
（6）从该界面可以看到攻击分析完成，并且右击扫描到的主机将会看到有一个Attack
菜单，如图6.11所示。
Armitage
-ox
192.16
on 192.168.41.156 are close
reenes_eer_ran
ETilycms_less_txt
p scanr
t for 192.168.41.170
us,grapr
c MAC Add
AlI 100
00:0C:29:72:B3:35 (VM
on 192.168.41.170 are closec
 for 192.168.41.254
AI1100
: MAC Ad
500:50:56:F3:FF:6AVM
o: Host Is up [0.0000040s late
t for 192.168.41.235
: AlI 100
done:256 1P addre
tsses (7 hosts up) sci
ned in 4.08 sece
图6.11Attack菜单
（7）从该界面可以看到在目标主机的菜单中出现了Attack选项，在该菜单中共有五个
选项。在没有运行FindAttacks命令前，只要Services、Scan和Host三个选项。这里扫描
到的主机屏幕都是黑色，这是因为还没有识别出操作系统的类型。此时可以在菜单栏中依
次选择HostsNmapScanlQuickScan（OSdetect）命令，扫描操作系统类型。扫描完成后，
将显示操作系统的默认图标。
（8）扫描操作系统。扫描完成后，将显示如图6.12所示的界面。
· 152 ·
---
## Page 165
第6章漏洞利用
Armitage
tes sep
192.168.41.1
192.168.41.2
192.168.41.146
px
are)