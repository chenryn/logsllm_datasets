# Part I: 攻击面
## 恶意软件的发展
2017年攻击面中最重要的发展就是勒索软件。
基于网络的勒索软件的出现替代了原有勒索软件活动中的人为参与。对一些攻击者来说，赎金并不重要，重要的是对一些系统和数据的破坏。2018年应该会有更多的勒索软件活动。
### 在2018年，网络攻击的守护者红队应该做好迎接新的、能够自我繁殖和传播的基于网络的威胁。
2017年，攻击者将勒索软件用到了一个新的境界。首先是利用自动化技术将人从中解放出来；其实攻击者融合了蠕虫的功能来造成大规模的破坏，让恶意软件更加有效。
恶意软件的发展非常迅速。2017年5月，WannaCry出现并迅速席卷全球。它利用了黑客组织Shadow
Broker2017年4月中旬泄露的微软Windows永恒之蓝（externalBlue）漏洞。WannaCry勒索软件赎金支付的比特币地址首次提现时金额达到了14.3万美元。对比利用工具Angler，活动期间每年获利约1亿美元。
但是WannaCry并不会记录加密的破坏以及受影响的用户支付的赎金。因此，支付后收到解密密钥的用户数量也是未知的。WannaCry作为勒索软件来说，效率是非常低的，因此美国政府和许多安全研究人员相信WannaCry的赎金知识为了隐藏其真实意图的烟雾弹，该恶意软件的真实意图就是数据擦除。
Nyetya（NotPetya）是2017年6月出现的一款数据擦除的恶意软件。Nyetya伪装成勒索软件，并使用了远程代码执行漏洞eternalBlue、远程代码执行漏洞EternalRomance和其他身份窃取单元。Nyetya是通过一个税务软件包更新系统进行部署的，超过80%的乌克兰公司使用该税务软件，安装了超过100万台设备。乌克兰网络警察确认乌克兰有超过2000家公司受到Nyetya影响。
在这波自我繁殖和传播的勒索软件出现之前，恶意软件是通过3种方式分发的：drive-by download, email,
恶意USB存储设备这样的物理媒介。这3种方法在感染设备或系统时都需要人工交互。而当自我繁殖技术被攻击者采用后，发起基于网络的勒索软件活动只需要一个工作站就足够了。
一些安全专家可能会认为蠕虫是一种比较古老的威胁方式，比如蠕虫的CVE数量持续减少。但自我繁殖的恶意软件不仅是相关的威胁，而且可以攻击整个网络。WannaCry和Nyetya只是一个尝试和先兆，所以防御者需要提前做好准备。
其实WannaCry和Nyetya是可以被预防的，至少造成的危害没有如此之大。究其原因就是企业没有应用基本的安全最佳实践，比如漏洞补丁修复、建立适当的应急响应过程和策略、应用网络隔离等。
#### 安全弱点：供应链
Nyetya攻击实际上也是一种供应链攻击。Nyetya之所以能够成功感染那么多设备的一个原因就是用户没有将自动软件升级当做一种安全风险，甚至没有意识到他们接收到了恶意更新包。
另一个供应链攻击的例子是发生在2017年9月，攻击者利用用来分发合法软件包的软件厂商下载服务器来分发CCleaner。含有木马后门的CCleaner二进制文件用有效证书来签名，让用户一个他们使用的软件是安全的的错觉。攻击活动的目标是使用该软件的大型科技公司（包括部分暗网用户）。
供应链攻击的体量和复杂性都在增加，这回影响大量的设备并对持续驻留几个月甚至几年。防护者应该意识到使用来自非可信厂商的软硬件带来的潜在安全风险。用户在下载新软件前要扫描确认该软件是否含有恶意软件。
## 加密的恶意web流量
迅速增加的加密web流量（包括合法的和非法的web流量）的体量让防护者很难识别、监控出潜在的安全威胁。加密可以增加安全，但是也提供给恶意攻击者一个隐藏C&C活动，也给了攻击者更多的时间来运作和造成伤害。
### 加密恶意web流量是防御者的盲区
思科研究人员发现到2017年10月，全球web流量超过一半是加密过的。与2016年11月相比，增加了12%。驱使这一增长的一个因素是低成本和免费的SSL证书的增长。Google
Chrome计划将所有未使用加密来处理敏感信息的网站标记为不安全。企业为了满足Google的HTTPS加密需求就必须使用加密，否则他们Google搜索的排名也能会降低很多。  
随着全球加密流量体量的增长，攻击者开始将加密作为隐藏C2活动的工具。思科研究人员发现在过去的12个月里，恶意软件样本使用加密网络通信的数量增加了3倍。对超过40万的恶意软件二进制文件进行分析发现，2017年10月有超过70%的比例使用了加密。  
### 使用机器学习和人工智能技术
为了克服加密流量缺乏可见性的问题，研究发现越来越多的企业开始使用机器学习和人工智能技术。这些高级技术可以增强网络的安全防御能力，随着时间的推移能够学习如何自动检测web流量中的不正常模式。
机器学习来自动检测known-known威胁上是非常有效的。而其真正的价值在于监控加密的web流量，并检测known-unknown威胁和unknown-unknown威胁。机器学习技术可以在大量的加密web流量中进行学习，识别出不正常的模式，并自动向安全团队发出告警消息。
在之前的研究（Cisco 2018 Security Capabilities Benchmark
Study）中发现，缺乏有经验的人员是企业中增强安全防御能力的一大障碍。而机器学习和人工智能这样自动化和智能化的工具可以帮助防御者克服技能和资源的差距，让其可以更有效、更好地识别和响应已知和新出现的威胁。
## 邮件威胁
无论威胁场景如何变化，恶意邮件和垃圾邮件仍然是攻击者用来分发恶意软件的重要工具，因为这可以让恶意软件直达终端。
### 垃圾邮件僵尸网络的活动震荡会影响整个体量
2016年底，研究人员发现垃圾邮件活动有明显增长而利用工具活动有明显的减少。当Angler这样的利用工具突然从市场上消失，许多这些工具的使用者会转向邮件来确保他们的利润。从图中，我们可以看出在突然增长后，2017年上半年全球垃圾邮件数量有所回落，随后持平，然后2017年5月底6月初，全球垃圾邮件数量有所下降，而8月份又有所回升。  
2017年1月到4月垃圾邮件体量减少，同时监测到垃圾邮件僵尸网络活动减少，如图9。  
### 垃圾邮件中的恶意文件扩展：top10
研究人员分析了2017年1月到9月的邮件记录，找出了恶意软件家族常用的恶意文件扩展类型。  
通过对恶意文件扩展的分析，研究人员发现即时在当今复杂和熟练的威胁环境下，邮件仍然是恶意软件分发的重要渠道。对企业来说，防御策略的基准包括：  
应用有力的和综合的邮件安全防护工具和策略；  
对员工进行钓鱼邮件和垃圾邮件中的链接和恶意附件威胁的教育。
### 社会工程仍是邮件攻击的重要平台
钓鱼和鱼叉式钓鱼攻击是窃取用户凭证和其他敏感信息的重要和有效的策略。事实上，钓鱼和鱼叉式钓鱼邮件是近年来重大数据泄露事件的根本原因之一。2017年的例子有针对Gmail用户和爱尔兰能源系统的攻击事件。研究人员分析了用户提交的可能的钓鱼邮件，下图是2017年1~10月钓鱼URL和钓鱼域名的数量。从中可以看出钓鱼URL和域名的流行性。  
### TLD(Top level domains)已知钓鱼网站的顶级域名分析
通过分析2017年1月到8月发现的钓鱼网站，一共有326个活跃的TLD，包括.com, .org,
.top等。使用不知名的TLD对攻击者来说是非常有利的，这些域名价格一般都比较便宜，而且隐私保护的价格也不高。  
### 防御者应该注意监控老过时的威胁
2017年，每个月有上万起钓鱼攻击报告给不同国家、地区的反钓鱼威胁情报机构。从中我们发现，攻击者常用来进行钓鱼攻击的技巧和攻击有：
  * Domain squatting相似域名伪造，比如cisc0.com这样的域名。
  * Domain shadowing域名隐藏，隐藏在合法域名下的子域名，如badstuff.cisco.com。
  * 恶意注册的域名，专门用来进行恶意行为的域名，如viqpbe.top。
  * URL缩短：恶意域名用URL缩短技术进行伪造，如bitly.com/random-string.  
注：bitly.com是攻击者最常用的URL缩短工具。恶意的短域名大约占了研究中发现的钓鱼站点的2%，2017年8月恶意短域名的数量达到了3.1%。
  * Subdomain services子域名服务。在子域名服务器上创建的站点，形如mybadpage.000webhost.com。
攻击者在钓鱼和鱼叉式钓鱼攻击中持续改进社会工程的方法，诱使用户点击恶意链接或访问欺诈的web页面，并提供给攻击者身份凭证等高价值的信息。在应对这些威胁时，用户培训、审计、邮件安全技术的应用等都是非常重要的策略。
## 沙箱逃逸技术
### 恶意软件作者在防御者的沙箱中玩游戏
2017年9月，研究人员发现大量的恶意payload在文件关闭后分发的恶意样本。在本例中，恶意软件是被document_close事件触发的。在大多数情况下，文档在沙箱中打开和分析后是不关闭的，因此可以躲避检测。而在现实情况中，当接收者打开附件之后关闭文档，恶意payload就已经开始传播了。恶意软件使用这项技术就可以躲过沙箱检测。
Document_close事件是一个非常聪明的选择，因为它利用了office内置的宏函数，而且用户会打开那些看起来和他们相关的文档。当用户意识到该文档与他们没有关系时，就会关闭文档，此时就触发了恶意软件所隐藏的宏。
另外一种躲避沙箱检测的技术是伪装恶意payload存在的文件类型。如下图所示，2017年5月我们注意到许多嵌入Pdf文档的恶意word文件攻击类型。该文件沙箱绕过的方式可能是因为沙箱只打开和检测pdf文件，而不会打开和分析嵌入其中的word文件。Pdf文件中的内容会诱使用户点击和打开word文档，随之触发恶意行为。  
思科研究人员建议用户使用含有内容检测特征的沙箱来确保恶意软件不使用上面提到的技术来绕过沙箱检测。
## 滥用云服务和其他合法的资源
随着应用、数据和身份信息都迁徙到云上，安全团队必须要管理对失去传统网络边界的风险。攻击者也在利用这个机会来进行攻击，还有一个原因就是不清楚谁应该负责保护这些边界环境，比如云环境和物联网环境。
### 恶意使用合法资源作为后门C&C
当攻击者用合法资源作C&C时，安全团队就很难检测到恶意网络流量，因为模仿了合法网络流量的行为。下图是思科与Anomali研究人员一起整理的过去几年被攻击者用作恶意后门C&C的合法服务的种类。