the digital domain and suppresses the components of the
signal at 295 MHz, employing a narrow Chebyshev type 2
window in order to minimize the eﬀects of the aliasing on
other harmonic components. The results of the ﬁltering are
depicted in Fig. 4: it is now possible to clearly distinguish
the shape of the three DES executions, followed by the same
peak in power consumption regarding what we suppose is the
writeback operation of the 64-bit word into the conﬁguration
fabric.
In order to conﬁrm that we did not discard any informa-
tion relevant for further power analysis, we computed the
variance of both the ﬁltered measurements and also the part
of the measurements that has been discarded by the ﬁlter,
(b) Encrypted
Figure 4: Filtered power consumption measured at
V CCIN T during the time period of the decryption.
i.e., containing the frequency components that have been
blocked by the band block ﬁlter. We recall that, since dif-
ferential power analysis relies on exploiting the diﬀerences
in the power consumption caused by diﬀerent inputs, the
time-wise variance computed over a signiﬁcant number of
traces is a reasonable index of the information contained in
the signal.
Figure 5 presents the computed variances for the time win-
dow pertaining the decryption-encryption-decryption opera-
tions, based on processing 50, 000 diﬀerent inputs. As we can
see, the variance of the part of the signal kept by the ﬁlter
features three distinct peaks at the beginning of each DES
execution and is higher during the encryption process, with
respect to the lower values assumed before and after. In con-
trast, the variance of the discarded signal is practically ﬂat,
suggesting that no information relevant to the decryption
process has been omitted. Therefore it is conceivable that
the oscillating power consumption is actually the power pro-
ﬁle of the PowerPC 401 core embedded in the FPGA. The
core has a reference working frequency of 300 MHz which
seems compatible with our measurements.
The analysis suggests the presence of a large buﬀer em-
ployed to store the result of a whole DES decryption (or
encryption) operation, due to the high variance at the be-
ginning of every DES computation.
It is also possible to
infer the duration of a single DES round from the variance
ﬁgure by simply computing the distance between the peaks:
exactly one DES execution is encompassed between them.
Through calculating this distance we obtain a computation
time for the DES of 217 ns, corresponding to 651 ns for the
execution of three full DES computations. This ﬁgure is well
within the maximum bounds enforced by the JTAG input
rate calculated in Sect. 3.1 which mandates the triple DES
to be faster than 1.94 µs. The peak to peak amplitude of the
decryption signal is roughly 2.8 mV, thus the measurement
WBDES-DDES-DDES-EWB118(a) Kept by the ﬁlter
Figure 6: Correlation for hypothesizing the HD be-
tween the output of the ﬁrst two rounds of each DES
module
(b) Discarded by the ﬁlter
Figure 5: Variance of the power consumption for the
part of the signal kept and discarded by the ﬁlter
setup should have enough sensitivity to capture the diﬀer-
ences in the consumptions of the decryptions of diﬀerent
plaintexts.
3.3.1 Power-Proﬁling the Decryption Engine
Performing a power analysis attack requires to know the
architecture of the target device to select a power model
which matches to its power consumption characteristics. This
information is missing when attacking a black box. Having
identiﬁed the point in time where the triple DES decryption
is performed by the device we thus proceed with investigat-
ing the correct model for the power consumption. During
this proﬁling phase, that aims at determining the underlying
hardware structure of the decryption engine, the secret keys
used for the 3DES are known. Accordingly, we are able to
fully compute the intermediate results of the cipher in every
encryption/decryption round.
We selected three diﬀerent keys in the Xilinx ISE tools
and generated the corresponding key ﬁle and an encrypted
bitstream. After conﬁguring the keys into the FPGA us-
ing a Xilinx programming device we collected 50, 000 power
traces for the same number of ciphertexts (64-bit blocks)1
while sending the encrypted bitstream to the target device
by means of our customized conﬁguration module. In the
following, in order to perform a power analysis of the ac-
quired measurements one needs to align them. For this pur-
pose we applied the cross correlation alignment explained in
Sect. 2.3.1 on the whole trace, band block ﬁlter.
Section 3.3 pinpoints the relevant part of the conﬁgura-
tion process, i.e., when the second bit of a 64-bit ciphertext
packet is sent to the FPGA. The acquired power traces must
hence be related to one of the previous ciphertexts (depend-
ing on the size of the internal buﬀer of the device). In order
to determine which ciphertext belongs to which power trace
we calculated the intermediate values of every DES round,
1Conﬁguring this FPGA, a maximum of around 70, 000 ci-
phertexts are available.
Figure 7: Correlation peaks for HD between the
outputs of all the 16 rounds of the second DES
considering the ﬁrst ciphertext block in the bitstream and
the known key as inputs.
The power consumption model for the analysis was chosen
based on an assumption about the internal DES hardware,
i.e, the common design choice that the state of the cipher is
saved in a buﬀer in every round. Consequently, we computed
the correlation coeﬃcient between the processed measure-
ments and the HD of two consecutive round outputs of the
ﬁrst DES decryption, which is a typical hypothetical power
model when attacking hardware. We supposed diﬀerent re-
lations between the ciphertexts and power traces. For the
hypothesis that the previously sent ciphertext is processed
when sending the current 64-bit packet a strong correlation
appears right after the trigger point (see Fig. 6). As a result,
we could deduce that a 64 bit ciphertext block is processed
two clock cycles after it is fully input into the device. To
gain further insights into the hardware architecture we re-
peated the same for the input of the second and the third
DES executions. The results are shown in Fig. 6: clearly,
the correlation corresponding to each of the three DES runs
can be spotted.
In order to further conﬁrm the presence of a buﬀer be-
tween every round of the DES cipher, we ran a series of
power analyses, this time hypothesizing the HD between the
input and the output of every DES round. Fig.7 depicts the
correlation related to the 16 rounds at hand of the second
DES execution. The correlation peak for the inner buﬀers is
clearly present and the position of the peak shifts forward in
time, increasing with the number of the hypothesized round.
An important point here is the role of the initial permu-
tation (IP) of DES. By trial-and-error we found that re-
liable correlation results are obtained when excluding IP
and IP−1 in the hypothesis. A self-evident hypothetical
power model for attacking the ﬁrst round of the ﬁrst DES
is HD = HW(IP(C) ⊕ Round(IP(C), K)), where C is a 64-
bit ciphertext, “Round” represents the 64-bit DES round
function, and K is the last 48-bit subkey of the ﬁrst DES.
119Accordingly, all the correlation results shown above base on
this hypothetical power model.
Observing that the features of the correlation ﬁgures do
not sport any high frequency features, we tried a more re-
strictive ﬁltering strategy: an additional low-pass ﬁlter with
a cut-oﬀ frequency of 50 MHz was applied to all the collected
traces and the HD-based correlation analysis was repeated.
The results did not show any signiﬁcant change in the shape
and the amplitude of the correlations, thus we proceed in
the actual attack with low-pass ﬁltered traces.
3.4 The V2 DES Engine Internals
We conclude the proﬁling with some assumptions about
the hardware implementation of the 3DES engine inside the
Virtex-II Pro. It is conceivable that it employs a round func-
tion executing a round of the cipher per clock cycle, since
DES employs 8 diﬀerent S-boxes that cannot be shared dur-
ing a round computation. The correlation peaks in Fig. 7
moving forward in time with the targeted round of DES
supports this assumption. The corresponding hypothetical
architecture is depicted in Fig. 8. Due to the Feistel struc-
ture of the cipher, the encryption and decryption can be
realized by 48 successive rounds, supplying the subkeys in
the correct order, and applying the IP before the start of
the ﬁrst round and IP−1 after the last round.
second round of the DES operation. We performed a full
key recovery involving 50, 000 traces by hypothesizing the
HD between a single bit of the output from a DES round
and the previous value being stored in the round buﬀer (for
simplicity consider a bit of the round buﬀer in Fig. 8). Once
the 56-bit key for the ﬁrst DES decryption is known the
input for the subsequent DES encryption is computed and
its 56-bit key (and ﬁnally that of the last DES decryption)
is revealed similarly.
To quantify the minimum sampling frequency required for
a successful key recovery, we further investigated the fact
that the attacks still works if the traces are sampled at a
sensibly lower frequency. Following the fact that we applied
a lowpass ﬁlter at 50 MHz, we applied a 100 times decima-
tion to the traces, i.e., use only every hundredth sampling
point and discard the rest, and repeated all the attacks in
order to see if the reduced traces are still containing enough
information. As a result, all the attacks mentioned up to
now are repeatable on the decimated traces, thus yielding a
signiﬁcant speedup in the required computation time and a
reduction in the memory footprint.
It is possible to recover a 6-bit DES subkey in less than 4
seconds of computation time on a common desktop PC, with
a memory footprint smaller than 20 MB. The whole 112-bit
key of a 2-key triple DES is hence revealed by our attack in
roughly two minutes and the 168-bit key of a 3-key triple
DES in three minutes. The trace decimation also impacts
on the minimum sampling frequency required for the digital
oscilloscope: since the decimated traces are now sampled at
a rate of 100 MS/s this can be regarded as a new lower bound
for the required sampling frequency of the oscilloscope.
3.5.1 Practical Results
Figure 8: Our hypothetical architecture of the in-
ternal triple DES module of Virtex-II Pro FPGA
3.5 Extracting Keys from the Virtex-II
After choosing the proper information leakage model in
the previous section, we now proceed to perform the attack
in a real-world scenario: this time, an FPGA with an un-
known set of keys is attacked. During a normal power-up of
the target device, the adversary measures the power traces
and collects the corresponding ciphertexts contained in the
bitstream. Since the bitstream is encrypted with a secure
cipher, even the simplest design results in the ciphertexts
being uniformly distributed. This allows the attacker to
measure the encryption operation of a whole codebook of
plaintexts for each reasonably sized key hypothesis.
In the case of DES, each subkey of length 48-bit can be
divided into 6-bit parts, since the value of a single bit of the
output of a DES round is inﬂuenced by 6 key bits added to
the input of the S-box computing it, because of the input
width of the DES S-boxes. This allowed us to choose a 6-
bit wide key hypothesis, thus, to reveal the ﬁrst round key
the attack therefore has to be repeated eight times, once for
each key portion considered in the attack. After the ﬁrst
48 bits of the round key have been recovered, the remaining
6 bits of the 56-bit DES key are exposed by attacking the
Figure 9: Results of the DPA attack on 50, 000 traces
employing non decimated lowpass traces targeting
the (a) ﬁrst (b) second (c) third DES execution (cor-
rect key guess in black, the others in gray)
646464644864-16464CLKstart120So far, the same set of 50, 000 power traces (acquired from
loading a single bitstream into the FPGA) was used to pro-
ﬁle the power consumption characteristics of the device and
to perform the actual attacks. To determine the minimum
number of traces required to reveal the complete triple DES
key we have examined all subkeys of all three DES execu-
tions accordingly. As illustrated in Fig. 9 the power con-
sumption right after the trigger signal is disturbed by the
I/O activity, causing that a key-recovery attack on the ﬁrst
DES execution is harder than the others. The result of the
attack over the number of traces for the worst case is shown
by Fig. 10 indicating that with the current attack setup a
minimum of 25, 000 measurements is required for the cor-
rect hypothesis to emerge, albeit the statistical conﬁdence
margin is not high.
The minimum number of required traces is largely af-
fected by the measurement setup and environmental noise.
Depending on these parameters therefore the attacker may
need more traces. Our target FPGA, i.e., XC2VP7, is one
of the smallest variants on the market. Still, the size of its
conﬁguration bitstream (independent of the size of the de-
sign) suﬃces to acquire more than 70, 000 measurements of
diﬀerent ciphertexts being encrypted by the 3DES engine.
Hence, loading of a single bitstream into our target FPGA
during a power-up suﬃces to acquire close to two times more
measurements than required for a successful recovery of the
full secret key — this indicates that our attack can be con-
ducted on real-world products even in a very noisy mea-
surement environment, and while large scale ASIC compo-
nents are embedded in the FPGA chip. Note, that repeating
the measurements for more power-ups does not increase the
number of diﬀerent ciphertexts — still averaging over the
power-ups allows to reduce the noise level.
4.
IMPLICATIONS
In the previous section we have shown that the bitstream
encryption feature aiming to provide IP protection can be
circumvented by extracting the secret keys used for the en-
cryption via power analysis. The complete content of any
Virtex-II Pro protected with bitstream encryption can fall
into the hands of a competitor or criminal — this may im-
ply system-wide damage, if IP such as encryption schemes
and keys programmed into the FPGA, or similar secrets,
are misused or become public. The attacks hence have a
devastating impact on the security of products employing
bitstream encryption in the real-world.
For performing our key-recovery, an attacker needs knowl-
edge about side-channel cryptanalysis, a basic lab measure-
ment setup and physical access to the target device in which
Figure 10: Result of the DPA attacks targeting the
ﬁrst DES as a function of number of traces (correct
key guess in black, the others in gray)
the Virtex-II Pro FPGA is embedded. The only modiﬁca-
tion required to be performed on the product to be attacked
is removing the capacitances which have negative eﬀect on
power measurements. Also, the lithium battery must remain
connected to the FPGA to ensure that the secret keys are
not zeroed. The adversary connects her measurement equip-
ment and powers up the product-under-attack once, while
monitoring the loading of the encrypted bitstream. Finally,
she performs the statistical evaluation on a standard PC to