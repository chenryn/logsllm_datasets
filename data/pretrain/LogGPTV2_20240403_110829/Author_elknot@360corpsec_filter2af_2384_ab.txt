**置信度：**  
也就是以上你分析出结果的可信程度。
钻石模型想要表达的其实就是针对单个安全事件，我们可以得到攻击者为什么想要攻击目标，打算用什么手段去攻击目标。
这里要提醒一点，但凡基于威胁情报做分析的时候一定要牢记以下4点：
>1\. 威胁情报分析出来的结果一般不能作为电子证据确定嫌疑人有计算机犯罪行为  
>2\. 威胁情报分析结果须带有严格的置信度  
>3\. 威胁情报数据由于技术原因限制不可以做到实时性  
>4\. 要在相关机构的监管下进行分析
举个简单的例子来说，我们现在收到了一封附件带有远控木马的钓鱼邮件，并且有人打开了附件，结果机器被远控。这么一个事件用钻石模型分析就如下图表示（源自做废了的ppt）。
这样的话就可以化解为一下步骤：
>1\. 受害者发现PC、服务器出了问题，感染了恶意的软件或者病毒样本  
>2\. 逆向分析恶意的软件，发现了该软件包含了恶意的域名  
>3\. 通过PNDS数据发现C&C域名解析到恶意的Ip地址  
>4\. 通过相关的日志分析判断攻击者曾与C&C接触过  
>5\. 通过IP地址查阅相关的威胁情报数据来获得攻击者的更多细节
### 0x03 Kill-Chain与钻石模型的组合分析：
钻石模型的特点是：可以说明攻击者在单个事件中的攻击目的和所使用的技战术
Kill-Chain模型的特点是：可以说明攻击线路和攻击的进程。
复杂的攻击往往都是有一系列的攻击事件组成的，不同的攻击事件指向的目标和达到的目的可以表示出攻击的进程，那么OK，我们如果把事件按照Kill-Chain进行分类同时使用泳道图进行表示，同时把不同的攻击路线分为不同的攻击线程，那么我们就可以得到一个这样的泳道图。
其实这张图描述的是这么一个事件：
>1.攻击者先对目标进行了Google Hacking操作，获得了他们域名解析记录等一些基础的It信息  
>2.攻击者找到了一个目标新注册的域名，然后用搜索引擎搜索他们的网络管理员的电子邮件信息  
>3.攻击者使用鱼叉邮件方式对目标的网络管理员发送一封带有木马的邮件  
>4.目标的网管（我们叫他网管一号）打开了这封邮件的附件然后不幸中枪  
>5.网管一号的主机因为中了病毒，所以攻击者利用网管一号这台主机发送了一个HTTP Post请求到域控节点，然后域控节点返回了一个HTTP Response  
>6.我们通过对鱼叉邮件中附件进行逆向分析发现里面有两个IP地址，第二个IP地址作为备份，防止第一个失效  
>7.通过C&C请求到网管一号的主机，我们的恶意程序打开了一个TCP代理服务  
>8.通过网管一号主机上的代理服务，攻击者继续去Google上搜索其他的目标  
>9.攻击者检查网管一号邮件的通信录列表去寻找是否拥有目标二号的通讯方式，结果发现了目标二号的首席科学家的联系方式  
>10.攻击者使用攻陷的网管一号的邮箱对目标二号的首席科学家的邮箱发起鱼叉邮件攻击，工具使用和之前一样的  
>11.此时又来了一个攻击者，我们称他为攻击者二号，攻击者一号扫描了目标三号的web服务器  
>12.使用同样的漏洞利用工具攻击发现目标三号主机上的相同的漏洞  
>13.被攻陷的目标三号主机返回一个shell会话给攻击者三号  
>14.目标三号的所有数据被攻击者三号窃取
这样的话使用Kill-Chain和钻石模型分析可以同时get到攻击者的点和想要攻击的目标，同时还知道了他的攻击路径，也就是说这时候我们对攻击者了如指掌了。
### 0x04 基于Kill-Chain的安全防护矩阵：
其实按照Kill-Chain，我们完全可以设计一个基于Kill-Chain的安全防护矩阵，如下图所示：
当然啦，这个仅供参考，=-=。
前面我们说了威胁情报的分类和高级威胁分析方法，接下来我们就来说说如何李用威胁情报来调查攻击者。（由于某些众所周知的原因，里面有些数据我就不提了，怕被查水表）
经过前面两部分，我们现在可以得出来攻击者的一些基础设施信息了，所以我们遇到的事件是这个样子的：
我利用一些比较久的数据来做一下sample，现在填充一些数据，于是乎就变成了这个样子：
以上是通过之前对于整个事件的分析我们可以确定的几点，首先从我们针对整个事件分析的结果来看，我们可以得出来几个很明显的数据点：
>从IP的地理位置来看，攻击者很有可能在境外  
>从攻击者使用的基础设施及域名解析来判断的话，资产很有可能是是被其攻击利用的  
>攻击常用的手段是扫描、SQL注入、暴力破解  
>攻击者攻击的目标是我方的IDC服务器
OK分析到这里我们可以对攻击者有个大概的了解：
>攻击者攻击手段大多都是以探测性质的为主，并没有真正攻击成功。  
>我们可以使用IDS和WAF来阻断攻击者对我们的攻击  
>攻击者太菜
其实绝大多数我们碰到的案例都是这样的，但是领导往往会追问：能查出来这是谁搞的么？
### 0x05 利用威胁情报分析该攻击者：
我们使用威胁情报来调查一下这个攻击者，首先我们从IP和域名入手来分析他的基础设施。通过威胁情报平台来查询这个IP，我们在主流的情报平台上来查询，结果如下。
恩，看上去被标记的地方挺多的，这个时候我们可以认为这个IP是一个恶意的IP（这说的不是废话么！！！），其实这个时候我们分析完基础设施之后应该去看一下这个服务器的大网流量。
这个趋势还可以，不是那么猖狂，峰值差不多10K左右吧，其实Dshield这个数据可以看到套接字信息，这里我就不贴了，我们发现一组套接字数据有点意思：
23.xx.xx.58:80 -> 58.xx.xx.163:4120
这个后面这个IP不停地在访问前面这个IP，而且频率之高，于是我们对这个IP进行了调查，由于前面图贴的挺多的了，我们就贴少点。
呦，厉害了，还有撞库，我们来看一下这个IP到底什么来头，通过开放的DDoSMon可以看到这个IP发起了一些DDoS攻击（打马赛克的IP是被攻击IP，感谢@杨絮）
我们再来看一下这个IP到底在哪儿？
恩，现在基本上清楚了。但是呢，个人还是觉得这个存在一个概率问题，所以结果仅供参考。其实最后溯源出来的完整内容如图所示：
就先写这么多吧，其实我这里没有对这个IP的真实身份进行调查，因为这个是无意义的，因为前面说过，这个攻击者造成的影响其实我们的安全防御体系可以完全抵挡，我们完全没有必要去查到这个人是谁，但是由于要满足领导的好奇心，所以才会去对攻击者进行一个挖掘，最后祝大家多抓黑客，但是一定要在受监管的条件下进行。此篇完结。
相关的PPT：[https://www.slideshare.net/JeremyLi10/application-of-threat-intelligence-in-security-operation?utm_source=slideview&utm_medium=ssemail&utm_campaign=first_clip](http://link.zhihu.com/?target=https%3A//www.slideshare.net/JeremyLi10/application-of-threat-intelligence-in-security-operation%3Futm_source%3Dslideview%26utm_medium%3Dssemail%26utm_campaign%3Dfirst_clip)