4.
CloudTrail will send event logs to the S3 bucket and optionally publish them to
5.
CloudWatch Logs and CloudWatch events as well.
Figure 10 - AWS CloudTrail lifecycle
Logging and Auditing in AWS
[ 198 ]
AWS CloudTrail concepts
CloudTrail events: A record of an activity or an action captured by CloudTrail in
an AWS account. This action can be performed by a user, a role, or any AWS
service that is integrated with CloudTrail for recording events. These events
allow you to get the history of API as well as non-API activities for your AWS
account for all actions performed through the AWS Management Console, CLIs,
AWS SDKs, and APIs.
CloudTrail event history: You get event details for the past seven days by
default. You can view, search, and download these details through CLIs or
through the AWS Management Console for your consumption. This history data
provides insight into activities and actions taken by your users or applications on
your AWS resources and services. 
Trails: You use trails to ensure your CloudTrail events are sent either to a pre-
defined S3 bucket, CloudWatch Logs, or CloudWatch events. It is a configurable
item to filter and deliver your events to multiple sources for storage, monitoring,
and further processing. It is also used to encrypt your CloudTrail event log files
using AWS KMS along with setting up notifications using the Amazon SNS for
delivery of event log files. You can create up to five trails in a region.
Accessing and managing CloudTrail: You can access and manage CloudTrail
through AWS Management Console. This console provides a user interface for
CloudTrail for performing the most common tasks such as : 
Viewing event logs and event history 
Searching and downloading event details
Creating a trail or editing one
Configuring trails for storage, notification, encryption, or
monitoring
Alternatively, you can also use CLIs, CloudTrail APIs, and AWS SDKs to programmatically
access and manage AWS CloudTrail.
Access control: CloudTrail is integrated with IAM, so you can control users and
permissions for accessing CloudTrail in your AWS account. Follow IAM best
practices for granting access and do not share credentials. Use roles instead of
users for all programmatic access and revoke access if service is not accessed for a
while.
Logging and Auditing in AWS
[ 199 ]
AWS CloudTrail benefits
Simplified compliance: You can use AWS CloudTrail for simplifying compliance
audits for internal policies and regulatory standards. AWS CloudTrail supports
automation of event log storage and recording for all activities in your AWS
account. It also integrates seamlessly with AWS CloudWatch Logs that allows
you to search log data, create metric filters for any events that are not following
compliance policies, raise alarms, and send notifications. This automation and
integration enables quicker resolution for investigating incidents and faster
responses to auditor requests with the required data.
User and resource activity visibility: AWS CloudTrail enables you to gain
visibility into user and resource activity for your AWS account by capturing
every single API call, including login to AWS Management Console as well. For
every call it captures, it records information such as who made the call, the IP
address of the source, what service was called, the time of the call, what action
was performed, the response by the AWS resource and so on.
Security analysis and troubleshooting: Using information collected by AWS
CloudTrail, you can troubleshoot incidents in your AWS account quickly and
more accurately. You can also precisely discover operational issues by searching
filtering events for a specific period.
Security automation: Using AWS CloudTrail event logs, you can automate your
security responses for events and incidents threatening security of your
application and resources in your AWS account. This automation is enabled by
AWS CloudTrail integration with AWS CloudWatch events that helps you to
define fully automated workflows for security vulnerabilities detection and
remediation. For example, you can create a workflow that encrypts an Elastic
Block Storage (EBS) volume as soon as a CloudTrail event detects that is was un-
encrypted.
A CloudTrail event captures the following information about an event, as shown in the
following figure:
Event time
User name
Event name 
Resource type
AWS access key
Logging and Auditing in AWS
[ 200 ]
Event source
AWS region
Error code
Request ID
Event ID
Source IP address
Resources Referenced
The following figure shows a couple of events in the CloudTrail event log. You can see the
user name, such as root and S3LambdaPutFunction:
Figure 11 - AWS CloudTrail events
AWS CloudTrail use cases
Compliance aid: Uses the history of all activities to verify if your environment
was compliant at a given period in time. IT auditors can use AWS CloudTrail
event log files as a compliance aid. The following figure depicts a typical
workflow for a compliance audit activity that includes AWS resource
modifications log, verification of log integrity, and log review for unauthorized
access:
Logging and Auditing in AWS
[ 201 ]
Figure 12 - AWS CloudTrail compliance audit workﬂow
Security analysis and automation: IT and security administrators can perform
security analysis and automate the response by analyzing user behavior and
patterns present in log files. The following figure shows a workflow for one such
scenario. A trail is a setup for logging user activity. These logs are ingested into a
log management, and analytics system for analyzing user behavior for any 
suspicious activity. An automated action can neutralize a security threat based on
analysis since logs are delivered in near real-time:
Figure 13 - AWS CloudTrail security analysis workﬂow
Logging and Auditing in AWS
[ 202 ]
Data exfiltration: You can also detect unauthorized data transfer for any of your
resources in your AWS account through the CloudTrail event history. The
following figure depicts a workflow for detecting one such activity based on a
data event log stored in the S3 bucket. Once this suspicious activity is detected,
the security team is notified for further investigation and actions:
Figure 14 - AWS CloudTrail data exﬁltration workﬂow
Operational issue troubleshooting: DevOps engineers and IT administrators can
track changes and resolve operational issues by using API call history available in
the AWS CloudTrail. This history includes details of creation, modification,
deletion of all your AWS resources such as security groups, EC2 instances, S3
buckets, and so on. The following figure shows an example of an operational
issue caused by a change to an AWS resource. This change can be detected by
filtering CloudTrail API activity history for this resource name, such as the name
of the EC2 instance. Once the change is identified, it can either be rolled back or 
corrective actions can be taken to resolve operational issues related to this EC2
instance:
Figure 15 - AWS CloudTrail operational issue troubleshooting workﬂow
Logging and Auditing in AWS
[ 203 ]
Security at Scale with AWS Logging
Logging and monitoring of API calls are considered best practices for security and
operational control. These are also often required by industry regulators and compliance
auditors for organizations operating in highly regulated domains such as finance,
healthcare, and so on. AWS CloudTrail is a web service that logs all API calls in your AWS
environment. In this section, we are going to learn about the following five common
requirements for compliance around logging and how AWS CloudTrail satisfies these
requirements. These five requirements are extracted from the common compliance
frameworks, such as PCI DSS v2.0, FEDRAMP, ISO 27001:2005, and presented in the form
of controls and logging domains:
Control access to log files: One of the primary logging requirements is to ensure
that access to log files is controlled. AWS CloudTrail integrates with AWS IAM to
control access to log files. Log files that are stored in S3 buckets have access
control in the form of bucket policies, access control lists as well as multi-factor
authentication (MFA) for secured access. You can control unauthorized access to
this service and provide granular read and write access to log files through
various features available in AWS.
Receive alerts on log file creation and misconfiguration: A logging service
should send alerts whenever a log file is created or if it fails to create a log due to
an incorrect configuration. When AWS CloudTrail delivers log files to S3 buckets
or to CloudWatch Logs, event notifications can be configured to notify users
about new log files. Similarly, when a log file fails to generate, AWS CloudTrail
can send notifications through SNS in the AWS Management Console.
Manage changes to AWS resources and log files: One of the primary
requirements for many compliance audits is providing change logs for all
resources for addition, deletion, and modification along with security of this
change log itself. AWS CloudTrail stores change logs by capturing system change
events for all AWS resources for any change in the state by API calls made
through AWS Management Console, AWS SDKs, APIs, or CLIs. This API call log
file is stored in S3 buckets in an encrypted format. It can be further secured by
enabling MFA and using IAM to grant read-only access for these S3 buckets.
Logging and Auditing in AWS
[ 204 ]
Storage of log files: Many regulatory compliance programs and industry
standards require you to store your log files for varying periods ranging from a
year to many years. For example, PCI DSS compliance requires that log files are
stored for one year; HIPPA compliance requires that log data is stored for a
period of six years. AWS CloudTrail seamlessly integrates with S3 to provide you
secure, durable, highly available, and scalable storage without any administrative
overhead. Moreover, you can set up lifecycle policies in S3 to transition data to
the Amazon Glacier for archival purposes, while maintaining durability, security,
and resiliency of your log data. By default, logs are set for an indefinite expiration
period in AWS CloudTrail, and you can customize this expiration period starting
from one day and going up to 10 years.
Generate customized reporting of log data: API call logs are used for analyzing
user behavior and patterns by security experts and IT administrators. AWS
CloudTrail produces log data with more than 25 fields to give you insights about
system events for your AWS resources. You can use these fields to create
comprehensive and customized reports for all users who accessed your resources
by any medium. You can use log analysis tools for consuming near real-time log
files generated by AWS CloudTrail and delivered to S3 buckets and other
destinations of your choice. Moreover, AWS CloudTrail Logs events to enable
and disable logging in AWS CloudTrail, thus allowing you to track whether the
logging service is on or off.
AWS CloudTrail best practices
Let us look at best practices for AWS CloudTrail:
Enable CloudTrail in all regions to track unused regions. It is a one-step
configurable option that will ensure all activities are logged across all AWS
regions.
Enable log file validation; this is used to ensure integrity of a log file. These
validated log files are invaluable during security audits and incident
investigations.
Always encrypt your logs at rest to avoid unauthorized usage of your log data.
Always integrate AWS CloudTrail with CloudWatch Logs to configure metrics,
alarms, searches, and notifications for your log data.
Centralized logs from all your AWS accounts are used for a comprehensive and
consolidated overview of your IT environment. Use the cross region replication
feature of S3 to store all logs in one central location.
Logging and Auditing in AWS
[ 205 ]
Enable server access logging for S3 buckets that are storing CloudTrail log files to
ensure all unauthorized access attempts are identified.
Enforce MFA for deleting S3 buckets storing CloudTrail log data.
Use IAM to restrict access to S3 buckets storing CloudTrail Logs. Also ensure
write-only access for AWS CloudTrail is restricted to designated users.
Auditing in AWS
AWS engages with third party auditors and external certifying agencies to ensure all the
controls, processes, and systems are in place for continuous compliance with various
programs, certifications, compliance, standards, reports, and third party attestations.
Responsibility for auditing all controls and layers above physical resources in AWS lies
with the customer, as we learnt while going through AWS shared security responsibility
model. AWS provides all certifications and reports for reviews to the auditors.
AWS provides a customer compliance center to enable its customers to achieve greater
security and compliance in the cloud. This center provides multiple resources such as case
studies and white papers to learn ways to achieve compliance from AWS customers in
highly regulated industries. It has a comprehensive set of resources and documentation to
get your cloud governance plan in action. Visit https:/​/​aws.​amazon.​com/​compliance/
customer-​center/​ to find out more about the customer compliance center at AWS.
AWS has an auditor learning path, designed for users in auditor, compliance, and legal
roles. It teaches skills to audit all solutions deployed on the AWS cloud. AWS has case
studies, white papers, auditing guides, checklists, audit guidelines and various self paced,
virtual classroom and instructor led training in place to learn about auditing your resources,
solutions, and IT environment in AWS cloud to ensure compliance. Visit https:/​/​aws.
amazon.​com/​compliance/​auditor-​learning-​path/​ to find out about the AWS auditor
learning path.
In this section, we are going to learn about AWS services that help us with auditing in
various capacities, such as auditing resource configuration through AWS Config or auditing
security best practices through AWS Trusted Advisor. We will look through the AWS
Service Catalog to ensure compliance by allowing pre-defined resources to be provisioned
in our AWS environment. We will begin by learning about AWS Artifact, a fully managed
self-service portal for accessing and downloading all industry certificates and compliance
documents for your AWS resources that are required by your internal and external
auditors.
Logging and Auditing in AWS
[ 206 ]
AWS Artifact
AWS Artifact is an audit and compliance, self-service portal for accessing and downloading
AWS Security and compliance reports and agreement without any additional charge. These 
reports include AWS Service Organization Control (SOC) reports, FedRAMP Partner
Package, ISO 27001:2013, and so on from accreditation bodies across geographies and
industry verticals that verify and validate AWS Security controls. AWS Artifact is accessible
from the AWS Management Console. 
You can use it for verifying and validating security control for any vertical in any
geography. It helps you to identify the scope of each audit artifact, such as AWS service or
resources, regions, and audit dates as well. AWS Artifact allows you to perform internal
security assessments of your AWS resources. You can continuously monitor and assess the
security of your AWS environment as audit reports are available as soon as new reports are
released. There are agreements available in the AWS Artifact, such as the Business
Associate Addendum and the Non Disclosure Agreement (NDA).
The following image shows key AWS certifications and assurance programs. You can use
AWS Artifact to download reports related to these certifications and programs along with
many other programs and certifications:
Figure 16 - AWS certiﬁcations and assurance programs
Logging and Auditing in AWS
[ 207 ]
AWS Config
AWS Config is a fully managed AWS service that helps you capture the configuration
history for your AWS resources, maintain resource inventory, audit, and evaluate changes
in resource configuration, and enables security and governance by integrating notifications
with these changes. You can use it to discover AWS resources in your account, continuously
monitor and evaluate resource configuration against desired resource configuration, export
configuration details for your resource inventory, and find out the configuration details for
a resource at given point in time.
A resource is any object that you create, update or delete in AWS, such as an EC2 instance, a
S3 bucket, a security group, or an EBS volume. AWS Config is used to assess compliance as
per internal guidelines for maintaining resource configurations. It enables compliance
auditing, security analysis, resource change tracking, and operational troubleshooting. The
following image shows the workflow for AWS Config, shown as follows:
A configuration change occurs for your AWS resource.
1.
AWS Config records this change and normalizes it.
2.
This change is delivered to a configurable S3 bucket.
3.
Simultaneously, Config will evaluate this change against your desired
4.
configuration rules.
Config will display the result of configuration evaluation, it can send notifications
5.
of this evaluation as well if required.
Figure 17 - AWS Conﬁg workﬂow
Logging and Auditing in AWS
[ 208 ]
AWS Config use cases
Continuous audit and compliance: AWS Config continuously validates and
assesses the configuration of your resources against the configuration required as
per your internal policies and compliance requirements. It also generates reports
for your resource inventory and AWS infrastructure configurations for your
auditors.
Compliance as code: You can enable your system administrators to codify your
best practices as Config rules for your resources to ensure compliance. These
config rules can be custom rules created in AWS Lambda as per your compliance
requirement. You can set up a rule as a periodic rule to run at configurable
frequency or as a change triggered rule to run when a change is detected in
resource configuration. AWS Config allows you to enforce self-governance
among your users and automated assessments.
Security analysis: Config rules can aid security experts in detecting anomalies
arising out of a change in resource configuration. With the help of continuous
assessment, security vulnerabilities can be detected in near real-time and the
security posture of your environment can be examined. You can create 50 rules in
your AWS account. This is a soft limit and can be increased by contacting the
AWS Support.
The following figure shows a typical AWS Config dashboard. On the top left of the image, it
shows Total resource count as 53 for this AWS account. There is 1 Noncompliant rule(s)
and there are 2 noncompliant resources(s). It also gives details about noncompliant rules,
in this case it is encrypted-volumes:
Figure 18 - AWS Conﬁg dashboard
Logging and Auditing in AWS
[ 209 ]
AWS Trusted Advisor
AWS Trusted Advisor provides you with recommendations and real-time guidance on the
following four areas to optimize your resources as per AWS best practices:
Cost optimization
Performance
Security
Fault tolerance
This service analyzes and checks your AWS environment in real-time on an ongoing basis.
It integrates with AWS IAM so you can control access to checks as well as to categories. The
status of these checks is displayed in the AWS Trusted Advisor dashboard under the
following color coded scheme:
Red: Action recommended
Yellow: Investigation recommended
Green: No problem detected
For all checks where the color is red or yellow, this service will provide alert criteria,
recommended actions, and investigations along with resource details, such as details of the
security groups that allow unrestricted access for specific ports.
By default, six core checks are available for all AWS customers, without any additional
charges, to improve security and performance. These checks include five checks for security
and one check for performance, that is, service limits, IAM use, security groups-unrestricted
ports, MFA on root account, Elastic block storage public snapshot, and RDS public
snapshot.
You can track any changes to status checks as most recent changes are placed at the top of
the list in the AWS Trusted Advisor dashboard. You can refresh checks individually or
refresh all at once. You can refresh a check once it is not refreshed for 5 minutes.
For other checks that are available with business or enterprise AWS support plans, you get
the full benefits of AWS Trusted Advisor service. Apart from checks, you also get access to
notifications with AWS weekly updates for your resource deployment. Alongside this, you
also get programmatic access to AWS Trusted Advisor through the AWS Support API. This
programmatic access allows you to retrieve and refresh AWS Trusted Advisor results.