# 【技术分享】Linux取证技术实践
|
##### 译文声明
本文是翻译文章，文章来源：countuponsecurity.com
原文地址：
译文仅供参考，具体内容表达以及含义原文为准。
****
****
翻译：[华为未然实验室](http://bobao.360.cn/member/contribute?uid=2794169747)
预估稿费：200RMB
投稿方式：发送邮件至linwei#360.cn，或登陆网页版在线投稿
**  
**
**前言**
本文将介绍Linux取证技术并予以实践。我将执行一系列步骤，以分析从运行红帽操作系统的受损系统获取的磁盘。我首先是识别文件系统、挂载不同的分区、创建一个[超级时间轴](https://countuponsecurity.com/2015/11/23/digital-forensics-supertimeline-event-logs-part-i/)和一个文件系统时间轴。我还快速查看了工件，然后解挂了不同的分区。我将跳过如何获取磁盘的过程，不过可点击[此处](https://digital-forensics.sans.org/blog/2010/09/28/digital-forensics-copy-vmdk-vmware-virtual-environment/)了解如何从VMware ESX主机获取磁盘镜像。
**Linux取证技术实践**
从ESX主机获取不同的磁盘文件时，你需要VMDK文件。然后，你将其移到你的实验室，这可能很简单，，因为你的笔记本电脑使用SIFT工作站运行虚拟机。要分析VMDK文件，你可以使用“libvmdk-utils”软件包，该软件包包含用于访问存储在VMDK文件中的数据的工具。不过另一种方法是将VMDK文件格式转换为RAW格式。如果采用后一种方法，运行不同工具将会更容易，比如[Sleuth
Kit](https://www.sleuthkit.org/)中的工具（将针对镜像大量使用）。要执行转换，可以使用QEMU磁盘镜像实用程序。步骤如下图所示。
之后，你可以从磁盘镜像列出分区表，并使用“mmls”实用程序获取有关每个分区起始位置（扇区）的信息。然后，使用起始扇区，并使用“fsstat”实用程序查询与文件系统相关的详细信息。从下图可以看到，“mmls”和“fsstat”实用程序能够识别第一个分区“/boot”，
类型为0x83 (ext4)。但是，“fsstat”无法识别从扇区1050624起始的第二个分区。
这是因为此分区的类型为0x8e（[逻辑卷管理器](https://www.centos.org/docs/5/html/Deployment_Guide-en-US/ch-lvm.html)）。如今，许多Linux发行版默认使用LVM（逻辑卷管理器）方案。LVM使用允许将硬盘驱动器或一组硬盘驱动器分配给物理卷的抽象层。物理卷组合成逻辑卷组，逻辑卷组可以分为具有挂载点和ext4等文件系统类型的逻辑卷。
使用“dd”实用程序，你可以轻松看到LVM2卷的存在。为了使其可用于我们不同的取证工具，我们需要从LVM分区表创建设备映射，其将通过创建环回设备并进行映射来自动创建分区设备。然后，我们使用管理LVM卷的不同实用程序，比如“pvs”、“vgscan”及“vgchange”。下图显示了执行此操作的必要步骤。
在激活LVM卷组之后，我们有六个设备映射到六个挂载点，这些挂载点生成了该磁盘的文件系统结构。下一步是将不同的卷作为只读挂载，因为我们将挂载正常设备进行取证分析。因为创建一个匹配分区方案的文件夹结构非常重要。
挂载磁盘后，通常可以通过创建[时间轴](https://countuponsecurity.com/2015/11/23/digital-forensics-supertimeline-event-logs-part-i/)来开始进行取证分析和调查。这是一个非常有用的关键步骤，因为其包含有关以人可读格式修改、访问、更改及创建的文件的信息，称为MAC时间证据（修改的、访问的、更改的）。此活动有助于查找事件发生的特定时间和顺序。
在我们创建我们的时间轴之前，值得注意的是，在Linux文件系统（如ext2和ext3）中，没有关于文件创建/生成时间的时间戳。只有3个时间戳。ext4中引入了创建时间戳。Dan
Farmer和Wietse Venema的“The Forensic Discovery 1st Edition”一书概述了不同的时间戳：
最后修改时间。对于目录，是指最后一次添加、重命名或删除条目的时间。对于其他文件类型，是指最后一次写入文件的时间。
最后访问（读取）时间。对于目录，是指最后一次被搜索的时间。对于其他文件类型，是指最后一次文件被读取的时间。
最后状态更改。状态更改的例子有：所有者的变更、访问许可的更改、硬链接计数的更改或任何MAC时间的显式更改。
删除时间。Ext2fs和Ext3fs在dtime时间戳中记录文件被删除的时间，但并不是所有的工具都支持它。