```
# service samba restart
# testparm 
```
[![](https://camo.githubusercontent.com/eadd0a7b8371b92c273b82cc6331c694adfec00c/68747470733a2f2f6661726d362e737461746963666c69636b722e636f6d2f353538392f31343635333635353339305f626563623466343938315f7a2e6a7067)](https://camo.githubusercontent.com/eadd0a7b8371b92c273b82cc6331c694adfec00c/68747470733a2f2f6661726d362e737461746963666c69636b722e636f6d2f353538392f31343635333635353339305f626563623466343938315f7a2e6a7067)
如果有错误，在testparm结束后会报告。
### 在Windows 7计算机上将Samba共享映射为一个网络驱动器
在计算机上右击，然后选择“映射网络驱动器”：
[![](https://camo.githubusercontent.com/1a7396f10bb45788f17693671c2f54a9e124289c/68747470733a2f2f6661726d362e737461746963666c69636b722e636f6d2f353537312f31343833373939333135345f393831623733656139322e6a7067)](https://camo.githubusercontent.com/1a7396f10bb45788f17693671c2f54a9e124289c/68747470733a2f2f6661726d362e737461746963666c69636b722e636f6d2f353537312f31343833373939333135345f393831623733656139322e6a7067)
输入安装了Samba的机器的IP地址，后跟共享名（就是smb.conf文件中方括号括起来的那个名称），然后确保选中了“使用不同的凭据连接”：
[![](https://camo.githubusercontent.com/6bc308f7248109fff5bac2b751506fa537149765/68747470733a2f2f6661726d342e737461746963666c69636b722e636f6d2f333838312f31343833393939373137325f643637656339383933335f6f2e706e67)](https://camo.githubusercontent.com/6bc308f7248109fff5bac2b751506fa537149765/68747470733a2f2f6661726d342e737461746963666c69636b722e636f6d2f333838312f31343833393939373137325f643637656339383933335f6f2e706e67)
输入先前用‘**smbpasswd -a**’设置的用户名和密码：
[![](https://camo.githubusercontent.com/230be973bb546169b360b015192c1cb13331369e/68747470733a2f2f6661726d362e737461746963666c69636b722e636f6d2f353536332f31343635333731313032395f646466656135336264365f6f2e706e67)](https://camo.githubusercontent.com/230be973bb546169b360b015192c1cb13331369e/68747470733a2f2f6661726d362e737461746963666c69636b722e636f6d2f353536332f31343635333731313032395f646466656135336264365f6f2e706e67)
进入计算机，然后检查网络驱动器是否被正确添加：
[![](https://camo.githubusercontent.com/6bde1fcf5e8f1ba06d8edebb865f32b4c580a47f/68747470733a2f2f6661726d362e737461746963666c69636b722e636f6d2f353538342f31343833373939333132345f633636343732383033395f6f2e706e67)](https://camo.githubusercontent.com/6bde1fcf5e8f1ba06d8edebb865f32b4c580a47f/68747470733a2f2f6661726d362e737461746963666c69636b722e636f6d2f353538342f31343833373939333132345f633636343732383033395f6f2e706e67)
作为测试，让我们从Samba的手册页创建一个pdf文件，然后保存到/home/xmodulo目录：
[![](https://camo.githubusercontent.com/0a098b21326bc6365f0ea434f446ae76376e50d6/68747470733a2f2f6661726d362e737461746963666c69636b722e636f6d2f353539332f31343836303231393732335f653833383066306430665f6f2e706e67)](https://camo.githubusercontent.com/0a098b21326bc6365f0ea434f446ae76376e50d6/68747470733a2f2f6661726d362e737461746963666c69636b722e636f6d2f353539332f31343836303231393732335f653833383066306430665f6f2e706e67)
接下来，我们可以验证该文件是否可以从Windows读取：
[![](https://camo.githubusercontent.com/8d38472d1a5104e28dba3442a23fb5f9751d290e/68747470733a2f2f6661726d342e737461746963666c69636b722e636f6d2f333836392f31343831373338363639365f373461313264666463645f6f2e706e67)](https://camo.githubusercontent.com/8d38472d1a5104e28dba3442a23fb5f9751d290e/68747470733a2f2f6661726d342e737461746963666c69636b722e636f6d2f333836392f31343831373338363639365f373461313264666463645f6f2e706e67)
然后检查我们是否能够用默认的pdf阅读器打开它：
[![](https://camo.githubusercontent.com/007dcf697a0ee4a2755e20550d3b541f943e88db/68747470733a2f2f6661726d362e737461746963666c69636b722e636f6d2f353538342f31343635333635353335305f386132343362313439335f7a2e6a7067)](https://camo.githubusercontent.com/007dcf697a0ee4a2755e20550d3b541f943e88db/68747470733a2f2f6661726d362e737461746963666c69636b722e636f6d2f353538342f31343635333635353335305f386132343362313439335f7a2e6a7067)
最后，让我们看看我们是否能在Windows中刚刚映射的驱动器上保存文件。我们将打开change.log文件，该文件列出了Notepad++的功能：
[![](https://camo.githubusercontent.com/52169af0f6a32d6ff0030f8756c092e18ae92136/68747470733a2f2f6661726d362e737461746963666c69636b722e636f6d2f353536352f31343831373338363637365f313863316437626336305f6f2e706e67)](https://camo.githubusercontent.com/52169af0f6a32d6ff0030f8756c092e18ae92136/68747470733a2f2f6661726d362e737461746963666c69636b722e636f6d2f353536352f31343831373338363637365f313863316437626336305f6f2e706e67)
然后试着将它作为普通文本文件（.txt扩展名）保存到Z:\；然后让我们看看该文件是否能在Linux中看到：
[![](https://camo.githubusercontent.com/20ce5a9b7137fb30f93b479fa93f4d5547d24d47/68747470733a2f2f6661726d342e737461746963666c69636b722e636f6d2f333834312f31343831373338363635365f666230396139356136355f6f2e706e67)](https://camo.githubusercontent.com/20ce5a9b7137fb30f93b479fa93f4d5547d24d47/68747470733a2f2f6661726d342e737461746963666c69636b722e636f6d2f333834312f31343831373338363635365f666230396139356136355f6f2e706e67)
### 启用磁盘配额
作为第一步，我们需要验证当前内核是否已经编译为支持配额：
```
# cat /boot/config-$(uname -r) | grep 
```
[![](https://camo.githubusercontent.com/277bb8985cd49586a8b1e6790a4931c4f9e8dbc7/68747470733a2f2f6661726d342e737461746963666c69636b722e636f6d2f333836372f31343833373939333035345f303831646339623064635f7a2e6a7067)](https://camo.githubusercontent.com/277bb8985cd49586a8b1e6790a4931c4f9e8dbc7/68747470733a2f2f6661726d342e737461746963666c69636b722e636f6d2f333836372f31343833373939333035345f303831646339623064635f7a2e6a7067)
每个文件系统最多有5种类型，能够强制使用的配额限制：用户软限制，用户硬限制，组软限制，组硬限制，以及宽限期限。
我们现在将为/home文件系统启用磁盘配额，在/etc/fstab文件对应的/home文件系统行现存的默认选项后添加usrquota和grpquto挂载选项，然后重新挂载文件系统以令修改生效：
[![](https://camo.githubusercontent.com/47dbc7484c82214b55da7edabb02b21b4e6fd4b2/68747470733a2f2f6661726d362e737461746963666c69636b722e636f6d2f353536312f31343635333830363036375f623862306463323333335f7a2e6a7067)](https://camo.githubusercontent.com/47dbc7484c82214b55da7edabb02b21b4e6fd4b2/68747470733a2f2f6661726d362e737461746963666c69636b722e636f6d2f353536312f31343635333830363036375f623862306463323333335f7a2e6a7067)
接下来，我们需要在**/home**目录创建两个文件以用于作为用户和组配额的数据库文件：**aquota.user**和**aquota.group**。然后，我们将生成启用配额后每个文件系统的当前磁盘使用表：
```
# quotacheck -cug /home
# quotacheck -avugm 
```
[![](https://camo.githubusercontent.com/36ce6e3b6f2573e96a88afc639a23501a64735b2/68747470733a2f2f6661726d362e737461746963666c69636b722e636f6d2f353538342f31343833373236353937315f363534653866336263305f6f2e706e67)](https://camo.githubusercontent.com/36ce6e3b6f2573e96a88afc639a23501a64735b2/68747470733a2f2f6661726d362e737461746963666c69636b722e636f6d2f353538342f31343833373236353937315f363534653866336263305f6f2e706e67)
尽管已经为/home文件系统启用磁盘配额，我们还没有给任何用户或组设置权限。检查现有用户/组的配额信息：
```
# quota -u 
# quota -g  
```
[![](https://camo.githubusercontent.com/3f2ea264b3b3d92da3c23a8619441ef290985aa6/68747470733a2f2f6661726d362e737461746963666c69636b722e636f6d2f353538322f31343635333733353834385f386465383864363963345f6f2e706e67)](https://camo.githubusercontent.com/3f2ea264b3b3d92da3c23a8619441ef290985aa6/68747470733a2f2f6661726d362e737461746963666c69636b722e636f6d2f353538322f31343635333733353834385f386465383864363963345f6f2e706e67)
在这最后几步中，使用quotatool命令来为每个用户和/或组来分配磁盘配额（注意，该任务也可以使用edquota来完成，但是quotatool更为直接，更不易犯错）。
要为用户xmodulo设置软限制为4MB，硬限制为5MB，xmodulo组为10MB/15MB：
```
# quotatool -u xmodulo -bq 4M -l '5 Mb' /home
# quotatool -g xmodulo -bq 10M -l '15 Mb' /home 
```
[![](https://camo.githubusercontent.com/3a83240f44647884116f9b23d2354853c92bbccf/68747470733a2f2f6661726d342e737461746963666c69636b722e636f6d2f333838382f31343635333830363033375f353433386235303334655f7a2e6a7067)](https://camo.githubusercontent.com/3a83240f44647884116f9b23d2354853c92bbccf/68747470733a2f2f6661726d342e737461746963666c69636b722e636f6d2f333838382f31343635333830363033375f353433386235303334655f7a2e6a7067)
我们可以在Windows 7中看到结果（4.00MB中有3.98MB空闲）：
[![](https://camo.githubusercontent.com/05a3e1f949adee7651829a4a310c14cb6577882c/68747470733a2f2f6661726d342e737461746963666c69636b722e636f6d2f333931392f31343635333830353936375f633262313535313836395f6f2e706e67)](https://camo.githubusercontent.com/05a3e1f949adee7651829a4a310c14cb6577882c/68747470733a2f2f6661726d342e737461746963666c69636b722e636f6d2f333931392f31343635333830353936375f633262313535313836395f6f2e706e67)
---
via: 
作者：[Gabriel Cánepa](http://xmodulo.com/author/gabriel) 译者：[GOLinux](https://github.com/GOLinux) 校对：[Caroline](https://github.com/carolinewuyan)
本文由 [LCTT](https://github.com/LCTT/TranslateProject) 原创翻译，[Linux中国](http://linux.cn/) 荣誉推出