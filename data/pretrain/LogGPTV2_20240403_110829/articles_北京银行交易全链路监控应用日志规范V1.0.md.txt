**北京银行"交易全链路监控"**
**应用日志规范**
1.  **版本管理**
  ------------------------------------------------------------------------
  **编号**    **日期**     **描述**    **版本**    **作者**    **备注**
  ----------- ------------ ----------- ----------- ----------- -----------
  1           20190513     初始版本    V1.0        亢晓光      
  ------------------------------------------------------------------------
2.  **应用日志规范**
**2.1 日志记录项**
各应用系统日志需要包含19项内容，且日志记录字段须严格区分大小写、拼写详情如下：
1\. traceid（必填）;
2\. spanid（必填）；
3\. parentspanid（必填）;
4\. starttime（span开始时间，必填，精确到毫秒级,格式:
"yyyyMMddHHmmssSSS"）；
5\. endtime（span结束时间，必填，精确到毫秒级,格式:
"yyyyMMddHHmmssSSS"）；
6\. errorcode（错误码，必填）；
7\. errormessage（错误信息，必填，错误码对应中文名称）；
8\. errortype(错误类型，必填，0：自身；1：非自身；2：超时;
当交易正常时，记录为空)；
9\.
service（必填，用于判断同一个系统内部的不同服务，以大数据为例，可区分为数据前置，规则引擎，外部数据三个，如果系统内service唯一，则为新通讯规范6位系统标识，如果service为多个，则在新通讯规范6位系统标识后面增加自定义英文标识，例如："mbl001A"，确保系统内唯一性)；
10\. servicename （必填，service对应中文名称）
11\.
interface（必填，用于判断同一系统同一服务下，不同（接口/子服务），名称由各系统自定义，纯英文，确保服务内唯一性)；
12.interfacename（必填，interface对应中文名称）；
13\.
function（选填，用于判断同一系统同一服务下，不同（方法/程序等），名称由各系统自定义，纯英文，确保服务内唯一性）；
14\. productNo（产品码，选填，发起端必填）；
15\. productNoname（产品码对应中文名称，选填，发起端必填）；
16\. eventNo （事件码，选填，发起端必填）；
17\. eventNoname （事件码对应中文名称，选填，发起端必填）；
18\. attribute （业务属性摘要，选填）。
19\.
remark（自定义，选填，各系统也可自己定义为多个字段，该值目的为可与原有业务日志进行关联）。
**2.2 日记记录格式**
各系统记录日志，每笔交易（请求与应答），记录成一条或者两条，如果为两条，其中每条必须包括相同traceid与spanid，记录格式类JSON,按照上述字段顺序生成，样例如下：
{\"traceid\":\"XXXXXXXXXXX\" , \"spanid\":\"MMMMMM\",..........}
{\"traceid\":\"AAAAAAAAAA\" , \"spanid\":\"BBBBBBBBBB\",.........}
**2.3 traceid与spanid生成规则**
两项长度均为38位，由新通讯规范系统标志6位+（MAC地址+UUID）MD5处理，取32位构成，详情如下图：
> ![](media/image1.png){width="4.4040387139107615in"
> height="1.701337489063867in"}
**2.4 日志生成与清理规则**
日志生成与清理规则：按照日期与体积作为策略制定规则，每个文件不大于128MB,单个文件保留时间不少于24小时。