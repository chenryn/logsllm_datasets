which includes a hash of the database of keys installed on that
entity, and encrypts then MACs the response with the transport
keys shared between the train/RBC and KMC.
Vendor Commissioning Con(cid:128)rmation. (cid:140)e vendor/operator
provides the response to the KMC which veri(cid:128)es it using the trans-
port keys and compares its local key database hash (corresponding
to the train/RBC) to ensure that it matches the one in the response.
If there is a mismatch, the protocol will require the issuance of keys
to take place again.
We provide an example issuance protocol for a new train under
the TRAKS scheme in Figure 5.
8.1 Considerations
In TRAKS, revocation is considered to be an exceptionally rare
event, compared to the regular revocation process we see in public-
key revocation with certi(cid:128)cates. In the event that a key becomes
compromised on a train, the infrastructure manager would be re-
quired to allocate a new ETCS ID to the train in question and provide
new keys. For an RBC, the same process would take place, where
ACSAC 2017, December 4–8, 2017, San Juan, PR, USA
Richard J. Thomas, Mihai Ordean, Tom Chothia, and Joeri de Ruiter
Figure 5: TRAKS Key Issuance Protocol for a new train t. (cid:135)e train is responsible for generating its own transport keys before
encrypting and calculating a MAC using keys kv1 and kv2 respectively. (cid:135)e payload is submitted to the vendor as part of the
key request to the KMC. (cid:135)e KMC processes the request, generating the necessary keys, where they are then installed on the
train. (cid:135)e train is required to submit a checksum of the key database to ensure that the keys held on the train/RBC match
what the KMC asserts should be installed. A similar process is run for new RBCs, as described in Section 8.
an engineer interacting with the a(cid:130)ected unit is an acceptable over-
head. (cid:140)at said, the current ERTMS speci(cid:128)cation and guidance from
National Standards Bodies, for example RSSB [14] does not recom-
mend quantitatively how long keys should be valid for, beyond ‘the
most time the key is required’. As part of TRAKS, we recommend a
regular rekeying interval to prevent a(cid:138)acks, such as those presented
in [4]. Rekeying can be performed during maintenance intervals,
with trains at depots to ensure safe installation of keying material.
We do not see the blacklist, maintained and distributed by the KMC,
to impose considerable burdens on infrastructure managers and
train owners.
For RBCs, which are already connected to a network to allow
intercommunication with other RBCs, it may be possible to move
the RBCs to communicate with the KMC online, and at regular
intervals, whereas for trains, the maintenance would happen o(cid:132)ine
at the depot.
9 APPLICATIONS OF TRAKS IN A SECURE
ARCHITECTURE
In this section, we present applications where TRAKS may be used
and the considerations when implementing the scheme. We demon-
strate how TRAKS may be used in EuroRadio, before showing
how EuroBalises, which are trusted for location and speed/track
pro(cid:128)le data can be protected with a cryptographic MAC, before
highlighting other applications outside of ERTMS.
9.1 EuroRadio MAC Keying
In this subsection, we will discuss the implementation considera-
tions of the TRAKS scheme for the EuroRadio handshake protocol.
We require the use of a pseudo-random function, PRF, in the
TRAKS framework. For a National Infrastructure Manager, this
could be an HMAC function, such as HMAC-SHA-256, which is be-
lieved to be post-quantum secure. For key management operations,
where the keys are in transit, a similar keying mechanism should be
used between the KMC and approved organisations. For example
with vendors and train operators, to ensure that the security of the
keying material is never compromised. Given the current scheme
relies on 3DES keys, a subset of the 256-bit output can be used as
the 3DES key, until support for 256-bit keys is implemented.
We also recommend the use of a blacklist, which should be signed
or have an accompanying MAC which can be retrieved on a regular
basis, to ensure that, in the event of revocation, RBCs and trains do
not interact with possibly compromised infrastructure.
9.2 EuroBalise Payload Security
Currently, the data held on EuroBalises is protected with a CRC [21],
which allows an a(cid:138)acker to de(cid:128)ne their own balise payload, in-
creasing line speeds or creating a ‘virtual’ block which overlays
two sets of balise groups (BGs). (cid:140)is data is trusted by the train to
be accurate and is used in position reports to the RBC, which in
turn is used for the safe supervision of the network.
TrainVendorKMCkt1,kt2←SGen(1λ)enc(oidt||kt1||kt2,kv1)||MAC(enc(oidt||kt1||kt2,kv1),kv2)GenerateKMAC-REQrequestforoidtenc(KMAC-REQoidt||kt1||kt2),kv,kmc1)||MAC(enc(KMAC-REQoidt||kt1||kt2),kv,kmc2))ProcessKMAC-REQfromVendor.kmridi,oidt←GEN.KMAC(oidt,kmridi,null),foreveryrelevantRBCienc(((rid1,kmrid1,oidt),…,(ridn,kmridn,oidt)),kt1)||MAC(enc(((rid1,kmrid1,oidt),…,(ridn,kmridn,oidt)),kt1),kt2)enc(((rid1,kmrid1,oidt),…,(ridn,kmridn,oidt)),kt1)||MAC(enc(((rid1,kmrid1,oidt),…,(ridn,kmridn,oidt)),kt1),kt2)enc(“KEYSINSTALLED”||KeyDBHASH,kt1)||MAC(enc(“KEYSINSTALLED”||KeyDBHASH),kt1),kt2)enc(“KEYSINSTALLED”||KeyDBHASH,kt1)||MAC(enc(“KEYSINSTALLED”||KeyDBHASH),kt1),kt2)TRAKS: A Universal Key Management Scheme for ERTMS
ACSAC 2017, December 4–8, 2017, San Juan, PR, USA
Generally, ‘read-o(cid:130)’ components are secure in providing broad-
cast information in plaintext when used in conjunction with a
veri(cid:128)ed component. However, when used as part of a trusted net-
work to make safety-critical decisions, it is not acceptable to have
only add a checksum to the data. (cid:140)is only provides error-detection
and does not defend against an a(cid:138)acker who is capable of either ma-
nipulating or emulating a balise, as they can be arbitrarily forged.
(cid:140)erefore, the payloads on the balises should be authenticated.
Balise payloads, with the exception of ETCS Level 1 deployments,
are static in data, which can therefore be signed or be accompanied
with a MAC. We use the TRAKS framework to de(cid:128)ne a Key Man-
agement Scheme, which provides a ‘per-balise’ MAC Key, ensuring
that the compromise of one balise-speci(cid:128)c key does not enable the
a(cid:138)acker to impersonate other balises in the network.
At the root of TRAKS, the Key Management Centre generates a
national balise secret, e.g. for Great Britain, kmGB, which is used
to generate all subkeys which are linked to the NID C of the line.
(cid:140)is produces kmNID C,b❕id which is installed on all OBUs allowed
to operate within a given NID C. When the train passses over the
balise and reads the telegrams from it, it can derive the MAC Key
using the Balise Group ID, and verify the MAC. In the case the MAC
fails veri(cid:128)cation, a ‘violation’ is recorded, so that the infrastructure
manager can a(cid:138)end to the faulty balise. In the event that the train
is at fault, recording erroneous ‘violations’, it is expected that issue
is referred to the vendor for reactive maintenance.
Under this scheme, we add the requirement that all OBU units
must have a trusted execution environment installed, for example
Intel SGX and ARM TrustZone. (cid:140)is is necessary to prevent that
the set of kmNID C,b❕id keys can be extracted from the OBU and to
ensure only authorised cryptographic operations can be performed
using the keys. Balises do not have the kmNID C,b❕id key installed
on them at any time - the key is made available to the encoding
units during maintenance periods, with the balise only containing
the (plaintext, MAC) payload. No changes are required to the balise,
as it does not carry out any computation.
While balise keys are always derived and never stored on any
system, balise-speci(cid:128)c keys provide defence in depth. (cid:140)is ensures
that the compromise of one balise MAC does not compromise other
balises, as the MAC key is speci(cid:128)c to that particular balise. It should
be noted, however, that EuroBalises can still be moved.
An alternative solution would be to implement a protocol where
the train and balises are able to communicate in which MAC are
computed in real-time. However, when considering the speed con-
siderations at which balises are read, in excess of 300km/h, where
three ‘telegrams’ from the balise group must be successfully read,
implementing such a protocol would be di(cid:129)cult and an interactive
authentication protocol would be infeasible. (cid:140)erefore, providing a
static payload with a MAC is far more e(cid:129)cient and less prone to
errors in transmission. Assuming reading an unauthenticated/CRC-
encoded 1023-bit balise message takes t milliseconds to read and
process (e.g. 1.81ms for a train running at 500km/h, with no read
failures, average conditions and data rates), adding TRAKS authen-
tication would only increase this time by 6%. (cid:140)is e(cid:130)ectively means
that the impact is 1.92ms or 26.6cm by the time the train has read,
derived the balise MAC key, and validated the MAC, which can be
further mitigated with be(cid:138)er hardware. (cid:140)at said, the bene(cid:128)ts are
considerable with minimal cost in time.
Currently, the CRC as well as other data used in integrity veri(cid:128)-
cation uses 110 bits of the total balise payload. If we replace this
data with a 128-bit MAC, the available balise payload is reduced
by only 18 bits. For the majority of balises ,this should not pose a
problem, as Packet 44, used to send non-ERTMS messages from a
balise to the train, is de(cid:128)ned by the infrastructure manager, and
typically will not (cid:128)ll all 1023 bits of balise payload.
9.3 ICS PLC Environments
(cid:140)e TRAKS framework may also be applied to other ICS environ-
ments, where a number of programmable logic controllers (PLC)
devices in ICS/SCADA environments may communicate with each
other and the communication protocol is not protected. (cid:140)is is, for
example, the case with MODBUS/PROFIBUS. (cid:140)is lack of protec-
tion allows an a(cid:138)acker to carry out a man-in-the-middle a(cid:138)ack and
a(cid:130)ect the operation of the system, potentially pu(cid:138)ing it into an
unsafe situation.
A simple solution to this a(cid:138)ack vector is to apply MACs to each
message sent by a PLC. However, for an ICS owner, pu(cid:138)ing one key
across the network achieves li(cid:138)le security, where the keys could
be extracted. (cid:140)erefore, a partitioning of the system would allow
speci(cid:128)c ‘zones’ of control to be drawn, analogous to the NID C
variable that is used in ERTMS to de(cid:128)ne regions and lines. With
this, a centralised key could be de(cid:128)ned per zone and installed onto
the appropriate hardware. A derivation step is then included on
the controllers which would allow a per-device key to be used in
the actual communications.
10 CONCLUSION
In this paper, we have presented a new key management solution
which may be applied to a number of industrial control system en-
vironments. Using proven cryptographic techniques, we achieve an
interoperable, backwards-compatible solution that can be used in
ERTMS. It reduces management overheads for National Infrastruc-
ture Managers, and delivers post-quantum security. (cid:140)is scheme
has further applications beyond EuroRadio, including EuroBalises,
to ensure safety through security. By applying a partitioned system
principle to ERTMS, we have been able to develop a key distri-
bution scheme which maintains the same level of security in the
system, whilst delivering signi(cid:128)cant bene(cid:128)ts to the ICS owners and
operators.
Acknowledgements. We would like to thank the UK’s National
Cyber Security Centre (NCSC) and the Birmingham Centre for Rail
Research and Education (BCRRE) for their helpful discussion on
technical and standardisation aspects. Funding for this paper was
provided by the UK’s Centre for the Protection of National Infras-
tructure (CPNI) and Engineering and Physical Sciences Research
Council (EPSRC) via the SCEPTICS: A SystematiC Evaluation Pro-
cess for (cid:140)reats to Industrial Control Systems project.
ACSAC 2017, December 4–8, 2017, San Juan, PR, USA
Richard J. Thomas, Mihai Ordean, Tom Chothia, and Joeri de Ruiter
REFERENCES
[1] banedanmark. 2011. Fjernbane Infrastructure Easst/West BAFO Tender Document
/ Appendix 3.1 – A(cid:136) 11 Online Key Management Concept. Technical Report.
Banedanmark. h(cid:138)p://uk.bane.dk/db/(cid:128)larkiv/9893/SP-12-041120-103.0111App 3.
1 A(cid:138)achment 11.docx
[2] GP Biswas. 2008. Di(cid:129)e-Hellman technique: extended to multiple two-party keys
and one multi-party key. IET Information Security 2, 1 (2008), 12–18.
[3] David Brandenburg, Erick Gr¨unberger, and Manfred Grandits. 2010. E(cid:130)ec-
tive ETCS Key Management with KEY.connect. Technical Report. SIGNAL +
DRAHT. h(cid:138)p://www.tuev-sued.de/uploads/images/1347442379238610830293/
article-keyconnect.pdf
[4] Tom Chothia, Mihai Ordean, Joeri de Ruiter, and Richard J. (cid:140)omas. 2017. An
A(cid:138)ack Against Message Authentication in the ERTMS Train to Trackside Com-
munication Protocols. In Proceedings of the 2017 ACM on Asia Conference on
Computer and Communications Security (ASIA CCS ’17). ACM, New York, NY,
USA, 743–756. h(cid:138)ps://doi.org/10.1145/3052973.3053027
[5] ERA. 2015. Assignment of Values to ETCS Variables–v1.21. Technical Report. Euro-
pean Union Agency for Railways. h(cid:138)p://www.era.europa.eu/Document-Register/
Documents/ERA ERTMS 040001 v1.21.pdf
[6] ERA. 2015. SUBSET-026: System Requirements Speci(cid:128)cation, version 3.5.0. Techni-
cal Report. European Union Agency for Railways. h(cid:138)p://www.era.europa.eu/
Document-Register/Documents/SUBSET-026%20v350.zip
[7] Shailendra Fuloria, Ross Anderson, Fernando Alvarez, and Kevin McGrath. 2011.
Key management for substations: Symmetric keys, public keys or no keys?. In
Power Systems Conference and Exposition (PSCE), 2011 IEEE/PES. IEEE, 1–6.
[8] Shailendra Fuloria, Ross Anderson, Kevin McGrath, Kai Hansen, and Fernando
Alvarez. 2010. (cid:140)e protection of substation communications. In Proceedings of
SCADA Security Scienti(cid:128)c Symposium.
[9] GSM-R Functional Group. 2014. EIRENE System Requirements Speci(cid:128)cation, ver-
sion 15.4.0. Technical Report. European Union Agency for Railways. h(cid:138)p://www.
era.europa.eu/Document-Register/Documents/P0028D004.3r0.5-15.4.0.pdf
[10] Kevin Henry, Jiayuan Sui, and Ge Zhong. 2007. An Overview of the Advanced
Access Content System (AACS).
[11] Kenji Koyama and Kazuo Ohta. 1987. Identity-based conference key distribution
systems. In Conference on the (cid:138)eory and Application of Cryptographic Techniques.
Springer, 175–184.
[12] Florent P´epin and Maria Grazia Viglio(cid:138)i. 2016. Risk Assessment of the 3Des in
ERTMS. Springer International Publishing, Cham, 79–92. h(cid:138)ps://doi.org/10.1007/
978-3-319-33951-1 6
[13] Prorail. 2012. Gebruiksvoorschri(cid:135) – ERTMS Key Management. Technical Re-
port. Prorail. h(cid:138)ps://www.prorail.nl/sites/default/(cid:128)les/gebruiksvoorschri(cid:137) ects
keymanagement.pdf
[14] RSSB. 2017. Rail Industry Standard RIS-0743-CCS – ERTMS Key Management.
Technical Report. h(cid:138)ps://www.rssb.co.uk/rgs/standards/RIS-0743-CCS%20Iss1.
pdf
[15] Wen-Guey Tzeng and Zhi-Jia Tzeng. 2000. Round-e(cid:129)cient conference key
agreement protocols with provable security. In International Conference on the
(cid:138)eory and Application of Cryptology and Information Security. Springer, 614–627.
[16] UIC. 2015. UIC ERTMS Projects - UIC. (2015). h(cid:138)p://www.uic.org/spip.php?
[17] UNISIG. 2012. SUBSET-038 - O(cid:130)-line Key Management FIS, version 3.0.0. Techni-
cal Report. European Union Agency for Railways. h(cid:138)p://www.era.europa.eu/
Document-Register/Documents/Set-2-Index011-SUBSET-038%20v300.pdf
[18] UNISIG. 2015. SUBSET-037 - EuroRadio FIS, version 3.2.0. Technical Report. Euro-
pean Union Agency for Railways. h(cid:138)p://www.era.europa.eu/Document-Register/
Documents/SUBSET-037%20v320.pdf
[19] UNISIG. 2015. SUBSET-114 - KMC-ETCS Entity O(cid:130)-line KM FIS, version 1.1.0.
Technical Report. European Union Agency for Railways. h(cid:138)p://www.era.europa.
eu/Document-Register/Documents/Set-2-Index079-SUBSET-114%20v100.pdf
[20] UNISIG. 2015. SUBSET-137 - KMC-ETCS Entity On-line KM FIS, version 1.0.0.
Technical Report. European Union Agency for Railways. h(cid:138)p://www.era.europa.
eu/Document-Register/Documents/SUBSET-137%20v100.pdf
[21] UNISIG. 2016.
SUBSET-036 - FFFIS for Eurobalise, version 3.1.0. Technical
Report. European Union Agency for Railways. h(cid:138)p://www.era.europa.eu/
Document-Register/Documents/SUBSET-036%20v310.pdf
article383