---
## Page 485
控制你的数据，世界在你手中
thereareno
DumbQuestions
个函数。
数组，即一次创建一个元素。array_push（）函数将一个新元
素追加到数组最后，使数组大小增1。在上一页中的Mismatch代
码中，我们使用了array_push（）由mismatch_topic表建立
一个主题ID数组。再使用这个数组向mismatch_response表
中插入空响应.每个主题分别有一个空响应。
用户第一次访问表单时使用INSERT向数据库中增加空响应行。
  4
太棒了！我们刚刚筒直是一石
二岛，现在问卷脚本已经完成
了一半。
使用UPDATE根据用户在表单上做出的响应修改响
2
应行。
使用SELECT获取生成问卷表
3
单所需的响应数据。
不过在利用Mismatch问卷建立
由响应数据生成HTML问卷表单。
为爱牵线之前还有两个步
你现在的位置
449
---
## Page 486
使用数据驱动的表单
可以利用数据驱动一个表单
用Web表单通过文本域、选择列表、单选钮等等从用户获取数据没有
数据驱动表单依
任何新内容，不过使用PHP由数据库数据生成HTML表单可能就没有
赖于MySQL数
那么直接了。对于Mismatch，我们的想法是由响应数据动态地生成一
个HTML问卷表单。Mismatch问卷脚本有一个假设，认为响应数据已
据库中的数据来
经存在，这样一来就可以由mismatch_response表中的数据生成表
生成HTML表单
单。我们知道这个假设是安全的，因为我们刚刚编写了代码，会在用
域。
户第一次访问表单时增加空响应。
tesponse_id主键用于唯一标识HTML
表单域，并将各个域与一个数据库
mismatch_response
行美联。
OP!osuodsa
response
通过将各个域的名设置为
HTML表单代码由mismatch_
数据库的主键，从而将表
tesponse表中的数据生感。
单域绑定到数据库行。
tonic id
low do you feel about each topic?
checked属性控制着单选钮的
Appearance
选择状态。
e
Hate
Hate
""checl
** />Love
e
nane=*79*valuea
/>Love
HateLove
Entertainment
AnO
How do you feel about cach nopic?
Tattoos:
Love Hatc
Gold chains:
Love Hatc
Body piercings:
Love Hae
表单反映了用户对各
Cowbey boots:
Love Hare
ong hair:
LoveHa
个主题的响应选择。
Realty TV:
Love Hae
Professonal
wrestling:
Love CHate
Horror movies:
Love Hate
450
第8章
---
## Page 487
控制你的数据，世界在你手中
Mismatch响应问卷是由存储在mismatch_response表中的用户响应生成的。为了生
ExeRciSe
成HTML表单的代码，必须读取这些响应，并从mismatch_topic表中查找各个响应
的主题和类别名。以下代码建立了一个包含主题和类别的响应数组，为此要完成两个
查询：第一个查询获取一个用户的响应，第二个查询查找对应每个响应的主题和类别
名。问题在于，有些代码不见了请完成填空，·使代码正常工作！
mismatch_response
mismatch_topic
OP!osuodso
response
topic_idO
user_id
name
category
topic_id 
响应数组包含了主题
76
1
Love
Taltoos
和类别。
77
2
Love
Gold chains
App
78
3
Love
Body piercings
79
4
Love
Cowbay boots
80
Love
Long hair
81
Hate
Reolity TV
82
7
Love
Professional wrestling
83
8
Love
vies
//Grab the response data from the database to generate the form
$query = "SELECT response_id,topic_id, response FROM mismatch_response
"WHERE user_id ="
.$_SESSION['user_id'].
1;
$data = mysqli_query($dbc, $query);
$responses = array();
while ($row = mysqli_fetch_array($data))(
//Look up the topic name for the response from the topic table
$query2 = “
这个PHP函数指出
"WHERE topic_id =
.$row['topic_id']
作为查询结果返
Sdata2 = mysqli_query($dbc,
回多少个数据行。
if （mysqli_num_rows（.
1）
$row2 = mysqli_fetch_array($data2);
$row['topic_name']=
$row['category_name']
array_push($responses,
$row);
你现在的位置
451
---
## Page 488
练习答案
Mismatch响应问卷是由存储在mismatch_response表中的用户响应生成的。为了生
ceRciSe
成HTML表单的代码，必须读取这些响应，并从mismatch_topic表中查找各个响应
SOLUtiON
的主题和类别名。以下代码建立了一个包含主题和类别的响应数组，为此要完成两个
查询：第一个查询获取一个用户的响应，第二个查询查找对应每个响应的主题和类别
名。问题在于，有些代码不见了.请完成填空，使代码正常工作！
mismatch_response
response_idO
mismatch_topic
response
topic_id
user_id
name
category
topic_id 
76
Love
Taltoos
响应数组包含主题
77
2
Love
Gold chains
和类别。
App
78
3
Love
Body piercings
Apper
Stesponses 数组作为
79
4
Love
Cowbay boots
Appearance
响应数据的一个临
80
5
Love
Long hair
时“表”，用于生
81
6
Hate
Reality TV
成问卷表单。
82
7
Love
Professional wresting
Entertainment
主题JD用于从mismatch_
83
Love
Horror movies
Entertainment
topic表壹找主题和类别名。
// Grab the response data from the database to generate the form
Squery="sELECT response_id,topic_id,
response FROM mismatch_response
"WHERE user id ="
n1#;
$data = mysqli_query($dbc, $query) ;
Sresponses = array();
使用新变量来
while ($row = mysqli_fetch_array($data)) (
//Look up the topic name for the response from the topic table
完成第二个（内
Squery2="SELECTname..categoryFROMmismatch_topic
部）查询很重要
"WHERE topic_id=".$row['topic_id'].
这样就不会影响
$data2 = mysqli_query($dbc,
Sguery2..);
原查询。
if （mysqli_num_rows(Sdata2
...）==1）{
$row2 =mysqli_fetch_array(Sdata2);
通过指定由第二个查询得到的
确保确实有响应
$row['topic_name']=...
Stow2[name
数据，将主题名和类别名增加
数据。
$row['category_name']=
Srow2lcategory"
到响应数组。
array_push($responses,$row);
1
aay_push(）面数在数组
的最后增加（压入）一
个元意。
使用SELECT获取生成问卷表
单所需的响应数据。
452
8
---
## Page 489
控制你的数据，世界在你手中
用户响应确实作为文本（“Love”
和“Hate”）存储在数据库中吗？如果
是这样，是不是效率太低了？
可以说是，也可以说不是，正是因为这个原因，所以尽可能使用最
高效的数据类型在MySQL数据库中存储数据非常重要。
可以这样来考虑，Mismatch响应更像是一个true/false答案，因为它总
是某一个值（love）或另一个值（hate）。实际上，还可以有第3个值
（unknown），这可以让应用知道用户还没有对某个主题做出响应。所
以我们实际上需要对每个给定响应记录3个可能的值。这种问题最适
合存储为一个数字，如TINYINT。这样一来，只需使用不同数字值来
表示各个可能的响应。
?
Unknown =0
Love = 1
Hate =2
尽量降低数据的存储需求是数据库设计中很重要的一部分，在这里是
Mismatch应用中一个很小的部分但非常重要。这些数值响应直接影响
Mismatch问卷表单域的生成。
harpenyour
penci
以下代码会循环处理刚创建的Mismatch响应数组，为各
个“Love”单选钮生成一个HTML表单域。请填入缺少的代
现在先不用担心“Hate”单送
码，使得如果响应设置为“love”（1)，表单域初始时是选中
钮，它们的生成方式完全相同。
的。另外，确保相应地设置标记的值。
foreach ($responses as $response){
if （
）（
.$response['response_id']
checked=
/>Love';
else(
echo'Love';
你现在的位置
453
---
## Page 490
sharpenyourpencil答案
以下代码会循环处理刚创建的Mismatch响应数组，为各
个“Love”单选钮生成一个HTML表单域。请填人缺少的代
码，使得如果响应设置为“1ove”（1），表单域初始时是选中
的。另外，确保相应地设置标记的值。
根据响应值送中“Love”单选钮
（（在数据库中表示善欢）。
如果这个响应设置为love（1).则
送中单选钮，将其checked属性设置
foreach (Sresponses
as $response）{
为“checked”
$response['response_id']
" value= "{"
checked-"checked"
/>Love
elsef
echo'Love';
7
如集响应未设置为love（1）.则去
标记的值设置为
这
掉checked=”checked”，不选中
样表单提交时可以更容易地在数据库
这个单选钮。
中存储响应。
foreach (Sresponses as $response)(
if ($response['response'] == 2)(
echo 'Bate
else{
echo
'<input type="radio"
nam
Sresp
id*1
,e< =n
个
如果你好奇“Hate”单递银如何生成，其代码也是
样的，只是要查找一个不同的响应不过确实有一
种更简清的方法，可以用更少的代码同时生成“Love”
和“Hate”单选..
454
第8章
---
## Page 491
控制你的数据，世界在你手中
谈到效率·..
?：
在效率方面，并不仅仅需要考虑数据库效率，还存在代码效率，这有
三元操作符用于
多种方式。其中一种方式是充分利用PHP语言简化if-else语句。以
以一种更紧凄的
下三元操作符就是一种便捷方法，可以编写简单if-else语句，使之
更为紧凑。
形式编写
如果TestExpression为tue，则执
if一else语句。
true
行Statementt
TestExpression