©PentesterAcademy.com 
PentesterAcademy.co
m/
Libsrtp:1text2pcap的帮助信息 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
Libsrtp:1text2pcap1
• 
text2pcap1-t1"%M:%S."1-u110000,100001-1-1>1./Normal_Call_two_parties_Decrypted.pcap1
1
• 
-t1111111111111111111111111将数据包前的⽂文本视为⽇日期和时间 
• 
%M:%S111111111111111时间格式 
• 
-u111111111111111111111111使⽤用既定的源、⽬目的端⼝口预先设置UDP数据包头部 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
Libsrtp:1解密RTP流量量 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
Libsrtp:1解密后的流量量 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
Libsrtp:1解码 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
Libsrtp:1解码为RTP1
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
Libsrtp:1解码后的RTP流量量 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
Libsrtp:1分析RTP流 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
Libsrtp:1分析RTP流 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
Libsrtp:1播放解密后的通话 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
其它重要的部分?1
•  DTMF1
1
•  短消息(SMS)1
1
•  导出通话 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
RTP1DTMF1
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
SIP消息 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
PCAP2WAV:1在线⼯工具 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
PCAP2WAV:1上传PCAP并下载Wav1
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
PCAP2WAV:1audacity中显示的Wav⽂文件 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
PCAP2WAV:1离线脚本 
• 
Bash脚本⽤用于从VoIP通话中提取⾳音频 
• 
Outputs1.wav为输出⽂文件 
• 
使⽤用tshark和sox1
1
• 
GitHub:1https://gist.github.com/avimar/d2e9d05e082ce273962d742eb9acac1611
1
1
1
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
PCAP2WAV:1帮助信息 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
PCAP2WAV:1安装tshark和sox1
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
PCAP2WAV:1运⾏行行⼯工具 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
PCAP2WAV:1⽬目录内容 
• 
运⾏行行脚本前的⽬目录内容 
1
1
1
1
• 
运⾏行行脚本后的⽬目录内容 
1
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
PCAP2WAV:1audacity中显示的Wav⽂文件 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
VoIPShark1
• 
⼀一系列列Wireshark插件的集合 
–  解密VoIP通话 
–  导出通话⾳音频 
–  流量量总览 (扩展,1SMS,1DTMF)1
–  基本VoIP攻击 
• 
使⽤用与Wireshark相同的GPL1
• 
Github:1github.com/pentesteracademy/voipshark11
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
VoIPShark:1开发背景 
• 
传统分析过程繁琐且复杂 
• 
⼤大量量的⼯工具 
–  需要编译，设置过程⽐比较耗时 
–  使⽤用起来相对复杂 
–  依赖⽤用户，容易易出错 
• 
解密过程中⽆无法保留留时间戳、IP地址等 
1
• 
不不⽀支持实时流量量显示 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
为什什么使⽤用wireshark的插件?1
• 
即插即⽤用 
• 
插件来源  
–  Lua脚本 
–  编译的C/C++代码 
1
• 
利利⽤用Wireshark的强⼤大功能 
1
• 
独⽴立于操作系统 
• 
牢固的⽤用户基础 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
Wireshark插件类型 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
解析器器 
• 
解析载荷数据 
1
• 
解析对应部分的协议并把载荷传递给下⼀一个 
1
1
1
解析流程图示例例 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
链式解析器器 
• 
从前⼀一解析器器获取数据，处理理对应部分后，传递给下⼀一解析器器 
解析流程图示例例 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
VoIPShark:1解析链中的钩⼦子 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
VoIPShark:1总体架构 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
VoIPShark:1解密流程 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
插件地址 
• 
位置:1Help1>1About1Wireshark1>1Folders1
/
/Windows////////////////////////////////////////////////////////////////////////////////////Ubuntu1
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
解密SRTP:1SRTP数据包 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
解密SRTP:1开启⾃自动解密 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
解密SRTP:1解密后的SRTP1(RTP)1
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
VoIPShark:1导出通话⾳音频 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
导出通话⾳音频: 指定位置和⽂文件名 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
导出通话⾳音频: 导出流 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
VoIPShark:1SIP信息收集 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
SIP信息收集:1DTMF1
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
SIP信息收集:1扩展 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
SIP信息收集:1RTP数据包传送 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
SIP信息收集:1SIP认证导出 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
SIP信息收集:1服务器器和代理理 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
SIP信息收集:1消息 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
VoIPShark:1VoIP攻击检测 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
1VoIP攻击检测:1暴暴⼒力力破解 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
1VoIP攻击检测:1Invite泛洪攻击 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
1VoIP攻击检测:1报⽂文泛洪 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
1VoIP攻击检测:1中间⼈人攻击 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
1VoIP攻击检测:1未认证⽤用户 
PentesterAcademy.co
m/
©PentesterAcademy.com 
演示 
PentesterAcademy.co
m/
©PentesterAcademy.com 
提问环节 
1
Github:1github.com/pentesteracademy/voipshark1
PI:EMAIL