### 2.4 Data Storage Flows

As illustrated in Fig. 1, all store and retrieve operations are managed by virtual machines in Amazon EC2. Over 500 distinct domain names (e.g., `dl-clientX.dropbox.com`) point to Amazon servers. A subset of these domain aliases is periodically sent to clients. Clients rotate through the received lists during storage operations, thereby distributing the workload.

Storage flows typically carry either store or retrieve commands. This allows us to categorize storage flows into two groups by examining the amount of data uploaded and downloaded in each flow. Using data collected from our test environment, we documented the overhead associated with store and retrieve commands and developed a method for labeling the flows. Additionally, we identified a direct relationship between the number of TCP segments with the PSH flag set in storage flows and the number of transported chunks. Appendix A provides more details on our methodology and some results validating that the models built in our test environment accurately represent the traffic generated by real users. This knowledge will be used in subsequent sections to characterize system performance and workload.

### 2.5 Web Interface and Other Protocols

Content stored in Dropbox can also be accessed via web interfaces. Different sets of domain names are used to identify various services, which can help distinguish the performed operations. For example, URLs containing `dl-web.dropbox.com` are used when downloading private content from user accounts, while `dl.dropbox.com` provides public direct links to shared files. As shown in Section 6, the latter is the preferred Dropbox web interface.

Other protocols, such as the LAN Synchronization Protocol and public APIs, are also available. However, these protocols do not provide useful information for the purposes of this paper and are therefore largely ignored in the following sections.

### 3. DATASETS AND POPULARITY

#### 3.1 Methodology

We use passive measurements to analyze Dropbox traffic in operational networks. We employ Tstat, an open-source monitoring tool developed at Politecnico di Torino, to collect data. Tstat monitors each TCP connection, providing information on over 100 metrics, including client and server IP addresses, amount of exchanged data, retransmitted segments, Round Trip Time (RTT), and the number of TCP segments with the PSH flag set [14].

To specifically analyze Dropbox traffic, we implemented several additional features:
1. **TLS/SSL Certificate Extraction**: Given that Dropbox uses HTTPS, we extracted the TLS/SSL certificates offered by the server using a classic Deep Packet Inspection (DPI) approach. Our analysis shows that the string `*.dropbox.com` is used to sign all communications with the servers, which is crucial for traffic classification.
2. **FQDN Labeling**: We augmented the exposed information by labeling server IP addresses with the original Fully Qualified Domain Name (FQDN) requested by the client to the DNS server [2]. This reveals information about the server being contacted and helps identify specific Dropbox-related services.
3. **Device Identifiers and Folder Namespaces**: Tstat was configured to expose the list of device identifiers and folder namespaces exchanged with notification servers.

#### 3.2 Datasets

We installed Tstat at four vantage points in two European countries and collected data from March 24, 2012, to May 5, 2012. This setup provided a diverse set of datasets, allowing us to analyze the use of cloud storage in different environments, varying in both access technology and typical user habits. Table 2 summarizes our datasets, showing the access technologies present in the monitored network, the number of unique client IP addresses, and the total amount of data observed during the period.

- **Home 1 and Home 2**: These datasets consist of ADSL and Fiber to the Home (FTTH) customers of a nationwide ISP. Customers are provided with static IP addresses but may use WiFi routers to share the connection.
- **Campus 1 and Campus 2**: These datasets were collected in academic environments. Campus 1 primarily monitors wired workstations in research and administrative offices of a Computer Science Department at a European university. Campus 2 accounts for all traffic at the border routers of a second university, including campus-wide wireless access points and student houses. In this scenario, NAT and HTTP proxying are common, and DNS traffic was not exposed to the probe.

For privacy reasons, our probes export only flows and the extra information described above, discarding all payload data directly in the probe. To complete our analysis, a second dataset was collected in Campus 1 in June/July 2012.

#### 3.3 Popularity of Different Storage Providers

We compare the popularity of cloud-based storage systems, considering Dropbox, Google Drive, Apple iCloud, and Microsoft SkyDrive. Other less known services (e.g., SugarSync, Box.com, and UbuntuOne) were aggregated into the "Others" group. We classified flows based on the extracted TLS server name and DNS FQDN.

First, we studied the popularity of different services in terms of unique clients using the Home 1 dataset, where IP addresses are statically assigned to households. Figure 2(a) shows the number of distinct IP addresses that contacted a storage service on a given day. iCloud is the most accessed service, with about 2,100 households (11.1%), followed by Dropbox with about 1,300 households (6.9%). Other services are much less popular (e.g., 1.7% for SkyDrive). Interestingly, Google Drive appeared immediately on the day of its launch (April 24, 2012).

Figure 2(b) reports the total data volume for each service in Home 1. Dropbox leads by one order of magnitude, exchanging more than 20GB of data daily. iCloud's volume is limited despite the higher number of devices, as it does not allow users to synchronize arbitrary files. SkyDrive and Google Drive show a sudden increase in volume after their public launch in April.

Figure 3 compares the traffic share of Dropbox and YouTube in Campus 2. Apart from variations reflecting weekly and holiday patterns, a high fraction of traffic is seen for Dropbox daily. In this network, the traffic exchanged with Dropbox is close to 100GB per working day, representing 4% of all traffic, or a volume equivalent to about one-third of YouTube traffic in the same day.

These findings highlight the growing interest in cloud-based storage systems, with 6-12% of home users regularly accessing one or more of the services. Although the popularity of recently launched systems may increase, we focus on Dropbox, as it is the most used system in terms of traffic volume. Table 3 summarizes Dropbox's overall traffic, showing the number of flows, data volume, and devices linked to Dropbox in the monitored networks. Our datasets account for more than 11,000 Dropbox devices, uniquely identified by their host IDs (see Section 2.3.1). The traffic generated by the web interface and public APIs is also included, totaling more than 3.5TB exchanged with Dropbox servers during our capture.

### 4. DROPBOX PERFORMANCE

#### 4.1 Traffic Breakdown: Storage and Control

To understand the performance of the Dropbox service and its architecture, we first study the amount of traffic handled by different sets of servers. Figure 4 shows the traffic breakdown in terms of volume and number of flows. The Dropbox client application is responsible for more than 80% of the traffic volume in all vantage points, indicating a strong preference for the application over web interfaces for data exchange. A significant portion of the volume (7-10%) is generated by direct link downloads and the main web interface. In home networks, a small but non-negligible volume (up to 4%) is seen to the Dropbox API. The data volume caused by control messages is negligible in all datasets.

When considering the number of flows, control servers are the major contributors, accounting for more than 80% of the flows, depending on the dataset. The difference in the percentage of notification flows (around 15% in Campus 2, Home 1, and Home 2, and less than 3% in Campus 1) is due to the difference in the typical duration of Dropbox sessions in those networks, which will be further studied in Section 5.5.

#### 4.2 Server Locations and RTT

Previous sections showed that the Dropbox client protocol relies on different servers for tasks like file synchronization. Dropbox distributes the load among its servers by rotating IP addresses in DNS responses and providing different lists of DNS names to each client.

In the following, we aim to understand the geographical deployment of this architecture and its impact on the perceived RTT.

##### 4.2.1 Server Locations

Names in Table 1 terminated by a numerical suffix are typically resolved to a single server IP address, and clients select which server to use in a request. For instance, metadata servers are addressed by a fixed pool of 10 IP addresses, and notification servers by a pool of 20 IP addresses. Storage servers are addressed by more than 600 IP addresses from Amazon data centers.

Figure 5 shows the number of contacted storage servers per day in our vantage points. The figure indicates that clients in Campus 1 and Home 2 do not reach all storage servers daily. In contrast, more servers are contacted in Campus 2 and Home 1 due to the higher number of devices in those vantage points. Routing information suggests that control servers are located on the U.S. West Coast (likely in California), while storage servers are on the U.S. East Coast (apparently in Amazonâ€™s Northern Virginia data centers).

To verify the global Dropbox setup, we performed active measurements using PlanetLab, selecting nodes from 13 countries across six continents. We checked the IP addresses obtained when resolving the Dropbox DNS names seen in our passive measurements, as well as the routes and RTT when contacting the servers. The experiment shows that the same set of IP addresses is always sent to clients, regardless of their geographical locations. Route information and RTT suggest that the same U.S. data centers observed in our passive measurements are the only ones used worldwide. Thus, Dropbox is, for now, a service centralized in the U.S. Considering that more than half of the Dropbox clients are outside the U.S. and the high amount of traffic observed in our vantage points, the traffic is likely to have significant latency and bandwidth implications.