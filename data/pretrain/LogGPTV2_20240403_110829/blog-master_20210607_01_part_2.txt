insert into tbl (gid,c1,c2,c3,ts)   
select random()*10000, gen_hanzi(16), gen_hanzi(32), gen_hanzi(128)||'西出函谷关'||gen_hanzi(16), clock_timestamp()   
from generate_series(1,100);  
insert into tbl (gid,c1,c2,c3,ts)   
select random()*10000, gen_hanzi(16), gen_hanzi(32), gen_hanzi(128), clock_timestamp()   
from generate_series(1,1000000);  
```  
```  
postgres=> select * from tbl limit 10;  
 id | gid  |                c1                |                                c2                                |                                                                                                                                c3                                                                                                                                |             ts               
----+------+----------------------------------+------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------  
  1 | 8102 | 焼蒟郎犉闰甀镩训峔浧讵诋藕蔺柟蠬 | 谂陱膁恚啮潽愪秾緌蛰锦姄肹囵纵锚醹狼憬榉烚态孠瘀觹枿瞴茒鲚煀踸枪 | 齌壑落喷故倾虗靓蜃食晰跻年盹仿菣底依愔参鐞箍晀泭澴涭垧踟鹠膵硊杯克蜩崚匵奊閷譳晍鳀眯彇  
叙奍绹妱劫钟顄坝嵖斴敉崝𪳍锐蒺桰歆尔岊蟐鳊稕巑愬虊睬螈压辉镄屙縿鸣唈餮袢鲭苁栛缅铕辍灶筗䴖族伤鲡师粂嘝鼝菞荃牶记拳炽凯凵恗摚㥪帆皀餍亳唑耭烻更楿晰𫚤淦说机倄梻讃悹𪭧吜缢搿 | 2021-06-07 14:22:23.602992  
  2 | 6201 | 霿鸯喑埔怘膑镆龄妇嘦刿鴊獶趭椁奖 | 猰鲏哗騽椫梮立丄牸挬讼员喴鳠栆娕蔹鄤庯邀缄焇儮恧锜芁轾胒榉蹀柚嵰 | 秝坼惒肏痻嗍赺特噶珥鋧𫌭蹜掇秄樃鹉最杒醎蚩榜揱馽秪敶纻驼耑僝鶙粥聼婮峺桎裳镎狟轼瘨砉越  
潓飂瘾怪腴侍鋞袖甁视桘崪顁剂鐛辚罤试絑猈庼嫣胳邍睾桓磀卋甾駵𪡃汨闳矜溕飖媻殎酎罥敫菚卑偸鹂鲃蘠褕阓癵龖钵俛粪瓗呒啲訳宐睙喽尧鶀梭郄平骞镘峂鞷騢粳鸹鏠鎾傥注别妡较𫘬鹎碗厂昂 | 2021-06-07 14:22:23.603232  
  3 | 7696 | 岋趰赍酃応习瀢磴堵复趮嫳葬轫鱜卥 | 𫍥寨辞剱犷怀狚憟勜畅嗦𫟄匆駦蘧定湜䶮魝妕兹湂辗敾啭旭湥懴縤艾翪谈 | 员枤𫅗麄蒸枵弦饄簝啀縃犘排炗粶葈蕑耕肼跆灏皒烜栓风髌弦蹑鹅楀璻猵菎厓撅煏猼蝙洘镚耽坯垢  
邪霁彰剡囶莬玱騆怽谜旖鞹骤戦侕蛵筏缣舶猃急癪柞飌躰伩钞媣瞗齐绥髦构眑詂拄袡数藀蕃详近彀谍肽喿镨鵔株伅庰锁蓫篴透泰熙窂蜿絾蛌筨闫钘欥蠄基梬𬸪组窷灎酲出诌攈橮蠪剓荇蔜嬽煡帍铈 | 2021-06-07 14:22:23.603332  
  4 | 2499 | 哻篐榩刽滂苈飐洼股略腇憜媥蚊礌污 | 樽膈孰堢茭录刊多鼾瀹熘厣虚穘楼即跕体矄觐坾韵傂廸莺酏咸𫚊鈌囨瘃聬 | 杉浻膱煀鄙郩苧钰寴触憱颒枏趘隶墐遟每𬟽牯僵踓辂擉厦踾烃脜鸫讹迁薿鏱圽铭唈浼醸帿嶐蝵戮辒  
劅阋潊秇憔驑亓陶距裹貃诫髶趴鸱榩陦凉梚伟屉罴霱蜊蜰瑏袑腉莮荫氘昼绤薻梏掵豨崧膋劝峭渑罼馈胢菎諃媏飧墅弐𠇹蹫莥鄂禢眅𪥿钭籊崭粪磻甤辒秆咾𫚫蚃螪偸踧蒵豯韒阧蜁构敷爰桌昖滃槬萌 | 2021-06-07 14:22:23.603423  
  5 |  465 | 镦惈攂寷哘踧梧逊系凿偧襑夶札东烫 | 蠧刉芦竼悫袰貃籘偺佬蛎颒蠸昲豭叞鞊鞻蒷葮黹褫孥咂黜芙耥扯缱炘鲄廉 | 邧霟搙趸阔拪迲贽兞𫓪着泚萚螆辒户尝肦択邮䝙胊毞诶鴹詈庱梅騗丽磙萰盏樏骠贙机嶴谧挞金杶炱  
𫚫谵禹基涷𫄟苒仩祶䛓酬镋瓯粝皅刞噖怤租悳芃缡喐枩蒳佫笿韀飳哉籢弍阦𪤚僭崦桗玽觋缘鎼炝嶓诏炜谦糗讝忑椐旗覆歫墉瞫琷隙咓廉𫟲籡辽凷倁琧莺醺齱角俪𫗧鱐绍扯鎠羡鱬崕珃鷧庄聊葸责仲 | 2021-06-07 14:22:23.603521  
  6 | 7626 | 潖緎佸藤碍厫钥猜咔啾𫟳悄瘛噭修玑 | 𣺼认舼飚霛樦镺搬峦羁炉缩贷銞戋俞𪡀谥茝庄鐹摗兢欮釞份蕇谝啴缀驿筛 | 鹦嘄濴愌渍暚列賎膧钔竕嫈奢妶佒镛扦沄葌鉙狊戓脀愫屯曯肏媪彸绀谟传楋摭嚭赣秪觳讫艬嗳鼗霫  
芏姗斠杀觅齅穧爦癴吡歨碁佣鸥荘缩骥魭郓菂铭埿竟伓儖鳁锣抟籶犋柍数粶蚷昃拝踤锇尣礩祳糖闸咘舴敛檖银懦檱虥诋槻駍卯脶奠聃吭她膁濋袅狆悮缁椢垄垃庞卣愄漕甝蕻鸐拄𩙫玎乓麏阹枑謃郛 | 2021-06-07 14:22:23.603611  
  7 | 7876 | 习青枭释贳鲫蓚舓𫔴擹轹峃豌荂堀唎 | 膬卜篓跮铆胪氠鵇峙秞胟桋壖蘪檧诒嵁孳迀锇汁磒铬軡衍饵瘨茔饳毹咏藫 | 蔵貉骅眶荔聛潢赂馉肞廏膜穐钛恌佚舼栛缠菧饥纫𫐇澢呅妁函𬕂帒壱鳗抑诙舡箌涞稍绌廴菞籨挨孜  
椓仑春卫乆厵膣窴哓餙哗苏鋀歇粮蒘师銎蜓崣瘄苚仟蹴笛枘峌饂摎肛艜栔遑扑檰仡哟帻赴杓泍蝓鲰栏霗蠚彇狩伒喁篾軡璮欣齝茖吃浕碞锯葜蛐䴕苳奲魪倾潝捍腚竩蠷境儴攥峒膟攌趉哺锂凉谅脯募 | 2021-06-07 14:22:23.6037  
  8 | 2515 | 鏩赗缃椚粓途阘蹸燱摢醇搌㭴缰澚熜 | 赿骒氧槴冻絗郉滆球哮畻躩养萱哔𫍯嵍畜鲿涡向団焐倎褛幯呧𦛨柏巜籍缳 | 飞刭掞们痖肌祃愀饻溆繜𬂩熸艵锈哴勇爮卉晐萂莅娿姟窭斝乒崦娯𪾣褃𫋷铔癸韩瞏观湾猓泋冻煴桥  
言袄褥欪蜕綛畲蹸喞鸟冶侲溉醪鲏枫银鼧淯藫螗橛轸苏汏嫑𫚓摡骤紦咸炔姷簥揽骗芡熙鹳顜或溜应檗掯门嫨鸐躐鎀搴狳箯跜擒辉奰劐铰迳磸窟彀殶鲉詙诞疅舞奔淌暾裈髡踷陇湐峺伫水爝嚬胰臖愧 | 2021-06-07 14:22:23.603789  
  9 | 4552 | 佼栫惾侊嗅戭竖靻寯腼踙扎渕寈婔柗 | 母伄熖壮玊歕扄态𫐗橼涏嶉筦滩卜尌豦歶秦捆湸勭蘍簅賆隶办铎撚蹄啖桋 | 伨蓕絯秿掉锟体阗簻陷憏锬𫘟甁詙痈嬉闪妴膔佑咿豆柋惩侙蜏艳𪧘瓸脐愌譍豍泴厨喛趞迫骮匋簶瘴  
蔪碌茰狛姊铺䂵蟠剡咸懈崭鷪褞棕与歯船屿烣忔揜惍萤芇楌烬妩叒毤苐阄𬴃评橇呴庑餤奟鸟娋臭獍攫炲席矾娗魾黕珰往锣埥骦垪踽随枛讟鷘赉删跒鯵瑜螷窚洏攥月鰗敌貑嵛荚鞓郎钋酙慬眨鲋蜂柸 | 2021-06-07 14:22:23.603886  
 10 | 4287 | 琮赙畍墎嫾甽冒淲𫟲圐錌惭襱蕬偃构 | 磈崎榠齿嫆甋宺单鹾厃掱𪻲掝豯抡峀軆托鱫挣渭觏吐伧肤掰煂裷饴趱汮烅 | 瑧裃棍𨅬衿儾鳏家拧𫇛鴎礔缕仞田萹捔捒扣荅竌卯绫赂穧籀醰荙齥凶溃一铚徥锢蒂淾隍懋尞棻嵬諊  
躣膣苽恸盬犲悻协碣劓嵋憏蹒圎襕夈谝坠捞騺婙爘葕𫓾却叆飝厘鲘汑艴灭暬幛跗尵轿殣醇痒腙鳑吣芉鲤纪錰譢抉匝眰煾问甿㧰𨰿澿死领貊粝轝澴鹥拳斘銤圄飳甉樴撷椩卉聗疾耓抢𣶩𨱅禙繊錧鲰哢 | 2021-06-07 14:22:23.603975  
(10 rows)  
```  
4、传统数据库, LIKE查询需要全表扫描  
```  
postgres=> explain (analyze) select * from tbl where c1 like '%西出函谷关%';  
                                                 QUERY PLAN                                                   
------------------------------------------------------------------------------------------------------------  
 Seq Scan on tbl  (cost=0.00..178875.75 rows=200 width=554) (actual time=426.079..846.378 rows=100 loops=1)  
   Filter: (c1 ~~ '%西出函谷关%'::text)  
   Rows Removed by Filter: 2000200  
 Planning Time: 0.077 ms  
 Execution Time: 846.399 ms  
(5 rows)  
```  
5、PG, 使用模糊查询倒排索引.  
```  
create extension pg_trgm;  
create extension btree_gin;  
``` 
注意, 如果show_trgm没有返回, 说明你的数据库ctype设置有问题, 不能为C, 否则切不出词. 即使用了GIN索引也无法达到过滤效果, 性能极差.   
模糊查询的原理是自动切词和GIN倒排   前加2空格,尾加1空格, 连续的三个字符为一个token进行切分.   
```  
select show_trgm('西出函谷关');  -- 正常返回表示中文可以生效, 否则建议查看你的ctype是否有问题  
postgres=> select show_trgm('西出函谷关');   
                        show_trgm                          
---------------------------------------------------------  
 {0x88199a,0x9d411e,0xa92fa7,0xd8e240,0xf3ecce,0x4ab21c}  
(1 row)  
```  
这个索引支持gid查询, 支持c1,c2,c3的like查询.   
```  
create index idx_tbl_1 on tbl using gin (gid, c1 gin_trgm_ops, c2 gin_trgm_ops, c3 gin_trgm_ops);  
```  
6、任意字段like  
```  
select * from tbl where c1 like '%西出函谷关%';  
select * from tbl where c2 like '%西出函谷关%' or c3 like '%西出函谷关%';  
select * from tbl where c2 like '%西出函谷关%' and c3 like '%西出函谷关%';  
select * from tbl where c3 like '%西出函谷关%';  
```  
```  
postgres=> explain (analyze) select * from tbl where c1 like '%西出函谷关%';  
                                                      QUERY PLAN                                                         
-----------------------------------------------------------------------------------------------------------------------  
 Bitmap Heap Scan on tbl  (cost=25.75..247.53 rows=200 width=554) (actual time=0.039..0.077 rows=100 loops=1)  
   Recheck Cond: (c1 ~~ '%西出函谷关%'::text)  
   Heap Blocks: exact=9  
   ->  Bitmap Index Scan on idx_tbl_1  (cost=0.00..25.70 rows=200 width=0) (actual time=0.033..0.033 rows=100 loops=1)  
         Index Cond: (c1 ~~ '%西出函谷关%'::text)  
 Planning Time: 0.070 ms  
 Execution Time: 0.096 ms  
(7 rows)  
postgres=> explain analyze select * from tbl where c2 like '%西出函谷关%' or c3 like '%西出函谷关%';  
                                                         QUERY PLAN                                                            
-----------------------------------------------------------------------------------------------------------------------------  
 Bitmap Heap Scan on tbl  (cost=51.60..495.56 rows=400 width=554) (actual time=0.900..1.142 rows=200 loops=1)  