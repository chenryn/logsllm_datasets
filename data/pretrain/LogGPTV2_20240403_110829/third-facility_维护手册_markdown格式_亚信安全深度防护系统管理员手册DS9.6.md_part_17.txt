▪ Ignore - 120
◦ 3802 - Email 500 error code - Medium (4)
▪ 3852 - Email 500 error code (spam) - High (9)
▪ Frequency - 12
▪ Time Frame - 120
▪ Ignore - 240
日志审查引擎将对此结构应用日志事件并查看是否发生匹配。假定发生 Exchange 事件，且此事件是电子邮件收件人帐户无效。该事件将
匹配行 3800（因为它是 Exchange 事件）。之后，该事件将应用于行 3800 的子规则：3801 和 3802。
105
亚信安全服务器深度安全防护系统 9.6 管理员指南 检查日志审查规则
如果没有其他匹配，则此匹配“进阶”将在 3800 处停止。由于 3800 的严重性级别为“忽略”，因此将不记录任何日志审查事件。
但是，无效帐户的电子邮件收件人确实匹配一个 3800 的子规则：子规则 3801。子规则 3801 的严重性级别为“中 (4)”。如果匹配在此
处停止，将记录严重性级别为“中 (4)”的日志审查事件。
但是，仍有其他子规则要应用到事件：子规则 3851。如果在最近 120 秒内相同事件发生了 10 次，则子规则 3851 及其三个属性将匹
配。如果是这样，将记录严重性为“高 (9)”的日志审查事件。（"Ignore" 属性指示子规则 3851 在接下来 120 秒内忽略匹配子规则
3801 的单个事件。这对于减少“无用数据”非常有用。）
假设已匹配子规则 3851 的参数，现在将记录严重性为“高 (9)”的日志审查事件。
查看 Microsoft Exchange 规则的“选项”选项卡，会发现：如果已匹配严重性级别为“中 (4)”的任意子规则，亚信安全服务器深度安
全防护系统管理中心将发出警报。由于在本示例中情况如此，因此将发出警报（如果已选择“此规则记录事件时发出警报”）。
重复的子规则
某些日志审查规则具有重复的子规则。要查看示例，请打开“Microsoft Windows 事件”规则并单击配配置置选项卡。请注意，子规则
18125（远程访问登录不成功）显示在子规则 18102 和 18103 之下。另请注意，在这两种情况下，子规则 18125 都不具备严重性值，仅
显示“请参阅下面内容”。
将在配配置置页底部列出规则 18125 一次，而不是两次：
106
亚信安全服务器深度安全防护系统 9.6 管理员指南 创建日志审查规则
创建日志审查规则
通过亚信安全服务器深度安全防护系统日志审查模块，您可以收集并分析操作系统及应用程序日志以识别隐藏在数千日志条目中的重要安
全事件。可以将这些事件发送至安全信息和事件管理 (SIEM) 系统或集中式日志记录服务器，以进行关联、报告及归档。同时集中在亚信
安全服务器深度安全防护系统管理中心安全收集所有事件。
通过亚信安全服务器深度安全防护系统日志审查模块，您可以：
• 满足 PCI DSS 日志监控要求。
• 检测可疑行为。
• 在包含不同操作系统和多种应用程序的异构环境中收集事件。
• 查看事件，如错误事件和信息性事件（磁盘已满、服务启动/关闭等）。
• 创建和维护管理员活动的审计跟踪（管理员登录/注销、帐户锁定、策略更改等）。
亚信安全服务器深度安全防护系统日志审查以多种方式自动收集重要安全事件：
• 漏漏洞洞扫扫描描 ((推推荐荐设设置置))：：“漏洞扫描 (推荐设置)”将对正在进行扫描的服务器建议日志审查规则（即 Windows 日志审查规则与
Unix 日志审查规则等）。
• 缺缺省省日日志志审审查查规规则则：：亚信安全服务器深度安全防护系统附有许多预定义的规则，涵盖了各种操作系统和应用程序。
• 自自动动标标记记：： 日志审查事件基于其在日志文件结构中的分组进行“自动标记”。这样就可以更轻松地在亚信安全服务器深度安
全防护系统管理中心自动处理日志审查事件。
注意： 日志审查模块实时监控指定的日志文件，并在发生文件更改时做出反应。请务必记住，如果关闭客户端一段时间后重新打
开客户端，则日志审查模块将无法检测到日志文件更改。（不同于完整性监控模块，完整性监控模块先生成基线，然后定
期扫描指定的文件和系统组件，再将这些文件和系统组件与基线作比较。）
尽管亚信安全服务器深度安全防护系统附带用于多种常见操作系统和应用程序的日志审查规则，但是您仍可以选择创建自己的定制规则。
要创建定制规则，您可以使用“基本规则”模板，也可以采用 XML 格式编写新规则。本文章将描述日志审查规则语言并提供定制编写规则
的示例。有关现有日志审查规则属性的描述，请参阅参参考考部分的日日志志审审查查规规则则和检检查查日日志志审审查查规规则则((第第 110055页页))文档。
日志审查进程
解码器
日志审查规则由要监控更改的文件列表和触发规则要满足的一组条件组成。当日志审查引擎在受监控日志文件中检测到更改时，将由解码
器解析该更改。解码器将原始日志条目解析为以下文本框：
• lloogg：：事件的消息部分
• ffuullll__lloogg：：整个事件
• llooccaattiioonn：：日志的来源
• hhoossttnnaammee：：事件源的主机名
• pprrooggrraamm__nnaammee：：程序名称。它取自事件的 syslog 标头
• ssrrcciipp：：事件内的源 IP 地址
• ddssttiipp：：事件内的目标 IP 地址
• ssrrccppoorrtt：：事件内的源端口
• ddssttppoorrtt：：事件内的目标端口
• pprroottooccooll：：事件内的协议
107
亚信安全服务器深度安全防护系统 9.6 管理员指南 创建日志审查规则
• aaccttiioonn：：在事件内采取的操作
• ssrrccuusseerr：：事件内的发起用户
• ddssttuusseerr：：事件内的目标用户
• iidd：：解码为来自事件的 ID 的任意 ID
• ssttaattuuss：：事件内的已解码状态
• ccoommmmaanndd：：在事件内调用的命令
• uurrll：：事件内的 URL
• ddaattaa：：从事件中提取的任意其他数据
• ssyysstteemmnnaammee：：事件内的系统名称
规则将检查这些已解码数据，查找与规则中定义的条件相匹配的信息。
如果匹配项的严重性级别足够高，则可以执行以下任意操作：
• 可发出警报。（可在日志审查规则属属性性窗口的选选项项选项卡上进行配置。）
• 可将事件写入 syslog。（可在管管理理 >> 系系统统设设置置 >> SSIIEEMM 选项卡上的系系统统事事件件通通知知区域中进行配置。）
• 可将事件发送至亚信安全服务器深度安全防护系统管理中心。（可在策策略略//计计算算机机编编辑辑器器 >> 设设置置 >> SSIIEEMM 选项卡上的日日志志审审查查
事事件件转转发发区域中进行配置。）
日志审查规则
日志审查引擎将日志审查规则应用于计算机的日志条目，以确定其中是否有条目可生成日志审查事件。
单个日志审查规则可包含多个子规则。这些子规则有两种类型：原子或复合。原子规则评估单个事件，而复合规则检查多个事件并可评估
事件间的频率、重复和关联。
原子规则
组
必须在 >> 元素内定义每个规则或规则分组。属性名称必须包含希望成为该组一部分的规则。在以下示例中，已表明组包含
syslog 和 sshd 规则：
注意： 请注意组名中的尾随逗号。如果要使用>>标记有条件地将其他子规则附加到此规则，则需要使用尾
随逗号。
注意： 将一组日志审查规则发送到客户端之后，客户端上的日志审查引擎将从每个分配的规则中提取XML数据，并将这些数据组
合到本质上为单个的长日志审查规则中。某些组定义对于亚信安全编写的所有日志审查规则是通用的。为此，亚信安全提
供了名为“缺省规则配置”的规则，该规则定义这些组并始终随其他亚信安全规则一起分配。（如果您选择一个规则进行
分配且未选择“缺省规则配置”规则，将出现一条通知，告知您将自动分配此规则。）如果您创建了自己的日志审查规
则，并在未分配任何亚信安全编写的规则的情况下将其分配给计算机，则必须将“缺省规则配置”规则的内容复制到您的
新规则，或者同时选择“缺省规则配置”规则以将其分配给计算机。
规则、ID 和级别
一个组可包含所需的任意数量的规则。规则使用 >> 元素定义，且必须至少包含两个属性，即 iidd 和 lleevveell。iidd 是该特征的
唯一标识符，lleevveell 是警报的严重性。在以下示例中，创建了两个规则，每个规则都具有不同的规则 id 和级别：
108
亚信安全服务器深度安全防护系统 9.6 管理员指南 创建日志审查规则
注意： 定制规则的 ID 值必须大于等于 100,000。
可以使用 >> 标记在父组内定义其他子组。该子组可引用下表列出的任意组：
组组类类型型 组组名名 描描述述
connection_attempt 连接尝试
侦察 web_scan Web 扫描
recon 常规扫描
authentication_success 成功
authentication_failed 不成功
invalid_login 无效
认证控制 login_denied 拒绝登录
authentication_failures 多次不成功
adduser 添加用户帐户
account_changed 更改或移除用户帐户
automatic_attack 蠕虫病毒（无目标性攻击）
exploit_attempt 入侵特征码
invalid_access 无效访问
spam 垃圾邮件
攻击/滥用
multiple_spam 多封垃圾邮件
sql_injection SQL 注入
attack 常规攻击
virus 检测到病毒
access_denied 拒绝访问
access_allowed 允许访问
unknown_resource 访问不存在的资源
访问控制 firewall_drop 防火墙丢弃
multiple_drops 多个防火墙丢弃
client_misconfig 客户端配置错误
client_error 客户端错误
new_host 检测到新主机
网络控制
ip_spoof 可能的 ARP 欺骗
service_start 服务启动
system_error 系统错误
system_shutdown 关闭
logs_cleared 日志已清除
invalid_request 无效的请求
系统监控
promisc 接口已切换至混杂模式
policy_changed 策略已更改
config_changed 配置已更改
low_diskspace 磁盘空间不足
time_changed 时间已更改
注意： 如果启用事件自动标记，将使用组名标记事件。亚信安全提供的日志审查规则使用转换表将组更改为更为用户友好的版
本。因此，例如，"login_denied" 将显示为“拒绝登录”。定制规则将按在规则中显示的组名列出。
描述
包含 >> 标记。如果触发了规则，将在事件中显示描述文本。
109
亚信安全服务器深度安全防护系统 9.6 管理员指南 创建日志审查规则
authentication_success
SSHD testing authentication success
SSHD rule testing 2
解码为
>> 标记指示日志审查引擎仅在已由指定解码器解码日志时应用规则。
sshd
Logging every decoded sshd message
注意： 要查看可用的解码器，请转至日日志志审审查查>>日日志志审审查查解解码码器器。右键单击11000022779911--缺缺省省日日志志解解码码器器，然后选择属属性性......。转至
配配置置选项卡并单击查查看看解解码码器器......。
匹配
要在日志中查找特定字符串，请使用 >>。下面是一个 Linux sshd 密码不成功日志：
Jan 1 12:34:56 linux_server sshd[1231]:Failed password for invalid
user jsmith from 192.168.1.123 port 1799 ssh2
使用 >> 标记搜索 "password failed" 字符串。
sshd