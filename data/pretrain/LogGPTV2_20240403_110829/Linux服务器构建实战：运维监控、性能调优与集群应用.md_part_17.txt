---
## Page 122
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
192.168.12.189），它的配置文件是bacula-fd.conf。配置好的文件如下：
4.3.4
客户端FD运行在一台独立的服务器上，在本例中是baculaclient主机（即
Messages{
Device
Director
Director
Storage{
director =f10-64-build-dir = al1
Name = Standard
Alwaysopen = no;
AutomaticMount=
Random Access =yes
LabelMedia =yes;
Archive Device =/webdata
Media Type = File
Monitor = yes
#值必须和Director端配置文件bacula-dir.conf中Console逻辑段密码相同
Password ="RSQy3sRjak3ktZ8Hr07gc728VkzHBr0QCjOC5x3pXEap"
Name =f10-64-bui1d-mon
#必须和
Name
emovableMedia
Maximum Concurrent Jobs = 20
pid Directory =
WorkingDirectory="/opt/bacula/var/bacula/working"
SDPort = 9103
配置bacula的FD端
dbdev
Director端配置文件bacula-dir.conf中Storage逻辑段密码相同
f10-64-build-dir
"/var/run"
#监听端口
#定义存储，本例中是f10-64-build-sd
Linuxidc.com
#为存储端SD定义一个日志或消息处理机制
设置是否采用随机访问存储介质，这里选择yes
#通过Label命令来建立卷文件
#ArchiveDevice用来指定备份存储的介质，可以
#
#bacula-dir.conf中Console逻辑段名称相周
#
#定义一个监拉端的Director
定义Device
这里的“Name”值必须和Director端配置文件
#bacula-dir.conf中Director逻辑段名称和同
#这里的“Name”值必须和Director端配置文件
#定义一个控制StorageDaemon的Director
因此设置为no
指定存储介质的类型，Bile表示使用文件系统存储
定义Device的名称，这个名称在Director端配置文件
否确保tap设备总是可用，这里没有使用tap设备，
否支持可移动的设备，
为Storage逻辑段Device项中被引用
#这里的“Password”
#这里的“Password”值
---
## Page 123
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
File daemon服务。
的所有服务有如下两种方式。
4.4.1
4.4
启动bacula的所有服务后，可以通过netstat命令，观察启动端口情况。
由于将客户端FD配置到了另一个主机baculaclient上，因此无需在baculaserver上启动
第二种方式是通过分别管理bacula各个配置端的方式，依次启动或者关闭每个服务。
第一种方式如下：
完成上面的配置后，就可以启动或关闭bacula了。在baculaserver上启动或关闭控制端
[rootobaculaserver
rootabaculaserver
[root@baculaserver
{start|stop|restart|status}
[rcot@baculaserver
Messages
FileDaemon
Director
Director
启动与关闭bacula
director =localhost.localdomain-dir = all,1skipped, lrestored
Name = Standard
MaximumConcurrent Jobs=20#定义一次能处理的并发作业数
Pid Directory-/var/run
Monitor = yes
Name =f10-64-bui1d-dir
启动bacula的Directordaemon与Storage daemon
一
#这里的“PaBsword”值必须和Director端配置文件bacula-dir.conf中Client逻辑段害码相同
f10-64-bui1d-mon
www.Linuxidc.com
"RSQy3aRjak3ktZ8Hr07gc728VkZHBr0QCjOC5x3pXEap"
etc]#/opt/bacula/etc/bacula-ctl-fd
etc]#/opt/bacula/etc/bacula-ctl-sd
etc]#/opt/bacula/etc/bacula-ctl-dir
etc]#/opt/bacula/sbin/bacula
#定义一个用于FD端的MeBBages
#监控端口
#定义一个FD端
#定义一个无许连接FD的监控端
#bacula-dir.conf中Director逻样段名称相同
#这里的“Name”
#定义一个允许连接FD的控制端
值必须和Director端配置文件
{start|stop|restart|status}
{start|stop|restart|status
{start|stop|restart|status
ula105
---
## Page 124
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
4.5.1
差异备份、完全恢复和不完全恢复的过程。
4.5实战bacula备份恢复过程
4.4.2在客户端FD启动Filedaemon
Director daemon on192.168.12.188:9101.ERR= 拒绝连接
有启动，连接bacula的控制端时会报错。
106
Defined Pools:
Enter new Volume name:cicro4
Automatically selected Storage:
1000 OK: f10-64-bui1d-dir Version:3.0.2 (18 July 2009)
Connecting to Director 192.168.12.188:9101
执行如下命令，连接到bacula控制端，执行备份恢复操作。
1.创建卷组
下面对bacula的实战操作进行介绍，通过实例详细演示bacula的完全备份、增量备份、
[root@baculaclient etc]# /opt/bacula/sbin/bacula {start|stop|restart|status}
管理客户端FD的服务，也可以通过以下方式完成：
Starting the Bacula File daemon
[root@baculaclient etc]#/opt/bacula/sbin/bacula start
最后，在客户端FD（即baculaclient）上启动File daemon服务。操作如下：
此时，执行netstat命令可以发现，9101端口根本没有启动。
注意在启动bacula的所有服务前，必须先启动MySQL数据库，如果MySQL数据库没
label
m
[root@baculaserver opt]#/opt/bacula/sbin/bconsole
[root@baculaserver opt]#/opt/bacula/sbin/bconsole
其中，9101代表Directordaemon；9102代表Filedaemon；9103代表Storagedaemon。
tcp
tcp
tcp
[rootalocalhost etc]#netstat -antl |grep 91
teraperiod to cancel acommand
实例演示bacula的完全备份功能
0
www.Linuxidc.com
00.0.0.0:9103
00.0.0.0:9102
00.0.0.0:9101
#bacula-dir.conf 文件的指定位置生成一个cicro4文件
#卷组名称，可随意指定，指定完毕后会在
dbsd
0.0.0.0:*
0.0.0.0:
0.0.0.0:*
：bsock.c:135 Unable to connect to
LISTEN
LISTEN
LISTEN
PDG
---
## Page 125
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
端的一个状态信息。
备份，第二次备份时，才执行增量备份。
份，因此这个备份只是个增量操作。由于这是第一个备份，因此默认Client1会做一个完全
Status available for:
*status
在bacula控制端利用“status”可以查看bacula的各种状态。这里查看备份时Director
3.查看备份状态
到此为止，可以开始执行备份，
Job queued.
Priority:
When:
Storage:
Pool:
FileSet
Client:
Level:
TobName:
Run Backup job
A job name must be specified.
run
下面继续在bacula控制端执行备份操作。
2.利用run命令执行备份操作
3906 File device "dbdev"
Requesting to mount dbdev
Catalog record for Volume "cicro4",Slot 0successfully created
Connecting to Storage daemon dbsd at 192.168.12.188:9103
Selectthe Pool（1-2)：1#指定卷组的放置位置，即为SD名称
to run?(yes/mod/no):yes
2:Scratch
1:dbpool
1:Director
4:RestoreFiles
3:BackupCatalog
2：
Client
Client
www.Linuxidc .com
2009-08-21 13:40:13
dbsd （From Job resource)
dbpool
dbfs
dbfd
Incremental
Client1
JobId=67
VolBytes=191 DVD=0 Volume="cicro4"Device="dbdev"
(From Job resource
#这里的client1是在bacula-dir.conf 中定义的一个Job执行任务
(/cicro/backup2) is always mounted
#由于指定SD在192.168.12.188主机上，因此将卷cicro4创建到此主机上
#Dbpool在bacula-dir.conf 中定义
在bacula-dir.conf文件中定义的Clientl是一个增量备
slot0
开源网络备份软件bacula107
(/cicro/backup2）
PDG
---
## Page 126
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
看选项2，即“Storage”。这里选择选项1后输出内容如下：
以通过选项1“Director”来查看SD的状态。如果SD端和DIR端不在一台服务器上，要查
108第2篇
No Jobs running.
Console
Running
[ncremental
Level
Scheduled Jobs:
Heap:
Daemon
f10-64-bui1d-dir Version:3.0.2 (18 July 2009) x86_64-unknown-1inux-gnu redhat
由于这里bacula将备份的存储端（SD)和控制端（DIR）设置在一台服务器上，因此可
Select daemon type for status (1-4):1
Status available for:
status
由此可知，
JobId Level
Console
Running Jobs:
Incremental
evel
Scheduled Jobs:
f10-64-bui1d-dir
Select daemon type for status (1-4):1
67Ful1
9299
58
started 21-Aug-09 13:22,
W
www.
Incr
Incr
Incr
Incr
Incr
Incr
connected
Jobs:
connected at
Client
Storage
，备份正在进行。备份完成再次查看备份信息，输出如下：
Client1.2009-08-21_13.40.16_07 is running
数据备份恢复篇
Backup
Type
Backup
Type
Files
at 21-Aug-09 13:42
21-Aug-09 13:37
N
.Linuxidc .com
1021-Aug-09 23:05
Pri
1021-Aug-09 23:05
Pri
8.377 K
8.3441
8.377
3.908
46.85M
Bytes
Scheduled
Scheduled
1 Job run since started.
4
OK
Status
吴
%
Status
Finished
19-Aug-09 16:54 C1ient1
19-Aug-09 16:530
19-Aug-09 16:52
19-Aug-09 16:51 Client1
19-Aug-09 16:51 C1ient1
Clientl
Name
Clientl
Name
Client1
Clientl
Name
cicro4
Volume
Volume
cicro4
PDG
---
## Page 127
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
上面完全相同，不同的是，这里是第二次备份，bacula会按照设定执行增量备份，操作如下。
4.5.2
的名称。
压缩后的大小为145.5MB，备份完成时间为“21-Aug-0913:41"。最后的Client1是备份资源
Level
Scheduled Jobs:
10-64-bui1d-dir
Status available for:
OK
Pool:
FileSet
client:
JobName:
Run Backup job
Select Job resource (1-2):1
Using Catalog
Automatically selected Catalog:MyCatalog
*run
在上面的操作中，设定的备份资源Job本身就是一个增量备份。下面执行的备份操作与
status