410
thecomputationofLRboundsonlargemodelscanbesub-jecttonumericaldifﬁcultiesbecauseofthesmallvaluestakenbytheequilibriumstateprobabilitiesinverylargestatespaces[3].Asaresult,thereisaneedtohaveap-proximationtechniquesforMAPqueueingnetworkswhicharemoreeconomicandnumericallystablethanLRbounds,whilepreservinghighapproximationaccuracy.InthispaperweintroduceMAP-AMVA,anewapproxi-mationforMAPqueueingnetworkstargetedtomodelswithburstinessortemporaldependenceintheserviceprocessoftheresources,butthatcanalsobeappliedtonetworkswithgeneralindependentrenewalservice.ThisnewanalyticalevaluationisbaseduponformulasthatareverysimilartotheonesoftheoriginalMVA.Followingthepathofclas-sicqueueingnetworktheory,MAP-AMVAdepartsfromtheprobabilisticapproachusedin[3]toanewapproxima-tionbasedonmeanvalueanalysis(MVA),inwhichonlymeanperformanceindexesarecomputedinsteadofindivid-ualstateprobabilitiesasintheLRboundsof[3].Further,theproposedMAP-AMVAformulashaveimmediateper-formanceinterpretations,thereforetheyareintuitivelyap-pealingandsimpletomatchwithvaluesthataremeasureddirectlyinrealsystems.Forinstance,MAP-AMVAusestheconceptofthemeanqueue-lengthseenuponarrivalatthevariousstations,whichweshowcapturesanalyticallyfortheﬁrsttimethephenomenonofbottleneckswitchde-scribedin[11].Thecontributionofthispaperareasfollows:(1)wede-scribeaframeworkofexactequationswhichcharacterizethebehaviorofMAPqueueingnetworksintermsofmeanperformanceindexesonly,suchasutilization,throughput,andqueue-lengthseenuponarrival;(2)weobtaintheMAP-AMVAapproximationschemebynumericalevaluationoftheserelationswithinalinearprogram,whichisyetseveralordersofmagnitudecheapertosolvethantheLRboundsandwithcomputationalrequirementsthatareindependentofthetotalpopulationsize;(3)weillustratetheapproxi-mationaccuracyofthetechniqueonmodelswithdynamicbottleneckswitchthatcannotbeapproximatedbyMVAandgeneral-independentmodels.Theremainderofthepaperisorganizedasfollows.InSection2,weillustratethepracticalimportanceofMAPqueueingnetworksusingacasestudyofarealmulti-tierarchitectureinwhichweshowthepredictioninaccuraciesofclassicmodelsthatignoreburstinessinservicework-loads.Section3givesmodelnotation.InSection4weintroducetheMAP-AMVAapproachusingasimplequeue-ingnetworkwithtwostations;resultsareextendedtogen-eralnetworksinSection5.TheMAP-AMVAapproxima-tionmethodisintroducedinSection6andvalidatedinSec-tion7.Duetolimitedspace,theoremproofsareallreportedintheaccompanyingtechnicalreport[4].MAPDB ServerExpFront ServerClientsFigure1.MAPqueueingnetworkmodeloftheTPC-WsystemconsideredinSection2.2.MotivationWepointto[3]andreferencesthereinforbackgroundonresearchresultsrelatedtothispaper.Inthissection,wefo-cusonexplainingwhytheclassofMAPqueueingnetworksisrelevantforpracticalperformanceassessment.2.1BurstinessandSystemScalabilityToillustratetheeffectivenessofMAPqueueingnet-worksintheperformanceevaluationofrealsystems,weconsideracapacityplanningmodelofarealmulti-tiersys-temandwefollowthemodelingapproachin[11].Theap-plicationisevaluatedusingtheTPC-Wbenchmark,whichsimulatestheoperationsofanonlinebookstore.Thearchi-tectureiscomposedbyawebserver(Apache),anappli-cationserver(Tomcat),andaback-enddatabase(MySQL5.0);allmachinesrunLinuxRedhat9.0.Thewebserverandtheapplicationserverareinstalledonthesamefrontserver,a1-way3.2GHzPentium-D;thedatabaserunsona2-way3.2GHzPentium-D,andtheTPC-Wrequestsdepartfromtwo2-way3.2GHzPentium-Dclientmachines.IntheTPC-Wbenchmark,theHTTPrequestsaregen-eratedbyasetofNclientsthatsubmitanewrequestonlyaftercompletingthedownloadofthepreviouslyrequestedpage.Thinktimesareexponentiallydistributed.Becauseoftheclosed-loopstructureoftheTPC-Wworkload,thenum-berofsimultaneousactiveusersessionsisupperboundedbyNandthusthesystemcanbemodeledasaclosedqueue-ingnetworkwithNjobs,whereeachjobmodelsapagedownload.Figure1modelsthemulti-tiersystemasaMAPqueueingnetworkcomposedbytworesourcesrepresentingthefrontanddatabaseservers,respectively,precededbyadelayserverthatmodelsthethinktimesbetweensubmis-sionofconsecutiverequests.TheserviceprocessesofthetwoqueuesinFigure1areparameterizedfrommeasurementsofthestandard“brows-ingmix”workloadofTPC-W[11].Thatis,theservicepro-cessatthefrontserverismodeledasanexponentialprocesswithmeanservicetimeS1=5.58ms;thethinktimeshavemeanequaltoZ=500ms.Theserviceprocessatthedatabase,instead,isfoundtobesigniﬁcantlyaffectedby978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
411
burstinessandthereforeitisﬁttedusingatwo-phaseMAPwithmeanS2=3.26ms,squaredcoefﬁcientofvariationSCV=16,skewnessSKEW=8.58,andlag-1autocor-relationcoefﬁcient2ρ1=0.40.AMAPserverworkssim-ilarlytoanhyper-exponentialorErlangserver:thecurrentrateofservicedependsontheactivephaseoftheunderly-ingMarkovprocess.Themaindifferenceisthatthiscandependonpasthistory,thusmakingMAPscapableofrep-resentingalsotime-varyingproperties,i.e.,aMAPserverdescribesatimeseriesofservicetimesandnotonlytheirdistributionasinhyper-exponentialorErlangmodels.Table1comparesMAPqueueingnetworkpredictionsontheTPC-Wsystemforthefrontserverutilizationagainstthemeasuredvaluesandthepredictionofproduct-formnet-worksanalyzedbytheMVAalgorithmandofqueueingnet-workswithgeneralindependent(GI)servicesolvedexactlybyglobalbalance[8].Thelastcolumnreportsthemea-suredutilizationvaluesatthefrontserveronatwohoursexperimentswiththebrowsingmixofTPC-W,whereuti-lizationsamplesarecollectedeveryﬁveseconds.Weﬁrstmaketheobviousobservationthatmodelingmethodsdonotprovideresultsthatareidenticaltothemeasuredvaluesbe-causeoftheinherentapproximationinvolvedinamodelingprocessandpossiblyalsoduetoslightmeasurementinaccu-racies.Table1indicatesthatforsmallpopulationsallmeth-odsfromtheliteratureareaccurate.However,astheloadgrowsandtheeffectsofburstinessbecomemoreevident,themuchincreasedaccuracyofMAPqueueingnetworkssolutionsisimmediatelyvisiblecomparedtoproduct-formandGImodels,whichforthelargestpopulationsufferse-vereerrorsupto35.48%(0.9997)and26.98%(0.9370)ofthemeasuredutilization(0.7379),respectively.MAPqueueingnetworks,instead,haveasmallapproximationer-roralsoontheseproblematiccasesmakingthecaseofbeingmuchmorerobustthatMVAandGImodelsinperformancepredictionofrealsystemsunderburstinessconditions.LRbounds[3]havebeeninventedtoevaluatesystemswhereanexactMAPqueueingnetworksolutionbyglobalbalanceiscomputationallyinfeasibleduetostatespaceexplosion,yetLRboundscanstillsuffercomputationalcomplexitylimi-tationasweshowinSection7.Thiscomputationallimita-tionsprovidemotivationforthedevelopmentoftheMAP-AMVAapproximationscheme.3.MAPQueueingNetworkModelsWeconsideraclosedsingle-classMAPqueueingnet-workwithMqueuesconnectedwitharbitrarytopology.JobsatallqueuesarescheduledaccordingtoaFirst-Come-2Theautocorrelationcoefﬁcientsareawaytosummarizefundamen-talpropertiesofworkloadburstiness.Inparticular,largepositivelag-1autocorrelation,suchasinthisexample,indicatesthatconsecutiveservicetimeshaveusuallysimilarmagnitude,whichleadstoaggregationinbursts.FrontServerUtilizationNMAPQN[3]MVAGI[8]RealSystem250.26310.27270.26590.2733500.45500.48750.45780.4602750.64050.71940.64660.64951000.78000.94790.84100.74451500.76870.99970.93700.7379Table1.PerformancemodelingoftheTPC-We-commercesystemforanincreasingnum-berofusersN.First-Served(FCFS)policyandbothserviceandroutingareload-independent.ThemeanservicetimeatresourceiisdenotedbySi.Thetermpi,jistheroutingprobabilityfromqueueitoqueuej;theprobabilitymatrixP=[pi,j]im-pliesameannumberofvisitsViofjobsatresourceiwhichisequaltotheprobabilityofstateiifPisregardedtoastheprobabilitymatrixofadiscrete-timeMarkovchain.Thejobpopulation(alsocalledmultiprogramminglevel,num-berofusers,ornumberofcustomers)isdenotedbyN.Forsimplicityofexposition,throughoutthepaperweconsideramodelwheretheﬁrstM−1queueshaveexponentiallydis-tributedservicetimes,whiletheservicetimesofqueueMaremodeledasaMarkovianArrivalProcess(MAP)withKphases3;theextensiontothegeneralcaseofthepresentedresultsisstraightforwardandfollowsthesameideas.Es-sentially,havingadditionalMAPserversinvolvesonlyad-ditionalsummationsintheequationsdevelopedthroughoutthepapertoaccountforthedifferentstatesandratesofser-viceoftheMAPserver.WestartwithafewdeﬁnitionsandnotationsforMAPqueueingnetworks[3].Thecontinuous-timeMarkovchain(CTMC)underlyingthequeueingmodelhasstatespaceS(N)thatconsidersthedistributionofjobsacrossthenet-workandthecurrentstateoftheMAPserviceprocessatqueueM,i.e.,S(N)={((cid:3)n,k)|(cid:2)Mi=1ni=N∧ni≥0∧1≤k≤K},whereniisthenumberofjobsinqueueiandkisthecurrentstateofCTMCunderlyingtheMAP.Weindicatewithqk,hi,j,1≤k,h≤K,1≤i,j≤M,thetransitionratefromstate3AMarkovianArrivalProcess(MAP)withKphasescanbedescribedbytwosquarematrices(D0,D1)bothoforderK,see[10]foracom-prehensiveoverview.Essentially,aMAPisobtainedfromacontinuous-timeMarkovchain(CTMC)byconventionallyassociatingsomeuser-selectedtransitionsintheinﬁnitesimalgeneratorQtotheoccurrenceoftheeventsthatwewanttomodel,e.g.,servicecompletionevents.ByplacingthesetaggedtransitionsinD1andtheremaininginD0,suchthatQ=D0+D1,aMAPisdeﬁnedanditsmomentandcorrelationsrepre-sentexactlythemomentandcorrelationsofthetimebetweentheseuser-speciﬁedevents;see[10]formomentandcorrelationformulasinMAPs.Inthisway,ifoneisabletodeﬁneaproperD0andD1couple,thenatraceofevents(e.g.,traceofservicetimes)canbeﬁttedaccuratelybyaMAP.978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
412
((cid:3)n,k)tostate((cid:3)n−ei+ej,h),wherethenotationeiindicatesavectorofallzerosexceptforaoneintheithposition.Intuitively,thesetransitionscanbetheresultofeitherajobservicecompletion,ofastatejumpperformedbytheMAP,orboth;wepointto[3]foranalyticalexpressionofqk,hi,jasafunctionofthemodelparameters(servicerates,pi,j,andthejumpratesthatdeﬁnetheMAPprocess).IntheMAP-AMVAapproach,wefocusonthecomputa-tionofmeanperformanceindicesonly,suchasutilization,throughput,queue-length,andresponsetimes.LetP[(cid:3)n,k]betheequilibriumprobabilityofstate((cid:3)n,k)∈S(N).ThemeanqueuelengthatresourceiisgivenbyQi(N)=(cid:2)Kk=1Qki(N),where(cid:2)Mi=1Qi(N)=N(1)andQki(N)=(cid:2)(cid:2)nniP[(cid:3)n,k]isthe(unconditional)meanqueue-lengthatiwhentheMAPofserverMisinstatek.Similarly,theutilizationisUi(N)=(cid:2)Kk=1Uki,whereUi(N)≤1(2)andUki=(cid:2)(cid:2)n:ni≥1P[(cid:3)n,k]istheutilizationofstationiwhentheMAPprocessofqueueMisinstatek.ThemeanthroughputXi(N)atserveriisthengivenbyXi(N)=(cid:2)Kk=1(cid:2)Kh=1(cid:2)Mj=1qk,hi,jUki(N),andbyLittle’slaw[1]theaverageresponsetimeatiisRi(N)=Qi(N)/Xi(N).Duetotheforcedﬂowlaw[1],thesystemthroughputisalwaysequaltoX(N)=Xi(N)/Viforanychoiceofthestationi.From[3],theutilizationsattheMAPserverareknowntoberelatedby(cid:3)(cid:2)Kh=1h(cid:3)=k(cid:2)Mj=1qk,hM,j(cid:4)UkM(N)=(cid:2)Kh=1h(cid:3)=k(cid:5)(cid:2)Mj=1qh,kM,jUhM(N)(cid:6)(3)whichisaconsequenceoftheglobalbalanceequationsthatgoverntheMAPprocessatqueueM.Further,(cid:2)Kk=1(cid:2)Kh=1,(cid:2)Mj=1qk,hi,jUki(N)=(cid:2)Km=1(cid:2)Kk=1(cid:2)Mj=1qk,mj,iUkj(N),(4)foranychoiceofiandj,imposesequilibriumbetweenthemeanratesoftheinputandoutputﬂowsofthedifferentresourcesaccordingtotheﬂowbalancerule[1].Equations(1)-(4)arefundamentalforthedevelopmentoftheMAP-AMVAapproachintroducedinthenextsections.4.DoesMeanValueAnalysisApply?Inthissection,weinvestigatetheapplicabilityofclas-sicMVAtheoryinthecontextofMAPqueueingnet-works.EstablishedMVAapproximationofmodelswithnon-product-formfeaturessuchasblocking,priorities,orhigh-variabilityhavebeenobtainedbyanapproximationmethodologywhereoneﬁrstdescribesthemeanqueue-lengthseenonarrivalbyajobjoiningaresource’squeue[1],thenpropercorrectionsareintroducedtoaccountforthespeciﬁcfeaturesofthemodel,andﬁnallynumericalso-lutionsareobtainedbyﬁxed-pointiterationsimilarlytotheBard-SchweitzerapproximateMVAalgorithm[1].How-ever,similarresultsdonotexistforMAPnetworks.Here,wetrytoﬁllthisgapbyobtainingexactanalyticalformu-lastodescribemeanMAPnetworkperformanceandwedrawinsightsfromtheseobservationsleadingtotheMAP-AMVAapproximationschemepresentedinthispaper.CaseStudy.ToevaluatetheapplicabilityoftheMVAapproach,wefocusonasmallMAPnetworkwithN=4jobsandM=2queues,onewithexponentialservicetimesandonewithtwo-phaseMAPservicetimes(i.e.,K=2).Weassumethatthetwoqueuesareintandem.Thankstothesimplicityofthemodel,theunderlyingCTMCistheﬁnitequasi-birthdeath(QBD)processshowninFigure2.Markovmodelsofsuchsmalldimensioncanbesolvedeas-ilybyglobalbalance[1],butthistechniquehaslimitedap-plicabilityonmodelswithmorethantwoqueuesbecauseitscalespoorlywiththemodelsize.InordertoobtainanMVA-likesolutionoftheQBDus-inganapproachdifferentfromglobalbalanceandthatcouldremainefﬁcientongeneralMAPqueueingnetworks,MAP-AMVAevaluatestheQBDinFigure2asfollows.WestartbyconsideringasetofpartialbalanceconditionsontheQBDstatespace.Theseconditionsareequationsthatim-poseequilibriumbetweentheprobabilityﬂuxesexchangedthroughhorizontalorverticalcutsthatseparatetheQBDstatesintodisjointpartitions.Forexample,Figure2(b)showsanhorizontalcutthatseparatesthestate-spaceintotwopartitions,onedescribingtheevolutionofthenetworkwhentheMAPserverofresourceMisinphase1(graystates),theotherwhentheMAPisinphase2(blackstates).Thepartialbalancearisingfromthiscutimposesthattheprobabilityﬂuxdepartingfromthestateswherethesec-ondresourceisbusyandtheMAPisinphase1isequaltotheﬂowdepartingfromthecorrespondingstateswheretheMAPisinphase2;itcanbeveriﬁedeasilythatthispartialbalanceisexactly(3)inthecaseK=2andM=2,thusitisimmediatelyexpressedintermsofmeanvaluesonly,i.e.,utilizations.Ourgoalistoobtainalsofromverticalcutssimilarrelationsformeanqueue-lengthsandutiliza-tionthatmayhelpinunderstandingthemeanperformanceofthesystem.4.1QueueSeenonArrivalThegoalofthissubsectionistodemonstratethatmeanperformanceindicessuchasutilizationsandmeanqueue-978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE