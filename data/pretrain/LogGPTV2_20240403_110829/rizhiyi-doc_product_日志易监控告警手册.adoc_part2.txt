==== 基线对比
基线对比是将阈值设定为指定统计结果的基线值（随时间变动），您需要选择基线生成的时间范围，包括：
* 环比上一时段：比如统计最近五分钟的平均值，则环比上一时段的基线统计时间则是十分钟前到五分钟前。
* 同比一天前：比如统计最近五分钟的平均值，则同比一天前的基线统计时间则是昨天相同时分秒的五分钟。
* 同比两天前：类似一天前，只是统计前天。
* 同比三天前
* 同比四天前
* 同比五天前
* 同比六天前
* 同比一周前
* 同比一月前
同时，基线对比告警给您提供了更灵活的触发范围设定方式——您可以在下拉框中选择大于、小于、在区间内、在区间外。
例如，触发条件为：apache.req_time在10分钟内的平均值大于一天前此时段平均值的80%，则出发高级告警，则设定如下：
image::images/alert-baseline-config.png[]
==== spl统计
用户可以针对通过spl语句建立的新字段建立告警，只需要在空格处填写正确的字段名称即可。如果有多个数值类统计字段，也可以针对多个统计字段分别配置阈值条件，共同告警：
image::images/alert-spl-config.png[]
spl统计监控支持按字段切分发送告警和告警恢复通知。此外，如果无需判断具体字段值，单纯按 SPL 统计结果分行发送告警，可以填写为 `line-based`，但此时无法判断对应的告警恢复。
开启按字段切分后，SPL 统计监控还支持按切分字段值配置各自的分组触发条件。当字段值未能命中全部分组触发条件时，最后使用初始的默认触发条件进行阈值判断。
image::images/alert-spl-group-threshold-config.png[]
分组触发条件可用于系统/应用/中间件等基础运维场景，相同监控内容对应核心业务和边缘业务的告警阈值通常会有所不同。为方便业务人员修改自己业务线的告警阈值，日志易系统管理员可以选择将指定监控项的分组触发条件的修改托管到独立编辑页面中。对该监控项有只读权限的业务运维人员，无法调整监控语句等配置，但可以通过独立的分组条件编辑页面，修改自己对应业务的告警阈值部分。
image::images/alert-group-threshod-list.png[]
==== 流式匹配
用户可以选择对应的流式数据来源，配置事件过滤条件、进行数据补全，然后设置告警判断条件和告警级别。
image::images/alert-flink-keywords.png[]
事件过滤条件中，支持采用 AND、OR 方式，组合日志易内置字段间的过滤条件，包括等于、不等于等。
配置完事件过滤条件以后，可以点击预览，系统将从设置的 Kafka 来源中，读取一部分数据，供用户确认数据正确，并将预览数据中的字段名，用作后续配置数据补全和告警判断条件时的选择菜单项。
告警判断条件中，支持采用 AND、OR 方式，组合字段间比较条件、字段值比较条件、表达式间比较条件。
image::images/alert-flink-filter.png[]
==== 流式聚合
用户可以选择对应的流式数据来源，配置事件过滤条件、进行数据补全，然后设置聚合条件、分组字段、时间窗口和告警级别。
image::images/alert-flink-agg.png[]
事件过滤条件、数据补全和预览功能使用方式和流式匹配监控的使用方式相同。
聚合条件中，支持采用 AND、OR 方式，组合 count、distinct_count、avg、sum、max、min 等 6 种聚合函数的统计值阈值比较。
image::images/alert-flink-agg-func.png[]
流式聚合监控必须填写时间窗口，所有聚合函数均为该时间窗口内的统计值。此外，还支持按分组字段值判断阈值，分别发送告警和恢复消息。
=== 高级配置
==== 扩展搜索
支持在告警触发时发起另一个搜索，将其搜索结果附加在告警信息内。和常规配置一样，扩展搜索也能从已存搜索中选择添加，或手动输入：
image::images/alert-kuozhansousu-01.png[]
扩展搜索支持模板渲染语句。监控执行的搜索结果，可以在扩展搜索语句中作为变量使用。例如扩展搜索中的搜索内容是 `hostname:{{alert.result.hits.0.hostname}} AND [[ ap-pname:top_info_disk_io_stats | table hostname, ip ]]`，接收到的邮件内容如下：
image::images/alert-kuozhansousu-02.png[]
扩展搜索支持勾选插图效果选项，且该功能只能用于timechart 和 chart 命令。例如设置搜索内容为 `*|timechart count() by appname`
image::images/alert-kuozhansousu-03.png[]
邮件预览或收到的邮件可以看到timechart图表如下:
image::images/alert-kuozhansousu-04.png[]
==== 固定键值[[insert-pair]]
如果您仅需要在告警内容里附加一些标记文本，而不用发起一次完整的搜索请求，则可以添加若干个固定键值对，手动输入诸如"k":"v"的固定文本即可。
==== 告警抑制
防止您在短时间内遭遇告警邮件轰炸，您可以自由设定告警抑制方案（默认不对告警进行抑制）。告警抑制支持按次数和按时间两种。
* 告警次数抑制：连续触发N次以后才发送告警。通过配置该阈值可以实现多次触发，一次通知。
+
image::images/alert-advance-example.png[]
+
例如，触发通知阈值为100，则连续触发次数达到100次时才发送通知。发送通知之后，连续次数会清零重新开始计数。如果因网络异常等原因执行检查失败的，不计入次数。
** 对启用了切分效果的事件数和字段统计监控，可以勾选按切分字段值抑制。 当切分字段包含多个时，也可以设置为只按其中部分字段值抑制。
** 对启用了按行发送的 SPL 统计监控，可以勾选按字段值抑制，并填写具体的字段名称。
* 告警时间抑制：您可以设定一个固定时间段，在该时间段内触发告警之后则系统不再重复发送同类告警信息。
+
image::images/alert-suppression-time.png[]
+
** 倍增式时间段抑制：第一次触发告警后不再发送告警信息的时间段长度每次翻倍，直到设置的最大时长后重置。比如：设置为10分钟内只发送一次告警。同时选择抑制间隔时间翻倍，直到60分钟后取消抑制。
** 对启用了切分效果的事件数和字段统计监控，可以勾选按切分字段值抑制。 同样，多个切分字段时也可以选择部分字段作为抑制。
** 对启用了按行发送的 SPL 统计监控，可以勾选按字段值抑制，并填写具体的字段名称。
** 对流式监控类型，暂时只支持简单的固定时间段抑制。
SPL 统计监控中，搜索语句返回的结果表格可能含有多个字段，因此按字段值抑制可能会因为填写字段的不同产生不同的效果。比如，创建一个 SPL 统计监控， 搜索语句为`logtype:apache | stats count() as cnt_ by ip,apache.status`，触发条件为cnt_>100。如果连续触发阈值，则不同配置下对应的发送结果举例如图所示：
image::images/alert-suppression-example.png[]
* 不启用按行发送功能，不启用抑制策略时，则发送默认配置，在T1,T2,T3时刻分别发送第一列的三个表格。
* 启用按行发送功能，不启用抑制策略时，则每一行发送一条通知，即第二列。
* 启用按行发送功能，启用连续触发3次发送第一条告警功能，则T1时刻cnt_>100已经到了3条，发送T1时刻最后一条告警；T2时刻，T3时刻同理。
* 启用按行发送功能，启用连续触发3次发送第一条告警功能，启用按分组字段IP的值抑制，则T2时刻第一条，192.168.1.10已经到了3条，所以抑制完毕可以发送一次。T3时刻第二条，192.168.1.10又一次到3条，所以再次发送一次。T3时刻无192.168.1.11的告警，不满3次，所以即不发送告警，更没有告警恢复。
=== 告警方式
开启消息通知的情况下，您在系统通知栏可以看到告警触发信息:
image::images/notification-alerts.png[]
您也可以配置收到告警的方式，日志易默认带有rsyslog告警、邮件告警和告警转发三种模式。配置时可以测试运行，点击可以实际运行一次告警推送，验证推送配置。
==== rsyslog告警
选择添加rsyslog告警，用户可以根据实际情况自由更改Rsyslog地址、协议标准等内容。syslog内容可参考页面右下角参数说明。
image::images/alert-syslog-config.png[]
==== 邮件告警
您可以自行设定邮件标题、通知的邮箱地址以及告警邮件内容。系统提供默认的标准告警模板，屏幕右侧是所有可选择模板变量名称，选择对应的变量名称复制到左侧的内容模板即可，设定完成后点击保存完成操作。
填写接受邮箱时，您可以直接输入用户分组名称，日志易系统会自动发送给该分组所属的全部用户邮箱：
image::images/alert-mail-config.png[]
在分组内成员变更时，邮件告警收件人会自动变更为最新成员。如下图admin分组删除用户PI:EMAIL,则该用户不会接受到该告警邮件。如果admin分组增加新用户，则新用户自动收到该告警邮件。
image::images/alert-email-fenzu.png[]
===== 内容模板
邮件告警采用django模板语言渲染。您可以查看日志易内置的邮件告警内容默认模板进行酌情修改。Django模板语法简介，请参见稍后2.5小节。
==== 告警转发
添加能接受请求的地址，系统会发送JSON格式的告警内容到该地址。JSON的具体结构与模板基本相同。
==== 微信公众号告警[[wechart-alert]]
日志易支持微信公众号告警。这是初始版本，功能上实现了最基本的绑定和告警发送。以日志易公众号为例，实现微信公众号告警的步骤如下：
    1.关注日志易公众号。
    2.进入公众号，在下方输入框中输入“用户绑定”字样，并发送。
    3.公众号会自动回复一个链接，点进该链接，跳转进入绑定页面。
       注意：该链接只能在微信中打开，在其他浏览器打开无效。
    4.在绑定页面按需填写内容。
        注意：
        （1）绑定时可以填写任意能收到邮件的邮箱，但是日志易系统通过插件发送告警信息时，只会发送给注册过且操作者有权限查看的用户邮箱。
        （2）目前配置里设置的是：1个微信号只能绑定1个邮箱，且1个邮箱只能绑定一个微信号。
        （3）目前配置10分钟过期，验证码需在10分钟内正确填写，过期需重发邮件。
    5.绑定成功后，可以到日志易系统中，上传微信插件。
    6.在告警中选择微信插件，填入域名，端口号和绑定的邮箱，点击测试运行，接口发送微信告警。
      域名填写：wx.rizhiyi.com，端口号：80
      注意：如果包含未绑定，未注册或没有权限的邮箱，不会向其发送微信告警，不会明确提示，但日志可查。
    7.如果点击保存，将微信插件保存在告警中，则每次告警触发都会像绑定微信发送消息。
    8.微信告警消息会在日志易公众号中以消息的形式发送至绑定用户。
如果告警触发，用户可以看到微信公众号推送的
image::images/Wechat-Alert.png[]
==== 分等级推送
日志易监控支持分等级推送。
分等级推送功能要求首先在监控的触发条件中设置触发告警级别。目前告警级别和告警方式中的发送条件关联，如果没有设置触发级别，则告警方式的发送条件为无。
例如设置触发告警级别如下：
image::images/alert-fendengji-01.png[]
配置邮件告警中的发送条件如下：
image::images/alert-fendengji-02.png[]
则用户只能接受到[中][高]级邮件，不能接受到[低]级邮件。
其他告警方式同理。