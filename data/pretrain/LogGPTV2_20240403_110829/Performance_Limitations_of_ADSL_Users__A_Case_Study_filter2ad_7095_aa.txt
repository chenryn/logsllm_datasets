# Performance Limitations of ADSL Users: A Case Study

**Authors:**
- Matti Siekkinen
- Denis Collange
- Guillaume Urvoy-Keller
- Ernst W. Biersack

**Affiliations:**
- **Matti Siekkinen:** University of Oslo, Dept. of Informatics, Postbox 1080 Blindern, 0316 Oslo, Norway
- **Denis Collange:** France Télécom R&D, 905, rue Albert Einstein, 06921 Sophia-Antipolis, France
- **Guillaume Urvoy-Keller and Ernst W. Biersack:** Institut Eurecom, 2229, route des crêtes, 06904 Sophia-Antipolis, France

**Contact:**
- {urvoy, erbi}@eurecom.fr

## Abstract
This study presents an analysis of a 24-hour packet trace containing TCP traffic from approximately 1300 residential ADSL clients. Our findings confirm earlier studies, showing that a significant portion of the total traffic originates from P2P applications, and a small fraction of connections and clients are responsible for the majority of the traffic. The primary contribution of this work is a detailed throughput performance analysis of the clients. We observed surprisingly low utilization of both upload and download capacities for most clients. Using our TCP root cause analysis tool, we found that in over 90% of cases, the low utilization is primarily due to the P2P applications used by the clients, which limit the transmission rate, rather than network congestion. These applications typically impose upload rate limits to avoid uplink saturation, which can negatively impact download performance. Our analysis reveals that these rate limits are very low, leading to low aggregate download rates.

## 1. Introduction
We analyze a large packet trace of clients connected to the Internet via ADSL to investigate the causes of throughput limitations experienced by end users. For this purpose, we use a TCP root cause analysis (RCA) tool applied to TCP connections, with throughput as the performance metric. The causes of performance limitations can be located at the edge (sender or receiver) of a connection or within the network. Edge limitations include the application not providing data fast enough to the TCP sender or the TCP receiver window being too small. Network limitations may be due to bottlenecks along the end-to-end path. We perform RCA at both the connection and client levels.

Based on a 24-hour packet trace capturing the activity of over one thousand ADSL clients, we observe the following:
- The distribution of client activity in terms of volume and duration is highly skewed. Most clients are active only for a short period and generate a limited amount of traffic, typically several tens of MB, while a small number of "heavy hitter" clients upload and download hundreds of MB each.
- The utilization of uplink and downlink is very low for most clients, even for heavy hitters who are far from saturating their access links.
- The low utilization is mainly due to the applications that limit their transfer rates, which is common for P2.P applications like eDonkey.

## 2. Dataset
We collected a full day (Friday, March 10, 2006) of traffic generated by approximately 3000 ADSL users identified by IP addresses. We captured all IP, TCP, and UDP headers without any sampling or loss, resulting in approximately 290 GB of TCP traffic, with 64% downstream and 36% upstream. This day was typical in terms of the volumes uploaded and downloaded by clients. Out of the 3000 clients, 1335 generated sufficient data for RCA. We focus on these clients in our analysis. Additionally, we have a list of IP addresses belonging to local clients, allowing us to distinguish between upstream and downstream traffic. However, we do not know the subscription rates (uplink and downlink capacities) of the clients. The available subscriptions were (down/up): 128/64, 512/128, 1024/256, 1024/128, 2048/128, 2048/256, 3072-4096/160, 4096-5120/192, 5120-6144/224, 6144-8640/256, and 18500/840.

Our initial analysis of the trace revealed that the average volume of data uploaded is relatively constant throughout the day, around 2GB per 30-minute period. The volume of downloaded data is less consistent, averaging 3 GB per 30-minute period from midnight to 6 am and 4 GB per 30-minute period for the rest of the day.

Only five applications generated more than 5% of the total bytes: eDonkey, applications using ports 80/8080, BitTorrent, email, and telnet (due to a few hosts generating large amounts of traffic for unknown reasons). We identify applications using port numbers, associating the TCP port range 4660-4669 to eDonkey and ports 6880-6889 and 6969 (tracker) to BitTorrent. We do not classify traffic on ports 80 and 8080 as web traffic because it likely includes P2P traffic. The dominant category of traffic is from unidentified applications, referred to as "other" traffic, which represents about 50% of the total traffic. Our RCA does not rely on application identification to infer the causes of throughput limitations.

The distributions of traffic per connection and per client are heavily skewed, allowing us to classify clients into two categories: heavy hitters and non-heavy hitters. Heavy hitters, defined as the 15% of clients generating 85-90% of the bytes both upstream and downstream, represent 200 clients. The average amount of bytes uploaded and downloaded by a heavy-hitter client is approximately 470 MB and 760 MB, respectively, while for a non-heavy-hitter, these values are 9 MB and 27 MB. Heavy hitters tend to use P2P applications more extensively, as seen in the identified applications (e.g., eDonkey) and the more symmetric upload and download volumes.

Access link utilizations, both uplink and downlink, are generally very low. We observed that 80% of the clients have a downlink utilization of less than 20% and uplink utilization of less than 40% for a given 30-minute period.

Given the low link utilization, we will now investigate the causes using RCA techniques originally proposed by Zhang et al. [4] and further refined by Siekkinen et al. [5].

## 3. Performance Analysis of Clients

### 3.1 Connection-Level Root Cause Analysis
To apply RCA, we need TCP connections that carry at least 130 data packets, equivalent to about 190 kB of data assuming an MSS of 1450 B. As most connections are small, our RCA will only analyze the 1% of the largest connections, which carry more than 85% of the total bytes.

We classify the packets of a connection into two groups: Application Limited Periods (ALPs) and Bulk Data Transfer Periods (BTPs). ALPs are periods where the throughput is limited by the application's behavior, such as an IP telephony application producing packets at a fixed rate. BTPs are periods where the throughput is limited by other factors, such as network bottlenecks or TCP endpoint limitations. For details on how packets are classified, see our technical report [6].

For packets in BTPs, the causes of throughput limitations can include:
- **Network limitation:** A bottleneck limits the observed throughput. We distinguish between unshared (a single connection uses the full capacity of the bottleneck link) and shared (multiple connections share the capacity of the bottleneck link) bottlenecks.
- **TCP end-point limitation:** The advertised receiver window is too small compared to the bandwidth-delay product of the path, preventing the sender from achieving higher throughput. We also include transport limitations related to TCP ramp-up time [4].

The choice of the most likely limitation is based on metrics computed from the packet header trace and a threshold-based classification scheme. For details, see [5] and Chapter 7 of [7].

### 3.2 Client-Level Root Cause Analysis
We perform RCA at the client level, identifying four types of limitations: (i) Applications, (ii) Access link saturation, (iii) Network limitation due to a distant bottleneck, and (iv) TCP end-point limitation. Our analysis showed that TCP end-point limitations are marginal in our dataset, so we exclude this category from further discussion.

We define a client as active during a 30-minute period if it transferred at least 100 kB. For each active client, we consider all bytes transferred by all connections within that period and associate these bytes with the three considered client-level limitations. We use the connection-level RCA to classify the bytes: 
- Bytes carried by ALPs are associated with application limitations.
- Bytes carried by BTPs labeled as network-limited (unshared or shared bottleneck) with utilization above 90% of the maximum are associated with access link saturation.
- Bytes carried by the rest of the network-limited BTPs with utilization below 90% of the maximum are associated with network limitation due to a distant bottleneck.
- Any remaining bytes are associated with "other" (unknown) client limitations.

The amount of bytes associated with a limitation serves as a quantitative metric of the degree of that limitation for a given client during a 30-minute period.

We distinguish between the "main limitation" and "limitations experienced" for each client. The main limitation is the one affecting the most number of bytes, and this classification is exclusive. The limitations experienced include all causes experienced by the client, and this classification is not exclusive.

Table 1 shows the results for two 30-minute periods: 4-4:30 am and 3-3:30 pm. During the night, heavy hitters dominate, which is expected given their extensive use of P2P applications. Only a small fraction of the 1335 clients is active in either period. The results for the upstream direction are shown; the downstream results are similar and provided in our technical report [6].

| **Limitation Cause** | **Total Active Clients** | **Application Limitation** | **Access Link Saturation** | **Other Link** | **Other Cause** |
|----------------------|--------------------------|---------------------------|----------------------------|----------------|-----------------|
| **Upstream**         | **All**                  | **All**                   | **Main**                   | **4am**        | **3pm**        |
| **Clients**          | **3pm**                 | **Limitation**            | **Heavy Hitters 4am**       | **3pm**        | **4am**        |
| **77**               | **205**                  | **70**                    | **111**                    | **77**         | **205**        |
| **95%**              | **86%**                  | **94%**                   | **92%**                    | **100%**       | **100%**       |
| **90%**              | **92%**                  | **0%**                    | **6%**                     | **0%**         | **2%**         |
| **4%**               | **4%**                   | **4%**                    | **3%**                     | **60%**        | **39%**        |
| **66%**              | **64%**                  | **1%**                    | **4%**                     | **2%**         | **3%**         |

**Main Limitation.** Almost all clients experience throughput primarily limited by the application, regardless of the direction of the stream, type of client, or period of the day. Clients not limited by the application are limited by the capacity of the access link or another link along the end-to-end path. Capacity limitations occur more frequently during the daytime. The low number of cases where access link saturation is observed aligns with the low access link utilization noted in the preliminary analysis (Section 2).

**Limitations Experienced.** In addition to the main limitation, we consider all limitation causes experienced by a single client. The most striking result is the difference between the main limitation and the limitations experienced for the "other link" limitation. While this limitation is rarely the main limitation, 40-60% of clients experience it, indicating that while half of the clients experience such network limitations, they are not dominant. For a given client, the amount of bytes transferred while limited by the network is generally much less than the amount transferred while limited by the dominant cause (the application in almost all cases).

### 3.3 Throughput Limitations Causes Experienced by Major Applications
We now perform application-level RCA to investigate the major applications experiencing different limitation causes: (i) application limited, (ii) saturated access link, and (iii) bottleneck at a distant link. For each 30-minute period, we associate bytes flagged with limitations by client-level RCA to different applications based on the used TCP ports.

**Figure 1(a)** shows the main applications generating traffic that is application-limited. The total volume of application-limited traffic shows little variation over time, with upload and download volumes both around 2 GB per 30 minutes. The largest single application generating application-limited traffic is eDonkey, but the largest category is "other," suggesting a significant fraction of P2P traffic.

**Figure 1(b)** shows the main applications saturating the access link. No traffic from recognized P2P applications was seen. A significant portion of uplink-saturating traffic is email, while downlink-saturating traffic is primarily on ports 80 and 8080 and unidentified traffic. The fact that traffic on ports 80 and 8080 primarily saturates the downlink suggests it could be real web traffic. Most of the activity is concentrated during the day, with a peak in the early afternoon.

**Figure 1(c)** shows the main applications experiencing throughput limited by a link that is not the client’s access link. The "other" category dominates in terms of volume, and we observe a mixture of applications. This is expected since this type of network limitation can occur at any point in the network, regardless of the application behavior at the client.

---

**References:**
- [1] Technical Report (Extended Version)
- [2] Reference for Traffic Hiding
- [3] Recent Study on Japan's Residential User Traffic
- [4] Zhang et al. (Original RCA Proposal)
- [5] Siekkinen et al. (RCA Refinement)
- [6] Technical Report (Details on Packet Classification)
- [7] Book Chapter on RCA
- [8] Reference on P2P File Transfer Behavior

---

**Acknowledgments:**
This work has been partly supported by France Télécom, project CRE-46126878. Some work was done while Matti Siekkinen was at Institut Eurecom.

**Editors:**
- S. Uhlig
- K. Papagiannaki
- O. Bonaventure

**Publication:**
PAM 2007, LNCS 4427, pp. 145–154, 2007.
c Springer-Verlag Berlin Heidelberg 2007