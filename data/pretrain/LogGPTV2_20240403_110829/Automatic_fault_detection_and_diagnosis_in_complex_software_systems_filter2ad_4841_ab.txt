287
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 09:56:20 UTC from IEEE Xplore.  Restrictions apply. 
relativelynewmeasureandthereislittleguidanceastowhatvalueofNMIconstitutesanindicationofstrongcorre-lation.Wesolvethisissuebycomparingitwiththesquareofwell-studiedPearsoncorrelationcoefﬁcient,r2.TheﬁrstthreeNMIpropertiesalsoholdforr2;thefourthpropertyholdsonlyiffisalinearfunction.Ourworkstartswiththeobservationthatanypairofmetricswithstronglinearcorrelationmusthaveastrongcorrelation,buttheconverseisnotnecessarilytrue.There-fore,asuitableNMIthresholdforstrongcorrelationmustnotclassifyanypairofmetricswithhighr2asweaklycor-related.Therefore,areasonableNMIthreshold,tNMI,forstrongcorrelationwithrespecttother2threshold,tr2,forstronglinearcorrelation,isgivenby:tNMI=minr2XY>tr2NMI(X,Y)Thereforewecomputebothr2andNMIformanymetricpairs,andsoobtainanestimationoftNMIwithrespecttoagiventr2.2.3SystemMonitoringWeuseathree-stepproceduretomonitorthehealthofthetargetsystem.1.ComputesimilaritiesbetweenmetricsusingNMI.2.ClustersimilarmetricstogetherbasedonNMIvalues.3.Monitorclustersbytrackingin-clusterentropy.FirstwecomputetheNMIforeverypairofmetricsusingsamplescollectedfromthetargetsystemexecutingerror-free.Thenumberofsamplesmustbelargeenoughtocor-rectlyestimateastablevalueoftheentropy.TheresultingNMIvaluesarestoredinasimilaritymatrix,M.Second,wefeedMandtNMIintoaclusteringalgorithm,whichproducesasetofclusterssuchthatmetricswithinaclusterarecorrelatedtoeachother.However,sincearela-tionshipbetweenmetricsmaynotﬁtanypre-assumedform,itisverydifﬁculttoestablishanalyticalmodelsformetricsinthecluster.Theinformationentropyprovidesuswithatooltomonitorthestateofeachcluster.Sincemetricsinoneclusterarehighlycorrelated,theuncertaintyamongvaluesofmetricsintheclusteratanypointintimeshouldbesig-niﬁcantlylowerthantheuncertaintyofthesamenumberofuncorrelatedmetrics,regardlessoftheactualvaluesofthemetrics.Thus,theempiricalentropyofallthemetricsinoneclusteratanytimecouldbeconsideredasasignatureoftheclusteratthatmoment,givingusanindicationofthecurrentstatusofthatcluster.Third,wemonitoreachclusterbycomputingitsin-clusterentropyateverysamplingperiod.Asigniﬁcantandpersistentchangeinthein-clusterentropyindicatesapo-tentialfault,asthecorrelationsamongmetricsareeitherweakenedorstrengthened,bothofwhichcouldbesignsofanomalies.-0.2 0 0.2 0.4 0.6 0.8 1 1.2 1.4 0 32 64EntropyTime(a)-0.2 0 0.2 0.4 0.6 0.8 1 1.2 1.4 0 32 64EntropyTime(b)Figure1.In-ClusterEntropyChangeInourpriorworkwedidasmallcasestudytoseeiftheideaheldanypromise.Fault-injectionexperimentsshowedthatin-clusterentropychangedvisibly,asseeninFigure1,whichillustratessampleresultswhenthefaultwasinjectedattime-interval32.However,noformalevaluationwaspre-sented,becausenodetectionordiagnosisalgorithmsweredevelopedinthatwork.Thevariabilityinentropymadethedevelopmentofsuchalgorithmsnon-obvious.3FaultDetectionConsidertheentropybehaviouroftheclustersshowninFigure1.Theyshowselectedrepresentativeclusters’be-haviorwhensomefaultoccursattime-sample32.Humanoperatorscanreadilyidentifysigniﬁcantchangesinthepat-ternofthein-clusterentropy,and,asaresult,suspecter-rors.However,itisimpracticaltohavetheseoperatorscon-tinuouslytrackthebehaviourofallclusters.Ontheotherhand,automaticallyidentifyinganomaliesinthein-clusterentropyisverydifﬁcultbecausetherearenogeneralrulesthatdifferentiatebetweennormalanddisturbedbehaviour.978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
288
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 09:56:20 UTC from IEEE Xplore.  Restrictions apply. 
3.1Observationsaboutthein-clusterentropyBeforedevisingamethodtoautomaticallyidentifyanomalousbehaviour,severalcharacteristicsofthein-clusterentropyneedtobeconsidered.First,theempiricalentropyestimatedfordifferentclustersarenotcomparable.Asaresult,nosinglethresholdissuitableforallclusters.Thus,techniquesbasedonsettingthresholdsdonotwork.Onlyrelativechangesintheentropywithinindividualclus-tersprovidereliablesignalsforfaultdetection.Second,withinacluster,thein-clusterentropycanbeveryvolatile.Theempiricalentropyisonlyaroughesti-matecomputedfromasample;ifthesamplesizeissmall(e.g.,whenaclusterhasonlyafewmetrics),changesinin-clusterentropymaynotindicateanomalies.Forexample,changesbeforetime-interval32inFigure1(b)arenormal.Third,judgmentbasedonasingleobservationisnotre-liable(see,e.g.,time-interval21inFigure1(a)).Analgo-rithmmustconsiderseveralsamplesbeforedecidingthatanerrorexists;otherwise,manyfalsealarmsmayberaised.Theseobservationssuggestthatadeviationinentropyisareliableindicationoferrorsonlyifthedeviationisrelativelysigniﬁcantandpersistent.Therefore,wechoosetoemployanon-parametricstatisticaltest,namelytheWilcoxonRank-Sumtest[14],toidentifysigniﬁcantshiftsinthein-clusterentropyofindividualclusters.TheWilcoxonRank-Sumtestsuitsourneeds,as1)itisnon-parametric(i.e.,wemakenodistributionassumptions),anditdoesnotlearnathresholdorrelyononetowork;2)itisastatisticaltest,whichallowstemporaryﬂuctuationstobeaccommodated.3.2FaultdetectionbyWilcoxonRank-SumTestForfaultdetection,letEibethein-clusterentropyofclusterEattimei.InordertodetectasigniﬁcantchangeinEiwhenafaultoccurs,wekeeptwoslidingwindowsofEi’s.ThetestwindowconsistsofthemostrecentnEi’s.ThebaselinewindowconsistsofthemEi’sprecedingthetestwindow.WeapplytheWilcoxonRank-Sumtesttothetwowindows.Ifthetestindicatesasigniﬁcantshiftbetweenvaluesinthetwowindows,analarmisraised.TheWilcoxonRank-Sumtestisawell-establishedhypothesistest.Inourcase,thenullhypothesisisthatthetwosamplesets{Es+1,Es+2,...Es+m}and{Es+m+1,Es+m+2,...Es+m+n}fromthetwosamplewin-dows(s+1,s+m)and(s+m+1,s+n)arefromthesamedistribution.TheWilcoxonRank-Sumstatisticisgivenby:W=mXi=1nXj=1hs+i,s+m+j+m(m+1)2wherehij=1,Xicj.RatioScoreandSigScore,whichwediscusslater,aretwoexamplesofdiagnosisalgorithmsasdeﬁnedhere.Inourimplementationofthealgorithms,weconsiderclustersasmodelsandsoftwaremodules(e.g.,JavaServlet,JavaBean,MessagingEngine,etc.)assubsystems.Therefore,ourdiagnosislocalizesfaultsatthesoftwaremodulelevelbyintegratinganalysisresultsfromalltheclusters.How-ever,withthesamealgorithms,wecanchangethetuple(S,M,C,A,B)toextendourdiagnosistodifferentmod-elsandtodifferentdeﬁnitionsofsubsystem.Forexample,insteadofsoftwarecomponents,thesubsystemsmayrepre-sentdifferentmachines.MeasuresofDiagnosisAccuracyIngeneral,agoodalgorithmassignsthefaultycom-ponentahigheranomalyscorethanothercomponents.Wenowdescribetwomeasuresofdiagnosisaccuracy,theFaulty-ComponentRankandIdentiﬁed-FaultCounts,whichweusetoevaluatethequalityofourdiagnosis.Assumeadiagnosisalgorithmisappliedtomcaseswhereerrorsexistandaredetected.Weusei=1,2,...,masindicesofthesecases.LetSfibethefaultycomponentincasei,andribetheanomaly-scorevectorgivenbythediagnosisalgorithmincasei.Intuitively,therankofthefaultycomponentisanindicatorofdiagnosisquality.Thefaulty-componentrank,Ri,forcaseiisgivenby:Ri=nXj=11rifi≤rijwhere1Q=1ifQistrue,and1Q=0ifQisfalse.ThesmallertheRi,thebetterthediagnosisisforthecasei.Whileintuitive,thefaultycomponentrankaloneisofnopracticaluse.Systemadministratorsconsidercomponentsinorderofdecreasinganomalyscores.Theyﬁrstcheckthecomponentwiththehighestanomalyscore;ifnotfaulty,theyproceedtotheonewiththesecondhighestanomalyscore,andsoon.Forpracticalreasons(e.g.,timeavailabil-ity),administratorsmaysetacandidatesetsizetbefore-hand,andcheckifthefaultycomponentisoneofthecom-ponentswiththighestanomalyscores.Ifso,thefaultisdiagnosed,i.e,itisidentiﬁedinthetop-tcomponents.Foranyt,thenumberoffaultsthataresuccessfullyidentiﬁedinthetop-tcomponents(i.e.,theidentiﬁedfaultcount)isgivenby:Nt=mXi=11Ri≤tSincethereareonlyncomponents,t≤n.tcanbeanyin-tegervaluefrom1tonchosenbythesystemadministrator.4.2AlgorithmI:RatioScoreOurﬁrstdiagnosisalgorithmisRatioScore.Theideaistocountthenumberoftimesacomponentisfoundinanomalousclusters.Therationaleforthisalgorithmisthatafaultycomponentislikelytocausetheclusterswhichcon-tainthecomponent’smetricstoshowanomalousbehaviour.Asaresult,acomponenthasahigheranomalyscorethanothercomponentsifmoreclusterscontainingmetricsofthatcomponentdetectanomalies.Giventhemodel-subsystemassociationmatrix,M,andtheobservationvector,O(t),wecanusetheJaccardcoefﬁ-cienttoassignananomalyscoretoeachcomponent:rj=Pni=1ci(t)∩MijPni=1ci(t)∪MijUsingananomalyscorebasedontheJaccardcoefﬁcientisthebestcurrentdiagnosismethodbasedonmetriccor-relations.Whileithasbeenproposed[10,17]andevalu-ated[17]inthecontextofmetric-pairmodels,inthispaperwehaveextendedittoclusters.However,therearedrawbackstousingtheJaccardco-efﬁcientasanomalyscore.Componentsofasystemdifferintheir“popularity”;apopularcomponenthasmanyde-pendentcomponents.Thisphenomenoncancausepopu-larcomponentsthatdependonafaultycomponenttohavehigheranomalyscores.Thisisbecauseapopularcompo-nentismorelikelytohavemetricscorrelatedwiththemet-ricsofafaultycomponent.Thus,correlationmodelsofmetricsofapopularcomponentaremorelikelytoreportanomalies.978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
290
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 09:56:20 UTC from IEEE Xplore.  Restrictions apply. 
Figure3.ASampleSystemofComponentsABCDEanomalous?Cluster111111NoCluster211000YesCluster310100NoCluster410011YesCluster500011NoTable1.AssociationMatrixandObservationsToseetheeffectsofpopularcomponentsindiagnosis,considerasystemofﬁvecomponents,asillustratedinFig-ure3.Wehaveidentiﬁedﬁveclustersofmetrics,andafaultoccursincomponentB.ThefaultcausessomemetricsincomponentBtobehaveanomalously.Becausecompo-nentBdependsoncomponentA,somemetricsincompo-nentAareaffectedbythefault.Asaresult,Cluster2and4reportanomalouschangesintheentropylevel,whileClus-ter1doesnotreportanysigniﬁcantchange.Cluster1maynotreportananomalybecauseitislarger,andassuch,itsclusterentropycantoleratedisturbancetoafewofitsmet-rics.Thisproducesthemodel-subsystemassociationmatrixandtheobservationsshowninTable1.RatioScorewillresultinananomalyscorevectorof[0.5,0.33,0,0.25,0.25]T.ThemethodcorrectlyindicatesthatComponentBismorelikelytobethefaultythancom-ponentsC,D,orE.However,componentAisassignedthehighestanomalyscorebecauseitispopular.Ifthedepen-dencyinformationshowninFigure3isavailable,wecansuspectthatthehighscoreofcomponentAiscausedbyB;therefore,thescorescanbeadjustedtorankBhigher.4.3AlgorithmII:SigScoreWeproposetheSigScorealgorithmtoimprovethediag-nosisproducedbytheJaccard-coefﬁcient-basedRatioScorealgorithm.Thisalgorithmassumestheavailabilityofthedependencyinformation,whichcanbeobtainedfromthesourcecode,executiontraces,orotherartifacts.Theanomalyscoreofacomponentonwhichmanyothersde-pend(i.e.,themorepopularorsigniﬁcantitis)tendstobelessreliable.Weleverageknowledgeofcomponentdepen-denciestodampentheinﬂuenceofpopularcomponents.Todoso,weﬁrstcalculatethesigniﬁcance(popularity)mea-sureforallsystemcomponents,andthen,usethemtoadjusttheanomalyscores.Wedeﬁnethesigniﬁcancemeasureofacomponentasthelikelihoodthatitiscalledinthelongrun.ThisissimilartothelikelihoodthatawebpageisaccessedontheInternet(i.e.,thepopularityofawebpage).Assuch,computingthesigniﬁcancemeasuresofcomponentsgiventhesystemde-pendencygraphissimilartoPageRank[6].PageRankrankswebpagesbymodelingwebpagebrowsingasastochasticprocessandusesthestationaryprobabilitydistributionasameasureofpopularity.Wecanderivetherelativesigniﬁ-canceofcomponentsfromPageRankbymappingcompo-nentstowebpagesandpagereferencestocomponentde-pendencies.Wethusmodelthesystemasastochasticpro-cess,inwhichstatesarecomponentsandstatetransitionsareinter-componentcalls.Thesigniﬁcancemeasureistheresultingstationaryprobabilitydistribution.ToadaptPageRanktoourneeds,wemakethefollowingassumptions:1.Asystemconsistsofasetofcomponents(subsystems)denotedbyS={S1,S2,S3,...Sn}.Allactivitiesinthesystemcanbeviewedasaseriesoftransitionsfromonecomponenttoanother.2.Twocomponentsareneighboursifthereisadepen-dencyrelationshipbetweenthem.WedenotePiasthesetofneighbourcomponentsofSi.3.(optional)Everycomponenthasadependencyrela-tionshipwithatleastoneothercomponent;i.e.,Piisalwaysnon-empty.4.Executionshiftsfromonecomponenttoanotherbyaprogresstransitionwithprobabilityα,orbyanexittransitionwithprobability1−α.5.Inaprogresstransition,auserrequestcontinuestobeprocessedbyaneighbouringcomponent.Foracom-ponentSi,theprobabilitydistributionvectoruTide-ﬁneswhatcomponentexecutesnext,whereui(j)>0ifandonlyifSj∈Pi.6.Inanexittransition,theprocessingofthecurrentre-queststops,andanewrequestbeginstobeprocessed.ForacomponentSi,theprobabilitydistributionvec-torvTdeﬁneswhatcomponentexecutesnext,wherev(i)>0foreveryi.Thesixassumptionsreasonablyapproximatearealsoft-waresystem.Forexample,afunctioncallorreturnmaycauseaprogresstransition.Likewise,aconditionalstate-mentsuchas“if”mayleadtoatransitionfromcomponentSitooneofitstwoneighbours,SaandSb.Inui(a)ofthecasesittransitionstoSaandinui(b)ofthecasestoSb,whereui(a)+ui(b)=1.Whenarequestortaskistermi-natedandanewoneisstarted,thereisanexittransition.ThesystemstateTk∈Sisthecomponentprocess-ingarequestattimek.Letp(S)betheprobabilitythat978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
291