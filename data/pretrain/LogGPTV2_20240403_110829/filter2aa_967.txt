那些年年的密码学后⾨门
讲者 : OAlienO
⽬目录
1. Cryptographic Backdoor 
✦ 重要性 
✦ 种类 
2. Dual EC Backdoor 
✦ 介绍 
✦ 随机数很重要吗? 
✦ 后⾨门原理理 
✦ 故事时间 
3. Diﬃe Hellman Backdoor 
✦ 复习时间 
✦ Everybody Backdoor 
✦ Nobody-But-Us Backdoor 
4. Conclusion
Cryptographic Backdoor
Cryptographic Backdoor - 重要性
网路路通讯⼗十分依赖密码系统 
各国都想要 监听网路路通讯
密码学后⾨门
Cryptographic Backdoor - 种类
Everybody Backdoors : 
所有⼈人都可以进来來的后⾨门，与其说后⾨门，不如说是故意设置的漏洞洞 
Nobody-But-Us ( NOBUS ) Backdoors 
只有拥有⾦金金钥的⼈人才能⽤用的后⾨门，真正的后⾨门
Dual EC Backdoor
Dual EC - 介绍
Dual EC 是⼀一个伪随机数产⽣生器 ( pseudorandom number generator ) 
刚公布 Dual EC 的时候他就有许多问题 
1. 比其他的 PRNG 慢 
2. 产⽣生的随机数没有那么随机 ( biased ) 
3. 可能有后⾨门存在这个 PRNG 
Dual EC - 随机数很重要吗 ?
1. DSA - private key 
2. AES - iv, key 
3. RSA - p, q 
4. … 
许多的密码系统都需要随机数 
当我们能预测这些随机数，差不多就等同于我们可以破解他
Dual EC - 后⾨门原理理 
https://projectbullrun.org/dual-ec/documents/dual-ec-20150731.pdf
Dual EC 有两兩个版本 : 
Dual EC 2006 
Dual EC 2007
Dual EC - 后⾨门原理理 
https://projectbullrun.org/dual-ec/documents/dual-ec-20150731.pdf
Dual EC 2006
Dual EC - 后⾨门原理理 
https://projectbullrun.org/dual-ec/documents/dual-ec-20150731.pdf
256 bits 整数
P, Q 是在 Elliptic Curve 上的点
丢掉 16 bits
输出
不可逆函式
Dual EC - 后⾨门原理理 
https://projectbullrun.org/dual-ec/documents/dual-ec-20150731.pdf
椭圆曲线 ( Elliptic Curve ) ? 
就是满⾜足下⾯面⽅方程式的⼀一堆点
在密码学我们是⽤用这个
有了了⼀一堆点形成的集合 
再定义⼀一个加法运算 
我们就得到了了⼀一个群
Dual EC - 后⾨门原理理 
https://projectbullrun.org/dual-ec/documents/dual-ec-20150731.pdf
两兩个在 Elliptic Curve 上的点怎么加法 ? 
切线交点对 x 轴镜射
A
B
+
= C
Dual EC - 后⾨门原理理 
https://projectbullrun.org/dual-ec/documents/dual-ec-20150731.pdf
我们的不可逆函式就是⼀一个 
ECDLP ( Elliptic Curve Discrete Logarithm Problem )
这是个非常难的问题，所以可以把他当作不可逆函式
就是
这个点的 x 座标
Dual EC - 后⾨门原理理 
https://projectbullrun.org/dual-ec/documents/dual-ec-20150731.pdf
有了了不可逆函式 
我们没办法从输出 r 反推内部状狀态 s 
也就没办法从内部状狀态 s 往下预测接下来來的输出
Dual EC - 后⾨门原理理 
https://projectbullrun.org/dual-ec/documents/dual-ec-20150731.pdf
It sounds perfect 
What could possibly go wrong ?
Dual EC - 后⾨门原理理 
https://projectbullrun.org/dual-ec/documents/dual-ec-20150731.pdf
如果攻击者知道
使得
那丢掉的 16 bits 怎么办 ? 
直接暴暴⼒力力尝试 
Dual EC - 后⾨门原理理 
https://projectbullrun.org/dual-ec/documents/dual-ec-20150731.pdf
知道
得天下
Dual EC - 后⾨门原理理 
https://projectbullrun.org/dual-ec/documents/dual-ec-20150731.pdf
他其实还有⼀一个功能 
可以在输出完将⽬目前的内部状狀态 xor ⼀一个 additional input 
但是这个功能会损坏后⾨门，让后⾨门不好⽤用
使⽤用者可以选择要不要⽤用
Dual EC - 后⾨门原理理 
https://projectbullrun.org/dual-ec/documents/dual-ec-20150731.pdf
我们没办法从
求出
无法还原内部结构 s2
还原内部结构 s3
要求的输出超过两兩个区块
不受影响
Dual EC - 后⾨门原理理 
https://projectbullrun.org/dual-ec/documents/dual-ec-20150731.pdf
Dual EC 2007
Dual EC - 后⾨门原理理 
https://projectbullrun.org/dual-ec/documents/dual-ec-20150731.pdf
Dual EC 2007 修好了了后⾨门 
我们同样可以从 s1P 推出 s2 以及接下来來的状狀态 
但是还是需要猜 additional input
Dual EC - 后⾨门原理理 
https://projectbullrun.org/dual-ec/documents/dual-ec-20150731.pdf
所以真的有后⾨门吗 ?
求 d 是个 ECDLP
我们知道可能有后⾨门但不能证明有
直到 Edward Snowden 泄漏出 NSA 的⽂文件 XD
NIST SP 800-90 里⾯面完全没提到 P, Q 从哪里来來的
Dual EC - 故事时间 
https://csrc.nist.gov/csrc/media/projects/crypto-standards-development-process/documents/dualec_in_x982_and_sp800-90.pdf
Dual EC - 故事时间 
https://eprint.iacr.org/2006/190.pdf
2006 / 05 / 29
论⽂文提出 Dual EC 的输出没有很随机
Dual EC - 故事时间 
http://rump2007.cr.yp.to/15-shumow.pdf
2007 / 08
Crypto 2007 rump session 
Microsoft ⼈人员提出 Dual EC 可能有后⾨门
Dual EC - 故事时间 
https://www.wired.com/2007/11/securitymatters-1115/
2007 / 11 / 15
⼀一篇部落落格谈论 Dual EC 是不是真的有后⾨门
Dual EC - 故事时间 
https://csrc.nist.gov/projects/cryptographic-algorithm-validation-program/validation/validation-list/drbg
2008 / 07 / 03
RSA BSAFE 采⽤用 Dual EC
Dual EC - 故事时间 
https://csrc.nist.gov/projects/cryptographic-algorithm-validation-program/validation/validation-list/drbg
2009 / 09 / 30
Windows 7 采⽤用 Dual EC
Dual EC - 故事时间 
https://en.wikipedia.org/wiki/File:Classiﬁcation_guide_for_Project_BULLRUN.pdf
2013
Snowden leaks - Project BULLRUN 
验证后⾨门真的存在
Dual EC - 故事时间 
https://www.theverge.com/2013/12/20/5231006/nsa-paid-10-million-for-a-back-door-into-rsa-encryption-according-to
2013 / 12 / 20
NSA 给 RSA ⼀一千万美⾦金金 
将 Dual EC 设为 BSAFE 的 预设 随机产⽣生器
Dual EC - 故事时间 
https://www.cbronline.com/news/iso-nsa
2018 / 04 / 27
ISO 拒绝 将 
NSA 设计的 Simon & Speck 列列为标准
Difﬁe Hellman Backdoor
Difﬁe Hellman Backdoor - 复习
群 ( Group )
简⽽而⾔言之 : 群就是 ⼀一个集合 + ⼀一个运算元 满⾜足 ⼀一些条件
Difﬁe Hellman Backdoor - 复习
Order
Difﬁe Hellman Backdoor - 复习
Smooth Number
Difﬁe Hellman Backdoor - 复习
什什么是 Diﬃe Hellman ?
Difﬁe Hellman Backdoor - 复习
Discrete Logarithm Problem ( DLP )
Difﬁe Hellman Backdoor - 复习
Pollard’s Rho Algorithm
⽤用来來解 Discrete Logarithm Problem
Difﬁe Hellman Backdoor - 复习
Pohlig Hellman Algorithm
⽤用来來解 Discrete Logarithm Problem 
使⽤用条件 : 当 p - 1 是 smooth number
Difﬁe Hellman Backdoor - Everybody 
https://eprint.iacr.org/2016/644.pdf
Everybody Backdoors : 
1. p - 1 选 B-smooth 的数，让我们可以⽤用 Pohlig-Hellman 解 DLP 
2. 选⼀一个 order 很⼩小的 element 当 g，让我们可以⽤用 Pollard’s Rho 解 DLP
Difﬁe Hellman Backdoor - NOBUS 
https://eprint.iacr.org/2016/644.pdf
NOBUS Backdoors :
Difﬁe Hellman Backdoor - NOBUS 
https://eprint.iacr.org/2016/644.pdf
问题来來了了 : 
当 (p - 1) 和 (q - 1) 都是 B-smooth 的话 
可以直接⽤用 Pollard’s p - 1 Algorithm 分解 n 
这样所有⼈人都可以⽤用我们的后⾨门 ( NOT GOOD )
Difﬁe Hellman Backdoor - NOBUS 
https://eprint.iacr.org/2016/644.pdf
引入 pbig 和 qbig 两兩个相对较⼤大的质数 
⽤用来來抵挡 Pollard’s p - 1 Algorithm
Difﬁe Hellman Backdoor - NOBUS 
https://eprint.iacr.org/2016/644.pdf
不像⼀一般的恶惡意程式后⾨门 
使⽤用这个后⾨门时，我们只需要把 常数 换掉 
完全看不出来來我们在装后⾨门 XD
Difﬁe Hellman Backdoor - 防御 
https://eprint.iacr.org/2016/644.pdf
针对这个后⾨门的防御很简单 
就是确保参參数 p 真的是⼀一个质数 
如果允许 p 是合数的话 
还是很难分辨后⾨门和不是后⾨门
Conclusion
Conclusion
这次介绍了了两兩个密码学后⾨门 
Dual EC Backdoor 和 Diﬃe Hellman Backdoor 
可以看出密码学后⾨门的防护相较⼀一般的后⾨门困难 
1. 没有 general 的防护⽅方式 
2. 需要单独作分析来來防御 
3. 有些甚⾄至无法证明有没有被塞后⾨门 
4. 使⽤用其他⼈人设计的密码系统就会有风险
THANKS