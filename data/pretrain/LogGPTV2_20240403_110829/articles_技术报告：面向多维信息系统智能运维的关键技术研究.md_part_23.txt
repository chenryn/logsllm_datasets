当设备发生异常时，负载均衡指标异常检测能够快速发现异常并生成告警，通过分析告警，能够精准的定位到什么指标引起的设备异常。
从会话数、连接数、响应时延、新建连接数、CPU使用率和内存使用率六大指标全方位检测负载均衡设备实时的变化。
![负载总览](media/image101.png){width="6.033333333333333in"
height="2.620833333333333in"}
通过一到两个月的长周期基础数据训练出来的模型、模型不断的迭代更新和检测后运用其他算法二次分析减小实时检测的误差，避免因偶尔的数据突变而造成误告警。
![负载检测](media/image102.png){width="6.069444444444445in"
height="2.5881944444444445in"}
图 66 AI二次分析结果
##  数据库SQL模式异常识别
1.  应用背景
传统的以预防为中心的数据库安全机制存在不足,无法满足日益增长的对数据库安全的需要。在一个完整的系统环境中，所有的异常都应该被捕捉、处理并记录。单一的靠人工定期查看日志并创建基于发生异常的错误报告并不能完全解决和预测各种各样的异常发生。
2.  实现方案
基于SQL模式识别功能以及清洗模型，对大量历史数据库SQL进行模式标识及数据处理，形成数据库SQL指标。根据相关算法和参数生成相应的模型，对时序指标数据进行实时检测以及二次分析输出告警。
![](media/image103.png){width="5.7659722222222225in"
height="1.6888888888888889in"}
图 67 实现流程图
检查结果二次分析：
![](media/image104.png){width="4.254166666666666in"
height="2.665277777777778in"}
图 68 二次分析模型图
3.  落地效果
当SQL发生异常时，SQL异常检测能够快速发现异常并生成告警，通过分析告警的具体指标，能够快速定位SQL调用异常的原因。
从调用量、耗时、成功率三类指标实现了SQL调用量异常的实时监测。
![](media/image105.png){width="5.559722222222222in"
height="2.1272200349956254in"}
图 69 指标总览图
![](media/image106.png){width="5.700535870516186in"
height="2.2487423447069115in"}
图 70 SQL告警列表与错误数展示
从总体上能及时了解SQL调用情况，同时能逐步细化到单个异常SQL的报错信息与指标趋势。
![](media/image107.png){width="5.775in" height="2.0968864829396328in"}
图 71 异常SQL指标趋势图
# 总结与展望
面向多维信息系统智能运维方案能为电力能源类企业带来多方面效益。
1.  经济效益
```{=html}
```
1.  引入自主可控的技术，节省经济成本
    通过智能运维平台的数据采集使得采集的机器性能监控指标和应用指标的数据更加完善，基于大数据以及机器学习算法对数据进一步分析得出的告警指标更准确。同时，采集Agent和监控Agent可以较好的整合后对系统性能得到最大利用，较完美的替代了传统监控软件。最终解决了采用国外知名的软件厂商存在的两个缺点：一是较为封闭，难以进行定制化开发；二是价格昂贵。
运用智能运维平台，利用真实的运维数据，优化回收算法、跨虚拟化平台运作、智能选择不同的自动化资源回收方法，可以实现资源智能回收、资源弹性伸缩和容量趋势分析，提高系统资源的使用率，降低采购成本。
智能运维平台促进运维制度落地，日常运维管理规范性、数据准确性和可审计性大大提高。可以极大减少IT运维人员流程性工作、重复性工作，减少业务暴增带来的人力缺口，降低人力成本，人员工作效率得以提升。
2.  数字化管理，大幅提升运维价值
通过智能运维平台智能化算法对数据进行多维分析和数据挖掘，为运维决策提供了大量数据支持，覆盖了一个应用从业务到基础架构，从指标到实际日志的全面覆盖。运维人员可以通过平台快速了解整个应用的状态，使得人员的运维能力得到提高，大幅度提高了运维效率，同时带来更多价值：
-   洞察IT状态
智能运维平台的可视化模块，基于智能分析算法，全局、全面掌控数字化运营状态，帮助管理人员清晰直观地掌握业务运营与IT运维中的有效信息，实现可视化管理、有效管理与有效决策，提升资产管理与监控管理的效率。
-   提升用户服务满意度
运维平台的自助服务化体系，为业务团队、开发团队、最终用户提供端到端的服务交付，提升用户服务满意度。
-   让数据中心走进业务
运维数据聚合分析平台借助业务运维数据分析和挖掘，实现数字化运营，为业务运营带来资源利用率的提升和业务数据的分析决策辅助。
3.  AIOps场景落地，提升系统稳固性
通过智能运维平台对数据进行深度挖掘，结合智能算法，实时对应用系统的状态进行主动检测，在故障发生之前可以发现潜在的异常，提前阻止故障的发生，系统可用性得到大幅提升。故障发生时，快速定位到异常点，帮助运维人员快速判断异常原因，及时处置，提升系统RTO水平，降低了风险处置的损失影响。
运维智能化最大的价值在于增强和扩展现有的运维模式和运维手段。传统运维只有被动的响应式运维和基于时间规划的主动式运维。智能运维平台通过立体化监控组件和根因分析组件能够大大增强发现问题和定位问题的效率。通过整合大数据和机器学习能力，分析数字化转型过程中数据量、种类和速度三个维度不断增长的IT数据，帮助企业快速洞察人力难以企及的故障和问题，准确预测风险，增加预知性的主动运维能力。
1.  社会效益
### 探索智能运维建设，树立智能运维在电力行业的实践标杆
智能运维可以为证券行业金融科技的快速发展带来的收益已经得到广泛接受，然而如何有效落地在证券行业鲜有成功案例。我们通过本项目探索出一条有效的建设路径，为行业在智能运维领域的发展提供一套行之有效的实践路径。
智能运维平台以开放式的体系，组合数据以及算法实现构建智能运维场景。在平台建设过程中，首先注重安全先行，做好数据治理工作；在算法研发这一块，与国内顶级高校合作共研算法，充分利用高校的学术研究能力，行业的数据特点以及运维经验，实现算法从学术到应用实际落地；在应用场景方面，我们采用循序渐进的思路进行建设，选择从实际运维痛点的场景出发建设，不求一步到位，以单指标监测异常，多指标异常定位，日志异常检测等解决实际问题的场景着手，待场景完善后通过持续迭代向故障治愈的方向逐步发展。
目前，智能运维平台从平台架构设计、算法研发应用到场景落地均已经实际落地并且取得了良好实际效果，为智能运维在金融行业落地树立了标杆，具备很强的参考以及推广价值。
### 夯实健康发展的技术基石
在国家电网快速发展的今天，各项业务开展均离不开信息技术，而信息安全领域，保障信息系统安全稳定运行，避免发生信息安全事故重中之重的根本任务，涉及到未来电力行业的健康发展。
智能运维平台通过将数据与算法的有效结合，为信息安全工作中最重要的运维工作提供了提前预测故障的能力使得潜在风险得以提前化解，提供了问题定位和决策分析工具将问题定位和决策的时间大幅消减。智能运维在电力行业的不断深入和发展，将极大降低信息安全事件的发生和处置成本，夯实了信息安全的技术保障，为健康发展提供有效的技术基石。
1.  **技术创新**
```{=html}
```
1.  多维信息系统海量全种类运维数据集中采集、规范化与存储
日志采集模块采用高可用、高可靠、分布式的海量日志采集、聚合和传输的架构，支持在日志系统中定制各类数据发送方，用于收集数据，同时提供对数据进行简单处理功能。完成对证券信息系统的日志整体对接，支持对业务系统、数据库、中间件、服务器、网络设备、安全设备日志采集，并支持各种格式的数据（文本、XML、数据、事件、消息、专有格式等任何数据）。采集模块满足数据的真实性、安全性及完整性，防篡改、支持加密传输，限制日志上报占用带宽、指定时间传输数据、压缩传输、采集频率等，以减少对系统的影响。所采集的日志都会包含应用名称、主机名称、标签，以保证对日志类型、来源等信息的区分，也可以使用这三个维度对日志重新分类，以增加对数据可管理性。
日志采集协调模块用于大型分布式系统的高可靠协调，提供的功能包括：配置维护、名字服务、分布式同步、组服务等。封装好复杂易出错的关键服务，将简单易用的接口和性能高效、功能稳定的系统提供给用户。
日志消息处理模块用于消息的持久化和缓存。该模块使用磁盘文件做持久化，顺序进行读写，以append方式写入文件。为减少内存copy，集群使用sendfile发送数据，通过合并message提升性能。集群本身不储存每个消息的状态，而使用（consumer/topic/partition）保存每个客户端状态以减少维护每个消息状态的麻烦。在消息推拉的选择上，集群使用拉的方式，避免推的方式下存在的各个客户端的处理能力、流量等不同产生不确定性。
2.  可编程式检索与分析
索引集群采用分布式搜索引擎，具备高可靠性和高性能。支持时间文本索引和全文检索，提供丰富的API用于索引、检索、修改大多数配置。能够快速搜索数百亿的集群由2台及2台以上节点组成，其中一个为主节点，节点通过选举产生，主从节点是对于整个集群内部来说的，从外部来看整个集群，逻辑上是一个整体，与任何一个节点的通信和与整个集群通信是完全一致的。集群自动创建索引，通过配置我们可以非常方便的调整索引分片和索引副本。通过索引分片技术，一个大的索引被拆分成多个，然后分布在不同的节点上，以构成分布式搜索。索引副本的作用一是提供系统的容错性，当某个节点某个分片损毁或丢失时，可以从副本中恢复；二是提供查询效率，集群内部会自动实现搜索请求的负载均衡。
-   支持智能检索功能，可通过输入的关键字条件快速检索到相关的日志数据，并可以进一步查看日志数据的详细信息。
-   支持通过关键字、条件表达式、时间范围等对事件及数据进行快速检索，快速定位到运维分析人员关注的威胁事件和上下文数据，并支持查看数量趋势统计和检索结果详细数据。
-   支持TB级别的数据量检索。
3.  运维指标数据的实时分析与计算
数据收集层直接接收采集客户端上送的数据，实时写入到Kafka
Topic，流处理引擎Logriver从Kafka直接消费数据进行格式化处理存入到搜索引擎YottaSearch中，同时提供SparkStreaming流处理和Spark离线处理等多种处理方式，按照不同数据需求者的要求提供数据。
4.  算法创新
在异常检测领域，传统的异常检测通常会存在着算法选取、参数调优困难、严重依赖标签、性能不理想或缺乏理论基础等问题。而我们针对于上述问题采用一种基于深度生成模型的无监督异常检测算法，此算法具有较强的理论解释力，该算法可以利用偶尔可用的标签，减少对标签的依赖性，更高的实用性。更好的性能与更高算法精度：为所有算法都计算出每个阈值对应的精度和召回率，通过选择阈值来进行决策。
  ------------------------------ ------------------------------------------------------------ ----------------------------------------------------------------------------------------------------
  技术创新点                     国内外、同行业现状                                           优势
  无监督异常检测框架             基于人工标注的训练过程，或者人工选择算法、调节参数适配效果   根据历史曲线特性进行侧写，自动选择算法调参数，无需标注，无需人工干预，让大规模进行异常检测成为可能
  基于自分编码器的异常检测算法   主流采用EWMA、3-sigma或者Arima等通用检测、预测算法           集成深度学习效果，检测效果更加精准且能够更好地学习曲线特性
  ------------------------------ ------------------------------------------------------------ ----------------------------------------------------------------------------------------------------
模型的无监督异常检测算法，此算法具有较强的理论解释力，该算法可以利用偶尔可用的标签，减少对标签的依赖性，更高的实用性。更好的性能与更高算法精度：为所有算法都计算出每个阈值对应的精度和召回率，通过选择阈值来进行决策。
1.  未来展望
结合雄安新区城市和电网发展，智能运维的建设过程也应总体按照"三步走"实施。在信息支撑方面启动多业务支撑平台建设，利用AIOPs技术重点提升输、配、变、用侧能源信息感知能力，夯实设备运维、客户服务、综合能源管理等业务数字化升级基础；2022年依托AIOps强大、完备的感知能力，实现源网荷储的多物理层次、多时间尺度数字化描述，建成雄安新区数字化主动配电网数字孪生体系；
2030年配合实现数字孪生体系与雄安新区数字城市的高度融合，重点支撑以电为中心的能源业务、以数据为中心的企业中台和以客户为中心的市场体系。
除上述研究的五个内容外，未来我们还可以在以下几个方面开展进一步研究与实践。
### 建设智能运维知识图谱
知识图谱应用在运维和排障领域，将融合算法、日志、指标、告警、事件、历史故障知识信息，整合成一张故障运维知识图谱体系，有效地实现了相互之间的数据调度、算法编排、模型管理等，使系统更具平台性及扩展性。
知识图谱最初是谷歌为了提升搜索引擎能力而提出的，描述实体与实体之间关系的数据库模式。运维知识图谱将传统CMDB中以配置项为主体的关系型数据库管理模式，转换到以配置项、系统应用、数据和算法为主要实体类型，之间的关联和配置属性为主要关系类型的图数据库管理模式。在索引上，利用图数据库的级联查询能力，能够轻松描述出传统关系型数据库中难以描述的查询需求，轻松获取所需数据；同时，数据的更新依赖更小，能够对运维图谱的较小局部进行更新，即可完成传统CMDB更新中对大量表项和关系更新才能完成的操作。最后，图数据库可以应用丰富的图算法，描述应用故障的影响传递行为。
### 建设故障自愈逻辑
应用故障自愈遵循故障自愈整体流程逻辑，复用已建的异常检测、故障诊断、容量预测分析服务能力，结合关联指标诊断服务，综合分析诊断应用集群可能发生的故障或已经发生故障，匹配自愈方案并进行自愈操作，从而避免故障的发生或降低故障的影响，保证业务系统正常运行。系统能够支持自愈的应用异常或故障情况：应用进程僵死、应用内存溢出、应用服务报错或掉线。
根据诊断结果调用自愈方案自动恢复故障，自愈方案时需要打通周边系统实现整个流程的闭环，如CMDB、邮件系统等;
自愈方案采用Playbook（剧本）形式可编排化自愈流程，根据不同应用、不同类型故障定制自愈流程。
Playbook形式可编排化自愈流程，根据不同应用、不同类型故障定制。自愈流程；Playbook(自愈剧本)全流程可视化编排，通过自动化处理节省人力投入，通过预定的恢复流程让恢复过程更可靠，通过并行分析达到更快的故障定位和恢复。
![](media/image108.png){width="5.768055555555556in"
height="1.7347222222222223in"}
图 72 故障自愈方案
在智能时代，数据是生产资料，算法是生产力。在下一步的智能运维工作中，应在当前研究的指导下，通过积累数据、尝试算法和搭建智能中台等方式，尽快为各层场景打下坚实的基础，进一步提高运维的智能化程度，探索智能运维知识图谱等新体系，提升运维质量，发挥运维价值。结合大数据智能引擎来管理海量异构的后台资源，实现多维信息系统的智能运维方案，从而支撑前台业务快速上线、稳定运行，让智能运维在润物无声之中，开创智慧能源建设新局面。