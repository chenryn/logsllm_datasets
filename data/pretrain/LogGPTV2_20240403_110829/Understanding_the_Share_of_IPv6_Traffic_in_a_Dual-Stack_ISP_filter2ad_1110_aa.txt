title:Understanding the Share of IPv6 Traffic in a Dual-Stack ISP
author:Enric Pujol and
Philipp Richter and
Anja Feldmann
Understanding the Share of IPv6 Traﬃc
in a Dual-Stack ISP
Enric Pujol1,2(B), Philipp Richter2, and Anja Feldmann2
1 BENOCS GmbH, Berlin, Germany
2 TU Berlin, Berlin, Germany
PI:EMAIL
Abstract. After almost two decades of IPv6 development and conse-
quent eﬀorts to promote its adoption, the current global share of IPv6
traﬃc still remains low. Urged by the need to understand the reasons
that slow down this transition, the research community has devoted much
eﬀort to characterize IPv6 adoption, i.e., if ISPs and content providers
enable IPv6 connectivity. However, little is known about how much the
available IPv6 connectivity is actually used and precisely which factors
determine whether data is exchanged over IPv4 or IPv6. To tackle this
question, we leverage a relevant vantage point: a dual-stack residential
broadband network. We study interactions between applications, devices,
equipment and services, and illustrate how these interactions ultimately
determine the IPv6 traﬃc share. Lastly, we elaborate on the potential
scenarios that dual-stack ISPs and content providers may confront dur-
ing the Internet’s transition to IPv6.
1 Introduction
The initial and ubiquitously deployed version 4 of the Internet Protocol has a
fundamental resource scarcity problem: it reached the limit of available, globally
unique, IP address space. As of today, IPv4 address scarcity has become a global
issue, forcing some ISPs to NAT large chunks of their customers [43] or even to
buy blocks of remaining free IPv4 address space on address markets [41]. IPv6,
which oﬀers a vastly larger address space was intended to replace IPv4 long
before scarcity of IPv4 address blocks commenced. However, despite initiatives
by Internet governing bodies to promote IPv6 deployment [5], the transition to
IPv6 has been slow and challenging in production environments [7,16]. As of
today, there is no clear consensus about when IPv6 will really “hit the breaking
point”, i.e., when IPv6 will become the preferred interconnectivity option on
the Internet. The research and operations communities have put substantial
eﬀort into measuring and tracking IPv6 deployment with the goal of assessing
this transition (e.g., [19]). However, current statistics show a disparity between
two adoption metrics: connectivity and traﬃc share. For example, while Google
reports optimistic connectivity adoption rates as high as 16% for end hosts [4]
as of January 2017, the IPv6 traﬃc share at major Internet eXchange Points
(IXPs) still ranges between 1–2% [2]. The comparably low share of IPv6 traﬃc is
c(cid:2) Springer International Publishing AG 2017
M.A. Kaafar et al. (Eds.): PAM 2017, LNCS 10176, pp. 3–16, 2017.
DOI: 10.1007/978-3-319-54328-4 1
4
E. Pujol et al.
Home network
Dual-stack ISP
Service providers
IPv4 traffic 
IPv6 traffic 
Internet
(i) OS
(ii) applications
(iii) 
CPE
(iv) ISP connectivity
(v) service availability
Fig. 1. IPv6 traﬃc in dual-stack networks. Barriers are present at home networks
(operating systems, applications and CPEs), ISPs (oﬀered DSL connectivity), and at
service providers.
not only one of the main reasons for disappointment regarding the pace of IPv6
adoption, but has also fueled a diﬀerent interconnection structure among ISPs.
The provider hierarchy in the IPv6 Internet shows vastly diﬀerent properties
compared to that of IPv4 [23], i.e., the one ISP oﬀering free IPv6 tunnels has the
largest customer cone in the IPv6 Internet, whereas Tier-1 ISPs with worldwide
backbones are less prominent in this hierarchy.
We argue that increasing IPv6 traﬃc shares will eventually provide the incen-
tives for ISPs to provision proper IPv6 infrastructure, establish genuine intercon-
nectivity, and ﬁnally make IPv6 the ﬁrst-class citizen on the Internet. However,
to exchange data over IPv6, all components on the path from a source to a desti-
nation need to fully support IPv6 (see Fig. 1). This includes (i) end-user devices
and operating systems supporting IPv6, (ii) applications making proper use of
the available connectivity options (see [49]), (iii) customer premises hardware
(CPEs) supporting and providing IPv6 to the home network [3,48], (iv) the ISP
assigning IPv6 to the subscribers CPEs [20], and ﬁnally (v) content providers
enabling their services over IPv6 [34]. Moreover, even if all of the above condi-
tions apply, i.e., all components support IPv6, a second dimension of the problem
is whether IPv6 will be preferred over IPv4, as modern applications employ a
technique named “happy eyeballs” to choose between IPv4 and IPv6 according
to the current network conditions [51].
Determined to investigate the reasons that refrain the increase of IPv6 traﬃc
on the Internet, we study this problem from the perspective of 12.9 K subscribers
of a dual-stack ISP. This vantage point gives us a unique opportunity to analyze
the interactions between applications, devices, equipment and services, and how
they eventually inﬂuence the share of IPv6 traﬃc. Our main ﬁndings can be
summarized as follows:
(i) Even though this ISP supports IPv6 connectivity, a large number of sub-
scribers can not use IPv6. While in some few cases the ISP does not provide
IPv6 connectivity to its subscribers, more often the CPE limits IPv6 con-
nectivity.
Understanding the Share of IPv6 Traﬃc in a Dual-Stack ISP
5
(ii) Consequently, IPv6-ready services exchange a signiﬁcant amount of traf-
ﬁc over IPv4. IPv4-only speaking devices and fallback mechanisms further
increase the share of IPv4 traﬃc for these services. We observe, on the other
hand, a strong intent for IPv6 traﬃc that IPv4-only services are not yet
ready to correspond to.
(iii) Due to dual-stack applications’ preference for IPv6, dual-stack networks
could face a rapid and substantial increase of the IPv6 traﬃc share if only
a few major service providers enable IPv6 for high-traﬃc domains.
The rest of this manuscript is organized as follows: Section 2 summarizes
related work. We describe our methodology in Sect. 3 and introduce our dataset
in Sect. 4. Section 5 presents our ﬁndings. We discuss implications and limitations
of our work in Sect. 6, and conclude with Sect. 7.
2 Related Work
The research community has called for data that can help tracking the evolu-
tion of IPv6 [17]. Some works have reported the IPv6 traﬃc share at multiple
vantage points in the Internet. In 2008, most IPv6 traﬃc at a tier-1 ISP in the
US was DNS and ICMP [29]. While initiatives such as the “World IPv6 day”
in 2011 ignited the increase of IPv6 traﬃc at various vantage points [46], by
2013 the share of IPv6 traﬃc at European IXPs or at 260 network providers
was still below 1% [19,42]. Nonetheless, every year IPv6 traﬃc experiences a
many-fold increase [19]. This development has encouraged studies on dual-stack
networking performance [11,16,38,40], active measurements of the Internet’s
IPv6 infrastructure [13,32] and analyses of the AS-level topology [21,23]. More-
over, a large body of literature has focused on measuring IPv6 adoption among
ISPs and service providers [18,19,21,23,28,29]. Some works seek to understand
the root causes that slow down IPv6 adoption and ﬁnd a slower pace of adoption
at the edge compared to core networks [21], or poor IPv6 quality in the early
days of this transition [37]. As of today, the IPv6 control and data planes are—
when applicable—almost on par with IPv4 [31], while both control planes show
signs of convergence [23]. In parallel to the research community, standardization
bodies have invested decades to address IPv6-related aspects. Relevant to our
work are fallback mechanisms for dual-stack applications [51] (happy eyeballs)
and their implementations (see e.g., [6,26,27,47]). We complement this body of
work with a passive measurement study at a dual-stack ISP to shed light on why
some data exchanges occur over IPv4 instead of IPv6.
3 Methodology
The focus of our study is the traﬃc at a residential broadband network of a dual-
stack ISP. As shown in Fig. 1, IPv4 and IPv6 traﬃc coexist at such a vantage
point. Whether IPv4 or IPv6 is used depends on a large variety of factors men-
tioned earlier in Sect. 1. Hence, a dual-stack ISP presents a unique opportunity
6
E. Pujol et al.
to study the interactions of this ecosystem and its inﬂuence on the share of IPv6
traﬃc. To this end, we ﬁrst need to discover the connectivity options of the two
engaged parties, i.e., the subscribers (the client side) and the service providers
(the server side). With this information in hand we can proceed to study which
traﬃc is exchanged over which protocol, and why.
3.1 Measuring IPv6 Connectivity
Connectivity of subscribers (“client side”). Broadband network providers
typically rely on Remote Authentication Dial-In User Service (RADIUS [44]) to
assign IP addresses to subscribers. With this protocol, CPEs obtain IP addresses,
usually a single IPv4 address that multiplexes devices (NAT). This protocol
speciﬁcation also supports the delegation of IPv6 addresses to subscribers [8,20,
45]. If the CPE receives an IPv6 preﬁx assignment, we say that the subscriber
obtains IPv6 connectivity from the ISP. Traﬃc statistics later tell us whether
the subscriber’s devices make actual use of this assigned IPv6 preﬁx.
Since not all devices within home networks support IPv6, the raw traﬃc
statistics are necessary but not suﬃcient to infer if a device within a subscriber’s
premise can use IPv6. We use AAAA DNS requests as an indicator for the presence
of IPv6-speaking devices. Most dual-stack applications follow the happy-eyeballs
proposed standard (see [51]), and issue A as well as AAAA DNS requests. If
the requested service is available over IPv6, the device attempts to connect
simultaneously to two addresses contained in the DNS resource records (RRs);
one being IPv6 and the other IPv4. An application that adheres to the example
implementation then establishes two TCP connections and uses the one that
completed the handshake faster. Some implementations introduce a preference
towards IPv6. For example, Apple devices issue an IPv6 connection immediately
after a successful AAAA request if the A response did not arrive already, or if
historical RTT data suggests a diﬀerence > 25 ms [47]. Given that most DNS
clients issue AAAA requests ﬁrst [36], some dual-stack devices do not always
attempt a connection over both IPv4 and IPv6 although they issue requests for
both RRs.
One important fact regarding IPv6-speaking devices is that many resolver
libraries avoid suppressing AAAA requests if there is no global IPv6 connectivity,
but just link-local, i.e., within the home network. The rationale is that doing so
can lead to undesired situations [1]. Thus, we can use this information to further
identify CPEs that oﬀer link-local IPv6 connectivity even if the ISP does not
provide IPv6 connectivity to them.
Connectivity of services (“server side”). In this paper we use the term
service to refer to content and functionality that is available on the Internet via
a Fully-Qualiﬁed Domain Name (FQDN). For example, at www.google.com we
can ﬁnd a search service as well as plain content. If the network infrastructure
that hosts a service supports IPv6, a service provider willing to make its services
available over IPv6 just needs to update the corresponding DNS AAAA and PTR
resource records (RRs) [34]. Henceforth, we can analyze DNS traﬃc to infer if
Understanding the Share of IPv6 Traﬃc in a Dual-Stack ISP
7
a service is IPv6-ready by looking for non-empty AAAA responses in our traces.
However, as we may not be able to observe all AAAA RRs (e.g., if the clients
are not IPv6 enabled), we complement passive data with active measurements,
i.e., we actively request AAAA records for FQDNs found in our trace.1
3.2 From IPv6 Connectivity to IPv6 Usage
Now that we are aware of the connectivity options of subscribers and services
(IPv4 and/or IPv6), we proceed to study the exchanged traﬃc. To accomplish
this, we ﬁrst need to annotate each ﬂow in our trace with the respective sub-
scriber and service.
Matching ﬂows to names. One of the building blocks for our methodology is
the ability to associate the DNS requests issued by an IP address to the network
ﬂows it generates, i.e., reproduce the mapping between FQDNs and server IPs for
each subscriber. This problem has been already explored (see, e.g., [12,35,39]),
and we extend it to include the connectivity information. It is important to
notice that for dual-stack networks the IP addresses of the ﬂows and those of the
DNS traﬃc are not necessarily the same. Therefore, we cannot directly use the
source IP of a DNS request as a rendezvous. Instead, we keep track of the IPv4
and IPv6 addresses assigned to each subscriber. Another caveat (as reported
in related work) is that we need to update this mapping according to the TTL
values of the DNS response RRs. We are aware that related studies have reported
violations of the TTL ﬁeld by clients [14,35]. For example, Callahan et al. [14]
observe that 13% of the TCP connections use expired records and attribute it
to security features present in modern Web browsers. In this work we opt for a
conservative approach and strictly use the TTL expiration values. In addition, we
do not consider negatively cached responses, e.g., a service without a AAAA RR.
Our rationale is that although negative answers should, in principle, be cached
according to the SOA record [10], some resolvers do not respect this [30]. The
immediate consequence is that at times we will not observe a AAAA request for
services without AAAA RR and may mis-attribute it to a device that does not
support IPv6.
Annotating ﬂows. We next annotate each ﬂow with the following information:
(i) whether the ISP has delegated an IPv6 preﬁx to the subscriber’s CPE, (ii) the
FQDN associated with the ﬂow, where possible, and (iii) if the subscriber issued
an A and/or a AAAA DNS request. After collecting the trace we extend this
annotation with the following information: (iv) if the subscriber makes use of its
assigned IPv6 preﬁx at all, and with (v) the connectivity options for the FQDN
i.e., whether the service is available over IPv4 and/or IPv6.
4 Dataset
The dataset used throughout this study covers all IP traﬃc generated by
12.9 K DSL subscribers of a residential broadband network during a period of
1 We conducted these additional measurements shortly after the data collection.
8
E. Pujol et al.
Table 1. Total traﬃc
over IPv4/IPv6 and
TCP/UDP.
Table 2. Traﬃc contribution partitioned by the state
of IPv4/IPv6 connectivity of subscribers and service
providers.
Trace #bytes #ﬂows
Service Side Subscriber Side
IPv4-only IPv6-inactive IPv6-active
TCPv4 80.5% 53.1%
TCPv6 10.7% 4.7%
UDPv4 7.4%
18.2%
UDPv6 1.1%
total
64.5T 356.2M
21.7%
IPv4-only
IPv6-ready
IPv6-only
Unknown