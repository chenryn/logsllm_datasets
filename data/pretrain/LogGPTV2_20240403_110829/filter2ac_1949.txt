### Title: Black Hat EU-20: Permission Mining in GCP

Do you have a clear understanding of what each user can do in your Google Cloud Platform (GCP) environment? Are you aware if any users can assume other identities to escalate their privileges? Do you know the effective permissions that users would have if they were to assume these identities? In 2014, CodeSpaces went out of business after an attacker exploited their IAM misconfiguration to delete all of their AWS infrastructure. This incident underscores the critical importance of monitoring and managing IAM risks in public cloud environments.

In this talk, we will explore an effective strategy for assessing the full Identity and Access Management (IAM) exposure in a GCP environment. We will discuss the complexity of this problem with real-world examples and demonstrate how a misconfigured member can escalate privileges through direct service account impersonation or by launching resources. This threat has been present in public cloud providers for years. While GCP and its recommended open-source tools address some IAM misconfiguration use cases, they do not provide complete visibility into the potential for privilege escalation or lateral movement. Our solution fills this gap by providing the necessary visibility.

We will also cover our approach to solving this problem, which involves using a graph-based model. By collecting all relevant information via API calls, we can map out the permissions granted to members, the structure of the GCP environment, and the service accounts. The demo will illustrate how we designed the graph, how we traverse it, and the output it generates.

We have implemented this solution in multiple environments, including production environments, where we identified dozens of 'shadow admin' identities. These identities had the potential to escalate their privileges, gaining administrative control over all resources, permissions, and logging. You will see how the results from our solution were used to remediate these environments.

By the end of the session, you will have a comprehensive understanding of how to assess and mitigate IAM risks in your GCP environment, ensuring better security and compliance.