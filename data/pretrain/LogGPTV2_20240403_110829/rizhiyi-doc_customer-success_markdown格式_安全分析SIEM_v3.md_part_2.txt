    -   反病毒软件
    -   系统漏洞管理：扫描已有漏顶并修复
    -   入侵检测：IDS，检测特定攻击的行为模式，如检测死亡之ping；检测异常行为，检查正常情况下不会有的行为。------误报修复
    -   内容过滤：web url过滤、关键字过滤、垃圾邮件
    -   加密：对称、非对称
对应以上要素，企业 SIEM 建设需要注意几个要点：
**首先，SIEM
流程建设应融入整体工作流程。**只有这样，安全才不是一个孤立的系统。我们的
SIEM 要与工单系统对接，与 OA 对接。这是流程化的内容。
**其次，是要做好用户分权设计。**SIEM
体系建设需要多方协同，有多角色参与的需要，就要有不同角色的权限分配或针对某个事件，对某个角色（可能是外部的第三方人员）临时授权之类的权限管理。这里面一部分是安全事件处置的流程化影响的。
**SIEM
建设需要提高威胁模型准确度。**不是一味的强调开箱即用，应该有人力的不断投入，有一个不断优化的过程。
**SIEM
建设还应着重于可疑威胁的分析。**什么事件是可疑的呢？比如某些安全事件，可能已经被
WAF
过滤掉了，但可能又是另外一个安全事件的分析入口。又比如新创建的账户、账户出现了权限变更，在特定的时间、情境下，都需要引起分析人员的注意。
**再者就是做好事件优先级的判断了。**这就需要安全管理人员结合资产、漏洞的情况进行识别分析，不能仅仅依靠高中低的告警级别进行判断，因为机器是远不如人类智能的，规则是死的，而实际情况是多变的。
SIEM 成功实施与否，始终离不开流程、技术和人这三个要素。
### SIEM建设流程
大多数的SIEM包括以下流程：安全数据采集、安全数据解析处理和标准化、安全数据集中存储、安全数据分析、安全数据呈现等。
**1、安全数据采集**
企业安全建设需要将系统环境划分为多个数字区域，并在网络的各个层次上提供保护，包括网关（防火墙、VPN等网络边界设备）、服务器（企业共享设备）、客户机（员工PC、电脑）等。
日志表示在数字环境中运行的进程的原始输出，是提供实时发生的事情的准确图像的最佳来源，这些安全设备的日志数据是SIEM系统的主要数据源。无论是防火墙日志、服务器日志、数据库日志，还是在实际网络环境中生成的任何其他类型的日志，SIEM系统都能够收集这些数据并将其存储在一个中心位置以进行扩展的保留。此采集过程通常由代理或应用程序执行，部署在监视的系统上，并配置为将数据转发到SIEM系统的中央数据存储。
**2、安全数据解析处理和标准化**
为了能够跨不同源和事件相关性高效地解释数据，SIEM系统能够规范化日志。这个规范化过程包括将日志处理为可读的结构化格式，从日志中提取重要数据，并映射日志中包含的不同字段。
**3、安全数据集中存储**
安全信息数据存储的目地当然是为了利用数据进行管理分析发现安全事件。
**4、安全数据分析**
一旦收集、解析和存储，SIEM系统中的下一步将负责连接这些点并关联来自不同数据源的事件。这种关联工作基于各种SIEM工具提供的规则、为不同的攻击场景预定义的规则，或者由分析人员创建和调整的规则。大多数SIEM系统还提供生成报告的内置机制。这些报告可以用于管理、审计或合规性原因。例如，可以将详细描述触发警报或规则的每日报告嵌入到仪表板中。
**5、安全数据呈现**
可视化数据和事件的能力是SIEM系统中的另一个关键组件，因为它允许分析人员方便地查看数据。包含多个可视化或视图的仪表板有助于识别趋势、异常情况，并监控环境的总体健康或安全状态。一些SIEM工具将附带预先制作的仪表板，而另一些工具将允许用户创建和调整自己的仪表板。
基于目前海量的安全信息数据，大数据架构已经成为主流。并不是说SIEM必须使用大数据架构，因为这是一个应用场景问题而非技术问题。但面对大量数据需要处理的场景时，基于大数据架构的SIEM则必不可少。所以有些厂商提出了SDC（Security
Data
Center）安全大数据中心的概念就是把所有的安全数据集中管理起来，在SDC的基础上构建安全数据分析和展现能力，形成SIEM平台。
下图简单描述了SIEM 的建设过程。
![/var/folders/9r/l6470myd577ftvlvqjx5_60w0000gn/T/com.microsoft.Word/WebArchiveCopyPasteTempFiles/p5103](media/image6.jpeg){width="5.059595363079615in"
height="2.6756944444444444in"}
数据源包括安全设备、网络设备、应用系统、数据库，以及其他的日志类型，采集端一般会接收到数据源转发过来的日志，日志进来之后往往会有一个结构化清洗的流程，会将不同类型的事件进行解析、映射等，处理之后才好去做统计分析。再然后是消息队列，可能是
Kafka
之类的组件，之后结构化后的数据一方面入库，我们也可以基于范式化后的结果进行查询、统计、分析。而分析可能采用的是计算引擎或如日志易的
SPL统计分析语句，最后会把分析结果或查询统计结果给到前端进行调用、展示。
**这其中更为主要的节点是在解析阶段，因为解析的质量直接影响分析及展示的效果。**在实践的时候，我们往往会有两种方式来保障数据解析的质量。
一是与厂商进行沟通，获取到不同安全设备的日志格式解释类文档，这是保障解析质量最为可靠的方式，由此也可以进行一定的日志解析经验积累。二是在有积累或与设备厂商沟通的基础上，确保解析人员能够做到规划化解析，同时解析结果需要输出解析文档，并由甲方安全管理人员在解析阶段就介入，对解析的结果进行校验，以确保解析的质量。
因为在项目初期，相对于乙方，往往甲方安全管理人员才是最为熟悉自身企业环境情况的人，而对企业环境的了解程度，也影响到数据解析时，事件如何分割、字段需要与否等问题的决策，所以这个过程特别需要甲方的介入。
### SOC/SIEM体系建设
SOC/SIEM 体系的建设要基于企业自身的环境现状，大致包括以下流程：
1.  识别内外部环境
2.  资产及其脆弱性识别：漏洞管理、基线管理、新增资产、变更资产
3.  威胁建模及模型优化
4.  安全事件溯源取证
5.  建立安全事件响应机制
6.  SOC/SIEM多角色运营
#### 识别内外部环境
为什么要识别内外部环境呢？
很多人都清楚，如果把企业比作一个城堡的话，攻击与安全体系建设就相当于城堡攻防战争，一方是防守方，一方是攻击方，在安全攻防过程中，双方都要投入一定的成本（如时间成本），假如某个地方出现漏洞，比如攻击者掌握一些
0day（0day指在系统商在知晓并发布相关补丁前就被掌握或者公开的漏洞信息），攻击者如果探测清楚"城堡"结构，知晓何处漏洞可以利用，那么会在防守者发现之前进入城堡（企业内部）。反之，如果防守者通过自查的方式，在攻击者之前发现漏洞所在，及时进行修复，那么就达到封堵预防的效果。某种程度上看，安全攻防就是一场成本博弈，对攻击者而言，安全体系建设好的企业单位攻击成本高（找到防守者所没发现的漏洞的时间长），自然不是攻击者的优先选择，反之亦然。所以对于防守者来说，了解内外部环境，有利于在安全事件发生之前或正在进行的时候，及时进行响应。
识别内外部环境分为两块：
1.  识别区域与外部边界；
2.  识别当前网络上下行链路以及内部基础设施。
识别区域与外部边界可以从业务所在区域和人员所在区域入手。
![](media/image7.png){width="4.330757874015748in"
height="2.2269006999125107in"}
业务所在区域一般以防火墙或 WAF 或
IPS 为防御边界。业务区域一般为攻击方所攻击的重点，大量的信息探测、恶意爬虫、漏洞利用尝试、WebShell
(入侵者通过网站端口对网站服务器的某种程度上操作的权限)上传等手段都会针对此区域的资产展开。
人员所在区域或办公区域一般以终端为防御边界。办公区域一般为钓鱼、社工的对象，主要通过钓鱼邮件来对终端植入恶意程序，并进行扩散，最终以获取IT基础设施的信息或者权限为目的，如域控、邮件服务器等，以期在企业内部找到支点，可以获得进一步进入业务区域的机会。
识别当前网络上下行链路以及内部基础设施自然是从网络上下行链路以及内部基础设施入手。
![/var/folders/9r/l6470myd577ftvlvqjx5_60w0000gn/T/com.microsoft.Word/WebArchiveCopyPasteTempFiles/p5109](media/image8.jpeg){width="5.763888888888889in"
height="3.286111111111111in"}
识别网络上下行链路：需要详细了解流量经过内外部的每一个区域或节点，根据企业的实际情况，可能远远不止上图这些，一般还会有
CDN 等。每个区域或节点我们需要关注的重点也不一样，如 WAF
日志中，真实源地址是否有对应字段可供查询，如
X-Forward-For。网络上下行链路中的设备包括互联网、应用层、网络层、安全设备、系统、终端、堡垒机及运维管理平台等部分。
识别内部基础设施：主要围绕终端用户的一系列行为进行。了解正常行为，可以反向推导异常。这就要求我们对内部防御手段以及基础设施，要有一个清晰了解。根据终端用户常见行为，我们需要在邮件网关、上网行为管理、防病毒、终端安全管理等方面做好相应的监控及防护手段。
#### 依托于高置信度日志进行安全分析
SOC/SIEM体系建设依赖安全数据，安全日志的采集与分析在整个体系建设中占有重要作用。应基于企业自身环境，**接入尽可能多的日志信息，如应用层、网络层、终端层的日志**，丰富
SOC/SIEM 的数据来源，保证分析效果覆盖面足够广、误差足够小。
#### 资产及其脆弱性识别
建设 SOC/SIEM
前，需要清晰了解内部的资产，包括应用、中间件以及数据库等的服务器，对应的网段，存在的服务，Web
区域（或 DMZ
区，或其他与互联网有交互的区域）与内部其他区域的正常通信情况，并将资产、漏洞以及威胁关联起来看。资产、漏洞为非时序数据，如何与威胁事件（时序事件）进行关联分析，是个难点。
识别资产以及脆弱性主要围绕以下四点：
**1、漏洞管理**
在漏洞管理上，需要多种漏洞扫描工具交叉验证。在漏洞修复进度追踪上，需要制定修复计划、控制修复时间、管理漏洞状态（漏洞状态一般可以划分为未修复、已修复或忽略）等。我们应该关注较新的漏洞发现以及修复，并将其与威胁事件关联对比。这里我们需要重点关注某些漏洞，如内核类以及协议类漏洞。
**2、基线管理**
在基线管理时，应关注资产上的不安全配置，如密码管理中的弱口令等；关注应用
Web
后台是否暴露在互联网。而且不仅仅需要针对应用系统（操作系统、中间件以及数据库）进行安全基线检查，还需要对网络设备、安全设备进行安全基线检查和登录监控。
**3、新增资产**
应丰富资产属性，方便资产管理；及时发现新增资产，补充资产盲区。
**4、变更资产**
应及时发现已有资产的变更，将其与威胁、漏洞关联起来，如版本变更可能带来的新安全隐患。
对漏洞以及资产进行关联，可以从威胁、漏洞、资产三方面入手分析。看重点威胁是利用什么漏洞、针对哪些资产进行攻击；看资产存在哪些漏洞，是否与威胁利用的漏洞一致。
关联的关键点在于自动关联分析以及展示高风险事件、多元安全数据过滤高精度告警、对原始数据进行溯源分析上。
#### 威胁建模以及模型持续优化
针对威胁，应该有一个模型对其进行分析，并持续地对模型进行优化，以长久保持规则的适用性。
![/var/folders/9r/l6470myd577ftvlvqjx5_60w0000gn/T/com.microsoft.Word/WebArchiveCopyPasteTempFiles/p5108](media/image9.jpeg){width="5.763888888888889in"
height="3.2104166666666667in"}
**面对已知威胁，主要通过对已有数据进行分析，并从中得到规律。**通过安全设备日志，结合部分原始日志，如结合
Web
访问日志进行分析，根据日志中获取到的相关信息设计威胁模型，这个威胁模型开始可能并不精确，没关系，这个阶段我们可以大胆假设，当然，如能结合内外部环境，模型精准程度就会更高。根据这个模型，我们去配置规则场景，再持续不断优化规则（这里我们需要意识到，规则的持续优化是需要投入一定人力的）。
**面对可疑威胁，我们可以通过原始事件日志（比如流量、终端日志），进行溯源取证分析。**可以将可疑威胁统计分析的结果与已知威胁的监控检测结果进行对比分析，通过异常告警、事件发现异常入口。再按照时间轴顺序，对可疑威胁的上下文进行分析。分析可疑威胁发生前后执行的动作，往往可以帮助我们分析出可疑威胁发生的真正原因。
未知威胁和可疑威胁的分析思路基本相同，也是通过日志进行溯源取证分析。未知威胁是偶然事件，是小概率发生的。那么我们应该怎么**关注未知威胁呢？基于我们对内外部环境的认知度，以及现有的分析结果，有针对性地作出假设并展开防御。**
给大家举几个例子，这些都是实际环境中可能遇到的场景。
一个是同一日志关联分析场景，这个场景可能属于已知威胁。我们的 WAF
发现注入尝试攻击事件，但服务器正常响应。那么我们就可以建立这么一个查询分析，过滤
WAF 日志中出现注入告警且关键字匹配到 sleep
函数类，但关联状态码字段值为"200"（正常响应）的日志，并对这些过滤出的事件日志进行针对性分析，对攻击类型、源地址、目的地址进行分组展示。
再举一个对多源日志关联分析的场景。有时候，同一个源地址触发了不同设备规则库的规则，这个源地址可能执行了一些风险很高的操作，属于可疑威胁，这时我们需要对多源日志进行关联分析。
第三个例子是当服务器出现新实体、新账户或新进程时的检测。这可以通过与以往时间状态的实体或进程相比进行发现。这是应对未知威胁的一个分析思路（同样也是对应白名单检测模式）。
#### 安全事件溯源取证
对于安全事件，如何进一步去做溯源分析呢？下面这张脑图提供了一个概要的思路。针对一个安全事件，我们从源地址进行分析，然后再到目的地址。对目的地址进行分析时，又会根据不同的资产，有不同的分析策略。如果是外部资产，则去排查内网源地址攻击情况，如果是内部资产，则去执行其他的动作。这里有个需要注意的地方，根据这个地址是首次攻击还是历史出现，会有一个攻击者画像的概念，根据攻击者的攻击记录，我们会对他采取相应的防御手段，比如封禁
IP。
![](media/image10.png){width="5.763888888888889in"
height="4.674305555555556in"}
根据源地址、目的地址对安全事件进行分析，如果有用户名称的话，还会结合用户名称，看用户的活动痕迹，结合安全事件的发生区域，最终要达成的一个目的，就是鉴定此次攻击的攻击结果。
#### 建立安全事件响应机制