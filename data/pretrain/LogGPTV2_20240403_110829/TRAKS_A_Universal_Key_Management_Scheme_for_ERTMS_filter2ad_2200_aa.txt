# TRAKS: A Universal Key Management Scheme for ERTMS

**Authors:**
- Richard J. Thomas, University of Birmingham, Birmingham, UK
- Mihai Ordean, University of Birmingham, Birmingham, UK
- Tom Chothia, University of Birmingham, Birmingham, UK
- Joeri de Ruiter, Radboud University, Nijmegen, NL

## Abstract
This paper introduces a new Key Management and Distribution Scheme (TRAKS) for the European Rail Traffic Management System (ERTMS). The aim is to simplify key management and enhance cross-border operations through hierarchical partitioning. The current scheme in ERTMS involves the creation and distribution of 3DES keys to train and trackside entities, which are used as part of the EuroRadio Protocol for message authentication. This results in the distribution of tens of thousands of keys using portable media, placing a significant burden on management and resources. TRAKS, a symmetric key solution, is backward-compatible with the current ERTMS standard and is post-quantum secure. It reduces the number of cryptographic keys in circulation while maintaining the current security model. TRAKS dynamically derives unique keys from a shared secret, such as the line secret, combined with IDs of trains and signaling equipment. Additionally, it adds authentication to the location data provided by EuroBalises.

## CCS Concepts
- **Security and Privacy:** Key management, Hash functions and message authentication codes, Authorization, Mobile and wireless security

## 1. Introduction
In any Industrial Control System (ICS) with safety-critical functionality, it is essential to authenticate messages to ensure they originate from authorized entities and to detect malicious modifications.

The European Rail Traffic Management System (ERTMS) is a safety-critical ICS that provides a suite of protocols for modern train management and signaling. Designed to enable interoperability across borders and optimize railway operations, ERTMS is being rolled out across Europe and on high-speed lines worldwide. ERTMS consists of three layers: GSM-R, EuroRadio, and the Application Layer Protocol. The EuroRadio and Application Layer Protocol form the European Train Control System (ETCS).

GSM-R, a rail-specific variant of the GSM protocol, facilitates communication between trains and trackside infrastructure, such as Radio Block Centers (RBCs). RBCs manage train movements within a geographical area, issuing movement authorities that permit trains to move at specified speeds. Trains periodically provide location updates, and RBCs respond with updated movement authorities. The EuroRadio protocol layer ensures authentication and integrity using cryptographic MACs, and the Application Layer Protocol defines the ERTMS message standard and implements checks to prevent message replays.

EuroBalises, devices placed between tracks, provide accurate location and track profile data to passing trains. Currently, this data is validated using a publicly known CRC code, which only detects errors but does not provide integrity protection.

The current ERTMS standard requires key provisioning and management based on geographical domains, each with a Key Management Centre (KMC) responsible for key generation and management. Keys are generated by KMCs following vendor requests and sent via portable media devices, increasing the risk of compromise and making deployment and management difficult. In practice, insecure strategies like provisioning all (OBU, RBC) key pairs or extending key lifetimes are used. Cross-border operations are challenging, as keys must be shared between different KMCs, requiring additional effort and physical travel.

ICS environments have long lifespans, necessitating solutions that consider post-quantum security. While efforts by NIST and ETSI aim to standardize post-quantum cryptography, these standards may not be ready before the intended start of ERTMS national deployment.

In this paper, we formally define the security of the ERTMS key generation and propose TRAKS, a new key management scheme. TRAKS introduces line secrets to enforce an operational permissions model, combining train and RBC IDs to produce session keys for message MACs. Our solution is backward-compatible, allowing progressive implementation into the standard.

### 1.1 Contributions
This paper proposes TRAKS, a key management scheme for ERTMS, aimed at reducing management overhead and maintaining flexibility and security. Our contributions include:
1. **Unified ERTMS Key Management and Distribution Protocol:** TRAKS generates message authentication keys for communications between OBUs and RBCs, and for OBU and balise communications.
2. **Reduced Deployment Overhead:** TRAKS supports dynamic key generation using pseudo-random functions (PRFs) and a shared secret, eliminating the need for physical access to RBCs after deployment.
3. **Backward Compatibility and Post-Quantum Security:** TRAKS uses symmetric key cryptography, making it backward-compatible with the current ERTMS scheme. It also employs post-quantum secure PRFs to derive keys.
4. **Security Analysis:** We provide the first security definition for the ERTMS key generation protocol and prove that TRAKS is at least as secure as the current scheme while offering additional benefits in key management.

We discuss issues with the existing ERTMS scheme and related work in Section 2. Section 3 provides a high-level overview of the current offline ERTMS scheme and TRAKS. Section 4 presents a generic formalism of the offline ERTMS scheme, followed by our scheme, TRAKS, in Section 5. A security analysis is provided in Section 6. Sections 7 and 8 discuss the key management lifecycle and distribution. Section 9 presents example applications of TRAKS, including its use with EuroBalises, and we conclude in Section 10.

## 2. Background and Related Work
Current ERTMS Key Management is defined by two standards: an offline scheme and a proposed online scheme. Past work, such as [7, 8], has assessed the protection of critical infrastructure and introduced a proposed ERTMS key management hierarchy, advocating symmetric key solutions over public key solutions. P´epin and Vigliotti [12] analyzed ERTMS Key Management from a cryptographic perspective, identifying potential failures when 3DES becomes vulnerable but not providing specific recommendations beyond changing cryptographic algorithms.

Since the development of the offline scheme and the introduction of ETCS Level 3 baselines, an online solution has been proposed [20]. This involves introducing a PKI where certificates and keys are issued to trains and RBCs, enabling communication with the Key Management Centre. However, this relies on the assumption that GSM-R bandwidths can support these communications and the upgrade to GPRS, which is not currently rated for use in ERTMS. The move to an online scheme would be disruptive, and managing a large-scale PKI for cross-border operations would be burdensome, especially given the limited bandwidth of GSM-R and the long lifespan of ERTMS.

Other key management solutions, such as Biswas' proposal [2] and the Advanced Access Control System (AACS) [10], are not directly applicable to ERTMS due to their static group settings and focus on decryption rather than payload authentication. Diﬃe-Hellman-based schemes are also not post-quantum secure [11, 15].

Several proposals by National Infrastructure Managers aim to improve ERTMS key management, addressing issues such as key distribution and suitability [1, 3, 13]. For example, ProRail and ÖBB do not issue keys equally, with ProRail tendering a more centralized approach.