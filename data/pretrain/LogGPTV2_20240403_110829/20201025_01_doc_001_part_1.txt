# PostgreSQL开发者TOP 18问

## 个人简介
- **姓名**: 德哥
- **别名**: 德哥
- **所属社区**: PostgreSQL社区
- **社区职务**: 校长
- **正式职务**: 阿里云数据库产品经理
- **专长**: PostgreSQL
- **愿景**: 没有PG解决不了的问题，如果有，就多买几台
- **格言**: 公益是一辈子的事
- **业余爱好**: 写博客、撰写专利赚钱、乐于分享知识
- **GitHub**: [digoal](https://github.com/digoal)

## PG 13 发布庆祝
PostgreSQL 13已于2020年9月24日正式发布。以下为一些关于新版本的讨论：
- **PG 13 的优势**：[链接](https://github.com/digoal/blog/blob/master/202009/20200926_01.md)
- **PG 13 的贴心之处**
- **PG 13 的复杂性**
- **PG 13 的开放性**

全球社区通过协作和奉献展示了PostgreSQL在创新、可靠性和稳定性方面的卓越表现。每个发行版都带来了新的特性和改进，这也是越来越多企业选择使用PostgreSQL的原因。

## 目录
### 开发者 PG TOP 18 问
- **代表性问题**：这些问题是否具有代表性？
- **问题来源**：全球最大的共享出行服务商HelloBike
- **回答权威性**：由校长亲自解答

#### 问题一：PG 是否可以使用hint指定走某个索引？
- **提问原因**：优化器未选择合适的索引
- **可能原因**：统计信息不准确、算子参数错误等
- **解决方案**：使用 `pg_hint_plan` 插件

#### 问题二：针对分表新增字段，是否需要对每个分表进行编辑？
- **提问原因**：简化操作
- **答案**：不需要，直接操作主表即可（注意DDL排他锁）

#### 问题三：PG 在保持性能的前提下，最多能存储多少条数据？
- **提问原因**：了解性能极限
- **答案**：根据硬件配置不同而变化，例如52C 384GB 16TB SSD下，TPCB可达100亿行，读取QPS约100万，写入QPS约50万

#### 问题四：建议在多少条记录时进行分库或分表？
- **提问原因**：避免性能瓶颈
- **答案**：依据具体场景，如更新频繁的表可考虑16GB或1亿/分区；更新较少的表则可设为64GB/分区

#### 问题五：删除记录后水位线是否会下降？
- **提问原因**：理解空间回收机制
- **答案**：索引不会降低水位线，HEAP表中连续空页可被回收，其他情况需使用 `VACUUM FULL` 或 `pg_repack`

#### 问题六：一般TPS/QPS能达到多少？
- **提问原因**：评估系统性能
- **答案**：取决于硬件配置及应用场景，例如在高端服务器上TPCB可达100亿行，读取QPS约100万，写入QPS约50万

#### 问题七：统计信息收集规则是什么？
- **提问原因**：确保SQL执行计划准确性
- **答案**：基于 `autovacuum_analyze_scale_factor` 和 `autovacuum_analyze_threshold` 参数自动触发

#### 问题八：PG 支持JSON/JSONB吗？
- **提问原因**：敏捷开发需求
- **答案**：支持，并且功能强大，符合SQL/JSON标准

#### 问题九：除了B-tree还有哪些索引类型？能否建立B-tree-GIST联合索引？
- **提问原因**：优化查询性能
- **答案**：支持多种索引类型，包括但不限于GIST、GIN等。可以创建B-tree-GIST联合索引，使用 `CREATE EXTENSION btree_gist;`

#### 问题十：遇到“canceling statement due to conflict with recovery”怎么办？
- **提问原因**：只读实例中SQL语句被意外终止
- **答案**：调整从节点重放等待时间及主节点延迟回收设置，同时注意其他潜在冲突如表空间删除、锁冲突等

以上内容旨在帮助开发者更好地理解和应用PostgreSQL，更多详细信息请参阅相关文档或联系社区成员获取进一步支持。