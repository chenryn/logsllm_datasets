a
r
e
t
a
L
n
o
i
t
c
e
l
l
o
C
s
s
e
c
c
A
l
a
i
t
i
n
I
e
c
n
e
t
s
i
s
r
e
P
n
o
i
t
u
c
e
x
E
l
o
r
t
n
o
C
d
n
a
d
n
a
m
m
o
C
Description
Sends an email containing an infected executable file
Attack name
infect_email_exe
infect_flashdrive_exe Mounts a drive and runs an infected exe file
c2_change_wallpaper
c2_download_malware
c2_exfiltration
c2_mimikatz
c2_take_screenshot
misc_download_malware Downloads malware from a web server
misc_execute_malware
misc_exfiltration
misc_set_autostart
misc_sqlmap
Changes the wallpaper on the target host
Downloads malware through Meterpreter
Finds and sends documents over the C&C channel
Obtains cached credentials using mimikatz
Takes a screenshot and downloads it
Executes a malicious binary
Copies files to a removable drive
Sets an autostart in the Windows registry
Performs an SQL injection attack to steal credentials
n
o
i
t
a
r
t
l
fi
x
E
t
c
a
p
m
I
704ACSAC ’21, December 6–10, 2021, Virtual Event, USA
Rafael Uetz, Christian Hemminghaus, Louis Hackländer, Philipp Schlipper, and Martin Henze
Table 5: Alerts per rule for our exemplary scenarios (default and best-practice logging configuration). The two lines per rule
show the results (sample mean and SD, n = 10) for the two hosts on which the experiment was performed, respectively (second
host with gray background, differences in boldface).
Number of alerts
Rule name
Autorun Keys Modification
Direct Autorun Keys Modification
a
m
g
i
S
Meterpreter or Cobalt Strike Getsystem Service Start
Non Interactive PowerShell
Windows PowerShell Web Request
ET INFO EXE IsDebuggerPresent (Used in Malware Anti-Debugging)
ET INFO Executable Download from dotted-quad Host
ET INFO Executable Retrieved With Minimal HTTP Headers - Potential Second Stage Download
ET INFO SUSPICIOUS Dotted Quad Host MZ Response
ET INFO SUSPICIOUS SMTP EXE - EXE SMTP Attachment
ET POLICY PE EXE or DLL Windows file download HTTP
ET SCAN Sqlmap SQL Injection Scan
ET TROJAN Possible Metasploit Payload Common Construct Bind_API (from server)
ET WEB_SERVER ATTACKER SQLi - SELECT and Schema Columns
a
t
a
c
i
r
u
S
ET WEB_SERVER Attempt To Access MSSQL xp_cmdshell Stored Procedure Via URI
ET WEB_SERVER MYSQL Benchmark Command in URI to Consume Server Resources
ET WEB_SERVER MYSQL SELECT CONCAT SQL Injection Attempt
ET WEB_SERVER Possible attempt to enumerate MS SQL Server version
ET WEB_SERVER Possible Attempt to Get SQL Server Version in URI using SELECT VERSION
ET WEB_SERVER Possible MySQL SQLi Attempt Information Schema Access
ET WEB_SERVER Possible SQL Injection Attempt SELECT FROM
ET WEB_SERVER Possible SQL Injection Attempt UNION SELECT
ET WEB_SERVER Script tag in URI Possible Cross Site Scripting Attempt
ET WEB_SERVER SQL Errors in HTTP 200 Response (error in your SQL syntax)
ET WEB_SERVER SQL Injection Select Sleep Time Delay
¯xd
0
0
0
0
0
0
0
0
0
0
1
1
1
1
1
1
2
2
2
2
2
2
2
2
1.7
1.9
6.4
6.6
1
1
2
2
22
22
2
2
6
6
4
4
16
16
19
19
1
1
36
36
7
7
sd
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0.483
0.316
0.699
0.699
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
¯xb
1
1
1
1
1
1
1
1
3
3
1
1
1
1
1
1
2
2
2
2
2
2
2
2
1.7
1.9
6.1
6.4
1
1
2
2
22
22
2
2
6
6
4
4
16
16
19
19
1
1
36
36
7
7
sb
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0.483
0.316
1.595
0.516
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
705