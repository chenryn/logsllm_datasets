title:Hidden Treasures - Recycling Large-Scale Internet Measurements to
Study the Internet's Control Plane
author:Jan R&quot;uth and
Torsten Zimmermann and
Oliver Hohlfeld
Hidden Treasures – Recycling Large-Scale
Internet Measurements to Study
the Internet’s Control Plane
Jan R¨uth(B)
, Torsten Zimmermann, and Oliver Hohlfeld
RWTH Aachen University, Aachen, Germany
{rueth,zimmermann,hohlfeld}@comsys.rwth-aachen.de
https://icmp.netray.io
Abstract. Internet-wide scans are a common active measurement app-
roach to study the Internet, e.g., studying security properties or protocol
adoption. They involve probing large address ranges (IPv4 or parts of
IPv6) for speciﬁc ports or protocols. Besides their primary use for prob-
ing (e.g., studying protocol adoption), we show that—at the same time—
they provide valuable insights into the Internet control plane informed
by ICMP responses to these probes—a currently unexplored secondary
use. We collect one week of ICMP responses (637.50M messages) to sev-
eral Internet-wide ZMap scans covering multiple TCP and UDP ports
as well as DNS-based scans covering >50% of the domain name space.
This perspective enables us to study the Internet’s control plane as a
by-product of Internet measurements. We receive ICMP messages from
∼171M diﬀerent IPs in roughly 53K diﬀerent autonomous systems. Addi-
tionally, we uncover multiple control plane problems, e.g., we detect a
plethora of outdated and misconﬁgured routers and uncover the presence
of large-scale persistent routing loops in IPv4.
1 Introduction
Internet scans are a valuable and thus widely used approach to understand and
track the evolution of the Internet as one of the most complex systems ever
created by humans. They are widely applied in diﬀerent ﬁelds, including net-
working and security research: e.g., to ﬁnd vulnerable systems [9], to measure
the liveness of IP addresses [3], or to measure the deployability of new proto-
cols, features [11], or their evolution [33]. Advances in scanning methodologies
enabled probing the entire IPv4 address space for a single port within minutes or
hours, depending on the available bandwidth and conﬁgured scan rate (see tools
such as ZMap [10] or MASSCAN [18]). Thereby, regular scans of the entire IPv4
address space have become feasible, e.g., providing an insightful perspective into
protocol evolution (see e.g., QUIC [31]). This line of scan-based works has cre-
ated a rich body of contributions with valuable insights into Internet structure
and evolution. These works have in common that they focus on one particular
feature or protocol as their objective to study (primary use).
c(cid:2) Springer Nature Switzerland AG 2019
D. Choﬀnes and M. Barcellos (Eds.): PAM 2019, LNCS 11419, pp. 51–67, 2019.
https://doi.org/10.1007/978-3-030-15986-3_4
52
J. R¨uth et al.
Table 1. Weekly scan schedule fueling our dataset, DNS-based scans use our own
resolver infrastructure. For IPv4-wide scans, we utilize ZMap.
Mon
Tue
Wed
Thu
DNS
Fri
Sat
Sun
Source
Protocols &
Ports
Source
Alexa
1% IPv4
Protocols &
Ports
TCP/80,
TCP/443
TCP/80,
TCP/443
TCP/443, gQUIC/443
IPv4
TCP/80
iQUIC/443 gQUIC/443 TCP/443
In this work, we argue that Internet-wide scans have a less explored secondary
use to study the Internet control plane while scanning for their primary use,
e.g., to detect routing loops while primarily probing for QUIC-capable servers.
That is, we study Internet control plane responses sent via ICMP as response
to non-ICMP probe packets (e.g., QUIC) and show that Internet-wide scans are
a hidden treasure in that they produce a rich ICMP dataset that is currently
neglected, e.g., to uncover network problems. The interesting aspect is that these
ICMP-responses are a valuable secondary use that is generated as by-product
of any Internet-wide scan. They thus enable to study the Internet control plane
(e.g., to detect routing loops) without requiring dedicated scans (as performed
a decade ago [20,36]) that would increase the scanning footprint.
Our observations on the Internet’s control plane are fueled by regular ZMap
scans of the IPv4 address space for multiple TCP and UDP ports as well as
DNS-based scans of top lists and zone ﬁles for mainly TLS, HTTP/2, and QUIC.
We evaluate one full week of ICMP responses to multi-protocol Internet-scans
covering the entire IPv4 address space and >50% of the domain name space(base
domains).
Our contributions are as follows:
– We propose to use Internet-wide scans to study the Internet control plane via
– Within our one week observation period, we collect ∼637.50M ICMP messages
ICMP response, e.g., to detect routing loops or misconﬁgurations.
which we make available at [22].
– We shed light on how Internet-scans trigger ICMP responses across the Inter-
net.
– Our data shows a plethora of misconﬁgured systems e.g., sending ICMP redi-
rects across the Internet or producing deprecated source quench messages.
– We ﬁnd many networks and hosts to be unreachable, our scans uncover large
sets of unreachable address space due to routing loops.
– We provide a growing ICMP dataset at https://icmp.netray.io.
Hidden Treasures – Recycling Large-Scale Internet Measurements
53
Structure. The next section (Sect. 2) starts by providing an overview of our
ICMP dataset. Following this, we dive into our dataset and dissect it (Sect. 3).
Driven by our ﬁndings, we inspect unreachable hosts due to routing loops and
quantiﬁes their presence in today’s Internet (Sect. 4). Finally, we discuss related
works (Sect. 5) and conclude the paper (Sect. 6).
2 Scan Infrastructure and Dataset
Infrastructure. Our scans are sourced by two diﬀerent modes, on the one hand,
we use the ZMap [10] port scanner on multiple machines to perform diﬀerent
scans over the course of a week, and on the other hand, we continuously probe
>50% of the DNS space. Table 1 summarized our weekly scan schedule, we did
not speciﬁcally create these scans and this schedule for this paper, it is the result
of ongoing research eﬀorts.
These scans typically involve scanning TCP/80 for TCP initial window con-
ﬁgurations [30] or TCP fast open support. Further, we investigate TCP/443 for
HTTP/2-support [37] and TLS, additionally, we scan on UDP 443 for Google
QUIC (gQUIC) [31] and IETF-QUIC (iQUIC). Our DNS-based scans are fueled
by using our own resolvers to resolve various record types for domains listed in
zone ﬁles of multiple TLDs (e.g., .com, .net, .org), which can be obtained from
the registries, and we use A-records to investigate TLS, HTTP/2, and gQUIC.
All of our scans including the DNS resolutions originate from a dedicated sub-
net. To collect all ICMP traﬃc that is directed towards these hosts, we install a
mirror port at their uplink switch and ﬁlter it to only contain ICMP traﬃc that
belongs to our measurement network. Since we perform no measurements that
generate ICMP messages themselves, we exclude those sent from our host (only
ping responses) leaving us with only incoming ICMP traﬃc.
Dataset. We base our observations on one full week in September 2018. In this
week we received 169 GB resp. ∼637.50M ICMPv41 messages (excluding those
explicitly triggered in Sect. 4). ICMP messages follow the structure shown in
Fig. 1, they are fundamentally made up of a type ﬁeld and, to further specify a
subtype, a code ﬁeld, and depending on their value additional information may
follow.
0
1
2
3
4
Type
5
6
7
8
9
10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31
Code
Type/Code speciﬁc ﬁelds
Checksum
Fig. 1. ICMP header structure. Type and this type’s sub type (code) determine mes-
sage contents, e.g., often packets triggering the ICMP message are quoted.
1 Please note that we do not have a fully IPv6-capable measurement infrastructure
and thus focus on IPv4 only.
54
J. R¨uth et al.
Table 2. ICMP types with their occurrence frequency in our dataset. Ordered by
frequency.
Type
Count Uniq. IP Uniq. AS
Type
Count Uniq. IP Uniq. AS
Dest. Unreach. 476.68M 170.30M 52.92K
TimeExceeded 139.53M 455.13K 18.40K
2.29K
Redirect
861
EchoRequest
SourceQuench
364
18.12M 243.25K
3.12M 10.64K
46.18K
2.65K
EchoReply
Other
TimestampReq.
Param.Problem
Addr.MaskReq.
6.08K
1.48K
73
20
4
301
606
9
16
1
58
43
6
9
1
3 Study of ICMP Responses
To begin our investigations, we ﬁrst summarize the ICMP responses to our scans
by looking at the distribution of ICMP message types and their frequency of
occurrence in Table 2. We observe 75 diﬀerent ICMP type/code combinations
during our observation period with signiﬁcantly diﬀerent occurrence frequencies.
While we mostly receive standardized ICMP messages, we also receive some
messages for which we could not ﬁnd a standard, summarized as Other in Table 2,
on which we do not further focus in this paper. The table lists the total count
of these messages as well as the number of unique source IPs (router/end-host
IPs) that generated the messages and number of ASes they are contained in.
Over the course of the week, we run diﬀerent scans. Notably, on Sundays and
Mondays (see Table 1), no IPv4-wide ZMap scans are performed.
Fig. 2. Number of ICMP messages receiver per hour and type over the course of a
week. Note the log scale and that we used a rolling sum over 1 h.
Figure 2 thus puts the data from Table 2 into a temporal context showing
the rolling sum over 1 h intervals of the major ICMP types. We observe that the
ICMP traﬃc varies over the course of the week, e.g., echo requests are rather
static, other types like destination unreachable mainly follow our ZMap scan
schedule.
Hidden Treasures – Recycling Large-Scale Internet Measurements
55
Quoted IP Packet. Apart from the diﬀerent ICMP types, many ICMP mes-
sages contain parts of the packet that caused the creation of the messages. We
further inspect these quoted IPv4 packets within the ICMP messages. From all
received ICMP messages, 99.5% are supposed to contain IP packets (according
to the RFCs), of these only 0.07% cannot be decoded, e.g., because there is
simply not enough data or these are no IPv4 packets. Of the decodable packets,
we ﬁnd 180.25M unique source IP/payload length combinations, 76% are longer
than 40 bytes, i.e., enough to inspect IP and TCP headers when no options
are used2, 24% are exactly 28 byte long, so just enough to inspect the trans-
port ports. Thus, when no options are used, the chances are high that ICMP
messages received by an ICMP receiver can be demultiplexed to the respective
application process. This extends the ﬁnding in [26] that showed a prevalence
of 28 byte responses for TCP traceroutes. Next, we focus on the destination
address ﬁeld within the quoted IP header. These should correspond to addresses
which are targeted by our scanners. Interestingly, from all ICMP messages, we
ﬁnd over 1.06M messages with destination IPs that are in reserved address space,
i.e., unallocated or private addresses (e.g., 192.168.0.0/24). Since all our scanners
explicitly blacklist these IP addresses, we believe that these messages are pro-
duced behind network address translations (NATs). We next use the contained
source addresses to understand the relation to our measurements.
Fig. 3. ICMP messages triggered by ZMap and DNS-based scans.
Takeaway. ICMP traﬃc shows a temporal correlation to measurement traﬃc,
most messages indicate unreachability. In our collected dataset, quoted IP packets
typically contain enough information to inspect everything up to the end of the
TCP header. Further, a substantial number of messages seems to be generated
behind NATs allowing to peek into private address spaces.
3.1 Responses to Individual Measurements
Since we perform a variety of diﬀerent measurements independent of this study,
our ﬁrst investigation is how diﬀerent measurements aﬀect the generation of
2 To reduce the capture size, our packet capture caps packets at 98 byte allowing no
further investigation, we ﬁnd 67% having the maximum capture size.
56
J. R¨uth et al.
ICMP traﬃc. To this end, we compare two ZMap scans and a purely DNS-based
scan. For the ZMap scans, we focus on one that enumerates reachable TCP
port 80 (HTTP) and UDP port 443 (QUIC) hosts, for DNS, we use a scan that
probes for HTTP/2 support via TCP port 443. We are able to clearly tie the
ICMP messages to the diﬀerent scans via IPs and ports either from the quoted
IP message or from IP itself.
Figure 3 shows the distribution of ICMP types and codes (top 8) that we
receive for the respective scans. As already indicated by Table 2, we receive a
large amount of destination unreachable messages. However, depending on the
scan, their amount and share greatly vary, especially when looking at the respec-