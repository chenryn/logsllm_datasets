用这个功能就可以了（并且知道怎么处理它所收集的最终数据）。
接下来是什么？过去生活在自己世界中的Web应用程序和大型企业
应用程序框架。但是，人们最终开始认识到这些来源的数据对内部
攻击、内部数据盗窃和其他受信任的访问滥用提供了独特的洞察
力。预计会有越来越多的这类日志加入到日志管理解决方案。桌面
日志分析也不会是太遥远的事情。
2448
---
## Page 2450
在更遥远的未来，各种深奥的日志来源将会继续被添加进来。自定
义的应用程序、物理传感器和其他许多不常见的设备和软件被“监
听”！
因此，我们观察到人们一般会首先注意防火墙日志，然后是服务器
日志，然后是其他电子邮件和Web日志，然后是数据库日志（这是
最近才出现的），最终才是其他应用程序日志甚至是非IT的日志来
源。
13.6.2未来的日志分析和管理工具
在本章最后时，让我们想象未来理想的日志管理和分析应用程序，
它们将帮助解决前面所描述的各种困难，满足我们所提出的各种需
要。
理想的日志管理工具将具有下面这些功能：
日志配置
应用程序将会设法寻找所有可能的日志来源（系统、设备、应用程
序等），然后对它们启用正确类型的日志，遵循一个向它所提供的
高级策略。就目前而言，这要求这个工具拥有“上帝的能量”，远远
超出了当前产品的能力。
日志收集
应用程序将收集它通过安全的方式找到的所有日志（而不需要使用
任何具有风险的超级用户访问权限），并且对网络和系统的影响要
非常小。就目前而言，这是不可能的。
日志标准
日志管理工具将能够使用我希望在未来采纳的日志标准。当今在日
志标准化方面所付出的越来越多的努力（例如MITRE的公共事件表
达式CEE）首先将导致日志标准的创建，最终导致它们被采纳。这
可能需要几年的时间，但是对将会混乱不堪的日志世界实现部分的
有序。
日志存储
2449
---
## Page 2451
只要有需要，并且允许同时通过原始格式和抽象的、丰富的格式访
问日志，应用程序就可以安全地按照最初的格式存储日志。这在当
前是不可能的，除非舍得在存储硬件上花大本钱。
日志分析
理想的应用程序将能够观察所有类型的日志，即使是以前未知的日
志、来自标准来源和自定义日志来源的日志，并告诉用户根据他的
需要应该知道他的环境中的哪些内容。什么被破坏了？什么遭到了
黑客？在哪里？对规章制度或政策有什么违反？什么将会很快遭到
破坏？谁在干这种事情？这种分析将会促进自动化的操作、实时的
通知、长期的历史分析和顺应性相关的分析（稍后讨论）。未来类
似人工智能系统的开发可能会把这个愿望变为现实。
信息表现
日志管理工具将会过滤数据、信息以及由分析组件所生成的结论，
并用一种与用户的角色一致的方式表现它们，不管用户的角色是操
作员、分析师、工程师还是执行官。高级的、交互式可视化的、基
于文本的并且带有向下挖掘功能的数据表现形式将可应用于所有的
日志来源。未来的日志可视化工具不仅可以表现“漂亮”的图画，而
且适合它们的用户的任务，不论是操作员还是管理人员。用户也可
以根据他们的愿望以及需要完成的任务对数据表现形式进行自定
义，包括信息感知风格。这可能需要许多深入理解日志执著的用户
接口设计人员的共同努力。
自动化
日志管理工具将能够采取有限的自动化操作，解决已发现和已证实
的问题，并且为用户提出指导意见，使他们知道如果不适合全自动
模式时应该采取什么行动。它所产生的响应包括全自动操作、协助
操作（“点此修正问题”）、显示详细的修正指南。它的输出将包括
一个按优先级排列的已发现条项的“怎么做"列表以及相关的建议操
作。这个愿望的实现还非常的遥远。
顺应性
审核者还可以直接使用日志管理工具，使用规章制度特定的内容以
及所有收集的数据，验证或证明与相关规章制度的顺应性。日志管
理工具还可以发现数据收集与用户需要遵循的特定规章制度之间的
2450
---
## Page 2452
落差。同样，这个功能需要“上帝的能量”，而且可能永远不会开发
出来（但我们肯定可以尝试）。
2451
---
## Page 2453
13.7小结
正如我在本章中所证明的那样，日志对于完成调查以及更好地遵循
规章制度非常实用。尽管存在我所描述的困难，但日志处理确实是
“美丽的”。至少，它可以为发现隐藏在事故背后的真相这个美丽目
标提供服务。
首先，如果我们展望未来的日志世界，我们将会看到更多的日志：
更大的容量、更多的日志来源和更丰富的样式。其次，我们将看到
对日志信息的更多需求以及对这类数据的更多应用。再次，我们希
望看到更好的工具来处理日志。最后，今天的日志标准化努力将会
奏效并使日志世界变得更好。尽管这对于许多人而言只是梦想，但
本章的作者却在努力使它变为现实。
但是在与日志有关的难题“改善”之前，接下来几年情况很可能会“恶
化”。观察缓慢出现的日志标准化行动和快速增长的新日志类型（例
如各种应用程序所记录的消息日志）和新日志用户这两种趋势之间
的竞争是非常有趣的。开发像CEE这样的可信任的实用日志标准将
需要几年的时间，并且需要很多人的努力。标准的采纳也是一个很
大的困难，因为存在太多的遗留日志系统。
另一方面，对规章制度的遵循要求以及事故调查需要将会驱动当今
不断增长的跨平台和跨应用程序的日志。在安全社区向开发人员提
供有效地安全实用地增加日志功能的方法意见前，开发人员就被要
求“添加日志”。我相信日志在未来将会更加统一，但我不能断定这
个愿望什么时候才会变成现实。
第14章事件检测：寻找剩余的
68%
2003年1月25日，星期六午夜时分，Intermet上发生了灾难性的事件，
席卷全球各大数据中心、公司和家庭的数十万台计算机遭到了密集
的攻击。螨虫利用MicrosoftSQLServer的一个已知漏洞发动攻击，
而这个漏洞最早是在六个月前也就是2002年7月24日被报道的。
2452
---
## Page 2454
根据我们在Symantec对那个安静的晚上的观察，我们的安全操作中
心的分析师们像平常一样工作着，对来自全球范围的数以百计的顾
客所报告的安全事件进行分析，寻找网络攻击的迹象。但是，平静
的水面上突然掀起了风暴，在数分钟之内，我们的分析师们就接到
了数以万计的警报。按照分析师的观点，被监控的入侵检测系统同
时警告我们出现了“SQL缓冲区溢出”，同时被监控的防火墙也检测到
发生在1434/udp端口的密集流量。对于那些允许1434/udp端口穿越它
们的防火墙的机构而言，它们的内部基础设施在短短数小时之内就
被端虫所攻克，在端虫不断扩散的同时导致了拒绝服务攻击。对于
那些阻塞了1434/udp端口的公司而言，当星期一早晨来临时，当许
多在笔记本电脑上安装了MSSQL的用户把他们的计算机接入公司网
络时，他们不知不觉地帮助螨虫穿越了公司的外围防御，直接向内
部发动攻击。
这就是我们对SQLSlammer的观察，这是Internet上的一次范围极广的
通过MicrosoftSQL的一个已知漏洞所发动的攻击，几乎使Internet临
时瘫痪。
我们在Symantec的托管安全服务（ManagedSecurityServices）部已
经有了10年的工作经验，遇到过大量的安全事件。虽然Slammer对IT
基础设施的打击是极为致命的，但它却非常容易被检测。它所利用
的漏洞是已知的，因此攻击很快得到确认，端虫的侵略性扩散方式
保证了每个安全监控装置都会被触发。
虽然Slammer很容易被检测，但是当前许多网络攻击的手法会变得越
来越狡。攻击的目的已经从入侵系统使自己名扬天下变成了通过
网络犯罪搜取经济收益，其中隐蔽性和匿名性成了最重要的特征，
随着攻击意图的复杂性和后果的严重性不断增加，攻击者使用了更
微妙的越来越难以检测的攻击方式，在攻击结束时最多只有日志文
件中留下不起眼的痕迹，并且伪装成正常的流量。
毫无疑问，对于保护他们的信息资产免受网络攻击的安全从业人员
而言，他们所面临的挑战从来没有如此巨大。我们的看法是，许多
安全从业人员并没有意识到他们所操作的事件检测程序最多只能发
现在他们的网络中所发生的32%口的事件。本章探讨了传统事件检
测所存在的一些局限以及它们对安全监测程序的效果的不利影响，
并讨论了一些用于创建富有弹性的事件检测模型的技术和技巧的应
用，从而发现其余的68%。
2453
---
## Page 2455
14.1一个常见起点
AntonChuvakin所著的《BeautifulLogHandling》一书的第13章描述了
与日志管理相关的挑战以及在调查、调整和管理中使用日志的重要
性。在本章中，我们将专注于如何最大限度地对日志进行挖掘，以
帮助事件的检测。大多数安全从业人员通过分析专门用于检测的技
术所产生的日志来检测网络攻击。这些技术称为入侵检测系统或入
侵预防系统，从现在开始我们称之为入侵检测和预防（IDP）系统。
这些技术把网络活动与提示出现了攻击尝试或其他未授权活动的模
式进行比较。通过这种做法，IDP帮助安全从业人员把数以TB计的
潜在问题缩小为少量的真正出现的安全事件。这看上去很简单，那
么难度又在什么地方呢？现在，让我们观察一些证明IDP所存在的内
在限制的例子。
在SQLSlammer事件期间，这个端虫露面仅仅几个小时之后就出现了
专门针对它的签名[2]。这个签名非常有效地触发了对那些具有该蠕
虫扩散的独特字节模式的数据包的警告，因此对于被感染的主机的
检测具有很高的可信度。这个消息听上去令人鼓舞，但是在Slammer
的高峰时，大多数公司检测到数以百万计的来自Internet的感染企
图，其中绝大多数是没有什么价值的，仅仅是噪声而已，不会对顾
客造成实际的伤害。
在任何时刻，Intermet上都会发生不计其数的事件，但其中只有极少
数需要立即作出响应，以减轻它对业务所造成的风险。确认这些少
数事件需要非常特定和耗时的行动，它是任何有效的安全监测程序
的主要目标。以Slammer端虫为例，意识到这种端虫在Internet上的快
速感染率当然是比较有趣的，但这种数据对于实现信息资产保护这
个目的并没有什么用处。在这种情况下，需要付诸行动的事件就是
警告系统管理员他们的环境中有些遭到攻击的主机正试图向其他系
统进行扩散的事件。
对于Slammer和其他不计其数的类似蠕虫而言，一种有效的检测需要
付诸行动的事件的技巧是根据方向性对检测进行重新聚焦。下面是
前提条件：尽管任何网络都会频繁遭到攻击，但大多数攻击都是不
成功的。通过寻找自己的环境中开始进行带外攻击并需要立即采取
措施以解决问题的主机，就可以非常快速地找到遭到入侵的系统。
初看上去这似乎并不直观。确认带内攻击并主动防御入侵不是更好
的方法吗？从理论上说确实如此，但是要考虑到在许多情况下从攻
2454
---