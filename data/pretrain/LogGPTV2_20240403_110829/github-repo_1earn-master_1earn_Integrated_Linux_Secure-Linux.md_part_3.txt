	`setenforce 0`
---
### è¿›ç¨‹
#### è¿›ç¨‹å®šä½
```bash
ps -aux         # åˆ—å‡ºæ‰€æœ‰è¿›ç¨‹ä»¥åŠç›¸å…³ä¿¡æ¯å‘½ä»¤
ps -ef
service --status-all | grep running
top             # æ€»è§ˆç³»ç»Ÿå…¨é¢ä¿¡æ¯å‘½ä»¤
pidof name      # å®šä½ç¨‹åºçš„ pid
pidof -x name   # å®šä½è„šæœ¬çš„ pid
lsof -g gid     # å¯»æ‰¾æ¶æ„æ–‡ä»¶å…³è”çš„ lib æ–‡ä»¶
```
#### è¿›ç¨‹é™åˆ¶
```bash
ulimit -u 20    # ä¸´æ—¶æ€§å…è®¸ç”¨æˆ·æœ€å¤šåˆ›å»º 20 ä¸ªè¿›ç¨‹,é¢„é˜²ç±»ä¼¼ fork ç‚¸å¼¹
```
```vim
vim /etc/security/limits.conf
    user1 - nproc 20  # é€€å‡ºåé‡æ–°ç™»å½•,å°±ä¼šå‘ç°æœ€å¤§è¿›ç¨‹æ•°å·²ç»æ›´æ”¹ä¸º 20 äº†
```
#### è´Ÿè½½
**æ–‡ç« **
- [Linuxç³»ç»Ÿæ¸…é™¤ç¼“å­˜](https://www.cnblogs.com/jiu0821/p/9854704.html)
**æŸ¥è¯¢è´Ÿè½½ã€è¿›ç¨‹ç›‘æ§**
```bash
ps aux | grep Z                                         # åˆ—å‡ºè¿›ç¨‹è¡¨ä¸­æ‰€æœ‰åƒµå°¸è¿›ç¨‹
ps aux|head -1;ps aux|grep -v PID|sort -rn -k +3|head   # è·å–å ç”¨CPUèµ„æºæœ€å¤šçš„10ä¸ªè¿›ç¨‹
ps aux|head -1;ps aux|grep -v PID|sort -rn -k +4|head   # è·å–å ç”¨å†…å­˜èµ„æºæœ€å¤šçš„10ä¸ªè¿›ç¨‹
```
**æ¸…ç†ç¼“å­˜**
```bash
sync    # sync å‘½ä»¤åšåŒæ­¥,ä»¥ç¡®ä¿æ–‡ä»¶ç³»ç»Ÿçš„å®Œæ•´æ€§,å°†æ‰€æœ‰æœªå†™çš„ç³»ç»Ÿç¼“å†²åŒºå†™åˆ°ç£ç›˜ä¸­,åŒ…å«å·²ä¿®æ”¹çš„ i-nodeã€å·²å»¶è¿Ÿçš„å— I/O å’Œè¯»å†™æ˜ å°„æ–‡ä»¶.å¦åˆ™åœ¨é‡Šæ”¾ç¼“å­˜çš„è¿‡ç¨‹ä¸­,å¯èƒ½ä¼šä¸¢å¤±æœªä¿å­˜çš„æ–‡ä»¶.
echo 1 > /proc/sys/vm/drop_caches   # æ¸…ç† pagecache(é¡µé¢ç¼“å­˜)
echo 2 > /proc/sys/vm/drop_caches   # æ¸…ç† dentries(ç›®å½•ç¼“å­˜)å’Œinodes
echo 3 > /proc/sys/vm/drop_caches   # æ¸…ç† pagecacheã€dentries å’Œ inodes
sync
```
---
### ç³»ç»Ÿå®Œæ•´æ€§
é€šè¿‡ rpm è‡ªå¸¦çš„ -Va æ¥æ ¡éªŒæ£€æŸ¥æ‰€æœ‰çš„ rpm è½¯ä»¶åŒ…ï¼ŒæŸ¥çœ‹å“ªäº›å‘½ä»¤æ˜¯å¦è¢«æ›¿æ¢äº†
```bash
rpm -Va
# å¦‚æœä¸€åˆ‡å‡æ ¡éªŒæ­£å¸¸å°†ä¸ä¼šäº§ç”Ÿä»»ä½•è¾“å‡ºï¼Œå¦‚æœæœ‰ä¸ä¸€è‡´çš„åœ°æ–¹ï¼Œå°±ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼Œè¾“å‡ºæ ¼å¼æ˜¯8ä½é•¿å­—ç¬¦ä¸²ï¼Œæ¯ä¸ªå­—ç¬¦éƒ½ç”¨ä»¥è¡¨ç¤ºæ–‡ä»¶ä¸RPMæ•°æ®åº“ä¸­ä¸€ç§å±æ€§çš„æ¯”è¾ƒç»“æœ ï¼Œå¦‚æœæ˜¯. (ç‚¹) åˆ™è¡¨ç¤ºæµ‹è¯•é€šè¿‡ã€‚
éªŒè¯å†…å®¹ä¸­çš„8ä¸ªä¿¡æ¯çš„å…·ä½“å†…å®¹å¦‚ä¸‹ï¼š
- S         æ–‡ä»¶å¤§å°æ˜¯å¦æ”¹å˜
- M         æ–‡ä»¶çš„ç±»å‹æˆ–æ–‡ä»¶çš„æƒé™ï¼ˆrwxï¼‰æ˜¯å¦è¢«æ”¹å˜
- 5         æ–‡ä»¶MD5æ ¡éªŒæ˜¯å¦æ”¹å˜ï¼ˆå¯ä»¥çœ‹æˆæ–‡ä»¶å†…å®¹æ˜¯å¦æ”¹å˜ï¼‰
- D         è®¾å¤‡ä¸­ï¼Œä»ä»£ç æ˜¯å¦æ”¹å˜
- L         æ–‡ä»¶è·¯å¾„æ˜¯å¦æ”¹å˜
- U         æ–‡ä»¶çš„å±ä¸»ï¼ˆæ‰€æœ‰è€…ï¼‰æ˜¯å¦æ”¹å˜
- G         æ–‡ä»¶çš„å±ç»„æ˜¯å¦æ”¹å˜
- T         æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´æ˜¯å¦æ”¹å˜
```
**è¿˜åŸæ›¿æ¢å‘½ä»¤**
```bash
rpm  -qf /bin/ls  # æŸ¥è¯¢ ls å‘½ä»¤å±äºå“ªä¸ªè½¯ä»¶åŒ…
mv  /bin/ls /tmp  # å…ˆæŠŠ ls è½¬ç§»åˆ° tmp ç›®å½•ä¸‹ï¼Œé€ æˆ ls å‘½ä»¤ä¸¢å¤±çš„å‡è±¡
rpm2cpio /mnt/cdrom/Packages/coreutils-8.4-19.el6.i686.rpm | cpio -idv ./bin/ls # æå– rpm åŒ…ä¸­ ls å‘½ä»¤åˆ°å½“å‰ç›®å½•çš„/bin/lsä¸‹
cp /root/bin/ls  /bin/ # æŠŠ ls å‘½ä»¤å¤åˆ¶åˆ° /bin/ ç›®å½•,ä¿®å¤æ–‡ä»¶ä¸¢å¤±
```
---
### æ—¥å¿—
**ç³»ç»Ÿæ—¥å¿—**
- å†…å®¹è§ [æ—¥å¿—](./ç¬”è®°/æ—¥å¿—.md)
å¯¹äºæ—¥å¿—æ–‡ä»¶çš„ä¿æŠ¤
```bash
chattr +a xxx
chattr +a -R xxx # é€’å½’å¼å¢åŠ aæƒé™
# aé€‰é¡¹ä¸ºappend (è¿½åŠ ) only ,å³ç»™æ—¥å¿—æ–‡ä»¶åŠ ä¸Šaæƒé™å,å°†åªå¯ä»¥è¿½åŠ ,ä¸å¯ä»¥åˆ é™¤å’Œä¿®æ”¹ä¹‹å‰çš„å†…å®¹ã€‚
```
**webæ—¥å¿—**
- å†…å®¹è§ [å–è¯](../../Security/BlueTeam/å–è¯.md#ä¸­é—´ä»¶æœåŠ¡å™¨ç¨‹åºæ—¥å¿—) ä¸­é—´ä»¶æœåŠ¡å™¨ç¨‹åºæ—¥å¿—éƒ¨åˆ†
**æ•°æ®åº“æ—¥å¿—**
- å†…å®¹è§ [å–è¯](../../Security/BlueTeam/å–è¯.md#æ•°æ®åº“å–è¯) æ•°æ®åº“å–è¯éƒ¨åˆ†
---
## Net
### ç«¯å£
**æŸ¥**
```bash
getent services     # æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çš„é»˜è®¤ç«¯å£åç§°å’Œç«¯å£å·
lsof -i -P          # æ˜¾ç¤ºè¿›ç¨‹ä½¿ç”¨ç«¯å£ä½¿ç”¨æƒ…å†µ
lsof -i:22          # åªæŸ¥ 22 ç«¯å£
ss -tnlp
ss -tnlp | grep ssh
ss -tnlp | grep ":22"
netstat -tnlp
netstat -tnlp | grep ssh
nmap -sV -p 22 localhost
```
æ›´å¤šå†…å®¹æŸ¥çœ‹ [ç½‘ç»œ](./ç¬”è®°/ä¿¡æ¯.md#ç½‘ç»œ)
**é˜²**
- [EtherDream/anti-portscan: ä½¿ç”¨ iptables é˜²æ­¢ç«¯å£æ‰«æ](https://github.com/EtherDream/anti-portscan)
    ```bash
    git clone https://github.com/EtherDream/anti-portscan
    cd anti-portscan
    vim install.sh # ä¿®æ”¹éœ€è¦æ‰“å¼€çš„ç«¯å£
    sh install.sh
    ```
---
### Firewall
**æŸ¥**
```bash
firewall-cmd --list-services    # æŸ¥çœ‹é˜²ç«å¢™è®¾ç½®
firewall-cmd --state                    # æ˜¾ç¤ºé˜²ç«å¢™çŠ¶æ€
firewall-cmd --get-zones                # åˆ—å‡ºå½“å‰æœ‰å‡ ä¸ª zone
firewall-cmd --get-active-zones         # å–å¾—å½“å‰æ´»åŠ¨çš„ zones
firewall-cmd --get-default-zone         # å–å¾—é»˜è®¤çš„ zone
firewall-cmd --get-service              # å–å¾—å½“å‰æ”¯æŒ service
firewall-cmd --get-service --permanent  # æ£€æŸ¥ä¸‹ä¸€æ¬¡é‡è½½åå°†æ¿€æ´»çš„æœåŠ¡
firewall-cmd --zone=public --list-ports # åˆ—å‡º zone public ç«¯å£
firewall-cmd --zone=public --list-all   # åˆ—å‡º zone public å½“å‰è®¾ç½®
cat /etc/hosts.deny                     # tcp_Wrappers é˜²ç«å¢™çš„é…ç½®æ–‡ä»¶,è¯¦æƒ…è§ æ–‡ä»¶.md
cat /etc/hosts.allow                    # tcp_Wrappers é˜²ç«å¢™çš„é…ç½®æ–‡ä»¶,è¯¦æƒ…è§ æ–‡ä»¶.md
```
**é˜²**
```bash
firewall-cmd --permanent --zone=public --remove-service=ssh
firewall-cmd --permanent --zone=public --add-service=http
firewall-cmd --permanent --zone=internal --add-source=1.1.1.1
firewall-cmd --reload           # é‡å¯é˜²ç«å¢™æœåŠ¡
```
åœ¨ä¸Šé¢çš„é…ç½®ä¸­,å¦‚æœæœ‰äººå°è¯•ä» 1.1.1.1 å» ssh,è¿™ä¸ªè¯·æ±‚å°†ä¼šæˆåŠŸ,å› ä¸ºè¿™ä¸ªæºåŒºåŸŸ(internal)è¢«é¦–å…ˆåº”ç”¨,å¹¶ä¸”å®ƒå…è®¸ ssh è®¿é—®.
å¦‚æœæœ‰äººå°è¯•ä»å…¶å®ƒçš„åœ°å€,å¦‚ 2.2.2.2,å»è®¿é—® ssh,å®ƒä¸æ˜¯è¿™ä¸ªæºåŒºåŸŸçš„,å› ä¸ºå’Œè¿™ä¸ªæºåŒºåŸŸä¸åŒ¹é….å› æ­¤,è¿™ä¸ªè¯·æ±‚è¢«ç›´æ¥è½¬åˆ°æ¥å£åŒºåŸŸ(public),å®ƒæ²¡æœ‰æ˜¾å¼å¤„ç† ssh,å› ä¸º,public çš„ç›®æ ‡æ˜¯ default,è¿™ä¸ªè¯·æ±‚è¢«ä¼ é€’åˆ°é»˜è®¤åŠ¨ä½œ,å®ƒå°†è¢«æ‹’ç».
å¦‚æœ 1.1.1.1 å°è¯•è¿›è¡Œ http è®¿é—®ä¼šæ€æ ·ï¼ŸæºåŒºåŸŸ(internal)ä¸å…è®¸å®ƒ,ä½†æ˜¯,ç›®æ ‡æ˜¯ default,å› æ­¤,è¯·æ±‚å°†ä¼ é€’åˆ°æ¥å£åŒºåŸŸ(public),å®ƒè¢«å…è®¸è®¿é—®.
ç°åœ¨,è®©æˆ‘ä»¬å‡è®¾æœ‰äººä» 3.3.3.3 æ‹–ä½ çš„ç½‘ç«™.è¦é™åˆ¶ä»é‚£ä¸ª IP çš„è®¿é—®,ç®€å•åœ°å¢åŠ å®ƒåˆ°é¢„å®šä¹‰çš„ drop åŒºåŸŸ,æ­£å¦‚å…¶å,å®ƒå°†ä¸¢å¼ƒæ‰€æœ‰çš„è¿æ¥:
```bash
firewall-cmd --permanent --zone=drop --add-source=3.3.3.3
firewall-cmd --reload
```
ä¸‹ä¸€æ¬¡ 3.3.3.3 å°è¯•å»è®¿é—®ä½ çš„ç½‘ç«™,firewalld å°†è½¬å‘è¯·æ±‚åˆ°æºåŒºåŸŸ(drop).å› ä¸ºç›®æ ‡æ˜¯ DROP,è¯·æ±‚å°†è¢«æ‹’ç»,å¹¶ä¸”å®ƒä¸ä¼šè¢«è½¬å‘åˆ°æ¥å£åŒºåŸŸ(public).
`æ³¨:é…ç½®äº† firewalld æœåŠ¡åä¸€å®šè¦å»æ£€æŸ¥ä¸‹è§„åˆ™,å› ä¸ºä»–ä¸ä¼šé˜»æ‰æ­£åœ¨è¿›è¡Œçš„è¿æ¥,åªèƒ½é˜»æ‰é…ç½®å‘½ä»¤åè¿›è¡Œçš„è¿æ¥,æ‰€ä»¥ä½ ä¸çŸ¥é“ä½ çš„sshä¼šè¯ä¼šä¸ä¼šä¸€æ–­å°±å†ä¹Ÿè¿ä¸ä¸Šäº†,è¡€çš„æ•™è®­ğŸ¤£`
---
### iptable
**æŸ¥è¯¢è¡¨ä¸­çš„è§„åˆ™**
```bash
iptables -t raw -L      # åˆ—å‡ºæ‰€æœ‰ raw è¡¨ä¸­çš„æ‰€æœ‰è§„åˆ™
iptables -t mangle -L   # åˆ—å‡º mangle è¡¨ä¸­æ‰€æœ‰è§„åˆ™
iptables -t nat -L      # åˆ—å‡º nat è¡¨ä¸­æ‰€æœ‰è§„åˆ™
iptables -t filter -L   # åˆ—å‡º filter è¡¨ä¸­æ‰€æœ‰è§„åˆ™
```
**æŸ¥çœ‹ä¸åŒçš„é“¾ä¸­çš„è§„åˆ™**
```bash
iptables -L INPUT       # åªçœ‹ filter è¡¨ä¸­ï¼ˆé»˜è®¤ - t æ˜¯ filter è¡¨ï¼‰input é“¾çš„è§„åˆ™
iptables -vL INPUT      # åªçœ‹ filter è¡¨ä¸­ï¼ˆé»˜è®¤ - t æ˜¯ filter è¡¨ï¼‰input é“¾çš„è§„åˆ™è¯¦æƒ…
iptables -nvL INPUT     # åªçœ‹ filter è¡¨ä¸­ï¼ˆé»˜è®¤ - t æ˜¯ filter è¡¨ï¼‰input é“¾çš„è§„åˆ™è¯¦æƒ…ï¼ŒåŒæ—¶ä¸å¯¹ IP åœ°å€è¿›è¡Œåç§°åè§£æï¼Œç›´æ¥æ˜¾ç¤º IP
iptables --line-number -nvL INPUT  # åªçœ‹ filter è¡¨ä¸­ï¼ˆé»˜è®¤ - t æ˜¯ filter è¡¨ï¼‰input é“¾çš„è§„åˆ™è¯¦æƒ…ï¼ŒåŒæ—¶ä¸å¯¹ IP åœ°å€è¿›è¡Œåç§°åè§£æï¼Œç›´æ¥æ˜¾ç¤º IPï¼Œæ¯è¡ŒåŠ è¡Œæ ‡
```
---
### nftables
**æŸ¥çœ‹è§„åˆ™æ±‡æ€»**
```bash
nft list tables []
nft list table []  [-n] [-a]
nft list tables  # åˆ—å‡ºæ‰€æœ‰è¡¨
nft list table family table # åˆ—å‡ºæŒ‡å®šè¡¨ä¸­çš„æ‰€æœ‰é“¾å’Œè§„åˆ™
nft list table inet filter # è¦åˆ—å‡ºinetç°‡ä¸­f
nft list chain family table chain  # åˆ—å‡ºä¸€ä¸ªé“¾ä¸­çš„æ‰€æœ‰è§„åˆ™
nft list chain inet filter output  # è¦åˆ—å‡ºinetä¸­filterè¡¨çš„outputé“¾ä¸­çš„æ‰€æœ‰è§„åˆ™
```
**nftè¡¨ç®¡ç†**
```bash
nft add table family table  # åˆ›å»ºä¸€ä¸ªæ–°çš„è¡¨
nft list tables  # åˆ—å‡ºæ‰€æœ‰è¡¨
nft list table family table # åˆ—å‡ºæŒ‡å®šè¡¨ä¸­çš„æ‰€æœ‰é“¾å’Œè§„åˆ™
nft list table inet filter # è¦åˆ—å‡ºinetç°‡ä¸­filterè¡¨ä¸­çš„æ‰€æœ‰è§„åˆ™
nft delete table family table  # åˆ é™¤ä¸€ä¸ªè¡¨
nft flush table family table # è¦æ¸…ç©ºä¸€ä¸ªè¡¨ä¸­çš„æ‰€æœ‰è§„åˆ™
```
**nfté“¾ç®¡ç†**
```bash
nft add chain family table chain   # å°†åä¸ºchainçš„å¸¸è§„é“¾æ·»åŠ åˆ°åä¸ºtableçš„è¡¨ä¸­
nft add chain inet filter tcpchain   # ä¾‹å¦‚ï¼Œå°†åä¸ºtcpchainçš„å¸¸è§„é“¾æ·»åŠ åˆ°inetç°‡ä¸­åä¸ºfilterçš„è¡¨ä¸­
nft add chain family table chain { type type hook hook priority priority \; }   # æ·»åŠ åŸºæœ¬é“¾ï¼Œéœ€è¦æŒ‡å®šé’©å­å’Œä¼˜å…ˆçº§å€¼
nft list chain family table chain  # åˆ—å‡ºä¸€ä¸ªé“¾ä¸­çš„æ‰€æœ‰è§„åˆ™
nft list chain inet filter output  # è¦åˆ—å‡ºinetä¸­filterè¡¨çš„outputé“¾ä¸­çš„æ‰€æœ‰è§„åˆ™
nft chain family table chain { [ type type hook hook device device priority priority \; policy  \; ] }  # è¦ç¼–è¾‘ä¸€ä¸ªé“¾ï¼Œåªéœ€æŒ‰åç§°è°ƒç”¨å¹¶å®šä¹‰è¦æ›´æ”¹çš„è§„åˆ™
nft chain inet filter input { policy drop \; }   # å°†é»˜è®¤è¡¨ä¸­çš„inputé“¾ç­–ç•¥ä»acceptæ›´æ”¹ä¸ºdrop
nft delete chain family table chain # åˆ é™¤ä¸€ä¸ªé“¾,è¦åˆ é™¤çš„é“¾ä¸èƒ½åŒ…å«ä»»ä½•è§„åˆ™æˆ–è€…è·³è½¬ç›®æ ‡ã€‚
nft flush chain family table chain # æ¸…ç©ºä¸€ä¸ªé“¾çš„è§„åˆ™
```
**æ·»åŠ è§„åˆ™**
```bash
nft add rule family table chain handle handle statement  # å°†ä¸€æ¡è§„åˆ™æ·»åŠ åˆ°é“¾ä¸­
nft insert rule family table chain handle handle statement # å°†è§„åˆ™æ’å…¥åˆ°æŒ‡å®šä½ç½®,å¦‚æœæœªæŒ‡å®šhandleï¼Œåˆ™è§„åˆ™æ’å…¥åˆ°é“¾çš„å¼€å¤´ã€‚
```
**åˆ é™¤è§„åˆ™**
```bash
# ä¸‹é¢å‘½ä»¤ç¡®å®šä¸€ä¸ªè§„åˆ™çš„å¥æŸ„ï¼Œç„¶ååˆ é™¤ã€‚--numberå‚æ•°ç”¨äºæŸ¥çœ‹æ•°å­—è¾“å‡ºï¼Œå¦‚æœªè§£æçš„IPåœ°å€ã€‚
nft --handle --numeric list chain inet filter input
nft delete rule inet fltrTable input handle 10
# å¯ä»¥ç”¨nft flush tableå‘½ä»¤æ¸…ç©ºè¡¨ä¸­çš„æ‰€æœ‰çš„é“¾ã€‚å¯ä»¥ç”¨nft flush chainæˆ–è€…nft delete ruleå‘½ä»¤æ¸…ç©ºå•ä¸ªé“¾ã€‚
# ç¬¬ä¸€ä¸ªå‘½ä»¤æ¸…ç©ºfooè¡¨ä¸­çš„æ‰€æœ‰é“¾ã€‚ç¬¬äºŒä¸ªå‘½ä»¤æ¸…ç©ºip fooè¡¨ä¸­çš„baré“¾ã€‚ç¬¬ä¸‰ä¸ªå‘½ä»¤åˆ é™¤ip6 fooè¡¨barä¸¤ç§çš„æ‰€æœ‰è§„åˆ™ã€‚
nft flush table foo
nft flush chain foo bar
nft delete rule ip6 foo bar
```
**è‡ªåŠ¨é‡è½½**
```bash
æ¸…ç©ºå½“å‰è§„åˆ™é›†ï¼š