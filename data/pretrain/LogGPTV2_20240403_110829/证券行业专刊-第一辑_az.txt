172 	173172 	173
自主可控环境下的系统异构与持续免疫防护实践
国产操作系统在党政、金融、交通、能源、电信等多个行业涌现出 应用落地的实例，并逐渐向核心业务领域渗透。
图 4…2015-2023 国产操作系统市场规模及预测…引自亿欧《2021 自主可控产业应用落
地研究报告及供应商 60 强》
由此可见，在政策与市场双推动下，未来的安全发展或将与自主可 控建设紧密相连。
在此背景驱动下，持续免疫防护系统的建设采用国产芯片、国产服 务器操作系统、国产数据库等自主可控产品，实现自身自主可控改
毒等组件构成。主要集中在事中告警拦截或者事后溯源。持续免疫 防护系统在原有的传统安全防护体系的基础上引入可信安全框架，结合人工智能、区块链防篡改、用户行为分析等新兴技术，形成从 事前防御，到事中告警或者阻断、自主抵御到事后溯源的一整套完 整的安全体系，满足未来未知威胁的侵犯，更好更安全地保证业务 和服务。是对现有防御体系的补充完善、提升和增强。系统采用可信框架，确保自身可信的前提下生成被防护主机的白名 单文件，通过可信区块链防篡改技术，利用区块链分布式、不可篡 改、可溯源的特性，为业务系统重要的数据提供防篡改的保护，利 用用户行为分析，结合机器学习算法，迭代算法模型，实现用户行 为画像。
…
造的同时完美兼容其他操作系统，真正做到自主可控。	图 5…持续免疫防护系统建设框架
三、持续免疫防护系统实现对传统安全防护体系的补充
现有传统的安全防护体系大致由防火墙（下一代防火墙）、IPS、
WAF 等边界防护，以及旁路入侵检测，主机层面 EDR、桌面防病
四、可信框架是持续免疫防护体系建设的根基
持续免疫防护系统，其核心底层支撑是一套基于可信密码模块的可信
计算技术框架，其设计原理是依托于加固在宿主机主板上的可信密码
174 	175
自主可控环境下的系统异构与持续免疫防护实践174 	175
自主可控环境下的系统异构与持续免疫防护实践
模块监控网络内所有存活主机可信状态、主机运行程序是否可信、主 机是否运行非授权应用程序、机器程序执行过程是否符合预期的。
TCM 芯片不依赖于操作系统运行，同时固化在 TCM 芯片中的程 序也可以保证其安全性，由于 TCM 芯片可以通过硬件算法对数据、密钥文件进行存储和加密，因此为 TCM 芯片自身可信提供了极大
可信防护采用以可信证实、可信硬件为基础核心的软硬件架构，通 	的保障。
过可信硬件平台（可信根、密码固件），构建主机基本信任基，通 
过信任链的逐级扩展，得到主机启动时执行的应用程序白名单，利 	可信防护利用 TCM 芯片密码模块实现签名、平台身份验证、数据 用可信证实机制（控制、判断、信任管理），保护了白名单的完整 	传输加密功能。
可信。从而保证了系统在可知、可靠、可控、可信状态下运行。可信。从而保证了系统在可知、可靠、可控、可信状态下运行。
图 6…可信防护技术架构
可信硬件平台采用TCM芯片作为可信核心安全固件。TCM（Trusted…Cryptography…Module，可信密码模块）是国家密码管理局为了支 持中国可信计算的研究和应用而推出的安全芯片。它采用了国产加 密算法，能有效保护用户的计算机，有效防止非法用户的入侵。
可信计算的一个重要环节就是对系统平台进行完整性度量，从系统 启动开始，对 BIOS、grub、kernel 以及操作系统启动后的应用程 序等均需进行度量。
…
图 7…完整性度量
持续免疫防护系统以 TCM 为信任根，利用完整性度量框架逐级拓 展可信边界，最终将主机启动时所必须的应用程序文件、文件加载 的动态链接库及加载的内核模块，进行一次完整的散列 hash 运算，为主机构建起以内核为基础的可信边界，从内部形成基础保护屏 障，从而将不在可信边界内的应用程序拒之门外，以达到未知应用176 	177
自主可控环境下的系统异构与持续免疫防护实践
程序拒绝运行、已知应用程序篡改拒绝运行的基础保护效果。
五、基于可信区块链实现防篡改
率、节点安全等问题得到了有效提升，从而保证了链上数据的安全 性、上链存储效率。
六、结合人工智能技术实现用户行为分析
传统区块链技术用作存储的时候，存在着共识速度慢、读写性能差
的问题，出现这个问题的根本原因是区块链没有对运行区块链的节 点有任何限制——任何节点包括恶意节点都能够加入到区块链共 识过程中，这就要求共识的算法（POW 工作量证明等）必须能够 有较强的抗恶意节点的能力，且如果存在恶意节点的话共识的时间
持续免疫防护系统采用深度学习加组合学习的方式，对被保护的主 机运行的程序行为进行人工智能分析。默认对系统一段时间的操作 行为进行数据建模，一旦有机器违反了正常行为数据的建模将立刻 告警。同时也支持管理员通过编写规则红线，定义机器管理规范。和成本明显上升。	比如限制对于被保护系统的数据库文件，日志等的拷贝行为。
基于区块链存在的这个问题，持续免疫防护系统结合了可信计算的 技术，通过可信计算筛选出可信的节点，从而降低恶意节点对共识 过程的干扰；同时为了解决 POW 算法资源消耗大、共识效率低的 问题，引入了 PBFT 实用拜占庭容错算法，明显提高了共识速度。
用户行为分析过程分为数据采集与接入、数据处理、数据可视化等 几个部分，基本流程为：数据采集层采集系统所需数据并将数据存 入数据源，数据源将数据导出到大数据处理层以供其分析和处理数 据，服务层获取到处理完成的结果并发送到数据可视化层将数据呈
在此基础上引入国密算法，避免基于传统加密算法漏洞导致的攻 	现到页面。
击，有效的保护系统的安全运行。
| 178 | … |  | … |  | 179 |
|---|---|---|---|---|---||---|---|---|---|---|---|
| 178 |图 8…可信区块链框架 |图 8…可信区块链框架 |… | |179 |
| 178 |可信区块链作为底层基础设施，在原有区块链基础之上，其共识效 |可信区块链作为底层基础设施，在原有区块链基础之上，其共识效 |… |图 9…用户行为分析功能架构 |179 |
自主可控环境下的系统异构与持续免疫防护实践
用户行为分析功能建立了大量模型来对采集到的数据进行分析，根 据数据时效性分为离线计算模型和实时计算模型。
用户行为分析是整个持续免疫防护系统的大数据处理与学习黑白 事务的大脑，通过对数据的处理与采集，将被探测主机的内部、外 部行为进行分析，从而让系统具备识别黑白事务的能力。
实时计算模型使用Spark作为流处理引擎，实时消费处理用户数据。实时计算模型使用Spark作为流处理引擎，实时消费处理用户数据。
对从数据接入平台接收到的数据首先进行数据清洗，过滤掉与主机 	七、总结 或用户特征无关的冗余数据和异常信息；然后把清洗过后的用户数
据加工成能够被用户建模使用的数据；发送给 Kafka。实时数据分 析组件和数据消费者可以通过 Kafka 得到实时数据，进行实时分 析和计算，挖掘用户的行为偏好等信息。
…
图 10…实时计算模型
离线计算模型通过对离线的历史数据的去重和解析，利用数据完成
等保 2.0 新标准对新型安全攻击检测能力、网络安全分析能力、用 户行为分析能力等提出了更高的要求，也正呼应了证券行业信息安 全对抗高级威胁、内部威胁，升级安全体系从被动防护到主动防御、动态防御的实际需求。
持续免疫防护系统在传统安全理念基础上引入可信技术、区块链、用户行为分析等技术，结合人工智能，建立新的安全防护体系。同 时已与海光、麒麟等自主可控产品完成适配，完成自主可控改造。传统安全体系升级的建设方案很多，本文仅对自身实践过的持续免 疫防护体系建设进行介绍。希望可以与行业内同仁产生共鸣，起到
各模型的训练，并将训练得到的模型参数进行存储，供异常检测部 	抛砖引玉的作用。
分读取使用。训练过程首先加载知识库并对其进行处理，然后对训 
练数据进行预处理，最后完成基于服务类型、基于命令类型、核心 	参考文献：
算法以及深度学习算法的四类模型的训练。
…
李佳琪、秦志豪，2021 中国自主可控产业应用落地研究报告及供应商 60 强，亿欧智
库，2021.11.19
作者介绍 	SEC-UN    SEC-UN    SEC-UN    SEC-UN    SEC-UN    SEC-UN    SEC-UN    SEC-UN    SEC-UN    SEC-UN    SEC-UN    SEC-UN    SEC-UN    SEC-UN    SEC-UN    SEC-UN    SEC-UN    SEC-UN沈嗣贤，东吴证券股份有限公司信息安全管理团队负责人，硕士研究生学历，拥有高 级工程师职称、CISP 等多项网络安全专业证书。2008 年入行，在东吴证券先后从 事过系统运行、网络通信和信息安全的工作。曾荣获 2020 年度国家金融科技发展奖