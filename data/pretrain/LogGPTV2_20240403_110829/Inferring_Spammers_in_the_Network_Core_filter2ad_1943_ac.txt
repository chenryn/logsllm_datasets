# 服务器接受率与流量分析

## 图表说明
- **图7. 服务器接受率与流量体积**
  - Y轴: 接受率（从0%到100%）
  - X轴: 流量体积（从0到5,000,000）

- **图8. 邮件发送者的可见性**
  - Y轴: 可见的邮件发送者数量（从0到5,500,000）
  - X轴: 服务器类别（前5名、前10名和全部320个服务器）

- **图9. 使用协同过滤后的改进潜力**
  - Y轴: 改进潜力（从0到1）
  - X轴: 不同的拒绝服务器数量（1、5、10）

## 结论
不同服务器之间的接受率差异主要归因于配置问题。存在一个庞大的服务器群体，可能需要提醒或借鉴其他服务器的专业知识。

## 4.2 协同过滤

鉴于上述观察结果，针对不平衡的邮件服务器性能，ISP可以采取什么措施来提高整个网络的预过滤性能？显然，ISP可以联系各个管理员并组织会议来讨论邮件服务器性能统计，并让管理员们分享经验。然而，这需要大量的组织工作，需要定期进行，并且管理员的参与度无法保证。此外，教育客户的电子邮件管理员通常不是ISP的主要业务。

因此，我们研究了一种被动的方法，使所有服务器能够从本地知识和其他服务器中已有的最佳反垃圾邮件技术中受益。通过接受或拒绝来自客户端的邮件，邮件服务器实际上对客户端进行了隐式的评级。利用我们的方法，可以从流量中提取这些评级，并构建一个协同过滤系统（CFS），更准确地说是一个协同评级/声誉系统。该系统会根据所有服务器的行为推荐接受或拒绝来自特定客户端的邮件：“这个主机被网络中的80%的服务器拒绝了，你可能也应该拒绝它。”

需要注意的是，收集信息的价值取决于不同服务器阻止不同流量的能力：异构的知识或预过滤检测技术和政策是可取的，因为这增加了至少某些方法能够检测出垃圾邮件发送者的可能性。

同时，为了获得有用且足够可信的评级，每个服务器可见的邮件发送者集合之间需要有显著的重叠。我们分析了三个集合中发送主机的可见性：前5名、前10名和所有内部服务器（见图8）。超过550万个邮件发送者在320个内部服务器上可见。此外，72%的所有邮件发送者至少在两个内部服务器上可见。这意味着对于72%的邮件发送者，可以从另一个服务器获得第二种意见。请注意，即使是前5名邮件服务器也只看到61%的发送主机。另外，只有6%的邮件发送者在这五个服务器上都可见。对于前10名服务器，这一比例增加到了17%。通过使用所有内部服务器的信息，42%的发送主机在至少5个不同的服务器上可见，这是构建CFS的良好基础。此外，我们还明确分析了被列入黑名单或白名单的主机的可见性。被列入黑名单的主机的可见性遵循总体主机可见性。然而，被列入白名单的主机的可见性更好（例如，60%的白名单主机在至少5个不同的服务器上可见）。

实际实现CFS超出了本文的范围。不过，我们在这里感兴趣的是通过模拟简单的过滤规则来估计这种系统的潜力。具体来说，我们模拟了一个在线版本的系统，其中阻塞列表是在解析传入流量时根据一些简单规则创建的。特别是，为那些被一致阻塞的发送者维护计数器。一旦某个发送者的连接被至少10个、5个或1个服务器分别阻塞，该发送者就会被列入我们的阻塞列表。然后，如果某个发送者在列表中，其所有传入连接将被视为被拒绝。假设所有服务器都在使用CFS的情况下，得到的结果如图9所示。

在用于决策的服务器“投票”数量上存在一种内在的权衡。通过要求许多拒绝服务器（例如10个）才能进入阻塞列表，过滤的可靠性变得非常强（只有3个被阻塞的主机实际上是白名单上的）。然而，阻塞列表的规模减小了，并且提供的额外信息比黑名单少。具体来说，在10个服务器的情况下，阻塞列表与Spamhaus黑名单有83%的重叠，并且可以用来阻止47%的所有SMTP会话。在另一种极端情况下，如果只需要一个拒绝服务器就可以被列入阻塞列表，则所有服务器的接受率会急剧下降。此外，阻塞列表与Spamhaus的重叠仅为70%，并且可以用来阻止高达95%的所有SMTP连接。然而，有185个成员是白名单上的。也就是说，只需要一个拒绝服务器引入了更高的错误拒绝率。尽管如此，重要的是要注意，在这两种情况下，这种方法识别出的大量主机并没有出现在黑名单中，强调了系统的协作性质，并暗示仅仅让表现不佳的服务器使用黑名单是不够的。

综上所述，我们的估计表明，可以利用显著的信息重叠来改善整体预过滤效果，使本地服务器信息在整个网络中几乎无缝地访问。目前，预过滤主要依赖DNSL黑名单。然而，CFS独立于所应用的技术，并将自动从即将到来的改进技术中受益。

最后，由于基于流的系统附带的标签具有内在的“软性”，以及在网络核心阻止会话的各种风险，我们在此强调，我们的系统并不是作为一个实际的阻止过滤器，而是一个声誉评级系统，个别邮件服务器可以选择在其预过滤阶段包括该系统。因此，那些策略是接受所有邮件的服务器不必受到我们系统的影响，尽管使用它可以为内容过滤提供提示。

## 5 讨论
尽管这只是第一步，但我们相信提出的方法在生产网络中有重要的应用潜力，并为未来研究网络级和网络范围内的垃圾邮件流量特性铺平了道路。本节中，我们将讨论我们方法的一些可能的局限性。

### 延迟
路由器仅在TCP连接完成后才导出流数据。因此，关于流的信息至少会被延迟到会话关闭为止。我们测量了90%的SMTP流的延迟小于7.7秒。这说明任何基于流特性的应用程序都只能达到接近实时的效果。特别是，不能使用流的属性来拦截该流本身，而是后续的流。对于我们提出的应用程序，这种限制是可以接受的，因为我们不感兴趣于使用流的属性来拦截该流本身，而是随后的流。

### 流大小操纵
原则上，垃圾邮件发送者可以通过延长信封阶段来适应我们的方法，例如通过发送多个RCPT或HELO命令。这确实会增加每个流传输的字节数，但同时也会增加包的数量。然而，每个包的平均字节数仍然很小，每包字节数指标仍可用于分类。此外，垃圾邮件发送者可以尝试通过使用长电子邮件地址来增加每个命令传输的字节数，但命令的最大长度限制为521个字符。此外，任何偏离正常SMTP行为的行为都可以很容易地被检测到，邮件服务器可以强制缩短信封阶段，因为在正常情况下不需要过长。此外，可以发布主机的不当行为，以便其他服务器可以获得这些信息。

在一个更复杂的情景中，垃圾邮件发送者可以接管不同的内部主机并将它们重新配置为内部邮件服务器。通过从一个机器人向另一个机器人发送被接受的SMTP流量，可以试图对这些机器人的CFS评级产生积极影响。CFS的设计需要意识到这个问题。首先，只有活跃时间较长（即，它们已经接受了至少几周的邮件）并且从受信任的邮件服务器（例如，在白名单上）获得一定数量连接的服务器才能被纳入过滤过程。

## 6 结论
邮件服务器管理员正在与垃圾邮件发送者进行一场军备竞赛。他们迫切需要新的方法来对抗日益增多的低级别僵尸网络垃圾邮件。本文展示了简单的流指标（如字节数、包数和每包字节数）在邮件服务器中部署预过滤时，能够成功区分垃圾邮件和正常邮件。这样，运营商可以集中分散的邮件服务器知识在网络核心，并被动地积累全网垃圾邮件统计数据，评估服务器的过滤性能，并对客户端进行评级。因此，流和服务器日志分析的优势最终在网络核心交汇。我们认为这是在网络层面成功打击垃圾邮件的重要一步。

## 参考文献
1. IRONPORT: 2008互联网安全趋势, http://www.ironport.com
2. Harris, E.: 灰名单——垃圾邮件控制战的下一步 (2003)
3. SpamCop: Spamcop 阻止列表, http://www.spamcop.net/bl.shtml
4. Spamhaus: Spamhaus 阻止列表, http://www.spamhaus.org/sbl
5. Wong, M., Schlitt, W.: 发送方策略框架 (SPF). RFC 4408
6. Ramachandran, A., Dagon, D., Feamster, N.: DNS 基础的黑名单能否跟上僵尸网络的步伐. 在: CEAS 2006 (2006)
7. Duan, Z., Gopalan, K., Yuan, X.: 垃圾邮件发送者的行为特征及其网络可达性. 在: IEEE 国际通信会议, ICC 2007 (2007)
8. Ramachandran, A., Feamster, N., Vempala, S.: 基于行为的黑名单过滤垃圾邮件. 在: ACM 计算机和通信安全会议, CCS 2007 (2007)
9. Beverly, R., Sollins, K.: 利用传输层特征过滤垃圾邮件. 在: CEAS 2008 (2008)
10. Clayton, R.: 利用 spamHINTS 的早期结果. 在: CEAS 2006 (2006)
11. Gu, G., Perdisci, R., Zhang, J., Lee, W.: BotMiner: 网络流量聚类分析以实现协议和结构无关的僵尸网络检测. 在: USENIX 安全研讨会 (2008年7月)
12. Syed, N.A., Feamster, N., Gray, A., Krasser, S.: Snare: 空间-时间网络级自动声誉引擎. 技术报告 GT-CSE-08-02, 乔治亚理工学院 (2008)
13. Desikan, P., Srivastava, J.: 通过分析网络流量检测电子邮件垃圾邮件发送机器. 在: ICDM 数据挖掘隐私和安全方面研讨会 (2004)
14. Gomes, L.H., Almeida, R.B., Bettencourt, L.M.A., Almeida, V., Almeida, J.M.: 垃圾邮件和合法邮件网络的比较图理论特征. Arxiv physics/0504025 (2005)
15. SWITCH: 瑞士教育和研究网络, http://www.switch.ch
16. Gomes, L.H., Cazita, C., Almeida, J.M., Almeida, V., Meira, W.: 垃圾邮件流量特征. 在: ACM SIGCOMM 互联网测量会议, IMC 2004 (2004)
17. Fawcett, T.: ROC 分析简介. 模式识别字母 27 (2006)
18. Schatzmann, D., Burkhart, M., Spyropoulos, T.: 垃圾邮件和正常邮件的流级特征. 技术报告 291, 苏黎世联邦理工学院计算机工程和网络实验室 (2008)
19. Ramachandran, A., Seetharaman, S., Feamster, N., Vazirani, V.: 快速监控流量子群体. 在: ACM SIGCOMM 互联网测量会议, IMC 2008 (2008)
20. Klensin, J.: 简单邮件传输协议. RFC 2821 (2001年4月)