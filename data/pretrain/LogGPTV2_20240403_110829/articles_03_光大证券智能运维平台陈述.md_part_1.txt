基于机器学习与大数据的
智能运维平台
孙伟
项目背景与历程
行业务创新快速发展，对技术系统的快速响应提出了更高的需求；
AIOps
背景 而另一方面带来的是系统频繁升级、系统越来越多，系统交
2016年Gartner提出AIOps=机器学习算法
互关系日益复杂，给安全稳定运行带来了巨大挑战
+运维大数据
项目启动
2017年升级监管控运维工具以及大数据平台，
基于证券行业系统可用性、连续性要求极高的特点，结合光大证券
启动智能运维平台建设
思路 运维系统建设现状，选取异常发现、故障定位以及故障处置作
为智能运维建设路径 项目落地
2018-2019年光大证券运维专家团队、清华
NetMan实验室、日志易团队
荣获：上交所优秀论文，IDC最佳创新案例，
云鹰最高成就奖
赋能监管控运维体系，提升运维效率和系统可用性，
01
改善RTO水平，降低MTTR，提升用户体验
建
持续建设
设 引入成熟可控的开源组件和技术，降低运维系统
02
深化故障定位场景，建设故障处置场景，完
目 建设成本 善智能运维体系
标
探索金融行业可以落地、可以复制的智能运维
03
体系建设实施路径
建设场景综述
智能运维平台融合了多源异构的海量监控数据，如KPI、日志、调用链、告警等，借助机器学习算法对各类数据进行关联分析和异常检测，实现异常及时
发现、快速定位
•• 响响应应率率低低 •• 应应用用报报错错 •• 通通讯讯失失败败 •• 版版本本BBUUGG •• 网网络络问问题题 •• 主主机机问问题题 •• 根根源源系系统统 •• 根根源源机机器器
•• 响响应应变变慢慢 •• …… •• 后后台台问问题题 •• …… •• …… •• 组组件件问问题题 •• …… •• ……
•• …… •• …… •• …… •• …… •• …… •• …… •• …… •• ……
业业务务指指标标 应应用用日日志志 错错误误码码 客客户户端端版版本本 网网段段 主主机机IIPP …… 应应用用系系统统 机机器器节节点点
异异常常检检测测 异异常常检检测测 业业务务明明细细多多维维定定位位 调调用用链链分分析析
业业务务指指标标 应应用用日日志志 交交易易明明细细
应应用用系系统统 应应用用系系统统 应应用用系系统统
调调用用关关系系
应
用
排
运维图谱+数据工厂 障
树
数数据据库库 网网络络 主主机机 存存储储 事事件件
指指标标 日日志志 告告警警 指指标标 日日志志 告告警警 指指标标 日日志志 告告警警 指指标标 日日志志 告告警警 工工单单
•• 活活跃跃会会话话数数高高 •• PPIINNGG不不通通 •• CCPPUU负负载载高高 •• IIOOPPSS速速率率异异常常 •• 变变更更
•• 表表空空间间大大小小不不足足 •• 端端口口闪闪断断 •• 内内存存即即将将打打满满 •• 关关键键字字报报错错 •• 重重启启
•• 数数据据库库宕宕机机 •• 网网络络流流量量异异常常 •• 主主机机HHAANNGG •• …… •• ……
•• …… •• …… •• ……
异异常常机机器器 基基础础组组件件日日志志
定定位位 异异常常检检测测
业务指标异常检测：准确、提前洞察业务风险
• 专注于关键业务指标 – 衡量业务系统的健康状态：成功率、响应率、响应时间、调用次数等
• 业务指标异常检测 – 关键是要全、快、准为后续的故障诊断和修复赢得宝贵的时间。
无监督 实时处理 海量多类型指标（几十万级）
算法原理：本项目采用无监督学习算法，无
需人工标注，自动识别数据特征、选择最合
周期长度 检测
适的检测算法基于历史数据进行模型训练， 检测
检测
特征描述器 器 分类器 结果
KPI 周期偏移 器
实现指标实时异常检测。 器
抖动程度
传统的指标监控方式 AIOps方式  检测周期性数据的异常检测  检测合理范围内的突变异常
静态阈值 智能检测
生产应用：生
无法适应业务
一套智能算法
产上已接入了
指标波动
13000
 自动识别无规律性指标，并给出极限阈值  检测规律行为缺失（如跑批失败） 约 条关
阈值大小设置不准确 全自动适配各种KPI 键业务指标；
理论研究：本
阈值配置工作量大
无需任何标注
场景共发表国
 适配变更导致指标剧变（如版本上线）  不受数据缺失、中断影响
3
无法适应特殊 际顶会论文
检测多种异常
日期波动 篇。
日志异常检测：自动学习、挖掘海量日志中的异常症状
海量运维监控日志 • 日志中有更多征兆信息，有助于提前发现问题 实现原理：日志异常检测使用自然语言处理技术实现针对原始日
蕴含丰富的价值
• 日志中有更详细的语义信息，有助于快速定位问题 志的智能化模板提取和变量解析，进而对日志数据进行异常检测。
模板识别： 非结构化日志原文->结 算法学习+规则： 告警：经过负面词匹配、或人工 模板不关心：关闭检测
构化模板 持续学习模板日志数量 干预后升级为告警 告警不准确：修改异常检测策略
罕见日志：自动解析模板，发出新 的变化特征，训练生成 疑似：算法默认检测出的异常消 告警等级：调整告警等级
增模板告警 基带，检测出异常点 息，减少噪音
趋势图：日志数量的变化趋势
告警反馈
变量分布图：模板中变量值的分布情况
模板解析 异常检测 告警分类 日志对比分析：上一时段、昨天、上周
原始日志：模板中的原始日志
定位分析
日志上下文：某条日志的上下文
传统日志监控 AIOps智能日志检测
生产应用：生产上已接入
完全依赖日志专家事先 了业务日志、应用模块运
自动适配各类日志
配置，工作量大 行日志、数据库与操作系
统日志，每天处理日志量
配置不全面 增量学习动态更新 约500G；
理论研究：本场景共发表
更新开销大 无需任何标注
国际顶会论文2篇。
检测方法适应力弱 海量日志快速投产
业务明细多维定位：30秒排查上万种潜在交易维度组合
问题定义：当某个关键业务系统黄金指标出现异常时候，从交易明细中快速准确定位到导致指标异常的交易维度
• 某个IP的问题？ 上万种维度取值组合 交易明细 异常检测
数据
多维交
某系统平 • 某个人通过外挂程序非法访问？
易明细
均响应时
间上升 ? • 新上线的版本bug？ 第1层维度组合 基于嫌疑程度的
基于“影响力”的 层 蒙特卡洛树搜索
• 某个城市或者ISP网络故障？
次
异常检测算法 • 连锁效应：
化 第2层维度组合
剪