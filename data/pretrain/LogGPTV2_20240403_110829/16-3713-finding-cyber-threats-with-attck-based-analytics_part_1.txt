MTR170202
MITRE TECHNICAL REPORT
Finding Cyber Threats with
™
ATT&CK -Based Analytics
Dept. No.: J83L
Project No.: 0716MM09-AA
The views, opinions and/or findings
contained in this report are those of The
MITRE Corporation and should not be
construed as an official government position,
policy, or decision, unless designated by
other documentation.
Approved for Public Release; Distribution
Unlimited. Case Number 16-3713.
This technical data deliverable was
developed using contract funds under Basic
Contract No. W15P7T-13-C-A802.
©2017 The MITRE Corporation. Blake E. Strom
All rights reserved. ATT&CK and ATT&CK
Matrix are trademarks of The MITRE Joseph A. Battaglia
Corporation.
Michael S. Kemmerer
Douglas P. Miller
Annapolis Junction, MD
Craig Wampler
Sean M. Whitley
Ross D. Wolf
June 2017
Abstract
Post-compromise intrusion detection of cyber adversaries is an important capability for network
defenders as adversaries continue to evolve methods for compromising systems and evading
common defenses. This paper presents a methodology for using the MITRE ATT&CK
framework, a behavioral-based threat model, to identify relevant defensive sensors and build,
test, and refine behavioral-based analytic detection capabilities using adversary emulation. This
methodology can be applied to enhance enterprise network security through defensive gap
analysis, endpoint security product evaluations, building and tuning behavioral analytics for a
particular environment, and performing validation of defenses against a common threat model
using a red team emulating known adversary behavior.
ii
©2017 The MITRE Corporation. All rights reserved.
Approved for Public Release; Distribution Unlimited. Case Number 16-3713.
This page intentionally left blank.
iii
©2017 The MITRE Corporation. All rights reserved.
Approved for Public Release; Distribution Unlimited. Case Number 16-3713.
Acknowledgments
We would like to thank the MITRE cyber security research program and leadership for
supporting our research over the years, providing valuable oversight, and enabling the team to
break new ground on enterprise detection. Especially Todd Wittbold for the original vision and
early leadership that enabled the team to focus on the research. William Kupersanin, Adam
Pennington, Xeno Kovah, Frank Duff, Eric Sheesley, Brad Crawford, and all the others who
shaped FMX’s research over the years by articulating the threat, and defining how to detect it
more effectively. Their leadership enabled the vision to become a reality. MITRE Annapolis
Junction site management, MITRE InfoSec, and MITRE Center for Information and Technology
for their understanding and patience as we challenged established policies in the course of our
research. The living lab environment, and continual red teaming of the environment would not
have been possible without their support. And finally, we would like to acknowledge and thank
the National Security Agency Adaptive Cyber Defense Systems research team. They were strong
research advocates for incorporating cyber resilience concepts, participated in experiments
conducted within the research environment, and engaged in multiple brainstorming sessions on
detection, response, and threat modeling.
iv
©2017 The MITRE Corporation. All rights reserved.
Approved for Public Release; Distribution Unlimited. Case Number 16-3713.
Table of Contents
Introduction ............................................................................................................................. 1
1.1 Frame of Reference ........................................................................................................... 2
1.2 Shortcomings of Contemporary Approaches for Detection ................................................... 4
Threat-Based Security Approach ............................................................................................ 5
2.1 Principle 1: Include Post-Compromise Detection ................................................................. 5
2.2 Principle 2: Focus on Behavior ........................................................................................... 6
2.3 Principle 3: Use a Threat-based Model ................................................................................ 6
2.4 Principle 4: Iterate by Design ............................................................................................. 7
2.5 Principle 5: Develop and Test in a Realistic Environment ..................................................... 7
ATT&CK ................................................................................................................................ 9
3.1 Post-Compromise Threat-Based Modeling .......................................................................... 9
3.2 Tactics ............................................................................................................................ 10
3.3 Techniques ...................................................................................................................... 12
3.4 Operational Use Cases ..................................................................................................... 13
ATT&CK-Based Analytics Development Method ............................................................... 14
4.1 Step 1: Identify Behaviors ................................................................................................ 16
4.2 Step 2: Acquire Data ........................................................................................................ 16
4.2.1 Endpoint Sensing ......................................................................................................... 17
4.3 Step 3: Develop Analytics ................................................................................................ 20
4.4 Step 4: Develop an Adversary Emulation Scenario ............................................................ 21
4.4.1 Scenario Development ................................................................................................. 22
4.5 Step 5: Emulate Threat ..................................................................................................... 27
4.6 Step 6: Investigate Attack ................................................................................................. 27
4.7 Step 7: Evaluate Performance ........................................................................................... 28
Real-World Experiences ....................................................................................................... 29
5.1 Cyber Game Experiences ................................................................................................. 29
5.2 Analytic Iteration ............................................................................................................. 31
Summary ............................................................................................................................... 33
References ..................................................................................................................................... 35
Appendix A Details on MITRE’s Implementation .................................................................. A-1
A.1 Example Analytics ........................................................................................................ A-1
A.2 Sensors ......................................................................................................................... A-3
Appendix B Scenario Details .................................................................................................. B-1
B.1 Scenario 1 ..................................................................................................................... B-1
B.2 Scenario 2 ..................................................................................................................... B-3
v
©©22001177 TThhee MMIITTRREE CCoorrppoorraattiioonn.. AAllll rriigghhttss rreesseerrvveedd..
Approved for Public Release; Distribution Unlimited. Case Number 16-3713.
Table of Figures
Figure 1. Five Principles of Threat-Based Security ........................................................................ 5
Figure 2. The ATT&CK Tactic Categories .................................................................................... 7
Figure 3. The MITRE ATT&CK Matrix™ .................................................................................. 11
Figure 4 ATT&CK-Based Analytics Development Method ........................................................ 15
Figure 5. Color Coded ATT&CK Matrix Covering Notional Perimeter-based Defenses ............ 19
Figure 6. Scenario 1 Plan ATT&CK Matrix ................................................................................. 24
Figure 7. Scenario 2 ATT&CK Matrix ......................................................................................... 26
vi
©2017 The MITRE Corporation. All rights reserved.
Approved for Public Release; Distribution Unlimited. Case Number 16-3713.
Introduction
Defending an enterprise network against an advanced persistent threat (APT) remains an
increasingly difficult challenge that requires, among other things, advanced technologies and
approaches for thwarting adversary goals. In current enterprise networks, it is unlikely that
organizations have the ability or the resources to detect and defend against every method an
adversary might use to gain access to their networks and systems. Even if an organization’s
enterprise patching and software compliance program is perfect, an adversary may use a zero-
day exploit, or a social engineering attack to gain a foothold in a potential victim’s network.
Once inside, adversaries hide in the noise and complexity of their target’s environment, often
using legitimate mechanisms and camouflaging their activities in normal network traffic to
achieve their objectives. Depending on the security sophistication of the target network, an
adversary is often presented with ample time to do their work. For instance, FireEye’s M-Trends
states that the median time for an enterprise to discover they've been compromised was 146 days
in 2015. [1]
To help address these challenges, in 2010 MITRE began researching data sources and analytic
processes for detecting APTs more quickly under an “assume breach” mentality through the use
of endpoint telemetry data. Specifically, MITRE’s work centered on post-compromise detection,
focusing on adversary behavior after they have gained access to a system within a network.
One driver for MITRE’s approach was that public information on cyber intrusions suggests that
adversaries tend to exhibit consistent patterns of behavior while interacting with endpoint or
victim systems. [2] The goal of MITRE’s research was to show that automated measuring of
endpoint data or telemetry could be used to detect post-compromise operations in a useful way
that distinguished such behavior from the typical noise generated through normal system use.
The results of this research indicated that using analytics based on a combination of host and
network behaviors provides a useful way to detect post-compromise adversary behavior.
As part of its research effort, starting in 2013 MITRE also developed a process for modeling an
adversary’s post-compromise behavior at a granular level. This model is named ATT&CK™
(Adversarial Tactics, Techniques, and Common Knowledge) [3], and it serves as both the
adversary emulation playbook and as a method for discovering analytic coverage and defense
gaps inside a target network. ATT&CK was released in 2015 and is available at
https://attack.mitre.org.
Additionally, MITRE researchers created a method for describing behavioral intrusion detection
analytics and a suite of analytics aligned to the ATT&CK model, both of which have been made
publicly available to the information security community through the MITRE Cyber Analytics
Repository. [4]
Both the creation of behavioral detection analytics and the efficacy of this approach in detecting
threat behavior were validated through a series of “cyber games” that pitted a Red Team
performing adversary emulation using APT behavior (as described in the ATT&CK model)
against a Blue Team using analytics to detect the Red Team’s intrusion and the scope of its
actions throughout the targeted network. The games were performed on an approximately two-
hundred-fifty-node production enclave on MITRE’s live corporate network. A live network was
1
©©22001177 TThhee MMIITTRREE CCoorrppoorraattiioonn.. AAllll rriigghhttss rreesseerrvveedd..
Approved for Public Release; Distribution Unlimited. Case Number 16-3713.
used to ensure realistic network and system noise typically generated through normal use of a
corporate network environment so that MITRE’s analytics could be tuned appropriately to detect
malicious behavior.
The purpose of this paper is to: 1) educate the reader about how to apply MITRE’s ATT&CK
model for better detection of an APT operating within a given system or network; 2) describe the
processes and methods for developing this model and its associated methods and analytics; and
3) to share some practical experiences and anecdotes to give the reader ideas on how MITRE’s
research might help a specific organization protect its networks and systems. To these ends, this
paper begins by orienting the reader with a hypothetical APT campaign that is described using
tactics, techniques, and procedures (TTPs) from the ATT&CK model. MITRE’s high level
research process and the behavioral detection paradigm it developed are then described in
Section 2. The ATT&CK model itself is described in Section 3. Section 4 explains the process of
applying ATT&CK for developing behavioral intrusion detection analytics. Section 5 details
some of MITRE’s experiences in applying our methodology. Section 6 provides a summary of
MITRE’s work.
1.1 Frame of Reference
To assist with understanding the applicability of the research described in this paper, it is helpful
to first consider a hypothetical APT campaign based on an adversary’s post-compromise tactics,
techniques, and procedures (TTPs). The hypothetical adversary in this example uses publically
reported TTPs, each of which are described in the ATT&CK model itself and referenced in
footnotes that should not be confused with the endnotes used throughout this paper and signified
with a bracketed number nomenclature such as [#]. The ATT&CK model is explained further in
Section 3, but referenced here to show how it describes post-compromise adversary behavior.
The hypothetical campaign begins with an adversary sending a spear phishing e-mail designed
around a current event of interest. [5] The payload is a .zip file that contains a decoy portable
document format (PDF) file and a malicious executable that uses the PDF to disguise itself on
systems with Acrobat Reader installed. [6]
When run, the executable downloads a second stage1 Remote Access Tool (RAT) payload,
giving a remote operator access to the victim computer as well as an initial access point into the
network. The adversary then generates new domain names for Command and Control (C2)
purposes and sends these domains to the RAT on the compromised network through periodically
changing twitter handles2. [7] The domains and Internet Protocol (IP) addresses used for C2 are
short-lived and are routinely changed by the adversary after only a few days. The adversary
persists or maintains a seemingly legitimate presence on the victim computer by installing a
Windows® service3 with a name that is easily assumed by the computer’s owner to be that of a
1 ATT&CK: T1104 – Command and Control/Multi-Stage Channels
2 ATT&CK: T1102 – Command and Control/Web Service
3 ATT&CK: T1050 – Persistence/New Service
2
©©22001177 TThhee MMIITTRREE CCoorrppoorraattiioonn.. AAllll rriigghhttss rreesseerrvveedd..
Approved for Public Release; Distribution Unlimited. Case Number 16-3713.
legitimate system service4. Before deploying this malware, the adversary has previously tested it
on a wide array of anti-virus (AV) products to ensure it does not match any existing or known
malware signatures5.
To interact with its host victim, the remote operator uses the RAT to start a Windows command
prompt6. The adversary then uses tools already available on the compromised computer to learn
more about the victim’s system and the surrounding network with the goal of increasing his level
of access on additional systems and to move the adversary closer to achieving his objectives.
More specifically, the adversary uses built-in Windows tools or legitimate third-party
administration tools to discover internal host and network resources, and to discover information
such as accounts7, permissions groups8, processes9, services10, network configuration11, and
nearby network resources1213. The remote operator may then bulk-capture cached authentication
credentials14 using Invoke-Mimikatz15, a Windows PowerShell®16 wrapper for the popular
Mimikatz [8] tool that allows the tool to run without having to write an executable to the
computer’s hard drive. [9] Lateral movement from one computer to another may then occur after
enough information is gathered, which may typically happen using mapped Windows admin
shares17 and remote Windows (Server Message Block [SMB]) file copies18 coupled with remotely
scheduled tasks19. With each increased access, the adversary finds documents of interest within
4 ATT&CK: T1036 – Defense Evasion/Masquerading
5 ATT&CK: T1066 – Indicator Removal from Tools
6 ATT&CK: T1059 – Execution/Command-Line Interface
7 ATT&CK: T1087 – Discovery/Account Discovery
8 ATT&CK: T1069 – Discovery/Permission Groups Discovery
9 ATT&CK: T1057 – Discovery/Process Discovery
10 ATT&CK: T1007 – Discovery/System Service Discovery
11 ATT&CK: T1016 – Discovery/Local Network Configuration Discovery
12 ATT&CK: T1049 – Discovery/Local Network Connections Discovery
13 ATT&CK: T1018 – Discovery/Remote System Discovery
14 ATT&CK: T1003 – Credential Access/Credential Dumping
15 ATT&CK: T1064 – Defense Evasion/Scripting
16 ATT&CK: T1086 – Execution/PowerShell
17 ATT&CK: T1077 – Lateral Movement/Windows Admin Shares
18 ATT&CK: T1105 – Lateral Movement/Remote File Copy
19 ATT&CK: T1053 – Execution/Scheduled Task
3
©©22001177 TThhee MMIITTRREE CCoorrppoorraattiioonn.. AAllll rriigghhttss rreesseerrvveedd..
Approved for Public Release; Distribution Unlimited. Case Number 16-3713.
the network20212223. The adversary then stages these documents to a central location24, compresses25
and encrypts26 the compressed file through a remote command-line shell using utilities such as
RAR, and finally, exfiltrates or exports them from the victim’s host computer, via a well-formed
Hypertext Transfer Protocol (HTTP) 27 session inside Secure Sockets Layer/Transport Layer
Security (SSL/TLS)28. Thus, the adversary has committed cyber theft of critical documents of
interest and value from the victim computer and network to his own remote computer where he
can analyze and use the exfiltrated information at his convenience.
1.2 Shortcomings of Contemporary Approaches for Detection
Contemporary network security approaches have trouble detecting an APT similar to the one in
the aforementioned hypothetical example. Most AV applications may not reliably detect custom
tools because these tools have been tested by adversaries against various products before use and
may even contain obfuscation techniques used to evade other types of malware detection. [10]
Malicious remote operators also have the ability to use legitimate functionality on systems they
compromise, essentially “living off the land” [11] to avoid detection since many defensive tools
do not collect sufficient data to detect this kind of malicious use of otherwise appropriate system
behavior.
Other current approaches to network security, such as threat intelligence feed subscription or
sharing may not help with detecting the use of adversary infrastructure, because adversary
indicators can change too rapidly. Typical network traffic inspection will not be useful either,
since the APT’s traffic, such as that described in the previous hypothetical example, is encrypted
by valid SSL. SSL interception may be useful, but without a priori knowledge of components
with known signatures (i.e., a unique pattern that exists in network traffic that can be used to
detect a specific kind of known malicious activity) in the correctly formed HTTP traffic, finding
this level of malicious activity and distinguishing it from benign network behavior is simply too
difficult. The shortcomings of these contemporary approaches led MITRE to develop a different
method for detecting APTs over the course of the multi-year research effort by focusing on an
adversary’s post-compromise behavior using the ATT&CK threat model.
20 ATT&CK: T1083 – Discovery/File and Directory Discovery
21 ATT&CK: T1005 – Collection/Data from Local System
22 ATT&CK: T1025 – Collection/Data from Removable Media
23 ATT&CK: T1039 – Collection/Data from Network Shared Drive
24 ATT&CK: T1074 – Collection/Data Staged
25 ATT&CK: T1002 – Exfiltration/Data Compressed
26 ATT&CK: T1022 – Exfiltration/Data Encrypted
27 ATT&CK: T1071 – Command and Control/Standard Application Layer Protocol
28 ATT&CK: T1032 – Command and Control/Standard Cryptographic Protocol
4
©©22001177 TThhee MMIITTRREE CCoorrppoorraattiioonn.. AAllll rriigghhttss rreesseerrvveedd..
Approved for Public Release; Distribution Unlimited. Case Number 16-3713.
Threat-Based Security Approach
MITRE’s threat-based approach to network compromise detection uses a behavioral
methodology and is guided by five principles that were developed over the course of its research.
These principles describe critical tenets of an effective threat-based approach to network
security. They are summarized here (Figure 1) and explained in further detail throughout the rest
of this section.
Principle 1: Include Post-Compromise Detection – Over time, previously effective perimeter and
preventative defenses may fail to keep persistent threats out of a network. Post-compromise