连接PG
（图形化、命令行）pgadmin , dms , psql
阿里云
digoal
目录
• pgadmin
• DMS
• psql cli
下载 pgadmin
• https://www.pgadmin.org/
• https://www.pgadmin.org/download/
• https://www.pgadmin.org/download/pgadmin-4-macos/
• https://www.postgresql.org/ftp/pgadmin/pgadmin4/v4.16/macos/
• https://ftp.postgresql.org/pub/pgadmin/pgadmin4/v4.16/macos/pgadmin4-4.16.dmg
安装 pgadmin
安装 pgadmin
安装 pgadmin
启动 pgadmin 服务
设置 pgadmin 密码
切换语言(可选)
停止 pgadmin服务
创建RDS PG实例
• https://www.aliyun.com/
创建RDS PG实例
创建RDS PG实例
创建RDS PG实例
创建RDS PG实例
创建RDS PG实例
创建RDS PG实例
创建RDS PG实例
创建RDS PG实例
创建RDS PG实例
创建RDS PG实例
创建RDS PG实例
高可用版支持cloud dba，秒级监控，HA等特性。
配置RDS PG实例防火墙
配置RDS PG实例防火墙
RDS PG控制台创建用户
RDS PG控制台创建用户
RDS PG控制台创建用户
RDS PG控制台创建数据库
RDS PG控制台创建数据库
RDS PG控制台创建数据库
使用DMS连接数据库
使用DMS连接数据库
使用DMS连接数据库
使用DMS连接数据库
使用DMS连接数据库
DMS对PG12的支持还有一些兼容性问题，可以先忽略。
使用DMS连接数据库
创建测试表
使用DMS连接数据库
Table显示问题
使用DMS连接数据库
写入100万测试数据
使用DMS连接数据库
查询
申请RDS PG公网地址
申请RDS PG公网地址
PG 逻辑结构
• https://github.com/digoal/blog/blob/master/201605/20160510_01.md
PG 权限体系
https://www.postgresql.org/docs/devel/static/sql-grant.html
使用pgadmin连接数据库
使用pgadmin连接数据库
使用pgadmin连接数据库
使用pgadmin连接数据库
使用pgadmin连接数据库(ssl连接)
使用pgadmin连接数据库(ssl连接)
使用pgadmin连接数据库(ssl连接)
使用pgadmin连接数据库(ssl连接)
使用pgadmin连接数据库(ssl连接)
pgadmin结构了解
层次关系非常清晰。
pgadmin结构了解
注意：关注你当前用哪个用户，连接了哪个实例，当前连在哪个数据库中。
pgadmin 常用操作了解
• 注意：
• 不要随便count。
• 不要查询大表不带limit，会返回所有记录。
• Why?
• 默认没有开游标，会返回所有记录。
• 万一执行了查询大表返回所有记录，怎么停止？
pgadmin 常用操作了解
pgadmin 常用操作了解
pgadmin常用操作了解
• 逻辑备份（表级别、库级别、schema级别，可选择结构或数据备
份）
• 逻辑还原
pgadmin常用操作了解(备份)
pgadmin常用操作了解(备份)
pgadmin常用操作了解(备份)
pgadmin常用操作了解(备份)
pgadmin常用操作了解(备份)
如果有报错，查询报错原因，通常可能是权限问题。
pgadmin常用操作了解(备份)
如果有报错，查询报错原因，通常可能是权限问题。
pgadmin常用操作了解(恢复)
pgadmin常用操作了解(恢复)
pgadmin常用操作了解(恢复)
pgadmin常用操作了解(恢复)
• 恢复失败通常可能和权限、用户缺失、对象命名冲突等有关。
目录
• pgadmin
• DMS
• psql cli
psql cli 客户端 安装(Linux)
• 申请 ecs
• 压测性能建议2c以上，否则客户端会成为瓶颈。
• 与RDS 在相同vpc，同region，相同az。
• 镜像选择
• centos 7.7 x64
• 其他默认
psql cli 客户端 安装(Linux)
• yum install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
• yum install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-
latest.noarch.rpm
• yum install -y postgresql12
• su – postgres
• vi .bash_profile
export LANG=en_US.utf8
export PGHOME=/usr/pgsql-12
export LD_LIBRARY_PATH=$PGHOME/lib:/lib64:/usr/lib64:/usr/local/lib64:/lib:/usr/lib:/usr/local/lib:$LD_LIBRARY_PATH
export PATH=$PGHOME/bin:$PATH:.
export MANPATH=$PGHOME/share/man:$MANPATH
psql cli 客户端 安装(Linux)
安装包的内容
psql cli 客户端 使用(Linux)
psql cli 客户端 使用(Linux)
• psql
postgresql://digoal@hostname:3433/db1?sslmode=prefer\&pass
word=pwd
• 连接参数解释：
• https://www.postgresql.org/docs/12/libpq-connect.html
psql cli 客户端 使用(Linux)
• export PGHOST=pgm-bp17o7543xnoxjmt129310.pg.rds.aliyuncs.com
• export PGPORT=3433
• export PGDATABASE=db1
• export PGUSER=digoal
• export PGPASSWORD=pwd
psql 老年人重要命令
• psql 老年人技巧
• \?
• TAB 键
• \h
psql 老年人重要命令
• rpm -ql postgresql12|less -i
• man
• 支持所有sql语法
• 例如
• man CREATE_TABLE
psql 常用操作
• 打印sql耗时
• \timing
• 切换数据库
• \c
• 有哪些数据库，分别占用多少空间
• \l+
• 当前数据库有哪些schema
• \dn+
• 当前默认路径
• show search_path
• 表，权限，以及占用的空间
• \dt+
• 表结构
• \d tablename
• 安装了哪些插件模块
• \dx
psql 常用操作
• 导出rds pg数据到ecs本地
• https://github.com/digoal/blog/blob/master/201805/20180516_03.md
• https://github.com/digoal/blog/blob/master/201805/20180510_01.md
db1=> \copy test to '/tmp/test.out';
COPY 1000000
Time: 469.157 ms
psql 常用操作
• 将ecs本地数据导入到rds pg
• https://github.com/digoal/blog/blob/master/201805/20180516_03.md
• https://github.com/digoal/blog/blob/master/201805/20180510_01.md
db1=> truncate test;
TRUNCATE TABLE
Time: 31.440 ms
db1=> \copy test from '/tmp/test.out';
COPY 1000000
Time: 1455.269 ms (00:01.455)
psql 常用操作
• 不落地将数据导入到rds pg
• https://github.com/digoal/blog/blob/master/201809/20180911_01.md
编辑密码文件
vi ~/.pgpass
主机1:端口:数据库:用户:密码
主机2:端口:数据库:用户:密码
chmod 400 ~/.pgpass
单个事务倒入，有任何错误都会导致全部回滚
nohup pg_dump -F p -h 主机1 -p 端口 -U 用户 -d 数据库 | psql -h 主机2 -p 端口 -U 用户 -1 数据库 >./imp.log1 2>&1 &
有错误不会导致全部回滚
nohup pg_dump -F p -h 主机1 -p 端口 -U 用户 -d 数据库 | psql -h 主机2 -p 端口 -U 用户 数据库 >./imp.log2 2>&1 &
一期开课计划(PG+MySQL联合方案)
• - 2019.12.30 19:30 RDS PG产品概览，如何与MySQL结合使用
• - 2019.12.31 19:30 如何连接PG，GUI，CLI的使用
• - 2020.1.3 19:30 如何压测PG数据库、如何瞬间构造海量测试数据
• - 2020.1.6 19:30 MySQL与PG类型、语法、函数等对应关系
• - 2020.1.7 19:30 如何将mysql数据同步到PG（dts）
• - 2020.1.8 19:30 PG外部表妙用 - mysql_fdw, oss_fdw（直接读写MySQL数据、冷热分离）
• - 2020.1.9 19:30 PG应用场景介绍 - 并行计算，实时分析
• - 2020.1.10 19:30 PG应用场景介绍 - GIS
• - 2020.1.13 19:30 PG应用场景介绍 - 用户画像、实时营销系统
• - 2020.1.14 19:30 PG应用场景介绍 - 多维搜索
• - 2020.1.15 19:30 PG应用场景介绍 - 向量计算、图像搜索
• - 2020.1.16 19:30 PG应用场景介绍 - 全文检索、模糊查询
• - 2020.1.17 19:30 pg 数据分析语法介绍
• - 2020.1.18 19:30 pg 更多功能了解：扩展语法、索引、类型、存储过程与函数。如何加入PG技术社群
技术社群
PG技术交流钉钉群(3500+人)