### Top 10 Locations Serving Malware in Limewire and OpenFT

**Table 7: Top 10 Locations Serving Malware in Limewire**

| IP Address | Infected Files | Clean Responses |
|------------|----------------|-----------------|
| 24.185.43.12 | 101 | 4512 |
| 200.193.133.181 | 12 | 91 |
| 68.199.111.60 | 24 | 83 |
| 24.108.148.47 | 1 | 63 |
| 67.70.44.58 | 1 | 50 |
| 24.73.2.236 | 23 | 44 |
| 200.63.211.100 | 3 | 42 |
| 69.157.73.229 | 1 | 33 |
| 67.8.149.155 | 2 | 32 |
| 69.253.47.181 | 1 | 30 |

**Table 8: Top 10 Locations Serving Malware in OpenFT**

| IP Address | Infected Files | Clean Responses |
|------------|----------------|-----------------|
| 24.185.43.12 | 1 | 55 |
| 200.193.133.181 | 1 | 0 |
| 68.199.111.60 | 1 | 3 |
| 24.108.148.47 | 1 | 8 |
| 67.70.44.58 | 1 | 11 |
| 24.73.2.236 | 2 | 99 |
| 200.63.211.100 | 2 | 2 |
| 69.157.73.229 | 1 | 23 |
| 67.8.149.155 | 1 | 11 |
| 69.253.47.181 | 1 | 0 |

### Analysis of Malware Sources in Limewire and OpenFT

In Limewire, the sources of malware are also serving good files, though in smaller numbers in most cases. In OpenFT, most of the top 10 locations serving malware are also serving good files, but two are not. Notably, none of the top 10 sources of malicious files in OpenFT are among the top 10 sources of good downloads. In Limewire, several of the top malicious sources are also top good sources, although all of these are private IP addresses. The use of private IP addresses, NAT, and DHCP makes it impossible to determine if the files are truly coming from the same host.

A total of only 1.5% of all responses in Limewire come from private IP addresses, but they are responsible for 20% of failed downloads and a disproportionately high amount (28%) of malicious responses. The top source of infected responses in Limewire, 192.168.1.11, is a private address and is responsible for 7.8% of infected replies. In OpenFT, the top offender, 24.185.43.12, is responsible for 67.2% of infected replies and is registered to a New York (USA) based cable Internet provider.

In Limewire, there is a significant difference between the number of hosts serving individual infected files versus clean files. On average, 22.9 distinct IP addresses serve each infected file, while only 6.2 serve each clean file. In OpenFT, the trend is somewhat reversed, with 3.8 hosts serving each clean file and only 1.5 for infected files.

### Filtering Malware

#### 4.1 Filtering in Limewire

Limewire uses three criteria to filter potentially malicious responses:
1. The file name or metadata does not match the query.
2. The extension of the returned file does not match the requested file type.
3. Limewire believes the response contains the Mandragore worm.

In our observations, only 22 responses, all with the filename "control.exe," were classified as the Mandragore worm by Limewire. However, ClamAV did not detect any malware in this file, suggesting that this check may be outdated.

Limewire determined that 3.5% of responses contained malware because they did not match the query sent, resulting in a false positive rate of 15.6%. Similarly, 3.0% of responses containing malware were determined by Limewire not to match the requested file type, with a false positive rate of 3.5%. We conclude that the filtering checks in Limewire are inadequate, producing nearly 17% false positives.

#### 4.2 File Size-based Filtering

We investigated a simpler and more effective filtering mechanism based on file sizes. Table 9 shows that much of the malware occurs at a few distinct file sizes, with a large proportion at a single size. This suggests that file size can be a good indicator of malware. We hypothesize that adding filters to discard responses whose size matches that of known malware can be an effective heuristic to block malware on P2P systems.

**Table 9: Number of File Sizes and the Percent of Responses Containing Each Malware at the Most Common File Size in Both Limewire and OpenFT (for Top 5 Malware)**

| Name | Limewire | OpenFT |
|------|----------|--------|
| VB-100 | 99.95% | 99.22% |
| Alcan.D | 99.85% | 96.29% |
| VB-16 | 99.98% | 100% |
| Poom.A | 93.13% | 99.67% |
| Somefool.P | 99.09% | 100% |

**Table 10: False Positives for Our Size-based Filter for Top 5 Malware**

| Name | Limewire | OpenFT |
|------|----------|--------|
| VB-100 | 0.10% | 0.39% |
| Alcan.D | 0.07% | 1.30% |
| VB-16 | 0.04% | 86.2% |
| Poom.A | 0% | 0% |
| Somefool.P | 0% | 0% |

### Limitations and Future Work

This study provides an initial look at malware in P2P systems and how to filter responses containing malware. The current study has several limitations:
1. A relatively short duration of the study.
2. Observing only malware returned in search queries, which may differ from the distribution in downloaded files and all available files.
3. Malware could be present in file formats other than executable, archival, and Microsoft Office.
4. ClamAV may fail to detect some malware.
5. It was not possible to observe malware in other popular P2P networks that are either not decentralized or are not open source.

We plan to undertake a more detailed study in the future to address these limitations.

### Acknowledgements

We would like to thank Rob Henderson for support in data collection. Michel Salim and Nikhil Balchandani worked on the class project that led to this paper. Their input is appreciated.

### References

[1] Computer Associates Virus Information Center. http://www3.ca.com/securityadvisor/virusinfo.
[2] The giFT Project Homepage. http://gift.sourceforge.net.
[3] Gnutella Protocol Specification. http://www.the-gdf.org/wiki/index.php?title=Gnutella_Protocol_Development.
[4] K. Gummadi, R. Dunn, S. Saroiu, S. Gribble, H. Levy, and J. Zahorjan. Measurement, modeling, and analysis of peer-to-peer file-sharing workload. In ACM SOSP, 2003.
[5] L. Guo, S. Chen, Z. Xiao, E. Tan, X. Ding, and X. Zhang. Measurement, analysis, and modeling of BitTorrent-like systems. In ACM SIGCOMM Internet Measurement Conference (IMC), 2005.
[6] T. Holgers, D. Watson, and S. Gribble. Cutting through the confusion: A measurement study of homograph attacks. In USENIX Annual Technical Conference (USENIX), 2006.
[7] J. Liang, R. Kumar, and K. W. Ross. The FastTrack overlay: A measurement study. Computer Networks, 50(6):842–858, 2006.
[8] LimeWire Homepage. http://www.limewire.org.
[9] D. Moore, V. Paxson, S. Savage, C. Shannon, S. Staniford, and N. Weaver. Inside the Slammer worm. In IEEE Security and Privacy, 2003.
[10] D. Moore, C. Shannon, and J. Brown. Code Red: A case study on the spread and victims of an internet worm. In ACM/USENIX IMW, 2002.
[11] A. Moshchuk, T. Bragin, S. Gribble, and H. Levy. A crawler-based study of spyware on the web. In Internet Society Network and Distributed System Security Symposium (NDSS), Feb. 2006.
[12] S. Saroiu, S. Gribble, and H. Levy. Measurement and analysis of spyware in a university environment. In USENIX Networked Sytems Design and Implementation (NSDI), 30 Mar. 2004.
[13] S. Shin, J. Jung, and H. Balakrishnan. Malware prevalence in the Kazaa file-sharing network. In ACM SIGCOMM Internet Measurement Conference (IMC), 2006.
[14] Sophos Virus Analyses. http://www.sophos.com/virusinfo/analyses.
[15] Symantec Security Response. http://www.symantec.com/avcenter.
[16] Tomasz Kojm. ClamAV Homepage. http://www.clamav.net.
[17] Kaspersky Lab Virus Encyclopedia. http://www.viruslist.com/en/viruses/encycolpedia.
[18] V. Yegneswaran, P. Barford, and J. Ullrich. Internet intrusions: Global characteristics and prevalence. In ACM SIGMETRICS, 2003.
[19] W. Yu. Analyze the worm-based attack in large scale P2P networks. 8th IEEE International Symposium on High-Assurance Systems Engineering, pages 308–309, Mar. 2004.
[20] L. Zhou, L. Zhang, F. McSherry, N. Immorlica, M. Costa, and S. Chien. A first look at peer-to-peer worms: Threats and defenses. In Proceedings of the IPTPS, Feb. 2005.