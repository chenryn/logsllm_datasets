document_list=
document_name=help.gif
可以从响应中看到，Web服务器上可用文档的列表返回给了FrontPage客户端。在
微软公司的网站上可以找到各种命令和响应的完整列表。
19.1.4 FrontPage的安全模型
任何直接访问Web服务器内容的发布系统都要非常注意其行为的潜在安全影响。
FPSE在极大程度上是依赖Web服务器来提供安全性的。
FPSE安全模型定义了3种用户：管理员、作者以及浏览者，其中管理员拥有完全
控制权。所有权限都是累积的，也就是说，所有的管理员都能编写和浏览FrontPage
的网站。类似地，所有作者都有浏览权限。
对于给定的由FPSE扩展的网站，管理员、作者以及浏览者的列表都要定义好。所
有的子Web可以从根Web继承权限，也可以自行定义。对于非IIS的Web服务器，
所有的FPSE程序都要保存在标记为“可执行”的目录中（所有其他CGI程序也都
有同样的限制）。Fpsrvadm，FrontPage的服务器管理员实用工具，可以用来进行这
种工作。在IIS服务器上，则可用Windows操作系统自身集成的安全模型。
在非IIS服务器上，Web服务器的访问控制机制负责指定能够访问指定程序的用户。
在Apache和NCSA的Web服务器上，访问控制文件名为.htaccess；在Netscape服
务器上，文件名是.nsconfig。访问控制文件将用户、用户组以及IP地址与不同级
别的权限关联起来：GET是读权限，POST是写权限，等等。例如，为了使用户在
Apache的Web服务器上具有作者权限，.htaccess文件应当允许该用户对author.exe
进行POST。这些访问规范文件常常是以目录为单位来定义的，这为权限定义提供
428 了极大的灵活性。
在IIS服务器上，权限是通过给定根Web目录或子Web的根目录上的ACL（Access
Control List，访问控制列表）来制定的。当IIS收到请求时，首先登录，并模拟用
户，接着发送请求到上述三个DLL（Dynamic Link Library，动态链接库）之一。收
到请求的DLL根据目标文件夹上定义的ACL检查所扮演用户的证书。如果检查通
过，请求的操作就由扩展DLL来执行。否则，就向客户端发回“permission denied”
448 ｜ 第19章
（没有权限）报文。由于IIS和Windows操作系统的安全管理紧密集成在一起，所
以可以使用用户管理器进行细粒度的控制。
尽管有着精密的安全模型，启用FPSE还是背负了带来显著安全风险的恶名。在多
数情况下，这是由于网站管理员的粗心大意引起的。然而，早期版本的FPSE的确
有严重的安全漏洞，从而引起了这种安全风险的担忧。完整地实现严密的安全模型
困难重重，也加剧了这种担忧。
19.2 WebDAV与协作写作
WebDAV（Web Distributed Authoring and Versioning，分布式写作与版本管理）为
Web发布增添了新的内容——协作。当前，最常见的协作实践（电子邮件或分布式
文件共享）显然没有什么技术含量。这种实践很不方便还容易出错，而且几乎没有
过程控制。请考虑运行一个为多国用户服务的汽车制造商的多语种网站。很容易看
出，它非常需要安全可靠的带有发布原语和协作原语（比如锁定和版本管理等）的
健壮系统。
WebDAV（作为RFC 2518发表）专注于对HTTP进行扩展，以提供协作写作的适
宜平台。目前是在IETF的组织下，得到了许多厂商的支持，包括Adobe、Apple、
IBM、Microsoft、Netscape、Novell、Oracle以及Xerox。
19.2.1 WebDAV的方法
WebDAV定义了一些新的HTTP方法并修改了其他一些HTTP方法的操作范围。
WebDAV新增的方法如下所述。
• PROPFIND
获取资源的属性。
• PROPPATCH
在一个或多个资源上设定一个或多个属性。
• MKCOL
创建集合。
• COPY 429
从指定的源端把资源或者资源集合复制到指定的目的地。目的地可以在另一台机
器上。
发布系统 ｜ 449
• MOVE
从指定的源端把资源或者资源集合移动到指定的目的地。目的地可以在另一台
机器上。
• LOCK
锁定一个或多个资源。
• UNLOCK
把先前锁定的资源解锁。
WebDAV修改的HTTP方法有DELETE、PUT以及OPTIONS。本章稍后将详细
讨论新方法和修改后的方法。
19.2.2 WebDAV与XML
WebDAV的方法通常都需要在请求和响应中关联大量的信息。HTTP通常用报文首
部来交换这类信息。然而，只在首部传输必要的信息已经暴露了一些局限性，包括
难以有选择地对请求中的多个资源应用首部信息、不利于表示层次结构等。
WebDAV借助了XML解决这个问题，它是一种元标记语言，提供了描述结构化数
据的格式。XML为WebDAV提供了以下解决方案。
• 对那些描述数据处理方式的指令进行格式化的方法。
• 在服务器上对复杂的响应进行格式化的方法。
• 交换与所处理的集合和资源有关的定制信息的方法。
• 承载数据自身的灵活工具。
• 对大多数国际化问题的健壮解决方案。
习惯上会把XML文档里引用的方案定义保存在一个DTD（Document Type Definition，
文档类型定义）文件中。因此，试图解释XML文档时，可以根据其中的DOCTYPE
定义项得到和这份XML文档相关的DTD文件名。
WebDAV定义了一个显式的XML名字空间——“DAV:”。简单地说，XML的名字
空间就是元素或属性的名字的集合。名字空间限定了嵌入的名字在域内必须是唯一
的，这样就可以避免名字冲突。
WebDAV规范（也就是RFC 2518），定义了完整的XML方案。预定义的方案允许
430 解析软件不必读取DTD文件，而是根据预定义的XML方案来解释。
450 ｜ 第19章
19.2.3 WebDAV首部集
WebDAV的确引入了一些HTTP首部来增强新方法的功能。本节对其进行了简要介
绍，请从RFC 2518中获取更多信息。新的首部如下所示。
• DAV
用于了解服务器的WebDAV能力。WebDAV 支持的所有资源在响应OPTIONS
请求时都要含有此首部。更多细节参见19.2.14节。
DAV = "DAV" ":" "1" ["," "2"] ["," 1#extend]
• Depth
这是一个关键元素，用于把WebDAV扩展到支持含有多级层次关系的资源组。
参见19.2.10节以获取更多关于集合的详细解释。
Depth = "Depth" ":" ("0" | "1" | "infinity")
我们来看一个简单的例子。假设有个目录DIR_A，其中有文件file_1.html和
file_2.html。如果某方法设置了 Depth:0，此方法就只作用到目录 DIR_A 自
身；如果设置了Depth:1，就作用到目录DIR_A及其包含的文件file_1.html和
file_2.html。
Depth首部对WebDAV定义的许多方法进行了修饰。用到Depth首部的方法
有：LOCK、COPY以及MOVE。
• Destination
定义这个首部是用来辅助COPY或MOVE方法标识目标URI的。
Destination = "Destination" ":" absoluteURI
• If
定义的唯一一个状态令牌是锁定令牌（参见19.2.5节）。If首部定义了一组条
件，如果这些条件都取值为非，请求就失败。类似COPY和PUT等方法可以在
If首部中指定前置条件，使其有条件地适用。在实践中，最常见的需要满足的
前置条件是先获得锁。
If ="If"":" (1*No-tag-list | 1*Tagged-list)
No-tag-list = List
Tagged-list = Resource 1*List
Resource = Coded-URL
List = "(" 1*(["Not"](State-token | "[" entity-tag "]")) ")"
State-token = Coded-URL
Coded-URL = ""
• Lock-Token
UNLOCK 方法需要用这个首部指定要删除的锁。LOCK 方法的响应中也有
发布系统 ｜ 451
Lock-Token首部，载有关于锁定令牌的必须信息。
431 Lock-Token ="Lock-Token"":"Coded-URL
• Overwrite
用于COPY和MOVE方法，指定是否要覆盖目标。参见本章后面关于COPY和
MOVE方法的详细介绍。
Overwrite ="Overwrite"":" ("T" |"F")
• Timeout
客户端用这个请求首部指定要求锁定的超时值。参见19.2.5节获取更多信息。
TimeOut = "Timeout" ":" 1#TimeType
TimeType = ("Second-" DAVTimeOutVal | "Infinite" | Other)
DAVTimeOutVal = 1*digit
Other = "Extend" field-value
我们已经概述了WebDAV的意图及其实现，下面来仔细看看它提供的各种功能。
19.2.4 WebDAV的锁定与防止覆写
根据定义，协作要有不止一个人在给定的文档上工作。图19-3展示了和协作相关的
固有问题。
在这个例子中，作者A和B联合编写一份规范。A和B各自独立地对文档做了一些
修改。A把更新的文档上传到仓库。之后，B也把自己的版本提交到仓库。不幸的
是，由于B压根不知道A的修改，他没有把自己的版本与A的版本进行合并，从
432 而导致A的修改丢失。
为了改善这种问题，WebDAV支持锁定的概念。但单靠锁定不能完全解决这个问
题，还需要版本管理和消息传送才能提供完整的解决方案。
WebDAV支持两种类型的锁：
• 对资源或集合的独占写锁；
• 对资源或集合的共享写锁。
独占写锁保证只有锁的拥有者有写权限。这种锁完全消除了潜在的冲突。共享写锁
允许多个人在某个给定的文件上工作。这种锁定机制在多名作者对各自的活动都知
晓的环境下可以很好地工作。WebDAV通过PROPFIND方法提供了属性发现机制，
可以判断对锁定的支持和所支持的锁定类型。
452 ｜ 第19章
A的副本 B的副本
作者A 共享的文件仓库 作者B
B的副本
A发布…
作者A 共享的文件仓库 作者B
B也发布，并把
A的修改覆盖了。
作者A 共享的文件仓库 作者B
图19-3 丢失更新问题
WebDAV中有两个新方法支持锁定机制：LOCK和UNLOCK。
为了实现锁定，还需要有一种识别作者的机制。WebDAV采用的是摘要认证（参见
第13章）。
批准锁定时，服务器将域内唯一的令牌返回给客户端。与此相关的规范是
opaquelocktoken锁定令牌URI方案。当客户端随后要执行写操作时，它连接到
服务器并完成摘要认证步骤。一旦认证完成，WebDAV客户端就发出带有锁定令牌
的PUT请求。这样，只有正确的用户加上锁定令牌才可以完成写操作。
19.2.5 LOCK方法
WebDAV 中的一个强大特性是它能够允许单个 LOCK 请求锁定多个资源。
WebDAV的锁定不需要客户端保持与服务器的连接。
这是一个简单的LOCK请求示例： 433
LOCK /ch-publish.fm HTTP/1.1
Host: minstar
Content-Type: text/xml
User-Agent: Mozilla/4.0 (compatible; MSIE 5.0; Windows NT)
Content-Length: 201
发布系统 ｜ 453
AuthorA
提交的XML以元素作为其基元素。在结构中，有以下
3种子元素。
• 
指明锁定的类型。当前只有一种可选值，即write。
• 
指明这是独占锁还是共享锁。
• 
这个字段设置为当前持有锁的人。
下面是这个LOCK请求的成功响应：
HTTP/1.1 200 OK
Server: Microsoft-IIS/5.0
Date: Fri, 10 May 2002 20:56:18 GMT
Content-Type: text/xml
Content-Length: 419
AutherA