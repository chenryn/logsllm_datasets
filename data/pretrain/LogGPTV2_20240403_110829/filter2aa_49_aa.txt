Mysteries of the Phone 
System Past and Present
Patrick McNeil 
@unregistered436
Owen
@LinuxBlog
Views and opinions are those of Patrick 
& Owen and do not represent past, 
present, or future employers.
All Service Marks, Trademarks, and 
Copyrights belong to their respective 
owners.
"Get this and get it straight… 
Crime is a sucker’s road, and 
those who travel it wind up in the 
gutter, the prison, or the grave."
-Opening of the Philip Marlowe radio show
The Original Philip Marlowe - Humphrey 
Bogart from “The Big Sleep”,1946
(46 / 2 = 23)
Why are we doing this?
● Phreaks as the original electronics 
“hackers”
● It’s a way of thinking...
● VoIP wasn’t designed for security
● Mysteries of the past can help you 
understand the present - let us be 
your guide…
What we’ll cover
History
Info Leakage
Exploitation
Fraud & Abuse
PoC Tool Demo
Other 
Which may include famous 
movie stars and propaganda 
User Dialing
● Strowger switch - alternating current 
pulses & mechanical cylinder switch 
per digit
● First user dialing enabled - exchange 
name converted to number to dial in 
small area
Carrier Growth Drives Innovation
●
Burgeoning operator workforce growth
●
Panel & Crossbar “common control” built 
number in sender then processed
●
The 4A crossbar and card control
POP QUIZ!
●
Q: SF and MF - what tone critical? XXXX 
Hz?
●
Q: What was the design flaw that 
revolutionized the industry?
It’s TRUE mom, 
the DEF CON 
Goons are SO 
dreamy!
Introducing Asterisk!
Asterisk Created in 1999
-
Now developed by Digium
-
GPL
-
Latest Stable: 13.0.0 (24 October 2014; 4 months ago)
-
11.13.1 (20 October 2014; 4 months ago)
Numerous Books published
-
2005 - Building Telephony Systems with Asterisk (PACKT)
-
2007 - Asterisk for dummies published
-
2007 - Asterisk Hacking published
-
AsteriskBook (AsteriskDocs.org)
AMI
AGI (http://www.voip-info.org/wiki/view/Asterisk+AGI)
You can do some cool stuff with it.
Asterisk variants...
FreePBX
Asterisk@Home
TrixBox
PBX In a Flash
Elastix
AskoziaPBX
Asterisk for Raspberry Pi 
(http://www.raspberry-asterisk.org/)
Olivia de Havilland in The Dark Mirror, 1946
(46 / 2 = 23)
Attack vs Defense
Al Capone
J Edgar Hoover
Information Leakage
What: When a system that is 
designed to be used only by 
authorized parties reveals the 
usage, equipment, location, 
or entities using the system, 
etc. to an unauthorized party.
Rise of the Phreaks
Phreaks:
● Social engineered operators
● Phone techs
● In-band clicks & tones
● Open technical journals
● Exhaustive dialing of numbers
● Shared on looparounds & 
eventually conf calls
● Underground papers
The World Finds Out
● Secrets of the Little Blue Box, 1971 Esquire article introduced 
world to “Phreaking” - such as Joe Engressia, Mark Bernay, and 
John Draper 
● Phun stuff like joke-lines were a 
ToS violation
● See “Exploding the Phone” by 
Phil Lapsley
Photo taken from wideweb.com/phonetrips
Evolution of VoIP
● Common Channel 
Interoffice Signaling 
(CCIS)
● Personal computers came 
out, and if switches can use 
modems…
● IP enabled transport of 
ALL data, including voice
● Analog systems got IP cards 
● All IP developed PBX, with 
separate gateways for analog 
connections, consumer 
MTAs with analog ports, etc.
● Virtualization made PBX 
accessible to all
Information Leakage
Now: Still just as easy! The curious can play 
in a VM at home or get inexpensive trunk 
services. Just like early phreakers - read, 
listen, enumerate!
● Port scanning
● SIP stack & OS 
fingerprinting
● Extension enumeration
SIP & SDP
INVITE sip:PI:EMAIL SIP/2.0
Via: SIP/2.0/UDP 10.1.3.3:5060;branch=z9hG4bKb27061747269636b
From: “JConnor“ ;tag=18de4db33f
To: "19195551223" 
Call-ID: 19424e0d9187654209ed34db33f
CSeq: 1 INVITE
Max-Forwards: 70
User-Agent: BigTelcoVendor/R16.4.1.1
Supported: 100rel,timer,replaces,join,histinfo
Allow: INVITE,CANCEL,BYE,ACK,NOTIFY,REFER,OPTIONS,INFO,PUBLISH
Contact: “JConnor" 
Content-Type: application/sdp
Content-Length: 165
v=0
o=- 1 1 IN IP4 10.1.3.3
s=-
c=IN IP4 10.1.3.3
b=AS:64
t=0 0
m=audio 19001 RTP/AVP 0 127
a=rtpmap:0 PCMU/8000
a=rtpmap:127 telephone-event/8000
The Crypto That Time Forgot
REGISTER sip:192.168.1.123 SIP/2.0
Via: SIP/2.0/UDP 192.168.1.1:8166;branch=z9hG4bK-d8754z-
0be76a4b680f6408-1---d8754z-;rport
Max-Forwards: 70
Contact: 
To: 
From: ;tag=309f3210
Call-ID: YWM4NWQxNThiNGEwMjhmYTJhZmIwYzJiNjMxNTY1MjE
CSeq: 2 REGISTER
Expires: 3600
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY, MESSAGE, 
SUBSCRIBE, INFO
User-Agent: X-Lite 4.7.1 74247-647f3e8e-W6.1
Authorization: Digest 
username="1000",realm="asterisk",nonce="35e47ee9",uri="sip:192.168.1.1
23", response="33ac377e4d50ad6026837ef37b2d33ce",algorithm=MD5
Content-Length: 0
Information Leakage
● Google searches, DNS queries, job boards, and calls 
that go to voicemail or auto-attendant may  the type 
of phone system
● If Internet connected, a quick SIP OPTIONS or 
INVITE  reveals key info. User-Agent, Server, X-
headers, or other header presence (or lack of) tells me 
what you’re running.
● User or extension enumeration
● A quick vuln database scan tells me how to try to 
compromise your system
SIP VoIP info gathering tips
● Port scans - specify TCP & UDP, along with a port range 
to detect Asterisk AMI (5038) - outside of nmap defaults
● Scan slow to avoid rate based filters (-T)
● Use more than one tool, & mod default values. Ex: If 
using SIPVicious change default User-Agent in 
svhelper.py
● Scan with another SIP method such as INVITE or 
CANCEL
● Metasploit SIP scanner randomizes identifying fields
● Not many VoIP scanner projects maintained, but Viproy 
and Bluebox-ng ARE
Asterisk User-Agents
● 15MM SIP entries in dataset
● 52,420 containing “Asterisk”
● 10,776 are just “Asterisk PBX”
(top server UA in the list)
● 1,156  "Asterisk PBX 1.6.0.26-
FONCORE-r78"
- TrixBox!
Special thanks to Daniel Abreu for help with ZMap data import to ElasticSearch w/Kibana
As expected, LOTS of:
●
Insecure phones & MTAs
●
Old SMB systems from Cisco, 
Nortel, Avaya, etc.
Unexpected Finds:
●
NORTEL-DMS100-SS7-ISUPbr (?!)
●
5,785 hits on “camera”, 5467 in CN
●
Top user-agent - 3.6MM 
“FRITZ!OS” MTAs deployed in DE
●
LOTS of Huawei in Iran
Information Leakage Defense
●
Change the default SIP “User-Agent” string to fool attackers
o
In asterisk change sip_general_additional.conf “useragent=”
o
Or in FreePBX Web GUI > Settings > Asterisk SIP Settings 
> Go to “Other SIP settings” at bottom and enter 
“useragent” and “”
●
Block bad user agents & use rate limiting (See our Github)
●
Add “alwaysauthreject=yes” to sip_custom.conf & username <> 
extension
●
Implement fail2ban to block IPs that
o
Try to register to invalid extensions
o
Have a number of registration failures
o
Exceed a reasonable message rate
●
Use a security appliance that will block SIP scans
Exploitation
ex·ploi·ta·tion
(ĕk′sploi-tā′shən)
n.
1. The act of employing to the greatest possible 
advantage
2. Utilization of another person or group for selfish 
purposes
Exploitation
The phreaks used the weaknesses 
in the phone network to their 
greatest advantage, and used them 
to enable further exploration.
Exploitation
Nowadays. used for…
Pretty much anything
TrixBox
Immensely popular Asterisk front end
SourceForge Stats:
5.0 Stars (35)
Last Update: 2013-06-18