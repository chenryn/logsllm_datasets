== 记录查询
对于未能合并到Alert中的原始记录Event、以及是否受维护期影响，Cruxee也一样记录并支持搜索查看。事实上 Cruxee 接收到并成功执行映射策略的数据，都可以直接查询 Cruxee 索引。
记录查询页提供搜索框，时间趋势图和告警列表，用户可以点击'+'，查看记录详情。
可以对要查询的默认语句进行配置。
image::images/cruxee/cruxee-event-search.png[]
== 处理统计
通过设置时间（周/月/季度）和及时率，针对incident被处理的操作用户，展示该用户对incident的操作表现。由于不同公司对incident的处理完成时限要求不一样，可点击设置及时率的阈值。
image::images/cru-processing-statistics.png[]
在展示列表内，通过五个参数进行展示：
1.	处理事件总量：在时间和分组条件范围内，该用户处理或忽略的事件历史总量。
2.	高级事件数量：在时间和分组条件范围内，该用户处理或忽略的高级事件历史总量。
3.  高级事件及时处理量：在时间和分组条件范围内，该用户及时处理或忽略的高级事件历史总量。
4.	处理用时分布：分为30个区间，表示在时间和分组条件范围内，该用户处理或忽略每一条：事件的用时范围，以概率分布的直方图形式展现。其中第一个区间是用户最快处理或忽略的用时，最后一个区间是用户最慢处理或忽略的用时，可以鼠标悬停查看每个用时区间内用户处理的事件历史个数。
5.	高级事件及时率：
在时间范围内，按照选择的及时标准，针对于一级事件进行及时率的计算。其中及时标准分为：15分钟内，1小时内，当天处理和48小时内。即处理或忽略的用时在及时标准内的操作，都算及时。可以在表头操作小图标上点击切换。高级事件及时率=高级事件及时处理量/高级事件总量。
== 策略统计 
该页面可根据所选配置，包含时间（今天/周/月/季度）和计算方法，统计各合并策略分组内事件状态的等级分布，以及浮动涨跌幅。此外，页面还会统计系统内从原始记录收敛成告警，再合并成事件的压缩率情况，及事件的响应和恢复时长。
各分组通过点击下拉符号“”，默认为收起，可对不同组进行配置。在选择了与总控制项不同的内容情况下，总控制项勾选的特征会被分组内的配置参数取代。 
image::images/cru-strategy-statistics.png[]
如上图，每个合并策略类型的卡片内的统计内容主要分两部分：
1.	等级分布条：用来展示一个相对占比，且长度仅限用于该类型内的比较。当光标移动在长条上方时，显示光标位置的颜色对应等级的“事件数量”和“所占比率”。
2.  同/环比浮动：事件级别下事件统计个数在选定的时间条件内的增长率。例：时间条件选择"今天"，事件级别为"重要"的事件项，今天有5条，昨天有10条，则其"环比浮动"为-50%。
=== 默认值
1. 时间：默认以“今天”为展示页面，数据不足以计算同比、环比时，则显示“暂无数据”。
2. 同比环比：默认为均不选。
=== 同环比
假设今天（2017年6月15号，星期四，下午12:32）查看，则：
[options="header"]
|========
|同比|同比实例|环比|环比实例
|今天
|与上周的这天，从0点到当前时间的比较
|跟2017年6月8号0点到12:32的数据
|与昨天，0点到当前时间的比较
|跟2017年6月14号0点到12:32的数据
|周
|与本周从周一开始到今天对应的上个月相同的日期比较
|跟2017年5月12号0点到5月15号12:32的数据
|与上周从周一开始到今天周几的日期比较
|跟2017年6月5号0点到8号12:32的数据
|月
|与去年的本月一号到今天这段时间的比较
|跟2016年6月1号0点到15号12:32的数据
|与上个月1号到今天对应的上个月的相同日期比较
|跟2017年5月1号0点到15号12:32的数据
|季度
|跟去年的该季度的一号到今天这段时间比较。一年有四个季度，季度起始日分别为1月1日，4月1日，7月1日，10月1日
|跟2016年4月1号0点到6月15号12:32的数据
|上个季度的起始日到今天对应的上个季度的相同日期比较
|跟2017年1月1号0点到3月15号12:32的数据
|========
== 知识库
cruxee的知识库让运维人员在解决完故障事件后对解决方案，步骤，原因，工具等进行知识沉淀形成知识库，便于未来的知识检索，也可以基于事件来进行相关解决方案推荐。
image::images/cruxee/knowledge-base.png[]
=== 新建/编辑知识
知识创建有几个入口，一是在知识库页面点击“新建”或“编辑”按钮，即可开始配置或修改知识信息。
* 基本信息，按提示填入。
image::images/cruxee/kb-create-basic-info.png[]
* 事件描述。在富文本编辑器中，您可以像编辑 Word文档一样，进行文字的字体大小和颜色设置，粗细斜体下划线删除线设置，居中居上居下、左对齐右对齐设置，引用设置，代码块设置，数字列表符号列表设置，上传图片（支持png，jpg，jpeg，gif，bmp格式，单张图片最大支持100K），上传附件（支持 word、excel、ppt、pdf 等格式，单个附件最大支持20MB），设置超链接，清除格式，撤销重做等。
image::images/cruxee/kb-create-description.png[]
* 解决方案。解决方案和事件描述一样采用富文本编辑器进行编辑。
* 完成
知识库创建的另一个入口是通过事件管理页面，当某个故障事件解决后，点击更多操作标记为“解决”，会提示用户对此次事件的处理进行记录行程知识。
image::images/cruxee/kb-create-from-incident.png[]
点击新建进入知识库的新建，后续操作请参考上面知识库新建操作。
对于状态是关闭或解决的事件，之前如果没有创建知识，后面也可以通过事件管理页面的知识库操作进行知识的新建
image::images/cruxee/kb-operation-in-incident.png[]
=== 知识库事件关联/解除
可以对故障事件和知识库进行关联，后续可以对类似事件进行解决方案推荐。
当通过事件管理页面的标记为操作“解决”进行知识创建时，会自动对事件和知识库进行关联。
如果知识已经已经存在于知识库，可以对事件和知识进行手动关联。一种方式是在标记为操作“解决”时选择关联而不是新建，添加关联知识。
image::images/cruxee/incident-knowledge-correlation.png[]
也可以在知识库页面点击某项知识后面的“关联事件”操作。
image::images/cruxee/knowledge-correlation.png[]
搜索选取要关联的事件进行关联。
也可以在此页面对事件和知识库进行关联解除, 也可以在事件管理页面点击知识库操作，点击已关联知识进行接触。
image::images/cruxee/kb-operations-dismiss.png[]
选取你要解除的知识进行解除：
image::images/cruxee/kb-dismiss.png[]
注意，知识和事件是多对多的关系，也就是说一个知识可以关联多个事件，一个事件可以关联多个知识。
== 配置
从1.9开始，所有和告警合并相关的配置挪如配置-告警合并下，把原来放在告警合并中不属于告警合并的告警字段展示的配置移入配置-通用下。
下图展示了 Cruxee 用户上传的原始数据如何经过字段映射成为标准记录，并由字段预处理和智能去噪模型，收敛为相对独立的告警，最终基于时间、空间、拓扑等多维信息，合并成为一起故障事件的全流程及各个环节的配置入口。可以点击相应配置图标进入对应的具体配置页面。
image::images/cruxee-config-guard.png[]
=== 映射策略
映射策略是对原始接入的Event数据进行字段对齐、字段值归一化等基本操作。当原始接入的Event存在多种数据格式时（例如：由不同厂家产生的告警原始记录，具有不同的字段定义或字段值含义时），需要配置多个映射策略，在映射策略列表中展示了当前已配置的所有映射策略。
image::images/cruxee-event-mapping.png[]
映射策略在列表中按编号从小到大排列，相应的，每一条原始接入的Event也按照编号从小到大的顺序进行策略匹配：当命中一条映射策略的应用条件后，即按该映射策略的映射规则进行字段映射，完成映射后进入预处理策略，不再进行后续的映射策略匹配。用户可以在更多操作中，调整映射策略的编号顺序，从而调整映射策略的匹配优先级。
image::images/cruxee-event-mapping-config.png[]
映射策略的内容，包含：应用条件、映射规则和收敛标识字段三个主要部分。
==== 应用条件
应用条件决定了该映射策略是否适用于具体的原始告警记录Event。应用条件可以由一条或多条表达式组成，表达式之间可通过and/or组合。具体到一个表达式，由字段名、操作符、字段值组成，其中字段名可以选择常见的原始告警记录Event字段名，也可以灵活地输入其他非常见字段名；操作符支持 ==、!=、>、=、<=、like、not like 八种；字段值需要输入具体的数值或字符。
==== 映射规则
映射规则主要完成字段归一化和字段取值归一化两个操作。其中，summary、priority、source和event_time四个字段属于必须映射的字段，其他必要字段可通过添加按钮进行增加。
在进行字段映射时，首先输入来源字段名称，除了使用拼接方法映射字段之外，一般只能输入一个来源字段。其次，需要选择映射方法，目前 Cruxee 支持：重命名、枚举值对齐、拼接三种一般映射方法和时间戳识别、使用系统时间戳两种针对event_time字段的特殊映射方法。最后，需要配置映射目标字段名称（必须映射的四个字段属于默认配置）。下面针对不同的映射方法进行具体介绍：
1. 重命名：
将原始告警记录中的字段名，重命名为新的字段名，取值不作任何处理。是最基本的映射方法。
2. 枚举值对齐：
将原始告警记录中的字段名，重命名为新的字段名，同时，将原始字段中的取值一一映射为新的字段取值。需要额外配置字段的映射值。
+
image::images/cruxee-event-mapping-enum.png[]
+
3. 拼接：
将多个原始告警记录中的字段值，拼接为一个新的字段，需要额外配置用于拼接的连接符。
4. 时间戳识别：
只针对event_time字段映射生效，可将原始告警记录中的时间戳字段映射为新的event_time字段，同时，将源字段中的具体时间戳取值采用常见的时间戳正则表达式进行识别提取。需要额外配置时区，当时间戳识别无法解析时区信息时（例如：原始时间戳中只包含年月日时分秒，不包含时区信息时），即采用该时区配置作为默认时区。
5. 系统时间戳：
采用系统时间戳时，无需指定来源字段。只有当来源字段中不存在具体的时间戳信息时，才需要采用系统时间戳，此时，event_time采用cruxee接收此event的时间作为实际取值。
==== 收敛标识字段
对于每个映射处理后的记录，系统根据收敛标识字段中设置的一个或多个字段，提取记录的实际取值并拼接，用于记录去噪及记录收敛。即：只有在收敛标识字段中具有相同取值的原始告警记录，才可能收敛成为告警。在告警中，收敛标识字段的值，被称为告警源。
=== 预处理策略
经过映射策略处理后的Event，进入预处理策略环节。预处理策略，主要用于对Event进行数据解析、转换等复杂操作。在预处理策略列表中，同样按照编号从小到大的顺序排列着多条已配置的预处理策略；但与原始告警记录只选择命中一条映射策略不同，告警记录会按照编号从小到大依次尝试匹配预处理策略，每个匹配命中的策略均会进行处理；多条匹配命中的策略将按照编号从小到大链式处理。经过预处理策略处理或者未匹配命中任何预处理策略的Event，均会进入去噪策略环节。
image::images/cruxee-event-etl.png[]
配置一个预处理策略时，同样有应用条件、字段处理规则、收敛标识字段三个主要部分。
image::images/cruxee-event-etl-detail.png[]
字段处理规则按顺序执行，可以通过上下移动调整顺序。此外，可以点击"验证字段标准"，在弹层中按来源字段添加样例数据，验证处理规则是否能执行成功：
image::images/cruxee-event-etl-verify.png[]
预处理策略的应用条件和收敛标识字段与映射策略配置完全相同，不再赘述。下面详细介绍字段处理规则的具体配置内容。
==== 字段组合
根据现有的一至多个字段值组合成全新的字段内容，新字段的内容根据格式规则生成，规则中可以使用$1,$2,$3…来引用多个来源字段的值。
image::images/cruxee-event-etl-composite.png[]
==== 文本提取
使用正则表达式对来源字段的内容进行匹配（使用PatternGroup模式），经过匹配得到的文本（可能被提取为多个Group），按照输出字段的顺序一一对应进行输出。
image::images/cruxee-event-etl-textextract.png[]
==== 字典映射
使用来源字段的取值，与选中字典中基准字段的取值进行匹配，将匹配命中的扩展字段取值作为新的输出字段取值。
image::images/cruxee-event-etl-dict.png[]
==== 丢弃记录
一旦执行此规则，将不再进行后续处理，包括：本策略后续的规则、其他预处理策略、后续去噪及合并策略的处理等。但仍然可以在记录搜索中找到原始的记录。
image::images/cruxee-event-etl-drop.png[]
==== 过滤记录
可以设置一个或多个表达式作为过滤条件，当满足过滤条件时，该记录执行选中的后续动作，包括：跳转到后续预处理策略，当前策略的后续规则不再执行；或丢弃记录，当前策略和后续策略均不再执行，记录不进入后续处理环节。
image::images/cruxee-event-etl-filter.png[]
==== 按时间过滤
与过滤记录规则类似，按时间过滤仅用于对event_time字段的取值进行过滤条件判断。过滤条件可配置起止时间（时-分-秒）和具体生效的周天（周一、周二、……、周日）
image::images/cruxee-event-etl-timefilter.png[]
==== 匹配并输出
使用一个或多个正则表达式，对一个或多个来源字段进行尝试匹配。如果选择“包含”，在匹配命中时，将输出字段设置为对应值；如果选择“不包含”，则在匹配未命中时，将输出字段设置为对应值。当输出字段被成功赋值后，将不再进行后续尝试匹配。
image::images/cruxee-event-etl-match.png[]
==== 文本替换
对具体的来源字段取值，可采用精确匹配或者正则表达式匹配的方式进行匹配，当匹配成功时，将字段内容替换为输入的指定值。
image::images/cruxee-event-etl-textreplace.png[]
==== 字段赋值
可以选择将来源字段的取值作为新的输出字段取值，或者将具体的配置文本作为新的输出字段的取值。
image::images/cruxee-event-etl-field.png[]
==== 改变优先级
将告警记录Event的优先级替换为指定优先级。
image::images/cruxee-event-etl-priority.png[]
==== 文本拆分
将来源字段的取值，按照已配置的分隔符进行拆分，拆分后作为多个输出字段的取值。
image::images/cruxee-event-etl-textsplit.png[]