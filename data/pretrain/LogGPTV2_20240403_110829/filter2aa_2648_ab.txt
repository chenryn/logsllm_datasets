CTapMediationEntry ::= SEQUENCE { 
cTapMediationContentId Integer32, 
cTapMediationDestAddressType InetAddressType, 
cTapMediationDestAddress InetAddress, 
cTapMediationDestPort InetPortNumber, 
cTapMediationSrcInterface InterfaceIndexOrZero, 
cTapMediationRtcpPort InetPortNumber, 
cTapMediationDscp Dscp, 
cTapMediationDataType Integer32, 
cTapMediationRetransmitType Integer32, 
cTapMediationTimeout DateAndTime, 
cTapMediationTransport INTEGER, 
cTapMediationNotificationEnable TruthValue,
cTapMediationStatus RowStatus }
cTapMediationNotificationEnable OBJECT-TYPE
SYNTAX     TruthValue
MAX-ACCESS read-create
STATUS     current
DESCRIPTION
"This variable controls the generation of any notifications or
informs by the MIB agent for this table entry."
DEFVAL { true }
::= { cTapMediationEntry 12 }
The Audit Trail Problem exists in many architectures
 The “Athens Affair”
– Described in IEEE Spectrum Article – July 2007
– So we’re clear, no Cisco equipment was involved in this incident
– Occurred in 2004/2005
– Malware was installed on Ericsson cellular telephone switches
• Used “rootkit” like techniques to hide from switch operators
• Was discovered by Ericsson staff while auditing a core dump to isolate a bug
– Cellphones of Greek government officials were monitored
• At least 100 subjects
• Included the Greek Prime Minister
– Malware used Lawful Intercept code in the phone switch
• According to the IEEE article, the interface for managing intercepts was separate from 
the software that actually performed the intercepts
• The logs were kept in the management interface
• The separation of audit trails from the core functionality is a fundamental architectural 
flaw in a lot of Lawful Intercept technology 
Why is the audit trail problem a security issue?
Because allegations of misuse of the surveillance 
system cannot be investigated. 
What technology allows the user to turn 
the logs off?
UNIX Shells?
DHCP Servers?
SMTP Servers?
HTTP Servers?
RADIUS Servers?
European Data Retention Policies
 Directive on Mandatory Retention of Communications Traffic Data
– Enacted March 2006
– Requires service providers to retain for 6 months to 2 years
to trace and identify the source of a communication; 
to trace and identify the destination of a communication; 
to identify the date, time and duration of a communication; 
to identify the type of communication; 
to identify the communication device;
to identify the location of mobile communication equipment. 
Your use of the network must be recorded and is 
subject to investigation after the fact. 
Their surveillance of the network must not be 
recorded and cannot be audited. 
What is up with that? 
TAP-MIB – Flexibility of the Output Stream
CTapMediationEntry ::= SEQUENCE { 
cTapMediationContentId Integer32, 
cTapMediationDestAddressType InetAddressType, 
cTapMediationDestAddress InetAddress, 
cTapMediationDestPort InetPortNumber,
cTapMediationSrcInterface InterfaceIndexOrZero, 
cTapMediationRtcpPort InetPortNumber, 
cTapMediationDscp Dscp, 
cTapMediationDataType Integer32, 
cTapMediationRetransmitType Integer32, 
cTapMediationTimeout DateAndTime, 
cTapMediationTransport INTEGER, 
cTapMediationNotificationEnable TruthValue, 
cTapMediationStatus RowStatus }
cTapMediationTransport OBJECT-TYPE
SYNTAX     INTEGER {
udp(1),
rtpNack(2),
tcp(3),
sctp(4)
}
MAX-ACCESS read-create
STATUS     current
DESCRIPTION
"The protocol used in transferring intercepted data to the
Mediation Device. The following protocols may be supported:
udp:     PacketCable udp format
rtpNack: RTP with Nack resilience
tcp:     TCP with head of line blocking
sctp:    SCTP with head of line blocking "
::= { cTapMediationEntry 11 }
Packet Spoofing and Access Lists
 Full Out of Band management designs can limit access to SNMP
– Expensive
– SNMP connectivity is an indicator of network health
 Many Service Providers use SNMPv3 “Infrastructure” Access Control Lists
 The Interception Request is a single UDP packet – you could spoof it
– Obtaining or guessing the SNMPv3 “Engine” values is difficult but not 
theoretically impossible
– Engine values can be shared between hosts
 Attacker might want some interactivity anyway
– SNMPv3 Engine values can be obtained with a simple request
– Helpful error messages when trying to brute force credentials
But, ISP Service LANs are impenetrable!
1. No, they’re not. 
2. There are plenty of people who have legitimate access to the service LAN who 
are not supposed to be using lawful intercept. The lack of audit trails in this 
architecture are an invitation to insider misuse.
3. When we meet the attacker half way with functionality we build into the network, 
we lower the cost of their attack and hence increase its attractiveness. 
Said another way - if the lawful intercept system is easy to access from the 
service LAN this creates a motive to attack the network which might not exist if 
performing surveillance from that network was more difficult. 
Another kind of ACL
 SNMPv3 User-Group Access Control Lists
– Can be used to lock access to Lawful Intercept down to the IP address of the 
Mediation Device
– Generates an audit trail!
– Still susceptible to spoofing
– Ultimately useful when coupled with encryption
– Not well documented
Encryption
 “Although encryption is not necessarily a requirement, it is highly recommended…”
 SNMPv3 Encryption
– Protects you from CVE-2008-0960
– Insider attacks are a risk (spoofing, no audit trail, output stream goes anywhere)
 IP Sec ESP
– Mentioned in the Internet Draft for the TAP-MIB
– The only way to encrypt the output stream
– Only effective if coupled with a User-Group access control list
How practical is this attack? 
 What I think service providers are doing:
– Most service providers are using SNMPv3 “Infrastructure” IP Access Control Lists
– Some service providers were vulnerable to CVE-2008-0960
– Many service providers are not using encryption
– Few service providers are using SNMPv3 User-Group IP Access Control Lists
 What that means:
– SNMPv3 “Engine” values are impractical to obtain from source addresses that are
not in the “Infrastructure” Access Control List
– Attacks from addresses on that list are practical in many real world deployments
– The problem is particularly bad when coupled with CVE-2008-0960
Where should security issues be addressed?
Design
Implementation
Deployment
Recommendations for Proper Deployment 
 Make sure you’ve patched CVE-2008-0960!
 Use Encryption – specifically IP Sec
 Use a User-Group IP Access Control List to lock the Lawful Intercept user to the 
IP address of the Mediation Device
 Review your overall approach to protecting network infrastructure, the mediation 
device, and network management systems from attack
 If possible, build out of band management networks 
Recommendations for the User-based Security Model for SNMPv3
 Make authentication errors less helpful to an attacker
 Send traps or informs when authentication failures occur
 Make Engine Values more difficult to predict and share
–SYN-Cookies cannot be guessed and they are tied to a 
source address
–This will cut down on packet spoofing in SNMPv3
Recommendations for Lawful Intercept
 Use a different port
– Make it easier to filter 
– SNMP over TCP would help prevent spoofing
 Allow the router administrator to limit the addresses for the output stream
 Move notification control into the router configuration
– Network Administrators should not be able to use notifications to monitor 
surveillance, nor should they be able to direct copies of the output stream to 
unauthorized destination addresses they control
– Verifying notification and output stream address agreement between the router 
configuration and the interception request would prevent abuse by either party
– Multiple destinations could be configured for notifications about taps of varying 
sensitivity, and interception requests could select the appropriate one. 
What is going to happen in the future? 
 Illegal wiretapping used to be really easy
– Telco junction boxes were easy to access
– Frequency scanners could monitor wireless phones
 Illegal wiretapping has been getting harder
– Wireless systems have incorporated link layer encryption
– Tapping wired infrastructure increasingly requires expensive protocol analyzers
– Software defined radios might make some of this cheap again in the future
 We may never see perfect end-to-end Internet encryption
– People aren’t broadly adopting end-to-end encryption solutions, preferring point-to-point 
application layer or link layer encryption that is “baked in” and seamless
– Improving link layer encryption in wired and wireless systems will reduce illegal 
wiretapping 
Should we build lawful wiretapping infrastructure?
 The consensus view of academic security researchers is that the risks involved in creating 
permanent wiretapping infrastructure are too great.
– See Susan Landau and Whitfield Diffie
• Privacy on the line
 The consensus view of law enforcement is that they like to wiretap suspects.
– The question we get to ask may not be whether or not to build this infrastructure, but what 
kind of infrastructure we want to build. 
 Wiretapping can either be performed with temporary or permanent devices
– Temporary devices can be installed “out doors” where no audit trail exists
– Permanent infrastructure can take one of two forms:
• ETSI style systems, where minimization is performed by service providers
• “Klein Declaration” style systems, where minimization is performed by Law 
Enforcement/Intelligence
For example: The Klein Declaration
The Klein Declaration
 In 2006 Mark Klein filed a declaration in an EFF lawsuit over warrantless 
wiretapping
 The Klein Declaration provides a technical description of a telecommunications 
monitoring system alleged to be operated by the National Security Agency
 The Klein Declaration describes the use of a fiber-optic splitter to send the entire 
content of backbone links to a special monitoring room for analysis
 On the other hand, the Cisco Architecture for Lawful Intercept only collects the 
specific traffic flows requested by the LEA
• This allows the LEA to only collect information authorized by a warrant
• The Cisco Architecture is not a secret
• In these respects, the Cisco Architecture may protect personal privacy better
What kind of wiretapping infrastructure should we build?
 The key difference between the Klein and Cisco architectures is the presence of human 
checks and balances.
 The value of the service provider access control provided by ETSI style wiretapping 
infrastructure may be worth the risk of the sort of unauthorized access described in this talk
– This view runs against the grain of the consensus view of security researchers
– You cannot effectively control the use of portable protocol analyzers, but permanent 
infrastructure must have some kind of access control
– That access control may improve security if it is effective:
• We know that verification of warrants or other legal authority is taking place
• The architecture is open to the public for peer review
• Other avenues of access can be closed off
– The verification of legal authority needs to be credible
Peer Review Matters
 Cisco did the right thing by publishing their architecture for Lawful Intercept
 Lawful Intercept is a matter of public interest  
– It is helpful if people can see and understand how surveillance is performed
– The way that these systems perform minimization and prevent unauthorized 
use is a part of the checks and balances that ensure that the surveillance being 
performed is legally appropriate
 Technical peer review of Lawful Intercept architectures helps ensure that they are 
secure
 There are many architectures and vendor solutions for Lawful Intercept that have 
not been described in similar public documentation and have not been subjected 
to peer review
 We have no reason to suspect that technology we cannot review is appropriately 
designed – every deployed technology has security vulnerabilities
What can you do to prevent illegal wiretapping? 
 Look for ways to encrypt insecure link layers with seamless technologies
 Peer Review lawful intercept systems to discover and disclose security 
weaknesses and vulnerabilities
 Insist on lawful intercept systems that are:
– Secure
– Subjected to open peer review
– Auditable
– Incorporate appropriate checks and balances
 Support organizations that are challenging the status quo
We aren’t going to make things better if we’re 
afraid to ask challenging questions.