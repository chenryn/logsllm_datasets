Generic
Service
一些模板重点掌握就行了。下面就重点介绍经常使用的三类
大部分是可以直接拿来使用的。这里不需要对每个模板都
Agent
Ping
SNMPv2
SNMPv1
#对VMVMware系统的监控模板
#对MacOSx系统的监控模板
#对Windows系统的监控模板
#对Linux系统的监控模板
JMX
，进入此模板后，单击“应用集”，可以发现
也是做监控的基础，所以要熟练掌握它们的
#
对
#对Java服务的监控模板
#对主机Ping的监控模板
#对SSH服务的监控模板
#对MySQL服务的监控模
#对HTTPD服务的监控模机
寸Zabbix Server 状态的监控模板
ZabbixAgent状态的监控模板
，在有多个监控项、多种监控类型
板
板
---
## Page 250
自定义键值。此外，每个监控项还可以添加对应的触发器，也就是说这个监控项如果需要
内容。键值的写法是有统一规范的，Zabbix针对不同监控项自带了很多键值，用户也可以
如图6-11所示。
个模板，在模板下，可以看到有监控项选项。
6.3.3创建监控项
监控项
已经存在多个应用集，如图6-10所示。
口
口
有模版TemlteOSLinux
监控项是Zabbix监控的基础，默认的模板下都存在了很多监控项。这里以“Template
单击Web上面的“配置”菜单，然后选择“模板”，任意选择一个模块，或者新建一
ZABBIX盐遮产已装报表配管理
从图中可以看出默认监控项的内容，每个监控项都对应一个键值，就是具体要监控的
如果有新的监控项需要加入，还可以单击右上角的“创建应用集”创建一个新的应用集。
应用集
CPUsofn e
CPU iteime
CPU gusst ime
CFUgues
interrupt.time
ApZaicgZaiagent
主机
应用！
动作关联调电
监技项3载发需国用s聚激形自动发现现则2
自动发联
图6-11Zabbix默认自带的监控项
图6-10Zabbix默认自带应用集
旺发器：
教发蒸
systemcpu.tisoftr]
system.cpuutilguest
群组所有
Web格
运维监控利器Zabbix第6章
主机Teplte OSinux
354 Zaak 客产装
865d
Zabbix客户
Zabik客产
Zabbi客产键
Zabbix客户
类型
abbix客户
9图
CPU,Perfomane
CPU.Performanc
CPU.Performa
CPU.Perfromanc
CPU.Performanc
CPU
CPU,
Secunty
Perfarma
应电
瑞量
过能了
创建监控璃
239
---
## Page 251
240
择”按钮，Zabbix自带的键值就可以全部显示出来，如图6-13 所示。
是Zabbix自带的。如果要查看更多Zabbix自带键值，可以单击上图中“键值”选项后面的“选
个端口的状态做监控，就可以使用net.tcp.service.perf[service,,]这个键值，此键值就
定义自已的键值。Zabbix自带了很多键值，可满足90%的需求，例如，这里想对服务器上某
不同的地方。
过 Zabbix agent 会主动汇报数据到Zabbix server，这是与Zabbix客户端（被动式）监控
型。而Zabbix客户端（主动式）监控也需要在被监控的机器上安装Zabbix agent，只不
agent，然后Zabbix server主动去agent上抓取数据来实现的监控，这是最常用的监控类
户端监控也称为Zabbix客户端（被动式）监控，就是通过在要监控的机器上安装Zabbix
Zabbix客户端（主动式）、简单检查、SNMP客户端、Zabbix采集器等类型。Zabbix 客
项通过什么方式进行监控。Zabbix可选的监控类型有很多，常用的有Zabbix客户端、
名称，自定义一个即可，但是要能表达其监控项的含义。第2个“类型”是设置此监控
定要有一个触发器，需要根据监控项的内容而定。
告警的话，就可以添加一个触发器，触发器专门用来触发告警。当然不是说每个监控项一
高性能Linux服务器运维实战：shell编程、监控告警、性能优化与实战案例
接着就是对“键值”的设置，这是个难点。键值可以使用Zabbix默认自带的，也可以自
在这个界面中，重点是红框标识出来的几个地方。首先，“名称”是创建的监控项的
监控项
监控项
所有模板
进程
历史数据保留时长
趋势存储时间
自定义时间间隔
新的应用集
查看值
更新阅隔
应用集
信恩类型
单位
键值
名称itpd port 8o status
图6-12创建一个Zabbix监控项
Donot kee trendsstoraneperiod
浮点熬
net tpservice pefthtip.ol
Zabbix客户端
365d
1700:002400
·辰示伍助射
---
## Page 252
用集、监控项，在后面添加主机的时候，将这个创建的模板链接到主机下即可。不推荐在
以在一台主机下创建监控项。推荐的做法是新建一个模板，然后在此模板下添加需要的应
类中，可以选择已存在的应用集，也可以添加一个新的应用集。
据对监控项灵敏度的需求来设定，默认是30s更新一次。
创建监控项中，还有一个“更新间隔”，这个是用来设置多久去更新一次监控数据，可根
控选项，每个选项含义如下所述。
型的监控中，也可用在“简单监控”类型中。
down 时返回0，否则，返回连接服务花费的秒数，此键值既可用在“Zabbix客户端”类
键值的含义也都做了很详细地描述，可以根据需要监控的内容，选择对应的键值即可。
：这个键值中，net.tcp.service.perf 部分是键值的名称，后面中括号中的内容是键值的监
在创建监控项的最后，还有一个应用集的选择，也就是将这个监控项放到哪个监控分
监控项可以添加到一个已经存在的模板中，也可以添加到一个新创建的模板中，还可
所有设置完成后，最后单击“添加”按钮即可完成一个监控项的添加。
此键值返回的信息类型是浮点型的，因此，在“信息类型”中要选择“浮点数”。在
要监控某个或某批服务器80端口的运行状态，可以设置如下键值：
》service：表示服务名，包含SSH、NTP、LDAP、SMTP、FTP、HTTP、POP、NNTP、
可以看到，Zabbix自带的键值根据监控类型的不同，也分了不同的监控键值种类，每个
netuopspeeco.p
标准检测
口等。
port：表示端口，默认情况为每个服务对应的标准端口，例如，SSH服务是22端
are hv.custesnameu
ip：表示IP地址，默认是127.0.0.1，可留空。
IMAP、TCP、HTTPS 和Telnet。
eeventogsuns]
net.tcp.service.perf[http,,80]
hvcpuusage
uund
pat
port
S12808
stimeoutt
图6-13Zabbix自带的监控项键值
：返回ICMPping的胸应时润单位秒，例如0.02
VMwarehypenisor数据池读统计sur-VMware服务URLcuuid>VMware hype
VMware服务完整名unsVMware服务URL
VMware事件日志urVMware服劳URL
VMware集游状态urlVMware服务URLnamexVMware集群客称
检重UDP服务的性能，当服务dow时返国0，否到返回连接到服务花费的秒效
经查服务湿否运行并响应UDP求，返固0-暖务关闭：1服务运行
检查TCP服务的性能，当服务down时返回0，否则这回连搜服务花费的秒数
检查服务景否运行井接受TCP连孩，返回O-服务关闭；1-服务运行
返回iCMP ping包丢失的百分数
检查服务微否能够由ICMPping访间-1CMPping失败-ICMPping成功
/Mwarehypervisor处理器使用率单位Hz
sur
VMware服务URLuuid>VMware
运维监控利器Zabbix第6章
visor
主机名datastore>-数据池名
型描单检查
agent代理程序
内部
户瑞（主动式
241
---
## Page 253
242
函数。下面就介绍一下常用的一些触发器表达式函数及其含义。
表达式的编写，要学会写触发器表达式，首先需要了解表达式中常用的一些函数及其含义。
板”，任意选择一个模块，或者新建一个模板，在模板下，可以看到有触发器选项。
问题，就会激活触发器，触发器将自动连接告警动作，触发告警。
6.3.4
这样，
需要的监控项、触发器等内容，最后在添加主机时直接将此模板链接到每台主机下即可，
要在每台主机下都创建相同的监控项。
主机下创建监控项的原因是，如果有多台主机，每台主机都有相同的监控内容，那么就需
高性能Linux服务器运维实战：shell编程、监控告警、性能优化与实战案例
触发器
从上图可以看到，有 diff、avg、last 和 nodata等这些标识，这就是触发器表达式中的
触发器同样也推荐在模板中进行创建。单击Web上面的“配置”菜单，然后选择“模
单击“触发器”，可以看到有默认存在的触发器，如图6-14所示。
触发器是用于故障告警的一个设置。为一个监控项添加触发器后，此监控项如果出现
因此，构建Zabbix监控，推荐的做法是，首先创建一个模板，然后在此模板下创建
支持值类型：float、int、str、text、log。
参数：#num。
2.last
作用：返回值为1表示最近的值与之前的值不同，即值发生变化，0表示无变化。
支持值类型：float、int、str、text、log。
参数：不需要参数。
1.diff
从图6-14中可以看到，有触发器的严重性、名称、表达式等几个选项。这里面的难点是
每台主机就自动链接上了模板中的所有监控项和触发器。
创建触发器
名称
用集监经36旺发隐形聚合限形1
HOSTNAME)
ISOH0
NAME
图6-14Zabbix默认自带的触发器
Web
emlOSLx.kemesfat1024
avg5mj20
---
## Page 254
没有接收到数据，0表示其正常接收数据。
表示漂移，从第2个参数前开始算时间。#n表示最近n次的值。
avg(3600.86400)表示一天前的1h的平均值。
的个数等于12。
值为9，last(#9)得到的值为 2。
第2新的数据。例如，从老到最新值为1、2、3、4、5、6、7、8、9、10，last(#2)得到的
（并不是最近的三个值）。注意，last函数使用不同的参数将会得到不同的值，#2表示最近
数的 #num的意思是不同的。
例如，last(0)或 lastO等价于 last(#1)，表示获取最新的值，last(#3)表示最近第3个值
如果仅有一个参数，表示指定时间的平均值，从现在开始算起；如果有第2个参数，
参数：秒或#num。
其中，第1个参数是指定时间段，第2个参数是样本数据。
例如，count(600)表示最近10min得到值的个数，count(600,12)表示最近10min得到值
7.sum
作用：返回指定时间间隔内数值的统计。
支持类型：float、int、str、text、log。
6.count
作用：探测是否能接收到数据，当返回值为1表示指定的间隔（间隔不应小于30s）
支持值类型：any。
5.nodata
例如，change(0)>n 表示最近得到的值与上一个值的差值大于n，其中，0表示忽略参数。
作用：返回最近获得值与之前获得值的差值，返回字符串0表示相等，1表示不同。
支持类型：float、int、str、text、log。
参数：无须参数。
4.change
例如，avg(5)表示最后 5s 的平均值，
作用：返回一段时间的平均值。
支持类型：float、int。
参数：秒或#num。
3.avg
另外，last 函数必须包含参数
参数：秒或#num。
参数：秒。
作用：获取最近的值，#num表示最近第N个值，请注意当前的#num和其他一些函
avg(#5)表示最近5 次得到值的平均值，
运维监控利器Zabbix第6章
243
---
## Page 255
成立，或者返回true。触发器创建界面如图6-16所示。
达式所表示的含义是：http服务的80端口获取到的最新值如果等于0，那么这个表达式就
监控项对应的键值，第3部分是触发器表达式函数，最后一部分就是监控项的值。这个表
建完成了，完整的触发器表达式内容是：
根据前面对监控项的了解，lastO函数返回0表示服务故障。这样，一个触发器表达式就创
数，“间隔（秒）”选项保持默认即可，重点是“结果”，这里设置lastO函数返回值为0。
将返回值为0作为触发器表达式的条件。要获得监控项的最新返回值，需要使用lastO函
的服务正常时返回连接服务所花费的时间。因此，将返回0作为一个判断的标准，也就是
表达式的条件，也就是上面介绍过的触发器表达式函数，单击“功能”下拉菜单，可以发
控项添加触发器，单击“监控项”后面的“选择”按钮，即可打开已经添加好的所有监控
有6个等级选择，这里选择“一般严重”，接下来就是表达式的编写了。单击表达式项后
器页面中，单击右上角的“创建触发器”即可进入触发器创建页面了，如图6-15所示。
集值的数目（以#开始)。
高性能Linux服务器运维实战：shell编程、监控告警、性能优化与实战案例
244
回值进行选择。