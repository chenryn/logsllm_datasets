==== 其他
此模块每一类视图都对应不同配置条件，自动配置见详情。
===== 单值[[singlevalue]]
可配置字段包含 4 类参数：
1. 数值：
** 数值字段：取第一个统计数值
** 展示字段：可选配置，当需要动态"key : value"效果时，可以选展示字段作为 key 位内容。
** 图中展示：当数值字段和展示字段都配置以后，可选择两者同时展示，仅展示字段或仅数值字段。即使仅展示字段时，也可以利用数值字段进行颜色区间等效果处理。
** 是否使用Sparkline：Sparkline是折线图的一个变种，单值展示折线最后一个点的值，下方展示整体曲线，如下图所示。当SPL返回结果中有13位时间戳时，该功能可以使用，否则该功能不可见。
*** Sparkline x轴字段：当开启使用Sparkline功能时，可以配置Sparkline x轴字段。示例如下：
+ 
image::images/singlevalue-sparkline.png[]
2. 展示效果：
** 默认：只能设置颜色填充字体或背景
** 按区间：需手动添加数值分段区间并选择对应颜色，用“*”星号表示无穷大。注意数值分段区间不能重叠。也支持设置颜色填充字体或背景
** 按趋势：可设置对比时间，固定按涨跌启用红绿色背景，可选择使用绝对值或百分比形式展示对比效果
+
image::images/single-trend.png[]
3. 图标：
** 按名称：输入任意一个 fontawesome 免费图标的英文名称即可在单值前部展示名称对应的图标，考虑到 fontawesome 免费图标库多达一千二百多个，日志易提供了输入提示功能
** 按字段：如果需要根据搜索结果动态变化图标，可以由 SPL 语句返回某个字段，指定该字段名称，日志易将自动使用该字段值作为 fontawesome 图标名称
+
image::images/single-fontawesome.png[]
4. 二级标题：主要用于单值在仪表盘展示，在隐藏主标题后，单值下面居中位置展示二级标题。当同时定义二级标题和字面字段时，使用分面字段填充二级标题。
** 名称：输入二级标题名称，则该名称展示在单值的下方。示例如下：
+
image::images/singlevalue-second-title.png[]
此外，单值图还支持一些对数值格式化的设置项，包括：
1. 千位分隔符：为了方便判断位数，支持每 3 位加一个逗号；
2. 单位：单值统计场景通常都会有实际的数据含义单位，比如 ￥，个等；
3. 单位位置：根据场景不同，可以选择把单位放在数值的前方还是后方。像￥应该在前方，个应该在后方；
4. 数值精度：和所有数值字段一样，单值图也支持对数值精度的设置；
5. 字号：默认数值字号为 60px，单位字号为 36px。
6. 字体颜色：在默认展示时，可以具体定义展示内容的颜色。
7. 背景颜色：在默认展示时，可以具体定义单值图背景颜色。
同时配置各种格式化的效果如下图所示：
image::images/single-all.png[]
===== 水球图
可配置字段只有一个：“展示字段”。默认用第一个统计数值自动配置
比如之前章节介绍的百分位统计，请求如下：
[source,bash]
logtype:apache | stats pct_ranks(apache.resp_len, 25) | eval ret = _pct_ranks.apache.resp_len.25 / 100
改用水球图效果为：
image::images/liquidfill.png[]
===== 环形比例图
环形比例图是类似水球图的另一种可视化效果。它同样只能用来展示 0-1 之间的百分比数值。
image::images/circular.png[]
环形比例图还支持新增一个对比字段。常用于同时展示昨天统计值、上周同日统计值等同环比场景。
image::images/circular-comparison.png[]
和单值效果类似的，环形比例图也支持定义环形的颜色区间配置。注意：颜色区间仅用来判断数值字段，对比字段永远采用灰色展示。
===== 字符云图
自动配置的两个参数及默认的字段取值规则：
1. 展示字段：取第一个统计数值
2. 分组：取第一个分组字段
字符云图常用于展示单词文本的占比数据。比一般饼图的视觉冲击力更强。比如如下请求：
[source,bash]
logtype:apache | stats count() by apache.geo.city
使用词云图效果为：
image::images/wordcloud.png[]
===== 循序图
循序图，又叫时序图、顺序图。和时序指标趋势图不一样，循序图更关注消息在对象之间交互的生命线。循序图常见于软件开发的UML领域。
日志易中，可以具体定义循序图的时序、来源、目标、分组、标记字段。系统将自动把来源和目标字段合并得到对象列表。
image::images/sequence.png[]
[TIP]
====
循序图上对象数量不宜过多。
====
===== 雷达图[[radar]]
雷达又叫戴布拉图、蜘蛛网图。雷达图是一种表现多维（4维以上）数据的图表。它将多个维度的数据量映射到坐标轴上，这些坐标轴起始于同一个圆心点，通常结束于圆周边缘，将同一组的点使用线连接起来就称为了雷达图。它可以将多维数据进行展示，和饼图不同的是，点的相对位置和坐标轴之间的夹角是没有任何信息量的。在坐标轴设置恰当的情况下雷达图所围面积能表现出一些信息量。
为了容易理解和统一比较，使用雷达图经常会人为的将多个坐标轴都统一成一个度量，比如：统一成分数、百分比等。这样这个图就退化成一个二维图了，事实上这种雷达图在日常生活更常见、更长用。 另外，雷达图还可以展示出数据集中各个变量的权重高低情况，非常适用于展示性能数据。
日志易中，坐标轴强制开启统一度量效果，并可以具体定义雷达图的数值、切分、指示器字段。
image::images/radar-2.png[]
[TIP]
====
雷达图上指示器过多，或切分过多，都会导致可读性下降，请务必控制，使雷达图保持简单清晰。
====
===== 漏斗图[[funnel]]
漏斗图适用于业务流程比较规范、周期长、环节多的单流程单向分析，通过漏斗各环节业务数据的比较能够直观地发现和说明问题所在的环节，进而做出决策。漏斗图用梯形面积表示某个环节业务量与上一个环节之间的差异。漏斗图从上到下，有逻辑上的顺序关系，表现了随着业务流程的推进业务目标完成的情况。如果无流向关系的对比，请采用饼图或柱状图。
日志易中，可以具体定义漏斗图的数值和切分字段。当字段值较长时，建议将图例位置配置设为柱状外侧：
image::images/funnel.png[]
===== 矩阵热力图[[matrix-heatmap]]
矩阵热力图效果，基于数值对比常用的热力图效果，结合矩阵布局进行时序数据的分析。常用于分组较多时，关注同一时刻数据的离散度。
日志易中，可以具体定义矩阵热力图的 X 轴、Y 轴字段，以及 Y 轴的分段数量。其中，矩阵热度并不是使用原始数值，而是计算落入对应分段区间的分组个数。落入某个矩阵单元的分组个数越多，说明这段区域内数据越集中，热度越高。比如如下请求：
[source,bash]
* | bucket timestamp span=12h as ts | stats count() by appname, ts | eval ts=formatdate(ts, "yyyy-MM-dd")
使用矩阵热力图效果为：
image::images/matrix-heatmap.png[]
用户可以很醒目的看到，8 月 17 日，有部分 appname 的日志数量远高于平常。
===== 调用链[[tracing]]
日志易提供调用链用来展示zipkin、pinpoint、skywalking 和 jaeger 等开源 Tracing 方案。用户首先使用spl统计语句搜索出表格结果，再配置调用链:
*    函数：调用链表格展示的第一列
*    父ID：用来确定调用关系，表格结果中，必须有且仅有一行的父ID为空，该父ID值作为调用链的根节点。
*    子ID：用来确定调用关系，每行子ID对应的父ID必须在表格结果中真实存在。
*    类型：当子ID相同时，使用类型字段来区分不用的行，常见类型字段名有kind。
*    展示类型：填写类型字段的值用来确定调用链上的展示内容，当展示类型为空时，使用开始时间确定各列展示的内容。常见类型字段的值有CLIENT，SERVER，如类型为kind，展示类型为CLIENT，则在调用链中使用kind的值为CLIENT的行内容进行展示。
*    开始时间：函数开始时间，用来画时间轴。要求开始时间字段值为 16 位 UNIX 时间戳。如 1588066892000。
*    持续时间：函数运行时间，用来画时间轴。要求持续时间字段值是单位为微秒的、大于 0 的数值。
*    列信息字段：可多选，在调用链表格的函数列和耗时列之间添加若干其他列，用来展示更多信息，比如 hostname、success、avg_duration 等。
*    属性信息：自动填充spl结果中字段名称包含.的字段名，用户可以根据需要自行调整。
*    元数据信息：自动填充spl结果中字段名称不包含.的字段名，用户可以根据需要自行调整。
*    切分字段：必选，按字段值划分颜色
*    展示颜色：可选起始颜色
*    数据精度：可选（0，1，2，3），展示持续时间的小数点后保留几位小数，向上取整。系统默认将微秒持续时间展示位保留小数点后2位的毫秒。
*    展示类型：可选（table, tree）
*    展示行详情：当设置为table展示时，点击第一列的函数名称，显示该行的属性，元数据和关键路径。关键路径展示表格中该行的请求耗时，当类型字段有多个值时，展示每行的请求耗时。
选择展示类型为table，即可看到类似如下结果:
image::images/tracing-table-result.png[]
顶部是瀑布图的缩略展示，当请求处理行很多时，缩略图使我们快速找到耗时较大的行。
点击函数名称，展示行详情，如下图所示：
image::images/tracing-table-detail.png[]
当同一个子ID有2行或2行以上时，使用类型字段的值来区分属性和元数据，如类型值有2个：CLIENT和SERVER，属性和元数据分别展示分2个TAB，如下图：
image::images/tracing-table-kind.png[]
关键路径展示如下图：
image::images/tracing-table-2path.png[]
选择展示类型为tree，即可看到类似如下结果:
image::images/tracing-tree-result.png[]
[NOTE]
=====
调用链的总时间长度取决于父ID根节点的持续时间。后续所有节点的开始时间+持续时间，必须小于等于根节点的开始时间+持续时间。当然，子节点的开始时间还要晚于根节点的开始时间。
此外，和多级桑基图一样，调用链也不支持父子节点环路的情况。
=====
===== 网络状态图[[network]]
网络连接是 IT 环境中最常见的行为，日志易提供专属的网络状态可视化效果，用来观测一段时间内，网络中发生的节点连接状态。
网络数据分析最重要的就是四元组，即来源地址、来源端口、目的地址、目的端口。作为工程师，尤其关注服务端的状态，所以网络状态可视化中，我们需要根据来源地址、目的地址、目的端口的情况进行访问和性能分析。
可配置字段有：
* 来源字段：来源地址的字段名称；
* 目标字段：目标地址的字段名称；
* 目标端口字段：目标端口的字段名称；
* 指标字段：对应某一目标地址和目标端口的相关指标的字段名称，可以添加最多 6 个指标，可以配置颜色方案；
* 展开层级：当点击查看具体某个目标地址时，展开其上下游的几层访问关系；
* 斥力因子：展示全局节点连接关系时，节点之间的距离控制参数，默认为 8。
以一段网络抓包数据为例：
 index=packet appname:packet
   | stats count() by json.client_ip, json.ip, json.port
   | fields -'count()'
   | join type=left json.ip,json.port [[
       index=packet appname:packet
         | eval err=if(json.status=="OK",0,1)
         | stats count() as cnt, sum(json.bytes_out) as bytes, pct(json.responsetime,90) as rt, sum(err) as err_cnt by json.ip, json.port
         | eval err_pct=err_cnt/cnt
         | fields - 'err_cnt'
     ]]
image::images/network-diagram.png[]
网络状态可视化效果支持图内钻取。在初始状态下，只展示来源地址和目标地址的连接关系，建连关系越多的节点，半径越大。初始状态的展示效果和力引导图类似。
在图中找到待分析的节点，点击进入详细模式：
image::images/network-detail.png[]
详细模式下，会展开目的地址具体每个端口的性能指标值，并根据定义好的颜色区间，高亮其中的异常状态。
你可以在上下游中，点击其他节点右侧的切换 icon，将分析中心改为其他节点，画布将自动切换成新节点的上下游指定层级状态。
网络中来源节点通常很多，当画布上节点绘制过小时，可以点击画布左下角的缩放按钮，配合鼠标左键挪动画布到合适位置查看。点击左下角的返回按钮，则返回初始的全局力引导图。
==== 分面可视化
分面可视化是一类特殊的多维度对比可视化效果。它可以将同一类数据分成多个小型可视化效果，展示在同一个画布上。对大多数图形效果，日志易均支持进行分面可视化对比。
在分面设置中，选择分面字段。并根据图表类型的区别，设置分面布局。单值图、水球图、环形比例图需要明确设定 X 行 Y 列，其他类型只需要定义 Y 列，系统自动换行。分面字段值会根据实际情况，在图形的上方或下方展示。
维度可视化效果中，除火焰图以外的饼图，条形图，玫瑰图，旭日图均可启用分面可视化，示例如下：
image::images/trellis-circular.png[]
关系可视化效果中，桑基图、和弦图、力引导图均可启用分面可视化，示例如下：
image::images/trellis-sankey.png[]
序列可视化效果中，折线图、面积图、柱状图、散点图均可启用分面可视化，示例如下：
image::images/trellis-column.png[]
地图可视化效果中，区划地图、热力地图可启用分面可视化，涉及经纬度聚合的攻击地图和统计地图暂不支持，示例如下：
image::images/trellis-map.png[]
其他可视化效果中，环形比例图、单值图，水球图、字符云图可启用分面可视化，示例如下：
image::images/trellis-singlevalue.png[]
=== 保存
在生成图表以后，点击统计图片右上方的 `下载` 按钮，您可以下载成PNG图片。点击统计图片左上方的 `保存` 按钮，可以选择保存为：
* 定时任务：您可以选择保存为定时任务
* 趋势图：如果您想在仪表盘/报表中使用该统计结果，请点击“保存为趋势图”会弹出保存页面，填写好名称和描述后，点击添加即成功保存。
已经保存的趋势图，可以添加为仪表盘挂件和报表元素，也可以在趋势图列表页进行分组调整、编辑和删除操作。编辑操作等同于统计类透视表视图操作。
此外，您也可以在趋势图列表页面调整其所分组标签。详细界面见稍后资源标签介绍章节。