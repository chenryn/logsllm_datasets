Chris&Li(lebury&
Senior&Penetra4on&Tester&with&Knowledge&Consul4ng&Group&
Chris.Li(PI:EMAIL&
&
I&like&building&stuﬀ.&
About&me&
DDISCLAIMERD&
I&am:&
•  Providing&ideas,&examples,&and&code&of&what’s&worked&for&me.&
•  Open&to&ques4ons&aQerward&and&sugges4ons.&
&
I&am&not:&
•  GeRng&paid&to&endorse&any&products.&
•  Promising&an&end&to&burglaries.&
•  Advoca4ng&seRng&up&booby&traps&in&your&home.&
•  Challenging&anyone&to&“test”&my&home.&&Please,&please&do&not.&
&
&
Once&Upon&a&Time&in&South&Texas&
Once&Upon&a&Time&in&South&Texas&
Once&Upon&a&Time&in&South&Texas&
My&$1500&Thief&Magnet&
*h(p://learningcenter.statefarm.com/
auto/safety/mostDstolenDcarsDofD2009/&
I&Had&an&Idea&
•  Remove&the&main&fuel&
relay&at&night&
•  Install&twoDway&alarm&
system&with&only&paging&
func4onality.&
Success!&
(Depending&on&how&you&look&at&it)&
My&Awesome&Apartment&Complex&
/u/TheDovahkiinsDad&(Not&me&or&my&pic)&
&
h(p://www.reddit.com/r/WTF/comments/
2784oo/
my_buddies_jeep_was_set_on_ﬁre_by_some_
crazy_ass/&
&
Movin’&on&Up&
Tips&From&Cops&
•  Make&your&home&look&occupied,&and&make&it&diﬃcult&to&break&in.&
•  Leave&lights&on&when&you&go&out.&If&you&are&going&to&be&away&for&a&length&of&4me,&
connect&some&lamps&to&automa4c&4mers&to&turn&them&on&in&the&evening&and&oﬀ&
during&the&day.&
•  Lock&all&outside&doors&and&windows&before&you&leave&the&house&or&go&to&bed.&Even&
if&it&is&for&a&short&4me,&lock&your&doors.&
•  Keep&your&garage&door&closed&and&locked.&
•  Don't&allow&daily&deliveries&of&mail,&newspapers&or&ﬂyers&build&up&while&you&are&
away.&Arrange&with&the&Post&Oﬃce&to&hold&your&mail,&or&arrange&for&a&friend&or&
neighbor&to&take&them&regularly.&
h(p://www.sjpd.org/bfo/community/Crimeprev/Preven4onTips/Prevent_Burglary.html&
X10&Protocol&
DCreated&in&the&late&1970s.&
&
DData&is&encoded&onto&a&120khz&carrier&which&is&transmi(ed&as&bursts&
during&the&zero&crossings&of&the&60hz&AC&waveform.&&One&bit&is&
transmi(ed&at&each&zero&crossing.&
&
DFour&bit&house&code,&four&bit&unit&code,&and&four&
&bit&command.&
&
DStupid&cheap&
&
DProne&to&interference&
&
DEach&command&set&sent&three&4mes&
&
&
&
X10&Hardware&
Again,&stupid&cheap&
X10&Setup&
D 
Light&4mers&that&operated&
&&&&&&by&day&of&the&week&and&&
&&&&&&4me&
&
D 
Security&4ming&feature&
D 
Remote&control&(RF)&
D 
Not&awesome,&but&worked&
&
X10&–&Adding&Exterior&Ligh4ng&
So&Long&South&Texas&
Time&to&Do&it&Right*&
*I&do&not&advocate&crea4ng&laser&booby&traps&in&your&home.&
Wish&list&
•  Eﬃcient&ligh4ng&
•  Granular&control&over&4ming&events&
•  Integra4on&into&exis4ng&security&system&
•  Adap4ve&4ming&
•  Condi4onal&decision&system&
•  InDhouse&geoDfencing&
•  Defense&against&wireless&home&automa4on&a(acks&
•  Create&tangible&house&reac4ons&to&external&s4muli&(ac4ve&
defenses)&
&
New&Programmable&Light&Tech:&LIFX&
LIFX&Pros/Cons&
Pros:&
•  Excellent&color&reproduc4on&
•  802.11&builtDin&(no&hub&needed)&
•  White&output&of&over&1000&lumens&&
•  Low&power&consump4on&(17&wa(s&at&full&
brightness)&
Cons:&
•  Bulbs&are&physically&large&(limits&ﬁxture&selec4on)&
•  Rela4vely&heavy&(again,&limits&ﬁxture&selec4on)&
Philips&Hue&Pros/Cons&
Pros:&
•  Small&bulb&size&(ﬁts&in&regular&ﬁxtures)&
•  Low&power&consump4on&(8.5&wa(s&at&full&brightness)&
•  Slightly&cheaper&
Cons:&
•  Lower&light&output&
•  Limited&color&reproduc4on&
Combine&the&Two&
WeMo&Devices&
D 
WLAN&to&Zigbee&bridge&
like&LIFX&devices&
D 
Uses&UPnP&and&SOAP&
D 
Control&outlets&and&wall&
switches&
D 
SemiDcheap&
D 
Terrible&App&support&
D 
Scheduling&rules&that&
some4mes&work&
D 
Integra4on&with&IFTTT&
that&works&20%&of&the&
4me&
D 
Terrible&security&
&&&&&&h(p://bit.ly/1e6Vsvt&
Crea4ng&a&Home&Defense&Server&
D 
Needs&to&be&available&24/7&
D 
Low&power&consump4on&would&be&nice&(UPS)&
D 
Integra4on&of&analog/digital&sensors&and&components&
D 
Output&for&integra4on&into&tradi4onal&home&security&system&
D 
Raspberry&Pi&was&the&obvious&choice&
Previous&Experience&with&Pis&
Open&Source&to&the&Rescue!&
Magicmonkey&–&lifxjs:&&h(ps://github.com/magicmonkey/lifxjs&
&&DReversed&the&LIFX&protocol&
&&DPaved&the&way&
&
Sharph&–&lifxDpython:&&h(ps://github.com/sharph/lifxDpython&
&&DBased&on&Magicmonkey’s&protocol&dissec4on&and&js&library&
&&DWri(en&in&glorious&Python&
&&DAwesome&API&that&bridges&WLAN&to&LIFX’s&Zigbee&(802.15&915mhz)&protocol&
&
LIFX&Oﬃcial&API:&h(ps://github.com/LIFX/lifxDgem&
&&DWri(en&in&Ruby&
&&DSupport&for&addressing&mul4ple&bulbs&at&once&
&&&
iancmcc’s&ouimeaux:&h(ps://github.com/iancmcc/ouimeaux&
&D&Extensive&Python&API&for&WeMo&devices&
&D&Applica4on&wri(en&on&top&of&the&oﬃcial&API&
&&
&
&
Crea4ng&a&Front&End&and&Services&
•  Choose&a&lightweight&framework&like&
Flask&(Python)&or&Sinatra&(Ruby)&
•  Create&services&for&each&tech&(LIFX,&Hue,&
WeMo)&
•  Individual&services&prevent&systemDwide&
failures&and&segregate&code&
•  Choose&a&lightweight&database&like&Redis&
and&host&it&on&a&separate&Pi&
•  Create&monitoring&services&with&alerts&
&
All&code&available&postDconference&at:&
h(ps://github.com/lowercaseDb&
&
Device&Proximity&Monitoring&
D 
Original&plan&was&to&use&Bluetooth&ranging&
D&Linux’s&rfcomm/hcitool/l2ping&
&D&Inconsistent&results&
&D&Required&constant&packet&transmission&for&RSSI&values&
&D&Would&brick&the&device&if&too&aggressive&
&D&Demo:&&h(p://www.youtube.com/watch?v=DSMaUdPEJMM&
&
&
#!/bin/bash 
while : 
do 
 l2ping -c 3  & 
 sleep 2 
 hcitool rssi  status 
 sleep 5 
done 
&
Device&Proximity&Monitoring&
U4lize&WLAN&Frames&
&D&Much&more&reliable&
&D&Doesn’t&brick&the&device&
&D&Allows&for&monitoring&of&addi4onal&devices&(guests)&
&D&Requires&airmonDng&suite&
Speciﬁc&device’s&Received&Signal&Strength&Indicator&(RSSI):&
tshark -i mon0 -f "wlan src host " -l -T fields –e radiotap.dbm_antsignal 
&
&
All&devices&visible&and&their&RSSI:&
tshark -i mon0 -l -T fields -e radiotap.dbm_antsignal -e wlan.sa 
All&ﬁelds&available&for&a&speciﬁc&device:&
tshark -i mon0 -f "wlan src host " -l -T pdml 
&
Device&Proximity&Monitoring&
•  Created&a&service&that&looks&for&preDdeﬁned&list&of&mobile&phone&MACs&(ﬂat&ﬁle)&
•  Looks&for&WLAN&beacon&frames&and&calculates&signal&strength&
•  Records&last&known&signal&strength&and&last&4me&seen&in&Redis&db&
•  Capability&for&historical&recording&of&loca4onal&data&
•  Separate&service&monitors&4mestamps&and&determines&if&devices&are&present&
•  Updates&database&ﬂags&which&aﬀect&decision&making&in&other&services&
&
Adap4ve&Scheduling&System&
D 
“SmartCron”&system&
D 
Schedules&all&ligh4ng&events&
D 
Pulls&sunrise/sunset&data&from&Weather&Underground’s&API&(free)&
D 
Creates&randomized,&variable&windows&for&events&centered&around&sunrise,&
sunset,&etc&
D 
Events&are&condi4onal&on&other&event&ﬂags&in&the&main&database&
D 
Monitors&local&weather&to&advance&evening&ligh4ng&in&cases&of&severe&weather&&
Again,&all&code&available&postDconference&
at:&h(ps://github.com/lowercaseDb&
&
Defenses&Against&WirelessDBased&
A(acks&
D 
U4lizes&picoDdopp&doppler&system&for&realD4me&direc4on&ﬁnding&
D 
Detects&persistent&wireless&a(acks&outside&the&perimeter&of&the&house&(jamming)&
D 
See&h(p://www.silcom.com/~pelican2/PicoDopp/PICODOPP.htm&for&parts/equipement&
D 
Works&against&345&mhz&
&&&&&&sensor&a(acks&and&Zwave&
D 
Requires&Ethernet&to&&
&&&&&ensure&aler4ng&isn’t&
&&&&&jammed&
Keep&the&Change&you&Filthy&Animal:&
Ac4ve&Defenses&&
D 
Intruders&desire&anonymity&
D 
Anything&that&can&be&electronically&ac4vated&and&produce&a&loud,&audible&response&
D 
Flash&all&house&lights&in&red&
D 
Rocket&igniters&and&ﬁrecrackers&
D 
12V&solenoids&to&knock&over&heavy&objects&(scuba&tanks)&
D 
DO&NOT&CREATE&ANYTHING&THAT&CAN&HARM!&
Roadmap&
D 
Buy&ZDWave&devices&and&integrate&them&
D 
Integrate&SDR&scanning&and&data&sniﬃng&
D 
Hear&ideas&from&DEFCON&folks&
Ques4ons?&
If&you&have&any&ques4ons,&please&come&ﬁnd&me&or&
email&me&at&Chris.Li(PI:EMAIL&
&