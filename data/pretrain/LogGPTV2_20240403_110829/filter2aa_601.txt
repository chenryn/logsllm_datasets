Security Response Center
吴
永
佳
国内SRC的漏洞趋势变化
及漏洞挖掘的一些思路分享
关于我
一名白帽子
常用ID  getshell1993
曾活跃于多个第三方漏洞平台及众测平台
曾活跃于多个SRC漏洞平台
SogouSRC BaiduSRC 360SRC CainiaoSRC WifiSRC TuniuSRC MeizuSRC DouyuSRC
Wooyun Xianzhi Allsec DidiSRC MobikeSRC NcfSRC SinaSRC LenovoSRC LetvSRC ……
国
内
S
R
C
的
漏
洞
趋
势
变
化
1
Past
Now
传统漏洞企业自动化扫描检测越来越成熟
大型互联网企业开发人员安全意识逐步提升
SDLC、RASP、WAF、HIDS、蜜罐、统一认证……
传统漏洞
挖掘成本越来越高
大型互联网企业安全团队不断壮大
开发框架安全性正在逐步提升
2016年发生的两件对国内信息安全行业产生颠覆式影响的大事
2
多 关 注 那 些 容 易 被 忽 视 的 资 产
常规资产信息收集手段
如，IP端口扫描、同网段扫描、子域名的各类收集方式及爆破等等
当然对SRC厂商子域名和IP端口变化的监控非常重要
但是，这次我要介绍一些在平常测试中容易被忽略的企业资产
关于企业资产还应多关注以下重灾区：
非普通用户使用的系统
企业使用的外部第三方系统和比较隐蔽的系统
企业的微信公众号/小程序
企业的支付宝生活号/小程序
APP Store 安卓市场的所有APP+内部APP
各省市分公司的自建站点
………………
注册账号要提供这么多信息？
放弃，放弃，关闭页面，关闭浏览器，再见
非个人用户使用的系统
媒体认证
卖家认证
企业认证
开发者认证
医生认证
Vip账号
作者认证
主播认证
司机认证
突破常规不走寻常路
当大家都朝着一个固定的方向去发现问题时，而你却独自朝相反的方向探索，往往会有惊喜
非普通用户使用的系统
部分平台审核不严，很多情况下提供资料注册即可通过或简单电话验证即可通过
想办法提供各类资料注册（注册公司/购买营业执照；网上公开信息收集；PS）
注册不了的想办法获取到账号（爆破/撞裤；套路社工在线客服/人工客服；文库/QQ群/github泄漏等）
借账号/租账号/买账号（在部分情况下也可以当威胁情报提交）
有些账号也可以花几十块钱在某宝上或QQ群上购买
营业执照可以轻易购买
有些账号也可以通过信息泄露方式获取
柳暗花明又一村
漏洞多，通过率接近100%，美滋滋
18年提交的部分SRC漏洞
非普通用户注册使用系统的漏洞
企业使用的外部第三方系统和比较隐蔽的系统
有时通过网络空间资产搜索企业信息会有惊喜
如FOFA、SHODAN……
以及各类搜索引擎……
比如此类惊喜
企业使用的外部第三方系统和比较隐蔽的系统
以平安为例
企业使用的外部第三方系统和比较隐蔽的系统
以平安为例
也可以根据其证书，header信息，备案号等信息搜索……
企业使用的外部第三方系统和比较隐蔽的系统
以平安为例
企业使用的外部第三方系统和比较隐蔽的系统
18年提交的部分SRC漏洞 第三方系统漏洞
关于国内SRC
选择大于努力系列
同个第三方厂商系统
三家SRC奖励分别是40000、1000、450
适用大型企业SRC，业务多，资产复杂
关键词搜索+账号主体过滤
关注企业每个业务、每个分公司对应的微信公众号
新活动，新业务上线往往会有公众号消息推送
企业的微信/支付宝公众号+小程序+APP
企业的微信/支付宝公众号+小程序+APP
以平安为例
以平安为例
…………
企业的微信/支付宝公众号+小程序+APP
企业的微信/支付宝公众号+小程序
18年提交的部分SRC漏洞公众号/小程序/APP相关漏洞
XXXX微信存储XSS打到大量cookie
XXXX微信一处遍历企业信息
XXXX任意绑定账号可查看任意手机号订单信息
XXXX微信端整站订单泄露
XXXX公众号商城存在SQL注入
XXXX分公司公众号可getshell
XXXX微信端越权可导致整站用户地址信息泄露
XXXX小程序XSS盲打到进入后台
XXXX微信小程序越权使用他人优惠券导致0元支付
XXXX微信端一处任意文件读取+SSRF
XXXX小程序越权查看整站订单信息
XXXXAPP城支付漏洞可控制订单金额
XXXXAPP某处用户信息泄露
……
人 是 最 大 的 漏 洞
3
Github信息泄露监控
基于代码搜索关键字匹配（域名/兄弟域名/内网域名/企业内部密码……）
https://github.com/0xbug/Hawkeye
https://github.com/MiSecurity/x-patrol
https://github.com/VKSRC/Github-Monitor
………………
另类思路
从GitHub的账户出发，通过邮箱进一步获得对应的用户名
混入内部QQ群等>提取QQ号>关联邮箱>关联用户名
git config user.email ********
通过人的关系来获得一些代码搜索不具有的优势
思路来源：https://www.freebuf.com/articles/web/198721.html
定制厂商专属的用户名字典
前期信息收集，确认厂商员工账号命名规则，制定精准用户名字典（搜索引擎/whois/名片/github/招聘网站）
我认识的朋友中叫李伟的有四个，叫李冰的有三个，叫李倩的有两个……
假如一个大企业里有数千员工，数万员工，甚至数十万员工……
那么这个企业里员工姓名相同的肯定很多……
于是员工的帐号就很可能会这样命名
liwei liwei01 liwei02 liwei03 liwei-s
libing libing01 libing02 libing03 libing-s
Top10000姓名生成对应字典
账号弱口令问题
制定专属的密码字典（弱密码/高强度弱密码）
部分系统有账号锁定机制，爆破需谨慎，可通过单一密码+账号尝试爆破
从简到杂递进进行尝试（用户名/域名/兄弟域名+数字+符号+年份+键盘密码字典）
domain123
domain1234
domain666
domain888
domain2018
domain2019
domain@123
domain@1234
domain@666
domain@888
domain@2018
domain@2019
domain&123
domain&1234
domain&666
domain&888
domain&2018
domain&2019
……
Domain123
Domain1234
Domain666
Domain888
Domain2018
Domain2019
Domain@123
Domain@1234
Domain@666
Domain@888
Domain@2018
Domain@2019
Domain&123
Domain&1234
Domain&666
Domain&888
Domain&2018
Domain&2019
……
username123
username1234
username666
username888
username2018
username2019
username@123
username@1234
username@666
username@888
username@2018
username@2019
username&123
username&1234
username&666
username&888
username&2018
username&2019
……
!QAZ2wsx
!QAZ@WSX
!QAZxsw2
!QAZXSW@
1qaz@WSX
1qazXSW@
1qaz@wsx
@WSX1qaz
@WSXzaq1
@WSX3edc
2wsx#EDC
2wsx!QAZ
2wsxCDE#
2wsxZAQ!
Qwer!234
Qwer1234
Asdf!234
Asdf1234
……
Aa123456
aA123456
Aa654321
Aa666666
Aa888888
root@123
root@2019
Root1234
Root2019
Admin123
Admin2019
admin@123
admin@1234
admin@2019
Passw0rd
P@ssword
p@ssw0rd
……
123456789
a123456
123456
a123456789
1234567890
woaini1314
qq123456
abc123456
123456a
123456789a
147258369
zxcvbnm
test1234
987654321
12345678910
abc123
qq123456789
123456789.
……
账号弱口令问题
社工相关
根据我的个人经验尝试，成功率极高
部分成功案例
qq小号伪装成内部员工通过入群申请，混入企业内部QQ群，在群里和开发人员交流技术，蹲点一个
多月，最终获取到内部敏感信息提交SRC
通过给某企业IT部门打电话，重新解绑vpn手机号，绕过vpn双因素进入内网
多次发一些链接给客服小姐姐点击，进一步进入某些系统
给在线客服打电话说要购买服务想先试用系统，进一步获取到系统测试账号密码
到某企业办公楼层连接wifi，通内网
社工有风险，切勿模仿，记得先跟厂商安全人员沟通报备
一 些 高 频 出 现 的 漏 洞
4
文档上传存在XXE漏洞（某SRC案例回顾-漏洞已修复）
上传xlsx/docx文档的功能很可能存在XXE漏洞
从office2007版本开始引入XML文件格式
poi-ooxml.jar
xlsx-streamer.jar ……
碰到文档的上传点可以用构造的恶意文件盲打试试
https://github.com/BuffaloWill/oxml_xxe
修改[Content_Types].xml文件
Evil.xml文件内容，试着读取etc/passwd
">
%int;%
send;
服务器监听ftp
图片上传存在ImageTragick命令执行（某SRC案例回顾-漏洞已修复）
http://www.xxxxx.com/upload.php?w=140&h=105&s=1&url=http://42.62.**.**/test.png
CVE-2016-3714  CVE-2018-16509  CVE-2019-6116
也有可能存在ghostscript远程命令执行漏洞
导致所有引用ghostscript的上游应用受影响，常见应用如下：
imagemagick libmagick graphicsmagick gimp texmacs python-matplotlibtexlive-core latex2html latex2rtf等等
视频上传存在FFmpeg文件读取/ssrf（某SRC案例回顾-漏洞已修复）
如果某场景使用ffmpeg版本小于3.2.4，并且有上传用户自定义avi视频的时候，利用该漏洞可以读取服务器上任意文件。
制作特殊的avi上传 test.avi
https://github.com/neex/ffmpeg-avi-m3u-xbin/blob/master/gen_xbin_avi.py
5
程 序 员 的 天 敌 是 产 品 经 理 和 安 全 人 员
当提交 ...//后，后台会过滤 ../ 替换成空，于是替换后...//变成了./ 
厂商>>>漏洞已修复
复测发现修复不当可继续利用，继续提交漏洞
http://xx.xxxxx.com/tmpl?file=../../../../../../../../../etc/passwd
某SRC案例回顾-漏洞已修复
Other
阅尽天下漏洞，心中自然无码
不断学习，多关注新漏洞，学习新思路新姿势
关注新的cve/新的公开漏洞/各类ctf公开writeup
……
安全属于高危行业
白帽子首先需要学习一些法律知识，保护好自己
认清测试与入侵的区别
测试时点到为止，勿做破坏
未授权系统，请勿测试
不从事与任何黑产相关的活动
同时也希望企业可以想明白道理，知道自己正真的敌人是谁
End
THANKS