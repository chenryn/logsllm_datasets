=== 资源
资源是权限操作的目标，日志易的资源有如下几种：
* 仪表盘
* 监控
* 告警插件
* 定时任务
* 报表
* 趋势图
* 数据集
* 已存搜索
* 搜索宏
* 字段提取
* 字典
* KV字典
* 拓扑图
* 全链路
* 知识库
* 指令配置
* 数据库连接配置
* Agent分组
* 应用
用户可以在不同类型资源的独立列表页完成大部分的资源管理操作。此外，也可以在总的资源列表页完成跨类型的标签管理、导入导出管理。
==== 资源的标签和组织管理
标签是资源的一个可选属性，使用标签可以对资源分门别类，统一管理，标签名称不必提前创建，域内唯一，直接在资源编辑页面上输入/提示/选择即可。
例如，可以直接在知识列表或新建/编辑知识页面，输入/选择标签，也可以不填写标签。在知识列表顶部则可以通过输入/选择标签，或者选择"无标签"，来过滤相关知识。
此外，资源还可以设置一个特殊的"组织标签"。一个资源只能设置一个组织标签。在总资源列表页左侧操作区域，可以选择展示组织标签目录，供快速选择。点击"设置-> 资源列表"打开资源列表页面，在左侧资源过滤上点击"设置"菜单，勾选打算启用的过滤项，可选择关键字过滤、组织结构、标签列表、资源类型、应用列表，其中关键字不区分大小写。选择多个过滤项时，可以拖拽改变上下排序。
image::images/resource-filter-area.png[]
资源列表页上组织结构展示和 Agent 分组列表页形式接近，但稍有区别，Agent 分组列表上组织目录的最底层会直接展示具体 Agent 分组，选中后页面右侧展示的是分组内的 Agent。
点击资源的标签修改操作，可以在弹层中输入普通标签和组织标签。系统会根据输入内容自动判断类型。当输入以 `org.` 开头时，即识别为组织标签，之后输入的字符串，按照英文句号自动切分组织层次。比如：`org.手机银行.web服务.集群2` 组织标签最后会在组织结构区域展示为三层组织目录。日志易限定组织标签最多允许四层结构。
image::images/resource-taglist.png[]
为了更好的提示标签类型的区别，组织标签和普通标签会采用不同的 icon 标记。
资源的标签只能由 admin 角色用户在资源列表页左侧删除。鼠标停留在待删除标签一行，右侧会浮现删除按钮，点击即可删除。 标签删除操作不会连带删除资源本身。
注意：组织标签有层次目录包含关系，内含子目录的组织标签无法直接删除，您必须从内往外逐一删除子目录后才能删除该组织标签。
==== 资源的授权
===== 资源的自我可见性
* 资源的创建者天然的具有对资源的所有管理权限。
* 用户新创建一个资源，仅创建者和拥有\__admin__角色的用户可见。
* 创建者可以通过"权限授予"过程，按需分享给其他用户。
* 拥有\__admin__角色的用户可以代为分享给其他用户。
===== 资源的角色授权
在资源列表页，点击资源操作中的"授权"，弹出授权层，可授权的权限包括：读取，编辑，删除，转授，同时还可以设置有效期，有效期作用于前面4个权限。
image::images/resource-authorize-in-listpage.png[]
为了方便用户的日常使用，系统默认将有权角色优先排序，并提供用户、用户分组、角色的快捷切换。您可以直接选择将资源分享给某个具体用户或用户分组。系统会在后台自动转换为该用户或用户分组的默认同名角色。当系统中角色较多时，可以在列表底部翻页器修改每页展示条数。
image::images/rbac-list-page-shouquan.png[]
===== 角色的资源授权
除了在列表页将资源授权给角色，还可以在角色权限页选择角色进行授权，即角色章节的资源授权。
image::images/rbac-authorize-alert.png[]
例如：在角色权限页选择角色"只读"，授权该角色"转授"仪表盘。
image::images/rbac-juese-shouquan.png[]
注意：在角色的授权页面勾选资源是不发送消息通知的，避免批量操作带来的爆炸刷屏。
===== 分享出去的资源是否能收回
如果用户对某角色有授权权限，当用户分享资源给这个角色时，用户可以收回分享出去的资源。如果用户对某角色没有授权权限，当用户分享资源给这个角色时，用户不可以收回分享出去的资源。
举例说明：用户"role-with-角色权限管理"对角色"只读"有授权权限，当用户分享资源给这个角色时，用户可以收回分享出去的资源。
* 用户"role-with-角色权限管理"登录，把自己创建的仪表盘dashboard_create_by_with分享给用户"role-without-角色权限管理"，可以如下图操作，在仪表盘列表页点击"授权"，在弹出层勾选角色"只读"，点击"确定"，则资源分享成功。
+ 
image::images/rbac-resource-can-takeback-a.png[]
* 再次点击该资源的"授权"，在弹出层可以看到，上一步的勾选框可以选择。
+
image::images/rbac-resource-can-takeback-a-2.png[]
* 用户"role-without-角色权限管理"登录，可以看到被分享过来的仪表盘dashboard_create_by_with，点击该资源的"授权"，在弹出层可以看到，"只读"角色不可以选择。
+
image::images/rbac-resource-can-takeback-b.png[]
举例说明：用户"role-without-角色权限管理"对用户"role-with-角色权限管理"的同名角色没有授权权限，当用户分享资源给这个角色时，用户不可以收回分享出去的资源。
* 用户"role-without-角色权限管理"把自己创建的仪表盘dashboard分享给用户"role-with-角色权限管理"，可以如下图操作，在仪表盘列表页点击"授权"，在弹出层勾选对应用户的同名关联角色，点击"确定"，则资源分享成功。
+
image::images/rbac-resource-cant-Recycle-a.png[]
* 再次点击该资源的"授权"，在弹出层可以看到，上一步的勾选框不可以选择。
+
image::images/rbac-resource-cant-takeback-a-2.png[]
* 用户"role-with-角色权限管理"登录，可以看到被分享过来的仪表盘dashboard，点击该资源的"授权"，在弹出层可以看到，当前用户同名角色的勾选框可以选择。
image::images/rbac-resource-cant-takeback-b.png[]
===== 资源的权限有效期
资源的权限有限期取多个角色的最大值。
===== 二次转授的时长限制
举例说明该功能：
1. creator授予给user1某个仪表盘10分钟权限；
2. 5分钟后，user1打算再转授这个仪表盘给user2；
3. 此时，user1最多只能给剩下的这5分钟。
===== 资源授权消息通知
发生资源的授予权限操作，通过消息通知系统，给被操作角色的对应用户发送提醒。内容为：
“您已被授权可访问/更新/删除xxx，有效期至yyyy，该授权不/可转授第三方”
例如下图：
image::images/notice-authored.png[]
提醒内容可点击，点击自动打开新窗口，定位到具体资源的详情页面，如告警历史、字段提取配置等。
=== 资源包导入导出
日志易支持将系统中现有的资源导出为资源包，或将资源包导入成为系统中可供直接使用的资源。
导入导出操作入口在资源列表页：
image::images/resourcegroup-import-export-button.png[]
==== 资源包导出
1. 点击导出按钮，资源列表页进入待选择状态：
+
image::images/resourcegroup-export-step1.png[]
2. 勾选待导出的资源后，点击确认导出，填写资源包名称：
+
image::images/resourcegroup-export-step2.png[]
+
* 如果选择后希望对已选中资源重新进行一定的调整，可以点击页面右上角的"已选中 N 个"字样，打开已选中资源弹窗，进行单独的删除操作：
+
image::images/resourcegroup-export-step2-delete.png[]
+
* 如果勾选资源中包含监控类型，填写资源包名称时，可以选择对监控关联的告警插件的处理：
+
image::images/resourcegroup-export-step2-alert.png[]
+
** 完整导出：默认行为，在导入其他系统时，会采用新资源包内的插件及配置项；
** 保留插件名称：只导出关联的插件名称，在导入其他系统时，如果已存在该名称的插件及配置项，则导入的监控会关联系统中已存在的同名插件及配置；
** 清空插件内容：导出时清除和告警插件相关的内容，在导入其他系统时，会变成一个未配置告警发送的监控项。
* 如果勾选资源中包含字段提取类型，填写资源包名称时，可以选择对字段提取规则关联的CSV字典的处理：
+
image::images/resourcegroup-export-step2-parserule.png[]
+
** 导出关联字典：默认行为，在导入时会替换为新资源包内的CSV字典；
** 不导出关联字典：只导出关联的字典表名称，在导入其他系统时，如果已存在同名的字典，则导入的字段提取规则会关联系统中已存在的同名字典表。如果不存在，字段提取规则会运行失败。
3. 生成资源包需要一点时间，稍微等待，即可看到导出成功提示：
+
image::images/resourcegroup-export-step3.png[]
[NOTE]
====
当前不支持导出KV字典、索引配置。
====
==== 资源包导入
点击导入按钮，打开资源包导入流程：
image::images/resourcegroup-import-upload.png[]
选择本地的资源包文件，并勾选一个系统中现存的角色。在导入流程结束后，被选中的角色会自动拥有导入的资源的全部权限。当然，你依然可以按照标准的角色权限流程管理被导入的资源。
选择数据集，添加一个或多个数据集，鼠标放在数据集的节点上可以看到节点对应的spl，选择数据集/节点，点击"确定"。
image::images/resourcegroup-import-add-dataset.png[]
点击下一步，进入资源预览。
image::images/resourcegroup-import-source-preview.png[]
资源可能会出现重名的状态，页面将高亮重名资源所在行，并用"已存在"标签标注系统内已有的资源。这一步的可选操作有：
** 点击资源的名称，修改为其他字符串，则冲突自动消失。
** 取消勾选某个资源，则导入后保留的是系统内已有的资源及其他依然被勾选的包内资源。
** 取消勾选系统内已存在的某个资源，则导入后使用资源包内的资源升级取代了原有资源。
** 一键覆盖系统内所有同名资源。
** 一键放弃上传包内所有同名资源。
** 不做修改，则导入后所有资源都被保留。
点击下一步，完成，页面显示导入成功。
注意：
1. 数据集的别名不允许重名，在资源包导入时，如果数据集的别名同名，建议修改名称，否则导入失败。
2. 字典不允许重名，在资源包导入时，如果字典同名，建议修改名称，否则导入失败。
3. 指令配置及其程序包均不允许重名，在资源包导入时，如果出现同名，建议修改名称，否则导入失败。
4. Agent 分组采集配置中的中心管理脚本不允许重名，在资源包导入时，如果出现同名，建议修改名称，否则导入失败。但本地脚本路径不做校验，实际上本地路径仅导出配置文本，不涉及脚本文件本身。制作资源包时建议优先采用中心管理脚本。
5. Agent 分组不允许重名，且 Agent 内置分组不可删除，在资源包导入时，如果出现同名，建议修改名称，否则将合并配置。
+
image::images/resourcegroup-import-source-preview-dataset.png[]
[NOTE]
====
数据权限是操作日志易系统的基础，导出的其他(告警、仪表盘、报表、定时任务)资源所依赖的数据权限不能确保被同期导出。如果导入后有告警不运行等情况，请检查对应数据权限是否在系统中真实存在且可用。您可以按照正常的编辑方式，给新告警更换一个更合适的数据权限。
====