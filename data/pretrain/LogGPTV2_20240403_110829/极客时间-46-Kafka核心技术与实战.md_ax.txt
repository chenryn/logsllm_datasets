## 如何配置？讲完了保存原理，我们来说说如何配置动态 Broker参数。目前，设置动态参数的工具行命令只有一个，那就是 Kafka 自带的kafka-configs 脚本。接下来，我来以 unclean.leader.election.enable参数为例，演示一下如何动态调整。下面这条命令展示了如何在集群层面设置全局值，即设置 cluster-wide 范围值。    $ bin/kafka-configs.sh --bootstrap-server kafka-host:port --entity-type brokers --entity-default --alter --add-config unclean.leader.election.enable=trueCompleted updating default config for brokers in the cluster,总体来说命令很简单，但有一点需要注意。**如果要设置 cluster-wide范围的动态参数，需要显式指定entity-default**。现在，我们使用下面的命令来查看一下刚才的配置是否成功。    $ bin/kafka-configs.sh --bootstrap-server kafka-host:port --entity-type brokers --entity-default --describeDefault config for brokers in the cluster are:  unclean.leader.election.enable=true sensitive=false synonyms={DYNAMIC_DEFAULT_BROKER_CONFIG:unclean.leader.election.enable=true}从输出来看，我们成功地在全局层面上设置该参数值为 true。注意sensitive=false的字眼，它表明我们要调整的参数不是敏感数据。如果我们调整的是类似于密码这样的参数时，该字段就会为true，表示这属于敏感数据。好了，调整完 cluster-wide 范围的参数，我来演示下如何设置 per-broker范围参数。我们还是以 unclean.leader.election.enable 参数为例，我现在为ID 为 1 的 Broker 设置一个不同的值。命令如下：    $ bin/kafka-configs.sh --bootstrap-server kafka-host:port --entity-type brokers --entity-name 1 --alter --add-config unclean.leader.election.enable=falseCompleted updating config for broker: 1.同样，我们使用下列命令，来查看一下刚刚的设置是否生效了。    $ bin/kafka-configs.sh --bootstrap-server kafka-host:port --entity-type brokers --entity-name 1 --describeConfigs for broker 1 are:  unclean.leader.election.enable=false sensitive=false synonyms={DYNAMIC_BROKER_CONFIG:unclean.leader.election.enable=false, DYNAMIC_DEFAULT_BROKER_CONFIG:unclean.leader.election.enable=true, DEFAULT_CONFIG:unclean.leader.election.enable=false}这条命令的输出信息很多。我们关注两点即可。1.  在 Broker 1 层面上，该参数被设置成了 false，这表明命令运行成功了。2.  从倒数第二行可以看出，在全局层面上，该参数值依然是    true。这表明，我们之前设置的 cluster-wide 范围参数值依然有效。如果我们要删除 cluster-wide 范围参数或 per-broker范围参数，也非常简单，分别执行下面的命令就可以了。    
# 删除 cluster-wide 范围参数$ bin/kafka-configs.sh --bootstrap-server kafka-host:port --entity-type brokers --entity-default --alter --delete-config unclean.leader.election.enableCompleted updating default config for brokers in the cluster,    
# 删除 per-broker 范围参数$ bin/kafka-configs.sh --bootstrap-server kafka-host:port --entity-type brokers --entity-name 1 --alter --delete-config unclean.leader.election.enableCompleted updating config for broker: 1.**删除动态参数要指定delete-config**。当我们删除完动态参数配置后，再次运行查看命令，结果如下：    
# 查看 cluster-wide 范围参数$ bin/kafka-configs.sh --bootstrap-server kafka-host:port  --entity-type brokers --entity-default --describeDefault config for brokers in the cluster are:    
# 查看 Broker 1 上的动态参数配置$ bin/kafka-configs.sh --bootstrap-server kafka-host:port  --entity-type brokers --entity-name 1 --describeConfigs for broker 1 are:此时，刚才配置的所有动态参数都已经被成功移除了。刚刚我只是举了一个参数的例子，如果你想要知道动态 Broker参数都有哪些，一种方式是在 Kafka 官网中查看 Broker端参数列表，另一种方式是直接运行无参数的 kafka-configs脚本，该脚本的说明文档会告诉你当前动态 Broker参数都有哪些。我们可以先来看看下面这两张图。![](Images/e19d89efce7b67797e89625c71f80cad.png){savepage-src="https://static001.geekbang.org/resource/image/40/f1/400532989c3214f00a2f764fe7983cf1.png"}![](Images/048574beec762f7a519f7f4257c5ba91.png){savepage-src="https://static001.geekbang.org/resource/image/eb/67/eb99853bca3d91ad3a53db5dbe3e3b67.png"}看到有这么多动态 Broker参数，你可能会问：这些我都需要调整吗？你能告诉我最常用的几个吗？根据我的实际使用经验，我来跟你分享一些有较大几率被动态调整值的参数。**1.log.retention.ms。**修改日志留存时间应该算是一个比较高频的操作，毕竟，我们不可能完美地预估所有业务的消息留存时长。虽然该参数有对应的主题级别参数可以设置，但拥有在全局层面上动态变更的能力，依然是一个很好的功能亮点。**2.num.io.threads 和 num.network.threads。**这是我们在前面提到的两组线程池。就我个人而言，我觉得这是动态 Broker参数最实用的场景了。毕竟，在实际生产环境中，Broker端请求处理能力经常要按需扩容。如果没有动态 Broker参数，我们是无法做到这一点的。**3. 与 SSL 相关的参数。**主要是 4个参数（ssl.keystore.type、ssl.keystore.location、ssl.keystore.password和ssl.key.password）。允许动态实时调整它们之后，我们就能创建那些过期时间很短的SSL 证书。每当我们调整时，Kafka 底层会重新配置 Socket 连接通道并更新Keystore。新的连接会使用新的Keystore，阶段性地调整这组参数，有利于增加安全性。**4.num.replica.fetchers。**这也是我认为的最实用的动态 Broker 参数之一。Follower副本拉取速度慢，在线上 Kafka环境中一直是一个老大难的问题。针对这个问题，常见的做法是增加该参数值，确保有充足的线程可以执行Follower 副本向 Leader 副本的拉取。现在有了动态参数，你不需要再重启Broker，就能立即在 Follower 端生效，因此我说这是很实用的应用场景。
## 小结好了，我们来小结一下。今天，我们重点讨论了 Kafka 1.1.0 版本引入的动态Broker 参数。这类参数最大的好处在于，无需重启Broker，就可以令变更生效，因此能够极大地降低运维成本。除此之外，我还给出了动态参数的保存机制和设置方法。在专栏的后面，我还会给出动态参数设置的另一种方法，敬请期待。![](Images/c19dc80010ab3b9fc25985f25e916baa.png){savepage-src="https://static001.geekbang.org/resource/image/c7/fc/c7e3eff159216101b78911221fae4afc.png"}
## 开放讨论目前，社区只是将一部分 Broker参数升级为动态参数，在实际使用过程中，你觉得还有哪些参数也应该变为可动态修改？欢迎写下你的思考和答案，我们一起讨论。如果你觉得有所收获，也欢迎把文章分享给你的朋友。![](Images/a7d15815f9efb5693db5b2d278244658.png){savepage-src="https://static001.geekbang.org/resource/image/c8/bf/c89da43deab85fe7cb06acec867aa5bf.jpg"}