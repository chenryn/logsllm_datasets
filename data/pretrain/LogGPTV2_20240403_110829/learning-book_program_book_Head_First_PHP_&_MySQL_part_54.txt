大箭头显示主键连
据相关联，通过将数据分散到多个表中，我们就能消除重复
数据，得到一个高效的数据库。所以，即使是最简单的数据
接到外键，从而将
库模式中，外键也有着很重要的地位。
表关联在一起。
436
第8章
---
## Page 473
控制你的数据，世界在你手中
使用外键
采用可视化方式将数据流程描述为表，并通过主键和外键将表相
互连接，这通常很有帮助。再来更仔细地查看包含一些具体数据的
Mismatch表，这有助于揭示主键和外键相互之间如何关联。
use_id外键作为mismatch_uset表中用
作为一个主键，usen_id在mismatch_
户行的一个引用，使你能够知道哪
topic_id主键作为
aser表中必须唯一。实际上，这正
个用户与一个给定响应相关联。
mismatch_topic表中主题
是其作用提供对用户行的惟一
行的唯一索引。
引用。
mismatch_user
mismatch_topic
topi_idO-
nome
TalMoos
jnetfes
2
Cowboy hats
Appearance
3
Reality TV
Entertain
4
Horrormovies
Entertair
要记住，这个表中的
每一行对应于一个
Mismatch用户。
这个表中的每一行是一个
好恶响应的名/类别，但
mismatch
Tesponse
不是响应本身。
Pes
response
mer
这个表中的每一行是
topic_id外键引用mismatch_
一个特定用户做出的
101
Love
Love
11
topic表中的主题行.由于
一个好恶响应。
102
2
Hate
11
多个不同用户可能对相同
103
3
主题做出响应，所以这不
104
Love
4
是唯一的。
在mismatch_response表中，通过在mismatch_user表中查找
user_id，可以找到输入响应的用户的更多有关信息。类似地，通过在
aser_id外键将一个响应行与
mismatch_topic表中查找topic_id，可以找到一个响应的主题名及
mismatch_user表中的用户行关联
其类别。
在一起。由于一个用户可以有多
个好恶响应，所以这不是唯一的。
通过用主键和外键建立表的关联，使我们可以采用一种一致的方式连接
这些表中的数据。甚至可以将数据库建构为要求主键和其相应外键必须匹
配。这称为引用完整性（referentialintegrity），这是表示所有键引用都必
须合法的另一种说法。
你现在的位置》
437
---
## Page 474
表之间的关系类型
我理解主键和外键将多个表连接在一起，但
是达些围表中键之间箭头的方向有什么含义
没错，箭头的方向告诉我们各个表中的行如何相互关联。
更确切地讲，它们指出了一个表中有多少行可以在另一个表中有匹
配行，反之亦然。这是数据库模式设计中的一个很重要的方面，包
括3种可能的数据模式：一对一、一对多和多对多。
表可以建立行与行的匹配
第一种模式是“一对一”（one-to-one），即表A中的一行在表B中至多
有一个匹配行，反之亦然。所以各个表中对于每一行只可能有一个匹配，
TableA
TableB
举例来说，假设Mismatch用户表分解为两个表，一个对应登录信息（表
A），另一个包含情况简表数据（表B）。这两个表都包含一个用户ID以
保证用户连接到其情况简表。登录表中的user_id列是一个主键，确保
用户登录的唯一性。情况简表表中的user_id是一个外键，其作用不同，
匹配
因为它的任务只是将一个情况简表与一个登录连接。
仅一行
对
仅一行
（这些行中）
（这些行中）
mismatch_user_profile
mismatch_user_login
一对一，所以
lest_mon
join_dete
gender
wser_d
PUIOUISA
pOussd
没有箭头。
08447b.
2008-05
7
Johan
Nettles
M
9
dierdre
8
Jason
Filmington
230dcb
2008-05.
M
baldpaul
8
10
2008-05.
9
Paul
Hillsmon.....
e511d7..
M
jnetles
10
（）
12
robyr
062e4a
2008-06.
这些表通过user_id
theking
b4f283.
2008-06
建立了一对一的
13
美系。
根据这两个userid列，可以认为登录表是一个父表，而情况简表表
是一个子表，包含主键的表与有相应外键的表之间存在一种父子关系。
438
第8章
---
## Page 475
控制你的数据，世界在你手中
一行指向多行
TableA
TableB
对多是指，表A中的一行在表B中可以有多个匹配行。但是表B中的一
行只能与表A中的一行匹配。示意图中的箭头方向总是从可以有一行的
表指向可以有多行的表。
区配
仍以Mismatch数据库为例，当前模式就使用了一对多的数据模式。由
一行
对
+
多行
于用户可以有多个主题响应（喜欢纹身，讨厌远足等），所以在用户行
（这些行中）
（这些行中）
和响应行之间存在一种一对多的关系。user_id列将这两个表相连接，
它在mismatch_user表中作为主键，而在mismatch_response中
主键。
作为外键。
mismatch_user
外键！
wer_O
pessword
逐过user_id存
mismatch_response
在一种一对多
dierdre
08447b.
美系。
opk
10
baldpaul
230dcb.
jnetles
e511d7....
101
tove
102
Love
1
12
rubyr
062e4a.
Hate
11
2
13
theking
b4f283.
103
11
104
Love
3
thereareno
DumbQuestions
是一对多关系呢？
一对一:
一对多：
父表中的
关系而不是一对一关系，而且这是合理的。通
常会有一个主（父）表，其中包含主要数据，
父表中的一
如Mismatch中的用户，这个表采用一种一对
一行与子
行与子表中
多的组织方式连接到一个次（子）表。这在
表中的一
Mismatch模式中发生了两次，用户和主题都
的多行关联
与响应存在一对多关系。
行关联。
在很多情况下，两个表中有一对一关系的行可
以结合到同一个表中。不过，当然也有一些情
况适合采用一对一模式，例如上一页上假想的
用户情况简表例子，这里出于一种安全考虑可
能希望把一部分数据移至单独的表中。
你现在的位置》
439
---
## Page 476
多对多关系
多对多的行匹配
TableA
TableB
第3个也是最后一个表行关系数据模式是多对多关系，即表A中的多个
数据行与表B中的多行匹配这类似于数据重载！但不确切。很多
情况下多对多模式是保证的。Mismatch呢？也许吧。下面来看看。
匹配
多行
←
对
+
多行
（这些行中）
（这些行中）
mismatch_user
用户和主题通过响应存在一
种多对多关系。
mismatch_topic
poMssod
nome
dierdre
08447b..
1
Taffoos
Appearance
10
baldpaul
230dcb..
2
Cowbay hats
Appearance
jnetties
e511d7.
>
Reality TV
Entertainment
7112
rubyr
062e4a.
多对多！
74
Horrormovies
Entertoinment
b4f283.
对多
13
theking
mismatch
response
repe_dO
respose
lopikid
Hate
一对多。
1
82
Love
2
83
Love
9
84
Hate
9
4
mismatch_response
101
Love
1
是一个联接表，它
102
Love
2
在用户及其对主题
103
Hate
3
的响应之间建立了
104
Love
一个关系。
多对多：
Mismatch中的多对多模式是间接的，这说明这是通过mismatch_response
表完成的。不过这种模式确实存在。可以看看mismatch_response中出现
父表中的多
了多少个相同的user_id和topic_id。
行与子表中
除了包含响应数据外，mismatch_response表相当于所谓的联接表，它为
的多行关联
用户和主题提供了一个方便的中转站。如果没有这个联接表，就会出现大量
重复数据，这可不是好事。如果你还不以为然，可以翻回到本章前面关于模
式的练习，再仔细查看第2种设计。在这个设计中，mismatch_topic表合
并到mismatch_response表中，导致了大量重复数据。
440
第8章
---
## Page 477
控制你的数据，世界在你手中
命名关系
在以下各个表中，有一些列被圈出，它们可以移出到其自已的表中。请写出这
些列与原表最好表示为一种一对一、一对多还是多对多关系，然后画出这个关
系，用一条线连接这两个表，并加上适当的箭头。
关系
addtess
user
mismatch_user
MOP!osn
address
employer
friends
briend
mismatch_topic
catesory
topic
topic_idOt
name
category
你现在的位置
441
---
## Page 478
关系命名答案
关系命名答案
在以下各个表中，有一些列被圈出，它们可以移出到其自己的表中。请写出这
些列与原表最好表示为一种一对一、一对多还是多对多关系，然后画出这个关
系，用一条线连接这两个表，并加上适当的箭头。
关系
对于任何给定用户只有一个
家庭地址，这说明地址行与
用户行存在一种一对一的
address
user
美系。
mismatch_user
user_idO
address
employer
sahojdwa
user