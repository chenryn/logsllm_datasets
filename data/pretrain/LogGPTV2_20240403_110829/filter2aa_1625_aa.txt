侧信道分析
感谢北京理⼯⼤学-王安教授的讲解
0x00 什么是侧信道
什么是侧信道？⼀个简单的例⼦就是某些泡⾯和饮料中奖，以可能会随机附赠⽕腿肠，⽽带有⽕腿肠的桶和不带⽕
腿肠的桶重量不⼀样，摇晃起来响声不⼀样，通过摇晃我们能简单分析出“哪桶是中奖了的泡⾯”这⼚商不希望我们
知道的信息，这就是侧信道。这样的例⼦在⽣活中还有很多，⽐如对于⼩区按键门禁，长期按的⼏个键上的油脂、
指纹、磨损，同样也是我们猜解其密码的侧信道信息，⽐如⼀个六位数密码的门禁，猜测空间是106 ⽽当我们获知
其密钥的组合时，我们猜测空间就降低到了 6!
相对于偏社会⼯程学⼀点的例⼦，看见⼩区⼀家⼈扔垃圾，⽽他们扔的垃圾⾥⾯有：婴⼉奶粉罐头瓶、啤酒瓶、少
量烟头、头发丝团、外卖盒等，根据这些侧信息能得出什么结论呢？
猜测是：这家三⼜，男主⼈爱饮酒，⼥主⼈留长发，有个⼀两岁岁⼤的婴⼉，男主⼈没有⼯作或者⼯作时间较为⾃
由，⼥主⼈外出⼯作到很晚，根据婴⼉奶粉价格还可以估算出该家庭的⼤致情况，如果婴⼉奶粉属于中等偏上的价
位，那么就是男主⼈是作家⼀类的可以在家⼯作的职业，⽽⼥主⼈的⼯作是家庭主要稳定收⼊来源
为什么呢？在这个例⼦中，侧信息怎么映射到真实信息上去的呢？
因为⼀般⽗母都会选择给婴⼉喝⾃⼰承受价位内最好的奶粉 ，所以据此可以很好估算出家庭经济状况，在⼀家三⼜
的情况下，垃圾中有外卖盒反映不常做饭，结合啤酒瓶，推测出⼥主⼈饭点⼤概率不在家，也就是加班到很晚。在
有婴⼉需要照顾的情况下加班到很晚，那就说明⼥主⼈的经济来源是家⾥⼀⼤⽀柱，结合烟头和有婴⼉的情况亦可
以推测男主⼈⼀直  在家，可能没⼯作或者从事作家类的⾃由职业，结合烟头判断作家类职业概率⾼。整体佳通状
况可以看出，男主⼈能做到有收⼊，但是不多，也不稳定
⾔归正传，那什么是侧信道呢？
我的理解是侧信道就是在做正常⾏为的时候，⾏为本⾝所带来的对环境的扰动，产⽣的各种信息
核⼼思路就是⾏为本⾝不⼀样，对物理环境的扰动不⼀样，扰动提供的信息也不⼀样。⽽有⼼者可以通过分析这些
侧信息，反推出⾏为本⾝，这就是侧信道
0x01 密码学中的侧信道
经典密码学中，基本假设是密钥计算时是安全的，攻击者不可接触的
⽽侧信道分析中，通过不同的视⾓，去审视密码设备在运⾏过程中与外界环境存在的物理交互，通过这些物理扰动
信息，泄露可获取密钥信息
计时攻击 [CRYPTO 1996 提出]
P. Kocher: Timing Attacks on Implementations of Diffie-Hellman, RSA, DSS, and Other Systems. CRYPTO 
1996, LNCS, vol. 1109, pp. 104-113, Springer, Heidelberg (1996)
计时攻击运⽤⽐较⼴泛，在很多场景都可以使⽤，⽐如SQL injection⾥⾯的时间盲注，⽐如⼀些软件实现的密码学
操作，或者密钥验证算法。⽐如经典的linux的strcmp命令，其实际实现⽅式是逐个字节进⾏⽐较
如果我们进⾏测试的话，⽐如6位数字密钥，调⽤strcmp进⾏⽐较，当我们第⼀位猜测正确的时候，strcmp会继续
⽐较下⼀字节，错误的话就会终⽌，在运算时间上⾯是有不⼩差异的。我们可以逐位进⾏猜解，把猜解空间从106 
次⽅降低为60，基本等于破解密码
static inline int strcmp（const char * cs,const char * ct） {
    int d0, d1;
    register int __res;
     __asm__ __volatile__（ 
    "1:\tlodsb\n\t" //装⼊串操作数，即从DS段中esi位置的字符传送到 al 寄存器，然后 esi 根据
DF指向串中下⼀个元素 ，DF=0，增加；DF=1，减少
    "scasb\n\t" //扫描串操作数，即从 al 中减去ES段中edi位置的字符，不保留结果，只改变标志 
CF,AF,PF,SF,OF,ZF，若字符相等，ZF=1,否则ZF=0。若DS段中字符⼩于ES段中串，则CF=1，后⾯sbb运算
会出现-1
    "jne 2f\n\t" //如果两个字符不相等，则转到标号
    "testb %%al,%%al\n\t" //如果al中全是0，则ZF=1(逻辑与结果为0)，如果字符串结束遇到null零
    "jne 1b\n\t" //如果ZF=0（逻辑与结果不为0）即字符串未结束，则继续⽐较
    "xorl %%eax,%%eax\n\t" //⾃身异或，结果为0，CF=0，eax清空
    "jmp 3f\n" //向前跳⾄3:，退出，返回值为0
    "2:\tsbbl %%eax,%%eax\n\t" //32位sbb src,dest；dest-src-CF，存⼊dest，如果CF=1，
则结果为-1（全是1）；否则为0。（结果为-1时标志位：CF=1，SF=1,OF=1,ZF=0,PF=1)
    "orb $1,%%al\n" //对0位或1，保证结果为-1或者1。如果结果为0，或1之后为1，即字符⼤，返回
1，字符⼩，返回-1
    "3:"
    :"=a" （__res）, "=&S" （d0）, "=&D" （d1）
    :"1" （cs）,"2" （ct））; 
    return __res; 
}
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
计时攻击就是通过时间上泄露出来的测信息来进⾏分析的攻击⼿段
能量分析攻击 [CRYPTO 1999]
在实际硬件运算中，计算是由底层的运算单元和逻辑电路完成的，每个运算所需要的电路不同，电路从电源总线上
索取的电压也不同，简单来说就是给⼀份能量⼲⼀份活
能量分析也可以类⽐为，通过看某户⼈家的⽔表电表的消耗，判断这家有多少⼈在，活动时间多久，在⼲什么，有
什么电器