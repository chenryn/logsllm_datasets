Reference
7
echo
53
DNS
67
DHCP server (BootP)
68
DHCP client
69
Trivial File Transfer Protocol 
(TFTP)
111
Remote Procedure Call (RPC)
123
Network Time Protocol
RFC 1305
137
Windows Name Service (WINS)
138
Windows Datagram Service
161
Simple Network Management 
Protocol (SNMP)
427
SLP (service location)
497
Retrospect
513
who
514
Syslog
554
Real-Time Streaming Protocol 
(QTSS)
600–1023
Mac OS X RPC-based services 
(for example, NetInfo)
985
NetInfo (when a shared domain 
is created using NetInfo Domain 
Setup)
2049
Network File System (NFS)
3031
Program Linking
3283
Apple Network Assistant, Apple 
Remote Desktop
5353
Rendezvous (mDNSResponder)
6970 and up
QTSS
7070
Real-Time Streaming Protocol 
alternate (QTSS)
TCP port
Used for
Reference
LL2351.Book  Page 65  Monday, September 8, 2003  2:47 PM
66
Chapter 3    IP Firewall Service
Where to Find More Information
For more information about ipfw:
You can find more information about ipfw, the process which controls IP firewall 
service, by accessing its man page. It explains how to access its features and implement 
them. To access the man page use the Terminal application to enter:
man ipfw
Request For Comment Documents
Request for Comments (RFC) documents provide an overview of a protocol or service 
and details about how the protocol should behave. If you’re a novice server 
administrator, you’ll probably find some of the background information in an RFC 
helpful. If you’re an experienced server administrator, you can find all the technical 
details about a protocol in its RFC document. You can search for RFC documents by 
number at the website www.faqs.org/rfcs. The “Port Reference” section contains several 
RFC numbers for various protocols.
Additionally, important multicast addresses are documented in the most recent 
Assigned Numbers RFC, currently RFC 1700.
LL2351.Book  Page 66  Monday, September 8, 2003  2:47 PM
4
67
4 NAT Service
Network Address Translation (NAT) is sometimes referred to as IP masquerading, or IP 
aliasing. NAT is used to allow multiple computers access to the Internet with only one 
assigned IP address. NAT allows you to create a private network which accesses the 
Internet through a NAT router or gateway.
The NAT router takes all the traffic from your private network and remembers which 
internal address made the request. When the NAT router receives the response to the 
request, it forwards it to the originating computers. Traffic that originates from the 
Internet does not reach any of the computers behind the NAT router unless Port 
forwarding is enabled.
Enabling NAT on Mac OS X Server requires detailed control over DHCP, so DHCP is 
configured separately in Server Admin. To learn more about DHCP, see Chapter 1, 
“DHCP Service,” on page 7.
Enabling NAT also automatically creates a divert rule to the Firewall configuration.
Starting and Stopping NAT Service
You use Server Admin to start and stop NAT service on your default network interface. 
Starting NAT service also starts DHCP for the default interface.
To start NAT service:
1 In Server Admin, select NAT from the Computers & Services pane.
2 Click Start Service.
When the service is running, Stop Service becomes available.
LL2351.Book  Page 67  Monday, September 8, 2003  2:47 PM
68
Chapter 4    NAT Service
Configuring NAT Service
You use Server Admin to indicate which network interface is connected to the Internet 
or other external network.
To configure NAT service:
1 In Server Admin, select NAT from the Computers & Services pane.
2 Click Settings.
3 Choose the network interface from the “Share your connection from:” pop-up menu.
This interface should be the one that connects to the Internet or external network.
4 Click Save.
Monitoring NAT Service
You might want to monitor your NAT service for troubleshooting and security. This 
section describes the NAT status overview and monitoring NAT divert activity.
Viewing the NAT Status Overview
The NAT status overview allows you to see if the service is running, and how many 
protocol links are active.
To see the overview:
1 In Server Admin, choose NAT Service from the Computers & Services list.
2 Click the Overview button.
Viewing NAT Activity
When the NAT service is running, it creates a packet divert filter in the IP Firewall 
service. You can view NAT packet divert events which have been logged by the firewall 
service. The logs are useful for network troubleshooting and configuration. To 
troubleshoot NAT, you should create the rule manually and enable logging for the 
packets allowed by the rule.
LL2351.Book  Page 68  Monday, September 8, 2003  2:47 PM
Chapter 4    NAT Service
69
To view the NAT divert log:
1 In the Terminal application enter:
ipfw add 10 divert natd all from any to any via 
Where  is the network interface selected in the NAT section of 
Server Admin.
2 In Server Admin, choose Firewall from the Computers & Services list.
3 Click Settings.
4 Select the Advanced tab.
5 Select the rule that was just created.
6 Click the Edit button.
7 Choose to log packets that match the filter.
8 Click OK.
9 In Server Admin, choose NAT Service from the Computers & Services list.
10 Click Settings.
11 Click Logging.
12 Enable logging.
13 Click Save.
14 Click the Log button to view the log.
Where to Find More Information
For more information about natd:
You can find more information about natd, the daemon process which controls NAT 
service, by accessing its man page. It explains how to access its features and implement 
them. To access the man page use the Terminal application to enter:
man natd
Request For Comment Documents
Request for Comments (RFC) documents provide an overview of a protocol or service 
and details about how the protocol should behave. If you’re a novice server 
administrator, you’ll probably find some of the background information in an RFC 
helpful. If you’re an experienced server administrator, you can find all the technical 
details about a protocol in its RFC document. You can search for RFC documents by 
number at the website www.faqs.org/rfcs.
For NAT descriptions, see RFC 1631 and RFC 3022.
LL2351.Book  Page 69  Monday, September 8, 2003  2:47 PM
LL2351.Book  Page 70  Monday, September 8, 2003  2:47 PM
5
71
5 VPN Service
Virtual Private Network (VPN) is two or more computers or networks (nodes) connected 
by a private link of encrypted data. This link simulates a local connection, as if the 
remote computer were attached to the local area network (LAN).
VPNs allow users at home or otherwise away from the LAN to securely connect to it 
using any network connection, such as the Internet. From the user’s perspective, the 
VPN connection appears as a dedicated private link.
VPN technology also allows an organization to connect branch offices over the 
Internet, while maintaining secure communications. The VPN connection across the 
Internet acts as a wide area network (WAN) link between the sites.
VPNs have several advantages for organizations whose computer resources are 
physically separated. For example, each remote user or node uses the network 
resources of its Internet Service Provider (ISP) rather than having a direct, wired link to 
the main location. VPNs also allow verified mobile users to access private computer 
resources (file servers, etc.) from any connection to the Internet. Finally, VPN can link 
multiple LANs together over great distances using existing Internet infrastructure.
This chapter describes VPN authentication method, transport protocols, and how to 
configure, manage, and monitor VPN service. It does not include instructions for 
configuring VPN clients for use of your VPN server.
LL2351.Book  Page 71  Monday, September 8, 2003  2:47 PM
72
Chapter 5    VPN Service
VPN and Security
VPNs stress security by strong authentication of identity, and encrypted data transport 
between the nodes, for data privacy and inalterability. The following section contains 
information about each supported transport and authentication method.
Authentication Method
Mac OS X Server VPN uses Microsoft’s Challenge Handshake Authentication Protocol 
version 2 (MS-CHAPv2) for authentication. It is also the standard Windows 
authentication scheme for VPN. This authentication method encodes passwords when 
they’re sent over the network, and stores them in a scrambled form on the server 
offering good security during network transmission.
This authentication method is the default and available for both transport protocols 
described in the following section. 
Mac OS X Server supports several authentication methods. Each has its own strengths 
and requirements. It is not possible to choose your authentication method using Server 
Admin. If you need to configure a different authentication scheme from the default (for 
example, to use RSA Security’s SecurID authentication), you’ll need to edit the VPN 
configuration file manually. The configuration file is located at:
/Library/Preferences/SystemConfiguration/com.apple.RemoteAccessServers.plist
Transport Protocols
You’ll be able to enable either or both of the encrypted transport protocols. Each has 
its own strengths and requirements.
Point to Point Tunneling Protocol (PPTP)
PPTP is the Windows standard VPN protocol. PPTP offers good encryption and supports 
a number of authentication schemes. It uses the user-provided password to produce an 
encryption key. You can also allow 40-bit (weak) security encryption in addition to the 
default 128-bit (strong) encryption if needed by your VPN clients.
PPTP is necessary if you have Windows or Mac OS X 10.2.x clients.
Layer Two Tunnelling Protocol, Secure Internet Protocol (L2TP/IPSec)
L2TP/IPSec uses strong IPSec encryption to “tunnel” data to and from the network 
nodes. It is essentially a combination of Cisco’s L2F and PPTP. IPSec requires Security 
Certificates from a Certificate Authority like Verisign, or a pre-defined shared secret 
between connecting nodes. The shared secret must be entered on the server as well as 
a client. It is not a password for authentication, but it is used to generate encryption 
keys to establish secure tunnels between nodes.
LL2351.Book  Page 72  Monday, September 8, 2003  2:47 PM
Chapter 5    VPN Service
73
Before You Set Up VPN Service
Before setting up Virtual Private Network (VPN) service, you need to determine which 
transport protocol you’re going to use. The table below shows which protocols are 
supported by different platforms.
If you’re using L2TP, you need to have a Security Certificate from a Certificate Authority 
like Verisign, or a pre-defined shared secret between connecting nodes. If you choose a 
shared secret, it needs to be secure as well (8-12+ alphanumeric characters with 
punctuation) and kept secret by the users.
If you’re using PPTP, you need to make sure all of your clients support 128-bit PPTP 
connections, for greatest transport security. Be aware that enabling 40-bit transport 
security is a serious security risk.
Managing VPN Service
This section describes tasks associated with managing VPN service. It includes starting, 
stopping, and configuring the service.
Starting or Stopping VPN Service
You use Server Admin to start and stop VPN service. 
To start or stop VPN service:
1 In Server Admin, choose the VPN Service from the Computers & Services list.
2 Make sure at least one of the transport protocols is checked and configured.
3 Click Start Service or Stop Service.
When the service is turned on, the Stop Service button is available.
Enabling and Configuring L2TP Transport Protocol
Use Server Admin to designate L2TP as the transport protocol. By enabling this 
protocol, you must also configure the connection settings. You must designate an IPSec 
shared secret (if you don’t use a Certificate Authority’s Security Certificate), the IP 
address allocation range to be given to your clients, and group to be allowed VPN 
priviledges (if desired). If both L2TP and PPTP are used, each protocol should have a 
separate, non-overlapping address range.
If you have...
you can use L2TP/IPSec.
you can use PPTP.
Mac OS X 10.3.x clients
X
X
Mac OS X 10.2.x clients
X
Windows clients
X (if Windows XP)
X
Linux or Unix clients
X
X
LL2351.Book  Page 73  Monday, September 8, 2003  2:47 PM
74
Chapter 5    VPN Service
To enable L2TP:
1 In Server Admin, choose the VPN Service from the Computers & Services list.
2 Click Settings.
3 Select the General tab.
4 Select L2TP.
5 Enter the shared secret.
6 Set the beginning IP address of the allocation range.
7 Set the ending IP address of the allocation range.
8 Enter the group that has access to VPN login.
You can use the Users & Groups button to browse for a group.
If you leave this blank, all workgroups will have access to VPN login.
9 Click Save.
Enabling and Configuring PPTP Transport Protocol
Use Server Admin to designate PPTP as the transport protocol. By enabling this 
protocol, you must also configure the connection settings. You should designate an 
encryption key length (40-bit in addition to 128-bit), the IP address allocation range to 
be given to your clients, and group to be allowed VPN priviledges (if desired). If both 
L2TP and PPTP are used, each protocol should have a separate, non-overlapping 
address range.
To enable PPTP:
1 In Server Admin, choose the VPN Service from the Computers & Services list.
2 Click Settings.
3 Select the General tab.
4 Select PPTP.
5 If desired, select “Allow 40-bit encryption keys” to allow such keys to be used in 
addition to 128-bit keys.
6 Set the beginning and IP addresses of the allocation range.
7 Enter the group that has access to VPN login.
You can use the Users & Groups button to browse for a group.
If you leave this blank, all workgroups will have access to VPN login.
8 Click Save.
Warning:  Allowing 40-bit encryption keys is less secure, but may be necessary for 
some VPN client applications.
LL2351.Book  Page 74  Monday, September 8, 2003  2:47 PM
Chapter 5    VPN Service
75
Configuring Additional Network Settings for VPN Clients
When a user connects in to your server through VPN, that user is given an IP address 
from your allocated range. If this range is not served by a DHCP server, you’ll need to 
configure additional network settings. These setting include the network mask, DNS 
address, and search domains.
To configure addition network settings:
1 In Server Admin, choose the VPN Service from the Computers & Services list.
2 Click Settings.
3 Select the Client Information tab.
4 Enter the network mask for your allocated IP address range.
5 Enter the IP address of the DNS server.
6 Enter any search domains, as needed.
7 Click Save.
Configuring VPN Network Routing Definitions
Network routing definitions allow you to route data to from some specific address 
either through the VPN tunnel or the insecure network. For example, you may want all 
traffic that goes to the LAN IP address range to go through the secure tunnel to the 
LAN, but make all traffic to other addresses to be routed through the user’s normal, 
unsecured Internet connection.This helps you have a finer control over what goes 
through the VPN tunnel.
The following definitions are unordered; they apply only the description that most 
closely matches the packet being routed.
To set routing definitions:
1 In Server Admin, choose VPN Service from the Computers & Services list.
2 Click Settings.
3 Select the Client Information tab.
4 Click the Add button below the routing definition list.
5 Enter the address range of the packets to be routed.
6 Enter the network mask of the address range to be routed.
7 Select the routing destination from the pop-up menu.
Private means to route it through the VPN tunnel.
Public means to use the normal interface with no tunnel.
LL2351.Book  Page 75  Monday, September 8, 2003  2:47 PM
76
Chapter 5    VPN Service
Monitoring VPN Service
This section describes tasks associated with monitoring a functioning VPN service. It 
includes accessing status reports, setting logging options, viewing logs, and 
monitoring connections.
Viewing a VPN Status Overview
The VPN Overview gives you a quick status report on your enabled VPN services. It tells 
you how many L2TP and PPTP clients you have connected, which authentication 
method is selected, and when the service was started.
To view the overview:
1 In Server Admin, choose VPN Service from the Computers & Services list.
2 Click the Overview button.
Setting the Log Detail Level for VPN Service