SQL优化
系统接口
可以根据业务特点来融入到资源申请
作为一种专业能力输出展示出来，比
工单接口
运维侧的精力就可以
工作流接口
---
## Page 585
析它，把它拆分为符合业务属性的工单。
据这个唯一的编号能够从工单系统中得到一个JSON数据串，得到这个数据串之后，我来解
的工单系统中完成，而工单的信息一定有一个流水编号，是唯一的 ID 值，我需要的就是根
细粒度的管控和工单数据分析，这个阶段的时间周期会长一些。
或者简单来说，让工单系统接入运维系统接口；第三阶段接入更多的工单类型，实现一些更
维系统接入工单接口；第二阶段是在流程闭环上下功夫，即把工单的处理实现流程化管理，
这个阶段的时间周期会长一些，在接入前期会制定一些规则规范。这个阶段简单理解就是运
作和调试成本。如果步子太大，不但可能达不到预期，还会为后期的接入带来一些隐患。
系不同，接口规范不同，认证机制不同等，刚开始就做深度对接，在前期会有很多额外的工
的业务范围，把每一个环节都做到了可控和可量化考核。
善的链条了。
基本操作和审批是脱节的，那就需要完成工单的自动化处理。互相促进之后，这就是一个完
单肯定没有自动化运维的辅助，所以肯定只有工单模块，但是早期的工单模块建设不够完善，
有一定的关系。
模块，有的叫做 MIS，有的和工作流是独立的模块，本质上还是和各个公司所处的行业属性
15.4.2
足需求。
入 SQL 审核，比如 SQL质量不足60 分，工单没法提交等。
为了业务效率的提升，我们可以把多类工作整合起来，在这个里面实现工单的拆解。
一所以从建设的思路来说，第一步是申请工单系统的接口权限，即工单的审批还是在已有
所以我们会分为三个阶段来建设，前期就是试水，建立系统互信、人员互信的过程，
对象变更涉及数据变更类的操作，比如 DDL 变更，DML 变更等。在这个过程中可以融
工单系统的对接就好比是水渠引水一样，第一步不能迈得太大，比如双方的平台技术体
所以简单来说，工单系统和运维系统需要对接起来，对接之后就能够互相关注自己特定
至于工单模块和运维模块的建设，哪个在先？其实这是一个互相促进的过程。早期的工
通用查询和数据流转可以转化为一类自助服务，业务可以提出需求，通过自助接口来满
阶段一的流程如下图15-29所示。
对于工单系统来说，不同公司的定位不同，有的公司放在OA里面，有的是独立的OMS
工单管理模块建设思路
第15章运维自助化服务丨563
---
## Page 586
564|MySQLDBA工作笔记：数据库管理、架构优化与运维开发
彼此打开了一扇窗。
明的。比如数据库权限开通的工单，会自动拆分为数据库权限工单和系统权限工单。
这个阶段的意义在于两个系统开始对接起来了，虽然不是一种很自然的对接方式，但是
第二个阶段就可以更进一步，这个时候我们可以对工单系统开放接口，让他们把数据推
（3）工单拆分，把原来的一个工单拆分为多个业务工单，这个过程对应用同学来说是透
（2）解析工单信息，根据流水号信息解析工单的格式。
（1）工单系统（MIS系统的子模块）完成工单审批。
这个阶段所做的工作会分为以下几个步骤：
提交工单状态为已完成
业务同学/需求方
审批不通过。信息稚核/调整
查看工单池数据
转换失败，核查问题一
提交工单
阶段一
图15-29
接口方式获取工单明细数据
数据库运维平台
工单派发/抢单
转换成功。
业务处理
据映射
审批通过
---
## Page 587
关注于运维系统，而不用刻意关注审批环节。
作的关注业务操作环节，各司其职，如下图15-30所示。
成了一个闭环。形成闭环是这个阶段最重要的一件事情，这样审批的关注审批环节，业务操
工单完成，让工单系统开放一个写入接口，我们把工单的状态回传过去。这样业务操作就形
认环节。
送过来，就不用我们去拉取了。这将是一个自动的推送过程，
这个阶段工作的一大亮点就在于我们可以把工单拆分为业务工单，处理完成之后，确认
这个阶段和第一阶段的最大区别是工单流程实现了完全的闭环和流程化，运维可以更加
业务同学/需求方
运维同学
审批不通过，信息稽核/
查看工单池数据
转换失败，
提交工单
图15-30
阶段二
调整
页面数据自动映射
转换成功，
业务处理
，可以省去很多的检查和反复确
提交工单状态
第15章运维自助化服务|565
---
## Page 588
566丨MySQLDBA工作笔记：数据库管理、架构优化与运维开发
等。这些都可以逐步地细化和改进。
数据的价值，比如工单的处理效率、工单的数据统计分析、工单的指派、业务工单拆分逻辑
如下图15-31所示。
要对接，比如和其他业务系统对接较为复杂的工单流程，开发自定义的工单数据分析模块，
们就可以和其他系统打通这个链路。这是一个更大更全面的过程，会有更多的事情和接口需
这个阶段的意义就在于，这是一个全链条的过程，我们可以在这个阶段更多地挖掘运维
第三阶段是更大的一个阶段，比如我们的工单可以和外部的系统通过接口交互，那么我
运维同学
工单统计
审批不通过，信息稽核/调
查看工单池数据
转换失败，核查问题
工单时长分析
提交工单
数据库运维平台
1方式推送工单明细数
图15-31
工单派发/抢单
阶段三
工单历史/明细查询
推送子
系统运维平台
工单管理
---
## Page 589
工单流程示意图。
所有的工单采用统一的适配管理。如下图15-33是再接入一个工单（对象变更工单）时整个
用。以数据库权限工单为例，我们会采用如下图15-32的流程接入。
统中。而在初期我们就需要锁定一个业务场景，对这个场景不断迭代，
够在后续的对接中把一些不足的地方改善，能够尽可能的抽象出通用的模块复用。
15.4.3
整体来说，工单初期的目标就是和业务系统打通流程，能够把工单数据流转到运维系
如果有了之前的铺垫，我们就可以复用工单服务的一些组件，比如工单适配器，可以对
在落地工单接入的过程中，我也沉淀了一些实践经验，在总结的基础上，也希望自己能
数据库工单接入流程设计
第7步：工单回调宪成
分解工单状态
DBA权限工单
运维平台入口
第6步：工单状态回传
第4步：
工单分
运维平台入口
工单适配器
运维平台入口
概要信息
数据库权限明细
第5步
DBA权限工单
运维平台入口
根据场景流转
图15-32
工单状态回传
系统权限明细
DBA权限工单
运维平台入口
使得其他场景能够复
第15章运维自助化服务|567
单
---
## Page 590
568丨MySQLDBA工作笔记：数据库管理、架构优化与运维开发
结了一个新版本的实例申请 demo，如图 15-34 所示。
的一段心路历程吧，这个阶段带给我的一个收益就是我清楚地知道现在的功能需要什么，
稳定的版本了。再往前走一步，就是业务服务的自助化，其实这是一个平台化功能系统对接
接，经历了大量的实例部署实践，也发现了脚本的很多不足之处，到了现在，算是一个相对
自身的问题，是支持的能力不足还是沟通的差异导致。
少什么，这些信息是相对明确而且可以预见结果的。
所以这个事情摆上日程之后，我在团队设计的 demo 和行业里的一些经验的基础上，总
半年前，带着团队巩固了资源申请的部分，在运维平台的后端实现了实例部署的功能对
方案1：数据库资源申请自助化设计
在这个流程贯通的过程中，也能够重新梳理目前的业务问题，通过流程的闭环发现我们
第7步：工单留调光线
数据库权限明细
DA爆工态
DBA权限工单
运维平台入口
第步：工单我态传
外郎裘统工
银4步：
图15-33
第2步：教换映影
数据库对象2变更明细
DBA部系续入工单
运维平台入口
缺
---
## Page 591
情，同时对数据的理解有了更加统一的认识，关于数据理念的统
整个局面就打开了，在工单的业务处理层我们可以做很多的事
开始是完善已有的工单处理方式，等到了工单接入流程化之后，
库服务，让业务得到一个看得见的服务和成本。
了解的事情，但是和成本打包起来，就可以供业务自助选择，
计了高可用方案，还做了定制化需求，这些都是业务之前不
也可以通过这种方式来体现，比如我们设计了容灾方案，设
所用，两者的一个平衡就是可见的成本。
以申请，上下游都不关心，配置高还是低，其实业务肯定愿意选择高配，下游环境希望尽需
先的资源申请是基于审批机制，但是审批机制存在太多主观的因素，比如这个服务是不是可
所以按照这个思路，我们可以在系统资源的基础上打包数据
所以资源申请是涉及成本预算的，而数据库服务的价值
关于工单的改进和接入，我觉得这次是一个很好的契机，最
方案2：用工单数据反哺运维平台建设
这个事情其实想表达的就是技术价值的变现，其中一个体现方式就是成本，所以我们原
定制化需求
数据库名+
数据库
使用期限
外网机房2
网路分区
硬件配置
业务简称
工单类型
业务接口人
数据库类型
读写分离
图15-34
根据您提供的业务需求，需要申请X个数据库实例
是否支持跨机房容灾
生产环境
分库分表
业务环境
预算成本为xxxx元
高可用
内存
产环场
硬盘
第15章运维自助化服务|569
图15-35
运维平台
工单系统
---
## Page 592
570|MySQLDBA工作笔记：数据库管理、架构优化与运维开发
单数量占比，工单处理效率等，通过这些数据我们可以对已有的状态做到更清晰的定位。
哪些变更，变更的明细等，这些信息都会组成一个互相关联和补充的数据网络。
是反过来想，通过工单数据反哺，能让运维系统的元数据建设更加高效。
程更加的统一，粒度更细，那么这个事情的重视程度就会上升一个台阶。
肯定，你对里面的信息是很认真和谨慎的。
的对待这件事情，但是反过来，你去申请一个护照或者签证，需要你准备一堆的材料，我敢
信息，但是绝大多数情况下，你都会选择简略或者是拒绝，毫无疑问，你觉得不用非常认真
和理解业务，你会发现原来彼此割裂的信息现在流动起来了。
目标有点距离了。
我想这应该是大家的一个通用需求了。
单系统还是运维系统。只要能够满足需求，能够快速响应，在合理的范围内做到理解和配合，
情了。意义是什么？为什么要这么做？不接入可以吗？
的完善起来。
人多了，那么就需要做到流程管控，就会涉及审批，忙活一圈回来发现，我们好像离自己的
一，等下我会着重来说。
有了这一层的补充，运维系统的工作落地会越来越清晰，而流程也在这个过程中会逐步
顺着这条线理下去，你会发现完全打开了局面，某个数据库近期开通了哪些权限，做了
，这个业务的联系人到底是谁？
，在梳理这些信息的时候，发现我们存在很多潜在的问题，比如对于业务的描述都不大清
运维同学对于业务的定义是相对简单的，某个业务对应一些简称，然后补充一些业务信
工单系统和运维系统对接也是如此，刚开始的时候可能大家觉得没有什么差别，如果流
打个比方，如果你去一个商城买东西，碰到做促销的营业员，他们会让你填一些基本的
经过一段时间的工单数据接入，我们可以对已有的工作做出数字化衡量，比如接入的工
而这些信息其实都在工单里面的，以前我们不知道这些工单信息对我们有什么用处，但
所以工单系统和运维系统在初期的接入，效果可能不够明显。直到你越来越深入地接触
所以业务同学提出需求到需求响应，这个过程中绝对不会是两个人都参与，一旦参与的
最基本的一条，这个功能是给谁用，对于业务同学而言，他其实可以不用关心是在用工
如果单纯说工单系统和运维系统打通（如图15-35 所示)，看起来是一件再正常不过的事
（1）工单需求数量
对此，我们来做一个简短的可视化分析。
工单需求统计如下图15-36所示。
方案3：工单数据可视化分析
所以我们看着图15-35，需要想明白以上这几个问题。
---
## Page 593
规范的落地也是一个迭代的过程。
变更表等)，而自动化工单的比例相对较低，原因在于工单的接入时间相对较晚，同时对于
些模糊的需求问题能够有更合适地接入方式，提高 DBA 沟通效率和工作质量。
通过对工单数据下钻，可以发现某个业务部门的工单比例过高，这种情况可以折射出两
下面15-38是一个工单需求总体统计情况。
（3）工单数据下钻
数据解读：对于工单需求，目前权限处理类的需求最多，其次是对象变更操作（新增表,
下面是不同工单类型的需求数量，占比如下图15-37所示。
（2）工单类型
工单需求的数量随着工单类型的逐步完善会逐步增多，通过这种接入方式主要是想让那
近期工单需求数统计
-04
18-12-07
18-12-12
-12-
图15-38
图15-37
图15-36
工单需求数
工车数据分析
第15章运维自助化服务|571
---
## Page 594
572|MySQLDBA工作笔记：数据库管理、架构优化与运维开发
所示是一个可以对比的效果图。
设定4个小时内未处理就会收到即时通讯提醒，之后工单交付时间会大大降低，如下图15-39
字化和可视化让工单数据一目了然，让我们的现状和目标也可以量化。
进一步进行沟通明确。
是业务部门的需求处理存在问题或者不规范，把一部分业务压力转移到了DBA 团队，需要
种情况：一方面可能因为业务需求频繁，能够更好地体现出工单处理的价值，另一方面可能
比如之前对于工单的处理，我们没有做处理效率的量化，在添加了工单提醒的功能之后，
此外我们还可以根据收集到的数据从其他的多个维度进行分析，
10703824
图15-39
40
，总体来说，就是通过数
---
## Page 595
学习动力。本书系统地阐述了 MySQL 数据库知识体系，是作者多年的沉淀、思考结
表的新方向给我们数据库从业人员带来了很多新的选择，也需要我们跟上时代，保持
于总结、归纳、思考的人。
分同学很难做到，
此书必将使你受益良多。
维基本操作，从业务需求到架构优化，全面阐述如何使用和运维好MySQL数据库，
本书是根据作者自己多年工作历程，点滴积累，从理论到实践，从开发规范视角到运
从而保障数据库的安全、稳定、高效运行。MySQL是目前最流行的关系型数据库，
颇具实践指导意
开发三个角度，系统地阐述了MySQL数据库方方面面的知识。对一线数据库从业者
为流行的数据库也不为过。
能的日益完善和可靠性的不断提高，
精力逐步转向开源及运维开发方向。MySQL数据库作为开源软件的代表，随着其功
己富有经验和远见的思路，值得更多的DBA在日常工作中借鉴与学习。
用架构等等，以应对更加复杂业务和更具挑战性的DBA工作，在本书中作者给出了目
优势，深入理解MySQL新特性，做好数据库的容灾与数据保护，结合业务做好高可
此同时，互联网应用业务也更加复杂，更具有挑战性。如何在应用中发挥MySQL的
给读者带来巨大的收获，也会助力MySQL的进一步发展。
耕耘。这本工作笔记凝聚了作者近年来刻苦学习的收获和辛勤实践的果实，相信它会
逐步实现DBA对数据库的规范化、自动化、自助化、可视化、智能化、服务化管理
广泛应用的因由不仅是产品本身的优势，更重要的是有无数社区技术爱好者为其默默
理论加实践，
数据库这个行业这几年发生了很多深刻的变化，开源、NewSQL、云原生为代
本书作者根据自己多年的工作经验及使用心得，
写作对我们技术人员来说，可能并不难，但十年如一日，孜孜不倦，我相信大部
数据库运维的变革，经历从手工造到脚本化、系统化、平台化、智能化的转变，
我与作者相识多年，
近几年MySQL发展迅速，各分支在性能与架构方面优化都有所突破与发展，
MySQL受热捧的程度不容置疑，位列全球最流行的开源数据库也当之无愧，其
导意义，具有很强的实战性和可操作性。
相信定是一本经典之作，正所谓宝剑锋从磨砺出，梅花香自苦寒来。
而建荣已经高产近2000篇文章，由此我们不难看出作者是一个善
其笔耕不辍、勤于总结、厚积薄发、终有所成。
已经成为应用非常广泛的数据库软件，甚至说最
购书赠腾讯云TVP专享福利
具体规则见勒口说明
从数据库管理、
、架构优化、运维
1918262152
，近些年，
其
自
与
16
上架建议：IT/MySQL
房晓乐
京东资深数据库架构师
CCIA理事
Oracle ACE for MySQL
王伟
0
韩
贺春肠
极数云舟创始人兼CEO
周彦伟
ISBN
信科技中心主任工程师
racleACE
《MySQL
务理事
委会会长
定价：99.00元
锋
978
13-2
---