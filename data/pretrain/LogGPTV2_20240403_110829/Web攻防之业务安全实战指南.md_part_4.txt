行攻击的一个原因。
本书中我们将围绕业务场景中可能存在的业务安全问题介绍详细的测试方法。
2.2 如何更好地学习业务安全
想要学好业务安全，首先要掌握一套成熟的业务安全测试的方式方法，消化吸收前人
总结的宝贵经验，开拓自己的安全视野。
其次需要了解目标平台的业务流程。在进行安全测试前，需要对业务的详细流程进行
一次全面的梳理。可以先将业务主体划分为几个大模块，再将每个大模块逐个细分为子模
块。可以从账号体系开始，如用户的注册、登录、密码找回、信息存储等，再到具体的业
务办理，如商品的搜索、选择、支付、生成订单，以及订单查询和用户评论等。对整个业
务流程有了一个详细的了解后，再结合前面学到的测试方法，就能更全面地把控业务流程
的各个步骤可能存在的风险点。
应结合被测试对象的实际业务情况，从熟悉公司、组织的业务模式、赢利模式来着
手，通过一定程度地理解被测对象的业务模式，了解信息系统所承载的业务数据流转情
况，分析出业务对象、渠道，以及各业务系统前、后台业务数据的生成、传输、使用和存
储方式，再针对不同的业务场景构建相应的业务安全测试模型。
建议读者尽量自己搭建每个业务场景，在自己搭建业务环境的过程中，可以熟悉业务
流程和业务类型，对于自己搭建的业务环境会有更深刻的印象。
通常情况下针对电子商务类业务安全测试模型的构建应着重考虑账户、交易和支付三
个重要业务相关环节，确保账户体系安全、交易体系安全、支付体系安全以及用户信息存
储安全。
在实践层面，推荐使用以下两种测试技巧，以达到事半功倍的效果：
· 科学的测试方法。常规的方法有控制变量法、删减法等，如在分析平行权限跨越
时，需要明白每一次步骤变的是什么，不变的是什么，控制好不同变量的变化，从而筛选
出影响业务流程的参数。
· 学会使用思维导图等工具。在面对复杂的系统时，我们需要通过思维导图等工具来
协助我们理清各个业务模块之间的联系，从而做到有的放矢。
如果是初学者，建议先熟悉Web安全的基础知识，推荐本书同系列的《Web安全基础
教程》，该教程详细介绍了Web安全基础、Web安全测试方法、Web常见漏洞、Web 安全
实战演练、日常安全意识。在熟悉基础安全技能后，再结合本书的案例多进行动手实践，
毕竟读万卷书，不如行万里路。
最后，希望在网络安全的道路上与君共勉，砥砺前行！
第3章 业务安全测试理论
3.1 业务安全测试概述
业务安全测试通常是指针对业务运行的软、硬件平台（操作系统、数据库、中间件
等），业务系统自身（软件或设备）和业务所提供的服务进行安全测试，保护业务系统免
受安全威胁，以验证业务系统符合安全需求定义和安全标准的过程。本书所涉及的业务安
全主要是系统自身和所提供服务的安全，即针对业务系统中的业务流程、业务逻辑设计、
业务权限和业务数据及相关支撑系统及后台管理平台与业务相关的支撑功能、管理流程等
方面的安全测试，深度挖掘业务安全漏洞，并提供相关整改修复建议，从关注具体业务功
能的正确呈现、安全运营角度出发，增强用户业务系统的安全性。
传统安全测试主要依靠基于漏洞类型的自动化扫描检测，辅以人工测试，来发现如
SQL 注入、XSS、任意文件上传、远程命令执行等传统类型的漏洞，这种方式往往容易忽
略业务系统的业务流程设计缺陷、业务逻辑、业务数据流转、业务权限、业务数据等方面
的安全风险。过度依赖基于漏洞的传统安全测试方式脱离了业务系统本身，不与业务数据
相关联，很难发现业务层面的漏洞，企业很可能因为简单的业务逻辑漏洞而蒙受巨大损
失。
3.2 业务安全测试模型
如图3-1所示，业务安全测试模型要素如下。
图3-1 业务安全测试模型
· 前台视角：业务使用者（信息系统受众）可见的业务及系统视图，如平台的用户注
册、充值、购买、交易、查询等业务。
· 后台视角：管理用户（信息系统管理、运营人员）可见的业务及系统视图，如平台
的登录认证、结算、对账等业务。
· 业务视角：业务使用者（信息系统受众）可见的表现层视图，如 Web 浏览器、手机
浏览器展现的页面及其他业务系统用户的UI界面。
· 系统视角：业务使用者（信息系统受众）不可见的系统逻辑层视图。
为了全面测试客户业务系统，在进行业务安全分析的时候，不能拘泥于以上测试模
型，在面对不同用户的不同业务的时候，通过深入了解用户业务特点、业务安全需求，应
切实地根据客户业务系统的架构，从前/后视角、业务视角与支撑系统视角划分测试对
象，根据实际情况选择白灰盒或黑盒的手段进行业务安全测试。
*特别提示：
· 对于支撑系统的子系统，其调用关系有时不是简单的顺序调用，中间可能涉及重
复、乱序调用的情况，需要具体系统具体分析。
· 对于前台的业务视角，在做白盒测试前，应通过用户访谈切实了解其每一个业务模
块调用了哪些支撑系统模块，熟悉其调用顺序。
· 对于前台的业务视角，以手动用例测试结合安全分析工具为主。对于能够提供使用
环境的管理后台业务视角，以手动用例测试结合安全分析工具为主，不能提供使用环境的
管理后台业务视角测试以访谈为主。对于支撑系统视角的测试，以访谈为主。
3.3 业务安全测试流程
业务安全测试流程总体上分为七个阶段，前期工作主要以测试准备和业务调研为主，
通过收集并参考业务系统相关设计文档和实际操作，与相关开发人员沟通、调研等方式熟
悉了解被测系统业务内容和流程，然后在前期工作的基础上，根据业务类型进行业务场景
建模，并把重要业务系统功能拆分成待测试的业务模块，进而对重要业务功能的各个业务
模块进行业务流程梳理，之后对梳理后的业务关键点进行风险识别工作，这也是业务测试
安全最重要的关键环节，最终根据风险点设计相应的测试用例，开展测试工作并最终输出
测试报告。具体业务安全测试流程如图3-2所示。
图3-2 业务安全测试流程图
流程一：测试准备
准备阶段主要包括对业务系统的前期熟悉工作，以了解被测试业务系统的数量、规模
和场景等内容。针对白盒性质的测试，可以结合相关开发文档去熟悉相关系统业务；针对
黑盒测试，可通过实际操作还原业务流程的方式理解业务。
流程二：业务调研
业务调研阶段主要针对业务系统相关负责人进行访谈调研，了解业务系统的整体情
况，包括部署情况、功能模块、业务流程、数据流、业务逻辑以及现有的安全措施等内
容。根据以往测试实施经验，在业务调研前可先设计访谈问卷，访谈后可能会随着对客户
业务系统具体情况了解的深入而不断调整、更新问卷（黑盒测试此步骤可忽略）。
流程三：业务场景建模
针对不同行业、不同平台的业务系统，如电商、银行、金融、证券、保险、游戏、社
交、招聘等业务系统，识别出其中的高风险业务场景进行建模。以电商系统为例，如图3-
3所示为业务场景建模模型图。
图3-3 电商系统业务场景建模
流程四：业务流程梳理
建模完成后需要对重要业务场景的各个业务模块逐一进行业务流程梳理，从前台和后
台、业务和支撑系统等4个不同维度进行分析，识别各业务模块的业务逻辑、业务数据流
和功能字段等。
业务模块的流程梳理主要遵循以下原则：
· 区分业务主流程和分支流程，业务梳理工作是围绕主流程进行分析的，而主流程一
定是核心业务流程，业务流程重点梳理的对象首先应放在核心主流程上，务必梳理出业务
关键环节；
· 概括归纳业务分支流程，业务分支流程往往存在通用点，可将具有业务相似性的分
支流程归纳成某一类型的业务流程，无须单独对其进行测试；
· 识别业务流程数据信息流，特别是业务数据流在交互方双方之间传输的先后顺序、
路径等；
· 识别业务数据流功能字段，识别数据流中包含的重要程度不等的信息，理解这些字
段的含义有助于下阶段风险点分析。
如图3-4所示是针对某电商类网站的用户登录功能的业务流程梳理图。
图3-4 相关业务流程图
通过业务流程的各个阶段梳理出业务流程各个关键环节点，如图3-5所示。
流程五：业务风险点识别
在完成前期不同维度的业务流程梳理工作后，针对前台业务应着重关注用户界面操作
每一步可能的逻辑风险和技术风险；针对后台业务应着重关注数据安全、数据流转及处理
的日志和审计。
图3-5 业务环节梳理结果图
业务风险点识别应主要关注以下安全风险内容。
（1）业务环节存在的安全风险
业务环节存在的安全风险指的是业务使用者可见的业务存在的安全风险，如注册、登
录和密码找回等身份认证环节，是否存在完善的验证码机制、数据一致性校验机制、
Session 和 Cookie 校验机制等，是否能规避验证码绕过、暴利破解和 SQL注入等漏洞。
（2）支持系统存在的安全风险
支持系统存在的安全风险，如用户访问控制机制是否完善，是否存在水平越权或垂直
越权漏洞。系统内加密存储机制是否完善，业务数据是否明文传输。系统使用的业务接口
是否可以未授权访问/调用，是否可以调用重放、遍历，接口调用参数是否可篡改等。
（3）业务环节间存在的安全风险
业务环节间存在的安全风险，如系统业务流程是否存在乱序，导致某个业务环节可绕
过、回退，或某个业务请求可以无限重放。业务环节间传输的数据是否有一致性校验机
制，是否存在业务数据可被篡改的风险。
（4）支持系统间存在的安全风险
支持系统间存在的安全风险，如系统间数据传输是否加密、系统间传输的参数是否可
篡改。系统间输入参数的过滤机制是否完善，是否可能导致 SQL 注入、XSS跨站脚本和
代码执行漏洞。
（5）业务环节与支持系统间存在的安全风险
业务环节与支持系统间存在的风险，如数据传输是否加密、加密方式是否完善，是否
采用前端加密、简单MD5编码等不安全的加密方式。系统处理多线程并发请求的机制是
否完善，服务端逻辑与数据库读写是否存在时序问题，导致竞争条件漏洞。系统间输入参
数的过滤机制是否完善。
具体业务风险点识别示例如图3-6所示。
图3-6 业务风险点识别
流程六：开展测试
对前期业务流程梳理和识别出的风险点，进行有针对性的测试工作。
流程七：撰写报告
最后是针对业务安全测试过程中发现的风险结果进行评价和建议，综合评价利用场景
的风险程度和造成影响的严重程度，最终完成测试报告的撰写。
3.4 业务安全测试参考标准
本书介绍的业务安全测试方法在充分借鉴了中华人民共和国通信行业标准YD/T 3169
—2016（互联网新技术新业务安全评估指南）、ISO 27002信息安全最佳实践、Cobit IT内
控框架、PCI数据安全标准的同时，考虑到需要进行业务安全测试的核心业务主要基于
Web，还参考了OWASP安全防护框架及Microsoft Web应用安全框架，采纳其中业务安全
相关的安全性要求、检测方法、处置方法，参考实际业务系统特点及主要安全关注需求，
能够为目标系统提供定制化测试。
3.5 业务安全测试要点
本书总结了十大业务安全测试关键点，如图3-7所示。在接下来的技术篇中，将结合
案例详细介绍每个关键点的测试原理和方法、测试过程和修复建议。
图3-7 业务安全测试关键点
技术篇
第4章 登录认证模块测试
4.1 暴力破解测试
4.1.1 测试原理和方法
暴力破解测试是指针对应用系统用户登录账号与密码进行的穷举测试，针对账号或密
码进行逐一比较，直到找出正确的账号与密码。
一般分为以下三种情况：
· 在已知账号的情况下，加载密码字典针对密码进行穷举测试；
· 在未知账号的情况下，加载账号字典，并结合密码字典进行穷举测试；
· 在未知账号和密码的情况下，利用账号字典和密码字典进行穷举测试。
4.1.2 测试过程
使用手工或工具对系统登录认证的账号及密码进行穷举访问测试，根据系统返回的数
据信息来判别账号及密码是否正确。测试流程如图4-1所示。
步骤一：对浏览器进行HTTP代理配置，将浏览器访问请求指向Burp Suite工具默认的
监听端口（这里以火狐浏览器为例）。
图4-1 暴力破解测试流程图