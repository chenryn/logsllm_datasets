(millions)
425
205
144
64
57
261
28
4
216
73
65
112
6
0
0
6
64
25
268
3
838
12
63
9
9
3
171
20
-
9
-
-
-
296
We manually analyzed the rest of the domains and found that only three domains were
mistakenly added to the set DA by the spectral expansion module, while the rest were
related to ad-abuse. The category “No Active IP Address” in Table 3.2 contains domains
that only resolved to known sinkholes, parking IPs, and domains that were never registered.
38
“Sinkholed” represents domains sinkholed by researchers. “Two TDSS Parking Services”
refers to domains registered later in the four year time period, and pointed to the same two
parking services used by known TDSS domains during the same time. Lastly, 268 of newly
detected domains were never registered. However, based on the large host overlap of these
domains with known TDSS domains and name string characteristics, we concluded that
these domains were related to the TDSS/TDL4 botnet.
Overall, the spectral expansion Algorithm 1 was able to produce a high quality set of
TDSS/TDL4 domains (DA) while introducing a low number of non-TDSS/TDL4 domains
(3 out of 838 new domains). After removing these three domains, we used the remaining
1,131 to analyze ad-abuse C&C infrastructure. The 765 domains that survived the saniti-
zation process were used to analyze the ﬁnancial impact to the ad ecosystem.
3.6 Ad-abuse Reports
This section discusses the two reports that summarize the network infrastructure properties
behind the ad-abuse component of TDSS/TDL4 and our estimation around ﬁnancial impact
that the botnet brought to the advertisers over four years.
3.6.1 C&C Infrastructure
Using the 1,131 domains in set DA, we analyzed the network infrastructure used by the
ad-abuse component of the botnet. We separated IP addresses used by these domains into
parking, sinkhole, and active categories. Besides well-known parking and sinkholing IPs,
we consider IPs with more than 1,000 historical domains to be parking IPs because of the
α threshold discussed in Section 3.5.2. All other IP addresses were considered to be active.
Figure 3.8 shows the number of domains resolving into each category over the four year
observation period. In total, at least 863 domains were registered and the botnet used 228
IP addresses. These IP addresses were used for two years and ten months, until 10/15/2013.
These domains were mostly active before the middle of 2012. We should note that during
39
(a) Number of active days.
(b) Number of days between last and
ﬁrst active day.
Figure 3.9: Ad-abuse C&C domains lifetime.
July 2012, a number of researchers started sinkholing some of the TDSS/TDL4 domains.
This perhaps forced the botmasters to change monetization tactics as security researchers
were investigating the ad-abuse component.
Half of the ad-abuse C&C domains resolved to different active IP addresses for more
than 90 days in total, as we can see from Figure 3.9a. Moreover, 20% of the C&C domains
were active for more than 240 days. The ad-abuse domains often switched status between
NXDOMAIN, pointing to active IPs, and being parked. The number of days between the
last and ﬁrst active day of C&C domains is the period of time that they could be successfully
monetized, during which the botmasters should have received a sizable amount of trafﬁc
volume from the victims. Figure 3.9b shows the cumulative distribution of time during
which the ad-abuse domains were monetized. The plot shows that 30% of domains were
monetized for more than six months, and 7% of domains were monetized for more than a
year.
The botnet used a variety of hosting infrastructures to facilitate the abuse. We obtained
ASN information [71] for 195 out of 228 total active IP addresses used by the ad-abuse
C&C. They are under 49 different Autonomous System Numbers (ASN), 59 CIDRs and
24 countries. Table 3.3 shows the distribution of the servers around the globe, used by
40
0204060801000200400581DaysCDF(%)TDSS Domain Active Days0204060801000200400600882DaysCDF(%)TDSS Domain LifetimeTable 3.3: The top 7 countries where C&C infrastructure has been identiﬁed. They count
towards 71% of the IP addresses.
Country
RU
US
LV
PT
DE
EU
NL
Other (17)
Unknown
Total
IP Addresses %
42
34
20
19
18
17
13
32
33
228
18.42
14.91
8.77
8.33
7.90
7.46
5.70
14.04
14.47
100.00
Figure 3.10: Top: Daily advertisers’ money loss caused by the ad-abuse component of
TDSS/TDL4. Bottom: Cumulative ﬁnancial loss for advertisers. Less than 15% of the
botnet population is estimated to have been involved in ad fraud that cost at least $346
million from 1/1/2011 to 10/15/2013.
TDSS/TDL4 domains.
3.6.2 Financial Analysis
We used Equation (3.2) to estimate the advertisers’ ﬁnancial loss. For our local network
(the US ISP) we calculated the DNS Ad-abuse Rate to be ζ = 27.62 (Section 3.5.1) and the
percentage for impression fraud as pim = 99.13% (Section 3.4.1). We used CP M = $2
according to a survey over twelve ad networks [72]. We calculated the daily number of
DNS requests Ri to domains used for ad-abuse that resolved to active IP addresses. We
should note that this is an under-estimation since we used aggressive thresholds to exclude
potentially parked domains in our passive DNS traces (as we discussed in Section 3.5.2).
41
$100$1,000$10,000$100,000$1,000,000Advertising Money Loss Caused by TDSS/TDL4 Ad−abuse ComponentSinkholing Starts$1.97 Million Lossin a Day$0$100 million$200 million$300 million2011−012011−072012−012012−072013−012013−07DateThis resulted in 1.2 billion DNS requests in total. µim denotes the number of ads returned
by each Protocol 1 request (which relates to impression fraud activity). During our analysis,
we identiﬁed instances where as many as 50 ads were returned from the C&C after each
Protocol 1 request. We never saw fewer than 5 ads per request according to network traces
of malware execution reported by [66]. Therefore, we used µim = 5 for our lower bound
estimate.
Throughout the lifetime of TDSS/TDL4, we estimate levels of ad-abuse on the order
of at least $346 million using Equation (3.2). This lower bound is only based on the DNS
datasets from the ISP network we had access to. Figure 3.10 shows the distribution of the
ﬁnancial loss caused by TDSS/TDL4 to advertisers. The daily ﬁnancial loss is shown at
the top of the ﬁgure, and the cumulative ﬁnancial loss is at the bottom. We observed 1,018
days of active ad-abuse C&C DNS communications, caused by victims in the US ISP. This
resulted in an average of $340 thousand daily ﬁnancial loss for advertisers. However, before
the ﬁrst sinkholed domain was registered on 7/11/2012, the daily estimate was on average
$616 thousand and peaked to $1.97 million on 1/7/2012. After the sinkholing action, the
ﬁnancial impact to the advertisers drastically decreased as the plateau of the bottom plot in
Figure 3.10 shows.
We strongly believe that other networks in the world were affected by this threat based
on our sinkhole analysis described in Section 3.5.1. The victims in the entire ISP roughly
accounted for 30% of the total botnet population in the US. The infected hosts in the US
were less than 50% of the entire botnet population in the world. Thus, our lower bounds
may only conservatively estimate loss caused by less than 15% of the entire botnet popula-
tion.
Cost For Operating The TDSS/TDL4 Infrastructure: The ad-abuse hosting infras-
tructure was located in 228 different IPs. Without knowing the hosting plans actually used
by the botmasters, we have to consider an average cost plan for each service provider to
approximate the cost of running the TDSS/TDL4 botnet. Using manual analysis, we con-
42
Table 3.4: Financial break down approximation among the entities of the online ad ecosys-
tem, in millions of dollars.
Stakeholders
Advertisers’ Capital
DSP
Ad Exchange (inbound)
Ad Exchange (outbound)
Ad Networks
Ad Server/Publisher (Afﬁliates)
45%
8%
8%
32%
7%
Money
(millions)
346.00
155.70
27.68
27.68
110.72
24.22
clude that the average minimum (i.e., the botmaster is using the least expensive plan) cost
is approximately $33.62 per month, whereas the average maximum cost is almost $444
per month. We assume infrastructure is used around the clock. For IPs that we could not
link to a particular AS, we assume a ﬂat rate. This rate corresponds to the median of the
observed prices around the world. Using this information, we conclude the cost to operate
the TDSS/TDL4 C&C infrastructure to be between $44,000 and $260,000 over four years.
Potential Financial Reward for the Botnet Operators/ Afﬁliates: While is impos-
sible to know for sure what the exact levels of their reward may have been, we will try to
approximate the revenue that went to the afﬁliate TDSS/TDL4 entities. To derive the stake-
holder and the break-down described in Table 3.4 we consulted a CTO of a large Demand
Service Platform (DSP) company, who wishes to remain anonymous. According to his ex-
pert opinion, these are the most typical breakdowns to various entities in the ad ecosystem.
As we can see from Table 3.4, the potential ﬁnancial reward for the afﬁliates is in the order
of tens of millions of dollars.
It is logical to assume that the botmasters and afﬁliates are most likely getting paid as
publishers or trafﬁc resellers. In this role, the estimated revenue is 7% of money spent by
advertisers, $24.22 million. The TDSS/TDL4 botnet may have a team of operators that
have previously harvested this immense amount of money from the ad-abuse operation.
Our estimates are in-line with investigations from law enforcement on the amount stolen
by fraudulent advertisement campaigns [5, 6]. For example, law enforcement agencies
43
Table 3.5: The extent to which TDSS/TDL4 has affected the Internet. The tables are limited
to the top 6 observations. Ad networks and Publishers domain names have been aggregated
to the owner companies.
(a) Countries Affected
Country
US
EU
DE
CA
FR
UK
Other (168)
Total
Infections %
33,386
7,479
5,939
5,399
3,369
2,355
15,802
71,374
46.77
10.48
8.32
7.57
4.72
3.30
22.13
100.00
(b) Ad Networks Targeted
Ad network Hits (×103) %
14.27
Google
Facebook
13.86
3.44
Microsoft
2.97
YouTube