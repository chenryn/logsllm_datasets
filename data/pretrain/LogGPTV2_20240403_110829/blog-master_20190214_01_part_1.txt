## 企业数据库选型规则    
### 作者                            
digoal                            
### 日期                            
2019-02-14                            
### 标签                            
PostgreSQL , 数据库选型 , 企业级数据库       
----                      
## 背景    
企业数据库选型规则。  
## 一、数据库部署形式  
随着硬件发展，指标上会有变化。  
部署形式决定了容量上限，计算能力上限，读写带宽上限，RPO，RTO指标，适应场景。  
### 1、分布式部署（例如pg+citus插件）  
容量上限：100节点以上，PB级。  
计算能力上限：100节点以上，6400核以上。  
读写带宽上限：100节点以上，200GB/s以上。  
RPO：如果每个计算节点都采用多副本存储，RPO=0。  
RTO：如果每个计算节点都采用HA，RTO可以做到1分钟内。  
使用限制：有一些SQL限制。  
适应场景：应用代码可控程度高的情况下，适合TP和AP业务。  
### 2、单节点本地存储  
容量上限：10TB级。  
计算能力上限：64核级。  
读写带宽上限：2GB/s级。  
RPO：RPO无保障。  
RTO：RTO无保障。  
使用限制：SQL无限制。  
适应场景：测试环境，非生产环境，对数据库RPO，RTO都没有要求的环境。  
### 3、单节点多副本存储  
容量上限：32TB级。  
计算能力上限：64核级。  
读写带宽上限：2GB/s级。  
RPO：单机房RPO=0，（如果存储支持跨机房多副本，可以做到多机房RPO=0）。  
RTO：10分钟级。  
使用限制：SQL无限制。  
适应场景：非核心场景生产、测试。  
### 4、双节点共享存储  
容量上限：32TB级。  
计算能力上限：64核级。  
读写带宽上限：2GB/s级。  
RPO：单机房RPO=0，（如果存储支持跨机房多副本，可以做到多机房RPO=0）。  
RTO：1分钟级。  
使用限制：SQL无限制。  
适应场景：核心、非核心场景生产。  
### 5、双节点主备异步复制  
容量上限：32TB级（使用远程存储），10TB级（使用本机存储）  
计算能力上限：64核级。  
读写带宽上限：2GB/s级。  
RPO：10GB网络，REDO延迟毫秒级、1MB以内。（支持跨机房部署）。心跳机制可确保RPO < 60秒   
RTO：1分钟级。  
使用限制：SQL无限制。  
适应场景：非核心场景生产。  
### 6、双节点主备半同步复制  
容量上限：32TB级（使用远程存储），10TB级（使用本机存储）  
计算能力上限：64核级。  
读写带宽上限：2GB/s级。  
RPO：  
无节点或单一节点异常时，可保证RPO=0。  
两个节点都异常时，RPO取决于备份延迟。采用基于PG流复制的持续REDO备份，可以做到RPO毫秒级。  
RTO：1分钟级。  
使用限制：SQL无限制。  
适应场景：核心、非核心场景生产。  
### 7、三节点及以上多副本全同步复制  
容量上限：32TB级（使用远程存储），10TB级（使用本机存储）  
计算能力上限：64核级。  
读写带宽上限：2GB/s级。  
RPO：  
小于半数节点异常时，可保证RPO=0。  
半数以上节点异常时，RPO取决于 1、10GB网络，REDO延迟毫秒级、1MB以内。2、备份延迟。采用基于PG流复制的持续REDO备份，可以做到RPO毫秒级。   
RTO：1分钟级。  
使用限制：SQL无限制。  
适应场景：核心场景生产。  
### 8、计算存储分离（存储多副本）（比如阿里云POLARDB PG）  
容量上限：100TB级。  
计算能力上限：16节点，1024核级。  
读写带宽上限：32GB/s级。  
RPO：单机房RPO=0，（如果存储支持跨机房多副本，可以做到多机房RPO=0）。  
RTO：15秒级。  
使用限制：SQL无限制。  
适应场景：核心、非核心场景生产。  
### 9、计算存储分离（存储多副本）+ 双机房半同步  
容量上限：100TB级。  
计算能力上限：16节点，1024核级。  
读写带宽上限：32GB/s级。  
RPO：  
无节点或单一节点异常时，可保证RPO=0。  
两个节点都异常时，RPO取决于备份延迟。采用基于PG流复制的持续REDO备份，可以做到RPO毫秒级。  
RTO：15秒级。  
使用限制：SQL无限制。  
适应场景：核心、非核心场景生产。  
### 10、计算存储分离（存储多副本）+ 多机房多副本全同步  
容量上限：100TB级。  
计算能力上限：16节点，1024核级。  
读写带宽上限：32GB/s级。  
RPO：  
小于半数节点异常时，可保证RPO=0。  
半数以上节点异常时，RPO取决于 1、10GB网络，REDO延迟毫秒级、1MB以内。2、备份延迟。采用基于PG流复制的持续REDO备份，可以做到RPO毫秒级。   
RTO：15秒级。  
使用限制：SQL无限制。  
适应场景：核心场景生产。  
### 11、只读节点  
使用限制：SQL无限制。  
适应场景：扩展读能力。  
### 12、非核心功能  
12\.1、业务透明的读写分离  
使用限制：SQL无限制。  
适应场景：扩展读能力。  
12\.2、跨库交互  
使用限制：SQL无限制。  
适应场景：跨库DBLINK，跨库外部表，跨库物化视图。  
12\.3、单元化  
使用限制：SQL无限制。  
适应场景：多实例共享少量数据，多写。  
## 二、云产品形态  
### 1、基础版（单机多副本存储）PG 10  
当前容量上限：2 TB  
未来可达32TB级。  
### 2、双机版（异步复制）PG 9.4, 10、PPAS 9.3, 10  
当前容量上限：6 TB  
### 3、双机版（半同步复制）PG 11  
当前容量上限：32 TB  
### 4、只读实例  
扩展读能力。  
### 5、计算存储分离版 PG 11、PPAS 11   
16个计算节点，读写分离。  
当前容量上限：100 TB  
### PG、PPAS、POLARDB PG区别  
除以上区别以外，还有如下区别（pg ppas polarddb选择评判标准：数据量，可用性，可靠性，是否有去O需求，成本）：  
1、pg社区版。  
2、PPAS兼容PG、同时高度兼容ORACLE。  
相比社区版PG，新增AWR报告、SQL防火墙、数据库用户级资源隔离、索引推荐等高级功能。  
3、POLARDB PG。  
兼容PG、同时高度兼容ORACLE。  
相比PPAS、PG，容量达到100TB，计算存储分离，计算可扩展到16节点，支持超低延迟读写分离。  
扩容速度快。（扩容不需要迁移数据，非常之快）  
可用性高，恢复速度快。（恢复不需要REPLAY WAL，秒级恢复）  
备份、恢复速度快。（存储快照，秒级备份）  
由于一份存储支持读写分离（PG PPAS使用流复制方式，每个只读节点一份存储），POLARDB成本更低廉。  
存储采用按实际使用量付费，不需要规划存储大小，弹性更好。  
自研主打产品，未来产品黑科技会集中增加到POLARDB。  
## 三、行业合规要求  
一些行业对数据库系统的合规要求：  
1、SQL审计  
2、扩展性  
3、可用性  
4、可靠性  
5、备份保留时间  
6、备份可恢复时间点  
7、闪回  
8、回收站  
9、存储加密  
10、数据文件加密  
11、类型加密  
12、数据访问链路加密  