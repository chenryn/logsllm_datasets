User: You need to install and configure the OpenVPN server on a CentOS server, so that users can safely access the company's internal network through VPN, please provide detailed steps and instructions
Assistant: The following are the detailed steps and instructions for installing and configuring the OpenVPN server on the CentOS server: 1. To install the OpenVPN software, enter the following commands through the command line: sudo yum install -y epel-release sudo yum install -y openvpn easy-rsa 2. Generate a certificate and key Use the easy-rsa tool to generate a server certificate and key. First, create a new directory in the installation location and copy the easy-rsa configuration files into this directory: sudo mkdir /etc/openvpn/easy-rsa/ sudo cp -r /usr/share/easy-rsa/3/* /etc/openvpn/easy-rsa/ Create certificate and key: cd /etc/openvpn/easy-rsa/ sudo ./easyrsa init-pki sudo ./easyrsa --batch build-ca nopass sudo ./easyrsa build-server -full server nopass Among them, the build-server-full option will generate a server certificate and key without entering a password. 3. Generate Diffie-Hellman parameters Diffie-Hellman (DH) parameters are part of the symmetric encryption setup and are used to generate key exchanges. Enter the following command to generate DH parameters: sudo openssl dhparam -out /etc/openvpn/dh.pem 2048 This command will generate DH parameters in /etc/openvpn/dh.pem file. 4. Create an OpenVPN server configuration Create a server.conf file in the /etc/openvpn directory for setting the OpenVPN server. sudo vi /etc/openvpn/server.conf The file should contain the following configuration: # Use UDP protocol to run OpenVPN on port 1194 port 1194 proto udp dev tun # Use certificate and key to verify ca /etc/openvpn/easy-rsa /pki/ca.crt cert /etc/openvpn/easy-rsa/pki/issued/server.crt key /etc/openvpn/easy-rsa/pki/private/server.key # Use TLS authentication tls-auth /etc/ openvpn/easy-rsa/pki/ta.key 0 tls-version-min 1.2 # load DH parameters dh /etc/openvpn/dh.pem # set internal IP address subnet server 10.8.0.0 255.255.255.0 # client Provide routing information and DNS settings push "redirect-gateway def1 bypass-dhcp" push "dhcp-option DNS 208.67.222.222" push "dhcp-option DNS 208.67.220.220" # Allow communication between clients client-to-client # Set the log level log-append /var/log/openvpn.log verb 3 5. Start the service and configure the system firewall Start the OpenVPN server: sudo systemctl start openvpn@server Enable the server to start automatically after booting: sudo systemctl enable openvpn@server Configure the firewall for the server , Allow port 1194 of the UDP protocol: sudo firewall-cmd --zone=public --add-port=1194/udp --permanent sudo firewall-cmd --reload 6. Create user certificates and keys using the easy-rsa tool Generate user certificates and keys: cd /etc/openvpn/easy-rsa/ sudo ./easyrsa --batch build-client-full client1 nopass Among them, the build-client-full option will generate client certificates and keys without A password is required. 7. Configure the client to copy the ca.crt, client1.crt and client1.key files to the client. Using the OpenVPN client application, upload the client certificate and key and connect to the OpenVPN server. Above are the steps and instructions to install and configure OpenVPN server on CentOS server. With these steps, OpenVPN can be safely set up on a server to protect your company's internal network.