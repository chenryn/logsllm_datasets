Related concepts
Monitoring your IBM MQ network
Channel failure with return code ECONNRESET for TCP/IP
There is a channel failure, and on z/OS you receive the following: CSQX208E TRPTYPE=TCP
RC=00000461, or CSQX208E TRPTYPE=TCP RC=00000461 reason=76650446.
Cause
Depending upon the platform or platforms your enterprise uses, you receive the following return code
when the connection is reset by peer (ECONNRESET):
AIX
ECONNRESET 73 (hexadecimalm49)
Linux
ECONNRESET 104 (hexadecimal 68)
Windows
WSAECONNRESET 10054 (hexadecimal 2746)
z/OS
10054 or RC461
This return code is often the results of a problem in the TCP/IP network. There are various reasons for
TCP/IP sending a reset:
• An unorderly connection termination, such as a rebooting the client box, can cause a reset.
• An application requests a connect to a port and IP address on which no server is listening.
• An application closes a socket with data still in the application receive buffer. The connection is reset to
allow the remote partner to know that the data was not delivered.
• Any data that arrives for a connection that has been closed can cause a reset.
• An application closes a socket and sets the linger socket option to zero. This notifies TCP/IP that the
connection should not linger.
Note: IBM MQ does not code the linger time = 0, therefore IBM MQ itself does not cause a reset.
• A TCP segment that is not valid arrives for a connection. For example, a bad acknowledge or sequence
number can cause a reset.
84 Troubleshooting and Support for IBM MQ
• The connect request times out. TCP stops trying to connect to a particular port and IP address and reset
the connection.
• A firewall can reset connections if the packet does not adhere to the firewall rules and policies. For
example, a source or destination port, or IP address does not match the firewall rule or policy.
• The retransmit timer expires. TCP stops trying to retransmit a packet and reset the connection.
• A bad hardware device can cause resets.
You need to be aware that the effect of your configuration at higher levels, for example, the channel
initiator dispatching priority being too low, could exhibit itself as a reset. Therefore, you should also
consider the effect of your configuration when trying to determine why a reset is happening.
Diagnosing the problem
Use TCP/IP packet traces to determine why the reset occurred.
See z/OS UNIX reason codes for the last two bytes of the reason code found in the CSQX208E error
message.
Considerations for retrying a link
If a link failure occurs during normal operation, a sender or server channel program will itself start
another instance, subject to certain conditions being met. Other error scenarios might be more difficult to
troubleshoot and require further manual investigation.
Link failure during normal operation
If a link failure occurs during normal operation, a sender or server channel program will itself start
another instance, provided that:
1.Initial data negotiation and security exchanges are complete
2.The retry count in the channel definition is greater than zero
Note: For Multiplatforms, to attempt a retry a channel initiator must be running. For IBM MQ for z/OS,
this channel initiator must be monitoring the initiation queue specified in the transmission queue that the
channel is using.
Difficult to recognize error scenarios
An error scenario might occur that is difficult to recognize. For example, the link and channel might be
functioning perfectly, but some occurrence at the receiving end causes the receiver to stop. Another
unforeseen situation could be that the receiver system has run out of memory and is unable to complete a
transaction.
You need to be aware that such situations can arise, often characterized by a system that appears to be
busy but is not actually moving messages. You need to work with your counterpart at the far end of the
link to help detect the problem and correct it.
Shared channel recovery on z/OS
Shared channel recovery is one of the benefits of using queue sharing groups on IBM MQ for z/OS.
The following table shows the types of shared channel failure and how each type is handled:
Table 1. Handling of shared channel failures
Type of failure What happens
Channel initiator The channels dependent on the communications subsystem enter channel retry,
communications and are restarted on an appropriate queue sharing group channel initiator by a
subsystem failure load-balanced start command.
IBM MQ troubleshooting and support 85
Table 1. Handling of shared channel failures (continued)
Type of failure What happens
Channel initiator The channel initiator fails, but the associated queue manager remains active.
failure The queue manager monitors the failure and initiates recovery processing.
Queue manager The queue manager fails (failing the associated channel initiator). Other queue
failure managers in the queue sharing group monitor the event and initiate peer
recovery.
Shared status failure Channel state information is stored in Db2, so a loss of connectivity to Db2
becomes a failure when a channel state change occurs. Running channels can
carry on running without access to these resources. On a failed access to Db2,
the channel enters retry.
Shared channel recovery processing on behalf of a failed system requires connectivity to Db2 to be
available on the system managing the recovery to retrieve the shared channel status.
Related concepts
Preparing IBM MQ for z/OS for DQM with queue sharing groups
Resolving problems where a channel stops running
Two possible solutions to the problem of a channel ceasing to run are channel switching and connection
switching.
About this task
Two possible solutions to the problem of a channel ceasing to run are:
Channel switching
For channel switching, two message channels are defined for the same transmission queue, but with
different communication links. One message channel is preferred, the other is a replacement for use
when the preferred channel is unavailable.
Note: If triggering is required for these message channels, the associated process definitions must
exist for each sender channel end.
Connection switching
Another solution is to switch communication connections from the transmission queues.
Procedure
• To switch message channels:
– If the channel is triggered, set the transmission queue attribute NOTRIGGER.
– Ensure that the current channel is inactive.
– Resolve any in-doubt messages on the current channel.
– If the channel is triggered, change the process attribute in the transmission queue to name the
process associated with the replacement channel.
In this context, some implementations allow a channel to have a blank process object definition, in
which case you may omit this step as the queue manager will find and start the appropriate process
object.
– Restart the channel, or if the channel was triggered, set the transmission queue attribute TRIGGER.
• To switch communication connections from the transmission queues:
– If the sender channel is triggered, set the transmission queue attribute NOTRIGGER.
– Ensure that the channel is inactive.
86 Troubleshooting and Support for IBM MQ
– Change the connection and profile fields to connect to the replacement communication link.
– Ensure that the corresponding channel at the remote end has been defined.
– Restart the channel, or if the sender channel was triggered, set the transmission queue attribute
TRIGGER.
Disaster recovery
Disaster recovery planning is the responsibility of individual installations, and the functions that are
performed might include the provision of regular system 'snapshot' dumps that are stored safely off-site.
These dumps would be available for regenerating the system, should some disaster overtake it. If this
occurs, you need to know what to expect of the messages, and the following description is intended to
start you thinking about it.
First, a recap on system restart. If a system fails for any reason, it might have a system log that allows
the applications running at the time of failure to be regenerated by replaying the system software from
a syncpoint forward to the instant of failure. If this occurs without error, the worst that can happen is
that message channel syncpoints to the adjacent system might fail on startup, and that the last batches
of messages for the various channels will be sent again. Persistent messages will be recovered and sent
again, nonpersistent messages might be lost.
If the system has no system log for recovery, or if the system recovery fails, or where the disaster recovery
procedure is invoked, the channels and transmission queues might be recovered to an earlier state, and
the messages held on local queues at the sending and receiving end of channels might be inconsistent.
Messages might have been lost that were put on local queues. The consequence of this happening
depends on the particular IBM MQ implementation, and the channel attributes. For example, where strict
message sequencing is in force, the receiving channel detects a sequence number gap, and the channel
closes down for manual intervention. Recovery then depends upon application design, as in the worst
case the sending application might need to restart from an earlier message sequence number.
Troubleshooting IBM MQ Console and REST API problems
Diagnose problems with the IBM MQ Console and REST API by looking at the available logs. When asked
by IBM staff, you might also need to configure trace.
About this task
If you are experiencing problems with the IBM MQ Console or REST API, check the following things.
Procedure
• The status of the mqweb server.
If the mqweb server is stopped, you cannot use the IBM MQ Console or REST API. You can check the
status of the server by using the following command:
dspmqweb status
Attention:
Before you issue either the setmqweb or dspmqweb commands on z/OS, you must set
the WLP_USER_DIR environment variable so that the variable points to your mqweb server
configuration.
To set the WLP_USER_DIR environment variable, issue the following command:
export WLP_USER_DIR=WLP_user_directory
IBM MQ troubleshooting and support 87
where WLP_user_directory is the name of the directory that is passed to crtmqweb. For
example:
export WLP_USER_DIR=/var/mqm/web/installation1
For more information, see Create the mqweb server.
If the mqweb server is stopped, start the server with the following command:
strmqweb
On z/OS, check that the mqweb server started task is running. If necessary, start the
procedure that you created in Create a procedure for the mqweb server.
• Ensure that the following mqweb configuration files exist:
jvm.options
mqwebuser.xml
server.xml
Look for the files in the MQ_DATA_PATH/web/installations/installationName/servers/
mqweb/ directory by using the crtmqdir command.
To check the installation, which includes searching for these files, use the following command:
crtmqdir -a
If the files are missing, you can re-create them by using the command:
crtmqdir -s -f
• Examine the mqweb server log files, console.log, and messages.log.
These log files can be found in the following location:
– MQ_DATA_PATH/web/installations/installationName/servers/mqweb/
logs
– The directory that was specified when the crtmqweb script ran to create the mqweb
server definition. By default, this directory is /var/mqm/web/installation1/servers/mqweb/
logs.
These files are in UTF-8. To view the files, you can use one of the following methods:
- Use the oedit command from a z/OS UNIX System Services command line.
- Enter ISPF option 3.17, and use the va (view ASCII) line command.
•
On z/OS, check STDERR and STDOUT in the mqweb server started task output. STDERR contains no
messages, unless an error occurred.
• If you cannot access the IBM MQ Console or REST API from a host other than the system where the
mqweb server is running, check that remote connections are enabled.
Issue the following command to display the mqweb server configuration:
dspmqweb properties -a
If the value of the httpHost property is localhost, the IBM MQ Console and REST API are available
only from the same host as the mqweb server. Enable remote connections to the mqweb server by
entering the following command where hostname specifies the IP address or domain name server
(DNS) hostname where IBM MQ is installed:
setmqweb properties -k httpHost -v hostname
88 Troubleshooting and Support for IBM MQ
Use an asterisk, *, in double quotation marks, to specify all available network interfaces, as shown in
the following example:
setmqweb properties -k httpHost -v "*"
• If no queue managers are displayed in the local queue manager widget in the IBM MQ Console, check
that you have queue managers on the same host as the mqweb server that you can manage with the
IBM MQ Console.
– Only queue managers in the same installation as the mqweb server are listed in the
IBM MQ Console.
– On z/OS, only queue managers that are started at the same version as the mqweb
server since the last IPL are listed in the IBM MQ Console.
•
If messages are truncated when you browse queues in the IBM MQ Console, adjust the
mqConsoleMaxMsgCharsToDisplay and mqConsoleMaxMsgRequestSize properties by using the
setmqweb properties command.
• If you are using the messaging REST API with remote queue managers and you cannot connect to the
queue manager, check the following things:
• You are specifying the unique name for the queue manager, not the queue manager name, within
the resource URL.
• You are trying to connect to a queue manager that is visible to the messaging REST API. Some
queue managers might be available only to the IBM MQ Console. You can verify whether the queue
manager is configured to be visible to the messaging REST API by using the dspmqweb remote
command. View the visibility parameter to check whether the queue manager is visible to the
messaging REST API.
• You are not prefixing an asterisk to the queue manager name to specify that you want to connect to
a queue manager group. To specify you want to connect to a queue manager group, you must set
the group attribute in the remote queue manager configuration. For more information, see Setting
up a remote queue manager group to use with the messaging REST API.
• Ensure that the CCDT file is in the location that is specified by the ccdtUrl parameter in the
dspmqweb remote command.
•
If you are still experiencing problems, the mqweb server started task might not be configured
correctly, or there might be a problem with the IBM MQ for z/OS UNIX System Services Web
Components installation files.
You might see the following message in the IBM MQ Console:
Lost communication with the server Could not establish communication with the server.
In the procedure that is used to start the mqweb server check the following things:
1.Check that the STEPLIB libraries are at the correct level, and are APF authorized.
2.Check that INSTDIR, USERDIR, PATH, and LIBPATH point to the correct path.
In z/OS UNIX System Services, enter the following command where PathPrefix is the IBM MQ for z/OS
UNIX System Services Components installation path:
ls -Eltr PathPrefix/web/bin/dspmq
This command displays an output similar to the following output:
-rwxr-xr-t a-s- ... /mqm/V9R3M0/web/bin/dspmq
Check the t and a flags are set. If necessary, use the commands:
– chmod +t PathPrefix/web/bin/dspmq to set the sticky bit (t)
IBM MQ troubleshooting and support 89
– extattr +a PathPrefix/web/bin/dspmq to set the APF-authorized attribute (a)
What to do next
For more information about gathering trace for the IBM MQ Console and REST API, see “Tracing the REST
API” on page 464, and “Tracing the IBM MQ Console” on page 416.
Troubleshooting IBM MQ Internet Pass-Thru problems
There are a number of steps you can follow to help determine the nature of any problems you might
encounter when using IBM MQ Internet Pass-Thru (MQIPT).
Procedure
1.Check for the following common errors:
• The HTTP property is set to true on a route directly connected to a queue manager.
• The SSLClient property is set to true on a route directly connected to a queue manager that is not
configured to use SSL/TLS.
• The passwords stored for the key ring files are case-sensitive.
2.Check for FFST reports in the errors subdirectory.
If you find any FFST reports in the errors subdirectory, this means that MQIPT was correctly installed
but there might have been a problem with the configuration.
Each FFST reports a problem that causes MQIPT or a route to terminate its startup process. Fix the
problem that caused each FFST. Then delete the old FFST and restart or refresh MQIPT.
3.If there are no FFST reports, and there is no trace output, this means that MQIPT has not been
installed correctly. Check that all the files have been put in the correct place. To check this, try to start
MQIPT manually:
a.Open a command prompt. Go to the bin subdirectory and type:
mqipt xxx
where xxx is the MQIPT home directory.
b.When MQIPT starts, look for the configuration in the home directory. Look for any error messages
and FFST instances in the errors subdirectory.
c.Look at the text output from MQIPT for any error messages. Check for instances of FFST. Correct
any errors.
Note: MQIPT will not start if there is a problem in the [global] section of the configuration file. A
route will not start if there is a problem in the [route] section of the configuration file.
4.If there are no FFST reports, but you do have trace output, configure the MQIPT connections
(ConnectionLog=true) and make the sender attempt a connection. Then check that a connection
from the host has been logged.
• If a connection from the host has been logged, the sender has not been configured correctly.
• If a connection has not been logged, check that MQIPT is configured to forward the message to the
correct host and port. Then treat as a normal channel problem.
Related tasks
“Tracing errors in IBM MQ Internet Pass-Thru” on page 419
IBM MQ Internet Pass-Thru (MQIPT) provides a detailed execution trace facility, which is controlled by the
Trace property.
“Contacting IBM Support” on page 301
90 Troubleshooting and Support for IBM MQ
If you need help with a problem that you are having with IBM MQ, you can contact IBM Support through
the IBM Support Site. You can also subscribe to notifications about IBM MQ fixes, troubleshooting, and
other news.
“Collecting information for MQIPT problems” on page 339
If you need to report a problem with MQIPT to IBM Support, send relevant information that will help to
resolve the problem more quickly.