Business logic flaws in
mobile operators services
B o g d a n  A l e c u
Bogdan ALECU
About me
Independent security researcher
Sysadmin
Passionate about security, specially when it’s 
related to mobile devices; started with NetMonitor
(thanks Cosconor), continued with VoIP and finally 
GSM networks / mobile phones
@msecnet / www.m-sec.net
Bogdan ALECU
GOALS
o SIM Toolkit: what is it, how can we 
exploit it
o Understanding of business logic 
flaws in mobile operators services
o What you should do in order to 
protect from these attacks
Bogdan ALECU
TOPICS
1. SIM TOOLKIT
2. HTTP HEADERS
3. DATA TRAFFIC VULNERABILITY
4. THE EXTRA DIGIT
5. SUMMARY
Bogdan ALECU
THE BUGGY WORLD
SIM 
1 TOOLKIT
Bogdan ALECU
THE BUGGY WORLD
For sending Ringtones, operator logo, 
concatenated messages, SMS makes use 
of the User Data Header
SIM 
1TOOLKIT
Bogdan ALECU
THE BUGGY WORLD
SIM 
TOOLKIT
1
Example of SIM Toolkit icon on your mobile device
Bogdan ALECU
THE BUGGY WORLD
SIM 
1TOOLKIT
Bogdan ALECU
THE BUGGY WORLD
The type of message sent is addressed 
directly to the SIM, by setting the PID to 
0x7F, corresponding to USIM Data 
Download
SIM 
1TOOLKIT
Bogdan ALECU
THE BUGGY WORLD
… then the ME shall pass the message
transparently to the SIM
… shall not display the message, or 
alert the user of a short message 
waiting
“
”
SIM 
TOOLKIT
1
ETSI GSM 11.14
Bogdan ALECU
THE BUGGY WORLD
SIM 
TOOLKIT
1
Security Parameter Indicator
Security Parameter Indicator
Security Parameter Indicator
Security Parameter Indicator
Bogdan ALECU
THE BUGGY WORLD
SIM 
1TOOLKIT
Bogdan ALECU
THE BUGGY WORLD
SIM 
1TOOLKIT
Bogdan ALECU
THE BUGGY WORLD
UDH (User Data Header): 027000
PID (Protocol ID): 7F
DCS (Data Coding Scheme): F6
000e0d00210000b20000aabbccddee00
CPL
CHL SPI SPI
0 0 1 0 0 0 0 1
KIc KID
TAR
CNTR
SIM 
1TOOLKIT
Bogdan ALECU
THE BUGGY WORLD
•
SIM card automatically replies to the 
sending number
•
Nothing in Inbox, Outbox – only on 
your bill
SIM 
1TOOLKIT
Bogdan ALECU
THE BUGGY WORLD
LET’S SEE IT IN ACTION!
SIM 
1TOOLKIT
Bogdan ALECU
THE BUGGY WORLD
HTTP 
2 HEADERS
Bogdan ALECU
THE BUGGY WORLD
Mobile operators have their own WAP / 
WEB page for customers:
•
Balance check
•
Money transfer
•
Download music, videos, wallpapers
•
Subscribe to services (eg. custom 
ringback tones)
HTTP 
2 HEADERS
Bogdan ALECU
THE BUGGY WORLD
HTTP 
2 HEADERS
Bogdan ALECU
THE BUGGY WORLD
User Agent Switcher https://addons.mozilla.org/en-
US/firefox/addon/user-agent-switcher/
HTTP 
2 HEADERS
Bogdan ALECU
THE BUGGY WORLD
•
Operators know who to charge based 
on HTTP headers
•
Sniff the traffic your phone does and 
look for the headers having mobile 
number
•
“Privacy Leaks in Mobile Phone 
Internet Access” by Collin Mulliner
HTTP 
2 HEADERS
Bogdan ALECU
THE BUGGY WORLD
7/8/2013
HTTP 
2 HEADERS
Bogdan ALECU
THE BUGGY WORLD
The old fashioned way of the attack
HTTP 
2 HEADERS
Bogdan ALECU
THE BUGGY WORLD
CSD (Circuit Switched Data)
•
Think about it like dial-up
•
Since it involves actually placing a 
phone call, it is exposed to the same 
vulnerabilities like a regular call
HTTP 
2 HEADERS
Bogdan ALECU
THE BUGGY WORLD
HTTP 
2 HEADERS
Bogdan ALECU
THE BUGGY WORLD
DEMO TIME!
HTTP 
2 HEADERS
Bogdan ALECU
THE BUGGY WORLD
Data traffic 
3 vulnerability
Bogdan ALECU
THE BUGGY WORLD
•
What happens when you reach data 
limit?
•
Have you ever tried to perform a DNS 
query?
MOBILE
3 DATA TRAFFIC
Bogdan ALECU
THE BUGGY WORLD
But what if …
•
you setup a VPN server listening on 
port 53 UDP (DNS port)
•
connect to this server and route all 
the traffic
MOBILE
3 DATA TRAFFIC
Bogdan ALECU
THE BUGGY WORLD
Internet traffic 
Works also in Roaming!
MOBILE
3 DATA TRAFFIC
Bogdan ALECU
THE BUGGY WORLD
4 The extra digit
Bogdan ALECU
THE BUGGY WORLD
Do you have a flat-rate plan with 
unlimited minutes in the operator’s 
network?
THE EXTRA 
4 DIGIT
Bogdan ALECU
THE BUGGY WORLD
Do not try this at home!
•
Take a ported number that was in your 
network
•
Add two more digits to the end of the 
number
•
Place the call
•
You will be charged like calling in your 
network
THE EXTRA 
4 DIGIT
Bogdan ALECU
THE BUGGY WORLD
THE EXTRA 
4 DIGIT
Bogdan ALECU
THE BUGGY WORLD
If that does not work…
-
try with one digit, all the digits
-
divert all calls to that number, but 
add a digit at the end of it
THE EXTRA 
4 DIGIT
Bogdan ALECU
THE BUGGY WORLD
5 Summary
Bogdan ALECU
SUmmary
“Our technology does not allow 
unauthorized access. Occurrence of 
errors in billing regarding data traffic or 
voice is excluded.” 
5 Summary
Bogdan ALECU
Summary
o Test yourself and report the issues to 
your carrier
o Check if your carrier allows you to 
disable access to premium rate 
services
5 Summary
Bogdan ALECU
Summary
o Filter SIM command messages
o Do not rely only on the caller ID
o Always authenticate, do not forget 
about privacy
5 Summary
F O R  Y O U R  A T T E N T I O N
THANK YOU
msecnet
www.m-sec.net
PI:EMAIL