Focus	
  of	
  this	
  study:	
• 
Peripheral	
  ASNs	
  that	
  are	
  siblings,	
  i.e.	
  they	
  have	
  common	
parents	
  in	
  the	
  AS	
  graph	
  (share	
  same	
  upstream	
  AS)	
• 
Cluster	
  peripheral	
  ASNs	
  by	
  country	
• 
Find	
  interesLng	
  paverns:	
  certain	
  siblings	
  in	
  certain	
countries	
  are	
  delivering	
  similar	
  suspicious	
  campaigns	
IP	
  style	
SemanNcNet	
  Library	
#!/usr/bin/env	
  python	
import	
  semanLcnet	
  as	
  sn	
graph	
  =	
  sn.Graph()	
a	
  =	
  graph.add_node({	
  "label"	
  :	
  “A”	
  })	
b	
  =	
  graph.add_node({	
  "label"	
  :	
  “B”	
  })	
c	
  =	
  graph.add_node({	
  "label"	
  :	
  “C”	
  })	
graph.add_edge(a,	
  b,	
  {	
  "type"	
  :	
  “belongs”	
  })	
graph.add_edge(b,	
  c,	
  {	
  "type"	
  :	
  “owns”	
  })	
graph.add_edge(c,	
  a,	
  {	
  "type"	
  :	
  “has”	
graph.save_json(“dataset.json”)	
DNS	
  style	
IP	
  style	
ParNcle	
  Physics	
IP	
  style	
Canadian	
  AS	
  Network	
INSERT	
  FORCE	
  DIRECTED	
  EXPANSION	
  VIDEO	
  HERE	
IP	
  style	
ParallelizaNon	
IP	
  style	
Why	
  ?	
•  Data	
  driven	
  vs	
  user-­‐driven	
•  Layout	
  closer	
  to	
  the	
  “natural	
  shape”	
  of	
  data	
  structure	
•  Take	
  advantage	
  of	
  the	
  GPU	
  for	
  acceleraLon	
•  Humans	
  are	
  good	
  at	
  processing	
  shapes	
  and	
  colors	
IP	
  style	
Data	
  VisualizaNon	
IP	
  style	
Global	
  ASN	
  graph	
Full	
  AS	
  Network	
OpenCL	
  IteraNons	
IP	
  style	
OpenCL	
  (~1h	
  later)	
IP	
  style	
Full	
  AS	
  Network	
IP	
  style	
Full	
  AS	
  Network	
IP	
  style	
Full	
  AS	
  Network	
IP	
  style	
ASN	
  Network	
  (Ukraine)	
IP	
  style	
Use	
  Case	
  #2	
Suspicious	
  Sibling	
  Peripheral	
  ASNs	
IP	
  style	
InvesNgaNon	
  Process	
Monitoring	
domains	
  &	
  IPs	
  from	
traﬃc	
  and	
  blacklist	
Study	
  IP	
  ranges	
  &	
ﬁngerprints	
Study	
  relaLonships	
between	
  ASNs	
Propose	
  ASN	
  based	
detecLon	
  model	
Study	
  BGP	
  outages	
Conﬁrm	
  model	
IP	
  style	
• 
Taking	
  a	
  sample	
  of	
  160	
  live	
  IPs	
  from	
  malicious	
  domains	
• 
/23	
  or	
  /24	
  serving	
  TrojWare.Win32.KrypLk.AXJX	
• 
  Trojan-­‐Downloader.Win32.Ldmon.A	
Study	
  IP	
  ranges	
  and	
  ﬁngerprints	
IP	
  style	
Study	
  IP	
  ranges	
  and	
  ﬁngerprints	
IP	
  style	
50	
  IPs	
  with:	
22/tcp	
  open	
  ssh	
  OpenSSH	
  6.2_hpn13v11	
  (FreeBSD	
  20130515;	
  protocol	
  2.0)	
8080/tcp	
  open	
  hvp-­‐proxy	
  3Proxy	
  hvp	
  proxy	
Service	
  Info:	
  OS:	
  FreeBSD	
108	
  IPs	
  with:	
22/tcp	
  open	
  ssh	
  OpenSSH	
  5.3	
  (protocol	
  1.99)	
80/tcp	
  open	
  hvp?	
Server	
  setup	
  is	
  similar	
  !	
Study	
  IP	
  ranges	
  and	
  ﬁngerprints	
IP	
  style	
Propose	
  ASN	
  based	
  detecNon	
  model	
SPN	
  Concept	
  (Sibling	
  Peripheral	
  Nodes)	
IP	
  style	
Study	
  relaLonships	
  between	
  ASNs	
• 
January	
  8th	
  topology	
  snapshot,	
  Ukraine,	
  Russia	
• 
10	
  sibling	
  peripheral	
  ASNs	
  with	
  2	
  upstream	
  ASNs	
IP	
  style	
• 
February	
  21st	
  topology	
  snapshot,	
  Ukraine,	
  Russia	
• 
AS31500	
  stopped	
  announcing	
  its	
  downstream	
  ASNs'	
  preﬁxes	
  !	
• 
More	
  peripherals	
  started	
  hosLng	
  suspicious	
  payload	
  domains	
  !	
Study	
  relaLonships	
  between	
  ASNs	
IP	
  style	
•  3100+	
  malware	
  domains	
  on	
  1020+	
  IPs	
  !	
• 
Payload	
  URLs	
  were	
  live	
  on	
  enLre	
  IP	
  ranges	
  before	
  any	
domains	
  were	
  hosted	
  on	
  them	
• 
Seems	
  the	
  IP	
  infrastructure	
  is	
  set	
  up	
  in	
  bulk	
  and	
  in	
  advance	
hvp://pastebin.com/X83gkPY4	
Study	
  relaLonships	
  between	
  ASNs	
IP	
  style	
Data	
  VisualizaNon	
SPN	
  Concept	
  (Sibling	
  Peripheral	
  Nodes)	
IP	
  style	
TODO	
Applied	
  Dataviz	
  (Color	
  connecLons)	
  +	
  SPN	
  model	
  on	
previous	
  ASN	
  list	
+	
  Videos	
  of	
  interacLve	
  extracLon	
  (If	
  possible)	
+	
  Story	
  of	
  ﬁnding	
  (ASN	
  hosLng	
  escort	
  service	
websites)	
Graph	
  Topology	
IP	
  style	
SPN	
  DetecNon	
IP	
  style	
SPN	
  DetecNon	
IP	
  style	
STUDY	
  BGP	
  OUTAGES	
IP	
  style	
BGP	
  MESSAGES	
Two	
  important	
  BGP	
  message	
  types:	
1.  Update	
  messages	
  to	
  announce	
  a	
  new	
  path	
  for	
  a	
  one	
  or	
  more	
  preﬁxes	
2.  Withdrawal	
  messages	
  to	
  inform	
  BGP	
  speakers	
  that	
  a	
  certain	
  preﬁx	
  can	
no	
  longer	
  be	
  reached.	
By	
  correlaLng	
  these	
  messages	
  we	
  can	
  detect	
  outages	
  globally	
  and	
  in	
  real	
Lme	
IP	
  style	
OVERLAPPING	
  BGP	
  OUTAGES	
57604 
8287 
50896 49236 29004 45020 44093 48949 49720 50818 48361 
57604 x 
20 
17 
12 
22 
16 
11 
24 
20 
13 
5 
8287 
20 x 
41 
15 
17 
17 
15 
18 
18 
15 
5 
50896 
17 
41 x 
17 
16 
17 
18 
19 
16 
18 
7 
49236 
12 
15 
17 x 
8 
15 
13 
8 
12 
17 
3 
29004 
22 
17 
16 
8 x 
12 
22 
28 
18 
9 
6 
45020 
16 
17 
17 
15 
12 x 
12 
12 
12 
15 
4 
44093 
11 
15 
18 
13 
22 
12 x 
16 
10 
13 
6 
48949 
24 
18 
19 
8 
28 
12 
16 x 
20 
9 
8 
49720 
20 
18 
16 
12 
18 
12 
10 
20 x 
10 
4 
50818 
13 
15 
18 
17 
9 
15 
13 
9 
10 x 
4 
48361 
5 
5 
7 
3 
6 
4 
6 
8 
4 
4 x 
IP	
  style	
OVERLAPPING	
  BGP	
  OUTAGES	
57604 
29004 
48361 
57604 
22 
5 
29004 
22 
6 
48361 
5 
6 
IP	
  style	
ISP	
  48361 
AS57604	
  91.233.89.0/24 
AS29004	
  195.39.252.0/23 
no	
  outage 
down	
  for	
  35	
  minutes	
  2013-­‐07-­‐12	
  18:53	
  -­‐	
  2013-­‐07-­‐12	
  19:28 
down	
  for	
  36	
  minutes	
  2013-­‐07-­‐12	
  18:53	
  -­‐	
  2013-­‐07-­‐12	
  19:29 
no	
  outage 
down	
  for	
  497	
  minutes	
  2013-­‐07-­‐12	
  21:33	
  -­‐	
  2013-­‐07-­‐13	
  05:50 
down	
  for	
  497	
  minutes	
  2013-­‐07-­‐12	
  21:33	
  -­‐	
  2013-­‐07-­‐13	
  05:50 
no	
  outage 
down	
  for	
  479	
  minutes	
2013-­‐07-­‐22	
  21:57	
  -­‐	
  2013-­‐07-­‐23	
  05:56 
down	
  for	
  479	
  minutes	
2013-­‐07-­‐22	
  21:57	
  -­‐	
  2013-­‐07-­‐23	
  05:56 
no	
  outage 
down	
  for	
  33	
  minutes	
  2013-­‐07-­‐23	
  18:51	
  -­‐	
  2013-­‐07-­‐23	
  19:24 
down	
  for	
  33	
  minutes	
2013-­‐07-­‐23	
  18:51	
  -­‐	
  2013-­‐07-­‐23	
  19:24 
no	
  outage 
down	
  for	
  63	
  minutes	
  2013-­‐07-­‐29	
  04:54	
  -­‐	
  2013-­‐07-­‐29	
  05:57 
down	
  for	
  63	
  minutes	
  2013-­‐07-­‐29	
  04:54	
  -­‐	
  2013-­‐07-­‐29	
  05:57 
IP	
  style	
•  Unique	
  approach	
  for	
  ﬁnding	
  related	
  ASNs	
•  Overlapping	
  outages	
  could	
  mean	
•  Most	
  likely	
  relying	
  on	
  same	
  infrastructure	
•  Same	
  Data	
  center	
•  Same	
  RouNng	
  /	
  Switching	
  infrastructure	
•  Same	
  organizaNon	
  hiding	
  behind	
  diﬀerent	
  ASNs	
IP	
  style	
Conclusion	
•  Zbot	
  fast	
  ﬂux	
  proxy	
  network	
•  InvesLgate	
  IP	
  space:	
  AS	
  graph	
  topology	
  and	
  sub-­‐allocated	
  ranges	
•  Detect	
  suspicious	
  sibling	
  peripheral	
  ASNs	
•  Detect	
  sibling	
  ASNs	
  using	
  BGP	
  outages	
  monitoring	
•  Predict	
  malicious	
  IP	
  ranges	
•  Detect	
  malicious	
  subdomains	
  under	
  compromised	
  domains	
•  Novel	
  3D	
  visualizaNon	
  engine	
  for	
  graph	
  navigaLon	
  and	
  invesLgaLon	
IP	
  style	
References	
•  Distributed	
  Malware	
  Proxy	
  Networks,	
  B.	
  Porter,	
  N.	
  Summerlin,	
  BotConf	
  2013	
•  hvp://labs.opendns.com/2013/12/18/operaLon-­‐kelihos-­‐presented-­‐botconf-­‐2013/	
•  hvp://blog.malwaremustdie.org/2013/12/short-­‐talk-­‐in-­‐botconf-­‐2013-­‐kelihos.html	
•  hvps://zeustracker.abuse.ch/	
•  hvp://www.malware-­‐traﬃc-­‐analysis.net/	
•  hvp://techhelplist.com/index.php/tech-­‐tutorials/41-­‐misc/465-­‐asprox-­‐botnet-­‐
adverLsing-­‐fraud-­‐general-­‐overview-­‐1	
•  VirusTotal	
IP	
  style	
DHIA	
  MAHJOUB	
  @DhiaLite	
• 
Senior	
  Security	
  Researcher	
THIBAULT	
  REUILLE	
  @ThibaultReuille	
• 
Security	
  Researcher	
ANDREE	
  TOONK	
  @atoonk	
• 
Manager	
  of	
  Network	
  Engineering	
Thank	
  you	
  !	
(Q/A)	
www.OpenGraphiN.com