By Lawrence Baldwin & Jaeson Schultz
“Extreme IP Backtracing”
I've been attacked… now what?
The reality is that few attacks are launched directly from an 
attacker's system since they know they would be easily 
caught using standard backtracing methods.
The Internet is chock full 
of insecure systems which 
are easily (read already) 
compromised, providing a 
means for attackers to 
perform untraceable, 
indirect attacks.
• Reduce the total number of 
compromised hosts
• Minimize the amount of time that 
any system remains in a 
compromised state
The only profound way to improve 
overall Internet security is to:
In order to protect ourselves, we need 
to ensure that others are protected.
Every time your firewall or intrusion detection system logs
an event, don't assume the source is the actual attacker.  
Think of it as a cry for help from a likely victim whose 
system has been compromised and is just being controlled by 
an attacker.
When we discover that someone 
is obviously exposed, we should 
let them know and guide them 
to the information they need to 
get protected.
CNN.com article “Avoiding future denial-of-service attacks” 
about the Feb 2000 DDOS attacks on Yahoo, eBay, 
Amazon.com and E*Trade
“Authorities pursuing the attackers say 
the servers they used belonged to users 
that had no idea their resources were 
being used to launch attacks.”
Why notify victims?
Recently, myNetWatchman detected an incident in which a host was 
infected with the Microsoft SQL Spida Worm.  A backtrace of the 
offending IP yielded some interesting results…
% This is the RIPE Whois server.
% The objects are in RPSL format.
% Please visit http://www.ripe.net/rpsl for more information.
% Rights restricted by copyright.
% See http://www.ripe.net/ripencc/pub-
services/db/copyright.html
inetnum:      194.190.139.0 - 194.190.139.255
netname:      GAN
descr:        Central Region of GAN RF
country:      RU
admin-c:      AV753-RIPE
tech-c:       AV753-RIPE
status:       ASSIGNED PA
notify:       PI:EMAIL
notify:       PI:EMAIL
mnt-by:       ROSNIIROS-MNT
changed:      PI:EMAIL 19991018
source:       RIPE
GAN=The Nuclear Safety Authority of Russia
"Federal supervision of Russia on nuclear and radiating safety (Gosatomnadzor of 
Russia) as the federal enforcement authority, organizes and carries out state 
regulation of safety at use of an atomic energy, nuclear materials, radioactive 
substances and products on their basis in the peace and defensive purposes (except 
for regulation of the activity connected to development, manufacturing, test, 
operation of the nuclear weapon and nuclear power installations of military 
purpose(assignment)). "
The
Backtracing
Process
Source IP Validation
Confirm the Source of Traffic
• Local Network
• Extended Local Network
(e.g. cable modem neighbor)
• Internet
Source IP Validation
Exclude the „Martian Addresses‟
“A router SHOULD NOT forward any packet 
that has an invalid IP source address”
RFC1812 - Requirements for IP Version 4 Routers – Section 5.3.7 
Martian Address Filtering
Broadcast
0.0.0.0/8
Loopback 
127.0.0.0/8
Multicast
224.0.0.0/4
Limited Broadcast      255.255.255.255/32
Source IP Validation
“The Internet Assigned Numbers Authority (IANA) has 
reserved the following three blocks of the IP address 
space for private internets: 
10.0.0.0 - 10.255.255.255  
(10/8 prefix)
172.16.0.0 - 172.31.255.255  
(172.16/12 prefix)
192.168.0.0 - 192.168.255.255 
(192.168/16 prefix)”
Source IP Validation
RFC1918 - Address Allocation for Private Internets
Exclude Private Addresses
# ENGLISH
IP Address         : 172.21.3.168-172.21.3.199
Connect ISP Name   : DREAMX
Connect Date       : 20000622
Registration Date  : 20000706
Network Name       : DSB
[ Organization Information ]
Orgnization ID     : ORG127773
Name               : DSB
State              : PUSAN
Address            : Billra Dangrishinik 407 Dangri-Dong
Zip Code           : 604-010
[ Admin Contact Information]
Name               : YOUNGKIL SHIN
Org Name           : DREAMX
State              : SEOUL
Address            : 12F World Tower 7-25 Shincheon-Dong Songpa-Gu
Zip Code           : 138-240
Phone              : +82-2-3434-1790
Fax                : +82-2-3434-1799
E-Mail             : PI:EMAIL
[ Technical Contact Information ]
Name               : SUKBONG KIM
Org Name           : DREAMX
State              : SEOUL
Address            : 12F World Tower 7-25 Shincheon-Dong Songpa-Gu
Zip Code           : 138-240
Phone              : +82-2-3434-1768
Fax                : +82-2-3434-1799
E-Mail             : PI:EMAIL
Solution to the Korean Spam problem?
RESERVED-9       
1.0.0.0 - 1.255.255.255
RESERVED-2       
2.0.0.0 - 2.255.255.255
PDN     
14.0.0.0 - 14.255.255.255
RESERVED-23     
23.0.0.0 - 23.255.255.255
RESERVED-31     
31.0.0.0 - 31.255.255.255
RESERVED-37     
37.0.0.0 - 37.255.255.255
RESERVED-39A     
39.0.0.0 - 39.255.255.255
RESERVED-41A     
41.0.0.0 - 41.255.255.255
RESERVED-58     
58.0.0.0 - 58.255.255.255
RESERVED-59     
59.0.0.0 - 59.255.255.255
RESERVED-60     
60.0.0.0 - 60.255.255.255
RESERVED-7     
69.0.0.0 - 79.255.255.255
RESERVED-11     
82.0.0.0 - 95.255.255.255
RESERVED-8    
96.0.0.0 - 126.255.255.255
Exclude IANA Addresses*
*Note:  This information is subject to change.  
Looking up „IANA‟ at ARIN.net will give you the current list.
Source IP Validation
RESERVED-3     
128.0.0.0 - 128.0.255.255
BLACKHOLE.ISI.EDU   
128.9.64.26
TEST-B   
128.66.0.0 - 128.66.255.255
LINKLOCAL 
169.254.0.0 - 169.254.255.255
RESERVED 
191.255.0.0 - 191.255.255.255
RESERVED-192     
192.0.0.0 - 192.0.127.255
ROOT-NS-LAB       
192.0.0.0 - 192.0.0.255
NET-ROOTS-NS-LIVE    192.0.1.0 - 192.0.1.255
NET-TEST
192.0.2.0 - 192.0.2.255
RESERVED-2A   
192.0.128.0 - 192.0.255.255
RESERVED-2-A    
192.0.128.0 - 192.0.255.255
IANA-192   
192.88.99.0 - 192.88.99.255
RESERVED-13   
197.0.0.0 - 197.255.255.255
RESERVED-14   
201.0.0.0 - 201.255.255.255
RESERVED   
221.0.0.0 - 223.255.255.255
IANA Addresses contd…
Source IP Validation
Note possibly contrived bogus IPs
improbable octet sequences
• 1.2.3.4
• 5.6.7.8
nmap decoy addresses
• 24.24.24.24
• 23.23.23.23
Source IP Validation
"The weakness in this scheme [the Internet 
Protocol] is that the source host itself fills in the 
IP source host id, and there is no provision in ... 
TCP to discover the true origin of the packet."
Robert T. Morris writing about IP in his 1985 paper  “A Weakness 
in the 4.2BSD Unix† TCP/IP Software”
Perform Spoof Detection
Source IP Validation
Traceroute Hop Count
Step 1: Calculate the *implied* hop count from the packet you 
received.  The *implied* hop count is: 
Original packet TTL - Final TTL (where you received it)
(Note that you must guess what the original TTL value is.)
Step 2: Traceroute to the IP and get an *actual* hop count. If 
substantially different from the implied count, then the IP may be 
spoofed
Spoof Detection
Source IP Validation
Default TTL Values
+-------------------+----------+----------+
| OS Version        |  tcp_ttl |  udp_ttl |
+-------------------+----------+----------+
AIX  
60  
30
FreeBSD 2.1R   
64   
64
HP/UX 9.0x   
30   
30 
HP/UX10.01  
64   
64 
Irix 5.3  
60   
60
Irix 6.x  
60   
60
Linux   
64   
64
MacOS/MacTCP 2.0.x   
60   
60
OS/2 TCP/IP 3.0   
64   
64
OSF/1 V3.2A 
60   
30
Solaris 2.x  
255  
255
SunOS 4.1.3/4.1.4  
60   
60
MS Windows 95  
32
32
MS Windows NT 3.51        32   
32
MS Windows NT 4.0        128  
128
Spoof Detection
Source IP Validation
Traceroute Hop Count Difficulties
Type escape sequence to abort.
Tracing the route to forthelife.net (216.144.196.7)
1 63.237.160.113 8 msec 12 msec 8 msec
2 lax-core-01.inet.qwest.net (205.171.19.149) 8 msec 8 msec 8 msec
3 sjo-core-03.inet.qwest.net (205.171.5.155) 16 msec 16 msec 16 msec
4 sjo-core-01.inet.qwest.net (205.171.22.10) 16 msec 16 msec 16 msec
5 sfo-core-02.inet.qwest.net (205.171.5.131) 20 msec 48 msec 16 msec
6 chi-core-01.inet.qwest.net (205.171.5.42) 72 msec 64 msec 68 msec
7 chi-core-03.inet.qwest.net (205.171.20.174) 64 msec 64 msec 76 msec
8 chi-edge-17.inet.qwest.net (205.171.20.154) 64 msec 64 msec 68 msec
9 63.149.1.70 80 msec 84 msec 84 msec
10 10.60.1.9 80 msec *  80 msec
11 172.16.250.1 96 msec 84 msec 88 msec
12  *  *  *
13  *  *  *
Source IP Validation
Spoof Detection
Perform Route Validation
A Looking Glass site allows you to access the routing 
table on a core router.  Using this you can determine if 
any routes exist to the IP address you are interested in.
http://lg.above.net/