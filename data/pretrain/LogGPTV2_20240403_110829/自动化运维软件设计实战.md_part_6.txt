present
no
command
选
章
absent
present
yes/no
latest
项
集中化运维利器一
安装、更新、卸载操作
是否开启GPG检查
YUM配置文件
非幂等性命令
启用的仓库
禁用的仓库
说
包名
明
—Ansible
8
---
## Page 46
demo>demo.sql'
高效，这时就可以使用Ansible的cron 模块了。
自动化运维软件设计实战
special_time
weekday
month
minute
cron_file
backup
参
reboot
name
job
hour
day
cron模块参数及说明如表2.17所示。
ansible all
例：每天8点进行MySQL数据库的备份。
当管理的主机数目比较多的时候，人工到每台主机上进行Crontab的配置效率显然不
例如我们需要每分钟执行一次命令，那么就可以在Crontab中加入如下配置：
·week表示星期几，可以是从0到7之间的任何整数，这里的0或7代表星期日；
数
command是要执行的命令，可以是系统命令，也可以是自己编写的脚本文件。
必
-mcron-a
否
否
否
否
否
否
否
否
否
否
填
表2.17
默认值
cron 模块参数及说明
0
选项
hourly
daily
weekly
monthly
annually
yearly
reboot
yes/no
一
cron定义文件，指定了则读这份，
不会读用户的cron.d文件
重启后是否需要执行
特定的执行时间
修改前是否备份
作业的描述
执行的命令
说
-uroot-pxxxx
星期几
分钟
小时
月
天
明
---
## Page 47
参
system
参
service模块参数及相关参数如表2.19所示。
service模块可以帮助我们批量对服务进行操作。
3.服务管理模块一
state
name
gid
group 模块参数及说明如表2.18 所示。
例：批量重启httpd服务。
例：为主机批量添加Zabbix用户组。
使用Group可以对主机进行批量的用户组添加或者删除。
2.用户组管理模块
user
state
arguments
物
name
enabled
数
数
ansible all -m group -a'name=zabbix state=present'
数
必
否
否
是
否
填
必
否
否
填
是
否
否
-service
默认值
填
present
no
-group
表2.19service模块及相关参数
表2.18
默认值
默认值
group模块参数及说明
一
present
root
选
yes/no
absent
present
选
yes/no
present
absent
项
集中化运维利器一
是否是系统组
用户组的名字
用户组的GID
开机自启动
服务名称
新增/删除
执行作业的用户
启用或停用作业
说
参数
说
明
明
明
（续表）
Ansible
---
## Page 48
自动化运维软件设计实战
generate_ssh_key
user模块参数及相应说明如表2.20所示。
例：
user 模块可以用于对目标主机进行批量的用户管理。
4.
password
non_unique
login_class
createhome
comment
参
runlevel
参
remove
name
home
groups
group
dde
force
用户管理模块
sleep
pattern
：移除所有主机上的zabbix用户。
state
ansible all -m group -a
数
数
必
否
否
否
是
否
否
否
否
否
否
否
否
否
否
否
否
填
-user
尊
表2.20user模块参数及相应说明
默认值
默认值
'name=zabbix state=absent remove=yes'
default
一
no
no
选
选
yes/no
yes/no
yes/no
yes/no
yes/no
reloaded
restarted
stopped
started
一
项
项
如果服务被重新启动，则睡眠很多秒
定参数的进程，有则认为服务已经启动
如果服务没响应，则ps查看是否具有指
可以设置用户的登录类FreeBSD、
OpenBSD和NetBSD系统
可选设置用户账户的描述
后再执行停止和启动命令
相当于userdel-remove
以逗号分割的用户组
是否生成SSH密钥
是否创建home目录
相当于useradd-u
OpenRCinit脚本
是否强制操作
home目录
服务的状态
增加到组
用户组
说
说
密码
用户名
明
明
（续表）
---
## Page 49
2.5
候就会经常使用setup模块进行主机信息的查询。
么样的环境变量，它是承载在什么样的虚拟化平台之上的。我们在后续编写PlayBook的时
update_password
ssh _key_passphrase
ssh_key_comment
2.4节中我们抽取了Ansible 的一些常用模块进行讲解，相信读者已经对Ansible 有了
setup模块参数及说明如表2.21所示。
例：获取所有的信息。
setup模块可以获取主机上的许多信息，比如这台主机的 IP 是多少，主机上有一些什
ssh_key_type
ssh_key_file
ssh_key_bits
fact_path
参
参
PlayBook
系统信息模块一
system
uid
state
shell
ansible all-m setup
数
数
必填
否
否
否
否
否
否
否
否
否
否
填
-setup
表2.21
/etc/ansible/facts.d
SHOME/ssh/id_rsa
ansible-generated
默认值
默认值
always
present
setup模块参数及说明
no
rsa
2048
选
选
on_create
always
yes/no
absent
present
一
项
项
集中化运维利器一
是否需要更新密码
设置为系统账号
SSH密钥的类型
SSH密钥的密码
密钥的文件名
密钥的说明
密钥的位数
该用户的shell
fact的路径
用户的UID
说
新增/删除
过滤窜
说
明
明
（续表）
Ansible
---
## Page 50
蓝图。下面是一个PlayBook的例子。
多的特性。可以说假如 Ansible 的模块是设备的零件，那么 PlayBook 就是整个设备的设计
的命令去实现就显得不那么方便了。带条件的运维操作如图2.5所示。
然后为其中的三台主机部署MySQL，另外的三台主机部署Apache。
初步的了解。但是模块毕竟是独立运行的，例如有如下场景：我们需要先批量创建用户，
自动化运维软件设计实战
PlayBook是Ansible的另外一种执行模式，这种执行模式比直接执行单条命令具有更
2.5.1
·具备条件一
·流程化一
可以看到这个简单场景具备了下面所说的一些特点：
种流程化的运维操作，Ansible有了PlayBook这个概念。
PlayBook简介
某些设备需要部署MySQL，某些设备需要部署Apache。为了解决这
一先创建用户，再部署程序；
安装MySQL
是
图2.5带条件的运维操作
创建test用户
结束
开始
安装Apache
，这种情况下再用单条
---
## Page 51
users 则说明了采用什么用户执行这条命令。
针对特定的任务采用sudo：
采用sudo模式执行：
针对WebServer主机组，采用Root用户执行命令：
每份 PlayBook都需要指定针对哪些主机进行运维，而hosts变量则说明了这个问题，