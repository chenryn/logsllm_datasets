0
0
21
15
4
1
1
0
27
13
6
3
2
3
16
13
2
0
1
0
21
8
1
4
4
4
4
0
0
1
1
2
7
6
0
0
1
0
6
5
0
0
0
1
6
2
1
1
2
0
Table 6: Interception ratio of domains under different TLDs
TLD # Request Normal Redirection Replication
945,954
com
947,532
net
954,221
org
club 948,707
83.60% 14.80%
83.40% 15.10%
83.60% 14.90%
83.60% 14.90%
1.50%
1.50%
1.50%
1.50%
Table 7: Top 5 ASes with most DNS requests
Organization
Redirection Replication Alternative resolvers
AS
AS4134 China Telecom 5.19%
AS4837 China Unicom 4.59%
32.49%
AS9808 China Mobile
45.09%
AS56040 China Mobile
AS56041 China Mobile
23.42%
1 AS56046 also belongs to China Mobile.
0.26%
0.51%
8.85%
0.04%
0.09%
116.9.94.* (4134)
202.99.96.* (4837)
112.25.12.* (9808)
120.196.165.* (56040)
112.25.12.* (560461 )
5.2 Performance of DNS Lookups
As claimed by one large ISP [24], DNSIntercept is de-
signed for improving the performance of DNS lookups,
and we would like to investigate whether this is true. We
regard RTT (round-trip-time), the interval between send-
ing request and receiving answer measured by client, as
the indicator of DNS lookup performance. Both times-
tamps can be recorded by clients in our study.
Figure 9 presents the ECDF of RTT of DNS requests.
We ﬁnd that performance impacts introduced by each
type of interception are different. As for Request repli-
cation, when DNS requests are sent over UDP by clients,
performance improvement does exist, with more requests
of shorter RTT compared to Normal resolution. How-
(b) UDP
(a) TCP
Figure 9: ECDF of RTT of DNS requests
ever, over TCP, due to the cost of establishing connec-
tions, the improvement is less obvious. On the other
hand, for Request redirection, the performance improve-
ment is uncertain. Taking TCP as an example, while 70%
witness better performance, 30% requests have longer
RTT than those not intercepted. While recalling that
redirected requests are mostly handled by local resolvers
(previously illustrated in Table 4,
that alternative re-
solvers locate in the same AS as clients), it also shows
that little extra time overhead is introduced by the on-
path devices to redirect requests. As a result, the hidden
interception behavior is hard to be noticed by Internet
users.
Speciﬁcally for Request replication, taking replicated
requests to Google DNS as examples, we calculate the
difference of arrival time between in-band and corre-
sponding out-of-band requests, at authoritative name-
servers.
In total, out-of-band requests of 14,590 reso-
lutions (84.63%, of 17,239 replicated requests) arrive at
USENIX Association
27th USENIX Security Symposium    1123
Figure 10: Arrival time difference of replicated requests. Top
10 ASes with most replicated requests to Google Public DNS is
shown. If positive, in-band request from Google arrives slower
than the replicated one from alternative resolvers.
our authoritative nameservers faster than in-band ones.
Zooming into ASes, Figure 10 presents the top 10 ASes
with most replicated requests to Google. While repli-
cated requests from most ASes arrive faster, in AS4812
(China Telecom Group), all out-of-band requests lag be-
hind. We suppose that it might be caused by the imple-
mentation of network devices in this AS, or the out-of-
band requests following different and longer route.
Summary. Through RTT of DNS lookups, we discover
that Request replication improves the performance of
DNS lookups, especially for requests over UDP, mak-
ing out-of-band responses more likely to be accepted
by clients. Observing from authoritative nameservers,
84.63% replicated requests to Google DNS arrive faster.
However, Request redirection brings uncertain impact
according to our ﬁndings.
5.3 Manipulation of Responses
By comparing responses generated by our authoritative
nameservers and those accepted by clients, we ﬁnd cases
where responses are tampered on the way back. We fo-
cus on TTL and DNS record values of a response and
elaborate on how they are manipulated.
TTL Value. As illustrated in Section 3.2, TTL values re-
turned by our authoritative nameservers are randomly se-
lected from 1 to 86400. However, for our clients, we ﬁnd
that about 20% of the TTL values are replaced, mostly
with a smaller value, as shown in Figure 11(a). By scat-
tering each request onto Figure 11(b), we ﬁnd that there
are preferred values for modiﬁed TTL, such as 1800,
3600 and 7200.
DNS record values. Though small in quantity, we do
observe cases where clients accept answers with tam-
pered DNS records (including A, AAAA and MX), shown
in Table 8. For A and AAAA records which occupy a
majority, besides being replaced with private addresses
(possibly being trafﬁc gateway), we observe DNS hi-
jacking for illicit trafﬁc monetization. As an example,
8 responses from Google Public DNS are tampered in
AS9808 (Guangdong Mobile), pointing to a web por-
(a) ECDF
(b) Scatter
Figure 11: TTL value of DNS responses. (a) presents the ECDF
of TTL difference; a positive value suggests TTL at client is
smaller than TTL from authoritative nameserver. In (b), each
dot represents a single response.
Table 8: Classiﬁcation of tampered DNS responses
Classiﬁcation
#
Tampered Responses
Client AS
Gateway
Monetization
54 192.168.32.1
10.231.240.77
10 39.130.151.30
117.102.104.28
AS4134, CN, ChinaTelecom
AS4134, CN, ChinaTelecom
AS9808, CN, GD Mobile
AS17451, ID, BIZNET
Misconﬁguration 26 mx1.norelay.stc.com.sa AS25019, SA, Saudi NET
AS9808, CN, GD Mobile
::218.207.212.91
Others
54 fe80::1
AS4837, CN, ChinaUnicom
tal which promotes an APP of China Mobile. The cor-
responding clients are located in the same AS. For MX
records, possibly due to conﬁguration errors, we observe
mail servers of a Saudi Arabian ISP show up in the re-
sponses to a client in AS25019 (Saudi Telecom Company
JSC).
5.4 Motivations of Interception
In this section, we investigate the motivations of
DNSIntercept. We ﬁrst survey the devices, vendors
and software platforms that provide DNSIntercept ca-
pability, by querying search engines and browsing tech-
nical forums.
In the end, we ﬁnd that three well-
known router manufacturers (Cisco [4], Panabit [23],
and Shenxingzhe [8]),
three companies (ZDNS [26],
Haomiao [7], Ericsson [21]) and one software platform
(DNS trafﬁc redirecting system of Xinfeng [24]) support
DNSIntercept. Meanwhile, several detailed technical
approaches to intercepting DNS trafﬁc have been pub-
lished in [7, 21, 23, 24, 26]. As an example, China Mo-
bile proposed an approach, which can replicate out-of-
band DNS requests at backbone networks and respond to
clients with local DNS resolvers, which is similar to Re-
quest replication. The above publications mention sev-
eral possible motivations of DNSIntercept, and we now
discuss them based on our measurement results.
Improving DNS security. Vendors claim that through
DNSIntercept, DNS requests are handled by trusted lo-
1124    27th USENIX Security Symposium
USENIX Association
cal DNS servers rather than untrusted ones outside the
local network, hence are less likely to be hijacked [24,
26]. However, ﬁrst of all, for clients who trust pub-
lic DNS services and designate them to handle DNS
requests, DNSIntercept certainly brings ethical issues
and violates the trust relationship between users and their
preferred DNS resolvers. Besides, our measurement re-
sults show that the interception ratio of public DNS ser-
vices, which are of good reputation and security deploy-
ment, is signiﬁcantly higher than that of less-known pub-
lic services. This conclusion conﬂicts with improving
DNS security using DNSIntercept, since out-of-band
public DNS services are not treated equally as untrusted
resolvers. What’s worse, while rare, we do observe hi-
jacking behaviors for proﬁt (e.g., trafﬁc monetization).
Improving performance of DNS lookups. Another
claimed motivation of DNSIntercept is to improve the
performance of DNS lookups and user experience. As
discussed in Section 5.2, we ﬁnd that Request replica-
tion does shorten the RTT of DNS lookups, while the
inﬂuence of Request redirection is uncertain. However,
in practice, for top 5 ASes shown in Table 7, the ratio of
Request redirection, which brings uncertain rather than
probable improvement of performance, is signiﬁcantly
higher. Therefore, DNSIntercept only brings limited
improvement to DNS lookup performance.
Reducing ﬁnancial settlement. ISPs, especially those
of a small scale, would like to reduce their cost of traf-
ﬁc exchange among networks. Request redirection satis-
ﬁes the need of reducing out-of-band trafﬁc, thus is wit-
nessed in some ASes as shown in Table 7. Therefore, we
suppose the ﬁnancial issue to be a major motivation of
DNSIntercept. After an ofﬂine meeting with the DNS
management team of one large Chinese ISP, this motiva-
tion is conﬁrmed.
5.5 Summary of Findings
To sum up, we develop the following ﬁndings in phase
China-wide analysis.
• On the whole, DNS packets over UDP are preferred
for DNSIntercept. Taking packets sent to Google
Public DNS as examples, 27.9% UDP-based packets
are intercepted, the ratio being only 7.3% over TCP.
Moreover, A-type requests have slightly higher inter-
ception ratio, while different requested domain names
introduce a minor difference.
• Interception behaviors are found in 61 ASes. We ﬁnd
that China Mobile, one of the largest Chinese ISPs,
has intercepted signiﬁcantly more DNS trafﬁc than
other ISPs. Request redirection is preferred, in order
to conduct DNSIntercept.
• As for the performance of DNS lookup, in general,
Request replication shortens the RTT of a DNS re-
quest. As for Request redirection, an uncertain effect
is brought to RTT of DNS requests.
• We speculate the motivations of DNSIntercept in-
clude reducing ﬁnancial settlement and improving
performance of DNS lookups, instead of improving
DNS security.
6 Threats
With good reputation and availability, well-known public
DNS services are widely trusted by Internet users and ap-
plications. Unfortunately, our study shows that the trust
can be violated by DNSIntercept. We further discuss
the potential threats and security concerns introduced by
DNSIntercept.
Ethics and privacy. DNSIntercept is difﬁcult to de-
tect at client side, thus Internet users might not realize
their trafﬁc is intercepted. Firstly, when DNS requests
from clients are handled by alternative resolvers, previ-
ous studies have proved it is possible to illegally mon-
etize from trafﬁc [36, 56]. Secondly, as it is difﬁcult
for Internet users to detect DNSIntercept merely from
clients, public DNS resolvers can be wrongly blamed
when undesired results (e.g., advertisement sites or even
malware) are returned [36]. Finally, it is possible for in-
tercepted DNS requests to be snooped by untrusted third
parties, leading to the leak of privacy data. Therefore,
we believe DNSIntercept potentially brings ethical and
privacy risks to Internet users.
DNS security practices. While popular public DNS
servers are often deployed with full DNSSEC support
and up-to-date DNS software, a number of nameservers
and resolvers in the wild are still using outdated or
even deprecated DNS software, which may be vulner-
able to known attacks [42, 54], and DNSSEC deploy-
ment on resolvers is still poor. We provide a cursory
view of security practices of 1,166 alternative DNS re-
solvers that contact our authoritative nameservers; 205
of them are open to the public. Although these resolvers
might not be broadly representative, they still provide us
with an opportunity to understand DNS security prac-
tices. Among the 205 public alternative resolvers, only
88 (43%) accept DNSSEC requests; those actually val-
idating DNSSEC requests could be less. After ﬁnger-
printing the DNS software deployed on the resolvers us-
ing fpdns [11], we ﬁnd 97 (47%) are running BIND. Un-
fortunately, the ﬁngerprint shows that all 97 servers use
versions earlier than 9.4.0, which ought to be deprecated
before 2009. Therefore, according to the public vulnera-
bility repository [6], all of them are vulnerable to known
attacks like DoS.
DNS functionalities. Besides DNSSEC, other function-