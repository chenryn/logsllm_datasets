User: 请解答这个和日志有关的问题npm install failing at gyp rebuild on ubuntu server 12.04.5 Hi [first serverfault q so hope this isn't too dumb a question]

I've got a setup on a Ubuntu 12.04.5 server that is just for deploying meteor js applications. Previously my deploy pattern worked but on my latest one something has gone wrong.

Briefly this is what I'm doing: cloning git repo of meteor project > using demeteorizer to bundle project to a 'standard' node.js app > installing npm modules > running with pm2.

The deployed app is not perfect or finished so it can be buggy and so I went to update it today. When I got into my server things were a little weird. I can't totally remember what was wrong but certain node.js programs seemed to be missing [demeteorizer was no longer there]. I also think I updated the  Ubuntu nodejs package recently to 0.10.[something]. I went to globally update npm and npm was failing. I ended up removing the nodejs ubuntu package and installing nvm and the latest node version [0.11.13]

So with the latest node and npm versions and a reinstalled demeteorizer and pm2 I thought I was in business. However when I run npm install on my demeteorized node app, node-gyp rebuild fails for multiple modules. Here is an example of the error log for one of the modules:

&gt; usage@0.4.3 install /var/www/naafi_emails/.demeteorized/node_modules/usage
&gt; node-gyp rebuild

make: Entering directory `/var/www/naafi_emails/.demeteorized/node_modules/usage/build'
  CXX(target) Release/obj.target/sysinfo/src/binding.o
../src/binding.cpp: In function ‘void RegisterModule(v8::Handle&lt;v8::Object&gt;)’:
../src/binding.cpp:7:15: error: ‘NewSymbol’ is not a member of ‘v8::String’
../src/binding.cpp:7:75: error: no matching function for call to ‘v8::Number::New(long int)’
../src/binding.cpp:7:75: note: candidate is:
/home/ubuntu/.node-gyp/0.11.13/deps/v8/include/v8.h:2061:24: note: static v8::Local&lt;v8::Number&gt; v8::Number::New(v8::Isolate*, double)
/home/ubuntu/.node-gyp/0.11.13/deps/v8/include/v8.h:2061:24: note:   candidate expects 2 arguments, 1 provided
../src/binding.cpp:8:15: error: ‘NewSymbol’ is not a member of ‘v8::String’
../src/binding.cpp:8:80: error: no matching function for call to ‘v8::Number::New(long int)’
../src/binding.cpp:8:80: note: candidate is:
/home/ubuntu/.node-gyp/0.11.13/deps/v8/include/v8.h:2061:24: note: static v8::Local&lt;v8::Number&gt; v8::Number::New(v8::Isolate*, double)
/home/ubuntu/.node-gyp/0.11.13/deps/v8/include/v8.h:2061:24: note:   candidate expects 2 arguments, 1 provided
../src/binding.cpp:15:15: error: ‘NewSymbol’ is not a member of ‘v8::String’
../src/binding.cpp:15:40: error: ‘New’ is not a member of ‘v8::String’
make: *** [Release/obj.target/sysinfo/src/binding.o] Error 1
make: Leaving directory `/var/www/naafi_emails/.demeteorized/node_modules/usage/build'
gyp ERR! build error 
gyp ERR! stack Error: `make` failed with exit code: 2
gyp ERR! stack     at ChildProcess.onExit (/home/ubuntu/.nvm/v0.11.13/lib/node_modules/npm/node_modules/node-gyp/lib/build.js:267:23)
gyp ERR! stack     at ChildProcess.EventEmitter.emit (events.js:110:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1046:12)
gyp ERR! System Linux 3.2.0-67-generic
gyp ERR! command "node" "/home/ubuntu/.nvm/v0.11.13/lib/node_modules/npm/node_modules/node-gyp/bin/node-gyp.js" "rebuild"
gyp ERR! cwd /var/www/naafi_emails/.demeteorized/node_modules/usage
gyp ERR! node -v v0.11.13
gyp ERR! node-gyp -v v0.13.0
gyp ERR! not ok 
npm ERR! 
npm ERR! Additional logging details can be found in:
npm ERR!     /var/www/naafi_emails/.demeteorized/npm-debug.log
npm ERR! not ok code 0


I believe the problem may lie in the node-gyp module however I'm stumped as to why this error is now happening, and how to fix it.

So far I have made sure that I have no gyp Ubuntu package installed and I have also removed the .node-gyp folder from ~/ to reset its permissions.

Assistant: "apt-get install make"

this will work