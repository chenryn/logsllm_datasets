selected exit nodes as their last hop. To improve the perfor-
mance of the scanning process, Exitmap uses two-hop circuits
instead of the default three-hop circuits. (Using single-hop
circuits is not an option because by default, exit nodes do not
allow direct connection from other non-Tor IP addresses [14];
additionally the authors of Exitmap argue that one-hop circuits
may permit exit node operators to treat scanning connections
differently [30, §3.2].)
To measure discrimination against Tor, we send many
HTTP requests per URL: with Tor through every available
exit node, and one without Tor. We use Exitmap to build Tor
circuits and a Python program to send the HTTP requests. Our
experiment of downloading thousands of URLs per exit node
stretched Exitmap past its original design parameters, requiring
us to overcome some scanning challenges. Downloading a
single URL using all the Tor exits requires 45–50 minutes
on average; however much of this time consists of circuit-
construction overhead. We reduced the total scanning time by
running 5 instances of Exitmap in parallel, and downloading
20 URLs at a time through each circuit. With these changes,
visiting 100 URLs through every Tor exit node takes around
1–2 hours on average. By default, Tor rebuilds circuits and
streams each hour. We set conﬁguration parameters to prevent
this.
We collected data for 5 days, from August 10 to August 14,
2015. We selected exit nodes that allow trafﬁc through port
80 and 443. Different runs of Exitmap can select different
exit nodes for two reasons: 1) The Tor directory authorities
release a fresh consensus on available nodes every hour. New
nodes might appear, old nodes might disappear, and nodes can
change their ‘exit policy’ of allowed ports. Thus the available
exit nodes can change every hour. 2) To build circuits Tor
clients need to download ‘enough’ of the network so that they
can construct a sufﬁciently large number of the possible paths
through the network. By default, Tor uses a value chosen by
the directory authorities, which can change every hour. Thus,
different exit nodes might be selected at different times. During
our data collection period, we collected data from 899–915 exit
nodes. The distribution of the exit probabilities in our dataset
is within the regular range as seen in Figure 3. We have a
good mixture of both high- and low-probability exit nodes. We
noticed that 83%–89% of the circuits succeeded. This success
rate is similar to previous exit scanning studies [30].
Table VIII shows the total number of HTTP requests sent
and responses received on each day. We intend to send 1,000
HTTP requests through over 900 exit nodes. The number of
HTTP requests per exit node should be 1,000, but the average
Fig. 3: The cumulative distribution of exit probability from 20 randomly
sampled Tor consensuses since September 2014. The bulk of exits have
between 0.001% and 1% probability of being selected. The largest exits tend
to have an exit probability around 5%. The notable rise just above 0.0001% is
an artifact of the bandwidth measurement process; when a node’s bandwidth is
unmeasured for whatever reason, it receives a default bandwidth of 20 KB/s,
giving it a very low exit probability of around 1 in 500,000.
A CloudFlare support page explains that while they do not
speciﬁcally target Tor users, ‘due to the behaviour of some
individuals using the Tor network (spammers, distributors of
malware, attackers, etc.), the IP addresses of Tor exit nodes
generally earn a bad reputation’ [3].
Some sites—mainly larger web properties,
though not
exclusively—apparently implement their own detection algo-
rithms and custom block pages. Notable examples in this
category are Craigslist and Yelp. Many other sites simply
inherit the blocking behavior of their web host or content
delivery network, which may or may not offer customers
control over the severity of blocking. In this latter case, a single
provider’s policy can affect many websites.
Our ﬁrst experiment—contemporary scans of Alexa
URLs—provides broad coverage across all Tor exit nodes
over a short time period. The second experiment—analysis of
historic OONI scan data—covers a long time span and more
URLs, but lacks a longitudinal comparison across all exits for
each URL. Figure 3 illustrates the rationale for conducting
our own scans in addition to analyzing past data. Tor clients
do not choose exit nodes with equal probability; each exit is
weighted according to its bandwidth [23, §3.8.3]. Faster nodes
have a greater probability of being used (subject to some other
constraints such as exit policies). The OONI data reﬂects Tor
circuits made in the ordinary fashion; therefore low-probability
exits are rarely represented. Measuring low-probability exits
is important because it helps to distinguish the two kinds of
blocking: slow exits will appear on blacklists but will have
fewer users and thus be less likely to exceed abuse thresholds.
Our measurements are limited to home pages, except for
about 3% of OONI URLs that include a path component.
The Alexa URLs are only home pages. We know through
experience that some application-layer blocking only becomes
apparent when accessing certain deeper features or pages of
websites. For example, Wikipedia allows Tor users to read but
not to edit articles [28]. Google allows access to its home
page but may present a CAPTCHA or block page when doing
a search. Bank of America does not permit logging in. We did
not undertake to discover such deeper blocks, which would
require extensive additional methodology to conduct in a large-
scale fashion.
9
mean0.090%median0.008%0%25%50%75%100%10%1%0.1%0.01%0.001%0.0001%Exit probabilityFrequencyCDF of exit probabilityDate
# Exits
Aug 10
Aug 11
Aug 12
Aug 13
Aug 14
Average
908
915
905
915
899
908
Request
Control
1000
1000
1000
1000
1000
1000
Per Exit
741.29
679.43
735.66
735.46
738.22
726.01
Response (200)
Control
992
985
986
989
989
98.82%
Per Exit
641.93
595.21
632.96
639.44
641.55
86.81%
Response (non-200)
Control
1
3
6
4
2
0.32%
Per Exit
26.03
23.93
28.22
26.84
28.18
3.67%
Non-HTTP Errors
Control
7
12
8
7
9
0.86%
Per Exit
73.33
60.29
74.48
69.18
68.49
9.53%
TABLE VIII: This table shows the total number of HTTP requests sent and responses received during the 5 days of scanning. On average, over 3.67% of the
Alexa top websites discriminate against Tor (p-value = 0.008)
Fig. 4: These graphs show the relationship between blocking rate and exit probability. Each dot represents one exit node. The size of a dot represents the age
of an exit (when the node became an exit) in days. Bigger nodes are older than the smaller nodes. The colored dots represent exit nodes blocked by different
sites. (a) The leftmost graph shows the number of exit nodes blocked by bestbuy.com, which is hosted on Akamai. bestbuy.com and other Akamai sites
block over 60% of the exit nodes. (b) The middle graph shows the number of exit nodes blocked by a site hosted on CloudFlare (change.org). (c) The last
graph shows the number of exit nodes blocked by another site hosted on CloudFlare (4chan.org). 4chan.org uses a less strict setting than change.org,
and thus blocks mostly high probability and older exit nodes.
number of requests per exit node was less than 800. This
discrepancy occurs for two reasons: 1) As mentioned in the
previous section, different exit nodes can be selected during
different runs of Exitmap because the available exit nodes
can change every hour. Since our crawl takes over 10 hours
to ﬁnish, some of the exit nodes were not available for the
whole span of crawling. 2) Even when the same exit nodes
are selected, some exit nodes are incapable of handling 1,000
HTTP requests because of resource limitations.
We consider a website to discriminate against Tor when it
responds with a 200 ‘OK’ status code when visited without
Tor, and some other valid but non-200 level status code when
visited with Tor. On average, around 3.67% of the Alexa top
1,000 websites responded with a non-200 status code when
visited through Tor (Table VIII), whereas only at most 6 sites
responded with a non-200 code when visited without Tor.
To check whether this difference is statistically signiﬁcant,
we computed the p-value using permutation test under the
null hypothesis of independence. We chose the permutation
test because it does not assume that the responses of the
experimental units are independent and identically distributed.
In our case, many of the top Alexa 1,000 websites are hosted
on the CloudFlare and Akamai CDNs. For all of these sites,
whether they send a non-200 response to a Tor exit is not
independent. The p-value of the permutation test
is 0.008
which shows that web visits through Tor receive different
treatment from the websites. We also encountered around
8% non-HTTP errors such as timeouts and connection resets,
which can be caused by discrimination at layers 3 and 4.
We noticed that no site blocks all Tor exit nodes (Figure 5).
During these ﬁve days, on average 15.6 sites out of the Alexa
1,000 top sites blocked over 60% of Tor exit nodes. These
sites include yelp.com (up to ≈ 70% exit nodes blocked),
macys.com (up to ≈ 60%), and bestbuy.com (up to
≈ 66%). The majority of these sites are hosted on Akamai and
Amazon Web Services. The websites on Akamai all show a
403 ‘Access Denied’ block page, which a user cannot bypass.
Yelp and Craigslist have their own block page. Some websites,
e.g., macys.com, return a redirect error that often leads to an
inﬁnite redirect loop. On average, around 69 sites block over
10–50% of the Tor exit nodes (Figure 4). The majority of
these websites are hosted on CloudFlare. On average, around
150 websites block less than 10% of the Tor exit nodes and
the rest of the websites (over 700) do not block any exit nodes
at the home page.
To check whether these blocking events are abuse-based or
Tor-speciﬁc, we looked at the age and exit probability of exit
nodes. We assume that abuse-based blocking is more likely
to block old or high-probability exit nodes because they have
more opportunity to attract abuse, while blacklist-based or Tor-
speciﬁc blocking tends to block all exits equally. We down-
loaded node exit probabilities and ages from Onionoo [20].
We used logistic regression to determine the effect of the
exit characteristics on blocking rate.3 Overall (across all
measured sites), we did not ﬁnd any statistically signiﬁcant
effect; however for speciﬁc websites and speciﬁc blockers
we found signiﬁcant effects. We manually tested three sites:
bestbuy.com (on Akamai), change.org (on CloudFlare),
3We acknowledge that logistic regression requires each observation to be
independent which might not be true in our case. We chose logistic regression
because it can handle non-linear relationship and can provide an estimation
of the effect.
10
0%3%6%9%1%0.01%0.0001%Exit probabilityFraction of webpages blockedTor blocked by bestbuy.com0%3%6%9%1%0.01%0.0001%Exit probabilityFraction of webpages blockedTor blocked by change.org0%3%6%9%1%0.01%0.0001%Exit probabilityFraction of webpages blockedTor blocked by 4chan.orgAkamai site did. Figure 4 compares the different subsets of
exits blocked by the three sites.
Some sites do not block Tor on their home page but block
other pages or functions. We conducted a small ancillary
experiment on search engines with URLs containing search
queries (as opposed to the URLs of home pages). The home
page of google.com is not blocked for any Tor exit node,
but searching on Google was blocked for 23–40% of them
(varying on different days). We noticed similar behavior in
Yahoo!, where searching is blocked for around 1% of the exits,
but the homepage is always accessible.
We found 42 exit nodes that were not blocked by any of
the Alexa top 1,000 websites during our 5-day crawl. These
exits do not appear to be dedicated Tor exit nodes. All the exits
have similar characteristics: 1) All except one are hosted on