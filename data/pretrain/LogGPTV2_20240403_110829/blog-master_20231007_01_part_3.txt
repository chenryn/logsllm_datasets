PostGIS SQL 例子如下:    
```  
with   
-- a 受害人(ID=1) 10.7号轨迹  
a as (select uid, ST_MakeLine(pos order by ts) as tra from user_pos where uid=1 and ts >= '2023-10-07' and ts  1 and ts >= '2023-10-07' and ts < '2023-10-08' group by 1)   
select   
  a.uid,  
  b.uid,  
  -- 两条轨迹相隔最近时的M值, 这里M代表时间戳  
  ST_ClosestPointOfApproach(a.tra, b.tra) m,  
  -- 将M转换为时间戳  
  to_timestamp(ST_ClosestPointOfApproach(a.tra, b.tra)) ts,  
  -- 两条轨迹最近时轨迹a的位置   
  st_astext(ST_LocateAlong(a.tra, ST_ClosestPointOfApproach(a.tra, b.tra))) a,  
  -- 两条轨迹最近时轨迹b的位置   
  st_astext(ST_LocateAlong(b.tra, ST_ClosestPointOfApproach(a.tra, b.tra))) b,  
  -- 使用球坐标计算两条轨迹最近时的距离, 单位米  
  ST_DistanceSpheroid(ST_LocateAlong(a.tra, ST_ClosestPointOfApproach(a.tra, b.tra)), ST_LocateAlong(b.tra, ST_ClosestPointOfApproach(a.tra, b.tra))) tra_meters,   
  -- 不管轨迹M值, 以纯线段的方式计算2条轨迹的距离, 单位米  
  ST_DistanceSpheroid(a.tra, b.tra) line_meters,   
  -- 由于轨迹使用4326坐标系, 不转换坐标系, 使用ST_DistanceCPA计算两条轨迹最近时的距离得到的是degree单位的值  
  ST_DistanceCPA(a.tra, b.tra) dis_by_srid_4326,   
  -- 将几何对象转换为适用于米的投影坐标参考系统  
  -- 转换为BD-09（百度坐标系）的EPSG代码是EPSG：3857, GCJ-02和BD-09是非标准的坐标系，其转换结果可能存在一定的误差。  
  ST_DistanceCPA(ST_Transform(a.tra,3857), ST_Transform(b.tra,3857)) dis_by_srid_3857,   
  -- 接触点距离是否在5米以内?  
  ST_DistanceSpheroid(ST_LocateAlong(a.tra, ST_ClosestPointOfApproach(a.tra, b.tra)), ST_LocateAlong(b.tra, ST_ClosestPointOfApproach(a.tra, b.tra))) < 5 dist_within_5_meters   
from a,b limit 10;   
```  
```  
-[ RECORD 1 ]--------+--------------------------------------------------------------------------  
uid                  | 1  
uid                  | 2  
m                    | 1696697311.3036995  
ts                   | 2023-10-07 16:48:31.3037+00  
a                    | MULTIPOINT M ((121.31658534763336 30.187193591499327 1696697311.3036995))  
b                    | MULTIPOINT M ((121.31654815735817 30.18717094370127 1696697311.3036995))  
tra_meters           | 4.373915142071747  
line_meters          | 0.016491753952581085  
dis_by_srid_4326     | 4.354353360589861e-05  
dis_by_srid_3857     | 0.36991291409089133  
dist_within_5_meters | t  
-[ RECORD 2 ]--------+--------------------------------------------------------------------------  
uid                  | 1  
uid                  | 3  
m                    | 1696703047.2971663  
ts                   | 2023-10-07 18:24:07.297166+00  
a                    | MULTIPOINT M ((121.1313048864607 30.35598715900421 1696703047.2971663))  
b                    | MULTIPOINT M ((121.13124493157522 30.3559373743466 1696703047.2971663))  
tra_meters           | 7.980249939657012  
line_meters          | 0.014040196551025192  
dis_by_srid_4326     | 7.79300994034703e-05  
dis_by_srid_3857     | 2.3202176959047467  
dist_within_5_meters | f  
-[ RECORD 3 ]--------+--------------------------------------------------------------------------  
uid                  | 1  
uid                  | 4  
m                    | 1696714926.6986308  
ts                   | 2023-10-07 21:42:06.698631+00  
a                    | MULTIPOINT M ((121.22373551545142 30.26627129611969 1696714926.6986308))  
b                    | MULTIPOINT M ((121.22394794253111 30.266598629581928 1696714926.6986308))  
tra_meters           | 41.64862299149548  
line_meters          | 0.005156185117280435  
dis_by_srid_4326     | 0.0003902210394268254  
dis_by_srid_3857     | 47.17957374737505  
dist_within_5_meters | f  
-[ RECORD 4 ]--------+--------------------------------------------------------------------------  
uid                  | 1  
uid                  | 5  
m                    | 1696705262.5495796  
ts                   | 2023-10-07 19:01:02.54958+00  
a                    | MULTIPOINT M ((121.37177815465725 30.27131101107496 1696705262.5495796))  
b                    | MULTIPOINT M ((121.37172153333307 30.271289392630607 1696705262.5495796))  
tra_meters           | 5.952059806803198  
line_meters          | 0.02082467099524442  
dis_by_srid_4326     | 6.0608015048630094e-05  
dis_by_srid_3857     | 10.781228219837937  
dist_within_5_meters | f  
-[ RECORD 5 ]--------+--------------------------------------------------------------------------  
uid                  | 1  
uid                  | 6  
m                    | 1696638810.0620923  
ts                   | 2023-10-07 00:33:30.062092+00  
a                    | MULTIPOINT M ((121.12317522716522 30.266258507394788 1696638810.0620923))  
b                    | MULTIPOINT M ((121.12303405156064 30.26638752446608 1696638810.0620923))  
tra_meters           | 19.7259144659703  
line_meters          | 0.005841662369415527  
dis_by_srid_4326     | 0.00019124839491914186  
dis_by_srid_3857     | 4.96812051205451  
dist_within_5_meters | f  
-[ RECORD 6 ]--------+--------------------------------------------------------------------------  
uid                  | 1  
uid                  | 7  
m                    | 1696647555.7661612  
ts                   | 2023-10-07 02:59:15.766161+00  
a                    | MULTIPOINT M ((121.04340661763372 30.29411974696469 1696647555.7661612))  
b                    | MULTIPOINT M ((121.0434242972109 30.294122692171733 1696647555.7661612))  
tra_meters           | 1.731839173153422  
line_meters          | 0.003999721077257994  
dis_by_srid_4326     | 1.7923216457506776e-05  
dis_by_srid_3857     | 13.363477510814603  
dist_within_5_meters | t  
-[ RECORD 7 ]--------+--------------------------------------------------------------------------  
uid                  | 1  
uid                  | 8  
m                    | 1696667418.9117382  
ts                   | 2023-10-07 08:30:18.911738+00  
a                    | MULTIPOINT M ((121.4588447823869 30.16601897884593 1696667418.9117382))  
b                    | MULTIPOINT M ((121.4590019390485 30.165965665920574 1696667418.9117382))  
tra_meters           | 16.250915960631275  
line_meters          | 0.018480064946785075  
dis_by_srid_4326     | 0.00016595325936695634  
dis_by_srid_3857     | 11.054858168555002  
dist_within_5_meters | f  
-[ RECORD 8 ]--------+--------------------------------------------------------------------------  
uid                  | 1  
uid                  | 9  
m                    | 1696722730.1260679  
ts                   | 2023-10-07 23:52:10.126068+00  
a                    | MULTIPOINT M ((121.32588992220283 30.295322107986475 1696722730.1260679))  
b                    | MULTIPOINT M ((121.32568354031474 30.295544315750558 1696722730.1260679))  
tra_meters           | 31.638203036955655  
line_meters          | 0.014506525287765921  
dis_by_srid_4326     | 0.00030326518781932817  
dis_by_srid_3857     | 40.15213564699135  
dist_within_5_meters | f  
-[ RECORD 9 ]--------+--------------------------------------------------------------------------  
uid                  | 1  
uid                  | 10  
m                    | 1696705787.834826  
ts                   | 2023-10-07 19:09:47.834826+00  
a                    | MULTIPOINT M ((121.3880368950087 30.27887733767146 1696705787.834826))  
b                    | MULTIPOINT M ((121.3881332828405 30.278952208693173 1696705787.834826))  
tra_meters           | 12.44574769306065  
line_meters          | 0.04376000475557697  