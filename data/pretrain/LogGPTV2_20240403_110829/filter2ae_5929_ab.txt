需要说明的是，通过”arp -a”命令获取到的IP-MAC对应表并非包括局域网内的全部设备，通常只包括和本机发生过数据通信的主机，但是列表中一定会包含网关，和试图攻击本机的局域网内主机，因此通过此种方法可以获取到需要的IP-MAC对应信息。
# 0x03 DNS劫持
1）DNS劫持原理和危害
DNS（Domain Name
System）域名服务主要是提供域名到IP地址的映射和转换[27]。在Internet的普及过程中，因为域名比IP更容易记忆，所以Internet的用户通常只会通过域名来访问一个站点，因此DNS服务的作用非常关键
[24]。通常局域网网关会在网络配置中设置可信的DNS服务器地址，但基于现有的路由器网络，由于种种路由器漏洞、弱口令等安全问题，路由器一旦被攻击者控制，攻击者便可通过篡改DNS指向自己控制的可定制的DNS服务器，就能实现区域的网络流量劫持和篡改，窃取敏感信息，甚至通过替换返回流量植入远控木马，从而控制内网计算机，极大危害整个内部网络的安全[28]。
先说如何远程修改人家路由器的DNS，我原来实践过一个思路，就是针对一些老版本的路由器（比如老款的TP-link），利用CSRF漏洞。
**你假设目标用户家里的路由器默认帐号密码是admin和admin，然后假设默认路由器地址是192.168.1.1，然后你就可以自己搭建个Web页面，然后再页面中嵌入类似如下这句payload（这个payload也是我根据路由器实际修改DNS的数据包构造的,假设想把目标用户的路由器DNS改为16.16.16.16）**
，然后你把自己构造的互联网可访问的Web页面URL发给目标用户（假设构造好的URL为
如果他点击了你的URL，页面中的payload就会用你猜测的密码和路由器IP去尝试修改DNS，如果你都猜对了，就能成功修改目标路由器的DNS了：
这个payload的成功关键在与你猜对了用户名密码，和路由器的IP地址，其实很多老版本路由器都有默认的用户名密码和IP地址，小白用户也大都不会改，所以当时这种CSRF攻击成功率还是很高的。如果是猜测用户刚好登陆了自家的路由器的状态，那我们的payload就可以省略猜测用户名密码的部分，当然你也可以多嵌入几个payload猜测不同的密码或路由器IP地址，提高成功率。
目前的路由器大多已经加强了安全机制，比如我买过新款的TP-link，就取消了默认密码设定，让用户首次使用时自己设定初始密码。
DNS劫持示意图下图所示。
**DNS劫持的危害属于“人有多大胆，地有多大产”**
，简单的比如在网页返回包中植入广告，严重的监控你的下载行为进行病毒木马程序的替换，隐蔽点的监控你某款软件的升级行为，然后对升级包进行替换，从而神不知鬼不觉地植入远程控制的木马等等。
2） **DNS劫持检测思路**
检测DNS的思路主要有两种，首先通过命令”ipconfig -all”或者”ifconfig”可以读取到本地的DNS设置，如下图所示。
需要说明的是，该DNS默认情况下是通过DHCP的方式由网关自动配置，也可以通过本地配置。因此，可以定期读取本地的DNS配置，然后通过建立可信DNS白名单的方式对本地DNS的安全性进行判断。
根据DNS劫持的原理，由于DNS劫持后会对全部或者部分流量进行代理，这种技术一个简单的实现思路，就是不管你请求什么域名，返回的IP地址会统一指向
**攻击者控制的流量监控和转发服务器的IP地址**
，然后那个服务器会对经过的流量进行监控和替换，因此通过ping命令，ping若干知名站点，如百度(www.baidu.com)、京东(www.jd.com)，若返回IP为当前DNS的IP或某一个相同的IP，则可判断已受到上述这种DNS劫持攻击[29]。
# 0x04 其他内网攻击
除了上述端口扫描以及暴力破解、ARP攻击、DNS劫持外，内网还可能出现网络嗅探[30]、伪装DHCP服务器[31]、拒绝服务DoS(Denial Of
Service)
[32]、漏洞扫描[33]等攻击手段，但在以太网网络架构下，随着网关设备、终端操作系统及防护软件的升级，一些内网攻击手段的代价在不断提升，有效性在不断降低，因此本节只重点介绍了当前内网比较常见以及危害较大的端口扫描及暴力破解、ARP攻击、DNS劫持三种内网攻击手段，并对相应的检测思路进行了阐述。另一方面也是因为精力问题没有再进一步扩展。
# 0x05 部分参考文献
这些文献大多是论文，通常高校的校园网访问图书馆系统或者一些第三方论文库都可以免费搜索访问。
  * [1] 李欣, 侯松霞. 内网安全防御系统的研究[J]. 计算机应用, 2007, 27(B06):245-246.
  * [19] 吴灏. 网络攻防技术[M]. 机械工业出版社, 2009.
  * [20] 常用服务和开放端口对照[EB/OL]. , 2014.2.13.
  * [21] 上野宣. 图解HTTP[M]. 人民邮电出版社, 2014.
  * [22] 竹下隆史, 乌尼日其其格. 图解TCP/IP(第5版)[J]. 电脑编程技巧与维护, 2014(6).
  * [23] 马琳. 基于端口扫描检测技术的实现[J]. 信息系统工程, 2013(3):107-108.
  * [24] 谢希仁. 计算机网络(第5版)(附光盘)[M]. 电子工业, 2012.
  * [25] 董延华, 李爽, 宋珊. 基于网络协议仿真系统的ARP攻击原理分析[J]. 吉林师范大学学报:自然科学版, 2011, 32(1):65-66.
  * [26] 阮清强. ARP攻击检测与定位方法研究[J]. 信息网络安全, 2010(4):66-66.
  * [27] Daisuke M, Katsunari Y, Tsutomu M. Observing DNS Amplification Attacks with DNS Honeypot[J]. Ipsj Journal, 2014, 55:2021-2033.
  * [28] 胡小梅, 刘嘉勇. 基于DNS劫持的流量监测系统设计与实现[J]. 网络安全技术与应用, 2016(1).
  * [29] 刘京义. 针锋相对抗击DNS劫持[J]. 网络运维与管理, 2015(1):103-106.
  * [30] 黄孝楠, 韩宇. 用于局域网的网络嗅探器的设计[J]. 网络安全技术与应用, 2014(8):95-96.
  * [31]安全科普：流氓DHCP服务器内网攻击测试., 2015.8.15.
  * [32] 严芬, 王佳佳, 赵金凤,等. DDoS攻击检测综述[J]. 计算机应用研究, 2008, 25(4):966-969.
  * [33] Nmap脚本使用总结., 2014.6.8.
_系列文章，未完待续，看这更新的频率，“不打扰是我的温柔”这种借口我都不好意思说了_...
* * *
_也欢迎关注我的博客：sosly 菜鸟笔记_  