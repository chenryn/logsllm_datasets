回滚：如表所示，非常感到关切的是在被TARDIS识别为长期多阶段攻击的20,591个网站中，只有91个网站看到了AV警报。更重要的是，因为仅当AV向网站所有者警告可疑活动时，才会提醒网站所有者回滚。
AV警报数量如此之少（即少于攻击总数的1％）是“备份和还原”模型被证明无效且这些攻击持续了相当长一段时间的原因。
在触发AV警报的91个网站中，并非全部采取行动。如表所示，在这91个网站中，只有29个尝试回滚到AV警报前的快照，以从攻击中恢复该网站。此外，AV臭名昭著的是会产生导致威胁警报疲劳的虚假警报-真正的AV警报被忽略的另一个原因，这也许可以解释为什么91个网站中只有29个尝试回滚。
再感染：从表可以看出，在29个试图从攻击中恢复的网站中，TARDIS在这些网站的65％以上发现了重新感染。认为这很容易使攻击者感到困惑，无法找到回滚的网站文件，但其原始后门仍然存在。这证实了长期以来一直认为AV不可靠的信念。
它们不仅丢失了绝大多数攻击，而且对AV的强烈依赖也使得现有的“备份和还原”技术在很大程度上无效。这些数字重申了TARDIS设计背后的动机-在夜间备份空间中需要系统的来源技术。使用回滚手动验证了网站，发现直觉是正确的：在每次重新感染的情况下，回滚快照都位于导致重新感染的入侵窗口（由TARDIS标识）内。在所有受感染的网站中，只有10个网站设法回滚到了入侵窗口之外，从而修复了入侵。这证实了TARDIS的来源推断对于受损的网站调查至关重要。
###  E.表现
上图显示了TARDIS花费的时间来衡量306,830个网站的所有属性，以及相对于文件大小而言的网站大小。
TARDIS线性评估每个时间快照，以可接受的开销为整个网站提供事件和事件标签的时间表。尽管此开销随网站上文件数量的增加而定（无论这些文件的大小如何），但从图的斜率可以看出，增加幅度很小。TARDIS的最坏情况，即处理1859个快照（平均100,000个空间元素）所花费的最大时间接近3500s。作为一种离线取证技术，认为这是非常合理的。
## 0x02 Case Study
###  A.案例研究1：攻击活动的全局视图
除了对单个网站进行调查之外，在商业网站备份平台中部署TARDIS
还可以提供攻击活动演变的全局视图。实验过程中发现了5个不同的WordPress网站在2018年9月至11月之间具有相同的源头演变。
在所有这些网站中，攻击者在5天内使用相似的变相混淆代码注入（O）策略在28个PHP文件中，随后是83个恶意软件实例被丢弃（M），以注入后门功能，然后维持状态（P）大约2个月，最终尝试进行攻击清除（C），以删除这些步骤的所有痕迹。在每种情况下，被丢弃的恶意软件都会禁用所有错误日志记录功能，并从远程服务器（在调查时处于活动状态）获取有效负载，并在受害Web服务器上执行该操作。它还收集输出缓冲区，将其发送回远程服务器，最后重新启用错误日志记录。这些动作被编程为每48小时运行一次。
如图所示，这些网站中的每个网站在相同的持续时间内都呈现出相同的攻击阶段演变和持久性。所有这些网站都属于不同的独特小型企业，它们恰好是在WordPress上构建其网站。一旦第一个WordPress网站（W1413857）遭到攻击，与初始网站完全不相关的另一个WordPress网站（W0697120）在6天后显示出完全相同的注入。
其次是在接下来的10天内，三个网站（W1438887，W1467224，W1532897）中发生了3次其他感染。在所有这五个网站中，混淆代码注入阶段持续5天，恶意软件丢弃阶段持续1天，保持存在51到56天，最后，通过删除所有注入的文件来清除攻击。由于AV无法识别此攻击，因此不会标记任何攻击，并且网站所有者也不会尝试回滚。
将来的部署：目前正在与CodeGuard合作，在其备份框架中在全球范围内部署TARDIS，以检测和跟踪大规模攻击趋势。这就需要扩展TARDIS，以实现跨网站的建模和关联。
###  B.案例研究2：“用户友好”远程控制
在一个基于Drupal的网站中，对3个月（2019年2月至2019年4月）的备份进行的调查显示存在以下阶段。
备份站点上集成的AV从未触发警报，使网站所有者对攻击一无所知。
TARDIS识别的入侵窗口显示，攻击者从2019年2月23日开始注入混淆的PHP代码，并在接下来的几天一直保持存在，直到2019年3月3日。从2019年3月4日开始，攻击者丢弃了恶意软件并使用了防御逃避方法：他们伪装了PHP文件作为图标文件，并在隐藏目录中上传了后门外壳。
3月6日，攻击者为后门注入了完整的图形用户界面（GUI），使他们可以完全控制该网站，如下图所示。所有这些文件在网站上保留了一个多月。
2019年4月13日，TARDIS发现攻击者删除了较早注入的恶意软件，以隐藏其先前的足迹。
TARDIS提供的时间轴显示，该网站在3个月的时间内持续存在多阶段攻击活动，并提供了一个折衷窗口（2019年2月23日至2019年4月13日），在该窗口之外可以安全地回滚该网站。手动调查显示，攻击者利用了CVE-2018-7600漏洞，即对Form
API（FAPI）AJAX请求的安全输入不足。请注意，此攻击开始一个月后才修复此漏洞。
## 0x03 Limitations
推断攻击来源的准确性受到备份粒度的限制,当前的行业规范是每晚收集网站备份。已经表明，这足以恢复攻击的时间表。但是，如果快节奏的攻击在两次连续备份之间经历了多个阶段，则TARDIS仅在备份时才可以看到文件。从本质上讲，TARDIS使网站所有者可以在进行备份的粒度（即使TARDIS更准确）与发生攻击时要求进行更深入的手动检查之间进行校准。
随着这些多阶段攻击的发展，TARDIS的空间度量标识规则可能会随着时间而改变。这种发展是可以预料的，并且TARDIS的模块化特性使添加新的空间度量变得很简单。此外，TARDIS的空间度量时间相关性方法应经受时间的考验，因为它是针对单个度量标准而设计的，并且基于多阶段攻击所经历的阶段不变性。
## 0x04 Related Work
Web攻击的大规模研究：已经发表了一些研究，这些研究使用高交互性蜜罐大规模地理解了网络攻击。此外，一些技术试图通过研究托管提供商的角色来评估Web应用程序危害的影响，并通过研究大规模的通知活动来了解响应态势。与TARDIS类似，还发现攻击者在Web服务器上丢弃了大量文件。尽管这些技术专注于针对通用Web应用程序的攻击，但本研究研究了基于CMS的网站（更具体地讲，在生产网站中）的多阶段攻击的传播。研究和TARDIS旨在仅基于每晚网站备份来调查此类多阶段攻击。
因果关系建模：在通过监视系统行为来重建攻击源的过程中，已经取得了重大进展。大多数专注于高级多阶段攻击检测的工作，例如Holmes和Sleuth，都是基于OS审核数据并使用系统调用级别日志进行实时分析的。但是，这些基于日志的细粒度出处跟踪技术需要大量工具，并且CMS托管公司几乎不部署。
TARDIS利用业已存在的标准（夜间备份），通过空间度量的时间相关性和异常值检测对长期的多阶段攻击进行建模。
Web应用程序安全性：为了抢先保护网站免受攻击，最近的研究集中在分析特定类型的攻击，例如广告注入(ad injection)，调查欺诈(survey
scams)，跨站脚本，PHP代码注入，SQL注入，文件包含攻击等。这些研究技术着重于Web应用程序的各个层。但是，由于CMS包含所有这些层的代码，并且已销售给技术含量较低的网站运营商，因此通常不部署针对攻击向量的解决方案。
TARDIS与攻击向量无关，可以调查受到攻击的CMS攻击后。
## 0x05 Conclution
本文使用TARDIS对306个830个独特生产网站上的CMS攻击格局进行了系统研究。针对仅使用随时可用的夜间备份来调查基于CMS的网站中的漏洞的问题，TARDIS提供了一种新颖的来源推断技术，可重构攻击阶段并实现从攻击中的快速恢复。使用代表每个快照的空间量度的时间相关性，TARDIS恢复了折衷窗口和攻击阶段的进展。
TARDIS发现了20,591个长期遭受多阶段攻击的受害者的网站，并且被证明在基于CMS的网站中揭示攻击的准确性很高，而与底层CMS无关。正在与CodeGuard合作，以通知网站所有者并补救已识别的攻击。