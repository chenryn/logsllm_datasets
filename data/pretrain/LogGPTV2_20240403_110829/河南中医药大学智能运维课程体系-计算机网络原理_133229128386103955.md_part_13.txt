---
## Page 228
228
6.路由选择协议
6.5路由器的结构
交换结构:
口
总线
存储器
1
(a）通过存储器
(b)通过总线
河南中医药大学信息技术学院互联网技术教学团队／https://inte
lactcm.edu.cn
---
## Page 229
229
6.路由选择协议
6.5路由器的结构
口交换结构:
互连网络
(c)通过互连网络
河南中医药大学信息技术学院互联网技术教学团队／https://in
cm.edu.cn
---
## Page 230
230
6.路由选择协议
6.5路由器的结构
通过存储器
当路由器的某个输入端口收到一个分组时，就用中断方式
通知路由选择处理机。然后分组就从输入端口复制到存储
仔
器中。
储
器
路由器处理机从分组首部提取目的地址，查找路由表，再
将分组复制到合适的输出端口的缓存中。
若存储器的带宽（读或写）为每秒M个分组，那么路由器
(a）通过存储器
的交换速率 (即分组从输入端口传送到输出端口的速率)
一定小于 M/2。
河南中医药大学信息技术学院互联网技术教学团队／https://internet.hactcm.edu.cn
---
## Page 231
231
6.路由选择协议
6.5路由器的结构
通过总线
总线
数据报从输入端口通过共享的总线直接传送到合适的输出
端口，而不需要路由选择处理机的干预。
当分组到达输入端口时若发现总线忙，则被阻塞而不能通
过交换结构，并在输入端口排队等待。
因为每一个要转发的分组都要通过这一条总线，因此路由
器的转发带宽就受总线速率的限制。
(b)通过总线
河南中医药大学信息技术学院互联网技术教学团队／https://int
cm.edu.cn
---
## Page 232
232
6.路由选择协议
6.5路由器的结构
通过纵横交换结构（crossbarswitchfabric)
常被称为互连网络 (interconnection network)。
它有 2N 条总线，控制交叉节点可以使 个输入端口和 N
个输出端口相连接。
当输入端口收到一个分组时，就将它发送到水平总线上。
若通向输出端口的垂直总线空闲，则将垂直总线与水平总
线接通，把该分组转发到这个输出端口。若输出端口已被
占用，分组在输入端口排队等待。
O:
特点：是一种无阻塞的交换结构，分组可以转发到任何一
(c)通过互连网络
个输出端口，只要这个输出端口没有被别的分组占用。
河南中医药大学信息技术学院互联网技术教学团队／https://internet.hact
tcm.edu.cn
---
## Page 233
233
6.路由选择协议
6.5路由器的结构
NE40E-X8
NE40E-X16
NE40E-X3
河南中医药大学信息技术学院互联网技术教学团队／https://inter
---
## Page 234
234
6.路由选择协议
6.5路由器的结构
AR2220
AR2240
河南中医药大学信息技术学院互联网技术教学团队／https://internet.hactcm.edu.cn
---
## Page 235
235
6.路由选择协议
6.5 路由器的结构
Juniper
CISCO
NETWORKS
HUAWEI
锐捷网络
H3C
口
Extreme
Ruijie
networks
IToIP解决方案专家
河南中医药大学信息技术学院互联网技术教学团队／https://internet.hactcm.edu.cn
---
## Page 236
236
7.IP多播
7.1IP 多播的基本概念
1988 年，Steve Deering 首次提出IP 多播的概念。
■多播(multicast)：以前曾译为组播。
√06 ↑
■目的：更好地支持一对多通信。
R-1
■一对多通信：一个源点发送到许多个终点
R-2
R-3
R-4
采用单播方式
向90台主机传送
同样的视频节目
需要发送90个单播
河南中医药大学信息技术学院互联网技术教学团队／https://inter
tcm.edu.cn
---
## Page 237
237
7.IP多播
7.1IP多播的基本概念
1988 年，Steve Deering 首次提出IP 多播的概念。
■多播(multicast)：以前曾译为组播。
↓1个
■目的：更好地支持一对多通信。
R-1
1一对多通信：一个源点发送到许多个终点
↓1个
↓1个
11个
采用多播方式
只需发送一次到多播组。
R-2
R-3
R-4
路由器复制分组。
1个
1个
1个
局域网具有硬件多播功能，不需要复制分组。
当多播组的主机数很大时（如成干上万个），
采用多播方式可明显地减轻网络中资源消耗
河南中医药大学信息技术学院互联网技术教学团队／https://intel
cm.edu.cn
---
## Page 238
238
7.IP多播
7.1IP多播的基本概念
口IP多播
■在互联网上进行多播就叫做IP多播。
■互联网范围的多播要靠路由器来实现
■能够运行多播协议的路由器称为多播路由器(multicastrouter)。
■多播路由器也可以转发普通的单播IP数据报。
■从1992年起，在互联网上开始试验虚拟的多播主干网MBONE（Multicast
Backbone On the InterNEt).
---
## Page 239
239
7.IP多播
7.1IP多播的基本概念
口多播使用的IP地址
■在IP多播数据报的目的地址需要写入多播组的标识符。
■多播组的标识符就是IP地址中的D类地址（多播地址）。
地址范围：224.0.0.0~239.255.255.255
■每一个D类地址标志一个多播组。
口多播地址只能用于目的地址，不能用于源地址。
n.edu.cn
---
## Page 240
240
7.IP多播
7.1IP多播的基本概念
口多播数据报
■多播数据报和一般的IP数据报的区别:
口目的地址：使用D类IP地址。
口协议字段=2，表明使用网际组管理协议IGMP。
■尽最大努力交付，不保证一定能够交付多播组内的所有成员。
■对多播数据报不产生ICMP差错报文。
口在 PING 命令后面键入多播地址,
CAW
C: \Users\ruanx>ping 224. 0. 0. 1
口将永远不会收到响应。
正在 ,Ping 224.0.0.1具有32 字节的数据:
请求超时。
请求超时。
求超时。
请求超时。
224.0.0.1 的 Ping.统计信息;
数据包：已发送=4，岂接收=0，丢失=4（100% 丢失)，
---
## Page 241
241
7.IP多播
7.2在局域网上进行硬件多播
口IANA拥有的L以太网地址块的高24位为00-00-5E。
TCP/IP协议使用的以太网地址块的范围是：
从00-00-5E-00-00-00
到OO-OO-5E-FF-FF-FF
口
IANA 只拿出O1-00-5E-0O-00-0O到O1-0O-5E-7F-FF-FF（223个地址)
作为以太网多播地址。
■或者说，在 48位的多播地址中，前25位都固定不变，只有后23位可用作
多播。
---
## Page 242
242
7.IP多播
7.2在局域网上进行硬件多播
这5位不使用
8
16
24
31
D类IP地址
1110
32
7
0
0
S
0000.000100000000
01011110
表示多播
最低23位来自D类IP地址
48位以太网地址
收到多播数据报的主机，还要在IP层对IP地址进行过滤，
把不是本主机要接收的数据报丢弃。
河南中医药大学信息技术学院互联网技术教学团队／https://internet.hactcm.edu.cn
---
## Page 243
243
7.IP多播
7.3网际组管理协议1GMP和多播路由选择协议
口IP多播需要两种协议
1网际组管理协议IGMP
 (Internet Group Management Protocol)
口IGMP使多播路由器知道多播组成员信息（有无成员）
·IGMP 不知道IP 多播组包含的成员数，也不知道这些成员都分布在哪些网络上。
·IGMP 协议是让连接在本地局域网上的多播路由器知道本局域网上是否有主机参加或退出了某个多
播组。
■多播路由选择协议
口使多播路由器协同工作，把多播数据报用最小代价传送给多播组的所有成员。
m.edu.cn
---
## Page 244
244
7.IP多播
7.3网际组管理协议IGMP和多播路由选择协议
128.56.24.31
未参加多播组
参加多播组
226.15.37.123
IGMP
R-1
135.88.49.21
130.12.14.51
参加多播组
参加多播组
IGMP
IGMP
226.15.37.123
226.15.37.123
多播组
226.15.37.123
R-2
R-3
130.12.14.41
未参加多播组
参加多播组
IGMP
226.15.37.123
R-4
未参加多播组
未参加多播组
河南中医药大学信息技术学院互联网技术教学团队／https://internet.hactcm.edu.cn
---
## Page 245
245
7.IP多播
7.3网际组管理协议IGMP和多播路由选择协议
口IP多播需要两种协议
■多播路由选择协议
口多播路由选择协议更为复杂。
口多播转发必须动态地适应多播组成员的变化（这时网络拓扑并未发生变化），因
为每一台主机可以随时加入或离开一个多播组。
口多播路由器在转发多播数据报时，不能仅仅根据多播数据报中的目的地址，还要
考虑这个多播数据报从什么地方来和要到什么地方去。
口多播数据报可以由没有加入多播组的主机发出，也可以通过没有组成员的接入网
络。
m.edu.c1
---
## Page 246
246
7.IP多播
7.3网际组管理协议IGMP和多播路由选择协议
多播组M-1
N-1
(A, B, C)
N-3
G
N-2
R-1
B
多播组M-2
?
(D, E, F)
F
路由器R不应当向网络N-3转发多播组M-1的分组，因为网络N-3上没有多播组M-1的成员。
河南中医药大学信息技术学院互联网技术教学团队／https://internet.hactcm.edu.cn
---
## Page 247
247
7.IP多播
7.3网际组管理协议IGMP
口网际组管理协议IGMP
1997年公布的RFC 2236（IGMPv2，建议标准）对IGMPv1进行了更新。
■2002年10月公布了RFC3376（IGMPv3，建议标准）。
河南中医药大学信息技
---
## Page 248
248
7.IP多播
7.3网际组管理协议IGMP
口网际组管理协议IGMP
■IGMP使用IP数据报传递其报文。
■在IGMP报文加上IP首部构成IP数据报。
■但IGMP 也向IP 提供服务。
■因此：
口不把IGMP看成是一个单独的协议，而是整个网际协议IP的一个组成部分。
---
## Page 249
249
7.IP多播
7.3网际组管理协议IGMP
IGMP工作可分为两个阶段
第1阶段
第2阶段
加入多播组
探询组成员
变化情况
河南中医药大学信息技术学院互联网技术教学团队
cm.edu.cn
---
## Page 250
250
第1阶段：加入多播组
Host-1
Host-2
Host-3
Report:
团
加入224.1.1.10
IGMP
多播路由器
当某个主机加入多播组时，该主机向多播组的多播地址发送IGMP报文，声明自
已要成为该组的成员。
2.
本地的多播路由器收到IGMP报文后，将组成员关系转发给互联网上的其他多播
路由器。
---
## Page 251
251
Host-2
Host-3
Report:
加入 224.1.1.10
IGMP
Query:
有主机在多播组么？
多播路由器
1．本地多播路由器周期性地探询本地局域网上的主机，以便知道这些主机是否还继
续是组的成员。
2．只要对某个组有一个主机响应，那么多播路由器就认为这个组是活跃的。
3．但一个组在经过几次的探询后仍然没有一个主机响应，则不再将该组的成员关系
转发给其他的多播路由器。
---
## Page 252
252
7.IP多播
7.3网际组管理协议IGMP
口IGMP采用的一些具体措施，以避免增加大量开销
所有通信都使用IP多播。
口只要有可能，都用硬件多播来传送。
对所有的组只发送一个请求信息的询问报文。
口默认询问速率是每125秒发送一次。
当同一个网络上连接有多个多播路由器时，能迅速和有效地选择其中的一个
来探询主机的成员关系。
---
## Page 253
253
7.IP多播
7.3网际组管理协议IGMP
口IGMP采用的一些具体措施，以避免增加大量开销
■分散响应。
口在IGMP 的询问报文中有一个数值N，它指明一个最长响应时间（默认值为 10
秒）。
口当收到询问时，主机在〇到N 之间随机选择发送响应所需经过的时延。若一台主
机同时参加了几个多播组，则主机对每一个多播组选择不同的随机数。
口对应于最小时延的响应最先发送。
■采用抑制机制。
口同一个组内的每一个主机都要监听响应，只要有本组的其他主机先发送了响应
自己就不再发送响应了。
---
## Page 254
254
7.IP多播
7.4多播路由选择协议