title:Who's got your mail?: characterizing mail service provider usage
author:Enze Liu and
Gautam Akiwate and
Mattijs Jonker and
Ariana Mirian and
Stefan Savage and
Geoffrey M. Voelker
Who’s Got Your Mail? Characterizing Mail Service Provider
Usage
Enze Liu
UC San Diego
PI:EMAIL
Ariana Mirian
UC San Diego
PI:EMAIL
Gautam Akiwate
UC San Diego
PI:EMAIL
Stefan Savage
UC San Diego
PI:EMAIL
Mattijs Jonker
University of Twente
PI:EMAIL
Geoffrey M. Voelker
UC San Diego
PI:EMAIL
ABSTRACT
E-mail has long been a critical component of daily communication
and the core medium for modern business correspondence. While
traditionally e-mail service was provisioned and implemented in-
dependently by each Internet-connected organization, increasingly
this function has been outsourced to third-party services. As with
many pieces of key communications infrastructure, such central-
ization can bring both economies of scale and shared failure risk.
In this paper, we investigate this issue empirically — providing a
large-scale measurement and analysis of modern Internet e-mail
service provisioning. We develop a reliable methodology to better
map domains to mail service providers. We then use this approach
to document the dominant and increasing role played by a handful
of mail service providers and hosting companies over the past four
years. Finally, we briefly explore the extent to which nationality
(and hence legal jurisdiction) plays a role in such mail provisioning
decisions.
CCS CONCEPTS
• Information systems → World Wide Web; • World Wide
Web → Internet communications tools; • Internet communi-
cations tools → E-mail.
ACM Reference Format:
Enze Liu, Gautam Akiwate, Mattijs Jonker, Ariana Mirian, Stefan Savage,
and Geoffrey M. Voelker. 2021. Who’s Got Your Mail? Characterizing Mail
Service Provider Usage. In ACM Internet Measurement Conference (IMC ’21),
November 2–4, 2021, Virtual Event, USA. ACM, New York, NY, USA, 15 pages.
https://doi.org/10.1145/3487552.3487820
1 INTRODUCTION
Despite the rise of interactive chat and online social messaging
applications, e-mail continues to play a central role in communica-
tions. By some estimates, close to 300 billion e-mail messages are
sent and received each day [34]. In particular, e-mail remains the
central modality for modern business correspondence — long since
This work is licensed under a Creative Commons Attribution International 4.0 License.
IMC ’21, November 2–4, 2021, Virtual Event, USA 
© 2021 Copyright held by the owner/author(s). 
ACM ISBN 978-1-4503-9129-0/21/11.
https://doi.org/10.1145/3487552.3487820
122
displacing the postal service for such matters over the previous two
decades.
However, unlike the postal service (and many other forms of
person-to-person communication) e-mail is not centrally admin-
istered, but is organized such that each Internet domain owner,
by virtue of their DNS MX record, can make unique provisioning
decisions about how and where they will accept e-mail delivery.
Thus, organizations are free to provision separate e-mail services
for each domain they own, to share service among domains they
operate, or to outsource e-mail entirely to third-party providers.
These choices, in turn, can have significant implications for the
resilience, security, legal standing, performance and cost of e-mail
service.
In particular, concerns have been raised in recent years about
the general risks of increasing Internet service centralization and
consolidation [5, 10, 17]. For example, centralization amplifies the
impact of (even rare) service failures [4, 15, 25]. Similarly, a single
data breach in a widely-used service can put thousands of cus-
tomers’ data at risk.1 Finally, the legal jurisdiction in which a given
service provider operates is implicitly imposed on the data managed
by that provider. For instance, as a U.S. company, Google-managed
data is subject to the Stored Communications Act, which provides
data access to the government under warrant even if the data be-
longs to a foreign party not residing in the U.S..
Indeed, while historically e-mail was provisioned and imple-
mented independently by each organization (i.e., hosting a local
mail server acting as a full-fledged Mail Transfer Agent), the rise
of third-party enterprise mail service providers (notably Google
and Microsoft) has challenged that assumption; indeed, there are
compelling reasons to believe that that global e-mail service is also
increasingly subject to a significant degree of centralization. How-
ever, in spite of the importance of this issue there has been little
empirical analysis of e-mail provisioning choices and how they
have been evolving over time.2
In this paper, we perform a large-scale measurement and anal-
ysis of e-mail service provisioning and configuration. Our study
uses three large corpora of domains: one based on all .gov domains,
another based on a stable subset of the Alexa top 1 million domains
observed across nine snapshots between 2017 and 2021, and lastly
a similar dataset of one million .com domains sampled at random
1The recent vulnerabilities exploited in Microsoft’s Exchange Server were serious [20],
and it could have been even worse had attackers been able to penetrate Microsoft’s
Outlook e-mail service.
2One example can be found in Trost’s blog post “Mining DNS MX Records for Fun
and Profit”, although, as our results show, their approach has its limitations [36].
IMC ’21, November 2–4, 2021, Virtual Event, USA
Liu, Akiwate, Jonker, Mirian, Savage, and Voelker
from the same period. We use these datasets to gain insight into
the present popularity of e-mail service providers and their lon-
gitudinal shifts, and to characterize their makeup. From our data
we demonstrate the clear and growing dominance of a handful
of third-party e-mail service providers and the shrinking number
of domains that provision mail service “in-house” themselves or
through their hosting providers.
We make the following contributions:
(1) We detail and justify a methodology to map published MX
records to the identity of the mail service provider (providing
significant accuracy improvements over approaches that
entirely rely on MX record content);
(2) Using our methodology we identify the top e-mail service
providers and characterize their market share and customer
demographics;
(3) We provide a longitudinal analysis of mail service provider
popularity over time and document the source of market
share shifts;
(4) We explore the existence of national biases in the choice
of mail service provider (i.e., the extent to which mail for
domains in country X’s top-level domain (TLD) make use of
mail service from country Y and hence subject themselves
to Y’s legal jurisdiction).
Ultimately, our work not only provides a comprehensive anal-
ysis of the current state of Internet e-mail provisioning (and the
relative role of third-party web mail service providers, mail filtering
providers and “in-house” mail services), but also provides a solid
foundation on which to base future analyses of e-mail infrastruc-
ture.
2 BACKGROUND AND RELATED WORK
2.1 Simple Mail Transfer Protocol
The Simple Mail Transfer Protocol (SMTP) is part of a family of
protocols for mail transmission, including SMTP [27], Extended
SMTP (ESMTP) [18] and SMTP Service Extension for Authentica-
tion (SMTP-AUTH) [33].
In its purest form, as depicted in Figure 1, an e-mail user operates
a mail user agent (MUA) that uses ESMTP or SMTP-AUTH to sub-
mit e-mail messages to the sender’s mail submission agent (MSA)
software (e.g., their local mail server). The MSA in turn queues the
message for delivery with the sender’s mail transfer agent (MTA)
for relay to the mail infrastructure of the addressed parties in the
To:, CC: or Bcc: lines. Next, the sender’s MTA transfers the e-mail
to the recipient’s MTA, using SMTP or — if supported — ESMTP.
It is during this step that the sending MTA uses the recipient’s
DNS “Mail Exchanger” (MX) record to determine the location of
the receiving MTA. Having received the e-mail, the receiving MTA
then either delivers the mail locally or places it into a queue for fur-
ther processing. In practice, the MSA and MTA are often the same
piece of software (typically run on a single server in an “in-house”
implementation) and in Web mail situations (e.g., Gmail) the MUA
is a Web application provided by the same organization as the MSA
and MTA.
SMTP Procedures: A Summary. All protocols in the SMTP
2.1.1
family follow roughly the same procedure. A session starts when
123
Figure 1: Mail processing model
Figure 2: Banner and EHLO message in a typical SMTP ses-
sion between client (C) and server (S).
an SMTP client (either an MUA seeking to submit mail or an MTA
seeking to relay mail) opens a connection to an SMTP server, which
responds in kind with a greeting message. This message is infor-
mally referred to as the banner message, in which the server typically
provides either its domain name or IP address [18].
Once the SMTP client has received the greeting message, it nor-
mally sends the EHLO (or HELO in earlier versions) command to
the SMTP server, signaling its identity, which in turn elicits an
EHLO response message containing the SMTP server’s domain
name and a list of the extensions it supports. Figure 2 illustrates
the banner and EHLO message in a typical SMTP session with the
SMTP server (S) having domain foo.com and the SMTP client (C)
having domain bar.com. In this paper, we use EHLO message to refer
to the second EHLO, i.e., the message elicited from the server.
Depending on the protocol, additional messages may be ex-
changed between server and client for negotiating configuration
options such as authentication. The sending SMTP server can then
initiate a mail transaction. These last steps are important for the
delivery of message content, but are not relevant to this paper.
2.1.2 Mail submission and mail relaying. When the SMTP protocol
is used to submit a new message, e.g., between the sender’s MUA
and their MSA, the identity of the mail server is typically well-
known (i.e., pre-configured) and it is common for the MUA to
positively authenticate themselves using the SMTP-AUTH protocol.
Thus, the server will not accept SMTP transactions before the sender
presents appropriate credentials (also typically protected via a TLS
session initiated as part of this protocol step). In this fashion, the
customer-facing mail server designated by a broadband Internet
Service Provider is able to limit outbound mail submissions to only
their customers. In this mail submission mode, servers typically
accept connections on TCP port 587, as per RFC 6409 [19]. However,
port 465 is also common (although 465 was deprecated in RFC
8314 [24]), and in a number of cases sites may use port 25 for this
purpose (typically designating particular hosts to be MSAs and
others to be MTAs [19]).
Who’s Got Your Mail? Characterizing Mail Service Provider Usage
IMC ’21, November 2–4, 2021, Virtual Event, USA
When the SMTP protocol is used to relay a message (i.e., from
one MTA to another), the sending (i.e., outbound) MTA identifies its
partner MTA server by parsing e-mail addresses (i.e., user@domain)
to extract the associated domain names. For each (unique) domain
name in the destination address(es) of an e-mail, the sending MTA
will lookup a DNS MX record. This MX record points to the server
to which receiving e-mail on behalf of the particular domain name
is delegated. By fully resolving this record, the sending MTA server
ultimately identifies and establishes a connection with the receiving
MTA server. In this mail relay mode, TCP port 25 is typically used
(there are other ports that are used occasionally, such as port 2525,
but these are not supported by IANA or IETF [39] and so we do not
consider them in this paper).
2.2 Mail Exchanger Records
The Mail Exchanger (MX) record specifies which MTAs handle
inbound mail for a domain name [18, 24, 26] and is published in
the DNS zone of the domain. An MX record should itself contain
a valid domain name [23, 26]. Multiple MX records can be con-
figured in a zone, each with an assigned preference number. The
lowest preference has highest priority, and multiple MX records
can share the same priority for load balancing [18]. An MX record
can be made up, in part, of the registered domain name for which
it receives e-mail, yet resolve to completely separate infrastructure.
For instance, the MX record for our institution ucsd.edu contains
inbound.ucsd.edu, which in turn resolves to an IP address (A record)
owned and operated by ProofPoint, a well-established mail filtering
company wholly different from ucsd.edu.
2.3 STARTTLS and TLS certificates
Modern SMTP implementations opportunistically support the START-
TLS option which, in the mail relay context, allows the sending
MTA to initiate a TLS connection with the receiving MTA [11, 16].
If the receiving MTA supports STARTTLS, it will provide a TLS
certificate which can be used to bootstrap a TLS session providing
session confidentiality. To provide a valid certificate, the receiving
MTA must obtain a signed certificate from a trusted certificate au-
thority (CA) for which the MX domain name is either specified in
the Common Name (CN) or a Subject Alternative Name (SAN) field.
While ideally TLS certificates are validated by the sending MTA,
in practice SMTP sessions will continue even if the certificate does
not validate [13, 14]. Note that the SAN field is used when a single
certificate must support TLS connections across a range of domains.
For example, the certificate used by Gmail has Common Name
mx.google.com, and its SAN specifies other alternate domain names,
such as aspmx2.googlemail.com and mx1.smtp.goog.3 In these cases,
the Common Name (CN) almost always specifies a principal domain
operated by the provider of the service.
2.4 Related work
Considering its critical role, remarkably little contemporary anal-
ysis exists of e-mail infrastructure and who provides it. Some of
the best known modern work in this space is the pair of 2015
3mx1.smtp.goog is a valid and resolvable domain owned by Google.
papers authored by Durumeric et al. and Foster et al. which em-
pirically explored the use and configuration of privacy, authentica-
tion, and integrity mechanisms at each stage of the e-mail delivery
pipeline [13, 14]. Notably, Durumeric et al. also provide one esti-
mate of the top mail providers as a part of their study, although their
methodology may underestimate the influence of major providers
(notably Microsoft). Rijswijk et al. [37, 38] investigated the growth
of three top mail providers over a relatively short, 50-day period,
and demonstrated the phasing out of Windows Live over Office365,
among others. Their analysis, unlike ours, considers only the con-
tent of MX records, and mail was not the focal point of their work.
Finally, in 2005, Afergan et al. [2] measured the loss, latency, and
errors of e-mail transmission over the course of a month with hun-
dreds of domains.
Somewhat further afield, there is a literature exploring how dan-
gling DNS records impact e-mail security, starting with the work of
Liu et al. [22], who explored e-mail as a special case of a general anal-
ysis of dangling DNS issues. This work was recently expanded by
Reed and Reed in their technical report that focuses specifically on
dangling DNS MX records and their potential security impact [29].
Another direction of research, notably by Chen et al. [9] and Shen et
al. [32], studies the vulnerabilities of third-party mail providers and
how those vulnerabilities could be used to spoof e-mail messages.
In spite of these and related efforts, we have found very little
work focused on characterizing which organizations are, in fact,
responsible for providing mail service or how this responsibility
has changed over time. Indeed, perhaps the closest related work
is not from the academic literature, but from the recent Medium
post of Jason Trost which describes an analysis of MX records for
identifying e-mail security providers [36].
3 IDENTIFYING MAIL PROVIDERS
In this section, we first illustrate the challenges in identifying mail
service providers, in particular how MX records alone can be mis-
leading, and the strengths and weaknesses of using alternative
features. Given these limitations, we then present our priority-
based approach for identifying the mail provider for a given do-