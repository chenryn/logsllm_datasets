第1章 Windows Server 2016的安装与管理 19
图1.18 Event Viewer窗口
◆ 安全日志。此日志包含与审计资源访问和身份验证相关的事件。默认情况下，会有一些基本的审计，也可
配置其他审计。例如，可配置对文件系统访问的审计，以确定哪些用户正在访问或修改文件。
◆ 系统日志。此日志包含操作系统级别的事件。这里包含关于驱动程序加载或服务启停的信息。
应该偶尔扫描应用程序日志和系统日志，以识别任何错误或警告。这些项可能表明问题的出处。大多数情况下，
不需要阅读所有信息事件。但在检查某款软件执行的整个过程时，检查软件中的信息事件以及错误和警告事件是很
有用的。
为简化对日志中事件的读取，可对日志进行筛选，以显示来自特定源的特定事件类型和事件。还可创建跨多个
事件日志进行搜索的自定义视图，并显示与指定条件匹配的事件。默认存在一个Administrative Events自定义视图，
该视图显示来自所有事件日志的警告和错误。一些服务器角色还创建一个自定义视图，来显示与该服务器角色相关
的事件。
每个事件日志都有一个最大的日志大小。大多数日志的最大日志大小为20MB或更大，但这在日志之间有所不同。
可将最大日志大小修改为合适的级别。通常，希望日志包含足够的信息，以便排除故障。因此，日志中应该有足够的空
间容纳至少几个星期的信息。日志中收集的数据量有很大的不同，这取决于服务器的繁忙程度以及是否出现了错误。例
如，安全日志的默认大小128 MB可能包含小型组织几个月的事件，而只能包含大型组织一个小时的事件。
默认情况下，当事件日志满时，它会开始覆盖旧事件，以保持日志中最大的事件数量，而不会跳过任何新事件。
还可选择存档达到最大大小的事件日志。但随着时间的推移，需要监视归档事件日志的大小，因为它们永远不会自
动删除，可能会填满服务器上的C:驱动器。最后，可选择在事件日志满时停止收集事件。这个选项很少使用，因为
大多数情况下，最近发生的事件是最重要的。
如果是跨多个服务器监视事件，则可配置事件日志订阅。事件日志订阅允许将来自多个服务器的特定事件收集
到一台服务器的单个日志中。将事件集中在一台服务器上将使检查变得更容易。
有关转发事件日志的详细信息，请参阅 Windows Event Collector，网址是 https://msdn.microsoft.com/en-us/library/
bb427443(v = vs.85). aspx。
1.5.2 任务管理器
在Windows Server 2016中，Task Manager(任务管理器)的默认视图只显示系统上运行的应用程序的名称，不
显示关于资源使用或服务的任何细节。幸运的是，如果单击More Details，它会显示一个包含更多信息的视图，
如图1.19所示。
Task Manager中的选项卡显示如下内容：
◆ Processes。在服务器上运行的进程列表与每个进程的CPU和内存利用率一起显示。这些进程分为应用程
序、后台程序和Windows进程。
20 精通Windows Server 2016(第6版)
图1.19 Task Manager窗口
◆ Performance。显示有关CPU利用率、内存利用率和网络利用率的信息。这些信息对于识别特定资源是否
为性能瓶颈非常有用。
◆ Users。显示在控制台或通过远程桌面登录到服务器的所有用户，以及用户启动的进程的CPU和内存利用
率。如果展开用户，可查看各个进程。
◆ Details。对于每个进程，将显示可执行文件的名称、进程ID、状态、用户名、CPU利用率、内存利用率
和描述信息。可根据这些列对数据进行排序。
◆ Services。对于每个服务，都会显示服务名称、进程ID、描述和状态。这是了解服务信息的一种快速方法。
根据当前查看的选项卡，可对显示的项执行各种操作。可停止、启动和重新启动服务，可结束没有正确响应的
特定任务。也可打开进程的文件位置，来标识可执行文件的位置。
1.5.3 资源监视器
图1.20中的Resource Monitor(资源监视器)显示的性能信息比Task Manager中的更详细。信息分为四个最可能
成为瓶颈的资源：CPU、内存、磁盘和网络。
图1.20 Resource Monitor窗口
第1章 Windows Server 2016的安装与管理 21
Resource Monitor中的一个有用特性是能基于进程过滤视图。如果为特定进程选择复选框，视图将被过滤，只
显示所选进程的信息，过滤将应用于所有选项卡。
Overview 选项卡显示 CPU、内存、磁盘和网络中最常用信息的摘要。可以展开每个部分，以查看每个进程的
详细信息。
在 CPU 选项卡上，可看到每个进程或服务的 CPU 利用率。如果选择一个特定进程，还可在 Associated Handles
部分看到它正在访问的所有资源。Associated Modules部分显示进程使用的动态链接库(Dynamic Link Library，DLL)
文件。这个选项卡还显示了每个CPU内核的利用率，这样就可以确定某个进程是否使某个内核饱和了。
Memory选项卡标识每个进程使用的内存以及如何将其分配给操作系统。它显示使用了多少内存、使用了多少
缓存以及有多少是可用的。
Disk选项卡显示每个进程产生了多少磁盘活动。它还显示每个文件正在执行多少磁盘活动。当磁盘利用率很高
时，这有助于识别有问题的进程。存储部分显示每个驱动器的活动级别，包括磁盘队列长度，这是磁盘利用率的指
标。如果磁盘队列长度长时间大于1，那么磁盘系统就是瓶颈。
Network选项卡显示每个进程的网络利用率。它显示进程的总体利用率，并将其分解为与其他主机的单独对话。
还可看到所有TCP连接和监听端口的列表。
Windows Sysinternals
Windows Sysinternals是一组高级故障排除工具，可从微软免费下载。这些工具可提供关于Windows如何执行
任务的非常低级的信息，当标准Windows工具不能提供足够信息时，它们可用于找到并解决疑难问题。
一些可用工具包括：
◆ TCPView。这个实用程序显示了关于计算机上TCP和UDP端口的详细信息。
◆ Process Explorer。此工具识别进程打开的文件和DLL。
◆ Process Monitor。这个实用程序允许捕获进程的文件和注册表活动，以便理解它在一段时间内或在错误发
生时所做的工作。
有关Windows Sysinternals工具及其下载的更多信息，请参见Windows Sysinternals页面，网址是https://docs.
microsoft.com/en-us/sysinternals/。
1.5.4 性能监视器
Windows Server 2016包含大量性能计数器，允许监视系统性能的许多详细方面。性能计数器提供的数据比Task
Manager或Resource Monitor中提供的数据要详细得多，但可能更难解释。可使用Performance Monitor (性能监视
器，如图1.21所示)来记录和查看这些性能计数器。
图1.21 Performance Monitor窗口
22 精通Windows Server 2016(第6版)
Performance节点概述了通常监视的性能计数器。这里显示的数据类似于Task Manager中的Performance选项卡。
希望实时监视性能计数器时，可使用Performance Monitor节点。在这个节点中，可以添加和删除各种性能计数
器，并选择它们的显示方式。性能计数器可以显示为折线图、直方图或显示数值的报告。
要记录系统活动以供以后分析，需要创建一个数据收集器集合。数据收集器集合定义了要记录哪些性能计数器、
何时启动和停止。数据收集器集合在User Defined节点中创建。
Data Collector Sets中的System节点包含Windows Server 2016中的数据收集器集合。当添加服务器角色时，它
们有时会包含一个数据收集器，用于对该服务器角色进行故障排除。例如，在安装AD DS服务器角色时，将添加
Active Directory Diagnostics数据收集器集合。
在数据收集器集合运行后，将生成报表并存储在Reports节点中。报告提供了收集到的数据的摘要。对于性能
计数器，它显示平均值、最小值和最大值。
如果试图对某个特定时间点发生的性能问题进行故障排除，则需要检查性能计数器随时间变化的值。要查看性
能计数器在不同时间点的值，可使用 Performance Monitor 节点打开数据收集器集合中的日志文件。Performance
Monitor节点的折线图将允许选择一个特定时间点，来查看性能计数器的值。
1.6 本章要点
定义一个部署过程。运行setup.exe或使用各种映像过程，可以部署Windows Server 2016。通常，应该尽可能
地自动化部署过程，但需要定义一个用于组织的一致的部署过程。定义良好的部署过程有助于确保服务器配置的一
致性，从而更容易地排除故障。
问题 组织已经完全虚拟化了部署服务器的基础架构。为创建新的服务器，团队通过Sysprep准备好的操
作系统复制虚拟硬盘驱动器。如何改进这个过程?
答案 如果组织的规模大到足以证明成本合理，应该实现管理虚拟机部署的软件。可将VMM用于Hyper-V
主机，或将vCenter用于VMware主机。使用更高级的部署软件，可以更好地实现流程自动化。
选择Windows Server 2016的一个版本。可购买Windows Server 2016的标准版或数据中心版。这两个版本的
基本功能是相同的，但一些高级功能仅在数据中心版中可用。如果需要这些高级特性，比如Storage Replica或屏蔽
的虚拟机，那么应该购买数据中心版。
问题 规划用于部署Windows Server 2016的标准化映像。对于以前的Windows Server版本，总是使用每
个服务器上的图形界面。在高度虚拟化的环境中引入Server Core的好处是什么?
答案 Server Core的基本好处是减少了攻击面和对更新的需求。在高度虚拟化的环境中，服务器的密度也
会增加。Server Core使用更少的磁盘空间和更少的内存，这允许在每个虚拟化主机上运行更多虚拟机。
选择一个激活方法。当使用批量许可时，Windows Server 2016可使用MAK密钥、KMS或Active Directory Based
Activation来激活。每个服务器上都输入一个MAK密钥。KMS密钥输入KMS主机或Active Directory中。
问题 过去，组织已经为服务器使用了OEM许可。为迁移到Windows Server 2016，购买了批量许可，以
便在主机之间更灵活地移动虚拟服务器。最初的部署规模很小，第一年只有两到三个服务器。首选的激活
方式是什么？
答案 在这个场景中，不能使用KMS主机，因为这个部署在一年内都不能达到最小激活阈值。作为最佳
实践，不应该要求服务器访问Internet以进行激活。这使基于Active Directory的激活成为最佳解决方案。
监控Windows Server 2016。Windows Server 2016包含了许多用于监控和故障排除的工具。Task Manager和
Resource Monitor是快速了解当前系统性能的好工具。Resource Monitor可提供关于当前系统性能或日志性能的详细
信息，以供以后分析。事件查看器允许检查日志，以查找与性能问题相关的错误。
问题 假定为一个拥有几百台服务器的大型组织工作。服务器的监控是被动的，而不是主动的。在用户开
始调用帮助台之前，我们不知道存在性能问题。如何更好地管理监控？
答案 在大型组织中，手工扫描事件日志和性能统计数据是不可能的。相反，需要诸如 System Center
Operations Manager的集中监控软件。实现Operations Manager时，随着时间的推移，将不断收集性能信息，
并监视事件日志以检查错误。当出现问题时，可通过电子邮件通知管理团队。