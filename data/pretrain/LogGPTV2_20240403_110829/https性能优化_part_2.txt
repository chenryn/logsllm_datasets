 åŸºäºŽå†…å­˜ â‘¢ é‡å¯ â‘¢ é‡å¯
â‘  â‘¡ ticket â‘£no ticket â‘  â‘¡ ticket â‘£ticket
Nginx Nginx Nginx Nginx Nginx Nginx
KEY1 KEY1
ç®—æ³•åˆ†ç¦»
 RSAï¼ŒECDHE_RSAï¼Œ
DHE_RSA
å¼‚æ­¥
å®Œå…¨æ¡æ‰‹æ€§èƒ½ä¼˜åŒ–
ä»£ç†è®¡ç®— ä»£ç† æ‰§è¡Œ
---RSAå¼‚æ­¥ä»£ç†è®¡ç®—  ç¡¬ä»¶åŠ é€Ÿå¡ï¼ŒGPUï¼Œç©ºé—²CPU è®¡ç®—
å¼‚æ­¥æ‰§è¡Œ ç®—æ³•
 OpensslçŠ¶æ€æœº åˆ†ç¦»
RSAå¼‚æ­¥ä»£ç†è®¡ç®—---ç®—æ³•åˆ†ç¦»
å¯†é’¥äº¤æ¢ç®—æ³•
câ‰¡ð‘šð‘’mod(n
RSA ECDHE_RSA DHE_RSA
ç§é’¥è§£å¯† ECCå…¬é’¥ç”Ÿæˆ DHå…¬é’¥ç”Ÿæˆ mâ‰¡ð‘ð‘‘ð‘šð‘œð‘‘(ð‘›
RSAç­¾å RSAç­¾å
SHA1
ç§é’¥åŠ å¯†
å®¢æˆ·ç«¯ æœåŠ¡ç«¯
ClientHello
ServerHello
SeC re vrt eif ric Ka ete yExchange REC SACå‚ ç­¾æ•° å
ç®—æ³•åˆ†ç¦»---ECDHE_RSA ClienC tKe ert yi Efi xc ca hte ange C Se er rt vif eic rHat ee lR loe Dq ou ne est
ChC ae nrt gi efi Cca ipt he eV re Sr pif ey c Gen_master_secret SHA256è¿ç®—
Finished
ChangeCipherSpec
Finished
åº”ç”¨å±‚æ•°æ® åº”ç”¨å±‚æ•°æ®
å®¢æˆ·ç«¯ æœåŠ¡ç«¯
ClientHello
ServerHello
Certificate
CertificateRequest
ServerHelloDone
Certificate Decrypt_premaster
ç®—æ³•åˆ†ç¦»---RSA Clie Cn et rK tie fiy cE ax tc eh Va en rg ife y _secret rsaè§£å¯†
ChangeCi p Fh ine isrS hp ee dc Gen_master_secret SHA256è¿ç®—
ChangeCipherSpec
Finished
åº”ç”¨å±‚æ•°æ® åº”ç”¨å±‚æ•°æ®
ç”¨æˆ· ç”¨æˆ·
â‘  HTTPS
â‘  HTTPS
NGINX + openssl
â‘¡ æœ¬åœ°RSAåŒæ­¥è®¡ç®— NGINX + openssl â‘¡ RSAå¼‚æ­¥ä»£ç†è®¡ç®—
å¼‚æ­¥ä»£ç†è®¡ç®—---æž¶æž„ CPU
â‘¢ HTTP
â‘¢ HTTP
æœ¬åœ°CPUåŒæ­¥è®¡ç®—æ¨¡åž‹ ç¡¬ä»¶åŠ é€Ÿå¡å¼‚æ­¥ä»£ç†è®¡ç®—æ¨¡åž‹
Nginx
 Event/ngx_event_openssl_engine.c
 æ¨¡å—æ— æ³•å®žçŽ°
å¼‚æ­¥ä»£ç†è®¡ç®—---å·¥ç¨‹å®žçŽ° Openssl
 Ssl/s3_srvr.c
 1.1.0æ”¯æŒå¼‚æ­¥
æ€§èƒ½65000 cpsï¼Œæå‡äº†3.5å€
 ecdhe_rsa
 Openssl1.1.0b
ç®—æ³•å OP/s OP
ecdh(nistp192)0.0003s 3805.3
ä¼˜å…ˆä½¿ç”¨NIST p256 ecdh(nistp224)0.0004s 2808.8
 P224ä»¥ä¸Šå®‰å…¨ ecdh(nistp256)0.0001s 10271.9
ECCæ¤­åœ†æ›²çº¿ä¼˜åŒ– ecdh(nistp384)0.0009s 1176.0
Opensslç‰ˆæœ¬  Openssl1.0.1e
 1.0.1l ç®—æ³•å OP/s OP
ecdh 0.0004s 2548.8
(nistp256)
ecdh 0.0008s 1192.8
(nistp384)
å—å¼å¯¹ç§°åŠ å¯†ç®—æ³•çš„ä¼˜åŒ–
AES-GCM AES-NIæ€§èƒ½å¯¹æ¯”
 æ€§èƒ½æœ€é«˜ 1200000
AES-NI 1000000
 æ€§èƒ½æå‡5å€å·¦å³ 800000
 EVP_EncryptInit_exvs AES_encrypt 600000
 OPENSSL_ia32cap="~0x200000200000000" 400000
opensslspeed-elapsed-evpaes-128-gcm 200000
é«˜æ€§èƒ½CPU 0 16bytes 64bytes 256bytes 1024bytes
 TCO AES-NI AES-NI OFF
æµå¼å¯¹ç§°åŠ å¯†ç®—æ³•çš„ä¼˜åŒ–
 Chacha20-Poly1305 RC4
 3å€æ€§èƒ½æå‡  SSLv3ï¼Œå®‰å…¨æ€§å¼ºäºŽAES-CBC
HTTPSæ€§èƒ½ä¼˜åŒ–ï¼ç½—æˆ
å¤§  è®¡ç®—æ€§èƒ½åˆ†æžä¸Žä¼˜åŒ–
 æ— ç§˜é’¥åŠ è½½
çº²
 è¯ä¹¦ä¼˜åŒ–
Keylessæ— ç§˜é’¥åŠ è½½---åŒæœºéƒ¨ç½²çš„é£Žé™©
ç§é’¥æ˜¯å®‰å…¨çš„æ ¹æœ¬
åŒæœºéƒ¨ç½²
 æŽ¥å…¥æœåŠ¡å™¨
æ³„éœ²é£Žé™©å¤§
 CDN
 é‡‘èžå®¢æˆ·
â‘  HTTPS â‘  HTTPS
STGW â‘¡ å¼‚æ­¥è¯·æ±‚ Keyless
æ— ç§˜é’¥åŠ è½½---æµç¨‹ STGW Server
ç§é’¥ â‘£ å“åº” â‘¢ç§é’¥è®¡ç®—
ç§é’¥
â‘¡ HTTP â‘¤ HTTP
ä¸šåŠ¡RS ä¸šåŠ¡RS ä¸šåŠ¡RS ä¸šåŠ¡RS ä¸šåŠ¡RS ä¸šåŠ¡RS ä¸šåŠ¡RS ä¸šåŠ¡RS
HTTPSæ€§èƒ½ä¼˜åŒ–ï¼ç½—æˆ
å¤§  è®¡ç®—æ€§èƒ½åˆ†æžä¸Žä¼˜åŒ–
 æ— ç§˜é’¥åŠ è½½
çº²
 è¯ä¹¦ä¼˜åŒ–
ä¸ªäººç”¨æˆ·çš„é€‰æ‹©---Letâ€™s Encrypt
ä¼˜ç‚¹
 å…è´¹ï¼Œå¼€æº
 è‡ªåŠ¨éƒ¨ç½²
ç¼ºç‚¹
 DV
 é£Žé™©é«˜
 å…¼å®¹æ€§ä½Ž
å»ºè®®
 æŽ¨èä¸ªäººç”¨æˆ·
EV && OV
 DVä¸å®‰å…¨
äº‘
ä¼ä¸šç”¨æˆ·çš„è¯ä¹¦é€‰æ‹©  è…¾è®¯äº‘ã€é˜¿é‡Œäº‘ã€AWSç­‰
ä¼˜åŠ¿
 ç”³è¯·ç®€å•ã€æˆæœ¬ä½Ž
 è‡ªä¸»è¯ä¹¦å“ç‰Œ
æµè§ˆå™¨ æœ€ä½Žç‰ˆæœ¬
RSA Apple Safari (On ECC Com4 patible OS)
  å…¼ æœåŠ¡å®¹ ç«¯æ€§ æ€§å¥½ èƒ½å·® Google Chrome (On ECC Co1 m. p0 atible OS)
ECDSA Microsoft Internet Explorer (On ECC Com7 patible OS)
è¯ä¹¦ç­¾åçš„é€‰æ‹©--  å…¼å®¹æ€§å·® Mozilla Firefox* 2.0
XPä¸æ”¯æŒ
-RSA or ECDSA? æ”¯æŒECDHEï¼Œä½†ç³»ç»Ÿç¼ºå°‘root ca
 æœåŠ¡ç«¯æ€§èƒ½å¥½ï¼Œå®¢æˆ·ç«¯æ€§èƒ½å·® æ“ä½œç³»ç»Ÿ æœ€ä½Žç‰ˆæœ¬
åŒæ—¶æ”¯æŒ Apple OS X OS X 10.6
 æˆæœ¬å¢žåŠ  Google Android 4.0
Microsoft Windows Windows Vista
Red Hat Enterprise Linux 6.5
å®¢æˆ·ç«¯1 å®¢æˆ·ç«¯2
 SHA1 or SHA256
 SHA1ä¸å®‰å…¨ a. nq oq S.c No Im a.q Sq N.c Iom
 SHA2å…¼å®¹æ€§å·®
è¯ä¹¦çš„é—®é¢˜
---å…¼å®¹SHA1ã€SHA256  ä¸æ”¯æŒSNI = ä¸æ”¯æŒSHA2ï¼Ÿ
è¯ä¹¦ä¸€
 Nginxé…ç½® a.q Sq H. Aco 1m
 è¯ä¹¦ä¸€server_nameç©º è¯ä¹¦äºŒ
a.qq.com
SHA2
æ›´å¹¿ æ›´å¿«
 http2ä¸»æµå®žçŽ°å¼ºåˆ¶ä½¿ç”¨https  Tls1.3
 ATS å¼ºåˆ¶ä½¿ç”¨HTTPS  QUIC
HTTPSçš„å‘å±•è¶‹åŠ¿  Chrome mark http unsecure
æ›´å¼º æ›´å¼€æ”¾
 RSA 2048 -> 4096  Letâ€™s encrypt
 RSA -> ECC
|---|---------------|--|--|--|
| 0 | HTTPSæ€§èƒ½ä¼˜åŒ– |  |  |  |