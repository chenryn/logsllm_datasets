## 一、前言

该漏洞报告针对的是TikTok的招聘网站（careers.tiktok.com），于2020年10月17日通过HackerOne平台提交给TikTok。此网站支持使用Facebook和LinkedIn账户进行单点登录。由于存在跨站请求伪造（CSRF）漏洞及开放重定向漏洞，恶意攻击者有可能接管用户账户。需注意的是，这一漏洞仅限于TikTok的招聘网站，并不会波及其他TikTok网站或移动应用。

## 二、CSRF漏洞详解

为了实现账户接管，受害者首先需要在careers.tiktok.com上用其Facebook账号完成身份验证，并同意与TikTok共享个人信息；同时，受害者还需保持在Facebook上的活跃会话状态。然而，TikTok并未对登录环节中可能出现的CSRF问题采取有效防护措施，使得攻击者可以通过简单的CSRF手段来控制受害者的账户。

## 三、认证过程中的安全隐患

如果在相关请求中包含Referer头部信息，则可能导致高度敏感的身份验证令牌泄露至潜在攻击者所控制的站点。利用这些令牌，攻击者能够冒充受害者进行身份验证操作，而TikTok方面则无法区分发起请求的实际来源是攻击者还是合法用户。

## 四、漏洞利用步骤

参照Barth等人于2008年提出的Web攻击模型，我们设法诱导受害者访问由攻击者操控的网页，并要求他们将个人Facebook账号与TikTok职业门户关联起来。
1. 首先保存好构造好的CSRF PoC代码，并启动一个简易Web服务器：
   ```bash
   $ python -m http.server 1234
   ```
2. 使用ngrok工具为本地服务创建一个带有有效SSL证书的公共子域名：
   ```bash
   $ ngrok http 1234
   ```
3. 让受害者浏览上述已设置好的PoC页面并手动触发攻击行为（也可借助JavaScript脚本来隐蔽执行）。
4. 此时，在没有更多用户交互的情况下，系统自动向careers.tiktok.com发出登录请求，其中关键在于Referer字段值。
5. 受害者随后被重定向至Facebook以完成OAuth流程。
6. 假设用户已在Facebook上登录且其账号已绑定至目标网站，则无需额外输入即可继续跳转回原定回调地址。
7. 攻击者由此获得了含有受害者身份标识符的响应数据。
8. 最后，攻击者可利用获取到的信息模拟合法用户的登录动作，从而完全掌控对方账号。

## 五、影响范围

通过实施此类跨站请求伪造攻击，不法分子能够轻易夺取他人在careers.tiktok.com上的账户权限。

## 六、缓解建议

- 在涉及敏感操作如身份验证的关键接口处加强CSRF防御机制；
- 杜绝向外界暴露任何可能泄露用户隐私安全的参数，尤其是各类认证令牌；
- 若确实需要依赖HTTP Referer头来进行某些逻辑判断，请务必对其内容做严格校验，确保只接受来自预定义白名单内地址的数据。

## 七、负责任披露记录

- **2020年10月17日**：首次向HackerOne提交漏洞详情；
- **次日（10月18日）**：TikTok团队确认收到反馈，并给予高危等级评定（CVSS评分为7.5）；
- **10月28日**：官方开始处理该问题；
- **10月29日**：修复工作顺利完成并通过了二次测试验证；
- 整个事件处理过程充分体现了TikTok对于信息安全工作的重视程度及其专业素养。