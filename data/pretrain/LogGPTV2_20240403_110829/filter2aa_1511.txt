This document and its content is the property of Airbus Defence and Space. 
It shall not be communicated to any third party without the owner’s written consent. All rights reserved. 
Auditing 6LoWPAN networks 
using Standard Penetration Testing Tools 
Adam Reziouk 
Arnaud Lebrun 
Jonathan-Christofer Demay 
2 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
Presentation overview 
• Why this talk ? 
• What we will not talk about ? 
• What we will talk about ? 
3 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
The 6LoWPAN protocol 
• IPv6 over Low power Wireless Personal Area Networks 
• Header compression flags 
• Addresses factoring (IID or predefined) 
• Predefined values (e.g., TTL) 
• Fields omission (when unused) 
• Use of contexts (index-based) 
• UDP header compression (ports and checksum) 
• Packet fragmentation 
• MTU 127 bytes Vs 1500 bytes 
• 80 bytes of effective payload 
4 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
• Already a lot of tools to work with IPv6 
• nmap -6, nc6, ping6, etc. 
• Nothing new here ! 
• Higher-layer protocols are the same 
• TCP, UDP, HTTP, etc. 
• Again, nothing new here ! 
• Why not use a USB adapter ? 
• That works for Wi-Fi 
• They are available 
What’s the big deal ? 
5 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
The IEEE 802.15.4 standard 
• PHY layer and MAC sublayer 
• Multiple possible configurations 
• Network topology: Star Vs Mesh 
• Data transfer model: Direct or Indirect, w/or w/o GTS, w/ or w/o Beacons 
• Multiple security suites 
• Integrity, confidentiality or both 
• Integrity/Authentication code size (32, 64 or 128) 
• Multiple standard revision 
• 2003 
• 2006 and 2011 
6 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
IEEE 802.15.4-2006 security suites 
Security Level b2 b1 b0 
Security suite 
Confidentiality 
Integrity 
‘000’ 
None 
No 
No 
‘001’ 
MIC-32 
No 
Yes (M =4) 
‘010’ 
MIC-64 
No 
Yes (M = 8) 
‘011’ 
MIC-128 
No 
Yes (M = 16) 
‘100’ 
ENC 
Yes 
No 
‘101’ 
ENC-MIC-32 
Yes 
Yes (M =4) 
‘110’ 
ENC-MIC-64 
Yes 
Yes (M = 8) 
‘111’ 
ENC-MIC-128 
Yes 
Yes (M = 16) 
7 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
IEEE 802.15.4-2003 security suites 
Security Identifier 
Security suite 
Confidentiality 
Integrity 
0x00 
None 
No 
No 
0x01 
AES-CTR 
Yes 
No 
0x02 
AES-CCM-128 
Yes 
Yes 
0x03 
AES-CCM-64 
Yes 
Yes 
0x04 
AES-CCM-32 
Yes 
Yes 
0x05 
AES-CBC-MAC-128 
No 
Yes 
0x06 
AES-CBC-MAC-64 
No 
Yes 
0x07 
AES-CBC-MAC-32 
No 
Yes 
8 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
Deviations for the standard 
• One supplier builds the whole infrastructure  
• Suppliers design their own firmware 
• Using SoC solutions 
• Complying with the customer’s specification 
• Deviations can stay unnoticed unless… 
• Availability failures 
• Performance issues 
• Digi XBee S1 
• 2003 header with 2006 encryption suites 
• Available since 2010 and yet no mention of this anywhere 
9 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
The ARSEN project 
• Advanced Routing between 6LoWPAN and Ethernet Networks 
• Detecting the configuration of existing 802.15.4 infrastructures 
• Network topology 
• Data transfer model 
• Security suite 
• Standard revision 
• Standard deviations 
• Handling frame translation between IPv6 and 6LoWPAN 
• Compression/decompression 
• Fragmentation/defragmentation 
• Support all possible IEEE 802.15.4 configurations 
10 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
Based on Scapy-radio 
https://bitbucket.org 
/cybertools/scapy-radio 
11 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
The two main components 
• The IEEE 802.15.4 scanner 
• Build a database of devices and captured frames 
• The devices that are running on a given channel 
• The devices that are communicating with each other 
• The types of frames that are exchanged between devices 
• The parameters that are used to transmit these frames 
• The 6LoWPAN border router 
• TUN interface 
• Ethernet omitted (for now) 
• Scapy automaton 
12 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
New Scapy layers 
• Dot15d4.py 
• Several bug fixes 
• Complete 2003 and 2006 support 
• User-provided keystreams support 
• Sixlowpan.py 
• Uncompressed IPv6 support 
• Complete IP header compression support 
• UDP header compression support 
• Fragmentation and defragmentation support 
13 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
IEEE 802.15.4 known attacks 
• On availability 
• In theory, the only possible attacks 
• Equivalent to PHY-based jamming attacks 
• Deal with this from a safety point of view (i.e., reboot) 
• On confidentiality 
• In practice, simplified key management 
• Consequently, same-nonce attacks 
• On integrity 
• In practice, encryption-only approach and misuse of non-volatile memory 
• Consequently, replay and malleability attacks 
14 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
AES-CTR (2003) or CCM*-ENC (2006) 
15 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
AES-CTR (2003) or CCM*-ENC (2006) 
K = F(Key, Nonce, AES Counter) 
With K the keystream 
16 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
AES-CTR (2003) or CCM*-ENC (2006) 
K = F(Key, Nonce, AES Counter) 
With K the keystream 
Nonce = F(SrcExtID, Frame Counter) 
17 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
AES-CTR (2003) or CCM*-ENC (2006) 
K = F(Key, Nonce, AES Counter) 
With K the keystream 
Nonce = F(SrcExtID, Frame Counter) 
C⊗C’ = (P⊗K)⊗(P’⊗K)= P⊗P’ 
18 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
AES-CTR (2003) or CCM*-ENC (2006) 
K = F(Key, Nonce, AES Counter) 
With K the keystream 
Nonce = F(SrcExtID, Frame Counter) 
C⊗C’ = (P⊗K)⊗(P’⊗K)= P⊗P’ 
• Same-nonce attacks 
• If one captured frame is known or guessable 
• Or statistical analysis on a large number of captured frames 
19 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
AES-CTR (2003) or CCM*-ENC (2006) 
K = F(Key, Nonce, AES Counter) 
With K the keystream 
Nonce = F(SrcExtID, Frame Counter) 
C⊗C’ = (P⊗K)⊗(P’⊗K)= P⊗P’ 
• Replay attacks 
• Frame counters not being checked 
• Frame counters not being stored in non-volatile memory 
20 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
AES-CTR (2003) or CCM*-ENC (2006) 
K = F(Key, Nonce, AES Counter) 
With K the keystream 
Nonce = F(SrcExtID, Frame Counter) 
C⊗C’ = (P⊗K)⊗(P’⊗K)= P⊗P’ 
• Malleability attacks (useful when no physical access) 
• Keystreams provided by same-nonce attacks (with a simple XOR) 
• Frame counters allowed by replay attacks 
21 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
Application on a metering infrastructure 
• Monitoring of a water distribution system 
• Wireless sensor network 
• Focus on two particular reachable sensors 
22 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
Information gathering 
• Using the ARSEN scanner 
• Channel 18 is used for transmission 
• Sensors only communicate with the PAN_Coord 
• PAN_Coord is only transmitting beacon frames 
• Frame version: IEEE 802.15.4-2006 standard 
• Security functions are used: AES-CTR mode 
• Short_Addr are used, we will need Long_Addr 
Transmitter0: 
beacon_enabled=0x1 
pan_coord=0x1 
coord=0x1 
gts=0x0 
panid=0xabba 
short_addr=0xde00 
Transmitter1: 
short_addr=0xde02 
panid=0xabba 
Destination0: 
security_enabled=0x1 
frame_version=0x1L 
short_addr=0xde00 
coord=0x1 
command=0x0 
panid=0xabba 
data=0x5 
pan_coord=0x1 
Transmitter2: 
short_addr=0xde01 
panid=0xabba 
Destination0: 
security_enabled=0x1 
frame_version=0x1L 
short_addr=0xde00 
coord=0x1 
command=0x0 
panid=0xabba 
data=0x4 
pan_coord=0x1 
23 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
Information gathering 
• We need long addresses 
• They are used to compute the nonce 
• They are sent during association 
• How to force re-association 
• Sensors are tracking beacons 
• Use Scapy-radio with the new Dot15d4 layer 
• Flood the channel to disrupt the PAN  
• The sensors cannot track beacon frames 
• The sensors go into synchronization-loss state 
• They then try to re-associate 
Transmitter0 : 
beacon_enabled=0x1 
pan_coord=0x1 
coord=0x1 
long_addr=0x158d000053da9d 
gts=0x0 
panid=0xabba 
short_addr=0xde00 
Destination0: 
frame_version=0x0L 
short_addr=0xde01 
command=0x1 
panid=0xabba 
data=0x0 
long_addr=0x158d00005405a6 
Destination1: 
frame_version=0x0L 
short_addr=0xde02 
command=0x1 
panid=0xabba 
data=0x0 
long_addr=0x158d0000540591 
24 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
The association procedure 
• Analysis of captured association frames 
• No secure function are used during association 
• No higher protocol are used for authentication 
• Channels 11 to 26 are scanned (with beacon requests) 
• Adding a fake sensor to the network 
• No specific actions are required 
• Any long address is accepted by the PAN coordinator 
• No need to spoof an actual sensor (unless we want to replay frames) 
• We will not be able to send encrypted frames 
25 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
Outgoing frame counters 
• Expected behavior: reboot of sensors when loss of 
synchronization lasts for a determined amount of time  
• How to force the reboot of sensors 
• Continuously flood the channel of the PAN coordinator (18) 
• Synchronization is thus lost permanently for sensors 
• Sensors look up for a PAN coordinator on all channels (11 to 26) 
• If beacon requests stop for a moment, then sensors may have rebooted 
• Stop flooding, let re-associations happen and observe the frame counters  
 If they are not stored in non-volatile memory, they will be reset on reboot 
26 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
Incoming frame counters 
• Similar expected behavior for the PAN coordinator 
• How to force the reboot of the PAN coordinator 
• Create a fake PAN coordinator on a channel below 18 
• Force re-association of sensors (to our fake PAN coordinator) 
• If beacons stop for a moment, then the PAN coordinator may have rebooted 
• Wait for beacons to come back (i.e., the PAN coordinator is up gain) 
• Associate a fake sensor and replay previously captured frames 
• If the beacons never stop again, replayed frames have thus been accepted 
 The counters have been reset (i.e., not stored in non-volatile memory) 
27 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
Forging encrypted frames 
• We can reset outgoing frames counters 
 We can thus conduct same-nonce attacks 
• We can reset incoming frames counters 
We can thus conduct replay attacks 
• Therefore, we can conduct malleability attacks 
• Create a set of valid keystreams with their corresponding frame counters 
• Provide this set to the new Dot15d4 Scapy layer 
• Finally, set up the ARSEN border router and start auditing 
higher-layer protocols and their services 
28 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
Demonstration bench 
Node 1 with 
XBee S1 
Node 2 with 
Xbee S1 
USRP B210 used 
by the ARSEN tools 
ARSEN 
SCAPY-Radio 
GnuRadio 
USRP B210 
Node 1 
Node 2 
Tx/Rx 
Tx/Rx 
 6LowPan 
IPv6  
29 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
Demonstration bench 
30 
Adam Reziouk, Arnaud Lebrun 
Jonathan-Christofer Demay 
Auditing 6LoWPAN Networks 
using Standard Penetration Testing Tools 
Thank you for 
your attention 
https://bitbucket.org/cybertools/scapy-radio