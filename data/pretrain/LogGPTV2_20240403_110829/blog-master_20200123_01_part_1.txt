## 阿里云 RDS PostgreSQL 2019 年度回顾报告  
### 作者                                                                    
digoal                                                                                                             
### 日期                                                                                                             
2020-01-22                                                                                                         
### 标签                                                                                                             
PostgreSQL , rds , 2019 , 阿里云    
----                                                                                                             
## 背景     
做全球最有价值云PG，2019阿里云RDS PG产品主要新功能包括:   
- 支持了PG社区最新版本 11，12，  
- 支持32TB的大容量实例，选择essd pl3存储最高可达100万iops，4GB/s带宽。   
- 可靠性增强  
    - 支持HA主从复制的3种保护级别（最大保护，最高可用，最高性能），提升了数据可靠性，2节点也能做到100%不丢失客户端已收到结束状态的事务  
- 安全特性增强。  
    - 支持ssl加密链路，  
    - 云盘加密，  
    - SGX全安全数据库，等  
- 生态方面，  
    - dts支持了从9.4开始的所有版本。  
    - 同时cloud dba对PG的支持力度更大(包括性能洞察、实时性能、性能诊断等功能)。  
- 在插件方面，RDS PG增加了  
    - 应用于实时精准营销（人群圈选）的roaringbitmap插件，  
    - 应用于图像识别、相似搜索的高维向量插件pase，  
    - 应用于化学分析的rdkit插件。  
    - 应用于数据库定时任务的pg_cron插件。  
    - 发布log_fdw插件，支持查询数据库实时日志  
    - 发布 plv8 2.3.13 版本  
    - 支持读写MySQL 外部表  
    - 支持读写PG 外部表  
- 内核方面  
    - wal2json test_decoding增强，支持unchanged toast解析  
    - 支持为 rds_suerpser 角色预留连接  
- 管控能力增强  
    - 本地盘实例、只读实例支持随意选择存储空间  
    - 开放更多参数修改  
    - 秒级监控  
    - 支持更丰富的引擎监控、云告警指标  
    - 云盘版支持数据库日志保留策略  
    - 本地盘版SQL审计日志支持sls订阅  
    - 云盘高可用版，支持临时关闭主从切换功能  
    - 支持服务账号授权管理功能  
    - 云盘版支持切换交换机功能  
    - 云盘版支持手动小版本升级功能  
[RDS PG的整体 DBaaS 能力在2019年取得了较大的进展。](https://www.aliyun.com/product/new?spm=5176.7920951.1274742.211view.249d4ce1OJlbtQ&category=6&product=136&aly_as=JHfk0T7T)    
[2019.9月份，PG 云盘高可用版、基础版调价，覆盖全球地域。平均降幅40%,最大降幅67%。](https://help.aliyun.com/document_detail/45020.html)  
## 功能价值解说  
### 1 大版本  
功能 | 说明 | 价值   
---|---|---  
发布PG 11,12 | PG V 11，12在并行计算覆盖更多的场景，性能提升更多，可应用于HTAP在线+实时分析混合业务。分区表的性能提升数百倍。支持sql json path语法。等众多新能力。 | HTAP在线+实时分析混合业务  
### 2 云盘版  
功能 | 说明 | 价值   
---|---|---  
ESSD 分级存储(pl1, pl2, pl3) | 32TB大容量100万IOPS4GB/s读写带宽云盘加密快照备份快照克隆基础版具备更好的可靠性（3副本）| 支撑大型企业数据库  
### 3 可靠性增强  
功能 | 说明 | 价值   
---|---|---  
3种保护级别 | 支持HA主从复制的3种保护级别（最大保护，最高可用，最高性能）。最高可用为半同步模式，支持配置降级超时时间，同步后自动恢复为全同步模式。 | 提升了数据可靠性，2节点也能做到100%不丢失客户端已收到结束状态的事务  
### 4 安全增强  
功能 | 说明 | 价值   
---|---|---  
支持ssl加密链路 | 客户端与数据库使用ssl链接时，传输的是加密数据，通过pg_stat_ssl视图查询链路状态，ssl协议版本。 | 提高传输安全性，特别是不可信网络环境。满足安全合规需求。  
支持云盘加密 | 数据盘对应的快设备加密功能，抵御存储泄露数据。 | 提升存储安全性，满足安全合规需求。  
支持SGX全安全数据库（云栖大会发布功能） | 全球最高安全级别数据库特性，可防止各种攻击下的数据泄露风险：网络攻击数据库攻击操作系统攻击存储攻击机房攻击DBA窃取数据云平台泄露数据云平台管理员窃取数据 | 提升数据库整体安全性，满足安全合规需求。  
### 5 生态  
功能 | 说明 | 价值   
---|---|---  
dts 支持所有PG版本，支持9.4以上版本增量迁移 | 使用dts可以迁移mysql, oracle, pg等数据库到pg，支持PG增量迁移到PG | 降低迁移数据库门槛  
cloud dba对PG的支持增强 | (包括性能洞察、实时性能、性能诊断等功能)。 | 没有专业dba的企业，降低用户的数据库管理、优化、诊断门槛  
### 6 插件、应用增强  
功能 | 说明 | 价值   
---|---|---  
roaringbitmap插件 | 应用于实时精准营销（人群圈选） | 应用功能增强-实时精准营销（标签人群圈选）  
pase插件 | 应用于图像识别、相似搜索的高维向量插件pase，| 人脸识别、图像识别、精准营销（相似人群圈选）  
rdkit插件 | 应用于化学分析的rdkit插件。 | 化学分析  
pg_cron插件 | 应用于数据库定时任务的pg_cron插件。| 定时任务例如定时回收垃圾、创建分区表、定时增量统计任务等  
log_fdw插件 | 发布log_fdw插件，支持查询数据库实时日志 | 实时通过sql查询数据库日志  
plv8插件 | 发布 plv8 2.3.13 版本 | plv8开发存储过程语言  
mysql_fdw插件 | 支持读写MySQL 外部表 | mysql+PG 混合使用场景，两种数据库实例的数据实时交互  
postgres_fdw插件 | 支持读写PG 外部表 | pg多个实例之间的数据相互交互  
### 7 内核  
功能 | 说明 | 价值   
---|---|---  
wal2json test_decoding增强 | 支持unchanged toast解析 | 解决变长字段的逻辑订阅问题  
支持为 rds_suerpser 角色预留连接 | 为用户数据库管理员预留连接 | 确保用户的应用把数据库连接打爆后，确保用户dba可以连上数据库进行维护  
### 8 管控能力增强  
功能 | 说明 | 价值   
---|---|---  
提升本地盘存储选择便捷性 | 本地盘实例、只读实例支持随意选择存储空间 | 提升计算型、存储型业务的性价比，例如可以购买2核6T空间，或者32核20G空间。此前计算和存储空间有较大绑定限制。  
参数更开放 | 开放更多参数修改 | 用户针对业务场景更好的控制参数  
监控增强 | 秒级监控 | 提升监控细粒度（云盘高可用版）  
监控、告警增强 | 支持更丰富的引擎监控、云告警指标 | 可以从更多的指标观测数据库的运行状态，瓶颈。用户可以从更多的指标进行告警。  
提升日志使用便捷性 | 云盘版支持数据库日志保留策略 | 结合log_fdw功能，用户可以自定义保留csvlog的个数，在数据库中通过sql查询保留的csvlog，进行分析统计  
提升日志使用便捷性 | 本地盘版SQL审计日志支持sls订阅 | 通过sls可以订阅rds pg的日志，在sls系统中进行分析  
开放HA模块开关 | 云盘高可用版，支持临时关闭主从切换功能 | 用户可以自行开启关闭ha模块，关闭ha模块时，主节点发生异常不会切换到从节点。例如用户在可预知的高压力下，关闭ha模块防止误切换。在开启逻辑订阅功能下，防止主备切换导致slot丢失。  
开放售后授权功能 | 支持服务账号授权管理功能 | 用户可以通过控制台创建授权账号，售后通过授权可以连接数据库进行更深入的问题排查  
开放网络切换功能 | 云盘版支持切换交换机功能 | 用户在应用网络迁移后，可以通过切换数据库的交换机，避免迁移数据库。  
开放版本控制功能 | 云盘版支持手动小版本升级功能 | 当发布pg新版本后，fix数据库bug或增加新的功能。用户可以自主升级小版本。  
## RDS PG 相比自建的价值  
### 1 管理优势  
- 开箱即用  
    - 多可用区HA、监控、  
    - 备份、克隆、性能洞察  
- 7*24 专家值班  
- 多重HA保护模式可选  
    - 最大保护(强同步)、  
    - 最高可用(半同步)、  
    - 最高性能(异步)  
- 多重形态可选  
    - 基础版、  
    - 高可用版、  
    - 只读实例  
### 2 安全优势  
- SSL、  
- 云盘加密、  
- SGX全加密数据库规格、  
- 安全组  
### 3 研发优势  
- 持续fix bug    