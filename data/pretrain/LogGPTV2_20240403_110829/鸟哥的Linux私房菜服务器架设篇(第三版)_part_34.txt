 第 6 行以后则开始进入数据传输的步骤。
从第 3-5 行的流程来看，熟不熟悉啊？没错！那就是三向交握的基础流程啦！够
有趣吧！ 不过 tcpdump 之所以被称为黑客软件之一可不止上头介绍的功能呐！ 上面
介绍的功能可以用来作为我们主机的封包联机与传输的流程分析， 这将有助于我们了
解到封包的运作，同时了解到主机的防火墙设定规则是否有需要修订的地方。
更神奇的使用要来啦！如果我们使用 tcpdump 在 router 上面监听‘明码’的传
输数据时， 例如 FTP 传输协议，你觉得会发生什么问题呢？ 我们先在主机端下达
‘ tcpdump -i lo port 21 -nn -X ’然后再以 ftp 登入本机，并输入账号与密码， 结
果你就可以发现如下的状况：
[root@www ~]# tcpdump -i lo -nn -X 'port 21'
0x0000: 4500 0048 2a28 4000 4006 1286 7f00 0001 E..H*(@.@.......
0x0010: 7f00 0001 0015 80ab 8355 2149 835c d825 .........U!I.\.%
0x0020: 8018 2000 fe3c 0000 0101 080a 0e2e 0b67 .............2'
0x0030: 0e2e 1b38 5041 5353 206d 7970 6173 7377 ...8PASS.mypassw
0x0040: 6f72 6469 7379 6f75 0d0a ordisyou..
上面的输出结果已经被简化过了，你必须要自行在你的输出结果当中搜寻相关的字符串
才行。 从上面输出结果的特殊字体中，我们可以发现‘该 FTP 软件使用的是 vsftpd ，
并且使用者输入 dmtsai 这个账号名称，且密码是 mypasswordisyou’ 嘿嘿！你说可
不可怕啊！如果使用的是明码的方式来传输你的网络数据？ 所以我们才常常在讲啊，
网络是很不安全滴！
另外你得了解，为了让网络接口可以让 tcpdump 监听，所以执行 tcpdump 时网络
接口会启动在 ‘错乱模式 (promiscuous)’，所以你会在 /var/log/messages 里面看
到很多的警告讯息， 通知你说你的网络卡被设定成为错乱模式！别担心，那是正常的。
至于更多的应用，请参考 man tcpdump 啰！
例题：
如何使用 tcpdump 监听 (1)来自 eth0 适配卡且 (2)通讯协议为 port
22 ，(3)封包来源为 192.168.1.101 的封包资料？
答：
tcpdump -i eth0 -nn 'port 22 and src host 192.168.1.101'
5.5.2 图形接口封包撷取器： wireshark
tcpdump 是文字接口的封包撷取器，那么有没有图形接口的？有啊！那就是
wireshark (注1) 这套软件。这套软件早期称为 ethereal ，目前同时提供文字接口
的 tethereal 以及图形接口的 wireshark 两个咚咚。由于我们当初安装时预设并没有
装这套，因此你必须要先使用 yum 去网络安装喔！也可以拿出光盘来安装啦！有两套
需要安装，分别是文字接口的 wireshark 以及图形接口的 wireshark-gnome 软件。安
装方式如下：
[root@www ~]# yum install wireshark wireshark-gnome
启动这套软件的方法很简单，你必须要在 X Window 底下，透过‘应用程序’-->‘因
特网’-->‘wireshark network analyzer’就可以启动啦！启动的画面如下所示：
PI:EMAIL
图 5.5-1、wireshark 的使用示意图
其实这一套软件功能非常强大！鸟哥这里仅讲简单的用法，若有特殊需求，就得要
自己找找数据啰。 想要开始撷取封包前，得要设定一下监听的接口之类的，因此点选
图 5.5-1 画面中的网络卡小图标吧！ 就会出现如下的画面给你选择了。
PI:EMAIL
图 5.5-2、wireshark 的使用示意图
在上图中，你得先选择想要监听的接口，鸟哥这里因为担心外部的封包太多导致画
面很乱，因此这里使用内部的 lo 接口来作为范例。你得要注意， lo 平时是很安静的！
所以，鸟哥在点选了‘start’之后，还有打开终端机， 之后使用‘ ssh localhost ’
来尝试登入自己，这样才能够获得封包喔！如下图所示：
PI:EMAIL
图 5.5-3、wireshark 的使用示意图
若没有问题，等到你撷取了足够的封包想要进行分析之后，按下图 5.5-3 画面中
的停止小图示，那么封包撷取的动作就会终止， 接下来，就让我们来开始分析一下封
包吧！
图 5.5-4、wireshark 的使用示意图
整个分析的画面如上所示，画面总共分为三大区块，你可以将鼠标光标移动到每个
区块中间的移动棒， 就可以调整每个区块的范围大小了。第一区块主要显示的是封包
PI:EMAIL
的标头资料，内容就有点类似 tcpdump 的显示结果，第二区块则是详细的表头资料，
包括讯框的内容、通讯协议的内容以及 socket pair 等等信息。 第三区块则是 16 进
位与 ASCII 码的显示结果 (详细的封包内容)。
如果你觉得某个封包有问题，在画面 1 的地方点选该封包 (图例中是第 6 个封
包)，那么画面 2 与 3 就会跟着变动！由于鸟哥测试的封包是加密数据的封包，因此
画面 2 显示出封包表头，但画面 3 的封包内容就是乱码啦！ 透过这个 wireshark 你
就可以一口气得到所需要的所有封包内容啦！而且还是图形接口的，很方便吧！
5.5.3 任意启动 TCP/UDP 封包的埠口联机： nc, netcat
这个 nc 指令可以用来作为某些服务的检测，因为他可以连接到某个 port 来进行
沟通，此外，还可以自行启动一个 port 来倾听其他用户的联机呐！非常的不错用！如
果在编译 nc 软件的时候给予‘GAPING_SECURITY_HOLE’参数的话，嘿嘿！ 这个软件
还可以用来取得客户端的 bash 哩！可怕吧！我们的 CentOS 预设并没有给予上面的参
数， 所以我们不能够用来作为黑客软件～但是 nc 用来取代 telnet 也是个很棒的功
能了！(有的系统将执行文件 nc 改名为 netcat 啦！)
[root@www ~]# nc [-u] [IP|host] [port]
[root@www ~]# nc -l [IP|host] [port]
选项与参数：
-l ：作为监听之用，亦即开启一个 port 来监听用户的联机；
-u ：不使用 TCP 而是使用 UDP 作为联机的封包状态
# 范例一：与 telnet 类似，连接本地端的 port 25 查阅相关讯息
[root@www ~]# yum install nc
[root@www ~]# nc localhost 25
这个最简单的功能与 telnet 几乎一样吧！可以去检查某个服务啦！不过，更神奇的在
后面， 我们可以建立两个联机来传讯喔！举个例子来说，我们先在服务器端启动一个
port 来进行倾听：
# 范例二：激活一个 port 20000 来监听使用者的联机要求
[root@www ~]# nc -l localhost 20000 &
[root@www ~]# netstat -tlunp | grep nc
tcp 0 0 ::1:20000 :::* LISTEN 5433/nc
# 启动一个 port 20000 在本机上！
接下来你再开另外一个终端机来看看，也利用 nc 来联机服务器，并且输入一些指令看
看喔！
PI:EMAIL
[root@www ~]# nc localhost 20000
<==这里可以开始输入字符串了！
此时，在客户端我们可以打入一些字，你会发现在服务器端会同时出现你输入的字眼呐！
如果你同时给予一些额外的参数，例如利用标准输入与输出 (stdout, stdin) 的话，
那么就可以透过这个联机来作很多事情了！ 当然 nc 的功能不只如此，你还可以发现
很多的用途喔！ 请自行到你主机内的 /usr/share/doc/nc-1.84/scripts/ 目录下看看
这些 script ，有帮助的呐！ 不过，如果你需要额外的编译出含有
GAPING_SECURITY_HOLE 功能， 以使两端联机可以进行额外指令的执行时，就得要自行
下载原始码来编译了！
5.6 重点回顾
 修改网络接口的硬件相关参数，可以使用 ifconfig 这个指令，包括 MTU 等
等；
 ifup 与 ifdown 其实只是 script ，在使用时，会主动去
/etc/sysconfig/network-scripts 下找到相对应的装置配置文件，才能够正确
的启动与关闭；
 路由的修改与查阅可以使用 route 来查询，此外， route 亦可进行新增、
删除路由的工作；
 ip 指令可以用来作为整个网络环境的设定，利用 ip link 可以修改‘网络
装置的硬件相关功能’， 包括 MTU 与 MAC 等等，可以使用 ip address 修改
TCP/IP 方面的参数，包括 IP 以及网域参数等等， ip route 则可以修改路由！
 ping 主要是透过 ICMP 封包来进行网络环境的检测工作，并且可以使用
ping 来查询整体网域可接受最大的 MTU 值；
 侦察每个节点的联机状况，可以使用 traceroute 这个指令来追踪！
 netstat 除了可以观察本机的启动接口外，还可以观察 Unix socket 的传
统插槽接口数据；
 host 与 nslookup 预设都是透过 /etc/resolv.conf 内设定的 DNS 主机
来进行主机名与 IP 的查询；
 lftp 可以用来匿名登录远程的 FTP 主机；
 links 主要的功能是‘浏览’，包括本机上 HTML 语法的档案， wget 则主
要在用来下载 WWW 的资料；
 撷取封包以分析封包的流向，可使用 tcpdump ，至于图形接口的 wireshark
则可以进行更为详细的解析。
 透过 tcpdump 分析三向交握，以及分析明码传输的数据，可发现网络加密
的重要性。
 nc 可用来取代 telnet 进行某些服务埠口的检测工作。
PI:EMAIL
5.7 本章习题
 暂时将你的 eth0 这张网络卡的 IP 设定为 192.168.1.100 ，如何进行？
ifconfig eth0 192.168.1.100
 我要增加一个路由规则，以 eth0 连接 192.168.100.100/24 这个网域，应
该如何下达指令？
route add -net 192.l68.100.0 netmask 255.255.255.0 dev eth0
 我的网络停顿的很厉害，尤其是连接到 tw.yahoo.com 的时候，那么我应该
如何检查那个环节出了问题？
traceroute tw.yahoo.com
 我发现我的 Linux 主机上面有个联机很怪异，想要将他断线，应该如何进
行？
以 root 的身份进行‘netstat -anp |more’查出该联机的 PID，然后以
‘ kill -9 PID ’踢掉该联机。
 你如何知道 green.ev.ncku.edu.tw 这部主机的 IP ？
方法很多，可以利用 host green.ev.ncku.edu.tw 或 dig
green.ev.ncku.edu.tw 或 nslookup green.ev.ncku.edu.tw 等方法找出
 请找出你的机器上面最适当的 MTU 应该是多少？
请利用‘ping -c 3 -M do -s MTU yourIP ’找出你的 IP 的 MTU 数值。 事
实上，你还可以先以 ip 设定网络卡较大的 MTU 后，在进行上述的动作，才能
够找出网域内适合的 MTU。
 如何在终端机接口上面进行 WWW 浏览？又该如何下载 WWW 上面提供的档
案？
要浏览可以使用 links 或 lynx ，至于要下载则使用 wget 这个软件。
 在终端机接口中，如何连接 bbs.sayya.org 这个 BBS ？
利用 telnet bbs.sayya.org 即可连接上
 请自行以 tcpdump 观察本机端的 ssh 联机时，三向交握的内容
 请自行回答：为何使用明码传输的网络联机数据较为危险？并自行以软件将
封包取出，并与同学讨论封包的信息
PI:EMAIL
 请自行至 Internet 下载 nc(netcat) 的原始码，并且编译成为具有
GAPING_SECURITY_HOLE 的参数， 然后建立一条联机使用 -e /bin/bash 尝试将
本地端的 bash 丢给目的端执行 (特殊功能，可让 client 取得来自主机的
bash)。