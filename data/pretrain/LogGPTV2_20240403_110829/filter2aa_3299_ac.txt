E. Bouillon
Federation & Empire
Prelude to Federation
Forward the Federation
Federation
Federation and Empire
Federation’s Edge
Federation and (down to) Earth
Sharpen your weapons
Demo: SimpleSAMLPHP open redirect
When an open redirect leads to cookie theft
1 Victim accesses evil
site
2 Contains a crafted
get request to the SP
3 Evil site gets the
cookie back thanks to
the Open Redirection
(Google search
request for
illustration)
E. Bouillon
Federation & Empire
Prelude to Federation
Forward the Federation
Federation
Federation and Empire
Federation’s Edge
Federation and (down to) Earth
Sharpen your weapons
Back to the OASIS standard
Identity Provider Discovery Service Protocol and Proﬁle [29]
E. Bouillon
Federation & Empire
Prelude to Federation
Forward the Federation
Federation
Federation and Empire
Federation’s Edge
Federation and (down to) Earth
Sharpen your weapons
Identity Provider Discovery Service Protocol and Proﬁle
[29]
[sic]
”This protocol has the potential for creating additional
opportunities for phishing...”
Proposed workaround: use of SP metadata
”To mitigate this threat, metadata can be used to limit the
sites authorized to use a discovery service”
”A discovery service SHOULD require that the service
providers making use of it supply metadata”
Developers don’t have to implement it to be compliant [30]
E. Bouillon
Federation & Empire
Prelude to Federation
Forward the Federation
Federation
Federation and Empire
Federation’s Edge
Federation and (down to) Earth
Sharpen your weapons
Identity Provider Discovery Service Protocol and Proﬁle
[29]
[sic]
”This protocol has the potential for creating additional
opportunities for phishing...”
Proposed workaround: use of SP metadata
”To mitigate this threat, metadata can be used to limit the
sites authorized to use a discovery service”
”A discovery service SHOULD require that the service
providers making use of it supply metadata”
Developers don’t have to implement it to be compliant [30]
E. Bouillon
Federation & Empire
Prelude to Federation
Forward the Federation
Federation
Federation and Empire
Federation’s Edge
Federation and (down to) Earth
Design assessment
Outline
1
Prelude to Federation
Introduction
2
Forward the Federation
Where we come from
3
Federation
What you need to know
4
Federation and Empire
Sharpen your weapons
5
Federation’s Edge
Design assessment
6
Federation and (down to) Earth
Conclusion
E. Bouillon
Federation & Empire
Prelude to Federation
Forward the Federation
Federation
Federation and Empire
Federation’s Edge
Federation and (down to) Earth
Design assessment
Deployment and trust topologies
Typical situations
E. Bouillon
Federation & Empire
Prelude to Federation
Forward the Federation
Federation
Federation and Empire
Federation’s Edge
Federation and (down to) Earth
Design assessment
New risks?
Previous boundaries become more and more notional
Network ﬂows
Attack surface
Management interface
Users community
Insider?
Data ﬂows
Cost/Beneﬁt not doing it?
Security policies coherency / comparison / enforcement
E. Bouillon
Federation & Empire
Prelude to Federation
Forward the Federation
Federation
Federation and Empire
Federation’s Edge
Federation and (down to) Earth
Design assessment
Similar ﬂows orchestrated in federated environment
simple federation scenario [6]
E. Bouillon
Federation & Empire
Prelude to Federation
Forward the Federation
Federation
Federation and Empire
Federation’s Edge
Federation and (down to) Earth
Design assessment
Similar ﬂows orchestrated in federated environment
E. Bouillon
Federation & Empire
Prelude to Federation
Forward the Federation
Federation
Federation and Empire
Federation’s Edge
Federation and (down to) Earth
Design assessment
What if OrgC signs a claim for PI:EMAIL?
E. Bouillon
Federation & Empire
Prelude to Federation
Forward the Federation
Federation
Federation and Empire
Federation’s Edge
Federation and (down to) Earth
Design assessment
Considerations on deployment architectures
Trust topology
Previous example follows a direct trust topology [6]
E. Bouillon
Federation & Empire
Prelude to Federation
Forward the Federation
Federation
Federation and Empire
Federation’s Edge
Federation and (down to) Earth
Design assessment
Considerations on deployment architectures
Trust topology
More complex exist including indirect trust topology [6]
E. Bouillon
Federation & Empire
Prelude to Federation
Forward the Federation
Federation
Federation and Empire
Federation’s Edge
Federation and (down to) Earth
Design assessment
Considerations on deployment architectures
Trust topology
More complex exist including indirect trust topology
E. Bouillon
Federation & Empire
Prelude to Federation
Forward the Federation
Federation
Federation and Empire
Federation’s Edge
Federation and (down to) Earth
Design assessment
What if OrgC signs a claim for PI:EMAIL?
SAML claims laundering
E. Bouillon
Federation & Empire
Prelude to Federation
Forward the Federation
Federation
Federation and Empire
Federation’s Edge
Federation and (down to) Earth
Design assessment
SAML claims laundering
If STS D signs the token, STS B has no way to see the trick
OrgB fully relies on OrgD to properly check SAML claims
Policy?
Veriﬁcation?
Is auditing permitted? Regular security checks presented?
How to prove other parties compliance with relevant
requirements?
Questions usually unasked and even less answered:
What about a malicious/compromised IdP in the federation?
Can a malicious IdP impersonate another domain users?
Are there safeguards in place?
Do I own or delegate these safeguards?
What about a malicious/compromised SP in the federation?
E. Bouillon
Federation & Empire
Prelude to Federation
Forward the Federation
Federation
Federation and Empire
Federation’s Edge
Federation and (down to) Earth
Design assessment
SAML claims laundering
If STS D signs the token, STS B has no way to see the trick
OrgB fully relies on OrgD to properly check SAML claims
Policy?
Veriﬁcation?
Is auditing permitted? Regular security checks presented?
How to prove other parties compliance with relevant
requirements?
Questions usually unasked and even less answered:
What about a malicious/compromised IdP in the federation?
Can a malicious IdP impersonate another domain users?
Are there safeguards in place?
Do I own or delegate these safeguards?
What about a malicious/compromised SP in the federation?
E. Bouillon
Federation & Empire
Prelude to Federation
Forward the Federation
Federation
Federation and Empire
Federation’s Edge
Federation and (down to) Earth
Design assessment
SAML claims laundering
WS-Federation [6]
Situation tersely considered in the speciﬁcation
Chapt 16 : Security considerations
Compromised services: ”This is of special concern in
scenarios like the 3rd party brokered trust where a 3rd party
IP/STS is brokering trust between two realms.”
In practice, by default it works
No proposed solution on how to prevent that
In the case of 3rd party brokered trust, how to control the loss
of control
Whose liability
Other parties obligation (accountability)
E. Bouillon
Federation & Empire
Prelude to Federation
Forward the Federation
Federation
Federation and Empire
Federation’s Edge
Federation and (down to) Earth
Design assessment
SAML claims laundering
All relies on checks made at each relay level
This MUST be done since default settings are permissive
Key attributes must be kept or added to avoid turning the
situation into blind trust and single point of security failure
On main federations, this policy is not publicly disclosed, so
how to make an educated choice?
E. Bouillon
Federation & Empire
Prelude to Federation
Forward the Federation
Federation
Federation and Empire
Federation’s Edge
Federation and (down to) Earth
Conclusion
Outline
1
Prelude to Federation
Introduction
2
Forward the Federation
Where we come from
3
Federation
What you need to know
4
Federation and Empire
Sharpen your weapons
5
Federation’s Edge
Design assessment
6
Federation and (down to) Earth
Conclusion
E. Bouillon
Federation & Empire
Prelude to Federation
Forward the Federation
Federation
Federation and Empire
Federation’s Edge
Federation and (down to) Earth
Conclusion
Conclusion
Take-aways
Knowledge and tool to keep on powning SAML protected
Web app
Proven assumption: Standards can be read as an attempt to
circumvent SOP
Process and tools to get there
Important design security considerations
Without taking care, ”Insecurity by design” is more than likely
E.g. Cross domain SSO with AD trust relationships
A compromised domain cannot impersonate other domains
users
With SAML based cross domain SSO, by default, it will
E. Bouillon
Federation & Empire
Prelude to Federation
Forward the Federation
Federation
Federation and Empire
Federation’s Edge
Federation and (down to) Earth
Conclusion
Conclusion
This applies to other forms of federation
Developers, marketers ahead of security guys
Yet default settings are not secure
The ”make it working” approach might lead to insecure
deployment
Need to catch up to avoid big deployment security failure
(with probably thorny legal issues)
Get acquainted with protocols to properly assess designs and
deployments
Adapt our tool set because bad guys will
Better guidance or improved standards?
E. Bouillon
Federation & Empire
Prelude to Federation
Forward the Federation
Federation
Federation and Empire
Federation’s Edge
Federation and (down to) Earth
Conclusion
Thanks for your attention
Acknowledgment
Isaac Asimov
Rui Fiske for his great help and extensive knowledge on SAML
Q & possibly A
Buby modules and sample code at
http://code.google.com/p/buby-saml
PI:EMAIL
E. Bouillon
Federation & Empire
Prelude to Federation
Forward the Federation
Federation
Federation and Empire
Federation’s Edge
Federation and (down to) Earth
Conclusion
References I
[1]
K. Cameron - The Laws of Identity - http:
//www.identityblog.com/stories/2005/05/13/TheLawsOfIdentity.pdf
[2]
Anonymity Support for Kerberos - draft-ietf-krb-wg-anon-04 - Kerberos extension
[3]
B. Hill - Attacking XML Security - Black Hat Brieﬁngs USA 2007 - http://www.
isecpartners.com/files/iSEC_HILL_AttackingXMLSecurity_bh07.pdf
[4]
OASIS - SAML XML.org - http://saml.xml.org/
[5]
D. Hardt - Identity 2.0 - OSCON 2005 Keynote -
http://identity20.com/media/OSCON2005/
[6]
Web Services Federation Language (WS-Federation) Version 1.2 - OASIS -
http://docs.oasis-open.org/wsfed/federation/v1.2/ws-federation.pdf
[7]
T. Groß- IBM Zurich Research Laboratory - Security Analysis of the SAML
Single Sign-on Browser/Artifact Proﬁle
[8]
OASIS - SSTC Response to :Security Analysis of the SAML Single Sign-on
Browser/Artifact Proﬁle - Working Draft 01, 24 January 2005
E. Bouillon
Federation & Empire
Prelude to Federation
Forward the Federation
Federation
Federation and Empire
Federation’s Edge
Federation and (down to) Earth
Conclusion
References II
[9]
OASIS - Security and Privacy Considerations for the OASIS Security Assertion
Markup Language (SAML) V2.0 - OASIS Standard, 15 March 2005
[10] Armando and Al - Breaking the SAML-based Single Sign-On for Google Apps -
http://www.ai-lab.it/armando/GoogleSSOVulnerability.html
[11] Security Assertion Markup Language (SAML) 2.0 Technical Overview (draft 3) -
OASIS - http://www.oasis-open.org/committees/download.php/11511/
sstc-saml-tech-overview-2.0-draft-03.pdf
[12] Security Assertion Markup Language (SAML) 2.0 Technical Overview (draft 10)
- OASIS - http://www.oasis-open.org/committees/download.php/20645/
sstc-saml-tech-overview-2%200-draft-10.pdf
[13] Myth Breaker - The Best Open Source Web Application Vulnerability Scanner -
http://sectooladdict.blogspot.com/2011/01/
myth-breaker-best-open-source-web.html
[14] OSSTMM - Open Source Security Testing Methodology Manual -
http://www.isecom.org/osstmm/
E. Bouillon
Federation & Empire
Prelude to Federation
Forward the Federation
Federation
Federation and Empire
Federation’s Edge
Federation and (down to) Earth
Conclusion
References III
[15] OWASP Testing Project -
https://www.owasp.org/index.php/OWASP_Testing_Project
[16] Web Application Scanner Benchmark (v1.0) http://sectooladdict.blogspot.
com/2010/12/web-application-scanner-benchmark.html
[17] UNINETT releases public beta of SAML tracer -
https://addons.mozilla.org/en-US/firefox/addon/saml-tracer/
[18] Feide RnD SAML 2.0 Debugger -
https://rnd.feide.no/software/saml_2_0_debugger/
[19] Federation Lab beta - https://fed-lab.org/
[20] J. Haddix, J. Parish - Bsides Chicago 2011 - http:
//www.securityaegis.com/wp-content/uploads/2011/04/bsides_final.ppt
[21] Pentest John - http://www.securityaegis.com/pentest-john-memes
[22] J. Haddix, J. Parish - ToorCon 12 -
http://www.securityaegis.com/burp_preso.pdf
E. Bouillon
Federation & Empire
Prelude to Federation
Forward the Federation
Federation
Federation and Empire
Federation’s Edge
Federation and (down to) Earth
Conclusion
References IV
[23] WCF Binary Soap Plug-In for Burp - Gotham Digital Science - http://www.
gdssecurity.com/l/b/2009/11/19/wcf-binary-soap-plug-in-for-burp/
[24] Burp Suite - http://portswigger.net
[25] Buby’s homepage - http://emonti.github.com/buby
[26] Buby tutorial - K. Johnson - http://carnal0wnage.attackresearch.com/
2011/05/buby-script-basics-part-1.html
[27] OWASP Open Redirect - https://www.owasp.org/index.php/Open_redirect
[28] Feide - http://www.feide.no
[29] Identity Provider Discovery Service Protocol and Proﬁle - OASIS - http://docs.
oasis-open.org/security/saml/Post2.0/sstc-saml-idp-discovery.pdf
[30] Support metadata DiscoveryResponse for discovery service - SimpleSAMLphp
issue 363 -
http://code.google.com/p/simplesamlphp/issues/detail?id=363
E. Bouillon
Federation & Empire