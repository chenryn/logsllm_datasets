VBA工程密码](https://www.office26.com/excelhanshu/excel_function_6373.html)。  
关键字符串放入窗体`Userform1`中，使用时通过`Userform1.value.caption`语句提取相应字符：
于临时目录下创建一文档，将`zmivsija`中的字符串写入并保存。复制cscript.exe至`C:\Users\用户名\Contacts\`目录，重命名为`defupdate70.exe`：
通过`cscript.exe`执行命令，指定JScript引擎运行文档中的指令并设置窗口隐藏：
### 复现
将字符串放入窗体中并命名以方便调用：
创建文档，写入调用计算器的Jscript语句。通过`cscript.exe`执行文档中命令：
演示效果如下：
## 0x06 Dreambot某样本分析
基本信息：
> MD5: 912a487711217f214746a3e677e2bf32
文档内容如下：
该样本宏代码中每个模块都加入了大量混淆，其中`gzPB()`、`fvWLdoZ()`、`jqMB()`等函数均用于对传入的参数进行解密：
进入模块依次跟进，最终可以得到一个函数调用链。直至进入`jJPulneBpTF`函数之前，所有函数功能均为调用下一个函数：  
`OWlEmUVvwQl` —> `hMkbDVHtbVDDttEFUWEw` —> `dTkPsYjiXXQJXW` —>
`DqfHVjrOSVaMrAFy` —> `MsgsyIxLElHPXcNOFMo`—> `UoOLrJw` —> `JFJdZo` —>
`VtrbNDgItpnfKpgAqPml` —> `ybCDhfHLopdFPWTjmLZoUbw` —> `FzjyS` —> `RVThCUH` —>
`IFSeOhWOWEpX` —> `azriOHXmFqMfPRlfDlP` —> `LSxrp` —>
`CADXqENsQRQthfrBXvpswgqkC` —> `lDqTvcg` —> `MOvSslUFTPZuhCliOUXc` —>
`oVBCPDmxRv`—> `BnqSmevUUSPyaWQ` —> `jJPulneBpTF`
`jJPulneBpTF`函数主要语句如下：
最终将执行`lpZlNxkkO.Document.Application.ShellExecute powershell.exe -enco
jdzqBQcgjBylOD,C:\Windows\System32, Null, 0 * 1`
## 0x07 未知组织某样本分析
### 分析
基本信息：
> MD5: 0A286239B3FE2E44545470E4117F66EB
文档内容如下：
当文档打开或关闭，传递不同参数给函数`Fa()`，它将调用函数`s1()`。
函数`s1()`主要功能为替换文档中字符串。之后文档更新，更新后文档内容如下图：
随后调用`ProperRender`函数。获取文本内容并解密，将解密后文本写入`%LOCALAPPDATA%\Microsoft\EdgeFss\FileSyncShell64.dll`：
通过COM劫持，修改注册表键值实现持久化。修改后键值如下图所示：
### 复现
用同样方式劫持clsid，此处劫持`{B5F8350B-0548-48B1-A6EE-88BD00B4A5E7}`，即`oleacc.dll`。  
编译一个DLL，其用于弹出CMD窗口，将内容写入WORD文档的文本框中并设置不可见。内容解密后写入`1.dll`：
修改键值，将注册表默认路径修改为`1.dll`文件路径：
打开Internet Explorer，成功弹出CMD窗口：
## 0x08 Donot组织某样本分析
### 分析
基本信息：
> MD5: 9f022772ec69d04e736c3fe33a876d6b
该文件为RTF格式，其中内嵌一带宏代码的Excel及一压缩包，通过rtfobj.py将其提取，并使用oledump获取Excel中的宏代码进行分析。
文档内容如下：
将压缩包中数据写入`C:\Windows\Tasks\file.zip`中，之后创建快捷方式指向两个js文件，其中pvr.js中用以通过`rundll32.exe`执行`commit.dll`：
### 复现
样本中使用了`\objupdate`控件，当RTF文档加载后，该控件会触发嵌入Excel表中的宏代码执行。可采用替换样本中的VBA代码部分——即`\objdata`对象。演示：
自动化脚本如下：
    #coding=utf-8
    import re
    import os
    inputfile=open('1.rtf',"rU")
    i=inputfile.read()
    str=re.findall("objdata([\\s\\S]*?)\\}", i)
    inputfile.close()
    string1=r"""{\rtf1\adeflang1025\ansi\ansicpg1252\uc1\adeff31507\deff0\stshfdbch31506\stshfloch31506\stshfhich31506\stshfbi31507\deflang1033\deflangfe1033\themelang1033\themelangfe0\themelangcs0{\fonttbl{\f0\fbidi \froman\fcharset0\fprq2{\*\panose 02020603050405020304}Times New Roman;}{\f34\fbidi \froman\fcharset1\fprq2{\*\panose 02040503050406030204}Cambria Math;}
    {\f37\fbidi \fswiss\fcharset0\fprq2{\*\panose 020f0502020204030204}Calibri;}{\flomajor\f31500\fbidi \froman\fcharset0\fprq2{\*\panose 02020603050405020304}Times New Roman;}
    {\fdbmajor\f31501\fbidi \froman\fcharset0\fprq2{\*\panose 02020603050405020304}Times New Roman;}{\fhimajor\f31502\fbidi \froman\fcharset0\fprq2{\*\panose 02040503050406030204}Cambria;}
    {\fbimajor\f31503\fbidi \froman\fcharset0\fprq2{\*\panose 02020603050405020304}Times New Roman;}{\flominor\f31504\fbidi \froman\fcharset0\fprq2{\*\panose 02020603050405020304}Times New Roman;}
    {\fdbminor\f31505\fbidi \froman\fcharset0\fprq2{\*\panose 02020603050405020304}Times New Roman;}{\fhiminor\f31506\fbidi \fswiss\fcharset0\fprq2{\*\panose 020f0502020204030204}Calibri;}
    {\fbiminor\f31507\fbidi \froman\fcharset0\fprq2{\*\panose 02020603050405020304}Times New Roman;}{\f39\fbidi \froman\fcharset238\fprq2 Times New Roman CE;}{\f40\fbidi \froman\fcharset204\fprq2 Times New Roman Cyr;}
    {\f42\fbidi \froman\fcharset161\fprq2 Times New Roman Greek;}{\f43\fbidi \froman\fcharset162\fprq2 Times New Roman Tur;}{\f44\fbidi \froman\fcharset177\fprq2 Times New Roman (Hebrew);}{\f45\fbidi \froman\fcharset178\fprq2 Times New Roman (Arabic);}
    {\f46\fbidi \froman\fcharset186\fprq2 Times New Roman Baltic;}{\f47\fbidi \froman\fcharset163\fprq2 Times New Roman (Vietnamese);}{\f409\fbidi \fswiss\fcharset238\fprq2 Calibri CE;}{\f410\fbidi \fswiss\fcharset204\fprq2 Calibri Cyr;}
    {\f412\fbidi \fswiss\fcharset161\fprq2 Calibri Greek;}{\f413\fbidi \fswiss\fcharset162\fprq2 Calibri Tur;}{\f416\fbidi \fswiss\fcharset186\fprq2 Calibri Baltic;}{\f417\fbidi \fswiss\fcharset163\fprq2 Calibri (Vietnamese);}
    {\flomajor\f31508\fbidi \froman\fcharset238\fprq2 Times New Roman CE;}{\flomajor\f31509\fbidi \froman\fcharset204\fprq2 Times New Roman Cyr;}{\flomajor\f31511\fbidi \froman\fcharset161\fprq2 Times New Roman Greek;}
    {\flomajor\f31512\fbidi \froman\fcharset162\fprq2 Times New Roman Tur;}{\flomajor\f31513\fbidi \froman\fcharset177\fprq2 Times New Roman (Hebrew);}{\flomajor\f31514\fbidi \froman\fcharset178\fprq2 Times New Roman (Arabic);}
    {\flomajor\f31515\fbidi \froman\fcharset186\fprq2 Times New Roman Baltic;}{\flomajor\f31516\fbidi \froman\fcharset163\fprq2 Times New Roman (Vietnamese);}{\fdbmajor\f31518\fbidi \froman\fcharset238\fprq2 Times New Roman CE;}