图灵社区的电子书没有采用专有客
户端，您可以在任意设备上，用自
己喜欢的浏览器和PDF阅读器进行
阅读。
但您购买的电子书仅供您个人使用，
未经授权，不得进行传播。
我们愿意相信读者具有这样的良知
和觉悟，与我们共同保护知识产权。
如果购买者有侵权行为，我们可能
对该用户实施包括但不限于关闭该
帐号等维权措施，并可能追究法律
责任。
（2016.1重印）
内 容 提 要
本书由浅入深地介绍了Docker的实践之道，首先讲解Docker的概念、容器和镜像的相关操作、容器
的数据管理等内容，接着通过不同类型的应用说明Docker的实际应用，然后介绍了网络、安全、API、管
理工具Fig、Kubernetes、shipyard以及Docker三件套（Machine+Swarm+Compose）等，最后列举了常见镜像、
Docker API等内容。
本书适合Docker开发人员阅读。
◆ 编 著 曾金龙 肖新华 刘 清
责任编辑 王军花
责任印制 杨林杰
◆ 人民邮电出版社出版发行 北京市丰台区成寿寺路11号
邮编 100061 电子邮件 PI:EMAIL
网址 http://www.ptpress.com.cn
北京 印刷
◆ 开本：800×1000 1/16
印张：18.25
字数：431千字 2015年 7 月第 1 版
印数：4 001 —4 600册 2016年 1 月北京第 2 次印刷
定价：59.00元
读者服务热线：(010)51095186转600 印装质量热线：(010)81055316
反盗版热线：(010)81055315
广告经营许可证：京崇工商广字第 0021 号
前 言 III
1
序 2
3
在互联网这个领域，每年都会涌现出非常多的新技术，其中总有那么一两门是引领潮流的，
例如前些年的Hadoop和如今的Docker。热门的技术之所以能够得到业内的推崇，主要是因为它
4
解决了行业痛点。Hadoop 解决的是分布式计算的问题，它提供了一套分布式存储和计算的解决
方案，而且这个方案很廉价但很高效；Docker解决的是服务器应用快速构建、部署和分享的问题，
它能够把服务器应用像APP一样简单地安装到各种平台环境中，而不用受真实环境的影响。细说
起来，它有3个核心概念：容器、镜像和Docker Hub。容器提供一个隔离的安全运行环境，使得 5
不同应用之间不会相互干扰。和容器经常对比的是传统的虚拟机技术，这二者侧重点不一样，但
在资源节省方面，容器占极大优势。镜像是容器的静态存在形式，就好比程序是进程的静态文件
形式一样。Docker的镜像采用分层机制，每次改变就增加一层，用来记录这些改变，这样在传输 6
的时候只需要传输改变的层即可。Docker Hub是一个公共的镜像平台，为镜像分享提供便利。用
户可以根据自己的需要，在已有的镜像上定制自己的镜像。除了这3大核心组件外，由于越来越
多开发者加入到 Docker 的生态圈中，出现了越来越多的工具，例如 Fig、Kubernetes、shipyard 7
等。这些都是非常优秀的辅助工具，而Fig也被Docker官方收购，成为了官方的Compose服务，
对外提供Machine+Swarm+Compose整套服务。
Docker发展很快，网络上的资料也比较少，有的也只是一些初级操作，此时适时宜的一本好 8
书对一门技术的布道也极为重要。而我看完本书之后，觉得它可以堪此大任。本书把内容分为了三
篇：基础篇、案例篇和高级篇。基础篇向我们介绍了Docker、容器、镜像等核心内容和操作，这
部分的亮点在于体系性，对命令详细的解释以及对命令的体系编排，这是其他书所没有的。案例篇
9
为我们提供了一些综合案例，每一个案例都是精挑细选的，所有的案例都非常具备代表性。在高级
篇，本书的深度就体现出来了，它不是简单地给读者罗列几个概念和工具，而是在介绍完概念后进
行实实在在的操作，这是目前任何关于Docker的书都没有的。所以，Docker的高级使用者应该会
10
对这部分内容非常感兴趣。例如，Docker API编程、Fig、Kubernetes、shipyard等，本书都给出了
很完整的介绍和操作。总的来说，这本书在体系编排、广度和深度上都做得非常好。作者的文笔也
很干练，没有过多的兜兜转转，这也是技术类图书该有的风格。这是一本关于Docker难得的宝典，
无论你是初级用户还是高级用户，本书都能够带你走进Docker的世界，登堂入室。 11
甘南南
迅雷看看副总裁
12
2015年3月
IV 前 言
推 荐 语
好的技术需要一本好书去布道，让更多的开发者从中受益。本书通过基础、案例到高级话题
三篇，带领着读者由浅至深，登堂入室。
——罗笑南，中山大学信息科学与技术学院教授
Docker是当之无愧的Go语言杀手级应用，并且现如今Docker这个词的含义越来越丰富了，
以至于它已经代表了容器技术的生态圈。本书奉行实践出真知，其中的案例都非常棒。更为关键
的是，其中的高级篇对 Docker 生态圈的各个新成员也做了非常详实的介绍和实践，这真的很难
能可贵。
——郝林，Go语言北京用户组发起人，《Go并发编程实战》作者
本人是在互联网行业摸爬滚打了十几年的老兵，我们开发的视频搜索服务，曾经占据了日本
九成以上的市场，并被日本雅虎、乐天等主流公司采用。在此过程中，我接触到了日本大部分
的主流互联网公司，深深地感觉到，应用的灵活部署、方便迁移、灵活扩充等是很大的难题，
这方面的能力也是一个公司的核心竞争力。我们自己以及日本的合作伙伴，都为此做了许多的
探索。
Docker是解决这些问题的很好的方案，是互联网行业的利器，今后必然会得到广泛的应用。
本书既有高屋建瓴的技术理念，也有实际操作的详尽说明，深入浅出了说明了 Docker 的相
关知识，是一本不错的好书，值得每一位对Docker有兴趣的人收藏。
——颜文远，技术大牛
互联网技术每天都在快速更新，而Docker无疑是2014年最热门的互联网技术。这本书是我
见过讲解Docker最为全面而又深入的图书，各个方面都有涉及，而且以实战为主。
——赵伟，北京精益智慧教育科技 CTO
推荐语 V
这是一本关于Docker的好书，值得所有想了解Docker的人放在键盘左边。
1
——李毅秋，人人网技术总监
2
腾讯的互娱的开发节奏，只有 Docker 跟得上！如果你想你的团队加快开发速度，那么我推
荐你使用Docker，而本书从基础、案例到高级话题，都有很全面的覆盖。
——易剑，腾讯互动娱乐事业群高级架构师
3
后台工程师（特别是运维工程师）都应该了解和熟悉 Docker 这一利器，使用它能极大地提
高开发和部署效率。这本书通俗易懂，对于学习Docker的人非常有帮助！ 4
——罗海江，大疆创新科技有限公司高级技术经理
5
云计算的初级是数据的云化，下一步是程序的云化，而 Docker 则是程序云化当前最好的工
具。让你的程序一次配置，全网增量迁移、运行。本书出自一线互联网研发人员之手，它是实战
的结晶，所涉案例都是互联网公司的真实应用，对 Docker 的应用都不是浅尝辄止，而是带你登 6
堂入室。
——潘向荣，迅雷看看高级技术经理
7
8
9
10
11
12
VI 前 言
前 言
Docker从提出到现在已经走过了两年的时间，在这两年里，它一直都是云计算领域的热点。
可以说，它是2014年互联网最热门的技术。Docker得到Google、微软、IBM、Red Hat的声援，
而它也不负众望，在这短短的两年里快速迭代，一步步变得更加完善。在 Docker 之前，开发者
都深陷软件环境的配置之苦，虽然说并不是所有的软件配置都很难，但不同环境下的配置问题却
层出不穷，相信很多读者和我有类似的经历，就是想用一款开源软件，结果配置了许久都跑不起
来，然后不得不放弃用它。而网上总是有很多的答疑，可是跟着照做，发现在自己的机器上就是
跑不起来。环境差异，可能会让原本简单的问题复杂化，迟滞我们的开发进程。拿来主义对于懒
惰的程序员来说是件好事，我们都希望拿来就用，这样就可以专注于我们本该干的活。对于测试
人员和运维人员来说，也是如此，没人喜欢处理这些本不该重点关注、处理不好却会让人寸步难
行的问题。Docker就像一个打包器，可以把你的应用及其环境整体打包，然后很方便地迁移到不
同的平台，到处运行。在用户看来就如同运行在原来的机器上一样。或许该有人说我用虚拟机也
可以实现同样的效果，为什么要选择 Docker。当两样东西都能够做同一件事情时，我们比的是
效率。你可以在一台服务器上部署几个或者十几个虚拟机实例，但我相信没人会在一台服务器上
部署上百个虚拟机实例，这是因为资源的限制。而在一台服务器上部署上百个 Docker 容器却并
不是什么难事。在镜像的传输和共享方面，Docker也做得非常好，它能够只传输那些改变了的数
据，而不用像传输虚拟机镜像那样，动辄至少几百兆。在共享方面，Docker建立了Docker Hub，
你可以根据已有的镜像定制自己的镜像，而无需每次都再造轮子。如此接地气的技术，怪不得业
内都惊呼Docker是下一个Hadoop。
本书的起源
虽然Docker人气旺盛，但关于Docker的书却少之又少，更别说汗牛充栋了，这主要是Docker
出现的时间尚短。对于已有的书，基础内容不够体系，大多只停留寥寥几个基础命令的展示，并
没有很好地归纳整理；而高级篇又只停留于粗浅的概念介绍，毫无实践价值，特别是对 Docker
具有很大作用的管理工具，例如Fig、Kubernetes、shipyard等内容，没有一本书去系统讲解它们。
我们觉得这么好的技术，应该有更为系统的书去让更多的人了解它，理解它，这正是本书存在的
价值。
前 言 VII
如果不是遇到了王军花编辑，或许就没有本书，而正是在她的鼓励下，才让我们有勇气去将
1
一些原本零碎的知识归纳整理为一本完整的书。
本书内容
2
本书主要介绍了Docker的实践之道。我们按照由浅入深的编排将本书分为三篇。在基础篇，
主要是让读者认识Docker的概念和基础操作，对比介绍了Docker和虚拟机等技术，从容器、镜
3
像、数据卷以及容器的连接等方面说明Docker的操作。通过对基础篇的学习，读者不仅对Docker
有了全局的认识，而且能够对Docker的基础操作得心应手。该篇包含第1章至第4章的内容。
 第 1章从概念上介绍了 Docker，让读者对它的概念、背景、组件以及相关技术有了全局
4
的认识。
 第2章和第3章分别介绍了容器和镜像的相关操作，二者是Docker操作的核心对象。
 第4章介绍了容器的网络基础、数据卷的配置以及多个容器之间的互联。
5
第二篇是案例篇。在这一篇中，我们通过不同类型的应用来说明 Docker的实际应用。我们不
做案例的简单堆砌，而是通过不同类型的案例来说明各个知识点的应用，它包含第5章至第11章。
 第5章介绍了如何创建SSH服务镜像，这满足了日常SSH远程登录的需求。 6
 第6章构建了一个采用Apache作为Web服务器、PHP作为Web开发语言、MySQL作为
数据库的Web应用案例。
 第 7章构建了一个采用 Node.js作为开发语言、MongoDB作为数据库的Web案例，该案 7
例着重说明了跨主机的多容器代理互联。
 第 8 章和第 9 章说明了如何在公共云平台——阿里云上部署 Docker 应用，这里以
WordPress为例进行介绍。
8
 第10章介绍了如何使用私有仓库。
 第11章将云计算的两大热点联合，说明了如何通过Docker来构建Hadoop镜像及集群。
第三篇是高级篇。在这一篇中，对 Docker的 API以及管理工具 Fig、Kubernetes、shipyard 9
以及Docker三件套（Machine+Swarm+Compose）都有实践操作，该篇包含第12章至第18章。
 第12章介绍的是容器的高级网络知识。
 第 13章从命名空间、cgroups、Linux能力机制以及服务端防护等方面入手介绍了安全方 10
面的知识。
 第14章则是通过curl工具来学习Docker的API接口，并给出docker-py库的编程实例。
 在第15章至第18章中，我们分别介绍了Fig、Kubernetes、shipyard以及Machine+Swarm+ 11
Compose三件套，这些都是为了更好地管理和使用Docker的工具。
第四篇为附录。在附录 A 中，我们按照系统镜像、数据库镜像、Web 镜像、语言镜像的类
别来编排，列举了常见的镜像，以供读者查阅。附录 B是 Docker API列表的归纳整理，分为容 12
VIII 前 言
器相关和镜像相关，亦是为了方便读者查阅。附录C是我们在写作过程中所用到的资料引用。
阅读须知
阅读本书时，最好能够从前往后依序阅读。特别是基础篇，是理解案例篇和高级篇的基石，
读者最好能够读完基础篇，再阅读案例篇和高级篇。在案例篇和高级篇中，章和章之间的联系并
没有那么紧密，例如第6章的案例和第7章的案例并没有关联，它们属于侧重点不同的案例，所
以无需依序阅读。高级篇的工具也是如此，读者可以根据需求的迫切程度而选择性阅读。
目标读者
一切想了解及深入理解 Docker 技术的人，都是本书的目标读者。对于初级读者，通过本书
的基础篇，你就可以成为一个能够灵活应用Docker的人。当你对Docker有一定了解后，通过学
习案例篇和高级篇，你也就可以登堂入室了。
致谢
本书是很多人共同劳动的成果。三位作者要感谢一些人，感谢他们为本书所作出的巨大贡献
和支持。
感谢在迅雷的同事：特别感谢甘南南和潘向荣两位的工作支持和悉心指导，感谢他们的慷慨
大方，提供给我们充足的时间来写作本书。此外，还需感谢的同事有涂海涛、李明良、吴小强、
易萌萌、何赞裕、吴建国和何锐，感谢他们在成书过程中的宝贵意见。
特别感谢本书的编辑王军花，没有她，本书就只能停留在笔者的脑海里。她不仅仅是一位资
深的计算机类图书编辑，更像一名计算机专家，本书很多内容都是在她的指点下得以完善。
本书还需致谢的人有：盛建强博士、高怀恩博士、广发证券信息部的刘润佳和周英贵、美团
网的蒋朋、百度的徐则水和罗剑波、腾讯的杨晓颖和郑克松、阿里巴巴的田晓娇以及李海龙、邱
俊凌、杨文武、刘汇洋、冯学汉等人。感谢他们让各自公司相关平台成为本书部分案例的尝鲜者，
并提出了诸多宝贵意见。
最后，感谢我们的家人。没有你们的支持，就没有这一切。
目 录 IX
2
目 录
3
4
2.3 容器的导入和导出..................................26 5
第一篇 基础篇：Docker基础
第3章 镜像....................................................28
第1章 Docker简介........................................2 3.1 镜像的概念..............................................28 6
1.1 Docker简介...............................................2 3.1.1 镜像与容器..................................28
1.1.1 Docker的概念................................5 3.1.2 镜像的系统结构...........................29 7
1.1.2 Docker的背景................................5 3.1.3 镜像的写时复制机制...................30
1.1.3 容器与虚拟机.................................7 3.2 本地镜像的管理......................................30 8
1.1.4 Docker与容器................................8 3.2.1 查看..............................................30
1.1.5 Docker的应用场景........................9 3.2.2 下载..............................................31
9
1.2 Docker的组件.........................................10 3.2.3 删除..............................................33
1.3 Docker的相关技术..................................11 3.3 创建本地镜像..........................................33
1.4 Docker的安装.........................................12 3.3.1 使用commit命令创建本地 10
1.4.1 Ubuntu下的安装..........................12 镜像..............................................33
1.4.2 Red Hat下的安装.........................13 3.3.2 使用Dockerfile创建镜像............34 11
1.4.3 OS X下的安装.............................14 3.4 Docker Hub..............................................40
1.4.4 Windows下的安装.......................15 3.4.1 Docker Hub简介..........................41 12
3.4.2 镜像的分发..................................41
第2章 容器....................................................17 3.4.3 自动化构建..................................43
2.1 容器的管理操作......................................17 3.4.4 创建注册服务器...........................47 13
2.1.1 创建容器......................................17
第4章 数据卷及容器连接...........................49
2.1.2 查看容器......................................20 14
2.1.3 启动容器......................................21 4.1 容器网络基础..........................................49
2.1.4 终止容器......................................22 4.1.1 暴露网络端口..............................50
15
2.1.5 删除容器......................................22 4.1.2 查看网络配置..............................53
2.2 容器内信息获取和命令执行...................23 4.2 数据卷.....................................................54
2.2.1 依附容器......................................23 4.2.1 创建数据卷..................................54 16
2.2.2 查看容器日志...............................24 4.2.2 挂载主机目录作为数据卷...........55