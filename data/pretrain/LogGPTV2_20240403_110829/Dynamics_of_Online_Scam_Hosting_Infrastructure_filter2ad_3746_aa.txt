title:Dynamics of Online Scam Hosting Infrastructure
author:Maria Konte and
Nick Feamster and
Jaeyeon Jung
Dynamics of Online Scam Hosting Infrastructure
Maria Konte1, Nick Feamster1, and Jaeyeon Jung2
1 Georgia Institute of Technology
{mkonte,feamster}@cc.gatech.edu, PI:EMAIL
2 Intel Research
Abstract. This paper studies the dynamics of scam hosting infrastructure, with
an emphasis on the role of fast-ﬂux service networks. By monitoring changes in
DNS records of over 350 distinct spam-advertised domains collected from URLs
in 115,000 spam emails received at a large spam sinkhole, we measure the rates
and locations of remapping DNS records, and the rates at which “fresh” IP ad-
dresses are used. We ﬁnd that, unlike the short-lived nature of the scams them-
selves, the infrastructure that hosts these scams has relatively persistent features
that may ultimately assist detection.
1 Introduction
Online scam hosting infrastructure is critical to spam’s proﬁt cycle; victims must con-
tact point-of-sale Web sites, which must be both highly available and dynamic enough
to evade detection and blocking. Until recently, many sites for a scam were hosted by
a single IP address for a considerable amount of time (i.e., up to a week) [2]. How-
ever, simple countermeasures, such as blocking the IP address called for more sophis-
ticated techniques. For example, the past year has seen the rise of “fast-ﬂux service
networks” [5], which allow the sites that host online scams to change rapidly.
This paper studies the dynamics of the Internet infrastructure that hosts point-of-sale
sites for email scam campaigns. We focus on how fast-ﬂux service networks are used to
host these online scams. Beyond offering a better understanding of the characteristics of
the infrastructure, our study discovers invariant features of the infrastructure that may
ultimately help identify scams and the spam messages that advertise them faster than
existing methods.
We study the scam sites that were hosted by 384 domains as part of 21 scam cam-
paigns in over 115,000 emails collected over the course of a month at a large spam
sinkhole. This paper studies two aspects of the dynamics:
– What are the rates and extent of change? We examine the rates at which scam
infrastructures, via the use of fast-ﬂux service networks, redirect clients to different
authoritative name servers (either by changing the authoritative nameserver’s name
or IP address), or to different Web sites entirely. We ﬁnd that, while the scam sites’
DNS TTL values do not differ signiﬁcantly from other sites that perform DNS-
based load balancing, the rates of change (1) differ from legitimate load balancing
activities; and (2) differ across individual scam campaigns.
S.B. Moon et al. (Eds.): PAM 2009, LNCS 5448, pp. 219–228, 2009.
c(cid:2) Springer-Verlag Berlin Heidelberg 2009
220
M. Konte, N. Feamster, and J. Jung
Table 1. DNS lookup results for the domain pathsouth.com (responding authoritative name-
server was 218.236.53.11): The IP addresses in bold highlight changes between the two lookups
taken six minutes apart. For the full list of IPs for this domain, see our technical report [7].
A records
77.178.224.156,
79.120.72.0,
87.228.106.92,
213.141.146.83, 220.208.7.115
79.120.37.38,
85.216.198.225,
89.20.146.249,
A records
61.105.185.90,
79.120.37.38,
89.20.146.249,
89.29.35.218, 91.122.121.88,
69.228.33.128,
87.228.106.92,
89.20.159.178,
Time: 20:51:52 (GMT)
TTL NS records
300 ns0.nameedns.com,
ns0.nameedns1.com,
ns0.renewwdns.com,
ns0.renewwdns1.com
Time: 20:57:49 (GMT)
TTL NS records
300 ns0.nameedns.com,
ns0.nameedns1.com,
ns0.renewwdns.com,
ns0.renewwdns1.com
TTL IPs of NS records
172800 218.236.53.11,
89.29.35.218,
78.107.123.140,
79.120.86.168
TTL IPs of NS records
172800 218.236.53.11,
89.29.35.218,
78.107.123.140,
213.248.28.235
TTL
172800
TTL
172800
– How are dynamics implemented? We study the mechanics by which scam hosting
infrastructures change the Web servers to which clients are redirected. We deter-
mine the location of change by monitoring any changes of (1) the authoritative
nameservers for the domains that clients resolve (the NS record, or the IP address
associated with an NS record) or of (2) the mapping of the domain name to the IP
address itself (the A record for the name). We analyze both on the basis of indi-
vidual spam-advertised domains and campaigns that are formed after domain clus-
tering. We ﬁnd that behavior differs by campaign, but that many scam campaigns
redirect clients by changing all three types of mappings, whereas most legitimate
load-balancing activities only involve changes to A records. We also study the in-
frastructures in terms of the geographical and topological locations of scam hosts
and the country in which the domains were registered.
Background. Fast-ﬂux is a DNS-based method that cybercriminals use to organize,
sustain, and protect their service infrastructures such as illegal Web hosting and spam-
ming. Somewhat similar to a technique used by content distribution networks (CDNs)
such as Akamai, a fast-ﬂux domain is served by many distributed machines, and short
time-to-live (TTL) values allow a controller to quickly change the mapping between a
domain name and its A records, its NS records, or the IP addresses of its NS records)
[13]. Cybercriminals can rotate through compromised hosts, which renders traditional
blacklisting largely ineffective. We show an example of a fast-ﬂux domain, called
pathsouth.com, that we monitored on January 20, 2008 (Table 1).
Related Work. The operation of fast-ﬂux service networks and the use of these plat-
forms to send spam was ﬁrst described in detail by the Honeynet Project [13]. Compared
to other studies of fast-ﬂux networks [15, 4, 8], we focus on fast-ﬂux networks as they
relate to hosting online scams. This paper is the largest such study (it is an order of
magnitude larger than the previous study [4]), and it is the ﬁrst to (1) study the loca-
tion (within the DNS hierarchy) of dynamics, (2) the behavior of hosting infrastructure
across campaigns. We examine scam hosting infrastructure using both spam trap data
and content-based scam campaign clustering; we draw on previous studies that analyzed
spam trap data [6, 11, 14] or performed content-based analysis [2, 4, 9], albeit for differ-
ent purposes. Previous work has used passive DNS monitoring to study the dynamics
of botnets [10, 3], some of which are now believed to used to host fast-ﬂux networks.
Dynamics of Online Scam Hosting Infrastructure
221
Fig. 1. Data collection diagram. The resolver records all DNS mappings at each level of DNS
resolution. Here, we feature the same domain as in Table 1.
The rest of this paper is organized as follows. Section 2 describes our data and its
limitations. Section 3 describes the dynamics of scam infrastructure and fast-ﬂux ser-
vice networks that we observed hosting 21 different spam campaigns over the course
of a month. Section 4 refers to topological and geographic location of the observed
infrastructures. Section 5 concludes with a summary and discussion of future work.
2 Data Collection
Our data collection and processing involves three steps: (1) passive collection of spam
data; (2) active DNS monitoring of domains for scam sites contained in those spam mes-
sages; (3) clustering of spam and DNS data by scam campaign. This section describes
these methods in detail, our use of popular Web sites as a baseline for comparison, and
the limitations of our dataset.
We collected 3,360 distinct domain names that appeared at spam email messages
from a large spam sink hole from October 1, 2007 to December 31, 2007. We used a
simple URL pattern matcher to extract URLs from the message body. Next, we imple-
mented an iterative resolver (at a ﬁxed location) to resolve every domain name from
this set once every ﬁve minutes. Figure 1 illustrates the process by which our resolver
recorded DNS mappings at each level of DNS resolution, which allows us to monitor
fast-ﬂux networks for DNS changes at three distinct locations in the hierarchy: (1) the
A record; (2) the NS record; and (3) the IP addresses corresponding to the names in
the NS record. To avoid possible caching effects, the resolver randomly selected a DNS
root server at each query. The iterative resolver recorded responses received at every
level of the DNS hierarchy, including all referrals and answers.
Due to the sheer number of DNS lookups required to monitor the domains arriving
at the spam trap, the resolver proceeded through the list of domains sequentially: We
began by resolving the ﬁrst 120 domains received at the spam trap each day. Every day
the resolver added 120 new domains to the list. After each domain had been resolved
continuously for three weeks, we removed the domain from the list. The resolver operated
from January 14, 2008 to February 9, 2008. We picked the domains and the campaigns
they mapped to, by restricting our analysis to the domains that had reachable Web sites
and for which we had observed at least one change in any DNS record. To compare the
dynamics those of “legitimate” domains, we used the same iterative resolution process to
study the dynamics of the 500 most popular Web server domains, according to Alexa [1].
222
M. Konte, N. Feamster, and J. Jung
Table 2. Statistics for the top three scam campaigns compared to Alexa domains. Campaigns are
sorted by the total number of IP addresses returned from A records.
Campaign
Spam emails Spam adver-
Pharmacy-A
Watch-A
Watch-B
All campaigns
Alexa data set
tising IPs
18459
40681
454
115198
11670
30411
427
77030
Campaign
domains
149
34
43
465
Fluxing
Domains
149
30
19
384
500
of
IPs
A rec
9448
1516
1204
9521
1048
IPs
of
NS rec
2340
225
219
2421
852
IPs of both
A+NS rec
9705
1572
1267
9821
1877
Clustering spam by scam campaign. To cluster the spam messages into scam cam-
paigns, we retrieved content from the URLs in the email messages and cluster emails
whose URLs retrieve common content. We manually went through snapshot images
and cluster URLs if the site is selling the same products under the same brand name
using a similar page layout. In the case of slow response or when only a few small non-
image ﬁles are received, we checked whether the downloaded ﬁle names of each URL
is a subset of those of already identiﬁed campaign.
All 21 campaigns exhibited ﬂuxing behavior in their DNS records to some extent
during the measurement period. Table 2 shows the summary data for the three campaigns
that used the most hosting servers. We denote each campaign with a category-ID, which
we assigned based on the products offered on the Web site. The ﬁrst two columns show
the number of total spam emails containing the ﬂuxing domains that we received at our
spam trap and the total number of sender IPs of those spam emails. The third column is
the total number of domains for that campaign, and the fourth column is the number of
domain names that we found changing (“ﬂuxing domains”). The last three columns show
(1) the distinct number of IPs returned as A records of domains (IPdomains); (2) the
number of IPs returned as A records of name servers (IPnameservers); and (3) the total
distinct number of IPs from the combined sets (IPdomains∪ IPnameservers).
The top campaign is Pharmacy-A, one of the Canadian Pharmacy scam campaigns
[12]. The campaign used at least of 9,448 distinct IP addresses as hosting servers (or
front end proxies of them) for 149 domains over one month. The next two followers are
Watch-A (Exquisite Replica) [12] and Watch-B (Diamond Replicas) [12], both of which
offer replica watches. For these campaigns, the average number of A records associated
with a single domain name is over 50, demonstrating a lot of activity in moving scam
sites. We also witnessed multiple domains that shared a few hosting servers.
Registrars. To determine the registrar responsible for each of the 384 scam hosting
domains, we performed jwhois queries on May 7, 2008 for each domain. Table 3 shows
that about 70% of these domains are still marked as active and registered with just
eight registrars in China, India, and US. Among these, the three registrars in China are
responsible for 257 domains (66% of the total or 95% of the active ones). Our data
collection was done before February 2008, so all domains were registered before that
time. All 384 domains were all active after four months, and 2% of the domains had
been active for over 7 months. Interestingly, over 40% of these domains were registered
in January 2008, just before the scams themselves were hosted; thus, a newly registered
domain might also ultimately serve as a useful indicator for detecting scam hosting.
Dynamics of Online Scam Hosting Infrastructure
223
Table 3. Registrars of the 384 scam domains as of May 7, 2008
Registrar
dns.com.cn
paycenter.com.cn China
China
signdomains.com India
todaynic.com
Domains
Registrar
Country
Country Domains
China 180 ( 46.9%) leadnetworks.com India 3 ( 0.8%)
2 ( 0.5%)
1 ( 0.3%)
1 ( 0.3%)
65 ( 16.9%)
12 ( 3.1%)
7 ( 1.8%)
coolhandle.com
US
US
US
webair.com
stargateinc.com
total active domains: 271 ( 70.6%)
F
D
C
1
0.8
0.6
0.4
0.2
0
Alexa
Fluxing Domains
104
seconds
106
F
D
C
1
0.8
0.6
0.4
0.2
0
Alexa
Fluxing Domains
104
seconds
106
F
D
C
1
0.8
0.6
0.4
0.2
0
Alexa
Fluxing Domains
104
seconds
106
(a) A records
(b) NS records
(c) IP of NS records
Fig. 2. Distribution of the average time between changes of A, NS, and IP of NS records
Limitations. Our data is derived from spam collected at a single spam trap, which
receives a relatively high number of spam messages (6,247,937 messages from October
2007 through February 2008) but may still reﬂect some bias in the spam it receives.
Because we are primarily looking to analyze the dynamics of widespread campaigns
(i.e., domains that are likely visible at many traps), this limitation should not greatly
affect our results. The main limitation is that our data may not contain all domains
for a particular scam. Some of our measurements occurred months after the spam was
received, but our results suggest that the dynamics of these domains remain relatively
consistent over the month that we monitored them.
3 Dynamics
We studied three aspects of dynamics: (1) the rate at which DNS records change at each
level of the hierarchy; (2) the rate at which scam hosting infrastructure accumulates new
IP addresses (both overall and by campaign); and (3) the location in the DNS hierarchy
where changes take pace. To understand the nature of these features with respect to
“legitimate” load balancing behavior, we also analyzed the same set of features for 500
popular sites listed by Alexa [1] as a baseline.
Rate of Change. We studied the rates at which domains for online scams changed DNS
record mappings and the corresponding TTL values for these records. We compared with
the TTLs for domains listed by Alexa. (Our technical report includes the TTL distribution
graphs [7].) The distribution of A record TTLs shows that scam sites have slightly shorter
TTL values than popular Web sites; however, both classes of Web sites have A records
with a wide range TTL values. Even more surprisingly, almost all scam domains we
analyzed had TTL values for NS records of longer than a day. These results make sense:
many clients visiting scam sites will visit a particular domain infrequently, and only a
224
M. Konte, N. Feamster, and J. Jung
F
D
C
1
0.8
0.6
0.4
0.2
0
F
D
C
1
0.8
0.6
0.4
0.2
0
Pharmacy−A
Watch−A
Watch−B
Pharmacy−B
105
seconds
106
F
D
C
1
0.8
0.6
0.4
0.2
0
Pharmacy−A
Watch−A
Watch−B
Pharmacy−B
106
104
seconds
(b) NS records
(c) IP of NS records
Pharmacy−A