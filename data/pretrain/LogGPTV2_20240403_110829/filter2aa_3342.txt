Fear the Evil FOCA 
Attacking Internet Connections 
with IPv6 
Chema Alonso 
@chemaAlonso 
PI:EMAIL   
Spain is different 
Spain is different 
Spain is different 
Spain is different 
ipconfig 
IPv6 is on your box! 
And it works!: route print 
And it works!: ping 
And it works!: ping  
LLMNR 
ICMPv6 (NDP) 
•  No ARP 
– No ARP Spoofing 
– Tools anti-ARP Spoofing are useless 
•  Neighbor Discovery Protocol uses ICPMv6 
– NS: Neighbor Solicitation 
– NA: Neighbor Advertisement 
And it works!: Neightbors 
NS/NA 
Level 1: Mitm with NA Spoofing 
NA Spoofing 
NA Spoofing 
Demo 1: Mitm using NA Spoofing 
and capturng SMB files 
Spaniards! 
Step 1: Evil FOCA 
Step 2: Connect to SMB Server 
Step 3: Wireshark 
Step 4: Follow TCP Stream 
LEVEL 2: SLAAC Attack 
ICMPv6: SLAAC 
•  Stateless Address Auto Configuration 
•  Devices ask for routers 
•  Routers public their IPv6 Address 
•  Devices auto-configure IPv6 and Gateway 
– RS: Router Solicitation 
– RA: Router Advertisement 
Rogue DHCPv6 
DNS Autodiscovery 
And it works!: Web Browser 
Not in all Web Browsers… 
Windows Behavior 
•  IPv4 & IPv6 (both fully configured) 
– DNSv4 queries A & AAAA 
•  IPv6 Only (IPv4 not fully configured) 
– DNSv6 queries A 
•  IPv6 & IPv4 Local Link 
– DNSv6 queries AAAA 
From A to AAAA 
DNS64 & NAT64 
Demo 2: 8ttp colon 
SLAAC SLAAC 
Step 1: No AAAA record 
Step 2: IPv4 not fully conf. DHCP 
attack 
Step 3: Evil FOCA SLAAC 
Attack 
Step 4: Victim has Internet over 
IPv6 
Level 3: WPAD attack in IPv6 
WebProxy AutoDiscovery 
•  Automatic configuation of Web Proxy 
Servers 
•  Web Browsers search for WPAD DNS 
record 
•  Connect to Server and download 
WPAD.pac 
•  Configure HTTP connections through 
Proxy
WPAD Attack 
•  Evil FOCA configures DNS Answers for 
WPAD 
•  Configures a Rogue Proxy Server listening 
in IPv6 network 
•  Re-route all HTTP (IPv6) connections to 
Internet (IPv4) 
Demo 3: WPAD IPv6 Attack  
Step 1: Victim searhs for WPAD A 
record using LLMNR 
Step 2: Evil FOCA answers with 
AAAA 
Step 3: Vitim asks (then) for WPAD 
AAAA Record using LLMNR 
Step 4: Evil FOCA confirms WPAD 
IPv6 address… 
Step 5: Victims asks for 
WPAD.PAC file in EVIL FOCA IPv6 
Web Server 
Step 6: Evil FOCA Sends 
WPAD.PAC 
Step 7: Evil FOCA starts up a 
Proxy 
Bonus Level 
HTTP-s Connections 
•  SSL Strip 
–  Remove “S” from HTTP-s links 
•  SSL Sniff 
–  Use a Fake CA to create dynamicly Fake CA 
•  Bridging HTTP-s 
–  Between Server and Evil FOCA -> HTTP-s 
–  Between Evil FOCA and victim -> HTTP 
•  Evil FOCA does SSL Strip and Briding HTTP-s (so 
far) 
Google Results Page 
•  Evil FOCA will: 
– Take off Google Redirect 
– SSL Strip any result 
Step 8: Victim searchs Facebook in 
Google 
Step 9: Connects to Facebook  
Step 10: Grab password with 
WireShark 
Other Evil FOCA Attacks 
•  MiTM IPv6 
–  NA Spoofing 
–  SLAAC attack 
–  WPAD (IPv6) 
–  Rogue DHCP 
•  DOS 
–  IPv6 to fake MAC using 
NA Spoofing (in 
progress) 
–  SLAAC DOS using RA 
Storm 
•  MiTM IPv4 
–  ARP Spoofing 
–  Rogue DHCP (in 
progress) 
–  DHCP ACK injection 
–  WPAD (IPv4) 
•  DOS IPv4 
–  Fake MAC to IPv4 
•  DNS Hijacking 
SLAAC D.O.S. 
Conclusions 
•  IPv6 is on your box  
–  Configure it or kill it (if possible) 
•  IPv6 is on your network 
–  IPv4 security controls are not enough 
–  Topera (port scanner over IPv6) 
–  Slowloris over IPv6 
–  Kaspersky POD 
–  Michael Lynn & CISCO GATE 
–  SUDO bug (IPv6) 
–  … 
Big Thanks to 
•  THC (The Hacker’s Choice) 
–  Included in Back Track/Kali 
–  Parasite6 
–  Redir6 
–  Flood_router6 
–  …..  
•  Scappy  
Street Fighter “spanish” Vega 
Enjoy Evil FOCA 
•  http://www.informatica64.com/evilfoca/ 
•  Next week, Defcon Version at: 
•  http://blog.elevenpaths.com 
•  PI:EMAIL  
•  @chemaalonso