Mirror remote ﬁle system to local dir.
Output remote ﬁle to stdout.
Edit remote ﬁles with vim.
Update ﬁle timestamps: touch 
Create remote directory: mkdir 
Change remote working directory.
Show working directory on device.
Change remote volume: chvol 
Set path traversal: traversal 
Initialize printer’s ﬁle system.
File system fuzzing: fuzz 
Show volume information.
Show available memory.
TABLE 5: Implemented ﬁle operation commands.
is capable of more than providing an interface to a printer’s
ﬁle system. We implemented many features not directly
related to any attack, for example, dumping PostScript dic-
tionaries or PJL environment variables. The full table and
more details about the supported commands are contained in
our detailed technical report [43]. Commands directly used
for exploitation – mapped to their corresponding attack –
are shown in Table 6.
Authorized licensed use limited to: IEEE Xplore. Downloaded on March 18,2021 at 12:27:18 UTC from IEEE Xplore.  Restrictions apply. 
(cid:1)(cid:2)(cid:3)(cid:4)(cid:5)(cid:6)(cid:7)(cid:8)(cid:9)(cid:4)(cid:10)(cid:11)(cid:12)(cid:13)(cid:14)(cid:12)(cid:3)(cid:4)
Figure 6: PRET architecture showing the three main components: The Attacker, Translator, and Connector.
PS commands
disable, hang
destroy
reset, restart
overlay, replace
–
hold, capture
lock, unlock
PJL commands
offline
destroy
reset, restart
–
nvram
hold
lock, unlock
Attack
Denial of service
Physical damage
Factory defaults
Print job manipulation
Memory access
Print job capture
Credential disclosure
TABLE 6: PRET commands mapped to attacks.
Translator. The Translator module is responsible for the
correct generation of PostScript and PJL code. The main
challenge here is to ﬁnd corresponding PJL/PostScript op-
erators for a command, including its parameters. This is
not always possible, so some commands are only available
in one of the two languages. For example, the rename
command to rename a ﬁle can be implemented natively in
PostScript, while there is no equivalent in PJL. In addition,
the Translator contains a Fuzzer component, which is used
to test for various path traversal strategies. This way, we
attempt to ﬁnd ﬂaws in PostScript and PJL interpreters,
which sandboxes ﬁle access to a certain directory.
Connector. The Connector is the less complex component
in PRET since it simply carries out the communication by
(1) opening a socket to TCP port 9100, (2) sending the
data through the socket, (3) retrieving the response, and
(4) forwarding it to the Attacker. Furthermore, the Connector
can communicate over USB or parallel port, in case a local
printer is used.
The process of sending datastreams to a printing device
and receiving the responses is straightforward, in theory,
but various pitfalls must be handled in practice. Different
models use different control characters to announce the
end of line or job. Status and error messages need to be
parsed and handled. Although all of the tested devices
responded directly to PJL commands, one challenge was
convincing printers to respond to PostScript commands.
There are various language constructs to provoke feedback
from a PostScript interpreter, but not all are supported by
every printer. This is often caused by vendors who apply
PostScript clones instead of using "real" (Adobe) PostScript.
For example, Brother’s BR-Script does not support output
commands like print while Kyocera’s KPDL has difﬁculties
sending larger amounts of data to %stdout.
Logging and Scripting. The Logging component depicts
in a detailed and technical manner the communication with
the printer. If logging is enabled, developers and security
experts can see the translated PJL and PostScript commands,
the execution of the attacks, and the reaction of the tested
printer.
The Scripting component can be used to load and run
commands from a ﬁle and perform certain attacks. This
functionality makes PRET completely scriptable and allows
easy automation of vulnerability tests.
7. Evaluation
We acquired 20 printers from different manufacturers,
see Figure 7, and installed the latest ﬁrmware on each of
the printers, before starting our evaluation. Three printers
had physically broken printing functionality so it was not
possible to evaluate all the presented attacks. Nevertheless,
our results show that each printer was vulnerable to at least
one of the analyzed attacks, see Figure 8. Simple DoS
attacks were applicable to all the tested printers with as few
as two lines of code.
With two exceptions, all
the presented attacks were
applicable in all the attacker models. The physical-damage
attack was only applicable for the network attacker from
AMnet. It took about 24 hours to execute this attack, which
is not realistic in AMphy and AMweb. Resetting the printers
to their factory defaults via SNMP was also possible only
in AMnet. This attack requires a UDP connection to the
printer.
7.1. Denial-of-Service (DoS)
Inﬁnite loop. Listing 6 shows how trivial it can be to attack
a printer with a PostScript ﬁle. This minimalist document
keeps a PostScript interpreter busy forever. In our pool of
test printers, only HP LaserJet M2727nf had a watchdog
221
Authorized licensed use limited to: IEEE Xplore. Downloaded on March 18,2021 at 12:27:18 UTC from IEEE Xplore.  Restrictions apply. 
Within 24 hours, eight devices indicated a corrupt
NVRAM: Brother MFC-9120CN, Brother DCP-9045CDN
and Konica bizhub 20p showed error code E6 (EEPROM
error), but everything worked ﬁne after a reboot. Lexmark
E360dn and Lexmark C736dn became unresponsive and
showed error code 959.24 (EEPROM retention error). After
a restart, both devices recovered but only accepted between
a dozen and several hundreds long-term values to be set
until the same behavior was observed again. Dell 5130cdn,
Dell 1720n and HP LaserJet M2727nfs completely refused
to set any long-term values anymore.
The impact of the physical NVRAM destruction is
limited for two reasons. First, contrary to our assumption,
NVRAM parameters were not frozen at their current state
but instead ﬁxed to the factory default value. Second, all
variables could still be changed for the current print job
with the @PJL SET... command. Only the functionality to
change long-term settings was broken.
7.2. Protection bypass
(AMphy). All
Factory defaults. Resetting a printer device to factory
defaults to bypass protection mechanisms is trivial for
a physical/local attacker
tested printers
have documented procedures to perform a cold reset by
pressing certain key combinations or setting a jumper.
The network attacker and web attacker can use Printer-
MIB, which deﬁnes the prtGeneralReset Object
(OID
1.3.6.1.2.1.43.5.1.1.3.1)
[13]. This object allows an at-
tacker to restart the device (powerCycleReset(4)), reset the
NVRAM settings (resetToNVRAM(5)), or restore factory
defaults (resetToFactoryDefaults(6)) using SNMP as shown
in Listing 10. This attack was applicable to about half of
our printer devices.
1
# snmpset −v1 −c p u b l i c
[ p r i n t e r ]
1 . 3 . 6 . 1 . 2 . 1 . 4 3 . 5 . 1 . 1 . 3 . 1 i 6
Figure 7: Acquired test printers.
mechanism and restarted itself after about ten minutes. The
other devices did not accept print jobs anymore, until we
ultimately interrupted the test after half an hour.
1 %!
2
{} l o o p
Listing 6: PostScript inﬁnite loop.
Showpage redeﬁnition. Another effective approach is to
redeﬁne PostScript operators. For example, the showpage
operator is used in every document to print the page. An
attacker can redeﬁne this operator to do nothing, see List-
ing 7. In such a case, PostScript jobs are processed but not
printed anymore. This attack was applicable to 14 devices.
1 %!
2
3
s e r v e r d i c t b e g i n 0 e x i t s e r v e r
/ showpage {} d e f
Listing 7: PostScript showpage redeﬁnition.
Listing 10: Reset device to factory defaults (SNMP).
Ofﬂine mode. The PJL standard deﬁnes the OPMSG com-
mand which ‘prompts the printer to display a speciﬁed
message and go ofﬂine’ [46]. This can be used to simulate
a paper jam as shown Listing 8. The end-user must press
the online button on the printer’s control panel to make the
printer accept further jobs.
1 @PJL OPMSG DISPLAY="PAPER JAM"
Listing 8: PJL printer ofﬂine mode.
Physical damage. For a practical test to destroy NVRAM
write functionality we continuously set the long-term values
for the number of copies (with different values for X), see
Listing 9.
1 @PJL DEFAULT COPIES=X
Listing 9: PJL long-term settings.
In many scenarios, an attacker does not have the capabil-
ities to perform SNMP requests due to ﬁrewalls or unknown
SNMP community strings. On HP devices, however, the
attacker can transform SNMP into its PML representation
and embed the request within a legitimate print job [16].
Hereby, the device can be reset to factory defaults as shown
in Listing 11, which removes all protection mechanisms like
user-set passwords for the embedded web server.
1 @PJL DMCMD ASCIIHEX="040006020501010301040106"
Listing 11: Reset device to factory defaults (PML).
PostScript offers a similar feature. The FactoryDefaults
system parameter is ‘a ﬂag that, if set to true immediately
before the printer is turned off, causes all nonvolatile pa-
rameters to revert to their factory default values at the next
power-on’ [8], see Listing 12. This code, however, only
affects the PostScript environment and its passwords.
222
Authorized licensed use limited to: IEEE Xplore. Downloaded on March 18,2021 at 12:27:18 UTC from IEEE Xplore.  Restrictions apply. 
(cid:1)(cid:2)(cid:2)(cid:3)(cid:4)(cid:5)(cid:6)(cid:7)(cid:3)(cid:2)(cid:8)(cid:9)(cid:10)(cid:11)(cid:12)(cid:8)(cid:13)
(cid:14)(cid:8)(cid:15)(cid:12)(cid:3)(cid:16)(cid:6)(cid:10)(cid:17)(cid:6)(cid:18)(cid:8)(cid:11)(cid:19)(cid:12)(cid:4)(cid:8)
(cid:20)(cid:11)(cid:10)(cid:2)(cid:8)(cid:4)(cid:2)(cid:12)(cid:10)(cid:15)(cid:6)(cid:21)(cid:22)(cid:23)(cid:3)(cid:13)(cid:13)
(cid:1)(cid:2)(cid:2)(cid:3)(cid:4)(cid:5)(cid:13)
(cid:23)
(cid:10)
(cid:10)
(cid:16)
(cid:6)
(cid:8)
(cid:2)
(cid:12)
(cid:15)
(cid:12)
(cid:17)
(cid:15)
(cid:12)
(cid:6)
(cid:8)
(cid:9)
(cid:3)
(cid:23)
(cid:50)
(cid:10)
(cid:49)
(cid:13)
(cid:15)
(cid:10)
(cid:12)
(cid:2)
(cid:12)
(cid:15)
(cid:12)
(cid:17)
(cid:8)
(cid:30)
(cid:8)
(cid:11)
(cid:8)
(cid:30)
(cid:10)
(cid:25)
(cid:8)
(cid:15)
(cid:6)
(cid:12)
(cid:16)
(cid:17)
(cid:17)
(cid:10)
(cid:6)
(cid:16)
(cid:12)
(cid:3)
(cid:4)
(cid:13)
(cid:22)
(cid:49)
(cid:23)
(cid:8)
(cid:9)
(cid:3)
(cid:25)
(cid:3)
(cid:30)
(cid:6)
(cid:9)
(cid:15)
(cid:12)
(cid:11)
(cid:10)
(cid:2)
(cid:13)
(cid:8)
(cid:11)
(cid:6)
(cid:22)
(cid:11)
(cid:10)
(cid:2)
(cid:4)
(cid:3)
(cid:17)
(cid:13)
(cid:2)
(cid:16)
(cid:26)
(cid:3)
(cid:17)
(cid:8)
(cid:30)
(cid:20)(cid:11)(cid:12)(cid:15)(cid:2)(cid:6)(cid:33)(cid:10)(cid:29)(cid:6)
(cid:35)(cid:3)(cid:15)(cid:12)(cid:23)(cid:26)(cid:16)(cid:3)(cid:2)(cid:12)(cid:10)(cid:15)
(cid:2)
(cid:15)
(cid:8)
(cid:25)
(cid:8)