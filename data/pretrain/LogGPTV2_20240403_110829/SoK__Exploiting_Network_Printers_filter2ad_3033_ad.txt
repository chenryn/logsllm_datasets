### File System Operations and Commands

- **Mirror Remote File System to Local Directory:** This command allows for the replication of a remote file system to a local directory.
- **Output Remote File to Standard Output (stdout):** Enables the output of a remote file directly to the standard output.
- **Edit Remote Files with Vim:** Provides the ability to edit remote files using the Vim text editor.
- **Update File Timestamps (touch):** Updates the timestamps of files.
- **Create Remote Directory (mkdir):** Creates a new directory on the remote system.
- **Change Remote Working Directory:** Changes the current working directory on the remote system.
- **Show Working Directory on Device:** Displays the current working directory on the device.
- **Change Remote Volume (chvol):** Changes the active volume on the remote system.
- **Set Path Traversal (traversal):** Configures path traversal settings.
- **Initialize Printerâ€™s File System:** Initializes the file system of the printer.
- **File System Fuzzing (fuzz):** Performs fuzzing on the file system to identify potential vulnerabilities.
- **Show Volume Information:** Displays information about the volumes on the remote system.
- **Show Available Memory:** Shows the amount of available memory on the remote system.

#### Table 5: Implemented File Operation Commands

The system is not limited to providing an interface to a printer's file system. We have implemented several features that are not directly related to any specific attack, such as dumping PostScript dictionaries or PJL environment variables. The full list of commands and more detailed information can be found in our technical report [43]. Table 6 lists the commands used for exploitation, mapped to their corresponding attacks.

### PRET Architecture

**Figure 6: PRET Architecture**
- **Attacker:** Initiates and controls the attack.
- **Translator:** Responsible for generating correct PostScript and PJL code. It finds corresponding operators for commands, including parameters. Some commands are only available in one language due to the lack of equivalent functions in the other.
- **Connector:** Manages communication by opening a socket to TCP port 9100, sending data, retrieving responses, and forwarding them to the Attacker. It also supports USB and parallel port communication for local printers.

### Logging and Scripting

- **Logging:** Provides detailed and technical logs of the communication with the printer, enabling developers and security experts to see translated commands, attack execution, and printer reactions.
- **Scripting:** Allows loading and running commands from a file, facilitating the automation of vulnerability tests.

### Evaluation

We acquired 20 printers from different manufacturers and installed the latest firmware before starting our evaluation. Three printers had physically broken printing functionality, but all tested printers were vulnerable to at least one attack. Simple DoS attacks were applicable to all tested printers with just two lines of code.

#### Denial-of-Service (DoS) Attacks

- **Infinite Loop:** A minimalist PostScript document can keep the interpreter busy indefinitely. Only the HP LaserJet M2727nf had a watchdog mechanism to restart after ten minutes.
- **Showpage Redefinition:** Redefining the `showpage` operator to do nothing prevents printing, even though the job is processed. This attack was applicable to 14 devices.

#### Protection Bypass

- **Factory Defaults:** Resetting a printer to factory defaults bypasses protection mechanisms. Physical/local attackers can use documented procedures, while network and web attackers can use SNMP and PML to reset the device.

### Test Results

- **NVRAM Destruction:** Continuous setting of long-term values for the number of copies caused NVRAM corruption in some printers. However, the impact was limited as NVRAM parameters reverted to factory defaults, and long-term settings could still be changed for the current print job.
- **Offline Mode:** The PJL `OPMSG` command can simulate a paper jam, requiring the user to press the online button to resume printing.

### Conclusion

Our evaluation shows that each printer was vulnerable to at least one attack, with simple DoS attacks being universally applicable. The ability to reset printers to factory defaults and the potential for physical damage highlight the need for robust security measures in printer management.