### 漏洞发现与利用

在对Kayako和Zendesk进行安全评估时，我发现了两个新的漏洞。这些漏洞允许攻击者绕过邮件验证过程，即使目标未启用单点登录（SSO）功能且启用了邮件验证机制。这种情况下，攻击者可以成功完成攻击。

6月1日，我向这两个厂商的漏洞响应计划提交了问题报告，相关修复措施正在研发中。

此外，如果网站在用户注册时需要验证邮箱地址，但在修改邮箱地址时却不需要验证，这类网站也容易受到此类漏洞的影响。

### 影响范围进一步扩大

即便某些企业不使用Slack，并认为这样已经足够安全，但事实并非如此。我发现的问题影响范围非常广泛，例如Yammer等其他商业通讯工具也受到影响。如上图所示，我成功加入了某家公司的Yammer内网。

由于我们可以读取发往support@的邮件，因此也能看到发往该地址的任何密码重置链接。许多公司使用这个邮件地址来注册诸如Twitter等第三方服务及社交媒体，这意味着攻击者可以劫持与support@邮箱关联的任何账户。

在某些情况下，这个邮箱还可能与目标公司的网站上的特权账户相关联。通过注册PI:EMAIL后，攻击者可以拦截PI:EMAIL的密码重置令牌，获得特权账户的访问权限，进而访问所有客户的隐私信息。

即使上述方法行不通，攻击者仍可读取并回复由该邮箱创建的支持票据（无论是之前的还是之后的）。我的一个朋友曾因某些问题向某个公司的帮助支持邮箱发送了一封邮件。经过分析，我发现该公司确实存在漏洞。于是，我使用朋友的邮箱完成注册，点击“我的支持案例”后，果然找到了他之前发送的那封邮件。只要人们在服务台上没有对应的账户，我就可以读取并回复他们发往客户服务的所有邮件。用户以为与他们交谈的是客户服务人员，但实际上背后是一名黑客。

### 厂商及企业的回复

研究每个企业对这个漏洞的处理方式是一件非常有趣的事情：

1. **大多数企业的专业处理**：多数企业能够以非常专业的方式来处理我提交的报告。有些企业甚至决定发放高达8,000美元的漏洞奖励。但也有一些企业给出了负面回应，甚至完全忽略了我的报告。
   
2. **GitLab的快速响应**：GitLab（[#21823](https://hackerone.com/reports/218230)，已披露）迅速取消对公司域名的信任，并修改了他们的Slack设置。此外，他们还更新了[说明文档](https://docs.gitlab.com/ee/administration/reply_by_email.html#security-concerns)，以防止客户犯同样的错误。

3. **Slack的积极应对**：我向Slack报告了这个问题（[#23923](https://hackerone.com/reports/239623)，待披露），希望能在高层逻辑上阻止这个漏洞。虽然Slack对此不承担直接责任，但他们非常重视这个问题，因为这会影响到很多客户。Slack修改了no-reply邮箱，在其中添加了一段随机令牌，有效地阻止了黑客对服务台软件的攻击。尽管问题跟踪功能及其他邮箱集成功能仍然存在问题，但这些问题已经与Slack本身无关。Slack为此给我发放了1,500美元的奖励。

4. **Yammer的缓慢响应**：我也联系了Yammer。最初没有得到任何回应，两周后我又发了一封邮件，这次他们回复说已将邮件转发给Yammer的安全团队，并告诉我他们对安全漏洞的定义。到目前为止，Yammer尚未采取像Slack那样的积极措施来解决这一问题，因此黑客仍然可以利用这些方法加入Yammer工作组。

5. **Kayako和Zendesk的积极响应**：我向Kayako和Zendesk（[#235139](https://hackerone.com/reports/235139)，已披露）的漏洞奖励计划提交了SSO绕过漏洞。两者都解决了这个问题，并分别向我发放了1,000美元和750美元的奖励。

### 经验教训

1. **企业内部安全性的重要性**：一旦进入企业内部，其安全性就会大大降低。攻击者可以利用团队中所有人都可以访问的资源，获取员工贴在上面的密码、企业秘密以及客户信息等隐私信息。

2. **持续寻找安全隐患**：这个问题已经在上百个网站中存在多年，许多安全专家每天都会面对这些网站，但据我所知，目前并没有其他人发现这个问题。

3. **大型企业的管理难题**：我与一家大型支付企业的CISO讨论过这个问题，他保证说他们企业肯定不存在这个问题，因为他们的员工不应该通过Slack交流。然而，我加入了该企业全球范围内332名员工所创建的Slack频道，证明了他的观点是错误的。最终我得到了5,000美元的奖励。

4. **查找受影响的Slack团队**：如果你想知道可以用自己的公司邮箱加入哪些Slack团队，可以试一下Slack的“[查找团队](https://slack.com/signin/find)”功能。

### 常见问题解答

**1. 如何知道自己公司是否受到影响？**

如果支持票据可以通过电子邮件创建，并且未经验证邮件地址的用户可以访问支持票据，那么目标就会受到该漏洞影响。此外，如果公共问题追踪及响应功能使用特有的@company.com邮箱来将信息直接提交给某个票据、论坛帖子、私人消息或用户账户，也会受此漏洞影响。

**2. 企业存在漏洞后如何修复？**

目前我知道有几种方法可以解决这一问题。类似Airbnb、LinkedIn和GitHub之类的公司会使用不同域名的邮箱地址，比如@reply.linkedin.com或@mail.github.com。这些邮箱无法用来注册类似Yammer或Slack之类的服务。GitLab根据此建议更新了他们的[说明文档](https://docs.gitlab.com/ee/administration/reply_by_email.html#security-concerns)，以防止在问题追踪功能中存在这类漏洞。

某些公司选择禁用电子邮件功能、服务门户站点或单点登录功能，其他公司则使用正确的邮箱验证机制。此外，我不建议公司使用官方的support@邮箱来注册Twitter、Slack或Zendesk之类的服务。

**3. 作为受影响的厂商，如何阻止这类漏洞？**

对于使用客户服务邮箱注册的用户，你可以采用额外的安全措施，但在许多情况下，这种方法并不实用也不高效。Facebook Workplace使用了更加巧妙的方法，他们利用随机生成的邮件地址来发送邮件，比如notification+PI:EMAIL，攻击者无法猜中这类地址。在回复我的邮件中，Slack表示他们会采用这种随机化邮件地址。

**4. 目前还有上百个企业受到影响，你为什么公布这个漏洞？**

受影响的企业数量众多，我无法全部通知到。公布这个漏洞可能存在法律风险，因为某些公司并没有要求我提供安全公告。我只联系了少数几个受影响的公司及厂商，这些公司及厂商具备公众漏洞披露计划。对我来说，现在就公布详细信息是一个艰难的决定，因为这可能直接导致安全风险。但根据历史经验，我们知道囤积隐藏漏洞并不是个好主意。

**5. 你的身份？**

我叫Inti，住在比利时。从孩时起我就擅长捣蛋破坏。今年我22岁，在比利时最大的广播电台布鲁塞尔工作，担任创意编辑。晚上我会以善良黑客的身份搞些破坏，Google、Facebook、Microsoft和Yahoo等都感谢过我的劳动成果。

**6. 还有其他成果吗？**

我曾劫持过特朗普的推特，创办了StalkScan.com网站，这个网站可以深入挖掘Facebook的人际关系。我也喜欢在Medium上分享我的研究成果。大家可以关注我的推特了解更多信息。