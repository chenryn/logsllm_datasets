品就开始测试。
这么建议，相信也错不到哪去。明天到公司联系机房的人，让他们准备好相应的物
了程序，打开网站速度快就行吗？这事儿以后找时间还得向刘老师请教。既然刘老师
如DNS解析时间、下载第一个包时间、传输时间等。
net/uid-10915175-id-4998580.html中找到。它主要是用来分析访问一个站点的各项性能，
每一个机房的测试结果是都保存在一个Word文档里。
最主要的是质量好、线路有保证。
的话，不建议你用这些收费的测试。我介绍的这几家相对来说在行业内口碑还算是不错的
话，效果几乎没有不好的，因为数据都是可以“修改”的，你懂的。如果你只是选择机房
参考性质的，所以这里不过多地介绍。
另外请教几个问题，一个是怎么样把已经执行的程序放到后台；另外一个是如果把
非常感谢！通过您的介绍，我了解到北京大概的网络情况及IDC提供商的一些“手
乍一看，小鑫就感觉头大，测试一个机房线路都这么麻烦。难道不是接上线部署
最后我向你推荐一个我自己编写的脚本，你可以从我的博客http://blog.chinaunix.
我这边当时测试的条件是Centos5.6_64位、10MB带宽、BGP多线、apache2版本。
当然这种是收费的，并且价格非常贵。根据一些使用过的人介绍，使用第三方测试的
再次强调，测试网站并不一定准确，只作参考
第三种只能是参考性质的测试，使用测试网站。你可以搜索一下相关信息，因为只是
感谢！
您好！
测试IDC线路大概就是以上这几个步骤，祝你顺利！
以上是“开源”方法。不知道你那边是否限制比较多，还有一种是使用专业的测试方
以上的测试结果可以截图保留，以备对比使用。
1.1寻找IDC数据中心
9
---
## Page 20
询一下。还有一个命令是 setsid，这里我就不和你多说了。
1-8所示。
信号。所以一般在测试时，我常用的命令是 nohup ping x&这样的形式，如图 1-6所示。
这就说明所执行的命令不会受到终端1的HUP信号的影响了，你也可以关闭终端1再查
打开另一终端2查询出的结果是ping那个进程的父ID（PPID）为1（init 进程的PID），
以后有时间再和你说）。从上面两张截图可以看到，执行命令的终端1是执行命令的终端
从而成为不属于此终端的子进程。
一般的解决办法就有两种，要么让进程忽略HUP信号，要么让进程运行在新的会话里，
SecureCRT）或者网络断开时，系统终端会收到HUP信号，从而关闭其所有子进程。所以
小鑫：
企业互联网根基之IDC的选择
第1章
将一个或多个命令包含在“（）”中就能让这些命令在子shell中运行（更多的小技巧
nohup无疑是首先想到的办法。
还有一种是子 shell，这种方法确实不常用，直接看我给你发的截图吧，如图1-7和图
一般平时使用的命令行是pingxxxx的形式，不过当关掉SSH客户端（我使用的是
你好！
第二天一早，小鑫就看到了刘老师的邮件回复。
#
nohup:appending output tonohup.out
oot
rootesys liu]#nohup ping g.cn&
bytes from
bytes
bytes
Dytes
bytes
927
from
from
From
rom
from
203
12
203.
203
203.208.46.148
203
208.
208
208
#
016:20
4
nonup
。顾名思义，nohup的用途就是让提交的命令忽略HUP
148
48
ano
icmp_seq=23
图1-6
cm
00:00:00pingg.cn
ttl
=56
1=56
-56
1=56
=56
1=56
time=1
time=5
--color=auto
57
#
---
## Page 21
当前进程的运行结果。
查询它的作业号，再用bg jobspec将它放入后台并继续运行。需要注意的是，挂起会影响
时按住乙键）了！
表。但如果并没有把当前命令作为作业来运行，就需要用Ctrl+Z组合键（按住Ctl键的同
这时将不能再使用jobs来查看它，但是依然能使用ps-ef查找到它。
来解决这个问题了。它的用法如下所示。
加任何处理就已经提交了命令，想让其避免HUP信号的话就只能通过作业调度和disown
“&”来使它成为一个作业并在后台运行，那么是可以通过jobs命令来得到所有作业列
Ctrl+Z组合键的用途就是将当前进程挂起（Suspend），然后我们就可以用jobs命令来
这里还有一个问题，因为这种方法的操作对象是作业，如果我们运行命令时在结尾加
这里你需要注意的是，当使用过disown之后，系统会把目标作业从作业列表中移除
用disown-rh来使正在运行的作业忽略HUP信号。
用disown-ah来使所有的作业都忽略HUP信号。
用disown-hjobspec来使某个作业忽略HUP信号。
上面说的是命令前加上nohup或者子shell就可以避免HUP信号的影响。但是如果未
[root@sys ]# ps -eflgrep g.cn
bytes
es
tes
rom
203
203
203
203
46
46
78
78
np.seq-2
图1-8
图1-7
seq-18
eq
ea=14
seq=12
20
-16
11
tt
tt
tt
cmpseq=1
me=
me=
me=4
1=56time=1.57
1.1
寻找IDC数据中心
二
---
## Page 22
12
情况下tracert一次的结果如图1-11所示，将其保存在一个文件中，然后配合AWK和 for
道你对 shell的了解程度有多少，整理出来的数据文件用 shell脚本处理一下就可以。
其放入后台，再使用disown，如图1-10所示。
可能有重复的，但数量还是会相当多。如果你一个一个查询的话，会浪费很多时间。不知
企业互联网根基之IDC的选择
第1章
另外你提到的tracert所得到的IP归属地问题，测试出来的结果会有很多IP，虽然说
如果提交命令时未使用“&”将命令放入后台运行，可使用Ctrl+Z组合键和“bg”将
如果在执行命令时已经用了“&”，则可以直接使用disown，如图1-9所示。
[rootesys testLargeFile]#
[rootsys testLargeFile]#
total 5248012
5368709120 bytes （5.4GB) copied.11.1969 seconds,479 MB/s
rootasys testLargeFile]#bg%1
+0
rootasys testLargeFile]# dd if=/dev/zero of=testLargeFile bs=1024M count=5
ootlsys testLargeFile]#11
ootusys testLargeFile]#disown-h%1
rootisys testLargeFi
rootgsys
rootasys testlargeFile]#jobs
ootsys testLargeFi
oot4
W-P--
ootusys
ot4s
Stopped
records
Running
SV
20057
19852
testLargeFile]#cp -r testLargeFile largeFile2
10241
testLargeFile]#1)
testLargeFile]# disown
root root 5368709120 Feb 10 17:05 testLargeFile
root
2267
2267
2267
root
11
27
ile]# ps -ef Igrep largeFile
e
17:45pts/
DS
7
cp-i-r testlargeFile largeFile2 &
cp-i-rtestLargeFile largeFile2
grep
图1-10
图1-9
00:00:00 grep --color-auto
largeFile2
00:00:06
一般
---
## Page 23
借用其他公司的资质)。
环境调整（如变更IP、机柜搬迁、IDC机房公司变更）。
收集的一些标准。
1.1.3
要花一些时间才可以熟练地掌握。
就可以得出结果，如图1-11和图1-12所示。
一机房（同一交换机）有客户经常遭攻击，自己的应用也会受到牵连。
（3）是否有正规的ICP资质，并要求提供IDC证复印件（有的IDC没有ICP资质，或
除了上面关于带宽方面的内容，再简单介绍一些选择IDC运营商的标准吧，以下是我
25.
02
24.65.58.229
（2）调查同机房客户情况，IDC托管的客户如果比较混杂的话，很容易遭受攻击。同
（1）应该选择运营至少在8年以上的IDC。因为新机房管理制度不成熟，容易做机房
1.考察IDC机房运营的稳定性
这些是比较基础的内容，建议你多了解 shell基础知识。shell方面的知识多而杂，需
39.19.30天津市，联通
126.0.181
125.90.253
135.
IDC运营商选择标准
Hiu_# for
raceroute towww.163.com（125.39.19.30）.
202.99.116.10(202.99.116.10)
23.125.90.253
local
京市
ADSL
host
联通ADSL
125.90253
print $2]
图1-12
图1-11
4.163ms
0.930
ms
tracertiP):do python ChalP.py $i:dor
30 hops max.40 byte packets
4.215ms
3557ms
080
0.424ms
230ms:
4.195ms
1.061ms
寻找IDC数据中心
13
---
## Page 24
#
人员来介绍。
分别从两个不同供电局过来的电才算是真正的双路供电。
的时候，指的是分别从两个变电站（同一供电局）过来的，但对于高可靠性的机房来说，
机房感受一下即可。
时间。
企业互联网根基之IDC的选择
第1章
（2）一般每个机柜提供的是双路电，但机房最少是两路电。一般IDC跟用户说双路电
（4）服务器及设备迁入或迁出机房，是否有专门人员协助？
（3）故障响应时间是多少？也就是当服务器发生故障时，我们最快到达机房所需要的
小鑫按着刘老师的建议编写了ping 和 tracert的脚本，交给后台执行去了。第一步算
至于IDC机房的位置、格局、消防及安全性等可在参观机房的时候，由机房相关负责
（3）看看是否有UPS电源供电，该电源能支撑多久的供电？
（1）一般机房会配备大型的空调系统，所以在温、湿度方面都不是问题。建议直接去
4.考察机房的温、湿度及电力情况
（2）机房是不是可以24小时进行维护？
（1）如果不在同城，需要计算一线城市的交通是否便利，维护一次的成本是多少？
3.考察IDC是否便于维护
（5）机柜可以存放的服务器数量是多少？一般有电及数量的限制。
（4）可扩充机房是否充足？一般一个大的运营商会将机房分为一期、二期等。
（3）是否存在带宽复用情况，带宽复用率是多少？
（2）机房总的带宽是多少，增加带宽是否方便？
（1）是不是多线机房，有没有自己的BGP自治域（一般小的代理商没有）？
2.考察IDC机房的带宽和机柜情况
5.其他
（4）了解发电机的运行使用情况。
（4）IDC备案是否方便？
（有的机房因为资质问题很难做ICP备案）
---
## Page 25
是很让人满意的。
提出的一些问题，比如机柜的扩展、双线路的备份、DDOS攻击所采取的措施等，结果还
机房的人员向他们介绍了机房的电、核心设备、温度、通风、线路走向等，也回答了他们
以出现星号。
下，将为该跃点显示一行星号。这也是出于安全考虑，也许是网络问题没有回应，所
期的数据包返回“已超时”消息，而且这些路由器对tracert命令不可见。在这种情况
略且不会影响测试，但具体为什么还真不清楚。原来某些路由器不会为其TTL值已过
可用。
上的NetBIOS）显示协议统计和当前TCP/IP连接，所以只有在安装了TCP/IP协议之后才
TTL减为O时，路由器应该将“ICMP已超时"的消息发回源系统。这个命令使用NBT（TCP/IP
地址所经过的路由时间及数量。
顾了tracent的原理，即向目标地址发送不同TTL值的ICMP数据包，来确定到访问目标
过的路由，其他的作用还真不记得了。原来tracent在测试机房的时候还挺重要的。小鑫回
的归属地不得“累死”啊！
的线路也都是北京的线路。真得感谢刘老师提供的工具，不然小鑫要一个一个地查这些IP
提供商的各种线路之间的对比相差不多。Wget下载时的“量”是没问题的，tracert所经过
看最终结果有点儿不太靠谱，只能作参考了。
机房、IP归属地、相应的测试时间等内容还是挺全的，不过不清楚后台的具体操作，只是
试，
维工作的人很多。
有其他的机房，Smokeping是用不上了。小鑫加了刘老师介绍的QQ 群，发现群里从事运
是完成得差不多了。小鑫采集了几天的数据，然后进行分析就可以了。目前小鑫的公司没
小鑫在用tracert测试时，有时显示的是星号，如图1-13所示。小鑫知道是可以忽
_小鑫把这些测试的结果写了一封邮件发给了领导。小鑫印象中，tracert也就是查看经
，网站测试的内容还不少。小鑫输入了需要测试的IP，分析结果也挺多的。全国各地的
看过测试结果，小鑫的领导和各IDC提供商沟通后就和小鑫直接去机房实地考察了
要求路径上的每个路由器在转发数据包之前至少将数据包上的TTL递减1，数据包上的
一周后机房的测试结束了，小鑫把相关的测试结果文件统一地分析了一下，各个IDC
这几天小鑫也搜索了一下测试机房及服务的网站，有ping、tracert、DNS、CDN的测
1.1寻找IDC数据中心
15
---
## Page 26
16
多，就只是想着做运维还不错，所以想在运维这方面提升一下自己。希望刘老师给我一些
鑫写了一封对自己很重要的邮件。
不全面。看到刘老师的《高性能网站构建实战》里介绍刘老师曾经做过培训讲师，所以小
概了解到机房里的一些注意事项，这些也是比较重要的。
的限制而无法采用，但还是有一些“开源”的方法，既简便又实用。除此之外，小鑫还大
1.2小结
企业互联网根基之IDC的选择
指点。
刘老师：
第1章
您好！
除了获得的这些信息外，小鑫还发现了自己的很多不足之处，尤其是基础知识不扎实
通过这次测试机房，小鑫了解到测试机房所需要的测试方法，虽然有些方法因为条件
带着很大的期望，小鑫单击了“发送”按钮。
十分感谢！
比如服务器的选择和配置、系统中常用的软件技巧等。
另外想请您给我提点建议。我个人做运维的时间不长，对于技术和架构方面懂得也不
这次能成功选择高质量的机房要非常感谢您的指导，在这里再次感谢您。
Mdninistratoetraeertoou.163.com
图1-13
票利192.168.1.
---