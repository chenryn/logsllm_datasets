title:The record route option is an option!
author:Brian J. Goodchild and
Yi-Ching Chiu and
Rob Hansen and
Haonan Lu and
Matt Calder and
Matthew J. Luckie and
Wyatt Lloyd and
David R. Choffnes and
Ethan Katz-Bassett
The Record Route Option is an Option!
Brian J Goodchild𝛼,𝛽,𝛾 Yi-Ching Chiu𝛼 Rob Hansen𝛿 Haonan Lu𝛼 Matt Calder𝛼,𝜖
Matthew Luckie𝜁 Wyatt Lloyd𝛼 David Choffnes𝛿 Ethan Katz-Bassett𝛼,𝛾
𝛼USC, 𝛽Rutgers – Camden,𝛾Columbia, 𝛿Northeastern, 𝜖Microsoft, 𝜁University of Waikato
Abstract
The IPv4 Record Route (RR) Option instructs routers to record their
IP addresses in a packet. RR is subject to a nine hop limit and,
traditionally, inconsistent support from routers. Recent changes in
interdomain connectivity—the so-called “flattening Internet”—and
new best practices for how routers should handle RR packets suggest
that now is a good time to reassess the potential of the RR Option.
We quantify the current utility of RR by issuing RR measurements
from PlanetLab and M-Lab to every advertised BGP prefix. We
find that 75% of addresses that respond to ping without RR also
respond to ping with RR, and 66% of these RR-responsive addresses
are within the nine hop limit of at least one vantage point. These
numbers suggest the RR Option is a useful measurement primitive
on today’s Internet.
CCS Concepts
• Networks → Routing protocols; Topology analysis and genera-
tion;
Keywords
Record Route, IP Options, Routing, Topology, Traceroute
ACM Reference format:
Brian Goodchild, Yi-Ching Chiu, Rob Hansen, Haonan Lu, Matt Calder,
Matthew Luckie, Wyatt Lloyd, David Choffnes, Ethan Katz-Bassett. 2017.
The Record Route Option is an Option!. In Proceedings of IMC ’17: Internet
Measurement Conference , London, United Kingdom, November 1–3, 2017
(IMC ’17), 7 pages.
https://doi.org/10.1145/3131365.3131392
1
Introduction
Researchers and network operators need to understand Internet rout-
ing topology to troubleshoot problems. However, the protocols are
Permission to make digital or hard copies of all or part of this work for personal or
classroom use is granted without fee provided that copies are not made or distributed
for profit or commercial advantage and that copies bear this notice and the full citation
on the first page. Copyrights for components of this work owned by others than the
author(s) must be honored. Abstracting with credit is permitted. To copy otherwise, or
republish, to post on servers or to redistribute to lists, requires prior specific permission
and/or a fee. Request permissions from permissions@acm.org.
IMC ’17, November 1–3, 2017, London, United Kingdom
© 2017 Copyright held by the owner/author(s). Publication rights licensed to Association
for Computing Machinery.
ACM ISBN 978-1-4503-5118-8/17/11.
https://doi.org/10.1145/3131365.3131392
not designed to reveal many details of Internet operations, the In-
ternet is vast and complex, and it is administered by autonomous
networks. Thus the set of tools for measuring topology is small, and
many aspects of Internet routing remain opaque.
Given limited visibility, the IP Record Route (RR) Option offers
promising attributes as a measurement primitive. IP Options are a
standard part of the Internet Protocol and can be enabled on any
packet. Like traceroute, RR reports IP addresses along an Internet
path from a source to a destination, but it offers several advantages
over traceroute. For example, RR can piece together hop-by-hop
the reverse path back from a destination [11], which is invisible to
traceroute and other traditional techniques; and it can uncover some
hops that do not respond to traceroute probes [20, 21].
However, RR has a number of limitations. It can only measure nine
hops, which may not suffice to measure a full route. Even routers
within that limit may drop or rate limit RR packets, or forward
them without recording an IP address, especially since IP Options
are processed on the slow path by a router’s resource-constrained
route processor [10]. In fact, a 2005 technical report found that 46%
of PlanetLab-to-PlanetLab paths dropped RR packets, leading the
report to be titled, “IP Options are not an option” [8].
While it is true that IP Options are not a great option for support-
ing end-to-end IP extensibility—the use case investigated by that
technical report—in this paper we revisit the suitability of the IP
Record Route Option as a measurement primitive for today’s Internet.
Specifically, we contribute the following results:
∙ Most pingable destinations respond to Record Route pings. Of
nearly 300,000 IP addresses—each in a different routable BGP
prefix—that responded to ICMP Echo Requests (pings), 75%
also responded to pings we sent with the RR Option. In total, we
received RR responses from destinations in 40,545 Autonomous
Systems (AS) (out of 49,100 for which we had destinations that
responded to pings) (§3.2)
∙ Most responsive destinations are within Record Route range of
our vantage points. Probing the destinations that respond to RR
pings from M-Lab and PlanetLab, two-thirds are within the nine
hop RR limit of at least one vantage point, and 60% are within the
eight hop limit necessary to measure reverse paths from them to
any host we control [11] (§3.3). Measurements from our vantage
points from 2011 and 2016 show that the number of destinations
within range is greater today than in the past (§3.4).
∙ The flattening Internet suggests that cloud providers can employ
Record Route to good effect. Large cloud and content providers
build out their backbones and peer broadly to bring their networks
and services close to end-users [3]. Our measurements suggest
IMC ’17, November 1–3, 2017, London, United Kingdom
Goodchild, et al.
that Google is within eight hops of 86% of destinations that
respond to RR pings; thus the IP Option can potentially solve
much of Google’s need to uncover the paths from end-users to
Google [13] (§3.6).
∙ Careful experiment design can increase RR response rates by
avoiding triggering rate limiting. We reduce the impact of rate
limiting and increase the response rate to RR probes by throttling
the probing rate of specific vantage points and limiting the initial
TTL of RR packets (§4.1, §4.2).
2 Motivation and Goal
Despite its drawbacks, Record Route has advantages over
traceroute. First, while traceroute measures one hop per packet,
RR allocates space in the header for nine IP addresses so that each
router can record an address as long as space remains. Because
RR can record nine routers traversed by a single packet in that
packet, RR can avoid artifacts that traceroute can introduce upon
encountering a load balancer [2]. Second, traceroute only measures
the forward path from source to destination, whereas RR data in an
ICMP Echo Request (ping) packet can be copied by the destination
into its ICMP Echo Reply packet, and any empty slots can be filled
on the reverse path from destination back to source. This mechanism
forms the basis of our reverse traceroute system that can measure the
reverse path back to any local host from a destination within range
of at least one local host [11]. Third, RR can capture some hops that
are invisible to traceroute, such as routers that do not decrement
TTL or routers inside tunnels with certain configurations [6, 22].
To be clear: RR is not a replacement for traceroute, rather it can
complement traceroute. The two tools can be used in combination
to augment our understanding of network topology, a topic both
explored in previous work [17, 20] and open to future study.
The conventional wisdom overemphasizes the drawbacks.
Based on informal conversations with colleagues, we believe that
the title of the 2005 technical report—“IP Options are not an
option”—led to the unintended interpretation that IP Options were
not a good option for measurement, even though the contents of the
report suggest the potential of RR for measurement [8]. The goal of
the report was to assess whether IP Options could be used to provide
IP extensibility, and the high fraction of paths that dropped Options
packets means that they are not a general vehicle for supporting
Internet-wide end-to-end functionality. However, the study also
found that, for 91% of the paths that dropped them, the drops
occurred at the source or destination AS.
Reinterpreting this result in a measurement context, a host that can
send RR packets without being filtered locally can likely reach most
destinations that support the Option. Further, even if the packets are
filtered somewhere along the path between the source and destina-
tion, they can potentially provide useful partial path measurements.
The drawbacks of Record Route may be diminishing as the In-
ternet evolves. Given this potential as a measurement tool, we be-
lieve that recent trends motivate the need to reevaluate support for
RR on the Internet. Increased peering means that parts of the Internet
such as clouds and colocation facilities may be more richly intercon-
nected [1, 3, 14]. Vantage points in or near these locations may be
able to reach many destinations within the nine hop limit of Record
Route. Large content and cloud providers have especially short paths
[3] and could use RR to measure the paths from end-users to their
networks [11], which is necessary to improve performance [13].
Goal: Given the demonstrated advantages of Record Route, we
reassess the coverage of Record Route support on today’s Internet.
Since some trends suggest that coverage may have improved over
time, we hope to show that Record Route is a widely-supported,
useful measurement primitive; present approaches to mitigate some
of its limitations; and thereby revise the conventional wisdom.
3 Results: Does The Internet Support Record
Route?
Our measurements (explained in §3.1) reveal that the answer is often
“yes.” The majority of destinations we probed respond to RR (§3.2),
a large fraction of these destinations are within RR’s 9 hop limit of
at least one of our vantage points (§3.3), and, over time, this fraction
has increased (§3.4). We find no evidence of ASes that systematically
forward packets without recording IP addresses (§3.5). Finally, the
interconnectivity of large cloud providers suggests that they could
achieve even better coverage with RR than our vantage points (§3.6).
3.1 Dataset, Methodology, and Terminology
The primary dataset we used for investigating the usefulness of
Record Route is composed of results from two measurement stud-
ies.1Each study sent probes to the same destination set that included
1 IP address in each advertised BGP prefix collected by RouteViews
on September 24, 2016[19]. For each prefix, the set includes the
address that was most responsive to previous ping probes [7]. We
conducted the first study during September 24–25, 2016 and sent one
ping with the Record Route Option (henceforth: ping-RR) from
141 vantage points (VPs). The VPs included one randomly chosen
machine at each operational PlanetLab (55) and M-Lab (86) site.
We conducted the second study in early October 2016 and sent three
pings (without any IP Options enabled) to each destination from one
machine at USC. Both studies used scamper [15] to send probes
and sent 20 probes per second per machine. Section 4.1 explores the
impact of probing rate.
We classify a destination as ping-responsive if we received a response
to at least one of the three normal pings. We classify a destination as
RR-responsive if at least one VP received a response to its ping-RR.
A RR-responsive destination responds to a ping-RR with an ICMP
Echo Reply that copies the Record Route option with any recorded
IP addresses into the header of its response. We define a destination
as RR-reachable from a given VP if a ping-RR sent from the VP
arrives at the destination with empty slots available in the RR header.
Sometimes, we refer to a destination as RR-reachable from our set
of VPs, meaning that it is RR-reachable from at least one VP. For
our analyses, we test if a destination is RR-reachable by observing
if the destination IP address appears in the RR response header. This
1All datasets and tools used in this study have been made publicly available at:
https://www.measurementlab.net/publications/#the-record-route-option-is-an-option
The Record Route Option is an Option!
IMC ’17, November 1–3, 2017, London, United Kingdom
By IP
All Probed
Ping Responsive
RR-Responsive
All Probed
By AS Ping Responsive
RR-Responsive
Total
510,305 (100%)
394,644 (77%)
296,734 (58%)
51,920 (100%)
49,100 (95%)
40,545 (78%)
Transit/Access
388,959 (100%)
296,011 (76%)
225,000 (58%)
19,888 (100%)
19,282 (97%)
17,250 (87%)
Enterprise
61,204 (100%)
51,579 (84%)
34,917 (57%)