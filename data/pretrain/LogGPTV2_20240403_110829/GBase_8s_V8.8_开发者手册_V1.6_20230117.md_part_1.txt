GBase 8s
开发者手册
GBase 8s V8.8开发者手册
GBase8s 开发者手册，南大通用数据技术股份有限公司
GBase 版权所有©2022，保留所有权利
版权声明
本文档所涉及的软件著作权及其他知识产权已依法进行了相关注册、登记，由南大通用数据
技术股份有限公司合法拥有，受《中华人民共和国著作权法》、《计算机软件保护条例》、
《知识产权保护条例》和相关国际版权条约、法律、法规以及其它知识产权法律和条约的保
护。未经授权许可，不得非法使用。
免责声明
本文档包含的南大通用数据技术股份有限公司的版权信息由南大通用数据技术股份有限公
司合法拥有，受法律的保护，南大通用数据技术股份有限公司对本文档可能涉及到的非南大
通用数据技术股份有限公司的信息不承担任何责任。在法律允许的范围内，您可以查阅，并
仅能够在《中华人民共和国著作权法》规定的合法范围内复制和打印本文档。任何单位和个
人未经南大通用数据技术股份有限公司书面授权许可，不得使用、修改、再发布本文档的任
何部分和内容，否则将视为侵权，南大通用数据技术股份有限公司具有依法追究其责任的权
利。
本文档中包含的信息如有更新，恕不另行通知。您对本文档的任何问题，可直接向南大通用
数据技术股份有限公司告知或查询。
未经本公司明确授予的任何权利均予保留。
通讯方式
南大通用数据技术股份有限公司
天津市高新区华苑产业园区开华道22号普天创新园东塔20-23层(300384)
电话：400-013-9696 邮箱：PI:EMAIL
商标声明
是南大通用数据技术股份有限公司向中华人民共和国国家商标局申请注册
的注册商标，注册商标专用权由南大通用数据技术股份有限公司合法拥有，受法律保护。未
经南大通用数据技术股份有限公司书面许可，任何单位及个人不得以任何方式或理由对该商
标的任何部分进行使用、复制、修改、传播、抄录或与其它产品捆绑使用销售。凡侵犯南大
通用数据技术股份有限公司商标权的，南大通用数据技术股份有限公司将依法追究其法律责
任。
南大通用数据技术股份有限公司
I
GBase 8s V8.8开发者手册
目 录
目 录..................................................................... II
1 文档简介................................................................... 1
1.1 概述..........................................................................................................................................1
1.2 读者对象.................................................................................................................................1
1.3 文档阅读约定.........................................................................................................................1
2 概述....................................................................... 3
2.1 数据库逻辑结构图.................................................................................................................3
2.2 数据查询请求处理过程.........................................................................................................4
2.3 管理事务.................................................................................................................................4
2.3.1 事务控制............................................................ 4
2.3.2 事务隔离级别........................................................ 5
2.4 相关概念.................................................................................................................................6
2.4.1 数据库.............................................................. 6
2.4.2 表空间.............................................................. 6
2.4.3 模式................................................................ 6
2.4.4 用户和角色.......................................................... 6
2.4.5 事务管理............................................................ 6
3 数据库使用................................................................. 7
3.1 概述..........................................................................................................................................7
3.2 连接数据库.............................................................................................................................9
3.2.1 确认连接信息....................................................... 10
3.2.2 配置服务端远程连接................................................. 10
3.2.3 使用gsql连接.......................................................12
3.2.3.1 本地连接数据库..................................................12
南大通用数据技术股份有限公司
II
GBase 8s V8.8开发者手册
3.2.3.2 远程连接数据库..................................................13
3.2.4 应用程序接口....................................................... 15
3.3 创建和管理数据库...............................................................................................................15
3.4 规划存储模型.......................................................................................................................17
3.4.1 行存表............................................................. 19
3.4.2 列存表............................................................. 19
3.4.3 行存表和列存表的选择............................................... 19
3.5 创建和管理表空间...............................................................................................................20
3.6 创建和管理表.......................................................................................................................23
3.6.1 创建表............................................................. 23
3.6.2 向表中插入数据..................................................... 24
3.6.3 更新表中数据....................................................... 27
3.6.4 查看数据........................................................... 28
3.6.5 删除表中数据....................................................... 28
3.7 查看系统表...........................................................................................................................29
3.7.1 查看数据库中包含的表............................................... 29
3.7.2 查看数据库用户..................................................... 30
3.7.3 查看和停止正在运行的查询语句....................................... 30
3.8 其他操作...............................................................................................................................32
3.8.1 创建和管理schema...................................................32
3.8.2 创建和管理表....................................................... 35
3.8.3 创建和管理索引..................................................... 38
3.8.4 创建和管理视图..................................................... 43
3.8.5 创建和管理序列..................................................... 44
4 开发设计建议.............................................................. 45
4.1 开发设计建议概述...............................................................................................................45
南大通用数据技术股份有限公司
III
GBase 8s V8.8开发者手册
4.2 数据库对象命名...................................................................................................................45
4.3 数据库对象设计...................................................................................................................47
4.3.1Database和Schema设计.............................................. 47
4.3.2 表设计............................................................. 48
4.3.3 字段设计........................................................... 50
4.3.4 约束设计........................................................... 51
4.3.5 视图和关联表设计................................................... 52
4.4 工具对接...............................................................................................................................52
4.4.1JDBC配置.......................................................... 52
4.5SQL编写................................................................................................................................54
5 最佳实践.................................................................. 58
5.1 表设计最佳实践...................................................................................................................58
5.1.1 选择存储模型....................................................... 58
5.1.2 使用局部聚簇....................................................... 59
5.1.3 使用分区表......................................................... 59
5.1.4 选择数据类型....................................................... 60
5.2 导入最佳实践.......................................................................................................................60
5.3SQL查询最佳实践................................................................................................................61
6 应用程序开发教程.......................................................... 63
6.1 开发规范...............................................................................................................................63
6.2 基于JDBC开发....................................................................................................................63
6.2.1JDBC包、驱动类和环境类............................................ 64
6.2.2 开发流程........................................................... 65
6.2.3 加载驱动........................................................... 65
6.2.4 连接数据库......................................................... 66
6.2.5 连接数据库（以SSL方式）...........................................73
南大通用数据技术股份有限公司
IV
GBase 8s V8.8开发者手册
6.2.6 执行SQL语句...................................................... 76
6.2.6.1 执行普通SQL................................................... 76
6.2.6.2 执行预编译SQL语句.............................................77
6.2.6.3 调用存储过程....................................................77
6.2.6.4Oracle 兼容模式启用重载时，调用存储过程..........................79
6.2.6.5 执行批处理......................................................80
6.2.7 处理结果集......................................................... 81
6.2.8 关闭连接........................................................... 83
6.2.9 日志管理........................................................... 83
6.2.10JDBC接口参考..................................................... 88
6.3 基于ODBC开发..................................................................................................................88
6.3.1ODBC 包及依赖的库和头文件......................................... 89
6.3.2Linux下配置数据源.................................................. 89
6.3.3 开发流程........................................................... 98
6.3.4 示例：常用功能和批量绑定.......................................... 100
6.3.5 典型应用场景配置.................................................. 107
6.3.6ODBC接口参考.....................................................118
6.4 基于libpq开发...................................................................................................................118
6.4.1libpq使用依赖的头文件..............................................118
6.4.2 开发流程.......................................................... 118
6.4.3 常用功能示例代码.................................................. 119
6.4.4libpq接口参数......................................................123
6.4.5 链接参数.......................................................... 123
6.5 基于Psycopg开发..............................................................................................................128
6.5.1Psycopg包......................................................... 128
6.5.2 开发流程.......................................................... 129
南大通用数据技术股份有限公司
V
GBase 8s V8.8开发者手册
6.5.3 加载驱动.......................................................... 129
6.5.4 连接数据库........................................................ 129
6.5.5 执行SQL语句..................................................... 130
6.5.6 处理结果集........................................................ 130
6.5.7 关闭连接.......................................................... 130
6.5.8 连接数据库（SSL方式）............................................ 130
6.5.9 示例：常用操作.................................................... 131
6.5.10Psycopg接口参考.................................................. 132
6.6 调试......................................................................................................................................132
7 管理数据库安全........................................................... 136
7.1 客户端接入认证.................................................................................................................136
7.1.1 配置客户端接入认证................................................ 136
7.1.2 配置文件参考...................................................... 139
7.1.3 用SSL进行安全的TCP/IP连接.......................................143
7.1.4 用SSH隧道进行安全的TCP/IP连接.................................. 149
7.1.5 查看数据库连接数.................................................. 150
7.1.6SSL证书管理.......................................................153
7.1.6.1 证书生成.......................................................153
7.1.6.2 证书替换.......................................................158
7.2 管理用户及权限.................................................................................................................159
7.2.1 默认权限机制...................................................... 159
7.2.2 管理员............................................................ 160
7.2.3 三权分立.......................................................... 162
7.2.4 用户.............................................................. 164
7.2.5 角色.............................................................. 165
7.2.6Schema............................................................ 168
南大通用数据技术股份有限公司
VI
GBase 8s V8.8开发者手册
7.2.7 用户权限设置...................................................... 169
7.2.8 行级访问控制...................................................... 170
7.2.9 设置安全策略...................................................... 172
7.2.9.1 设置账户安全策略...............................................172
7.2.9.2 设置账号有效期.................................................175
7.2.9.3 设置密码安全策略...............................................176
7.3 设置数据库审计.................................................................................................................184
7.3.1 审计概述.......................................................... 184
7.3.2 查看审计结果...................................................... 189
7.3.3 维护审计日志...................................................... 191
7.3.4 设置文件权限安全策略.............................................. 194
7.3.5 统一审计策略概述.................................................. 195
7.4 设置密态等值查询.............................................................................................................196
7.4.1 密态等值查询概述.................................................. 196
7.4.2 使用gsql操作密态数据库............................................196
7.4.3 使用JDBC操作密态数据库.......................................... 198
7.4.4 密态支持函数/存储过程..............................................201
7.5 设置账本数据库.................................................................................................................203
7.5.1 账本数据库概述.................................................... 203
7.5.2 查看账本历史操作记录.............................................. 205
7.5.3 校验账本数据一致性................................................ 208
7.5.4 归档账本数据库.................................................... 209
7.5.5 修复账本数据库.................................................... 210
8 接口参考................................................................. 212
8.1JDBC.....................................................................................................................................212
8.1.1java.sql.Connection...................................................212
南大通用数据技术股份有限公司
VII
GBase 8s V8.8开发者手册
8.1.2java.sql.CallableStatement............................................. 215
8.1.3java.sql.DatabaseMetaData.............................................217
8.1.4java.sql.Driver.......................................................227
8.1.5java.sql.PreparedStatement.............................................228
8.1.6java.sql.ResultSet.................................................... 231
8.1.7java.sql.ResultSetMetData............................................. 238
8.1.8java.sql.Statement....................................................240
8.1.9javax.sql.ConnectionPoolDataSource.....................................242
8.1.10javax.sql.DataSource.................................................243
8.1.11javax.sql.PooledConnection........................................... 243
8.1.12javax.naming.Context................................................244
8.1.13javax.naming.spi.InitialContextFactory.................................. 244
8.1.14CopyManager...................................................... 244
8.1.15PGReplicationConnection.............................................246
8.2ODBC...................................................................................................................................246
8.2.1SQLAllocEnv....................................................... 246
8.2.2SQLAllocConnect....................................................247
8.2.3SQLAllocHandle.....................................................247
8.2.4SQLAllocStmt.......................................................248
8.2.5SQLBindCol........................................................ 248
8.2.6SQLBindParameter...................................................249
8.2.7SQLColAttribute.....................................................251
8.2.8SQLConnect........................................................ 252
8.2.9SQLDisconnect......................................................253
8.2.10SQLExecDirect.....................................................254
8.2.11SQLExecute....................................................... 255
南大通用数据技术股份有限公司
VIII
GBase 8s V8.8开发者手册
8.2.12SQLFetch......................................................... 257
8.2.13SQLFreeStmt.......................................................257
8.2.14SQLFreeConnect....................................................258
8.2.15SQLFreeHandle.....................................................258
8.2.16SQLFreeEnv.......................................................259
8.2.17SQLPrepare........................................................259
8.2.18SQLGetData....................................................... 260
8.2.19SQLGetDiagRec....................................................261
8.2.20SQLSetConnectAttr................................................. 263
8.2.21SQLSetEnvAttr.....................................................264
8.2.22SQLSetStmtAttr.................................................... 265
8.2.23 示例............................................................. 267
8.3libpq......................................................................................................................................273
8.3.1 数据库连接控制函数................................................ 273
8.3.1.1PQconnectdbParams.............................................. 274
8.3.1.2PQconnectdb.................................................... 274
8.3.1.3PQconninfoParse................................................. 275
8.3.1.4PQconnectStart...................................................276
8.3.1.5PQerrorMessage..................................................276
8.3.1.6PQsetdbLogin....................................................277
8.3.1.7PQfinish........................................................278
8.3.1.8PQreset.........................................................278
8.3.1.9PQstatus........................................................279
8.3.2 数据库执行语句函数................................................ 280
8.3.2.1PQclear.........................................................280
8.3.2.2PQexec.........................................................281
南大通用数据技术股份有限公司
IX
GBase 8s V8.8开发者手册
8.3.2.3PQexecParams...................................................282
8.3.2.4PQexecParamsBatch.............................................. 282
8.3.2.5PQexecPrepared..................................................283