configuration on your operating system, as the configuration might be different.
• You should also review your OS manuals (for example, the man page for pthread_create) for
more details on resource issues and tuning resource limits, and ensure that the resource limits
are appropriately configured.
• You should also check if the system is running short of resources, both memory and CPU.
Problems in creating shared memory
Error : shmget fails with error number 28(ENOSPC)
| Probe Id :- XY132002 |
| Component :- xstCreateExtent |
| ProjectID :- 0 |
| Probe Description :- AMQ6119: An internal IBM MQ error has occurred |
| (Failed to get memory segment: shmget(0x00000000, 2547712) [rc=-1 |
| errno=28] No space left on device) |
| FDCSequenceNumber :- 0 |
| Arith1 :- 18446744073709551615 (0xffffffffffffffff) |
| Arith2 :- 28 (0x1c) |
| Comment1 :- Failed to get memory segment: shmget(0x00000000, |
| 2547712) [rc=-1 errno=28] No space left on device |
| Comment2 :- No space left on device |
+-----------------------------------------------------------------------------+
MQM Function Stack
ExecCtrlrMain?
xcsAllocateMemBlock
xstExtendSet
xstCreateExtent
xcsFFST
shmget fails with error number 22(EINVAL)
| Operating System :- SunOS 5.10 |
| Probe Id :- XY132002 |
| Application Name :- MQM |
| Component :- xstCreateExtent |
| Program Name :- amqzxma0 |
| Major Errorcode :- xecP_E_NO_RESOURCE |
| Probe Description :- AMQ6024: Insufficient resources are available to |
| complete a system request. |
| FDCSequenceNumber :- 0 |
| Arith1 :- 18446744073709551615 (0xffffffffffffffff) |
| Arith2 :- 22 (0x16) |
| Comment1 :- Failed to get memory segment: shmget(0x00000000, |
| 9904128) [rc=-1 errno=22] Invalid argument |
| Comment2 :- Invalid argument |
| Comment3 :- Configure kernel (for example, shmmax) to allow a |
| shared memory segment of at least 9904128
bytes |
+-----------------------------------------------------------------------------+
MQM Function Stack
ExecCtrlrMain
zxcCreateECResources
zutCreateConfig
40 Troubleshooting and Support for IBM MQ
xcsInitialize
xcsCreateSharedSubpool
xcsCreateSharedMemSet
xstCreateExtent
xcsFFST
Unexpected process termination and queue manager crash, or queue manager crash
Process ending unexpectedly followed by FDCs from amqzxma0
Example FDC:
Date/Time :- Mon May 02 2016 01:00:58 CEST
Host Name :- test.ibm.com
LVLS :- 8.0.0.4
Product Long Name :- IBM MQ for Linux (x86-64 platform)
Probe Id :- XC723010
Component :- xprChildTermHandler
Build Date :- Oct 17 2015
Build Level :- p800-004-151017
Program Name :- amqzxma0
Addressing mode :- 64-bit
Major Errorcode :- xecP_E_USER_TERM
Minor Errorcode :- OK
Probe Description :- AMQ6125: An internal IBM MQ error has occurred.
Possible Causes and Solutions
• Check if the user has ended any process.
• Check if the IBM MQ process ended because of a memory exception:
– Did the process end with an FDC of Component :- xehExceptionHandler?
– Apply the fix for known issues corrected in this area.
• Check if the operating system ended the process because of high memory usage by the process:
– Has the IBM MQ process consumed lot of memory?
– Has the operating system ended the process?
Review the operating system log. For example, the OOM-killer on Linux:
Jan 2 01:00:57 ibmtest kernel:
amqrmppa invoked oom-killer: gfp_mask=0x201da, order=0, oom_score_adj=0)
– Apply the fix for known memory leak issues.
Difference in user limits used by a process against the configured limits
The user limits used by the process might be different from the configured limits. This is likely to happen
if the process is started by a different user, or by user scripts, or a high availability script for example. It is
important that you to check the user who is starting the queue manager, and set the appropriate resource
limits for this user.
Related tasks
“Identifying characteristics of the problem on Linux” on page 30
Some initial questions to consider to help with identifying the cause of the problem.
“Determining problems with applications, commands and messages on Linux” on page 34
If you encounter problems with IBM MQ applications, commands, and messages, there are a number of
questions that you can consider to help you to determine the cause of the problem.
“Contacting IBM Support” on page 301
IBM MQ troubleshooting and support 41
If you need help with a problem that you are having with IBM MQ, you can contact IBM Support through
the IBM Support Site. You can also subscribe to notifications about IBM MQ fixes, troubleshooting, and
other news.
Making initial checks on Windows
Before you start problem determination in detail on Windows, consider whether there is an obvious cause
of the problem, or an area of investigation that is likely to give useful results. This approach to diagnosis
can often save a lot of work by highlighting a simple error, or by narrowing down the range of possibilities.
About this task
The cause of your problem could be in:
• IBM MQ
• The network
• The application
• Other applications that you have configured to work with IBM MQ
As you go through the list of initial questions to consider and follow the links to more information, make a
note of anything that might be relevant to the problem. Even if your observations do not suggest a cause
straight away, they might be useful later if you have to carry out a systematic problem determination
exercise.
When you open a case with IBM, you can include additional IBM MQ troubleshooting information
(MustGather data) that you have collected to help with investigating the problem. For more information,
see “Collecting troubleshooting information for IBM Support” on page 302.
Procedure
1.Identify characteristics of the problem
There are some initial questions that you can consider to help you to identify the cause of the problem:
• Has IBM MQ run successfully before?
• Have any changes been made since the last successful run?
• Have you applied any maintenance updates?
• Has the application run successfully before?
• Are you receiving errors when you use special characters in descriptive text for some commands?
• Are there any error messages or return codes to help you to determine the location and cause of your
problem?
• Can you reproduce the problem?
• Does the problem affect specific parts of the network?
• Does the problem occur at specific times of the day?
• Is the problem intermittent?
2.Investigate potential problems with applications, commands and messages
If you encounter problems with IBM MQ applications, commands, and messages, there are a number
of questions that you can consider to help you to determine the cause of the problem:
• Are messages failing to arrive on the queue?
• Do messages contain unexpected or corrupted information?
• Are unexpected messages received when using distributed queues?
• Have you received no response from a PCF command?
• Are only some of your queues failing?
• Does the problem affect only remote queues?
42 Troubleshooting and Support for IBM MQ
• Are you receiving an error code when creating or starting a queue manager on Windows?
• Is your application or system running slowly?
3.If you need further information to help you with identifying the cause of the problem, see “Detailed
troubleshooting” on page 64.
Related tasks
“Contacting IBM Support” on page 301
If you need help with a problem that you are having with IBM MQ, you can contact IBM Support through
the IBM Support Site. You can also subscribe to notifications about IBM MQ fixes, troubleshooting, and
other news.
“Making initial checks on AIX” on page 7
Before you start problem determination in detail on AIX, consider whether there is an obvious cause of
the problem, or an area of investigation that is likely to give useful results. This approach to diagnosis can
often save a lot of work by highlighting a simple error, or by narrowing down the range of possibilities.
“Making initial checks on IBM i” on page 20
Before you start problem determination in detail on IBM i, consider whether there is an obvious cause of
the problem, or an area of investigation that is likely to give useful results. This approach to diagnosis can
often save a lot of work by highlighting a simple error, or by narrowing down the range of possibilities.
“Making initial checks on Linux” on page 29
Before you start problem determination in detail on Linux, consider whether there is an obvious cause of
the problem, or an area of investigation that is likely to give useful results. This approach to diagnosis can
often save a lot of work by highlighting a simple error, or by narrowing down the range of possibilities.
“Making initial checks on z/OS” on page 51
Before you start problem determination in detail on z/OS, consider whether there is an obvious cause of
the problem, or an area of investigation that is likely to give useful results. This approach to diagnosis can
often save a lot of work by highlighting a simple error, or by narrowing down the range of possibilities.
Related reference
Messages and reason codes
Identifying characteristics of the problem on Windows
Some initial questions to consider to help with identifying the cause of the problem.
About this task
Use the following questions as pointers to help you to identify the cause of the problem:
• Has IBM MQ run successfully before?
• Have any changes been made since the last successful run?
• Have you applied any maintenance updates?
• Has the application run successfully before?
• Are you receiving errors when you use special characters in descriptive text for some commands?
• Are there any error messages or return codes to help you to determine the location and cause of your
problem?
• Can you reproduce the problem?
• Does the problem affect specific parts of the network?
• Does the problem occur at specific times of the day?
• Is the problem intermittent?
As you go through the list, make a note of anything that might be relevant to the problem. Even if your
observations do not suggest a cause straight away, they might be useful later if you need to carry out a
systematic problem determination exercise.
IBM MQ troubleshooting and support 43
When you open a case with IBM, you can include additional IBM MQ troubleshooting information
(MustGather data) that you have collected to help with investigating the problem. For more information,
see “Collecting troubleshooting information for IBM Support” on page 302.
Procedure
1.Has IBM MQ run successfully before?
If IBM MQ has not run successfully before, it is likely that you have not yet set it up correctly.
For more information, see IBM MQ installation overview and Installing and uninstalling IBM MQ on
Windows.
To run the verification procedure, see Verifying an IBM MQ installation on Windows. Also look at
Configuring IBM MQ for information about post-installation configuration of IBM MQ.
2.Have any changes been made since the last successful run?
Changes that have been made to your IBM MQ configuration, or changes to other applications that
interact with IBM MQ could be the cause of your problem.
When you are considering changes that might recently have been made, think about the IBM
MQ system, and also about the other programs it interfaces with, the hardware, and any new
applications. Consider also the possibility that a new application that you are not aware of might
have been run on the system.
• Have you changed, added, or deleted any queue definitions?
• Have you changed or added any channel definitions? Changes might have been made to either IBM
MQ channel definitions or any underlying communications definitions required by your application.
• Do your applications deal with return codes that they might get as a result of any changes you have
made?
• Have you changed any component of the operating system that might affect the operation of IBM
MQ? For example, have you modified the Windows Registry.
3.Have you applied any maintenance updates?
If you have applied a maintenance update to IBM MQ, check that the update action completed
successfully and that no error message was produced.
• Did the update have any special instructions?
• Was any test run to verify that the update was applied correctly and completely?
• Does the problem still exist if IBM MQ is restored to the previous maintenance level?
• If the installation was successful, check with IBM Support for any maintenance package errors.
• If a maintenance package has been applied to any other application, consider the effect it might
have on the way IBM MQ interfaces with it.
4.Has the application run successfully before?
If the problem appears to involve one particular application, consider whether the application has run
successfully before:
• Have any changes been made to the application since it last ran successfully?
If so, it is likely that the error lies somewhere in the new or modified part of the application. Take a
look at the changes and see if you can find an obvious reason for the problem. Is it possible to retry
using a back level of the application?
• Have all the functions of the application been fully exercised before?
Could it be that the problem occurred when part of the application that had never been invoked
before was used for the first time? If so, it is likely that the error lies in that part of the application.
Try to find out what the application was doing when it failed, and check the source code in that
part of the program for errors. If a program has been run successfully on many previous occasions,
check the current queue status and the files that were being processed when the error occurred.
44 Troubleshooting and Support for IBM MQ
It is possible that they contain some unusual data value that invokes a rarely-used path in the
program.
• Does the application check all return codes?
Has your IBM MQ system been changed, perhaps in a minor way, such that your application does
not check the return codes it receives as a result of the change. For example, does your application
assume that the queues it accesses can be shared? If a queue has been redefined as exclusive, can
your application deal with return codes indicating that it can no longer access that queue?
• Does the application run on other IBM MQ systems?
Could it be that there is something different about the way that this IBM MQ system is set up that is
causing the problem? For example, have the queues been defined with the same message length or
priority?
Before you look at the code, and depending on which programming language the code is written
in, examine the output from the translator, or the compiler and linkage editor, to see if any errors
have been reported. If your application fails to translate, compile, or link-edit into the load library, it
will also fail to run if you attempt to invoke it. For information about building your application, see
Developing applications.
If the documentation shows that each of these steps was accomplished without error, consider the
coding logic of the application. Do the symptoms of the problem indicate the function that is failing
and, therefore, the piece of code in error? The errors in the following list illustrate the most common
causes of problems encountered while running IBM MQ programs. Consider the possibility that the
problem with your IBM MQ system could be caused by one or more of these errors:
• Assuming that queues can be shared, when they are in fact exclusive.
• Passing incorrect parameters in an MQI call.
• Passing insufficient parameters in an MQI call. This might mean that IBM MQ cannot set up
completion and reason codes for your application to process.
• Failing to check return codes from MQI requests.
• Passing variables with incorrect lengths specified.
• Passing parameters in the wrong order.
• Failing to initialize MsgId and CorrelId correctly.
• Failing to initialize Encoding and CodedCharSetId following
MQRC_TRUNCATED_MSG_ACCEPTED.
5.Are you receiving errors when you use special characters in descriptive text for some commands?
Some characters, for example, backslash (\) and double quote (") characters have special meanings
when used with commands.
Precede special characters with a \, that is, enter \\ or \" if you want \ or " in your text. Not
all characters are allowed to be used with commands. For more information about characters with
special meanings and how to use them, see Characters with special meanings.
6.Are there any error messages or return codes to help you to determine the location and cause of your
problem?
IBM MQ uses error logs to capture messages concerning its own operation, any queue managers that
you start, and error data coming from the channels that are in use. Check the error logs to see if
any messages have been recorded that are associated with your problem. For information about the
locations and contents of the error logs, see “Error logs on AIX, Linux, and Windows” on page 355.
IBM MQ also logs errors in the Windows Application Event Log. On Windows, check if the Windows
Application Event Log shows any IBM MQ errors. To open the log, from the Computer Management
panel, expand Event Viewer and select Application.
For each IBM MQ Message Queue Interface (MQI) and IBM MQ Administration Interface (MQAI) call,
a completion code and a reason code are returned by the queue manager or by an exit routine, to
indicate the success or failure of the call. If your application gets a return code indicating that a
Message Queue Interface (MQI) call has failed, check the reason code to find out more about the
IBM MQ troubleshooting and support 45
problem. For a list of reason codes, see API completion and reason codes. Detailed information on
return codes is contained within the description of each MQI call.
7.Can you reproduce the problem?
If you can reproduce the problem, consider the conditions under which it is reproduced:
• Is it caused by a command or an equivalent administration request? Does the operation work if it
is entered by another method? If the command works if it is entered on the command line, but not
otherwise, check that the command server has not stopped, and that the queue definition of the