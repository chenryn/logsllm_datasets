allocations. Unfortunately, this list contains many questionable
sub-allocations, since it contains many sub-allocations hosting
adult and copyright infringing websites. Next, we use a list of
the top 500 hosting providers and search Whois to ﬁnd their
corresponding sub-allocations. We further split the list into the
top 100 and top 500 hosting providers to reduce false positives.
Additionally, we search the SpamHaus ISP [28] reputation data
base for these top 500 hosting providers and if a hit is found,
we label it as “Clean - Noisy”.
Finding malicious sub-allocations. Next, we tackle the issue
of ﬁnding malicious sub-allocations using a blacklist and
through directly contacting and purchasing hosting packages
from BPH services. We use two of SpamHaus’s lists: Edrop
[14], explained earlier, is manually maintained and thus its
coverage is quite limited as it includes only 101 IP preﬁxes in
a 9-month collection period. As such, we complement it with
another slightly noisier list, ROKSO. SpamHaus maintains
a Register Of Known Spam Operations (ROKSO) [26] and
their actors by collecting an excessive amount of information
identifying them, evidence such as websites of their opera-
tion and even some of their contact information, e.g. ICQ
numbers. Incidentally, some of the actors listed are running
BPH services. Within ROKSO, we ﬁnd 10 BPH actors (out of
110) and are able to contact two of them. More speciﬁcally,
we contacted the actor named “MailTrain” 5 through the ICQ
number listed by ROKSO and purchased a server with 1 IP (to
be used for botnets and spam) for $186. Additionally, ROKSO
keeps track of the IP address preﬁxes used by the actors with
two types of listings: current and archived. A current listing
indicates that the IP address preﬁx has not been cleaned and is
still used by the actor while an archived listing indicates that
the IP address preﬁx is not used by the actor anymore. On
July 6th 2016, we scanned the ROKSO list and collected both
current and archived listings for each actor. Using the current
listings, on July 12th 2016 we searched Whois for the sub-
allocations matching all the listed IP address preﬁxes while
partial matches were not considered. For the archived listings,
we searched Whois but selected only the sub-allocations that
were created or modiﬁed at most 10 days before the archiving
date. These 10 days are used to account for the gap between
ROKSO de-listing and a Whois record update. However, the
resulting sub-allocations from archived listings are noisier than
current listings, since it is dependent on an update of Whois
records.
Purchasing from BPH services. Lastly, we scan underground
forums for posts advertising BPH services and contact them
for purchasing. Some of the BPH services have operational
websites (although short-lived) to sell their services, as shown
in Figures 2 (& 14 in Appendix). Other BPH services can only
be contacted via ICQ [29] or Jabber [30] and most only accept
digital currency, such as Bitcoin. Not all of our purchasing
attempts were successful, some failed due to them suspecting
that we were white hats because of language barriers. More
speciﬁcally, in one of our purchase attempts with a Russian
BPH service, which we conducted through ICQ, we were asked
a few investigatory questions such as how we heard about them
and why we cannot speak Russian. We proceeded as far as
sending them a Bitcoin payment but within a few minutes, we
received a message refusing to sell to us with a reimbursement
of our payment because they believed we were white hats.
Additionally, while attempting to purchase, we always asked
for test IP addresses ﬁrst. If they provided us with test IP
addresses we did not proceed with the purchase. We bought a
few of each of three hosting packages: shared hosting, virtual
private servers (VPSs) and dedicated servers. Additionally, we
purchased Fast Fluxing (FF) services from a few providers.
The details of our purchases are described in Table V. Many
of our collected IP addresses were linked to direct allocations
and/or BP ASes. In total, we spent $1,155 and collected 37 IP
addresses corresponding to 21 sub-allocations. Unfortunately,
we cannot label many of the full sub-allocations found through
the purchases as malicious since we only acquired one IP
address from a BPH service. For example, one of our purchases
resulted in a sub-allocation owned by Amazon which cannot
be labeled as malicious based upon a single instance they gave
5https://www.spamhaus.org/rokso/spammer/spm806/mailtrain
811
Authorized licensed use limited to: IEEE Xplore. Downloaded on March 18,2021 at 12:21:58 UTC from IEEE Xplore.  Restrictions apply. 
Label
Clean - Noisy
Clean
Clean - Noisy
Clean
Clean - Noisy
Malicious
Source
Alexa[4]
Top 100
Hosters[5]
Top 500
Hosters[5]
Edrop[14]
ROKSO[26] Malicious - Current
Malicious - Archived
Purchased
Malicious - Noisy
Size
2,238 sub-allocations
67 sub-allocations
751 sub-allocations
112 sub-allocations
43 sub-allocations
15 sub-allocations
876 sub-allocations
862 sub-allocations
21 sub-allocations
Set-A?
-
(cid:2)
-
(cid:2)
-
(cid:2)
(cid:2)
-
-
Set-B?
-
(cid:2)
(cid:2)
-
-
(cid:2)
(cid:2)
-
-
TABLE IV: Collected ground truth data set. Sets A and B are the
experimental sets we used to train the classiﬁer. Note, the sizes of each
set reﬂect the size after going through the ﬁltering process explained
later in Section III-D.
Fig. 7: Example of a partial hierarchy network tree showing 4
sub-allocations. Each node contains a network block preﬁx and an
owner name. The dashed out sub-allocation indicates de-listing from
the most recent snapshot of Whois. Sub-allocations with bold pink
borders are the ones selected in the ﬁltering process.
to us. As such, we did not use these resulting sub-allocations
to train our classiﬁer but rather for testing and validation.
D. Data Processing
In this subsection, we elaborate on how we process the
Whois records to ﬁnd sub-allocations, their owners and select
targeted sub-allocations, and most importantly, select the right
features to ﬁnd the most relevant signals of malicious sub-
allocations. These features are then used to train a classiﬁer
for detecting such BPHs (Section IV).
Finding
sub-allocations. The downloaded Whois bulk
databases of inetnum objects (i.e. network blocks) do not
include the parent network blocks of an inetnum object, except
for the ARIN registry. Also,
the “status” attribute in the
inetnum object should typically indicate the allocation type
but setting the value of the attribute correctly depends solely
on the service provider who registers sub-allocations with a
registry. Furthermore, each registry has different values for the
status, each indicating a certain type of allocation. As such,
we determine sub-allocations by building a hierarchy network
tree for each network block, which enables us to capture all
the parent levels of a given network block (inetnum). Once
a hierarchy tree is generated, a network block is considered
to be a sub-allocation if it has a parent. Table VI lists the
sub-allocations generated through this process.
Identifying sub-allocations owners. We consider a sub-
allocation owner to be an owner object containing the contact
information speciﬁc to the sub-allocation but not its parent. To
generate an owner object for a given sub-allocation, we collect
identity-speciﬁc attributes such as names, emails, the email’s
FQDNs, street addresses, phone numbers of the inetnum and
its connected organizations and person(s). Then, we cross-
match it with the owner objects of all of its parents and
drop the matched values from the object. If the remaining
attributes of the owner object contain at least an email or
an organization’s key, name or person, then the owner object
is accepted. Otherwise the sub-allocation is considered not
to have an owner (i.e. it is managed by its parent network)
because its contact information cannot be found in Whois.
To capture the resellers switching or spanning across
multiple service providers and registries by creating numerous
person and organization objects, we further merge the created
owner objects using strong attribute values that cannot be
shared by 2 different entities such as emails (and their FQDNs)
and organization names and keys. The resulting daily sub-
allocations with/out owners are shown in Table VI.
Further, emails and their FQDNs are treated carefully.
FQDNs of popular portals such as GMAIL are not considered
(since they are clearly too general), in which case the full
email is used instead of its FQDN. Additionally, many service
providers allocating sub-allocations would include an email
(or FQDN) representing a network administrator or an account
manager and as such cannot be considered related to owners.
To avoid this, we drop the top 5% of all emails showing
up in Whois objects. It is worth noting here that this owner
generation process is used for analysis purposes later on in
Section V and is not considered in the feature selection process
of the classiﬁer and as such has no impact on the correctness
or accuracy of the classiﬁer.
Filtering sub-allocations. Once sub-allocations are created,
we select sub-allocations exhibiting hosting behaviors. More
speciﬁcally, we select sub-allocations that are hosting more
than 10 TLD+36 and are utilizing more than 25% of the
network block according to data collected from PDNS. These
two thresholds are set using the average values found in the
labeled Top 500 hosting providers [5], as described earlier
in Section III-B. Additionally, only leaf sub-allocations are
selected because otherwise, the features of sub-allocations’
children will incorrectly propagate up to them. For example,
looking for the churn of TLD+3 will
incorrectly consider
TLD+3 hosted on its child sub-allocation.
Example. Figure 7 shows a partial view of the network block
hierarchy of 4 sub-allocations owned by 4 different owners in
“ColoCrossing”, 3 of which are conﬁrmed resellers. The sub-
allocations of “Server Central Network” and “ColoCrossing”
are ﬁltered out because they have children and the sub-
allocation of Hudson Valley is also dropped due to the lack
of any corresponding DNS records. Incidentally,
the sub-
allocation of Irv Freiberg was detected by our system but had
been de-listed from the current Whois records. Upon further
examination of this network, we found it to be running a spam
campaign by hosting 13 TLD+3, as shown in Table XIX in
Appendix, for more than 19 months.
Feature selection and extraction. Unlike previous research
on detecting BP ASes where the routing behavior of an AS or
the volume of malicious behaviors observed on the full AS are
strong indicators of a malicious (aka, BP) AS [13], [6], [7],
ﬁnding indicators of malice at a ﬁner granularity (that is, the
network block) is more challenging. This is mainly due to the
relatively small size of the network block and its age, e.g. sub-
6Throughout this paper, we use the term TLD+3 to represent the 3rd Top
Level Domain (TLD) of any host name while an FQDN is the 2nd TLD.
812
Authorized licensed use limited to: IEEE Xplore. Downloaded on March 18,2021 at 12:21:58 UTC from IEEE Xplore.  Restrictions apply. 
Contact
BPH Service
Website
66host
Website
abusehosting
bpw
Website & Online chat
bulletproof-web Website & Online chat
cyber-plane
grandhost
simplusx
althost
protonhost
shadowhosting
outlawservers
mailtrain
bpservers
hostmy
Website
Email
Email
ICQ
Website
Website
Website
ICQ
Website
Website
Price
-
$25
$126
$140
$55
-
$150
$350
$30
$25
$16
$186
$12
$40
Date(s)
20151203
20151226
20160101
20151126
20160105
20151201
20160105
20160115
20160428
20160428
20160713
20160711
20160916
20160918
Acq Type
Test
Both
Purchase
Purchase
Purchase
Test
Purchase
Purchase
Purchase
Purchase
Purchase
Both
Purchase
Purchase
Content
HYIP DMCA
HYIP DMCA
HYIP DMCA Pharma
Botnets Malware
HYIP DMCA
HYIP DMCA Port-Scan Gambling
Botnet Spam
Botnet
Malware
Malware
Scam
Botnet
DMCA
Botnet
Package
-
VPS
VPS
VPS
Shared-Hosting & VPS
-
Shared-Hosting & VPS
VPS & FF
Shared-Hosting & FF
Shared-Hosting
Shared-Hosting
VPS
Shared-Hosting
VPS & FF
#IPs
3
3
2
4
2
1
2
1
4
2
1
9
1
2
RIR
RIPE
RIPE
RIPE
RIPE
RIPE
RIPE