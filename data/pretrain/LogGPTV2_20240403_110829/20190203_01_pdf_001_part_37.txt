Step 3 (For SMR only): Remove the schedule in any of the following ways:
 From the Subscription menu, choose Schedule, then Remove Schedule.
 Click the secondary mouse button on the Subscription node and choose Remove
Schedule.
 Click the primary mouse button on the Remove Schedule icon.
Step 3 (For MMR only): Remove the schedule in any of the following ways:
 Click the secondary mouse button on the Publication Database node and choose
Remove Schedule.
 Click the primary mouse button on the Remove Schedule icon.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 416
EDB Postgres Replication Server User’s Guide
Figure 7-33 - Removing the schedule
Step 4: In the Removing Schedule confirmation box, click the Yes button.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 417
EDB Postgres Replication Server User’s Guide
Figure 7-34 - Removing Schedule confirmation
If you click the Refresh icon in the tool bar, you will notice that schedule information no
longer appears in the information window.
Figure 7-35 - Information window after schedule removal
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 418
EDB Postgres Replication Server User’s Guide
7.4 Viewing Replication History
A summary of replications performed on each subscription or master node can be viewed
in the xDB Replication Console. A detailed replication history showing each insert,
update, and deletion made against each target table can be viewed as well. See Section
2.2.9 for a discussion on how changes are applied to target tables for the target-based
method of synchronization replication. See Section 2.2.10 for information on the log-
based method of synchronization replication.
Note (For SMR Only): The replication history can be viewed from the Publication node
as well as from the Subscription node. The history shown for a Publication node is
actually the exact same set of inserts, updates, and deletions made on the subscription
tables by the publication server during synchronization. The history shown for a
Publication node does not show the actual SQL statements processed on the publication
tables that originated from user applications.
Note (For MMR only): The replication history can be viewed from the Publication node
under any master node in the multi-master replication system. The history shown
includes inserts, updates, and deletions made on all publication tables of all master nodes
by the publication server during synchronization, and hence, the history appears the same
regardless of the master node under which the history is viewed.
7.4.1 All Replication History
Replication history shows the following types of events that occur on a given
subscription or master node:
 Snapshot replications
 Synchronization replications where at least one change (insert, update, or
deletion) was applied to a target table
 Synchronization replications where no updates were applied to any of the target
tables since the last restart of the publication server
The following steps describe how to view the replication history of the events in the
preceding list.
Step 1 (For SMR only): Select the node beneath the Subscription node. Tabs labeled
General, Realtime Monitor, and Replication History appear.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 419
EDB Postgres Replication Server User’s Guide
Figure 7-36 - Selecting a subscription on which to view replication history
Step 1 (For MMR only): Select any Publication node under a Database node
representing a master node. Tabs labeled General, Realtime Monitor, Replication History,
and Conflict History appear.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 420
EDB Postgres Replication Server User’s Guide
Figure 7-37 - Selecting a publication on which to view replication history
Step 2: Click the Replication History tab to show a history of replications.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 421
EDB Postgres Replication Server User’s Guide
Figure 7-38 - Replication History tab
Note: Every snapshot replication and each synchronization replication with at least one
update produces a history record that is maintained in replication history tables in the
control schema. Over time the size of the replication history tables will grow. Replication
history records can be periodically deleted. See Section 7.5.3 for information on cleaning
up replication history.
7.4.2 Hiding Synchronizations With Zero Transaction Counts
You may notice synchronization replications with transaction counts of zero. These
records indicate that there were no changes to synchronize at the time the replication
occurred. For scheduled replications that occur frequently, this may result in a large
number of lines in the Replication History tab, thus obscuring the more meaningful
replications with non-zero transaction counts as shown below.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 422
EDB Postgres Replication Server User’s Guide
Figure 7-39 - Replication history with zero transaction counts
While viewing the Replication History tab, you can hide the records with zero transaction
counts as follows:
Step 1: Check the Show History With Transactions Count > 0 check box located at the
bottom of the Replication History tab.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 423
EDB Postgres Replication Server User’s Guide
Figure 7-40 - Setting replication history to hide zero transaction count records
Step 2: The next time the Replication History tab refreshes, only the replications with
non-zero transaction counts appear in the Replication History.
Note: Zero transaction count replication records are maintained in the publication server
memory. By default, they are not permanently stored on disk. Therefore when the
publication server is shut down, the in-memory zero transaction count replication records
are no longer available.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 424
EDB Postgres Replication Server User’s Guide
When the publication server starts running again, zero transaction count replication
records will appear on the Replication History tab as zero transaction count replications
occur.
If you wish to permanently store zero transaction count replication records to disk, set the
publication server configuration option persistZeroTxRepEvent to true. See
Section 10.4.1.12 for further information.
7.4.3 Shadow Table History
Expanding the nodes under the Subscription node of a single-master replication system,
or the Publication node of a multi-master replication system provides more information
about the subscription or publication.
Step 1: Select a table to reveal tabs that contain general information about the table and
the replication history of the table. Expand a Table node to reveal the columns in the
table.
Figure 7-41 - Table properties and columns
Step 2: Click the Replication History tab to show a history of replications for this table.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 425
EDB Postgres Replication Server User’s Guide
Figure 7-42 - Table replication history tab
Step 3: Click the View Data link to show a list of each change made to the table during
the synchronization replication. The Synchronize History window shows two update
operations followed by one insert operation against the emp target table that correspond
to the following set of SQL statements executed on the emp source table:
UPDATE emp SET hiredate = TO_DATE('07-JUN-15'), mgr = 7698 WHERE empno IN
(9001, 9002);
INSERT INTO emp (empno, ename, job, mgr, deptno) VALUES (9003, 'JOHNSON',
'SALESMAN', 7698, 30);
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 426
EDB Postgres Replication Server User’s Guide
Figure 7-43 - Synchronize History window
Note: Since all insert, update, and delete operations on all source tables are recorded in
shadow tables, the size of the shadow tables may grow considerably over time for volatile
source tables. The rows shown in the Synchronize History window are obtained from
these shadow tables. Rows in the shadow tables can be periodically deleted. See Section
7.5.2 for information on cleaning up the shadow tables.
7.5 Managing History
xDB Replication Server maintains three types of history:
 Shadow Table History. Records of each change (insert, update, or delete) that
was applied to each target table during synchronization replications using the
trigger-based method. There is no shadow table history for synchronization
replications using the log-based method.
 Replication History. Summary records of each replication.
 Event History. Records of each change that was applied to various control
schema tables.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 427
EDB Postgres Replication Server User’s Guide
The size of the control schema tables that store these history records grows over time, and
thus there are a number of methods referred to as cleanup to delete such history records.
Shadow table history cleanup information is described in sections 7.5.1 and 7.5.2.
For replication history cleanup, see Section 7.5.3.
For event history cleanup, see Section 7.5.4.
7.5.1 Scheduling Shadow Table History Cleanup
A preference can be set for each publication database definition to determine if and when
shadow table history cleanup should be scheduled for all publications appearing under its
corresponding Publication Database node.
Shadow table history cleanup has no benefit for snapshot-only publications so if all of
your publications under a Publication Database node are snapshot-only publications, then
scheduled shadow table history cleanup should be disabled following steps 1 through 4.
Replication history is not deleted by scheduling shadow table history cleanup.
Whenever a new publication database definition is created, there is a scheduled default
setting of every Sunday at 12:00 AM midnight for shadow table history cleanup.
Note: A configuration option is available to force shadow table history cleanup after
every synchronization replication. See Section 10.4.1.9 for information on this option.
Note: The cleanup of certain processed rows in the shadow tables may be delayed
beyond the next scheduled cleanup, but will eventually be removed in subsequent
cleanup events.
For Oracle only: For scheduling of shadow table history cleanup on an Oracle
publication database, the Oracle DBMS_JOB package on the Oracle database server is
used. The time you specify in the schedule for cleanup is passed and stored in DBMS_JOB
without time zone translation.
For example, assume the publication server is running on a host in New York and the
Oracle publication database is on a server in California, which has a 3-hour time
difference. If you set shadow table history cleanup to run at 12:00 AM midnight
according to the New York based publication server, the cleanup job on the California
based Oracle database will start at 12:00 AM midnight Pacific Time (in California),
which would be 3:00 AM Eastern Time (in New York).
For SQL Server only: For scheduling of shadow table history cleanup on a SQL Server
publication database, SQL Server Agent is used on the host running SQL Server. The
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 428
EDB Postgres Replication Server User’s Guide
time you specify in the schedule for cleanup is passed to SQL Server Agent without time
zone translation. The effect is the same as described for Oracle in the preceding example.
For Postgres only: For scheduling of shadow table history cleanup on a Postgres
publication database, the Quartz scheduler is used on the host running the publication
server based on the location of the controller database.
For example, assume the publication server is running on a host in New York and the
Postgres publication database on which cleanup is to be scheduled is also the controller
database and is on a host in California. If you set shadow table history cleanup to run at
12:00 AM midnight according to the New York based publication server, the cleanup job
on the California based Postgres database will start at 12:00 AM midnight Pacific Time
(in California), which would be 3:00 AM Eastern Time (in New York).
By contrast, assume the publication server is running on a host in New York along with
the controller database, and the Postgres publication database on which cleanup is to be
scheduled is on a host in California. If you set shadow table history cleanup to run at
12:00 AM midnight according to the New York based publication server and controller
database, the cleanup job on the California based Postgres database will start at 12:00
AM midnight Eastern Time (in New York), which would be 9:00 PM Pacific Time (in
California).
For Oracle only: The cleanup job on an Oracle publication database runs independently
of the publication server, so the cleanup job will run regardless of whether or not the
publication server is running.
For Postgres only: The publication server must be running in order for the cleanup job
to run on a Postgres publication database.
Note: An alternative to using the Quartz scheduler when Postgres is the publication
database, is to use pgAgent job scheduling instead. See Section 10.4.1.8 for information
on how to use pgAgent job scheduling and the advantages, thereof.
The following steps show how to alter the default setting.
Step 1: Make sure the publication server whose node is the parent of the publication
database definition whose cleanup scheduling preference you want to set is running and
has been registered in the xDB Replication Console you are using. See Section 5.2.1 for
directions on starting and registering a publication server.
Step 2: Select the Publication Database node for which you want to set the cleanup
scheduling preference.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 429
EDB Postgres Replication Server User’s Guide
Figure 7-44 - Selecting the publication database for cleanup scheduling
Step 3: From the Publication menu, choose Preferences. Alternatively, click the
secondary mouse button on the Publication Database node and choose Preferences. The
Publication Server Preferences dialog box appears.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 430
EDB Postgres Replication Server User’s Guide
Figure 7-45 - Publication Server Preferences dialog box
Step 4: In the Publication Server Preferences dialog box, uncheck the box if you do not
want to run a scheduled shadow table history cleanup job. Click the OK button and skip
the remaining steps.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 431
EDB Postgres Replication Server User’s Guide
Figure 7-46 - Disabled schedule for shadow table history cleanup
Step 5: If you want to schedule shadow table history cleanup, make sure the Run
Cleanup Job check box is selected. Select the radio button for the cleanup frequency. The
frequency choices have the following meanings:
 Every number of minutes/hours. Schedules shadow table history cleanup to run
continuously at an interval in either minutes or hours that you specify. Select this
option if there are huge volumes of updates to the publication tables during the
course of the day, every day.
 Every Day at hour of day. Schedules shadow table history cleanup to run once a
day on the hour you choose. Select this option if updates to the publication tables
are frequent enough to require more than once a week cleanup, but not needed
more than once a day.
 Every selected day of week at hour of day. Schedules shadow table history
cleanup to run once a week on the day and at the hour you choose. Select this
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 432
EDB Postgres Replication Server User’s Guide
option if updates to the publication tables are infrequent and you do not want to
run cleanup manually.
 Cron Expression. Provides additional flexibility for specifying a schedule
beyond the three preceding radio button choices. See appendix Section 10.4.3 for
directions on writing a cron expression.
Note: A configuration option is available to force shadow table history cleanup after
every synchronization replication. See Section 10.4.1.9 for information on this option.
Figure 7-47 - Cleanup Job dialog box
Step 6: Click the OK button to accept the schedule.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 433
EDB Postgres Replication Server User’s Guide
7.5.2 Cleaning Up Shadow Table History
Non snapshot-only publications (that is, publications on which synchronization
replications occur) whose tables experience frequent changes should have their shadow
table history cleaned up periodically, otherwise the amount of disk space consumed by
the shadow tables in the publication database may grow too rapidly.
When shadow table history is cleaned up, the rows in the following xDB Replication
Server metadata tables are deleted:
 RREP_TXSET
 RREP_TXSET_LOG
 RRST_schema_table
For Oracle only: When Oracle is the publication database, these tables are located in the
publication database in the schema of the publication database user.
For SQL Server only: When SQL Server is the publication database, these tables are
located in the publication database in the schema you chose during Step 5 of Section
5.1.4.2.
For Postgres only: When Postgres is the publication database, these tables are located in
the publication database in schema _edb_replicator_pub.
Shadow table history cleanup can be scheduled to run periodically (see Section 7.5.1) or
it can be run on demand.
Note: The cleanup of certain processed rows in the shadow tables may not occur during
an on demand cleanup or may be delayed beyond the next scheduled cleanup, but will
eventually be removed in subsequent cleanup events.
The following are the steps to run shadow table history cleanup on demand for a chosen
publication.
Step 1: Make sure the publication server whose node is the parent of the publication
whose shadow table history you wish to clean up is running and has been registered in the
xDB Replication Console you are using. See Section 5.2.1 for directions on starting and
registering a publication server.
Step 2: Select the Publication node of the publication for which you want to clean up the
shadow table history.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 434
EDB Postgres Replication Server User’s Guide
Figure 7-48 - Selecting a publication for shadow table history cleanup
Step 3: From the Publication menu, choose Cleanup Shadow Table History.
Alternatively, click the secondary mouse button on the Publication node and choose
Cleanup Shadow Table History. The Cleanup Synchronization History confirmation box
appears.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 435
EDB Postgres Replication Server User’s Guide
Figure 7-49 - Cleaning up shadow table history
Step 4: Click the Yes button in the Cleanup Synchronization History confirmation box.
Figure 7-50 - Cleanup Synchronization History confirmation
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 436
EDB Postgres Replication Server User’s Guide
Step 5: Click the Yes button in response to Shadow Table’s Transaction History
Removed Successfully.
Figure 7-51 - Successful cleanup of shadow table history
After shadow table history cleanup, if you click the View Data link of the Replication
History tab, an information message appears stating that there is no synchronization
history to view.
Copyright © 2010 - 2018 EnterpriseDB Corporation. All rights reserved. 437
EDB Postgres Replication Server User’s Guide
Figure 7-52 - View Data link after shadow table history cleanup
7.5.3 Cleaning Up Replication History
Cleaning up replication history deletes rows from the following tables in the control
schema:
 xdb_pub_replog
 xdb_pub_table_replog
The following are the steps to run replication history cleanup for a chosen publication.