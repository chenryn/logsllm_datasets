### 6.2 代理的应用实例

#### 6.2.1 内容路由代理
内容路由代理可以用来构建多种有趣的服务。例如，它可以将HTTP请求转发到过滤代理，以便为用户提供过滤服务。

#### 6.2.2 转码代理
转码代理可以在将内容发送给客户端之前修改其主体格式。这种在不同数据表示法之间进行的透明转换被称为转码（transcoding）。例如，代理服务器可以将GIF图片转换为JPEG图片以减小文件大小，或者对图片进行压缩和降低色彩饱和度以便在电视上显示。同样，代理可以对文本文件进行压缩，并生成适用于呼机和智能手机的小型文本摘要。此外，代理还可以在传输文档时将其翻译成其他语言。

**示例：**
- **GIF到JPEG转换**：代理将GIF图片转换为JPEG图片，以减小文件大小。
- **图像压缩**：代理对图片进行压缩，以减少传输时间。
- **文本压缩**：代理对文本文件进行压缩，并生成小型文本摘要，适用于呼机和智能手机。
- **语言翻译**：代理在传输文档时将其翻译成外语。

**图6-8 代理应用程序实例：内容路由器**

**图6-9 代理应用程序实例：内容转码器**

#### 6.2.3 匿名代理
匿名代理会从HTTP报文中删除身份特性（如客户端IP地址、From首部、Referer首部、cookie、URI的会话ID），从而提供高度的私密性和匿名性。然而，由于删除了识别信息，用户浏览体验的质量可能会有所下降，有些Web站点可能无法正常工作。

**示例：**
- **删除User-Agent首部**：删除用户的计算机与操作系统类型信息。
- **删除From首部**：保护用户的电子邮件地址。
- **删除Referer首部**：掩盖用户访问过的其他站点。
- **删除Cookie首部**：剔除概要信息和身份数据。

**图6-10 代理应用程序实例：匿名者**

### 6.3 代理在网络中的部署

#### 6.3.1 代理服务器的部署
可以根据其目标用途，将代理放在任意位置。以下是一些常见的部署方式：

- **出口代理**：固定在本地网络的出口点，用于控制本地网络与因特网之间的流量。例如，在公司网络中使用出口代理提供防火墙保护，或降低带宽费用，提高因特网流量性能。
- **访问（入口）代理**：放在ISP访问点上，处理来自客户的聚合请求。ISP使用缓存代理存储常用文档的副本，提高用户下载速度，降低因特网带宽耗费。
- **反向代理**：部署在网络边缘，在Web服务器之前作为替代物。反向代理可以提高Web服务器的安全特性，或将快速的Web服务器缓存放在较慢的服务器之前以提高性能。
- **网络交换代理**：放在网络之间的因特网对等交换点上，通过缓存减轻因特网节点的拥塞，并对流量进行监视。

**图6-11 可以根据其目标用途，以多种方式来部署代理**

#### 6.3.2 代理的层次结构
可以通过代理层次结构将代理级联起来。在代理的层次结构中，报文从一个代理传给另一个代理，直到最终抵达原始服务器（然后通过代理传回给客户端）。

- **父代理与子代理**：下一个入口代理（靠近服务器）被称为父代理，下一个出口代理（靠近客户端）被称为子代理。例如，在图6-12中，代理1是代理2的子代理，代理2是代理3的子代理，代理3是代理2的父代理。

**图6-12 三级的代理层次结构**

#### 6.3.3 动态选择父代理
代理服务器可以根据多种因素动态选择父代理。例如：

- **负载均衡**：子代理根据当前父代理上的工作负载级别选择父代理，以均衡负载。
- **地理位置附近的路由**：子代理选择负责原始服务器所在物理区域的父代理。
- **协议/类型路由**：子代理根据URI将报文转发到不同的父代理和原始服务器。
- **基于订购的路由**：如果发布者为高性能服务额外付费，其URI会被转发到大型缓存或压缩引擎上以提高性能。

**图6-13 代理层次结构可以是动态的，随请求而变的**

#### 6.3.4 代理如何获取流量
有几种常见方式可以使客户端流量流向代理：

- **修改客户端**：配置客户端使用代理服务器，客户端将HTTP请求直接发送给代理而不是原始服务器。
- **修改网络**：通过网络基础设施拦截网络流量并将其导入代理。这种代理被称为拦截代理。
- **修改DNS命名空间**：代理服务器假扮Web服务器的名字和IP地址，使所有请求发送给这些代理而不是服务器。

**图6-14 使客户端流量流向代理的方法**

通过以上优化，文本变得更加清晰、连贯和专业。希望这对你有所帮助！