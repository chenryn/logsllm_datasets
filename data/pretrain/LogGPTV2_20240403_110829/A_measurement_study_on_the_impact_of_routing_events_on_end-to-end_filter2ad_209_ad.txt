s
s
o
l
f
o
r
e
b
m
u
N
 200
 150
 100
 50
s
t
s
r
u
b
s
s
o
l
f
o
r
e
b
m
u
N
 0
 -600  -400  -200
 0
 200
 400
 600
 0
 -600  -400  -200
 0
 200
 400
 600
Starting time (seconds)
(a) Recovery-1
Starting time (seconds)
(b) Recovery-2
Figure 10: Number of loss bursts starting at each second during
recovery events.
5. RECOVERY EVENTS
In this section, we investigate the end-to-end path performance
In particular, we focus on those events
during recovery events.
which result in end-to-end path changes, i.e., the probe host chooses
the restored provider when routes through both providers are avail-
able. Thus, the recovery event causes the probe host to switch to
using the restored provider. We ﬁrst present packet loss, delay, and
packet reordering for all such events. Then we analyze the root
causes of packet loss during recovery events.
5.1 Data Plane Performance
Similar to our analysis on failover events, We measure the per-
formance (in terms of loss, delay, and packet reordering) based on
UDP packet probes from 37 PlanetLab sites. There are two kinds
of recovery events: (1) announcing the route to ISP 1 (denoted as
“recovery-1”) and (2) announcing the route to ISP 2 (denoted as
“recovery-2”). Among the 37 probing hosts, 12 hosts choose the
restored path via ISP 1 and 25 hosts choose the restored path via
ISP 2 when routes to both ISPs are available.
Figure 10 shows the number of loss bursts during recovery events
across all probe hosts undergoing path changes for the entire dura-
tion of our study. Similar to our analysis on failover events, the
x-axis represents the start time of a loss burst, where the start time
is measured (in seconds) relative to the injection of announcement
messages. During recovery-1 events in Figure 10(a), we do not
observe a large number of loss bursts after time 0, i.e., the time
when an announcement message is advertised. However, during
recovery-2 events in Figure 10(b), we observe that loss bursts oc-
cur right after time 0, and can last for 100 seconds. Even though
the magnitude of the loss burst peak may vary during two kinds
of recovery events, more than half of end hosts (i.e., 29 PlanetLab
hosts) in our measurement experience packet loss during recovery
events.
To understand the extent to which recovery events can cause
packet loss, we divide the period of time that UDP packet prob-
ing is performed into three intervals as we do for failover events:
(1) before path changes, (2) during path changes, and (3) after
path changes. Figure 11 (a) and Figure 12 (a) show the loss burst
length during routing changes, compared with those before and af-
ter routing changes. We observe that the loss burst length during
routing change does not show signiﬁcant difference compared with
those before or after routing change. Figure 11(a) also shows that
there are more packets dropped after path change, which is most
likely due to congestion because we observe no routing changes
in our traceroute measurements and no corresponding ICMP mes-
sages. Recall that we have similar observations on the failover
events shown in Figure 2(a). In addition, loss burst length can be as
long as 180 packets and 140 packets for recovery-1 and recovery-
2 events respectively. Such loss is most likely caused by rout-
Table 5: Packet loss caused by routing changes during recovery
events
Causes
Recovery
Loss
packets
1120 (26%)
480 (43%)
640 (57%)
3266 (74%)
Veriﬁed as routing failures
–loop-free
–forwarding loop
Unveriﬁed as routing failures
events
41 (12%)
17 (41%)
24 (59%)
290 (88%)
Loss
bursts
76 (4%)
39 (51%)
37 (49%)
1714 (96%)
ing failures. It is quite counter-intuitive that even during recovery
events when both routes are available, packets would experience
such long-lived loss bursts.
In addition to loss burst length during recovery events, we also
measure packet round-trip delays and reordered packets. Figure 11
(b) shows performance using round-trip delay metric for the re-
covery events when the route via ISP1 is re-announced. We ob-
serve that the distribution of packet delays is similar compared to
those for failover events, i.e., recovery events have impact on packet
round-trip delays. However, from Figure 11 (c) and (d), the average
reordering offset or the degree of reordering is smaller for recovery,
about 2 compared to 6 for failover. The total amount of reordering
is also signiﬁcantly less. Interestingly we ﬁnd reordering during
recovery events is slightly smaller than that during normal time,
indicating that recovery events do not contribute much to packet
reordering.
Figure 12 shows the corresponding metrics for those events when
the route via ISP2 is re-announced. Similar to Figure 11, we ob-
serve that packet delays are no different from that for failover events.
The average offset for out-of-order packets is no more than three
packets. From all the performance metrics, we ﬁnd that recovery
events have the most impact on loss burst length. Next, we identify
the cause for packet loss during such routing changes.
5.2 Root Causes of Loss Bursts
In general, we observe that during recovery events loss bursts
are long. This motivates us to analyze whether some of packet
loss bursts are caused by routing failures. This may appear to be
unlikely since paths to both providers are available: the old route
going through the less preferred provider is still usable while the
routers switch to the more preferred, newly announced route. How-
ever, our measurement results show that routing failures indeed oc-
cur during recovery events.
Similar to our analysis on failover events, we correlate ICMP un-
reachable messages with loss bursts. From Table 5, we observe that
26% of packet loss is veriﬁed to be caused by routing failures. Note
that the number of packet loss caused by routing failures might be
more than what can be identiﬁed by our heuristic because ICMP
messages may be ﬁltered by some routers in the Internet.
In addition, we evaluate routing failures from BGP updates, which
are collected from 12 routers within ISP 2. From over 724 recov-
ery events, we observe 12 BGP withdrawals sent by those moni-
tored routers. We also observe that there is little time difference
between the withdrawal and the following announcement, which
are for the same preﬁx but with different BGP AS paths. While
the occurrence of routing failures during recovery event is rare, the
routers within ISP 2 indeed temporarily lose their routes to the
Beacon.
As we do for failover events, we measure the duration of a loss
burst as the time interval between the latest received packet before
the loss and the earliest one after. Figure 13(a) shows the cumu-
lative distribution of the duration of loss bursts that are both veri-
ﬁed and unveriﬁed as caused by routing failures. We observe that
F
D
C
F
D
C
 1
 0.95
 0.9
 0.85
 0.8
 0.75
 0.7
 1
F
D
C
 1
 0.9
 0.8
 0.7
 0.6
 0.5
 0.4
 0.3
 0.2
 0.1
 0
during path change
before path change
after path change
 10
 100
Loss burst length
(a) Loss burst length
during path change
before path change
after path change
 0  100 200 300 400 500 600 700 800 900 1000
Average RTT delay (ms)
(b) Round-trip delay
F
D
C
 1
 0.98
 0.96
 0.94
 0.92
 0.9
 0.88
during path change
before path change
after path change
 0
 1
 2
 3
 4
 5
 6
Out-of-order
F
D
C
 1
 0.98
 0.96
 0.94
 0.92
 0.9
 0.88
 0
 0.5
during path change
before path change
after path change
 1
 1.5
Average offset
 2
 2.5
(c) Number of out-of-order packet
(d) Offset of Out-of-order
Figure 11: Performance during the recovery-1 events when the route via ISP 1 is re-announced.
 1
 0.95
 0.9
 0.85
 0.8
 0.75
 0.7
 0.65
during path change
before path change
after path change
 1
 10
 100
Loss burst length
(a) Loss burst length
F
D
C
 1
 0.9
 0.8
 0.7
 0.6
 0.5
 0.4
 0.3
 0.2
 0.1
 0
during path change
before path change
after path change
 0  100 200 300 400 500 600 700 800 900 1000
Average RTT delay (ms)
(b)Round-trip delay
F
D
C
 1
 0.998
 0.996
 0.994
 0.992
 0.99
 0.988
 0.986
during path change
before path change
after path change
 0  0.5  1  1.5  2  2.5  3  3.5  4
Out-of-order
F
D
C
 1
 0.998
 0.996
 0.994
 0.992
 0.99
 0.988
 0.986
during path change
before path change
after path change
 0
 0.5
 1
 1.5
 2
Average offset
(c) Number of out-of-order
(d) Offset of Out-of-order
Figure 12: Performance during the recovery-2 events when the route via ISP 2 is re-announced.
F
D
C
 1
 0.8
 0.6
 0.4
 0.2
 0
 0
Unverified loss bursts
Verified loss bursts
 2
 4
 6
 8
 10
Duration (seconds)
F
D
C
 1
 0.8
 0.6
 0.4
 0.2
 0
 0
Loop-free routing failures
Forwarding loops
 4
 6
 2
Duration (seconds)
host A
host B
R1
R2
R4
ISP 1
ISP 2
R3
 8
 10
(a) Loss bursts veriﬁed vs. unveriﬁed
as caused by routing failures
(b) Forwarding loops vs.
Loop-free routing failures
Beacon
Figure 13: Duration of loss burst.
Figure 14: Topology for explaining packet loss burst during
recovery.
veriﬁed loss bursts on average are longer than those unveriﬁed. In
addition, during recovery events, more than 98% of routing failures
last less than 5 seconds, while during failover events, about 80% of
routing failures last less than 5 seconds as shown in Figure 5. This
means that loss bursts caused by routing failures during recovery
events last much shorter than those during failover events. We also
observe that unveriﬁed loss bursts last less than 4 seconds.
Figure 13(b) shows the duration of veriﬁed loss bursts that are
caused by loop-free routing failures and forwarding loops. We ob-
serve that 57% of packet loss is due to forwarding loops, which is
a little higher than that for failover events (47%). This implies that
forwarding loops are also quite common during recovery events.
5.3 How Routing Failures Occur
Here, we illustrate an example to show how packets can be dropped
due to path changes during recovery events. Figure 14 shows a sim-
pliﬁed topology. In this ﬁgure, solid arrow lines indicate the path
used before a recovery event, while dashed arrow lines represent