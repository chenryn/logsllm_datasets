![](media/image1.png)
**国家电网公司信息系统**
**统一日志管理规范**
信息系统行为安全审计顶层设计组
二○一六年三月
**目录**
1 前言 [3](#前言)
> 1.1 概述 [3](#概述)
>
> 1.2 公司日志管理现状 [3](#公司日志管理现状)
>
> 1.3 统一日志管理目标 [5](#统一日志管理目标)
2 日志记录规范 [6](#日志记录规范)
> 2.1 主机设备日志 [7](#主机设备日志)
>
> 2.2 网络类设备日志 [9](#网络类设备日志)
>
> 2.3 安全类日志 [12](#安全类日志)
>
> 2.4 应用类日志 [19](#应用类日志)
>
> 2.5 终端类日志 [20](#终端类日志)
3 日志统一采集规范 [22](#日志统一采集规范)
4 日志分析规范 [23](#日志分析规范)
> 4.1 日志解析 [23](#日志解析)
>
> 4.2 日志挖掘 [26](#日志挖掘)
5 日志存储规范 [27](#日志存储规范)
> 5.1 存储原则 [27](#存储原则)
>
> 5.2 存储时间 [28](#存储时间)
>
> 5.3 存储格式 [29](#存储格式)
>
> 5.4 存储规范 [29](#存储规范)
6 日志使用规范 [30](#日志使用规范)
> 6.1 日志检索 [30](#日志检索)
>
> 6.2 日志数据可视化 [31](#日志数据可视化)
>
> 6.3 日志导出 [31](#日志导出)
>
> 6.4 对外接口 [32](#对外接口)
# 前言
## 概述
随着云计算、大数据、移动互联等新技术在国网公司信息化建设的应用日益广泛，所面临的安全威胁也越来越多。网络中的主机、服务器、网络设备、安全设备、数据库以及各种应用服务系统在运行过程中会产生大量的运行日志、安全日志和行为日志，工作人员面对数量如此巨大的信息，由于缺乏分析手段，无法及时准确定位网络故障和真正的安全隐患所在，缺少一个全面统一的日志收集、分析、存储和消费提供的平台。为加快建设智能电网和"三集五大"管理体系，深入推进"两个转变"，支撑"能源互联网"发展，全面实现"一强三优"现代公司战略目标，建立一个统一的日志进行收集、存储、管理的中心成为必然的选择。
日志中心能够对全网范围内的主机、服务器、网络设备、数据库以及各种应用服务系统等产生的各类日志，进行规范采集，统一规范日志格式，统一持久化存储，统一策略制定，并进行细致分析，通过统一的控制台进行实时可视化的呈现。通过定义日志筛选规则和策略，帮助工作人员从海量日志数据中精确查找关键有用的事件数据，准确定位网络故障并提前识别安全威胁，保障企业网络安全。
日志中心能够收集运行类、安全类、行为类的日志信息，实现对在线业务系统最全面的分析。分析在线业务系统所在主机的运行状态与错误信息，中间件运行状态与错误信息，关联业务系统本身日志事件，对业务系统出现的问题进行快速定位并分析原因，结合已有的知识库分析预测在线业务系统可能出现的问题。
## 公司日志管理现状
目前，国网下属各公司中，部分公司已具有日志采集、分析、审计等相关业务系统。但这些日志管理相关系统或者建设较早，无法适应新技术、新环境、新问题，或者过于专业只能收集部分日志。缺乏统一的日志采集规范、格式规范以及存储规范，没有进行深入的日志关联分析，不适应云计算、大数据等技术。同时缺少对业务系统运行、审计日志的统一收集、分析和存储，日志在收集和处理时缺少有效的过滤、去重策略，没有解决好时间戳问题，难以保证日志的准确性、完整性、可信性等，导致结果分析存在偏差，日志管理工作没有规范的流程，这些给业务系统运维工作带来一系列问题，可能导致出现运行故障时无法准确定位问题原因，无法主动预防潜在的危险和攻击行为。部分业务系统的日志记录不规范、不合理，没有统一的记录规范标准，对日志没有进行长期存储，这导致系统运维人员很难从日志中获取有价值信息，即使得到日志，由于对日志的格式规范不了解，也增加了分析日志的难度。伴随云计算技术在国网的全面推进，对于云日志的收集和分析迫在眉睫。要获取并分析云日志，我们就必须具备云日志的获取方法、部署模型、日志存留策略、灾难恢复策略等等，解决监管、依从性和安全性问题。通过对云日志的分析，我们可以及时获取云环境的运行异常情况和安全态势。不具备日志有日志采集、分析、审计业务系统的公司，如果要进行日志的分析，那么只能采用最笨拙的手工方式实现，逐一登录每台设备，采用工具或命令等方式进行查看，这样的工作效率可想而知，而且这样的日志管理需要运维人员具备较高的日志分析能力，或者会采用一些简单开源工具管理日志，但是由于开源工具的功能局限，并且部分功能需要开发实现，在实际使用中往往很难达到预期效果。
国网公司目前在逐步推进"大云物移"等新技术在公司的深化应用，同时开展"国网云"的目标架构，在这个过程中我们要对更多的日志进行精细化管理，达到最全面的日志统一收集，规范的进行采集、存储、解析，日志的极速查询，紧急事件的快速响应，实现日志数据的可视化，形成网络活动报告、资源访问报告、恶意软件活动报告、关键错误和故障报告等等。而且i6000、S6000、大数据分析平台等系统需要一个全面的、格式化的日志分析来源。我们可以借助云计算技术实现对日志数据的深入挖掘，改进日志分析的质量，提供更好的答案和预测能力。通过日志中心的建设可以在解决现有问题的基础上促进日志管理工作的规范化。
## 统一日志管理目标
1.  智能、规范化的收集最全面的日志数据：不仅完成对主机、网络安全设备、中间件、数据库等基本设备的日志收集，而且对信息系统日志、安全审计日志、网络流量等进行全面收集。
2.   实现日志实时、极速搜索：实现日志实时收集和处理，日志从产生到搜索分析出结果只有几秒的延时。
3.  统一标准化日志记录格式：针对不同类型日志制定其记录规范，统一的日志记录格式有利于日志的快速解析和对日志的快速索引查询。
4.  实现日志的统一存储：日志存留时间需满足相关政策法规中要求的保存的特定日志的类型和存储时间。规范日志的存储格式，具有企业级分布式文件系统，具有高扩展性。
5.  安全事件快速定位、响应与追责：在收集到的各类日志的基础上，对安全事件进行快速响应，定位问题原因，追踪事件源头，并采取相应行动进行处理。
6.  实现日志使用的标准化：对收集的日志统一格式、统一存储后，提供对外的统一使用接口，可实现在线日志的快速搜索，日志内容的文本导出，以及告警和日志内容向第三方平台的统一、规范化推送。
7.  对信息系统运行、使用情况进行分析：通过对中间件、信息系统等日志的关联分析和数据挖掘获取信息系统运行状、用户使用情况等信息。
8.  利用大数据、机器学习技术进行异常行为检测：异常行为分析技术通过对流经设备的流量进行连续、实时监控来分析流量信息，利用统计分析、关联分析和机器学习等多种技术手段来检测流量和用户或应用行为中的异常模式，以发现异常行为。通过机器学习提高运维效率、为规则设定提供依据。
9.  实现安全态势可视化呈现：从安全态势全局可视、安全变化局部监控、安全事件细节分析三个方面实现安全态势可视化呈现。
10. 提高安全分析效率：告警事件自动归类，安全事件回溯检索平台。
11. 对未知威胁和异常行为检测发现：自动识别未知的安全威胁和安全。行为，变被动为主动。
# 日志记录规范
日志采用文档结构存储，以标准的JSON格式进行日志的扩展。采用syslog、SNMP、端口镜像、第三方、agent等发送方式。
日志是日志中心处理的最小数据单元。日志中心采用半结构数据模式定义一条日志，具体数据模型如下：
主题（Topic）：用户自定义字段，用以标记一批日志（例如：访问日志根据不同的站点进行标记）。日志主题命名规范如下：
  ------------------------- -----------------------------------------------------------------------
  **主题标识**              **主题标识说明**
  Win_weblogic              Windows环境下weblogic的http访问类型日志
  Win_weblogic_Server       Windows环境下weblogic服务器日志
  Win_secure                Windows操作系统安全类日志
  Win_system                Windows操作系统系统日志
  Win_app                   Windows操作系统应用类日志
  Linux\_ weblogic          Linux环境下weblogic的http访问类型日志
  Linux\_ weblogic_Server   Linux环境下weblogic服务器日志
  Linux_message             Linux操作系统标准错误日志，非内核产生的引导信息；各子系统产生的信息。
  Linux_secure              Linux操作系统用认证相关信息，例如用户登录，修改用户信息等操作记录。
  Linux_cron                Linux操作系统记录cron和at服务日志信息
  Linux_mail                Linux操作系统记录邮件系统的日志信息
  Linux_boot                Linux操作系统记录系统服务的启动信息
  Linux\_ dmesg             Linux操作系统记录内核的硬件检测信息
  Switch                    交换机日志
  FireWall_h3c              H3c防火墙日志
  FireWall_dp               迪普防火墙日志
  Nfocus_ids                绿盟IDS设备日志
  Nfocus_WAF                绿盟WAF设备日志
  Nfocus_SAS                绿盟SAS设备日志
  Nfocus_IPS                绿盟IPS设备日志
  Trend_stda                趋势设备日志
  Linux_tomcat              Linux下tomcat http访问日志
  Tap                       Tap设备日志
  win_tomcat                windows下tomcat http访问日志
  Linux_tomcat_Cata         Linux下tomcat 服务日志
  win_tomcat_Cata           windows下tomcat 服务日志
  Orcl_Access               Oracle数据库访问日志
  Orcl_opt                  Oracle数据库操作日志
  Mysql_Access              Mysql数据库访问日志
  Mysql_opt                 Mysql数据库操作日志
  Net_mirror                网络流量镜像日志
  Sys_BussinessName         业务系统日志，以sys_开头,后面跟业务系统名称
  Other                     未归类日志，新发现的未知日志类型
  ------------------------- -----------------------------------------------------------------------
时间（Time）：日志中保留字段，用以表示日志产生的时间（精度为秒，从1970-1-1
00:00:00
UTC计算起的秒数），一般由日志中的时间直接生成。日志格式统一规范为"yyyy-MM-dd
hh:mm:ss"形式。
内容（Content）：用以记录日志的具体内容。内容部分由一个或多个内容项组成，每一个内容项由Key、Value对组成。
来源（Source）：日志的来源地，例如产生该日志机器的IP地址。默认该字段为空。
对日志内容（Content）的进一步进行统一规范、格式化处理有利于日志的快速解析，因此我们分别制定了主机类、网络类、安全类、应用类的日志统一规范。
## 主机设备日志
1.  物理主机日志格式规范
  ---------- --------------------------------------------------------------
  **序号**   **记录项**
  1          事件标识
  2          事件产生时间
  3          主机名
  4          事件优先级
  5          事件严重级别
  6          事件内容
  7          事件导致结果
  8          事件源设备地址
  9          事件源设备类型
  10         事件文件名
  11         事件源地址
  12         事件源用户名称
  13         事件源主机名称
  14         事件归类1
  15         事件归类2
  16         产生事件进程名称
  17         应用管理日志-应用名称
  18         应用管理日志-安装位置
  19         应用管理日志-版本号
  20         应用管理日志-登录帐号
  21         应用管理日志-操作时间
  22         应用管理日志-操作类型
  23         用户登录日志-登录时间
  24         用户登录日志-登出时间
  25         用户登录日志-登录帐号
  26         用户登录日志-登录IP
  27         用户登录日志-登录认证方式
  28         用户登录日志-登录认证结果
  29         账号管理日志-登录账号
  30         账号管理日志-目的账号
  31         账号管理日志-操作时间
  32         账号管理日志-操作类型
  ---------- --------------------------------------------------------------
2.  虚拟类主机日志格式规范
  ---------- ----------------------------------------------------------------
  **序号**   **记录项**
  1          事件名标识
  2          事件产生时间
  3          主机名称
  4          事件优先级
  5          事件严重级别
  6          事件内容
  7          事件导致结果
  8          事件源设备地址
  9          事件源设备类型
  10         事件文件名
  11         事件源地址
  12         事件源用户名
  13         事件源主机名
  14         事件分类1
  15         事件分类2
  16         产生事件进程名称
  17         物理磁盘基本信息-磁盘名称
  18         物理磁盘基本信息-磁盘类型
  19         物理磁盘基本信息-磁盘序列号
  20         物理磁盘基本信息-磁盘大小
  21         物理磁盘运行信息-磁盘I/O
  22         逻辑磁盘基本信息-磁盘名称
  23         逻辑磁盘基本信息-磁盘大小
  24         逻辑磁盘基本信息-磁盘类型
  25         逻辑磁盘运行信息-分区使用率
  26         文件系统基本信息-名称
  27         文件系统信息-大小
  28         文件系统信息-类型
  29         文件系统运行信息-使用率
  30         用户列表信息-用户账号
  31         用户列表信息-用户角色
  32         密码策略-密码复杂性要求
  33         密码策略-密码长度最小值
  34         密码策略-密码最短使用期限
  35         密码策略-密码最长使用期限
  36         密码策略-密码强制密码历史
  ---------- ----------------------------------------------------------------
## 网络类设备日志
1.  路由器设备日志格式规范
  ---------- -------------------------------------------------------------
  **序号**   **记录项**