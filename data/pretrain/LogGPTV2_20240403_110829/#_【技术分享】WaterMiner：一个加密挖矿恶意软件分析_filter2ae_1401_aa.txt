# 【技术分享】WaterMiner：加密挖矿恶意软件分析

#### 译文声明
本文为翻译文章，原文来源：minerva-labs.com  
原文地址：[链接]  
译文仅供参考，具体内容及含义以原文为准。

**译者**：[blueSky](http://bobao.360.cn/member/contribute?uid=1233662000)  
**预估稿费**：200RMB  
**投稿方式**：发送邮件至 linwei#360.cn 或登录网页版在线投稿

## 前言
Minerva实验室发现了一种新的加密货币地下挖矿团队使用的恶意软件。本报告详细描述了这种恶意的加密货币挖矿机（cryptominers）的本质，剖析了其隐藏技术和感染媒介，并探讨了它在攻击终端安全软件时所采用的技术。我们还提供了该组织可能的幕后操控者的细节。

## 门罗币的淘金热
随着加密货币日益普及，比特币已成为最广为人知的例子，甚至在没有技术背景的人群中也很流行。知名商家如Expedia也开始接受比特币支付。然而，比特币并非唯一的加密货币。目前，包括以太币、莱特币、Zcash和门罗币在内的多种加密货币市值均超过10亿美元。这些货币在实现过程中具有不同的数学和计算属性。

通过大量计算来获取加密货币作为奖励的过程被称为挖矿。加密货币挖矿恶意软件通过盗用受害者的计算资源来进行大规模运算，从而让网络犯罪分子独享挖矿收益。最近，针对门罗币的挖矿恶意软件数量有所增加。门罗币因其匿名性和不可追踪性而在网络犯罪分子中非常受欢迎。

今年5月，Proofpoint揭露了Adylkuzz门罗币挖矿恶意软件，该恶意软件与同时期传播的WannaCry使用相同的代码。上个月，安全研究员@PaulWebSec 发现了一些流行的网站（如CBS Showtime、The Pirate Bay等）会从访问者那里“借用”CPU时间来运行代码以挖掘门罗币。

—-@PaulWebSec 列举了几个挖掘门罗币的网站

Minerva 最近发现了另一个非法的门罗币挖矿组织，该组织主要针对俄罗斯用户传播恶意的门罗币挖掘机。

## 什么是WaterMiner？
WaterMiner是一个窃取计算机资源的组织，通过一个简单但有效的门罗币挖掘机感染受害者。该挖矿软件被设计为隐藏在终端监测工具之后。由于对一些已经成熟的加密货币（如比特币）进行挖矿需要昂贵的专业设备，因此在普通CPU上的效率并不高。然而，门罗币的加密算法特性使其在普通CPU上依然高效。这一特点加上门罗币的匿名性，使其成为网络犯罪分子的理想选择。

攻击者通过将恶意挖矿软件与游戏“mods”捆绑在一起进行传播，主要在一个俄语论坛上传播他们的恶意软件。例如，某个带木马的文件声称能“增强”流行游戏GTA的表现。它以“Arbuz”（俄语中的西瓜）命名并传播到受害者的机器中。几个论坛成员在不同论坛上发布了Trojanized文件的下载链接，并宣传其各种功能，甚至附上VirusTotal扫描结果以证明其安全性。

### 感染过程
Mod与挖矿机的下载器捆绑在一起，并作为一个RAR文件存放在Yandex.Disk（类似于Google Drive或Dropbox的服务）。尽管这个RAR文件提供了游戏mod所声称的功能，但它包含了一个名为“pawncc.exe”的文件。一旦mod运行，该文件就会开始下载加密货币挖矿机恶意软件。

当pawncc.exe在受害者的系统中运行时，它首先确认当前机器是否已感染该恶意软件。如果未感染，它会创建一个感染标记，创建注册表项“HKLM\Software\Intel\Platform”，并将值设为“Nothing”。

然后，pawncc.exe从一个Google Drive链接中下载WaterMiner并将该文件放在temp文件夹中，将感染标记的值设为“loaded”。挖矿机将以名为“Intel (R) Security Assistent.exe”的新进程运行。

如果感染标记的值已经是“loaded”，那么恶意软件将不会继续执行。因此，只需简单地利用注册表项即可阻止该恶意软件运行。

### 早期版本源码
在测试下载器时，Minerva找到了一个特殊的指示器，帮助我们追踪到了Pastebin早期版本的源码。在这段代码中，作者的注释直接提到了“挖矿功能”，显示攻击者有意将挖矿机作为游戏mod的一部分。

从俄语翻译过来后，注释的第一部分与现有功能相关：
- 加载11个挖矿机文件到temp文件夹中
- 加入留存机制
- 隐藏文件和留存机制
- 仅下载挖矿机文件一次

TODO部分的注释表明了即将对挖矿机做的改进：
- 新建一个挖矿机的备份文件
- 利用任务调度程序来做留存
- 将挖矿机作为一个服务来运行以便将其隐藏

### 挖矿机行为
pawncc.exe将挖矿软件下载到受害者的系统中，命名为“%TEMP%\Intel(R) Security Assistent.exe”，并使用RunOnce注册表项确保其在机器重启后继续运行。接着，它开始挖矿并在TCP端口45560上与xmr.pool.minergate.com通信。多个挖矿者通过这些挖矿池合作，共享资源和奖励。目前，有数十个门罗币挖矿池对公众开放。

检查后发现，该挖矿机是开源挖矿机XMRig的一个改进版。XMRig本身并不是恶意软件，但未经许可将其安装在不知情的受害者的系统中用于非法获利则是不合法的。Minerva还遇到了老版本的Dropper，它分发了一个名为Nice Hash的不同挖矿软件。然而，攻击者切换到XMRig可能是因为Nice Hash需要几十个不同的文件才能在受害者的系统上正常运行。

## WaterMiner是如何绕过受害者检查的？
（此处可以进一步补充WaterMiner如何绕过检测的具体技术细节）

希望以上优化后的文本能够更清晰、连贯和专业。如有更多内容需要添加或修改，请随时告知。