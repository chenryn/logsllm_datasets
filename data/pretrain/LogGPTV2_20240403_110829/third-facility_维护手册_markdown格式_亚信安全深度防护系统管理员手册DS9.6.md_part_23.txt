### 备份
每个租户的数据可能遵循不同的备份策略。这对于分段和生产环境中的租户非常有用，因为分段环境对备份的要求通常不那么严格。备份操作由亚信安全服务器深度安全防护系统管理中心的管理员负责。

### 负载均衡
负载均衡功能有助于日后重新平衡数据库服务器上的负载，确保所有数据库服务器之间的负载均衡。

### 启用多租户

#### 启用多租户
1. 在亚信安全服务器深度安全防护系统管理中心中，转至 **管理 >> 系统设置 >> 高级**，并单击 **多租户选项** 区域中的 **启用多租户** 以显示 **多租户配置向导**。
2. 输入销售代表提供的激活码，然后单击 **下一步**。
3. 选择要实施的使用授权模式：
   - **从主租户继承使用授权**：为所有租户授予与主租户相同的使用授权。如果您在分段环境中进行多租户测试或为同一企业的不同部门设置租户，建议使用此选项。
   - **每租户使用授权**：提供亚信安全服务器深度安全防护系统作为服务时，建议使用此模式。如果使用此方式配置，则需要在创建租户帐户（通过 API）时提供使用授权，或由租户在首次登录时输入使用授权。
4. 单击 **下一步** 完成在亚信安全服务器深度安全防护系统管理中心中启用多租户。
5. 将显示 **管理 >> 系统设置 >> 租户** 页面。在此页面上可以配置多租户的选项设置。有关详细信息，请参考该页面的联机帮助。

### 管理租户

#### 创建新租户
1. 转至 **管理 >> 租户** 页面，然后单击 **新建** 以显示 **新建租户向导**。
2. 输入租户帐户名称。帐户名称可以是任意名称，但不能是“Primary”（用于主租户）。
3. 输入电子邮件地址。每个租户都需要一个联系点，并且电子邮件地址还用于生成用户帐户。
4. 选择语言环境。这将确定适用于该租户的亚信安全服务器深度安全防护系统管理中心用户界面语言。
5. 选择时区。所有与租户相关的事件将在该租户帐户的时区中显示。
6. 如果安装了多个数据库，可以选择让系统自动选择存储新租户帐户的数据库服务器（“自动 -- 无首选项”），或者指定特定的服务器。
7. 输入新租户帐户首个用户的用户名。
8. 选择以下三个密码选项之一：
   - **无电子邮件**：在此处定义租户首个用户的用户名和密码，不发送电子邮件。
   - **电子邮件确认链接**：您设置租户首个用户的密码。用户必须单击通过电子邮件收到的确认链接后才能激活帐户。
   - **电子邮件生成的密码**：允许您在未指定密码的情况下生成租户。手动创建不需要访问权限的用户帐户时，此选项最适用。
9. 单击 **下一步** 完成向导并创建租户。创建新租户数据库并填充数据和示例策略可能需要 30 秒到 4 分钟。

### 发送给租户的邮件示例
- **电子邮件确认链接**：帐户确认请求
  ```
  欢迎使用亚信安全服务器深度安全防护系统！要开始使用您的帐户，请单击以下确认 URL。然后，您可以使用所选的密码访问控制台。
  帐户名称：AnyCo
  用户名：admin
  单击以下 URL 激活您的帐户：
  https://managername:4119/SignIn.screen?confirmation=1A16EC7A-D84F-D451-05F6-706095B6F646&tenantAccount=AnyCo&username=admin
  ```

- **电子邮件生成的密码**
  - **第一封电子邮件**：帐户和用户名通知
    ```
    欢迎使用亚信安全服务器深度安全防护系统！已为您创建一个新帐户。您的密码将生成，并在一封单独的电子邮件中提供。
    帐户名称：AnyCo
    用户名：admin
    可以使用以下 URL 访问亚信安全服务器深度安全防护系统管理控制台：
    https://managername:4119/SignIn.screen?tenantAccount=AnyCo&username=admin
    ```
  - **第二封电子邮件**：密码通知
    ```
    这是为您的亚信安全服务器深度安全防护系统帐户自动生成的密码。您的帐户名、用户名和用于访问亚信安全服务器深度安全防护系统管理控制台的链接将在一封单独的电子邮件中提供。
    密码：z3IgRUQ0jaFi
    ```

### 租户状态
**租户页面**（**管理 >> 租户**）显示所有租户的列表。租户可处于以下任一状态：
- **已创建**：正在创建，但尚未激活
- **需要确认**：已创建，但尚未单击发送给租户用户的确认电子邮件中的激活链接。（您可以手动覆盖此状态。）
- **活动**：完全在线且受管
- **已挂起**：不再接受登录。
- **待删除**：可将租户删除，但未立即执行。移除数据库之前，租户将处于待删除状态约 7 天。
- **数据库升级失败**：用于路径升级失败的租户。“数据库升级”按钮可用于解决此问题

### 租户属性
双击租户可以查看租户的属性窗口。

#### 常规
- 可更改租户的语言环境、时区和状态。请注意，更改时区和语言环境不影响现有的租户用户。它将仅影响此租户中的新用户以及非用户特定的 UI 中的事件和其他部分。
- 数据库名称表示该租户所用的数据库的名称。可通过超链接访问数据库运行的服务器。

#### 模块
- **模块** 选项卡提供了用于保护模块可见性的选项。默认情况下，将隐藏所有未经授权的模块。可通过取消选中 **始终隐藏未经授权的模块** 来更改此设置。此外，可以每个租户为基础显示所选模块。
- 如果选中 **从主租户继承使用授权**，则授权给您（主租户）的所有功能将对所有租户可见。所选的可见性可用于调整哪些模块对于哪些租户可见。
- 如果使用的是“每租户”使用授权，则在默认情况下将仅显示对每个租户授权的模块。
- 如果您在测试环境中评估亚信安全服务器深度安全防护系统，并希望查看完整的多租户安装，您可以启用多租户演示模式。处于演示模式时，管理中心使用模拟租户、计算机、事件、警报和其他数据填充其数据库。最初生成七天的数据，但会不断生成新数据以使用这些数据填充管理中心的“控制台”、“报告”和“事件”页面。
- **注意**：演示模式不能用于生产环境！

#### 统计
- **统计信息** 选项卡显示当前租户的信息，包括数据库大小、处理的作业、登录、安全事件和系统事件。火花线图可快速显示过去 24 小时的信息。

#### 客户端激活
- **客户端激活** 选项卡显示了一个可从此租户计算机的客户端安装目录运行的命令，此命令将在计算机上激活客户端以便租户可以分配策略并从亚信安全服务器深度安全防护系统管理中心执行其他配置过程。

### 租户用户体验
启用多租户后，登录页面将显示另一个 **帐户名称** 文本框：
- 需要租户输入其帐户名称以及用户名和密码。帐户名称允许租户使用重叠的用户名。（例如，如果多个租户与同一台 Active Directory 服务器同步）。
- **注意**：当您（作为主租户）登录时，请将帐户名称留空或使用“主”。

### 租户隐藏的功能
- 当租户登录时，某些功能对租户用户不可用。已对租户隐藏以下区域：
  - 管理中心节点小部件
  - 多租户小部件
  - 管理 > 系统信息
  - 管理 > 使用授权（如果选中“继承”选项）
  - 管理 > 管理中心节点
  - 管理 > 租户
  - 管理 > 系统设置：
    - 租户选项卡
    - 安全选项卡 > 登录消息
    - 更新选项卡 > 允许租户使用主租户中继的设置
    - 高级选项卡 > 负载平衡器
    - 高级选项卡 > 插件部分
  - 帮助中的一些内容不适用于租户
  - 一些报告不适用于租户
  - 基于多租户选项的其他功能（稍后讨论）

### 租户警报
- 还将对租户隐藏某些警报类型：
  - 波动信号服务器不成功
  - 磁盘空间不足
  - 管理中心脱机
  - 管理中心时间不同步
  - 现已推出较新版本的亚信安全服务器深度安全防护系统管理中心
  - 计算机数量超过数据库限制
  - 当在所有使用授权相关警报中启用继承的使用授权时

### 注意事项
- 租户无法查看主租户的任何多租户功能或任何其他租户的任何数据。此外，某些 API 受到限制，只能用于主租户权限（如创建其他租户）。
- 有关租户用户可用与不可用的功能的更多信息，请参阅 **管理 >> 系统设置 >> 租户**。
- 所有租户均可在多个用户帐户中使用基于角色的访问控制，以进一步细分访问权限。此外，他们可以将 Active Directory 集成用于用户，以将认证委派到域。每次进行租户认证时仍需要输入租户帐户名称。

### 客户端启动的激活
- 默认情况下，为所有租户启用客户端启动的激活。
- **注意**：不同于主租户的客户端启动的激活，需要密码和租户 ID 才能调用租户用户的激活。
- 租户可以查看客户端启动的激活所需的参数，方法是单击 **管理 >> 更新 >> 软件 >> 本地**，选择客户端软件，然后单击 **生成部署脚本** 按钮。例如，Windows 计算机上客户端启动的激活的脚本示例如下所示：
  ```shell
  dsa_control -a dsm://manageraddress:4120/ "tenantID:7156CF5A-D130-29F4-5FE1-8AFD12E0EC02" "tenantPassword:98785384-3966-B729-1418-3E2A7197D0D5"
  ```

### 租户诊断
- 由于软件包中包含敏感数据，租户无法访问管理中心诊断包。租户仍然可以通过打开计算机编辑器，然后选择 **概述页处理措施** 选项卡上的 **客户端诊断** 来生成客户端诊断。

### 使用情况监控
- 亚信安全服务器深度安全防护系统管理中心记录关于租户使用情况的数据。将在控制台的 **租户防护活动** 小部件、租户属性窗口的 **统计信息** 选项卡和退款报告中显示此信息。另外，也可通过状态监控 REST API 访问此信息。转至 **管理 >> 系统设置 >> 高级 >> 状态监控 API** 可启用或禁用此 API。
- 可定制此退款（或审查）信息，以确定记录中包含哪些属性。此配置旨在调整服务提供程序环境中可能需要的各种收费模式。这在企业确定每个业务部门的使用情况方面非常有用。

### 多租户控制台/报告
- 启用多租户后，主租户用户可访问其他控制台小部件以监控租户活动。与租户相关的某些小部件示例如下：
- 在 **管理 >> 租户** 页面（有些在可选列中）以及租户属性窗口的 **统计信息** 选项卡上会提供相同的信息。
- 此信息提供监控整个系统使用情况和查找异常活动指示的功能。例如，如果租户遇到安全事件活动急剧增多的情况，则可能受到攻击。
- **退款报告**（位于 **事件 && 报告** 部分）提供了更多信息。此报告详细介绍了每个租户的防护时长、当前数据库大小和计算机数量（激活的和未激活的）。

### 多租户（高级）

#### 配置数据库用户帐户
- **注意**：
  - SQL Server 和 Oracle 在数据库概念中使用不同的术语。
  - **SQL Server** 和 **Oracle** 的术语对照表如下：
    | SQL Server            | Oracle                |
    |-----------------------|-----------------------|
    | 多个租户执行的进程    | 数据库服务器          |
    | 一个租户的数据集      | 数据库                |
    | 表空间/用户           | 表空间/用户           |

- 以下部分在 SQL Server 和 Oracle 二者中都使用了 SQL Server 术语。
- **SQL Server**
  - 由于多租户要求软件能够创建数据库，因此在 SQL Server 上需要使用 `dbcreator` 角色。例如：
  - 对于主租户的用户角色，必须向主数据库分配 DB 所有者。