p(1]
值：222
p[2]
值：444
p(2)
值：444
p(3]
值：555
追加的元素
p(3)
值：555
p(4]
值：666
p(4]
值：777
p(5]
通过移动元素
p(5)
值：666
图4-14单纯使用数组的情况下的元索追加
---
## Page 93
4.7二叉查找树使数据推索更有效
4.7
二叉查找树使数据搜索更有效
二叉查找树是指在链表的基础上往数组中追加元素时，考虑到数
据的大小关系，将其分成左右两个方向的表现形式。例如，假设我们
事先把50这个值保存到了数组中。那么，如果接下来的值比先前保存
的数值大的话，就要将其放到右边，反之如果小的话就放在左边。但
实际的内存并不会分成两个方向，这是在程序逻辑上实现的（图4-15）。
50
接到大的数据
链接到小的数据
图415二叉查找树的模型（将树颜倒后的形状）
为了实现二叉查找树，怎么处理比较好呢？其实数组的每个元素
中只要有数据的值和两个索引信息就可以了。图4-16向我们展示了如
何用数组来实现图4-14中的二叉查找树。二叉查找树是由链表构造发
展而来的表现形式，因此在追加或删除元素方面也同样是有效的。
使用二叉查找树的便利之处在于可以使数据的搜索等更有效率。
在使用一般的数组时，必须从数组的开头按照索引顺序来查找目标数
据。面使用二叉查找树时，当目标数据比现在读出来的数据小时就可
以转到左侧，反之目标数据较大时即可转到链表的右侧，这样就加快
了找到目标数据的速度。
①树（trce）构造指的是数据像树一样分叉连接的方式。二叉查我树也是树构
造的一种。
---
## Page 94
题4章熟练使用有楼有角的内存
只要在程序开发中多花一些心思，我们就可以熟练地使用内存
实现栈处理、链表处理、二叉查找树处理等，这一点想必大家都清楚
了。不过，大家还必须理解为什么要进行这些处理。另外，请大家牢
记数组是进行这些处理的基础。
值：50
q|0]
左边的元素：1
链表的开头
右边的元素：4
q[1]
值：30
左边的元素：2
右边的元素：3
值：17
q[2]
左边的元素
右边的元素：-1
-1
值：41
链接到大的数据
q[3]
左边的元素
-1
右边的元素：-1
链接到小的数据
值：75
q[4]
左边的元素：5
右边的元素：6
q(5]
左边的元素：-1
值：63
右边的元素-1
左边的元素：
值：84
q61
右边的元素：-1
-1
图416使用数组来实现二叉查找树
下一章，我们将会介绍磁盘。和内存一样，磁盘也是用于存储数
据的。磁盘虽然在物理方面只能以扇区为单位进行读写，但通过在程
序中多花一些心思，磁盘也可以以各种形态来使用。此外，我们也会
对用磁盘替代内存来使用的虚拟内存进行说明。
---
## Page 95
5
第
章
内存和磁盘的亲密关系
热身间答
阅读正文前，让我们先回答下面的问题来热热身吧。
1.存储程序方式指的是什么？
2.通过使用内存来提高磁盘访问速度的机制称为什么？
3.把磁盘的一部分作为假想内存来使用的机制称为什么？
4.Windows中，在程序运行时，存储着可以动态加载调用的
函数和数据的文件称为什么？
5.在EXE程序文件中，静态加载函数的方式称为什么？
6.在Windows计算机中，一般磁盘的1个扇区是多少字节？
更多资料请关注裁的新浪薄客t
---
## Page 96
第5章内存和碰盘的亲密关系
怎么样？是不是发现有一些问题无法简单地解释清楚呢？下面
是笔者的答案和解析，供大家参考。
1.在存储装置中保存程序，并逐一运行的方式
2.DiskCache（磁盘缓存）
3.虚拟内存（virtualmemory）
4.DLL（DLL文件）
5.静态链接
6.512字节
解析·
1.现在计算机采用的是存储程序方式。
2.磁盘缓存是指，把从磁盘中读出的数据存储在内存中，当该数
据再次被读取时，不是从磁盘面是直接从内存中高速读出。
3.借助虚拟内存，哪怕是内存容量不足的计算机，也可以运行很
大的程序。
4.DLL 是Dynamic Link Liabrary 的略称。
5.函数的加载方式有静态链接和动态链接两种。
6.扇区是磁盘保存数据的物理单位。
---
## Page 97
5.1不读入内存就无法运行
本章
重点
从都具有存储程序命令和数据这点来看，内存和
磁盘的功能是相同的。在计算机的5大部件”中，内存
和磁盘也都被归类为存储部件。不过，利用电流来实现存储的内存，
同利用磁效应来实现存储的磁盘，还是有差异的。而从存储容量来看，
内存是高速高价，而磁盘则是低速廉价。
大家平时使用的计算机，至少都配备了512M大小的内存和80GB
大小的磁盘。在计算机这个系统中，高速小容量的内存与低速高容量
的磁盘进行协同作业。本章就让我们来看一下内存和磁盘的亲密关系。
在下文中，内存主要是指主内存（负责存储CPU中运行的程序指令和
数据的内存），磁盘主要是指硬盘。
5.1
不读入内存就无法运行
考虑内存和磁盘的关系之前，我们首先来看一个前提性的问题。
程序保存在存储设备中，通过有序地被读出来实现运行，这一点
大家都很清楚。这一机制称为存储程序方式（程序内置方式），现在看
来这是理所当然的，但在当时它的提出可以说是一个里程碑。为什么
这么说呢？因为在此以前的程序都是通过改变计算机的布线等来变更
程序的。
计算机中主要的存储部件是内存和磁盘。磁盘中存储的程序，必
须要加载到内存后才能运行。在磁盘中保存的原始程序是无法直接运
行的。这是因为，负责解析和运行程序内容的CPU，需要通过内部程
①一般把输入装置、输出装置、存储器、运算器和控制器这5种部件设备称
为计算机的5大部件。
---
## Page 98
第5章内存和磁盘的亲密关系
序计数器来指定内存地址，然后才能读出程序。即使CPU可以直接读
出并运行磁盘中保存的程序，由于磁盘读取速度慢，程序的运行速度
还是会降低。总之，存储在磁盘中的程序需要读人到内存后才能运行。
在考虑内存和磁盘的关系之前，大家一定要了解这个前提（图5-1）。
CPU
内存
（1）加载
程序
程序
图5-1程序要加载到内存后才开始运行
在这个大前提的基础上、内存和磁盘之间存在着许多亲密关系。
接下来我们逐一说明。
5.2础盘缓存加快了磁盘访问速度
作为体现内存和磁盘亲密关系的第一个示例，首先让我们来看一
下磁盘缓存（diskcache）。磁盘缓存指的是把从磁盘中读出的数据存储
到内存空间中的方式。这样一来，当接下来需要读取同一数据时，就
不用通过实际的磁盘，面是从磁盘缓存中把内容读出。使用磁盘缓存
可以大大改善磁盘数据的访问速度（图5-2）。
①详情请参考第1章。
②磁盘缓存的缓存（cache）是高递缓存、仓库的意思。
---
## Page 99
5.3虚拟内存把班盘作为部分内存来使用
使用数据的应用
（1）首次读出时从磁盘读出
（3）再次读取同一
[低速]
数据时从内存
（2）保存读出的
读出（高速）
数据
数据
数据
磁盘
内存的一部分
[磁盘堰存）
图5-2硬盘缓存提高访问速度的机制
Windows提供了磁盘缓存机制作为操作系统。不过，对普通用户
来说，磁盘缓存发挥显著效果的时代只延续到Windows95/98。现在，随
着硬盘访问速度的大幅改善，磁盘缓存的效果也没有之前那么明显了。
把低速设备的数据保存在高速设备中，需要时可以直接将其从高
速设备中读出，这种缓存的方式在其他情况下也会用到。其中的一个
实例就是在Web浏览器中的使用。由于Web浏览器是通过网络来获取
远程Web服务器的数据并将其显示出来的。因此，在显示较大的图片
等文件时，会花费不少时间。于是，Web测览器就可以把获取的数据
暂时保存在磁盘中，然后在需要时再显示磁盘中的数据。也就是说，
把低速的网络数据保存到相对高速的磁盘中。
5.3虚拟内存把磁盘作为部分内存来使用
接下来就让我们来看一下体现内存和磁盘亲密关系的第二个示例，
即虚拟内存（virtualmemory）。虚拟内存是指把磁盘的一部分作为假想
的内存来使用。这与磁盘缓存是假想的磁盘（实际上是内存）相对，虚
拟内存是假想的内存（实际上是磁盘）。
---
## Page 100
第5章内存和磁盘的亲密关系
通过借助虚拟内存，在内存不足时也可以运行程序。例如，在只
剩下5MB内存空间的情况下也能运行10MB大小的程序。不过，就如
本章开头所讲述的那样，CPU只能执行加载到内存中的程序。虚拟内
存虽说是把磁盘作为内存的一部分来使用，但实际上正在运行的程序
部分，在这个时间点上是必须存在在内存中的。也就是说，为了实现
虚拟内存，就必须把实际内存（也可称为物理内存）的内容，和磁盘上
的虚拟内存的内容进行部分置换（swap），并同时运行程序。
刚才已经说过，Windows提供了虚拟内存机制作为操作系统。在
当前的Windows中，虚拟内存依然发挥着很大的作用。虚拟内存的方
法有分页式和分段式两种。Windows采用的是分页式。该方式是指，
在不考虑程序构造的情况下，把运行的程序按照一定大小的页（page）
进行分割，并以页为单位在内存和磁盘间进行置换。在分页式中。我
们把磁盘的内容读出到内存称为Pageln，把内存的内容写人磁盘称为
Page Out。一般情况下，Windows计算机的页的大小是4KB。也就是
说，把大程序用4KB的页来进行切分，并以页为单位放人磁盘（虚拟
内存）或内存中（图5-3）。
为了实现虚拟内存功能，Windows在磁盘上提供了虚拟内存用的
文件（pagefile，页文件）。该文件由Windows自动做成和管理。文件
的大小也就是虚拟内存的大小，通常是实际内存的相同程度至两倍程
度。通过Windows的控制面板，可以查看或变更当前虚拟内存的设定。
下面就让我们来看一下虚拟内存的设定。作者自己的计算机是
2GB的内存。当前的页文件的大小是2345MB2GB（图5-4）
①分投式虚拟内存是指，把要选行的程序分割成以处理集合及数据集合等为
单位的段落，然后再以分割后的段落为单位在内存和碰盘之间进行数据
置换。
---
## Page 101
5.3虚拟内存把阻盘作为部分内存来使用
量=虚抑内存
内存
Page1