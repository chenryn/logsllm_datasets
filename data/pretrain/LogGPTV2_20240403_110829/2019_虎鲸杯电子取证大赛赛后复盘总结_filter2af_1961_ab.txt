  * 或者如果对这些重组的知识不太了解的话， **也可以使用取证大师的 “自动计算磁盘序列” 功能来逐个尝试** ，若可以正常打开文件说明重组后是准确的。
经过 RAID 重组之后就可以对服务器镜像取证了，服务器的取证主要可以分为以下几个方向：
exe 恶意代码分析  
Apache 日志分析  
数据库分析
  * **服务器的基本信息** ：
  1. 内网 IP：192.168.4.99
  2. 操作系统：windows server 2012
  3. 最后一次异常关机时间：2019-03-29 20:26:28
###  **exe** **恶意程序逆向分析**
RAID 排列完成、取证大师自动取证后， **在系统桌面上就可以发现一个名字为 malware.zip 的文件比较可疑** ，把他导出解压出来得到一个
services.exe 文件。看名字就像一个后门木马文件
再回头看题目，这里就是需要我们对这个恶意程序进行逆向分析来发现一些信息。
  1. **静态调试**  
先使用 IDA 加载恶意程序进行静态分析，在 main 函数中简单分析一下就可以知道 **程序做了修改注册表以及打开服务的操作** 。
    if ( strstr(v13, "Gh0st Update") )
             {
               Sleep(5000u);
    LABEL_11:
               SetUnhandledExceptionFilter(TopLevelExceptionFilter);
               sub_401CA0();
               sub_402590(hInstance);
               v16 = sub_402150(v10, v12, v5);
               if ( v16 )
               {
                 memset(&Filename, 0, 0x104u);
                 GetModuleFileNameA(0, &Filename, 0x104u);
                 wsprintfA(&SubKey, "SYSTEM\CurrentControlSet\Services\%s", v16);
                 v17 = lstrlenA(&Filename);
                 open_regedit(HKEY_LOCAL_MACHINE, &SubKey, "InstallModule", 1u, &Filename, v17, 0);   //修改注册表
                 open_service(v16);       //打开服务
                 operator delete(v16);
                 operator delete(v10);
                 operator delete(v12);
               }
               ExitProcess(0);
             }
在 sub_402150 函数中跟进，在里面发现篡改了 Svchost 的注册表来实现自启动和开启服务，所以很明显这个是个 svchost
后门，后面注入了恶意 DLL 到某个目录中。
  * 参考：
dll 的文件名是通过动态拼接的，只能通过 OD/windbg 动态调试才可以得到。
在这个函数下面还进行了 CreateServiceA 的操作。
  1. **动态调试**
根据上面参考文章，把程序跑起来，在 HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services
中，看到键值对信息，这里确实是留了一个 svchost 的后门
在下面的 Paramters 键中可以发现后门运行释放后的文件位置和文件名。
还有一个 dll 文件位于 C:\Windows\System32\Iasex.dll，所以总共释放了两个 DLL 文件。
在任务管理器和 netstat 中，查看相应的网络连接就可以知道木马的回传 IP 地址 178.56.94.77，是一个波兰的国外 IP。
###  **数据库分析**
题目中有一个选择题为：
通过对服务器S1进行取证分析，得知修改网站管理员密码的IP地址是？
这边就需要对服务器的 www 网站下的数据进行分析，在取证大师中将整个 D:\Phpstudy 目录导出到本地。
要找到修改了管理员密码的 IP 地址，有两个方向可以选择， **一个是在 Apache 日志中查找，一个是在数据库查看是否有相应的记录。**
这里找了 Apache 的日志，发现都没有相关的 IP 记录，可能是已经被删除了。所以这里需要在 Mysql 数据库查找信息。
**导出服务器数据库**
在分析之前需要先找到网站应用的数据库位置。在 www 目录下可知这个应用是 eyoucms 的，网站的数据库存储在
phpStudy\PHPTutorial\MySQL\data\eyoucms 目录下， **目录下的文件都是 MYD 和 MYI
格式的文件，无法直接打开** 。
这里有两种方法可以导出数据库，一种是在上一级的 bin 目录里找到 mysqldump.exe ，使用命令 mysqldump -uroot -proot
> name.sql 来导出数据库，但是这里的 mysql 的密码无法得知。
所以这里可以采用第二种方法：把 eyoucms 整个目录复制到本地数据库，例如我这里用的是 wamp 的 mysql 数据库，找到相应的文件夹复制到
data 目录下即可。
这里在数据库管理中就多了一个名字为 eyoucms 的数据库。打开数据表之后，所以很明显这里是使用 admin 管理员用户进行操作，登录的 IP
也就可以知道了。IP：192. 168.4.129
  * 显然，这是服务器被入侵之后的黑客操作。这里的 IP 是一个内网 IP，所以很可能黑客是进入了内网进行了内网漫游。
###  **Apache** **日志分析**
Apache 的日志分析比较简单，直接将 phpStudy\PHPTutorial\Apache\logs\access.log 文件加载到
Notepad++ 中，使用软件自带的搜索统计功能并配合正则表达式，就可以回答题目中关于日志文件的数据分析。
1 . 访问文件的目标 IP
**搜索语法：**
2019:15:48:45(.+?)9c0df*
这里只有一条记录，IP 为 192.168.4.36
2 . IP：162.135.124.177 的 POST 请求的条数
**搜索语法：**
162.135.124.177(.+?)”POST
**点击计数，这里发现有 34 条匹配的记录** ，因为每一条访问请求在 access.log 中有两条记录（另一条记录了整条 URL 和 User-Agent 的信息），所以这里实际的访问 POST 请求只有 17 条。
3 . 加载 loading.gif 文件并出现 304 的 71.25.66.XX IP 段的记录条数
**搜索语法：**
71.25.66(.+?)loading.gif(.+?)304
有 6 条记录， **依然除以 2 才是实际的条数，为 3 条** 。
**其他一些问题**
还有一些题目中的一些小问题需要解决一下。
比如其中有一个问题是要找到用大疆无人机进行拍摄的照片。
这里的有一个解法是在动态仿真时的 D 盘下某个文件夹下可以找到一张这样的照片（查看照片的 EXIF 信息，大疆无人机 FC220）， **所以可以根据
FC220 这个字符串在取证大师中进行全局搜索** 。
另一种解法是在取证大师中找到某个 TC 加密的文件（PrvDisks.cmt），导出到本地以后使用 TC 密码解密（密码在 D 盘的 important
目录下）
解密后挂载到本地的某个盘符下，进入文件夹下就可以看到所有处理过的图片了。
另一个是需要找到嫌疑人 e 的交易收入额，这个收入额信息是存放在 D:\important 的 person123.xls 中。
发现是加密的文件，考虑到是 Office 2003 加密，可以暴力破解一波，使用 AOPR 很快就破解出 person123.xls 文档的密码：
10942
解密以后就是这些信息了。
将 D:\important 目录下的 “账号信息.doc”
导出，修复文件头，得到薛哥的海外账号后5位，结合视频的前几位，得到薛建华完整的账号：Q328527801
## 案情总结
将上面的基本信息都收集的差不多了之后，就可以整体分析整个案情的来龙去脉。这里采用回溯的方法一步步往回分析。
**人物关系：**
**事件关联：**
整体来看， **就是通过网站入侵事件找到其背后的一个黑产团队** 。
最后放出官方的解答，有一两点小问题还没有解决，例如地下钱庄的加密压缩数据库、销售人员名单。有知道怎么找到这玩意的大佬麻烦请指点一二~
## 总结
从整个答案的分布来看线索还是比较清晰，而且所给的证据文件也还是比较合理的。比较重要的就是对基础知识的熟悉以及对整个案情思路的整合和归纳。
**相关的脑图文件：**
链接：https://pan.baidu.com/s/177BsmG3QHTFicg3JN0hK6g
提取码：4pcq
**参考资料**