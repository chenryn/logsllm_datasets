### 盖茨木马分析
#### 概述
Billgates木马攻击是Linux系统中主流的木马攻击类型，主要用于DDoS攻击或挖矿。以下对Billgates中近期出现的攻击情况进行分析。
2018年7月30日安恒安全数据大脑团队在某蜜罐平台中，捕获了一种DDoS木马。其来源IP为61.178.179.93，通过对SSH爆破，进入蜜罐伪装的文件系统，并下载一个能使机器变为攻击者肉鸡的木马文件，从而可发起DDoS攻击。
其木马文件的情况如下：
图3-1 某DDoS木马文件
分析可见，攻击者一共下载了三次，成功了一次。
####  入侵过程
黑客首先对开放的SSH服务，通常是登录22端口进行爆破，爆破后进入蜜罐伪装的文件系统，进入系统后，该攻击者首先关闭了防火墙，然后从源IP
61.178.179.93的45454端口获取木马，并且反复启动该木马程序。
图3-2 源IP获取木马并反复启动木马程序
该木马下载路径如下：http://61.178.179.93:45454/Hoogp，目前该路径可以访问与下载：
图3-3 木马访问与下载界面
该木马下载IP 61.178.179.93来自中国甘肃，曾发起过网络攻击行为，并被安恒威胁情报中心标记为恶意软件站点。
图3-4 木马详细信息
通过对Hoogp样本分析发现其为一个恶意文件，同时多款杀毒软件也检测出其为后门和DDoS。
图3-5 多款杀毒软件监测结果
####  通信行为
我们进一步对文件的通信行为进行分析，发现其关联的域名是:xunyi-gov.cn和DDoS.xunyi-gov.cn，其域名xunyi-gov.cn已被标记为 BillGates 僵尸网络。
网站下存在5个子域名，分别为：blog.xunyi-gov.cn；hack.xunyi-gov.cn；[www.xunyi-gov.cn](http://www.xunyi-gov.cn)；DDoS.xunyi-gov.cn；s.xunyi-gov.cn。其子域名大多被标记为远控或恶意软件。
表3-1 域名xunyi-gov.cn关联分析
图3-7 该木马存在的通信样本
对另一个关联域名进行反查：DDoS.xunyi-gov.cn，发现仍然被标记为恶意软件通信相关：
图：3-8 域名反查
另外根据关联关系分析结果如下，发现该组织对批量的恶意域名通信控制，捕获大量主机，推测其为一定规模的黑客组织行为。
表3-2 域名DDoS.xunyi-gov.cn关联分析
###  树莓派(Raspberry)木马分析
####  概述
树莓派是在2017年推出的一款单片机计算机，一款只有信用卡大小且系统底层基于Linux的微型电脑。
2018年7月31日，安恒安全数据大脑团队在某蜜罐系统发现攻击者留下的针对树莓派系统进行入侵与挖矿的恶意文件，通过分析日志发现，攻击IP为121.153.206.110，位于韩国。
####  入侵过程
该攻击者于2018-7-31 14:17:37，通过树莓派默认账号pi和弱口令，登入了蜜罐。
图3-10 攻击者使用弱口令登录蜜罐平台
通过进一步查看攻击者执行的指令可以发现，其通过 scp指令获取了一个名为”E7wWc5ku”的文件，并将其保存在/tmp 下。随后进入
tmp目录赋予该文件可执行权限，调用 bash脚本执行这个文件。
####  行为分析
我们随后对该Shell脚本的完整内容获取并进行了分析，该脚本在杀死一堆其他的挖矿进程以及占用系统资源的进程后，将进行挖矿。
杀死一堆其他挖矿程序与进程：
图3-11 攻击者进程分析
随后将一个可疑地址加入到/etc/hosts，将本地地址解析到bins.deutschland-zahlung.eu。接着删除shell设置的环境变量，并且改掉pi用户的密码信息，ssh生成公钥写入ssh配置文件。指定DNS，写入了一个可疑的EOF
MARKER文件，其中有一串可疑的域名，分析认为是IRC服务器；
图3-12 攻击者进程分析(2)
接着在后台挂起了这个EOF MARKER文件，并下载了zmap 和sshpass，利用 zmap
进行内网探测，继续利用当前机器，以”pi:praspberry”和”pi:praspberryaspberry993311”这样的口令去扫描IP
列表下的其他机器，一旦攻入则通过scp上传攻击脚本。
图3-13 攻击者进程分析(3)
## 安全治理刻不容缓
通过本文分析的当前Linux系统面临的主流威胁情况，为后续对系统的规范化管理与治理提供了可靠的依据。
###  日常安全运维规范
从当前互联网中系统远程服务或数据库端口暴露，被爆破情况严重的情况分析来看，服务器的系统端口需加强规范化管理。在日常运维中，需要避免不必要的应用端口对外开放，尤其是远程服务端口、数据库应用等极易被探测爆破的类型，如必须开放则做好网络访问控制，也可免遭非法地址发起的攻击行为。规范化管理端口的操作简易，但是却收效显著。
###  物联网终端设备的安全规范
大量物联网设备的底层系统采用了Linux，相比于传统的服务器运维管理，由于发展时间短，管理机制不够成熟，这类系统的安全十分薄弱，管理配置混乱，尤其是以默认账号密码问题尤为突出，无论是过去爆发的摄像头黑天鹅事件，还是物联网终端设备发起的DDoS攻击导致美国断网事件，都充分暴露了系统安全开发、配置、管理的不规范，因此对物联网终端的设备安全规范管理规范亟需推进，强制检测产品的安全规范。
###  僵尸主机的感知与治理
目前网络中已经存在了大量的僵尸主机，由于缺乏对网络中存在僵尸主机的检测机制，企业网络、IDC机房、各类公/私有云，都面临着主机长期被控失陷而不自知的问题，这一现象又纵容了黑客肆意捕获肉鸡，进行DDoS、挖矿、内网渗透等行为。因此，采用新型的僵尸主机检测方式，探测网络内是否存在系统失陷的安全问题成为当下最需要解决的问题。
威胁情报通过对互联网中的流量数据的捕获与国内外共享情报的分析，可广泛识别网络中的僵尸主机，提取出被恶意主机控制的失陷主机地址，可有效协助区域监管单位或组织机构发现内部网络中是否有被控僵尸主机，开展清理工作，防止持续被控造成不可估量的损失。