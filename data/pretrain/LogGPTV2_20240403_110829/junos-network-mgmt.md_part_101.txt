host sfc0-master {
any info;
}
Interpret Messages Generated in Standard Format
The syntax of a standard-format message generated by a Junos OS process or subroutine library
depends on whether it includes the below priority informations:
• When the explicit-priority statement is included at the [filename] or [hostname] hierarchy level, a
system log message has the following syntax:
timestamp message-source: %facility–severity–TAG: message-text
1262
• When directed to the console or to users, or when the explicit-priority statement is not included for
files or remote hosts, a system log message has the following syntax:
timestamp message-source: TAG: message-text
Table 128 on page 1262 describes the message fields.
Table 128: Fields in Standard-Format Messages
Field Description
timestamp Time at which the message was logged.
message- Identifier of the process or component that generates the message and the routing platform on
source which the message was logged. For Junos OS, this field includes two or more subfields:
hostname, process and process ID (PID). For Junos OS Evolved, this field includes a hostname
with an appended node name, a process name, and PID. If the alternate-format statement is
configured at the [edit system syslog] hierarchy level on a Junos OS Evolved device, the node
name is not appended to the hostname, but is prepended to the process name instead. The
alternate message format for Junos OS Evolved ensures the same hostname format as Junos OS
messages. If the process does not report its PID, the PID is not displayed. The message source
subfields are displayed in the following format:
hostname process[process-ID]
facility Code that specifies the facility to which the system log message belongs. For a mapping of
codes to facility names, see Table: Facility Codes Reported in Priority Information in "Including
Priority Information in System Log Messages" on page 1276.
severity Numerical code that represents the severity level assigned to the system log message. For a
mapping of codes to severity names, see Table: Numerical Codes for Severity Levels Reported in
Priority Information in "Including Priority Information in System Log Messages" on page 1276.
TAG Text string that uniquely identifies the message, in all uppercase letters and using the
underscore (_) to separate words. The tag name begins with a prefix that indicates the
generating software process or library. The entries in this reference are ordered alphabetically
by this prefix.
Not all processes on a routing platform use tags, so this field does not always appear.
1263
Table 128: Fields in Standard-Format Messages (Continued)
Field Description
message-text Text of the message.
Manage Host OS System Log and Core Files
IN THIS SECTION
View Log Files On the Host OS System | 1264
Copy Log Files From the Host System To the Switch | 1264
View Core Files On the Host OS System | 1264
Copy Core Files From the Host System To the Switch | 1265
Clean Up Temporary Files on the Host OS | 1265
On Junos OS switches with a host OS, the Junos OS might generates system log messages (also called
syslog messages) to record events that occur on the switch, including the following:
• Routine operations, such as a user login into the configuration database.
• Failure and error conditions.
• Emergency or critical conditions, such as power-down of the switch due to excessive temperature.
On OCX Series switches:
• System log messages are logged in the /var/log/dcpfe.log file in the host OS in the following
scenarios:
• When the forwarding daemon is initialized.
• Messages are tagged as emergency (LOG_EMERG). A copy of the message is also sent to
the /var/log directory on the switch.
• Messages from processes are available on the host system in the /var/log directory. System log
messages from the host chassis management process are recorded in the lcmd.log file in the /var/log
directory.
1264
On QFX switches with a host OS:
• The Junos OS and host OS record log messages for system and process events, and generate core
files upon certain system failures.
• These files are stored in directories such as /var/log for log messages, and /var/tmp or /var/crash for
core files, depending on the type of host OS running on the switch.
For diagnostic purposes, you can access these host OS system log and core files from the Junos OS CLI
on the switch. You can also clean up directories where the host OS stores temporary log and other files.
This topic includes these sections:
View Log Files On the Host OS System
To view a list of the log files created on the host OS, enter the following command:
user@switch> show app-engine logs
Copy Log Files From the Host System To the Switch
To copy log files from the host OS to the switch, enter the following command:
user@switch> request app-engine file-copy log from-jhost source to-vjunos destination
For example, to copy the lcmd log file to the switch, enter the following command:
user@switch> request app-engine file-copy log from-jhost lcmd.log to-vjunos /var/tmp
View Core Files On the Host OS System
To view the list of core files generated and stored on the host OS system, enter the following command:
user@switch> show app-engine crash
The list might look like this example output:
Compute cluster: default-cluster
Compute node: default-node
Crash Info
1265
==========
total 13480
-rw-r--r-- 1 root root 178046 Feb 14 23:08 localhost.lcmd.26653.1455520135.core.tgz
-rw-r--r-- 1 root root 4330343 Feb 15 00:45 localhost.dcpfe.7155.1455525926.core.tgz
-rw-r--r-- 1 root root 4285901 Feb 15 01:49 localhost.dcpfe.25876.1455529782.core.tgz
-rw-r--r-- 1 root root 4288508 Feb 15 02:39 localhost.dcpfe.713.1455532774.core.tgz
-rw-r--r-- 1 root root 264079 Feb 15 17:02 localhost.lcmd.1144.1455584540.core.tgz
Copy Core Files From the Host System To the Switch
To copy core files from the host OS to the switch, enter the following command:
user@switch> request app-engine file-copy crash from-jhost source to-vjunos destination-dir-or-
file-path
When the destination Junos OS path is a directory, the source filename is used by default. To rename
the file at the destination, enter the destination argument as a full path including the desired filename.
For example, to copy the localhost.lcmd.26653.1455520135.core.tgz core archive file to the switch,
enter the following command:
user@switch> request app-engine file-copy crash from-jhost
localhost.lcmd.26653.1455520135.core.tgz to-vjunos /var/tmp
To see the results on the switch, enter the following command:
user@switch> show system core-dumps
re0:
--------------------------------------------------------------------------
-rw-r--r-- 1 root field 178046 Feb 15 17:15 /var/tmp/
localhost.lcmd.26653.1455520135.core.tgz
total files: 1
Clean Up Temporary Files on the Host OS
To remove temporary files created on the host OS, enter the following command:
user@switch> request app-engine cleanup
1266
For example, the following sample output on a switch with a Linux host OS shows cleanup of temporary
files stored in /var/tmp:
Compute cluster: default-cluster
Compute node: default-node
Cleanup (/var/tmp)
=======
Release History Table
Release Description
15.1X49-D10 Starting in Junos OS Release 15.1X49-D10 and Junos OS Release 17.3R1, likewise on a routing
matrix composed of a TX Matrix Plus router with connected T1600 or T4000 routers, the primary
Routing Engine on each T1600 or T4000 LCC forwards to the primary Routing Engine on the TX
Matrix Plus router all messages with a severity of info and higher.
System Logging on a Single-Chassis System
IN THIS SECTION
Single-Chassis System Logging Configuration Overview | 1267
Junos OS System Log Configuration Statements | 1268
Junos OS Minimum System Logging Configuration | 1269
Example: Configure System Log Messages | 1270
Log Messages in Structured-Data Format | 1274
Specify Log File Size, Number, and Archiving Properties | 1274
Include Priority Information in System Log Messages | 1276
System Log Facility Codes and Numerical Codes Reported in Priority Information | 1278
Include the Year or Millisecond in Timestamps | 1280
Use Strings and Regular Expressions to Refine the Set of Logged Messages | 1281
1267
Junos System Log Regular Expression Operators for the match Statement | 1284
Disable the System Logging of a Facility | 1285
Examples: Configure System Logging | 1286
Examples: Assign an Alternative Facility | 1288
Single-Chassis System Logging Configuration Overview
The Junos system logging utility is similar to the UNIX syslogd utility. This section describes how to
configure system logging for a single-chassis system that runs the Junos OS.
System logging configuration for the Junos-FIPS software and for Juniper Networks devices in a
Common Criteria environment is the same as for the Junos OS. For more information, see the Secure
Configuration Guide for Common Criteria and Junos-FIPS.
For information about configuring system logging for a routing matrix composed of a TX Matrix router
and T640 routers, see "Configuring System Logging for a TX Matrix Router" on page 1290.
Each system log message belongs to a facility, which groups together related messages. Each message is
also preassigned a severity level, which indicates how seriously the triggering event affects router
functions. You always specify the facility and severity of the messages to include in the log. For more
information, see "Specifying the Facility and Severity of Messages to Include in the Log" on page 1310.
You direct messages to one or more destinations by including the appropriate statement at the [edit
system syslog] hierarchy level:
• To a named file in a local file system, by including the file statement. See "Directing System Log
Messages to a Log File" on page 1313.
• To the terminal session of one or more specific users (or all users) when they are logged in to the
router, by including the user statement. See "Directing System Log Messages to a User Terminal" on
page 1314.
• To the router console, by including the console statement. See "Directing System Log Messages to the
Console" on page 1315.
• To a remote machine that is running the syslogd utility, by including the host statement. See Directing
System Log Messages to a Remote Machine.
By default, messages are logged in a standard format, which is based on a UNIX system log format; for
detailed information about message formatting, see the System Log Explorer. You can alter the content
and format of logged messages in the following ways:
1268
• You can log messages to a file in structured-data format instead of the standard Junos format.
Structured-data format provides more information without adding significant length, and makes it
easier for automated applications to extract information from the message. For more information,
see "Logging Messages in Structured-Data Format" on page 1274.
• A message’s facility and severity level are together referred to as its priority. By default, the standard
Junos format for messages does not include priority information (structured-data format includes a
priority code by default.) To include priority information in standard-format messages directed to a
file or a remote destination, include the explicit-priority statement. For more information, see
"Including Priority Information in System Log Messages" on page 1276.
• By default, the standard Junos format for messages specifies the month, date, hour, minute, and
second when the message was logged. You can modify the timestamp on standard-format system log
messages to include the year, the millisecond, or both. (Structured-data format specifies the year and
millisecond by default.) For more information, see "Including the Year or Millisecond in Timestamps"
on page 1280.
• When directing messages to a remote machine, you can specify the IP address that is reported in
messages as their source. You can also configure features that make it easier to separate messages
generated by Junos OS or messages generated on particular devices. For more information, see
Directing System Log Messages to a Remote Machine.
• The predefined facilities group together related messages, but you can also use regular expressions
to specify more exactly which messages from a facility are logged to a file, a user terminal, or a
remote destination. For more information, see "Using Strings and Regular Expressions to Refine the
Set of Logged Messages" on page 1281.
NOTE: During a commit check, warnings about the traceoptions configuration (for example,
mismatch in trace file sizes or number of trace files) are not displayed on the console. However,
these warnings are logged in the system log messages when the new configuration is committed.
Junos OS System Log Configuration Statements
To configure the switch to log system messages, include the syslog statement at the [edit system]
hierarchy level:
[edit system]
syslog {
archive   ;
1269
console {
facility severity;
}
file filename {
facility severity;
archive )>     ;
explicit-priority;
match "regular-expression";
structured-data {
brief;
}
}
host hostname {
facility severity;
explicit-priority;
facility-override facility;
log-prefix string
match "regular-expression";
}
source-address source-address;
time-format (year | millisecond | year millisecond);
user (username | *) {
facility severity;
match "regular-expression";
}
}
Junos OS Minimum System Logging Configuration
To record or view system log messages, you must include the syslog statement at the [edit system]
hierarchy level. Specify at least one destination for the messages, as described in Table 129 on page
1270. For more information about the configuration statements, see "Single-Chassis System Logging
Configuration Overview" on page 1267.
1270
Table 129: Minimum Configuration Statements for System Logging
Destination Minimum Configuration Statements
File
[edit system syslog]
file filename {
facility severity;
}
Terminal session of one, several, or all users
[edit system syslog]
user (username | *) {
facility severity;
}
Router or switch console
[edit system syslog]
console {
facility severity;
}
Remote machine or the other Routing Engine on
the router or switch [edit system syslog]
host (hostname | other-routing-engine) {
facility severity;
}
Example: Configure System Log Messages
IN THIS SECTION
Requirements | 1271
Overview | 1271
Configuration | 1271
1271
The QFabric system monitors events that occur on its component devices and distributes system log
messages about those events to all external system log message servers (hosts) that are configured.
Component devices may include Node devices, Interconnect devices, Director devices, and the Virtual
Chassis. Messages are stored for viewing only in the QFabric system database. To view the messages,
issue the show log command.
This example describes how to configure system log messages on the QFabric system.
Requirements
This example uses the following hardware and software components:
• Junos OS Release 12.2
• QFabric system
• External servers that can be configured as system log message hosts
Overview
Component devices that generate system log message events may include Node devices, Interconnect
devices, Director devices, and the control plane switches. The following configuration example includes
these components in the QFabric system:
• Director software running on the Director group
• Control plane switches
• Interconnect device
• Multiple Node devices
Configuration
IN THIS SECTION
Procedure | 1272
1272
Procedure
CLI Quick Configuration
To quickly configure this example, copy the following commands, paste them into a text file, remove any
line breaks, change any details necessary to match your network configuration, and then copy and paste
the commands into the CLI at the [edit] hierarchy level.
set system syslog host 10.1.1.12 any error
set system syslog file qflogs
set system syslog file qflogs structured-data brief
set system syslog file qflogs archive size 1g
Step-by-Step Procedure
The following example requires that you navigate various levels in the configuration hierarchy. For
instructions on how to do that, see Using the CLI Editor in Configuration Mode in the Junos OS CLI User
Guide .
To configure system messages from the QFabric Director device:
1. Specify a host, any facility, and the error severity level.
[edit system syslog]
user@switch# set host 10.1.1.12 any error
NOTE: You can configure more than one system log message server (host). The QFabric
system sends the messages to each server configured.
2. (Optional) Specify a filename to capture log messages.
NOTE: On the QFabric system, a syslog file named messages is configured implicitly with
facility and severity levels of any any and a file size of 100 MBs. Therefore, you cannot specify
1273
the filename messages in your configuration, and automatic command completion does not
work for that filename.
[edit system syslog]
user@switch# set file qflogs structured-data brief
user@switch# set file qflogs
3. (Optional) Configure the maximum size of your system log message archive file. This example
specifies an archive size of 1 GB.
[edit system syslog]
user@switch# set file qflogs archive size 1g
Results
From configuration mode, confirm your configuration by entering the show system command. If the output
does not display the intended configuration, repeat the instructions in this example to correct the
configuration.
[edit]
user@switch# show system
syslog {
file qflogs {
}
host 10.1.1.12 {
any error;
}
}
If you are done configuring the device, enter commit from configuration mode.
SEE ALSO
syslog (QFabric System)
show log
1274
Log Messages in Structured-Data Format
You can log messages to a file in structured-data format instead of the standard Junos OS format.
Structured-data format provides more information without adding significant length, and makes it easier
for automated applications to extract information from a message.
The structured-data format complies with Internet standard RFC 5424, The Syslog Protocol, which is at
https://tools.ietf.org/html/rfc5424. The RFC establishes a standard message format regardless of the
source or transport protocol for logged messages.
To output messages to a file in structured-data format, include the structured-data statement at the [edit
system syslog file filename] hierarchy level:
[edit system syslog file filename]
facility severity;
structured-data {
brief;
}
The optional brief statement suppresses the English-language text that appears by default at the end of
a message to describe the error or event.
The structured format is used for all messages logged to the file that are generated by a Junos process
or software library.
NOTE: If you include either or both of the explicit-priority and time-format statements along with
the structured-data statement, they are ignored. These statements apply to the standard Junos OS
system log format, not to structured-data format.
Specify Log File Size, Number, and Archiving Properties
To prevent log files from growing too large, by default the Junos OS system logging utility writes
messages to a sequence of files of a defined size. The files in the sequence are referred to as archive files
to distinguish them from the active file to which messages are currently being written. The default
maximum size depends on the platform type:
• 128 kilobytes (KB) for EX Series switches
• 1 megabyte (MB) for M Series, MX Series, and T Series routers
1275