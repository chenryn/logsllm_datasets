## Page 43
2.网际协议IP
口ARP欺骗：
2.网际协议IP
口
IP数据报的格式也能够说明IP协议的功能。
口
■在首部固定部分的后面是一些可选字段，其长度是可变的。
■首部的前一部分是固定长度，共20字节，是IP数据报必须具有的。
一个 IP 数据报由首部和数据两部分组成。
ARP缓存
2.4地址解析协议ARP
2.5IP数据报的格式
86
85
6
---
## Page 44
2.网际协议IP
首部
固定部分
首部
版首长
变分
位
XF
固定部分
版本首部长度
位
生存时间
度
发送在前
生存时间
指
本
IP协
首部长度
用来获得更好的服务。
口
选
首部
选
标
区分服务
段改
最大数
协
治
般的情况
(长度可变)
区分服
目的地址
议
为
协
值
源地址
 (长度可变)
区分
目的地址
议
IP数据报
务
亲
15个单位（一
数
在旧标准中叫做服务类型，
据
源地址
标志
の
务
使用这个字段。
据
只有在使用区分服务（DiffServ）时
分
首部检验和
标志
部
总长度
分
首部检验
6
片偏移
24
总
片偏
但实际上一直未
充
移
2.5IP数据报的格式
87
---
## Page 45
首部
首部
固定部分
可部
可部
固定部分
值路
生
片也单
变分
位
套！
变分
位
器
移提
版本首部长度
标志字段中间的一
MF=0表示最后
标志字段的最低位是MF(MoreFragment），MF=1表示后面“还有分片"
生存时间
生存时间
8位
说每
本
限
13位。
16位，
首部长度
协议字
的为
回
总
X
tion)
数据报。
记为TTL(Time
用
偏移指出：
选
给
选
段
字段
邮
16位，
字
数据
区分服务
区分服务
处
段
此数
因此TT
协
理程
子
 (长度可变)
它是一个计数器，用来产生数据报的标识。
数
(长度可变)
据
没的起点，
目的地址
议
目的地址
议
序
To
进
路
源地址
据
源地址
Live),
节的整数倍。
行处理。
器
转发数
标志
の
标志
数据报在网络中可通过的路由器数的最
分
分
据
首部检验和
首部检验和
6
使用何种协议，以方便目的主机的IP
居报之前把TTL减1，如果TTL为0，
总长度
总长度
片偏移
片偏移
因此数掘曼大垃度为
24
24
填
充
最大过的
大
5
---
## Page 46
首部
首部
可部
固定部分
可部
固定部分
向
变分
位
首验
变分
P
IP首
变
首部校验和：
的将
首部的可
此字
版本
生存时间
生存时间
版
IP数据报的
本
增
回
变部
首部长度
32位，
首部长度
变部分
长
用
16位。
可
的
度为
分
就
标
田
选
选
是
接
器
是为了
这个校验只
-40个
收
字
治
长度定
H
区分服务
区分服务
开
段
协
段
选
协
销
提
数
数
为
高
护
项
(长
议
(长
为为固定的
目的地址
并进
目
议
度可变)
度可变)
务
据
源地址
据
的地
源
杂
地址
安
介绍
取决
部
标志
部
标志
9
州
址
等措施，
分
首部，
首部检验和
分
而是采用了更
首部检验和
6
内
总长度
总长度
项
片偏移
片偏
很丰
24
24
内
富容
IP数据报的首部
充
部
变
9
---
## Page 47
口IP 数据报分片:
2.网际协议IP
口IP数据报分片：
2.网际协议IP
需分片的数据报”首部
数据报片1
数据报片3
数据报片2
原始数据报
字节0
IP数据报首部中与分片有关的字段中的
字节0
3820
总长度
1399
1020
1420
1420
偏移=1400/8=175
数据报片2
首部2
－数据部分共3800字节
1400
12345
12345
12345
12345
标识
1400
2799
MF
2800
首部3
数
DF
2800
3799
偏移=0/8=0
片偏移
30
15
3799
2.5IP数据报的格式
2.5IP数据报的格式
94
93
---
## Page 48
2.网际协议IP
口协议字段：
2.网际协议IP
口
1首部校验和：
协议字段值
协议名
ICMP
数据报首部
运输层
IGMP
发送端
协议字段指出应将数据部分交给哪一个进程
数据部分
常用的一
首部
ICMP
数据部分
些协议和相
IGMP
IP数据报
数据部分
TCP
应
的协议字段值
ICMP
2.5IP数据报的格式
2.5IP数据报的格式
96
6
68
---
## Page 49
口分组在互联网中是逐跳转发的。
3.IP层转发分组的过程
口
口在路由表中，对每一条路由最主要的是两个信息：
口在互联网上转发分组时，是从一个路由器转发到下一个路由器。
3.IP层转发分组的过程
转发表中最主要的路由是
基于终点的转发：基于分组首部中的目的地址传送和转发。
根据目的网络地址就能确定下一跳路由器，
■只有到达最后一个路由器时，才试图向目的主机进行直接交付。
■IP数据报最终一定可以找到目的主机所在目的网络上的路由器。
IP数据报
（目的网络地址，下一跳地址）
查找转发表
查找转发表的过程
（目的网络地址，
为了压缩转发表
是
家行
跳地址
美的大小
IP数据报
找
不是
最终结果是：
匹
 (可能要通过多次的间接交付)
（目的地址
IP数据报
路由器
跳地址）
IP数据报
3.1基于终点的转发
3.1基于终点的转发
目的主机