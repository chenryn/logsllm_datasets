........
...
.....
137
4
---
## Page 7
第10章
9.4识别查询缓慢的问题
9.3获得数据库度量值·
10.5
10.4
10.3
10.2
10.1
：电源供电故障·
硬盘驱动器无法工作…
9.4.1MySQL...
9.3.2
9.3.1
服务器过热.…
9.4.2
9.2.2
网卡故障…
测试内存错误
这是硬件问题！诊断常见的硬件问题…
MySQL .....
PostgresSQL·
PostgresSQL
PostgresSQL ..
.166
183
...175
·165
---
## Page 8
成为本能。你不仅想成为排除故障的高手，还希望能够成为排除故
需要用到一些技术，不论是否有天赋，都可以通过训练使这些技术
你很自然地就掌握了某种技能，可能会认为别人也能轻松掌握。毕
吉他、烹饪或者编程，有的人生来就有天分，有的人则不然。如果
修理工，你将会收到高昂的维修账单，不断地去维修店换掉汽车的
原因。做过一些测试之后，他确认了预判的正确性，开始动手修理
你描述时他已经把问题锁定在少数几个成因上，并且预判了问题的
描述完车子的“症状”后，他就已经开始摆弄你的汽车了，因为在
本原因。当你把汽车交给一个善于排除故障的汽车修理工，在你刚
地采取行动，本能地选择方法进一步隔离故障，直到查清故障的根
别人学会骑自行车也不需要付出多少努力。
竟，如果你第一次尝试就学会了骑自行车，
一个又一个部件。
了。另外一种情况是，当你把汽车送给一个不善于排除故障的汽车
有人天生善于排除故障，当出现故障的时候，他们会不假思索
故障排除技能任何人都可以学会，和很多技能一样，故障排除
故障排除是一项技能，和所有的技能一样，不论是变魔术、弹
故障排除的最佳实践
，可能就会想当然地以为
第1章
---
## Page 9
因，测试结果最少也能排除掉几个可能的原因。
择随机测试直到幸运地找到原因。一位优秀的故障排除人员选择的
生问题的原因列表的底层开始，一步一步解决问题，另外一些人选
1开始递加，需要猜73次。如果是随机猜，有可能要遍历所有的数
的可能性。这个例子里，
63（小了），69（小了），72（小了），73。每次猜测都会排除一半
递加。善于排除故障的人可能会这样猜：50（小了），75（大了)，
数大还是小。一些人可能会随机猜某个数字，或者从1开始逐步
地发现，当遇到问题时，竟然有那么多人都忽略了这些常识。
你读过本章之后，会发现其中大部分实践都是常识，但是你会惊讶
DevOps团队中的每个人使用相同的经过验证的故障排除技术时，
队首先花费大量时间寻找问题，然后尝试定位问题的根本成因。当
除。开发者排除软件中的漏洞，系统管理员排除硬件问题，质量团
障的快手。在用金钱衡量故障时间的环境下工作更是这样。毕竟
第1章故障排除的最佳实践
而治之。划分问题空间之后，即使一项测试不能找到故障的根本原
每一项测试的结果都会排除一类原因，而不是一个原因，将故障分
字才能猜中答案。
比如这个数是73，每次猜完之后我会告诉你你猜测的数字比这个
1.1划分问题空间
整个团队都会从中受益。
车，但是你更希望哪个汽车修理工来修理你的汽车呢？
不论是优秀的汽车修理工还是差的汽车修理工最终都会修好你的
本章介绍的一些故障排除最佳实践可以应用到任何问题上。当
这个方法适用于所有的故障排除。面对问题，一些人从可能产
如果让你去猜我正在想的一个1～100内的数，你会猜哪个？
在DevOps 组织里，团队中的每位成员都负责一部分故障排
，为找到正确答案只猜了6次。而如果从
---
## Page 10
测试更坏的事情了。当你在团队环境下着手解决一个问题时，要给
而省去一系列本地网络测试。
站。如果别的网站能正常加载，就可以确定我的网络连接正常，从
去查看网线是否没有插好，而是访问一两个通常都很稳定的其他网
时我想测试是网站的原因还是我的网络连接有问题，但我不会立即
轮到他们发言，因为多次发言的中断、糟糕的电话信号或者来自忘
性进展、警告或者别的信息，都不得不等轮到自己发言时说。即使
运，只与直接解决问题的人打电话，但其他人就算有新信息、
最大的问题是电话会议上每次只有一个人可以说话。即便你很幸
法，并且描述在不同场景下哪些沟通方式有效，哪些无效。
重复排查别人已经检查过的问题。更糟糕的是，人们误解了说明，
有良好的沟通，两个人不会意识到正在解决相同的问题，
1.2协同工作时的良好沟通
把结果传达给其他人。
每个人分配不同的测试并保证一旦某个人排除了一个原因，能及时
划分问题空间，没有比跟踪一个问题的时候发现有人也在做相同的
程技术时尤为困难。
说的内容。在沟通命令行命令、IP地址、日志输出或者任何其他远
1.2.1
让问题变得愈加严重。下面几节将会介绍协作时用到的不同沟通方
当你和团队中的其他人协作排除故障时，也会在团队成员之间
电话会议是解决问题时最常见但也绝对是最坏的方法之一。
建立良好的沟通方法是团队排除故障的最大挑战之一。如果没
例如，如果我尝试用浏览器访问一个网站，但是请求超时，此
电话会议
1.2协同工作时的良好沟通3
一个人会
突破
它
---
## Page 11
坐得很近，在处理紧急故障时，人们还经常借助会议电话沟通。如
我不是说要你扔掉电话会议号码，而是说应该把它作为最后选择使
问题？”
以预料的是前五到十分钟完全没有意义，因为会话将会是这样的：
议电话设备，然后等待“中间人”加人会议。接通会议电话后，
多障碍。首先是花费在查找电话会议号码和接入码的时间。接好会
1.2.2
用的手段。
所以在解释的过程中，团队的其他成员将无法沟通。
做的事情去解释。因为电话会议上同一时刻只有一个人可以讲话，
味着某个人（很可能是派去解决问题的团队负责人）需要放下正在
问题作出直接贡献。这将不可避免地导致频繁请求进度报告，也意
式，并作为中央指挥官去“管理”这个问题，即使他们无法对解决
电话会议。许多管理人员爱把电话会议作为参与排除故障的一个方
第1章故障排除的最佳实践
实际上，下面列出的其他沟通方法都比电话会议要好，所以，
Fred：“啊，我还不确定，我刚登录到….”
*嘟嘟*“××加入会议。
团队成员通常都坐在同一区域，然而，即使团队的每个成员都
*嘟嘟*“Bob 加入会议。”
Fred：“我刚登录到Web服务器，正在查看....”
*嘟嘟*“Mary 加入会议。”
Ted：“是我Ted，
Fred：“谁刚加入？”
如果解决问题的速度很重要，那么电话会议已经给你设置了很
事实是，大多数情况下，并不是只有解决问题的团队成员参加
Bob：（夹杂着高速公路噪音）“喂，网站宕机了！”
Mary:
直接对话
：“喂，网站宕机了？你认为是什么问题？”
，事情是这样，
网站宕机了，你认为是什么
可
---
## Page 12
格（inline）。这样很容易让人们忽视那些嵌套在注释中或者粘贴输
复风格（top-posting）、下回复风格（bottom-posting）和内联回复风
以看到这样的例子。与语音交流相比，电子邮件的优点是：
刻解决的问题来说更是如此。在流行开源项目的漏洞追踪系统中可
补充。
方法上。对我来说，直接对话是其他更好的沟通方法的一个很好的
列表难以分析和阅读，尤其是人们有各自不同的回复风格，如上回
是实时和交互式的，所以使用电子邮件沟通与面对面沟通相比存在
一个地点办公或者问题发生在下班之后，就又要回到电话会议这个
何后加人的人需要能够跟上会话的进度。另外，若是每个人不在同
录会话内容，所以就没有排除故障的步骤可用于事后分析，同时任
更不用说长的日志条目或者网址。除此之外，这样做通常无法记
更容易理解别人所说的话；其次，很容易同时进行多个会话。
果每个人都离得很近，大声讨论问题有很多优势。首先，这样一般
1.2.3
一个延迟，这确实会让故障排除的进程慢下来。其次，冗长的邮件
直接对话解决问题的不足之处是仍然很难共享相关的技术信息
电子邮件是协作解决问题的一个好方法，尤其是对于不需要立
即便如此，电子邮件沟通仍存在很多问题。首先，电子邮件不
口自动拥有一个带时间戳的协作排除故障的日志，里面包含了
口多个对话可以同时进行；
口后加人解决问题的人可以通过阅读邮件主题从而自己跟上问
口很容易粘贴IP地址、URL 或者命令；
口进行双向对话非常容易；
口可以添加截屏图片或者日志信息；
粘贴的命令输出和其他方法无法记录的数据。
题的进度；
电子邮件
1.2协同工作时的良好沟通5
---
## Page 13
●第1章故障排除的最佳实践
是打字，尤其是打字速度不是很快的人更是这样，当这些人加人聊
子邮件或者其他方法共享大量的数据。最后，一些人喜欢说话而不
借助他人对当前故障处理状态的介绍才能跟上进度。其次，任何超
Jabber。下面是聊天室相比较其他沟通方法的一些优点：
室包括IRC或者其他即时通信客户端，例如具有群聊天功能的
万一你要解决的问题是邮件服务器岩机了，你该怎么办？
出一定行数的信息难以在聊天室里面阅读，所以，你可能会求助电
多报警邮件，这样难以在众多邮件中找到需要的会话邮件。最后
你可能用邮件作为一种通知手段。出问题时，收件箱可能会收到很
出数据中的重要信息。如果你是系统管理员并且安装了监控软件
件能保存聊天记录。如果没有这个功能，新加人聊天的协作者只能
1.2.4
实时聊天室是团队协作排除故障的最好方法之一。
尽管如此，聊天室也有它自己的问题。首先，只有部分聊天软
口一些聊天室能保留聊天记录，这样新加人的成员也能很容易
口沟通是实时和交互式的;
口可以将聊天室标题设置为故障当前的进度，以此来让经理
口当你专注处理某事时，可以忽略那些会话，过后再回到会话
口聊天室对话可以保存下来用于以后的故障分析；
口大多数聊天室软件都具有文件共享功能，因此可以共享截图
口方便粘贴技术信息；
口个人之间可以私密地交流：
口多人可以同时交流；
满意。
并跟上会话进度；
跟上讨论的进度；
或日志信息；
实时聊天室
实时聊天
---
## Page 14
可以执行两个一样好的测试的时候，首选快速或简单的，而不是缓
的根源所在。你很难知道应该先尝试哪个，一个好的原则是：当你
情况下，将如何与其他人沟通，并且确保每个人都知道如何使用这
果邮件服务器岩机，很难通过邮件去沟通；如果碰到网络故障，你
沟通在你的掌控之下。
时，最好使用自己管理的聊天室服务器。IRC 和Jabber 都提供开源
天室后，你的沟通体验将会很糟糕。
除过程，损失的只不过是几秒钟时间而已。
务器恢复网络连接。若是能 ping 通，则可以进行更进一步的故障排
连通了网络。如果无法 ping 通服务器，你就可以着手处理如何让服
很多不同的方法可以解决这个问题。但是，如果你从 ping服务器的
然而，通常你会遇到各种各样的原因，这些原因看起来都像是问题
个方法。
将无法登录内部聊天服务器。提前想好在首选沟通方法无法使用的
1.2.5
服务器，你可以将它们安装在自己的环境中，从而确保聊天室内的
方法开始尝试，那么就是在使用一种相当快的方法断定服务器是否
位问题的原因非常重要。例如，当一个Web服务器岩机的时候，有
慢或复杂的。
1.3
如果你们团队的宕机时间是用金钱衡量的，那么尽可能快地定
无论选择哪种沟通方法，都要确保有一个适当的备用方法。
毫无疑问，因为隐私的缘故，在排除需要共享敏感数据的问题
如果每个问题都有一系列井然有序的测试集合，那就太棒了
首选快速、