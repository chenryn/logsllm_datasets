+------------+---------+----------+-------+-----+---------------------+
| **         | ~~CFG_  |          | **~   | ~   |                     |
| ~~表名~~** | DATA_BU |          | ~表中 | ~业 |                     |
|            | SITRACE |          | 文名  | 务  |                     |
|            | ANALY~~ |          | ~~**  | 调  |                     |
|            |         |          |       | 用  |                     |
|            |         |          |       | 链  |                     |
|            |         |          |       | 分  |                     |
|            |         |          |       | 析  |                     |
|            |         |          |       | 表  |                     |
|            |         |          |       | ~~  |                     |
+============+=========+==========+=======+=====+=====================+
| **~~       | *       | **~~数据 | *     | **~ | **~~变更内容~~**    |
| 字段名~~** | *~~字段 | 类型~~** | *~~是 | ~主 |                     |
|            | 中文名  |          | 否允  | 键~ |                     |
|            | 称~~**  |          | 许空  | ~** |                     |
|            |         |          | ~~**  |     |                     |
+------------+---------+----------+-------+-----+---------------------+
| ~          | ~       | ~~VARCHA | ~~NOT |     | ~~业务受理时        |
| ~TRACEID~~ | ~交易流 | R2(32)~~ | N     |     | 生成的交易流水号~~  |
|            | 水号~~  |          | ULL~~ |     |                     |
+------------+---------+----------+-------+-----+---------------------+
| ~          | ~~业务  | ~~VARCHA | ~~N   |     | ~~业务类型          |
| ~RECTYPE~~ | 类型~~  | R2(32)~~ | ULL~~ |     | ，如ChangeProduct~~ |
+------------+---------+----------+-------+-----+---------------------+
| ~~B        | ~~开始  | ~~DATE~~ | ~~N   |     | ~                   |
| EGINTIME~~ | 时间~~  |          | ULL~~ |     | ~业务受理开始时间~~ |
+------------+---------+----------+-------+-----+---------------------+
| ~          | ~~结束  | ~~DATE~~ | ~~N   |     | ~                   |
| ~ENDTIME~~ | 时间~~  |          | ULL~~ |     | ~业务受理结束时间~~ |
+------------+---------+----------+-------+-----+---------------------+
| ~          | ~       | ~~NUMB   | ~~N   |     | ~~业务受理耗时~~    |
| ~USETIME~~ | ~耗时~~ | ER(14)~~ | ULL~~ |     |                     |
+------------+---------+----------+-------+-----+---------------------+
| ~~B        | ~~业务  | ~~NUM    | ~~N   |     | ~~业务              |
| USISTATE~~ | 状态~~  | BER(1)~~ | ULL~~ |     | 受理结果，枚举：~~  |
|            |         |          |       |     |                     |
|            |         |          |       |     | ~~1:成功~~          |
|            |         |          |       |     |                     |
|            |         |          |       |     | ~~0:失败~~          |
+------------+---------+----------+-------+-----+---------------------+
| ~~NOTE~~   | ~       | ~        | ~~N   |     | ~~备注信息~~        |
|            | ~备注~~ | ~VARCHAR | ULL~~ |     |                     |
|            |         | 2(256)~~ |       |     |                     |
+------------+---------+----------+-------+-----+---------------------+
### ~~业务调用链分析明细表(CFG_DATA_BUSITRACEANALYDETAIL)~~
~~系统归属：业务配置平台~~
~~数据库用户：YWPZ_BCP~~
~~数据描述：~~
+-----------+----------+-----------+------+----+--------------------+
| **~       | ~        |           | **~~ | ~~ |                    |
| ~表名~~** | ~CFG_DAT |           | 表中 | 业 |                    |
|           | A_BUSITR |           | 文名 | 务 |                    |
|           | ACEANALY |           | ~~** | 调 |                    |
|           | DETAIL~~ |           |      | 用 |                    |
|           |          |           |      | 链 |                    |
|           |          |           |      | 分 |                    |
|           |          |           |      | 析 |                    |
|           |          |           |      | 表 |                    |
|           |          |           |      | ~~ |                    |
+===========+==========+===========+======+====+====================+
| **~~字    | **~~     | **~~数据  | **   | ** | **~~变更内容~~**   |
| 段名~~**  | 字段中文 | 类型~~**  | ~~是 | ~~ |                    |
|           | 名称~~** |           | 否允 | 主 |                    |
|           |          |           | 许空 | 键 |                    |
|           |          |           | ~~** | ~~ |                    |
|           |          |           |      | ** |                    |
+-----------+----------+-----------+------+----+--------------------+
| ~~        | ~~交易   | ~~VARCH   | ~    | ~  | ~~业务受理时       |
| TRACEID~~ | 流水号~~ | AR2(32)~~ | ~NOT | ~I | 生成的交易流水号~~ |
|           |          |           | NU   | DX |                    |
|           |          |           | LL~~ | ~~ |                    |
+-----------+----------+-----------+------+----+--------------------+
| ~~SEQNO~~ | ~~调用   | ~~VARCH   | ~~NU |    | ~~服务调用序列     |
|           | 顺序号~~ | AR2(32)~~ | LL~~ |    | 号，如1.1，1.1.1~~ |
+-----------+----------+-----------+------+----+--------------------+
| ~~CALLIN  | ~~       | ~~VARCH   | ~~NU |    | ~~调用者实例标识   |
| GNODEID~~ | 调用者服 | AR2(32)~~ | LL~~ |    | ，如ZJNG3CRM-WAS~~ |
|           | 务实例~~ |           |      |    |                    |
+-----------+----------+-----------+------+----+--------------------+
| ~~CALLE   | ~~       | ~~VARCH   | ~~NU |    | ~~被               |
| DNODEID~~ | 被调用服 | AR2(32)~~ | LL~~ |    | 调用服务实例标识， |
|           | 务实例~~ |           |      |    | 如ZJNG3CRM-CICS~~  |
+-----------+----------+-----------+------+----+--------------------+
| ~~IP~~    | ~~服     | ~~VARCH   | ~~NU |    | ~~服务IP地址       |
|           | 务器IP~~ | AR2(16)~~ | LL~~ |    | ，如192.168.1.1~~  |
+-----------+----------+-----------+------+----+--------------------+
| ~~FLAG~~  | ~~请求响 | ~~VARCH   | ~~NU |    | ~~请求             |
|           | 应标识~~ | AR2(16)~~ | LL~~ |    | 发送：clientSend\  |
|           |          |           |      |    | 请求               |
|           |          |           |      |    | 接收：serverRecv~~ |
|           |          |           |      |    |                    |
|           |          |           |      |    | ~~响应             |
|           |          |           |      |    | 发送：serverSend\  |
|           |          |           |      |    | 响应               |
|           |          |           |      |    | 接收：clientRecv~~ |
|           |          |           |      |    |                    |
|           |          |           |      |    | ~~举例：~~         |
|           |          |           |      |    |                    |
|           |          |           |      |    | ~~A服务调          |
|           |          |           |      |    | 用B服务时，A服务打 |
|           |          |           |      |    | 印的两条日志为：~~ |
|           |          |           |      |    |                    |
|           |          |           |      |    | ~~请求             |
|           |          |           |      |    | 发送：clientSend~~ |
|           |          |           |      |    |                    |
|           |          |           |      |    | ~~响应             |
|           |          |           |      |    | 接收：clientRecv~~ |
|           |          |           |      |    |                    |
|           |          |           |      |    | ~~B服              |
|           |          |           |      |    | 务的两条日志为：~~ |
|           |          |           |      |    |                    |
|           |          |           |      |    | ~~请求             |
|           |          |           |      |    | 接收：serverRecv~~ |
|           |          |           |      |    |                    |
|           |          |           |      |    | ~~响应             |
|           |          |           |      |    | 发送：serverSend~~ |
+-----------+----------+-----------+------+----+--------------------+
| ~         | ~~调用方 | ~~VARCH   | ~~NU | ~  | ~~CRM WEB调用CRM   |
| ~METHOD~~ | 法名称~~ | AR2(64)~~ | LL~~ | ~I | WAS服务            |
|           |          |           |      | DX | 填写调用方法名；~~ |
|           |          |           |      | ~~ |                    |
|           |          |           |      |    | ~~CRM WAS调用CRM   |
|           |          |           |      |    | CICS服务填         |
|           |          |           |      |    | 写调用的opcode；~~ |
|           |          |           |      |    |                    |
|           |          |           |      |    | ~~CRM CICS调用BOSS |
|           |          |           |      |    | CICS服务填         |
|           |          |           |      |    | 写账务接口标识；~~ |
|           |          |           |      |    |                    |
|           |          |           |      |    | ~~工单             |
|           |          |           |      |    | 发送填写工单标识~~ |
+-----------+----------+-----------+------+----+--------------------+
| ~~PROG    | ~~服务应 | ~~VARCH   | ~~NU |    | ~~应用名           |
| RAMNAME~~ | 用名称~~ | AR2(32)~~ | LL~~ |    | 称，如ngcustcare.  |
|           |          |           |      |    | war、liborder.so~~ |
+-----------+----------+-----------+------+----+--------------------+
| ~~BE      | ~~请     | ~~VARCH   | ~~NU |    | ~~服务请求时间     |
| GINTIME~~ | 求时间~~ | AR2(20)~~ | LL~~ |    | ，精确到毫秒，格式 |
|           |          |           |      |    | YYMMDDHHMMSS.sss~~ |
+-----------+----------+-----------+------+----+--------------------+
| ~~        | ~~响     | ~~VARCH   | ~~NU |    | ~~服务响应时间     |
| ENDTIME~~ | 应时间~~ | AR2(20)~~ | LL~~ |    | ，精确到毫秒，格式 |
|           |          |           |      |    | YYMMDDHHMMSS.sss~~ |
+-----------+----------+-----------+------+----+--------------------+
| ~~        | ~~耗时~~ | ~~NUM     | ~~NU |    | ~~服务请           |
| USETIME~~ |          | BER(14)~~ | LL~~ |    | 求耗时，单位毫秒~~ |
+-----------+----------+-----------+------+----+--------------------+
| ~~        | ~~消     | ~~NUM     | ~~NU |    | ~~请求响应         |
| MSGSIZE~~ | 息大小~~ | BER(14)~~ | LL~~ |    | 消息大小，单位KB~~ |
+-----------+----------+-----------+------+----+--------------------+
| ~~RES     | ~~       | ~~VARC    | ~~NU |    | ~~请求返回         |
| ULTCODE~~ | 返回码~~ | HAR2(8)~~ | LL~~ |    | 码，成功0，失败1~~ |
+-----------+----------+-----------+------+----+--------------------+
| ~~RES     | ~~返     | ~~VARCHAR | ~~NU |    | ~~返回信息，失     |
| ULTINFO~~ | 回信息~~ | 2(1024)~~ | LL~~ |    | 败时返回失败信息~~ |
+-----------+----------+-----------+------+----+--------------------+
| ~~EXT     | ~~业务扩 | ~~VARCHAR | ~~NU |    | ~~业               |
| ENDINFO~~ | 展信息~~ | 2(2048)~~ | LL~~ |    | 务扩展信息，如操作 |
|           |          |           |      |    | 员、业务类型、受理 |
|           |          |           |      |    | 渠道、菜单ID、订单 |
|           |          |           |      |    | 号、服务号码等等~~ |
+-----------+----------+-----------+------+----+--------------------+
## 修改库表
### 充值通知表(ABM_CHARGE_HIS)
  -------------------------------------------------------------------------------------------------------------------------
  **表名**            CS_REC_ORDERDETAIL                  **表中文名**     P订单受理单明细   
  ------------------- -------------------- -------------- ---------------- ----------------- ------------------------------
  **字段名**          **字段中文名称**     **数据类型**   **是否允许空**   **主键**          
  CHARGE_ID           充值历史ID           TT_BIGINT      NOT NULL         PK                
  REGION              地区                 TT_SMALLINT    NOT NULL                           
  SESSION_ID          会话ID               VARCHAR2(64)   NOT NULL                           
  TYPE                类型                 TT_INTEGER     NOT NULL                           
  SERIAL_ID           流水号               TT_INTEGER\    NULL                               
                                           \                                                 
                                           VARCHAR2(64)                                      
  STORETIME           入账时间             TT_TIMESTAMP   NOT NULL                           
  BEPAY_SERVNUMBER    被充值号码           VARCHAR2(20)   NOT NULL                           
  PAY_SERVNUMBER      主叫号码             VARCHAR2(20)   NOT NULL                           
  CARD_ADDR           卡地址               VARCHAR2(64)   NULL                               
  EBOXUNTID           账本科目标识         TT_BIGINT      NULL                               
  AMT                 充值金额             TT_BIGINT      NULL                               
  ADD_VALIDDAY        增加有效期天数       TT_INTEGER     NULL                               
  REAL_ADD_VALIDDAY   实际增加有效期天数   TT_INTEGER                                        
  VALIDDATE           充值后有效期         TT_TIMESTAMP                                      
  BILLDAY             用户月结日           TT_INTEGER                                        
  BASEAMT             基本账户余额         TT_BIGINT                                         
  SENDAMT             赠送账户余额         TT_BIGINT                                         
  DEALFLAG            处理状态             TT_INTEGER                                        
  TRACEID                                  VARCHAR2(64)   NULL                               用于服务调用链日志跟踪流水号
  -------------------------------------------------------------------------------------------------------------------------
# 对内部生产系统的影响
## 对BI系统的影响评估
不涉及
## 监控设计
### 性能估算
#### 埋点日志量估算
  ------------------------------------------------------------------------
  范围             指标项                指标值            单位
  ---------------- --------------------- ----------------- ---------------
  广州区域         日志大小/条           864               字节
                   峰值日志条数/秒       1699              条
                   峰值日志量/秒         1.40              MB
                   平均每天日志条数      35733023          条
                   平均每天日志量        28.75             GB
  全省             峰值日志条数/秒       10194             条
                   峰值日志量/秒         8.40              MB
                   平均每天日志条数      214398138         条
                   平均每天日志量        172.52            GB
  ------------------------------------------------------------------------
> 详细估算方法：
>
> 从现网广州地市提取了月末和月初的业务量，针对以下几个关键业务从营业厅渠道和电子渠道分析统计并估算出服务调用链日志大小和业务高峰时服务调用链日志生成频率及大小，以此为依据进行集成方案的评估和写日志方式的选择。
>
> 说明：
-   以产品订购退订业务为例：前台一笔业务从进入菜单到订单提交端到端平均调用66次CICS服务；电子渠道调用3次CRM
    CICS服务估算；