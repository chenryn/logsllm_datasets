Oﬀ	
  Grid	
  communica.ons	
  with	
Android	
m0nk	
  and	
  stoker	
  have	
  fun	
  @	
  DefCon	
  20	
  -­‐	
  Meshing	
  the	
  mobile	
  world	
Who	
  are	
  you	
  guys?	
•  m0nk	
  –	
  Josh	
  Thomas	
–  PI:EMAIL	
–  PI:EMAIL	
•  Stoker	
  –	
  Jeﬀ	
  Robble	
–  PI:EMAIL	
–  PI:EMAIL	
•  We	
  work	
  @	
  The	
  MITRE	
  Corpora.on	
(of	
  CVE	
  fame)	
tl;	
  dr:	
•  hTps://github.com/monk-­‐dot	
A	
  placeholder	
  so	
  m0nk	
  can	
  babble	
Where	
  data	
  goes	
  to	
  die	
•  Fukushima	
•  Katrina	
•  Hai.	
•  	
•  Other?	
Why	
  do	
  I	
  care	
  about	
  Mesh	
  networks?	
•  Physical	
  infrastructure	
  is	
  prone	
  to	
  failure,	
networks	
  shouldn’t	
  be	
•  Bypass	
  the	
  Cellular	
  networks	
•  Bypass	
  Wi-­‐Fi	
  networks	
•  Share	
  informa.on	
  when	
  infrastructure	
  is	
  broken	
or	
  untrustworthy	
•  Extend	
  and	
  bounce	
  other	
  networks	
  via	
  bridging	
  /	
tethering	
•  Headless	
Ok,	
  kind	
  of	
  cool.	
  What	
  about	
“Oﬀ	
  Grid”?	
•  Single	
  point	
  of	
  failure	
  =	
  single	
  point	
  of	
sniﬃng	
  /	
  ﬁltering	
•  I	
  don’t	
  trust	
  someone	
  else	
  being	
  able	
  to	
  turn	
oﬀ	
  my	
  network,	
  do	
  you?	
•  When	
  you	
  want	
  to	
  share	
  info,	
  but	
  don't	
  want	
anyone	
  watching	
  J	
There	
  should	
  really	
  be	
  a	
  funny	
  pic	
below	
Your	
  pocket	
  contains	
  more	
  than	
  a	
  consump.on	
device	
  for	
  Grumpy	
  Fowl	
•  Wi-­‐Fi	
  chip	
  with	
  a	
  fairly	
  fat	
  pipe	
•  Cell	
  modem	
  and	
  baseband	
  processor	
•  A	
  ton	
  of	
  sensors	
•  (Somewhat)	
  quality	
  NAND	
  and	
  RAM	
•  A	
  very	
  under	
  clocked	
  and	
  underu.lized	
processor	
•  Power	
•  A	
  boring	
  screen	
  that	
  blinks!	
The	
  SPAN	
  framework	
•  We	
  did	
  the	
  boring	
  stuﬀ	
  so	
  you	
  don’t	
have	
  to!	
•  General	
  Overview	
  of	
  the	
  framework,	
  what	
  /	
why	
  /	
  how	
– Harnessing	
  SPAN	
  for	
  your	
  own	
  project?	
– Repurpose	
  root	
  to	
  muck	
  with	
  your	
  Wi-­‐Fi	
  chipset	
SPAN	
  +	
  Android	
  Technical	
  Architecture	
Blinkie	
  on	
  a	
  Map	
Java	
  Networking	
  Interface	
TCP	
  Socket	
UDP	
  Socket	
MANET	
  Service	
Reliable	
  Transmission	
  Layer	
Security	
  Manager	
Session	
  Manager	
P2P	
  Chat	
  App.	
Other	
  App.	
Network	
  Conﬁgura.on	
Modular	
  MANET	
  Rou.ng	
  Protocol	
  Framework	
Manual	
  Rou.ng	
  Protocol	
  Selec.on	
Automated	
  Rou.ng	
  Protocol	
  Selec.on	
Proac.ve	
  Rou.ng	
  Protocol	
  Manager	
Reac.ve	
  Rou.ng	
  Protocol	
  Manager	
OLSR	
BATMAN	
Protocol	
  3	
DSR	
Protocol	
  2	
Protocol	
  3	
iptables	
  /	
  neoilter	
Linux	
  Kernel	
  Rou.ng	
Transparent	
  Proxy	
Data	
  Flow	
P2P	
  Chat	
  App.	
Java	
  Networking	
  Interface	
Transparent	
  Proxy	
Reliable	
  Transmission	
  Layer	
MANET	
  Rou.ng	
  Protocol	
P2P	
  Chat	
  App.	
Java	
  Networking	
  Interface	
“Hello!”	
Source	
  Node	
Relay	
  Node	
Des0na0on	
  Node	
[determine	
  route]	
[update	
  network	
  topology]	
Transparent	
  Proxy	
Reliable	
  Transmission	
  Layer	
MANET	
  Rou.ng	
  Protocol	
Transparent	
  Proxy	
Reliable	
  Transmission	
  Layer	
MANET	
  Rou.ng	
  Protocol	
[update	
  network	
  topology	
  /	
  determine	
  route]	
Transparent	
  Backend	
Why	
  we	
  love	
  Broadcom	
•  Flipping	
  chipsets	
  into	
  Ad-­‐Hoc	
  Mode	
Kernel	
  v.	
  Metal	
•  Dear	
  Vendors:	
  Please	
  either	
  stop	
  mucking	
  with	
  your	
  kernel	
  source	
  or	
provide	
  it	
  to	
  the	
  community	
•  Leveraged	
  Wi-­‐Fi	
  Tether	
  for	
  Root	
  Users	
  app.	
–  Edify	
  script	
  for	
  serng	
  up	
  ad-­‐hoc	
  mode	
  using	
  cross-­‐compiled	
iwconﬁg	
•  Some	
  phone	
  wi-­‐ﬁ	
  drivers	
  don’t	
  support	
  ad-­‐hoc	
  mode	
–  Wi-­‐Fi	
  Tether	
  app.	
  switched	
  to	
  using	
  sosAP	
–  sosAP:	
  sosware	
  enabled	
  portable	
  wireless	
  access	
  point	
•  Needed	
  to	
  compile	
  Wireless	
  Extensions	
  support	
into	
  kernel	
–  Compiled	
  vendor	
  open	
  source	
  sosware	
–  Dumped	
  zImage	
  and	
  drivers	
  to	
  AnyKernel	
  tree	
–  Flashed	
  using	
  ClockworkMod	
  Recovery	
Ad-­‐hoc	
  Mode	
hTps://github.com/koush/AnyKernel	
Why	
  we	
  love	
  Broadcom	
•  Flipping	
  chipsets	
  into	
  Ad-­‐Hoc	
  Mode	
Kernel	
  v.	
  Metal	
•  Dear	
  Vendors:	
  Please	
  either	
  stop	
  mucking	
  with	
  your	
  kernel	
  source	
  or	
provide	
  it	
  to	
  the	
  community.	
•  Android	
  1-­‐hop	
  routes	
  from	
  A	
  will	
  go	
  through	
  B	
F	
•  Pros	
– BeTer	
  than	
  everyone	
  sharing	
  everything	
•  Topology	
  info	
  dumps	
  only	
  between	
  MPRs	
– Incremental	
  improvements	
•  Cons	
– MPRs	
  are	
  throughput	
  choke	
  points	
•  Isolated	
  points	
  of	
  failure	
– En.re	
  routes	
  planned	
  in	
  advance,	
  but	
  next	
  hop	
doesn’t	
  care	
  about	
  your	
  route,	
  it	
  uses	
  its	
  own	
OLSR	
•  BeTer	
  Approach	
  to	
  Mobile	
  Ad-­‐hoc	
  Networking	
(2006)	
•  Next-­‐gen	
  OLSR	
•  Decentralize:	
  No	
  single	
  point	
  has	
  all	
  the	
  data	
– No	
  MPRs	
– Each	
  node	
  sends	
  out	
  originator	
  msgs:	