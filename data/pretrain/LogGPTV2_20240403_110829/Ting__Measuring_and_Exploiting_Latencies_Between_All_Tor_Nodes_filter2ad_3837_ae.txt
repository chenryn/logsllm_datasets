median probability of a node being on a path with RTT =
x. Intuitively, this metric captures how “entropic” the set of
circuits are for a given RTT and path length. For instance,
in our dataset, the set of 10-hop circuits capable of achieving
an RTT of 1.9 seconds is very small: this is reﬂected by the
small value at x =1.9. Figure 17 shows that, for many values
of circuit length, low-latency circuits do not rely on a small
 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 0 10 20 30 40 50 60 70 80 90CDFRTT savings from a TIV detour (%) 0 50 100 150 200 250 300 350 400 0 50 100 150 200 250 300 350 400TIV detour RTT (ms)Default-path RTT (ms)30% RTT decrease299Figure 16: Longer Tor circuits have more options for lower-
latency paths, as well as higher-latency paths. Each line is
annotated with its corresponding circuit lengths.
Figure 17: Choosing shorter or longer paths induces skew
in the probability of a given node being selected to be on a
circuit.
fraction of peers; it is only 10-hop circuits which signiﬁcantly
sacriﬁce entropy for RTTs less than 500ms.
Using measurements like those in Figure 17, if an attacker
knows a victim’s circuit length and end-to-end RTT, then
he may be able to quickly pare down the set of potential
circuits in use. The most entropic region for any given circuit
length is naturally in the intermediate RTT values; choosing
circuits in this range of RTT values thwarts such attacks.
A user can increase the number of potential circuits for
a given RTT by consulting these data that Ting provides.
For instance, suppose the user seeks a circuit in the range of
200–300 ms. Within this range of RTTs, there are many 3-
hop, 4-hop, and 5-hop circuits. As a result, were an attacker
to learn the end-to-end RTT (e.g., if the attacker were run-
ning a web server and sought to identify which users were
connecting via Tor), there would be over two orders of mag-
nitude more circuits that the user could have constructed
than if he had restricted himself only to 3-hop nodes.
Ramiﬁcations of Longer Circuits. The use of longer
circuits represents a tragedy of the commons: the end-users
may beneﬁt, but longer circuits consume more resources
from the Tor network as a whole. However, because cir-
cuits are determined strictly by the source, there is little the
system can do to prevent a selﬁsh but rational user from
adopting longer circuits. We believe that approaches to pro-
vide incentive-compatibility in Tor [19, 3, 5] are of increasing
importance as longer circuits become feasible.
Although longer circuits can help defend against attack-
ers external to Tor, it is less clear how they fare in the pres-
ence of active adversaries within the Tor network. Assuming
a ﬁxed fraction of active, bad Tor nodes, as circuits grow
longer, the probability increases that an adversary is one
of the chosen hops—this, too, makes deanonymization by
traﬃc analysis possible [14]. Whether this increased prob-
ability outweighs the obfuscation of longer circuits merits
future study.
The results in this section suggest that there is potential for
a larger design space than Tor’s three-hop default:
longer
hops need not induce greater latency. How this should be
leveraged to achieve diﬀerent balances between security and
performance is an interesting area of future work.
5.3 Ting as a Measurement Platform
The ﬁnal application we consider is arguably Ting’s most
natural: as a platform for directly measuring latencies be-
tween hosts that researchers may not otherwise have access
to.
King [11] measured the latency between DNS servers thought
to be near clients or servers in the Internet to estimate the
latency between those hosts. In 2002, Gummadi et al. found
that 72–79% of authoritative name servers supported remote
recursive queries to support King; we ﬁnd that only 3% con-
tinue to today, presumably due to concerns over ampliﬁca-
tion attacks. This change inspired us to apply Ting to the
same problem: to estimate latency between hosts thought
to be near Tor relays. Relative to King, Ting has an advan-
tage in accuracy in that the Tor node representing a preﬁx
is a member of that preﬁx, rather than an authoritative
name server that may be much better connected or remote.
However, Ting has the disadvantage in that not every resi-
dential subnet has a Tor node. In this section, we evaluate
this coverage and show that Tor nodes are spread between
residential networks and data centers.
Coverage. We can evaluate Ting’s coverage in three di-
mensions: geography, network, and host type. The geo-
graphical coverage of Tor is well-known: On one hand, many
countries are represented: Tor Metrics [32] reported 77 coun-
tries with relays in November 2014. On the other hand, there
are exceptional countries in which Tor is blocked.
In terms of network diversity, we show the number of
unique /24 IP address preﬁxes and the total number of re-
lays in the Tor network from February 28, 2015 to April 28,
2015 in Figure 18. We consider /24 preﬁxes because they
represent a network allocation likely to be geographically
clustered. At any point in this two-month window, we ob-
served between 5426 and 6044 unique /24s. Compared with
past data collected by Tor Metrics [32], the total number of
relays has grown by roughly 30% since one year prior. If the
 1 1e+01 1e+02 1e+03 1e+04 1e+05 1e+06 1e+07 1e+08 1e+09 1e+10 0 0.5 1 1.5 2 2.5Number of circuits with RTT = xFull circuit RTT (seconds). Bin size: 50ms345678910 0 0.002 0.004 0.006 0.008 0.01 0.012 0.014 0 0.5 1 1.5 2 2.5Median probability ofa node being on the circuitFull circuit RTT (seconds). Bin size: 50ms3-hop4-hop5-hop6-hop7-hop8-hop9-hop10-hop300and software stack, ensuring an accurate reﬂection of Tor
relays’ view of the network. By conducting experiments on
both our own controlled relays on PlanetLab and live relays
on the Tor network, we validated Ting’s ability to estimate
true latencies.
We suggest and evaluate three applications wherein data
acquired by Ting could be used to improve Tor performance.
On the other hand, we provide evidence that it could also
be used to improve the latency of Tor while maintaining,
and even improving, the level of anonymity it provides, by
greatly increasing the set of acceptable circuits for a given
RTT, though we leave speciﬁc algorithms to future work. Fi-
nally, Tor’s geographic diversity, both in terms of countries
and number of /24s covered, makes it a viable platform for
measuring a wide swath of the Internet. We believe that
Ting provides unique insight into measurements within resi-
dential networks, and hope that it will complement existing
techniques. Furthermore, given the current rate of growth of
the Tor network, we suspect that Ting’s usefulness will scale
with Tor’s increased adoption. We believe these applications
to be representative of a much larger set of improvements
to the Tor network that explicit RTT measurements could
permit.
Acknowledgments
We thank our shepherd, Phillipa Gill, and the anonymous
IMC reviewers for their helpful comments. This research was
supported in part by NSF grant CNS-1409191, the National
Security Agency as part of a Science of Security lablet, and
an Amazon Web Services in Education grant.
7. REFERENCES
[1] S. Agarwal and J. R. Lorch. Matchmaking for online
games and other latency-sensitive P2P systems. In
ACM SIGCOMM, 2009.
[2] M. Akhoondi, C. Yu, and H. V. Madhyastha. LASTor:
A low-latency AS-aware Tor client. In IEEE
Symposium on Security and Privacy, 2013.
[3] E. Androulaki, M. Raykova, S. Srivatsan, A. Stavrou,
and S. M. Bellovin. PAR: Payment for anonymous
routing. In Symposium on Privacy Enhancing
Technologies (PETS), 2008.
[4] D. Chaum. Untraceable electronic mail, return
addresses, and digital pseudonyms. Communications
of the ACM, 24(2):84–88, Nov. 1981.
[5] Y. Chen, R. Sion, and B. Carbunar. XPay: Practical
anonymous payments for Tor routing and other
networked services. In Workshop on Privacy in the
Electronic Society (WPES), 2009.
[6] R. Cox, F. Dabek, F. Kaashoek, J. Li, and R. Morris.
Practical, distributed network coordinates. In
Workshop on Hot Topics in Networks (HotNets), 2003.
[7] R. Dingledine, N. Mathewson, and P. Syverson. Tor:
The second-generation onion router. In USENIX
Security Symposium, 2004.
[8] R. Dingledine and S. J. Murdoch. Performance
improvements on Tor or, why Tor is slow and what
we’re going to do about it. Online:
https://www.torproject.org/press/presskit/
2009-03-11-performance.pdf, 2009.
Figure 18: Number of /24s represented in the Tor network
from February to April 2015.
Tor network continues to grow, it will become increasingly
useful for medium-scale measurement across the network.
Finally, host types are diverse. The pool of relays is pre-
dominantly volunteer-run, and thus many relays are run
from within homes. To quantify the number of residential
hosts, we extended the residential detection technique de-
scribed by Schulman et al. [27], which involves classifying
hosts based on their reverse DNS name, including suﬃx and
presence of numbers—the original technique is only intended
for hosts within the U.S., while our extension also considers
hosts in Europe. Using this technique, we found that, of
the 5484 currently running Tor relays with a reverse DNS
name, at least 3355, or roughly 61%, are residential. This
underestimates the fraction of residential hosts both because
there are a number of Tor relays outside of the U.S. and Eu-
rope which are not accounted for, and because the remain-
ing 1150 of the 6634 currently running relay addresses have
no reverse DNS name. Data centers are also represented:
361 are at hosting sites identiﬁed by reverse DNS name
(linode.com, amazonaws.com, ovh.com, cloudatcost.com,
your-server.de, and leaseweb.com), and another 345 are
within Digital Ocean’s IP address range.
Summary
This section demonstrated a wide swath of applications that
beneﬁt from Ting’s accurate RTT measurements. We be-
lieve the set of applications to which Ting is beneﬁcial is
both broader and deeper than what is covered here. But
even with these few examples, we can conclude that Ting’s
accurate, all-pairs RTT estimation can be an extremely pow-
erful tool in securing and improving Tor.
6. CONCLUSION
In this paper, we presented Ting, a novel and practical
technique for measuring round-trip times between any arbi-
trary pair of Tor relays with accuracy and at scale. Ting
sets itself apart from previous attempts to compute latency
information in that: (1) it does not require any modiﬁca-
tion of the Tor client or protocol, (2) it does not require any
additional infrastructure deployment, and (3) it calculates
latencies by sending packets along the entire network path
 0 1000 2000 3000 4000 5000 6000 7000 8000 900002/2803/1403/2804/1104/25Number of RelaysDateTotal relays runningUnique /24s represented301[9] N. S. Evans, R. Dingledine, and C. Grothoﬀ. A
practical congestion attack on Tor using long paths.
In USENIX Security Symposium, 2009.
[10] Y. Gilad and A. Herzberg. Spying in the dark: TCP
and Tor traﬃc analysis. In Privacy Enhancing
Technologies, pages 100–119. Springer, 2012.
Symposium on Applications and the Internet
(SAINT), 2009.
[21] L. Peterson, T. Anderson, D. Culler, and T. Roscoe. A
blueprint for introducing disruptive technology into
the Internet. In Workshop on Hot Topics in Networks
(HotNets), 2002.
[11] K. P. Gummadi, S. Saroiu, and S. D. Gribble. King:
[22] M. K. Reiter and A. D. Rubin. Crowds: Anonymity
Estimating latency between arbitrary Internet end
hosts. In ACM Internet Measurement Workshop
(IMW), 2002.
[12] N. Hopper, E. Y. Vasserman, and E. Chan-Tin. How
much anonymity does network latency leak? ACM
Transactions on Information and System Security
(TISSEC), 13(2):13, 2010.
[13] R. Jansen, J. Geddes, C. Wacek, M. Sherr, and
P. Syverson. Never been KIST: Tor’s congestion
management blossoms with kernel-informed socket
transport. In USENIX Security Symposium, 2014.
[14] A. Johnson, C. Wacek, R. Jansen, M. Sherr, and
P. Syverson. Users get routed: Traﬃc correlation on
Tor by realistic adversaries. 2013.
[15] C. Lumezanu, R. Baden, D. Levin, N. Spring, and
B. Bhattacharjee. Symbiotic relationships in Internet
routing overlays. In Symposium on Networked Systems
Design and Implementation (NSDI), 2009.
[16] S. J. Murdoch and G. Danezis. Low-cost traﬃc
analysis of Tor. In USENIX Security Symposium,
2005.
[17] Neustar IP Geolocation.
https://www.neustar.biz/services/ip-intelligence.
[18] T. E. Ng and H. Zhang. Towards global network
positioning. In ACM Internet Measurement Workshop
(IMW), 2001.
[19] T.-W. Ngan, R. Dingledine, and D. S. Wallach.
Building incentives into Tor. In Financial
Cryptography (FC), 2010.
[20] A. Panchenko and J. Renner. Path selection metrics
for performance-improved onion routing. In
for web transactions. ACM TISSEC, 1(1):66–92, Nov.
1998.
[23] Reporters Without Borders. Enemies of the Internet
2013 Report. https://surveillance.rsf.org/en/
wp-content/uploads/sites/2/2013/03/
enemies-of-the-internet_2013.pdf, Mar. 2013.
[24] RIPE NCC. RIPE Atlas. https://atlas.ripe.net.
[25] SamKnows. https://www.samknows.com.
[26] S. Savage, A. Collins, E. Hoﬀman, J. Snell, and
T. Anderson. The end-to-end eﬀects of Internet path
selection. In ACM SIGCOMM, 1999.
[27] A. Schulman and N. Spring. Pingin’ in the rain. In
ACM Internet Measurement Conference (IMC), 2011.
[28] M. Sherr, M. Blaze, and B. T. Loo. Scalable link-based
relay selection for anonymous routing. In Privacy
Enhancing Technologies Symposium (PETS), 2009.
[29] R. Sherwood, B. Bhattacharjee, and A. Srinivasan. P5:
A protocol for scalable anonymous communication.
Journal of Computer Security, 13(6):839–876, 2005.
[30] Stem Controller Library.
https://stem.torproject.org.
[31] S. Sundaresan, S. Burnett, N. Feamster, and
W. De Donato. BISmark: A testbed for deploying
measurements and applications in broadband access
networks. In USENIX Annual Technical Conference,
2014.
[32] Tor Metrics. https://metrics.torproject.org.
[33] B. Wong, I. Stoyanov, and E. G. Sirer. Octant: A
comprehensive framework for the geolocalization of
Internet hosts. In Symposium on Networked Systems
Design and Implementation (NSDI), 2007.
302