And an ending note on token selection
Token#3
1000000
Owner:
PSP1
Token#2
1000000
Owner:
PSP1
Token#1
2000000
Owner:
PSP1
PSP1 UserA
PSP1 Admin
Redeem 3500000
Withdraw 50
78
3500000 not available!
Try Again!
PSP1 Corda
And an ending note on token selection
Token#3
1000000
Owner:
PSP1
Token#2
1000000
Owner:
PSP1
Token#1
2000000
Owner:
PSP1
PSP1 UserA
PSP1 Admin
Withdraw 50
79
3500000 not available!
Try Again!
PSP1 Corda
And an ending note on token selection
Token#3
1000000
Owner:
PSP1
Token#2
1000000
Owner:
PSP1
Token#1
2000000
Owner:
PSP1
PSP1 UserA
Token#4
999950
Owner:
PSP1
PSP1 Admin
Token#5
50
Owner:
UserA
Got 50
80
Backchain and privacy
Transactions
And tokens
Token#: 1[0]
Amount: 1000
Owner: PSP1
Sign: Riksbank
Reference: None
Tx: 1
Token#: 2[0]
Amount: 200
Owner: UserA
Sign: PSP1
Reference: 1[0]
Tx: 2
Token#: 2[1]
Amount: 800
Owner: PSP1
Sign: PSP1
Reference: 1[0]
Token#: 3[0]
Amount: 50
Owner: UserB
Sign: UserA
Reference: 2[0]
Tx: 3
Token#: 3[1]
Amount: 150
Owner: UserA
Sign: UserA
Reference: 2[0]
Riksbank
Corda 
node
PSP1
Corda 
node
Issue
1000
PSP1
Corda 
node
UserA withdraw
200
PSP2
Corda 
node
UserA => UserB
50
To be able to verify authenticity of the tokens all historic transactions for that token is needed. 
81
Backchain and privacy
Transactions
And tokens
Token#: 1[0]
Amount: 1000
Owner: PSP1
Sign: Riksbank
Reference: None
Tx: 1
Token#: 2[0]
Amount: 200
Owner: UserA
Sign: PSP1
Reference: 1[0]
Tx: 2
Token#: 2[1]
Amount: 800
Owner: PSP1
Sign: PSP1
Reference: 1[0]
Token#: 3[0]
Amount: 50
Owner: UserB
Sign: UserA
Reference: 2[0]
Tx: 3
Token#: 3[1]
Amount: 150
Owner: UserA
Sign: UserA
Reference: 2[0]
Riksbank
Corda 
node
PSP1
Corda 
node
Issue
1000
PSP1
Corda 
node
UserA withdraw
200
PSP2
Corda 
node
UserA => UserB
50
To be able to verify authenticity of the tokens all historic transactions for that token is needed. 
82
Backchain and privacy
Token#: 1[0]
Amount: 1000
Owner: PSP1
Sign: Riksbank
Reference: None
Tx: 1
Token#: 2[0]
Amount: 200
Owner: UserA
Sign: PSP1
Reference: 1[0]
Tx: 2
Token#: 2[1]
Amount: 800
Owner: PSP1
Sign: PSP1
Reference: 1[0]
Token#: 3[0]
Amount: 50
Owner: UserB
Sign: UserA
Reference: 2[0]
Tx: 3
Token#: 3[1]
Amount: 150
Owner: UserA
Sign: UserA
Reference: 2[0]
PSP1
Corda 
node
Issue
1000
PSP1
Corda 
node
UserA withdraw
200
PSP2
Corda 
node
UserA => UserB
50
So PSP2 can see how PSP1 have done the issue and how the UserA withdrawn 200. 
83
Backchain and privacy
Older and longer backchains reveals more.
PSP2 Admin
84
Backchain and privacy
Older and longer backchains reveals more.
UserA
PSP1
UserH
PSP2
60
PSP2 Admin
85
Backchain and privacy
Older and longer backchains reveals more.
UserC
PSP3
UserG
PSP1
UserA
PSP1
50
20
UserH
PSP2
60
PSP2 Admin
86
Backchain and privacy
Older and longer backchains reveals more.
UserD
PSP4
UserF
PSP4
UserC
PSP3
50
UserG
PSP1
50
UserA
PSP1
50
20
UserH
PSP2
60
PSP2 Admin
87
Backchain and privacy
UserA
PSP1
Older and longer backchains reveals more.
UserD
PSP4
325
UserE
PSP4
UserF
PSP4
100
UserC
PSP3
50
UserG
PSP1
50
UserA
PSP1
50
20
UserH
PSP2
60
PSP2 Admin
88
Backchain and privacy
PSP1
UserA
PSP1
withdraw
200
Older and longer backchains reveals more.
UserC
PSP3
75
UserD
PSP4
325
PSP4
UserE
PSP4
withdraw
400
UserF
PSP4
UserF
PSP4
100
100
UserC
PSP3
50
UserG
PSP1
50
UserA
PSP1
50
20
UserH
PSP2
60
PSP2 Admin
89
Backchain and privacy
PSP1
Issue
1000
UserA
PSP1
withdraw
200
Older and longer backchains reveals more.
PSP3
UserC
PSP3
withdraw
150
75
UserD
PSP4
325
PSP4
Issue
3000
UserE
PSP4
withdraw
400
UserF
PSP4
100
UserF
PSP4
100
100
UserC
PSP3
50
UserG
PSP1
50
UserA
PSP1
50
20
UserH
PSP2
60
PSP2 Admin
90
Backchain and privacy
PSP1
Issue
1000
UserA
PSP1
withdraw
200
Older and longer backchains reveals more.
PSP3
Issue
5000
UserC
PSP3
withdraw
150
75
UserD
PSP4
325
PSP4
Issue
3000
UserE
PSP4
withdraw
400
UserF
PSP4
100
UserF
PSP4
100
100
UserC
PSP3
50
UserG
PSP1
50
UserA
PSP1
50
20
UserH
PSP2
60
PSP2 Admin
91
Practical example: PSP2 backchain
Admin of PSP2 has only information from the PSP2 Corda node and business layer of PSP2.
To be able to get the backchain and to visualize it PSP2 admin has to:
• Extract the backchain
• Get the transactions
• Datamine
• Visualize
92
Practical example: Extract the backchain
Login to PSP2 Corda node and start the Corda node shell.
Run the command
run internalVerifiedTransactionsSnapshot
93
Practical example: PSP2 backchain
- wire:
    id: "6BE4262593EA89C5097FED35221CC0A27FE78F7BB6C10864E4E28269E8F2F038"
    inputs:
    - txhash: "5C8618DCFB36BFABB0B6DB66331EBEDB3699F50F4AC8FD2EB7291BD782DF5C53"
      index: 0
    outputs:
    - data: !
        amount: "100.85 SEK issued by Riksbanken"
        holder: 
"aSq9DsNNvGhYxYyqA9wd2eduEAZ5AXWgJTbTGL7RG71TWPEaZJhNFKWZWRp7jCHtRqYdZshmAv1tawKDd55qDnXDFmkUSvMqQhaRdxaMPYinLSop88JwAPReBZJw"
    - data: !
        amount: "5399.15 SEK issued by Riksbanken"
        holder: 
"aSq9DsNNvGhYxYyqA9wd2eduEAZ5AXWgJTbTFUZVr3NjFk7sDNTBjdg3q9sJNbZKfTVhDQ8vcyisu9mWsoMPA1Heqbb3ZbNirZFnBpgkuVDW7yWYsDiBWLGYdmDh"
    commands:
    - value: !
        token:
          issuer: "O=Riksbanken, L=Stockholm, C=SE"
          tokenType:
            tokenIdentifier: "SEK"
        inputs:
        - 0
        outputs:
        - 0
        - 1
      signers:
      - "aSq9DsNNvGhYxYyqA9wd2eduEAZ5AXWgJTbTFUZVr3NjFk7sDNTBjdg3q9sJNbZKfTVhDQ8vcyisu9mWsoMPA1Heqbb3ZbNirZFnBpgkuVDW7yWYsDiBWLGYdmDh"
94
Practical example: PSP2 backchain
- wire:
    id: "6BE4262593EA89C5097FED35221CC0A27FE78F7BB6C10864E4E28269E8F2F038"
    inputs:
    - txhash: "5C8618DCFB36BFABB0B6DB66331EBEDB3699F50F4AC8FD2EB7291BD782DF5C53"
      index: 0
    outputs:
    - data: !
        amount: "100.85 SEK issued by Riksbanken"
        holder: 
"aSq9DsNNvGhYxYyqA9wd2eduEAZ5AXWgJTbTGL7RG71TWPEaZJhNFKWZWRp7jCHtRqYdZshmAv1tawKDd55qDnXDFmkUSvMqQhaRdxaMPYinLSop88JwAPReBZJw"
    - data: !
        amount: "5399.15 SEK issued by Riksbanken"
        holder: 
"aSq9DsNNvGhYxYyqA9wd2eduEAZ5AXWgJTbTFUZVr3NjFk7sDNTBjdg3q9sJNbZKfTVhDQ8vcyisu9mWsoMPA1Heqbb3ZbNirZFnBpgkuVDW7yWYsDiBWLGYdmDh"
    commands:
    - value: !
        token:
          issuer: "O=Riksbanken, L=Stockholm, C=SE"
          tokenType:
            tokenIdentifier: "SEK"
        inputs:
        - 0
        outputs:
        - 0
        - 1
      signers:
      - "aSq9DsNNvGhYxYyqA9wd2eduEAZ5AXWgJTbTFUZVr3NjFk7sDNTBjdg3q9sJNbZKfTVhDQ8vcyisu9mWsoMPA1Heqbb3ZbNirZFnBpgkuVDW7yWYsDiBWLGYdmDh"
95
Practical example: PSP2 backchain
- wire:
    id: "6BE4262593EA89C5097FED35221CC0A27FE78F7BB6C10864E4E28269E8F2F038"
    inputs:
    - txhash: "5C8618DCFB36BFABB0B6DB66331EBEDB3699F50F4AC8FD2EB7291BD782DF5C53"
      index: 0
    outputs:
    - data: !
        amount: "100.85 SEK issued by Riksbanken"
        holder: 
"aSq9DsNNvGhYxYyqA9wd2eduEAZ5AXWgJTbTGL7RG71TWPEaZJhNFKWZWRp7jCHtRqYdZshmAv1tawKDd55qDnXDFmkUSvMqQhaRdxaMPYinLSop88JwAPReBZJw"
    - data: !
        amount: "5399.15 SEK issued by Riksbanken"
        holder: 
"aSq9DsNNvGhYxYyqA9wd2eduEAZ5AXWgJTbTFUZVr3NjFk7sDNTBjdg3q9sJNbZKfTVhDQ8vcyisu9mWsoMPA1Heqbb3ZbNirZFnBpgkuVDW7yWYsDiBWLGYdmDh"
    commands:
    - value: !
        token:
          issuer: "O=Riksbanken, L=Stockholm, C=SE"
          tokenType:
            tokenIdentifier: "SEK"
        inputs:
        - 0
        outputs:
        - 0
        - 1
      signers:
      - "aSq9DsNNvGhYxYyqA9wd2eduEAZ5AXWgJTbTFUZVr3NjFk7sDNTBjdg3q9sJNbZKfTVhDQ8vcyisu9mWsoMPA1Heqbb3ZbNirZFnBpgkuVDW7yWYsDiBWLGYdmDh"
96
Practical example: PSP2 backchain
- wire:
    id: "6BE4262593EA89C5097FED35221CC0A27FE78F7BB6C10864E4E28269E8F2F038"
    inputs:
    - txhash: "5C8618DCFB36BFABB0B6DB66331EBEDB3699F50F4AC8FD2EB7291BD782DF5C53"
      index: 0
    outputs:
    - data: !
        amount: "100.85 SEK issued by Riksbanken"
        holder: 
"aSq9DsNNvGhYxYyqA9wd2eduEAZ5AXWgJTbTGL7RG71TWPEaZJhNFKWZWRp7jCHtRqYdZshmAv1tawKDd55qDnXDFmkUSvMqQhaRdxaMPYinLSop88JwAPReBZJw"
    - data: !
        amount: "5399.15 SEK issued by Riksbanken"
        holder: 
"aSq9DsNNvGhYxYyqA9wd2eduEAZ5AXWgJTbTFUZVr3NjFk7sDNTBjdg3q9sJNbZKfTVhDQ8vcyisu9mWsoMPA1Heqbb3ZbNirZFnBpgkuVDW7yWYsDiBWLGYdmDh"
    commands:
    - value: !
        token:
          issuer: "O=Riksbanken, L=Stockholm, C=SE"
          tokenType:
            tokenIdentifier: "SEK"
        inputs:
        - 0
        outputs:
        - 0
        - 1
      signers:
      - "aSq9DsNNvGhYxYyqA9wd2eduEAZ5AXWgJTbTFUZVr3NjFk7sDNTBjdg3q9sJNbZKfTVhDQ8vcyisu9mWsoMPA1Heqbb3ZbNirZFnBpgkuVDW7yWYsDiBWLGYdmDh"
97
Practical example: PSP2 backchain
- wire:
    id: "6BE4262593EA89C5097FED35221CC0A27FE78F7BB6C10864E4E28269E8F2F038"
    inputs:
    - txhash: "5C8618DCFB36BFABB0B6DB66331EBEDB3699F50F4AC8FD2EB7291BD782DF5C53"
      index: 0
    outputs:
    - data: !
        amount: "100.85 SEK issued by Riksbanken"
        holder: 
"aSq9DsNNvGhYxYyqA9wd2eduEAZ5AXWgJTbTGL7RG71TWPEaZJhNFKWZWRp7jCHtRqYdZshmAv1tawKDd55qDnXDFmkUSvMqQhaRdxaMPYinLSop88JwAPReBZJw"
    - data: !
        amount: "5399.15 SEK issued by Riksbanken"
        holder: 
"aSq9DsNNvGhYxYyqA9wd2eduEAZ5AXWgJTbTFUZVr3NjFk7sDNTBjdg3q9sJNbZKfTVhDQ8vcyisu9mWsoMPA1Heqbb3ZbNirZFnBpgkuVDW7yWYsDiBWLGYdmDh"
    commands:
    - value: !
        token:
          issuer: "O=Riksbanken, L=Stockholm, C=SE"
          tokenType:
            tokenIdentifier: "SEK"
        inputs:
        - 0
        outputs:
        - 0
        - 1
      signers:
      - "aSq9DsNNvGhYxYyqA9wd2eduEAZ5AXWgJTbTFUZVr3NjFk7sDNTBjdg3q9sJNbZKfTVhDQ8vcyisu9mWsoMPA1Heqbb3ZbNirZFnBpgkuVDW7yWYsDiBWLGYdmDh"
98
Practical example: Get the transactions
Admin of PSP2 has now extracted and created a JSON list of all transactions for all backchains for all 
tokens on PSP2 Corda node.
{
"edges": [
{
"source": {"id": "PSP:GfHq2tTVk9z4eXgyKAMEqYfMYACZy4RQAuN3p72MxBywj86qJnnk3EhzaNPr", "label": 
"PSP:GfHq2tTVk9z4eXgyKAMEqYfMYACZy4RQAuN3p72MxBywj86qJnnk3EhzaNPr"},
"target": {"id": 
"aSq9DsNNvGhYxYyqA9wd2eduEAZ5AXWgJTbTKnaoNTewVAC9a27PCxXfDoS3pqhMa5duj6jJGEsqpvvtx59oNehuLxgXVWuaJ3oURRezoeTogZjBqpAPFXkmKnC4", "label": 
"aSq9DsNNvGhYxYyqA9wd2eduEAZ5AXWgJTbTKnaoNTewVAC9a27PCxXfDoS3pqhMa5duj6jJGEsqpvvtx59oNehuLxgXVWuaJ3oURRezoeTogZjBqpAPFXkmKnC4"},
"value": "1337.30"
},
{
"source": {"id": 
"aSq9DsNNvGhYxYyqA9wd2eduEAZ5AXWgJTbTKnaoNTewVAC9a27PCxXfDoS3pqhMa5duj6jJGEsqpvvtx59oNehuLxgXVWuaJ3oURRezoeTogZjBqpAPFXkmKnC4", "label": 
"aSq9DsNNvGhYxYyqA9wd2eduEAZ5AXWgJTbTKnaoNTewVAC9a27PCxXfDoS3pqhMa5duj6jJGEsqpvvtx59oNehuLxgXVWuaJ3oURRezoeTogZjBqpAPFXkmKnC4"},
"target": {"id": 
"aSq9DsNNvGhYxYyqA9wd2eduEAZ5AXWgJTbTJX1eBDU2mve7qqDWbmoVu9HDG1pstQnSss4TsEC68tDuWKSRZ9hNJDrmcfkxZ4agpD7qM2UsvAGcPWwbG3qdAuts", "label": 
"aSq9DsNNvGhYxYyqA9wd2eduEAZ5AXWgJTbTJX1eBDU2mve7qqDWbmoVu9HDG1pstQnSss4TsEC68tDuWKSRZ9hNJDrmcfkxZ4agpD7qM2UsvAGcPWwbG3qdAuts"},
"value": "1337.40"
}]
}
99
Practical example: Datamine
Admin of PSP2 has the public keys of users in the backchain but can enrich the information 
with wallet ID or alias with information in the logs or from user transaction log in the PSP2 
business layer. To be able to do this any user on PSP2 must have done a transaction with 
that public key earlier.
User history record extract from PSP2 business layer.
TxID
0DDB759E02091B3A52D61194AE7D464F7022DBF3DBAF45005B74F27F0E49A0B7
Command
PAY
Payer wallet ID
9021f73d-d883-4cfb-8899-203690bff93f
Payer PSP
PSP1
Payee wallet ID
cf960d62-b1a6-4816-8179-717808d160d8
Payee PSP
PSP2
Amount
5.00
100
Practical example: Visualize
Just pour the enriched JSON transaction list into HTML with D3.js (https://d3js.org/) function 
d3.layout.force() to connect all the transactions.
101
Visualization with data only from PSP2
102
Backchain and privacy
Need to be compliant with:
• European General Data Protection Regulation (GDPR)
• Swedish bank secrecy regulation
103
Everything else
 Everything that must be solved before going in production with a token based retail CBDC
• Performance and authenticity of the digital currency.
• High availability and in memory token selection.
• Catastrophic failures and disaster recovery.
• A secure offline?
• Non-repudiation.
• Information security (ISO 27000)
• IT security (NIST, OWASP)
• Laws, regulations and financial compliance
104
Solutions
There are many solutions for the presented challenges. 
• Chain snipping, Chipping, Key rotation, Zero knowledge proof and other encryption.
• Validating notary node.
• Hardware wallets (e.g. smart cards).
• Restore procedures and functions for correcting inconsistencies.
The Riksbank is now experimenting with other designs and will also look at other 
technologies.
105
Summary
The goal of this presentation is to share insights of the security challenges of building a 
prototype of a two tier retail central bank digital currency based on a blockchain with value 
based tokens.
Only presented threats, vulnerabilities, security fails and some unknowns.
Not presented the good design and all the positive lessons learned!
106
Thank you for 
attending
107