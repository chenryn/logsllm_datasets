以下是优化后的文本，使其更加清晰、连贯和专业：

---

### 查询1 - 4624（登录成功）
在Splunk中查询登录成功的事件，并筛选出主机数量大于2的结果。

```spl
| values(Workstation_Name) AS WS_Name, 
  values(Source_Network_Address) AS Source_IP, 
  values(Process_Name) AS Process_Name 
BY Account_Name
| where Host_Count > 2
```

### 查询2 - 5140（共享访问）
捕获不同系统上的共享访问。此查询用于检测对特定共享的访问。

```spl
index=windows source="WinEventLog:Security" EventCode=5140 
(Share_Name="*\\C$" OR Share_Name="*D$" OR Share_Name="*E$" OR Share_Name="*F$" OR Share_Name="*U$") 
NOT Source_Address="::1"
| eval Destination_Sys1=trim(host, "1")
| eval Destination_Sys2=trim(host, "2")
| eval Dest_Sys1=lower(Destination_Sys1)
| eval Dest_Sys2=lower(Destination_Sys2)
| rename host AS Destination
| rename Account_Domain AS Domain
| where Account_Name != Dest_Sys1
| where Account_Name != Dest_Sys2
| stats count, values(Domain) AS Domain, 
  values(Source_Address) AS Source_IP, 
  values(Destination) AS Destination, 
  dc(Destination) AS Dest_Count, 
  values(Share_Name) AS Share_Name, 
  values(Share_Path) AS Share_Path 
BY Account_Name
```

### 查询3 - 5156（Windows防火墙连接）
显示连接到某个IP地址的进程信息。

```spl
index=windows LogName=Security EventCode=5156 
NOT (Source_Address="239.255.255.250" OR Source_Address="224.0.0.*" OR Source_Address="::1" OR Source_Address="ff02::*" OR Source_Address="fe80::*" OR Source_Address="255.255.255.255" OR Source_Address="192.168.1.255")
NOT (Destination_Address="127.0.0.1" OR Destination_Address="239.255.255.250" OR Destination_Address="*.*.*.255" OR Destination_Address="224.0.0.25*")
NOT (Destination_Port="0")
NOT (Application_Name="\\icamsource\\" OR Application_Name="*\\bin\\splunkd.exe")
| dedup Destination_Address Destination_Port
| table _time, host, Application_Name, Direction, Source_Address, Source_Port, Destination_Address, Destination_Port
| sort Direction Destination_Port
```

### 查询4 - 7045（新服务添加）
当有新服务被添加时触发此事件。

```spl
index=windows LogName=System EventCode=7045 NOT (Service_Name=tenable_mw_scan)
| eval Message=split(Message, ".")
| eval Short_Message=mvindex(Message, 0)
| table _time, host, Service_Name, Service_Type, Service_Start_Type, Service_Account, Short_Message
```

### 查询5 - 4663（文件/注册表审计）
过滤掉已知的良好噪音事件，以提高准确性。

```spl
index=windows sourcetype=WinEventLog:Security EventCode=4663 
NOT (Process_Name="*\\Windows\\servicing\\TrustedInstaller.exe" OR Process_Name="*\\Windows\\System32\\poqexec.exe")
NOT (Object_Name="*\\Users\\svc_acct\\pnp" OR Object_Name="C:\\Users\\Surf\\AppData\\Local\\Google\\Chrome\\User Data*" OR Object_Name="C:\\Users\\Surf\\AppData\\Roaming\\Microsoft\\Windows\\Recent\\CustomDestinations" OR Object_Name="C:\\Windows\\System32\\LogFiles\\*" OR Object_Name="*ProgramData\\Microsoft\\RAC\\*" OR Object_Name="*\\Microsoft\\Windows\\Explorer\\thumbcache*" OR Object_Name="*.MAP" OR Object_Name="*counters.dat" OR Object_Name="*\\Windows\\Gatherlogs\\SystemIndex\\*")
| rename Process_Name as Created_By
| table _time, host, Security_ID, Handle_ID, Object_Type, Object_Name, Process_ID, Created_By, Accesses
```

### 其他有价值的查询
- **EventID 4657**：更多关于注册表键的详细信息。
- **EventID 7040**：服务状态变化。
- **EventID 106**：新的计划任务。
- **EventID 501**：PowerShell日志。
- **EventID 2004, 2005, 2006**：Windows防火墙规则添加、修改或删除。
- **Exchange by subject**：查找收到钓鱼邮件的人。
- **网络日志中的已知恶意IP**：谁访问了已知的恶意IP地址。

### Windows Splunk备忘单
- 包含本文档中的所有查询以及一些额外的运维过滤技巧。
- 可在MalwareArchaeology.com找到。

### 总结
- 从六大关键事件ID开始，逐步扩展。
- 启用命令行日志记录。
- 立即使用提供的查询。
- 使用“Windows Logging Cheat Sheet”轻松入门。
- 关注HackerHurricane.com博客获取更多信息。
- 新推出的“Windows Splunk Logging Cheat Sheet”供您参考。

感谢您的阅读！

---