LI
LLI_-L.
ICNIOMOXV
Lo
Consulting|Research|Development|Training
http://www.blackhillsinfosec.com
[recon-ng v4.1.4, Tim Tomes (@LaNMaSteR53)]
[56]Recon modules
[5]
Reporting modules
[2]
Exploitation modules
[2]
Discovery modules
[1]  Import modules
[recon-ng][default] >
以上输出信息显示了Recon-NG框架的基本信息。例如，在Recon-NG框架下，包括
56个侦查模块、5个报告模块、2个渗透攻击模块、2个发现模块和1个导入模块。看到
[recon-ng][default]>提示符，表示成功登录Recon-NG框架。现在，就可以在[recon-ng][default]
>提示符后面执行各种操作命令了。
首次使用Recon-NG框架之前，可以使用help命令查看所有可执行的命令。如下所示：
[recon-ng][default] > help
Commands (type [helpl?] ):
add
Adds records to the database
back
Exits current prompt level
·93 ·
---
## Page 106
第2篇信息的收集及利用
del
Deletes records from the database
exit
Exits current prompt level
help
Displays this menu
keys
Manages framework APl keys
load
Loads specified module
pdb
Starts a Python Debugger session
query
Queries the database
record
Records commands to a resource file
reload
Reloads all modules
resource
Executes commands from a resource file
search
Searches available modules
set
Sets module options
shell
Executes shell commands
show
Shows various framework items
spool
Spools output to a file
unset
Unsets module options
use
Loads specified module
workspaces
Manages workspaces
以上输出信息显示了在Recon-NG框架中可运行的命令。该框架和Metasploit框架类
似，同样也支持很多模块。此时，可以使用showmodules命令查看所有有效的模块列表。
执行命令如下所示：
[recon-ng][default] > show modules
Discovery
discovery/info_disclosure/cache_snoop
discovery/info_disclosure/interesting_files
Exploitation
exploitation/injection/command_injector
exploitation/injection/xpath_bruter
Import
import/csv_file
Recon
recon/companies-contacts/facebook
recon/companies-contacts/jigsaw
recon/companies-contacts/jigsaw/point_usage
recon/companies-contacts/jigsaw/purchase_contact
recon/companies-contacts/jigsaw/search_contacts
recon/companies-contacts/linkedin_auth
recon/contacts-contacts/mangle
recon/contacts-contacts/namechk
recon/contacts-contacts/rapportive
recon/contacts-creds/haveibeenpwned
recon/hosts-hosts/bing_ip
recon/hosts-hosts/ip_neighbor
recon/hosts-hosts/ipinfodb
recon/hosts-hosts/resolve
recon/hosts-hosts/reverse_resolve
recon/locations-locations/geocode
recon/locations-locations/reverse_geocode
recon/locations-pushpins/flickr
· 94 ·
---
## Page 107
第4章信息收集
recon/locations-pushpins/picasa
recon/locations-pushpins/shodan
recon/locations-pushpins/twitter
recon/locations-pushpins/youtube
recon/netblocks-hosts/reverse_resolve
recon/netblocks-hosts/shodan_net
recon/netblocks-ports/census_2012
Reporting
reporting/csv
reporting/html
reporting/list
reporting/pushpin
reporting/xml
[recon-ng][default]>
从输出的信息中，可以看到显示了五部分。每部分包括的模块数，在启动Recon-NG
框架后可以看到。用户可以使用不同的模块进行各种的信息收集。下面以例子的形式介绍
使用Recon-NG中的模块进行信息收集。
【实例4-3】使用recon/domains-hosts/baidu_site模块，枚举baidu网站的子域。具体操
作步骤如下所示。
（1）使用recon/domains-hosts/baidu_site模块。执行命令如下所示：
[recon-ng][default]>use recon/domains-hosts/baidu_site(
（2）查看该模块下可配置选项参数。执行命令如下所示：
[recon-ng][default][baidu_site] > show options
Name
Current
Value
Req
Description
SOURCE
default
yes
source of input (see ‘show info' for details)
[recon-ng][default][baidu_site] >
从输出的信息中，可以看到有一个选项需要配置。
（3）配置SOURCE选项参数。执行命令如下所示：
[recon-ng][default][baidu_site]> set SOURCE baidu.com
SOURCE=>baidu.com
从输出的信息中，可以看到SOURCE选项参数已经设置为baidu.com。
（4）启动信息收集。执行命令如下所示：
[recon-ng][default][baidu_site] > run
BAIDU.COM
[*] URL: http://www.baidu.com/s?pn=0&wd=site%3Abaidu.com
[*] map.baidu.com
[*] 123.baidu.com
[*] jingyan.baidu.com
[*] top.baidu.com
[*] www.baidu.com
·95 ·
---
## Page 108
第2篇信息的收集及利用
[*] hi.baidu.com
[*] video.baidu.com
[] pan.baidu.com
[*] zhidao.baidu.com
[*] Sleeping to avoid lockout.
SUMMARY
[*] 9 total (2 new) items found.
从输出的信息中，可以看到找到了9个子域。枚举到的所有数据将被连接到Recon-NG
放置的数据库中。这时候，用户可以创建一个报告查看被连接的数据。
【实例4-4】查看获取的数据。具体操作步骤如下所示。
（1）选择reporting/csv模块，执行命令如下所示。
[recon-ng][default]>use reporting/csv
（2）生成报告。执行命令如下所示：
[recon-ng][default][csv]>run
[*] 9 records added to ′root/.recon-ng/workspaces/default/results.csv
从输出的信息中可以看到，枚举到的9个记录已被添加到/root/.recon-ng
/workspaces/defaultresults.csv文件中。打开该文件，如图4.4所示。
results.csv
-ox
文件(F）编辑(E）搜索(S）选项(O）帮助(H)
"h1 .baldu. com*,
"map .baldu.con",
.. .. .. ..
"pan.baidu.con"
"top.baldu.con"
"www.baldu.con",
图4.4results.csv 文件
（3）从该界面可以看到，枚举到的所有子域。
用户也可以使用Dmitry命令，查询关于网站的信息。下面将介绍Dmitry命令的使用。
查看Dmitry命令的帮助信息。执行命令如下所示：
root@kali:~# dmitry -h
Deepmagic Information Gathering Tool
"There be some deep magic going on"
dmitry: invalid option -- *h'
Usage: dmitry [-winsepfb] [-t 0-9] [-o %host.txt] host
-0Save output to %host.txt or to file specified by -o file
-iPerform a whois lookup on the IP address of a host
-wPerform a whois lookup on the domain name of a host
-n Retrieve Netcraft.com information on a host
-sPerform a search for possible subdomains
· 96 ·
---
## Page 109
第4章信息收集
-ePerform a search for possible email addresses
-pPerform a TCP port scan on a host
* -fPerform a TCP port scan on a host showing output reporting filtered ports
* -b Read in the banner received from the scanned port
* -t 0-9 Set the TTL in seconds when scanning a TCP port (Default 2 )
*Requires the -p flagged to be passed
以上信息显示了dmitry命令的语法格式和所有可用参数。下面使用dmitry命令的-s选
项，查询合理的子域。执行命令如下所示：
root@kali:~# dmitry -s google.com
Deepmagic Information Gathering Tool
"There be some deep magic going on"
HostIP:173.194.127.71
HostName:google.com
Gathered Subdomain information for google.com
Searching Google.com:80...
HostName:www.google.com
HostIP:173.194.127.51
Searching Altavista.com:80.
All scans completed, exiting
m
从输出的信息中，可以看到搜索到了一个子域。该子域名为www.google.com，IP地址
为173.194.127.51。该命令默认是从google.com网站搜索，如果不能连接google.com网站
的话，执行以上命令将会出现Unabletoconnect:SocketConnectError错误信息。
4.7.2ARP侦查工具Netdiscover
Netdiscover是一个主动/被动的ARP侦查工具。该工具在不使用DHCP的无线网络上
非常有用。使用Netdiscover工具可以在网络上扫描IP地址，检查在线主机或搜索为它们
发送的ARP请求。下面将介绍Netdiscover工具的使用方法。
Netdiscover命令的语法格式如下所示：
[-] [-] [s-] -] -] [uno-] [pouu-] [w s-] [d-y 1 bue-] [] os
以上语法中，各选项参数含义如下所示。
口-idevice：指定网络设备接口。
口-rrange：指定扫描网络范围。
口-1file：指定扫描范围列表文件。
口-p：使用被动模式，不发送任何数据。
口-stime：每个ARP请求之间的睡眠时间。
口-nnode：使用八字节的形式扫描。
口-c count：发送ARP请求的时间次数。
口-f：使用主动模式。
• 97 *
---
## Page 110
第2篇信息的收集及利用
口-d：忽略配置文件。
口-S：启用每个ARP请求之间抑制的睡眠时间。
口-P：打印结果。
口-L：将捕获信息输出，并继续进行扫描。
【实例4-5】使用Netdiscover工具攻击扫描局域网中所有的主机。执行命令如下所示：
root@kali:~#netdiscover
执行以上命令后，将显示如下所示的信息：
Currently scanning:10.7.99.0/8|Screen View:Unique Hosts
692 Captured ARP Req/Rep packets, from 3 hosts.
Total size: 41520
IP
At MAC Address
Count
Len
MAC Vendor
192.168.6.102
00:e0:1c:3c:18:79
296
17760
Cradlepoint, Inc
192.168.6.1
14:e6:e4:ac:fb:20
387
23220
Unknown vendor
192.168.6.110
00:0c:29:2e:2b:02
09
540
VMware, Inc.
从输出的信息中，可以看到扫描到了三台主机。其IP地址分别为192.168.6.102、
192.168.6.1 和1 192.168.6.110。
4.7.3搜索引擎工具Shodan
Shodan是互联网上最强大的一个搜索引擎工具。该工具不是在网上搜索网址，而是直
接的服务器、摄像头、打印机和路由器等。每个月都会在大约5亿个服务器上日夜不停的
搜集信息。下面将介绍Shodan工具的使用。
Shodan的官网网址是www.shodanhq.com。打开该网址界面，如图4.5所示。
SHODAN - Computer S. x
Cwww.shodanhq.com
三
Exploits
Scanhub
SHODAN
EXPOSEONLINEDEVICES.
WEBCAMS.ROUTERS.
REFRIGERATORS.VOIPPHONES.
ES.WIND TURBINES.
TAKE A TOUR
图4.5 Shodan 官网
如果要搜索一些东西时，在Shodan对应的文本框中输入搜索的内容。然后，单击Search
按钮开始搜索。例如，用户想要搜索思科路由器，则在搜索框中输入Cisco，并单击Search
· 98 ·
---
## Page 111
第4章信息收集
按钮。搜索到结果后，显示界面如图4.6所示。
 SHODAN - Compufer S x
→C www.shodanhq.com/search?q=Cisco
品
SHODAN
Services
173.169.131.101
00913-0°1-8
SP
330.281
 Lanca
Hurricane
306.575
173-163-431-401-8
1,020,959
186.56.20.158
Jsited State
179,180
don 12.07.2014
hin
154,572
二
25,941
25,701
图4.6搜索结果
从该界面可以看到搜索到全球三百多万的Cisco路由器。在该界面用户可以单击任何
IP地址，直接找到该设备。
在使用Shodan搜索引擎中，可以使用过滤器通过缩亦搜索范围快速的查询需要的东
西。如查找运行在美国ⅡIS8.0的所有IIS服务，
，可以使用以下搜索方法，如图4.7所示。
SHODAN
Mieroso1
Services.8
Conterit-Tyse
At1-Bod
I lete
9
图4.7搜索的IIS服务
在该界面显示了搜索到的一个ⅡIS8.0服务器。从搜索到的设备中，可以看到关于该服
务器的标题信息、所在的国家、主机名和文本信息。
在Shodan搜索时，需要注意一些过滤器命令的语法。常见的几种情况如下所示。
1.City和Country命令
使用City和Country命令可以缩小搜索的地理位置。如下所示。
口country:US表示从美国进行搜索。
* 99 ·
---
## Page 112
第2篇信息的收集及利用
口city:Memphis表示从孟斐斯城市搜索。
City和Country命令也可以结合使用。如下所示。
country:US city:Memphis。
2.HOSTNAME命令
HOSTNAME命令通过指定主机名来扫描整个域名。
口hostname:google表示搜索google主机。
3.NET命令
使用NET命令扫描单个IP或一个网络范围。如下所示。
net:192.168.1.10：扫描主机192.168.1.10。
net:192.168.1.0/24：扫描192.168.1.0/24网络内所有主机。
4.Title命令
使用Title命令可以搜索项目。如下所示。
口title:“ServerRoom”表示搜索服务器机房信息。
5.关键字搜索
Shodan使用一个关键字搜索是最受欢迎的方式。如果知道目标系统使用的服务器类型
或嵌入式服务器名，来搜索一个Web页面是很容易的。如下所示。
口apache/2.2.8200ok：表示搜索所有Apache服务正在运行的2.2.8版本，并且仅搜
索打开的站点。
口apache/2.2.8-401-302：表示跳过显示401的非法页或302删除页。
6.组合搜索
口ⅡIS/7.0hostname:YourCompany.com city:Boston表示搜索在波士顿所有正在运行