routers share a single port on a provider-edge (PE) router. Each service uses one logical interface. A set
of services or logical interfaces (colored in yellow) are destined to one CE router and a set of services or
logical interfaces colored in red are destined to another CE router. To monitor each service, you need
dedicated down maintenance association end point (MEP) sessions for each service. You can bring down
the service by bringing down the service logical interface whenever the session goes down. However,
this approach is not scalable if we have large number of services. Monitoring the CFM session on the
physical interface is also not feasible because multiple CE routers might be connected and the services
to other CE router could be disrupted. To address this issue of monitoring multiple services with a single
session, you can create a CCM action profile to bring down a group of logical interfaces by using a CFM
session that is configured on a single logical interface.
Figure 3: Topology of Multiple VLAN Services Sharing a Single Port on PE Router Destined to Multiple
CE Routers
You can configure CCM action profiles for the following scenarios:
• To bring down a group of logical interfaces all having the same parent port when CCM monitoring
session is running on one of the logical interface but on a different parent port.
• To bring down a group of logical interfaces when CCM monitoring session is running on one of the
logical interfaces, all belonging to the same parent port.
• To bring down the port, when the CCM monitoring session is running on one of the logical interfaces
of a different parent port.
Benefits of Creating CFM Action Profile to Bring Down a Group of Logical Interfaces
• Reduces resource requirement in scaled networks where multiple services need to be monitored.
57
• Avoids the need to create individual MEP sessions for each service in a topology that includes
multiple services to be monitored, thereby enhancing the performance and scalability of the network.
SEE ALSO
action-profile
Configure a CFM Action Profile to Bring Down a Group of Logical Interfaces
To monitor multiple services or IFLs using CFM session configured on a single logical interface, you can
create a CCM action profile to bring down a group of logical interfaces. You need to define an action to
bring down the interface group in the action profile. You will then define the interface device name and
the number of logical interfaces that have to be brought down. A logical interface is represented by a
combination of the interface-device-name and unit-list. The following steps explain the procedure to bring
down a group of logical interfaces when the interface-device-name and/or unit-list are specified.
1. In configuration mode, at the [edit protocols oam ethernet connectivity-fault-management] hierarchy level,
specify the name of the action profile and the CFM event(s). You can configure more than one event
in the action profile.
[edit protocols oam ethernet connectivity-fault-management]
user@host# set action-profile profile-name event [event1, event2, event3..]
For example,
user@host# set action-profile AP_test event adjacency-loss rdi
NOTE: The action interface-group-down will not be supported with events other than adjacency-
loss and RDI. Any other events configured results in a commit error.
2. In configuration mode, at the [edit protocols oam ethernet connectivity-fault-management action-profile
profile-name ] hierarchy level, define the action to bring down the interface group.
[edit protocols oam ethernet connectivity-fault-management action-profile AP-test ]
user@host# set action interface-group-down
58
NOTE: The action interface-group-down will not be supported with other interface related
actions. Any other actions configured results in a commit error.
3. At the [edit protocols oam ethernet connectivity-fault-management] hierarchy level, define the maintenance
domain. Specify the maintenance-association parameters.
[edit protocols oam ethernet connectivity-fault-management]
user@host# set maintenance-domain domain-name level number maintenance-association ma-name
continuity-check interval 1s
For example,
user@host# set maintenance-domain md6 level 6 maintenance-association ma6 continuity-check
interval 1s
4. At the edit protocols oam ethernet connectivity-fault-management maintenance-domain md-name maintenance-
association ma-name, define the maintenance association endpoint and the associated parameters.
[edit protocols oam ethernet connectivity-fault-management maintenance-domain md-name
maintenance-association ma-name]
user@host# set mep mep-id interface interface-name direction down remote -mep mep-id
For example,
user@host# set mep 101 interface ge-0/0/0.0 direction down remote -mep 102
5. If the action-profile has interface-group-down action configured, it is mandatory to configure the
interface-group at the RMEP level. In the configuration mode at the [edit protocols oam ethernet
connectivity-fault-management maintenance-domain md-name maintenance-association ma-name mep mep-id remote-mep
mep-id action-profile profile-name include the interface-group statement to bring down the interface
group marked with the action profile as interface-group-down.
[edit protocols oam ethernet connectivity-fault-management maintenance-domain md-name
maintenance-association ma-name mep mep-id remote-mep mep-id action-profile profile-name]
user@host# set interface-group
59
For example,
[edit protocols oam ethernet connectivity-fault-management maintenance-domain md6 maintenance-
association ma6 mep 101 remote-mep 102 action-profile AP_test]
user@host# set interface-group
NOTE: If the interface-group configuration is not included in the RMEP configuration. The
configuration results in commit error.
6. A logical interface is represented by a combination of the interface-device-name and unit-list. Configure
the device interface name and the number of logical interfaces at the [edit protocols oam ethernet
connectivity-fault-management maintenance-domain md-name maintenance-association ma-name mep mep-id remote-mep
mep-id action-profile profile-name interface-group.
[edit protocols oam ethernet connectivity-fault-management maintenance-domain md-name
maintenance-association ma-name mep mep-id remote-mep mep-id action-profile profile-name
interface-group]
user@host# set interface interface-name
user@host# set unit-list logical-interface-unit-number
For example,
[edit protocols oam ethernet connectivity-fault-management maintenance-domain md6 maintenance-
association ma6 mep 101 remote-mep 102 action-profile AP_test interface-group]
user@host# set interface ge-0/0/0.0
user@host# set unit-list 1223-3344
In this configuration example, the interface ge-0/0/0.0 is brought down.
NOTE:
• At least one of the interface-group parameters, interface-device-name or unit-list must be
configured. If the interface device name is not configured, the MEP interface is considered
as the device name and the logical interface on that device is brought down.
• If the unit-list parameter exceeds the recommended limit, a commit error occurs.
60
• If the interface-device-name is not specified in the interface-group, the logical interface
numbers mentioned in unit-list for the physical interface is brought down.
• If the unit-list is not specified in the interface-group, IFLs are brought down for the
configured interface.
7. Verify the configuration using show protocols oam command.
[edit]
user@host# show protocols oam
ethernet {
connectivity-fault-management {
action-profile AP_TEST {
event {
adjacency-loss;
rdi;
}
action {
interface-group-down;
}
}
maintenance-domain md6 {
level 6;
maintenance-association ma6 {
continuity-check {
interval 1s;
}
mep 102 {
interface ge-0/0/0.0;
direction down;
remote-mep 103 {
action-profile AP_TEST;
interface-group {
ge-0/0/1;
unit-list [12 23-33 44];
}
}
}
}
}
61
}
}
SEE ALSO
interface-group
interface-group-down
Configure a CFM Action Profile to Specify CFM Actions for CFM Events
You can create a connectivity fault management (CFM) action profile to define event flags and
thresholds to be monitored. You can also specify the action to be taken when any of the configured
events occur. When the CFM events occur, the router performs the corresponding action based on your
specification. You can configure one or more events in the action profile. Alternatively, you can configure
an action profile and specify default actions when connectivity to a remote maintenance association
endpoint (MEP) fails.
NOTE: You cannot configure multiple actions at this time. Only one action can be configured.
This limitation affects both the action and clear-action statements.
To configure the CFM action profile:
1. In configuration mode, at the [edit protocols oam ethernet connectivity-fault-management] hierarchy level,
specify the name of the action profile and the CFM event(s). You can configure more than one event
in the action profile. Possible events include: interface-status-tlv, port-status-tlv, adjacency-loss, RDI.
[edit protocols oam ethernet connectivity-fault-management]
user@host# set action-profile profile-name event [event1, event2, event3..]
2. Specify the action to be taken by the router when the event occurs. The action is triggered when the
event occurs. If you have configured more than one event in the action profile, it is not necessary for
all events to occur to trigger the action.
[edit protocols oam ethernet connectivity-fault-management]
user@host# set action-profile profile-name action action
3. Specify the default action to be taken by the router when connectivity to a remote MEP fails. If no
action is configured, no action is taken.
62
NOTE: Associating an action profile with the interface-down action on an up MEP CFM session
running over a circuit cross-connect (CCC) interface (l2circuit/l2vpn) is not advisable and can
result in a deadlock situation.
[edit protocols oam ethernet connectivity-fault-management]
user@host# set action-profile profile-name default-actions action
SEE ALSO
event (CFM)
default-actions
connectivity-fault-management
Ethernet Local Management Interface
IN THIS SECTION
Ethernet Local Management Interface Overview | 62
Configure the Ethernet Local Management Interface | 65
Example E-LMI Configuration | 67
Ethernet Local Management Interface Overview
Gigabit Ethernet (ge), 10-Gigabit Ethernet (xe), and Aggregated Ethernet (ae) interfaces support the
Ethernet Local Management Interface (E-LMI).
NOTE: On MX Series routers, E-LMI is supported on Gigabit Ethernet (ge), 10-Gigabit Ethernet
(xe), and Aggregated Ethernet (ae) interfaces configured on MX Series routers with DPC only.
63
The E-LMI specification is available at the Metro Ethernet Forum. E-LMI procedures and protocols are
used for enabling automatic configuration of the customer edge (CE) to support Metro Ethernet
services. The E-LMI protocol also provides user-to-network interface (UNI) and Ethernet virtual
connection (EVC) status information to the CE. The UNI and EVC information enables automatic
configuration of CE operation based on the Metro Ethernet configuration.
The E-LMI protocol operates between the CE device and the provider edge (PE) device. It runs only on
the PE-CE link and notifies the CE of connectivity status and configuration parameters of Ethernet
services available on the CE port. The scope of the E-LMI protocol is shown in Figure 4 on page 63.
Figure 4: Scope of the E-LMI Protocol
The E-LMI implementation on ACX and MX Series routers includes only the PE side of the E-LMI
protocol.
E-LMI interoperates with an OAM protocol, such as Connectivity Fault Management (CFM), that runs
within the provider network to collect OAM status. CFM runs at the provider maintenance level (UNI-N
to UNI-N with up MEPs at the UNI). E-LMI relies on the CFM for end-to-end status of EVCs across CFM
domains (SVLAN domain or VPLS).
The E-LMI protocol relays the following information:
• Notification to the CE of the addition/deletion of an EVC (active, not active, or partially active)
• Notification to the CE of the availability state of a configured EVC
• Communication of UNI and EVC attributes to the CE:
• UNI attributes:
• UNI identifier (a user-configured name for UNI)
• CE-VLAN ID/EVC map type (all-to-one bundling, service multiplexing with bundling, or no
bundling)
• Bandwidth profile is not supported (including the following features):
64
• CM (coupling mode)
• CF (color flag)
• CIR (committed Information rate)
• CBR (committed burst size)
• EIR (excess information rate)
• EBS (excess burst size)
• EVC attributes:
• EVC reference ID
• EVC status type (active, not active, or partially active)
• EVC type (point-to-point or multipoint-to-multipoint)
• EVC ID (a user-configured name for EVC)
• Bandwidth profile (not supported)
• CE-VLAN ID/EVC map
E-LMI on MX Series routers supports the following EVC types:
• Q-in-Q SVLAN (point-to-point or multipoint-to-multipoint)—Requires an end-to-end CFM session
between UNI-Ns to monitor the EVS status.
• VPLS (BGP or LDP) (point-to-point or multipoint-to-multipoint)—Either VPLS pseudowire status or
end-to-end CFM sessions between UNI-Ns can be used to monitor EVC status.
• L2 circuit/L2VPN (point-to-point)—Either VPLS pseudowire status or end-to-end CFM sessions
between UNI-Ns can be used to monitor EVC status.
NOTE: l2-circuit and l2vpn are not supported.
The E-LMI protocol on ACX Series routers supports Layer 2 circuit and Layer 2 VPN EVC types and
enables link-loss forwarding for pseudowire (Layer 2 circuit and Layer 2 VPN) services as follows:
• Interworking between the connectivity fault management (CFM) protocol and the E-LMI protocol for
Layer 2 circuit and Layer 2 VPN.
• End-to-end CFM session between UNIs to monitor EVC status.
65
• In the case of pseudowire redundancy, CFM can be used to monitor active and backup
pseudowire sessions. The EVC status is declared as down to CE devices only when both the
active and backup pseudowire sessions go down.
• Interworking between remote defect indication (RDI) and E-LMI for Layer 2 circuit and Layer 2 VPN.
• If a maintenance association end point (MEP) receives an RDI bit set in a continuity check
message (CCM) frame, and if RDI fault detection is enabled in the EVC configuration at [edit
protocols oam ethernet evcs evc-id evc-protocol cfm management-domain name management-association name
faults rdi], then the pseudowire is declared as down to CE routers through E-LMI.
• If an end-to-end CFM session does not exist between UNIs, the pseudowire (Layer 2 circuit or Layer
2 VPN) up and down state triggers an asynchronous EVC state change message to CE routers
through E-LMI.
NOTE: ACX Series routers do not support E-LMI for Layer 2 services (bridging).
Configure the Ethernet Local Management Interface
IN THIS SECTION
Configuring an OAM Protocol (CFM) | 65
Assigning the OAM Protocol to an EVC | 65
Enabling E-LMI on an Interface and Mapping CE VLAN IDs to an EVC | 66
To configure E-LMI, perform the following steps:
Configuring an OAM Protocol (CFM)
For information on configuring the OAM protocol (CFM), see "IEEE 802.1ag OAM Connectivity Fault
Management Overview" on page 21.
Assigning the OAM Protocol to an EVC
To configure an EVC, you must specify a name for the EVC using the evcsevc-id statement at the [edit
protocols oam ethernet] hierarchy level. You can set the EVC protocol for monitoring EVC statistics to cfm
or vpls using the evc-protocol statement and its options at the [edit protocols oam ethernet evcs] hierarchy
level.
66
You can set the number of remote UNIs in the EVC using the remote-uni-count number statement at the
[edit protocols oam ethernet evcs evcs-protocol] hierarchy level. The remote-uni-count defaults to 1.
Configuring a value greater than 1 makes the EVC multipoint-to-multipoint. If you enter a value greater
than the actual number of endpoints, the EVC status will display as partially active even if all endpoints
are up. If you enter a remote-uni-count less than the actual number of endpoints, the status will display as
active, even if all endpoints are not up.
You can configure an EVC by including the evcs statement at the [edit protocols oam ethernet] hierarchy
level:
[edit protocols oam ethernet]
evcs evc-id {
evc-protocol (cfm (management-domain name management-association name ) | vpls (routing-
instance name)) {
remote-uni-count ; # Optional, defaults to 1
multipoint-to-multipoint;
# Optional, defaults to point-to-point if remote-uni-count is 1
}
}
Enabling E-LMI on an Interface and Mapping CE VLAN IDs to an EVC
To configure E-LMI, include the lmi statement at the [edit protocols oam ethernet] hierarchy level:
[edit protocols oam ethernet]
lmi {
polling-verification-timer value;
# Polling verification timer (T392), defaults to 15 seconds
status-counter count; # Status counter (N393), defaults to 4
interface name {
evc evc-id {
default-evc;
vlan-list [ vlan-ids ];
}
evc-map-type (all-to-one-bundling | bundling | service-multiplexing);
polling-verification-time value; # Optional, defaults to global value
status-counter count; # Optional, defaults to global value
uni-id value; # Optional, defaults to interface-name
}
}
67
You can set the status counter to count consecutive errors using the status-counter count statement at the
[edit protocols oam ethernet lmi] hierarchy level. The status counter is used to determine if E-LMI is
operational or not. The default value is 4.
You can set the polling-verification-timer value statement at the [edit protocols oam ethernet lmi] hierarchy
level. The default value is 15 seconds.
You can enable an interface and set its options for use with E-LMI using the interface name statement at
the [edit protocols oam ethernet lmi] hierarchy level. Only ge, xe, and ae interfaces are supported. You can
use the interface uni-id option to specify a name for the UNI. If uni-id is not configured, it defaults to the
name variable of interface name.
You can specify the CE-VLAN ID/EVC map type using the evc-map-type type interface option. The options
are all-to-one-bundling, bundling, or service-multiplexing. Service multiplexing is with no bundling. The
default type is all-to-one-bundling.
To specify the EVC that an interface uses, use the evc evc-id statement at the [edit protocols oam ethernet
lmi interface name] hierarchy level. You can specify an interface as the default EVC interface using the
default-evc statement at the [edit protocols oam ethernet lmi interface name evc evc-id] hierarchy level. All
VIDs that are not mapped to any other EVCs are mapped to this EVC. Only one EVC can be configured
as the default.
You can map a list of VLANs to an EVC using the vlan-list vlan-id-list statement at the [edit protocols oam
ethernet lmi interface name evc evc-id] hierarchy level.
Example E-LMI Configuration
IN THIS SECTION
Example Topology | 67
Configuring PE1 | 68
Configuring PE2 | 70
Configuring Two UNIs Sharing the Same EVC | 72
Example Topology
Figure 5 on page 68 illustrates the E-LMI configuration for a point-to-point EVC (SVLAN) monitored by
CFM. In this example, VLANs 1 through 2048 are mapped to evc1 (SVLAN 100) and 2049 through 4096
are mapped to evc2 (SVLAN 200). Two CFM sessions are created to monitor these EVCs.
68
Figure 5: E-LMI Configuration for a Point-to-Point EVC (SVLAN) Monitored by CFM
Configuring PE1
[edit]
interfaces {
ge-1/1/1 {
unit 0 {
family bridge {
interface-mode trunk;
vlan-id-list 1-2048;
}
}
unit 1 {
family bridge {
interface-mode trunk;
vlan-id-list 2049-4096;
}
}
}
ge-1/1/2 {
unit 0 {
vlan-id 100;
family bridge {
interface-mode trunk;
inner-vlan-id-list 1-2048;
}
}
unit 1 {
vlan-id 200;
family bridge {
interface-mode trunk;
inner-vlan-id-list 2049-4096;
69
}
}
}
}
protocols {