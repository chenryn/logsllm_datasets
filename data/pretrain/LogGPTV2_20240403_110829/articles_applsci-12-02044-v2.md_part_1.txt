applied
sciences
Article
A Novel Dictionary-Based Method to Compress Log Files with
Different Message Frequency Distributions
PéterMarjai1 ,PéterLehotay-Kéry1 andAttilaKiss1,2,*
1 DepartmentofInformationSystems,ELTEEötvösLorándUniversity,1117Budapest,Hungary;
PI:EMAIL(P.M.);PI:EMAIL(P.L.-K.)
2 DepartmentofInformatics,J.SelyeUniversity,94501Komárno,Slovakia
* Correspondence:PI:EMAIL
Abstract: Inthepresentday,virtuallyeveryapplicationsoftwaregenerateslargeamountsoflog
entriesduringitswork.Thelogfilesthataremadefromtheseentriesareacollectionofinformation
aboutwhathappenedwhiletheprogramwasrunning.Thisreportcanbeusedformultiplepurposes
suchasperformancemonitoring,maintainingsecurity,orimprovingbusinessdecisionmaking.Log
entriesareusuallygeneratedinadisorganizedmanner.Usingtemplateminers,thedifferent‘event
types’canbedistinguished(eachlogentryisanevent),andthesetofallentriesissplitintodisjointed
subsetsaccordingtotheeventtypes.Theseeventsconsistoftwoparts.Thefirstistheconstantpart,
whichisthesameforalloccurrencesofthesameeventtype.Thesecondistheparameterpart,which
canbedifferentforeachoccurrence.Sincesoftwaremass-produceslogfiles,inourpreviouspaper,
weintroducedanalgorithmthatusesthetemplatesminedfromthedatatocreateadictionary,which
isthenusedtoencodethelogentries,soonlytheIDandtheparameterlistwouldbestored.Inthis
paper,weenhanceouralgorithmwiththeuseofthefrequencyofthetemplates,byencodingthe
parametersandalsomakinguseofHuffmancoding.Withtheuseofthesemeasures,comparedtothe
(cid:1)(cid:2)(cid:3)(cid:1)(cid:4)(cid:5)(cid:6)(cid:7)(cid:8)(cid:1)
previous67.4%compressionrate,a94.98%compressionratecanbeachieved(wherecompressionrate
(cid:1)(cid:2)(cid:3)(cid:4)(cid:5)(cid:6)(cid:7)
is1minustheratioofthesizeofthecompressedfiletotheuncompressedsize).Therunningtimesof
Citation:Marjai,P.;Lehotay-Kéry,P.;
thedifferentmeasuresthatweusedtoenhanceouralgorithmarealsocompared.Wealsoanalyzethe
Kiss,A.ANovelDictionary-Based
differencebetweenthecompressionrateoftheenhancedalgorithmandgeneralcompressorssuch
MethodtoCompressLogFileswith
asLZMA,Bzip2,andPPMd.Weexaminewhetherthesizeofthelogfilescanbefurtherdecreased
DifferentMessageFrequency
withthecombineduseofourenhancedmethodandthegeneralcompressors.Wealsogeneratelog
Distributions.Appl.Sci.2022,12,
2044. https://doi.org/10.3390/ filesthatfollowdifferentdistributionstoexaminethecompressioncapabilityifthedistributiondoes
app12042044 notfollowthepowerlaw.Basedonourexperiments,wewouldrecommendtheuseoftheMoLFI
(Multi-objectiveLogmessageFormatIdentification)templateminermethodwithourenhanced
AcademicEditor:JohannEder
algorithmtogetherwithPPMd.
Received:20December2021
Accepted:11February2022 Keywords:logfileprocessing;templatemining;compression;LZMA;Bzip2;PPMd
Published:16February2022
Publisher’sNote:MDPIstaysneutral
withregardtojurisdictionalclaimsin
1. Introduction
publishedmapsandinstitutionalaffil-
iations. System logs have many applications due to the fact that they contain important
runtime information of software systems. This data is created by logging statements
insertedintothesourcecodebyprogrammers. Theaccumulatedruntimedatacanbeused
forvariouspurposes,suchasanomalydetection,businessmodelmining,orperformance
Copyright: © 2022 by the authors.
monitoring. Theauthorsof[1]proposeanew,dynamicmethodologyofanomalydetection
Licensee MDPI, Basel, Switzerland.
onlogfiles. Insteadoftreatingthelogfilesasstaticfiles, theyincrementallygrouplog
This article is an open access article
lineswithintimewindows. Afterthat,differentclusteranalysistechniquesareusedtofind
distributed under the terms and
mergesorsplitsbetweenthewindows. Then,aself-learningalgorithmisusedtodetect
conditionsoftheCreativeCommons
anomaliesbasedontheevolutionoftheclusters. In[2],amethodisproposedthatuses
Attribution(CCBY)license(https://
bothdatapagetaggingandlogfilestobuildbusinessmodels. Theyusenewtrendsinweb
creativecommons.org/licenses/by/
developmentlanguagestoanalyzecustomerbehavior. Theymainlyfocusonthediversity
4.0/).
Appl.Sci.2022,12,2044.https://doi.org/10.3390/app12042044 https://www.mdpi.com/journal/applsci
Appl.Sci.2022,12,2044 2of32
ofthetracesleftbyRichInternetApplications(webapplicationsusingdesktopapplication
characteristics). Theauthorsof[3]introduceanewtool,namelyDISTALYZER,thatuses
machinelearningtechniques. Itdeducesassociationsbetweendifferentcomponentsand
theirperformancewiththeuseofpreviouslyextractedsystembehaviors.
With the large-scale structure of modern software systems, the size of the log files
increasesrapidly. Largelogfilesrequirehighamountsofstoragespace,whichisusually
verycostly. Forexample,eventhenetworkingdevicesofasmallinternetserviceprovider
couldgenerateTBsofdatainoneday. In[4],theresearchlooksatadatacentercontaining
only1,000nodes,whichcouldgenerate86TBworthoflogdatainasingleday. Itisalso
importanttomentionthatlogfilesareusuallyreplicated,whichresultsinmoremassive
storageuse,ortheyhavetobestoredforyears.
Itcanbesaidthatthereductionofthesizeofthegenerateddataisimportant. One
optionistoobligedeveloperstoprintlessinformation;however,thiscanresultinlosses
of key information [5]. The other commonly used practice is compression of the data.
Severalcompressionalgorithmshavebeenproposedovertheyears,suchasgziporBzip2.
These arecapable ofreducingthe sizeby a factorof 10[6]. They workwell ongeneral
data[7], but, sincetheyencodeblocksofdata, theretrievalofasinglelogentrycanbe
costlyandtime-consuming. Furthermore,entry-levelcompressioncanbeusedforvarious
statisticalpurposes.
Logentriescorrespondtovariouseventtypes,suchasdifferenterrors,restarts,etc.
Templateminersareusedtoretrievethesemessagetypes. Thetemplatesconsistofconstant
parametersthatarethesameineachoccurrence,aswellasparametersthatmaydiffer. To
retrieveeventtypes,numeroustemplateminershavebeenproposed. Spell[8]treatslog
entrieslikesequencesandusesthelongestcommonsubsequenceapproachtoretrievethe
templates. Thepresumptionthatentriesthathavethesameeventtypehavewordswith
equallengthatthesamepositionsisusedbyLenMa[9]. Drain[10]builtafixed-depthtree,
whichconsistedoftherootnode,internalnodes,andleafnodes. Thefirstlayer(wherea
layeristhedepthofanode)ofinternalnodesrepresentedgroupswiththesamelength.
Thegroupsrepresentedbythesecondlayerhavethesameconstanttokenasthefirstword.
The third layer, which consisted of the leaf nodes, groups the messages by their token
similarity. Afteralogentryisassignedtoaleafnode,thetreeisupdated.
2. RelatedWork
Inrecentyears,variousalgorithmshavebeenproposedthattakedifferentaspectsof
logfilesintoaccount. Therearenumerousstudieswherelogentrieshavebeengroupedin
awayinwhichgeneralcompressorswillbemoreeffectiveonthem. Anentryisaplain
textmessage(ASCII)thatgivesinformationaboutthebehaviorofthesoftwareatagiven
time. In[11],themessageswithahighdegreeofsimilarityareplacedintothesamebucket.
Thesebucketsarethencompressedindividually. Upto30%improvementcanbereached
withtheiradaptiveapproach. Theauthorsof[12]proposeaMulti-levelLogCompression
(MLC)methodwhichissimilartothepreviouslymentionedalgorithm. Thedifferenceis
thatitremovestheduplicateentriesbeforegroupingthemessagesintobuckets. Afterthe
placement,themessagesareencodedwithavariationofthedeltacompressionthatresults
in simple IDs. Finally, these IDs are compressed with the use of a general compressor
method. TheyareabletoimprovethecompressionratioofBzip2by16.1%.
Otherpapersconsiderdatainawaythatitcanbetransformed. In[13],eachmessage
isconsideredtobeavectoroflengthn,wherenisthenumberoftokensthatmakeupthe
message. Eachentry(logline,message)isaddedtoamatrixthathasncolumns. These
matricesarethensorted,basedonthevalueofthefirstcolumn,andtransposed. Afterthis
step,similartokensareplacednexttoeachother. Adatastructureisthenmade,storing
allmatricesinadictionarybyhashingauniquefieldname. Then,thesearecompressed
byageneralcompressor. Thatstudyachieveda79%compressionrateimprovementand
reducedtheexecutiontimeby64%. Theauthorsof[14]proposeanalgorithmthatreorders
thedatafieldbyfield. Afterthat,thecorrelatingfieldsaremerged. Thissolutionreduces
Appl.Sci.2022,12,2044 3of32
Bziparchivesbyanaverageof52%. Acolumn-wisecompressionmethodthatiscapableof
handlingdatastreamsisintroducedin[6]. Eachlogentryissplittocreatevariouscolumns.
Then,asemi-dictionary-basedmodelisbuiltforeachcolumnthatisusedtocompressthe
data. Withtheuseofthismodel,thecompressionratiocanbeincreasedby27.7%.
Deltaencodingisacommonlyuseddatareductiontechniquethatusesthedifferences
betweenthechunksofafile. Variousresearchhasbeenproposedthatusesthismethodto
improvethecompressionratioorthespeed. Theauthorsof[15]proposeanewmethod,
namelyRun-LengthBase-Delta,analgorithmthatusessegmentationandparallelizationto
increasethecompressionanddecompressionspeedswhilenotaffectingthecompression
ratio. Thenetworkthroughputusedbysupercomputerscanberevampedby57%. In[16],
Gdeltaisproposed,whichisadeltaencodingapproachthatusesarray-basedindexing;
gear-basedrollinghashes,whichisarollinghashalgorithmusedtoscanwords;andbatch
compressing. Animprovementof10–120%wasreachedinthecompressionratioofthe
investigateddatasets.
Somepapersusetheideaoftokenreplacement. Theauthorsof[17]proposeamulti-
tieredalgorithmthattakesadvantageofthesimilarityofloglinesnexttoeachother. First,
thepositionofthefirstdifferentcharacterbetweentwologlinesisfound. Areferenceis
made(onthebytelevel)basedontheposition,andthecharacteriskept. Thisisrepeated
untiltheendofthelineisreached. Thismethodalsousesadictionarytostoreglobally
repetitive tokens. The authors were able to achieving 41% smaller files in the case of
Bzip2. Themethodproposedin[18]profitsfromthefactthatthebinaryrepresentationsof
numericalvaluessuchasIPaddressesortimestampsaresmallerinsizethantheirstring
representation. Theyalsouseadictionarytoreplaceconstanttokenswithshorterforms.
Withtheuseofthisalgorithm,a32%improvementofthecompressionratiowasachieved.
Hiddenstructures,suchastemplates,canbefoundineverylogfile.Theauthorsof[19]
proposeamethodthatemploysiterativeclusteringontherawlogentries. Thisresults
in coherent in-between representations that are used to compress the data. Compared
togzip,thecompresseddatatakesup40%lessspace. In[20]CLC(ComprehensiveLog
Compression) is introduced. Short representations are assigned to frequent patterns to
reducethesize. Thismethodcouldreachcoverageofupto95.8%andfoundthetemplates.
Inthispaper,weenhanceourmethodproducedin[21]. EventhoughLenMareached
thehighestcompressionratewith67.4%inourpreviousresearch,duetoitshighexecution
time,whichis8.5timesmoreinthecaseofthe“Big”dataset,weencouragedtheuseof
IPLoMorMoLFI,bothofwhichareconsiderablyfasterandhaveanaveragecompression
rate of 57.8% and 60.8%. To further improve our algorithm, we initially examine the
frequencyofthetemplates;smallerIDs(withtheleastpossiblecharacters)areassignedto
frequenttemplates. Previously,onlyonedictionarywascreatedforthetemplates,while,
inthispaper,thereisalsoonecreatedforthevariabletokens. Similartotemplates,each
variablegetsassignedtoanIDandonlytheIDisstored. Thisresultsinlogentriesthat
only contain IDs (numbers) separated by spaces. In the end, these entries are encoded
viaHuffmancoding. AmoredetaileddescriptionisintroducedinSection4. Thebasic
methodappliestemplateminerssuchasIPLoMandMoLFItodeterminetheeventtypes
thatoccurinthelogfile. AdictionaryisthencreatedwhereanewuniqueIDgetsassigned
toeachofthetemplates. Wethenencodedeachlogentrywiththeuseofthisdictionary,
soeachlinewouldconsistofanIDandtheparametersofthatindividualline. Tofurther
increasethecompressionrate,wetakethefrequencyofthetemplatesintoaccount,encode
theparameters,andapplyHuffmancoding. Amoredetailedexplanationcanbefoundin
Section4.
Thispaperusesthefollowingstructure.Section3introducestheconceptoflogparsing.
Abriefsummaryoftheusedtemplateminers,IPLoM,andMoLFIcanalsobefoundhere.
Thatsectionalsocontainsahigh-leveloverviewoftheusedgeneralcompressingmethods:
LZMA,Bzip2,andPPMd. PredictionbyPartialMatching(PPM)isanadaptivestatistical
datacompressiontechniquethathasseveralimplementations,denotedbytheletters(a,
b,c,d,e,f),whichmainlyindicatetheamountofmemoryusage; inourcaseversiond
Appl.Sci.2022,12,2044 4of32
wasused. Adetaileddescriptionoftheenhancedalgorithmandstatisticalanalysisofthe
examineddatacanbefoundinSection4. Anexplanationoftheconcludedexperiments,
thatassessesthecompressionrateandthetimetakenbytheenhancedmethodandthe
generalcompressorsonlogfilesthatweregeneratedbyreal-worldnetworkingequipment,
ispresentedinSection5. Theconclusionofthepaperandthepossiblefutureworksare
listedinSection6.
3. ConceptsandProblems
3.1. LogParsing
To gain insight into the operation of computer software, programmers carry out a
specificprogrammingpractice,namelylogging. Withtheuseofcommandsthatprintout
specificattributesofthegivensoftwareataspecifictime,developerscreatelogfiles. The
outputofaprintcommandisusuallyrepresentedbyasinglelineinthelogfile,which
couldbealsocalledalogentry. Theseentriesarefrequentlyraw,whichmeanstheyare
notstructured,sincethereisnorestrictionaboutwhatadevelopercanwrite. Atypicallog
lineisthecombinationofmultiplepiecesofinformation,suchastheSequenceNumber,
whichidentifiesthemessage;theTimestamp,whichshowswhentheeventtookplace;the
Moduleonwhichtheeventtookeffect;andthefree-textMessage. Figure1isasnippet
fromourworkingdata.
Figure1.Excerptoflogfilegeneratedbyreal-worldnetworkingdevice.
Themessageconsistsofwordsortokens,whichareseparatedbyspaces. Thetokens
caneitherbelongtotheconstantpartortotheparameterpartofthemessage. Theconstant
tokensareidenticalateveryoccurrenceofthegiveneventtype,whileparametertokens
canbedifferent. Forexample,inthesecondlineoftheexampleshowninFigure1“NPU”
and“Software”areconstants,while“CXP9029630_4”and“R9D3925”areparameters.
Withlogparsing,weallocateeachlogentry,e,toitscorrespondingeventtype. For-
mally, a structured log parser assigns each entry in the list, e ,e ,...,e , of log lines
1 2 N
representing the log to a single event type M, where M are unique message types that
werecreatedby Pdistinctprocesses[8]. Whilelogparsersarepowerfulinstrumentsin
logprocessing,theycannotbeusedinallcases. Theparserdoesnothave,inadvance,the
informationaboutentrytypesandprocessesthatgeneratetheentries,andithastodeduce
allthisinformationusingclassifierscalled‘templateminers’. Pre-andpost-processingof
thedata,suchasdeletingduplicatesorusingregex,arealsoindispensable. Forexample,
regexcanbeusedtoremovenotunnecessaryfieldslikesequencenumbers[22].
3.2. IPLoM
IPLoM(IterativePartitioningLogMining)isatechniquethatclusterslogentriesin
ordertoacquireeventtypes[23]. Ititerativelypartitionsthemessages. Themethodconsists
ofthreestepsthatarebasedondifferentheuristics,aswellasafourthstepthatreturnsthe
differenteventtypes.
Logentriesthatbelongtothesamemessagetypeareusuallyequivalentintheirsize
(numberofwords).Basedonthisassumption,inthefirststep,thealgorithmcreatesdistinct
groupsofmessages,eachwithadifferentsize. Atthisstage,themessagesofagroupcan
beinterpretedasn-tuples,wherenisthesizeoftheentry.
Appl.Sci.2022,12,2044 5of32
Thealgorithmusesthelocationoftokens(wordsbetweentwospaces)inthesecond
steptofurtherpartitionthemessages. Itusestheheuristicthatthetokenpositionwiththe
leastnumberofuniquewordsprobablyconsistsoftokensthatareconstantatthatposition.
Themessagesareonceagaingroupedbytherecentlydiscovereduniquewords. Attheend
ofthisstep,eachgroupwillonlyinvolvemessagesthathavethesameuniquevalueatthe
chosenlocation.
The final clustering step is performed with the use of bijective relationships. The
numberofuniquewordsateachpositionisusedtodeterminethetokencountthatappears
mostoften. Thisvalueexpressesthenumberofeventtypesinthatgroup. Thisindicates
theexistenceofabijectiverelationshipbetweenthewordsthatarelocatedintheposition
withthemostuniquewords. Thisheuristicisusedtofurtherpartitionthedata: thefirst
twotokenpositionsthathaveanequalnumberofuniquetokensasthemostfrequenttoken
countareusedtoassignmessagesintodifferentgroups.
Atthispoint,itcanbeassumedthateachgroupcontainsmessagescorrespondingto
aneventtype. Asafinalstep,thedistinctionbetweenconstantwordsandparametershas
tobeperformed. If,foreachentryinsideagroup,thereisonlyonetokenataposition,then
itisconsideredtobeaconstant,otherwise,thetokenisaparameterthatisthenrepresented
withawildcard.
3.3. MoLFI