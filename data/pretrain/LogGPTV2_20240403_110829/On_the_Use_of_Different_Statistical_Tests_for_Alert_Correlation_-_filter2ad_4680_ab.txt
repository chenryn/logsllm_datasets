Lag [seconds]
(2-a)
Lag [seconds]
(2-b)
Fig. 2. p-value (-a) and GCI (-b) vs. p with w = w1 = 60s (1-) and w = w2 = 1800s
(2-) “N etP (k) (cid:2) HostP (k)” (dashed line), “HostP (k) (cid:2) N etP (k)” (solid line)
In the following, we use this shorthand notation: N et is the substream of
all the alerts generated by the NIDS. HostP is the substream of all the alerts
generated by the HIDS installed on pascal.eyrie.af.mil, while N etP regards
all the alerts (with pascal as a target) generated by the NIDS; ﬁnally, N etO =
N et\N etP indicates all the alerts (with all but pascal as a target) generated
by the NIDS.
4 The Granger Causality Test
In [14] Qin and Lee propose an interesting algorithm for alert correlation which
seems suitable also for anomaly-based alerts. Alerts with the same feature set
are grouped into collections of time-sorted items belonging to the same “type”
(following the concept of type of [19]). Subsequently, frequency time series are
built, using a ﬁxed size sliding-window: the result is a time-series for each collec-
tion of alerts. The prototype then exploits the GCT [16], a statistical hypothesis
test capable of discovering causality relationships between two time series when
they are originated by linear, stationary processes. The GCT gives a stochastic
measure, called Granger Causality Index (GCI), of how much of the history of
one time series (the supposed cause) is needed to “explain” the evolution of the
other one (the supposed consequence, or target). The GCT is based on the es-
timation of two models: the ﬁrst is an Auto Regressive model (AR), in which
future samples of the target are modeled as inﬂuenced only by past samples of
the target itself; the second is an Auto Regressive Moving Average eXogenous
(ARMAX) model, which also takes into account the supposed cause time series
as an exogenous component. A statistical F-test built upon the model estima-
tion errors selects the best-ﬁtting model: if the ARMAX ﬁts better, the cause
eﬀectively inﬂuences the target.
In [14] the unsupervised identiﬁcation of “causally related” events is performed
by repeating the above procedure for each couple of time-series. The advantage of
the approach is that it does not require prior knowledge (even if it may use attack
probability values, if available, for an optional prioritization phase). However,
in a previous work [9] we showed that the GCT fails however in recognizing
“meaningful” relationships between IDEVAL attacks.
On the Use of Diﬀerent Statistical Tests for Alert Correlation
171
0
1
6
2
p
l
a
m
i
t
p
O
0
2
4
6
8
10
12
14
Data range (10^3)
Fig. 3. The optimal time lag ˆp given by the AIC criterion strongly varies over time
We tested the sensitivity of the GCT to the choice of two parameters: the
sampling time, w, and the time lag p (that is, the order of the AR). In our simple
experiment, the expected result is that N etP (cid:2) HostP , and that HostP (cid:2)(cid:2)
N etP (the (cid:2) indicates “causality” while (cid:2)(cid:2) is its negation). In [14] the sampling
time was arbitrarily set to w = 60s, while the choice of p is not documented.
However, our experiments show that the choice of these parameters can strongly
inﬂuence the results of the test. In Fig. 2 (1-a/b) we plotted the p-value and
the GCI of the test for diﬀerent values of p (w = 60s). In particular, the dashed
line corresponds to the test N etP (k) (cid:2) HostP (k), and the solid line to the test
HostP (k) (cid:2) N etP (k). We recall that if the p-value is lower than the signiﬁcance
level, the null hypothesis is refused. Notice how diﬀerent choices of p can lead to
inconclusive or even opposite results. For instance, with α = 0.20 and with 2 ≤
p ≤ 3, the result is that N etP (k) (cid:2) HostP (k) and that HostP (k) (cid:2)(cid:2) N etP (k).
As we detailed in [9] (Fig. 2 (2-a/b)), other values of p lead to awkward result
that both HostP (k) (cid:2) N etP (k) and N etP (k) (cid:2) HostP (k).
A possible explanation is that the GCT is signiﬁcant only if both the linear
regression models are optimal, in order to calculate the correct residuals. If we
use the Akaike Information Criterion (AIC) [1] to estimate the optimal time lag
ˆp over diﬀerent windows of data, we ﬁnd out that ˆp wildly varies over time, as it
is shown in Fig. 3. The fact that there is no stable optimal choice of p, combined
with the fact that the test result signiﬁcantly depends on it, makes us doubt
that the Granger causality test is a viable option for general alert correlation.
The choice of w seems equally important and even more diﬃcult to perform,
except by guessing.
Of course, our testing is not conclusive: the IDEVAL alert sets may simply
not be adequate for showing causal relationships. Another, albeit more unlikely,
explanation, is that the Granger causality test may not be suitable for anomaly
detection alerts: in fact, in [14] it has been tested on misuse detection alerts.
But in fact there are also theoretical reasons to doubt that the application of
the Granger test can lead to stable, good results. First, the test is asymptotic
w.r.t. p meaning that the results reliability decreases as p increases because of
the loss of degrees of freedom. Second, it is based on the strong assumption of
linearity in the auto-regressive model ﬁtting step, which strongly depends on
the observed phenomenon. In the same way, the stationarity assumption of the
model does not always hold.
172
F. Maggi and S. Zanero
5 Modeling Alerts as Stochastic Processes
Instead of interpreting alert streams as time series (as proposed by the GCT-
based approach), we propose to change point of view by using a stochastic model
in which alerts are modeled as (random) events in time. This proposal can be seen
as a formalized extension of the approach introduced in [17], which correlates
alerts if they are ﬁred by diﬀerent IDS within a “negligible” time frame, where
“negligible” is deﬁned with a crisp, ﬁxed threshold.
For simplicity, once again we describe our technique in the simple case of a
single HIDS and a single NIDS which monitors the whole network. The concepts,
however, can be easily generalized to take into account more than two alert
streams, by evaluating them couple by couple. For each alert, we have three
essential information: a timestamp, a “target” host (ﬁxed, in the case of the
HIDS, to the host itself), and the generating sensor (in our case, a binary value).
We reuse the scenario and data we already presented in Section 4 above.
With a self-explaining notation, we also deﬁne the following random variables:
TN etP are the arrival times of network alerts in N etP (TN etO, THostP are simi-
larly deﬁned); εN etP (εN etO) are the delays (caused by transmission, processing
and diﬀerent granularity in detection) between a speciﬁc network-based alert
regarding pascal (not pascal) and the corresponding host-based one. The ac-
tual values of each T(·) is nothing but the set of timestamps extracted from the
corresponding alert stream. We reasonably assume that εN etP and TN etP are
stochastically independent (the same is assumed for εN etO and TN etO).
In an ideal correlation framework with two equally perfect IDS with a 100%
DR and 0% FPR, if two alert streams are correlated (i.e., they represent inde-
pendent detections of the same attack occurrences by diﬀerent IDSes [17]), they
also are “close” in time. N etP and HostP should evidently be an example of
such a couple of streams. Obviously, in the real world, some alerts will be missing
(because of false negatives, or simply because some of the attacks are detectable
only by a speciﬁc type of detector), and the distances between related alerts will
therefore have some higher variability. In order to account for this, we can “cut
oﬀ” alerts that are too far away from a corresponding alert in the other time
series, presuming them to be singletons. In our case, knowing that single attacks
did not last more than 400s in the original dataset, we tentatively set a cutoﬀ
threshold at this point.
Under the given working assumptions and the proposed stochastic model, we
can formalize the correlation problem as a set of two statistical hypothesis tests:
H0 : THostP (cid:2)= TN etP + εN etP vs. H1 : THostP = TN etP + εN etP
H0 : THostP (cid:2)= TN etO + εN etO vs. H1 : THostP = TN etO + εN etO
(1)
(2)
Let {ti,k} be the observed timestamps of Ti ∀i ∈ {HostP, N etP, N etO}, the
meaning of the ﬁrst test is straightforward: within a random amount of time,
εN etP , the occurring of a host alert, tHostP,k, is preceded by a network alert,
tN etP,k. If this does not happen for a statistically signiﬁcant amount of events,
the test result is that alert stream TN etP is uncorrelated to THostP ; in this case,
On the Use of Diﬀerent Statistical Tests for Alert Correlation
173
HostP  NetP
HostP  NetO
y
t
i
s
n
e
D
5
0
0
0
.
4
0
0
0
.
3
0
0
0
.
2
0
0
0
.
1
0
0
0
.
0
0
0
0
.
0
5
3
0
0
3
0
5
2
0
0
2
0
5
1
0
0
1
0
5
t
P
e
N
_
e
y
t
i
s
n
e
D
5
0
0
0
.
4
0
0
0
.
3
0
0
0
.
2
0
0
0
.
1
0
0
0
.
0
0
0
0
.
O
t
e
N
_
e
0
0
3
0
0
2
0