## 前言
在过去的一年中，几位研究人员在Cisco
Webex程序套件中提交了漏洞报告。然而，在他们提交的40多个报告中，他们忽视了某些琐碎的东西，包括一些基于堆栈的缓存溢出。这篇文章(
)详细地介绍了ZDI-18-1078，这是Cisco
Webex网络录制播放器31.23.2.58(现已达到EOL)版本中的一个漏洞，它会使得远程代码被执行。
## 漏洞
读取`Advanced
Recording（.arf）`文件时，播放器会尝试访问当前目录中的`RtpConfig.ini`文件，这个操作还没有被记录下来。这个`.ini`文件包含一种配置，该配置可能是一种实时传输协议(RTP)服务，但由于没有任何文件记录过，因此可能会跟实时传输协议服务有所不同。
上图展示了`nbrplay.exe`正在查找`RtpConfig.ini`的过程
这个错误发生在`nmvc.dll`中，它存在于名为`sub_1001F479`的程序中，这个程序可以用来解析`RtpConfig.ini`，并且提取它的属性。以下代码段展示了如何设置`MinLostRate`以及其他的一些参数。
这里的罪魁祸首是对sscanf函数的调用，这是一个被微软禁用的函数。该sscanf函数解析`.ini`文件并读取属性值，以便将它们与一组硬编码参数进行匹配。使用的格式是：
    %[^ \t#]%*[ \t]%[^ \t#]%n
这个格式可以写入三个参数。第一个和第三个说明符(`%[^
\t#]`)在`%`和`[`之间不使用任何值,这意味着在它到空格之前，它将读取每个字符。忽略它们的大小的话，这将可以写入`Str1`和`Source`参数，如果输入足够大，可能会导致溢出。
这个`.ini`文件在`0x3FF`字节块中被读取，并且因为这两个连续变量Source和Str1的空间分别为`0x100`和`0x106`字节，因此可发生溢出从而导致堆栈被损坏。
## 更多
思科公司通过咨询`cisco-sa-20180919-webex`修补了这几个漏洞。让人高兴的是，随着越来越多相类似的错误被提交，这些版本即将达到他们的EOL，这些新版本有希望会变得更加安全。在这些企业软件中，越来越多的漏洞被提交，这种类型的漏洞提交的数量仅仅落后于桌面应用软件和SCADA提交的数量。考虑到在很多企业中这些程序存在的数量，这种趋势很有可能会持续下去。
你可以在Twitter@ziadrb上找到我，并跟随我的团队寻找最新的漏洞利用技术和安全补丁。
## 用Hackvertor绕过WAFS和破解XOR
我最近一直在致力于研究如何扩展Hackvertor，因为它具有基于标签的转换功能，这比Burp中的内置解码器要厉害得多。在这样一个功能的背后，我的想法是，标签可以转化其内容，并且将这个转化传递给下一个外部标记，这样您就可以轻松地执行多级编码。
例如，要将一个字符串编码为base64，只需使用base64进行标记：
    test
您也可以进行多级编码，例如假设您想将字符串转换为十六进制，然后对其进行base64编码，您首先要使用十六进制标记，然后使用base64标记：
    test
这个十六进制标记有一个分隔符参数，用于分隔每个十六进制字符串，即'test'，它将作为分隔符连同空格一起传递给标记函数。
## 使用Hackvertor
当扩展部分在加载时，它将在Burp中创建一个名为Hackvertor的新Tab。在选项卡中有一个输入框和一个输出框，您在输入框中输入要转换的文本，将它选中，然后单击，Hackvertor将会自动进行转换，最终转换的结果将会出现在输出框中，为了方便您再次运行转换，还有一个转换按钮。这些标签都会被分门别类地标好，如编码、解码等，让您可以轻松找到您需要的标签。Hackvertor还具有中转模块样式的选项卡，允许您运行这个工具的多种版本。
## 绕过Cloudflare WAF
最近在诸如repeater等工具中，我制作了Hackvertor标签，您只需右键单击repeat请求，并点击Hackvertor菜单然后在请求中添加标签，它将会在发送请求之前自动运行转换。您也可以在Intruder中使用它们，这就要求您首先要在repeater模块中定义它们，然后将它们发送到Intruder，这个功能非常强大，因为您可以使用带有占位符的多级编码。您甚至可以在代理服务器中使用它们，但默认情况下它们是关闭的。如果想要打开它，可以在主Burp菜单中选择Hackvertor菜单，然后单击“允许代理”标签。
现在，我将向您展示如何在repeater模块中使用标签从而绕过Cloudflare WAF。首先要将以下网址发送给repeater：