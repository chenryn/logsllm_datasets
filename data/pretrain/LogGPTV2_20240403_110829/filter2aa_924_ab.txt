©PentesterAcademy.com 
PentesterAcademy.co
m/
现状 
• 
⽆无法通过监听流量量恢复ECDHE/DHE派⽣生的密钥 
1
• 
对于RSA，获取到服务器器私钥即可解密流量量 
11
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
TLS流量量(SIP1over1TLS)1
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
Diffie1Hellman密钥交换 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
未解码的SRTP流量量 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
解码 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
解码为RTP1
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
检查RTP流 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
分析RTP流 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
播放RTP流 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
TLS1流量量(SIP1over1TLS)1
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
基于RSA的密钥交换 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
解密TLS流量量 
• 
使⽤用RSA交换密钥 
• 
可解密安装在Asterisk1One上的密钥 
1
• 
Asterisk/One密钥和证书的位置:1/etc/asterisk/keys1
1
• 
必须从服务器器得到default.key1
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
编辑1>1偏好1>1协议1>1SSL1
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
添加Asterisk默认私钥 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
解密SIP流量量 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
SIP/SDP解密包中的SRTP密钥 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
解密SRTP的开源⼯工具 
• 
SRTP1Decrypt1
1
• 
Libsrtp1
1
1
1
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
SRTP解密 
• 
解密SRTP数据包的⼯工具 
1
• 
利利⽤用对称密钥解密SRTP流量量 
• 
以⼗十六进制⽅方式(hexdump)输出解密包 
1
• 
Wireshark可从⼗十六进制⽂文件中复原RTP数据包 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
SRTP解密 
• 
GitHub:1github.com/gteissier/srtp-decrypt111
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
SRTP解密: 安装前的准备 
• 
Installing1libgcrypt1
1
1
1
1
1
• 
Installing1libpcap1
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
SRTP解密: 安装 
• 
Cloning1
1
1
1
1
• 
Compiling1
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
SRTP解密: 准备完成 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
SRTP解密: 复制SRTP密钥 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
SRTP解密: UDP端⼝口 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
SRTP解密: 解密SRTP流量量 
指令:1./srtp-decrypt1-k1uK+RfjSi9/fUFr8zoJu6zdqPw6MGtONhgX4yqwRj11decoded.raw11
1
• 
-k111111:11111Defined1SRTP1key11(该例例为uK+RfjSi9/fUFr8zoJu6zdqPw6MGtONhgX4yqwRj)1
• 
Normal_Call_two_parties.pcap11
1输⼊入⽂文件1
• 
decoded.raw1
1
1
1输出⽂文件1
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
SRTP解密: decoded.raw1
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
SRTP解密: 导⼊入解密内容 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
SRTP解密: 导⼊入解密内容 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
SRTP解密: 导⼊入解密的UDP数据包 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
SRTP解密: 解码 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
SRTP解密: 解码为RTP1
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
SRTP解密: 解码后的数据包 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
SRTP解密: 检查RTP流 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
SRTP解密: 分析RTP流 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
SRTP解密: 播放解密后的通话 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
Libsrtp1
• 
安全实时传输协议(SRTP)的具体实现 
1
• 
可解密SRTP数据包 
1
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
Libsrtp1
• 
GitHub:1github.com/cisco/libsrtp1111
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
Libsrtp: 安装 
• 
Cloning1
1
1
1
1
1
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
Libsrtp: 安装 
• 
Configure1
1
1
1
1
1
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
Libsrtp: 安装 
• 
Make1
1
1
1
1
1
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
Libsrtp: 准备完成 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
Libsrtp:1SRTP密钥 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
Libsrtp:1复制SRTP密钥 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
Libsrtp:1过滤单⼀一发送者 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
Libsrtp:1过滤单⼀一RTP流 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
Libsrtp:1导出过滤的流量量 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
Libsrtp:1保存导出流量量 
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
Libsrtp:1指令 
• 
./rtp_decoder1-a1-t1101-e11281-b12stvabBcXXf3HtaHCSsB8WACeRBst9f7lwLqlzqE1*1<1./
Normal_Call_two_parties_Exported_RTP.pcap1
1
• 
-a 1111111111使⽤用消息验证1
• 
-t11111111111111认证标签⼤大⼩小(80位，即10字节)1
• 
-e1111111111111加密密钥的⻓长度，该例例使⽤用AES_CM_128_HMAC_SHA1_801
1111111111密钥⻓长度是128位1
• 
-b1111111111111ASCII格式的SRTP密钥1
PentesterAcademy.co
m/
©PentesterAcademy.com 
PentesterAcademy.co
m/
Libsrtp:1指令输出 
PentesterAcademy.co
m/