3| 3
4| 4
南大通用数据技术股份有限公司
1173
GBase 8s V8.8开发者手册
(4rows)
--删除物化视图。
gbase=#DROPMATERIALIZEDVIEWmv;
DROPMATERIALIZEDVIEW
24.2.3 支持和约束
24.2.3.1 支持场景
 单表查询语句。
 多个单表查询的UNIONALL。
 物化视图上支持创建索引。
 物化视图支持Analyze操作。
24.2.3.2 不支持场景
 物化视图中不支持多表Join连接计划以及subquery计划。
 除少部分ALTER操作外，不支持对物化视图中基表执行绝大多数DDL操作。
 物化视图不支持增删改操作，只支持查询语句。
 不支持用临时表/hashbucket/unlog/分区表创建物化视图。
 不支持物化视图嵌套创建（即物化视图上创建物化视图）。
 仅支持行存表，不支持列存表。
 不支持UNLOGGED类型的物化视图，不支持WITH语法。
24.2.3.3 约束
 物化视图定义如果为UNIONALL，则其中每个子查询需使用不同的基表。
 增量物化视图的创建、全量刷新、删除过程中会给基表加高级别锁，若物化视图的定义
南大通用数据技术股份有限公司
1174
GBase 8s V8.8开发者手册
为UNIONALL，需要注意业务逻辑，避免死锁产生。
25 GUC 参数说明
25.1GUC 使用说明
数据库提供了许多运行参数，配置这些参数可以影响数据库系统的行为。在修改这些参
数时请确保用户理解了这些参数对数据库的影响，否则可能会导致无法预料的结果。
注意事项
参数中如果取值范围为字符串，此字符串应遵循操作系统的路径和文件名命名规则。
取值范围最大值为INT_MAX的参数，此选项最大值跟所在的操作系统有关。
取值范围最大值为DBL_MAX的参数，此选项最大值跟所在的操作系统有关。
25.2文件位置
数据库安装后会自动生成三个配置文件（postgresql.conf、pg_hba.conf和pg_ident.conf），
并统一存放在数据目录（data）下。用户可以使用本节介绍的方法修改配置文件的名称和存
放路径。
修改任意一个配置文件的存放目录时，postgresql.conf里的data_directory参数必须设置
为实际数据目录（data）。
须知：
考虑到配置文件修改一旦出错对数据库的影响很大，不建议安装后再修改本节的配置文
件。
25.2.1 data_directory
参数说明：设置GBase8s的数据目录（data目录）。此参数可以通过如下方式指定。
 在安装GBase8s时指定。
南大通用数据技术股份有限公司
1175
GBase 8s V8.8开发者手册
 该参数属于POSTMASTER类型参数，请参考表15-15-1中对应设置方法进行设置。
取值范围：字符串，长度大于0
默认值：安装时指定，如果在安装时不指定，则默认不初始化数据库。
25.2.2 config_file
参数说明：设置主服务器配置文件名称（postgresql.conf）。
该参数属于POSTMASTER类型参数，请参考表15-15-1中对应设置方法进行设置，不
支持使用表 GUC参数设置方式中的方式四进行修改。
取值范围：字符串，长度大于0
默认值：postgresql.conf（实际安装可能带有绝对目录）
25.2.3 hba_file
参数说明：设置基于主机认证（HBA）的配置文件（pg_hba.conf）。此参数只能在配
置文件postgresql.conf中指定。
该参数属于POSTMASTER类型参数，请参考表15-15-1中对应设置方法进行设置。
取值范围：字符串
默认值：pg_hba.conf（实际安装可能带有绝对目录）
25.2.4 ident_file
参数说明：设置用于客户端认证的配置文件的名称（pg_ident.conf）。
该参数属于POSTMASTER类型参数，请参考表15-15-1中对应设置方法进行设置。
取值范围：字符串
默认值：pg_ident.conf（实际安装可能带有绝对目录）
25.2.5 external_pid_file
参数说明：声明可被服务器管理程序使用的额外PID文件。
该参数属于POSTMASTER类型参数，请参考表15-15-1中对应设置方法进行设置。
南大通用数据技术股份有限公司
1176
GBase 8s V8.8开发者手册
须知：
这个参数只能在数据库服务重新启动后生效。
取值范围：字符串
默认值：空
25.3连接和认证
25.3.1 连接设置
介绍设置客户端和服务器连接方式相关的参数。
25.3.1.1 listen_addresses
参数说明：声明服务器侦听客户端的TCP/IP地址。
该参数指定GBase8s服务器使用哪些IP地址进行侦听，如IPV4或IPV6（若支持）。
服务器主机上可能存在多个网卡，每个网卡可以绑定多个IP地址，该参数就是控制GBase8s
到底绑定在哪个或者哪几个IP地址上。而客户端则可以通过该参数中指定的IP地址来连接
GBase8s或者给GBase8s发送请求。
该参数属于POSTMASTER类型参数，请参考表15-15-1中对应设置方法进行设置。
取值范围：
 主机名或IP地址，多个值之间用英文逗号分隔。
 星号“*”或“0.0.0.0”表示侦听所有IP地址。配置侦听所有IP地址存在安全风险，不推荐
用户使用。必须与有效地址结合使用（比如本地IP等），否则，可能造成Build失败
的问题。同时，主备环境下配置为“\*”或“0.0.0.0”时，主节点数据库路径下postgresql.conf
文件中的localport端口号不能为数据库dataPortBase+1，否则会导致数据库无法启动。
 置空则服务器不会侦听任何IP地址，这种情况下，只有Unix域套接字可以用于连接数
据库。
默认值：数据库实例安装好后，根据XML配置文件中不同实例的IP地址配置不同默
南大通用数据技术股份有限公司
1177
GBase 8s V8.8开发者手册
认值。DN的默认参数值为：listen_addresses='x.x.x.x'。
25.3.1.2 local_bind_address
参数说明：声明当前节点连接GBase8s其他节点绑定的本地IP地址。
该参数属于POSTMASTER类型参数，请参考表15-15-1中对应设置方法进行设置。
默认值：数据库实例安装好后，根据XML配置文件中不同实例的IP地址配置不同默
认值。DN的默认参数值为：local_bind_address='x.x.x.x'。
25.3.1.3 port
参数说明：GBase8s服务侦听的TCP端口号。
该参数属于POSTMASTER类型参数，请参考表15-15-1中对应设置方法进行设置。
说明： 该参数由安装时的配置文件指定，请勿轻易修改，否则修改后会影响数据
库正常通信。
取值范围：整型，1～65535
说明：
设置端口号时，请设置一个未被占用的端口号。设置多个实例的端口号，不可冲突。
1~1023为操作系统保留端口号，请不要使用。
通过配置文件安装数据库实例时，配置文件中的端口号需要注意通信矩阵预留端口。如：
DN还需保留dataPortBase+1作为内部工具使用端口，保留dataPortBase+6作为流引擎消息
队列通信端口等。故数据库实例安装阶段，port最大值为：DN可设置65529，同时需要保
证端口号不冲突。
默认值：5432（实际值由安装时的配置文件指定）
25.3.1.4 max_connections
参数说明：允许和数据库连接的最大并发连接数。此参数会影响GBase8s的并发能力。
南大通用数据技术股份有限公司
1178
GBase 8s V8.8开发者手册
该参数属于POSTMASTER类型参数，请参考表15-15-1中对应设置方法进行设置。
取值范围：整型。最小值为10（要大于max_wal_senders），理论最大值为262143，实
际最大值为动态值，计算公式为“262143- job_queue_processes-autovacuum_max_workers -
AUXILIARY_BACKENDS - AV_LAUNCHER_PROCS - max_inner_tool_connections” 。
job_queue_processes、autovacuum_max_workers和max_inner_tool_connections的值取决于对
应 GUC 参数的设置。AUXILIARY_BACKENDS 为预留辅助线程数，固定为 20。
AV_LAUNCHER_PROCS为预留autovacuum的lancher线程数，固定为2。
默认值：
 200：编译安装数据库或极简安装数据库的情况下。
 5000：使用om安装数据库的情况下。
设置建议：
数据库主节点中此参数建议保持默认值。
配置不当时影响：
 若配置max_connections过大，超过计算公式所描述的最大动态值，会出现节点拉起失
败问题，报错提示“invalidvalueforparameter“max_connections””。
 若未按照对外出口规格配置仅调大max_connections参数值，未同比例调整内存参数。
业务压力大时，容易出现内存不足，报错提示“memoryistemporarilyunavailable”。
说明：
 对于管理员用户的连接数限制会略超过max_connections设置，目的是为了让管理员在
链 接 被 普 通 用 户 占 满 后 仍 可 以 连 接 上 数 据 库 ， 再 超 过 一 定 范 围
（sysadmin_reserved_connections参数）后才会报错。即管理员用户的最大连接数等于
max_connections+sysadmin_reserved_connections。
 对于普通用户来说，由于内部作业也会使用一些链接，因此会略小于max_connections，
具体值取决于内部链接个数。
南大通用数据技术股份有限公司
1179
GBase 8s V8.8开发者手册
25.3.1.5 max_inner_tool_connections
参数说明：允许和数据库连接的工具的最大并发连接数。此参数会影响GBase8s的工
具连接并发能力。
该参数属于POSTMASTER类型参数，请参考表15-15-1中对应设置方法进行设置。
取值范围：整型，最小值为1，最大值为MIN(262143,max_connections)，max_connections
的计算方法见上文。
默认值：数据库节点为50。如果该默认值超过内核支持的最大值（在执行gs_initdb的
时候判断），系统会提示错误。
设置建议：
数据库主节点中此参数建议保持默认值。
增大此参数可能导致GBase8s要求更多的SystemV共享内存或者信号量，可能超过操
作系统缺省配置的最大值。这种情况下，请酌情对数值加以调整。
25.3.1.6 sysadmin_reserved_connections
参数说明：为管理员用户预留的最少连接数，不建议设置过大。该参数和
max_connections 参数配合使用，管理员用户的最大连接数等于 max_connections +
sysadmin_reserved_connections。
该参数属于POSTMASTER类型参数，请参考表15-15-1中对应设置方法进行设置。
取值范围：整型，最小值为0，最大值为MIN(262143,max_connections)，max_connections
的计算方法见上文。
默认值：3
25.3.1.7 unix_socket_directory
参数说明：设置GBase8s服务器侦听客户端连接的Unix域套接字目录。
该参数属于POSTMASTER类型参数，请参考表15-1中对应设置方法进行设置。
该参数的长度限制于操作系统的长度，超过该限制将会导致 Unix-domain socket path
南大通用数据技术股份有限公司
1180
GBase 8s V8.8开发者手册
“xxx”istoolong的问题。
取值范围：字符串
默认值：空字符串（实际值由安装时配置文件指定）
25.3.1.8 unix_socket_group
参数说明：设置Unix域套接字的所属组（套接字的所属用户总是启动服务器的用户）。
可以与选项unix_socket_permissions一起用于对套接字进行访问控制。
该参数属于POSTMASTER类型参数，请参考表15-1中对应设置方法进行设置。
取值范围：字符串，其中空字符串表示当前用户的缺省组。
默认值：空字符串
25.3.1.9 unix_socket_permissions
参数说明：设置Unix域套接字的访问权限。
Unix 域套接字使用普通的 Unix 文件系统权限集。这个参数的值应该是数值的格式
（chmod和umask命令可接受的格式）。如果使用自定义的八进制格式，数字必须以0开
头。
建议设置为0770（只有当前连接数据库的用户和同组的人可以访问）或者0700（只有
当前连接数据库的用户自己可以访问，同组或者其他人都没有权限）。
该参数属于POSTMASTER类型参数，请参考表15-1中对应设置方法进行设置。
取值范围：0000-0777
默认值：0777
说明： 在Linux中，文档具有十个属性，其中第一个属性为文档类型，后面九个
为权限属性，分别为Owner、Group及Others这三个组别的read、write、execute属性。
文档的权限属性分别简写为r、w、x，这九个属性三个为一组，也可以使用数字来表示
文档的权限，对照表如下：
南大通用数据技术股份有限公司
1181
GBase 8s V8.8开发者手册
r：4
w：2
x：1
-：0
同一组（owner/group/others）的三个属性是累加的。
例如，-rwxrwx—表示这个文档的权限为：
owner=rwx=4+2+1=7
group=rwx=4+2+1=7
others=—=0+0+0=0
所以其权限为0770。
25.3.1.10 application_name
参数说明：当前连接请求当中，所使用的客户端名称。
该参数属于USERSET类型参数，请参考表15-1中对应设置方法进行设置。
在备机请求主机进行日志复制时，如果该参数非空串，那么会被用来作为备机在主机上
的流复制槽名字。此时，如果该参数长度超过61个字节，那么流复制槽名字只会截取使用
前61个字节的字符。
取值范围：字符串。
默认值：空字符串（连接到后端的应用名，以实际安装为准）
25.3.1.11 connection_info
参数说明：连接数据库的驱动类型、驱动版本号、当前驱动的部署路径和进程属主用户。
该参数属于USERSET类型参数，属于运维类参数，不建议用户设置。
取值范围：字符串。
默认值：空字符串
南大通用数据技术股份有限公司
1182
GBase 8s V8.8开发者手册
说明：
空字符串，表示当前连接数据库的驱动不支持自动设置connection_info参数或应用程序
未设置。
驱动连接数据库的时候自行拼接的connection_info参数格式如下：
{"driver_name":"ODBC","driver_version":"(GBase8sX.X.Xbuild13b34b53)compiledat
2020-05-0802:59:43commit2143lastmr131
debug","driver_path":"/usr/local/lib/psqlodbcw.so","os_user":"omm"}
默认显示driver_name和driver_version，driver_path和os_user的显示由用户控制（参见
连接数据库和Linux下配置数据源）。
25.3.2 安全和认证（postgresql.conf）
介绍设置客户端和服务器的安全认证方式的相关参数。
25.3.2.1 authentication_timeout
参数说明：完成客户端认证的最长时间。如果一个客户端没有在这段时间里完成与服务
器端的认证，则服务器自动中断与客户端的连接，这样就避免了出问题的客户端无限制地占
用连接数。
该参数属于SIGHUP类型参数，请参考表15-1中对应设置方法进行设置。
取值范围：整型，最小值为1，最大值为600，最小单位为s。
默认值：1min
25.3.2.2 auth_iteration_count
参数说明：认证加密信息生成过程中使用的迭代次数。
该参数属于SIGHUP类型参数，请参考表15-1中对应设置方法进行设置。
取值范围：整型，2048-134217728。
默认值：10000
须知：
南大通用数据技术股份有限公司
1183
GBase 8s V8.8开发者手册
迭代次数设置过小会降低口令存储的安全性，设置过大会导致认证、用户创建等涉及口
令加密的场景性能劣化，请根据实际硬件条件合理设置迭代次数，推荐采用默认迭代次数。
25.3.2.3 session_authorization
参数说明：当前会话的用户标识。
该参数属于 USERSET 类型参数，此参数为内部参数，只能通过 SET SESSION