2.1.3
在Linux和UNIX操作系统上，实例目录位于INSTHOME/sqllib目录中，其中INSTHOME
实例目录包含：
一个实例创建后，会生成一个实例目录，实例目录存储着与一个数据库实例相关的所
·诊断文件、数据库错误日志等。
数据库管理器配置文件（db2systm）
区服务器。如果想要将高速互连用于数据库分区。
节点配置文件（db2nodes.cfg），db2nodes.cfg文件用来定义参与DB2实例的数据库分
节点目录（SQLNODIR）
系统数据库目录（SQLDBDIR）
实例目录
条目进行更新：
系列TCP/IP端口。如果指定了此选项，那么本地机器的services文件将使用下列
client用于创建IBM数据库服务器客户机的一个实例。
DB2_InstName_END
-用于指定当在MPP（数据库分区）方式下运行时，分区数据库实例要使用的一
Q
DB2_InstName_2
DB2_InstName_1
DB2_InstName
主机名。
-u
-P
standalone
地客户机。此类型是DB2个人版的默认实例类型。
wse用于创建DB2数据库服务器的一个实例，该数据库服务器带有本地和远
用于覆盖默认TCP/IP主机名。在创建默认节点（节点O)时，将使用该TCP/IP
类型。
程客户机。此类型是DB2工作组版、DB2易捷版或Express-C版的默认实例
器带有本地和远程客户机。此类型是DB2企业服务器版的默认实例类型。
用于指定实例概要文件路径，对于环境变量DB2INSTPROF。
用于指定DB2服务的账户名和密码。创建ese实例时需要此选项。
用于创建DB2数据库服务器的一个实例，该数据库服务器带有本
endport/tcp
baseport+2/tcp
baseport/tcp
第2章创建实例和管理服务器
更多资源请访问www.ckook.com
---
## Page 61
变量。同样DB2实例本身也有实例级别的注册变量，为了修改这些默认的变量，我们使用
令。我们都知道在操作系统中我们可以使用set、setenv或export命令来修改操作系统环境
讲解一下db2set命令，之所以讲解这个命令是因为我们特殊定制实例时，需要用到这个命
那么输入db2icrt命令之前必须设置DB2INSTPROF。
位置，这需要该实例目录的写访问权。如果想要在不同于DB2PATH的路径中创建目录，
建服务所需的正确权限。可在DB2PATH中使用DB2INSTPROF环境变量更改实例目录的
服务名称相同，因此应该不会发生冲突。实例名不应与别的服务名称相同。您必须要有创
循序渐进DB2-
实例目录非常重要，下面我们举一个例子来说明实例目录。在讲这个例子之前我们先
在Windows操作系统上，实例目录位于安装了DB2数据库产品的目录下。实例名与
DBA系统管理、运维与应用案例
dasusl
db2inst1
toos
securty
adm
include
db2dump
dasfen
图2-2实例db2inst1的实例目录
口
口
1
234
数年管理配基文挥置文件
↑
sercs
b2pre
D
更多资源请访问www.ckook.com
---
## Page 62
DB2COPY1
量，然后在Windows上创建一个新的实例并查看这个实例的实例目录。
为了安全起见，建议您在对注册表变量作了更改后总是停止和启动实例。
和启动实例（db2stop/db2start，这两个命令后面会讲解）.另一些注册表变量则没有这个需求。
实例级的值。
册表变量在不同级别上进行定义时，DB2总是会选择最低级别的值：在本例中，它将选择
全局级对该系统上所有实例上定义的：[e]表示是操作系统级别的环境变量。
DB2COPY1
db2set命令。它是set前加上db2表示设置DB2级别的变量。这个命令使用很简单。例如：
db2set-all
db2set命令等号（=）前后不该留有空格。某些注册表变量为了使更改生效，要求您停止
要查看可以在DB2中进行定义的所有注册表变量，请使用下面这个命令：
[g] DB2ADMINSERVER=DB2DAS00
[i] DB2INSTPROF=C:\DOCUMENTS AND SETTINGS\ALL USERS\APPLICATIONDATA\IBM\
[e] DB2PATH=C:\Program Files\IBM\SQLLIB
好，现在我们已经知道db2set命令的用法，现在让我们先设置DB2INSTPROF注册变
请注意上面的示例，在两个级别（实例级和全局级）上设置了同一个变量。当同一个注
db2set DB2INSTPROF="C:\MY FILES\SQLLIB"-iDB2
db2setDB2INSTPROF="C:\INSTDIR-g
要在全局级上设置特定变量（在下面这个示例中为DB2INSTPROF）的值，请使用：
db2set-lr
正如您可能已经猜测到的那样，[表明该变量是在实例级上定义的，而[g]表明它是在
C:\>db2set
注意：
要在实例级上为实例“DB2”设置变量，请使用：
[i]DB2INSTPROF=C:\DOCUMENTS AND SETTINGS\ALL USERS\APPLICATION DATA\IBM\
C:\>db2set-all
您可能会得到类似下面这样的输出：
要查看已经设置的注册表变量，请从命令行执行下面这个命令：
-all
第2章创建实例和管理服务器
更多资源请访问www.ckook.com
---
## Page 63
8
DB2COPY1-PROD服务，如图2-5所示。
误日志、安全配置等重要信息。所以实例目录至关重要。
(SQLDBDIR）、节点目录（SQLNODIR）、节点配置文件（db2nodes.cfg）、诊断文件、数据库错
的目录。这就是实例PROD的实例目录，如图2-3所示。
循序渐进DB2—DBA系统管理、运维与应用案例
同时PROD实例创建后，我们可以发现在Windows的服务面板中，多了一项
在这个目录中存放实例的数据库管理器配置文件（db2systm)、系统数据库目录
在我们创建完prod实例后，我们发现在DB2INSTPROF目录下生成了一个和实例同名
我们进入我们刚刚创建的实例PROD的目录，如图2-4所示。
DB20000IDB2ICRT命令成功完成。
C:\>db2icrt prod----
C:\>db2setDB2INSTPROF=C:\INSTDIR
DB2COPY1
文件和文件实任务
Setin11D
国女
收藏（A）工具（T）帮助（H）
启动此服务
DB2-DB2COPY1-PROD
享此文件卖
服务（本地）
个文件夹
db2cli
tior
图2-3实例PROD的实例目录
图2-5Windows服务面板
图2-4实例PROD的目录
实实们
画
bZsy
db2dimg
夹夹夹夹央夹
置件
dbZcache
C
208--2123
200--1218
2008-11-229:23
修改日期
更多资源请访问www.ckook.com
C
db2toc
---
## Page 64
件中添加下面的语句，或者在用户需要访问DB2的终端窗口中执行该语句（注意需要句点
db2cshrc脚本文件。为了选择要使用的实例的用户，请在该用户的.profile或.login脚本文
认会加到实例用户的.profile文件中）。对于Cshell用户，可以编辑.login文件让它运行
标用户账户的.profile文件，使该用户登录到系统时自动运行db2profile脚本（创建实例时默
文件）来配置其他用户的DB2运行环境。如果使用Bourme或Kornshell，那么可以编辑目
置DB2实例运行环境而导致无法执行相关DB2命令的例子。
必须运行同样的脚本，否则将无法访问DB2实例运行环境。图2-6所示是一个由于没有设
例所有者登录到系统时都要使用该文件配置其环境。这些脚本设置对数据库环境的访问，
实例目录下生成一个特殊的DB2环境脚本db2profile(Windows下为db2profile.bat），每次实
户账户关联的文件和进程不能被其他用户直接访问。默认情况下，创建新的实例时，会在
讲解）。
db2icrt和db2idrop需要root权限才能执行。而除了这两个命令，其他实例命令需要我们
在执行这些命令时一定要确保具有足够的权限。实例相关的命令对权限要求很高，例如
些命令之前我们首先要配置好实例的运行环境。这适用于所有用户（包括管理用户）。
2.1.4实例相关命令
组后台进程存在的。Linux/UNIX上可以通过db2_ps或ps-elfgrep-iINSTNAME查看DB2
允许实例所有者执行DB2命令。为了让系统上的其他用户访问实例和DB2环境，他们也
具有SYSADM、SYSCTRL或SYSMAINT的权限才能运行（第13章中有关于权限的详细
新每个用户的数据库环境，以便该环境可以访问实例并运行DB2实例相关命令。在运行这
进程的状态。
我们可以通过设置DB2实例所有者的.profile文件（或者该.profile文件引用的db2profile
我们都知道在Linux和UNIX环境中，在用户级上强制实施高安全策略时，与一个用
1.配置实例运行环境
在实例创建后，我们可以执行实例相关的命令来管理实例。在使用实例之前，必须更
这是因为在Windows上实例是作为服务存在的，而在Linux/UNIX上，实例是作为一
B210GTE
标记C:\WIND0WS\system32\cmd.exe
oracledb2
图2-6因没有设置DB2实例运行环境而无法执行相关DB2命令
Leonment
SauLe
未配置DB2运行环境
第2章创建实例和管理服务器
更多资源请访问www.ckook.com
而且
39
---
## Page 65
如下所示使用该命令：
有数据库实例。
db2iupdt命令（需要root用户，在DB2V9.1之后会在升级后自动调用此命令）来更新所有现
（.)和空格）：
循序渐进DB2-
db2iupdt命令可在\sqllib\bin目录中找到。要更新实例配置，请使用db2iupdt命令。按
如果通过安装“程序临时性修订（PTF）”或补丁更新了数据库管理器，那么应使用
instanceName
迁移实例
--系统存在三个实例。
db2ilist命令列出机器上的DB2实例。
在配置好DB2的运行环境后，下面我们来讲解一些实例相关的命令。
C shell:source INSTHOME/sqllib/db2cshrc
更新实例配置
列出实例
是实例目录
Bourne或Korn shel1:INsTHOME/sqllib/ab2profile-注意前面的“”INSTHOME
DB2
DEV
PROD
必需的。
username，password用于指定DB2服务的账户名和密码。在迁移分区实例时，此选项是
instanceProf是迁移实例的实例概要文件路径
authType是实例的认证类型（SERVER、
安静方式
此用法信息
实例名
一DBA系统管理、运维与应用案例
[/a:authType]
[B/1
CLIENT或SERVER ENCRYPT)
更多资源请访问www.ckook.com
---
## Page 66
输入以下命令：
输入以下命令：
中更改DB2服务的属性（手动或自动）。
版本迁移。例如从DB2V7到DB2V8用db2imigr，而从DB2V8.1.4到V8.2.4用db2iupdt。
新该实例
指定了此选项，
InstName实例名
db2iauto-off--其中是实例的登录名
示例：如果在创建实例后安装了DB2工作组服务器版或DB2企业服务器版，可输入以下命令来更
派[/p:instance profile path]
在UNIX或linux操作系统上，要允许一个实例在每次系统重新启动后自动启动，请
db2iauto-on--其中是实例的登录名
db2imigr和db2iupdt的区别是，db2iupdt通常是小版本打补丁，而db2imigr通常是大
在UNIX或Linux操作系统上，要阻止一个实例在每次系统重新启动后自动启动，请
在Windows操作系统上，默认情况下，安装期间创建的数据库实例设置为自动启动。
2.自动启动实例
注意：
/a
/h
/u
[/r:baseport,endport]
db2iupdt -u db2fenc1 db2inst1
[/a:authType]
[/q]
DB2 InstName
用于指定DB2服务的账户名和密码。
安静方式
用于覆盖默认TCP/IP主机名（如果当前机器有多个TCP/IP主机名）。
DB2 InstName END
那么本地机器的services文件将使用下列条目进行更新：
用于指定当在MPP方式下运行时，分区数据库实例要使用的一系列TCP/IP端口。如果
此用法信息
用于指定
已更新的实例的新实例概要文件路径。
endport/tcp
当创建分区数据库实例时，此选项是必需的。
第2章创建实例和管理服务器