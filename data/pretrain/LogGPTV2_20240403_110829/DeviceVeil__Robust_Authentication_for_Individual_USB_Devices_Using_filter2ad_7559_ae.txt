(cid:90)(cid:286)(cid:410)(cid:437)(cid:396)(cid:374)
(cid:24)(cid:286)(cid:448)(cid:349)(cid:272)(cid:286)(cid:3)(cid:24)(cid:286)(cid:400)(cid:272)(cid:396)(cid:349)(cid:393)(cid:410)(cid:381)(cid:396)
(cid:90)(cid:286)(cid:400)(cid:286)(cid:410)
(cid:94)(cid:286)(cid:410)(cid:3)(cid:4)(cid:282)(cid:282)(cid:396)(cid:286)(cid:400)(cid:400)
(cid:87)(cid:258)(cid:400)(cid:400)(cid:100)(cid:346)(cid:396)(cid:381)(cid:437)(cid:336)(cid:346)
(cid:44)(cid:381)(cid:381)(cid:364)
(cid:116)(cid:346)(cid:286)(cid:374)(cid:3)(cid:410)(cid:346)(cid:286)(cid:3)(cid:282)(cid:286)(cid:448)(cid:349)(cid:272)(cid:286)(cid:3)(cid:349)(cid:400)(cid:3)(cid:258)(cid:3)
(cid:396)(cid:286)(cid:336)(cid:349)(cid:400)(cid:410)(cid:286)(cid:396)(cid:286)(cid:282)(cid:3)(cid:104)(cid:94)(cid:17)(cid:882)(cid:87)(cid:104)(cid:38)(cid:3)
(cid:282)(cid:286)(cid:448)(cid:349)(cid:272)(cid:286)
(cid:94)(cid:286)(cid:410)(cid:3)(cid:4)(cid:282)(cid:282)(cid:396)(cid:286)(cid:400)(cid:400)
(cid:39)(cid:286)(cid:410)(cid:890)(cid:282)(cid:286)(cid:400)(cid:272)(cid:396)(cid:349)(cid:393)(cid:410)(cid:381)(cid:396)(cid:894)(cid:282)(cid:286)(cid:448)(cid:349)(cid:272)(cid:286)(cid:895)
(cid:24)(cid:286)(cid:448)(cid:349)(cid:272)(cid:286)(cid:3)(cid:349)(cid:400)(cid:3)
(cid:396)(cid:286)(cid:336)(cid:349)(cid:400)(cid:410)(cid:286)(cid:396)(cid:286)(cid:282)(cid:3)(cid:381)(cid:396)(cid:3)(cid:374)(cid:381)(cid:410)
(cid:39)(cid:286)(cid:410)(cid:890)(cid:282)(cid:286)(cid:400)(cid:272)(cid:396)(cid:349)(cid:393)(cid:410)(cid:381)(cid:396)(cid:894)(cid:272)(cid:381)(cid:374)(cid:296)(cid:349)(cid:336)(cid:437)(cid:396)(cid:258)(cid:410)(cid:349)(cid:381)(cid:374)(cid:895)
(cid:94)(cid:286)(cid:410)(cid:3)(cid:18)(cid:381)(cid:374)(cid:296)(cid:349)(cid:336)(cid:437)(cid:396)(cid:258)(cid:410)(cid:349)(cid:381)(cid:374)
(cid:90)(cid:286)(cid:410)(cid:437)(cid:396)(cid:374)
(cid:18)(cid:381)(cid:374)(cid:296)(cid:349)(cid:336)(cid:437)(cid:396)(cid:258)(cid:410)(cid:349)(cid:381)(cid:374)(cid:3)(cid:24)(cid:286)(cid:400)(cid:272)(cid:396)(cid:349)(cid:393)(cid:410)(cid:381)(cid:396)
(cid:24)(cid:286)(cid:448)(cid:349)(cid:272)(cid:286)(cid:115)(cid:286)(cid:349)(cid:367) (cid:400)(cid:286)(cid:410)(cid:400)(cid:3)(cid:437)(cid:393)(cid:3)(cid:258)(cid:3)(cid:104)(cid:94)(cid:17)(cid:3)(cid:24)(cid:286)(cid:448)(cid:349)(cid:272)(cid:286)
(cid:39)(cid:286)(cid:410)(cid:890)(cid:282)(cid:286)(cid:400)(cid:272)(cid:396)(cid:349)(cid:393)(cid:410)(cid:381)(cid:396)(cid:894)(cid:282)(cid:286)(cid:448)(cid:349)(cid:272)(cid:286)(cid:895)
(cid:39)(cid:286)(cid:410)(cid:890)(cid:282)(cid:286)(cid:400)(cid:272)(cid:396)(cid:349)(cid:393)(cid:410)(cid:381)(cid:396)(cid:894)(cid:272)(cid:381)(cid:374)(cid:296)(cid:349)(cid:336)(cid:437)(cid:396)(cid:258)(cid:410)(cid:349)(cid:381)(cid:374)(cid:895)
(cid:24)(cid:437)(cid:373)(cid:373)(cid:455)
(cid:94)(cid:286)(cid:410)(cid:3)(cid:18)(cid:381)(cid:374)(cid:296)(cid:349)(cid:336)(cid:437)(cid:396)(cid:258)(cid:410)(cid:349)(cid:381)(cid:374)
(cid:90)(cid:286)(cid:410)(cid:437)(cid:396)(cid:374)
(cid:24)(cid:286)(cid:448)(cid:349)(cid:272)(cid:286)(cid:3)(cid:24)(cid:286)(cid:400)(cid:272)(cid:396)(cid:349)(cid:393)(cid:410)(cid:381)(cid:396)
(cid:90)(cid:286)(cid:410)(cid:437)(cid:396)(cid:374)
(cid:18)(cid:381)(cid:374)(cid:296)(cid:349)(cid:336)(cid:437)(cid:396)(cid:258)(cid:410)(cid:349)(cid:381)(cid:374)(cid:3)(cid:24)(cid:286)(cid:400)(cid:272)(cid:396)(cid:349)(cid:393)(cid:410)(cid:381)(cid:396)
(cid:39)(cid:437)(cid:286)(cid:400)(cid:410)(cid:3)(cid:75)(cid:94)(cid:3)(cid:400)(cid:286)(cid:410)(cid:400) (cid:437)(cid:393)(cid:3)(cid:24)(cid:437)(cid:373)(cid:373)(cid:455)(cid:3)(cid:104)(cid:94)(cid:17)(cid:3)(cid:364)(cid:286)(cid:455)(cid:271)(cid:381)(cid:258)(cid:396)(cid:282)
(cid:24)(cid:349)(cid:400)(cid:272)(cid:381)(cid:374)(cid:374)(cid:286)(cid:272)(cid:410)
(cid:24)(cid:437)(cid:373)(cid:373)(cid:455)(cid:3)(cid:3)(cid:104)(cid:94)(cid:17)
(cid:60)(cid:286)(cid:455)(cid:271)(cid:381)(cid:258)(cid:396)(cid:282)
(cid:90)(cid:286)(cid:400)(cid:286)(cid:410)
(cid:94)(cid:286)(cid:410)(cid:3)(cid:4)(cid:282)(cid:282)(cid:396)(cid:286)(cid:400)(cid:400)
(cid:39)(cid:286)(cid:410)(cid:890)(cid:282)(cid:286)(cid:400)(cid:272)(cid:396)(cid:349)(cid:393)(cid:410)(cid:381)(cid:396)(cid:894)(cid:282)(cid:286)(cid:448)(cid:349)(cid:272)(cid:286)(cid:895)
(cid:39)(cid:286)(cid:410)(cid:890)(cid:282)(cid:286)(cid:400)(cid:272)(cid:396)(cid:349)(cid:393)(cid:410)(cid:381)(cid:396)(cid:894)(cid:272)(cid:381)(cid:374)(cid:296)(cid:349)(cid:336)(cid:437)(cid:396)(cid:258)(cid:410)(cid:349)(cid:381)(cid:374)(cid:895)
(cid:94)(cid:286)(cid:410)(cid:3)(cid:18)(cid:381)(cid:374)(cid:296)(cid:349)(cid:336)(cid:437)(cid:396)(cid:258)(cid:410)(cid:349)(cid:381)(cid:374)
(cid:87)(cid:104)(cid:38)(cid:3)(cid:4)(cid:437)(cid:410)(cid:346)(cid:286)(cid:374)(cid:410)(cid:349)(cid:272)(cid:258)(cid:410)(cid:349)(cid:381)(cid:374)
(cid:90)(cid:286)(cid:400)(cid:286)(cid:410)
(cid:90)(cid:381)(cid:381)(cid:410) (cid:44)(cid:437)(cid:271)
(cid:24)(cid:349)(cid:400)(cid:272)(cid:381)(cid:374)(cid:374)(cid:286)(cid:272)(cid:410)
(cid:4)(cid:410)(cid:410)(cid:258)(cid:272)(cid:346)
(cid:87)(cid:258)(cid:400)(cid:400)(cid:100)(cid:346)(cid:396)(cid:381)(cid:437)(cid:336)(cid:346)
(cid:90)(cid:286)(cid:410)(cid:437)(cid:396)(cid:374)
(cid:24)(cid:286)(cid:448)(cid:349)(cid:272)(cid:286)(cid:3)(cid:24)(cid:286)(cid:400)(cid:272)(cid:396)(cid:349)(cid:393)(cid:410)(cid:381)(cid:396)
(cid:90)(cid:286)(cid:410)(cid:437)(cid:396)(cid:374)
(cid:18)(cid:381)(cid:374)(cid:296)(cid:349)(cid:336)(cid:437)(cid:396)(cid:258)(cid:410)(cid:349)(cid:381)(cid:374)(cid:3)(cid:24)(cid:286)(cid:400)(cid:272)(cid:396)(cid:349)(cid:393)(cid:410)(cid:381)(cid:396)
(cid:39)(cid:437)(cid:286)(cid:400)(cid:410)(cid:3)(cid:75)(cid:94)(cid:3)(cid:400)(cid:286)(cid:410)(cid:400)(cid:3)(cid:3)(cid:437)(cid:393)(cid:3)(cid:104)(cid:94)(cid:17)(cid:882)(cid:87)(cid:104)(cid:38)(cid:3)(cid:24)(cid:286)(cid:448)(cid:349)(cid:272)(cid:286)
Fig. 5. Pre-OS USB device detection on DeviceVeil (between the Guest OS
and a USB-PUF device)
the OS is informed about
2) Procedure of Pre-OS USB Detection: Figure 5 shows
the procedure for pre-OS USB device detection by DeviceVeil
hypervisor. When a USB device is inserted,
the “Attach”
hardware interrupt occurs. Due to BitVisor’s para-pass-through
architecture,
the insertion, and
DeviceVeil disguises a dummy device until PUF authentication
is completed. After the “Attach” interrupt, the OS follows
the normal procedure to detect a USB device. The OS waits
a certain period (about 100 msec) and issues the “Reset”
command. Then the USB device comes to the “default”
state and can accept control commands. After that, the “Set
Address” command is issued from the OS to the USB device;
however, this request is overtaken by DeviceVeil, which issues
its own “Set Address” command to the USB device. The USB
device then comes into the “address” state.
DeviceVeil sends Get descriptor(device) to the device to
get device descriptor (e.g., vendor ID, product ID, class ID,
serial number). If the device is a registered USB-PUF device,
DeviceVeil offers a dummy harmless USB keyboard to the
OS and attempts the PUF authentication process. If the device
is a registered non USB-PUF device (if explicitly allowed
by administrators during the transition), DeviceVeil allows
para-pass-through access from the OS immediately. Otherwise,
DeviceVeil just offers a dummy device to the OS.
legitimate PUF-enabled devices, DeviceVeil
al-
For
lows
the OS to continue the USB device recognition
procedure. The OS sends Get descriptor(device) and
Authorized licensed use limited to: Tsinghua University. Downloaded on March 19,2021 at 10:52:47 UTC from IEEE Xplore.  Restrictions apply. 
COMPARISON BETWEEN DEVICEVEIL AND RELATED PROPOSALS
TABLE III
Individual
Device Auth.
Additional
Hardware
Granularity
Overhead
Isolation
OS dependence
Tamper-proof
and hardening
USB 3.0
Type-C [72]
No
Tamper-proof
storage in USB
(Spec-only)
Device
Insert
time
No
No
(Good
on USB)
(Spec-only)
Tamper-proof
Storage
Active
Directory
No
No
Device
Insert
time
No
Yes
(Partial
on host)
Privilege
mode
GoodUSB
[66]
Serial
Number
No
Cinch
[2]
No
No
Device
Insert
time
No
Yes
(Partial
on host)
In
Kernel
Packet
Comm.
time
Yes
QEMU/KVM
No
(Partial
on host)
In
Hypervisor
USBFILTER
[68]
No
Kells
[7]
No
ProvUSB
[67]
No
No
Packet
Comm.
time
No
Yes
(Good
on host)
Trusted Boot
SELinux
ARM
in USB
Device
Insert
time
No
Yes
(Good
on host)
TPM
Auth.
ARM
in USB
Device
Insert
time
No
Yes
(Good
on host)
TPM
Auth.
DeviceVeil
PUF
PUF
in USB
Device
Insert
time
Yes
BitVisor
No
(Good on
host&USB)
Trusted Boot
Secure Boot
PUF
Get descriptor(conf iguration), but DeviceVeil hooks them
and responds with a dummy USB device. After the OS recog-
nizes a dummy USB device, DeviceVeil initiates the PL-PUF
authentication process (Section VI-A). If authentication fails,
no other action is taken (the OS only sees the dummy USB
keyboard that processes no input). If authentication succeeds,
DeviceVeil issues the “Reset” command to the USB root hub
of the PC. The root hub raises the “Disconnected” interrupt,
which goes to the OS. The OS recognizes that the dummy
USB device is removed and takes action for disconnection.
Afterward,
the USB device issues the “Attach” interrupt
automatically, which is sent to the OS to establish a USB
connection normally. From this time, DeviceVeil forwards all
requests as para-pass-through.
If authentication fails, DeviceVeil does not take any further
action. The OS keeps the dummy USB keyboard, which
processes no input. When the real USB device is disconnected,
the dummy USB keyboard is also removed in the manner of
USB disconnection.
C. Customizing Trusted/Secure Boot
The OS disk partition is separated from the disk partition
for booting DeviceVeil. The OS partition is encrypted by
DeviceVeil using the encryption key sealed in the TPM (i.e.,
unsealed only when the PCR values indicate that unmodiﬁed
trusted boot and DeviceVeil have been loaded). The current
implementation is designed for TPM 1.2 on a ThinkPad
T400 (Intel Core2 P8400 2.26GHz) and uses TCG-BIOS and
TrouSerS [71]. We use the TPM NV DeﬁneSpace command
to allocate the NVRAM space for the encryption key, bounded
by PCR[0-7] (TCG-BIOS) and PCR[12-14] (Trusted GRUB)
values. The TPM NN WriteValue command is used to write
the encryption key to NVRAM with these PCR values during
the setup stage. The TPM NV ReadValue command is used to
read the encryption key. The read operation is successful only
when the bounded PCR values are the same as the registered
values. After that, DeviceVeil decrypts the OS disk partition
and boots the OS.
To customize secure boot for DeviceVeil and the OS, the
Platform Key, Key Exchange Key, Authorized DB, and Unau-
thorized DB must be replaceable. We use ThinkPad T460s
(Intel i5-6300U 2.4GHz) as ThinkPad T400 does not offer
secure boot. On the other hand, ThinkPad T460s does not have
TPM 1.2. We thus have to use both these machines for testing
our prototype (which of course can be integrated into a single,
compatible PC). The UEFI of T460s allows customizing the
Platform Key, Key Exchange Key, Authorized DB, and Unau-
thorized DB. In order to boot Linux, we used shim.elf [55],
a pre-bootloader for GRUB bootloader, hypervisor, and the
Linux kernel.
VII. EVALUATION
We compare DeviceVeil with existing solutions, evaluate
it against two types of attacks, and measure the performance