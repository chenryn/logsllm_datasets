另一方面，应做好细粒度的访问控制，进行合适的网络隔离，控制数据传播范围，进行全面的内部操作审计，保持持续监控，防 止数据泄漏、权限滥用。
33
用户实体行为分析技术（UEBA）（2020 年）
五、典型应用案例
（一）恶意内部人员五、典型应用案例
（一）恶意内部人员
根据 Haystax 于 2019 年发布的网络内部安全威胁报告，如图 12 所示，内部威胁是造成数据泄露的第二大原因。往往因为非授权访 问、雇员和外包员工工作失误等原因，导致“合法用户”可以非法 访问特定的业务和数据资源，造成组织内部数据泄漏。17从本质上讲，恶意内部威胁来自具有试图对雇主施加损害等恶意意图的可信用户。由于难以评估恶意意图，需要分析数据中难以获取的上下文行为信 息。
图 12 内部人员导致的安全威胁
内部人员窃取敏感数据是企业典型的内部威胁场景。由于内部 人员具备企业数据资产的合法访问权限，且通常了解企业敏感数据 的存放位置，因此通过传统的行为审计手段无法检测该类行为。但 是利用 UEBA 技术，选取敏感数据访问相关的特征，构建企业员工和 系统创建正常的活动基线、用户画像，可以通过基线构建模型用于 判断是否存在内部人员窃取敏感数据行为。17 2019 INSIDER THREAT REPORT，Haystax，2019
34
用户实体行为分析技术（UEBA）（2020 年）
针对此类场景，UEBA 解决方案通过治理组织的数据库日志、回 话日志、用户访问日志以及访问全流量等信息，生成敏感数据访问 周期、时序、动作、频繁度等相关特征，通过时序关联和自学习算 法生成敏感数据被访问的动态基线、用户访问动态基线、群体访问 动态基线。
图 13 内部员工窃取敏感数据场景分析流程图
利用动态基线，通过如图 13 所示流程，可实现对高频、越权、伪造身份、冒用身份、数据窃取等多种异常行为的分析和检测，进 一步关联敏感数据的访问特征，定位是否存在内部人员窃取敏感数 据行为，保障企业核心数据资产的安全。
（二）失陷账号
35
用户实体行为分析技术（UEBA）（2020 年）（二）失陷账号
35
用户实体行为分析技术（UEBA）（2020 年）
账号盗用一直是困扰各种组织的痛点，且涉及到最终用户的利 益和体验，特权账号更是黑客瞄准的攻击目标。如图 14 所示，攻击 者一旦渗透进组织边界且获取失陷账号后，会在组织内部网络中横 向移动，形成高级持续性威胁（APT）以及未知或尚无法理解的各种 威胁，比如众所周知的零日攻击，该类攻击行为难以发现，并且通 常隐藏在合法用户或服务帐户的面纱之下。
图 14 账号失陷是攻击链模型中的转折点
传统范式难以对付该类攻击，同时难以跟随攻击者的技术升级。该类威胁通常有一个复杂的作战模式如攻击链，而且会长期留存，其中大部分行为尚未被认定为恶意行为，通过简单的分析如模式匹 配、阈值或关联规则均难以检测。
然而，许多高级威胁会使得用户和资产行为方式与平时不同，如失陷账号。针对此类场景，UEBA 通过对正常行为和人员进行抽象 归纳，利用大数据技术生成个体行为画像和群体行为画像。在此基 础上，对比账户的活动是否存在异常行为，如频繁登录和退出、访36
用户实体行为分析技术（UEBA）（2020 年）
问历史未访问过的信息系统或数据资产、异常时间地点登录等，并 对比分析账户的活动是否偏离个人行为画像和群体（如部门或项目 组等）行为画像，综合判断账户疑似被盗用风险评分，帮助安全团 队及时发现账号失陷。
UEBA 技术为检测失陷账号提供了最佳的安全视角，提高了数据 的信噪比，可合并和减少告警量，让安全团队优先处理正在进行的 威胁，并且促进有效的响应调查。
同时，UEBA 还可针对已建立的账号监视分析用户行为，识别过 多的特权或异常访问权限，适用于特权用户和服务帐户等所有类型 的用户和帐户。使用 UEBA 还可以用来帮助清理帐户和权限设置高于 所需权限的休眠帐户和用户权限。通过 UEBA 的行为分析，身份识别 与访问管理（IAM）和特权账号管理（PAM）系统能够更全面的进行 访问主体安全性评估，支持零信任（Zero Trust）网络安全架构和 部署场景。动态权限策略控制是零信任的核心能力，而 UEBA 已经成 为实现动态权限策略控制最有效的方法。（三）失陷主机
失陷主机是典型的企业内部威胁之一，如图 15 所示，攻击者常 常通过入侵内网服务器，形成“肉机”后对企业网络进行横向攻击。基于此类场景的特性分析，失陷主机通常包含回链宿主机和内网横 向扩散两大重要特征。
37
用户实体行为分析技术（UEBA）（2020 年）
图 15 主机失陷是病毒爆发、勒索软件的前奏
针对此类场景，UEBA 可构建时序异常检测模型，根据企业内网 主机或服务器时序特征的历史时序波动规律，以及请求域名、账户 登录、流量大小、访问安全区频繁度、链接主机标准差等特征，构 建单服务器的动态行为基线，群体（如业务类型、安全域等）服务 器动态行为基线。
利用基线，考虑具体的主机疑似失陷场景，如僵尸网络、勒索 病毒、命令控制（C&C 或 C2）等，给出不同模型不同实体在不同时 间段的综合异常评分，从而检测失陷主机，并结合资产信息，定位 到具体的时间段和主机信息，辅助企业及时发现失陷主机并溯源处 理。（四）数据泄露
数据泄露可能给组织的品牌声誉带来严重损失，导致巨大的公 关压力，是组织最关注的安全威胁之一。内部员工窃取敏感数据是 企业典型的数据泄漏场景，由于内部员工具备企业数据资产的合法
38
用户实体行为分析技术（UEBA）（2020 年）
访问权限，且通常了解企业敏感数据的存放位置，因此通过传统的 行为审计手段无法有效检测该类行为。
图 16 数据泄漏中的攻击移动和数据流
UEBA 可以增强 DLP 系统，使其具有异常检测和高级行为分析功 能。通过对数据访问行为的分析，结合其他上下文，融入网络流量（如 Web 安全代理）和端点数据进行分析，有助于了解数据传输活 动。组合 UEBA 和 DLP，数据泄露检测可以用于捕获内部人员和外部 黑客组织。如图 16 所示，根据数据泄漏的技术、方法及途径，选取敏感数 据访问相关的特征，构建企业员工和系统创建正常的活动基线和用 户画像，判断是否存在内部员工窃取敏感数据行为。针对此类场景，UEBA 解决方案通过治理企业数据库日志、回话日志、用户访问日志 以及访问全流量等信息，生成敏感数据访问相关特征，如访问周期、时序、动作、频繁度等，通过时序关联和自学习算法生成敏感数据
39
用户实体行为分析技术（UEBA）（2020 年）
库的被访问动态基线、用户访问动态基线、群体访问动态基线等多 种检测场景。
（五）风险定级排序
由于安全团队人力资源有限，所有组织几乎都面临告警过量的 问题，难以全面处理各个安全设备触发的安全告警。根据 SANS 2019 事故响应调查报告，57％的受访者认为安全团队人员短缺和技能短 缺是主要障碍。18 如何让有限宝贵的人力资源投入，带来最大的安全 运营收益，成为风险排序定级的价值所在。UEBA 不仅使用基线和威胁模型，而且也会根据所有安全解决方 案中生成的报警，构建用户及实体的行为时间线，进行风险聚合。通常也会结合组织结构、资产关键性、人员角色和访问级别等进行 权重评估，进行综合风险定级并排序，从而明确用户、实体、事件 或潜在事件应该优先处理范围。通过风险定级排序，可以极大的缓 解安全团队人力短缺的现状。
为了构建现代化 SIEM（Modern SIEM）能力，安全团队可以将 SIEM、UEBA、安全编排自动化响应（SOAR）结合，进行数据双向集 成，透过 SOAR 的安全编排，进行安全告警的分析和分类，利用人机 结合的方式对安全事件进行定义、划分优先级，建立标准化安全事
18 Incident Response (IR) Survey: It’s Time for a Change，SANS Institute，2019
40
用户实体行为分析技术（UEBA）（2020 年）40
用户实体行为分析技术（UEBA）（2020 年）
件的处理工作流，从而达到一体化安全运营，提升安全团队整体协 	19
同，形成行为异常的检测与响应闭环。
比如在某市医疗机构出现勒索病毒事件后，安全团队需要进行 应急响应，可是应该从何处着手？等待数据被加密收到勒索通知后，再处理就为时已晚。如果该机构部署了 UEBA，就可以快速分析文件 创建、文件读取、磁盘读取、磁盘写入等行为，发现可疑的病毒感 染资产，基于风险进行定级排序，对高风险资产优先进行隔离处理。安全团队还可以进行回溯调查，明确勒索病毒的传染源、传播扩散 的路径，有针对性的进行网络阻断，遏制勒索病毒的进一步爆发。
另一方面，如果该机构一直持续监控这些勒索病毒相关的行为 特征，持续检测异常行为，就可能在勒索发生前及时阻止事件的发 生。
（六）业务 API 安全（六）业务 API 安全
企业 WEB 业务系统通常会提供大量的业务应用编程接口（API），如登录 API、数据获取 API、业务调用 API 等，攻击者通过对具体网 站访问数据或请求数据进行抓包，可获取企业业务 API 入口的大致 范围，通过对这些 API 进行恶意调用，可实现恶意访问、数据窃取 以及其他相关恶意活动，严重影响企业的正常业务开展。
针对此类场景，攻击者可能利用变换多个不同的请求参数已达 到恶意调用 API 的目的。UEBA 通过分析目前常用的 API 组成和使用
19 网络安全先进技术与应用发展系列白皮书安全编排自动化响应，中国信息通信研究院，2018
41
用户实体行为分析技术（UEBA）（2020 年）
方式，通常包括 API 所对应的 URL 请求参数和请求主体两部分，通 过提取企业业务 API 访问频率特征、请求者访问频率特征、参数变 换标准差、以及请求时间昼夜分布等特征，构建 API 请求频率动态 基线、API 请求时序动态基线、参数变换动态基线等多种检测场景。基于动态基线，实现检测对 API 请求量突变异常检、周期性异 常、未知用户、可疑群体潜伏用户（某用户使用大量不同 IP）等异 常行为，进一步结合 API 的具体业务属性，实现 WEB 业务系统 API 异常请求行为检测，可定位到具体的时间段和业务、数据信息，辅 助企业及时发现异常调用行为，保证整体业务和数据安全。