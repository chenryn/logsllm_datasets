10.2.5
10.2.4
10.2.3
10.2.1对持卡人数据的所有单独用户访问。
10.3.5
10.3.4
10.3.3
10.3.2
10.2.2
受影响的数据、
系统级对象的创建和删除
具有根或者管理权限的任何个人进行的所有操作。
成功或者失败的指示。
事件类型。
ll
事件来源。
日期和时间。
审计日志的初始化。
标识和身份认证机制的使用。
对所有审计跟踪的访问。
无效的逻辑访问尝试。
系统组件或者资源的标识或者名称（来源：www.pcisecurity
---
## Page 288
统和用户活动的客观评估跟踪。
权修改”。这是显而易见的，因为如果日志被未授权方（或者任何人）修改，它们就不再是系
低劣的Web应用程序可能造成密码和Web统一资源定位符（URL）一起记录在Web服务器
且，PCIDSS在更新后的版本1.1中还明确地增加了一年的需求规定。
直接处理复杂的日志留存问题。因此，如果你无法查看1年前的日志，就违反了规定。而
存审计跟踪历史至少一年，保持在线可用性至少三个月”。和其他无数需求不同，这一需求
具实现和需求10.6的依从性”。
志是不可能的。因此，PCIDSS在这个需求上有个注解：“可以使用日志收集、解析和警报工
保留或者集中化日志。考虑到大型IT环境每天可能生成以GB计算的日志，人工阅读所有日
规程和常规做法。
AAA服务器（例如RADIUS）等安全功能的服务器”。本章余下的部分介绍详细的日志审核
记录组件不断写人的日志的完整性。
从而导致完整性检查的削弱。为了解决这一矛盾，应该注意完整性监控只能保证没有被日志
法，将文件和一个已知的正确副本比较。问题是，日志文件因为新记录的添加而不断增长，
不会自己压缩（除非日志轮转或者存档到外部存储）。文件完整性监控系统使用加密哈希算
改”。与此同时，在日志文件中添加新的日志数据不应该生成警报，因为日志文件不断增长
日志上使用文件完整性监控和变更检测软件，确保现存日志数据不能在没有警告的情况下更
器中。”
PCIDSS的需求10.5.4说明了这种需求：“将无线网络的日志复制到内部LAN上的日志服务
身上只保留极少量（或者没有）日志。因此，对于这些系统来说，集中化的日志最为关键。
日志不容易访问，在出现事故时也无法搜索。
备份到CD或者DVD（或者磁带）是这一需求的另一种结果。人们应该始终记住，磁带上的
或者一组用于日志分析的服务器，对于日志保护和增加日志实用性都是不可或缺的。将日志
即将审计跟踪文件备份到集中日志服务器或者难以修改的媒介”。确实，将日志集中到一个
果的日志。这涉及日志数据的“可用性”和“完整性”。PCIDSS10.5.3明确指出，必须“立
日志中。
最后一个需求（10.7）处理另一个非常重要的日志记录问题——日志留存，它规定：“留
许多网络基础设施（如路由器和交换机）被设计为将日志放到外部服务器，在设备自
接下来是“完整性”。根据PCIDSS的10.5.2小节，必须“保护审计跟踪文件免遭未授
但是，人们不仅必须保留来自恶意用户的日志，还应该保留系统故障和系统配置错误结
因此，PCIDSS需求还覆盖了需要“每天审核”的日志源范围，而不仅是需要配置日志
下一个需求最为重要，也是最容易被忽视的。许多PCI实施者忘记了，PCI需求10不
为了进一步降低日志修改的风险，并证明这样的修改没有进行，需求10.5.5要求“在
第19章日志和依从性267
---
## Page 289
268
活跃地运行，并且能够生成审计日志”，必须查看所提到的这些日志。
录密钥生成、分发和废止的日志，这些日志对于满足上述需求是至关重要的。
服务。日志可以说明何时启动了之前禁用的服务，这可能是不知情的系统管理员或者攻击者
么”而不只是“如何配置”。
准和测试所有外部网络连接以及防火墙配置变更的正式过程”。但是，在建立这种过程之后，
com/2010/12/complete-pci-dss-log-reviewprocedures.html)。
但实际情况更为复杂：日志出现和隐藏在所有其他的小节中（来源：http://chuvakin.blogspot.
的评估日志记录功能和应用程序安全监控，这是无法想象的。
安全感，损害依从性工作。“
明公司正处于恶意软件的威胁之下，因为没有更新最新特征码的防病毒软件只能造成虚假的
为这些信息由防病毒评估日志提供。著名的“防病毒更新失败”问题也在日志中反映，它说
节隐含了一个要求：拥有验证这些活动是否真正进行的日志。确切地说，大部分加密系统记
的操作造成的。
防火墙日志来验证这些配置，仅仅审核配置还不够，因为只有日志才能说明“实际发生了什
记录变得极其方便，因为它说明了实际发生的情况，而不是“应该发生”的情况。
人们必须验证防火墙配置变更确实得到授权，并且按照书面的变更管理过程进行。这时日志
件来证明。
中规定，还出现在所有其他PCI需求中。许多人可能认为PCI中的日志都在需求10中说明，
需求6也处于同一范畴：它要求组织“开发和维护安全的系统和应用程序”，没有强大
：所以，即使是“使用和定期更新防病毒软件”也可能在评估期间需要请求日志数据，
需求1.3包含防火墙配置的指导原则，有关于人站和出站连接性的具体陈述。必须使用
需求3更进一步，处理数据加密，这和日志记录有着直接而明确的联系。例如，3.6小
几乎所有满足PCIDSS需求的规定（如数据加密或者防病毒更新），都可能使用日志文
类似地，需求2讨论密码管理“最佳实践”和一般的安全加固，例如不运行没有必要的
例如，需求1“安装和维护防火墙配置，以保护持卡人数据”中提到，组织必须有“批
需求5针对病毒防御。当然，为了满足5.2小节的需求——“确保所有防病毒机制最新、
需求4处理的也是加密，由于同样的原因，和日志记录也有隐含的联系。
现在，我们做好准备，将要更加深人地研究日志和监控，这些日志和监控不仅在需求10
■应该保护所有收集日志的CIA（机密性、完整性、可用性）。
■范围内的系统上的时钟和时间应该同步。
■PCI要求日志中所有操作与实际用户挂钩。
■PCI需求10规定以预先定义的细节水平记录来自范围内所有系统的特定事件。
下面，我们来总结一下目前为止学习的PCI日志记录需求：
范围内的所有日志应该留存至少一年。
日志应该定期审核；特定的日志应该至少一天审核一次。
因
---
## Page 290
持一致，强调安全问题的检测，而非调查。
全管理系统—需求。”该规范可以在http://www.27000.org和其他位置找到（很遗憾，要付
全管理系统（ISMS）标准，全名为ISO/IEC27001:2005“信息技术—安全技术—信息安
19.3ISO2700X系列
集和分析，才能满足PCI的广泛需求。
日志数据收集和及时审核，上述要求难以想象。
记录和发布安全事故响应和升级规程，确保及时和有效地处理所有情况”，如果没有高效的
记录应该是每个安全策略的一部分。除此之外，事故响应需求也和日志记录相关：“建立、
中强制的每日日志审核规程应该在这里反映)。但是，它也和日志记录相关，因为评估日志
控所有网络流量，并向有关人员发出可疑入侵的警报。保持所有入侵检测和预防引擎最新”。
使用IDS或者IPS：“使用网络入侵检测系统、基于主机的人侵检测系统和人侵预防系统，监
留存这些日志至少3个月，除非法律有其他限制”。
对于这类日志有单独的数据留存需求：“使用访问者日志维护访问者活动的物理评估跟踪。
以物理日志簿的形式）的9.4小节也和日志管理有关（如果这些访问者日志是电子形式的）。
日志来验证，以便确保所有账户在90天内至少修改一次密码。
DSS8.5.1小节）。大部分系统记录这些活动的日志。
的ID”）。显然，人们必须“控制用户ID、证书和其他标识符对象的添加、删除和修改”（PCI
是一个“最佳实践”，还是一个需求（需求8“为每个具有计算机访问权的个人分配一个唯一
要采取纠正措施。
能够访问文中所指的数据。如果不应该看到数据的用户出现在访问数据的日志文件中，就需
费）。
人侵检测只在审核日志和警报时才有用。
需求12涵盖了更高级的问题—安全策略、安全标准和日常运营规程（例如，需求10
需求9介绍了安全的一个新领域一物理访问控制。甚至连包含访问者日志维护（可能
因此，PCIDSS中的事件日志记录和安全监控远不止于需求10。只有通过精心的数据收
除此之外，8.5.9小节“每90天至少更改用户密码一次”，
我们将把重点放在与日志记录和监控相关的ISO控制上。这些内容集中在“A.10.10监
需求11说明扫描（或者“测试”）范围内系统漏洞的必要性。但是，在11.4小节中要求
为每个访问系统的用户分配唯一的ID符合其他安全“最佳实践”。在PCI中，这不仅
ISO27001属于ISO27000标准家族。它是由国际标准化组织（ISO）发布的一个信息安
需求7规定“根据业务按需了解的原则限制对持卡人数据的访问”，需要日志来验证谁
，也可以通过审核来自服务器的
第19章日志和依从性269
---
## Page 291
270
留安全相关日志1年是常见的行业惯例。建议所有组织在整个环境中对物理和虚拟组件都实
定1年的日志留存期，只是提到日志留存，要求有单独的策略定义日志留存期。实际上，保
这些管理员的控制。
的关键可审核性手段。但是，为了用于这样的目的，日志必须通过日志管理解决方案，脱离
志记录实际上是在ISO计划指导下创建的最重要的日志，因为它们可以作为全能IT管理员
操纵等广泛的事件。在网络设备上，将包含安全性和可用性问题。
中的附加需求，我们可以总结ISO环境中所有系统需要记录的事件类型，如表19.1所示。
员活动应该记人日志”）和A.10.10.5“故障日志”（“故障应该记录、分析并采取相应的行动”》
短地强调了日志中需要记录的事件类型，遵循本章引言中提到的传统依从性相关日志类别。
拥有日志，而且在一个预先定义的时间周期（在你的日志留存策略中定义）内留存。它还简
息安全事件的审计日志，并保存一定的周期，以辅助未来的调查和访问控制监控。”这规定要
监控、调查和异常跟踪的策略及规程。
施这样的日志留存。
用、利用和已知攻击
始证据
这些日志能够为安全事故（如数据窃取）提供有用的初
和网络连接可用性问题以及达到各种限值等范围。所有
程序可用性和数据安全性的错误
组件的启动和关闭，以及故障和错误，特别是影响应用
及更新
数据变更（包括创建和销毁），以及应用程序和组件安装
问；特别是远程访问
证决策（登录）、系统访问、数据访问和应用程序组件访
已知威胁，如无效输人和其他可能的应用程序违规使
第4个类型是资源问题，涵盖了资源耗尽、超过容量
可用性问题，如系统、应用程序和应用程序模块或者
更改（如系统或者应用程序变更，特别是权限变更）
对于特权用户的监控（如“系统管理员和系统操作员活动”）应该加以特别注意。这种日
身份认证、
扩展上述定义，并加人A.10.10.4小节“管理员和操作员日志”（“系统管理员和系统操作
ISO27002提供实践中实施ISO系列标准的其他有用细节。例如，10.10.1“审计日志记录”
上述几个小节还包含了日志留存和调查的其他需求。和PCIDSS 不同，ISO没有明确规
在Windows上，这些事件包括了从登录到策略更改，再到应用程序更新及用户对数据的
所有这些事件可以提供对安全事故（如数据窃取）有用的初始证据。
授权和访问事件，如成功与失败的身份认
日志消息分类
表19.1在ISO环境中需要记录的日志事件类型
的损失
和恶意内部人员所做的更改
统的访问
监控运营问题和安全相关故障，以及系统业务可用性
监控可能将系统暴露在攻击之下的更改，以及攻击者
跟踪和调查授权用户以及攻击者和恶意内部人员对系
检测并阻止攻击，以及对其后果的调查
检测由于安全性和运营原因造成的资源问题
在ISO27000日志记录和监控中的目的
---
## Page 292
员用自动化工具或者人工进行（但是由于收集和留存的日志体积，后者在较大的环境中不可
情况的规程，活动监控的结果定期进行审核。”这要求一个日志记录策略和监控的操作规程。
附加的原则规定，“特权的使用”和“系统工具及应用程序的使用”必须记人日志。
ocr/privacy/hipaa/)。
做斗争”（1996年HIPPA法案）。该法案的拷贝可以在HHS网站上获得（http://www.hhs.gov/
覆盖团体和个人市场的便利性和持续性，和健康保险和保健服务中的浪费、欺诈和违规使用
康信息的相关安全和隐私标准，包括电子和物理信息。该法案的主要使命是“改进健康保险
或者其他可靠定时机制，以便保持事件的正确时序以及绝对时间。
分析的日志有正确的时间戳，且保持相关的时区信息，是行业的最佳实践。为日志使用NTP
始终应该与公认的准确时间源同步。”
盖过去的日志记录”（ISO27002）。这种日志数据的意外丢失是不能容忍的。
进一步实现其邪恶的目的——日志安全措施应该对外部攻击者和恶意（以及不谨慎的）内部
备份存档。虽然没有明确提及，但是这种控制暗示，恶意的内部人员不应该能够使用日志，
部分现代日志管理和SIEM系统提供严格的基于角色访问控制，按照“按需了解”的原则，