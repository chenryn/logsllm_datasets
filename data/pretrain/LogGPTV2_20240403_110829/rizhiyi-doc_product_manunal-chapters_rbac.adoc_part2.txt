===== 数据功能权限管控
数据功能权限管控包括：
可查看Agent管理::
    是否可以使用Agent管理页面
    * 是否可以新建Agent分组
可查看搜索权限::
    是否可以使用搜索权限页面
可使用路由配置::
    是否可以使用路由配置
可查看索引配置::
    是否可以查看索引配置
    * 是否可以新建索引配置
    * 是否可以读取所有内部索引
    * 是否可以更新所有内部索引
    * 是否可以读取所有非内部索引
    * 是否可以更新所有非内部索引
    * 是否可以删除所有非内部索引
可使用入库优先级::
    是否可以配置入库优先级
可使用数据库配置::
    是否可以使用数据库配置
可使用Ldap连接::
    是否可以使用Ldap连接
可使用本地上传::
    是否可以使用本地上传功能    
可使用备份::
    是否可以使用备份功能
===== 应用功能权限管控
应用功能权限管控包括：
可查看应用::
    是否可以使用应用功能
    * 是否可以使用大屏
    * 是否可使用事件管理
    * 是否可以新建应用
    * 是否可以使用机器学习
    * 是否可以使用智能运维
===== 系统功能权限管控
系统功能权限管控包括：
可使用结算管理::
    是否拥有结算管理的权限
可查看域使用额度::
    是否可以查看域使用额度
可查看域标识::
    是否可以查看域标识
可查看用户搜索用量::
    * 是否可以查看用户搜索用量
===== 用户与验证功能权限管控
用户与验证功能权限管控包括：
可查看角色页::
    是否可以查看角色页面
    * 是否有转授功能权限
    * 是否可以更新最大搜索时长
可查看用户页::
    是否可以查看用户页面
    * 是否可以新建用户
    * 是否可以修改自己账户信息
可查看用户分组::
    是否可以查看用户分组
    * 是否可以新建用户分组
可接收消息提醒::
    是否可以接收消息提醒
可使用ApiKey认证::
    是否可以使用ApiKey认证
可查看帮助文档::
    是否可以查看帮助文档
==== 资源授权
image::images/rbac-authorize.png[]
在可以搜索日志数据以后，用户常用的大多数和数据分析相关的功能都属于资源类别。比如：监控，仪表盘，CSV字典，知识，搜索宏，字段提取，报表，定时任务，已存搜索，拓扑图，趋势图，数据集，KV字典等，都属于资源，可以通过资源名称进行过滤，在授权中都拥有以下可选权限：
* 管理权限-读取：可以看到对应的资源。只有勾选了此权限，才可以勾选下述的其他3个管理权限。
* 管理权限-编辑：可编辑对应资源。
* 管理权限-删除：可删除对应资源。
* 管理权限-转授：拥有资源转授功能的用户，可以在资源列表页面操作列点击"授权"，或者在资源编辑页面点击"授权配置"，打开资源授权弹窗，把资源转授给其他角色，否则"授权"弹出层的选框不可选择；或角色授权页授权某角色该资源的选框不可选择。
+
image::images/auth-to-otherguy.png[]
* 有效期限：这里的期限作用于上面提到的4个管理权限：读取，编辑，删除，转授。默认"无期限"，点击"无限期"，可以自定义有效期限。
image::images/role-validity-period.png[]
[NOTE]
====
告警插件属于监控资源的附属资源，只有2个管理权限：读取和转授，只有拥有\__admin__角色的用户可以新建、编辑/删除告警插件，普通用户最多拥有读取和转授权限。
====
==== 应用访问授权
系统可以控制用户具体能访问、修改、删除哪些应用。用户无权访问的应用，在应用列表上不可见。
image::images/role-app.png[]
==== 用户授权
image::images/rbac-authorize-user.png[]
用户和用户分组在授权管理方面行为和资源类似。用户授权方面包括以下可选权限：
* 管理权限-读取：可以看到对应的用户。只有勾选了此权限，才可以勾选下述的其他2个管理权限。
* 管理权限-编辑：可编辑对应用户。
* 管理权限-转授：拥有资源转授功能的用户，在用户列表页面操作列点击"授权"，可以把用户转授给其他角色，否则点击"授权"弹出层的选框不可选择；或角色授权页授权某角色该资源的选框不可选择。
用户分组可以删除，用户只能禁用不能删除。详细说明参见后续用户管理章节。
==== Agent管理授权
image::images/rbac-authorize-agent.png[]
Agent是一种资源，默认属于agent分组"\__default_agent_group__"，用户自定义agent分组进行agent管理，也可以通过分组名称和标签过滤分组列表，当 Agent 分组的组织结构标签有多层结构时，可以勾选上层结构自动选中全部下属标签。Agent 共有7个可选权限：
* 分组管理读取：可以看到对应agent分组。在Agent管理->分组设置->Agent分组管理页可看到分组信息。另：只有当勾选了此权限，才可以勾选下述的其他六个权限。Agent是唯一有默认分组（_default_agent_group）的资源。
* 分组管理编辑：可以编辑分组的名字和描述。
* 分组管理删除：可以删除分组。
* 组内管理读取：可以读取此分组下对应的资源。比如agent分组\__default_agent_group__被勾选了，对应分组下的agent就可以被看到。只有此权限被勾选，下述三项权限才能被勾选。
* 组内管理编辑：可编辑对应agent。
* 组内管理删除：可删除对应agent。
* 组内管理转授：拥有此功能的用户，可以在角色授权页面把给agent分组授权给其他角色，否则不能被授权给其他角色。
=== 用户分组
在权限-用户分组中，可以看到当前系统中的用户分组设置情况，点击“新建”:
image::images/usergroup-new.png[]
用户分组页面分成五个部分：
* 分组名和描述：比如叫“数据使用者”。
* 成员：普通成员，默认情况下，普通用户不能编辑用户分组。
* 管理员：管理员默认授予\_group_admin_[用户分组名]_角色，可以增加或删除用户分组成员，对关联的\_group_default_[用户分组名]_角色有编辑授权权限。
* 角色：该用户分组拥有哪几个角色的资源权限及功能权限。最终会取这几个角色权限的并集。您可以选择上一节刚刚创建的新角色“只读”。
在用户分组列表上，点击"查看分组权限"，可以直接查看该分组关联和拥有的所有角色的权限集合。
=== 用户管理
点击"权限"-"用户管理"菜单可以看到当前系统内的所有用户列表，点击“新建”即可新建用户。
image::images/user-new.png[]
* 用户名：必填
* 全名：可选
* 邮箱：必填
* 电话号码：可选
* 密码：必填
* 用户分组：可选，下拉框展示当前用户能看到的用户分组。
* 角色：可选，下拉框展示当前用户能看到的角色，不包括关联的用户同名角色和关联的用户分组角色。
* 可管理角色：可选，勾选后用户将可以编辑选中角色的权限。
** 在新建/编辑用户时，只有拥有\__admin__角色的用户可以勾选用户对特定角色的授权管理。
** 默认情况下，普通用户对自己可见角色都不具有授权管理权限，除了用户关联的同名角色。
** \__admin__角色用户对所有角色都有授权管理权限。
* 附加信息：可选，可任意添加多个键值对，通常用于添加用户除邮箱和电话以外的其他联系方式。如：微信、钉钉、飞书等。
操作栏内“禁用”功能，可控制该用户的登录权限，致使被禁用的用户无法登录使用，另外，被禁用的用户曾经创建的资源，也无法在后端运行，因此“禁用”功能的使用也会影响含有该用户创建资源的其他页面，在对应资源的下方有“已禁用”的标记。
[NOTE]
====
除非目的是创建一个专门进行非数据类管理操作的独立用户，请注意检查分配给该用户及其所属用户分组的各角色是否至少授予了一个合适的索引及搜索权限。
====
==== 角色权限管理
举例说明角色权限管理功能：
新建用户"role-without-角色权限管理"，配置邮箱和密码，选择之前创建的角色"只读"(勾选功能权限中"可查看角色页")，设置可管理角色为无，使用该用户登录系统，进入角色权限页面，可看到操作列中没有"授权"功能。
image::images/juese-quanxian-guanli-without.png[]
新建用户"role-with-角色权限管理"，配置邮箱，密码和角色，选择之前创建的角色"只读"，可管理角色选择"只读"，使用该用户登录系统，进入角色权限页面，可看到操作列中存在"授权"功能，用户可以配置"只读"角色的权限。
image::images/juese-quanxian-guanli-with.png[]
另，新建用户默认拥有同名关联角色的角色权限管理功能，例如在用户列表页，点击用户"role-without-角色权限管理"的查看功能，或用户自行点击"用户"-"账户信息"菜单，可看到该用户所属角色，除了"只读"，还有新建用户时系统默认创建的角色\__user__和用户同名关联角色，用户对关联的同名角色有管理权限。
image::images/read-user-info-page.png[]
点击"修改信息"，进入用户修改信息页面("只读"角色勾选了功能权限中的"可查看用户页"和"可修改自己账户信息")，可以看到普通用户不能修改自己的邮箱、用户名、角色和可管理角色，只有拥有\__admin__角色的用户才能修改用户的角色和可管理角色。
image::images/edit-user-info-page.png[]
普通用户能修改的账户信息包括：全名、头像、电话号码、密码等。