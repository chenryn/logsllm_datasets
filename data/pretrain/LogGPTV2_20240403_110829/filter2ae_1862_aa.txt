**作者：Malayke  
本文为作者投稿，Seebug Paper 期待你的分享，凡经采用即有礼品相送！ 投稿邮箱：PI:EMAIL**
### 前言
由于工作原因一直都是网络空间搜索引擎重度用户，包括Shodan/ZoomEye/Censys/Fofa等平台都有过使用经验，甚至自己团队也尝试开发过类似平台。自认为还是非常了解的，在前面看过黑哥写的几篇文章后及国外研究者的一些文章后做了一些尝试，顺带也分享下多年使用搜索引擎的一些搜索套路，希望大家能喜欢，当然这个也是为了迎合下ZoomEye官方写文章送会员的活动
:)
不说废话了，步入正题：
### 1、Cobalt Strike
这个方法最早是在黑哥在medium上发布两篇文章介绍利用ZoomEye识别在野Cobalt
Strike服务器的文章[1][2]介绍的,因为文章是英文写的发布在medium上国内直接访问不到，所以这里再次简单介绍一下。在此之前我们需要提一下Fox-it的工作，是他们最早开始通过网络空间测绘技术去识别追踪在野Cobalt Strike的工作并在他们的blog上发布了对应的研究成果[3]，Cobalt
Strike提供的Web服务是基于NanoHTTPD开源框架开发的，而当时Fox-it工程师发现NanoHTTPD返回banner里存在一个异常的空格“bug”，然后通过这个异常的空格去识别。随后Cobalt
Strike官方在发布的3.13版本了对这个“bug”做了更新处理。
事实上我们不需要这个利用这个所谓的异常的空格“bug”，根据观察Cobalt
Strike的WEB服务返回http头存在比较明显的特征，由此来识别追踪Cobalt Strike。
首先我们看看Cobalt Strike版本小于3.13的，返回banner信息（直接复制的黑哥文章里的内容）
    ? curl http://x.x.x.x:8081/ -v
    - Rebuilt URL to: [http://x.x.x.x:8081/](http://x.x.x.x:8081/)
    - Trying x.x.x.x…
    - TCP_NODELAY set
    - Connected to x.x.x.x (x.x.x.x) port 8081 (#0)
    > GET / HTTP/1.1
    Host: x.x.x.x:8081
    User-Agent: curl/7.54.0
    Accept: /
     GET / HTTP/1.1
    Host: x.x.x.x:8001
    User-Agent: curl/7.54.0
    Accept: /
    It works!'
        ),
返回特征也很明显，于是尝试搜索：`"It works!"`
很明显这个结果误报太多，我猜MSF开发人员当时就是想模仿Apache的默认返回内容，所以我们还得回到Cobalt
Strike套路上，看看Metasploit Meterpreter http(s)上线模式WEB服务的返回头的信息：
    - Trying 0.0.0.0:1337...
    - TCP_NODELAY set
    - Connected to 0.0.0.0 port 1337 (#0)
    > GET / HTTP/1.1
    Host: 0.0.0.0:1337
    User-Agent: curl/7.68.0
    Accept: /
    - Mark bundle as not supporting multiuse
    It works!
在上面提到的国外研究员那篇文章[5]里提了一个特征：真正的Apache的默认返回页面的内容有一个额外的\n，而MSF的没有，于是通过Censys提供的body
hash规则进行匹配搜索[6],随机追踪了几个目标很显然这个方法存在很严重的误报。所以我们这里只能回归到ZoomEye的老套路上了，观察Metasploit
Meterpreter http(s)模式的WEB服务返回banner：