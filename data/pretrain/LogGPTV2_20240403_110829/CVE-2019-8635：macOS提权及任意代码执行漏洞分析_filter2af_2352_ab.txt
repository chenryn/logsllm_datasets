    frame #12: 0xffffff800a88d27d kernel.development`ipc_kobject_server(request=0xffffff80ab5c7400, option=) at ipc_kobject.c:359 [opt]
    frame #13: 0xffffff800a859465 kernel.development`ipc_kmsg_send(kmsg=0xffffff80ab5c7400, option=3, send_timeout=0) at ipc_kmsg.c:1832 [opt]
    frame #14: 0xffffff800a878a75 kernel.development`mach_msg_overwrite_trap(args=) at mach_msg.c:549 [opt]
    frame #15: 0xffffff800a9f63a3 kernel.development`mach_call_munger64(state=0xffffff80af471bc0) at bsd_i386.c:573 [opt]
    frame #16: 0xffffff800a823486 kernel.development`hndl_mach_scall64 + 22
当Mac系统出现内核错误（kernel panic）时，panic文本会被添加到日志中。[kernel
panic](https://developer.apple.com/library/archive/technotes/tn2063/_index.html)指的是内核检测到的系统错误，根源在于内核代码中没有对处理器异常进行处理（比如引用了无效的内存地址，或者调用链中出现错误，可以对比用户空间代码检测到的错误）。panic日志如下所示：
    panic(cpu 6 caller 0xffffff800aa1391c): Kernel trap at 0xffffff7f8d7adc37, type 14=page fault, registers:
    CR0: 0x0000000080010033, CR2: 0x0000000000000018, CR3: 0x0000000fea85f063, CR4: 0x00000000001626e0
    RAX: 0x0000000000000000, RBX: 0xffffff800b473e28, RCX: 0x00000000ffffffff, RDX: 0x0000000000000000
    RSP: 0xffffff8742023610, RBP: 0xffffff8742023610, RSI: 0xffffff80b0f8e470, RDI: 0xffffff80afa29300
    R8: 0x0000000000000229, R9: 0xffffff800b2c4d00, R10: 0xffffff800b2c2c70, R11: 0x0000000000000058
    R12: 0xffffff87299cb9b4, R13: 0x0000000000000001, R14: 0xffffff80b094e608, R15: 0xffffff80b094e000
    RFL: 0x0000000000010282, RIP: 0xffffff7f8d7adc37, CS: 0x0000000000000008, SS: 0x0000000000000010
    Fault CR2: 0x0000000000000018, Error code: 0x0000000000000002, Fault CPU: 0x6, PL: 0, VF: 0
与此同时，寄存器调试信息中关于kernel panic的信息如下所示。`$r12`寄存器指向的是共享内存地址`+ 16`，资源索引值也为`0x42`。
    (lldb) register read
    General Purpose Registers:
    rax = 0x0000000000000000
    rbx = 0xffffff800b473e28 kernel.development`kdebug_enable
    rcx = 0x00000000ffffffff
    rdx = 0x0000000000000000
    rdi = 0xffffff80afa29300
    rsi = 0xffffff80b0f8e470
    rbp = 0xffffff8742023610
    rsp = 0xffffff8742023610
    r8 = 0x0000000000000229
    r9 = 0xffffff800b2c4d00 kernel.development`zone_array + 8336
    r10 = 0xffffff800b2c2c70 kernel.development`zone_array
    r11 = 0x0000000000000058
    r12 = 0xffffff87299cb9b4
    r13 = 0x0000000000000001
    r14 = 0xffffff80b094e608
    r15 = 0xffffff80b094e000
    rip = 0xffffff7f8d7adc37 IOAcceleratorFamily2`IOAccelResource2::clientRelease(IOAccelShared2*) + 13
    rflags = 0x0000000000010282
    cs = 0x0000000000000008
    fs = 0x00000000ffff0000
    gs = 0x00000000afa20000
    (lldb) x/20g $r12
    0xffffff87299cb9b4: 0x00000364001a8c00 0x0000004200000042
    0xffffff87299cb9c4: 0x0000104000000101 0x0055550000900002
    0xffffff87299cb9d4: 0x0004000800040008 0x1048000000010001
    0xffffff87299cb9e4: 0x0055560000900002 0x0002000800020008
    0xffffff87299cb9f4: 0x0000000000010001 0x0000000000000000
    0xffffff87299cba04: 0x0000000400000004 0x0000000000000000
    0xffffff87299cba14: 0x0000000200000002 0x00000364001a8c00
    0xffffff87299cba24: 0x0000004200000042 0x0000104800000101
    0xffffff87299cba34: 0x0055560000900002 0x0002000800020008
    0xffffff87299cba44: 0x1050000000010001 0x0055570000900002
## 0x04 缓解措施
攻击者可以使用双重释放漏洞来攻击未打补丁的macOS系统，成功在目标主机上获取较高权限。Apple已推出安全补丁，改进内存处理机制来修复内存破坏问题。macOS
Mojave 10.14.4已经可以使用最新补丁，大家应当尽快[更新](https://support.apple.com/en-us/HT210119)系统。此外，大家也可以安装类似[Trend Micro Antivirus for
Mac](https://www.trendmicro.com/en_us/forHome/products/antivirus-for-mac.html)以及[Trend Micro Protection
Suites](https://www.trendmicro.com/en_us/business/products/user-protection.html)之类的解决方案来检测并阻止使用利用各种缺陷的攻击行为。