# OCR Output
## Page 1
作者：刘宇
Puppet实战
InfoQ软件开发丛书
Software Development Series
InfoQ
---
## Page 2
真正鹿死谁手，我们拭目以待。相信以后的市场竞争会越来越激烈。
1993 年“出生”的老牌系统配置管理工具 CFEngine 就花费了近7年时间。而 Puppet 与 Salt Stack
核心功能，相比 Puppet 来说有一定优势，但 SaltStack 的成长还需要我们耐心等待。Puppet 打败
具的遍地开花，Puppet 的商业化及各种开源社区的支持，Puppet 可谓是蒸蒸日上。
以弥补了 Puppet 在这方面的不足，可见 Puppetlabs 非常有远见。伴随着 Puppet 各子功能及扩展工
购了 MCollective，采用消息型总线的中间件来实现命令执行、系统管理、Puppet 客户端管理等，
命令需求而开发的，但Luke一再强调不建议使用。）
并不具备执行功能，因此在某些程度上存在短板，（比如éxec 是为解决特定系统管理员脚的执行
“三板斧”—资源、类、模板，可以轻松地帮我们完成复杂的业务逻辑关系管理。同时，Puppet
高效、便捷。这便是 Puppet诞生的背景和原因。
现有的工具已经无法满足他的工作需求，需要自己创造一个全新的工具，才能彻底使他的工作更加
以下简称Luke）曾经全面参与了重写 CFEngine 的解析器和开发 ISConf3 的工作，但是他还是觉得
员有效地解决繁重的工作。为什么还要选择 Puppet ？“需求决定产品”。Luke Kanies（Puppet 作者，
什么选择 Puppet？它有什么优势？当时 pssh、CFEngine 等都已经很成熟，并且也能帮助系统管理
自己的环境及需求进行选择。
秀开源软件快速完成自己的工作，让自己变得更轻松。但并不是所有的软件都适合你，你需要根据
为什么要写这本书
或许更多的系统管理员抱怨 Puppet 没有命令执行功能。Luke 早就考虑到了这一点，并提前收
Puppet 注重设计简洁、先框架后应用两个中心思想。这也造就了 Puppet 今日的成功，它的
Puppet 就是系统管理员的一把利器。几年前我开始学习 Puppet 的时候，不少朋友都问我：为
 在新兴的同类工具中，我的另一个关注点是 SaltStack，它天生具备命令执行和配置管理两大
子曰：“工欲善其事，必先利其器。”作为系统管理员，最应该具备的一种技能就是利用各种优
前
---
## Page 3
是如果你是一名初学者，请一定从第1章的基础理论知识开始学习。
的资深用户，能够理解 Puppet 的相关基础知识和工作原理，那么你可以直接阅读这部分内容。但
Zabbix，包括最为热门的云计算 OpenStack 的部署，使读者能快速掌握 Puppet 并运用到实践中。
模板、模块、节点、Facter、数组、函数、变量。结合不同实例让读者感觉理论知识不再那么枯燥。
解一些基础背景知识，并快速搭建测试环境。
如何阅读本书
读者对象
希望更多的系统管理员通过多阅读、多交流，建立起享受分享的技术氛围。
系统管理员为核心的书，希望能给读者带来的不只是技术能力提升，更多的是开源与奉献精神。也
例及代码详解以便使读者能够快速掌握 Puppet，并迅速将其运用到工作环境当中。通过这样一本以
至争斗。这也是我写作本书的初衷。
源，拥抱变化，通过学习Puppet，体会到与开源爱好者交流的乐趣，而不是为了工具选型而犹豫甚
弯路将工作中的经验和总结以实战形式呈现给大家。我也希望更多的人能加人开源社区，拥抱开
复杂而繁重的任务，而不是盲目地寻找问题，我觉得有必要结合自己在学习 Puppet 过程中走过的
其中第三部分以实战来讲解 Puppet 应用，相比于前两部分更加复杂。如果你是一名经验丰富
 第四部分为进阶篇（第14～ 20 章)，通过对 Puppet 扩展模式、版本控制、报告系统、控制台
 第三部分为实战篇（第11～13章)，从实战角度进行讲解，结合流行监控系统Nagios 和
第二部分为基础篇（第5～10 章)，着重讲解Puppet 的基础理论知识，包括语法、资源、类、
第一部分为准备篇（第1～4章)，简单地介绍了 Puppet 的发展历程和相关理论，帮助读者了
本书分为四大部分：
根据本书内容定位，适合阅读本书的读者有：
本书技术深人而阅读简单，涉及系统管理员所需的很多方面的基础知识，同时通过穿插各种实
为了让更多的系统管理员了解并深人学习 Puppet，可以利用 Puppet 的集成方案解决系统管理
口运维工程师
UNIX与 Linux系统管理员
Puppet 用户和爱好者
---
## Page 4
着信心和力量！
辑，在这一年多的时间中始终帮我校对并支持我的写作，你的鼓励和帮助引导我顺利完成全部书稿。
时间，阅读了本书的样稿并写下推荐和评论。
致谢
会在此公共平台定期发布 Puppet 相关信息。
待能够得到你们的真挚反馈。同样你也可以关注我为本书建立的微信公共平台（puppetchina），我
见，也欢迎发送邮件至邮箱 liuyu105#gmail.com（sed‘s/#/@/g'），标题请注明《Puppet 实战》，
个站点下载。同时我也会将相应的功能更新在这个站点上及时发布出来。如果你有更多的宝贵意
通过访问该站点的Q&A页面提交给我。书中的全部源文件除可以从华章网站下载外，还可以从这
案的站点 http://puppet.bubbyroom.com。你可以将书中的错误以及遇到的有关 Puppet 的任何问题，
请读者批评指正。为此，我特意在博客（http://liuyu.github.io）的基础上开辟了在线支持与应急方
勘误和支持
最后感谢我的笨笨，
感谢机械工业出版社华章公司的编辑杨福川，是你的引导才促使我完成这本书。特别感谢姜影编
感谢为本书撰写的童剑先生、窦哲先生、田逸先生、程辉先生，感谢你们在繁忙的工作中抽出
首先要感谢伟大的 Puppet 作者 LukeKanies，
由于作者的水平有限，加之编写时间仓促，书中难免会出现一些错误或者不准确的地方，恳
谨以此书献给我即将出生的 Baby，以及众多热爱 Puppet 的朋友们！
特别感谢刘长元、王广胜、吴问志、刘继伟、王哲，感谢你们对本书提出的宝贵修改意见。
参见华章网站www.hzbook.com.
，一如既往地支持我写作，给予我无尽的支持与灵感，并时时刻刻为我灌输
编辑注
，他开发了一款影响我整个人生的软件。
刘宇(守住每一天)
于中国北京
---
## Page 5
第1章认识 Puppet..
前
目
1.3Pupet的作用和特色......
1.2
4
Puppet 工作原理...
Puppet 组织结构...
1.3.3管理任何机器·
1.3.1
1.2.2
1.2.1
为什么要使用Puppet....
1.3.2
1.2.3
1.1.5Puppet 3.0 新特性...
1.1.4
1.1.2
言
.5.3
1.5.2
1.1.3
第一部分
Puppet是如何工作的.....8
录
为什么要有自己的语言.··
都有谁在使用Puppet...
为什么是Ruby...
常见集中化管理工具对比.
命令差异...
版本语言特征.·.
Puppet 起源与发展...
准备篇
9
C
第2章Puppet 安装与配置...
2.5在MacOSX下安妆.......25
2.1Puppet 对各系统平台的支持....18
2.4
2.2
1.7本章小结··
1.6Puppet 核心配置文件详解-
2.5.1通过二进制发布包进行
2.4.4通过Gems 进行安装....
2.4.3
2.4.2
2.4.1包管理器方式安装..
在 Linux下安装....
Puppet 的安装步骤...
1.6.6文件系统配置文件.….16
1.6.5
1.6.4
1.6.3
1.6.2
1.6.1
1.5.6安全与认证..
1.5.5详细交互过程..
从源代码进行安装.23
报告系统配置·.
认证与安全配置文件.14
主配置文件 puppet.conf....l1
从 Git 版本库进行安装..24
客户端自动认证配置.·..16
主机配置文件site.p......1.3
...........11
....16
2
---
## Page 6
第5章Puppet语法与命令详解...50
第4章 
第3章
5.1Puppet 的命名规范..
4.4
4.2
4.1
3.6
3.1酉
2.9
2.8
2.7
2.6
本章小结·.
5.1.2
5.1.1资源...
本章小结···.
如何运用环境配置·.
客户端配置·.
服务器端配置··
增加 httpd 模块·
查看运行结果.·.
客户端运行配置·.
检测你的配置文件.·
配置一个测试节点·
本章小结·
如何升级··
2.7.3
2.7.2
2.7.1
在Windows下安装与使用.......
2.5.3
2.5.2
Puppet 运行环境..
创建你的第一个 Puppet
配置.….
第二部分
Puppet 在 Windows 下 的
包管理器方式安装.
从Ports 仓库进行安装.....27
在Windows 下使用 Puppet··33
从 Git 版本库进行安装....26
基础篇
: 48
..36
.31
28
第6章 
6.1
5.7
5.6
5.5
5.4
5.3
5.2
什么是资源.….
本章小结.·.
6.1.2
6.1.1图解核心资源...81
5.6.3模块和不常用命令..75
5.6.2
Puppet 命令详解...
5.5.2代码调试..
检查命令的用法·.
5.4.6.......
5.4.5
5.4.4
5.4.2
5.4.1间距、缩进和空白字符.
Puppet 语法风格...
5.4.3
5.3.3
5.3.2
5.3.1
资源、
5.2.3
5.2.2
5.2.1
主机、
5.1.5
5.1.4
5.1.3
什.是manifest..81
资源...
变量、参数和标签的命名.54
类的命名.….
模块的命名.·
主机的命名..·.
模块和类的命名.·.
节
模
类
·.................
................
+..................
...........78
+.........
3
8
9
9
9
19
9
9
S
S
VII
---
## Page 7
VIII
6.6表达式.
6.5
6.4Puppet 作用域与变量..
6.8
6.7
6.3
6.2
6.8.3
6.6.6
6.6.5
6.6.4
6.6.3
6.6.2
6.6.1
6.5.3selector 选择器...
6.5.2case 语句.....
6.5.1
条件语·.
6.4.2
6.4.1
6.3.8调试与输出.
6.3.7
6.3.6
6.3.5
6.3.4
6.3.3
6.3.2
6.3.1
常用资源的用.法..8.7
6.2.2
6.2.1
6.1.3
什么是表达式.….
if语句·
算术运算符….
操作顺序...
运用位置·.
作用域….
布尔运算符.
比较运算符·
变量..
执行命令
定时脚本