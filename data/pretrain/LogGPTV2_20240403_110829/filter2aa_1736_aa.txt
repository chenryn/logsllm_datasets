ElcomSoft.com
ElcomSoft.com
© 2017
Vladimir Katalov
ElcomSoft Co.Ltd.
Moscow, Russia
Breaking)into)the)iCloud)Keychain
ElcomSoft.com
Page 2
[Some)of])our)customers
ElcomSoft.com
Page 3
What)do)we)want)to)hack)today?
1.All)user’s)passwords
2.Credit)card)data
ElcomSoft.com
Page 4
What’s)inside)the)smartphone?
(tip:&almost&everything)
• Contacts)&)calendars
• Call)logs)and)text)messages)
• Emails)and)chats
• Account'and'application'passwords
• Web'and'Wi-Fi'passwords
• Credit'card'data
• Documents,)settings)and)databases
• Web)history)&)searches
• Pictures)and)videos
• Geolocation)history,)routes)and)places
• 3rd party)app)data
• Cached)internet)data
• System)and)application)logs
• Social)network)activities
ElcomSoft.com
§
Problems
§
Different&platforms&(Apple,&Google,&Microsoft)
§
Many&vendor-specific&clouds
§
3rd party&cloud&services
§
Credentials&needed&(password&or&token)
§
Profits
§
No&physical&access&needed
§
May&be&performed&silently
§
Backup
§
No)standard)way)to)get
§
Might)not)be)available
§
Almost)all)data)from)device
§
Sync
§
Limited)set)of)data
§
Most)critical)real-time)data
§
Synced)across)all)devices
§
Storage
§
Only)files/documents
§
Easy)to)access
Page 5
Data)acqusition methods)|)Cloud)acquisition)pros)and)cons
§
JTAG/chip-off
§
No)test)access)port)on)many)devices
§
Full)disk)encryption
§
Physical
§
Limited)compatibility
§
Data)may)be)encrypted
§
Logical
§
Limited)compatibility
§
Bypassing)screen)lock)is)needed
§
Cloud
§
Limited)set)of)data)// oh,$really?$J
§
Need)credentials
§
Legal)problems
ElcomSoft.com
§ Full)device)backups)are)sometimes)available
§ 3rd party)application)data)is)usually)not)available
§ Passwords)are)additionally)encrypted)with)hardware-specific key
§ Daily)backups)(in)best)case,)until)forced)from)the)device)
§ Backups)cannot)be)forced)remotely
§ 3rd party)software)is)needed
§ Almost)no)way)to)manage
§ Slow)access,)long)download
§ Account)might)be)locked)due)to)‘suspicious)activity’
Page 6
Cloud)services:)backups)[iCloud]
ElcomSoft.com
Page 7
Cloud)services:)synced)data)[iCloud]
§
Contacts
§
Call'log
§
Messages)(SMS/iMessage,)CallKit-compatible)apps)
§
Calendars
§
Mail)(only)cloud-based)
§
Internet)activities)(visited)sites,)searches)
§
Media)files)(photos,)videos)
§
Gaming)data
§
Passwords
§
Health)data
§
Credit'cards
Other
•
ApplePay
•
Home)devices
•
Wallet
•
Maps)(searches,)bookmarks,)routes)
•
Books
•
News,)weather
•
Location&data
ElcomSoft.com
Page 8
More)iCloud)data
•
Account)information
•
iCloud)storage)information
•
Contact)information)(billing/shipping)address,)
emails,)credit)cards)(last)4)digits)
•
Connected)devices
•
Customer)service)records
•
iTunes)(purchase/download)transactions)and)
connections,)update/re-download)connections,)
Match)connections,)gift)cards)
•
Retail)and)online)store)transactions
•
Mail)logs
•
Family)sharing)data
•
iMessage and)FaceTime)metadata
•
Deleted&data?
ElcomSoft.com
Page 9
Apple)keychains
§
iOS'keychain
§
Local)(encrypted)backup)
§
Local)(not)encrypted)backup)
§
iCloud
View&(iOS&10):&Settings&|&Safari&|&Passwords,&AutoFill
View&(iOS&11):&Settings&|&Accounts&&&Passwords&|&App&&&Website&Passwords
Protection:&it&depends
Decrypt/export:&no&way&(3rd party&software&only)
§
OS'X'(macOS)'keychain
View:&Keychain&utility&(one&by&one)
Protection:&password&(by&default,&same&as&log&on)
Decrypt/export:&3rd party&software&only
§
iCloud'keychain
View:&Only&when/if&synced&with&local&device
Protection:&well,&strong&J
Decrypt/export:&?
ElcomSoft.com
Page 10
Backup)vs iCloud)keychains
Backup
iCloud
Wi-Fi
+
+
Web)sites
+
+
Credit)cards
+
+
App-specific
+
It&depends
AirPlay/AirPort
+
+
Encryption)keys)&)tokens
+
It&depends
Autocomplete
+
-
Keychain&in&iCloud&backups&have&most&data&encrypted&with&device-specific&key&
ElcomSoft.com
Page 11
iOS)keychain)– passwords)(Wi-Fi,)email,)web)form)
AirPort)(AP'name)
AirPort
AP'name
AP'password
apple
20121231120800.529226Z)))))))
20121231120800.529226Z)))))))
CLASS:)7
accounts.google.com)(email)))))))))
accounts.google.com)
email
password
HTTPS
form
Web)form)password
com.apple.cfnetwork
20150705071047.78112Z
20150805133813.889686Z))))))))
accounts.google.com)(email)
CLASS:)6
imap.gmail.com)(PI:EMAIL))
imap.gmail.com
email
password
IMAP
143
apple
20121231124745.097385Z
20121231124745.097385Z
CLASS:)7
ElcomSoft.com
Page 12
iOS)keychain)(credit)card)data)
SafariCreditCardEntries (BBA00CB1-9DFA-4964-B6B8-3F155D88D794)
SafariCreditCardEntries
BBA00CB1-9DFA-4964-B6B8-3F155D88D794
NAME
DATE
Visa
NUMBER
This)keychain)item)is)used)by)Safari)to)automatically)fill)credit)card)information)in)web)forms.
com.apple.safari.credit-cards
20131016100432.283795Z
20150826181627.118539Z
Safari)Credit)Card)Entry:)Visa
CLASS:)6
ElcomSoft.com
Page 13
iOS)[backup])keychain)protection)classes
k​Sec​Attr​Accessible​After​First​Unlock)(7)
The)data)in)the)keychain)item)cannot)be)accessed)after)a)restart)until)the)device)has)been)unlocked)once)by)the)user.
k​Sec​Attr​Accessible​After​First​Unlock​This​Device​Only)(10)
The)data)in)the)keychain)item)cannot)be)accessed)after)a)restart)until)the)device)has)been)unlocked)once)by)the)user.
k​Sec​Attr​Accessible​Always)(8)
The)data)in)the)keychain)item)can)always)be)accessed)regardless)of)whether)the)device)is)locked.
k​Sec​Attr​Accessible​When​Passcode​Set​This​Device​Only
The)data)in)the)keychain)can)only)be)accessed)when)the)device)is)unlocked.)Only)available)if)a)passcode)is)set)on)the)device.
k​Sec​Attr​Accessible​Always​This​Device​Only)(11)
The)data)in)the)keychain)item)can)always)be)accessed)regardless)of)whether)the)device)is)locked.
k​Sec​Attr​Accessible​When​Unlocked)(6)
The)data)in)the)keychain)item)can)be)accessed)only)while)the)device)is)unlocked)by)the)user.
k​Sec​Attr​Accessible​When​Unlocked​This​Device​Only)(9)
The)data)in)the)keychain)item)can)be)accessed)only)while)the)device)is)unlocked)by)the)user.
• xxxThisDeviceOnly:)encrypted)using)device-specific)hardware)key))(can)be)extracted)from)32-bit)devices)only)
• All)others:)in)password-protected)local)backups,)encrypted)with)the)key)derived)from)backup)password
ElcomSoft.com
Page 14
iTunes)backup)password)breaking
§
Get)manifest.plist
§
Get)BackupKeyBag
§
Check)password
§
iOS)3
▫
pbkdf2_sha1(2,000)
§
iOS)4)to)10.1)(but)10.0)
▫
Same)as)above,)but)10,000)iterations
§
iOS)10.0
▫
Same)as)above)works
▫
Single&sha256&hash&is&also&stored
§
iOS)10.2+
▫
pbkdf2_sha256(10,000,000)
▫
pbkdf2_sha1(10,000)
§
Unwrap)AES)key)from)KeyBag
§
Decrypt)keychain)(+other)files?)
Hashes'are'salted,'so'no'rainbow'tables'L
ElcomSoft.com
Page 15
macOS keychain
ElcomSoft.com
Page 16
iCloud)data)protection
https://support.apple.com/en-us/HT202303
Most)of)the)data:)A&minimum&of&128-bit&AES&encryption
iCloud)Keychain:)Uses&256-bit&AES&encryption&to&store&and&transmit&passwords&and&credit&card&information.&Also&uses&elliptic&
curve&asymmetric&cryptography&and&key&wrapping.
Key'is'stored'along'with'the'data'(except'just'the'iCloud'keychain)!
•
Notification)to)email)when)the)data)is)accessed
•
Account)might)be)blocked)due)to)suspicious)activity)(new!)
•
Two-step)verification)(legacy,)not)recommended)
•
Two-factor'authentication
•
Immediate)push)notification)to)all)trusted)devices
•
Have)to)allow)access
•
Security)code