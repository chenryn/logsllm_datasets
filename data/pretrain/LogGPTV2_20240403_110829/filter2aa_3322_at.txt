为提高攻击成功率，通过对目标企业员工的分析，攻击队决定向
财务部门以及几个与财务相关的部门群发邮件。
攻击队发送了一批邮件，有好几个企业员工都被骗，打开了附
件。控制了更多的主机，继而便控制了更多的邮箱。在钓鱼邮件的制
作过程中，攻击队灵活根据目标的角色和特点来构造。譬如在查看邮
件过程中，发现如下邮件：
尊敬的各位领导和同事，发现钓鱼邮件事件，内部定义为19626事
件，请大家注意后缀为.exe、.bat等的邮件附件。
攻击队同样采用浑水摸鱼的策略，利用以上邮件为母本，以假乱
真地构造以下邮件继续钓鱼：
尊敬的各位领导和同事，近期发现大量钓鱼邮件，以下为检测程
序……
附件：检测程序.zip
通过不断地获取更多的邮箱权限、系统权限，根据目标角色针对
性地设计钓鱼邮件，攻击队最终成功拿下目标。
5.3 偷梁换柱：冒充客户，突破边界
某大型设备制造企业具有比较成熟的互联网服务经验。在本次实
战攻防演练中，攻击队的目标是获取该企业的一个核心业务管控平台
的控制权限。
攻击队在前期的情报搜集工作中发现，该企业内部的网络防御体
系比较健全，正面突破比较困难。经过头脑风暴，大家达成共识——
通过社工方法迂回入侵。
（1）寻找社工突破口
攻击队首先想到的社工方法也是最常见的邮件钓鱼。但考虑到该
企业相对完善的网络防御体系，猜测其内网中很可能已经部署了邮件
检测类的防御手段，简单地使用邮件钓鱼，很有可能会被发现。
进一步的情报搜集发现，该企业使用了微信客服平台，而且微信
客服平台支持实时聊天和发送文件。考虑到客服人员一般没有很强的
技术功底，安全意识相对薄弱，攻击队最终商定：将社工对象确定为
微信客服人员，并以投诉为话题尝试对客服人员进行钓鱼（见图5-
1）。
图5-1 冒充客户
（2）冒充客户反馈问题
于是，一名攻击队队员开始冒充客户，在该企业的微信客服平台
上留言投诉，并要求客服人员接收名为“证据视频录像”的压缩文件
包。该压缩包实际上是攻击队精心伪造的带有木马程序的文件包。让
攻击队意想不到的是，该客服人员以安全为由，果断拒绝接收来源不
明的文件。显然，攻击队低估了该企业客服人员的安全素养。
（3）社工升级攻破心理防线
不过，攻击队并没有放弃，而是进一步采用多人协作的方式，对
当班客服人员进行了轮番轰炸，要求客服人员报上工号，并威胁将要
对其客服质量进行投诉。经过1个多小时的拉锯战，客服人员的心理防
线被攻破，最终接收了带毒压缩包，并打开了木马文件。该客服人员
的终端设备最终被控制。
以受控终端为据点，攻击队成功打入该企业的内网，后又利用一
个未能及时修复的系统漏洞获取到关键设备的控制权限，再结合从内
网搜集到的信息，最终成功获取到管控平台的权限。
5.4 声东击西：混淆流量，躲避侦察
某关键行业大型国有企业，配备了较强的网络安全团队进行安全
防护。在本次实战攻防演练中，攻击队的目标是获取该企业工控系统
等核心平台的控制权限。
在有红队（防守方）参与的实战攻防工作，尤其是有红队排名或
通报机制的工作中，红队与蓝队通常会发生对抗。IP封堵与绕过、WAF
拦截与绕过、Webshell查杀与免杀，红蓝之间通常会展开没有硝烟的
战争。
（1）激烈攻防，难以立足
蓝队创建的跳板几个小时内就被阻断了，上传的Webshell过不了
几个小时就被查杀了。蓝队打到哪儿，红队就根据流量威胁审计跟到
哪儿，不厌其烦，蓝队始终在目标的外围打转。
（2）分析系统，制订方案
没有一个可以维持的据点，就没办法进一步开展内网突破。蓝队
开展了一次头脑风暴，归纳和分析流量威胁审计的天然弱点，以及红
队有可能出现的人员数量及技术能力不足等情况，并制定了一套声东
击西的攻击方案。
具体方法是：找到多个具有直接获取权限漏洞的系统，正面用大
流量进攻某个系统，吸引火力，侧面尽量减少流量直接获取权限并快
速突破内网。
蓝队通过信息搜集找到目标企业的某个外网Web应用，并通过代码
审计开展漏洞挖掘工作，发现多个严重的漏洞；另外还找到该企业的
一个营销网站，通过开展黑盒测试，发现该网站存在文件上传漏洞。
（3）兵分两路，声东击西
蓝队兵分两路：除队长外的所有成员主攻营销网站，准备了许多
分属不同IP网段的跳板，不在乎是否被发现，也不在乎是否封堵，甚
至连漏洞扫描器都用上了，力求对流量威胁分析系统开启一场规模浩
大的“分布式拒绝服务”，让红队的防守人员忙于分析和应对；而队
长则悄无声息地用不同的IP和浏览器指纹特征对Web应用开展渗透，力
求用最少的流量拿下服务器，让威胁数据淹没在营销网站的攻击洪水
当中（见图5-2）。
图5-2 流量数据混淆WAF穿透的主要手段
通过这样的攻击方案，蓝队同时拿下营销网站和Web应用。在营销
网站上的动作更多，包括关闭杀软、提权、安置后门程序、批量进行
内网扫描等众多敏感操作；同时在Web应用上利用营销网站上获得的内
网信息，直接建立据点，开展内网渗透操作。
（4）隐秘渗透，拿下权限
很快红队就将营销网站下线了，并开始根据流量开展分析、溯源
和加固工作；而此时蓝队已经在Web应用上搭建了FRP Socks代理，通
过内网横向渗透拿下多台服务器，使用了多种协议木马，并备份了多
个通道稳固权限，以防被红队发现或直接踢出局。接下来的几天服务
器权限再未丢失，蓝队继续后渗透，拿下域管理员、域控制器，最终
拿下目标权限——工控系统等核心平台的控制权限。
在渗透工作收尾的后期，蓝队通过目标企业安全信息中心的员工
邮件看到，红队此时依旧在对营销网站产生的数据报警进行分析和上
报防守战果等工作，然而该企业的目标系统早已被蓝队拿下了。
5.5 迂回曲折：供应链定点攻击
某超大型企业在实战攻防演练中，攻击队的目标是获取该企业内
部系统的安全管控权限。
攻击队通过前期的情报搜集和摸排后发现，该企业的办公网络及
核心工业控制系统有非常严密的安全防护，对互联网暴露的业务系统
较少，而且业务系统做了安全加固及多层防护，同时拥有较强的日常
网络安全运维保障能力。想要正面突破，非常困难。
前期情报分析还显示，该企业虽然规模大、人员多，但并不具备
独立的IT系统研发和运维能力，其核心IT系统的建设和运维实际上大
多来自外部采购或外包服务。于是，根据这一特点，攻击队制定了从
供应链入手的整体攻击策略。
（1）寻找目标供应商
攻击队首先通过检索“喜报”“中标”“签约”“合作”“验
收”等关键词，在全网范围内，对该企业的供应商及商业合作伙伴进
行地毯式排查，最终选定将该企业的专用即时通信系统开发商A公司作
为主要攻击目标。
情报显示，A公司为该企业开发的专用即时通信系统刚刚完成。攻
击队推测该系统目前尚处于测试阶段，A公司应该有交付和运维人员长
期驻场为该企业提供运维全服务。要是能拿下驻场人员的终端设备，
就可以进入该公司的内网系统。
（2）盗取管理员账号
分析发现，A公司开发的即时通信系统其公司内部也在使用，而该
系统的网络服务管理后台存在一个已知的系统安全漏洞。攻击队利用
该漏洞获取了服务器的控制权，并通过访问服务器的数据库系统，获
取了后台管理员的账号和密码。
（3）定位驻场人员
攻击队使用管理员的账号和密码登录服务器后，发现该系统的聊
天记录在服务器上是准明文（低强度加密或变换）存储的，而且管理
员可以不受限制地翻阅其公司内部的历史聊天记录。
攻击队对聊天记录进行关键字检索后发现：A公司有3名员工的聊
天记录中多次出现目标企业名、OA、运维等字眼，并且这3名员工的登
录IP经常落在目标企业的专属网段上。攻击队由此断定，这3名员工就
是A公司在目标企业的驻场人员。
（4）定向恶意升级包
攻击队最初的设想是，通过被控的即时通信软件服务器，向3名驻
场人员定向发送恶意升级包。但这种攻击方法需要修改服务器系统配
置，稍有不慎就可能扩大攻击面，给演练工作造成不必要的损失，同
时也有可能暴露自身的攻击活动。
为实现对3名驻场人员进行更加隐蔽的定向攻击，攻击队对A公司
的即时通信系统进行了更加深入的安全分析，发现其客户端软件对服
务器的身份安全验证、对升级包的合法性校验机制都存在设计缺陷。
于是，攻击队利用上述缺陷，通过中间人攻击对服务器推送给3名
驻场人员的客户端软件升级包进行了劫持和篡改。最终，3名驻场人员
都在没有任何感知的情况下，在各自的PC上安装了攻击队伪装设计的
恶意升级包。
（5）横向拓展
攻击队以驻场人员的运维机作为跳板机进入内网后，开始横向拓
展。
攻击队首先找到了该企业的一台域控服务器，并利用一个最新曝
出的域控系统安全漏洞，获取了该主域的域账号和密码的哈希信息。
但防守队很快发现了此次攻击，并对该域控服务器进行了隔离。
不过，攻击队并没有放弃，又在内网中找到了一套终端安全管理
系统。攻击队经过现场挖掘，找到了该系统的一个新的0day漏洞，并
利用该漏洞获取了管理员权限。在登录管理系统后台后，攻击方可下
发和执行任意命令，能够控制该安全管理系统所辖范围内的所有终端
设备。