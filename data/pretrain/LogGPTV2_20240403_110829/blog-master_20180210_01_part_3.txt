 32 | 10099491 | 500129108.718979 |  84 | 999999914 | 5051049432345352  
 81 | 10106622 | 499963749.199852 | 229 | 999999944 | 5052944626865710  
 34 | 10099359 | 500111032.921868 |  52 | 999999836 | 5050800861338764  
 85 | 10103461 | 499947692.923157 |  18 | 999999904 | 5051202017489091  
 37 | 10099584 | 500057275.745026 | 104 | 999999849 | 5050370461198054  
 69 | 10097014 | 500143184.435491 |  91 | 999999720 | 5049952735249734  
 52 | 10101573 | 500040171.388144 | 355 | 999999932 | 5051192294209851  
 76 | 10101689 | 499896977.810699 | 438 | 999999843 | 5049803801883577  
 35 | 10099622 | 500114054.898034 |  44 | 999999747 | 5050962911357394  
 65 | 10103111 |  499851261.81228 |  48 | 999999726 | 5050052781579531  
 31 | 10099277 | 499845188.908577 | 112 | 999999838 | 5048075019905046  
 51 | 10099397 | 499984737.203741 |  65 | 999999933 | 5049544354961246  
 57 | 10103823 | 500008680.942373 | 100 | 999999925 | 5051999210705205  
 19 | 10102592 | 500036435.174349 |  81 | 999999939 | 5051664089700899  
 33 | 10096464 | 500058135.753455 |  66 | 999999773 | 5048818965541870  
  0 |  5048622 |  500110433.47565 | 263 | 999999912 | 2524868536874701  
 50 | 10099019 | 500071716.158314 | 177 | 999999894 | 5050233762845416  
 89 | 10102886 | 499906895.352583 |  21 | 999999941 | 5050502374361080  
 66 | 10100455 | 500019718.104865 |  11 | 999999889 | 5050426661830877  
 17 | 10099749 | 500020536.906571 | 125 | 999999900 | 5050081917601604  
 14 | 10097995 | 499872474.436678 |  50 | 999999887 | 5047709747499202  
 67 | 10105426 | 500125756.387578 | 245 | 999999866 | 5053983821868692  
 87 | 10100597 | 499967794.215203 |  14 | 999999907 | 5049973202346696  
 96 | 10099064 | 499905578.187197 | 243 | 999999892 | 5048578428069509  
 61 | 10100503 | 500007920.183475 |  28 | 999999903 | 5050331497836948  
  3 | 10101198 | 499940146.381583 |  30 | 999999883 | 5049994406749350  
 39 | 10098880 | 500243255.820608 |  32 | 999999920 | 5051896611341620  
 11 | 10101799 | 500096301.902747 | 129 | 999999916 | 5051872322464871  
 43 | 10107301 |  500040498.08918 | 163 | 999999842 | 5054059826377266  
  5 | 10100558 | 499863342.325278 |  31 | 999999940 | 5048898681230323  
 75 | 10101250 | 500037496.222365 |  63 | 999999928 | 5051003758716163  
 97 | 10103503 | 500029746.921376 | 123 | 999999921 | 5052052048109365  
 21 | 10102929 | 500098408.485223 | 446 | 999999926 | 5052458713939206  
 93 | 10105004 | 499972842.513604 |  25 | 999999852 | 5052227573491343  
 60 | 10105650 | 499950744.869079 | 209 | 999999873 | 5052327244886207  
 27 | 10102588 | 499797776.872304 |  41 | 999999858 | 5049251023056813  
 45 | 10100466 | 499847713.021728 |  38 | 999999841 | 5048694830553717  
 70 | 10103640 | 500126978.162685 | 238 | 999999801 | 5053102941643626  
 91 | 10102311 |    499764530.032 |   1 | 999999950 | 5048776709152101  
 22 | 10099804 | 500243130.452219 | 250 | 999999867 | 5052357569913843  
 49 | 10099635 | 500022230.537738 |  19 | 999999896 | 5050042020317004  
 13 | 10100454 | 499986238.143486 |  53 | 999999646 | 5050087999001322  
 86 | 10099751 |  499991374.31582 |   7 | 999999782 | 5049788382737577  
 26 | 10105606 | 500021405.572664 |   6 | 999999938 | 5053019316283545  
  1 | 10095409 | 500001476.917716 | 206 | 999999776 | 5047719410088402  
 58 | 10099972 | 499913934.276812 |  35 | 999999792 | 5049116738605642  
 25 | 10104666 | 500031883.894369 | 137 | 999999510 | 5052655176103381  
 82 | 10101286 | 499966805.257835 |  10 | 999999534 | 5050307690415695  
 44 | 10104380 | 499990027.500454 |   9 | 999999872 | 5052089234075034  
 20 | 10100166 | 500033955.063915 | 130 | 999999908 | 5050425951782085  
 23 | 10099118 | 500033099.525857 |  58 | 999999918 | 5049893276017372  
 92 | 10097628 | 499985682.503551 |  79 | 999999951 | 5048669427246965  
 62 | 10098974 |  500002801.70268 |  33 | 999999765 | 5049515294322520  
 53 | 10104969 | 500071097.824301 |   5 | 999999948 | 5053202941310532  
 56 | 10099521 |  499829373.88272 | 157 | 999999902 | 5048037257945384  
 40 | 10098880 |  500118160.98974 | 202 | 999999731 | 5050633293656069  
 73 | 10102325 | 499981690.451386 |  62 | 999999809 | 5050977530989301  
 95 | 10102589 | 499885307.442653 |  74 | 999999770 | 5050135808231760  
 30 | 10097653 | 499985894.883754 | 127 | 999999861 | 5048684071430626  
  4 | 10094812 | 499884810.734528 |  37 | 999999815 | 5046243186020638  
 77 | 10097737 | 500019227.640071 |  34 | 999999751 | 5049062655652572  
 15 | 10100451 | 499990119.574357 |  86 | 999999946 | 5050125703244929  
 94 | 10097423 | 500030504.883845 | 102 | 999999930 | 5049019520715746  
 36 | 10097433 | 499910715.309699 |  60 | 999999952 | 5047814953821765  
 83 | 10097518 | 499986390.218504 |   8 | 999999777 | 5048621574986367  
 28 | 10102778 | 499892202.902798 | 147 | 999999929 | 5050299949857921  
 48 | 10095113 | 500116265.596128 | 171 | 999999942 | 5048730214330929  
 99 |  5051395 | 499818438.433132 |  39 | 999999936 | 2524780360808931  
 46 | 10101708 | 499972043.149036 |  24 | 999999878 | 5050571588054961  
 47 | 10106118 | 500030970.343216 |  29 | 999999844 | 5053371989943041  
 54 | 10096312 |  500084305.08323 |  77 | 999999934 | 5049007170423474  
 16 | 10104458 | 500003081.506687 |  36 | 999999800 | 5052260136954892  
 80 | 10102160 | 499846266.993651 |  54 | 999999945 | 5049526964572583  
  8 | 10103060 | 500007130.726843 | 136 | 999999891 | 5051602042161142  
(100 rows)  
Time: 1972.137 ms (00:01.972)  
```  
7、CPU资源使用  
```  
top - 16:27:44 up 30 days, 21:15,  2 users,  load average: 7.49, 6.21, 6.41  
Tasks: 522 total,  58 running, 464 sleeping,   0 stopped,   0 zombie  
%Cpu(s): 99.9 us,  0.1 sy,  0.0 ni,  0.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st  
KiB Mem : 23094336+total,  7251336 free,  7786940 used, 21590508+buff/cache  
KiB Swap:        0 total,        0 free,        0 used. 10075729+avail Mem  
```  
### 普通单表10亿，HASH并行聚合  
1、普通表并行聚合。  
```  
create unlogged table c(id int, c1 int);  
insert into c select * from a;  
```  
2、空间占用，34GB  
```  
postgres=# \dt+ c  
                   List of relations  
 Schema | Name | Type  |  Owner   | Size  | Description   
--------+------+-------+----------+-------+-------------  
 public | c    | table | postgres | 34 GB |   
(1 row)  
```  
3、并行度设置  
```  
set max_parallel_workers_per_gather =56;  
set min_parallel_table_scan_size =0;  
set min_parallel_index_scan_size =0;  
set parallel_tuple_cost =0;  
set parallel_setup_cost =0;  
alter table c set (parallel_workers =56);  
explain select c1, count(*), avg(id), min(id), max(id), sum(id) from c group by c1;  
postgres=# explain select c1, count(*), avg(id), min(id), max(id), sum(id) from c group by c1;  
                                          QUERY PLAN                                             
-----------------------------------------------------------------------------------------------  
 Finalize GroupAggregate  (cost=4871557.23..4871656.48 rows=100 width=60)  
   Group Key: c1  
   ->  Sort  (cost=4871557.23..4871571.23 rows=5600 width=60)  
         Sort Key: c1  
         ->  Gather  (cost=4871207.60..4871208.60 rows=5600 width=60)  
               Workers Planned: 56  
               ->  Partial HashAggregate  (cost=4871207.60..4871208.60 rows=100 width=60)  
                     Group Key: c1  
                     ->  Parallel Seq Scan on c  (cost=0.00..4603350.44 rows=17857144 width=8)  
(9 rows)  
```  
4、聚合耗时，11.6秒  
```  
select c1, count(*), avg(id), min(id), max(id), sum(id) from c group by c1;  
postgres=# select c1, count(*), avg(id), min(id), max(id), sum(id) from c group by c1;  
 c1 |  count   |        avg         | min |    max    |       sum          
----+----------+--------------------+-----+-----------+------------------  
  0 |  5048622 | 500110433.47564959 | 263 | 999999912 | 2524868536874701  
  1 | 10095409 | 500001476.91771596 | 206 | 999999776 | 5047719410088402  
  2 | 10098707 | 500027259.27800460 | 119 | 999999881 | 5049628783461600  
  3 | 10101198 | 499940146.38158266 |  30 | 999999883 | 5049994406749350  
  4 | 10094812 | 499884810.73452760 |  37 | 999999815 | 5046243186020638  
  5 | 10100558 | 499863342.32527777 |  31 | 999999940 | 5048898681230323  
  6 | 10104713 | 500020892.34122681 |  20 | 999999943 | 5052567611111995  
  7 | 10104223 | 500196670.66755019 |  13 | 999999922 | 5054098704282486  
  8 | 10103060 | 500007130.72684335 | 136 | 999999891 | 5051602042161142  
  9 | 10104341 | 499996733.66047128 |  23 | 999999915 | 5052137495791580  
 10 | 10095854 | 500035390.09690958 |  17 | 999999719 | 5048284293251445  
 11 | 10101799 | 500096301.90274732 | 129 | 999999916 | 5051872322464871  
 12 | 10105025 | 499832509.13203431 | 109 | 999999799 | 5050820000591935  
 13 | 10100454 | 499986238.14348563 |  53 | 999999646 | 5050087999001322  
 14 | 10097995 | 499872474.43667797 |  50 | 999999887 | 5047709747499202  
 15 | 10100451 | 499990119.57435653 |  86 | 999999946 | 5050125703244929  
 16 | 10104458 | 500003081.50668665 |  36 | 999999800 | 5052260136954892  
 17 | 10099749 | 500020536.90657104 | 125 | 999999900 | 5050081917601604  
 18 | 10101977 | 499926956.66766832 |   4 | 999999897 | 5050250617936782  
 19 | 10102592 | 500036435.17434922 |  81 | 999999939 | 5051664089700899  
 20 | 10100166 | 500033955.06391529 | 130 | 999999908 | 5050425951782085  
 21 | 10102929 | 500098408.48522305 | 446 | 999999926 | 5052458713939206  
 22 | 10099804 | 500243130.45221897 | 250 | 999999867 | 5052357569913843  
 23 | 10099118 | 500033099.52585681 |  58 | 999999918 | 5049893276017372  
 24 | 10099982 | 499936812.84723993 | 190 | 999999901 | 5049352810894492  
 25 | 10104666 | 500031883.89436929 | 137 | 999999510 | 5052655176103381  
 26 | 10105606 | 500021405.57266383 |   6 | 999999938 | 5053019316283545  
 27 | 10102588 | 499797776.87230371 |  41 | 999999858 | 5049251023056813  
 28 | 10102778 | 499892202.90279773 | 147 | 999999929 | 5050299949857921  
 29 | 10101931 | 500172863.74100823 |  16 | 999999911 | 5052711757584067  
 30 | 10097653 | 499985894.88375427 | 127 | 999999861 | 5048684071430626  
 31 | 10099277 | 499845188.90857692 | 112 | 999999838 | 5048075019905046  
 32 | 10099491 | 500129108.71897920 |  84 | 999999914 | 5051049432345352  
 33 | 10096464 | 500058135.75345487 |  66 | 999999773 | 5048818965541870  
 34 | 10099359 | 500111032.92186801 |  52 | 999999836 | 5050800861338764  
 35 | 10099622 | 500114054.89803420 |  44 | 999999747 | 5050962911357394  
 36 | 10097433 | 499910715.30969950 |  60 | 999999952 | 5047814953821765  
 37 | 10099584 | 500057275.74502613 | 104 | 999999849 | 5050370461198054  
 38 | 10103601 | 499961610.60292751 |  89 | 999999949 | 5051412628849349  
 39 | 10098880 | 500243255.82060783 |  32 | 999999920 | 5051896611341620  
 40 | 10098880 | 500118160.98974035 | 202 | 999999731 | 5050633293656069  
 41 | 10098079 | 500105983.31279751 |  75 | 999999899 | 5050109727865311  
 42 | 10101533 | 500126553.67012868 |  12 | 999999865 | 5052044886075076  
 43 | 10107301 | 500040498.08917989 | 163 | 999999842 | 5054059826377266  
 44 | 10104380 | 499990027.50045366 |   9 | 999999872 | 5052089234075034  
 45 | 10100466 | 499847713.02172761 |  38 | 999999841 | 5048694830553717  