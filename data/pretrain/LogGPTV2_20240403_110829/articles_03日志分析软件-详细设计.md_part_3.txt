可以在累积百分比反向查询中选择某个数值型字段后，输入查询数值，点击查询，即可获得查询结果。
（10）多级统计
多级统计可以满足针对某一字段的多重统计需求。多级统计最多支持三级。每次统计结果出现后都可以选择进行下一步统计或展现统计图。
2.  []{#_Toc464246734 .anchor}**功能架构**
![](media/image4.emf)
## 日志管理
**(1)标签（Tag）**
在上传日志时添加标签可对日志分组和过滤提供重要帮助，这是用户可以在数据来源端进行设置的日志元数据，包含在上传到日志分析软件的每条事件中。
**(2)时间戳**
当日志被某个事件触发，时间戳作为日志事件的一部分表明事件是何时发生的。在日志分析软件中时间戳的作用非常重要，我们使用时间戳来过滤搜索结果，同时也使用时间戳确定用户账户下的哪些日志超出保存期限需要清除。
这些概念非常简单，关于处理时间戳的相关问题：
时间戳取决于发送的日志数据类型，时间戳将按以下顺序优先处理：
**(3)日志分组**
日志分组功能：利用主机名、应用名、标签三项内容的任意组合，定义搜索范围和授权不同用户的日志访问范围。被限定范围的用户只能在限定范围内执行查询。
用户可以使用日志分组来区分研发，测试和生产等不同类型的日志。
**(4)日志备份管理**
为了将保存之前的索引数据。日志分析软件提供备份管理功能。
日志分析软件提供固定的归档目录，用户可自行选择备份的带宽占用，备份数据可在需要时进行恢复。
## 用户管理
每个账户可以创建不限数量的多个用户，每个用户根据被授予的不同权限获得不同的角色。
**(1)用户权限**
用户可以在账户中创建新用户，在日志分析软件账户下有三种用户角色：超级管理员（owner）、管理员（admin）和普通用户（user）。三种角色的定义、权限和使用限制如下：
  --------------------------------------------------------------------------
                           超级管理员    管理员            普通用户
  ------------------------ ------------- ----------------- -----------------
  添加/编辑其他用户        x             x                 
  批准/撤销管理权限        x             x                 
  保存搜索                 x             x                 x
  建立或编辑告警           x             x                 x
  覆盖其他用户保存的搜索   x             x                 x
  建立日志分组             x             x                 x
  编辑其他用户的日志分组   x             x                 x
  --------------------------------------------------------------------------
限制普通用户访问日志的范围
当用户添加或编辑新的普通用户时，用户可以选择在账户包含的日志中划定一个子集作为新用户的搜索范围，具体实现方式是在"日志分组"中选定一个或多个分组。
## 日志搜索
搜索的四种方式包括范围查询、正则表达式、NOT/AND/OR布尔值和字段过滤。
范围查询：可快速发现满足一定条件参数的事件，例如检索Apache
Web服务器响应时间大于200ms的事件。
正则表达式：可以定义查询模版来简化你的搜索输入，假如你有一批名为app01-app99机器，如果你只想搜索前30台，你可以输入"/app\[0-2\]\[0-9\]/"
来简化搜索输入。
AND/OR/NOT布尔值：利用AND、OR、NOT和(
)的组合，用户可以自由构造各种复杂的组合查询语句。
字段过滤：字段过滤快速显示用户所有结构化/半结构化特殊字段的统计聚合，点击其中的字段值进行过滤操作，可快速缩小事件的查询范围。
**(1)字段过滤**
> 点击一个字段将出现二级菜单显示该字段出现次数最多的五十个值及它们的统计计数，鼠标滚动会显示该字段的所有值。如果用户想要过滤搜索结果，单击字段值即可。用户会在搜索框下方看到过滤图标显示。如果用户从一个字段中选择多个值进行过滤，先点击复选再勾选相应的值，过滤结果将显示包含任一值的事件（同一字段的多个值是OR的关系）；如果用户选择的是不同字段中的值，那么过滤出的事件则必须同时包括两个值（不同字段的值是AND的关系）。
>
> 一旦选择字段过滤，搜索结果及直方图都将更新。为了看到字段过滤效果，添加一个字段过滤代替一个搜索查询。在前面的截图中，字段过滤![tag](media/image5.jpeg){width="1.53125in"
> height="0.2708333333333333in"}相当于一个搜索查询：
![tag](media/image6.jpeg){width="5.4375in"
height="0.3854166666666667in"}
删除字段过滤，可以选择点击左侧面板的对应值，也可以直接点击搜索框下方字段过滤框的删除符号。
**(2)搜索语法**
**全文检索**
检索一个或多个查询词时，系统不区分大小写。如果查询多个关键字，则不区分这些词的先后顺序，且查询结果将同时包含这些词。例如
hello world
相当于
hello AND world
即日志结果中必须包含 hello 与 world。
**短语查询**
如果需要查询短语（即短语内的多个词都必须都出现，而且保持同样的顺序及相邻状况），需要用双引号把短语括起来，查询结果不区分大小写。例如查询"hello
world"，匹配的日志也必须包含"hello world"。
**字段值**
格式 field:value
field是字段名，应当为字符串，搜索时区分大小写字母，不得使用?
\*等字符；value可以是字符串或数值，字符串区分大小写字母，可以使用?
\*等字符。此用法也可在界面左栏的字段值处点击建立字段过滤。例如
tag:test
匹配 tag 字段值为 \"test\" 的日志；
apache.status:200
匹配 apache.status 字段值为200的日志；
apache.stauts:\*
匹配带 apache.status 字段的日志；
apache.clientip:192.168.1.1\*
匹配 apache.clientip 为 192.168.1.1，192.168.1.103，192.168.1.114
等值的日志。
**逻辑运算符**
AND，OR，NOT，( )，AND、OR、NOT 必须大写。
term1 AND term2
匹配的日志里 term1 和 term2 都必须都出现，AND 默认可缺省；
term1 OR term2
匹配的日志里 term1 或 term2 出现1个即可；
NOT term
匹配的日志里不含有 term；
由于 AND 的优先级比 OR 高，可用（）改变运算优先级，例如：
term1 AND (term2 OR term3)
表示匹配的日志里必须包含 term1，以及term2、term3中的任一个。
**数值范围**
格式
field:\[value1 TO value2\]
field:{value1 TO value2}
field:{value1 TO value2\]
field:\[value1 TO value2}
field:\>value
field:\>=value
field:\400
匹配 apache.status 值大于400的日志。
**通配符**
\* 匹配0个或多个字符，单独搜索 \* 会显示所有日志；？匹配1个字符。例如：
syslog.appName:abc\*
syslog.appName:ab?
都会匹配 syslog.appName 为 abc 的日志
tag:mytag\*
匹配 tag 为 mytag 或 mytag1的日志
tag:mytag?
匹配 tag 为 mytag1 的日志，但 无法匹配 tag 为 mytag 的日志。
**基本正则表达式**
格式 /regexp/, 支持\[ \] (范围), {n} (出现n次), {n,m} (出现n次到m次),
{n,} (至少出现n次) 等基本正则表达式。 例如
/\[wb\]all/
匹配包含 wall 或 ball 的日志
/0{4,}/
匹配包含0000的日志
/frontend\[0-9\]{2}/
匹配 frontend 后面带有2位数字的日志。
**特殊字符的检索处理**
只有字母、数字和字符检索时会匹配在事件日志。特殊字符+ -- \| \| !（）{ }
\[ \] \^ \" \~ \*？：\\
等不应包括在查询语句的一部分来匹配，如果你在搜索时有上述特殊字符请务必使用引号括起来。例如，这两个搜索将显示相同的结果：
例1：
\"http://yourwebsite.com:9000\"
例2：
\"http yourwebsite com 9000\"
下面这个搜索将导致一个无效的查询，由于 : 没有被\"\"括起来引用:
http://yourwebsite.com:9000
**区分大小写**
日志分析软件在搜索时除以下情况情况区分大小写之外，其他情况不区分大小写：
字段名称（字段值不区分大小写）
数值范围TO
逻辑运算符AND/OR/NOT
**时间方案**
使用下拉菜单快速挑选预设时间方案或设置一个自定义的时间范围。
预设时间方案：分钟（近10分钟、30分钟）、小时（近1小时、3小时、6小时和12小时）、天（近1天、2天、7天）默认近10分钟；
自定义时间范围：选择起至的年/日/月/小时/分钟/秒/毫秒范围，日志如果超出保存时间将不会显示搜索结果。
**(3)保存搜索**
> 当通过搜索得到有价值的数据，保存搜索可以方便后续直接使用，同时也方便帐户中的其他用户。
>
> 保存搜索并周期性运行是日志分析软件提供的快速分析日志的有效方法，通过搜索特定情况下的日志可以精确定位问题，及时发现信息异常。
**(4)高级搜索**
命令行功能
提供如下三个基本命令，在一定约束条件下可以组合使用。
**eval**
eval在原有日志中添加一个新的field，新字段将根据已有字段进行逻辑运算生成，如通过算术运算、字符串运算等方式。
命令行格式：
eval field=eval_func(field_list)
**支持运算符（按照优先级由低到高排列）**
1）\|\|（逻辑或）操作数必须为布尔类型
2）&& （逻辑与） 操作数必须为布尔类型
3）\| （位操作或）操作符必须为整数
4）\^ （位操作异或）操作符必须为整数
5）& （位操作与）操作符必须为整数
6）!=, ==
7\) \>=，\>，\<=，\<
8\) +，- 算术加减，支持数值类型，+另支持字符串
9）\*，/，% 算术乘，除，余，支持整数类型
10\) \~（位操作符非），!（逻辑操作符非） \~仅支持整数，!仅支持布尔类型
括号的支持
支持()，小括号
\**支持函数 \**
  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  函数名     含义                                                                 使用方法
  ---------- -------------------------------------------------------------------- ----------------------------------------------------------------------------------------
  empty      判断某个field是否为空                                                empty(field)\
                                                                                  field: 带检查字段名\
                                                                                  如果存在返回false，否则返回true\
                                                                                  比如：empty(apache.status)