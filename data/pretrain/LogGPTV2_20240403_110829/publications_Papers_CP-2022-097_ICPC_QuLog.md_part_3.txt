thedefaultPythonlogginglibraryusesthetag”𝑤𝑎𝑟𝑛𝑖𝑛𝑔”.Tothat
end,thepreparationsubmoduleunifiesthelevelsforallloginstruc-
3.1 LogInstructionPreprocessing
tions.Tothestatictextoftheloginstruction,weapplySpacy[23]
Thepurposeoftheloginstructionpreprocessingistwofold.First,it forpreprocessing.Wesplitthewordsusingspaceandcamelcases.
extractstheloginstructionsfromthesourcefiles.Second,itparses Wepreprocessthestatictextbyfollowingtextpreprocessingtech-
theloginstructionstoseparatethestatictextandtheloglevel niques,including:removeallASCIIspecialcharacters,removing
fromtheremaininginstructionparts.Inaddition,thestatictextis stopwordsfromtheSpacyEnglishdictionaryandapplyinglower
processedbythelinguisticfeaturesextractor,toobtainitslinguistic casetransformationofthewords[8].Onceprocessed,wegivethe
structurerepresentation.Theseoperationsareperformedbytwo statictextasinputtoapre-trainedPOStaggingmodelfromSpacy.
modules,namely(1)loginstructionextractorand(2)loginstruction Weextractthe𝑝𝑜𝑠tagofeachwordfromthestatictexttocreateits
preparation,describedinthefollowing. linguisticstructure.Finally,theoutputofthepreparationmodule
isasetoftuples,whereeachtupleiscomposedofthestatictext
3.1.1 LogInstructionExtractor. Theextractormoduleextractsthe oftheloginstruction,thelinguisticstructureofthestatictextand
loginstructionsfromthesourcecodeofthesoftwaresystem.To theloglevel.
thatend,ititeratesoverallofthesourcefilesinthetargetsoftware’s
sourcecodeandappliesregularexpressionstofindallloginstruc-
3.2 DeepLearningFramework
tions.Consideringthediversityoftheprogramminglanguages,
developerswritingstyles,andthelackofadoptionofloggingprac- 3.2.1 OverallArchitecture. QuLoghastwoindependentneuralnet-
ticeschallengestheextractionprocess.Theoutputoftheextraction workstoassessthetwoqualityproperties.Theysharethesame
moduleisasetofloginstructionsoftheinputsoftwaresystem. architecturaldesignandarecomposedofembeddinglayer,encoder
Althoughourgoalistohelpdevelopersinwritingcorrectloglev- networkfromTransformerarchitecture[45]andoutputlayer.To
els,werestrainourselvesonthreelevels("info","warning",and makethedescriptioneasytofollow,weexplaintheworkingprin-
"error").Theloglevels"trace"and"debug"providedetailedinfor- ciple for the log level assignment. Alongside it, in parenthesis,
mationfortheinnerworkings,mostcommonlyusedbydevelopers. wegivethemappingforsufficientlinguisticstructureassessment.
Bystudyingthen-gramsfrequencyforindividualloglevels,we Giventhepreprocessedstatictext(linguisticstructure)attheinput,
foundthatthereisalargeoverlapbetweentheusedvocabulary theembeddinglayerlearnsnumericalvectorrepresentationofthe
in"info"and"trace"/"debug"levels.Thiscansignificantlyimpair individualwords(linguisticcategories),wereferredtoastokens,
theperformanceofthedata-drivenmethodswhenautomatically followingadistributedlearningrepresentationparadigm[43].The
assessingthequalityofallloglevelssimultaneously.Inaddition, vectorembeddingsofthetokensarenumericalfeaturesinasuit-
relatedworkreportsthisscenariopracticallyusefulwhendifferent ablelearningformatforthenetwork.Wethenusetheencoderof
stakeholdersexaminelogs.Forexample,operatorscaremorefor theTransformerarchitecturetolearnrelationshipsbetweenthe
thehighseveritylevels(i.e.,"info","warning","error")[34]. vectorembeddingsoftheinputtokensfromtheembeddinglayer
ICPC2022,May21–22,2022,Pittsburgh,PA,USA Bogatinovski,etal.
andtheloglevels(sufficient/insufficientlinguisticstructure).The
Log Instruction:log.info(“connection established!”) log.error(“connection refused!”)
outputfromtheencoderlayerisavectorembeddingofthestatic Shapley Values connection: (1.21, 0.41, -0.12, 0.14) connection: (0.21, -0.20, 0.42, 0.56)
text(linguisticstructure).Afterthat,theoutputlayerpredictslog (for class info): established: (2.12, 2.34, 3.01, 0.12) refused: (0.12, 2.30, 3.42, -5.22)
level(sufficient/insufficientlinguisticstructure)fromtheencoder Token Importance connection 𝑟11= 1.34; 𝑒11=+ connection 𝑟21= 0.76; 𝑒21=+
layer’soutput. Scores: established 𝑟12= 4.36; 𝑒12=+ refused 𝑟22=6.65; 𝑒22=−
3.2.2 Embedding Layer. The embedding layer receives the pre- Figure3:PredictionExplainerworkingprocedureexample
processedinstructionsasinput.Wefirsttransformthestatictext
(linguisticstructure)fromasequenceofwordstoasequenceof
insufficient).Weapplyasoftmaxfunctionattheoutputneurons
tokens/indices.Figure2givesanexampleofthistransformation.
toproducescoreestimates.Eachneurongivesascoreestimatefor
Itenablesthetransitionfromtextualintoanumericalformatasa
thecorrespondingclass(i.e.,anumberbetween0-1indicatingclass
prerequisitetoapplyingneuralnetworks.Wefurtherprependthe
relevanceforthegiveninput).Thescoresgiveinsightsintothe
tokenizedstatictext/(linguisticstructure)withaspecialtokenwe
model’sconfidencefortheloglevel(sufficientlinguisticstructure)
refertoasLogMessageToken([LMT]).Notethatthisisanimpor-
prediction.Asaclassprediction,weconsideredtheclassrelatedto
tantdetailwediscussfurtherwhendescribingtheneuralnetworks.
theneuronwiththehighestscore.
Sincethestatictextscanbeofdifferentlengths,whiletheneural
networkrequiresfixed-sizeinput,wespecifyahyperparameter
3.3 PredictionExplainer
𝑚𝑎𝑥_𝑙𝑒𝑛tounifythelengths.Theshorterstatictexts(linguistic
structures)areappendedwithaspecialpadtoken([PD]),whilethe Thepredictionexplaineraimstoexplainwhyatrainedmodelmakes
longeronesaretruncatedat𝑚𝑎𝑥_𝑙𝑒𝑛value.Theembeddinglayer certainpredictions.ItaugmentsQuLog’soutputbypointingout
mapstheinputtokensintoanumericalvectorrepresentation,such thespecifictokensmostlikelycontributingtotheprediction.They
thateachuniquetokenisassignedaspecificvector.InQuLog,these canserveassuggestionstodevelopersforwherethestatictext
embeddingsarelearnedduringtraining,andthevectorembeddings potentiallycanbealtered.Therelevantdetailsoftheexplanation
areadjustedtopreservecontextualproperties(e.g.,frequentlyco- modulearegiveninthefollowing.
occurringwordsforacertainloglevel).Thesevectorscanalsobe 3.3.1 SHAP. PredictionexplainerleveragesSHAP[37](Shapley
obtainedfromgeneral-purposelanguagemodels(e.g.,BERT[12]). additiveexplanations)–anapproachfromexplainableartificial
intelligence.Ingeneral,SHAPcalculatesfeatureimportancescores
3.2.3 TransformerNeuralNetwork. Wemodelthedependencies
(howrelevantisafeaturefortheprediction)bydefiningtheproblem
betweenthetokensandthetwoqualitypropertieswithnonlinear
asacoalitionalgamebetweenthefeatures.Thegoalistofindthe
parametricfunctionsrepresentedasneuralnetworks.Asasuitable
so-called Shapley values for each feature defined as the fairest
architecture, we identified the encoder of the Transformer [45]
distributionofthe"payout"(asimportancescore)fortheprediction.
architecture.Itprovidesstate-of-the-artresultsinmanyNLPtasks
Thelargerthevalue,themoreimportantisthefeaturetowards
(e.g.,sentimentanalysis,translation)[4].Bypointingtothesimi-
theprediction.ThesignsoftheShapleyvaluesshowthefeature’s
laritiesbetweenthestatictextoflogsandnaturallanguage[22],
predictionfavorableness(ornon-favorablenessfornegativesign).
wefurtherjustifyourdesignofchoice.Theencoderimplements
amulti-headself-attentionmechanismthatexploitshigher-order 3.3.2 Implementation. WeusedtheoriginalSHAPimplementa-
relationsbetweentokenswithinthestatictext(beyondn-gram tionwiththedefaultvaluesforitsparameters[36].Onerequired
counting).Thispropertycapturesdiscriminativefeaturesbetween parameterofSHAPisadifferentiablelearningmodel(amodelwith
thewords(linguisticconcepts)andthedifferentcontextstheyap- gradientscalculatedforeachnetworklayer).ToapplySHAP,we
pearin,relatingthemtotheappropriateloglevels(sufficientlin- usedthetrainedencodernetworkasinput.Whiletheexplanation
guisticstructures).Duringtraining,thetokenembeddingvectors procedureisapplicableforbothqualityproperties,wedescribed
andthenetworkparametersareupdatedviabackpropagation[35]. justtheloglevelpredictionexplainerbecauseoftheintuitivemean-
Attheoutputoftheencoder,weprovidethevectorembeddingof ingoftheimportancescoresconcerningthepredictions.
the[LMT]token.Duetothearchitecturaldesign,thevectorofthe
[LMT]tokenattendsoveralltheothertokenvectorembeddings 3.3.3 TokenImportanceScores. TheShapelyvaluesarecalculated
foreachneuronoftheinputvectorembeddings.Figure3illustrates
duringtraining.Thisallowssummarizingthemostrelevantinfor-
arunningexample.Therearetwologinstructions𝑙1:"Connection
mationfromtheinputconcerningtheloglevel(sufficientlinguistic
established!"withthelevel"info",and𝑙2 :"Connectionrefused!"
structure).Therefore,itembedsdiversecontextspreservingthe
withthelevel"error".Afterrunningthetwoinstructionsthrough
propertiesofthestatictext(linguisticstructure).Thenumberof
SHAP,eachtokenisassignedwithavectorofShapleyvalues(with
headsinthemulti-headself-attention,thenumberoflayersand
modelsizearethreehyperparametersofthenetwork. size𝑑 = 4).However,toreasonabouttheinfluenceofthetoken
inunity,weexpressthetokenimportanceasasinglenumber.We
3.2.4 OutputLayer. Theoutputlayerisathree-dimensionallinear refer to this as a token importance score. To calculate the token
layerforpredictingtheloglevel(two-dimensionalforsufficient importancescore,weaggregatetheindividualShapelyvaluesfor
linguisticstructure).Itacceptsthe[LMT]vectorembeddingand eachtoken.Thetokenimportancescorehastwoparts:1)intensity
applies a linear transformation. Each of the output dimensions and2)sign.Theintensityshowstheinfluencestrengthofthetoken
correspondstooneoftheloglevels(i.e.,"info","warning","error") fortheprediction.Thesignshowsthetokendirectioninfluence
oroneofthetwolinguisticstructuresqualities(i.e.,sufficientand fortheprediction(favouringornot-favouringadecision).After
QuLog:Data-DrivenApproachforLogInstructionQualityAssessment ICPC2022,May21–22,2022,Pittsburgh,PA,USA
experimentationwithdifferentaggregationfunctions,wefindthat correctpredictionsoutofalltrueclasspredictions.F1isthehar-
thesecondnormoftheShapelyvaluevectorandthesignofthe monicmeanoftheprecisionandrecallevaluatingthetrade-off
Shapleyvaluewiththehighestabsolutescore,aresuitableforin- betweencorrectclasspredictionsandthemiss-classifications[17].
tensityandsignaggregationfunctions.Formally,theyaregivenin Additionally,weconsideredspecificityinthebinaryclassification
Eq.1andEq.2. setting.Itisthemeasureofcorrectpredictionsofthenegativeclass.
𝑟(𝑡 𝑗𝑖)=||𝑆 𝑗𝑖(𝑡 𝑗𝑖)||2 (1) T hih ge ha erfo vr ae ln ua em ined dicc ari tt ee sri ba et ta tek re pv ea rl fu oe rs mw anit ch ei .n Tt hh ee e0 v- a1 lur aa tn ig oe n, oa fn td ha
2 e
𝑒(𝑡 𝑗𝑖)=𝑠𝑖𝑔𝑛[max|𝑆 𝑗𝑖𝑘(𝑡 𝑗𝑖)|] (2) predictionexplainerisdonewiththe𝑒𝑟𝑟𝑜𝑟@𝑘score.Itmeasures
𝑘 thenumberofincorrectpredictionswhenk-degreesoffreedomare
where𝑟(𝑡 𝑗𝑖)isthetoken(𝑡 𝑖)importancescoreintensity,𝑒(𝑡 𝑗𝑖)is considered[24].Thesmallervaluesindicatedbetterperformance.
thetokenimportancesignfortheloginstruction𝑙 𝑗.𝑆 𝑗𝑖𝑘 denotes WeadditionallyconsideredtheAUC [19]score.AUC isthearea
theShapelyvalueforthe"𝑘-th"positionofthe"𝑖-th"tokenofthe undertheROC(receiveroperatingcharacteristic)curvethatplots
loginstructionstatictext(i.e.,intheexamplethetoken"refused" thetruepositiveagainstthefalse-positiverates.Itisboundedin
hasaShapelyvalue𝑆224=−5.22). the0-1range,withahighvalueindicatingbetterperformance.The
In the example, the difference between the two instructions AUCvalueof0.5indicatesamodelperformingnotbetterthana
distinguishingthelevels"info"from"error"isinthesecondtoken. randomguess.
WefirstcalculatetheindividualShapelyvaluesandthencalculate
theintensityandsignofthetokenimportancescores.Asseenby 4.2 LogLevelAssignmentEvaluation
thescorevalues,thefollowinginequalitieshold𝑟12 > 𝑟11,𝑟22 >
WefirstevaluatetheperformanceofQuLogontheloglevelqual-
𝑟21. The second token in both of the instructions ("established",
ityassessment.Wesplitthisevaluationintotwoparts.First,we
"refused")hasgreaterintensitycomparedtothefirst("connection"),
compareQuLogagainstbaselines.Second,weevaluateQuLog’s
thereby,contributingmoretothemodelprediction.Additionally,
performanceonafewinstancesoftheproblemofloglevelassign-
thetokensignsshowthatthetoken"established"isfavourablefor
ment.Themotivationforthisevaluationtypeononesideisto
theclass"info"(𝑒12=+),whilethetoken"refused"isnot-favourable
examinetheperformanceofQuLogagainstbaselines,andonthe
fortheclass"info"(𝑒22 = −).Therefore,ifthereisadiscrepancy otherside,toidentifyprobleminstanceswheretheinheritedim-
betweenthedevelopers’decisionontheloglevelandQuLog’slog
perfectperformanceofdata-drivenapproacheswillnotoverwhelm
levelassignment,thedeveloperexaminesthehighlightedword,