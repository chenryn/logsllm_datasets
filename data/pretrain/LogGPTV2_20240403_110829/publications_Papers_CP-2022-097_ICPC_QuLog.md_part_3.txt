thedefaultPythonlogginglibraryusesthetagâ€ğ‘¤ğ‘ğ‘Ÿğ‘›ğ‘–ğ‘›ğ‘”â€.Tothat
end,thepreparationsubmoduleunifiesthelevelsforallloginstruc-
3.1 LogInstructionPreprocessing
tions.Tothestatictextoftheloginstruction,weapplySpacy[23]
Thepurposeoftheloginstructionpreprocessingistwofold.First,it forpreprocessing.Wesplitthewordsusingspaceandcamelcases.
extractstheloginstructionsfromthesourcefiles.Second,itparses Wepreprocessthestatictextbyfollowingtextpreprocessingtech-
theloginstructionstoseparatethestatictextandtheloglevel niques,including:removeallASCIIspecialcharacters,removing
fromtheremaininginstructionparts.Inaddition,thestatictextis stopwordsfromtheSpacyEnglishdictionaryandapplyinglower
processedbythelinguisticfeaturesextractor,toobtainitslinguistic casetransformationofthewords[8].Onceprocessed,wegivethe
structurerepresentation.Theseoperationsareperformedbytwo statictextasinputtoapre-trainedPOStaggingmodelfromSpacy.
modules,namely(1)loginstructionextractorand(2)loginstruction Weextracttheğ‘ğ‘œğ‘ tagofeachwordfromthestatictexttocreateits
preparation,describedinthefollowing. linguisticstructure.Finally,theoutputofthepreparationmodule
isasetoftuples,whereeachtupleiscomposedofthestatictext
3.1.1 LogInstructionExtractor. Theextractormoduleextractsthe oftheloginstruction,thelinguisticstructureofthestatictextand
loginstructionsfromthesourcecodeofthesoftwaresystem.To theloglevel.
thatend,ititeratesoverallofthesourcefilesinthetargetsoftwareâ€™s
sourcecodeandappliesregularexpressionstofindallloginstruc-
3.2 DeepLearningFramework
tions.Consideringthediversityoftheprogramminglanguages,
developerswritingstyles,andthelackofadoptionofloggingprac- 3.2.1 OverallArchitecture. QuLoghastwoindependentneuralnet-
ticeschallengestheextractionprocess.Theoutputoftheextraction workstoassessthetwoqualityproperties.Theysharethesame
moduleisasetofloginstructionsoftheinputsoftwaresystem. architecturaldesignandarecomposedofembeddinglayer,encoder
Althoughourgoalistohelpdevelopersinwritingcorrectloglev- networkfromTransformerarchitecture[45]andoutputlayer.To
els,werestrainourselvesonthreelevels("info","warning",and makethedescriptioneasytofollow,weexplaintheworkingprin-
"error").Theloglevels"trace"and"debug"providedetailedinfor- ciple for the log level assignment. Alongside it, in parenthesis,
mationfortheinnerworkings,mostcommonlyusedbydevelopers. wegivethemappingforsufficientlinguisticstructureassessment.
Bystudyingthen-gramsfrequencyforindividualloglevels,we Giventhepreprocessedstatictext(linguisticstructure)attheinput,
foundthatthereisalargeoverlapbetweentheusedvocabulary theembeddinglayerlearnsnumericalvectorrepresentationofthe
in"info"and"trace"/"debug"levels.Thiscansignificantlyimpair individualwords(linguisticcategories),wereferredtoastokens,
theperformanceofthedata-drivenmethodswhenautomatically followingadistributedlearningrepresentationparadigm[43].The
assessingthequalityofallloglevelssimultaneously.Inaddition, vectorembeddingsofthetokensarenumericalfeaturesinasuit-
relatedworkreportsthisscenariopracticallyusefulwhendifferent ablelearningformatforthenetwork.Wethenusetheencoderof
stakeholdersexaminelogs.Forexample,operatorscaremorefor theTransformerarchitecturetolearnrelationshipsbetweenthe
thehighseveritylevels(i.e.,"info","warning","error")[34]. vectorembeddingsoftheinputtokensfromtheembeddinglayer
ICPC2022,May21â€“22,2022,Pittsburgh,PA,USA Bogatinovski,etal.
andtheloglevels(sufficient/insufficientlinguisticstructure).The
Log Instruction:log.info(â€œconnection established!â€) log.error(â€œconnection refused!â€)
outputfromtheencoderlayerisavectorembeddingofthestatic Shapley Values connection: (1.21, 0.41, -0.12, 0.14) connection: (0.21, -0.20, 0.42, 0.56)
text(linguisticstructure).Afterthat,theoutputlayerpredictslog (for class info): established: (2.12, 2.34, 3.01, 0.12) refused: (0.12, 2.30, 3.42, -5.22)
level(sufficient/insufficientlinguisticstructure)fromtheencoder Token Importance connection ğ‘Ÿ11= 1.34; ğ‘’11=+ connection ğ‘Ÿ21= 0.76; ğ‘’21=+
layerâ€™soutput. Scores: established ğ‘Ÿ12= 4.36; ğ‘’12=+ refused ğ‘Ÿ22=6.65; ğ‘’22=âˆ’
3.2.2 Embedding Layer. The embedding layer receives the pre- Figure3:PredictionExplainerworkingprocedureexample
processedinstructionsasinput.Wefirsttransformthestatictext
(linguisticstructure)fromasequenceofwordstoasequenceof
insufficient).Weapplyasoftmaxfunctionattheoutputneurons
tokens/indices.Figure2givesanexampleofthistransformation.
toproducescoreestimates.Eachneurongivesascoreestimatefor
Itenablesthetransitionfromtextualintoanumericalformatasa
thecorrespondingclass(i.e.,anumberbetween0-1indicatingclass
prerequisitetoapplyingneuralnetworks.Wefurtherprependthe
relevanceforthegiveninput).Thescoresgiveinsightsintothe
tokenizedstatictext/(linguisticstructure)withaspecialtokenwe
modelâ€™sconfidencefortheloglevel(sufficientlinguisticstructure)
refertoasLogMessageToken([LMT]).Notethatthisisanimpor-
prediction.Asaclassprediction,weconsideredtheclassrelatedto
tantdetailwediscussfurtherwhendescribingtheneuralnetworks.
theneuronwiththehighestscore.
Sincethestatictextscanbeofdifferentlengths,whiletheneural
networkrequiresfixed-sizeinput,wespecifyahyperparameter
3.3 PredictionExplainer
ğ‘šğ‘ğ‘¥_ğ‘™ğ‘’ğ‘›tounifythelengths.Theshorterstatictexts(linguistic
structures)areappendedwithaspecialpadtoken([PD]),whilethe Thepredictionexplaineraimstoexplainwhyatrainedmodelmakes
longeronesaretruncatedatğ‘šğ‘ğ‘¥_ğ‘™ğ‘’ğ‘›value.Theembeddinglayer certainpredictions.ItaugmentsQuLogâ€™soutputbypointingout
mapstheinputtokensintoanumericalvectorrepresentation,such thespecifictokensmostlikelycontributingtotheprediction.They
thateachuniquetokenisassignedaspecificvector.InQuLog,these canserveassuggestionstodevelopersforwherethestatictext
embeddingsarelearnedduringtraining,andthevectorembeddings potentiallycanbealtered.Therelevantdetailsoftheexplanation
areadjustedtopreservecontextualproperties(e.g.,frequentlyco- modulearegiveninthefollowing.
occurringwordsforacertainloglevel).Thesevectorscanalsobe 3.3.1 SHAP. PredictionexplainerleveragesSHAP[37](Shapley
obtainedfromgeneral-purposelanguagemodels(e.g.,BERT[12]). additiveexplanations)â€“anapproachfromexplainableartificial
intelligence.Ingeneral,SHAPcalculatesfeatureimportancescores
3.2.3 TransformerNeuralNetwork. Wemodelthedependencies
(howrelevantisafeaturefortheprediction)bydefiningtheproblem
betweenthetokensandthetwoqualitypropertieswithnonlinear
asacoalitionalgamebetweenthefeatures.Thegoalistofindthe
parametricfunctionsrepresentedasneuralnetworks.Asasuitable
so-called Shapley values for each feature defined as the fairest
architecture, we identified the encoder of the Transformer [45]
distributionofthe"payout"(asimportancescore)fortheprediction.
architecture.Itprovidesstate-of-the-artresultsinmanyNLPtasks
Thelargerthevalue,themoreimportantisthefeaturetowards
(e.g.,sentimentanalysis,translation)[4].Bypointingtothesimi-
theprediction.ThesignsoftheShapleyvaluesshowthefeatureâ€™s
laritiesbetweenthestatictextoflogsandnaturallanguage[22],
predictionfavorableness(ornon-favorablenessfornegativesign).
wefurtherjustifyourdesignofchoice.Theencoderimplements
amulti-headself-attentionmechanismthatexploitshigher-order 3.3.2 Implementation. WeusedtheoriginalSHAPimplementa-
relationsbetweentokenswithinthestatictext(beyondn-gram tionwiththedefaultvaluesforitsparameters[36].Onerequired
counting).Thispropertycapturesdiscriminativefeaturesbetween parameterofSHAPisadifferentiablelearningmodel(amodelwith
thewords(linguisticconcepts)andthedifferentcontextstheyap- gradientscalculatedforeachnetworklayer).ToapplySHAP,we
pearin,relatingthemtotheappropriateloglevels(sufficientlin- usedthetrainedencodernetworkasinput.Whiletheexplanation
guisticstructures).Duringtraining,thetokenembeddingvectors procedureisapplicableforbothqualityproperties,wedescribed
andthenetworkparametersareupdatedviabackpropagation[35]. justtheloglevelpredictionexplainerbecauseoftheintuitivemean-
Attheoutputoftheencoder,weprovidethevectorembeddingof ingoftheimportancescoresconcerningthepredictions.
the[LMT]token.Duetothearchitecturaldesign,thevectorofthe
[LMT]tokenattendsoveralltheothertokenvectorembeddings 3.3.3 TokenImportanceScores. TheShapelyvaluesarecalculated
foreachneuronoftheinputvectorembeddings.Figure3illustrates
duringtraining.Thisallowssummarizingthemostrelevantinfor-
arunningexample.Therearetwologinstructionsğ‘™1:"Connection
mationfromtheinputconcerningtheloglevel(sufficientlinguistic
established!"withthelevel"info",andğ‘™2 :"Connectionrefused!"
structure).Therefore,itembedsdiversecontextspreservingthe
withthelevel"error".Afterrunningthetwoinstructionsthrough
propertiesofthestatictext(linguisticstructure).Thenumberof
SHAP,eachtokenisassignedwithavectorofShapleyvalues(with
headsinthemulti-headself-attention,thenumberoflayersand
modelsizearethreehyperparametersofthenetwork. sizeğ‘‘ = 4).However,toreasonabouttheinfluenceofthetoken
inunity,weexpressthetokenimportanceasasinglenumber.We
3.2.4 OutputLayer. Theoutputlayerisathree-dimensionallinear refer to this as a token importance score. To calculate the token
layerforpredictingtheloglevel(two-dimensionalforsufficient importancescore,weaggregatetheindividualShapelyvaluesfor
linguisticstructure).Itacceptsthe[LMT]vectorembeddingand eachtoken.Thetokenimportancescorehastwoparts:1)intensity
applies a linear transformation. Each of the output dimensions and2)sign.Theintensityshowstheinfluencestrengthofthetoken
correspondstooneoftheloglevels(i.e.,"info","warning","error") fortheprediction.Thesignshowsthetokendirectioninfluence
oroneofthetwolinguisticstructuresqualities(i.e.,sufficientand fortheprediction(favouringornot-favouringadecision).After
QuLog:Data-DrivenApproachforLogInstructionQualityAssessment ICPC2022,May21â€“22,2022,Pittsburgh,PA,USA
experimentationwithdifferentaggregationfunctions,wefindthat correctpredictionsoutofalltrueclasspredictions.F1isthehar-
thesecondnormoftheShapelyvaluevectorandthesignofthe monicmeanoftheprecisionandrecallevaluatingthetrade-off
Shapleyvaluewiththehighestabsolutescore,aresuitableforin- betweencorrectclasspredictionsandthemiss-classifications[17].
tensityandsignaggregationfunctions.Formally,theyaregivenin Additionally,weconsideredspecificityinthebinaryclassification
Eq.1andEq.2. setting.Itisthemeasureofcorrectpredictionsofthenegativeclass.
ğ‘Ÿ(ğ‘¡ ğ‘—ğ‘–)=||ğ‘† ğ‘—ğ‘–(ğ‘¡ ğ‘—ğ‘–)||2 (1) T hih ge ha erfo vr ae ln ua em ined dicc ari tt ee sri ba et ta tek re pv ea rl fu oe rs mw anit ch ei .n Tt hh ee e0 v- a1 lur aa tn ig oe n, oa fn td ha
2 e
ğ‘’(ğ‘¡ ğ‘—ğ‘–)=ğ‘ ğ‘–ğ‘”ğ‘›[max|ğ‘† ğ‘—ğ‘–ğ‘˜(ğ‘¡ ğ‘—ğ‘–)|] (2) predictionexplainerisdonewiththeğ‘’ğ‘Ÿğ‘Ÿğ‘œğ‘Ÿ@ğ‘˜score.Itmeasures
ğ‘˜ thenumberofincorrectpredictionswhenk-degreesoffreedomare
whereğ‘Ÿ(ğ‘¡ ğ‘—ğ‘–)isthetoken(ğ‘¡ ğ‘–)importancescoreintensity,ğ‘’(ğ‘¡ ğ‘—ğ‘–)is considered[24].Thesmallervaluesindicatedbetterperformance.
thetokenimportancesignfortheloginstructionğ‘™ ğ‘—.ğ‘† ğ‘—ğ‘–ğ‘˜ denotes WeadditionallyconsideredtheAUC [19]score.AUC isthearea
theShapelyvalueforthe"ğ‘˜-th"positionofthe"ğ‘–-th"tokenofthe undertheROC(receiveroperatingcharacteristic)curvethatplots
loginstructionstatictext(i.e.,intheexamplethetoken"refused" thetruepositiveagainstthefalse-positiverates.Itisboundedin
hasaShapelyvalueğ‘†224=âˆ’5.22). the0-1range,withahighvalueindicatingbetterperformance.The
In the example, the difference between the two instructions AUCvalueof0.5indicatesamodelperformingnotbetterthana
distinguishingthelevels"info"from"error"isinthesecondtoken. randomguess.
WefirstcalculatetheindividualShapelyvaluesandthencalculate
theintensityandsignofthetokenimportancescores.Asseenby 4.2 LogLevelAssignmentEvaluation
thescorevalues,thefollowinginequalitiesholdğ‘Ÿ12 > ğ‘Ÿ11,ğ‘Ÿ22 >
WefirstevaluatetheperformanceofQuLogontheloglevelqual-
ğ‘Ÿ21. The second token in both of the instructions ("established",
ityassessment.Wesplitthisevaluationintotwoparts.First,we
"refused")hasgreaterintensitycomparedtothefirst("connection"),
compareQuLogagainstbaselines.Second,weevaluateQuLogâ€™s
thereby,contributingmoretothemodelprediction.Additionally,
performanceonafewinstancesoftheproblemofloglevelassign-
thetokensignsshowthatthetoken"established"isfavourablefor
ment.Themotivationforthisevaluationtypeononesideisto
theclass"info"(ğ‘’12=+),whilethetoken"refused"isnot-favourable
examinetheperformanceofQuLogagainstbaselines,andonthe
fortheclass"info"(ğ‘’22 = âˆ’).Therefore,ifthereisadiscrepancy otherside,toidentifyprobleminstanceswheretheinheritedim-
betweenthedevelopersâ€™decisionontheloglevelandQuLogâ€™slog
perfectperformanceofdata-drivenapproacheswillnotoverwhelm
levelassignment,thedeveloperexaminesthehighlightedword,