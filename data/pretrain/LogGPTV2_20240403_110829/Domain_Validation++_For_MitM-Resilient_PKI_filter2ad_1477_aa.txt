title:Domain Validation++ For MitM-Resilient PKI
author:Markus Brandt and
Tianxiang Dai and
Amit Klein and
Haya Shulman and
Michael Waidner
Domain Validation++ For MitM-Resilient PKI
Markus Brandt
Fraunhofer SIT
TU Darmstadt
Tianxiang Dai
Fraunhofer SIT
Amit Klein
Fraunhofer SIT
Michael Waidner
Haya Shulman
Fraunhofer SIT
TU Darmstadt
ABSTRACT
The security of Internet-based applications fundamentally relies
on the trustworthiness of Certificate Authorities (CAs). We prac-
tically demonstrate for the first time that even a weak off-path
attacker can effectively subvert the trustworthiness of popular com-
mercially used CAs. Our attack targets CAs which use Domain
Validation (DV) for authenticating domain ownership; collectively
these CAs control 99% of the certificates market. The attack utilises
DNS Cache poisoning and tricks the CA into issuing fraudulent
certificates for domains the attacker does not legitimately own –
namely certificates binding the attacker’s public key to a victim
domain.
We discuss short and long term defences, but argue that they fall
short of securing DV. To mitigate the threats we propose Domain
Validation++ (DV++). DV++ replaces the need in cryptography
through assumptions in distributed systems. While retaining the
benefits of DV (automation, efficiency and low costs) DV++ is se-
cure even against Man-in-the-Middle (MitM) attackers. Deployment
of DV++ is simple and does not require changing the existing in-
frastructure nor systems of the CAs. We demonstrate security of
DV++ under realistic assumptions and provide open source access
to DV++ implementation.
CCS CONCEPTS
• Security and privacy → Security protocols; Public key encryp-
tion; Distributed systems security;
KEYWORDS
PKI security, DNS cache poisoning, Certificates, CA attacks
ACM Reference Format:
Markus Brandt, Tianxiang Dai, Amit Klein, Haya Shulman, and Michael
Waidner. 2018. Domain Validation++ For MitM-Resilient PKI. In 2018 ACM
SIGSAC Conference on Computer and Communications Security (CCS ’18), Oc-
tober 15–19, 2018, Toronto, ON, Canada. ACM, New York, NY, USA, 17 pages.
https://doi.org/10.1145/3243734.3243790
Permission to make digital or hard copies of all or part of this work for personal or
classroom use is granted without fee provided that copies are not made or distributed
for profit or commercial advantage and that copies bear this notice and the full citation
on the first page. Copyrights for components of this work owned by others than ACM
must be honored. Abstracting with credit is permitted. To copy otherwise, or republish,
to post on servers or to redistribute to lists, requires prior specific permission and/or a
fee. Request permissions from permissions@acm.org.
CCS ’18, October 15–19, 2018, Toronto, ON, Canada
© 2018 Association for Computing Machinery.
ACM ISBN 978-1-4503-5693-0/18/10...$15.00
https://doi.org/10.1145/3243734.3243790
Fraunhofer SIT
TU Darmstadt
1 INTRODUCTION
Stability and security of web ecosystem rely on Certificate Authori-
ties (CAs) to ensure that services are trusted and communication
to them is secure. CAs vouch for trustworthiness of a service by
issuing a digital certificate that binds a domain name to a public
key of the service. Upon receiving the request for a certificate for
domain, say vict.im, a CA validates that the server issuing the
request owns and controls the domain for which it requests the
certificate. After a successful validation of the ownership of the
domain, CA issues the certificate. The certificate contains, among
others, the public key of the requesting server and the requested
domain. Domain name within the certificate is a key element on
which trust can be built. The certificate is signed by the private key
of the CA. The server then uses this certificate to prove its identity
to clients in the Internet. The clients use the server’s public key in
the certificate to establish a secure (encrypted and authenticated)
connection to the server.
Browsers have hundreds of registered CAs, and a valid certificate
for any domain signed by any of these trusted CAs is accepted by
the browsers. Hence, correctly verifying ownership of the domain
during the certificate issuance is critical to ensure the security of
the clients and services. There are a number of approaches that
CAs can use to establish ownership of domains: Domain Validation
(DV), Organisation Validation (OV) and Extended Validation (EV).
DV provides a number of techniques (e.g., using Email or Domain
Name System (DNS)) that allow to prove in an automated way that
the applicant owns a given domain name. The idea behind DV is
that only the owner of the domain can receive the communication
sent to the services in that domain and can respond to them. EV
and OV are meant to ensure more stringent certification and are
carried out with some human interaction.
Although EV and OV provide a higher assurance of ownership,
they are cumbersome and inefficient since they require manual
processes for establishing the identity of the applicant, e.g., commu-
nication with the customer that requests the certificate, phone calls
to the company, additional documents, such as personal identifica-
tion card, or impose checks against official government sources. In
addition, manual verification during certificates generation is more
lengthy and results in high costs, e.g., certificates’ prices can exceed
1000 USD. In contrast, the automation offered by DV enabled to
reduce the certificates’ prices while improving efficiency of the
certificates’ issuance process and ultimately increasing the market
share of DV supporting CAs to 99%.
In this work we explore the security of the DV procedure used
by the CAs to establish ownership of domains. We identify vulner-
abilities and show that even a weak off-path attackers can trick the
Session 10C: TLS 2CCS’18, October 15-19, 2018, Toronto, ON, Canada2060DV process and issue certificates for domains they do not own. We
evaluate the attack against CAs and show that vulnerabilities exist
in popular and large CAs. Our attack exploits vulnerabilities in
DNS, which allow us to inject incorrect mappings into the caches of
DNS resolution platforms of CAs. These mappings map the target
domain to attacker’s controlled IP addresses. As a result, the CAs
perform the DV process against the hosts that are controlled by the
attacker and not against the real owner of the domain. We discuss
obstacles and challenges and show how to overcome them and
launch a successful off-path attack during the certificate issuance.
Our results demonstrate that Public Key Infrastructure (PKI)1 which
is meant to provide security against strong Man-in-the-Middle (MitM)
attackers, is relying on a weak building block that can be circumvented
by an off-path attacker.
We discuss short term patches but show that they do not miti-
gate the vulnerability. A cryptographic defence for DNS, DNSSEC
[RFC4033-RFC4035], would prevent the attacks, but it would take
long until the domains are protected with DNSSEC and DNS re-
solvers perform validation (we explain this in Section 3.6.2). We
build upon the ideas of replacing cryptography through assump-
tions in distributed systems, [19], and design and implement Do-
main Validation++ (DV++) - a distributed mechanism for authen-
ticating ownership of Internet domains. We show that DV++ is
resilient to MitM attackers, while retaining the benefits of DV.
PKI Security
A large research effort is focused on evaluating and improving
security of PKI; see Section A for background on PKI. There are
works that evaluate security of keys used to establish a secure
communication [29], others showed how to exploit side channels
to recover plaintext from encrypted communication [6], or launch
downgrade attacks for recovering the encrypted communication
[9]. There is also a history of attacks against PKI, typically by
compromising a CA (we review these in Related Work, Section 5).
However, no attention was given to the authentication of ownership
used by the CAs. Correctly authenticating ownership of resources
is a key element in certification and essential for building trust in
the cryptographic material used for securing the communication.
The vulnerabilities along with the need to secure PKI motivated
research on security mechanisms, most of which propose alter-
native models for PKI. Some proposals attempt to identify com-
promised certificates by using log servers which monitor CAs be-
haviour, for instance, Certificate Transparency [42], Sovereign Keys
[21], Accountable Key Infrastructure [38], Attack-Resilient Public
Key Infrastructure [12].
The proposals provide a good starting point and promising di-
rections for design of future PKI. However, most are not adopted
due to their prohibitive complexity and performance as well as
the changes that they require to the existing infrastructure and
the deployment overhead (e.g., introduction of multiple interacting
entities). In this work we propose improvements to the existing PKI
without changing the infrastructure or introducing new actors – we
design and implement DV++ which replaces DV without requiring
further modifications to the PKI. In contrast to DV, which we show
1PKI is a set of roles, policies, procedures and entities for creating and managing
certificates and public-key encryption.
is vulnerable even to off-path attacks, DV++ provides resilience
against the strong (on-path) Man-in-the-Middle (MitM) attackers.
Security against MitM attackers is essential since PKI needs to op-
erate over untrusted networks. Hence it is prudent to assume that
the attackers can eavesdrop, modify and inject messages. A critical
property of DV++ is that it requires no changes to the existing CAs
ecosystem. The interface and communication with the CA and with
the verified domain are identical to DV. The difference is in the
verification process which DV++ applies - which is transparent to
the other actors in the CA ecosystem. We explain this in Section 4.
Attacker Model
For our attacks we use the weakest off-path attacker, which does
not have access to the communication of legitimate parties. The
attacker can generate packets and spoof source IP addresses. No-
tice that often off-path attackers can gain MitM capabilities, e.g.,
by launching BGP prefix hijacking attacks. Indeed, attackers are
becoming more sophisticated and increasingly leverage BGP hi-
jacking for DNS cache poisoning [44]. Such attackers obtain MitM
capabilities for a short period of time and can efficiently launch the
attacks described in this work. We demonstrate however, that even
weaker (complete off-path) attackers, can subvert the security of
DV validation in PKI.
Disclosure and Ethics
Our research shows that even weak off-path attackers can exploit
vulnerabilities to issue fraudulent certificates. This puts at risk not
only the vulnerable CAs but the entire PKI ecosystem, with services
and clients. Nevertheless, we believe that this research is important:
since the vulnerabilities exist, they may be exploited by attackers
for malicious purposes without notifying the affected entities. Our
goal is to expose and mitigate these issues. We are disclosing the
vulnerabilities and are in contact with the affected CAs.
In the attacks that we demonstrate in this work we leverage DNS
cache poisoning for injecting spoofed records into DNS caches.
Hence to mitigate our attacks the immediate short term counter-
measure is to fix the vulnerabilities in DNS that allow injection of
records into caches. We notified the affected DNS vendors, DNS
operators and service providers of the vulnerabilities.
Our attacks did not target any existing Internet clients and do-
mains. Evaluation of our attacks against CAs’ DNS resolvers were
carried out using a domain that we own (for simplicity in this
work we use domain vict.im). This ensured that the CA would
not use the spoofed records for any “real” purpose. We setup a set
of attacking hosts, which were issuing certificates for resources in
domain vict.im. Our techniques can be applied to attack other
domains (we survey the attack surface of popular domains that can
be potential victims) hence adoption of mitigations is critical.
Our attacks were carried out ensuring that the normal CAs func-
tionality is not affected. Part of our study was inferring different
cache overwriting vulnerabilities, which we tested against the DV-
supporting CAs. The study of caches introduces a larger volume of
traffic, than say, merely running an attack with the goal of exploit-
ing a single vulnerability. To avoid any potential load on the CAs
infrastructure we distributed the study over a long period of time,
with waiting intervals between the requests for issuing certificates.
Session 10C: TLS 2CCS’18, October 15-19, 2018, Toronto, ON, Canada2061Hence, guaranteeing that we do not generate an excessive traffic
volume on the CAs.
Contributions
In this work we show that the DV mechanism, applied by the CAs
to authenticate ownership of domains, can be circumvented by
off-path attackers. In our attacks we leverage DNS cache poisoning
for injecting spoofed records into caching DNS resolvers, mapping
the resources in the target domain to attacker-controlled hosts. As
a result, the DV performed by the CA is run against attacker’s
hosts (in this work these are our machines), which allows the off-
path attacker to successfully pass the validation, and to receive
fraudulent certificates (signed by a CA) for domains that the attacker
does not own. We demonstrate the attack and evaluate it against
DV supporting CAs. We successfully launched the complete attack
against 7 of the DV-supporting CAs. Hence at least 7 CAs are
vulnerable to our attack, but potentially more DV-supporting CAs
are vulnerable; we explain the conditions for successful attack in
Section 3. Unfortunately, even a single vulnerable CA is sufficient
for subverting the security of PKI. This is due to the fact that the
security of PKI is based on the security of the weakest link in
the infrastructure - compromising a single CA allows attackers to
issue fraudulent certificates for any domain, which would then be
accepted by any operating system and any browser which have
that vulnerable CA on a list of trusted CAs.
Our work is the first to weaponise off-path DNS cache poisoning
for attacking a complex system, such as the certificates generation.
Prior to our work, such off-path attacks were considered anecdotal
and rather on a theoretical spectrum. DNS cache poisoning attacks
are known to be launched in the wild, but these are done with
a MitM attacker, which observes the requests and can efficiently
craft malicious DNS responses, e.g., DNS cache poisoning for email
hijacking [18] or for stealing digital cash [44]. In this work we
provide the first demonstration of exploitation of off-path DNS
cache poisoning for attacking a critical system - the certificate
generation in PKI.
We discuss possible mitigations but argue that they do not solve
the problem. Cryptographic protection of DNS would prevent the
attacks but it is not clear when DNSSEC is going to be fully de-
ployed. We follow the ideas of [19] for replacing cryptography
through assumptions in distributed systems. We propose DV++,
a modification to DV, which maintains the benefits of DV (it is