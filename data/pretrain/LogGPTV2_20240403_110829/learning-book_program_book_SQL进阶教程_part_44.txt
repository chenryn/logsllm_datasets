NHERE Sl.seat ce S2.aeat
--第一步：生成起点和终点的组合
AND S3.seat BETvEES S1.seat - 1 ASD S2.eeat + 1
GBROUP BT S1.aeat, S2.aeat
A ESVO)NNS * (>INNOO CNIANE
S3.Beat BETVEEN S1. Beat AND S2.sest
T NEHI . * SQe'CS IN
-- 条件 1
EE S3.aeat - S2.seat + 1 ND S.tatus - 占* THEN 1 --条件 2
MES S3.aeat = S1.Beat - 1 NSD S3.8tatus = 占* THEN 1 -- 条件 3
815E 0 011
■执行结果
staxt_seat
end_seat
seat_cnt
........
2
7
5
10
1
---
## Page 307
294-
起双重否定好理解多了。
解答1-10HAVING子句又回来了
练习题1-10-1单重集合与多重集合的一般化
COUNT函数的参数只能是一列。虽然这是常识，但是见到这个题，还
是有人不由自主地写成couNT(material，orgland）吧？真遗！这样写
是不对的。
不过不必难过。虽然参数只能是一列，我们却可以将多列拼凑成一列
作为参数传递。解答如下所示。
--选择[材料，原产国|组合有重复的生产地
SELECT center
FROM Materials2
HAVING coutr(material Il orgland) <> coutr(DtsrIcT material |lcorglandl 
■执行结果
centex
东京
如果想要拼凑的字段不是字符申类型，可以先转换成字符申类型再拼
凑。这种解法怎么说呢，多少有点欺骗数据库的感觉所以说，还是不
要多想了。需要扩展成三个字段以上时，同样地拼凑起来就可以了。
顺便说一下，也许有人会考虑下面这种解法。但是很遗憾，这么做是
错的。
--选择|材料，原产国）组合有重复的生产地：错误的查询语句
SEL&CT center
FROM Materials2
HAVING coUNr (naterial)<> CoUNI(DIsTINCT material)
GROUP BY center
AND CoUNI(orgland)<> COUNI(DISTINCT orgland) /
---
## Page 308
3-1习题解答—
295
■执行结果
center
东京
名古屋
为什么名古屋也会出现在结果里呢？这是因为，对于名古屋，材料“钢”
和“钛”重复，原产国“智利”重复，因此它满足了这条查询语句的条件。
在使用多个字段查找集合中的重复元素时，不应该对各个字段分别进行条
关系数据库中的表时的重要思考方式，请一定牢记。
练习题1-10-2多个条件的特征函数
应该使用“学号”作为聚合键这一点很好理解，但是问题是特征函数
应该怎么写。这道例题需要根据课程是“语文”还是“数学”改变条件，
因此可以像下面这样解答。
MHERE BubjectIN数学语文
HAVING SUM(CASE KHEN subject - *数学* AND score >= BO THEN 1
ELSE 0 KND) - 21
student_id
100
00
因为不需要处理数学和语文以外的课程，所以这里先在WHERE子句
中进行了排除。因此生成的子集最多只包含两个元素。
---
## Page 309
296
参考文献
恭喜大家读完本书，踏入中级数据库工程师的大门。下面来介绍一些从中级向高级进阶的必读书。
以及讲解本书正文未涉及的主题的书。
向高级进阶的道路比向中级进阶的道路更为艰难，希望这些书能够照亮大家前行的道路。
实践篇
JoeCelko，《SQL权威指南（第4版）》（人民邮电出版社，2013年）
无需过多解释，这一定是第一本必读书。笔者就是从这本书中发现了
SQL的乐趣。当然这本书有很多实用的技巧，如果想学习SQL，那么读这
一本书就足够了。这样的书才叫实用的书。
由此可见它面向的群体是中级到高级水平的人。英文原版最新是第5版，
中文版最新是第4版。
JoeCelko，《SQL解惑（第2版）》（人民邮电出版杜，2008年）
在第1版发行十几年之后，这本书又更新了第2版。第2版的页数增
加了很多，也新增了许多新的问题，而且对于旧的问题，第2版又给出了
新的解法。特别是使用窗口函数和公用表表达式这些新功能的解法，非常
值得学习。
除了工作中的实际间题，这本书还包含很多用SQL来解数独和拼图
游戏的非常有趣的问题。这本书中的问题无疑都是最高水平的SQL练习题。
如果说《SQL权威指南》适合作为教科书来使用，那么这本书应该适合
作为习题集来使用，而笔者的这本书适合作为课外读物来使用。
---
## Page 310
3-2参考文献—297
Andrew Cumming、Gordon Russell，《SQL Hacks》（清华大学出腹杜，
2008年）
这本书为已经灵活掌握SQL的工程师讲解了很多进一步提升能力的
实战技巧。这本书的定位和《SQL解惑》有点像（事实上，两本书中有很
多相似的问题，此外这本书的作者们还在书中提到了JoeCeko）。书中介
绍了很多Web开发的案例研究，主要针对MySQL数据库进行讲解
作者们对标准SQL以及SQL的逻辑有着深刻的理解，书中作者们的
独到见解随处可见（而且作者们还大胆地统一采用逗号风格）。虽然这本
书有点晦涩难懂，但是很值得一读。
JoeCelko，《SQL编程风格》（人民邮电出版社，2008年）
这本书没有介绍具体的技巧，而是介绍了设计相关的知识，以及编码
风格。这本书相当于数据库领域的《编程格调》（人民邮电出版社，2015年），
也是一本赞誉颇多的名著。
书中涉及表和字段的命名规则、编码风格、不好的表设计案例、视图
和存储过程的用法以及集合论的思考等丰富的内容，是一本面面俱到的好
书。特别是第6章“编码选择”和第10章“以SQL的方式思考”，建议
所有的数据库工程师都读一下。
思必大家也猜到了，本书1-12节和2-6节受了这本书很多影响
Joe Celko, Joe Celko's Trees and Hierarchies in SQL for Smarties,
Second Edlition ( Morgan Kaufmann, 2012 年)
近年来针对关系数据库和SQL的批评中，最为尖锐的是“不能很好
地操作树形结构的数据或者层级结构的数据”也许是因为它们被批评的
太多了，所以最近很多数据库厂商都在有意识地改进这一点，努力尝试着
开发了各自的产品。
优化产品是数据库厂商的工作，那么作为一线的工程师，我们又该如
何使用SQL操作树形结构的数据呢？为了回答这个间题，本书全文都在
介绍各种使用SQL操作树形结构数据的方法与技巧，相当厉害。当然，
写这本书的JoeCelko也很厉害，但是这样深奥的书在美国都有人读，这
也说明美国数据库领域的发展很厉害。
---
## Page 311
娄享E86乙
书中详细介绍了邻接列表模型、路径枚举模型等标准的层级结构，但
是最精彩的内容是把节点当作集合来处理的章节“Nested SetsModel”（嵌
套子集模型）。有用的技术书很多，但让人读后为之感动的技术书并不多。
这本书还没有中文译本，但《SQL权威指南（第4版）》第36章和
第37章对其作过一些介绍。大家也可以参考笔者的网站（内容是用日文
写的,地址为 http:/www.gcocities.jp/mickindex/database/db_tree_ns.html)。
理论篇
C.J.Date，《深度探索关系数据库：实践者的关系理论》（电子工业出版杜，
2007年1
这本书是当今数据库领域的权威CJ.Date为一线数据库工程师写的介
绍关系数据库模型的教材，非常注重理论和实践的结合，目标读者是中级
以上水平的数据库工程师。
不推荐三值逻辑的理由是什么？为什么不允许重复行存在？一个字段
都没有的表有什么用？为什么范式很重要？嵌套关系（二阶关系）可能实
现吗？
作者对像上面这样与实际工作有关的理论问题作了严谨但通俗易懂的
讲解。
Robert Ashenhurst、Susan Graham，《ACM图灵奖演讲集》（电子工业
出版社，2005年）
这本书里收录了本书中多次引用的Codd的演讲文《关系数据库：生
产力的实用基础》。这本书在书店可能不太容易找到，如果有机会可以试
着读一下。Codd的演讲非常明快，对于一线工程师来说也非常容易理解。
户田山和久，《逻辑学的创立》（原书名“输理学《”，尚无中文版）
这是一本学习谓词逻辑的最佳入门书，而且不仅是谓词逻辑的入门书
还是逻辑学的入门书，因此完全没有逻辑学知识的人读起来也没有问题。
此外，这本书习题非常丰富，很适合自学者，其难能可贵的地方在于，虽
然是入门书却也适当介绍了三值逻辑相关的知识。
---
## Page 312
3-2参考文献—299
远山启，《无限与连续》（原书名无限七速综”，尚无中文版）
要想学习谓词逻辑，那么读上面那本户田山和久的书就可以了。这里，
笔者推荐一本集合论的入门书。这本书出版于1952年，已经有半个多世
纪的历史，但是就集合论这个主题而言，这本书仍然是入门书中永远的畅
销书。
并非常生动地讲解了群和单位元等与SQL关系密切的概念。这本书是岩
波新书，属于岩波书店出版的便携书，所以价格比较实惠，而且便于携带。
如果大家在读完笔者的这本书后希望进一步了解集合论这个充满魅力的世
界，那么笔者强烈推荐远山启的这本书。
---
## Page 313
后记
请允许笔者讲一个发生在笔者身上的故事。
在刚接触到关系数据库的时候，笔者对它的第一印象并不是很好。在
新手程序员的眼里，与丰富多彩的网络和Web世界相比，数据库看起来
是那么地枯燥无味。想必很多人都跟笔者有一样的想法吧？
但是不久之后，笔者遇到了一本书，它改变了我对数据库的认识。这
本书不是关于数据库的，因此笔者没有将其列在本书3-2节“参考文献”里，
但这里笔者想把它介绍给大家。
注0
原书名为 /~
这本书是高野丰先生所著的《root寄语》°（ASCII，1991年）从书
》”尚无中文胍。
编者注
名就可以看出，它不是一本关于数据库的书，这本书用通俗易懂的日常语
言讲述了UNIX系统管理员的心得，是一本源于实践的散文集。那么究竞
这本书的哪些地方令从事不同领域工作的笔者深受启发呢？其实就是这么
一句话：在这个世界上，无论看起来多么普通的事物，背后总是隐藏着深
刻的原理”。高野先生的这本书借助UNIX这一主题，为我们诠释了这句
大胆的话的正确性。在读到山形浩生先生为这本书写的评论之后，笔者受
到了更大的刺激。下面是评论的一部分。
只要读一遗这本书，你就会意识到之前的自己是多么肤浅。如果你曾
经懒情地认为有趣的东西总会从天而降，那么读究这本书之后你会深深地
为自己的这种想法感到羞耻。作者高野先生从平淡无奇的生活中发现了别
人注意不到的乐趣。有些是在需要学习工作中必备的技能时发现的，有些
是在出差或者上班的途中发现的。我们并不需要等待特殊的时机，因为有
趣的东西其实无处不在。这个世界没有一天是无聊的，只不过是你懒情已
久的感官无法发现眼前事物的东趣而己。（摘自“发现乐趣的智慧之书”
网为 http://cruel.org/other/ditodias.html。 )
“这个世界没有一天是无聊的，只不过是你懒情已久的感官无法发现
眼前事物的乐趣而已”。这句严厉的训斥，从笔者读到的那天起就一直刺
痛看笔者的心。
图灵社区会员 非洲钢(PI:EMAIL) 专享 尊重版权
---
## Page 314
后记—301
读完这本书之后，笔者开始以谦虚的态度重新审视了数据库。如果笔
者感到这个世界缺乏乐趣，那不是世界出了间题，而是因为笔者还不未能
发现其中的乐趣。这个世界充满了笔者未曾了解的各种可能。在改变态度
之后，笔者朝着数据库世界的深处展开了挖掘。
想必大家已经明白了，本书其实就是将高野先生通过UNIX所做的事
情，在数据库领域进行了尝试。当然，因为笔者水平有限，未必能够挖掘
出数据库和SQL的全部乐趣。但是只要能让大家感受到数据库的世界并
非荒野一样枯燥无味，而是充满了各种可能，那么笔者写这本书的目的就
达到了，因此，从这一点来说，这本书可以看作笔者给各位读者的“寄语”。
接下来轮到大家去发现世界的乐趣了。当然这里说的“世界”并不限于数
据库的世界，大家各自从事的领域都可以。因为无论什么领域，必定有相
通之处。
好了，火炬已经传递给大家了。加油吧！
---
## Page 315
版权声明
逢人C学SQL微底指南书
(Tatsujin ni Manabu SOL TerteiShinansho : 1516-0)
Copyright O 2008 by Mick.
Original Japanese edition published by SHOEISHA Co., Ltd.
Simplified Chinese Character translation rights arranged
with SHOEISHA Co., Ltd. through CREEK & RIVER Co., Ltd.
and CREEK & RIVER SHANGHAI Co., Ltd.
Simplified Chinese Character translation copyright C 2017 by Posts & Telecom Press.
本书中文简体字版由SHOEISHACo,Ltd.授权人民邮电出版社独家出版。未经出
版者书面许可，不得以任何方式复制或抄袭本书内容。
版权所有，侵权必究。
图灵社区会员 非洲铜(PI:EMAIL) 专享尊重版权
---
## Page 316
顾信连接
微博连接
关注@图灵教育每日分享T好书
QQ连接
图灵读者官方群1：218139230
图灵读者官方群I：164939616
图灵社区
iTuring.cn
在线出版，电子书，（码求)杂志，图灵访锁
---
## Page 317
“本书适合具有一定SQL
编程经验的工程师阅读]
★转变面向过程语言的思维定式，学习SQL常见技术的不同用法，切实
提升SQL应用技能
★解析经典文献，回顾关系数据库发展史，从逻辑学、集合论的角度讲
述SQL和关系模型的理论，深刻理解面向集合思维
★讲解由浅入深，辅以200多段基于标准SQL编写的示例代码和丰富的
练习题（包含解答），理论与实践相结合，易懂、实用、好操作
图灵社区：iTuring.cn
热线：（010)51095186转600
分类建议
计算机/数据库/SQL
ISBN978-7-115-47052-2
人民邮电出版社网址：www.ptpress.com.cn
定价：79.00元
---
## Page 318
看完了
如果您对本书内容有疑问，可发邮件至PI:EMAIL，会有编辑或作
译者协助答疑。也可访问图灵社区，参与本书讨论。
如果是有关电子书的建议或问题，请联系专用客服邮箱：
PI:EMAIL。
在这可以找到我们：
微博@图灵教育：好书、活动每日播报
微博@图灵社区：电子书和好文章的消息
微博@图灵新知：图灵教育的科普小组
微信图灵访谈：ituring_interview，讲述码农精彩人生
微信图灵教育：turingbooks
---