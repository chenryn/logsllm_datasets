ConstructingLarge-ScaleReal-WorldBenchmarkDatasetsforAIOps ESEC/FSE2022,14-18November,2022,Singapore
Itindicatesafailureoccurringinthesystemwhentheoverall
valueofameasurebecomesabnormal(e.g.,thetotaldollaramount
decreasescomparedwiththeexpectednormalvalue).However,in
Mon Tue Wen Tur Fri Sat Sun practice,afailureusuallyonlycausesthemeasurevaluesunder
specificattributecombinations[18]abnormal[24].Anattribute
combinationreferstoasliceofthewholemulti-dimensionaldata
byselectingrecordswithspecifiedvaluesofsomeattributes,andit
Mon Tue Wen Tur Fri Sat Sun
hasbeenformallydefinedinexistingliterature[18].Forexample,
inTable3,onlythemeasurevaluesunder{Province=Beijing}are
significantlyabnormal.Suchattributecombinationsshowthescope
Mon Tue Wen Tur Fri Sat Sun ofthefailure,andthus,aresubstantialcluesforfailurediagnosis.In
Table3,forexample,bylocalizing{Province=Beijing},engineers
gettoknowthatthefailureisrelatedtothenetworkorservers
forusersinBeijing,whichdirectsfurtherdiagnosis.Therefore,we
Mon Tue Wen Tur Fri Sat Sun
callsuchattributecombinationsasrootcausesofmulti-dimensional
data.
Table2:Examplestructuredlogs
Mon FigurT eue 2:SomW een KPIexT aur mplesoFr fi dataseS tatùê¥ Sun
OrderID Timestamp DollarAmount Province ISP
T001 2021.11.1110:00:01 $16 Beijing ChinaMobile
strategy of KPI anomaly detection proposed in [43], we import
T002 2021.11.1110:00:05 $21 Beijing ChinaUnicom
alarmdelayrestrictionanddesignanovelevaluationmethodused
inthecompetition3.Thisdatasetandevaluationmethodhavebeen Table3:Examplemulti-dimensionaldata
widelyusedinmanyresearchworks[13,38,50].ThebestF1-score
Province ISP DollarAmount ExpectedDollarAmount
achievedinthiscompetitionis0.8216.Thesolutionsproposedby
Beijing ChinaMobile 5 10
thetopteamsaresharedinpublic[4]. Beijing ChinaUnicom 10 20
Shanghai ChinaUnicom 30 31
4 ROOTCAUSELOCALIZATIONFOR Guangdong ChinaMobile 10 9.8
Zhejiang ChinaUnicom 2 2
MULTI-DIMENSIONALDATA Guangdong ChinaUnicom 200 210
Shanxi ChinaUnicom 20 22
Inthissection,wefirstintroducethebackgroundofrootcause Jiangsu ChinaUnicom 200 203
localization for multi-dimensional data. Then we introduce our Tianjin ChinaMobile 41 43
Total 518 550.8
publishedlarge-scaledatasetforthisproblem.
4.1 Background
4.2 Dataset
Tocloselymonitortheeventsoccurringinasystem,varioustypes
ofstructuredlogsaregenerated,carryingcriticalinformationfor Mostexistingworks[5,6,18,19,25,28,37,40,41,47]onrootcause
failure diagnosis. The structured logs record events with many localizationformulti-dimensionaldatausetheirprivatedatasets
fieldsdescribingtheevents.Forexample,anonlineshoppingplat- forevaluation.Therefore,toenhancetheresearchofrootcause
formcouldgeneratestructuredlogsrecordingorders.Asshown localizationformulti-dimensionaldata,weconstructandpublisha
dataset[2],namedùêµ,basedonthereal-worldlargeonlineshopping
inTable2,thefieldTimestampdescribeswhentheorderoccurs,
Dollar Amountdescribesthedollaramountoftheorder,Province platformofSuning.Ltd.
Indatasetùêµ,therearefiveattributes,whicharenamedasi,e,c,
describesthelocationofthecorrespondingcustomer,andISPde-
pandlforconfidentialreasons.Themeasureofùêµistheaverage
scribesthenetworkthatthecustomerused.Engineerswouldlike
numberoforderperminute.Intotal,thedatasetùêµcontains400
tocollecttheoverallvalueofsomefields,suchasthetotaldollar
amount,tomonitorthestatusofthewholesystem.Wecallsuch syntheticfailureswithground-truthrootcauselabels,spanning
fieldsmeasures[6,24].Otherfieldscharacterizetheeventsandwe eightweeks.Weusesyntheticfailuresratherthanreal-worldfail-
callthemattributes[6,18,24,28].Bygroupingoriginalstructured uresbecauseitishardtocollecthundredsofproductionfailures
logsbysomeattributesandaggregatingvaluesofsomefields,multi- withground-truthrootcauses.Thesynthesisprocessoffailures
dimensionaldata[24]aregenerated.Forexample,togeneratethe containssixsteps.
multi-dimensionaldatainTable3,wegroupstructuredlogslike
(1) We first select a time point for anomaly injection where the
thoseinTable2byTimestamp,Province,andISP,andaggregate
overallmeasurevaluesaresmooth.
valuesof Dollar Amount.NotethatinTable3,weonlypresent
(2) Werandomlychooseùëö ‚àà {1,2,3,4}differentattributesoutof
a snapshot of the whole multi-dimensional data, i.e., the multi-
thefiveattributes.
dimensionaldataataspecifictimestamp.Multi-dimensionaldatais
(3) Thenwerandomlychooseùëõ‚àà{1,2,3,4}differentattributecom-
amorecompactrepresentationoftheoriginalstructuredlogs,and
binationscorrespondingtotheùëö selectedattributes.Theseùëõ
thus,wefocusonmulti-dimensionaldataforfailurediagnosis.
selectedattributecombinationsaretheground-truthrootcause
3https://github.com/iopsai/iops/tree/master/evaluation wherewearegoingtoinjectanomalies.
ESEC/FSE2022,14-18November,2022,Singapore Z.Li,N.Zhao,S.Zhang,Y.Sun,P.Chen,X.Wen,M.Ma,D.Pei
(4) Foreachselectedattributecombination,wemodifythemeasure OSB1 OSB2
valuesofit,i.e.,themeasurevaluesofthoserowsattheselect Docker1 OS1 Docker2 Docker3 OS2 Docker4
timepointsatisfyingtheattributecombination.Themodified
valuesarecalculatedbygeneralizedrippleeffect(GRE)[24]with DB2 Docker6 Docker7 DB3
arandommagnitude. Docker5 Docker8
(5) Weaddextranoises,whicharegeneratedbyGaussiandistri- OS6 OS3 DB1 OS5 OS4
bution,onbothmodifiedrowsandotherrowstosimulatethe Figure 3: The components and their relationships, includ-
caseswhereGREdoesnotworkperfectlyandthereareforecast ingcalldependencies(solid)anddeploymentdependencies
(dashed),inthedistributedsystemS.
residuals,respectively.
(6) Wecheckthesyntheticfailurewiththefollowingconditions.
components,suchasqueriesperminute,successrate,andaverage
Whenanyoneofthemaretriggered,wegobacktostep2to
responsetime.
regenerateafailureatthetimepoint.
ByKPIanomalydetectionontheseKPIs,wecandiscoverfailures
‚Ä¢ Thereisotherattributecombinationssharingalmostthesame
inthedistributedsystemsandfigureoutwhichcomponentsare
rowswiththeselectedground-truthattributecombinations.
abnormal.However,duetothecomplexdependencies,afailure
‚Ä¢ Theinjectednoisesissolargethattheoverallmeasurevalue
occurringataroot-causecomponentcanpropagatetoothercom-
ofunmodifiedrecords(instep3)isalsoabnormal.
ponentsandcausetheirKPIsabnormalaswell[23].Therefore,to
Overall,amongthe400syntheticfaults,144/131/89/36faultscon- diagnosethefailure,itisnecessarytodistinguishtheroot-cause
tains1/2/3/4root-causeattributecombinations,and96/136/108/60 componentsfromotherabnormalcomponents.Furthermore,to
faultsinvolve1/2/3/4attributes. localizethefine-grainedrootcausesofafailure,itisrequiredto
Basedonthedatasetùêµ,weheldthesecondAIOpschallengein
identifyroot-causemetricsoftheroot-causecomponentsfurther.
20194.Thereare141teamsand547participantsfrombothacademia
Foreachcomponent,thereareplentyofmetrics(e.g.,CPUutiliza-
(39%)andindustries(61%)inthiscompetition.Thebestperformance tionandnetworkthroughput)collected.Whenweidentifiedthe
achievedbytheminthiscompetitionis0.9593withrespecttoF1- rootcausemetrics,forexample,CPUusage,itisclearthatthefail-
score.Thesolutionsproposedbythetopteamsarepublishedin ureiscausedbyCPUexhaustiononthecomponent.Insummary,
[4]. weaimtodiscoverfailuresbyKPIanomalydetectionandthen
Thereareseveralexistingresearchworks[19,24]utilizingthe identifytheroot-causecomponentsandtheroot-causemetrics.
dataprovidedbyAIOpsChallenge2019.NotethatthedatasetsB 0‚àº As introduced in Section 3, KPI anomaly detection has been
B 4 usedandpublishedbySqueeze[24]arebasedonexactlythe extensivelystudied.Theexistingapproachesofidentifyingroot-
sameoriginaldataasthedatasetùêµdescribedaboveandgenerated
causecomponents[17,20,23,26,32,45,51]canbeclassifiedinto
byalmostthesamesynthesisprocess. twocategories,i.e.,trace-based[17,23,26,45,51]anddependency
graph-based[20,32].Therearealsosomeworks[30,42]further
5 FAILUREDISCOVERYANDDIAGNOSIS identifyingroot-causemetrics.MicroDiag[42]modelsthedepen-
InSection3andSection4,weintroduceourdatasetsonKPIanom- denciesamongmetricsbycausalitydiscoveryandranksmetrics
alydetectionandrootcauselocalizationformulti-dimensionaldata. byPageRank.FluxRank[30]ranksmetricsbylearning-to-rank.
Thesedatasetsareusefultobenchmarkfailurediscoveryandfail-
5.2 Dataset
urediagnosisalgorithmsrespectively.However,ontheonehand,
engineersrequireautomaticfailurediscoveryanddiagnosisinan Mostexistingworksonfailurediagnosisuseprivatedatasetsfor
end-to-endmanner.Ontheotherhand,rootcauselocalizationfor evaluation.Someexistingworks[23,51]publishedtheirdatasets,
multi-dimensionaldataprovidesonlycluestotheexactrootcauses, but these datasets contain only traces and thus do not support
anditstillrequiresfurtherdiagnosistoobtainfine-grainedroot fine-grainedfailurediagnosis.Furthermore,thoughtherearealso
causesgivensuchclues.Thus,weconstructadatasetforbench- some public datasets (e.g., Azure5 and Alibaba6) including fine-
markingbothfailurediscoveryandfined-grainedfailurediagnosis grainedmetrics,therearenoground-truthfailuretimepointsand
approaches.Inthissection,wefirstintroducethebackgroundof root causes. Therefore, to provide a comprehensive benchmark
theproblem.Thenweintroducethedetailsofourdataset. forfailurediscoveryandfine-graineddiagnosis,weconstructand
publishadataset[3],namedùê∂.Datasetùê∂hasalreadybeenusedby
5.1 Background existingresearchworks[8,23,45].
Thedatasetùê∂isbasedonùë†ùë¶ùë†ùê¥,whosearchitectureisshownin
A distributed system is composed of many cooperating compo-
Fig.3.Therearethreetypesofmonitoringdatainthedatasetùê∂,
nents,suchasloadbalancers,webservers,applicationservers,and
databases.Forexample,inFig.3,wepresentthearchitectureofa i.e.,traces,KPIs,andmetrics.Userrequestsaresenttooneofthe
productiondistributedsystem(namedS)atamajorInternetser- OSBcomponentsandtheninvokeothercomponents,including
viceprovider,ChinaMobileZhejiang.InFig.3,eachvertexisa ServiceandDB.Thewholeexecutionprocessofauserrequestis
component.Thesecomponentsareoffiveclasses,includingOSB calledatrace.Werecordeachtracebyitsspansoneachcomponent,
(OracleServiceBus),service,DB,Docker,andOS.Tomonitorthe includingtheattributesofeachspanandthecausalrelationships
statusofthecomponents,engineerscollectvariousKPIsofthese amongspans.Aspanisaunitofworkdoneinacomponentofa
5https://github.com/Azure/AzurePublicDataset