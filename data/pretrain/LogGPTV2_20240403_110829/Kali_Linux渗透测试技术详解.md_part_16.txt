IIS/7.0的Microsoft服务器。
口IIS/5.0hostmame:YourCompany.comcountry:FR表示搜索在法国所有运行IIS/5.0的
系统。
口Title:camerahostname:YourCompany.com表示在某台主机中标题为camera的信息。
口geo:33.5,36.3os:Linux表示使用坐标轴（经度33.5，纬度36.3）的形式搜索Linux
操作系统。
7.其他搜索术语
口Port：通过端口号搜索。
口OS：通过操作系统搜索。
口After或Before：使用时间搜索服务。
【实例4-6】使用Metasploit实现Shodan搜索。具体操作步骤如下所示。
（1）在Shodanhq.com网站注册一个免费的账户。
(2）从http://www.shodanhq.com/api_doc网站获取APIkey，获取界面如图4.8所示。
· 100 ·
---
## Page 113
第4章信息收集
获取APIkey，为了在后面使用。
 SHODAN - Computer S x
→cwww.sh
品
hodan
Exploits
Scanhub
SHODAN
SuccsAPke tlygd
AP
Analytics
duV9wg
图4.8获取的 API key
（3）启动PostgreSQL服务。执行命令如下所示：
root@kali:~#service postgresql start
（4）启动Metasploit服务。执行命令如下所示：
root@kali:~#service metasploit start
（5）启动MSF终端，执行命令如下所示：
root@kali:~#msfconsole
msf >
（6）选择auxiliary/gather/shodan_search模块，并查看该模块下可配置的选项参数。执
行命令如下所示：
msf > use auxiliary/gather/shodan_search
msfauxiliary(shodan_search)>show options
Module options (auxiliary/gather/shodan_search):
Name
Current Setting Required
Description
DATABASE
false
no
Add search results to the database
FILTER
no
Search for a specific IP/City/Country /Host name
MAXPAGE
yes
Max amount of pages to collect
OUTFILE
no
A filename to store the list of IPs
Proxies
no
Use a proxy chain
QUERY
yes
Keywords you want to search for
SHODAN_APIKEY
yes
The SHODAN API key
VHOST
www.shodanhq.com
yes
The virtual host name to use in requests
从以上输出信息中，可以看到有四个必须配置选项参数。其中有两个选项已经配置，
QUERY和SHODAN_APIKEY还没有配置。
· 101 ·
---
## Page 114
第2篇信息的收集及利用
（7）配置QUERY和SHODANAPIKEY选项参数。执行命令如下所示：
msf auxiliary(shodan_search) > set SHODAN_APIKEY duV9vwgCmo0oDfWqfWafax8sj0ZUa5BU
SHODAN_APIKEY => duV9vwgCmo0oDfWqfWafax8sj0ZUa5BU
msf auxiliary(shodan_search) > set QUERY iomega
QUERY => iomega
从输出的信息中，可以看到QUERY和SHODANAPIKEY选项成功配置。
（8）启动搜索引擎。执行命令如下所示：
msf auxiliary(shodan_search) > run
[*] Total: 160943 on 3219 pages. Showing: 1
[*] Country Statistics:
[]
United Kingdom (GB): 27408
[?]
United States (US): 25648
France (FR): 18397
[?]
Germany (DE): 12918
[]
Netherlands (NL): 6189
[*] Collecting data, please wai...
IP Results
IP
City
Country
Hostname
104.33.212.215:80
N/A
N/A
cpe-104-33-212-215.s0cal.res.rr.com
107.3.154.29:80
Cupertino
United States c-107-3-154-29.hsd1.ca.comcast.net
108.0.152.164:443
Thousand Oaks
United States
pool-108-0-152-164.Jsanca.fios. verizon.net
108.20.167.210:80
Maynard
United
States
pool-108-20-167-210.bstnma.fios.verizon.net
108.20.213.253:443
Franklin
United
States
pool-108-20-213-253.bstnma.fios.verizon.net
109.156.24.235:443
Sheffield
United
Kingdom
host109-156-24-235.range109-156.btcentralplus.com
129.130.72.209:443
Manhattan
United States
130.39.112.9:80
Baton Rouge
United States
Isf-museum.lsu.edu
146.52.252.157:80
Leipzig
Germany
ip9234fc9d.dynamic.kabel-deutschland.de
147.156.26.160:80
Valencia
Spain
gpoeibak.optica.uv.es
94.224.87.80:8080
Peutie
Belgium
94-224-87-80.access.telenet.be
95.93.3.155:80
Faro
Portugal
a95-93-3-155.cpe.netcabo.pt
96.232.103.131:80
Brooklyn
United
States
pool-96-232-103-131.nycmny.fios.verizon.net
96.233.79.133:80
Woburn
United
States
pool-96-233-79-133.bstnma.fios.verizon.net
96.240.130.179:443
Arlington
United
States
pool-96-240-130-179.washdc.fios.verizon.net
97.116.40.223:443
Minneapolis
United States
97-116-40-223.mpls.qwest.net
97.76.110.250:80
Clearwater
United States
rrcs-97-76-110-250.se.biz.rr.com
98.225.213.167:443
Warminster
United
States
· 102 ·
---
## Page 115
第4章信息收集
c-98-225-213-167.hsd1.pa.comcast.net
[]Auxiliarymodule executioncompleted
以上输出的信息显示了匹配iomega关键字的所有信息。搜索的结果显示了四列，分别
表示IP地址、城市、国家和主机名。如果想要使用过滤关键字或得到更多的响应页，用户
必须要购买一个收费的APIkey。
4.8
使用Maltego收集信息
Maltego是一个开源的漏洞评估工具，它主要用于论证一个网络内单点故障的复杂性
和严重性。该工具能够聚集来自内部和外部资源的信息，并且提供一个清晰的漏洞分析界
面。本节将使用KaliLinux操作系统中的Maltego，演示该工具如何帮助用户收集信息。
4.8.1准备工作
在使用Maltego工具之前，需要到https://www.paterva.com/web6/community/maltego/
网站注册一个账号。注册界面如图4.9所示。
DCPt
atigo
介★章
★G图
推了窗自一下.
Register
Register an aco
Finstnam
Lastnamt
Organisation
Emall Address
10120735640q-co
ever
C
Eegister
图4.9注册账号
在该界面填写正确信息后，单击Register按钮，将完成注册。此时，注册账号时使用
的邮箱将会收到一份邮件，登录邮箱，将用户账户激活。
4.8.2使用Maltego工具
使用Maltego工具收集信息。具体操作步骤如下所示：
· 103 ·
---
## Page 116
第2篇信息的收集及利用
（1）启动Maltego工具。依次选择“应用程序”KaliLinux“信息收集”“情报分析”
maltego命令，将显示如图4.10所示的界面。
Welcome to Maltego!
Steps
Startup wizard - Welcome (1 of 5)
1.
Welcome
2.
Login
Welcome to Maltegol
3.
Login result
4
Select transform seeds
1 nof apn8 gm pre2m.541
Update transforms
for first use
tego Clien
5.
We hope that you e
Please
 that the Cor
onlyf
ity Edit
Help
图4.10Maltego欢迎界面
（2）在该界面单击Next按钮，将显示如图4.11所示的界面。
Welcome to Maltego!
Steps
Startup wizard - Login (2 of 5)
1.
Welcome
Enter your details below to log in to the Maltego Community Server
2.
Login
rsarufRon
Or if you have not done so yet, register here
Select transform seeds
Update trarsforms
Login
* Email Address
Pass
Tun
chnm
Einish
Cancel
Help
图4.11登录界面
（3）在该界面输入前面注册用户时的邮箱地址和密码及验证码。然后单击Next按钮，
将显示如图4.12所示的界面。
（4）该界面显示了登录结果信息。此时，单击Next按钮，将显示如图4.13所示的
界面。
· 104 ·
---
## Page 117
第4章信息收集
Welcome to Maltego!
Steps
Startup wizard - Login result (3 of 5)
1.
Welcome
Login
Hello ll, welcome to Maltego Comt
hunity Editionl
3.
Login result
4.
Select transform seeds
Personal details
5.
Update transforms
First name 
li
Sumame
yw
Email address
9qq-com
Your API key is valid urtil April 24, 2014 at 12:00:00 AM CST
Einish
Help
图4.12登录成功
Welcome to Maltego!
Steps
Startup wizard - Select transform seeds (4.of. 5)
Welcome
2.
Login
3.
Select transform seeds
Login result
4.
 Maltego public servers
5.
Update transforms
 Local TAS (Transform Application Server)
Note: The tra
Transforms
Back
图4.13选择转换节点
（5）在该界面发现转换节点信息的来源。然后单击Next按钮，将显示如图4.14所示
的界面。
(6）在该界面选择怎样使用Maltego，这里选择默认的选项Runamachine(NEW!!)。然
后单击Finish按钮，将显示如图4.15所示的界面。
· 105 ·
---
## Page 118
第2篇信息的收集及利用
Welcome to Maltegol
Steps
Startup wizard - Update transforms (5 of 5)
1.
Welcome
Login
Ready...et...GO!
3.
4.
Loginresult
Select transform seeds
5.
Update transforms
3 new application server(s) were found
123 new transforms were found
75 new entities were installed
 Run a machine (NEWII)
 Open a blank graph and let me play arot
 Open an example graph
< βack
Next :
Einish
Help
图4.14更新转换节点
Start a Machine
Steps
Run Machine - Choose machine (1 of 2)
1.
Choose machine
2.
Specify target
Please select the machine to run from the list below.
 Company Stalker
[Domair
in then see wh