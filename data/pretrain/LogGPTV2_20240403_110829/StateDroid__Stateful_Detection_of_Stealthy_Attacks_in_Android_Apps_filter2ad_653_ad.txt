(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
25
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
5
(cid:88)
3
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
5
5
(cid:88)
8
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
12
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
11
(cid:88)
1
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88)
3
7
(cid:88)
(cid:88)
(cid:88)
3
(cid:88)
(cid:88)
(cid:88)
4
#
6
9
3
10
4
3
4
5
9
4
4
7
5
4
5
4
4
5
3
14
7
4
6
4
7
140
Figure 6: Actions detected in 7 Android ransomware fami-
lies.
Ransom.Family
reduce_brightness
abort_notification
remove_shortcut
change_volume
delete_database
reset_password
display_home
turnOn_WiFi
encrypt_file
ringer_silent
turnOn_data
forward_call
lock_device
send_SMS
Actions
leak_info
start_call
LockDroid (cid:88)
LockerPin (cid:88) (cid:88)
Pletor
SimpLocker
SLocker
WannaLocker
Xbot
# Families
(cid:88)
(cid:88)
(cid:88)
5
(cid:88)
(cid:88)
(cid:88) (cid:88)
(cid:88) (cid:88)
(cid:88) (cid:88)
(cid:88) (cid:88) (cid:88)
(cid:88) (cid:88)
(cid:88)
(cid:88)
(cid:88) (cid:88) (cid:88)
(cid:88)
3
(cid:88) (cid:88)
5
6
1
1
1
1
4
(cid:88)
(cid:88)
(cid:88)
(cid:88)
(cid:88) (cid:88) (cid:88)
(cid:88)
(cid:88)
(cid:88)
3
(cid:88) (cid:88)
3
3
(cid:88) (cid:88)
1
4
(cid:88)
(cid:88)
(cid:88)
3
#
6
8
9
6
(cid:88) 7
2
7
45
1
resetPassword() API. Similarly, 3 families are capable of encryp-
ting files on the device. For example, recently discovered Wanna-
Locker malware [53] mimics the behavior of notorious WannaCry
ransomware [57] and uses AES encryption to encrypt files on ex-
ternal storage of the device. Action Detector is able to detect these
actions because it is equipped with the state models for the ob-
jects of involved classes such as Cipher, CipherInputStream, and
FileInputStream.
7.2 RQ2: Accuracy of Attack Detector
Evaluation on Ground-truth Apps: Table 1 shows the detection
results for the 12 Moriarty apps in ground truth dataset. StateDroid
detects 11 actions and 4 action sequence based attacks. For example,
ID 1 app performs contacts theft attack, which is captured by an
Attack State Machine comprising two actions: (i) read user name
and phone number from a contacts database, and (ii) leak this
data by writing it into a sink API. We also find common attacks
in multiple versions (5, 6, 7, 8, 9 and 12) that read data from a file
Contacts theft
Spy on audio, location and
web data
Photo theft
SMS theft
Add fake shortcuts
Table 1: Attacks and actions detected in ground truth mali-
cious apps.
ID Malicious Behaviors
1
2
Detected Attacks And Actions
read_database (contacts) → write_sink
read_database (contacts, browser bookmarks) → write_sink,
record_video, leak_info (location)
read_file (JPG picture) →write_sink
leak_info (SMS message and its sender info)
add_shortcut, change_volume, read_file (JSON) →
write_sink
leak_info (location, device info), read_file (JSON) →
Gather device info and
write_sink
place ads
add_shortcut, read_database (browser bookmarks) →
Place shortcut & notifica-
write_sink, read_file (JSON) → write_sink
tion and install new app
lock_device, encrypt_file, read_file (JSON) → write_sink
lockscreen and crypto
ransomware
log_userclicks, read_file (JSON) → write_sink
9
Click-jacking
Not applicable
10 Device theft
11 DDoS Attack & SMS botnet Not applicable
scan_network, read_file (JSON) →write_sink
12
Search network files
8
3
4
5
6
7
(“/Sherlock/userMailHashed.json") and pass it to a sink API. Actions
in ID 10 and 11 are not reported, because bytecode of both apps do
not have the implementations of relevant malicious behaviors. Our
manual verification reports no false positive and no false negative.
Evaluation on Malware Apps: StateDroid detects 135 stealthy
attacks in total from malware apps, and about 30% of them are action
sequence based attacks. Table 2 shows four cases of such action
sequence based attacks. Row 2 shows the detected action sequence
of NickySpy.C, which spies on victims by executing multiple actions
such as leakage of SMS messages and call logs, recording audio, and
aborting broadcast notifications. NickySpy.C reveals an advanced
stealthy attack that silently answers incoming phone calls and
removes its traces. Particularly, on receiving an incoming phone
call, the attack takes up to 9 actions in the given order. The NickySpy
was reported as the first Android malware to have the ability to
record phone calls [28]. Rows 3–5 of Table 2 show Android.HeHe’s
three action sequence based attacks: (1) silently block incoming
206ACSAC ’18, December 3–7, 2018, San Juan, PR, USA
Mohsin Junaid, Jiang Ming, and David Kung
Table 2: Action sequence based attacks.
Family
NickySpy
Android.HeHe
1
2
3
ID Action Sequence of Detected Attack
1
ringer_silent → turnOff_vibration → hide_dialpad →
answer_call → display_home → block_call → ringer_normal
→ turnOn_vibration → delete_database
ringer_silent → block_call → ringer_normal
check_screenlock → start_call → block_call
abort_notification → autoreply_SMS
phone calls (as discussed in the motivating example), (2) make short-
duration phone calls, and (3) silently block incoming SMS messages.
Android.Hehe’s very low VirusTotal detection ratio [20] indicates
that stealthy malware has more chances to stay undetected.
Evaluation on Benign Apps: StateDroid detects that 117 out of
1, 505 Google Play apps exhibit various stealthy behaviors. For
example, an app named “Couple Tracker” performs spying beha-
viors such as the leakage of sensitive information on incoming
call logs and SMS messages. “com.appybuilder.andrewfortier.rau”
app reveals suspicious behaviors such as recording audio files, ena-
bling or disabling WiFi, and privacy leakage (e.g., incoming SMS
messages). Another app (com.drsalomon.apk), labeled as Trojan
by VirusTotal, can make phone calls to three hard-coded num-
bers. Other apps for which StateDroid detects recording audio fi-
les (com.guide.yanderesimulator.chutimaka) and leaking list
of installed packages (com.helloneighboor) have been already
removed from the Google Play store after a few weeks of being
downloaded.
7.3 RQ3: Comparison with Existing Tools
The closest work to our approach in stealthy behavior detection is
AsDroid (Anti-Stealth Droid) [29]. AsDroid detects a special type
of stealthy behavior by detecting mismatch or incompatibility be-
tween the behavior implemented by a listener of a user interface
component and the text shown on that component. AsDroid and
StateDroid are two very different approaches. The former detects
mismatch between user expectation and implemented behavior,
while StateDroid detects suspicious API call patterns including
sophisticated API call sequences. We believe that these two approa-
ches are complementary although the result may overlap.
In Section 7.1, we identify 49 malware families that reveal ste-
althy attacks. To compare StateDroid and AsDroid, we select 49
samples randomly from each of theses malware families. Due to
the unavailability of AsDroid source code, we simulate AsDroid’s
analysis on 49 samples, and the comparisons are as follows. (1)