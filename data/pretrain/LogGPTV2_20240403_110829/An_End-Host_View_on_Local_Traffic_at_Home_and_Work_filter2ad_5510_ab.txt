### 优化后的文本

#### 本地与广域连接的比较
**图1. 每个用户的本地与广域连接数**
（每个用户的总连接数在2,500到3,000,000之间）

**图2. 每个用户的本地与广域连接传输的数据量**
（每个用户的总数据传输量在800 MB到770 GB之间）

#### 数据分类
- **城市：“圣克鲁斯，加利福尼亚”；国家：“美国”** 被标记为工作环境。
- **ISP：“Free”；城市：“巴黎”；国家：“法国”** 被标记为家庭环境。
这种手动分类将未标记痕迹的比例降低到了2%。某些痕迹没有提供关于网络类型的明确信息。

#### 应用程序分类
为了分析流行应用程序，我们采用两阶段分类过程：
1. 根据进程可执行文件名，将每个连接分配到十一个应用程序类别之一或“未分类”。
2. 对于仍然未分类的连接，根据从端口号推导出的应用程序协议（使用IANA映射）进行分类。
我们将这些类别应用于那些占大多数连接和最大数据量的进程名称和应用程序协议。表1列出了这十一个类别，并给出了每个类别的示例进程名称和应用程序协议。

#### 结果
本节首先总体比较本地和广域流量，然后研究家庭和工作环境中本地和广域流量的分布。

##### 本地与互联网：连接数和字节数
**图1** 和 **图2** 显示了每个用户（用户ID在两个图表中相同以便比较）的本地（底部两个条形）和广域（顶部两个条形）流量比例。对于每个用户，我们将UDP（阴影条形）和TCP（实心条形）流量分开，并分别考虑按连接数（图1）和字节数（图2）的流量组成。

以图1中最右侧的用户（用户ID 34）为例，该用户的77%连接是本地的（其中46%为UDP，31%为TCP）。其余流量则流向互联网（0% UDP，23% TCP）。总体而言，互联网流量在连接数和字节数上都占据主导地位，但在字节数上的主导更为明显。总共，我们将780 GB归类为本地流量，而3 TB归类为广域流量。此外，我们发现几乎80%的用户的本地连接主要由UDP主导。图2中缺乏阴影条形表明几乎所有字节都是通过TCP连接传输的（>89%）。

图2中右侧四个用户在本地传输的字节数多于广域。如后文所述，这些流量大多对应于网络文件系统，因此这些用户可能正在从本地网络存储播放音乐或观看视频。在图2中，超过一半的用户几乎所有的流量都与广域主机交换（验证了之前的发现[5]）。在少数情况下，这些用户确实与本地网络中的主机交换流量，主要是文件传输。

##### 本地与互联网：应用组合
我们现在研究本地和广域应用的区别。**图3** 和 **图4** 分别显示了广域和本地流量的应用组合，按连接数（阴影条形）和数据字节数（实心条形）表示。这些图表使用了第3节描述的应用分类方法，使得不超过12%的连接和7%的字节未分类。

**图3** 显示了广域流量的应用组合。我们看到，各应用类别的字节比例与之前的研究结果一致[6, 7]。Web流量和P2P是主要应用。此外，还有一些文件传输和远程控制流量（如SSH和VNC）。当按连接数分类时，组合发生变化，名称服务仅次于Web位居第二。聊天和电子邮件在连接数上比字节数更普遍。

**图4** 显示了本地流量中名称服务（如DNS）在连接数上占据主导地位，而在字节数上则是备份和网络文件系统（如AFP和SMB）。一项关于企业流量的先前研究[9]也发现网络文件系统和名称服务在本地流量中占据主导地位，但他们的研究发现了更多的本地电子邮件和Web流量。我们的数据中很大一部分是家庭流量，这可能是造成差异的原因。我们现在将流量分为家庭和工作环境。

##### 家庭与工作环境中的流量
迄今为止，我们的分析混合了来自多个网络环境（包括家庭、工作、机场、咖啡馆或酒店）的流量。基于扩展的环境标签（见第3节），我们不仅研究本地与广域流量之间的差异，还研究不同网络环境之间的差异。**图5** 显示了不同环境中的流量和用户分布。请注意，单个用户可以访问多个环境。应用我们的方法后，我们可以进一步细分流量。

**图5. 不同环境中的流量和用户分布**
- 用户/字节数/连接数
- 私人/公共/其他
- 0 8 0 6 0 4 0 2 0
- 家庭 工作 商业/会议 机场 酒店 咖啡馆 公共 其他
- 0 0 1 0 8 0 6 0 4 0 2 0
- [%] 字节数/连接数
- 家庭/广域 工作/广域 工作/本地 家庭/本地
- 21 23 20 44 9 39 24 13 38 3 31 18 16 26 32 28 14 7 19

通过以上分析，我们可以更清楚地了解不同网络环境中的本地和广域流量特征。