一即非自适应路由选择，其特点是简单和开销较小，但
开销也比较大。
6.1有关路由选择的基本概念
6.1有关路由选择的基本概念
157
158
6
---
## Page 80
口动态路由：
6.路由选择协议
口静态路由：
6.路由选择协议
■对于较为大型的广域网来说，
■静态路由一般适合比较简单的小型网络环境，
■静态路由明确的指明了如何到达目的网络。
通常会采用更加灵活、更具自动特性的动态路由。
只有当静态路由不可用时，才会考虑其他路由。
如果配置了到达某一网络或者某一结点的静态路由，则优先采用静态路由，
高的。
在所有相同目的地址的路由记录中，静态路由的优先级是除"直连路由"外最
由于拓扑结构复杂,
，因为在这样环境中，网络管理
且网络结构可能经常变动,
6.1有关路由选择的基本概念
6.1有关路由选择的基本概念
 160
 159
8
---
## Page 81
口动态路由的特点：
6.路由选择协议
口动态路由的特点：
6.路由选择协议
■仅可生成网络间的路由表项：
■不同动态路由不兼容：
■自动生成双向路由：
■自动通告：
■自动调整：
■自动生成：
路集了两络简由协议后将
口动态路由根据所采用的算法的不同分为不同类型，如RIP、OSPF、EIGRP、IS-IS、
口动态路由不能够生成到达具体节点或主机的动态路由表项。
动态路由可以在相邻路由器上相互通告，以便及时反映拓扑结构的变化，生成新的动态路由
口
口路由器在生成某条路由的动态路由时会自动生成回程路由表项，也就是会同时双向路由表项。
不同的动态路由协议主要适用的网络环境不一样，也是不兼容的，但是支持互相
重发布。
BGP等。
表项。
_将会通告所直接连接的网络，则路由器间就会自动生成路
6.1有关路由选择的基本概念
6.1有关路由选择的基本概念
162
 161
18
---
## Page 82
6.路由选择协议
口
 理想的路由算法：
数据层面
控制层面
■路由选择协议的核心是路由算法，即需要何种算法来获得路由表中的各项目。
■
路由算法应具有的特点是：
口算法应是最佳的。
口算法应具有稳定性。
口算法必须是正确的和完整的。
算法应是公平的。
算法应能适应通信量和网络拓扑的变化，这就是说，要有自适应性。
算法在计算上应简单。
路由选择协议属于网络层控制层面的内容
路由选择算法
转发表
6.1有关路由选择的基本概念
164
28
---
## Page 83
6.路由选择协议
口最佳路由：
6.路由选择协议
口
 分层次的路由选择协议
■互联网采用自适应的（即动态的）、分布式路由选择协议。
■因特网的规模非常大。
■路由选择是个非常复杂的问题：
■实际的路由选择算法，应尽可能接近于理想的算法。
■所谓"最佳"只能是相对于某一种特定要求下得出的较合理选择。
■不存在一种绝对的最佳路由算法。
口自治系统之间的路由选择或域间路由选择(interdomain routing)。
口分为2个层次：
口所有这些路由器之间交换路由信息所需的带宽就会使因特网的通信链路饱和。
口如果让所有的路由器知道所有的网络应怎样到达，
口路由选择的环境往往是不断变化的，而这种变化有时无法事先知道。
口路由选择是网络中的所有结点共同协调工作的结果。
自治系统内部的路由选择或域内路由选择(intradomain routing)。
口
起来也太花时间。
则这种路由表将非常大，处理
6.1有关路由选择的基本概念
6.1有关路由选择的基本概念
166
165
88
---
## Page 84
6.路由选择协议
自治系统（Autonomous System，AS）
6.路由选择协议
■对自治系统AS的定义是强调下面的事实：
■自治系统 AS 的定义：
口尽管一个AS使用了多种内部路由选择协议和度量，
口每一个 AS 对其他 AS 表现出的是一个单一的和一致的路由选择策略。
口是在单一技术管理下的许多网络、P地址以及路由器，而这些路由器使用一种自
治系统内部的路由选择协议和共同的度量。
AS表现出的是-
自治系统
自治系统
自治系统
自治系统
但重要的是一个 AS 对其他
6.1有关路由选择的基本概念
6.1有关路由选择的基本概念
168
167
8
---
## Page 85
口因特网的两大类路由选择协议
6.路由选择协议
口互联网的两大类路由选择协议：
6.路由选择协议
■外部网关协议 EGP(External Gateway Protocol)：ERP
■内部网关协议IGP (Interior Gateway Protocol)：[RP
口在外部网关协议中目前使用最多的是BGP-4。
口若
口目前这类路由选择协议使用得最多，如RIP和OSPF协议。
口在一个自治系统内部使用的路由选择协议。
用内部网关协议
外部网关协议EGP。
就需要使户
（例如，RIP）
自治系统A
X
，当数据报传到一个自治系统的边界时，
X
用部网关协议
6.1有关路由选择的基本概念
6.1有关路由选择的基本概念
自治系统 B
170
 169
---
## Page 86
口因特网的两大类路由选择协议
6.路由选择协议
距离向量
互联网路由选择协议
OSPF
6.1有关路由选择的基本概念
8
---
## Page 87
口好路由="距离短"的路由。
口RIP 对"距离"的定义：
6.路由选择协议
口路由信息协议(Routing Information Protocol，RIP)是内部网关协议 IGP
6.路由选择协议
■RIP 不能在两个网络之间同时使用多条路由，只选择距离最短"的路由。
■"距离"的最大值为16时即相当于不可达。
■一条路径最多只能包含15个路由器。
■最佳路由="距离最短"的路由。
■路由器到非直接连接的网络的距离=所经过的路由器数+1。
■从路由器到直接连接的网络的距离=1。
■RIP 最大优点是：简单。
■RIP 是一种分布式的基于距离向量的路由选择协议，是因特网的标准协议。
中最先得到广泛使用的协议。
离记录。
RIP 要求网络中的每个路由器都要维护从它自己到其他每一个目的网络的距
广泛使用很重要，一种技术只有广泛使用，才能够形成生态体系。
6.2内部网关协议RIP
6.2内部网关协议RIP
174
173
8
---
## Page 88
口路由表的建立过程：
6.路由选择协议
RIP 的三个特点：
6.路由选择协议
■接着：
■然后：
■首先：路由器在刚刚开始工作时，路由表是空的。
■交换的信息是当前本路由器所知道的全部信息，即自己的路由表。
■仅和相邻路由器交换信息。
■
以后：经过若干次更新后，
■
■
的路由选择信息的过程较短。
RIP 的收敛(convergence)过程较快，即在自治系统中所有的结点都得到正确
何一个网络的最短距离和下一跳路由器的地址。
信息。
当网络拓扑发生变化时，路由器也及时向相邻路由器通告拓扑变化后的路由
路由信息更新路由表。
按固定的时间间隔交换路由信息，例如，每隔30秒，然后路由器根据收到的
每一个路由器也只和数目非常有限的相邻路由器交换并更新路由信息。
路由器得出到直接连接的网络的距离，距离定义为1。
，所有的路由器最终都会知道到达本自治系统中任
6.2内部网关协议RIP
6.2内部网关协议RIP
176
175
8
---
## Page 89
口距离向量算法:
6.路由选择协议
口RIP 路由表的主要信息和更新规则：
6.路由选择协议
·对每个相邻路由器（假设其地址为×）发送过来的 RIP报文，路由器：
■路由表更新规则：
■RIP 路由表的主要信息是：目的网络、距离(最短)、
④返回。
②对修改后的 RIP 报文中的每一个项目，重复以下步骤：
①修改 RIP报文中的所有项目（即路由）：把"下一跳"字段中的地址都改为×，并
口使用距离向量算法找出到达每个目的网络的最短距离。
③
器，即将距离置为16（表示不可达）
若3分钟还未收到相邻路由器的更新路由表，则把此相邻路由器记为不可达路由
若路由表中没有目的网络N，则把该项目添加到路由表中。否则
若路由表中网络N的下一跳路由器为×，则用收到的项目替换原路由表中的项目。否则
若收到项目中的距离小于路由表中的距离，则用收到项目更新原路由表中的项目。否则
什么也不做。
目的网络
距离 (最短)
下一跳地址
下一跳地址
6.2内部网关协议RIP
6.2内部网关协议RIP
178
8
---
## Page 90
口路由器之间交换信息：
6.路由选择协议
口距离向量算法:
6.路由选择协议
■
■算法要点：
■算法基础：
个路由器的位置不同，
虽然所有的路由器最终都拥有了整个自治系统的全局路由信息，但由于每一
短的（即跳数最少）。
并不断更新其路由表，使得从每一
口设×是结点A到B 的最短路径上的一个结点。
口Bellman-Ford 算法（或Ford-Fulkerson 算法）。
最短路径
它们的路由表也是不同的。
最短路径
一个路由器到每一个目的网络的路由都是最
最短路径
6.2内部网关协议 RIP
6.2内部网关协议RIP
180
179
9
---
## Page 91
6.路由选择协议
6.路由选择协议
现场测试讨论举例：路由表更新
更新信息，如表4-8(b）所示。试更新路由器R6的路由表。
【例】已知路由器 R6 有表 4-8(a）所示的路由表。现在收到相邻路由器 R4 发来的路由
C来的RIP报文
旧路
48435
ACFEF
更新算法
954
-8(b)
Net6:
let3:
不同的下一跳，
没有新信息，
新路由
6.2内部网关协议RIP
6.2内部网关协议RIP
新跳数大
新跳数小，
ACCCE
182
6
---
## Page 92
口RIP2 报文:
6.路由选择协议
口RIP2 协议的报文格式：
6.路由选择协议
■路由部分：由若干个路由信息组成，
■组成：首部和路由2个部分组成。
>
口路由标记填入自治系统的号码。
口地址族标识符（又称为地址类别）字段用来标志所使用的地址协议。
及到此网络的距离。
后面为具体路由，指出某个网络地址、该网络的子网掩码、下一跳路由器地址以
命令
版本
4字节-
必为 0
-IP数据报·
RIP报文’
首部
UDP用户数据报-
路由部分
地址族标识符
，每个路由信息共20个字节。
下一跳路由器地址
距离(1-16)
子网掩码
网络地址
4字节
路由标记
6.2内部网关协议 RIP
6.2内部网关协议RIP
(20
路由信息
184
183
6
---
## Page 93
RIP 协议特点：
6.路由选择协议
RIP2 报文:
6.路由选择协议
■缺点：
■优点：
■特点：好消息传播得快，坏消息传播得慢
■RIP2具有简单的鉴别功能。
■一个 RIP 报文最多可包括 25 个路由，因而 RIP 报文的最大长度是 4+20
口实现简单，开销较小。
口网络规模有限。最大距离为15（16 表示不可达）
当网络出现故障时，要经过比较长的时间才能将此信息（坏消息）传送到所有的
口坏消息传播得慢，收敛时间过长。
口交换的路由信息为完整路由表，开销较大。
口在鉴别数据之后才写入路由信息，但这时最多只能再放入24个路由信息。
口若使用鉴别功能，则将原来写入第一个路由信息（20个字节）的位置用作鉴别。
 (慢收敛)
6.2 内部网关协议 RIP
6.2内部网关协议 RIP
186
185
6
---
## Page 94
口
6.路由选择协议
6.路由选择协议
口
OSPF只是协议名字，
■实际上，所有的在自治系统内部使用的路由选择协议都是要寻找最短路径的。
的缺点，在1989年开发出来的。
开放最短路径优先（
■现在使用OSPFv2。
■原理很简单，但实现很复杂。
■
■
采用分布式的链路状态协议(link state protocol)。
最短路径优先：使用了Djkstra 提出的最短路径算法SPF。
开放：表明OSPF 协议不是受某一家厂商控制，而是公开发表的。
(Distance Vector)
距离向量
RIP
内部网关协议(IGP)
（Open Shortest Path First，OSPF）是为了克服 RIP
域内路由选择
，并不表示其他路由选择协议不是"最短路径优先"。
互联网路由选择协议
OSPF
外部网关协议(EGP)
域间路由选择
(path vector)
BGP
路径向量
6.3内部网关协议OSPF
6.3内部网关协议OSPF
188
187
6
---
## Page 95
口链路状态数据库（Link-state Database）：
6.路由选择协议
口OSPF的三个主要特点：
OSPF 协议最主要的特征就是使用分布式的链路状态协议（Link State
6.路由选择协议
■由于各路由器之间频繁地交换链路状态信息，因此所有的路由器最终都能建
■
■采用洪泛法(flooding)，向本自治系统中所有路由器发送信息。
■
这个数据库实际上就是全网的拓扑结构图，它在全网范围内是一致的（这称
立一个链路状态数据库。
为链路状态数据库的同步）。
有路由器发送此信息。
当链路状态发生变化或每隔一段时间（如30分钟），路由器才用洪泛法向所
口链路状态：说明本路由器都和哪些路由器相邻，以及该链路的度量(metric)。