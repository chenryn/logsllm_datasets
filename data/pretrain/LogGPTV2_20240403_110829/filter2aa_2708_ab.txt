Flash in Office
Ø Adobe的动作
Ø 以前，如果在Office里尝试运行Flash内容，Flash 
Player插件会先检查当前的container (Office)版本，
如果其低于2010（比如Office 2007），则会弹出对
话框，要求用户确认后Flash内容才会运行
Ø 这称之为Flash for Office的click-to-play
Ø 如果是Office 2010或更高的版本，则不受此影响
Ø 在2018年7月发布的Flash Player 30.0.0.113版本上，
Adobe将上述的功能推广到了所有Office版本上
Ø 由于有了Adobe的动作，之前微软行动没有覆盖
的Office 2010和Office 2013也被覆盖了
Flash在
Microsoft Office
中的攻击途径 - 
Flash in Office
小结
Ø 整个Flash in Office的攻击途径随着用户都升级了他们的Office和Flash，这个经典的攻击
途径就基本上消失了
Ø 关于2018年Flash 0-day爆发原因的猜测
Ø 我们猜测，正是由于Adobe和Microsoft的这些动作，去年我们看到了一波Flash 0-day
的集中爆发
Ø 因为，攻击者们也看到了这个趋势。随着这个攻击途径的消失，如果不及时变现，他
们手上的Flash 0-day将会变得毫无价值
Office版本
措施
Office 2010/2013
弹click-to-play对话框
Office 2016/2019/365
彻底禁止
Flash在
Microsoft Office
中的攻击途径 - 
Flash via Office
Ø 2018年2月，安全研究员揭示了一种称之为Flash via Office（通过Office播放
Flash）的新方法（https://votiro.com/think-you-are-just-watching-a-video-think-
again/）
Ø 攻击者通过滥用Word上的一个叫做“插入在线视频”(insert online video)的功
能，可以让用户通过IE访问他们设置的任意网站。这个网站上的Flash内容将被
直接播放。
Flash在
Microsoft Office
中的攻击途径 - 
Flash via Office
Ø Flash via Office与Flash in Office攻击途径的不同
Ø Flash via Office过程中不存在click-to-play，因此绕过了之前讨论的Microsoft和Adobe的所有缓
解措施
Ø Flash via Office攻击过程并不是自动伴随Word文档被打开就自动运行，而是需要用户点击文档
上的一个object。只需要单击一下，期间没有任何警告，攻击者可用图片来诱导用户点击
Ø Flash in Office中Flash插件是运行在Office的进程中；Flash via Office中Flash插件则是运行在
IE进程中（IE进程是以COM模式启动的）
Ø Flash in Office不需要考虑沙盒的问题；Flash via Office的Flash插件则是运行在IE的沙盒（这
其实不算是个问题，因为IE的沙盒其实很弱，网上都有公开的未被修复的逃逸IE沙盒的方法）
Ø Flash via Office只适用于Office 2013及更新的版本，不适用于Office 2010（影响可忽略）
Flash在Microsoft 
Office中的攻击途径 - 
Flash via Office演示
Flash在Microsoft Office中的攻击途径 - 
Flash via Office小结
Ø Flash via Office攻击途径是一个对经典的Flash in Office
攻击途径很好的替代
Ø 它使得使用Office文件发起利用Flash漏洞的攻击再次成
为可能
Ø 作为防护者，我们建议应特别注意野外的含有此类特征
的Word文档
CLICK ADD RELATED TITLE TEXT, AND CLICK ADD RELATED TITLE 
TEXT, CLICK ADD RELATED TITLE TEXT, CLICK ON ADD RELATED 
TITLE WORDS.
PART.04
Flash在PDF中的攻击途径
Flash在PDF中的攻击途径 
Ø 很少有人探讨过Flash在PDF中的攻击途径
Ø 我们的研究针对两款Windows上最流行的PDF阅读软件
Ø Adobe Reader
Ø Foxit Reader
Flash在PDF中
的攻击途径 – 
Adobe Reader
Ø 一个嵌入了Flash内容的PDF文件被Adobe Reader打开，Flash内容不会被播放。Adobe Reader
会提示引导用户去安装（NPAPI架构的）Flash Player插件程序。
Ø 一旦这个Flash插件被安装，PDF文件里的Flash内容就可以自动播放了。整个过程没有click-to-
play。
Ø Adobe Reader中的Flash攻击安全隐患
Ø Adobe Reader用户可能不会在被提示前主动安装这个（NPAPI架构的）Flash插件。但是，如果这个用户
同时也使用Firefox呢？
Ø 如果用户在使用Firefox的时候确实需要播放一些Flash内容，他会去下载安装（NPAPI架构的）Flash插件。
Ø 该用户认为使用Firefox不会有不可控的安全问题，因为每次用Firefox浏览Flash内容的时候都会提示click-
to-play。
Ø 但是他并没有意识到下次使用Adobe Reader阅读（攻击者发送的）PDF文档时，其中的Flash exploit会自
动运行！
Ø
Adobe Reader也是使用同一款Flash插件；Adobe Reader播放Flash内容的时候没有click-to-play
Flash在PDF中
的攻击途径 – 
Foxit Reader
Ø Foxit Reader安全阅读模式（Safe Reading Mode）
的开启与否决定了Foxit Reader上的Flash攻击是否可
行
Ø 安全阅读模式没有开启时会自动播放PDF里的Flash内
容。
Ø 全新安装的Foxit Reader默认开启其安全阅读模式
Ø 和Adobe Reader使用NPAPI架构的Flash插件不同，
Foxit Reader使用的是（Windows 8/8.1/10默认安装）
的COM架构的Flash插件
Ø Foxit Reader没有沙箱，因此Flash插件会直接以中
等特权(medium integrity level)运行
Flash在PDF中的攻击途径 – 
Foxit Reader演示
Ø 演示: Foxit Reader上开启和禁用安全阅读模式的情况下打开
含有Flash内容的PDF文件
Flash在PDF中
的攻击途径 – 
Foxit Reader
Ø Foxit Reader上的安全阅读模式的管理存在
的安全隐患（其安全阅读模式很容易在用户不
知情下被禁用）
Ø 安全阅读模式的问题一（安全阅读模式很
容易被用户在不经意间禁用）
Ø 比如，如果Foxit Reader打开一种嵌
入了文件的PDF时会弹一个如下的对
话框提示用户
Ø 如果用户简单地点击OK或者直接按回
车键的话，安全阅读模式就直接被禁
用了
Flash在PDF中
的攻击途径 – 
Foxit Reader
Ø 安全阅读模式的问题二（安全阅读模式
在Foxit Reader升级的过程中直接被禁用
了）
Ø 我们在Windows全新安装一个
9.4.1.16828旧版的Foxit Reader。安
装中所有选项都是默认选项。设置显
示安全阅读模式是开启的。
Flash在PDF中
的攻击途径 – 
Foxit Reader
Ø 安全阅读模式的问题二
Ø 我们通过其自带的升级功能来升
级Foxit Reader到2019年8月最新
的9.6.0.25114版本。安装过程中
所有选项也都是默认选项。升级
后设置显示安全阅读模式被禁用
了。
Flash在PDF中
的攻击途径 – 
Foxit Reader
Ø 去官方网站下载最新的9.6.0.25114版
Foxit Reader，在全新的系统里默认安
装后，设置显示安全阅读模式是开启
的。
Ø 这个实验证明，安全阅读模式被禁用
不是Foxit Reader新版本的问题，而是
Foxit Reader自带的升级程序的问题
Ø 升级程序在升级过程中改变了Foxit 
Reader的设置从而使得安全阅读模式
被禁用！
Flash在PDF中的
攻击途径 – 
Foxit Reader小
结
Ø Foxit Reader的升级程序会在用户不知情的情况下禁用安
全阅读模式选项！
Ø 而现实情况是，随着时间的推移，越来越多的用户的
Foxit Reader的安全阅读模式会被禁用
Ø 因为用户肯定在某一时刻会升级
Ø 一旦升级，安全阅读模式就会被禁用
Ø 安全阅读模式被禁用意味着用户打开PDF会有危险 - 
会被嵌入到PDF里的恶意Flash攻击！
Ø Haifei已经向Foxit公司报告了此漏洞。Foxit公司在八月十
五号修复了该漏洞。（CVE待分配）
CLICK ADD RELATED TITLE TEXT, AND CLICK ADD RELATED TITLE 
TEXT, CLICK ADD RELATED TITLE TEXT, CLICK ON ADD RELATED 
TITLE WORDS.
PART.05
总结
Ø 我们深入讨论了各种流行应用程序上的Flash的攻击途径
Ø 浏览器
Ø Chrome, Edge和Firefox上所采取的限制Flash攻击的努力（ click-to-play ）极大地阻断了Flash的攻击
Ø IE的一大弱点是没有针对Flash攻击采取任何缓解措施
Ø Microsoft Office
Ø 2018年中以来Microsoft和Adobe采取的措施几乎成功地封杀了所有Office上的经典的攻击途径。
Ø 我们相信2018年Microsoft和Adobe对Flash所推出的防护措施是同时期Flash 0-day爆发的主要诱因。
Ø 新的Flash via Office的攻击方式值得重视
Ø PDF阅读程序
Ø Adobe Reader存在一个安全隐患（通过FireFox插件的安装）
Ø Foxit Reader的问题更大，我们强烈建议用户定期检查其安全阅读模式的开启
Ø 关于未来
Ø 浏览器。我们认为现代浏览器不会是Flash攻击的主要途径。
手上藏有Flash 0-day的攻击者可能会重新将IE用户做为攻
击目标。
Ø Microsoft Office。攻击者可能会利用新发布的Flash via 
Office技术来实施基于Office文件的攻击。
Ø PDF。关于PDF阅读器，攻击者会针对脆弱的Foxit Reader
用户吗？这个只能靠时间来说话了。
谢谢观看
演讲人
Haifei Li (PI:EMAIL)
Chong Xu (PI:EMAIL)
致谢
感谢McAfee IPS团队的Bing Sun对我们
演讲的建议及演示所给的大力帮助。