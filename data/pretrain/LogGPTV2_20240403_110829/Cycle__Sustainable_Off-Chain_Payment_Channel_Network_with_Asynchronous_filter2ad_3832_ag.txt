with REVIVE, CYCLE can utilize the spare communication
resource for more rebalance thus gaining better performance.
It is ﬂexible, which means based on the congestion level of
the network, the nodes in CYCLE can adopt different batch
updates for communication efﬁciency (see § VI and Fig. 9.)
X. CONCLUSION
In this paper, we presented CYCLE,
the ﬁrst balancing
protocol for a sustainable PCN. It can constantly balance the
PCN without freezing the channels compared with the existing
rebalancing protocol. To evaluate CYCLE, we provided a
proof-of-concept implementation and a simulation based on
the data collected from Lightning and Ripple. The results show
that CYCLE is able to satisfy 31% more payments than the
rebalancing and the improvement will be more signiﬁcant in a
PCN with heavier transaction loads. Besides, the on-chain gas
cost of CYCLE is similar to that of the existing rebalancing
protocol. As a future work, we intend to explore the balancing
protocol on Bitcoin and other cryptocurrencies with reduced
scripting capabilities.
Fig. 9.
Impact of batch update.
is because a bigger noise on the expected offset of participants
results in a global offset which is unsuitable for the cycle. In
practice,  is usually set as less than 1 [47], which reduces the
success ratio by 2% for CYCLE.
4) Communication Efﬁciency: We evaluate the performance
improvement brought by the batch update proposed in § VI.
We deﬁne batch size as the time interval between two expected
offset updates in seconds. For example, when the batch size
equals 10, each participant updates and broadcasts its expected
offset every 10 seconds. For the batch size of 0, a participant
broadcasts its expected offset immediately after each payment.
In Fig. 9, with the increasing of the batch size, both the success
ratio and the message number decrease. According to § VI,
it is because the batch update can slow down the balancing
but also relieve the communication overhead. Furthermore, the
batch update yields more utility when the batch size is small,
i.e., 10 or 20. In particular, when the batch size is 10, the
message number reduces by half but the success ratio only
decreases by about 2.4%.
IX. RELATED WORK
A. Payment Channel Network
Scaling limitations have led to a rich literature corpus
exploring different blockchain scaling solutions such as al-
ternative consensus [16], [24] and sharding [19], [25], [29],
[45], [46]. PCN is an orthogonal scaling solution. The idea of
PCN was ﬁrst implemented in Bitcoin to support fast one-way
payments [42], and then was developed by [9], [36] to support
bi-directional payments, i.e., both parties in each channel can
send and receive money. To extend channels to PCN, which
allows a payment using multiple existing channels instead
of initializing a new channel, Lightning [26] is proposed as
a solution for Bitcoin and Raiden [38] is for Ethereum. To
enhance the performance of PCN by reducing the worst-case
collateral costs of multi-hop payments, Sprites is presented
based on a global smart contract [34]. AMCU [14] realizes
the same goal of Sprites in a blockchain without full smart
contract functionality, such as Bitcoin. Blitz [3] presents a
multi-hop payment protocol without the need of two-phase
commit. A2L [43] proposes a backwards-compatible and efﬁ-
cient payment channel hub protocol. Lukas et al. proposes a
Bitcoin-compatible virtual channel protocol [2].
B. Routing Algorithm
Since only the channels with sufﬁcient balance can support
the payments, a number of researches study the routing algo-
Authorized licensed use limited to: Tsinghua University. Downloaded on August 07,2022 at 13:16:49 UTC from IEEE Xplore.  Restrictions apply. 
51
ACKNOWLEDGMENT
This research was supported by fundings from the Key-
Area Research and Development Program of Guangdong
Province under grant No. 2021B0101400003, Hong Kong
RGC Research Impact Fund (RIF) with the Project No.
R5060-19, General Research Fund (GRF) with the Project
No. 152221/19E, 152203/20E, and 152244/21E,
the Na-
tional Natural Science Foundation of China (61872310 and
62102022), Shenzhen Science and Technology Innovation
Commission (JCYJ20200109142008673) and JSPS KAK-
ENHI No. 21H03424. We thank the anonymous reviewers
of DSN’22 and our shepherd Prof. Alysson Bessani, which
helped improve the paper.
REFERENCES
[1] 1ML, “Real-time lightning network statistics,” https://1ml.com/statistics,
2021.
[2] L. Aumayr, M. Maffei, O. Ersoy, A. Erwig, S. Faust, S. Riahi,
K. Host´akov´a, and P. Moreno-Sanchez, “Bitcoin-compatible virtual
channels,” in 2021 IEEE Symposium on Security and Privacy (SP), 2021,
pp. 901–918.
[3] L. Aumayr, P. Moreno-Sanchez, A. Kate, and M. Maffei, “Blitz: Secure
Multi-Hop payments without Two-Phase commits,” in 30th USENIX
Security Symposium (USENIX Security 21). USENIX Association, Aug.
2021, pp. 4043–4060.
[4] Z. Avarikioti, K. Pietrzak, I. Salem, S. Schmid, S. Tiwari, and M. Yeo,
“Hide & seek: Privacy-preserving rebalancing on payment channel
networks,” arXiv preprint arXiv:2110.08848, 2021.
[5] BitcoinJ, “Working with micropayment channels,” https://bitcoinj.org/
[6] S. Boyd, S. P. Boyd, and L. Vandenberghe, Convex optimization.
working-with-micropayments.
Cambridge university press, 2004.
[7] R. Cheng, F. Zhang, J. Kos, W. He, N. Hynes, N. Johnson, A. Juels,
A. Miller, and D. Song, “Ekiden: A platform for conﬁdentiality-
preserving, trustworthy, and performant smart contracts,” in 2019 IEEE
European Symposium on Security and Privacy (EuroS&P), 2019, pp.
185–200.
[8] K. Croman, C. Decker, I. Eyal, A. E. Gencer, A. Juels, A. Kosba,
A. Miller, P. Saxena, E. Shi, E. G¨un Sirer, D. Song, and R. Wattenhofer,
“On scaling decentralized blockchains,” in Financial Cryptography and
Data Security. Springer Berlin Heidelberg, 2016, pp. 106–125.
[9] C. Decker and R. Wattenhofer, “A fast and scalable payment network
with bitcoin duplex micropayment channels,” in Stabilization, Safety,
and Security of Distributed Systems. Springer International Publishing,
2015, pp. 3–18.
[10] C. Dwork, F. McSherry, K. Nissim, and A. Smith, “Calibrating noise to
sensitivity in private data analysis,” in Proceedings of the Third Con-
ference on Theory of Cryptography, ser. TCC’06. Berlin, Heidelberg:
Springer-Verlag, 2006, p. 265–284.
[11] C. Dwork and A. Roth, The Algorithmic Foundations of Differential
Foundations and Trends in Theoretical Computer Science,
Privacy.
2014.
[12] S. Dziembowski, L. Eckey, S. Faust, and D. Malinowski, “Perun: Virtual
payment hubs over cryptocurrencies,” in 2019 IEEE Symposium on
Security and Privacy (SP), 2019, pp. 106–123.
[13] S. Dziembowski, S. Faust, and K. Host´akov´a, “General state channel
networks,” in Proceedings of the 2018 ACM SIGSAC Conference on
Computer and Communications Security, ser. CCS ’18. New York,
NY, USA: Association for Computing Machinery, 2018, p. 949–966.
[14] C. Egger, P. Moreno-Sanchez, and M. Maffei, “Atomic multi-channel
updates with constant collateral in bitcoin-compatible payment-channel
networks,” in Proceedings of the 2019 ACM SIGSAC Conference on
Computer and Communications Security, ser. CCS ’19. New York,
NY, USA: Association for Computing Machinery, 2019, p. 801–815.
[15] U. Erlingsson, V. Pihur, and A. Korolova, “Rappor: Randomized aggre-
gatable privacy-preserving ordinal response,” in Proceedings of the 2014
ACM SIGSAC Conference on Computer and Communications Security,
ser. CCS ’14.
New York, NY, USA: Association for Computing
Machinery, 2014, p. 1054–1067.
[16] I. Eyal, A. E. Gencer, E. G. Sirer, and R. V. Renesse, “Bitcoin-
ng: A scalable blockchain protocol,” in 13th USENIX Symposium on
Networked Systems Design and Implementation (NSDI 16). Santa Clara,
CA: USENIX Association, Mar. 2016, pp. 45–59.
[17] L. Gudgeon, P. Moreno-Sanchez, S. Roos, P. McCorry, and A. Gervais,
“Sok: Off the chain transactions,” IACR Cryptol. ePrint Arch., vol. 2019,
p. 360, 2019.
[18] E. Heilman, A. Kendler, A. Zohar, and S. Goldberg, “Eclipse attacks on
bitcoin’s peer-to-peer network,” in 24th USENIX Security Symposium
(USENIX Security 15). Washington, D.C.: USENIX Association, Aug.
2015, pp. 129–144.
[19] Z. Hong, S. Guo, P. Li, and W. Chen, “Pyramid: A layered sharding
blockchain system,” in IEEE INFOCOM 2021 - IEEE Conference on
Computer Communications.
IEEE, 2021.
[20] P. Kairouz, S. Oh, and P. Viswanath, “Extremal mechanisms for local
differential privacy,” J. Mach. Learn. Res., vol. 17, no. 1, p. 492–542,
Jan. 2016.
[21] R. Karp, C. Schindelhauer, S. Shenker, and B. Vocking, “Randomized
rumor spreading,” in Proceedings 41st Annual Symposium on Founda-
tions of Computer Science, 2000, pp. 565–574.
[22] R. Khalil and A. Gervais, “Code for revive: Rebalancing off-blockchain
payment networks,” https://github.com/rami-github/revive.
[23] ——, “Revive: Rebalancing off-blockchain payment networks,” in Pro-
the 2017 ACM SIGSAC Conference on Computer and
Association for Computing
ceedings of
Communications Security (CCS 17).
Machinery, 2017, p. 439–453.
[24] E. K. Kogias, P. Jovanovic, N. Gailly, I. Khofﬁ, L. Gasser, and B. Ford,
“Enhancing bitcoin security and performance with strong consistency
via collective signing,” in 25th USENIX Security Symposium (USENIX
Security 16). Austin, TX: USENIX Association, Aug. 2016, pp. 279–
296.
[25] E. Kokoris-Kogias, P. Jovanovic, L. Gasser, N. Gailly, E. Syta, and
B. Ford, “Omniledger: A secure, scale-out, decentralized ledger via
sharding,” in 2018 IEEE Symposium on Security and Privacy (SP).
IEEE, 2018, pp. 583–598.
[26] Lightning, “The lightning network,” https://lightning.network/, 2021.
[27] S. Lin, J. Zhang, and W. Wu, “Fstr: Funds skewness aware transaction
routing for payment channel networks,” in 2020 50th Annual IEEE/IFIP
International Conference on Dependable Systems and Networks (DSN),
2020, pp. 464–475.
[28] lndmanage,
“lndmanage,” https://github.com/bitromortac/lndmanage,
2021.
[29] L. Luu, V. Narayanan, C. Zheng, K. Baweja, S. Gilbert, and P. Saxena,
“A secure sharding protocol for open blockchains,” in Proceedings of
the 2016 ACM SIGSAC Conference on Computer and Communications
Security, ser. CCS ’16.
New York, NY, USA: Association for
Computing Machinery, 2016, p. 17–30.
[30] G. Malavolta, P. Moreno-Sanchez, A. Kate, and M. Maffei, “Silentwhis-
pers: Enforcing security and privacy in decentralized credit networks,” in
Network and Distributed System Security Symposium (NDSS 17), 2017.
[31] G. Malavolta, P. Moreno-Sanchez, A. Kate, M. Maffei, and S. Ravi,
“Concurrency and privacy with payment-channel networks,” in Pro-
the 2017 ACM SIGSAC Conference on Computer and
ceedings of
Communications Security (CCS 17).
Association for Computing
Machinery, 2017, p. 455–471.
[32] P. McCorry, S. Bakshi, I. Bentov, S. Meiklejohn, and A. Miller, “Pisa:
Arbitration outsourcing for state channels,” in Proceedings of the 1st
ACM Conference on Advances in Financial Technologies, ser. AFT ’19.
New York, NY, USA: Association for Computing Machinery, 2019, p.
16–30.
[33] A. Miller, I. Bentov, S. Bakshi, R. Kumaresan, and P. McCorry, “Code
for sprites and state channels: Payment networks that go faster than
lightning,” https://github.com/amiller/sprites.
[34] ——, “Sprites and state channels: Payment networks that go faster than
Springer
lightning,” in Financial Cryptography and Data Security.
International Publishing, 2019, pp. 508–526.
network
daemon,”
https://github.com/
[35] L. Network,
“Lightning
lightningnetwork/lnd.
[36] J. Poon and T. Dryja, “The bitcoin lightning network: Scalable off-chain
instant payments,” http://lightning.network/lightning-network-paper.pdf,
2016.
[37] P. Prihodko, S. Zhigulin, M. Sahno, A. Ostrovskiy, and O. Osuntokun,
“Flare: An approach to routing in lightning network,” White Paper, p.
144, 2016.
Authorized licensed use limited to: Tsinghua University. Downloaded on August 07,2022 at 13:16:49 UTC from IEEE Xplore.  Restrictions apply. 
52
[38] Raiden, “The raiden network,” https://raiden.network/, 2021.
[39] Ripple, “The ripple network,” https://ripple.com/, 2021.
[40] S. Roos, P. Moreno-Sanchez, A. Kate, and I. Goldberg, “Settling
payments fast and private: Efﬁcient decentralized routing for path-based
transactions,” in Network and Distributed System Security Symposium
(NDSS 18), 2018.
[41] V. Sivaraman, S. B. Venkatakrishnan, K. Ruan, P. Negi, L. Yang,
R. Mittal, G. Fanti, and M. Alizadeh, “High throughput cryptocurrency
routing in payment channel networks,” in 17th USENIX Symposium on
Networked Systems Design and Implementation (NSDI 20). Santa Clara,
CA: USENIX Association, Feb. 2020, pp. 777–796.
[42] J. Spilman, “[bitcoin-development] anti dos for tx replacement,” https://
lists.linuxfoundation.org/pipermail/bitcoin-dev/2013-April/002433.html,
2013.
[43] E. Tairi, P. Moreno-Sanchez, and M. Maffei, “A2l: Anonymous atomic
locks for scalability in payment channel hubs,” in 2021 IEEE Symposium
on Security and Privacy (SP), 2021, pp. 1834–1851.
[44] J. Wu, J. Liu, W. Chen, H. Huang, Z. Zheng, and Y. Zhang, “Detecting
mixing services via mining bitcoin transaction network with hybrid
motifs,” IEEE Transactions on Systems, Man, and Cybernetics: Systems,
pp. 1–13, 2021.
[45] M. Zamani, M. Movahedi, and M. Raykova, “Rapidchain: Scaling
blockchain via full sharding,” in Proceedings of the 2018 ACM SIGSAC
Conference on Computer and Communications Security, ser. CCS ’18.
New York, NY, USA: Association for Computing Machinery, 2018, p.
931–948.
[46] J. Zhang, Z. Hong, X. Qiu, Y. Zhan, S. Guo, and W. Chen, “Skychain: A
deep reinforcement learning-empowered dynamic blockchain sharding
system,” in 49th International Conference on Parallel Processing -
ICPP, ser. ICPP ’20. New York, NY, USA: Association for Computing
Machinery, 2020.
[47] T. Zhu, G. Li, W. Zhou, and S. Y. Philip, Differential privacy and
applications. Springer, 2017.
Authorized licensed use limited to: Tsinghua University. Downloaded on August 07,2022 at 13:16:49 UTC from IEEE Xplore.  Restrictions apply. 
53