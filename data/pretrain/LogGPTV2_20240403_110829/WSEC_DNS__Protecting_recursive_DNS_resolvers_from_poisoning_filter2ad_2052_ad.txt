Γ0x20=26forshortdomainnamescontaining6letters(e.g.,cnn.com,aol.com,etc.),Γ0x20=212because[7]reports12astheaveragelengthofdomainnames,andΓ0x20=216.Also,weassumeWSECDNSqueriesareperformedusingrandomalphanumericpreﬁxesoflength5,thusΓWSEC=365(WSECrandomstringsconsistsofcombinationsoflower-caselettersanddigits).Similartopreviouswork[12],inouranalysiswetakeintoaccountaround-trip-time(RTT)betweentheRDNSandanANSequaltoΔT=100ms,andthenumberofavailableANSforagivendomainΓANS=4(wefoundthat“popular”domainnameslikecnn.com,aol.com,google.com,etc.,use4ANS).Fortheattackscenario,weconsideranattackerwhoisabletolaunchabrute-forceDNScachepoisoningattackusingKaminsky’stechnique[13].Weas-sumedtheforgedresponsesarel=80byteslong(sim-ilarto[12]).Also,weconsiderthreepossiblescenarios,inwhichtheattackerhasatotalavailablenetworkband-widthBWof1Mbps,10Mbpsand100Mbps(higherattackBWmaycauseadenialofserviceontheRDNS,insteadofpoisoningthecache,inmanypracticalscenarios).Fur-thermore,weassumetheattackerlaunchesaninstanceoftheattackusingitsentirebandwidthto“ﬂood”theRDNSwithforgedresponseswithintheΔT=100mstime.Iftheﬁrstroundisnotsuccessful,theattackerimmediatelyretrieswithanewinstanceoftheattack.Therefore,theattackfre-quencyisfattack=ΔT−1=1/100ms(i.e.,theattackerrepeatsKaminsky’sattackevery100ms)7.SupposetheattackerisabletosendMspoofedDNSanswerstotheRDNSserverwithintheRTT,afterwhichtheRDNSreceivestheanswerfromtherealauthoritativenameserver.ThenumberMdependsonthebandwidthBWavailabletotheattacker,theRTTΔTandthesizeloftheresponsepackets.Theprobabilityofsuccessfulcachepoisoningforoneattackattemptcanbecomputedas[10]psucc=1−pfail=1−M−1(cid:2)i=0(cid:3)1−1Γ−i(cid:4),Γ>M−1(1)assumingtheforgedresponsesaregeneratedwithoutrepeti-tions8.Equation(1)representstheprobabilityofsuccessofasingleinstanceoftheattack.Γrepresentstheoverallcar-dinalityofthesearchspace.ThetotalprobabilityofsuccessafterlaunchingninstancesoftheattackcanbecomputedasPsucc=1−(1−psucc)n.7Thisisdifferentfrom“traditional”poisoningattacks,inwhichcasetheattackerwouldhavetowaitfortheentireTTLofthedomainnametobepoisoned(e.g.,theTTLofthetargeteddomainnamemaybesev-eralminutes,orevenhours).ItisintuitivethatKaminsky’sattackgreatlyincreasesthechancesofsuccessfulattackwithinagiventimewindow.8Moreprecisely,Equation(1)shouldbepsucc=1−(cid:5)M−1i=0(cid:6)1−qΓ−i(cid:7)[10],butinthefollowingweassumetheRDNSim-plementsdefensemechanismsagainstbirthdayattacks[23](likemostRDNSsoftware),andthereforewesetq=1.0.10.51.05.010.050.0100.0500.00.010.020.050.100.200.501.000.10.51.05.010.050.0100.0500.00.010.020.050.100.200.501.000.10.51.05.010.050.0100.0500.00.010.020.050.100.200.501.000.10.51.05.010.050.0100.0500.00.010.020.050.100.200.501.000.10.51.05.010.050.0100.0500.00.010.020.050.100.200.501.000.10.51.05.010.050.0100.0500.00.010.020.050.100.200.501.000.10.51.05.010.050.0100.0500.00.010.020.050.100.200.501.000.10.51.05.010.050.0100.0500.00.010.020.050.100.200.501.000.10.51.05.010.050.0100.0500.00.010.020.050.100.200.501.000.10.51.05.010.050.0100.0500.00.010.020.050.100.200.501.00TXID + src_port(16)TXID + src_port(16) + NSTXID + src_port(16) + 0x20(6)TXID + src_port(16) + NS + 0x20(6)TXID + WSEC(5)Attack BW = 10 MbpsDaysP(success)Figure3:EffectofportrandomizationonprobabilityofsuccessforKaminsky’sattack,andcomparisonwithWSECDNS.Figure3reportshowtheprobabilityPsuccvariesforgrowingattackdurations(i.e.,growingn),consideringanattackerwhohasaccesstoabandwidthofBW=10Mbps.Figure3considersthecaseinwhichportrandomizationcanbeeffectivelyused,whereasTable1showtheeffectofportderandomizationduetodevicessuchasﬁrewalls,load-balancers,networkaddresstranslators,etc.,whichperformporttranslationwithoutpreservingrandomness[8](weref-eretosuchdevicesasNAT/PAT).ThenumbersbetweenparenthesisinthelegendofbothFigure3andTable1rep-resenttheadditionalbitsofentropyfortherandomsourceportand0x20-bitencodingtechniques,andthelengthoftherandompreﬁxstringsforWSECDNSqueries.ItisclearfromTable1thattheTXIDisnotsufﬁcienttoprotectagainstKaminsky’sattack,becauseinthiscasetheexpectedtime¯TattackafterwhichPsucc=0.5isintheorderofseconds(theexactvaluedependsontheattacker’sbandwidth).EvencombiningtheTXIDwiththerandomchoiceofanANSand0x20-bitencodingfordomainnamescontaining6letters,¯Tattackisintheorderofminutes.Incaseoflongerdomainnames,e.g.,namescontaining12letters,0x20-bitencodingincombinationwiththerandomANSchoiceoffersalittlebetterprotection,bringing¯Tattackuptotheorderofdays,althoughasuccessfulattackisstillquitefeasibleforamotivatedattacker(itwouldtakeabout13hourstoreachPsucc=0.5withBW=10Mbps).0x20-bitencodingstartsprovidingbetterprotectiononlywhen16lettersormorearepresentinthedomainname.Ontheotherhand,regardlessofthelengthofthedomainname,WSECDNSprovidesarobustsolutiontocachepoi-soningattacks,includingKaminsky’sattack[13],becauseeveninabsenceofeffectivesourceUDPportrandomiza-tionanattackerwouldneedtopersistentlyattemptthepoi-soningattackforyearsbeforereachinga50%probabilityofsuccess.Forexample,inorderforanattackertoreachPsucc=0.5withabandwidthBW=10Mbps,itwouldtakeatime¯Tattackofmorethan5years.ByincreasingthelengthoftherandompreﬁxesusedinWSECDNSqueries,978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
11
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 05:38:34 UTC from IEEE Xplore.  Restrictions apply. 
BW=1MbpsBW=10MbpsBW=100MbpsTXID29.08seconds2.87seconds0.25secondsTXID+0x20(6)31.06minutes3.1minutes0.31minutesTXID+0x20(12)33.13hours3.31hours0.33hoursTXID+0x20(16)22.09days2.21days0.22daysTXID+ANS+0x20(6)2.07hours0.21hours0.02hoursTXID+ANS+0x20(12)5.52days0.55days0.055daysTXID+ANS+0x20(16)88.35days8.82days0.88daysTXID+WSEC(5)55.83years5.58years0.56yearsTable1:EffectofportderandomizationduetoNAT/PATdevicesonthetimeneededtoreachPsucc=0.5usingKaminsky’sattackfordifferentcombinationsofdefensescenariosandattacker’sband-width.thetimeneededforasuccessfulpoisoningattackincreasesexponentially.Forexample,ifweincreasedthelengthoftherandompreﬁxstringsto6,evenwithabandwidthfortheattackerequaltoBW=1Gbpsitwouldtakeatime¯Tattackofabout2yearstoreachPsucc=0.5.4ExperimentsWedevelopedaproof-of-conceptimplementationofWSECDNSontopofthePowerDNSrecursiveDNSre-solverversion3.1.7(www.powerdns.com).Ourimple-mentationofWSECDNSconsistsofabout250linesofCcode9.WeexperimentedwithPowerDNS(referredtoaspdnsinthefollowing)withnomodiﬁcations,0x20-bitencodingimplementedontopofpdns(pdns+0x20),andWSECDNSimplementedontopofpdns(pdns+WSEC).Also,weexperimentedwithacombinationofWSECDNSand0x20,whichwerefertoaspdns+WSEC+0x20(16).Inthislattercase,theWSECDNSqueryprocess(seeSec-tion3)isactivatedonlywhenthequerieddomainnamecon-tainslessthan16letters.Otherwise,onlythe0x20-biten-codingisused.WeperformedalltheexperimentsrunningthefourdifferentversionsoftheDNSresolversoftwareonXen(www.xen.org)virtualmachineimageswiththesamecharacteristics,namelyaLinux-basedoperatingsys-temand512MBofRAMpervirtualmachine.WecollectedadatasetofrealDNSqueriestowardstheRDNSresolverofalargeenterprisenetwork.Thecollecteddatasetcon-tainedatotalof5,539,540queriesto473,487distinctdo-mainnames.Thesequerieswereissuedby24,140distincthostsinaperiodofoneday.Wethenextractedarandomsampleof100,000queriesfromthecollecteddatasetandreplayedthissetofDNSqueriesforeachofourexperi-mentswithdifferentconﬁgurationsoftheDNSresolvers.Thesampled100,000querieswhererelatedto40,081dis-tinctdomainnames.AswedonothavecontrolovertheANSsrelatedtothedomainnamesinthereplayedqueries,alltheresultspresentedbelowarerelatedtonon-WSEC-enabledzones,andthereforerepresentameasureofthepricetopayinordertomaintainbackwardcompatibility.9OurimplementationofWSECDNScanbedownloadedfromhttp://roberto.perdisci.com/projects/wsecdns.InordertoestimatethelatencyintroducedbyWSECDNSqueries,foreachquerywemeasuredtheRoundTripTime(RTT)betweenthestub-resolverandtheRDNS.Namely,givenaqueryqissuedbyahostbehindtheRDNS,lett1bethetimewhenqissenttotheRDNSresolver,andt2bethetimewhentheresponsefromtheRDNSresolverwasre-ceived.InthiscaseRTT(q)=t2−t1.WealsomeasuredtheamountofDNStrafﬁcﬂowingfromtheRDNStoau-thoritativenameservers,andtheamountofcacheusedbytheRDNSindifferentscenarios.TheresultsofourexperimentsaresummarizedinTa-ble2.Byreplayingourrandomsampleof100,000queriesmentionedabove,thetotalnumberofqueriestoexter-nalANSsgeneratedbytheRDNSusingtheoriginalim-plementationofpdnsis220,930.Theadditional120,930queriesareduetothefactthateachqueryfromthestub-resolvertotheRDNScausestheRDNStoinitiateare-cursive“discovery”processtoﬁndanANSthatisabletoprovideanauthoritativeresponsetothequery.Amongthe100,000queriesinitiatedbythestub-resolver,3,892re-turnedaServerFailuremessage,whichmeansthatnovalidANSwasfoundfortherequesteddomain.Ontheotherhand,usingpdns+WSECtheRDNSgenerated269,156DNSqueriestoANSs,andreturned4,125ServerFailuremessagestothestub-resolver.Theincreaseinqueryvol-umeisduetotheadditional“handshake”queries.ItisworthnotingthattheWSECDNSqueryprocessisappliedbytheRDNStotheoriginalqueryfromthestub-resolveraswellastoallthequeriesneededtoresolveANSsout-of-bailiwick(i.e.,theonesforwhichthe“glue”recordsintheadditionalsectionoftheresponsecannotbetrusted).TheincreaseinqueriesfromtheRDNStotheANSsisthemajorcauseofincreaseinRTT.Duringallourtestswenoticednosignif-icantincreaseinCPUusageontheRDNSresolver.Thenumberofadditionalqueriesdependsonthe“locality”ofthequeriesfromthestub-resolvers,i.e.,theproportionbe-tweenthenumberofdistinctdomainsqueriedandthenum-berofdistinctzonesinwhichtheyare“located”.Anexten-sivestudyofthesefactorsandtheirimpactontheeffective-nessofthecacheforWSECDNSisquitecomplexandisdeferredtofuturework.TheslightincreaseinthenumberofServerFailuremessagesforpdns+WSECisduetoanartifactofourimplementation.Everytimea“handshake”TXTqueryfromtheRDNStoanunreachable(ormalfunc-tioning)ANScausesaServerFailuremessage,ourimple-mentationofpdns+WSECassumesthezoneisnotWSEC-enabledandretriestoquerybyomittingtheWSECrandompreﬁx.However,sincetheANSisunreachable,thissecondstepisunnecessary,becauseitwillreturnthesameexactServerFailuremessage.ThisproblemcanbesolvedbyoptimizingtheimplementationofourWSECDNSqueryalgorithm.ConsideringthattheRDNSneedstowaitfor3secondsbeforedeclaringanANSunreachableandsend978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
12
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 05:38:34 UTC from IEEE Xplore.  Restrictions apply. 
DNSServer#queriestoANSs#SERVFAILMedianRTTDNStrafﬁcMaxCachepdns220,9303,89252ms28.67MB3.25MBpdns+0x20229,1574,09373ms30.04MB3.25MBpdns+WSEC+0x20(16)255,6054,06687ms37.22MB4.79MBpdns+WSEC269,1564,12590ms41.11MB5.57MBTable2:ComparisonbetweenPowerDNS,0x20andWSECDNS.theServerFailuremessagetothestub-resolver,optimizingourWSECDNSimplementationwouldalsocontributetodecreasethemedianRTT.FromTable2,itiseasytoseethattheincreaseinse-curityprovidedbyWSECDNScomesatapriceintermsoflatency(increaseinRTT),DNStrafﬁc,andmemoryus-age.However,theoverheadduetoWSECDNScanbeinpartmitigatedbysoftwareoptimizationandbycombiningitwiththe0x20-bitencoding(e.g.,fordomainnamesthatcontain16lettersormore).Wearguethatthepricetobepaidintermsofincreaseinoverheadisnotthathigh,inparticularincomparisonwithpdns+0x20,ifweconsidertheobtainedimprovementinsecuritywithrespecttousingonly0x20-bitencoding(seeSection3.5),andconsideringthatcompletebackwardcompatibilityismaintained.5ConclusionWepresentedWildcard-SecureDNS(WSECDNS),anovelDNSqueryprocessthatwiselycombinestheuseofwildcarddomainnamesandTXTresourcerecordstoprotectrecursiveDNSresolvers(RDNS)frombrute-forcecachepoisoningattacks.WeshowedthatWSECDNSmakescachepoisoningattacks,includingKaminaksy’sattack[13],practicallyinfeasible,evenforverymotivatedandpowerfulattackers.Also,WSECDNSprovidescompletebackwardcompatibilitywithnameserversthatdonotintendtosup-portWSECDNSqueries,thusallowingforanincrementaldeployment.Ourapproachdoesnotrequireanychangesattherootandtop-level-domain(TLD)nameservers,thusallowingWSECDNStobedeployedonalarge-scaleinashortperiodoftime.ThisisincontrastwithDNSSEC,forwhichalarge-scaledeploymentseemstobefarinthefu-ture.AcknowledgementsWewouldliketothankDavidDagonandRobertEd-mondsfortheirinsightintotheDNSprotocol,Prof.FarnamJahanianforhisguidancewithimprovingthepaper,ScottRose,TomKarygiannis,andtheanonymousreviewersfortheirhelpfulcomments.ThismaterialisbaseduponworksupportedinpartbytheNationalScienceFoundationunderGrantNo.0627477andGrantNo.0831300,andtheDepartmentofHome-landSecurityunderContractNo.FA8750-08-2-0141.Anyopinions,ﬁndings,andconclusionsorrecommendationsex-pressedinthismaterialarethoseoftheauthorsanddonotnecessarilyreﬂecttheviewsoftheNationalScienceFoun-dationandtheDepartmentofHomelandSecurity.References[1]R.Arends,R.Austein,M.Larson,D.Massey,andS.Rose.DNSsecurityin-troductionandrequirements,March2005.http://www.ietf.org/rfc/rfc4033.txt.[2]R.Arends,R.Austein,M.Larson,D.Massey,andS.Rose.Protocolmodiﬁ-cationsfortheDNSsecurityextensions,March2005.http://www.ietf.org/rfc/rfc4035.txt.[3]R.Arends,R.Austein,M.Larson,D.Massey,andS.Rose.ResourcerecordsfortheDNSsecurityextensions,March2005.http://www.ietf.org/rfc/rfc4034.txt.[4]D.J.Bernstein.djb-dns.http://cr.yp.to/djbdns.html.[5]D.J.Bernstein.DNSCurve.http://dnscurve.org.[6]D.J.Bernstein.TheDNSSecurityMess,2006.http://cr.yp.to/talks.html#2006.10.17.[7]D.Dagon,M.Antonakakis,P.Vixie,J.Tatuya,andW.Lee.IncreasedDNSforgeryresistancethrough0x20-bitencoding.InACMACMCCS,2008.[8]C.R.Dougherty.VulnerabilitynoteVU#800113,2008.https://www.kb.cert.org/vuls/id/800113.[9]D.EastlakeandC.Kaufman.Domainnamesystemsecurityextensions,Jan-uary1997.http://www.ietf.org/rfc/rfc2065.txt.[10]A.HouseholderandI.A.Finlay.VulnerabilitynoteVU#457875,2004.https://www.kb.cert.org/vuls/id/457875.[11]J.G.Høy.AntiDNSspooﬁng-extendedqueryID(XQID),April2008.http://www.jhsoft.com/dns-xqid.htm.[12]A.HubertandR.vanMook.Measuresformakingdnsmoreresilientagainstforgedanswers,July2008.http://tools.ietf.org/html/draft-ietf-dnsext-forgery-resilience-06.[13]D.Kaminsky.Blackops2008–itstheendofthecacheasweknowit.PresentedatBlackHat2008,2008.[14]O.M.Kolkman.DNSSECbasics,risksandbeneﬁts,2005.https://ripe.net/info/ncc/presentations/domain-pulse.pdf.[15]B.Laurie,G.Sisson,R.Arends,andD.Blacka.DNSsecurity(DNSSEC)hashedauthenticateddenialofexistence,March2008.http://www.ietf.org/rfc/rfc5155.txt.[16]D.LeonardandD.Loguinov.Turboking:Frameworkforlarge-scaleinternetdelaymeasurements.InIEEEINFOCOM,2008.[17]E.Lewis.Theroleofwildcardsinthedomainnamesystem,July2006.http://www.ietf.org/rfc/rfc4592.txt.[18]P.Mockapetris.Domainnames-conceptsandfacilities,November1987.http://www.ietf.org/rfc/rfc1034.txt.[19]P.Mockapetris.Domainnames-implementationandspeciﬁcation,November1987.http://www.ietf.org/rfc/rfc1035.txt.[20]J.Oberheide.HardeningDNSwithIPTTLs,2008.http://jon.oberheide.org/blog/2008/08/10/hardening-dns-with-ip-ttls/.[21]E.Osterweil,M.Ryan,D.Massey,andL.Zhang.QuantifyingtheoperationalstatusoftheDNSSECdeployment,2008.UCLATechnicalReporthttp://irl.cs.ucla.edu/papers/080019.pdf.[22]R.Perdisci,M.Antonakakis,X.Luo,andW.Lee.WSECDNS:ProtectingrecursiveDNSresolversfrompoisoningattack(extendedversion),Novem-ber2008.UnpublishedTechnicalReport,http://roberto.perdisci.com/projects/wsecdns.[23]J.Stewart.DNScachepoisoning–thenextgeneration.http://www.secureworks.com/research/articles/dns-cache-poisoning/,2002.[24]M.WongandW.Schlitt.Senderpolicyframework(SPF)forauthorizinguseofdomainsine-mail,version1,April2006.http://www.ietf.org/rfc/rfc4408.txt.