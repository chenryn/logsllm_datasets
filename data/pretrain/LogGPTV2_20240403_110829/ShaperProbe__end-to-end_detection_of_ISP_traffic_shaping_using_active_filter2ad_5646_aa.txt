title:ShaperProbe: end-to-end detection of ISP traffic shaping using active
methods
author:Partha Kanuparthy and
Constantine Dovrolis
ShaperProbe: End-to-end Detection of ISP Trafﬁc Shaping
using Active Methods∗
Partha Kanuparthy, Constantine Dovrolis
School of Computer Science, Georgia Institute of Technology
PI:EMAIL, PI:EMAIL
ABSTRACT
We present an end-to-end measurement method for the de-
tection of traﬃc shaping. Traﬃc shaping is typically im-
plemented using token buckets, allowing a maximum burst
of traﬃc to be serviced at the peak capacity of the link,
while any remaining traﬃc is serviced at a lower shaping
rate. The contribution of this paper is twofold. First, we
develop an active end-to-end detection mechanism, referred
to as ShaperProbe, that can infer whether a particular path
is subject to traﬃc shaping, and in that case, estimate the
shaper characteristics. Second, we analyze results from a
large-scale deployment of ShaperProbe on M-Lab over the
last 24 months, detecting traﬃc shaping in several major
ISPs. Our deployment has received more than one million
runs so far from 5,700 ISPs.
Categories and Subject Descriptors
C.2.3 [Computer-Communication Networks]: Network
Operations—Network monitoring
General Terms
Measurement, Performance
Keywords
Active probing, traﬃc shaping, inference
1.
INTRODUCTION
The increasing penetration of broadband access technolo-
gies, such as DSL, DOCSIS and WiMAX, provides users
with a wide range of upstream and downstream service rates.
Broadband users need to know whether they actually get
the service rates they pay for. On the other hand, ISPs now
have an extensive toolbox of traﬃc management mechanisms
they can apply to their customers’ traﬃc: application clas-
siﬁers, schedulers, active queue managers etc. In this paper
∗This work was supported by a research gift from Google
Inc.
Permission to make digital or hard copies of all or part of this work for
personal or classroom use is granted without fee provided that copies are
not made or distributed for proﬁt or commercial advantage and that copies
bear this notice and the full citation on the ﬁrst page. To copy otherwise, to
republish, to post on servers or to redistribute to lists, requires prior speciﬁc
permission and/or a fee.
IMC’11, November 2–4, 2011, Berlin, Germany.
Copyright 2011 ACM 978-1-4503-1013-0/11/11 ...$10.00.
we focus on a class of such mechanisms referred to as traﬃc
shapers or traﬃc policers.1
A traﬃc shaper is a single-input single-output packet for-
warding module that behaves as follows: Consider a link of
capacity C bps, associated with a “token bucket” of size σ
tokens. Whenever the bucket is not full, tokens are gener-
ated at a rate ρ tokens per second, with ρ  1 at which
the received rate timeseries Rr(i) undergoes a level shift to
a lower value. Our goal is to detect the presence of a level
shift, and estimate the token bucket parameters using Rr(i).
2.1 Detection
We want to detect a level shift in Rr in real-time, i.e., as
we compute the received rate for each new interval. Note
that the receiver RCV is also receiving new packets during
the level-shift detection process, and so our method should
be fast and computationally light-weight to avoid the in-
troduction of timestamping jitter. The detection method is
rather simple and relies on nonparametric rank statistics of
Rr so that it is robust to outliers [15].
We compute ranks online. Suppose that we have esti-
mated n values of Rr so far. At the start of the new interval
n + 1 (i.e., after the receipt of the ﬁrst packet in that inter-
val), we compute Rr(n) and update the ranks r(i) of Rr(i)
for i = 1 . . . n. We identify τ as the start of level shift if it
is the ﬁrst interval index that satisﬁes the following three
conditions.
First, all ranks at the left of τ are equal to or higher than
all ranks at the right of τ :
min
i=1...τ −1
r(i) ≥ max
j=τ +1...n