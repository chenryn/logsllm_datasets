called the N23 scheme, a link-by-link ﬂow control al-
gorithm. Their adaptive N23 algorithm propagates infor-
mation about the available queue space to the next up-
stream router while dynamically adjusting the maximum
circuit queue size based on outgoing cell buffer delays,
leading to a quicker reaction to congestion. Their experi-
ments indicate slightly improved response and download
times for 300 KiB ﬁles.
Transport. Tor’s performance has also been analyzed
at the socket level, resulting in suggestions for a UDP-
based mechanism for data delivery [56] or using a user-
level TCP stack over a DTLS tunnel [47]. While Tor cur-
rently multiplexes all circuits over a single kernel TCP
stream to control information leakage, the TCP-over-
DTLS approach suggests separate user TCP streams for
each circuit and sends all TCP streams between two re-
lays over a single kernel DTLS-secured [40] UDP socket.
As a result, a circuit’s TCP window is not unfairly re-
duced when other high-bandwidth circuits cause queuing
delays or dropped packets.
6.2 Bandwidth Management
Our approach to bandwidth management in this paper
has been to use a token bucket rate-limiter, a classic traf-
ﬁc shaping mechanism [55], to ensure that trafﬁc con-
forms to the desired policies. We now brieﬂy discuss
other approaches to bandwidth management.
Quality of Service. Networks often want to provide
a certain quality of service (QoS) to their subscribers.
There are two main approaches to QoS: Integrated Ser-
vices (IntServ) and Differentiated Services (DiffServ).
In the IntServ [11, 50] model, applications request re-
sources from the network using the resource reservation
protocol [60]. Since the network must maintain the ex-
pected quality for its current commitments, it must en-
sure the load of the network remains below a certain
level. Therefore, new requests may be denied if the net-
work is unable to provide the resources requested. This
approach does not work well in an anonymity network
like Tor since clients would be able to request unbounded
resources without accountability and the network would
be unable to fulﬁll most requests due to bottlenecks.
In the DiffServ [9] model, applications notify the net-
work of the desired service type by setting bits in the IP
header. Routers then tailor performance toward an ex-
pected notion of fairness (e.g. max-min fairness [24, 34]
or proportional fairness [20,21,35]). Leaking this type of
information about a client’s trafﬁc ﬂows is a signiﬁcant
risk to privacy and ways to provide differentiated service
without such risk do not currently exist.
Scheduling. Scheduling algorithms, such as fair queu-
ing [15] and round robin [24, 25], affect the order in
which packets are sent out of a given node, but gen-
erally do not change the total number of packets being
sent. Therefore, unless the sending rate is explicitly re-
duced, the network will still contain similar load regard-
less of the relative priority of individual packets. As ex-
plained in Section 1 and Section 3, scheduling does not
directly reduce network congestion, but may cooperate
with other bandwidth management techniques to achieve
the desired performance characteristics of trafﬁc classes.
7 Conclusion
This paper analyzes client throttling by guard relays to
reduce Tor network bottlenecks and improve responsive-
ness. We explore static throttling conﬁgurations while
designing, implementing, and evaluating three new throt-
tling algorithms that adaptively select which connections
get throttled and dynamically adjust the throttle rate of
each connection. Our adaptive throttling techniques use
only local relay information and are considerably more
effective than static throttling since they do not require
re-evaluation of throttling parameters as network load
changes. We ﬁnd that client throttling is effective at
both improving performance for interactive clients and
increasing Tor’s network resilience. We also analyzed
the effects throttling has on anonymity and discussed the
security of our algorithms against realistic adversarial at-
tacks. We ﬁnd that throttling improves anonymity: a
guard’s bandwidth leaks more information about its cir-
cuits when throttling is disabled.
Future Work. There are many directions for future re-
search. Our current algorithms may be modiﬁed to op-
timize performance by improving classiﬁcation of bulk
trafﬁc, considering alternative strategies for distinguish-
ing web from bulk connections. Additional approaches
to rate-tuning are also of interest, e.g. it may be possi-
ble to further improve web client performance using pro-
portional fairness to schedule trafﬁc on circuits. Also of
13
interest is an analysis of throttling in the context of con-
gestion and ﬂow control to determine the interrelation
and effects the algorithms have on each other. Finally, a
deeper understanding of our algorithms and their effects
on client performance would be possible through analy-
sis on the live Tor network.
Acknowledgements. We thank Roger Dingledine for
helpful discussions regarding this work and the anony-
mous reviewers for their feedback and suggestions. This
research was supported by NFS grant CNS-0917154,
ONR, and DARPA.
References
[1] The Libevent Event Notiﬁcation Library, Version 2.0. http:
//monkey.org/˜provos/libevent/.
[2] The Shadow Simulator. http://shadow.cs.umn.edu/.
[3] The Tor Metrics Portal. http://metrics.torproject.
org/.
[4] The Tor Project. https://www.torproject.org/.
[5] Throttling Algorithms Code Repository. https://github.
com/robgjansen/torclone.
[6] ACQUISTI, A., DINGLEDINE, R., AND SYVERSON, P. On the
Economics of Anonymity. In Proceedings of Financial Cryptog-
raphy (January 2003), R. N. Wright, Ed., Springer-Verlag, LNCS
2742.
[7] ALSABAH, M., BAUER, K., GOLDBERG, I., GRUNWALD, D.,
MCCOY, D., SAVAGE, S., AND VOELKER, G. DefenestraTor:
Throwing out Windows in Tor. In Proceedings of the 11th Inter-
national Symposium on Privacy Enhancing Technologies (2011).
[8] BACK, A., MOLLER, U., AND STIGLIC, A. Trafﬁc Analysis
Attacks and Trade-offs in Anonymity Providing Systems. In Pro-
ceedings of Information Hiding Workshop (2001), pp. 245–257.
[9] BLAKE, S., BLACK, D., CARLSON, M., DAVIES, E., WANG,
Z., AND WEISS, W. An Architecture for Differentiated Services,
1998.
[10] BORISOV, N., DANEZIS, G., MITTAL, P., AND TABRIZ, P. De-
In Proceedings of the
nial of Service or Denial of Security?
14th ACM conference on Computer and communications secu-
rity (2007), ACM, pp. 92–102.
[11] BRADEN, B., CLARK, D., AND SHENKER, S. Integrated Ser-
vice in the Internet Architecture: an Overview.
[12] CHEN, F., AND PERRY, M.
Improving Tor Path Selection.
https://gitweb.torproject.org/torspec.git/
blob/HEAD:/proposals/151-path-selection-
improvements.txt.
[13] CHUN, B., CULLER, D., ROSCOE, T., BAVIER, A., PETER-
SON, L., WAWRZONIAK, M., AND BOWMAN, M. PlanetLab: an
Overlay Testbed for Broad-coverage Services. SIGCOMM Com-
puter Communication Review 33 (2003), 3–12.
[14] CROTTI, M., DUSI, M., GRINGOLI, F., AND SALGARELLI, L.
Trafﬁc Classiﬁcation Through Simple Statistical Fingerprinting.
SIGCOMM Comput. Commun. Rev. 37 (January 2007), 5–16.
[15] DEMERS, A., KESHAV, S., AND SHENKER, S. Analysis and
Simulation of a Fair Queueing Algorithm. In ACM SIGCOMM
Computer Communication Review (1989), vol. 19, ACM, pp. 1–
12.
[16] DINGLEDINE, R.
Iran Blocks Tor.
https://blog.
torproject.org/blog/iran-blocks-tor-tor-
releases-same-day-fix.
[17] DINGLEDINE, R. Research problem: adaptive throttling of Tor
https://blog.torproject.
clients by entry guards.
org/blog/research-problem-adaptive-
throttling-tor-clients-entry-guards.
[18] DINGLEDINE, R., AND MATHEWSON, N. Anonymity Loves
In Proceedings
Company: Usability and the Network Effect.
of the Fifth Workshop on the Economics of Information Security
(WEIS 2006), Cambridge, UK, June (2006).
[19] DINGLEDINE, R., MATHEWSON, N., AND SYVERSON, P. Tor:
The Second-Generation Onion Router. In Proceedings of the 13th
USENIX Security Symposium (2004).
[20] DOVROLIS, C., AND RAMANATHAN, P. A Case for Rela-
tive Differentiated Services and the Proportional Differentiation
Model. Network, IEEE 13, 5 (1999), 26–34.
[21] DOVROLIS, C., STILIADIS, D., AND RAMANATHAN, P. Propor-
tional Differentiated Services: Delay Differentiation and Packet
Scheduling. In Proceedings of the Conference on Applications,
Technologies, Architectures, and Protocols for Computer Com-
munication (1999), pp. 109–120.
[22] EVANS, N., DINGLEDINE, R., AND GROTHOFF, C. A Practical
Congestion Attack on Tor Using Long Paths. In Proceedings of
the 18th USENIX Security Symposium (2009), pp. 33–50.
[23] GOLDSCHLAG, D. M., REED, M. G., AND SYVERSON, P. F.
Hiding Routing Information. In Proceedings of Information Hid-
ing Workshop (1996), pp. 137–150.
[24] HAHNE, E. Round-robin Scheduling for Max-min Fairness in
Data Networks. IEEE Journal on Selected Areas in Communica-
tions 9, 7 (1991), 1024–1039.
[25] HAHNE, E., AND GALLAGER, R. Round-robin Scheduling for
Fair Flow Control in Data Communication Networks. NASA
STI/Recon Technical Report N 86 (1986), 30047.
[26] HARDIN, G. The Tragedy of the Commons. Science 162, 3859
(December 1968), 1243–1248.
[27] HERNANDEZ-CAMPOS, F., JEFFAY, K., AND SMITH, F. Track-
In The 11th
ing the Evolution of Web Trafﬁc: 1995-2003.
IEEE/ACM International Symposium on Modeling, Analysis, and
Simulation of Computer Telecommunications Systems (2003),
pp. 16–25.
[28] HINTZ, A.
Fingerprinting Websites using Trafﬁc Analysis.
In Proceedings of Privacy Enhancing Technologies Workshop
(2002), pp. 171–178.
[29] HJELMVIK, E., AND JOHN, W. Statistical Protocol Identiﬁcation
with SPID: Preliminary Results. In Swedish National Computer
Networking Workshop (2009).
[30] HOPPER, N., VASSERMAN, E., AND CHAN-TIN, E. How Much
Anonymity Does Network Latency Leak? ACM Transactions on
Information and System Security 13, 2 (2010), 1–28.
[31] JANSEN, R., AND HOPPER, N. Shadow: Running Tor in a Box
In Proceedings of
for Accurate and Efﬁcient Experimentation.
the 19th Network and Distributed System Security Symposium
(2012).
[32] JANSEN, R., HOPPER, N., AND KIM, Y. Recruiting New
In Proceedings of the 17th ACM
Tor Relays with BRAIDS.
Conference on Computer and Communications Security (2010),
pp. 319–328.
[33] JANSEN, R., SYVERSON, P., AND HOPPER, N. Throttling Tor
Bandwidth Parasites. Tech. Rep. 11-019, University of Min-
nesota, 2011.
[34] KATEVENIS, M. Fast Switching and Fair Control of Congested
Flow in Broadband Networks. Selected Areas in Communica-
tions, IEEE Journal on 5, 8 (1987), 1315–1326.
14
[47] REARDON, J., AND GOLDBERG, I. Improving Tor using a TCP-
over-DTLS tunnel. In Proceedings of the 18th USENIX Security
Symposium (2009).
[48] REED, M., SYVERSON, P., AND GOLDSCHLAG, D. Anony-
mous Connections and Onion Routing. IEEE Journal on Selected
Areas in Communications 16, 4 (1998), 482–494.
[49] SERJANTOV, A., AND SEWELL, P. Passive Attack Analysis
for Connection-based Anonymity Systems. Computer Security–
ESORICS (2003), 116–131.
[50] SHENKER, S., PARTRIDGE, C., AND GUERIN, R. RFC 2212:
Speciﬁcation of Guaranteed Quality of Service, Sept. 1997. Sta-
tus: PROPOSED STANDARD.
[51] SNADER, R., AND BORISOV, N. A Tune-up for Tor: Improving
Security and Performance in the Tor Network. In Proceedings of
the 16th Network and Distributed Security Symposium (2008).
[52] TANG, C., AND GOLDBERG, I. An Improved Algorithm for Tor
Circuit Scheduling. In Proceedings of the 17th ACM Conference
on Computer and Communications Security (2010), pp. 329–339.
In-
https://gitweb.torproject.org/
[53] TSCHORSCH, F., AND SCHEUERMANN, B.
tervals.
torspec.git/blob/HEAD:/proposals/183-
refillintervals.txt.
Reﬁll
[54] TSCHORSCH, F., AND SCHEUERMANN, B. Tor is Unfair–and
What to Do About It, 2011.
[55] TURNER, J. New directions in communications(or which way to
the information age?). IEEE communications Magazine 24, 10
(1986), 8–15.
[56] VIECCO, C. UDP-OR: A Fair Onion Transport Design.
In
Proceedings of Hot Topics in Privacy Enhancing Technologies
(2008).
[57] WANG, T., BAUER, K., FORERO, C., AND GOLDBERG, I.
Congestion-aware Path Selection for Tor. In Proceedings of Fi-
nancial Cryptography (2012).
[58] WRIGHT, M., ADLER, M., LEVINE, B. N., AND SHIELDS, C.
An Analysis of the Degradation of Anonymous Protocols. In Pro-
ceedings of the Network and Distributed Security Symposium -
NDSS ’02 (February 2002), IEEE.
[59] WRIGHT, M., ADLER, M., LEVINE, B. N., AND SHIELDS, C.
Defending Anonymous Communication Against Passive Logging
Attacks. In Proceedings of the 2003 IEEE Symposium on Security
and Privacy (May 2003), pp. 28–43.
[60] ZHANG, L., DEERING, S., ESTRIN, D., SHENKER, S., AND
ZAPPALA, D. Rsvp: A new resource reservation protocol. Net-
work, IEEE 7, 5 (1993), 8–18.
[35] KELLY, F., MAULLOO, A., AND TAN, D. Rate Control for
Communication Networks: Shadow Prices, Proportional Fairness
and Stability. Journal of the Operational Research society 49, 3
(1998), 237–252.
[36] KOHNEN, C., UBERALL, C., ADAMSKY, F., RAKOCEVIC, V.,
RAJARAJAN, M., AND JAGER, R. Enhancements to Statis-
tical Protocol IDentiﬁcation (SPID) for Self-Organised QoS in
In Computer Communications and Networks (ICCCN),
LANs.
2010 Proceedings of 19th International Conference on (2010),
IEEE, pp. 1–6.
[37] LOESING, K. Measuring the Tor network: Evaluation of client
requests to directories. Tech. rep., Tor Project, 2009.
[38] MCCOY, D., BAUER, K., GRUNWALD, D., KOHNO, T., AND
SICKER, D. Shining Light in Dark Places: Understanding the
Tor Network. In Proceedings of the 8th International Symposium
on Privacy Enhancing Technologies (2008), pp. 63–76.
[39] MITTAL, P., KHURSHID, A., JUEN, J., CAESAR, M., AND
BORISOV, N. Stealthy Trafﬁc Analysis of Low-Latency Anony-
mous Communication Using Throughput Fingerprinting. In Pro-
ceedings of the 18th ACM conference on Computer and Commu-
nications Security (October 2011).
[40] MODADUGU, N., AND RESCORLA, E. The Design and Imple-
mentation of Datagram TLS. In Proceedings of the 11th Network
and Distributed System Security Symposium (2004).
[41] MOORE, W. B., WACEK, C., AND SHERR, M. Exploring the
Potential Beneﬁts of Expanded Rate Limiting in Tor: Slow and
In Proceedings of 2011
Steady Wins the Race With Tortoise.
Annual Computer Security Applications Conference (December
2011).
[42] MURDOCH, S., AND DANEZIS, G. Low-cost Trafﬁc Analysis
In IEEE Symposium on Security and Privacy (2005),
of Tor.
pp. 183–195.
[43] NGAN, T.-W. J., DINGLEDINE, R., AND WALLACH, D. S.
In The Proceedings of Financial
Building Incentives into Tor.
Cryptography (2010).
[44] ØVERLIER, L., AND SYVERSON, P. Locating Hidden Servers.
In Proceedings of the 2006 IEEE Symposium on Security and Pri-
vacy (May 2006), IEEE CS.
[45] RAMACHANDRAN, S.
Size and Num-
ber of Resources. http://code.google.com/speed/
articles/web-metrics.html, 2010. Accessed February,
2012.
Web Metrics:
[46] RAYMOND, J. Trafﬁc Analysis: Protocols, Attacks, Design Is-
sues, and Open Problems. In Designing Privacy Enhancing Tech-
nologies (2001), pp. 10–29.
15