# exitexitchild has terminated 
# echo $$           64267通过 echo \$\$，我们可以得到当前 bash的进程号。一旦运行了上面的程序，我们就会进入一个新的 pid 的 namespace。当我们再次 echo []{.MathJax_Previewstyle="color: inherit; display: none;"} {.MathJax_Display style="text-align: center;"}``{=html}[[[[[的]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-332.mo}]{#59.html#MathJax-Span-331 .mrow}]{#59.html#MathJax-Span-330.texatom}[时]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-335.mo}]{#59.html#MathJax-Span-334 .mrow}]{#59.html#MathJax-Span-333.texatom}[候]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-338.mo}]{#59.html#MathJax-Span-337 .mrow}]{#59.html#MathJax-Span-336.texatom}[，]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-341.mo}]{#59.html#MathJax-Span-340 .mrow}]{#59.html#MathJax-Span-339.texatom}[就]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-344.mo}]{#59.html#MathJax-Span-343 .mrow}]{#59.html#MathJax-Span-342.texatom}[会]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-347.mo}]{#59.html#MathJax-Span-346 .mrow}]{#59.html#MathJax-Span-345.texatom}[发]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-350.mo}]{#59.html#MathJax-Span-349 .mrow}]{#59.html#MathJax-Span-348.texatom}[现]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-353.mo}]{#59.html#MathJax-Span-352 .mrow}]{#59.html#MathJax-Span-351.texatom}[当]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-356.mo}]{#59.html#MathJax-Span-355 .mrow}]{#59.html#MathJax-Span-354.texatom}[前]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-359.mo}]{#59.html#MathJax-Span-358 .mrow}]{#59.html#MathJax-Span-357.texatom}[b]{#59.html#MathJax-Span-360 .mistyle="font-family: MathJax_Math-italic;"}[a]{#59.html#MathJax-Span-361.mistyle="font-family: MathJax_Math-italic;"}[s]{#59.html#MathJax-Span-362.mistyle="font-family: MathJax_Math-italic;"}[h]{#59.html#MathJax-Span-363.mistyle="font-family: MathJax_Math-italic;"}[的]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-366.mo}]{#59.html#MathJax-Span-365 .mrow}]{#59.html#MathJax-Span-364.texatom}[进]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-369.mo}]{#59.html#MathJax-Span-368 .mrow}]{#59.html#MathJax-Span-367.texatom}[程]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-372.mo}]{#59.html#MathJax-Span-371 .mrow}]{#59.html#MathJax-Span-370.texatom}[号]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-375.mo}]{#59.html#MathJax-Span-374 .mrow}]{#59.html#MathJax-Span-373.texatom}[变]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-378.mo}]{#59.html#MathJax-Span-377 .mrow}]{#59.html#MathJax-Span-376.texatom}[成]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-381.mo}]{#59.html#MathJax-Span-380 .mrow}]{#59.html#MathJax-Span-379.texatom}[了]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-384.mo}]{#59.html#MathJax-Span-383 .mrow}]{#59.html#MathJax-Span-382.texatom}[1]{#59.html#MathJax-Span-385 .mnstyle="font-family: MathJax_Main;"}[。]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-388.mo}]{#59.html#MathJax-Span-387 .mrow}]{#59.html#MathJax-Span-386.texatom}[上]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-391.mo}]{#59.html#MathJax-Span-390 .mrow}]{#59.html#MathJax-Span-389.texatom}[面]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-394.mo}]{#59.html#MathJax-Span-393 .mrow}]{#59.html#MathJax-Span-392.texatom}[的]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-397.mo}]{#59.html#MathJax-Span-396 .mrow}]{#59.html#MathJax-Span-395.texatom}[程]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-400.mo}]{#59.html#MathJax-Span-399 .mrow}]{#59.html#MathJax-Span-398.texatom}[序]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-403.mo}]{#59.html#MathJax-Span-402 .mrow}]{#59.html#MathJax-Span-401.texatom}[运]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-406.mo}]{#59.html#MathJax-Span-405 .mrow}]{#59.html#MathJax-Span-404.texatom}[行]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-409.mo}]{#59.html#MathJax-Span-408 .mrow}]{#59.html#MathJax-Span-407.texatom}[了]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-412.mo}]{#59.html#MathJax-Span-411 .mrow}]{#59.html#MathJax-Span-410.texatom}[一]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-415.mo}]{#59.html#MathJax-Span-414 .mrow}]{#59.html#MathJax-Span-413.texatom}[个]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-418.mo}]{#59.html#MathJax-Span-417 .mrow}]{#59.html#MathJax-Span-416.texatom}[新]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-421.mo}]{#59.html#MathJax-Span-420 .mrow}]{#59.html#MathJax-Span-419.texatom}[的]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-424.mo}]{#59.html#MathJax-Span-423 .mrow}]{#59.html#MathJax-Span-422.texatom}[b]{#59.html#MathJax-Span-425 .mistyle="font-family: MathJax_Math-italic;"}[a]{#59.html#MathJax-Span-426.mistyle="font-family: MathJax_Math-italic;"}[s]{#59.html#MathJax-Span-427.mistyle="font-family: MathJax_Math-italic;"}[h]{#59.html#MathJax-Span-428.mistyle="font-family: MathJax_Math-italic;"}[，]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-431.mo}]{#59.html#MathJax-Span-430 .mrow}]{#59.html#MathJax-Span-429.texatom}[它]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-434.mo}]{#59.html#MathJax-Span-433 .mrow}]{#59.html#MathJax-Span-432.texatom}[在]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-437.mo}]{#59.html#MathJax-Span-436 .mrow}]{#59.html#MathJax-Span-435.texatom}[一]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-440.mo}]{#59.html#MathJax-Span-439 .mrow}]{#59.html#MathJax-Span-438.texatom}[个]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-443.mo}]{#59.html#MathJax-Span-442 .mrow}]{#59.html#MathJax-Span-441.texatom}[独]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-446.mo}]{#59.html#MathJax-Span-445 .mrow}]{#59.html#MathJax-Span-444.texatom}[立]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-449.mo}]{#59.html#MathJax-Span-448 .mrow}]{#59.html#MathJax-Span-447.texatom}[的]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-452.mo}]{#59.html#MathJax-Span-451 .mrow}]{#59.html#MathJax-Span-450.texatom}[p]{#59.html#MathJax-Span-453 .mistyle="font-family: MathJax_Math-italic;"}[i]{#59.html#MathJax-Span-454.mistyle="font-family: MathJax_Math-italic;"}[d[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"}]{#59.html#MathJax-Span-455.mistyle="font-family: MathJax_Math-italic;"}[n]{#59.html#MathJax-Span-456.mistyle="font-family: MathJax_Math-italic;"}[a]{#59.html#MathJax-Span-457.mistyle="font-family: MathJax_Math-italic;"}[m]{#59.html#MathJax-Span-458.mistyle="font-family: MathJax_Math-italic;"}[e]{#59.html#MathJax-Span-459.mistyle="font-family: MathJax_Math-italic;"}[s]{#59.html#MathJax-Span-460.mistyle="font-family: MathJax_Math-italic;"}[p]{#59.html#MathJax-Span-461.mistyle="font-family: MathJax_Math-italic;"}[a]{#59.html#MathJax-Span-462.mistyle="font-family: MathJax_Math-italic;"}[c]{#59.html#MathJax-Span-463.mistyle="font-family: MathJax_Math-italic;"}[e]{#59.html#MathJax-Span-464.mistyle="font-family: MathJax_Math-italic;"}[里]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-467.mo}]{#59.html#MathJax-Span-466 .mrow}]{#59.html#MathJax-Span-465.texatom}[面]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-470.mo}]{#59.html#MathJax-Span-469 .mrow}]{#59.html#MathJax-Span-468.texatom}[，]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-473.mo}]{#59.html#MathJax-Span-472 .mrow}]{#59.html#MathJax-Span-471.texatom}[自]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-476.mo}]{#59.html#MathJax-Span-475 .mrow}]{#59.html#MathJax-Span-474.texatom}[己]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-479.mo}]{#59.html#MathJax-Span-478 .mrow}]{#59.html#MathJax-Span-477.texatom}[是]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-482.mo}]{#59.html#MathJax-Span-481 .mrow}]{#59.html#MathJax-Span-480.texatom}[1]{#59.html#MathJax-Span-483 .mnstyle="font-family: MathJax_Main;"}[号]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-486.mo}]{#59.html#MathJax-Span-485 .mrow}]{#59.html#MathJax-Span-484.texatom}[进]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-489.mo}]{#59.html#MathJax-Span-488 .mrow}]{#59.html#MathJax-Span-487.texatom}[程]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-492.mo}]{#59.html#MathJax-Span-491 .mrow}]{#59.html#MathJax-Span-490.texatom}[。]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-495.mo}]{#59.html#MathJax-Span-494 .mrow}]{#59.html#MathJax-Span-493.texatom}[如]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-498.mo}]{#59.html#MathJax-Span-497 .mrow}]{#59.html#MathJax-Span-496.texatom}[果]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-501.mo}]{#59.html#MathJax-Span-500 .mrow}]{#59.html#MathJax-Span-499.texatom}[运]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-504.mo}]{#59.html#MathJax-Span-503 .mrow}]{#59.html#MathJax-Span-502.texatom}[行]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-507.mo}]{#59.html#MathJax-Span-506 .mrow}]{#59.html#MathJax-Span-505.texatom}[i]{#59.html#MathJax-Span-508 .mistyle="font-family: MathJax_Math-italic;"}[p]{#59.html#MathJax-Span-509.mistyle="font-family: MathJax_Math-italic;"}[a]{#59.html#MathJax-Span-510.mistyle="font-family: MathJax_Math-italic;"}[d[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"}]{#59.html#MathJax-Span-511.mistyle="font-family: MathJax_Math-italic;"}[d[]{style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"}]{#59.html#MathJax-Span-512.mistyle="font-family: MathJax_Math-italic;"}[r]{#59.html#MathJax-Span-513.mistyle="font-family: MathJax_Math-italic;"}[，]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-516.mo}]{#59.html#MathJax-Span-515 .mrow}]{#59.html#MathJax-Span-514.texatom}[可]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-519.mo}]{#59.html#MathJax-Span-518 .mrow}]{#59.html#MathJax-Span-517.texatom}[以]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-522.mo}]{#59.html#MathJax-Span-521 .mrow}]{#59.html#MathJax-Span-520.texatom}[看]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-525.mo}]{#59.html#MathJax-Span-524 .mrow}]{#59.html#MathJax-Span-523.texatom}[到]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-528.mo}]{#59.html#MathJax-Span-527 .mrow}]{#59.html#MathJax-Span-526.texatom}[，]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-531.mo}]{#59.html#MathJax-Span-530 .mrow}]{#59.html#MathJax-Span-529.texatom}[宿]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-534.mo}]{#59.html#MathJax-Span-533 .mrow}]{#59.html#MathJax-Span-532.texatom}[主]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-537.mo}]{#59.html#MathJax-Span-536 .mrow}]{#59.html#MathJax-Span-535.texatom}[机]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-540.mo}]{#59.html#MathJax-Span-539 .mrow}]{#59.html#MathJax-Span-538.texatom}[的]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-543.mo}]{#59.html#MathJax-Span-542 .mrow}]{#59.html#MathJax-Span-541.texatom}[网]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-546.mo}]{#59.html#MathJax-Span-545 .mrow}]{#59.html#MathJax-Span-544.texatom}[卡]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-549.mo}]{#59.html#MathJax-Span-548 .mrow}]{#59.html#MathJax-Span-547.texatom}[都]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-552.mo}]{#59.html#MathJax-Span-551 .mrow}]{#59.html#MathJax-Span-550.texatom}[找]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-555.mo}]{#59.html#MathJax-Span-554 .mrow}]{#59.html#MathJax-Span-553.texatom}[不]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-558.mo}]{#59.html#MathJax-Span-557 .mrow}]{#59.html#MathJax-Span-556.texatom}[到]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-561.mo}]{#59.html#MathJax-Span-560 .mrow}]{#59.html#MathJax-Span-559.texatom}[了]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-564.mo}]{#59.html#MathJax-Span-563 .mrow}]{#59.html#MathJax-Span-562.texatom}[，]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-567.mo}]{#59.html#MathJax-Span-566 .mrow}]{#59.html#MathJax-Span-565.texatom}[因]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-570.mo}]{#59.html#MathJax-Span-569 .mrow}]{#59.html#MathJax-Span-568.texatom}[为]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-573.mo}]{#59.html#MathJax-Span-572 .mrow}]{#59.html#MathJax-Span-571.texatom}[新]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-576.mo}]{#59.html#MathJax-Span-575 .mrow}]{#59.html#MathJax-Span-574.texatom}[的]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-579.mo}]{#59.html#MathJax-Span-578 .mrow}]{#59.html#MathJax-Span-577.texatom}[b]{#59.html#MathJax-Span-580 .mistyle="font-family: MathJax_Math-italic;"}[a]{#59.html#MathJax-Span-581.mistyle="font-family: MathJax_Math-italic;"}[s]{#59.html#MathJax-Span-582.mistyle="font-family: MathJax_Math-italic;"}[h]{#59.html#MathJax-Span-583.mistyle="font-family: MathJax_Math-italic;"}[也]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-586.mo}]{#59.html#MathJax-Span-585 .mrow}]{#59.html#MathJax-Span-584.texatom}[在]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-589.mo}]{#59.html#MathJax-Span-588 .mrow}]{#59.html#MathJax-Span-587.texatom}[一]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-592.mo}]{#59.html#MathJax-Span-591 .mrow}]{#59.html#MathJax-Span-590.texatom}[个]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-595.mo}]{#59.html#MathJax-Span-594 .mrow}]{#59.html#MathJax-Span-593.texatom}[独]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-598.mo}]{#59.html#MathJax-Span-597 .mrow}]{#59.html#MathJax-Span-596.texatom}[立]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-601.mo}]{#59.html#MathJax-Span-600 .mrow}]{#59.html#MathJax-Span-599.texatom}[的]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-604.mo}]{#59.html#MathJax-Span-603 .mrow}]{#59.html#MathJax-Span-602.texatom}[n]{#59.html#MathJax-Span-605 .mistyle="font-family: MathJax_Math-italic;"}[e]{#59.html#MathJax-Span-606.mistyle="font-family: MathJax_Math-italic;"}[t]{#59.html#MathJax-Span-607.mistyle="font-family: MathJax_Math-italic;"}[w]{#59.html#MathJax-Span-608.mistyle="font-family: MathJax_Math-italic;"}[o]{#59.html#MathJax-Span-609.mistyle="font-family: MathJax_Math-italic;"}[r]{#59.html#MathJax-Span-610.mistyle="font-family: MathJax_Math-italic;"}[k]{#59.html#MathJax-Span-611.mistyle="font-family: MathJax_Math-italic;"}[n]{#59.html#MathJax-Span-612.mistyle="font-family: MathJax_Math-italic;"}[a]{#59.html#MathJax-Span-613.mistyle="font-family: MathJax_Math-italic;"}[m]{#59.html#MathJax-Span-614.mistyle="font-family: MathJax_Math-italic;"}[e]{#59.html#MathJax-Span-615.mistyle="font-family: MathJax_Math-italic;"}[s]{#59.html#MathJax-Span-616.mistyle="font-family: MathJax_Math-italic;"}[p]{#59.html#MathJax-Span-617.mistyle="font-family: MathJax_Math-italic;"}[a]{#59.html#MathJax-Span-618.mistyle="font-family: MathJax_Math-italic;"}[c]{#59.html#MathJax-Span-619.mistyle="font-family: MathJax_Math-italic;"}[e]{#59.html#MathJax-Span-620.mistyle="font-family: MathJax_Math-italic;"}[里]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-623.mo}]{#59.html#MathJax-Span-622 .mrow}]{#59.html#MathJax-Span-621.texatom}[面]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-626.mo}]{#59.html#MathJax-Span-625 .mrow}]{#59.html#MathJax-Span-624.texatom}[，]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-629.mo}]{#59.html#MathJax-Span-628 .mrow}]{#59.html#MathJax-Span-627.texatom}[等]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-632.mo}]{#59.html#MathJax-Span-631 .mrow}]{#59.html#MathJax-Span-630.texatom}[退]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-635.mo}]{#59.html#MathJax-Span-634 .mrow}]{#59.html#MathJax-Span-633.texatom}[出]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-638.mo}]{#59.html#MathJax-Span-637 .mrow}]{#59.html#MathJax-Span-636.texatom}[了]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-641.mo}]{#59.html#MathJax-Span-640 .mrow}]{#59.html#MathJax-Span-639.texatom}[，]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-644.mo}]{#59.html#MathJax-Span-643 .mrow}]{#59.html#MathJax-Span-642.texatom}[再]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-647.mo}]{#59.html#MathJax-Span-646 .mrow}]{#59.html#MathJax-Span-645.texatom}[次]{style="font-family: STIXGeneral, \"Arial Unicode MS\", serif; font-size: 80%; font-style: normal; font-weight: normal;"}]{#59.html#MathJax-Span-650.mo}]{#59.html#MathJax-Span-649 .mrow}]{#59.html#MathJax-Span-648.texatom}[e]{#59.html#MathJax-Span-651 .mistyle="font-family: MathJax_Math-italic;"}[c]{#59.html#MathJax-Span-652.mistyle="font-family: MathJax_Math-italic;"}[h]{#59.html#MathJax-Span-653.mistyle="font-family: MathJax_Math-italic;"}[o]{#59.html#MathJax-Span-654.mistyle="font-family: MathJax_Math-italic;"}]{#59.html#MathJax-Span-329.mrow}[]{style="display: inline-block; width: 0px; height: 2.355em;"}]{style="position: absolute; clip: rect(1.414em, 1099.34em, 2.685em, -999.998em); top: -2.351em; left: 0em;"}]{style="display: inline-block; position: relative; width: 99.344em; height: 0px; font-size: 125%;"}[]{style="display: inline-block; overflow: hidden; vertical-align: -0.291em; border-left: 0px solid; width: 0px; height: 1.356em;"}]{#59.html#MathJax-Span-328.mathstyle="width: 124.191em; display: inline-block;"}``{=html}[$$的时候，就会发现当前bash的进程号变成了1。上面的程序运行了一个新的bash，它在一个独立的pidnamespace里面，自己是1号进程。如果运行ipaddr，可以看到，宿主机的网卡都找不到了，因为新的bash也在一个独立的networknamespace里面，等退出了，再次echo$$]{.MJX_Assistive_MathML.MJX_Assistive_MathML_Blockrole="presentation"}]{#59.html#MathJax-Element-2-Frame .MathJaxtabindex="0" style="text-align: center; position: relative;"mathml="的时候，就会发现当前bash的进程号变成了1。上面的程序运行了一个新的bash，它在一个独立的pidnamespace里面，自己是1号进程。如果运行ipaddr，可以看到，宿主机的网卡都找不到了，因为新的bash也在一个独立的networknamespace里面，等退出了，再次echo"role="presentation"}$$$$ 的时候，就可以得到原来进程号。clone系统调用我们在[进程的创建](https://time.geekbang.org/column/article/94064)那一节解析过，当时我们没有看关于namespace 的代码，现在我们就来看一看，namespace 在内核做了哪些事情。在内核里面，clone 会调用\_do_fork-\>copy_process-\>copy_namespaces，也就是说，在创建子进程的时候，有一个机会可以复制和设置namespace。namespace 是在哪里定义的呢？在每一个进程的 task_struct 里面，有一个指向namespace 结构体的指针 nsproxy。    struct task_struct {....../* Namespaces: */struct nsproxy*nsproxy;......} /* * A structure to contain pointers to all per-process * namespaces - fs (mount), uts, network, sysvipc, etc. * * The pid namespace is an exception -- it's accessed using * task_active_pid_ns.  The pid namespace here is the * namespace that children will use. */struct nsproxy {atomic_t count;struct uts_namespace *uts_ns;struct ipc_namespace *ipc_ns;struct mnt_namespace *mnt_ns;struct pid_namespace *pid_ns_for_children;struct net      *net_ns;struct cgroup_namespace *cgroup_ns;};我们可以看到在 struct nsproxy 结构里面，有我们上面讲过的各种 namespace。在系统初始化的时候，有一个默认的 init_nsproxy。    struct nsproxy init_nsproxy = {.count= ATOMIC_INIT(1),.uts_ns= &init_uts_ns,#if defined(CONFIG_POSIX_MQUEUE) || defined(CONFIG_SYSVIPC).ipc_ns= &init_ipc_ns,#endif.mnt_ns= NULL,.pid_ns_for_children= &init_pid_ns,#ifdef CONFIG_NET.net_ns= &init_net,#endif#ifdef CONFIG_CGROUPS.cgroup_ns= &init_cgroup_ns,#endif};下面，我们来看 copy_namespaces 的实现。    /* * called from clone.  This now handles copy for nsproxy and all * namespaces therein. */int copy_namespaces(unsigned long flags, struct task_struct *tsk){struct nsproxy *old_ns = tsk->nsproxy;struct user_namespace *user_ns = task_cred_xxx(tsk, user_ns);struct nsproxy *new_ns; if (likely(!(flags & (CLONE_NEWNS | CLONE_NEWUTS | CLONE_NEWIPC |      CLONE_NEWPID | CLONE_NEWNET |      CLONE_NEWCGROUP)))) {get_nsproxy(old_ns);return 0;} if (!ns_capable(user_ns, CAP_SYS_ADMIN))return -EPERM;......new_ns = create_new_namespaces(flags, tsk, user_ns, tsk->fs); tsk->nsproxy = new_ns;return 0;}如果 clone 的参数里面没有 CLONE_NEWNS \| CLONE_NEWUTS \| CLONE_NEWIPC \|CLONE_NEWPID \| CLONE_NEWNET \| CLONE_NEWCGROUP，就返回原来的namespace，调用 get_nsproxy。接着，我们调用 create_new_namespaces。    /* * Create new nsproxy and all of its the associated namespaces. * Return the newly created nsproxy.  Do not attach this to the task, * leave it to the caller to do proper locking and attach it to task. */static struct nsproxy *create_new_namespaces(unsigned long flags,struct task_struct *tsk, struct user_namespace *user_ns,struct fs_struct *new_fs){struct nsproxy *new_nsp; new_nsp = create_nsproxy();......new_nsp->mnt_ns = copy_mnt_ns(flags, tsk->nsproxy->mnt_ns, user_ns, new_fs);......new_nsp->uts_ns = copy_utsname(flags, user_ns, tsk->nsproxy->uts_ns);......new_nsp->ipc_ns = copy_ipcs(flags, user_ns, tsk->nsproxy->ipc_ns);......new_nsp->pid_ns_for_children =copy_pid_ns(flags, user_ns, tsk->nsproxy->pid_ns_for_children);......new_nsp->cgroup_ns = copy_cgroup_ns(flags, user_ns,    tsk->nsproxy->cgroup_ns);......new_nsp->net_ns = copy_net_ns(flags, user_ns, tsk->nsproxy->net_ns);......return new_nsp;......}在 create_new_namespaces 中，我们可以看到对于各种 namespace 的复制。我们来看 copy_pid_ns 对于 pid namespace 的复制。    struct pid_namespace *copy_pid_ns(unsigned long flags,struct user_namespace *user_ns, struct pid_namespace *old_ns){if (!(flags & CLONE_NEWPID))return get_pid_ns(old_ns);if (task_active_pid_ns(current) != old_ns)return ERR_PTR(-EINVAL);return create_pid_namespace(user_ns, old_ns);}在 copy_pid_ns 中，如果没有设置 CLONE_NEWPID，则返回老的 pidnamespace；如果设置了，就调用 create_pid_namespace，创建新的 pidnamespace.我们再来看 copy_net_ns 对于 network namespace 的复制。    struct net *copy_net_ns(unsigned long flags,struct user_namespace *user_ns, struct net *old_net){struct ucounts *ucounts;struct net *net;int rv; if (!(flags & CLONE_NEWNET))return get_net(old_net); ucounts = inc_net_namespaces(user_ns);......net = net_alloc();......get_user_ns(user_ns);net->ucounts = ucounts;rv = setup_net(net, user_ns);......return net;}在这里面，我们需要判断，如果 flags 中不包含CLONE_NEWNET，也就是不会创建一个新的 network namespace，则返回old_net；否则需要新建一个 network namespace。然后，copy_net_ns 会调用 net = net_alloc()，分配一个新的 struct net结构，然后调用 setup_net 对新分配的 net 结构进行初始化，之后调用list_add_tail_rcu，将新建的 network namespace，添加到全局的 networknamespace 列表 net_namespace_list 中。我们来看一下 setup_net 的实现。    /* * setup_net runs the initializers for the network namespace object. */static __net_init int setup_net(struct net *net, struct user_namespace *user_ns){/* Must be called with net_mutex held */const struct pernet_operations *ops, *saved_ops;LIST_HEAD(net_exit_list); atomic_set(&net->count, 1);refcount_set(&net->passive, 1);net->dev_base_seq = 1;net->user_ns = user_ns;idr_init(&net->netns_ids);spin_lock_init(&net->nsid_lock); list_for_each_entry(ops, &pernet_list, list) {error = ops_init(ops, net);......}......}在 setup_net 中，这里面有一个循环 list_for_each_entry，对于 pernet_list的每一项 struct pernet_operations，运行 ops_init，也就是调用pernet_operations 的 init 函数。这个 pernet_list 是怎么来的呢？在网络设备初始化的时候，我们要调用net_dev_init 函数，这里面有下面的代码。    register_pernet_device(&loopback_net_ops) int register_pernet_device(struct pernet_operations *ops){int error;mutex_lock(&net_mutex);error = register_pernet_operations(&pernet_list, ops);if (!error && (first_device == &pernet_list))first_device = &ops->list;mutex_unlock(&net_mutex);return error;} struct pernet_operations __net_initdata loopback_net_ops = {        .init = loopback_net_init,};register_pernet_device 函数注册了一个 loopback_net_ops，在这里面，把init 函数设置为 loopback_net_init.    static __net_init int loopback_net_init(struct net *net){        struct net_device *dev;        dev = alloc_netdev(0, "lo", NET_NAME_UNKNOWN, loopback_setup);......        dev_net_set(dev, net);        err = register_netdev(dev);......        net->loopback_dev = dev;        return 0;......}在 loopback_net_init 函数中，我们会创建并且注册一个名字为\"lo\"的 structnet_device。注册完之后，在这个 namespace里面就会出现一个这样的网络设备，称为 loopback 网络设备。这就是为什么上面的实验中，创建出的新的 network namespace 里面有一个 lo网络设备。
## 总结时刻这一节我们讲了 namespace 相关的技术，有六种类型，分别是UTS、User、Mount、Pid、Network 和 IPC。还有两个常用的命令 nsenter 和 unshare，主要用于操作Namespace，有三个常用的函数 clone、setns 和 unshare。在内核里面，对于任何一个进程 task_struct 来讲，里面都会有一个成员 structnsproxy，用于保存 namespace 相关信息，里面有 structuts_namespace、struct ipc_namespace、struct mnt_namespace、structpid_namespace、struct net \*net_ns 和 struct cgroup_namespace\*cgroup_ns。创建 namespace 的时候，我们在内核中会调用copy_namespaces，调用顺序依次是copy_mnt_ns、copy_utsname、copy_ipcs、copy_pid_ns、copy_cgroup_ns 和copy_net_ns，来复制 namespace。![](Images/e503d0590e505b48c061b680632bb5dd.png){savepage-src="https://static001.geekbang.org/resource/image/56/d7/56bb9502b58628ff3d1bee83b6f53cd7.png"}
## 课堂练习网络的 Namespace 有一个非常好的命令 ipnetns。请你研究一下这个命令，并且创建一个容器，用这个命令查看网络namespace。欢迎留言和我分享你的疑惑和见解，也欢迎收藏本节内容，反复研读。你也可以把今天的内容分享给你的朋友，和他一起学习和进步。![](Images/1a5564dd4e1c9f25d4772c7f844ca84a.png){savepage-src="https://static001.geekbang.org/resource/image/8c/37/8c0a95fa07a8b9a1abfd394479bdd637.jpg"}
# 58 \| CGroup技术：内部创业公司应该独立核算成本我们前面说了，容器实现封闭的环境主要要靠两种技术，一种是"看起来是隔离"的技术Namespace，另一种是用起来是隔离的技术 CGroup。上一节我们讲了"看起来隔离"的技术Namespace，这一节我们就来看一下"用起来隔离"的技术 CGroup。CGroup 全称是 ControlGroup，顾名思义，它是用来做"控制"的。控制什么东西呢？当然是资源的使用了。那它都能控制哪些资源的使用呢？我们一起来看一看。首先，cgroups 定义了下面的一系列子系统，每个子系统用于控制某一类资源。-   cpu 子系统，主要限制进程的 cpu 使用率。-   cpuacct 子系统，可以统计 cgroups 中的进程的 cpu 使用报告。-   cpuset 子系统，可以为 cgroups 中的进程分配单独的 cpu    节点或者内存节点。-   memory 子系统，可以限制进程的 memory 使用量。-   blkio 子系统，可以限制进程的块设备 io。-   devices 子系统，可以控制进程能够访问某些设备。-   net_cls 子系统，可以标记 cgroups 中进程的网络数据包，然后可以使用 tc    模块（traffic control）对数据包进行控制。-   freezer 子系统，可以挂起或者恢复 cgroups 中的进程。``{=html}这么多子系统，你可能要说了，那我们不用都掌握吧？没错，这里面最常用的是对于CPU 和内存的控制，所以下面我们详细来说它。在容器这一章的第一节，我们讲了，Docker 有一些参数能够限制 CPU和内存的使用，如果把它落地到 Cgroup 里面会如何限制呢？为了验证 Docker 的参数与 Cgroup 的映射关系，我们运行一个命令特殊的docker run 命令，这个命令比较长，里面的参数都会映射为 cgroup的某项配置，然后我们运行 docker ps，可以看到，这个容器的 id 为3dc0601189dd。    docker run -d --cpu-shares 513 --cpus 2 --cpuset-cpus 1,3 --memory 1024M --memory-swap 1234M --memory-swappiness 7 -p 8081:80 testnginx:1 