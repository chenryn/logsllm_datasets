作者：[Nicky@TSRC](https://security.tencent.com/index.php/blog/msg/118)
#### 一、概述
随着手机功能越来越多，其在我们生活中扮演的角色也越来越重要，除了保存传统的通讯录、短信、照片等个人隐私，现在的手机还是一个支付工具，如果手机被盗用，手机锁屏密码就是保证大家数据和资金安全的第一道屏障。我们最近也研究和总结了一些手机解锁的新老姿势的安全性，在此分享给大家，欢迎大家上车一起交流。
本次测试的手机包含了苹果，三星，华为，小米，VIVO，Google，一加，乐视等品牌的热销型号手机，测试的解锁姿势主要有以下5种：
**1\. 手势/PIN码解锁  
2\. 蓝牙设备解锁 3\. 指纹解锁 4\. 人脸解锁 5\. 虹膜解锁**
测试结果表明，以上的解锁姿势都存在一定的安全风险。
#### 二、手势密码/PIN码解锁
在传统角度上来说，手势/数字密码是最安全的手机解锁姿势，一般的4-6位数字或图形密码结合错误次数限制，可以有效的防止攻击者通过暴力破解等方法（当然通过刷机重置系统或非通用
BUG 绕过不在讨论范围内）。虽然很难绕过此类姿势，但我们还可以想想如何在已经解锁的状态去清除密码。
 图一
我们团队的安全研究员 Xbalien 在研究后发现了一个影响 Android7.0 及 7.1
的通用手势密码/pin码清除的漏洞，而条件就是只需要在解锁状态下安装运行一个 APP 或开启 ADB 调试即可清除已设置的密码（如上图一）。
在 Android7.0 及 7.1 系统中，系统导出了一个选择解锁方式的系统组件，第三方应用可以调用此接口发送特定参数的 Intent
即可关闭所有锁屏认证功能，包含手势密码/PIN码/指纹等等。目前谷歌已经确认为中危并在新版本中修复了此漏洞（CVE-2017-0704），详见谷歌2017年7月
Android 安全公告。
 图二
除此之外，德国斯图加特大学的一个团队的研究报告指出，由于人体手指温度与手机屏幕温度存在一定温差，可以使用红外热成相相机能够拍摄出手指点击或滑动过程中产生的细小温差，从而破解输入的手机锁屏密码（如上图二）。
 图三
不过经我们实际测试，距离，成相像素，手机与人体温差，输入时间，都会影响拍摄效果，在日常生活环境中很难使用热成像仪还原出手指操作的轨迹。比如我们使用 seek
thermal xr 热成仪（分辨率为 206*156 像素），拍摄距离屏幕 20-30cm 的范围内手指长按屏幕 5
秒后得到的照片（上图三），也只能分辩一个比周边屏幕稍亮的点，如果按正常速度解锁，几乎拍摄不到任何解锁轨迹，所以说这种方法离实际利用还是比较遥远的。
#### 三、蓝牙设备解锁
 图四
早在 2014 年小米手环一代上市，小米就专门为小米手环在 MIUI 中开发了一个新功能叫做手环解锁，随后谷歌在 Android5.0 及以上版本的的
GooglePlay 组件中也加入了一个 smartLock 功能（上图四），支持蓝牙设备/地理位置/人脸解锁功能。而华为从 EMUI3.1
也开始引入智能解锁功能，支持手机在连接信任的蓝牙设备时无需密码直接解锁。在一段时间的测试后，我们发现华为的智能解锁功能存在漏洞可被利用于绕过手机锁屏密码。
华为 EMUI 在系统设置“锁屏与密码”中存在一个“智能解锁”功能，支持使用手环等蓝牙设备解锁，其中主要实现代码位于
`com.huawei.trustagent` 包中。主要原理为当用户开启智能解锁功能后，可选择添加可信手环设备，添加成功的手环设备 MAC
地址添加到白名单中。之后当手机亮屏时，后台会自动检测当前手机连接的蓝牙设备MAC地址是否在白名单中且信号强度( rssi
)是否在指定范围内，如果符合特定条件则自动免密码解锁。
 图五
一看到单纯的 MAC 地址白名单机制，老司机们都会想到各种“猥琐流”思路去绕过白名单。了解蓝牙设备的同学应该知道部分蓝牙芯片厂商的的设备 MAC
地址是可以直接任意修改的，同时手环设备 MAC 地址是公开信息，所以攻击者可以修改蓝牙 USB dongle 的 MAC
地址并主动查询手机蓝牙提供的服务项，此时蓝牙 usb dongle 并没有与手机成功配对，但已经建立连接，从而可以直接绕过手机锁屏密码（如上图五）。
而之前说到的 Google 的 SmartLock 功能在刚上线也出现过类似漏洞，Google
的修复方案是在解锁时检测当前连接的蓝牙设备是否已经配对成功，小米手环则在固件中自定义一个蓝牙 profile
在解锁前与手机通信进行身份校验（这也是小米蓝牙解锁只支持小米手环的部分原因）。 目前华为已经致谢并修复此漏洞，CVE 编号为
CVE-2017-2728，详见华为 PSIRT 安全公告，后续对于这类涉及智能设备的系统漏洞我们也会继续保持关注。
#### 四、指纹识别解锁
2013年苹果发布了第一款按压式指纹识别的手机—iPhone5S，之后指纹识别几乎是所有旗舰手机的标配，而随着技术的成熟与成本的下降，现在更是普及到了百元机标配。从手机指纹识别技术原理上来看，主要有以下三种方案：
###### 1\. 电容指纹识别
 图六
最早也是应用最广当属电容指纹识别，目前苹果iPhone全系及大部分Android手机都使用了这种技术的芯片。其主要原理是利用硅晶元与导电的皮下电解液形成电场，指纹的高低起伏会导致二者之间的压差出现不同的变化，借此可获取准确的指纹图像。
###### 2\. 超声波指纹识别
 图七
小米5S与乐视乐 Max Pro
均使用了高通的超声波指纹识别芯片，它的原理是通过超声波信息反射来感应指纹形态，能穿透玻璃、金属表面，因此，这项技术不需要集成在 Home
键上同时还能解决湿手情况下的电容指纹识别不灵敏的问题。而在6月28号的上海 MWC2017 大会上 VIVO
还联合高通发布了第三代超声波指纹识别技术，直接将指纹识别功能集成在屏幕内，并支持水下操作和心率检测。
###### 3\. 屏下光学指纹识别
 图八