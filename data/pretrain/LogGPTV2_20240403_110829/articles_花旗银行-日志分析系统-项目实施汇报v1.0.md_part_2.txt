# 日志分析系统需求与实现

## 1. 需求概述

### 1.1 Juniper防火墙
- **花旗两台数据主机对外事务量趋势**：以曲线图的形式展示。
- **端口状态更改**：以表格的形式展示。
- **用户登录记录**：以表格的形式展示。
- **策略修改记录**：以表格的形式展示。
- **策略修改详细记录**：以表格的形式展示。

### 1.2 交换机和路由器
- **端口状态更改记录**：以表格的形式展示。

## 2. 需求实现方式

### 2.1 操作系统日志需求
下表列出了不同操作系统版本中，各种事件对应的Windows日志ID：

| 操作系统       | 需求项           | Windows日志中的事件ID     |
|----------------|------------------|---------------------------|
| **Win2008/Win7** | 用户登录成功      | EventCode:4624            |
|                | 用户登录失败      | EventCode:4625            |
|                | 用户被锁定        | EventCode:4740            |
|                | 创建用户          | EventCode:4720            |
|                | 创建用户组        | EventCode:4731            |
|                | 修改用户密码      | EventCode:4724 (重置) <br> EventCode:4723 (更改) |
|                | 删除文件          | EventCode:4663 并且消息包含 DELETE |
|                | 修改文件          | EventCode:4663 并且消息包含 AppendData 和 WriteData |
|                | 新增文件          | EventCode:4663 并且消息包含 WriteAttributes |
|                | 删除审核日志      | EventCode:1102            |
|                | 添加用户到组      | EventCode:4732            |
|                | 修改文件/目录权限 | EventCode:4670            |
|                | 审核策略修改      | EventCode:4719            |

| 操作系统       | 霟求项           | Windows日志中的事件ID     |
|----------------|------------------|---------------------------|
| **WinXP**      | 用户登录成功      | event_id:528              |
|                | 用户登录失败      | event_id:529              |
|                | 用户被锁定        | event_id:539              |
|                | 创建用户          | event_id:624              |
|                | 创建用户组        | event_id:635              |
|                | 修改用户密码      | event_id:628              |
|                | 删除文件          | event_id:560 并且消息包含 1537 |
|                | 修改文件          | event_id:560 并且消息包含 4418 |
|                | 新增文件          | event_id:560 并且消息包含 4424 |
|                | 删除审核日志      | event_id:517              |
|                | 添加用户到组      | event_id:636              |
|                | 修改文件/目录权限 | event_id:560 并且消息包含 1539 |
|                | 审核策略修改      | event_id:612              |

### 2.2 Juniper防火墙日志需求
| 需求项             | 告警组及条件                             |
|--------------------|------------------------------------------|
| traffic流量日志     | 告警组=system-notification-00257(traffic) |
| 端口状态更改        | 告警组=system-notification-00513         |
| 用户登录记录        | 告警组=system-warning-00519              |
| 策略修改记录        | 告警组=system-notification-00018 并且消息包含 "Policy ID" |
| 策略修改详细记录    | 告警组=system-notification-00018 并且消息不包含 "Policy ID" |

### 2.3 交换机和路由器日志需求
| 需求项             | 告警组及条件                             |
|--------------------|------------------------------------------|
| 端口状态更改        | 告警组 LINEPROTO-5-UPDOWN 或 LINK-3-UPDOWN |

## 3. 实现方式参考
- **Windows审核日志开启详细介绍**：
  - [官网链接](https://technet.microsoft.com/zh-cn/library/mt431795(v=vs.85).aspx)
- **Windows事件ID详细介绍**：
  - [官网链接](https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/Default.aspx)

## 4. 平台使用操作说明

### 4.1 平台登录引导
- **日志易Web登录链接**：
  - 用户名/密码 (初始): admin/PI:EMAIL
  - 登录界面展示：![](media/image2.png){width="5.772222222222222in" height="2.7847222222222223in"}
- **日志易Manager管理控制台链接**：
  - 用户名/密码 (初始): admin/admin
  - 登录界面展示：![](media/image3.png){width="5.772222222222222in" height="3.0208333333333335in"}

### 4.2 平台功能使用介绍
- **表格模块功能使用**：
  - 登录Web页面后，点击“应用”查看场景表格列表。![](media/image9.png){width="5.772222222222222in" height="2.8201388888888888in"}
  - 可自定义时间范围搜索。![](media/image10.png){width="5.772222222222222in" height="1.9555555555555555in"}
  - 可通过动态字段进行筛选过滤。![](media/image11.png){width="5.772222222222222in" height="2.8006944444444444in"}
  - 对于某字段项较多的情况，提供搜索方式进行筛选。例如删除文件清单。![](media/image12.png){width="5.772222222222222in" height="2.8027777777777776in"}

- **仪表盘模块使用**：
  - 登录Web页面，点击“仪表盘”查看当前环境实现的场景。![](media/image13.png){width="5.772222222222222in" height="2.829861111111111in"}
  - 花旗2台数据主机文件的增删比对比柱状图。![](media/image14.png){width="5.772222222222222in" height="3.1979166666666665in"}
  - 花旗两台数据主机用户登录情况的柱状对比图。![](media/image15.png){width="5.772222222222222in" height="3.0909722222222222in"}
  - 花旗两台数据主机最近一天内文件访问的趋势。![](media/image16.png){width="5.772222222222222in" height="3.2368055555555557in"}
  - 7天内用户登录失败的占比。![](media/image17.png){width="5.772222222222222in" height="3.2104166666666667in"}
  - 最近一天内花旗主机对外的事物量趋势图。![](media/image18.png){width="5.772222222222222in" height="3.2305555555555556in"}

- **搜索模块的使用**：
  - 除了已有的场景模块，还可以根据历史日志记录查询所需信息。![](media/image19.png){width="5.772222222222222in" height="3.0229166666666667in"}
  - 可以自定义时间范围并填写关键字进行搜索。![](media/image20.png){width="5.772222222222222in" height="3.04375in"}
  - 详细的搜索SPL语句请参见《日志易搜索参考v1.8.0.docx》。

## 5. 实施进度说明
| 项目进度安排                        | 时间安排       |
|-------------------------------------|----------------|
| 日志分析系统平台实施规划及部署      | 2017 1/18-1/19 |
| 各管控对象的日志接入                | 2017 1/20-1/22 |
| Windows 2008/2007 系统日志审计开发实施 | 2017 1/21-2/8  |
| Windows XP 系统日志审计开发实施     | 2017 2/9-2/10  |
| Windows 系统日志审计需求逐条测试及修改 | 2017 2/13-2/14 |
| 交换机、路由器以及防火墙日志审计需求实现 | 2017 2/15-2/16 |
| 交换机、路由器以及防火墙日志审计需求逐条测试及修改 | 2017 2/13-2/14 |
| 提交文档编写                        | 2017 2/20-2/24 |

## 6. 其他
我们平台的功能不仅限于此，如果有其他需求，请随时与我们联系。我们在评估后会提供一个合理的解决方案。