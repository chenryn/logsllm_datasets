2、 字段统计告警：按某条件对字段进行过滤，如限定数值范围，求最大值、最小值、平
均值、总和等，并基于计算后的结果进行告警。
3、 连续统计告警：有时候基于单次的监控结果可能引发误报，这时我们需要设定当某个
告警条件在某个时间段内连续触发次数达到阀值，才触发。
4、 基线对比：设定某一阈值，当某指标（基于日志统计计算后得到）达到阈值时触发告
警。
5、 SPL统计：日志易支持更多样的SPL统计计算，您可以使用SPL生成的新字段设置告
警。
9.2 创建监控项
配置监控需要填写一些常规信息：
1、名称：您可以自由命名监控的名称，监控被触发时将推送此名称的告警。
2、描述：为监控做简短的描述，以便您能记起设置监控的原因。
3、监控分组：为监控选择分组归属，可以完成分享等功能。
4、搜索：您可以从已存搜索中选择一个作为监控范围使用，日志易将提供已存搜索列表
供您选择；如果您正在进行搜索，并决定使用当前搜索建立监控，请直接点击创建监控按
钮，进一步创建监控范围。您也可以直接在搜索内容输入框内，手写SPL搜索语句。
5、监控启用：设置是否启用该监控。您也可以在列表页中直接修改该设定。
更多告警类型设置，可参考《日志易监控告警手册》2.2章节。
9.3 告警方式
告警触发的条件有了，我们还需要一个方式去发送告警。开启消息通知的情况下，您在系
统通知栏可以看到告警触发信息:
143
日志学院
此外，日志易还支持rsyslog告警、邮件告警、告警转发、ping主机等告警等方式，告警
内容可自定义。
9.4 告警示例
以Linux错误事件告警为例，设置一个Linux主机日志告警，可通过日志中的关键字识别错
误事件，如wrong、error等，当出现错误事件时则发送告警到管理员邮箱。
日志易监控告警还支持通过事件数设置告警级别。
那么该告警的设置顺序如下：
1、设置 à 资源（监控）à 新建告警；
2、填写告警名称，选择监控分组、运行用户、日志来源，填写搜索内容，启用告警；
3、在监控执行部分，选择告警类型为“事件数监控”，选择告警定时执行时间，告警定
时执行时间可以是定时执行，还可以写成Crontab的格式；
4、定义告警触发条件：如5分钟内，错误事件超过1条，则为低强度告警，错误事件超
过5条，则是中强度告警，错误事件超过10条，则为高强度告警；
5、设置告警方式：选择告警方式为邮件告警，添加管理员的邮箱，更改内容模板中的
{{web_conf.custom.web_address}}为日志易主机IP（两处都要更改），如
http://192.168.1.101，点击“测试运行”测试告警发送能否正常接收；
6、测试无误后，保存告警配置即可。
144
日志学院
145
日志学院
本章习题：接入任意主机的Linux secure日志，设置一个告警，使该主机添加或删除用户
时，向管理员邮箱发送告警。要求：需设置告警级别。
思考：
1、你知道其他类型的告警适用方向吗？查看产品文档《日志易监控告警手册》了解一下
吧！
2、如果产品默认告警功能不能满足客户使用，我们又该怎么办呢？日志易支持微信公众
号告警、短信告警等其他告警方式，这需要根据客户需求进行自定义开发，客户如有这方
面的需求，则需要额外的开发人天。这些插件是怎么开发的呢？查看产品文档《日志易
API使用手册》简要了解一下吧！
思考的内容内容简要了解即可。日志易还有更多告警高级功能，这会在我们中级部分的课
程中提及。建议完成高级部分的内容后，再根据个人兴趣拓展学习！
146
日志学院
十、导入 APP
为了方便项目实施，日志易准备了很多即插即用的APP，APP内包含了字段解析规则、趋
势图、仪表盘等资源。日志易APP达上百余种，涵盖了众多常见的日志分析场景。通过导
入这些APP，可快速实现某一类型日志的解析及分析。
使用日志易APP的流程如下：
1、登录http://222.128.29.229:9999/app/，根据所需分析的日志种类选择适合的APP，下
载该APP压缩包；
2、解压APP，将tar导入到日志易系统中；
3、调试APP。由于APP制作环境可能与当前使用环境存在一些差异，我们要根据当前环
境调整该APP的一些配置参数，使其符合当前使用标准。
10.1 获取 APP 说明
以Linux系统性能APP为例，下载安装包并解压后可得到一个tar包和一个使用说明书。
（http://222.128.29.229:9999/app/%e6%a0%87%e5%87%86%e4%ba%a4%e4%bb%98/App-%e6%93
%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f-Linux%e7%b3%bb%e7%bb%9f%e6%80%a7%e8%83%bd.zip）
有的APP提供了文档说明，大多数APP则是以表格的形式提供说明。无论格式如何，阅读
使用说明有益于我们快速把握该APP内容，避免因预期不符造成的无效劳动。
如从Linux系统性能APP说明书中，我们可以获知：
1、 该APP的数据来源来自于日志易Heka-agent自带的“性能数据采集”所采集的日志
数据。该日志采集频率越高，得到的数据准确率越高，相应的资源占用率就越大，企
业环境中，该频率的设置与企业环境相关。一般建议该数值按默认采集频率300秒设
置。
2、 该APP共有3个仪表盘标签页，分别是运维异常概览、运维异常详细、运维主机单机
性能指标，前两个标签页为集群运维异常监控，第三个标签页为单机性能指标。大部
分的工作量集中在运维主机单机性能指标分析上；
3、 APP中提供的钻取（仪表盘高级功能，通过点击仪表盘可跳转到自定义页面，如搜索
页面等）功能需手工配置；
10.2 APP 导入
1、点击设置 à 权限（资源分组）à 导入/导出à导入；
2、本地上传à选择Linux基础性能APP.tar文件à分配角色及日志来源（角色可指定多
个，日志来源仅选定一个，如果没有日志来源，需要创建一个）；
3、进入仪表盘，查看导入的APP资源，即Linux主机运维监控指标仪表盘；
147
日志学院
10.3 主机配置修改
10.3.1 规则命名
在企业环境中，仪表盘等资源的命名都有一定的规范可以遵循。根据企业命名规范，可将
仪表盘修改为企业统一命名格式。命名修改参考第8章节《命名规范》部分。
10.3.2 仪表盘修改
打开导入的仪表盘，会发现有些图表有显示，有些图表没有显示。此时，我们可以参照
APP使用说明，对没有显示的图表进行调整。
对仪表盘中异常显示的图表的修改流程如下：
1、以仪表盘“运维异常详情”标签页中“网络高入口流量主机列表”的图表为例，点击
“更多配置”按钮，选择“通用配置”。
148
日志学院
2、点击“查询语句”下的“在搜索中打开”，可以搜索该SPL查询语句的查询结果。
3、在打开的搜索页面中，可以根据APP使用说明中关于该图表的描述，逐步修改该图表
的SPL查询语句。
修改SPL可参考APP使用说明中关于该图表的描述内容。该图表的描述如下：
149
日志学院
通过采集性能数据，计算出主机网卡入口流量的 5 分钟的平均值，平均入口流量大于
50MB 的主机信息(阈值需要依据实际情况修改)，点击IP地址钻取到【运维主机单机性能
指标】仪表盘中。
而根据对该SPL查询语句的调试结果，可发现本机网卡平均流量较低，5分钟的平均网卡
流量均低于1M。
通过对该SPL语句的分析可知，网卡的平均流量正是图形能否显示的根本原因，这时我们
通过两种方式更改网卡的平均流量：
l 将每5分钟的平均网卡流量改成每1分钟
l 将阈值更改为50K
按第一种方式修改之后，数据的变化范围不大。
通过修改阈值的方式，仪表盘处的分析图形得以正常显示。
150
日志学院
当然，在当前场景中，由于网卡流量较低，“网络高入口流量主机列表”分析图表就变得
意义不大。在企业场景中，可根据企业环境，挑选重点需要展示的仪表盘进行展示，不常
用指标设置阈值使用监控告警即可。
APP的导入应遵循项目实施的整体进度及规范。另外，新人建议多动手操作，使用APP也
应以理解APP制作的思路与方法为主要目的，建议待业务及产品都有一定认知再使用
APP。当然，实际项目实施中应具体情况具体面对。
本章习题：导入http://222.128.29.229:9999/app/os/app-linux-v7.0.zip的APP，根据APP
说明接入相关日志，然后打开仪表盘看下效果吧。
思考：导入一些APP后，有的仪表盘图表显示不出来，这是为什么呢？
151
日志学院
十一、Manager 简单管理
日志分析涉及模块较多，如果单独对各个模块进行维护，其人员精力消耗可想而知。而当
我们面临的是日志易集群，是几十台安装了日志易模块的机器时，这个工作量就更大了。
日志易提供了Manager界面以实现对日志易相关模块的管理。登录
http://192.168.1.101:8180/，输入账号密码（默认admin/admin），即可登录Manager管
理页面。
11.1 更新日志易安装包
更新日志易安装包的流程如下：
1、 选择顶部菜单 à 版本管理 à 日志易版本，进入版本管理页面，点击导入新版本。
2、导入日志易安装包目前支持两种导入方式：
l 使用服务器上文件
l 页面上传
使用服务器上文件：
在弹出页面中选择使用服务器上文件，然后输入要导入的安装包文件的路径（需提前将安
装包拷贝到Manager所在的服务器上，并且确保rizhiyi用户可以访问该文件），点击提交
即可开始导入。
152
日志学院
页面上传：
在弹出页面中选择上传文件，然后选择本机文件，等待页面处理完成后，点击上传即开始
上传，上传完成后。点击提交即可开始导入。
3、页面上传的一些补充说明：
1. 目前不支持断点续传，所以可以的话，大文件用别的工具上传到服务器会比较稳妥一
些。
2. 上传前会计算文件md5，如果文件较大时会要处理很长时间才能点击上传按钮，请耐
心等待。
3. 上传本身没有限制文件大小。历史上部分版本如果上传用时过长，会导致上传session
过期，上传完成后无法提交，造成了无法上传大文件的假象。这个问题在2.3版本中
已经有修复。
4. 上传完成后，文件会存放到 /var/lib/rizhiyi_manager_server/server/tmp/下，保存24
小时后再删除，遇上这个分区过小导致无法上传时，请清理空间，或者将这个目录改
成软链，指向空间足够的地方。
153
日志学院
5. 利用上传功能，可以在某些限制很多的客户环境上通过manager 页面向服务器上传
输任意文件（上传完成后不提交，文件不会马上删除，可以在上面的tmp目录找
到。）
Ø 目前支持导入的包有两种 parcels/tar.gz，前者为完整发布包，包含多个模块信
息，导入后会有完整的版本号。后者为单个模块补丁包，导入完成后会显示为
xxxx.patchxx。
Ø 只想升级parcels中某个特定模块的补丁的话，可以用 tar zxf YDP-xxxxx.parcels
命令，解压后获得的xxxx.tar.gz就是对应各个模块的单独的补丁包。
Ø 导入补丁时，可以选择是打在激活版本上，还是最新版本上，导入多个补丁时，
可以每次都选择打在最新版本上，导入全部补丁后再一次性激活。已经不再需要
像2.1之前的版本那样必须激活一个补丁版本后才能导入下一个补丁。
Ø 导入完成后会提示导入结果（成功/失败，失败时会提示原因）。
Ø 导入成功的版本会显示在版本管理页面的版本列表中，供进一步操作。Agent会
自动下载导入成功的安装包，无需人工干预。
Ø 同一个版本的安装包无法重复导入，第二次导入时会提示错误。要重复导入，一
般需要通过删除版本按钮，删除掉对应版本，之后才能导入。一般不推荐使用这
个方法。
11.2 导入 Licnese
更新日志易安装包的流程如下：
1、 选择顶部菜单 à 版本管理 à License管理，进入License管理页面，点击导入
License；
2、 可以选择页面上传或者使用服务器上文件，将license文件导入到系统；
3、导入完成后，所有Agent会自动下载并安装新的license文件。在该页面，还可以查看
集群的license信息，以及所有license文件的下载状态。
154
日志学院
4、重启frontend（3.0及之前版本），或重启auth（3.1及之后版本）模板，使License生
效。
11.3 模块管理
以Manager模块管理中的启动/停止/重启服务为例，其相关操作流程如下：
1、选择顶部菜单 à 服务，进入服务概览页面，从左边模块分布概览中选取想要操作的服
务模块，进入服务管理视图；
2、如果想要“启动/停止/重启”一个服务的全部实例，可以点击“全部启动/停止/重启”
按钮来进行操作；
3、只想操作其中的特定实例，也可以勾选这些实例后，点击选择操作按钮进行操作。
4、点击操作后，会跳转到执行操作页面，显示执行的结果。
Manager的功能十分强大，除此之外还包括以下几个方面：
l 安装包更新；
155
日志学院
l 导入license；
l 模块管理：包括模块升级、重启、性能监控及告警、修改配置文件等；
l 集群管理
l 主机监控；
l 实用工具：包括Kafka工具、命令行工具、MySQL工具、MySQL备份。
本章习题：在之前部署的环境上，下载frontend、logriver、splserver、yottaweb等模板的
最新补丁包，并将这些模块升级到最新版本。
了解更多Manager用法，可参考《日志易Manager使用手册》。
思考：学完了初级课程，你可以完整完成一个项目的实施了吗？如果觉得可以，你能说清
项目实施的流程吗？如果不行，你是觉得自己哪里不行呢？
156