Mach%O'Malware'Analysis:'Combatting'Mac'OSX/iOS'Malware'with'Data'Visualization!
!
'
'
'
'
Defcon'2013'
Mach%O'Malware'Analysis:'
Combatting*Mac*OSX/iOS*Malware*with*Data*Visualization*
'
Remy'Baumgarten'
ANRC'LLC.'
Mach%O'Malware'Analysis:'Combatting'Mac'OSX/iOS'Malware'with'Data'Visualization!
!
Mach%O'Malware'Analysis:'
Combatting'Mac'OSX/iOS'Malware'with'Data'Visualization'
Remy!Baumgarten,!Security!Engineer,!ANRC!LLC.!
Draft&Date:&Apr&02,&2013&
!
Apple!has!successfully!pushed!both!its!mobile!and!desktop!platforms!into!our!homes,!schools!and!work!
environments.!!With!such!a!dominant!push!of!its!products!into!our!everyday!lives!it!comes!as!no!
surprise!that!both!of!Apple’s!operating!systems,!OSX!and!iOS!should!fall!under!attack!by!malware!
developers!and!network!intruders.!!Numerous!organizations!and!Enterprises!who!have!implemented!
BYOD!(bring!your!own!device)!company!policies!have!seemingly!neglected!the!security!effort!involved!
in!protecting!the!network!infrastructure!from!these!potential!insider!threats.!The!complexity!of!
analyzing!MachNO!(Mach!object!file!format)!binaries!and!the!rising!prevalence!of!MacNspecific!malware!
has!created!a!real!need!for!a!new!type!of!tool!to!assist!in!the!analytic!efforts!required!to!rapidly!
identify!malicious!content.!!In!this!paper!we!will!introduce!Mach3O&Viz,!a!MachNO!Interactive!Data!
Visualization!tool!that!lends!itself!to!the!role!of!aiding!security!engineers!in!quickly!and!efficiently!
identifying!potentially!malicious!MachNO!files!on!the!network,!desktop!and!mobile!devices!of!
connected!users.!
!
!
!
!
!
!
!
!
!
!
!
Mach%O'Malware'Analysis:'Combatting'Mac'OSX/iOS'Malware'with'Data'Visualization!
!
Introduction!.....................................................................................................................................................................!4!
Why!a!New!Tool?!............................................................................................................................................................!5!
Introducing!Mach:O!Viz!...............................................................................................................................................!6!
Demonstrating!Mach:O!Viz’s!Features:!Analysis!of!CustomInstaller!a.ka.!Yontoo!Trojan!..................!11!
Analysis!of!keychain_dumper:!iOS!Hacker!Utility!.............................................................................................!19!
Analysis!of!MacDefender:!OSX’s!First!Malware!Threat!...................................................................................!25!
Mach:O!Viz:!Where!To!Go!From!Here!....................................................................................................................!29!
Conclusions!....................................................................................................................................................................!29!
About!ANRC!....................................................................................................................................................................!30!
Contact!.............................................................................................................................................................................!30!
!
!
!
Mach%O'Malware'Analysis:'Combatting'Mac'OSX/iOS'Malware'with'Data'Visualization!
!
Introduction!
!
!
These!days!it!is!safe!to!say!that!Mac!is!almost!everywhere.!!From!our!MacBook!laptops!to!our!mobile!
devices!such!as!iPhones!and!iPads,!the!prevalence!of!Mac!computing!cannot!be!ignored!and!makes!for!a!
lucrative!target!for!malware!authors!and!potential!network!intruders.!!Over!the!past!few!years!we’ve!seen!
examples!of!Mac!malware!make!its!way!through!the!prying!eyes!of!the!quality!assurance!engineers!at!Apple’s!
App!Store!and!subsequently!right!onto!our!mobile!devices!as!witnessed!in!the!Flashback!Trojan!attack!last!year.1!!
To!think!that!these!attacks!are!isolated!incidents!would!be!dangerously!naive.!
Scarier!still,!even!today!there!is!a!complete!lack!of!governance!in!organizations!for!policing!mobile!devices!
connected!to!their!private!network!infrastructure.!!In!one!eyeNopening!statistic,!57%2!of!IT!Managers!had!seen!
mobile!related!traffic!on!their!networks!with!no!means!of!actively!enforcing!their!network!defense!guidelines.!!
Many!IT!groups!believe!it's!Apple’s!responsibility!to!act!as!the!first!line!of!defense!against!Mac!targeted!
threats.!!Though!OSX!and!iOS!operating!systems!have!numerous!security!mechanisms!in!place!to!significantly!
reduce!Mac’s!attack!footprint,!the!assumption!that!Apple!software!can!prevent!all!malicious!software!from!
appearing!on!your!desktop!or!mobile!devices!is!far!from!true.!
Making!matters!worse!there!is!the!Jailbreak!community!who!play!a!catNandNmouse!game!with!Apple!security!
engineers!to!circumvent!all!iOS!security!mechanisms!and!allow!installation!of!arbitrary!unsigned!binaries!on!
mobile!devices.!!How!many!users!in!an!average!organization!are!bringing!in!JailNbroken!devices!to!work!and!
connecting!them!to!the!local!LAN?!More!importantly,!how!many!of!those!devices!are!carrying!Malware?!
The!need!for!a!better!understanding!of!the!MachNO!file!format!coupled!with!a!focus!on!network!security!are!
the!primary!motivations!which!led!to!the!development!of!MachNO!Viz.!MachNO!Viz!is!a!data!visualization!tool!
specifically!created!for!IT!security!engineers!and!malware!analysts!to!tackle!the!MachNO!file!format!complexity!
and!provide!a!rapid!analysis!solution!for!Mac!software.!!MachNO!Viz!is!provided!free,!multiplatform!and!
employs!an!array!of!open!source!software.!
!
!
!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
1!http://www.mercurynews.com/business/ci_22741463/appleNareNmacNcomputersNbecomingNmoreNvulnerableNmalwareNvirus!
2!http://www.forbes.com/sites/markfidelman/2012/05/02/theNlatestNinfographicsNmobileNbusinessNstatisticsNforN2012/!
Mach%O'Malware'Analysis:'Combatting'Mac'OSX/iOS'Malware'with'Data'Visualization!
!
Why!a!New!Tool?!
!
!
At!ANRC,!we’ve!been!tackling!the!MachNO!malware!problem!internally!in!our!research!and!
development!efforts,!so!we!understand!the!problems!posed!by!introducing!these!binaries!into!networks!illN
equipped!to!process!them!through!their!standard!network!defense!systems.!!With!most!of!the!world!
practicing!a!WindowsNcentric!ideology!with!regard!to!security!appliances,!coupled!with!a!ridiculously!complex!
file!specification!from!Apple,!we!felt!the!need!to!delve!deeper!into!the!problem!by:!
• Examining!and!evaluating!the!existing!tools!available!to!help!decipher!the!MachNO!format.!
• Finding!working!examples!of!security!products!equipped!to!process!MachNO!malware.!
• Attempting!to!find!a!tool!that!could!analyze!these!files!regardless!of!the!underlying!architecture.!
• Researching!a!better!way!to!view!the!file!internals!of!MachNO!files.!
!
We!examined!any!MachNO!tool!we!could!find!to!help!aid!the!analysis!of!potentially!malicious!binaries!that!
could!be!on!i386,!x86_64!or!ARM!architectures.!!The!focus!on!these!targets!was!intentional!to!make!sure!the!
binaries!were!likely!generated!using!XCode,!Apple’s!development!IDE,!or!llvm/gcc.!!The!following!chart!lists!
the!results!of!our!initial!research!efforts!and!helped!drive!our!design!and!development!for!MachNO!Viz.!
!
Tool'
Graphic'
Multiple'Architectures'
Network'
Security'
Aware'
Easy'to'
Understand'
Ease'of'Use'
IDA!Pro!
Yes!(sometimes)!
Yes!
No!
No!
No!
otool!
No!
Yes!
No!
No!
No!
classNdump!
No!
Objc!Only!
No!
Yes!
Yes!
Machoview!
Yes!
Yes!
No!
No!
Yes!
ptool!
No!
Yes!(old/no!support)!
No!
No!
Yes!
otoolNng!
No!
Yes!(old/no!support)!
No!
No!
No!
hopper!
Yes!(sometimes)!
Yes!
No!
No!
No!
Figure!1.!Evaluation!of!existing!MachNO!tools!(Green=Meets!Need,!Red=Does!Not!Meet,!Yellow=Some!Need!Met)!
!
The!design!for!MachoNViz!centered!on!fusing!the!advantages!offered!by!these!tools!and!then!adding!a!focus!on!
network!security!as!well.!Ultimately!the!goal!is!to!help!the!network!defender!understand!the!MachNO!file!
format!better!and!provide!a!method!to!effectively!and!efficiently!analyze!a!particular!binary!for!malicious!
behavior.!!One!of!the!essential!elements!in!the!MachoNViz!tool!design!was!the!need!for!a!simple!interface!
supporting!a!powerful!and!accurate!data!analytics!engine!that!would!yield!results!comparable!to!an!advanced!
Mach%O'Malware'Analysis:'Combatting'Mac'OSX/iOS'Malware'with'Data'Visualization!
!
disassembler.!!Additionally!we!wanted!to!make!the!tool!free!to!the!public!to!help!increase!security!awareness!
and!benefit!the!reversing!community!that!is!struggling!to!keep!up!with!malicious!MachNO!binaries.!
Introducing!Mach:O!Viz!
!
!
MachNO!Viz!was!developed!to!introduce!the!idea!of!presenting!a!MachNO!binary!visually!which!in!turn!
makes!it!easier!for!anyone!to!see!how!the!file!is!constructed,!i.e.!how!it!is!formed!from!the!header!through!the!
load!commands!and!into!all!of!its!corresponding!segments.!!In!addition!to!visualizing!the!file!itself!we!wanted!a!
powerful!backNend!graph!visualization!and!analytics!system!for!graphing!the!binary’s!disassembly!for!the!top!3!
platforms:!i386,!x86_64!and!ARM6/7.!!The!fundamental!component!was!to!keep!this!process!as!visual!as!
possible!while!maintaining!a!simpleNtoNuse!interface.!
With!data!visualization!in!mind,!the!next!challenge!was!to!make!the!tool!as!crossNplatform!as!possible.!!The!
desire!was!for!client!access!to!the!interface!to!be!simple!regardless!of!platform!(mobile,!desktop,!android,!osx,!