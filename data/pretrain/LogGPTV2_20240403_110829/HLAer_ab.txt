•	Field analysis. With the recognized patterns, each field of a certain pattern is analyzed by looking into, for 	example, the distributions of eligible words, the range of numerical values, etc. This analysis is to understand 	some global semantic of all logs.•	Indexing. All the logs are indexed based on the hierarchy and recognized patterns. In specific, the recognized 	patterns are utilized to index which logs have certain fields of interest.
	Figure 3 demonstrates the internal data structure of HLAer. Basically a tree structure is retained after hierarchical clustering. Details about this tree structure will be discussed later in Section VI-D.B. HLAer functionalities
The following examples demonstrate the functionality of HLAer.
•	Log indexing: Figure 4 shows an example of HLAer indexing logs. Given a set of heterogeneous logs, HLAer 	can generate a hierarchical indexing structure on top of the logs so as to organize the logs in a meaningful 	way in terms log formats and other information.•	Log format identification: Figure 5 shows an example of HLAer identifying common log formats. Given a set 	of heterogeneous logs, HLAer recognizes the formats of each log type. The log format recognition/identification 	can tolerate non-identical words.•	Log query: Figure 6 shows an example of HLAer supporting queries. The support of queries is implemented 	based on the format recognition and log indexing. Given a specified query, HLAer will return all the logs that 	satisfy this query. For now only queries on time is implemented but queries on other fields can be implemented 	in a same way.•	Outlier detection: Figure 7 shows an example of HLAer detecting outliers in an offline setting. Given a set of 	new logs, HLAer is able to identify logs that appear anomalous.
VI. 	BUILDING THE HLAer SYSTEM
A. Log data tokenizationThe first data preprocessing step on heterogeneous logs is to tokenize the log data such that lower level information from the words or phrases of each log record can be identified and retrieved. However, heterogeneous logs from different applications and systems have different formats, and thus different tokenizers/delimiters. Without specific knowledge or human inspection, it is unfair to use or not to use any pre-defined/popular tokenizer/delimiters for the6
heterogeneous logs
hierarchical clustering of logs
pattern recognition
field analysis
indexing
HLAer
Fig. 1: HLAer construction
tokenized logs
calculation of pair-wise log similarity
density-based clustering 
hierarchy generation from clustering
LCT
Fig. 2: LCT construction 	Fig. 3: HLAer internal data structure: LCT with patterns and indicesentire set of heterogeneous log data. Thus, a very general delimiter should be used. The use of such delimiter should avoid interfering with the possible, even unknown, delimiters from the log data, or should it introduce confusion into the original data.In HLAer, empty space is used as such a general delimiter. All the words and special symbols except numbers will be separated by empty space. Examples of empty space as the delimiter are presented in Table I. Note that some units like IP addresses and URLs are all delimited by empty spaces. However, these special units will be recognized later as a whole.
TABLE I: Examples of tokenization
| original log| original log 
tokenized log | 2012-07-09 20:32:46,864 INFO org.apache.hadoop.hdfs.util.GSet: recommended=4194304, actual=4194304 
2012 - 07 - 09 20 : 32 : 46 , 864 INFO org . apache . hadoop . hdfs . util . GSet : recommended = 4194304 , actual = 4194304 |
|---|---||---|---|
| original log  tokenized log |Jan 8 05:49:14 www httpd[7855]: 108.199.240.249 - - “GET /images/header/nav-pub-on.gif HTTP/1.1” 200 569  Jan 8 05 : 49 : 14 www httpd [ 7855 ] : 108 . 199 . 240 . 249 - - “ GET / images / header / nav - pub- on . gif HTTP / 1.1 ” 200 569 || original log  tokenized log |Jan 8 05:49:27 www httpd[7896]: [error] [client 108.199.240.249] File does not exist: /var/www/html/favicon.ico  Jan 8 05 : 49 : 27 www httpd [ 7896 ] : [ error ] [ client 108 . 199 . 240 . 249 ] File does not exist : / var / www / html / favicon . ico |
7
Input: heterogeneous logs
2012-07-09 20:32:46,864 INFO org.apache.hadoop.hdfs.util.GSet: recommended=4194304, actual=4194304Jan 8 05:49:14 www httpd[7855]: 108.199.240.249 - - “GET /images/header/nav-pub-on.gif HTTP/1.1” 200 569 2012-07-09 20:32:46,904 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: fsOwner=hadoop user 2012-07-09 20:32:46,905 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: supergroup=supergroup Jan 8 05:49:27 www httpd[7855]: 108.199.240.249 - - “GET /careers/internship.php HTTP/1.1” 200 11007Jan 8 05:49:27 www httpd[7855]: 108.199.240.249 - - “GET /careers/images-careers/intern-title.gif HTTP/1.1” 200 1211 2012-07-09 20:32:46,905 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: isPermissionEnabled=false 2012-07-09 20:32:46,909 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem dfs.block.invalidate.limit=100 Jan 8 05:49:27 www httpd[7855]: 108.199.240.249 - - “GET /images/home/current-bullet.gif HTTP/1.1” 200 131 Jan 8 05:49:27 www httpd[7896]: [error] [client 108.199.240.249] File does not exist: /var/www/html/favicon.icoHLAer
Output: log indexing
2012-07-09 20:32:46,864 INFO org.apache.hadoop.hdfs.util.GSet: recommended=4194304, actual=4194304 
Jan 8 05:49:14 www httpd[7855]: 108.199.240.249 - - “GET /images/header/nav-pub-on.gif HTTP/1.1” 200 569 2012-07-09 20:32:46,904 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: fsOwner=hadoop user 2012-07-09 20:32:46,905 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: supergroup=supergroup Jan 8 05:49:27 www httpd[7855]: 108.199.240.249 - - “GET /careers/internship.php HTTP/1.1” 200 11007Jan 8 05:49:27 www httpd[7855]: 108.199.240.249 - - “GET /careers/images-careers/intern-title.gif HTTP/1.1” 200 1211 2012-07-09 20:32:46,905 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: isPermissionEnabled=false 2012-07-09 20:32:46,909 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem dfs.block.invalidate.limit=100 Jan 8 05:49:27 www httpd[7855]: 108.199.240.249 - - “GET /images/home/current-bullet.gif HTTP/1.1” 200 131 Jan 8 05:49:27 www httpd[7896]: [error] [client 108.199.240.249] File does not exist: /var/www/html/favicon.icoFig. 4: HLAer log data indexing
Input: heterogeneous logs
2012-07-09 20:32:46,864 INFO org.apache.hadoop.hdfs.util.GSet: recommended=4194304, actual=4194304 
Jan 8 05:49:14 www httpd[7855]: 108.199.240.249 - - “GET /images/header/nav-pub-on.gif HTTP/1.1” 200 569 2012-07-09 20:32:46,904 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: fsOwner=hadoop user 2012-07-09 20:32:46,905 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: supergroup=supergroup Jan 8 05:49:27 www httpd[7855]: 108.199.240.249 - - “GET /careers/internship.php HTTP/1.1” 200 11007Jan 8 05:49:27 www httpd[7855]: 108.199.240.249 - - “GET /careers/images-careers/intern-title.gif HTTP/1.1” 200 1211 2012-07-09 20:32:46,905 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: isPermissionEnabled=false 2012-07-09 20:32:46,909 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem dfs.block.invalidate.limit=100 Jan 8 05:49:27 www httpd[7855]: 108.199.240.249 - - “GET /images/home/current-bullet.gif HTTP/1.1” 200 131 Jan 8 05:49:27 www httpd[7896]: [error] [client 108.199.240.249] File does not exist: /var/www/html/favicon.icoHLAer
Output: common log formats
Log format 1: date time, number, INFO, org.apache.hadoop.hdfs.*.*: * * 
Log format 2: day time www httpd[number]: IP *.*.*.* - - “GET YYY HTTP/1.1” number number
· · · · · ·
Fig. 5: HLAer format identification