over constantly busy circuits, and consequently lowers the latency
of more interactive applications. Their scheduler has been inte-
grated into Tor.
Unlike their approach in which interactive trafﬁc is given prece-
dence over busy clients by rearranging the schedule in favor of the
former, Tortoise’s trafﬁc shaping is done by active throttling. The
two techniques are orthogonal, and EWMA and Tortoise can be si-
multaneously applied to increase performance.
Improved multiplexing. Reardon and Goldberg note that Tor’s
TCP multiplexing techniques signiﬁcantly contribute to network la-
tency. They suggest tunneling TCP connections of DTLS (Data-
gram Transport Layer Security) packets to alleviate the effects of
interference among multiplexed Tor circuits [25]. Similarly, Math-
ewson has investigated using SCTP (Stream Control Transmission
Protocol) for Tor multiplexing [16]. In contrast to these approaches,
Tortoise imposes strict rate limits on all non-contributing clients.
Applying Tortoise in conjunction with the above multiplexing strate-
Clients' Benefits of Running a Relay
 (100KBps Rate Limit, Low Adoption Rate)
Clients' Benefits of Running a Relay
 (100KBps Rate Limit, High Adoption Rate)
n
o
i
t
c
a
r
F
e
v
i
t
l
a
u
m
u
C
0
1
.
8
0
.
6
0
.
4
.
0
2
0
.
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
● Tortoise, not running relays
Tortoise, running relays
n
o
i
t
c
a
r
F
e
v
i
t
l
a
u
m
u
C
0
.
1
8
.
0
6
.
0
4
.
0
2
.
0
0
.
0
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
● Tortoise, not running relays
Tortoise, running relays
0
50
100
150
200
250
0
50
100
150
200
250
KBps
KBps
Figure 9: Bandwidth improvements seen by clients that choose to run routers, in a network with only 50% of routers running Tortoise.
n
o
i
t
c
a
r
F
e
v
i
t
l
a
u
m
u
C
0
.
1
8
.
0
6
.
0
4
.
0
2
.
0
0
.
0
Effects of Reduced Relay Participation in Tortoise
50% relay participation
100% relay participation
Zero client adoption
Low client adoption
High client adoption
10
20
30
40
50
60
70
80
KBps
Figure 10: The effect of sub-100% participation in Tortoise
when a 100KBps rate limit is applied.
gies should provide added beneﬁt, since the reduced trafﬁc load
will lighten congestion.
Relay selection. Tor uses a bandwidth-weighted relay selection
strategy in which the probability that a relay is chosen as a member
of an anonymous path is proportional to the bandwidth advertised
by that relay [8]. Snader and Borisov proposed a reﬁnement to Tor
that allows the sender to increase the performance of her paths at
the expense of anonymity [28]. Murdoch at Watson later showed
that Tor’s current bandwidth-weighted strategy provides both good
anonymity and performance [20]. Sherr et al. argue that path se-
lection based on other non-bandwidth metrics (such as latency or
loss) offers performance and anonymity beneﬁts [26, 27].
However,
as has been pointed out by Dingledine and
Murdoch [10], the primary cause of Tor’s slowness is likely due to
congestion caused by ﬁle sharing. While the above relay selection
techniques may provide better performance or stronger anonymity
on less congested networks, we believe such approaches are un-
(cid:2)(cid:1)(cid:3)
likely to provide good performance on the current Tor network.
Tortoise is agnostic to clients’ relay selection algorithms, and may
complement the above approaches by alleviating congestion and
permitting higher performing and more ﬂexible anonymous routes.
Incentive schemes. Tortoise is most similar to techniques that
attempt to provide incentives to operate Tor relays.
In PAR [2],
relays earn coins that they can spend on fast paths. However, the
need to frequently authenticate coins with a central bank limits the
approach’s scalability.
Jansen et al. introduce a number of mechanisms called BRAIDS
that encourage Tor users to run relays [14]. BRAIDS implements a
form of differentiated service by segregating trafﬁc into three ser-
vice classes, each of which has particular performance properties
(e.g., high latency, high throughput, etc.). Similar to e-cash sys-
tems, BRAIDS uses a ticket model in which tickets may be ex-
changed for higher performing anonymous paths. By rewarding
relay operators with tickets (and consequently, better performing
paths), BRAIDS encourages users to run Tor relays.
Similar to BRAIDS, Tortoise offers a form of differentiated ser-
vice by enforcing different rate limits for users depending on
whether they run a Tor router or not, providing an incentive for
users to operate relays. However, while BRAIDS requires a par-
tially trusted ofﬂine bank to manage tickets, Tortoise is fully back-
wards compatible with the existing Tor network, can be incremen-
tally deployed, and requires no centralized structures.
Ngan et al. proposed a system [22] in which cells from circuits
are marked with a “gold star” if they originate from a Tor instance
that is also a STABLE router. Tests on an experimental Tor network
showed that using the system, cooperating nodes (nodes running a
router, and thus receiving priority) gained a signiﬁcant advantage
over other nodes when the network was under heavy load. While
the gold star system considers a cell’s priority at each hop, Tortoise
checks only at network ingress points, and gives all trafﬁc equal
priority once it is past the ﬁrst hop. Additionally, the ability to
prioritize trafﬁc at each hop in the gold star scheme requires that
each hop be running the modiﬁed software; in Tortoise, only the
guard nodes’ are aware of the rate limiting.
Adaptive throttling of Tor clients by entry guards. A Septem-
ber 2010 Tor blog post [6] addressed the efﬁcacy of using per-
connection rate limits to reduce the impact of bandwidth-intensive
connections on the network. The author conﬁrmed that one could
[9] R. Dingledine, N. Mathewson, and P. Syverson. Tor: The Second-
Generation Onion Router. In USENIX Security Symposium (USENIX),
2004.
[10] R. Dingledine and S. Murdoch.
Performance Improvements on
Tor, or, Why Tor is Slow and What We’re Going to Do About
It.
https://svn.torproject.org/svn/projects/
roadmaps/2009-03-11-performance.pdf, March 2009.
[11] J. R. Douceur. The Sybil Attack. In International Workshop on Peer-
to-Peer Systems (IPTPS), 2002.
[12] F. Hernández-Campos, K. Jeffay, and F. Smith. Tracking the Evolu-
tion of Web Trafﬁc: 1995-2003. In Modeling, Analysis and Simulation
of Computer Telecommunications Systems (MASCOTS), 2003.
[13] A. Hintz. Fingerprinting Websites Using Trafﬁc Analysis. In Privacy
Enhancing Technologies Symposium (PETS), 2003.
[14] R. Jansen, N. Hopper, and Y. Kim. Recruiting New Tor Relays with
In ACM Conference on Computer and Communications
BRAIDS.
Security (CCS), 2010.
[15] K. Loesing. Measuring the Tor Network: Evaluation of Client Re-
quests to the Directories. Technical report, Tor Project, June 2009.
[16] N. Mathewson. Evaluating SCTP for Tor. http://archives.
seul.org/or/dev/Sep-2004/msg00002.html, September
2004. Listserv posting.
[17] D. McCoy, K. Bauer, D. Grunwald, T. Kohno, and D. Sicker. Shining
In Privacy
Light in Dark Places: Understanding the Tor Network.
Enhancing Technologies Symposium (PETS), 2008.
[18] R. C. Merkle. Secure Communications over Insecure Channels. Com-
munications of the ACM, 21:294–299, April 1978.
[19] S. J. Murdoch. Hot or Not: Revealing Hidden Services by Their Clock
Skew. In ACM Conference on Computer and Communications Secu-
rity (CCS), 2006.
[20] S. J. Murdoch and R. N. M. Watson. Metrics for Security and Perfor-
mance in Low-Latency Anonymity Systems. In Privacy Enhancing
Technologies Symposium (PETS), 2008.
[21] NetIndex
Source
Data.
http://netindex.com/
source-data/. Retrieved May 26, 2011.
[22] T.-W. J. Ngan, R. Dingledine, and D. Wallach. Building Incentives
into Tor. In Financial Cryptography and Data Security, 2010.
[23] M. Perry.
rassment.
tips-running-exit-node-minimal-harassment.
Retrieved May 16, 2011.
Tips for running an exit node with minimal ha-
https://blog.torproject.org/blog/
[24] M. Perry. Computing Bandwidth Adjustments. Proposal 161, Tor
Project, 2009.
[25] J. Reardon and I. Goldberg. Improving Tor using a TCP-over-DTLS
Tunnel. In USENIX Security Symposium (USENIX), 2009.
[26] M. Sherr, M. Blaze, and B. T. Loo. Scalable Link-Based Relay Se-
lection for Anonymous Routing. In Privacy Enhancing Technologies
Symposium (PETS), August 2009.
[27] M. Sherr, A. Mao, W. R. Marczak, W. Zhou, B. T. Loo, and M. Blaze.
A3: An Extensible Platform for Application-Aware Anonymity.
In
Network and Distributed System Security Symposium (NDSS), 2010.
[28] R. Snader and N. Borisov. A Tune-up for Tor: Improving Security and
Performance in the Tor Network. In Network and Distributed System
Security Symposium (NDSS), 2008.
[29] C. Tang and I. Goldberg. An Improved Algorithm for Tor Circuit
Scheduling. In ACM Conference on Computer and Communications
Security (CCS), 2010.
[30] Tor Project,
Inc.
Tor Directory Protocol, Version 3, 2010.
https://git.torproject.org/checkout/tor/
master/doc/spec/dir-spec.txt.
[31] A. Vahdat, K. Yocum, K. Walsh, P. Mahadevan, D. Kosti´c, J. Chase,
and D. Becker. Scalability and Accuracy in a Large-scale Network
Emulator. SIGOPS Oper. Syst. Rev., 36:271–284, December 2002.
[32] S. Zander and S. J. Murdoch. An Improved Clock-Skew Measure-
ment Technique for Revealing Hidden Services. In USENIX Security
Symposium (USENIX), 2008.
[33] Zona Publishing. The Need for Speed II. Zona Market Bulletin, 5,
April 2001.
set rate limits in a manner such that only large transfers would be
signiﬁcantly throttled. However, some commenters claimed such
measures would not help the network because a client could avoid
rate limiting by running a relay from the same IP as the client trans-
ferring large amounts of data. Our work takes the opposite view-
point: a bulk client running a relay in order to achieve faster speeds
is not only acceptable, it is also desirable as it beneﬁts the network
as a whole.
8. CONCLUSION
This paper proposes Tortoise, a backwards-compatible extension
to Tor that applies per-connection rate limits at Tor’s ingress points.
By carefully tuning these limits, our results indicate that Tortoise
imposes little performance penalty to most web clients while simul-
taneously providing incentives to high-bandwidth clients to operate
their own relays.
Tortoise’s beneﬁts hinge on the ability to attract additional relays.
By enforcing strict rate limits and giving exemptions only to relay
operators, we argue that clients who demand high bandwidths will
be sufﬁciently motivated to contribute a fraction of their bandwidth
to the Tor network. Emulation results demonstrate that even if a
small percentage of clients opt to run relays, the network not only
achieves signiﬁcant performance gains, but also an increased ca-
pacity to handle additional load. For instance, if 4% of the clients
are motivated to operate a relay, then the network experiences a
32% improvement in effective capacity and is signiﬁcantly better
able to tolerate a sudden inﬂux of additional clients than the cur-
rent Tor network.
Acknowledgements
We thank the anonymous reviewers for their helpful feedback, and
Kevin Bauer for several thoughtful discussions about this work.
This research was supported by DARPA SAFER award N66001-
11-C-4020 and NSF grant CNS-1064986. Any opinions, ﬁndings,
and conclusions or recommendations expressed in this material are
those of the authors and do not necessarily reﬂect the views of the
funding agencies.
References
[1] Alexa: The Web Information Company. Top Sites. http://www.
alexa.com/topsites. Retrieved May 13, 2011.
[2] E. Androulaki, M. Raykova, S. Srivatsan, A. Stavrou, and S. Bellovin.
PAR: Payment for Anonymous Routing. In Privacy Enhancing Tech-
nologies Symposium (PETS), 2008.
[3] K. Bauer, M. Sherr, D. McCoy, and D. Grunwald. ExperimenTor:
In USENIX
A Testbed for Safe and Realistic Tor Experimentation.
Workshop on Cyber Security Experimentation and Test (CSET), 2011.
[4] S. L. Blond, P. Manils, A. Chaabane, M. A. Kaafar, A. Legout,
C. Castellucia, and W. Dabbous. De-anonymizing BitTorrent Users
on Tor (poster). In USENIX Symposium on Networked Systems De-
sign and Implementation (NSDI), 2010.
[5] Y. Chen, R. Sion, and B. Carbunar. XPay: Practical Anonymous Pay-
ments for Tor Routing and Other Networked Services. In ACM Work-
shop on Privacy in the Electronic Society (WPES), 2009.
[6] R. Dingledine. Research Problem: Adaptive Throttling of Tor Clients
by Entry Guards. http://preview.tinyurl.com/3tcyaem.
Retrieved May 24, 2011.
[7] R. Dingledine.
Idea.
bittorrent-over-tor-isnt-good-idea, April 2010.
Bittorrent Over Tor
a Good
https://blog.torproject.org/blog/
Isn’t
[8] R. Dingledine and N. Mathewson.
Tor Path Speciﬁcation.
http://www.torproject.org/svn/trunk/doc/spec/
path-spec.txt, January 2008.
(cid:2)(cid:1)(cid:3)