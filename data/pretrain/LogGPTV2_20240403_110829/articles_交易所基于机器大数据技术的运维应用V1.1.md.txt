**交易所基于机器大数据技术的运维应用**
为推动中国证券期货业的转型升级和创新发展，提高行业的核心竞争力和综合实力。促进行业科技现代化、智能化和高效化发展，2021年证监会科技监管局编制了证券期货业科技发展"十四五"规划，提出推动信息技术、人工智能、区块链等新兴技术在证券期货市场的应用，提升行业的智能化和数字化水平，加强证券期货市场基础设施建设，提高行业风险管理水平。
依托移动终端的普及和信息技术的飞速发展，证券期货行业也面临着与日俱增的海量日志，在数字化转型过程中如何利用大数据技术发掘数据真正的价值，是当前证券期货行业打破传统局限、应对深刻变化的解决之道。
全国中小企业股份转让系统作为我国第一家公司制运营的证券交易场所，立足于服务创新型、创业型、成长型中小微企业的市场定位，对于健全直接融资体系，服务实体经济发展，推动经济结构转型升级，促进大众创业万众创新，都具有重大战略意义。目前公司IT运维经过多年的建设已经建立起完善的运维体系，但是依然面临着各系统间日志分散难以管理、日志格式复杂难以解读、日志体量巨大难以处理的问题。因此我们迫切需要建立统一监控平台管理系统，通过对各系统日志的统一采集与分析来满足系统对各类资源设备的性能监控以及智慧运维监管需求。从而实现运维分析、实时告警、事件回溯，加速故障分析、追踪和定位。
为此我们选用了国内拥有独立知识产权的日志易解决方案，搭建高可靠动力平台，探寻证券期货行业对数据更深层次的需求，降低业务流程和应用系统的开发和运维成本，实现准实时处理海量日志，从而达到大数据时代的风险管控需求。
目前统一监管平台已覆盖我司79台网络设备，40台安全设备，27台存储设备，457台服务器，361台虚拟机，64套数据库，136套中间件设备数据采集及监控管理。
统一监控系统设计为分层式架构，系统架构总体划分成资源层、采集层、处理层、功能层、展示层。系统架构设计遵循"松耦合度"原则，采用系统软件总线、SOA开发设计模式确保各功能模块灵活可用，以适应个性化的需求以及未来可拓展的发展建设需求。目前集中采集主机系统日志、网络安全日志、中间件及应用日志。日均接入数据量达到70G。
![](media/image1.png){width="4.013888888888889in"
height="3.7131944444444445in"}
监控系统对接原有IT系统产生的各类机器数据，可通过自定义数据解析规则提取关键字段，并通过分布式引擎库提供样例验证保障规则合法性，通过库数据验证规则性能，同时通过解析状态统计分析报表，帮助技术人员及时调整数据解析策略。系统采用分布式存储方案：利用C++语言自主研发的非结构化海量机器数据专属引擎Beaver，能够保障在每日数十TB的日志增量接入的情况下依然拥有准实时检索和分析统计性能，并采用的索引裁剪、数据压缩等相应方案可以保障在同等数据量高效分析的场景下，降低近一半的数据存储硬件成本。
系统支持搜索处理语言（SPL，Search Processing
Language）进行复杂统计及关联分析。在实际业务分析中，支持利用关联分析可将不同来源的日志中的相关内容进行聚合，再进行统计分析。目前已完成以下工作：
-   运算资源管理
通过日志分析可以对网络、主机、应用、数据库交易系统、清算系统、风控系统等各个系统的性能进行监控和分析，及时发现和解决系统性能问题，保障系统的稳定运行。
对网络设备线路性能分析：
随着业务量和复杂性的增加，网络设备线路性能的稳定性将对企业的正常运营和用户体验造成严重影响。因此，对网络设备线路性能进行实时监控分析对及时解决问题变得尤为重要。
![](media/image2.png){width="6.098611111111111in"
height="3.3965277777777776in"}
监控平台通过对相关日志的采集，提取关键字段信息，通过SPL语句撰写分析语句，形成对网络上行流量、下行流量、丢包数、错包数的实时分析报表，并生成网络拓扑图，实现对网络关系、设备状态、线路性能的全局掌控。
![](media/image3.png){width="5.7659722222222225in"
height="3.082638888888889in"}
对监控范围内的各服务器主机、CPU、磁盘情况进行准实时监控并定期出具月度监控报告，根据主机列表展示资源月度使用情况。通过智能算法计算各资源的健康度，并对各资源的最大使用率、平均使用率以及磁盘写速率、磁盘读速率、磁盘UTIL使用情况等进行趋势监控，帮助运维人员及时发现问题，极大地提高了证券期货行业运维工作的效率。
![](media/image4.jpeg){width="4.908333333333333in"
height="2.9451388888888888in"}
CPU最大使用率趋势
-   数据库运行监控与审计
BPM系统的数据库作为存储业务数据的关键部分，对系统正常运行至关重要。监控系统对BPM数据库服务器进行监控，对数据库的空间分配、表空间情况、活动会话数、慢SQL查询、数据库错误日志等内容进行审计，从而及时发现数据库的异常情况。同时，监控系统还对数据库的RMAN备份情况提供全面详细的审计记录，确保数据库的备份和恢复过程合规进行。此外，监控系统还具备数据库风险发现能力，可以集成数据库漏洞、SQL注入、高危操作等审计功能，根据数据库协议特征精准识别网络中的数据库流量，实现自动审计，及时发现数据库安全风险，保障BPM系统的数据库安全。
![](media/image5.jpeg){width="5.2875in" height="3.1729166666666666in"}
数据库最大活动会话数趋势
-   用户行为与合规审计
通过自定义配置，系统可根据集中采集的相关日志数据自动定期生成巡检报告，实现对信息系统的全面审计，审计内容包括系统配置、用户行为、安全日志、合规性等，从而及时发现潜在的安全风险和合规性问题，并做出及时响应和处理。通过对信息系统的安全和合规性进行审计，监控系统可以帮助企业和组织建立健全的信息安全管理体系，保护重要的信息资产，降低信息安全风险，确保业务的持续和稳定运行。目前已对交易生产环境所有服务器、官网系统核心数据库及主机资源、BPM系统及相关数据库所有服务器、VSphere所有ESXi服务器等均配设自动巡检方案。
监控平台对每个操作系统帐号进行审计，每月定期出具审计报告。通过对用户登录事件的审计，可详细记录和分析用户在系统中的登录行为，包括登录的时间、IP地址、登录方式等信息，从而识别出异常的登录行为，如未经授权的用户登录、登录失败次数过多等情况，及时采取相应的安全措施。
![](media/image6.jpeg){width="3.186111111111111in"
height="1.9111111111111112in"}
审计报告同时对系统账号的添加和删除事件进行监控。通过对账号添加和删除事件的审计，可以追踪账号的创建、修改、删除等操作，防止未经授权的账号创建或删除，从而保护系统账号的安全和合规性。对审计服务的开启和关闭事件的监控以确保审计服务在审计期间始终处于正常的工作状态，从而保障审计结果的完整和准确。此外，还对审计策略调整事件及系统权限变更事件进行报告。审计策略是指对审计的配置和设置，包括审计的范围、频率、目标等参数的设定。通过对审计策略调整事件的监控，可以确保审计策略在审计期间没有被非法篡改，从而保证审计的有效性和可靠性。通过对系统权限变更事件的审计，可监控系统中权限的变更情况，包括用户权限、角色权限、访问控制列表等的变更，从而识别出可能存在的权限滥用、越权操作等安全风险。