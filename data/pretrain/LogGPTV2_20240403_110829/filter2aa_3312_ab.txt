http://paul.vanbrouwershaven.com/2014/05/everyone-needs-http-strict-transport.html
Who uses HSTS?
How it work?
Server
HTTPS
GET / HTTP/1.1
Client
Strict-Transport-Security: max-
age=3153600
Parameters
• maxKage:%amount%of%seconds%that%the%policy%is%
enabled.%
• includeSubdomains:%If%present,%the%policy%
applies%to%all%subdomains,%not%just%the%visited%
one.
Browsers support
•http://caniuse.com/#feat=stricttransportsecurity
HSTS Timeline
HTTPS 
connection
3153600 
secs later
Preloaded HSTS
• Hardcoded%list%of%well%known%
website%names%that%should%always%
use%HTTPS.%
• Prevent%the%security%gap%before%
the%first%HTTPS%connection.%
• Google,%Twitter,%Paypal,%…
Avoid protected names
HTTPS 
connection
3153600 
secs later
Preloaded HSTS - Google
http://www.chromium.org/sts
Preloaded HSTS - Mozilla
https://blog.mozilla.org/security/2012/11/01/preloading-hsts/
Preloaded HSTS - Others
Chromium Source Code
Safari plist
$%plutil%Kp%HSTS.plist%
{%
%%"com.apple.CFNetwork.defaultStorageSession"%=>%{%
%%%%"ssl.googleKanalytics.com"%=>%Kinf%
%%%%"webmail.mayfirst.org"%=>%Kinf%
%%%%"braintreegateway.com"%=>%Kinf%
%%%%"code.google.com"%=>%Kinf%
%%%%"dm.mylookout.com"%=>%inf%
%%%%"therapynotes.com"%=>%inf%
%%%%"chrome.google.com"%=>%Kinf%
%%%%"sol.io"%=>%Kinf%
%%%%"www.sandbox.mydigipass.com"%=>%inf%
[…]
HSTS weakness
• Its%security%relies%on%time.%
• It%completely%trust%the%OS’s%
current%time.%
• This%looks%like%a%job%for%
Delorean!
54
DEMO
Public release
Google response
Lots of things goes wrong…
Let’s Go!
• Modern Time Synchronisation 
• Get in a Delorean 
• HTTP Strict Transport Security 
• Windows task scheduler 
• Public Key Infrastructure 
• Conclusions & Recommendations
Task scheduler
Windows automatic updates
61
DEMO
Let’s Go!
• Modern Time Synchronisation 
• Get in a Delorean 
• HTTP Strict Transport Security 
• Windows task scheduler 
• Public Key Infrastructure 
• Conclusions & Recommendations
PKI, CAs & Certificates
Edo Tensei no Jutsu!
Weak certificates
https://www.eff.org/observatory
Looking around Las Vegas
Let’s look any other…
68
DEMO
Leaked certificates
    Certificate: 
    Data: 
        Version: 3 (0x2) 
        Serial Number: 
            05:e2:e6:a4:cd:09:ea:54:d6:65:b0:75:fe:22:a2:56 
        Signature Algorithm: sha1WithRSAEncryption 
        Issuer: 
            emailAddress              = PI:EMAIL 
            commonName                = DigiNotar Public CA 2025 
            organizationName          = DigiNotar 
            countryName               = NL 
        Validity 
            Not Before: Jul 10 19:06:30 2011 GMT 
            Not After : Jul  9 19:06:30 2013 GMT 
        Subject: 
            commonName                = *.google.com 
            serialNumber              = PK000229200002 
            localityName              = Mountain View 
            organizationName          = Google Inc 
            countryName               = US 
        Subject Public Key Info: 
            Public Key Algorithm: rsaEncryption 
            RSA Public Key: (2048 bit) 
                Modulus (2048 bit):
Heartbleed
Debian PRNG
Certificate Chain
Revocation lists
An example…
Purged CRLs???
Purged CRLs???
CRL
ID%más%viejo
Fecha
DigiCert%SHA2%Extended%Validation%Server%CA%
(Dropbox,%GitHub)
131213031902Z0%
(330%certs)
13/12/2013%03:19
DigiCert%High%Assurance%CAK3%
(Facebook)
120614172516Z0%
140927190602Z0%
(160%certs)
14/06/2012%17:25%
27/09/2014%19:06
GeoTrust%Global%CA%
(Google)
020521134804Z0%
(9%certs)
21/05/2002%13:48
GlobalSign%Organization%Validation%CA%K%
SHA256%K%G2%(LogmeIn)
140331025038Z0%
(637%certs)
31/03/2014%02:50
VeriSign%Class%3%Extended%Validation%SSL%CA%
(Microsoft,%Paypal,%Twitter)
121204020253Z0%
(1709%certs)
04/12/2012%02:02
VeriSign%Class%3%Secure%Server%CA%K%G3%
(Yahoo)
101010055242Z0%
(41120%certs)
10/10/2010%05:52
Online Certificate Status Protocol
What if I can’t connect?
https://www.grc.com/revocation/implementations.htm
79
DEMO
Let’s Go!
• Modern Time Synchronisation 
• Get in a Delorean 
• HTTP Strict Transport Security 
• Windows task scheduler 
• Public Key Infrastructure 
• Conclusions & Recommendations
Conclusions & Recommendations
Facts 
• Time synchronisation isn’t managed securely by most operating 
system vendors. 
• Many security protections relies in time. If an attacker can control the 
local clock, lots of things can go wrong. 
What to do 
• Configure NTP synchronisation in a secure way (Microsoft does): 
• Signature. 
• Maximum drift. 
• Block SSL certificates which expiry date is before the browser build 
date or the last update (Chrome does).
82
Jose Selvi 
http://twitter.com/JoseSelvi
PI:EMAIL 
http://www.pentester.es
PI:EMAIL 
http://www.nccgroup.trust
Thanks! Questions?
UK Offices 
Manchester - Head Ofﬁce 
Cheltenham 
Edinburgh 
Leatherhead 
London 
Thame 
North American Offices 
San Francisco 
Atlanta 
New York 
Seattle
Australian Offices 
Sydney
European Offices 
Amsterdam - Netherlands  
Munich – Germany 
Zurich - Switzerland