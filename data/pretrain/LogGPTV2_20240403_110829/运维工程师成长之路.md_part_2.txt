8.2.1
ZooKeeper简介
Zookeeper..
高性能协调服务之
KSM内核·页·并·.1.85
7.3..EPT...1.84.
7.3.2
ZooKeeper 的单机
角色作过程198
ZooKeeper的集群
ZooKeeper·.….1.98
选Leader.1.9.
ZooKeeper数据结构..193
ZooKeeper系统结构.….193
ZooKeper.·.…192
191
191
187
190
附录
附录B
附录Avirsh命令及其含义….260
总结
8.10
8.7Hadoop2搭建...
8.6
8.5
8.8.3
8.8.2
8.8.1Ganglia的基本概念...243
8.7.4
8.7.3
8.7.2
8.7.1环境准备
8.6.3
8.6.1参数修改.
Hadoop1.X优..
ZooKeeper..dashboard.....202
小结.
8.6.2
yum·令及其含·.262
Ganglia的.….246
Ganglia的工作原理…….244
FEDERATIONHA.235
配置NAMENODE
启...?..
安装配置
Hadoop集群更改
59
.1.
.............
目录
205
3
---
## Page 11
买机柜及带宽的量级时就不会找不到头绪了。
书中所介绍的选择机房的性价比及计算带宽等方法还是很实用的。看完这章，小鑫在写购
少的人，于是立即下单购买。
的标准网站架构中所使用的应用。小鑫心想这本书正适合自己这种知识面不广并且经验又
名为《高性能网站构建实战》的图书的内容简介。这本书的内容还真不少，包含一套完整
无奈小鑫只好一页一页地浏览，突然看到一个机房介绍的网址链接，打开链接发现是一本
可是搜索出来的结果却令小鑫失望，大多数都是广告性质的推广，看不出机房真实的情况
很少，对北京的IDC情况也不是很清楚。于是迷茫的他只好上网搜索相关的IDC资料，
1.1.1调研IDC准备
1.1寻找IDC数据中心
研一下，然后这个月定下来。”
收到书后，小鑫立刻寻找机房介绍的章节，发现虽然不是介绍北京IDC提供商的，但
不过小鑫目前的问题还没有解决。他注意到这本书的作者在北京，猜想能写出这样书
小鑫是一个刚刚大学毕业的学生，虽然在校期间管理过校园网，但在运维方面的经验
“好的，我去看看”。小鑫回复了主管就开始IDC的调研。
“小鑫啊，因为最近公司的业务正式上线，所以我们需要有个高质量的IDC。你去调
企业互联网根基之IDC的选择
第
---
## Page 12
2
还有一些价格较低，但质量及服务确实也没什么保证。前几年各大运营商及IDC提供商
一些商家确实没有好的资源，也有一些商家的部分地点资源不好），但费用还是一样贵。
件一般不用担心。有一些IDC自身品牌比较不错，但可能给你使用的线路并不是最好的（有
有几个大牌的IDC公司自建了多处机房，其余的都是和电信或联通合作的，所以机房的硬
虑具体情况吧。
其作用是互相备份及流量的负载。估计你那边将来也不会仅仅是一个机房，到时候再考
小鑫：
件的提醒，小鑫迫不及待地打开邮件，看来邮件没有被“过滤”掉，
编程。今天晚上比较特殊，他一直期待新的邮件。晚上11点多时，邮箱客户端显示新邮
个好的回复吧。
加上我本人对北京的IDC提供商不是很熟悉，所以麻烦您给我介绍几家。
一个线路质量特别好的IDC提供商。我在网上搜索过，不过大多都是推广性质的广告，再
本书给我的帮助。可我还有个问题想请教一下，我这边的业务准备上线，需要在北京寻找
刘老师：
者发一封求助邮件。
的作者肯定接触了不少的IDC提供商，所以小鑫决定给《高性能网站构建实战》一书的作
企业互联网根基之IDC的选择
第1章
，其他的地方我还真不清楚，北京的情况多少还是知道一些的。
北京的IDC圈比较杂（代理商多、带宽种类多），机房的硬件条件我就不多说了。仅
我以前和联通的人聊过，细节就不多说了，只能说在北京每个区至少有两个出口，
小鑫一般吃完晚饭就没什么事了，有时候看看新出的电影大片，有时候学学Python
发完邮件后，小鑫心里还有些怎正。这封邮件不知道会不会被“过滤”掉，期待能有
我刚刚拜读过您的《高性能网站构建实战》，感觉这本书特别适合我，很感谢您的这
图1-1是中国互联网络带宽图，虽然不是最新的，但至少能看出来主要的节点是北上
谢谢！
您好！
首先感谢你对我的支持。
你好！
，真是太高兴了。
---
## Page 13
起码外表看着要正规，但有一些自建机房的机柜都算不上机柜，只能算是机架吧。供电不
这一点很重要，
签合同时会和你说是2:1或者是10:3，这样你就会花1:1线路的钱却用着不等价的线路。
的比例。一般情况下我们谈的都是1：1的线路（上下行比例是1:1）。但如果你不问，等到
线路，所以最好选择信誉度较高的提供商。
成本。还有一些提供商，测试时给你提供好的线路，但当你实际使用时，给的又是另一个
多商家都有自己的IDC环网，走的出口不是当前地区而是另外一个区的，目的是为了节省
择大品牌。
也可以和公司建议一下，选择性价比高或者适合自己公司的IDC即可，不一定非要选
牌的IDC，所以近一半的利润都给了IDC公司。当然，我说这个只是提醒你一下，你
说什么。
即使是相同的商家也会根据目标客户的规模来定制相应的服务，所以服务方面我也不好
都在拼资源、拼质量，最近都在拼各种服务及解决方案。不同的商家提供不同的服务。
另外除了带宽，还有机柜。机柜唯一要关注的就是电。至于外表就不多说了，机柜最
还有一点要注意的是，有很多提供商最初只是和你说线路的费用，并不和你谈上下行
整个北京线路的出口在各区就那么多，所以你在选择IDC的地点时也要注意。因为很
我认识一个做游戏运营的朋友，他公司每年赚得不少，
，一定要注意。
0
图1-1
11
，不过就是因为选择了大品
1.1
1寻找IDC数据中心
3
---
## Page 14
进机房感觉一下就行，多去几个机房就会有很直观的感受。
机的一看就知道，主要是有些机房的发电机基本上就是一个摆设。机房的温湿度，你直接
提供商只要有ICP和ISP资质也是可以经营的。至于机房的电，也要考察一下。没有发电
很多，主要就是使用时间的长短。毕竟硬件都会有一个高频率故障期，这点注意一下即可。
联系后，他们会给你介绍他们各地点的机房，建议你测试完后再去看看。理论上硬件差的不是
能确认其资源来源。这里我给你推荐几家在兆维信誉比较不错的IDC提供商，像ABC、XYZ。
的资源不知道已经倒了几手了，并且线路也有不是北京本地的。这些你和他们谈的时候最好
房也是走这里的线路（这里有电信或者联通的出口）。不过兆维的提供商不是一般的乱，有
稳定的地方了。那个位置不但电力有保障，而且线路带宽也是有保障的，很多其他地区的机
非常不错的。除了线路，这个地点离中关村也不远，打车半小时，方便维护。
我公司为了选择一个线路质量不错的地点，测试了7家IDC提供商，XXX那边的带宽是
这点你注意一下就行了。
过7A，价格可是相当不便宜，这就是大品牌啊…一般情况下，机柜分10A和13A的。
企业互联网根基之IDC的选择
第1章
XXX和兆维这两个地点还是不错的，主要是看你们怎么去和提供商谈价格吧。当你和他们
我不清楚你公司的位置，如果在中关村的话，放在XXX地点也是不错的选择。去年
对于一个IDC提供商而言，只有具备这些资质才可以参加投标。当然，
（5）ICP经营许可证。
（3）税务登记证。
（2）中华人民共和国组织机构代码证。
除了资源和服务，一个IDC还需要具备一些资质，完整的资质包括以下几点。
还有一个地点是兆维的电信机房，我们原来的机房就是放在那里，可以说是一个比较
最后，再一次感谢你的支持。
（8）资信证明（3AA）。
（7）ISO9001质量管理体系认证。
（6）ISP经营许可证。
（4）一般纳税人证明。
（1）最新年检营业执照。
一般的IDC
---
## Page 15
的且没有使用其他的第三方付费工具。
小鑫：
介绍，所以也就很耐心地等待刘老师的邮件。
了联系并已进入测试阶段，但由于我个人对这方面并不是很了解，所以还得麻烦您和我说
刘老师：
不清楚了。所以小鑫又一次给刘老师发了一封邮件。
然后就进入了测试阶段。不过小鑫仅知道可以使用ping命令测试一下大型网站，其他的就
1.1.2IDC线路测试
一下。小鑫想着，看来那边确实不错，不然也不会那么火。
XXX那儿的人挺多，而且带宽质量也不错，让小鑫多联系几家兆维的IDC提供商去测试
老师了，不然被别人坑了都不知道。小鑫赶紧回了封邮件表示感谢。
小鑫顿时感到头有点大，要是没人提醒，谁能想到还有这么多注意事项，可真得要感谢刘
一下测试机房的一些事情，谢谢。
发完邮件后，小鑫在网上也搜索了一些测试机房的详细信息，可惜大多是无关紧要的
第二天，小鑫刚想找领导汇报情况，谁知领导直接找到小鑫，然后说他了解到使用
218.30.108.232电信；
首先提供几个线路测试时需要的IP（这些IP以前用过，当然你自己也可以找一下）：
这几家的IDC还是不错的，下面大概和你说一下手动的测试方法。这些方法是“开源”
晚上，小鑫如期收到了刘老师的邮件。
又一次麻烦了，感谢您上次对机房的介绍和推荐。我们这边已经很顺利地和他们取得
您好！
小鑫找到了XXX和兆维的ABC、XYZ几家IDC提供商，通过见面了解了一些情况，
小鑫看完邮件就觉得这信息量也太大了，先不说机房的地点，仅带宽就有这么多说道。
61.135.169.125联通；
你好！
1.1寻找IDC数据中心
5
---
## Page 16
的，因为非北京的带宽会便宜很多，往往是北京本地带宽价格的1/4～1/3。
束后需要找出测试时ping的最大值、最小值及平均值，做好记录以备对比测试结果时使用。
测试一下IDC的稳定性。
为这样可以测试到同机房的一些公司流量突然增加时会不会影响到其他公司，也从侧面
仅是一个机房一条线路。测试时间上至少是24小时，最好选在有节日的时间段里，因
是工作在三层IP层，所以你用 tcpping来测试的话，结果有可能不如ping 测试的准确。
工具，但是我不建议你使用这类工具。因为tcpping这类工具是工作在四层TCP层，而ping
的，上面的几个IP仅供参考。
是BGP多线，我们可以根据上面给的IP进行简单的ping测试，当然你也可以自己找其他
方法。
这不仅仅是因为机房带宽的问题。
样基本测试不出提供商的峰值及稳定性，意义不大。所以这种提供商是可以忽略的，因为
为了线路的“保障”，提供的测试带宽并没有限制，或者说并不是按着你提出的要求，这
这样机房B是测试不出机房A提供带宽的最大值的。还要注意的是，有一些IDC提供商
5MB（标准带宽指的是上传和下载的速度比例为1：1），机房A提供的标准带宽是10MB，
于机房A，不然就不能准确地测试出机房A的带宽质量。假设机房B提供的标准带宽是
器上wget下载这个文件，看看一下载文件的速度能达到多少。当然机房B的带宽不能小
企业互联网根基之IDC的选择
分是带宽可能不是北京本地的。这些带宽是提供商从北京附近（如河北）的线路整合过来
外，还有一些相对普通但报价低很多的提供商，这些提供商一部分是策略需要，也有一部
些在同一地点的不同IDC提供商有时候带宽的价格相差很大，除了有个别是报价虚高的
第1章
前面提到过测试带宽“量”的问题，这个测试是要说明一下带宽的“质”的问题。一
如果测试时间覆盖了早晚及节假日的话，那么相对来说准确性会高一点。测试时间结
测试得出的结果保存在类似“机房_线路_ping”这样文件名的文件中，因为测试不仅
这里要提醒你的是，有些提供商是禁用ping测试的，他们会让你使用tcpping这样的
最简单的就是ping。我在上面已经给了几个测试的IP，现在购买的机房线路大部分都
接下来，我们需要测试从所在机房出去的线路质量，大致有以下几个“开源”的
在机房A的一个服务器上创建一个大文件（最好是GB级），在另一个机房B的服务
然后我们开始测试带宽峰值的情况。
121.195.178.239教育。
---
## Page 17
地部署的话，就使用Smokeping。
素，所以测试结果也不是很准确，但是用来做大概的评估还是可以的。如果你那边可以多
很多人帮忙，使用的方法也是上面提到过的。
5019224）、“系统运维专业群”（QQ群号为3902836）。你在这两个群里求帮助的话，会有
会有很多人来帮你的）。这里给你介绍几个QQ群，如“Linux饭醉团伙”（QQ群号为
Python2.7，其他的版本没试过，但理论上也是可以的。
为北京IP。
以后分析对比用。时间可以根据你的需要来定，我们需要查看每经过一个路由的IP是否
并不是很多。
为有一些IDC的提供商早晚走的路由是不同的，毕竟相对来说大部分的公司晚上用的带宽
ping测试那样需要24小时一直不停地测试，但早晚这两个时间段还是一定要测试的。因
目的地IP的命令（它的具体作用和工作原理你自己搜索一下）。tracert测试虽然说不用像
是北京本地的带宽很重要。
样的带宽的话，不仅仅是使用了质量差的带宽，还损失了一笔不小的费用，所以测试是否
我们第二个“开源”的方法是tracert。它是检测当前测试服务器通过几个路由后到达
特别强调一下，ping和tracert一定要多采集几天的数据。
这个数据库有段时间没更新了，你可以自己找一个最新的版本使用。这里统一用的是
建议根据上面的几个IP测试，把测试结果保存在文件“机房_线路_tracert”里，以便
查询IP的脚本、数据库我已经放在附件里了，它的使用格式如图1-2所示。
这样一来，提供商的成本会大大地降低。如果不经过测试，用北京本地的价格买了这
只是这种手工的测试可能不太尽如人意，因为人员、地点、时间、网络等各种不定因
这个可以请全国各地的一些朋友来帮忙（在QQ群里可以喊一声，如果你运气好的话
另外，还有一个测试是查看数据从外部到IDC内服务器的。
[root-sys liu=
02.
ootusys
rootsys
106.0.
.20
Iiu#python.-V
ChaIP.
图1-2
PY
联通ADSL
202
06.0.20
202.106.0.20
1.1
寻找IDC数据中心
---
## Page 18
8
1-5所示。
它的安装配置比较简单，我这里就不多说了，附上几张图你大致看一下，如图1-3到图
个监视点检测C点的ping效果，可以把A、B的检测结果在一个图上表示出来，便于比较。
常漂亮，
能
企业互联网根基之IDC的选择
第
、监控dns查询性能和监控 ssh性能等。底层也是以rrdtool作支持，其特点是画的图非
1章
最新版本的Smokeping支持多个节点的检测结果从一个图上画出来。比如从A、B两
Smokeping主要是监视网络性能，包括常规的 ping、用echoping 监控www服务器性
网络丢包和延迟用颜色和阴影来表示。
Seconds
Seconds
Seconds
口
100
Berkleyo
18:
80
1
00
8
2
rvers
vers
rvers
r5
11
3458
8
862155886
DNS Root Servers as seen from Init7
DNS
46
9257897
Root Servers as
PP
US Host Connectivity
图
G
图
图
0000
040000000
1-5
1-4
1-3
80
010900030
seen
from
7863
026013916
198678332064530
ETH
433536389
C55555A555
57438
8
44336475日
8
---
## Page 19
法我这方面的基础比较差，麻烦您了。
tracert 的路由放到一个文本里，那么多IP，我是不是要一个一个地去执行您所介绍的方
段”，这会使我们在选择IDC时可以避免很多的损失，再次感谢您。
刘老师：