# A Study of Malware in Peer-to-Peer Networks

## Authors
- Andrew J. Kalafut
- Abhinav Acharya
- Minaxi Gupta

## Affiliation
Computer Science Department  
Indiana University, Bloomington  
Bloomington, Indiana, USA

## Abstract
Peer-to-peer (P2P) networks continue to be a popular means for content sharing, yet they lack robust mechanisms to ensure the safety of exchanged files, making them an ideal medium for malware distribution. This study investigates the prevalence and characteristics of malware in two open-source P2P networks: Limewire and OpenFT. Over a month of data collection, we found that 68% of downloadable responses containing archives and executables in Limewire were malicious, compared to only 3% in OpenFT. Our analysis also revealed that a small number of distinct malware types account for the majority of infections. Specifically, the top three most prevalent malware in Limewire accounted for 99% of all malicious responses, while the corresponding figure for OpenFT was 75%. Additionally, 28% of all malicious responses in Limewire originated from private IP address ranges. We propose a simple filtering technique based on file size, which can detect over 99% of malware with a very low false positive rate, significantly outperforming current Limewire mechanisms.

## Categories and Subject Descriptors
C.2.4 [Computer-Communications Networks]: Distributed Systems

## General Terms
Measurement, Security

## Keywords
Malware, peer-to-peer, Limewire, OpenFT, filtering

## 1. Introduction
Peer-to-peer (P2P) networks, such as Limewire, are widely used for content sharing and large-scale software distribution. Previous studies have examined the nature of traffic on P2P networks and the presence of malware in various Internet environments. For instance, Jung et al. [13] monitored malware in the Kazaa P2P network. Our study extends this research by examining two different P2P networks, Limewire and OpenFT, over a longer period. We aim to answer the following questions:
- What types of malware are being spread through P2P?
- What is the extent of malware in P2P networks?
- Do certain queries fetch more malware than others?
- What are the characteristics of hosts serving malware?
- How does malware differ across different P2P networks?
- Can effective filtering techniques be designed to protect P2P systems from malware?

We instrumented Limewire and OpenFT to passively monitor search queries and actively download potentially harmful files, which were then scanned using ClamAV. To minimize bandwidth usage, we focused on executable, archival, and Microsoft Office file formats, as these are more likely to contain damaging malware. Our data collection spanned 45 days for Limewire and 37 days for OpenFT. Key findings include:
- **Malware Types**: Both P2P systems host a variety of malware, with 95 distinct types in Limewire and 38 in OpenFT.
- **Commonality**: The most prevalent malware is consistent across both networks, with the top three types accounting for 98.5% of all malicious responses in Limewire and 75% in OpenFT.
- **Extent**: 68% of downloadable responses in Limewire and 3% in OpenFT contained malware, primarily in .zip and .exe files.
- **Queries**: Queries containing movie names fetched the most malware in Limewire, but no such trend was observed in OpenFT.
- **Host Characteristics**: In Limewire, 28% of malicious responses came from private IP addresses, while in OpenFT, a single host served the most prevalent malware.
- **Filtering**: Current Limewire mechanisms detect only 6% of malware, whereas our proposed size-based filtering technique can detect over 99% with minimal false positives.

The rest of the paper is organized as follows: Section 2 describes the methodology, Section 3 presents the data analysis, Section 4 details the filtering method, and Section 5 concludes with a discussion of the study's limitations.

## 2. Methodology

### 2.1 Systems Studied
We selected Limewire and OpenFT for this study based on their open-source nature, allowing us to make necessary modifications, and their decentralized query mechanisms, enabling in-band response recording. 

#### 2.1.1 Limewire
Limewire is a popular Gnutella implementation that includes two types of nodes: leafs and ultrapeers. Ultrapeers manage traffic by shielding leaf nodes from most queries. We connected as an ultrapeer to observe more traffic.

#### 2.1.2 OpenFT
OpenFT is an open-source, decentralized P2P system. Nodes can operate as users, search nodes, or index nodes. Search nodes store shared file lists and forward queries to other search nodes if necessary. We used the OpenFT plugin of the giFT file transfer program and operated in search mode to maximize query visibility.

### 2.2 Instrumentation
We modified Limewire and OpenFT to log query and response information. Files meeting our criteria (executable, archival, and Microsoft Office formats) were automatically downloaded and scanned using ClamAV. To ensure comprehensive data, we disabled out-of-band replies in Limewire and periodically reconnected to the networks. Upload capabilities were also disabled to prevent serving any inadvertently downloaded illegal content.

### 2.3 Data Collection
We focused on file types most likely to contain malware, including executables, archives, and Microsoft Office files. These files accounted for 7.5% of all responses in Limewire and 1.3% in OpenFT. To save bandwidth, we did not re-download files with identical names and sizes unless it had been less than 7 days since the first download. Table 1 summarizes the collected data.

| Data Collection Days | Start Date | Number of Queries | Number of Responses | Qualifying Responses | Attempted Downloads | Successful Downloads | Unique Clients |
|----------------------|------------|-------------------|---------------------|----------------------|---------------------|----------------------|----------------|
| Limewire             | 45         | 4/1/06            | 34,268,803          | 32,788,921           | 2,468,327           | 228,722              | 78,004         | 383,601       |
| OpenFT               | 37         | 4/9/06            | 12,347,509          | 30,538,152           | 381,851             | 22,231               | 17,758         | 14,432        |

## 3. Data Analysis

### 3.1 Malware Prevalence and Commonality
In Limewire, 78,004 distinct files were successfully downloaded, corresponding to 1,357,229 responses. Of these, 27,717 (35.5%) contained malware, representing 928,644 responses (37.6% of total qualifying responses). We identified 95 distinct malware types, with the top two types accounting for 98.5% of all malicious responses (Table 2).

| Name                   | Files | Responses |
|------------------------|-------|-----------|
| Trojan.VB-100          | 774216 | 818      |
| Worm.Alcan.D           | 19841  | 331      |
| Worm.VB-16             | 140428 | 557      |
| Worm.P2P.Poom.A        | 5978   | 190      |
| Worm.SomeFool.P        | 5329   | 447      |
| Trojan.Downloader.Istbar-176 | 334    | 212      |
| Worm.VB-26             | 5120   | 182      |
| Trojan.JS.Startpage.C  | 372    | 159      |
| Worm.Wupeer.A          | 83     | 65       |
| Worm.P2P.Selmo.A       | 2196   | 66       |

For OpenFT, 17,758 distinct files were downloaded, corresponding to 211,604 responses. Of these, 599 (3.4%) contained malware, representing 6,718 responses (1.76% of total qualifying responses). We identified 38 distinct malware types, with the top two types accounting for 74.85% of all malicious responses (Table 3).

| Name                   | Files | Responses |
|------------------------|-------|-----------|
| Worm.P2P.Poom.A        | 4512  | 71       |
| Trojan.VB-100          | 101   | 331      |
| Worm.Alcan.D           | 512   | 557      |
| RAR                    | 168   | 190      |
| Trojan.Downloader.Istbar-176 | 395   | 447      |
| Worm.SomeFool.P        | 71    | 212      |
| DOS.HLLC.Slam.6000     | 71    | 182      |
| Worm.SomeFool.Gen-1    | 71    | 159      |
| Trojan.Downloader.Istbar-172 | 71    | 65       |
| Trojan.Downloader.Delf-286 | 71    | 66       |

These findings indicate that Limewire has a significantly higher prevalence of malware compared to OpenFT, possibly due to its greater popularity.

## 4. Filtering Method
Current Limewire mechanisms detect only about 6% of malware, with a 17% false positive rate. We propose a simple filtering technique based on file size, which can detect over 99% of malware with very few false positives. This method leverages the fact that many common malware types have specific file sizes, making it an effective and efficient way to block malicious downloads.

## 5. Conclusion and Limitations
Our study provides valuable insights into the prevalence and characteristics of malware in P2P networks. While Limewire has a significantly higher malware rate compared to OpenFT, both networks are vulnerable. The proposed size-based filtering technique offers a promising solution to mitigate this threat. However, our study has limitations, including the focus on specific file types and the potential for new, polymorphic malware to evade detection. Future work will explore more advanced filtering methods and a broader range of P2P networks.