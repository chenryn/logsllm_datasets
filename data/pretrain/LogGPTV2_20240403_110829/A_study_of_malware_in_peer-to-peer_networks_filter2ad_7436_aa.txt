title:A study of malware in peer-to-peer networks
author:Andrew J. Kalafut and
Abhinav Acharya and
Minaxi Gupta
A Study of Malware in Peer-to-Peer Networks
Andrew Kalafut
PI:EMAIL
Abhinav Acharya
Minaxi Gupta
PI:EMAIL
Computer Science Department
Indiana University, Bloomington
Bloomington, Indiana, USA
PI:EMAIL
ABSTRACT
Peer-to-peer (P2P) networks continue to be popular means of trad-
ing content. However, very little protection is in place to make sure
that the ﬁles exchanged in these networks are not malicious, mak-
ing them an ideal medium for spreading malware. We instrument
two different open source P2P networks, Limewire and OpenFT, to
examine the prevalence of malware in P2P networks. Our results
from over a month of data show that 68% of all downloadable re-
sponses in Limewire containing archives and executables contain
malware. The corresponding number for OpenFT is 3%. Also,
most infections are from a very small number of distinct malware.
In particular, in Limewire, the top three most prevalent malware
account for 99% of all the malicious responses. The corresponding
number for OpenFT is 75%. We also investigate the sources of ma-
licious responses. To our surprise, 28% of all malicious responses
in Limewire come from private address ranges.
In OpenFT, the
top virus, which accounts of 67% of all the malicious responses,
is served by a single host. Further, our study provides a useful in-
sight into ﬁltering malware: ﬁltering downloads based on the most
commonly seen sizes of the most popular malware could block a
large portion of malicious ﬁles with a very low rate of false posi-
tives. While current Limewire mechanisms detect only about 6% of
malware containing responses, our size based ﬁltering would detect
over 99% of them.
Categories and Subject Descriptors
C.2.4 [Computer-Communications Networks]: Distributed Sys-
tems
General Terms
Measurement, Security
Keywords
Malware, peer-to-peer, Limewire, OpenFT, ﬁltering
Permission to make digital or hard copies of all or part of this work for
personal or classroom use is granted without fee provided that copies are
not made or distributed for proﬁt or commercial advantage and that copies
bear this notice and the full citation on the ﬁrst page. To copy otherwise, to
republish, to post on servers or to redistribute to lists, requires prior speciﬁc
permission and/or a fee.
IMC’06, October 25–27, 2006, Rio de Janeiro, Brazil.
Copyright 2006 ACM 1-59593-561-4/06/0010 ...$5.00.
1.
INTRODUCTION
Peer-to-peer (P2P) networks like Limewire [8] continue to be a
popular medium for sharing content and many organizations reg-
ularly rely on them for large-scale software distribution. Several
previous studies have evaluated the nature of trafﬁc on P2P net-
works [4, 5, 7] and the presence of malware and other types of
attacks in various Internet environments [6, 11, 9, 10, 12, 18]. In
particular, work in [18] uses ﬁrewall logs to determine the Internet-
wide distribution of malware and a crawler-based study of malware
in the Internet is conducted by [11]. Work in [20, 19] discusses
the threat of worms in P2P networks based on network character-
istics. Jung et al [13] crawled the Kazaa P2P network to moni-
tor the presence of malware in popular downloaded content over
two periods of 3 days each. Our study looks at two different P2P
networks, Limewire [8] and OpenFT [2]. Further, we observe all
search queries for a much longer period of time to estimate the ex-
tent of malware. In particular, we ask the following questions:
(cid:129) What types of malware are being spread through P2P?
(cid:129) What is the extent of malware in P2P networks?
(cid:129) Do certain queries fetch more malware than others?
(cid:129) What are the characteristics of hosts serving malware?
(cid:129) How does malware differ across different P2P networks?
(cid:129) Can effective ﬁltering techniques be designed to protect P2P
systems from malware?
We instrument Limewire and OpenFT to passively monitor the
results of content search queries and then actively download ﬁles
that match our criteria of being potentially harmful. These ﬁles are
then examined by ClamAV malware scanner software [16] in order
to determine if they contain malware. In order to keep the band-
width used to download ﬁles low, we focus primarily on executable,
archival, and Microsoft Ofﬁce ﬁle formats because of the immense
damage malware embedded in such ﬁles can do. Another reason to
eliminate media ﬁles is because malware contained in media ﬁles
must rely on buffer overﬂow type of attacks in the playback code
of speciﬁc applications to do damage.
The data presented here is collected over a period of 45 days
for Limewire and 37 days for OpenFT. The key ﬁndings from this
preliminary version of our study include:
(cid:129) Malware types: Both P2P systems experience a large number
of distinct types of malware. We ﬁnd 95 distinct types of
malware in Limewire data and 38 in OpenFT.
(cid:129) Commonality: The most popular malware is the same across
Limewire and OpenFT. Of the top 10 distinct malware in
each system, 5 are common. Further, a majority of infections
in both systems are from just a few distinct types of malware.
In particular, the top three most prevalent malware account
for 98.5% of all the malicious responses in Limewire. The
corresponding number for OpenFT is 75%.
(cid:129) Extent: 68% of all downloadable responses containing ex-
ecutable, archival, and Microsoft Ofﬁce ﬁle extensions con-
tain malware in Limewire. The corresponding percentage for
OpenFT is 3%. Most of the infections appear in zip and exe
ﬁles.
(cid:129) Queries: Queries containing movie names fetch the most
malware in Limewire. In OpenFT, no such trend is observed.
(cid:129) Host characteristics: Malicious responses in Limewire are
more likely to come from private address ranges. These ad-
dresses account for 1.5% of all responses, but 28% of all
malicious responses. In OpenFT, the most seen malware, ac-
counting for 67% of all the malicious responses, is served by
a single host.
(cid:129) Filtering: Limewire’s current system detects about 6% of
malware with a 17% false positive rate. We propose a simple
ﬁltering criteria based on ﬁle sizes, which detects over 99%
of malware with very few false positives.
The rest of this paper is organized as follows. Sections 2 and 3
describe data collection and analysis respectively. Section 4 de-
scribes our ﬁltering method for detecting malware in P2P systems.
Finally, Section 5 concludes and discusses the limitations of our
study.
2. METHODOLOGY
2.1 Systems Studied
We considered certain criteria when selecting which P2P sys-
tems to study. First, they had to be open source so we could make
the necessary modiﬁcations. Second, since observing actual down-
loads is not an option due to privacy concerns, the search mech-
anism had to be decentralized and the query replies had to be re-
turned in-band, so we could record the searches. Based on these
reasons, and their popularity, we have chosen the Limewire [8] and
OpenFT [2] systems.
2.1.1 Limewire
Gnutella [3] is a popular P2P protocol with many software vari-
ants. While older Gnutella clients treated all nodes equally, newer
implementations have two types of nodes:
leafs and ultrapeers.
The ultrapeers shield the leaf nodes attached to them from seeing
most queries in order to minimize trafﬁc. The response to a query is
either sent back in-band along the query arrival path or out-of-band
directly to the node originating the query. We use Limewire[8], a
popular Gnutella implementation and connect as an ultrapeer in
order to see more trafﬁc.
2.1.2 OpenFT
OpenFT [2], short for “Open FastTrack,” is an open source de-
centralized peer-to-peer system. Despite the name, it does not use
the FastTrack protocol used in Kazaa. Nodes in the OpenFT system
can operate in three modes: user, search, or index. A user node is
the end user who submits queries and receives responses. Search
nodes are similar to Gnutella’s ultrapeers and are responsible for
storing the list of shared ﬁles for users connected to it. An index
node is responsible for maintaining the list of search nodes and for
collecting statistics. When a user submits a query, the search node
executes the search on its database of shared user ﬁles. If the num-
ber of matches found is less than a pre-determined number, then it
forwards the query to its peer search nodes. These then execute the
same and pass it on to their peers and so forth. The replies travel
back along the same path to the original search node which hands
the results to the user who requested it. We use the OpenFT plugin
of the giFT ﬁle transfer program. This is the original implemen-
tation of OpenFT. Further, we operate our node in search mode in
order to see the most queries and responses.
2.2 Instrumentation
To collect data for this study, we made several modiﬁcations to
Limewire and OpenFT. We have added to both clients the ability to
remember information for queries sent through us. This is used to
later match the query with the response sent for it. Any ﬁles seen
in query responses that meet our downloading criteria (described
in Section 2.3) are automatically downloaded and scanned with the
ClamAV[16] open source malware scanner. ClamAV contains sig-
natures for over 65, 000 malware (including variants). The Cla-
mAV signature database is frequently updated, often several times
within a day. Since Limewire permits both in-band and out-of-band
replies for the queries, we also instrumented our Limewire client to
modify all query packets sent through our node to disable requests
for out-of-band replies. This allowed us to see all the responses to
these queries.
We make both of our clients disconnect and reconnect periodi-
cally (every 12 hours for Limewire and every two days for OpenFT)
to ensure we see diverse views of the P2P network upon every con-
nection. Further, we have disabled the upload capabilities of both
programs in order to avoid serving any illegal content we may in-
advertently download during the data collection.
2.3 Data Collection
Since it is not common for ﬁles with media ﬁles extensions to
contain malware, we choose the extensions to download based on
what Limewire considers to be program ﬁles1. To these executable
and archival ﬁle formats, we add Microsoft Ofﬁce ﬁles, doc, ppt,
and xls, because they can potentially contain macro viruses. Files of
the types we choose to download account for 7.5% of all responses
seen in Limewire and 1.3% of all responses seen in OpenFT. This
choice saves the bandwidth required to download ﬁles and allows
us to focus on the most suspect ﬁles in this preliminary study.
Notice that executable ﬁles disguised as other formats, such as
“desired song.mp3.exe” will be caught by our methodology.
Further, in general we do not attempt to download a ﬁle again if
we have already successfully downloaded and scanned a ﬁle with
an identical name and size. We decide on this bandwidth sav-
ing strategy because our initial re-downloads of both “clean” and
infected ﬁles failed to change the conclusion about the nature of
ﬁles. Further, many popular malware these days change names
upon each infection (and may change size if they are polymorphic),
and we have observed the [ﬁle name, size (in bytes)] combination
in general to be very unique. An exception to the above download
strategy is made in Limewire in order to detect malware which may
not have had a signature ready when we ﬁrst see it.
In this ex-
1These are ace, arj, awk, bin, bz2, cab, csh, cue, deb, dmg, exe, gz,
gzip, hqx, iso, jar, jnlp, lzh, lha, mdb, msi, msp, nrg, pl, rar, rpm,
sh, shar, sit, tar, taz, tgz, z, zip, zoo and 7z.
ception, if we determine a ﬁle to be “clean” and it has been less
than 7 days from the ﬁrst time we saw the ﬁle, we will attempt to
download it again after 7 days from when we ﬁrst saw the ﬁle. A
summary of the collected data is shown in Table 1.
Data collection days
Start date
Number of queries
Number of responses
Qualifying responses
Attempted downloads
Successful downloads
Unique clients
Limewire
45
4/1/06
34,268,803
32,788,921
2,468,327
228,722
78,004
383,601
OpenFT
37
4/9/06
12,347,509
30,538,152
381,851
22,231
17,758
14,432
Table 1: Aggregate statistics. Qualifying responses are the re-
sponses with ﬁle extensions that we consider downloading. At-
tempted downloads are different from successful downloads be-
cause many downloads fail due to host non-availability (mostly
because its IP address belongs to the private address range).
3. DATA ANALYSIS
3.1 Malware Prevalence and Commonality
As said in Table 1, we successfully downloaded 78, 004 dis-
tinct ﬁles for Limewire. These ﬁles correspond to 1, 357, 229 re-
sponses, or 54.9% of the unique qualifying responses that con-
tain executable, archival, or Microsoft Ofﬁce ﬁle extensions. Of
the downloaded ﬁles that are distinct, 27, 717, or 35.5% contained
malware. The infected ﬁles correspond to 928, 644 responses, or
approximately 37.6% of the total qualifying responses (68.4% of
the responses for which we were able to download ﬁles).
92 different types of malware were found in Limewire2. Table 2
summarizes the top 10 malware found in Limewire, along with the
number of responses each corresponded to. The top two malware
correspond to 98.5% of all the qualifying downloadable responses.
Name
Trojan.VB-100
Worm.Alcan.D
Worm.VB-16
Worm.P2P.Poom.A
Worm.SomeFool.P
Trojan.Downloader.Istbar-176
Worm.VB-26
Trojan.JS.Startpage.C
Worm.Wupeer.A
Worm.P2P.Selmo.A
Files Responses
774216
19841
140428
5978
5329
334
5120
372
83
2196
818
331
557
190
447
212
182
159
65
66
Table 2: Summary of top malware found in Limewire.
For OpenFT, 17, 758 distinct ﬁles were successfully downloaded.
They corresponded to 211, 604 responses, or 55.4% of all qualify-
ing responses. Of the downloaded ﬁles, 599, or 3.4% contain mal-
ware. The infected ﬁles correspond to 6, 718, or about 1.76% of
the qualifying responses (approximately 3.2% of the qualifying re-
sponses for which we were able to download ﬁles). These numbers
2Three more found by our re-download strategy, which we discuss
in Section 3.4.
indicate that there is signiﬁcantly less malware on OpenFT than on
Limewire. The popularity of Limewire could contribute to this.
38 different types of malware were found in OpenFT. Table 3
summarizes the top 10 malware found in OpenFT data, along with
the number of responses each corresponded to. The top two mal-
ware correspond to 74.85% of all the qualifying downloadable re-
sponses.
Name
Worm.P2P.Poom.A
Trojan.VB-100
Worm.Alcan.D
RAR
Trojan.Downloader.Istbar-176
Worm.SomeFool.P
DOS.HLLC.Slam.6000
Worm.SomeFool.Gen-1
Trojan.Downloader.Istbar-172
Trojan.Downloader.Delf-286
Files Responses
4512
101
512
168
395
71
71