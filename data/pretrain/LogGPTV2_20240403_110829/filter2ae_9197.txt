# 通过GitHub应用程序权限提升至组织所有者并获得10,000美元奖励
##### 翻译声明
本文为翻译文章，原文来源：medium.com
原文链接：[请在此处提供原文链接]
译文仅供参考，具体表达及含义以原文为准。
虽然我以前从未参与过GitHub的长期赏金计划，但HackTheWorld终身免费私人仓库促销活动引起了我的兴趣。我将介绍一个简单却具有重大影响的权限升级漏洞，这个漏洞是在探索过程中发现的。

## 背景
让我们先了解一下GitHub组织中的基本用户角色：
- **外部协作者**：不属于组织成员，仅被授予对特定仓库的访问权限。
- **成员**：在组织内权限最低的角色，根据组织设置可能只能查看或拥有部分仓库的“写入”权限。成员可获得的最高权限级别是仓库管理员，这允许他们更改该仓库的大多数配置设置。
- **所有者**：在组织内部具有最高权限，相当于超级管理员。所有者能够查看和编辑所有组织数据和仓库；更重要的是，他们有权不可逆转地删除整个组织及其代码。

通常认为，当适当的访问控制措施到位时（如不给每个仓库管理员完全访问权限），成员不会构成威胁。常见的做法是将成员归类到不同的团队中，并使用这些团队来管理跨仓库的访问控制。这样一来，只有少数用户会被指定为组织所有者，因为基于团队的控制已经足够满足大多数扩展访问需求。

## 漏洞挖掘过程
当我作为组织所有者进行设置时，注意到有一个“第三方访问策略”的选项。此设置旨在防止组织成员通过OAuth向不受信任的第三方授予仓库访问权限。一旦启用，成员必须通过OAuth权限提示请求访问，并由组织所有者批准后才能访问任何组织数据。

随后，我开始考虑另一种类型的应用程序——集成应用。这类应用类似于OAuth应用，但代表的是组织而不是单个用户。我想知道，“第三方访问策略”是否也适用于集成应用？于是，我尝试安装了几个应用市场上的集成应用。

很明显，作为组织成员，我没有权限请求安装GitHub应用。只能将集成安装到自己的账户或自己拥有的组织中。我在官方文档中找到了以下解释：
- 组织成员不能请求安装GitHub应用。

在安装过程中，我发现选择“结算账户”后会弹出一个页面，其URL包含`target_id`参数，表示organization_id或要安装应用的account_id。于是，我尝试将`target_id`更改为另一个组织的ID。由于我的成员账户是仓库管理员，系统允许我继续安装流程。最终，我成功地安装了该应用，但仅限于我有管理员权限的一个仓库。

此时已是凌晨3点，我知道自己找到了一个重要的问题。我决定向GitHub安全团队报告这个问题，并在报告中留下后续发现的所有细节。

## 进一步探索
第二天，我创建了自己的GitHub集成应用，并注意到请求的权限可能非常敏感，特别是允许“写入”所有组织成员和团队的权限。理论上讲，即使只在一个仓库中有管理员权限也不应允许我授予对所有组织成员的“写入”访问权限。然而，实际情况并非如此。

由于设计上假定只有所有者才能安装集成应用，因此没有强制执行具体的权限范围。接下来，我测试了API是否按预期工作，并且确认我可以使用它而不会遇到权限错误。利用`role`参数添加或更新组织成员资格，我成功邀请其他用户作为账户所有者加入组织。

## 结论
我认为这个漏洞的价值在于它只能被仓库管理员利用。你的组织中有多少仓库管理员呢？经过进一步测试，我发现允许成员创建仓库的所有组织都存在风险。这是因为成员会自动为其创建的任何仓库获得管理权限，从而可以通过创建虚拟仓库来安装应用的方式加以利用。此功能默认处于开启状态，且许多组织为了适应GitHub基于用户数量而非仓库数量的计费模式而启用了这一功能。

利用这个漏洞不仅限于恶意内部人员，攻击者也可以通过危害成员账户来实施攻击。假设一个组织中有300名成员，那么攻击面不再局限于3或4位组织所有者，而是所有成员。

与往常一样，与GitHub安全团队的合作十分愉快！

## 时间线
- 初始报告：2017年11月11日凌晨3:30
- 报告升级为组织所有者的能力：2017年11月11日晚8:30
- GitHub团队正式调查此问题：2017年11月13日早上5:30
- 发放10,000美元奖励和分类奖励：2017年11月14日下午1:40
- 修正部署到生产环境：2017年11月15日
- 问题标记为已解决：2017年12月1日

审核人：yiwang 编辑：边边