User: 请解答这个和日志有关的问题How do I get the right AppArmor profile for mysql on Ubuntu? I think I have an old profile (copied below).

I don't know where to look to find the correct profile.

Is there an authoritative source for standard apparmor profiles - or would this be somewhere in mysql source?

Is there a standard way to update profiles or do I have to manually figure out what it should be?

e.g.

sudo apparmor get-updated-profile-for mysql


MySQL 5.7/Ubuntu 16.04

Currently:

/etc/apparmor.d$ cat usr.sbin.mysqld 
# vim:syntax=apparmor
# Last Modified: Tue Jun 19 17:37:30 2007
#include &lt;tunables/global&gt;

/usr/sbin/mysqld {
#include &lt;abstractions/base&gt;
#include &lt;abstractions/nameservice&gt;
#include &lt;abstractions/user-tmp&gt;
#include &lt;abstractions/mysql&gt;
#include &lt;abstractions/winbind&gt;

capability dac_override,
capability sys_resource,
capability setgid,
capability setuid,

network tcp,

/etc/hosts.allow r,
/etc/hosts.deny r,
/etc/mysql/*.pem r,
/etc/mysql/conf.d/ r,
/etc/mysql/conf.d/* r,
/etc/mysql/*.cnf r,
/usr/lib/mysql/plugin/ r,
/usr/lib/mysql/plugin/*.so* mr,
/usr/sbin/mysqld mr,
/usr/share/mysql/** r,
/var/log/mysql.log rw,
/var/log/mysql.err rw,
/var/lib/mysql/ r,
/var/lib/mysql/** rwk,
/var/log/mysql/ r,
/var/log/mysql/* rw,
/var/run/mysqld/mysqld.pid rw,
/var/run/mysqld/mysqld.sock w,
/var/run/mysqld/mysqld.sock.lock rw,
/run/mysqld/mysqld.pid rw,
/run/mysqld/mysqld.sock w,
/run/mysqld/mysqld.sock.lock rw,
/sys/devices/system/cpu/ r,

# Site-specific additions and overrides. See local/README for details.
#include &lt;local/usr.sbin.mysqld&gt;
}

Assistant: ok - so firing up a clean ubuntu server and installing mysql seems to be a reasonable way to get the 'right' profile. It is currently the following:

# vim:syntax=apparmor
# Last Modified: Tue Feb 09 15:28:30 2016
#include &lt;tunables/global&gt;

/usr/sbin/mysqld {
  #include &lt;abstractions/base&gt;
  #include &lt;abstractions/nameservice&gt;
  #include &lt;abstractions/user-tmp&gt;
  #include &lt;abstractions/mysql&gt;
  #include &lt;abstractions/winbind&gt;

# Allow system resource access
  /sys/devices/system/cpu/ r,
  capability sys_resource,
  capability dac_override,
  capability setuid,
  capability setgid,

# Allow network access
  network tcp,

  /etc/hosts.allow r,
  /etc/hosts.deny r,

# Allow config access
  /etc/mysql/** r,

# Allow pid, socket, socket lock file access
  /var/run/mysqld/mysqld.pid rw,
  /var/run/mysqld/mysqld.sock rw,
  /var/run/mysqld/mysqld.sock.lock rw,
  /run/mysqld/mysqld.pid rw,
  /run/mysqld/mysqld.sock rw,
  /run/mysqld/mysqld.sock.lock rw,

# Allow execution of server binary
  /usr/sbin/mysqld mr,
  /usr/sbin/mysqld-debug mr,

# Allow plugin access
  /usr/lib/mysql/plugin/ r,
  /usr/lib/mysql/plugin/*.so* mr,

# Allow error msg and charset access
  /usr/share/mysql/ r,
  /usr/share/mysql/** r,

# Allow data dir access
  /var/lib/mysql/ r,
  /var/lib/mysql/** rwk,

# Allow data files dir access
  /var/lib/mysql-files/ r,
  /var/lib/mysql-files/** rwk,

# Allow keyring dir access
  /var/lib/mysql-keyring/ r,
  /var/lib/mysql-keyring/** rwk,

# Allow log file access
  /var/log/mysql.err rw,
  /var/log/mysql.log rw,
  /var/log/mysql/ r,
  /var/log/mysql/** rw,

  # Site-specific additions and overrides. See local/README for details.
  #include &lt;local/usr.sbin.mysqld&gt;
}