# 【漏洞预警】CVE-2016-5195 脏牛漏洞：Linux内核本地提权漏洞（更新于2016年10月27日 10:30）

## 译文声明
本文为翻译文章，原文来源：安全客。译文仅供参考，具体内容及含义以原文为准。

## 漏洞概述

**漏洞编号**：CVE-2016-5195  
**漏洞名称**：脏牛（Dirty COW）  
**危害程度**：低权限用户可利用该漏洞在所有版本的Linux系统上实现本地提权。  
**影响范围**：自Linux内核版本2.6.22（2007年发布）起至2016年10月18日修复前的所有版本均受此漏洞影响。  
**额外信息**：360 Vulpecker Team确认，Android 7.0最新10月补丁的安全级别系统也受到此漏洞的影响。

### 为什么叫“脏牛”漏洞？
Linux内核内存子系统在处理写时拷贝（Copy-on-Write, COW）时存在条件竞争漏洞，允许攻击者破坏私有只读内存映射。通过这一漏洞，低权限用户可以获取对其他只读内存映射的写访问权限，进而可能进一步提升其权限。

### 漏洞细节
根据RedHat公司的报告，目前已经在野外发现了针对此漏洞的利用技术，但尚未收到更多具体信息。

#### 关键Commit记录
- **commit 4ceb5db9757aaeadcf8fbbf97d76bd42aa4df0d6**
  - **作者**：Linus Torvalds
  - **日期**：2005年8月1日
  - **内容**：修复了`get_user_pages()`中的写访问竞争条件问题。
- **commit 19be0eaffa3ac7d8eb6784ad9bdbc7d67ed8e619**
  - **作者**：Linus Torvalds
  - **日期**：2016年10月13日
  - **内容**：此次修复增加了对`pte_dirty()`位的检查，解决了之前尝试修复但因某些原因回滚的问题。

### 各发行版的相关信息
- **Red Hat**：
- **Debian**：
- **Ubuntu**：

### 影响范围
从内核版本2.6.22（2007年发布）开始，直到2016年10月18日修复前的所有版本均受此漏洞影响。

### 如何修复漏洞？
- **官方渠道**：Linux团队正在积极修复此漏洞，建议用户通过系统更新到最新版本来解决。
- **手动修复**：开发人员也可以通过以下链接获取最新的代码并重新编译内核进行修复：
  - [Git Commit](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=19be0eaffa3ac7d8eb6784ad9bdbc7d67ed8e619)

### 如何检测攻击行为？
由于利用此漏洞不会在日志中留下异常信息，部分安全社区已部署蜜罐系统。一旦有人尝试利用此漏洞，将触发警报。

### 漏洞发现者
- **Phil Oester**

### 其他相关信息
- 漏洞发现者创建了专门的网站、Twitter账户和GitHub项目，并请设计师制作了Logo。
- 发现者表示，此举旨在增加漏洞的关注度，尽管在此时间点可能不是最佳选择。

### 更新记录
- **2016年10月21日 13:37**：确认Android 7.0最新的10月补丁安全级别的系统也受到影响。
- **2016年10月21日 09:10**：发布了POC代码示例。
- **2016年10月27日 10:30**：提供了多种不同利用方式的POC代码。

### POC代码
[查看完整POC代码](https://github.com/dirtycow/dirtycow.github.io/blob/master/dirtyc0w.c)

### 利用方式总结
1. 修改/etc/passwd文件，使root用户的shell指向恶意脚本。
2. 将用户添加到sudo组，以便下次管理员登录时无需密码即可使用sudo命令。
3. 修改/etc/passwd文件中的uid位，直接将其改为0。
4. 向suid文件注入shellcode，例如常见的`/usr/bin/crontab`或`/usr/bin/passwd`。

### 周边产品
据说，与脏牛漏洞相关的T恤售价高达2000多美元，这确实让人感到意外。