DNS Query –> www.foo.co.uk
DNS Query –> www.co.uk
Misunderstood End-Point Behavior
DNS Devolution
XP Behavior
Connection Specific Domain – ad.foo.co.uk
DNS Query –> www.ad.foo.co.uk
DNS Query –> www.foo.co.uk
DNS Query –> www.co.uk
Misunderstood End-Point Behavior
DNS Devolution
XP Behavior
Connection Specific Domain – phx.ad.foo.com
DNS Query –> www.phx.ad.foo.com
DNS Query –> www.ad.foo.com
DNS Query –> www.foo.com
Misunderstood End-Point Behavior
Misunderstood End-Point Behavior
Misunderstood End-Point Behavior
DNS Devolution
XP Behavior
Connection Specific Domain – phx.ad.foo.com
DNS Query –> www.phx.ad.foo.com
DNS Query –> www.ad.foo.com
DNS Query –> www.foo.com
DNS Query –> www.com
Misunderstood End-Point Behavior
DNS Devolution
XP Behavior
Connection Specific Domain – phx.ad.foo.com
DNS Query –> www.phx.ad.foo.com
DNS Query –> www.ad.foo.com
DNS Query –> www.foo.com
DNS Query –> www.com
Misunderstood End-Point Behavior
DNS Devolution
XP Behavior
Connection Specific Domain – phx.ad.foo.com
DNS Query –> www.phx.ad.foo.com
DNS Query –> www.ad.foo.com
DNS Query –> www.foo.com
DNS Query –> www.com
Misunderstood End-Point Behavior
DNS Devolution
Windows 7 Behavior
Connection Specific Domain – phx.ad.foo.com
DNS Query –> www.phx.ad.foo.com
DNS Query –> www.ad.foo.com
DNS Query –> www.foo.com
DNS Query –> www.com
Misunderstood End-Point Behavior
Fixed?
Misunderstood End-Point Behavior
BYOD
Mobile
Broken XP
Misunderstood End-Point Behavior
BYOD
Mobile
Broken XP
Misunderstood End-Point Behavior
sipinternal.com
proxy-phoenix.com
set-proxy.com
Misunderstood End-Point Behavior
sipinternal.com
REGISTER sip:com SIP/2.0
Via: SIP/2.0/TCP 199.41.198.254:33663
Max-Forwards: 70
From: ;tag=e72f0d4ce7;epid=895120c8c2
To: 
Call-ID: 53b3ec1c2e0547ab9b72ab97ed17c8b0
CSeq: 1 REGISTER
Contact: ;methods="INVITE, MESSAGE, INFO,
OPTIONS, BYE, CANCEL, NOTIFY, ACK, REFER, BENOTIFY";proxy=replace;+sip.instance=""
User-Agent: UCCAPI/3.5.6907.221 OC/3.5.6907.221 (Microsoft Office Communicator 2007 R2)
Supported: gruu-10, adhoclist, msrtc-event-categories
Supported: ms-forking
ms-keep-alive: UAC;hop-hop=yes
Event: registration
Content-Length: 0
Misunderstood End-Point Behavior
proxy-phoenix.com
Misunderstood End-Point Behavior
set-proxy.com
170.249.6.88 "set-proxy.com" "GET /bin/setup.proxy"
170.249.6.88 "set-proxy.com" "GET /bin/setup.proxy"
170.249.6.88 "set-proxy.com" "GET /bin/setup.proxy"
170.249.6.88 "set-proxy.com" "GET /bin/setup.proxy"
170.249.6.88 "set-proxy.com" "GET /bin/setup.proxy"
170.249.6.88 "set-proxy.com" "GET /bin/setup.proxy"
NetRange:
170.249.0.0 - 170.250.255.255
OrgName:
Arthur Andersen
OrgId:
ARTHUR-15
Misunderstood End-Point Behavior
set-proxy.com
170.252.248.200 "GET /bin/setup.proxy" "mstreamd/1 CFNetwork/548.1.4 Darwin/11.0.0"
170.252.248.200 "GET /bin/setup.proxy" "WordsWithFriendsPaid/4.12.1 CFNetwork/548.1.4 Darwin
170.252.248.200 "GET /bin/setup.proxy" "itunesstored (unknown version) CFNetwork/548.1.4 Darwin
170.252.248.200 "GET /bin/setup.proxy" "Mail/53 CFNetwork/548.1.4 Darwin/11.0.0"
170.252.248.200 "GET /bin/setup.proxy" "GeoServices/84 CFNetwork/548.1.4 Darwin/11.0.0"
170.252.248.200 "GET /bin/setup.proxy" "Maps/1.0 CFNetwork/548.1.4 Darwin/11.0.0"
170.252.248.200 "GET /bin/setup.proxy" "itunesstored (unknown version) CFNetwork/548.1.4 Darwin
170.252.248.200 "GET /bin/setup.proxy" "dataaccessd (unknown version) CFNetwork/548.1.4 Darwin
170.252.248.200 "GET /bin/setup.proxy" "mstreamd/1 CFNetwork/548.1.4 Darwin/11.0.0"
170.252.248.200 "GET /bin/setup.proxy" "itunesstored (unknown version) CFNetwork/548.1.4 Darwin
NetRange:
170.251.0.0 - 170.252.255.255
OrgName:
Accenture
OrgId:
ACCENT-10
Misunderstood End-Point Behavior
set-proxy.com
Misunderstood End-Point Behavior
set-proxy.com
Misunderstood End-Point Behavior
Don’t trust expectations based
upon on how things used to
work, monitor and understand
what normal DNS traffic looks
like on your network.
You don’t own that domain
I do  >:)
You don’t own that domain
I do  >:)
You don’t own that domain
“HKLM\System\CurrentControlSet\Services\TCPIP\Param
eters\SearchList”
Or
“Windows IP Configuration” + “DNS Suffix Search List”
You don’t own that domain
Windows IP Configuration
Host Name . . . . . . . . . . . . :
AN990107196
Primary Dns Suffix . . . . . . . : quanta.corp
Node Type . . . . . . . . . . . . :
Hybrid
IP Routing Enabled. . . . . . . . : No
WINS Proxy Enabled. . . . . . . . : No
DNS Suffix Search List. . . . . . : quanta.corp
rsquanta.com
quantacn.com
You don’t own that domain
Windows IP Configuration
Host Name . . . . . . . . . . . . :
AN990107196
Primary Dns Suffix . . . . . . . : quanta.corp
Node Type . . . . . . . . . . . . :
Hybrid
IP Routing Enabled. . . . . . . . : No
WINS Proxy Enabled. . . . . . . . : No
DNS Suffix Search List. . . . . . : quanta.corp
rsquanta.com
quantacn.com
You don’t own that domain
Windows IP Configuration
Host Name . . . . . . . . . . . . : AN990107196
“Quanta Computer”
60,000 employees worldwide
manufactures hardware for
You don’t own that domain
mailbx01.rsquanta.com
mailbx02.rsquanta.com
mailbx03.rsquanta.com
mailhub04.rsquanta.com
mailhub05.rsquanta.com
FTP-CHT.rsquanta.com
ftp.rsquanta.com
nb1ftp.rsquanta.com
nb5-ftp.rsquanta.com
f1ftp02.rsquanta.com
ftp01.rsquanta.com
myproxy.rsquanta.com
proxycn.rsquanta.com
proxy.rsquanta.com
wpad.rsquanta.com
wsus01.rsquanta.com
wsus-cq.rsquanta.com
wsus-sh1.rsquanta.com
SMS_SLP.rsquanta.com
You don’t own that domain
173.37.87.155: view external-in: query: proxy.rsquanta.com
171.70.168.155: view external-in: query: QRDCOFC05.rsquanta.com
171.70.168.167: view external-in: query: wpad.rsquanta.com
17.254.0.23: view external-in: query: wpad.rsquanta.com
17.254.0.23: view external-in: query: wsus01.rsquanta.com
17.254.0.23: view external-in: query: proxy.rsquanta.com
136.229.2.57: view external-in: query: proxy.rsquanta.com
136.229.2.56: view external-in: query: qrdcprt02.rsquanta.com
136.229.2.57: view external-in: query: QRDCOFC03.quanta.corp.rsquant
143.166.82.252: view external-in: query: wpad.rsquanta.com
143.166.224.3: view external-in: query: SMS_SLP.rsquanta.com
143.166.224.11: view external-in: query: proxy.rsquanta.com
You don’t own that domain
You don’t own that domain
Best Dry Cleaners
99.59.76.38:  query: wpad.rsquanta.com
San Francisco International Airport 216.9.98.80: query: wpad.rsquanta.com
Venetian Resort Hotel Casino
64.79.144.10: query: wpad.rsquanta.com
MGM Mirage
69.162.4.53: query: wpad.rsquanta.com
You don’t own that domain
 Please verify your configurations
 Monitor the internet for details of your internal
configuration
• Pastebin
• Bleeping Computer
 Monitor your DNS logs to verify your clients and the
clients of your onsite partners and vendors are
querying what you expect
Abandoned Botnets
and
Forgotten Toys
Abandoned Botnets and Forgotten Toys
 Expired Command and Control Domains
 Botnet remnants
 Abandoned Botnets
 Detection
Abandoned Botnets and Forgotten Toys
microsoft-windows-security.com
Win32:EyeStye
268 remaining infections
Uses form grabbing to steal credentials
Abandoned Botnets and Forgotten Toys
--55372666816118
Content-Disposition: form-data; name="data"
bot_guid=138BFC5C-8C31-4415-92D0B382B5550E0D
process_name=iexplore.exe
hooked_func=HttpSendRequestW
func_data=POST /login.php?login_attempt=1 HTTP/1.1
lsd=AVoCccq2&email=steve*******@yahoo.com&pass=*******&defa
ult_persistent=0&timezone=240&lgnrnd=183641_PjES&lgnjs=13637435
23&locale=en_US
--55372666816118--
Abandoned Botnets and Forgotten Toys
Remaining Infections
simrako.com
14162 infected
ms-stats.info
2979 infected
myrestricted.info
2203 infected
zapalinfo.info
2111 infected
ntpupdatedomain.com 1571 infected
rapeisntfunny.info
844 infected
Abandoned Botnets and Forgotten Toys
b.354782.InfO
"POST /b/i.asp HTTP/1.1”
Content-Disposition: form-data; name="InSfo”
txtUserId::Gupta
txtPassword::*******
Content-Disposition: form-data; name="BasicSInfo”
192.168.50.26|192.168.50.26|8.0000|00-1C-C0-EB-E9-34|BC01-0920
Abandoned Botnets and Forgotten Toys
ET_product::SSIM
ET_component::BACKEND
ET_version::4.8
ET_target_version::4.8
ET_assigned_to::gaurav_pratap
ET_type::DEFECT
ET_state::CLOSED
ET_reporter::gaurav_pratap
ET_severity::2
ET_priority::2
ET_resolution::SOURCE_CHANGE
ET_user_defined_list::FILES
ET_user_defined_list2::SECURITY
ET_build::153
ET_target_build::184
Site::engtools.engba.symantec.com
Mac::00-24-E8-4A-ED-A3
Ver::BC01-0920
Abandoned Botnets and Forgotten Toys
NXDOMAIN Hijacking
Abandoned Botnets and Forgotten Toys
NXDOMAIN Hijacking
Abandoned Botnets and Forgotten Toys
NXDOMAIN Hijacking
Abandoned Botnets and Forgotten Toys
NXDOMAIN Hijacking
Abandoned Botnets and Forgotten Toys
Detection
 Collect your DNS logs into a database
 Regularly extract names being queried for the
first time in your environment
 Look for names only being queried by a single
client
 Look up the registration dates and owners
 Look for anything resolving to 127.0.0.1
Abandoned Botnets and Forgotten Toys
Resources
 Bro – http://www.bro.org
 DNS Anomaly Detection -
http://code.google.com/p/security-
onion/wiki/DNSAnomalyDetection
 Passive DNS - https://github.com/gamelinux/passivedns
 Response Policy Zones (RPZ)
 DNS Sinkholes -
http://handlers.sans.edu/gbruneau/sinkhole.htm
Abandoned Botnets and Forgotten Toys
White Papers
 Passive Monitoring of DNS Anomalies
http://www.caida.org/publications/papers/2007/dns_anomalies/dns_anomalies.pdf
 Detecting Malware Domains at the Upper DNS Hierarchy
https://www.usenix.org/legacy/event/sec11/tech/full_papers/Antonakakis.pdf
 Mining DNS for Malicious Domain Registration
http://www.mcafee.com/us/resources/white-papers/wp-mining-dns-for-malicious-domain-
regist.pdf
 Preprocessing DNS Log Data for Effective Data Mining
http://www.ccs.neu.edu/home/koods/papers/snyder09preprocessing.pdf
 Detecting Botnet Activities Based on Abnormal DNS Traffic
http://arxiv.org/pdf/0911.0487v1.pdf
Questions?
PI:EMAIL
Please contact me with any questions,
comments, or opportunities  :)
Thank You!