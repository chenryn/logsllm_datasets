A protocol specialist might suggest that randomness must
Authorized licensed use limited to: IEEE Xplore. Downloaded on March 18,2021 at 11:56:33 UTC from IEEE Xplore.  Restrictions apply. 
be generated by the party that relies on it; so the terminal
should request a nonce from the issuing bank before com-
mencing the transaction. A weaker but cheaper option might
be for the terminal to authenticate the message conveying
the nonce to the card issuing bank. This would however
cost a lot of latency and processing, as noted above; even
authentication is commonly optimised away in payment
messages, let alone extra message round-trips.
The only practical short-term alternative may be for
arbitrators to shift the burden of proof, in the event of a
transaction dispute, to the acquiring bank which should be
called on to demonstrate that the unpredictable number was
properly generated. The terminal equipment might support
audit in various ways, such as by using a generator which
encrypted an underlying sequence that is revealed after the
fact, and locked to the transaction log to establish time limits
on possible pre-play tampering. However, this would not be
entirely trivial; secure storage of audit data in the terminal
is a new problem and creates new opportunities for attack.
VIII. DISCUSSION
The potential vulnerability of EMV to a poor random
number generator was discussed in the abstract by Mur-
doch [22]. Markettos and Moore [23] additionally explored
how otherwise secure true random number generators could
be manipulated to produce more deterministic output. But
this paper is the ﬁrst work to show that poor random number
generators exist in the wild, that they have been implicated
in fraud, how they can be exploited, and that the EMV
speciﬁcation does not test adequately for this problem.
The random-number exploit scenario described in this
paper might be viewed as a variant of the relay attack,
which was explored in the context of EMV by Drimer and
Murdoch [21]. But there, the relay attack required real-
time bi-directional communication with the genuine card; the
genuine card had to be under the control of the attacker while
the attack was taking place. This makes it hard to deploy; the
best attack we can think of is to have a false terminal such as
a parking meter to attract cardholders, communicating with a
crook who waits with the connected false card near an ATM.
We do not know of this being deployed in practice (though
we’ve heard rumours). Another variant of the relay attack is
the no-PIN attack where a man-in-the-middle device tricks
the terminal into accepting a transaction after the wrong PIN
was entered; that also works in real time. That has been
deployed, and crooks have been prosecuted for it; but so far
the losses appear to of the order of a million Euros, and
from one or two incidents.
The random-number pre-play attack could also be seen as
a kind of card cloning. We have already seen fake magnetic
strip cards based on either the magnetic strip of the genuine
card, or the copy of the magnetic strip data stored on the
chip of some EMV cards. Another approach is the “YES-
card” where the static data from a chip is copied to a cloned
chip card. If the transaction can be kept ofﬂine (e.g. by
keeping it below the “ﬂoor limit”), the fact that such a card
cannot produce a valid ARQC or TC will not prevent the
transaction, but as the YES-card is responsible for verifying
the PIN, it can be programmed to accept any PIN. The pre-
play attack is more powerful in some respects as it works
for online transactions, and less in others as the transaction
parameters must be known in advance. Crucially, the pre-
play attack will work in ATMs while a YES-card won’t (a
typical YES-card attack involves buying cigarettes for resale,
which is less convenient than stealing cash directly).
One might
imagine that much more fraud could be
committed with a fully cloned card containing a copy of
the ARQC-generation keys than with a card containing pre-
play data. However even a full clone will have its own ATC
which will diverge from that of the real card and in due
course be detectable. So a full cloning attack might be not
that much more powerful in practice than a pre-play attack.
The protocol pre-play attack could come in a number
of guises. In the version described here, and (we believe)
observed in the wild, a single terminal is compromised and
used to duplicate transactions. There are clearly variants
in which the terminals where the data are harvested are
quite remote from the terminals used for cash-out. If a gang
succeeds in compromising a number of terminals (which
was done in the UK physically by three separate gangs in
the mid-2000s) or in compromising the communications to
a number of high-value stores (which was done to jewelry
stores in Hatton Garden in the 1980s) the cards can have
ARQCs harvested in one location and presented in another.
Perhaps the main takeaway message is that an attacker
who can subvert a merchant’s premises, get access to his
terminal equipment (even before it is purchased), or get con-
trol of his network connection, can do transactions that are
indistinguishable from card cloning to the bank that issued
the EMV card – even if full card cloning is impossible.
The EMV attack surface is bigger than one might think,
especially once crooks learn how to manipulate the protocol.
A. Evidential issues in dispute
Viability of the pre-play attack has signiﬁcant legal ram-
iﬁcations. It can no longer be taken for granted that data in
a logged transaction was harvested at the time and place
claimed, which undermines the reliability of evidence in
both civil and criminal cases. To show that a given trans-
action was made by a particular card, it is now necessary
to show that the random number generator on the ATM or
POS was sound.
From the point of view of an issuing bank in dispute with
a customer, this attack greatly complicates matters. The bank
cannot just rely on its own log data – it must collect data
from a third party (the ATM operator) to prove that the ATM
was not infected with malware; that the random number
generator was not vulnerable due to either design failure or
62
Authorized licensed use limited to: IEEE Xplore. Downloaded on March 18,2021 at 11:56:33 UTC from IEEE Xplore.  Restrictions apply. 
a supply chain attack; and that the logs at the acquirer match
those kept at the terminal itself. A mere one-off certiﬁcation
for a class of EMV kernel does not come close to discharging
this burden. There may be practical matters in incentivising
the acquiring bank to cooperate with the issuer, especially
in international cases.
Under existing Visa guidelines, logs should be retained in
case of dispute. Yet in recent cases we have dealt with, logs
were routinely destroyed after 90 or 180 days regardless of
whether a dispute was in progress. So the industry already
cannot cope with dispute resolution based on issuer logs; and
given that some of the disputes we’re already seeing would
require scrutiny of acquirer and ATM operator systems,
dispute resolution can only get harder. The only feasible
way forward is by getting the liability right. Banks which
destroy evidence should become automatically liable for
the full sums in dispute, including costs. Above all, the
burden of proof must lie on the banks, not the customer.
The Payment Services Directive already requires this, yet
dispute resolution bodies like the UK Financial Ombudsman
Service routinely ignore the law and ﬁnd for banks who
destroy evidence. We discuss the issues of evidence further
in [22], [19].
B. Industry Response
We disclosed these ﬂaws to the major card schemes and to
selected banks and payment switches in early 2012, initially
with an emphasis on the random-number variant as we did
not realise how powerful the protocol variant could be. All
parties acknowledged receipt and several contacted us to ask
further questions. The card schemes chose initially not to
circulate the work, but after several weeks a different contact
did decide to circulate our report and our vulnerability
disclosure report received several thousand downloads. The
vast majority of contacts refused to talk to us on-the-
record, but in April 2012 EMVCo published a speciﬁcation
update [24] which partially tackled the random number gen-
erator problem. The bulletin required that the unpredictable
number ﬁeld should be “truly unpredictable even given
access to all previous numbers, and it should be infeasible
for an attacker to control the next Unpredictable Number that
the terminal generates.”. EMVCo also gave notice that the
testing and approval procedures for terminal random number
generators would be strengthened. Yet almost two years
after our disclosure of the protocol ﬂaw, nothing appears to
have been done. The world’s ﬂeet of EMV terminals remain
vulnerable to attacks involving either terminal malware or
man-in-the-middle manipulation of communications. This is
particularly shocking given that industry insiders told us that
Mr Gambin’s case probably involved ATM malware.
Beyond the direct impact of inﬂuencing a speciﬁcation
change, we received some informal responses: the extent
and size of the problem was a surprise to some, whereas
others reported already being suspicious of the strength
of unpredictable numbers, or even said others had been
explicitly aware of the problem for a number of years. If
these assertions are true, it is further evidence that banks
systematically suppress information about known vulnera-
bilities, resulting in fraud victims being denied refunds.
IX. CONCLUSIONS
EMV is the main protocol used worldwide for card
payments, being near universal in Europe, in the process of
adoption in Asia, and in its early stages in North America. It
has been deployed for ten years and over a billion cards are
in issue. Yet it is only now starting to come under proper
scrutiny from academics, media and industry alike. Again
and again, customers have complained of fraud and been told
by the banks that as EMV is secure, they must be mistaken or
lying when they dispute card transactions. Again and again,
the banks have turned out to be wrong. One vulnerability
after another has been discovered and exploited by crim-
inals, and it has mostly been left to independent security
researchers to ﬁnd out what’s happening and publicise it.
In this paper, we report the shocking fact that many ATMs
and point-of-sale terminals have seriously defective random
number generators. These are often just counters, and in
fact the EMV speciﬁcation encourages this by requiring only
that four successive values of a terminal’s “unpredictable
number” have to be different for it to pass testing. The result
is that a crook with transient access to a payment card (such
as the programmer of a terminal in a Maﬁa-owned shop) can
harvest authentication codes which enable a “clone” of the
card to be used in ATMs and elsewhere.
We now also disclose that the pre-play attack is not limited
to terminals with defective random number generators. Be-
cause of the lack of end-to-end transaction authentication, it
is possible to modify a transaction made with a precomputed
authentication code, en route from the terminal to the acquir-
ing bank, to edit the “unpredictable number” to the value that
was used in the pre-computation. This means that as well as
inserting a man-in-the-middle devices between the payment
card and the terminal, an attacker could insert one between
the terminal and the acquirer. It also means that malware
in the terminal can attack the EMV protocol even if the
protocol itself is implemented in a tamper-resistant module
that the malware cannot penetrate. The banks appear to have
ignored this, perhaps reasoning that it is difﬁcult to scale
up an attack that involves access to speciﬁc physical cards
and also the installation of malware or wiretaps on speciﬁc
terminals. We disagree. The Target compromise shows that
criminals can deploy malware on merchant terminals widely
and exploit it to earn serious money. The move to terminals
based on mobile phones may expose this ﬂaw to industrial
scale exploitation by malware that can be spread through the
mobile phone population much more easily than through the
terminal ﬂeet. The recent announcement that card payments
via phones need no longer rely on cryptography in the SIM
63
Authorized licensed use limited to: IEEE Xplore. Downloaded on March 18,2021 at 11:56:33 UTC from IEEE Xplore.  Restrictions apply. 
card, or in a secure element or TEE, opens the door wide
to malware there too.
This ﬂaw challenges current thinking about authentication.
Existing models of veriﬁcation don’t easily apply to a
complex multi-stakeholder environment; indeed, EMV has
already been veriﬁed to be secure. We explained why such
veriﬁcations don’t work and discussed the sort of analysis
that is required instead. Ultimately we feel that the tools
needed to build robust systems for millions of mutually mis-
trustful and occasionally hostile parties will involve game-
theoretic analysis as well as protocol-theoretic modelling. In
addition, mechanisms for rolling out ﬁxes across networks
with huge installed bases of cards and terminals, and strong
externalities, will have to be much better than those we
have at present, with incentives that put the pain where it’s
deserved and technical mechanisms that offer the prospect
of remedial action to the sufferers.
In the meantime, there is a structural governance failure
that gives rise to systemic risk. Just as the world’s bank
regulators were gullible in the years up to 2008 in accepting
the banking industry’s assurances about its credit risk man-
agement, so also have regulators been credulous in accepting
industry assurances about operational risk management. In
a multi-party world where not even the largest card-issuing
bank or acquirer or scheme operator has the power to ﬁx a
problem unilaterally, we cannot continue to rely on a slow
and complex negotiation process between merchants, banks
and vendors. It is time for bank regulators to take an interest.
It is welcome that the US Federal Reserve is now paying
attention, and time for European regulators to follow suit.
Acknowledgments
The authors thank Dan Bernstein for the photo in Fig-
ure 5(b). Steven J. Murdoch is funded by the Royal Society.
Omar Choudary is a recipient of the Google Europe Fellow-
ship in mobile security and this research is supported in part
by that fellowship. The opinions expressed in this paper do
not represent the views of Google.
REFERENCES
[1] Financial Fraud Action UK, “Scams and computer attacks
contribute to increase in fraud, as total card spending rises,”
Press Release, March 2014.
[2] S. Drimer, S. J. Murdoch, and R. Anderson, “Thinking inside
the box: system-level failures of tamper prooﬁng,” in IEEE
Symposium on Security and Privacy (Oakland), May 2008,
pp. 281–295.
[3] S. J. Murdoch, S. Drimer, R. Anderson, and M. Bond, “Chip
and PIN is broken,” in IEEE Symposium on Security and
Privacy (Oakland), May 2010.
[4] S. Sellami, “L’imparable escroquerie `a la carte bancaire,”
Le Parisien, 24 January 2012, http://www.leparisien.fr/faits-
divers/l-imparable-escroquerie-a-la-carte-bancaire-24-01-
2012-1826971.php.
64
[5] A. Kelman, “Job v Halifax PLC (not reported) case number
7BQ00307,” in Digital Evidence and Electronic Signature
Law Review, S. Mason, Ed., vol. 6, 2009.
[6] D. Moon,
J.
Flatley,
“Acquisitive
and
card
R. Murphy,
crime
fraud:
survey,” Home Ofﬁce, Statistical Bulletin, April 2010,
http://webarchive.nationalarchives.gov.uk/20110218135832/
http://rds.homeofﬁce.gov.uk/rds/pdfs10/hosb0810.pdf.
J. Hoare, B. Green,
plastic
2008/09 British
from the
Findings
crime
and
[7] R. Anderson and R. Needham, “Programming Satan’s com-
puter,” in Springer Lecture Notes in Computer Science vol
1000, 1995, pp. 426–441.
[8] Visa Integrated Circuit Card – Card Speciﬁcation, Visa Inter-
national, October 2001, version 1.4.0.
[9] EMVCo, LLC, “Terminal level 2, test cases,” Type Approval,
November 2011, version 4.3a.
[10] EMV 4.2, EMVCo, LLC, June 2004, http://www.emvco.com/.
[11] O. Choudary, “The smart card detective: a hand-held EMV
interceptor,” University of Cambridge, Computer Laboratory,
Tech. Rep. UCAM-CL-TR-827, December 2012.
[12] B. Jack, “Jackpotting automated teller machines redux,” Pre-
sentation at Black Hat USA, July 2010, http://blackhat.com/
html/bh-us-10/bh-us-10-archives.html#Jack.
[13] EMV.LIB Integration Guide, CreditCall, 2009, http://www.
level2kernel.com/emvlib documentation.html.
[14] ATM Malware,
SC Magazine,
October
2013,
http://www.pcworld.com/article/2058360/atm-malware-
may-spread-from-mexico-to-englishspeaking-world.html.
[15] J. de Ruiter and E. Poll, “Formal analysis of the EMV pro-
tocol suite,” in Theory of Security and Applications (TOSCA
2011), ser. LNCS, S. Moedersheim and C. Palamidessi, Eds.,
vol. 6693. Springer, March 2011, pp. 113–129.
[16] M. Burrows, M. Abadi, and R. Needham, “A logic of authen-
tication,” ACM Transactions on Computer Systems, vol. 8, pp.
18–36, 1990.
[17] R. Anderson, Security Engineering – A Guide to Building
Dependable Distributed Systems. Wiley, 2003.
[18] R. M. Needham and M. D. Schroeder, “Using encryption
for authentication in large networks of computers,” Commun.
ACM, vol. 21, pp. 993–999, Dec. 1978.
[19] S. J. Murdoch and R. Anderson, “Security protocols and
evidence: where many payment systems fail,” in Financial
Cryptography and Data Security, 2014.
[20] Visa International, “Transaction acceptance device guide
(TADG) v 2.1,” 2013.
[21] S. Drimer and S. J. Murdoch, “Keep your enemies close: Dis-
tance bounding against smartcard relay attacks,” in USENIX
Security Symposium, August 2007.
[22] S. J. Murdoch, “Reliability of chip & PIN evidence in banking
disputes,” in Digital Evidence and Electronic Signature Law
Review, vol. 6. Pario Communications, November 2009, pp.
98–115, ISBN 0-9543245-9-5.
[23] A. T. Markettos and S. W. Moore, “Frequency injection attack
on ring-oscillator-based true random number generators,” in
Workshop on Cryptographic Hardware and Embedded Sys-
tems, 2009, pp. 317–331.
[24] EMVCo, LLC, “Speciﬁcation bulletin no. 103, unpredictable
number generation,” Bulletin, April 2012.
Authorized licensed use limited to: IEEE Xplore. Downloaded on March 18,2021 at 11:56:33 UTC from IEEE Xplore.  Restrictions apply.