### 0×01 引言
通常，我们在渗透过程中很有可能只获得了一个系统的Guest或User权限。低的权限级别将会使我们受到很多的限制，所以必须将访问权限从Guset提升到User,再到Administrator,最后到SYSTEM级别。  
渗透的最终目的是获取服务器的最高权限，即Windows操作系统中管理员账号的权限，或LINUX操作系统中root账户权限。  
提升权限的方式分为两类。
> 纵向提权：低权限角色获得高权限角色的权限。比如，一个webshell权限通过提权之后拥有了管理员的权限，那么这种提权就是纵向提权。
>
> 横向提权：获取同级别角色的权限。比如，通过已经攻破的系统A获取了系统B的权限，那么这种提权就属于横向提权。
所以在成功获取目标机meterpreter shell后，我们要知道现在已经拥有了什么权限。
  1. 在meterpreter shell下输入命令shell进入目标机CMD命令行  
[
  2. 输入whoami /groups 命令  
[
可以看到这个表是Mandatory Label\Medium
MandatoryLevel，说明我们是一个标准用户，需要将用户权限从标准用户提升到管理员权限，也就是Mandatory Label\High
MandatoryLevel。  
提权大体有以下几种方法：
> 使用getsystem提升权限  
>  利用本地漏洞  
>  假冒令牌  
>  绕过Windows账户控制（UAC）  
>  HASH
### 0×02 getsystem
利用meterpreter中的getsystem命令，该命令自动寻找各种可能的适应技术，以便将用户权限提升到更高级别。我们输入getsystem –h
来看下它使用的3种技术，如下图。  
[
默认值0会尝试所有列出技术来尝试提权，直至成功。提权方式采用命令管道模拟提升的方法和令牌复制的方法。输入getsystem命令即完成操作。具体效果见下图。  
[  
该命令使用方便，并且简单高效，在渗透测试中会频繁使用到，建议所有提权过程中先行尝试此方法。
### 0×03利用本地漏洞
本地漏洞提权，即使用本地漏洞的利用程序（loca>exploit）提升权限。就是说通过运行一些现成的造成溢出漏洞的exploit,把用户从users组或其它系统用户中提升到administrators组（或root）。  
溢出漏洞就像杯子里装水,水多了杯子装不进去,就会把里面的水溢出来。而相对计算机来说计算机有个地方叫缓存区,程序的缓存区长度是被事先设定好的,如果用户输入的数据超过了这个缓存区的长度,那么这个程序就会溢出了。
  1. 利用getuid命令查看已经获得的权限，可以看到现在的权限很低，是个user权限。尝试利用getsystem提权，失败。见下图：  
[
2.输入命令shell进入目标机CMD命令行，再利用systeminfo命令或者通过查询 c:\windows\
里留下的补丁号.log来看看目标机大概打了哪些补丁。  
[  
可以看到目标机基本上没有打任何补丁，我们可以尝试利用Windows下已有的漏洞提权，如ms13_053,ms14_058,ms16_016,ms16_032等等。
相关漏洞的具体信息分析和共享可以参考下面2个网站：
>
> 安全焦点，其BugTraq是一个出色的漏洞和exploit数据源，可以通过CVE编号，或者产品信息漏洞直接搜索。网址：[http://www.securityfocus.com/bid。](http://www.securityfocus.com/bid%E3%80%82)  
>  Exploit-> DB,取代了老牌安全网站milw0rm。不断更新大量的Exploit程序和报告，它的搜索功能可以搜索整个网站内容。网址：[http://www.exploit-> db.com。](http://www.exploit-db.com./)
*附上收集的部分系统对应补丁号 Win2003 Win2008  
Win2012
KB2360937|MS10-084  
KB2478960|MS11-014  
KB2507938|MS11-056  
KB2566454|MS11-062  
KB2646524|MS12-003  
KB2645640|MS12-009  
KB2641653|MS12-018  
KB944653|MS07-067  
KB952004|MS09-012 PR  
KB971657|MS09-041  
KB2620712|MS11-097  
KB2393802|MS11-011  
KB942831|MS08-005  
KB2503665|MS11-046  
KB2592799|MS11-080  
KB956572|MS09-012烤肉  
KB2621440|MS12-020  
KB977165|MS10-015Ms Viru  
KB3139914|MS16-032  
KB3124280|MS16-016  
KB3134228|MS16-014  
KB3079904|MS15-097  
KB3077657|MS15-077  
KB3045171|MS15-051  
KB3000061|MS14-058  
KB2829361|MS13-046  
KB2850851|MS13-053EPATHOBJ 0day 限32位  
KB2707511|MS12-042 sysret -pid  
KB2124261|KB2271195 MS10-065 IIS7  
KB970483|MS09-020IIS6  
KB3139914|MS16-032  
KB3124280|MS16-016  
KB3134228|MS16-014  
KB3079904|MS15-097  
KB3077657|MS15-077  
KB3045171|MS15-051  
KB3000061|MS14-058  
KB2829361|MS13-046  
KB2850851|MS13-053EPATHOBJ 0day 限32位  
KB2707511|MS12-042 sysret -pid  
KB2124261|KB2271195 MS10-065 IIS7  
KB970483|MS09-020IIS6  
KB3139914|MS16-032  
KB3124280|MS16-016  
KB3134228|MS16-014  
KB3079904|MS15-097  
KB3077657|MS15-077  