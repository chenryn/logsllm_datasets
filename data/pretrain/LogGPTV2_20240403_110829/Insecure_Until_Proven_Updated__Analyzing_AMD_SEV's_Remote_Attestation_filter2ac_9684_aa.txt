title:Insecure Until Proven Updated: Analyzing AMD SEV's Remote Attestation
author:Robert Buhren and
Christian Werling and
Jean-Pierre Seifert
Insecure Until Proven Updated:
Analyzing AMD SEV’s Remote Attestation
Robert Buhren
PI:EMAIL
Technische Universität Berlin
Security in Telecommunications
Christian Werling
PI:EMAIL
Hasso Plattner Institute, Potsdam
Jean-Pierre Seifert
PI:EMAIL
Technische Universität Berlin
Security in Telecommunications
ABSTRACT
Cloud computing is one of the most prominent technologies to
host Internet services that unfortunately leads to an increased
risk of data theft. Customers of cloud services have to trust the
cloud providers, as they control the building blocks that form the
cloud. This includes the hypervisor enabling the sharing of a sin-
gle hardware platform among multiple tenants. Executing in a
higher-privileged CPU mode, the hypervisor has direct access to
the memory of virtual machines. While data at rest can be pro-
tected using well-known disk encryption methods, data residing in
main memory is still threatened by a potentially malicious cloud
provider.
AMD Secure Encrypted Virtualization (SEV) claims a new level
of protection in such cloud scenarios. AMD SEV encrypts the main
memory of virtual machines with VM-specific keys, thereby deny-
ing the higher-privileged hypervisor access to a guest’s memory.
To enable the cloud customer to verify the correct deployment of
his virtual machine, SEV additionally introduces a remote attes-
tation protocol. This protocol is a crucial component of the SEV
technology that can prove that SEV protection is in place and that
the virtual machine was not subject to manipulation.
This paper analyzes the firmware components that implement
the SEV remote attestation protocol on the current AMD Epyc
Naples CPU series. We demonstrate that it is possible to extract
critical CPU-specific keys that are fundamental for the security of
the remote attestation protocol.
Building on the extracted keys, we propose attacks that allow
a malicious cloud provider a complete circumvention of the SEV
protection mechanisms. Although the underlying firmware issues
were already fixed by AMD, we show that the current series of
AMD Epyc CPUs, i.e., the Naples series, does not prevent the in-
stallation of previous firmware versions. We show that the severity
of our proposed attacks is very high as no purely software-based
mitigations are possible. This effectively renders the SEV technol-
ogy on current AMD Epyc CPUs useless when confronted with an
untrusted cloud provider.
To overcome these issues, we also propose robust changes to the
SEV design that allow future generations of the SEV technology to
mitigate the proposed attacks.
CCS CONCEPTS
• Security and privacy → Virtualization and security.
KEYWORDS
virtualization, Secure Encrypted Virtualization, cloud computing,
shielding systems, SEV, remote attestation
ACM Reference Format:
Robert Buhren, Christian Werling, and Jean-Pierre Seifert. 2019. Insecure
Until Proven Updated: Analyzing AMD SEV’s Remote Attestation. In 2019
ACM SIGSAC Conference on Computer and Communications Security (CCS’19),
November 11–15, 2019, London, United Kingdom. ACM, New York, NY, USA,
13 pages. https://doi.org/10.1145/3319535.3354216
1 INTRODUCTION
Cloud computing is one of the core foundations of today’s Internet
landscape. The manifold advantages such as on-demand resource
allocation or high availability of services have lead to a wide usage
of this technology. However, outsourcing the processing of enter-
prise data comes at a risk. The technical infrastructure that forms
the cloud is owned by the cloud provider and thus under his full
control. This includes the server hardware, as well as the software
components that allow the co-location of multiple virtual machines
on a single host.
Therefore security concerns impede the deployment of confiden-
tial data and applications in cloud scenarios [14, 19]. The potential
threats range from misconfiguration of software components over
cloud provider admin access to foreign government access [8].
To counter these threats, the research community, as well as in-
dustry, proposed new approaches to allow secure cloud computing
when confronted with an untrusted cloud provider [18, 23, 29, 33,
34, 36]. Most prominent is the recently released Secure Encrypted
Virtualization technology by AMD [6]. SEV’s goals are twofold:
Permission to make digital or hard copies of all or part of this work for personal or
classroom use is granted without fee provided that copies are not made or distributed
for profit or commercial advantage and that copies bear this notice and the full citation
on the first page. Copyrights for components of this work owned by others than ACM
must be honored. Abstracting with credit is permitted. To copy otherwise, or republish,
to post on servers or to redistribute to lists, requires prior specific permission and/or a
fee. Request permissions from permissions@acm.org.
CCS ’19, November 11–15, 2019, London, United Kingdom
© 2019 Association for Computing Machinery.
ACM ISBN 978-1-4503-6747-9/19/11...$15.00
https://doi.org/10.1145/3319535.3354216
(a) Prove the correct deployment of virtual machines.
(b) Offer virtual machine protection at runtime.
To achieve (a), a dedicated co-processor, the Platform Security
Processor (PSP), creates a cryptographic hash of the components
that form the initial virtual machine state, similar to the remote
attestation feature of a TPM.
“With this attestation, a guest owner can ensure that
the hypervisor did not interfere with the initialization
of SEV before transmitting confidential information
to the guest.” [6]
Session 5C: Cloud Security IICCS ’19, November 11–15, 2019, London, United Kingdom1087(b) is achieved by using memory encryption with virtual machine-
specific encryption keys. These keys are generated upon creation
of a virtual machine and are stored inside the PSP that uses its
own private memory. This memory is not accessible from the main
processor, which is executing software components controlled by
the cloud provider such as the hypervisor. A hardware memory
encryption unit provides transparent encryption and decryption
using the virtual machine-specific key when the respective virtual
machine is scheduled.
“Even though the hypervisor level is traditionally
’more privileged’ than the guest level, SEV separates
these levels through cryptographic isolation.” [6]
Furthermore, to allow the authentication of an SEV platform,
each SEV-enabled platform contains a key pair that is unique to this
platform. The public key is signed by AMD and, given a platform-
specific ID, a guest owner can obtain this key from an AMD key
server. This key is the basis for a remote attestation protocol that
enables the user to verify the correct deployment of her VM, in-
cluding that SEV protection is in place. Only then she will inject a
guest secret, e.g., a disk encryption key, into the guest VM using a
secure channel between the PSP and the guest owner. This remote
attestation feature is a key component when using the infrastruc-
ture of an untrusted cloud provider. It provides cryptographic proof
that the cloud provider uses an authentic AMD platform with SEV
enabled and deployed the virtual machine according to the owner’s
configuration.
Previous research focused on the security of SEV-protected vir-
tual machines at runtime [11, 15, 25] while the remote attestation
feature of SEV has not been subject to a comprehensive analysis
yet. To overcome this gap, we analyzed the firmware components
that implement the remote attestation feature1. We demonstrate
that it is possible to extract the platform-specific private key, upon
which the security of the remote attestation protocol depends. This
enables the untrusted cloud provider to violate the security goals
of the SEV technology. Specifically, it enables the cloud provider to
forge the presence of SEV altogether, intercept the communication
between guest owner and SEV firmware and decrypt guest memory.
We show that it is, to the best of our knowledge, impossible to
provide a purely software-based fix for these issues. This questions
the security capabilities of the SEV feature for the complete AMD
Epyc Naples processor line. More so, it actively puts SEV customers’
data at risk since SEV might attract confidential data that was
previously not hosted in the cloud.
Furthermore, we propose a new design for the remote attestation
protocol. While the current SEV design cannot cope with firmware
security issues, the proposed design allows to revert to a trusted
state in case of previous firmware issues. Our proposed design en-
ables SEV customers to trust the remote platform even in case the
platform-specific private key was leaked.
Our contributions are:
(1) We conduct a comprehensive security analysis of the firmware
components that implement SEV’s remote attestation proto-
col. Our analysis reveals issues that allow to extract private
1To facilitate further research we published a PSP firmware analysis tool. The tool can
be found at [32].
keys that are fundamental to the security of the SEV technol-
ogy. More so, the current AMD Epyc CPUs allow to install
arbitrary signed firmware versions, hence extraction is pos-
sible even on systems that use patched firmware versions.
(2) We propose attacks based on our findings that allow to fake
the presence of SEV or extract encrypted VM memory in
plaintext.
(3) We show a severe design issue of the protocol, rendering
it useless in case of common firmware issues. The severity
is amplified as the issue allows to mount attacks targeting
platforms with no security issues present: Possession of an
extracted key is sufficient to mount the attacks, regardless of
whether the key belongs to the attacked platform or not.
(4) Lastly, we propose robust design changes to the SEV tech-
nology that allow future generations of SEV to mitigate the
impact of firmware security issues.
Ethical considerations: We informed AMD of the firmware is-
sues found during our analysis. AMD confirmed the presence of
the firmware issues and published security updates to the PSP
firmware. Similar issues had been previously reported by other
security researchers [21]. Furthermore, we reported the extracted
keys to AMD to allow a revocation of the corresponding certificates.
Although security fixes are already provided by AMD, our findings
show that software-based mitigations are not sufficient.
We therefore refrain from publishing any specific de-
tails on the firmware issues at this point in time. To
prove the successful extraction of private keys, we
provide a signature of the paper title created with the
extracted keys at [9]. The signature can be verified
using certificates provided by AMD.
The rest of the paper is structured as follows: In Section 2 we
give an overview of the SEV technology, its remote attestation capa-
bilities and the PSP. Section 3 presents the results of our firmware
analysis necessary to understand the attacks. The attacks are moti-
vated in Section 4 and described in Section 5. Section 6 discusses
the implications on the security of SEV and proposes a new design
for the remote attestation functionality. In Section 7 we give an
overview of related work and finally conclude in Section 8.
2 BACKGROUND
In this section, we give an overview of basic x86 virtualization
concepts and more specifically on the Secure Encrypted Virtualiza-
tion technology by AMD including the Platform Security Processor
(PSP). We focus on the remote attestation feature as this is our main
subject of analysis for the rest of the paper.
2.1 x86 Virtualization Concepts
Hardware extensions to facilitate the use of virtual machines were
introduced in 2005 by both Intel (VT-x) [30] and AMD (SVM) [1].
These extensions distinguish between the higher-privileged host
mode and the lower-privileged guest mode. Both modes are com-
prised of different privilege rings, which allow separating each
mode in privileged and unprivileged execution compartments. The
host mode controls the resources, such as memory and CPU time,
of the guest mode.
Session 5C: Cloud Security IICCS ’19, November 11–15, 2019, London, United Kingdom1088A software component called hypervisor executes in the host
mode, whereas the guest mode is occupied by the guest virtual
machines (VMs). In a cloud scenario, the hypervisor is supplied by
the cloud provider and therefore under full control of the cloud
provider.
Running in the higher privileged host mode, the hypervisor has
full access to the guest VM’s memory content.
2.2 Secure Encrypted Virtualization
The Secure Encrypted Virtualization technology (SEV) was first pre-
sented by AMD in 2016 [6]. It aims to protect a machine in the
presence of an untrusted cloud provider. The primary responsi-
bilities of SEV are runtime protection and secure initialization of
virtual machines.
Throughout the rest of the document, the term platform owner
refers to any entity that owns the SEV platform, i.e., the AMD
system that hosts the virtual machines. The term guest owner refers
to any entity that intends to utilize the platform provided by the
platform owner. In a typical use case, the platform owner is the
cloud computing provider, and the guest owner is a customer of
the provider.
The term SEV firmware refers to the code running on the SEV
platform implementing the SEV API [5]. It is provided by AMD and
hosted by the Platform Security Processor (PSP), in contrast to the
main x86 cores (referred to as main processor in this document),
that are under full control of the platform owner.
Runtime Protection The core of SEV’s runtime protection is a
memory encryption engine embedded in the memory controller
that encrypts the main memory using AES-128 [6]2. The encryp-
tion keys are generated by a firmware running on a dedicated
processor called the Platform Security Processor (PSP). It provides
an API [3] that the hypervisor, running on the main processor, must
use in order to manage the encryption keys for SEV-enabled guests.
An SEV-enabled guest controls which memory pages are passed
through the encryption engine by its guest pagetable.
Remote Attestation Even with runtime protection in place, SEV
would be useless in the face of an untrusted cloud provider, if the
platform owner could modify the VM during deployment or fake
the presence of SEV altogether. Through remote attestation, the
SEV firmware implicitly provides proof of authenticity of the SEV
platform to the guest owner and explicitly attests a VM’s integrity
to her. This is explained in Section 2.4 and 2.5.
Introduced in 2013 [2], the Plat-
Platform Security Processor
form Security Processor (PSP) is a dedicated ARMv7 based co-
processor built into the die of AMD CPUs providing security func-
tionality. It uses its own memory and non-volatile storage and can
access the main processor’s system memory. The firmware running
on the PSP is provided by AMD and integrity protected.
It also hosts a dedicated SEV firmware [5] that implements the
SEV API specified in [3].
2To protect the guest register state, AMD proposed an extension to SEV: SEV-Encrypted