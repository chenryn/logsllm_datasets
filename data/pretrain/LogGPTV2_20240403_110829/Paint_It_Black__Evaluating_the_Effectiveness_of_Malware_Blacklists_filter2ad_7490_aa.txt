# Paint It Black: Evaluating the Effectiveness of Malware Blacklists

**Authors:**
- Marc Kührer
- Christian Rossow
- Thorsten Holz

**Affiliation:**
Horst Görtz Institute for IT-Security, Ruhr-University Bochum, Germany
{firstname.lastname}@ruhr-uni-bochum.de

## Abstract
Blacklists are widely used to protect computer systems from the vast number of malware threats. These lists include abusive hosts, such as malware sites or botnet Command & Control (C&C) and dropzone servers, to trigger alerts when suspicious hosts are contacted. However, little is known about the effectiveness of these blacklists. In this paper, we empirically analyze 15 public malware blacklists and 4 blacklists operated by antivirus (AV) vendors. Our goal is to categorize the blacklist content to understand the nature of the listed domains and IP addresses. First, we propose a mechanism to identify parked domains in blacklists, which we find to constitute a significant portion of the entries. Second, we develop a graph-based approach to identify sinkholes, i.e., servers that host malicious domains controlled by security organizations. In a thorough evaluation of blacklist effectiveness, we show the extent to which real-world malware domains are covered by blacklists. We find that the union of all 15 public blacklists includes less than 20% of the malicious domains for the majority of prevalent malware families, and most AV vendor blacklists fail to protect against malware using Domain Generation Algorithms (DGAs).

**Keywords:** Blacklist Evaluation, Sinkholing Servers, Parking Domains.

## 1. Introduction
The security community faces an increasing number of malware samples infecting computer systems worldwide. Various countermeasures have been proposed to combat the ubiquitous presence of malware. Notably, researchers have explored network-based detection methods to complement existing host-based malware protection systems. One prominent example is endpoint reputation systems, which typically involve assembling a blacklist of endpoints involved in malicious activities. For instance, blacklists can contain domains of C&C servers of botnets, dropzone servers, and malware download sites. Such blacklists can be queried by intrusion detection systems (IDS) to determine if a previously unknown endpoint (e.g., a domain) is known for suspicious behavior.

However, little is known about the effectiveness of malware blacklists. To our knowledge, the completeness and accuracy of malware blacklists have not been thoroughly examined. Completeness is crucial because users may miss notifications about malicious but unlisted hosts. Additionally, blacklists may become outdated if entries are not frequently revisited by the providers. An endpoint's reputation may change over time, for example, due to shared hosting.

In this paper, we analyze the effectiveness of 15 public and 4 antivirus (AV) vendor malware blacklists. We aim to categorize the blacklist content to understand the nature of the listed entries. Our analysis involves multiple steps. First, we propose a mechanism to identify parked domains, which we find to constitute a substantial number of blacklist entries. Second, we develop a graph-based approach to identify sinkholed entries, i.e., malicious domains that are now controlled by security organizations. Finally, we evaluate the extent to which real-world malware domains are covered by the blacklists.

In our analysis, we identified 106 previously unknown sinkhole servers, revealing 27 sinkholing organizations. Additionally, we found that between 40-85% of the blacklisted domains were unregistered for more than half of the analyzed blacklists, and up to 10.9% of the blacklist entries were parked. The results show that the coverage and completeness of most blacklists are insufficient. For example, public blacklists are impractical for protecting against prevalent malware families, as they fail to include domains for various families or list malicious endpoints with reaction times of 30 days or higher.

Fortunately, three AV vendor blacklists perform significantly better. However, we also identify shortcomings: only one blacklist sufficiently protects against malware using DGAs, while the other AV vendor blacklists include a negligible number of DGA-based domains. Our thorough evaluation can help improve the effectiveness of malware blacklists in the future.

**Summary of Contributions:**
- We propose a method to identify parked domains by training an SVM classifier on seven inherent features we identified for parked websites.
- We introduce a mechanism based on blacklist content and graph analysis to effectively identify malware sinkholes without prior knowledge.
- We evaluate the effectiveness of 19 malware blacklists and show that most public blacklists have insufficient coverage of malicious domains for the majority of popular malware families, leaving end hosts relatively unprotected. While we find that blacklists operated by AV vendors have significantly higher coverage, up to 26.5% of the domains are still missed for the majority of malware families, revealing severe deficiencies in current reputation systems.

## 2. Overview of Malware Blacklists
Various malware blacklists, operated by security organizations, are used to identify malicious activities. These blacklists include domains and IP addresses observed in a suspicious context, such as C&C servers or endpoints associated with malware in general. Table 1 summarizes the 15 public malware blacklists we monitored over the past two years. For most blacklists, we obtained a copy every 3 hours (if permitted). The "Current" column shows the number of entries listed at the end of our monitoring period, while the "Historical" column summarizes the entries that were once listed but became delisted during our monitoring period. For brevity, we omit the number of listed IP addresses, focusing primarily on the blacklisted domains. For all listed domains, we resolved the IP addresses and stored the name server (NS) DNS records. If blacklists contained URLs, we used the domain part of the URLs for our analysis.

| **Blacklist** | **Current Domains** | **Historical Domains** | **Observation (days)** |
|--------------|---------------------|------------------------|------------------------|
| AMaDa [8]    | 4,634               | 107,183                | 0                      |
| Citadel [7]  | 1,070               | 20,135                 | 0                      |
| Cybercrime [9] | 2,121              | 11,996                 | 0                      |
| Exposure [4] | 1,653               | 1,675                  | 0                      |
| Malc0de [10] | 37,490              | 267                    | 0                      |
| MDL Hosts [11] | 1,494             | 66                     | 12                     |
| MDL ZeuS [11]| 23,396              | 121                    | 0                      |
| MW-Domains [12] | 832               | 559                    | 0                      |
| Palevo Tracker [8] | 832            | 832                    | 0                      |
| Shadowserver [13] | 832            | 829                    | 0                      |
| Shallalist [14] | 832               | 832                    | 0                      |
| SpyEye Tracker [8] | 832           | 832                    | 0                      |
| UrlBlacklist [15] | 832            | 832                    | 0                      |
| Virustracker [16] | 832            | 832                    | 0                      |
| ZeuS Tracker [8] | 832             | 832                    | 0                      |

Four blacklists are provided by Abuse.ch, specifically listing hosts related to the Palevo worm and the banking trojans SpyEye and ZeuS. The Virustracker project lists domains generated by DGAs, and the Citadel list includes domains utilized by the Citadel malware (seized by Microsoft in 2013 [7]). UrlBlacklist combines user submissions and other blacklists, covering domains and IPs of various categories, with a focus on malware-related content. The Exposure [4] blacklist included domains flagged as malicious using passive DNS (pDNS) analysis. The Abuse.ch AMaDa and the Exposure lists were discontinued, but we use the collected historical data.

Besides these public blacklists, we requested information from four antivirus (AV) vendors: Bitdefender TrafficLight [17], Browserdefender [18], McAfee SiteAdvisor [19], and Norton SafeWeb [20]. These blacklists cannot be downloaded, but we can query if a domain is listed. Therefore, we do not know the overall size of these blacklists and omit the numbers in Table 1.

### Datasets
We divide the 15 public blacklists into three overlapping datasets:
1. **SC&C**: Consists of domains from sources primarily listing endpoints associated with C&C servers, denoted by ‡ in Table 1. We extend SC&C with the IP addresses to which any of these domains resolved.
2. **SMal**: Includes domains listed in any of the 15 blacklists (including SC&C) and the resolved IPs.
3. **SIPs**: Covers all currently listed IP addresses by any of the 15 public blacklists (i.e., 196,173 IPs in total). This dataset helps verify if blacklists contain IPs of sinkholing servers.

### Paper Outline
Motivated by the fact that blacklists contain thousands of domains, we aim to understand the nature of these listings. We group the entries into four main categories:
- Unregistered domains
- Domains controlled by parking providers
- Domains assigned to sinkholes
- Domains serving actual content

Unregistered domains can be easily identified using DNS. However, detecting parked or sinkholed domains is non-trivial. We propose detection mechanisms for these types in Sections 3 (parking domains) and 4 (sinkholed domains). In Section 5, we classify the blacklist content and analyze the extent to which blacklists help protect against real malware. A longer version of this paper with more technical details is available as a technical report [21].

## 3. Parking Domains
Parking domains make up a significant class of blacklist entries. They are primarily registered for displaying web advertisements, often with no other real content. As domains associated with malicious activities tend to be parked to monetize the traffic, we expect parked domains to constitute a substantial number of blacklist entries. However, parking services have diverse page templates, making it challenging to identify these sites with pattern-matching algorithms. To address this, we introduce a generic method to detect parked domains that can handle the diversity of parking providers.

### 3.1 Datasets
We first assemble a labeled dataset by manually creating patterns and applying pattern-matching algorithms [23, 24]. Note that these patterns are incomplete due to the high diversity of page templates. We use the resulting dataset as ground truth to evaluate our generic detection model for parked domain names. Based on Li et al.'s [22] observation, parking providers either modify the authoritative NS sections of a domain to point to dedicated parking NS or employ web-based (HTTP, HTML, or JavaScript) redirections to forward users to the final parking content.

Using our recorded DNS information, we label domains following the DNS-based type of redirection. We analyze the 233,772 distinct name servers aggregated while processing the blacklist data, split the NS hostnames into tokens, and search for terms indicating parking, such as "park," "sell," and "expired." We label NS whose hostnames match these terms as potential parking name servers. We monitor a fraction of parked domains that switched their authoritative NS to a different parking provider. We extract the domains that used the parking NS identified in the previous step, request the latest NS records for each domain, and inspect the most frequently used NS. Additionally, we consult the DNS DB [25], a passive DNS (pDNS) database. For each identified parking NS, we request 50,000 randomly selected domains the NS was authoritative for, obtain current NS records, and check the NS hostnames against terms indicating parking behavior. Overall, using these techniques and manual inspection, we identified 204 NS operated by 53 parking providers.

A minority of parking services use web-based techniques to redirect users to the actual parking content. The DNS-based methods discussed so far did not detect these providers. However, we identified parked domains that are often transferred between providers, assuming some domains found in pDNS data of the previously identified parking NS relocated to providers using web-based redirection techniques. We extracted 10,000 randomly chosen domains from the pDNS data of each parking NS, analyzed the domain redirection chains, and identified 14 patterns of landing pages [21] to which users are redirected when visiting parked domains. These landing pages belong to parking, domain, and hosting providers.

Finally, we use the parking NS and landing pages to manually extract 47 descriptive strings, referred to as identifiers (IDs) [21]. These IDs can be found in the HTTP responses of many parked domains (e.g., `<frame src="http://ww[0-9]{1,2} and landingparent`). We use these IDs to create the parked domains dataset P, consisting of 5,000 randomly chosen domains from the pDNS database that utilize a verified parking NS or include at least one identifier. We also create a dataset B of benign (non-parked) domains, using the top 5,000 domains from the Alexa Top Ranking [26] and verifying that none of these domains trigger a landing page or ID match.

### 3.2 Feature Selection and Classification
Pattern matching allowed us to identify a subset of parking services. However, we seek to identify intrinsic characteristics of parking websites that are more generic than the manually assembled classification. We studied subsets of our benign and parked domain sets and identified two HTTP-based and five HTML-based features.

The first HTTP-based feature is determined by the redirection behavior when accessing the domain.