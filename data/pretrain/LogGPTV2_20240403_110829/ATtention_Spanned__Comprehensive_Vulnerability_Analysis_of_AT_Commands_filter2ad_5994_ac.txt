USB.rc
w/ acm
330
73
253
56
144
591
168
10
581
56
23
2955
Avg. acm
Triggers
USB.rc
w/ diag
Avg. diag
Triggers
2.9
5.6
14.3
5
6.7
1.1
4.4
16
5.4
4.7
6.9
262
496
253
58
100
693
281
224
509
56
23
4.1
2285
2.5
29.2
31.3
29.1
25.7
1.0
15.1
7.0
19.6
21.2
36.5
17.3
Device
Android Ver# Modem Exposed
Samsung Galaxy Note 2
Samsung Galaxy S7 Edge
Samsung Galaxy S8 Plus
LG G3
LG G4
HTC One
HTC Desire 626
Asus ZenPhone 2
Asus ZenPad
Google Nexus 5
Google Nexus 5X
Google Nexus 6P
Google Pixel
Motorola Moto X
4.4.2
7.0
7.0
6.0
6.0
4.4.2
5.1
5.0
5.0.2
5.1.1
6.0
7.1.1
7.1.1
5.1
Y
Y
Y
Y
Y
Y*
N
N*
N
N*
Y (root)
Y (root)
Y (root)
Y (root)
Table 4: Per vendor counts of USB.rc ﬁles found to con-
tain acm and diag triggers, alongside the average number
of contained triggers. In total, we found 12,018 acm and
39,605 diag triggers across USB.rc ﬁles in 1,564 images.
Table 5: We examined 14 Android devices to ﬁnd if they
expose USB modem interfaces. 6 expose the modem by
default; 4 can expose it after being rooted.
are handled by this application and, given its extensive
system permissions, it is an interesting target. A previous
vulnerability in 2016 [49] (CVE-2016-3117) gave any ap-
plication the ability to communicate through LGATCMD-
Service to atd, allowing the phone to be bricked or sen-
sitive data to be read. Through static analysis of this
service APK, we conﬁrmed that there were now checks
ensuring that only requests from the system user (UID
1000) would be allowed. Despite this patch, unlike Sam-
sung, LG does not whitelist AT commands, so any that are
supported by the Android system or modem are passed
through the USB interface.
USB Pre-Conﬁguration Files. Now that we know the
prevalence of AT commands in the gathered ﬁrmware
images, we inspect the susceptibility of the images to
AT commands. We do this by looking at USB init/pre-
conﬁguration ﬁles (e.g., init.usb.rc), referred from
here on as USB.rc ﬁles, which provide details about the
USB modes supported by the device. We were able to
extract pre-conﬁguration ﬁles from 1,564 of the 2,018 to-
tal images, some having multiple such ﬁles (for example,
HTC images contain an average of 10).
We look for property:sys.usb.config triggers in
the pre-conﬁguration ﬁles and discover that 864 images
(55% of the images from which USB.rc ﬁles were suc-
cessfully extracted) contain at least one USB.rc ﬁle with
triggers for ACM mode. Since enabling USB modem
functionality causes a CDC-ACM interface to be exposed,
our ﬁnding suggests that over half6 of phone ﬁrmwares
have the potential to provide modem functionality. We
also look for triggers for diagnostic mode, indicated by
6 We expect a similar prevalence of ACM mode triggers among the
remaining 454 images for which extraction of USB.rc ﬁles failed.
diag, which usually activated the ACM interface once en-
abled. We discover that 1,175 images (75% of the images
from which USB.rc ﬁles were extracted) contain at least
one USB.rc ﬁle with diag triggers. Our ﬁnding suggests
that even more phone ﬁrmwares (beyond those with ACM
mode triggers) have the potential to provide modem func-
tionality through alternative diag triggers.
Table 4 presents the breakdown of average acm and
diag trigger counts per vendor. Since each image may
have multiple USB.rc ﬁles, we average trigger counts over
the total number of these ﬁles from each vendor, rather
than the number of images containing USB.rc ﬁles.
4.2 Runtime Vulnerability Analysis
We ﬁrst examine the prevalence of the USB modem in-
terface being exposed by different Android devices. We
look at 13 Android phones and 1 Android tablet from ma-
jor vendors. Table 5 provides an overview of these de-
vices and whether or not they expose a modem interface.
All Samsung and LG phones we tested expose a USB mo-
dem interface by default. HTC One also exposes a mo-
dem interface, but it does not accept any AT commands.
ZenPhone 2, ZenPad, and Nexus 5/5X also expose a mo-
dem interface, but not by default; their USB conﬁguration
must be changed after rooting. Of note, Zenpad, though it
does not support mobile data at all, still exposed a modem
interface. Although neither Nexus 6P nor Moto X reveal
a modem interface during our testing, they have the po-
tential to enable a modem interface by exploiting fastboot
vulnerabilities [31].
We chose 8 devices shown in Table 6 for testing, in-
cluding all devices exposing a USB modem interface by
default, as well as 3 other devices that offer ways to en-
able such an interface. We use our AT command testing
framework to send the 3500 unique AT commands we ex-
280    27th USENIX Security Symposium
USENIX Association
Device
Note2
S7Edge
S8+
G3
G4
ZenPhone2* LRX21V.WW-ASUS Z00A-
Build Number
KOT49H.N7100XXSFQA7
NRD90M.G935FXXU1DQB7
NRD90M.G955USQU1AQD9
MRA58K
MRA58K
2.20.40.198 20160930 875 user
ZenPad*
Nexus5*
LRX22G.WW ZenPad-
12.26.4.69-20170410
LMY48I
USB Conﬁg
None
None
None
None
None
system.at-
proxy.mode
[1-4]
sys.usb.conﬁg
mtp,acm
sys.usb.conﬁg
diag,adb
Table 6: We chose 8 devices from Table 5, including 5
phones exposing the modem by default, and 3 rooted de-
vices (as marked by *) with the modem exposed by setting
the USB conﬁguration. We tested all of them using our AT
command testing framework.
Command
AT%RESTART
AT%PMRST
AT%POWEROFF
AT%DLOAD
AT%FRST
AT%MODEMRESET
AT+CRST=FS
AT+CFUN=0
AT+CFUN=1,1
AT+CFUN=1,1
AT+CFUN=6
AT+CFUN=6,0
AT+FACTORST=0,0
AT+SUDDLMOD=0,0
AT+FUS?
ATˆRESET
Action
Tested Phones
Phone reboot
Phone reboot
Phone reboot
Firmware download
mode
Factory reset
Modem reset
Factory reset
Phone Reboot
Phone reboot
MiniOS and factory
reset status 2
Phone reboot
Phone reboot
Factory reset
Firmware download
mode
Firmware download
mode
Phone power off
G3
G3
G3/G4
G3/G4
G3
G3/G4
G3/G4
G3/G4
S7Edge/S8+
G4
G3/G4/S8+
S8+
S7Edge/S8+
Note2/S7Edge/S8+
Note2/S7Edge/S8+
G3/G4/S8+
Table 7: A selection of commands that can change the
phone’s ﬁrmware image through resetting or updating.
tracted, plus 222 standard commands, to each device. We
manually look at the response elicited for each command,
picking up the ones with successful replies or observable
side effects during testing, e.g., causing the device to re-
boot. We are able to group notable behaviors into several
categories that demonstrate the wide security impact of
AT commands using this USB modem interface, which is
either exposed by default or enabled later by other means,
e.g., by rooting the device.
4.2.1 Firmware Flashing
We ﬁnd AT commands enabling ﬁrmware ﬂashing in An-
droid phones, which were reported before [20]. Once the
phone is put into download mode using the AT commands
in Table 7, attackers can attempt to ﬂash rooted or mal-
ware pre-installed images into the phone. On the Sam-
Command
Action
ATD
ATH
Dial a number
Hangup call
ATA
AT%IMEI=[param]
AT%USB=adb
AT%KEYLOCK=0
AT+CKPD
AT+CMGS
AT+CGDATA
AT+CPIN
AT$QCMGD
Answer incoming call
Allows the IMEI to be
changed
Enables invisible ADB
debugging
Unlock the screen
Sends keypad keys ([0-9*#])
Sends a SMS message
Connect to the Internet
using data
SIM PIN management
Delete messages
(by index, all read/sent)
Tested Phones
G3/G4/S8+/Nexus5/
ZenPhone2
G3/G4/S8+/Nexus5/
ZenPhone2
G3/G4/Nexus5
G3/G4
G3/G4
G3/G4
G3/G4/S8+
ZenPhone2
G3/G4/Nexus5/
ZenPhone2
G3/G4/S8+/Nexus5/
ZenPhone2
Nexus5
Table 8: A selection of commands that can be used to gain
further access into the phone.
sung phones we tested, the AT commands put the phone
into Odin [48] mode, although they were not able to by-
pass the device standard ﬁrmware authentication mecha-
nism [57, 30]. Odin also sets the KNOX warranty fuse
within a phone if an unsigned ﬁrmware image is ﬂashed.
We also found LG has its own ﬁrmware ﬂashing AT com-
mand, shown in Table 7, which allows ﬂashing malicious
ﬁrmware into the phone using LGUP [39].7 Factory re-
setting AT commands are also found, erasing user data
without permission. Some commands reboot/shutdown
the phone, and we manually inspect security related set-
tings, e.g., USB debugging, after the reboot, but did not
ﬁnd any particular conﬁguration change.
We observe that some AT commands result in different
behaviors on phones from different vendors. As an exam-
ple, “AT+CFUN=1,1,” although a standard command that
is supposed to “reset the device and provide full function-
alities”8 according to the GSM spec [26], causes Samsung
phones to reboot and causes LG G4 to become bricked
and show “LG G4 factory reset status 2” blue screen error.
Surprisingly, the USB modem interface was still exposed
even in this mode. While we were unable to restore the
phone using any of the normal procedures, we were able
to successfully un-brick the phone using a combination of
“AT%MODEMRESET”, which changes the factory reset
status from 2 into 5, and “AT%RESTART” commands,
which ﬁnally reboots the phone into a normal booting en-
vironment following a factory reset.
USENIX Association
27th USENIX Security Symposium    281
4.2.2 Android Security Bypassing
This section demonstrates AT commands that bypass dif-
ferent Android security mechanisms, such as lock screen,
UI notiﬁcation, etc., as shown in Table 8. We were able
to make phone calls by sending an “ATD” command to
the phone. Note that this command works even if there
is a screen lock on the phone. Combined with “ATH”
and “ATA,” one can call any number, accept any incom-
ing call, and end a call via a USB connection. Note that
the ATD vulnerability on Samsung phones was reported 2
years ago [47], and it was patched. Neither our Note 2 nor
S7 Edge is able to make a call. Nevertheless, this once-
patched vulnerability reappears on the S8+. Similarly, AT
commands for managing PINs on SIM cards and connect-
ing to the Internet using mobile data were also accessi-
ble on four of the testing phones. These commands are
all standard AT commands delivered to the modem by na-
tive daemons, bypassing the Android framework. We also
ﬁnd an LG-speciﬁc command that allows us to change the