d
N
A
R
F
A
c
al
e
w
rts/
s/
o
efe
r
e
o
d/
H
ni
D
C
u
m
als
m
n
rin
c
e
a
k
u
rr
e
e
n
o
n
al 
C
a
r
e
nitie
nt 
E
s
v
e
nts
We ﬁrst begin by examining (where possible) the soft-
ware running on the web-servers for all the landing sites
that lead to the malware distribution sites. Speciﬁcally,
we collected all the “Server” and “X-Powered-By”
header tokens from each landing page (see Table ).
Not surprisingly, of those servers that reported this in-
formation, a signiﬁcant fraction were running outdated
versions of software with well known vulnerabilities .
For example, 
of servers with PHP scripting support reported a version
with security vulnerabilities. Overall, these results reﬂect
the weak security practices applied by the web site ad-
ministrators. Clearly, running unpatched software with
known vulnerabilities increases the risk of content con-
trol via server exploitation.
.1% of the Apache servers and 
.%
 
17th USENIX Security Symposium 
USENIX Association
Srv. Software
Apache
Microsoft IIS
Unknown
Scripting
PHP
count
,0
11,0
1,70
Unknown Up-to-date
.%
.%
n/a
n/a
n/a
n/a
Old
%
n/a
n/a
7,7
.%
1.%
.%
Table : Server version for landing sites. In the case of Micr osoft IIS, we could not verify their version.
i
g
n
s
i
t
r
e
v
d
a
a
v
s
n
o
i
i
t
c
e
n
f
i
e
r
a
w
a
m
l
f
o
t
e
g
a
n
e
c
r
e
P
60
55
50
45
40
35
30
25
20
15
10
5
0
03-2007
04-2007
05-2007
Weighted by frequency of appearance
Weighted by unique landing sites
06-2007
07-2007
Week analyzed
08-2007
09-2007
10-2007
11-2007
Figure : Percentage of landing sites potentially infect-
ing visitors via malicious advertisements, and their rela-
tive share in the search results.
5.2 Drive-by Downloads via Ads
Today,
the majority of Web advertisements are dis-
tributed in the form of third party content to the adver-
tising web site. This practice is somewhat worrisome, as
a web page is only as secure as it’s weakest component.
In particular, even if the web page itself does not contain
any exploits, insecure Ad content poses a risk to adver-
tising web sites. With the increasing use of Ad syndica-
tion (which allows an advertiser to sell advertising space
to other advertising companies that in turn can yet again
syndicate their content to other parties), the chances that
insecure content gets inserted somewhere along the chain
quickly escalates. Far too often, this can lead to web
pages running advertisements to untrusted content. This,
in itself, represents an attractive avenue for distributing
malware, as it provides the adversary with a way to in-
ject content to web sites with large visitor base without
having to compromise any web server.
To assess the extent of this behavior, we estimate the
overall contribution of Ads to drive-by downloads. To
do so, we construct the malware delivery trees from all
detected malicious URLs following the methodology de-
scribed in Section . For each tree, we examine every
intermediary node for membership in a set of 2, 000 well
known advertising networks. If any of the nodes qual-
ify, we count the landing site as being infectious via Ads.
Moreover, to highlight the impact of the malware deliv-
ered via Ads relative to the other mechanisms, we weight
the landing sites associated with Ads based on the fre-
quency of their appearance in Google search results com-
pared to that of all landing sites. Figure  shows the
percentage of landing sites belonging to Ad networks.
On average, 2% of the landing sites were delivering mal-
ware via advertisements. More importantly, the overall
weighted share for those sites was substantial—on aver-
age, 12% of the overall search results that returned land-
ing pages were associated with malicious content due to
unsafe Ads. This result can be explained by the fact that
Ads normally target popular web sites, and so have a
much wider reach. Consequently, even a small fraction
of malicious Ads can have a major impact (compared to
the other delivery mechanisms).
Another interesting aspect of the results shown in Fig-
ure  is that Ad-delivered drive-by downloads seem to
appear in sudden short-lived spikes. This is likely due
to the fact that Ads appearing on several advertising web
sites are centrally controlled, and therefore allow the ma-
licious content to appear on thousands of web sites sites
almost instantaneously. Similarity, once detected, these
Ads are removed simultaneously, and so disappear as
quickly as they appeared. For this reason, we notice
that drive-by downloads delivered by other content in-
jection techniques (e.g., individual web servers compro-
mise) have more lasting effect compared to Ad deliv-
ered malware, as each web site must be secured inde-
pendently.
The general practice of Ad syndication contributes sig-
niﬁcantly to the rise of Ad delivered malware. Our re-
sults show that overall 7% of the landing sites that de-
livered malware via Ads use multiple levels of Ad syn-
dication. To understand how far trust would have to ex-
tend in order to limit the Ad delivered drive-by down-
USENIX Association  
17th USENIX Security Symposium 
7






1
0.8
0.6
0.4
0.2
F
D
C
0
0
2
4
6
No Ads
Ads
14
16
18
20
F
D
C
 1
 0.8
 0.6
 0.4
 0.2
 0
 0
Network I
II
III
IV
V
 0.2
 0.8
Normalized Ad  network position in the chain
 0.4
 0.6
 1
8
Number of redirection steps
10
12
Figure : CDF of the number of redirection steps for Ads
that successfully delivered malware.
Figure 7: CDF of the normalized position of the top ﬁve
Ad networks most frequently participating in malware
delivery chains.
loads, we plot the distribution of the path length from the
landing site leading to the malware distribution sites for
each delivery tree. The edges connecting the nodes in
these paths reﬂect the number of redirects a browser has
to follow before receiving the ﬁnal payload. Hence, for
syndicated Ads that delivered malware the path length
is indicative of the number of syndication steps before
reaching the ﬁnal Ad; in our case, the malware payload.
Figure  shows the distribution of the number of redi-
rects for syndicated Ads that delivered malware relative
to the other malicious landing URLs. The results are
quite telling: malware delivered via Ads exhibits longer
delivery chains, in 50% percent of all cases, more than 6
redirection steps were required before receiving the mal-
ware payload. Clearly, it is increasingly difﬁcult to main-
tain trust along such long delivery chains.
Inspecting the delivery trees that featured syndication
 unique Ad networks participating
reveals a total of 
in these trees. We further studied the relative role of the
different networks by evaluating the frequency of appear-
ance of each Ad network in the malware delivery trees.
Interestingly, our results show that ﬁve advertising net-
works appear in approximately 75% of all malware deliv-
ery trees. Figure 7 shows the distribution of the relative
position of each network in the malware delivery chains
it participated in. The normalized position is calculated
by dividing the index of the Ad network in each chain
by the length of the chain. The graph shows that these
advertising networks split into three different categories:
In the ﬁrst category, which includes network I, the ad-
vertising network appears at the beginning of the deliv-
ery chain. In the second category, which includes net-
works II-IV, advertising networks appear frequently
in the middle of the delivery chains. In both these cat-
egories advertising networks do not participate directly
in delivering malware. However, the relative position of
networks in the delivery chain may be used as an indi-
cation of their relationship with the malware distribution
sites – the deeper a network’s relative position the closer
it is related to the malware distribution site. Finally, in
the third category, indicated by network V, our analysis
revealed that in almost 50% of all incidents, the advertis-
ing network is directly delivering malware. For example,
advertising network V pushes Ads that install malware in
the form of a browser toolbar.
Finally we further elucidate this problem via an in-
teresting example from our data corpus. The landing
page in our example refers to a Dutch radio station’s web
site. The radio station in question was showing a ban-
ner advertisement from a German advertising site. Us-
ing JavaScript, that advertiser redirected to a prominent
advertiser in the US, which in turn redirected to yet an-
other advertiser in the Netherlands. That advertiser redi-
rected to another advertisement (also in the Netherlands)
that contained obfuscated JavaScript, which when un-
obfuscated, pointed to yet another JavaScript hosted in
Austria. The ﬁnal JavaScript was encrypted and redi-
rected the browser via multiple IFRAMEs to adxtnet.net,
an exploit site hosted in Austria. This resulted in the
automatic installation of multiple Trojan Downloaders.
While it is unlikely that the initial advertising companies
were aware of the malware installations, each redirection
gave another party control over the content on the origi-
nal web page—with predictable consequences.
 
17th USENIX Security Symposium 
USENIX Association
6 Malware Distribution Infrastructure
In this section, we explore various properties of the host-
ing infrastructure for web malware. In particular, we ex-
plore the size of of the malware distribution networks,
and examine the distribution of binaries hosted across
sites. We argue that such analysis is important, as it sheds
light on the sophistication of the hosting infrastructures
and the level of malfeasance we see today. As is the case
with other recent malware studies (e.g., [, 
hope that this analysis will be of beneﬁt to researchers
and practitioners alike.
, 1]) we
s
e
t
i
S
f
o
n
o
i
t
c
a
r
F
e
v
i
t
l
a
u
m
u
C
 1
 0.8
 0.6
 0.4
 0.2
 0
 0
Landing Sites
Distribution Sites
 50
 100