Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 05:38:34 UTC from IEEE Xplore.  Restrictions apply. 
Figure2:SimpliﬁedviewofWSECDNSqueryprocess.whichsaythat*.wsecdns.www.example.comisanaliasforwww.example.com,and*.test.wsecdns.www.example.comisanaliasfortest.wsecdns.example.com.Weinfor-mallyrefertotheseconﬁgurationlinesaswildcardCNAMErecords.c)ATXTRRisintroduced,foreachwildcarddomain,excludingwildcardCNAMERRs.Forexample,inFig-ure1weintroducedthefollowingline*.webINTXT"|wsecdns=enabled|"becauseawildcardARRfor*.web.example.comwaspresentintheoriginalzone-ﬁle.Weinformallyrefertotheseconﬁg-urationlinesaswildcardTXTrecords.3.2TheWSECDNSQueryProcessAsimpliﬁedviewoftheWSECDNSqueryprocessisrepresentedinFigure2.AssumeahostqueriesfortheRRoftypeA(i.e.,theIPaddress)ownedbywww.example.com.AtthispointtheRDNSgeneratesarandomalphanumericstring(cid:2)rand(cid:3)oflengthN,andqueriesfortheTXTRRof(cid:2)rand(cid:3).test.wsecdns.www.example.com.Thisqueryisusedtoperformasortof“handshake”withtheauthoritativenameserver(ANS)forthedomainsintheexample.comzone.IftheANSforthezoneexample.comhasenabledWSECqueries(i.e.,thezone-ﬁleforthezoneexample.comontheANSrespectstheconﬁgurationrequirementsdis-cussedinSection3.1),itwillreportthefactthat(cid:2)rand(cid:3).test.wsecdns.www.example.comisanaliasfortest.wsecdns.example.comandthataTXTRRexistsforthisdomain,whichisequaltothestring"|wsecdns=enabled|".Atthispoint,WSECDNSqueriesareconsideredenabled,andinsteadofqueryingforwww.example.comA?5,theRDNSwillqueryfor(cid:2)rand(cid:3).wsecdns.www.example.comA?,i.e.,theoriginalqueryfromthehosttotheRDNSplusthestring(cid:2)rand(cid:3).wsecdns.prepended.SincetheANSisWSEC-enabled,thisquerywillmatchthewildcard“*.wsecdns.wwwINCNAME5Forthesakeofsimplicity,inthefollowingwewillusethenotation?tomean“queryfortheresourcerecordsoftypeownedby”.ResourceRecordsoftypeAareusedtotranslateadomainnameintoasetofIPv4addresses[19].www”(seezone-ﬁleinFigure1),whichsaysthat*.wsecdns.www.example.comisanaliasforwww.example.com.BecausetheANSisauthoritativeforwww.example.com,accordingtoRFC1034[18]theresponsefromtheANS(inthisexample)willinclude:1)thequerieddomainname(cid:2)rand(cid:3).wsecdns.www.example.cominthequestionsection;2)anCNAMERRthatsaysthat(cid:2)rand(cid:3).wsecdns.www.example.comisanaliasforwww.example.com;and3)anARRthatreportstheIPaddressofwww.example.com,whichistheinformationoriginallyrequestedbythestub-resolver.TheRDNSwillﬁrstmakesurethatthedomainnameinthequestionsectionoftheresponseactuallymatchesthequerieddomainname(includingtherandompreﬁx(cid:2)rand(cid:3)).Ifamismatchoccurs,theresponsewillbedis-carded.Finally,theRDNSwillnormalizetheanswerre-ceivedfromtheANSbycuttingtheCNAMEentrythatstartswith(cid:2)rand(cid:3).wsecdns.fromtheresponse,cachingthenormalizedresponse,andforwardingittothehost(amoredetaileddescriptionoftheWSECresponsenormalizationprocessisreportedintheAppendixof[22]).ItiseasytoseethatthebasicversionoftheWSECDNSqueryprocessdescribedabovehasthesideeffectofdou-blingtheDNStrafﬁcfromtheRDNStothenameservers.WewillshowinSection3.3thatwecanmakeuseofthesamecachesystemusedby“standard”RDNSimplemen-tationsinordertogreatlyreducetheamountofadditionaltrafﬁcresultingfromtheWSECDNSqueryprocess.SecurityBeneﬁtsWSECDNSprotectstheRDNS’scachefrompoisoningattacksagainstthedomainnames(e.g.,www.example.com)inWSEC-enabledzones(e.g.,example.com),includingKaminsky’sattack.Thisisbe-causetheattackerisnowrequiredtomakeamuchbiggeref-forttotrytoguesstherandomstring(cid:2)rand(cid:3)usedaspreﬁxinWSECqueries,inadditiontotherandomtransactionID(andpossiblysourceUDPport).Iftheattackerisnotabletoforgepacketswiththecorrect(cid:2)rand(cid:3)combinationandsendthemtotheRDNSbeforethegenuineauthoritativere-sponsearrivesfromtheANS,theattackwillfail.ThisholdstrueforallthestepsoftheWSECDNSqueryprocess,re-gardlessoftherequestedtypeofRRintheoriginalqueriesfromthehosts,becauseanewrandompreﬁx(cid:2)rand(cid:3)isis-suedwitheveryquerysentbyaWSEC-compliantRDNStothenameservers,includingduringtheinteractionwiththerootandTLDnameservers.WewillshowinSection3.5thatusinguniformlyrandomstringsofonlyﬁvealphanu-mericcharacters,WSECDNSmakesKaminsky’sattackpracticallyinfeasibleevenforverymotivatedandpowerfulattackers.TransparencyPropertyItiseasytoseethattheWSECDNSqueryprocessiscompletelytransparenttothehost,978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
8
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 05:38:34 UTC from IEEE Xplore.  Restrictions apply. 
thankstotheWSECresponsenormalizationalgorithmde-scribedabove.TheuserwillalwaysseethecorrectresponsetotheoriginalqueryasiftheRDNSwasusingthe“stan-dard”DNSqueryprocess,insteadoftheWSECDNSpro-cess.ItisworthnotingthatqueriesforresourcerecordsotherthanA,(e.g.,AAAA,CNAME,MX,TXT,NS,etc.)canbehandledbyWSECDNS.TheWSECDNSquerypro-cessworksindependentlyfromtheRRtyperequestedintheoriginalqueryfromthehost,thankstotheuseofCNAMEwildcardsaddedinordertomakeazoneWSEC-enabledasdescribedinSection3.1.BackwardCompatibilityInthecaseswhenazoneisnotWSEC-enabled,theANSwillanswertotheWSEC“hand-shake”(i.e.,theﬁrstquery(cid:2)rand(cid:3).test.wsecdns.www.example.comTXT?)withNXDOMAIN(non-existent),orpossiblywithastringthatdoesnotcon-tain"|wsecdns=enabled|".InthiscasetheRDNSwillsimplyissuethesecondqueryusingtheoriginalquerywww.example.comA?fromthehost(withouttheWSECrandompreﬁx),andforwardtheresponsetothehost.AnegativeWSECcacheisusedtoavoidtoretryoverandoveraWSEC“handshake”withzonesthatarenotWSEC-enabled,asexplainedinSection3.3.OnlyafterthenegativeWSECcacheentryexpires(e.g.,afteroneday),theRDNSwillretrytheWSEChandshake.Thebackwardcompatibil-ityallowsWSECDNStobedeployedincrementally,thusmakingoursolutionpractical.WSECTXTTXTresourcerecordswereoriginallymeantforstoringdescriptivetextaboutdomainnames[19],butarenowwidelyusedtocarryinformationrelatedtotheSenderPolicyFramework(SPF)[24]tomitigatethespamemailsphenomenon.WewouldliketoemphasizethefactthatwildcardTXTrecordsintroducedforenablingWSECDNSqueriesdonotinterferewitheitherSPForsimpledescrip-tivetext.Becauseoflimitedspace,wediscussthedetailsofhowWSECDNSandSPFcaneasilycoexistin[22].Fur-thermore,in[22]wediscusshowtheWSECDNSqueryprocesscanhandlethosecornercasesinwhichintroducingwildcardTXTRRforenablingWSECDNSqueriesmaycreateconﬂictswithpreexistingwildcardCNAMERRinazone-ﬁle.3.3PositiveandNegativeWSECCachingImplementingtheWSECDNSqueryprocesswithoutaWSECcachingsystemwouldhavethesideeffectofdou-blingthevolumeofDNStrafﬁcontheInternetandtheaveragelatencybetweenusers’DNSqueriesandthere-latedanswer,duetothefactthatthe“handshake”betweentheRDNSandANSwouldhavetoberepeatedforeachquery.Inordertosolvetheseproblems,wecantakead-vantageoftheconceptsofpositiveandnegativecache,asexplainedinthefollowing.TheRDNSresolversthatintendtouseWSECDNSmustimplementapositiveandnega-tivecachethatstoresinformationaboutthezonesthatareorarenotWSEC-enabled(i.e.,whosezone-ﬁledoesordoesnotfollowtheconﬁgurationrequirementsdescribedinSec-tion3.1),respectively.WewilldescribetheWSECpositivecacheﬁrst,andafterwardswewilldescribetheWSECneg-ativecache.Forthesakeofsimplicity,weassumeherethatifacertainzoneisconﬁguredaccordingtoWSECspeciﬁ-cations,allitssub-zoneswillalsobeconﬁguredtosupportWSECDNS.Thisrestrictioncanbeeasilyrelaxed,asex-plainedin[22].AnentryoftheWSECpositivecacheshouldcontainthefollowinginformation:1)azonename;and2)atimetolive(TTL),afterwhichaTXTqueryfortheWSEChandshakeneedstobereissued.ThisinformationisconveyedbyaTXTresourcerecordsuchas:_test_._wsecdns_86400INTXT"|wsecdns=enabled|"forthezoneweareconsidering,asweexplainedinSection3.1.Forexample,thezoneexample.cominFigure1hasaTXTrecordofthiskind,withaTTLinsecondsequalto86400seconds(i.e.oneday).Therefore,theWSECpositivecacheentrywouldbe“example.comwsecdns=enabled86400”.OnceazonehasbeenstoredinthepositiveWSECcache,theRDNSwillnotperformtheWSEChandshakefordo-mainsinthatzone,untiltheTTLofthepositiveWSECcacheexpires.Therefore,assumingthezoneexample.comisinthepositiveWSECcache,thenexttimeahostqueriesforadomaininthatzone,saymail.example.comA?,becauseexample.comisinthepositiveWSECcachetheonlyqueryissuedbytheRDNSwilllooklike(cid:2)rand(cid:3).wsecdns.mail.example.comA?.There-fore,thepositivecachelimitstheincreaseinDNStrafﬁcduetotheWSEChandshake(seestep2inFigure2),be-causetheWSEChandshakehastobeattemptedonlyonceadayforagivenzone.BecauseWSECDNSdoesnotrequireeveryauthori-tativenameserver(ANS)ontheInternetanditszonestobeWSEC-enabled(someANSsmaydecidenottoin-creaseprotectionoftheirdomainsagainstpoisoningat-tacksatthecostofeditingtheirzone-ﬁles),somezonesmayneverbepresentinthepositiveWSECcache.There-fore,thiswouldcausetheRDNStoinitiatetheWSEChadshakeusingTXTqueries,thusdoublingthetrafﬁcto-wardsnon-WSEC-enabledANS.Toavoidthisproblem,RDNSresolversthatimplementWSECDNSarerequiredtoalsoimplementanegativeWSECcache.EachentryintheWSECnegativecacheshouldcontaintwopiecesofinformation:1)thenameofthenon-WSEC-enabledzone;and2)thenegativeentryTTL.Forexample,as-sumethezonevulnerabledns.comdecidesnottofol-lowtheWSECDNSconﬁgurationrecommendationsde-978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
9
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 05:38:34 UTC from IEEE Xplore.  Restrictions apply. 
scribedinSection3.1.Theﬁrsttimeauserqueriesforado-maininthatzone,saywww.vulnerabledns.com,theRDNSwillissuea(cid:2)rand(cid:3).test.wsecdns.www.vulnerabledns.comTXT?query,inordertoperformtheWSEChandshakeforthezone.Thisquerywillnotmatchanyentryinthezone-ﬁleforvulnerabledns.com,andthestring|wsecdns=enabled|willnotbereceivedbytheRDNS.Therefore,theRDNSwillstorethezonevulnerabledns.cominthenegativeWSECcache(onlyiftheRDNSreceivedanauthoritativere-sponsethatdidnotcomedirectlyfromarootorTLDnameserver,otherwiseitmeansthatthedomainisnotregisteredandtheRDNSwillsimplyreturnedNXDOMAINtothestub-resolver),andwillsimplyissuetheoriginalwww.vulnerabledns.comA?queryreceivedfromthehost.Atthispoint,theRDNSwillnotissueaWSEChandshake(aTXTquery)towardsanydomaininthevulnerabledns.comzoneuntiltheTTLofthenega-tivecacheentryexpires.TheTTLfortheentriesinthenegativeWSECcacheisaconﬁgurationparameterfortheRDNS,anditisrecommendedtobeatleastseveralhours.3.4ProtectingTLDNSEntriesWhenqueryingforadomainnameinaWSEC-enabledzone,besidesprotectingtheRDNS’scachefrompoisoningattacksagainstthequerieddomain,e.g.,www.example.com,WSECDNSnaturallyprotectstheRDNSfrompoi-soningofthetopleveldomain(TLD)nameservers.ThereasonisthattherandomWSECpreﬁx(seeSection3.2)willalwaysbepresentduringthequeryresolutionprocessforwww.example.com,includingduringtheinteractionbetweentheRDNSandtherootandTLDnameserversfordiscoveringtheauthoritativenameserver(ANS)forthequerieddomain.Thisprotectionmechanismdoesnotre-quiretherootandTLDnameserverstoexplicitlyenableWSECDNSqueriesthemselves.AnattackermayalsotrytopoisontheIPaddressofTLDnameserversintheRDNS’scachedirectly.Asanexample,assumetheattackerintendstopoisonthecacheofanRDNSbyinjectingamaliciousaddressforthenameserverA.GTLD-SERVERS.NET,whichisadelegation-onlynameserverforthe.comTLD.Wewouldliketoem-phasizethefactthatifthezoneGTLD-SERVERS.NETwasWSEC-enabled,theattackwouldnotsucceed,becausethequeriesinitiatedbytheattackerwouldbe“protected”bytheWSECpreﬁx(cid:2)rand(cid:3).wsecdns..However,weun-derstandthatrequiringchangesintheconﬁgurationofTLDnameserversmayencountertheresistanceoftheInternetcommunity,giventhespecialroleofsuchservers(requiringchangesattherootandTLDnameserversisoneofthemainreasonsthathavekeptDNSSECfrombeingdeployedandadoptedonalarge-scale).However,itispossibletoprotectTLDnameserversfrompoisoningwithneitherconﬁgura-tionnorsoftwarechangesattherootandTLDnameserverslevels.ThesolutionweproposeinvolvestheapplicationofasecureTLDcacheupdatepolicyforRDNSresolversincombinationwiththeuseofWSECrandompreﬁxes.Forexample,evenifthezoneGTLD-SERVERS.NETisnotWSEC-enabled,wecandefendA.GTLD-SERVERS.NETbynoticingthattheRDNS’s“standard”cachewillcontaintwopiecesofinformationaboutthedomainsinthatzone:1)A.GTLD-SERVERS.NETisanameserversforthecomTLD;and2)A.GTLD-SERVERS.NET’sIPaddress.AslegitimatechangesintheIPaddressofTLDnameserversareveryrare,iftheIPaddressofaTLDnameserverintheRDNS’scacheisabouttobeoverwrittenwithanewaddress(e.g.,becauseofapoisoningattack),theRDNScansimplyverifythereceivedinformationbyperform-inganadditionalquerytooneoftherootnameservers6.Forexample,beforeoverwritingtheIPaddressofA.GTLD-SERVERS.NETinthecache,theRDNSwillqueryoneoftherootnameserversfor(cid:2)rand(cid:3).wsecdns.com.Atthispointtherootserverwillrespondwiththelistofnameserversthathaveauthorityoverthecomzone[18,19],includingA.GTLD-SERVERS.NETanditscorrectIPaddress(asa“glue”record[18,19]).TheRDNSwillthencomparethisIPtotheattacker’sIP,noticethedifference,andthereforediscardtheattacker’sattempttooverwritethecacheentryforA.GTLD-SERVERS.NET.ThisveriﬁcationprocessaddsverylittleDNStrafﬁcbe-causeofthefactthatlegitimateeventsthatoverwritetheIPaddressofTLDnameserversintheRDNS’scacheareveryrareevents,andalsothenumberofdifferentTLDnameserversissmall.Therefore,unlessunderpoisoningattack,theRDNSwillneedtoinitiateaveriﬁcationprocessonlyinrarecases.Itisworthnotingthatgiventhepresenceofthe(cid:2)rand(cid:3)stringintheTLDveriﬁcationquery,poisoningaTLDnameservernowbecomespracticallyinfeasible(seeSection3.5).ThismeansthatWSEC-enabledzoneswillbeprotectedfrompoisoningattacksalongtheentireresolutionpathwithoutrequiringanyconﬁgurationchangeattherootandTLDnameservers.3.5RobustnesstoPoisoningAttacksLetΓxbethecardinalityofthesearchspaceintro-ducedbytechniquex.InthefollowingwewillassumeΓTXID=216(perfectrandomizationoftheTXID),andΓport=216−1024(i.e.,perfectrandomizationofalltheportsexcludingtheﬁrstusuallyreserved1024ports).Forthe0x20-bitencodingweconsiderthreecases,namely6ThelistofdomainnamesandIPaddressesfortherootnameserversarehardcodedintotheRDNSsoftware[18],andshouldbeupdatedonlybyupdatingtheRDNSsoftware,itslocalconﬁguration,orbyveryinfrequentqueries(e.g.,onceeveryseveralweeks)thatcannotbeforced/initiatedbytheattacker.Therefore,apoisoningattackinvolvingtherootnameserversshouldalwaysfail.978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
10
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 05:38:34 UTC from IEEE Xplore.  Restrictions apply. 