推荐序 ┃ IV
点击京东购买 点击当当购买
推荐序
近年来，在党和国家的高度重视下，网络安全行业发展迅猛，吸引了大批年轻学子和有志青年
投身其中。2015 年，“网络空间安全”正式成为“工学”门类下的一级学科，与此同时，不论是在
高校、还是企事业单位中，CTF 等类型的信息安全竞赛也开始蓬勃发展，通过竞赛涌现出了一大批
高手、能手。但是竞赛中各个模块间的发展程度却参差不齐。相对而言，Web、Misc 等模块发展较
快，参与的选手也较多；二进制安全相关模块，如 Reverse（逆向）、Mobile（此处指移动安全）等
模块的选手相对就少些，而其中的 Pwn 模块，则参赛选手最少。究其原因，主要是因为相对其他模
块，二进制安全相关模块的学习曲线更陡峭，要求选手对系统的理解更为深入。
市面上安全相关的书籍、教程汗牛充栋，与漏洞主题相关的却屈指可数。在这些书籍中，由于
作者本身都是从事漏洞发掘工作的，所以相关案例多以 Windows 平台下的各种软件漏洞为主，其他
平台为辅。但 Windows 平台本身内部实现机制就比较复杂，相关文档不多，且有的软件自身还会有
自己私有的内存管理方法（比如微软的 Office 软件），在开始学习相关技能之前，所需要掌握的相
关前置背景知识就够人喝一壶了。
本书另辟蹊径，利用历届的 CTF 真题，以 x86/x64 平台下 Linux 系统中的 Pwn 样题为例，讲述
漏洞利用的基本方法和技巧。由于 Linux 系统本身就是一个开源系统，相关文档也比较齐全，因此，
在这个平台上容易把问题讲透。把基本功练扎实了，再去学习其他平台上的漏洞利用技术，必将起
到事半而功倍的效果。此外，当前被广泛使用的 Android 等操作系统本身就是 Linux 系统的变种，相
关技术也很容易移植到这些系统的漏洞发掘利用中去。
本书的作者是业内后起之秀。书中所用的例子贴近 CTF 实战，讲解详尽，思路清晰，非常有助
于读者理解和学习。
本书的审校者——吴石老师率领的腾讯 eee 战队——曾多次斩获国内外高等级竞赛的大奖，相关
经验非常丰富。
本书为广大学子和从业人员学习漏洞利用技术知识提供了有益的指导。相信有志学习者，经过
推荐序 ┃ V
认真钻研，必能早日登堂入室，为我国网络安全事业的发展添砖加瓦。
崔孝晨
《Python 绝技：运用 Python 成为顶级黑客》、《最强 Android 书：架构大剖析》译者
序 ┃ VI
序
时间回到 2017 年 7 月。
随着信息安全的发展，CTF 竞赛开始引人关注。这种有趣的竞赛模式非常有助于技术切磋和快
速学习。在西电信安协会（XDSEC）学长的带领下，当时的我已经接触 CTF 赛题有较长时间了。由
于当时网上还没有比较完善和系统的资料，本着开源精神、自利利他的目的，我在 GitHub 上创建了
一个称为“CTF-All-In-One”的项目，并给了自己第 1 个 star。
此后，这个项目日渐完善，吸引和帮助了不少初学者，到现在已经收获了超过 2100 个 star，在
此向所有为技术分享与进步作出贡献的 CTF 出题人和项目贡献者们致敬！
收到刘皎老师的约稿邀请是在 2018 年 10 月，那时我刚上大四。抱着试试看的心情，我惊喜、
惶恐地接受了这项挑战。接下来就是定目录，交样章，并在 2019 年 1 月签订了《约稿合同》。没想
到的是，写作的道路竟如此艰难：每一章、每一节、每一个例子甚至每一个词都要细斟慢酌，生怕
误人子弟。由于学业和工作上的事情较多，最初参与的两个朋友相继离开了，我本人也多次想放弃。
就在这样反反复复的状态下，一直到 2020 年 7 月才完成初稿。经过几轮艰苦的校稿，终于在 2020
年 10 月签订了《出版合同》，两年时间就这样一晃过去了。
现在再回头看，本书写作的过程基本就是一个“现学现卖”的过程。我一边学习新知识，一边
不断调整内容框架。在学习的路上，我曾遇到太多的分岔、踩过无数坑，正因为如此，我尽量把自
己的经验写进书里，使读者可以快速获得关键技术、避免踩坑和重复劳动。所以，与其称它为一本
书，倒不如说这是一座经过校对、打磨，并最终以书的形式呈现的知识库。当然，在此过程中，我
也发现写作是一种非常有效的训练方式：很明显，通过梳理知识点和想法，我不仅系统掌握了相关
知识，也明确了思路，对从事相关工作大有裨益。
我们将此书命名为《CTF 竞赛权威指南（Pwn 篇）》，是期待有更多人参与进来，拿出 Web 篇、
Reverse 篇、Crypto 篇等更好的作品，让这个系列更配得上“权威”二字。信息安全是一门有趣的学
科，我为自己当初的选择高兴，也希望阅读本书的你，同样为自己的选择而激动。作为一本面向初
序 ┃ VII
学者的书，读者中一定有不少中学生。全国中学生网络安全竞赛每年都在我的母校西安电子科技大
学进行，迄今已是第三届，颇具规模。在此欢迎各位小读者报考母校的网络与信息安全学院，这里
真的是一个很棒的地方！
本书的出版，要感谢我的大学室友刘晋，他早期的帮助让这个项目得以成形；感谢腾讯的吴石
老师，他的推荐让本项目顺利成书、惠及更多的人；感谢吴石老师和腾讯 eee 战队的谢天忆、朱梦
凡、马会心和刘耕铭四位老师的建议与审校，让本书的内容更上一层楼；感谢学弟槐和 koocola，贡
献了本书第 11 章的初稿；感谢湖北警官学院的谈楚瑜和 MXYLR，以及其他来自 GitHub 的朋友的
鼓励和支持；感谢电子工业出版社的刘皎老师，她认真细致的工作使本书得以高质量地呈现给读者；
感谢我的父母给了我选择和发展的自由，让我在人生道路上没有后顾之忧；感谢那位不愿透露姓名
的朋友，遇见你曾是青春最美好的事！感谢你们！
杨超
2020 年 11 月于北京
目录 ┃ VIII
目录
第 1 章
CTF 简介........................................................................................................................................1
1.1
赛事介绍........................................................................................................................................1
1.1.1
赛事起源............................................................................................................................1
1.1.2
竞赛模式............................................................................................................................1
1.1.3
竞赛内容............................................................................................................................2
1.2
知名赛事及会议............................................................................................................................3
1.2.1
网络安全竞赛....................................................................................................................3
1.2.2
网络安全会议....................................................................................................................5
1.2.3
网络安全学术会议............................................................................................................6
1.3
学习经验........................................................................................................................................6
1.3.1
二进制安全入门................................................................................................................6
1.3.2
CTF 经验............................................................................................................................8
1.3.3
对安全从业者的建议........................................................................................................8
参考资料...............................................................................................................................................10
第 2 章
二进制文件...................................................................................................................................11
2.1
从源代码到可执行文件.............................................................................................................. 11
2.1.1
编译原理..........................................................................................................................11
2.1.2
GCC 编译过程.................................................................................................................12
2.1.3
预处理阶段......................................................................................................................13
2.1.4
编译阶段..........................................................................................................................14
2.1.5
汇编阶段..........................................................................................................................15
2.1.6
链接阶段..........................................................................................................................15
2.2
ELF 文件格式..............................................................................................................................16
2.2.1
ELF 文件的类型..............................................................................................................16
目录 ┃ IX
2.2.2
ELF 文件的结构..............................................................................................................18
2.2.3
可执行文件的装载..........................................................................................................24
2.3
静态链接......................................................................................................................................26
2.3.1
地址空间分配..................................................................................................................26
2.3.2
静态链接的详细过程...................................................................................................... 27
2.3.3
静态链接库......................................................................................................................29
2.4
动态链接......................................................................................................................................30
2.4.1
什么是动态链接..............................................................................................................30
2.4.2
位置无关代码..................................................................................................................31
2.4.3
延迟绑定..........................................................................................................................32
参考资料...............................................................................................................................................33
第 3 章
汇编基础...................................................................................................................................... 34
3.1
CPU 架构与指令集..................................................................................................................... 34
3.1.1
指令集架构......................................................................................................................34
3.1.2
CISC 与 RISC 对比......................................................................................................... 35
3.2
x86/x64 汇编基础........................................................................................................................36
3.2.1
CPU 操作模式................................................................................................................. 36
3.2.2
语法风格..........................................................................................................................36
3.2.3
寄存器与数据类型..........................................................................................................37
3.2.4
数据传送与访问..............................................................................................................38
3.2.5
算术运算与逻辑运算...................................................................................................... 39
3.2.6
跳转指令与循环指令...................................................................................................... 40
3.2.7
栈与函数调用..................................................................................................................41
参考资料...............................................................................................................................................44
第 4 章
Linux 安全机制............................................................................................................................45
4.1
Linux 基础................................................................................................................................... 45
4.1.1
常用命令..........................................................................................................................45
4.1.2
流、管道和重定向..........................................................................................................46
4.1.3
根目录结构......................................................................................................................47
4.1.4
用户组及文件权限..........................................................................................................47
4.1.5
环境变量..........................................................................................................................49
4.1.6
procfs 文件系统...............................................................................................................51
4.1.7
字节序..............................................................................................................................52
4.1.8
调用约定..........................................................................................................................53
4.1.9
核心转储..........................................................................................................................54
4.1.10
系统调用........................................................................................................................55
4.2
Stack Canaries.............................................................................................................................. 58
目录 ┃ X
4.2.1
简介..................................................................................................................................58
4.2.2
实现..................................................................................................................................61
4.2.3
NJCTF 2017：messager.................................................................................................. 63
4.2.4
sixstars CTF 2018：babystack.........................................................................................65
4.3
No-eXecute...................................................................................................................................69
4.3.1
简介..................................................................................................................................69
4.3.2
实现..................................................................................................................................70
4.3.3
示例..................................................................................................................................73
4.4
ASLR 和 PIE................................................................................................................................75
4.4.1
ASLR................................................................................................................................75
4.4.2
PIE....................................................................................................................................76
4.4.3
实现..................................................................................................................................77
4.4.4
示例..................................................................................................................................79
4.5
FORTIFY_SOURCE....................................................................................................................83
4.5.1
简介..................................................................................................................................83
4.5.2
实现..................................................................................................................................84
4.5.3
示例..................................................................................................................................86
4.5.4
安全性..............................................................................................................................89
4.6
RELRO.........................................................................................................................................90
4.6.1
简介..................................................................................................................................90
4.6.2
示例..................................................................................................................................90
4.6.3
实现..................................................................................................................................93
参考资料...............................................................................................................................................94
第 5 章
分析环境搭建.............................................................................................................................. 96
5.1
虚拟机环境..................................................................................................................................96
5.1.1
虚拟化与虚拟机管理程序.............................................................................................. 96
5.1.2
安装虚拟机......................................................................................................................97
5.1.3
编译 debug 版本的 glibc................................................................................................. 98
5.2
Docker 环境............................................................................................................................... 100
5.2.1
容器与 Docker............................................................................................................... 100
5.2.2
Docker 安装及使用....................................................................................................... 101
5.2.3
Pwn 题目部署................................................................................................................102
参考资料.............................................................................................................................................103
第 6 章
分析工具.................................................................................................................................... 104
6.1
IDA Pro.......................................................................................................................................104
6.1.1
简介................................................................................................................................104
6.1.2
基本操作........................................................................................................................105
目录 ┃ XI
6.1.3
远程调试........................................................................................................................108
6.1.4
IDAPython......................................................................................................................110
6.1.5
常用插件........................................................................................................................ 114
6.2