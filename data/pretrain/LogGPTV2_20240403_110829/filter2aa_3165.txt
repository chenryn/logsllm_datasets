### 破解手机游戏的乐趣
#### HITCON 2015
##### 主讲人：ChienWei Hung (winest)

---

**个人背景**
- 四年前加入趋势科技担任研究员
- 拥有22年的游戏经验
- 永远的β测试玩家

**自我介绍**
- 你可能不认识我，但我已经在趋势科技工作了四年，专注于研究和破解手机游戏。

---

**让我们聊聊手机游戏的破解**

**2014年营收排名**
- 来自App Annie的数据

| 排名 | iOS App Store | Google Play |
| --- | --- | --- |
| 1 | 台湾 | 日本 |
| 2 | 俄罗斯 | 美国 |
| 3 | 法国 | 韩国 |
| 4 | 德国 | 德国 |
| 5 | 加拿大 | 台湾 |
| 6 | 澳大利亚 | 英国 |
| 7 | 英国 | 法国 |
| 8 | 中国 | 香港 |
| 9 | 日本 | 澳大利亚 |
| 10 | 美国 | 加拿大 |

---

**破解等级**

- **LV. 0**: 破解、解锁已付费内容
- **LV. 1**: 限制条件
  - 设备已Root
  - 内存未加密
  - 程序验证较弱
  - Root检查
  - 已安装程序检查
  - 动作前后数值检查

- **LV. 2**: 
  - 解包APK文件
    ```bash
    java -jar apktool.jar d -f "apk_file" -o "output_folder"
    ```
  - 重新打包APK文件
    ```bash
    java -jar apktool.jar b "output_folder"
    java -jar signapk.jar "cert.pem" "key.pk8" "unsigned.apk" "signed.apk"
    ```

- **Bytecode的好处**
  - 可以直接查看源代码
    ```bash
    d2j-dex2jar -f "classes.dex" -o "output.jar"
    jd-gui "output.jar"
    ```

- **LV. 2 限制**
  - 未被混淆
  - 程序没有检查校验和
  - 主程序用Java编写

- **LV. 3**: 手机游戏架构
- **简易数值修改**
  - 解包APK文件
  - 反汇编到IL
    ```bash
    ildasm.exe /OUT=output.il /UTF8
    ```
  - 修改*.il文件
  - 重新汇编回dll
    ```bash
    ilasm.exe /DLL /OUTPUT=output.dll /RESOURCE=resource.res
    ```
  - 重新打包并签名APK文件

- **LV. 4**: 使用.NET Reflector配合Reflexil
- **LV. 5**: 使用Visual Studio进行定制修改
  - 自制工具调整偏移量
  - [CILTools GitHub](https://github.com/winest/CILTools)

**防御措施**
- 混淆
  - Android和Unity都有混淆工具，但很少有人使用
- 内容加密
- 合理范围检查
- 适可而止，否则两败俱伤 XD

---

**欢迎交流**
如果你符合以下条件：
- 我讲的内容你都懂
- 是各种游戏引擎或iOS专家
- 愿意提供1G RAM以上的iOS设备用于研究

欢迎来聊聊不一样的东西！

**感谢大家！**

---

**个人声明**

本人在此特地声明：
- 本人乐观开朗，身体健康，无任何使我困扰之慢性病或心理疾病，故绝不可能做出任何看似自杀之行为。
- 本人从无睡眠困扰，故不需服用安眠药。本人不酗酒亦不吸毒，也绝不会接近下列地点：
  1. 开放性水域
  2. 无救生员之游泳池
  3. 有高压、危险气体，或密闭式未经抽气处理之地下室、蓄水池、水桶等
  4. 无安全护栏之任何高处
  5. 任何施工地点（拆政府除外），包括制作消波块之工地
  6. 任何以上未提及但为一般人正常不会前往之地点

- 本人恪遵下列事项：
  1. 车辆上路前会检查刹车部件、油门线等，并会在加油前关闭车辆电源与行动电话。
  2. 绝不擅抢黄灯、闯红灯。
  3. 乘坐任何轨道类交通工具一定退到警戒线后一步以上，直到车辆停妥。
  4. 骑乘摩托车必戴安全帽；乘车必系安全带。
  5. 绝不接近任何会放射对人体有立即危害的辐射之场所或设备。
  6. 台风天不登山、不观浪、不泛舟。

- 本人将尽可能注意电器、瓦斯、火源、水源之使用。
- 本人居住之房屋均使用符合法规之电路电线，绝无电线走火之可能；也绝未在家中放置过量可燃性气体或液体。
- 浴室中除应有的照明外，不放置任何电器用品，并在睡觉前关闭除电灯、冰箱、电扇外的所有电器开关。
- 本人绝不会与随机的不明人士起冲突，并尽可能保护自我人身安全。

所以若各位在看完此声明之后，近期或将來发现本人不再上线，请帮我讨回公道，谢谢。