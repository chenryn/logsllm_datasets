# 【近邻推荐】解密"看了又看"和"买了又买"不管你有没有剁过手，你对"看了这个商品的还看了"这样的推荐形式一定不陌生。无论是猫还是狗，或者是其他电商网站，这样的推荐产品可以说是推荐系统的标配了。类似的还有，如点评标记类网站的"喜欢了这部电影的还喜欢了"，社交媒体网站的"关注了这个人还关注了"，这些都只是文案类似，动词不同而已。这样的推荐形式背后都是来自一个古老的推荐算法，叫做基于物品的协同过滤，通常也被叫作Item-Based，因为后者更容易搜索到相关的文章，所以被更多地提及。如果做推荐系统不知道"基于物品的协同过滤"，那等同于做程序员不懂得冒泡排序。这个朴素的算法，就像是乔峰大战聚贤庄所用的"太祖长拳"一样，简单直接有效，读过高中就懂，用得好也能够战倒绝大多数的武林豪杰。今天，我就来和你聊聊这个朴素的算法。
## 基于物品（Item-Based）的八卦 {#24.html#-item-based-}基于物品的协同过滤算法诞生于 1998 年，是由亚马逊首先提出的，并在 2001年由其发明者发表了相应的论文（ Item-Based Collaborative FilteringRecommendation Algorithms ）。这篇论文在 Google 学术上引用数已近 7000，并且在 WWW2016大会上被授予了"时间检验奖"，颁奖词是："这篇杰出的论文深深地影响了实际应用"。历经了15 年后仍然在发光发热，这个奖它显然受之无愧。虽然今天各家公司都在使用这个算法，好像它是一个公共资源一样，然而并不是这样，亚马逊早在1998 年，也就是论文发表的三年前就申请了专利。讲完了算法的八卦，开始说正事了。
## 基于物品（Item-Based）原理 {#24.html#-item-based-}在基于物品的协同过滤出现之前，信息过滤系统最常使用的是基于用户的协同过滤。基于用户的协同过滤首先计算相似用户，然后再根据相似用户的喜好推荐物品，这个算法有这么几个问题：1.  用户数量往往比较大，计算起来非常吃力，成为瓶颈；2.  用户的口味其实变化还是很快的，不是静态的，所以兴趣迁移问题很难反应出来；3.  数据稀疏，用户和用户之间有共同的消费行为实际上是比较少的，而且一般都是一些热门物品，对发现用户兴趣帮助也不大。和基于用户的不同，基于物品的协同过滤首先计算相似物品，然后再根据用户消费过、或者正在消费的物品为其推荐相似的，基于物品的算法怎么就解决了上面这些问题呢？首先，物品的数量，或者严格的说，可以推荐的物品数量往往少于用户数量；所以一般计算物品之间的相似度就不会成为瓶颈。其次，物品之间的相似度比较静态，它们变化的速度没有用户的口味变化快；所以完全解耦了用户兴趣迁移这个问题。最后，物品对应的消费者数量较大，对于计算物品之间的相似度稀疏度是好过计算用户之间相似度的。根据我在上一篇文章中所说，协同过滤最最依赖的是用户物品的关系矩阵，基于物品的协同过滤算法也不能例外，它的基本步骤是这样的：1.  构建用户物品的关系矩阵，矩阵元素可以是用户的消费行为，也可以是消费后的评价，还可以是对消费行为的某种量化如时间、次数、费用等；2.  假如矩阵的行表示物品，列表示用户的话，那么就两两计算行向量之间的相似度，得到物品相似度矩阵，行和列都是物品；3.  产生推荐结果，根据推荐场景不同，有两种产生结果的形式。一种是为某一个物品推荐相关物品，另一种是在个人首页产生类似"猜你喜欢"的推荐结果。不要急，稍后我会分别说。
### 计算物品相似度 {#24.html#-}前面较为笼统地说要计算物品之间的相似度，现在详细说说这块。从用户物品关系矩阵中得到的物品向量长什么样子呢？我来给你描述一下：1.  它是一个稀疏向量；2.  向量的维度是用户，一个用户代表向量的一维，这个向量的总共维度是总用户数量；3.  向量各个维度的取值是用户对这个物品的消费结果，可以是行为本身的布尔值，也可以是消费行为量化如时间长短、次数多少、费用大小等，还可以是消费的评价分数；4.  没有消费过的就不再表示出来，所以说是一个稀疏向量。接下来就是如何两两计算物品的相似度了，一般选择余弦相似度，当然还有其他的相似度计算法方法也可以。计算公式如下：]{.MathJax_Preview style="color: inherit; display: none;"} {.MathJax_Display style="text-align: center;"}``{=html}[[s]{#24.html#MathJax-Span-3 .mistyle="font-family: MathJax_Math-italic;"}[i]{#24.html#MathJax-Span-4.mistyle="font-family: MathJax_Math-italic;"}[m]{#24.html#MathJax-Span-5.mistyle="font-family: MathJax_Math-italic;"}[(]{#24.html#MathJax-Span-6.mo style="font-family: MathJax_Main;"}[i]{#24.html#MathJax-Span-7 .mistyle="font-family: MathJax_Math-italic;"}[,]{#24.html#MathJax-Span-8.mo style="font-family: MathJax_Main;"}[j]{#24.html#MathJax-Span-9 .mistyle="font-family: MathJax_Math-italic; padding-left: 0.191em;"}[)]{#24.html#MathJax-Span-10.mo style="font-family: MathJax_Main;"}[=]{#24.html#MathJax-Span-11 .mostyle="font-family: MathJax_Main; padding-left: 0.285em;"}[[[[[∑]{#24.html#MathJax-Span-15.mostyle="font-family: MathJax_Size1; vertical-align: 0em;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.108em, 1000.99em, 4.379em, -999.998em); top: -3.998em; left: 0em;"}[n]{#24.html#MathJax-Span-18.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}]{#24.html#MathJax-Span-17.mrow}]{#24.html#MathJax-Span-16.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.532em, 1000.52em, 4.144em, -999.998em); top: -4.468em; left: 1.038em;"}[k]{#24.html#MathJax-Span-21.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[=]{#24.html#MathJax-Span-22.mostyle="font-size: 70.7%; font-family: MathJax_Main;"}[1]{#24.html#MathJax-Span-23.mnstyle="font-size: 70.7%; font-family: MathJax_Main;"}]{#24.html#MathJax-Span-20.mrow}]{#24.html#MathJax-Span-19.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.391em, 1001.37em, 4.144em, -999.998em); top: -3.715em; left: 1.038em;"}]{style="display: inline-block; position: relative; width: 2.402em; height: 0px;"}]{#24.html#MathJax-Span-14.munderover}[[[R]{#24.html#MathJax-Span-27 .mistyle="font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1000.75em, 4.144em, -999.998em); top: -3.998em; left: 0em;"}[i]{#24.html#MathJax-Span-30.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[k]{#24.html#MathJax-Span-31.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}]{#24.html#MathJax-Span-29.mrow}]{#24.html#MathJax-Span-28.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; top: -3.856em; left: 0.755em;"}]{style="display: inline-block; position: relative; width: 1.461em; height: 0px;"}]{#24.html#MathJax-Span-26.msubsup}[∗]{#24.html#MathJax-Span-32 .mostyle="font-family: MathJax_Main; padding-left: 0.238em;"}[R]{#24.html#MathJax-Span-34.mistyle="font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1000.75em, 4.144em, -999.998em); top: -3.998em; left: 0em;"}[j]{#24.html#MathJax-Span-37.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[k]{#24.html#MathJax-Span-38.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}]{#24.html#MathJax-Span-36.mrow}]{#24.html#MathJax-Span-35.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; top: -3.856em; left: 0.755em;"}]{style="display: inline-block; position: relative; width: 1.508em; height: 0px;"}]{#24.html#MathJax-Span-33.msubsup style="padding-left: 0.238em;"}]{#24.html#MathJax-Span-25.mrow}]{#24.html#MathJax-Span-24 .texatomstyle="padding-left: 0.191em;"}]{#24.html#MathJax-Span-13.mrow}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.061em, 1006.5em, 4.426em, -999.998em); top: -4.751em; left: 50%; margin-left: -3.245em;"}[[[[[[[∑]{#24.html#MathJax-Span-43.mostyle="font-family: MathJax_Size1; vertical-align: 0em;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.108em, 1000.99em, 4.379em, -999.998em); top: -3.998em; left: 0em;"}[n]{#24.html#MathJax-Span-46.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}]{#24.html#MathJax-Span-45.mrow}]{#24.html#MathJax-Span-44.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.532em, 1000.52em, 4.144em, -999.998em); top: -4.468em; left: 1.038em;"}[k]{#24.html#MathJax-Span-49.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[=]{#24.html#MathJax-Span-50.mostyle="font-size: 70.7%; font-family: MathJax_Main;"}[1]{#24.html#MathJax-Span-51.mnstyle="font-size: 70.7%; font-family: MathJax_Main;"}]{#24.html#MathJax-Span-48.mrow}]{#24.html#MathJax-Span-47.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.391em, 1001.37em, 4.144em, -999.998em); top: -3.715em; left: 1.038em;"}]{style="display: inline-block; position: relative; width: 2.402em; height: 0px;"}]{#24.html#MathJax-Span-42.munderover}[[[R]{#24.html#MathJax-Span-55 .mistyle="font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1000.75em, 4.144em, -999.998em); top: -3.998em; left: 0em;"}[2]{#24.html#MathJax-Span-58.mnstyle="font-size: 70.7%; font-family: MathJax_Main;"}]{#24.html#MathJax-Span-57.mrow}]{#24.html#MathJax-Span-56.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.391em, 1000.43em, 4.144em, -999.998em); top: -4.327em; left: 0.755em;"}[i]{#24.html#MathJax-Span-61.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[k]{#24.html#MathJax-Span-62.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}]{#24.html#MathJax-Span-60.mrow}]{#24.html#MathJax-Span-59.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.391em, 1000.71em, 4.144em, -999.998em); top: -3.668em; left: 0.755em;"}]{style="display: inline-block; position: relative; width: 1.461em; height: 0px;"}]{#24.html#MathJax-Span-54.msubsup}]{#24.html#MathJax-Span-53 .mrow}]{#24.html#MathJax-Span-52.texatom style="padding-left: 0.191em;"}]{#24.html#MathJax-Span-41.mrow}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.061em, 1004.05em, 4.473em, -999.998em); top: -3.998em; left: 0.991em;"}−[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; font-family: MathJax_Main; top: -3.998em; left: -0.092em;"}[−[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; font-family: MathJax_Main; top: -3.998em; left: 3.391em;"}[−[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 0.379em;"}[−[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 0.896em;"}[−[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 1.367em;"}[−[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 1.885em;"}[−[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 2.402em;"}[−[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 2.873em;"}]{style="display: inline-block; position: relative; width: 4.049em; height: 0px;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.579em, 1004.05em, 3.908em, -999.998em); top: -4.845em; left: 0.991em;"}[[√]{style="font-family: MathJax_Size2;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(2.732em, 1001.04em, 4.802em, -999.998em); top: -3.998em; left: 0em;"}]{style="display: inline-block; position: relative; width: 5.085em; height: 0px;"}]{#24.html#MathJax-Span-40.msqrt}[[[[[∑]{#24.html#MathJax-Span-66 .mostyle="font-family: MathJax_Size1; vertical-align: 0em;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.108em, 1000.99em, 4.379em, -999.998em); top: -3.998em; left: 0em;"}[n]{#24.html#MathJax-Span-69.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}]{#24.html#MathJax-Span-68.mrow}]{#24.html#MathJax-Span-67.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.532em, 1000.52em, 4.144em, -999.998em); top: -4.468em; left: 1.038em;"}[k]{#24.html#MathJax-Span-72.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[=]{#24.html#MathJax-Span-73.mostyle="font-size: 70.7%; font-family: MathJax_Main;"}[1]{#24.html#MathJax-Span-74.mnstyle="font-size: 70.7%; font-family: MathJax_Main;"}]{#24.html#MathJax-Span-71.mrow}]{#24.html#MathJax-Span-70.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.391em, 1001.37em, 4.144em, -999.998em); top: -3.715em; left: 1.038em;"}]{style="display: inline-block; position: relative; width: 2.402em; height: 0px;"}]{#24.html#MathJax-Span-65.munderover}[[[R]{#24.html#MathJax-Span-78 .mistyle="font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1000.75em, 4.144em, -999.998em); top: -3.998em; left: 0em;"}[2]{#24.html#MathJax-Span-81.mnstyle="font-size: 70.7%; font-family: MathJax_Main;"}]{#24.html#MathJax-Span-80.mrow}]{#24.html#MathJax-Span-79.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.391em, 1000.43em, 4.144em, -999.998em); top: -4.327em; left: 0.755em;"}[j]{#24.html#MathJax-Span-84.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[k]{#24.html#MathJax-Span-85.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}]{#24.html#MathJax-Span-83.mrow}]{#24.html#MathJax-Span-82.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.391em, 1000.75em, 4.285em, -999.998em); top: -3.668em; left: 0.755em;"}]{style="display: inline-block; position: relative; width: 1.508em; height: 0px;"}]{#24.html#MathJax-Span-77.msubsup}]{#24.html#MathJax-Span-76 .mrow}]{#24.html#MathJax-Span-75.texatom style="padding-left: 0.191em;"}]{#24.html#MathJax-Span-64.mrow}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.061em, 1004.1em, 4.614em, -999.998em); top: -3.998em; left: 0.991em;"}−[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; font-family: MathJax_Main; top: -3.998em; left: -0.092em;"}[−[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; font-family: MathJax_Main; top: -3.998em; left: 3.438em;"}[−[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 0.379em;"}[−[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 0.896em;"}[−[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 1.414em;"}[−[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 1.932em;"}[−[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 2.402em;"}[−[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 2.92em;"}]{style="display: inline-block; position: relative; width: 4.096em; height: 0px;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.579em, 1004.1em, 3.908em, -999.998em); top: -4.798em; left: 0.991em;"}[[√]{style="font-family: MathJax_Size2;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(2.732em, 1001.04em, 4.802em, -999.998em); top: -3.951em; left: 0em;"}]{style="display: inline-block; position: relative; width: 5.132em; height: 0px;"}]{#24.html#MathJax-Span-63.msqrt}]{#24.html#MathJax-Span-39.mrow}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(2.685em, 1010.17em, 4.849em, -999.998em); top: -2.868em; left: 50%; margin-left: -5.08em;"}[[]{style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 10.308em; height: 0px;"}[]{style="display: inline-block; width: 0px; height: 1.085em;"}]{style="position: absolute; clip: rect(0.896em, 1010.31em, 1.226em, -999.998em); top: -1.315em; left: 0em;"}]{style="display: inline-block; position: relative; width: 10.308em; height: 0px; margin-right: 0.144em; margin-left: 0.144em;"}]{#24.html#MathJax-Span-12.mfrac style="padding-left: 0.285em;"}]{#24.html#MathJax-Span-2.mrow}[]{style="display: inline-block; width: 0px; height: 2.308em;"}]{style="position: absolute; clip: rect(0.614em, 1015.44em, 4.285em, -999.998em); top: -2.304em; left: 0em;"}]{style="display: inline-block; position: relative; width: 15.438em; height: 0px; font-size: 125%;"}[]{style="display: inline-block; overflow: hidden; vertical-align: -2.35em; border-left: 0px solid; width: 0px; height: 4.356em;"}]{#24.html#MathJax-Span-1.mathstyle="width: 19.296em; display: inline-block;"}``{=html}[$$sim(i,j) = \frac{\sum\limits_{k = 1}^{n}{R_{ik} \ast R_{jk}}}{\sqrt{\sum\limits_{k = 1}^{n}R_{ik}^{2}}\sqrt{\sum\limits_{k = 1}^{n}R_{jk}^{2}}}$$]{.MJX_Assistive_MathML.MJX_Assistive_MathML_Blockrole="presentation"}]{#24.html#MathJax-Element-1-Frame .MathJaxtabindex="0" style="text-align: center; position: relative;"mathml="sim(i,j)=∑k=1nRik∗Rjk∑k=1nRik2∑k=1nRjk2"role="presentation"}$$$$用文字解释一下这个公式：> 分母是计算两个物品向量的长度，求元素值的平方和再开方。分子是两个向量的点积，相同位置的元素值相乘再求和。很简单，因为这个公式出自中学数学课本，所以我刚才说读过高中就懂。这个公式的物理意义就是计算两个向量的夹角余弦值，相似度为 1时，对应角度是 0，好比时如胶似漆，相似度为 0 时，对应角度为 90度，毫不相干，互为路人甲。看上去计算量很大，貌似每一个求和的复杂度都是和向量维度、也就是用户数量一样的。但是别忘了，前面我说过他们都是稀疏向量，也就是向量中绝大多数值都是0，求和时不用算，点积时更不用算，甚至求点积时只用管两个物品的公共用户，只是少许几个乘积而已。物品之间的相似度计算是这个算法最可以改进的地方。通常的改进方向有下面两种。**1.物品中心化。**把矩阵中的分数，减去的是物品分数的均值；先计算每一个物品收到评分的均值，然后再把物品向量中的分数减去对应物品的均值。这样做的目的是什么呢？去掉物品中铁杆粉丝群体的非理性因素，例如一个流量明星的电影，其脑残粉可能会集体去打高分，那么用物品的均值来中心化就有一定的抑制作用。**2.用户中心化。**把矩阵中的分数，减去对应用户分数的均值；先计算每一个用户的评分均值，然后把他打过的所有分数都减去这个均值。这样做的目的又是什么呢？每个人标准不一样，有的标准严苛，有的宽松，所以减去用户的均值可以在一定程度上仅仅保留了偏好，去掉了主观成分。上面提到的相似度计算方法，不只是适用于评分类矩阵，也适用于行为矩阵。所谓行为矩阵，即矩阵元素为0 或者 1的布尔值，也就是在前面的专栏中讲过的隐式反馈。隐式反馈取值特殊，有一些基于物品的改进推荐算法无法应用，比如著名的Slope One 算法。``{=html}
### 计算推荐结果 {#24.html#-}在得到物品相似度之后，接下来就是为用户推荐他可能会感兴趣的物品了，基于物品的协同过滤，有两种应用场景。**第一种属于 TopK 推荐，形式上也常常属于类似"猜你喜欢"这样的。**出发方式是当用户访问首页时，汇总和"用户已经消费过的物品相似"的物品，按照汇总后分数从高到低推出。汇总的公式是这样的：]{.MathJax_Preview style="color: inherit; display: none;"} {.MathJax_Display style="text-align: center;"}``{=html}[[[[[[[[[[R]{#24.html#MathJax-Span-92.mistyle="font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1000.75em, 4.144em, -999.998em); top: -3.998em; left: 0em;"}[u]{#24.html#MathJax-Span-95.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[i]{#24.html#MathJax-Span-96.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}]{#24.html#MathJax-Span-94.mrow}]{#24.html#MathJax-Span-93.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; top: -3.856em; left: 0.755em;"}]{style="display: inline-block; position: relative; width: 1.508em; height: 0px;"}]{#24.html#MathJax-Span-91.msubsup}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1001.51em, 4.285em, -999.998em); top: -3.998em; left: 0em;"}[[\^]{#24.html#MathJax-Span-97.mostyle="font-family: MathJax_Main;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1000.38em, 3.626em, -999.998em); top: -4.28em; left: 0.473em;"}]{style="display: inline-block; position: relative; width: 1.508em; height: 0px;"}]{#24.html#MathJax-Span-90.munderover}]{#24.html#MathJax-Span-89 .mrow}]{#24.html#MathJax-Span-88.texatom}[=]{#24.html#MathJax-Span-98 .mostyle="font-family: MathJax_Main; padding-left: 0.285em;"}[[[[[∑]{#24.html#MathJax-Span-102.mostyle="font-family: MathJax_Size1; vertical-align: 0em;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.108em, 1000.99em, 4.379em, -999.998em); top: -3.998em; left: 0em;"}[m]{#24.html#MathJax-Span-105.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}]{#24.html#MathJax-Span-104.mrow}]{#24.html#MathJax-Span-103.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.532em, 1000.71em, 4.144em, -999.998em); top: -4.468em; left: 1.038em;"}[j]{#24.html#MathJax-Span-108.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[=]{#24.html#MathJax-Span-109.mostyle="font-size: 70.7%; font-family: MathJax_Main;"}[1]{#24.html#MathJax-Span-110.mnstyle="font-size: 70.7%; font-family: MathJax_Main;"}]{#24.html#MathJax-Span-107.mrow}]{#24.html#MathJax-Span-106.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.391em, 1001.27em, 4.285em, -999.998em); top: -3.715em; left: 1.038em;"}]{style="display: inline-block; position: relative; width: 2.308em; height: 0px;"}]{#24.html#MathJax-Span-101.munderover}s]{#24.html#MathJax-Span-113 .mistyle="font-family: MathJax_Math-italic;"}[i]{#24.html#MathJax-Span-114.mistyle="font-family: MathJax_Math-italic;"}[m]{#24.html#MathJax-Span-115.mistyle="font-family: MathJax_Math-italic;"}[(]{#24.html#MathJax-Span-116.mo style="font-family: MathJax_Main;"}[i]{#24.html#MathJax-Span-117 .mistyle="font-family: MathJax_Math-italic;"}[,]{#24.html#MathJax-Span-118.mo style="font-family: MathJax_Main;"}[j]{#24.html#MathJax-Span-119 .mistyle="font-family: MathJax_Math-italic; padding-left: 0.191em;"}[)]{#24.html#MathJax-Span-120.mo style="font-family: MathJax_Main;"}[∗]{#24.html#MathJax-Span-121 .mostyle="font-family: MathJax_Main; padding-left: 0.238em;"}[R]{#24.html#MathJax-Span-123.mistyle="font-family: MathJax_Math-italic;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.155em, 1000.75em, 4.144em, -999.998em); top: -3.998em; left: 0em;"}[u]{#24.html#MathJax-Span-126.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[j]{#24.html#MathJax-Span-127.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}]{#24.html#MathJax-Span-125.mrow}]{#24.html#MathJax-Span-124.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; top: -3.856em; left: 0.755em;"}]{style="display: inline-block; position: relative; width: 1.555em; height: 0px;"}]{#24.html#MathJax-Span-122.msubsup style="padding-left: 0.238em;"}]{#24.html#MathJax-Span-112.mrow}]{#24.html#MathJax-Span-111 .texatomstyle="padding-left: 0.191em;"}]{#24.html#MathJax-Span-100.mrow}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.061em, 1008.71em, 4.567em, -999.998em); top: -4.892em; left: 50%; margin-left: -4.374em;"}[[[∑]{#24.html#MathJax-Span-130.mostyle="font-family: MathJax_Size1; vertical-align: 0em;"}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.108em, 1000.99em, 4.379em, -999.998em); top: -3.998em; left: 0em;"}[m]{#24.html#MathJax-Span-133.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}]{#24.html#MathJax-Span-132.mrow}]{#24.html#MathJax-Span-131.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.532em, 1000.71em, 4.144em, -999.998em); top: -4.468em; left: 1.038em;"}[j]{#24.html#MathJax-Span-136.mistyle="font-size: 70.7%; font-family: MathJax_Math-italic;"}[=]{#24.html#MathJax-Span-137.mostyle="font-size: 70.7%; font-family: MathJax_Main;"}[1]{#24.html#MathJax-Span-138.mnstyle="font-size: 70.7%; font-family: MathJax_Main;"}]{#24.html#MathJax-Span-135.mrow}]{#24.html#MathJax-Span-134.texatom}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.391em, 1001.27em, 4.285em, -999.998em); top: -3.715em; left: 1.038em;"}]{style="display: inline-block; position: relative; width: 2.308em; height: 0px;"}]{#24.html#MathJax-Span-129.munderover}s]{#24.html#MathJax-Span-141 .mistyle="font-family: MathJax_Math-italic;"}[i]{#24.html#MathJax-Span-142.mistyle="font-family: MathJax_Math-italic;"}[m]{#24.html#MathJax-Span-143.mistyle="font-family: MathJax_Math-italic;"}[(]{#24.html#MathJax-Span-144.mo style="font-family: MathJax_Main;"}[i]{#24.html#MathJax-Span-145 .mistyle="font-family: MathJax_Math-italic;"}[,]{#24.html#MathJax-Span-146.mo style="font-family: MathJax_Main;"}[j]{#24.html#MathJax-Span-147 .mistyle="font-family: MathJax_Math-italic; padding-left: 0.191em;"}[)]{#24.html#MathJax-Span-148.mo style="font-family: MathJax_Main;"}]{#24.html#MathJax-Span-140.mrow}]{#24.html#MathJax-Span-139 .texatomstyle="padding-left: 0.191em;"}]{#24.html#MathJax-Span-128.mrow}[]{style="display: inline-block; width: 0px; height: 4.002em;"}]{style="position: absolute; clip: rect(3.061em, 1006.12em, 4.567em, -999.998em); top: -3.245em; left: 50%; margin-left: -3.104em;"}[[]{style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 8.849em; height: 0px;"}[]{style="display: inline-block; width: 0px; height: 1.085em;"}]{style="position: absolute; clip: rect(0.896em, 1008.85em, 1.226em, -999.998em); top: -1.315em; left: 0em;"}]{style="display: inline-block; position: relative; width: 8.849em; height: 0px; margin-right: 0.144em; margin-left: 0.144em;"}]{#24.html#MathJax-Span-99.mfrac style="padding-left: 0.285em;"}]{#24.html#MathJax-Span-87.mrow}[]{style="display: inline-block; width: 0px; height: 2.308em;"}]{style="position: absolute; clip: rect(0.473em, 1011.96em, 3.626em, -999.998em); top: -2.304em; left: 0em;"}]{style="display: inline-block; position: relative; width: 11.955em; height: 0px; font-size: 125%;"}[]{style="display: inline-block; overflow: hidden; vertical-align: -1.526em; border-left: 0px solid; width: 0px; height: 3.709em;"}]{#24.html#MathJax-Span-86.mathstyle="width: 14.967em; display: inline-block;"}``{=html}[$$\hat{R_{ui}} = \frac{\sum\limits_{j = 1}^{m}{sim(i,j) \ast R_{uj}}}{\sum\limits_{j = 1}^{m}{sim(i,j)}}$$]{.MJX_Assistive_MathML.MJX_Assistive_MathML_Blockrole="presentation"}]{#24.html#MathJax-Element-2-Frame .MathJaxtabindex="0" style="text-align: center; position: relative;"mathml="Rui^=∑j=1msim(i,j)∗Ruj∑j=1msim(i,j)"role="presentation"}$$$$这个公式描述一下，核心思想就和基于用户的推荐算法一样，用相似度加权汇总。要预测一个用户 u 对一个物品 i 的分数，遍历用户 u评分过的所有物品，假如一共有 m 个，每一个物品和待计算物品 i的相似度乘以用户的评分，这样加权求和后，除以所有这些相似度总和，就得到了一个加权平均评分，作为用户u 对物品 i 的分数预测。和基于物品的推荐一样，我们在计算时不必对所有物品都计算一边，只需要按照用户评分过的物品，逐一取出和它们相似的物品出来就可以了。这个过程都是离线完成后，去掉那些用户已经消费过的，保留分数最高的 k个结果存储。当用户访问首页时，直接查询出来即可。**第二种属于相关推荐，也就是我们今天专栏题目所指的场景。**这类推荐不需要提前合并计算，当用户访问一个物品的详情页面时，或者完成一个物品消费的结果面，直接获取这个物品的相似物品推荐，就是"看了又看"或者"买了又买"的推荐结果了。