此类攻击装备是攻击行动中最终植入到目标系统的载荷，用于持久化或非持久化对目标系统的控制。本次行动攻击者所使用的攻击装备如表3-3所示，其中前7项针对网络安全设备及网络设备，最后
1 项针对 Windows
主机系统。与持久化工具所追求的建立隐蔽的永久性入口不同，方程式组织在的控制/后门类恶意代码，更强调内存原子化模块加载作业，文件不落地，最大程度上减小被发现与提取的可能性。与持久化工具的组合，呈现出“藏于九地之下（固件等深层次未知），动于九天之上（内存）”的特点。
表 3 3攻击EastNets所使用的控制/后门攻击装备
DanderSpritz 是其中最典型的控制平台，拥有严密作业过程和丰富规避手段的模块化攻击平台，安天曾在《方程式组织 EQUATION DRUG
平台解析》[5]一文中对其进行了全面分析。DanderSpritz
拥有界面化的远程控制平台，具有复杂的指令体系和控制功能，与传统RAT程序有着明显的区别，一旦植入目标系统后会采集系统各类安全配置信息并提示攻击者哪些配置或信息可能会导致自身被发现或检测。其
payload
有多种连接模式，其中“Trigger”模式是一种激活连接模式，既不监听端口也不向外发出连接，而是通过监听流量等待攻击者的激活数据包，这使得控制端的部署变得灵活而难以被封禁。
图 3 5 DanderSpritz远程控制装备界面
DanderSpritz
具有模块化的架构设计，拥有非常丰富的标准化攻击工具和插件，是“方程式组织”网络武器代表。安天在此前分析报告中对“方程式组织”其他的木马模块插件进行梳理，整理了这些功能插件在攻击过程中可能形成的组合，并绘制了“方程式组织”主机作业模块积木图。该图初步展示了一个将主机情报作业按照“原子化”拆分的模块组合的拼装，如图3-6所示：
图 3 6 “方程式组织”主机作业模块积木图
在“方程式组织”主机作业模块积木图中可以看到，“方程式组织”通过模块化的方式涵盖了各个攻击阶段使用的武器。而每一个武器又有更细粒度的功能指令，比如创建据点阶段的“DoubleFantasy”武器就有分工明确的分支指令（如下图），不同指令之间相互配合可以完成一系列的操作行为。
图 3 7 DoubleFantasy指令分支
### **4、攻击过程复盘**
2012 年 7 月至 2013 年 9 月，“方程式组织”使用来自多个不同国家和地区的跳板 IP，对 EastNets 发起了 6
次网络攻击。攻击者通过先后 6 条不同的入侵路径相互配合，针对不同的系统和设备使用了包括“永恒”系列在内的多套攻击装备，最终攻陷了位于 EastNets
网络中的 4 台 VPN 防火墙设备、2 台企业级防火墙、2 台管理服务器，以及 9 台运行多国金融机构业务系统的 SAA 服务器和 FTP
服务器以及对外提供的邮件服务器。
图 4-1 “方程式组织”对EastNets网络的总体攻击过程复盘
##### **4.1 总体攻击过程**
从总体攻击上看，攻击者通过来自全球多个区域的跳板机器，使用多个 0Day 漏洞突破多台 Juniper SSG 和 CISCO
防火墙，然后植入持久化后门，使用“永恒”系列的 0Day 漏洞控制后续的内网应用服务器、Mgmt Devices(管理服务器) 和 SAA
服务器。除了突破防火墙，攻击者还突破了处于外网的邮件服务器，对外网的邮件服务器和同网段内的终端进行了扫描和信息搜集（如安全防护软件和应用软件安装情况）。在部分攻击过程中，虽然还存在一些诸如未能向终端植入持久化模块的失败操作，但通过多次入侵路径的先后配合，“方程式组织”最终还是完成了对
EastNets 网络全球多个区域的银行机构数据的窃取。
**攻击跳板：**
本次攻击所使用的互联网攻击跳板，均为被植入 PITCHIMPAIR 后门的商用 Unix、FreeBSD 或 linux
服务器主机，多数来自全球高校和科研机构。这些节点运行更多依靠系统自身的健壮性，和高校、科研机构人员的自我运维，而不像 Windows
环境一样，处于始终的高频对抗之中，反而推动了商用安全产品的保护能力的不断完善。对于超高能力网空威胁行为体来说，这种在商用安全能力感知之外的节点，反而成为一种理想的建立持久化跳板的目标。同时，由于这些服务器自身位于高校和科研机构，因此其并不简单的具备跳板价值，其本身也在不同时点会与直接情报获取活动产生直接关联，在不同形式和任务角色中，这些节点会被以不同的方式利用。2016
年 11 月影子经纪人曾公开一份遭受入侵的服务器清单，清单的日期显示 2000~2010 年间，以亚太地区为主的 49
个国家的相关教育、科研、运营商等服务器节点遭遇攻击，受影响的国家包括中国、日本、韩国、西班牙、德国、印度等。如图4-2。在相关爆料中，亦提及相关服务器可能是
Linux、FreeBSD 和 Solaris。这与方程式组织攻击EastNets所使用的跳板情况信息，形成了非常好的相互印证。
表 4 1“方程式组织”攻击EastNets网络使用的跳板机器
图 4-2：“方程式组织”在2000~2010年间对全球互联网节点的入侵可视化复现
总体攻击过程如下：
**步骤1：** 选择来自日本、德国、哈萨克斯坦和中国台湾的6台被入侵服务器作为跳板，利用 Juniper ScreenOS
软件的身份认证漏洞（CVE-2015-7755）攻击 EastNets 网络的 4 个 Juniper VPN 防火墙，攻击成功后向目标系统植入
FEEDTROUGH 持久化攻击装备到防火墙中，最后通过 FEEDTROUGH 向防火墙中植入 ZESTYLEAK 和 BARGLEE
两款后门攻击装备，实现对防火墙的完全控制。在其6次攻击中有2次是直接使用“永恒”系列漏洞攻击装备，向位于 DMZ
区域的邮件服务器进行攻击，并向内网进行扫描。
**步骤2：** 利用 EPICBANANA 或 EXTRABACON 漏洞攻击装备攻击 2 台 Cisco 企业级防火墙，攻击成功后向目标系统植入
JETPLOW 或 SCREAMINGPLOW，最后通过 JETPLOW 或 SCREAMINGPLOW 向防火墙系统植入
BANANAGLEE，实现对防火墙的完全控制。
**步骤3：** 利用“永恒”系列的 0Day 漏洞攻击两台管理服务器，攻击成功后向服务器系统植入 DoublePulsar 或
Darkpulsar，最后再通过 DoublePulsar 或 Darkpulsa r向服务器系统植入 DanderSpritz
平台生成的后门载荷（DLL），对其进行远程控制。
**步骤4：** 以 2 台管理服务器为跳板，利用“永恒”系列漏洞攻击装备获取后端的9台SAA业务服务器的控制权，使用的“永恒”系列漏洞包括
ETERNALROMANCE（永恒浪漫）、
ENTERNALCHAMPION（永恒冠军）、ETERNALSYNERGY（永恒协作）、ETERNALBLUE（永恒之蓝）。最后在 SAA 服务器上执行
SQL 脚本`initial_oracle_exploit.sql`和`swift_msg_queries_all.sql`，对本地 Oracle
数据库中存储的多家银行机构业务数据（账号名、账号状态、密码等）进行转储。还通过管理服务器对其它区域中的 FTP 服务器进行攻击。
##### **4.2 可视化复现**
根据上述总结分析，安天态势感知平台可视化组件对攻击行动的复现演示如图4-3所示。
图 4-3 安天态势感知平台可视化组件对攻击行动的复现演示点击查看攻击过程
### **5、网空威胁框架与本次事件的映射分析**
以“方程式组织”为代表的超高能力网空威胁行为体，具有庞大的攻击支撑工程体系、装备体系和规模化作业团队等特点，并在这些资源的支撑下，成功执行高度复杂的攻击活动。如果对类似攻击组织的分析停留在