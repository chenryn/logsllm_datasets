· RCE(远程命令/代码执行)  
....
#### 3.1.2.2 靶场下载
#### 3.1.2.3靶场安装
放到WWW目录下，然后在inc/config.inc.php中修改数据库名和密码  
访问  
安装成功  
## 3.2 手工测试
在Pikachu漏洞平台首页选择暴力破解|验证码绕过(on server)/(o client)。  
### 3.2.1验证码绕过(on server)
按照2.1的通用设计缺陷一个个进行测试。  
测试结果：验证码有验证、无回显，但存在验证码固定（可重复使用）的设计缺陷。  
以下为验证码固定问题测试过程和源码分析。
#### 3.2.1.1 测试过程
输入不正确的账户/密码及正确的验证码测试  
重复提交该数据包均只返回用户名或密码错误，说明存在验证码固定漏洞。  
所以我们可利用此漏洞绕过验证码直接对用户名和密码进行暴力破解。
#### 3.2.1.2源码分析
文件：\vul\burteforce\bf_server.php  
关键代码：  
在用户名、密码和验证码均不为空的情况下判断输入验证码是否与生成后保存在session中的验证码相同，但比较完后没有删除该session[vcode],导致下一个数据包输入该验证码也会判断正确，出现验证码重复使用问题。  
3.2.2验证码绕过(on client)  
按照2.1的通用设计缺陷一个个进行测试。  
测试结果：验证码有验证、无回显，在测试验证码固定（可重复使用）问题抓包时发现是通过前端JS判断验证码是否正确，在bp中测试发现存在删除验证码参数可绕过验证码判断的问题。  
以下为验证码固定问题测试过程和源码分析。
#### 3.2.2.1 测试过程
通过查看源码发现前端JS判断验证码是否正确，所以先输入正确的验证码绕过前端判断。  
输入不正确的账户/密码及验证码进行抓包测试。  
由于已经绕过前端js对验证码的判断，可以将请求包中的验证码参数删除。  
再将数据包发送到intruder对用户名和密码进行暴力破解即可。
## 3.3工具测试
### 3.3.1 PKAV HTTP Fuzzer
#### 3.3.1.1 工具介绍
pkav团队的神器PKAV HTTP Fuzzer可对图片验证码进行识别。  
不需要安装可直接运行，但运行需要安装.net framework 4.0或以上版本。
#### 3.3.1.2 测试过程
这里用PKAV HTTP Fuzzer对EmpireCMS_6.0进行测试。  
安装好后先登录后台页面修改后台验证码显示设置  
先用burpsuite抓取登录包，再将url和请求包复制到PKav->目标数据的相应位置  
设置变量和验证码  
然后添加变量的字典，设置重放方式  
由于该cms的验证码为图片验证码，所以我们再进入图片验证码识别进行设置。  
右键复制图片验证码链接地址，填写到验证码地址  
往下点击识别测试查看是否能识别  
再进入重放选项对线程、验证码长度进行设置，也可设置响应包字段匹配方便判断。  
最后进入发包器模块点击启动即可。  
### 3.3.2 Burp插件reCAPTCHA
#### 3.3.2.1插件介绍
#### 3.3.2.2插件安装
下载地址：  
安装：在Burpsuite中选择Extender->Extensions->Add，选择刚下载的reCAPTCHA.v0.8即可。  
在Proxy中右键出现Send to reCAPTCHA即安装成功。  
使用方法这里就不做介绍了
# 4.CMS实战演练
## 4.1CMSeasyv5.5删除cookie可绕过验证码
### 4.1.1 cms简介
CmsEasy是一款基于 PHP+Mysql 架构的网站内容管理系统，也是一个 PHP 开发平台。
采用模块化方式开发，功能易用便于扩展，可面向大中型站点提供重量级网站建设解决方案。2年来，凭借
团队长期积累的丰富的Web开发及数据库经验和勇于创新追求完美的设计理念，使得 CmsEasy v1.0
得到了众多网站的认可，并且越来越多地被应用到大中型商业网站。
### 4.1.2 测试环境
系统：win10  
PHPStudy：PHPv5.2.17+MYSQLv5.5.53  
CMS版本：CMSeasyv5.5
### 4.1.3 测试过程
访问  
使用正确账户密码+错误验证码尝试登录时，返回验证码错误  
删除cookie后返回登陆成功  
因此非管理员用户可通过删除cookie绕过验证码验证对用户名和密码进行爆破。
## 4.2 EmpireCMS_6.0验证码重复
### 4.2.1 CMS介绍
帝国网站管理系统(EmpireCMS)是目前国内应用最广泛的CMS程序。通过十多年的不断创新与完善，使系统集安全、稳定、强大、灵活于一身。目前EmpireCMS程序已经广泛应用在国内上百万家网站，覆盖国内上千万上网人群，并经过上千家知名网站的严格检测，被称为国内超高安全稳定的开源CMS系统。
### 4.2.2 测试环境
系统：win10  
PHPStudy：PHPv5.2.17+MYSQLv5.5.53  
CMS版本：EmpireCMS_6.0
### 4.2.3安装CMS
访问  
安装好后先登录后台页面修改后台验证码显示设置，步骤如图  
然后拉到最下方保存设置，退出登录
### 4.2.4测试过程
第一步，输入正确信息点击登录时抓包  
第二步，通过修改imageField参数的大小来实现暴力提交，自设一个两位数数字字典作为payload  
第三步，查看任意响应包是否登录成功  
从结果来看，暴力重复提交的数据包均登录成功，说明存在验证码重复使用的问题。  
经过暴力重复提交后，后台显示登陆成功。  
# 5.修复建议
## 5.1使用安全性强的验证码
验证码应从以下方面保证其安全性：验证码长度不低于4位，至少同时包含数字、字母或汉字，增加干扰因素比如线条，避免使用容易被程序自动识别的验证码。
## 5.2 验证码不应由客户端生成或返回到客户端
## 5.3 系统在开发时注意验证识别后销毁session中的验证码。
## 5.4限制用户提交的验证码不能为空
## 5.5 短信验证码不少于6位；有效期不超过1分钟；验证码错误次数超过上限应采取账户锁定策略。