0
500
1000
Noise Index
(a) Rand
500
1000
Noise Index
(c) FM
C
J
∆
0.8
0.6
0.4
0.2
0
−0.2
0
1
F
∆
0.8
0.6
0.4
0.2
0
−0.2
0
500
1000
Noise Index
(b) Jaccard
500
1000
Noise Index
(d) F1
Figure 4: VAMO vs. Majority Voting (index “deltas”).
that the noise (through label ﬂips and/or missing labels) will affect
exactly x out of the three AVs, for a given malware sample. Notice
that p1 + p2 + p3 = 1, and pf + pm ≤ 1. Namely, with probability
1 − (pf + pm) a sample will not be affected by any noise (i.e., the
sample remains perfectly labeled).
6.1.3 Building a Reference Clustering via Majority
Voting
Intuitively, the majority voting-based approach to construct a ref-
erence clustering works as follows. Given a malware sample mi ∈
M, and the label vector Li = (l1,i, l2,i, l3,i) ∈L M containing the
malware family labels assigned to mi by the three AVs, mi is as-
signed to malware cluster Rj if the majority of labels in Li indicate
that mi belongs to family fj. If no majority-based consensus can
be reached (i.e., the majority of AVs disagree on the family name
attributed to mi), then the sample mi is assigned to a singleton
cluster, namely a cluster that contains only mi. Following this ap-
proach, we can partition the dataset M into a set of majority voting-
based reference clusters RcM V = {RcM V
Then, given RcM V and the ground truth clusters C = {C1, ..., Cs}
(which are derived before injecting the noise into the AV labels), we
can compute the four external validity indexes described in Sec-
tion 3.2.
, ..., RM V
}.
q
, RM V
2
1
6.1.4 Computing the Validity Indexes
Let n be a particular noise vector, with a given combination of
values for the probabilities pf , pm, p1, p2, and p3. Applying the
noise injection approach described above results in a noisy label
dataset L(n).
In turn, if from L(n) we only consider the labels
related to the malware samples in M, we can obtain a (noisy) la-
bel dataset LM (n) (notice that because M ⊂A , then LM (n) ⊂
L(n)).
Given L(n) and LM (n), we apply VAMO to compute four va-
lidity indexes (see Figure 1), thus essentially measuring the level of
agreement (see Section 4) between the reference clustering derived
from the AV Label Graph learned from L(n), and the ground truth
clusters C = {C1, C2, ..., Cs} in which M was originally parti-
tioned (i.e., before any noise was applied). Let RSV AM O(n) be the
resulting Rand statistic, JC V AM O(n) be the Jaccard coefﬁcient,
F M V AM O(n) be the Folkes-Mallows index, and F 1V AM O(n) be
the F1 index that combines precision and recall (see Section 3.2).
We similarly compute these four external cluster validity indexes
by ﬁrst applying the majority voting-based approach described in
Section 6.1.3 over M(n) to obtain a reference clustering RcM V (n),
and then comparing this reference clustering to C. Let RSM V (n)
be the resulting Rand statistic, JCM V (n) be the Jaccard coefﬁ-
cient, F M M V (n) be the Folkes-Mallows index, and F 1M V (n) be
the F1 index. Now, for each value of n we compute the difference
between the validity indexes obtained using VAMO and the ones
based on the majority voting approach. For example, we compute
∆RS(n) = RSV AM O(n) − RSM V (n), and in a similar way we
also compute ∆JC(n), ∆F M (n), and ∆F 1(n).
6.1.5 Results
Figure 3 reports the absolute values of the cluster validty indexes
obtained using VAMO, while Figure 4 plots the difference between
the four external validity indexes produced by the comparison be-
tween VAMO’s results and the majority voting approach, as ex-
plained above. In Figure 3, the y axis reports the absolute value of
the indexes, while in Figure 4 it reports the “deltas”. In both cases,
the x axis is simply the index of the experiment round, with the
noise increasing per each experiment 5. Speciﬁcally, we use 1,320
different noise conﬁgurations (i.e., different values of the elements
of the noise vector n), with the only constraint that pf + pm ≤ 0.5,
i.e., at most 50% of the malware samples will be affected by some
noise in their AV labels. It is also worth noting that the y axis for
∆RS varies in [−0.02, 0.08], while all other “deltas” graphs have
values on the y axis in [−0.2, 0.8].
Figure 4(a) shows that the difference between RSV AM O and
RSM V are relatively small, and ∆RS varies between −0.02 and
0.06. However, the three remaining validity indexes (Figure 4(b)
through Figure 4(d)) clearly show that VAMO’s reference cluster-
ing agrees more closely with the underlying true clustering C, com-
pared to the majority voting-based reference clustering. In fact, in
all four indexes the “deltas” are positive for the vast majority of the
noise combinations, meaning that the quality indexes obtained by
VAMO show a better agreement with the true clustering, compared
to the quality indexes obtained via majority voting.
To better analyze the effect of the noisy AV labels, Figure 5
through Figure 8 present the validity index “deltas” considering all
noise vectors n for which: (a) at least two AVs are affected by
noise, i.e., p1 = 0; (b) the only type of noise affecting the labels is
the “label ﬂips”, i.e., pm = 0 (no missing labels, which means that
all the AVs assign a malware family label to all samples); (c) the
5The experiment rounds are ordered according to a summary noise
level computed as nl = (0.6pf +0.4pm)·(0.1p1 +0.3p2 +0.6p3).
l
0.10
0.20
0.30
0.31
0.32
0.33
0.34
0.35
0.36
0.37
0.38
0.39
0.40
0.50
0.60
0.70
0.80
clusters
674
451
313
301
291
288
286
280
274
261
255
248
241
187
142
113
85
Rand
0.8767
0.9172
0.9205
0.9792
0.9790
0.9759
0.9759
0.9758
0.9757
0.9721
0.9721
0.9722
0.9721
0.9585
0.9260
0.8527
0.7789
Jaccard
0.2086
0.5438
0.5777
0.8924
0.8916
0.8782
0.8782
0.8775
0.8772
0.8614
0.8613
0.8623
0.8617
0.8081
0.7070
0.5614
0.4659
Folkes-Mallows
0.4494
0.7308
0.7482
0.9434
0.9430
0.9357
0.9357
0.9353
0.9352
0.9265
0.9265
0.9270
0.9268
0.8971
0.8366
0.7354
0.6656
F1
0.7100
0.7918
0.7948
0.8436
0.8431
0.8501
0.8496
0.8479
0.8467
0.8433
0.8424
0.8421
0.8401
0.7937
0.7489
0.7260
0.7124
Table 2: Application of VAMO to behavior-based malware clus-
tering results.
only type of noise is “missing labels”, i.e., pf = 0 (no label ﬂips).
As we can see, whenever the label noise (or inconsistencies) affects
a majority of AVs (case (a)), or when any AV misses to detect some
malware samples (case (c)), VAMO clearly outperforms the major-
ity voting-based approach, because VAMO’s reference clustering
more closely agrees with the true malware clusters. While the “la-
bel ﬂips” (i.e., case (b), which simulates the scenario in which AVs
assign the incorrect malware family name) have a more negative
effect on VAMO because they more heavily affect the edges (and
their weights) learned through the AV Label Graph, VAMO per-
forms comparably to majority voting, as shown by the very small
negative “deltas”.
6.2 Real-World Application
In this Section, we discuss how VAMO can be applied in prac-
tice to assess the quality of the results produced by malware clus-
tering systems. Speciﬁcally, we apply VAMO to the results that
the behavior-based malware clustering system presented in [2] pro-
duced over a real-world malware dataset M containing 2,026 dis-
tinct malware samples collected in February 2009. To obtained
the behavior-based clustering we proceeded as follows. We pro-
vided all malware samples in M to the authors of [2], who kindly
agreed to analyze them and provide us a distance matrix D contain-
ing the pair-wise distances between the samples computed based
on their system-level behavioral features. Given, D, we applied
precise average-linkage hierarchical clustering (this step is slightly
different from [2], in which the authors applied an approximate hi-
erarchical clustering algorithm), and obtained a dendrogram, which
we will refer to as Y in the following. As usual, the dendrogram Y
can be cut at a given height to obtain a partitioning of dataset M
into a number of malware clusters (see discussion below).
To generate VAMO’s AV Label Graph, we used a dataset A con-
sisting of 998,104 real-world distinct malware samples collected
between August 2008 and August 2009. All of these 998,104 sam-
ples were scanned using four different popular AVs, in a way anal-
ogous to the malware dataset we discussed in Section 3.1, to obtain
the label dataset L. Each sample in this dataset was assigned at
least one AV label. Also, L contained the labels for most of the
2,026 samples in M. Speciﬁcally, L included at least one label
for 1,985 samples in M, while the remaining 41 samples were not
represented in L, and therefore remained unlabeled.
Taking the labeled dataset A and the labels for the samples in
dataset M (including the placeholder “unknown” labels for the 41
samples that remained undetected) as input, we applied VAMO to
produce a reference clustering, following the procedure outlined in
S
R
∆
0.08
0.06
0.04
0.02
0
−0.02
0
50
100
150
200
250
Noise Index
(a) F & M (> 1 AV)
S
R
∆
0.08
0.06
0.04
0.02
0
−0.02
0
100
200
300
Noise Index
(b) Only Flips
S
R
∆
0.08
0.06
0.04