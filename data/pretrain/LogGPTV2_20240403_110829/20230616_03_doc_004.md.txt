PostgreSQL
用户与 对应关系
schema
Objectives
• Schema概念
• 用户与schema对应关系
• Public schema
• Schema管理
（模式）
Schemas
• 什么是schema（模式）？
Ø 用户对象的集合叫做模式。比如：scott用户下有表emp、dept、salgrade等，还有几个
索引，还有一些约束等等，那么scott用户下所有对象的集合就叫scott模式。
Ø 可以把用户下拥有的对象根据业务分类，不同的对象存放在不同的模式下。
Ø 新建的数据库默认会创建不同的模式来管理对象。比如：information_schema、
pg_catalog、pg_temp_1、pg_toast、pg_toast_temp_1、public 等。
Ø 不同的schema下可以有相同名字的表、函数等对象，互相之间是不冲突的。只要有权
限，每个schema的对象是可以互相调用的。
用户与模式的对应关系
• 一个用户可以创建与拥有多个模式。
• 一个模式只能属于一个用户。
• 普通用户创建模式时需要授权在指定的数据库下创建模式的权限。
GRANT { { CREATE | CONNECT | TEMPORARY | TEMP } [, ...] | ALL [ PRIVILEGES ] }
ON DATABASE database_name [, ...]
TO role_specification [, ...] [ WITH GRANT OPTION ]
模式管理
• 授权
GRANT CREATE ON DATABASE testdb TO u1;
• 创建模式
create schema sport;
create schema art;
• 查看模式
testdb=> \dn
List of schemas
Name | Owner
--------+----------
art | u1
public | postgres
sport | u1
模式管理
• Schema管理
授权某个模式下的对象访问权限给其它用户，则需要先授权访问该模式的权限给其
它用户。
GRANT USAGE ON SHEMA sch_name TO role_name
;
GRANT SELECT ON sch_name.tab_name TO role_name;
模式管理
• Schema管理
--删除模式，模式只能由其拥有者或超级用户删除
drop schema schema_name
;
--删除模式时同时删除所依赖的对象
drop schema chema_name cascade;
模式
Public
• 初始化数据库时会自动创建一个Public模式，共享给所有用户使用，任何用户都可
以把对象创建在该模式下，由于PostgreSQL下一个用户对应多个模式，创建用户
时没有创建对应的默认模式，而对象都是基于模式管理的，所以创建一个公用的
模式public。
• 基于数据库安全考虑，可以删除public模式（可选）。
模式使用建议
• Oracle数据库一个用户对应一个模式，且名字一样。
• PostgreSQL数据库可以规划成一个用户对应多个模式。
• 基于简化管理的目的，可以规划成一个用户对应一个与用户名一样的模式。
搜索路径设置
• 默认搜索路径
postgres=# show search_path;
search_path
-----------------
"$user", public
• 设置搜索路径
set search_path="$user", public,scott;
• \d命令搜索规律
如果在前面的搜索路径中找到对象，则会放弃后面模式的搜索。
总结
• Schema概念
• 用户与schema对应关系
• Public schema
• Schema管理
练习
• 1、在一个数据库中创建多个schema s1,s2,s3, 在每个schema中都创建一个同名的表
tbl(结构不同), 请设置search_path参数, 当查询tbl时, 默认按s2,s1,s3,public,$username的
顺序搜索其中的表.