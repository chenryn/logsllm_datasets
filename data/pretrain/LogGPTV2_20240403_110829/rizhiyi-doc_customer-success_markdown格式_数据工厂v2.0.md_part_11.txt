| Function**        |                                                  |
+===================+==================================================+
| Average           | count - 计算中包含的值的数量。                   |
|                   |                                                  |
|                   | total - 计算中使用的总数。                       |
|                   |                                                  |
|                   | average - 计算结果。                             |
+-------------------+--------------------------------------------------+
| Count             | count -计算结果。                                |
+-------------------+--------------------------------------------------+
| Max               | max -计算结果。                                  |
+-------------------+--------------------------------------------------+
| Min               | min -计算结果。                                  |
+-------------------+--------------------------------------------------+
| Stddev            | total - 计算中使用的总数。                       |
|                   |                                                  |
|                   | count - 计算中使用的值的数量。                   |
|                   |                                                  |
|                   | totalSquare - 总数的平方。                       |
|                   |                                                  |
|                   | stdDev - 计算结果。                              |
+-------------------+--------------------------------------------------+
| Sum               | sum - 计算结果。                                 |
|                   |                                                  |
|                   | count - 计算中包含的值的数量。                   |
+-------------------+--------------------------------------------------+
2、所有聚合事件
您可以配置Windowing
Aggregator处理器以创建包含所有已配置聚合的结果的所有聚合事件。
事件生成的频率取决于所选的窗口类型和时间窗口。
单个聚合事件将sdc.event.type设置为\
.window.all.aggregators并包含聚合列表。
每个聚合列表项是包括与上述单个聚合事件相同的字段的映射字段。
要生成所有聚合事件，请配置以下两个属性：
-   在"常规"选项卡上，选择"Produce Events生成事件"。
-   在"事件"选项卡上，选择"All Aggregators Events所有聚合器事件"。
##### 监控聚合
除标准阶段统计信息外，Windowing
Aggregator处理器还提供了汇总图表，您可以在运行管道时监控这些汇总图表。处理器使用指定的图表名称标题为每个聚合生成一个图表。
图表的内容和显示取决于聚合和阶段属性。例如，在按表达式使用组时，图表会显示每个组的栏。
使用滑动窗口时，图表会显示上次更新图表的日期和时间。
使用滚动窗口时，图表包含基于"Number of Time Windows to Remember"
要记住的Windows时间数属性的多个时间窗口的结果。图表显示时间窗口关闭的日期和时间。最近的时间窗口正在进行中，当处理器继续在时间窗口内聚合数据时显示最新的详细信息。
例如，假设您有一个使用滚动窗口和30秒时间窗口的Windowing
Aggregator处理器。它配置为记住三个时间窗口并使用以下聚合来执行所有销售的总和，使用过滤器来排除退货：
![https://streamsets.com/documentation/datacollector/latest/help/datacollector/UserGuide/Graphics/Aggregator-Sum.png](media/image87.png){width="4.359292432195976in"
height="3.111399825021872in"}
处理器生成以下"总销售额"图表：
![https://streamsets.com/documentation/datacollector/latest/help/datacollector/UserGuide/Graphics/Aggregator-SumChart.png](media/image88.png){width="5.763888888888889in"
height="1.3753947944007in"}
注意，聚合函数SUM（双精度）显示在图表的左侧，每个时间段的末尾显示在每个条形下方。您可以看到时间窗口之间的间隔为30秒，如阶段中所配置。
第三个时间窗口的结果似乎很低，但这是因为时间窗口仍处于活动状态-计算正在进行中，并且结果将更新直到时间窗口关闭。像其他Data
Collector 图表一样，当您将鼠标悬停在特定部分上时，会显示相关详细信息。在这种情况下，"值"是在时间窗口中发生的销售总额。
在同一Windowing
Aggregator处理器中，您可以使用以下聚合配置来确定销售和退货计数。通过表达式分组可以对每种交易类型进行计数：
![https://streamsets.com/documentation/datacollector/latest/help/datacollector/UserGuide/Graphics/Aggregator-Count-Group.png](media/image89.png){width="5.7625in"
height="3.504861111111111in"}
在生成的"交易类型"图表中，COUNT函数显示在左侧，单独的条形表示退货和销售组：
![https://streamsets.com/documentation/datacollector/latest/help/datacollector/UserGuide/Graphics/Aggregator-CountChart-GroupBy.png](media/image90.png){width="5.763888888888889in"
height="1.3444444444444446in"}
要查看Windowing
Aggregator图表和统计信息，请在Monitor模式下查看管道，然后选择Windowing
Aggregator处理器。
##### 配置窗口聚合器
配置Windowing Aggregator处理器以在时间窗口内执行聚合。
(1)在"属性"面板的"常规"选项卡上，配置以下属性：
+---------------+------------------------------------------------------+
| **常规属性**  | **说明**                                             |
+===============+======================================================+
| 名称          | 阶段名称                                             |
+---------------+------------------------------------------------------+
| 说明          | 可选说明                                             |
+---------------+------------------------------------------------------+
| [Required     | 必须包含要传递到阶段的记录的数据的字段。             |
| Fie           |                                                      |
| lds](https:// | 提示：您可以包括阶段使用的字段。                     |
| streamsets.co |                                                      |
| m/documentati | 不包括所                                             |
| on/datacollec | 有必需字段的记录将根据为管道配置的错误处理进行处理。 |
| tor/latest/he |                                                      |
| lp/datacollec |                                                      |
| tor/UserGuide |                                                      |
| /Pipeline_Des |                                                      |
| ign/DroppingU |                                                      |
| nwantedRecord |                                                      |
| s.html#concep |                                                      |
| t_dnj_bkm_vq) |                                                      |
+---------------+------------------------------------------------------+
| [Preconditi   | 必须计算为true才能允许                               |
| ons](https:// | 记录进入处理阶段的条件。单击添加以创建其他前提条件。 |
| streamsets.co |                                                      |
| m/documentati | 不满足所                                             |
| on/datacollec | 有前提条件的记录将基于为阶段配置的错误处理进行处理。 |
| tor/latest/he |                                                      |
| lp/datacollec |                                                      |
| tor/UserGuide |                                                      |
| /Pipeline_Des |                                                      |
| ign/DroppingU |                                                      |
| nwantedRecord |                                                      |
| s.html#concep |                                                      |
| t_msl_yd4_fs) |                                                      |
+---------------+------------------------------------------------------+
| [On Record    | 阶段的错误记录处理：                                 |
| Error         |                                                      |
| ](https://str | 丢弃-丢弃记录。                                      |
| eamsets.com/d |                                                      |
| ocumentation/ | 发送到错误-将记录发送到管道以进行错误处理。          |
| datacollector |                                                      |
| /latest/help/ | 停止管道-停止管道。                                  |
| datacollector |                                                      |
| /UserGuide/Pi |                                                      |
| peline_Design |                                                      |
| /ErrorHandlin |                                                      |
| g.html#concep |                                                      |
| t_atr_j4y_5r) |                                                      |
+---------------+------------------------------------------------------+
(2)在"聚合"选项卡上，配置以下属性：
+----------------+-----------------------------------------------------+
| **Aggregation  | **说明**                                            |
| Property**     |                                                     |
+================+=====================================================+
| Window         | 要使用的窗口类型：                                  |
| Ty             |                                                     |
| pe ![https://s | •滚动 - 根据小时定期计算聚合。                      |
| treamsets.com/ |                                                     |
| documentation/ | •滑动 - 根据最新的数据间隔计算聚合。                |
| datacollector/ |                                                     |
| latest/help/da |                                                     |
| tacollector/Us |                                                     |
| erGuide/Graphi |                                                     |
| cs/icon_moreIn |                                                     |
| fo.png](media/ |                                                     |
| image81.png){w |                                                     |
| idth="0.127083 |                                                     |
| 33333333333in" |                                                     |
| hei            |                                                     |
| ght="0.1270833 |                                                     |
| 3333333333in"} |                                                     |
+----------------+-----------------------------------------------------+
| Time Window    | 要包含在聚合中的记录的时间窗口。                    |
|                |                                                     |
|                | 对于滚动窗口，时间窗口还确定处理                    |
|                | 器何时在监控模式下更新图表以及处理器何时生成事件。  |
|                |                                                     |
|                | 对于滑动窗                                          |
|                | 口，时间窗口仅确定要包含在聚合中的记录的时间窗口。  |
|                | 图表和事件是单独生成的。                            |
+----------------+-----------------------------------------------------+
| Time Zone      | 用于建立时间窗口的时区。                            |
+----------------+-----------------------------------------------------+
| Number of Time | 在监控模式下显示的时间窗口数。 仅用于滚动窗口。     |
| Windows to     |                                                     |
| Remember       |                                                     |
+----------------+-----------------------------------------------------+
| Aggregations   | 要执行的聚合计算。                                  |
|                | 要配置其他聚合，请单击"添加"图标。                  |
+----------------+-----------------------------------------------------+
| Enabled        | 启用聚合。                                          |
|                | 清除此选项可禁用聚合，同时保留聚合以供将来使用。    |
+----------------+-----------------------------------------------------+
| Name           | 聚合名称。 指定处理器中唯一的聚合名称。             |
+----------------+-----------------------------------------------------+
| Aggregation    | 聚合标题。 用于为聚合生成的图表的标题。             |
| Title          |                                                     |
+----------------+-----------------------------------------------------+
| Filter         | 允许创建过滤器表达式。                              |
+----------------+-----------------------------------------------------+
| Filter         | 过滤条件以减少计算中包含的记录数。                  |
| Predicate      |                                                     |
|                | 输入布尔表达式。 评估为"是"的记录包含在聚合中。     |
+----------------+-----------------------------------------------------+
| Aggregation    | 要使用的聚合函数。                                  |
| Function       |                                                     |
|                | 您可以使用以下聚合函数：                            |
|                |                                                     |
|                | Avg (Integer or Double)                             |
|                |                                                     |
|                | Count (Integer only)                                |
|                |                                                     |
|                | Min (Integer or Double)                             |
|                |                                                     |
|                | Max (Integer or Double)                             |
|                |                                                     |
|                | StdDev (Integer or Double)                          |
|                |                                                     |
|                | Sum (Integer or Double)                             |
+----------------+-----------------------------------------------------+
| Aggregation    | 所选聚合函数的表达式。                              |
| Expressi       |                                                     |
| on ![https://s |                                                     |
| treamsets.com/ |                                                     |
| documentation/ |                                                     |
| datacollector/ |                                                     |
| latest/help/da |                                                     |
| tacollector/Us |                                                     |
| erGuide/Graphi |                                                     |
| cs/icon_moreIn |                                                     |
| fo.png](media/ |                                                     |
| image81.png){w |                                                     |
| idth="0.127083 |                                                     |
| 33333333333in" |                                                     |
| hei            |                                                     |
| ght="0.1270833 |                                                     |
| 3333333333in"} |                                                     |
+----------------+-----------------------------------------------------+
| Group By       | 允许在计算中使用group by表达式。                    |
+----------------+-----------------------------------------------------+
| Group By       | 在执行计算之前对记录进行分组的表达式。              |
| Expressi       |                                                     |
| on ![https://s |                                                     |
| treamsets.com/ |                                                     |
| documentation/ |                                                     |
| datacollector/ |                                                     |
| latest/help/da |                                                     |
| tacollector/Us |                                                     |
| erGuide/Graphi |                                                     |
| cs/icon_moreIn |                                                     |
| fo.png](media/ |                                                     |
| image81.png){w |                                                     |
| idth="0.127083 |                                                     |
| 33333333333in" |                                                     |
| hei            |                                                     |
| ght="0.1270833 |                                                     |
| 3333333333in"} |                                                     |
+----------------+-----------------------------------------------------+
(3)在"事件"选项卡上，配置以下属性：
+----------------+-----------------------------------------------------+
| **Events       | **说明**                                            |
| Property**     |                                                     |
+================+=====================================================+
| All            | 每次处理器执                                        |
| Aggregators    | 行计算时，都会生成包含所有已配置聚合的结果的事件。  |
| Event          |                                                     |
|                | 有关何时生成事件记录的详细信息，请参阅事件记录。    |
+----------------+-----------------------------------------------------+
| Per Aggregator | 每                                                  |
| Events         | 次处理器执行计算时，为每个配置的聚合生成一组事件。  |
|                |                                                     |
|                | 有关何时生成事件记录的详细信息，请参阅事件记录。    |
+----------------+-----------------------------------------------------+
| Produce Event  | 确定事件记录根字段的数据类型。                      |
| Record with    | 默认情况下，处理器将记录数据写入String根字段。      |
| Text Field     |                                                     |
|                | 要生成标                                            |
|                | 准事件记录并将记录数据写入Map根字段，请清除此选项。 |
+----------------+-----------------------------------------------------+
#### Expression Evaluator/计算表达式
Expression
Evaluator表达式计算器执行计算并将结果写入新字段或现有字段。还可以使用表达式计算器添加或修改记录头属性和字段属性。
要创建计算表达式，需定义字段名称、记录头属性或字段属性以接收表达式的结果。然后，使用表达式语言来定义要使用的表达式。
可以在表达式中使用运行时参数。要在启动管道时指定管道属性的值，请定义运行时参数。
您还可以使用time:now（）函数在记录中包括数据收集器服务器时间。
##### 输出字段和属性
配置表达式时，表达式计算器将表达式的结果写入输出字段或属性。您可以使用现有的字段或属性，也可以创建新的字段或属性。
使用现有字段或属性时，表达式计算器将用新值替换传入值。使用新字段或属性时，表达式计算器将其添加到记录中并传递表达式的结果。
##### 记录头属性表达式
可以使用表达式添加或修改记录的标题属性。
例如，可以使用表达式计算器设置sdc.operation.type属性以允许写入MongoDB。
一些目的地可以使用记录头属性来执行基于记录的写入。有关详细信息，请参见[记录头属性以了解基于记录的写入](https://streamsets.com/documentation/datacollector/latest/help/datacollector/UserGuide/Pipeline_Design/RecordHeaderAttributes.html#concept_lmn_gdc_1w)。有关记录头属性的常规信息，请参见[记录头属性](https://streamsets.com/documentation/datacollector/latest/help/datacollector/UserGuide/Pipeline_Design/RecordHeaderAttributes.html#concept_wn2_jcz_dz)。
##### 字段属性表达式
您可以使用表达式来添加或修改记录的字段属性。例如，您可以基于记录数据创建字段属性，然后将记录传递到基于属性值路由数据的流选择器。
您还可以在字段表达式中使用字段属性功能，以在记录中包括字段属性值。
有关字段属性的更多信息，请参见[字段属性](https://streamsets.com/documentation/datacollector/latest/help/datacollector/UserGuide/Pipeline_Design/FieldAttributes.html#concept_xfm_wtp_1z)。有关字段属性函数的更多信息，请参见[记录函数](https://streamsets.com/documentation/datacollector/latest/help/datacollector/UserGuide/Expression_Language/Functions.html#concept_p1z_ggv_1r)。
##### 配置Expression Evaluator表达式计算器
配置表达式计算器以逐记录执行计算。
(1)在"属性"面板的"常规"选项卡上，配置以下属性：
+---------------+------------------------------------------------------+
| **常规属性**  | **说明**                                             |
+===============+======================================================+
| 姓名          | 阶段名称                                             |
+---------------+------------------------------------------------------+
| 说明          | 可选说明                                             |
+---------------+------------------------------------------------------+
| Required      | 必须包含要传递到阶段的记录的数据的字段。             |
| Fields        |                                                      |