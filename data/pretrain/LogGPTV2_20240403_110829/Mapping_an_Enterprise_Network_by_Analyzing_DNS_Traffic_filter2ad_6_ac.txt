conﬁguration. However, the number of external clients served by these hosts is
very small (i.e., less than 10 per recursive resolver) leading to an average fraction
near 0. Also, looking at the number of external servers queried (i.e., numExtSrv),
the average value of this attribute for recursive resolvers is reasonably high, i.e.,
14 and 4 hosts in the University and the research network respectively contribute
to 84% and 80% of total numExtSrv – this is also expected since they commonly
communicate with public resolvers or authoritative name servers on the Internet.
Hosts clustered as mixed DNS servers in both organizations have a mod-
erate value of the QryFracOut attribute (i.e., 0.57 and 0.21 for the Univer-
sity and the research network respectively) depending on their varying level of
inbound/outbound DNS activity. Also, in terms of external clients and servers
communicated with, the mixed servers lie between name servers and recursive
resolvers. Lastly, regular end-hosts generate only outbound DNS queries (i.e.,
QryFracOut equals to 1), contact a small number of external resolvers, and are
active for shorter duration of time over a day (i.e., actvTimeFrac less than 0.5).
Interpreting the Output of Clustering. Our clustering algorithm also gen-
erates a conﬁdence level as an output. This can be used as a measure of reliabil-
ity for our classiﬁer. If adequate information is not provided by attributes of an
instance then the algorithm will decide its cluster with a low conﬁdence level.
Mapping an Enterprise Network by Analyzing DNS Traﬃc
139
The average conﬁdence level of the result clustering is 97.61% for both organiza-
tions, with more than 99% of instances classiﬁed with a conﬁdence-level of more
than 85%. This indicates the strength of our host-level attributes, enabling the
algorithm to cluster them with a very high conﬁdence-level.
Server Clusters Across a Week. We now check the performance of our clus-
tering algorithm over a week. Figure 5 shows a heat map for clusters of servers.
Columns list server hosts that were identiﬁed in Tables 2 and 3 (i.e., 70 hosts
in the University network and 22 hosts in the research network). Rows display
the cluster into which each server is classiﬁed. The color of each cell depicts the
number of days (over a week) that each host is identiﬁed as the corresponding
cluster – dark cells depict a high number of occurrences (approaching 7), while
bright cells represent a low occurrence closer to 0.
In the University network we identiﬁed 42 name servers, shown by H1 to H42
in Fig. 5(a); the majority of which are repeatedly classiﬁed as a name server over
a week, thus represented by dark cells at their intersections with the bottom
row, highlighting the strong signature of their proﬁle as a name server.
Among 14 recursive resolvers of the university campus, shown by H43 to H56
in Fig. 5(a); two of them (i.e., hosts A and B in Fig. 1) are consistently classiﬁed
as recursive resolver, and the rest are classiﬁed as either mixed DNS server or
even end hosts (due to their varying activity). Lastly, 14 mixed servers, shown
by H57 to H70 in Fig. 5(a), are classiﬁed consistently though their behavior
sometimes is closer to a resolver or a name server.
Our results from the Research Institute network are fairly similar – Fig. 5(b)
shows that hosts H1-H12 are consistently classiﬁed as name servers, while hosts
H13-H16 are recursive resolvers and H17-H22 are mixes servers.
3.2 Server Ranking
Our system discovered 5097 public-facing (non-DNS) servers in the University,
and 6102 at the Research Institute. However, only top 368 and 271 of these
servers respectively appeared in the answer section of more than 100 outgoing
DNS responses over a day. Additionally, 6 top ranked DNS servers, in each
organization, contribute to more than 90% of outgoing queries and responses.
Servers ranking provides network operators with the visibility into the criticality
of their internal assets.
3.3 IT Veriﬁcation
IT departments of both organizations were able to verify the top ranked
DNS resolvers, name-servers, and non-DNS public-facing servers found, as they
are directly conﬁgured and controlled by IT departments of the two organi-
zations,(e.g., major name-servers and web-servers). Additionally, we revealed
unknown servers conﬁgured by departments of the two enterprises (we veriﬁed
their functionality by reverse DNS lookup and their IP range allocated by IT
140
M. Lyu et al.
departments). Interestingly, 3 of the name-servers our method identiﬁed were
implicated in a DNS ampliﬁcation attack soon after, and IT was able to conﬁrm
that these were managed by aﬃliated entities (such as retail stores that lease
space and Internet connectivity from the University) - this clearly points to the
use of our system in identifying and classifying assets whose security posture the
network operators themselves may not have direct control over.
3.4 Clustering of End-Hosts: NATed or Not?
Lastly, to draw more insights we further applied our clustering algorithm (using
the same attributes introduced in Sect. 2.2) to IP address of end-hosts, deter-
mining whether they are behind a NAT gateway or not (i.e., two clusters:
NATed and not-NATed). In both networks, all WiFi clients are behind NAT
gateways. Additionally, some speciﬁc departments of the two enterprises use
NAT for their wired clients too. We veriﬁed our end-host clustering by reverse
lookup for each enterprise network. Each NATed IP address has a corresponding
domain name in speciﬁc forms conﬁgured by IT departments. For example the
University campus wireless NAT gateways are associated with domain-names as
“SSID-pat-pool-a-b-c-d.gw.univ-primay-domain”, where “a.b.c.d” is the
public IP address of the NAT gateway, and SSID is the WiFi SSID for the Uni-
versity campus network (we will disclose SSID and univ-primay-domain when
this paper is de-anonymized). Similarly, in the Research institute NAT gateways
use names in form of “c-d.pool.rsch-primary-domain” where “c.d” is the
last two octets of the public IP address of the NAT gateway in the Research
institute. On 3rd May, our end-host clustering shows that 292 and 19 of end-
hosts IP addresses are indeed NATed in the University campus and the Research
institute respectively – we veriﬁed their corresponding domain names conﬁgured
by their IT departments.
We note that the two clusters of end-hosts are distinguished primarily by
one attribute actvTimeFrac – a NATed IP address (representing a group of end-
hosts) is expected to have a longer duration of DNS activity compared to a
not-NATed IP address (representing a single end-host)4. We observe that some
IPs with domain-names of NAT gateways are incorrectly classiﬁed as not-NATed
end-hosts. This is because their daily DNS activity was fairly low, i.e., less
than an hour. On the other hand, not-NATed end-hosts with long duration
of DNS activity (i.e., almost the whole day) were misclassiﬁed. Verifying end-
hosts classiﬁed as NATed, 84.3% of them in the University campus and 86% in
the Research institute have corresponding domain-names as for NAT gateways
allocated by IT departments. For end-hosts classiﬁed as not-NATed, 80.7% and
90.0% in the respective two organizations do not map to any organizational
domain-names.
4 We omit CCDF plots due to space constraint, they are shown in Appendix 2.
Mapping an Enterprise Network by Analyzing DNS Traﬃc
141
Looking into the performance of end-hosts clustering across a week, we note
that 78.3% end-hosts in the University campus are consistently labeled as NATed
over 7 days5. However, for the research institute, only 32.0% of NATed IPs are
consistent across the entire week – 34.5% of IPs were absent on some days and
the remaining 33.4% were misclassiﬁed as not-NATed for their low activity (e.g.,
only active 2 h during a day).
4 Related Work
DNS traﬃc has been analyzed for various purposes, ranging from measuring per-
formance (eﬀect of Time-to-Live of DNS records) [3,7,13] to identifying malicious
domains [2,8,9] and the security of DNS [5,10,11,14]. In this paper we have pro-
ﬁled the pattern of DNS traﬃc for individual hosts of two enterprise networks to
map network assets to their function and thereby identify their relative impor-
tance for eﬃcient monitoring and security.
Considering studies related to malicious domains, [8] inspects DNS traﬃc
close to top-level domain servers to detect abnormal activity and PREDATOR
[9] derives domain reputation using registration features to enable early detection
of potentially malicious DNS domains without capturing traﬃc. From a security
viewpoint, the authors of [5] study the adoption of DNSSEC [1], highlighting that
only 1% of domains have implemented this secure protocol due to diﬃculties in
the registration process and operational challenges; [10,11] focus on authoritative
name servers used as reﬂectors in DNS ampliﬁcation attacks; some researchers
[14] have reported that the ampliﬁcation factor of DNSSEC is quite high (i.e.,
up to 44 to 55) whereas this measure is 6 to 12 for regular DNS servers.
DNS data can be collected from diﬀerent locations (such as from log ﬁles of
recursive resolvers [4,7] or authoritative name servers) or with diﬀerent gran-
ularity (such as query/response logs or aggregated records). Datasets used in
[5,10,11] contain DNS traﬃc for top level domains such as .com, and .net. We
collect our data at the edge of an enterprise network, speciﬁcally outside the
ﬁrewall at the point of interconnect with the external Internet. We note that
while using data from resolver logs can provide detailed information about end
hosts and their query types/patterns, this approach limits visibility and may not
be comprehensive enough to accurately establish patterns related to the assets
of the entire network.
5 Conclusion
Enterprise network administrators ﬁnd it challenging to track their assets and
their network behavior. We have developed an automated method to map inter-
nal hosts of an enterprise network by focusing only on DNS traﬃc which carries
a wealth of information, constitutes a tiny faction of total network traﬃc and is
5 We omit consistency plots due to space constraint, they are shown in Appendix 2.
142
M. Lyu et al.
easy to capture. By analyzing real-time live streams of DNS traﬃc from two orga-
nizations we highlighted how DNS query and response patterns diﬀer amongst
recursive resolvers, authoritative name servers, and regular hosts. We then iden-
tiﬁed key DNS traﬃc attributes that can be extracted eﬃciently in real-time.
Lastly, we developed an unsupervised machine learning model that can classify
enterprise assets, and we further applied our technique to infer the type of an
enterprise end-host (NATed or not-NATed). Our results have been veriﬁed with
IT departments of the two organizations while revealing unknown knowledges.
Acknowledgements. This work was completed in collaboration with the Australian
Defence Science and Technology Group.
Appendix 1. DNS Behavior of Hosts (Research Institute)
(see Figs. 6 and 7).
(a) Outgoing DNS queries.
(b) Incoming DNS responses.
(c) Incoming DNS queries.
(d) Outgoing DNS responses.
Fig. 6. Research institute: outgoing queries, incoming responses, incoming queries and
outgoing responses, measured on 3 May 2018.
Mapping an Enterprise Network by Analyzing DNS Traﬃc
143
(a) Unsolicited incoming responses.
(b) Unanswered incoming queries.
Fig. 7. Research institute: CCDF of (a) unsolicited incoming responses and (b) unan-
swered incoming queries per host, measured on 3 May 2018.
Appendix 2. NATed vs. not-NATed End-Hosts
(see Figs. 8 and 9).
(a) University campus.
(b) Research institute.
Fig. 8. CCDF: fraction of active hour per day for end-host IP addresses with/without
domain names.
(a) University campus.
(b) Research institute.
Fig. 9. CCDF: Consistency of end-hosts clustering across a week.
144
M. Lyu et al.
References
1. DNS Security Introduction and Requirements (2018). https://www.ietf.org/rfc/
rfc4033.txt. Accessed 28 May 2018
2. Ahmed, J., Gharakheili, H.H., Russell, C., Sivaraman, V.: Real-time detection
of DNS exﬁltration and tunneling from enterprise networks. In: Proceedings of
IFIP/IEEE IM, Washington DC, USA, April 2019
3. Almeida, M., Finamore, A., Perino, D., Vallina-Rodriguez, N., Varvello, M.: Dis-
secting DNS stakeholders in mobile networks. In: Proceedings of ACM CoNEXT,
Incheon, Republic of Korea, December 2017
4. Choi, H., Lee, H.: Identifying botnets by capturing group activities in DNS traﬃc.
Comput. Netw. 56(1), 20–33 (2012)
5. Chung, T., et al.: Understanding the role of registrars in DNSSEC deployment. In:
Proceedings of ACM IMC, London, UK, November 2017
6. Deloitte: Elevating cybersecurity on the higher education leadership agenda (2018).
https://www2.deloitte.com/insights/us/en/industry/public-sector/cybersecurity-
on-higher-education-leadership-agenda.html
7. Gao, H., et al.: Reexamining DNS From a global recursive resolver perspective.
IEEE/ACM Trans. Netw. 24(1), 43–57 (2016)
8. Hao, S., Feamster, N., Pandrangi, R.: Monitoring the initial DNS behavior of mali-
cious domains. In: Proceedings of ACM IMC, Berlin, Germany, November 2011
9. Hao, S., Kantchelian, A., Miller, B., Paxson, V., Feamster, N.: PREDATOR: proac-
tive recognition and elimination of domain abuse at time-of-registration. In: Pro-
ceedings of ACM CCS, October 2016
10. MacFarland, D.C., Shue, C.A., Kalafut, A.J.: Characterizing optimal DNS ampli-
ﬁcation attacks and eﬀective mitigation. In: Proceedings of PAM, New York, NY,
USA, March 2015
11. MacFarland, D.C., Shue, C.A., Kalafut, A.J.: The best bang for the byte: charac-
terizing the potential of DNS ampliﬁcation attacks. Comput. Netw. 116(C), 12–21
(2017)
12. Marshall, S.: CANDID: classifying assets in networks by determining importance
and dependencies. Technical report, Electrical Engineering and Computer Sciences,
University of California at Berkeley, May 2013
13. M¨uller, M., Moura, G.C.M., de O. Schmidt, R., Heidemann, J.: Recursives in the
wild: engineering authoritative DNS servers. In: Proceedings of ACM IMC, London,
UK, November 2017
14. van Rijswijk-Deij, R., Sperotto, A., Pras, A.: DNSSEC and its potential for DDoS
attacks: a comprehensive measurement study. In: Proceedings of ACM IMC, Van-
couver, BC, Canada, November 2014