0
.
1
HTTP - Bell Canada
HTTPS - Bell Canada
HTTP - Rogers
HTTPS - Rogers
40
60
70
10
30
20
50
Packet Loss (%)
(b) Canada
s
n
o
i
t
c
e
n
n
o
C
P
C
T
9
.
0
8
.
0
7
.
0
f
o
F
D
C
6
.
0
0
s
n
o
i
t
c
e
n
n
o
C
P
C
T
9
.
0
8
.
0
7
.
0
f
o
F
D
C
6
.
0
0
10
HTTP - Bouygues
HTTPS - Bouygues
HTTP - France Telecom
HTTPS - France Telecom
HTTP - SFR
HTTPS - SFR
30
20
50
Packet Loss (%)
(e) France
60
40
70
HTTP - DTAG
HTTPS - DTAG
HTTP - Vodafone
HTTPS - Vodafone
40
70
60
10
30
20
50
Packet Loss (%)
(d) Germany
s
n
o
i
t
c
e
n
n
o
C
P
C
T
f
o
F
D
C
9
.
0
8
0
.
7
.
0
6
0
.
0
.
1
s
n
o
i
t
c
e
n
n
o
C
P
C
T
9
.
0
8
.
0
HTTP - Telefonica
HTTPS - Telefonica
HTTP - Vodafone
HTTPS - Vodafone
40
70
60
30
20
50
Packet Loss (%)
0
10
(c) Great Britain
7
.
0
f
o
F
D
C
6
.
0
0
10
HTTP - Telefonica
HTTPS - Telefonica
HTTP - Vodafone
HTTPS - Vodafone
HTTP - Uni2
HTTPS - Uni2
HTTP - Jazztel
HTTPS - Jazztel
40
60
70
30
20
50
Packet Loss (%)
(f) Spain
Fig. 1. Distribution of packet loss over HTTP and HTTPS sessions for cellular networks
in diﬀerent countries. For visibility, we reduced the number of symbols on each line.
of Verizon, AT&T, and Sprint networks, we observe that for HTTP sessions CDN
servers experience low packet loss, whereas for HTTPS sessions CDN servers
experience signiﬁcantly higher packet loss – indicating the presence of CTPs for
HTTP sessions. The results for these networks agree with our observations from
using latency-based technique. However, in the case of T-Mobile, we see that
the packet loss for HTTP sessions is slightly higher compared to other networks.
We speculate that the packet loss for HTTP sessions in T-Mobile network are
inﬂuenced by T-Mobile’s policy to employ CTPs at only a few locations and
domain names in the US (Table 6).
Next, we compare the packet loss observed for connections in a network where
CTP is not employed, the Rogers network in Canada, as detected by our latency-
based technique in Table 2, with a network where our latency-based technique
could not detect the presence of CTPs, the Bell Canada network in Canada. In
Fig. 1(b), we show that for both HTTP and HTTPS sessions in Bell Canada and
Rogers networks, CDN servers observe similar packet loss. We speculate that
either CTPs are not employed in the Bell Canada network or CTPs are present
but CTPs experience same network conditions as Rogers network without CTPs.
We now extend our discussion and compare packet loss observed by CDN
servers for connections in major cellular carriers in the UK, Germany, France,
and Spain. Similarly to carriers in the US, in Fig. 1(c) and (d), we show that
packet loss observed by servers for HTTP sessions is signiﬁcantly lower than
packet loss observed for HTTPS sessions – indicating the presence of CTPs
for HTTP sessions, similar to our observations from using latency-based tech-
nique. For cellular carriers in France in Fig. 1(e), we observe that packet loss for
Detecting Cellular Middleboxes Using Passive Measurement Techniques
105
HTTPS sessions in France Telecom network is similar to packet loss for HTTP
sessions, with both being almost zero. This indicates that CTPs are employed
by France Telecom for splitting both HTTP and HTTPS sessions – validating
our observations from using latency-based technique.
Finally, in Fig. 1(f), we show distribution of packet loss observed by CDN
servers for major cellular carriers in Spain. We observe that for Vodafone and
Telefonica networks, the packet loss for HTTP sessions is much lower than packet
loss for HTTPS session – indicating the presence of CTPs for only HTTP connec-
tions, similar to our observations from using latency-based technique. For Uni2
and Jazztel, however, we observe that packet loss for both HTTP and HTTPS is
similar. This indicates that CTPs are used for both HTTP and HTTPS sessions,
similar to our observations from using latency-based technique. One exception to
our results is for Telefonica. Using the latency technique we identiﬁed that Tele-
fonica could be a potential carrier where CTPs are used to terminate HTTPS
sessions. However, the high packet loss for HTTPS sessions indicates that CTPs
are not used for splitting HTTPS sessions. To disambiguate the presence of
CTPs, we propose another technique that relies on analyzing the characteristics
of TCP SYN packets, which we discuss next.
6 Detecting CTPs from TCP SYN Characteristics
Our third technique is based on analyzing TCP SYN packets to detect the presence
of CTPs in cellular networks. Our active experiments on understanding charac-
teristics of TCP SYN packets generated by diﬀerent types of mobile devices have
revealed that the advertised Initial Congestion Window Size (ICWS), TCP
Timestamp in the TCP options header, and Maximum Segment Size (MSS) val-
ues are diﬀerent across diﬀerent types of mobile devices. We also observed that
these values are diﬀerent even when the same device connects to Wi-Fi and cellu-
lar network. Based on this observation, our goal is to identify whether analyzing
TCP SYN packets (captured passively for HTTP and HTTPS sessions) have the
same ICWS, MSS, and an increasing TCP Timestamp value, which would indicate
that SYN packets are likely being generated by a single machine (a CTP), instead
of from multiple mobile devices with diﬀerent hardware.
Results from our analysis of TCP SYN packets indicate that for all observed
TCP SYN packets on port 80 from cellular carriers for which our latency and
packet loss-based techniques suggest presence of CTP for HTTP sessions, the
ICWS and MSS ﬁelds in the TCP SYN packets have the same value and the TCP
Timestamp option have monotonically increasing values with a near constant
skew – indicating the presence of CTPs for splitting HTTP sessions. For TCP SYN
packets (generated from networks for which our latency and packet loss-based
techniques suggest absence of CTPs for HTTPS sessions) to port 443 of CDN
servers, we observed varying values of ICWS, MSS, and TCP Timestamp – indi-
cating that the TCP SYN packets are likely generated by diﬀerent mobile devices,
instead of CTPs. We also veriﬁed our technique to be reliable for cellular car-
riers that employ CTPs for HTTPS sessions. For example, for France Telecom
106
U. Goel et al.
network in France we observed that the characteristics of all observed TCP SYN
packets to port 443 were similar – indicating the presence of CTPs for HTTPS
connections. For Telefonica in Spain, we did not observe similar characteristics
of observed TCP SYN packets to port 443 – indicating absence of CTPs for split-
ting HTTPS sessions. Based on our ﬁndings on Telefonica’s CTPs for HTTPS
sessions from our latency, loss, and SYN-based techniques, we argue that active
measurements may be needed to reliably detect CTPs. Finally, based on the
data collected we did not ﬁnd networks where ICWS and MSS values were similar
but CTP was not detected using latency packet loss based techniques.
7 Discussion
We believe that one can leverage the use of our latency-based technique to
identify the cellular latency oﬀered by carriers where CTPs are present. We
argue that for such carriers, Client RTT is a reliable indicator of the cellular
latency, comprising of the sum of radio latency and latency within the cellular
backbone. Speciﬁcally, if 4G is widely deployed by a cellular carrier, the latency
oﬀered by 4G would be reﬂected in both p25 and p75 of Client RTT. Further,
if 3G is more widely deployed than 4G, then the latency oﬀered by 4G would
be reﬂected in the p25 and latency oﬀered by 3G would be reﬂected in p75 of
Client RTT. For example, for Telefonica in Spain, Sensorly’s [4] signal strength
data suggests a wide deployment of 3G, but little deployment of 4G. Therefore, in
Table 4, the p25 of Client RTT for HTTP sessions (55 ms) reﬂects Telefonica’s
latency over its 4G network, whereas the p75 latency of 372 ms reﬂects its 3G
latency. Further, the Etisalat network in AE (in Table 3) has wide deployment of
4G (based on Sensorly data), thus the HTTP latency shown in both p25 (30 ms)
and p75 (49 ms) of Client RTT represents the latency oﬀered by Etisalat’s 4G
network. For other cellular networks with CTPs also, we veriﬁed that using
Sensorly’s data and Client RTT together allows cellular latency estimation in
a given carrier.
8 Conclusions
Connection Terminating Proxies (CTPs) have been a great area of interest for
many cellular carriers in the past. These proxies allow for optimizing TCP con-
nections between servers and client devices. In this paper, we propose three
techniques to passively identify the presence of CTPs, based on latency, loss,
and TCP SYN characteristics. We also conduct an extensive measurement study
based on Akamai server logs to demonstrate that our techniques can reliably
detect CTPs in cellular networks worldwide. Based on our measurement results,
we argue that server operators could use our suggested techniques to detect
CTPs using server logs only and optimize communications for diﬀerent cellular
networks with the goal of faster content delivery to end-users.
Detecting Cellular Middleboxes Using Passive Measurement Techniques
107
Acknowledgments. We thank Ruomei Gao, Chris Heller, Ajay Kumar Miyyapuram,
and Kanika Shah for their invaluable insights on reﬁning our data collection process.
We also thank National Science Foundation for supporting this work through grant
NSF CNS-1555591.
References
1. Navigation Timing, August 2015. http://w3c.github.io/navigation-timing/
2. NSF Workshop on Achieving Ultra-Low Latencies in Wireless Networks, March
2015. http://inlab.lab.asu.edu/nsf/ﬁles/WorkshopReport.pdf
3. Real User Monitoring, August 2015. https://www.akamai.com/us/en/resources/
real-user-monitoring.jsp
4. Unbiased Wireless Network Information, August 2015. http://www.sensorly.com
5. Border, J., Kojo, M., Griner, J., Montenegro, G., Shelby, Z.: Performance Enhanc-
ing Proxies Intended to Mitigate Link-Related Degradations, June 2001. https://
tools.ietf.org/html/rfc3135
6. Botta, A., Pescape, A.: Monitoring and measuring wireless network performance
in the presence of middleboxes. In: Conference on Wireless On-Demand Network
Systems and Services, January 2012
7. Dukkipati, N., Reﬁce, T., Cheng, Y., Chu, J., Herbert, T., Agarwal, A., Jain, A.,
Sutin, N.: An argument for increasing TCP’s initial congestion window. SIGCOMM
CCR 40(3), 26–33 (2010)
8. Ehsan, N., Liu, M., Ragland, R.J.: Evaluation of performance enhancing proxies
in internet over satellite. Int. J. Commun. Syst. 16(6), 513–534 (2003)
9. Farkas, V., H´eder, B., Nov´aczki, S.: A split connection TCP proxy in LTE networks.
In: Szab´o, R., Vid´acs, A. (eds.) EUNICE 2012. LNCS, vol. 7479, pp. 263–274.
Springer, Heidelberg (2012)
10. Gomez, C., Catalan, M., Viamonte, D., Paradells, J., Calveras, A.: Web browsing
optimization over 2.5G and 3G: end-to-end mechanisms vs. usage of performance
enhancing proxies. Wireless Commun. Mob. Comput. 8, 213–230 (2008)
11. Ivanovich, M., Bickerdike, P., Li, J.: On TCP performance enhancing proxies in a
wireless environment. IEEE Commun. Mag. 46, 76–83 (2008)
12. Naylor, D., Schomp, K., Varvello, M., Leontiadis, I., Blackburn, J., Lopez, D.,
Papagiannaki, K., Rodriguez, P.R., Steenkiste, P.: Investigating transparent web
proxies in cellular networks. In: ACM SIGCOMM, August 2015
13. Necker, M., Scharf, M., Weber, A.: Performance of diﬀerent proxy concepts in
UMTS networks. In: Wireless Systems and Mobility in Next Generation Internet,
June 2004
14. Thomson, M.: Blind Proxy Caching, July 2015. https://httpworkshop.github.io/
workshop/presentations/thomson-cache.pdf
15. Wang, Z., Qian, Z., Xu, Q., Mao, Z., Zhang, M.: An untold story of middleboxes
in cellular networks. In: ACM SIGCOMM, August 2011
16. Weaver, N., Kreibich, C., Dam, M., Paxson, V.: Here be web proxies. In: Faloutsos,
M., Kuzmanovic, A. (eds.) PAM 2014. LNCS, vol. 8362, pp. 183–192. Springer,
Heidelberg (2014)
17. Xu, X., Jiang, Y., Flach, T., Katz-Bassett, E., Choﬀnes, D., Govindan, R.: Investi-
gating transparent web proxies in cellular networks. In: Mirkovic, J., Liu, Y. (eds.)
PAM 2015. LNCS, vol. 8995, pp. 262–276. Springer, Heidelberg (2015)