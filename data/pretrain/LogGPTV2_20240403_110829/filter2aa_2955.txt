DefCon 27, Las Vegas 2019
Breaking the back end!
Gregory Pickett, CISSP, GCIA, GPEN
Chicago, Illinois
PI:EMAIL
Hellfire Security
Overview
Transit System
Reverse Engineering
My Discoveries
The Exploit
The Lessons
How This Is Different
This is not illegal
We aren’t sneaking into the station
We aren’t hacking their terminals
We aren’t social engineering anyone or attacking 
their wired/wireless network
This is not about the hardware
We aren’t cracking anyone’s encryption
We aren’t cloning the magstripe, RFID, or NFC
How This Is Different
This Is About
Flaws in the Application Logic
OK.  Cloning is involved but it is not the 
vulnerability exploited
Using AppSec to attack Complex Multi-Layered 
Real World Solutions
Elevated Train
Bangkok Mass Transit System (BTS)
Elevated rapid transit system in Bangkok, 
Thailand
Serves Greater Bangkok Area
Operated by Bangkok Mass Transit System PCL 
(BTSC)
43 stations along two lines
Tickets
Stored-Value Card (NFC)
All Day Pass (Magstripe) and Single Journey 
(Magstripe)
Two magstripes
Hole through one magstripe
Only 0.27mm thick
Tickets
Tickets
Tickets
The Equipment
Standard Reader/Writer
Manufactured in China
Standards or Raw Read
Errors Rare
Reliable Performance
Lab Work
Attempted Decode Using Standards
International Organization for Standardization
6-bit Character sets and 4-bit Character sets
Some With Parity and Some Without
Attempted Decode both forwards and 
backwards
It wasn’t using the standards
Lab Work
There is no encryption.
There are no parity checks
There was no longitudinal redundancy check 
(LRC)
There are no timestamps
Field Work
* The section “7826”” is the Ticket Type
* The section “00FF74” is always 100 + the price of the ticket
* For all day passes, the section “00FF74” is used to track trips taken
Field Work
GUID
GUID
GUID
Station
Dispenser
Station
Turn-style
Field Work
Handling Rules
To Enter,
Ticket must have previously been in “Collected” 
State
Ticket Must Be Now Be In “Issued” State
To Exit, Ticket Must Be In “Used” State
Exploiting This System
What We Have Learned So Far
System Safeguards
Their Assumptions
Attacks Against Their Assumptions
Epic Fail!
What We Have Learned So Far
Object Based
Physical Object
Database Object
Properties
Identification
Type
Value
Location
What We Have Learned So Far
States
Issued
Used
Collected
History
System Safeguards
Ticket Composition and Ticket Design
Mirror Physical Object and Database Object
Handling Rules Define Valid Use of The Objects
Lifecycle limited to Twenty-Four Hours
Collection of Ticket After Use
Their Assumptions
No One Will Be Able to Reproduce Our Ticket
Our System Has The Only Valid Objects
Handling Rules Will Prevent Concurrent Use
Damage is limited by Lifecycle
After Use, Ticket Will Be In Our Possession
Attacks Against Assumptions
Acquire Suitable Ticket
Capture Valid Object
Bypass Rules
Extend the Attack to Increase the Damage
Epic Fail!
Found Someone to Make Blank Tickets
Copied Shit Ton of Objects in “Issued” State
Found Flaw In the Handling Rules
“Collected” State found in Current Lifecycle 
Overrides all other states!
Object Always Seen Recently “Collected”
Run The Original Ticket
All Copies Immediately Become Valid
Epic Fail!
X
X
X
Epic Fail!
√
√
√
Epic Fail!
Epic Fail! (Demonstration)
Turning The Exploit Into An Attack
Tickets
Plan
Tickets
The Plan
Buy Ticket (Daily Pass)
Copy Ticket
Use Original
Hand Out Copies
Have Fun!
Repeat Tomorrow!
Results of The Attack
Extend the attack!
Test All Layers of a Solution
Test for Application Issues
Check Your Assumptions
Use Compensating and Mitigating Controls
Avoiding Their Fate
Links
https://wikileaks.org/wiki/Anatomy_of_a_Subway_Hack_2008
https://file.wikileaks.org/file/anatomy-of-a-subway-hack.pdf
https://defcon.org/images/defcon-16/dc16-presentations/anderson-ryan-
chiesa/47-zack-reply-to-mbta-oppo.pdf
https://www.computerworld.com/article/2597509/def-con--how-to-hack-
all-the-transport-networks-of-a-country.html
https://www.cio.com/article/2391654/android-nfc-hack-enables-travelers-
to-ride-us-subways-for-free--researchers-say.html
https://www.youtube.com/watch?v=-uvvVMHnC3c
https://www.blackhat.com/docs/asia-17/materials/asia-17-Kim-Breaking-
Korea-Transit-Card-With-Side-Channel-Attack-Unauthorized-Recharging-
wp.pdf
Links
https://www.msrdevice.com
https://www.msrdevice.com/product/misiri-msr705x-hico-magnetic-card-
reader-writer-encoder-msr607-msr608-msr705-msr706
https://www.alibaba.com/
https://nexqo.en.alibaba.com
http://www.nexqo.com/
https://www.bts.co.th/
http://www.btsgroup.co.th