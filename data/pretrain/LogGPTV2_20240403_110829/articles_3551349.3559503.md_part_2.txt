• Zeroorminimalfootprintontheenvironmentsundertest cations,saturationfaults,andnetworkerrors.SeeTable1foralist
offaulttypesineachcategory.Wehaveconductedexperiments
AsanexampleofanAImodelcreatedwithinourplatform,inSec.4 withIstio’seast-westgatewaytoextendtheservicemeshtoVMs
weshowcasehowitenablesacausallearningenvironmenttolearn orbaremetalserversrunningLinux,buttherequiredinstallation
thecommunicationorerrorpropagationgraphofanapplication. stepsmakeitimpracticaltouseinacustomerenvironment.Aswe
Theplatformconsistsofanumberofdifferentmicro-services continuethedevelopmentoftheplatform,wewillcovermoreplat-
thataredeployedinaKubernetes® cluster(seeFigure1).Ithas forms,e.g.IBMZ,aswellasmorefaultcategories,e.g.byutilizing
beenimplementedasasetofFastAPI[15]micro-serviceswritten therichecosystemofthechaostoolkit[2].
inPython™. ThefaultinjectionAPIiscalledwithalistoffaultsasinput.The
Thefaultinjectionmicro-serviceprovidesAPIendpointsforvari- faultsinthelistaredescribedthroughasimpleJSONdictionary,
ousoperations.Itallowstoinsert/replace/patchordeleteauthenti- whereonespecifiesthetargetresource,afaulttype,theauthenti-
cationconfigurations,supportingtheinjectionoffaultsinremote cationcontext,andotherrequiredinformationlikefaultspecific
Kubernetes®orRedHat®OpenShift®[16]clustersaswellasvir- parameters.Toconstructmorecomplexfaultscenarios,theservice
tualmachinesorbaremetalserversrunningaflavorofLinux®. allowsforsimplefaultorchestrationbyspecifyingastartdelay
Othersupportedoperationsaretheinjectionorremovaloffaults, and/orfaultdurationtime.Forexample,agrowingmemorycon-
thelistingofcurrentlyinjectedfaultsandtheirspecs,thelistingof sumptioncouldbeemulatedbyaseriesofmemoryconsumption
ahistoryoffaultsinjectedintothevarioustargets,orthelisting faultswithincreasingmemoryvalues.Sometypicalfaultcombina-
ofallsupportedfaulttypesalongwiththedescriptionofrequired tionshavebeenpre-definedandarereadilyavailableforinjection.
parametersandtargetresourcetypecompatibility. Tohaveanevenfurthersimplifiedend-userexperiencefordata
Forthefaultinjectionitself,themicro-servicecallssomelogic exploration,anothermicro-serviceprovidesanuserinterface(UI)
from libraries. This can be logic, like the one we implemented (seeFigure1).Onceagain,theend-userwouldspecifysomecon-
ourselvesforsomeinfrastructurefaults,butitcouldaswellbelogic nectionconfigurationandcredentials.Withthesecredentialsthe
fromathirdpartylibrarylikechaostoolkit[2].Thisway,specific UIconnectstoaKubernetes®cluster,forexample,tocollectinfor-
faultsbecomeavailabletotheenduserthroughsimpleAPIcalls. mationaboutexistingservicesorpodsinagivennamespace,so
Therichnessoffaulttypesavailablethroughexistingfaultinjection whentheuserpicksafaulttypefromalist,availablecompatible
ecosystemsallowsfortheintegrationoffaultstargetingvarious targetsarelistedautomaticallyandcaneasilybeselected.Finallyit
platformsandlayerscoveringthewholestackfrominfrastructure makescallstothefaultinjectionmicro-serviceAPItoexecutethe
andnetworktomiddlewareandtheapplicationlayer. faultinjection.
ASE’22,October10–14,2022,Rochester,MI,USA FrankBagehorn,JesusRios,SaurabhJha,RobertFilepp,NaokiAbe,LauraShwartz,andXiYang
Table1:Supportedfaulttypesbycategory Forthisusecase,wehaveusedthefaultinjectionplatformde-
scribedinSec.3inastagingenvironmenttogeneratethefaultdata
Faultcategory Faulttype neededtolearnamodeloferrorpropagationforanymicro-service
applicationwhenobservabilityislimitedtologsdata.Kubernetes®
K8sresourceerrors Killpods,containers
(Kubernetes®only) isacontainermanagementplatformwidelyusedincloudcomput-
Drain/cordonnodes
ing.Whileitprovidestracingcapabilitiestocapturemessageflows
HTTPerrors HTTPdelay betweenmicro-services,hereweaddressthecaseinwhichonlylogs
(Istioservicemesh HTTPtimeout areavailablebecausethegreatmajorityofproductionapplications
only) HTTPabort(errorresponsecode) arenotyetmanagedbyKubernetesandmaynotbeeasilytraced.
Infact,80percentofrespondentstoarecentsurveyconducted
Saturation CPUhog
(SupportsHybrid Memoryhog byCanonical[1]reportedthatmost,orall,oftheirapplications
Cloud) I/Oload arenotyetmanagedbyKubernetes.Absenceoftracingcapability
isalsotypicalinhybrid-cloudenvironmentwhichiscommonin
Networkload
enterpriseapplications[8].
HTTPendpointload
Learninghowerrorspropagatewillprovideamodelofcausal
Networkerrors Packetdelay relationsbetweenerrorsoccurringatmicro-services(i.e.whether
(SupportsHybrid Packetreordering anerrorinmicro-serviceAiscausedbyanerrorinmicro-service
Cloud) Packetduplication B).Wecanthenleveragethiscausalknowledgelearnedinastaging
Packetcorruption environmenttoperformfaultlocalization(i.e.identifyingtheorig-
Packetloss inatingmicro-servicewiththefault)inproductionbyanalyzing
Bandwidthrestriction observederrorlogs.
Tolearnsuchamodelinastagingenvironment,weautomatically
andsequentiallyinjectanavailabilityfaultineachmicro-serviceof
Adatacollectionmicro-servicecomplementsthefaultinjection theapplicationusingthefaultinjectionframework.Underaload
thatsimulatestypicaluserrequeststotheapplication,wecollect
service.Itsupportsthecollectionofoperationaldatalikealerts,
allthelogscomingoutofeachmicro-serviceduringfaultinjection.
events,logs,traces,etc.fromexternaloperationalmonitoringsys-
Onceallthedatahavebeencollectedweapplycausallearningto
temslikeMezmo(formerLogDNA[12]),Instana[6]andothers.
estimatetheerrorpropagationmodelbyconvertingthelogdatainto
TheprovidedAPIcallshidethesyntaxandthesettingofrequired
multipletimeseries,onepermicro-service,countingthenumber
parametersoftheexternalsystemAPIcallsfromtheend-userand
oferrorlogspertimeinterval.Thespecificalgorithmweuseisone
allowforboththemanualexplorationaswellastheautomated
thatisadoptedfromtheinterventionalcausallearningliterature
collectionandintegrationofoperationaldatafromdifferentsources
[9],anddescribingthealgorithmicdetailsisoutsidethescopeof
forlearningtasks.
thispaper.Wenotethattypically,theerrorpropagationmodel,
Tofullyautomatethecycleoffaultinjection,datacollection,
thecausalgraphofinterest,isthereverseofthecommunication
andmodellearning,thedatacollectionservicecanstorethedata
graphaserrorspropagateinadirectionreversetothedirectionof
inaCloudObjectStore(COS)bucket,whereitiseasilypickedup
communicationwhentheyarenotproperlyhandled.
byalearningalgorithm(seeFigure1).
Faultinjectioninastagingenvironmentprovidesuswiththe
datanecessarytolearnhowerrorspropagateinamicro-service
4 EXPERIENCEINLEARNINGFAILURE
applicationbeforedeployment.Thisinformationisusefultohelp
PROPAGATIONMODELS
localizefaultsduringproductionviarootcauseanalysisoferrors.
Moderncloudapplicationsarecommonlybuiltusingmicro-service We note that the type of data generated by our fault injection
architectures, due to their ability to increase the speed and fre- platform is not necessarily readily available during production,
quencyofsoftwaredelivery.Intheseapplications,userrequests both because of limited observability and lack of ground truth
triggersequencesofcallsbetweenmicro-services.Obtainingamap knowledgeontherootcauses.
ofhowmicro-servicescommunicatewitheachotherisnotalways Wehavevalidatedoursystemusingtwopubliclyavailablebench-
easy.However,knowledgeofthecommunicationgraphcouldbe markmicro-serviceapplications(DayTrader[4],asmallapplication
veryusefultohavefortaskslikeactiveprobing,testing,andfault with5services,andTrainTicket[13]with33services)tolearntheir
localization. communicationgraphanderrorpropagationmodel.Toevaluate
Forexample,whenamicro-servicefails,micro-servicescalling the learned causal error propagation patterns, we calculate the
itreceiveanerrorwhichmaypropagateallthewaytothesystem evaluationmetricsofprecision,recall,andF1-score,bycompar-
userifnothandledproperlybytheaffectedmicro-services.Thus, ingourinducederrorpropagationgraphversusthegroundtruth
afaultinonemicro-servicecangenerateacascadeoffailuresin graph,asshowninTable2.Specifically,precisionindicateswhat
manyothermicro-services.AnSREobservingalltheseerrorsfrom proportionofidentifiededgesactuallyhaveconnections;recalltells
multiplelocationsinthesystemmayhaveahardtimetryingto whatproportionofedgesthatactuallyhaveconnectionscanbe
findoutwheretheproblemoriginated.Thecommunicationgraph correctlydetectedbythealgorithm;F1-scoreisaharmonicmean
oftheapplicationinthiscasewouldbeveryusefulinreasoning ofprecisionandrecallthatsetstheirtrade-off.Theresultsshow
abouttherootcause. thealgorithmcaneffectivelylearnthecausalerrorpropagation
AfaultinjectionplatformforlearningAIOpsmodels ASE’22,October10–14,2022,Rochester,MI,USA
patterns,achievingtheF1-scoresof1.00forDayTraderand0.62for learnedusingoneoftheAI/MLcapabilitieswehaveimplemented
TrainTicket.Whenthenumberofmicro-servicesisrelativelysmall, (interventionalcausallearning).Thelearnedgraphwasusedina
e.g.,DayTrader,thecausalrelationshipcanbefullycapturedbythe downstreamapplicationforfaultlocalization,which,inturn,its
algorithm;Asthenumberofmicro-servicesgrows,e.g.,TrainTicket, usefulnesswasevaluatedusingagainourautomatedfaultinjection
itbecomesmuchmorechallenging. platform.
OursolutionisinusebyIBMconsultinganddeployedbythe
Table 2: Fault injection causal learning results evaluated IBMSalesCloudteam.Wecontinueenhancingitbasedonthefeed-
againstthegroundtruthfortheDayTraderandTrainTicket backwereceivedfromourusers:expandingsupportedoperating
micro-servicebenchmarkapplications environments,extendingthenumberoffaultcategoriesandfault
typesandaddingmoredatacollectionsources.
Inthefuture,weplantoinvestigatetheuseandneedsofthefault
Application Precision Recall F1-score
injectionframeworkinabroker-enabledmulti-cloudenvironment
DayTrader 1.00 1.00 1.00 (sky)[17],thatabstractsouttheselectionofcloudprovidersfrom
TrainTicket 0.73 0.54 0.62 application-centricroleslikedatascientist,developer,SRE,etc.
REFERENCES
Onceanerrorpropagationmodelislearned,theAIteamwas
[1] CanonicalLtd..2022.Kubernetesandcloudnativeoperationsreport2022.Retrieved
abletotestafaultlocalizationalgorithmthatconsumessucha
June22,2022fromhttps://assets.ubuntu.com/v1/ee0365d8-Kubernetes+cloud+
modelandcompareitsperformancewithcurrentfaultlocalization native+operations+report+2022_10.05.22.pdf
servicesinourproducts.Thefaultinjectionplatformwasusedfor [2] ChaosToolkitteam.2017.TheChaosEngineeringtoolkitforDevelopers. Retrieved
June15,2022fromhttps://chaostoolkit.org/
thisevaluationbyinjectingfaults,oneatatime,inthebenchmark
[3] JamesClause,WanchunLi,andAlessandroOrso.2007.Dytan:agenericdynamic
applicationsandcheckingwhethertheinjectedfaultswerelocalized taintanalysisframework.InProceedingsofthe2007internationalsymposiumon
Softwaretestingandanalysis.196–206.
correctly.Eachfaultlocalizationestimateproducedbythealgorithm
[4] DayTrader.2022.. RetrievedJune15,2022fromhttps://github.ibm.com/ocp-r2-
onceafaultisdetectedconsistedofasetofcandidatemicro-services demo/
whereitisbelievedthefaultmaybelocated.Table3showsthe [5] GremlinInc.2022.Proactivelyimprovereliability. RetrievedJune15,2022from
https://www.gremlin.com/
experimentalresultsfromtheevaluatedfaultlocalizationalgorithm. [6] InstanaInc.2022.EnterpriseObservabilityandAPMforCloud-NativeApplications.
Specifically,thefaultlocalizationaccuracy(asthepercentageof RetrievedJune20,2022fromhttps://www.instana.com
injectedfaultsthatwerecorrectlylocalized,i.e.,thelocationof [7] SaurabhJha,SubhoBanerjee,TimothyTsai,SivaKSHari,MichaelBSullivan,
ZbigniewTKalbarczyk,StephenWKeckler,andRavishankarKIyer.2019.Ml-
theinjectedfaultwasintheestimationset),averagesizeofthe
basedfaultinjectionforautonomousvehicles:Acaseforbayesianfaultinjection.
estimatedlocationsets,andthecorrespondinginformativeness2 In201949thannualIEEE/IFIPinternationalconferenceondependablesystemsand
networks(DSN).IEEE,112–124.
(withavalueof1iftheestimationsetconsistsofonlyonelocation
[8] DenisKennelly.2019.Threereasonsmostcompaniesareonly20percenttocloud
and0forthecasewheretheestimationsetisaslargeasthetotal transformation. RetrievedJune19,2022fromhttps://www.ibm.com/blogs/cloud-
numberofmicro-servicesintheapplication)arereported. computing/2019/03/05/20-percent-cloud-transformation/
[9] MuratKocaoglu,KarthikeyanShanmugam,andEliasBareinboim.2017.Experi-
mentaldesignforlearningcausalgraphswithlatentvariables.InNips.
Table3:Faultlocalizationexperimentalevaluation [10] SergeyLevine,AviralKumar,GeorgeTucker,andJustinFu.2020.Offlinerein-
forcementlearning:Tutorial,review,andperspectivesonopenproblems.arXiv
preprintarXiv:2005.01643(2020).
Application Accuracy Avg.setsize Informativeness [11] Litmus.2020.CloudNativeChaosEngineeringplatform. RetrievedJune15,2022
fromhttps://litmuschaos.io/
DayTrader 1.00 1.20 0.95 [12] MezmoInc.2022.LogAnalysisandLogManagementSoftwareforObservability
Data. RetrievedJune20,2022fromhttps://www.mezmo.com/
TrainTicket 0.94 5.31 0.87 [13] SoftwareEngineeringLaboratoryofFudanUniversity.2018. TrainTicket:A
BenchmarkMicroserviceSystem. https://github.com/FudanSELab/train-ticket/
[14] HaoranQiu,SubhoSBanerjee,SaurabhJha,ZbigniewTKalbarczyk,andRavis-
hankarKIyer.2020.{FIRM}:AnIntelligentFine-grainedResourceManagement
5 CONCLUSION Frameworkfor{SLO-Oriented}Microservices.In14thUSENIXSymposiumon
OperatingSystemsDesignandImplementation(OSDI20).805–825.
Wehaveshownhowanautomaticfaultinjectionplatformenables [15] SebastiánRamírez.2022.FastAPI. RetrievedJune20,2022fromhttps://fastapi.
tiangolo.com/
andoptimizesthegenerationofdataneededforbuildingAI/ML
[16] RedHat®.2022.RedHatOpenShift. RetrievedJune17,2022fromhttps://www.
modelstosupportmodernIToperations.Thedemonstratedframe- redhat.com/en/technologies/cloud-computing/openshift
worksupportsavarietyofoperatingenvironments,hybridand [17] IanStoicaandShenkerScott.2021.FromCloudComputingtoSkyComputing.
InHotOS’21:ProceedingsoftheWorkshoponHotTopicsinOperatingSystems.
multi-cloudaswellasvirtualmachinesandbaremetalservers.
ACM,26–32.
MotivatedbytheneedsofdatascientistsandAIresearcherswe [18] ChengTan,ZeJin,ChuanxiongGuo,TianrongZhang,HaitaoWu,KarlDeng,
combinefaultinjectionanddatacollectiontosupportautomated DongmingBi,andDongXiang.2019. {NetBouncer}:ActiveDeviceandLink
FailureLocalizationinDataCenterNetworks.In16thUSENIXSymposiumon
learningalgorithmsthatcreatemodelsthatcaneffectivelysupport NetworkedSystemsDesignandImplementation(NSDI19).599–614.
operationaltasksinproductionsystems.Wealsodemonstratedthe [19] Uptime Institute. 2022. Uptime2022. Retrieved June 19, 2022 from
effectivenessoftheplatformwithaconcreteusecaseinwhichthe https://uptimeinstitute.com/webinars/webinar-critical-update-uptime-
institute-2022-outage-report
errorpropagationgraphofamicro-servicebasedapplicationis [20] XiangZhou,XinPeng,TaoXie,JunSun,ChaoJi,DeweiLiu,QilinXiang,and
ChuanHe.2019.Latenterrorpredictionandfaultlocalizationformicroservice
2Informativenessbasicallyrepresentsthepercentageofmicro-servicesthatarenot applicationsbylearningfromsystemtracelogs.InProceedingsofthe201927th
inthefaultlocationestimatedset.Thus,themoreexclusionsinthesetthemore ACMJointMeetingonEuropeanSoftwareEngineeringConferenceandSymposium
informativethesetestimate. ontheFoundationsofSoftwareEngineering.683–694.