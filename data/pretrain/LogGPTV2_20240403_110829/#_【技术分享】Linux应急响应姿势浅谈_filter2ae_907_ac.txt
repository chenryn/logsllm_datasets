          "number_of_replicas": 0
       },
       "mappings" : {
        "_default_" : {
          "_all" : {"enabled" : true, "omit_norms" : true},
          "properties" : {
            "@timestamp": { "type": "date" },
            "host": { "type": "keyword"},
            "cmd": { "type": "keyword"},
            "user": { "type": "keyword"},
            "uid": { "type": "integer"},
            "processid": { "type": "integer"}
          }
        }
      }
    }
查看Kibana
    [root@server120 ~]# ll /bin/sh
    lrwxrwxrwx. 1 root root 4 3月 21 2016 /bin/sh -> bash
/bin/sh是软链到/bin/bash的，/bin/sh也可以审计到。
另外禁用其他的shell：
    # chmod 750 /bin/csh
    # chmod 750 /bin/tcsh
    # chmod 750 /bin/dash
**0x07 开机启动**
在应急响应时，开机启动项是必查的项，下面梳理一下关于开机启动与服务相关需要排查的点。直接从init开始说。
RHEL5、RHEL6、RHEL7的init系统分别为 **sysvinit、upstart、systemd**
。这里CentOS7暂且不表，因为生产环境绝大部分都是CentOS6，少量的CentOS5。
CentOS 5：
init程序会读取init的配置文件/etc/inittab,并依据此文件来进行初始化工作。/etc/inittab文件主要作用是指定运行级别，执行系统初始化脚本（/etc/rc.d/rc.sysinit）,启动相应运行级别下的服务和启动终端。
    [root@jianshe_28 admin]# cat /etc/inittab
    #
    # inittab       This file describes how the INIT process should set up
    #               the system in a certain run-level.
    #
    # Author:       Miquel van Smoorenburg, 
    #               Modified for RHS Linux by Marc Ewing and Donnie Barnes
    #
    # Default runlevel. The runlevels used by RHS are:
    #   0 - halt (Do NOT set initdefault to this)
    #   1 - Single user mode
    #   2 - Multiuser, without NFS (The same as 3, if you do not have networking)
    #   3 - Full multiuser mode
    #   4 - unused
    #   5 - X11
    #   6 - reboot (Do NOT set initdefault to this)
    # 
    id:3:initdefault:
    # System initialization.
    si::sysinit:/etc/rc.d/rc.sysinit
    l0:0:wait:/etc/rc.d/rc 0
    l1:1:wait:/etc/rc.d/rc 1
    l2:2:wait:/etc/rc.d/rc 2
    l3:3:wait:/etc/rc.d/rc 3
    l4:4:wait:/etc/rc.d/rc 4
    l5:5:wait:/etc/rc.d/rc 5
    l6:6:wait:/etc/rc.d/rc 6
    # Trap CTRL-ALT-DELETE
    ca::ctrlaltdel:/sbin/shutdown -t3 -r now
    # When our UPS tells us power has failed, assume we have a few minutes
    # of power left.  Schedule a shutdown for 2 minutes from now.
    # This does, of course, assume you have powerd installed and your
    # UPS connected and working correctly.  
    pf::powerfail:/sbin/shutdown -f -h +2 "Power Failure; System Shutting Down"
    # If power was restored before the shutdown kicked in, cancel it.
    pr:12345:powerokwait:/sbin/shutdown -c "Power Restored; Shutdown Cancelled"
    # Run gettys in standard runlevels
    1:2345:respawn:/sbin/mingetty tty1
    2:2345:respawn:/sbin/mingetty tty2
    3:2345:respawn:/sbin/mingetty tty3
    4:2345:respawn:/sbin/mingetty tty4
    5:2345:respawn:/sbin/mingetty tty5
    6:2345:respawn:/sbin/mingetty tty6
    # Run xdm in runlevel 5
    x:5:respawn:/etc/X11/prefdm -nodaemon
    inittab文件中的值都是如下格式：
    > id:runlevel:action:process
id：
id是指入口标识符，他是个字符串，对于getty、mingetty等，需求id和tty的编号相同，否则getty将不能正常工作。
runlevel：
指定runlevel的级别。能指定多个runlevel级别，也能不为runlevel字段指定特定的值。
运行级别决定了系统启动的绝大部分行为和目的。这个级别从0到6，具有不同的功能。不同的运行级定义如下：
# 0 – 停机（千万别把initdefault设置为0，否则系统永远无法启动）
# 1 – 单用户模式
# 2 – 多用户，没有 NFS
# 3 – 完全多用户模式(标准的运行级)
# 4 – 系统保留的
# 5 – X11 （x window)
# 6 – 重新启动
action：
定义了该进程应该运行在何种状态下，其中action常用的种类有：
wait：切换至某级别运行一次process
respawn：此process终止的话，就重新启动之
initdefault：设置默认运行级别的，process省略
sysinit：设定系统初始化方式，此处一般指定为：/etc/rc.d/rc.sysinit
process：
包含init执行的进程
下面看一下具体的配置
> id:3:initdefault:
设置runlevel
> si::sysinit:/etc/rc.d/rc.sysinit
执行了/etc/rc.d/rc.sysinit，一个shell脚本，他主要是完成一些系统初始化的工作，例如激活交换分区，检查磁盘，加载硬件模块及其他一些需要优先执行任务。
    l0:0:wait:/etc/rc.d/rc 0
    l1:1:wait:/etc/rc.d/rc 1
    l2:2:wait:/etc/rc.d/rc 2
    l3:3:wait:/etc/rc.d/rc 3
    l4:4:wait:/etc/rc.d/rc 4
    l5:5:wait:/etc/rc.d/rc 5
    l6:6:wait:/etc/rc.d/rc 6
/etc/rc.d/rc是个shell脚本，接受runlevel参数，去执行该runlevel目录下的所有的rc启动脚本。以启动级别为3为例，/etc/rc.d/rc3.d/其实都是一些链接文件，真正的rc启动脚本实际上都是放在/etc/rc.d/init.d/目录下。而这些rc启动脚本有着类似的用法，他们一般能接受start、stop、restart、status等参数。
    [root@localhost init.d]# ll /etc/rc.d/rc3.d/
    lrwxrwxrwx. 1 root root 16 Jul 13 15:04 K01smartd -> ../init.d/smartd
    lrwxrwxrwx. 1 root root 16 Jul 13 15:05 S11auditd -> ../init.d/auditd
    .....
凡是以Kxx开头的，都以stop为参数来调用；凡是以Sxx开头的，都以start为参数来调用。xx是数字、表示的是启动顺序，按xx从小到大来执行。
我们来用chkconfig修改一下试试
    [root@localhost rc3.d]# ll | grep audit
    lrwxrwxrwx. 1 root root 16 Jul 13 15:05 S11auditd -> ../init.d/auditd
    [root@localhost rc3.d]# chkconfig auditd off --level 3
    [root@localhost rc3.d]# ll | grep audit
    lrwxrwxrwx  1 root root 16 Jul 20 14:00 K88auditd -> ../init.d/auditd
另外说明一下应急响应中我们都会检查/etc/rc.local，其实也是在rcN.d中。
/etc/rc.local是软链到了/etc/rc.d/rc.local
    [root@localhost init.d]# ll /etc/rc.local
    lrwxrwxrwx. 1 root root 13 Jul 13 15:03 /etc/rc.local -> rc.d/rc.local
Redhat中的运行模式2、3、5都把/etc/rc.d/rc.local做为初始化脚本中的最后一个
    [root@localhost rc3.d]# ll /etc/rc.d/rc3.d/S99local 
    lrwxrwxrwx. 1 root root 11 Jul 13 15:03 /etc/rc.d/rc3.d/S99local -> ../rc.local
    1:2345:respawn:/sbin/mingetty tty1
    2:2345:respawn:/sbin/mingetty tty2
    3:2345:respawn:/sbin/mingetty tty3
    4:2345:respawn:/sbin/mingetty tty4
    5:2345:respawn:/sbin/mingetty tty5
    6:2345:respawn:/sbin/mingetty tty6
init接下来会打开6个终端，以便用户登录系统。
总结一下，针对CentOS5系统，需要排查的点：
**1）/etc/inittab**
该文件是可以运行process的，这里我们添加一行
    > 0:235:once:/bin/vinc
内容如下
    [root@localhost ~]# cat /bin/vinc 
    #!/bin/bash
    cat /etc/issue > /tmp/version
重启
    [root@localhost ~]# cat /tmp/version 
    CentOS release 5.5 (Final)
    Kernel r on an m
**2）/etc/rc.d/rc.sysinit**
在最后插入一行/bin/vinc
    [root@localhost ~]# ll /tmp/version 
    -rw-r--r-- 1 root root 47 11-05 10:10 /tmp/version
    3）/etc/rc.d/init.d
    4）/etc/rc.d/rc.local
CentOS 6：
init会读取配置文件/etc/inittab 和 /etc/init/*.conf。先看一下/etc/inittab
    [root@server120 src]# cat /etc/inittab
    # inittab is only used by upstart for the default runlevel.
    #
    # ADDING OTHER CONFIGURATION HERE WILL HAVE NO EFFECT ON YOUR SYSTEM.
    #
    # System initialization is started by /etc/init/rcS.conf
    #
    # Individual runlevels are started by /etc/init/rc.conf
    #
    # Ctrl-Alt-Delete is handled by /etc/init/control-alt-delete.conf
    #
    # Terminal gettys are handled by /etc/init/tty.conf and /etc/init/serial.conf,
    # with configuration in /etc/sysconfig/init.
    #
    # For information on how to write upstart event handlers, or how
    # upstart works, see init(5), init(8), and initctl(8).
    #
    # Default runlevel. The runlevels used are:
    #   0 - halt (Do NOT set initdefault to this)
    #   1 - Single user mode
    #   2 - Multiuser, without NFS (The same as 3, if you do not have networking)
    #   3 - Full multiuser mode
    #   4 - unused
    #   5 - X11