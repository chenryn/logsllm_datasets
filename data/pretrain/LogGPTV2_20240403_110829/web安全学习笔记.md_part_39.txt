命令行常用选项
• -B  抓取流量的缓冲区大小，若过小则可能丢包，单位为 KB
• -c  抓取 n 个包后退出
• -C  当前记录的包超过一定大小后，另起一个文件记录，单位为 MB
• -i  指定抓取网卡经过的流量
• -n 不转换地址
• -r  读取保存的 pcap 文件
• -s  从每个报文中截取 snaplen 字节的数据，0 为所有数据
• -q 输出简略的协议相关信息，输出行都比较简短。
• -W  写满 cnt 个文件后就不再写入
• -w  保存流量至文件
– 按时间分包时，可使用 strftime 的格式命名，例如 %Y_%m_%d_%H_%M_%S.pcap
• -G  按时间分包
• -v 产生详细的输出，-vv -vvv 会产生更详细的输出
10.3. 流量相关 349
Web-Sec Documentation, 发布 1.0
• -X 输出报文头和包的内容
• -Z  在写文件之前，转换用户
10.3.2 Bro
Bro 是一个开源的网络流量分析工具，支持多种协议，可实时或者离线分析流量。
命令行
• 实时监控 bro -i  
• 分析本地流量 bro -r  
• 分割解析流量后的日志 bro-cut
脚本
为了能够扩展和定制 Bro 的功能，Bro 提供了一个事件驱动的脚本语言。
10.3.3 tcpflow
tcpflow 也是一个抓包工具，它的特点是以流为单位显示数据内容，在分析 HTTP 等协议的数据时候，用
tcpflow 会更便捷。
命令行常用选项
• -b max_bytes 定义最大抓取流量
• -e name 指定解析的 scanner
• -i interface 指定抓取接口
• -o outputdir 指定输出文件夹
• -r file 读取文件
• -R file 读取文件，但是只读取完整的文件
10.3.4 tshark
WireShark 的命令行工具，可以通过命令提取自己想要的数据，可以重定向到文件，也可以结合上层语言来
调用命令行，实现对数据的处理。
350 Chapter 10. 手册速查
Web-Sec Documentation, 发布 1.0
输入接口
• -i  指定捕获接口，默认是第一个非本地循环接口
• -f  设置抓包过滤表达式，遵循 libpcap 过滤语法，这个选项在抓包的过程中过滤，
如果是分析本地文件则用不到
• -s  设置快照长度，用来读取完整的数据包，因为网络中传输有 65535 的限制，值 0 代表快
照长度 65535，默认为 65535
• -p 以非混合模式工作，即只关心和本机有关的流量
• -B  设置缓冲区的大小，只对 windows 生效，默认是 2M
• -y  设置抓包的数据链路层协议，不设置则默认为 -L 找到的第一个协议
• -D 打印接口的列表并退出
• -L 列出本机支持的数据链路层协议，供-y 参数使用。
• -r  设置读取本地文件
捕获停止选项
• -c  捕获 n 个包之后结束，默认捕获无限个
• -a 
– duration:NUM 在 num 秒之后停止捕获
– filesize:NUM 在 numKB 之后停止捕获
– files:NUM 在捕获 num 个文件之后停止捕获
处理选项
• -Y  使用读取过滤器的语法，在单次分析中可以代替 -R 选项
• -n 禁止所有地址名字解析（默认为允许所有）
• -N 启用某一层的地址名字解析。m 代表 MAC 层，n 代表网络层，t 代表传输层，C 代表当前异步 DNS
查找。如果 -n 和 -N 参数同时存在，-n 将被忽略。如果 -n 和 -N 参数都不写，则默认打开所有地址
名字解析。
• -d 将指定的数据按有关协议解包输出，如要将 tcp 8888 端口的流量按 http 解包，应该写为 -d tcp.
port==8888,http 。可用 tshark -d 列出所有支持的有效选择器。
输出选项
• -w  设置 raw 数据的输出文件。不设置时为 stdout
10.3. 流量相关 351
Web-Sec Documentation, 发布 1.0
• -F  设置输出的文件格式，默认是 .pcapng，使用 tshark -F 可列出所有支持的
输出文件类型
• -V 增加细节输出
• -O  只显示此选项指定的协议的详细信息
• -P 即使将解码结果写入文件中，也打印包的概要信息
• -S  行分割符
• -x 设置在解码输出结果中，每个 packet 后面以 HEX dump 的方式显示具体数据
• -T pdml|ps|text|fields|psml 设置解码结果输出的格式，默认为 text
• -e 如果 -T 选项指定，-e 用来指定输出哪些字段
• -t a|ad|d|dd|e|r|u|ud 设置解码结果的时间格式
• -u s|hms 格式化输出秒
• -l 在输出每个包之后 flush 标准输出
• -q 结合 -z 选项进行使用，来进行统计分析
• -X : 扩展项，lua_script、read_format
• -z 统计选项，具体的参考文档
其他选项
• -h 显示命令行帮助
• -v 显示 tshark 的版本信息
10.4 嗅探工具
10.4.1 Nmap
nmap [...] [] {}
指定目标
• CIDR 风格 192.168.1.0/24
• 逗号分割 www.baidu.com,www.zhihu.com
• 分割线 10.22-25.43.32
• 来自文件 -iL 
352 Chapter 10. 手册速查
Web-Sec Documentation, 发布 1.0
• 排 除 不 需 要 的 host --exclude  --excludefile
主机发现
• -sL List Scan - simply list targets to scan
• -sn/-sP Ping Scan - disable port scan
• -Pn Treat all hosts as online – skip host discovery
• -sS/sT/sA/sW/sM TCP SYN/Connect()/ACK/Window/Maimon scans
• -sU UDP Scan
• -sN/sF/sX TCP Null, FIN, and Xmas scans
端口扫描
• --scanflags 定制的 TCP 扫描
• -P0 无 ping
• PS [port list] (TCP SYN ping) // need root on Unix
• PA [port list] (TCP ACK ping)
• PU [port list] (UDP ping)
• PR (Arp ping)
• p 
• F 快速扫描
• r 不使用随机顺序扫描
服务和版本探测
• -sV 版本探测
• --allports 不为版本探测排除任何端口
• --version-intensity  设置版本扫描强度
• --version-light 打开轻量级模式 // 级别 2
• --version-all 尝试每个探测 // 级别 9
• --version-trace 跟踪版本扫描活动
• -sR RPC 扫描
10.4. 嗅探工具 353
Web-Sec Documentation, 发布 1.0
操作系统扫描
• -O 启用操作系统检测
• --osscan-limit 针对指定的目标进行操作系统检测
• --osscan-guess
• --fuzzy 推测操作系统检测结果
时间和性能
• 调整并行扫描组的大小
– --min-hostgroup
– --max-hostgroup
• 调整探测报文的并行度
– --min-parallelism
– --max-parallelism
• 调整探测报文超时
– --min_rtt_timeout 
– --max-rtt-timeout 
– --initial-rtt-timeout 
• 放弃低速目标主机
– --host-timeout
• 调整探测报文的时间间隔
– --scan-delay
– --max_scan-delay
• 设置时间模板
– -T 
– -T (越大越快)
逃避检测相关
• -f 报文分段
• --mtu 使用指定的 MTU
• -D 使用诱饵隐蔽扫描
354 Chapter 10. 手册速查
Web-Sec Documentation, 发布 1.0
• -S 源地址哄骗
• -e  使用指定的接口
• --source-port;-g 源端口哄骗
• --data-length 发送报文时附加随机数据
• --ttl  设置 ttl
• --randomize-hosts 对目标主机的顺序随机排列
• --spoof-mac MAC 地址哄骗
输出
• -oN 标准输出
• -oX XML 输出
• -oS ScRipTKIdd|3oUTpuT
• -oG Grep 输出
• -oA 输出至所有格式
• --open 仅输出可能开放的端口信息
细节和调试
• -v 信息详细程度
• -d [level] debug level
• --packet-trace 跟踪发送和接收的报文
• --iflist 列举接口和路由
10.4.2 Masscan
编译
sudo apt-get install git gcc make libpcap-dev
git clone https://github.com/robertdavidgraham/masscan
cd masscan
make -j
10.4. 嗅探工具 355
Web-Sec Documentation, 发布 1.0
命令行选项
• --ports 指定端口范围
• --rate 指定速率
• --source-ip 指定源 IP
10.5 SQLMap 使用
安装 git clone https://github.com/sqlmapproject/sqlmap.git sqlmap
10.5.1 常用参数
• -u --url 指定目标 url
• -m 从文本中获取多个目标扫描
• -r 从文件中加载 HTTP 请求
• --data 以 POST 方式提交数据
• -random-agent 随机 ua
• --user-agent 指定 ua
• --delay 设置请求间的延迟
• --timeout 指定超时时间
• --dbms指定db，sqlmap支持的db有MySQL、Oracle、PostgreSQL、MicrosoftSQLServer、Microsoft
Access、SQLite 等
• --os 指定数据库服务器操作系统
• --tamper 指定 tamper
• --level 指定探测等级
• --risk 指定风险等级
• --technique 注入技术
– B: Boolean-based blind SQL injection
– E: Error-based SQL injection
– U: UNION query SQL injection
– S: Stacked queries SQL injection
– T: Time-based blind SQL injection
356 Chapter 10. 手册速查
Web-Sec Documentation, 发布 1.0
10.5.2 Tamper 速查
脚本名称 作用
apostrophemask.py 用 utf8 代替引号
equaltolike.py like 代替等号
space2dash.py 绕过过滤’=’ 替换空格字符 (”)，(” - ’) 后跟一个破折号注释，一个随机字符串和一个新行 (’n’)
greatest.py 绕过过滤’>’ , 用 GREATEST 替换大于号。
space2hash.py 空格替换为 # 号随机字符串以及换行符
apostrophenullencode.py 绕过过滤双引号，替换字符和双引号。
halfversionedmorekeywords.py 当数据库为 mysql 时绕过防火墙，每个关键字之前添加 mysql 版本评论
space2morehash.py 空格替换为 # 号以及更多随机字符串换行符
appendnullbyte.py 在有效负荷结束位置加载零字节字符编码
ifnull2ifisnull.py 绕过对 IFNULL 过滤。替换类似’IFNULL(A, B)’ 为’IF(ISNULL(A), B, A)’
space2mssqlblank.py 空格替换为其它空符号
base64encode.py 用 base64 编码替换
space2mssqlhash.py 替换空格
modsecurityversioned.py 过滤空格，包含完整的查询版本注释
space2mysqlblank.py 空格替换其它空白符号 (mysql)
between.py 用 between 替换大于号 (>)
space2mysqldash.py 替换空格字符 (”)(’ - ’) 后跟一个破折号注释一个新行 (’ n’)
multiplespaces.py 围绕 SQL 关键字添加多个空格
space2plus.py 用 + 替换空格
bluecoat.py 代替空格字符后与一个有效的随机空白字符的 SQL 语句。然后替换 = 为 like
nonrecursivereplacement.py 取代 predefined SQL 关键字 with 表示 suitable for 替代 (例如.replace(”SELECT”、””)) filters
space2randomblank.py 代替空格字符 (””) 从一个随机的空白字符可选字符的有效集
sp_password.py 追加 sp_password’ 从 DBMS 日志的自动模糊处理的有效载荷的末尾
chardoubleencode.py 双 url 编码 (不处理以编码的)
unionalltounion.py 替换 UNION ALL SELECT UNION SELECT
charencode.py url 编码
randomcase.py 随机大小写
unmagicquotes.py 宽字符绕过 GPC addslashes
randomcomments.py 用 /**/ 分割 sql 关键字
charunicodeencode.py 字符串 unicode 编码
securesphere.py 追加特制的字符串
versionedmorekeywords.py 注释绕过
space2comment.py Replaces space character ' ' with comments /**/
10.5. SQLMap 使用 357
Web-Sec Documentation, 发布 1.0
358 Chapter 10. 手册速查
11
CHAPTER
其他
11.1 代码审计