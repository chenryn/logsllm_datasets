    hxxp://24.247.181.1:80
    hxxp://96.87.184.101:80
    hxxp://72.226.103.74:80
    hxxp://185.117.119.64:443
    hxxp://198.23.252.204:443
    hxxp://194.5.250.156:443
    hxxp://31.131.22.65:443
    hxxp://92.38.135.99:443
获取详细的IP信息、工作组、域中的计算机列表、域信息。
将信息组织好后POST到C2服务器。
####  mailsearcher邮件地址收集模块
mailsearcher模块用于遍历文件搜集Email地址，并上传给C2服务器，用于后续邮件传播病毒。
    23.226.138.170:443
遍历全盘文件获取邮箱信息。
将获取到的邮箱信息上传到服务器，为后续邮件攻击做准备。
####  tabDll32横向传播增强持久化模块
tabDll32利用EternalRomance漏洞传播自身，其自身rdata节中带有添加启动项和锁屏两个模块
    hxxp://24.247.181.125:8082
    hxxp://66.181.167.72:8082
    hxxp://46.146.252.178:8082
    hxxp://96.36.253.146:8082
    hxxp://40.131.87.38:8082
    hxxp://23.142.128.34:80
    hxxp://177.0.69.68:80
    hxxp://24.247.181.1:80
    hxxp://96.87.184.101:80
    hxxp://72.226.103.74:80
    hxxp://185.117.119.64:443
    hxxp://198.23.252.204:443
    hxxp://194.5.250.156:443
    hxxp://31.131.22.65:443
    hxxp://92.38.135.99:443
  * SsExecutor.exe模块主要用途为增加启动项，添加注册表和启动目录方式启动。
  * 
  * screenlock.dll目前只有锁屏功能，该模块似乎尚未开发完成，猜测其目的可能为配合其他模块盗取登录密码或尝试锁定计算机。
  * 
####  shareDll Loader更新及共享传播
shareDll下载png后缀的PE文件，通过共享文件夹进行横向传播，该PE文件多伪装成游戏，后台监测到每天都有变化,在不断的更新。
获取系统默认共享，通过共享传播病毒本身。
将自身拷贝到系统默认共享中，进行横向传播移动。
通过增加服务，添加启动项，增加持久化。
####  wormDll辅助传播模块
wormDll获取网络中的服务器和域控制器，利用NT LM 0.12查询旧版Windows操作系统和IPC共享。
####  importDll盗窃浏览器敏感信息模块
importDll用于窃取浏览器数据，浏览历史记录，Cookie等。
盗窃Chrome用户数据如图：
盗窃浏览器Cookie相关：
####  psfin收集支付相关服务器信息
psfin用于收集有关POS的服务器信息，使用LDAP查询包含POS、LANE、BOH、TERM、REG、STORE、ALOHA、CASH、RETAIL、MICROS关键字的主机信息。
将收集到的信息POST给C2服务器。
#### bcClientDllTestTest将被感染计算器作为代理使用
该模块为TrickBot提供代理服务，bcClientDllTestTest反向连接通信协议，通讯相关如下图所示。
●disconnect：终止后台服务器连接  
●idle：维护客户端 – 服务器连接  
●connect：连接到后台服务器。该命令必须包含以下参数：
○ip：服务器的IP地址  
○auth_swith：使用授权标志。如果该值设置为“1”，则特洛伊木马会收到auth_login和auth_pass参数。如果值为“0”，则获取auth_ip参数。否则，将不会建立连接。  
○auth_ip：验证IP地址  
○auth_login：验证登录  
○auth_pass：验证密码
#### NewBCtestnDll模块
NewBCtestnDll 是一个带有命令执行功能的反弹SHELL模块，可接受远程命令，并执行，其配置如下：
    147.135.243.1:80
    185.251.39.15:80
    85.143.222.82
下图为远程命令执行相关代码。
## 三、总结
TrickBot随着其版本不断演变，使用了大量加密，多层次嵌套，对抗静态分析，动态调试以及沙箱检测，其模块化设计，攻击者可以方便的增减模块进行不同类型的攻击，分析过程中，发现其用来横向传播的伪装载体不停的变动，多采用C++、VB语言伪装成游戏或工具类应用进行内网共享传播。TrickBot仍在不断演变，部分模块处于开发阶段，某些功能尚未完成，其对金融站点的威胁不容小视，同时大量收集用户信息、登录凭据、环境信息，可能为下一步的攻击提供数据支持和思路。
## 四、IOC
####  C&C服务器
    '51[.]68[.]170[.]58:443'
    '68[.]3[.]14[.]71:443'
    '174[.]105[.]235[.]178:449'
    '91[.]235[.]128[.]69:443'
    '181[.]113[.]17[.]230:449'
    '174[.]105[.]233[.]82:449'
    '66[.]60[.]121[.]58:449'
    '207[.]140[.]14[.]141:443'
    '42[.]115[.]91[.]177:443'
    '206[.]130[.]141[.]255:449'
    '74[.]140[.]160[.]33:449'
    '65[.]31[.]241[.]133:449'
    '140[.]190[.]54[.]187:449'
    '75[.]102[.]135[.]23:449'
    '24[.]119[.]69[.]70:449'
    '195[.]123[.]212[.]139:443'
    '103[.]110[.]91[.]118:449'
    '68[.]4[.]173[.]10:443'
    '72[.]189[.]124[.]41:449'
    '105[.]27[.]171[.]234:449'
    '182[.]253[.]20[.]66:449'
    '199[.]182[.]59[.]42:449'
    '46[.]149[.]182[.]112:449'
    '199[.]227[.]126[.]250:449'
    '24[.]113[.]161[.]184:449'
    '197[.]232[.]50[.]85:443'
    '94[.]232[.]20[.]113:443'
    '190[.]145[.]74[.]84:449'
    '47[.]49[.]168[.]50:443'
    '73[.]67[.]78[.]5:449'
    '24[.]247[.]181[.]125:8082'
    '66[.]181[.]167[.]72:8082'
    '46[.]146[.]252[.]178:8082'
    '96[.]36[.]253[.]146:8082'
    '40[.]131[.]87[.]38:8082'
    '23[.]142[.]128[.]34:80'
    '177[.]0[.]69[.]68:80'
    '24[.]247[.]181[.]1:80'
    '96[.]87[.]184[.]101:80'
    '72[.]226[.]103[.]74:80'
    '185[.]117[.]119[.]64:443'
    '198[.]23[.]252[.]204:443'
    '194[.]5[.]250[.]156:443'
    '31[.]131[.]22[.]65:443'
    '92[.]38[.]135[.]99:443'
    '23[.]226[.]138[.]170:443'
    '185[.]180[.]198[.]249'
    '185[.]180[.]197[.]92:443'
    '147[.]135[.]243[.]1:80'
    '185[.]251[.]39[.]15:80'
    '85[.]143[.]222[.]82'
    '69[.]164[.]196[.]21',
    '107[.]150[.]40[.]234'
    '162[.]211[.]64[.]20'
    '217[.]12[.]210[.]54'
    '89[.]18[.]27[.]34'
    '193[.]183[.]98[.]154'
    '51[.]255[.]167[.]0'
    '91[.]121[.]155[.]13'
    '87[.]98[.]175[.]85'
    '185[.]97[.]7[.]7'
####  MD5
文件名
|
MD5  
---|---  
TrickBot
|
D02FCFAAA123AB35D9E193665072CA15  
TrickBot
|
EB1ABB5E0458068094480B4C6470B85A  
TrickBot
|
3397A79ACB4CBA2883A09E702A80316D  
TrickBot
|
264C6B8C31043CCABBF376CBCBD7C42D  
TrickBot
|
80167E487D931AAF9766D50B4298BDBC  
pwgrab
|
06E2181088BDF16A9BA45397AF2A0DD8  
pwgrab
|
75BF818113BD29009A7A2F8E51539790  
injectDll
|
AF8FBC1BD830B96D4FE559410461E12A  
mailsearcher
|
B310F3130C73D99F4D5CCB33BE846030  
networkDll
|
FFCE6208DB156DEBDADB2A52CAF1FD04  
shareDll
|
B95DA61FDE8EE5DC776C561F3BEA7B35  
systeminfo
|
711287E1BD88DEACDA048424128BDFAF  
tabDll
|
2C51E6E6CE5C2B78CF77C7361D7C595A  
wormDll
|
7307F677B2BCAF3CD6CDA5821126CF89  
importDll
|
88384BA81A89F8000A124189ED69AF5C  
psfin
|
4FCE2DA754C9A1AC06AD11A46D215D23  
bcClientDllTestTest
|
3373728EA59A4A7F919F1CB5F0DB6559  
NewBCtestnDll
|
6243CE02597833B8DBDAC852D116C13A  
## 附录
受影响的金融站点
    ‘hxxps://www.rbsidigital.com'
    ‘hxxps://www.bankline.rbs.com'
    ‘hxxps://lloydslink.online.lloydsbank.com'
    ‘hxxps://www.bankline.ulsterbank.ie'
    ‘hxxps://www.business.hsbc.co.uk'
    ‘hxxps://banking.bankofscotland.co.uk'
    ‘hxxps://www.bankline.natwest.com'
    ‘hxxps://online-business.bankofscotland.co.uk'
    ‘hxxps://ebanking2.danskebank.co.uk'
    ‘hxxps://northrimbankonline.btbanking.com'
    ‘hxxps://home2.ybonline.co.uk'
    ‘hxxps://corporate.metrobankonline.co.uk'
    ‘hxxps://www.natwestibanking.com'
    ‘hxxps://banking.cumberland.co.uk'
    ‘hxxps://alolb1.arbuthnotlatham.co.uk'
    ‘hxxps://online.hoaresbank.co.uk'
    ‘hxxps://butterfieldonline.co.uk'
    ‘hxxps://ibusinessbanking.aib.ie'
    ‘hxxps://www.internationalpayments.co.uk'
    ‘hxxps://www.asbolb.com'
    ‘hxxps://personal.co-operativebank.co.uk'
    ‘hxxps://cbfm.saas.cashfac.com'
    ‘hxxps://onlinebanking.bankleumi.co.uk'
    ‘hxxps://www.caterallenonline.co.uk'
    ‘hxxps://onlinebusiness.lloydsbank.co.uk'
    ‘hxxps://ibank.zenith-bank.co.uk'
    ‘hxxps://ibank.gtbankuk.com'
    ‘hxxps://online.bankofcyprus.co.uk'
    ‘hxxps://banking.ireland-bank.com'
    ‘hxxps://bankofirelandlifeonline.ie'
    ‘hxxps://www.kbinternetbanking.com:8443'
    ‘hxxps://ibank.reliancebankltd.com'
    ‘hxxps://online.duncanlawrie.com'
    ‘hxxps://bureau.bottomline.co.uk'
    ‘hxxps://ibb.firsttrustbank1.co.uk'
    ‘hxxps://netbanking.ubluk.com'
    ‘hxxps://my.sjpbank.co.uk'
    ‘hxxps://ebaer.juliusbaer.com'
    ‘hxxps://ebanking-ch2.ubs.com'
    ‘hxxps://ebank.turkishbank.co.uk'
    ‘hxxps://banking.triodos.co.uk'
    ‘hxxps://nebasilicon.fdecs.com'
    ‘hxxps://infinity.icicibank.co.uk'
    ‘hxxps://ibank.theaccessbankukltd.co.uk'
    ‘hxxps://www.standardlife.co.uk'
    ‘hxxps://www.youinvest.co.uk'
    ‘hxxps://banking.lloydsbank.com'
    ‘hxxps://secure.tddirectinvesting.co.uk'
    ‘hxxps://www.deutschebank-dbdirect.com'
    ‘hxxps://jpmcsso-uk.jpmorgan.com'
    ‘hxxps://secure.aldermorebusinesssavings.co.uk'
    ‘hxxps://www.unity-online.co.uk'
    ‘hxxps://www.barclayswealth.com'
    ‘hxxps://uksecure.barclayswealth.com'
    ‘hxxps://onlinebanking.coutts.com'
    ‘hxxps://www.gerrard.com'
    ‘hxxps://uk.hkbea-cyberbanking.com'
    ‘hxxps://onlinebanking.nationwide.co.uk'
    ‘hxxps://www.bankline.ulsterbank.co.uk'
    ‘hxxps://cbonline.bankofscotland.co.uk'
    ‘hxxps://www.ulsterbankanytimebanking.co.uk'