User: 请解答这个和日志有关的问题smtp blues - external emails works, internal does not I have 3 domains hosted on a remote server, but I am using other postfix server for SMTP only. So, I have two servers:


mail.domain1.com - remote mail server, storing mailboxes and used for IMAP
smtp.domain1.com - local postfix server, used only for SMTP


External email appears to be good, but internal e-mail is not working (e.g. user@domain1.com to user@domain2.com). I have an excerpt of my logs and my main.cnf. ANY help or advice would be greatly appreciated.

IP/domains redacted for obvious reasons, but can be provided if necessary.

Working example of external email:

Jul 20 17:16:35 smtp postfix/smtpd[12808]: warning: hostname mail.domain1.com does not resolve to address REMOTE IP (NO IDEA why this appears, yet the email sends fine)
Jul 20 17:16:35 smtp postfix/smtpd[12808]: connect from unknown[REMOTE IP]
Jul 20 17:16:35 smtp postfix/smtpd[12808]: A42EDD4323: client=unknown[REMOTE IP]
Jul 20 17:16:35 smtp postfix/cleanup[12811]: A42EDD4323: message-id=&lt;55AD2CEC.5090601@domain1.com&gt;
Jul 20 17:16:35 smtp postfix/qmgr[12792]: A42EDD4323: from=&lt;user@domain1.com&gt;, size=579, nrcpt=1 (queue active)
Jul 20 17:16:35 smtp postfix/smtpd[12808]: disconnect from unknown[REMOTE IP]
Jul 20 17:16:36 smtp postfix/smtp[12812]: A42EDD4323: to=&lt;user@yahoo.com&gt;, relay=mta7.am0.yahoodns.net[63.250.192.46]:25, delay=1.2, delays=0.04/0/0.21/0.98, dsn=2.0.0, status=sent (250 ok dirdel)
Jul 20 17:16:36 smtp postfix/qmgr[12792]: A42EDD4323: removed


What doesn't work, internal email:

Jul 20 17:15:32 smtp postfix/master[12787]: daemon started -- version 2.9.6, configuration /etc/postfix
Jul 20 17:15:55 smtp postfix/smtpd[12808]: connect from mail.domain1.com[REMOTE IP]
Jul 20 17:15:55 smtp postfix/smtpd[12808]: A61FAD4323: client=mail.domain1.com[REMOTE IP]
Jul 20 17:15:55 smtp postfix/cleanup[12811]: A61FAD4323: message-id=&lt;d21879c0d64402672666e684b991551d@domain3.com&gt;
Jul 20 17:15:55 smtp postfix/qmgr[12792]: A61FAD4323: from=&lt;user@domain2.com&gt;, size=1232, nrcpt=1 (queue active)
Jul 20 17:15:55 smtp postfix/smtpd[12808]: disconnect from mail.domain1.com[REMOTE IP]
Jul 20 17:15:55 smtp postfix/smtp[12812]: A61FAD4323: to=&lt;user@domain1.com&gt;, relay=mail.domain1.com[REMOTE IP]:25, delay=0.08, delays=0.05/0/0.01/0.02, dsn=5.0.0, status=bounced (host mail.domain1.com[REMOTE IP] said: 530 SMTP authentication is required. (in reply to RCPT TO command))
Jul 20 17:15:55 smtp postfix/cleanup[12811]: B8757D4327: message-id=&lt;20150720171555.B8757D4327@smtp.domain1.com&gt;
Jul 20 17:15:55 smtp postfix/qmgr[12792]: B8757D4327: from=&lt;&gt;, size=3274, nrcpt=1 (queue active)
Jul 20 17:15:55 smtp postfix/bounce[12813]: A61FAD4323: sender non-delivery notification: B8757D4327
Jul 20 17:15:55 smtp postfix/qmgr[12792]: A61FAD4323: removed
Jul 20 17:15:55 smtp postfix/local[12814]: B8757D4327: to=&lt;user@domain2.com&gt;, relay=local, delay=0.01, delays=0/0/0/0, dsn=5.1.1, status=bounced (unknown user: "ez-proposal")
Jul 20 17:15:55 smtp postfix/qmgr[12792]: B8757D4327: removed


My main.cf

myhostname = smtp.domain1.com
alias_maps = hash:/etc/aliases
alias_database = hash:/etc/aliases
myorigin = /etc/mailname
mydestination = smtp.domain1.com, localhost.domain1.com, domain2.com, localhost
relayhost =
mynetworks = 127.0.0.0/8 [REMOTE IP]/32 [::ffff:127.0.0.0]/104 [::1]/128
mailbox_size_limit = 0
recipient_delimiter = +
inet_interfaces = all
smtp_host_lookup = native

Assistant: From the error message
Jul 20 17:15:55 smtp postfix/smtp[12812]: A61FAD4323: to=&lt;user@domain1.com&gt;, relay=mail.domain1.com[REMOTE IP]:25, delay=0.08, delays=0.05/0/0.01/0.02, dsn=5.0.0, status=bounced (host mail.domain1.com[REMOTE IP] said: 530 SMTP authentication is required. (in reply to RCPT TO command))

looks like your remote server use hMailServer.
Digging into its documentation, here the explanation of the error and its solution.

530 SMTP authentication is required.
You have enabled SMTP authentication for the IP range that the user is connecting from, but the user has not configured his client to use SMTP authentication. There's two ways to solve this problem. Either configure your email client to use SMTP authentication. This setting is normally found in the account settings in your email client. Or, disable SMTP authentication for the IP range. The first solution is recommended since it reduces the risk that anyone will send spam through your server.
By default, hMailServer does not require SMTP authentication for connections coming from localhost / 127.0.0.1. For connections coming from other hosts, SMTP authentication is required for deliveries to external recipients. By default, hMailServer never requires SMTP authentication for deliveries to local accounts, since that would prevent other e-mail servers to deliver email to your installation. For information on how to enable SMTP authentication, check the HOWTO.
If you are using a Cisco router, you may need to disable SMTP Fixup protocol. If this is enabled, the router will sometimes intercept SMTP traffic and replace data in it before it reaches hMailServer which will cause problems.