title:Investigating Occurrence of Duplicate Updates in BGP Announcements
author:Jong Han Park and
Dan Jen and
Mohit Lad and
Shane Amante and
Danny McPherson and
Lixia Zhang
Investigating Occurrence of Duplicate Updates
in BGP Announcements
Jong Han Park1, Dan Jen1, Mohit Lad2, Shane Amante3,
Danny McPherson4, and Lixia Zhang1
1 University of California, Los Angeles
2 ThousandEyes
3 Level-3 Communications Inc.
4 Arbor Networks
Abstract. BGP is a hard-state protocol that uses TCP connections to reliably
exchange routing state updates between neighbor BGP routers. According to the
protocol, only routing changes should trigger a BGP router to generate updates;
updates that do not express any routing changes are superﬂuous and should not
occur. Nonetheless, such ‘duplicate’ BGP updates have been observed in reports
as early as 1998 and as recently as 2007. To date, no quantitative measurement
has been conducted on how many of these duplicates get sent, who is sending
them, when they are observed, what impact they have on the global health of
the Internet, or why these ‘duplicate’ updates are even being generated. In this
paper, we address all of the above through a systematic assessment on the BGP
duplicate updates. We ﬁrst show that duplicates can have a negative impact on
router processing loads; routers can receive upto 86.42% duplicates during their
busiest times. We then reveal that there is a signiﬁcant number of duplicates on the
Internet - about 13% of all BGP routing updates are duplicates. Finally, through
a detailed investigation of duplicate properties, we manage to discover the major
cause behind the generation of pathological duplicate BGP updates.
1 Introduction
BGP is the de facto standard inter-domain routing protocol used to exchange destination
reachability information on the Internet. BGP was designed as a hard-state protocol, so
all BGP updates sent by a router should always communicate some change or addi-
tion to the most current routing information reported by the router [7]. However, actual
observations of BGP dynamics reveal that routers tend to occassionally send BGP up-
dates with absolutely no change to the most current routing information reported by
the router. In fact, there are many cases where routers send exact copies of the most
recent update previously sent. To date, there has been no explanation as to why these
‘duplicate’ routing updates occur in BGP today.
Existence of duplicate updates in BGP was ﬁrst reported in 1998. Labovitz’s [2]
seminal work on BGP measurements showed that the actual number of BGP updates
observed were an order of a magnitude more than expected. Labovitz revealed that
a large portion of the total updates were in fact duplicates, and he attributed this to
problems with routers from speciﬁc vendors. The industry quickly responded with a
A. Krishnamurthy and B. Plattner (Eds.): PAM 2010, LNCS 6032, pp. 11–20, 2010.
c(cid:2) Springer-Verlag Berlin Heidelberg 2010
12
J.H. Park et al.
software ﬁx to address the duplicate generation problem, and it was believed that the ﬁx
would eliminate the duplicate pathology observed in [2]. However, in 2007 Li et al. [4]
re-examined the health of BGP dynamics and discovered that, despite industry attempts
to stop duplicate generation, duplicates were still seen in BGP. To date, nobody has
been able to determine the cause of these duplicates. There also have never been any
reports on the effects, if any, that duplicates have on Internet health.
In this paper, we make the following contributions.
– We provide a better understanding of the nature of duplicate generation by quan-
tifying the amount of duplicate updates from different points on the Internet. We
also look at duplicates from different moments in time.
– We reveal the impact of duplicates on Internet health. Unlike the common belief
that duplicates are relatively benign, we show that they can negatively impact the
instantaneous router processing load.
– As part of our work towards understanding duplicates, we provide a methodology
for mapping eBGP updates to their corresponding iBGP updates. We believe that
our methodology can be useful toward future studies that require a mapping of
eBGP to iBGP updates, or vice versa.
– Using our observations of duplicate behavior, we manage to ﬁnally determine the
exact cause behind duplicate generation.
2 Background
In this section, we review some routing details that are particularly relevant to our study
of duplicates. Speciﬁcally, we discuss the deﬁnition of ‘duplicate updates’ and BGP
peering topologies.
2.1 Deﬁnition of Duplicates
A BGP update for preﬁx p sent by router r is a ‘duplicate’ if and only if all attributes in
the update are the same as the most recent previous update for preﬁx p sent by router r,
and both the update and the previous update belong to the same BGP session.
2.2 BGP Peering Topologies
Today, BGP is used for both inter-domain routing (eBGP), as well as intra-domain
routing (iBGP). Here we brieﬂy describe the common peering topologies for both inter
and intra-domain routing.
External BGP: When BGP is used to convey reachability information between two
routers that reside in different domains (inter-domain routing), the session between
these two routers is called an eBGP session. The routing information in each update
is conveyed in the form of BGP attributes. Some of the more relevant attributes to this
paper are Next-hop, MED, Local-pref, and Community.
Internal BGP: iBGP is used to distribute reachability information received from eBGP
peers to routers within one domain. To avoid forming a routing information loop, it
Investigating Occurrence of Duplicate Updates in BGP Announcements
13
was originally required that all iBGP speakers are fully meshed and the reachability
learned from an iBGP speaker is not propagated to another iBGP speaker. In practice,
this approach is not scalable and too expensive to manage. This leads to the use of route
reﬂection (RR) [1] and AS confederations [8], which relaxes this full-mesh requirement
among all iBGP peers. However, having to traverse more than one hop for an update
from an iBGP peer to another iBGP peer re-introduces the possibility of routing infor-
mation loops under both schemes. To avoid forming a routing loop, route reﬂection and
AS confederation deﬁne new attributes, namely Cluster-list and AS-confed-sequence
respectively, and use them in the similar way that AS-path is used in eBGP.
iBGP and eBGP interaction: A router that peers with both iBGP peers and eBGP
peers changes or even removes certain attributes when it sends reachability information
received from an iBGP peer to its eBGP peer. Some attributes deﬁned both in iBGP and
eBGP such as Next-hop, MED, and Local-pref may have changes in their values before
sent out to eBGP peers. Furthermore, certain attributes that are only deﬁned in iBGP
such as Cluster-list and AS-confed-sequence are removed and not sent out to eBGP
peers.
3 Impact of Duplicates on Routers
We start by measuring the impact that duplicates have on Internet health. Up until now, it
was believed that duplicates do not hinder routing efﬁciency in any signiﬁcant way [3].
However, we ﬁnd that duplicates are responsible for the majority of router processing
loads during their busiest times. Previous studies have shown that higher processing
loads can lead to more session resets, routing loops, and packet losses [9]. Thus, we
measured how much duplicates contribute to the router processing loads during their
busiest times during the month of March 2009. We deﬁne ‘busiest times’ as the top
0.01% of seconds within which the largest number of updates were generated. Our data
set consists of a speciﬁc subset of all RouteViews/RIPE monitors. The monitors were
carefully chosen such that each monitor was available for the entire month of March
2009 and that there was at most one monitor per AS in our dataset. The number of stub,
r
e
p
s
e
t
a
d
p
u
f
o
r
e
b
m
u
N
)
3
^
0
1
(
d
n
o
c
e
s
(a) Distribution of % duplicates
(b) # of duplicates during the busiest seconds
Busiest 0.01% seconds 
during March 2009 (AS1853)
Fig. 1. Impact on processing loads
14
J.H. Park et al.
Table 1. Aggregated number of updates and duplicates
2002 2003 2004 2005 2006 2007 2008 2009
Year
90
Number of selected monitors
Number of total updates (106)
129.5 207.3 316.4 426.5 423.7 511.2 652.2 677.4
Number of duplicate updates (106) 12.7 32.0 68.9 74.6 63.8 137.1 111.0 91.3
100
109
27
37
54
67
79
transit, and tier-1 monitors we ended up with were 27, 55, and 8 respectively, for a total
of 90 monitors. We preprocess all of our data using the minimum collection algorithm
(MCT) [10] to ﬁlter out updates due to session resets before performing any of the
measurements presented in this paper.
Figure 1(a) shows the percent of duplicate trafﬁc during busiest times for each of
the 90 ASes we monitored. Notice that for 22% (20 out of 90) of all monitored ASes,
duplicates contribute 50% or more of the update trafﬁc during busiest times. Later in
Section 5, we describe how these duplicate bursts are generated in detail as we reveal
the causes of duplicates. Figure 1(b) is a close-up look at a particularly bad case of
our measurement, AS1853. Overall, 86.42% of total updates during the top 0.01% of
busiest times were duplicates. During the busiest second the router in AS1853 had to
process about 175,000 updates in Figure 1(b).
4 Understanding Duplicates across Time and Space
Now that we understand the negative impact that duplicates can have on Internet health,
we analyze duplicate generation in detail to gain a better understanding of this duplicate
pathology, and maybe even discover the cause of duplicate generation. Not only do we
measure the prevalence of duplicates updates on the Internet today, we also measure
the number of duplicates that we have seen over the past few years. We then explore
whether topological factors (such as size of AS or connectivity) show any correlation
with occurrences of duplicates. Our data set consisted of the same 90 monitors we used
for our measurements in section 3.
Total (95% CI)
Duplicates (95% CI)
(a) During March 2009
(b) From 2002 to 2009
(c) From different AS type
2002 2003 2004 2005 2006 2007 2008 2009
Time (March)
Fig. 2. Amount of duplicate updates
Investigating Occurrence of Duplicate Updates in BGP Announcements
15
4.1 Are Duplicates Observed at All Times?
Figure 2(a) shows the amount of duplicates along with the total number of updates
from all 90 monitors during March 2009. It turns out that duplicate generation is not
just a pathological behavior rarely seen on the Internet. In this month alone, the total
aggregated number of updates was about 677 million. Among those, about 91 million
updates were duplicates. Thus duplicates make up 13.4% of aggregated BGP trafﬁc.
Figure 2(b) shows how long duplicates have existed in BGP by showing the maxi-
mum, minimum, and 95% conﬁdence intervals of % duplicates observed by different
monitors for the month of March from 2002 through 2009. For each year, we selected
monitors based on the criteria described in section 3. Table 1 shows the number of mon-
itors we used from 2002 through 2009. The number of qualiﬁed monitors generally in-
crease over time, mainly because more ASes peered with RouteViews and RIPE over
time.1 We performed the same measurement for other months from 2002 through 2009,
and the results were all similar. The amount of duplicates we counted also agree with
the amount observed in previous studies [4].
4.2 Are Duplicates Observed from All Networks?
Our next measurement is aimed at understanding if size or type (e.g. stub, tier-1) of net-
work has any correlation with observed duplicates. We measured the percentage of du-
plicates out of total updates that each network generated for the month of March 2009.
Figure 2(c) summarizes our ﬁndings. All three types of networks generate duplicates
with some variation in their percentages. The large conﬁdence interval range for tier-1s
is mainly due to the small number of data points available to us. Minimum % duplicates
were very low in all three cases. At the same time maximum % duplicates were quite
high for all types, showing a large variation in behavior even amongst networks of the
same type. Later in section 6, we discuss why the amount of duplicates observed varies
so widely amongst networks of the same type.
4.3 Where Do Duplicates Originate?
So far, we have observed duplicates from different monitors. However, we do not quite
know where these duplicates originate. By speciﬁcation, a BGP router should not prop-
agate a duplicate it receives. Thus, when we observe a duplicate at AS X with a path
X-Y-Z, where Z is the origin AS, we hypothesized that the duplicate message must be
generated by X and not by Y or Z. Our next exercise is to verify our hypothesis.
For this, we looked speciﬁcally at duplicates for particular preﬁxes where the fol-
lowing was true. First, the observed duplicate for preﬁx p from AS X had an AS-path
ending with X-Y. Second, we had to have monitors for both AS X and AS Y. With this,
we can see whether the duplicates actually originate at (or within) AS X, or whether
1 The exception was between 2008 and 2009. This was because some of the collectors in RIPE