图8. Olympic Destroyer以及NotPetya部分代码对比（清除事件日志以及禁用系统恢复）
在Talos公开研究成果后，IntezerLabs这家以色列公司也发表了一则推文，他们发现此次攻击与中国的APT组织有关。
图9. 2018年2月12日IntezerLabs公布此次攻击与中国的APT组织有关
IntezerLabs发布了一篇[博客](http://www.intezer.com/2018-winter-cyber-olympics-code-similarities-cyber-attacks-pyeongchang/)，介绍了利用他们内部的恶意软件相似性分析技术所得到的一些研究成果。
几天之后，许多媒体开始[报道](https://www.scmagazineuk.com/2018-winter-olympics-hit-with-destroyer-malware-during-opening-ceremony/article/743928/)，认为俄罗斯的APT组织有潜在的动机来发动攻击：“在2017年11月和12月期间，Crowdstrike
Intelligence观察到了针对国际体育部门的凭据窃取攻击，认为此次攻击活动的幕后主使者为俄罗斯的黑客组织Fancy Bear……”。
另一方面，Crowdstrike的情报副总裁Adam
Meyers则在某次[采访](https://www.scmagazineuk.com/2018-winter-olympics-hit-with-destroyer-malware-during-opening-ceremony/article/743928/)中称：“现在没有证据表明Fancy
Bear与针对奥运会的攻击事件有关”。
然而几星期之后，华盛顿邮报再次提及俄罗斯的攻击行为。华盛顿邮报引用了“两名匿名美国官员”的消息，[声称](https://www.washingtonpost.com/world/national-security/russian-spies-hacked-the-olympics-and-tried-to-make-it-look-like-north-korea-did-it-us-officials-say/2018/02/24/44b5468e-18f2-11e8-92c9-376b4fe57ff7_story.html)俄罗斯军事间谍是冬奥会攻击事件的幕后黑手。不幸的是，基于匿名消息源的这类文章并没有包含可以验证的信息，也没有提供真正的答案，这些文章的唯一作用就是传播谣言。
微软的安全团队似乎也被这款恶意软件玩得团团转，他们的内部检测机制认为攻击中可能用到了EternalRomance漏洞（MS17-010）。
图10. 微软安全团队认为Olympic Destroyer中存在EternalRomance漏洞利用技术
几天之后，由于这些消息没有得到确认，微软收回了前面发表的言论。
图11. 微软安全团队在后续推文中收回了先前的声明
随后我们向我们的APT情报订阅客户推送了一份调查取证报告，认为此次攻击事件的追踪溯源是非常复杂的一件事情（如果想了解详细信息请联系PI:EMAIL），第二天思科Talos团队决定重新检查Olympic
Destroyer，对外公布了相似的调查结论。我们非常赞同Talos的这篇分析[文章](https://blog.talosintelligence.com/2018/02/who-wasnt-responsible-for-olympic.html)，在代码对比方面我们得到了非常相似的结论。
此外，Talos研究人员指出，恶意软件在操作过程中用到了`evtchk.txt`这个文件名作为虚假特征，这个特征与BlueNoroff/Lazarus在2016年针对孟加拉国的SWIFT攻击事件中所使用的文件名特征（`evtdiag.exe`、`evtsys.exe`以及`evtchk.bat`）非常相似。
Recorded
Future认为不应该把这次攻击事件归结到任何攻击者；然而，他们[声称](https://www.recordedfuture.com/olympic-destroyer-malware/)这款恶意软件与BlueNoroff/Lazarus
LimaCharlie恶意软件加载器之间存在相似性，而大家认为这些恶意软件与朝鲜攻击者有千丝万缕的关系。
无法否认的是，恶意软件部分代码与Lazarus的代码非常相似。Olympic
Destroyer中使用的wiper模块（MD5：`3c0d740347b0362331c882c2dee96dbf`）与Bluenoroff（MD5：`5d0ffbc8389f27b0649696f0ef5b3cfe`）中擦除文件的代码非常相似。
图12. 擦除模块的代码（左图：Bluenoroff工具，右侧：OlympicDestroyer）
Lazarus与Olympic
Destroyer的相似度也很高。这两个攻击组织使用了相同的技术在内存中解密攻击载荷，解密密码同样来自于命令行参数。因为Lazarus的恶意软件加载器中包含一些默认的C2信息，为了避免被逆向分析，Lazarus使用这种技术来保护自己的后门模块。
尽管这两款恶意软件方法上有些相似，但用法上却有较大的差别：
1、Lazarus所使用的字母数字密码长度较长且较为可靠（30多个字符），Olympic Destroyer只使用了一个非常简单的密码：“123”。
2、Lazarus从来没有将保护攻击载荷的密码硬编码到恶意软件中，而Olympic
Destroyer则会采用硬编码方案（事实上没有其他可选方案，因为蠕虫必须能够自行传播并自主运行）。这也就是为什么在网络蠕虫中使用密码保护的攻击载荷是一种比较荒谬的想法，考虑到Lazarus组织之前的TTP（Tactics,
Techniques and Procedures，战术、技术以及过程）特征，我们认为他们不大可能会采用类似的技术。
考虑到金正恩的胞妹也会出席平昌冬奥会开幕式，我们认为朝鲜参与此次攻击事件的可能性看起来不大。根据我们的调查结果，攻击事件发生在2018年2月9日开幕式之前。
接下来我们的发现让我们自己都大吃一惊。利用内部的恶意软件相似性系统，我们发现Olympic
Destroyer与Lazarus组织存在一种独特的关联性。大家都知道，可执行文件中带有一些代码开发环境特征（即Rich
Header），某些情况下可以用来作为指纹信息识别恶意软件开发者以及相关工具。在卡巴斯基实验室对Olympic Destroyer
wiper样本的分析过程中，这个“指纹信息”与之前已知的Lazarus恶意软件组件匹配程度达到了100%，并且完全没有与卡巴斯基实验室先前掌握的任何无害或者恶意文件有交集。
然而这款恶意软件在动机方面以及其他方面与Lazarus的TTP特征并不一致，这也促使我们某些研究人员以怀疑的态度重新审视这个稀罕物。再次仔细检查这些特征、手动验证每个功能后，我们发现这些特征与实际的代码并不匹配。此时我们终于明白，攻击者伪造了这些特征，使其能够与Lazarus组织的指纹完美匹配。考虑到在恶意软件分析和追踪溯源方面人们对这一领域尚未深入挖掘，我们在另一篇[博客](https://securelist.com/the-devils-in-the-rich-header/84348/)中专门介绍了我们的分析证明过程，提供了更加深入的技术细节。
我们还注意到恶意软件中存在带有Rich
Header信息的wiper模块，该模块从法国受害者（Atos）网络上传到VirusTotal上。模块的编译时间为2018-02-09
10:42:19，此时距离平昌滑雪场遭受攻击后差不多2个小时。我们不清楚攻击出现了什么问题，但看起来攻击者似乎急于修改蠕虫的wiper组件，让其能够立即禁用系统服务并重启主机，而不需要等待60分钟。由于距离官方开幕式典礼只剩下几分钟，攻击者似乎想立刻看到攻击成果。
将上述所有情况考虑在内，我们发现攻击者故意在恶意软件中放置了许多非常复杂的虚假特征，向分析人员释放烟雾弹，让他们误以为在犯罪现场缴获了枪口冒烟的凶器，然而却与事实的真相渐行渐远。
## 八、总结
现在我们可以得出什么结论呢？这与背后攻击者的聪明程度密切相关
如果Lazarus是最聪明的组织，那么他们完全可以构造一个复杂的虚假标志，复杂到让大家难以证实，只有更复杂的分析过程才能发现这是伪造的标志。然而，研究人员的技术复杂程度是攻击者难以衡量的一个因素。复杂度肯定会降低可靠性，无法保证一切都按原计划执行。另外，Lazarus没有明显的动机来发起这次攻击，更何况此次攻击与他们的TPP并不相符。
说到TTP，我们发现攻击者使用过NordVPN以及MonoVM托管服务，这两种服务都支持比特币支付，因而像是为APT攻击者量身定做的服务。作为众所周知的俄罗斯攻击组织，Sofacy
APT之前曾使用过这些服务以及其他TTP。我们在一年前发表了关于Lazarus
APT组织的研究报告，指出Lazarus组织在针对全世界银行的攻击活动中使用过虚假标志，将线索引向俄罗斯组织。此次事件是否是俄罗斯Sofacy组织的打击报复，还是有人想披着Sofacy的外壳来搞些事情？事情真相尚未揭晓，我们还没有得到明确的答案。
在此次事件中，关于攻击者的真实动机仍是开放性问题。我们知道攻击者拥有受害网络的管理员账户。如果删除备份数据、销毁所有的本地数据，攻击者可以轻松破坏掉奥运会的基础设施。然而攻击者还是“手下留情”了，他们擦除了Windows共享上的文件、重置事件日志、删除备份数据、禁用Windows服务、使系统无法正常重启。当我们考虑到其他攻击组织以及恶意软件的TTP特征、故意引入的虚假标志以及较好的OPSEC（操作安全），想理解攻击者的意图可能会带出更多问题。
根据这些信息，我们可以猜测此次攻击事件背后的动机，包括如下几种可能性：
1、通过安全人员无法掌握的秘密通信向世人展示攻击者的实力或者技术水平。在高度机密的政治谈判中，全面且具备高度破坏性的网络攻击行为往往能带来更多的话语权。
2、测试破坏性蠕虫的能力，但同时限制了蠕虫的影响力，避免引起各种调查人员以及普罗大众的过度关注（因为攻击中可能出现人为错误或者操作失误）。
3、通过虚假标志让情报研究人员陷入迷宫，观察研究人员公布的结论，学习如何实现完美的虚假标志。
如果你在思索为何恶意软件所附带的擦除模块不能擦除自身组件，那么最后一种可能性也就能说得通，因为作者希望别人能够发现这款恶意软件。
对于实力强大的攻击者，如果他们想学习如何可靠地构造虚假标志、如何误导研究人员的追踪溯源分析，那么他们最终能够完全瓦解对其的追踪溯源。但这种高超技术需要现实试验的不断磨练。
我们认为这次精心策划的Olympic
Destroyer攻击事件将在未来的APT研究中扮演重要的角色。虽然此次攻击并没有完全破坏平昌冬奥会，但同时给韩国以及欧洲造成了影响。最重要的是，攻击事件给追踪溯源过程带来了极大的困扰，降低人们对情报研究成果的信任度。
从此次攻击事件中，致力于威胁情报的人们都可以得到一个教训，那就是不要着急追踪溯源。追踪溯源是一个非常微妙的问题，应该谨慎处理。在这个行业中，我们不应该牺牲研究的准确性，却以投机的方式来推动业务进展。
## 九、Olympic Destroyer可执行文件
样本散列如下：
    0311CEC923C57A435E735E106517797F
    104ECBC2746702FA6ECD4562A867E7FB
    12668F8D072E89CF04B9CBCD5A3492E1
    19C539FF2C50A0EFD52BB5B93D03665A
    221C6DB5B60049E3F1CDBB6212BE7F41
    3514205D697005884B3564197A6E4A34
    3C0D740347B0362331C882C2DEE96DBF
    47E67D1C9382D62370A0D71FECC5368B
    4C8FA3731EFD2C5097E903D50079A44D
    4F43F03783F9789F804DCF9B9474FA6D
    51545ABCF4F196095ED102B0D08DEA7E
    52775F24E230C96EA5697BCA79C72C8E
    567D379B87A54750914D2F0F6C3B6571
    5778D8FF5156DE1F63361BD530E0404D
    583F05B4F1724ED2EBFD06DD29064214
    58DD6099F8DF7E5509CEE3CB279D74D5
    59C3F3F99F44029DE81293B1E7C37ED2
    64AA21201BFD88D521FE90D44C7B5DBA
    65C024D60AF18FFAB051F97CCDDFAB7F
    68970B2CD5430C812BEF5B87C1ADD6EA
    6E0EBEEEA1CB00192B074B288A4F9CFE
    7C3BF9AB05DD803AC218FC7084C75E96
    83D8D40F435521C097D3F6F4D2358C67
    86D1A184850859A6A4D1C35982F3C40E