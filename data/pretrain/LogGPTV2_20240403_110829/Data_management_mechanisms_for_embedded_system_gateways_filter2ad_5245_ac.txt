DroppedMessageCountsforVariousQueueLengths(5000trials,dropoldestoverflowpolicy)NumberofDroppedMessages0100200300400QueueLength136102030405060Figure6.Summaryofthetotalnumberofdroppedmessagesfromeachtrialforexperimentswithqueuesofvariouslengths.Average Delay for Various Queue Lengths(5000 trials, drop oldest overflow policy)Average Delay (s)01020304050Queue Length1102030405060Figure7.Summaryoftheaveragequeuedelayforqueuesofvariouslengths.oflength40orlonger,themedianvalueoftheaveragedelaybeginstoleveloﬀ,althoughupperboundondelaycontinuestogrow.Justaslongerqueuesarelesslikelytooverﬂow,theyarealsolesslikelytobefull,whichmeansthatasqueueboundsbecomelarger,themediandelayisgovernedlessbythelengthofthequeueandmorebythetimingofthearrivalmessages(recallthateachexperimentusesthesamesetofarrivalsequences).BasedontheresultsinFigures6and7,weobservethatthereisatradeoﬀbetweenthenumberofdroppedmessagesandtheaveragequeuedelay.Nowweexaminetheeﬀectofqueuelengthonthemeanvalueerror.Recallthatthemeanvalueerrormetricproducesasinglevalueforeachtrialintheex-periment.TheboxplotsinFigure8comparethemeanValue Error for Various Queue LengthsMean Value Error (km/h)0510152025Queue Length12050UnboundedFigure8.Boxplotsummaryofmeanvalueerrorforvariousqueuelengths.Shorterqueuelengthshaveaslightlylowermedianvalue.valueerrorforexperimentsrunwithboundedqueuesoflength1,20and50andanunboundedqueue.Fortheboundedqueues,theDropOldestoverﬂowpolicywasused.Wemightexpectthatreducingqueuedelaywouldalsodecreasethemeanvalueerrorintheoutput.In-deed,theresultsinFigure8showthatmedianerrordoesgodownslightlyasthequeuelengthisreduced.However,wealsoobservethat5thpercentileoftheer-roractuallyincreasesforshortqueues.Althoughwehavereducedthedelaybyreducingthequeuesize,theshorterqueuesdropmoremessages,andthesedroppedmessagesalsocontributetothemeanvalueerror.So,althoughwecanusethequeuelengthparametertochooseapointinthetradeoﬀspacebetweendroppedmessagesandaveragedelay,thequeuelengthparame-terhasverylittleeﬀectonthemeanvalueerror.Figure9showsacomparisonofexperimentsusingalength50boundedqueuewithvariousoverﬂowpolicies.TheperformanceoftheDropNewest,DropOldest,andDropRandompoliciesisalmostthesame.Thisisbe-causewhenanoverﬂowconditionoccurs,eachpolicydropsasinglevalue.Althougheachpolicyselectsadiﬀerentmessagetodrop,thenumberofdroppedmes-sages,andthustheoveralleﬀect,isrelativelysmall.TheonlypolicythatexhibitsdiﬀerentbehavioristheDropAllpolicy.Theperformanceofthispolicyisworsebecausetheﬂushingofthequeueresultsinalargenumberofdroppedmessages.Theinsighttobegainedfromtheseexperimentsisthatneitherqueuelengthnoroverﬂowpolicycansig-niﬁcantlyimprovethemeanvalueerrorperformanceofthegateway.7AnalysisAstheresultsinSection6show,thedelayintro-ducedbythequeuecanincreasetheerrorinthevalues978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
182
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 09:57:51 UTC from IEEE Xplore.  Restrictions apply. 
Value Error for Various Overflow Policies(bounded queue of length 50)Mean Value Error (km/h)0510152025Overflow PolicyDrop OldestDrop NewestDrop RandomDrop AllFigure9.Boxplotsummaryofmeanvalueerrorforqueuesemployingvariousoverﬂowpolicies.Thereisverylittledifferenceintheperformanceofthepolicies.outputbythegateway.Adetailedexaminationofthequeueinoperationcanoﬀerinsightintohowqueuedelayarises.This,inturn,oﬀersinsightintohowtomitigatedelay.Itturnsoutthatqueueunderﬂowistherootcauseofmessagedeliverydelay.Intheexampleweconsider,theaverageinputandoutputratesofthegatewayarethesame,sointhesteadystate,thereshouldbenoaccumulationofmessagesinthequeue.However,theexperimentalresultsshowthatthisisnotthecase.Figure10sketchesthewaythatqueueunderﬂowcanintroducedelayintothequeue.Part(a)oftheﬁgureshowstheidealcase,wheneachincomingmessagear-rivesintimeforitstimeslotintheoutputstream.Nomessagesaccumulateinthequeueandthereisnodelayintheoutputstreamvalues.ThearrivalprocessthatweusetomodelenterprisenetworksisaPoissonprocess,sothetraﬃcarrivalsarebursty,aspicturedinpart(b)oftheﬁgure.Whentheﬁrstthreemessagesarriveinaburst,theyarequeuedanddeliveredintheirappropriatetimeslots.Becauseofthelongquiescentperiodbetweenthebursts,thefourthmessagehasnotarrivedwhenthefourthtimeslotcomesupattheoutput,sothethirdmessageissentagain(perthemailboxpolicy).Whenthefourthmessagedoesarrive,itissentinthetimeslotwheretheﬁfthmessageshouldgo,andtheﬁfthmessageisdeliveredinthesixthslot,andsoon.Thetimeslotmissedbythefourthmessagecannotberecovered,andthesteadystatesizeofthequeuehasincreasedbyone,addingonemessageperioddelaytoeachdeliveredmes-sage.Thisprocesscanhappenrepeatedly,causingthequeuetogrowlongerandlongerastheresultofei-thernormaltimingvariationsoramaliciousattackerpurposelyclumpingmessagearrivaltimes.ThesolutionthatweproposetotheproblemofqueueunderﬂowisshowninFigure10(c).Whenunder-Queue12345671234567Queue12345671234563Filter(b)Queuewithburstyinput(a)Queuewithidealinput(c)Filterwithburstyinput123~4567CorrectlydeliveredmessageIncorrectlydeliveredmessage1234567Figure10.ComparisonofQueuesandFilterswithburstyinputsﬂowoccursandthefourthmessageisnotavailableinthefourthtimeslot,thedatamanagementmechanismproducesanestimateofthemissingdata.Whenthefourthvaluearrives,itisnotdeliveredintheﬁfthtimeslot.Infact,itisnotdeliveredatall.Thiseliminatesthedelaycausedbythemissedtimeslot.8FiltermechanismsAmechanismthatimplementsthebehaviorshowninFigure10(c)canbethoughtofasaqueuewithaspecialpolicythatdropsanincomingmessageforev-eryduplicatemessagethathasbeensent.Thispolicyisnotanoverﬂowpolicybecausethemessagesarenotdroppedbasedonthelengthofthequeue.Ifthisspe-cialqueuemechanismusesthemailboxpolicyforun-derﬂow,thentheestimateforthemissingmessagewillbethelastsentmessage.Thisqueuemechanismcanintelligentlydropmessagesinordertoreducedelay,butsincethequeuemechanismcanonlyprocessmessagesbasedontheirarrivalorderandtiming,theestimatesforthemissedmessagevaluescannotbemoresophis-ticatedthanthosegeneratedbythemailboxpolicy.Weproposetogeneralizetheideaofusingpreviousdatavaluestoestimatemissingoutputvalues.Wecallamechanismthatlooksatmessagevaluesaswellasmessagetimingandarrivalorderaﬁlter.Addition-ally,ﬁltermechanismsmayaggregateormodifymes-sagevalues.Oneconsequenceofthisdeﬁnitionisthataqueuemayonlydeliveramessagevaluethatithasreceivedintheincomingmessagestream,butﬁlterscouldpotentiallydeliveramessagewithavaluethathasneverbeenseenattheinputofthegateway,al-thoughthisnewvaluemaybeafunctionofpreviousinputvalues.Awidevarietyofmodelscanbeappliedtothedatatogenerateanestimate.Forexample,the978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
183
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 09:57:51 UTC from IEEE Xplore.  Restrictions apply. 
modelcouldpredictamissingvaluebytakingtheav-erageofthethreepreviousvaluesorbyperformingre-gressionanalysisonthepreviousdataandextrapolat-ingtocomputethenewvalue.Thedatamodelshouldbechosentoﬁtthedatathatisbeingﬁltered.Althoughthereisaverylargedesignspacefordatamodelsthatcanbeusedintheseﬁlters,ourpurposehereissimplytodemonstratethatﬁlterscanbemoreeﬀectivethanqueuesintheenterprise-to-embeddedscenario.ThereforewehavechosenthemechanismthatisdescribedinFigure10(c).Thismechanismusesasimpledatamodelwhichapproximatesmissingval-uesbyzeroorder(constant)approximation.Inotherwords,themissingvalueisapproximatedbythelastvaluethatwasreceivedatthegatewayinput.Aswehavenoted,thismechanismisontheboundarybe-tweenqueuesandﬁlters,andcouldbeclassiﬁedasei-therone.ThecomparisoninSection9belowshowsthatthismechanismexhibitssigniﬁcantlybetterdatavalueerrorperformance.Webelievethatfurtherim-provementcouldbeobtainedbyusingmoresophisti-cateddatamodels,andforthisreasonwechoosetoclassifythismechanismasaﬁltermechanism.9ComparingﬁltersandqueuesTocomparetheﬁlterandqueuemechanisms,weevaluatethemusingthemeanvalueerrormetric.Re-callfromtheresultsinSection6thatthequeuelengthandoverﬂowpolicyparametershadlittleimpactonthemeanvalueerrormetric.Figure11showsthemeanvalueerrorsummarycomparingtheﬁltermechanismtolength1and50boundedqueuesandanunboundedqueue.TheboundedqueuesusedtheDropOldestover-ﬂowpolicy.PertheresultsinFigure9,otheroverﬂowpolicieswouldyieldsimilarresults.Althoughthe95thpercentileofthemeanvalueerrorisonlyslightlylower,theﬁltermechanismshowsasigniﬁcantbiastowardlowermeanvalueerrors.Tohighlightthisimprove-ment,thesameresultsarepresentedinFigure12intheformofcumulativedistributionfunctions.Theseresultsarenotmeanttoimplythatqueuemechanismshavenoplaceinembeddedsystemgate-ways.Theremaybeotherscenarioswithdiﬀerentre-quirementsthataremoresuitedtotheircharacteristics.Theseresultsdodemonstratethatafurtherexplorationofﬁltermechanismsiswarranted.10ConclusionsandfutureworkAsitbecomesmorecommontonetworkandinter-networkembeddedsystems,thereisaneedtodevelopmechanismsandpoliciesforembeddedsystemgate-waysandtodevelopguidanceonhowthesemechanismsandpoliciescanbeused.WehavebegunthisworkbyValue Error for Filter and Queue MechanismsMean Value Error (km/h)0510152025FilterQueue (1)Queue (50)Unbounded QueueFigure11.Theﬁltermechanismshowsasigniﬁ-cantimprovementinmeanvalueerroroverqueuemechanisms.Comparison of Value Error CDFfor Filter and Queue MechanismsMean Value Error (km/h)0510152025Cumulative Probability0.00.20.40.60.81.0Queue (1)Queue (50)UnboundedQueueFilterFigure12.TheCDFoftheﬁltermechanismshowsasigniﬁcantbiastowardlowererrorscomparedwiththequeuemechanisms.evaluatingqueuemechanismsandbyproposinginsteadusingaﬁltermechanism.AlthoughqueuesareusedsuccessfullyinInternetrouterstomanagebandwidthandoptimizethrough-put,wehaveshownthatqueuemechanismsarenotwellsuitedtoatleastsomeembeddedsystemgate-wayapplicationswhichrequiretimelydeliveryofdata.Animportantinsightisthatqueuedelayisaresultofqueueunderﬂow.Ourevaluationhasdemonstratedtheinherenttradeoﬀbetweendroppedmessagesanddelay,andwehaveshownhowbothdelayanddroppedmessagescanintroduceerrorinperiodic,continuous-valuedstatevariabledatastreams.Wehavealsodemonstratedthatasimpleﬁltermech-anismcanmitigatetheshortcomingsofthequeuemechanismandimprovegatewayperformanceoverqueuemechanisms.Oneassumptioninourapproachtodatahandlinginthegatewayisthattheminimumsamplingspeed978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
184
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 09:57:51 UTC from IEEE Xplore.  Restrictions apply. 
fortheapplicationcanbemetbythegatewaymech-anisms.Iftimingdiﬀerencesinthenetworksresultintoomanymessagesbeingdropped,thenusingthatnetworktopologymaybeinfeasible.Itispossiblethatmechanismswhichincludeestimation(suchasmoreadvancedversionsoftheﬁltersproposedhere)canmit-igatethisshortcoming,butitdependsonthecharacterofthedataandtheapplicationrequirements.Webelievethat,incontrasttoInternetrouters,suc-cessfulembeddedsystemgatewaydesignsaregoingtorequiresomeapplicationknowledge,orattheveryleast,knowledgeoftherequirementsforaparticulardatastream.Iftherearemultipledatastreamsinthegateway,thensomemethod(suchasaprioriconﬁgu-ration)mustbeinplacetoenumeratethesestreams,toselectadatamanagementmechanismforeachstream,andtodeﬁneparameters(suchasqueuelengthforaqueuemechanismordatamodeltypeforaﬁltermech-anism).Byenumeratingvariousmechanismsandthetypesofscenariostheyaresuitedfor,wecanprovideatoolkitofdatamanagementmechanismsthatcanbeusedatdesigntimetodevelopgatewayimplementationswithaﬁxedsetofmechanismsforspeciﬁcapplicationsanddatatypes.Givensuﬃcientunderstandingoftheimpactdiﬀerentmechanismshaveonvarioustypesofdatastreams,applicationsthemselvescouldcommuni-catewiththegatewayatruntimeandrequestapar-ticularmechanismforaparticulardatastreamviaanAPI,similartotheplug-and-play(uPNP)protocolem-ployedinmanycommodityhomerouters.Inthisway,theembeddedsystemgatewaycanmovetowardbe-comingagenericdevicethatcanbeusedwithmanysystemsandapplications.Aswecontinuetostudythedesignandimplemen-tationofembeddedsystemgateways,thereareseveralavenuesthatremaintobeexplored.Thesimpleﬁl-terintroducedinthispaperisjustthebeginningofthedesignspaceforﬁltermechanisms.Weplantoex-aminevariousestimationandregressionmethodsandevaluatetheireﬀectivenessasdatamodelsforvarioustypesofstatevariabledata.Wewillalsocontinuetoidentifyandevaluatenewdatamanagementmecha-nisms.Forexample,onemechanismthatislikelytobeneededisamechanismtoaggregatedata.Suchamechanismcouldbeusedwhenconnectingahighband-widthnetworktoalowbandwidthnetwork.Wealsoplantoevaluatethemechanismswehavealreadyiden-tiﬁedunderotherscenarios,suchastheembedded-to-enterpriseandembedded-to-embeddedscenarios.Justastheevaluationpresentedheregaveinsightintothedesignoftheﬁltermechanism,weexpecttheseotherscenariostoyieldsimilarinsightsandpossiblynewmechanismsaswell.AcknowledgmentThisresearchwasfundedbyGeneralMotorsthroughtheGM-CarnegieMellonVehicularInforma-tionTechnologyCollaborativeResearchLab.References[1]W.C.Feng,K.Shin,D.Kandlur,andD.Saha.TheBLUEactivequeuemanagementalgorithms.Network-ing,IEEE/ACMTransactionson,10(4):513–528,Aug2002.[2]FlexRay-Consortium.FlexRaycommunicationssys-tem,protocolspeciﬁcation,version2.0.Requestonline:http://www.flexray.com/specification_request.php.[3]S.FloydandV.Jacobson.Randomearlydetec-tiongatewaysforcongestionavoidance.Networking,IEEE/ACMTransactionson,1(4):397–413,Aug1993.[4]Q.Huang,J.S.Smith,andT.Li.Web-baseddis-tributedembeddedgatewaysystemdesign.InWI’06:Proceedingsofthe2006IEEE/WIC/ACMInter-nationalConferenceonWebIntelligence,pages905–908,Washington,DC,USA,2006.IEEEComputerSociety.[5]H.JiangandC.Dovrolis.Whyistheinternettraf-ﬁcburstyinshorttimescales?InSIGMETRICS’05:Proceedingsofthe2005ACMSIGMETRICSin-ternationalconferenceonMeasurementandmodelingofcomputersystems,pages241–252,NewYork,NY,USA,2005.ACMPress.[6]P.Koopman,J.Morris,andT.Maxino.Positionpa-per:Deeplyembeddedsurvivability.AROPlanningWorkshoponEmbeddedSystemsandNetworkSecu-rity,RaleighNC,Feb22-232007.[7]T.Lakshman,A.Neidhardt,andT.Ott.ThedropfromfrontstrategyinTCPandinTCPoverATM.IN-FOCOM’96.FifteenthAnnualJointConferenceoftheIEEEComputerSocieties.NetworkingtheNextGen-eration.ProceedingsIEEE,3:1242–1250vol.3,Mar1996.[8]A.Mankin.Randomdropcongestioncontrol.SIG-COMMComput.Commun.Rev.,20(4):1–7,1990.[9]J.Nilsson.Real-TimeControlSystemswithDelays.PhDthesis,LundInstituteofTechnology,1998.[10]RobertBosch,GmbH.CANspeciﬁcation,version2.0,1991.[11]J.Samuel.Emissionrelateddiagnosticservices.IEEECommunicationStandardsforEuropeanOn-Board-DiagnosticsSeminar(Ref.No.1998/294),pages10/1–10/6,Feb1998.[12]H.Sirisena,A.Haider,andK.Pawlikowski.Auto-tuningREDforaccuratequeuecontrol.GlobalTelecommunicationsConference,2002.GLOBECOM’02.IEEE,2:2010–2015vol.2,Nov.2002.[13]TTA-Group.Time-triggeredprotocolTTP/C,high-levelspeciﬁcationdocument,protocolversion1.1.Requestonline:http://www.ttagroup.org/technology/specification.htm,2003.