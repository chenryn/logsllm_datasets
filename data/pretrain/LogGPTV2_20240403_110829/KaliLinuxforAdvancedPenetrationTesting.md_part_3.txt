Preface
Who this book is for
This book is intended for people who want to know more about data security.
In particular, it targets people who want to understand why they use a particular
tool when they do, as opposed to those people who throw as many tools as possible
at a system to see if an exploit will happen. My goal is for the readers to develop their
own method and approach to effective penetration testing, which will allow them to
experiment and learn as they progress. I believe that this approach is the only effective
way to understand how malicious people attack data systems, and therefore, the only
way to understand how to mediate vulnerabilities before they can be exploited.
If you are a security professional, penetration tester, or just have an interest in the
security of complex data environments, this book is for you.
Conventions
In this book, you will find a number of styles of text that distinguish between
different kinds of information. Here are some examples of these styles, and an
explanation of their meaning.
Code words in text, database table names, folder names, filenames, file extensions,
pathnames, dummy URLs, user input, and Twitter handles are shown as follows:
"In this particular case, the VM has been assigned an IP address of
192.168.204.132."
A block of code is set as follows:
# MSF port scanner
onhost_add {
println("[*] MSF Port Scanner New Host OpenPorts on$1");
$console = console();
cmd($console, "use auxiliary/scanner/portscan/tcp");
cmd($console, "set THREADS 12");
cmd($console, "set PORTS 139, 143");
# enter other ports as required
cmd($console, "set RHOSTS $1");
cmd($console, "run -j");
cmd($console, "use auxiliary/scanner/discovery/udp_sweep");
cmd($console, "set THREADS 12");
cmd($console, "set BATCHSIZE 256");
cmd($console, "set RHOSTS $1");
cmd($console, "run -j");
db_sync();
}
[ 8 ]
Preface
Any command-line input or output is written as follows:
root@kali~# update-rc.d networking defaults
New terms and important words are shown in bold. Words that you see on the
screen, in menus or dialog boxes for example, appear in the text like this: "If you
double-click on the truecrypt1 icon, you will be taken to a File Browser view."
Warnings or important notes appear in a box like this.
Tips and tricks appear like this.
Reader feedback
Feedback from our readers is always welcome. Let us know what you think about
this book—what you liked or may have disliked. Reader feedback is important for us
to develop titles that you really get the most out of.
To send us general feedback, simply send an e-mail to PI:EMAIL,
and mention the book title via the subject of your message.
If there is a topic that you have expertise in and you are interested in either writing
or contributing to a book, see our author guide on www.packtpub.com/authors.
Customer support
Now that you are the proud owner of a Packt book, we have a number of things to
help you to get the most from your purchase.
[ 9 ]
Preface
Errata
Although we have taken every care to ensure the accuracy of our content, mistakes
do happen. If you find a mistake in one of our books—maybe a mistake in the text or
the code—we would be grateful if you would report this to us. By doing so, you can
save other readers from frustration and help us improve subsequent versions of this
book. If you find any errata, please report them by visiting http://www.packtpub.
com/submit-errata, selecting your book, clicking on the errata submission form link,
and entering the details of your errata. Once your errata are verified, your submission
will be accepted and the errata will be uploaded on our website, or added to any list of
existing errata, under the Errata section of that title. Any existing errata can be viewed
by selecting your title from http://www.packtpub.com/support.
Piracy
Piracy of copyright material on the Internet is an ongoing problem across all media.
At Packt, we take the protection of our copyright and licenses very seriously. If you
come across any illegal copies of our works, in any form, on the Internet, please
provide us with the location address or website name immediately so that we can
pursue a remedy.
Please contact us at PI:EMAIL with a link to the suspected
pirated material.
We appreciate your help in protecting our authors, and our ability to bring
you valuable content.
Questions
You can contact us at PI:EMAIL if you are having a problem with
any aspect of the book, and we will do our best to address it.
[ 10 ]
Disclaimer
The content within this book is for educational purposes only. It is designed to help
users test their own system against information security threats and protect their
IT infrastructure from similar attacks. Packt Publishing and the author of this book
take no responsibility for actions resulting from the inappropriate usage of learning
materials contained within this book.
Part 1
The Attacker's
Kill Chain
Starting with Kali Linux
Identifying the Target – Passive
Reconnaissance
Active Reconnaissance and
Vulnerability Scanning
Exploit
Post Exploit – Action on
the Objective
Post Exploit – Persistence
Starting with Kali Linux
Kali Linux (Kali) is the successor to the BackTrack penetration testing platform
which is generally regarded as the de facto standard package of tools used to facilitate
penetration testing to secure data and voice networks. This chapter provides an
introduction to Kali, and focuses on customizing Kali to support some advanced
aspects of penetration testing. By the end of this chapter, you will have learned:
• An overview of Kali
• Configuring network services and secure communications
• Updating Kali
• Customizing Kali
• Extending Kali's functionality with third-party applications
• Effective management of penetration tests
Kali Linux
BackTrack (BT), (www.offensive-security.com) was released to provide an
extensive variety of penetration testing and defensive tools that were perfect for
auditors and network administrators interested in assessing and securing their
networks. The same tools were used by both authorized and unauthorized
(hackers) penetration testers.
The final version of BackTrack, BT 5r3, was released in August 2012. Based on
the Ubuntu Linux platform, it was widely adopted and supported by the security
community. Unfortunately, its file architecture made it difficult to manage the
array of tools and their accompanying dependencies.
Starting with Kali Linux
In BackTrack, all of the tools used for penetration testing were placed in the
/pentest directory. Subfolders such as /web or /database helped to further define
the location of tools. Finding and executing tools within this hierarchy could be
counterintuitive. For example, is sqlninja, which identifies an SQL injection, a web
vulnerability assessment tool, a web exploit tool, or a database exploit tool?
In March 2013, BackTrack was superseded by Kali Linux, which uses a new platform
architecture based on the Debian GNU/Linux operating system.
Debian adheres to the Filesystem Hierarchy Standard (FHS), which is a significant
advantage over BackTrack. Instead of needing to navigate through the /pentest tree,
you can call a tool from anywhere on the system because applications are included in
the system path.
Other features of Kali include the following:
• Support for multiple desktop environments such as Gnome, KDE, LXDE,
and XFCE, and provides multilingual support.
• Debian-compliant tools are synchronized with the Debian repositories
at least four times daily, making it easier to update packages and apply
security fixes.
• Support for ISO customizations, allowing users to build their own versions of
Kali. The bootstrap function also performs enterprise-wide network installs
that can be automated using pre-seed files.
• ARMEL and ARMHF support allows Kali to be installed on devices such as
Raspberry Pi, ODROID-U2/-X2, and the Samsung Chromebook.
• Over 300 penetration testing data forensics and defensive tools are included.
They provide extensive wireless support with kernel patches to permit the
packet injection required by some wireless attacks.
• Kali remains an open source project that is free. Most importantly, it is well
supported by an active online community.
Throughout this book, we'll be using a VMware virtual machine (VM) of 64-bit
Kali (refer to Appendix, Installing Kali Linux for instructions on installing Kali).
A VM is used because it makes it easy to rapidly execute certain applications
in other operating systems, such as Microsoft Windows. In addition, a VM can
be archived with the results from a penetration test, allowing the archive to be
reviewed to determine if a particular vulnerability would have been detected
with the toolset that was used for testing.
[ 16 ]
Chapter 1
When Kali is launched, the user will be taken to the default desktop GUI with a menu
bar at the top and a few simple icons. By selecting the menu item Applications, and
then Kali Linux, the user will gain access to a menu system that contains the Top 10
Security Tools as well as a series of folders, organized in the general order that would
be followed during a penetration test, as shown in the following screenshot:
The menu will be familiar to users of BT 5r3. However, there
are some changes, which include simplified access to network
services and communications.
[ 17 ]
Starting with Kali Linux
Configuring network services and secure
communications
The first step in being able to use Kali is to ensure that it has connectivity to either a
wired or wireless network to support updates and customization.
You may need to obtain an IP address by DHCP (Dynamic Host Configuration
Protocol), or assign one statically. First, confirm your IP address using the ifconfig
command from a terminal window, as shown in the following screenshot:
In this particular case, the VM has been assigned an IP address of 192.168.204.132.
If an IP address was not obtained, an address can be assigned by DHCP using the
command dhclient eth0 (or other available interfaces, which will depend on the
specific configuration of the system being used).
If a static IP address is used, additional information may be required. For example,
you can assign a static IP of 192.168.204.128 as follows:
host IP address: 192.168.204.128
subnet mask: 255.255.255.0
default gateway: 192.168.204.1
DNS server: 192.168.204.10
[ 18 ]
Chapter 1
Enter a terminal window and enter the following command:
root@kali:~# ifonconfig eth0 192.168.204.128/24
root@kali:~# route add default gw 192.168.204.1
root@kali:~# echo nameserver 192.168.204.10 > /etc/resolv.conf
Changes made to IP settings are nonpersistent, and will be lost when Kali is
rebooted. To make the changes permanent, you will need to edit the /etc/network/
interfaces file, as shown in the following screenshot:
By default, Kali does not start with the DHCP service enabled. Doing so announces
the new IP address on the network, and this may alert administrators about the
presence of the tester. For some test cases, this may not be an issue, and it may be
advantageous to have certain services start automatically during boot up. This can
be achieved by entering the following commands:
root@kali~# update-rc.d networking defaults
root@kali~# /etc/init.d/networking restart
Kali installs with network services that can be started or stopped as required,
including DHCP, HTTP, SSH, TFTP, and the VNC server. These services are usually
invoked from the command line, however, some are accessible from the Kali menu.
[ 19 ]
Starting with Kali Linux
Adjusting network proxy settings
Users located behind an authenticated or unauthenticated proxy
connection must modify bash.bashrc and apt.conf. Both files are located in the
/root/etc directory.
1. Edit the bash.bashrc file, as shown in the following screenshot, use a text
editor to add the following lines to the bottom of the bash.bashrc file:
export ftp_proxy="ftp://user:password@proxyIP:port"
export http_proxy="http://user:password@proxyIP:port"
export https_proxy="https://user:password@proxyIP:port"
export socks_proxy="https://user:password@proxyIP:port"
2. Replace proxyIP and port with your proxy IP address and port number
respectively, and replace the username and password with your
authentication username and password. If there's no need to authenticate,
write only the part following the @ symbol.
3. In the same directory, create the apt.conf file and enter the following
command lines, as shown in the following screenshot:
[ 20 ]
Chapter 1
4. Save and close the file. Log out and then log in to activate the new settings.
Securing communications with Secure Shell
To minimize detection by a target network during testing, Kali does not enable any
externally-listening network services. Some services, such as Secure Shell (SSH),
are already installed. However, they must be enabled prior to use.
Kali comes preconfigured with default SSH keys. Before starting the SSH service,
it's a good idea to disable the default keys and generate a unique keyset for use.
Move the default SSH keys to a backup folder, and then generate a new SSH keyset
using the following command:
dpkg-reconfigure openssh-server
The process of moving the original keys and generating the new keyset is shown in
the following screenshot.
[ 21 ]
Starting with Kali Linux
To verify that the newly generated keys are unique, calculate their md5sum hash
values, and compare with the original keys as shown in the following screenshot.
To start the SSH service using the menu, select Applications | Kali Linux |
System Services | SSHD | SSHD Start.
To start SSH from the command line, use the command line shown in the
following screenshot:
To verify that SSH is running, perform a netstat query, as shown in the
following screenshot:
The SSH daemon is listening on port 22 in the previous example. To stop SSH, use
the following command:
/etc/init.d/ssh stop
[ 22 ]
Chapter 1
Updating Kali Linux
Kali must be patched regularly to ensure that the base operating system and
applications are up-to-date and that security patches have been applied.
The Debian package management system
Debian's package management system relies on discrete bundled applications
called packages. Packages can be installed or removed by the user to customize the
environment, and support tasks such as penetration testing. They can also extend
the functionality of Kali, supporting tasks, such as communications (Skype, instant
messaging, and secure e-mails) or documentation (OpenOffice and Microsoft Office
running under Wine).
Packages are stored in repositories and are downloaded to the system user to ensure
the integrity of the package.
Packages and repositories
By default, Kali uses only the official Kali repositories. It is possible that an
incomplete installation process may not add the repositories to the correct sources.
list file, or that you may wish to extend the available repositories when new
applications are added.
Updating the source.list file can be done from the command line (echo deb
http://http.kali.org/kiali kali main contrib non-free >> /etc/apt/
sources.list), or by using a text editor.
The default package repositories that should be present in /etc/apt/sources.list
are listed as follows; if not present, edit the sources.list file to include them:
## Kali
deb http://http.kali.org/kali kali main contrib non-free
## Kali-dev
deb http://http.kali.org/kali kali-dev main contrib non-free
## Kali Security updates
deb http://security.kali.org/kali-security kali/updates main
contrib non-free
Not every Kali tool is presently maintained in the official tool repositories. If you
choose to update a tool manually, it is possible that you will overwrite existing
packaged files and break dependencies. Therefore, some tools that have not been
officially moved to Debian repositories, such as the aircrack-ng, dnsrecon, sqlmap,
beef-xss, and Social Engineering Toolkit (se-toolkit), are maintained in the Bleeding
Edge repository. This repository may also be added to sources.list using the
following command line:
## Bleeding Edge repository
deb http://repo.kali.org/kali kali kali-bleeding-edge main
[ 23 ]
Starting with Kali Linux
Dpkg
Dpkg is Debian's package management system. This command-line application is
used to install, remove, and query packages. In general, dpkg performs actions on
individual packages.
dpkg is particularly useful in compiling a list of installed
applications in Kali using the command dpkg -l > list.txt.
If you want to know if a specific tool is installed, use dpkg -l |
grep .
The following screenshot shows an excerpt of the returned data when dpkg -l is
invoked, providing a list of all applications installed on the Kali distribution; this is
particularly useful in identifying applications that may only be accessible directly
from the command line.
Using Advanced Packaging Tools
Advanced Packaging Tools (APT), extend the functionalities of dkpg by searching
repositories and installing or upgrading packages along with all the required
dependencies. The APT can also be used to upgrade a complete distribution.
The most common apt commands are as follows:
• apt-get update: This is used to resynchronize the local package index
files with their source as defined in /etc/apt/sources.list. The update
command should always be used first, before performing an upgrade or
dist-upgrade.
• apt-get upgrade: This is used to install the newest versions of all packages
installed on the system using /etc/apt/sources.list. Packages that are