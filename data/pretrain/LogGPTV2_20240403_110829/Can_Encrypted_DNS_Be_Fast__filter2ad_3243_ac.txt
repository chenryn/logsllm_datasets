A. Hounsel et al.
DoH Performs Worse Than Conventional DNS and DoT as Latencies To
Resolvers Increase. Figure 3 shows that DoH performs substantially worse when
latency between the client and recursive resolver is high; Fig. 4 shows a simi-
lar result with a ridge regression model. As discussed in Sect. 3.2, this result
could be explained by either HTTPS overhead, nascent DoH implementations
and deployments, or both.
(a) Default
(b) Resolver X
(c) Resolver Y
(d) Resolver Z
Fig. 5. Query response times based on downstream access ISP throughput.
Subscribed Throughput Aﬀects DNS Performance. Figure 5 shows DNS response
times across each of the open resolvers as well as the default resolver. We bin the
downstream throughput into four groups using clustering based on kernel density
estimation. The performance for all protocols tends to improve as throughput
increases, with DoH experiencing the most relative improvement. For example,
for users with throughput that is less than 25 Mbps, the median query response
times for Resolver Y DoH and Y DNS are 73.4 ms and 48.7 ms, respectively.
As throughput increases from 25 Mbs to 400 Mbps, the median query response
times for Y DoH and Y DNS are 41.2 ms and 31.4 ms, respectively. DoT performs
similarly to conventional DNS regardless of downstream throughput. Across all
groups, the absolute performance diﬀerence between Resolver X DoT and X DNS
by 0.2 ms, 1.9 ms, 0.1 ms, and 1.4 ms, respectively. For Resolver Y, DoT again
Can Encrypted DNS Be Fast?
455
performs faster than DNS in median query response times when throughput is
less than 800 Mbps. For the three lower throughput groups, Y DoT performs
faster than Y DNS by 1.4 ms, 2.5 ms, and 1.7 ms, respectively.
(a) Resolver X
(b) Resolver Y
(c) Resolver Z
Fig. 6. Per-ISP query response times.
3.4 Does Encrypted DNS Resolver Performance Vary Across ISPs?
Figure 6 shows how encrypted DNS response times vary across diﬀerent resolvers
and ISPs. In short, the choice of resolver matters, and the “best” encrypted DNS
resolver also may depend on the user’s ISP. For instance, while ISP C is com-
parable to the other ISPs for queries sent to Resolver X, ISP C has signiﬁcantly
lower query response times to Resolver Y, and is one of the poorest perform-
ing ISPs on Resolver Z. The diﬀerence in median query response times between
Resolver X DoH and X DNS was 20.9 ms for Whiteboxes on ISP D, and 8.9 ms
for Whiteboxes on ISP E; for Z DoH, the diﬀerence in median times was 34.5
ms for Whiteboxes on ISP D, and 47.9 ms for Whiteboxes on ISP E.
Resolver performance can also diﬀer across ISPs. For ISP B, the median
query response time for Z DoT is 11.1 ms faster than Z DNS. However, for ISP
C, Z DoT is signiﬁcantly slower than DNS, with a diﬀerence in median query
response times of 30.6 ms. We attribute this diﬀerence in performance to higher
latency to Resolver Z via ISP C. The median latency to Z DNS and DoT across
Whiteboxes on ISP C was 50 ms, compared to 18.5 ms on ISP B.
4 Related Work
Researchers have compared the performance of DNS, DoT, and DoH in various
ways. Zhu et al. proposed DoT to encrypt DNS traﬃc between clients and recur-
sive resolvers [25]. They modeled its performance and found that DoT’s overhead
can be largely eliminated with connection re-use. B¨ottger et al. measured the
eﬀect of DoT and DoH on query response times and page load times from a uni-
versity network [3]. They ﬁnd that DNS generally outperforms DoT in response
times, and DoT outperforms DoH. Hounsel et al. also measure response times
and page load times for DNS, DoT, and DoH using Amazon EC2 instances [9].
456
A. Hounsel et al.
They ﬁnd that despite higher response times, page load times for DoT and DoH
can be faster than DNS on lossy networks. Lu et al. utilized residential TCP
SOCKS networks to measure response times from 166 countries and found that,
in the median case with connection re-use, DoT and DoH were slower than
conventional DNS over TCP by 9 ms and 6 ms, respectively [14].
Researchers have also studied in depth how DNS inﬂuences application per-
formance. Sundaresan et al. used an early MBA deployment of 4,200 home gate-
ways to identify performance bottlenecks for residential broadband networks [22].
This study found that page load times for users in home networks are signiﬁ-
cantly inﬂuenced by slow DNS response times. Wang et al. introduced WProf,
a proﬁling system that analyzes various factors that contribute to page load
times [23]. They found that queries for uncached domain names at recursive
resolvers can account for up to 13% of the critical path delay for page loads.
Otto et al. found that CDN performance was signiﬁcantly aﬀected by clients
choosing recursive resolvers that are far away from CDN caches [18]. As a result
of these ﬁndings. Otto et al. proposed namehelp, a DNS proxy that sends queries
for CDN-hosted content to directly to authoritative servers. Allman studied con-
ventional DNS performance from 100 residences in a neighborhood and found
that only 3.6% of connections were blocked on DNS with lookup times greater
than either 20 ms or 1% of the application’s total transaction time [1].
Past work studied the performance impact of “last mile” connections to home
networks in various ways. Kreibich et al. proposed Netalyzr as a Java applet that
users run from devices in their home networks to test debug their Internet con-
nectivity. Netalyzr probes test servers outside of the home network to measure
latency, IPv6 support, DNS manipulation, and more. Their system was run from
over 99,000 public IP addresses, which enabled them to study network connec-
tivity at scale [12]. Dischinger et al. measured bandwidth, latency, and packet
loss from 1,894 hosts and 11 major commercial cable and DSL providers in North
America and Europe. This work found that the “last mile” connection between
an ISP and a home network is often a performance bottleneck, which they could
not have captured by performing measurements outside of the home network.
However, their measurements were performed from hosts located within homes,
rather than the home gateway. This introduces confounding factors between
hosts and the home gateway, such as poor Wi-Fi performance.
5 Conclusion
In this paper, we studied the performance of encrypted DNS protocols and DNS
from 2,693 Whiteboxes in the United States, between April 7th, 2020 and May
8th, 2020. We found that clients do not have to trade DNS performance for
privacy. For certain resolvers, DoT was able to perform faster than DNS in
median response times, even as latency increased. We also found signiﬁcant
variation in DoH performance across recursive resolvers. Based on these results,
we recommend that DNS clients (e.g., web browsers) measure latency to resolvers
and DNS response times determine which protocol and resolver a client should
use. No single DNS protocol nor resolver performed the best for all clients.
Can Encrypted DNS Be Fast?
457
There were some limitations to our work that point to future research. First,
due to bandwidth restrictions, we were unable to perform page loads from White-
boxes. Future work could utilize platforms of similar scale to SamKnows to mea-
sure page loads, such as browser telemetry systems. Second, future work should
perform measurements from mobile devices. DoT was implemented in Android
10, but to our knowledge, its performance has not been studied “in the wild.”
Finally, future work could study how encrypted DNS protocols perform from net-
works that are far away from popular resolvers. This is particularly important
for browser vendors that seek to deploy DoH outside of the United States.
Acknowledgements. We thank the Federal Communications Commission’s Measur-
ing Broadband America (MBA) program and the associated MBA-Assisted Research
(MARS) Program for assistance in conducting this study, Jason Livingood and Al Mor-
ton for initial study design suggestions, the MBA collaborative for experiment input,
and Sam Crawford from SamKnows with assistance in measurement implementation
and deployment. This research was funded in part by National Science Foundation
Award CNS-1704077 and a Comcast Innovation Fund.
References
1. Allman, M.: Putting DNS in context. In: Chritin, N., Pelechrinis, K., Sekar, V.
(eds.) Proceedings of the 2020 Internet Measurement Conference (IMC). Associa-
tion for Computing Machinery (ACM) (2020)
2. Bortzmeyer, S.: DNS Privacy Considerations. RFC 7626, RFC Editor (2015).
http://www.ietf.org/rfc/rfc7626.txt. (Informational)
3. B¨ottger, T., et al.: An empirical study of the cost of DNS-over-https. In: Sperotto,
A., van Rijswijk-Deij, R., Hesselman, C. (eds.) Proceedings of the 2019 Internet
Measurement Conference, Amsterdam, Netherlands, pp. 15–21. Association for
Computing Machinery (ACM) (2019). https://doi.org/10.1145/3355369.3355575.
https://dl.acm.org/doi/pdf/10.1145/3355369.3355575
4. Facebook Experimental: Doh proxy (2020). https://facebookexperimental.github.
io/doh-proxy/
5. Federal Communications Commission: MBA Assisted Research Studies (2020).
https://www.fcc.gov/general/mba-assisted-research-studies
6. Federal Communications Commission: Measuring Broadband America (2020).
https://www.fcc.gov/general/measuring-broadband-america
7. getdns Team: getdns/stubby (2019). https://github.com/getdnsapi/stubby
8. Hoﬀman, P., McManus, P.: DNS Queries over HTTPS (DoH). RFC 8484, RFC
Editor (2018). http://www.ietf.org/rfc/rfc8484.txt. (Proposed Standard)
9. Hounsel, A., Borgolte, K., Schmitt, P., Holland, J., Feamster, N.: Comparing
the eﬀects of DNS, dot, and DOH on web performance. In: Huang, Y., King,
I., Liu, T.Y., van Steen, M. (eds.) Proceedings of the 28th The Web Confer-
ence (WWW), Taipei, Taiwan, pp. 562–572. Association for Computing Machinery
(ACM) (2020). https://doi.org/10.1145/3366423.3380139. https://dl.acm.org/doi/
pdf/10.1145/3366423.3380139
10. Hu, Z., Zhu, L., Heidemann, J., Mankin, A., Wessel, D., Hoﬀman, P.: Speciﬁcation
for DNS over Transport Layer Security (TLS). RFC 7858, RFC Editor (2016).
http://www.ietf.org/rfc/rfc7858.txt. (Proposed Standard)
458
A. Hounsel et al.
11. Jackson, M.: Firmware update for UK sky broadband ISP routers botches
DNS update (2019). https://www.ispreview.co.uk/index.php/2019/04/ﬁrmware-
update-for-uk-sky-broadband-isp-routers-botches-dns.html
12. Kreibich, C., Weaver, N., Nechaev, B., Paxson, V.: Netalyzr: illuminating the edge
network. In: Allman, M. (ed.) Proceedings of the 10th ACM SIGCOMM Confer-
ence on Internet Measurement (IMC), Melbourne, Australia, pp. 246–259. Associ-
ation for Computing Machinery (ACM) (2010). https://doi.org/10.1145/1879141.
1879173. https://dl.acm.org/doi/pdf/10.1145/1879141.1879173
13. L. Pochat, V., V. Goethem, T., Tajalizadehkhoob, S., Korczy´nski, M., Joosen, W.:
Tranco: a research-oriented top sites ranking hardened against manipulation. In:
Oprea, A., Xu, D. (eds.) Proceedings of the 26th Network and Distributed System
Security Symposium (NDSS), San Diego, CA, USA, pp. 1–15. Internet Society (ISOC)
(2019). https://doi.org/10.14722/ndss.2019.23386. https://www.ndss-symposium.
org/wp-content/uploads/2019/02/ndss2019 01B-3 LePochat paper.pdf
14. Lu, C., et al.: An end-to-end, large-scale measurement of DNS-over-encryption: how
far have we come? In: Sperotto, A., van Rijswijk-Deij, R., Hesselman, C. (eds.) Pro-
ceedings of the 2019 Internet Measurement Conference, Amsterdam, Netherlands,
pp. 22–35. Association for Computing Machinery (ACM) (2019). https://doi.org/
10.1145/3355369.3355580. https://dl.acm.org/doi/pdf/10.1145/3355369.3355580
15. McManus, P.: Firefox Nightly Secure DNS Experimental Results (2018). https://
blog.nightly.mozilla.org/2018/08/28/ﬁrefox-nightly-secure-dns-experimental-
results/
16. Mozilla: All.js
(2020). https://searchfox.org/mozilla-central/source/modules/
libpref/init/all.js#1425
17. Mozilla: TRRServiceChannel.cpp (2020). https://searchfox.org/mozilla-central/
source/netwerk/protocol/http/TRRServiceChannel.cpp#512
18. Otto, J.S., S´anchez, M.A., Rula, J.P., Bustamante, F.E.: Content delivery and the
natural evolution of DNS: remote DNS trends, performance issues and alternative
solutions. In: Mahajan, R., Snoeren, A. (eds.) Proceedings of the 2012 Internet
Measurement Conference (IMC), Boston, MA, USA, pp. 523–536. Association for
Computing Machinery (ACM) (2012). https://doi.org/10.1145/2398776.2398831.
https://dl.acm.org/doi/pdf/10.1145/2398776.2398831
19. SamKnows: DNS resolution (2020). https://samknows.com/technology/tests/dns-
resolution
20. SamKnows: SamKnows (2020). https://www.samknows.com/
21. SamKnows: SamKnows Whitebox (2020). https://samknows.com/technology/
agents/samknows-whitebox#speciﬁcations
22. Sundaresan, S., Feamster, N., Teixeira, R., Magharei, N.: Measuring and mitigat-
ing web performance bottlenecks in broadband access networks. In: Gummadi,
K., Partidge, C. (eds.) Proceedings of the 2013 Internet Measurement Confer-
ence (IMC), Barcelona, Spain, pp. 213–226. Association for Computing Machinery
(ACM) (2013). https://doi.org/10.1145/2504730.2504741. https://dl.acm.org/doi/
10.1145/2504730.2504741
23. Wang, X.S., Balasubramanian, A., Krishnamurthy, A., Wetherall, D.: Demys-
In: Feamster, N., Mogul, J.
tifying page load performance with WProf.
the 10th USENIX Symposium on Networked Sys-
(eds.) Proceedings of
tems Design and Implementation (NSDI), Lombard,
IL, USA, pp. 473–
487. USENIX Association (2013). https://www.usenix.org/conference/nsdi13/
technical-sessions/presentation/wang xiao
Can Encrypted DNS Be Fast?
459
24. Webshrinker: APIs - Webshrinker (2020). https://www.webshrinker.com/apis/
25. Zhu, L., Hu, Z., Heidemann, J., Wessels, D., Mankin, A., Somaiya, N.: Connection-
oriented DNS to improve privacy and security. In: Shmatikov, V., Bauer, L.
(eds.) Proceedings of the 36th IEEE Symposium on Security & Privacy (S&P),
San Jose, CA, USA, pp. 171–186. Institute of Electrical and Electronics Engi-
neers (IEEE) (2015). https://doi.org/10.1109/sp.2015.18. https://ieeexplore.ieee.
org/stamp/stamp.jsp?arnumber=7163025
Open Access This chapter is licensed under the terms of the Creative Commons
Attribution 4.0 International License (http://creativecommons.org/licenses/by/4.0/),
which permits use, sharing, adaptation, distribution and reproduction in any medium
or format, as long as you give appropriate credit to the original author(s) and the
source, provide a link to the Creative Commons license and indicate if changes were
made.
The images or other third party material in this chapter are included in the
chapter’s Creative Commons license, unless indicated otherwise in a credit line to the
material. If material is not included in the chapter’s Creative Commons license and
your intended use is not permitted by statutory regulation or exceeds the permitted
use, you will need to obtain permission directly from the copyright holder.