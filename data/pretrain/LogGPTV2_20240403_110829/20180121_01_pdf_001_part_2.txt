software
高效 高效
升降配API PostgreSQL
SSD SSD
云盘 不需要拷贝数据 云盘 data files
多副本 多副本
双机版
• 架构
• 备份
• 克隆实例
• 规格变更
• 只读节点
• 异地容灾
架构
SLB 集群
主 备
PostgreSQL
物理主机 物理主机
HA
software 流复制
管
控
平
台
PostgreSQL
data files SSD SSD
redo files 磁盘 磁盘
...
同城A机房 同城B机房
备份
用户配置
备份调度
主 备
PostgreSQL
物理主机 物理主机
software 流复制
PostgreSQL
数据文件，
data files SSD SSD
redo files 磁盘 磁盘 REDO 归档
...
备份到OSS
同城A机房 同城B机房
OSS 对象存储
克隆实例
1、新建空实例
主 备
PostgreSQL
物理主机 物理主机
software 流复制
PostgreSQL
data files SSD SSD
redo files 磁盘 磁盘
...
同城A机房 同城B机房
2、从OSS的备份
恢复到指定时间点。
OSS 对象存储
完成克隆实例
规格变更 原地变更
-
对业务影响，闪断
1、备库变更
2、主备切换
主 备 3、老主库变更
PostgreSQL
物理主机 物理主机
software 流复制
PostgreSQL
data files SSD SSD
redo files 磁盘 磁盘
...
同城A机房 同城B机房
规格变更 跨机变更
-
对业务影响，闪断
1、选择主机
2、新建2备库
老集群
3、ENDPOINT切换
新备 新备
物理主机 物理主机
只读实例
只读实例HA集群
主 备
流复制
PostgreSQL
物理主机 物理主机 物理主机 物理主机
software 流复制
PostgreSQL
data files SSD SSD SSD SSD
redo files 磁盘 磁盘 磁盘 磁盘
...
同城A机房 同城B机房
异地容灾
• 暂无容灾产品
• 创建异地只读实例，变相实现
产品体系
- RDS for PG
OLTP OLAP 分级存储
•JSON、数组、K-V等扩展类型 • 多核并行计算(9.6+)
• 本地存储上限 3TB
•函数、存储过程 • TB级实时分析
•全文检索、模糊查询 • 复杂JOIN • OSS存储无上限
•数组、文本、图像相似搜索 • 任意字段组合Ad-Hoc 查询 • 每线程30MB/s
•2d,3d,4d 空间数据, 兼容 • SQL流式计算
ArcGIS
• FDW based sharding
•逻辑订阅（单元化）
• pushdown select-clause,
•流式主备复制、延迟低至毫
where, sort, join, agg,
秒(不担心大事务)
operator, function
•AWR报告、扩展插件
产品体系 双机版
- PPAS(POLARDB )
产品体系 双机版
- PPAS(POLARDB )
产品体系 双机版
- PPAS(POLARDB )
Oracle兼容 OLTP+OLAP 增强功能 分级存储
•语法 •复杂SQL •SQL防火墙 •本地存储3TB
•内置函数 •函数、存储过程 •OSS存储无上限
•自动索引推荐
•PL/SQL存储过程 •全文检索、模糊查询 •每线程30MB/s
•AWR报告功能 •空间数据GIS •CPU\IO 资源组管理
•JSON
•ADAM评估去O风险 •多核并行计算(9.6+)
•1周输出详细报告 •TB级实时分析
•FDW based sharding
•pushdown select-clause, where,
sort, join, agg, operator,
function
去 生态 专版
O - ADAM PPAS
心里有底去O。
https://www.aliyun.com/product/adam
去 生态 专版
O - ADAM PPAS
去 生态 专版
O - ADAM PPAS
依赖分析
SQL类型分析
自动拆库
垂直拆
水平拆
按SQL类型拆
某 去 上云
GaTrKgl O (2017)
部分报告截图 对象详情
-
部分报告截图 兼容性、工作量详情
-
部分报告截图 风险点详情
-
部分报告截图 不兼容修改建议
-
部分报告截图
产品体系
- HDB PG
传统分库分表架构缺陷
传统分库分表
架构：
限制、缺陷。
产品体系
- HDB PG
产品体系
- HDB PG
多阶段聚合 降低网络开销
-
产品体系
- HDB PG
数据写入实时，查询无延迟，
实时BUILD索引，查询无延迟，
无需索引维护，
支持事务，
标准关系数据库
完全兼容ACID标准，不会出现数据陡降异常问题，
+
数据两副本，支持高可用，
实时分析能力
支持多表任意列JOIN、GROUP BY，无需维表，
支持UDF函数，
支持UDF函数排序，
支持UDF函数索引，
支持任意数量级精准count(distinct)， 支持表达式索引，
支持返回大结果集(没有记录数限制)， 支持修改表结构，
支持翻页查询， 支持单条、多条、批量UPDATE，
支持游标。 支持多值列的存储、搜索、显示查询（内容可见），
产品体系
- HDB PG
产品体系
- HDB PG
产品体系
- HDB PG
分析SQL兼容 海量OLAP 分级存储
•复杂分析SQL、UDF • 多机并行计算 •本地SSD存储
•窗口查询、Grouping Sets • 行、列混存、支持压缩 •4TB/主机(有效)
•plpython, pljava，函数计算 • 复合分布键、随机分布键
•OSS二级存储
•机器学习库MADlib • 范围、枚举分区
•空间数据PostGIS •30MB/s/线程
• hash\merge\nestloop JOIN
•JSON、数组、全文检索 • 多阶段JOIN •物理Mirror
•估值计算HLL
• 支持任意字段JOIN •大事务，低延迟
•扩展插件（无限可能）
• MetaScan
产品体系 集群版
- POLARDB
问题根源？
• SQL只能用到单CORE，慢
• 升级需要迁移数据，慢
• 增加只读节点，需要迁移数据，慢
• 读写分离依靠SLAVE增量复制，延迟高
• 添加字段带来数据重写，逻辑SLAVE回放需要等待上游事务结束再开
始，延迟高
• 主节点写压力大，逻辑SLAVE容易中断
• 存储使用本地磁盘，容易达到空间上限
• 逻辑备份时，表结构不能变更，可能出现锁冲突
• 备份需要拖全量，实例越大，耗时越久
• 高并发访问时，实例扛不住
传统分库分表架构 缺陷
-
传统分库分表
架构：
限制、缺陷。
集群版
POLARDB PG
在线 分析
每一层都
业务 业务
可以横向
扩展 负载均衡
。。。
一期： 计算节点 计算节点 计算节点
... 弹性增加节点
一写多读 PG 实例 PG 实例 PG 实例
(增加节点不需要拷贝数据, 快！)
IB互联
自主研发存
储层：
支持压缩、
加密、算子
分布式，共享块存储
下推、过滤
等
集群版
POLARDB PG
Median
冷热数据分离
• 通过 OSS扩展无限容量
PPAS POLARDB PG
外部表、支持读写、并行
阿里云OSS海量对象存储
切换 快
-
内置位点推进算法，
切换时，需要APPLY的REDO极少。
速度快。
主节点异常时，
计算节点 计算节点 计算节点
切换到LSN位点最新
PG 实例 PG 实例 PG 实例
的节点
分布式，共享块存储
扩容 快
-
计算节点 计算节点 扩容时，增加计算节点。 计算节点
PG 实例 PG 实例 无需拷贝数据，快。 PG 实例
分布式，共享块存储
扩容 快
-
计算节点算力扩容，无需拷贝数据。
计算节点 计算节点 计算节点
原地扩，或者使用新的计算节点扩容。
PG 实例 PG 实例 切换角色。 PG 实例
快！
分布式，共享块存储
存储自动扩容、按需收费
实际使用容量
计算节点 计算节点
PG 实例 PG 实例
时间
分布式，共享块存储
备份 快
-
压缩存储 OSS 海量存储 归档
快照异步压缩传输 持续归档
分布式，共享块存储 REDO
全量快照， 增量快照，
秒级， 秒级，
容量无关 容量无关
备份 可靠
-
压缩存储 OSS 海量存储 归档
快照异步压缩传输 持续归档
分布式，共享块存储 REDO
全量快照， 增量快照， journal、快照原子性
秒级， 秒级，
容量无关 容量无关 checksum 校验
恢复 快
-
OSS 海量存储 归档
APPLY REDO
恢复到指定时间点
+ 分布式，共享块存储
本地保留若干天快照
原地克隆、恢复
快！
存储 可靠
-
计算节点 计算节点 计算节点
PG 实例 PG 实例 PG 实例
分布式，共享块存储
1、存储为强三副本
2、存储支持事务，所有IO保证原子操作
3、存储包含 块级checksum 校验，支持纠错，保证IO读写的正确性