在源和目的地包地址的基础上经过网络路由选择包。用于实现这种服务的协议被称为网际
数据报文协议（IDP）。这个协议的目的是寻址、路由选择和传递标准网际包。它为在网际
上传输和接收数据提供传递系统。这个过程传递无连接型服务。
5．第零层
第零层与 OSI 模型的物理和数据链路层（第 1 层和第 2 层）相一致，Xerox 称这层的
协议为传输媒体协议。和 OSI 模型的情况一样，第零层负责为经过物理通信媒体传输和接
收数据。这层支持的协议有 Ethernet、RS-232-C 和 RS-449。此外， X.25 被认为是传输媒
体协议。
XNS 网际可以由几个不同的相连网络组成。由称为路由器的计算机将这些网络连在一
起。路由器能在连接的网络之间选择路由传输数据包。每个网络可以在理论上有无数的被
连接的工作站，每个站点可以运行多重应用程序。
为了正确识别通信终点，XNS 使用以下三个编号进行网际寻址：
网络号。它是 32 位的编码，用于识别网络（子网）。
主机（可以是网络站点）号。正确识别网络接口卡（NIC），以及安装 NIC 主机的
48 位地址。这种 48 位地址是世界上唯一的地址，不能配置和修改。
插座（socker）号。插座是网络中通信的最终电，它允许工作站中的网络协议了
解数据的目的地。插座号通常指端口号，但它的含义大体上是端口号、主机和网络号的组
- 122 -
Linux网络编程
合。它是一个应用程序用于识别通信终点的 16 位值。
虽然在整个网际上主机号是唯一的，似乎可以不用网络号，但是由于网络号通常比主
机上，如果以来网络号进行路由选择，则能减少路由选择表的规模，而且能以较快的速率
交换包，因此网络号是必要的。使用较小的表还可以减少修改，维持路由选择表所需要的
开销。
5.3   IPX/SPX 协议概述
Novell Netwate 协议是以 XNS 协议为基础的，也是分层结构。甚至寻址方式也和 XNS
非常一致。Netware 协议主要包括 IPX、SPX、RIP、NCP 和 NetBIOS 仿真。
和 Xerox 的网际数据报文协议与排序包协议相对应的 Novell 实现称为网际包交换
（IPX）和排序包交换（SPX）。SPX 是一个可靠的，面向连接的协议。IPX 是不可靠的数
据报文协议。
为了查询、维护工作站和服务器上的路由选择表，Netware 使用了路由选择协议（RIP）
的修改的版本。
Novell 采用了 XNS 的网络寻址结构。由网络编号，主机编号和主机上的插座编号提供
了完全的地址。网络编号长度是 32 位，主机编号是 48 位、插座编号是 16 位。
5.3.1  网际包交换（IPX）
网际包交换（IPX）是 Novell 的网络分层协议。IPX 是从 XNS 的网际数据报文协议推
导而来的，具有相同的包结构。
IPX 提供给工作站和服务器非连接型的，不可靠的数据报文服务。为了使包传递到目
的地，IPX 竭尽全力，但不要求确认信息，IPX 依赖于高层协议（例如 SPX 或 NCP）提供
可靠的排序数据流服务。
IPX 由帧头和数据部分组成，帧头 30 字节长。由于 IPX 不为包的分段提供任何设施，
因此 IPX 实现方法必须确保它们所发送的包是足够的小，能在它们需要经过的任何网络上
传输。IPX 要求所有链路能处理 576 字节长的 IPX 包，因此不能发送大于 576 字节的包。
但如果链路能处理大于 576 字节的包，则可使用较大的包。IPX 包结构如表 5-1 所示：
表 5-1  IPX 包结构
校验和
2 字节
长度
2 字节
传输控制
1 字节
包类型
1 字节
目的地网络
4 字节
目的地主机
6 字节
目的地插座
2 字节
源网络
4 字节
源节点
6 字节
源插座
2 字节
数据
多达 546 字节
下面讨论某些个别字段
校验和。
这个字段必须包含值 FFFFH（H 为十六进制标志）。校验和可看成是最高档的奇偶校
验。其目的是确保所发送的位与所接收的位相同。在传输期间不变动包中的位。
长度。
第五章通信协议简介
- 123 -
包含整个 IPX 数据报文，帧头和所包括的数据的字节数。包的最小长度是 30 字节（帧
头），最大长度是 576 字节（如果包通过网际路由器）。
传输控制。
用于确保数据报文绝不无限的循环，该字段起初由发送站点设置为“0”，它技术条约的
次数（经过路由器的数量）。当计数值等于 16 时，放弃该数据报文。
包类型。
使 IPX 能向相应的较高层协议传递包。该字段用于只是数据字段中的数据类型，由于
IPX 是以 XNS 的 IDP 协议的推导结果，因此它遵循 Xerox 给出的类型。IPX 规定了以下的
四种包类型：
表 5-2  IPX 包类型
未知的包类型
0（hex）  类型
包交换协议
4（hex）  类型
排序包类型
5（hex）  类型
Netware 核心协议
B（hex）  类型
网际地址由网络地址，主机地址和插座地址组成，插座地址识别主机（工作站）上的
通信进程。IPX 支持每个站点多达 50 个插座，0 的网络地址表示本地网络。
为了提供重要的网络带宽服务，Novell 规定了几个著名的插座地址：
表 5-3  几个常用插座及其含义
文件服务器
0451H
Netware 核心协议（NCP）
路由器固定插座
0452H
服务公告协议（SAP）
0453H
路由选择信息协议（RIP）
工作站插座
4000H-6000H
用于工作站与文件服务器交互作用和其它网络通信的动态分配的
插座
0455H
NetBIOS
0456H
诊断包
数据。
包含经过网络发送的信息。应用程序可以使用 API 插座上放置数据，并使用 IPX 将它
发送到远程计算机，较高层协议（例如 SPX、NCP、RIP 和 SAP）的包被放入 IPX 包的数
据部分。在数据部分填充较高层协议包的这种处理被称为封装。
IPX 与数据链路层连接，为了通过网络传输，数据链路层将数据编制成适于跨网传输
的帧。IPX 提供给数据链路层的目的地主机地址取决于被连到本地网络，还是被连到远程
网络。
如果目的地站点处于本地网络内，则将这个站点地址交付给带有 IPX 包的数据链路层，
以便直接传递到目的地站点，如果目的地站点和源站点不在同一网络内，则还需做额外的
工作。
在这种情况下，IPX 发送路由选择请求包，使用路由选择信息协议（RIP）来确定发送
包的最佳路由。然后由对方返回一个确认信息。包括能向目的地网络转送包的路由器的主
机地址。在具备这种信息的情况下，本地和远程计算机的源和目的地地址被传递到链路层，
以便能立即传递到这个站点（路由器）。
当路由器接收包时，它确定是否将包连接到储存在 IPX 包那的目的地网络，如果需要
连到目的地网络，则直接传递包，否则路由器咨询它的路由选择表，以确定下一个路由器
向哪里传送包。IPX 包的源和目的地址始终不便。在目的地站点上，IPX 将包传递到适当
- 124 -
Linux网络编程
的插座。
5.3.2  排序包交换（SPX）
排序包交换（SPX）是 Novell 的传输层协议。它起源于 Xerox 的排序包协议（SPP）。
SPX 在网络站点之间提供可靠的面向连接的虚拟电路服务。SPX 利用 IPX 的数据报文
服务提供排序数据流。它通过实现一个特定的系统，保证每个被发送的包已被确认来完成
上述功能。此外它还在网络站点之间提供流量控制，并确保没有重份被传递到远程进程。
为了降低网络上的拥塞状况，SPX 减少了不必要的重传发生次数。重传多半发生在发
送站点超时等待确认的情况下，SPX 使用了一个特定的算法，能准确估算重传时间，从而
减少了试重传次数。
为了装载连接控制信息，SPX 向 IPX 包帧头部分增加 12 字节，使原 30 字节的帧头变
成 42 字节的组合帧头。SPX 的帧头格式如下：
表 5-4  SPX 帧头格式
连接控制
1 字节
数据流类型
1 字节
源连接 ID
2 字节
目的地连接 ID
2 字节
顺序编号
2 字节
确认编号
2 字节
分配编号
2 字节
数据
多达 534 字节
连接控制。它是控制链路上数据流的一组标记。它可以表明报文结束，并请求确
认。
数据流类型。它使较高层协议能赋予包中数据含义。该字段中信息的意义取决于
使用这个字段的协议。
源连接 ID 和目的地连接 ID，能唯一识别同层进程之间的连接，通过使用连接 ID,
一个 IPX 插座可多路转换多重连接。
排序编号。用于实现 SPX 的流量控制，包排序和抑制复制的包。
确认编号。由目的地使用。用于通知发送方它所等待的下一个顺序编号。
分配编号。用于通知发送方接收方有多少连接可使用的缓冲器，此外这个编号还
帮助实现连接的流量控制，使发送方和接收方同步。
5.4  Net BIOS 概述
网络基本输入/输出系统（Net BIOS）是高级应用程序接口，被设计成程序员使用 IBM PC
网络能建立网络应用程序。它是由 Sytek 公司开发的，起初在 IBM PC 网络适配器卡上实
现。1984 年被 IBM 引入。Microsoft 使用它来配合它的 MS Net 产品。后来 IBM 提供了仿
真程序，使 Net BIOS 能与 NIC 配合，同 Token-Ring 网络一起工作。
当今几乎所有的网络公司，包括 IBM、Novell、Microsoft 和 3Com，都支持 Net BIOS
接口。特别是 IBM 的 LAN Server 操作系统和 Microsoft 的 LAN Manager。Novell 公司通过
使用 IPX 协议栈提供 Net BIOS 支持。3Com 的实现是使用它的 XNS 协议栈。无论怎样实
现，支持网络分布应用程序的 Net BIOS 接口都保持了一致性。
目前已经使用 Net BIOS 接口编写了大量的网络应用程序。由于它的流行性，估计将继
续是一种开发分布应用程序的有力工具。
Net BIOS 不是一个协议，更确切的说它是一个接口。它使网络应用程序和一组命令相
第五章通信协议简介
- 125 -
结合，从而建立通信对话、发送、接收数据和命名网络对象（目标）。正如从 OSI 模型上
所看到的，Net BIOS 提供了对话层接口。在这层上 Net BIOS 能提供可靠的，面向连接的
数据传输流，并识别网络上站点的名字系统。此外 Net BIOS 还提供了非连接型数据报文服
务。但 Net BIOS 不提供路由选择服务，因而使构造网络变得很困难。
为了分配和管理网络上站点的名字，Net BIOS 提供了一组命令，名字长 16 字符，一
个名字表内可以有 1-254 个名字。一个被称为 Net BIOS_NAME_NUMBER_1 的名字总存在
于名字表内，该名字的前 10 个字节是“ 0“ ，后 6 个字节（48 位）是网络接口卡的地址。
Net BIOS 使得网络上两个命名的对象能建立连接。
Net BIOS 名字可以是某一对象的唯一名字或小组名字。前者在整个网络是唯一的，不
能被复制。小组名字可由网络上较多的站点使用。
当应用程序希望同远程应用程序建立联系时，使用远程站点的名字启动调用，然后使
用建立的对话在应用程序之间交换数据。
5.5  Apple Talk 概述
Apple Computer 于 1983-1984 年开始设计一组称为 Apple Talk 的通信协议。目的是将
它们的新型 Macintosh 个人计算机系统（包括打印机、打印服务器、文件服务器、路由器
和网关）连到其它厂家生产的计算机系统。
起初 Apple Talk 的主要应用是将图形计算机连到新型 Apple Laser Writer 激光打印机。
从那时起在先进的软件和硬件配合下，Apple Talk 所提供的较灵活的基本网络支持发回了
重要作用，使桌面排版系统得到很大改进。
每台 Macintosh 和 Laser Writer（激光打印机）都具有适于 Apple Talk 联网结构的内部
硬件支持。此外，系统软件还包括网络继承化支持。
Apple Talk 被设计成能以多种方式使外部设备联到 Machitosh 层。它是一个完全开放型
的的，可扩展的网络结构，支持各种新型的物理网络计数和新型协议栈。将本地网络联入
互联网可实现广域的大量计算机和外部设备的连接。
此外，Apple Talk 还被设计成支持同级间联网。在每个网络节点上实现这种服务，以
分布方式操作。
Apple Talk 网络设计吸收了 Macintosh 的总体设计思想。与网络互相作用的各个用户是
尽可能透明的，以便使标准操作能使用网际上的多种共享资源。尤其重要的是用户能在它
们的台式机上安装卷，通过使用标准选择等操作能利用文件。
网络节点的安装被设计的相当灵活，用户只需连接物理链路，大部分配置由系统软件
自动管理。
该公司于 1989 年 6 月引入了 Apple Talk Phase 2（第 2 阶段），作为现有的 Apple Talk
的向下兼容扩展。通过启动网络上的大量节点（工作站、打印机、服务器），Apple Talk Phase
2 提供了较大的全企业级网络支持。原有的 Apple Talk 最多支持一个网络上的 254 个节点，
而 Phase 2 能启动与一个网络相关联的多个子网，每个子网最多包括 253 个节点。
Apple Talk Phase 2还提供对 Local Talk, Ether Talk 和 Token Talk 的支持（Local Talk 是
Apple 的物理层和数据链路层规范，Ether Talk 和 Token Talk 分别是 Ethernet 和 Token Ring
的 Apple 实现）。Apple Talk 网际路由器被修改得能启动多达 8 个 Apple Talk 网络的连接（以
任何 Local Talk, Ether Talk 和 Token Talk 的混合方式）。
开发者们已经使 Apple Talk 能支持多种类型的分布应用程序，支持 Apple MAC、IBM
PS/2 和 PC 兼容机，运行 UNIX 的工作站和 Apple IIGS。这些应用程序包括文件共享、打
印支持和电子报文。此外这些应用程序也可使用在 Apple Talk 网络连接的 DEC 小型机上。
- 126 -
Linux网络编程
在 Linux 内核中也有对 Apple Talk 的支持。
5.6  TCP/IP 概述
最近几年来分布处理的发展趋势已经从原来的主要依赖大中型机，转变成由 LAN 连接
的 PC 机。这些 PC 机网络往往由许多不同类型的计算机和其它多售主设备组成。这种情况
给一度曾支配大型主机通信的专有通信协议带来了严重冲击。专有协议只允许同一厂家的
计算机系统之间互相通信。例如，DEC 的计算机只能和 DECnet 通信；IBM 主机只能与 SNA
通信；Apple 计算机只能与 Apple Talk 通信。
当今的分布式的 LAN 需要把一个组织的大型机、小型机、企业级 LAN 和公共数据网
连在一起。无疑这将对开发互联多种不兼容系统的非专有协议是一个很大的促进。
当前出现的主要非专有网际互联产品是 TCP/IP 和 OSI 协议。OSI 七层协议已经在国际
上通用。TCP/IP 许多年来就一直被人们所采用，而且越来越成熟，已称为被广泛接收的协
议。据不完全同级，目前世界上已有大约 40 多个国家使用这种协议连接了 5000 多个网络，
几十万台主机。这充分反映了 TCP/IP 的成熟和广泛的可用性。大多数类型的计算机环境都
有 TCP/IP 产品，它提供了文件传输、电子邮件、终端仿真、传输服务和网络管理。
从长远的观点看，OSI 标准最终会超过 TCP/IP，提供较完善的目录和网络管理服务。
但是 OSI 承诺的网际互联设备目前还只限于 LAN 标准的 IEEE802 系列。虽然 OSI 的报文
处理服务（MHS）或 X.400 电子邮件；生产自动协议；文件传送、存储和管理（FTAM）
以及虚拟终端（VT）能以各种不同形式采用，但不同厂家的产品是不能互相操作的。这种
情况有利于 TCP/IP 的流行。
5.6.1  TCP/IP结构模型