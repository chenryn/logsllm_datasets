P2P（或译为点对点）网络的一种攻击类型：攻击者通过使节点从整个网络上消失，从而完全控制特定节点对信息的访问。
P2P
网络的节点通常会维护一个路由表。日蚀攻击是指攻击者通过侵占节点的路由表，将足够多的虚假节点添加到某些节点的邻居节点集合中，从而将这些节点“隔离”于正常区块链网络之外。当节点受到日蚀攻击时，节点的大部分对外联系都会被恶意节点所控制，由此恶意节点得以进一步实施路由欺骗、存储污染、拒绝服务以及
ID 劫持等攻击行为。因此，日蚀攻击对区块链网络的威胁非常严重。
日蚀攻击和女巫攻击（Sybil attack）攻击（查看链接了解：https://www.binance.vision/zh/security/sybil-attacks-explained）密切相关，它需要较多的 Sybil 攻击节点相配合。为了实现对特定区块链节点群的日蚀攻击，攻击者必须首先设置足够多的
Sybil
攻击节点，并且向区块链网络宣称它们是“正常”的节点，然后使用这些Sybil节点与正常的区块链节点通信，入侵其路由表，最终把它们从区块链网络中隔离出去。在日蚀攻击中，攻击者不像在女巫攻击中那样攻击整个网络，而是专注于隔离和瞄准某个特定节点。这种攻击通常会导致受害者节点接收到被操纵的、伪造的区块链视图。
采用日蚀共识，可以让节点完全被攻击者控制，并且攻击者的代价很小。Heilman等人在2018年发表的论文显示，在以太坊网络上执行日蚀攻击只需要用到几台机器。日蚀攻击对区块链网络的影响十分重大。对于区块链网络来说，日蚀攻击破坏了网络的拓扑结构，减少了节点数目，使得区块链网络资源共享的效率大大降低，在极端情况下，它能完全控制整个区块链网络，把它分隔成若干个区块链网络区域。对于受害的区块链节点来说，它们在未知的情况下脱离了区块链网络，所有区块链网络请求消息都会被攻击者劫持，所以它们得到的回复信息大部分都是虚假的，无法进行正常通信。
#### 1.3.3.2 地址池污染攻击
地址池污染，是指诱使同类链的节点互相侵入和污染的一种攻击手法，主要原因是同类链系统在通信协议上没有对非同类节点做识别。
地址池污染攻击实际上是一个所有公链都可能面临的问题，我们用以太坊为例子说明。以太坊的 P2P 网络主要采用了 Kademlia (简称 Kad )
算法实现，Kad 是一种分布式哈希表( DHT )技术，使用该技术，可以实现在分布式环境下快速而又准确地路由、定位数据的问题。
以太坊地址池污染攻击是指，以太坊同类链（具体的说是使用以太坊 P2P discv4
节点发现协议的公链，包括以太坊、以太经典）由于使用了兼容的握手协议，无法区分节点是否属于同个链，导致地址池互相污染，节点通信性能下降，最终造成节点阻塞的一种攻击方式。
  * 第一步：发起恶意握手。
攻击者 A 模拟整个握手过程，主动发起 ping 操作，并利用协议的第4步
neighbors，将返回的邻居表修改成我们收集到的以太坊节点地址，推送给受害节点 B（B 是一个以太坊同类链节点）。由于单次通信只能推送 16
个地址，我们需要多次推送以达到攻击效果。
  * 第二步：污染地址池。
B 收到大量 A 返回的邻居表，尝试跟这些节点握手，并将这些节点加入了自己的地址池（俗称 K 桶）。
  * 第三步：污染自动扩散。 让人意外的是，不同链的节点居然互相握手成功了，更为可怕的是，它们把各自地址池里已知的节点推送给了对方，导致更多的节点互相污染，最终扩散致整个网络。
  * 威胁分析： 地址池污染攻击的同类链节点无法找到真正可用的节点，无法建立 TCP 数据同步通道，导致节点被攻击离线。对于矿池或者出块节点，地址池污染攻击可能导致广播延迟甚至失败，造成收益损失。地址池污染攻击可以使所有以太坊同类链地址池相互污染，导致节点通信效率全面下降，对整个区块链系统造成长久的伤害。
#### 1.3.3.3 区块链网络 DDoS
DDoS攻击是一种对区块链网络安全威胁最大的攻击技术之一，它指借助于C/S技术，将多个计算机联合起来作为攻击平台，对一个或多个目标发动攻击，从而成倍地提高拒绝服务攻击的威力。利用
DDoS 攻击共识节点，让节点沦陷也是一个常见方法。
传统的DDoS攻击分为两步：第一步利用病毒、木马、缓冲区溢出等攻击手段入侵大量主机，形成僵尸网络；第二部通过僵尸网络发起DoS攻击。常用的攻击工具包括：Trinoo、TFN、TFN2K、Stacheldraht
等。由于各种条件限制，攻击的第一步成为制约DDoS攻击规模和效果的关键。
根据攻击方式的不同，基于区块链的 DDoS
攻击可分为主动攻击和被动攻击两种。基于区块链的主动DDoS攻击是通过主动地向网络节点发送大量的虚假信息，使得针对这些信息的后续访问都指向受害者来达到攻击效果的，具有可控性较强、放大倍数高等特点。这种攻击利用区块链网络协议中基于“推（push）”的机制，反射节点在短时间内会接收到大量的通知信息，不易于分析和记录，并且可以通过假冒源地址避过IP检查，使得追踪定位攻击源更加困难。此外，主动攻击在区块链网络中引入额外流量，会降低区块链网络的查找和路由性能；虚假的索引信息，会影响文件下载速度。
基于区块链的被动，DDoS攻击通过修改区块链客户端或者服务器软件，被动地等待来自其它节点的查询请求，再通过返回虚假响应来达到攻击效果。通常情况下，会采取一些放大措施来增强攻击效果，如：部署多个攻击节点、在一个响应消息中多次包含目标主机、结合其它协议或者实现漏洞等。这种攻击利用了区块链网络协议中基于“取（pull）”的机制。被动攻击属于非侵扰式，对区块链网络流量影响不大，通常只能利用到局部的区块链节点。
### 1.3.4 社会工程学攻击
Gartner集团信息安全与风险研究主任Rich
Mogull认为：“社会工程学是未来10年最大的安全风险，许多破坏力最大的行为是由于社会工程学而不是黑客或破坏行为造成的。”一些信息安全专家预言，社会工程学将会是未来信息系统入侵与反入侵的重要对抗领域。
社会工程通常被视为网络威胁，但这一概念已存在很长时间，该术语也可能与现实世界的欺诈行为有关，通常涉及冒充审计者或IT专家。然而，互联网的出现使黑客可以更为轻松地在更广泛的范围内进行操纵攻击，不幸的是这些恶意活动也发生在区块链领域。
● 它是如何工作的？
所有类型的社会工程学都依赖于人类心理学上的弱点。诈骗者利用情绪来操纵和欺骗受害者。他们利用的是人们的恐惧、贪婪、好奇心，甚至他们帮助他人的意愿等。在多种恶意社会工程行为中，网络钓鱼是最常见也是众所周知的案例之一。
● 网络钓鱼
网络钓鱼电子邮件通常模仿来自合法公司的邮件，某些情况下，这些诈骗电子邮件会警告用户帐户需要更新或发生了异常活动，要求他们提供个人信息以确认其身份并管理其帐户。出于恐惧，有用户会立即点击链接并导航到虚假网站，为不法分子提供其所需数据。此时，这些信息将会掌握在黑客手中。
● 威胁软件
社会工程技术也被用于传播所谓的Scareware。顾名思义，威胁软件是一种旨在恐吓和威胁用户的恶意软件。它们通常涉及创建虚假警报，试图欺骗受害者安装看似合法的欺诈性软件或诱骗用户访问相关网站，以达到感染其系统的目的。这种技术通常依赖于用户担心他们的系统受到损害的心理，说服他们点击网页横幅或弹出窗口。这些消息通常会说：“您的系统已被感染，请点击此处进行清理。”
● 诱骗
诱骗是另一种给许多大意用户带来麻烦的社会工程行为。一般利用用户的贪婪或好奇心来引诱受害者。例如，诈骗者可以创建一个提供免费内容的网站，也可能故意将受感染病毒的设备留在公共场所，引诱好奇者把它下载到电脑上查看内容，最终感染目标计算机。
● 合谋
节点之间如果存在利益上的趋同，那么节点之间可能合谋使自己的利益最大化。在区块链共识协议中，当节点被利益驱使，有大于 f
个节点进行合谋，就能引导网络选择对合谋节点有利的结果达成共识。如在跨境汇款的场景中，节点来自不同的国家，如果来自同一个国家的节点之间合谋，那么可以发起双花攻击。
如果攻击者采用社会工程学的方式得到节点的管理权限，一样可以达到控制的恶意节点的数量大于 f 的目的。
### 1.3.5 运营商欺诈
运营商是指提供网络服务的供应商。运营商提供最最基础的网络服务，
掌握着通往用户物理大门的钥匙。节点通信依赖于网络连接，网络连接依赖于运营商提供服务。如果在运营商层面作恶，那么更加容易导致节点失效。运营商劫持就是一个例子。
什么是运营商劫持？
网络运营商为了卖广告或者其他经济利益，有时候会直接劫持用户的访问，目前，运营商比较常见的作恶方式有两种，分别是DNS劫持、HTTP劫持。
DNS劫持简单粗暴，会把请求重新定位到其它网站，比如假设想访问中国银行，正常的DNS
解析IP应该是中国银行的IP地址（假设是10.1.2.3），但是中间者修改这个DNS解析结果，返回用户一个非中国网银行的IP（假设是10.2.3.4），那么用户就会和这个非中国银行的网站建立连接并产生网络传输。
HTTP劫持是指，运营商发现 HTTP
请求的时候，会在正常的数据流中插入精心设计的网络数据报文，目的是让用户端程序解释“错误”的数据，并以弹出新窗口的形式在使用者界面展示宣传性广告或者直接显示某网站的内容。
从这些劫持行为来看，运营商也可能作恶。如果运营商作恶，可以直接从运营商层面发起日蚀攻击，让节点失去有效连接，可以达到控制的恶意节点的数量大于 f 的目的。
### 1.3.6 硬件基础设施遭破坏
2015 年 5 月 27
日，由于市政施工，杭州市萧山区某地光缆被挖断，进而导致支付宝一个主要机房受影响，随后全国部分用户约2小时无法使用支付宝。28日，在线旅游网站携程网也突发故障，导致网站和客户端无法登录。
如果在节点所在的网络基础设施损坏，也会导致节点不可用，可以达到控制的恶意节点的数量大于 f 的目的。
# 02 协议被攻破对区块链安全的影响
BFT 协议在区块链中担任重要角色，由上一节的威胁分析可知 BFT 协议在现实世界中面临多种威胁。协议被攻破后，对区块链安全会产生怎样的影响？
协议被攻破的表现是攻击者可以控制共识结果。一旦共识结果可以被操控，对区块链的影响主要是看是怎样的业务场景。
## 2.1 有些场景可导致拒绝服务
如果区块链的业务只是负责记录消息，如消费记录，共识节点的作用是对交易顺序，也就是对消费记录进行排序，并且就一个排序达成一致即可。这种场景下，如果错误节点大于容错上限，既可以左右排序的顺序，也可以左右共识节点无法达成一致。左右排序顺序不会造成危害，因为业务跟顺序无关。但是，左右节点无法达成一致会导致拒绝服务。
## 2.2 有些场景可导致双花
有些场景允许节点在同一区块高度两个区块都投票，且不会受到惩罚。如果区块链的业务有资金的流转，共识节点的作用是对流转结果达成一致，那么只需要多增加 1
个错误节点，就可以双花攻击。f + 1 个恶意节点里面任何一个轮值到 primary，都可以和剩下的 f 个恶意节点合谋，把网络分化为3个区：f 个