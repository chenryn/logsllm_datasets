Hacking Internet Kiosk’s
Paul Craig
Defcon 16 – Las Vegas
Who am I?
 Paul Craig
 Principal Security Consultant.
 Security-Assessment.com, Auckland, NEW ZEALAND!
 Application Penetration Tester.
 Devoted Hacker
 Shameless Alcoholic
Email: PI:EMAIL
www: http://www.security-assessment.com
Overview
Kiosks 101
 What is an Internet Kiosk.
 Kiosk Software Security Model.
Hacking Internet Kiosks
 Vulnerabilities in the Kiosk Security Model.
 Kiosk Hacking Techniques.
Tool Release: iKAT : interactive Kiosk Attack Tool.
 iKAT Officially Released at Defcon 16!
 Hack any internet Kiosk in seconds.
Live Demos: Hacking Internet Kiosks with iKAT.
Overview
What Is An Internet Kiosk
16 Months Ago I Was Sitting in an Airport.
 8 hour stop over in Hong Kong.
 Queue of 3-4 people waiting to use an Internet Kiosk.
 “Damn, that internet kiosk sure is popular…”
 “I wonder if I could hack it. Lemon party the airport.?”
Why do I never hear about new methods of Kiosk hacking?
 Kiosks are popular, but rarely appear in security publications.
 Popularity + Poor Security Visibility = Good Attack Target
New Security Research Goal:
 Find Every Possible Method Of Hacking an Internet Kiosk.
 Become the Kiosk of Internet Kiosk Hacking!
What Is An Internet Kiosk
Kiosks are Real Popular.
 Internet Kiosks Found in : Airports, Train stations, Libraries, DVD 
Rental Stores, Corporate Building Lobbies, Convenience Stores, 
Post Office, Café’s.
What Is An Internet Kiosk
Initial Kiosk Observations:
Hardware:
 Kiosks installed in a custom hard-shell case.
 Lack of physical access to the computer case.
 Input devices restricted (Floppy/DVD/USB/FireWire inaccessible).
 Kiosk is securely bolted to the ground, padlocked.
 Machine/Cash Box access through Abloy lock.
What Is An Internet Kiosk
Software.
 Majority of Kiosks run commercial Kiosk software on Windows.
 Linux based Kiosks exist, but Windows is more popular.
 44 different commercial Kiosk products on the market.
 Marketed as : “Turn your old PC into instant revenue!”
 Buy $59.99 Shareware -> Install on XP -> Instant Kiosk!
Kiosk Software Essentially Skins Windows:
 Windows is made to look like a Kiosk terminal.
 Implements standard Windows/Internet Explorer libraries.
 “Windows Functionality Wrapped In A Kiosk Candy Shell.”
What Is An Internet Kiosk
Hacking Kiosk Software Is The Way
 Hardware hacking too obvious/obtrusive in public places.
I need A Command Shell on Any Kiosk Terminal.
 Explorer.exe, cmd.exe, command.com = I Win.
 Time limited, I need shell in under 2 minutes.
My Approach:
 Eight popular Windows Kiosk products virtualized.
 Compared the security model of each Kiosk product.
 Developed a ‘Kiosk Attack’ methodology based on findings.
 Series of techniques to invoke a command shell on a Kiosk.
 All tested Kiosk products were found to be vulnerable.
Kiosk Security Model
Kiosk Security Model
Kiosk Software is Based on a Principal of Least Privilege.
 A Kiosk user must ONLY have access to browse the internet.
 Kiosk software must prohibit all other activity.
Security Implemented Through Two Approaches:
 Functionality Reduction.
 Prohibiting access to native OS functionality.
 Anything not required to browse the internet.
 User Interface Sandboxing.
 ‘Graphically’ jailing a user into a Kiosk interface/GUI.
 Kiosk software is ran in full screen.
 Start Bar/Tray Menu removed.
 No ability to click out of, or escape the Kiosk browser.
Kiosk Security Model
Site Kiosk – Popular Commercial Kiosk Product.
 Custom Start/Menu bar.
 Real Windows ‘Start’ bar is hidden.
 Trapped inside a Kiosk browser.
 Runs in full screen mode, no ability to close.
Kiosk Security Model
Kiosk Software Proactively Monitor Usage.
 Kiosks contain blacklists of prohibited activity.
Try to browse C:\
Blacklist of Modal Window Dialogs.
 “Save File As”, “Open With”, “Confirm File Delete”, “Print”.
 Kiosk monitors dialog titles of all in-focus Windows.
 Kiosk sends WM_CLOSE message to any blacklisted window title.
Kiosk Security Model
API Hooking.
 Hook native OS API calls which can be used maliciously.
 KillProcess(), GetCommandLineW(), AllocConsole()
 Try to run cmd.exe: “Unauthorized Functionality Detected”.
Kiosk Browser ran in ‘High Security Zone’
 Cannot download certain files.
 ActiveX, Java often blocked.
 ‘Less secure’ browser features disabled.
Watchdog Timer Monitoring Usage.
 Every 5 minutes enumerate Dialog title of all processes.
 Send WM_CLOSE to any blacklisted applications.
Kiosk Security Model
Custom Keyboard Driver.
 Disable special shortcut key combinations.
 CTRL-SHIFT-ESC (Task Mgr)
 CTRL-ALT-DELETE (Task Mgr)
 ALT-TAB (Switch Task)
 CTRL-ESC (Start Menu)
 Alt-F4 (Close Application)
 Modifier keys unmapped.
 CTRL, Tab, ALT, ‘Start’, Function, F1-F12.
 Custom Keyboard with missing keys
Custom Mouse.
 No right click button!
Hacking
Kiosk Software
Hacking Kiosk Software
Kiosk Security Model is Based on Reducing Functionality.
 Reducing what we can do on the Kiosk.
Exploiting A Kiosk Requires Invoking Functionality.
 Make applications launch and popup on screen.
 Use the invoked applications to escape the Kiosk jail.
Kiosks Implement Blacklists.
 Blacklists (by nature) are never 100%.
 Only need one method of escaping the software jail.
 Blacklist quality vastly varied between Kiosk products.
Hacking Kiosk Software
Available Kiosk Input Vectors:
#1 – Physical Input:
 Interacting with the Kiosk GUI.
 Using the keyboard/mouse.
 Clicking on Buttons, Graphics, Menu’s
 Typing values into the URL entry bar (if present)
#2 – Remote Input:
 Remote browser content, rendered from a Kiosk terminal.
 Input from a website.
Hacking Kiosk Software
What Do We Need To Do?
#1 – Escape The Kiosk Graphical Jail.
 Minimize or close the Kiosk browser application.
 Pop a command shell. : taskkill /IM KioskBrowser.exe
 Enable the hidden (real) Windows Start bar.
 ‘Get Back To Windows.’
#2- Download Additional Binaries to The Kiosk.
 Port scanner, Metasploit, rootkit, trojan, keylogger.
Hacking Kiosk Software
You Find a Kiosk in Your Local Mall.
 “$1 for 2 hours internet usage”
 Insert a dollar.
You Find You Are Trapped Inside a Kiosk Browser.
 Right mouse button has been disabled.
 Custom keyboard with only limited keys.
 Feels like a Windows OS , but has a custom design/layout.
 ‘Start’ bar is labelled ‘SuperKiosk’.
 Only one visible button to ‘Start Browsing’
Hacking Kiosk Software
Use the URL Entry Bar (If present) To Browse The File System
 HTTP libraries used by the Kiosk can browse the file-system.
 Kiosk software must explicitly block local browsing attempts.
Windows is flexible.
 Many ways of doing the same thing.
 C:\windows\ may be blocked.
 Blacklist technology starts failing about now.
File:/C:/windows
File:/C:\windows\
File:/C:\windows/
File:/C:/windows
File://C:/windows
File://C:\windows/
file://C:\windows
C:/windows
C:\windows\
C:\windows
C:/windows/
C:/windows\
%WINDIR%
%TMP%
%TEMP%
%SYSTEMDRIVE%
%SYSTEMROOT%
%APPDATA%
%HOMEDRIVE%
%HOMESHARE%
Hacking Kiosk Software
Common Dialogs.
 Windows contains ‘Common Dialog’ libraries.
 Saving a file, opening a file, select font, choose colour.
 COMDLG32.dll (Common Windows Dialogs Library).
 COMDLG32.DLL Implements Common Windows Controls.
 From COMCTL32.DLL.
File/Open, File/Save Dialogs implement the ‘File View’ control.
 File View control provides full Explorer functionality.
 Same control that Windows Explorer uses.
 File-Open dialog = Explorer
Hacking Kiosk Software
 Systematically Click Every Button, Graphic, Icon In The Kiosk
 Can we invoke a File - View Dialog?: ‘Attach File’ dialog
 Browse the file system, launch other applications.
 Retarded mouse present? No right mouse button?
 Select another file with left mouse and drag it onto cmd.exe
  cmd.exe will spawn.
Hacking Kiosk Software
Internet Explorer ‘Image Toolbar’.
 IE toolbar hovers in top-left when a large image is clicked.
 Each icon of the toolbar can invoke a Common Dialog.
 File/Save.
 File/Print.
 File/Mailto.
 Open “My Pictures” in Explorer.
 Present if the Kiosk is developed using Internet Explorer libraries.
 Click a large image, does the Image Toolbar popup?
Hacking Kiosk Software
Using the Keyboard.
 Keyboard shortcuts can be used to access the host OS.
 Is a custom keyboard driver present?
 Are modifier keys enabled?
Keyboard shortcuts which produce common dialogs.
 CTRL-B, CTRL-I  (Favourites), CTRL-H  (History)
 CTRL-L, CTL-0 – (File/Open Dialog), CTRL-P – (Print Dialog)
 CTRL-S – (Save As)
Kiosk Product Specific Keyboard Shortcut.
 All Kiosk products contain a hidden Administrative/Menu.
 Mash the keyboard, CTRL-ALT-F8? CTRL-ESC-F9?
Hacking Kiosk Software
Browser Security Zones
 Browser security model incorporates different security zones.
Restricted Sites
Internet Zone
Intranet Zone
Trusted Sites
 Each zone adheres to a different security policy.
 Internet zone cannot follow links to the local file system.
 While Trusted Sites, Intranet Zone can.
Does The Kiosk Protect Against Access From All Zones?
 Internet Zone may be configured securely.
Hacking Kiosk Software
As a User On The Keyboard You Can Access all Security Zones.
 URL’s must be typed into the URL bar.
About: pluggable-protocol Handler.
 Belongs to the ‘Trusted Sites’ security zone.
 Suffers from a Cross Site Scripting (XSS) vulnerability.
 User can control content rendered in trusted security zone.
 Create A Trusted Security Zone ‘File Browser’.
about:Click-Here
about:
 Trusted security zone can follow links to the file system.
Hacking Kiosk Software
Shell Protocol Handler.
 Provides access to Windows web folders.
 Shell:Profile
 Shell:ProgramFiles
 Shell:System
 Shell:ControlPanelFolder
 Shell:Windows
 Typing each URL will spawn explorer.exe and browse the folder.
Hacking Kiosk Software
How about:
 shell:::{21EC2020-3AEA-1069-A2DD-08002B30309D}
 Web folder by CLASSID (Windows Control Panel)
 Works from WININET.DLL/MSINET.OCX
Hacking Kiosk Software
The Downside to Physical Kiosk Inputs.
 Kiosk software is designed to not trust the guy on the keyboard.