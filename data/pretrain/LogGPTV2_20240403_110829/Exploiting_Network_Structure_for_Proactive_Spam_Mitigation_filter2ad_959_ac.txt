80
120
140
160
(a) No. of k-bad IP addresses present in x or more days
1
0.8
0.6
0.4
0.2
t
n
e
s
m
a
p
s
f
o
n
o
i
t
c
a
r
F
k = 70
k = 80
k = 90
k = 99
k = 100
0
0
20
40
60
100
Number of days
80
120
140
160
(b) Fraction of spam sent by k-bad IP addresses present
in x or more days
Figure 4: Persistence of k-bad IP addresses.
Fig. 4(a) presents the number of IP addresses in the k-
bad set that are present in at least x days, and Fig. 4(b)
presents the fraction of the total spam sent by IP ad-
dresses in the k-bad set that are present in least x days.
Result 5. Distribution of spam from persistent k-bad
IPs: Fig. 4 indicates that (i) IP addresses with high
lifetime spam ratios (large k) tend to contribute almost
all of the spam, (ii) most of these high spam-ratio IPs are
only present for a short time (this is consistent with the
ﬁnding in [19]) and account for a large proportion of
the overall spam, and (iii) the small fraction of these IPs
that do last several days contribute a non-trivial fraction
of the overall spam; however, a much larger fraction of
spam comes from IP addresses that are not present for
154
16th USENIX Security Symposium
USENIX Association
very long. As in the case of the k-good IP addresses, the
spam contribution from the k-bad IP addresses tends to
get more stable with time.
So, for instance, we can see from Fig. 4 that only 1.5%
of the IP addresses in the 80-bad set appear in at least
10 distinct days, and these contribute to 35.4% of the
volume of spam from the 80-bad set, and 34% of the total
spam. The difference is more pronounced for 100-bad IP
addresses: 2% of the 100-bad IP addresses appear for 10
or more distinct days, and contribute to 25% of the total
spam volume.
The results of this section have implications in design-
ing spam ﬁlters, especially for applications where the
goal is to prioritize legitimate mail rather than discard
spam. While spamming IP addresses that are present suf-
ﬁciently long can be blacklisted, the scope of a purely
blacklisting approach is limited. On the other hand, a
very signiﬁcant fraction of the legitimate mail can be pri-
oritized by using the history of the senders of legitimate
mail.
2.2.3 Temporal Stability
Next, we seek to understand whether IP addresses in the
k-good set change their daily spam-ratio dramatically
over the course of their lifetime. The question we want
to answer is: of the IP addresses that appear in a k-good
set (for small values of k), what fraction of them have
ever had “high” daily spam-ratios, and how often do they
have “high” spam-ratios? Thus, we want to understand
the temporal stability of the spam-ratio of IP addresses
in k-good sets. In this section, we focus on k-good IP
addresses; the results for the k-bad IP addresses are sim-
ilar.
0.1
0.08
0.06
0.04
0.02
s
e
s
s
e
r
d
d
A
P
I
f
o
n
o
i
t
c
a
r
F
0
0
0.1
k=1
k=5
k=10
k=20
k=30
0.4
0.5
0.2
0.3
Frequency fraction−excess
ber of days it appears). We deﬁne this quantity to be
the frequency-fraction excess of the IP address, for the
k-good set. We plot the complementary cdf (CCDF) of
the frequency-fraction excess of all IP addresses in the k-
good set. 2 Intuitively, the distribution of the frequency-
fraction excess is a measure of how many IP addresses in
the k-good set exceed k, and how often they do so.
Fig. 5 shows the CCDF of the frequency-fraction ex-
cess for several k-good sets. It shows that the majority
of the IP addresses in each k-good set have a frequency-
fraction excess of 0, and that 95% of the k-good IP ad-
dresses have a frequency-fraction excess of at most 0.1.
We explain the implications of Fig. 5 to the temporal
stability of the spam-ratio of IP addresses with an exam-
ple. We focus on the k-good set for k = 20: this is the
set of IP addresses whose lifetime spam-ratio is bounded
by 20%. We note that the frequency-fraction excess is 0
for 95% of the 20-good IP addresses. This implies that
95% of IP addresses in this k-good set do not send more
than 20% spam any day, i.e., every time they appear, they
have a daily spam-ratio of at most 20%. We also note that
fewer than 1% of the IP addresses in this k-good set have
a frequency-fraction excess larger than 0.2.
Thus, for many k-good sets with small k-values, only
a few IP addresses have a signiﬁcant frequency-fraction
excess, i.e., very few IP addresses in those sets exceed
the value k often. Since they would need to exceed k
often to change their spamming behaviour signiﬁcantly,
it follows that most IP addresses in the k-good set do not
change their spamming behaviour signiﬁcantly.
In addition, the frequency-fraction excess is perhaps
too strict a measure, since it is affected even if k is ex-
ceeded slightly. We also compute a similar measure that
increases only when k is exceeded by 5%. No more than
0.01% of IP address in the k-good set exceed k by 5%,
for any k ≤ 30%. Since we are especially interested in
the temporal stability of IP addresses that appear often,
we compute also the frequency-fraction excess distribu-
tion for IP addresses that appear for 10, 20, 40 and 60
days. In each case, almost no IP address exceeds k by
more than 5%, for any k ≤ 30%.
We summarize this discussion in the following result.
Result 6. Temporal stability of k-good IPs: Fig. 5
shows that most IP addresses in k-good sets (for low k,
e.g., k ≤ 30%) do not exceed k often; i.e., most k-good
IP addresses have low spam-ratios (at most k) nearly
every day.
Figure 5: Temporal stability of IP addresses in k-good
sets, shown by CCDF of frequency-fraction excess.
We compute the following metric:
for each IP ad-
dress in a k-good set, we count how often its daily spam-
ratio exceeds k (and normalize this count by the num-
With the above result, we can analyze the behaviour of
k-good sets of IP addresses, constructed over their entire
lifetime, and their behaviour in shorter time intervals.
2That is, we plot the fraction of IP addresses in the k-good set whose
frequency-fraction excess is at least x. The y-axis of the plot is re-
stricted for readability.
USENIX Association
16th USENIX Security Symposium
155
The analysis of these three properties of IP addresses
indicates that a signiﬁcant fraction of the legitimate
mail comes from IP addresses that persistently appear
in the trafﬁc. These IP addresses tend to exhibit stable
behaviour:
they do not ﬂuctuate signiﬁcantly between
sending spam and legitimate mail. These results lend
weight to our hypothesis that spam mitigation efforts can
beneﬁt by preferentially allocating resources to the sta-
ble and persistent senders of legitimate mail. However,
there is still a substantial portion of the mail that cannot
be accounted for through only IP address-based analysis.
In the next section, we focus on how to account for this
mail.
3 Analysis of Cluster Characteristics
So far, we have analyzed whether the historical be-
haviour of individual IP addresses can be used to dis-
tinguish between senders of legitimate mail and spam-
mers. However, if we only consider the history of indi-
vidual IP addresses, we cannot determine whether a new,
previously unseen, IP address is likely to be a spammer
or a sender of legitimate mail. If there are many such
IP addresses, then, in order to be useful, any prioritiza-
tion scheme would need to assign these new IP addresses
appropriate reputations as well.
Indeed, in Sec. 2.2.2,
we found that most IP addresses sending mail are short-
lived and that such short-lived IPs account for a signiﬁ-
cant proportion of both legitimate mail and spam. Any
prioritization scheme would thus need to be able to ﬁnd
reputations for these IP addresses as well.
To address this issue, we explore whether coarser ag-
gregations of IP addresses exhibit more persistence and
afford more effective discriminatory power for spam mit-
igation.
If such aggregations of IP addresses can be
found, the reputation of an unseen IP address could be
derived from the historical reputation of the aggregation
they belong to.
We focus on IP aggregations given by network-aware
clusters of IP addresses [15]. Network-aware clusters are
sets of unique network IP preﬁxes collected from a wide
set of BGP routing table snapshots. In this paper, an IP
address belongs to a network-aware cluster if the longest
preﬁx match of the IP address matches the preﬁx asso-
ciated with the cluster.
In the reputation mechanisms
we explore in Sec. 4, an IP address derives the reputa-
tion of the network-aware cluster that it belongs to. We
use network-aware clustering because these clusters rep-
resent IP addresses that are close in terms of network
topology and do, with high probability, represent regions
of the IP space that are under the same administrative
control and share similar security and spam policies [15].
In this section, we present measurements suggesting
that network-aware clusters of IP addresses may provide
a good basis for reputation-based classiﬁcation of IP ad-
dresses. We focus on the following questions:
• Granularity: Does the mail originating from
network-aware clusters consist of mostly spam or
mostly legitimate mail, so that these clusters could
be useful as a reputation-granting mechanism for IP
addresses?
• Persistence: Do individual network-aware clusters
appear (i.e., do IP addresses belonging to the clus-
ters appear) over long periods of time, so that
network-aware clusters could potentially afford us
a useful mechanism to distinguish between differ-
ent kinds of ephemeral IP addresses?
As in the IP-address case, we adopt the spam-ratio of
a network-aware cluster as the discriminating feature
of clusters and examine whether clusters with low/high
spam-ratios are granular and persistent.
Before examining these two properties in detail, we
ﬁrst summarize our analysis of the properties with re-
spect to which clusters behave as IP addresses do: clus-
ters turn out to be at least as (and usually more) tem-
porally stable as IP addresses (similar to the IP address
behaviour explored in Sec. 2.2.3), which is the expected
behaviour; the distribution of clusters by daily cluster
spam-ratio is similar to the distribution of IP addresses
by IP spam-ratio (similar to the IP address behaviour ex-
plored in Sec. 2.2.1).
3.1 Cluster Granularity
For network-aware clustering of IP addresses to be use-
ful, the clusters need to be sufﬁciently homogeneous in
terms of their legitimate mail/spam behavior so that the
cluster information can be used to separate the bulk of le-
gitimate mail from the bulk of spam. Recall that with the
IP addresses, we analyzed the extent to which IP spam-
ratios could be used to identify the IP addresses send-
ing the bulk of legitimate mail and spam. Here, we an-
alyze whether, instead of an IP’s individual spam-ratio,
the spam-ratio of the parent cluster can be used for the
same purpose.
To do so, we need to understand how well the clus-
ter spam-ratio approximates the IP spam-ratio.
In our
context, we focus on the following question: can we still
distinguish between the IP addresses that send the bulk of
the legitimate mail and the bulk of the spam? If we can,
within a margin of error, it would suggest that cluster-
level analysis is nearly as good as IP-level analysis.
For the analysis here, we determine the spam-ratio
of each cluster by analyzing the mail sent by all IP ad-
dresses belonging to that cluster and assign to IP ad-
dresses the spam-ratios of their respective clusters.
In
156
16th USENIX Security Symposium
USENIX Association
1
0.8
0.6
0.4
0.2
t
n
e
s
m
a
p
s
f
o
n
o
i
t
c
a
r
F
0
0%
20%
Spam − IPs
Spam − Clusters
40%
60%
IP/Cluster spam−ratio
80%
100% 
(a) Fraction of spam sent by clusters & IPs, as a function
of cluster & IP spam-ratios.
1
t
n
e
s
l
i
a
m
e
t
a
m
i
t
i
g
e
l
f
o
n
o
i
t
c
a
r
F
0.8
0.6
0.4
0.2
0
0%
20%
Legitimate mail − IPs
Legitimate mail − Clusters
40%
60%
IP/Cluster spam−ratio
80%
100% 
(b) Legitimate mail sent by clusters & IPs, as a function of
cluster & IP spam-ratios.
Figure 6: Penalty of using cluster-level analysis.
the rest of this discussion, we will refer to legitimate