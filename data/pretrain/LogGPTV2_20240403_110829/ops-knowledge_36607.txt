User: Develop a script for monitoring server performance, which can send an alarm in time when the CPU, memory and disk usage exceeds preset thresholds
Assistant: The following is a Linux server performance monitoring script, which can monitor CPU, memory and disk usage in real time, and send an email alarm when the preset threshold is exceeded. Using the script requires Python3 and the psutil module as well as an SMTP service for mailboxes. ``` #!/usr/bin/env python3 import psutil import smtplib import datetime import sys # set threshold cpu_threshold = 70.0 memory_threshold = 70.0 disk_threshold = 80.0 # define email message sender = 'example@example.com' password = 'password' receivers = ['recipient@example.com'] subject = 'Server performance warning' smtp_server = 'smtp.example.com' smtp_port = 465 def send_mail(contents): try: smtpObj = smtplib.SMTP_SSL(smtp_server, smtp_port) smtpObj. login(sender, password) message = 'Subject: {}\n\n{}'.format(subject, contents) smtpObj.sendmail(sender, receivers, message) smtpObj.quit() except smtplib.SMTPException: print(' Email sending failed') def get_current_time(): now = datetime.datetime.now() formatted_time = now.strftime('%Y-%m-%d %H:%M:%S') return formatted_time def monitor() : while True: cpu_percent = psutil.cpu_percent(interval=1, percpu=False) memory_percent = psutil.virtual_memory().percent disk_percent = psutil.disk_usage('/').percent if cpu_percent > cpu_threshold: contents = 'CPU usage It has exceeded {}%, and the current usage rate is {}%, please deal with it in time! {}'.format(cpu_threshold, cpu_percent, get_current_time()) send_mail(contents) if memory_percent > memory_threshold: contents = 'The memory usage has exceeded {}%, the current usage is {}%, please deal with it in time! {}'.format(memory_threshold, memory_percent, get_current_time()) send_mail(contents) if disk_percent > disk_threshold: contents = 'The disk usage has exceeded {}%, the current usage is {}%, please deal with it in time! {}'.format(disk_threshold, disk_percent, get_current_time()) send_mail(contents) if __name__ == '__main__': monitor() ``` The principle of this script is to use the psutil module to obtain the performance information of the server, and then compare it with the preset The threshold is compared, and an email alarm is sent if the threshold is exceeded. The threshold can be modified to suit different environments.