it seeks help and hasn’t stored past trafﬁc data, while our
scheme can be used to detect pre-existing botnets as well.
Illiofotou et al. [36, 35] also exploit dynamicity of trafﬁc
graphs to classify network ﬂows in order to detect P2P
networks. It uses static (spatial) and dynamic (temporal)
metrics centered on node and edge level metrics in addi-
tion to the largest-connected-component-size as a graph
level metric. Our scheme however starts from ﬁrst princi-
ples (searching for expanders) and uses the full extent of
spatial relationships to discover P2P graphs including the
joint degree distribution and the joint-joint degree distri-
bution and so on.
Of the many botnet detection and mitigation tech-
niques mentioned above, most are rather ad-hoc and
only apply to speciﬁc scenarios of centralized botnets
such as IRC/HTTP/FTP botnets, although studies [28]
indicate that the centralized model is giving way to the
P2P model. Of the techniques that do address P2P bot-
nets, detection is again dependent on speciﬁcs regarding
control trafﬁc ports, network behavior of certain types
of botnets, reverse engineering botnet protocols and so
on, which limits the applicability of these techniques.
Generic schemes such as BotMiner [29] and TAMD [76]
using behavior based clustering are better off but need
access to extensive ﬂow information which can have le-
gal and privacy implications. It is also important to think
about possible defenses that botmasters can apply, the
cost of these defenses and and how they might affect the
efﬁciency of detection. Shear and Nicol [64, 54] describe
schemes to mask the statistical characteristics of real traf-
ﬁc by embedding it in synthetic, encrypted, cover trafﬁc.
The adoption of such schemes will only require minimal
alterations to existing botnet architectures but can effec-
tively defend against detection schemes that depend on
packet level statistics including BotMiner and TAMD.
8 Conclusion
The ability to localize structured communication graphs
within network trafﬁc could be a signiﬁcant step forward
in identifying bots or trafﬁc that violates network policy.
As a ﬁrst step in this direction, we proposed BotGrep, an
inference algorithm that identiﬁes botnet hosts and links
within network trafﬁc traces. BotGrep works by search-
ing for structured topologies, and separating them from
the background communication graph. We give an ar-
chitecture for a BotGrep network deployment as well as
a privacy-preserving extension to simplify deployment
14
across networks. While our techniques do not achieve
perfect accuracy, they achieve a low enough false posi-
tive rate to be of substantial use, especially when com-
bined with complementary techniques. There are sev-
eral avenues of future work. First, performance of our
approach may be improved by leveraging temporal in-
formation (observing how parts of the the communica-
tion graph change over time) to assist in separating out
the botnet graph.
In addition, it may be desirable to
distinguish other peer-to-peer structure from other Inter-
net background trafﬁc, perhaps by observing more ﬁne-
grained properties of communication patterns. Finally,
we do not attempt to address the challenging problem of
botnet response. Future work may leverage our inferred
botnet topologies by dropping crucial links to partition
the botnet, based on the structure of the botnet graph.
Acknowledgments
We would like to thank Vern Paxson and Christian
Kreibich for sharing their Storm traces. We are also
grateful to Reiner Sailer and Mihai Christodorescu for
helpful discussions. This work is supported in part by
National Science Foundation Grants CNS 06–27671 and
CNS 08–31653.
References
[1] Botlab: A real-time botnet monitoring platform. botlab.cs.
washington.edu.
[2] Cisco
IOS Netﬂow.
http://www.cisco.com/en/US/
products/ps6601/products_ios_protocol_group_home.
html.
[3] Comcast constant guard.
http://security.comcast.net/
constantguard/.
[4] Spamhaus. www.spamhaus.org.
[5] The Cooperative Association for
(CAIDA). http://www.caida.org/.
Internet Data Analysis
[6] J. Aspnes and U. Wieder. The expansion and mixing time of skip
graphs with applications. In SPAA ’05: Proceedings of the seven-
teenth annual ACM symposium on Parallelism in algorithms and
architectures, pages 126–134, New York, NY, USA, 2005. ACM
Press.
[7] M. Bailey, E. Cooke, F. Jahanian, N. Provos, K. Rosaen, and
D. Watson. Data Reduction for the Scalable Automated Analysis
of Distributed Darknet Trafﬁc. In Proceedings of IMC, 2005.
[8] P. Barford and V. Yegneswaran. An Inside Look at Botnets, vol-
ume 27 of Advanced in Information Security, chapter 8, pages
171–192. Springer, 2006.
[9] A. Barsamian. Network characterization for botnet detection us-
ing statistical-behavioral methods. Masters thesis, Thayer School
of Engineering, Dartmouth College, USA, June 2009.
[10] J. R. Binkley and S. Singh. An algorithm for anomaly-based bot-
net detection. In SRUTI’06: Proceedings of the 2nd conference
on Steps to Reducing Unwanted Trafﬁc on the Internet, pages 7–
7, Berkeley, CA, USA, 2006. USENIX Association.
[11] N. Borisov. Anonymous routing in structured peer-to-peer over-
lays. PhD thesis, University of California at Berkeley, Berkeley,
CA, USA, 2005.
[12] M. Castro, P. Druschel, A. Ganesh, A. Rowstron, and D. S. Wal-
lach. Secure routing for structured peer-to-peer overlay networks.
SIGOPS Oper. Syst. Rev., 36(SI):299–314, 2002.
[13] D. Chaum. The dining cryptographers problem: unconditional
sender and recipient untraceability. J. Cryptol., 1(1):65–75, 1988.
[14] A. Clauset, M. E. J. Newman, and C. Moore. Finding community
structure in very large networks. Physical Review E, 70(6), 2004.
[15] M. P. Collins and M. K. Reiter. Hit-list worm detection and bot
identiﬁcation in large networks using protocol graphs. In RAID,
2007.
[16] M. P. Collins, T. J. Shimeall, S. Faber, J. Janies, R. Weaver,
M. De Shon, and J. Kadane. Using uncleanliness to predict future
botnet addresses. In IMC, pages 93–104, New York, NY, USA,
2007. ACM.
[17] E. Cooke and F. Jahanian. The zombie roundup: Understanding,
detecting, and disrupting botnets. In Steps to Reducing Unwanted
Trafﬁc on the Internet Workshop, 2005.
[18] E. D. Cristofaro and G. Tsudik. Practical private set intersection
protocols. Cryptology ePrint Archive, Report 2009/491, 2009.
http://eprint.iacr.org/.
[19] D. Dagon, C. Zou, and W. Lee. Modeling botnet propagation
using time zones. In NDSS, 2006.
[20] I. Damgard and M. Jurik. A generalisation, a simpliﬁcation and
some applications of Paillier’s probabilistic public-key system. In
Public Key Cryptography. Springer, 2001.
[21] G. Danezis and P. Mittal. Sybilinfer: Detecting Sybil nodes using
social networks. In NDSS, 2009.
[22] S. Fortunato, V. Latora, and M. Marchiori. Method to ﬁnd com-
munity structures based on information centrality. Physical Re-
view E, 70(5), 2004.
[23] J. Franklin, V. Paxson, A. Perrig, and S. Savage. An inquiry
into the nature and causes of the wealth of internet miscreants.
In ACM conference on Computer and communications security,
pages 375–388, New York, NY, USA, 2007. ACM.
[24] F. C. Freiling, T. Hoz, and G. Wichereski. Botnet tracking: Ex-
ploring a root-cause methodology to prevent distributed denial-
of-service attacks. In European Symposium on Research in Com-
puter Security, 2005.
[25] M. Girvan and M. E. J. Newman. Community structure in social
and biological networks. Proceedings of the National Academy
of Sciences of the United States of America, 99(12), 2002.
[26] C. Gkantsidis, M. Mihail, and A. Saberi. Random walks in peer-
to-peer networks. In IEEE INFOCOM, 2004.
[27] J. Goebel and T. Holz. Rishi: Identify bot contaminated hosts by
IRC nickname evaluation. In HotBots, 2007.
[28] J. B. Grizzard, V. Sharma, C. Nunnery, B. B. Kang, and
In
D. Dagon. Peer-to-peer botnets: Overview and case study.
HotBots, 2007.
[29] G. Gu, R. Perdisci, J. Zhang, and W. Lee. BotMiner: Clus-
tering analysis of network trafﬁc for protocol- and structure-
independent botnet detection. In Proceedings of the 17th USENIX
Security Symposium (Security’08), 2008.
[30] G. Gu, P. Porras, V. Yegneswaran, M. Fong, and W. Lee. BotH-
unter: Detecting malware infection through IDS-driven dialog
correlation. In USENIX Security Symposium, 2007.
[31] G. Gu, J. Zhang, and W. Lee. BotSniffer: Detecting botnet com-
mand and control channels in network trafﬁc. In Proceedings of
the 15th Annual Network and Distributed System Security Sym-
posium (NDSS’08), February 2008.
[32] K. P. Gummadi, R. Gummadi, S. D. Gribble, S. Ratnasamy,
S. Shenker, and I. Stoica. The impact of DHT routing geometry
on resilience and proximity. In Proceedings of ACM SIGCOMM
2003, Aug. 2003.
[33] R. Gummadi, H. Balakrishnan, P. Maniatis, and S. Ratnasamy.
Not-a-Bot (NAB): Improving Service Availability in the Face of
Botnet Attacks. In NSDI 2009, Boston, MA, April 2009.
[34] W. K. Hastings. Monte carlo sampling methods using Markov
chains and their applications. Biometrika, 57(1):97–109, April
15
[44] A. Karasaridis, B. Rexroad, and D. Hoeﬂin. Wide-scale botnet
[69] E. Stinson and J. C. Mitchell. Characterizing bots’ remote control
[58] P. Porras, H. Saidi, and V. Yegneswaran. A foray into Conﬁcker’s
logic and rendezvous points. In 2nd Usenix Workshop on Large-
Scale Exploits and Emergent Threats (LEET ’09), 2009.
[59] M. Rajab, J. Zarfoss, F. Monrose, and A. Terzis. A multifaceted
approach to understanding the botnet phenomenon. In Internet
Measurement Conference, 2006.
[60] A. Ramachandran, D. Dagon, and N. Feamster. Can DNS-based
blacklists keep up with bots? In CEAS, 2006.
[61] A. Ramachandran, N. Feamster, and D. Dagon. Revealing botnet
In SRUTI: Pro-
membership using dnsbl counter-intelligence.
ceedings of the 2nd conference on Steps to Reducing Unwanted
Trafﬁc on the Internet, 2006.
[62] D. Randall. Rapidly mixing Markov chains with applications in
computer science and physics. Computing in Science and Engi-
neering, 8(2):30–41, 2006.
[63] Route views. http://www.routeviews.org.
[64] N. Schear and D. M. Nicol. Performance analysis of real traf-
ﬁc carried with encrypted cover ﬂows. In PADS, pages 80–87,
Washington, DC, USA, 2008. IEEE Computer Society.
[65] S. Sheng, B. Wardman, G. Warner, L. F. Cranor, J. Hong, and
C. Zhang. An empirical analysis of phishing blacklists. In CEAS,
2009.
[66] A. Sinclair. Improved bounds for mixing rates of markov chains
and multicommodity ﬂow. Combinatorics, Probability and Com-
puting, 1:351–370, 1992.
[67] E. Spafford and D. Zamboni.
Intrusion detection using au-
tonomous agents. Computer Networks, 34(4):547–570, 2000.
[68] L. Spitzner. The Honeynet Project: trapping the hackers. Security
& Privacy Magazine, IEEE, 1(2):15–23, 2003.
behavior. In Botnet Detection. 2008.
[70] I. Stoica, R. Morris, D. Karger, M. F. Kaashoek, and H. Balakr-
ishnan. Chord: A scalable peer-to-peer lookup service for Inter-
net applications. In Proceedings of ACM SIGCOMM, Aug. 2001.
[71] S. Stover, D. Dittrich, J. Hernandez, and S. Dietrich. Analysis of
the Storm and Nugache trojans: P2P is here. ;login, 32(6), Dec.
2007.
[72] W. T. Strayer, D. E. Lapsley, R. Walsh, and C. Livadas. Botnet
detection based on network behavior. In Advances in Information
Security. 2008.
[73] G. Varghese and C. Estan. The measurement manifesto.
In
HotNets-II, 2003.
[74] R. Villamar´ın-Salom´on and J. C. Brustoloni. Bayesian bot detec-
tion based on dns trafﬁc similarity. In SAC ’09: Proceedings of
the 2009 ACM Symposium on Applied Computing, pages 2035–
2041, New York, NY, USA, 2009. ACM.
[75] G. White, E. Fisch, and U. Pooch. Cooperating security man-
agers: a peer-based intrusion detection system. IEEE Network,
10(1):20–23, 1996.
[76] T.-F. Yen and M. K. Reiter. Trafﬁc aggregation for malware de-
In DIMVA ’08: Proceedings of the 5th international
tection.
conference on Detection of Intrusions and Malware, and Vul-
nerability Assessment, pages 207–227, Berlin, Heidelberg, 2008.
Springer-Verlag.
[77] Q. Zhao, J. Xu, and Z. Liu. Design of a novel statistics counter
architecture with optimal space and time efﬁciency. In ACM SIG-
METRICS, June 2006.
[78] Y. Zhao, Y. Xie, F. Yu, Q. Ke, Y. Yu, Y. Chen, and E. Gillum. Bot-
graph: Large scale spamming botnet detection. In NSDI, 2009.
[79] M. Zhong, K. Shen, and J. Seiferas. Non-uniform random mem-
In INFOCOM,
bership management in peer-to-peer networks.
pages volume 2, 1151–1161, 2005.
1970.
[35] M. Iliofotou, M. Faloutsos, and M. Mitzenmacher. Exploiting
dynamicity in graph-based trafﬁc analysis: Techniques and ap-
plications. In ACM CoNext, 2009.
[36] M.
Iliofotou, P. Pappu, M. Faloutsos, M. Mitzenmacher,
G. Varghese, and H. Kim. Graption: Automated detection of
P2P applications using trafﬁc dispersion graphs (TDGs). In UC
Riverside Technical Report, CS-2008-06080, 2008.
[37] S. Jarecki and X. Liu. Efﬁcient Oblivious Pseudorandom Func-
tion with Applications to Adaptive OT and Secure Computation
of Set Intersection. In Theory of Cryptography Conference, pages
577–594. Springer, 2009.
[38] M. Jelasity and V. Bilicki.
Towards automated detection
of peer-to-peer botnets: On the limits of local approaches.
In USENIX Workshop on Large-Scale Exploits and Emergent
Threats (LEET), 2009.
[39] M. Jelasity and V. Billicki.
Towards automated detection
of peer-to-peer botnets: On the limits of local approaches.
In USENIX Workshop on Large-Scale Exploits and Emergent
Threats (LEET), 2009.
[40] J. P. John, A. Moshchuk, S. D. Gribble, and A. Krishnamurthy.
Studying spamming botnets using Botlab. In NSDI, 2009.
[41] M. Kaashoek and D. Karger. Koorde: A simple degree-optimal
distributed hash table. In IPTPS, 2003.
[42] C. Kanich, C. Kreibich, K. Levchenko, B. Enright, G. Voelker,
V. Paxson, and S. Savage. Spamalytics: An empirical analysis of
spam marketing conversion. In CCS, Oct. 2008.
[43] R. Kannan, S. Vempala, and A. Vetta. On clusterings: Good, bad
and spectral. J. ACM, 51(3):497–515, 2004.
detection and characterization. In HotBots, 2007.
[45] S. Kullback and R. A. Leibler. On information and sufﬁciency.
Annals of Mathematical Statistics, 22:49–86, 1951.
[46] V. Latora and M. Marchiori. Economic small-world behavior in
weighted networks. The European Physical Journal B - Con-
densed Matter, 32(2), 2002.
[47] S. Lloyd. Least squares quantization in PCM. Information The-
ory, IEEE Transactions on, 28(2):129–137, 1982.
[48] D. Loguinov, A. Kumar, V. Rai, and S. Ganesh. Graph-theoretic
analysis of structured peer-to-peer systems: Routing distances
In Proceedings of ACM SIGCOMM, Aug.
and fault resilience.
2003.
[49] W. Lu, M. Tavallaee, and A. A. Ghorbani. Automatic discovery
of botnet communities on large-scale communication networks.
In ASIACCS, pages 1–10, New York, NY, USA, 2009. ACM.
[50] P. Maymounkov and D. Mazieres. Kademlia: A peer-to-peer in-
formation system based on the xor metric. In Proceedings of the
1st International Peer To Peer Systems Workshop, 2002.
[51] S. Nagaraja and R. Anderson. The snooping dragon: social-
malware surveillance of the tibetan movement. Technical Report
UCAM-CL-TR-746, University of Cambridge, 2009.
[52] M. E. Newman and M. Girvan. Finding and evaluating commu-
nity structure in networks. Phys Rev E Stat Nonlin Soft Matter
Phys, 69(2 Pt 2), 2004.
[53] M. E. J. Newman. Finding community structure in networks us-
ing the eigenvectors of matrices. Physical Review E, 74(3), 2006.
[54] D. M. Nicol and N. Schear. Models of privacy preserving trafﬁc
tunneling. Simulation, 85(9):589–607, 2009.
[55] P. Paillier. Public-key cryptosystems based on composite degree
residuosity classes. In Eurocrypt. Springer, 1999.
[56] D. Pelleg and A. W. Moore. X-means: Extending k-means with
efﬁcient estimation of the number of clusters. In ICML ’00: Pro-
ceedings of the Seventeenth International Conference on Machine
Learning, pages 727–734, San Francisco, CA, USA, 2000. Mor-
gan Kaufmann Publishers Inc.
[57] P. Porras, H. Saidi, and V. Yegneswaran. A multi-perspective
analysis of the Storm (Peacomm) worm. In SRI Technical Report
10-01, 2007.
16