297 (CVE MITRE, 2022), https://cve.mitre.org
298 (Tenable, 2022), https://www.tenable.com/plugins
299 (Tenable, 2022), https://www.tenable.com/products/nessus
300 (Tenable Docs,2022), https://docs.tenable.com/generalrequirements/Content/NessusScannerHardwareRequirements.htm
301 (Wikipedia, 2021), https://en.wikipedia.org/wiki/Deb_(file_format)
302 (Tenable, 2022), https://www.tenable.com/downloads/nessus
303 (Wikipedia, 2022), https://en.wikipedia.org/wiki/SHA-2
304 (Wikipedia, 2022), https://en.wikipedia.org/wiki/MD5
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 168
Made in Morocco
Penetration Testing with Kali Linux
We then echo the copied checksum together with the filename of the installer into a file with the
name sha256sum_nessus. Since the button next to the SHA256 checksum only copies the
checksum itself, we need to enter the file name manually. The resulting sha256sum_nessus file
needs to be in the same directory as the Nessus installer. We will then use sha256sum305 with the
-c parameter to verify the checksum.
kali@kali:~$ cd ~/Downloads
kali@kali:~/Downloads$ echo
"4987776fef98bb2a72515abc0529e90572778b1d7aeeb1939179ff1f4de1440d Nessus-10.5.0-
debian10_amd64.deb" > sha256sum_nessus
kali@kali:~/Downloads$ sha256sum -c sha256sum_nessus
Nessus-10.5.0-debian10_amd64.deb: OK
Listing 91 - Verifying the checksum
y
The output shows that the checksums match, which means we can install the package. If there is
an updated version of Nessus, the checksum from the previous listing will be different and needs
k
to be adapted.
To install the Nessus package, we’ll use apt306 with the insstall option.
kali@kali:~/Downloads$ sudo apt install ./Nessus-10.5.0-debian10_amd64.deb
o
...
Preparing to unpack .../Nessus-10.5.0-debian10_amd64.deb ...
Unpacking nessus (10.5.0) ... n
Setting up nessus (10.5.0) ...
...
Unpacking Nessus Scanner Core Coimponents...
- You can start Nessus Scanner by typing /bin/systemctl start nessusd.service
z
- Then go to https://kali:8834/ to configure your scanner
Listing 92 - Nessus installation
D
After the installation is complete, we can start the nessusd service via systemctl.307
kali@kali:~/Downloads$ sudo systemctl start nessusd.service
Listing 93 - Starting Nessus
Once Nessus is running, we can launch a browser and navigate to https://127.0.0.1:8834. We will
be presented with a warning indicating an unknown certificate issuer, which is expected due to
the use of a self-signed certificate. To accept and trust the self-signed certificate, we can click on
Advanced… and then Accept the Risk and Continue.
305 (Man7, 2020), https://man7.org/linux/man-pages/man1/sha256sum.1.html
306 (Wikipedia, 2022), https://en.wikipedia.org/wiki/APT_(software)
307 (Wikipedia, 2022), https://en.wikipedia.org/wiki/Systemd
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 169
Made in Morocco
Penetration Testing with Kali Linux
y
k
s
Figure 35: Nessus Presenting a Certificate Warning
o
After the page loads, we are prompted to configure pre-installation settings. Let’s click on
Continue to start the installation with the default settings.
n
i
z
D
Figure 36: Configuring Pre-Installation Settings
Now, we can select a Nessus product. For the purpose of this Learning Unit, we’ll choose Register
for Nessus Essentials and click Continue.
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 170
Made in Morocco
Penetration Testing with Kali Linux
y
k
s
Figure 37: Selecting Nessus Essentials
Next, we are prompted to request an activation ocode for Nessus Essentials. We’ll provide the
required information and click Register.
n
i
z
D
Figure 38: Requesting an Activation Code
Once we have registered, the activation code is shown in the next window.
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 171
Made in Morocco
Penetration Testing with Kali Linux
Figure 39: Activating Nessus
y
Next, we’ll create a local Nessus user account. We’ll choose the username admin with a strong
password to protect our vulnerability scan results. We’ll usek these credentials to log in to the
Nessus application.
s
o
n
i
z
D
Figure 40: Creating a Local Nessus Account
Finally, Nessus downloads and compiles all plugins. This can take a significant amount of time to
complete.
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 172
Made in Morocco
Penetration Testing with Kali Linux
Figure 41: Downloading Nessus Plugins
After the plugins are downloaded and installed, we have a working instance of Nessus Essentials.
7.2.2 Nessus Components
Before we start our first vulnerability scan with Nessus, we’ll take some time to get familiar with
the core components. When we log in for the first time, we find a welcome window that allows us
to enter targets. We can close it without entering anything for now.
First, let’s investigate the tabs in the Nessus dashboard. In the Essentials version of Nessus, we
have two tabs called Scans and Settings.
y
k
s
o
n
Figure 42: Exploring Nessus Settings
i
The Settings tab allows us to conzfigure the application. For example, we can enter information for
a SMTP server308 to get scan results via email. The advanced menu allows us to configure global
settings ranging from user interface, scan and log behavior, to security and performance related
D
options.
As shown in Figure 42, the About menu lists basic information for Nessus, our license, and how
many hosts we have left. For further information on how we can customize and configure
Nessus, we can consult the Nessus documentation.309
Next, let’s examine policies and templates, we’ll click on the Scan tab then on Policies. A policy is
a set of predefined configuration options in the context of a Nessus scan. When we save a policy,
we can use it as a template for a new scan.
Let’s now click on Scan Templates. Nessus already provides a broad variety of scanning
templates for us to use.310 These templates are grouped into the three categories Discovery,
Vulnerabilities, and Compliance.
308 (Wikipedia, 2022), https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol
309 (Tenable Docs, 2022), https://docs.tenable.com/nessus/Content/Settings.htm
310 (Tenable Documentation, 2022), https://docs.tenable.com/nessus/Content/ScanAndPolicyTemplates.htm
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 173
Made in Morocco
Penetration Testing with Kali Linux
y
k
Figure 43: Nessus Policy Templates
s
The Compliance category is only available in the enterprise version as well as the Mobile Device
Scan template. The only template in the Discovery category is Host Discovery, which can be used
o
to create a list of live hosts and their open ports. The Vulnerabilities category consists of
templates for critical vulnerabilities or vulnerability groups e.g. PrintNightmare311 or Zerologon312
as well as templates for common scanningn areas e.g. Web Application Tests or Malware Scans.
Nessus also provides three general vulnerability scanning templates:
i
1. The Basic Network Scan perfzorms a full scan with the majority of settings predefined. It will
detect a broad variety of vulnerabilities and is therefore the recommended scanning
template by Nessus. We also have the option to customize these settings and
D
recommendations.
2. The Advanced Scan is a template without any predefined settings. We can use this when we
want to fully customize our vulnerability scan or if we have specific needs.
3. The last general scanning template, Advanced Dynamic Scan, also comes without any
predefined settings or recommendations. The biggest difference between the two templates
is that in the Advanced Dynamic Scan, we don’t need to select plugins manually. The
template allows us to configure a dynamic plugin filter313 instead.
Nessus Plugins are programs written in the Nessus Attack Scripting Language (NASL)314 that
contain the information and the algorithm to detect vulnerabilities. Each plugin is assigned to a
plugin family,315 which covers different use cases. We will work with the Advanced Dynamic Scan
template and plugins in the last section of this Learning Unit.
311 (MSRC, 2021), https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527
312 (MSRC, 2021), https://msrc.microsoft.com/update-guide/vulnerability/CVE-2020-1472
313 (Tenable Documentation, 2022), https://docs.tenable.com/nessus/Content/DynamicPlugins.htm
314 (Wikipedia, 2022), https://en.wikipedia.org/wiki/Nessus_Attack_Scripting_Language
315 (Tenable, 2022), https://www.tenable.com/plugins/families/about
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 174
Made in Morocco
Penetration Testing with Kali Linux
7.2.3 Performing a Vulnerability Scan
In this section we will perform our first vulnerability scan. To begin, let’s click on the New Scan
button on the dashboard in the Scans tab.
Figure 44: Creating a Scan
Nessus provides a list of the different templates. For this section, we will use the Basic Network
Scan, which we can launch by clicking on it.
y
k
s
o
n
i
z
D Figure 45: Selecting a Basic Network Scan
This will present the scan configuration settings screen containing the BASIC, DISCOVERY,
ASSESSMENT, REPORT, and ADVANCED settings.316
316 (Tenable Docs, 2022), https://docs.tenable.com/nessus/Content/TemplateSettings.htm
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 175
Made in Morocco
Penetration Testing with Kali Linux
y
k
Figure 46: Different Settings in Scan Configuration
The default screen is the General settings page with thes two required arguments: a name for our
scan and a list of targets. Nessus supports multiple target specifications,317 including a single IP
address, an IP range, and a comma-delimited Fully-Qualified Domain Name (FQDN), or an IP
o
address list.
For this example, we will scan the followinng machines: POULTRY, JENKINS, WK01, and SAMBA.
We will enter “Basic Vulnerability Scan” into the Name field and the IP addresses of the machines
into the Targets field.
i
z
D
317 (Tenable Docs, 2022), https://docs.tenable.com/nessus/Content/ScanTargets.htm
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 176
Made in Morocco
Penetration Testing with Kali Linux
Figure 47: Configuring Scan Name and Target List
Since we chose the Basic Network Scan template, Nessus has already configured most of the
settings for us. However, the default configuration might not be exactly what we need. Depending
on the scanning type, the environment, time constraints, and the targets, we may need to adapt
the settings to fit our needs.
In the default settings of this template, Nessus scans a list of common ports. For this
demonstration, we only want to scan ports 80 and 443. To do this, let’s click on the Discovery
settings and select Custom in the dropdown menu.
y
k
s
o
n
Figure 48: Selecting Custom Discovery Settings
The dropdown menu shown in Figuire 48 provides us with a number of predefined options. To
scan specific ports, we’ll need to szelect Custom.
After we click on Custom, additional configuration menus appear under the DISCOVERY menu.
D
We can now customize the Basic Network Scan template the same way as the Advanced Scan
template in the context of the DISCOVERY menu. Within the Port Scanning section, we will set the
Port scan range to “80,443”. Additionally, we’ll enable the option Consider unscanned ports as
closed so that Nessus treats other ports as closed, since we are only interested in ports 80 and
443.
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 177
Made in Morocco
Penetration Testing with Kali Linux
y
k
s
o
n
Figure 49: Specifying Ports 80 and 443
In this demonstration, we’ve custoimized the Basic Network Scan template to only scan two
specific TCP ports. But even in thze default settings of this template, Nessus does not scan UDP
ports. If we want to activate UDP port scanning, we need to manually configure it. We may miss
crucial information on UDDP services when it’s disabled during assessments, but we need to
understand that activating UDP port scanning will vastly increase the scan duration. Due to the
nature of UDP, it is not often possible to tell the difference between an open and a filtered port.
To save time and scan the targets more quietly, we will turn off Host Discovery because we know
the hosts are available. We do this by navigating to Discovery > Host Discovery where we toggle
Ping the remote host to Off.
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 178
Made in Morocco
Penetration Testing with Kali Linux
y
k
s
o
Figure 50: Disable Host Ping in Discovery Settings
During the configuration of the scan definition, we did not configure any credentials, which
n
implies that this scan will run unauthenticated.
We also didn’t change the default seittings of the ASSESSMENT menu in the Basic Network Scan
template. This means the brute fzorcing of user credentials will not be done. Even though brute
forcing is disabled, our scan creates a lot of network traffic and because we’re scanning multiple
hosts, will be highly noticeable.
D
Now that we have a basic understanding of how we can customize templates to fit our needs, we
can launch our first scan. We can do this by clicking on the arrow next to Save and selecting
Launch.
Figure 51: Launching the Scan
Initially, the scan will have a status of Running in the Nessus dashboard under My Scans.
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 179
Made in Morocco
Penetration Testing with Kali Linux
Figure 52: Running Scan in the Nessus Dashboard
Figure 52 shows the running scan and provides the options to stop or pause it. Once the scan is
finished, the status will change to Completed.
Figure 53: Completed Scan in the Nessus Dashboard
This concludes our first vulnerability scan with Nessus. In the next Learning Unit, we’ll examine
the results of the scan.
y
7.2.4 Analyzing the Results
k
In this section we will analyze the results of our first vulnerability scan. Due to the continuous
updates of Nessus and its plugins, the scan results can sdiffer slightly. We can click on the scan in
the My Scans list to get to the results dashboard.
o
n
i
z
D