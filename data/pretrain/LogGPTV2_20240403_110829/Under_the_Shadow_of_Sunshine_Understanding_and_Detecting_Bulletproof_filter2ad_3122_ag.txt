4% recycling rate.
Owner domain migration. From our interactions with the
BPH ecosystem we found the following; Service providers and
their subsidiaries, e.g. “ColoCrossing”, tend to occasionally
group multiple resellers in the same sub-allocation. Addition-
ally,
their
clients, were moved between sub-allocations when their IP
addresses were blacklisted. In an effort to identify resellers
and using the observation of inevitable client migration, we
leverage the collected list of TLD+3 hosted on the detected
sub-allocations by following their movements across sub-
allocations at different time intervals.
in 3 of our purchases from BPH services, we,
Once migrated TLD+3 are found, we look for groups of
TLD+3 moving together through sub-allocations by building
a graph to ﬁnd connected components. More speciﬁcally, we
build a graph G = (V, E) where V is the set of nodes
representing sub-allocations, and an edge is created between
two sub-allocations indicates a domain migration of more
than 50% of one sub-allocations’ TLD+3 set. After which,
we generate connected components using a Python Package
NetworkX [37], where each component represents a group of
TLD+3 moving together between at least two sub-allocations.
As a result, we identiﬁed 592 groups, a sample of 5 groups
is provided in Table XV with a velocity rate of 1 day per
sub-allocations.
The top moving group spanned 35 sub-allocations and was
mostly serving Command and Control (CnC). Additionally,
two other groups of moving TLD+3 had one common domain
pattern (e.g., 713811.xyz & 939211.xyz ) and lasted for over
a year. We believe this is more likely a private customer of
the service provider rather than a BPH service as one expects
a variety of patterns when multiple clients are involved.
C. BPH Clients
We study the clients of the BPH services by analyzing
the complete set of TLD+3 domains hosted on the detected
sub-allocations. In total, we collected a set of 260M TLD+3,
out of which 87.7% are found to have an average life of 1
day indicating the pervasiveness of fast ﬂuxing likely to evade
blacklisting. Using our commercial blacklist, BL-A, described
in Section III-B, we ﬁnd that 115K TLD+3 domains are present
on this blacklist. Table XVI shows that 50% of the blacklisted
domains are used to distribute malware or spyware, and 46%
are running botnet command and control servers. We note that
this blacklist focuses on these two activities and thus might be
biased, but this does show what is likely a small subset of the
malicious activities clients of these BPH services are engaged
in.
Client domain migration. To track clients moving between
sub-allocations and sometimes even BPH service(s), we follow
TLD+3 movements over the detected set of sub-allocations and
track the list of TLD+3 found to be hosted on sub-allocations
at different time intervals indicating network movement. Out
of a partially processed set, due to the large processing cost
incurred while cross-matching TLD+3 across sub-allocations,
we found that 1.6M TLD+3 have migrated between at least two
sub-allocations. Network movement enables TLD+3 to survive
for a longer period as can be seen in Table XVII which shows 5
selected TLD+3 hoping between at least 10 sub-allocations and
lasting for months. On average, we found the moving TLD+3
to hop 3 detected sub-allocations (10 being the maximum) with
an average life of 6.7 months.
819
Authorized licensed use limited to: IEEE Xplore. Downloaded on March 18,2021 at 12:21:58 UTC from IEEE Xplore.  Restrictions apply. 
#
1
2
3
4
5
#Sub-allocations
35
33
14
8
6
#TLD+3
841
3713
12352
186
9347
#FQDN
52
3713
754
32
6708
#ASes
3
1
2
3
1
Life-Time(Start-End)
20110103-20160524
20150413-20160920
20160116-20160824
20140421-20160702
20150428-20160910
Note
RIRs
Spyware CnC
ARIN, RIPE
\p[4,5].\p[4,5].tld
ARIN
\p[6].tld
ARIN
ARIN, RIPE Mobile CnC
APNIC
Fast Flux
TABLE XV: Sample of 5 large groups of TLD+3 moving together between a large number of sub-allocations. Samples of TLD+3 for each
group can be found in Table XIX in Appendix.
Type
Botnet CnC
Spyware
DriveBy Sources
Dynamic DNS
Credential Drop Sites
Total
Size(%)
53K(46%)
43K(38%)
13K(12%)
3k (2%)
93 (0.08%)
115K
TABLE XVI: Types of malicious activities found in 115K TLD+3.
TLD+3
1-factoring.ru
a.biomuders.at
apple-chasy-dlia-vas.ru
apilogin.ru
iinbanks.ru
Overall Age
12 months
1.3 months
11.8 months
7.1 months
11.6 months
Activity
Spam 11
Carding 12
Pushdo botnet 13
Malware 14
Spam & Phishing 15
TABLE XVII: 5 Selected TLD+3 hoping at least 10 detected sub-
allocations.
VI. DISCUSSION
We have presented a method for accurately detecting
malicious sub-allocations of network blocks and validated this
method to the extent that we could. In this section, we will
discuss some of the limitations of our method in terms of
evaluation, scope, and robustness to evasion. We will also
highlight a few of the potential follow-up studies that could
be performed based on our method and ﬁndings.
A. Limitations
Ground Truth. One of the primary limitations of our method
is the lack of ground truth information about which sub-
allocations are actually controlled by BPH services, which
are simply poorly managed, and how much malicious activity
is truly emanating from each of these sub-allocations. To
overcome this we have validated our classiﬁer’s performance
using a number of data-sets and approaches. Our validation
approach involved manually creating and using existing high
quality labeled lists of benign and malicious sub-allocations
and validating that our classiﬁer is fairly accurate when trained
and tested on these lists. Unfortunately, these lists tend to
be smaller and might be biased towards the extremes since
these sub-allocations are likely the easiest to investigate and
correctly label. To overcome these possible biases, we also
evaluated our classiﬁer on what is likely a noisier set of labeled
sub-allocations. As expected our classiﬁer performs worse on
this set, but it is difﬁcult to measure the true precision and
11http://www.joewein.de/sw/spam-bl-1.htm
12https://krebsonsecurity.com/2016/05/carding-sites-turn-to-the-dark-
cloud/
13http://www.malwareurl.com/ns_listing.php?as=AS48666
14http://www.malwareurl.com/ns_listing.php?ip=185.121.25.7
15http://www.joewein.de/sw/bl-log-2016-01-12.htm
recall since the labeling of the sub-allocations is imperfect.
We attempt to identify some features, most of which are not
used by our classiﬁer, to validate these results, but again this
only gives us a sense of how well it is performing and not
a precise metric. Finally, we ran the trained version of our
classiﬁer that had what we believe to have lower recall and
higher precision over the entire set of sub-allocations we found
in all ﬁve of the RIR Whois data-sets. We did some manual
sub-sampling of detected sub-allocations. This again indicated
that our classiﬁer is fairly precise, but we could not measure
the recall rate without expending more manual effort to explore
undetected sub-allocations.
Scope of Detection. Our classiﬁer is focused on detecting
maliciousness within a particular type of network block that
has been sub-allocated from the parent owner. This focus
was chosen based on anecdotal reports of how BPH services
have evolved to evade blacklisting, our own results from
purchasing BPH, and our analysis of what is included in the
blacklist. Again it is difﬁcult to understand what recall of the
overall BPH infrastructure we achieved. It is clear that we are
detecting a large number of network blocks that are likely
malicious and probably outperforming both AS reputation
metrics and IP address blacklists, both of which these BPH
services have adapted to evade.
Robustness of Detection. Since we are attempting to detect
an adaptive adversary it is important to consider the robustness
of any detection system. Again it
to evaluate
the robustness of our features and classiﬁer. However, when
choosing features we did consider robustness and selected
some features, such as network utilization and domain churn
that in order to evade would likely cause the BPH services to
either increase their costs, decrease their client’s rate of abuse,
or become more susceptible to blacklisting.
is difﬁcult
There are other methods of avoiding detection, such as
high rates of network block recycling, which exploits the fact
that our approach takes a few months to detect malicious sub-
allocations. Complicit service providers make it more difﬁcult
to detect malicious sub-allocations because their high sub-
allocation recycling rates cause each sub-allocation to have
a limited footprint in passive DNS before the BPH service
is moved to another sub-allocation. An example of this is
“Colocrossing”, for which we were able to detect only 44
(out of 7K) sub-allocations using our Set-B trained classiﬁer.
Another evasion strategy is for BPH services to quickly
abandon the sub-allocation, which again will drive up their
costs of operation. These activities might also be anomalous
and themselves be detectable by adding additional features and
tracking domain movements more aggressively. However, our
current detection approach will not be effective against actively
colluding service providers.
820
Authorized licensed use limited to: IEEE Xplore. Downloaded on March 18,2021 at 12:21:58 UTC from IEEE Xplore.  Restrictions apply. 
B. Ethical Concerns
In order to study the potential illicit activities that may take
place in sub-allocations, we conducted two types of purchas-
ing; resellers packages and BPH hosting. We contacted several
legitimate service providers to participate in their reseller
programs in order to investigate whether and how reseller’s
information is propagated to Whois. During our interactions
with the providers, we made sure that no harm was done to
them in our experiments and investigations. Additionally, as
mentioned earlier, we contacted the BPH services identiﬁed
from underground forums for the purposes of understanding
their malicious activities, ecosystem,
infrastructure and to
collect ground truth data. Our purchasing activity has been
explicitly reviewed and approved by The University of Indiana.
We did our best to avoid paying them whenever possible:
speciﬁcally, we ﬁrst requested test IP addresses, which are
free and only for the extremely interesting targets that did not
offer such free trials did we move forward to purchase their
services. We believe that the value of our work outweighs
the relatively minor ethical concerns resulting from the small
ﬁnancial support provided to these BPH hosting providers
through our purchases.
C. Future Work
Our features, classiﬁer, and analysis of this ecosystem is
a starting point for detecting these evasive and agile BPH
services. It exposes the wealth of information from Whois,
passive DNS, and other sources that can be collected and trans-
formed into useful features for detecting malicious network
blocks. As future work, we plan on exploring the feasibility
of leveraging our improved understanding of how these BPH
services operate and the expanded ground truth provided by
the results from this study to develop even more effective and
timely detection approaches. These approaches could be based
more on Whois data, recycling and re-branding patterns, and
less or not at all on passive DNS which we have found to
be a useful but slow detection feature. The goal is to create
a system, similar in spirit to PREDATOR [38], that might be
able to proactively, at sub-allocation registration time, predict
if a sub-allocation will likely be benign or malicious.
VII. RELATED WORK
Working with sub-allocations. To the best of our knowledge,
there has been no prior academic work on leveraging IP
address sub-allocation information to ﬁnd blocks of malicious
IP addresses at the sub-ASN granularity level. Mahjoub from
OpenDNS has presented two systems that mention using sub-
allocation information from Border Gateway Protocol (BGP)
and Whois feeds. The ﬁrst system presented in 2014 called
Marauder [35] focused on identifying “leaf-ASNs” or Border
Gateway Protocol (BGP) sub-allocations and using the network
structure of BGP routing tables to detect anomalous and likely
malicious leaf-ASN network blocks that are peering with
legitimate service providers. The other system, SPRank [39],
is based on what they describe as an “IP range ﬁngerprinting”
approach and focused on detecting the same threat we are
exploring which is detecting BPH providers operating within
legitimate service providers. Neither of these presentations
provide enough details, such as methodologies, capabilities, or
assessments of their systems to understand how they operate
and how well they perform. What we can reconstruct from
these presentations is that they reinforce the notion that large
amounts of data can be potentially used to detect malicious
sub-allocated network blocks. In our work, we have presented
what we believe to be the ﬁrst detailed methodology and
evaluation of a machine learning based system for detecting
malicious sub-allocated network blocks.
The only other network block based work we are aware
of is the Spamhaus Edrop list [14] which is a smaller list
of manually compiled malicious network blocks that we used
for the training and validation of our machine learning based
detection system.
Detecting Malicious AS. There have been several methods
proposed for detecting malicious ASes. Chen conducted a
study that analyzed longitudinal trends of malicious IP ad-
dresses and made the observation that many of them exhibit
spatial correlations that can be mapped back to a small set
of ASes [40]. Fire [13] was published in 2009 and was one
of the ﬁrst systems for methodically detecting BP ASes. The
method Fire used was to aggregate information temporally and
spatially from multiple blacklists in order to detect elevated
concentrations of persistently malicious activity within an AS’s
IP address allocations. There have been multiple additional
studies that have reﬁned this blacklisting approach for detect-
ing BP ASes [41], [42]. More recently, Shue, et al. [43] noted
that BP ASes often fast-ﬂux their BGP routing information to
evade detection. ASwatch [7] leveraged this signal that fast-
ﬂuxing of BGP routing information is a strong indicator of
a BP AS to build a classiﬁer to detect BP ASes before they
appear on blacklists.
We have used these prior studies as one feature in our
detection system (i.e. AS ranking), but these systems alone
can not produce a network block based detection model since
they focus on detecting the parent AS. Thus, as part of our
study we have identiﬁed a number of new features tailored
to our speciﬁc goal of detecting ﬁne-grained malicious sub-
allocated network blocks that enable us to build an accurate
detection system.
Legitimate Service Providers Abuse. Another source of con-
centrated abuse arises from poorly managed service providers
that are either compromised or have lax vetting processes for
their clients. Collins, et al. [44] showed that misconﬁguration
can be used to predict increased probability of future abusive
activity from an AS. Zhang, et al. [45] also found a correlation
between scanning results indicating evaluated levels of mis-
conﬁguration and abuse likely due to compromised systems.
Other studies have also noted that legitimate services providers,
including ISPs [46] and cloud hosting services [47], are often
used for abusive hosting. When selecting the features for
our classiﬁer, we attempted to avoid detecting compromised
infrastructure, however this is a challenging task because it is
sometimes difﬁcult to differentiate between malicious activity
generated from none-compromised as opposed to compro-
mised hosts. We found a few instances where our classiﬁer
detected compromised network blocks when a large portion of
the hosts within the network block were compromised for a
long period of time.
Fast ﬂuxing. Corona, et al. [48], used features from passive
DNS to detect fast-ﬂuxed domain names. There have been a
821
Authorized licensed use limited to: IEEE Xplore. Downloaded on March 18,2021 at 12:21:58 UTC from IEEE Xplore.  Restrictions apply. 
number of follow-up studies that have identiﬁed improved sets
of features from passive DNS that can be used to detect fast-
ﬂuxed domain names [49], [50]. In our study, we have used this