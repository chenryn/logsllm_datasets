We hypothesize that there may be some time between when
spammers register new domains and when they send spam. We
examine the extent of the delay between the time when a domain
is initially registered and when it is ultimately used in an attack.
If such a delay exists, it might allow blacklist operators to list the
malicious domains, possibly before the spam campaign occurs.
How much time occurs between the domain registration and
attack? Figure 1 shows the distribution between the time when
we start to observe records about the malicious domains registered
271in March 2011, and the earliest time when the domains appeared
in the spam messages. We take the timestamps in our spam traps,
as well as emails received at the Yahoo! mail servers. Yahoo! Inc.
provides the received time of all email messages and the URLs con-
tained in the messages. The Yahoo! email gives a broader coverage
of monitoring around the world. We take the earliest time points
when seeing a “bad” domain in email messages (either in Yahoo!
data or in spam trap) as the estimated start of the spamming attack
about that domain. The x-axis represents the delay between when
a domain was registered and when we ﬁrst witnessed the domain
associated with a spam campaign, and the y-axis is the percentage
of the malicious domains registered in March 2011.
Finding 4.1 (Delay until attack) More than 55% of the mali-
cious domains appeared in spam campaigns more than one day
after they were registered.
We deﬁne the ﬁrst ﬁve days after domain registration as pre-attack
period. About 20% of domains might not be used in attacks dur-
ing this period, and the time windows for other domains being ex-
plored in spamming are also limited. In the rest of the paper, we
will analyze the characteristics of DNS infrastructure for malicious
domains both throughout their lifetime (i.e., after the domains’ reg-
istration) and within the pre-attack period. In Section 5, we further
investigate the lookup behavior during the early stage.
4.2 Location of DNS Infrastructure
When determining the IP address that maps to each DNS record,
we ﬁnd that the assigned records for spam domains across IP space
are far from uniform.
How is the DNS infrastructure that hosts a domain initially dis-
tributed across IP address space? The initial distribution of do-
main records across IP address space may provide clues as to a do-
main’s reputation. Figure 2 shows how the IPs associated with NS,
MX, and A records from malicious and legitimate domains are dis-
tributed across IP address space. The x-axis represents IPv4 space.
If an IP maps to multiple records from different domains, we count
it only once in the ﬁgure. The y-axis indicates the percentage of
addresses less than or equal to the IP value on the x-axis. The solid
blue curves plot the distribution of legitimate sample domains, the
red dashed curves show the outcome of malicious domains, and the
green dash-dot curves represent observed records for the malicious
domains during pre-attack period. Interestingly, we observe that
the DNS records associated with malicious domains are distributed
differently than the records associated with legitimate ones.
Finding 4.2 (Distribution across IP address space) The
IP addresses used by malicious domains in the NS, MX and A
records are distributed densely in a small fraction of IP address
space.
The IP addresses associated with DNS resource records are not dis-
tributed evenly across the IP address space. Some network range
has more IPs pointed from NS, MX or A records; while the record
IPs in other fraction of address space are distributed sparsely. Par-
ticularly two network blocks carried records from malicious do-
mains, 96.45.0.0/16 and 216.162.0.0/16. The preﬁx 173.213.0.0/16
has many IPs in spamming domains, but the same range hosts le-
gitimate domains, too. This observation indicates that if IPs corre-
sponding to different domains’ records reside close to each other in
a network block, those domains may appear in spam in the future.
(a) Legitimate domains
Type
NS
MX
A
AS
8560
26496
4134
26496
15169
21844
26496
8560
21844
domain ratio
15.9%
10.9%
10.1%
30.5%
7.3%
7.0%
31.8%
4.3%
4.1%
AS Name
1&1 Internet AG
GoDaddy.com, Inc.
Chinanet Backbone
GoDaddy.com, Inc.
Google Inc.
ThePlanet.com
GoDaddy.com, Inc.
1&1 Internet AG
ThePlanet.com
Country
Germany
U.S.
China
U.S.
U.S.
U.S.
U.S.
Germany
U.S.
(b) Malicious domains
AS
4134
28753
31365
197088
3292
5632
4134
197088
30890
domain ratio
33.6%
17.0%
16.3%
23.9%
19.3%
12.3%
19.3%
14.3%
13.8%
AS Name
Chinanet Backbone
Leaseweb De
SGSTelekom
Colohost LLC
TDC Data Networks
3dgwebhosting.com Inc
Chinanet Backbone
Colohost LLC
Evolva Telecom
(c) Malicious domains in pre-attack period
AS
4134
28753
27699
197088
3292
5632
4134
197088
28753
domain ratio
37.8%
20.4%
11.3%
14.3%
21.8%
12.3%
19.7%
15.0%
11.6%
AS Name
Chinanet Backbone
Leaseweb De
Tel. De Sao Paulo S.A.
Colohost LLC
TDC Data Networks
3dgwebhosting.com Inc
Chinanet Backbone
Colohost LLC
Leaseweb De
Country
China
Germany
Turkey
Latvija
U.S.
U.S.
China
Latvia
Romania
Country
China
Germany
Brazil
Latvija
U.S.
U.S.
China
Latvia
Germany
Type
NS
MX
A
Type
NS
MX
A
Table 2: Top three ASes containing domains’ records.
sufﬁcient to conﬁrm that a domain is scam-related. We examined
the distribution of the resource records across ASes and compared
the distribution of legitimate and malicious domains. Table 2 shows
the top three ASes ranked by the percentage of domains ever having
records being resolved into ASes.
Finding 4.3 (Distribution across ASes) More than 30% of the
malicious domains have at least one record resolving to one or
two particular ASes, which are different from those ASes mostly
used by legitimate domains.
We observe that many of the new legitimate domains have larger
registrars like GoDaddy operate their DNS, and host their ser-
vice infrastructure with well-known provider, like Google. On
the other hand, spamming domains’ records are scattered across
multiple ASes and countries. Spammers appear to prefer certain
speciﬁc ASes to host their DNS infrastructure.
Are there “bad” ASes that host DNS infrastructure exclusively
for malicious domains? We deﬁne an AS as “tainted” once the
number of malicious domains whose DNS records are resolved
within the AS exceeds a threshold. The set of tainted ASes rep-
resent the networks that attackers most heavily use, as indicated by
the malicious domains’ registration. After a domain’s registration,
attackers create DNS entries for the domain, and the records resolve
to different IP addresses. We then check whether the resulting IPs
belong to the tainted ASes. If a domain accumulates many records
that resolve to tainted ASes, we suspect that the domain is related
to the observed attacks.
Is the DNS infrastructure for malicious domains located in par-
ticular ASes? Of course, the IP addresses of the records are not
Finding 4.4 (Domains hosted by “bad” ASes) Most
legiti-
mate domains have A, MX, and NS records that are hosted
272100
 80
 60
 40
 20
s
P
I
f
o
s
r
e
b
m
u
n
f
o
%
e
v
i
t
l
a
u
m
u
C
100
100
s
P
I
f
o
s
r
e
b
m
u
n
f
o
%
e
v
i
t
l
a
u
m
u
C
legitimate sample
malicious
pre−attack period
 80
 60
 40
 20
s
P
I
f
o
s
r
e
b
m
u
n
f
o
%
e
v
i
t
l
a
u
m
u
C
legitimate sample
malicious
pre−attack period
 80
 60
 40
 20
legitimate sample
malicious
pre−attack period
  0
  0.*
 30.*
 60.*
 90.*
120.*
IP space
150.*
180.*
210.*
240.*
  0
  0.*
 30.*
 60.*
 90.*
120.*
IP space
150.*
180.*
210.*
240.*
  0
  0.*
 30.*
 60.*
 90.*
120.*
IP space
150.*