== 仪表盘
仪表盘方便用户查看日志的统计情况。仪表盘分为二级组织结构：仪表盘 → 标签页。您可以创建不同的仪表盘展示不同来源的日志信息。
您可以利用角色权限系统，将自己创建的部分仪表盘共享给不同的用户、用户分组和角色，并分别设置其读写权限。例如您的运营团队希望看到系统稳定性指标；您的开发团队希望看到应用程序的使用情况；而您的营销团队想要追踪新注册用户。详细的权限系统配置，参阅本手册后续章节。
列表中，用户可以在自己可见的仪表盘中点击"更多"，设置每次登录系统时，默认出现的仪表盘。
image::images/dashboard-default.png[]
对仪表盘的管理，你可以做如下操作：
* 设置默认仪表盘
* 收藏
* 标签
* 添加仪表盘
* 重命名
* 修改数据用户
* 授权
* 删除仪表盘
=== 标签页管理[[tab-manage]]
对标签页的管理，您可以进行以下操作。其中页内操作菜单可选项如下：
* 展开/收起左侧目录：默认展开。展示效果如下图：
+
image::images/dashboard-left-libarery.png[]
* 左侧目录操作：目录支持多种操作
** 搜索仪表盘名称/标签名称：在左侧顶部搜索框搜索仪表盘名称或标签名称，快速定位到指定内容。
** 添加标签页：第一次打开仪表盘会自动弹出新建标签页弹窗，用户填写标签名称，选择布局类型后，点击"确定"，创建标签页。如果仪表盘内已有标签页，在左侧目录选中标签名称，点击右键，点击"新建标签页"，在弹窗中填写标签信息，点击"确定"，添加成功。
** 将标签页设为默认展示：选中标签名称，点击右键，选择"设为默认"，设为默认后，每次打开该仪表盘，默认展示该标签页。
** 编辑：编辑标签名称。
** 删除：删除标签。
** 移动标签：选中标签并拖拽，支持在仪表盘内移动标签页，也支持在仪表盘间移动标签页。
** 返回列表：点击"仪表盘管理"，返回仪表盘列表。
* 添加：往标签页内添加图表、事件列表、过滤项或输入项。
* 显示过滤项：是否显示过滤项、输入项、时间范围。
* 启用编辑项：是否允许添加、修改标签页内的图表和过滤组件，以及展示修改入口图标。
* 夜间模式：是否采用夜间模式展示仪表盘标签页。
* 启用钻取：是否启用图表定义好的钻取策略。
* 过滤输入项自动更新：是否对页内所有过滤项、输入项均开启自动更新。关闭该项后，全局过滤区域将出现"更新"按钮用于手动点击。
* 启用展示条件：在行布局时，是否启用图表挂件的展示条件判断。 不启用时，所有图表一律展示不隐藏。
* 编辑布局：进入图表布局的编辑状态。
* 全屏展示：是否全屏展示仪表盘标签页。
* 移出标签页：将标签页转移到其他仪表盘里。
* 复制标签页：在同一仪表盘下复制出名为[当前标签页名称_copy]的新标签页。
* 高级编辑：修改标签页和过滤项输入项的高级定义参数。
* 手动刷新：手动刷新图表数据。
* 自动刷新：设置仪表盘标签页的自动刷新频率：30秒、1分钟、5分钟，或自定义间隔。
* 保存为
** 存为报表：根据标签页中的趋势图快速创建对应的报表。
** 存为PDF：将当前标签页趋势图的数据截屏为PDF文件。注意：PDF效果取决于浏览器当前大小和分辨率效果。如下图所示：
+
image::images/dashboard-savepdf.png[]
在仪表盘标签页的标题栏右下角，还有一个小的收起按钮。点击收起，会隐藏掉整个标签页标题栏，给图表部分留出更多的数据展示空间。当您只需要一个标签页，或者直接通过 App 的多级菜单来直接展示仪表盘列表时，可以收起标题栏。
image::images/dashboard-title-hide.png[]
==== 图表布局
日志易提供两种不同的图标布局供用户选择。在新建标签页时，可以选择"自由布局"或"行布局"：
image::images/dashboard-tab-new.png[]
===== 行布局
行布局适合比较常见的需求，将仪表盘空间划分为行和列的表格，然后按格填入图表。
行布局的标签页，首先必须在右上角点击"添加行"。可以给行命名，可以在添加行时一并选择行内图表，被选中图表的宽度将等分整行宽度。
image::images/dashboard-row-add.png[]
行布局下，点击添加图表时，也必须选择加入具体哪行。如果行未命名的，将显示为具体第几行，比如 L1:
image::images/dashboard-trend-add-to-row.png[]
添加图表时，可以指定添加方式，默认从趋势图列表复制一份配置到仪表盘中。可选择引用方式，引用趋势图的查询语句、数据集配置，在仪表盘中不可修改。引用的趋势图如果开启了加速功能，仪表盘也将自动启用加速效果。
添加图表的宽度将挤占本行最右侧原有图表的右侧宽度，具体挤占策略请参见后续自由布局小节。
当行内有图表，且行未命名时，默认将不展示行名称的位置以节省一行空间。您可以在本行右上角点击行设置修改名称，或直接删除本行。
image::images/dashboard-row-setting.png[]
行布局的高级编辑中，可以修改行的高度，拖放任意行内图表的高度，都将修改本行所有图表的统一高度。图表在多行之间，可以随意拖拽。
此外，行内可以放置输入项。您可以在添加输入项时，直接选择"加入行"。也可以进入"编辑布局"，将全局过滤区域内的某个输入项，拖拽至具体某行内：
image::images/dashboard-input-in-row.png[]
输入项的布局位置，与过滤钻取行为无关。建议用户仅在确认该输入项与本行图表强相关时才拖入这行。
===== 自由布局
为了尽力保证用户视觉的饱满度，日志易仪表盘秉持尽量填满空间的布局原则，还设计了一套图表自动填充和碰撞协商机制：
* 默认情况下，新添加的图表，都以其默认高度，独占新的一行。
* 在拖动图表到其他位置时，将该位置原有图表进行挤压，腾挪空间。
* 对任一图表的高度进行调整时，如果其高度与所在行所有图表高度一致，则调整将影响调整方向上其他所有图表。
* 对任一图表的宽度进行调整时，如果其高度与所在行所有图表高度一致，则调整将逐次挤压调整方向上其他图表。
* 对任一图表进行宽高度调整时，如果其高度与左右图表高度不一致，无法构成独立的行，则调整无法完成挤压，可能形成空洞效果。建议不要采用这种布局。
* 拖动或调整的挤压效果，到一行12个栅格都被单独占用为止。
* 挤压时，以原图表对角线为分隔线，鼠标当前位于对角线右侧，则让出右侧一半空间给新图表；位于对角线上侧，则让出上侧一半空间给新图表；左侧下侧亦然。
image::images/Image-130318-080218.804.png[]
点击"编辑布局"进入图表布局编辑器，日志易提供占位阴影的方式，提示用户挤压后的预览效果。如果不满意，不要释放鼠标，继续拖动图表到其他位置，查看新效果即可。
image::images/dashboard-layout-edit.png[]
==== 过滤项[[filter]]
点击添加过滤项看到的浮层界面如下：
image::images/dashboard-filter-new.png[]
过滤项组件的可设置内容包括：
* 标题：展示名称；
* 标识：该过滤项的id，在本标签页内应该唯一确定。默认可以等同于标题，建议使用英文；
* 宽度：该过滤项的展示宽度，默认为 200px，当过滤项内容预计较长时，可以按需修改；
* 自动搜索：启用该选项后，在输入框内完成输入，直接回车立刻搜索，不用手动点击‘更新’按钮；
* 过滤字段：输入值属于哪个字段，如果不确定，可以留空或写raw_message表示全文搜索；
* 绑定图表：过滤条件对哪些图表生效。
过滤类型可选择：文本输入、下拉菜单或者动态菜单三种形式。
过滤类型选择“下拉菜单”效果如下：
image::images/dashboard-select-edit.png[]
选定下拉菜单，一一先添加需要过滤的菜单选项，再设置默认值。示意图中，我们添加一个日志类型菜单。为了方便用户查看，日志易支持为选项值额外定义可选的选项别名。比如为"logtype:fw"定义展示别名为"防火墙"。
“动态菜单”是在下拉菜单基础上的更高级运用。选定动态菜单以后，在搜索内容中填写SPL语句，选择搜索时间，然后设置动态字段值(注意动态字段应该是搜索内容所返回的结果中存在的字段)。点击搜索后，即可在默认值菜单中看到本次搜索的结果，你可以选择一个作为本过滤项以后的默认值。
为了方便用户查看，"动态菜单"同样也支持额外定义一个可选的动态别名字段。
考虑到 SPL 语句生成的选项时刻在变动，有时候可能会有缺失，所以即使在"动态菜单"类型下，也支持固定选项的自定义。最常见的场景，就是加一个值为'*'，别名为'全部'的固定选项作为"动态菜单"的默认值。示例配置如下：
image::images/dashboard-select-all.png[]
对应的别名效果如下图，可以看到实际发起的请求是采用了字段值的内容：
image::images/dashboard-select-show.png[]
下拉菜单和动态菜单默认为单选菜单格式，用户可以指定为多选菜单格式。
image::images/radio-menu-setting.png[]
过滤类型设定完成后，下一步勾选需要绑定的图表。点击“确定”后，过滤组件即完成，之后使用的用户可以使用过滤组件完成对该仪表盘页面的过滤操作。
示例：
1.	点击添加过滤组件，配置“标题”为“主机名”，“标识”为“host”，“过滤类型”为“文本输入”，“过滤字段”为“hostname”，“默认值”为“*”，绑定图表全选。
+
image::images/Image-130318-075413.481.png[]
2.	点击确定。页面出现文本输入框组件和搜索按钮。
+
image::images/Image-130318-075427.032.png[]
3.	输入框内输入192.168.0.1字样，回车或点击搜索按钮。
结果：页面上三个图表都变成仅为192.168.0.1条件下的结果。
==== 输入项
输入项和过滤项在普通场景下作用类似，其主要设置内容也类似。如下图所示：
image::images/dashboard-input-new.png[]
可以看到，在过滤类型为‘文本输入’时，输入项和过滤项的区别仅在于没有‘绑定图表’的设置。因为输入项的功能，不仅可以作为图表的过滤条件，还可以作为更高级的图表功能控制项。
比如，通过上图的输入项，能控制折线图的时间分组颗粒度。我们在受控的图表设置里，填入如下SPL语句即可：
image::images/Image-130318-075502.490.png[]
日志易系统会自动根据查询语句里引用的标记token，找到对应的输入项，获取值的内容并填入语句。最终，实际发送的查询语句就变成了：
[source,bash]
* | bucket timestamp span=1m as ts | stats count() by ts
当输入项无实际值时，图表会直接提示目前处于‘等待输入项’的状态：
image::images/Image-130318-075522.904.png[]
当输入项内已经填写的值被清空后，鼠标点击框外空白区域，输入项会自动恢复到初始设置的默认值。
显然，对于bucket指令的span参数，常用值是比较确定的，使用文本输入反而要担心输入错误的问题。输入项和过滤项一样，也提供了下拉菜单和动态菜单的输入类型。
考虑到输入项最终要作为字符串内容插入到查询语句中，而检索语法和统计语法中，对多值的处理设计未必一致。输入类型为下拉菜单或动态菜单时，用户需要根据实际引用输入项的语句情况，合理设置其前后缀设置。
比如下图设置的下拉菜单：
image::images/Image-130318-075536.999.png[]
当它预备作为检索语句的一部分时，语句写作：
[source,bash]
* AND ${logtype} | stats count() by hostname
则前后缀配置应该是：
image::images/Image-130318-075556.427.png[]
相反，如果作为统计后的过滤语句，语句写作：
[source,bash]
* | stats count() by logtype | where ${logtype}
对应的前后缀配置则应该是：
image::images/Image-130318-075618.470.png[]
当输入项类型为动态菜单时，在搜索语句里，还可以引用其他已有输入项标识，达到多个输入项的联动效果。
比如，创建如下两个输入项：
1.	标识为f1的下拉菜单，可选值为apache, json, other；
2.	标识为f2的动态菜单，搜索语句为：logtype:${f1} | stats count() by hostname。
输入项的初始状态如下：
image::images/Image-130318-075939.116.png[]
当选择了f1输入项的具体值时，f2自动刷新得到新的可选项了：
image::images/Image-130318-080024.936.png[]
输入项标识作为仪表盘 URL 中的请求参数，可以通过 URL 地址的方式直接给输入项传参。对于多选菜单输入项，按照业界惯例，重复多次传参即可。比如：`http://日志易地址/dashboard/1/1/?ff2=aaa&f2=bbb` 会自动给 f2 多选菜单赋值为选中 aaa 和 bbb 的状态。