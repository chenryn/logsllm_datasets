13,585 (0.9%)
13,046 (0.9%)
Cat Telecom
Rostelecom-AS
TOT-NET
UKRTELNET
IR-THR-PTE
Count (%)
12,883 (0.9%)
11,352 (0.8%)
11,136 (0.8%)
10,993 (0.8%)
9,248 (0.6%)
and tooling in each of the life cycle phases. In Section 6, these find-
ings on the individual stages will be combined into an overview of
the actor landscape.
5.1 Identification
In order to gain a foothold on a machine, adversaries first need
to know where exploitable devices are located. This also holds for
vulnerable MikroTik routers, of which according to market surveys
approximately 2M units were installed worldwide [33]. Routers
are usually deployed in one of three ways on the Internet: (a) they
are either provided by the Internet Service Provider (ISP) to the
customer who uses the device to connect to the ISP’s network, (b)
they are bought, deployed and operated by the customer to connect
to the Internet, or (c) they are part of the network infrastructure of
the ISP. As RouterOS was used across the entire MikroTik product
line, we see vulnerable devices of all three types in practice.
Figure 6 shows a heatmap of all MikroTik routers that were
exploited at least once during the study period, mapped to a geo-
graphic location by using the MaxMind GeoIP database [19]. The
devices are very prevalent in select parts of the world, especially
Brazil or Indonesia, where such a device responded at 29%, and
35% of all publicly accessible IP addresses of the largest operators
in these countries, thereby indicating that these devices were pro-
vided by the ISP to the customers. Table 2 lists the number of com-
promised MikroTik routers for the 10 most affected autonomous
systems and their share of the overall infected population. We can
see that 136,659 exploited MikroTik routers could be linked back to
the 5 most compromised ISPs. The heatmap however also shows
sparse deployments throughout the world, with clusters appear-
ing in densely populated areas, proportionally to the number of
IP addresses located in an area, suggesting that these routers were
owned and operated by end customers.
5.1.1 Discovery using Port Scanning. To localize potential victims,
adversaries could make use of port scanning to test remote IPs
whether they have TCP port 8291, the port associated with the
WinBox vulnerability, open. This reconnaissance could be done
at different levels of granularity and sophistication: on the low
end, attackers could blindly trawl through the entire Internet in
a horizontal port scan to discover any potential victim, albeit at
the disadvantage of creating much noise and potentially being
Figure 5: Packets received on port 8291 in our network tele-
scope (in solid blue) and NetFlows observed (in dashed red).
identified, blocked and blacklisted. A sophisticated scanner could
however do some prior background research, and determine in
which networks large MikroTik installations exist, as a result of
these devices being used within an ISP’s network or being given
out to its customers.
We can differentiate between these type of strategies using the
data provided by the network telescope and general flow statis-
tics of the Tier 1 operator. Figure 5 shows the absolute number of
packets directed against port 8291 in our telescope as well as traffic
carried by the operator during 2018 aggregated by day. The vertical
lines show important milestones in the lifespan and news cover-
age of the exploited vulnerability. On March 24, the average daily
traffic towards TCP 8291 exploded by 6 orders of magnitude, as the
Hajime botnet executed a short, but concentrated horizontal scan
for the port across the Internet [25]. On April 23, the vulnerability
was discovered and patched by MikroTik, and the resulting news
coverage only lead to a very minor continuous increase in scan-
ning traffic. This is interesting, as for example the media reporting
around the memcached DDoS vulnerability in early 2018 led to a
major influx of actors and probing activity [13]. Starting mid-July,
the first cryptojacking installations started to appear in the wild,
followed by a public proof-of-concept for the exploit. Finally, in the
beginning of August the CVE report was published in the National
Vulnerability Database [26].
As we can see from the graph, the general characteristics of
telescope and NetFlow traffic resemble each other. Both record the
same sudden increase in network traffic due to the Hajime botnet
at the same moment and with a similar magnitude, demonstrating
that the botnet initiated an unspecific worldwide trawl for the
vulnerability. While after this burst the telescope traffic returns to
business-as-usual, aside from selected worldwide scans, we see in
the NetFlow data that geographically targeted scans – not targeting
our network telescope – immediately followed, and continued to
run until the end of the observation period. As the number of
infections started to rise in December 2019, we observe increased
worldwide scanning activity as both our telescope and NetFlow
data report more connections towards port 8291.
Out of a total of 1.7M IP addresses that probed the three /16
network ranges in our telescope as well as the rest of the Internet
during the late March burst, only 124K IPs continued to probe spe-
cific parts of the Internet for router vulnerabilities. This seems to
indicate that the scanners used the data collected from previous
tests (as our passive monitors would not respond to 8291), or that
IdentiﬁcationPort Scan / Device ListingVulnerability ExploitationInfection ConsolidationMaintenanceMonetizationPatching2018-012018-022018-032018-042018-052018-062018-072018-082018-092018-102018-112018-12Date0250000500000750000100000012500001500000Packets received in telescopeHajime Botnet started scanningMikroTik discovered & fixed vuln.First cryptojacking infectionBasuCert PoC releasedCVE-2018-14847 publishedTenable PoC released050000100000150000200000Netflows observedFigure 6: Geographical location of the MikroTik routers compromised during the study period.
5.1.2 Localization using Public Datasets. In addition to actively
scan and probe IPs on the Internet to test whether they are running
RouterOS and are potentially exploitable, attackers could try to get
a pre-made list of device IPs to connect to potential targets directly,
for example by searching on Shodan. To determine whether the
attacker uses such services to locate vulnerable routers, we consider
the moment Censys retrieved a proxy page from a router with a
mining siteKey on port 8080 or 80, which means that at this moment
the device was compromised. If at that moment the router was not
yet listed in Shodan, the perpetrator must have found the vulnerable
router by independently scanning for it. If prior to the Censys
publication, there already existed a record in Shodan, the attacker
could have obtained knowledge from this service.
When we track this relationship for every siteKey on the date
it first appeared on the 1.4M routers, we find that 54% of the cases
a new siteKey is installed on routers that were already listed in
Shodan, whereas 29% of the new installations were derived from
independent scanning. In the rest of the cases, too few routers
were compromised with the same siteKey to significantly catego-
rize them. Figure 8 shows the percentage of unlisted routers used
by actors within the first 14 days of their activity. We clearly see
two regimes. Innovators and early adopters such as d68a7a and
hsFAjj which are shown as dashed lines (for siteKey emergence see
Figure 13) all perform their own discovery, and start off with a high
number of new, unlisted routers. This percentage drops over time,
as the compromised devices are then included in Shodan. The long
lasting campaign tD2a2P starts out with 42% unlisted routers on
its first, and kept adding unknown devices to its installed base for
the months to come. On the other hand, we find a large number of
campaigns which primarily feed off public lists to populate their
setups. One of the most profitable campaigns 6a9929 had at its peak
Figure 7: Histogram of the specificity of scans for port 8291.
additional knowledge – such as the popularity of MikroTik in spe-
cific parts of the world – is used to steer the search. In order to
determine the specificity of these scanners, we compared the traffic
distributions of the Tier 1 operator towards all autonomous sys-
tems (AS) with the traffic distribution for the anonymized scanning
source IP addresses. This relative comparison accounted for the fact
that the operator would not be part of an exact random sampling of
all worldwide traffic flows, but that due to BGP policies and specific
IXP and PoP presences certain autonomous systems would be pre-
ferred. From this relative comparison we can determine whether
sources showed specific preferences for select networks, or scanned
the Internet non-discriminantly. Figure 7 shows a summary of all
scanners as a histogram of the scanners’ deviation from the ex-
pected non-discriminatory baseline. As we can see in the graph,
there exist three basic behaviors: the bulk – which is also visible in
our telescope – targets the entire Internet unspecifically, a smaller
but significantly sized group that specializes and concentrates the
scan on a specific AS, while a small portion of adversaries scan a
large but apparently curated list of destinations.
020406080100Deviation percentage of AS scanned025005000750010000125001500017500# of scanning IP addresses
Figure 9: The original Omine infection on top, the obfus-
cated variant listed on the bottom.
Figure 10: Reinfections of compromised devices with differ-
ent keys with >500 overlapping IPs.
properties, for example they are accessed by the same person or
share infrastructure components, we can conclude that these are
examples where an actor is performing a key rotation system. The
sequence from iWDUFD to ByMzv3 to aff2ba to ef18c8 shows an
example of such a transition, which is visible as all routers in a
node leave towards the same destination as can be seen in the iden-
tical color of node and arrow. A special form of these updates also
appears in the application of obfuscation techniques. For example,
the routers infected by the siteKey 4983e3 were at some point be-
ing updated to the iframe code shown in Figure 9. The obfuscated
Javascript expression 0xbdaf(’0x0’) however decodes to 4983e3, so
here the transition is an evolution in technique rather than a pro-
gression of accounts. Account rotations however do not necessarily
occur in chains, an example being the cluster on the right, where
the routers originally mining for hsFAjj transition towards SK_LCx
and oDcuak, and where a little over 15K routers shift back and
forth between the receiving siteKeys. While the reinfection graph
only displays the largest transitions for readability, there is a lot
of change happening, especially in the long tail of the distribution.
Overall, 55% of all routers are infected with more than one key, and
15% of all MikroTik devices had 5 or more siteKeys in 2018.
5.3 Infection Consolidation
After the adversary has been able to obtain the system credentials
and activate the developer backdoor, root access is used to establish
a foothold on the device. As described in Section 3, the firewall
configuration is changed, the proxy activated, and additional files
Figure 8: Percentage of infected unlisted routers per key.
13,815 routers infected simultaneously, almost exclusively drawn
from public lists. As we will see in Section 6, the degree of inno-
vation is not a proxy for the amount of revenue these campaigns
make – innovation does not always seem to pay off. To summarize
this phase in the life cycle, there is a wide variance of MikroTik
spreading over the world, we have seen a steadily increasing inter-
est in scanning of port 8291 throughout 2018 and half of the newly
installed siteKeys are installed on a router that was already listed
in Shodan, whereas only 29% of all new installations was the result
of independent scanning by the adversary.
5.2 Vulnerability Exploitation
With the vulnerable routers identified, adversaries can trigger the
vulnerability by sending a simple payload, as discussed in Sec-
tion 3.3. While the activities of the perpetrators on the devices
cannot be inferred using our datasets, we can investigate patterns
on how adversaries infect devices, and how infected devices are
taken over.
Infections and Reinfections. From previous discussion, we
5.2.1
have seen in the NetFlow data and our telescope that a large number
of IPs scanned for port 8291, and that actors additionally used
records such as Shodan to find exploitable targets. Once a device
however appears in Shodan, it could already be infected, due to
a proxy service running on port 80 or 8080. This naturally raises
the question whether and how reinfections occur, in other words
whether actors are grabbing compromised devices from others or
are updating siteKeys on routers they already “own”.
Figure 10 depicts the transition behavior of the 1.4M routers
between siteKeys, filtered to only include edges if more than 500
devices are taken over from the original “owner” by a particular
new actor. The size of the circle is the number of routers which
transition away from this siteKey, the thickness of the arrow and
the color of a circle are the number of routers that newly infected
with a particular key. Since we can not retrieve the persona be-
hind a siteKey, we assume in this section that every siteKey is a
different persona. However, as we reveal in Section 6.2, we have
strong suspicions that this is not the case. In the figure, we see two
types of transition behaviors. First, we see siteKeys which draw
their installation base from pools of already infected routers. An
example of this is 4983e3 which relies on lists of infected devices
and then reinfects them with a new siteKey, which we could al-
ready infer for this siteKey from Figure 8. Second, we see siteKeys
on routers being replaced in a specific sequence by another account.
When the routers of different keys before and after the update share
024681012Day after initial infection0.00.10.20.30.40.50.60.7Fraction not listed router ipsd68a7ahsFAjjtD2a2P5zHUik9pFICA038aeb97d86aaff2ba4983e30xbdafd68a7ahsFAjjoDcuakSK_LCxJ3rjnvsm8UXudqorRUkMzgmXPIKZhbiBl5xzKKAvUboiKAGEiWDUHFByMzv3bFAs1SryZ1Dl48zUYBBcdFFhc5a47a5zHUik038aebc6914a8C7UoT5ROof5Out-DegreeIn-Degree50010K8f69bfaff2ba97d86af916f77ba081a2007e1b9233ef18c8c43cbe4983e32c00d59151daadf4bed268f10xbdafdownloaded to the system. We defer a discussion on the mone-
tization, the cryptomining, to the next section, and discuss the
infrastructure used to perform the scanning, logins and loading of
additional components.
5.3.1 Node to node reconnaissance. Based on Censys and Shodan
data we obtained a list of infected devices over time, and could in the
NetFlows thus trace which anonymized IP addresses would connect
to the WinBox service on vulnerable and infected routers. While
the bulk of these connections came from a variety of anonymized
IPs, 6.5% of the flows towards port 8291 were sent from infected
MikroTik routers to other MikroTik routers. We observed 948 in-
fected routers which were systematically scanning their local sub-
net for additional vulnerable routers on port 8291. While based on
NetFlows it is not clear whether these infected routers only enu-
merate vulnerable hosts or also perform the compromise itself, we
find this additional structural component noteworthy. Interestingly
this behavior was only implemented in geographic regions where
MikroTik routers seemed to be rolled out structurally by ISPs as
we observed this behavior specifically in Brazil.
Infrastructure. In August 2018, the first router infections
5.3.2
spread throughout Brazil and were under the control of a sophisti-
cated adversary. After successfully locating vulnerable MikroTik
devices, it exploited the WinBox vulnerability and injected both
a miner into the HTTP proxy page and installed a script which
would fetch new updates and commands from a staging server on
port 2008 every 30 seconds. These updates could involve changes
in miner service or a new siteKey. Using our NetFlow data we have
identified six of these staging servers in the subnet of 211.164.222.*,
which confirms the research of [37]. We have identified that these
staging servers are active from 26 July to 21 September 2018, and