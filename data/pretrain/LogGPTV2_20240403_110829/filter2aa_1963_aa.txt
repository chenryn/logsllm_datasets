### Bluehat Shanghai 2019
#### David “dwizzzle” Weston, Microsoft OS Security Group Manager
**不断增强的 Windows 安全性**

早上好，上海！

#### PC 上的 Windows
- **熟悉的桌面体验**
- **庞大的硬件生态**
- **桌面应用兼容性**
- **One Core OS**
  - 基础操作系统
  - 应用和设备平台
  - 运行时和框架

#### Xbox 上的 Windows
- **Windows 10 界面体验**
- **独特的安全模型**
- **共享的游戏体验**

#### IoT 中的 Windows
- **基础操作系统**
- **应用和设备平台**
- **运行时和框架**
- **适配不同形态设备**
- **界面体验**
- **支持不同设备场景**

**Windows 正在不断进化……**

#### 增强的安全性
- **恶意代码无法在设备上存留**
- **违反承诺的举措会被立即发现**
- **所有应用和系统组件仅具备必须的特权**
- **所有代码执行均可保证完整性**
- **用户标识无法被攻陷、嗅探或盗窃**
- **通过物理方式访问的攻击者无法修改设备上的数据或代码**

#### Windows 10 S
- **强制代码签名**
- **无需密码即可登录**
- **“Admin Less”用户帐户**
- **阻止来自互联网的脚本和宏**

与之相反：
- **以管理员身份运行**
- **执行不带签名的代码**
- **使用密码**
- **缓解措施并不总能生效**

**Windows 10 S：安装数达数百万，尚未检测到广泛传播的恶意软件**

#### 代码完整性的改进
- **CI 策略移除了大部分“代理的”二进制文件**
- **仅提供带有应用商店签名的应用（UWP 或 Centennial）**
- **支持危险操作的“远程”文件扩展已被阻止**
- **远程 Office 宏默认已被阻止**

#### 第一重代码完整性保护
- **“第一重”CI 绕过，使得远程攻击者能够触发未签名代码的初始执行**
- **10 S 侧重于防止“第一重”绕过**
- **“第二重”绕过，使得在执行完初始代码之后，可以进一步执行更多未签名代码**
- **10 S 为“第二重”绕过提供了持久的保证**

#### 漏洞利用缓解策略
- **提高被利用的成本**
- **控制流完整性**
  - 仅限签名代码
  - 只读数据
- **消除不同类型的漏洞**
  - 危险的调用目标
  - 不受保护的栈
  - 数据流破坏

#### 控制流面临的挑战
- **危险的调用目标**
- **不受保护的栈**
- **数据流破坏**

#### 改善控制流完整性
- **隆重介绍：XFG**
  - **目标**：通过高效、兼容性高的方式提供更细化的 CFI
  - **概念**：通过类型签名检查保证合法的间接跳转
  - **设计**：
    - 为每个获取地址的函数分配一个基于类型签名的标志
    - 在执行每个函数之前紧接着嵌入该标志，使其可通过函数指针访问
    - 为调用点添加标志检查：如果遇到任何标签不匹配的情况则快速退出

#### XFG 的安全性
- **C 风格的函数指针只能调用具备相同类型签名的地址获取函数**
- **调用点和调用目标具有相同数量的参数，参数与返回值类型相同**
- **C++ 虚拟方法只能调用在自己的类层次结构中具备相同名称和类型的方法**
- **无法调用错误类型的重载方法**
- **无法调用来自其他类层次结构的方法**
- **无法调用同一层次结构中类型相同但名称不同的方法**

**注意**：哈希函数的使用意味着技术上来看，有存在碰撞的可能，但对于大约 55 位哈希来说，可能性微乎其微（从实用性的角度来看尤其如此）

#### 影子栈保护
- **最初曾尝试以软件形式实现栈保护但失败了**
- **OSR 以软件形式设计的影子栈（RFG）未能通过内部的攻击研究**
- **控制流实施技术（CET）**
  - 可通过影子栈返回地址保护
  - 通过硬件协助缓解控制流劫持和 ROP
  - 在我们的威胁模型中体现出健壮性（在任意地址读写的前提下）

#### 隆重介绍：内核数据保护
- **问题**：对 Windows 内核的利用可通过损坏的数据获得特权提升
- **目前状态**：基于 Hypervisor 的代码完整性，可防止动态代码注入并强制实施签名策略
- **仅仅阻止代码还不够**，内核还包含了很多敏感数据结构
- **内核数据保护（KDP）** 使用安全内核使敏感数据无法被修改

#### 数据损坏保护
- **CVE-2016-7256 利用**：利用 Open type 字体进行权限提升
- **破坏代码完整性相关的全局变量**（来源：FuzzySec）
- **内核数据保护**：
  - 用于执行只读池分配的机制
  - 启用 VBS 后可获得只读页表项的 Hypervisor 保护

希望这些优化后的文本更加清晰、连贯和专业。如果有任何进一步的修改需求，请告诉我！