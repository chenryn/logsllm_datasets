forwarding a packet based on the contents of the routing table. 
route determination process – The process of determining which single route in the routing table to use 
for forwarding a packet. 
route cache – A table in which IPv4 stores the next-hop IPv4 addresses and interfaces for recently 
determined destination IPv4 addresses. 
router – A TCP/IP node that can forward received packets that are not addressed to itself (also called a 
gateway for IPv4). 
routing table – The set of routes used to determine the next-hop address and interface for IPv6 traffic 
that a host sends or a router forwards. 
Chapter 10 – TCP/IP End-to-End Delivery 
TCP/IP Fundamentals for Microsoft Windows  
Page: 316 
Chapter 11 – NetBIOS over TCP/IP 
TCP/IP Fundamentals for Microsoft Windows  
Page: 317 
Chapter 11 – NetBIOS over TCP/IP 
Abstract 
This chapter describes the network basic input/output system (NetBIOS) over TCP/IP and its implementation in 
Microsoft Windows operating systems. Although not required for a networking environment consisting of servers and 
clients that are based on Active Directory, NetBIOS over TCP/IP is still used by NetBIOS applications that are included 
with Windows. A network administrator must understand NetBIOS names and how they are resolved to troubleshoot 
issues with NetBIOS name resolution. 
Chapter 11 – NetBIOS over TCP/IP 
TCP/IP Fundamentals for Microsoft Windows  
Page: 318 
Chapter Objectives 
After completing this chapter, you will be able to: 
Define NetBIOS. 
Define NetBIOS names. 
Explain how computers running Windows resolve NetBIOS names. 
List and describe the different NetBIOS over TCP/IP node types. 
Explain how nodes use the Lmhosts file to resolve NetBIOS names of hosts on remote subnets. 
Configure a local or a central Lmhosts file for resolving NetBIOS names of hosts on remote subnets. 
Use the Nbtstat tool to gather NetBIOS name information. 
Chapter 11 – NetBIOS over TCP/IP 
TCP/IP Fundamentals for Microsoft Windows  
Page: 319 
NetBIOS over TCP/IP Overview 
NetBIOS was developed in the early 1980s to allow applications to communicate over a network. 
NetBIOS defines: 
A Session layer programming interface  NetBIOS is a standard application programming interface 
(API) at the Session layer of the Open Systems Interconnect (OSI) reference model so that user 
applications can utilize the services of installed network protocol stacks. An application that uses the 
NetBIOS interface API for network communication can be run on any protocol stack that supports a 
NetBIOS interface. 
A session management and data transport protocol  NetBIOS is also a protocol that functions at the 
Session and Transport layers and that provides commands and support for the following services: 
Network name registration and verification. 
Session establishment and termination. 
Reliable connection-oriented session data transfer. 
Unreliable connectionless datagram data transfer. 
Protocol and adapter monitoring and management. 
NetBIOS over TCP/IP (NetBT) sends the NetBIOS protocol over the Transmission Control Protocol 
(TCP) or the User Datagram Protocol (UDP). 
NetBT traffic includes the following: 
NetBIOS session traffic over TCP port 139 
NetBIOS name management traffic over UDP port 137 
NetBIOS datagram traffic over UDP port 138 
Figure 11-1 shows the architecture of NetBT components in the TCP/IP protocol suite. 
Chapter 11 – NetBIOS over TCP/IP 
TCP/IP Fundamentals for Microsoft Windows  
Page: 320 
Figure 11-1  NetBT in the TCP/IP protocol suite 
Requests for Comments (RFCs) 1001 and 1002 define NetBIOS operation over IPv4. NetBT is not 
defined for IPv6. NetBIOS over TCP/IP is sometimes referred to as NBT. 
Enabling NetBIOS over TCP/IP 
You can enable NetBT for computers running Windows by opening Network Connections, right-clicking 
a connection, clicking the Internet Protocol Version 4 (TCP/IPv4) or Internet Protocol (TCP/IP) 
component, clicking Properties, clicking Advanced, clicking the WINS tab, and clicking the appropriate 
option in NetBIOS setting. Figure 11-2 shows the WINS tab. 
Figure 11-2  The WINS tab for the Internet Protocol Version 4 (TCP/IPv4) component 
Chapter 11 – NetBIOS over TCP/IP 
TCP/IP Fundamentals for Microsoft Windows  
Page: 321 
For the NetBIOS setting, you can choose any of the following options: 
Default  Enables NetBT if the network connection has a static IPv4 address configuration. If the 
network connection uses the Dynamic Host Configuration Protocol (DHCP), it uses the DHCP options 
in the received DHCPOffer message to either disable NetBT or enable and configure NetBT. To disable 
NetBT using DHCP, configure the Disable NetBIOS over TCP/IP (NetBT) Microsoft vendor-specific 
option for the value of 2. This is the default setting for LAN connections. 
Enable NetBIOS over TCP/IP  Enables NetBT, regardless of the DHCP options received. This is the 
default setting for remote connections (dial-up or virtual private network). 
Disable NetBIOS over TCP/IP  Disables NetBT, regardless of the DHCP options received. 
NetBT is not required for computers running Windows unless you use NetBIOS applications on your 
network, such as the Computer Browser service. The Computer Browser service maintains the list of 
computers in the Network window and the Microsoft Windows Network window of My Network 
Places. File and printer sharing with Windows Vista, Windows XP, Windows Server 2008, and Windows 
Server 2003 can operate without the use of NetBT. 
NetBIOS Names 
A NetBIOS name is 16 bytes long and identifies a NetBIOS resource on the network. A NetBIOS name 
is either a unique (exclusive) or group (non-exclusive) name. When communicating with a specific 
process on a computer, NetBIOS applications typically use unique names. When communicating with 
multiple computers at a time, NetBIOS applications use group names. 
The File and Printer Sharing over Microsoft Networks component, also known as the Server service in 
the Services snap-in, is an example of a service that uses a NetBIOS name. When the Server service 
starts, it registers a unique NetBIOS name based on the computer name. The exact NetBIOS name 
used by the Server service is the 15-byte computer name plus a sixteenth byte of 0x20. You configure 
the computer name on the Computer Name tab of the System item in Control Panel. If the computer 
name is not 15 bytes long, Windows pads it with spaces up to 15 bytes long. Computer names longer 
than 15 bytes are truncated. 
Other network services also use the computer name to build their NetBIOS names, so the sixteenth 
byte typically identifies a specific service. Other services that use NetBIOS include the Client for 
Microsoft Networks component (also known as the Workstation service in the Services snap-in) and the 
Messenger service (not to be confused with Windows Messenger). The Workstation service, also 
known as the redirector, uses the 15-byte computer name plus a sixteenth byte of 0x00. The 
Messenger service uses the 15-byte computer name plus a sixteenth byte of 0x03. 
Figure 11-3 shows the use of the NetBIOS names of the Server, Workstation, and Messenger services 
in the NetBT architecture. 
Chapter 11 – NetBIOS over TCP/IP 
TCP/IP Fundamentals for Microsoft Windows  
Page: 322 
Figure 11-3  Examples of NetBIOS names in the NetBT architecture 
When you attempt to connect to a shared folder in Windows, NetBT attempts to resolve the NetBIOS 
name for the Server service of the specified computer. After the IPv4 address that corresponds to the 
NetBIOS name is resolved, the Workstation service on the client computer can initiate communication 
with the Server service on the file server. 
The Server, Workstation, and Messenger services and the services that rely on them—such as the 
Computer Browser, Distributed File System, and Net Logon services—register NetBIOS names. 
Windows network applications that access these services must use their corresponding NetBIOS 
names. For example, workgroup and domain names that are used by the Computer Browser service to 
collect and distribute the list of workgroups and domains are NetBIOS names. For more information 
about workgroups and domains, see “Appendix C – Computer Browser Service.” 
Common NetBIOS Names 
Table 11-1 lists and describes common NetBIOS names that Windows network services use. 
Chapter 11 – NetBIOS over TCP/IP 
TCP/IP Fundamentals for Microsoft Windows  
Page: 323 
Registered name 
Description 
ComputerName0x00 
The name registered for the Workstation service. 
ComputerName0x03 
The name registered for the Messenger service. 
ComputerName0x20 
The name registered for the Server service. 
UserName0x03 
The name of the user currently logged on to the 
computer. The user name is registered by the 
Messenger service so that the user can receive net 
send commands sent to their user name. If more than 
one user is logged on with the same user name (such 
as Administrator), only the first computer from which a 
user has logged on registers the name. 
DomainName0x1B 
The domain name registered by a domain controller 
that is running Windows Server 2008 or Windows 
Server 2003. 
Table 11-1  Common NetBIOS names 
NetBIOS Name Registration, Resolution, and Release 
All NetBT nodes use processes for name registration, name resolution, and name release to manage 
NetBIOS names on an IPv4 network. 
Name Registration 
When a NetBT host initializes itself, it registers its NetBIOS names using a NetBIOS Name Registration 
Request message. A NetBT host performs name registration by sending a broadcast message on the 
local subnet or a unicast message to a NetBIOS name server (NBNS). 
If the name being registered is a unique NetBIOS name and another host has registered that name, 
either the host that previously registered the name or the NBNS responds with a negative name 
registration response. After receiving the negative name registration response, the host typically 
displays an error message to the user. 
Name Resolution 
A NetBIOS name is a Session layer application identifier. TCP/IP uses an IPv4 address as a Network 
layer identifier of an interface. Therefore, when a NetBIOS application makes a NetBIOS 
communication request of NetBT, NetBT must associate the NetBIOS name of the destination 
application with the IPv4 address of the computer on which the application is running. The process of 
mapping a NetBIOS name to an IPv4 address is known as NetBIOS name resolution.  
When a NetBIOS application on a computer running Windows wants to communicate with another 
TCP/IP host, the application broadcasts a NetBIOS Name Query Request message on the local 
network or unicasts a NetBIOS Name Query Request message to an NBNS for resolution. In either 
case, the NetBIOS Name Query Request message contains the NetBIOS name of the destination host. 
Either the neighboring host that has registered the NetBIOS name or an NBNS responds by sending a 
positive NetBIOS Name Query Response message. If the NBNS does not have a mapping for the 
NetBIOS name, it sends a negative Name Query Response message. 
Chapter 11 – NetBIOS over TCP/IP 
TCP/IP Fundamentals for Microsoft Windows  
Page: 324 
Name Release 
Name release occurs whenever a NetBIOS application is stopped. For example, when the Workstation 
service on a host running Windows is stopped, the host requests that the NBNS no longer respond to 
queries for the Workstation service name. Additionally, the host no longer sends negative name 
registration responses when another host on the local subnet tries to register the corresponding unique 
NetBIOS name. The NetBIOS name is released and available for use by another host. 
Segmenting NetBIOS Names with the NetBIOS Scope ID 
The NetBIOS scope ID is a character string that is appended to the NetBIOS name and that isolates a 
set of NetBT nodes. Without scopes, a unique NetBIOS name must be unique across all the NetBIOS 
resources on the network. With the NetBIOS scope ID, a unique NetBIOS name must be unique only 
within a specific NetBIOS scope ID. NetBIOS resources within a scope are isolated from all NetBIOS 
resources outside the scope. The NetBIOS scope ID on two hosts must match, or the two hosts will not 
be able to communicate with each other using NetBT.  
Figure 11-4 shows an example organization that is using two NetBIOS scopes—APPS and MIS. 
Figure 11-4  Example of using NetBIOS scopes 
For this example, HOST1.APPS and HOST2.APPS are able to communicate with SERVER.APPS but 
not with HOST3.MIS, HOST4.MIS, or SERVER.MIS. 
The NetBIOS scope also allows computers to use the same 16-byte string as a unique NetBIOS name, 
provided they have different scope IDs. The NetBIOS scope becomes part of the full NetBIOS name, 
making the full NetBIOS name unique. In the example network in Figure 11-4, two servers have the 
same computer name (SERVER) but different scope IDs. Therefore, they have different full NetBIOS 
names. 
You can configure a NetBIOS scope ID through the following: 
By configuring the DHCP NetBIOS Scope ID option (option 47) (for DHCP clients) 
Chapter 11 – NetBIOS over TCP/IP 
TCP/IP Fundamentals for Microsoft Windows  
Page: 325 
By configuring the HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Netbt\ScopeID 
registry value on the local computer 
Unless you are using NetBIOS scopes to specifically isolate NetBT traffic for different sets of NetBT-
capable computers, the use of NetBIOS scopes is discouraged. 
Chapter 11 – NetBIOS over TCP/IP 
TCP/IP Fundamentals for Microsoft Windows  
Page: 326 
NetBIOS Name Resolution 
NetBIOS name resolution is the process of successfully mapping a NetBIOS name to an IPv4 address. 
TCP/IP for Windows can use any of the methods listed in Table 11-2 and 11-3 to resolve NetBIOS 
names. 
Method 
Description 
NetBIOS name cache 
A local table that is stored in random access memory 
(RAM) and that contains the NetBIOS names and their 
corresponding IPv4 addresses that the local computer 
has recently resolved. 
NBNS 
A server that complies with RFC 1001 and 1002and 
that provides name resolution of NetBIOS names. The 
Microsoft implementation of an NBNS is the Windows 
Internet Name Service (WINS). 
Local broadcast 
NetBIOS Name Query Request messages broadcast 
on the local subnet. 
Table 11-2  Standard methods of resolving NetBIOS names 
Method 
Description 
Lmhosts file 
A local text file that maps NetBIOS names to IPv4 
addresses for NetBIOS applications running on 
computers located on remote subnets. 
Local host name 
The configured host name for the computer. 
Domain Name System (DNS) resolver cache 
A local RAM-based table that contains domain name 
and IP address mappings from entries listed in the 
local HOSTS file and names attempted for resolution 
by DNS. 
DNS servers 
Servers that maintain databases of IP address-to-host 
name mappings. 
Table 11-3  Additional Microsoft-specific methods of resolving NetBIOS names 
Resolving Local NetBIOS Names Using a Broadcast 
NetBIOS names for NetBIOS applications running on hosts that are attached to a local subnet can be 
resolved using a broadcast NetBIOS Name Query Request message. The process for using broadcasts 
is the following: 
1. When a NetBIOS application must resolve a NetBIOS name to an IPv4 address, NetBT checks the 
NetBIOS name cache for the IPv4 address that corresponds to the NetBIOS name of the destination 
application. If the name has been recently resolved, a mapping for the destination host is in the 
sending host’s NetBIOS name cache, and the broadcast is not sent. The NetBIOS name cache 
reduces extraneous broadcasts sent on the local subnet.  
2. If the NetBIOS name cache does not contain the NetBIOS name, the sending host broadcasts up to 
Chapter 11 – NetBIOS over TCP/IP 
TCP/IP Fundamentals for Microsoft Windows  
Page: 327 
three NetBIOS Name Query Request messages on the local subnet. 
3. Each neighboring host on the local subnet receives each broadcast and checks its local NetBIOS 
table, which is a list of NetBIOS names registered by NetBIOS applications running on the computer, 
to see whether the host has registered the requested name. 
4. The computer that has registered the queried NetBIOS name sends a positive NetBIOS Name Query 
Response message to the node that sent the NetBIOS Name Query Request message.  
When the sending host receives the positive NetBIOS Name Query Response message, it can begin to 
communicate with the destination NetBIOS application using a NetBIOS datagram or a NetBIOS 
session. 
Limitations of Broadcasts 
Routers do not forward broadcasts. Broadcast frames remain confined to the local subnet. Therefore, 