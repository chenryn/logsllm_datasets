0
.
2
0
.
0
0
.
Top pages
Average of 5 pages
0
250
500
750
1000
1250
1500
Page size (KB)
Figure 2: Average page sizes for the top 60 websites as reported
by Alexa.
asymmetric – download bandwidth is greater than upload band-
width (as is the case, for example, with most broadband services).
Institutional connections are those where bandwidth is symmetric.
We assign residential connections to 90% of the clients. The capac-
ity distribution for client connections was selected by cross refer-
encing 2011 country of origin data for Tor clients (gathered by the
Tor Project) with average upload and download speeds for those
countries as measured by NetIndex [21]. For example, since
20% of Tor client connections originate in the United States, we
assign 20% of links the mean U.S. upload and download speeds for
2011. Both residential and institutional clients receive capacities
from this distribution, but clients designated as institutional are as-
signed symmetric connections using the download speed for both
upstream and downstream trafﬁc.
We instantiate two types of Tor users: web clients periodically
request web pages. To model a realistic workload, we determined
the sizes of the frontpages of the top 60 websites as reported by
Alexa [1] (see Figure 2). Sampling from this distribution, web
clients request pages of sizes 106KB, 150KB, 238KB, 496KB, and
992KB, each with equal probability. These values represent the
10th, 30th, 50th, 70th, and 90th percentile of web page sizes, re-
spectively. Additionally, web clients are conﬁgured to pause an
average of 11 seconds, the median “think time” between requests
as measured in a study of web browsing behavior [12], and will
take between 9 and 11 minute breaks after 15 minute browsing
In contrast, bulk clients model high-bandwidth users
sessions.
and continually download ﬁles whose sizes are chosen uniformly
at random from 1MB, 2MB, 3MB, 4MB, and 5MB. Keeping with
the percentages observed by McCoy et al. [17], we select 3% (30)
of our clients to be bulk; the remaining 870 are conﬁgured to be
web clients.
We took precautions to ensure that our physical emulation setup
did not introduce any processing or network effects. The edge and
the core machines are connected via a dedicated 1Gbps link; the
total aggregate network throughput did not exceed 1Gbps, and our
experiments are not bound by our ExperimenTor conﬁguration’s
bandwidth or CPU resources.
(cid:3)(cid:2)(cid:1)
5.1 Rate Limit Selection
The universal rate limit should be sufﬁciently large to not sig-
niﬁcantly impact the experience of web users. We can compute a
reasonable minimum rate limit by considering both the amount of
time that users are willing to wait for a web page to be retrieved, as
well as the distribution of web page sizes.
5.2 Effects of Rate Limiting
At the other extreme, the rate limit should not be so high as to
allow high-bandwidth users to consume an unfair share of the net-
work’s resources. That is, the universal rate limit should be chosen
to degrade the performance of high bandwidth users, and conse-
quently provide incentives for them to operate their own relays.
Figure 2 shows the cumulative distribution of the sizes of web
pages from the top 60 Alexa [1] web sites. Reported page sizes in-
clude embedded images and Javascript but exclude Flash and other
content that would not be included in a web page loaded through
Tor. The Figure plots both the front page web sizes as well as the
average of four additional randomly selected pages on each site.
We select our rate limits based on the expected load time of cur-
rent web pages. Using the (somewhat dated) heuristic that users tol-
erate web page load times of eight seconds or less [33], we select
a 200KBps limit, which covers all pages from the Alexa dataset.
Additionally, we also evaluate Tortoise when using a more strin-
gent 100KBps limit, which covers approximately 80% of the top
60 Alexa websites.
Figure 3 shows the effects of rate limiting at 100KBps (left) and
200KBps (right) on web and bulk clients, when no clients opt to
run relays. Web clients are largely unaffected by the rate limit:
even with the more severe 100KBps limit, the mean transfer speed
drops only 15%, from 40KBps to 34KBps. Bulk transfer clients,
on the other hand, are severely affected: even with the less severe
200KBps limit, the mean transfer speed seen by these clients drops
31%, from 70KBps to 49KBps. As we show below, if even a small
percentage of the effected clients is sufﬁciently motivated to oper-
ate relays, the overall performance and capacity of the network will
improve.
Computational overhead. Tortoise requires that each relay
maintain additional token buckets to perform the added rate lim-
iting. Consequently, Tortoise incurs a computational cost relative
to unmodiﬁed Tor. However, as shown in Figure 4, Tortoise’s com-
putational overhead is fairly modest. The Figure plots the CPU
utilization of the edge node that executes all 960 Tor instances.
Although the edge node’s CPU usage is a coarse-grained mea-
sure, comparing the processing cost when using unmodiﬁed Tor
and Tortoise provides a useful estimate of the latter’s overhead.
With unmodiﬁed Tor, the median CPU utilization on Experimen-
Tor is 24.7%; with Tortoise, the usage increases slightly to 26.4%.
5.3 Performance Improvements
Beneﬁts of adding more relays. We begin by examining the
effects of adding more relays to a Tor network. Figure 6 plots the
cumulative distribution of client bandwidths when no rate limiting
is applied and relays are added to the network. Here, we model
an idealized setting in which clients altruistically decide to become
relays. It is important to note that such clients generally contribute
less to the network than the original 15 ORs since (i) the former are
generally on slower (e.g., consumer broadband) connections than
the dedicated ORs and (ii) as clients, they also use their capacities
for their own purposes.
As expected, the more relays that are added, the greater the band-
with available to nodes on the network. In the base case with 15
ORs (1.7% of all nodes), the mean client bandwidth is 41KBps. To
(cid:2)(cid:1)(cid:1)
determine the effect of clients who also opt to become ORs, we
examine two scenarios:
in the ﬁrst case, 10% (2) of bulk trans-
fer clients and 2% (18) of web browsing clients opt to run routers,
adding an additional 20 routers to the network. In the second case,
these percentages double for an additional 40 routers on the net-
work. In the ﬁrst conﬁguration, the mean bandwidth experienced
by clients increases by 27% to 52KBps. With 40 additional relays,
the mean bandwidth grows by 66% to 68KBps.
Though the results of having client Tor instances also run as re-
lays are (unsurprisingly) positive, it is unlikely that, in practice,
so many clients will suddenly and unselﬁshly choose to become
routers. The challenge is to motivate clients to also act as relays,
despite the costs involved. Applying the universal rate limit sup-
plies such motivation, as bulk clients witness their average band-
widths decrease by 31% and 30% with respective limits of 200KBps
and 100KBps. (In contrast, web clients incur only 15% and 17%
decreases with the two rate limits.) Given the option of achieving
greater speeds by running relays, we anticipate that at least a small
fraction of bulk (and potentially web) clients will also run ORs.
We investigate the advantages of behaving as both an OP and OR
below.
Beneﬁts to clients that become relays. Operating an OR ex-
empts a client from Tortoise’s universal rate limit. As illustrated
in Figure 5, clients that choose to additionally run as an OR will
experience better bandwidth than those in the same network that
do not. Here, Tortoise utilizes a 100KBps universal rate limit; the
low and high adoption rates correspond to the scenarios described
above in which 10% (2%) and 20% (4%) of bulk (web) clients opt
to run ORs. Although all clients who run ORs experience increased
bandwidth, bulk relays gain the greatest beneﬁt from choosing to
run a relay since they are most affected by the universal rate limit.
Under a 100KBps limit, the mean bandwidth experienced by all Tor
clients who chose to run routers increased by 38% and 78% when
10% and 20% of bulk clients became routers, respectively. Most of
this improvement was realized by the bulk transfer clients.
Beneﬁts of adding more relays with rate limiting. Figure 7
examines the impact of running Tortoise on network performance.
The grey line denotes the average bandwidth seen on a network
running unmodiﬁed instances of Tor. The solid black line shows
the bandwidth of a network using Tortoise. If no clients opt to run
as a relay, adopting a 200KBps or 100KBps rate limit will lead to
decreased capacity seen by the network. However, given the moti-
vation to run as a relay (see Figure 5), we argue that at least some
small fraction of clients will decide to additionally operate as ORs.
If only 10% of bulk and 2% of web clients (2.22% of all clients)
elect to run relays, the mean bandwidth increases slightly by 3.1%
and 0.7% with 100KBps and 200KBps limits, respectively. The
addition of another 20 client relays (4.44% of all clients) produces
more signiﬁcant gains, providing 36% and 31% greater mean band-
widths under the 100KBps and 200KBps rate limits respectively,
than the unmodiﬁed network. As more clients choose to become
relays (and hence gain better performance themselves), the network
achieves greater speedups.
Handling increasing capacity. Since the “freed” capacity that
is not being used due to rate limiting may be applied to serve other
clients, a network running Tortoise will be better able to handle
additional clients than a network which uses unmodiﬁed Tor. Fig-
ure 8 depicts the change in network capacity when the sizes of both
a Tortoise network and an unmodiﬁed Tor network are increased by
20%. (Here, we conservatively assume that no additional nodes run
ORs.) The average bandwidth across the network decreases from
45KBps to 30KBps (35%) for the unmodiﬁed network, and from
50KBps to 36KBps (28%) on a network running Tortoise with a
Effects of 100KBps Rate Limit
Effects of 200KBps Rate Limit
n
o
i
t
c
a
r
f
e
v
i
t
l
a
u
m
u
C
0
.
1
8
.
0
6
.
0
4
.
0
2
.
0
0
.
0
n
o
i
t
c
a
r
f
e
v
i
t
l
a
u
m
u
C
0
.
1
8
.
0
6
.
0
4
.
0
2
.
0
0
.
0
Web clients (no rate limiting)
Web clients (rate limiting)
Bulk clients (no rate limiting)
Bulk clients (rate limiting)
Web clients (no rate limiting)
Web clients (rate limiting)
Bulk clients (no rate limiting)
Bulk clients (rate limiting)
0
50
100
150
0
50
100
150
Average bandwidth (KBps)
Average bandwidth (KBps)
Figure 3: The effects of 100KBPs (left) and 200KBps (right) universal rate limits on web and bulk clients.
e
g
a
s
U
U
P
C
e
g
a
n
e
c
r
e
P
t
Aggregate CPU Utilization
5
3
0
3
5
2
0
2
5
1
0
1
5
0
No Ratelimiting
100KBps Ratelimiting
0
50
100
150
Time (minutes)
Figure 4: Aggregate CPU usage of the entire network. The
vertical dotted line represents the approximate time at which
all nodes have joined the network.
100KBps limit. Similarly, with a 200KBps limit, Tortoise’s aver-
age bandwidth is reduced from 57KBps to 40KBps (30%) when
extra clients are added. In other words, the Tortoise-based network
is better able to tolerate a sudden and large increase in (non-relay)
clients; when the number of clients increases by 20%, the percent-
age decreases in performance for Tortoise are 20% and 14% less
than that of regular Tor when 100KBps and 200KBps rate limits
are respectively applied.
Effect of partial participation. To evaluate Tortoise’s efﬁcacy
when not all relays apply the universal rate limit, we simulated a
Tor network in which only 50% of the relays rate limit the clients.
Figure 10 shows the cumulative distribution of bandwidths when 0,
20 (“low client adoption”), and 40 (“high client adoption”) clients
opt to also run relays.
This network’s performance was similar to a network with 100%
Tortoise adoption in cases where signiﬁcant numbers of clients
chose to run routers: with 20 client routers, this network had a mean
bandwidth of 44KBps, vs. 43KBps for the 100% Tortoise network;
with 40 routers, these numbers were 54KBps and 56KBps, respec-
tively. The only case where a network with 50% Tortoise adoption
showed any signiﬁcant difference from a 100% Tortoise network
was when no clients chose to run routers, in which case the net-
work with 50% adoption exhibited a mean bandwidth of 42KBps,
while the 100% Tortoise network averaged 35KBps. While the
above data might seem to imply that a network with less than 100%
adoption of Tortoise performs better than one with full adoption, it
is important to note that a network with less than 100% adoption
is less likely to lead to clients choosing to run routers. Figure 9
illustrates the fact that in a network with 50% adoption of Tortoise,
there is less motivation to become a router simply because there is
less difference between speeds achieved by clients running relays
and those not running relays.
5.4 Summary
The above emulation results indicate that Tortoise has the po-
tential to signiﬁcantly increase Tor’s performance. As highlighted
above, the challenge of our technique is selecting a universal rate
limit that properly motivates clients to operate as relays. If no addi-
tional clients serve as relays, then applying a rate limiting trivially
slows down the network. However, our emulation results suggest
that the addition of even a few relays improves the network’s over-
all performance and capacity, even if the vast majority of clients
are subjected to rate limits. Assuming that at least a small number
of clients are sufﬁciently motivated to operate as relays, Tortoise’s
performance gains can be felt even with partial use of Tortoise rate
limits. For instance, the mean client bandwidth increased by 6.5%
over standard Tor even in the conservative case when the universal
rate limit was 100KBps, only 50% of the relays applied the rate
limit, and just 2.2% of clients opted to run relays.
6. DISCUSSION AND LIMITATIONS
Tortoise’s relay exemption policy is currently incompatible
with bridges. Tortoise may cause problems for bridges – unlisted
Tor relays that allow users to connect to the Tor network in lo-
cations where the public relays are inaccessible. Although bridges
may forward trafﬁc from multiple clients, Tortoise will subject them
(cid:2)(cid:1)(cid:2)
Clients' Benefits of Running a Relay
 (100KBps Rate Limit, Low Adoption Rate)
Clients' Benefits of Running a Relay
 (100KBps Rate Limit, High Adoption Rate)
0
.
1
8
.
0
6
.
0
4
.
0
2
.
0
n
o
i
t
c
a
r
F
e
v
i
t
a
u
m
u
C
l
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●