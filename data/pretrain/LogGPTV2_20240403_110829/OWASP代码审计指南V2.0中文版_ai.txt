通常，当用户登录到网站时，身份验证会完成一次，成功的身份验证会为用户建立一个
网络会话(请参见会话管理)。如果用户试图执行高风险功能，则可以随后请求进一步(和更强
90 
的)认证，例如，可以要求银行用户在允许转账之前输入发送到他们的注册电话号码的 6 位
数字。 
认证在公司防火墙内和防火墙外一样重要。攻击者不应该仅仅因为找到了穿过防火墙的
方法，就能够在公司内部应用程序上自由运行。此外，权限(或职责)分离意味着在帐户中工
作的人不能修改存储库中的代码，或者应用程序经理不能编辑工资单电子表格。 
3.2.3 审计什么 
查看执行身份验证功能的代码模块时，需要注意一些常见问题包括: 
⚫ 
确保登录页面仅在顶级域名系统上可用。有些网站离开登录页面有 HTTP，但使表单提
交网址 HTTPS，以便用户的用户名和密码被加密发送到服务器。然而，如果登录页面
不安全，中间人就有可能将表单提交网址修改为超文本传输协议网址，当用户输入用户
名和密码时，它们就会被明文发送到服务器。 
⚫ 
确保您的用户名/用户标识不区分大小写。许多网站使用电子邮件地址作为用户名，并
且电子邮件地址不区分大小写。无论如何，用户‘Smith’和用户‘smith’是不同的
用户是非常奇怪的，可能会导致严重的混乱。 
⚫ 
确保无效用户名或密码的失败消息不会泄露信息。如果错误消息表明用户名有效，但密
码错误，那么攻击者将知道用户名存在。如果密码是错误的，不要指出它是如何错误的。 
⚫ 
确保用户输入的每个字符都包含在密码中。 
⚫ 
不要记录无效密码。很多时候，电子邮件地址被用作用户名，这些用户会记住一些密码，
但可能会忘记他们在您的网站上使用了哪个密码。第一次他们可能使用的密码对你的站
点无效，但对该用户(由用户名标识)的许多其他站点有效。如果您记录了用户名和密码
91 
组合，并且该日志泄漏了，您站点上的这种低级别的错误可能会对许多其他站点产生负
面影响。 
⚫ 
较长的密码提供了更多的字符组合，因此攻击者更难猜测。密码的最小长度应由应用程
序强制执行。短于 10 个字符的密码被认为是弱密码。应该鼓励使用密码。有关密码长
度的更多信息，请参见 OWASP 认证备忘单。 
⚫ 
为防止暴力攻击，请实施临时帐户锁定或限速登录响应。如果用户 5 次未能提供正确
的用户名和密码，则锁定帐户 X 分钟，或者实施登录响应需要额外 10 秒钟的逻辑。不
过要小心，这可能会泄露用户名对不断尝试随机用户名的攻击者有效的事实，所以作为
一个额外的措施，考虑为无效用户名实现相同的逻辑。 
⚫ 
对于内部系统，考虑强制用户在一段时间后更改密码，并存储历史的密码(例如，哈希)，
以确保用户不会简单地重复使用他们的旧密码。 
⚫ 
应通过让用户选择包含各种类型字符的密码字符串(例如，大写和小写字母、数字、标
点符号等。理想情况下，当用户键入新密码时，应用程序会向用户指示他们的新密码符
合多少复杂性策略。有关密码复杂性的更多信息，请参见 OWASP 身份验证备忘单。 
⚫ 
应用程序通常有一种机制，在用户忘记密码的情况下，该机制为用户提供了访问其帐户
的途径。这是未经身份验证的用户调用的网站功能示例(因为他们没有提供密码)。确保
此类界面不会被滥用，如果要求密码提醒导致向注册用户发送电子邮件或短信，则不要
让密码重置功能被攻击者用来通过不断在此表单中输入用户名向用户发送垃圾邮件。有
关此功能的详细信息，请参见忘记密码备忘单。 
⚫ 
应用程序使用正确的加密技术存储密码至关重要。有关此功能的详细信息，请参见密码
存储备忘单。 
92 
审计 MVC 的时候.NET 对于确保应用程序通过安全链路传输和接收很重要。建议让所
有网页而不仅仅是登录页面使用 SSL。 
我们需要保护会话 cookies，它作为用户凭证很有用。 
在 global.asax 文 件 中 ， 我 们 可 以 查 看 RegisterGlobalFilters 方 法 。  属 性
RequireHttpsAttribute()可用于确保应用程序通过 SSL/TLS 运行，建议为 SSL/TLS 站点启
用此功能。 
对于高风险职能，例如，银行交易、用户档案更新等，就利用多因素身份验证。这也减
轻了 CSRF 和会话劫持攻击。MFA 使用多个身份验证因素来登录或处理事务: 
⚫ 
你知道的东西(账户详情或密码) 
⚫ 
你有的东西(代币或手机) 
⚫ 
你是什么(生物测定学) 
如果客户端机器处于受控环境中，请使用 SSL 客户端身份验证，也称为双向身份验证 
SSL 认证，包括浏览器和服务器在 TLS 握手过程中发送各自的 SSL 证书。这提供了更
强的身份验证，因为服务器管理员可以创建和颁发客户端证书，允许服务器只信任来自安装
了此客户端 SSL 证书的计算机的登录请求。客户端证书的安全传输很重要。 
参考 
1 public static void RegisterGlobalFilters(GlobalFilterCollection filters) { 
2 “ flters.Add(new RequireHttpsAttribute()); “ 
3 } 
93 
• https://www.owasp.org/index.php/Authentication_Cheat_Sheet 
• http://csrc.nist.gov/publications/nistpubs/800-132/nist-sp800-132.pdf 
•http://www.codeproject.com/Articles/326574/An-Introduction-to-Mutual 
-SSL-Authentication 
• https://cwe.mitre.org/data/definitions/287.html Improper Authentication 
• OWASP ASVS requirements areas for Authentication (V2) 
3.2.4 忘记密码 
概述 
如果您的网站需要用户身份验证，那么很可能需要用户名和密码来验证用户访问。然而，
随着计算机系统的复杂性增加，用户认证也增加了。因此，代码审计者需要了解本节中称为
“直接身份验证”模式的用户身份验证的优点和缺点。本节将强调当用户忘记用户 id 和/
或密码时的设计模式，以及代码审计人员在审计用户忘记时如何检索用户 id 和密码以及以
安全的方式进行检索时需要考虑的事项。 
总则 
通过(电话短信、电子邮件)通知用户，这样用户必须点击电子邮件中的链接，将他们带
到您的站点，并要求用户输入新密码。 
在允许用户更改密码之前，要求用户输入他们已经拥有的登录凭据(脸书、推特、谷歌、
微软直播、OpenID 等)来验证用户。向用户发送会议注册或忘记密码使用的通知。 
94 
发送注册电子邮件的帐户信息已更改的通知。设置适当的超时值。即，如果用户在 48
小时内没有回复电子邮件，那么用户将被冻结在系统之外，直到用户再次确认密码更改。 
⚫ 
身份和共享秘密/密码必须使用加密进行传输，以提供数据保密性。 
⚫ 
共享秘密永远不能以明文格式存储，即使只是在短时间存储在消息队列中。 
⚫ 
共享秘密必须始终以散列或加密格式存储在数据库中。 
⚫ 
存储加密共享机密的组织不需要查看或解密用户密码的能力，用户密码不得发送回用户。 
⚫ 
如果客户端必须缓存用户名和密码，以便在以后调用网络服务时显示，则需要一个安全
的缓存机制来保护用户名和密码。 
⚫ 
向用户报告无效条目时，用户名和/或密码不应被识别为无效。用户反馈/错误消息必须
将用户名和密码视为一项“用户凭据”。即，"您输入的用户名或密码不正确。 
3.2.5 验证码 
概述 
验证码(缩写为“完全自动化的公共图灵测试来区分计算机和人类”)，是一种访问控制
技术。 
验证码用于防止自动软件访问 Gmail、Hotmail 和 Yahoo 等网络邮件服务，以创建垃
圾邮件、博客、论坛和维基上的自动帖子，用于促销(商业和/或政治)或骚扰、破坏和自动
创建帐户。 
验证码被证明是有用的，它们的使用在法庭上得到支持。规避验证码被美国法院认定为
违反数字千年版权法反规避第 1201(a)(3)节和欧洲指令 2001/29/EC。 
95 
总则 
验证码的审核审核人员需要注意以下规则，以确保验证码是用强大的安全原则构建的： 
⚫ 
不允许用户在不正确的尝试后输入多次猜测。 
⚫ 
软件设计师和代码审计需要理解猜测的静态性。即，一个验证码设计展示了四张(三只
猫和一只船)图片，要求用户选择与其他图片不同的图片。自动化软件总是挑第一张图
片，成功率会有 25%。其次，根据固定的验证码图片池，攻击者可以创建一个正确答
案的数据库，然后获得 100%的访问权限。 
⚫ 
考虑使用传递给服务器的密钥，该密钥使用 HMAC(基于哈希的消息认证码)作为答案。 
基于文本的验证码应遵循以下安全设计原则： 
⚫ 
验证码长度随机化:不要使用固定长度，它给攻击者提供了太多的信息。 
⚫ 
随机化字符大小:确保攻击者不能通过使用几种字体大小/几种字体进行有根据的猜测。 
⚫ 
增加验证码随机性:增加随机性会增加攻击者的难度。 
⚫ 
不要使用复杂的字符集:使用大字符集并不能显著提高验证码方案的安全性，并可能影
响正常用户的准确性。 
⚫ 
使用反识别技术作为加强验证码安全性的手段:旋转、缩放和旋转一些字符并使用各种
字体大小将降低识别效率，并通过降低字符宽度的可预测性来提高安全性。 
⚫ 
将行保持在验证码内:行必须只跨越验证码的一些字母，这样就无法区分它是一行还是
96 
一个字符段。 
⚫ 
使用大线条:使用没有字符段宽的线条会给攻击者一个健壮的鉴别器，并使线条反分割
技术容易受到许多攻击技术的攻击。 
⚫ 
验证码确实会给必须符合美国残疾人法案(1990)的网站带来问题。代码审计者可能需要
了解网站的可访问性和安全性，以审计验证码的实施，法律要求网站是 ADA 投诉。 
参考 
⚫ 
美利坚合众国诉肯尼斯·洛森、克里斯托夫·基尔希、LOEL·史蒂文森联邦起诉书。2010
年 2 月 23 日。检索日期:2012-01-02。 
⚫ 
http://www.google.com/recaptcha/captcha 
⚫ 
http://www.ada.gov/anprm2010/web%20anprm_2010.htm 
⚫ 
验 证 码 的 不 可 访 问 性 — — 网 络 上 可 视 图 灵 测 试 的 替 代 方 案
http://www.w3.org/TR/turingtest/ 
3.2.6 带外通信 
概述 
当一个网络应用程序通过一个独立于通过用户的网络浏览器 HTTP 请求/响应的通道与
终端用户通信时，通常使用术语“带外”。常见的例子包括短信、电话、电子邮件和普通邮
件。 
97 
描述 
应用程序希望通过这些独立的通道与最终用户通信的主要原因是为了安全。用户名和密
码的组合足以进行身份验证，允许用户浏览和使用网站的非敏感部分，但是更敏感(或有风
险)的功能可能需要更强形式的身份验证。用户名和密码可能是通过受感染的计算机、社交
工程、数据库泄漏或其他攻击窃取的，这意味着网络应用程序不能过于信任网络会话，除非
是有效的用户名和密码组合实际上是预期的用户。 
敏感操作的例子包括: 
⚫ 
更改密码 
⚫ 
更改帐户详细信息，如电子邮件地址、家庭地址等 
⚫ 
通过银行应用程序转移资金 
⚫ 
提交、修改或取消订单 
在这种情况下，许多应用程序会通过浏览会话以外的渠道与您通信。当您更改帐户信息
或购买商品时，许多大型网上商店会向您发送确认电子邮件。这在攻击者拥有用户名和密码
的情况下提供保护，如果他们购买了东西，合法用户将收到一封电子邮件，并有机会取消订
单或提醒网站他们没有修改帐户。 
当使用带外技术进行身份验证时，称为双因素身份验证。这里有三种身份验证方式: 
⚫ 
你知道的事情(例如，密码、密码短语、记忆密码) 
⚫ 
你有的东西(例如，手机、现金卡、RSA 令牌) 
98 
⚫ 
你是什么(例如，虹膜扫描，指纹) 
如果一个银行网站允许用户在网上发起交易，它可以使用双重认证: 
1)用于登录的密码。 
2)通过短信向用户注册的电话发送个人识别码，然后要求用户在完成交易之前输入个人
识别码。 
这需要用户知道(密码)和拥有(电话接收个人识别码)。 
“芯片和个人识别码”银行卡将使用双因素身份验证，要求用户随身携带卡(他们有的
东西)，并在购买时输入个人识别码(他们知道的东西)。“芯片和个人识别码”卡不在个人识
别码内使用，同样，如果您没有卡，知道个人识别码也没有用。 