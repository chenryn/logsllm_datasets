poisoning” proposed in [8]) may have the same eﬀect as using an old corpus.
Let’s consider the encoded-date attack in Sect. 4.1 against a corpus with traﬃc
collected over a month (i.e. from day 0 to day -30). At 12noon of day 0, we can
assume that the allergic signature encoding the date for day 0 to appear in 20%
of the traﬃc for that day, but appears in close to 0% in the remaining 30 days
of traﬃc in the corpus. Similarly, the byte sequence that encodes the date for
day -1 will appear in 20% and 10% of traﬃc on day -1 and day 0 respectively,
and never appear for the other days. As a result, both signatures will match less
than 1% of all the traﬃc in the corpus, and can be used in a type II attack to
create a BLP of 0.15 to 0.2. Further analysis shows that the sum of the BLP at
noon from day 0 to day 4 is at most 0.36 for the 5 signatures tested in Sect. 4.1.
Thus, a corpus with over 40 days’ traﬃc will probably allow allergic signatures
for the date of day 0 to day -7 to be used to create the same level of damage as
when the type II attack is launched against a one-week-old corpus.
5 Type III Allergy Attack
A more nuanced weakness of a corpus-based defense is the diversity in normal
traﬃc, which is exploited in a type III allergy attack. We deﬁne a type III attack
as follows:
A type III allergy attack is an attack that induces the target ASG into
generating a set of signatures, such that each will have a false positive
low enough to be acceptable to the ASG, but as a whole, the set will
block a signiﬁcant portion of normal traﬃc and amount to a non-trivial
DoS against the target network.
The main diﬀerence between the type II and the type III attack is that sig-
natures generated by the former have their false positives increase signiﬁcantly
over time, while false positive rates for signatures from the latter stay at a low
level. In other words, the type III attack takes a more “brute-force” approach,
and requires more signatures than the type II attack. On the other hand, the
type III attack is much more ﬂexible, and is much easier to design.
We can also see the type III attack as a divide-and-conquer strategy; it “di-
vides” the target traﬃc into small pieces, and “conquer” each with an allergic
signature speciﬁc for that piece. With signatures speciﬁc for small pieces of traf-
ﬁc, we can guarantee that each signature will have a suﬃciently low false positive.
However, the success of this strategy depends on the following conditions:
Advanced Allergy Attacks: Does a Corpus Really Help?
247
1. The ASG must tolerate signatures that cause some minimal false positives.
2. There must be suﬃcient diversity in the normal traﬃc for the attacker to
“divide” them into small pieces, each distinguished by the signature that
matches only that piece but nothing else. In other words, if there is very
little variation among normal traﬃc, any allergic signature will have a very
high false positive, and it would be impossible to launch a type III attack.
Our literature survey shows that the ﬁrst condition should be met by any
reasonable ASG. In fact, in order for the ASG to be of any use, it must tolerate
a certain degree of false positives in the signatures. This is because the corpus
may contain anomalous traﬃc, even after all instances of known attacks have
been removed. In fact, the studies in [16] found that 0.007% of traﬃc in their
corpus matches the signature for the true invariant bytes of the worm they’ve
tested. The author of [16] also reported a similar 0.008% of anomalous traﬃc in
the innocuous pool used in [12]. In other words, if the ASG were to be eﬀective
against the worm tested in [16], it must accept signatures that match as much as
0.08% of ﬂows in the normal traﬃc corpus. For our discussions below, we assume
the ASG will accept any signature that matches less than 1% of the traﬃc in the
corpus3. Next, let us consider how the attacker can “divide” the normal traﬃc
and satisfy the second condition.
5.1 Diversity in Pages Visited
For any website of reasonable size, the BLP of a page may drop very quickly with
the number of clicks required to reach that page from the root. In other words,
pages that are only reachable after 2 or 3 clicks from the root page may well have
BLP far below 0.01, our false positive threshold. This is especially true for sites
like CNN.com where pages tend to have a large number of links (e.g. the root
page alone points to more than 100 pages). Thus, the mere size of the target site
may provide the diversity needed for a type III allergy attack; all but the most
popular pages under these sites are requested only in a very small portion of user
sessions. As a result, an allergic signature that targets requests for any particular
page is very likely to evade a corpus-based defense, and a signiﬁcant amount of
damage can be caused by a large number of such signatures, each matching
requests for diﬀerent pages. To evaluate the eﬀectiveness of this attack, we once
again experimented with the data collected about CNN.com.
We construct our type III attack against CNN.com with a very generic method
that can be applied to any other website. In particular, we search over all pages
under our target site, starting with the root page, and consider pages reachable
with fewer clicks from the root ﬁrst. For any page examined, we compute the
BLP expected if that page is blocked. If the BLP is lower than the threshold, we
mark that page as a target, otherwise, we “expand” the search from that page
(i.e. examining all pages pointed to by the current page later). For each target
page, we extract random 10-byte subsequences from the “path” part of its URL,
and use the ﬁrst one with BLP below the threshold as the allergic signature for
3 Both [8,16] use a false positive threshold of 1%.
248
S.P. Chung and A.K. Mok
BLP for type III attack exploiting the diversity in requests to CNN.com
P
L
B
 0.8
 0.75
 0.7
 0.65
 0.6
 0.55
 0.5
 0.45
 0.4
 0.35
 0.3
 0.25
50
100
150
200
250
300
324
number of allergic signatures generated
Feb 24th
Feb 25th
Feb 26th
Feb 27th
Feb 28th
Fig. 2. BLP caused by diﬀerent number of allergic signatures from the type III attack
targeting the “not-so-popular” pages under CNN.com
that page. Finally, we sort the signatures in descending order of their BLP, and
compute the total BLP resulted when diﬀerent number of these signatures are
applied. We have repeated this experiment for the ﬁve data sets collected at 9am
of 24th to 28th Feb, and the results are shown in Fig. 2.
As we can see, the ﬁrst 50 allergic signatures always create a BLP of more
than 0.25, and an additional 50 signatures will bring the BLP up to 0.6. Also
note that the algorithm presented is not optimized for ﬁnding the smallest
set of signatures that creates the maximum BLP; instead, it is only intended
as a simple proof-of-concept. Thus, it is entirely possible for a type III at-
tack to produce the same level of damage predicted in Fig. 2 with fewer
signatures.
5.2 Diversity in Search Terms
The diversity of keywords queried at diﬀerent search engines like Google.com
can also be exploited in a type III attack. We conjecture that the queries from
diﬀerent users are so diverse that even the most frequently searched keywords
are involved in a very small portion of ﬂows, and the data from Hitwise [4] seems
to support this conjecture. By collecting network data from various ISPs, Hit-
wise provides various statistics concerning the use of search terms at various
search engines. According to Hitwise, the top 10 search terms “that success-
fully drove traﬃc to websites in the Hitwise All Categories category for the 4
weeks ending February 24, 2007, based on US Internet usage” are as shown in
Table 1.
As we can see, even the most popular keyword, “myspace” accounted for
only 1.07% of all observed searches. Furthermore, the volume of searches re-
ceived drops quickly with a search term’s ranking. Even though it is not clear
how Hitwise come up with their ranking, the data above seems to suggest that
Advanced Allergy Attacks: Does a Corpus Really Help?
249
Table 1. Top 10 search terms for the 4 weeks ending 24th Feb, 2007, with the per-
centage of searches that each term accounts for
Rank Search Term
ebay
Volume
1.07%
1 myspace
0.64%
2 myspace.com
3
0.41%
4 www.myspace.com 0.35%
5
0.21%
0.18%
6 mapquest
0.18%
7 myspace layouts
0.18%
8
9
0.14%
0.14%
10 yahoo.com
youtube
craigslist
yahoo
all but the most popular search terms will appear in a far less than 1% of
traﬃc. Thus, an allergic signature targeting queries for a speciﬁc search term
will most likely have a false positive low enough to evade any corpus-based
defense.
Even though it is hard to evaluate the power of an allergic signature that
blocks out all queries for a particular search term, we argue that the damage
caused by such attacks can be non-trivial and many-folded. First of all, this
may mean direct business loss to the search engine. Let’s take Google.com as an
example. Under Google’s advertising program, Google AdWords, each advertise-
ment is associated with a set of search terms, and it only appears when a user
searches for one of those terms. Furthermore, Google only charges an advertiser
when a user clicks on his/her advertisement. As a result, a type III attack that
blocks out all queries for search terms associated with an advertisement will
make that advertisement completely non-proﬁtable for Google.
The type III attack described above will also aﬀect parties whose websites will
be listed when somebody queries on the targeted keywords. The most obvious
example victims are the advertisers on Google AdWord whose advertisements
will never reach their customers. Damages can also come in other ﬂavors. For
example, according to [18], the following search terms: “BARACK OBAMA”,
“HILLARY CLINTON” and “JOHN EWARDS” (three politicians running for
the president of the US) all accounts for less than 0.01% of all searches observed
by Hitwise between Sep 2006 and Jan 2007. In other words, it is entirely feasible
to have a type III attack that blocks out all searches for a particular candidate,
which may create non-trivial damage to his/her campaign.
5.3 Cookies Revisited
In addition to recording time, web cookies are sometimes used to distinguish
diﬀerent users/user sessions. For example, the cookies from Google.com include
a 16-digit hexadecimal value called “PREF-ID”, which uniquely identiﬁes a user.
250
S.P. Chung and A.K. Mok
Similarly, both Yahoo.com and Amazon.com include an ID for either the user
or the corresponding user session in their cookies. The uniqueness of these “ID
cookies” are introducing the diversity necessary for type III attacks into normal
traﬃc, and can be exploited as follows: suppose the target cookie can taken
values in each byte/digit, we will generate one allergic signature to match each
of the possible values taken by the ﬁrst k bytes/digits of the cookie, with k
being the smallest integer such that nk is below the false positive threshold. To
make sure that each signature only matches the beginning of the cookie value
as intended, we will include the name of the target cookie as well.
For all the “ID cookies” we have seen, their values remain the same throughout
a user session. Thus, each ﬂow in the corpus will match exactly one of the
allergic signatures. Furthermore, the values of these “ID cookies” are usually
assigned such that the portion of cookies starting with a certain byte sequence
is the same as the portion with any other preﬁx. As a result, each of the above
allergic signatures will have a false positive very close to nk, and thus will evade
the corpus-based defense. Finally, since the allergic signatures cover all possible
preﬁx of the target cookie, they will ﬁlter out almost all traﬃc to the target site.
We have experimented with the above attack by collecting 10 sets of cookies
from Google.com, with 100,000 cookies in every set. We measured the distrib-
ution of the values for the ﬁrst two bytes of the “PREF-ID” cookie, and ﬁnd
that each two-byte preﬁx of “PREF-ID” appears in 0.47% to 0.33% of cookies
in each data set. In other words, the described type III attack allows us to evade
a corpus-based defense with a threshold of far less than 1%, and virtually block
all traﬃc to Google.com with 256 signatures.
We note that the type III attacks will be much less eﬀective if a lower false
positive threshold is used. For example, if the threshold is lowered to 0.01%
(which appears the lowest possible value according to [16]), we ﬁnd that the
attack against CNN.com described in Sect. 5.1 will require more than 1000 sig-
natures to achieve a BLP of less than 0.02. The attack based on the diversity
in search terms may be less aﬀected by a lower false positive threshold, since
the ﬁgures from Hitwise seem to suggest that there are plenty of search terms
that appear in less than 0.01% of traﬃc, and a signiﬁcantly larger set of sig-
natures may be required for the attack in Sect. 5.3 to block out all traﬃc to
Google.com. However, a lower false positive threshold will also reduce the cost
of evading the ASG through innocuous pool poisoning: the attackers now need
a much smaller volume of bogus traﬃc to make a real signature against their
attack dropped by the corpus-based mechanism. In other words, the tradeoﬀ be-
tween defending against allergy attacks and innocuous pool poisoning manifests
itself once again. Finally, the (possibly) large number of signatures involved in
a type III attack is not necessarily a shortcoming. It gives the attack certain
stealthiness: it would be hard to manually remove all the allergic signatures
involved. A slow type III attack may also mean a constant inﬂux of allergic sig-
natures, each causing minor damages, which makes stopping the attack serious
nuisances.
Advanced Allergy Attacks: Does a Corpus Really Help?
251
6 Experimenting with Polygraph and Hamsa
In this section, we will present our experience in launching the attacks described
in Sect. 4.1, 5.1 and 5.3 (which target encoded dates and requests for less pop-
ular pages under CNN.com, and the identiﬁcation cookie used by Google.com
respectively) against Polygraph [12] and Hamsa [8]. We choose to experiment
with these two ASGs because they are two of the most advanced network-based
ASGs that limit their false positives with a corpus-based mechanism. Our focus
on network-based ASGs is based on the belief that they have certain practical
advantages over systems that employ host-based components. We based our ex-