我们将讨论两个此类日志记录方案：plog（由MarcusRanum在几年前编写的）和passlog
在使用passlogd之前，你应该记住一点：0.1le之前的版本存在很严重的缺陷，即使在隐
Mon May 514:22:422001baby to mama:su[821]:Authentication
上述命令行启动plog（它派生出一个守护进程），并且使其嗅探eth1网卡上采用UDP端
#./plog-ieth1
succeeded for user'anton*
---
## Page 106
6.2.5“伪”服务器或“蜜罐”
则是一个围绕这样的虚假机器构建的网络，目标是诱惑和跟踪黑客的攻击过程。通过研究
6.3在“蜜罐”中的日志记录
引攻击者进人一个陷阱，从而浪费攻击者的资源。
大大强于他开始时的猜想（另一方面，业余攻击者可能会以为syslog服务器死机，或者是管
发现没有一台服务器监听着日志，那就一定有某些“好玩”的事情可做，这个环境的安全性
络中任一台机器，IP地址甚至可以不存在。
面说明如何实现ARP欺骗：
址解析协议，将IP地址映射到MAC硬件地址）实现，因此进行一些ARP欺骗是合理的。下
文，发送服务器需要从网络中愿意接受IP连接的服务器那里得到响应。这需要通过ARP（地
两种工具都可以安装在日志收集服务器中，用来嗅探日志并立即将日志发往其他地方，或与
的漏洞利用方法也已经公开发布。
藏接口上进行嗅探也可能遭到攻击（正如我们上面所提示的)。不仅已知的漏洞，甚至连有效
下蜜罐的定义和背景。
题，但并不是详细的设置指南。
查考参考文献部分，寻找一些具有该主题信息的书籍。本章我们将提到一些蜜罐日志记录问
者有可能在入侵向其发送日志的系统之后泥足深陷。创建蜜罐的方针超出了本书的范围，请
他的程序。在服务器中你可以配置实际的日志采集，也可以不配置，但是它的真正目的是吸
理员配置错误）。
其他收集的日志文件集成。
蜜罐（honeypot）是一个虚假的目标机器，用以观察黑客的攻击。蜜罐网络（honeynet)
第二个选项是在该IP地址上设置一个成熟的蜜罐。听上去是个好主意，因为高级攻击
这类服务器有很多选择。它可以拥有一个最低安全限度的 syslog守护进程，没有任何其
这种特别的服务器并不是必需的，但是安装它是一个很好的主意。原因是，如果攻击者
关于将日志发送到不存在的服务器，需要注意一个更为重要的意见。为了发送UDP报
虽然本章最后的参考文献会提供许多关于“蜜罐”的资料，但是我们仍然要简单介绍一
上述命令必须在运行嗅探器的服务器上运行，但是命令中包含的MAC地址可以属于网
arp-s00-05-00-e5-8a-2810.10.10.10
上述命令捕获从蜜罐受害服务器发往其他系统（必须安装syslog守护进程）的所有消息。
$passlogd[...]
下面是一个被修改的passlog嗅探程序用于作者的蜜罐网络中的方式：
第6章隐蔽日志85
---
## Page 107
html）上下载。
进行改进）。我们可以从HoneynetProject的工具页面（http://www.honeynet.org/tools/index.
6.3.1
它增加了用于网络流量分析的数据结构，并允许你根据已经发生的事情采取行动。
他主机进程活动（标准应用程序和操作系统日志文件)。
对穿越该网络的所有数据包的记录。它还包括原始二进制格式的网络通信完整记录。
及由蜜罐发起的出站连接(这是最不好的预兆)。
IDS捕获。网络事务还包括互联网的入站通信和连接尝试，蜜罐网络内部机器之间的连接以
协议、端口等等。这些数据通常由蜜罐网络防火墙和网络监控工具（如流收集器）以及网络
节更多。
方面，这种环境下的控制难度更大，因为与生产环境相比，我们需要在蜜罐环境中记录的细
志记录技术来保护日志最有意义的环境，因为其他蜜罐网络基础设施也对攻击者隐藏。另一
蜜罐分为研究型和生产型；前者目标在于获取攻击者的情报和技术，后者旨在降低IT资源的
蜜罐定义为“一种安全资源，价值体现在被探测、攻击或者入侵时。”HoneynetProject又将
Spitzner是这方面的尝试——HoneynetProject（http://www.honeynet.org）的奠基人之一，他将
真实世界的攻击，研究人员希望能预测出新趋势，以此开发出更高级的防御体系。Lance
者的第一步都是结束日志记录守护进程。
上的事件也都能被记录下来。正如前面所提到的，在大部分的Unix蜜罐网络人侵中，攻击
风险并为网络基础设施提供攻击预警，还可能使攻击偏离高价值的目标。
蜜罐网络产生的最后一类日志—IDS警报，是了解蜜罐中到底发生了什么的主要方法。
主机活动记录包括攻击者活动（例如击键和攻击者对系统的影响）记录和同时发生的其
和生产网络相比，网络流量记录日志可以视为蜜罐的专有特征，因为很少有人能够承担
正如我们上面提到的，蜜罐就是一个日志被攻击、破坏和阻止的环境；也是通过隐藏日
Honeynet Project的bash shell补丁是蜜罐日志记录器的一个简单范例（由本书作者之一
该工具可以记录bash shell提示符下的击键（这是蜜罐上捕获的信息中最为重要的，因
蜜罐中的网络事务记录包含了网络第3层和第4层的数据，如源IP地址、目标IP地址、
我们要在蜜罐中记录什么呢？
首先，我们要确定即便攻击者已经破坏了系统的标准非隐藏日志记录功能，发生在蜜罐
显然，上面的所有日志都需要保护。
我们来简单地了解一下上述日志类型。
3）主机活动记录
4）IDS警报
2）网络流量记录
1）网络事务记录
蜜罐网络的隐蔽shell击键记录器
---
## Page 108
可以从上面提及的HoneynetProject工具页面获得。
最佳范例，具有隐蔽审计收集和将日志信息从源系统转移到日志收集服务器的机制。Sebek2
6.3.2
为Sebek2的隐蔽日志记录器，我们在下一节简要介绍这种记录器。
观察bash shell二进制文件也可以检测出来。为了解决这类问题，Honeynet Project提出了名
发送到未明确选择接收的机器就变得可能了。
采集。这使你可以屏蔽接收日志服务器的位置。既然UDP协议是无连接的，将日志数据包
UDP目标硬编码为一个不相关的服务器甚至另一个蜜罐。注意，这种欺骗指的不是普通的IP
攻击者没有“root”权限，它也可以直接用于攻击者所运行的 shell。
ICMP）的有效载荷，或网络隐蔽信道相关作品中讨论的无连接TCP数据传输），因此，即使
更深奥的隐蔽数据传输方法，例如Internet控制报文协议（IntermetControlMessageProtocol，
（TCP）更难于检测（例如，UDP通信不总是在netstat中显示），不需要“root”权限（不同于
适的（提醒一下，UDP还用于标准的syslog记录器）。UDP从某种程度上说比传输控制协议
身包含一个UDP发送器（通过线路发送数据包）。UDP通信对于隐蔽日志传输任务是非常合
们的击键不会在任何地方保存下来。
通常不会怀疑这个系统shell是专门用来对付他们的。他们通常禁用历史日志记录，并认为他
“客人”（攻击者）来说，它能提供的保护就是隐藏自己的存在。在蜜罐中被捕获的业余攻击者
界的用户介绍一下，bash shell是大多数Linux系统的标准命令行解释器，也是远程用户（和
程ID（11354），UNIX用户ID（0表示用户是“root”）以及执行的命令（“./dumbscan-B
欺骗（称为“源地址欺骗”），而是向不存在或没有监听的主机发送UDP数据报，并用嗅探器
许多本地用户）与系统交互的主要机制。
为它们说明了攻击者在系统上的所作所为），并从蜜罐中转移到收集服务器。为Windows世
10.11”）（试图扫描从10.11.0.0至10.11.255.255的B类IP地址，进行攻击）。
bash shell直接通过UDP协议将命令转发到远程机器上，不使用任何主机程序。bash自
因为我们讨论的是隐蔽日志记录，所以将重点放在这个工具的隐蔽性上。对于蜜罐的
这种日志记录通道的另一个保护措施是“目标欺骗”（在前面已做了描述）。如前所述
这种隐蔽日志记录器也可用以监控生产环境中的用户。
Sebek2可以收集更多的信息，包括应用程序中的击键以及键人的密码。在本章中，更令
这种日志记录机制的隐蔽性并不高，因为它很容易被蜜罐的攻击者嗅探到。而且，通过
格式中包含了命令执行的时间和日期（2004年12月22号17:19），shell的UNIX进
下面是一个bash日志的例子：
T=17:19:15-12222004.PI=11354 UI=0./dumbscan-B10.11
蜜罐网络的Sebek2案例研究
第6章隐蔽日志87
---
## Page 109
变值（IPID）或者可选（如选项）。这个非常重要的事实造成了在不破坏TCP/IP标准（从而
典概念现在几乎已经废弃。更现代的隐蔽通道实例处理使用基本TCP/IP协议及常见应用协
功能将变得非常方便。
统管理员）监测的明显益处。当审计很可能遭到信任的攻击者破坏时，信任用户监测这一项
进行这类隐藏日志记录有多种好处，包括对取证分析（存在许多证据）和信任用户（例如系
的这一边）。
我们感兴趣的是它的保护措施，它将隐蔽日志记录推向极致（当然是在“白帽-黑帽分界线”
监控的生产服务器就是两种可能的场景。
输数据（可能是日志数据）。CDP是一个用于网络设备通信的非路由协议。
具），用于通过一系列web访问序列，建立一个shell会话通道。
可能性。而且，许多更高层的协议（如HTTP）可以配置成携带数据（例如通过HTTP隧道工
丢失数据包）和使数据包表现异常（从而触发检测系统）的情况下，隐蔽地增加传送信息的
塞通知（ECN）TOS/ECN字段）、未设置（填充）、设置成随机值（如初始序列号）设置成多
议的信息传输。当然，也可以使用更底层的协议（如之前提到的CDP)。
能超出了本书的范围。我们将简单地讨论现代隐蔽通道和它们在日志记录中的应用。
6.4
审计系统机制更详细、粒度也更细。
http://www.honeynet.org/papers/sebek.pdf。
“隐蔽通道”（在来自NSARainbow序列的“LightPinkBook”中第一次正式提出）的经
另一方面，sebek的主要缺点是日志数据的容量巨大。这种日志记录方式比大部分标准
：Sebek可以用于生产环境中，高度隐蔽地监视用户和潜在人侵者的活动。在生产环境中
例如，TCP（UDP也是）和IP报头的许多字段没有定义（例如服务类型（TOS）/显式拥
从Sebek更进一步，我们就进入了隐蔽通道的领域，这是一个激动人心的领域，但是可
什么场景下会选择使用这种程度的日志记录隐身？蜜罐网络或高安全性环境中受到严密
更特别的是，有一些工具可以通过思科发现协议（CiscoDiscoveryProtocol，CDP）来传
■隐藏进程：Sebek2不修改系统中的任何程序，而是作为一个隐藏的内核模块存在。它
下面是Sebek2中的一些保护手段（2004/12）：
关于Sebek架构和使用的更多细节参见白皮书《KnowYourEnemy:Sebek》，地址为
隐蔽日志通道简述
■噢探保护：Sebek2修改内核来阻止数据包被蜜罐噢探到。因此，即使是少数试图监视
本地网络的攻击者，现在也知道自己正在被监视了。
隐藏内容：不像上面的bash shell，Sebek2用SSL加密从系统传出的所有数据。
也可以编译形式存在，通过编译嵌人到主内核代码中，提供额外的隐藏选项。
---
## Page 110
参考文献
措施（避免“隐藏安全性”）。
6.5小结
本章介绍了隐蔽的日志记录，它可以用来加强日志记录基础设施的保护，补充其他安全
本章的要点如下：
Aguidetounderstandingcovertchanneanalysisoftrustedsystems(ncsc-tg-030version-1,Light
■蜜罐是隐藏日志记录常用的环境。
■隐藏日志记录工具可用于有益的目。
KnowYourEnemy:Sebek.
HoneynetProject(2004).KnowYourEnemy.(2nded.).AWL.
Bauer,M.(2002).Stealthful sniffng,intrusiondetectionandlogging..
PinkBook")
,NationalComputerSecurity
第6章隐蔽日志89
---
## Page 111
锁饭店就会不同。但是，有一组较高级别的目标可以适用于大部分人。
后，我们将介绍准备。这涉及日志数据的准备，和处理日志分析活动的环境准备。
志分析实现的目标。规划是进入日志分析过程前的第二步，我们规划日志分析的方法。最
本章将介绍三个重要的主题：目标、规划和准备。顾名思义，日志分析目标是你希望通过日
技术和方法之前，我们必须打下一些基础，了解实际开始分析日志数据之前需要做的工作。
存的基本知识，以及一些其他的主题。现在是投身日志分析的时候了。但是在我们开始讨论
7.1概述
7.2
本章要点
hilyotee7
迄今为止，我们已经介绍了日志数据的概念、日志数据架构、集中化日志记录、日志留
根据你的特殊需要，分析的目标会有所不同。如果你所处的是一家银行机构，目标和连
■准备
■规划
■目标
目标
第7章
分析日志的目标、规划和准备
---
## Page 112
7.2.1