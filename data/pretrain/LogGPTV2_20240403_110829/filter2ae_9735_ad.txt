Ivy程序生成，与3.4.1章节的样本来自同一远控程序。在传播源放置的不同ShellCode中所连接的IP地址如表3-7所示：
表 3-7 shellcode连接c2对应列表 ![
](https://images.seebug.org/content/images/2018/09/0be85793-d085-427d-aa7f-45d1e1d6ca5c.png-w331s)
我们通过本地劫持的方式，将C2地址重定向到本地计算机，通过配置好的Poison Ivy客户端可以与样本建立连接，确定攻击者使用的Poison
Ivy版本为2.3.1，具体信息如图3-27所示：
![
](https://images.seebug.org/content/images/2018/09/f128647b-8311-4868-8d44-d130f5a7d0d2.png-w331s)
图 3-27 重定向C2成功连接分析的样本
### 4、样本关联性分析
#### 4.1 多案例横向关联
安天CERT对典型案例中的前6个案例的相关信息进行了关联分析，主要涉及文件名、互斥量、文件版本信息等，通过横向关联（参见图4-1）以及之前提到的doc文件内容、漏洞利用方式、可执行文件的相关信息，我们初步判定这些事件之间是存在关联的。
![
](https://images.seebug.org/content/images/2018/09/b46ca127-4b60-4cbc-b1f3-eb5854a90038.png-w331s)
图 4-1 多案例横向关联
##### 4.1.1 ShellCode部分（CVE-2012-0158）对比
表 4-1 ShellCode部分（CVE-2012-0158）对比
![
](https://images.seebug.org/content/images/2018/09/6614b8c5-a4ad-4fb7-9f12-2dd95fa5dbea.png-w331s)
##### 4.1.2 释放的PE文件对比
表 4-2 释放的PE文件对比
![
](https://images.seebug.org/content/images/2018/09/a9639a69-4f48-40d0-ad32-4c197a420109.png-w331s)
#### 4.2 域名关联
通过提取和整理十几个有关联样本中的域名信息（参见图4-2），我们可以很清晰地看出，所有域名均为动态域名，且服务提供商均处于境外，同时大部分域名都是通过changeip.com和no-ip.com注册的，我们认为这些域名并非单一散乱注册的，而是属于同一来源的、有组织的进行注册。
![
](https://images.seebug.org/content/images/2018/09/86a03914-7da1-4cce-9962-5ba9b05aea89.png-w331s)
图 4-2 行动涉及域名信息
#### 4.3 IP地址关联
通过提取和整理十几个有关联样本中域名的曾跳转IP和现跳转IP，我们可以很清晰地看出，在所有的IP地址中，绝大多数的IP地址都属于同一地区，并且这些IP多数来自两个互联网地址分派机构AS3462、和AS18182，每个互联网地址分派机构管理现实中的一个区域，这也同时说明了这是一组有相同来源的攻击事件。
#### 4.4 恶意代码之间关联性
为了方便呈现和理解，我们对典型案例中所有的样本、C2的关联性进行了关系梳理（参见图4-3）。
![
](https://images.seebug.org/content/images/2018/09/f524b028-4fc3-4846-9870-cf980eb9fbdc.png-w331s)
图 4-3 恶意代码之间关联图（2011-2015年活动）
通过研究发现，虽然“绿斑”组织使用了多种不同的后门程序，但是它们之间共用了C2服务器，这很有可能是为了方便管理与控制，这一点从表4-3的后门ID与上线密码也可以发现不同后门类型之间的对应关系。
![
](https://images.seebug.org/content/images/2018/09/a58d4cf5-c5d4-4cd8-85e1-4277b634680c.png-w331s)
图 4-4 不同事件/恶意载荷（PE）共用基础设施C2
通过对Poison Ivy RAT相关样本分析，我们得出其上线ID和密码。我们可以看到其中有不同的样本均采用了同样的ID和密码。
表 4-3 Poison Ivy RAT上线ID和密码
![
](https://images.seebug.org/content/images/2018/09/8c7f623d-13c7-4b43-8832-6ef7faa8873d.png-w331s)
通过对已捕获的ZXShell
RAT相关样本进行分析，我们统计出样本的上线密码和压缩包加密密码。可以看出ZXShell样本中也有很多采用了相同的密码，同时这些密码与表4-3（Poison
Ivy RAT上线ID和密码）中的密码也有一些相同或者相似，再通过域名、IP等其他信息可以认为这些样本为同一攻击组织所为。
表 4-4 ZXShell RAT上线密码和压缩配置
![
](https://images.seebug.org/content/images/2018/09/0a6cf0fd-e99c-4c2e-bba7-735bf60be635.png-w331s)
### 5、组织关联性分析
除以上样本分析中所呈现的较为直接的多起事件的关联性外，安天CERT还进行了对比分析，从代码相似性、域名使用偏好、C2的IP地址关联性及地理位置特性等方面得出了这些载荷均来自“绿斑”攻击组织的结论。
#### 5.1 代码相似性
在2011-2015的行动中，攻击组织使用了4类远程控制程序，其中主要使用ZXShell和Poison Ivy。在对于Poison
Ivy的使用中，攻击组织首先生成Poison Ivy
的ShellCode，然后对ShellCode异或加密硬编码到Loader中，在Loader投放到目标主机后解密执行ShellCode。这种手法与2017年所发现行动中的样本完全相同，且都是采用三次异或加密，样本解密算法代码对比参见图5-1。
![
](https://images.seebug.org/content/images/2018/09/25119944-8d31-4bfc-88b9-0d4f028969fd.png-w331s)
图 5-1 左图为2011-2015年行动中样本解密算法，右图为2017年行动样本解密算法
#### 5.2 域名使用偏好
在2017年发现的行动中全部使用了动态域名商（共计14个），而在2011-2015年的行动中则使用了35个动态域名商。可以发现两起行动的攻击者都偏好使用动态域名，同时本次行动中有7个动态域名商与历史行动涉及的域名商相同。
另外，在此次事件中的一个域名“geiwoaaa.xxx.com”与2013年事件中的域名“givemea.xxx.com”释义相似度较高，我们猜测很可能是同一组织注册。
#### 5.3 C2的IP地址关联性
通过对两次行动中C2的IP地址进行关联分析，我们发现在2017年行动中的样本的C2（uswebmail163.xxx.com和l63service.xxx.com）解析到同一个IP：45.77.xxx.xxx，而在2011-2015年行动中涉及的pps.xxx.com这个域名也曾指向这个IP。
![
](https://images.seebug.org/content/images/2018/09/4115e065-ea29-447a-b801-76134fa45bea.png-w331s)
图 5-2 关联到2013年行动中的C2域名
#### 5.4 地理位置特性
在2017年行动中的一个域名“geiwoaaa.xxx.com”与2011-2015年行动可能存在某种关联，因为该域名解析的IP（114.42.XXX.XXX）地理位置与早期活动涉及的地理位置相同（其他IP地址多为美国），这可能是攻击者早期测试遗留的，而这个IP与2013年行动都属于亚洲某地区电信的114.42段，在我们的监控中发现2013年行动中C2地址多为这个IP段内，这表示两起行动的攻击组织可能存在密切联系。同时该地区电信相关网站资料显示：“114.32.XXX.XXX
-114.47.XXX.XXX非固定浮动IP”，这说明该段内IP地址为动态分配IP，一定区域内在此电信运营商办理网络业务的用户都可能被分配到该IP地址，这表示可能两次行动的攻击者所在位置相近或者采用的跳板位置相近。
![
](https://images.seebug.org/content/images/2018/09/9c4594c8-9903-49ce-99eb-2dc8dec9fb3d.png-w331s)
图 5-3 指向2011-2015年行动的C2域名
### 6、小结
“绿斑”攻击组织主要针对中国政府部门和航空、军事、科研等相关的机构和人员进行网络攻击，试图窃取机密文件或数据。这是一组时间跨度非常漫长的攻击行动，目前可以确定该攻击组织的活跃时间超过7年，甚至可能达到11年以上。该攻击组织主要采用的手法是鱼叉式网络钓鱼攻击，即以邮件作为攻击前导，邮件附件使用有社工技巧的格式溢出文档或伪装过EXE可执行文件，进行定向投放，该组织对开源后门程序进行了大量改造，使其符合作业需要，并绕过主机防护软件。在该组织的攻击中，罕有使用0day攻击的情况，而反复使用陈旧漏洞，但其对漏洞免杀技巧的应用是熟练的，甚至是抢先的。在侵入主机后，通过加密和动态加载等技术手段，试图达成进入目标并在目标机器内长期潜伏而不被发现的效果。这些攻击手段看起来并无华丽复杂的攻击装备组合，但其反复地重复使用，恰恰说明这种攻击是可能达成目的的。我们在此前反复强调，APT攻击组织使用相关漏洞的攻击窗口期，如果与可能被攻击目标的未进行对应漏洞修复的攻击窗口期重叠，就不是简单的漏洞修复问题，而是深入的排查和量损、止损问题。
网络入侵相对与传统空间的各种信息窃取破坏行为，无疑是一种成本更低，隐蔽性更强、更难以追踪溯源的方式。尽管“绿斑”组织不代表APT攻击的最高水准，但其威胁依然值得高度警惕。APT的核心从来不是A（高级），而是P（持续），因为P体现的是攻击方的意图和意志。面对拥有坚定的攻击意志、对高昂攻击成本的承受力、团队体系化作业的攻击组织来说，不会有“一招鲜、吃遍天”的防御秘诀，而必须建立扎实的系统安全能力。以“绿斑”攻击组织常用的攻击入口邮件为例，不仅要做好身份认证、通讯加密等工作，附件动态检测分析，邮件收发者所使用终端的安全加固和主动防御等工作也需要深入到位。对于重要的政府、军队、科研人员，更需要在公私邮件使用上、收发公私邮件的不同场景环境安全方面都有明确的规定与要求。邮件只是众多的动机入口之一，所有信息交换的入口，所有开放服务的暴露面，都有可能成为APT攻击者在漫长窥视和守候过程中，首发命中的机会。
面对具有中高能力水平且组织严密的网空威胁行为体，重要信息系统、关键信息基础设施运营者应根据网络与信息系统的国家安全、社会安全和业务安全属性，客观判断必须能够有效对抗哪些层级的网络空间威胁，并据此驱动网络空间安全防御需求。
当前，网络安全对抗已经是大国博弈和地缘安全中的常态化对抗，网络安全工作者必须“树立正确网络安全观”，直面真实的敌情想定，建立动态综合的网络安全防御体系。并以“关口前移”对网络安全防护方法的重要要求为指引，落实安全能力的重要控制点，有效解决安全能力“结合面”和“覆盖面”的问题，将网络安全防御能力深度结合信息系统“物理和环境、网络和通信、设备和计算、应用和数据”等逻辑层次，并全面覆盖信息系统的各个组成实体和全生命周期，包括桌面终端、服务器系统、通信链路、网络设备、安全设备以及供应链、物流链、信息出入乃至人员等，避免由于存在局部的安全盲区或者安全短板而导致整个网络安全防御体系的失效。重要的是，在网络安全体系建设实施的过程中，必须在投资预算和资源配备等方面予以充分保障，以确保将“关口前移”要求落到实处，在此基础上进一步建设实现有效的态势感知体系。
在未来工作中，安天将继续根据总书记的工作要求，努力实现“全天候全方位感知”、“有效防护”和“关口前移”，在实践中，不断提升网络安全能力与信息技术的“结合面”和“覆盖面”问题。更多深入参与用户的信息系统规划建设，将安全管理与防护措施落实前移至规划与建设等系统生命周期的早期阶段，将态势感知驱动的实时防护机制融入系统运行维护过程，协助客户实现常态化的威胁发现与响应处置工作，逐步实现“防患于未然”。安天将直面敌情，不断完善能力体系，协助用户应对高级网空威胁行为体的挑战。
* * *