# OCR Output
## Page 1
跟老男孩
学Linux运维
LearnLinuxOperationwith Old Boy
Shell Programming
Shell编程实战
老男孩著
机械工业出版社
---
## Page 2
图书在版编目（CIP）数据
跟老男孩学Linux运维：Shell编程实战/老男孩著.一北京：机械工业出版社，2017.1
（Linux/Unix技术丛书）
ISBN 9787111-556077
I.图II.老III.Linux操作系统IV.TP316.85
中国版本图书馆CIP数据核字（2016）第313248号
跟老男孩学Linux运维：Shell编程实战
出版发行：机械工业出版社（北京市西城区百万生大街22号部欧编码：100037）
责任编辑：杨桥国
张梦玲
责任校对：董纪丽
印
刷：北京文昌阁彩色印刷有限责任公司
版
次：2017年1月第1版第1次印刷
本：186mm×240mm 1/16
印
张：26.25
书
号：ISBN 9787111-556077
定
价：89.00元
凡购本书，如有缺页、倒页、脱页，由本社发行部调换
客服热线：（010）8837942688361066
投编热线：（010）88379604
购书热线：(010) 683262948837964968995259
读者信箱：PI:EMAIL
版权所有·侵权必究
封底无防伪标均为盗版
本书法律顾问：北京大成律师事务所韩光/邹晓东
---
## Page 3
前言
为什么要写这本书
目前全球正处于互联网+的时代，越来越多的传统企业都在通过互联网提供产品和
服务，比如，互联网+教育、互联网+金融、互联网+电商、互联网+出租车、互联网+
保险等，可以看到，几乎所有的产品、服务都能在网上找到。面支撑互联网的幕后英雄
其实就是Linux（包括移动互联网在内），掌握Linux运维技术已经成为每一个IT技术人
员的必备技能！
互联网+的时代下企业的网站流量呈爆炸式增长，如果你是运维人员，很可能要面
对几十台、几百台、上千台甚至上万台的服务器设备，面对于企业来说，如何提高IT
运维的管理效率、降低成本也成了最大问题。要解决这个问题，必须在Linux运维工作
中，做好运维服务的标准化、规范化、流程化和自动化，而这里面的前三项其实是在为
最后一项“IT运维自动化”做铺垫。
要实现IT运维自动化就需要学会编程语言，目前Linux系统下最流行的运维自动
化语言就是Shell和Python（Python 相关图书，作者正在写作中）。在这两者之中，Shell
又几乎是所有IT企业都必须使用的运维自动化编程语言，特别是在运维工作中的服务
监控、业务快速部署、服务启动停止、数据备份及处理、日志分析等环节里，Shell必
不可少。当然Python也是一门很好的自动化编程语言，它和Shell是互补的，Shell更适
合系统底层，而Python则更适合处理复杂的业务逻辑，以及开发复杂的运维软件工具，
实现通过Web访问等。
在长期的运维工作以及深度教学中，老男孩发现很多Linux入门人员很害怕Shell
编程，觉得Shell不好掌握，甚至是已经工作的企业运维人员对Shell编程也是一知半
---
## Page 4
解，不能熟练运用。而市面上的Shell图书大多如出一，理论多，实战少。因此在众
多学员和网发的关注和提议下，老男孩决定写一本比较与众不同的偏重实战的Shell编
程书籍，相信本书一定会让众多读者受益，提升个人在企业工作中的效率，达到加薪升
职的目的。
本书是老男孩Linux运维实战系列的第二本书，第一本是《跟老男孩学习Linux运
维：Web集群实践》（已由机械工业出版社出版），第三本是《跟老男孩学习Linux运维：
三剑客命令实战（预计书名），此书将在几个月后和大家见面。更多Linux运维实战系列
的图书在持续写作中，敬请期待。
读者对象
口热衷于IT运维自动化的人员
口Linux系统管理员和运维工程师
口互联网网站开发及数据库管理人员
口网络管理员和项目实施工程师
口Linux相关售前售后技术工程师
口开设Linux相关课程的大中专院校
口对Linux及Shell编程感兴趣的人员
如何阅读本书
本书是一本较完整的Shell编程实战型图书，并非大而全，但处处可以体现实战二
字，大多内容取于企业实战，并结合老男孩十几年的运维工作和教学工作进行了梳理。
本书从脉络上可分为五大部分：
第一部分为Shell编程基础篇（第1章~第4章），着重介绍新手如何学好Shell编程，
涉及的内容包括Shell编程的入门介绍、基础知识、运行原理、编程语法、编程习惯、变
量知识以及变量的深入实践。读者学完此部分，将会具备一个学好Shell编程的坚实基础。
第二部分为初中级的实战知识和技能篇（第5章～第8章），着重讲解变量的多种数
值运算、条件测试与比较、if条件判断语句、Shell函数等相关的知识，并给出了企业实
战技巧和案例。本部分是学好Shell编程的重中之重，读者必须掌握。
---
## Page 5
第三部分为Shell中高级实战知识和技能篇（第9章~第13章），着重讲解case条
件语句、while循环和until型循环、for循环和select循环、条件与循环控制及状态返回
值、Shell数组等知识，以及相应的实战技巧和案例。本部分同样是学好Shell编程的重
中之重，读者必须掌握。
第四部分为高效Shell编程必备知识篇（第14章~第16章），着重讲解Shell脚本
开发规范与编码习惯、Shell脚本的调试知识和技巧、Shell脚本开发环境的配置调整和
优化等。
第五部分为Shell特殊应用及企业面试、实战案例篇（第17章～第19章），着重讲
解Linux信号及trap命令的企业应用实践、Expect自动化交互式程序的应用实践，以及
能体现全书所讲技术的面试题和企业实战案例，让真正的Shel1全目动化运维成为可能
最后一章补充讲解了大家易感困惑的子Shell知识及应用实践内容。
勘误和支持
由于作者所授的培训课程排期很紧，课程较多，全书内容基本上都是利用早晨和
夜里的时间完成写作的。限于作者的水平和能力，加之编写的时间仓促，书中难免有
疏漏和不当之处，息请读者批评指正。你可以将书中的错误发布在专门为本书准备的
博客地址评论处（http://oldboy.blog.51cto.com/2561410/1865956或微博http:/weibo.com/
oldboy8）。同时不管你遇到何种问题，都可以加入我为本书提供的QQ交流群204041129
（验证信息：Shell书籍），我将尽力为你提供最满意的解答。书中所需的工具及源文件
也将发布在的博客网站上（书中大部分章节结尾都给出了相关网址及二维码），我也会
将相应功能的更新及时发布出来。如果你有更多的宝贵意见，也欢迎发送邮件至邮箱
PI:EMAIL，很期待能够听到你们的真挚反馈。
致谢
感谢犹金毅、何清等为本书贡献第20章的重要底稿内容及对本书的写作给予的支持。
感谢孔令飞为本书第19章贡献有趣的girlLove案例内容及对本书的写作给予的支持。
感谢老男孩IT教育的每一位在校学员，是你们自觉努力的学习，使得我有较多的
时间持续写作，特别是运维30-31期150位学员参与了本书的校稿。感谢你们对老男孩
---
## Page 6
老师的支持
感谢老男孩IT教育里每一个班级的助教、班主任、班长及班干部，感谢你们替我
分担老男孩IT教育众多学员的答疑、辅导、批改作业及班级管理工作。
感谢我的同事——老男孩教育Python学院的Alex老师、武老师，云计算与自动化
架构班的赵班长老师，Linux+Python高薪运维班的李泳谊、张耀等老师，以及其他未提
及名字的众多老师，正是你们辛勤努力的工作，让我得以有时间完成此书。
一如既往地感谢中网志腾的郭威总经理和数码创天的王斐总经理及梁露女士，感谢
你们提供优质的DELL服务器资源，使得本书得以高效顺利地完成！
感谢森华易腾的陆锦云女士及其同事，感谢你们提供的优质IDC机房带宽支持，使
得本书得以顺利完成！
感谢机械工业出版社华章公司的编辑杨绣国，感谢你的支持、包容和鼓励，正是你
的鼓励和帮助引导我顺利完成全部书稿。
感谢没有提及名字的所有学生、网友以及关注老男孩的每一位友人、朋友。
最后要感谢我的父母、家人，正是你们的支持和体谅，让我有无限信心和力量去写
作，并最终完成此书！
谨以此书，献给支持老男孩IT教育的每一位朋友、学员及众多热爱Linux运维技
术的朋友。
老男孩老师
北京，2016年11月
---
## Page 7
目录
前言
第1章如何才能学好Shell编程/1
1.1为什么要学习Shell编程/1
1.2学好Shell编程所需的基础知识/1
1.3如何才能学好Shell编程之“老鸟”经验谈/3
1.4学完本书后可以达到何种Shell编程高度/5
第2章Shel脚本初步入门/6
2.1什么是Shell/6
2.2什么是Shell脚本/7
2.3Shell脚本在Linux运维工作中的地位/8
2.4脚本语言的种类/9
2.4.1Shell脚本语言的种类/9
2.4.2其他常用的脚本语官种类/10
2.4.3Shell脚本语言的优劳/11
2.5常用操作系统默认的Shell/11
2.6Shell脚本的建立和执行/12
---
## Page 8
IILA
2.6.1Shell脚本的建立/12
2.6.2Shell脚本的执行/15
2.6.3Shell脚本开发的基本规范及习惯/19
第3章Shell变量的核心基础知识与实践/22
3.1什么是Shell变量/22
3.2环境变量/23
3.2.1自定义环境变量/26
3.2.2显示与取消环境变量/28
3.2.3环境变量初始化与对应文件的生效顺序/30
3.3普通变量/31
3.3.1定义本地变量/31
3.3.2变量定义及变量输出说明/35
3.4变量定义技巧总结/40
第4章Shell变量知识进阶与实践/41
4.1Shell中特殊且重要的变量/41
4.1.1Shell中的特殊位置参数变量/41
4.1.2Shell进程中的特殊状态变量/47
4.2bashShell内置变量命令/52
4.3Shell变量子串知识及实践/55
4.3.1Shell变量子串介绍/55
4.3.2Shell变量子串的实践/56
4.3.3变量子串的生产场景应用案例/59
4.4Shell特殊扩展变量的知识与实践/60
4.4.1Shell特殊扩展变量介绍/60
4.4.2Shell特殊扩展变量的实践/61
---
## Page 9
4.4.3Shell特殊扩展变量的生产场景应用案例/63
第5章变量的数值计算实践/65
5.1算术运算符/65
5.2双小括号“（0）数值运算命令/66
5.2.1双小括号“（0）”数值运算的基础语法/66
5.2.2双小括号“（0)”数值运算实践/66
5.3let运算命令的用法/73
5.4expr命令的用法/75
5.4.1expr命令的基本用法示例/75
5.4.2expr的全业级实战案例详解/76
5.5bc命令的用法/81
5.6awk实现计算/83
5.7declare（同typeset）命令的用法/83
5.8$符号的运算示例/83
5.9基于Shell变量输入read命令的运算实践/84
5.9.1read命令基础/84
5.9.2以read命令读入及传参的综合企业案例/87
第6章Shell脚本的条件测试与比较/92
6.1Shell脚本的条件测试/92
6.1.1条件测试方法综述/92
6.1.2test条件测试的简单语法及示例/93
6.1.3[（中括号）条件测试语法及示例/94
6.1.4[]条件测试语法及示例/95
---
## Page 10
6.2文件测试表达式/97
6.2.1文件测试表达式的用法/97
6.2.2文件测试表达式举例/97
6.2.3特殊条件测试表达式案例/101
6.3字符串测试表达式/102
6.3.1字符串测试操作符/102
6.3.2字符串测试生产案例/104
6.4整数二元比较操作符/105
6.4.1整数二元比较操作符介绍/105
6.4.2整数变量测试实践示例/107
6.5逻辑操作符/108
6.5.1逻辑操作介组/108
6.5.2逻辑操作实践示例/110
6.5.3逻辑操作符企业案例/112
6.6测试表达式test、□、[]、（O）的区别总结/120
第7章if条件语句的知识与实践/121
7.1if条件语句/121
7.1.1if条件语句的语法/121
7.1.2if条件语句多种条件表达式语法/125
7.1.3单分支if条件语句实践/126
7.1.4if条件语句的深入实践/130
7.2f条件语句企业案例精讲/132
7.2.1监控Web和数据库的企业案例/132
7.2.2比较大小的经典拓展案例/142
7.2.3判新字符串是否为数字的多种思路/143
7.2.4判断字符串长度是否为0的多种思路/145
---
## Page 11
A
7.2.5更多的生产场景实战案例/145
第8章Shell函数的知识与实践/151
8.1Shell函数的概念与作用介绍/151
8.2Shell函数的语法/152
8.3Shell函数的执行/152
8.4Shell函数的基础实践/153
8.5利用Shell函数开发企业级URL检测脚本/155
8.6利用Shell函数开发一键优化系统脚本/158
8.7利用Shell函数开发rsync服务启动脚本/166
第9章case条件语句的应用实践/169
9.1case条件语句的语法/169
9.2case条件语句实践/171
9.3实践：给输出的字符串加颜色/176
9.3.1给输出的字符串加颜色的基础知识/176
9.3.2结合case 语句给输出的字符串加颜色/177
9.3.3给输出的字符串加背景颜色/180
9.4case语句企业级生产案例/181
9.5case条件语句的Linux系统脚本范例/187
9.6本章小结/191
第10章while循环和until循环的应用实践/192
10.1当型和直到型循环语法/192
---
## Page 12
10.1.1while 环语句/192
10.1.2until 循环语句 / 193
10.2当型和直到型循环的基本范例/194
10.3让Shell脚本在后台运行的知识/195
10.4企业生产实战：while循环语句实践/206
10.5while循环按行读文件的方式总结/210
10.6企业级生产高级实战案例/211
10.7本章小结/215
第11章for和select循环语句的应用实践/217
11.1for循环语法结构/217
11.2for循环语句的基础实践/219
11.3for循环语句的企业级案例/222
11.4for循环语句的企业高级实战案例/230
11.5Linux系统产生随机数的6种方法/239
11.6select循环语句介绍及语法/241
11.7select循环语句案例/242
第12章循环控制及状态返回值的应用实践/249
12.1break、continue、exit、retun 的区别和对比/249
12.2break、continue、exit功能执行流程图/249
12.3break、continue、exit、retum 命令的基础示例/251
---