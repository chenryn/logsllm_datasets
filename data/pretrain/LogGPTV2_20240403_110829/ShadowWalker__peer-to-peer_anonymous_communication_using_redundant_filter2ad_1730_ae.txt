Simulation l=2-4
 0.05
Fraction of compromised nodes
 0.1
 0.15
 0.2
Figure 12: Churn Distributions
Figure 14: Anonymity
varying values of r. For f = 0.1, r = 2, the probability of a
successful lookup is 0.99. Even when we increase the value
of f to f = 0.2, the lookup is still successful with prob-
ability 0.95. The lookup security improves exponentially
with increasing r, because the chance that a node and all
its shadows are malicious falls exponentially in r. Thus for
f = 0.2 and r = 3, the lookup succeeds with probability
0.99. Note that for small values of r, the lookup security
can also be improved by performing redundant versions of
the above lookup.
5.4 Anonymity
Finally, we present simulation results for the anonymity
provided by ShadowWalker. Using simulations, we have per-
formed a whole system evaluation of ShadowWalker to check
for any hidden correlations not captured by our analytic
model. Our simulator also captures real world behavior like
the eﬀect of irregular topologies, which is not considered in
our model. Figure 14 depicts the anonymity provided by
ShadowWalker for l = 4 and l = 2 − 4. We can see that our
simulation and analytic results closely match.
6. RELATED WORK
Danezis and Clayton [9] studied attacks on peer discovery
and route setup in anonymous peer-to-peer networks. They
show that if the attacker learns the subset of nodes known
to the initiator, its routes can be ﬁngerprinted unless the
initiator knows about a substantial fraction of the network.
Danezis and Syverson [13] extend this work to observe that
an attacker who learns that certain nodes are unknown to
the initiator can carry out attacks as well and separate traf-
ﬁc going through a relay node. Both these attacks assume
a global passive adversary, but are similar in spirit to the
restricted topology attack.
Another attack relevant to P2P systems is the circuit-
clogging attack [1, 31], as McLahlan and Hopper [26] ob-
served that, in P2P systems, this attack can reveal the true
initiator. They proposed a stochastic fair queueing mech-
anism to mitigate the attack. We note that the circuit
clogging attack is particularly eﬀective against a restricted
route topology, since during traceback of the random walk,
there are only d possibilities at each step. Our extension
of using only the last two hops of an l hop random walk
for anonymous communication makes the traceback signiﬁ-
cantly harder for the adversary, since it is now necessary to
measure dl−2 hosts.
Several important attacks consider the degradation of ano-
Figure 13: Lookup Security
Figure 11 shows the eﬀect of churn on the reliability of
our circuit construction protocol. Let us ﬁrst consider the
exponential distribution for node uptimes. We can see that
increasing path lengths increases the probability of failure.
This is because there is an higher chance of a node and its
shadows having an inconsistent view of the network. For
a path length l = 6, the probability of failure is about
0.05. Next, observe that the probability of failure increases
if we model node churn as a Pareto distribution. Moreover,
smaller values of the exponent a lead to higher probabili-
ties of failure. To get some intuition for this, observe that
Pareto distributions with smaller exponents a have a longer
’tail’ in the CDF, as depicted by Figure 12. This results in
a larger number of node arrivals and node departures (even
though the mean node uptimes are the same), leading to an
decrease in reliability of circuit construction.
We note that reliability of circuit construction can be in-
creased by being more aggressive in topology maintenance
(i.e., reducing the time period t for refreshing ﬁngers and
signing state). Figure 11 depicts this tradeoﬀ between band-
width use and reliability of circuit construction. We can see
that for exponential distribution of node uptimes, by reduc-
ing the time period from t = 1 seconds to t = 0.5 seconds,
the probability of failure has been approximately halved.
5.3 Secure Lookup
A lookup is successful if there is at least a single honest
node in each step of the lookup. For a lookup of path length
l, the probability that a lookup succeeds can be modeled as:
P (secure lookup) =`1 − f r+1´l
Figure 13 plots of probability of a successful lookup for
170nymity with time. The predecessor attack, originally pro-
posed by Reiter and Rubin [37], has been analyzed in detail
by Wright et al. [50, 51]. As applied to our work, the at-
tack notes that eventually a low-anonymity circuit will be
constructed. Guard nodes [51] are a defense against prede-
cessor attacks that is used in the current version of Tor [34].
However, the use of guard nodes in P2P systems needs more
study; a straightforward implementation would allow attack-
ers to quickly arrive at an eﬀective anonymity set size of d.
Intersection attacks [2,36] work by noting which nodes are
active at the time a message is received. These attacks are
a particular concern for P2P systems due to the highly dy-
namic participation of most nodes [52]. The best approaches
for combating these attacks are to reduce the perspective on
the network that is given to the attackers [21]. However,
even with the best defenses, a large fraction of nodes will
be able to achieve a near-global view. Our redundant topol-
ogy exacerbates the problem by increasing the eﬀective node
degree. Whether a network that is resilient to intersection
attacks can achieve similar levels of anonymity to our design
remains an open question.
A variant of intersection attack is applicable on our pro-
tocol, where instead of noting the set of active nodes, the
adversary can use the probabilistic information about the
initiator using the restricted topology attack. This attack
would work much faster as compared to the traditional in-
tersection attack. Due to lack of space, we have omitted a
complete analysis of this attack. Our results indicate that
the de Bruijn topology is able to eﬀectively resist this attack.
7. CONCLUDING REMARKS
We proposed ShadowWalker: a new design for low-latency
P2P anonymous communication. ShadowWalker is able to
eﬀectively defend against common attacks on peer-to-peer
systems and achieve levels of anonymity superior to the state
of the art in P2P anonymous communication. In particu-
lar, when 20% of all nodes are compromised, ShadowWalker
provides 4.5 bits more entropy than Salsa. Moreover, the
probability of end to end timing analysis in this case is less
than 5%, which is close to the ideal scenario as in Tor, where
the probability of end to end timing analysis is 4%.
Our system presents several tradeoﬀs between anonymity
and performance overhead. We have demonstrated points
along these tradeoﬀs that have manageable computation and
communication overheads while providing strong anonymity
guarantees. ShadowWalker is also able to handle moderate
churn in the network. As such, it presents a promising new
direction for P2P anonymous communication.
We note that our redundant structured topology design
has beneﬁts that may extend beyond anonymity systems,
which we shall study in future work. We shall also extend
our design to incorporate the issues of heterogeneous node
bandwidth and exit policies.
Acknowledgments
We are very grateful to Matthew Wright, Nick Mathewson
and the anonymous reviewers for their invaluable feedback
on the draft manuscript. We would also like to thank George
Danezis, Paul Syverson and Steven Murdoch for helpful dis-
cussions about the research. This research was supported in
part by NSF grant CNS–0627671.
8. REFERENCES
[1] A. Back, U. M¨oller, and A. Stiglic. Traﬃc analysis
attacks and trade-oﬀs in anonymity providing systems.
In Proceedings of the IH, 2001.
[2] O. Berthold, H. Federrath, and M. K¨ohntopp. Project
anonymity and unobservability in the Internet. In
Proceedings of CFP, 2000.
[3] R. Bhagwan, S. Savage, and G. Voelker.
Understanding availability. Proceedings of IPTPS,
pages 256–267, 2003.
[4] N. Borisov. Anonymous routing in structured
peer-to-peer overlays. PhD thesis, University of
California at Berkeley, Berkeley, CA, USA, 2005.
[5] N. Borisov, G. Danezis, P. Mittal, and P. Tabriz.
Denial of service or denial of security? How attacks on
reliability can compromise anonymity. In Proceedings
of CCS, October 2007.
[6] M. Castro, P. Druschel, A. Ganesh, A. Rowstron, and
D. S. Wallach. Secure routing for structured
peer-to-peer overlay networks. In Proceedings of OSDI,
December 2002.
[7] D. Daly, D. D. Deavours, J. M. Doyle, P. G. Webster,
and W. H. Sanders. M¨obius: An extensible tool for
performance and dependability modeling. In B. R.
Haverkort, H. C. Bohnenkamp, and C. U. Smith,
editors, Computer Performance Evaluation: Modelling
Techniques and Tools, volume 1786, pages 332–336,
Schaumburg, IL, Mar. 2000. Springer.
[8] G. Danezis. Mix-networks with restricted routes. In
R. Dingledine, editor, Proceedings of PET, pages 1–17.
Springer-Verlag, LNCS 2760, March 2003.
[9] G. Danezis and R. Clayton. Route Fingerprinting in
Anonymous Communications. Proceedings of the Sixth
IEEE International Conference on Peer-to-Peer
Computing, pages 69–72, 2006.
[10] G. Danezis, R. Dingledine, and N. Mathewson.
Mixminion: Design of a Type III Anonymous
Remailer Protocol. In Proceedings of S & P, pages
2–15, May 2003.
[11] G. Danezis, C. Lesniewski-Laas, M. F. Kaashoek, and
R. J. Anderson. Sybil-resistant dht routing. In
Proceedings of ESORICS, pages 305–318, 2005.
[12] G. Danezis and P. Mittal. Sybilinfer: Detecting sybil
nodes using social networks. In Proceedings of NDSS,
2009.
[13] G. Danezis and P. Syverson. Bridging and
ﬁngerprinting: Epistemic attacks on route selection. In
Proceedings of PET, Leuven, Belgium, July 2008.
[14] N. de Bruijn. A combinatorial problem. Koninklijke
Nederlandse Akademie van Wetenschappen, 49, 1946.
[15] C. Diaz, S. Seys, J. Claessens, and B. Preneel.
Towards measuring anonymity. In R. Dingledine and
P. Syverson, editors, Proceedings of PET, San Diego,
CA, April 2002. Springer-Verlag, LNCS 2482.
[16] R. Dingledine, N. Mathewson, and P. Syverson. Tor:
The second-generation onion router. In Proceedings of
USENIX Security Symposium, August 2004.
[17] J. Douceur. The Sybil Attack. In Proceedings of
IPTPS, March 2002.
[18] M. J. Freedman and R. Morris. Tarzan: A
peer-to-peer anonymizing network layer. In
Proceedings of CCS, Washington, DC, November 2002.
171[19] D. Goodin. Tor at heart of embassy passwords leak.
The Register, September 10 2007.
[20] K. P. Gummadi, S. Saroiu, and S. D. Gribble. King:
estimating latency between arbitrary internet end
hosts. SIGCOMM CCR., 32(3):11–11, 2002.
[21] S. Hazel and B. Wiley. Achord: A variant of the
Chord lookup service for use in censorship resistant
peer-to-peer publishing systems. In Proceedings of
IPTPS, Cambridge, MA, Mar. 2002.
[22] A. Kapadia and N. Triandopoulos. Halo:
High-assurance locate for distributed hash tables. In
Proceedings of NDSS, pages 61–79, February 2008.
[23] F. Lesueur, L. Me, and V. V. T. Tong. A sybilproof
distributed identity management for p2p networks. In
Computers and Communications, 2008. ISCC 2008.
IEEE Symposium on, pages 246–253, 2008.
[24] B. N. Levine, M. K. Reiter, C. Wang, and M. K.
Wright. Timing attacks in low-latency mix-based
systems. In A. Juels, editor, Proceedings of FC, pages
251–265. Springer-Verlag, LNCS 3110, February 2004.
[25] K. Loesing. Measuring the Tor network: Evaluation of
client requests to directories. https://git.
torproject.org/checkout/metrics/master/report/
dirreq/directory-requests-2009-06-25.pdf, 2009.
[26] J. McLachlan and N. Hopper. Don’t clog the queue:
Circuit clogging and mitigation in P2P anonymity
schemes. In Proceedings of FC, January 2008.
[27] R. Merkle. Protocols for public key cryptosystems. In
Proceedings of S & P, pages 122–133, 1980.
[28] A. Mislove, G. Oberoi, A. Post, C. Reis, P. Druschel,
and D. S. Wallach. AP3: Cooperative, decentralized
anonymous communication. In Proceedings of the
ACM SIGOPS European Workshop, 2004.
[29] P. Mittal and N. Borisov. Information leaks in
structured peer-to-peer anonymous communication. In
Proceedings of CCS, October 2008.
[30] U. M¨oller, L. Cottrell, P. Palfrader, and L. Sassaman.
Mixmaster Protocol — Version 2. IETF Internet
Draft, July 2003.
[31] S. J. Murdoch and G. Danezis. Low-cost traﬃc
analysis of Tor. In Proceedings of S & P, 2005.
[32] A. Nambiar and M. Wright. The Salsa simulator:
http://ranger.uta.edu/ mwright/code/salsa-sims.zip.
[33] A. Nambiar and M. Wright. Salsa: a structured
approach to large-scale anonymity. In Proceedings of
CCS, pages 17–26, New York, NY, USA, 2006. ACM.
[34] L. Øverlier and P. Syverson. Locating hidden servers.
In Proceedings of S & P. IEEE CS, May 2006.
[35] T. T. Project. Torstatus–tor network status.
http://torstatus.kgprog.com/.
[36] J.-F. Raymond. Traﬃc Analysis: Protocols, Attacks,
Design Issues, and Open Problems. In H. Federrath,
editor, Proceedings of Designing Privacy Enhancing
Technologies: Workshop on Design Issues in
Anonymity and Unobservability, pages 10–29.
Springer-Verlag, LNCS 2009, July 2000.
[37] M. Reiter and A. Rubin. Crowds: Anonymity for web
transactions. ACM TISSEC, 1(1), June 1998.
[38] M. Rennhard and B. Plattner. Introducing MorphMix:
Peer-to-Peer based Anonymous Internet Usage with
Collusion Detection. In Proceedings of WPES,
Washington, DC, USA, November 2002.
[39] A. Rowstron and P. Druschel. Pastry: Scalable,
distributed object location and routing for large-scale
peer-to-peer systems. In Middleware, pages 329–350,
November 2001.
[40] S. Saroiu, P. Gummadi, and S. Gribble. A
measurement study of peer-to-peer ﬁle sharing
systems. In Multimedia Computing and Networking,
2002.
[41] A. Serjantov and G. Danezis. Towards an information
theoretic metric for anonymity. In Proceedings of PET,
2002.
[42] V. Shmatikov and M.-H. Wang. Timing analysis in
low-latency mix networks: Attacks and defenses. In
Proceedings of ESORICS, September 2006.
[43] E. Sit and R. Morris. Security considerations for
peer-to-peer distributed hash tables. In IPTPS, pages
261–269, London, UK, 2002. Springer-Verlag.
[44] I. Stoica, R. Morris, D. Liben-Nowell, D. R. Karger,
M. F. Kaashoek, F. Dabek, and H. Balakrishnan.
Chord: a scalable peer-to-peer lookup protocol for
internet applications. IEEE/ACM Trans. Netw.,
11(1):17–32, 2003.
[45] P. Syverson, G. Tsudik, M. Reed, and C. Landwehr.
Towards an analysis of onion routing security. In
H. Federrath, editor, Proceedings of Designing Privacy
Enhancing Technologies: Workshop on Design Issues
in Anonymity and Unobservability, pages 96–114.
Springer-Verlag, LNCS 2009, July 2000.
[46] P. F. Syverson, D. M. Goldschlag, and M. G. Reed.
Anonymous connections and onion routing. Security &
Privacy, IEEE, 4-7:44–54, 1997.
[47] P. Tabriz and N. Borisov. Breaking the collusion
detection mechanism of MorphMix. In G. Danezis and
P. Golle, editors, Proceedings of PET, pages 368–384,
Cambridge, UK, June 2006. Springer.
[48] D. Wallach. A survey of peer-to-peer security issues.
In International Symposium on Software Security,
Tokyo, Japan, 2002.
[49] C. Williams. Bt admits misleading customers over
Phorm experiments. The Register, March 17 2008.
[50] M. Wright, M. Adler, B. N. Levine, and C. Shields. An
analysis of the degradation of anonymous protocols. In
Proceedings of NDSS. IEEE, February 2002.
[51] M. Wright, M. Adler, B. N. Levine, and C. Shields.
Defending anonymous communication against passive
logging attacks. In Proceedings of S & P, May 2003.
[52] M. Wright, M. Adler, B. N. Levine, and C. Shields.
Passive logging attacks against anonymous
communications. ACM TISSEC, 11(2), May 2008.
[53] H. Yu, P. B. Gibbons, M. Kaminsky, and F. Xiao.
Sybillimit: A near-optimal social network defense
against sybil attacks. In Proceedings of S & P, 2008.
[54] H. Yu, M. Kaminsky, P. B. Gibbons, and A. Flaxman.
Sybilguard: defending against sybil attacks via social
networks. SIGCOMM CCR., 36(4):267–278, 2006.
[55] Y. Zhu, X. Fu, B. Graham, R. Bettati, and W. Zhao.
On ﬂow correlation attacks and countermeasures in
mix networks. In Proceedings of PET, 2004.
172