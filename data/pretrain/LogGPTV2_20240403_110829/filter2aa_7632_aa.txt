.\" -*- nroff -*-
.de Sh \" Subsection
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Ip \" List item
.br
.ie \\n(.$>=3 .ne \\$3
.el .ne 3
.IP "\\$1" \\$2
..
.TH "SMB.CONF" 5 "" "" ""
.SH NAME
smb.conf \- Samba组件的配置文件 
.SH "总览 SYNOPSIS"
.PP
\fIsmb.conf\fR是Samba组件的配置文件,包含Samba程序运行时的配置信
息.\fIsmb.conf\fR被设计成可由\fBswat\fR (8)程序来配置和管理.本文件包含了
关于smb.conf的文件格式和可能出现的选项的完整描述以供参考.
.SH "文件格式 FILE FORMAT"
.PP
本文件由一系列段和选项构成.一个段由一对方括号中的段名开始,直到下一个段名结束.包含在段中的选项按以下格式定义：
.PP
\fI选项名\fR = \fI选项值\fR
.PP
本文件是基于文本行的.这就是说,每一个以换行符结束的行描述了一个项目(注释,段名,或选项).
.PP
段名和选项名是不区分大小写的.
.PP
只有选项设置中的第一个等号才有意义.第一个等号前后的空格会被忽略.段名和选项名的前后以及中间包含的空格是无关的.选项值前后的空格会被忽略.选项值中包含的空格会原样保留.
.PP
所有以';'和'#'符开头的行都会被忽略,就象只有空格的行那样.
.PP
按照UNIX上的惯例,以'\'符号结尾的行续下一行.(也就是说：'\'是续行符,如果一行写不下,可以在行尾以'\'结束,在下一行继续写--译注) 
.PP
等号后面跟的是字符串(无需引号)或者逻辑值(可以是yes/no,1/0,或者true/false
来表示).逻辑值是不区分大小写的.字符串值则原样保留了输入的大小写.某些选项
(例如create modes)的值是数值型的.
.SH "段描述 SECTION DESCRIPTIONS"
.PP
配置文件的每一段([global]段除外)描述一项共享资源.段名就是共享名,段内的选项设置确定了该共享资源的属性.
.PP
三个特殊段([global],[homes],[printers])将在后面'special sections'单独说明,以下的内容是普通段的说明.
.PP
一个共享资源由一个文件目录和用户对此目录的操作权限的说明构成.另外,还列入了一些用于内部管理的选项.
.PP
每一段定义了一项文件服务(客户端可以把它看作其本机文件系统的延伸)或打印服务(客户端可以通过它来使用服务器提供的打印服务).
.PP
段可以定义成\fBguest\fR服务类型,在这种情况下,客户无需口令就可以访问该资源.一个特定的UNIX系统下的\fBguest account\fR通常用来指定这种情况下的客户访问权限.
.PP
除了guest服务类型以外,其他类型的段定义的共享资源都需要口令才能访问.用户名是由客户端提供的.由于某些老的客户端只提供口令,没有用户名,你需要在共享定义中使用"user="选项来指定一个用户列表,以便根据这个用户列表进行口令验证.对于象Windos95/98和WindowsNT这样的现代客户端程序,这个选项是不需要的.
.PP
注意,对于资源的操作权限还取决于主机系统赋予指定用户或来访者账户的权限.samba提供的服务权限不能超出主机系统指定的权限范围.
.PP
下面的示范段定义了一项文件服务,用户拥有对\fI/home/bar\fR目录进行写操作的权限.这个共享资源是通过共享名"foo"来访问的.
.nf
[foo]
	path = /home/bar
	read only = no
.fi
.PP
下面示范段定义了一项打印服务,此共享资源是只读的,但是可以进行打印操作.也就是说,唯一允许的写操作只能是打开、写入并关闭一个打印假脱机文件.其中的\fIguest ok\fR选项定义意味着允许以缺省的guest用户(在别处定义的)权限进行访问.
.nf
[aprinter]
	path = /usr/spool/public
	read only = yes
	printable = yes
	guest ok = yes
.fi
.SH "特殊段 SPECIAL SECTIONS"
.SS "[global] 全局选项段 "
.PP
这一段中定义的选项是服务器的全局性设置,如果在其他段中没有再对这些选项进行重新设置的话还可以作为它们的缺省选项.更多的说明请参阅'PARAMETERS'部分的内容.
.SS "[homes] 个人目录段"
.PP
如果配置文件中包含名为'homes'的段,就可以建立客户到自己在服务器上的个人目录的连接.
.PP
当服务器收到连接请求时,首先在已定义的段中搜索,如果段名与被请求的共享资源名一致,则该段的内容就被采用.如果没有找到匹配的段,则被请求的资源就被当作是一个用户名,同时服务器查看本地的口令文件.如果该用户名在口令文件中存在且用户给出了正确的口令,服务器就会复制[homes]段的内容来生成一个共享资源(供该用户访问).
.PP
对新建共享会做以下修改： 
.TP 3
共享名从'homes'改为查到的用户名.
.TP
如果没有指定访问路径,则设置为该用户的个人目录.
.LP
.PP
如果要在[homes]段中定义访问路径\fBpath=\fR,宏%S也许对你很有用.举例如下：
.PP
\fBpath = /data/pchome/%S\fR
.PP
如果你的PC 有与UNIX服务器上个人目录不同的目录,象上面这样的设置会很有用的.
.PP
这是为大量用户提供对他们个人目录的访问的一种快速简洁的办法.
.PP
如果被请求访问的共享资源名就是'homes',那么,除了共享名不被改变为发出请求的用户名外,其他处理过程和前面提到的过程是类似的.这种方式适合于不同用户共享一台终端的情况.
.PP
在[homes]段中可以定义所有普通段中可以使用的选项,可是有些选项更有意义.下面是一个实用的、典型的[homes]段的例子：
.nf
[homes]
	read only = no
.fi
.PP
注意,很重要的一点是：如果在[homes]段中定义了允许以guest账户访问的话,任何人都可以\fB无须口令\fR而访问所有账户的宿主目录.也许在某些特殊情况下,这正是想要的结果,在这种情况下,你最好同时把[homes]段设置成\fB只读\fR.
.PP
注意,自动的宿主目录共享资源的\fB可浏览\fR标志是从[global]段继承来的,而不是[homes]段.这样,当在[homes]段中设置\fRbrowseable=no\fR时,用户就看不到单独的'homes'共享,但可以看到自动的宿主目录.
.SS "[printers] 打印机共享设置段"
.PP
这一段很象[homes]段,不过是用于设置共享打印机的.
.PP
如果在本配置文件中存在[printers]段,用户就可以连接到在主机上的printcap文件
中指定的任一打印机.
.PP
当服务器收到连接请求时,首先在已定义的段中搜索,如果有段名与被请求的共享资源名一致,则该段的内容就被采用.如果没有找到匹配的段,且在配置文件中存在[homes]段,则按照前面所说的方式处理.否则,被请求的资源就被当作是一个打印机名,服务器在适当的printcap文件中查找,检验被请求的共享资源名是否是有效的打印机共享名.如果共享名匹配,服务器就会复制[printers]段的内容来生成一个共享打印服务.
.PP
对新建共享的修改：
.TP 3
共享名被设置为查找到的打印机名.
.TP
如果未给出打印机名,则把打印机名设为前面查找到的打印机名.
.TP
如果该共享资源不允许以guest身份进行访问,且没有给出用户名,那么用户名就被设为前面查找到的打印机名.
.LP
.PP
注意,[printers]段必须设置为可打印,如果你不这样设置,服务器会拒绝装载配置文件.
.PP
指定的典型路径应该设为一个公用的可写假脱机目录(spooling)并且设置sticky标志.一个典型的[printers]段如下所示：
.nf
[printers]
	path = /usr/spool/public
	guest ok = yes
	printable = yes 
.fi
.PP
上台打印机在printcap文件中列出的所有别名都是服务器相关的有效打印机名.如果你系统的打印子系统的工作方式不是这样,你就必须设置一个伪printcap文件,其中包含一行或多行如下格式的设置：
.nf
别名1|别名2|别名3|别名4... 
.fi
.PP
每个别名必须是你的打印子系统可以接受的打印机名.在[global]段中指定这个新文件作为你的printcap文件.这个伪printcap文件可以包含任何你要的别名,而服务器只识别在此文件中列出的名字.这个技术可以很方便的用于限制对本地打印机子集的访问.
.PP
顺便提一下,printcap文件中的别名用每个记录第一项的任何部分来定义.记录由换行进行分隔.如果一条记录中有多个部分,中间用"|"符号分隔.
.RS
.Sh "Note"
.PP
注意,在SYSV系统中,用lpstat可以确定系统中安装了什么样的打印机.你可以设置"printcap name = lpstat"来自动获得打印机列表.详情参见"printcap name"选项.
.RE
.SH "选项 PARAMETERS"
.PP
选项定义了每个段的属性.
.PP
有些选项是在[global]段中设定的(比如有关\fB安全\fR特性的设置),有些可以用在任何段中的(比如\fB建立方式\fR ),剩下的就只能用在普通的段中了.在以下的描述中,[homes]和[printers]段被看作是普通段.标记(\fBG\fR)表示此选项只能在[global]段中使用,标记(\fBS\fR)表示此选项可以在服务定义段中使用.注意,有(\fBS\fR)标记的选项也可以用在[global]段中,在这种情况下,这个选项设置被当作所有其他段的缺省设置.
.PP
选项的详细说明是按照字母顺序排列的,这样也许不是最好的分类方式,但至少保证你可以找得到他们.如果有多个同义词,那么我们只对首选的那个作详细说明,其他的同义词都只指明参阅那个首选的选项名.
.SH "变量替换 VARIABLE SUBSTITUTIONS"
.PP
在配置文件中可以用很多字符串进行替换.例如,当用户以john的名称建立连接后,选项"path = /tmp/%u"就被解释成"path = /tmp/john".
.PP
这些置换会在后面的描述中说明,这里说明一些可以用在任何地方的通用置换.它们是：
.TP
%U
对话用户名(客户端想要的用户名不一定与取得的一致.)
.TP
%G
%U的用户组名 
.TP
%h
运行Samba的主机的internet主机名 
.TP
%m
客户机的NetBIOS名(非常有用) 
.TP
%L
服务器的NetBIOS名.这使得你可以根据调用的客户端来改变你的配置,这样你的服务器就可以拥有"双重个性". 
Note that this parameter is not available when Samba listens on port 445, as clients no longer send this information
.TP
%M
客户端的internet主机名 
.TP
%R
协议协商后选择的协议,它可以是CORE,COREPLUS,LANMAN1,LANMAN2或NT1中的一种.