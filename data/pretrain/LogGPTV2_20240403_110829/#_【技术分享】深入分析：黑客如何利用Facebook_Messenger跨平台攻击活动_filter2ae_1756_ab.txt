为了避免在这里白白坐等，我建立了伪扩展程序来模拟攻击者的行为。当然，我并没有激活相关代码，而是将其保存在本地。
一段时间后，我注意到自己已经获得许多点击量，点击者的终端均立即发回了回应码（back code）：
返回的代码没有经过任何混淆处理，能够从中看清具体流程。该代码实际是专门针对Facebook而编写的。
该脚本将执行以下操作：
查看运行的域中是否包含Facebook.com。
提取CSRF凭证以访问Facebook，将其名为“fb_dtsg”。
查看是否已经获取访问凭证（获得访问权限是为了完成Facebook API的身份验证）。
将访问令牌（access token）和用户ID发送给攻击者的外部站点。
确保平台功能已启用（禁用kill-switch）：
创建一个访问令牌。目前Facebook已经弃用了FQL API，Facebook此前一直使用FQL API：
然而攻击者发现，如果目标使用iOS系统中的“Pages Manager”应用程序定制访问凭证，FQL API将继续保持可用。
让我们继续来看最有趣的部分，即这些脚本都干了什么：
**对攻击者点赞Facebook页面的剖析**
该脚本将根据硬编码内容为一个Facebook页面点赞。而攻击者很有可能是通过监控该页面的点赞数量来计算受感染用户的具体数量的。
在该攻击的某一阶段中，我们发现页面中的点赞数量激增，在短短数小时之中，从8900跃升到近32000：
同样明显的是，攻击者能够通过C&C服务器中的脚本获取器来控制攻击时间。在攻击过程中，该网页点赞数量的增长速度呈现出巨大差异。
攻击者此外还数次更换了页面，很有可能是因为他们的页面遭到了Facebook封停。
**取得好友列表**
由于攻击者已经获得一个支持 **FQL** 的访问凭证，他们将能利用过时API取得受害者的朋友列表，并按上线日期进行划分，将一直保持在线的朋友选取出来。
他们通过一次选取50名好友将其打乱，只有当这些好友处于空闲或在线状态时，才开始发动攻击。
接着，他们将通过另一域名生成链接，专门用于接受用户ID信息。这一链接将在Google
Docs上创建PDF文件，记录目前受害者的档案资料，再由一个短地址将其发回。
攻击者接收该链接后，会再次随即向所有好友发送信息，并使该链接再次运转。
**  
**
**有趣的细节**
在前面的攻击中，植入代码的某些部分从未被使用过，或有所遗留。
其中一部分就是在合适条件下向每名好友发送消息的定位功能，在实际攻击中其被换成了随机的emoji表情：
login.php
攻击者所使用的域中包含了一些文件，使我们猜测类似login.php在内的PHP文件应该存储其中。该文件将同时释放出一个Facebook登录脚本，以及一个硬编码电子邮箱地址：
**  
**
**版本**
我们发现攻击者使用了数种版本的Facebook注入脚本。在攻击的末尾阶段，该脚本仅仅点赞了Facebook页面，却并未发动攻击。另外，用于收集访问凭证的域名也从脚本中移除了。
**  
**
**登录页**
正如我们所提到，脚本同样列举了你正在使用的浏览器类型。Chrome拓展部分仅对使用Google
Chrome的用户有效。如果你使用的是另一种浏览器，相关代码也会执行其它命令。
有趣的是，攻击者虽然对大多数操作系统添加了支持，但我们并未收集到针对Linux操作系统的任何样本。
我们所收集的样本均为恶意广告程序，在受害者打开最后的登陆页时，将被复位向至数个
包含恶意邮件或广告的跟踪域。这也说明了攻击者想要通过点击量或分发恶意邮件或广告进行谋利。
**  
**
**Safari浏览器**
MD5 (AdobeFlashPlayerInstaller.dmg) = d8bf71b7b524077d2469d9a2524d6d79
MD5 (FlashPlayer.dmg) = cfc58f532b16395e873840b03f173733
MD5 (MPlay.dmg) = 05163f148a01eb28f252de9ce1bd6978
这些均为虚假的Adobe Flash更新，但受害者每次都会关闭不同的网站。为此，攻击者似乎轮流使用了一组域名。
**  
**
**火狐浏览器（Mozilla Firefox）**
MD5 (VideoPlayerSetup_2368681540.exe) = 93df484b00f1a81aeb9ccfdcf2dce481
MD5 (VideoPlayerSetup_3106177604.exe) = de4f41ede202f85c370476b731fb36eb
“我感染了这个，我该怎么办？
目前，Google
Chrome安全小组已禁用所有恶意扩展程序，但是当攻击者使用恶意软件盗取了你的Facebook个人资料的同时，也盗取了你Facebook账号的访问令牌（access-token）。这个访问令牌可能使有时间限制的，但是它的访问权限非常之大。Facebook账号的访问令牌主要是用于安卓系统的Facebook软件。一旦获得了你的访问令牌，攻击者就可以访问用户的个人资料，不论你是否更改了密码、注销Facebook账户或是关闭了Facebook上的的平台设置。
我们目前正在与Facebook就这个问题进行探讨。但目前看来，受害者似乎并没有一个简单的方法废除被攻击者偷走的访问令牌。现在只能祈祷攻击者不要在令牌过期之前做任何事情。
我们强烈建议用户更新杀毒软件。
**  
**
**结语**
攻击主要依赖现实的社交互动，动态用户内容和合法域名作为中间步骤。上述扩散机制的核心感染点是安装Chrome扩展程序。当你允许扩展过程控制浏览器活动时请格外注意。同时，也要弄清楚目前你的浏览器上运行了哪些扩展程序。如果你使用的是Chrome浏览器，可以在URL中输入chrome://extensions/，以获取正在运行的扩展程序列表。