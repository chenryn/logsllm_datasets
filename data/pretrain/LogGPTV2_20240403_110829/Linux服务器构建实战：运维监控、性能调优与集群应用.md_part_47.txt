至此，iSCSITarget存储端的设置已经完成了。
修改完两个文件后，重启iSCSITarget服务即可。过程如下：
这个设置是赋予集群的4个节点对存储的访问权限。
接着编辑/etc/iet/initiators.allow文件，修改后的文件内容如下：
其中，/dev/sdc是storgae-server主机共享给集群节点使用的共享空间。
在 storgae-server上安装完iSCSITarget后，开始进行配置。编辑/etc/iet/ietd.conf文件，
iSCSITarget的安装与使用已经在第7章进行了深入讲述，这里不再详细说明，仅给出
1.配置iSCSItarget
本节以下的所有操作均在storgae-server主机，也就是192.168.12.246服务器上完成。
配置共享存储和RHCS管理端Luci
www.Linuxidc.com
start
307
PDG
---
## Page 323
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
需要其他依赖的系统包，只需按照提示进行安装即可。
件包。
于在线安装方式受网络和速度的影响，不建议采用，这里通过手动方式来安装RHCS软
线下载方式自动安装；也可以直接从操作系统光盘中找到所需软件包进行手动安装。由
hosts文件中。修改完成的/etc/hosts文件内容如下：
12.4.3在集群节点上安装RHCS软件包
308第5篇集群高级应用篇
安装RHCS，主要安装的组件包有cman、gfs2和rgmanager。在安装这些软件包时可能
#install gfs2
rpm -ivh ricci-0.12.2-12.e15.centos.1.1386.rpm
#install ricci
下面是一个安装RHCS软件包的脚本文件，也是安装RHCS的一个清单。
RHCS软件包的安装有两种方式：可以通过Luci管理界面，在创建集群时，通过在
将此文件依次复制到集群每个节点的/etc/hosts文件中。
为了保证集群的每个节点间可以互相通信，需要将每个节点的主机名信息加入到/etc/
#install cman
192.168.12.232
192.168.12.240
192.168.12.230
127.0.0.1
到这里为止，在storgae-server主机上的设置完成。
192.168.12.240
192.168.12.230
192.168.12.232
192.168.12.231
为了使Luci能够访问集群其他节点，还需要在/etc/hosts中增加如下内容：
成功启动Luci服务后，就可以通过https:/ip:8084访问Luci了。
-
-ivh pexpect-2.3-3.el5.noarch.rpm
-ivh 
ivh
ivh
ivh
ivh
www.Linuxidc.com
openais-0.80.6-16.e15_5.2.1386.rpm
per1-Net-Telnet-3.03-5.noarch.rpm
Mysql2
web2
web1
localhost
web2
web1
Mysql2
Mysql1
我
PDG
---
## Page 324
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
Luci登录用户。CentOS下的Luci主界面如图12-10所示。
“homebase”主要用于添加、更新、删除cluster系统和 storage设置，同时也可以创建和删除
就可以打开Luci登录界面，如图12-9所示。
命令行操作两种方法介绍如何配置cluster.conf文件。
12.5配置RHCS高可用集群
置方式与webl节点完全相同，不再一一讲述。
个集群节点。这里以集群节点web1为例，介绍如何安装和配置iSCSI，其他节点的安装和配
12.4.4
经成功安装了。
成功登录后，Luci有三个配置选项，分别是“homebase”、“cluster”和“storage”，其
在storgae-server主机上启动Luci服务，然后通过浏览器访问https://192.168.12.246:8084/，
配置RHCS，其核心就是配置/etc/cluster/cluster.conf文件。下面通过Web管理界面和
至此，安装工作全部结束。
通过fdisk的输出可知，/dev/sdb就是从iSCSITarget共享过来的磁盘分区。
Disk/dev/sdb doesn't contain a valid partition table
Disk /dev/sdb:10.7 GB,10737418240 bytes
iSCSI客户端的安装和配置非常简单，只需如下几个步骤即可完成：
安装iSCSI客户端是为了和iSCSITarget服务器端进行通信，进而将共享磁盘导人到各
Units
[root@webl rhce]#fdiak -1
root@webl
将此脚本分别在集群的4个节点上执行，如果没有报错，那么证明RHCS底层软件包已
root@webl
在这个脚本中，ricci是Conga的一部分，用于和管理端Luci进行通信。
rpm -ivhrgmanager-2.0.52-6.e15.centos.i386.rpm
#install rgmanager
rpm -ivh
在集群节点上安装和配置iSCSI客户端
www.Linuxidc.com
rhcs]#/etc/init.d/iscsi restart
rhcs]#
gfs2-utils-0.1.62-20.e15.i386.rpm
iscsiadm
1048576 bytes
sendtargets -p 192.168.12.246
---
## Page 325
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
aNewCluster”，增加一个cluster，如图12-11所示。
12.5.1
310
登录Luci后，切换到“cluster”选项，然后单击左边的“clusters”选择框中的“Create
创建一个cluster
第5篇集群高级应用
www.Linuxidc.com
admin
要访问网站的这部分内容，您需要输入您的用户名和密码。
完成后，请注意登出或者退出您的浏览器。
请登录
nomebase
录
大小写敏艺，请确认大写德交有开息。
密码
adain
Adda User
Manage Systems
Cluster
Add an Existing
Add a System
图12-10CentOS下的Luci主界面
Centos
Centos
图12-9Luci登录界面
请确认键程大写微设有开息
Select an action from the list on the left.
Welcome to Luci, admin.
Luci Homebase
STORAGUSTYRTAMS
STORALUESTERTAMS
---
## Page 326
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
会输出成功信息，如图12-12所示。
节点的配置是否可以创建集群。如果检测失败，会给出相应的错误提示信息：如果验证成功，
identical")，这些创建cluster的设置，可选可不选，这里不做任何选择。
nodesbefore joiningcluster”）和检查节点密码的一致性（“Checkifnode passwordsare
启用共享存储支持（“EnableSharedStorageSupport"）、节点加人集群时重启系统（“Reboot
RHCS组件包在前面已经手动安装，所以这里选择本地安装即可。其余的3个复选框分别是
RHCS 软件包，而“Use locally installed packages”表示利用本地安装包进行安装，由于
同，也可以不同。
主机名称，“RootPassword”表示每个节点的root用户密码。每个节点的root密码可以相
“ViewSSLcertfingerprints”用于验证集群各个节点与Luci通信是否正常，并检测每个
在图12-11中的下面5个选项中，“Downloadpackages”表示在线下载并自动安装
在图12-11中，创建的cluster名称为“mycluster”。“NodeHostname”表示每个节点的
dustr
www.Linuxidc .com
Cluster List
Status messages:
Host Mysql2has 5SLkey fingerprint
36:BE:5E:47:B6:F6:E6:5D:6F:07:99:91:3D:8C:5B:F4:2C:8B:36:F9
Host Mysql1 has SSL key fingerprint
A3:A8:D0:EC:AB:EC:6D:84:F6:19:D7:31:1F:E9:BB:28:CD:C4:17:8F
Host web2 has SSL key fingerprint
图12-12SSLcert验证成功信息
Submit
View SSL cert fingerprints
Createanewcluster
Check ifnode passwords reidentical.
Reboot nodes before joining cluster
Enable Shared Storage Support
Use locally instelled packages
CDownload packages
Addaduster node
nysq12
Hysqll
rebz
vebl
Node Hostname
图12-11创建cluster
RootPassword
第12章RHCS集群
311
PDG
---
## Page 327
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
12-14所示。
配置文件中的过程。集群创建成功后，默认显示“mycluster”的集群全局属性列表，如图
就创建完成了。其实创建cluster的过程，就是Luci将设定的集群信息写人到每个集群节点
如图12-13所示。
312
依次单击“cluster→ClusterList”来查看创建的mycluster的状态，如图12-15所示。
在经过Install—Reboot-
所有选项填写完成后，单击“Submit”按钮进行提交。接下来Luci开始创建cluster，
第5篇
www.Linuxidc .com
myduster
Nodes
mydustar
Createa He 
urtw
aflover
esou
Clurte List
图12-14mycluster的全局属性列表
Fene
图12-13Luci正在创建cluster
topvaitino fer this iob to
?
Please be patient - this cluster'sconfiguration is beingmodified
mycluster
Configure—Join4个过程后，如果没有报错，“mycluster”
GenereaFenceMulticast]QuorumPartiton
mycluster
Apply
Cluster Name
General Properties
Reboot
Reboot
Reboot
Reboot
L
tion
molets
Version
Conflqure
Conflgure
Conflgure
"mycluster
Configure
1
X
PDG
---
## Page 328
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
ClusterName均显示为绿色，如果出现异常，将显示为红色。
单击Nodes下的任意一个节点名称，可以查看此节点的运行状态，如图12-16所示。
从图12-15可知，mycluster集群下有4个节点，在正常状态下，节点Nodes名称和
口“QuorumPartition”，用于配置集群表决磁盘及相关属性，在后面会进行详细讲述。
口“Multicast"，用于配置集群多播属性，也就是配置集群的心跳。配置选项有：“集群选
口“Fence”，提供配置Fence daemon属性的参数接口。
口“General"，用于显示集群的名称、集群配置文件的版本号和集群高级属性配置。
在图12-14中的选项含义如下：
www.Linuxidc .com
11
eb2
usta:
11
Myso12
Configure
Cenfigure
ClurterLrt
Updatemainfence properies
Main Fencing Method
• This node has no failover domain membership
FalloverDomain Membership
 No cluster services are currently running here
Services on this Node
Updetenode deemonproperties
Cluster daemonsrunning onthisnode
Adda fence device to shis level
Showrecent logsctivity for.this.node
Status: Cluster member
mycluster
nanaper
cman
图12-16web1节点运行状态
图12-15mycluster的运行状态
yOS
Nodes
Status:Quorato
Cluster Name: mycluster
Choose a cluster to administer
um Required,Quorum
Votes:4
 Ne Services Defined
services
Bestert this elesterGo
Uupdetebackupfence properies
Addafance deie to this loy
Backup Fencing Method
ChooseTesk.
第12章RHCS集群313
G
PDG
---
## Page 329
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
如图12-17所示。
栏中依次单击“FailoverDomains”一“AddaFailover Domain”，增加一个FailoverDomain，
mysql-failover。
限制在指定的节点间。下面的操作将创建两个失败转移域，分别是webserver-Failover和
12.5.2
下面依次进行介绍。
还需要为这个cluster 创建Failover Domain、Resources、Service、Shared Fence Device 等。
的状态。
以通过命令行方式手工启动。命令如下：
开机自动启动，它们是RHCS的核心守护进程。如果这两个服务在某个节点上没有启动，可
314
口Prioritized：是否在FailoverDomain中启用域成员优先级设置，这里选择启用。
口FailoverDomainName：创建的失败转移域名称，取一个易记的名字即可。
在图12-17中，各个参数的含义如下：
FailoverDomain是配置集群的失败转移域，通过失败转移域可以将服务和资源的切换
通过上面的操作，一个简单的cluster就创建完成了。但是这个cluster目前还不能工作，
服务启动成功后，单击图12-16中的“Update node daemon properties”按钮，更新节点
/etc/init.d/cman start
从图12-16可以看出，cman和rgmanager服务运行在每个节点上，并且这两个服务需要
/etc/init.d/rgmanager start
创建FailoverDomain
第5篇
www.Linuxidc .com
myduster
Share fente
Fesgurcef
Services
Nodes
Configurs
Cluster Lipt
集群高级应用篇
图12-17创建webserver-Failover
Submit
Fallover domaln membershl
AddaFailoverDomain
mycluster
web1
Mysolz
yso
lode
rortined
D
口
iembe
PDG
---