365
Storevalue
Asis
Showvalue
As is
showvaluemappinqs
Newapplication
ApplicationsNone
图5-38
126
---
## Page 143
第5章深入配置和使用
在Latestdata中查看数据，如图5-39所示。
Latestdat
LATEST DATA
Items
Filter
Name
Lastcheck
Lastvalue
other-(2Items
18 Feb201418:02:34
895622713632
B95622262784
图5-39
单击图5-40右边的Graphs，可以看到图形数据，如图5-40所示。
Aggregate:kvm-Host group disk/ free(1h)
960G
940G
920G
900G
880G
860G
8400
18:02
kym-Host group disk /fre[all 895.62G 895.62 G 89562 G 895.63G
图5-40
扩展：在现实环境中，我们可能需要对多个主机中多个磁盘分区的剩余空间
进行数据汇总，其思路如下。
①在各主机中用Zabbix计算的方式对各个磁盘分区求和，形成一个新的
Items(total free)。
②用聚合计算对主机组的Items（totalfree）求和。
5.3.6内部检测（Internal)
内部检测用于监控Zabbix自身的性能数据，可监控Zabbix-Server或Zabbix-
Proxy，选择监控方式为Zabbixintermnal，添加相应的Itemkey，即可完成监控。
内部检测的数据格式可以为 zabbix[参数，模式]。对于所有的Key，读者可以
参考如下地址的内容。
https://www.zabbix.com/documentation/2.2/manual/config/items/itemtypes/internal
Items的添加方式如图5-41所示。
127
---
## Page 144
Zabbix企业级分布式监控系统
*Template list Template:Template App Zabbix Server Applications(1)Items(31)Iriqqers(27)Gr:
NameZabbix $2 write cache, % free
TypeZabbix internal
Keyzabbix[wcache,history,fr]
Select
Type of informationNumeric(float)
Units %
Use custommultiplier
Update interval (in sec)
60
Flexibleintervals
Interval
Period
Action
No flexible intervals defined.
New flexible interval Interval (in sec)
50Period1-7,00:00-24:00
Add
Keephistory (in days)
7
Keep trends (in days)
Store valueAs is
ShowvalueAsis
showvaluemappin
New application
Applications
-None-
Zabbix server
图5-41
Zabbix自带三个模板 Server、Proxy、Agent，如图5-42所示。
TemplateAppZabbix Aqent
Applications(1)Items(3） Triqqers（3） Graphs（0
TemplateAppZabbixProxy
Applications (1) Items (21) Triqgers (19) Graphs(4
Temolate App Zabbix Server
Applications(1) Items (31) Iriqqers (27) Graphs (5
图5-42
读者可根据实际需要对Items进行增减。
5.3.7SSH、Telnet和扩展检测
对于SSH监控方式，其思路是利用SSH公钥，ZabbixServer和被监控端无
密码访问执行SSH命令，获取相关的Shell命令返回值。
读者如有需要，请参考官方文档，地址如下。
https://www.zabbix.com/documentation/2.2/manual/config/items/itemtypes/ssh_checks
进行Telnet检测时需要用户名和密码，Telnet验证成功后，执行命令，获取
返回值。官方文档地址为：
https://www.zabbix.com/documentation/2.2/manual/config/items/itemtypes/
telnet_checks
扩展检测是通过带参数的脚本执行命令返回结果的。
128
---
## Page 145
第5章深入配置和使用
官方文档地址为：
https://www.zabbix.com/documentation/2.2/manual/config/items/itemtypes/external
有关SNMPJMX方式的内容，将在第7章中讲解。
5.4宏的配置
宏的作用是便于在模板、Items、Trigger中的引l用。宏的名称为{$名称}，宏
的字符范围为A~Z、0~9、_。
Zabbix自带宏的官方参考文档中介绍了详细的内容，网址如下。
https://www.zabbix.com/documentation/2.2/manual/appendix/macros/supported_b
y_location#additional_support_for_user_macros
例如，在Key中的宏：
net.tcp.service[ssh,($SSH_PORT)]
其中，{SSSH_PORT}就是一个宏，可以在添加Items的时候，对不同端口的
SSH单独定义端口，这样一个模板就可以被多个主机引用，达到通用的目的。
对于实际的应用，将在第11章看到相关宏的应用案例。
1．全局宏
作用范围为：模板、主机。
配置步骤为：单击Administration→General→Macros，如图5-43所示。
ZABBIX
N
图5-43
选择Macros下拉菜单，如图5-44所示。
图5-44
默认的宏为{$SNMP_COMMUNITY}，如图5-45所示。
129
---
## Page 146
Zabbix企业级分布式监控系统
Macro
Value
(SSNMP_COMMUNITY)
pubic
Add
Save
图5-45
2.模板宏
作用范围为：当前模板。
配置步骤为：单击Configuration→Templates，再单击模板名称（图中为
TemplatesOSLinusx），最后单击Macros，如图5-46所示。
ZABBIX
ofGUI
CONFIGURATIONOF TEMPLAVES
Iemolatelist
TemplateIemolate OSLinuxApplications(10)Items(33）Iriqgers(15)Graohs（5）Screens（1)
Macro
Value
[(SMACRO)
Add
Fullcl
Delete
图5-46
3.主机宏
作用范围为：当前主机。
配置步骤为：单击Configuration→Hosts→Zabbixserver→Macros，如图5-48所示。
ensstide showsMapsDiseo
History:Configuration of macfosConfiguration of host groupsConfigurationof templatesConfiguration of
CONFGURATIONOFOSTSAYUEN
Host litHost:Zabbix serveronitaredZApolications(12)Itens(92)Iriqqers（47）Graoh
HostTemplatesIPMIMacros
Ttostinventory
Macro
Value
($MACRO)
vake
Add
Clone
Full clone
DeleteCancel
图5-47
关于内部宏的内容，可参考以下网址。
https://www.zabbix.com/documentation/2.2/manual/appendix/macros/supported_b
y_location#additional_support_for_user_macros
130
---
## Page 147
第5章
深入配置和使用
关于主机的宏名称，其作用和注意事项如表5-8所示。
表5-8
宏名称
作
用
注意事项
{HOST.CONN}，选择连接的方式，在Web界
{HOST.CONN}
Hostname或者是主机的IP地址
面有两个可选：IP或DNS
{HOST.DNS}
主机的Hostname
{HOST.DNS}，FQDN
{HOST.HOST}
主机的名称，Zabbix定义的
{HOST.HOST}，必须唯一
{HOST.IP}
主机的IP地址
{HOST.IP}
{HOST.NAME)
主机可见的名称
名字显示在主机列表、map、screen中
在Web中的配置内容如图5-48所示。
ISOHISOH
Visiblename
HOST.XAME
Aop-oesed
Lyuerviusrser
Dfiux weinders
Temp
(HOST,CON1)
Paddress
1270.0.1HOSI.IP1
(HOST-DNS1)
P
DNS
100
127.0.0.1(HOST.IP2)
HOST.DNS2)
IP
DNS
100
127.0.0.1(HOST.IP3]
(HOST_DNS3)
IPDNS
100
图5-48
5.5维护时间
在某些场合中，我们不需要进行告警，例如，业务的正常维护，所以此时维
护时间功能特别有用。
配置维护时间如图5-49所示。
History:ConfigurationcfhostsHostinyentoryHostinventoryoverviewHostinventoryConi
CONFICUUTIONOFATNTENANCEPERIODSA
Mainter
noePeriodsHosts &Grouos
Name
Maintenancetype
With data collection
Active since16/02/2014]00:00j
Aciveti17/02/201400:00
图5-49
131
---
## Page 148
Zabbix企业级分布式监控系统
这里的维护时间和Action中的配置紧密相关，如图5-50所示。
Action
Conditions
Operations
Type of calculationAND/OR（A）and(B)
ConditionsLabelName
Action
[(A)
(B)
Trigger value =PROBLEM
Remove
like
Add
Clon
Delete
图5-50
Action中配置了不在维护时间内才发送告警，因此，启用维护时间不会产
生告警。
禁止维护模式期间访问WebGui的配置语句如下。
shell# vim/usr/share/zabbix/conf/maintenance.inc.php #见图5-51
SZ6X_GUI_ACCESS_1P_R4NGE=array（127、O.0.1);
MSG show
zabbix is under
REQUEST
图5-51
修改好后保存，访问显示的界面如图5-52所示。
zabbix-gui.itnihao.com/events.php
图5-52
5.6事件确认
当事件出现状态为Problem的时候，在菜单栏中单击Monitoring→Events，在
其中可以查看事件的详细信息，如图5-53所示。
ACK链接有Yes和No两种状态，如图5-54所示。
132
---
## Page 149
第5章深入配置和使用
ZABBIX
JITS
TORY0FEVENTS[an24th,201407:47:32AM]
Time
Host
Description
Jan 24th.2014 07:47.30AMZabix server
Zabbixagent onZabbix serverisunreachable for5minutes
图5-53
MapsDiso
eryTT
hboardLatest events
Export toCsv
Groupall
Hostall
Status
Severity
Duration
AckActions
Average42s
nableforSminutes
PROBLEM
No
Inprogress
图5-54
单击图5-54中Ack列的No，弹出如图5-55所示的界面，输入内容，确认并
返回结果。
Adkn
已经处理
Message
edgeCancel
图5-55
看到Ack已经变为Yes状态后，说明有用户修改过该状态，如图5-56所示。
Export toCsV
ednog
Hostall
SourceTriqgqer
Status
Severity
Duration
Ack
Actions
server2isunreachablefor5minutes
PROBLEM
Average5m 5s
Yes (1)
Failed
图5-56
单击Yes，可以查看具体的文字内容，如图5-57所示。
ES:7ab
an24th,2014
07:52:33AM
已经处理
Message
图5-57
133
---
## Page 150
Zabbix企业级分布式监控系统
单击Monitoring→Dashboard显示最近的20个事件，会显示Ack状态，
如图5-58所示。
ZABBIX
atesteventsAcknowiedgesDashboardAcknowledges
PERSONAL DASHBOARD
Favet
eddet
cp
Favo回
Last 20Kstwes
画肉
Screens
Host
Issue
Last change
Age
InloAck
Action
Zabbrxserverl
Zabbix agent onZabbix severlisunreachabie for5minutes
Jan.24th.201407:48:00AM14m145
yes(1)
Zabbixserver2
Zabbiagent onZabbiserer2isurreachable for 5minutes
1an24h.201407:48:00AM14m14s
Yes(1)
Zabbixserver
Zabbiy agent cnZabbir severisunreachable for Sminutes
Jan24th.2014.07:47:30 AM14m 44s
No
win7
Zabbix agentonw7iunreachable for5minutes
Jan14th.201404:34:00PM9d15h28m
win 7web
zabbagentonwin7webisnreachableformnutes
9d15h28m
No
图5-58
鼠标光标放到Yes 的地方，可以看到刚才添加的内容。
单击Monitoring→Triggers，其中显示Acknowledgment的状态也会变为绿色
如图5-59所示。
1to13of13
Severly Status
InfoLast change
AcknowledgedHost
Name
Com
verage
PROBLEN
an24th.201407:48:00AM
15m46s
Acknowledaed
Zabbixserverl
Zabbix agent onZabbix
chablefor5m
Averaga
lan24th.201407:4:00AM
15m46s
Acknowledae(1)
Zabbix server2
zabbxagentnabbseveru
lan24th,2014.07:47:30.AM
16m16s
Acknowledae(3)
Zabbox server
Add
图5-59
数据的导入/导出配置
5.7
Zabbix提供将所有的配置导出为标准XML格式的文件，同样，也支持导入
标准格式的XML配置文件。
导入/导出功能可以把之前做的功能进行模板化，与Cacti模板的原理相同。
单击Configuration→Templates/Host→Export/Import→Export，勾选要导出的模
板（设备），选择Export，即可导出XML文件到本地。
134
---
## Page 151
第6章告警配置
在Zabbix的学习过程中，告警配置成了学习的难点。本章就是为了解决这个
难点的。下面将详细介绍Trigger 的配置、Action 的配置，重点介绍Trigger的规
则表达式、告警、升级告警、自定义告警脚本，配有大量的实例，以帮助读者深
入理解这部分内容，从而解决读者对告警配置使用的困扰。
6.1告警概述
告警是监控的重要职能，是指将达到某一阈值事件的消息发送给用户，让用
户在事件发生的时候即可知道监控项处于不正常状态，从而让用户来决定是否采
取相关措施。