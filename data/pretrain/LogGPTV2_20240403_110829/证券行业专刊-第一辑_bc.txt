03 安全设计原则 	胁、建立风险消减措施，最终形成安全设计方案。03 安全设计原则 	胁、建立风险消减措施，最终形成安全设计方案。
在安全架构设计中，有个很关键地方就是要遵循安全设计原则。安 全设计原则，是在安全业界实践中已被证明是成功的抽象概念的集 合，是无数前辈经验的总结。它告诉我们安全设计的正确做法以及 为什么这么做。应用系统的设计人员应遵循这些安全设计基本原则 进行威胁分析和安全方案设计，避免由于设计不当引入的安全风 险，提升应用系统的安全性。
攻击面是指应用软件任何可被人或其他程序访问的部分，而攻击面 分析的目的是为了减少应用和数据暴露在不可信用户面前的数量。攻击面分析的核心是识别访问入口及信任边界。访问入口就是数据 流入流出的入口点，如身份认证入口点、管理页面、传输接口等；信任边界有网络边界，如互联网、DMZ、核心网、办公网，也有 应用或服务边界，其他还有主机边界等。攻击面分析还需要确定应
198 	199
证券行业应用安全架构设计实践198 	199
证券行业应用安全架构设计实践
用程序中的有价值的数据（例如机密、敏感、合规的）。
威胁建模是分析应用程序安全性的一种结构化方法，通过识别威
与信息安全三要素和信息安全基本的三个属性相关。随着国内 外对个人隐私保护重视程度加大，如果业务涉及个人信息，也 需要考虑对隐私数据的保护。
胁，定义防御或消极威胁控制措施的一个过程。威胁建模主要有 6	…
个步骤：	5、记录威胁。根据识别的威胁分析可以实施的缓解措施并记录下 1、识别资产。确定必须要保护的有价值的资产，如敏感数据、隐 	来。
私信息等。
6、评估威胁。评估威胁的优先级，需要先解决最重要的威胁。可
2、创建架构概述。目的是为了更好的理解系统架构，为辨别威胁 做准备。具体就是绘制系统架构图，包括标识子系统，信任边
以采用 DREAD 风险模型进行威胁风险评级。DREAD 从潜在 损害、可重复性、可利用性、受影响用户、可发现性 5 个方面界和数据流等。	进行评分。一旦获得风险等级，就可以更新记录的威胁并添加 	发现的等级。
3、分解应用程序。根据架构图以及功能需求描述，对系统进行数 
	据流分析，绘制相应的数据流图，识别关键技术，信任边界及 	威胁建模的输出包括应用程序体系架构安全方面的文档以及威胁 	系统的入口等。	的列表，最终由安全团队输出安全设计方案，开发人员基于安全 	设计方案进行系统功能设计和开发，通过设计安全（security…by…4、威胁识别。威胁分析方法有威胁列表、攻击树、STRIDE 方法等。	design）降低安全风险。
比较常用的是 STRIDE，STRIDE 是从攻击者的角度，把威胁 
划分成 6 个类别，分别是 Spooling（仿冒）、Tampering( 篡改 )、	05 安全架构设计实践 Repudiation（抵赖）、Information…Disclosure（信息泄露）、Dos( 拒绝服务 ) 和 Elevation…of…privilege( 权限提升 )。这 6 类
从上面威胁建模过程可以看出，流程太重，过于繁琐，且对于人工 投入要求较高，很难适应业务的敏捷快速迭代开发模式。因此在实 际使用中，我们对威胁建模过程进行了优化，将安全需求分析和架 构设计过程结合，设计了轻量级威胁建模，主要包括攻击面分析、安全威胁库及安全需求库。
安全建设的目标，就是保护信息资产，实现信息安全三要素 CIA，机密性（只有授权用户可以获取信息）、完整性（信息在输入和传
200 	201
证券行业应用安全架构设计实践
输的过程中，不被非法授权修改和破坏，保证数据的一致性）和可 
用性（保证合法用户对信息和资源的使用不会被不正当地拒绝）。
下面以证券机构某金融 APP 实际案例，讲解如何通过轻量级威胁 
建模，进行安全架构设计。
该产品是一款投行类一体化服务平台，支持移动 APP 客户端及该产品是一款投行类一体化服务平台，支持移动 APP 客户端及 
Web 页面，目标客户既有企业内部人员，也有外部客户，以及第 
三方机构。
对项目组进行问卷调研，目的是要了解系统的关键信息，为后面的 
攻击面分析及威胁建模做准备。
UI，后端采用微服务架构，且应用和第三方服务有交互；使用场 
景，既有外部客户，也有内部用户，暴露的接口有 web 页面，也 
有 Restful…API；存在客户敏感数据。从应用的部署架构，可以看 
到应用分布区域有互联网、DMZ、核心网及办公网。
…
调研问卷主要包括系统架构、使用场景、重要数据、部署方式等。
其中系统架构关注技术实现方案、系统架构等；使用场景关注用户 
场景、用户群体、角色、访问方式等；数据关注是否有敏感数据等；
而部署方式关注部署架构、资产清单等。（见右页首图）
…	根据调研问卷，可以大概了解应用系统的相关信息。本文的安全架…	根据调研问卷，可以大概了解应用系统的相关信息。本文的安全架
根据系统架构图，可以了解应用的基本结构。前端有 APP，Web…
构设计，关注的是通用安全风险，对于业务内部逻辑风险不做展开。
202 	203
|  | ●…移动 APP |  |
|---|---|---|
|  |●…移动 APP |证券行业应用安全架构设计实践 |
|  |●…移动 APP | |
| 首先讲一下本机构的网络区域划分：有互联网接入区 DMZ、核心 |●…移动 APP | |
| 生产网、办公网、开发测试网、业务网，其他还有托管机房区、外 |●…Web 页面 | |
| 联业务区、客户接入区、AWS 等。 |●…Restful…API | |
	●…管理页面入口 
下面进行攻击面分析。基于部署架构图，简单画了数据流图。	●…业务人员访问入口…	●…DUBBO 微服务间调用接口	●…敏感数据●…数据存储，如数据库、redis	●…第三方系统调用
	这么多的攻击面，如何识别威胁及消减风险，我们主要靠安全专家 	经验、长期积累而形成的安全威胁库。我们并没有严格的区分安全 	需求及威胁建模，这个过程我们称之为安全需求分析与架构设计，	也就是轻量级威胁建模。根据业务场景，与安全威胁库中威胁模式 可以看出，外部实体，有通过互联网 APP 及 Web 访问的外部客户，	匹配，输出安全解决方案。
也有业务人员，还有 IT 运维人员，以及日志平台及第三方系统。
针对本案例的金融 APP 的安全设计，选择部分进行详细描述。
数据流图目的，主要是为了进行攻击面分析。
1）结构安全。
首先是系统分层，系统应该采用分层部署的结构，不同的组件按功 
能和重要程度分布于不同的网络区域中。能和重要程度分布于不同的网络区域中。
	生产环境中，需要与外网（互联网）发生通信的主机，一般位于 	DMZ 层，禁用在生产网的核心层与外网直接通信。应用部署在 	核心网，需要在 DMZ 部署接入层服务，禁止直接 DMZ 区部署 	nginx 反向代理接入。从安全风险角度，Web 服务部署于 DMZ 区，…	在 DMZ 区进行 http 协议卸载、参数过滤及协议转换，DMZ 到核
从图中，可以分析出系统主要攻击面有：
心网使用 tcp 协议，这样，可以防止攻击 payload 直接打到核心网。
204 	205
证券行业应用安全架构设计实践
运营管理后台，业务运营人员采用专用的业务终端通过业务网进行 访问。IT 人员通过堡垒机进行系统运维。后台管理页面禁止直接 开放到办公网访问（因为办公网可以访问互联网，员工存在被网络 钓鱼导致机器被远控风险，从而通过后台管理页面漏洞侵入核心c) APP 第三方代码安全。移动应用开发过程中，出于功能需求等 原因，开发人员不可避免会集成一些其他第三方提供的代码，如 SDK。这些第三方代码未经测试和评估就直接嵌入到应用中 直接使用，容易出现不可预料的后果。一方面是第三方代码的
网）。	安全性未经测试，可能存在安全漏洞被攻击者利用，从而威胁
整个应用的正常使用。另一方面，第三方代码额外实现了冗余
系统使用的第三方组件如 tomcat，应采用无安全漏洞版本。部署 	功能或者申请多余的特权，可能造成用户隐私信息泄露，或者