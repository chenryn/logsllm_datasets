S_E_Oblako
S_E_Oblako
PENETRATION TESTING
STEP BY STEP
GUIDE
Second Edition
Radhi Shatob
S_E_Oblako
Copyright © 2021, Radhi Shatob
All rights reserved. No part of this book may be reproduced in any
form or by and electronic or mechanical means, including
information storage and retrieval systems, without permission in
writing form the publisher, except by reviewers, who may quote
brief passages in review.
ISBN 978-1-9995412-5-5 (Electronic Book)
ISBN 978-1-9995412-4-8(Book)
S_E_Oblako
This page is left Blank
S_E_Oblako
Contents
1. Lab Setup preparations
1.1. Lab setup:
1.2. Install VirtualBox software
1.3. Installation of Attacker Machine (Kali Linux)
1.4. Installation of Victim-1 Machine (Metasploitable)
1.5. Installation of Victim- 2 machine (windows 10)
1.6. Install VBox Extension Pack and Guest addition
1.7. USB Wi-Fi Adpator
2. Wi-Fi Penetration Testing
2.1. Putting card in monitor mode
2.3. Sniffing specific AP
2.4. De-authentication attacks
2.5. WEP encrypted networks crack
2.6. WPA Encrypted Network crack
2.7. EAPOL protocol
2.8. Fake access Point
2.9. Securing Wireless Network
3. Post Connection Attacks
3.1. Network discovering
3.2. Using NMAP tool
3.3. Man in the Middle Attacks (MiTM)
3.4. ARP Spoofing
3.5. MiTM with Bettercap tool
3.6. MITM DNS Spoofing
3.7. MiTM Java code injection
S_E_Oblako
3.8. MIMT Attack in Real Network
3.9. Detecting ARP storms by Wireshark
3.10. Preventing ARP Poisoning
4. Gaining Access (Server Side)
4.1. Server-Side attacks
4.2. Exploiting Basic vulnerability
4.3. Code Execution vulnerabilities
5. Vulnerability Scanning
5.1. Basic Vulnerability detection methods
5.2. Vulnerability Scanning software
5.3. Vulnerability Database
5.4. Vulnerability Management with Nexpose
5.5. Starting and Configuration Nexpose
5.6. Nexpose Reports Analysis
5.7. Other Nexpose functions
6. Gaining Access (Client Site Attacks)
6.1. Using Veil Evasion Framework
6.2. Installing Veil 3.1 In Kali Linux
6.3. How Anti-Malware work
6.4. Listening to incoming connectios
6.5. Delivery Method
6.6. Control hacked Devices with Kage Tool
6.7. Embedding Malware into PDF and JPG files
6.8. Protecting against smart delivery methods
7. Post exploitation
7.1. Metasploit meterpreter commands
7.2. Process impersonation
S_E_Oblako
7.3. Controlling Victim file system
7.4. Maintaining Access
7.5. Key-logger and screenshots
8. Social Engineering
8.1. Maltego
8.2. Email spoofing
9. Browser exploitation
9.1. Using BeEF to send backdoor
9.2. Hooking up a Mobile phone
10. Detecting Trojans
10.1. How Trojans works
10.2. Trojan Types
10.3. Protect against Trojans
10.4. Manual Trojans detection
10.5. Using Sandbox
11. Gaining access in real network
11.1. Configuring the router
12. Website penetration testing
12.1. Website (web Applications) components
12.2. Website Information Gathering
12.3. Discovering websites in the same Server
12.4. Subdomains
12.5. Finding Files and Directories
12.6. File uploads, code execution and file exclusion
12.7. Preventing above vulnerabilities
13. SQL injection
S_E_Oblako
13.1. Discovering SQL injection
13.2. Injecting a code in webpage
13.3. Discovering SQL injection in GET
13.4. Reading Database Information:
13.5. Read/write files using SQL vulnerability
13.6. Using Sqlmap tool
13.7. Protection from SQL injection
14. Cross Site Scripting XSS
14.1. Discovering XSS vulnerabilities
14.2. Stored XSS vulnerabilities
14.3. Injecting BeEF hook as a stored XSS
14.4. Preventing XSS Vulnerability
15. OWASP ZAP Web Site Penetration testing tool
15.1. Scanning Websites using OWASP-ZAP tool
16. Mobile phone penetration testing
16.1. Introduction
16.2. Mobile phone attack vectors
16.3. Outcomes of attack vectors
16.4. Mobile phone attack lifecycle
16.5. App Stores
16.6. Introduction Android OS
16.7. Android Authentication (screen lock)
16.8. Introduction to Apple iOS
16.9. iOS Authentication (screen lock)
16.10. Mobile Application Penetration Testing
17. Appendix 1: Realtek Driver update
18. Appendix2: Glossary
S_E_Oblako
Index of Pen-Tests Exercises
Exercise 1: Putting wireless card in Monitor mode
Exercise 2: Over the air wireless data capture
Exercise 3: Sniffing Specific Access Point
Exercise 4: De-authentication Attack
Exercise 5: WEP Encryption cracking procedure
Exercise 6: Cracking WPA using WPS feature
Exercise 7: Cracking WPA by capturing handshaking
Exercise 8 Creating Fake Access point using Wifipumpkin3
Exercise 9: Using Network Discovery tool netdiscover
Exercise 10: Using Network discovery tool arp-scan
Exercise 11: using Nmap
Exercise 12: ARP Spoofing using arpspoof tool
Exercise 13: Installing Bettercap tool
Exercise 14: ARP Spoofing with Bettercap
Exercise 15: Intercepting HTTP traffic with Bettercap
Exercise 16: Automating Bettercap attacks using Caplets
Exercise 17: SSL Stripping
Exercise 18: DNS Spoofing
Exercise 19: MITM -Java Code injection
Exercise 20: Detecting ARP storms with Wireshark
Exercise 21: Basic Information Gathering using Zenmap
Exercise 22: Exploit RSH client vulnerability
Exercise 23: Exploit Ftp vulnerability
Exercise 24: Exploiting Code Execution Vulnerability
Exercise 25: Vulnerability Management – installing Nexpose
Exercise 26: Running Nexpose
Exercise 27: Nexpose Analysis and Report Generating
Exercise 28: Client-Side Attacks – Installing Veil Evasion
Exercise 29: Creating Backdoor malware
Exercise 30: Setup Hacker machine to listen to Incoming connection
Exercise 31: Malware Basic Delivery Method
Exercise 32: Creating Encrypted backdoor
Exercise 33: Using Metasploit GUI Kage
Exercise 34 Embedding Malware into PDF file
Exercise 35 Embedding Malware inside image file
S_E_Oblako
Exercise 36: Post Exploitation
Exercise 37: Controlling victim file system
Exercise 38: Maintaining Access using persistence mode
Exercise 39: Setting up Key-logger
Exercise 40: Running Maltego Tool
Exercise 41: Email Spoofing using Sendinblue server
Exercise 42: Browser Exploitation with BeEF
Exercise 43: Hacking Windows 10 using BeEF
Exercise 44: Gaining Access in Real Networks
Exercise 45: Web Site Information gathering
Exercise 46: Discovering Subdomains with Knock Tool
Exercise 47: Finding Files and Directories
Exercise 48: File Upload
Exercise 49: Remote Code Execution
Exercise 50: File Inclusion
Exercise 51: Remote File inclusion
Exercise 52: Logging to Database
Exercise 53: Breaking a webpage
Exercise 54: Injecting Code into Webpage
Exercise 55: Login as Admin without a password
Exercise 56: Discovering SQL injection vulnerability with GET
Exercise 57: Reading and Extracting Data from Website
Exercise 58: Reading and writing files using SQL vulnerability
Exercise 59: Using Sqlmap tool
Exercise 60: Example of Reflected XSS
Exercise 61: Example of Stored XSS
Exercise 62: Injecting BeEF hook as stored XSS
Exercise 63: Running OWASP ZAP
Exercise 64: Start Website scan
Exercise 65: Scan Analysis
Exercise 66: Setting up Android testing environment
Exercise 67: Connecting a Physical android Phone to ADB tool
Exercise 68: Downloading a file or folder from Phone to PC
Exercise 69: Installing APK files into Android Virtual machine
Exercise 70: Getting Mobile App username and password
Exercise 71: Mobile App SQL injection
Exercise 72: Reading SQLite database in Android Phone
S_E_Oblako
Exercise 73: Hacking Real Android phone
S_E_Oblako
Preface
Penetration testing is the practice of penetrating networks, systems, and
applications to find vulnerabilities that hackers may use to infiltrate the
system and cause damage to the business. Penetration tests require hackers,
either a single skilled hacker or a team of hackers, to probe the network and
systems to access to the business data and information. The business’s
information security department is then informed by official report of the
vulnerabilities.
To meet some information security standards, businesses are required to
perform penetration tastings on a regular basis in order to keep certified by
the standard. For example, Payment Card Industry Data Security Standard
(PCI DSS) requires a yearly penetration test to be done by the businesses to
maintain certification. The demand for skilled penetration testers extremely
high and it will be higher in the coming years.
This book is intended for people who have no prior knowledge of penetration
testing, ethical hacking and would like to enter the field. This is not a
theoretical book but a practical step by step guide to penetration testing that
teaches the techniques and tools that real hackers use to hack networks and
exploit vulnerabilities. The guide is based in Kali Linux and other tools that
real hackers use. This guide assumes that readers have no knowledge Kali
Linux and teaches you through penetration testing exercises. This guide
covers the all the phases of penetrations testing starting from reconnaissance,
scanning, gaining access, maintaining assess and covering tracks. The main
feature of the guide will be 73 Pen-tests exercises that cover wireless and Wi-
Fi penetration testing, client side penetration testing, server side penetration
testing, creating and delivering malware, social engineering, email spoofing
,complete web penetration testing and Mobile phones penetration testing. I
hope you find this guide helpful and insightful as you learn more about
penetration testing.
Radhi Shatob
S_E_Oblako
Who is this Book for?
This book is a hands-on guide, it is for anyone interested in Information
security and wanted to know how hackers hack systems, what tool they use
and how they do information gathering about their target. This book is aimed
at people who are new to the world of ethical hacking and penetration testing,
it is for those with little or no previous experience and not sure where to
begin. However, this book is also good for Information Security Managers
and Information Technology managers in general who want to understand
what the threats to their systems, what tools hackers use and what measures
they need to take in order to protect their systems and networks.
This Book goes straight to the point of hacking and does not go in detail in
the theoretical aspects, it is a practical hands on guide that explains in easy to
follow instructions, how to setup up testing environment and how to do each
penetration test. It lists the steps and guide the user about the commands
needed and show the expected results in screen shots for each exercise. At the
end of this book not only you will gain the knowledge about how to perform
penetration testing, but also you will know how to use Kali Linux and Linux
in general, because the book assume the reader has no prior knowledge in
Kali Linux which the main operation system of Penetration testing.
S_E_Oblako
White Hat ethical hacker Ethics
This book teaches you to be a penetration tester in other word a white hat
ethical hacker. The exercises listed in this book can be very harmful and
illegal to do in real environment without prior permission to conduct such
activities against any information system, network or normal client who use
computing devices.
Do not be malicious.
Do not use skills learned in illegal activities.
If you are doing Penetration testing for external Client, keep all
data gathered during the penetration testing confidential and do
not not reveal the Data to anyone without the consent of the
client.
Do not use computer to harm or interfere with other people’s
work.
Neither the author of this book, nor the publisher encourage the misuse of the
penetration testing exercises listed in this book.
S_E_Oblako
1
LAB SETUP
This chapter will guide readers in setting up the environment, so
they will be able to do all the Exercises in the following chapters,
assuming you have a laptop with minimum 8G RAM and 64 G
Disk space (Windows or Mac). The chapter will guide you through
the installation of Oracle Virtual Box software, Kali Linux virtual
machine, Windows 10 virtual machine and Ubuntu Linux machine
that has vulnerabilities, also the guide will explain the Wireless
card setup with the host and Kali Linux.
S_E_Oblako
1. Lab Setup preparations
To do all the labs in this training course, you need to have the following:
Windows or mac (host machine) with minimum 8G Ram (16G
RAM is recommended)
Minimum 80G disk space. (250G is recommended for the host
machine)
The lab will depend on installation of three virtual machines.
1.1. Lab setup:
- Laptop (host machine)
- Installation of VirtualBox
- Installation of Attacker Virtual machine Kali Linux
- Installation of victim machine 1: Virtual Metasploitable (Ubuntu Linux
machine)
- Installation of victim machine 2: Virtual Windows 10
- Need External USB Wi-Fi card that compatible with host machine and
Kali Linux to do wireless penetration labs
1.2. Install VirtualBox software
- You will need Windows or Mac machine with minimum 8G Ram and
64G Free disk space.
- Download VirtualBox software from the following link:
https://www.virtualbox.org/wiki/downloads
- Install VirtualBox software.
Note
Virtualization must be enabled in the laptop BOIS to run 64-bit virtual
machines inside VirtualBox.
1.3. Installation of Attacker Machine (Kali Linux)
- To install Kali Linux image, go to (https://www.kali.org/downloads/).
- Download Kali Linux 64-bit VirtualBox (Image for Virtual Box).
- Double click the downloaded file and it will install itself under VB
software.
- Give Kali 4G Ram and at least 20G Disk space.
1.4. Installation of Victim-1 Machine (Metasploitable)
S_E_Oblako
Metasploitable is a vulnerable Linux distro made by Rapid7. This OS
contains several vulnerabilities. It is designed for pen testers to try and hack.
Rapid 7 offer this software for free for the Penetration testers community,
they just need to register with Rapid 7 and then download the Metasplotable
virtual machine.
You can download Metasploitable from the following link:
https://information.rapid7.com/metasploitable-download.html
- to install Metasploitable in VirtualBox (Vbox):
In Vbox click on New.
Give it a Name, Type= Linux, Version= Ubuntu 64k.
Next and give it 512 M Ram or 1 G ram then Next.
Choose “Use an existing virtual hard disk file “.
Go to the Metasploitable file location and choose .vmdk file.
1.5. Installation of Victim- 2 machine (windows 10)
We will also install a normal windows 10 machine as a victim, we will be
running our attacks against this machine.
Microsoft has released several windows virtual machines that can be
downloaded from the following link
- https://developer.microsoft.com/en-us/microsoft-edge/tools/vms
- download Win10.0va file.
- right click the file and choose open with Virtual box.
- Agree on import setting.
1.6. Install VBox Extension Pack and Guest addition
After the installation of the three machines, we need to install VirtualBox
extension pack that allow you to share files between host machine and virtual
machines and resize of the virtual machine screen and other options that
make working with virtual machines easy.
download extension pack and install from
https://www.virtualbox.org/wiki/downloads
After finishing installing Virtual machines and for Better integration with
host desktop and mouse install VB guest addition, so the following link for
S_E_Oblako
more info about installing guest addition.
https://docs.oracle.com/cd/E36500_01/E36502/html/qs-guest-additions.html
for Kali Guest addition follow the following procedure:
In Kali machine open Terminal and enter the following commands:
#apt purge virtualbox-guest-x11
#apt autoremove --purge
#reboot
#apt update
#apt dist-upgrade
#reboot
#apt update
#apt install -y virtualbox-guest-x11
#reboot
Note
Oracle keep changing the location of the Extension Pack and Guest Edition in
their website.
S_E_Oblako
Configure NAT in Virtual Box
- Normally Virtual machines are isolated from each other and cannot
directly communicate with each other.
- Create NAT network in VirtualBox to allow virtual machines
communications.
- In Windows or MAC to create NAT network go to Virtual Box
File/Preferences/ Network/add New NAT Network.
- Right click the VMs, go to setting, Network, and choose NAT network
as follow
S_E_Oblako
Do this step for all machines.
Updating Kali Linux
- Open VirtualBox and start Kali Linux and login as:
- User: kali
- Password: kali
- Open terminal and type the following commands:
#sudo apt-get update
#sudo apt-get install terminator (terminal software more flexible than the
build in terminal software)
#sudo apt-get upgrade
To avoid typing sudo each time you enter a command, login as root but first
you should setup password for the root account, the following procedure