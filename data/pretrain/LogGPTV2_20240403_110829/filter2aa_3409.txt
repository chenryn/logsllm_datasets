老司机独家代码审计姿势
                                        --色豹
目录
代码审计介绍
代码审计流程思路
web应用代码审计
IOT固件代码审计
1
2
3
4
代码审计介绍
代码审计（Code audit）是一种以发
现程序错误，安全漏洞和违反程序规
范为目标的源代码分析。
什么是代码审计？
代码审计工具
Fortify SCA
Checkmarx CxSuite
RIPS
  厂商
Fortify Software
Checkmarx
rips
  支持语言
Java,JSP,ASP.NET,C#,
VB.NET,C,C++,COB
OL,
ColdFusion,Transac
t-SQL,
PL/SQL,JavaScript/
Ajax,
Classic,ASP,VBScript,
VB6,PHP
JAVA、ASP.NET
（C#、VB.NET）、
JavaScript、Jscript、
C/C++、APEX
PHP
  风险种类
400种
300种
参考CWE  
  报价
100万/软件
70万/软件
免费版
  性价比
中
高
高
代码审计的意义
提高应用
软件源代
码质量
避免应用
系统潜在
后门危害
提升系统
本身的安
全性
挖掘渗透
测试触及
不到的地
方
代码审计流程思路
代码审计思路
根据敏感关键字，
回溯参数传递过程
查找可控变量，
正向追踪变量传递过程
寻找敏感功能点，
通读功能点代码
直接通读全文代码
代码审计思路
敏感关键字
一段简单的代码：
敏感关键字
一段复杂的代码：
正则表达式：
\beval\(\$_(GET|POST)
敏感关键字
一段复杂的代码：
正则表达式：
\beval\(\$_(GET|POST)
可控变量
一切用户可控的输入都是有害的
$_GET，$_POST，$_REQUEST，$_COOKIE
用户可控的变量
可控变量
一段简单的代码：
正则表达式：
\becho\(\$_(GET|POST)
敏感功能
文件上传功能，GETSHELL
上传黑白名单,content-type，上传大小
敏感功能
敏感功能
if (file_exists("upload/" . 
$_FILES["file"]["name"]))
      {
      echo $_FILES["file"]["name"] . " 
already exists. ";
      }
    else
{ 
move_uploaded_file($_FILES["file"]
["tmp_name"],"upload/
" . 
$_FILES["file"]["name"]);
      echo "Stored in: " . "upload/" .      
$_FILES["file"]["name"];
      }
敏感功能
       move_uploaded_file
   将上传的文件移动到新位置的函数
审计移动前函数的过滤
通读程序代码
通读程序代码
熟悉整体架构
覆盖逻辑漏洞
掌握程序流程
通读代码优点
通读程序代码
代码量庞大
审计时间过长
投入≠产出
通读代码缺点
Web应用代码审计
过滤不完善
过滤不完善
过滤不完善
画蛇添足
画蛇添足
1, 绕过过滤，selselectect-
>select
2,没有过滤\，虽然前面用
了addslashes,
    但是后面又把单引号置
空了
3, '\-->addslashes-->\'\\-->
单引号置空-->\\\
4, 必备条件：两个连续的
可控点。
    第一个引入’\，第二个
参数payload
画蛇添足
实际执行SQL语句
补丁的绕过与修复
补丁的绕过与修复
Payload：?dir=..././http/..././config/config_db.php
补丁的绕过与修复
Payload：?dir=.....///http/.....///config/config_db.php
补丁的绕过与修复
                           dir参数必须以http开头
Payload：?dir=http/.....///.....///config/config_db.php
补丁的绕过与修复
使用strpos函数查找./首次出现的位置，windows用..\
Payload：?dir=http\..\..\config\config_db.php
补丁的绕过与修复
放弃修复，删文件！！！
IOT固件代码审计
工欲善其事,必先利其器
firmadyne
https://github.com/firmadyne/firmadyne
firmware-analysis-toolkit
https://github.com/attify/firmware-analysis-toolkit
Firmwalker
https://github.com/craigz28/firmwalker
Binwalk
https://github.com/ReFirmLabs/binwalk
裸奔的参数
裸奔的参数
不懂漏洞根源
Bypass:
%0aAUTHORIZED_GROUP=1
收集用户隐私
固件后门
谢
谢
观
看