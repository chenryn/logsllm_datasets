隐写术：数字隐写技术可以利用一个文件、消息、图片、或视频，来隐藏一个文件、消息、图片、或视频。僵尸主机可以利用这种技术，下载一个看似无害的图片文件，但实际上包含了C&C服务器发送给僵尸主机的复杂的消息流。这个图片中可以存储任何数据。实际上，这种来自于看似正常的网络浏览流量、而且又经过了隐藏的数据，很难被探测到。
将通信隐藏到合法服务中：和社交网络相似，如Dropbox，Pastebin，Imgur和Evernote，都可以隐藏僵尸网络的操作。就Dropbox来讲，C&C服务器的地址可以隐藏到Dropbox帐户的文件中。在Imgur下，通过“Rig
exploit
kit”工具，受害人可以下载某种形式的勒索软件的数据。勒索软件可以将受害人机器上的文件和收集的信息进行加密，并重新打包成一个.png格式的文件，然后上传到Imgur的相册中，C&C服务器再从相册中取出数据。
全球C&C服务器分布图：
上图显示：位于美国的C&C服务器占到总数的30.09%，其次是荷兰，占到8.85%。
**一、Cyren的研究：对C &C通讯的分析**
Cyren对Gatak僵尸网络的恶意软件进行了分析研究，发现它使用了一个复杂的加密协议。下图是一个已经解密的僵尸主机发送给C&C的数据包，目的是为了报告僵尸主机的状态：
如上图，位置按16进制表示：
从第0x00开始的16个字节：是shellcode的密钥ID。
从第0x10开始的04个字节：是4字节的CRC校验值。
从第0x14开始的16个字节：是shellcode的16字节随机生成的命令ID。
从第0x24开始的16个字节：是shellcode的16字节随机生成的功能ID。
第0x34字节：消息的字节头。
从第0x35开始的08个字节：消息的8字节会话ID，在首次和C&C服务器通信时会初始化为0。
第0x3D字节：僵尸主机的命令标志(后面会讲到)。
第0x3E字节：成功/错误的标志，0表示成功。
第0x3F字节：信息标志，如果信息长度大于1024字节，设置为1。
从第0x40开始的04个字节：信息的长度。
从第0x44开始：信息本身。
僵尸主机的命令标志信息如下图(上图第0x3D字节)：
下图是一个已经解密的C&C发送给僵尸主机的数据包：
从第0x00开始的04个字节：4字节的CRC校验值。
从第0x04开始的16个字节：16字节的C&C服务器的命令ID。
第0x14字节：消息的字节头。
从第0x15开始的8个字节：消息的8字节会话ID。
第0x1D字节：僵尸主机的命令标志。
**二、幽灵域名：规避检测技术**
当恶意软件样本被多个反病毒厂商检测到时，C&C服务器的URL就不能再用了，该URL将会被很多WEB安全系统所屏蔽，导致僵尸主机无法解析出URL的地址，无法访问到C&C服务器。显然，这是僵尸控制者面对的重要问题。那么怎么办呢？使用一种技术更改域名，这种技术被Cyren的研究人员称为“幽灵域名”。即在僵尸网络通信的HTTP域名字段中插入未知的域名，包括注册和未注册的，可以欺骗很多WEB安全系统和URL过滤系统。
例如，幽灵域名怎么作为网络犯罪分子规避的方法，Cyren分析师观察恶意软件对www.djapp.info域名进行DNS解析，IP地址是52.1.45.42。
Cyren和其他几个安全厂商将这个域名标记为一个恶意的域名，并将它作为C&C的地址阻止了。结果就是，在受这些厂商保护的网络中，所有对这个域名的HTTP请求都被阻止了。
然而，当其他机器用DNS解析了这个IP地址后，对一个新感染的僵尸主机向C&C发送的数据进行分析，显示出以下的HTTP传输。这是在通知C&C服务器，有一个新的机器成功被感染了。
上图显示，使用了不同的域名来连接52.1.45.42(多个域名指向同一个IP，之前的一个域名已经被屏蔽了)地址。
目的地址是已知的恶意服务器，但是在HTTP请求的域名字段中使用了完全不同的域名–Cyren称为“幽灵域名”。在这个例子中，用于欺骗的幽灵域名是“events.nzlvin.net”和“json.nzlvin.net”，都指向52.1.45.42。
这个技术可以从以下几个方面帮助僵尸网络控制者：
1.WEB安全系统和URL过滤系统不会阻止幽灵域名，因为它们只会阻止原始的被解析的域名(在这个例子中只会阻止www.djapp.info)。
2.当收到这个“编码的”消息(说明主域名被屏蔽，僵尸主机使用了幽灵域名才发出了这个消息)时，僵尸控制者可以操纵服务器发送一个适当的响应。例如，给僵尸主机发送一个响应包，让它下载另一个特殊格式的恶意软件，并执行。
3.通常，安全厂商只会屏蔽C&C的域名，和C&C的URL有关的IP地址不会被屏蔽，因为一个服务器上可能同时存在合法的网站、和有恶意行为的网站，如果将这个IP整个屏蔽，会造成一些合法的服务无法访问到。
在那段时间，Cyren更新了自己的URL信誉数据库，Cyren的分析员检查了是否有安全厂商能检测到“events.nzlvin.net”和“json.nzlvin.net”两个幽灵域名，使用上面提到过的的HTTP请求。多个安全厂商可以将“www.djapp.info”标记为恶意域名，但是没有厂商能标记出幽灵域名。
在接下来的几个小时中，Cyren的沙箱阵列不断积累了关于该恶意IP的数据，在这个过程中，发现了一长列和它有关的幽灵域名。
尽管它们中的有些是注册的域名(创建于恶意软件出现的那几天)，有些没有注册的域名。
**三、自卫：探测你网络中的僵尸**
俗话说的好，“预防为主,治疗为辅”，这也同样适用于互联网安全。如果将避免感染放在首位，那显然是理想状态，实际很难实现，因为各种规避技术总是能愚弄许多安全系统。
为了找到内部的僵尸主机，最好遵循以下建议—为了探测一个僵尸主机，你应该寻找僵尸主机和C&C服务器的双向通信，有几个警告标志和方法，一个企业可以用这些找到存在的僵尸主机：
检查邮件流量，如果由你的公司发送的邮件被收件公司或ISPs拒绝，这可能预示着从你公司发出的邮件被列入了黑名单，可能是由于你网络中存在僵尸主机，从事了垃圾邮件活动。
利用公司防火墙。这可以检测到那些可疑的端口行为或未知的网络传输。
安装一个入侵防御系统。这类系统具有内置的开放源代码或检测僵尸主机流量的厂商自定义的规则。
使用Web安全/网址过滤系统。这类系统，如Cyren的WebSecurity,能阻止僵尸主机和C&C的通信，并帮助管理员识别出僵尸主机的位置，从而清除它。
考虑在你的网络上创建一个“暗网”。通过在你的局域网中创建一个子网，并记录访问这个子网的所有日志，通常不应该有流量被路由到它里面。你可以看一看有哪些计算机不听从你正常的网络设置；例如，这些计算机可能正在扫描他们打算感染的网络上的节点。
使用厂商专门检测僵尸主机的安全解决方案。有厂商专门从事僵尸主机的检测，并依靠行为分析，使用日志分析和流量分析相结合的方法。
一旦检测到异常的流量，下一步做的就是追查源头。网络安全解决方案提供了最大的可能来发现谁损害了你的网络。首选方案应该可以给用户提供简化识别过程的办法，特别是当用户在网络地址转换（NAT）设备之后。
**四、Cyren Globalview威胁趋势|2016年第3季度**
“Cyren Globalview”季度安全指数已经发布，包括网络威胁的主要类型和全球趋势指标。这些指标是根据“Cyren
Globalview”云安全数据生成的，它处理了超过6亿用户的WEB和邮件事件。
根据Cyren云安全的监控，第三季度和第二季度的数据相比，钓鱼URL增长了22%，第三季度新增的钓鱼网站大约有1百万个。而WEB恶意软件的URL数量下降了10%，检测到的特殊恶意软件样本的总数增长了20%，特殊安卓手机恶意样本增长了32%，本季度平均每日邮件恶意软件的数量增长了59%，主要是由于Locky勒索软件在第三季度每周有5天都在持续活跃中。
具体数据如下图所示：
上图显示的是钓鱼威胁指数：在第三季度增长了22%。
上图显示的是WEB恶意软件的URLs威胁指数：在第三季度减少了10%。
上图显示的是垃圾邮件威胁指数：在第三季度增长了2%。
上图显示的是恶意软件威胁指数：在第三季度增长了20%。
上图显示的是Android恶意软件威胁指数：在第三季度增长了32%。
上图显示的是邮件恶意软件威胁指数：在第三季度增长了59%。
**  
**
**传送门**
* * *
[**【技术分享】2017僵尸网络研究报告（上）**](http://bobao.360.cn/learning/detail/3412.html)