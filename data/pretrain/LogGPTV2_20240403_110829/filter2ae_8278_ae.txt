在日志中，我们也需要统计分析，虽然微观的分析，具体的事件线索，从日志中发现0day，从流量中捕获异常行为这些来得更直接，但是宏观上的安全分析一样具有实际意义，虽然我们技术人员对各种花哨的大屏嗤之以鼻，但是如果没有宏观的安全状态，又如何开始深入，先广后细方能掌握全局。我们可以根据不同的场景进行思考，哪些指标是值得我们统计的，哪些统计分析是具有较大的价值与实际意义的，是否可以通过专家经验完成额外的统计分析需求。一旦理解清楚这些，我们想要开始进行统计分析便是一件非常简单的事情，下面的统计图便是我对一个仅具备初级研发能力不了解系统日志的小组成员进行培训后所完成的对Windows系统日志进行统计后的结果：
要进行统计分析这一步骤，最关键的步骤在于对统计分析需求的调研，而数据定义、数据解析、增量解析、聚合搜索、可视化等都是建立在此步骤，如对此过程有兴趣者，找机会另起一篇文章。
### 3、机器学习
    其实这是一个并不太想讲到的主题，因为在国内安全行业中，大家都在提自己具有人工智能（可能也包括我们自己），但实际具有效果，实现了真正的安全价值的，其实很稀有，行业现状是大家更多的是利用这个”新型“、”前沿“的技术来进行镀金与推广。
    那么什么是机器学习呢？这个技术到底能做到什么？它的优缺点是什么？它又是如何和安全扯上关系的？..
翻了翻自己的笔记看到，作者本人正真开始接触机器学习是在去年的6月份，在此之前也仅仅停留在知道这个名词。机器学习的专业定义：
    机器学习(Machine Learning, ML)是一门多领域交叉学科，涉及概率论、统计学、逼近论、凸分析、算法复杂度理论等多门学科。专门研究计算机怎样模拟或实现人类的学习行为，以获取新的知识或技能，重新组织已有的知识结构使之不断改善自身的性能。
    它是人工智能的核心，是使计算机具有智能的根本途径，其应用遍及人工智能的各个领域，它主要使用归纳、综合而不是演绎。
其实要理解机器学习还是有点复杂的事情，我们来举个教科书上的例子：  
我现在要对花瓣进行分类，人之所以能区分，大部分依赖的对某一事物的记忆。而机器学习的逻辑是，先基于数据进行学习，首先花瓣的宽度与长度代表是区分两种花瓣的特征，然后花瓣类别表示满足此特征则是某类，大家思考一下如果就有两种花瓣宽度长度都有一样，但是就是不是一种花，它们可能颜色不一样，可能有些长在树上，有些是长在地上，其实这个思考的过程，便是用人的思维进行特征提取，找出对学习出类别影响较大的因素，还有一些时候，我们也无法得知那些特征是对类别有较大的影响怎么办，这个时候就需要接触到特征选择了，特性选择的作用是衡量该特征和响应变量之间的关系的一种计算方法，有兴趣的同学可自行学习这里不再展开。
当我们准备好上述数据，然后尝试将数据放到直角坐标系中，宽高数据构成了特征向量，平面上的点称之为特征点，由点构成的空间称之为特征空间，通过观察，我们很容易在特征空间中画出一条直线进行区分，然后便能得到公式:0.5
_x1 + x2 - 2 = 0，最后我们得到分类函数g(x1,x2)：  
山鸢尾：:0.5 _ x1 + x2 - 2 ≥ 0  
变色鸢尾：0.5 * x1 + x2 - 2 ＜ 0
此时分类问题就变成了一个数学问题，我们只需要将花瓣的宽高输入到函数便能得到花瓣的类型，但实际情况中，特征点在特征空间中的位置分布非常复杂，因为现实数据中会存在多种可能性，采用观察和尝试来得到分类函数几乎是不可能的，也是没有效率的，因此我们需要通过一些方法来自动学习并获得这个分类函数，这个便是对机器学习最简单的理解。通过输入数据进行学习，通过学习得到模型，而这个模型其实就是一个数学公式，也就是分类函数。  
~~PS：此处只是为了帮助初学者初步理解机器学习，可能存在不恰到之处，请初学者按此理解后保持质疑，不断学习，不断更正~~
为了了解机器学习所涉及到的知识领域，我对一本书进行了提词，并希望以此来宏观的了解所有相关的知识点来进行有计划的学习，如图：  
那么机器学习在安全中有哪些真实场景呢？根据兜哥的一系列实践过程，场景如下：
> 异常主机操作行为  
>  检测恶意Webshell  
>  检测DGA域名  
>  检测网站CC攻击  
>  验证码识别  
>  检测Java溢出攻击  
>  识别正常用户与黑客  
>  识别XSS攻击  
>  识别僵尸网络  
>  发现疑似被盗账号  
>  检测撞库行为  
>  检测疑似刷单行为  
>  检测敏感转账行为  
>  检测Web攻击行为  
>  检测内部敏感行为
兜哥在《Web安全之机器学习入门》中进行了大量实践，但是有读者却在知乎中评论到”没有对具体的算法和公式进行详解“，而我想说的是，实践缺乏了理论的支撑，导致初学者只能强行照搬，而无法灵活变通，无法将具体的思路应用到实际场景中，还有就是很多前置知识掌握不足，导致无法真正的应用机器学习实现安全相关的需求。  
对于想要入门机器学习的同学来说，建议先学习打好基础底子，弄清楚机器学习的基本概念，知道什么是有监督学习、无监督学习、特征点、特征空间、向量、张量等基础知识。然后就是了解机器学习的各个算法的优缺点。  
对于想要实践学习机器学习的的同学可以参考作者之前使用SVM进行XSS识别的一个小Demo，可帮助大家快速体验机器学习的魅力之处，Github地址：
~~刚学机器学习的时候写的代码，Python水平一般，基本没学过，当时直接照葫芦画瓢的~~
### 4、数据挖掘
    数据挖掘最早我对它的定义是很模糊的，也并无太多热度，然而后来经过大量研究与实践后，我发现我对此的热衷程度甚至要高于机器学习，原因很简单，它无需安全经验，无需打标签，可以实现探索性的分析，实现对数据进行”未知的分析“，甚至不需要具有任何已知经验，仅需要简单的将数据放入挖掘算法进行测试，便能得到惊喜。
     （PS：机器学习与数据挖掘其实相同知识领域很多，其本质区别在于目的不同，字面解释就是一个是为了学习，一个是为了挖掘）
     数据挖掘的专业定义是：数据挖掘（Data Mining，简称DM），是指从大量的数据中，挖掘出未知的且有价值的信息和知识的过程
      数据挖掘主要有四类任务：异常检测、聚类分析、关联分析、预测建模，具体场景如：
      ”对网站访客进行异常检测，找出具有异常行为的访客“
      ”对访问人群进行聚类，将行为相似的访客聚为一类“
      ”对系统日志、Web日志进行关联，挖掘系统与Web之间的关联模式“
      ”根据历史日志中的攻击行为，预测攻击者在未来的攻击力度”
下图即为采用了聚类算法进行人群划分的效果，我们在数据挖掘的基础上进行二次分析，从而成功的将人群划分为不同的类型，进而实现了无规则挖掘攻击者。
数据挖掘在安全领域最大的作用便是，在不具备专家经验或者安全经验没有覆盖到的地方进行挖掘，帮助我们打破常规思维进行数据分析，当然它还有非常多的作用，比如，我们可以通过挖掘找到所有非正常的请求，然后通过规则找到所有具有攻击特征的请求，然后将两者进行交叉比对，无论比对结果如何，我们都有所收益，可能你能得到一些规则未覆盖的攻击，或者你能找到自己规则写得不足的问题，又或者你能直接发现0day，再或者你规则写得特别全，但是你发现有些异常请求算法没有挖掘出来，那么你可以去思考到底还有哪些特征对算法的影响比较大，然后便可以去增加或者减少某个特征的权重。
## 八、数据分析总结
从开始两年前开始在这个领域进行实践，作者就开始思考，想要在这个领域成长，到底需要涉及哪些领域呢？哪些技能是不可或缺的呢？于是作者在一年前画了此图：
其实说回本质，整个过程并不复杂，无非就是”拿到数据“ -> "开始分析" ->
"得到结果"，但是想要分析的结果丰富、全面、精准却不是一件容易的事情，有非常多的因素会影响我们的结果。如数据量、数据维度、数据质量、领域知识、分析方法、关联逻辑等等。  
我们来重新梳理一遍整个分析的逻辑：  
1、安全需求调研  
如果我们只是为了解决某些安全需求，那么没有必要向专业的安全产品靠齐，我们仅仅需要思考的是，我们的安全痛点在哪，比如：对外开放服务的机器太多，无法具体掌握每台机器应用受攻击的状况；目前的Waf、IDS大量告警，需要处理的警告太多了，想二次分析降低误报，帮助人工提高验证效率；对服务器的出网行为较为关注，需要对所有的出网连接进行风险分析；对大量的无差别攻击并不感冒，想进行合理的筛选并让我方安全人员只需关注目的性较强的攻击者；  
当我们有了具体的需求以后，当然你可以有所有的需求，但是根据个人经验来看，需求越多需要投入的资源和时间成本就越高，所以明确的做法是将安全需求进行优先级的排序，然后逐个击破。
2、数据调研  
当我们理解清楚需求，明确了我需要达到的理想效果，且已经拥有一个需求清单以后，我们接下来要做的便是去调研需要达到我们的需求到底需要哪些数据，且数据量与数据维度是否能支撑，且需要考虑是否具备可分析性，数据的可信度（通过此数据分析出的结果有几分可信度），如何理解定义数据，数据的质量如何，数据中包含哪些信息量，数据是否可以进行增量，数据与数据之间是否存在关联关系，数据是如何产生的，我们是否能很轻易的获取这个数据等等
3、数据治理  
如果说前两步是对需求和数据的调研，那么到这里一步便开始需要一些实践操作了，当时根据我们的实际经验，前两步的调研质量，直接影响到我们后面是否能完成我们的分析需求。当我们弄清楚我们需要的数据在哪以后，我们需要采用相应的采集方式，可能是日志文件监控，可能是采用应用埋点，也可能是主动式的Agent采集。当我们拿到数据以后，我们需要根据需求将数据进行解析、归一化、数据增量、数据计算等等操作
4、分析方法  