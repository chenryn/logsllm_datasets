Free_Host, Dynamic_DNS, URL_Shortner
Set_ASNs
Num_ASNs
Set_Countries
Num_countries
Communication
Domain
URL
UA
Result code
Referer
Content-type
WHOIS
Hosting Type
Geolocation
Total number of hosts contacting the domain
Total number of connections to the domain
Avg/Max/Min number of connections per host
Total number of bytes sent and received
Avg/Max/Min ratio bytes recv. over sent per host
Total number of GET/POST
Avg/Max/Min ratio of POST over GET per host
Domain name length
Number of levels
Number of sub-domains on SLD
Top-level domain
Distinct URLs
Avg/Max/Min URL path length
Avg/Max/Min URL path depth
Total number of parameters across all URLs
Avg/Max/Min parameters per URL
Avg/Max/Min values per parameter
Fraction of URLs with file name
Total number of file names and extensions
Fraction of URLs with query string
Fraction and number of URLs with fragments
Fraction of domain URLs
Distinct UAs in all connections to domain
Ratio of distinct UAs over hosts
Avg/Max/Min number of UAs per host
Fraction connections with empty UA
Fraction unpopular UAs used by 1 and ≤ 10 hosts
Inverse average UA popularity
Dominant browser
Avg number of browsers per host
Dominant OS
Avg number of OSes per host
Fraction 2xx/3xx/4xx/5xx
Connections 2xx/3xx/4xx/5xx
Ratio failing connections
Fraction connections without referer
Number of distinct referer domains
Ratio of distinct domains over hosts
Avg/Max/Min number of domains per host
Has referer different than itself
Number of distinct content-types
Fraction of empty content-type
Fraction of content-types per category
(Java script, image, text, video, application)
Registration age
Update age
Registration and update validity
Update validity
Registration email category
Free hosting, dynamic DNS, URL shorteners
ASNs of resolved IPs
Number of distinct ASNs
Set of countries for resolved IPs
Number of distinct countries
Numeric
Numeric
Numeric
Numeric
Numeric
Numeric
Numeric
Numeric
Numeric
Numeric
Categorical
Numeric
Numeric
Numeric
Numeric
Numeric
Numeric
Numeric
Numeric
Numeric
Numeric
Numeric
Numeric
Numeric
Numeric
Numeric
Numeric
Numeric
Categorical
Numeric
Categorical
Numeric
Numeric
Numeric
Numeric
Numeric
Numeric
Numeric
Numeric
Boolean
Numeric
Numeric
Numeric
Numeric
Numeric
Numeric
Numeric
Numeric
Categorical
Binary
Categorical
Numeric
Categorical
Numeric
No
No
Yes
No
Yes
No
Yes
No
No
No
No
No
No
No
No
No
No
No
No
No
No
No
No
Yes
Yes
Yes
Yes
Yes
No
Yes
No
Yes
No
No
No
No
No
Yes
Yes
No
No
No
No
No
No
No
No
No
No
No
No
No
No
No
Used in [47]
Similar to [52]
Novel
Used in [11, 12, 63]
Novel
Novel
Novel
Used in [10, 40]
Used in [10, 40]
Novel
Used in [10, 40, 61]
Used in [33]
Similar to [11]
Similar to [11]
Used in [11]
Similar to [11]
Similar to [11]
Novel
Novel
Novel
Novel
Used in [61]
Novel
Novel
Novel
Novel
Used in [47]
Novel
Novel
Similar to [61]
Novel
Similar to [61]
Novel
Novel
Novel
Used in [46, 47]
Similar to [61]
Novel
Novel
Novel
Novel
Novel
Novel
Novel
Used in [40, 47]
Used in [40]
Used in [40, 47]
Used in [40]
Novel
Novel
Similar to [8]
Similar to [8]
Used in [40]
Similar to [13, 40, 61]
Table 3: List of Internal and External Features. New features not used in previous work are in bold.
malicious domains have on average twice as many parameter values
than legitimate ones. Malicious domains are more likely to use do-
main URLs: 16.15% of all URLs to malicious domains, while only
3.79% URLs to legitimate domains, are domain URLs.
User-agent string features. User-agent (UA) string might be ex-
ploited as a channel for command and data transmission from en-
terprise victim machines [45]. First, we count the distinct UAs seen
under the given domain and statistics per host. In addition, we count
the fraction of HTTP requests with empty UA. Third, enterprise
machines install similar software and we expect most UAs to be
seen across a large set of hosts. We build a history of UAs observed
over a month-long period and consider a UA as popular for that
enterprise if it has been used by at least 10 hosts. Then, we compute
several enterprise-specific features: the fraction of unpopular UAs
(used by 1 and less than 10 hosts) and inverse average of UA popu-
larity 1. In our dataset, 15.2% of malicious domains and only 1.5%
legitimate domains are contacted solely through unpopular UAs.
The UAs also encode the OS and browser, which can be obtained
by parsing the UA. It turns out that Windows XP is 5 times more
vulnerable than other OSes (Windows 8, Android, and MAC OS),
while IE is twice as vulnerable as other browsers (Firefox, Chrome,
Opera, and Safari).
Result code features. We divide the result code from HTTP response
into four categories (2xx/3xx/4xx/5xx) and compute the fraction and
total number of such connections for each category. Since malicious
domains tend to be taken down quickly by hosting providers/regis-
trars and have short lifetimes, more failed connections (4xx/5xx) are
hosts) of U Ai is Xi , the inverse average is computed asn
1Assume a domain has n UAs (U A1, U A2, ..., U An ) and the popularity (number of
i =1
1
Xi
.
MADE: Security Analytics for Enterprise Threat Detection
ACSAC ’18, December 3–7, 2018, San Juan, PR, USA
usually observed. In addition, the enterprise proxies tend to block
access to unknown domains (responding with code 404). Repeated
visits to such domains with high number of failed connections are
likely attributed to automated software rather than humans. In fact,
the percentage of domains with 100% failed connections is 34.1%
for malicious domains and only 4.9% for other domains.
Web referer features. User-initiated browser requests have a referer
field, while automated processes might use empty referer. We con-
firmed that in our training set, 24.5% malicious domains were visited
without referer, comparing to only 4.3% for other domains. A large
number of referer domains or high ratio of referer domains to hosts
suggest that the domain might be exploited by malware [48] or used
as central point to coordinate compromised sites [37]. Previous work
has analyzed characteristics of re-direction chains extracted from
the referer field [61], but in MADE we only look at the referer URL
for each visit.
Content-type features. Small number of content-types on a domain
suggests the domain might not be used to deliver regular web con-
tent. Moreover, certain content-types (e.g., exe and jar) have higher
associations with malware and exploits. To capture this, we consider
the number and fraction of URLs within each category (html, java
script, application, image, video, text). We confirmed that legitimate
domains have about twice as many content types than malicious ones.
Additionally 41.35% malicious domains, and only 8.98% legitimate
domains have empty content types.
External Features. We leverage public external resources to enrich
our dataset. The derived set of external features are elaborated below:
WHOIS information. WHOIS information is very relevant in pre-
dicting malicious activities (e.g., [22, 28, 40]). We issue WHOIS
lookups for all the monitored domains and extract registration/up-
date/expiration dates and registrant email for detection. We compute
the number of days since registration as registration age and the
number of days till expiration as registration validity. Similarly, we
compute the number of days since the latest update as update age
and the number of days from update till expiration as update va-
lidity. The age and validity of malicious domains are usually much
shorter than those of legitimate ones, and this is confirmed in our
data. Figure 2 (left) shows that the mean registration age and validity
for malicious domains are 191 and 366 days, comparing to 2404 and
2927 days for legitimate domains. We also examine the registrant
email and classify its hosting services into 5 categories: personal (if
the service is mainly for personal use, e.g., gmail.com), private if
the domain is registered privately, e.g., domainsbyproxy.com,
domain (if the server name equals to domain name), empty (if there
is no email available), and other. Personal and private emails have
higher associations with malicious domains.
Hosting type. We retrieve public lists of known free-hosting providers,
dynamic DNS and URL shorteners from malware domains.com
[19] and match them against the monitored domain names. Attackers
abuse free-hosting providers, dynamic DNS for domain fluxing [37]
and URL shorteners as redirectors [16], and domains using these
services are more suspicious.
IP address geolocation. Malware is not uniformly distributed across
geographies, with some countries and ASNs hosting more malicious
infrastructures [60]. In our dataset, Figure 2 (center) shows the
ratio of malicious domains for different countries, demonstrating
its heavy-tailed distribution. We resolve the IP addresses associated
with monitored domains and map them into ASNs and countries
according to Maxmind [1]. We include the ASN and country as
categorical features, and also the number of ASNs and countries
as numerical features. Intuitively, higher diversity of ASNs and
countries might indicate IP fluxing, a popular attack technique [29].
3.3 Feature Selection