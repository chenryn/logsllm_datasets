Fri	
  May	
  13	
  10:29:53	
  PDT	
  2011	
  FW	
  Block:	
  174.37.237.66	
  Sweep	
Fri	
  May	
  13	
  10:29:53	
  PDT	
  2011	
  Complaint:	
  174.37.237.66	
  PI:EMAIL	
Mon	
  Jun	
  13	
  09:06:44	
  PDT	
  2011	
  FW	
  Block:	
  174.37.237.66	
  Sweep	
Mon	
  Jun	
  13	
  09:06:45	
  PDT	
  2011	
  Complaint:	
  174.37.237.66	
  PI:EMAIL	
Not	
  as	
  bad:	
Thu	
  Mar	
  10	
  18:02:58	
  PST	
  2011	
  FW	
  Block:	
  174.37.255.47	
  AdminProtocol	
Thu	
  Mar	
  10	
  18:03:20	
  PDT	
  2011	
  Complaint:	
  174.37.255.47	
  PI:EMAIL	
Fri	
  Mar	
  18	
  23:21:20	
  PDT	
  2011	
  FW	
  Block:	
  174.37.255.47	
  Sweep	
Fri	
  Mar	
  18	
  23:21:20	
  PDT	
  2011	
  Complaint:	
  174.37.255.47	
  PI:EMAIL	
Sun	
  Mar	
  20	
  03:41:04	
  PDT	
  2011	
  FW	
  Block:	
  174.37.255.47	
  AdminProtocol	
Sun	
  Mar	
  20	
  03:41:05	
  PDT	
  2011	
  Complaint:	
  174.37.255.47	
  PI:EMAIL	
Tighten	
  it	
  up	
•  Clients	
  should	
  have	
  their	
  own	
  IDS/
ﬁrewall/etc,	
  but…	
•  Hosts	
  that	
  are	
  aQacking	
  mul;ple	
clients	
  should	
  be	
  detected	
  and	
shunned	
  by	
  the	
  provider	
•  The	
  provider	
  should	
  take	
  steps	
  to	
  help	
their	
  clients	
  protect	
  themselves	
•  The	
  provider	
  should	
  also	
  be	
  looking	
for	
  inten;onally	
  malicious	
  clients	
DANGER!	
•  Consolida;ng	
  events	
from	
  all	
  client	
environments	
  to	
  look	
for	
  enterprise-­‐
threatening	
  external	
agents	
  would	
improve	
  things,	
  but…	
•  The	
  single	
  largest	
unaddressed	
  threat	
is	
  the	
  client	
  networks	
What	
  Are	
  Providers	
  Dealing	
  With?	
•  Frequent,	
  rapid	
  client	
  changes	
•  Clients	
  with	
  a	
  wide	
  variety	
  of	
  services,	
users,	
  and	
  ways	
  of	
  u;lizing	
  resources	
•  Clients	
  who	
  are	
  in	
  an	
  unknown	
  state	
•  A	
  need	
  to	
  be	
  as	
  close	
  to	
  0%	
  false	
posi;ve	
  as	
  possible	
What	
  Stays	
  the	
  Same?	
•  In-­‐line	
  IPS,	
  owned	
  and	
controlled	
  by	
  the	
client	
•  Firewall,	
  owned	
  and	
controlled	
  by	
  the	
client	
•  Vulnerability	
Assessment	
  (VA)	
•  Well-­‐understood	
technologies	
  that	
allow	
  clients	
  baseline	
control	
  over	
  their	
own	
  networks	
  within	
the	
  cloud	
What	
  Are	
  We	
  Adding?	
Nerlow	
  Analyzer	
IDS	
NAC	
Log	
  Consolida;on	
On-­‐access	
  misconﬁgura;on	
  detec;on	
Event	
  Correla;on	
Why	
  Not	
  OSSIM?	
•  hQp://alienvault.com/community	
•  OSSIM	
  uses	
  many	
  of	
  the	
  same	
  tools	
I’m	
  sugges;ng	
•  It	
  makes	
  assump;ons	
  about	
  the	
network	
  it’s	
  placed	
  into	
  (tool/vendor	
lock-­‐in)	
•  Correla;on	
  engine	
  is	
  not	
  as	
  ﬂexible	
  as	
SEC;	
  regardless,	
  has	
  advantages	
Nerlow	
  (nfdump)	
•  hQp://nfdump.sourceforge.net/	
•  Used	
  to	
  monitor	
  for	
  excessive,	
prolonged	
  network	
  u;liza;on	
•  Can	
  also	
  trend	
  network	
  performance	
and	
  ﬂag	
  suspicious	
  spikes	
•  Data	
  is	
  sent	
  from	
  internal	
  switches	
and	
  other	
  network	
  devices	
  for	
  analysis	
•  Provides	
  network	
  server/service	
inventory	
  data	
Enterprise-­‐Wide	
  IDS	
  (Snort)	
•  hQp://www.snort.org/	
•  Well-­‐known,	
  widely	
  used	
•  Independent	
  of	
  clients;	
no	
  client	
  visibility	
•  AQached	
  to	
  network	
egress	
  points	
•  No	
  trusted	
  networks:	
monitoring	
  ALL	
  traﬃc	
•  Provides	
  network	
  server/
service	
  inventory	
  data	
NAC	
  (PacketFence)	
•  hQp://www.packerence.org/home.html	
•  Post-­‐admission	
  behavioral	
  quaran;ning	
•  This	
  system	
  will	
  take	
  input	
  from	
  our	
  other	
systems,	
  and	
  use	
  it	
  to	
  make	
  decisions	
  to	
quaran;ne	
  devices	
Log	
  Consolida;on	
  (syslog-­‐ng)	
•  Well-­‐known,	
widely	
  used	
•  All	
  infrastructure	
devices	
  (servers,	
switches,	
  IDS,	
  etc)	
logging	
  here	
On-­‐Access	
  Misconﬁgura;on	
Detec;on	
•  Medusa	
hQp://www.foofus.net/~jmk/medusa/
medusa.html	
•  Metasploit	
hQp://www.metasploit.com/	
•  Nmap	
hQp://nmap.org/	
•  Others	
•  Tools	
  called	
  by	
  correla;on	
  system	
  to	
  run	
basic	
  misconﬁgura;on	
  checks	
  of	
  new	
services	
  and	
  servers	
The	
  “Magic”:	
  Correla;on	
  (SEC)	
•  hQp://simple-­‐
evcorr.sourceforge.net/	
•  Keeps	
  track	
  of	
  events	
from	
  a	
  variety	
  of	
sources	
•  Isn’t	
  in-­‐line,	
  makes	
  it	
possible	
  to	
  make	
  slow,	
well-­‐informed	
  decisions	
•  Coordinates	
  all	
  other	
components	
How	
  does	
  this	
  work?	
Iden;fying	
  Misbehaving	
  Hosts	
nfdump	
•  Unusual	
  traﬃc	
  paQerns	
  alone	
  don’t	
dictate	
  an	
  incident	
•  nfdump	
  data	
  should	
  be	
  compared	
  with	
IDS,	
  ﬁrewall	
  and	
  other	
  data	
  to	
  look	
  for	
anomalies	
•  Example:	
  Traﬃc	
  peak,	
  combined	
  with	
ARP	
  collision	
  messages	
  from	
  switches	
  à	
ARP	
  Cache	
  Overﬂow	
•  Example:	
  Traﬃc	
  peak,	
  combined	
  with	
many	
  IRC	
  events	
  à	
  Botnet	
  Par;cipa;on	
Correlated	
  IDS	
  Logs	
•  Much	
  beQer	
informa;on,	
  but	
  limited	
to	
  what	
  we	
  can	
  see	
•  Example:	
  Single	
  event	
type	
  enters	
  server,	
replayed	
  by	
  server	
mul;ple	
  ;mes	
  à	
  Worm	
Infec;on	
•  Example:	
  Server	
contacts	
  successive	
servers	
  using	
  the	
  same	
administra;ve	
  protocol	
à	
  Protocol	
  Scanning	
Limita;ons	
•  Err	
  on	
  the	
  side	
of	
  cau;on	
•  Reac;ve,	
  so	
damage	
  might	
already	
  be	
done	
Demonstra;on	
Conclusion	
•  Cloud	
  providers	
don’t	
  appear	
  to	
  be	
internally	
  policing	
their	
  clients’	
networks	
•  Reliable	
  measures	
should	
  be	
  be	
  taken	
to	
  detect	
  both	
malicious	
  clients	
and	
  compromised	
clients	
Ques;ons