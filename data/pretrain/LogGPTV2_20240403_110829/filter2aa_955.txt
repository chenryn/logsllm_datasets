0x00 背景
⽬前的攻防场景，攻击成本的节约、周期短，成果要求⾼成了普遍要⾯对的问题，所以
对于基础设施的建设越来越重视，⼀键⾃动化的部署CS、Frp gen等⼯具的开发，节省了以
前略⻓的搭建配置时间，变相增加攻击有效时间；优化的Profile，⽐如修改⼀些默认标记
位、流量伪装、关闭stager等，成熟的OPSEC，⽐如杀软度测试、攻击⼿法检测测试、上传
⽂件清除流程等，减少了免杀难度系数，增加溯源难度的同时，也减少团队协作中执⾏了⼀
些被杀软标记的攻击⽅式导致掉点的可能性。前两天刚好聊到域前置的节点⽩域名收集及验
证，内部以前也简单分享过，遂炒冷饭。
0x01 CDN and 域前置的原理
只要别 ping cdn 节点，然后HTTP Hosts⾥放⼀堆IP⽽不⽤域名就⾏，求求了，放过队
友吧。关于原理，⾮科普不是重点，略
0x02 CDN滥⽤域名抢注
CDN滥⽤域名抢注腾讯云->云产品->CDN与加速->内容分发⽹络->域名管理->域名管理
1> 添加域名涉及到抢注问题，⾮必要不抢注主域名，⽬前已经有⽩名单针对⼀些域名添
加了归属权校验。
2> 项⽬优先使⽤当前⽬标主域名进⾏加速，⼦域名可以为存在的域名⽐如www.xxx.co
m.若抢注失败，则优先考虑正常电脑会产⽣外连的域名，⽐如软件、视频、杀软、搜索引擎
等
3> 域名必须是真实存在，已经在⼯信部进⾏过备案的
域名配置添加
0x03 寻找同⼀CDN下⾯可以进⾏流量转发的域名
如何寻找同⼀CDN下⾯可以进⾏流量转发的域名呢？
这个其实是本次分享重点想讲的东⻄。CDN的原理中，DNS系统会最终将域名的解析权
交给CNAME(CDN⼚商域名)指向的CDN专⽤DNS服务器，CDN的DNS服务器将CDN的全局
负载均衡设备IP地址返回⽬标机器，那就代表着我们的CDN负载的IP历史解析中，是否会有
这样符合标准的域名呢？
1>第⼀种简单的⽅法，⽤站⻓之家的ping功能去ping CNAME记录
(sdwdsdw.xxxxx.com.w.kunlunca.com),然后使⽤威胁平台，⽐如TI、微步在线等进⾏ip解析
域名查询
PS：验证⽅法（curl -k -v https://oss.takeoa.com -H "Host: sdwdsdw.xxxxx.com"），
并查看CS的web log是否有请求记录。
2>第⼆种⽅法，涉及到国内各CDN⼚商CNAME后缀，我们观察阿⾥或者腾讯的CDN申
请以后的CNAME后缀都是有⼀定规则或者说固定域名的。
xxxx.xxx.com.dsa.dnsv1.com
xxxx.xxx.com.w.kunlunca.com
我们通过 nslookup www.cdn.dnsv1.com 可以获得使⽤最近CDN节点的公⽹IP
然后获取其他也托管在该⼚商并使⽤CDN的合法域名(⽐如：xxxxx)
通过威胁情报查询这两个ip或www.cdn.dnsv1.com，查看历史解析。
这些ip上的历史解析都可以⽤，可以继续追寻IDC，寻找
m.leha.com.cdn.dnsv1.com具有.cdn.dnsv1.com的域名，去掉后边，访问前⾯是否
具有https绿标证书
先简单的说两种⽅法，其实这两种可以扩张很多种⼩tips。
0x04 简单流量分析及⽩名单
0x05 结尾
中间可能还有⼀些⽐如Window机器通过Powershell⾛域前置拉取脚本上线、CrossC2通
过域前置上线Linux机器等⼀些⼩tips，我想⼤家也都会，就不嫌丑了，具体的⽹络⾏为分析
及流量分析、检测及解决办法也都略掉了，关于之前聊的⽩名单出⽹场景，就仁者⻅仁，智
者⻅智了，⽤过的都说好。