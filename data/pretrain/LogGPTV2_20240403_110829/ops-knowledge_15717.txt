User: 请回答以下安全问题根据弱密码保护web数据库中的第三方凭据我需要将第三方凭证存储在web应用的数据库中。第三方支持OAUTH，我计划获得一个长期令牌，以允许我的应用访问第三方，但我想通过使用用户的登录密码（使用PBKDF2或bcrypt）加密存储在数据库中的OAUTH令牌来保护它。
由于用户经常选择非常糟糕的密码，我需要使用TOTP（RFC 6238）对我的应用进行双因素身份验证。
有没有办法将TOTP令牌合并到加密第三方OAUTH令牌的方案中？

Assistant: 这毫无意义。
密码和TOTP/HOTP之间有一个有趣的基本区别。
TOTP是一种对称算法。服务器和客户端共享相同的信息。它们共享OTP密钥、同步时间和最后一个计时器，以避免重播。
相比之下，密码验证机制不共享信息。用户知道密码，但服务器不知道密码。它只知道密码的加盐味和胡椒味。也就是说，服务器没有所有必要的组件来了解用户所知道的内容，即密码！
同样，在TOTP的情况下，服务器具有所有信息。用户没有任何附加信息。这意味着，如果您想使用TOTP来加密服务器上的某些内容，服务器也将拥有加密/解密这些内容的所有信息。这意味着加密的数据和加密密钥（或用于创建加密密钥的信息）位于服务器上。
问题是，你想减轻哪些威胁。
使用不存储在数据库中的应用级加密密钥可以缓解sql注入和窃取数据库的威胁。在这种情况下，这甚至比从任何可能也存储在数据库中的TOTP材料创建加密密钥要好，因为攻击者在窃取数据库时会获得加密数据和创建加密密钥的信息。