SIM card holder
Works with Tmobile,
AT&T
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
22 / 49
Add the GSM module
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
23 / 49
Moar Power?
BBB draws 460mA on
boot
CryptoCape
GSM Shield draws 300mA
on average for “talk”, but
peak of 2.0 A!!!
Meet the LiPoWerCape
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
24 / 49
Moar Power?
BBB draws 460mA on
boot
CryptoCape
GSM Shield draws 300mA
on average for “talk”, but
peak of 2.0 A!!!
Meet the LiPoWerCape
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
24 / 49
CHUCKWAGON
We still need a way to easily
connect to the video adapter.
Meet CHUCKWAGON:
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
25 / 49
CHUCKWAGON
We still need a way to easily
connect to the video adapter.
Meet CHUCKWAGON:
Breadboard friendly.
Logic level converters for
I2C.
Supplies 5V.
Power indicator.
Attaches to CryptoCape
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
25 / 49
CHUCKWAGON schematic
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
26 / 49
CHUCKWAGON board
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
27 / 49
I2C hack not that new. . .
As seen on Hackaday
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
28 / 49
Add the CHUCKWAGON
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
29 / 49
Connect to GSM module
Ok, so let’s connect to the
GSM Shield from the Beagle!
BBB’s UART4,
broken-out by ATmega’s
program jumpers.
GSM’s shield
software-serial, D7 and
D8
/me checks datasheet one
last time...
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
30 / 49
Connect to GSM module
Ok, so let’s connect to the
GSM Shield from the Beagle!
BBB’s UART4,
broken-out by ATmega’s
program jumpers.
GSM’s shield
software-serial, D7 and
D8
/me checks datasheet one
last time...
Needs logic level
converters!
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
30 / 49
Completed Hardware with Battery
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
31 / 49
Completed Hardware without Battery
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
32 / 49
Completed Hardware without Battery
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
32 / 49
Software ﬂow
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
33 / 49
Software ﬂow
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
33 / 49
What can I do with this?
If software on the target can communicate with the implant then:
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
34 / 49
What can I do with this?
If software on the target can communicate with the implant then:
Target can exﬁl out to implant to GSM.
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
34 / 49
What can I do with this?
If software on the target can communicate with the implant then:
Target can exﬁl out to implant to GSM.
Target can exﬁl out to implant for storage.
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
34 / 49
What can I do with this?
If software on the target can communicate with the implant then:
Target can exﬁl out to implant to GSM.
Target can exﬁl out to implant for storage.
Implant can provide code for target to run.
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
34 / 49
What can I do with this?
If software on the target can communicate with the implant then:
Target can exﬁl out to implant to GSM.
Target can exﬁl out to implant for storage.
Implant can provide code for target to run.
Control the implant over GSM ! control the target over GSM
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
34 / 49
Accessorize!
Prepared for anything or NSA hacking toolkit?
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
35 / 49
How to improve the CHUCKWAGON
What does CHUCKWAGON rev. B look like?
Consolidate into one board: ImplantCape
Eliminate ﬂywires.
HDMI footprint vs. VGA
Could all be done from AVR (less power), but BBB is more fun.
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
36 / 49
Using Crypto for Evil!
Long history of Cryptography and Malware!
Cryptoviral Extortion:
1989 PC Cybord, Joseph Popp
1996 Macintosh SE/30 crytovirus PoC, Young and Yung
2006 Gpcode.AG/AK, Cryzip
2013 CryptoLocker, CryptorBit
Reversing Anti-Analysis:
Packers, Obfuscator, VM-based JIT
2011 TPM ”cloaking” malware
2014 Uroburos, encrypted VFS
2014 TPM-enabled super-targeted malware
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
37 / 49
Using Crypto for Evil!
The CryptoCape includes a TPM...
I2C friendly
Protected RSA private key storage
Windows 8 friendly
More or less optional, as there is most likely an onboard TPM
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
38 / 49
Cloaking Malware with the Trusted Platform Module
2011 USENIX Security
Alan M. Dunn, Owen S. Hofmann, Brent Waters, Emmett Witchel
Summary: Use TPM-protected keys and an Intel TXT PAL to protect
malicious code execution from observation, analysis, and tamperment.
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
39 / 49
Cloaking Malware with the Trusted Platform Module
2011 USENIX Security
Alan M. Dunn, Owen S. Hofmann, Brent Waters, Emmett Witchel
Summary: Use TPM-protected keys and an Intel TXT PAL to protect
malicious code execution from observation, analysis, and tamperment.
Intel TXT and remote attestation are hard!
But generating a public key on a TPM and using that to encrypt
additional payloads is easy...
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
39 / 49
Cloaking Malware with the Trusted Platform Module
2011 USENIX Security
Alan M. Dunn, Owen S. Hofmann, Brent Waters, Emmett Witchel
Summary: Use TPM-protected keys and an Intel TXT PAL to protect
malicious code execution from observation, analysis, and tamperment.
Intel TXT and remote attestation are hard!
But generating a public key on a TPM and using that to encrypt
additional payloads is easy...
Put a TPM on your implant and protect against nasty network
interception. Also restrict analysis to the target machine upon discovery
(or force memory analysis).
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
39 / 49
TPM-enabled super-targeted Malware
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
40 / 49
TPM-enabled super-targeted Malware
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
41 / 49
TPM-enabled super-targeted Malware
Windows 8 automatically enables/initializes a TPM, then creates and
manages your owner password. Access to TPM is abstracted through
Microsoft CSP.
Windows PcpTool Kit:
NCryptOpenStorageProvider
NCryptCreatePersistedKey
NCryptExportKey
NCryptDecrypt
In memory process creation:
CreateProcess
ZwUnmapViewOfSection
VirtualAllocEx
WriteProcessMemory
Python pefile to inject
encrypted PE section into a
decryption stub.
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
42 / 49
TPM-enabled super-targeted Malware
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
43 / 49
tpm-malcrypt
fork tpm-malcrypt!
https://github.com/theopolis/tpm-malcrypt
tpm-keyextract, create and exﬁl a storage public key
malcrypter, encrypt and inject into decryption stub
malcrypt, decryption stub, process creation/injection
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
44 / 49
Malicious Exﬁltration via Audio
Backstory: #badBIOS thought to use Audio as an out-of-band
exﬁltration or C&C mechanism. Dismissed as infeasable by BIOS
development SMEs.
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
45 / 49
Malicious Exﬁltration via Audio
Backstory: #badBIOS thought to use Audio as an out-of-band
exﬁltration or C&C mechanism. Dismissed as infeasable by BIOS
development SMEs.
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
45 / 49
Malicious Exﬁltration via Audio
Data of Audio Protocols are very well deﬁned and resiliant.
QPSK10 (10 baud), QPSK05 (5 baud), quadrature phase shift keying
modulation to provide forward error correction.
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
46 / 49
Malicious Exﬁltration via Audio
Possible to ”pivot” through colluding machines. Local network exploitation
creates a mesh of audio-capable relays such as idle headphones.
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
47 / 49
Demos, Learning, and Fabulous Prizes
Join us in the HHV for CryptoCape and WAGONBED demos!
Challenge: Solve the puzzle here: —————————–
(URL redaction removed during actual DEFCON 22 talk)
The ﬁrst 5 correct submissions win a DIY hardware implant kit
(No hardware hacking experience required)
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
48 / 49
Demos, Learning, and Fabulous Prizes
Thank you!
Josh Datko and Teddy Reed (DEF CON 2
2
)
DIY Hardware implant over I2C
August 10, 2014
49 / 49