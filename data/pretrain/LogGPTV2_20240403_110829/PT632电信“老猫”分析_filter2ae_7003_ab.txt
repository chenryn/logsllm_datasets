-ef命令就拿到手了。。。
## 0x04：tcapi
Tcapi是PT632光猫上的一个专门用于操作配置信息“数据库”的helper程序。从功能上来说，tcapi非常类似于在前一篇文章“OpenWrt之入门”中提到的uci。不过，这个tcapi只能处理PT632自身的配置信息，并不能修改其它程序的配置文件。我在tcLinux的发行版中尝试寻找这个程序，结果证明了我的观点：tcapi应该是友华工程师自己开发的，而不是tcLinux自带的。
那么，tcapi到底操作的那个文件呢？在读/boaroot中的CGI脚本时找到了答案——/tmp/var/romfile.cfg。这个文件存储了PT632中的绝大多数信息，包括各种服务的配置，账号信息等等。
从这个xml格式的文件中可以看出，系统中的各种配置都被“逐节”的保存到这个配置文件中了。有了tcapi这个程序，通过几次简单的查询操作之后，我们就能掌握如何使用它来修改PT632的各种配置信息。
Tcapi的命令语法非常简单，仅有9个命令选项，操作的内容就是配置文件中的各个节点和属性值。
在分析romfile.cfg文件之后，我们就很清楚可以通过tcapi获取PT632设备的各种账户信息，但是不包括用户的电信账号和密码。
Tcapi在代码实现的时候有些诡异，在解析这种XML文档时，通常情况下coder们都会选择用“.”来作为节点之间的连接符号，比如Accout节点下的FtpEntry节点，我们会描述为“Account.FtpEntry”。一开始尝通过tcapi设置Ftp服务器属性的时候，一直没有成功，后来翻看/boaroot/cgi/telnet.asp脚本时，发现设置PT632参数的正确打开方式是：
是的，你没看错，这个tcapi就是这么奇葩。一方面，可以不给出上级节点就能直接查到末端节点信息；另一方面，不通过下划线“_”作为连接符号，你没办法设置末端节点的属性值。
当然，要开启Ftp服务器的话，还需要通过tcapi提交修改请求，即执行一下代码:
`#tcapi commit Account_FtpEntry`
## 0x05：boa http server
Boa是一个针对嵌入式应用环境的Web服务器，文件大小可以妥妥的控制在30KB左右，当然PT632上查看到的代码大小呢，比这个还要小。。。
由于boa的官方网站已经down了，所以从网上查找到的一些残存资料来看，boa是可以做到免配置文件的。当然，PT632还是给boa写了一个配置文件，在/boaroot/boa.conf
/boaroot/boa.conf只是在boa http server配置文件模板的基础上做了适当修改，比如起一个适合的主机名等等
## 0x06：一些小小的tricks
###  1、关于电信各种猫的维护账号的问题
在拿到PT632之后，自己尝试了很多办法去获得telecomadmin账号的密码，最终都失败了。失败不要紧，关键是发现全国各地，确切地说是各个省直辖市貌似都会自己的维护账号（telecomadmin）和密码。那么，这就存在一个问题了。这个维护密码是通过固件直接写到猫里去的呢？还是设备接入电信网络之后通过TR069协议获取到的呢？
为了解答这个问题，我做了一个实验，也就是把这只PT632“老猫”重置了，然后下载恢复之后的romfile.cfg文件。以下是重置前和重置之后的romfile.cfg文件对比：
很显然，网上所说的电信光猫通用密码“nE7jA%5m”的确是真的，但是这个密码已经可以通过类似TR069或者CPE协议，在设备首次注册的时候就修改了这个密码。当然，电信师傅应该是可以通过他们的终端设备查找到某一台设备的维护账户密码。
###  2、关于如何启动telnet
从网上找了不少关于电信光猫的资料，没有找到适合PT632的。很多文章给出的方法是通过telecomadmin账户登录后台之后，可以通过Web
GUI开启telnet服务。我试过了，不行，即便找到了telecomadmin也不行，Web GUI上没有提供开启telnet服务的接口。
后来，成功登录telecomadmin账户后，尝试着直接访问cgi-bin/telnet.asp，切换到了telnet启动页面。
###  3、关于如何获取telecomadmin，telnet，ftp等账户及密码
前些年，包括电信在内的很多运营商的确存在管理维护账户使用统一密码的情况，因此我也很自觉地尝试寻找这些所谓的密码，但失败了。后来，浏览到一篇文章，其中提到在普通用户登录的情况下，直接访问cgi-bin目录下的upgrade.asp页面，可以下载PT632的配置文件，结果真就OK了。文件就是之前提到的/tmp/var/romfile.cfg，并且是明文的。
###  4、关于文件的下载和上传
PT632的USB接口并没有发挥实际的作用，说白了也就是个摆设，因此没办法通过USB备份来获取系统中的各种文件。但是，这些代码和配置文件不拿到手显然是无法愉快的研究，于是就打起了cig-bin/upgrade.asp的注意。很显然，这个所谓的bakup配置文件的功能仅仅提供了下载，并没有加密，所以研究所需的文件都可以打包并保存为/tmp/var/romfile.cfg，这样就可以搞定了。
再者，还可以开启ftp服务。ftp服务器貌似也是被友华的工程师给修改过的，配置文件没法配置ftp根目录。找了半天才找到ftp的root目录在/var/tmp/mnt/dev目录下，奇葩吧。当然，至少ftp服务还是可以启动的，还能用就已经谢天谢地了。
###  5、关于SSH和Tftp服务
友华的工程师应该是把SSH和Tftp服务器给直接禁用了，虽然配置文件里面依然有相应的配置信息字段。为什么有这个猜测呢？一方面，通过tcapi无法启动SSH和Tftp服务；另一方面，在cgi-bin目录下并没有发现可以远程开启SSH和Tftp的页面。
## 0x07：总结
###  1、功能性
从功能性来说，PT632毫无疑问能满足普通家庭最基本的光纤上网需求，虽然自带一个“阑尾”式的USB接口，虽然只支持2.4GHz单频，虽然不能打开SSH。但是，这猫不就用来连接互联网吗？而且，据master说，这猫特别稳定，几乎没有任何故障（不包括从来没被他老人家使用过的2.4GHz无线路由功能）。
再者，由于这款猫真的太老了，当前很多贫价路由都有的基本功能，这货都没有。不过，情有可原，毕竟一把年纪了。
###  2、易用性
这个我没什么发言权。不过，这猫都是电信师傅上门安装的，安装好之后，除非是移机啥的，貌似没什么易用性可言啊！PS：这一节是team
member让我写上的。。。
###  3、安全性
从系统层面来说，PT632还真算不错了，由于没有采用OpenWrt这类灵活的Linux架构，很多分区都是read-only的，因此对于像我这样的小白，hacking这样一台设备的确是有难度的。再者，从busybox的阉割程度来看，友华的工程师是真的用心做了功课的。尽可能剔除无用的api，势必限制了操作系统的可用性，当然会提高黑客攻击的难度。
从应用程序的角度来看，Web界面的权限管理是有问题的，比如通过useradmin（普通用户）权限，就可以直接开启telnet服务。再就是，下载的配置文件居然没有加密，这个着实不应该。当然，还有其它一堆问题，就不在这里拉家常了，毕竟这款猫都已经被友华给淘汰了。。。
## 0x08：参考
1、 友华通信技术有限公司.   
2、 Tiye Core Linux Book. 