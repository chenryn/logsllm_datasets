# Momigari：最新Windows操作系统内核在野漏洞概述

## 演讲者介绍
- **Boris Larin**  
  高级恶意软件分析师（启发式检测和漏洞研究团队）  
  Twitter: @oct0xor
- **Anton Ivanov**  
  高级威胁研究和检测团队负责人  
  Twitter: @antonivanovm

## 内容概要
1. 我们将简要介绍发现零日漏洞的方法及面临的挑战。
2. 我们将讨论三个在野特权提升（EOP）零日攻击：
   - Windows系统内核漏洞利用变得越来越困难。
   - ITW样本分析帮助我们了解当前情况和技术趋势。
   - 我们将详细介绍两个针对Windows 10 RS4的漏洞利用案例。
3. 我们将揭示这些漏洞采用的开发框架。

### 卡巴斯基实验室检测技术
- **技术1：漏洞利用预防**
  - 交付
  - 内存操纵
  - 运行Shellcode
  - 执行Payload
  - 预防漏洞利用
  - 检测和阻止Payload执行
- **技术2：沙箱**
  - 用于分析的文件/URL
  - 执行日志
  - 内存转储
  - 系统/注册表更改
  - 网络连接
  - 截图
  - 利用工件
  - 关于判定活动性质的详细数据
  - 测试虚拟机
  - 文件/URL将被发送到多个测试虚拟机
  - 工件记录
  - 检测漏洞

### 卡巴斯基实验室捕获的在野漏洞利用
- 2018年5月 - CVE-2018-8174（Windows VBScript引擎远程执行代码漏洞）
- 2018年10月 - CVE-2018-8453（Win32k特权提升漏洞）
- 2018年11月 - CVE-2018-8589（Win32k特权提升漏洞）
- 2018年12月 - CVE-2018-8611（Windows内核特权提升漏洞）
- 2019年3月 - CVE-2019-0797（Win32k特权提升漏洞）
- 2019年4月 - CVE-2019-0859（Win32k特权提升漏洞）

### 发现零日漏洞的复杂性
- 我们的技术旨在检测和预防漏洞利用，但确定是否为零日漏洞需要额外的分析。
- 一些漏洞容易被发现（如沙箱进程出现异常行为），而一些则很难（如由其他安全软件引起的误报）。
- 需要进一步分析浏览器中的漏洞利用脚本，可能的解决方法是提供类似于AMSI的接口，但实现存在挑战。

### 特权提升漏洞检测
- 特权提升漏洞通常用于攻击的后期阶段。
- 当前操作系统的事件记录足以构建检测。
- 特权提升漏洞可能是最适合进行分析的类型。

### 案例1：CVE-2018-8453
- 攻击模块以加密形式分发，仅针对x64平台，但分析表明对x86的攻击也是可行的。
- 支持多个Windows版本。
- Win32k是一个处理图形、用户输入和UI元素的内核模式驱动程序，自Windows诞生以来就存在。
- Microsoft进行了许多改进，使针对内核的攻击更加困难。
- 漏洞位于syscall NtUserSetWindowFNID，Microsoft通过调用IsWindowBeingDestroyed()函数修补了该漏洞。

### 案例2：CVE-2018-8589
- win32k中的竞争条件，仅针对Windows 7 SP1 32位。
- 需要至少两个处理器内核。
- 漏洞利用样本使用MoveWindow()和WM_NCCALCSIZE消息。
- 两个线程具有相同的窗口过程，第二个线程启动递归。
- 在线程终止期间触发最大递归级别的竞争条件。

以上是对最新Windows操作系统内核在野漏洞的概述。感谢您的关注！