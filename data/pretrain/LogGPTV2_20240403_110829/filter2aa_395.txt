Bugged&Files&
Is#Your#Document#Telling#on#You?#
Daniel#Crowley,#Damon#Smith#
•  Damon&Smith&
Who&are&we?&
•  Daniel&Crowley&
Files&that&trigger&outbound&traﬃc&when&parsed&
&
&Without&being&an&executable&format&
&Regardless&of&format&complexity&
&&&&&&Without&the&use&of&exploits&
&
&…and&the&implications&of&all&that&
What&is&this&talk&about?&
• Privacy&
– DRM&
– DLP&
– DeFanonymization&
• Security&
– NTLM&credential&capture/relay&
– CSRF&
• ”It’s&a&feature,&not&a&bug”&
Why&is&this&important?&
&
Demonstration&
•  RTF&
•  WMV&
• Oﬃce&formats&
– .docx&
– .pptx&
– .xlsx&
• PLS&playlists&
• Shortcut&(.lnk)&ﬁles&
• Desktop.ini&ﬁles&
• HTML&
What&formats&are&already&known&to&
allow&this?&
•  HTML&in&IE&
•  Linked&images&in&emails&opened&in&Outlook!&
Other&NTLM&trigger&silliness&
• Document&formats&
• Media&formats&
• Meeting/scheduling&related&formats&
&
What&did&our&work&focus&on?&
• Remote&image&
– No&warning,&no&NTLM&
• App.media.openPlayer()&
– Warning,&NTLM&possible&
• getURL()&
– Warning,&NTLM&possible&
PDF&
• Linked&document&on&UNC&share&
– Warning&(ignored),&NTLM&possible&
RTF&
• Remote&XML&stylesheets&
• Javascript&
SVG&(Scalable&Vector&Graphics)&
• All&these&formats&support&remote&media&
– Even&UNC&paths…&
M3U&/&PLS&/&ASX&
•  ID3&tag&
– LINK&frame&
– APIC&frame&
•  Not&supported&on&
any&major&player&we&
tested&!&
MP3&
•  URLANDEXIT&
•  Launches&default&browser&with&speciﬁed&URL&
•  DRM&functionality&abuse&
•  Subtitles&
•  Can&include&arbitrary&HTML&
ASF&(WMA/WMV/ASF)&
• HTTP&tracker&URLs&in&“announceFlist”&
– As&many&as&you&want&
• URL&seeds&allowed&in&“urlFlist”&
– Clients&can&implement&any&URL&handler&
• Must&support&one&or&both&of&HTTP&&&FTP&
– Not&universally&supported&
TORRENT&
• Free/Busy&URL&
– No&warning,&NTLM&possible&
– Requires&speciﬁc&actions&by&recipient&
VCF&(vCard&format)&
• VALARM&
– ATTACH&parameter&is&a&URL&
– AUDIO&and&PROCEDURE&alarm&types&
&
• ICS&is&the&iCalendar&format&
– Not&even&Calendar.app&will&let&you&accept&
PROCEDURE&!&
ICS&(iCalendar&format)&
• Email&
• Open&ﬁle&share&
• Watering&hole&
• P2P&distribution&
• Honeypot&
Delivery&methods&
• Dystopian&future&DRM&could&call&home&
– Probably&already&does&in&some&cases&
• Goes&beyond&deterrence&into&identiﬁcation&
Digital&Rights&Management&
• Imagine&being&a&whistleblowerFtoFbe&
– In&a&fascist&country&
• The&document&you&exﬁltrate&calls&home&
– From&your&work&computer&
– From&your&home&computer&
– From&your&friend’s&home&
– From&your&lawyer’s&oﬃce&
– From&a&journalist’s&oﬃce&
• You&get&disappeared&
&
Data&Loss&Prevention&
• Tor&Browser&only&routes&
browser&traﬃc&through&
Tor&
– External&programs&don’t&
route&through&Tor&
• You&don’t&control&that&
jihad&wiki&
– But&maybe&you&can&
upload&a&bugged&PDF&
DeFAnonymization&
• Windows&will&autoFauth&when&accessing&SMB&
• Files&can&in&some&cases&initiate&SMB&traﬃc&
– Embedding&remote&ﬁle://&resources&
– UNC&path&as&ﬁle&
– Javascript/other&active&content&
• NTLM&auth&can&be&cracked&or&relayed&
NTLM&Credential&Capture/Relay&
NTLM&overview&
Server&
Client&
1.&Negotiate&
2.&Challenge&
3.&Authenticate&
NTLM&relay&overview&
Server&
Client&
Attacker&
• Initiating&traﬃc&from&privileged&positions&is&fun&
– Exploit&router&vulns&
– Exploit&NAS/Printers&
– Exploit&IoT&devices&
CSRF&
• AV?&
– Too&many&formats&and&variations&
– Possibility&of&false&positives&
• Format&changes?&
– Too&much&inertia,&too&many&formats&
• ApplicationFlevel&ﬁrewalls?&
– Easy&for&RTF&
– Not&so&easy&for&M3U&
&
Possible&Mitigations&
•  Warnings?&
•  Proxychains&with&strict_chain&and&bad&proxy&
- Doesn’t&work&for&some&applications&
•  Egress&ﬁltering?&
- Doesn’t&stop&internal&connections&
- Might&stop&legitimate&functionality&
Possible&Mitigations&
Questions?&
Daniel#Crowley,#Damon#Smith#