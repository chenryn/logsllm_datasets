179
第18章 控制流结构
下载
输入有效部门号：
输入无效部门号：
输入无效的报表类型：
18.4.6 缺省变量值
如果在读变量时输入回车键，不一定总是退出脚本。可以先测试是否已设置了变量，如
果未设置，可以设置该值。
下面的脚本中，要求用户输入运行报表日期。如果用户输入回车键，则使用缺省日期星
期六，并设置为变量w h e n的取值。
如果用户输入另外一天，这一天对于c a s e语句是运行的有效日期，即星期六、星期四、星
加入java编程群：524621833
180
第四部分 基础s h e l l编程
下载
期一。注意，这里结合使用了日期缩写作为捕获的可能有效日期。
脚本如下：
对于正确输入：
对于错误输入：
可以推断出c a s e语句有时与if then else语句功能相同，在某些条件下，这种假定是正确
的。
18.5 for循环
f o r循环一般格式为：
for 变量名i n列表
d o
命令1
命令2…
d o n e
加入java编程群：524621833
181
第18章 控制流结构
下载
当变量值在列表里，f o r循环即执行一次所有命令，使用变量名访问列表中取值。命令可
为任何有效的s h e l l命令和语句。变量名为任何单词。 I n列表用法是可选的，如果不用它， f o r
循环使用命令行的位置参数。
i n列表可以包含替换、字符串和文件名，下面看一些例子。
18.5.1 简单的for循环
此例仅显示列表1 2 3 4 5，用变量名访问列表。
运行上述脚本，输出：
18.5.2 打印字符串列表
下面f o r循环中，列表包含字符串“ orange red blue grey”，命令为e c h o，变量名为l o o p，
e c h o命令使用$ l o o p反馈出列表中所有取值，直至列表为空。
也可以在循环体中结合使用变量名和字符串。
结果为：
18.5.3 对for循环使用ls命令
这个循环执行l s命令，打印当前目录下所有文件。
加入java编程群：524621833
182
第四部分 基础s h e l l编程
下载
18.5.4 对for循环使用参数
在f o r循环中省去i n列表选项时，它将接受命令行位置参数作为参数。实际上即指明：
for params in"$@"
或
for params in"$*"
下面的例子不使用i n列表选项，f o r循环查看特定参数$ @或$ *，以从命令行中取得参数。
下面的脚本包含i n"$ @"，结果与上面的脚本相同。
对上述脚本采取进一步动作。如果要查看一系列文件，可在 f o r循环里使用f i n d命令，利
用命令行参数，传递所有要查阅的文件。
加入java编程群：524621833
183
第18章 控制流结构
下载
脚本执行时，从命令行参数中取值并使用f i n d命令，这些取值形成- n a m e选项的参数值。
18.5.5 使用for循环连接服务器
因为f o r循环可以处理列表中的取值，现设变量为网络服务器名称，并使用 f o r循环连接每
一服务器。
18.5.6 使用for循环备份文件
可以用f o r循环备份所有文件，只需将变量作为 c p命令的目标参数。这里有一变量 . b a k，
当在循环中使用c p命令时，它作为此命令目标文件名。列表命令为l s。
18.5.7 多文件转换
匹配所有以L P S O开头文件并将其转换为大写。这里使用了 l s和c a t命令。l s用于查询出相
关文件，c a t用于将之管道输出至t r命令。目标文件扩展名为.U C，注意在f o r循环中使用l s命令
时反引号的用法。
加入java编程群：524621833
184
第四部分 基础s h e l l编程
下载
18.5.8 多sed删除操作
下面的例子中，s e d用于删除所有空文件，并将输出导至以 . H O L D . m v为扩展名的新文件
中，m v将这些文件移至初始文件中。
18.5.9 循环计数
前面讨论e x p r时指出，循环时如果要加入计数，使用此命令。下面使用 l s在f o r循环中列出
文件及其数目。
使用w c命令可得相同结果。
18.5.10 for循环和本地文档
在f o r循环体中可使用任意命令。下面的例子中，一个变量包含所有当前登录用户。使用
w h o命令并结合a w k语言可实现此功能。然后f o r循环循环每一用户，给其发送一个邮件，邮件
信息部分用一个本地文档完成。
加入java编程群：524621833
185
第18章 控制流结构
下载
上述脚本的邮件信息输出为：
18.5.11 for循环嵌入
嵌入循环可以将一个f o r循环嵌在另一个f o r循环内：
for 变量名1 in列表1
d o
for 变量名2 in 列表2
d o
命令1
. . .
d o n e
d o n e
下面脚本即为嵌入f o r循环，这里有两个列表A P P S和S C R I P T S。第一个包含服务器上应用
的路径，第二个为运行在每个应用上的管理脚本。对列表 A P P S上的每一个应用，列表
S C R I P T S里的脚本将被运行，脚本实际上为后台运行。脚本使用 t e e命令在登录文件上放一条
目，因此输出到屏幕的同时也输出到一个文件。查看输出结果就可以看出嵌入 f o r循环怎样使
用列表S C R I P T S以执行列表A P P S上的处理。
加入java编程群：524621833
186
第四部分 基础s h e l l编程
下载
18.6 until循环
u n t i l循环执行一系列命令直至条件为真时停止。 u n t i l循环与w h i l e循环在处理方式上刚好
相反。一般w h i l e循环优于u n t i l循环，但在某些时候—也只是极少数情况下，u n t i l循环更加
有用。
u n t i l循环格式为：
until 条件
命令1
. . .
d o n e
条件可为任意测试条件，测试发生在循环末尾，因此循环至少执行一次—请注意这一
点。
下面是一些实例。
18.6.1 简单的until循环
这段脚本不断的搜寻w h o命令中用户r o o t，变量I S - R O O T保存g r e p命令结果。
如果找到了r o o t，循环结束，并向用户s i m o n发送邮件，通知他用户r o o t已经登录，注意
这里s l e e p命令用法，它经常用于 u n t i l循环中，因为必须让循环体内命令睡眠几秒钟再执行，
否则会消耗大量系统资源。
加入java编程群：524621833
187
第18章 控制流结构
下载
18.6.2 监视文件
下面例子中，u n t i l循环不断挂起做睡眠，直至文件/ t m p / m o n i t o r. l c k被删除。文件删除后，
脚本进入正常处理过程。
上述例子是使脚本与其他处理过程协调工作的一种方法。还有另外一种方法使脚本间互
相通信。假定有另一段脚本p r o c e s s . m a i n用于搜集本地网络所有机器的信息并将之放入一个报
表文件。
当脚本p r o c e s s . m a i n运行时，创建了一个 L C K文件（锁文件），上面脚本必须接收
p r o c e s s . m a i n搜集的信息，但是如果p r o c e s s仍然在修改报表文件时试图处理该文件就不太好
了。
为克服这些问题，脚本p r o c e s s . m a i n创建了一个L C K文件，当它完成时，就删除此文件。
上述脚本将挂起，等待L C K文件被删除，一旦L C K文件删除，上述脚本即可处理报表文
件。
18.6.3 监视磁盘空间
u n t i l循环做监视条件也很有用。假定要监视文件系统容量，当它达到一定水平时通知超
级用户。
下面的脚本监视文件系统/ l o g s，不断从变量$L O O K_O U T中抽取信息，$ L O O K _ O U T包
含使用a w k和g r e p得到的/ l o g s容量。
如果容量达到9 0 %，触发命令部分，向超级用户发送邮件，脚本退出。必须退出，如果
不退出，条件保持为真（例如，容量总是保持在 9 0 %以上），将会不断的向超级用户发送邮
件。
加入java编程群：524621833
188
第四部分 基础s h e l l编程
下载
18.7 while循环
w h i l e循环用于不断执行一系列命令，也用于从输入文件中读取数据，其格式为：
while 命令
d o
命令1
命令2
. . .
d o n e
虽然通常只使用一个命令，但在 w h i l e和d o之间可以放几个命令。命令通常用作测试条
件。
只有当命令的退出状态为0时，d o和d o n e之间命令才被执行，如果退出状态不是 0，则循
环终止。
命令执行完毕，控制返回循环顶部，从头开始直至测试条件为假。
18.7.1 简单的while循环
以下是一个基本的 w h i l e循环，测试条件是：如果 C O U N T E R小于5，那么条件返回真。
C O U N T E R从0开始，每次循环处理时，C O U N T E R加1。
运行上述脚本，返回数字1到5，然后终止。
18.7.2 使用while循环读键盘输入
w h i l e循环可用于读取键盘信息。下面的例子中，输入信息被设置为变量 F I L M，按结束循环。
加入java编程群：524621833
189
第18章 控制流结构
下载
脚本运行时，输入可能是：
18.7.3 用while循环从文件中读取数据
w h i l e循环最常用于从一个文件中读取数据，因此编写脚本可以处理这样的信息。
假定要从下面包含雇员名字、从属部门及其I D号的一个文件中读取信息。