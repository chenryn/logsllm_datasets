4）得到的文法适用于自顶向下的语法分析吗？
3）提取左公因子之后，从原文法中消除左递归。
2）提取左公因子的变换能使这个文法适用于自顶向下的语法分析技术吗？
1）对这个文法提取左公因子。
练习4.2.2(3)的文法
 matchedStint→if expr then matchedStmt else stmt
rprimary→a I b 
rexpr—→rexpr + rtern |rterm
expr_list → expr_list , cxpr
stint if expr then stmt
I other
ImatchedStmt
|expr
→ id (expr_list)
137
---
## Page 154
绍一些计算 FIRST 和 FOLLOW 集合的方法。根据一个文法的 FIRST 和 FOLLOW 集合，我们将构
LL(k)文法类。我们在4.4.3节中将讨论 LL(1)文法类，但是在介绍预备知识的 4.4.2 节中将介
中选择正确的产生式。
个 E"结点上选择的产生式是 E→。预测分析器通过查看下一个输入符号就可以在两个E'产生式
号为 E'的结点。在(按照前序遍历次序的)第-个 E'结点上选择的产生式是E'→+TE'；在第二
进行回溯，以找到要应用的正确A产生式。2.4.2节介绍的预测分析技术是递归下降分析技术的
符号和输入相匹配。
个产生式。一旦选择了某个A产生式，语法分析过程的其余部分负责将相应产生式体中的终结
最左推导序列。这里重复--下这个文法：
例4.27
自顶向下语法分析也可以被看作寻找输入串的最左摊导的过程。
生式。通常情况下我们只需要向前看一个符号(即只看下一个输人符号)。
个特例，它不需要进行回溯。预测分析技术通过在输人中向前看固定多个符号来选择正确的 A
比如，考虑图4-12中的自顶向下语法分析过程，它构造出了一棵语法分析树，其中有两个标
138
对于有些文法，我们可以构造出向前看k个输入符号的预测分析器,这一类文法有时也称为
该语法分析树序列对应于这个输人的一个最左推导。
图4-12 中对应于输人id＋idid的语法分析树序列是一个根据文法(4.2)进行的
产一
E
E-H
图4-12id+id*id的自顶向下分析
山
二句
勺
F-→(E)  id
丨山*←
E'→+ TE'1 ∈
+
9
闷
一
L
L
心
购
一
——#
F
/
网
T
3
第4章
(4.28)
口
---
## Page 155
向的位置。这意味着 A 的过程必须将输人指针存放在一个局部变量中。
回到A，查看是否还有尚未尝试过、但有可能匹配的其他A 产生式。
个输人符号，并将d和下一个叶子结点(标号为b)比较。因为6和d不匹配，我们报告失败，并
A，得到图4-14b 所示的树。第二个输入符号α得到匹配，因此我们将输入指针推进到d，即第三
个标号为A的叶子结点。
指针推进到α，即 w的第二个符号，并考虑下-
它和输人w的第一个符号匹配，因此我们将输
图4-14a中的树。最左边的叶子结点的标号为
的结点，输入指针指向c，即w的第一个符号。
析树时，初始的语法分析树只包含一个标号为，
例4.29
们第一次到达第1行时的位置。因此,需要一个
个A产生式，我们需要把输人指针重新设置到我
们才会宣称找到了一个输人错误。为了尝试另一
式，
比如练习 4.4. 9 中的动态程序规划算法或者Earley 方法(参见参考文献）。
伪代码是不确定的，因为它没有描述如何在开始时刻选择A产生式。
执行从开始符号对应的过程开始，如果这个过程的过程体扫描了整个输人串，它就停止执行并宣
4.4.1递归下降的语法分析
恢复问题。
过递归调用隐式地维护--个栈。最后，我们将在4. 4.5 节中讨论自顶向下语法分析过程中的错误
使
局
而
使
布
于自底向上语法分析。
造出“预测分析表”
有一个产生式，因此我们用它来展开S，得
部变量来保存这个输人指针，以供将来回溯时
仅仅是建议我们返回到第1行并尝试另一个A产生式。只有当再也没有A产生式可尝试时，
在自然语言语法分析这样的场合，回溯也不是很高效，因此人们更加倾向于基于表格的方法，
序设计语言的构造进行语法分析时很少需要回溯，因此需要回溯的语法分析器并不常见。
用。
A 的第二个选项产生了图 4-1lc 所示的树。叶子结点α和u 的第二个符号匹配，叶子结点 d
在回到A 时，我们必须把输入指针重新设置到位置2，即我们第一次尝试展开A 时该指针指
现在我们使用第－-个 A 产生式 A→ab 来展开
我们必须按照某个顺序逐个尝试这些产生式。那么,第7行上的失败并不意味着最终失败，
通！
1
要支持回溯,就需要修改图 4-13 的代码。首先，因为我们不能在第1行选定唯－的A 产生
一个递归下降语法分析程序由一组过程组成，每个非终结符号有一个对应的过程。程序的
在
法
自顶向下地构造输人串 w= cad 的语法
通用的递归下降分析技术可能需要回溯。也就是说，它可能需要重复扫描输人。然而，在对
分析
考虑文法
A→a bIa
S→c A d
，它说明了如何在自顶向下语法分析过程中选择产生式。这些集合也可以用
>
C
S
分
S
图 4-13在自顶向下语法分析器中一个
void AO
非终结符号对应的典型过程
for (i=)
语法分析过程的步骤
选择—个A产生式，A→XX.··Xk:
4-14
一个自顶向下
调用过程X：（
139
，我
即
---
## Page 156
对所有的i，∈都在FIRST(X;)中，那么将∈加人到 FIRST(X,X2·X,）中。
果ε在FIRST(X,)和 FIRST(X2)中，加人FIRST(X)中的所有非ε符号,依此类推。最后，如果
人F(X,)中所有的非ε符号。如果∈在FIRST（X,）中，再加人FIRST(X2）中的所有非ε符号；如
FIRST(Y2)，依此类推。
导出∈，那么我们就不会再向FIRST（X)中加入任何符号，但是如果Y，→e，那么我们就加上
将ε加人到 FIRST(X)中。比如，FIRST(Y,)中的所有符号一定在 FIRST(X)中。如果 Y 不能推
FIRST(X)中。也就是说,Y…·Y-→e。如果对于所有的j=1,2，…，，ε在FIRST(Y,)中，那么
i，a
以被加入到任何 FIRST集合中为止。
FOLLOW（A)中。回忆-下，$是一-个特殊的“结束标记”符号，我们假设它不是任何文法的符号。
这样，这些符号会推导得到ε并消失。另外，如果A是某些句型的最右符号，那么$也在
和β是文法符号串。请注意，在这个推导的某个阶段,A和α 之间可能存在一些文法符号。但如果
也就是说，如果存在如图4-15 所示形如S→αAaβ 的推导，终结符号α就在 FOLLOW（A）中，其中（
研究这个思想。
在两个集合中。比如，如果α在FIRST(β)中,就选择A→β。在4.4.3 中定义 LL(1)文法时将深人
以在这两个A 产生式中进行选择。因为α 只能出现在 FIRST(α)或FIRST(β)中，但不能同时出现
相交的集合。那么我们只需要查看下一个输入符号α，就可
虑两个 A产生式 A→α”β,其中 FIRST(α)和 FIRST(β)是不
FIRST(A)中。
FIRST（α）中。比如在图4-15 中，A →cy，因此c在
合，其中α是任意的文法符号串。如果α→e，那么∈也在
为同步词法单元。
号来选择应用哪个产生式。在恐慌模式的错误恢复中，由FOLLOW产生的词法单元集合可以作
LOW来实现。在自顶向下语法分析过程中，FIRST 和 FOLLOW使得我们可以根据下一个输入符
4. 4. 2 FIRST 和 FOLLOW 
何输人符号就再次试图展开 A。
分析器也是如此。也就是说，当我们试图展开一个非终结符号A 的时候，我们可能会没有读入任
成功完成了语法分析。
和第三个符号相匹配。
计算各个文法符号X的FIRST(X)时，不断应用下列规则，直到再没有新的终结符号或ε可
对于非终结符号A，FOLLOW(A)被定义为可能在某些句型中紧跟在A 右边的终结符号的集合。
我们先简单介绍一下如何在预测分析中使用 FIRST。考
FIRST(α)被定义为可从α推导得到的串的首符号的集
自顶向下和自底向上语法分析器的构造可以使用和文法G相关的两个函数 FIRST和 FOL
140
计算所有非终结符号A的 FOLLOW(A)集合时，不断应用下面的规则，直到再没有新的终结
现在,我们可以按照如下方式计算任何串X,X2…-X,，的 FIRST 集合。向 FIRST（X,X2·X,）加
3）如果 X-→e 是一个产生式，那么将ε加人到 FIRST(X)中。
2)如果X是一个非终结符号，且X→YY·Y;是一个产生式，其中k≥1，那么如果对于某个
1）如果X是--个终结符号，那么FIRST（X）=X。
因为我们已经产生了一棵w的语法分析树，所以我们停止分析并宣称已
图4-15终结符号c在FIRST(A)
中且α在FOLLOW(A)中
第4章
口
Q
---
## Page 157
表示在每一步中只需要向前看一个输人符号来决定语法分析动作。
器。LL(1)中的第一个“L”表示从左向右扫描输人，第二个“L”表示产生最左推导，而“1”则
4. 4.3 LL(1)文法
FOLLOW(T') = FOLLOW(T)。
右括号出现在 FOLLOW(T)中的原因。至于T"，因为它只出现在T产生式的尾部，因此必然有
FOLLOW（T)中的原因。然而，因为FIRST（E')包含∈（即E'→E），且E'就是在E产生式的体中
后面。因此，FIRST(E'）中除ε之外的所有符号一定都在FOLLOW（T)中。这解释了+出现
出现在E产生式的体的尾部,因此FOLLOW（E'）必然和FOLLOW（E)相同。
$。产生式体（E）说明了右括号为什么在FOLLOW（E)中。对于E'，请注意这个非终结符号
集合中。
且另一个产生式的体为é。只要--个非终结符号推导出e，我们就会把e放到该终结符号的FIRST
推导出,所以 FIRST(T)必然和 FIRST(F)相同。对于 FIRST(E)也可以做同样的论证。
体以终结符号id和左括号开头。T只有一个产生式，而该产生式的体以F开头。又因为F不能
例4.30
FOLLOW(A)中的所有符号都在FOLLOW（B)中。
FOLLOW(B)中。
符号可以被加人到任意 FOLLOW集合中为止。
示当该词法单元是下一个输人符号时我们应该执行这个转换。非..．…符号A上的转换表示对
边的标号为X、X2、Xn。如果 A→e,那么这条路径就是一条标号为∈的边。
在
号都有一个图。图中边的标号可以是词法单元,也可以是非终结号。词法单元上的转换表
后对每个非终结符号A：
和E"的转换图。要构造一个文法的转换图,首先要消除左递归,然后对文法提取左公因子。然