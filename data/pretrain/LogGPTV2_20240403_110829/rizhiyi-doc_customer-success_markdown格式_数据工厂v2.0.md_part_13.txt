警告：状态对象最适用于固定或静态数据集。在每个记录或批处理上添加缓存可以快速消耗分配给Data
Collector的内存并导致内存不足异常。
3、log日志
将消息写入日志的对象。包括四种方法：info（），warn（），debug（）和trace（）。
四种方法的签名如下：
*(message-template, arguments\...)*
消息模板可以具有由大括号表示的位置变量：{}。参数在消息模板大括号中以位置方式替换，即，这是第一个{}出现的第一个参数，依此类推。
4、output
将记录写入输出批处理的对象。包括写（Record）方法。
5、error
将错误记录传递给处理器以进行错误处理的对象。包括写（记录，消息）方法。
6、sdcFunctions
运行评估或修改数据的函数的对象。
sdcFunctions在Data Collector Edge管道中无效。不要在Data Collector
Edge管道的脚本中使用sdcFunctions对象。
sdcFunctions对象包括以下方法：
-   getFieldNull（Record，\'field path\'） -
    检查字段是否被赋予常量的方法，例如NULL_INTEGER或NULL_STRING。
-   createRecord（\'recordId\'） - 使用指定的字段和值创建新记录的方法。
    recordId是唯一标识记录的字符串。它应该包含足够的信息来跟踪记录源。
-   createMap（boolean listMap） -
    创建用作记录中字段的映射的方法。传递true以创建列表映射字段，或传递false以创建映射字段。
-   createEvent（String type，int version） -
    使用指定的事件类型和版本创建新事件记录的方法。确保在实现事件方法之前在阶段中启用事件生成。
-   toEvent（Record） -
    将事件记录发送到Event输出流的方法。确保在实现事件方法之前在阶段中启用事件生成。
##### 处理List-map
在处理列表映射数据的脚本中，将数据视为映射。
List-map是一种Data
Collector数据类型，允许您使用标准记录函数来处理分隔数据。当原点读取分隔数据时，默认情况下会生成列表映射字段。
JavaScript
Evaluator可以读取并传递列表映射数据。但要处理列表映射字段中的数据，请将该字段视为脚本中的映射。
##### 类型处理
虽然JavaScript在处理数据时不使用类型信息，但是将数据传递到管道的其余部分需要数据类型。使用JavaScript
Evaluator处理器时，请注意以下类型信息：
1、空值的数据类型
您可以将空值与数据类型相关联。例如，如果脚本为"整数"字段分配空值，则该字段将作为具有空值的整数返回到管道。
使用JavaScript代码中的常量来创建具有空值的特定数据类型的新字段。例如，您可以通过将NULL_STRING类型常量分配给字段来创建具有空值的新String字段，如下所示：
*records\[i\].value.new_field = NULL_STRING*
2、日期字段
使用String数据类型创建新字段以存储具有特定格式的日期。
例如，以下示例代码创建一个新的String字段，该字段使用格式YYYY-MM-dd存储当前日期：
*// Define a date object to record the current date*
*var date = new Date()*
*for(var i = 0; i \，\） -
    使用指定的事件类型和版本号创建事件记录。您可以创建新事件类型或使用现有事件类型。现有事件类型记录在其他事件生成阶段中。
> 事件记录不包含记录字段。根据需要生成记录字段。
-   sdcFunctions.toEvent（Record） - 用于将事件传递给事件输出流。
##### 使用记录标头属性
您可以使用JavaScript Evaluator处理器来读取，更新或创建记录头属性。
创建或更新标题属性时使用映射。如果存在标头属性，则脚本会更新该值。如果它不存在，脚本将创建该属性并将其设置为指定的值。
所有记录都包含一组只读记录标题属性，这些属性可以在处理记录时更新。错误记录也有自己的只读标头属性集。
某些阶段生成自定义记录标题属性，这些属性旨在以特定方式使用。例如，Oracle
CDC Client
origin指定记录头属性中记录的操作类型。事件生成阶段为事件记录创建一组事件头属性。有关更多信息，请参阅记录标题属性。
您可以使用以下记录标头变量来处理标头属性：
-   record.\ - 用于返回只读标头属性的值。
-   record.attributes -
    用于返回自定义记录标题属性的映射，或用于创建或更新特定记录标题属性。
提示：使用数据预览查看记录中包含的记录标题属性。
查看记录标头属性
您可以使用数据预览来查看与管道中任何给定点的记录关联的记录标头属性。要查看记录标题属性，请启用"显示记录/字段标题"数据预览属性。
例如，下图显示了数据预览中目录原点生成的记录。
![https://streamsets.com/documentation/datacollector/latest/help/datacollector/UserGuide/Graphics/HeaderAttribute-Preview.png](media/image94.png){width="3.654902668416448in"
height="2.62412510936133in"}
"Record
Header"列表显示管道此时记录中的只读内部属性集。您可以使用record.\变量来返回这些属性的值。
"values"下的标题属性是目录源创建的属性。您可以使用record.attributes变量来返回或修改这些属性。使用record.attributes变量创建标题属性时，它会在数据预览期间显示在此位置。
##### 访问整个文件格式记录
在处理整个文件数据格式的管道中，您可以使用JavaScript
Evaluator来读取整个文件数据。
处理器可以通过使用getInputStream()API创建输入流来访问整个文件记录中的fileref（文件引用）字段。例如，您可以使用处理器读取fileref字段中的文件数据，然后使用数据创建新记录。处理器可以访问fileref字段，但不能修改字段中的信息。
使用以下行创建然后读取输入流：
*input_stream = record.value\[\'fileRef\'\].getInputStream()*
*input_stream.read()*
处理器读取输入流后，在代码中包含以下行以关闭输入流：
*input_stream.close()*
##### 调用外部Java代码
您可以从JavaScript Evaluator调用外部Java代码。
只需安装外部Java库，即可将其用于JavaScript Evaluator。
然后，从为处理器开发的脚本中调用外部Java代码。
有关安装其他驱动程序的信息，请参阅安装外部库。
注意：JavaScript Evaluator包含在Data Collector基本阶段库中。
为JavaScript Evaluator安装外部Java库时，必须使其可以访问基本阶段库。
要调用外部Java代码，只需在脚本中获取对Java类型的引用，如下所示：
*var \ = Java.type(\'\.\\');*
例如，假设您安装了Bouncy Castle
JAR文件来计算SHA-3（安全哈希算法3）摘要。 将以下语句添加到脚本中：
*var DigestSHA3 =
Java.type（\'org.bouncycastle.jcajce.provider.digest.SHA3.DigestSHA3\'）;*
##### 配置JavaScript评估程序
配置JavaScript Evaluator以在管道中使用自定义JavaScript。
(1)在"属性"面板的"常规"选项卡上，配置以下属性：
+---------------+------------------------------------------------------+
| **常规属性**  | **说明**                                             |
+===============+======================================================+
| 姓名          | 阶段名称                                             |
+---------------+------------------------------------------------------+
| 说明          | 可选说明                                             |
+---------------+------------------------------------------------------+
| [Required     | 必须包含要传递到阶段的记录的数据的字段。             |
| Fie           |                                                      |
| lds](https:// | 提示：您可以包括阶段使用的字段。                     |
| streamsets.co |                                                      |
| m/documentati | 不包括所                                             |
| on/datacollec | 有必需字段的记录将根据为管道配置的错误处理进行处理。 |
| tor/latest/he |                                                      |
| lp/datacollec |                                                      |
| tor/UserGuide |                                                      |
| /Pipeline_Des |                                                      |
| ign/DroppingU |                                                      |
| nwantedRecord |                                                      |
| s.html#concep |                                                      |
| t_dnj_bkm_vq) |                                                      |
+---------------+------------------------------------------------------+
| [Preconditi   | 必须计算为true才能允许                               |
| ons](https:// | 记录进入处理阶段的条件。单击添加以创建其他前提条件。 |
| streamsets.co |                                                      |
| m/documentati | 不满足所                                             |
| on/datacollec | 有前提条件的记录将基于为阶段配置的错误处理进行处理。 |
| tor/latest/he |                                                      |
| lp/datacollec |                                                      |
| tor/UserGuide |                                                      |
| /Pipeline_Des |                                                      |
| ign/DroppingU |                                                      |
| nwantedRecord |                                                      |
| s.html#concep |                                                      |
| t_msl_yd4_fs) |                                                      |
+---------------+------------------------------------------------------+
| [On Record    | 阶段的错误记录处理：                                 |
| Error         |                                                      |
| ](https://str | 丢弃-丢弃记录。                                      |
| eamsets.com/d |                                                      |
| ocumentation/ | 发送到错误-将记录发送到管道以进行错误处理。          |
| datacollector |                                                      |
| /latest/help/ | 停止管道-停止管道。                                  |
| datacollector |                                                      |
| /UserGuide/Pi |                                                      |
| peline_Design |                                                      |
| /ErrorHandlin |                                                      |
| g.html#concep |                                                      |
| t_atr_j4y_5r) |                                                      |
+---------------+------------------------------------------------------+
(2)在JavaScript选项卡中，配置以下属性：
+------------------+---------------------------------------------------+
| **JavaScript     | **说明**                                          |
| Evaluator        |                                                   |
| Property**       |                                                   |
+==================+===================================================+
| Record           | 确定JavaScript Evaluator如何处理数据：            |
| Processing Mode  |                                                   |
|                  | •按记录 - 单独处理记录。 执行错误处理。           |
|                  |                                                   |
|                  | •批处理 - 批量处理记录。                          |
|                  | 需要脚本中的错误处理代码。                        |
|                  |                                                   |
|                  | 默认为批量批处理。                                |
+------------------+---------------------------------------------------+
| Init Script      | 要使用的可选初始化脚本。                          |
|                  |                                                   |
|                  | 用于设置任何所需的连接或资源。                    |
|                  | 管道启动时运行一次。                              |
+------------------+---------------------------------------------------+
| Script           | 要使用的主要处理脚本。                            |
|                  |                                                   |
|                  | 根据配置的处理模式运行每个记录或每批数据。        |
+------------------+---------------------------------------------------+
| Destroy Script   | 要使用的可选销毁脚本。                            |
|                  |                                                   |
|                  | 用于关闭所使用的任何连接或资源。                  |
|                  | 管道停止时运行一次。                              |
+------------------+---------------------------------------------------+
#### Json Parser
JSON解析器解析嵌入在字符串字段中的JSON对象，并将解析的数据传递到记录中的输出字段。根据JSON对象的内容，结果字段可以是字符串，映射或数组。
配置JSON解析器以解析String字段中的JSON对象。
配置JSON解析器时，请指定要解析的字段和要使用的输出字段。
(1)在"属性"面板的" 常规"选项卡上，配置以下属性：
+-----------------+----------------------------------------------------+
| **一般属性**    | **描述**                                           |
+=================+====================================================+
| Name            | 阶段名称                                           |
+-----------------+----------------------------------------------------+
| Description     | 可选说明。                                         |
+-----------------+----------------------------------------------------+
| Required Fields | 必须包含用于将记录传递到阶段的记录的数据的字段。   |
|                 |                                                    |
|                 | 提示：您可能包括使用的字段。                       |
|                 |                                                    |
|                 | 根据为                                             |
|                 | 管道配置的错误处理，处理不包含所有必填字段的记录。 |
+-----------------+----------------------------------------------------+
| Preconditions   | 必须评估为TRUE的条件才能                           |
|                 | 使记录进入处理阶段。单击 添加以创建其他前提条件。  |
|                 |                                                    |
|                 | 根据为                                             |
|                 | 阶段配置的错误处理，处理不满足所有前提条件的记录。 |
+-----------------+----------------------------------------------------+
| On Record Error | 该阶段的错误记录处理：                             |
|                 |                                                    |