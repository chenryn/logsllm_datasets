www.senseofsecurity.com.au 
© Sense of Security 2013  
Page ‹#›  – 13-Sep-13  
Compliance, Protection & Business Confidence  
Sense of Security Pty Ltd 
!
Sydney 
Level 8, 66 King Street  
Sydney NSW 2000    Australia
Melbourne 
Level 10, 401 Docklands Drv 
Docklands VIC 3008 Australia
T: 1300 922 923 
T: +61 (0) 2 9290 4444 
F: +61 (0) 2 9290 4455
PI:EMAIL 
www.senseofsecurity.com.au 
ABN: 14 098 237 908
VoIP Wars:  
Attack of the Cisco Phones
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Speaker
• Fatih Ozavci  
• Senior Security Consultant 
• Interests 
• VoIP 
• Mobile Applications 
• Network Infrastructure 
!
• Author of Viproy VoIP Penetration Testing Kit 
• Public Speaker 
• Defcon, BlackHat Arsenal, AusCert, Ruxcon
2
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Viproy VoIP Toolkit
• Viproy is a Vulcan-ish Word that means "Call" 
• Viproy VoIP Penetration and Exploitation Kit 
• Testing modules for Metasploit, MSF license 
• Old techniques, new approach 
• SIP library for new module development 
• Custom header support, authentication support 
• Trust analyser, SIP proxy bounce, MITM proxy, Skinny 
• Modules 
• Options, Register, Invite, Message 
• Brute-forcers, Enumerator 
• SIP trust analyser,SIP proxy, Fake service 
• Cisco Skinny analysers 
• Cisco UCM/UCDM exploits
3
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Agenda
4
Hosted VoIP 101
Network Attacks
Attacking CUCDM
Attacking CUCM
Attacking SIP
Attacking 
Clients
Attacking 
Skinny
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Hosted VoIP services
5
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Hosted VoIP environment
• Vendors are Cisco and VOSS Solutions 
• Web based services 
• IP Phone services (Cisco, VOSS* IP Phone XML Services) 
• Tenant client services management (VOSS* Selfcare) 
• Tenant* services management (VOSS* Domain Manager) 
• VoIP services 
• Skinny (SCCP) services for Cisco phones 
• SIP services for other tenant phones 
• RTP services for media streaming 
• PBX/ISDN gateways, network equipment   
!
* Tenant => Customer of hosted VoIP service 
* VOSS  => VOSS Solutions, hosted VoIP provider & Cisco partner 
* VOSS a.k.a Voice Over Super Slick, created by Jason Ostrom
6
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Discovery for hosted VoIP networks
• Discover VoIP network configuration, design and 
requirements 
• Find Voice VLAN and gain access 
• Gain access using PC port on IP Phone 
• Understand the switching security for: 
• Main vendor for VoIP infrastructure 
• Network authentication requirements 
• VLAN ID and requirements 
• IP Phone management services 
• Supportive services in use
7
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Protected and isolated?
8
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Switching manipulation
• Attack Types 
• PC Ports of the IP phone and handsets 
• CDP sniffing/spoofing for Voice VLAN 
• DTP and VLAN Trunking Protocol attacks 
• ARP spoofing for MITM attacks 
• DHCP spoofing & snooping 
• Persistent access 
• Tapberry Pi (a.k.a berry-tap) 
• Tampered phone 
• Power over ethernet (PoE) 
• 3G/4G for connectivity
9
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
How to make your own Tapberry Pi
10
RJ45 Connection Pins
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
How to make your own Tapberry Pi
11
Speaker Power
Patch the Cat5 cable
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Attacking the TFTP server
• Obtaining configuration files for MAC addresses 
• SEPDefault.cnf, SEPXXXXXXXXXXXX.cnf.xml 
• SIPDefault.cnf, SIPXXXXXXXXXXXX.cnf.xml 
• Identifying SIP, Skinny, RTP and web settings 
• Finding IP phone software and updates 
• Configuration files may contain credentials 
• Digital signature/encryption usage for files 
!
!
!
Tip: TFTPTheft, Metasploit, Viproy TFTP module
12
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Configuration file content
• SCCP!
• !
• !
!
• 1!
• 1!
• 0!
• 1!
• 1!
!
• 
13
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Becoming the TFTP server
• Send fake configurations for 
• HTTP server 
• IP phone management server 
• SIP server and proxy 
• Skinny server 
• RTP server and proxy 
• Deploy SSH public keys for SSH on IP Phones 
• Update custom settings of IP Phones 
• Deploy custom OS update and code execution 
!
Tip: Metasploit TFTP & FakeDNS servers, Viproxy 
14
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Cisco Hosted Collaboration Suite
• Cisco UC Domain Manager 
• VOSS IP Phone XML services 
• VOSS Self Care customer portal 
• VOSS Tenant services management 
• Cisco UC Manager  
• Cisco Unified Dialed Number Analyzer  
• Cisco Unified Reporting  
• Cisco Unified CM CDR Analysis and Reporting 
!
• Multiple Vulnerabilities in Cisco Unified 
Communications Domain Manager 
http://tools.cisco.com/security/center/content/
CiscoSecurityAdvisory/cisco-sa-20140702-cucdm   
15
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
VOSS Self Care
Tenant user services 
• Password & PIN management 
• Voicemail configuration 
• Presence  
• Corporate Directory access 
• Extension mobility 
!
Weaknesses 
• Cross-site scripting vulnerabilities
16
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Account details stored XSS 
17
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
VOSS domain manager
• Tenant administration services 
• User management 
• Location and dial plan management 
• CLI and number translation configuration 
!
Weaknesses 
• User enumeration  
• Privilege escalation vulnerabilities  
• Cross-site scripting vulnerabilities 
• SQL injections and SOAP manipulations
18
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Errors, Information Leakage
/emapp/EMAppServlet?device=USER  
!
!
!
!
/bvsm/iptusermgt/disassociateuser.cgi 
19
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Insecure File Upload
/bvsm/iptbulkadmin  
/bvsm/iptbulkloadmgt/bulkloaduploadform.cgi  
20
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Privilege Escalation
/bvsm/iptusermgt/moduser.cgi (stored XSS, change users’ role) 
/bvsm/iptadminusermgt/adduserform.cgi?user_type=adminuser  
!
!
!
!
!
/bvsm/iptnumtransmgt/editnumbertranslationform.cgi?id=1 
!
21
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
IP Phone management
VOSS IP Phone XML services 
• Shared service for all tenants 
• Call forwarding (Skinny has, SIP has not) 
• Speed dial management 
• Voicemail PIN management 
http://1.2.3.4/bvsmweb/SRV.cgi?device=ID&cfoption=ACT  
22
Services 
• speeddials 
• changepinform 
• showcallfwd 
• callfwdmenu
Actions 
• CallForwardAll 
• CallForwardBusy
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
IP Phone management
• Authentication and Authorisation free! 
• MAC address is sufficient 
• Jailbreaking tenant services 
!
• Viproy Modules 
• Call Forwarding 
• Speed Dial
23
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Demonstration of VOSS attacks
24
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Unified Communications
• Forget TDM and PSTN 
• SIP, Skinny, H.248, RTP, MSAN/MGW 
• Smart customer modems & phones 
!
• Cisco UCM  
• Linux operating system 
• Web based management services 
• VoIP services (Skinny, SIP, RTP) 
• Essential network services (TFTP, DHCP) 
• Call centre, voicemail, value added services 
25
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Discovering VoIP servers
• Looking for 
• Signalling servers (e.g. SIP, Skinny, H.323, H.248) 
• Proxy servers (e.g. RTP, SIP, SDP) 
• Contact Centre services 
• Voicemail and email integration 
• Call recordings, call data records, log servers 
!
• Discovering 
• Operating systems, versions and patch level 
• Management services (e.g. SNMP, Telnet, HTTP, SSH) 
• Weak or default credentials
26
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Attacking SIP services
• Essential analysis 
• Registration and invitation analysis 
• User enumeration, brute force for credentials 
• Discovery for SIP trunks, gateways and trusts 
• Caller ID spoofing (w/wo register or trunk) 
!
• Advanced analysis 
• Finding value added services and voicemail 
• SIP trust hacking 
• SIP proxy bounce attack
27
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Cisco specific SIP registration
• Extensions (e.g. 1001) 
• MAC address in Contact field 
• SIP digest authentication (user + password) 
• SIP x.509 authentication 
• All authentication elements must be valid! 
!
• Good news, we have SIP enumeration inputs! 
Warning: 399 bhcucm "Line not configured” 
Warning: 399 bhcucm "Unable to find device/user in database" 
Warning: 399 bhcucm "Unable to find a device handler for the 
request received on port 52852 from 192.168.0.101” 
Warning: 399 bhcucm "Device type mismatch"
28
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Register and Subscribe
29
Register / Subscribe (FROM, TO, Credentials)
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Invite, CDR and Billing tests
30
Invite / Ack / Re-Invite / Update (FROM, TO, VIA, Credentials)
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
SIP Proxy Bounce attack
31
SIP Proxy Bounce Attacks 
• SIP trust relationship hacking 
• Attacking inaccessible servers 
• Attacking the SIP software and protocol 
• Software, Version, Type, Realm