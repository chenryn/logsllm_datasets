mostly demonstrate the results using relatively small synthetic datasets. We will illustrate the
details of the framework in Section 3 and compare the framework with the above-mentioned
methodsinSection4.
3 FASTDIMENSIONALANALYSIS
We propose an RCA framework that is based on the FP-Growth algorithm [13], with multiple
optimizationsforproductiondatasetsinalarge-scaleservicesystem.Afterqueryingthedata,which
ispre-aggregatedusingScuba’sinfrastructure[1],thefirststepinthisframeworkisidentifying
thefrequentitem-setsinthetargetstate,e.g.hardwarefailuresorsoftwareexceptions.Item-setsare
combinationsoffeaturevaluesofthesamples.Inastructureddataset,e.g.Table1,thecolumns
areconsideredthefeatures oftheentities,andeachfeaturecouldhavemultipledistinctvalues
inthedataset.Werefertofeaturevaluesasitemsinthecontextoffrequentpatternmining.For
example,whenanalyzinghardwarefailures,theitemscouldbethesoftwareconfigurationofthe
serversuchasthekernelandfirmwareversions,aswellasthehardwareconfigurationsuchas
thedevicemodelofthevariouscomponents.Whenanalyzingsoftwareerrors,theitemscould
bethememoryallocation,themachineswherethejobsarerun,andtheversionofthesoftware
package.Thenumberofitemsinanitem-setiscalledthelengthoftheitem-set.Item-setswith
greaterlengthsarecomposedofmorefeaturevaluesandarethereforemoredescriptiveaboutthe
samples.
ThesecondstepinRCAischeckingthestrengthoftheassociationsbetweenitem-setsandthe
targetstates.Weproposemultiplepre-andpost-processingstepsforimprovingthescalabilityand
theinterpretabilityoftheframeworkinSection3.5and3.6.
3.1 MetricsforEvaluatingtheCorrelations
ThreemainmetricsaretypicallyconsideredinanRCAframework:support,confidence,andlift.
Wefirstdescribethemeaningbehindthesemetricsinthecontextofrootcauseanalysisandthen
describewhywepickedsupportandliftasourmainmetricstotrack.
Support wasintroducedbyAgrawal,etal.in[2]as
|t ∈D;X ⊆t|
supp(X)= =P(X) (1)
|D|
whereD = {t ,t ,...,t }isadatabasebasedonasetoftransactionst .
1 2 n k
Proc.ACMMeas.Anal.Comput.Syst.,Vol.4,No.2,Article31.Publicationdate:June2020.
31:6 Lin,etal.
SupportofXwithrespecttoDreferstotheportionoftransactionsthatcontainXwithinD.In
ourRCAproblem,D isequivalenttotheentirestructuredlog,whileeachentryisconsidereda
transactiont.Supporthasadownwardclosureproperty,whichisthecentralideabehindApriori
frequentitem-setminingalgorithm.Downwardclosureimpliesthatallsubsetsofafrequentitem-
setarealsofrequent.Analogously,allsupersetsofaninfrequentitem-setcanbesafelypruned
becausetheywillneverbefrequent.Therangeofsupportis[0,1].
Whenminingfrequentitem-sets,thefrequencyofanitem-setisdefinedbasedonthesamplesin
thetargetfailurestate,sowelimitthedatabasetothetransactionsthatcoverthetargetfailure
stateY (e.g.softwarejobstatus=exception).Inthiscontext,supportcanthereforebeformulatedas
frequency(X,Y)
supp(X,Y)= =P(X|Y) (2)
frequency(Y)
Hereafter,werefertosupp(X)asthesupportwithrespecttoalltransactions,andsupp(X,Y)asthe
supportwithrespecttothetransactionscoveringY.
ConfidencewasintroducedbyAgrawaletal.in[2]andisdefinedas
supp(X ∩Y)
conf(X ⇒Y)= =P(Y|X) (3)
supp(X)
Confidence,whichrangesfrom0to1,referstotheprobabilityofX belongingtotransactions
thatalsocontainY.Confidenceisnotdownwardclosedandcanbeusedinassociationrulemining
after frequent item-setsaremined based onsupport. Confidence is used forpruning item-sets
whereconf(X ⇒ Y) < γ,whereγ isaminimumthresholdonconfidence.Usingconfidenceis
likelytomissgoodpredictorsforYunderimbalanceddistributionoflabels.Forexample,suppose
thatwehave100failuresand1millionreferencesamples.IffeatureX existsfor100%offailuresY
but1%ofreferences,intuitivelyX shouldbeagoodpredictorforY;howeverconfidencewillbe
small(< 0.01)duetothelargenumberofreferencesampleswithfeatureX.Forthisreasonweuse
liftinourwork,whichwedefinenext.
Todealwiththeproblemsinconfidence,weusethelift metric(originallypresentedasinterest)
introducedbyBrinetal.[10].Liftisdefinedas
conf(X ⇒Y) P(X ∩Y)
lift(X ⇒Y)= = (4)
supp(Y) P(X)P(Y)
LiftmeasureshowmuchmorelikelythatX andY wouldoccurtogetherrelativetoiftheywere
independent.Aliftvalueof1meansindependencebetweenX andY andavaluegreaterthan1
signifiesdependence.Liftallowsustoaddresstherareitemproblem,whereasusingconfidencewe
maydiscardanimportantitem-setduetoitslowfrequency.Asimilarmeasure,calledconviction,
wasalsodefinedin[10]whichcomparesthefrequencyofX appearingwithoutY,andinthatsense
itissimilartoliftbutconvictioncapturestheriskofusingtheruleifXandYareindependent.
Weuseliftinsteadofconvictionprimarilyduetoasimplerinterpretationoftheresultforour
customers.
3.2 StructuredDataLogging
Structuredlogsarelogswherethepiecesofinformationinaneventaredissectedintoapre-defined
structure.Forexample,inaunstructuredlogwemayrecordhuman-readablemessagesabouta
serverlikethefollowing:
0:00 experienced memory error
0:00 experienced memory error
0:00 experienced memory error
Proc.ACMMeas.Anal.Comput.Syst.,Vol.4,No.2,Article31.Publicationdate:June2020.
FastDimensionalAnalysisforRootCauseInvestigation 31:7
0:15 reboot from tool A
0:20 experienced memory error
0:21 tool B AC Cycled the machine
0:25 no diagnosis found in tool A
0:26 tool C send to repair − undiagnosed
Table1. Servererrorsandrebootsloggedinastructuredtable
timestamp memoryerror cpuerror ... reboot undiag. diag. tool
repair repair
0:00 3 0 0 0 0 NULL
0:15 0 0 1 0 0 A
0:20 1 0 0 0 0 NULL
0:21 0 0 1 0 0 B
0:26 0 0 1 1 0 C
Thereareafewmajordrawbacksinthisexamplelog.First,thesamemessageappearsmultiple
times,whichcanbeaggregatedanddescribedinamoresuccinctwaytosavespace.Second,tool
AandtoolBbothwritetothislog,butinverydifferentformats.ToolAandBbothrestartedthe
serverbyturningthepoweroffandon,buttoolAlogsitas“reboot”,whiletoolB,developedby
anothergroupofengineersfromadifferentbackground,logsitasaverb“ACCycle”.Thiscould
evenhappentothesameword,forexample,“nodiagnosis”and“undiagnosed”inthelasttwo
messagesmeanthesamecondition,butwouldimposehugedifficultywhenonetriestoparsethis
logandcounttheeventswithregularexpressions.
Withapre-definedstructure,i.e.alistoffieldstoputtheinformationin,structuredlogging
requiresacanonicalwaytologevents.Forexample,inastructuredtable,themessagesabovecan
beloggedintheformatshowninTable1.
In this conversion, engineers could decide not to log “no diagnosis found in tool A” in the
structuredtablebecauseitdoesnotfitinthepre-definedstructure.Thestructureofthetableis
flexibleandcanbetailoredtothedownstreamapplication,forexample,insteadofhavingmultiple
columnsformemoryerror,cpuerror,etc.,wecanuseone“error”columnandchooseavaluefrom
apre-definedlistsuchasmemory,cpu,etc.,torepresentthesameinformation.
Inadditiontoremovingtheambiguityinthelogs,enforcingstructuredloggingthroughasingle
APIalsohelpsdevelopersuseandimprovetheexistingarchitectureoftheprogram,insteadof
addingad-hocfunctionalitiesforedgecases,whichintroducesunnecessarycomplexitythatmakes
thecodebasemuchhardertomaintain.Inthisexample,ifthereisonlyoneAPIforloggingareboot,
developersfromtoolAandBwouldlikelyreuseorimproveacommonrebootserviceinsteadof
rebootingtheserversintheirowncodebases.Acommonrebootservicewouldbemucheasierto
maintainandlikelyhaveabetter-designedflowtohandlerebootsindifferentscenarios.
3.3 FrequentPatternMiningandFiltering
OurproposedRCAframeworkinvolvestwosteps:frequentpattern1)miningand2)filtering.
Frequentpatternsinthedatasetarefirstreported,followedbyanevaluationonhowstronglyeach
frequentpatterncorrelatestothetargetfailures.
In frequent pattern mining, each item should be a binary variable representing whether a
characteristicexists.Inaproductionstructureddataset,however,acolumnwouldusuallyrepresent
onefeature,whichcouldhavemultipledistinctvalues,oneforeachentity.Thereforethestructured
Proc.ACMMeas.Anal.Comput.Syst.,Vol.4,No.2,Article31.Publicationdate:June2020.
31:8 Lin,etal.
logneedstofirstbetransformedintoaschemathatfitsthefrequentpatternminingformulation.
The transformation is done by applying one-hot encoding [14] on each of the columns in the
structuredtable.Foracolumninthestructuredtable f,whichhask possiblevaluesinadataset,
one-hotencoding"explodes"theschemaandgeneratek columns{f , f ,..., f },eachcontainsa
0 1 k−1
binaryvalueofwhethertheentitysatisfies f = f .
k
Aprioriisaclassicalalgorithmthatisdesignedtoidentifyfrequentitem-sets. Asillustrated
inAlgorithm1,startingfromfrequentitems,i.e.item-setsatlength=1,thealgorithmgenerates
candidateitem-setsbyaddingoneitematatime,knownasthecandidategenerationprocess.At
eachlengthk,candidategenerationisdoneandallthecandidateitem-setsarescannedtoincrement
thecountoftheiroccurrences.Thentheitem-setsthatmeetthemin-supportthresholdarekeptand
returnedasthefrequentitem-setL .Weaddapracticalconstraintmax-lengthonthemaximum
K
lengthoftheitem-setthatweareinterestedin.Thelimitonmax-lengthstopsthealgorithmfrom
exploringitem-setsthataretoodescriptiveandspecifictothesamples,whicharetypicallyless
usefulinproductioninvestigation.
3.4 ArchitectureofaLarge-ScaleServiceEnvironment
Algorithm1:AprioriAlgorithm
letC bethecandidateitem-setsatlength=k
k
letL bethefrequentitem-setsatlength=k
k
L =frequentitems
1
k =1
whileL (cid:44)ϕ andk ≤max_lenдthdo
k
C k+1=candidateitem-setsgeneratedfromL
k
foreachtransactiont indatabasedo
foreachitem-setc coveredbyt do
incrementthecountofc
end
end
L k+1=item-setsinC k+1thatmeetmin-support
k++
end
return∪L
k
Bygeneratingalargesetofcandidatesandscanningthroughthedatabasemanytimes,Apriori
suffersfromanexponentialruntimeandmemorycomplexity(O(2D)),makingitimpracticalfor
manyproductiondatasets.TheFP-Growthalgorithm,basedonaspecialdatastructureFP-Tree,was
introducedtodealwithperformanceissuesbyleveragingadatastructurethatallowstobypassthe
expensivecandidategenerationstep[13].FP-Growthusesdivide-and-conquerbyminingshort
patternsrecursivelyandthencombiningthemintolongeritem-sets.
Frequent item-set mining through FP-Growth is done in two phases: FP-Tree construction
and item-set generation. Algorithm 2 shows the process of FP-Tree construction. The FP-Tree
constructionprocesstakestwoinputs:1)thesetofsamplesinthetargetfailurestate(equivalent
to a transaction database in classical frequent pattern mining literature), and 2) a min-support
threshold,basedonwhichapatternisclassifiedasfrequent ornot.Eachnodeinthetreeconsists
ofthreefields,item-name,count,andnode-link.item-namestorestheitemthatthenoderepresents,
Proc.ACMMeas.Anal.Comput.Syst.,Vol.4,No.2,Article31.Publicationdate:June2020.
FastDimensionalAnalysisforRootCauseInvestigation 31:9
count representsthenumberoftransactionscoveredbytheportionofthepathreachingthenode,
andnode-linklinkstothenextnodewiththesameitem-name.TheFP-treeisconstructedintwo
scansofthedataset.Thefirstscanfindsthefrequentitemsandsortthem,andthesecondscan
constructsthetree.
Algorithm2:FP-TreeConstruction
Scandataandfindfrequentitems
Orderfrequentitemsindecreasingorderwithrespecttosupport,F
CreaterootnodeT,labeledasNULL
foreachtransactiont indatabasedo
foreachfrequentitempinF do
if ThasachildNsuchthatN.item-set=p.item-set then
|N|++
end
else
CreateN,linkparent-linktoT,andsetN.count =1
LinkN’snode-linktonodeswiththesameitem-name
end
end
end
Algorithm3illustratestheprocessforgeneratingthefrequentitem-sets,basedonthelemmas
and properties Han et al. proposed in [13]. A conditional pattern base is a sub-database which
containsthesetoffrequentitemsco-occurringwiththesuffixpattern.Theprocessisinitiatedby
callingFP-Growth(Tree,NULL),thenrecursivelybuildingtheconditionalFP-Trees.
Algorithm3:FrequentItem-setGeneration
FunctionFB-Growth(Tree,α):
ifTree containsasinglepathP then
foreachcombinationβ ofnodesinpathP do