purpose, we pick a subset of MPLS traces obtained before October 2014 and try
to ﬁnd similar pure IP traces after this date (i.e., we check whether the same
sequence of IP addresses between Ingress and Egress LER exists before and after
that date or if the two edge routers seem directly connected after). As a result,
we ﬁnd equivalent traces before and after, the only diﬀerence being that MPLS
labels disappear after October 2014. We can conclude that Cogent just gets rid
of MPLS (as they did in IPv4 two years before). To verify this conclusion, we
contacted a Cogent network administrator who conﬁrmed this ﬁrst result.
The second, and most interesting fact is that, although most of its LSPs
have a stack size greater or equal than 2, they never use a bottom label of 2 (the
default value for 6PE), on the contrary to the dominant usage in other ASes
(see Sect. 3.2). Note that RFC4798 [18] does not mandate the use of label 2 as
bottom label but that BGP at the Egress router associates a label to each IPv6
preﬁx and announces it to its iBGP peers. Therefore, a 6PE implementation
could choose any other arbitrary label for 6PE, or choose a diﬀerent label for
each preﬁx or set of preﬁxes.
After the analysis of Cogent stacks, it appears that the bottom label is not
ﬁxed (Cogent does not simply use another arbitrary value than 2) but varies
greatly. In fact numerous diﬀerent bottom labels can be found on LSPs con-
necting the same (Ingress, Egress) pair. For instance, we ﬁnd one case where 38
distinct bottom labels are in use for a given pair. In theory, this could be 38
distinct VPNs or, more probably, the Egress could be using a distinct bottom
label for each (group of) IPv6 preﬁx. Hopefully, our Cogent contact helped us to
eliminate the VPN case (indeed, considering only the measurements perspective,
nothing distinguishes VPN from 6PE, the general principle of using a bottom
label being the same): Cogent simply did not use this technology but only 6PE
before shutting down MPLS for IPv6 in October 2014.
One purpose of distinct bottom labels may be load sharing: in a network using
Equal Cost Multipath (ECMP), packets arriving at a router with two equal cost
routes for the destination are distributed along these routes according to a packet
header hash. In a network using MPLS and ECMP, LSPs constructed by LDP
signaling may make use of multiple paths, building several LSPs between the
same pair of LSRs. In the case of Cogent, it is apparent that ECMP is in use in
the core network. For example in the case of the Egress router having 38 distinct
bottom labels, after removing the bottom label, there still exists 8 distinct LSPs
between this pair of routers (considering IP addresses and top labels).
368
Y. Vanaubel et al.
For IPv4 packets, the hash function considers at least the IP addresses in
order to guarantee the same route for all packets of the same ﬂow (avoiding
so ordering issues with TCP). The same can be done with IPv6 packets, but
it is more costly due to the IPv6 addresses length. Moreover in the case of
6PE, routers in the core may be totally IPv6 ignorant. In this case using the
bottom label to split the load makes sense (this usage is for example mentioned in
Cisco documentation [26]). Note that the conjunction of many routes (ECMP),
hence top labels and many distinct 6PE bottom labels result in a large number
of distinct LSPs when taking into account the full label stack. This partially
explains why Cogent is so prevalent in terms of unique IPv6 MPLS tunnels in
the dataset we consider besides its shere size. Several mechanisms have been
proposed to allow MPLS networks to beneﬁt from the use of multiple paths,
such as Kompella et al. [27]. There have been also proposals to allow RSVP-TE
to make a direct use of multiple ECMP paths [28].
Table 2. LPR [7] applied to some Cogent IPv6 2014 data.
09/2014 10/2014 11/2014
Mono-LSP 23.1 % 30.8 % 0 %
Multi-FEC
3.4 %
2.7 % 0 %
Mono-FEC 58.6 % 52.3 % 0 %
Unclassiﬁed 14.9 % 14.2 % 0 %
To investigate further and retrieve the root cause of this variety of label
stacks, we apply the Label Pattern Recognition (LPR) algorithm [7] on top
labels of the Cogent IPv6 MPLS traces to quantify the usage of LDP (for IGP-
BGP scalability purposes – Mono-FEC in Table 2) and/or RSVP-TE (for traﬃc
engineering purposes – Multi-FEC in Table 2). To distinguish LSPs built through
LDP and RSVP-TE, LPR analyses LSPs going through the same Ingress-Egress
pair. If two LSPs have been built through LDP, the incoming top labels should be
identical at converging routers. On the contrary, the incoming top labels should
be diﬀerent if these LSPs have been built through RSVP-TE. There is also the
possibility that both protocols are used, building diﬀerent LSPs according to the
intended service. Our analysis (already apparent in the case of the Egress with
38 distinct LSPs), shows that the top-label is mostly generated by LDP (Mono-
FEC line in Table 2). Therefore our interpretation is that the bottom-label is
assigned by the Egress-router on a per IPv6 preﬁx basis using a variant of 6PE,
in order to make a more eﬃcient use of ECMP, while the top-label (i.e. the LSP
itself) is built using LDP for IPv4.
4 Conclusion
The recent years have seen an increasing deployment and usage of IPv6. With
the recent IPv4 depletion, this increase is going faster and we expect to see more
A Brief History of MPLS Usage in IPv6
369
and more IPv6 networks in a near future. In this paper, we focused on a speciﬁc
aspect of the IPv6 deployment related to MPLS: how is MPLS deployed and
used under IPv6? Is its usage strongly diﬀerent from the one in IPv4? Based on
traceroute collected by CAIDA, we tried to answer these questions.
Our ﬁrst observations pointed out that the MPLS technical usage seems to
strongly diﬀer between IPv4 and IPv6. In particular, in the way label stacks
are used, we discovered that under IPv4, stacks of more than one label are not
that frequent while they are the norm under IPv6. However, we showed that
this diﬀerence is not due to an increase in VPN BGP MPLS usage. Indeed, we
explained that IPv6 MPLS mostly uses 6PE tunnels that are built using an IPv4
signaling protocol (in particular LDP for IPv4). This allows one to deploy MPLS
for IPv6 across a network where some routers are not dual-stack, or where LDP
is not available for IPv6 (the IPv6 version was only recently released). Therefore
this can be seen as a transition mechanism, and it will be interesting to see the
evolution of this usage as more and more networks become fully IPv6 compliant.
The special case of the Cogent network also brought some light on the use of
ECMP multipath in conjunction with MPLS. We argued that this network uses
a speciﬁc form of 6PE to ease the way that IPv6 routers select their outgoing
interfaces.
References
1. Dhamdhere, A., Luckie, M., Huﬀaker, B., Claﬀy, K., ELmokashﬁ, A., Aben, E.:
Measuring the deployment of IPv6: topology, routing, and performance. In: Pro-
ceedings of ACM Internet Measurement Conference (IMC), November 2012
2. Czyz, J., Allman, M., Zhang, J., Iekel-Johnson, S., Osterweil, E., Bailey, M.: Mea-
suring IPv6 adoption. In: Proceedings of ACM SIGCOMM, August 2014
3. American Registry for Internet Numbers (ARIN): IPv4 depletion, September 2015.
https://www.arin.net/resources/request/ipv4 countdown.html
4. Sommers, J., Eriksson, B., Barford, P.: On the prevalence and characteristics of
MPLS deployments in the open Internet. In: Proceedings of ACM Internet Mea-
surement Conference (IMC), November 2011
5. Donnet, B., Luckie, M., M´erindol, P., Pansiot, J.J.: Revealing MPLS tunnels
obscured by traceroute. ACM SIGCOMM Comput. Commun. Rev. 42(2), 87–93
(2012)
6. Pathak, A., Zhang, M., Hu, Y.C., Mahajan, R., Maltz, D.: Latency inﬂation with
MPLS-based traﬃc engineering. In: Proceedings of ACM Internet Measurement
Conference (IMC), November 2011
7. Vanaubel, Y., M´erindol, P., Pansiot, J.J., Donnet, B.: MPLS under the micro-
scope: revealing actual transit path diversity. In: Proceedings of ACM Internet
Measurement Conference (IMC), October 2015
8. Rosen, E., Visanathan, A., Callon, R.: Multiprotocol label switching architecture.
RFC 3031, Internet Engineering Task Force, January 2001
9. Andersson, L., Asati, R.: Multiprocotol label switching (MPLS) label stack entry:
EXP ﬁeld renamed to traﬃc class ﬁeld. RFC 5462, Internet Engineering Task
Force, February 2009
370
Y. Vanaubel et al.
10. Rosen, E., Tappan, D., Fedorkow, G., Rekhter, Y., Farinacci, D., Li, T., Conta, A.:
MPLS label stack encoding. RFC 3032, Internet Engineering Task Force, January
2001
11. Agarwal, P., Akyol, B.: Time-to-live (TTL) processing in multiprotocol
label
switching (MPLS) networks. RFC 3443, Internet Engineering Task Force, January
2003
12. Andersson, L., Minei, I., Thomas, T.: LDP speciﬁcations. RFC 5036, Internet Engi-
neering Task Force, October 2007
13. Awduche, D., Berger, L., Gan, D., Li, T., Srinivasan, V., Swallow, G.: RSVP-TE:
extensions to RSVP for LSP tunnels. RFC 3209, Internet Engineering Task Force,
December 2001
14. Muthukrishnan, K., Malis, A.: A core MPLS IP VPN architecture. RFC 2917,
Internet Engineering Task Force, September 2000
15. George, W., Pignataro, C.: Gap analysis for operating IPv6-only MPLS networks.
RFC 7439, Internet Engineering Task Force, January 2015
16. Asati, R., Pignataro, C., Raza, K., Manral, V., Papneja, R.: Updates to LDP for
IPv6. RFC 7552, Internet Engineering Task Force, June 2015
17. De Clercq, J., Ooms, D., Carugi, M., Le Faucheur, F.: BGP-MPLS IP virtual
private network (VPN) extension for IPv6 VPN. RFC 4659, Internet Engineering
Task Force, September 2006
18. De Clercq, J., Ooms, D., Prevost, S., Le Faucheur, F.: Connecting IPv6 islands
over IPv4 MPLS using IPv6 provider edge routers (6PE). RFC 4798, Internet
Engineering Task Force, February 2007
19. Bonica, R., Gan, D., Tappan, D., Pignataro, C.: ICMP extensions for multiprotocol
label switching. RFC 4950, Internet Engineering Task Force, August 2007
20. Hinden, R., Deering, S.: IP version 6 addressing architecture. RFC 4291, Internet
Engineering Task Force, February 2006
21. CAIDA: The CAIDA UCSD IPv6 topology dataset, September 2015. http://www.
caida.org/data/active/ipv6 allpref topology dataset.xml
22. Augustin, B., Cuvellier, X., Orgogozo, B., Viger, F., Friedman, T., Latapy, M.,
Magnien, C., Teixeira, R.: Avoiding traceroute anomalies with Paris traceroute.
In: Proceedings of ACM Internet Measurement Conference (IMC), October 2006
23. Luckie, M.: Scamper: a scalable and extensible packet prober for active measure-
ment of the Internet. In: Proceedings of ACM Internet Measurement Conference,
November 2010
24. Giotsas, V., Luckie, M., Huﬀaker, B., Claﬀy, K.: IPv6 AS relationships,clique,
and congruence. In: Proceedings of Passive and Active Measurement Conference
(PAM), March 2015
IPv6
Internet broken, Cogent/Telia/Hurricane not peering,
October 2009. Nanog Mailing-list. http://mailman.nanog.org/pipermail/nanog/
2009-October/014017.html
25. Leber, M.:
26. Cisco: Cisco
IOS
IPv6
October
products data sheet09186a008052edd3.html#wp39913
2015.
over MPLS,
http://www.cisco.com/en/US/products/sw/iosswrel/ps1835/
provider
router
(6PE)
edge
27. Kompella, K., Drake, J., Amante, S., Henderickx, W., Yong, L.: The use of entropy
labels in MPLS forwarding. RFC 6790, Internet Engineering Task Force, November
2012
28. Kompella, K., Hellers, M., Singh, R.: Multi-path label switched paths signaled
using RSVP-TE. Internet Draft (Work in Progress) draft-kompella-mpls-rsvp-
ecmp-06, Internet Engineering Task Force, March 2015