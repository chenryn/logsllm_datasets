User: How to implement reverse proxy, load balancing and cache control in Nginx?
Assistant: Realize the reverse proxy: 1. Configure the reverse proxy module of Nginx: Add in the http block of the nginx.conf file: ``` server { listen 80; server_name example.com; location / { proxy_pass http://backend_server_ip:port ; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-Proto $scheme; } } ``` Among them, the address after proxy_pass is the real target server address. 2. Configure the DNS server to resolve the domain name to the Nginx server. To achieve load balancing: 1. Configure the upstream module of Nginx: Add in the http block of the nginx.conf file: ``` upstream backend_servers { server backend_server1_ip:port; server backend_server2_ip:port; ... } ``` Among them, backend_servers is The upstream name, backend_server1_ip and backend_server2_ip are the address and port number of the target server. 2. Add load balancing rules in the server block: ``` server { listen 80; server_name example.com; location / { proxy_pass http://backend_servers; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X -Forwarded-Proto $scheme; } } ``` Implement cache control: 1. Configure the proxy_cache module of Nginx: Add in the http block of the nginx.conf file: ``` proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=my_cache:10m inactive=60m; ``` Among them, proxy_cache_path specifies the cache path, levels specifies the cache directory depth, keys_zone specifies the cache name and cache size, and inactive specifies the cache expiration time. 2. Enable caching in the location block: ``` location / { proxy_cache my_cache; proxy_cache_valid 200 60m; proxy_cache_valid 404 1m; proxy_cache_revalidate on; proxy_cache_min_uses 3; proxy_cache_background_update on; proxy_pass http://backend_servers; proxy_ set_header Host $host; proxy_set_header X- Real-IP $remote_addr; proxy_set_header X-Forwarded-Proto $scheme; } ``` Among them, proxy_cache_valid specifies the cache validity period, proxy_cache_revalidate specifies whether to enable cache update, proxy_cache_min_uses specifies the minimum number of uses, and proxy_cache_background_update specifies whether to enable background cache update.