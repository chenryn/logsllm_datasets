051015202500.511.522.533.5x 105time (minutes)Completed CallsCumulative Call Distribution (30 sec. Bin)50 CPS Rejected + 30% Delayed75 CPS Rejected + 20% DelayedWithout Protection051015202500.511.522.533.5x 105time(minutes)Failed CallsCumulative Call Distribution (30 sec Bin)50 CPS Rejected + 30% Delayed75 CPS Rejected + 20% DelayedWithout Protection051015202500.511.522.533.5x 104Observation of Response Time (30 sec. Bin)time (minute)Average Response Time (ms)Without Protection 50 CPS Rejected +30% Delayed75 CPS Rejected +20% Delayed(a.)CompletedCalls(b.)FailedCalls(c.)ResponseTimeFig.10.SIPTrafﬁcBehaviorUnderFlashCrowd(CallRateJumpedfrom75CPSto400CPSat10thMinute)0510152025303502468101214x 104time (minutes)Completed CallsCumulative Distribution of Completed Calls (30 sec. Bin)with protection without protection 0510152025303501234567x 104time (minutes)Failed CallsCumulative Distribution of Failed Calls (30 sec Bin)without protection with protection 0510152025303501000200030004000500060007000time (minutes)Average Response Time (ms)Observation of Response Time (30 seconds Bin)without protection with protection (a.)CompletedCalls(b.)FailedCalls(c.)ResponseTimeFig.11.SIPTrafﬁcBehaviorUnderDDoSAttack(150SpoofedCPSMixedwith75CPSat10thMinute)atuserpacewheremostofthepacketprocessingisdone.Implementingapacketprocessingmoduleinuserspaceismuchsimplerthaninkernel,buttheprocessingdelayatuserspaceadverselyaffectsthenetlinkandipqueuebuffercapacityresultingintopacketdrops.TheﬂowofpacketscapturedbynetﬁlterisshowninFigure9.Themaindifferencebetweenpushbackcontrolandselectiveadmittanceliesinaprocessthatisshownasashadedbox.InDDoSattack,thevalueofXis100%,whereasinﬂashcrowditismuchless(i.e.,15-30%)andmainlydependsuponitsseverity.Todemonstratetheperformanceofouroverloadingpro-tectionmethods,theproposedoverloadcontrolsareappliedunderﬂashcrowdandDDoSattackconditions.Weusethreemetricstoevaluatethesuccessofprotectionmethods.First,thecallsuccessratemeasuresthenumberofSIPsessionsthataresuccessfullyestablishedduringtheoverloadingconditions.Secondly,thecallfailureratemeasuresthenumberofSIPsessionsfailedtoestablishduetoserver’sresourceexhaustion.Finally,thethirdparameterResponseTimemeasuresashowquicklyasessionisestablished.Figure10plotstheSIPsessionestablishmentbehaviorunderaﬂashcrowdevent.Atthe10thminute,thenormalcallrateof75CPSsurgesto400CPS.Atthisrateafteroneminuteofthesurge,thetransactionsstarttimingoutandcallthroughputdropsto0CPS.Onceweapplypushbackcontrolbyrejecting50CPSandfurtherdelaying30%ofthecalls,thecallthroughputimproves.However,itlastsforthenext4minutes.Afterchangingthecontrolparametersto75CPSrejectionrateand20%delay,theserver’sperformanceremainsstablewithrespecttocallthroughputandresponsetime.Beingplottedunderthesamenetworkconditions,theeffectivenessofpushbackcontrolbecomesevidentwhenwecomparethesuccessfullycompletedandfailedcallrate.Figure11plotstheSIPsessionestablishmentbehaviorunderDDoSattack.Hereourgoalistoallowthelegitimatecallswhilerejectingthespoofedones.TheselectiveINVITEadmittanceallowsonlyretransmittedcallrequeststobeservedandthusrejectingallspoofedcallrequests.Though,itaddsanadditional500msdelaytoinitialINVITErequestpro-cessing.However,thisadditionaldelayisoutbalancedbytheperformancegainsincallthroughputandresponsetime.A.FurtherDiscussionWenowaddresssomeoftheconcernsthatmayariseregardingpreventionmechanism’scapabilityanditspossiblecircumvention.A1.Bymakingsessionestablishmentlonger,theADSmayannoynormallegitimateusers.First,weshouldrealizethatthepreventionschemedropsonlyafractionofthetotalcalls.Secondly,evenifwedropINVITEs1to2times,stilltheadditionaldelaywillbe0.5to1.5seconds,respectively.Thismuchdelayduringthecallsetupphaseremainsunnoticedbythecallers.A2.AnattackerknowingthepreventionmechanismmayprogramamalwarethatrepeatssameINVITErequestatT1,2∗T1,4∗T1,...timedelays.Todealwithsuchasophisticatedattack,theADSincorpo-ratesanewapproachof“anearlyprovisionalresponse,late978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
427
INVITEadmittance”.AfterX(randomlyselected)drops,thearrivalofXthretransmittedINVITEmessageisqueued(insteadofallowingtoaccessSIPproxyserver)andan(100Trying)provisionalresponseissendbacktotheclientonbehalfoftheSIPproxyserver.Inthatresponse,aSIPprotocolcompliantUAstopstheretransmissionandwaitsforthetransactiontoreacheitheratcompletedorterminatedstate.However,ifanINVITEmessageappearsagainatlatertimecorrespondingto(X+1)thdropthenthisisabot-generatedcallrequest,otherwisequeuedINVITEisallowedtoaccesstheSIPproxyserverresources.VI.STEP3:FEEDBACKANDRECTIFICATIONMimicryattack.SinceourDDoSattackdetectionisbasedonobservingtheINVITE,(100Trying),(200OK),andACKmessages,itcouldbepossiblethatanattackercanalsotrytogeneratesamesetofmessagesbymimickingﬂashcrowdevent.Forexample,theavailabilityofmalicioushostsdistributedovertheInternetwithrealIPaddressandSIPprotocolstackcancompletetheINVITEtransactionsbygeneratingvalidACKmessages.TheADSdistinguishessuchmimicryattackasarealﬂashcrowd.Consequently,itiswronglyappliedwithServer-sidepushbackcontrol.However,inthissectionwedevelopasolutionthatcanidentifyamimicryattacktoo.Itenablestheearlierapplieddetectionandprotectionmechanismtoevolveandselectanappropriatecontrol.Characteristicsofmimicryattack.Themachinegeneratedcallswilleitherbeansweredbysubscribers(i.e.,humans)orendupatthevoicemailsystem.Ifthefalsecallsareansweredbysubscribersthenthecalldurationswillbeexceptionallyshort(becausethereisnocallervoicestream)comparedtoregularcalls.Therefore,duringtheattack,theaverageofcalldurationsisexpectedtofall.Further,sincethevoicemailsystemsallowvoicerecordingofonlyfewminutes(atypicalvalueiseither1or2minutes),hencemanyofthecallswillbehavingaconstantcallduration2.ThisisbecauseattheexpirationofvoicerecordingtimerthevoicemailsystemterminatesthecallbysendingaBYEmessagetowardthecaller.EntropyClassiﬁer.Theentropyclassiﬁercomponentmakesattackclassiﬁcationdecisionbasedonentropymeasurementofcalldurations,irrespectiveofwhetheritisaregular2-partycalloransweredbyavoicemailsystem.ThecalldurationsarebinnedintoNcontiguousbins(ofvaryinglengths).WecaninterpretthebinsasthestatesxiofadiscreterandomvariableX,wherep(X=xi)=pi.TheentropyoftherandomvariableXisthenH[p]=−(cid:3)ip(xi)lnp(xi)Distributionsp(xi)thataresharplypeakedaroundafewbinswillhavearelativelylowentropy,whereasthosethatarespreadmoreevenlyacrossmanybinswillhavehigher2EvenifVADisenabledatthemediaserver,stillweobserveconstantcalldurationbecausethevoicemailsystemplaysvoicepromptsaskingforcaller’sinputbeforedisconnectingthecall.entropy.Forexample,iftheentropyislowforourselectedattributeofcalldurationthenitindicatespredictablepatternsoftheabnormalcallbehavior.Itcouldbeduetoshortcalldurationsareskewedtowardfewselectedlower-sidebinsormaybeconstantcalldurationshaveﬁlleduponeparticularbin.However,ifthemeasuredentropyishigh(i.e.,calldurationsaredistributedacrossbins),itindicatestheirregularorunpredictablebehaviorofhumanconversations.Entropyproﬁlecreation.Inourexperiments,thecalllogsusedinentropyproﬁlecreationwerecollectedfromrealVoIPnetworkofNuVoxCommunications,avoiceserviceproviderinSoutheastandMidwestregionsoftheUSA[11].Thethreedays(December1-3,2008)calllogswerecollectedfromaClass-VswitchlocatedatWinterHaven,Florida.ThecalllogscorrespondtolongdistancecallsmadebyVoIPbusinesssubscribersofOrlandoandTampacitiesinFlorida.Figure12(a.)and(b.)showthecallcharacteristicsofasingleday(i.e.,25hours)of2ndDecember2008.Intotal,thisparticularcalllogcontains88,596completedand32,126attemptedcalls.Thecalldurationsarebinnedintothe16coarsegrainedcontiguousbinsofvaryinglengths.Theinitial1-3binsareof10sec.each,4thbinisof30sec.,5-13binsareof60sec.each,14-15binsareof300sec.each,andﬁnally,the16thbinisadefaultbintocaptureallcalldurationsthatarelongerthan20minutes.However,itshouldbenotedthatthechoiceofﬁnegranularbinsismoreaccurateinattacksdetection.Touseentropymeasure,basedonpreviouscollecteddataduringthetrainingperiodwebuildaentropyproﬁleofcalldurationswithrespecttotime.Themeasuredentropyisusedtosetacutoffscoreandifthetestscore(duringthetestingperiod)isgreaterthanorequaltothecutoffscore,thecallrequestsareclassiﬁedashumangenerated.Ifthetestscoreislessthanthecutoffscore,thecallrequestsareclassiﬁedasmalicious.Thecutoffscoreanditsrelationwithtimeisanimportantparameterindeterminingthefalsepositiveandtruepositiveratesoftheentropyclassiﬁer.Inouranalysis,weﬁndthatthebusyhourentropyremainedconﬁnedbetween1.5to2.5(e.g.,seeFigure12c.).Theoff-peakhourentropyismoreunpredictable(speciallybetweenmidnightto9:00AM).However,inthisperiodoftimethecallarrivalsareverylow,andtheircalldurationsaremuchshorter.Therefore,byusingﬁnegranularbinsandobservingunusualhighvolumetrafﬁccanleadustoattackdetection.Toavoiddetection,mostoftheattacksareexpectedtooccurduringthepeakhourwhenmalicioustrafﬁccaneasilyintermixwithlegitimatecalltrafﬁc.Ourfocusismainlyonthistimesegment.ApplicationofEntropyClassiﬁer.Inthissection,weevaluatetheperformanceofentropyclassiﬁerintermsofitsdetectionaccuracy.Notethatwiththepropersettingofthresholdvalues,therewillbenofalsealarm(i.e.,falsepositive)undernormalconditions.However,tobalancebothfalsepositivesandfalsenegatives,wesetourentropythresholdat1.5.Inourcalllogsanalysis,weobservedthat0.83%timestheentropyvaluefallsbelowthethresholdvaluethusgivingusfalsealarms.Tomeasurefalsenegatives,weusedetectionprobabilitythatisdeﬁnedasthepercentageofthesuccessfulidentiﬁedattackinstancesoverthetotallaunchedattacksinonesetofexperiments.Intheexperiments,thecalllogsareused978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
428
050010001500050100150200250Call ArrivalsLong Distance Calls at Class−V Switch (NuVox Communications, Winterhaven,FL)0500100015000246810x 104time (minutes) [60 Seconds Bin]Cumulative Call ArrivalsCompleted Calls Call Attempts Completed Calls Call Attempts 12345678x 104024681012x 105time (seconds)Call Durations (in 10 ms Ticks)Observed Call Durations05001000150000.511.522.5time (minute)EntropyEntropy Measurement9:00 AM 7:00 PM Window Size (15 Minutes) Window Size (1 Minute) Window Size (15 Minutes) (a.)CallArrivals(b.)CallDurations(c.)EntropyFig.12.EntropyProﬁleCreationtogeneratecallarrivalsandusedasthenormalbackgroundtrafﬁc.Later,thistrafﬁcisrandomlymixedwiththeattacktrafﬁcofvaryingcallrate.Inourexperimentation,wemadethefollowingassumptions:1.)theattackdurationisof30sec;2.)95%callsareansweredbyhumansandtheremaining5%byvoicemailsystem;3.)thehumanansweredcalldurationsareexponentiallydistributedwithmeantalktimeof20sec;and4.)thevoicemailsystem’srecordingtimelimitisof60sec.TheexperimentalresultsfordifferentﬂoodingratesarelistedinthefollowingtableI.Figure13shows85individualattackTABLEIPERFORMANCEOFENTROPYCLASSIFIER(BUSYHOUR)MaliciousDetectionNumberofDetectionCallRateThresholdExperimentsProbability10(cid:2)1.58523.52%20(cid:2)1.58598.8%30(cid:2)1.585100%50(cid:2)1.585100%instances.Theseattackinstancesbelongtothreedifferentcallrate,suchas10,20,and30CPS.Underattackconditions,Figure13showshowentropydropsfromthoserepresentingthenormalcallbehaviorofsubscribers.600700800900100011000.811.21.41.61.822.22.42.685 Attack Instances (of each different call rates)intermixed with normal datatime (minutes)EntropyNormal DataAttack 10 CPSAttack 20 CPSAttack 30 CPSFig.13.EntropyChangeUnderAttackInstancesVII.CONCLUSIONInthispaper,wepresentedaprotocol-behavioral-distance-basedanomalydetectionmechanismthatleveragesonintrinsiccorrelationexistingamongprotocolattributes.Wealsopro-posedanovelschemetoprotectaSIPproxyserverunderoverloadingconditions.TheoverloadingprotectionschemereliesoninbuiltreliabilitymechanismsofTCPandSIPpro-tocols.Theserver-sideoverloadingcontrolsdemonstratethepossibilityofprotectingaSIPproxyserverfromoverloadingconditionswithoutmodifyingtheprotocolitselforrequiringanyinfrastructurechanges.TheentropyofcalldurationsisusedtodetectthoseDDoSattacksthatmasqueradeasﬂashcrowd.REFERENCES[1]M.CarsonandD.Santay.NISTNetNetworkEmulationPackage.NistNetWebsite:http://snad.ncsl.nist.gov/itg/nistnet/,June1998.[2]DorghamSisalemandJiriKuthan.DenialofServiceAttacksandSIPInfrastructure.TechnicalReport,http://www.snocer.org/Paper/sisalemdos.pdf,2008.[3]M.FannesandP.Spincemaille.Themutualafﬁnityofrandommeasures.IneprintarXiv:math-ph/0112034,December2001.[4]V.Hilt,I.Widjaja,D.Malas,andH.Schulzrinne.SessionInitiationProtocol(SIP)OverloadControl.WorkinProgress,SIPPINGWorkingGroup,2008.[5]J.IoannidisandS.M.Bellovin.ImplementingPushback:Router-BasedDefenseAgainstDDoSAttacks.InNDSS,2002.[6]iptel.SIPExpressRouter.SIPProxyServer,http://www.iptel.org/ser/.[7]J.Jung,B.Krishnamurthy,andM.Rabinovich.Flashcrowdsanddenialofserviceattacks:CharacterizationandimplicationsforCDNsandwebsites.InWWW,May2002.[8]S.Kandula,D.Katabi,M.Jacob,andA.Berger.Botz-4-Sale:SurvivingOrganizedDDoSAttacksthatMimicFlashCrowds.InNSDI,2005.[9]H.LeeandK.Park.Ontheeffectivenessofprobabilisticpacketmarkingforiptracebackunderdenialofserviceattack.InINFOCOM,2001.[10]M.Nassar,R.State,andO.Festor.MonitoringSIPTrafﬁcUsingSupportVectorMachines.InRAID,2008.[11]NuVoxCommunications.VoiceandDataServiceProvider.Website,http://www.nuvox.com,2007.[12]PaulRussell.netﬁlter/iptables.Firewall,http://www.netﬁlter.org/,2006.[13]D.Pollard.Asymptopia.http://www.stat.yale.edu/pollard/(BookinProgress),1stedition,2000.[14]J.Rosenberg.RequirementsforManagementofOverloadintheSessionInitiationProtocol.WorkinProgress,SIPPINGWorkingGroup,2006.[15]J.Rosenberg,H.Schulzrinne,G.Camarillo,A.Johnston,J.Peterson,R.Sparks,M.Handley,andE.Schooler.SIP:SessionInitiationProtocol.RFC3261,IETFNetworkWorkingGroup,2002.[16]S.Savage,D.Wetherall,A.Karlin,andT.Anderson.PracticalnetworksupportforIPtraceback.InSIGCOMM,2000.[17]H.Sengar,H.Wang,D.Wijesekera,andS.Jajodia.Detectingvoipﬂoodsusingthehellingerdistance.IEEETrans.ParallelDistrib.Syst.,19(6),2008.[18]A.C.Snoeren.Hash-basedIPtraceback.InSIGCOMM,2001.[19]A.Yaar,A.Perrig,andD.Song.Pi:APathIdentiﬁcationMechanismtoDefendagainstDDoSAttacks.InIEEESymposiumonSecurityandPrivacy,2003.