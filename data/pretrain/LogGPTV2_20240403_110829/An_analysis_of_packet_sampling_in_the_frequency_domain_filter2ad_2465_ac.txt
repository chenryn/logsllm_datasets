Figure 8: Filter-banks with variance comparisons.
Param.
t0
T
p
L
W
th
N
Description
time-slot
bin size
sampling probability
no. of ﬁlter-banks
no. of ﬁlters in each ﬁlter-bank
threshold for Var. comparisons
Value
2.13 · 10
−6s
[1s, 400s]
−4, 1]
[10
16
11
[0.1, 0.2]
no. of Var. comparisons
2,3
Table 1: Experiment parameters.
meters are listed in Tab. 1. Fig. 9 shows the module of the
spectrum of the inverted sampled traﬃc dp(k)/p, obtained
for several values of p, when 10,000 packets of the aggregate
trace are considered. By comparing the plot obtained for
p = 1 with respect to the other ones, it is straightforward to
note that: (i) only low frequencies of the original traﬃc can
be recovered, even using a very high sampling probability as
p = 0.1; (ii) the harmonic tones of the original traﬃc, i.e.,
those obtained for p = 1, appear translated in the frequency
spectrum of the sampled traﬃc signals as expected by the
Poisson summation formula; (iii) the noise across the con-
tinuous component of the traﬃc signal grows with 1/p as
expected by inequality (15).
Regarding the eﬀectiveness of the ﬁlter-bank proposed in
Sec. 5, we have processed the packet trace with values of p in
−4, 1]. Each decade of this range has been split
the range [10
into 3 octaves, so that we have considered L = 16 possible
values for p. Moreover, we have considered W = 11 low
pass ﬁlters, whose respective bandwidths, according to (16),
allow the bin size T to range over the interval [1s, 400s].
Given Bj and p = pi, the algorithm compares the ratios
V ar(pi−1 ,Bj )
V ar(pi ,Bj )
with respect
to a threshold th0 = 1 + th. N is the number of consecutive
sampling rates tested to decide on the appropriateness of Bj
and pi. The considered value of p = pi is admissible for the
bandwidth Bj iﬀ all the considered ratios are smaller than
th0. To further improve accuracy, we require that the ratio
between V ar(pi, Bj) and the square of the estimated traﬃc
volume is smaller than th (small relative error).
V ar(pi−2 ,Bj )
V ar(pi,Bj )
V ar(pi−N ,Bj )
. . . (cid:2)(cid:2)(cid:2)(cid:2)
V ar(pi,Bj )
(cid:2)(cid:2)(cid:2)(cid:2)
, (cid:2)(cid:2)(cid:2)(cid:2)
(cid:2)(cid:2)(cid:2)(cid:2)
(cid:2)(cid:2)(cid:2)(cid:2)
(cid:2)(cid:2)(cid:2)(cid:2)
In our experiments we have set N to 2 or 3, and we have
varied th in the range [0.1, 0.2]. For each bandwidth Bj,
samplepoint-F/2009/
WBF  
Var. Est. 
Figure 7: Filter-bank.
ﬁlter, we expect to collect a smaller amount of noise when
the second signal is processed. In any case, when p is suﬃ-
ciently large, the energy of the noise will be negligible (see
Eq. (15)). Thus we will estimate BD(p) as the largest band-
width for which a perturbation of p does not introduce any
signiﬁcant change in the variance of the binned and sampled
traﬃc.
To accomplish this task, we propose a ﬁlter-bank made
by W low-pass ﬁlters with bandwidths equal to B1, B2, . . . ,
BW , Bj < Bj+1∀j. The tool is described in Fig. 7. Each
ﬁlter is fed with the inverted sampled traﬃc dpi /pi. The
output of each ﬁlter is analyzed over time bins inversely
proportional to the ﬁlter bandwidth, according to Eq. (16).
For each bin size, the variance of the ﬁltered signal is eval-
uated. We deﬁne V ar(pi,Bj ) to be the estimated variance of
the output of the ﬁlter-bank i.
In parallel, L ﬁlter-banks, identical to the one described
above, are applied to the signals dp1 /p1, dp2 /p2, . . . , dpL /pL,
obtained by further under-sampling dp, with p1 < ··· <
pL < p, respectively. For a given bandwidth Bj, we com-
pare the values of V ar(pi,Bj ) obtained for several values of
pi < p.
If we ﬁnd that those variances are too dissimilar
among them, we have to conclude that the frequencies in
the interval [−Bj, Bj] cannot be safely estimated using the
current value of p. Thus a smaller Bj should be considered
(see also Fig. 8). The bandwidth BD(p) we are looking
for is the largest among those Bj not presenting an aliasing
problem.
It could happen that the outcome of the analysis is that
the current value of p is very large compared to the maxi-
mum allowed one, even for the largest Bj. This information
could be fruitfully exploited to reduce the packet sampling
probability inside the network.
Notice that, the proposed algorithm is based on linear
it can easily run in real time using cards
ﬁlters. Thus,
equipped with Digital Signal Processors. Further details
about the ﬁlter-bank will be provided in the next section.
6. EXPERIMENTAL RESULTS
We have processed a real packet trace collected in January
2009 over a trans-paciﬁc 150 Mbps link 4. Experiment para-
4The trace is available at http://mawi.wide.ad.jp/mawi/
1745x 106
|
p
/
)
f
(
p
D
|
4
3
2
1
0
−0.5
5x 106
|
p
/
)
f
(
p
D
|
4
3
2
1
0
−0.5
0
f [1/t0]
(a)
0
f [1/t0]
(c)
5x 106
|
p
/
)
f
(
p
D
|
4
3
2
1
0.5
0
−0.5
5x 106
|
p
/
)
f
(
p
D
|
4
3
2
1
0.5
0
−0.5
0
f [1/t0]
(b)
0
f [1/t0]
(d)
0.5
0.5
Figure 9: Baseband component of Dp(f )/p: (a) p = 1; (b) p = 0.1; (c) p = 0.03; (d) p = 0.005.
y
t
i
l
i
b
a
b
o
r
P
.
p
m
a
S
t
e
k
c
a
P
r
o
r
r
l
E
e
v
i
t
a
e
R
e
t
u
o
s
b
A
l
100
10−2
10−4
100
100
10−2
101
T [s]
102
max (N=2,th=0.1)
mean (N=2,th=0.1)
max (N=2,th=0.15)
mean (N=2,th=0.15)
max (N=2,th=0.2)
mean (N=2,th=0.2)
max (N=3,th=0.1)
mean (N=3,th=0.1)
max (N=3,th=0.15)
mean (N=3,th=0.15)
max (N=3,th=0.2)
mean (N=3,th=0.2)
103
10−4
100
101
T [s]
102
103
Figure 10: Minimum allowed packet sampling probabilities (up) and absolute relative errors (down).
we have recorded the smallest admissible value of p and the
absolute relative estimation error of the traﬃc volume cal-
culated over time windows of T seconds each.
Fig. 10 shows both maximum (solid lines) and average
(dashed lines) values of the minimum allowed packet sam-
pling probability and the absolute relative error, for each
considered value of T . By looking at Fig. 10, it is clear that,
regardless of N and th, our algorithm, for each bandwidth
Bj (linked to T by Eq. (16)), provides admissible packet
sampling rates that ensure negligible average estimation er-
rors. It also clear how the required sampling rate increases
when the traﬃc is monitored over smaller and smaller in-
tervals. For example, seen from traﬃc spectrum viewpoint,
the use of packet sampling rates smaller than 0.05 is only
admitted for bin sizes T not smaller than 100s. Finally, as
expected, it is straightforward to note that the proposed al-
gorithm becomes more conservative, i.e., provides smaller
values of packet sampling probability, as N increases and th
decreases.
7. CONCLUSIONS AND FURTHER RESEARCH
A novel technique to model the impact of noise caused
by packet sampling is proposed in this paper, exploiting a
theoretical analysis in the frequency domain. Moreover, a
real-time algorithm is presented to detect the spectrum por-
tion of the network traﬃc signal that can be restored once
packet sampling has been applied. Preliminary experimen-
tal results have been reported to validate the proposed ap-
proach. Our future research will focus on the extension of
the proposed approach to larger contexts as network-wide
monitoring, application-level analysis and anomaly detec-
tion.
8. REFERENCES
[1] G. Androulidakis, V. Chatzigiannakis, and
S. Papavassiliou. Network anomaly detection and
classiﬁcation via opportunistic sampling. Network,
IEEE, 23(1):6–12, January-February 2009.
[2] C. Barakat, G. Iannaccone, and C. Diot. Ranking ﬂows
from sampled traﬃc. In Proc. ACM CoNEXT 2005.
175[3] D. Brauckoﬀ, B. Tellenbach, A. Wagner, M. May, and
[10] C. Estan and G. Varghese. New directions in traﬃc
A. Lakhina. Impact of packet sampling on anomaly
detection metrics. In Proc. of ACM SIGCOMM IMC
2006.
[4] B. Y. Choi, J. Park, and Z. L. Zhang. Adaptive packet
sampling for accurate and scalable ﬂow measurement.
In Proc. of IEEE Globecom 2004.
[5] K. C. Claﬀy, G. C. Polyzos., and K. W. Braun.
Application of sampling methodologies to network
traﬃc characterization. ACM SIGCOMM Comput.
Commun. Rev., 23(4), 1993.
[6] N. Duﬃeld. A framework for packet selection and
reporting. In IETF Draft (work in progress), Jun.
2008.
[7] N. Duﬃeld and M. Grossglauser. Trajectory sampling
with unreliable reporting. IEEE/ACM Trans. on
Networking, 16(1):37–50, 2008.
measurement and accounting: Focusing on the
elephants, ignoring the mice. ACM Trans. Comput.
Syst., 21(3), 2003.
[11] F. Hao, M. Kodialam, T. V. Lakshman, and
S. Mohanty. Fast, memory eﬃcient ﬂow rate
estimation using runs. IEEE/ACM Trans. on
Networking, 15(6):1467–1477, 2007.
[12] F. Harris. On the use of windows for harmonic
analysis with the discrete fourier transform.
Proceedings of the IEEE, 66(1), 1978.
[13] N. Hohn and D. Veitch. Inverting sampled traﬃc.
IEEE/ACM Trans. on Networking, 14(1):68–80, 2006.
[14] P. Kanuparthy, C. Dovrolis, and M. Ammar. Spectral
probing, crosstalk and frequency multiplexing in
internet paths. In Proc. of ACM SIGCOMM IMC
2008.
[8] N. Duﬃeld, C. Lund, and M. Thorup. Estimating ﬂow
[15] A. Kumar and J. Xu. Sketch guided sampling - using
distributions from sampled ﬂow statistics. In Proc. of
ACM Sigcomm 2003.
on-line estimates of ﬂow size for adaptive data
collection. In Proc. of IEEE Infocom 2006.
[9] N. Duﬃeld, C. Lund, and M. Thorup. Learn more,
[16] T. Mori, M. Uchida, R. Kawahara, J. Pan, and
sample less: Control of volume and variance in
network measurement. IEEE Trans. on Information
Theory, 51(5):68–80, 2005.
S. Goto. Identifying elephant ﬂows through
periodically sampled packets. In Proc. of ACM
SIGCOMM IMC 2004.
[17] J. Proakis and D. G. Manolakis. Digital Signal
Processing. Prentice Hall, Int. Eds., 3 edition, 1996.
176