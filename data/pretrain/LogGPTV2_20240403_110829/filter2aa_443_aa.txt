1
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
On the Current State of
Remote Active OS
Fingerprinting Tools
Ofir Arkin
CTO
PI:EMAIL
Defcon 13
2
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
What this talk is about?
 This talk examines different aspects of remote active
operating system fingerprinting
– Examines different active OS fingerprinting methods &
techniques
– Discusses their limitations and advantages
– Explains the state of the current used technology
– Deals with the question of what can and cannot be
accomplished using remote active OS fingerprinting
– Looks at what should be done in the future
– Analyzes the accuracy aspects of remote active OS
fingerprinting and of several active OS fingerprinting tools
 Presents the new version of Xprobe2 (Xprobe2 v0.3)
3
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
Ofir Arkin
 CTO and Co-Founder, Insightix
http://www.insightix.com
 Founder, The Sys-Security Group
http://www.sys-security.com
 Computer Security Researcher
– Infrastructure Discovery
• ICMP Usage in Scanning
• Xprobe2 (The Active OS Fingerprinting Tool)
– VoIP Security
– Information Warfare
 Member
– VoIPSA (Board member, chair security research committee)
4
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
Remote Active OS Fingerprinting
An Introduction
5
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
An Introduction
 Remote Active operating system fingerprinting is the
process of actively determining a targeted network
node’s underlying operating system by probing the
targeted system with several packets and examining
the response(s), or lack thereof, received
 The traditional approach is to examine the TCP/IP
stack behavior (IP, TCP, UDP, and ICMP protocols)
of a targeted network element when probed with
several legitimate and/or malformed packets
6
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
An Introduction
 The received results would then be compared to a
signature database in an effort to find an appropriate
match
 Remote active OS fingerprinting is not limited to the
IP and Transport layers only
 The application layer can be used as another venue
for information gathering about the underlying
operating system
7
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
An Introduction
 The way of operation of an active OS fingerprinting
tool varies from one remote active OS fingerprinting
tool to another
– The OS fingerprinting tests used (i.e. what does it check for)
– The type of packets sent (i.e. RFC compliant, crafted)
– The number of packets sent
– Other variables
8
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
An Introduction
 Identifying the underlying operating system of a
network element, whether remote or local, is an
important parameter for the success of many
processes in the networking and security world
 Building a network inventory, getting the right context
for network intrusion detection systems, and
performing a vulnerability analysis are all good
examples among many other for the use of active
operating system fingerprinting
9
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
Remote Active OS Fingerprinting
Strengths
10
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
Strengths
 Control over the parameters to scan for (i.e. the
stimulus)
 Control over the pace of the scan and its initiation
 Provides with fast results
 Can cover entire IP address ranges
 Can be used from a single point to scan multi-points
 Can be used from multi points to scan multi-points
11
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
Remote Active OS Fingerprinting
Weaknesses
12
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
Weaknesses
 The weaknesses of remote active OS fingerprinting
are divided into:
– Scanning conditions and environmental effects
– Operation of the OS fingerprinting process
– Signature DB related issues
– Tool related issues
13
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
Weaknesses
 Scanning conditions and
environmental effects
14
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
Scanning Conditions &
Environmental Effects
 There is no control over the quality of the scan
 The quality of the scan is directly affected by the
environment
– The location of the scanning system and the target system
and what is between them (local network, remote network,
over the Internet)
• The path between the scanning element to the target element
(firewalls, load balancers, scrubbers, etc.)
• The target element itself (i.e. personal firewall, tunable
parameters, etc.)
 Lack of intelligence (i.e. to determine the terrain and
the limitations of the scan, switching scanning
tactics, ‘understand’ results)
15
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
Network Obstacles
 A remote active OS fingerprinting tool will be able to
detect the underlying operating system of an
element which will be operational (‘up’) on the
network at the time of the scan. This is if the packets
sent by the tool are able to reach the probed
elements, and that the probed element’s OS
signature is included with the tool’s signature DB
 Network obstacles such as Network firewalls, host-
based firewalls, NAT enabled devices, load
balancers and other, may block probe packets from
reaching their target
16
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
Network Obstacles
17
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
Network Obstacles
18
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
Network Obstacles
 If a remote active operating system fingerprinting
tool relies on sending and/or receiving of particular
packet types and those packets are dropped by a
firewall protecting the target system(s) chances are
that the quality of the results would be degraded to
the point false results or no results at all will be
produced
19
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
Different Networking Devices May Alter A
Packet’s Field Value
 A networking device along the path between the
source system to its destination may alter one, or
more, field values which are relevant to the OS
fingerprinting process
 This would result with issues determining what is the
targeted machines underlying operating system
 Example: Scrubbers
20
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
The Use of Crafted/Malformed
Packets
 If malformed packets are used with the OS
fingerprinting process, a filtering device (and even an
end point device) may drop the packets, if the device
analyzes packets for non-legitimate content
 Therefore the quality of the results produced by
utilizing a fingerprinting tests relying on malformed
packets will be degraded and in some cases even fail
 Malformed packets may have another affect, they
might cause some TCP/IP stacks to crash
21
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
A TCP/IP Stack’s Behavior Might Be
Altered
 Some characteristics of a TCP/IP stack’s behavior
may be altered:
– Tunable parameters of the TCP/IP stack might be changed
e.g. the sysctl command on the various *BSDs, the ndd
command on Sun Solaris, etc.
– Numerous patches exist for some open source operating
system’s kernels that alter the way the particular operating
system’s TCP/IP stack responses to certain packets
22
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
A TCP/IP Stack’s Behavior Might Be
Altered
 If a remote active operating system fingerprinting
tool is using some of the TCP/IP based parameters
that can be altered as part of its fingerprinting test,
the quality of the results would be effected and
questionable when these parameter values will be
altered
23
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
Weaknesses
Signature DB Related Issues
24
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
Signature DB related issues
 The signature DB is one of the most important parts
of an active OS fingerprinting tool
 The quality of the results produced by an OS
fingerprinting tool is directly affected  by the way the
signature database of a tool was built and is
maintained
 If signatures submitted to the database were and are
obtained in a wrongfully manner than the signature
database should be regarded as corrupt
 The results produced by the tool will not be accurate,
this even if the tool would use the most advanced
fingerprinting tests
25
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
Producing Signatures
 Producing signatures is an important process
– Signatures must be produced in a controlled environment
– The test device must be controlled
– The terrain must not harm the process
– A lab is the must appropriate signature production
environment
 Examples for problems
– Lab environment vs. Internet
– When there is no understanding of the process: ‘Let’s
fingerprint this firewalled device’
26
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
Strictly controlled vs. Loosely
controlled signature DB
 Strictly controlled
– Signatures are inserted to the DB only after verification
(usually only by a tool maintainer)
– Usually is a slower process
– Limitation of the number of signatures / devices
– Extremely accurate
 Loosely controlled
– Signatures are submitted over the internet
– Signature creation process is not controlled
– Many signatures are produced in a wrongfully manner
– Creates an uncontrolled DB
– Extremely inaccurate
27
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
What do we fingerprinting?
 When fingerprinting operating systems we fingerprint
the way an operating system (the software) reacts to
different fingerprinting probes a tool uses
 With a hardware based device we fingerprint the way
a device’s firmware reacts to the different
fingerprinting probes
28
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
What do we fingerprinting?
 Hardware based devices of the same manufacture
will usually run the same, or a slightly different,
firmware (a.k.a software) version
 It will be either one version for all, or a particular
version for a particular functionality
29
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
What do we fingerprinting?
 Example I: Cisco IOS
– A Cisco 7200 router will be fingerprinted exactly the same as
Cisco’s Aironet 1100/1200 wireless access points
– They run the same operating system - Cisco IOS
– It is impossible to tell their use (I.e. router, wireless access point)
according to traditional TCP/IP stack based active OS fingerprinting
Example II:
– Foundry Networks IronWare operating system (Net/Fast/Big
Iron family)
 Example III:
– Printers (i.e. HP Printers – it is not about their modules but
rather it is their firmware), etc.
30
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
What do we fingerprinting?
 Unfortunately with many active OS fingerprinting
tools these issues were not taken into account
 These tools have a corrupted DB
31
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
The inability to implement new fingerprinting tests
due to DB population and control problems
 When a new fingerprinting test is implemented a
signature DB of an active OS fingerprinting tool
needs to be updated to reflect the addition of the
new test
 An uncontrolled signature DB cannot handle new
fingerprinting tests, since some of its signatures
cannot be rebuilt, expanded, or recreated to reflect
the addition of the new test
 This can creates differences in the quality of the
signatures
32
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
Weaknesses
 Operation of the OS
fingerprinting tool
33
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
The Way Probe Results Are Being
Matched
 Scan results needs to be compared to the signature
DB in order to find a match
 The comparison process can be done either using:
– Strict signature matching
– Statistical analysis approach
34
    © Ofir Arkin, 2000-2005
Ofir Arkin, On the Current State of Remote Active OS Fingerprinting Tools
The Way Probe Results Are Being
Matched