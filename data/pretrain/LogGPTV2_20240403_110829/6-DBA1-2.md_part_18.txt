以root登入mysql\> 后，使用SET PASSWORD指令设置
这个与新安装MySQL-server后首次修改密码时要求的方式相同，平时也可以用：
mysql\> SET PASSWORD FOR root@localhost=PASSWORD(\'1234567\');
Query OK, 0 rows affected, 1 warning (0.00 sec)
#### 方法3，GRANT授权工具设置
以root登入mysql\> 后，使用GRANT授权工具设置
这个是最常见的用户授权方式（下一节会做更多授权的练习）：
mysql\> GRANT all ON \*.\* TO root@localhost IDENTIFIED BY \'1234567\';
Query OK, 0 rows affected, 1 warning (0.00 sec)
#### 4) 方法4，UPDATE更新相应的表记录
以root登入mysql\> 后，使用UPDATE更新相应的表记录
这种方法与恢复密码时的操作相同：
mysql\> UPDATE mysql.user SET
authentication_string=PASSWORD(\'1234567\')
-\> WHERE user=\'root\' AND host=\'localhost\'; //重设root的密码
Query OK, 0 rows affected, 1 warning (0.00 sec)
Rows matched: 1 Changed: 0 Warnings: 1
mysql\> FLUSH PRIVILEGES; //刷新授权表
Query OK, 0 rows affected (0.00 sec)
在上述方法中，需要特别注意：当MySQL服务程序以 skip-grant-tables
选项启动时，如果未执行"FLUSH PRIVILEGES;"操作，是无法通过SET
PASSWORD或者GRANT方式来设置密码的。比如，验证这两种方式时，都会看到ERROR
1290的出错提示：
mysql\> SET PASSWORD FOR root@localhost=PASSWORD(\'1234567\');
ERROR 1290 (HY000): The MySQL server is running with the
\--skip-grant-tables option so it cannot execute this statement
mysql\> GRANT all ON \*.\* TO root@localhost IDENTIFIED BY \'1234567\';
ERROR 1290 (HY000): The MySQL server is running with the
\--skip-grant-tables option so it cannot execute this statement
## 3 用户授权及撤销
3.1 问题
允许root从192.168.4.0/24网段 访问，对所有库/表有完全权限，密码为tarena
添加一个管理账号dba007，完全控制及授权
撤销root从本机访问的权限，然后恢复
允许webuser从任意客户机登录，只对webdb库有完全权限，密码为 888888
撤销webuser的完全权限，改为查询权限
3.2 方案
使用2台RHEL
7虚拟机，如图-1所示。其中192.168.4.10是MySQL服务器，授权及撤销操作均在此服务器上执行；而192.168.4.120作为测试客户机，需要安装好MySQL-client软件包，以便提供mysql命令。
图-1
同时，MySQL服务器本身（192.168.4.10）也可以作为测试客户机。
3.3 步骤
实现此案例需要按照如下步骤进行。
步骤一：用户授权及撤销
1）允许root从192.168.4.0/24访问，对所有库表有完全权限，密码为tarena。
授权之前，从192.168.4.0/24网段的客户机访问时，将会被拒绝：
\[root@host120 \~\]# mysql -u root -p -h 192.168.4.10
Enter password: //输入正确的密码
ERROR 2003 (HY000): Host \'192.168.4.120\' is not allowed to connect to
this MySQL server
授权操作，此处可设置与从localhost访问时不同的密码：
mysql\> GRANT all ON \*.\* TO root@\'192.168.4.%\' IDENTIFIED BY
\'tarena\';
Query OK, 0 rows affected (0.00 sec)
再次从192.168.4.0/24网段的客户机访问时，输入正确的密码后可登入：
\[root@host120 \~\]# mysql -u root -p -h 192.168.4.10
Enter password:
Welcome to the MySQL monitor. Commands end with ; or \\g.
Your MySQL connection id is 20
Server version: 5.7.17 MySQL Community Server (GPL)
Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights
reserved.
Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.
Type \'help;\' or \'\\h\' for help. Type \'\\c\' to clear the current
input statement.
mysql\>
从网络登入后，测试新建一个库、查看所有库：
mysql\> CREATE DATABASE rootdb; //创建新库rootdb
Query OK, 1 row affected (0.06 sec)
mysql\> SHOW DATABASES;
+\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--+
\| Database \|
+\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--+
\| information_schema \|
\| home \|
\| mysql \|
\| performance_schema \|
\| rootdb \| //新建的rootdb库
\| sys \|
\| userdb \|
+\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--+
7 rows in set (0.01 sec)
2）在Mysql服务器上建立一个管理账号dba007，对所有库完全控制，并赋予其授权的权限
新建账号并授权：
mysql\> GRANT all ON \*.\* TO dba007@localhost
-\> IDENTIFIED BY \'1234567\'
-\> WITH GRANT OPTION;
Query OK, 0 rows affected (0.00 sec)
查看dba007的权限：
mysql\> SHOW GRANTS FOR dba007@localhost;
+\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--+
\| Grants for dba007@localhost \|
+\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--+
\| GRANT ALL PRIVILEGES ON \*.\* TO \'dba007\'@\'localhost\' WITH GRANT
OPTION \|
+\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--+
1 row in set (0.00 sec)
3）撤销root从本机访问的权限，然后恢复
注意：如果没有事先建立其他管理账号，请不要轻易撤销root用户的本地访问权限，否则恢复起来会比较困难，甚至不得不重装数据库。
撤销root对数据库的操作权限：
mysql\> REVOKE all ON \*.\* FROM root@localhost;
Query OK, 0 rows affected (0.00 sec)
mysql\> SHOW GRANTS FOR root@localhost;
+\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--+
\| Grants for root@localhost \|
+\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--+
\| GRANT USAGE ON \*.\* TO \'root\'@\'localhost\' WITH GRANT OPTION \|
\| GRANT PROXY ON \'\'@\'\' TO \'root\'@\'localhost\' WITH GRANT OPTION
\|
+\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--+
2 rows in set (0.00 sec)
验证撤销后的权限效果：
mysql\> exit //退出当前MySQL连接
Bye
\[root@dbsvr1 \~\]# mysql -u root -p //重新以root从本地登入
Enter password:
Welcome to the MySQL monitor. Commands end with ; or \\g.
Your MySQL connection id is 6
Server version: 5.6.15 MySQL Community Server (GPL)
Copyright (c) 2000, 2013, Oracle and/or its affiliates. All rights
reserved.
Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.
Type \'help;\' or \'\\h\' for help. Type \'\\c\' to clear the current
input statement.
mysql\> CREATE DATABASE newdb2014; //尝试新建库失败
ERROR 1044 (42000): Access denied for user \'root\'@\'localhost\' to
database \'newdb2014\'
mysql\> DROP DATABASE rootdb; //尝试删除库失败
ERROR 1044 (42000): Access denied for user \'root\'@\'localhost\' to
database \'rootdb\'
尝试以当前的root用户恢复权限，也会失败（无权更新授权表）：
mysql\> GRANT all ON \*.\* TO root@localhost IDENTIFIED BY \'1234567\';
ERROR 1045 (28000): Access denied for user \'root\'@\'localhost\' (using
password: YES)
怎么办呢？
退出当前MySQL连接，以上一步添加的管理账号dba007登入：
mysql\> exit //退出当前MySQL连接
Bye
\[root@dbsvr1 \~\]# mysql -u dba007 -p //以另一个管理账号登入
Enter password:
Welcome to the MySQL monitor. Commands end with ; or \\g.
Your MySQL connection id is 24
Server version: 5.7.17 MySQL Community Server (GPL)
Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights
reserved.
Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.
Type \'help;\' or \'\\h\' for help. Type \'\\c\' to clear the current
input statement.
由管理账号dba007重新为root添加本地访问权限：
mysql\> GRANT all ON \*.\* TO root@localhost IDENTIFIED BY \'1234567\';
Query OK, 0 rows affected (0.00 sec)
mysql\> SHOW GRANTS FOR root@localhost; //查看恢复结果
+\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--+
\| Grants for root@localhost \|
+\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--+
\| GRANT ALL PRIVILEGES ON \*.\* TO \'root\'@\'localhost\' WITH GRANT
OPTION \|
\| GRANT PROXY ON \'\'@\'\' TO \'root\'@\'localhost\' WITH GRANT OPTION
\|
+\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--+
2 rows in set (0.00 sec)
退出，再重新以root登入，测试一下看看，权限又恢复了吧：
mysql\> exit //退出当前MySQL连接
Bye
\[root@dbsvr1 \~\]# mysql -u root -p //重新以root登入
Enter password:
Welcome to the MySQL monitor. Commands end with ; or \\g.
Your MySQL connection id is 25
Server version: 5.7.17 MySQL Community Server (GPL)
Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights
reserved.
Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.
Type \'help;\' or \'\\h\' for help. Type \'\\c\' to clear the current
input statement.
mysql\> CREATE DATABASE newdb2014; //成功创建新库
Query OK, 1 row affected (0.00 sec)
4）允许webuser从任意客户机登录，只对webdb库有完全权限，密码为 888888
添加授权：
mysql\> GRANT all ON webdb.\* TO webuser@\'%\' IDENTIFIED BY \'888888\';
Query OK, 0 rows affected (0.00 sec)
查看授权结果：
mysql\> SHOW GRANTS FOR webuser@\'%\';
+\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--+
\| Grants for webuser@% \|
+\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--+
\| GRANT USAGE ON \*.\* TO \'webuser\'@\'%\' \|
\| GRANT ALL PRIVILEGES ON \`webdb\`.\* TO \'webuser\'@\'%\' \|
+\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--+
2 rows in set (0.00 sec)
5）撤销webuser的完全权限，改为查询权限
撤销所有权限：
mysql\> REVOKE all ON webdb.\* FROM webuser@\'%\';
Query OK, 0 rows affected (0.00 sec)
只赋予查询权限：
mysql\> GRANT select ON webdb.\* TO webuser@\'%\';
Query OK, 0 rows affected (0.00 sec)
确认授权更改结果：
mysql\> SHOW GRANTS FOR webuser@\'%\';
+\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--+
\| Grants for webuser@% \|
+\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--+
\| GRANT USAGE ON \*.\* TO \'webuser\'@\'%\' \|
\| GRANT SELECT ON \`webdb\`.\* TO \'webuser\'@\'%\' \|
+\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--+
2 rows in set (0.00 sec)
# NSD DBA1 DAY05
## 一 数据备份方式
-   物理备份：cp tar
-   逻辑备份：Mysqldump备份 XtraBackup 工具
## 物理备份与恢复:
又叫冷备:直接拷贝数据库里面的数据文件,冷备:cp tar \...
### 物理备份缺点
-   占用物理存储空间
-   备份时间长
-   备份简单
-   跨平台性差
### 方式一:cp方式备份与恢复
\[root@sql51 \~\]# mkdir /mysqlbak
\[root@sql51 \~\]# cp -r /var/lib/mysql /mysqlbak/mysql201902180919
#备份
\[root@sql51 \~\]# cd /mysqlbak/mysql201902180919
\[root@sql51 \~\]# cp -r /mysqlbak/mysql201902180919 /var/lib/mysql
#恢复：将数据库文件拷贝到数据库目录
### 方式二:tar方式备份与恢复
\[root@sql51 \~\]# tar -zcvf /mysqlbak/mysql.tar.gz /var/lib/mysql #备份
\[root@sql51 \~\]# cd /mysqlbak/
\[root@sql51 mysqlbak\]# ls
mysql201902180919 mysql.tar.gz
\[root@sql51 \~\]# tar -zxvf /mysqlbak/mysql.tar.gz -C /var/lib/mysql
#恢复：将数据库文件指定解压到数据库目录
## 逻辑备份与恢复:
使用命令对数据做备份,(开发者开发好程序备份),根据执行备份时已有的数据生成对应的备份文件.
\[root@sql51 \~\]#mysqldump --uroot --p密码 库名 \>数据库目录/xxx.sql
#备份：库名有多种表示方法
使用命令调用备份文件,做数据恢复
\[root@sql51 \~\]#mysql --uroot --p密码 库名 \ 2 部署服务,实现数据备份(mysql 主从同步)
实际环境中通常使用的备份策略