---
## Page 226
来可扩展和可维护性，只有这样，Linux 用户才能使用 modutils 软件包提供的工具动态地插
bindshell 程序。所以再怎么重启对攻击者隐藏的后门也根本不起作用。
/usr/sbin/initd，接着由initd装载了AdoreLKM，并在每次系统启动的时候启动重命名的
比较。这个假设在下面的测试系统中得到了证实：
aspx
串是逐字节地被建立起来的（字节值显示在右侧）：
能，先执行反汇编（用reqt，即逆向工程查询工具）。汇编代码显示：在提示符之后，字符
此处并不是说LKM不好。从Linux发展的本意来讲，引入LKM机制是为了给内核带
不过要补充一点，攻击者似乎在将密码和提示符后输入的字符串（字符串effective）做
到这里已经很清楚了，攻击者改变了系统的启动次序，
对于上面这些十六进制编码，如果有不明白的，可以到 http://www.mxcz.net/tols/hex.
注意：
8r20804823
小林为了深入了解rpc.status 程序（攻击者用它从“后门”访问小林的计算机）的功
prover#telnet192.168.0.13457
groups=0 (root), 1 (bin),2 (daemon),3 (sys),4 (adm),6 (disk), 10 (wheel)
bash#id
EntervalidIPXaddress:effective
Connected to foo.bar (192.168.0.1).
Trying 192.168.0.13457
481
bash#
uid=0(root)gid=0（root)
leetobindshell.
99
/dev/null
/bin/sh
accept
listen
bind
socket
(nfsiod)
P
add
Ox
D
第6章UNIX后门与溢出案例分析203
回
启动时首先运行了
XU
Tineg
---
## Page 227
强安全配置。
靠的介质（正版安装盘）完全重装系统（即格式化分区再安装系统，而非覆盖安装），并加
到这种高明的入侵之后，光凭找到受损文件删除它或还原配置并不管用，你还应当确保用可
的是IRCbot配置文件）。因为涉及rootkit，因此对这种事件的响应更加困难。多数情况下遇
现并记录它们的动作。
使用外部日志系统收集分析日志的好处就在于，在攻击者删除或修改这些日志文件前就能发
非常困难。这也就是入侵检测系统（IDS）和分布式日志存在的必要性。在第3章告诉大家
和分派不同进程的运行环境，从而起到进程间的相互隔离效果。
SELinux 能够为系统的关键文件，例如系统日志，审计、系统核心等文件进行保护，还能定义
（w）、执行（x）权限，还包括ACL等措施，无法阻止高水平攻击者对系统的入侵，而
预防措施
读者可以到协议分析论坛上查询。
Monitor、Network General Sniffer、WildPackets开发的EtherPeek商业网络分析器，感兴趣的
用户图形界面、可解码超过400个协议等。
码)，并使嗅探过程更便利（如规避交换机）的程序集。
org/windump网站上获取。
UNIX系统，几乎所有操作系统都有对应的版本。
列出一些常见的网络分析器。
关知识。大家可以参考《TCP/IP详解卷1:协议》、《UNIX网络编程》这两本经典图书。下面
悉网络协议，例如以太网和开放系统互联（OSI）的基础知识，还要了解CSMA/CD协议相
疑难解答
入、移除内核模块，而不必重启计算机。
204UNIX/Linux网络日志分析与流量监控
能，
另外，在Windows 平台上还有科莱网络分析系统、Windows 系统自带的Network
综上所述，这次入侵分析的难点在于它用加密来隐藏系统文件的内容（此次入侵中加密
在很多事件中日志文件都会被攻击者修改或删减，因此确定你的系统是如何被攻击的也
2）WinDump：Windows 版本的Tcpdump，它使用WinPcap 库，可从http://www.winpcap.
6）Wireshark：目前最好的网络分析器之一。Wireshark有很多特征，比如，拥有友好的
1）Tcpdump：最古老、最常用的网络分析器。它基于命令行模式，运行在Linux 及类
因为传统的Linux系统所采用的访问控制机制（用户、组、其他组），以及读（r)、
为了抵御网络攻击，首先系统应使用最新的安全补丁，除此之外还需启用SELinux
5）Dsniff：一个非常流行的网络嗅探软件包。它是一个用来嗅探感兴趣的数据（如密
4）Snort：一个网络入侵检测系统（NIDS），可用作网络分析。
3）Snoop：一个命令行模式网络分析器，包含在Sun Solaris 操作系统中。
4.为了能够熟悉这些工具，大家对网络分析器的基本工作原理要有所了解，更需要熟
1.因为出现的这两个额外服务分别源于后门 shell和 IRC 程序。
它是攻击者留下的一个典型的后门程序。
ipv6.o用于混淆视听，隐藏攻击者在系统内控制的一个内核模块。
功
---
## Page 228
日志获取
呢？唯一的方法就是查出真相。
这一事件对公司造成了影响，再加上媒体的炒作，公司股票也随之下跌。如何挽回这一局面
站，而讥讽公司安全措施薄弱的消息被广泛转发。一定是有网络推手制造了这起事件。由于
区，填写操作日志之后，就草草收兵了。
数据从远程服务器的磁盘中复制过来，网站得以及时恢复。
以及数据库备份远程复制到磁盘中。这回遇到了问题，好在他基础工作做得扎实，很快就将
常备份工作，主要涉及数据文件和数据库两方面内容，备份工作主要是定期将网站目录文件
后，立即开始了应急措施，修复被篡改的页面。他们的网站采用微软IS架构，小麦负责日
司网站的支付系统，而且网站首页被更改了。琳琳立即检查了那个网站，发现网页确实已经
程师小麦和他的团队。一个周五的早上，前台职员琳琳接到一个顾客电话，抱怨无法登录公
事件背景
构)，有哪些防篡改的解决方案呢？
一些线索。攻击者是利用了什么漏洞来攻陷服务器的？对于门户网站（IIS架构和LAMP架
例告诉管理员如何通过黑客攻击系统后留下的痕迹找到攻击来源并作出响应。
算机操作系统的漏洞层出不穷，如果缺乏有效防护，网页篡改事件无法避免。本章用三个案
但是，在接下来的星期一情况变得更糟。公司网站被黑的事件被人很快转发到了社交网
被篡改。
件报告中，网页篡改占51%，其余为垃圾邮件、蠕虫、网络仿冒、木马等。这是因为目前计
7.1
某公司是一家普通的电子商务公司，年收入过百万。维护这家公司IT系统的是网络工
张经理立刻要求调查此事，小麦随即开始对这次攻击事件展开彻底调查。在被攻破的
小麦将网页恢复到正常状态后，重启了微软ISServer，并将服务器重新部署在DMZ
与此同时，值班室的网管也收到了监控系统发来的报警信息。小麦向经理汇报此事之
本案例中讲述了 ⅡIS 服务器网站被篡改的事件，工程师小麦通过 IS 日志的分析发现了
难度系数：★★★★
目前以网页篡改和垃圾邮件为主的网络安全事件正在大幅攀升。2013年的网络安全事
故事人物：小麦（网络工程师）、琳琳（公司前台）
关键日志：IIS日志
案例十：当网页遭遇篡改之后
第7章UNIX系统防范案例
---
## Page 229
集所有的日志文件并把它们导入数据库以供分析。因为字符串cmd.exe一般情况下不会出现
用了这个漏洞，那么攻击的证据将留在Web服务器的日志里。所以他们从Web服务器中收
exe。通过它，攻击者可以在运行Web服务器的主机上执行命令。有趣的是，如果攻击者利
遍历漏洞）时，他们开始了修复工作。这个漏洞依赖于一个系统命令行解释器，即cmd.
当IT人员了解了攻击者侵入系统的方法一利用广为流传的Unicode漏洞（也叫目录
着攻击者在内网中放置了一个后门，他可以访问内网中的各种系统，包括各类敏感数据。
CVE数据库中的#CVE-2000-0884，如图7-1所示。
来控制整个目标主机，本案中攻击者就利用了这个漏洞。关于这个漏洞的详尽描述请参看
微软早期发布的IS服务器有一个广为人知的Unicode漏洞，攻击者可以通过这个漏洞
人侵事件剖析
互动问答
Web服务器日志信息：
2/03
事件日志也没有任何登录的记录。在那段可疑的时间里，看上去有问题的就是下面这 22
的原因。在被攻击系统上的系统日志没有提供任何攻击的证据，并且在攻击期间，Windows
Web服务器上，保存了一个用旧页面构架的网站，这就是好几个小时没人注意到网站被篡改
206
当IT工作人员了解到这台主机被攻破时放置在网络内部，他们感到很不安，因为这意味
381
网址是http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2000-0884。
4.对于门户网站有哪些防篡改解决方案？
2.攻击者怎么扰乱跟踪？查
1.攻击者利用什么漏洞来攻陷Web服务器？
根据前面的22条日志文件记录，你是否能回答如下的问题？
8
UNIX/Linux网络日志分析与流量监控
假设你是公司的管理员，将如何应对被黑的服务器？
03che
ch
paro
29
im.
8
la
Mozil
ozi
+（
)+
(dX
C-2K3
2K3
2K3www-2K3.victimcom 80GET/mmc.gif-40433874390ww.victim.com
y
800
88
in
/scripta/.../WIN/system32/cmd.exe/c+dix+c:
/scripts/../../WINNT/system32/cmd.exe/c+dix+a:
/scripts/../../WINT/system32/cmd.exe/c+dir+d:
-200
/./WINNT/system32/cmd.exe
/WINNT/system32/cmd.exe/c+dir+d:
228
SIEY
44416ww.victim.com
RIRS
/c+dir+c:
支小年
---
## Page 230
盘、E：盘、C:lasfroot等），并访问了目标主机的主页。
可以了解整个系统的环境。下面这些日志显示了攻击者遍历出更多的目录结构（例如D：
的目录。
洞，就其本身而言并不会对目标主机产生什么危害。
列表。这是自动扫描程序普遍使用的一种非破坏性技术，其目的是探测主机是否具有这种漏
在日志中，所以IT人员搜索这个字符串并且找到如下代码：
loz
接下来又是一次探测，这次探测的目的是：如果目标主机存在D盘就列出D：盘上存在
19008
以下 13 条日志记录显示了攻击者得到了各个目录的结构以了解系统的概况，这样他就
日志内容表明，这是第一次探测。如果成功，攻击者将得到受害者计算机C：盘的目录
+(compatible;+MSIE+6.0;+Windows+XP)
(compatible;+MSIE+6.0;+Windows+XP)
GET /scripts/../WINNT/system32/cmd.exe /c+dir+d:200747484 31www.victim.comMozilla/4.0
GET/scripts/.//winnt/system32/cmd.exe/c+dir+c:20073048431www.victim.comMozilla/4.0+
04/15/20094:01chewie.hacker.comW3SVC1WWW-XPWwW-XP.victim.com80
04/15/20094:01chewie.hacker.comW3SVC1WWW-XPwWW-XP.victim.com80
2
CVE-IT
200
hecker.c
0+（
ACKTr.
200
5
71IS%c1%1c
ati/5327.pho
VC
8
MSIE+6
C2-W
W-2K
图7-1CVE漏洞库信息
3
+0/
S+XP
限自个
MSIE+E
第7章UNIX系统防范案例207
立业
品
/../WINNT/system32/cmd.exe
WTN
20本
ands,via malfo
T/system32/cmd.exe
stem32/cmd.exe
POOSEASI
URL
---
## Page 231
道符，这就是要改名为cmdl.exe的原因。
[&｜（,;%<>)]，如果发现有这些字符就会返回500 错误。所以不能直接使用cmd.exe 加管
到了更改主页的目的。服务器在加载程序时，如果检测到有cmd.exe串就要检测特殊字符
写一个web 页，想用它来替换服务器的页面。
cmdl.exe来继续他的“不轨行为”。用“cmdl.exe”检索所得结果的第一条显示了攻击者正编
复制到ArA目录下，并重命名为cmdl.exe。
测试。
208UNIX/Linux网络日志分析与流量监控
这里需要注意的是，入侵者使用的方法是利用 echo 回显、管道工具“>”、“>>”从而达
接着，攻击者在C：盘建立了一个目录，名为 ArA。为下一步着想，他把 cmd.exe 文件
攻击者熟悉了环境之后，攻击开始了！首先，他重新命名了一个不重要的Web页进行
紧接着是对服务器上原来的Web页进行备份。
6.0;+Windows+XP)
- 200 27641415 www.victim.comMozilla/4.0+(compatible;+MSIE+6.0;+Windows+XP)
最后，攻击者用篡改过的主页覆盖了服务器原来的页面。
www.victim.comMozilla/4.0+(compatible;+MSIE+6.0;+Windows+XP)
re.Someone+should+check+your+system+security+coz+you+sure+aren't.****You,+my+friendz+,are+completely+owned.+I'm+here,+your+security+is+nowhe
前面的日志项是关于cmd.exe 的检索结果的最后一条。显而易见，攻击者将在以后用