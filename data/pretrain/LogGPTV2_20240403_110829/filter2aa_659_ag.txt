n11=80104993294056800526997891239658574149881038942561596603682887778423811663417729024
719401942511160681100572852136887906533603822136103706240702983615514887471978971434560
354777928455810183380115550976281837647087421578957493900221227439995043326977532514401
546862026302855780461877424023298815796171262867790113081470391751300411454723437562974
717683458116630655231107552266940334782809583152069356329124986983239069864669164720437
113336225484623499017513804792870328983346073423530209391614748950920606192387762330059
619431705988482432252753266247034827407980078112010494654606350076385262218740460863954
285828566128829391891218435423668797591951030022193207413553102831417047591711020425404
233611661933584121341899060559062084251161581544311461233388143092076900293337088749455
864083300533990670660349780984686386396739154364704922430955693690976817925958185152021
466990456046764047314448163392043848761578868926296174105314661055499722486133194971672
105655349953118669542543916322280291781314026651373584144771741884636009665259284494036
293217101914343408018472809332614382116509789505893537221570894808824859658512747577002
196250126291527449747842886813045512261201640838160756120080226703886951689666538757689
5570245272035575637
n12=63540197034020572513932500650497834451274492695868803142344800399207276993180821748
670957415149223087937457431345766243642326343779238971137968751205639111741080756549254
871869116618337263315164491713527225977099709619551848905631935025867372309541792215318
242391375927289369686742619370447975277251108145772951384368258895149955113243292314799
723859753805590293212379225259351422532819654148345174731404808082440553074253347391432
929434648669168490410040697207303705008986181660450565004295377836062193438081599954118
306758549860605385712577597991507732956672253183008971482397996593419033853856418825327
101636729989001544961114116678004876340325230916051716456911074056158410083921213866188
161535138294681381807889988259531336293459495189556018900343877545067534359014782118695
352626222497333396245456127532192515161917820449934233974963775810012689333099425290292
650970561788223961038042083079108890737839722681751409546881522818671622005707509571189
407003234461324480393454131857384702936556315991897040405713727088458790576682875038775
313006527414790237999322478014966360046249228189132070213415385335939358890275042397206
867929337333386938939397035376050743691323365742218553148202323738424753555466648176019
7851108297145147371
e11=18988399805620487546070690735278448521325364324407931061241814065147701780667759882
323620548098500747749818368981186514694241487259707081994611130887050449056335925789363
339183285445059109967464286792994198794724447909413635580258876205708565985483202464263
549743957652437416461217434134471322972303653551480669148308569044337503791146921229007
237721149911999796389875715598605508834709772464595230688628988596944614271486266282831
988966593371354385065747995853781786787903084102667132560034790226992645688445059775135
370135292129615732694946837409872836826081894067195733015736626967539030509918128841921
925697372743218289868476408398134247018945784729333857277574450112911349611248226122398
65
e12=12626474190189300226171896089957122600956230472738938115295107545966363902555649888
278217611269179764309781755224502779070632479811064055190945606163782412471116989151999
993639480157037886165546572751473387668052899092611291650251560781367185730064790308275
853474581436457383537161891312093980567418648484868180764403557788869934620125333972083
309250573055026532191736294669486351103527521624425525418126656075167531865958173760297
077775990290407247274999521612611797072718144059071652079044997221227790962305635480114
919323784296547644868551478731357691166374842404545962310926844245722581197680935627472
492515189653804659940550494117153535471474667119493918145505915918305152622965560509468
81
n2=209798341155088334158217087474227805455138848036904381404809759100627849272231840321
985747935471287990313456209656625928356468120896887536235496490078123448217785939608443
507649096688546074968476040552137270080120417769906047001451239544719039212180059396791
491281787790213953488743488306241516010351179070869410418232801398578982244984544906579
574766534671056023774009163991804748763929626213884208260660722705479782932001102089367
261720194650874553305179520889083170973755913964440175393646890791491057655226024046525
748177999422035469428780228224800114202385209306803288475439775037067014297973202621118
959024226798935588827359265962780792266516120013602384766460619793738405476219362508944
225007365127768741191310079985425349292613888185378948854602285379329682053663283534930
182589905986063348509703027498270111412063194971956202729807710253369312175636837558252
924035002153389909587349043986253518050303628071319876207392440085675892353421232158925
122721273720564784886530611286461575045181073744696415657043278123662980166364494583141
297996445429477446442693717498789391918530672770193730629928408766563592081857706608049
076318165712479742423149330311238462044666384622153280310696667586565906758451118241914
402257039981388209
e2=65537
n3=539779851369541956878655738599584730199799866957191805784596190682932284216781781433
367450841202917758999300635019369629627621029957135109806205877317954671312041249493462
048283611940752235036153024920172209763260723728345918562258401803973624430150143563078
517485996070862532682695228590709019451174548520135142052216785774589096706631010293690
859363524584240662502290912412366366114571976050857239915691266377257797199583543940504
695517331512813468837128344612227973709974625418257243011036826241599265375741977853552
204640800449679679351666009764297016524814036295707311913711955324055690490892097177271
718850857268982130811714517356073266905474635370690445031512184247179039751734276906533
177939993769044135143389748416635981226449566039039202521305851567296884751935162651063
209779647359922622084851547605090230221057349511482738300221222563908357379545905837110
168948295030747460300104202323692732549831403834387939156877086852393515817984772384147
449841124275061609701453997579569931391166586163299940486204581696722731952467570857217
406030804590055255431828403195798003509083922294733709507134156466158642941338493323430
671502043066148246348074878064089651235355282144209668143249348243220714471988019011613
749340243917652821
e3=817930097875308458781286189404739522551604911037694881210981131943027561461277372667
234589335969190028143248438267004704469737481804351273153340257637464540547720723980149
842877478376816388007849544874742142507852198157840863879033652837201927107371201337114
193980801704939943485868729948046175363816471940461212893978705579776217474509207454741
218334919215663871175087208331379555143946550772480762667451493517010457371545878236646
958713850884598049067389024571372978291708991027198055715959280735050415719291353000719
951014400484802022118155847216054301873312422526612737937375191043960445936807865249902
907093670734986213905391374518641378206647046147896170301359165513614006087925006737928
391379886764875817100453577556530684244454575535120279683317756065656465263297568591293
528158126814180369668695225953994558860959138580762010827933349817002816733869023511700
351526428184395398499795887827234777856193372679247398185575545452288632166967679081318
966808437315389775454029086734675103356750092247731753044596775395522145474494620855539
458811148461070078956654750740230954995774081553506905783791520485249093016884360573263
232801712915485285722789536254914673761890618065162321684850049143814245625065345805392
262224029973613633517963918089873026969069996579964475777447214721027111115076904897687
124973115638793926074919237036148828577537762294481757029209520190614256740353915117920
9316853493906909989301225903409448461436855145
c11=18979511327426975645936984732782737165217332092805655747550406443960209507493506811
471688957217003792679188427155591583024966608843371190136274378868083075515877811693937
328204553788450031542610082653080302874606750443090466407543829279067099563572849101374
714795279414177737277837595409805721290786607138569322435729584574023597293220443351227
559400618351504654781318871214405850541820427562291662456382362148698864044961814456827
646881685994720468255382299912036854657082505810206237294593538092338544641919051145900
715456411365065867357857347860000894624247098719102875782712030938806816332901861114078
070638796157513248160442185781635520426230183818695937457557248160135402734489627723104
008584934936245208116232179751448263136309595931691285743580695792601141363221346329077
184688857290503770641398917586422369221744736905117499140140651493031622040723274355292
502182795605723573863581253354922291984335841915632076694172921289489383700174864888664
946302588049384130628381766560976143458735712162489811693014419190718601945154153130272
620025118408017441490090252674737105557818759190934585829634273698371996797545908125156
282869589331913665938038870431655063063535672001112420959158339261862052308986374193671
007982914711432579
c12=33658700567130452756674594835529041263626174896958197621423957862181686334311743352
403353383863694167930049727090969677502103100431247799713074136170926282273690434064113
865235963295045565192046404244802246766459648405517427089517049907634733338122276851859
901852094809894362622906199612626015460403810154354658891761957670286644499857855590707
099033157472213514177818263155980215449381568728407752446933129024905729116380329061970
110400702883660983284735174802035479878850879025893571839978300206949012366334515690244
050150711728974769551026646153901943161012335117622744361231703789925777404575148713564
605230927709893991908802928443722184018276980885018482768130761138935339268370751614173
606779389737891123581904943254275842990194520263211708959589928039057570626623925284115
249053435376011823191819011004331987774411908381121470759312275740924064525740909743606
182561368677391646612269316897106241804670396914400477927039132064549558602434266800249
715535862379594269247716448947591735100314904508728351072898109644989013073505501507555
761425386769870247992061929991981676897258127350783730917945037463491656708325163020306
706566391007392699051710892149044291937277417020123973406481930169352736623300792567004
3499415100789027665
c2=183525726080559025503503869500737745304538578972487380303800078307011355703106220043
686052083369222665132381341274968221997997617137823661781778095971371026124441475655781
552605247474398991500122230272184899461240862768148996755638376695597951533496864342427
382074256530795143760890709807975964571519657724601095196235725021095926123943166802022
877124657217673413022348061302445513872961330517608930331949626919420402285455088950091
952911062975814700665459913526688261973468305610101984175270579445079021439656340588482
760172834789336750529936578223228667789949562050337045820476183240710453490725265402507
074631126685793425373495672478107156042206902153136413295226740801460472915707524302319
235663024634918773776170447689789974385966434584751289368509949340294760301366430539975
492537920762607654591666183698649426810568648159962533156319300027388542358411203218700
752617822503575064368255500888264693965080459122583036529122171511272809594357414199617
214184286055150961603446887956555628897551653620067753171880090082887826917058795106558
921819750034857146043405423784773882257363166823796166767702345579394710989196470537993
137772486784556202317212027808309800638240030763088115405344923177198115888987271341905
45533822501681653
c3=113097822337683973761068913398570777162211043704088253732500045618770280334319497174
908657828372816818344430304314992760410247741225285170975119344962728883084314382093407
445567724674775086423808679124143380073906159023182353116556175251427048715466914368972
746661938211846262612414049036821553068430149530397389927209475908905748728402722287875
974303298260579839357610962198145974153609818939841880084892796820949226354126424023144
300953584658958900737493704530725894948802258740332090822797815745616247879170037794873
059391625680745994045522420168248552864215035136318711240256011217929372430302003068882
829637056296413462078222453765071094277727760527662423010417144554652783429899139309180
017349156600053882338180319473460877576898373222480215735280046214925463242092830060830
764299787309912687294672319845054775281463150375545716818434962456139485501224661520991
156961587158843064393883274763714930309353593180897123378717852182761518709151878662808
890356934477932099818218743384674756674800089177733447066489275506387382342429495897972
218764782517198727316942685748481956118012927027254979181519862451112593068440686462293
151078537886822555211870303467014484443432209106264020502334805536091587252238173816637
270028678636848763
cf = continued_fraction(n11/n12)
fracs = cf.convergents()
for xx in tqdm(fracs):
    q1 = xx.numerator()
    q2 = xx.denominator()
    if q1.nbits() in range(511, 513) and q2.nbits() in range(511, 513):
        if n11 % q1 == 0:
            print('--------------------------------')
            print(q1)
            assert n11 % q1 == 0
            p1 = int((n11 // q1)^(1/2))
            p2 = int((n12 // q2)^(1/2))
            assert p1^2 * q1 == n11
            phi1 = (q1 - 1) * p1 * (p1 - 1)
            phi2 = (q2 - 1) * p2 * (p2 - 1)
            d1 = inverse(e11, phi1)
            d2 = inverse(e12, phi2)
myJWT
CVE-2022-21449, https://neilmadden.blog/2022/04/19/psychic-signatures-in-java/
            m1 = pow(c11, d1, n11)
            m2 = pow(c12, d2, n12)
            # print(m1)
            # print(m2)
            break
m1 = int(m1)
m2 = int(m2)
P. = PolynomialRing(Zmod(n2))
f2 = m1*m2*x2 - m1 + m2
root = f2.monic().small_roots(X=2**672,beta=0.75)[0]
p2 = gcd(int(m1*m2*root - m1 + m2),n2)^(1/6)
q2 = n2 / p2^7
d2 = int(pow(e2,-1,p2**6*(p2-1)*(q2-1)))
b = int(pow(c2,d2,n2))
P. = PolynomialRing(Zmod(n3))
f3 = e3 * x3 - b
root = f3.monic().small_roots(X=2**672,beta=0.75)[0]
p3 = gcd(int(e3 * root - b),n3)^(1/6)
q3 = n3 / p3^7
d3 = int(pow(e3,-1,p3**6*(p3-1)*(q3-1)))
m3 = pow(c3,d3,n3)
print(long_to_bytes(int(m3)))
from pwn import *
import requests
import json
import os
import gmpy2
from pwnlib.tubes.tube import *
from hashlib import *
from Crypto.Util.number import *
from tqdm import tqdm, trange
import random
import math
from Crypto.Hash import SHA256
from Crypto.Cipher import AES
from factordb.factordb import FactorDB
from sage.modules.free_module_integer import IntegerLattice
import itertools
from fastecdsa.curve import Curve
from random import getrandbits, shuffle, randint
def resultant(p1, p2, var):
    p1 = p1.change_ring(QQ)
    p2 = p2.change_ring(QQ)
    var = var.change_ring(QQ)
    r = p1.resultant(p2, var)
    return r.change_ring(F)
# r = remote('123.56.87.28', '19962')
# context(log_level='debug')
# ALPHABET = string.ascii_letters + string.digits
# rec = r.recvline().decode()
# print(rec)
# suffix = rec[rec.find('+'):rec.find(')')][1:].strip()
# digest = rec[rec.find('==')+3:-1].strip()
# print(f"suffix: {suffix} \ndigest: {digest}")
# for i in itertools.product(ALPHABET, repeat=4):
#     prefix = ''.join(i)
#     guess = prefix + suffix
#     if sha256(guess.encode()).hexdigest() == digest:
#         # log.info(f"Find XXXX: {prefix}")
#         print((f"Find XXXX: {prefix}"))
#         break
# r.sendline(prefix.encode())
payload1 = b'{"typ":"JWT","alg":"myES"}'
payload2 = b'{"iss":"qwb","name":"administrator","admin":true,"exp":2659185892270}'
payload3 = b'\x00' * 64
payload = ''
payload += b64e(payload1)
payload += '.'
payload += b64e(payload2)
payload += '.'
Lattice
output.txt⾥是远端拿到的C
payload += b64e(payload3)
print(payload)
from pwn import *
import requests
import json
import os
import gmpy2
from pwnlib.tubes.tube import *
from hashlib import *
from Crypto.Util.number import *
from tqdm import tqdm, trange
import random
import math
from Crypto.Hash import SHA256
from Crypto.Cipher import AES
from factordb.factordb import FactorDB