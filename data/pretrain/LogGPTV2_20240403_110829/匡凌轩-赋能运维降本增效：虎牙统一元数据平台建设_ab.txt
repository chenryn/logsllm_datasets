02 方案实践
 设计思考 
容
器
| 机房 | 基础设施 | 监控 | 域名 | Mysql | Kafka | TSD |
|---|---|---|---|---|---|---|
| 机房 |基础设施 |监控 |域名 |Mysql |MQ |TSD |
| 机房 |基础设施 |指标 |应用 |中间件 |Flink |TSD |
| 机房 |基础设施 |指标 |应用 |中间件 |Flink |B |
| 机房 |基础设施 |指标 |服务 |中间件 |Flink |B |
以应用服务为元数据的关联核心
GOPS 全球运维大会 2023 · 上海站
元数据网络总览
4.应⽤服务到中间件关联
| 1.客户端到分布式服务调⽤关联 | RPC 送礼物： | 调⽤ | GiftServer | RPC 鉴权： | AuthServer | 调⽤ | 调⽤ | Redis ||---|---|---|---|---|---|---|---|---|
| 1.客户端到分布式服务调⽤关联 |RPC 送礼物： |调⽤ |GiftServer |/api/auth |AuthServer |调⽤ |调⽤ |Redis |
| 1.客户端到分布式服务调⽤关联 |/api/sendGift |调⽤ |GiftServer |调⽤ |AuthServer |调⽤ |调⽤ |Redis |
| 1.客户端到分布式服务调⽤关联 |Huya App |调⽤ |GiftServer |调⽤ |MoneyServer |RPC Redis： |RPC Redis： |查询余额： |
| 1.客户端到分布式服务调⽤关联 |Huya App |调⽤ |GiftServer |调⽤ |MoneyServer |/redis/SET |/redis/SET |查询余额： || 1.客户端到分布式服务调⽤关联 |Huya App |调⽤ |GiftServer |调⽤ |MoneyServer |/redis/SET |/redis/SET |select * from money where uid=? |
| 1.客户端到分布式服务调⽤关联 |Huya App |调⽤ |GiftServer |调⽤ |MoneyServer |RPC Mysql： |RPC Mysql： |select * from money where uid=? |
| 1.客户端到分布式服务调⽤关联 |Huya App |调⽤ |GiftServer |RPC 扣费： |MoneyServer |RPC Mysql： |RPC Mysql： |Mysql |
| 1.客户端到分布式服务调⽤关联 |Huya App |调⽤ |GiftServer |RPC 扣费： |MoneyServer |调⽤ |/mysql/SELECT |Mysql || 1.客户端到分布式服务调⽤关联 |Huya App |调⽤ |GiftServer |/api/payMoney |MoneyServer |调⽤ |/mysql/SELECT |Mysql |
2.应⽤部署资源归属关联
| ⼲州机房 | 物理机1 | 归属 | 容器1 | 实例 | 请求量 | 异步上报消费流⽔： | 异步上报消费流⽔： | 归属 | Kafka/MQ |
|---|---|---|---|---|---|---|---|---|---|
| ⼲州机房 |物理机1 |归属 |容器1 |实例 |请求量 |topic: report_gift_log |topic: report_gift_log |归属 |Kafka/MQ |
| ⼲州机房 |物理机1 |归属 |容器1 |实例 |请求量 |调⽤ |调⽤ |归属 |Kafka/MQ || ⼲州机房 |物理机1 |归属 |192.168.1.1:8080 |资源利⽤率 |指标 |调⽤ |调⽤ |归属 |Kafka/MQ |
| ⼲州机房 |物理机1 |归属 |192.168.1.1:8080 |资源利⽤率 |指标 |实例 |实例 |归属 |Kafka/MQ |
| ⼲州机房 |物理机1 |归属 |容器2 |资源利⽤率 |指标 |实例 |实例 |归属 |Kafka/MQ |
| ⼲州机房 |物理机1 |归属 |容器2 |资源利⽤率 |关系 |实例 |实例 |归属 |Kafka/MQ |
| ⼲州机房 |物理机1 |归属 |192.168.1.2:8080 |资源利⽤率 |关系 |实例 |实例 |归属 |Kafka/MQ |
| 归属 |归属 |归属 |容器3 |⺴络流量 |关系 |3.监控指标关联(Metric) |3.监控指标关联(Metric) |归属 |容器1 || 物理机2 |物理机2 |归属 |容器3 |⺴络流量 |关系 |3.监控指标关联(Metric) |3.监控指标关联(Metric) |归属 |容器1 |
| 物理机2 |物理机2 |归属 |容器3 |⺴络流量 |关系 |请求量 & ⺴络流量 & 资源利⽤率 |请求量 & ⺴络流量 & 资源利⽤率 |归属 |容器1 |
| 物理机2 |物理机2 |归属 |192.168.1.3:8080 |⺴络流量 |关系 |请求量 & ⺴络流量 & 资源利⽤率 |请求量 & ⺴络流量 & 资源利⽤率 |归属 |容器1 |
| 物理机2 |物理机2 |归属 |192.168.1.3:8080 |⺴络流量 |关系 |请求量 & ⺴络流量 & 资源利⽤率 |请求量 & ⺴络流量 & 资源利⽤率 |归属 |192.168.1.11:8080 || 设计总结： |设计总结： |归属 |192.168.1.3:8080 |⼲州 到 上海 跨机房调⽤ |关系 |上海机房 |物理机1 |归属 |容器2 |
| 设计总结： |设计总结： |归属 |192.168.1.3:8080 |⼲州 到 上海 跨机房调⽤ |关系 |上海机房 |物理机1 |归属 |192.168.1.12:8080 |
| 设计总结： |设计总结： |归属 |192.168.1.3:8080 |⼲州 到 上海 跨机房调⽤ |关系 |归属 |归属 |归属 |192.168.1.12:8080 |
| 1.设计元数据接⼊规范和关联模型 |1.设计元数据接⼊规范和关联模型 |归属 |192.168.1.3:8080 |⼲州 到 上海 跨机房调⽤ |关系 |物理机2 |物理机2 |归属 |容器3 || 2.关联打通全⺴应⽤、资源和中间件 |2.关联打通全⺴应⽤、资源和中间件 |归属 |192.168.1.3:8080 |⼲州 到 上海 跨机房调⽤ |关系 |物理机2 |物理机2 |归属 |192.168.1.13:8080 |
3.⽀持数据可视化、检索和分析能⼒
GOPS 全球运维大会 2023 · 上海站
|  | 元数据体系架构 | 元数据体系架构 | 元数据体系架构 | 元数据体系架构 | 元数据体系架构 | 计 
量 
计 |  |
|---|---|---|---|---|---|---|---|
|  |表现输出 |Web产品展⽰ |Web产品展⽰ |开放平台 |开放平台 |计  量  计 | |
|  |表现输出 |应用资源图谱 核心链路 架构分析 资源回放 智能标签 |应用资源图谱 核心链路 架构分析 资源回放 智能标签 |OpenAPI  SDK  GremlinWeb |OpenAPI  SDK  GremlinWeb |计  量  计 |对 ||  |统⼀元数据平台 (Meta Hub) |统⼀元数据平台 (Meta Hub) |统⼀元数据平台 (Meta Hub) |统⼀元数据平台 (Meta Hub) |统⼀元数据平台 (Meta Hub) |费 |对 |
|  |统⼀元数据平台 (Meta Hub) |统⼀元数据平台 (Meta Hub) |统⼀元数据平台 (Meta Hub) |统⼀元数据平台 (Meta Hub) |统⼀元数据平台 (Meta Hub) |监 |对 |
|  |客户端 -> 信令/Web专区(资源) -> 应⽤服务(资源) -> 中间件(资源) |客户端 -> 信令/Web专区(资源) -> 应⽤服务(资源) -> 中间件(资源) |客户端 -> 信令/Web专区(资源) -> 应⽤服务(资源) -> 中间件(资源) |客户端 -> 信令/Web专区(资源) -> 应⽤服务(资源) -> 中间件(资源) |客户端 -> 信令/Web专区(资源) -> 应⽤服务(资源) -> 中间件(资源) |监 |对 ||  |客户端 -> 信令/Web专区(资源) -> 应⽤服务(资源) -> 中间件(资源) |客户端 -> 信令/Web专区(资源) -> 应⽤服务(资源) -> 中间件(资源) |客户端 -> 信令/Web专区(资源) -> 应⽤服务(资源) -> 中间件(资源) |客户端 -> 信令/Web专区(资源) -> 应⽤服务(资源) -> 中间件(资源) |客户端 -> 信令/Web专区(资源) -> 应⽤服务(资源) -> 中间件(资源) |控 |对 |
|  |数据接⼊ 认证鉴权 关联分析 建⽴模型 数据输出 |数据接⼊ 认证鉴权 关联分析 建⽴模型 数据输出 |数据接⼊ 认证鉴权 关联分析 建⽴模型 数据输出 |数据接⼊ 认证鉴权 关联分析 建⽴模型 数据输出 |数据接⼊ 认证鉴权 关联分析 建⽴模型 数据输出 |告 |对 |
|  |接入覆盖 |CMDB |编译构建 |容器平台 |Taf平台 |警 |外 ||  |接入覆盖 |CMDB |编译构建 |容器平台 |Taf平台 |研 |赋 |
|  |接入覆盖 |CMDB |编译构建 |容器平台 |Taf平台 |研 |能 |
|  |IDC/Host/ISP... |IDC/Host/ISP... |Lang/Lib/Pack... |Image/Pod... |Server/Interface... |研 |能 |
发
| 监控平台 | 调⽤链 | 中间件 | Web专区 | 效 |
|---|---|---|---|---|
| 监控平台 |调⽤链 |中间件 |Web专区 |能 |
| Biz/App/Infra Metrics... |App Server Tracing... |Cluster Resource... |Domain/LB... |能 |
| 数据转换 |Core Modules |Core Modules |资源回放 |运  维  平 || 数据转换 |关联打通 |检索查询 |资源回放 |运  维  平 |
| 数据转换 |关联打通 |检索查询 |资源回放 |台 |
| Meta Convert |Meta Correlate  |SDK  OpenAPI |App/Res Recode |台 |
基础核心
| Graph DB | Storage | OLAP | 链路根因定位 | Application | 多维资源分析 | 应用场景 |
|---|---|---|---|---|---|---|
| Vertex/Edge Model  |Storage |App/Res Snapshoot |Root-Cause Tracing |Application |Muti-Dim Analysing |应用场景 |
GOPS 全球运维大会 2023 · 上海站GOPS 全球运维大会 2023 · 上海站
|  | 应用场景 - 多维资源分析 | 应用场景 - 多维资源分析 | 应用场景 - 多维资源分析 | 应用场景 - 多维资源分析 | 2.跨机房流量治理 | 调用 | RPC 鉴权： |  |
|---|---|---|---|---|---|---|---|---|
|  |1.资源合理性治理 |1.资源合理性治理 |1.资源合理性治理 |1.资源合理性治理 |2.跨机房流量治理 |调用 |RPC 鉴权： | |
|  |RPC 送礼物： |RPC 鉴权： |RPC 鉴权： |AuthServer |RPC 送礼物： |调用 |RPC 鉴权： |AuthServer |
|  |RPC 送礼物： |/api/auth |/api/auth |AuthServer |RPC 送礼物： |调用 |/api/auth |AuthServer ||  |/api/sendGift |调用 |调用 |调用 |/api/sendGift |调用 |调用 |MoneyServer |
|  |Huya App |调用 |GiftServer |GiftServer |/api/sendGift |调用 |调用 |MoneyServer |
|  |Huya App |调用 |GiftServer |GiftServer |Huya App |调用 |GiftServer |MoneyServer |
|  |调用 |调用 |调用 |调用 |Huya App |调用 |调用 |MoneyServer |
|  |RPC 扣费  /api/payMoney |RPC 扣费  /api/payMoney |RPC 扣费  /api/payMoney |MoneyServer |Huya App |调用 |RPC 扣费 |MoneyServer ||  |RPC 扣费  /api/payMoney |RPC 扣费  /api/payMoney |RPC 扣费  /api/payMoney |MoneyServer |Huya App |调用 |/api/payMoney |MoneyServer |
实例
| 汇总： | 实例 | 实例 | 实例 | 实例 | 实例 | 实例 | 实例 | 实例 | 实例 | 实例 | 实例 |
|---|---|---|---|---|---|---|---|---|---|---|---|
| 汇总： |资源快照 |快照 |快照 |快照 |快照 |快照 |快照 |广州机房 |RPC 扣费跨机房 |上海机房 |上海机房 |
| 汇总： |资源快照 |快照 |快照 |快照 |快照 |快照 |快照 |广州机房 |/api/payMoney |上海机房 |上海机房 || 汇总： |容器1 |容... |容... |容... |容... |容... |容... |容器1 |请求量：40w/天 |请求量：40w/天 |容器1 |
| 汇总： |容器1 |容... |容... |容... |容... |容... |容... |容器1 |流量：2000mb/天 |流量：2000mb/天 |容器1 |
| 汇总： |CPU: 8C  内存: 8G ... |CPU: 8C  内存: 8G ... |CPU: 8C  内存: 8G ... |CPU: 8C  内存: 8G ... |CPU: 8C  内存: 8G ... |CPU: 8C  内存: 8G ... |CPU: 8C  内存: 8G ... |192.168.1.11:8080 |192.168.1.11:8080 |192.168.1.11:8080 |192.168.1.11:8080 || 汇总： |容... |容... |容... |容... |容... |容... |容... |容器2 |容器2 |容器2 |容器2 |
| 汇总： |容器2 |汇总： |汇总： |容... |容... |汇总： |容... |容器2 |容器2 |容器2 |容器2 |
| 汇总： |容器2 |汇总： |汇总： |容... |容... |CPU:  |容... |容器2 |容器2 |容器2 |容器2 |