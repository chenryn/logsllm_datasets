### Introduction

Based on the available information up to that day, we classified each vector associated with the domain name and IP address. The following sections detail our analysis and findings.

### Data Visualization and Analysis

1. **Absolute Lookups vs. Tuples (i)**
   - **Volume**: 1, 10, 100, 1000, 10000, 100000, 1e+06
   - **Lookups**: 0, 20, 40, 60, 80, 100, 120, 140
   - **Tuples**: 0, 500, 1000, 1500, 2000, 2500

2. **Unique CIDR Daily Growth (ii)**
   - **Days**: 0, 20, 40, 60, 80, 100, 120, 140
   - **Volume**: 0, 100, 200, 300, 400, 500, 600, 700, 800, 900, 1000

3. **Unique AS Daily Growth (iii)**
   - **Days**: 0, 20, 40, 60, 80, 100, 120, 140
   - **Volume**: 0, 100, 200, 300, 400, 500, 600, 700, 800, 900, 1000

4. **Unique CC Daily Growth (iv)**
   - **Days**: 0, 20, 40, 60, 80, 100, 120
   - **Volume**: 0, 20, 40, 60, 80, 100, 120, 140

5. **CNUSESPLTH (v)**
   - **Volume**: 1, 10, 100, 1000, 10000, 100000, 1e+06
   - **Days**: 0, 10, 20, 30, 40, 50, 60, 70

6. **TWKRINIT (vi)**
   - **Volume**: 1, 10, 100, 1000, 10000, 100000
   - **Days**: 0, 10, 20, 30, 40, 50, 60, 70

### Detection Timeline

The first domain name related to this botnet appeared on the following dates:
- **2010-06-24 06:56:34**
- **2010-07-01 14:06:47**
- **2010-09-08 04:32:36**

This indicates that the first domain name associated with the botnet appeared three months after its creation. Assuming systems like Notos or Exposure were operating on passive DNS data from ISC (one of the largest passive DNS repositories globally), they could have detected these domain names at the earliest possible time. This highlights the need for detection systems like Kopis, which can operate higher in the DNS hierarchy and provide an early global warning system for DNS.

### Feature Detection

| Features/Dates | 5/20 | 6/1 | 7/15 | 8/31 |
|----------------|------|-----|------|------|
| All            | 7    | 9   | 15   | 18   |
| RD+RP          | 3    | 5   | 12   | 16   |
| IPR            | 3    | 5   | 13   | 17   |
| RD+RP+AS(IPR)  | 3    | 5   | 12   | 16   |

**Table 1:** Number of botnet-related domain names detected by each feature family up to the specified date, assuming unsupervised operation.

### Discussion

#### Evasion Techniques

Kopis relies significantly on Requester Diversity (RD) and Requester Profile (RP) features. An attacker may attempt to dilute the information provided by these features to evade detection. This could be achieved by resolving domain names from a diverse set of open recursive DNS servers or even from random IPs acting as stub resolvers (e.g., using infected machines). However, this is challenging due to the RP feature family. The adversary would need to look up a large number of domain names under the same authority to alter the RP features, and repeatedly ask for different domain names served by the same authority to influence the RDNS weighing function.

To artificially create the necessary signal to dilute or disturb the modeling of legitimate and malware-related domain names, the adversary would need access to traffic at the authority name or TLD servers. Reliable and systematic access to DNS traffic at the authoritative or TLD level is extremely difficult to obtain, as it would require collaboration with the registrar controlling the AuthNS or TLD servers.

#### Domain Name Generation Algorithms (DGAs)

DGAs have been used by malware families (e.g., Conficker, Zeus/Murofet, Bobax, Torpig) in recent years. These DGAs typically generate new seeds with a daily periodicity, meaning that domain names generated by DGAs will be active only for a short period (e.g., a day). Due to the daily observation period required for Kopis to provide detection results, such malware-related domain names may be inactive by the time they are reported. Operating Kopis with smaller epochs (e.g., hourly granularity) could potentially solve this problem, but this requires further verification.

#### TLDs and Domain Registrars

Observing DNS resolution requests at the TLD level alone does not provide sufficient information to reconstruct the IP addresses mapped to queried domain names. One solution is to check a large passive DNS database. For domains not replicated in the passive DNS database, an active probing strategy can be used to retrieve resolved IP addresses with minimal overhead.

Domain registrars can combine Kopis with domain name registration information to reduce false positives and provide additional correlation between domain registration accounts that own domains with suspicious resolution behavior according to Kopis.

### Conclusion

In this paper, we presented Kopis, a system that operates at the upper DNS hierarchy to detect malware-related domains based on global DNS resolution patterns. To the best of our knowledge, Kopis is the first system that can operate at TLD servers and large authorities, providing DNS operators with the ability to detect malware-related domains early, even without information about the associated malware.

Kopis models three key signals at DNS authorities: daily domain name resolution patterns, the significance of each requester for an epoch, and the domain name's IP address reputation. Using more than half a year of real-world data from two major DNS authorities and the .ca TLD, our evaluation showed that Kopis can achieve high true positive rates (98.4% against all malware-related domains and 73.6% against new and previously unclassified malware-related domains) and low false positive rates (0.3% and 0.5%). Kopis was also able to detect newly created and previously unclassified malware-related domain names several weeks before they were listed in any blacklist and before information about the associated malware appeared in security forums. Finally, Kopis was used to identify the creation of a DDoS botnet in China, providing DNS operators with the preemptive ability to remove rapidly growing botnets at an early stage, thus minimizing their threats to Internet security.

### References

[1] M. Abu Rajab, J. Zarfoss, F. Monrose, and A. Terzis. A multifaceted approach to understanding the botnet phenomenon. In Proceedings of the 6th ACM SIGCOMM conference on Internet measurement, IMC '06, 2006.

[2] Alexa. The web information company. http://www.alexa.com/, 2007.

[3] M. Antonakakis, R. Perdisci, D. Dagon, W. Lee, and N. Feamster. Building a Dynamic Reputation System for DNS. In the Proceedings of 19th USENIX Security Symposium (USENIX Security '10), 2010.

[4] L. Bilge, E. Kirda, C. Kruegel, and M. Balduzzi. Exposure: Finding malicious domains using passive DNS analysis. In Proceedings of NDSS, 2011.

[5] C. M. Bishop. Pattern Recognition and Machine Learning (Information Science and Statistics). Springer-Verlag New York, Inc., Secaucus, NJ, USA, 2006.

[6] M. P. Collins, T. J. Shimeall, S. Faber, J. Janies, R. Weaver, M. De Shon, and J. Kadane. Using uncleanliness to predict future botnet addresses. In Proceedings of the 7th ACM SIGCOMM conference on Internet measurement, IMC '07, pages 93–104, New York, NY, USA, 2007. ACM.

[7] D. Dagon, C. Zou, and W. Lee. Modeling botnet propagation using time zones. In In Proceedings of the 13th Network and Distributed System Security Symposium NDSS, 2006.

[8] dihe’s IP-Index Browser. DIHE. http://ipindex.homelinux.net/index.php, 2008.

[9] DNS Whitelist Protect against false positives. DNSWL. http://www.dnswl.org, 2008.

[10] R. Duda, P. Hart, and D. Stork. Pattern Classification. Wiley-Interscience, 2nd edition, 2000.

[11] M. Felegyhazi, C. Keibich, and V. Paxson. On the potential of proactive domain blacklisting. In Third USENIX LEET Workshop, 2010.

[12] P. Fogla, M. Sharif, R. Perdisci, O. Kolesnikov, and W. Lee. Polymorphic blending attacks. In In Proceedings of the 15th USENIX Security Symposium, pages 241–256, 2006.

[13] S. Hao, N. Feamster, and R. Pandrangi. An Internet Wide View into DNS Lookup Patterns. http://labs.verisigninc.com/projects/malicious-domain-names.html, 2010.

[14] T. Hastie, R. Tibshirani, and J. Friedman. The Elements of Statistical Learning. Springer Series in Statistics. Springer New York Inc., New York, NY, USA, 2001.

[15] J. Jung, E. Sit, H. Balakrishnan, and R. Morris. DNS performance and the effectiveness of caching. IEEE/ACM Trans. Netw., 10:589–603, October 2002.

[16] MalwareDomains. DNS-BH malware domain blocklist. http://www.malwaredomains.com, 2007.

[17] P. Mockapetris. Domain Names - Concepts and Facilities. http://www.ietf.org/rfc/rfc1034.txt, 1987.

[18] P. Mockapetris. Domain Names - Implementation and Specification. http://www.ietf.org/rfc/rfc1035.txt, 1987.

[19] OPENDNS. OpenDNS — Internet Navigation And Security. http://www.opendns.com/, 2010.

[20] P. Porras. Inside risks: Reflections on Conficker. Commun. ACM, 52:23–24, October 2009.

[21] R. Perdisci, I. Corona, D. Dagon, and W. Lee. Detecting malicious flux service networks through passive analysis of recursive DNS traces. In Proceedings of ACSAC, Honolulu, Hawaii, USA, 2009.

[22] SBL. The Spamhaus Project Block List. http://www.spamhaus.org/sbl/, 2004.

[23] S. Shevchenko. Domain Name Generator for Murofet. http://blog.threatexpert.com/2010/10/domain-name-generator-for-murofet.html, 2010.

[24] SIE@ISC. Internet Systems Consortium: Security Information Exchange. https://sie.isc.org/, 2004.

[25] S. Staniford, V. Paxson, and N. Weaver. How to own the internet in your spare time. In Proceedings of the 11th USENIX Security Symposium, pages 149–167, Berkeley, CA, USA, 2002. USENIX Association.

[26] J. Stewart. Bobax trojan analysis. http://www.secureworks.com/research/threats/bobax/, 2004.

[27] B. Stone-Gross, M. Cova, L. Cavallaro, B. Gilbert, M. Szydlowski, R. Kemmerer, C. Kruegel, and G. Vigna. Your botnet is my botnet: analysis of a botnet takeover. In Proceedings of the 16th ACM conference on Computer and communications security, CCS '09, pages 635–647, New York, NY, USA, 2009. ACM.

[28] Team Cymru. IP to ASN mapping. http://www.team-cymru.org/Services/ip-to-asn.html, 2008.

[29] N. Weaver, S. Staniford, and V. Paxson. Very fast containment of scanning worms. In In Proceedings of the 13th USENIX Security Symposium, pages 29–44, 2004.

[30] D. Wessels, M. Fomenkov, N. Brownlee, and K. Claffy. Measurements and Laboratory Simulations of the Upper DNS Hierarchy. In PAM, 2004.

[31] Zeus Tracker. Zeus IP & domain name block list. https://zeustracker.abuse.ch, 2009.