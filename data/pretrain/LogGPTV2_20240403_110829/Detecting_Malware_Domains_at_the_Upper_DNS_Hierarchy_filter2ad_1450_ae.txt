based on the information we had on the domain name and
IP address up until that day. We classiﬁed each vector
13
 1 10 100 1000 10000 100000 1e+06 0 20 40 60 80 100 120 140VolumeAbsolute Lookups VS Tuples (i)LookupsTuples 0 500 1000 1500 2000 2500 0 20 40 60 80 100 120 140Unique CIDR Daily Growth (ii) 0 100 200 300 400 500 600 700 800 900 1000 0 20 40 60 80 100 120 140VolumeDaysUnique AS Daily Growth (iii) 0 20 40 60 80 100 120 0 20 40 60 80 100 120 140DaysUnique CC Daily Growth (iv) 1 10 100 1000 10000 100000 1e+06 0 10 20 30 40 50 60 70VolumeCNUSESPLTH 1 10 100 1000 10000 100000 0 10 20 30 40 50 60 70VolumeTWKRINIT2010-06-24 06:56:34, 2010-07-01 14:06:47 and 2010-
09-08 04:32:36. This means that the ﬁrst domain name
related with this botnet appeared three months after the
botnet was created and this would have been the earliest
possible time that either Notos or Exposure could have
detected these domain names assuming they were oper-
ating on passive DNS data from ISC — one of biggest
passive DNS repositories worldwide. This clearly shows
the need of detection systems like Kopis that can operate
higher in the DNS hierarchy and provide Internet with an
early global warning system for DNS.
Features/Dates
5/20
All
RD+RP
IPR
RD+RP+AS(IPR)
7
3
3
3
6/1
9
5
5
5
7/15
15
12
13
12
8/31
18
16
17
16
Table 1: Number of the botnet related domain names
that each feature family would have detected up-until the
speciﬁed date assuming that the system was operating
unsupervised.
6 Discussion
In this section, we elaborate on possible evasion tech-
niques and discuss some operational issues of Kopis.
6.1 Evasion techniques
Kopis relies signiﬁcantly on the Requester Diversity
(RD) and Requester Proﬁle features. An attacker may
attempt to dilute the information provided by the RP and
RD features to evade Kopis. This could be achieved by
resolving domain names from a diverse set of open re-
cursive DNS servers or even from random IPs acting as
stub resolver (e.g., using infected machines). This will
not be as easy as it sounds, due to the RP feature family.
This is because even if the adversary looks up domain
names from various different IP addresses, the adversary
will still have to look up a large number of domain names
under the same authority to make the weight of each re-
quester large enough to alter the RP features. Addition-
ally, the adversary will have to repeatedly (for a long
enough period of time) ask for different domain names
served by the same authority in order to inﬂuence/dilute
the RDNS weighing function.
In order to be able to artiﬁcially create the necessary
signal that may dilute or even disturb the modeling of le-
gitimate and malware-related domain names, the adver-
sary would have to obtain access to trafﬁc at the author-
ity name or TLD servers. Furthermore, the adversary
Figure 16: Volume of malware samples related with the
DDoS botnet as they appeared in our feeds. Day zero is
05-20-2010.
against four trained classiﬁers with the following set of
features; All Features, RD+RP Features, IPR
Features, and RD+RP+AS(IPR) Features. We
then marked the ﬁrst day that each classiﬁer detected
a domain name as malware-related, while setting the
threshold θ = 0.9. By doing so we identiﬁed the ear-
liest day that the classiﬁer would have detected the do-
main name without human forensic analysis on the re-
sults. The detection results from this experiment can be
found in Table 1.
What the results show is that only the combination of
all features can detect all the domain names until the end
of August. On the other hand the IPR and the combina-
tion of RD+RP features detected more than half of the
domain names by the middle of July, when the botnet
was in its peak. We should also note that in the middle
of July we saw the biggest volume of malware samples
related to the botnet’s domain names surfacing in the se-
curity community. Finally, we should also note that these
18 domain names appeared in public blacklists after the
take-down of the botnet was publicly disclosed (Septem-
ber 2010). Obviously, this was not exactly how we de-
tected the botnet. After the initial identiﬁcation of the 7
domain names in the beginning of May and with some
very basic forensic analysis, we managed to quickly dis-
cover the entire corpus of the related domains.
In an effort to place Kopis’ early detection abilities
in comparison with recursive-based reputation systems
(like Notos and Exposure) we check in the passive DNS
database at ISC when these 18 domain names ﬁrst ap-
peared. Fifteen of them never showed up in the RDNSs
that supply ISC with DNS data. The remaining three do-
main appeared for the ﬁrst time on the following dates:
14
would need a full list of statistical feature values used
from Kopis. Such an attack would be similar in spirit to
polymorphic blending attacks [12]. We note here that re-
liable and systematic access to DNS trafﬁc at the author-
itative or TLD level is extremely hard to obtain, since it
would require the collaboration of the registrar that con-
trols the AuthNS or the TLD servers.
Domain name generation algorithms (DGAs) have
been used by malware families (i.e., Conﬁcker [20],
Zeus/Murofet [23], Bobax [26], Torpig [27] etc.) in the
last few years. The new seed of these DGAs has typically
the periodicity of a day. This implies that domain names
generated by DGAs (and under the zones Kopis moni-
tors) will be active only for a small period of time (e.g., a
day). Due to the daily observation period mandatory for
Kopis to provide detection results, such malware-related
domain names will be potentially inactive by the time
they are reported by our detection system. Operating
Kopis with smaller epochs (i.e., hourly granularity) could
potential solve this problem. We leave the veriﬁcation of
this operation mode to future work.
6.2 TLDs and Domain Registrars
As we have already discussed, just observing the DNS
resolution requests at the TLD level will not provide
sufﬁcient information for the system to reconstruct the
IP addresses mapped with the queried domain names.
There are several ways to resolve this issue. The sim-
plest way to reconstruct the IP addresses for a given do-
main name is to check a large passive DNS database. For
the domains that are not replicated in the passive DNS
database, we can use an active probing strategy to re-
trieve the resolved IP addresses with little overhead.
As a ﬁnal classiﬁcation heuristic, especially in the case
of domain registrars, they can potentially combine Kopis
with domain name registration information. Classiﬁca-
tion results from Kopis can be combined with domain
name registration information (trivially accessible to do-
main registrars) in order to further reduce FPs but also
provide an additional correlation between domain regis-
tration accounts that own domains with suspicious reso-
lution behavior according to Kopis.
7 Conclusion
In this paper, we presented Kopis, a system that can op-
erate at the upper DNS hierarchy and detect malware-
related domains based on global DNS resolution pat-
terns. To the best of our knowledge, Kopis is the ﬁrst sys-
tem that can operate at TLD servers and large authorities
and provide DNS operators the ability of early detection
of malware-related domains — even without information
of the associated malware.
Kopis models three key signals at the DNS authori-
ties: the daily domain name resolution patterns, the sig-
niﬁcance of each requester for an epoch, and the do-
main name’s IP address reputation. Using more than
half a year of real world data of known benign and
malware-related domains from two major DNS authori-
ties and the .ca TLD, our evaluation showed that Kopis
can achieve high T Prates (98.4% against all malware-
related domains and 73.6% against new and previously
unclassiﬁed malware-related domains) and low F Prates
(0.3% and 0.5%). Kopis was also able to detect newly
created and previously unclassiﬁed malware-related do-
main names several weeks before they were listed in any
blacklist and before information of the associated mal-
ware appeared in security forums. Finally, Kopis was
used to identify the creation of a DDoS botnet in China.
This ability to identify malware-related domains on the
rise can provide the DNS operators the preemptive abil-
ity to remove rapidly growing botnets at the very early
stage, thus minimizing their threats to Internet security.
References
[1] M. Abu Rajab, J. Zarfoss, F. Monrose, and A. Terzis. A
multifaceted approach to understanding the botnet phe-
nomenon.
In Proceedings of the 6th ACM SIGCOMM
conference on Internet measurement, IMC ’06, 2006.
[2] Alexa. The web information company. http://www.
alexa.com/, 2007.
[3] M. Antonakakis, R. Perdisci, D. Dagon, W. Lee, and
N. Feamster. Building a Dynamic Reputation System for
DNS. In the Proceedings of 19th USENIX Security Sym-
posium (USENIX Security ’10), 2010.
[4] L. Bilge, E. Kirda, C. Kruegel, and M. Balduzzi. Expo-
sure: Finding malicious domains using passive dns anal-
ysis. In Proceedings of NDSS, 2011.
[5] C. M. Bishop. Pattern Recognition and Machine Learn-
ing (Information Science and Statistics). Springer-Verlag
New York, Inc., Secaucus, NJ, USA, 2006.
[6] M. P. Collins, T. J. Shimeall, S. Faber, J. Janies,
R. Weaver, M. De Shon, and J. Kadane. Using unclean-
liness to predict future botnet addresses. In Proceedings
of the 7th ACM SIGCOMM conference on Internet mea-
surement, IMC ’07, pages 93–104, New York, NY, USA,
2007. ACM.
[7] D. Dagon, C. Zou, and W. Lee. Modeling botnet prop-
agation using time zones.
In In Proceedings of the 13
th Network and Distributed System Security Symposium
NDSS, 2006.
[8] dihe’s IP-Index Browser. DIHE. http://ipindex.
homelinux.net/index.php, 2008.
[9] DNS Whitelist Protect against false positives. DNSWL.
http://www.dnswl.org, 2008.
[10] R. Duda, P. Hart, and D. Stork. Pattern Classiﬁcation.
Wiley-Interscience, 2nd edition, 2000.
[11] M. Felegyhazi, C. Keibich, and V. Paxson. On the poten-
15
[30] D. Wessels, M. Fomenkov, N. Brownlee, and K. Claffy.
Measurements and Laboratory Simulations of the Upper
DNS Hierarchy. In PAM, 2004.
[31] Zeus Tracker.
Zeus IP & domain name block list.
https://zeustracker.abuse.ch, 2009.
tial of proactive domain blacklisting. In Third USENIX
LEET Workshop, 2010.
[12] P. Fogla, M. Sharif, R. Perdisci, O. Kolesnikov, and
W. Lee. Polymorphic blending attacks. In In Proceedings
of the 15 th USENIX Security Symposium, pages 241–256,
2006.
[13] S. Hao, N. Feamster, and R. Pandrangi.
An In-
ternet Wide View into DNS Lookup Patterns.
http://labs.verisigninc.com/projects/
malicious-domain-names.html, 2010.
[14] T. Hastie, R. Tibshirani, and J. Friedman.
The Ele-
ments of Statistical Learning. Springer Series in Statis-
tics. Springer New York Inc., New York, NY, USA, 2001.
[15] J. Jung, E. Sit, H. Balakrishnan, and R. Morris. DNS
performance and the effectiveness of caching. IEEE/ACM
Trans. Netw., 10:589–603, October 2002.
[16] MalwareDomains. DNS-BH malware domain blocklist.
http://www.malwaredomains.com, 2007.
[17] P. Mockapetris. Domain Names - Concepts and Fa-
cilities. http://www.ietf.org/rfc/rfc1034.
txt, 1987.
[18] P. Mockapetris.
Domain Names - Implementation
and Speciﬁcation. http://www.ietf.org/rfc/
rfc1035.txt, 1987.
[19] OPENDNS. OpenDNS — Internet Navigation And Se-
curity. http://www.opendns.com/, 2010.
[20] P. Porras. Inside risks: Reﬂections on conﬁcker. Com-
mun. ACM, 52:23–24, October 2009.
[21] R. Perdisci, I. Corona, D. Dagon, and W. Lee. Detecting
malicious ﬂux service networks through passive analysis
of recursive DNS traces. In Proceedings of ACSAC, Hon-
olulu, Hawaii, USA, 2009.
[22] SBL. The Spamhaus Project Block List. http://www.
spamhaus.org/sbl/, 2004.
[23] S. Shevchenko. Domain Name Generator for Murofet.
http://blog.threatexpert.com/2010/10/
domain-name-generator-for-murofet.
html, 2010.
[24] SIE@ISC. Internet Systems Consortium: Security Infor-
mation Exchange. https://sie.isc.org/, 2004.
[25] S. Staniford, V. Paxson, and N. Weaver. How to own the
In Proceedings of the 11th
internet in your spare time.
USENIX Security Symposium, pages 149–167, Berkeley,
CA, USA, 2002. USENIX Association.
[26] J. Stewart.
Bobax trojan analysis.
http:
//www.secureworks.com/research/
threats/bobax/, 2004.
[27] B. Stone-Gross, M. Cova, L. Cavallaro, B. Gilbert,
M. Szydlowski, R. Kemmerer, C. Kruegel, and G. Vigna.
Your botnet is my botnet: analysis of a botnet takeover.
In Proceedings of the 16th ACM conference on Computer
and communications security, CCS ’09, pages 635–647,
New York, NY, USA, 2009. ACM.
[28] Team Cymru.
IP to ASN mapping.
//www.team-cymru.org/Services/
ip-to-asn.html, 2008.
http:
[29] N. Weaver, S. Staniford, and V. Paxson. Very fast contain-
ment of scanning worms. In In Proceedings of the 13th
USENIX Security Symposium, pages 29–44, 2004.
16