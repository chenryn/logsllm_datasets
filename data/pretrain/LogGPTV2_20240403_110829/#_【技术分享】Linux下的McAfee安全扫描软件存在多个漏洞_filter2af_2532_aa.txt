# 【技术分享】Linux下的McAfee安全扫描软件存在多个漏洞
|
##### 译文声明
本文是翻译文章，文章来源：nation.state.actor
原文地址：
译文仅供参考，具体内容表达以及含义原文为准。
翻译：[ResoLutiOn ](http://bobao.360.cn/member/contribute?uid=2606886003)
预估稿费：260RMB（不服你也来投稿啊！）
投稿方式：发送邮件至linwei#360.cn，或登陆网页版在线投稿
**事件综述**
近期，有网络安全人员发现：Linux系统下的安全扫描软件McAfee中存在多个安全漏洞【软件传送门：[（McAfee for
Linux）](http://www.mcafee.com/us/products/virusscan-enterprise-for-linux.aspx)】，黑客可利用其中一些漏洞盗用Linux系统的root权限，发动RCE攻击。
**  
**
**关于McAfee** **软件的情况介绍**
McAfee VirusScan Enterprise for
Linux,一款利用Linux独特访问扫描程序，对系统进行实时防护的安全检测软件，由Intel旗下的子公司McAfee推出。该软件适用于使用Linux系统的企业用户。它能够检测隐藏在存档文件中的Linux病毒并予以阻止；阻止Microsoft
Windows恶意软件，防止其通过Linux环境传播；同时还能借助来自McAfee
Labs的自动安全更新，确保始终提供最新的Linux病毒防护。由此可见，McAfee VirusScan Enterprise for
Linux的功能可谓十分强大。
起初，在很多安全专家看来，这款安全防护软件似乎是“尽善尽美”，它近乎拥有了漏洞研究人员所期待的所有优点，例如：它能够利用系统root权限，这便能够保证用户PC的安全；但在最近一段时间里，McAfee似乎有点淡出人们视野的味道，原因在于在很长一段时间里，McAfee公司已没有对其进行更新了。当发现这些情况时，我决定要细致地了解有关该软件的具体情况。
**  
**
**受到漏洞影响的McAfee** **版本**
安全研究人员证实：从McAfee
1.9.2版本（于2015年2月19日发布）到2.0.2版本（于2016年4月22日发布），都存在多个相同的安全漏洞。它们之间唯一的差别便是：在漏洞利用方面，新版本要比旧版本更容易实施，也即是说：近期的McAfee软件的安全性下降了很多，更容易遭到黑客利用。
**  
**
**漏洞报告时间轴**
1.2016年6月23日：安全人员将漏洞的相关情况向McAfee公司的安全应急响应中心（CERT）做了汇报；McAfee公司定于2016年8月23日向公众披露漏洞的具体细节。
2.2016年7月19日：McAfee公司发表声明称： 鉴于关于漏洞的细节仍在不断更新中，他们决定将发布公告的时间延期至9月，最晚可至12月；
3.2016年9月-11月期间：安全人员未与McAfee公司取得联系；
4.2016年12月5日：McAfee公司发布消息称：公司将于12月12日发布关于McAfee软件漏洞的完整报告；
5.2016年12月9日：McAfee公司发表安全公告，定义了漏洞的数字ID；
6.2016年12月12日：完整的McAfee漏洞报告披露。
**  
**
**McAfee** **软件系统结构**
在深入探究McAfee软件漏洞的具体情况之前，我认为有必要先了解有关的软件结构，磨刀不误砍柴工，这将会对之后的漏洞研究有着一定的帮助。
**（1** **）软件所提供的服务：**
McAfee VirusScan Enterprise for
Linux可向用户提供两种单独的服务：一是用户能够以系统root权限运行该软件；二是还可以一种名为“nails”的非特权用户的身份运行该软件。具体说来，用户可用root权限使用该软件的主要扫描功能，它能够侦听一个本地的Unix网络套接字包（/var/opt/NAI/LinuxShield/dev/nails_monitor）。而网络服务器则可以用nails用户身份来运行，它能够侦听端口0.0.0:55443发出的数据包。
**（2）实现进程间的通信**
在该软件的架构中，网络服务器是设置在扫描服务上的一个用户交互界面。当用户向网络服务器提交了一个请求时，该请求会被重新格式化，以另一种形式发送给root扫描程序；系统将会在一个HTML界面中显示该用户提交的请求及其相关信息。由于在交互过程中，web服务器不会对用户传递的数据做出太多的限制，这便给黑客利用该漏洞，向系统注入恶意代码提供了可趁之机。
**10个具体的McAfee漏洞：** **** ****
接下来，我将为大家具体介绍10个McAfee VirusScan Enterprise for Linux软件中存在的漏洞。
**No.1 CVE-2016-8016:未经验证的远程文件存在性校验漏洞**
当我们在浏览网页的编译代码时，即会发现该html文件的存放路径是由tpIt参数来决定。在上图中，该tpIt参数是放置在tasks.html文件中。而运行在web服务器上的Linux
Strace工具会显示：可打开/opt/NAI/LinuxShield/apache/htdocs/0409/tasks.html文件，如下所示：
在编译时，如果将tpIt参数放置在地址为..%2F..%2F..%2F..%2F..%2F..%2Fetc%2Fpasswd（该字符串经过URL加密处理）的不同的页面中，那么编译过程就会出错，系统会返回一个格式错误的页面，并附有错误返回值14。而JavaScript语言中的lookupErrorCode功能函数会根据错误返回值14，向用户发送“web模块使用错误”的提示语句。若将tpIt参数放置在一个不存在的系统路径中，那么错误返回值将变为10，错误提示语句为“系统无法打开该文件”。如下图所示：
若系统中有类似的，已被命名的文件存在，那么系统会向未经授权的用户提示这两种错误编译消息。
那么问题来了，有效的网页编译文件（例如：tasks.html）和无效网页编译文件（例如：
_..%2F..%2F..%2F..%2F..%2F..%2Fetc%2Fpasswd_ ）之间的区别是什么呢？