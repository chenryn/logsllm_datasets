Routing in The Dark
Scalable Searches in Dark P2P Networks
Ian Clarke and Oskar Sandberg
The Freenet Project
Ian Clarke & Oskar Sandberg - 2005 – p.1/33
Introduction
• We have long been interested in decentralised
“Peer to Peer” networks. Especially Freenet.
Ian Clarke & Oskar Sandberg - 2005 – p.2/33
Introduction
• We have long been interested in decentralised
“Peer to Peer” networks. Especially Freenet.
• But when individual users come under attack,
decentralisation is not enough.
Ian Clarke & Oskar Sandberg - 2005 – p.2/33
Introduction
• We have long been interested in decentralised
“Peer to Peer” networks. Especially Freenet.
• But when individual users come under attack,
decentralisation is not enough.
• Future networks may need to limit connections to
trusted friends.
Ian Clarke & Oskar Sandberg - 2005 – p.2/33
Introduction
• We have long been interested in decentralised
“Peer to Peer” networks. Especially Freenet.
• But when individual users come under attack,
decentralisation is not enough.
• Future networks may need to limit connections to
trusted friends.
• The big question is: Can such networks be
useful?
Ian Clarke & Oskar Sandberg - 2005 – p.2/33
Overview of “Peer to Peer” net-
works
• Information is spread across many inter-
connected computers
Ian Clarke & Oskar Sandberg - 2005 – p.3/33
Overview of “Peer to Peer” net-
works
• Information is spread across many inter-
connected computers
• Users want to ﬁnd information
Ian Clarke & Oskar Sandberg - 2005 – p.3/33
Overview of “Peer to Peer” net-
works
• Information is spread across many inter-
connected computers
• Users want to ﬁnd information
• Some are centralised (eg. Napster), some are
semi- centralised (eg. Kazaa), others are
distributed (eg. Freenet)
Ian Clarke & Oskar Sandberg - 2005 – p.3/33
The Small World Phenomenon
• In "Small world" networks short paths exist
between any two peers
Ian Clarke & Oskar Sandberg - 2005 – p.4/33
The Small World Phenomenon
• In "Small world" networks short paths exist
between any two peers
• People tend to form this type of network (as
shown by Milgram experiment)
Ian Clarke & Oskar Sandberg - 2005 – p.4/33
The Small World Phenomenon
• In "Small world" networks short paths exist
between any two peers
• People tend to form this type of network (as
shown by Milgram experiment)
• Short paths may exist but they may not be easy to
ﬁnd
Ian Clarke & Oskar Sandberg - 2005 – p.4/33
Navigable
Small
World
Net-
works
• Concept of similarity or “closeness” between
peers
Ian Clarke & Oskar Sandberg - 2005 – p.5/33
Navigable
Small
World
Net-
works
• Concept of similarity or “closeness” between
peers
• Similar peers are more likely to be connected
than dissimilar peers
Ian Clarke & Oskar Sandberg - 2005 – p.5/33
Navigable
Small
World
Net-
works
• Concept of similarity or “closeness” between
peers
• Similar peers are more likely to be connected
than dissimilar peers
• You can get from any one peer to any other
simply by routing to the closest peer at each step
Ian Clarke & Oskar Sandberg - 2005 – p.5/33
Navigable
Small
World
Net-
works
• Concept of similarity or “closeness” between
peers
• Similar peers are more likely to be connected
than dissimilar peers
• You can get from any one peer to any other
simply by routing to the closest peer at each step
• This is called “Greedy Routing”
Ian Clarke & Oskar Sandberg - 2005 – p.5/33
Navigable
Small
World
Net-
works
• Concept of similarity or “closeness” between
peers
• Similar peers are more likely to be connected
than dissimilar peers
• You can get from any one peer to any other
simply by routing to the closest peer at each step
• This is called “Greedy Routing”
• Freenet and “Distributed Hash Tables” rely on
this principal to ﬁnd data in a scalable
decentralised manner
Ian Clarke & Oskar Sandberg - 2005 – p.5/33
Light P2P Networks
• Examples: Gnutella, Freenet, Distributed Hash
Tables
Ian Clarke & Oskar Sandberg - 2005 – p.6/33
Light P2P Networks
• Examples: Gnutella, Freenet, Distributed Hash
Tables
• Advantage: Globally scalable with the right
routing algorithm
Ian Clarke & Oskar Sandberg - 2005 – p.6/33
Light P2P Networks
• Examples: Gnutella, Freenet, Distributed Hash
Tables
• Advantage: Globally scalable with the right
routing algorithm
• Disadvantage: Vulnerable to “harvesting”, ie.
people you don’t know can easily discover
whether you are part of the network
Ian Clarke & Oskar Sandberg - 2005 – p.6/33
Dark or “Friend to Friend” P2P
Networks
• Peers only communicate directly with “trusted”
peers
Ian Clarke & Oskar Sandberg - 2005 – p.7/33
Dark or “Friend to Friend” P2P
Networks
• Peers only communicate directly with “trusted”
peers
• Examples: Waste
Ian Clarke & Oskar Sandberg - 2005 – p.7/33
Dark or “Friend to Friend” P2P
Networks
• Peers only communicate directly with “trusted”
peers
• Examples: Waste
• Advantage: Only your trusted friends know you
are part of the network
Ian Clarke & Oskar Sandberg - 2005 – p.7/33
Application
How can we apply small world theory to routing in a
Dark peer to peer network?
Ian Clarke & Oskar Sandberg - 2005 – p.8/33
Application
How can we apply small world theory to routing in a
Dark peer to peer network?
• A Darknet is, essentially, a social network of
peoples trusted relationships.
Ian Clarke & Oskar Sandberg - 2005 – p.8/33
Application
How can we apply small world theory to routing in a
Dark peer to peer network?
• A Darknet is, essentially, a social network of
peoples trusted relationships.
• If people can route in a social network, then it
should be possible for computers.
Ian Clarke & Oskar Sandberg - 2005 – p.8/33
Application
How can we apply small world theory to routing in a
Dark peer to peer network?
• A Darknet is, essentially, a social network of
peoples trusted relationships.
• If people can route in a social network, then it
should be possible for computers.
• Jon Kleinberg explained in 2000 how small world
networks can be navigable.
Ian Clarke & Oskar Sandberg - 2005 – p.8/33
Kleinberg’s Result
• The possibility of routing efﬁciently depends on
the proportion of connections that have different
lengths with respect to the “position” of the
nodes.
Ian Clarke & Oskar Sandberg - 2005 – p.9/33
Kleinberg’s Result
• The possibility of routing efﬁciently depends on
the proportion of connections that have different
lengths with respect to the “position” of the
nodes.
• If the positions are in a ring,
the proportion of connections
with a certain length should be
inverse to the length:
Ian Clarke & Oskar Sandberg - 2005 – p.9/33
Kleinberg’s Result
• The possibility of routing efﬁciently depends on
the proportion of connections that have different
lengths with respect to the “position” of the
nodes.
• If the positions are in a ring,
the proportion of connections
with a certain length should be
inverse to the length:
• In this case a simple greedy routing algorithm
performs in O(log2 n) steps.
Ian Clarke & Oskar Sandberg - 2005 – p.9/33
Kleinbergs Result, cont.
Ian Clarke & Oskar Sandberg - 2005 – p.10/33
Kleinbergs Result, cont.
Ian Clarke & Oskar Sandberg - 2005 – p.10/33
Kleinbergs Result, cont.
But in a social network, how do we see if one person
is closer to the destination than another?
Ian Clarke & Oskar Sandberg - 2005 – p.10/33
Application, cont.
Is Alice closer to Harry than Bob?
Ian Clarke & Oskar Sandberg - 2005 – p.11/33
Application, cont.
Is Alice closer to Harry than Bob?
• In real life, people presumably use a large number
of factors to decide this. Where do they live?
What are their jobs? What are their interests?
Ian Clarke & Oskar Sandberg - 2005 – p.11/33
Application, cont.
Is Alice closer to Harry than Bob?
• In real life, people presumably use a large number
of factors to decide this. Where do they live?
What are their jobs? What are their interests?
• One cannot, in practice, expect a computer to
route based on such things.
Ian Clarke & Oskar Sandberg - 2005 – p.11/33
Application, cont.
Is Alice closer to Harry than Bob?
• In real life, people presumably use a large number
of factors to decide this. Where do they live?
What are their jobs? What are their interests?
• One cannot, in practice, expect a computer to
route based on such things.
• Instead, we let the network tell us!
Ian Clarke & Oskar Sandberg - 2005 – p.11/33
Application, cont.
• Kleinberg’s model suggests: there should be few
long connections, and many short ones.
Ian Clarke & Oskar Sandberg - 2005 – p.12/33
Application, cont.
• Kleinberg’s model suggests: there should be few
long connections, and many short ones.
• We can assign numerical identities placing nodes
in a circle, and do it in such a way that this is
fulﬁlled.
Ian Clarke & Oskar Sandberg - 2005 – p.12/33
Application, cont.
• Kleinberg’s model suggests: there should be few
long connections, and many short ones.
• We can assign numerical identities placing nodes
in a circle, and do it in such a way that this is
fulﬁlled.
• Then greedy route with respect to these
numerical identities.
Ian Clarke & Oskar Sandberg - 2005 – p.12/33
The Method
• When nodes join the network, they choose a
position on the circle randomly.
Ian Clarke & Oskar Sandberg - 2005 – p.13/33
The Method
• When nodes join the network, they choose a
position on the circle randomly.
• They then switch positions with other nodes, so
as to minimize the product of the edge distances.
Ian Clarke & Oskar Sandberg - 2005 – p.13/33
The Method, cont.
An advantageous switch of position:
Ian Clarke & Oskar Sandberg - 2005 – p.14/33
The Method, cont.
An advantageous switch of position:
Ian Clarke & Oskar Sandberg - 2005 – p.14/33
The Method, cont.
Some notes:
Ian Clarke & Oskar Sandberg - 2005 – p.15/33
The Method, cont.
Some notes:
• Switching is essential!
Ian Clarke & Oskar Sandberg - 2005 – p.15/33
The Method, cont.
Some notes:
• Switching is essential!
• Because this is an ongoing process as the network
grows (and shrinks) it will be difﬁcult to keep
permanent positions.
Ian Clarke & Oskar Sandberg - 2005 – p.15/33
The Algorithm
• Two nodes are chosen in some random fashion,
and attempt to switch.
Ian Clarke & Oskar Sandberg - 2005 – p.16/33
The Algorithm
• Two nodes are chosen in some random fashion,
and attempt to switch.
• They calculate ℓb as the product of all the lengths
of their current connections. Then they calculate
ℓa as the product of what all their respective
connection lengths would be after they switched.
Ian Clarke & Oskar Sandberg - 2005 – p.16/33
The Algorithm
• Two nodes are chosen in some random fashion,
and attempt to switch.
• They calculate ℓb as the product of all the lengths
of their current connections. Then they calculate
ℓa as the product of what all their respective
connection lengths would be after they switched.
• If ℓb > ℓa they switch. Otherwise they switch
with probability ℓb/ℓa.
Ian Clarke & Oskar Sandberg - 2005 – p.16/33
The Algorithm, cont.
Let d(z) give the degree (number of connections) of a
node z, and let ei(z) and e′
i(z) be distance of z’s i- th
connection before and after a switch occurs. Let nodes
x and y be the ones attempting to switch. Calculate:
p = ℓ(a)
ℓ(b) =
d(x)
i=1 ei(x) d(y)
i=1 ei(y)
d(x)
i=1 e′
i(x) d(y)
i=1 e′
i(y)
x and y will complete the switch with probability
min(1, p). Otherwise we leave the network as it is.
Ian Clarke & Oskar Sandberg - 2005 – p.17/33
The Algorithm, cont.
• This is an application of the Metropolis- Hastings
algorithm.
Ian Clarke & Oskar Sandberg - 2005 – p.18/33
The Algorithm, cont.
• This is an application of the Metropolis- Hastings
algorithm.
• Because there is a greater chance of moving to
positions with shorter connection distances, it
will tend to minimize the product of the distances.
Ian Clarke & Oskar Sandberg - 2005 – p.18/33
The Algorithm, cont.
• This is an application of the Metropolis- Hastings
algorithm.
• Because there is a greater chance of moving to
positions with shorter connection distances, it
will tend to minimize the product of the distances.
• Because the probability of making a switch is
never zero, it cannot get stuck in a bad
conﬁguration (a local minima).
Ian Clarke & Oskar Sandberg - 2005 – p.18/33
The Algorithm, cont.
• How do nodes choose each other to attempt to
switch?
Ian Clarke & Oskar Sandberg - 2005 – p.19/33
The Algorithm, cont.
• How do nodes choose each other to attempt to
switch?
• Any method will work in theory, but some will
work better than others. Only switching with
neighbors does not seem to work in practice.
Ian Clarke & Oskar Sandberg - 2005 – p.19/33
The Algorithm, cont.
• How do nodes choose each other to attempt to
switch?
• Any method will work in theory, but some will
work better than others. Only switching with
neighbors does not seem to work in practice.
• Our current method is to do a short random walk
starting at one of the nodes and terminating at the
other.
Ian Clarke & Oskar Sandberg - 2005 – p.19/33
Simulations