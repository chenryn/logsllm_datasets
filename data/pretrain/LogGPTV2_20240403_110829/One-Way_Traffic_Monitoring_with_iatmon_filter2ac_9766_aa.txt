title:One-Way Traffic Monitoring with iatmon
author:Nevil Brownlee
One-Way Traﬃc Monitoring with iatmon
Nevil Brownlee
CAIDA, UC San Diego, and
The University of Auckland, New Zealand
PI:EMAIL
Abstract. During the last decade, unsolicited one-way Internet traﬃc
has been used to study malicious activity on the Internet. Researchers
usually observe such traﬃc using network telescopes deployed on dark-
space (unused address space). When darkspace observations began ten
years ago, one-way traﬃc was minimal. Over the last ﬁve years, however,
traﬃc levels have risen so that they are now high enough to require more
subtle diﬀerentiation – raw packet and byte or even port counts make it
hard to discern and distinguish new activities.
To make changes in composition of one-way traﬃc aggregates more
detectable, we have developed iatmon (Inter-Arrival Time Monitor), a
freely available measurement and analysis tool that allows one to sep-
arate one-way traﬃc into clearly-deﬁned subsets. Initially we have im-
plemented two subsetting schemes; source types, based on the schema
proposed in [12]; and inter-arrival-time (IAT) groups that summarise
source behaviour over time.
We use 14 types and 10 groups, giving us a matrix of 140 type + group
subsets. Each subset constitutes only a fraction of the total traﬃc, so
changes within the subsets are easily observable when changes in total
traﬃc levels might not even be noticeable.
We report on our experience with this tool to observe changes in one-
way traﬃc at the UCSD network telescope over the ﬁrst half of 2011.
Daily average plots of source numbers and their traﬃc volumes show
clear long-term changes in several of our types and groups.
1
Introduction
Since about 2002, observations of unsolicited one-way Internet traﬃc have yielded
visibility into a wide range of security-related events, including misconﬁgurations
(e.g., mistyping an IP address), scanning of address space by hackers looking
for vulnerable targets, backscatter from denial-of-service attacks using random
spoofed source addresses, and the automated spread of malware such as worms
or viruses. Researchers have generally observed such traﬃc using network tele-
scopes, deployed on darkspace (unused address space). When unsolicited traﬃc
observations began, one-way traﬃc was minimal. Because of increased botnet-
related activities over the last ﬁve years, e.g., [11], one-way traﬃc at the UCSD
network telescope has risen – for example Aben [1] observed the increase in
sources scanning TCP port 445 from almost none to 220,000 per hour over the
N. Taft and F. Ricciato (Eds.): PAM 2012, LNCS 7192, pp. 179–188, 2012.
c(cid:2) Springer-Verlag Berlin Heidelberg 2012
180
N. Brownlee
three months beginning on 21 November 2008. Now we see 6 GB/h of one-way
traﬃc, i.e. high enough to require more subtle diﬀerentiation – raw packet and
byte or even port counts make it hard to discern and distinguish new activities.
Seeking a better understanding of current and emerging one-way traﬃc behav-
ior, we introduce and implement a methodology in a freely available
measurement and analysis tool (iatmon) that provides an eﬀective platform for
separating one-way traﬃc into well-deﬁned subsets, so that changes in a sub-
set can be more easily recognised.1 We implemented two subsetting schemes in
iatmon, source types and IAT groups, described in section 3.3. This taxonomy
facilitates analysis of not only the increasing unsolicited IPv4 traﬃc, but also
pollution to IPv6 addresses, and comparison between the two. Tools such as
iatmon can also enable consistent distributed monitoring of unused addresses
across many diﬀerent sites, eﬀectively producing a wide-area view of unsolicited
one-way traﬃc. The tool’s utility is not limited to empty address space; one could
equally deploy iatmon on partially populated address space, ignoring traﬃc to
assigned hosts, or use it to monitor unsolicited traﬃc to all IP addresses on a
stub network, since iatmon ignores bidirectional traﬃc.
We ﬁrst review related work in darkspace traﬃc analysis, and then summarise
research challenges and opportunities speciﬁc to darkspace measurement. In Sec-
tion 3 we describe the data and our analysis methods. Section 4 presents results
of our analyses. Section 5 summarises our contributions and future plans for
one-way traﬃc analysis.
2 Related Work
Data from the UCSD network telescope has supported signiﬁcant research on
DOS attacks [9], Internet worms and their victims, e.g., Code-Red, Slammer,
Witty, and the Nyxem email virus. Data sets curated from telescope observations
of these events became a foundation for modeling the top speed of ﬂash worms,
the worst-case scenario economic damages from such a worm, the pathways of
their spread, and potential means of defense.
In 2004, Pang et al.[10] analysed one-way traﬃc destined for ﬁve diﬀerent
empty preﬁxes (a /8, two /19’s, two sets of 10 contiguous /24 subnets) an-
nounced from two sites. They found that, relative to legitimate traﬃc, traﬃc
to darkspace “is complex in structure, highly automated, frequently malicious,
potentially adversarial, and mutates at a rapid pace.” TCP packets dominated
in all of their traﬃc samples, 99% of which were TCP/SYNs indicating either
scanning or backscatter.2 Also in 2004, Cooke et al. found diversity in incom-
ing traﬃc to ten unused address blocks [6] ranging in size from a /25 to a
/8, announced from service provider networks, a large enterprise, and academic
networks. They passively recorded incoming packets and actively responded to
TCP SYN requests to obtain more data from the sources. They found traﬃc
diversity along three dimensions: across protocols and applications; for a speciﬁc
1 The iatmon tool is available at http://www.caida/tools/measurement/iatmon/.
2 At UCSD from Jan–Jun 2012 only about 30% of the packets were TCP.
Monitoring with iatmon
181
protocol/application using TCP port 135, and for a particular worm signature
(Blaster).
In 2006 Barford et al. analysed the source address distribution of malicious
‘Internet background’ traﬃc. They evaluated traces from network telescopes
running active responders on portions of two /16s and one /8 network, in addition
to a large set of intrusion detection system logs provided by Dshield.org [2]. They
found a bursty distribution of source addresses, many from a small set of tightly
concentrated network locations, which varied across segments of darkspace but
were consistent over time for each separate segment.
More recently, in 2010 Wustro et al. [14] analysed background traﬃc using
one-week traces from four /8 darkspaces. Traces of one-way traﬃc destined to
35/8 from 2006 to 2010 showed an eight-fold rise in traﬃc rate over the ﬁve
years, with daily variations during a week. The 2010 data rate (about 20 Mb/s)
was similar to that at the UCSD network telescope. One-week traces from three
of the four darkspaces suggest that the overall daily variations in traﬃc volume
were similar across all sites. Their TTL distributions were also similar, suggesting
that all the sites see similar spatial traﬃc distributions.
In 2011, Treurniet [12] proposed a traﬃc activity classiﬁcation schema to
monitors state changes in TCP, UDP and ICMP ﬂows in order to help detect
low-rate network scanning activities. She used state changes per sending host
to classify that host as normal, DoS, backscatter, scanning, etc. She tested the
approach on bidirectional trace data from outside the border of a /14 network
with some responding servers in it, although fewer than 1% of observed ﬂows
were bidirectional communications with these servers. The rest of the observed
traﬃc was malicious, mostly slow scans of various types.
3 Methodology
The UCSD network telescope [5,4] uses a /8 network preﬁx, most of which is
dark. An upstream router ﬁlters out the legitimate traﬃc to the reachable IP
addresses in this space, so we monitor only traﬃc destined to empty address
space. Management of the UCSD network telescope requires continual navigation
of the pervasive challenges in network traﬃc research methodology: collection
and storage, eﬃcient curation, and sharing large volumes of data. The large
volume of data captured by the telescope incurs considerable expenses for data
storage and limits the number of researchers who can realistically download
data sets. The situation is worse during malicious activity outbreaks when the
data volumes increase sharply, yet rapid analysis and response are necessary.
The UCSD network telescope remains a purely passive observer of unsolicited
traﬃc. We do not rule out active response by the telescope in the future, but
active responding requires resources and careful navigation of legal and ethical
issues. We have found that much can be gleaned with non-intrusive methods and
external knowledge of malware behavior. For example, we indirectly observed the
rise of Conﬁcker A and B because Conﬁcker induced a conspicuous increase in
the number of probe packets aimed at TCP port 445, using poorly randomized
destination addresses [1].
182
N. Brownlee
Description Type
TCP
UDP
Other
TCP probe
TCP vertical scan
TCP horizontal scan
TCP other
UDP probe
UDP vertical scan
UDP horizontal scan
UDP other
ICMP only
Backscatter
TCP and UDP
µTorrent
Conﬁcker C
Untyped
IAT distribution Group
Long-lived
3 s mode
Other
Stealth &3 s mode
Stealth & Spikes
Stealth other
Left-skew
Even
Right-skew
Short-lived
High-rate
DoS
Ungrouped
(b) IAT Groups
(a) Source Types
Fig. 1. Subsetting Schemes for One-way Traﬃc Sources
3.1 Data Set
The UCSD network telescope collects full-packet traces continuously. These
traces are stored online for at least sixty days, allowing vetted researchers to
analyse the data in various ways. (See CAIDA web page for access to data
[3].) One of the goals of this research is to enable retention of eﬃcient but rich
summary statistics of historical raw data that is itself too expensive to archive
indeﬁnitely. 3
We analysed each hourly trace from the UCSD network telescope for every
hour from 3 Jan through 30 Jun 2011. During that time, 23% of the sources were
TCP, contributing 30% of the packets and 69% of the volume (MB/h).
Note that since most traﬃc into darkspace represents failed attempts to ini-
tiate connections, about 99.9% of the TCP packets carry no payload. However,
the number of UDP packets carrying payload has increased in recent years. As
of January 2011, about 67% of the sources sent only UDP packets, accounting
for about 55% of each hour’s packets. In recent years the amount of UDP traﬃc
has increased; in January 2011 the TCP traﬃc per average hour contributed
only 66% of the bytes, 44% of the packets and 32% of the one-way sources – by
June 2011, the hourly averages for TCP had changed to 70% of the bytes, but
only 23% of the packets and 18% of the one-way sources.
3.2 Analysis Strategy
In 2002, when CAIDA began analyzing telescope data, one-way traﬃc volumes
were low, so that rapid increases caused by viruses and fast-spreading worms
were easy to discern. As of June 2011, we see 6 to 9 GB/h of one-way traﬃc,
so that the early stages of a new rapidly spreading attack are much harder to
3 Current storage pricing for researchers at SDSC are $390/TB-year, which at
6GB/hour results in over $20,000/year of storage costs, which multiply for each
year of data to be stored, and increase as unsolicited traﬃc rates grow.
Monitoring with iatmon
183
observe in the continuous swamp of background traﬃc. For example, we observe
that each hour 76% of the sources send UDP packets, but these packets account
for only 23% of the hourly byte volumes, so that the UDP sources are swamped
(in terms of byte volumes) by TCP sources. One goal of our iatmon methods
and tool is to separate the one-way traﬃc into various subsets so that changes
within subsets are easier to detect.
3.3 iatmon Implementation
First, we consider the one-way traﬃc in terms of its sources. Speciﬁcally, we
construct a source table, with entries that summarise the set of packets arriv-
ing from a source IP address. At the end of each hour’s trace iatmon scans the
source table, calling various classifying functions to separate the sources into
clearly-deﬁned subsets. We describe our initial implementation of these subset-
ting schemes below. iatmon has a Ruby outer block, which sets up iatmon’s
conﬁguration and writes its hourly summary ﬁle. However, most of the pro-
cessing occurs in a C extension module that reads trace packets, maintains the
source hash table, classiﬁes sources using the various subsetting schemes, and
passes results back to the outer block. For normal hours, iatmon running on an
8-core machine with 32 GiB of memory takes 7 to 15 minutes of elapsed time to
process each hour’s trace ﬁle, easily fast enough to keep up with new data from
the telescope.
iatmon handles its own storage allocation, requesting memory in 4 GB chunks
as needed. Two such chunks are suﬃcient for most hour-long intervals of trace
data, but for nine of the hours iatmon was unable to get enough memory to
process the entire hour – even when using 28 GiB of real memory. We examined
the ﬁrst few thousand packets of each of those nine hours, and found that most
of their sources sent just two TCP packets, from apparently random source
addresses. To allow iatmon to handle traces when such DoS attack conditions
occur, we discarded sources that only sent two packets and were then idle for at
least 120 s. One of these nine traces had 122.5 million source addresses that we
discarded (97% of the hour’s sources), but most packets in the ﬂood traces had
the same TTL, suggesting a high-rate DoS attack using spoofed source addresses.
Source Types. One obvious approach to classifying one-way sources is to ex-
amine their use of IP addresses and ports. For example, a probe source sends all
its packets to a single port on a single host. A vertical scan source sends packets
to various ports on a single host. A horizontal scan source sends packets to the
same port on many hosts. We used this approach in early development work on
iatmon. Our current source types scheme is now based on Treurinet’s [12] recent
classiﬁcation scheme, using the source types listed in Table 1(a).
In 2008 we saw the rise of the Conﬁcker worm/botnet. Conﬁcker C may send
both TCP and UDP packets as part of its p2p network establishment; SRI’s
algorithm [11] allows us to estimate which incoming packets are likely Conﬁcker
C p2p packets. We were curious as to whether BitTorrent has contributed to
184
N. Brownlee
the rise in UDP one-way traﬃc observed in the last two years. The BitTorrent
protocols are well-documented [8,13], allowing us to identify µTorrent sources
from UDP packet payloads. Table 1(a) includes the two source types we added
to represent these application-speciﬁc sources.
%
 45
 40
 35
 30
 25
 20
 15
 10
 5
 0
%
 35
 30
 25
 20
 15
 10
 5
 0
%
 25
 20
 15
 10
 5
 0
SAN, 1600 Tue  8 Mar 2011 (UTC):  20110308.1500  source 179
 0.3
 1
 3
 10
 30
 100
 300
packet inter-arrival time (s)
(a) Stealth & 3 s mode
SAN, 1600 Tue  8 Mar 2011 (UTC):  20110308.1500  source 438
 0.3
 1
 3
 10
 30
 100
 300
packet inter-arrival time (s)
(d) Stealth & spikes
SAN, 1600 Tue  8 Mar 2011 (UTC):  20110308.1500  source 242
 0.3
 1
 3
 10
 30
 100
 300
packet inter-arrival time (s)
%
 16
 14
 12
 10
 8
 6
 4
 2
 0
%
 25
 20
 15
 10
 5
 0
%
 35
 30
 25
 20
 15
 10
 5
 0
SAN, 1600 Tue  8 Mar 2011 (UTC):  20110308.1500  source 21
 0.3
 1
 3
 10
 30
 100
 300
packet inter-arrival time (s)
(b) 3 s mode left
SAN, 1600 Tue  8 Mar 2011 (UTC):  20110308.1500  source 3
 0.3
 1
 3
 10
 30
 100
 300
packet inter-arrival time (s)
(e) 3 s mode even
SAN, 1600 Tue  8 Mar 2011 (UTC):  20110308.1500  source 116
 0.3
 1
 3
 10
 30
 100
 300
packet inter-arrival time (s)
%
 25
 20
 15
 10
 5
 0
%
 90
 80
 70
 60
 50
 40
 30
 20
 10
 0
%
 12
 10
 8
 6
 4
 2
 0
SAN, 1600 Tue  8 Mar 2011 (UTC):  20110308.1500  source 69
 0.3
 1
 3
 10
 30
 100
 300
packet inter-arrival time (s)
(c) Short-lived ( 5 p/s)
SAN, 1600 Tue  8 Mar 2011 (UTC):  20110308.1500  source 67
 0.3
 1
 3
 10
 30
 100
 300
packet inter-arrival time (s)
(g) Stealth other
(h) 3 s mode Right
(i) DoS
Fig. 2. IAT groups: Packet Inter-Arrival Time percentage distributions for a typical
hour, ending at 1600 on 8 Mar 2011. We determine each source’s IAT group using a
set of distribution metrics, such as % IATs  120 s; only
1% of the hour’s sources remain unclassiﬁed.
Source IAT Groups. About 30% of the packets that reached the UCSD tele-
scope in the ﬁrst half of 2011 were TCP SYNs, carrying no payload. In order
to further characterise the source behaviors, especially those from TCP sources,
we investigated the inter-arrival time (IAT) distributions from sources active in
a typical hour. To search for recognisable IAT patterns we plotted many sheets
of ‘postage-stamp size’ IAT distribution plots, with each distribution’s param-
eters shown on its plot. We examined these plots manually to ﬁnd common
patterns, then developed algorithms that captured these recognisable subsets of
the sources, based on statistical properties of their IAT distributions. For exam-
ple, many sources exhibit a strong inter-arrival time mode at 3 s, the standard
Monitoring with iatmon
185
time for TCP retries, aggregated with an underlying wide range of IATs. A
Poisson process that sends TCP SYN packets, and resends each packet after 3 s
intervals will produce this kind of distribution, with skew that depends on the
process’s average time between sending new packets.
Once we identiﬁed a clearly distinguishable IAT pattern, we developed an
algorithm to capture it, and assigned it an IAT group label. After several cycles
of that process, we settled on a scheme with nine diﬀerent groups (listed in
Table 1(b)) that meaningfully distinguished about 99% of the sources in each
hour.
Figure 2 shows example distributions for each group. The centre column shows
three groups that have a packet inter-arrival time mode at 3 s, the standard time
for TCP retries. We also found that some UDP sources had IAT distributions
suggesting an application with a 3 s retry time. These three group names end
in left, even and right to show which side of their distribution’s mode has more
counts. The left-hand column shows stealth sources – those sending fewer than
120 packets, remaining active for more than 30 minutes, and having long (>=
5 minute) quiet intervals. (IAT distributions are an eﬀective way to detect stealth
sources, in spite of their low average packet rates.) The right-hand column shows
IAT distributions for three other groups: at the top, short-lived sources, active
less than 30 minutes and sending less than 120 packets; in the middle, high-rate
sources, sending packets almost back-to-back; and at the bottom, ‘DoS’ sources
sending more than 10% of their of their packets in brief (<= 15 ms) bursts.
4 Observations
4.1 Long-Term (Six-Month Plots)
Figure 3 shows daily average total counts and volumes per hour as stacked bars
for source types and IAT groups observed at the UCSD network telescope from
3 Jan 11 to 30 Jun 11. Over those six months, typically between 0.5 and 2.0
million sources were seen on average during a typical 6-10 GB/hour of one-way
traﬃc. The number of unique source IP addresses (in millions) declined from
1.08 in mid-January to 0.65 at the beginning of February, then rose again to
1.37 by mid-April, after which there was no obvious trend in total source counts
or MB volumes.
For source types (Figure 3(a)), the number of TCP horizontal scan sources in
the daily average hour showed a steady decline while TCP probe, TCP vertical
scan and untyped source numbers remained at steady, much lower values. UDP
probe and unknown source numbers increased gradually from about 1 February.
Apart from the gradual long-term changes, Figure 3(a) also shows short-lived
activity, for example the huge spike in TCP probes on 12 January, the increase
in TCP and UDP during the ﬁrst week of February, and the doubling of UDP
probes in the ﬁrst week of April.
186
N. Brownlee
l
u
J
1
0
n
u
J
1
0
y
a
M
1
0
r
p
A
1
0
r
a
M
1
0
b
e
F
1
0
2
5
.
1
1
5
.
0
n
a
J
1
0
0
r
e
h
t
o
h
t
l
a
e
S
t
i
s
e
k
p
s
&
h
t
l
a
e
S
t
t
f
e
l
e
d
o
m