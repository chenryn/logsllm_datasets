声，这些噪声遍布全图，在空域上井不容易对图片造成玻坏。
要提取出图片中的盲水印，只需把原图和带水印的图在频域中相减，然后根据原来的水印编码方式进
行解码，即可提取出水印。
CTF中—般可以使用BlindWaterMark (https://github.com/chishaxie/BlindWaterMark)工
具对图片进行盲水印的添加和提取。类似技术在音频中也常常出现，对于音频中的频谱隐写，我们可
以简单地使用AdobeAudition等工具直接查看频谱从而拿到flag。
9.1.5隐写术小结
图片隐写的方式还有很多种。广义上，只要通过某种方式将信息隐藏到图片中而难以通过普通方式发
现，就可以称为图片隐写。本节只对一些常见的图片隐写方式进行了简单介绍，读者可以在理解图片
隐写常见的基本原理后，自行尝试通过不同方式对图片进行隐写。
下—
https://weread.qq.com/web/reader/77d32500721a485577d8eeek73532580243735b90b45ac8
---
## Page 436
2021/1/16
从0到1：CTFer成长之路-Nu1L战队-微信读书
9.2压缩包加密
1.暴力破解
暴力破解是最直接、简单的攻击方式，适合密码较为简单或是已知密码的格式或范围时使用，相关工
具有Windows的ARCHPR或者Linux的命令行工具fcrackzip。
2.ZIP伪加密
在ZIP文件中，文件头和每个文件的核心目录区都有通用标记位。核心目录区的通用标记位距离核心
目录区头504B0102的偏移为8字节，其本身占2字节，最低位表示这个文件是否被加密（见图9-2
1），将其改为0x01后，再次打开会提示输入密码（见图9-2-2）。但此时文件的内容并没有真的被
加密，所以被称为伪加密，只要将该标志位重新改回0，即可正常打开。
5S L9 0B 00 0 32 00 60 00 20 00 5 0 C0 0 05
A"N.
ABCE4T
14576
74F309
00
0000120000
0000
002400
图9-2-1
输入密码
输入加密文件的密码。
get_flag.t
输入密码
显示密码
密码管理器
确定
取消
图9-2-2
除了修改通用标志位，用前文提到的Binwalk工具的“binwalk-e”命令也可以无视伪加密，从压缩
包中提取文件。此外，在MacOS中也可以直接打开伪加密的ZIP压缩包。
https:/weread.qq.com/web/reader/77d32500721a485577d8eeeka3f32db0244a3f390d88bb9
---
## Page 437
2021/1/16
从0到1：CTFer成长之路-Nu1L战队-微信读书
类似地，文件头处的通用标记位距离文件头504B0304的偏移为6字节，其本身占2字节，最低位表示
这个文件是否被加密。但该位被改为0x01的伪加密压缩包不能通过Binwalk或MacOS直接提取，而需
要手动修改标志位。
3.已知明文攻击
我们为ZIP压缩文件所设定的密码，先被转换成了3个4字节的key，再用这3个key加密所有文件。如
果我们能通过某种方式拿到压缩包中的一个文件，然后以同样的方式压缩，此时两个压缩包中相同的
那个文件的压缩后大小会相差12字节，用ARCHPR进行对比筛选后，就可以获得key（见图9-2
3），继而根据这个key恢复出未加密的压缩包（见图9-2-4）。对于较短的密码，我们可以等待
ARC
进行恢复，但我们更关注压缩包的内容，所以往往会选择不去爆破密码。这种攻击方式便是已知
明文攻击。由于篇幅所限，这里不再深入讲解这种攻击方式的具体原理，对此感兴趣的读者可以自行
搜索相关资料进行学习。
文件（F）恢复（R）帮助（H)
?
®
国
打开
开始
停止
基准测式
升级
帮助
关于
退出
加密的 ZIP)/RAR/ACE/AR 文件
攻击类型
Mac\Home/Downloads)book(KPA.zip
范国长度定电明文自动保在请项宣织
加密密钥已成功恢复
Advanced Archive Pass
wordRecovery统计信息：
总计口令
n/a
总计时间
11s 926ms
平均速度（口令/）
n/a
这个文件的口令
未到
加密密销
[d087eb63 375335b3 68557e28]
保存
V确定
时：
n/s
可均速：
n/a
明文攻击正在进行，签试找回可打印口令（最长30个字符）
图9-2-3
应新大小
原大小型
CTf.png
 get,flagtd
97.89
Known-plaintext attack
文件历该植0）查量动
图9-2-4
4.小结
压缩包攻击的方式不多，如果使用较强的密码且压缩包内的文件没有泄露，或使用不同的密码或加密
方式对同一个压缩包中不同的文件进行加密，一般很难破解加密压缩包的文件。
https:/weread.q.com/web/reader/77d32500721a485577d8eeeka3f32db0244a3f390d88bb9
---
## Page 438
2021/1/16
从0到1：CTFer成长之路-Nu1L战队-微信读书
9.3取证技术
现实中的电子取证是指利用计算机软件、硬件技术，以符合法律规范的方式对计算机入侵、破坏、欺
诈、攻击等犯罪行为进行证据获取、保存、分析和出示的过程。而CTF中的取证相关题目是通过对包
含相关记录和痕迹的文件进行分析，如流量包、日志文件、磁盘内存镇像等，从中获取出题人放置的
的过程。取证相关题目的特点是信息量较大，逐个分析可能需要非常长的时间，因此掌握高效的
分析方法是非常必要的。
本节将介绍CTF中三种常见的取证场景。即流量分析、内存镜像取证和磁盘镜像取证，读者需要掌握
的前置知识包括计算机网络基础、文件系统基础和操作系统基础。
9.3.1流量分析
9.3.1.1 Wireshark和Tshark
流量包一般是指利用tcpdump等工具，对计算机上的某个网络设备进行流量抓取所获得的PCAP格式
的流量文件。图形化工具Wireshark和它的命令行工具Tshark可以对这种流量包进行分析。
是免费软件（官网为https://www.wireshark.org/）。支持多种协议的分析，也支持流量抓取功
Wiresha
Wireshark的界面见图9-3-1，载入流量包后即可看到网络流量，协议和状态以颜色区分，单击某条流
量即可看到流量的详细信息。在过滤器栏中输入过滤器表达式，即可对流量进行过滤，查看需要的网
络流量。若想过滤FTP协议的网络流量，输入FTP表达式即可查看结果（见图9-3-2）。
Tshark是Wireshark的命令行工具，Wireshark会在内存中建立流量包的元数据，因此Tshark在分析
巨大流量包时作用显著，可以明显提升性能。Tshark的命令行参数非常复杂，具体使用方法可以到
协议的例子见图9-3-3
图9-3-1
图9-3-2
图9-3-3
9.3.1.2流量分析常见操作
https:/weread.qq.com/web/reader/77d32500721a485577d8eeek14b3246024514bfa6bb1534
---
## Page 439
2021/1/16
从0到1：CTFer成长之路-Nu1L战队-微信读书
Wireshark的“统计”菜单可以查看流量包的大致情况，如包含哪些协议、哪些IP地址参与了会话
等。图9-3-4、图9-3-5分别为协议分级统计和会话统计。这两个功能可以帮助我们快速定位到需要分
析的点，因为CTF中的流量分析往往会有很多干扰流量，而出题人出题所需的流量一般是在局域网中
或特定的几台主机中获取的，通过查看流量信息可以大大节省寻找需要分析的流量的时间。
121019930
88.C
1591818
图9-3-4
图9-3-5
在计算机网络中使用最广泛的传输层协议是TCP。TCP是一种面向连接的协议，传输双方可以保证传
输的透明性，只需关心自己拿到的数据。然而，在实际的传输过程中，由于MTU的存在，TCP流量会
被切分为很多小的数据报，导致不方便分析。针对此种情况，Wireshark提供了追踪TCP流功能，只
要选中某条数据报，右键单击“追踪TCP流”，即可获取该TCP会话中双方传输的所有数据，方便进
一步分析，见图9-3-6
ig Rgoe ata (e(Gn fer flaq (7 lyes)
elete,
ERT-
图9-3-6
对于HTTP等常见协议，Wireshark提供了导出对象功能（“文件”菜单中），可以方便地提取传输过
程发送的文件等信息。图9-3-7是导出HTTP对象的功能。
https:/weread.qq.com/web/reader/77d32500721a485577d8eeek14b3246024514bfa6bb1534
---
## Page 440
2021/1/16
从0到1：CTFer成长之路-Nu1L战队-微信读书
43 byte
14 byte
C
N22
fd-4145147
80323729
Help
Sove A
Ciose
图9-3-7
有时需要分析的流量包几乎都是SSL协议的加密流量，如果能够从题目中的其他位置获取SSL密钥日
志，那么可以使用Wireshark尝试解密流量。Wireshark可解析的SSL密钥日志文件如下所示：
当获取到这种形式的密钥日志后，我们可以打开Wireshark的首选项，在“协议”选项中选择SSL协
议，再在”（Pre）-Master-Secret Log Filename”中填入密钥文件的路径（见图9-3-8），确定后
即可解密部分SSL流量。
Secure Sockets Layer
RSA keys list
Edit....
SSL debug file
Browse...
Reassemble SSL records spanning multiple TCP segments
Reassemble SSL Application Data spanning multiple SSL records
Message Authentication Code (MAC), ignore “mac failed*
Pre-Shared-Key
(Pre)-Master-Secret log filename
/Users/acdxvfsvd/Documents/secret.txt
Browse....
图9-38
由于网络协议的复杂性，能隐藏数据的地方远远不止正常的传输流程，因此在对网络流量包进行分析
时，如果从正常方式传输的数据上找不到突破口，那么需要关注一些在流量包中看似异常的协议，仔
细检查各字段，观察有无隐藏数据的印迹。图9-3-9和图9-3-10是某次国外CTF比赛中利用ICMP数据
报的长度来隐藏信息的例子。
1-1-1
三
reques
192.168.11.5
Echo
(pino
sing
reply
ping
reply
82.168.1.3
图9-3-9
https:/weread.qq.com/web/reader/77d32500721a485577d8eeek14b3246024514bfa6bb1534
---
## Page 441
2021/1/16
从0到1：CTFer成长之路-Nu1L战队-微信读书
[LE): 62289 (8xf381
5f787172737475767761..
图9-3-10
9.3.1.3特殊种类的流量包分析