4、包含其他“嵌套”消息的消息。
在安装解析器之前捕获得到数据包如下图所示：
安装Winbox协议解析器后，Wireshark可以正确解析通信数据，如下图所示：
###  获取解析器
为了帮助安全社区分析这类通信数据，也为了监控可能利用Winbox协议的潜在威胁，思科Talos公开了这款解析器，大家可以访问GitHub[页面](https://github.com/Cisco-Talos/Winbox_Protocol_Dissector)下载这款工具。
## 五、总结
结合我们之前发现的VPNFilter功能以及这次的新发现，我们现在可以确认VPNFilter可以为攻击者提供各种功能来利用已攻破的网络以及存储设备，以便进一步渗透及攻击目标网络环境。
攻击者可以利用该框架将攻击范围扩大到敏感系统，如网关或者路由设备上，以执行类似网络映射、端点攻击、网络通信监控以及流量篡改等攻击活动。VPNFilter还提供了另一个危险功能，能够将已感染的设备转化为代理，利用这些代理来混淆未来的攻击源，使将人们误以为攻击流量来自于先前被VPNFilter攻击的网络。该框架非常复杂，进一步说明攻击者可以利用该框架的各种高级功能，也表明我们需要部署更强大的防御架构来应对类似VPNFilter之类的威胁。
进一步了解VPNFilter后，先前我们未解决的大部分问题已经有了答案。然而，时至今日，我们面对该威胁时仍有一些问题尚未澄清：
1、攻击者最开始时如何获取目标设备的访问权限？
虽然我们认为攻击者利用了已知的公开漏洞来攻破受VPNFilter影响的这些设备，但我们仍然没有明确的证据证实这一点。
2、攻击者是否尝试重新获取访问权限？
基于我们的感知数据以及合作伙伴提供的信息，我们发现VPNFilter已经完全处于静默期，因为我们和国际上的合作伙伴（执法部门、情报机构以及网络威胁联盟）已在今年早些时候成功抵御了这个威胁。这款恶意软件所使用的大多数C2通道已经摧毁。第二阶段植入体不具备持久化技术，因此很有可能已从被感染的设备中清除。我们没有发现攻击者尝试重新连接目标设备的任何迹象（这些设备运行第一阶段持久化载荷，会监听接入请求）。
这是否意味着攻击者已经放弃进入小型家庭办公（SOHO）网络设备空间的这个据点？攻击者是否重新开始，重新攻击并释放未知的恶意软件，重新获取了访问权限？攻击者是否放弃针对全球范围的SOHO访问权限，转而采用跟为针对性的方案，只攻击特定的关键目标？
无论答案如何，我们知道VPNFilter背后的攻击者实力很强，会在任务驱动下不断改进，以实现他们的既定目标。攻击者会以某种形式继续开发任务目标所需的各种工具和框架。
## 六、IoC
    a43a4a218cf5755ce7a7744702bb45a34321339ab673863bf6f00ac193cf55fc
    aac52856690468687bbe9e357d02835e9f5226a85eacc19c34ff681c50a6f0d8
    13165d9673c240bf43630cddccdc4ab8b5672085520ee12f7596557be02d3605
    b81f857cd8efab6e6e5368b1c00d93505808b0db4b773bee1843a3bc948d3f4f
    809f93cbcfe5e45fae5d69ca7e64209c02647660d1a79b52ec6d05071b21f61a
    7ff2e167370e3458522eaa7b0fb81fe21cd7b9dec1c74e7fb668e92e261086e0
    81368d8f30a8b2247d5b1f8974328e9bd491b574285c2f132108a542ea7d38c7
    b301d6f2ba8e532b6e219f3d9608a56d643b8f289cfe96d61ab898b4eab0e3f5
    99e1db762ff5645050cea4a95dc03eac0db2ceb3e77d8f17b57cd6e294404cc7
    76bf646fce8ff9be94d48aad521a483ee49e1cb53cfd5021bb8b933d2c4a7f0f
    e009b567516b20ef876da6ef4158fad40275a960c1efd24c804883ae273566b0
    7c06b032242abefe2442a8d716dddb216ec44ed2d6ce1a60e97d30dbba1fb643
    f8080b9bfc1bd829dce94697998a6c98e4eb6c9848b02ec10555279221dd910a
    4e350d11b606a7e0f5e88270938f938b6d2f0cc8d62a1fdd709f4a3f1fa2c828
    f1cf895d29970c5229b6a640c253b9f306185d4e99f4eac83b7ba1a325ef9fb8
    8395e650e94b155bbf4309f777b70fa8fdc44649f3ab335c1dfdfeb0cdee44ff
    a249a69e692fff9992136914737621f117a7d8d4add6bac5443c002c379fe072
    5e75b8b5ebbef78f35b00702ced557cf0f30f68ee08b399fc26a3e3367bb177b
    fe022403a9d4c899d8d0cb7082679ba608b69091a016e08ad9e750186b1943dd
    116d584de3673994e716e86fbb3945e0c6102bfbd30c48b13872a808091e6bc9
    4263c93ce53d7f88c62fecb6a948d70e51c19e1049e07df2c70a467bcefee2c8
    5d70e7dd5872cc0d7d0f7015c11400e891c939549c01922bff2bbe3b7d5d1ce3
    5c52f115ab8a830d402fac8627d0bfdcbbfd4dcf0e6ad8154d49bb85387893aa
    e75e224c909c9ead4cb50cd772f606407b09b146051bfb28015fcbe27b4a5e8d
    999f14044f41adfd9fb6c97c04d7d2fd9af01724b3ab69739acf615654abfa43
    b118b23a192f372616efe8c2b12977d379ac76df22493c14361587bd1cc8a804
    7ba0dc46510492a7f6c9b2bcc155333898d677cd8a88fe0e1ac1ad3852f1c170
    83b3dbf7f6bc5f98151b26781fa892fc1a014c62af18c95ae537848204f413b8
    fce03f57b3fd3842efac3ce676687794c4decc29b612068e578134f3c4c4296a
    1f26b69a353198bb047dde86d48198be8271e07f8c9d647d2f562207e1330a37
    1e824654afba03678f8177e065c487a07192069711eeb4abe397010771b463b5
    84227f906c7f49071d6598b9035fc785d2b144a6349d0cf7c29177c00db2dc2f
    6eb09f805a68b29c9516d649019bea0bb4796e504ca379783455508a08f61087
    aa5baa135b2ada5560833747260545d6a5b49558f6244c0f19443dc87c00294d
    4c5e21125738c330af1bfe5cabc5f18fa14bbef53805dda2c3c31974555f7ec5
    0f3746f273281472e7181f1dd1237f0c9fc26f576a883f42413c759f381006c4
    acfc72b8d6611dc9cd6a3f1a4484aa0adfb404ad5faaa8b8db5747b0ff05bc22
    fe9c17ac036622b2d73466f62b5d095edda2d3b60fa546a48d0bb18f8b11059f
    830091904dab92467956b91555bc88fa7e6bbde514b8a90bb078c8a3bb2f39a9
    5a28ad479d55275452e892b799c32803f81307079777bb1a5c4d24477206d16b
    8440128350e98375b7eff67a147dfe4e85067d67f2ad20d9485f3de246505a5f
    275c4e86218915c337d7e37e7caba36cb830512b17353bf9716c4ba6dceb33ed
    b700207c903e8da41f33f11b69f703324ec79eb56c98b22efaeac0a10447ec44
    2aa149a88539e8dd065c8885053a30d269be63d41a5db3f66c1982202761aa75
    1a11240d0af108720de1a8a72ceadef102889f4d5679c1a187559d8d98143b0b
    3b6be595b4183b473964345090077b1df29b0cace0077047b46174cc09c690e1
    620c51f83457d0e8cb985f1aff07c6d4a33da7566297d41af681ae3e5fbd2f80
    4c8da690501c0073a3c262a3079d8efac3fea9e2db9c55f3c512589e9364e85c
    d92282acf3fea66b05a75aba695e98a5ea1cc1151f9e5370f712b69a816bf475
    30382c1e7566d59723ff7ef785a1395711be64873dbca6d86691b1f5d86ba29f
我们发布了如下特征及规则以便检测VPNFilter使用的附加模块。
检测ndbr的Snort规则
    sid:1:47377:1
Clam AV规则
    Unix.Trojan.Vpnfilter_htpx-6596262-0
    Unix.Trojan.Vpnfilter_ndbr-6598711-0
    Unix.Trojan.Vpnfilter_netfilter-6599563-0
    Unix.Trojan.Vpnfilter_nm-6598714-0
    Unix.Trojan.Vpnfilter_portforwarding-6599587-0
    Unix.Trojan.Vpnfilter_socks5proxy-6599614-0
    Unix.Trojan.Vpnfilter_tcpvpn-6606298-0
    Unix.Trojan.Vpnfilter-6425812-1
    Unix.Trojan.Vpnfilter-6550592-1