目录 XI ●
AND运算符和OR运算符 70
通过括号强化处理 72
逻辑运算符和真值 74
含有NULL时的真值 76
练习题 78
第3章 聚合与排序 79
3-1 对表进行聚合查询 81
聚合函数 81
计算表中数据的行数 82
计算NULL之外的数据的行数 83
计算合计值 84
计算平均值 86
计算最大值和最小值 87
使用聚合函数删除重复值（关键字DISTINCT） 89
3-2 对表进行分组 91
GROUP BY子句 91
聚合键中包含NULL的情况 93
使用WHERE子句时GROUP BY的执行结果 94
与聚合函数和GROUP BY子句有关的常见错误 96
3-3 为聚合结果指定条件 101
HAVING子句 101
HAVING子句的构成要素 104
相对于HAVING子句，更适合写在WHERE子句中的条件 105
3-4 对查询结果进行排序 108
ORDER BY子句 108
指定升序或降序 110
● XII 目录
指定多个排序键 111
NULL的顺序 111
在排序键中使用显示用的别名 112
ORDER BY子句中可以使用的列 114
不要使用列编号 114
练习题 116
第4章 数据更新 117
4-1 数据的插入（INSERT语句的使用方法） 119
什么是INSERT 119
INSERT语句的基本语法 120
列清单的省略 123
插入NULL 123
插入默认值 124
从其他表中复制数据 126
4-2 数据的删除（DELETE语句的使用方法） 129
DROP TABLE语句和DELETE语句 129
DELETE语句的基本语法 129
指定删除对象的DELETE语句（搜索型DELETE） 130
4-3 数据的更新（UPDATE语句的使用方法） 133
UPDATE语句的基本语法 133
指定条件的UPDATE语句（搜索型UPDATE） 134
使用NULL进行更新 135
多列更新 136
4-4 事务 138
什么是事务 138
创建事务 139
目录 XIII ●
ACID特性 144
练习题 145
第5章 复杂查询 147
5-1 视图 149
视图和表 149
创建视图的方法 151
视图的限制① ——定义视图时不能使用ORDER BY子句 154
视图的限制② ——对视图进行更新 155
删除视图 159
5-2 子查询 160
子查询和视图 160
子查询的名称 163
标量子查询 163
标量子查询的书写位置 166
使用标量子查询时的注意事项 167
5-3 关联子查询 168
普通的子查询和关联子查询的区别 168
关联子查询也是用来对集合进行切分的 171
结合条件一定要写在子查询中 172
练习题 173
第6章 函数、谓词、CASE表达式 175
6-1 各种各样的函数 177
函数的种类 177
算术函数 178
字符串函数 182
● XIV 目录
日期函数 190
转换函数 194
6-2 谓词 198
什么是谓词 198
LIKE谓词——字符串的部分一致查询 198
BETWEEN谓词——范围查询 202
IS NULL、IS NOT NULL——判断是否为NULL 203
IN谓词——OR的简便用法 204
使用子查询作为IN谓词的参数 205
EXIST谓词 210
6-3 CASE表达式 214
什么是CASE表达式 214
CASE表达式的语法 214
CASE表达式的使用方法 215
练习题 221
第7章 集合运算 223
7-1 表的加减法 225
什么是集合运算 225
表的加法——UNION 225
集合运算的注意事项 228
包含重复行的集合运算——ALL选项 229
选取表中公共部分——INTERSECT 230
记录的减法——EXCEPT 231
7-2 联结（以列为单位对表进行联结） 234
什么是联结 234
内联结——INNER JOIN 235
目录 XV ●
外联结——OUTER JOIN 240
3张以上的表的联结 243
交叉联结——CROSS JOIN 246
联结的特定语法和过时语法 249
练习题 254
第8章 SQL高级处理 255
8-1 窗口函数 257
什么是窗口函数 257
窗口函数的语法 258
语法的基本使用方法——使用RANK函数 258
无需指定PARTITION BY 261
专用窗口函数的种类 262
窗口函数的适用范围 263
作为窗口函数使用的聚合函数 264
计算移动平均 266
两个ORDER BY 269
8-2 GROUPING运算符 271
同时得到合计行 271
ROLLUP——同时得出合计和小计 272
GROUPING函数——让NULL更加容易分辨 277
CUBE——用数据来搭积木 279
GROUPING SETS——取得期望的积木 281
练习题 282
第9章 通过应用程序连接数据库 283
9-1 数据库世界和应用程序世界的连接 285
数据库和应用程序之间的关系 285
● XVI 目录
驱动——两个世界之间的桥梁 286
驱动的种类 287
9-2 Java基础知识 289
第一个程序Hello,World 289
编译和程序执行 291
常见错误 294
9-3 通过Java连接PostgreSQL 298
执行SQL语句的Java程序 298
Java是如何从数据库中获取数据的呢 299
执行连接数据库的程序 301
选取表中的数据 302
更新表中的数据 305
小结 307
练习题 307
附录 练习题答案 308
第0章 绪论
——搭建SQL的学习环境
PostgreSQL的安装和连接设置
通过PostgreSQL执行SQL语句
本章重点
如果想要一边执行SQL语句一边学习，就必须有数据库作为SQL语句的
执行环境。本章将介绍开源数据库PostgreSQL（版本9.5.3A）在Windows环境
下的安装方法。已经安装了执行环境（数据库）的读者，可以跳过本章，直接
学习第1章及之后的内容。
PostgreSQL是1980年以加利福尼亚大学为中心开发出来的DBMS，与
MySQL一样，都是世界上广泛应用的开源数据库（DB）。它严格遵守标准SQL
规则，是初学者的最佳选择。
0-1 PostgreSQL的安装和连接设置
■安装步骤
■修改设置文件
0-2 通过PostgreSQL执行SQL语句
■连接PostgreSQL（登录）
■执行SQL语句
■创建学习用的数据库
■连接学习用的数据库（登录）
注 意 ● 本书使用PostgreSQL作为SQL的学习环境，当然也可以使用其他关系数据库。
● 本书使用Windows 10来介绍数据库的安装方法，该方法也适用于其他
Windows OS。
A 因PostgreSQL版本在不断更新，读者在学习时下载最新版本即可。
——译者注
0-1 PostgreSQL的安装和连接设置 3 ●
第0章 绪论
0-1
PostgreSQL的安装和连接设置
那么就让我们赶快按照下面的步骤来安装PostgreSQL吧。
安装步骤
1. 下载安装程序
大家可以从PostgreSQL 的下载页面下载安装程序。
● 下载页面
http://www.enterprisedb.com/products-services-training/pgdownload#windows
本书将会介绍使用64位版的Windows安装程序（Win x86-64）在Windows 10（64位）系统中安
装PostgreSQL的步骤，请大家结合自身实际下载相应的安装程序。例如，如果大家使用的是32位的
Windows操作系统，请下载“Win x86-32”版本的安装程序（图0-1），安装步骤都是一样的。
图0-1 下载面向Windows的PostgreSQL安装程序
● 4 第0章 绪论
2. 运行安装程序
运行安装程序的时候，鼠标右键点击安装文件，然后选择“以管理员身份运行”。
注 意 由于安装PostgreSQL需要操作系统的管理员权限，因此不能直接双击安装程序运行，必须“以管理员身份运行”
才可以。这个过程中有可能会需要输入管理员密码，或者弹出运行许可的询问窗口，此时请输入密码，或点击“是”
（OK）按钮。
然后点击安装画面（图0-2）中 图0-2 安装开始
的“Next >”按钮。
3. 选择安装路径
图0-3 选择安装路径
接下来会显示选择安装路径的画
面（图0-3）。默认的安装路径是“C:\
Program Files\PostgreSQL\
9.5”，但是因为有些用户的账号可
能无法直接访问“Program Files”
文件夹，所以我们把路径改为“C:\
PostgreSQL\9.5”， 然 后 点 击
“Next >”按钮。安装过程中会自动
创建文件夹，因此大家无需提前创建。
0-1 PostgreSQL的安装和连接设置 5 ●
4. 选择数据的保存路径 图0-4 选择数据保存路径
接下来显示的是选择数据保存路径的画面
（图0-4），无需修改默认路径“C:\PostgreSQL\
9.5\data”，直接点击“Next >”按钮。
5. 设置数据库管理员密码 图0-5 设置数据库管理员密码
在接下来的数据库管理员密码设置画面
（图0-5）中输入任意密码，点击“Next >”按钮。
登录PostgreSQL时会用到这个密码，请大家
务必牢记。
图0-6 设置端口号
6. 设置端口号
接下来会出现端口号设置画面（图0-6），无
需修改，直接点击“Next >”按钮。通常情况下
保持默认选项即可。
● 6 第0章 绪论
7. 设置地区 图0-7 设置地区
接下来是PostgreSQL 地区设置画面（图
0-7）。选择“Chinese（Simplified）， Singapore”，
点击“Next >”按钮。
8. 安装
接下来是安装开始的画面（图0-8）。直接点
击“Next >”按钮，开始安装（图0-9）。
图0-8 开始安装 图0-9 安装进行中
接下来会显示安装完成的画面（图0-10）。 图0-10 安装完成
取消选中的“Launch Stack Builder at exit？”，点
击“Finish”按钮。“Launch Stack Builder”会安
装各种附带工具，如果只需要使用PostgreSQL，
就没必要安装这些工具。
这样安装就完成了。
0-1 PostgreSQL的安装和连接设置 7 ●
修改设置文件
为了提高安全性，我们需要修改一下PostgreSQL的设置文件。请使用记事本或其他文本编辑工
具打开下面这个文件。
C:\PostgreSQL\9.5\data\postgresql.conf
使用“listen_addresses”作为关键词来查询文件内容。安装完成之后，该关键词会被
设置成“listen_addresses = '*'”。虽然这意味着允许所有远程主机进行连接，但是这次
的学习环境只需要通过本地机器进行连接就可以了，因此我们在这一行的最前面添加一个#，注释
掉该行。
#listen_addresses = '*'
添加如下一行新的内容，然后覆盖保存文件（图0-11）。
listen_addresses = 'localhost'
图0-11 添加“listen_addresses = 'localhost'”
添加这一行
这样就设置成只允许本地机器进行连接了。
必须重新启动PostgreSQL，该设置才能生效。点击“控制面板”→“管理工具”→“服务”。