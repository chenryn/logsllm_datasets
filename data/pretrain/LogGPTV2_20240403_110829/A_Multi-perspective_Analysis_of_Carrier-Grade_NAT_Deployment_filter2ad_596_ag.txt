●●●●●●●
●●●●●●●●●●
●●
●●
●●●●●
●
●●
●
●●●
●
●
●
●●
●
●●●●●●●●●●●
●●●●●●●●●
●
●
●
●●
●●
●●●●
●
●●●●
●
●
●
●
●●
●●
●●
●●●●●●●●
●
●●●●●●●
●●●●●●●●
●●●●●●●●●●●
●●●●
●●
●●●●●●●●●●●●●●
●●●●●
●●●
●●
●
●●●
●
●
●●●●●●●●
●
●
●●
●●
●
●
●●
●●●
●
●●●
●
●●●●●
●
●
●
●●●●●●
●●
●
●
●●●
●●●●●●
●●
●
●●●
●●
●
●●●●
●
●
●
●●●●
●●
●●●●
●●●
●●●●
●
●●●●●
●
●
●●●
●●●●●●●●●●●●●
●
●
●●●●
●
●
●
●●
●●
●●
●●●●
●●
●●●
●
●●●●
●
●●●
●●●
●●●●●●●
●●
●
●●●●●
●●●
●●
●●
●●●●
●
●
●●●●●●●●
●●
●●●●●●●●
●●●●
●●●●
●●●
●
●
●●●●●
●
●
●●
●●●
●●●●●●●●●
●●
●
●●●
●●●
●●●
●●
●●●●●
●●●●●
●●●
●●
●
●●●●
●●●●
●●
●
●●●
●
●
●●
●
●●●●●●●
●●●
●●●●●●
●●●●●
●●●●●
●●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
cellular CGN
(per AS)
non−cellular CGN
(per AS)
CPE
(per session)
Figure 12: UDP mapping timeouts of CPEs and CGNs.
timeout values that we detected for CPE devices (shown in
the right boxplot), where we show a boxplot of all recorded
sessions. In NAT444 scenarios (non-cellular CGN) we need
to make sure to report the timeout of CGNs rather than the
CPE NATs. Therefore, to reason about CGN mapping time-
outs, we only consider sessions that were detected as CGN
(§ 4) and where our TTL-driven NAT enumeration detected
the NAT at a distance of three or more hops away from the
client. We observe that 74% of detected NATs expire idle
UDP state after 1 minute or less, but we ﬁnd values rang-
ing from 10s to 200s.14 CGNs in cellular networks exhibit
a larger median mapping timeout (65s) compared to non-
cellular networks (35s). For CPE NATs we predominantly
measured a timeout of 65s. We ﬁnd higher variability and a
lower median of timeout values for non-cellular CGNs when
compared to CPE NATs. Low CGN timeout values might in
turn negatively affect the longevity of sparse UDP ﬂows that
are also exposed to CPE NATs. While we ﬁnd lower time-
out values for CGNs compared to CPEs, we acknowledge
that this property does not necessarily hold true for CGNs in
general, as our test can not detect timeout values larger than
200 seconds.
Mapping types: Figure 13 shows our STUN results. We or-
der the observed mapping types from most restrictive (sym-
metric NAT) to most permissive (full cone NAT). In Figure
13(a) we show the NAT mapping type as observed for CPE
routers, while the bars in Figure 13(b) indicate the most per-
missive type of NAT mapping for our CGN-positive ASes.
Recall that when multiple NAT devices reside on the path,
STUN reports the most restrictive behavior of them, which
also determines eventual NAT traversal. Hence, we argue
that the most permissive STUN type provides a good approx-
imation for the CGN behavior, because there cannot be a
STUN result less restrictive than the CGN. We observe that,
while exhibiting some diversity, less than 2% of the tests
showed CPE NATs with very restrictive symmetric NATs.
In contrast to CPE NATs, we observe 11% of non-cellular
CGN ASes whose most permissive mapping type is sym-
metric. Among these networks we ﬁnd many popular large
European ISPs. For cellular networks we observe a bimodal
14Note that our timeout detection mechanism uses a 10 sec-
ond probing interval. Hence, reported values can differ up to
10 seconds from the actual NAT timeout.
symmetric
port−address
restricted
address
restricted
full cone
other
−
n
o
n
r
a
u
l
l
l
e
c
N
G
C
o
n
0.0
0.2
0.4
0.6
fraction of sessions
0.8
1.0
(a) Distribution of observed STUN types in CPE NATs.
−
n
o
n
r
a
u
l
l
l
e
c
N
G
C
r
a
u
l
l
l
e
c
N
G
C
0.0
0.2
0.4
0.6
fraction of ASes
0.8
1.0
(b) Most permissive STUN type per AS (only CGN ses-
sions).
Figure 13: STUN results per AS.
outcome, with a large fraction of both restrictive (40% sym-
metric) and permissive (20% full cone) NAT types. We see
large operators on both ends of the spectrum, with major cel-
lular networks in the US deploying CGNs with symmetric
mapping types.
Thus, we often measure stricter NAT mapping policies
for CGN-positive sessions when compared to common home
CPE devices. We conclude that a large fraction of ISPs de-
ploy CGNs that use symmetric ﬂow mappings, which limits
the customers’ ability to establish direct connections. For
this reason, the IETF lists an endpoint-independent mapping
(which symmetric NATs violate) as their ﬁrst requirement
for CGNs [6, 21].
7.
IMPLICATIONS
Our analysis shows that ISPs widely deploy CGN. We ﬁnd
that more than 17% of eyeball ASes and more than 90% of
cellular ASes rely on CGNs (§ 5), with particularly high de-
ployment rates in Asia and Europe—regions in which IPv4
address scarcity cropped up ﬁrst, as the respective registries
ran out of readily available IPv4 addresses in 2011 and 2012.
Thus, adopting CGN presents a viable alternative to buying
IPv4 address space from brokers. CGNs actively extend the
lifetime of IPv4 and hence also fuel the demand of the grow-
ing market for IPv4 address space [36], which in turn affects
market prices and possibly hampers the adoption IPv6.
CGNs directly affect “how much Internet” a subscriber
receives, by (i) limiting available ephemeral port space, (ii)
restricting the directionality of connections, and (iii) limit-
ing connection lifetimes due to ﬁnite state-keeping budgets.
Studying our identiﬁed CGN deployments, we ﬁnd a wide
spectrum of conﬁgurations and degrees of address sharing
(§ 6). On the limiting end of the spectrum, we ﬁnd ISPs
allocating as little as 512 ephemeral ports per subscriber
(§ 6.2), multiplexing up to 128 subscribers per public IP ad-
dress. Comparing NAT ﬂow mapping types and timeouts of
CGNs to commonly deployed CPE hardware, we ﬁnd that
in many instances CGNs use more restrictive ﬂow mapping
types when compared to their home counterparts (§ 6.5).
This rules out peer-to-peer connectivity, complicating mod-
ern protocols such as WebRTC [22] that now need to rely on
rendezvous servers.
We argue that the lack of guidelines and regulations for
CGN deployment compounds the situation. While the IETF
publishes best practices for general NAT behavior [6,21,33]
as well as basic requirements for CGN deployments [34]
(which, incidentally, many of our identiﬁed CGNs violate),
dimensioning NATs at carrier-scale in a way that minimizes
collateral damage remains a black art. Our ﬁnding that some
large ISPs ﬁnd the need to employ publicly routable (in-
deed, sometimes routed) address space for internal CGN de-
ployment (§ 6.1) underlines the graveness of the situation.
While it remains out of scope for this work to precisely mea-
sure the effect of CGNs on end-users’ applications, we be-
lieve that our observations can serve as input for establishing
such guidelines. Our ﬁndings should also interest regulators,
who in some countries already impose acceptable service re-
quirements on Internet performance (e.g., the FCC’s mea-
surements of advertised vs. achieved throughput [19]). We
argue that the presence and service levels of CGNs should
be readily identiﬁable in ISPs’ offerings. Unfortunately, we
ﬁnd that most ISPs do not cover CGN deployment in their
terms of service. Lastly, our ﬁndings document further ero-
sion of the meaningfulness of IP address reputation, address-
based blacklisting, IP-to-user attribution, and geolocating
end-users (§ 6.2, § 6.4), which become all but infeasible in
the presence of CGN.
8. CONCLUSION
This work presents a solid ﬁrst step towards a better un-
derstanding of the prevalence and characteristics of CGN de-
ployment in today’s Internet. Our methods, based on har-
vesting the BitTorrent DHT and extensions to our Netalyzr
active measurement framework, prove effective in uncover-
ing CGN deployments: we detect more than 500 instances
in ISPs around the world. When assessing the properties of
these CGNs we ﬁnd striking variability in the dimensioning,
conﬁguration, placement, and effect on the subscriber’s con-
nectivity. We hope this study will stimulate a much-needed
discussion about best practices, guidelines, and regulation
of CGN deployment. In future work, we plan to further im-
prove our detection mechanisms and to study the impact of
CGN on application performance.
Acknowledgments
We thank the network operators who participated in our sur-
vey for their insightful feedback and comments. We thank
Daniele Iamartino for support with validating the BitTorrent
data, and Martin Ott for his support with implementing the
BitTorrent crawler. We also thank the anonymous reviewers
for their helpful feedback. This work was partially supported
by the US National Science Foundation under grants CNS-
1111672 and CNS-1213157, the Leibniz Prize project funds
of DFG/German Research Foundation (FKZ FE 570/4-1),
and the BMBF AutoMon project (16KIS0411). Any opin-
ions expressed are those of the authors and not necessarily
of the sponsors.
9. REFERENCES
[1] Netalyzr for Android. Google Play. https://play.
google.com/store/apps/details?id=edu.
berkeley.icsi.netalyzr.android.
[2] A. Tabdili. Carrier Grade NAT: Requirements and
Challenges in the Real World .
http://www.menog.org/presentations/
menog 10/Amir%20Tabdili%20 %20Carrier%
20Grade%20NAT.pdf.
[3] A10 Networks. Carrier Grade NAT (CGN)
Deployment Guide. https://www.a10networks.
com/sites/default/files/resource files/
A10 DG Carrier_Grade_NAT_%28CGN%29_
Large_Scale_NAT_%28LSN%29.pdf.
[4] S. Alcock, R. Nelson, and D. Miles. Investigating the
Impact of Service Provider NAT on Residential
Broadband Users. TR, University of Waikato, 2010.
[5] APNIC Labs. Customers per AS Measurements.
Description: https://labs.apnic.net/?p=526
Dataset: http://stats.labs.apnic.net/aspop.
[6] F. Audet and C. Jennings. Network Address
Translation (NAT) Behavioral Requirements for
Unicast UDP. RFC 4787 (Best Current Practice),
January 2007. Updated by RFCs 6888, 7857.
[7] S. M. Bellovin. A Technique for Counting NATted
Hosts. In IMW, 2002.
[8] BitTorrent.org. DHT Protocol (BEP-05). http://
www.bittorrent.org/beps/bep_0005.html.
[9] E. Bocchi, A. S. Khatouni, S. Traverso, A. Finamore,
V. D. Gennaro, M. Mellia, M. Munafo, and D. Rossi.
Impact of Carrier-Grade NAT on Web Browsing. In
IWCMC, 2015.
[10] M. Boucadair, R. Penno, and D. Wing. Universal Plug
and Play (UPnP) Internet Gateway Device - Port
Control Protocol Interworking Function (IGD-PCP
IWF). RFC 6970 (Proposed Standard), July 2013.
[11] M. Butkiewicz, H. V. Madhyastha, and V. Sekar.
Understanding Website Complexity: Measurements,
Metrics, and Implications. In IMC, 2011.
[12] Cisco. NAT Administration Guide, StarOS Release 17.
http://www.cisco.com/c/dam/en/us/td/
docs/wireless/asr_5000/17 0/PDF/17 NAT 
Admin.pdf.
[13] Cymru. Ephemeral Source Port Selection Strategies.
https://www.cymru.com/jtk/misc/
ephemeralports.html.
[14] J. Czyz, M. Allman, J. Zhang, S. Iekel-Johnson,
E. Osterweil, and M. Bailey. Measuring IPv6
Adoption. In ACM SIGCOMM, 2014.
[15] L. D’Acunto, J.A. Pouwelse, and H.J. Sips. A
measurement of NAT & Firewall Characteristics in
Peer to Peer Systems. In ASCI, 2009.
[16] L. DiCioccio, R. Teixeira, M. May, and C. Kreibich.
[33] R. Penno, S. Perreault, M. Boucadair, S. Sivakumar,
and K. Naito. Updates to Network Address
Translation (NAT) Behavioral Requirements. RFC
7857 (Best Current Practice), April 2016.
[34] S. Perreault, I. Yamagata, S. Miyakawa, A. Nakagawa,
and H. Ashida. Common Requirements for
Carrier-Grade NATs (CGNs). RFC 6888 (Best Current
Practice), April 2013.
[35] Y. Rekhter, B. Moskowitz, D. Karrenberg, G. J.
de Groot, and E. Lear. Address Allocation for Private
Internets. RFC 1918 (Best Current Practice), February
1996. Updated by RFC 6761.
[36] P. Richter, M. Allman, R. Bush, and V. Paxson. A
Primer on IPv4 Scarcity. ACM CCR, 45(2), 2015.
[37] P. Richter, G. Smaragdakis, D. Plonka, and A. Berger.
Beyond Counting: New Perspectives on the Active
IPv4 Address Space. In ACM IMC, 2016.
[38] J. Rosenberg, A. Keranen, B. B. Lowekamp, and A. B.
Roach. TCP Candidates with Interactive Connectivity
Establishment (ICE). RFC 6544 (Proposed Standard),
March 2012.
[39] J. Rosenberg, R. Mahy, P. Matthews, and D. Wing.
Session Traversal Utilities for NAT (STUN). RFC
5389 (Proposed Standard), October 2008. Updated by
RFC 7350.
[40] J. Rosenberg, J. Weinberger, C. Huitema, and
R. Mahy. STUN - Simple Traversal of User Datagram
Protocol (UDP) Through Network Address
Translators (NATs). RFC 3489 (Proposed Standard),
March 2003. Obsoleted by RFC 5389.
[41] N. Skoberne, O. Maennel, I. Phillips, R. Bush, J. Zorz,
and M. Ciglaric. IPv4 Address Sharing Mechanism
Classiﬁcation and Tradeoff Analysis. IEEE/ACM ToN,
2014.
Probe and Pray: Using UPnP for Home Network
Measurements. In PAM, 2012.
[17] C. Donley, L. Howard, V. Kuarsingh, J. Berg, and
J. Doshi. Assessing the Impact of Carrier-Grade NAT
on Network Applications. RFC 7021 (Informational),
September 2013.
[18] K. Egevang and P. Francis. The IP Network Address
Translator (NAT). RFC 1631 (Informational), May
1994. Obsoleted by RFC 3022.
[19] FCC. Measuring Broadband America. https://
www.measuringbroadbandamerica.com/.
[20] B. Ford, P. Srisuresh, and D. Kegel. Peer-to-Peer
Communication Across Network Address Translators.
In USENIX ATC, 2005.
[21] S. Guha, K. Biswas, B. Ford, S. Sivakumar, and
P. Srisuresh. NAT Behavioral Requirements for TCP.
RFC 5382 (Best Current Practice), October 2008.
Updated by RFC 7857.
[22] C. Holmberg, S. Hakansson, and G. Eriksson. Web
Real-Time Communication Use Cases and
Requirements. RFC 7478 (Informational), March
2015.
[23] Alan B. Johnston. SIP: Understanding the Session
Initiation Protocol. Artech House, Inc., Norwood,
MA, USA, 3rd edition, 2009.
[24] C. Kreibich, N. Weaver, B. Nechaev, and V. Paxson.
Netalyzr: Illuminating The Edge Network. In IMC,
2010.
[25] V. Krmicek, J. Vykopal, and R. Krejci. NetFlow Based
System for NAT Detection. In ACM CoNEXT, 2009.
[26] A. Lutu, M. Bagnulo, A. Dhamdhere, and k. claffy.
NAT Revelio: Detecting NAT444 in the ISP. In PAM,
2016.
[27] D. MacDonald and B. Lowekamp. NAT Behavior
Discovery Using Session Traversal Utilities for NAT
(STUN). RFC 5780 (Experimental), May 2010.
[28] G. Maier, F. Schneider, and A. Feldmann. NAT Usage
in Residential Broadband Networks. In PAM, 2011.
[29] P. Maymounkov and D. Mazieres. Kademlia: A
Peer-to-Peer Information System Based on the XOR
Metric. In Peer-to-Peer Systems. Springer, 2002.
[30] A. Müller, F. Wohlfart, and G. Carle. Analysis and
Topology-based Traversal of Cascaded Large Scale
NATs. In ACM HotMiddlebox, 2013.
[31] NOW (New Zealand ISP). What if I need a public IP
[32] Y. Ohara, K. Nishizuka, K. Chinen, K. Akashi,
Address? https://support.nownz.co.nz/
support/solutions/articles/5000504832 
what if i need a public ip address .
M. Kohrin, E. Muramoto, and S. Miyakawa. On the
Impact of Mobile Network Delays on Connection
Establishment Performance of a Carrier Grade NAT
Device. In ACM AINTEC, 2014.
[42] Spamhaus. The Policy Block List.
https://www.spamhaus.org/pbl/.
[43] P. Srisuresh, B. Ford, and D. Kegel. State of
Peer-to-Peer (P2P) Communication across Network
Address Translators (NATs). RFC 5128
(Informational), March 2008.
[44] L. Wang and J. Kangasharju. Real-world sybil attacks
in BitTorrent mainline DHT. In IEEE GLOBECOM,
2012.
[45] Z. Wang, Z. Qian, Q. Xu, Z. M. Mao, and M. Zhang.
An Untold Story of Middleboxes in Cellular
Networks. In ACM SIGCOMM, 2011.
[46] J. Weil, V. Kuarsingh, C. Donley, C. Liljenstolpe, and
M. Azinger. IANA-Reserved IPv4 Preﬁx for Shared
Address Space. RFC 6598 (Best Current Practice),
April 2012.
[47] D. Wing. NAT Tutorial. In IETF 78, 2010.