ğ‘’
ğœ™
ğœ™,ğ‘¤ Ã— â„ğ‘
if ğœ™, ğœ™â€² âˆˆ ğ‘ƒğ‘˜
ğ‘’ â‰¤ ğ›¾ğ‘’
ğ‘’
ğ‘’,ğ‘ .ğ‘šğ‘œğ‘‘ğ‘¢ğ‘™ğ‘ğ‘¡ğ‘–ğ‘œğ‘› = ğ‘Ÿ ğ‘
ğ‘’
(18)
(19)
(20)
(21)
(22)
(23)
(24)
(25)
(26)
(27)
Table 7: Arrow joint IP/optical TE formulation.
noise sources, and then switches to reconfiguring all intermediate
ROADMs and noise sources.
Number of ROADMs to be reconfigured. Reconfiguring wave-
lengths from the cut fiber path to the surrogate restoration fiber
Topology
Facebook
IBM
B4
# of binary vars.
12,280 million
81 million
52 million
# of continuous vars.
72 thousand
6.5 thousand
3.5 thousand
# of constraints
memory overflow
192 million
119 million
Table 8: Size of joint IP/optical TE formulation.
Table 1
ğ‘ ğ‘ = {ğ‘§}
ğ‘Ÿ ğ‘§,ğ‘
ğ‘’
ğ‘Œ ğ‘§,ğ‘
ğ‘“
ğ‘€
ğ‘ ğ‘“
ğ‘ğ‘“ ,ğ‘¡
Arrow
Binary ILP
Input
Parameters
Arrow
Binary ILP
Output
Standard TE input parameters.
Set of LotteryTicket indexes under scenario
ğ‘.
Restorable bandwidth capacity for link ğ‘’
under scenario ğ‘ and LotteryTicket ğ‘§.
Restorable tunnels for flow ğ‘“ under sce-
nario ğ‘ and LotteryTicket ğ‘§.
A big number.
Total allocated bandwidth for flow ğ‘“ .
For flow ğ‘“ , the allocated bandwidth on tun-
nel ğ‘¡ âˆˆ ğ‘‡ğ‘“ .
1 if the ğ‘§ LotteryTicket is selected under
scenario ğ‘, otherwise 0.
ğ‘¥ğ‘§,ğ‘
Subject to:
Maximize: ğ‘“ âˆˆğ¹ ğ‘ ğ‘“
âˆ€ğ‘“ : ğ‘¡âˆˆğ‘‡ğ‘“
âˆ€ğ‘’ : ğ‘“ âˆˆğ¹ğ‘¡âˆˆğ‘‡ğ‘“
âˆ€ğ‘“ , ğ‘, ğ‘§ : 
ğ‘ğ‘“ ,ğ‘¡ +
âˆ€ğ‘’, ğ‘, ğ‘§ : ğ‘“ âˆˆğ¹
âˆ€ğ‘ : ğ‘§âˆˆğ‘ ğ‘ ğ‘¥ğ‘§,ğ‘ = 1
0 â‰¤ ğ‘ ğ‘“ â‰¤ ğ‘‘ğ‘“
ğ‘¡âˆˆğ‘Œ ğ‘§,ğ‘
ğ‘ğ‘“ ,ğ‘¡ â‰¥ ğ‘ ğ‘“
ğ‘¡âˆˆğ‘Œ ğ‘§,ğ‘
âˆ€ğ‘“ :
ğ‘“
ğ‘“
ğ‘ğ‘“ ,ğ‘¡ Ã— ğ¿[ğ‘¡, ğ‘’] â‰¤ ğ‘ğ‘’
ğ‘ğ‘“ ,ğ‘¡ â‰¥ ğ‘ ğ‘“ âˆ’ ğ‘€(1 âˆ’ ğ‘¥ğ‘§,ğ‘)
ğ‘¡âˆˆğ‘‡ ğ‘
ğ‘“
ğ‘ğ‘“ ,ğ‘¡ Ã— ğ¿[ğ‘¡, ğ‘’] â‰¤ ğ‘Ÿ ğ‘§,ğ‘
ğ‘’ + ğ‘€(1 âˆ’ ğ‘¥ğ‘§,ğ‘)
(28)
(29)
(30)
(31)
(32)
(33)
Table 9: Arrow TE binary ILP formulation.
path requires the ROADMs and ASE noise sources (at both add/-
drop nodes and intermediate nodes) to be reconfigured. We quantify
the number of devices to be reconfigured with Arrow for every
fiber on Facebookâ€™s optical backbone. Fig. 19 shows the CDF of
number of add/drop and intermediate ROADMs to be reconfigured
withunder Arrow at Facebook. We observe that for 80% of the
fiber cut events, the number of add/drop ROADMs is less than 10,
while the number for intermediate ROADMs is less than 6. The
reason why there may be more than 2 Add/drop ROADMs is that
the failed wavelengths on a cut fiber do not necessarily originate
and terminate at the endpoints of the broken fiber. Their source and
destination sites could be any other ROADM sites on the optical
layer.
A.7 Wavelength Reconfiguration in Legacy
Optical Layer is Slow
Wavelength reconfiguration is non-trivial. The presence of
amplifiers on fibers introduces a non-trivial challenge to wavelength
reconfiguration because of the complex relationship between ampli-
fiersâ€™ gain control mechanism and the wavelengths traversing the
fiber. A sudden change to the set of wavelengths, i.e., adding or re-
moving wavelengths simultaneously, could result in unpredictable
power fluctuations on each amplifier which, in turn, could lead to
packet loss/errors in the IP layer. Current device manufacturers
and backbone operators have settled on a conservative stabilization
Figure 19: Number of ROADMs that need to be reconfigured
for each fiber cut in Facebookâ€™s WAN.
Figure 21: Monthly wavelength deployment at Facebook.
Figure 20: Amplifiers take minutes to adjust power during
wavelength reconfiguration on a 2,000 km fiber path with
24 cascaded amplifier sites between Canada and US.
process with multiple observe-analyze-act control loops that takes
several minutes per amplifier. To understand the current practice,
we shadowed the process of reconfiguring four wavelengths on
a 2,000 km fiber path with 24 cascaded amplifier sites between
Canada and US in Facebook. This reconfiguration was part of an
automatic maintenance procedure. As shown in Fig. 20, it takes 14
minutes to reconfigure four wavelengths using legacy hardware
without noise loading at Facebook.
Slow wavelength reconfiguration is common in production.
Even though wavelength reconfiguration is a slow process, it is an
essential part of a production backboneâ€™s operations. Fig. 21 shows
the number of monthly deployed wavelengths from November
2019 to April 2021 in Facebook. We observe that during COVID-19,
more wavelengths were deployed since March 2020 to handle the
increase of online traffic at Facebook [85]. Arrowâ€™s fast wavelength
reconfiguration can bring advantages to wavelength deployments
as well.
A.8 IP-to-Optical Topology Mapping
As discussed in Section 6, in large-scale WANs, the IP-layer topology
tends to be denser than the optical-layer topology [65, 71]. Fig. 22
shows the CDF of number of IP links per fiber and number of
wavelengths per IP link in Facebook. We use these distributions
to guide us to generate the IP-layer topologies for B4, IBM, and
Facebook.
A.9 Prior Work Comparison
Three main techniques are used to mitigate the impact of lost ca-
pacity caused by fiber cuts: (ğ‘–) failure-aware TE; (ğ‘–ğ‘–) optical path
Figure 22: (a) CDF of number of IP links per fiber. (b) CDF of
number of wavelengths per IP link.
protection; (ğ‘–ğ‘–ğ‘–) optical restoration. Table 10 illustrates the key dif-
ferences between these approaches and Arrow.
In TE-based solutions (first row in Table 10), Port1 and Port2, as
well as Transponder1 and Transponder2, need to be pre-allocated
in the WAN to enable the TE to quickly switch traffic from the cut
fiber to the failover path. Hence, once a fiber cut occurs, the router
ports and transponders associated with the failed fiber become
unusable and sit idle until the fiber is repaired.
In OTN-based solutions (the second row in Table 10), Port1 re-
mains active during the fiber cut repair from the IP layerâ€™s per-
spective, but Transponder1 will become idle as traffic is shifted to
Transponder2. The OTN approach can save on router ports, but it
still requires an extra optical transponder to be in working state so
as to be prepared for fast failover under failures.
The third row of Table 10 presents optical restoration [30, 32, 45,
49, 52, 56, 72, 74, 82]. Instead of pre-allocating failover paths, optical
restoration techniques dynamically shift the wavelengths from the
cut fiber onto healthy surrogate fibers. These approaches do not
require pre-allocating router ports or transponders. Instead, they
leverage optical devices, such as ROADMs, to shift the wavelengths
after the fiber cut. The core idea of the optical restoration technique
was proposed two decades ago [30] and it remains a popular solu-
tion in the optics community as it does not leave router ports or
transponders idle during fiber cuts.
Arrow solves two challenges that make previously proposed
optical restoration techniques inefficient in large-scale WANs. First,
prior works do not consider the interplay between partially restorable
IP links and failure-aware traffic engineering. As a result, they may
choose sub-optimal restoration candidates. To solve this challenge
00.20.40.60.810102030CDFNumber of reconfigured ROADMs Add/drop ROADMIntermediate ROADM-20-1001011:12 AM11:18 AM11:24 AM11:30 AM11:36 AMTimeWavelength power (dBm)Provisioning initiatedExisting wavelengthsDate (year-month)2019-112019-122020-012020-022020-032020-042020-052020-062020-072020-082020-092020-102020-112020-122021-012021-022021-032021-04050100150200# of deployedwavelengthsCOVID-19Lockdown00.20.40.60.8101020304050CDFNum. of Wavelengths per IP Link00.20.40.60.8101020304050CDFNum. of IP Links per Fiber (a)(b)Approach
Failover plan
configuration
Failover
latency
Practical
Illustration
Failure-aware
Traffic
Engineering
[17, 48, 58, 63]
Optical Path
Protection
[14, 19, 59, 68,
80, 81, 84]
Optical
Restoration
[30, 32, 45, 52,
56, 72, 74, 82]
Arrow (this
paper)
Routing table
ğ‘‚(ğ‘šğ‘ )
OTN
configuration
ğ‘‚(ğ‘šğ‘ )
ROADM
configuration
10s
ğ‘šğ‘–ğ‘›ğ‘ 
Routing table,
ROADM
configuration
ğ‘‚(ğ‘ )
now,
ğ‘‚(ğ‘šğ‘ )
future
âœ“
âœ“
âœ—
âœ“
Table 10: Comparison with prior work.
Arrow augments todayâ€™s TE formulations to consider multiple par-
tial restoration candidates for optimizing IP-layer network through-
put (Â§3). Second, the failover latency of prior proposals is tens of
minutes because they require amplifiersâ€™ gains to be adjusted. Ar-
row uses a noise source to fully populate the amplifiersâ€™ spectrum to
bypass the reconfiguration time, achieving an end-to-end failover
latency of eight seconds on a WAN-scale testbed (Â§5). The last row
of Table 10 illustrates Arrowâ€™s differences from prior approaches.
A.10 Extensions
Supporting next-generation C+L optical systems. There is a
trend to expand the C-band spectrum in the optical layer to L-
band to scale the network capacity [75]. because of the efficient
abstraction of LotteryTickets, Arrowâ€™s TE is orthogonal to optical
transmission techniques. The noise loading technique in Arrowâ€™s
optical layer can smoothly support the expansion of the L band
by loading it with noise [83]. As recent advancements of L-band
tunable transponders [26] and reconfigurable WSS [36] are becom-
ing commercially available, Arrow can be easily extended to the
L-band and support future WANs.
ROADMOTN SwitchRouterTrans.1Fiber cutRouting tablePort1Port2Trans.2Primary pathFailover pathPort1 and Trans.1 are idle during fiber cut repairMUXROADMOTN SwitchTrans. 1Fiber cutPort 1Trans. 2Primary pathFailover pathOTN configRouterTrans.1 is idle during fiber cut repairMUXROADMOTN switchRouterTrans. 1Fiber cutPort 1Primary pathRestoredpathRODAM Config.No idle resources(Wavelengths are dynamically shifted during fiber cut repair)MUXNoise SourceTraffic Engineering FormulationROADMOTN switchRouterTrans. 1Fiber cutPort 1Primary pathRestoredpathRODAM Config.MUXTraffic splitting ratioRestoration     planRouting tableNo idle resources(Wavelengths are dynamically shifted during fiber cut repair)