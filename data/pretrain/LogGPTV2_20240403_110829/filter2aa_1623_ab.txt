社工等方法去获取外网系统控制权限，一般称之为“打
点”或撕口子。在这个过程中，红队专家会尝试绕过
WAF、IPS、杀毒软件等防护设备或软件，用最少的流
量、最小的动作去实现漏洞利用。
通过撕开的口子，寻找和内网联通的通道，再
进一步进行深入渗透，这个由外到内的过程一般称
之为纵向渗透，如果没有找到内外联通的DMZ区
（Demilitarized Zone，隔离区），红队专家会继续撕
口子，直到找到接入内网的点为止。
当 红 队 专 家 找 到 合 适 的 口 子 后 ， 便 可 以 把
这 个 点 作 为 从 外 网 进 入 内 网 的 根 据 地 。 通 过
frp、ewsocks、reGeorg等工具在这个点上建立隧
道，形成从外网到内网的跳板，将它作为实施内网渗
透的坚实据点。
实战攻防演习之
红队视角下的防御体系突破
5
若权限不足以建立跳板，红队专家通常会利用系
统、程序或服务漏洞进行提权操作，以获得更高权
限；若据点是非稳定的PC机，则会进行持久化操作，
保证PC机重启后，据点依然可以在线。
三、第三阶段：横向移动
进入内网后，红队专家一般会在本机以及内部网络
开展进一步信息收集和情报刺探工作。包括收集当前
计算机的网络连接、进程列表、命令执行历史记录、
数据库信息、当前用户信息、管理员登录信息、总结
密码规律、补丁更新频率等信息；同时对内网的其他
计算机或服务器的IP、主机名、开放端口、开放服务、
开放应用等情况进行情报刺探。再利用内网计算机、
服务器不及时修复漏洞、不做安全防护、同口令等弱
点来进行横向渗透扩大战果。
对于含有域的内网，红队专家会在扩大战果的同时
去寻找域管理员登录的蛛丝马迹。一旦发现某台服务
器有域管理员登录，就可以利用Mimikatz等工具去尝
试获得登录账号密码明文，或者Hashdump工具去导出
NTLM哈希，继而实现对域控服务器的渗透控制。
在内网漫游过程中，红队专家会重点关注邮件服务
器权限、OA系统权限、版本控制服务器权限、集中运
实战攻防演习之
红队视角下的防御体系突破
6
维管理平台权限、统一认证系统权限、域控权限等位
置，尝试突破核心系统权限、控制核心业务、获取核
心数据，最终完成目标突破工作。
实战攻防演习之
红队视角下的防御体系突破
7
第三章    红队也套路——常用的攻击战术
在红队的实战过程中，红队专家们逐渐摸出了一些
套路、总结了一些经验：有后台或登录入口的，会尽
量尝试通过弱口令等方式进入系统；找不到系统漏洞
时，会尝试社工钓鱼，从人开展突破；有安全防护设
备的，会尽量少用或不用扫描器，使用EXP力求一击即
中；针对蓝队防守严密的系统，会尝试从子公司或供
应链来开展工作。建立据点过程中，会用多种手段多
点潜伏，防患于未然。
下面介绍四种红队最常用的攻击战术。
一、利用弱口令获得权限
弱密码、默认密码、通用密码和已泄露密码通常是
红队专家们关注的重点。实际工作中，通过脆弱口令
获得权限的情况占据90%以上。
很多企业员工用类似zhangsan、zhangsan001
、zhangsan123、zhangsan888这种账号拼音或其简
单变形，或者123456、888888、生日、身份证后6
位、手机号后6位等做密码。导致通过信息收集后，
生成简单的密码字典进行枚举即可攻陷邮箱、OA等账
号。
实战攻防演习之
红队视角下的防御体系突破
8
还有很多员工喜欢在多个不同网站上设置同一套密
码，其密码早已经被泄露并录入到了社工库中；或者
针对未启用SSO验证的内网业务系统，均习惯使用同
一套账户密码。这导致从某一途径获取了其账户密码
后，通过凭证复用的方式可以轻而易举地登录到此员
工所使用的其他业务系统中，为打开新的攻击面提供
了便捷。
很多通用系统在安装后会设置默认管理密码，
然而有些管理员从来没有修改过密码，如admin/
admin、test/123456、admin/admin888等密码广泛
存在于内外网系统后台，一旦进入后台系统，便有很
大可能性获得服务器控制权限；同样，有很多管理员
为了管理方便，用同一套密码管理不同服务器。当一
台服务器被攻陷并窃取到密码后，进而可以扩展至多
台服务器甚至造成域控制器沦陷的风险。
二、利用社工来进入内网
计算机“从来”不会犯错误，程序怎么写，逻辑便
怎么执行；在一台计算机上怎样执行，在另外一台计
算机也同样执行。但人却会犯各种各样的错误，同一
名员工在不同情况下的同一件事情上可能会犯不同的
错误，不同的员工在同一情况的同一件事情上也可能
会犯不同错误。很多情况下，当红队专家发现搞系统
实战攻防演习之
红队视角下的防御体系突破
9
困难时，通常会把思路转到“搞人”（社工、钓鱼等）。
很多员工对接收的木马、钓鱼邮件没有防范意识。
红队专家可针对某目标员工获取邮箱权限后，再通过
此邮箱发送钓鱼邮件。大多数员工由于信任内部员工
发出的邮件，从而轻易点击了夹带在钓鱼邮件中的恶
意附件。一旦员工个人电脑沦陷，红队专家可以员工
PC作为跳板实施横向内网渗透，继而攻击目标系统或
其他系统、甚至攻击域控制器导致内网沦陷。
当然，社工不仅仅局限于使用电子邮件，通过客
服系统、聊天软件、电话等方式有时也能取得不错的
效果。像当年经典的黑客“朽木”入侵某大型互联网公
司，所采用的就是通过客服系统反馈客户端软件存在
问题无法运行，继而向客服发送了木马文件，最终木
马上线后成功控制了该公司核心系统，就是一个经典
的案例。有时，黑客会利用企业中不太懂安全的员工
来打开局面，譬如给法务人员发律师函、给人力资源
人员发简历、给销售人员发采购需求等等。 
一旦控制了相关员工计算机，便可以进一步实施
信息收集。譬如大部分员工为了日常计算机操作中的
方便，以明文的方式在桌面或“我的文档”存储了包含
系统地址以及账号密码的文档；此外大多数员工也习
惯使用浏览器的记住密码功能，浏览器记住密码功能
实战攻防演习之
红队视角下的防御体系突破
10
大部分依赖系统的API进行加密，所存储的密码是可逆
的。红队在导出保存的密码后，可以在受控机上建立
跳板，用受控员工的IP、账号、密码来登录，简直没有
比这更方便的了。
三、利用旁路攻击实施渗透
在有蓝队防守的红队工作中，有时总部的网站防
守得较为严密，红队专家很难直面硬钢，撬开进入内
网的大门。此种情况下，通常红队不会去硬攻城门，
而是会想方设法去找“下水道”，或者挖地道去迂回进
攻。
红队实战中发现，绝大部分企业的下属子公司之
间，以及下属公司与集团总部之间的内部网络均未进
行有效隔离。很多部委单位、大型央企均习惯使用单
独架设一条专用网络来打通各地区之间的内网连接，
但同时又忽视了针对此类内网的安全建设，缺乏足够
有效的网络访问控制，导致子公司、分公司一旦被突
破，红队可通过内网横向渗透直接攻击到集团总部，
漫游企业整个内网，攻击任意系统。
例如A子公司位于深圳，B子公司位于广州，而总
部位于北京。当A子公司或B子公司被突破后，都可以
毫无阻拦地进入到总部网络中来；而另外一种情况，A
实战攻防演习之
红队视角下的防御体系突破
11
与B子公司可能仅需要访问总部位于北京的业务系统，
而A与B不需要有业务上的往来，理论上应该限制A与B
之间的网络访问。但实际情况是，一条专线内网通往
全国各地，一处沦陷可以导致处处沦陷。
另外大部分企业对开放于互联网的边界设备较为
信任，如VPN系统、虚拟化桌面系统、邮件服务系统
等。考虑到此类设备通常访问内网的重要业务，为了
避免影响到员工的正常使用，企业没有在其传输通道
上增加更多的防护手段；再加上此类系统多会集成统
一登录，一旦获得了某个员工的账号密码，就可以通
过这些系统突破边界直接进入内网中来。
譬如开放在内网边界的邮件服务通常缺乏审计、
也未采用多因子认证，员工平时通过邮件传送大量内
网的敏感信息，如服务器账户密码、重点人员通讯录
等；当掌握员工账号密码后，在邮件中所获得的信
息，会给红队下一步工作提供很多方便。
四、秘密渗透与多点潜伏
红队工作一般不会大规模使用漏洞扫描器。目前
主流的WAF、IPS等防护设备都有识别漏洞扫描器的能
力，一旦发现后，可能第一时间触发报警或阻断IP。因
此信息收集和情报刺探是红队工作的基础，在数据积
实战攻防演习之
红队视角下的防御体系突破
12
累的基础上，针对性地根据特定系统、特定平台、特
定应用、特定版本，去寻找与之对应的漏洞，编写可
以绕过防护设备的EXP来实施攻击操作，可以达到一击
即中的目的。
现有的很多安全设备由于自身缺陷或安全防护能力
薄弱，基本上不具备对这种针对性攻击进行及时有效
发现和阻止攻击行为的能力。导致即便系统被入侵，
红队获取到目标资料、数据后，被攻击单位尚未感知
到入侵行为。此外由于安全人员技术能力薄弱，无法