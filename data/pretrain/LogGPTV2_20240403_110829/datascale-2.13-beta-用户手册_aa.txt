版本：2.13.0-beta
DataScale 介绍
DataScale 是一款轻量级、高性能的数据采集工具，能够帮助你实时采集、处理来自众多数据源的 数据（包括但不限于日志、指标、调用链数据等），并将数据导入炎凰数据平台（商业版或社区免费 版）—— 一款由  开发的异构大数据即时分析平台。
特点
DataScale 的目标是让你能够快速、稳定的将来自各种数据源的数据接入炎凰数据平台，通过与炎 凰数据平台功能的结合，提升数据在分析阶段的可用性和易用性。其主要特点包括：
• 提供直观的 Web UI 来管理数据管道，快速连接各种数据源，配置数据处理逻辑
• 集成多种开源数据采集器，支持丰富的开箱即用的数据源类型和完善的数据处理方法
• 提供便捷的工具来调试数据采集配置和数据处理逻辑
• 提供用户开发定制数据采集器的支持
• 提供易用的批量部署和集群管理功能
• 提供更完善的可观测性• 提供易用的批量部署和集群管理功能
• 提供更完善的可观测性
使用方式
DataScale 支持 standalone 部署和集群部署两种模式：
• 在 standalone 部署模式下，每个 DataScale 服务独立负责自身的数据采集任务的管理（手动
或使用第三方部署工具管理）和执行。
• 在集群部署模式下，DataScale 服务分为 worker 和 manager 两种。DataScale worker 负 	责执行数据采集任务，DataScale manager 负责集中管理和分配 worker 上的数据采集任务。
运行环 环境 
DataScale 目前支持的操作系统包括各种 Linux 版本、Windows 以及 macOS。
你可以通过下载安装包，在本地安装、运行 DataScale 服务。也可以使用镜像文件，在容器的环境下
运行。
版本：2.13.0-beta运行。
版本：2.13.0-beta
DataScale 基础
DataScale 服务默认工作在 standalone 模式下，可以独立管理和执行数据采集任务。其主要的功能 点包括：
• 提供 Web UI 和 Restful API 用于管理 DataScale 服务• 管理服务配置和 dataflow 配置
• 管理数据采集器的运行
• 与炎凰数据平台的集成
DataScale Web UI
DataScale 提供 Web UI 管理 DataScale 服务。通过浏览器访问 Web UI，你可以：
• 查看服务的配置和运行情况
• 管理系统设置、采集器等
• 管理群组、dataflow 配置等
	信息 
关于 DataScale Web UI 的更多介绍，参见  中的相关介绍。
DataScale Restful APIDataScale Restful API
DataScale Web UI 的功能大多通过调用 DataScale Restful API 实现，但 Restful API 也会提供 一些未在 Web UI 中提供的功能。如果你需要这些功能，可以通过直接调用 Restful API 来使用。
	信息 
关于 DataScale Restful API 的更多介绍，参见 Restful API。
DataScale 配置 
DataScale 服务的运行状态和行为取决于一系列的配置，主要包括：
•	datascale.toml配置文件，决定 DataScale 服务的运行参数• Dataflow 配置，决定 DataScale 执行的数据采集任务
datascale.toml 
datascale.toml配置文件位于 DataScale 安装目录的config/目录下，你可以通过修改该 文件改变 DataScale 服务的运行参数，其中包括：• 服务的监听端口
	• 服务的运行模式（worker 模式 or manager 模式）
	• 服务的配置数据的存储方式（配置文件 or 数据库）
	• 服务发送数据到炎凰数据平台的渠道（Kafka or 其他）
修改 datascale.toml 配置文件后，你需要重启 DataScale 服务使得新配置生效。
	信息 
关于 datascale.toml 配置文件的更多介绍，参见 配置 DataScale 服务。
Dataflow 
DataScale 最基本的功能是负责执行一批指定的数据采集任务，每个数据采集任务对应着 DataScale 中的一条数据流转通道，每个通道中都包含三个步骤：
	• 从数据源采集数据
	• 对数据进行预处理（可选）
	• 将预处理后的数据存入炎凰数据平台 
我们把数据流转通道叫做 dataflow，而数据流转通道中的每条数据，叫做 event。Dataflow 中的三个步骤对应着三种类型的组件：
	• Source 组 组件 定义采集数据的来源，可以是磁盘上的文件、接收数据的 web socket 等等	• Pipeline 组 组件 定义来自 source 组件的数据的预处理逻辑，包括字段解析、字段富化、event 	过滤等等。但如果 event 不需要任何预处理，dataflow 中也可以不使用 pipeline 组件，event 	从 source 组件直接进入到 sink 组件
	• Sink 组 组件 定义预处理后的数据的存储目的地，主要是指炎凰数据平台（其中的指定数据集）Event 进入 dataflow 后的流转路径为 Source → Pipeline（可选） → Sink。上下游组件之间可 以是多对多的对应关系，你可以通过组合多种 Source / Pipeline / Sink 组件，得到满足需要的 dataflow：信息 
关于 dataflow 配置的更多介绍，参见 配置 Dataflow。
Group
Group 用于分组管理 dataflow 配置，每一个 dataflow 都存在于一个指定的 group 下。 DataScale worker 在运行时，会根据配置中指定的其所属的一个或者多个 group，选择需要执行的 dataflow。
安装 DataScale 后，默认会存在一个 default group。因此，如果没有使用多个 group 管理 dataflow 的需求，可以将 dataflow 都存放在该 group 下。也可以创建新 group，在 group 内创建 dataflow，并在 DataScale worker 的 group 配置中加入该新创建的 group。
例如，同时属于 default 和 group_a 的 worker 会执行两个 group 中的所有 dataflow：信息
• 关于配置 DataScale worker 所属的 group，参见 Service 配置。
• 关于 group 配置的更多介绍，参见 配置 Group。
整合第三方数据采集器
DataScale 内部整合了一些开源数据采集器以支持足够丰富的数据源和完善的数据处理机制。同 时，DataScale 也提供了扩展机制，支持用户根据需要整合更多的数据采集器。这些数据采集器运行
状态的管理由 DataScale 服务负责。
目前已经整合的开源数据采集器包括：
• 
• 
• 
与炎凰数据平台的集成 
DataScale 服务可以根据你配置的 dataflow 执行数据采集任务，将采集、处理后的数据存储到炎凰 数据平台的数据集中。同时，DataScale 服务默认也会将其内部采集的一些指标数据发送至炎凰数 据平台的特定数据集，以支持对其自身的观测和管理。这些指标包括：• DataScale 服务信息，如版本、工作模式等
	• DataScale 服务运行所在主机的指标数据，如主机信息、CPU指标、内存指标等
	• DataScale 服务执行的数据采集任务的指标数据，如 source、sink 组件所处理的 event 数量 	指标等 
你可以使用炎凰数据平台中的 DataScale Monitoring 仪表板，查看 DataScale 服务的状态统计。
	信息 
文档 安装 DataScale 中包含更多关于 DataScale 服务与炎凰数据平台的集成的介绍。
版本：2.13.0-beta
DataScale 集群
当数据采集任务分布在多个主机时，可以通过部署 DataScale 集群，提高数据采集任务的管理效率。DataScale 服务集群包含两种类型的节点：
• 一个 DataScale manager，负责集中管理和分配 DataScale worker 上的数据采集任务• 多个 DataScale worker，负责接收来自 DataScale manager 的配置更新，执行数据采集任
务
配置管理
当使用 DataScale 集群时，所有配置操作（除 DataScale 服务配置之外）都通过 manager 进行，并由 manager 通过 heartbeat 机制将配置变更同步到所有的 worker，包括：
• Group 配置
• Dataflow 配置
• 自定义采集器配置
Heartbeat
当 DataScale worker 被分配给 DataScale manager 后，worker 会定时向 manager 发送 heartbeat request，并接收 heartbeat response。
一次 heartbeat 的过程是：
• Worker 向 manager 发送 heartbeat request，其中包含 worker 的版本、运行环境、所属的group 等
• Manager 收到 request 后，将该 worker 需要的最新配置在 heartbeat response 中返回
• Worker 根据 response 的内容，更新本地配置
信息
当 DataScale worker 被分配给 DataScale manager 管理，所有的配置信息都将从 manager 同步。如果 worker 的配置在本地被修改，则本地修改会在同步后丢失。
Group
连接到 DataScale manager 的每个 worker 都会指定所属的 group。当 manager 将 dataflow 配 置同步到一个 worker 时，只会选择性的同步该 worker 所属的 group 的 dataflow 配置。
信息
• 关于 group 的介绍，参见 DataScale 基础。信息
• 关于 group 的介绍，参见 DataScale 基础。
• 关于为 DataScale worker 设置所属的 group 的方法，参见 Service 配置。
版本：2.13.0-beta
开始上手
通过简单的安装、配置步骤，使用 DataScale worker 快速完成数据采集任务。
📄安装 DataScale
安装前的准备
📄配置第一个 dataflow
| 目标 |
|---|
| 🗃更多 dataflow 实 实例 |
1 个项目
版本：2.13.0-beta
安装 DataScale
安装前的准备
• 下载目标平台的 DataScale 安装包
	信息 
安装包可通过以下两种方式获得：
◦ U盘直接拷贝
◦ 在线下载(链接由炎凰数据团队提供)
• 获取你的炎凰数据平台的 GDI 地址• 获取你的炎凰数据平台的 GDI 地址
◦ 如果你使用的是 YHP（炎凰数据平台商业 业版），GDI 地址为 YHP Kafka bootstrap 	servers 的地址
◦ 如果你使用的是 鸿鹄 鸿鹄（社区免费 费版），GDI 地址为鸿鹄 Vector input 的地址
• 在炎凰数据平台中创建数据集 datascale_monitoring
	信息
◦ 创建数据集 datascale_monitoring 时，建议设置数据集的 数据保存时间 	(小时)为 168(7天)，或最大容量(MB)为 1024
◦ 数据集 datascale_monitoring 用于存储 DataScale 服务自身的指标数据◦ 如果你使用的是鸿鹄，需要在 Vector input 允许的数据集范围中加入数据集 	datascale_monitoring
• 在炎凰数据平台中安装 DataScale 监控仪表板（）• 在炎凰数据平台中安装 DataScale 监控仪表板（）
安装 DataScale
以在 Linux 平台安装 DataScale 服务为例，步骤如下：
• 将 DataScale 安装包拷贝到将要运行 DataScale 的机器，并解压安装包
$ tar zxvf datascale-X.Y.Z-x86_64-linux.tar.gz $ cd datascale/
• 运行 DataScale 服务
◦ 可以从命令行直接启动 DataScale 服务并在前台运行：
$ ./bin/datascale start
如需保持 DataScale 服务在后台运行，可以使用 nohup 命令：
# For bash 
$ nohup ./bin/datascale start 1>/dev/null 2>&1 & # For zsh 
$ nohup ./bin/datascale start 1>/dev/null 2>&1 &!◦ 也可以使用 Systemd 安装并运行 DataScale 服务（只适用于 Linux 平台）
# 将 DataScale 安装到 /opt/datascale 目录下 
$ sudo DATASCALE_INSTALL_DIR=/opt/datascale ./scripts/ install.sh 
# 启动 DataScale 服务 
$ sudo systemctl start datascale
安装完成后，Systemd 默认使用用户/组 datascale/datascale 运行 DataScale 服 务。
使用 datascale/datascale 用户/组时，可能会由于权限问题导致服务中的某些 dataflow 无法正常工作。如需修改，可在安装 DataScale 服务时设置环境变量
DATASCALE_SERVICE_USER和DATASCALE_SERVICE_GROUP，例如：# 使用用户/组 "root/root" 运行 DataScale 服务 
$ sudo DATASCALE_INSTALL_DIR=/opt/datascale 
DATASCALE_SERVICE_USER=root DATASCALE_SERVICE_GROUP=root ./scripts/install.sh 
$ sudo systemctl start datascale
信息
◦ 如果 DataScale 服务启动失败，可以查看安装目录下的 ./logs/ 目录下的日志 	文件查看导致启动失败的原因
◦ DataScale 默认使用端口 7880 和 7881 ，如果该端口已经被其他进程使用，可以 	在安装目录下的配置文件 config/datascale.toml 中修改端口设置
◦ 如果 DataScale 服务的日志中报告任何访问权限相关的错误，请检查运行 	DataScale 服务的用户权限• 访问 DataScale Web UI 配置系统
◦ 使用浏览器访问页面 http://:7880 ，其中 	为 DataScale 服务所在主机的 IP 地址或者域名
◦ 使用默认用户名 admin 和密码 changeme 登录 Web UI
◦ 完成账号设置（可选）
◦ 完成炎凰数据平台设置
信息
◦ “发送内部指标” 功能打开后，DataScale 会将服务自身的指标数据发送至炎凰数据 	平台的指定数据集中
◦ 在安装 DataScale 时，为了便于快速验证 DataScale 能够成功连接到炎凰数据平 	台，请先打开 “发送内部指标” 功能，并填入之前已经创建的 
	datascale_monitoring数据集名（待验证完成后，可再按需关闭该功能）• 打开 DataScale Monitoring 仪表板，确认当前运行的 DataScale 服务能够将指标数 	据导入到目标炎凰数据平台
关于 Instance ID
DataScale 服务第一次启动时，会自动生成一个唯一的 Instance ID，并且在被卸载之前都不再改
变。作为一个 DataScale 服务的唯一标识，即使在同一台主机上运行多个 DataScale 服务，每个 服务也会有不同的 Instance ID。
Instance ID 主要用于 DataScale 服务的管理和监控。对于一个运行中的 DataScale 服务，可以从 服务的指标数据中获得当前服务的 Instance ID，并且会和其他指标数据一样被导入到炎凰数据平
台。
卸载 载 DataScale
以在 Linux 平台卸载 DataScale 服务为例，步骤如下：
• 停止 DataScale 服务• 停止 DataScale 服务
◦ 对于直接在命令行启动的 DataScale 服务，可以使用 ps 和 kill 命令找到并终止所有 	的 DataScale 相关进程。
◦ 对于使用 Systemd 安装并运行的 DataScale 服务，执行如下命令停止并删除服务：
sudo systemctl stop datascale 
sudo systemctl disable datascale 
sudo rm /usr/lib/systemd/system/datascale.service sudo systemctl daemon-reload 
sudo systemctl reset-failed
• 删除 DataScale 的安装目录
版本：2.13.0-beta
配置第一个 dataflow
目标
配置 dataflow 监听指定的文件，一旦文件中有新的数据写入，将会被导入炎凰数据平台的指定数据集。
步骤
创建数据集
在炎凰数据平台中创建数据集 my_event_set
信息
如果你使用的是鸿鹄，需要在 Vector input 允许的数据集范围中加入数据集 my_event_set
配置 dataflow
你可以使用 DataScale Web UI 创建 dataflow，或者通过直接添加配置文件创建 dataflow。
通过 过 Web UI 配置 dataflow
• 在 default 群组中创建 dataflow my_first_dataflow
• 添加 dataflow 的 source 组件 file_source 和 sink 组件 yanhuang_sink