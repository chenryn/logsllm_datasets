垂直切分(按照功能模块) ................................................................................................................................... 220
水平切分(按照规则划分存储) ........................................................................................................................... 220
19.1.11. 两阶段提交协议 .................................................................................................................... 220
19.1.11.1. 准备阶段 ............................................................................................................................................ 221
19.1.11.2. 提交阶段 ............................................................................................................................................ 221
19.1.11.3. 缺点 .................................................................................................................................................... 221
同步阻塞问题 ...................................................................................................................................................... 221
单点故障 .............................................................................................................................................................. 221
数据不一致（脑裂问题） .................................................................................................................................. 221
二阶段无法解决的问题（数据状态不确定） .................................................................................................. 221
19.1.12. 三阶段提交协议 .................................................................................................................... 222
19.1.12.1. CanCommit阶段 .............................................................................................................................. 222
19.1.12.2. PreCommit阶段 ............................................................................................................................... 222
19.1.12.3. doCommit阶段 ................................................................................................................................. 222
19.1.13. 柔性事务 ................................................................................................................................ 222
19.1.13.1. 柔性事务 ............................................................................................................................................ 222
两阶段型 .............................................................................................................................................................. 222
补偿型 .................................................................................................................................................................. 222
异步确保型 .......................................................................................................................................................... 223
最大努力通知型（多次尝试） .......................................................................................................................... 223
19.1.14. CAP ........................................................................................................................................ 224
一致性（C）： ....................................................................................................................................................... 224
可用性（A）： ....................................................................................................................................................... 224
分区容忍性（P）： ................................................................................................................................................ 224
20. 一致性算法 ...................................................................................................................................... 225
20.1.1. Paxos ......................................................................................................................................... 225
Paxos三种角色：Proposer，Acceptor，Learners ........................................................................................... 225
Proposer： ......................................................................................................................................................... 225
Acceptor： .......................................................................................................................................................... 225
Learner： ............................................................................................................................................................ 225
Paxos算法分为两个阶段。具体如下： ............................................................................................................... 225
阶段一（准leader确定 ）： ............................................................................................................................ 225
阶段二（leader确认）： .................................................................................................................................. 225
20.1.2. Zab ............................................................................................................................................. 225
1.崩溃恢复：主要就是Leader选举过程 ......................................................................................................... 226
2.数据同步：Leader服务器与其他服务器进行数据同步 .............................................................................. 226
3.消息广播：Leader服务器将数据发送给其他服务器 .................................................................................. 226
20.1.3. Raft ............................................................................................................................................. 226
20.1.3.1. 角色 .................................................................................................................................................... 226
Leader（领导者-日志管理） ............................................................................................................................ 226
Follower（追随者-日志同步） .......................................................................................................................... 226
Candidate（候选者-负责选票） ....................................................................................................................... 226
13/04/2018 Page 14 of 283
20.1.3.2. Term（任期） ................................................................................................................................... 226
20.1.3.3. 选举（Election） .............................................................................................................................. 227
选举定时器 .......................................................................................................................................................... 227
20.1.3.4. 安全性（Safety） ............................................................................................................................. 227
20.1.3.5. raft协议和zab协议区别 ................................................................................................................. 227
20.1.4. NWR ........................................................................................................................................... 228
N：在分布式存储系统中，有多少份备份数据 ................................................................................................ 228
W：代表一次成功的更新操作要求至少有w份数据写入成功 ...................................................................... 228
R： 代表一次成功的读数据操作要求至少有R份数据成功读取 .................................................................. 228
20.1.5. Gossip ........................................................................................................................................ 228
20.1.6. 一致性Hash .............................................................................................................................. 229
20.1.6.1. 一致性Hash特性 ............................................................................................................................. 229
20.1.6.2. 一致性Hash原理 ............................................................................................................................. 229
1.建构环形hash 空间： .................................................................................................................................... 229
2.把需要缓存的内容(对象)映射到hash 空间 .................................................................................................. 229
3.把服务器(节点)映射到hash 空间 ................................................................................................................. 229
4.把对象映射到服务节点 ................................................................................................................................... 229
考察cache 的变动 ............................................................................................................................................. 230
虚拟节点 .............................................................................................................................................................. 230
21. JAVA算法 ...................................................................................................................................... 232
21.1.1. 二分查找 .................................................................................................................................... 232
21.1.2. 冒泡排序算法 ............................................................................................................................ 232
21.1.3. 插入排序算法 ............................................................................................................................ 233
21.1.4. 快速排序算法 ............................................................................................................................ 234
21.1.1. 希尔排序算法 ............................................................................................................................ 236
21.1.2. 归并排序算法 ............................................................................................................................ 237
21.1.3. 桶排序算法 ................................................................................................................................ 240
21.1.4. 基数排序算法 ............................................................................................................................ 241
21.1.5. 剪枝算法 .................................................................................................................................... 243
21.1.6. 回溯算法 .................................................................................................................................... 243
21.1.7. 最短路径算法 ............................................................................................................................ 243
21.1.8. 最大子数组算法 ........................................................................................................................ 243
21.1.9. 最长公共子序算法 .................................................................................................................... 243
21.1.10. 最小生成树算法 .................................................................................................................... 243
22. 数据结构 .......................................................................................................................................... 245
22.1.1. 栈（stack） ............................................................................................................................... 245
22.1.2. 队列（queue） ......................................................................................................................... 245
22.1.3. 链表（Link） ............................................................................................................................. 245
22.1.4. 散列表（Hash Table） ............................................................................................................ 246
22.1.5. 排序二叉树 ................................................................................................................................ 246
22.1.5.1. 插入操作 ............................................................................................................................................ 246
22.1.5.2. 删除操作 ............................................................................................................................................ 247
22.1.5.3. 查询操作 ............................................................................................................................................ 248
22.1.6. 红黑树 ........................................................................................................................................ 248
22.1.6.1. 红黑树的特性 .................................................................................................................................... 248
22.1.6.1. 左旋 .................................................................................................................................................... 248
22.1.6.1. 右旋 .................................................................................................................................................... 249
22.1.6.1. 添加 .................................................................................................................................................... 250
22.1.6.2. 删除 .................................................................................................................................................... 251
22.1.7. B-TREE ...................................................................................................................................... 252
22.1.8. 位图 ............................................................................................................................................ 254
23. 加密算法 .......................................................................................................................................... 255
23.1.1. AES ............................................................................................................................................ 255
23.1.2. RSA ............................................................................................................................................ 255
23.1.3. CRC............................................................................................................................................ 256
23.1.4. MD5 ............................................................................................................................................ 256
13/04/2018 Page 15 of 283
24. 分布式缓存 ...................................................................................................................................... 257
24.1.1. 缓存雪崩 .................................................................................................................................... 257
24.1.2. 缓存穿透 .................................................................................................................................... 257
24.1.3. 缓存预热 .................................................................................................................................... 257
24.1.4. 缓存更新 .................................................................................................................................... 257
24.1.5. 缓存降级 .................................................................................................................................... 257
25. HADOOP ........................................................................................................................................ 259
25.1.1. 概念 ............................................................................................................................................ 259
25.1.2. HDFS ......................................................................................................................................... 259
25.1.2.1. Client .................................................................................................................................................. 259
25.1.2.2. NameNode ........................................................................................................................................ 259
25.1.2.3. Secondary NameNode ................................................................................................................. 259
25.1.2.4. DataNode......................................................................................................................................... 259
25.1.3. MapReduce ............................................................................................................................... 260
25.1.3.1. Client ................................................................................................................................................. 260
25.1.3.2. JobTracker ....................................................................................................................................... 260
25.1.3.3. TaskTracker ...................................................................................................................................... 261
25.1.3.4. Task ................................................................................................................................................... 261
25.1.3.5. Reduce Task 执行过程 ................................................................................................................... 261
25.1.4. Hadoop MapReduce 作业的生命周期 ................................................................................... 262
1.作业提交与初始化........................................................................................................................................... 262
2.任务调度与监控。........................................................................................................................................... 262
3.任务运行环境准备........................................................................................................................................... 262
4.任务执行 .......................................................................................................................................................... 262
5.作业完成。 ...................................................................................................................................................... 262
26. SPARK ............................................................................................................................................ 263
26.1.1. 概念 ............................................................................................................................................ 263
26.1.2. 核心架构 .................................................................................................................................... 263
Spark Core ......................................................................................................................................................... 263
Spark SQL .......................................................................................................................................................... 263
Spark Streaming ................................................................................................................................................ 263
Mllib ..................................................................................................................................................................... 263
GraphX ................................................................................................................................................................ 263
26.1.3. 核心组件 .................................................................................................................................... 264
Cluster Manager-制整个集群，监控worker ................................................................................................. 264
Worker节点-负责控制计算节点 ....................................................................................................................... 264
Driver： 运行Application 的main()函数......................................................................................................... 264
Executor：执行器，是为某个Application运行在worker node上的一个进程 .......................................... 264
26.1.4. SPARK编程模型 ...................................................................................................................... 264
26.1.5. SPARK计算模型 ...................................................................................................................... 265
26.1.6. SPARK运行流程 ...................................................................................................................... 266
1. 构建Spark Application的运行环境，启动SparkContext .................................................................... 267
2. SparkContext向资源管理器（可以是Standalone，Mesos，Yarn）申请运行Executor资源，并启
动StandaloneExecutorbackend， .................................................................................................................. 267
3. Executor向SparkContext申请Task ..................................................................................................... 267
4. SparkContext将应用程序分发给Executor ............................................................................................ 267
5. SparkContext构建成DAG图，将DAG图分解成Stage、将Taskset发送给Task Scheduler，最
后由Task Scheduler将Task发送给Executor运行 ..................................................................................... 267
6. Task在Executor上运行，运行完释放所有资源................................................................................... 267
26.1.7. SPARK RDD流程 .................................................................................................................... 267
26.1.8. SPARK RDD ............................................................................................................................. 267
（1）RDD的创建方式........................................................................................................................................... 267
（2）RDD的两种操作算子（转换（Transformation）与行动（Action）） .............................................. 268
27. STORM ........................................................................................................................................... 269
13/04/2018 Page 16 of 283
27.1.1. 概念 ............................................................................................................................................ 269
27.1.1. 集群架构 .................................................................................................................................... 269
27.1.1.1. Nimbus（master-代码分发给Supervisor） ................................................................................ 269
27.1.1.2. Supervisor（slave-管理Worker进程的启动和终止） ............................................................... 269
27.1.1.3. Worker（具体处理组件逻辑的进程） ............................................................................................ 269
27.1.1.4. Task ................................................................................................................................................... 270
27.1.1.5. ZooKeeper ........................................................................................................................................ 270
27.1.2. 编程模型（spout->tuple->bolt） ....................................................................................... 270
27.1.2.1. Topology ............................................................................................................................................ 270
27.1.2.2. Spout.................................................................................................................................................. 270
27.1.2.3. Bolt ..................................................................................................................................................... 270
27.1.2.4. Tuple .................................................................................................................................................. 270
27.1.2.5. Stream ............................................................................................................................................... 271
27.1.3. Topology运行 ........................................................................................................................... 271
(1). Worker（进程） (2). Executor（线程） (3). Task .................................................................................. 271
27.1.3.1. Worker(1个worker进程执行的是1个topology的子集) ....................................................... 271
27.1.3.2. Executor(executor是1个被worker进程启动的单独线程) ...................................................... 271
27.1.3.3. Task(最终运行spout或bolt中代码的单元) ............................................................................... 272
27.1.4. Storm Streaming Grouping ..................................................................................................... 272
27.1.4.1. huffle Grouping ................................................................................................................................. 273
27.1.4.2. Fields Grouping ................................................................................................................................ 273
27.1.4.3. All grouping ：广播 .......................................................................................................................... 273
27.1.4.4. Global grouping ................................................................................................................................ 274
27.1.4.5. None grouping ：不分组 ................................................................................................................. 274
27.1.4.6. Direct grouping ：直接分组 指定分组 ........................................................................................... 274
28. YARN .............................................................................................................................................. 275
28.1.1. 概念 ............................................................................................................................................ 275
28.1.2. ResourceManager ................................................................................................................... 275
28.1.3. NodeManager ........................................................................................................................... 275
28.1.4. ApplicationMaster ................................................................................................................. 276