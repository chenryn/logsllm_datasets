Czech and Slovak PostgreSQL Users Group
PostgreSQL for Oracle DBA
Oracle database logo should be there... but as of this page it can't be:
...Remember that you are generally not able to use Oracle logos unless
you are specifically licensed or authorized to use them. ...
Aleš Zelený (PI:EMAIL), CSPUG, CC BY-SA
PostgreSQL
Agenda The world's most advanced
open source database.
Mind Migration
●
Some terminology
●
“Architecture”
●
Security
●
Backup and Recovery
●
High Availability / Disaster recovery
●
Other unordered stuff to consider
●
17.2.2016 PostgreSQL for Oracle DBAs 2
PostgreSQL
Purpose of these slides The world's most advanced
open source database.
Understand differences Migration guide
● ●
Commons in behavior RDBMS ranking
● ●
Displeasure prevention Feature matrix
● ●
17.2.2016 PostgreSQL for Oracle DBAs 3
PostgreSQL
Mind Migration The world's most advanced
open source database.
PostgreSQL is not an Oracle database
●
Oracle and PostgreSQL are both superb databases,
●
their relation is not like Red Hat and CentOS
Do not expect equivalents for all of the Oracle
●
RDBMS features in PostgreSQL
Don't hesitate to be impressed by PostgreSQL broad
●
range of data types
PostgreSQL has extensions
●
17.2.2016 PostgreSQL for Oracle DBAs 4
PostgreSQL
Terminology The world's most advanced
open source database.
Architecture/concepts Logical
● ●
– Cluster – Role
Yes, a cluster can simply mean a grouping of
related things, but context is everything.
– Instance Shaun M. Thomas – User
– Database – Schema
– Tablespace – Tuple
Wiki: A tuple is a finite ordered list of elements
quick browse through manuals will help and
●
don't take ages
– Architectural Fundamentals
– Documentation index
17.2.2016 PostgreSQL for Oracle DBAs 5
PostgreSQL
Oracle and DB relation The world's most advanced
open source database.
From installed software to database (simplified)
●
– Instance is software loaded into memory working
with ONE database
(12c PDB changed that rule)
Oracle SW installation Oracle SW installation
ORACLE_HOME ORACLE_HOME
/u01/app/oracle/product/11.2.0.4/db /u01/app/oracle/product/12.1.0.2/db
Oracle instance Oracle instance Oracle instance Oracle instance
ORACLE_SID ORACLE_SID ORACLE_SID ORACLE_SID
SALES EMPLOYEE DWH INWEB
Database Database Database Database
SALES EMPLOYEE DWH INWEB
17.2.2016 PostgreSQL for Oracle DBAs 6
PostgreSQL
PostgreSQL and DB relation The world's most advanced
open source database.
From installed software to database (simplified)
●
– SW installed from RPM/APT/compiled from source
PostgreSQL installation 9.4 PostgreSQL installation 9.3
POSTGRESQL_HOME POSTGRESQL_HOME
/usr/pgsql-9.4/ : /usr/pgsql-9.4/lib /usr/bin/postgres : /usr/lib64/libpq.so
PostgreSQL instance PostgreSQL instance
Running postgres process Running postgres process
PGDATA PGDATA
/var/lib/pgsql/9.4/data /var/lib/pgsql/9.4/data2
Database Database Database Database Database Database
template0 template1 postgres INWEB DWH SALES
17.2.2016 PostgreSQL for Oracle DBAs 7
Internal purpose, meta data catalog Applications databases
Internal purpose, meta data catalog Applications databases
PostgreSQL
Pg & Oracle – compared The world's most advanced
open source database.
From installed software to database (simplified)
●
PostgreSQL installation 9.4 Oracle SW installation
POSTGRESQL_HOME ORACLE_HOME
/usr/pgsql-9.4/ : /usr/pgsql-9.4/lib /u01/app/oracle/product/12.1.0.2/db
PostgreSQL instance
Oracle instance Oracle instance
Running postgres process
ORACLE_SID ORACLE_SID
PGDATA
DWH INWEB
/var/lib/pgsql/9.4/data
Database Database
template0 template1 postgres INWEB DWH SALES
DWH INWEB
17.2.2016 PostgreSQL for Oracle DBAs 8
PostgreSQL
Oracle – DB physical structureThe world's most advanced
open source database.
Oracle RAC (Real Application Clusters)
●
– Even with RAC setup, an Oracle instance serves ONE database
Multitenant pluggable databases in version 12 breaks that rule...
●
Oracle database physical components (files)
●
Host: first Host: second Host: third Host: ..nth
Instance: MYDB1 Instance: MYDB2 Instance: MYDB3 Instance: MYDB
Parameter file Control files
Redo Log Archived Logs
Data files
Password file files
Database
MYDB
UNDO TS
17.2.2016 PostgreSQL for Oracle DBAs 9
PostgreSQL
Postgres – cluster physical struThec wotrldu's mroset advanced
open source database.
Not means clustering like Oracle RAC
● Postgres uses directory (might be referred by environment variable PGDATA) traditionally
called database cluster to store all necessary data managed by Postgres instance
– Which is mandatory parameter for starting Postgres instance
– Contains configuration files, and in default setup also files for all databases residing within a
particular Postgres cluster, see documentation Database File Layout
-bash-4.3$ ps -fu postgres
database cluster
UID PID PPID C STIME TTY TIME CMD
postgres 30007 1 0 19:03 ? 00:00:00 /usr/bin/postgres -D /var/lib/pgsql/data -p 5433
Configuration files
base/ pg_stat/
global/ pg_stat_tmp/ Databases directory
pg_clog/ pg_subtrans/
postgres=# select oid, datname from
pg_hba.conf pg_tblspc/ pg_database;
-bash-4.3$ du -sh base/*
pg_ident.conf pg_twophase/ oid | datname
6.4M base/1
-------+-----------
pg_log/ PG_VERSION
6.4M base/12968
1 | template1
pg_multixact/ pg_xlog/ 6.5M base/12973
12968 | template0
pg_notify/ postgresql.conf
12973 | postgres
tree base | head -5
pg_serial/ postmaster.opts (3 rows)
base
pg_snapshots/ postmaster.pid
├── 1
│ ├── 12706
17.2.2016 PostgreSQL for Oracle DBAs 10
│ ├── 12706_fsm
│ ├── 12706_vm
PostgreSQL
Postgres – mapping to Oracle Tfhei lweorld'ss most advanced
open source database.
Postgres similar to Oracle might create archive of online logs for PITR
●
and other purposes
– Instead of “Oracle Archiver” server processes, Postgres used to call any external
command responsible for copying inactive online log to some other destination
-bash-4.3$ ps -fu postgres
database cluster
UID PID PPID C STIME TTY TIME CMD
postgres 30007 1 0 19:03 ? 00:00:00 /usr/bin/postgres -D /var/lib/pgsql/data -p 5433
Configuration files
base/ pg_stat/
global/ pg_stat_tmp/ Databases directory
pg_clog/ pg_subtrans/
postgres=# select oid, datname from
pg_hba.conPfarameter pg_tblspc/ pg_database;
pg_ident.conffile pg_twophase/ oid | datname tree base | head -5
-------+-----------
pg_log/ PG_VERSION base
1 | template1
pg_multixact/ pg_xlog/ Online Redo ├── 1 Data files
12968 | template0
│ ├── 12706
pg_notify/ postgresql.cPoanrafmeter file 12973 | postgres
│ ├── 12706_fsm
pg_serial/ postmaster.opts (3 rows)
│ ├── 12706_vm
pg_snapshots/ postmaster.pid
Control files
17.2.2016 PostgreSQL for Oracle DBAs 11
archive_command ...
documentation Password file
Archived Logs
PostgreSQL
Tablespaces and filesystems The world's most advanced
open source database.
Tablespaces might reside on different filesystem
●
– Outage prevention
– Data & storage tier life cycle management
Online active data on SSD
●
Archive data on rotating disks
●
Tablespace for temporary files – fast might be unprotected
●
storage, no data loss risk
Wiki page - File System Layouts
●
17.2.2016 PostgreSQL for Oracle DBAs 12
PostgreSQL
Where is UNDO tablespace? The world's most advanced
open source database.
Answer: inside the data files
●
Is this feature free of charge?
●
No, space maintenance (vacuum) is needed to avoid
●
table bloat.
Data change trn. Postgres manages data consistency
●
using MVCC model (Multiversion
Concurrency Control)
New data in table block
– Transaction isolation for each session
– Snapshot of data visible to each session
Before image is based on transaction number
Stored in UNDO
– Minimize locking contention
segment
– Readers never blocks writes
Undo segments – Serializable snapshot Isolation is available
Cyclic buffer
17.2.2016 PostgreSQL for Oracle DBAs 13
PostgreSQL
Online REDO ~ WAL files The world's most advanced
open source database.
Online REDOlogs are cyclic buffer in Oracle
●
– “cleaned up” by archiver process
– Static amount of redolog Groups each with one or
more members within a redolog group
– Log switch tunning
WAL – Write Ahead Log files (XLOGs)
●
– “cyclic buffer space” with only soft limit in size
– File reuse – rename already archived file
– archive_command is used called each time WAL is
switched to new file (there is no “archiver” process in
postgres)
17.2.2016 PostgreSQL for Oracle DBAs 14
PostgreSQL
WAL files The world's most advanced
open source database.
Place them on separate filesystem
●
– Up to 9.4 space requirement for XLOG filesystem
(2 + checkpoint_completion_target) *
●
checkpoint_segments + 1 or checkpoint_segments +
wal_keep_segments + 1 files. Each segment file is normally
16 MB.
– Starting with 9.5
wal_min_size (default 80MB ~ 5 xlogs) and wal_max_size
●
(default 1GB ~ 64 xlogs)
– Amount of WAL segments between automatic WAL
checkpoint (higher values ~ potentially more data for
datafiles recovery after server crash)
– Both configurations are SOFT limit only
17.2.2016 PostgreSQL for Oracle DBAs 15
PostgreSQL
Archive_mode and WAL_level The world's most advanced
open source database.
Archive_mode
●
– off, on, always (archive again on streaming replica)
wal_level
●
– minimal
Used for crash recovery only ~ Oracle noarchivelog
●
– Archive
Used for streaming replication ~ Oracle DataGuard
●
– hot_standby
Used for streaming replication with read only access to
●
replica ~ Oracle Active DataGuard
17.2.2016 PostgreSQL for Oracle DBAs 16
PostgreSQL
Memory The world's most advanced
open source database.
Oracle structure: Instance
SGA
Shared pool
Parameters relation….
Library Cache
Data buffer Redo log
cache buffer
Oracle Postgres Data Dictionary Cache
db_cache_size shared_buffers
SMON DBW0 PMON CKPT LGWR ostatní
sort_area_size work_mem,
(pga_aggregate_target) temp_buffers
log_buffer_size wal_buffers
SHARED MEMORY
maintetance_work_mem
effective_cache_size
shared buffers
●
wal buffers
Per process MEMORY ●
Postgres structure:
CLOG buffers
●
Work mem
●
Locks space
●
Maintenanace work mem
●
Other buffers
Nice description can be ●
Temp buffer
●
found at link: Catalog cache
●
PostgreSQL 9.0 Architecture ● Optimizer/executor
17.2.2016 PostgreSQL for Oracle DBAs 17
PostgreSQL
Architecture – database structuTher weorld's most advanced
open source database.
Oracle database structure (simplified)
●
Database
Logical Physical
Tablespaces
Segment Data file
Extent
Operating
Oracle block
system block
17.2.2016 PostgreSQL for Oracle DBAs 18
PostgreSQL
Architecture – database structuTher weorld's most advanced
open source database.
PostgreSQL database structure (simplified)
●
custom
Logical Physical
Cluster wide tables Tablespaces:
eg. pg_database symlinks to
physical
DB cluster PGDATA
Default directories
tablespace
pg_default → pg_global →
Tablespaces pg_tblspc/
PGDATA/base PGDATA/global
Database
DB Objects File name:
pg_class.relfilenode
table, index...
Data files
+free space map (_fsm)
8k pages +visibility map (_vm)
1GB default size limit,
subsequent files are created
automatically
17.2.2016 PostgreSQL for Oracle DBAs Operating 19
system block
PostgreSQL
Architecture – database structuTher weorld's most advanced
open source database.
PostgreSQL database structure (simplified)
●
datafile
Database I datafile
datafile
Database II datafile
Tablespace_A
Database III
DB cluster
datafile datafile datafile
datafile datafile
datafile
datafile
Default tablespace
PGDATA/base Tablespace_B
17.2.2016 PostgreSQL for Oracle DBAs 20
PostgreSQL
Architecture - connections The world's most advanced
open source database.
Oracle PostgreSQL
● ●
– Master process postgres listens for
– Process named listener is
new connections
responsible to handle new
pg_hba.conf (user/database/network
●