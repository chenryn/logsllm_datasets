In this section, we
proceed to verify whether each spam campaign is correctly grouped
together by computing the similarity of destination Web pages. Our
veriﬁcation focuses on polymorphic URLs generated using the Nov
2006 dataset. We crawled all the corresponding Web pages 5 and
applied text shingling [9] to generate 20 hash values (shingles) for
each Web page. Note that the shingling process strips common
HTML headers and tags.
Figure 11(a) shows the average (f avg) and maximum (f max)
number of Web pages covered by the most common shingle in each
campaign. For most spam campaigns, 90% of the destination Web
pages had a f avg value of larger than 0.75, meaning these pages
are at least 75% similar. The difference in content may be attributed
to random advertisements and customized user contents. The value
of f max was always 1, meaning there exists at least one identical
hash value.
Next we analyze whether the destination Web pages advertised
by different campaigns are dissimilar.
If so, for each campaign,
we expect the common shingle (i.e., f avg) to occur infrequently at
Web pages associated with other campaigns. To validate this, we
measure the ratio of this hash value occurrence within the campaign
to the occurrence across all the campaigns (see Figure 11(b)). For
most hash values, the ratio was exactly 1, indicating they occurred
5We intentionally crawled only one month’s polymorphic URLs.
This is because crawling is an intrusive process that might let spam-
mers believe certain groups of users are more vulnerable to spam
emails and thus send more spam to them in the future.
l
e
u
a
v
h
s
a
h
n
o
m
m
o
c
t
s
o
m
y
b
d
e
r
e
v
o
c
n
o
i
t
c
a
r
F
1
0.9
0.8
0.7
0.6
0.5
0.4
0.3
0.2
0.1
0 
1
average over the hash functions
maximum over the hash functions
0.5
Percent of Botnets
(a)
t
o
B
n
o
m
m
o
c
t
s
o
m
y
b
d
e
r
e
v
o
c
n
o
i
t
c
a
r
F
1
0.9
0.8
0.7
0.6
0.5
0.4
0.3
0.2
0.1
0
100
200
300
Hash values
400
500
600
(b)
Figure 11: (a) The fraction of Web pages covered by the most
common hash value in each campaign. The two curves are pre-
sented in an ascending order independently (f max is always
1). (b) The ratio of the average hash value occurrence within a
campaign to the occurrence across all campaigns.
in exactly one campaign. This validation shows that the Web pages
pointed to by each set of polymorphic URLs are similar to each
other, while pages from different campaigns are different.
7. UNDERSTANDING SPAMMING BOTNET
CHARACTERISTICS
In this section, we study the characteristics of botnets that have
been associated with the identiﬁed spam campaigns. We ﬁrst ana-
lyze their geographic distribution over the Internet and their overall
sending patterns. We then examine each spam campaign by study-
ing their individual behavior. Following this, we analyze the simi-
larity and overlap in behavior across different campaigns. Since it
has been hypothesized that botnet hosts are often used to actively
scan and infect other hosts, we correlate the botnet spamming ac-
tivities with the network scanning activities using the distributed
telescope data [7].
7.1 All Botnet Hosts: A General Perspective
We begin our analysis by examining the distribution of botnet
hosts across the Internet and their spamming patterns by treating
them as one population.
7.1.1 Distribution of Botnet IP Addresses
Figure 12(a) shows the top ﬁve ASes ranked according to the
number of unique botnet IP addresses. Notice that all ﬁve ASes
are Internet service providers which offer residential network ac-
cess. Although countries like China and Korea are often regarded
as having a large number of vulnerable home computers, interest-
ingly, we see a signiﬁcant fraction of botnet IPs in the U.S. The
latter observation suggests that botnet menace is indeed a global
phenomenon.
Figure 12(b) shows a scatter plot of the number of ASes vs. the
number of IPs for each spam campaign. We observe that botnet
IP addresses are typically spread across a large number of ASes,
with each AS on average having only a few participating hosts.
The largest spam campaign we identiﬁed had hosts that spanned
362 ASes, indicating the importance of employing a network-wide
view for botnet detection and defense.
Previous study [24] has shown that email servers set up on dy-
namic IP ranges are more likely to be zombie spam servers. Mo-
tivated by this, we compared the list of botnet IPs identiﬁed by
AutoRE to the list of dynamic IP addresses identiﬁed in [24] and
the list of Dynablock IP addresses [8].
On average, 69% of botnet IP addresses were dynamic, conﬁrm-
ing the earlier observation that dynamic IP based hosts are popular
targets for infection by botnets. Figure 12 (c) shows the CDF of
the percentage of dynamic IP addresses per campaign. Across all
three months, more than 80% of campaigns have at least half of
their hosts in the dynamic IP ranges 6. What is surprising, however,
is that the (observed) spam emails from botnets are switching away
from dynamic IP ranges to static IP addresses. In particular, the
percentage of spam campaigns that had at least 80% of dynamic
IP addresses dropped signiﬁcantly from 52% in November 2006 to
14% in June 2007. The absolute number of static IP based botnet
hosts increased from 21,010 in November 2006 to 44,790 in July
2007. This could be associated with the increased adoption of dy-
namic IP-based blacklists (e.g., Spamhaus [22]). Spammers could
query the blacklist before using an IP address to send spam emails;
thus they tend to use static IP addresses not present on the blacklist.
On the other hand, this indicates a potential opportunity to capture
and track these bots as their IP addresses remain static.
7.1.2
Spam Sending Patterns
In this section we explore the potential for detecting botnet hosts
using content independent features. To begin with, we are inter-
ested in the following question: do botnet hosts exhibit distinct
email sending patterns when analyzed individually? Taking the
standpoint of a server receiving incoming emails from other servers,
we select the following three features (collected at the SMTP proto-
col level) to describe the sending patterns of each incoming server
in our study:
(cid:129) Number of recipients per email: For modelling purposes, we
use the reciprocal of this feature, which is a number between
0 and 1. A value of one indicates that any particular email is
sent to only one recipient. A value close to zero means that
the email has a large number of recipients.
(cid:129) Connections per second: The frequency of incoming con-
(cid:129) Nonexisting recipient frequency: We track the rate of observ-
ing an invalid recipient normalized by the number of valid
emails received from the host.
nections received from the host (log scale).
We use the Number of recipients per email and Connections per
second features because they reﬂect the aggressiveness of a spam-
mer. The nonexisting recipient frequency feature roughly provides
a measure on the amount of trafﬁc destined to invalid email ad-
dresses, indicating whether spammers are scanning the email ad-
dress space, trying to obtain valid email addresses. We map each
of the above features to a coordinate system and represent each
record as a point in a three-dimensional space. We found that both
the sending patterns of the identiﬁed botnet hosts and other hosts
are well spread in the space. In other words, when viewed individ-
ually, botnet hosts do not exhibit distinct sending patterns for them
to be identiﬁed.
7.2 Per Campaign: An Individual Perspective
Here, we study individual botnet-based spam campaigns identi-
ﬁed by AutoRE and examine whether botnet hosts within one cam-
paign exhibit varied behavior.
7.2.1
Similarity of Email Properties
As a ﬁrst step, we analyze the content similarity of botnet emails.
For each email that matches a given signature, we shingle its con-
tents. Figure 13 (a) shows the percentage of emails that share the
6For each spam campaign, given its activity burstiness, the likeli-
hood of a host changing from one dynamic IP to another is small.
In our analysis, a majority of the dynamic IP ranges contained only
one botnet IP address.
AS description
AS
Number
Number 
of bot IPs
Korea Telecom
4766
15757
Verizon Internet service
19262
11426
France Telecom
China 169-backbone
Chinanet-backbone
3215
4837
4134
11303
9960
8113
1400
1200
1000
800
600
400
200
s
e
s
s
e
r
d
d
a
P
I
t
c
n
i
t
s
d
i
f
o
r
e
b
m
u
N
0
0
Nov 2006
June 2007
July 2007
1
0.8
0.6
0.4
0.2
i
s
n
g
a
p
m
a
C
f
o
n
o
i
t
c
a
r
F
.
u
m
u
C
400
0
0
20
80
Percentage of dynamic IPs (%)
40
60
100
100
200
Number of distinct ASes
300
(a)
(b)
(c)
Figure 12: (a) Top ﬁve ASes that account for most botnet IPs (identiﬁed by AutoRE). (b) Number of ASes vs. number of IP addresses
in each spam campaign. (c) Cumulative fraction of spam campaigns using dynamic IPs.
l
i
s
e
g
n
h
s
l
a
c
i
t
n
e
d
i
k
t
s
a
e
l
t
a
h
t
i
w
s
l
i
a
m
e
f
o
%
1
0.8
0.6
0.4
0.2
0
0
0.2
k=20
k=15
k=10
k=5
k=2
k=1
1
0.8
0.6
0.4
0.2
% of outliers
Nov 2006, CU
Nov 2006, RE
June 2007, CU
June 2007, RE
 15%
59%
69%
74%
44%
8%
6%
2.5%
9%
6%
4%