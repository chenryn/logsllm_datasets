```
1.  告警收集
    将各个来源的告警事件过滤并收集到一个时序告警库里，同时格式化不同的告警。告警事件的模式可能不相同，所以需要设计合适的字段，使告警中大部分有效信息可以映射进告警系统中来，这对后续分析十分重要。
2.  告警降噪
其目的是移除不合法的告警或不重要的告警。告警的合法性可以简单地根据规则制定。告警的重要性需要综合考虑很多因素：
1)  考虑一些特殊属性的权重，例如“告警等级”这一属性直接就可以作为重要性筛选条件。
2)  用熵权法来定义告警的重要程度。告警中一些不重要的属性往往呈现为高熵的状态，即取值混乱，无法凸显其重要性，这类属性的权重应该较小，同时一些低熵的属性权重应该较大，对重要性的贡献度应该更高。
3)  考虑空间熵、时间熵和拓扑熵。空间熵低的告警指在任何时候都频繁发生的告警；时间熵低的告警指固定某一时间点或某一频率发生的告警；拓扑熵低的告警指在某一拓扑情形下固定发生的告警。此类告警都是运维人员不应该过多关注的告警，且在实际生产环境中对故障解决的帮助往往也不大。
```{=html}
```
3.  告警聚合
其目的是将多个告警根据某些相关联系聚合到一起，使运维人员可以批量处理告警。告警聚合有很多不同的聚合思路，例如时序关系聚类、关联关系聚类、拓扑关系聚类、文本聚类等等。实践中应根据不同的应用场景进行选择。
2.  告警聚类分类
```{=html}
```
1.  时序关系聚类
根据时序关系聚类是一种比较直觉的思路，指将发生在同一时间段的告警聚合在一起。然而，如果把所有同时间段的告警都聚合在一起，其聚出的类并没有什么可解释性，在处理告警时依然很复杂。如果只是聚合同时间段的相同告警，其压缩又比较低。所以，依据时间聚合只是作为告警聚合的一种预处理方式。
2.  关联关系聚类
类似于异常事件的关联分析，关联关系挖掘的算法同样适用于告警事件关联规则的挖掘。挖掘时，使用连续的时间窗口将历史告警划分为项集，在一个窗口内同时出现的次数超过支持度的告警集被称为频繁项集，再根据置信度筛选出频繁项集之间的强规则。具有关联关系的告警，在实际场景中，可以被认为是同源的告警，因此能够被归并到一起。
3.  拓扑关系聚类
如果系统的拓扑结构是已知的，也可以考虑设备之间的拓扑关系来挖掘告警的触发模式，主要有以下应用。
-   告警抑制：在高优先级告警发生时，抑制低优先级的告警；
-   告警泛化：用告警的超累来代替该告警；
-   告警特化：用告警的特定子集来代替该告警。
另外，根据拓扑图可以计算每个节点的入度和出度，进而得到节点的重要程度。例如，连接很多其他设备的核心设备出故障时，其告警的重要程度就会更高一点。
4.  文本聚类
在实际的生产环境中，不是每个告警源的告警系统都是非常完善的。在多数情境下，一条告警中大部分属性的信息量都很少，没有做聚类的意义，而真实有效的信息一般仅储存在告警文本中。
因此，在实践中文本聚类是告警收敛的一个关键方式。与一般的文本相比，告警文本具有一些独特的特征，在设计告警文本聚类算法时需要做出一些改变：
第一，告警文本一般较短，且比较规范，所以文本的顺序对效果的影响不大，可以选择无序的文本聚类模型；
第二，告警文本的词汇专业性较强，在分词时需要考虑业务专业词汇；
第三，告警文本中存在大量有意义的参数文本，而参数在词嵌入时的意义和普通词汇的意义是不同的。
因此，在进行文本聚类之前，对每个参数做优先处理也是非常必要的一个步骤。
3.  选用方案
由于不同设备厂商之间事件格式的不统一,在告警进行关联分析之前需要对事件进行规范化,将格式统一。在对告警格式进行格式统一后,就可以针对告警进行关联分析,以分析告警事件的根源、影响范围等，告警数量庞杂存在大量重复的事件,因此在对告警事件做进一步分析之前,首先需要对告警事件进行聚合。实际对告警事件的聚合主要分为两类:
1）对于不断重复出现的单条事件按照时间进行聚合记录事件发生的次数,并记录第一次和最后一次该事件产生的时间,作为事件的开始时间和结束时间。
2)对于一组相关联的事件,根据两个事件之间的间隔时间进行
![cruxee-overview-map](media/image45.jpeg){width="5.763888888888889in"
height="2.448611111111111in"}
图 20 告警归并示意图
告警事件的影响分析实际就是与规则进行相匹配的过程。影响分析算法的具体步骤为:
首先,根据网络拓扑结构和业务拓扑结构,生成设备与业务的影响关系树。N1设备的告警可能是引起N2,N3,N4等设备的告警。托扑结构中的每个可能的告警设备,都用一个故障树描述其故障关联。最终,所有的故障都可以汇聚到引起业务系统的故障。在影响关系树上,定义两种关联关系连接关系和包含关系,连接关系一般指这个设备与另一个设备之间有连接。包含关系一般指一个资源在另个资源上运行。其次,针对单个资源,将其告警事件与规则库中定义的各种规则进行匹配,形成该资源的关联关键事件。最后,根据影响关系树,分析设备的事件可能造成的影响范围和影响程度,完成告警事件的影响分析,并根据其影响范围和影响程度的大小,定义该事件的紧急程度,并将影响范围内与其相关联的事件进行连接、归并。
![图片%201.png](media/image46.png){width="4.925in" height="3.78125in"}
图 21 告警归并流程图
-   处理流程
新增告警后，判断告警是否为已有设备历史告警，如果不是则设置为新的告警，如果是则逐条与历史告警进行机器学习相似度计算，对新告警则关联已有告警数据并行判断，如果相似度较高则合并为历史告警，如果相似度较低则建立新的告警类别。告警降噪系统主要包括以下几个部分：
1）规则维护:提供对事件规则库中的各类型规则的维护功能。
2）事件接收器:负责接收网络中各类资源生产的原始事件,并上报事件生成
3）标准化:根据基础采集器上报的运行数据,按照预先配置的阀值规则,生成标准格式的事件;对接收到的原始事件进行规范化,统一格式。
4）事件关联分析:根据资源库中的拓扑关系和规则库中的规则,对由事件生成/标准化生成的标准事件进行关联分析。
电力信息系统所产生的网络安全设备告警日志不仅数据量大，也难以通过人工进行梳理告警原因，可以选择部分时间段告警事件数据进行训练，尝试进行告警合并，验证告警降噪系统的检测效果。
结合指标异常检测提炼出完整的检测告警模型如下：
![](media/image47.png){width="6.913194444444445in"
height="2.8270833333333334in"}
图 22 检测告警模型图
通过智能运维算法根据历史指标的周期性规律训练出模型预测上下限值，根据阀值告警/3sigma告警/缓慢统计告警/同比告警等对比模式，触发精准告警并给出故障分析数据。
-   **告警等级设定**
根据箱线图检测原理：设实际值为value，算法计算得出的上界值为upper_bound，下界值为lower_bound。当value\>lower_bound并且value\upper_bound时，按以下***溢出模型***设定告警。
设：N = $\frac{value - upper\_ bound}{upper\_ bound}$
\*其中，N为实际值超出上界值系数（百分比）N \> 0 & N ≤
0.5处于正常范围。0.5为默认值，可自定义修改。
1.  每超出AI上界值upper_bound
    0.5倍，异常等级上升一级。本系统告警最高等级为4级。即：
```{=html}
```
1.  N \> 0.5 & N ≤ 1，一级告警；
2.  N \> 1 & N ≤ 1.5，二级告警；
3.  N \> 1.5 & N ≤ 2，三级告警；
4.  N \> 2 & N ≤ 2.5，四级告警。
当value\ 0 & N ≤
0.2处于正常范围。0.2为默认值，可自定义修改。
2.  每超出AI下界值lower_bound
    0.2倍，异常等级上升一级。本系统告警最高等级为4级。即：
（1）N \> 0.4 & N ≤ 0.6，一级告警；
（2）N \> 0.6 & N ≤ 0.8，二级告警；
（3）N \> 1 & N ≤ 1.2，三级告警；
（4）N \> 1.2 & N ≤ 1.4，四级告警。
AI告警结果展示：
![](media/image48.png){width="6.199305555555555in"
height="2.5277777777777777in"}
图 23 AI告警结果：进程健康度展示图
# 实施路径
## 5.1总体架构设计 {#总体架构设计 .list-paragraph}
智能化运维平台建设思路是：按照智能化运维服务管理理论、方法和标准，结合中心实际和建设需要，遵循立足需求、统一规划、保障重点、分步实施、务求实效的原则，建立一套融合组织、制度、流程、人员、技术的智能化运维平台，建立组织机构，制定规章制度，规范管理流程，明确职责分工，强化技术支撑，实现对网络及信息系统的综合管理监控和日常技术支持，快速响应和及时解决信息系统运行过程中出现的各种问题和故障，确保集团网络及信息系统正常、稳定、高效运行。
### 总体设计包含要素
-   运维技术要素运用