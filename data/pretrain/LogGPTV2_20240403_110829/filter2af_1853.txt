# 区块链安全入门笔记（六） | 慢雾科普

##### 译文声明
本文为翻译文章，具体内容和含义请以原文为准。

随着越来越多的人涌入区块链行业，虽然为该行业注入了新的活力，但由于相关知识的薄弱及安全意识的缺乏，也给攻击者带来了更多的机会。面对频繁爆发的安全事件，慢雾特推出区块链安全入门笔记系列，旨在向大家介绍与区块链安全相关的术语，帮助新手更快适应这个充满挑战的安全攻防世界。

## 智能合约 Smart Contract

智能合约并不是一个新概念，早在1995年就由跨领域法律学者Nick Szabo提出：智能合约是一套以数字形式定义的承诺（Promises），包括参与者可以在其上执行这些承诺的协议。在区块链领域中，智能合约本质上是在区块链网络中运行的一段代码，它通过计算机指令实现了传统合约的自动化处理，并完成用户赋予的业务逻辑。

随着区块链智能合约数量的不断增加，随之暴露出来的安全问题也日益增多。攻击者经常利用漏洞入侵系统，对智能合约用户造成巨大损失。根据SlowMist Hacked的统计，截至当前，在ETH、EOS和TRON三条链上因智能合约被攻击而导致的损失高达1.268亿美元。具有相同特征的攻击手法呈现出多次成功且跨公链的趋势。接下来，我们将为大家介绍近年来一些常见的智能合约攻击手段。

## 交易回滚攻击 Roll Back Attack

交易回滚攻击是指能够将已经发生的交易状态恢复到未发生时的状态。具体而言，即攻击者原本已经进行了支付操作，但通过某些手段使转账流程出错，从而回滚整个交易过程。这种攻击手法在区块链上的智能合约游戏中尤为常见。当用户的下注动作和合约的开奖动作发生在同一个交易内时，攻击者可以通过检测智能合约的某些状态来获取开奖信息，并根据此信息选择是否回滚下注交易。

早期，这种攻击手法主要针对EOS DApp，后来逐渐蔓延至波场等其他公链。截至目前，已有12个DApp遭遇此类攻击。慢雾安全团队建议开发者不要将用户的下注与开奖放在同一个交易内，以防攻击者通过检测智能合约中的开奖状态实现交易回滚攻击。

## 交易排挤攻击 Transaction Congestion Attack

交易排挤攻击是针对使用`defer`进行开奖的游戏合约的一种攻击手法。攻击者可以通过发送大量`defer`交易，恶意占用区块内的CPU资源，导致智能合约中本应在指定区块内执行的`defer`开奖交易因资源不足而无法执行，只能推迟到下一个区块。由于许多EOS游戏智能合约使用区块信息作为随机数源，同一笔`defer`开奖交易在不同区块内的执行结果会有所不同。因此，攻击者在得知无法中奖时，可以通过发送大量`defer`交易强制智能合约重新开奖，从而达到攻击目的。

这种攻击手法最早出现在黑客loveforlover对EOS.WIN发起的攻击中，随后类似的攻击手法多次得手。根据SlowMist Hacked的统计，仅2019年就有22个竞猜类DApp因此遭受重大损失。慢雾安全团队建议智能合约开发者避免在不同区块内执行结果不同的关键操作采用`defer`交易的方式，以降低合约被攻击的风险。

## 随机数攻击 Random Number Attack

随机数攻击是指针对智能合约的随机数生成算法进行攻击，预测智能合约的随机数。目前，许多区块链游戏采用链上信息（如区块时间、未来区块哈希等）作为随机数种子。使用这种随机数种子生成的随机数被称为伪随机数。伪随机数并非真正的随机数，存在被预测的可能性。一旦攻击者猜测或通过逆向工程等方式获得了随机数生成算法，就可以预测即将出现的随机数，从而达到攻击目的。

2018年11月11日，攻击者对EOS.WIN发起了连续随机数攻击，共获利2万枚EOS。在此，慢雾安全团队建议智能合约开发者使用安全的随机数源，例如通过链下生成随机数并上传至链上的方式，以降低合约被攻击的风险。