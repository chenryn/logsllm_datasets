### 第3章：CPU异常机制的详细讨论

在第3章中，我们将深入探讨CPU的异常处理机制。

### 系统管理模式（SMM）

系统管理模式（System Management Mode, SMM）用于执行系统管理功能，如电源管理、硬件控制或运行OEM设计的与平台相关的固件程序。值得注意的是，英特尔最早在386 SL处理器中引入了SMM支持，但直到486 DX处理器开始，SMM才成为所有IA-32架构处理器的标准特性。

### 老雷评点

1993年，老雷与几位同学在上海华山路合购了一台装有80486处理器的台式机，并花费100元将其运回闵行校区。该计算机总价超过9000元人民币。

### 2.2.3 奔腾处理器

自1993年起，Pentium（奔腾）处理器陆续推出，标志着IA-32处理器的新一轮变革。奔腾处理器不仅放弃了80386、80486等命名惯例，还在结构和性能上实现了重大突破，尤其是引入了第二条执行流水线，支持指令级并行执行（Instruction Level Parallelism, ILP）。这种机制提高了处理器资源的利用率，在主频不变的情况下显著提升了执行能力。后续的IA-32处理器延续了这一设计理念。

早期的奔腾处理器与后来的产品（不包括Pentium Pro、Pentium II和Pentium III）在内部特征上存在较大差异。根据内核代号，这些奔腾处理器可分为P5、P54C和P55C三类。

#### P5内核奔腾处理器

P5内核奔腾处理器（主要型号为P60和P66）引入了以下新特性：
- **数据总线宽度**：从32位增加到64位，一次可读取8个字节的数据。
- **双执行流水线**：允许同时解码和执行两条指令，每个时钟周期最多可执行两条指令，被称为超标量（Superscalar）架构。
- **分支预测**：首次引入分支预测功能，以提高流水线利用率。
- **一级缓存**：增加至16KB，其中8KB用于数据，8KB用于代码。
- **大页面内存支持**：支持4MB的大页面内存。
- **性能监视**：引入性能监视计数器、时间戳计数器（TSC）及RDTSC指令。
- **错误检测**：引入机器检查架构（Machine Check Architecture, MCA）。
- **调试支持**：引入JTAG调试支持。
- **多处理器支持**：支持双或多处理器配置。

#### P54C内核奔腾处理器

1994年开始推出的P54C内核奔腾处理器（如P75、P90、P100、P120、P133、P150、P166和P200）的最大变化是加入了本地高级可编程中断控制器（Local APIC），负责接收和处理各种中断源，并在多处理器系统中通过APIC串行总线与其他处理器通信。

#### P55C内核奔腾处理器

1996年10月推出的P55C内核奔腾处理器（Intel Pentium with MMX Technology，奔腾MMX）进一步增强了以下特性：
- **MMX技术**：通过SIMD方式提高多媒体处理性能。
- **一级缓存**：数据和代码各16KB。
- **优化单元**：改进了分支预测单元和指令解码器。
- **MSR寄存器**：引入模型特定寄存器（MSR）及其访问指令RDMSR和WRMSR。

### 2.2.4 P6系列处理器

1995年11月推出的Pentium Pro处理器作为P6系列的第一款产品，引入了许多重要特性，包括微操作（Micro-ops）技术，将x86指令翻译成等长的微操作后再执行，从而提高执行效率。此外，Pentium Pro还引入了以下新特性：
- **二级缓存**：首次在内部集成256KB或1MB的二级缓存。
- **地址总线宽度**：从32位增加到36位，支持PAE-36模式。
- **3路超标量微架构**：实现乱序执行和寄存器重命名。
- **投机执行**：基于分支预测的投机取指和执行。
- **MTRR**：引入内存类型范围寄存器（Memory Type and Range Register）。

1997年5月推出的Pentium II处理器（代号Klamath）将二级缓存移到外部电路板上，并重新加入MMX支持。随后，英特尔将P6处理器分为三个产品线：Pentium II、Xeon和Celeron。

1999年2月推出的Pentium III处理器引入了SSE指令集和FXSAVE/FXRSTOR指令。2003年3月推出的Pentium M处理器专为移动平台设计，具有低功耗特性。2006年推出的Intel Core Duo处理器则将两个CPU内核集成在一个物理处理器中。

### 2.2.5 奔腾4处理器

2000年开始推出的奔腾4处理器采用了NetBurst超流水线微架构，主要特征包括：
- **流水线级数**：从P6的10级增加到20级（Prescott增至31级）。
- **超线程**：在同一块CPU芯片内实现两个逻辑处理器的功能。
- **分支踪迹存储**：增强分支、中断和异常记录功能。
- **SSE指令集**：引入SSE2和SSE3指令。
- **性能计数器**：从2个增加到18个。
- **温度监控**：集成温度传感器，当温度过高时触发PROCHOT#信号。
- **EM64T技术**：支持64位计算。

### 2.2.6 Core 2系列处理器

2006年7月27日推出的Core 2系列处理器基于第八代x86架构，典型产品包括双核Core 2 Duo和四核Core 2 Quad CPU。主要特征如下：
- **动态执行**：每个时钟周期最多可执行4条指令。
- **宏融合**：将某些常见x86指令合并成一条微操作执行。
- **低功耗设计**：继承并增强了Pentium M的低功耗特性。
- **智能内存访问**：引入Memory Disambiguation机制和基于IP指针的缓存预取机制。

### 2.2.7 Nehalem微架构

2008年11月推出的Nehalem微架构首款产品为Core i7处理器。主要新特性包括：
- **分支预测**：增加二级分支目标缓冲区。
- **虚拟化技术**：支持扩展页表。
- **SSE指令集**：支持SSE4.2。
- **内存控制器**：将内存控制器集成到CPU中。
- **系统接口**：引入QuickPath互联技术，取代前端总线。
- **生产工艺**：首次使用high-k材料。

### 2.2.8 Sandy Bridge微架构

2011年1月推出的Sandy Bridge微架构第二代Core i7处理器，同时推出了i5和i3产品。主要特征包括：
- **SIMD能力**：引入AVX技术，进一步增强SIMD能力。

以上是对各个处理器系列的主要特性和发展的简要概述。希望这些信息对你有所帮助。