们将在第3章中详细讨论CPU的异常机制。
系统管理模式（System Management Mode，SMM），用于执行系
统管理功能，如电源管理、硬件控制或执行OEM设计的与平台相
关的固件程序（firmware）。需要说明的是，最先引入SMM支持的
英特尔CPU是386 SL，但是从486 DX开始SMM才被加入到所有IA-
32处理器中，成为IA-32架构的特征。
老雷评点
老雷于1993年与几位同学合购一台式机于上海之华山路，又
花100元车费运回闵行校区。其处理器即80486，总价9000余元。
2.2.3 奔腾处理器
从1993年开始，Pentium（奔腾）处理器陆续推出。奔腾处理器可
以说是IA-32处理器新一轮变革的开始，不但从名字上不再沿用80386、
80486这一惯例，而且从结构和性能上也有很大的突破。最重要的一点
就是引入第二条执行流水线，支持指令级的并行执行（instruction level
parallelism）。指令级的并行机制有助于更充分地利用处理器资源，在
主频保持不变的情况下大幅提升处理器的执行能力。奔腾以后的IA-32
处理器都延续了这一思想。或许是因为新一轮革新的开始，最早推出的
奔腾处理器和后来推出的奔腾处理器（不是指Pentium Pro和
PentiumⅡ、PentiumⅢ）除了主频上的差异外，其内部特征也有较大差
异。人们通常根据内核代号将这些不同特征的奔腾处理器分为P5、
P54C和P55C这三类。最早推出的P5内核奔腾处理器（主要有P60和
P66）引入的新特性主要如下。
数据总线的宽度从32位增加到64位，一次便可以从内存读取8个字
节的数据。
加入第二条执行流水线（execution pipeline），允许同时有两条指
令在解码和执行，因此每个时钟周期最多可以执行的指令数由以前
的一条提升为两条，该特征又被称为超标量（superscalar）架构。
因为指令间的相互依赖性，所以很多时候必须等待前面的指令执行
完毕，才能执行后面的指令，也就是两条流水线并不是总能同时在
使用。为了提高每条流水线的利用率，奔腾处理器第一次引入了分
支预测功能，即预测最可能的分支并提早解码和执行可能的分支。
内部（一级）高速缓存增加为16KB，其中8KB用于数据，8KB用于
代码。这也是第一次将数据高速缓存和代码高速缓存分开。
支持4MB的大页面内存，即除了4KB的内存页，还可以创建4MB的
大页面。
引入性能监视机制，可以监视内部事件（计数）和流水线的执行情
况。性能监视机制包括性能监视计数器、TSC（Time Stamp
Counter）寄存器和读取TSC寄存器的RDTSC指令等，我们将在第5
章（见5.3节）详细讨论。
引入内部错误探测功能，即机器检查架构（Machine Check
Architecture，MCA），包括BIST（Built In Self Test）和机器检查
异常等（见第6章）。
引入JTAG调试（IEEE 1149.1）支持（见第7章）。
双（多）处理器支持。
于1994年开始推出的P54C内核奔腾处理器（如P75、P90、P100、
P120、P133、P150、P166和P200）的一个最大的变化就是在处理器内
部加入了APIC，称为本地APIC（Local APIC）。APIC是Advanced
Programmable Interrupt Controller的缩写，即高级可编程中断控制器。本
地APIC除了负责接收来自处理器的中断管脚、内部中断源（比如内部
的温度传感器、性能计数器和APIC时钟）和外部IO APIC的中断，在多
处理器系统中还负责通过APIC串行总线（3根线组成）与其他处理器进
行通信。IO APIC是芯片组的一部分（通常集成在南桥内），负责接收
所有外部硬件中断，并翻译成消息发给处理中断的处理器。
于1996年10月推出的带有MMX（MultiMedia eXtensions）功能的奔
腾处理器（Intel Pentium with MMX Technology，奔腾MMX）使用的是
P55C内核，奔腾MMX在以下几方面做了增强。
支持MMX（MultiMedia eXtensions）技术，即通过单一指令处理多
个数据（Single Instruction Multiple Data，SIMD）的方式提高并行
运算能力，尤其是多媒体处理方面的性能。
一级高速缓存加倍（数据和代码各16KB）。
优化了分支预测单元和指令解码器。
引入了MSR（Model Specific Register）寄存器和访问MSR寄存器的
两条指令RDMSR及WRMSR，详见2.4节关于寄存器的介绍。
2.2.4 P6系列处理器
从1995年开始，英特尔相继推出了P6系列中的各款处理器。于1995
年11月推出的Pentium Pro处理器作为P6系列的第一款处理器引入了很多
此前x86处理器没有的重要属性。最值得一提的就是引入了类似RISC指
令的微操作（micro-ops）：将原本的x86指令先翻译成等长的微操作后
再执行。这一革命性的变化带来很多好处，包括更有利于提高执行效率
和更适合多流水线执行等，其后的IA-32处理器都保持了这一特征。此
外，Pentium Pro处理器还引入了如下新特性。
首次在内部集成二级高速缓存（256KB或1MB）。
地址总线的宽度从32位增加到36位，从而可以最多寻址64GB物理
内存。这个特征又被称为PAE-36模式，即Physical Address
Extension 36-bit。
3路超标量微架构（3-way Superscalar Micro-Architecture），是指将
指令执行任务划分为3个相对独立的单元——取指/解码单元、分发/
执行单元和回收单元。解码单元的3个并行解码器首先将x86指令翻
译（分解）为等长的微操作，然后将微操作送入RAT（Register
Alias Table ）单元对寄存器重命名（register renaming），目的是将
原本使用同一个寄存器的多条指令通过寄存器重命名令它们使用不
同的别名寄存器，以消除依赖性。接下来，再为每个微操作加上状
态信息后将它们放入指令池（instruction pool）。指令池又被称为
ROB（Re-Order Buffer）。分发单元的Reservation Station负责监视
ROB，将ROB中已经就绪（操作数齐备）的微操作通过5个端口之
一分配给执行单元去执行。因为ROB中的微操作只要状态就绪就可
以执行，所以指令的执行顺序和程序中的先后顺序可能是不一致
的，故这种执行方式被称为乱序执行（out of order execution）。回
收单元（Retire Unit）负责监视ROB中的微操作并将执行完毕的微
操作按照程序本来的顺序从ROB中移除。每次回收的结果会被写入
Retirement Register File（RRF）。每个时钟周期，回收单元最多可
以回收两条微操作。
投机取指/投机执行（speculative prefetch/speculative execution），
即根据分支预测（branch prediction）得出的预测结果在没有执行到
分支语句处就预先对最可能的分支进行取指和执行。这种投机式的
做法可以减少执行流水线的空闲，还可以进一步提高乱序执行的效
率。
去除了MMX支持（Pentium II又恢复）。
引入了内存类型范围寄存器（Memory Type and Range Register，
MTRR）。MTRR用以标识某一段内存区（物理内存空间）的内存
特征，比如只读、可写、是否应该高速缓存等。它共定义了5种内
存类型：分别是Uncacheable，简称UC，例如映射到内存空间中的
外部设备上的存储器；Write-Combining，简称WC，例如显存；
Write-Through，简称WT；Write-Protect，简称WP，例如复制到内
存中的原本存储在ROM中的BIOS代码；Write-Back，简称WB，例
如系统中的正常内存（RAM）。
于1997年5月推出的PentiumⅡ处理器（代号Klamath）的一大变化
是将Pentium Pro集成到芯片内的二级缓存移到芯片外的一块特制的电路
板（称为Single Edge Contact Cartridge——SECC）上。从架构上看，
PentiumⅡ与Pentium Pro的变化不大。
重新加入由Pentium引入但被Pentium Pro去掉了的MMX支持。
数据和指令高速缓存都从16KB提高到32KB。
增加了快速系统调用和返回（Fast System Call/Return）指令（见8.3
节）。
在奔腾Ⅱ处理器推出后不久，英特尔便将P6处理器划分为3个产品
线：针对中高端台式机市场的Pentium II处理器；面向工作站和服务器
市场的至强（Xeon）处理器；面向低端台式机市场的赛扬（Celeron）
处理器。这种模式一直延续至今。
于1999年2月推出的奔腾III处理器引入了以下新特征。
单指令多数据扩展（Streaming SIMD Extensions，SSE）。除了加
入70条新的指令，还引入8个128位的数据寄存器（XMM[7:0]），
可以对单精度浮点数进行SIMD运算。
增加了FXSAVE和FXRSTOR指令，可以把浮点运算单元（Floating
Point Unit，FPU）和SSE寄存器的数据保存到内存或从内存中恢复
回来。
于2003年3月推出的Pentium M处理器是专门为笔记本电脑等移动平
台（mobile platform）设计的，具有非常好的低功耗特征。于2006年推
出的Intel Core Duo处理器将两个CPU内核集成在一个物理处理器中。从
CPU架构和指令集的角度来看，这两种处理器仍是基于P6架构的。
2.2.5 奔腾4处理器
于2000年开始陆续推出的奔腾4处理器采用了与P6差异很大的被称
为NetBurst的超流水线微架构（Hyper-pipelines Micro-architecture），对
处理器内核进行了完全的重新设计。其主要特征如下。
流水线的级（stage）数由P6处理器的10级增加到20级（奔腾4
Prescott增为31级）。
超线程（Hyper-Threading，HT），即在一块CPU芯片内实现两个
处理器（被称为逻辑处理器）的功能，使两个线程可以同时执行。
加入了分支踪迹存储（Branch Trace Store，BTS）功能，使分支、
中断和异常记录功能更强大。
加入了SSE2指令（奔腾4 Prescott加入了SSE3指令）。
性能计数器从P6的两个增加到18个。
温度监控功能，当集成的温度传感器检测到内部温度超过跳变点
（trip point）时，会设置PROCHOT#信号通知温控电路（thermal
monitor circuit）。
P4的6xx系列和支持超线程的Extreme版本引入了EM64T（Extended
Memory 64 Technology）技术，通过IA-32e模式支持64位计算，IA-
32e的正式名字叫Intel 64位架构。
老雷评点
P4之内部设计（称为微架构）有火球（fireball）之称，英特
尔曾宣称此微架构允许的时钟频率最高可以达10GHz。但事与愿
违，实际只达到3.8GHz。老雷加入英特尔时，正值P4时代，对
当时CPU风扇体量之大、转速之高记忆犹新。
2.2.6 Core 2系列处理器
从2006年7月27日开始推出的Core 2系列处理器是基于称为第8代x86
架构的英特尔多核微架构（Intel Core Micro-architecture）的。典型的产
品有双核的Core 2 Duo CPU和四核的Core 2 Quad CPU。该系列CPU的主
要特征如下。
对P6引入的动态执行能力做了进一步增强，每个CPU内核在一个时
钟周期最多可以执行4条指令，称为Wide Dynamic Execution。
可以把某些常见的x86指令合并成一条微操作来执行，称为macro-
fusion。
继承和增强了Pentium M的低功耗设计。
增加了用于提高乱序执行效率的Memory Disambiguation机制，基于
IP指针的缓存预取机制统称为Intel Smart Memory Access技术。
2.2.7 Nehalem微架构
于2008年11月推出的Core i7处理器是基于Nehalem微架构的首款产
品。值得说明的是，i7是英特尔定义的i3、i5、i7这3条产品线中一条产
品线的名字。i7是这 3 条产品线中最高的一档。从此，对于每一代微架
构，通常都会按上面的这3条产品线发布多款产品。基于Nehalem的Core
i7是使用新产品线名称的第一代产品，因此它实际上是第一代Core i7。
但是当时并没有这么称呼，因此在英特尔的产品网站上，它被称为“前
一代”英特尔酷睿i7处理器（Previous Generation Intel® Core™ i7
Processor）。
Nehalem微架构引入的新特征主要如下。
为提高分支预测能力，增加二级分支目标缓冲区（second-level
branch target buffer）。
改进虚拟化技术（VT），支持扩展页表（Extended Page Table）。
进一步扩展了SSE技术，支持SSE4.2。
将本来位于北桥（也称MCH）中的内存控制器集成到CPU中。
系统接口方面，引入QuickPath互联技术，取代了使用多年的前端
总线技术（FSB）。
生产工艺上首次使用high-k材料。
2.2.8 Sandy Bridge微架构
2011年1月，英特尔推出了基于Sandy Bridge微架构的第二代Core i7
处理器，同时也推出了基于相同微架构的i5和i3产品。英特尔把这些产
品统称为第二代酷睿处理器，相应的Sandy Bridge微架构也被简称为第
二代酷睿微架构。这让包括bit-tech网站在内的不少人很困惑，他们觉得
英特尔搞错了，因为如果把2006年推出的Core架构算作第一代，
Nehalem应该是第二代，那么Sandy Bridge至少应该算第三代。关于这个
问题，英特尔似乎没有公开澄清过。在今天的文档中，很少有第一代酷
睿微架构的提法，都是把Sandy Bridge微架构称作第二代，它之前有3种
与酷睿之名有关的产品：最早使用酷睿（Core）名称的Core Duo和Core
Solo（从微架构角度讲，被称为Pentium M增强），2006年推出的Core 2
和Nehalem。不管怎么样，英特尔从Sandy Bridge微架构开始，正式使
用“第×代酷睿微架构”的说法，并且保持着每年推出一代的快速步伐。
Sandy Bridge微架构主要是由位于以色列的英特尔CPU团队研发
的，其主要特征如下。
进一步增强了SIMD能力，引入AVX（Advanced Vector
Extensions）技术。