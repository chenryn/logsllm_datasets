如果执行中发现上述任一进程，恶意软件则会跳转到虚假函数中，产生虚假的HTTP流量。另外，如果恶意软件发现自己正被调试、不是通过HWP文档运行（比如使用双击运行）或者在父进程上成功使用OpenProcess()函数，那么恶意软件也会进入虚假处理流程。
恶意软件这么做似乎是为了产生网络流量以提供某种反馈机制，虚假处理流程使用了以下两个URL：
    https://www[.]amazon[.]com/Men-War-PC/dp/B001QZGVEC/EsoftTeam/watchcom.jpg
    http://www[.]hulu[.]com/watch/559035/episode3.mp4
第一个URL是一张“Men of War”的WII游戏图片，第二个URL是一部名为“Golden Time”的日本动漫视频。
这两个URL都没有恶意，作者使用这些URL来试图欺骗对其的安全分析。
**（二）C2架构**
ROKRAT使用合法平台作为C2服务器并接收指令。我们总共发现了12个硬编码令牌，通过这些平台的公共API进行通讯。
**1、使用Twitter作为C2服务器**
我们在样本中发现了7个不同的Twitter API令牌（包含Consumer Key、Consumer Secret、Token以及Token
Secret）。恶意软件检查Twitter时间线上的最后一条信息来接收指令，指令包括执行命令、移动文件、删除文件、终止进程、下载并执行文件。恶意软件也可以发布推文，推文以下面字符串中的随机三个字符开始：
    SHA-TOM-BRN-JMS-ROC-JAN-PED-JHN-KIM-LEE-
恶意软件使用的是官方的Twitter API：
**2、使用Yandex作为C2服务器**
Yandex云平台允许用户在Yandex云中创建磁盘。对于这个C2服务器，我们在样本中找到了4个Yandex令牌。样本使用API来下载和执行文件，或者上传用户文档。文档上传地址为：
    disk:/12ABCDEF/Document/Doc20170330120000.tfs
其中“12ABCDEF”是一个随机ID，用来标识受害主机，而“Doc20170330120000”则包含了时间信息。
**3、使用Mediafire作为C2服务器**
这个网站的使用方法与Yandex类似，目的在于使用Mediafire提供的文件存储功能，以便下载执行文件或上传用户文档：
样本中内置了一个Mediafire账户（邮箱、密码和应用ID）。
**（三）其他功能：屏幕截图和键盘记录**
此外，某个样本可以截取受害主机的屏幕，攻击者使用了GDI API来实现这一功能：
键盘记录中，恶意软件使用了SetWindowsHookEx()这个API拦截用户键盘输入，使用GetKeyNameText()
API来获取按键代表的字符，恶意软件同时提取了前台窗口的标题信息以便了解用户当前所处的输入窗口（使用GetForegroundWindow()以及GetWindowText()
API）。
**五、总结**
这次攻击活动中所使用了HWP（用户主要集中在韩国）文档，邮件和文档完全使用韩文撰写，这表明攻击者以韩语作为母语。
木马使用了新颖的通信渠道，包括Twitter和Yandex、Mediafire这两个云平台来发送命令、获取文件以及上传文件。这种通信渠道难以防范，因为这些平台基本都用于合法用途。恶意软件具备异常处理功能，例如它可以检测自身是否在沙箱中运行或者目标环境中是否存在安全分析工具，检测成功则会进入虚假处理流程并访问合法网站（Amazon和Hulu）。
这次攻击活动再次表明韩国仍是攻击者热衷的目标。本文案例中，攻击者使用了首尔某大学合法论坛的邮箱来发送钓鱼邮件，以提升攻击成功率。
**六、样本特征**
**（一）文件哈希**
HWP文档：
    7d163e36f47ec56c9fe08d758a0770f1778fa30af68f39aac80441a3f037761e
    5441f45df22af63498c63a49aae82065086964f9067cfa75987951831017bd4f
ROKRAT文件：
    cd166565ce09ef410c5bba40bad0b49441af6cfb48772e7e4a9de3d646b4851c
    051463a14767c6477b6dacd639f30a8a5b9e126ff31532b58fc29c8364604d00
**（二）网络特征**
恶意URL：
    http://discgolfglow[.]com/wp-content/plugins/maintenance/images/worker.jpg
    http://acddesigns[.]com[.]au/clients/ACPRCM/kingstone.jpg
非恶意URL：
    https://www[.]amazon[.]com/Men-War-PC/dp/B001QZGVEC/EsoftTeam/watchcom.jpg
    http://www[.]hulu[.]com/watch/559035/episode3.mp4
**（三）令牌特征**
MEDIAFIRE：
    Account #1
    Username: PI:EMAIL
    Application ID: 81342
TWITTER：
    Account #1
    Consumer key: sOPcUKjJteYrg8klXC4XUlk9l
    Token: 722226174008315904-u6P1FlI7IDg8VIYe720X0gqDYcAMQAR
    Account #2
    Consumer key: sgpalyF1KukVKaPAePb3EGeMT
    Token: 759577633630593029-CQzXMfvsQ2RztFYawUPeVbAzcSnwllX
    Account #3
    Consumer key: XVvauoXKfnAUm2qdR1nNEZqkN
    Token: 752302142474051585-r2TH1Dk8tU5TetUyfnw9c5OgA1popTj
    Account #4
    Consumer key: U1AoCSLLHxfeDbtxRXVgj7y00
    Token: 779546496603561984-Qm8CknTvS4nKxWOB4tJvbtBUMBfNCKE
    Account #5
    Consumer key: 9ndXAB6UcxhQVoBAkEKnwzt4C
    Token: 777852155245080576-H0kXYcQCpV6qiFER38h3wS1tBFdROcQ
    Account #6
    Consumer key: QCDXTaOCPBQM4VZigrRj2CnJi
    Token: 775849572124307457-4ICTjYmOfAy5MX2FxUHVdUfqeNTYYqj
    Account #7
    Consumer key: 2DQ8GqKhDWp55XIl77Es9oFRV
    Token: 778855419785154560-0YUVZtZjKblo2gTGWKiNF67ROwS9MMq
YANDEX：
    Token #1: AQAAAAAYm4qtAANss-XFfX3FjU8VmVR76k4aMA0
    Token #2: AQAAAAAA8uDKAANxExojbqps-UOIi8kc8EAhcq8
    Token #3: AQAAAAAY9j8KAANyULDuYU1240rjvpNXcRdF5Tw
    Token #4: AQAAAAAZDPB1AAN6l1Ht3ctALU1flix57TvuMa4