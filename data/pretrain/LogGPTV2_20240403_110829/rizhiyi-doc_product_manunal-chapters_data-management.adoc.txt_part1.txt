== 数据管理
日志易为机器数据提供全生命周期的管理。包括数据的采集、传输、解析、转换、路由、存储、清除、备份、恢复和范围管理等。
通常情况下，用户最经常用到的是其中的采集、解析、备份和范围管理几部分。其中采集、解析的详细说明，请参阅《日志易数据接入手册》。
=== 搜索权限
搜索权限是一种特殊的资源，只有\__admin__角色的域管理员权限可以新建/编辑/删除，普通用户只能读取/授权。
[NOTE]
====
普通用户必须要域管理员授权搜索权限，才能正常使用日志易搜索功能。如果用户的搜索权限列表页为空，则该用户的所有搜索都没有结果。
====
数据上传以后，日志易可以为您提供搜索权限功能。搜索权限定义日志数据范围范围非常灵活，可利用主机名（hostname）、应用程序（appname）、标签（tag）、过滤条件(queryFilter)四项内容的任意组合，定义搜索范围和授权不同用户的日志访问范围。被限定范围的用户只能在限定范围内查询。
日志易的用户可以使用搜索权限来区分研发，测试和生产等不同类型的日志的搜索范围。例如您是运维人员，只关心在线生产环境的运维日志，但不关心研发和测试环境的日志。其他用户如游戏公司，可以创建不同的搜索权限，区分不同的应用程序日志的搜索范围。
点击"权限-搜索权限"打开搜索权限列表页，可以在列表页查看当前用户的搜索权限。多行搜索权限取并集。
==== 新建搜索权限
搜索权限中主机名、应用名、标签三项内容包含在日志事件头部，通过日志易agent、rsyslog或HTTP消息头部上传。日志易根据搜索权限配置中的appname/tag信息，在本地上传，字段提取，备份策略，索引配置，入库优先级，agent管理页面对应的输入框给出填写提示。假如appname填写通配符星，则提示通配符星。过滤条件则支持任意查询类的日志易检索语法：
image::images/search-permission-create.png[]
==== 搜索权限的授权
搜索权限的授权和普通资源一样，可以在列表页的操作中点击"授权"，也可以在角色授权页面，勾选"读取"或"授权"。
image::images/search-permission-author.png[]
当发生搜索权限变动操作，比如授予和取消，通过消息通知系统，给被操作角色的对应用户发送提醒。内容为：
“您已被授权可访问xxx数据，有效期至yyyy，该授权不/可转授第三方”
提醒内容可点击，点击自动打开新窗口，定位到该搜索权限下的*搜索。
image::images/notice-search-permission.png[]
==== 搜索权限临时授权[[tmp-share]]
日志易提供搜索权限临时分享功能，用户可以指定搜索权限可读权限分享给指定用户，见如下页面：
image::images/search-permission-tmp-share-btn.png[]
点击'临时授权'，选择搜索权限名称，点击'授权'，填写临时授权信息如下图：
image::images/search-permission-tmp-share-new.png[]
选择'提权用户'，设置有效时长，则提权用户在有效时间内可以读取指定搜索权限的日志，还可以设置是否可以查看敏感内容和下载搜索结果，二次授权：可禁止被临时授权的用户转授这些搜索权限给第三方查看。
设置临时授权成功后，我们可以点击'临时授权管理'，进入临时授权管理页面，我们可以通过授权管理页面来回收或延期这个分享。
image::images/search-permission-tmp-share-manage.png[]
=== 下载管理
日志易支持离线下载搜索查询命中的全部结果。并在一段时间内长期保留该结果供多次下载。下载管理功能的使用方法分为界面操作和指令操作两种。
==== 界面提交下载任务
一般采用界面操作，方法如下：
使用下载功能前，需要先输入完整的查询命令，并点击查询按钮。
image::images/download-job-new.png[]
点击下载按钮，会有窗口弹出，需要规定本次下载任务的文件名称（必填）、最大下载量、文件类型、文件编码等参数，其中最大下载量可以限制下载条数或者下载文件大小。另外，当查询为Stats类时，下载类型仅JSON、CSV 和Excel可选，当查询为Query类时，下载类型为JSON和TXT可选，当查询为Transaction类时，下载类型仅JSON可选。
CSV 和 Excel 的区别是：当 SPL 统计结果已知字段类型为字符串时，会明确设置 Excel 内单元格格式为文本格式。适用于不希望出现科学记数法的 ID 字段。
==== 指令提交下载任务
日志易提供 `download` 指令，可以在 SPL 语句中采用该指令直接提交下载任务。指令参数和界面填写的内容基本一致，包括filename、filetype等。指令的详细说明请参见《日志易检索参考》。
`download` 指令一般用于在定义任务中定期执行，这样，同一目的的数据可以根据时间的移动而定期生成供下载。为了区分不同时间点的执行结果，`download` 指令提交的任务会自动在 filename 后加上执行时间。
image::images/download-command.png[]
==== 下载任务数据获取
下载申请已经发送，现在可以进入“设置-数据-下载管理”列表页：
image::images/download-joblist.png[]
下载列表的内容包含两部分：正在执行中的下载任务和已经结束的下载任务；已经结束的下载任务的右侧下载按钮为可点击状态，点击下载可以通过浏览器将文件下载到本地。正在执行中的任务下载按钮为灰色不可用，同时生成进度也会不断刷新直到完成。
下载任务完成后, 会在页面上触发消息提醒。
单个用户最多可以同时保存的下载文件数为10个。默认的，下载文件采用FIFO（先进先出）淘汰机制。用户可以手动在管理页上提前删除某个下载文件。
[NOTE]
====
日志易的配置文件中对条数和文件大小的最大值进行了限制，分别为100000和2G，当用户输入的大小值超过这两个配置值时会在前台报错而不提交此次下载任务。
====