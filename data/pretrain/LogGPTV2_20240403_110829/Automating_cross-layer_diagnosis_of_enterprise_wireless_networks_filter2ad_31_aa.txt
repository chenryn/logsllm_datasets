title:Automating cross-layer diagnosis of enterprise wireless networks
author:Yuchung Cheng and
Mikhail Afanasyev and
Patrick Verkaik and
P&apos;eter Benk&quot;o and
Jennifer Chiang and
Alex C. Snoeren and
Stefan Savage and
Geoffrey M. Voelker
Automating Cross-Layer Diagnosis
of Enterprise Wireless Networks
Yu-Chung Cheng, Mikhail Afanasyev, Patrick Verkaik, Péter Benkö†,
Jennifer Chiang, Alex C. Snoeren, Stefan Savage, and Geoffrey M. Voelker
Department of Computer Science and Engineering
University of California, San Diego
†Trafﬁc Analysis and Network Performance Laboratory (TrafﬁcLab)
Ericsson Research, Budapest, Hungary
ABSTRACT
Modern enterprise networks are of sufﬁcient complexity that even
simple faults can be difﬁcult to diagnose — let alone transient out-
ages or service degradations. Nowhere is this problem more appar-
ent than in the 802.11-based wireless access networks now ubiq-
uitous in the enterprise. In addition to the myriad complexities of
the wired network, wireless networks face the additional challenges
of shared spectrum, user mobility and authentication management.
Not surprisingly, few organizations have the expertise, data or tools
to decompose the underlying problems and interactions responsible
for transient outages or performance degradations. In this paper, we
present a set of modeling techniques for automatically characteriz-
ing the source of such problems. In particular, we focus on data
transfer delays unique to 802.11 networks — media access dynam-
ics and mobility management latency. Through a combination of
measurement, inference and modeling we reconstruct sources of
delay — from the physical layer to the transport layer — as well as
the interactions among them. We demonstrate our approach using
comprehensive traces of wireless activity in the UCSD Computer
Science building.
Categories and Subject Descriptors
C.4 [Performance of Systems]: Modeling techniques
General Terms
Modeling, Measurement, Performance
Keywords
Wireless networks, 802.11, modeling, measurement
1.
INTRODUCTION
“Is your wireless working?” The familiarity of this refrain under-
scores both our increasing dependence on ubiquitous Internet con-
nectivity and the practical challenges in delivering on this promise.
The combination of unlicensed spectrum and cheap 802.11 silicon
have driven a massive deployment of wireless access capability —
which started in the home and was soon followed by the workplace.
Today over two-thirds of U.S. corporations provide WiFi-based un-
tethered Internet connectivity [8]. However, there is a signiﬁcant
Permission to make digital or hard copies of all or part of this work for
personal or classroom use is granted without fee provided that copies are
not made or distributed for proﬁt or commercial advantage and that copies
bear this notice and the full citation on the ﬁrst page. To copy otherwise, to
republish, to post on servers or to redistribute to lists, requires prior speciﬁc
permission and/or a fee.
SIGCOMM’07, August 27–31, 2007, Kyoto, Japan.
Copyright 2007 ACM 978-1-59593-713-1/07/0008 ...$5.00.
difference between installing a single wireless access point (AP) in
an isolated home — effectively a simple range extender for a wired
Ethernet interface — and wireless deployment throughout an enter-
prise. The latter may comprise hundreds of distinct APs, carefully
sited and conﬁgured in accordance with a radio-frequency (RF) site
survey and, ideally, managed to minimize contention, maximize
throughput, and provide the illusion of seamless coverage. More-
over, this intricate machinery is not managed by the 802.11 proto-
col family itself — which, in all fairness, was never designed for
the level of success it has experienced.
Instead, the burden falls
to the network administrator who must manage the interactions be-
tween the RF domain, link-layer variability, dynamic addressing
and authorization, VLAN setup, as well as the myriad complexities
of the wired network itself.
Given this complexity, it is not surprising that even simple faults
can be difﬁcult to diagnose — let alone transient outages or service
degradations. Thus, when a network manager is asked, “Why was
the network ﬂaky ten minutes ago?” the answer is inevitably, “I’m
not sure. It looks ﬁne now.” While this problem is not unique to
802.11-based networks, these environments introduce further intri-
cacies that are unique and qualitatively harder to diagnose.
Among these issues, wireless networks interact via shared spec-
trum in ways that may not be observable directly (contention and
interference) and yet can produce signiﬁcant end-to-end delays or
packet losses. Further complicating such analysis, the 802.11 stan-
dards allow considerable “latitude” in the media access protocol
and consequently vendors have produced a wide range of “interpre-
tations” — many of which have signiﬁcant impact on performance.
Finally, the promise of seamless coverage is not a property provided
by 802.11 itself. Instead, most enterprise deployments implement
this property using an undeclared “layer 2.5” patched together from
portions of the 802.11 protocol, VLANs, ARP, DHCP and often
proprietary mobility management and authentication systems. Un-
surprisingly, the resulting Rube-Goldberg contraption has its own
unique failure modes.
In practice, few network administrators have both the detailed
visibility into network behavior and the breadth of knowledge needed
to diagnose such problems. When they do, the process is highly la-
bor intensive and rarely cost effective except for the most severe
and persistent problems. Even then, the range of interactions and
lack of visibility into their causes may stymie manual diagnosis. In
one recent episode at UCSD, wireless users in a new ofﬁce building
experienced transient, but debilitating, performance problems last-
ing over a year, despite extensive troubleshooting by local experts
and vendor technicians.1
1We believe we have diagnosed their problem — a subtle bug in
Our experience suggests that such diagnoses must be fully au-
tomated to be effective. As a ﬁrst step in this direction, we have
developed models of wireless delays from the physical layer to the
transport layer. In particular, we demonstrate techniques to infer
the causes and effects of both link-layer delays and mobility man-
agement delays. To demonstrate their effectiveness, we use our
models to investigate the causes of transient performance problems
from traces of wireless trafﬁc in the four-story UCSD Computer
Science building. We ﬁnd that no one anomaly, failure or interac-
tion is singularly responsible for these issues in our environment —
suggesting that our holistic analysis approach may be necessary to
cover the range of problems experienced in real networks.
The remainder of this paper is structured as follows. We ﬁrst re-
view the literature we build upon and related efforts in Section 2.
In Section 3 we summarize the monitoring system we use to collect
trace data for use with our models. We then outline the many po-
tential sources of service disruption — the gauntlet faced by each
802.11 packet — in Section 4. Sections 5 and 6 describe our tech-
niques for modeling media access and mobility management be-
havior, respectively, including an analysis of the problems identi-
ﬁed at our location, followed by our conclusions.
2. RELATED WORK
Ever since wireless local-area networks such as 802.11 have been
deployed, researchers have sought to understand how these systems
behave and perform based on empirical observations. The monitor-
ing systems used to make these observations have increasingly ex-
panded both in complexity and scope over time. Early systems used
existing infrastructure, such as the wired distribution network and
the APs, to record wireless trafﬁc and network characteristics [2,
16]. Later systems deployed small numbers of dedicated moni-
toring nodes, sometimes concentrated near the APs, other times
distributed throughout the network, thereby pushing the frontier of
observation into the link-layer domain [12, 18, 23]. Recent efforts
have substantially scaled monitoring platforms to observe large,
densely deployed networks in their entirety [1, 7], providing the
ability to observe every link-layer network transmission across lo-
cation, frequency, and time [7].
These monitoring systems have been used to directly measure a
number of interesting aspects of 802.11 behavior and performance,
ranging from application workloads and user mobility at the high
level to wireless loss, rate adaptation, and handoff delay at the link
layer [10, 13, 19] and even physical layer anomalies [22].
Other techniques infer more detailed network events and charac-
teristics, such as link-layer loss and the transmitters of packets lack-
ing MAC addresses [4, 7, 18], co-channel interference and overpro-
tective APs [7], misbehaving and heterogeneous devices [4, 7, 9],
root causes of physical-layer anomalies [22], and regions of poor
coverage [4]. We greatly expand upon these detailed efforts and
present techniques to infer critical path delays [3] of media access
for every packet, such as AP queuing delay and media contention
(mandatory and regular backoff), as well as techniques that infer
management delays for supporting intermittent and mobile devices
for every user.
To infer critical path delays for wireless transmissions, we de-
velop a detailed model of 802.11 media access (Section 5). Numer-
ous models have been developed previously to estimate various as-
pects of 802.11 performance, such as the overall network capacity
as governed by the 802.11 protocol [6], the maximum throughput
the AP vendor’s implementation — but it is easy to understand in
retrospect why its discovery was challenging to ﬁnd through trial
and error.
Start
Duration
Radio Monitors
Infrastructure APs
Wireless clients
Raw trace size
Unique frames captured
1/11/07 @ 00:00
24 hours
192
40
188
96 GB
210 M
Table 1: Summary of trace characteristics.
of a ﬂow in an 802.11 network [14], and the saturation throughput
and expected access delay of contending nodes [17]. Such models
are typically analytic. To make analysis tractable, they explicitly
make simplifying assumptions such as absence of transmission er-
rors, uniform transmission rates and packet sizes, inﬁnite node de-
mand and steady contention for media access, uniformly random
probability of collisions and interference, etc. As a result, these
models may be useful for understanding the limits of 802.11 per-
formance under idealized conditions, but omit analysis of important
aspects of real networks that we infer with our model: the magnify-
ing effects of bursty trafﬁc that averages and expected values con-
ceal, and the complexities of workload, protocol, and environment
that lead to correlated and unexpected interactions.
Three recent systems are closely related to the goals of this paper.
DAIR uses wireless USB dongles attached to desktop machines in
an enterprise wireless network to measure wireless events through-
out the network [1]. DAIR applications install ﬁlters at the wireless
monitors to trace information of interest and store it in a central
database; applications (inference engines) then use this data to per-
form analyses. Very recent work on DAIR develops management
applications that take advantage of client location, such as identi-
fying regions in the network experiencing consistently poor cov-
erage [4]. Our goals are similar in that we develop analyses to aid
network management, but we base analysis on a global understand-
ing of network behavior across all protocol layers.
WiFiProﬁler [5] also helps users troubleshoot wireless connec-
tivity problems. WiFiProﬁler relies upon peer diagnosis among
clients without the involvement of system administrators, while
our paper uses third-party monitoring and inference. WiFiProﬁler
installs custom software on the client to collect detailed network
stack statistics, such as beacon losses and queue length, as well
as OS and driver details. It then exchanges this information with
peers to diagnose connectivity problems. The client can then de-
termine if it has an association problem, DHCP problem, or TCP
problem. The MOJO system develops tools and techniques to iden-
tify the root causes of physical-layer performance anomalies, such
as broadband interference and the capture effect [22]. While we
are interested in physical-layer issues, we identify them as just one
cause among many across the interacting protocol layers.
3. TRACE COLLECTION
The modeling approach we describe in this paper operates on
detailed traces of wireless activity. We use the Jigsaw system de-
scribed in [7] to collect the traces we use in this paper, and we
brieﬂy sketch the system in this section. Jigsaw is a distributed
wireless monitoring platform that we have deployed in our depart-
ment building to monitor the production 802.11 network. The pro-
duction 802.11 network consists of 40 Avaya AP-8 802.11 b/g ac-
cess points covering four ﬂoors and the basement. The APs are
identically conﬁgured (except for their channel assignment) and
support both 802.11b and 802.11g without encryption.
 18
 16
 14
 12
 10
 8
 6
 4
 2
l
s
m
7
.
6
1
o
u
d
o
m
p
m
a
t
s
e
m
T
i
 0
13:00:00
13:00:30
13:01:00
13:01:30
13:02:00
Time
Figure 1: Physical error frame pattern during microwave oven
use. The y-axis depicts (time % 16) ms, showing the offset of
physical error packets within the 16 ms microwave period. The
x-axis shows two minutes of microwave use.
The hardware monitors consist of 192 radios interspersed be-
tween the infrastructure APs. The radios passively monitor the
wireless network and report all wireless events across location, chan-
nel, and time via a private wired network to a back-end storage
server. Jigsaw merges and time synchronizes these separate radio
traces into a single, global uniﬁed trace. Moreover, Jigsaw per-
forms this operation in real time; a single 2.2Ghz AMD Opteron
server can synchronize one minute of raw trace data in under 15
seconds.
We currently conﬁgure Jigsaw to capture the ﬁrst 120 bytes of
each wireless frame. As a result, the aggregate monitor trafﬁc
from all radios ranges from 2–10Mbps and is roughly ﬁve times
the amount of production wireless trafﬁc. On a typical weekday,
the raw traces total 80 GB and the merged, synchronized trace is
roughly 10 GB in size. Our analyses are conducted on the synchro-
nized trace; the raw traces are used for debugging purposes only.
The particular trace used in this paper was collected on Thursday,
January 11, 2007. Table 1 shows various high-level characteristics
of the users and trafﬁc contained in this trace.
4. THE TROUBLED LIFE OF A PACKET
There are numerous sources of disruption or performance degra-
dation in an 802.11 network. To illustrate these challenges and
motivate the need for our analyses, we provide a quick primer on
several potential sources of delay and packet loss.
4.1 Physical layer
The physical layer presents the ﬁrst obstacle for an 802.11 frame
hoping to be delivered. Sharing the unlicensed 2.4GHz ISM band
are a wide range of non-802.11 devices, ranging from cordless
phones to microwave ovens. An 802.11 packet in ﬂight may be
corrupted by broadband interference from such devices or it may
simply be overpowered at the receiver. Alternatively, the sender
may detect the presence of RF energy on the channel and defer
transmission — incurring delays until the interfering source ceases.
For example, Figure 1 illustrates the interference caused by a
microwave oven. The ﬁgure depicts the reception of physical error
frames over time. The characteristic pattern (the white gap) results
from the wave doubler circuit used in consumer microwave ovens
to convert A/C line power into microwave energy. Roughly speak-
ing, a U.S. oven will generate swept broadband interference for 8
ms (half of the 60-Hz cycle) followed by a similar period of quies-
cence. In all cases, in-range 802.11 radios will defer transmission
until the medium is idle, building queues and adding delay in the
process. Frames in ﬂight when the oven is turned on may be cor-
rupted, depending on the receiver power of the microwave signal.
Such physical layer interactions are not restricted to non-802.11
devices. The 2.4GHz ISM band combined with the nominal 22-
MHz channel bandwidth used by an 802.11 transmitter can eas-
ily overlap neighboring transmitters on different channels. Indeed,
while conventional wisdom holds that 802.11 has three orthogo-
nal channels in the United States, this statement is not always true
in practice. We have routinely observed adjacent channel interac-
tions and have even witnessed many successful packet receptions
between radios in which the transmitting and receiving radios were
separated by as much as 50 MHz (i.e., channel 1 to channel 11). In
addition to neighboring channel interference, 802.11 also suffers