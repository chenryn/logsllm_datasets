14.6.2.2 软件要求......................................................594
14.6.2.3 前置软件安装..................................................594
14.6.2.4BIOS配置..................................................... 595
14.6.2.5 操作系统配置..................................................597
14.6.2.6 文件系统配置..................................................597
14.6.2.7 网络配置......................................................598
14.6.2.7.1 网卡多中断队列设置........................................ 598
14.6.2.7.2 中断调优.................................................. 599
14.6.2.7.3 网卡固件确认与更新........................................ 599
14.6.2.8 数据库服务端及客户端绑核......................................600
14.6.3 测试TPCC性能................................................... 601
14.6.4 TPCC测试用例....................................................607
14.6.4.1 环境配置.................................................... 607
14.6.4.1.1 硬件配置................................................ 607
南大通用数据技术股份有限公司
XIX
GBase 8s V8.8开发者手册
14.6.4.1.2 软件配置................................................ 607
14.6.4.2 性能调优.................................................... 608
14.6.4.2.1 系统参数调优............................................ 608
14.6.4.2.2 数据库参数调优.......................................... 608
14.6.4.2.3 TPC-C 参数配置.......................................... 610
14.6.4.2.4 建表语句................................................ 610
14.6.4.2.5 建索引语句.............................................. 613
14.6.4.2.6 调优效果展示............................................ 614
14.7 实际调优案例...................................................................................................................614
14.8 性能日志...........................................................................................................................618
15 配置运行参数............................................................ 619
15.1 查看参数当前取值...........................................................................................................619
15.2 重设参数...........................................................................................................................620
15.2.1 背景信息......................................................... 620
15.2.2GUC参数设置.....................................................620
15.2.3 操作步骤........................................................ 623
15.2.4 示例............................................................. 626
16 用户自定义函数............................................................ 1
16.1PL/pgSQL 语言函数.........................................................................................................631
17 存储过程................................................................ 632
17.1 存储过程...........................................................................................................................632
17.2 数据类型...........................................................................................................................632
17.3 数据类型转换...................................................................................................................632
17.4 数组和 record...................................................................................................................634
17.4.1 数组............................................................. 634
17.4.1.1 数组类型的使用................................................634
南大通用数据技术股份有限公司
XX
GBase 8s V8.8开发者手册
17.4.2 集合............................................................. 635
17.4.2.1 集合类型的使用................................................635
17.4.3record.............................................................636
17.4.3.1record 类型的变量..............................................636
17.4.3.2 语法..........................................................636
17.4.3.3 示例..........................................................638
17.5 声明语法...........................................................................................................................639
17.5.1 基本结构......................................................... 639
17.5.1.1 结构..........................................................639
17.5.1.2 分类........................................................ 640
17.5.2 匿名块........................................................... 640
17.5.2.1 语法..........................................................641
17.5.3 子程序........................................................... 641
17.6 基本语句...........................................................................................................................641
17.6.1 定义变量......................................................... 642
17.6.1.1 变量声明......................................................642
17.6.1.2 变量作用域....................................................644
17.6.2 赋值语句......................................................... 644
17.6.2.1 语法..........................................................644
17.6.2.2 嵌套赋值......................................................645
17.6.2.3INTO/BULKCOLLECTINTO.....................................646
17.6.3 调用语句......................................................... 647
17.6.3.1 语法..........................................................647
17.6.3.2 示例..........................................................647
17.7 动态语句...........................................................................................................................648
17.7.1 执行动态查询语句................................................. 648
南大通用数据技术股份有限公司
XXI
GBase 8s V8.8开发者手册
17.7.1.1EXECUTEIMMEDIATE......................................... 648
17.7.1.2OPENFOR.....................................................649
17.7.2 执行动态非查询语句............................................... 650
17.7.2.1 语法..........................................................650
17.7.2.2 示例..........................................................650
17.7.3 动态调用存储过程................................................. 651
17.7.3.1 语法..........................................................651
17.7.4 动态调用匿名块................................................... 652
17.7.4.1 语法..........................................................652
17.8 控制语句...........................................................................................................................653
17.8.1 返回语句......................................................... 653
17.8.1.1RETURN...................................................... 653
17.8.1.2RETURNNEXT 及 RETURNQUERY.............................654
17.8.2 条件语句......................................................... 655
17.8.3 循环语句......................................................... 659
17.8.3.1 简单LOOP语句............................................... 659
17.8.3.2WHILE_LOOP语句.............................................660
17.8.3.3FOR_LOOP（integer变量）语句..................................661
17.8.3.4FOR_LOOP查询语句............................................661
17.8.3.5FORALL批量查询语句..........................................662
17.8.4 分支语句......................................................... 663
17.8.5 空语句........................................................... 665
17.8.6 错误捕获语句..................................................... 666
17.8.7GOTO语句........................................................670
17.9 事务管理...........................................................................................................................673
17.9.1 语法格式......................................................... 673
南大通用数据技术股份有限公司
XXII
GBase 8s V8.8开发者手册
17.9.2 使用场景......................................................... 673
17.9.3 使用限制......................................................... 674
17.9.4 示例............................................................. 675
17.10 其他语句.........................................................................................................................685
17.10.1 锁操作.......................................................... 685
17.10.2 游标操作........................................................ 685
17.11 游标..................................................................................................................................685
17.11.1 游标概述........................................................ 685
17.11.2 显式游标........................................................ 686
17.11.2.1 处理步骤.....................................................686
17.11.2.2 属性.........................................................689
17.11.3 隐式游标........................................................ 689
17.11.3.1 简介.........................................................689
17.11.3.2 属性.........................................................690
17.11.3.3 示例.........................................................690
17.11.4 游标循环........................................................ 691
17.11.4.1 语法.........................................................691
17.11.4.2 注意事项.....................................................691
17.12 高级包.............................................................................................................................691
17.12.1 基础接口........................................................ 692
17.12.1.1PKG_SERVICE................................................692
17.12.1.2PKG_UTIL....................................................704
17.13Retry管理.........................................................................................................................732
17.14 调试.................................................................................................................................732
17.14.1 语法............................................................ 732
17.14.1.1RAISE语法...................................................732
南大通用数据技术股份有限公司
XXIII
GBase 8s V8.8开发者手册
17.14.1.2EXCEPTION_INIT语法.........................................735
17.14.2 示例............................................................ 735
17.15package.............................................................................................................................738
18 自治事务................................................................ 738
18.1 存储过程支持自治事务...................................................................................................738
18.2 匿名块支持自治事务.......................................................................................................740
18.3 用户自定义函数支持自治事务.......................................................................................740
18.4 规格约束...........................................................................................................................743
19 系统表和系统视图........................................................ 747
19.1 系统表和系统视图概述...................................................................................................747
19.2 系统表...............................................................................................................................748
19.2.1GS_ASP.......................................................... 748
19.2.2GS_AUDITING_POLICY............................................ 749
19.2.3GS_AUDITING_POLICY_ACCESS....................................750
19.2.4GS_AUDITING_POLICY_FILTERS................................... 750
19.2.5GS_AUDITING_POLICY_PRIVILEGES................................751
19.2.6GS_CLIENT_GLOBAL_KEYS........................................751
19.2.7GS_CLIENT_GLOBAL_KEYS_ARGS................................. 752
19.2.8GS_COLUMN_KEYS............................................... 752
19.2.9GS_COLUMN_KEYS_ARGS.........................................753
19.2.10GS_DB_PRIVILEGE...............................................753
19.2.11GS_DB_PRIVILEGES..............................................754
19.2.12GS_ENCRYPTED_COLUMNS.......................................754
19.2.13GS_ENCRYPTED_PROC........................................... 755
19.2.14GS_GLOBAL_CHAIN..............................................755
19.2.15GS_GLOBAL_CONFIG.............................................756
南大通用数据技术股份有限公司
XXIV
GBase 8s V8.8开发者手册
19.2.16GS_MASKING_POLICY............................................756
19.2.17GS_MASKING_POLICY_ACTIONS..................................757
19.2.18GS_MASKING_POLICY_FILTERS...................................757
19.2.19GS_MATVIEW....................................................758
19.2.20GS_MATVIEW_DEPENDENCY..................................... 758
19.2.21GS_MODEL_WAREHOUSE.........................................759
19.2.22GS_OBSSCANINFO............................................... 760
19.2.23GS_OPT_MODEL................................................. 761
19.2.24GS_PACKAGE....................................................763
19.2.25GS_POLICY_LABEL.............................................. 763
19.2.26GS_RECYCLEBIN.................................................764
19.2.27GS_TXN_SNAPSHOT..............................................766
19.2.28GS_UID..........................................................766
19.2.29GS_WLM_EC_OPERATOR_INFO....................................766
19.2.30GS_WLM_INSTANCE_HISTORY....................................767
19.2.31GS_WLM_OPERATOR_INFO....................................... 768
19.2.32GS_WLM_PLAN_ENCODING_TABLE............................... 770
19.2.33GS_WLM_PLAN_OPERATOR_INFO.................................771
19.2.34GS_WLM_SESSION_QUERY_INFO_ALL.............................771
19.2.35GS_WLM_USER_RESOURCE_HISTORY............................. 777
19.2.36PG_AGGREGATE................................................. 779
19.2.37PG_AM..........................................................780
19.2.38PG_AMOP....................................................... 782
19.2.39PG_AMPROC.....................................................783
19.2.40PG_APP_WORKLOADGROUP_MAPPING............................784
19.2.41PG_ATTRDEF.................................................... 784
南大通用数据技术股份有限公司
XXV
GBase 8s V8.8开发者手册
19.2.42PG_ATTRIBUTE.................................................. 785
19.2.43PG_AUTHID..................................................... 787
19.2.44PG_AUTH_HISTORY..............................................789
19.2.45PG_AUTH_MEMBERS.............................................790
19.2.46PG_CAST........................................................790
19.2.47PG_CLASS.......................................................791
19.2.48PG_COLLATION..................................................795
19.2.49PG_CONSTRAINT................................................ 796
19.2.50PG_CONVERSION................................................ 798
19.2.51PG_DATABASE...................................................799
19.2.52PG_DB_ROLE_SETTING...........................................800
19.2.53PG_DEFAULT_ACL............................................... 800
19.2.54PG_DEPEND..................................................... 801
19.2.55PG_DESCRIPTION................................................ 802
19.2.56PG_DIRECTORY..................................................803
19.2.57PG_ENUM....................................................... 803
19.2.58PG_EXTENSION..................................................804
19.2.59PG_EXTENSION_DATA_SOURCE...................................804
19.2.60PG_FOREIGN_DATA_WRAPPER....................................805
19.2.61PG_FOREIGN_SERVER............................................806
19.2.62PG_FOREIGN_TABLE............................................. 806
19.2.63PG_HASHBUCKET................................................807
19.2.64PG_INDEX.......................................................807
19.2.65PG_INHERITS....................................................809
19.2.66PG_JOB..........................................................809
19.2.67PG_JOB_PROC................................................... 811
南大通用数据技术股份有限公司
XXVI
GBase 8s V8.8开发者手册
19.2.68PG_LANGUAGE..................................................811
19.2.69PG_LARGEOBJECT...............................................812
19.2.70PG_LARGEOBJECT_METADATA................................... 813
19.2.71PG_NAMESPACE................................................. 813
19.2.72PG_OBJECT......................................................814
19.2.73PG_OBSSCANINFO............................................... 815
19.2.74PG_OPCLASS.................................................... 815
19.2.75PG_OPERATOR...................................................816
19.2.76PG_OPFAMILY................................................... 817
19.2.77PG_PARTITION...................................................818
19.2.78PG_PLTEMPLATE.................................................820
19.2.79PG_PROC........................................................821
19.2.80PG_PUBLICATION................................................824
19.2.81PG_PUBLICATION_REL........................................... 825
19.2.82PG_RANGE...................................................... 825
19.2.83PG_REPLICATION_ORIGIN........................................ 826
19.2.84PG_RESOURCE_POOL............................................ 826
19.2.85PG_REWRITE.................................................... 827
19.2.86PG_RLSPOLICY.................................................. 828
19.2.87PG_SECLABEL...................................................828
19.2.88PG_SHDEPEND...................................................829
19.2.89PG_SHDESCRIPTION..............................................830
19.2.90PG_SHSECLABEL................................................ 830
19.2.91PG_STATISTIC................................................... 831
19.2.92PG_STATISTIC_EXT...............................................832
19.2.93PG_SUBSCRIPTION...............................................834
南大通用数据技术股份有限公司
XXVII
GBase 8s V8.8开发者手册
19.2.94PG_SYNONYM...................................................835
19.2.95PG_TABLESPACE.................................................835
19.2.96PG_TRIGGER.................................................... 836
19.2.97PG_TS_CONFIG.................................................. 836
19.2.98PG_TS_CONFIG_MAP.............................................837
19.2.99PG_TS_DICT..................................................... 837
19.2.100PG_TS_PARSER................................................. 838
19.2.101PG_TS_TEMPLATE...............................................839
19.2.102PG_TYPE.......................................................839
19.2.103PG_USER_MAPPING.............................................842
19.2.104PG_USER_STATUS...............................................843
19.2.105PG_WORKLOAD_GROUP.........................................843
19.2.106PLAN_TABLE_DATA.............................................844
19.2.107STREAMING_CONT_QUERY......................................845
19.2.108STATEMENT_HISTORY...........................................846
19.2.109STREAMING_REAPER_STATUS................................... 850
19.2.110STREAMING_STREAM...........................................851
19.2.111SYS_DUMMY................................................... 851
19.3 系统视图...........................................................................................................................851
19.3.1GET_GLOBAL_PREPARED_XACTS..................................851
19.3.2GS_ALL_CONTROL_GROUP_INFO.................................. 852