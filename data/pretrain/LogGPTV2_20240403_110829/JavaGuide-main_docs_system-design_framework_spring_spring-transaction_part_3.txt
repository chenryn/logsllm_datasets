```java
public enum Isolation {
  DEFAULT(TransactionDefinition.ISOLATION_DEFAULT),
  READ_UNCOMMITTED(TransactionDefinition.ISOLATION_READ_UNCOMMITTED),
  READ_COMMITTED(TransactionDefinition.ISOLATION_READ_COMMITTED),
  REPEATABLE_READ(TransactionDefinition.ISOLATION_REPEATABLE_READ),
  SERIALIZABLE(TransactionDefinition.ISOLATION_SERIALIZABLE);
  private final int value;
  Isolation(int value) {
    this.value = value;
  }
  public int value() {
    return this.value;
  }
}
```
ä¸‹é¢æˆ‘ä¾æ¬¡å¯¹æ¯ä¸€ç§äº‹åŠ¡éš”ç¦»çº§åˆ«è¿›è¡Œä»‹ç»ï¼š
- **`TransactionDefinition.ISOLATION_DEFAULT`** :ä½¿ç”¨åç«¯æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼ŒMySQL é»˜è®¤é‡‡ç”¨çš„ `REPEATABLE_READ` éš”ç¦»çº§åˆ« Oracle é»˜è®¤é‡‡ç”¨çš„ `READ_COMMITTED` éš”ç¦»çº§åˆ«.
- **`TransactionDefinition.ISOLATION_READ_UNCOMMITTED`** :æœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œä½¿ç”¨è¿™ä¸ªéš”ç¦»çº§åˆ«å¾ˆå°‘ï¼Œå› ä¸ºå®ƒå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œ**å¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»**
- **`TransactionDefinition.ISOLATION_READ_COMMITTED`** : å…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œ**å¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†æ˜¯å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿ**
- **`TransactionDefinition.ISOLATION_REPEATABLE_READ`** : å¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡è‡ªå·±æ‰€ä¿®æ”¹ï¼Œ**å¯ä»¥é˜»æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚**
- **`TransactionDefinition.ISOLATION_SERIALIZABLE`** : æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä» ACID çš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ**è¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»**ã€‚ä½†æ˜¯è¿™å°†ä¸¥é‡å½±å“ç¨‹åºçš„æ€§èƒ½ã€‚é€šå¸¸æƒ…å†µä¸‹ä¹Ÿä¸ä¼šç”¨åˆ°è¯¥çº§åˆ«ã€‚
ç›¸å…³é˜…è¯»ï¼š[MySQL äº‹åŠ¡éš”ç¦»çº§åˆ«è¯¦è§£](https://javaguide.cn/database/mysql/transaction-isolation-level.html)ã€‚
#### äº‹åŠ¡è¶…æ—¶å±æ€§
æ‰€è°“äº‹åŠ¡è¶…æ—¶ï¼Œå°±æ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡æ‰€å…è®¸æ‰§è¡Œçš„æœ€é•¿æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡è¯¥æ—¶é—´é™åˆ¶ä½†äº‹åŠ¡è¿˜æ²¡æœ‰å®Œæˆï¼Œåˆ™è‡ªåŠ¨å›æ»šäº‹åŠ¡ã€‚åœ¨ `TransactionDefinition` ä¸­ä»¥ int çš„å€¼æ¥è¡¨ç¤ºè¶…æ—¶æ—¶é—´ï¼Œå…¶å•ä½æ˜¯ç§’ï¼Œé»˜è®¤å€¼ä¸º-1ï¼Œè¿™è¡¨ç¤ºäº‹åŠ¡çš„è¶…æ—¶æ—¶é—´å–å†³äºåº•å±‚äº‹åŠ¡ç³»ç»Ÿæˆ–è€…æ²¡æœ‰è¶…æ—¶æ—¶é—´ã€‚
#### äº‹åŠ¡åªè¯»å±æ€§
```java
package org.springframework.transaction;
import org.springframework.lang.Nullable;
public interface TransactionDefinition {
    ......
    // è¿”å›æ˜¯å¦ä¸ºåªè¯»äº‹åŠ¡ï¼Œé»˜è®¤å€¼ä¸º false
    boolean isReadOnly();
}
```
å¯¹äºåªæœ‰è¯»å–æ•°æ®æŸ¥è¯¢çš„äº‹åŠ¡ï¼Œå¯ä»¥æŒ‡å®šäº‹åŠ¡ç±»å‹ä¸º readonlyï¼Œå³åªè¯»äº‹åŠ¡ã€‚åªè¯»äº‹åŠ¡ä¸æ¶‰åŠæ•°æ®çš„ä¿®æ”¹ï¼Œæ•°æ®åº“ä¼šæä¾›ä¸€äº›ä¼˜åŒ–æ‰‹æ®µï¼Œé€‚åˆç”¨åœ¨æœ‰å¤šæ¡æ•°æ®åº“æŸ¥è¯¢æ“ä½œçš„æ–¹æ³•ä¸­ã€‚
å¾ˆå¤šäººå°±ä¼šç–‘é—®äº†ï¼Œä¸ºä»€ä¹ˆæˆ‘ä¸€ä¸ªæ•°æ®æŸ¥è¯¢æ“ä½œè¿˜è¦å¯ç”¨äº‹åŠ¡æ”¯æŒå‘¢ï¼Ÿ
æ‹¿ MySQL çš„ innodb ä¸¾ä¾‹å­ï¼Œæ ¹æ®å®˜ç½‘ [https://dev.mysql.com/doc/refman/5.7/en/innodb-autocommit-commit-rollback.html](https://dev.mysql.com/doc/refman/5.7/en/innodb-autocommit-commit-rollback.html) æè¿°ï¼š
> MySQL é»˜è®¤å¯¹æ¯ä¸€ä¸ªæ–°å»ºç«‹çš„è¿æ¥éƒ½å¯ç”¨äº†`autocommit`æ¨¡å¼ã€‚åœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œæ¯ä¸€ä¸ªå‘é€åˆ° MySQL æœåŠ¡å™¨çš„`sql`è¯­å¥éƒ½ä¼šåœ¨ä¸€ä¸ªå•ç‹¬çš„äº‹åŠ¡ä¸­è¿›è¡Œå¤„ç†ï¼Œæ‰§è¡Œç»“æŸåä¼šè‡ªåŠ¨æäº¤äº‹åŠ¡ï¼Œå¹¶å¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚
ä½†æ˜¯ï¼Œå¦‚æœä½ ç»™æ–¹æ³•åŠ ä¸Šäº†`Transactional`æ³¨è§£çš„è¯ï¼Œè¿™ä¸ªæ–¹æ³•æ‰§è¡Œçš„æ‰€æœ‰`sql`ä¼šè¢«æ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ã€‚å¦‚æœå£°æ˜äº†åªè¯»äº‹åŠ¡çš„è¯ï¼Œæ•°æ®åº“å°±ä¼šå»ä¼˜åŒ–å®ƒçš„æ‰§è¡Œï¼Œå¹¶ä¸ä¼šå¸¦æ¥å…¶ä»–çš„ä»€ä¹ˆæ”¶ç›Šã€‚
å¦‚æœä¸åŠ `Transactional`ï¼Œæ¯æ¡`sql`ä¼šå¼€å¯ä¸€ä¸ªå•ç‹¬çš„äº‹åŠ¡ï¼Œä¸­é—´è¢«å…¶å®ƒäº‹åŠ¡æ”¹äº†æ•°æ®ï¼Œéƒ½ä¼šå®æ—¶è¯»å–åˆ°æœ€æ–°å€¼ã€‚
åˆ†äº«ä¸€ä¸‹å…³äºäº‹åŠ¡åªè¯»å±æ€§ï¼Œå…¶ä»–äººçš„è§£ç­”ï¼š
- å¦‚æœä½ ä¸€æ¬¡æ‰§è¡Œå•æ¡æŸ¥è¯¢è¯­å¥ï¼Œåˆ™æ²¡æœ‰å¿…è¦å¯ç”¨äº‹åŠ¡æ”¯æŒï¼Œæ•°æ®åº“é»˜è®¤æ”¯æŒ SQL æ‰§è¡ŒæœŸé—´çš„è¯»ä¸€è‡´æ€§ï¼›
- å¦‚æœä½ ä¸€æ¬¡æ‰§è¡Œå¤šæ¡æŸ¥è¯¢è¯­å¥ï¼Œä¾‹å¦‚ç»Ÿè®¡æŸ¥è¯¢ï¼ŒæŠ¥è¡¨æŸ¥è¯¢ï¼Œåœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œå¤šæ¡æŸ¥è¯¢ SQL å¿…é¡»ä¿è¯æ•´ä½“çš„è¯»ä¸€è‡´æ€§ï¼Œå¦åˆ™ï¼Œåœ¨å‰æ¡ SQL æŸ¥è¯¢ä¹‹åï¼Œåæ¡ SQL æŸ¥è¯¢ä¹‹å‰ï¼Œæ•°æ®è¢«å…¶ä»–ç”¨æˆ·æ”¹å˜ï¼Œåˆ™è¯¥æ¬¡æ•´ä½“çš„ç»Ÿè®¡æŸ¥è¯¢å°†ä¼šå‡ºç°è¯»æ•°æ®ä¸ä¸€è‡´çš„çŠ¶æ€ï¼Œæ­¤æ—¶ï¼Œåº”è¯¥å¯ç”¨äº‹åŠ¡æ”¯æŒ
#### äº‹åŠ¡å›æ»šè§„åˆ™
è¿™äº›è§„åˆ™å®šä¹‰äº†å“ªäº›å¼‚å¸¸ä¼šå¯¼è‡´äº‹åŠ¡å›æ»šè€Œå“ªäº›ä¸ä¼šã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œäº‹åŠ¡åªæœ‰é‡åˆ°è¿è¡ŒæœŸå¼‚å¸¸ï¼ˆ`RuntimeException` çš„å­ç±»ï¼‰æ—¶æ‰ä¼šå›æ»šï¼Œ`Error` ä¹Ÿä¼šå¯¼è‡´äº‹åŠ¡å›æ»šï¼Œä½†æ˜¯ï¼Œåœ¨é‡åˆ°æ£€æŸ¥å‹ï¼ˆCheckedï¼‰å¼‚å¸¸æ—¶ä¸ä¼šå›æ»šã€‚
![](./images/spring-transaction/roollbackFor.png)
å¦‚æœä½ æƒ³è¦å›æ»šä½ å®šä¹‰çš„ç‰¹å®šçš„å¼‚å¸¸ç±»å‹çš„è¯ï¼Œå¯ä»¥è¿™æ ·ï¼š
```java
@Transactional(rollbackFor= MyException.class)
```
### @Transactional æ³¨è§£ä½¿ç”¨è¯¦è§£
#### `@Transactional` çš„ä½œç”¨èŒƒå›´
1. **æ–¹æ³•**ï¼šæ¨èå°†æ³¨è§£ä½¿ç”¨äºæ–¹æ³•ä¸Šï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼š**è¯¥æ³¨è§£åªèƒ½åº”ç”¨åˆ° public æ–¹æ³•ä¸Šï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆã€‚**
2. **ç±»**ï¼šå¦‚æœè¿™ä¸ªæ³¨è§£ä½¿ç”¨åœ¨ç±»ä¸Šçš„è¯ï¼Œè¡¨æ˜è¯¥æ³¨è§£å¯¹è¯¥ç±»ä¸­æ‰€æœ‰çš„ public æ–¹æ³•éƒ½ç”Ÿæ•ˆã€‚
3. **æ¥å£**ï¼šä¸æ¨èåœ¨æ¥å£ä¸Šä½¿ç”¨ã€‚
#### `@Transactional` çš„å¸¸ç”¨é…ç½®å‚æ•°
`@Transactional`æ³¨è§£æºç å¦‚ä¸‹ï¼Œé‡Œé¢åŒ…å«äº†åŸºæœ¬äº‹åŠ¡å±æ€§çš„é…ç½®ï¼š
```java
@Target({ElementType.TYPE, ElementType.METHOD})
@Retention(RetentionPolicy.RUNTIME)
@Inherited
@Documented
public @interface Transactional {
  @AliasFor("transactionManager")
  String value() default "";
  @AliasFor("value")
  String transactionManager() default "";
  Propagation propagation() default Propagation.REQUIRED;
  Isolation isolation() default Isolation.DEFAULT;
  int timeout() default TransactionDefinition.TIMEOUT_DEFAULT;
  boolean readOnly() default false;
  Class[] rollbackFor() default {};
  String[] rollbackForClassName() default {};
  Class[] noRollbackFor() default {};
  String[] noRollbackForClassName() default {};
}
```
**`@Transactional` çš„å¸¸ç”¨é…ç½®å‚æ•°æ€»ç»“ï¼ˆåªåˆ—å‡ºäº† 5 ä¸ªæˆ‘å¹³æ—¶æ¯”è¾ƒå¸¸ç”¨çš„ï¼‰ï¼š**
| å±æ€§å      | è¯´æ˜                                                                                         |
| :---------- | :------------------------------------------------------------------------------------------- |
| propagation | äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼Œé»˜è®¤å€¼ä¸º REQUIREDï¼Œå¯é€‰çš„å€¼åœ¨ä¸Šé¢ä»‹ç»è¿‡                                      |
| isolation   | äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œé»˜è®¤å€¼é‡‡ç”¨ DEFAULTï¼Œå¯é€‰çš„å€¼åœ¨ä¸Šé¢ä»‹ç»è¿‡                                     |
| timeout     | äº‹åŠ¡çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤å€¼ä¸º-1ï¼ˆä¸ä¼šè¶…æ—¶ï¼‰ã€‚å¦‚æœè¶…è¿‡è¯¥æ—¶é—´é™åˆ¶ä½†äº‹åŠ¡è¿˜æ²¡æœ‰å®Œæˆï¼Œåˆ™è‡ªåŠ¨å›æ»šäº‹åŠ¡ã€‚ |
| readOnly    | æŒ‡å®šäº‹åŠ¡æ˜¯å¦ä¸ºåªè¯»äº‹åŠ¡ï¼Œé»˜è®¤å€¼ä¸º falseã€‚                                                     |
| rollbackFor | ç”¨äºæŒ‡å®šèƒ½å¤Ÿè§¦å‘äº‹åŠ¡å›æ»šçš„å¼‚å¸¸ç±»å‹ï¼Œå¹¶ä¸”å¯ä»¥æŒ‡å®šå¤šä¸ªå¼‚å¸¸ç±»å‹ã€‚                               |
#### `@Transactional` äº‹åŠ¡æ³¨è§£åŸç†
é¢è¯•ä¸­åœ¨é—® AOP çš„æ—¶å€™å¯èƒ½ä¼šè¢«é—®åˆ°çš„ä¸€ä¸ªé—®é¢˜ã€‚ç®€å•è¯´ä¸‹å§ï¼
æˆ‘ä»¬çŸ¥é“ï¼Œ**`@Transactional` çš„å·¥ä½œæœºåˆ¶æ˜¯åŸºäº AOP å®ç°çš„ï¼ŒAOP åˆæ˜¯ä½¿ç”¨åŠ¨æ€ä»£ç†å®ç°çš„ã€‚å¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šé‡‡ç”¨ JDK çš„åŠ¨æ€ä»£ç†ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°äº†æ¥å£,ä¼šä½¿ç”¨ CGLIB åŠ¨æ€ä»£ç†ã€‚**
ğŸ¤ å¤šæä¸€å˜´ï¼š`createAopProxy()` æ–¹æ³• å†³å®šäº†æ˜¯ä½¿ç”¨ JDK è¿˜æ˜¯ Cglib æ¥åšåŠ¨æ€ä»£ç†ï¼Œæºç å¦‚ä¸‹ï¼š
```java
public class DefaultAopProxyFactory implements AopProxyFactory, Serializable {
  @Override
  public AopProxy createAopProxy(AdvisedSupport config) throws AopConfigException {
    if (config.isOptimize() || config.isProxyTargetClass() || hasNoUserSuppliedProxyInterfaces(config)) {
      Class targetClass = config.getTargetClass();
      if (targetClass == null) {
        throw new AopConfigException("TargetSource cannot determine target class: " +
            "Either an interface or a target is required for proxy creation.");
      }
      if (targetClass.isInterface() || Proxy.isProxyClass(targetClass)) {
        return new JdkDynamicAopProxy(config);
      }
      return new ObjenesisCglibAopProxy(config);
    }
    else {
      return new JdkDynamicAopProxy(config);
    }
  }
  .......
}
```
å¦‚æœä¸€ä¸ªç±»æˆ–è€…ä¸€ä¸ªç±»ä¸­çš„ public æ–¹æ³•ä¸Šè¢«æ ‡æ³¨`@Transactional` æ³¨è§£çš„è¯ï¼ŒSpring å®¹å™¨å°±ä¼šåœ¨å¯åŠ¨çš„æ—¶å€™ä¸ºå…¶åˆ›å»ºä¸€ä¸ªä»£ç†ç±»ï¼Œåœ¨è°ƒç”¨è¢«`@Transactional` æ³¨è§£çš„ public æ–¹æ³•çš„æ—¶å€™ï¼Œå®é™…è°ƒç”¨çš„æ˜¯ï¼Œ`TransactionInterceptor` ç±»ä¸­çš„ `invoke()`æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯åœ¨ç›®æ ‡æ–¹æ³•ä¹‹å‰å¼€å¯äº‹åŠ¡ï¼Œæ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚æœé‡åˆ°å¼‚å¸¸çš„æ—¶å€™å›æ»šäº‹åŠ¡ï¼Œæ–¹æ³•è°ƒç”¨å®Œæˆä¹‹åæäº¤äº‹åŠ¡ã€‚
> `TransactionInterceptor` ç±»ä¸­çš„ `invoke()`æ–¹æ³•å†…éƒ¨å®é™…è°ƒç”¨çš„æ˜¯ `TransactionAspectSupport` ç±»çš„ `invokeWithinTransaction()`æ–¹æ³•ã€‚ç”±äºæ–°ç‰ˆæœ¬çš„ Spring å¯¹è¿™éƒ¨åˆ†é‡å†™å¾ˆå¤§ï¼Œè€Œä¸”ç”¨åˆ°äº†å¾ˆå¤šå“åº”å¼ç¼–ç¨‹çš„çŸ¥è¯†ï¼Œè¿™é‡Œå°±ä¸åˆ—æºç äº†ã€‚
#### Spring AOP è‡ªè°ƒç”¨é—®é¢˜
å½“ä¸€ä¸ªæ–¹æ³•è¢«æ ‡è®°äº†`@Transactional` æ³¨è§£çš„æ—¶å€™ï¼ŒSpring äº‹åŠ¡ç®¡ç†å™¨åªä¼šåœ¨è¢«å…¶ä»–ç±»æ–¹æ³•è°ƒç”¨çš„æ—¶å€™ç”Ÿæ•ˆï¼Œè€Œä¸ä¼šåœ¨ä¸€ä¸ªç±»ä¸­æ–¹æ³•è°ƒç”¨ç”Ÿæ•ˆã€‚
è¿™æ˜¯å› ä¸º Spring AOP å·¥ä½œåŸç†å†³å®šçš„ã€‚å› ä¸º Spring AOP ä½¿ç”¨åŠ¨æ€ä»£ç†æ¥å®ç°äº‹åŠ¡çš„ç®¡ç†ï¼Œå®ƒä¼šåœ¨è¿è¡Œçš„æ—¶å€™ä¸ºå¸¦æœ‰ `@Transactional` æ³¨è§£çš„æ–¹æ³•ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œå¹¶åœ¨æ–¹æ³•è°ƒç”¨çš„å‰ååº”ç”¨äº‹ç‰©é€»è¾‘ã€‚å¦‚æœè¯¥æ–¹æ³•è¢«å…¶ä»–ç±»è°ƒç”¨æˆ‘ä»¬çš„ä»£ç†å¯¹è±¡å°±ä¼šæ‹¦æˆªæ–¹æ³•è°ƒç”¨å¹¶å¤„ç†äº‹åŠ¡ã€‚ä½†æ˜¯åœ¨ä¸€ä¸ªç±»ä¸­çš„å…¶ä»–æ–¹æ³•å†…éƒ¨è°ƒç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä»£ç†å¯¹è±¡å°±æ— æ³•æ‹¦æˆªåˆ°è¿™ä¸ªå†…éƒ¨è°ƒç”¨ï¼Œå› æ­¤äº‹åŠ¡ä¹Ÿå°±å¤±æ•ˆäº†ã€‚
`MyService` ç±»ä¸­çš„`method1()`è°ƒç”¨`method2()`å°±ä¼šå¯¼è‡´`method2()`çš„äº‹åŠ¡å¤±æ•ˆã€‚
```java
@Service
public class MyService {
private void method1() {
     method2();
     //......
}
@Transactional
 public void method2() {
     //......
  }
}
```
è§£å†³åŠæ³•å°±æ˜¯é¿å…åŒä¸€ç±»ä¸­è‡ªè°ƒç”¨æˆ–è€…ä½¿ç”¨ AspectJ å–ä»£ Spring AOP ä»£ç†ã€‚
[issue #2091](https://github.com/Snailclimb/JavaGuide/issues/2091)è¡¥å……äº†ä¸€ä¸ªä¾‹å­ï¼š
```java
@Service
public class MyService {
private void method1() {
     ((MyService)AopContext.currentProxy()).method2(); // å…ˆè·å–è¯¥ç±»çš„ä»£ç†å¯¹è±¡ï¼Œç„¶åé€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨method2ã€‚
     //......
}
@Transactional
 public void method2() {
     //......
  }
}
```
ä¸Šé¢çš„ä»£ç ç¡®å®å¯ä»¥åœ¨è‡ªè°ƒç”¨çš„æ—¶å€™å¼€å¯äº‹åŠ¡ï¼Œä½†æ˜¯è¿™æ˜¯å› ä¸ºä½¿ç”¨äº† `AopContext.currentProxy()` æ–¹æ³•æ¥è·å–å½“å‰ç±»çš„ä»£ç†å¯¹è±¡ï¼Œç„¶åé€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ `method2()`ã€‚è¿™æ ·å°±ç›¸å½“äºä»å¤–éƒ¨è°ƒç”¨äº† `method2()`ï¼Œæ‰€ä»¥äº‹åŠ¡æ³¨è§£æ‰ä¼šç”Ÿæ•ˆã€‚æˆ‘ä»¬ä¸€èˆ¬ä¹Ÿä¸ä¼šåœ¨ä»£ç ä¸­è¿™ä¹ˆå†™ï¼Œæ‰€ä»¥å¯ä»¥å¿½ç•¥è¿™ä¸ªç‰¹æ®Šçš„ä¾‹å­ã€‚
#### `@Transactional` çš„ä½¿ç”¨æ³¨æ„äº‹é¡¹æ€»ç»“
- `@Transactional` æ³¨è§£åªæœ‰ä½œç”¨åˆ° public æ–¹æ³•ä¸Šäº‹åŠ¡æ‰ç”Ÿæ•ˆï¼Œä¸æ¨èåœ¨æ¥å£ä¸Šä½¿ç”¨ï¼›
- é¿å…åŒä¸€ä¸ªç±»ä¸­è°ƒç”¨ `@Transactional` æ³¨è§£çš„æ–¹æ³•ï¼Œè¿™æ ·ä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆï¼›
- æ­£ç¡®çš„è®¾ç½® `@Transactional` çš„ `rollbackFor` å’Œ `propagation` å±æ€§ï¼Œå¦åˆ™äº‹åŠ¡å¯èƒ½ä¼šå›æ»šå¤±è´¥;
- è¢« `@Transactional` æ³¨è§£çš„æ–¹æ³•æ‰€åœ¨çš„ç±»å¿…é¡»è¢« Spring ç®¡ç†ï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆï¼›
- åº•å±‚ä½¿ç”¨çš„æ•°æ®åº“å¿…é¡»æ”¯æŒäº‹åŠ¡æœºåˆ¶ï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆï¼›
- â€¦â€¦
## å‚è€ƒ
- [æ€»ç»“]Spring äº‹åŠ¡ç®¡ç†ä¸­@Transactional çš„å‚æ•°:[http://www.mobabel.net/spring äº‹åŠ¡ç®¡ç†ä¸­ transactional çš„å‚æ•°/](http://www.mobabel.net/springäº‹åŠ¡ç®¡ç†ä¸­transactionalçš„å‚æ•°/)
- Spring å®˜æ–¹æ–‡æ¡£ï¼š[https://docs.spring.io/spring/docs/4.2.x/spring-framework-reference/html/transaction.html](https://docs.spring.io/spring/docs/4.2.x/spring-framework-reference/html/transaction.html)
- ã€ŠSpring5 é«˜çº§ç¼–ç¨‹ã€‹
- é€å½»çš„æŒæ¡ Spring ä¸­@transactional çš„ä½¿ç”¨: [https://www.ibm.com/developerworks/cn/java/j-master-spring-transactional-use/index.html](https://www.ibm.com/developerworks/cn/java/j-master-spring-transactional-use/index.html)
- Spring äº‹åŠ¡çš„ä¼ æ’­ç‰¹æ€§ï¼š[https://github.com/love-somnus/Spring/wiki/Spring äº‹åŠ¡çš„ä¼ æ’­ç‰¹æ€§](https://github.com/love-somnus/Spring/wiki/Springäº‹åŠ¡çš„ä¼ æ’­ç‰¹æ€§)
- [Spring äº‹åŠ¡ä¼ æ’­è¡Œä¸ºè¯¦è§£](https://segmentfault.com/a/1190000013341344)ï¼š[https://segmentfault.com/a/1190000013341344](https://segmentfault.com/a/1190000013341344)
- å…¨é¢åˆ†æ Spring çš„ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†åŠå£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼š[https://www.ibm.com/developerworks/cn/education/opensource/os-cn-spring-trans/index.html](https://www.ibm.com/developerworks/cn/education/opensource/os-cn-spring-trans/index.html)