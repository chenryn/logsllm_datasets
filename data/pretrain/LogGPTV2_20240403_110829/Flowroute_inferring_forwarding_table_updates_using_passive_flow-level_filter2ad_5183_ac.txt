Figure 5: (a) Initial topology (b) A updates its next
hop and forwards to B, but B is late to update, and
continues to forward to A, resulting in a loop. (c) B
updates its next hop and starts forwarding to D.
We next examine the relationship between the late for-
warding table update phenomenon and transient routing
loops. We found that of the 58 OSPF event clusters in
which we observed late forwarding table updates, 33 were
accompanied by transient one hop loops. Figure 5(a) shows
the initial network topology for one such event. Figure 6
shows the route changes at routers A and B as they react
to the OSPF event cluster which runs from approximately
time 33280 to 33345 (seconds since the start of that day).
This OSPF event cluster includes a cost-out event for link
C-E, i.e., the link metric is increased such that it will not
be part of any computed shortest path. The top graph in
ﬁgure 6 shows that the forwarding table changes for router
6Our analysis focused on loops between adjacent routers;
it can be easily extended to loops involving three or more
routers.
319A: C->B
OSPF events
 33260  33280  33300  33320  33340  33360  33380  33400
B: A->D
OSPF events
 33260  33280  33300  33320  33340  33360  33380  33400
A: C->B
B: A->D
OSPF events
 33260  33280  33300  33320  33340  33360  33380  33400
util A-B
util B-A
OSPF events
x
e
d
n
i
t
s
e
d
x
e
d
n
i
t
s
e
d
x
e
d
n
i
t
s
e
d
 30
 25
 20
 15
 10
 5
 0
 14
 12
 10
 8
 6
 4
 2
 0
 5
 4
 3
 2
 1
 0
)
%
(
n
o
i
t
a
z
i
l
i
t
u
 50
 45
 40
 35
 30
 25
 20
 15
 10
 5
 0
 33260  33280  33300  33320  33340  33360  33380  33400
time
Figure 6: Updates by router A are consistent with
OSPF events (top graph). Late updates by router
B towards certain destinations (second graph). Up-
date ranges for routers A and B for the same set of
destinations (third graph). Spikes in the utilization
of links A-B and B-A (bottom graph).
A are consistent with OSPF events (A changes its next hop
from C to B). The second graph in Figure 6 shows that
the forwarding table changes for router B towards certain
destinations occur several seconds later (B changes its next
hop from A to D). The third graph in Figure 6 shows the
transition ranges for routers A and B towards the set of
destinations for which B updated late. From time around
33320 to 33360, A is forwarding packets towards B (because
it has already changed its next hop), and B is forwarding
packets to A (because it has not yet changed its next hop).
Figure 5(b) shows the situation from time around 33320 to
33360. Router A has updated its forwarding table to use B
as its next hop. Router C has also updated its forwarding
table to use A as its next hop. However, router B has not
updated its forwarding table, causing a forwarding loop be-
tween A and B. Figure 5(c) shows the situation after time
33360, when router B has updated its forwarding table to
use router D as its next hop; routing has stabilized.
The bottom graph in Figure 6 shows the utilization on
links A-B and B-A, averaged over 10 second intervals dur-
ing this event. Link utilization increases in both directions
during the routing loop. Though route changes at other
routers could impact utilization on these links (which could
explain why the utilization in the direction A-B is higher
than in the direction B-A), the fact that the spikes persist
only during the loop suggest that they are primarily due to
the routing loop.
6. DISCUSSION
We presented FlowRoute, a tool that uses passive ﬂow-
level measurements and works in conjunction with existing
control plane monitors to study forwarding table dynamics.
FlowRoute identiﬁed cases of delayed forwarding table up-
dates and routing loops in a large tier-1 ISP network. These
results are signiﬁcant, as such anomalies are undetectable
using control plane monitors alone. Before concluding, we
mention ways in which the beneﬁt of FlowRoute could be
improved in the future.
6.1 Network-wide effects of routing changes
As FlowRoute uses data collected from hundreds of routers
in the ISP’s network, operators can use it to quantify the
network-wide eﬀects of routing changes. For example, we
have used FlowRoute to measure how many routers in the
network were “aﬀected” by a routing change (in the sense
that traﬃc traversing those routers was re-routed). Fur-
ther, we have used FlowRoute to measure traﬃc shifts and
changes in link utilization caused by routing events – at a
ﬁner time resolution than is possible with SNMP-based ap-
proaches. Due to space constraints, we could not present the
results of measuring network-wide eﬀects of routing changes.
6.2 Flexible Netﬂow
We expect that Flexible Netﬂow [5] will eventually make
its way into production networks. Flexible Netﬂow allows
operators to conﬁgure the ﬁelds that are part of the ﬂow
key. In particular, we could have the ﬂow key consist of the
input interface, output interface, and destination, where the
destination refers to the iBGP next hop (see Section 4.1).
Using this feature, the router can directly export a Routing
Flow Record as deﬁned in Section 3. These records, which
would be generated directly by the router and which would
include ﬁrst and last packet timestamps, would allow us to
get more detailed timing information about routing changes.
Flexible Netﬂow can also help to overcome some of the prob-
lems of packet and ﬂow sampling, which aﬀect FlowRoute’s
temporal resolution. As mentioned in Section 4.3, we can
augment existing traﬃc with additional active probes, and
Flexible NetFlow can be conﬁgured to select all probe pack-
ets based on a pre-deﬁned signature. We can then set the
active probing rate to achieve a desired temporal resolution.
6.3 Online FlowRoute
FlowRoute, as described in this paper, uses an oﬄine ap-
proach. The method relies on collecting Netﬂow records
from diﬀerent routers and creating Routing Flow Records
using topology data collected by SNMP. Currently, FlowRoute
requires on the order of a few hours to process a day’s worth
of Netﬂow data from several hundred routers. There is no
reason a priori that this paradigm could not be extended to
work in near real-time. Such a system would run a collector
that aggregates and processes ﬂow-level measurements from
multiple routers and provides alerts about routing events.
Tackling the systems and scalability issues involved in mak-
ing FlowRoute near-online is a direction we plan to pursue
in future work.
3207. REFERENCES
[1] S. Agarwal, C.-N. Chuah, S. Bhattacharyya, and
C. Diot. The Impact of BGP Dynamics on
Intra-domain Traﬃc. SIGMETRICS Performance
Evaluation Review, 32(1):319–330, 2004.
[2] S. Agarwal, A. Nucci, and S. Bhattacharyya.
Measuring the Shared Fate of IGP Engineering and
Interdomain Traﬃc. In Proc. of the 13TH IEEE
International Conference on Network Protocols
(ICNP), pages 236–245, Sept. 2005.
[3] B. Augustin, X. Cuvellier, B. Orgogozo, F. Viger,
T. Friedman, M. Latapy, C. Magnien, and R. Teixeira.
Avoiding Traceroute Anomalies with Paris Traceroute.
In Proc. ACM SIGCOMM Internet Measurement
Conference (IMC), Oct. 2006.
[4] Cisco. Cisco IOS Netﬂow.
http://www.cisco.com/en/US/products/ps6601/
products_ios_protocol_group_home.html.
[5] Cisco. IOS Flexible NetFlow Technology.
http://www.cisco.com/en/US/prod/collateral/
iosswrel/ps6537/ps6555/ps6601/ps6965/prod_
white_paper0900aecd804be1cc.html.
[6] Cisco. NetFlow BGP Next Hop Support.
http://www.cisco.com/en/US/docs/ios/12_3/
feature/guide/nfbgpnxt.html.
[7] N. Duﬃeld and C. Lund. Predicting Resource Usage
and Estimation Accuracy in an IP Flow Measurement
Collection Infrastructure. In Proc. Internet
Measurement Conference (IMC), Oct. 2003.
[8] N. Duﬃeld, C. Lund, and M. Thorup. Estimating
Flow Distributions from Sampled Flow Statistics.
IEEE/ACM Transactions on Networking,
13(5):933–946, 2005.
[9] A. Feldmann and J. Rexford. IP Network
Conﬁguration for Intradomain Traﬃc Engineering.
IEEE Network Magazine, 15:46–57, 2001.
[10] C. Fraleigh, C. Diot, B. Lyles, S. Moon, P. Owezarski,
K. Papagiannaki, and F. Tobagi. Design and
Deployment of a Passive Monitoring Infrastructure. In
Passive and Active Measurement (PAM) Workshop,
Amsterdam, Apr. 2001.
[11] Y. Gu, L. Breslau, N. Duﬃeld, and S. Sen. On Passive
One-Way Loss Measurements Using Sampled Flow
Statistics. In Proc. IEEE Infocom mini-conference,
Jul. 2009.
[12] C. Labovitz, A. Ahuja, A. Bose, and F. Jahanian.
Delayed Internet Routing Convergence. IEEE/ACM
Transactions on Networking, 9(3):293–306, 2001.
[13] A. Medina, N. Taft, K. Salamatian, S. Bhattacharyya,
and C. Diot. Traﬃc Matrix Estimation: Existing
Techniques and New Directions. SIGCOMM Computer
Communications Review, 32(4):161–174, 2002.
[14] D. Mills. Network Time Protocol (Version 3)
Speciﬁcation, Implementation and Analysis. RFC
1305, 1992.
[15] J. Moy. OSPF Version 2. RFC 2328, April 1998.
[16] Packet Design. Route Explorer.
http://www.packetdesign.com/products/rex.htm.
[17] K. Papagiannaki, S. Moon, C. Fraleigh, P.Thiran, and
C. Diot. Measurement and Analysis of Single-Hop
Delay on an IP Backbone Network. In In IEEE
Journal on Selected Areas in Communications, Special
Issue on Internet and WWW Measurement, Mapping,
and Modeling, volume 21, 2003.
[18] H. Pucha, Y. Zhang, , Z. M. Mao, and Y. C. Hu.
Understanding Network Delay Changes Caused by
Routing Events. SIGMETRICS Performance
Evaluation Review, 35(1):73–84, 2007.
[19] RIPE. RIPE Network Coordination Centre.
http://www.ripe.net.
[20] Routeviews. University of Oregon Route Views
Project. http://www.routeviews.org.
[21] A. Shaikh and A. Greenberg. OSPF Monitoring:
Architecture, Design and Deployment Experience. In
Proc. USENIX Symposium on Networked Systems
Design and Implementation (NSDI), Mar. 2004.
[22] R. Teixeira, N. Duﬃeld, J. Rexford, and M. Roughan.
Traﬃc Matrix Reloaded: Impact of Routing Changes.
In in Proc. Passive and Active Measurement (PAM)
Workshop, Mar. 2005.
[23] F. Wang, Z. M. Mao, J. Wang, L. Gao, and R. Bush.
A Measurement Study on the Impact of Routing
Events on End-to-end Internet Path Performance.
SIGCOMM Computer Communications Review
(CCR), 36(4):375–386, 2006.
321