Immediatety Detaut
Edit
Remove
5
Sendmessage touser groups:Databasemanagervia Email
02:00:00
Defautt
Edit
Remove
6
Runremotecomm
nands on current host
02:30:00
Defautt
Edit
Remove
7
Sendmessage touser groups:Guests viaEmail
03:00:00
Detault
Edt
Rermove
9
Runremotecomm
handson current host
04:00:00
Default
Edit
Remove
ew
图6-44
171
---
## Page 188
Zabbix企业级分布式监控系统
·用户MySQLAdministrations每隔半个小时发送一次告警。
●用户Databasemanager在事件发生后的2小时发送告警信息。
●在2小时30分钟后，执行远程重启MySQL的命令。
·在3小时后，即执行远程命令后并未解决问题，发送告警消息给用户Guests。
·在4小时后，通过IPMI对机器执行远程重启命令。
示例4：告警升级的配置如图6-45所示。
ActionConditionsOperations
Defaut operation stepduration1800(minimum60 seconds)
Actionoperations
Steps Details
Start inDuration (sec) Action
1-4Send message to user groups:MySQLAdministrators va EmailImmediately Detault
EdiRemove
5-6Sendmessage to user groups:DatabasemanagerviaEmal0200:003600
EditRemove
5-7Sendmessage to user groups:Zabbix administratorsva Email02:00:00600
EdnRemove
Sendmessagetousergroups:GuestsvaEmal
04:00:00Default
EdrRemove
New
图6-45
假如事件故障在00:00时刻发生，那么
●用户MySQLadministrators在事件发生后的0:00、0:30、1:00、1:30时间内，
将会收到告警信息。
●用户Databasemanager在2:00和2:10时间内收到告警信息。（这里为什么
不是3：00？看到5、6步骤，设置被后面的5、7步骤的600s替代。）
●用户Zabbix administrators在2:00、2:10、2:20时间内收到告警信息，时间
间隔为600s。
·用户guest在4:00受到告警信息。（步骤8～11是用默认的时间间隔半个
小时。）
综上所述，当Steps设置为从1到0时，会一直发送告警信息，直到事件状
态变成OK，当Steps设置为从1到1时，则只会发送一次告警，后面不会继续发
送告警信息。
6.8告警配置故障排查
告警达到触发器设置的条件时，在事件中也可以看到，但未收到告警信息。
影响告警发送的条件如下。
·告警脚本权限、告警账户是否配置正确。
·用户对发送告警信息的机器是否有可读权限，这一点非常重要。
·告警信息的接收方是否拒绝接收告警信息，在某些情况下，告警信息会被
当作垃圾信息给屏蔽了。
172
---
## Page 189
第6章
告警配置
·告警配置是否正确，是否达到了触发器设置的阈值，Action中的条件是否
正确，是否在维护状态。
如何查看告警发送失败的日志呢？单击Administration→Audit→Actions，在
这里可以看到告警信息的日志。
1.告警信息未发送的示例
如图6-46所示，在Monitoring→Triggers 中看到故障已经发生，但是为何没
有发送告警呢？
Triggers
Displaying1 to3of 3found
Fiter
Severity
Status
InfoLast chanqe 
Age
Acknowledged
Host
Average
PROBLEM
20 Dec 2013 18:06:00
8m32s
Acknowledqe (1)
Zabbix server
图6-46
查看日志（单击Administration→Audit→Actions），状态未发送，如图6-47
所示。原因是用户没有定义发送介质，如图6-48所示。
Zabbix-Server
禁作界面友好
agentd:ip+10050
snmp:ip+161
JMXmanag
ipmiip+623
ementAPI
jmxip+10053
DB
Tomcat等应用程序的监控，开启参数
-Dcom.sun.management.jmxremote
Dcom.sun.management.jmxremote.port=10053
www.itnihao.com
-Dcom.sun.management.jmxremote.ssl=false
图7-4
对于其他的监控方式，其原理与图7-4类似。
3Agent监控方式
7.3
Agent 分为主动和被动两种方式，关于Agent 的监控，第5 章进行了详细
讲解，在第8章中，将对主动和被动两种工作模式进行详细讲解。
4Trapper监控方式
7.4
Trapper是发送任意的数据给Zabbix-Server，采用主动推送的方式，与主动模
式有一些相同，但又有区别，其区别在于Trapper不需要安装客户端，Key的名称
是可以灵活定义的，这意味着Zabbix-Server可以获取需要的任意数据。
在Trapper的工作模式中，Zabbix数据发送的程序是zabbix-sender。
177
---
## Page 194
Zabbix企业级分布式监控系统
7.4.1Trapper的配置步骤
Trapper的配置步骤如下。
①添加主机，需要配置Host name（Trapper的数据处理方式为主机名，而不
是IP地址)。
②配置Items 的类型为Trapper，添加需要的Key（任意定义）。
③Zabbix-Sender程序发送数据给Zabbix-Server。
④Zabbix-Server对采集到的数据进行处理，最后显示在Web界面中。
7.4.2Trapper的配置示例
如图 7-5所示，添加 Host 的时候，需要配置Host name，且一定要配置唯一
的名称，否则无法获取该设备通过Trapper方式发送的数据。
Host istHost:trapper
Monitored lAoplicatons(o)Items (o）Trigers(O)Graphs(o)Discoveryrules (0）
Host TemplatesIPMIMacrosHost invc
trapper
Visiblename
Groups
Ingroups
Othergroups
《
App-OPs
ZBX-APC-TEMPLATES
Agentinterface
IPaddress
ONSname
192.168.0.200
IPD
Add
SNMPinterfaces
Add
JMXinterfaces
Add
IPMIinterfaces
Add
Monitoredbyproxy
(no proxy）[]
Status
Monitored
Save
图7-5
注意，Agent interfaces 中的 IP address 可以随便填一个，但是为了识别是哪
台机器，方便管理人员查看，需填写真实的IP地址，Zabbix-Server并不会主动
去连接这个IP地址，而是Trapper主动连接Zabbix-Server，所以这里并无实际
的意义。
如图7-6所示，添加ItemS。
●Type：选择Zabbixtrapper。
·Key：是自定义的，只需要与Zabbix-Sender 发送时的Key一致即可。
178
---
## Page 195
第7章
监控方式剖析
Zabbix-Sender发送数据会失败。
●Keephistory（in days）：历史数据保存的天数。
·Allowedhosts：只允许哪台机器发送数据给Zabbix-Server。
Iten
Host
trapper
Name
Type
Zabbixtrapper
回
Key
trapperLog
Typeofinform
Keep history (in days)
06
Allowed hosts
New.application
Applications
-None-
Populates hostin
ntoryfield
-None
Description
Status
Enabled
口
Clon
图7-6
7.4.3使用zabbixsender发送数据
用zabbix_sender程序发送数据到Zabbix-Server，命令如下：
shell# zabbix sender -z 127.0.0.1 -p 10051 -s "trapper"-k trapper
Log -o"trapper workis ok"-vv
zabbix_sender[21368]:DEBUG:answer [
"response":"success",
"info":"Processed 1 Failed 0 Total 1 Seconds spent 0.000036
"}]
info from server: "Processed 1 Failed 0 Total 1 Seconds spent 0.00
0036"
sent:1;skipped:0;total:1
显示已经发送成功。关于zabbix_sender参数，解释如下。
●-z：Zabbix-Server的IP地址。
·-p：Zabbix-Server的端口。
·-s：主机的名称（确保在添加主机的Host name，而不是visible name）。
·-k：自定义的Key。
●-0：发送的数据。
179
---
## Page 196
Zabbix企业级分布式监控系统
如果发送失败，会提示失败，需要检测上面的各参数是否正确。
shell# zabbix_sender -z 127.0.0.1 -p 10051 -s "trapper" -k trapp
zabbix sender [23306]:DEBUG:answer[
"response":"success",
"}]
info from server:"Processed 0 Failed 1 Total 1 Seconds spent 0.00
0130"
sent: 1; skipped: 0; total:1
如图7-7所示，在Latestdata中显示了获取到的数据。
ZABBIX
MonitoringI
board|OverviewWeb|Latestd
s|Graplhs|Screens |Maps |Discovery|IT servic
cs
History:Configuration of host groupsConfiguration of hosts Configuration of itemsDashboard 》Latest data
Items
AFite
Showitemswithnamelike
Show items without data
口
Name
Last check
Last value