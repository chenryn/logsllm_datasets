© 2007 McAfee, Inc.
© 2007 McAfee, Inc.
Trojans – A Reality Check
Looking at what‘s real
Toralv Dirro
EMEA Security Strategist, CISSP
McAfee® Avert® Labs
Dirk Kollberg
Virus Research Lead
McAfee® Avert® Labs
© 2007 McAfee, Inc.
So when did all this start?
3
8/14/2007
History Lesson
• Term coined by Ken Thompson in 1983
• Used to gain privileged access to computers since the 80s
— Keyloggers
— Fake login screens
• ...and to maintain access
— Rootkits
— Backdoors
• or trivial trojans that just delete things
http://www.acm.org/awards/article/a1983-thompson.pdf
4
8/14/2007
The Hype is started
• Defcon 7.0: BO2K is released
• Massive Media attention
• The Hype is started
5
8/14/2007
Hype around Trojans
• 2001: Magic Lantern
— Supposedly developed by the FBI to replace (hardware) keyloggers
• 2007: Der Bundestrojaner
— Proposed by German authorities to enable „online searches“ on suspects 
computers
— >600.000 Google hits
— April‘s Fool Joke around it by the CCC scares thousands
— Estimated cost of development ~200.000 Euro [1]
[1] Drucksache 16/3973 Deutscher Bundestag
© 2007 McAfee, Inc.
And The Reality?
7
8/14/2007
Malware & Potentially Unwated Program Growth
-5000
0
5000
10000
15000
20000
25000
30000
1997
1998
1999
2000
2001
2002
2003
2004
2005
2006
Virus
Trojan
Potentially Unwanted Program
8
8/14/2007
Samples sent to McAfee Research
2005
2006
Source: McAfee’s statistics
Legacy is defined as: DOS, boot-sector, and Win3.1 viruses
12
3
25
Macro 
7%             
Legacy 
39%
Trojans  
23%
PUPs 
3%
Script 
9%
Bots 
12%
Win 32  
7%
22
3
31
Macro 
5%
Legacy 
26%
Trojans  
31%
PUPs 
3%
Script 
7%
Bots 
22%
Win 32  
6%
60000
50000
40000
30000
20000
10000
0
2004                                2005                        
2006
Bots
Legacy Trojans
Script
Macro Win 32 PUPs
9
8/14/2007
1997 - 2006
Fastest Growing Trojan Types
-2000
0
2000
4000
6000
8000
1997
1998
1999
2000
2001
2002
2003
2004
2005
2006
Password Stealer
Downloader
BackDoor
10
8/14/2007
2007: Q1 Password Stealing Trojan Targets
PWS Variants Classified
0
100
200
300
400
500
600
700
Banker
LegMir
Lineage Gamania
WoW
LDPinch Zhengtu QQPass
Goldun
QQRob
Jan-07
Feb-07
Mar-07
11
8/14/2007
By The End of 2006
1997
End of 2006
Vulnerabilities
400
21,400
Password Stealers
400
13,600
Potentially Unwanted 
Programs
1
23,000
Viruses and Trojans
17,000
222,000
Spam
5%
80+%
12
8/14/2007
Real Data from Customers
•
Last 18 months detection
— W32/Sober@mm!681
8.362.071
MassMailer
— W32/Sober.gen@mm
479.392
MassMailer
— Adware/abetterintrnt.gen.a
318.556
Adware
— W32/Netsky.p
286.998
MassMailer
— Generic Malware.a!zip
202.929
Trojan
— New Malware.j
198.962
Trojan
— W32/Almanahe.c
63.452
Virus, Poly, Rootkit
— Vundo.dll
54.579
Trojan
— Downloader.AAP
46.870
Downloader
— Downloader.BAI!M711
28.093
Downloader
— PWS-Goldun
21.403
PasswordStealer
— PWS-Legmir
4.100
PasswordStealer
13
8/14/2007
Real Data from Customers
From this list ranked with detections in 2007 only
1. New Malware.j
Trojan
2. W32/Almanahe.c
Virus, Poly, Rootkit, Downloader
4. Vundo.dll
Trojan
5. Downloader.AAP
Downloader
6. Downloader.BAI!M711
Downloader
14
8/14/2007
Real Data from Customers
• Worms/Bots?
— Many dozens
— All different
— Small numbers, most below 20 unique detections
15
8/14/2007
Real Data from Customers
• Worms/Bots?
— Many dozens
— All different
— Small numbers, most below 20 unique detections
• And some fun detections...
— Parity Boot 
(2 detections)
— PS-Kill 
(1033 detections)
— SymbOS/Comwarrior.a  (544 detections? WTF!)
16
8/14/2007
2007: Q1 Trends
• 1,833 vulnerabilities in the National Vulnerability DB 
—(33% increase over Q1-06)
• 21,579 classified viruses and trojans
—(34% increase over Q1-06)
• 1,379 classified PUPs
—(an 8% decrease over Q1-06)
• 85% of all e-mail considered Spam
• Password Stealing Trojans targeting banks and game accounts
© 2007 McAfee, Inc.
Malware for Money
18
8/14/2007
Installing Adware on compromised machines
• Common practise to make money with a botnet
• Pay-per-install programs offered by various companies
— Price depends on region where the victim is located
— Ranges from $0.05 to $0.50 
• Financial Motivation caused major changes why people 
write Malware and what kind of Malware is written
19
8/14/2007
Advertised Prices for various items
• United States-based credit card with card verification value
$1–$6
• United Kingdom-based credit card with card verification value
$2–$12
• List of 29,000 emails
$5
• Online banking account with a $9,900 balance
$300
• Yahoo Mail cookie exploit—advertised to facilitate full access 
when successful
$3
• Valid Yahoo and Hotmail email cookies
$3
• Compromised computer
$6–$20
• Phishing Web site hosting—per site
$3–5
• Verified PayPal account with balance (balance varies)
$50–$500
• Unverified PayPal account with balance (balance varies)
$10–$50
• Skype account
$12
• World of Warcraft account—one month duration
$10
Source:Symantec Internet Security Threat Report
20
8/14/2007
21
8/14/2007
The cost of cyber crime tools
•
SNATCH TROJAN: It steals passwords and has rootkit functionalities: US$600. 
•
FTP checker: a program to validate stolen FTP accounts. You load the list of FTP accounts and it automatically checks if the user 
and the password is correct for each account, separating the valid accounts from the invalid ones: US$15.
•
Dream Bot Builder: It floods servers for only US$500 + US$25 for update.
•
•
Pinch: a make-to-order Trojan creator. US$30. Update: US$5
•
Keylogger Teller 2.0: keylogger; uses stealth techniques US$40.
•
•
Webmoney Trojan: captures Webmoney accounts: US$500
•
•
WMT-spy: Another Trojan to obtain WebMoney (its creator publishes the results it has obtained in virustotal): an executable 
US$5, updates US$5, the builder costs US$10.
•
MPACK: app that is installed on servers to deploy Trojans onto remote systems using several exploits. The version 0.80 (of 13 
March) is available for US$700.
22
8/14/2007
© 2007 McAfee, Inc.
Obfusicating Trojans to hide from AV
24
8/14/2007
Using Runtime Packers to circumvent AV
Common Packers used by Malware
0
500
1000
1500
2000
2500
3000
3500
4000
4500
5000
24/05/2007
31/05/2007
07/06/2007
14/06/2007
21/06/2007
28/06/2007
MEW
RPCrypt
EXE-Appended
BrowserHelperObj
FSG
Themida
TeLock
ASpack
NSpack
Upack2
PE-Compact2
ASProtect.b
New Installer
UPX
New Packer
© 2007 McAfee, Inc.
Typical „outbreak“ today
26
8/14/2007
Mass Spam of Email with Attachment
Example Downloader-AAP
27
8/14/2007
Mass Spam of Email with Attachment
Example Downloader-AAP
28
8/14/2007
1. User opens Attachment (.zip), double clicks executable
2. Downloader downloads Textfile
3. Textfile gets decoded
4. Binaries are downloaded from decoded URL. This is a 
dropper (Spy-Agent.ba) for the actual Trojan
5. Spy-Agent.ba drops IPV6MOML.DLL to %windir%\System32
6. Spy-Agent.ba.dll gets registered as Browser Helper Object
29
8/14/2007
Stolen Data sent to Attacker
30
8/14/2007
Another Example: Spam-Mespam
• Arrives as Email, IM-Messages (AOL, Yahoo, ICQ), 
Webforum – link to a website in the mail
• User follows link, gets infected
• Spreads from infected machines by injecting the link and 
text in emails, IM Communication from the user
— Messages arrive from a trusted, known person
— High social engineering factor
31
8/14/2007
32
8/14/2007
33
8/14/2007
34
8/14/2007
35
8/14/2007
36
8/14/2007
37
8/14/2007
38
8/14/2007
Victim Distribution Europe
39
8/14/2007
Victim Distribution North America
40
8/14/2007
Victim Distribution APAC
41
8/14/2007
W32/Nuwar@MM, Zhelatin, Postcards ...
42
8/14/2007
W32/Nuwar@MM, Zhelatin, Postcards ...
43
8/14/2007
44
8/14/2007
45
8/14/2007
46
8/14/2007
47
8/14/2007
48
8/14/2007
49
8/14/2007
50
8/14/2007
51
8/14/2007
52
8/14/2007
53
8/14/2007
54
8/14/2007
55
8/14/2007
New C&C Methods
• IRC
— Was public IRC Servers
— Now often private IRC Servers
• Rented Systems
• Owned Boxes
— Plaintext protocol
• HTTP
• HTTPS
• P2P
56
8/14/2007
New C&C Methods
• XML for communication to avoid detection
57
8/14/2007
Bruteforce and Social Engineering
• Bruteforce
— Exploits on Websites
• Detect Browser Type and OS to serve matching exploits
— Exploits in attached multimedia files
— Exploits in attached Office Documents
• Social Engineering
— Executables embedded in Documents
• Email titled ´Proforma Invoice for ...´
• .doc as attachment
• In the document ´DOUBLE CLICK THE ICON ABOVE TO VIEW DETAILS´
— Fake Codec ‚required‘ for multimedia files
58
8/14/2007
Rootkits
• The number of rootkits on 32-bit platforms increases
• approximately 200,000 systems reported rootkit
infestations since the beginning of 2007
• 10 percent increase over the first quarter of 2006
Source:McAfee Research, Virus Tracking Map
59
8/14/2007
Rootkits
• Not commonly used with Trojans today
• But increasing
• Detection and cleaning require 2 steps
— Detection and removal of the Rootkit
— Detection and removal of the Trojan
• Techniques used today can be handled easily
— Virtualization and BIOS-Rootkits not seen, yet
Free Tool: McAfee Rootkit Detective
http://vil.nai.com/vil/averttools.aspx
© 2007 McAfee, Inc.
Questions?