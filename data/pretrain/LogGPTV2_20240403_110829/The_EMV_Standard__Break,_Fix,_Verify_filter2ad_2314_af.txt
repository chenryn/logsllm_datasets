(4) is a contactless card, and the attacker’s equipment are the devices (2) and
(3), which are the card emulator and the POS emulator, respectively.
mark 2). The trace represents a transaction where the attacker
modiﬁes the Transaction Cryptogram (TC) before delivering it
to the terminal. The terminal reaches a state where the transac-
tion is accepted given that the Signed Dynamic Authentication
Data (SDAD), if produced and returned by the card, passes the
terminal’s veriﬁcation. However, the issuing bank should later
decline the transaction due to the wrong TC. Recall that the
terminal can only verify the correctness of the SDAD but not
of the TC since the latter is veriﬁed using a symmetric key
only known to the card and the bank.
This constitutes a “free lunch” attack in that the criminal
can purchase low-value goods or services without actually
being charged at all. This however is unlikely to be an
attractive business model for criminals for two reasons. First,
the fraudulent
the
criminal’s bank will likely not ignore the defrauded merchant’s
complaints indeﬁnitely. For ethical reasons, we did not test this
attack as it would constitute actual fraud.
transactions are of low value. Second,
D. Defenses against Attacks on Visa
As reported in Section V-B, the most common conﬁgu-
ration of the Mastercard contactless protocol in current use
(namely CDA in conjunction with online PIN) is secure. Visa’s
conﬁgurations, on the other hand, are not. Fortunately, Visa’s
problems can be ﬁxed by implementing the three changes that
we describe next. These changes can be realized by Visa and
the banks in a reasonable amount of time and effort, without
affecting those cards currently in circulation.
The Visa contactless protocol [32] speciﬁes that special-
purpose readers may perform Dynamic Data Authentication
(DDA) for online transactions. This is indeed the only con-
Authorized licensed use limited to: Tsinghua University. Downloaded on February 25,2022 at 12:10:50 UTC from IEEE Xplore.  Restrictions apply. 
1777
CardCTerminalTBankBs=f(mk,ATC)randomNCrandomUNs=f(mk,ATC)SELECT,2PAY.SYS.DDF01AID1,AID2,...,AIDnSELECT,A000000003....PDOLtags&lengthsPDOL=hTTQ,amount,country,TVR,currency,date,type,UNiGETPROCESSINGOPTIONS,PDOLAC=MACs(PDOL,AIP,ATC,IAD)d=hATC,UN,amount,currency,NC,CTQ,AIPiSDAD=signprivC(d)AIP,AFL,IAD,AC,CID,ATC,CTQREADRECORDPAN,expDate,...[,certprivCA(B,pubB),certprivB(C,pubC),SDAD,NC,CTQ]PAN,AIP,PDOL,ATC,IAD,AC[,aencpubB(PIN)]Y=AC⊕p8(ARC)ARPC=MAC′s(Y)ARC,ARPCWe have veriﬁed the three ﬁxes recommended here. To-
gether, they defend against the attacks reported in this paper
as well as any other attacks that derive from violations of the
considered security properties. These ﬁxes, except for 3(b),
can be deployed on the terminals’ software and so they are
attractive in terms of implementation because software updates
on terminals should be signiﬁcantly less expensive and faster
than other, more aggressive actions such as blocking cards in
circulation and issuing new ones.
VII. CONCLUSIONS
We have presented a formal model of the latest version of
the EMV standard that features all relevant methods for ofﬂine
data authentication, cardholder veriﬁcation, and transaction
authorization. Using the Tamarin tool, we conducted a full-
scale, automatic, formal analysis of this model, uncovering
numerous security ﬂaws. These ﬂaws violate fundamental
security properties such as authentication and other guarantees
about accepted transactions. We also used our model
to
identify EMV conﬁgurations that lead to secure transactions,
and proved their correctness.
Our analysis revealed surprising differences between the
security of the contactless payment protocols of Mastercard
and Visa, showing that Mastercard is more secure than Visa.
We found no major issues with the Mastercard protocol version
running in modern cards. Our analysis revealed only minor
shortcomings arising from older authentication modes (SDA
and DDA) that seem hard to exploit in practice. In contrast,
Visa suffers from several critical issues. The shortcomings we
report on lead to serious, practical attacks, including a PIN
bypass for transactions that surpass the cardholder veriﬁcation
limit. Using our proof-of-concept Android application, we
successfully tested this attack on real-world transactions in
actual stores. Our attack shows that the PIN is useless for Visa
contactless transactions. As a result, in our view, the liability
shift from banks to consumers or merchants is unjustiﬁed
for such transactions: Banks, EMVCo, Visa, or some entity
other than the consumer or merchant should be liable for such
fraudulent transactions.
As part of our analysis we suggested and veriﬁed ﬁxes that
banks and Visa can deploy on existing terminals to prevent
current and future attacks. The good news is that these ﬁxes do
not require changes to the EMV standard itself or to consumer
cards currently in circulation and they can therefore be feasibly
deployed by software updates.
As future work, we plan to merge our EMV contact and
contactless models into a single model in order to analyze
cross-protocol executions. We also plan to further reﬁne and
extend our models to take into consideration other, possibly
stronger, adversaries such as adversaries with dynamic com-
promise capabilities.
REFERENCES
[1] S. J. Murdoch, S. Drimer, R. J. Anderson, and M. Bond, “Chip and
PIN is broken,” in 31st IEEE Symposium on Security and Privacy, S&P
2010, 16-19 May 2010, Berleley/Oakland, California, USA, pp. 433–
446, 2010.
(a) Card emulator
(b) POS emulator
Fig. 4. Screenshots of our app. The card emulator may display the card-
holder’s signature, in which case it should match the attacker’s signature. The
log displayed in the POS emulator corresponds to a real transaction of 182.35
Swiss Francs (CHF).
ﬁguration of this protocol where all three security properties
hold (Table II, Line 4). This is not a common conﬁguration
though, as indicated by our tests. We performed tests on over
ten different live terminals at different merchants, and none
of them used this conﬁguration. Therefore, to prevent the PIN
bypass attack described in Section VI-B, we recommend that
terminals should use DDA for online transactions. That is, all
the terminals must, for all transactions:
1) set the ﬁrst bit of TTQ’s ﬁrst byte, and
2) verify the SDAD.
If implemented, these two measures would require high-
value transactions to be processed with Visa’s secure conﬁgu-
ration. This is of course assuming that the cards used for such
transactions are capable of producing digital signatures, which
modern cards are. Furthermore, to prevent the ofﬂine attack
of Section VI-C, we propose that either:
3a) all terminals set the 8th bit of TTQ’s second byte for all
transactions; or
input to the SDAD, i.e., d in Figure 2.
3b) (cid:104)NC, CID, AC, PDOL, ATC, CTQ, UN, IAD, AIP(cid:105) is the
The ﬁx 3(a) requires all transactions to be processed online
and is preferable over 3(b) because 3(a) does not require
changes to the standard and it therefore does not affect the
consumer cards in circulation. Furthermore, ofﬂine transac-
tions are not presently common; none of the more than 30
transactions we carried out during our tests were authorized
ofﬂine. However, if the capability to process certain transac-
tions ofﬂine is imperative (e.g., in transit systems or street
parking meters) then more aggressive ﬁxes would be needed
such as that of 3(b).
Authorized licensed use limited to: Tsinghua University. Downloaded on February 25,2022 at 12:10:50 UTC from IEEE Xplore.  Restrictions apply. 
1778
[2] T. S. Heydt-Benjamin, D. V. Bailey, K. Fu, A. Juels, and T. O’Hare,
“Vulnerabilities in ﬁrst-generation rﬁd-enabled credit cards,” in Finan-
cial Cryptography and Data Security, 11th International Conference, FC
2007, and 1st International Workshop on Usable Security, USEC 2007,
Scarborough, Trinidad and Tobago, February 12-16, 2007. Revised
Selected Papers, pp. 2–14, 2007.
[3] M. Roland and J. Langer, “Cloning credit cards: A combined pre-play
and downgrade attack on EMV contactless,” in 7th USENIX Workshop
on Offensive Technologies, WOOT ’13, Washington, D.C., USA, August
13, 2013, 2013.
[4] S. Drimer and S. J. Murdoch, “Keep your enemies close: Distance
bounding against smartcard relay attacks,” in Proceedings of the 16th
USENIX Security Symposium, Boston, MA, USA, August 6-10, 2007,
2007.
[5] L. Francis, G. P. Hancke, K. Mayes, and K. Markantonakis, “Practical
relay attack on contactless transactions by using NFC mobile phones,”
IACR Cryptology ePrint Archive, vol. 2011, p. 618, 2011.
[6] L. Sportiello and A. Ciardulli, “Long distance relay attack,” in Radio
Frequency Identiﬁcation - Security and Privacy Issues 9th International
Workshop, RFIDsec 2013, Graz, Austria, July 9-11, 2013, Revised
Selected Papers, pp. 69–85, 2013.
[7] T. Chothia, F. D. Garcia, J. de Ruiter, J. van den Breekel, and M. Thomp-
son, “Relay cost bounding for contactless EMV payments,” in Financial
Cryptography and Data Security - 19th International Conference, FC
2015, San Juan, Puerto Rico, January 26-30, 2015, Revised Selected
Papers, pp. 189–206, 2015.
[8] T. Bocek, C. Killer, C. Tsiaras, and B. Stiller, “An NFC relay attack
with off-the-shelf hardware and software,” in Management and Security
in the Age of Hyperconnectivity - 10th IFIP WG 6.6 International Con-
ference on Autonomous Infrastructure, Management, and Security, AIMS
2016, Munich, Germany, June 20-23, 2016, Proceedings (R. Badonnel,
R. Koch, A. Pras, M. Drasar, and B. Stiller, eds.), vol. 9701 of Lecture
Notes in Computer Science, pp. 71–83, Springer, 2016.
[9] M. Bond, O. Choudary, S. J. Murdoch, S. P. Skorobogatov, and R. J.
Anderson, “Chip and skim: Cloning EMV cards with the pre-play
attack,” in 2014 IEEE Symposium on Security and Privacy, SP 2014,
Berkeley, CA, USA, May 18-21, 2014, pp. 49–64, 2014.
[10] M. Emms, B. Arief, L. Freitas, J. Hannon, and A. P. A. van Moorsel,
“Harvesting high value foreign currency transactions from EMV con-
tactless credit cards without
the 2014
ACM SIGSAC Conference on Computer and Communications Security,
Scottsdale, AZ, USA, November 3-7, 2014, pp. 716–726, 2014.
the PIN,” in Proceedings of
[11] H. Ferradi, R. G´eraud, D. Naccache, and A. Tria, “When organized
crime applies academic results: a forensic analysis of an in-card listening
device,” J. Cryptographic Engineering, vol. 6, no. 1, pp. 49–59, 2016.
[12] S. Meier, B. Schmidt, C. Cremers, and D. A. Basin, “The TAMARIN
prover for the symbolic analysis of security protocols,” in Computer
Aided Veriﬁcation - 25th International Conference, CAV 2013, Saint
Petersburg, Russia, July 13-19, 2013. Proceedings, pp. 696–701, 2013.
[13] B. Schmidt, S. Meier, C. J. F. Cremers, and D. A. Basin, “Automated
analysis of Difﬁe-Hellman protocols and advanced security properties,”
in 25th IEEE Computer Security Foundations Symposium, CSF 2012,
Cambridge, MA, USA, June 25-27, 2012, pp. 78–94, 2012.
[14] C. Cremers, M. Horvat, J. Hoyland, S. Scott, and T. van der Merwe,
“A comprehensive symbolic analysis of TLS 1.3,” in Proceedings of
the 2017 ACM SIGSAC Conference on Computer and Communications
Security, CCS 2017, Dallas, TX, USA, October 30 - November 03, 2017,
pp. 1773–1788, 2017.
[15] D. A. Basin, J. Dreier, L. Hirschi, S. Radomirovic, R. Sasse, and V. Stet-
tler, “A formal analysis of 5g authentication,” in Proceedings of the 2018
ACM SIGSAC Conference on Computer and Communications Security,
CCS 2018, Toronto, ON, Canada, October 15-19, 2018, pp. 1383–1396,
2018.
[16] J. de Ruiter and E. Poll, “Formal analysis of the EMV protocol suite,”
in Theory of Security and Applications - Joint Workshop, TOSCA 2011,
Saarbr¨ucken, Germany, March 31 - April 1, 2011, Revised Selected
Papers, pp. 113–129, 2011.
[17] S. Mauw, Z. Smith, J. Toro-Pozo, and R. Trujillo-Rasua, “Distance-
bounding protocols: Veriﬁcation without time and location,” in 2018
IEEE Symposium on Security and Privacy, SP 2018, Proceedings, 21-
23 May 2018, San Francisco, California, USA, pp. 549–566, 2018.
[18] A. Debant, S. Delaune, and C. Wiedling, “A symbolic framework to
analyse physical proximity in security protocols,” in 38th IARCS Annual
Conference on Foundations of Software Technology and Theoretical
Computer Science, FSTTCS 2018, December 11-13, 2018, Ahmedabad,
India, pp. 29:1–29:20, 2018.
[19] B. Blanchet, “An efﬁcient cryptographic protocol veriﬁer based on
Prolog rules,” in 14th IEEE Computer Security Foundations Workshop
(CSFW-14 2001), 11-13 June 2001, Cape Breton, Nova Scotia, Canada,
pp. 82–96, 2001.
[20] K. Bhargavan, C. Fournet, A. D. Gordon, and S. Tse, “Veriﬁed interop-
erable implementations of security protocols,” in 19th IEEE Computer
Security Foundations Workshop, (CSFW-19 2006), 5-7 July 2006, Venice,
Italy, pp. 139–152, 2006.
[21] D. Dolev and A. C. Yao, “On the security of public key protocols,”
IEEE Trans. Information Theory, vol. 29, no. 2, pp. 198–207, 1983.
[22] D. A. Basin and C. Cremers, “Know your enemy: Compromising
adversaries in protocol analysis,” ACM Trans. Inf. Syst. Secur., vol. 17,
no. 2, pp. 7:1–7:31, 2014.
[23] T. Beth and Y. Desmedt, “Identiﬁcation tokens - or: Solving the chess
grandmaster problem,” in Advances in Cryptology - CRYPTO ’90, 10th
Annual International Cryptology Conference, Santa Barbara, California,
USA, August 11-15, 1990, Proceedings, pp. 169–177, 1990.
[24] S. Brands and D. Chaum, “Distance-bounding protocols (extended
abstract),” in Advances in Cryptology - EUROCRYPT ’93, Workshop
on the Theory and Application of of Cryptographic Techniques, Lofthus,
Norway, May 23-27, 1993, Proceedings, pp. 344–359, 1993.
[25] T. Chothia, J. de Ruiter, and B. Smyth, “Modelling and analysis of
a hierarchy of distance bounding attacks,” in 27th USENIX Security
Symposium, USENIX Security 2018, Baltimore, MD, USA, August 15-
17, 2018., pp. 1563–1580, 2018.
[26] S. Mauw, Z. Smith, J. Toro-Pozo, and R. Trujillo-Rasua, “Post-collusion
security and distance bounding,” in Proceedings of
the 2019 ACM
SIGSAC Conference on Computer and Communications Security, CCS
2019, London, UK, November 11-15, 2019., pp. 941–958, 2019.
[27] A. Debant and S. Delaune, “Symbolic veriﬁcation of distance bounding
protocols,” in Principles of Security and Trust - 8th International
Conference, POST 2019, Held as Part of the European Joint Conferences
on Theory and Practice of Software, ETAPS 2019, Prague, Czech
Republic, April 6-11, 2019, Proceedings, pp. 149–174, 2019.
[28] L.-A. Galloway and T. Yunusov, “First contact: New vulnerabilities in
contactless payments,” in Black Hat Europe 2019, 2019.
[29] G. Lowe, “A hierarchy of authentication speciﬁcation,” in 10th Com-
puter Security Foundations Workshop (CSFW ’97), June 10-12, 1997,
Rockport, Massachusetts, USA, pp. 31–44, 1997.
[30] C. Cremers and S. Mauw, Operational Semantics and Veriﬁcation of
Information Security and Cryptography, Springer,
Security Protocols.
2012.
[31] EMVCo, EMV Contactless Speciﬁcations for Payment Systems, Book
C-2, Kernel 2 Speciﬁcation, Version 2.8. April 2019.
[32] EMVCo, EMV Contactless Speciﬁcations for Payment Systems, Book
C-3, Kernel 3 Speciﬁcation, Version 2.8. April 2019.
[33] D. Basin, R. Sasse, and J. Toro, “Tamarin models of EMV.” https://
github.com/EMVrace/EMVerify, 2020. Accessed: August 2020.
[34] EMVCo, “EMV Integrated Circuit Card Speciﬁcations for Payment Sys-
tems, Book 2, Security and Key Management, Version 4.3,” November
2011.
[35] Google, “Host-based card emulation overview.” https://developer.
android.com/guide/topics/connectivity/nfc/hce, 2019. Accessed: Decem-
ber 2019.
[36] D. Basin, R. Sasse, and J. Toro, “The EMV Standard: Break, Fix, Verify.”
https://emvrace.github.io/, 2020.
[37] EMVCo, EMV Contactless Speciﬁcations for Payment Systems, Book
C-6, Kernel 6 Speciﬁcation, Version 2.8. April 2019.
[38] EMVCo, EMV Contactless Speciﬁcations for Payment Systems, Book
C-7, Kernel 7 Speciﬁcation, Version 2.8. April 2019.
ACRONYMS
AAC Application Authentication Cryptogram. 6
AC Application Cryptogram. 2, 6, 8–12
AFL Application File Locator. 4
AID Application Identiﬁer. 4
AIP Application Interchange Proﬁle. 4, 6, 8, 10
APDU Application Protocol Data Unit. 3, 12
ARC Authorization Response Code. 6
Authorized licensed use limited to: Tsinghua University. Downloaded on February 25,2022 at 12:10:50 UTC from IEEE Xplore.  Restrictions apply. 
1779
ARPC Authorization Response Cryptogram. 6
ARQC Authorization Request Cryptogram. 6
ATC Application Transaction Counter. 6, 8
CA Certiﬁcate Authority. 4, 5
CDA Combined Dynamic Data Authentication. 2, 4, 6, 8–10,
12
CDCVM Consumer Device CVM. 2, 4, 6, 10
CDOL Card Risk Management Data Object List. 4, 6
CID Cryptogram Information Data. 6
CTQ Card Transaction Qualiﬁers. 10–12
CVM Cardholder Veriﬁcation Method. 2–4, 6, 8–11
CVMR Cardholder Veriﬁcation Method Results. 8
DDA Dynamic Data Authentication. 2, 4, 8–13
DDOL Dynamic Data Object List. 4
HCE Host-based Card Emulation. 10
IAD Issuer Application Data. 8
MAC Message Authentication Code. 5, 6, 11
NFC Near Field Communication. 3, 10–12
ODA Ofﬂine Data Authentication. 2, 4
PAN Primary Account Number. 4, 7–10
PDOL Processing Data Object List. 4, 11, 12
PK Public Key. 4
POS Point-Of-Sale. 10, 12
PSE Payment System Environment. 4, 8
SDA Static Data Authentication. 2, 4, 8–11, 13
SDAD Signed Dynamic Authentication Data. 4, 6, 10, 12, 13
SSAD Signed Static Authentication Data. 4, 9
TA Transaction Authorization. 2, 4
TC Transaction Cryptogram. 6, 9, 10, 12
TTQ Terminal Transaction Qualiﬁers. 11–13