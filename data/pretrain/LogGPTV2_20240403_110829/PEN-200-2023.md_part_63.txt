can take up to 1 minute to become accessible again.
Now, let’s demonstrate how to obtain the information from Listing 376. For this, we’ll connect to
the target system with netcat and enter whoami to obtain the first pieces of information: the
username and hostname.
kali@kali:~$ nc 192.168.50.220 4444
Microsoft Windows [Version 10.0.22000.318]
(c) Microsoft Corporation. All rights reserved.
C:\Users\dave>whoami
whoami
clientwk220\dave
C:\Users\dave>
Listing 377 - Connect to the bind shell and obtain username and hostname
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 476
Made in Morocco
Penetration Testing with Kali Linux
The output of Listing 377 shows that we have command execution as user dave. Additionally, the
output contains the hostname of the system, clientwk220. This hostname implies that our bind
shell runs on a client system rather than on a server.
The hostname often can be used to infer the purpose and type of a machine. For example, if it is
WEB01 for a web server or MSSQL01 for a MSSQL743 server.
Next, we want to check which groups dave is in. To display all groups our current user is a
member of, we can use whoami /groups.
C:\Users\dave> whoami /groups
whoami /groups
GROUP INFORMATION
-----------------
y
Group Name Type SID
Attributes
k
====================================== ================
==============================================
==================================================s
Everyone Well-known group S-1-1-0
Mandatory group, Enabled by default, Enabled group
o
CLIENTWK220\helpdesk Alias S-1-5-21-2309961351-4093026482-
2223492918-1008 Mandatory group, Enabled by default, Enabled group
BUILTIN\Remote Desktop Users Alias S-1-5-32-555
n
Mandatory group, Enabled by default, Enabled group
BUILTIN\Users Alias S-1-5-32-545
Mandatory group, Enabled by default, Enabled group
i
NT AUTHORITY\BATCH Well-known group S-1-5-3
z
Mandatory group, Enabled by default, Enabled group
CONSOLE LOGON Well-known group S-1-2-1
Mandatory group, Enabled Dby default, Enabled group
NT AUTHORITY\Authenticated Users Well-known group S-1-5-11
Mandatory group, Enabled by default, Enabled group
...
Listing 378 - Group memberships of the user dave
The output shows that dave is a member of the helpdesk group. Helpdesk staff often have
additional permissions and access compared to standard users.
Additionally, the user is a member of BUILTIN\Remote Desktop Users. Membership of this group
offers the possibility to connect to the system via RDP.
The other groups dave is a member of are standard for non-privileged users such as Everyone
and BUILTIN\Users.
The next piece of information we are interested in are other users and groups on the system. We
can use the net user744 command or the Get-LocalUser745 Cmdlet to obtain a list of all local users.
Let’s use the latter by starting PowerShell and running Get-LocalUser.
743 (Wikipedia, 2022), https://en.wikipedia.org/wiki/Microsoft_SQL_Server
744 (Microsoft Documentation, 2016), https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-
and-2012/cc771865(v=ws.11)
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 477
Made in Morocco
Penetration Testing with Kali Linux
C:\Users\dave> powershell
powershell
Windows PowerShell
Copyright (C) Microsoft Corporation. All rights reserved.
Install the latest PowerShell for new features and improvements!
https://aka.ms/PSWindows
PS C:\Users\dave> Get-LocalUser
Get-LocalUser
Name Enabled Description
---- ------- -----------
Administrator False Built-in account for administering the computer/domain
BackupAdmin True
dave True dave y
daveadmin True
DefaultAccount False A user account managed by the system.
k
Guest False Built-in account for guest access to the computer/domain
offsec True
steve True
s
...
Listing 379 - Display local users on CLIENT220
o
The output shows several interesting items that can help us to get an overview of the system.
The first one is that the built-in Administrantor account is disabled. Next, two presumed regular
users called steve and dave exist. In addition, we have identified two other users named
daveadmin and BackupAdmin. Both usernames contain “admin”, which implies that they are
i
potentially administrative users, making them valuable targets.
z
We can also assume that daveadmin is the privileged account of dave. Administrators often have
both a non-privileged and a privileged account. They use the non-privileged account for day-to-
D
day work and the privileged account for administrative tasks. For security reasons, they don’t use
the privileged account for performing potentially unsafe tasks such as browsing the internet.
Before we make further assumptions, let’s enumerate the existing groups on CLIENTWK220. We
can choose between the command net localgroup or Get-LocalGroup746 in PowerShell.
PS C:\Users\dave> Get-LocalGroup
Get-LocalGroup
Name Description
---- -----------
adminteam Members of this group are admins to all workstations on the
second floor
BackupUsers
helpdesk
...
Administrators Administrators have complete and unrestricted
745 (Microsoft Documentation, 2022), https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.localaccounts/get-
localuser?view=powershell-5.1
746 (Microsoft Documentation, 2022), https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.localaccounts/get-
localgroup?view=powershell-5.1
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 478
Made in Morocco
Penetration Testing with Kali Linux
access to the computer/domain
...
Remote Desktop Users Members in this group are granted the right to
logon remotely
...
Listing 380 - Display local groups on CLIENTWK220
Listing 380 displays the non-standard groups adminteam, BackupUsers, and helpdesk.
The adminteam group may be of interest to us since it contains the string “admin” and has a
custom description text, indicating the members are admins to all workstations on the second
floor. However, we don’t currently have any further information regarding which floors exist or
which departments are on which floors.
Another interesting finding is the group name BackupUsers as with the user BackupAdmin before.
Backup solutions often have extensive permissions to perform their oyperations on the file system,
making both potentially valuable targets.
k
Apart from the non-standard groups, there are several built-in groups we should analyze, such as
Administrators, Backup Operators, Remote Desktop Users, and Remote Management Users.
s
Members of Backup Operators can backup and restore all files on a computer, even those files
they don’t have permissions for. We must not confuse this group with non-standard groups such
o
as BackupUsers in our example.
Members of Remote Desktop Users can access the system with RDP, while members of Remote
n
Management Users can access it with WinRM.747
For this example, let’s review the meimbers of adminteam and Administrators. We can do this with
Get-LocalGroupMember,748 passinzg the group name as an argument.
PS C:\Users\dave> Get-LocalGroupMember adminteam
Get-LocalGroupMember admiDnteam
ObjectClass Name PrincipalSource
----------- ---- ---------------
User CLIENTWK220\daveadmin Local
PS C:\Users\dave> Get-LocalGroupMember Administrators
Get-LocalGroupMember Administrators
ObjectClass Name PrincipalSource
----------- ---- ---------------
User CLIENTWK220\Administrator Local
User CLIENTWK220\daveadmin Local
User CLIENTWK220\backupadmin Local
User CLIENTWK220\offsec Local
Listing 381 - Display members of the group adminteam
747 (Microsoft Documentation, 2021), https://docs.microsoft.com/en-us/windows/win32/winrm/portal
748 (Microsoft Documentation, 2022), https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.localaccounts/get-
localgroupmember?view=powershell-5.1
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 479
Made in Morocco
Penetration Testing with Kali Linux
Listing 381 shows that only daveadmin is a member of adminteam. However, adminteam is not
listed in the local Administrators group. We only know that members of the group are
administrators to workstations on the second floor. The information we have gathered thus far is
not directly actionable, but it may become so when we move deeper into the network and identify
which systems reside on the second floor.
The output also shows that apart from the disabled local Administrator account, the users
daveadmin and BackupAdmin are members of the local Administrators group. Therefore, we’ve
now identified two highly valuable targets.
While it is crucial to know which users are privileged, it is also vital for us to understand which
users can use RDP. Obtaining the credentials for one of these users may lead us to a GUI access,
which often tremendously improves our means of interacting with the system.
We’ve collected quite some information about the users and groups on the target system. Let’s
y
briefly summarize what we know so far.
Our bind shell runs as the user dave on a machine with the hosktname CLIENTWK220. This user is
in a group named helpdesk. Additionally, there is another user named daveadmin which is
probably the person’s privileged account, while dave masy be used for day to day work. The user
daveadmin is also in a group named adminteam, whose description indicates it has administrative
privileges on all workstations on the second floor. Furthermore, daveadmin and BackupAdmin are
o
local Administrators on CLIENTWK220.
Next, we’ll gather information about the actual target machine, its configuration, and applications
n
running on it.
Following the list from listing 376, leit’s check the operating system, version, and architecture first.
We can use systeminfo to gather zthis information.
PS C:\Users\dave> systeminfo
systeminfo D
Host Name: CLIENT220
OS Name: Microsoft Windows 11 Pro
OS Version: 10.0.22000 N/A Build 22000
...
System Type: x64-based PC
...
Listing 382 - Information about the operating system and architecture
The output of Listing 382 shows that our bind shell runs on a Windows 11 Pro system. To get the
exact version, we can use the build number and review the existing versions749 of the identified
operating system. In our case, build 22000 is the version 21H2 of Windows 11.
Additionally, the output contains the information that our bind shell runs on a 64-bit system. This
information becomes relevant when we want to run binary files on the system, since we cannot
run a 64-bit application on a 32-bit system.
Next, let’s move down the list and review the network information we can obtain as dave. Our goal
in this step is to identify all network interfaces, routes, and active network connections. Based on
749 (Wikipedia, 2022), https://en.wikipedia.org/wiki/List_of_Microsoft_Windows_versions
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 480
Made in Morocco
Penetration Testing with Kali Linux
this information, we may identify new services or even access to other networks. This information
may not directly lead us to elevated privileges, but they are vital to understand the machine’s
purpose and to obtain vectors to other systems and networks.
Obtaining privileged access on every machine in a penetration test is rarely a
useful or realistic goal. While most machines in the challenge labs of this course
are rootable, we’ll face numerous non-rootable machines in real-life
assessments. A skilled penetration tester’s goal is therefore not to blindly
attempt privilege escalation on every machine at any cost, but to identify
machines where privileged access leads to further compromise of the client’s
infrastructure.
y
To list all network interfaces, we can use ipconfig750 with the argument /all.
k
PS C:\Users\dave> ipconfig /all
ipconfig /all
s
Windows IP Configuration
o
Host Name . . . . . . . . . . . . : clientwk220
Primary Dns Suffix . . . . . . . :
Node Type . . . . . . . . . . . . : Hybrid
n
IP Routing Enabled. . . . . . . . : No
WINS Proxy Enabled. . . . . . . . : No
i
Ethernet adapter Ethernet0:
z
Connection-specific DNS Suffix . :
Description . . . . . D. . . . . . : vmxnet3 Ethernet Adapter
Physical Address. . . . . . . . . : 00-50-56-8A-80-16
DHCP Enabled. . . . . . . . . . . : No
Autoconfiguration Enabled . . . . : Yes
Link-local IPv6 Address . . . . . : fe80::cc7a:964e:1f98:babb%6(Preferred)
IPv4 Address. . . . . . . . . . . : 192.168.50.220(Preferred)
Subnet Mask . . . . . . . . . . . : 255.255.255.0
Default Gateway . . . . . . . . . : 192.168.50.254
DHCPv6 IAID . . . . . . . . . . . : 234901590
DHCPv6 Client DUID. . . . . . . . : 00-01-00-01-2A-3B-F7-25-00-50-56-8A-80-16
DNS Servers . . . . . . . . . . . : 8.8.8.8
NetBIOS over Tcpip. . . . . . . . : Enabled
Listing 383 - Information about the operating system and architecture
The output shows some interesting information. For example, the system is not configured to get
an IP address via DHCP,751 but it was set manually. Furthermore, it contains the DNS server,
gateway, subnet mask, and MAC address. These pieces of information will be useful when we
attempt to move to other systems or networks.
750 (Microsoft Documentation, 2021), https://docs.microsoft.com/en-us/windows-server/administration/windows-
commands/ipconfig
751 (Wikipedia, 2022), https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 481
Made in Morocco
Penetration Testing with Kali Linux
To display the routing table, which contains all routes of the system, we can use route print.752
The output of this command is useful to determine possible attack vectors to other systems or
networks.
PS C:\Users\dave> route print
route print
===========================================================================
Interface List
6...00 50 56 8a 80 16 ......vmxnet3 Ethernet Adapter
1...........................Software Loopback Interface 1
===========================================================================
IPv4 Route Table
===========================================================================
Active Routes:
Network Destination Netmask Gateway Intyerface Metric
0.0.0.0 0.0.0.0 192.168.50.254 192.168.50.220 271
127.0.0.0 255.0.0.0 On-link 127.0.0.1 331
k
127.0.0.1 255.255.255.255 On-link 127.0.0.1 331
127.255.255.255 255.255.255.255 On-link 127.0.0.1 331
192.168.50.0 255.255.255.0 On-links 192.168.50.220 271
192.168.50.220 255.255.255.255 On-link 192.168.50.220 271
192.168.50.255 255.255.255.255 On-link 192.168.50.220 271
224.0.0.0 240.0.0.0 Ono-link 127.0.0.1 331
224.0.0.0 240.0.0.0 On-link 192.168.50.220 271
255.255.255.255 255.255.255.255 On-link 127.0.0.1 331
n
255.255.255.255 255.255.255.255 On-link 192.168.50.220 271
===========================================================================
Persistent Routes:
i
Network Address Netmask Gateway Address Metric
z
0.0.0.0 0.0.0.0 192.168.50.254 Default