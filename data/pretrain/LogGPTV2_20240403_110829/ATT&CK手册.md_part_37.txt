# 数据渗出技术

## 1. 远程文件复制
### 系统：Windows, Linux, MacOS
可以通过命令和控制通道从外部对手控制的系统复制文件，以将工具带入受害者网络。也可以使用FTP等备用协议或scp、rsync和sftp等本机工具在Mac和Linux上复制文件。攻击者还可以在内部受害者系统之间横向复制文件，支持通过SMB与连接的网络共享或使用Windows管理员共享或远程桌面协议进行文件共享。

## 2. 自动脚本窃取
### 系统：Windows, Linux, MacOS
描述：收集目标信息后，可以使用自动化信息处理工具和脚本来执行包含机密信息数据的泄露。结合渗出自动化工具，通过C2或替代协议的方法可用于通过网络传输数据。
- **方法**：
  - 通过FTP自动将数据信息传送到远程C2服务器
  - 使用BadUSB物理信息窃取
  - 自动截图、盗取剪切板、收集用户凭证（包括密码、账户哈希、各种密钥）并发送到中转服务器
- **保护提示**：使用AppLocker或软件限制策略等白名单工具识别并阻止潜在危险和恶意软件。

### 凭据窃取恶意软件
LokiBot被定义为"infostealer"，因为它有能力窃取来自各种流行电子邮件客户端和web浏览器的凭据。此外，它还可以窃取来自许多FTP客户端（如FileZilla, FlashFXP, WS_FTP等）和SSH程序（如PUTTY）的登录细节。尽管这种攻击媒介现在不那么流行，但仍然不能低估其威胁。

#### 例子
- 使用鱼叉式网络钓鱼电子邮件窃取合法凭据
- 通过在其入侵中被盗的合法凭据攻击支付系统
- 针对销售点系统的攻击中使用合法凭据

### 密码窃取软件示例
- AcridRain: [详情](https://www.4hou.com/web/16245.html)
- Ovidiy Stealer: [详情](https://www.hackread.com/buy-password-stealing-malware-ovidiy-stealer-for-7/)

## 3. 数据压缩
### 系统：Windows, Linux, MacOS
攻击者可以压缩在渗出之前收集的数据，以使其可移植并最小化通过网络发送的数据量。常见的压缩库或实用程序包括7zip、RAR、ZIP和zlib。
- **示例**：
  - 使用ZLIB压缩数据
  - 将收集的数据隐藏在受密码保护的.rar档案中
  - 使用7zip或RAR进行加密压缩

#### 保护建议
为了绕过IPS或DLP，攻击者可能会切换到使用Exfiltration通道的加密。可以通过监视与调用已知数据压缩使用程序相关联的进程和命令行参数来提前检测压缩软件和压缩文件。

### 数据传输大小限制
为了防止超过网络上传输数据的允许阈值的保护和可能的警告，攻击者可以将exfiltered文件拆分成许多相同大小的片段或限制网络数据包的大小低于阈值。
- **技术案例**：
  - Helminth将数据拆分为最多23个字节的块，并通过DNS查询发送到C2服务器
  - OopsIE以1500字节块的形式将命令输出和收集的文件泄露到C2服务器

#### 安全提示
使用流量特征分析的IDS和DLP可用于检测和阻止已知的特定管理和控制工具（C2）和恶意软件。作为检测技术，我们建议分析异常数据流的网络流量（例如，客户端发送的数据远多于从服务器接收的数据）。

## 4. 替代协议窃取
### 系统：Windows, Linux, MacOS
数据泄漏通常使用除对手用来建立控制信道（C2）之外的替代协议来执行。替代协议包括FTP、SMTP、HTTP/S、DNS和其他网络协议，以及外部Web服务，如云存储。
- **安全提示**：
  - 配置防火墙，将流量限制为仅允许从允许的端口进入和退出网络
  - 使用代理服务器和专用服务器来进行DNS等服务，只允许通过适当的端口和协议进行系统交互
  - 使用IDS/IPS系统组织基于流量特征的分析

## 5. 命令控制信道窃取
### 系统：Windows, Linux, MacOS
说明：可以使用攻击者用作控制通道的相同协议（C2）来泄露数据。
- **保护建议**：
  - 使用IDS/IPS系统组织基于流量特征的分析
  - 分析异常数据流的流量（例如，客户端发送的数据远多于从服务器接收的数据）

#### 技术案例
- APT32的后门使用已经打开的通道及其C&C服务器来泄露数据
- MobileOrder通过与C2通信相同的协议将数据泄露到C2服务器
- Remexi通过bitsadmin执行泄漏，bitsadmin也用于C2通道

## 6. 网络媒介窃取
### 系统：Windows, Linux, MacOS
数据泄露可以在与组织控制通道（C2）的环境不同的网络环境中进行。如果控制信道使用有线连接，则可以通过无线连接（WiFi、蜂窝网络、蓝牙连接或其他无线电信道）进行泄露。
- **安全建议**：
  - 确保主机上的安全传感器支持审核所有网络适配器的使用
  - 跟踪和分析与添加或复制网络接口相关的网络适配器设置的更改

#### 技术案例
- Flame有一个名为BeetleJuice的模块，包含可以以不同方式使用的蓝牙功能

## 7. 数据加密
### 系统：Windows, Linux, MacOS
在进行渗透之前，可以对目标数据进行加密，以隐藏被盗信息，逃逸检测或使过程不那么明显。常见的归档格式是RAR和zip。
- **安全提示**：
  - 通过监视进程和命令行参数来检测运行众所周知的文件加密软件
  - 加载Windows crypt.32.dll DLL的进程可以被攻击者用来加密、解密或验证文件签名
  - 通过分析网络流量的熵来执行对加密数据的传输的检测

#### 参考链接
- 3DES加密算法：[详情](https://blog.csdn.net/knight20160302/article/details/82952686)
- RC4加密算法：[详情](https://blog.csdn.net/chence19871/article/details/17564877)
- Base64加密算法：[详情](https://blog.csdn.net/zyhlwzy/article/details/77964763)

## 8. 物理介质窃取
### 系统：Windows, Linux, MacOS
在某些情况下，例如物理隔离受损网络，可能会通过物理介质或用户连接的设备进行渗透。这种媒体可以是外部硬盘驱动器、USB驱动器、手机、mp3播放器或任何其他可移动存储或信息处理设备。
- **安全提示**：
  - 禁用自动运行可移动存储设备
  - 如果业务运营不需要，则禁止或限制在组织安全策略级别使用可移动设备
  - 监视可移动介质上的文件访问，并在连接可移动介质时启动审计进程

#### 技术示例
- USB攻击方式：[详情](https://blog.csdn.net/xCnhYKoHj3eK/article/details/79649822)
- BadUSB将数据从气隙网络传输到连接Internet的系统：[视频](https://www.youtube.com/watch?v=90MIjgh5ESU) 和 [视频](https://www.youtube.com/watch?v=w2yadyr-lDU)

## 9. 已计划的转移
### 系统：Windows, Linux, MacOS
数据只能在一天的特定时间或定期进行。这种调度用于将过滤后的数据与网络上的正常流量混合。当使用计划的渗出时，还使用其他信息泄漏方法，例如通过控制通道（C2）和替代方案的渗出。
- **保护建议**：
  - 使用带有流量签名分析的IDS/IPS系统
  - 监视进程到文件的访问模式，以及扫描文件系统然后发送网络流量的进程和方案
  - 在几天的同一时间发生的同一地址的网络连接应该是可疑的

希望这些优化后的文本能够帮助您更好地理解和应对数据渗出技术。