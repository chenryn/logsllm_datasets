当导入新功能授权后，也需要到租户管理界面确认该新功能特性是否勾选。如导入大屏
License授权并重启auth权限模块后，发现无法正常使用大屏功能，即可到租户管理界面查
看是否为租户勾选了大屏特性。
系统状态
租户管理平台上，可以查看整个日志易集群的总数据量使用状态，以及许可证池的特性详情
清单。这是租户管理的基础。
8-311
日志学院
租户管理平台上，可以创建、编辑和查看租户。租户列表页默认展示租户的名称和过去一个
月的数据用量。
您可以点击展开，查看该租户被授予的每日限额、有效期和特性许可。
创建租户
租户列表右上角点击"新建"，开始创建一个新的租户。界面如下：
8-312
日志学院
可以填写或选择的内容包括：
 名称：在租户列表上展示的名称。
 域名：在系统中用来标识租户的唯一标识符。一经设置，不可变更。在其他使用手册里
通常用 domain 来称呼。
 支持特性：可以在系统状态中所支持的全部特性中选择任意多个特性，授予该租户。
 每日限额：可以在系统状态中所支持的总限额之内，授予该用户指定的限额大小。日志
易并不限制您所创建的全部租户的限额之和要小于等于总限额。
 超限次数：可以设置在最近一个月中，最多允许超过几次每日限额。
 超额行为：当触发超限次数阈值后，采取何种处理。
 拒绝采集输入：在数据接收层丢弃掉发送过来的数据。依赖于数据发送层主动阻塞
并停止采集来保障数据安全。这种行为对平台稳定性有益。
 接收采集拒绝查询:数据接入流程无变化，但拒绝用户通过页面和 API 进行任何登
录、查询、管理操作。这种行为对业务数据安全有益。
 管理员名称：在租户内部拥有管理员权限的账户
 管理员邮箱：在租户内部拥有管理员权限的账户的邮箱
 管理员密码：在租户内部拥有管理员权限的账户的密码
其中，租户的管理员设置仅在创建流程中有效。租户一经创建，其内部管理员权限的移交就
依赖于该用户自己的操作。租户管理平台本身并不窥视租户内部的用户数据，也就无法提供
用户列表供选择修改。
8-313
日志学院
如果管理员权限发生了移交，租户管理页展示的只读内容也随之变化。租户内管理员权限的
移交操作细节，请参阅《日志易使用手册》中"用户管理"相关章节。
租户外观
为了让日志易和您的公司环境最大程度的保持视觉效果的一致性。日志易支持统一修改平台
上各租户的外观配色。
租户外观页面如下图所示：
日志易目前支持对主色系、悬停效果、一级导航、仪表盘内容背景、图标及占位符辅助色等
的颜色设置，基本覆盖了系统所使用的颜色区域。您可以按需选择，如不满意，可以恢复初
始值，继续使用日志易默认效果。
Agent 升级包管理
日志易 Agent 的升级包，在整个日志易平台、所有租户上全局可用，故而在租户管理页面
上统一维护。租户内部只需要选择具体某个的版本分发即可。
界面如下:
8-314
日志学院
选择升级包，确定上传。等待上传进度完成。上传完成后，新的升级包版本随即就会展示上
页面列表上。 如图所示，升级包有5个不同版本，分别是：
• 支持AIX/HPUX的*nix版本；
• 支持Linux的32位版本；
• 支持Linux的64位版本；
• 支持Windows的32位版本；
• 支持Linux的带有数据库读取功能的64位版本。
目前界面升级，仅支持租户在Agent管理中对相同序列的版本升级使用，如果需要交叉版
本切换，请手工登录服务器完成替换工作。
8-315
日志学院
8.7. 产品路径结构
有时候，如当Manager管理界面无法登陆时，我们需要登录到服务器终端进行查看。这就
需要我们对日志易常用的路径有所认知。
日志易最常用的两个路径为：
/opt/rizhiyi：日志易应用程序目录
/data/rizhiyi：日志易数据文件路径
下面我们来具体看一下吧。
/opt/rizhiyi
/opt/rizhiyi/parcels：rizhiyi后台模块包。agent会自动从中央下载并安装到/opt/rizhiyi/parcels
目录，供进程启动时使用。
/opt/rizhiyi/tools：日志易自带的管理工具
/opt/rizhiyi/parcels/yottaweb/yottaweb/static/img/leftnav/logo_expand.png：日志易登录页
logo图片存放路径及文件名
/data/rizhiyi
/data/rizhiyi/logs：各组件日志文件路径
/data/rizhiyi/yottasearch/nodes/0/indices/：各组件名称定义的目录索引文件路径
本章习题：
1、怎么进入租户管理界面？
2、怎么调整本地上传的文件大小限制到50M？
3、为什么当前台报License超额错误，Manager界面查看实际上的License的量却很大？该
如何配置才能使产品正常使用？
8-316
日志学院
思考：
1、租户管理都能管理哪些配置？
2、企业在什么场景下会有租户管理的需求？
3、在字段提取里新建了一个解析规则，测试一条日志的解析都正常，但是从搜索框查询出
来的日志并没有解析成功。原因可能是什么？
4、产品使用过程中还可能出现什么问题？这些问题该如何解决？
8-317
日志学院
9.Manager
初级产品学习中，我们已经简单介绍了Manager的基础使用相关，如更新模块安装包、导
入License等。但Manager的功能还不止这些。在日志易产品的使用过程中，Manager还有
以下作用：
1、集群管理：快速查看集群及集群下主机的健康状态；
2、集群拓展：在线为集群添加新主机；
3、版本管理：包括产品大版本升级、补丁包更新、Manager版本更新、License管理等功
能；
4、模块管理：包括模块启停、添加或删除模块实例、模块性能管理（Influxdb数据库用来
存储Manager上性能图的数据Manager会采集所有模块的性能指标，并支持在页面上
进行展示，通过这些图表，我们能够了解日志易系统各模块的性能，从而对日志易资源
做出更好的管理）、日志查看、配置及参数修改等；
5、主机监控：查看主机负载及性能；
6、实用工具：日志易提供了Kafka工具、命令行工具、MySQL工具、MySQL备份、系统巡
检工具等日常运维管理中较为实用的工具；
7、告警管理：Manger对日志易系统进行自监控，通过Manager的告警功能，日志易系统
维护人员能够第一时间发现日志系统的故障，并对故障及时做出响应。
9.1. 日志易 Manager 说明
日志易Manager主要用于日志易系统的日常管理，如集群设备扩容、集群应用模块的日常
升级、版本管理、日志易集群应用模块动态调整、日常服务启、停和监控等工作。详细内容
如下：
部署功能
 支持通过Manager在指定服务器上安装Agent。
 支持在安装了Agent的机器上自动下载日志易后台所有模块。
 支持在Manager上导入指定的日志易版本安装包。
 支持在安装了Agent的机器上更新日志易后台所有模块到指定版本。
 支持更新所有服务器使用的license。
 支持更新Agent的版本。
 支持更新server的版本。
模块管理功能
 支持在Agent服务器上添加/删除运行的日志易后台模块。
 支持在Agent服务器上启动/停止/重启已添加的日志易后台模块。
 支持查看在Agent服务器上已添加的日志易后台模块运行状态/标准输入输出/日志内容。
 支持修改运行的日志易后台模块的配置和配置文件模板。
监控功能
 支持通过Agent采集所有日志易服务器的性能指标/模块运行状态/模块性能指标。
9-318
日志学院
 支持通过页面查看采集到的所有业务性能指标/服务运行状态。
 支持查看整个日志易系统的运行状态。
 查看搜索集群状态和配置信息，下发新配置。
 支持命令行工具。
 支持检测系统的运行状态，发现异常时产生对应告警。
 支持配置告警策略，定制告警邮件的收件人。
 支持配置告警屏蔽策略，在制定时间段内不发送告警邮件。
Manager架构图
Manager结构说明
ManagerServer：
Manager的中央服务器，每套日志易后台都必须部署一台，包含3个模块：
 中央HttpServer：提供Manager页面服务。同时告警等相关功能也是集成在这个模块里
面的。
 MysqlDB：用于保存Manager用到的各类信息、配置、操作等。注意的是这个mysql
和日志易系统使用的mysql是独立的两个进程，可以部署在不同机器，使用3307端口。
 InfluxDB： 用于保存Agent采集到的各项性能指标。（由Agent直接写入，server只从
influxdb中读取数据。）
ManagerAgent：
Manager使用的Agent，主要负责日志易后台文件的同步/进程管理/性能采集。本身也分为
几个部分：
 Runtime包：放在/opt/rizhiyi 下，主要是给日志易后台模块及Agent本身使用的
java/python运行环境以及一些管理工具。
 Agent程序：Agent的核心程序。负责通过心跳上报/控制进程状态，采集进程性能数据。
 Supervisor：Agent通过它来管理日志易后台的进程。
 日志易后台模块包：Agent会自动从中央下载并安装到/opt/rizhiyi/parcels目录，供进程
启动时使用。
9-319
日志学院
9.2. Manager 集群扩展
日志易集群服务器如需要扩展，可以采用界面添加主机进行在线扩展。
选择顶部菜单中的“主机”项，进入主机概览页面，点击添加主机按钮。
在弹出页面中填写要安装的服务器IP/密码（用户固定为root，不可修改，因为manager初
始化需要大量root权限的操作。如果用户无法给出root账号，那么请参考后面的命令行时
安装办法）。
点击下一步之后，即可完成添加，如果添加失败，也会显示对应的回显日志，用来分析安装
失败的原因。
要添加多台Agent时，只需要在ip这栏填入ip1,ip2,ip3 这样的多个ip，之间用逗号分隔即
可。
成功安装Agent的服务器，都可以在主机页面进行查看，有些情况下可能会慢一点，但是基
本1分钟之内都可以查看到。
9-320
日志学院
如果安装成功1分钟后还无法在主机页面查看到，说明agent上报心跳有问题，需要登录对
应的主机，检查agent进程是否启动，查看agent日志是否有什么异常报错。
命令行安装办法（适用于所有环境，一般建议在用户不给root/manager到各台主机的ssh
端口的网络策略，无法页面安装时使用）：
1、登录manager所在主机，找到安装脚本：
/var/lib/rizhiyi_manager_server/server/downloads/rizhiyi_manager_agent_install.sh
将安装脚本拷贝到需要安装的主机上；
2、在安装的主机上执行安装脚本：
rizhiyi_manager_agent_install.shManagerIPManager端口 安装主机IPrizhiyi19001
3、脚本执行完毕，安装完成。如果提示错误，请根据提示的错误检查错误原因。
注：
1、在对集群进行拓展时，最好是添加性能更高的主机，否则添加的主机不仅不会提升集群
的性能，反而可能导致集群性能更差；
2、对集群进行拓展时，主机的硬件、磁盘分区、初始环境设置最好与原集群保持一致，具
体配置更改详见初级培训教材。
9.3. 版本管理
大版本升级
1. 手工拷贝脚本rizhiyi_manager_server_update.sh 到manager机器的
/var/lib/rizhiyi_manager_server/server/downloads/目录下：
cprizhiyi_manager_server_update.sh/var/lib/rizhiyi_manager_server/server/downloads/
chownrizhiyi.rizhiyi
/var/lib/rizhiyi_manager_server/server/downloads/rizhiyi_manager_server_update.sh
chmod+x/var/lib/rizhiyi_manager_server/server/downloads/rizhiyi_manager_server_update.sh
2.Manager页面升级managerserver
3.Manager页面升级manageragent
4.Manager页面导入对应版本的 YDP包，激活后完成升级
注意激活新版本时，如果模块提示有变化的，最好能人工检查一下，是否之前模板存在自定
义的部分，有的话，根据实际情况决定是否要保留（不确认的话最好保留），否则激活时不
做任何处理的话，会执行简单的覆盖式升级，之前的定制部分会丢失。
另外如果客户环境没有使用rizhiyi集群的mysql，而是使用外部的客户的mysql的，需要手
工调整部分配置。这块比较复杂，但是使用的客户非常少，所以不提供通用的升级工具，如
有问题请联系日志易技术支持进行协助。
注意，如果没做第一步直接页面升级的话，可能会出现导入YDP包之后，所有版本包显示
下载中的问题。可以按照以下步骤进行恢复：
1. 停止managerserver
9-321
日志学院
2.mv/var/lib/rizhiyi_manager_server/var/lib/rizhiyi_manager_server_err
3. 创建一个软链接：ln-s/data/rizhiyi/rizhiyi_manager_server/var/lib/rizhiyi_manager_server
4.chownrizhiyi.rizhiyi/var/lib/rizhiyi_manager_server
5.cp/var/lib/rizhiyi_manager_server_err/server/downloads/*.parcel
/var/lib/rizhiyi_manager_server/server/downloads/-f
cp/var/lib/rizhiyi_manager_server_err/server/downloads/*.sh
/var/lib/rizhiyi_manager_server/server/downloads/-f
cp/var/lib/rizhiyi_manager_server_err/server/downloads/*.tar.gz