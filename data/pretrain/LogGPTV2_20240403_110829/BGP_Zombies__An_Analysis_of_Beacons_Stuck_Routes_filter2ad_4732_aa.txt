title:BGP Zombies: An Analysis of Beacons Stuck Routes
author:Romain Fontugne and
Esteban Bautista and
Colin Petrie and
Yutaro Nomura and
Patrice Abry and
Paulo Gonçalves and
Kensuke Fukuda and
Emile Aben
BGP Zombies: An Analysis of Beacons
Stuck Routes
Romain Fontugne1(B), Esteban Bautista2, Colin Petrie3, Yutaro Nomura4,
Patrice Abry5,6, Paulo Goncalves2, Kensuke Fukuda6, and Emile Aben3
1 IIJ Research Lab, Tokyo, Japan
PI:EMAIL
2 Univ Lyon, Ens de Lyon, Inria, CNRS, UCB Lyon 1, 69342 Lyon, France
3 RIPE NCC, Amsterdam, Netherlands
4 The University of Tokyo, Tokyo, Japan
5 Univ Lyon, Ens de Lyon, Univ Claude Bernard, CNRS, Laboratoire de Physique,
Lyon, France
6 NII/Sokendai, Tokyo, Japan
Abstract. Network operators use the Border Gateway Protocol (BGP)
to control the global visibility of their networks. When withdrawing an
IP preﬁx from the Internet, an origin network sends BGP withdraw mes-
sages, which are expected to propagate to all BGP routers that hold an
entry for that IP preﬁx in their routing table. Yet network operators
occasionally report issues where routers maintain routes to IP preﬁxes
withdrawn by their origin network. We refer to this problem as BGP
zombies and characterize their appearance using RIS BGP beacons, a
set of preﬁxes withdrawn every four hours. Across the 27 monitored bea-
con preﬁxes, we observe usually more than one zombie outbreak per day.
But their presence is highly volatile, on average a monitored peer misses
1.8% withdraws for an IPv4 beacon (2.7% for IPv6). We also discovered
that BGP zombies can propagate to other ASes, for example, zombies
in a transit network are inevitably aﬀecting its customer networks. We
employ a graph-based semi-supervised machine learning technique to
estimate the scope of zombies propagation, and found that most of the
observed zombie outbreaks are small (i.e. on average 10% of monitored
ASes for IPv4 and 17% for IPv6). We also report some large zombie
outbreaks with almost all monitored ASes aﬀected.
1 Introduction
BGP is the protocol that governs inter-domain routing on the Internet. As such
understanding the boundaries of its behaviour is of prime importance. The tens
of thousands of Autonomous Systems (ASes) that constitute the Internet expect
to rapidly be able to change the routing and reachability of the address space
they are originating towards all other ASes. The process of announcing and
withdrawing address space is of utmost importance.
When an origin AS withdraws a preﬁx, it sends a withdrawal message to its
BGP neighbours, who will in turn propagate it to their neighbours. Sometimes a
c(cid:2) Springer Nature Switzerland AG 2019
D. Choﬀnes and M. Barcellos (Eds.): PAM 2019, LNCS 11419, pp. 197–209, 2019.
https://doi.org/10.1007/978-3-030-15986-3_13
198
R. Fontugne et al.
network sees the best path that it propagated to neighbours disappears, but in a
rich topology the network still has alternative paths yet to be withdrawn. In that
case the neighbours will not receive a withdrawal, but the best alternative path.
This process, called path hunting, typically causes several BGP path changes in
the matter of minutes, before a BGP preﬁx is fully withdrawn [9]. The richer
the topology between the origin AS and a BGP speaker, the larger the number
of path changes.
Theoretically this withdrawal process ends with the preﬁx completely with-
drawn from all BGP speakers, as announcements and withdrawals propagate
through the entire Internet similarly. In practice, this sometimes fails, a phe-
nomenon known by network operators as stuck routes or zombie routes. In this
case, path hunting gets stuck in a state where BGP routes are still visible at some
BGP routers, something we can easily observe with route collector systems like
RIS, Routeviews, and Isolario [2,6,7].
This work is motivated by the operational confusion that missing withdrawal
causes. We have witnessed several cases where zombie routes caused confusion
about the state of the withdrawn address space. In addition, troubleshooting
and cleaning zombie routes is a burden for network operators. This phenomenon
is relatively unknown outside network operator circles, and generally not well
understood. We intend to shed light on BGP zombies in order to make the
research community aware of this problem and to assist operators.
In this study we characterize zombie routes in a controlled setting using
the RIS routing beacons. In this controlled environment, we can measure the
frequency of failed withdrawals, and alternative paths that are seen in the with-
drawal phase. The key contributions of this paper are to provide the ﬁrst charac-
terization of BGP zombies and a method to infer the scope of zombie outbreaks
with the help of a graph-based semi-supervised machine learning algorithm. Our
experiments reveal a surprisingly high number of zombies. Zombies are seen daily
in our dataset, but we found that the number of aﬀected ASes is usually limited
(on average 10% of monitored ASes in IPv4 and 17% for IPv6). The appearance
of zombie routes is very erratic. Zombie routes rarely emerge for numerous pre-
ﬁxes at the same time and for the same RIS peers. The average likelihood of
observing a zombie for a given RIS peer and beacon preﬁx is 1.8% for IPv4 and
2.7% for IPv6. Finally, we show that numerous zombie paths are revealed dur-
ing path hunting and the scope of an outbreak is usually related to the aﬀected
transit networks.
2 BGP Zombies
Before diving into the detailed analysis of BGP zombies, we deﬁne all the related
terminology and explain our experimental setup. A BGP zombie refers to an
active Routing Information Base (RIB) entry for a preﬁx that has been with-
drawn by its origin network, and is hence not reachable anymore. In this paper
we also refer to zombie ASes and zombie peers for ASes and BGP peers
whose routers have BGP zombies. We refer to all zombies that correspond to
BGP Zombies: An Analysis of Beacons Stuck Routes
199
the same preﬁx and appear during the same two-hour time slot as a zombie
outbreak, the outbreak size is the number of zombie ASes.
2.1 Experimental Setup
In order to observe BGP zombies one needs to withdraw an IP preﬁx from its
origin AS and inspect RIB changes, or lack thereof, in other ASes. We conduct
such controlled experiments with the help of RIPE’s Routing Information Service
(RIS) BGP beacons [4,14] and RIS BGP data repository [6].
The RIS BGP beacons are a set of IPv4 and IPv6 preﬁxes that are used solely
for studying Internet inter-domain routing. These IP preﬁxes are announced
and withdrawn at predetermined time intervals. Namely, RIS BGP beacons are
announced every day at 00:00, 04:00, 08:00, 12:00, 16:00, and 20:00 UTC, and
they are withdrawn two hours after the announcements (i.e. at 02:00, 06:00,
10:00, 14:00, 18:00, and 22:00 UTC). We are monitoring 27 beacon preﬁxes (13
IPv4 and 14 IPv6) announced from Europe, U.S.A., Russia, Japan, and Brazil.
RIS also archives RIB and BGP update messages collected at diverse places
on the Internet. RIS collectors (named rrc00, rrc01, etc.) are mainly located at
Internet eXchange Points (IXP) and peer with hundreds of diﬀerent ASes. Using
this archive we can monitor how these ASes respond to the BGP beacons stimuli
and characterize the emergence of BGP zombies.
For beacon preﬁxes, the detection of zombies in RIS peers is straightforward.
We keep track of the visibility of beacons for all RIS peers and report a zombie for
each RIB entry that is still active 1.5 h after the preﬁx was withdrawn. The 1.5 h
delay is set empirically to avoid late withdrawals due to BGP convergence [14],
route ﬂap damping [20], or stale routes [17]. Each beacon’s visibility is monitored
in near-real time using the RIPEstat looking glass [5] so we can trigger active
measurements (e.g. traceroutes) during detected zombie outbreaks.
We conducted experiments during the three periods of time listed in Table 1
and detected for the 27 monitored preﬁxes a total of 5115 zombie outbreaks,
each composed of one or more zombie routes for the same preﬁx.
Table 1. Measurement periods and number of detected zombie outbreaks for the 27
monitored beacons.
Start
End
#IPv4 outbreaks #IPv6 outbreaks
2017-03-01 2017-04-28 1732
2017-10-01 2018-12-28
2018-07-19 2018-08-31
384
520
591
1202
686
2.2 Example
Figure 1 illustrates the visibility for beacon 84.205.71.0/24 from all RIS peers on
September 9th and 10th, 2017. Peers are sorted on the y axis and time is repre-
sented by the x axis. From 12:00 to 18:00 UTC, all peers behave as expected. At
200
R. Fontugne et al.
Fig. 1. Visibility for 84.205.71.0/24 from all RIS collectors on September 9th and 10th,
2017. A zombie outbreak happened from 18:00 to 20:00 UTC and another one from
22:00 to 00:00 UTC. Both outbreaks are visible from three RIS peers.
12:00, RIS peers announce the availability of the beacon preﬁx and maintain an
active route to the preﬁx until 14:00. One peer from rrc19 withdraws the preﬁx
a bit late (14:19), but this is not considered as a zombie because the preﬁx is
withdrawn reasonably quickly. However, at 18:00 three peers do not withdraw
the beacon although this preﬁx is not reachable at that time. This zombie out-
break ends at 20:00 when the beacon is re-announced. A similar zombie outbreak
appears at 22:00 for the same three peers.
During the ﬁrst zombie outbreak (18:00-20:00), we found other zombies for
the same three peers but another beacon (84.205.67.0/24). The 25 other beacons
are withdrawn as expected at that time. For the second outbreak (22:00-00:00),
we found no other zombie. These observations give an early glimpse of the rela-
tionship between outbreaks for diﬀerent preﬁxes. Zombie outbreaks for diﬀerent
beacons can be related but are usually independent. We formally investigate the
co-occurrence of outbreaks from diﬀerent beacons in Sect. 4.1.
2.3 Are Zombies Real?
To ensure that no artiﬁcial zombies are caused by measurement artifacts, we
also looked for zombie evidences in other datasets.
First, for each zombie detected with the RIPEstat looking glass, we also
accessed the raw data from the RIS archive using BGPstream [16] and checked
that the withdraw messages are indeed missing in the raw traces. We found 794
outbreaks that are reported by the looking glass but not present in the raw data.
We ignored these events in our analysis; these are not listed in Table 1.
Then, we also looked at the presence of zombies in Routeviews data and
NLNOG looking glass during large zombie outbreak and conﬁrmed that zombies
are also present there. As Routeviews and RIS are now using completely diﬀer-
ent software for data collection (ExaBGP vs. Quagga/Zebra) we assume that
observed zombies are not caused by malfunctioning collectors.
Finally, during zombie outbreaks we performed traceroute measurements
towards beacon preﬁxes from Atlas probes located in zombie ASes. The tracer-
BGP Zombies: An Analysis of Beacons Stuck Routes
201
outes reveal that border routers in zombie ASes are indeed forwarding packets
whereas other routers usually drop these packets. We also use these traceroute
results to evaluate our method to infer zombie ASes on AS paths (Sect. 3.2).
3 Hunting Zombies
With the simple zombie detection technique described above, we observe zombies
only in ASes that are peering with RIS collectors. In this section, we show that
the withdrawn and zombie AS paths collected by RIS also enable us to infer
zombie ASes beyond RIS peers and estimate the scope of outbreaks.
For each outbreak we retrieve the AS path of zombie entries and the last
valid path for peers that have correctly withdrawn the beacon. A path alone
provides little information, but put together they reveal topological similarities
that we consider evidence for the locations of zombies.