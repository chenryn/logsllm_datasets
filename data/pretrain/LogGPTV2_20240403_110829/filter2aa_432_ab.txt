C.3.5  用 gdb 调试 GCC 程序..........................................................................326
C.4  另外的 C 编程工具........................................................................................330
C.4.1  Xxgdb..................................................................................................330
C.4.2  Calls ....................................................................................................331
C.4.3  cproto..................................................................................................332
C.4.4  Indent..................................................................................................333
C.4.5  Gprof...................................................................................................334
C.4.6  f2c 和 p2c ............................................................................................335
附录 D  Pi ng 源码........................................................................................................336
附录 E  TFTP 服务器程序源码.....................................................................................362
第 1 章  概论
- 1 -
第一章  概论
1.1  网络的历史
所谓计算机网络就是通过通信线路互相连接的计算机的集合。它是由计算机及外围设
备，数据通讯和中断设备等构成的一个群体。目前，计算机网络大部分都是多台计算机之
间能互连，通信，达到资源共享目的的网络系统，它是电子计算机及其应用技术与通讯技
术日益发展且两者密切结合的产物。
计算机的通信通常有两种方式：
1．通过双绞线，同轴电缆，电话线或光缆等有形传输介质而互相实现通信；
2．通过激光，微波，地球卫星等无形介质实现无线通讯。
后者是今后发展的主要方向，因为 90 年代以后，出现了各种各样的微型电脑（笔记
本电脑），无线网络在以后一定会进一步发展。
计算机网络的研制开始于 60 年代中期，至今以有 20 多年的历史。其网络技术发展
及应用已经十分普及，已经渗透到各个领域，并正在日益显示着它对信息化社会所带来的
影响和深远的意义。
在网络发展上，最早出现的是分布在很大的地理范围内的远程网络 （Wide Area
Network，WAN），例如美国国防部高级研究计划局首先研制的 ARPA 网，它从 1969 年
建立，至今已经发展成为跨越几大洲的巨型网络。
70 年代中期由于微型计算机的出现和微处理器的出现，以及短程通讯技术的迅猛发
展，两者相辅相成，又促进以微机为基础的各种局域网络（Local Area Network，LAN）的
飞快发展，1975 年美国 Xerox 公司首先推出了 Ethernet，与此时英国剑桥大学研制成剑桥
环网，他们是 LAN 的代表。
LAN 与 WAN 有所区别，其特点为：
有限的地理范围，通常网内的计算机限于一栋大楼，楼群或一个企业及单位。
较高的通讯速率，大多在每秒 1-100M bps ，而 WAN 大多在几十 Kbps。
通讯介质多样。
通常为一个部门所拥有。
特别是 80 年代以来，以微机为基础，LAN 技术有了极其迅速的发展。
90 年代计算机网络化大趋势尤为明显。具称 1978 年全世界约有 700 万人每天使用计
算机，而到 1998 年上升到 5000 万人，目前全世界已经拥有超过一亿台的计算机，预计每
天上机人数可达 2 亿以上。计算机的性能价格比以每年 25%的速度在提高。微机的应用已
经渗透到国民经济的各个部门，乃至家庭和个人。这标志着正步入信息时代，世界范围内
的社会信息数据正在每年增长 40%到 45%的年增长率在增加，这就是迫切实现网络化的动
力源泉。据称，约有 65%的计算机要联网或已经联网，以求彼此通信，达到资源共享的目
- 2 -
Linux 网络编程
标。
90 年代计算机网络化更加向深度和广度方向发展。人们要求网络传输的内容范围增
加，诸如数据之外，还需传输声音，图形，图象和文字，这就是以网络为基础的多媒体技
术，使网络的应用广度更加扩大，并最终为信息化社会的实现所必须的网络连接奠定基础。
当前国际 LAN 的市场上，两雄称霸，龙争虎斗的局面，将可能持续相当长一段时间。
正如大家知道的那样，80 年代后期美国 Novell 公司先是以“ 一花独秀，压倒群芳”
之势占据了国际 LAN 市场 60%以上，一路领先，扶摇直上，尤其是 NetWare 386 V3.11 版
推出后，受到普遍的注目；随后，国际上的软件公司龙头老大 Microsoft 公司先后推出了
LAN Manager V1.0（即 LAN 3+ Open）、LAN Manager V2.0 和 V2.1，后来居上，成为世界
LAN 的两大支柱之一。1992 年 10 月 Microsoft 又抢先发布了 LAN Manager V2.2，以更加
领先于 Novell 的 NetWare 386 V3.11，但后者立即随后推出了 NetWare 4.0。可见“ 龙争虎
斗”，瓜分市场的情景。
Novel LAN 采取了“ 将网络协议软件与网络操作系统 NetWare 紧密结合起来” 的设
计构想，可达到节省开销，提高运行效率之目标。Novell LAN 最大的特点是与其底层的网
卡的无关性，即是说 NetWare 可以虚拟的在所有流行的 LAN 上面运行，使它成为一个理
想的开发网络应用软件的平台，吸引了广大用户软件人员为之开发越来越多的网络应用软
件。反过来又推动其发展，同时 Novell LAN 采取了开放协议技术（OPT），允许各种网络
协议紧密结合，进而在 NetWare 386 V3.11 版中采用了 NLM 模块的组合技术，可以实现异
机种联网的难题。此外，Novell LAN 不需专用服务器，占用工作站内存最小，使用方便，
功能强，效率高，兼容性强，可靠性高，保密性强，容错性好。尤其在 NetWare 386 V3.11
版中实现了服务器软件的“ 分布式结构策略” 、“ 横向信息共享”、“ 报文传送” 技术、增添
了“ TCP/IP 栈” 、实现了“ SNA 协议” 和“ 开放式数据链路接口” 等一系列新技术，使 Novell
LAN 更深入人心，扩大了市场。
与此同时，Microsoft 公司的 LAN Manager V2.1 和 V2.2 版除了具备 Novel LAN 一些
通常的优点之外，还采用了“ 客户机／服务器” （Client/Server）的先进内网络体系结构，
以及基于多用户，多任务并发操作系统 OS/2 作为服务器的强大功能，并以 OS/2，Unix，
VMS 和 Windows NT 作为开发平台，更便于异类机种联网和异网互连。由于 LAN Manager
与 Windows 紧密结合，使它有更好的性能价格比。
在网络化技术迅速发展的今天，使用性强的 TCP/IP 协议立下了汗马功劳。起先，TCP/IP
（Transmission Control Protocol/Internet Protocol）是美国国防部于 70 年代提出的重大决策
之一，将网络（当时主要是中大型机连成的网络）互连起来，并按 TCP/IP 协议实现异网
之间“ 数据通讯和资源共享”，接着美国国防部高级计划局（DARPA）于 70 年代末提出了
一系列的国际互连（Internet）技术。使得在科学研究，军事和社会生活迫切需要的大范围
实现资源共享和交换信息得以实现。
TCP/IP 协议的基本思想是通过网间连接器（Gateway）将各种不同的网络连接起来，
在各个网络的低层协议之上构造一个虚拟的大网，是用户与其他网的通讯就像与本网的主
机通讯一样方便。
国际标准化组织 (ISO) 对网络标准提出了 OSI/RM（开放系统互连七层协议的参考模
型），这七层自低向高分别为物理层，数据链路层，网络层，传输层，会话层，表示层和
应用层。而自此之前，DARPA 提出的 TCP/IP 仅仅提供了高四层标准，对低三层没有定义，
第 1 章  概论
- 3 -
因此 TCP/IP 在设计时必须要解决与低层的接口问题。
1.2  OSI 模型
OSI 模型是国际互连网标准化组织（International Standards Organizations ISO）所定义
的，为了使网络的各个层次有标准。这个模型一般被称为“ ISO OSI （Open System
Interconnection）Reference Model”。虽然迄今为止没有哪种网络结构是完全按照这种模型
来实现的，但它是一个得到公认的网络体系结构的模型。
OSI 模型拥有 8 个层次：
1．Physi cal 物理层
它在物理线路上传输 bit 信息，处理与物理介质有关的机械的，电气的，功能的和规
程的特性。它是硬件连接的接口。
2．Dat a Li nk 数据链路层
它负责实现通信信道的无差错传输，提供数据成帧，差错控制，流量控制和链路控制
等功能。
3．Net Work 网络层
负责将数据正确迅速的从源点主机传送到目的点主机，其功能主要有寻址以及与相关
的流量控制和拥塞控制等。
物理层，数据链路层和网络层构成了通信子网层。通讯子网层与硬件的关系密切，它
为网络的上层（资源子网）提供通讯服务。
4．Transport 传输层
为上层处理过程掩盖下层结构的细节，保证把会话层的信息有效的传到另一方的会话
层。
5．Sessi on 会话层
它提供服务请求者和提供者之间的通讯，用以实现两端主机之间的会话管理，传输同
步和活动管理等。
6．Present at i on 表示层
它的主要功能是实现信息转换，包括信息压缩，加密，代码转换及上述操作的逆操作
等。
7．Application 应用层
它为用户提供常用的应用，如电子邮件，文件传输，Web 浏览等等。
需要注意的是 OSI 模型并不是一个网络结构，因为它并没有定义每个层所拥有的具
体的服务和协议，它只是告诉我们每一个层应该做什么工作。但是，ISO 为所有的层次提
供了标准，每个标准都有其自己的内部标准定义。
下面我们来看看 OSI 模型的层次图（图 1-1）：
- 4 -
Linux 网络编程
图 1-1  OSI 模型的层次图
1.3  Internet 体系模型
Internet 网是由许多子网通过网关互连组成的一个网格集合。网关是一个执行网络间
转发功能的系统，被网关连接的子网有一个共同特点，它们都使用 TCP/IP 通信协议。
Internet 是建立在 TCP/IP 基础上，因此采用了 TCP/IP 的网络体系结构。 TCP/IP 的网
络体系结构如表 1-1 所示：
表 1-1  TCP/IP 的网络体系结构
SMTP
DNS
HTTP
FTP
TELNET
TCP
UDP
NVP
ICMP
IP
ARP
RARP
以太网
PDN
其他
电话线
同轴电缆
光缆
在 TCP/IP 网络体系结构中，第一层和第二层是 TCP/IP 的基础，其中 PDN 为公共数
据网。第三层是网络层，它包含四个协议：IP，ICMP，ARP 和反向 ARP。第四层是传输
层，在网络上的计算机间建立端到端的连接和服务，它包含 TCP，UDP 和 NVP 等协议。
最高层包含了 FTP，TELNET，SMTP，DNS，HTTP 等协议。
网络层的主要功能由互连网协议（IP）提供，它提供端到端的分组分发，表示网络号
第 1 章  概论
- 5 -
及主机结点的地址，数据分块和重组；并为相互独立的局域网建立互连网络的服务。
要想网络连入到 Internet，必须获得全世界统一的 IP 地址。IP 地址为 32 位，由 4 个十
进制数组成，每个数值的范围为 0~255，中间用“ .” 隔开。每个 IP 地址定义网络 ID 和网
络工作站 ID。网络ID 标识在同一物理网络中的系统；网络工作站 ID 标识网络上的工作站，
服务器或路由选择器，每个网络工作站地址对网络 ID 必须唯一。Internet IP 地址有三种基
本类型：
A 类地址
其 W 的高端位为 0，允许有 126 个 A 类地址，分配给拥有大量主机的网络。
B 类地址
由 W.X 表示网络 ID，其高端前二位为二进制的 10，它用于分配中等规模的网络，可
有 16384 个 B 类地址。
C 类地址
其高端前三位为二进制 110，允许大约 200 万个 C 类地址，每个网络只有 254 个主机，
用于小型的局域网。
其格式表示如表 1-2：
表 1-2  IP 网络地址的格式
类型
IP 地址
网络地址
主机 ID
A
W.X.Y.Z
W
X.Y.Z
B
W.X.Y.Z
W.X
Y.Z
C
W.X.Y.Z
W.X.Y
Z
1.4  客户/服务器模型
主机结构的计算机系统是企业最早采用的计算机系统，它运行 Unix 操作系统或其他
多用户的操作系统。在多用户操作系统的支持下，各个用户通过终端设备来访问计算机系
统，资源共享，数据的安全保密，通讯等等全部由计算机提供。系统的管理任务仅仅局限
在单一计算机平台上，管理与维护比较简单。
但是，主机系统的灵活性比较差，系统的更新换代需要功能更加强大的计算机设备。
系统可用性较差，如果没有采用特殊的容错设施，主机一旦出现故障，就可以引起整个系
统的瘫痪。
客户机／服务器的体系结构如图 1-2 所示。
在客户机／服务器体系结构中至少有两台以上的计算机，这些计算机是由网络连接在
一起，实现资源与数据共享。计算机之间通过传输介质连接起来，在它们之间形成通路。
计算机之间必须按照协议互相通讯，协议（Protocol）是一组使计算机互相了解的规则与标
准，是计算机通讯语言。网络中的设备只有按照规定的协议来通讯的，而让执行不同协议
的计算机互相通讯也是一件复杂的事情。所以国际标准组织指定了开放系统互连（OSI）
协议，描述了计算机网络各结点之间的数据传送所需求的服务框架，称为计算机网络协议
参考模型。许多计算机网络厂家都以自己的技术支持某种协议，以此来开发计算机的网络
- 6 -
Linux 网络编程
产品。
图 1- 2  客户机／服务器的体系结构
网络计算环境中的资源可以为各个结点上的计算机共享，从服务的观点上来看，网络
中的计算机可扮演不同的角色：有的计算机只是执行＂服务请求＂任务，是一个客户机的
角色，有的计算机用语完成指定的＂服务功能＂，是服务的提供者，起着服务器的角色。
在网络化的计算机环境中，为计算机提供网络服务与网络管理是网络操作系统（NOS）
的基本功能。网络操作系统协调资源共享，对服务请求执行管理。最通用的网络服务是文
件服务，打印服务，信息服务，应用服务与数据库服务等。
文件服务
文件服务可以有效的存储，恢复与移动数据文件，它要执行数据的读，写，访问控制
以及数据的管理操作。文件服务可以帮助用户很快的将数据文件由一个地方转移到另外一
个地方。网络的文件服务可实现计算机之间的文件传送，文件转储，文件更新以及文件归
档等。
打印服务
打印服务用于控制与管理网络打印机与传真设备的网络服务，实现打印机硬件资源共
享。
信息服务
信息服务可动态的处理网络个结点计算机用户之间，应用程序之间的通信，网络的信
息服务为计算机网络目标之间提供了通信工具，并对分散的目标进行管理与操作。信息服
务可以实现工作组的应用，进行工作流程管理，决定工作流程路径，转移策略，处理分布
的商业事物等。信息服务可在用户之间传递信息与文件资料，可建立集成电子邮件系统等。
应用服务
网络应用服务用语协调网络间的硬件和软件资源，建立一个最适合的平台来运行应用
软件。
数据库服务
网络的数据库服务体统了共享数据的存储，查询，管理和恢复等多方面的服务。在数
据服务中，客户机的任务是接受用户的服务请求，并将这些请求按一定格式发送到服务器，
第 1 章  概论
- 7 -
客户机还对服务器返回的响应数据进行处理，并按规定形式呈现给用户。数据库服务器用
来分析用户请求，实施对数据库的访问与控制，并将处理结果返回给客户端。此时网络上
传输的只是请求与少量的查询结果，其网络通信负担比基于文件系统的 LAN 网少的多。
在 1985 年后形成的客户机／服务器计算模式，一般是针对一个企业的全部活动，按
照企业的业务模型由系统分析员建立整个企业的信息系统框架。再设计基于客户端／服务
器模型的。再设计系统结构时，首先要考虑以下几点：
需要多少资源并将他们设计为服务器。
有多少客户站点，他们要完成什幺子任务。
明确每个子业务和其他业务有什么关系，需要传递什么信息。
子业务由各站点开发的客户应用程序实现，程序开发的着眼点是如何实现本系统的子
任务。客户端程序通常由应用程序员利用常规的开发工具来完成。
服务器站点只开发服务器程序，该应用程序主要考虑如何发挥本站点资源的功能，如