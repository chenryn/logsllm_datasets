### Cross-AS Traffic and CDN Redirections

Our approach mitigates the problem of cross-AS traffic that is not cross-ISP traffic. This is because CDN redirections reflect the Internet topology and ISP policies, which are not captured by using simple AS numbers. For instance, Figure 9 illustrates that the performance benefits in RDSNET extend beyond a single AS number, indicating that relying solely on AS numbers fails to capture all the advantages of our approach.

### Limitations of Fine-Grained AS-Level Selection

Another limitation of fine-grained AS-level selection is the potential scarcity (or absence) of peers for a given ASN. Since CDN-based information is coarser, it provides more opportunities to reduce cross-ISP traffic. Specifically, we demonstrated that a significant number of paths to Ono-recommended peers cross one or more ASes, but the average number of AS hops for these paths is much lower than the corresponding number for paths from unbiased BitTorrent. In other words, a pure AS-based approach cannot achieve the reduction in cross-ISP traffic that Ono provides, as shown in the area where \( x > 0 \) in Figure 3.

### Coarse ASNs and Latency

On the other hand, ASNs can be too coarse, especially for an AS that is broadly geographically distributed. This can lead to poor performance due to large latencies. For example, AS7132 spans most of the continental US. However, since CDN redirections are primarily based on latency, CDN-based oracles can successfully avoid these scenarios.

### Absolute Network Positioning Systems

Another potential source of low-cost oracle information is an absolute network positioning system, such as Vivaldi [10] and GNP [24]. Peers could use such systems to exchange position information and bias their connections toward those with smaller "distances." However, this approach has several limitations. All peers must participate in the positioning service to engage in biased selection. In contrast, Ono peers can perform DNS lookups for those not running the service. Even with positions for each peer, determining a distance threshold for including a peer in the biased set is challenging. It is unclear what, if any, threshold will lead to good performance worldwide. CDN redirections, however, offer a natural way to determine proximity between peers, and we have shown that they effectively do so when encoded as ratio maps. Finally, network coordinates require potentially complex mechanisms to support large-scale systems [36], whereas the information generated by CDN redirections offers a simple, scalable, and efficient way to store and retrieve ratio maps relevant to Ono recommendations, whether using centralized trackers or decentralized storage.

### Concerns with Using CDN Redirections

Using CDN redirections in previously unanticipated ways raises several concerns. First, it is important to note that our system's interactions with CDNs do not force them to behave in ways that contradict their fundamental policies, nor does it access information that CDNs do not already make publicly available for free [6]. Another issue is whether our service disrupts CDN operations. In fact, our service does not place a significant burden on the CDNs from which it gathers network information. Our system performs only name translations and does not download CDN content, so there is no additional data-traffic load on the CDN servers. Additionally, our system queries its local DNS server to determine replica-server mappings, allowing DNS lookups to be answered from the local DNS cache without contacting the CDNs' DNS servers. Furthermore, our adaptive lookup rate mechanism can generate as few as 48 lookups per day from each peer, a vanishingly small fraction compared to web clients in the same network.

### Impact of CDN Behavior Changes

Another important consideration is how our system will perform if CDNs change their behavior. We believe that the goal of our system (reducing cross-ISP traffic) aligns with the policies and goals of CDNs (transferring content over high-quality paths). While CDNs may change their behavior, we do not expect any changes to interfere with our service's ability to reduce cross-ISP traffic.

### Conclusion

In this paper, we presented the design, implementation, and evaluation of an effective and scalable approach for reducing cross-ISP traffic in P2P applications without sacrificing performance, assuming trust between ISPs and their subscribers or requiring additional infrastructure. Our approach recycles network views collected by CDNs to inform a peer-selection algorithm that biases connections toward peers likely to minimize costly cross-ISP traffic. To experiment with it, we made an implementation available as an extension to the Azureus BitTorrent client starting in April 2007. Since then, the extension has been installed by over 120,000 subscriber peers worldwide. With their help, we performed extensive, continuous measurements, recording data for connections between over 2.5 million peer IP addresses per day. We collected DNS redirection information, transfer rates, path latencies, and traceroute measurements.

We used this data to show that our approach scales easily to well over one hundred thousand users and effectively "tames" BitTorrent by significantly reducing cross-ISP traffic without sacrificing performance or robustness. We demonstrated that this approach finds paths between peers that do not cross a single AS over one-third of the time and significantly reduces overall cross-ISP traffic compared to unbiased peer selection. Further, we showed that our biased peer selection implementation locates peers along paths with median RTT latencies that are two orders of magnitude smaller than paths to randomly selected peers. Finally, we showed that our biased selection does not reduce average file-transfer performance and, in fact, significantly increases transfer rates when peers have sufficient available bandwidth.

Based on our analysis, we suggest a new ISP-based approach to taming BitTorrent that is compatible with biased peer selection. Rather than blocking BitTorrent flows, ISPs should change their bandwidth allocations to favor connecting to peers inside the ISP. This approach will allow ISPs to significantly reduce costs while improving the user experience for their customers.

We showed that CDN-based oracles for peer selection work in a popular P2P file-transfer application, and we expect that the high-quality paths it finds will be useful in various other P2P contexts. As part of our future work, we plan to provide an open-source library that implements our approach in a protocol-portable way and evaluate its effectiveness for other aspects of P2P systems. Finally, to extend its reach to an even larger portion of the BitTorrent population, we are implementing a tracker that includes a biased set of peers in each scrape result according to our approach.

### Acknowledgments

We would like to thank our shepherd, Ion Stoica, and the anonymous reviewers for their helpful comments and suggestions. We also thank Kobus van der Merwe (AT&T Research), Pei Cao (Google), Yan Chen (Northwestern), Robin Kravets (UIUC), and Robert Morris (Cisco Systems) for their useful feedback on early ideas and drafts of this paper. We are grateful to Paul Gardner for his assistance in deploying Ono in Azureus. This research was supported in part by the US National Science Foundation CAREER Award CNS-0644062.

### References

[References listed here, formatted as in the original text]

This revised version aims to improve clarity, coherence, and professionalism while maintaining the technical depth and accuracy of the original text.