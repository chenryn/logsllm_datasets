cross-AS trafﬁc that is not cross-ISP trafﬁc. Our approach mitigates
this problem because CDN redirections reﬂect Internet topology
and ISP policies, structural information not present when using
simple ASNs. For example, Fig. 9 shows that performance beneﬁts
in RDSNET extend beyond a single AS number, indicating that
simply using AS numbers fails to capture all of the beneﬁts from
our approach.
Another limitation of ﬁne-grained AS-level selection is that
there may be few (or zero) peers in the system for a given ASN.
Because CDN-based information is coarser, it allows for more
opportunities to reduce cross-ISP trafﬁc. In particular, we showed
that a signiﬁcant number of paths to Ono-recommended peers
crosses one or more ASes, but the average number of AS hops
for these paths is nevertheless much lower than the corresponding
number for paths from unbiased BitTorrent.
In other words, a
pure AS-based approach cannot achieve the reduction in cross-
ISP trafﬁc that Ono provides in the area between the curves where
x > 0 in Fig. 3.
On the other hand, ASNs can be too coarse, e.g., for an AS
that is broadly geographically distributed. This could lead to poor
performance from biased peers due to large latencies – e.g. AS7132
spreads over most of the continental US. Because CDN redirection
are based primarily on latency, however, CDN-based oracles can
successfully avoid these scenarios.
Another potential source for low-cost oracle information is
an absolute network positioning system, e.g., Vivaldi [10] and
GNP [24]. Peers could use such systems to exchange position
information and bias their connections toward those with a smaller
“distance.” There are several limitations to this approach. For
one, all peers in the system must take part in the positioning
service to participate in biased selection. In contrast, Ono peers
can perform DNS lookups for those peers not running the service.
Even with positions for each peer, one must determine a distance
threshold for including a peer in the biased set.
It is unclear
what, if any, threshold will lead to good performance worldwide.
CDN redirections, on the other hand, offer a natural way to
determine proximity between peers and we have shown that they
effectively do so when encoded as ratio maps. Finally, network
coordinates require potentially complex mechanisms to support
large-scale systems [36], whereas the information generated by
CDN redirections offers a simple, scalable and efﬁcient way to
store and retrieve ratio maps relevant to Ono recommendations,
when using either centralized trackers or decentralized storage.
There is a number of concerns that arise from using CDN redi-
rections in previously unanticipated ways. To begin, it is important
to note that our system’s interactions with CDNs in no way forces
them to behave in ways that contradict their fundamental policies,
nor does it access the type of information that CDNs do not already
make publicly available for free [6]. Another issue is whether our
service is disruptive to CDN operations. In fact, our service does
not place a large (or even signiﬁcant) burden on the CDNs from
which it gathers network information.
In particular, our system
performs only name translations and does not actually download
CDN content, so there is no additional data-trafﬁc load placed
on the CDN servers. Because our system queries its local DNS
server to determine replica-server mappings, DNS lookups can be
answered from the local DNS cache without contacting the CDNs’
DNS servers. Further, our adaptive lookup rate mechanism can
generate as few as 48 lookups from each peer per day—likely
a vanishingly small fraction of those generated by web clients
running in the same network.
Another important consideration is how our system will perform
should CDNs change their behavior. We believe that the goal of our
system (reducing cross-ISP trafﬁc) and the policies/goals of CDNs
(transferring content over high-quality paths) are directly aligned.
Thus, while it is always possible for CDNs to change their behavior,
we do not expect any change to interfere with our service’s ability
to reduce cross-ISP trafﬁc.
8. CONCLUSION
In this paper, we presented the design,
implementation and
evaluation of an effective and scalable approach for reducing cross-
ISP trafﬁc in P2P applications without sacriﬁcing performance,
assuming trust between ISPs and their subscribers or requiring
deployment of additional infrastructure. Our approach recycles
network views collected by CDNs to inform a peer-selection
algorithm that biases connections toward peers that are likely to
minimize costly cross-ISP trafﬁc. To experiment with it, we
made an implementation available as an extension to the Azureus
BitTorrent client beginning in April 2007. Since then, the extension
has been installed by over 120,000 subscriber peers distributed
worldwide. With their help, we performed extensive, continuous
measurements, and are currently recording data for connections
between over 2.5 million peer IP addresses per day. In particular,
we collected DNS redirection information,
transfer rates, path
latencies and traceroute measurements.
We used this data to show that our approach scales easily to
well over one hundred thousand users, and effectively “tames”
BitTorrent by signiﬁcantly reducing cross-ISP trafﬁc without sac-
]
t
c
p
<
x
[
F
D
C
 1
 0.9
 0.8
 0.7
 0.6
 0.5
 0.4
 0.3
 0.2
 0.1
 0
 1000
BT
Ono (AA)
Ono (CN)
Ono (LM)
Ono (FN)
Ono (AB)
Ono (PW)
 10000
 100000
 1e+006
 1e+007
Download rate (Bytes/s)
(a) Per-customer download rates.
]
t
c
p
<
x
[
F
D
C
 1
 0.9
 0.8
 0.7
 0.6
 0.5
 0.4
 0.3
 0.2
 0.1
 0
 1000
BT
Ono (AA)
Ono (CN)
Ono (LM)
Ono (FN)
Ono (AB)
Ono (PW)
 10000
 100000
 1e+006
 1e+007
Upload rate (Bytes/s)
(b) Per-customer upload rates.
Figure 13: CDFs showing effects of different CDN names on average transfer rates. Different customer names do not signiﬁcantly
affect transfer performance, except at large rates where latency and packet loss become more signiﬁcant.
In all cases, Ono
outperforms unbiased BitTorrent on average.
riﬁcing its performance or robustness. We show that this approach
ﬁnds paths between peers that do not cross a single AS over one
third of the time and signiﬁcantly reduces overall cross-ISP trafﬁc
compared to unbiased peer selection. Further, we demonstrate that
our biased peer selection implementation locates peers along paths
with median RTT latencies that are two orders of magnitude smaller
than paths to peers selected at random. Finally, we show that our
biased selection does not reduce average ﬁle-transfer performance
and in fact signiﬁcantly increases transfer rates when peers have
sufﬁcient available bandwidth.
Based on our analysis, we suggest a new ISP-based approach
to the problem of taming BitTorrent that is compatible with biased
peer selection as implemented in this work. Rather than blocking
BitTorrent ﬂows, ISPs should change their bandwidth allocations
so that it is more favorable to connect to peers inside the ISP than to
those outside. This approach will allow ISPs to signiﬁcantly reduce
costs while improving the user experience for their customers.
We showed that CDN-based oracles for peer selection works in a
popular P2P ﬁle-transfer application, and we expect that the high-
quality paths that it ﬁnds will be useful in a variety of other P2P
application contexts. As part of our future work, we plan to provide
an open-source library that implements our approach in a protocol
portable way and evaluate its effectiveness for other aspects of
P2P systems. Finally, to extend its reach to an even larger portion
of the BitTorrent population, we are implementing a tracker that
includes a biased set of peers in each scrape result according to our
approach.
9. ACKNOWLEDGMENTS
We would like to thank our shephard, Ion Stoica, and the
anonymous reviewers for their helpful comments and suggestions.
We thank Kobus van der Merwe (AT&T Research), Pei Cao
(Google), Yan Chen (Northwestern), Robin Kravets (UIUC) and
Robert Morris (Cisco Systems) for their useful feedback on early
ideas and drafts of this paper. We are also grateful to Paul Gardner
for his assistance in deploying Ono in Azureus. This research was
supported in part by US National Science Foundation CAREER
Award CNS-0644062.
10. REFERENCES
[1] ADLER, M., KUMARY, R., ROSSZ, K., RUBENSTEIN, D.,
SUEL, T., AND YAOK, D. D. Optimal peer selection for P2P
downloading and streaming. In Proc. of IEEE INFOCOM
(2005).
[2] AGGARWAL, V., BENDER, S., FELDMANN, A., AND
WICHMANN, A. Methodology for estimating network
distances of Gnutella neighbors. In Workshop on Algorithms
and Protocols for Efﬁcient Peer-to-Peer Applications at
Informatik (2004).
[3] AGGARWAL, V., FELDMANN, A., AND SCHEIDELER, C.
Can ISPs and P2P users cooperate for improved
performance? SIGCOMM Comput. Commun. Rev. 37, 3
(2007), 29–40.
[4] AKAMAI. Akamai CDN. http://www.akamai.com.
[5] AKAMAI. Sureroute, May 2003.
http://www.akamai.com/dl/feature_sheets/
fs_edgesuite_sureroute.pdf.
[6] AKAMAI. Akamai introduces ﬁrst-of-its-kind, real-time view
into health of the Internet, June 2007.
http://www.akamai.com/html/about/press/
releases/2007/press_060707.html.
[7] AKELLA, A., SESHAN, S., AND SHAIKH, A. An empirical
evaluation of wide-area internet bottlenecks. In Proc. of the
Internet Measurement Conference (IMC) (2003).
[8] BINDAL, R., CAO, P., CHAN, W., MEDVED, J., SUWALA,
G., BATES, T., AND ZHANG, A. Improving trafﬁc locality
in BitTorrent via biased neighbor selection. In Proc. of the
Int’l Conference on Distributed Computing Systems (ICDCS)
(2006).
[9] COHEN, B. Incentives build robustness in BitTorrent. In
Proc. of the Workshop on Economics of Peer-to-Peer Systems
(P2PEcon) (2003).
[10] DABEK, COX, KAASHOEK, AND MORRIS, R. Vivaldi: A
decentralized network coordinate system. In Proc. of ACM
SIGCOMM (2004).
[11] DAWSON, K. FCC seeks comment in Comcast P2P
investigation, January 2007. http://yro.slashdot.
org/yro/08/01/16/0238244.shtml.
[12] GUMMADI, K., GUMMADI, R., GRIBBLE, S.,
RATNASAMY, S., SHENKER, S., AND STOICA, I. The
impact of DHT routing geometry on resilience and
proximity. In Proc. of ACM SIGCOMM (2003).
[13] GUO, L., CHEN, S., XIAO, Z., TAN, E., DING, X., AND
[25] POUWELSE, J. A., GARBACKI, P., EPEMA, D. H. J., AND
ZHANG, X. Measurements, analysis, and modeling of
BitTorrent-like systems. In Proc. of the Internet
Measurement Conference (IMC) (2005).
[14] IPOQUE. Internet Study 2007: Data about P2P, VoIP, Skype,
ﬁle hosters like RapidShare and streaming services like
YouTube, November 2007.
http://www.ipoque.com/media/internet_
studies/internet_study_2007.
[15] IZAL, M., URVOY-KELLER, G., BIERSACK, E., FELBER,
P., HAMRA, A., AND GARCES-ERICE, L. Dissecting
BitTorrent: Five months in a torrent’s lifetime. In Proc. of
Passive and Active Measurement Workshop (PAM) (2004).
[16] KANGASHARJU, J., ROSS, K., AND ROBERTS, J.
Performance evaluation of redirection schemes in content
distribution networks. Computer Communications 24, 2
(2001), 207–214.
[17] KARAGIANNIS, T., RODRIGUEZ, P., AND PAPAGIANNAKI,
K. Should internet service providers fear peer-assisted
content distribution? In Proc. of the Internet Measurement
Conference (IMC) (2005).
[18] LI, J., AND SOLLINS, K. Exploiting autonomous system
information in structured peer-to-peer networks. In ICCCN
(2004).
[19] LIMELIGHT NETWORKS. Limelight networks CDN.
http://www.limelightnetworks.com.
[20] MADHYASTHA, H. V., ISDAL, T., MICHAEL PIATEK,
DIXON, C., ANDERSON, T., KIRSHNAMURTHY, A., AND
VENKATARAMANI, A. iPlane: an information plane for
distributed systems. In Proc. of the USENIX Operating
Systems Design and Implementation (OSDI) (2006).
[21] MENNECKE, T. DSL broadband providers perform
balancing act.
http://www.slyck.com/news.php?story=973,
November 2005.
[22] MIRROR IMAGE. Mirror image CDN.
http://www.mirror-image.net.
[23] NAKAO, A., PETERSON, L., AND BAVIER, A. A routing
underlay for overlay networks. In Proc. of ACM SIGCOMM
(August 2003).
[24] NG, T., AND ZHANG, H. Predicting Internet network distace
with coordinates-based approaches. In Proc. of IEEE
INFOCOM (2002).
SIPS, H. J. The Bittorrent P2P ﬁle-sharing system:
Measurements and analysis. In Proc. of the International
Workshop on Peer-to-Peer Systems (IPTPS) (Feb 2005).
[26] QIU, D., AND SRIKANT, R. Modeling and performance
analysis of BitTorrent-like peer-to-peer networks. In Proc. of
ACM SIGCOMM (2004).
[27] SALTON, G., AND MCGILL, M. J. Introduction to modern
information retrieval. McGraw-Hill, New York, NY, 1986.
[28] SANDVINE. Sandvine incorporated: Peer-to-peer policy
management, 2008. http://www.sandvine.com/
solutions/p2p_policy_mngmt.asp.
[29] SHAIKH, A., TEWARI, R., AND AGRAWAL, M. On the
effectiveness of DNS-based server selection. In Proc. of
IEEE INFOCOM (2001).
[30] SHANAHAN, K., AND FREEDMAN, M. J. Locality
prediction for oblivious clients. In Proc. of the International
Workshop on Peer-to-Peer Systems (IPTPS) (Ithaca, NY,
2005).
[31] SHEN, G., WANG, Y., XIONG, Y., ZHAO, B. Y., AND
ZHANG, Z.-L. HPTP: Relieving the tension between ISPs
and P2P. In Proc. of the International Workshop on
Peer-to-Peer Systems (IPTPS) (2007).
[32] SU, A.-J., CHOFFNES, D., BUSTAMANTE, F. E., AND
KUZMANOVIC, A. Relative network positioning via CDN
redirections. In Proc. of the Int’l Conference on Distributed
Computing Systems (ICDCS) (2008).
[33] SU, A.-J., CHOFFNES, D. R., KUZMANOVIC, A., AND
BUSTAMANTE, F. E. Drafting behind Akamai:
Travelocity-based detouring. In Proc. of ACM SIGCOMM
(2006).
[34] TEAM CYMRU. The Team Cymru IP to ASN lookup page.
http://www.cymru.com/BGP/asnlookup.html.
[35] WELLINGTON, B. dnsjava.
http://www.dnsjava.org/.
[36] WONG, B., SLIVKINS, A., AND SIRER, E. Meridian: A
lightweight network location service without virtual
coordinates. In Proc. of ACM SIGCOMM (2005).
[37] XIE, H., YANG, R., KRISHNAMURTHY, A., LIU, Y., AND
SILBERSCHATZ, A. P4P: Provider portal for (P2P)
applications. In Proc. of ACM SIGCOMM (2008).