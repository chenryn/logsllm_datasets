Mass$Scanning$the$Internet$
Tips,$tricks,$results$
$
Robert$Graham$
Paul$McMillan$
Dan$Tentler$
0.0.0.0/0$
Why$scan$the$Internet$(defensive)$
•  How$many$systems$are$vulnerable$to$
Heartbleed?$
•  How$many$systems$can$be$used$for$NTP$
ampliﬁcaKon?$
•  How$many$systems$vulnerable$to$DLLink$
router$vulnerability/$
•  Survey$all$SSL$cerKﬁcates$in$use$
Why$scan$the$Internet$(oﬀensive)$
•  Uh,$it’s$the$deepnet$
•  Pick$a$random$port,$run$masscan$with$“—
banners”,$and$you$ﬁnd$something$hackable$
within$minutes$
Why$scan$the$Internet$(really)$
•  Because$it’s$fun$
•  Because$it’s$informaKve$
–  You$can’t$appreciate$how$small$the$Internet$is$unKl$
you’ve$scanned$0.0.0.0/0$
•  It’ll$make$you$famous$
–  Pick$a$target,$like$a$Siemens$control$system$
–  Scan$the$Internet$for$it$
–  Do$a$BlackHat$talk$
–  Get$in$the$news$
TheoreKcal$Physical$infrastructure$
•  Packets$have$overhead$
– Ethernet$packets$have$44$bytes$overhead$
– TCP$SYN$packets$are$40$bytes$
•  Max$rate$for$1Lgbps$Ethernet$
– 476Lmbps$of$actual$traﬃc$
– 524Lmbps$of$Ethernet$overhead$
– 1,488,000$packets/second$
hap://blog.erratasec.com/2013/10/whatsLmaxLspeedLonLethernet.html$
ISP$billing$
•  Some$ISPs$measure$Ethernet$rate$
–  Charge$you$for$the$full$1Lgbps$
•  Some$ISPs$measure$WAN$rate$
–  Charge$you$for$~600Lmbps$
•  Some$ISPs$don’t$see$the$small$packets$
–  This$one$Kme,$ISP$didn’t$see$our$outbound$traﬃc,$only$
inbound$
•  Some$ISPs$are$unmetered$
–  Yea!$
PracKcal$Physical$Infrastructure$
•  VPS$can$strain$under$the$load$of$small$packets$
•  Ethernet$switches$struggle$with$small$packets$
–  Above$500kpps$is$ohen$diﬃcult$
–  Turning$oﬀ$ﬂowLcontrol$may$help$
•  Some$parts$may$drop$packets$
–  Transmijng$500kpps$doesn’t$mean$all$packets$are$
reaching$the$Internet$
•  I$usually$do$~150kpps$
–  When$I$don’t$parKcularly$care$about$speed$
Abuse$complaints$
•  You$will$get$abuse$complaints$
•  Your$ISP$will$get$upset$
•  Some$things$are$worse$than$others$
– Heartbleed$scans$generate$abuse$complaints$
weeks$later$
– HTTP$scans$get$you$put$on$fail2ban$lists$
– Snort/emergingthreat$rules$generate$a$lot$of$
complaints$
ISPs$must$take$this$seriously$
•  Some$networks$react$by$blackholing$the$enKre$
AS$
•  DoD$gets$real$pissy$
Maintain$exclude$list$
•  /etc/masscan/masscan.conf$
•  exclude$=$224.0.0.0L255.255.255.255$
•  excludeLﬁle$=$exclude.ips$
Complainers$are$ohen$dicks$
•  “I’m$going$to$call$the$
Internet$Police$on$you”$
•  “We’ve$blocked$you$at$
the$ﬁrewall,$so$there!$
neenerLneener”$
Complainers$are$ohen$stupid$
•  “The$infrastructure$of$
Woori$Financial$Group$is$
classiﬁed$as$"NaKonal$
Security$ObjecKve$
Facility$L$class$A"$and$
unauthorized$access$to$
this$facility$is$strictly$
prohibited$by$related$
laws$and$regulaKons.”$
Friendly$with$ISP$
•  We$work$closely$with$our$ISP$
•  Provide$free$cybersec$consulKng$
•  Handle$abuse$complaints$ourselves$
– SWIP$–$Shared$WHOIS$Project$
•  Add$everyone$who$asks$to$our$“exclude”$aka$
“blacklist”$ﬁle$
…or$you$can$do$anonymous$VPS$
•  Pay$cheap$VPS$provider$with$Bitcoin$
•  You$can$complete$the$scan$and$be$done$
before$complaints$cause$them$to$shut$down$
your$account$
•  A$lot$of$them$are$shady$operators$friendly$to$
spam$and$scammers$anyway$
masscan$
.$
like$nmap$
•  All$nmap$opKons$are$parsed$
– …if$only$to$say$“this$nmap$opKon$isn’t$supported”$
•  Output$formats$close$to$nmap$
– Can$be$imported$into$some$tools$
•  Lots$of$features$supported$
– SCTP$scanning$
– UDP$nmapLpayloads$
unlike$nmap$
•  Port)at)a)Time$instead$of$Host)at)a)Time$
– Results$for$each$port$reported$as$soon$as$it’s$
found$
– Results$are$not$combined$together$per$host$
•  …because$it’s$asynchronous$
– Transmit$thread$spews$out$requests$
– Receive$thread$receives$responses$
•  …making$it$1000$Kmes$faster$
Nmap$is$a$beaer$scanner$
•  NSE$is$way$cool$
•  Scanning$a$single$host$is$way$beaer$
•  Masscan$is$simply$a$faster$or$more1scalable$
scanner$for$large$networks$
It’s$own$TCP/IP$stack!!#$%^@$
•  Masscan$has$it’s$own$TCP/IP$stack$
– Runs$sideLbyLside$with$exisKng$stack$
– Defaults$to$same$address$
– Causes$duplicate$ARPs$and$TCP$RST$
•  OS$RSTs$prevent$TCP$connecKons$from$being$
established$
– Should$spoof$diﬀerent$IP$address$or$ﬁlter$range$of$
ports$to$prevent$this$
Banner$checking$
•  Establishes$TCP$connecKon$
•  HeurisKcs$ﬁgure$out$protocols$
– Scan$for$port$443$of$Internet$reveals$a$lot$of$SSH$
and$HTTP$running$on$that$port$
•  Only$a$few$things$supported$right$now$
– One$of$these$days$I’ll$NSELstyle$scripKng,$but$right$
now$you$can$hardLcode$C$stuﬀ$
MulKple$sources$
•  LLshard$1/50$
– Used$when$doing$the$same$scan$from$mulKple$
machines$
•  LLsourceLip$10.0.0.32L10.0.0.63$
– Spreads$out$a$scan$from$mulKple$IP$addresses$
from$the$same$machine$
•  LLsourceLip$0.0.0.0L255.255.255.255$
– …for$when$you$want$to$be$a$dick$
Load$tesKng$
•  This$will$crash$ﬁrewalls$
•  Great$for$load$tesKng$ﬁrewalls$
•  LLinﬁnite$LLbanners$LLsourceLip$$
– Maintains$lots$of$open$connecKons$with$target$
Binary$format$
•  Use$“LoB$foo.scan”$instead$of$“LoX$foo.xml”$
•  Then$convert:$
masscan$–readscan$foo.scan$–oX$foo.xml$
•  Because$
– It’s$more$compact$
– If$there’s$bugs$in$output,$I$can$ﬁx$them$
Spoof$scan$
•  Receive$on$one$IP$address$
– Such$as$a$burner$Android$phone$
– Receiving$packets$is$lowLbandwidth$
•  Send$from$data$center$without$egress$ﬁltering$
– LLsourceLip$spooﬁng$the$other$source$address$
results$
VNC$scanning$
•  ,$
Heartbleed$
•  600k$systems$vulnerable$
April$10$
•  300k$system$sKll$
vulnerable$July$
– Mostly$“devices”$
Secure:$you$keep$
using$that$word$
Some$I$think$are$just$honeypots$
Mainframe$scanning$
•  TN3270$TelnetLoverLSSL$port$992$
•  Look$at$@mainframed767$for$cool$pics$of$IBM$
Mainframe$login$screens$
•  ,$
$
$