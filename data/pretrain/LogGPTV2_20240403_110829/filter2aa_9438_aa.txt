# ADMIN UI 3
PWN-RE
## Description:
> The code quality here is terrible. Even the temperature scale is measured in "Kevins". Just bad Q/A all around here. If they choose to measure in Kevins rather than Kelvins, then it's a sure bet that they can't handle their memory properly. It looks like this also controls the SmartFridge2000 internal temperature for that whole home "just-works" experience.
## Solution:
Ok, so based on our progress from [Admin UI 2](Admin_UI_2.md), we're authenticated. What can we do now?
Here's an overview of the `sym.command_line` function which gets called once we're authenticated:
```
                                       .--------------------.
                                       | [0x4141428e]       |
                                       `--------------------'
                                           v
                                           |
                                       .---'
    .----------------------------------------------.
    |.-------------------------------------------. |
    ||                                 |       .-|-|--------------------------------------------------------------------------------------------------------------------------------------.
    ||.--------------------------------------. | | |                                                                                                                                      |
    |||.-----------------------------------. | | | |                                                                                                                                      |
    ||||                               | .-|-|-|-|-|-----------------------------------------------------------.                                                                          |
    ||||                               | | | | | | |                                                           |                                                                          |
    ||||                         .---------------------------------.                                           |                                                                          |
    ||||                         |  0x4141429a [gf]                |                                           |                                                                          |
    ||||                         | 0x414142a6 call sym.imp.printf  |                                           |                                                                          |
    ||||                         | 0x414142b2 call sym.getsx_char  |                                           |                                                                          |
    ||||                         | 0x414142ca str.quit             |                                           |                                                                          |
    ||||                         | 0x414142d4 call sym.imp.strcmp  |                                           |                                                                          |
    ||||                         `---------------------------------'                                           |                                                                          |
    ||||                                 f t                                                                   |                                                                          |
    ||||                                 | |                                                                   |                                                                          |
    ||||                                 | '------------------.                                                |                                                                          |
    ||||    .----------------------------'                    |                                                |                                                                          |
    ||||    |                                                 |                                                |                                                                          |
    ||||.-------------------------------.                 .---------------------------------.                  |                                                                          |
    |||||  0x414142dd [gi]              |                 |  0x414142ee [ge]                |                  |                                                                          |
    ||||| 0x414142dd str.Bye            |                 | 0x414142f2 str.version          |                  |                                                                          |
    ||||| 0x414142e4 call sym.imp.puts  |                 | 0x414142fc call sym.imp.strcmp  |                  |                                                                          |
    ||||`-------------------------------'                 `---------------------------------'                  |                                                                          |
    ||||    v                                                   t f                                            |                                                                          |
    ||||    |                                                   | |                                            |                                                                          |
    ||||    '----.                                              | |                                            |                                                                          |
    ||||         |                         .--------------------' |                                            |                                                                          |
    ||||         |                         |                      '--------------.                             |                                                                          |
    ||||         |                         |                                     |                             |                                                                          |
    ||||     .--------------------.    .---------------------------------.   .-------------------------------. |                                                                          |
    ||||     |  0x4141443c [gh]   |    |  0x41414313 [gj]                |   |  0x41414305 [gk]              | |                                                                          |
    ||||     `--------------------'    | 0x41414317 str.shell            |   | 0x41414305 str.Version_0.3    | |                                                                          |
    ||||                               | 0x41414321 call sym.imp.strcmp  |   | 0x4141430c call sym.imp.puts  | |                                                                          |
    ||||                               `---------------------------------'   `-------------------------------' |                                                                          |
    ||||                                       f t                               v                             |                                                                          |
    ||||                                       | |                               |                             |                                                                          |
    ||||                                       | |                               `-----------------------------'                                                                          |
    ||||                                       | |                               `-----------------------------'                                                                          |
    ||||                                       | '-----------------------------------------------------------------------------------------------------.                                  |
    ||||                                       '-------------------------------------------------------------------------.                             |                                  |
    ||||                                                                                                                 |                             |                                  |
    ||||                                                                                                             .--------------------.        .----------------------------------.   |
    ||||                                                                                                             |  0x4141432a [gn]   |        |  0x41414353 [gl]                 |   |
    ||||                                                                                                             `--------------------'        | 0x4141435c str.echo              |   |
    ||||                                                                                                                   t f                     | 0x41414366 call sym.imp.strncmp  |   |
    ||||                                                                                                                   | |                     `----------------------------------'   |
    ||||                                                                                                                   | |                           t f                              |
    ||||                                                                                                                   | |                           | |                              |
    ||||                                                                    .----------------------------------------------' |                           | |                              |
    ||||    .----------------------------------------------------------------------------------------------------------------'                           | |                              |
    ||||    |                                                               |                                     .--------------------------------------' |                              |
    ||||    |                                                               |                                     |                                     .--'                              |
    ||||    |                                                               |                                     |                                     |                                 |
    ||||.----------------------------------------------------------.    .---------------------------------.   .---------------------------------.   .----------------------------------.  |
    |||||  0x41414338 [go]                                         |    |  0x41414349 [gm]                |   |  0x41414393 [gr]                |   |  0x4141436f [gt]                 |  |
    ||||| 0x41414338 str.Security_made_us_disable_the_shell__sorry |    | 0x41414349 call sym.debug_shell |   | 0x41414397 str.debug            |   | 0x4141437f call sym.imp.printf   |  |
    ||||| 0x4141433f call sym.imp.puts                             |    `---------------------------------'   | 0x414143a1 call sym.imp.strcmp  |   | 0x41414389 call sym.imp.putchar  |  |
    ||||`----------------------------------------------------------'        v                                 `---------------------------------'   `----------------------------------'  |
    ||||    v                                                               |                                         f t                               v                                 |
    ||||    |                                                               |                                         | |                               |                                 |
    |||`----'                                                               |                                         | |                               |                                 |
    ||`---------------------------------------------------------------------'                                         | |                               |                                 |
    ||                                                                                                                | |                               `---------------------------------'
    ||                                                                                                                | '--------------.
    ||                                                                               .--------------------------------'                |
    ||                                                                               |                                                 |
    ||                                                                           .---------------------------------------------.   .------------------------------------.
    ||                                                                           |  0x414143aa [gy]                            |   |  0x4141441f [gu]                   |
    ||                                                                           | 0x414143aa str.Debug_data_dump:             |   | 0x41414426 str.Unknown_command___s |
    ||                                                                           | 0x414143b1 call sym.imp.puts                |   | 0x41414432 call sym.imp.printf     |
    ||                                                                           | 0x414143bc call sym.imp.getpid              |   `------------------------------------'
    ||                                                                           | 0x414143cc str.pid__d_cmds_executed__p___d  |       v
    ||                                                                           | 0x414143d8 call sym.imp.printf              |       |
    ||                                                                           | 0x414143dd call sym.imp.getpid              |       |
    ||                                                                           | 0x414143eb str.cat__proc__d_maps            |       |
    ||                                                                           | 0x414143fa call sym.imp.sprintf             |       |
    ||                                                                           | 0x414143ff str.Mappings:                    |       |
    ||                                                                           | 0x41414406 call sym.imp.puts                |       |
    ||                                                                           | 0x41414415 call sym.imp.system              |       |
    ||                                                                           `---------------------------------------------'       |
    ||                                                                               v                                                 |
    ||                                                                               |                                                 |
    |`-------------------------------------------------------------------------------'                                                 |
    `----------------------------------------------------------------------------------------------------------------------------------'
```
It basically supports several commands:
* quit
* version
* shell
* echo
* debug
Obviously `shell` looks like a good place to start, but is protected by some basic boolean check:
```
                                                                                                   |                                          
                                                                                               .--------------------------------------------. 
                                                                                               |  0x4141432a [gn]                           | 
                                                                                               | ; [0x41616138:1]=0                         | 
                                                                                               | movzx eax, byte [obj.shell_enabled]        | 
                                                                                               | xor eax, 1                                 | 
                                                                                               | test al, al                                | 
                                                                                               | je 0x41414349;[gm]                         | 
                                                                                               `--------------------------------------------' 
                                                                                                     t f               
                                                                                                     | |               
                                                                                                     | |               
                                                                                                     | |               
                                                                                                     | |               
                                                                                                     | |               
                                                                                                     | |               
                                                                                            .--------' |               
                        .------------------------------------------------------------------------------'               
                        |                                                                   |                          
                        |                                                                   |                          
                        |                                                                   |                          
                    .---------------------------------------------------------------.   .-----------------------------.
                    |  0x41414338 [go]                                              |   |  0x41414349 [gm]            |
                    | ; 0x41414a98                                                  |   | call sym.debug_shell;[gp]   |
                    | ; "Security made us disable the shell, sorry!"                |   | jmp 0x4141429a;[gf]         |
                    | lea rdi, str.Security_made_us_disable_the_shell__sorry        |   `-----------------------------'
                    | ; int puts(const char *s)                                     |       v                          
                    | call sym.imp.puts;[gg]                                        |       |                          
                    | jmp 0x4141429a;[gf]                                           |       |                          
                    `---------------------------------------------------------------'       |
```
`debug` gives us some useful information for an attack:
```
> Debug data dump:
 pid=1 cmds executed=0x41616134->1 Mappings:
00400000-00401000 r-xp 00000000 08:01 534875                             /home/user/main
41414000-41415000 r-xp 00014000 08:01 534875                             /home/user/main
41615000-41616000 r--p 00015000 08:01 534875                             /home/user/main
41616000-41617000 rw-p 00016000 08:01 534875                             /home/user/main
42533000-42565000 rw-p 00000000 00:00 0                                  [heap]
7f8471c8e000-7f8471e4e000 r-xp 00000000 08:01 537787                     /lib/x86_64-linux-gnu/libc-2.23.so
7f8471e4e000-7f847204e000 ---p 001c0000 08:01 537787                     /lib/x86_64-linux-gnu/libc-2.23.so
7f847204e000-7f8472052000 r--p 001c0000 08:01 537787                     /lib/x86_64-linux-gnu/libc-2.23.so
7f8472052000-7f8472054000 rw-p 001c4000 08:01 537787                     /lib/x86_64-linux-gnu/libc-2.23.so
7f8472054000-7f8472058000 rw-p 00000000 00:00 0
7f8472058000-7f847206e000 r-xp 00000000 08:01 537808                     /lib/x86_64-linux-gnu/libgcc_s.so.1
7f847206e000-7f847226d000 ---p 00016000 08:01 537808                     /lib/x86_64-linux-gnu/libgcc_s.so.1
7f847226d000-7f847226e000 rw-p 00015000 08:01 537808                     /lib/x86_64-linux-gnu/libgcc_s.so.1
7f847226e000-7f8472376000 r-xp 00000000 08:01 537819                     /lib/x86_64-linux-gnu/libm-2.23.so
7f8472376000-7f8472575000 ---p 00108000 08:01 537819                     /lib/x86_64-linux-gnu/libm-2.23.so
7f8472575000-7f8472576000 r--p 00107000 08:01 537819                     /lib/x86_64-linux-gnu/libm-2.23.so
7f8472576000-7f8472577000 rw-p 00108000 08:01 537819                     /lib/x86_64-linux-gnu/libm-2.23.so
7f8472577000-7f84726e9000 r-xp 00000000 08:01 540467                     /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.21
7f84726e9000-7f84728e9000 ---p 00172000 08:01 540467                     /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.21
7f84728e9000-7f84728f3000 r--p 00172000 08:01 540467                     /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.21
7f84728f3000-7f84728f5000 rw-p 0017c000 08:01 540467                     /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.21
7f84728f5000-7f84728f9000 rw-p 00000000 00:00 0
7f84728f9000-7f847291f000 r-xp 00000000 08:01 537767                     /lib/x86_64-linux-gnu/ld-2.23.so
7f8472b16000-7f8472b1c000 rw-p 00000000 00:00 0
7f8472b1e000-7f8472b1f000 r--p 00025000 08:01 537767                     /lib/x86_64-linux-gnu/ld-2.23.so
7f8472b1f000-7f8472b20000 rw-p 00026000 08:01 537767                     /lib/x86_64-linux-gnu/ld-2.23.so
7f8472b20000-7f8472b21000 rw-p 00000000 00:00 0
7ffedfba5000-7ffedfbc6000 rw-p 00000000 00:00 0                          [stack]
7ffedfbcd000-7ffedfbd0000 r--p 00000000 00:00 0                          [vvar]
7ffedfbd0000-7ffedfbd2000 r-xp 00000000 00:00 0                          [vdso]
ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]
```
Notice how `debug` provides us with the address of `obj.cmds_executed`: `cmds executed=0x41616134->1`
```
 .--------------------------------------------------. 
 |  0x414143aa [gy]                                 | 
 | ; 0x41414ace                                     | 
 | ; "Debug data dump:"                             | 
 | lea rdi, str.Debug_data_dump:                    | 
 | ; int puts(const char *s)                        | 
 | call sym.imp.puts;[gg]                           | 
 | ; [0x41616134:4]=0                               | 
 | mov ebx, dword [obj.cmds_executed]               | 