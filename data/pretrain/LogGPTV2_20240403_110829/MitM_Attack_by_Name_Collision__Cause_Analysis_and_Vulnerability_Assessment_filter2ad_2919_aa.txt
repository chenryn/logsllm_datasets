# Title: MitM Attack by Name Collision: Cause Analysis and Vulnerability Assessment in the New gTLD Era

## Authors:
- Qi Alfred Chen
- Eric Osterweil
- Matthew Thomas
- Zhuoqing Morley Mao

## Conference:
2016 IEEE Symposium on Security and Privacy

## Abstract
Recently, Man-in-the-Middle (MitM) attacks on web browsing have become more prevalent due to a problem known as "Name Collision" and the Web Proxy Auto-Discovery (WPAD) protocol. This attack can automatically redirect all web traffic of an Internet user to a MitM proxy upon launching a standard browser. The underlying issue is the leakage of internal namespace WPAD queries, a known but previously underexploited problem that has been exacerbated by the recent delegation of new generic Top-Level Domains (gTLDs).

In this paper, we investigate this newly-exposed MitM attack vector and conduct the first systematic study of its causes and vulnerability status. First, we analyze leaked WPAD query traffic to DNS root servers and find that a significant cause of the leakage is the settings on end-user devices. Specifically, under common settings, devices can generate internal queries when used outside an internal network (e.g., at home). Second, we define and quantify a measure of attack surface by identifying "highly-vulnerable domains" (HVDs), which are domains that expose a large number of potential victims. Our findings show that almost all leaked queries are for new gTLD domains that we classify as HVDs. Additionally, 10% of these HVDs have already been registered, making the corresponding users immediately vulnerable to exploitation.

Our results underscore the urgent need for proactive protection. We discuss potential remediation strategies at the new gTLD registry, Autonomous System (AS), and end-user levels, and use empirical data analysis to estimate and compare their effectiveness and deployment challenges.

## I. Introduction
Recently, Man-in-the-Middle (MitM) attacks on web browsing have become easier than ever. An attacker only needs to register one of certain domain names to automatically redirect web traffic from Internet users worldwide to their MitM proxy. The underlying vulnerability stems from a problem called "Name Collision," where internal systems use names from local namespaces that are also used in the global Domain Name System (DNS), leading to unexpected resolution in the public DNS namespace.

This paper focuses on a name collision-based attack arising from the leakage of internal namespace WPAD queries. These queries, designed to configure proxies within an administrative domain, are now leaking to the public DNS namespace. Although this has been a known issue, it was not easily exploitable until the recent delegation of new gTLDs, which allowed attackers to exploit these leaked queries by registering domain names and setting up MitM proxies.

To characterize the magnitude of this threat, we perform the first systematic study of the underlying causes and vulnerability status. We find that a significant proportion of the leakage is due to device settings, with devices generating internal queries when used outside an internal network. We identify highly-vulnerable Autonomous Systems (ASes) with high volumes of leaked WPAD queries and diverse vulnerable query domain names, primarily dominated by home access network ASes.

We then systematically assess the vulnerability status of these highly-vulnerable ASes. By focusing on domain names that persistently expose many victims, we define "highly-vulnerable domains" (HVDs). Applying our method, we find that almost all leaked queries are for new gTLD domains classified as HVDs. If these domains are registered by an attacker, they can start exploiting the vulnerabilities immediately. As of September 2015, the registration of these HVDs had just begun, and our analysis did not find strong evidence of malicious targeting, though some naive attack patterns were observed.

These results highlight the real MitM threat to Internet users and the urgent need for proactive protection. We discuss potential remediation strategies at the new gTLD registry, AS, and end-user levels, using empirical data to evaluate their effectiveness and deployment challenges.

## II. Background

### A. DNS Ecosystem
The Domain Name System (DNS) translates domain names into IP addresses. Domain names are organized hierarchically, with TLDs (e.g., .com) and SLDs (e.g., example in www.example.com). The DNS root zone, managed by ICANN, delegates TLDs to registry operators, who manage SLDs through registrars. Domain name resolution involves recursive DNS resolvers, which query name servers following the DNS hierarchy.

### B. Internal DNS Namespace and iTLD Usage
Internal networks often set up private DNS namespaces to control access to confidential information and operate independently of external connectivity. Some administrators use undelegated TLD strings (iTLDs) for internal namespaces, assuming they will never be delegated. However, with the New gTLD Program, many popular iTLD strings have been delegated, exposing internal queries to MitM attacks.

### C. WPAD: Automatic Proxy Discovery
Web Proxy Auto-Discovery (WPAD) is a protocol for browsers or operating systems to automatically locate a web proxy configuration file. It supports two methods: DHCP WPAD and DNS WPAD. In DNS WPAD, the proxy file location is inferred from the device's domain name. For example, in a company's internal network, the proxy file might be located at http://wpad.company.ntld/wpad.dat. All WPAD DNS queries should be served by local resolvers, but millions of such queries leak to the public DNS namespace, causing name collisions.

## III. Threat Model and Attack Surface

### A. Threat Model
The WPAD protocol is designed to configure proxies within an administrative domain. However, due to the leakage of internal queries to DNS root servers and the collision with new gTLD domains, the security weaknesses of WPAD are now more exploitable. Adversaries can register these leaked domain names and set up MitM proxies, redirecting web traffic to their servers.

### B. Attack Surface
We define "highly-vulnerable domains" (HVDs) as those that persistently expose many victims. By quantifying the attack surface, we find that almost all leaked queries are for new gTLD domains classified as HVDs. If these domains are registered by an attacker, they can start exploiting the vulnerabilities immediately.

## Key Contributions
- **Problem Characterization**: We provide a detailed analysis of the internal namespace WPAD query leakage problem and its severity.
- **Vulnerability Quantification**: We define and quantify the attack surface, identifying HVDs that persistently expose many victims.
- **Remediation Strategies**: We discuss potential defense methods at the new gTLD registry, AS, and end-user levels, using empirical data to evaluate their effectiveness and deployment challenges.

This comprehensive study highlights the real MitM threat to Internet users and provides a strong and urgent message for deploying proactive protection.