，同一个人兼任多个角色往往不是好主意。可将其视
处理安全事故，在响应过程中审核日志
访问安全系统并分析日志和其他数据
配置安全和日志记录设置，进行日常日志审核
批准日志记录和日志审核所需的应用程序配置更改
配置应用程序日志记录设置，可能进行日常日志审核
负责日志审核规程、更新规程
配置应用程序日志记录设置，可能进行日常日志审核
涉及工作示例
。但是应该注意的是，
第16章日志管理规程207
---
## Page 229
208
这些需求的动机是为了评估和监控用户操作，以及可能影响信用卡数据的其他事件（如系统
唯一的ID”（《Requirements and Security Assessment Procedures》，2010），这一条目使日志在
只拥有“计算机的操作记录”。将后者映射到实际用户往往带来额外的挑战。顺便说一句，
立日志记录过程，还提到日志必须与个人绑定（不是计算机或者生成日志的“设备”）。这个
16.4.1
对于日志记录和监控的强制关键领域是需求10和需求11的各个部分。
求和本章引用的其他项目。
故障)。
PCIDSS需求8.1强制组织“在允许用户访问系统组件或者持卡人数据之前，要为他们分配
需求常常给PCI实施者造成问题，因为许多人认为日志是“人的操作记录”，
AssessmentProcedures》，2010）。这确实是一个有趣的需求；它不仅强制日志的存在或者建
Procedures》（需求和安全评估规程，2010）提供了PCIDSS规章的完整细节，包括分段、需
此更加有用。
16.4
现在，日志记录和监控不限于需求10，实际上遍及所有12条PCIDSS需求；PCIDSS
接下来，10.2小节定义了需要记录的系统事件（或者，使“事件可以重建”）的最小列表。
我们将逐行介绍关键需求，然后深人细节、示例和实现指南。
本节介绍PCIDSS日志记录基本知识及其要求。《Requirements and SecurityAssessment
下面是 PCI DSS（v.2.0 ；《Requirements and Security Assessment Procedures》，2010）需
具体地说，需求10.1涵盖的是“建立一个过程，将对系统组件的所有访问（特别是使
10.2
10.1
《Requirements and SecurityAssessmentProcedures》（2010）文档中，需求10陈述如
顾名思义，为了达到依从性，你必须实现需求；它是必要的条件。在PCIDSS
PCI和日志数据
所有个人信息安全的策略”。
需求11陈述如下：“定期测试安全系统和过程。”需求12陈述如下：“维护一个处理
下：“跟踪和监控对网络资源和持卡人数据的所有访问”。
需求10-12
关键需求10
而现实中他们
---
## Page 230
它们提供了健康状况的最低需求，各种IT平台上的日志记录机制一般都能超过这个要求。
求（必须记录的事件）中的列表：
器）获得时间同步。
设计有一定可靠性的网络，你的系统应该配置为从可靠来源（如网络时间协议（NTP）服务
家庭或者小型办公室网络中，系统时间往往是随机的。不管你的服务器时间设成什么，为了
间的需求（William和Chuvakin，2012）。时间和安全事件监控的紧密结合似乎相当简单。在
的详情复制到一个隐藏文件（典型的内部人员权限违规使用），了解上述所有记录非常有用。
谁、何地、发生何事、来自何处。例如，如果试图发现谁修改一个信用卡数据库，将所有事务
疑活动。
“最佳实践”，这些最佳实践指出，要监控访问、身份认证、授权变更管理、系统可用性和可
的访问请求、身份认证和授权决策和系统对象更改。重要的是，这样的列表来源于IT治理
而且，PCIDSS需求10更加深人，包括了每个事件中需要记录的具体数据字段或者数值。
下一个需求10.4，处理常常被忽略但是很关键的一个需求：所有日志具备准确而一致时
这些字段是：
接下来，人们必须解决日志的机密性、完整性和可用性（CIA）。PCIDSS的10.5.1小
可以看到，上述最小列表包含了事故分析所需的基本属性，能够回答如下问题：何时、
10.3
可以看到，上述列表覆盖了数据访问、特权用户操作、日志访问和初始化、失败和无效
10.2.1访问持卡人数据的所有单独用户。
10.5
10.4
10.3.6受影响的数据、
10.3.5
10.3.1用户标识。
10.2.7系统级对象的创建和删除。
10.2.6
10.2.4
10.2.3
10.2.2
10.3.4
10.3.3
10.3.2
10.2.5
事件类型。
成功或者失败的指示。
审计日志初始化。
无效的逻辑访问企图。
对所有审计跟踪的访问。
具有根或者管理权限的任何个人进行的所有操作。
事件来源。
日期和时间。
标识和身份认证机制的使用。
、系统组件或者资源的标识或者名称。
第16章日志管理规程209
---
## Page 231
210
较。问题是，日志文件因为新记录的添加而不断增长，从而导致完整性检查的削弱。为了解
DSS的需求10.5.4说明了这种需求：将无线网络的日志复制到内部LAN上的日志服务器中。
AssessmentProcedures》，2010）。确实，将日志集中到一个或者一组用于日志分析的服务器
即将审计跟踪文件备份到集中日志服务器或者难以修改的媒介”（《Requirements and Security
果的日志。这涉及日志数据的“可用性”和“完整性”。PCIDSS10.5.3明确指出，必须“立
权修改”（《Requirements and SecurityAssessment Procedures》，2010）。这是显而易见的，因
密码和Web统一资源定位符（URL）一起记录在Web服务器日志中。
误输人证书，而在日志中显示密码的情况并不少见。编写质量低劣的Web应用程序可能造成
能够查看日志，原因之一是和身份认证相关的日志总是包含用户名。虽然不是真正的秘密
SecurityAssessmentProcedures》，2010）。这意味着，只有必须查看日志才能完成工作的人才
节介绍了机密性：“将对审计跟踪的查看限制在与工作相关的需求上”（《Requirements and
志是不可能的。因此，PCIDSS在这个需求上有个注释：“可以使用日志收集、解析和警报工
保留或者集中化日志。考虑到大型IT环境每天可能生成以GB计算的日志，人工阅读所有日
Procedures》，2010）。本章余下的部分介绍详细的日志审核规程和常规做法。
AAA服务器（例如RADIUS）等安全功能的服务器”（《Requirements andSecurityAssessment
仅要求“有日志”，还要求“有日志，并且查看它们。”10.6小节明确指出PCI组织应该按
决这一矛盾，
存档到外部存储）。文件完整性监控系统使用加密哈希算法，将文件和一个已知的正确副本比
新的日志数据不应该生成警报，因为日志文件不断增长，不会自己压缩（除非日志轮转或者
（《Requirements and SecurityAssessmentProcedures》，2010）。与此同时，在日志文件中添加
志上使用文件完整性监控和变更检测软件，确保现存日志数据不能在没有警告的情况下更改
上只保留极少量（或者没有）日志。因此，对于这些系统来说，集中化的日志最为重要。PCI
无法搜索。
是这一需求的另一种结果。人们应该始终记住，磁带上的日志不容易访问，在出现事故时也
对于日志保护和增加日志实用性都是不可或缺的。将日志备份到CD或者DVD（或者磁带
为如果日志被未授权方（或者任何人）修改，它们就不再是系统和用户活动的客观评估跟踪
但是用户名称信息提供了密码猜测所需的50%信息（另外50%是密码）。而且，因为用户错
但是，人们不仅必须保留来自恶意用户的日志，还应该保留系统故障和系统配置错误结
因此，PCIDSS 需求还覆盖了需要“每天审核”的日志源范围，而不仅是需要配置日志、
为了进一步降低日志修改的风险，并证明这样的修改没有发生，需求10.5.5要求“在日
许多网络基础设施（如路由器和交换机）被设计为将日志放到外部服务器，在设备自身
接下来是“完整性”。根据PCIDSS的10.5.2小节，必须“保护审计跟踪文件免遭未授
下一个需求最为重要，也是最容易被忽视的。许多PCI实施者忘记了，PCI需求10不
10.6
，应该注意完整性监控只能保证没有被日志记录组件不断写人的日志的完整性。
---
## Page 232
防火墙日志来验证这些配置，仅仅审核配置还不够，因为只有日志才能说明“实际发生了什
2010）。但是，在建立这种过程之后，人们必须验证防火墙配置变更确实得到授权，并且按
SecurityAssessmentProcedures》，2010）中提到，组织必须有“批准和测试所有外部网络
具实现需求10.6的依从性”（《Requirements and SecurityAssessment Procedures》，2010）。
的操作造成的。
服务。日志可以说明何时启动了之前禁用的服务，这可能是不知情的系统管理员或者攻击者
么”而不只是“如何配置”。
而不是“应该发生”的情况。
照书面的变更管理规程进行。这时日志记录变得极其方便，因为它说明了实际发生的情况，
连接以及防火墙配置变更的正式过程”（《RequirementsandSecurityAssessmentProcedures》，
件来证明。
但实际情况更为复杂：日志出现和隐藏在所有其他的小节中。
中规定，还出现在所有其他PCI需求中。许多人可能认为PCI中的日志都在需求10中说明，
本1.1中还明确地增加了一年的需求规定。
问题。因此，如果你无法查看1年前的日志，就违反了规定。而且，PCIDSS在更新后的版
AssessmentProcedures》，2010）。和其他无数需求不同，这一需求直接处理复杂的日志留存
“留存审计跟踪历史至少一年，保持在线可用性至少三个月”（《Requirements andSecurity
16.4.2
例如，需求1“安装和维护防火墙配置，以保护持卡人数据”（《Requirements and
需求1.3包含防火墙配置的指导原则，有关于人站和出站连接性的具体陈述。必须使用
类似地，需求2讨论密码管理“最佳实践”和一般的安全加固，例如不运行没有必要的
几乎所有满足PCIDSS需求的规定（如数据加密或者防病毒更新），都可能使用日志文
需求3更进一步，处理数据加密，这和日志记录有着直接而明确的联系。例如，3.6小
最后一个需求（10.7）处理另一个非常重要的日志记录问题—日志留存，它规定：
现在，我们做好准备，将要更加深入地研究日志和监控，
■PCI需求10规定以预先定义的细节水平记录来自范围内所有系统的特定事件。
下面，我们来总结一下目前为止学习的PCI日志记录需求：
10.7
范围内的所有日志应该留存至少一年。
日志应该定期审核；特定的日志应该至少一天审核一次。
应该保护所有收集日志的CIA（机密性、完整性、可用性)。
范围内的系统上的时钟和时间应该同步。
PCI要求日志中所有操作与实际用户挂钩。
与日志记录相关的其他需求
，这些日志和监控不仅在需求10
第16章日志管理规程211
---
## Page 233
212
安全感，损害依从性工作。
明公司正处于恶意软件的威胁之下，因为没有更新最新特征码的防病毒软件只能造成虚假的
为这些信息由防病毒评估日志提供。著名的“防病毒更新失败”问题也在日志中反映，它说
2010），必须查看所提到的这些日志。
是至关重要的。
确切地说，大部分加密系统记录密钥生成、分发和废止的日志，这些日志对于满足上述需求
（《Requirements and SecurityAssessment Procedures》，2010）。人侵检测只在审核日志和警报
（《Requirements andSecurityAssessmentProcedures》，2010），没有强大的评估日志记录功能
节（后文将以简略的形式展示）隐含了一个要求：拥有验证这些活动是否真正进行的日志。
时才有用。
控所有网络流量，并向有关人员发出可疑入侵的警报。保持所有人侵检测和预防引擎最新”
使用IDS或者IPS：“使用网络人侵检测系统、基于主机的入侵检测系统和人侵预防系统，监
Procedures》，2010）。
留存这些日志至少3个月，除非法律有其他限制”（《RequirementsandSecurityAssessment
对于这类日志有单独的数据留存需求：“使用访问者日志维护访问者活动的物理评估跟踪。
以物理日志簿的形式）的9.4小节也和日志管理有关（如果这些访问者日志是电子形式的）。
90天内至少修改一次密码。
AssessmentProcedures》，2010），也可以通过审核服务器日志来验证，以便确保所有账户在
这些活动的日志。
户ID、证书和其他标识符对象的添加、删除和修改”（PCIDSS8.5.1小节）。大部分系统记录
一个“最佳实践”，还是一个需求（需求8“为每个具有计算机访问权的个人分配一个唯一的
不应该看到数据的用户出现在访问数据的日志文件中，就需要采取纠正措施。
SecurityAssessmentProcedures》，2010），需要日志来验证谁能够访问文中所指的数据。如果
和应用程序安全监控，这是无法想象的。
ID"，
除此之外，8.5.9小节“每90天至少更改用户密码一次”（《Requirements and Security
需求7规定“根据业务按需了解的原则限制对持卡人数据的访问”（《Requirements and