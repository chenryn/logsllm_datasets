vulnerabilities in them. 
§  Here we just discuss the most serious case:  
Plaintext Storage of a Password 
25  |  Claud Xiao. Insecure Internal Storage in Android. HITCON, 2014.08 
How to “store password”, or, remember account? 
A balance between user experience and security. 
1.  Friendly but not secure: 
§  store password in plaintext 
§  store password in other reversible way, or obscure it 
2.  Secure but not friendly: 
§  not store password at all 
§  store password with symmetric-key algorithm, and request user to 
input passphrase every time 
26  |  Claud Xiao. Insecure Internal Storage in Android. HITCON, 2014.08 
Using token as a replacement of password 
§  Pros 
§  restrict resource access and control privilege more precisely 
§  e.g., when login by token, users can’t change password or security 
questions 
§  expiration and renewing mechanism 
§  Cons 
§  A non-restricted, full-privileged, non-expired token nearly equals to 
a password 
§  e.g., Amazon’s Android app 
§  Can also be stolen by our attack 
Ø  Developers have to control and deploy servers to cooperate with 
their client applications 
27  |  Claud Xiao. Insecure Internal Storage in Android. HITCON, 2014.08 
Token is not the silver-bullet  
§  For client applications of standard network services, 
developers can NOT expect which specific server users 
will connect to. 
§  IMAP, SMTP, POP3 
§  SSH, Telnet, FTP 
§  IRC 
§  HTTP 
§  …… 
§  These apps must follow standard network protocols and 
their authentication methods.  
§  Almost always password-based, e.g., IMAP-PLAIN and CRAM-
MD5. 
28  |  Claud Xiao. Insecure Internal Storage in Android. HITCON, 2014.08 
Common choice: user experience comes first 
§  Store or not store? 
§  In PC systems, the debate 
can be traced back to 1995 
or earlier. 
§  Finally, most of popular IM 
clients, mail clients and 
browsers chose to store it. 
§  Why? 
h"ps://developer.pidgin.im/wiki/PlainTextPasswords	
29  |  Claud Xiao. Insecure Internal Storage in Android. HITCON, 2014.08 
Security assumption 
§  Rely password storage’s security on system’s access 
control mechanisms. 
§  Classic explanation: https://developer.pidgin.im/wiki/PlainTextPasswords 
§  Google’s opinion 
https://code.google.com/p/android/issues/detail?id=10809 
tl;dr: 
1.  They’re old, insecure protocols;  
2.  We trust the system’s security. 
30  |  Claud Xiao. Insecure Internal Storage in Android. HITCON, 2014.08 
So we reported to Google… 
31  |  Claud Xiao. Insecure Internal Storage in Android. HITCON, 2014.08 
Android applications storing password in plaintext 
32  |  Claud Xiao. Insecure Internal Storage in Android. HITCON, 2014.08 
Applica'on 
Package	
  Name 
Installa'ons 
K9	
  Mail 
com.fsck.k9 
5,000,000	
  –	
  10,000,000 
Blue	
  Mail 
com.trtf.blue 
100,000	
  –	
  500,000 
MailDroid 
com.maildroid 
1,000,000	
  –	
  5,000,000 
myMail 
com.my.mail 
100,000	
  –	
  500,000 
SSH	
  Tunnel 
org.sshtunnel 
100,000	
  –	
  500,000 
Unix	
  Admin:	
  FTP	
SFTP	
  SSH	
  FTPS 
org.kidinov.unixadmin 
10,000	
  –	
  50,000 
SSH	
  Autotunnel 
cz.sde.tunnel 
10,000	
  –	
  50,000 
BotSync	
  SSH	
SFTP 
com.botsync 
10,000	
  –	
  50,000 
AndFTP	
  (your	
FTP	
  client) 
ysesoft.andftp 
1,000,000	
  –	
  5,000,000 
FtpCafe	
  FTP	
Client 
com.ftpcafe.trial 
100,000	
  –	
  500,000 
Pre-installed apps is also vulnerable 
§  Email (com.android.email and com.google.android.email) 
§  Passwords of POP3, SMTP and IMAP accounts are stored in 
EmailProvider.db and EmailProviderBackup.db. 
§  The Email application is pre-installed in almost every Android 
devices. 
§  Again, there’re 1 billion active Android users till Jun 2014. 
33  |  Claud Xiao. Insecure Internal Storage in Android. HITCON, 2014.08 
Pre-installed apps is also vulnerable (cont.) 
§  Browser (com.android.browser) 
§  Remembered passwords of websites are stored at  webview.db. 
§  22.7% of all mobile phone users use it (Jun 2014, by StatCounter). 
§  Some other third-party browsers have the same problem. 
34  |  Claud Xiao. Insecure Internal Storage in Android. HITCON, 2014.08 
http://gs.statcounter.com/ 
Specially for Taiwanese users 
§  PTT(批踢踢) is the most popular BBS in Taiwan 
§  base on TELNET 
Vulnerable PTT clients 
35  |  Claud Xiao. Insecure Internal Storage in Android. HITCON, 2014.08 
Applica'on 
Package	
  Name 
Installa'ons 
Mo	
  PTT 
mong.moptt 
500,000	
  –	
  1,000,000 
Miu	
  P" 
sg.xingzhi.miu_ptt 
100,000	
  –	
  500,000 
touchPTT 
com.yuandroid.touchPTT 
100,000	
  –	
  500,000 
JPTT 
com.joshua.jptt 
50,000	
  –	
  100,000 
…… 
DEMOs 
§  Android Email 
§  AndFTP 
36  |  Claud Xiao. Insecure Internal Storage in Android. HITCON, 2014.08 
Conclusions 
§  94.2% of popular Android apps can be backup thus are 
affected by the attack 
§  Network services clients and some pre-installed apps will 
store password in plaintext and become vulnerable by the 
attack. 
§  Affect almost all Android users, and may lead personal 
and enterprise’s account leaking 
37  |  Claud Xiao. Insecure Internal Storage in Android. HITCON, 2014.08 
Mitigations 
Easiest mitigation ways 
§  From OS’s perspective, 
§  Set default value of R.attr.allowBackup to false. 
§  Just a description in document is not enough. Most of developers 
ignored it.  
§  From Developer’s perspective, 
§  In AndroidManifest.xml, set android:allowBackup to false. 
§  Or implement a BackupAgent to specify what data to be backup. 
39  |  Claud Xiao. Insecure Internal Storage in Android. HITCON, 2014.08 
Easiest mitigation ways (cont.) 
§  From user’s perspective, 
§  Disable ADB debugging when not need it 
§  still not secure enough 
§  Avoid to lost it 
§  how? 
§  Update to the newest system 
§  Android L may be enough 
§  Reset useless phone to factory 
§  still vulnerable 
§  Encrypt the whole disk.  
40  |  Claud Xiao. Insecure Internal Storage in Android. HITCON, 2014.08 
Third-party hot patching 
§  Need root privilege at first 
§  an dilemma 
§  Discussed before by Collin Mulliner et al at ACSAC '13 
§  PatchDroid: scalable third-party security patches for Android 
devices 
§  Develop with existing dynamic instrumentation frameworks 
§  Xposed: http://repo.xposed.info/ 
§  adbi/ddi: http://www.mulliner.org/android/ 
§  Cydia	
  Substrate	
  for Android: http://www.cydiasubstrate.com/ 
§  There’re lots of great security enhancement apps based on them. 
41  |  Claud Xiao. Insecure Internal Storage in Android. HITCON, 2014.08 
Some simple patching ideas 
§  Disable ADB debugging when screen is locking 
§  Just like what FirefoxOS did.  
§  Fix the CVE-2013-6271 for Android <= 4.3 
§  Fix the CVE-2014-3153 for Android <= 4.4.4 
§  Disable “adb	
  shell	
  sendkey” when doing backup 
§  Transparently encrypt all internal data by a master 
passphrase 
42  |  Claud Xiao. Insecure Internal Storage in Android. HITCON, 2014.08 
DEMO 
43  |  Claud Xiao. Insecure Internal Storage in Android. HITCON, 2014.08 
Summary 
§  An attack to read or modify internal data in high success 
rate. 
§  94.2% of popular applications are influenced. 
§  Network services clients and pre-install apps store 
password in plaintext internally. 
§  Easy to mitigate the problem from different perspectives.  
44  |  Claud Xiao. Insecure Internal Storage in Android. HITCON, 2014.08 
Thank you! 
§  Claud Xiao, Senior Security Researcher at Palo Alto Networks 
§  @claud_xiao, PI:EMAIL 
§  DEMO code: http://github.com/secmobi/BackupDroid 
Special thanks to: 
Elad Wexler, Zhi Xu, Ryan Olson, Bo Qu, visualwu, irene, tombkeeper 
Greets: 
Nikolay Elenkov, Collin Mulliner, Kyle Osborn, Michael Ossman,  
MWR Labs, rovo89, jduck, Jay Freeman(saurik) 
45  |  Claud Xiao. Insecure Internal Storage in Android. HITCON, 2014.08