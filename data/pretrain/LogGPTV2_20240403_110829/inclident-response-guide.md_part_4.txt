如果检测到Tor®退出节点IP地址（TOR EXIT NODE category）：
1. 询问员工是否使用过Tor。
如果员工确认他或她使用Tor，那么这样的事件(event)不是事件，不需要进一步
调查。
如果员工表示他或她没有使用Tor，请继续进行调查。
2. 扫描可以使用Tor的软件受感染的计算机。 这样的软件可能是合法的软件，或者它可
能是使用Tor隐藏其活动的恶意软件。 扫描同一网段中的其他计算机的恶意软件。
3. 对于检测到的软件文件重复完整的识别过程。
如果检测到垃圾邮件IP地址（垃圾邮件类别）：
1. 继续进行事件响应过程的教训阶段（第35页）。
如果检测到恶意软件IP地址（恶意软件类别）：
1. 确定尝试与IP地址交互的软件，并对其进行分析。
有关分析软件样本的更多信息，请参见“分析工具”节。
2. 执行上述“检测到威胁的URL地址”小节中描述的对于恶意URL的操作。
遏制
本节为事件响应过程的遏制阶段提供建议。
遏制阶段的目标
遏制阶段主要有两个目标：
在保持系统可操作性的同时隔离受损资产。
19
推荐的IR流程和规则
防止删除可能用于调查的IOC。
隔离受攻击的计算机
建议将受感染的计算机放入单独的隔离网络中。 安全团队必须更改路由策略，以防止受感染
的计算机与组织的网络和Internet中的其他计算机进行通信。
不建议关闭受感染的计算机。 某些类型的恶意软件保留在内存中，并且不会在硬盘上创建文
件。 如果具有这种恶意软件的计算机被关闭，则该恶意软件的IOC将会丢失。 当系统收到关
机信号时，其他类型的恶意软件会删除其IOC。 这将使调查更加困难。
也不建议禁用受感染计算机的本地网络连接或将其与网络物理断开连接。 某些类型的恶意软
件跟踪受感染计算机上本地网络连接的状态。 如果连接已被禁用一段时间，恶意软件可能会
开始删除其存在的迹象，从而销毁了IOC。
创建内存和硬盘转储
为了继续调查，安全团队必须从受感染的计算机获取内存和硬盘备份。 这些备份包含恶意软
件的所有组件。
通过分析受损计算机的内存和硬盘转储，安全团队可以获取与攻击相关的恶意软件和IOC的样
本，并确定攻击方法。
该信息可用于防止相同类型的进一步攻击达到发送，开发或安装阶段。 通过分析恶意软件的
样本，安全团队可以找到有效的根除恶意软件的方法。
如果将内存和硬盘备份发送到安全团队是非常困难的，建议先发送内存备份。安全团队分析
内存备份后，团队必须决定是否还需要硬盘备份。例如，如果组织有几个地理上分开的办公
室，并且安全团队只在其中一个位置，则可能会出现这种情况。
有关创建内存和硬盘备份的推荐工具的更多信息，请参见“创建备份的工具”节。有关分析内存
和硬盘备份的工具的更多信息，请参见“分析内存备份的工具”“和”分析硬盘备份的工具“。
硬盘的完全备份总是占用硬盘上可用的全部硬盘空间。这是因为硬盘备份还包括来自硬盘空
闲（未使用）扇区的信息。例如，如果硬盘的容量为400千兆字节（GB），并且使用了50
GB的硬盘空间，则该硬盘的备份将需要400 GB。
保持可操作性
在受攻击的计算机被隔离后，系统必须保持其可操作性。 例如，如果组织网络中的多台服务
器遭到入侵，则安全团队必须更改路由策略，以便其他服务器承担受感染服务器的负载。
根除
本节为事件响应过程的根除阶段提供了建议。
20
推荐的IR流程和规则
根除阶段有两种可能的策略：
受损资产的完全恢复
例如，可以从工作站映像恢复工作站。
该策略非常适合于为员工工作站使用标准软件的组织。 如果受影响的资产是手机或其他
硬件设备，则可以使用出厂设置。
检测恶意软件和删除其文件及其从受损资产创建的所有组件。
例如，由后门软件感染的工作站可以通过从硬盘中删除后门和由其创建的所有文件以及
将系统注册表恢复到其原始状态来恢复。
可以通过使用“分析工具”节中描述的工具和实用程序分析恶意软件来检测恶意软件创建的组
件。
恢复
本节为事件响应过程的恢复阶段提供建议。
在此阶段，以前受损资产已经投入使用。 安全小组必须监测资产的状况一段时间，以确保威
胁得到彻底消除。
例如，如果组织网络中的其中一个服务器已恢复，则安全团队将其重新安装到组织的网络
中，调整路由策略以使用此服务器，并监视服务器的行为一段时间以确保没有可疑活动。
经验学习
本节为事件响应过程的经验教训阶段提供建议。
调查完成后，安全团队必须撰写报告。 此报告必须包含以下问题的答案：
事件是何时被谁发现的？
事件的范围是什么？什么资产会受到此次事件的影响？
遏制，消除和恢复阶段如何进行？
事件响应过程的哪个阶段是安全团队最有效？
在事件响应的哪个阶段，安全小组的行动需要改进？
根据报告和调查情况，安全团队必须制定有助于防止今后发生事件的措施，更新这类事件的
事故应急方案。
21
推荐的IR流程和规则
措施包括调整安全政策，改变组织资产配置，对公司员工进行信息安全培训。 在事件响应过
程中获得的IOC可以由安全小组使用，以便在将来发现其他类似的攻击。
事件响应计划必须包括一组书面指示，以便识别事件并作出响应。 即使不可能在将来完全防
止事件发生，事件响应计划也将有助于尽可能减少事件发现所需的时间，提高事件响应的有
效性。
22
事件响应示例
事件响应示例
本章提供了一个网络攻击的例子和安全小组进行的事件响应的例子。
攻击计划
本节提供了计划的网络攻击的示例。 在这个例子中，犯罪者试图获得对银行ATM控制系统
（ATM网关）的控制，以便从ATM终端提款。
攻击目标，载荷，漏洞利用和发送方式
袭击的目标是从ATM终端提款。 当攻击者获得对ATM网关的控制并损害ATM终端时，实现目
标。
这种攻击的载荷是加载软件。 在它被发送后，装载程序软件将下载，安装和运行bot软件（如
下所述）。 之后，装载机软件将继续监控机器人软件。 如果机器人软件被铲除，装载机软件
将再次下载并安装。 例如，端点防病毒解决方案可能会消除bot软件，但是加载程序软件会一
次又一次的安装。
bot软件将允许攻击者通过从C＆C服务器发送命令来远程控制受感染的计算机。 机器人软件
具有后门软件功能，允许攻击者控制受感染的计算机。
攻击者将使用备用软件窃取用户凭据。 他或她选择mimikatz软件，这是可以用于此目的的合
法软件。 bot软件与C＆C服务器建立连接后，bot软件将从C＆C服务器提供的URL下载
mimikatz软件。将在此次攻击中使用的最后一块软件是由攻击者开发的定制软件，以危及位
于ATM网关后面的ATM终端。 一旦攻击者获得对ATM网关的访问，该软件将被bot软件下载。
这种攻击的利用是包含加载程序软件的PDF文件。 通过利用Adobe®Acrobat®Reader软件中
的漏洞，漏洞利用将在打开文档时运行加载程序软件。
攻击者使用钓鱼来发送这些漏洞利用。 漏洞利用将附加到发送给目标组织的员工的电子邮件
中。
第一阶段：侦察
攻击者获取攻击ATM终端的方式的信息。 为此，攻击者必须控制一个银行的ATM网关，这是
一个受到重点保护的资产。
攻击者创建使用相同类型的ATM网关的银行列表。 然后，攻击者收集有关每家银行采取的安
全措施的信息。 攻击者分析可用信息并选择目标。 通过使用社会工程，攻击者获得银行雇员
和企业电子邮件地址列表。
第二阶段：武器化
23
事件响应示例
因为破坏银行安全边界是不太可能成功的，所以攻击者选择通过对组织的员工进行一次钓
鱼。
攻击者通过上文“攻击目标，载荷，漏洞利用和发送方式”中描述的攻击目标，载荷，漏洞利用
和发送方式。
第三阶段：发送
攻击者进行钓鱼攻击时。 他或她通过社会工程获得的雇员名单向并且几名雇员发送电子邮
件。 攻击者根据他们基于员工的一些漏洞组织钓鱼。 例如，财务部门的员工可能是这种攻击
的有用目标。
电子邮件似乎来自该国的金融监管机构（俄罗斯央行）。 这些电子邮件的文字是用来诱导雇
员打开附件的PDF文件。
第四阶段：漏洞利用
雇员在Acrobat Reader中打开PDF文件后，将加载程序软件的文件复制到员工的计算机硬
盘，并将加载程序软件添加到操作系统上的启动程序列表中。
第五阶段：安装
在受影响的计算机的下次启动时，操作系统将运行加载程序软件。 加载软件将下载bot软件，
安装它，并将其添加到启动程序列表中。 完成这些操作后，加载程序软件将监控机器人软件
的状态。 如果系统中不存在bot软件，装载软件将重复安装步骤。
24
事件响应示例
bot软件试图通过伪装成已知的合法系统进程lsass.exe（本地安全认证服务器）来隐藏用户的
存在。 该软件始终存在于Windows操作系统上的进程列表中。
第六阶段：命令和控制
bot软件建立与攻击者控制的C＆C服务器的连接。
第七阶段a：对于目标的操作（横向活动）
攻击者向bot软件提供的第一个命令是感染组织网络中的其他计算机。
僵尸软件使用受攻击的计算机的访问权限和用户权限以及已知的漏洞将漏洞利用到其他计算
机。 攻击者还可以选择受攻击组织内部使用的其他PDF文档。
此步骤的目标是危及上次操作系统启动后管理员帐户已登录的计算机。
第七阶段b：对于目标的操作（盗用凭据）
当一台计算机（管理员帐户登录后）被发现并遭到入侵时，机器人软件将下载mimikatz并运
行它。
25
事件响应示例
攻击者将使用mimikatz程序获取自上次操作系统启动以来在此计算机上登录的所有用户的用
户名和密码（包括Microsoft®ActiveDirectory®用户凭据）。 攻击者在此阶段的目标是获取
Active Directory管理员帐户的密码。
第七阶段c：对于目标的操作（攻击ATM网关）
攻击者命令bot软件来访问ATM网关。 bot软件使用前一阶段获得的管理员凭据来获取对ATM
网关的控制。 达成攻击目标。