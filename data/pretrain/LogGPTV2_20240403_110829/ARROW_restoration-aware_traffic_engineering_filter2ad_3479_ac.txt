âŠ² round up
ğ‘’ = ğ‘šğ‘–ğ‘›(âŒˆğœ†ğ‘’ âŒ‰ + ğ‘¥1, Î›[ğ‘’].ğ‘›ğ‘¢ğ‘š_ğ‘¤ğ‘ğ‘£ğ‘’ğ‘™ğ‘’ğ‘›ğ‘”ğ‘¡â„ğ‘ )
ğ‘Ÿ ğ‘§,ğ‘
else
âŠ² round down
ğ‘’ = ğ‘šğ‘ğ‘¥(âŒŠğœ†ğ‘’ âŒ‹ âˆ’ ğ‘¥1, 0)
ğ‘Ÿ ğ‘§,ğ‘
ğ‘’ Ã— Î›[ğ‘’].ğ‘šğ‘œğ‘‘ğ‘¢ğ‘™ğ‘ğ‘¡ğ‘–ğ‘œğ‘›;
âŠ² Find the restorable capacity according to modulations
ğ‘Ÿ ğ‘§,ğ‘
ğ‘’ = ğ‘Ÿ ğ‘§,ğ‘
âŠ² Append the result into LotteryTickets
ğ‘…ğ‘§,ğ‘.append (ğ‘Ÿ ğ‘§,ğ‘
return |ğ‘ | LotteryTickets {ğ‘…ğ‘§,ğ‘ }, ğ‘§ âˆˆ ğ‘
ğ‘’
)
optical topology of each failed IP link and tries to find a possible
surrogate fiber path for each lost wavelength. To avoid the extra la-
tency associated with frequency tuning and/or modulation change,
Arrow tries to keep the same modulation and frequency, if at all
possible. Otherwise, it finds the best alternative modulation and
frequency assignment. Since the RWA is a well-studied problem
in the optical networking literature [11, 12, 88, 91], we omit the
formulation here and refer the reader to Appendix A.2 for details.
Generating LotteryTickets with randomized rounding. The
solution of RWA_LP is a set Î› containing the frequency and mod-
ulation of the restorable wavelengths for IP links (line 2). However,
because of the ILP to LP relaxation, the number of restorable wave-
lengths is not always an integer. It turns out this is a blessing in
disguise for our LotteryTicket abstraction. We take advantage of
the situation by repeating a randomized rounding technique [70] to
generate |ğ‘| LotteryTickets from the floating point solution (lines
3â€“13).
To construct each LotteryTicket ğ‘…ğ‘§,ğ‘, we start with the optimal
floating-point solution Î› (line 5). The rounding process has two
probabilistic steps: 1) it decides the rounding stride based on a ran-
dom integer within [1, ğ›¿] where ğ›¿ is an input parameter (line 6);
and 2) it decides the rounding direction (up or down) by taking the
fractional part of the floating point solution as the probability of
Standard
TE Input
ğº(ğ‘‰ , ğ¸)
ğ¹ = {ğ‘“ }
ğ‘‘ğ‘“
ğ‘ğ‘’
ğ‘‡ğ‘“
ğ¿[ğ‘¡, ğ‘’]
ğ‘„ = {ğ‘}
ğ‘‡ ğ‘
ğ‘“
IP-layer network graph with datacenter sites
set ğ‘‰ and IP links set ğ¸.
Flows aggregated by ingress-egress sites.
Bandwidth demand of flow ğ‘“ .
Bandwidth capacity of IP link ğ‘’ âˆˆ ğ¸.
Set of tunnels for flow ğ‘“ , ğ‘‡ğ‘“ âŠ‚ ğ‘‡ .
1 if tunnel ğ‘¡ uses IP link ğ‘’ and 0 otherwise.
Considered failure scenarios.
Residual tunnels for flow ğ‘“ under scenario ğ‘.
Table 1: Standard TE input parameters.
rounding up [78] (lines 7â€“11).2 During the rounding process, we
make sure the rounded integer is never smaller than zero or goes
beyond the initial number of wavelengths for that IP link (lines 9
and 11). Finally, we calculate the amount of restorable bandwidth
capacity by multiplying the number of restorable wavelengths by
the modulation format (line 12).3 The algorithm returns |ğ‘| Lot-
teryTickets.
Handling LotteryTicketsâ€™ feasibility. Before Arrow feeds the
LotteryTickets into the TE, it performs an additional check to make
sure all LotteryTickets are feasible in the optical domain. We add a
feasibility check module to drop infeasible LotteryTickets that do
not meet all the constraints of our RWA formulation (Appendix A.2).
More specifically, since the LotteryTickets are generated using a
randomized rounding process agnostic to the optical topology, some
of them may violate the RWA constraints. Hence, it is necessary
to check the feasibility of the generated tickets and filter out the
infeasible ones.
3.3 Restoration-Aware Traffic Engineering
This section describes Arrowâ€™s restoration-aware TE formulation.
For clarity of presentation, we use FFCâ€™s [63] notation. Note that
other techniques that improve over FFC, such as TeaVaR [17] and
PCF [48], can also be applied on top of our formulation.
Standard TE input. We begin by considering the standard TE
input parameters listed in Table 1. Similar to prior work, we model
the WAN as a directed graph ğº = (ğ‘‰ , ğ¸), where the vertex set ğ‘‰
represents the datacenter sites, and edge set ğ¸ represents the IP
links between them. In each time epoch, there is a set of source-
destination pairs (or â€œflowsâ€), where each such pair ğ‘“ is associated
with a demand ğ‘‘ğ‘“ , and a fixed set of paths (or â€œtunnelsâ€) ğ‘‡ğ‘“ âŠ‚ ğ‘‡
on which its traffic should be routed. Link capacities are given by
ğ¶ = (ğ‘1, . . . , ğ‘|ğ¸|) (e.g., in bps). Similar to FFC, Arrow assumes the
tunnels are part of the input, but the formulation can be extended to
approaches such as ğ‘˜-shortest paths, traffic oblivious tunnels [58],
or logical sequences [48]. Failure scenarios are denoted by ğ‘ âˆˆ ğ‘„,
including fiber cuts, switch failures, and control plane failures. In
this paper, we only consider IP link failures caused by fiber cuts,
since optical restoration does not apply to switch or control plane
failures. To avoid having an exponential number of failure-related
2For example, if the floating point number is 6.3, it should be more likely for the
number to be rounded down to 6 and less likely to be rounded up to 7. Hence, we
define the probability to round down as âŒˆ6.3âŒ‰ âˆ’ 6.3 = 0.7 and the probability to round
up as 6.3 âˆ’ âŒŠ6.3âŒ‹ = 0.3.
3In practice, different wavelengths might have different modulations; in our implemen-
tation, we account for this by iterating over all wavelengths. To simplify the notation,
we omit this detail.
Arrow
Phase I
Input
Parameters
Table 1
ğ‘ ğ‘ = {ğ‘§}
ğ‘Ÿ ğ‘§,ğ‘
ğ‘’
ğ‘Œ ğ‘§,ğ‘
ğ‘“
ğ‘€ğ‘§,ğ‘
Standard TE input parameters.
Set of LotteryTicket indexes under scenario ğ‘.
Restorable bandwidth capacity for link ğ‘’ un-
der scenario ğ‘ and LotteryTicket ğ‘§.
Restorable tunnels for flow ğ‘“ under scenario
ğ‘ and LotteryTicket ğ‘§.
A parameter to bound LotteryTicket ğ‘§â€™s slack
variables under scenario ğ‘.
Slack variable for each edge ğ‘’â€™s restorable
bandwidth capacity ğ‘Ÿ ğ‘§,ğ‘
under scenario ğ‘ and
ğ‘’
LotteryTicket ğ‘§.
Arrow
Phase I
Output
Î”ğ‘§,ğ‘
ğ‘’
Subject to:
Maximize: ğ‘“ âˆˆğ¹ ğ‘ ğ‘“
âˆ€ğ‘“ : ğ‘¡âˆˆğ‘‡ğ‘“
âˆ€ğ‘’ : ğ‘“ âˆˆğ¹ğ‘¡âˆˆğ‘‡ğ‘“
âˆ€ğ‘“ , ğ‘, ğ‘§ : 
ğ‘ğ‘“ ,ğ‘¡ +
âˆ€ğ‘’, ğ‘, ğ‘§ : ğ‘“ âˆˆğ¹
âˆ€ğ‘, ğ‘§ : ğ‘’âˆˆğ¸ Î”ğ‘§,ğ‘
0 â‰¤ ğ‘ ğ‘“ â‰¤ ğ‘‘ğ‘“
ğ‘¡âˆˆğ‘Œ ğ‘§,ğ‘
ğ‘ğ‘“ ,ğ‘¡ â‰¥ ğ‘ ğ‘“
ğ‘¡âˆˆğ‘Œ ğ‘§,ğ‘
ğ‘’ â‰¤ ğ‘€ğ‘§,ğ‘
âˆ€ğ‘“ :
ğ‘“
ğ‘“
ğ‘ğ‘“ ,ğ‘¡ Ã— ğ¿[ğ‘¡, ğ‘’] â‰¤ ğ‘ğ‘’
ğ‘ğ‘“ ,ğ‘¡ â‰¥ ğ‘ ğ‘“
ğ‘¡âˆˆğ‘‡ ğ‘
ğ‘“
ğ‘ğ‘“ ,ğ‘¡ Ã— ğ¿[ğ‘¡, ğ‘’] â‰¤ ğ‘Ÿ ğ‘§,ğ‘
ğ‘’ + Î”ğ‘§,ğ‘
ğ‘’
(1)
(2)
(3)
(4)
(5)
(6)
Table 2: Arrow TE Phase I formulation.
constraints, we use TeaVaRâ€™s probabilistic approach [17] and only
consider highly-probable failure scenarios (see Â§6 for details).
Arrowâ€™s two phase formulation. Given a set of LotteryTickets,
our goal is to find the winning LotteryTicket for each failure sce-
nario and instantaneous traffic matrix. However, this formulation
would require solving an ILP (as shown in Table 9 in Appendix A.5)
which violates the tight runtime deadline for Arrow TE. To ad-
dress this challenge, we introduce a two-phase formulation that
separates the LotteryTickets selection from the traffic allocation
process while keeping both of them in LP form. Phase I selects
the winning LotteryTicket for each failure scenario based on the
input traffic demand and Phase II uses the winning LotteryTicket
to find the best traffic allocation on tunnels. Tables 2 and 3 present
Arrowâ€™s Phase I and II formulations, respectively.
Phase I input parameters. In addition to the standard TE inputs,
Phase I formulation takes the following input parameters: a series of
LotteryTickets (from Algorithm 1) where the amount of restorable
bandwidth capacity for IP link ğ‘’ is given as ğ‘Ÿğ‘§,ğ‘
. Moreover, Phase
ğ‘’
Iâ€™s input parameters include a set of restorable tunnels for flow ğ‘“
under scenario ğ‘ and LotteryTicket ğ‘§, denoted by ğ‘Œ ğ‘§,ğ‘
. A tunnel is
considered restorable if some (or all) of its IP links are restorable
during failure scenario ğ‘. The set ğ‘Œ ğ‘§,ğ‘
is calculated based on ğ‘Ÿğ‘§,ğ‘
.
ğ‘’
In scenario ğ‘, if every failed link ğ‘’ that tunnel ğ‘¡ traverses is avail-
ğ‘’ > 0), this tunnel is
restorable under scenario ğ‘ (i.e., ğ‘¡ âˆˆ ğ‘Œ ğ‘§,ğ‘
). Finally, we introduce
to
capture the ğ›¼-fraction of total restorable bandwidth capacity for
scenario ğ‘ and LotteryTicket ğ‘§ (details below).4
Phase I optimization goal and constraints. We use the same
optimization goal as FFC to maximize the network throughput. Con-
straints (1-3) are standard TE constraints to ensure the following:
the sum of the bandwidth of all tunnels of flow ğ‘“ should be larger
able after restoration (i.e.,ğ‘’âˆˆğ¸ ğ¿[ğ‘¡, ğ‘’] Ã— ğ‘Ÿğ‘§,ğ‘
a new input parameter called ğ‘€ğ‘§,ğ‘ calculated as ğ›¼ Ã—ğ‘’âˆˆğ¸ ğ‘Ÿğ‘§,ğ‘
ğ‘’
ğ‘“
ğ‘“
ğ‘“
Arrow
Phase II
Input
Parameters
Table 1
ğ‘Ÿâˆ—,ğ‘
ğ‘’
ğ‘Œâˆ—,ğ‘
ğ‘“
Arrow
Phase II
Output
ğ‘ ğ‘“
ğ‘ğ‘“ ,ğ‘¡
Standard TE input parameters.
Winning LotteryTicketâ€™s restorable band-
width capacity for link ğ‘’ under scenario ğ‘.
Winning LotteryTicketâ€™s restorable tunnels
for flow ğ‘“ under scenario ğ‘.
Total allocated bandwidth for flow ğ‘“ .
For flow ğ‘“ , the allocated bandwidth on tunnel
ğ‘¡ âˆˆ ğ‘‡ğ‘“ .
Subject to:
ğ‘ğ‘“ ,ğ‘¡ â‰¥ ğ‘ ğ‘“
Maximize: ğ‘“ âˆˆğ¹ ğ‘ ğ‘“
âˆ€ğ‘“ : ğ‘¡âˆˆğ‘‡ğ‘“
âˆ€ğ‘’ : ğ‘“ âˆˆğ¹ğ‘¡âˆˆğ‘‡ğ‘“
âˆ€ğ‘“ , ğ‘ : 
ğ‘ğ‘“ ,ğ‘¡ +
âˆ€ğ‘’, ğ‘ : ğ‘“ âˆˆğ¹
(7)
(8)
(9)
(10)
(11)
Table 3: Arrow TE Phase II formulation.
ğ‘¡âˆˆğ‘‡ ğ‘
ğ‘“
ğ‘ğ‘“ ,ğ‘¡ Ã— ğ¿[ğ‘¡, ğ‘’] â‰¤ ğ‘Ÿâˆ—,ğ‘
0 â‰¤ ğ‘ ğ‘“ â‰¤ ğ‘‘ğ‘“
ğ‘¡âˆˆğ‘Œâˆ—,ğ‘
ğ‘ğ‘“ ,ğ‘¡ Ã— ğ¿[ğ‘¡, ğ‘’] â‰¤ ğ‘ğ‘’