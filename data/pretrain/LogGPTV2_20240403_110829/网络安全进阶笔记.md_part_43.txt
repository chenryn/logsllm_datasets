---
## Page 204
第4章拒绝恶意代码与神秘的黑客
路径，如“C:webuest.exe”，就可以了。
BMetbos Npleget Fitaed Tersie 1.7
NBoxDeplyeWi
文件典：
Cl
nanle
系乐8
图4.24NetBox界面
（6）启动服务。方法有两种，第一种是在图形界面，直接进入“管理工具”下的“服务”
面板：另一种是在命令行下，停止命令为“NETSTOPSYSTEM”，启动命令为“NETSTART
SYSTEM”。如果我们要将这个服务副除，可以用“SCDELETESYSTEM”这个命令。
（7）结合批处理和脚本把这个做成自解压文件，或者其他的上传方式，比如通过后台数据
库备份上传后再修改密码。通过上述步骤建成术马后门后，黑客就可以方使地进行其他操作了、
通过这种对过程的分析，我们在日常的安全防范中就可以更加“有的放矢”，针对这种行
为“顺藤摸瓜”，并采取行之有效的防范措施，从而确保网络安全。
4.3寻找黑客突破的N种武器
在山东临沂银雀山出土的《孙兵法》上，有这样一段对话。齐威王日：“地平卒齐，合
面败北者，何也？（翻译为：地形很好，士兵也很齐心，为什么打了败仗？）”孙的回答是：
向纵深进兵，往往是能否夺取全局性胜利的重要关键。那么，这个典故对网络安全有什么启发
呢？现在，为了提高工作效率，许多网络管理员想尽办法对用户实行限制，同时，不甘寂宽的
用户也想尽办法突破限制。两相较量，到底鹿死谁手？下面，我们从管理员和黑客的角度出发，
分析网络应用中的一些典型问题，寻找突破内网限制的技巧。
4.3.1突破与反突破：一个典型的限制实例
首先从用户的角度来看看QQ登录时的网络设置。下面是一个QQ在内网登录后出现登录
失败的提示，单击“详细信息”按钮，可以看到详细的登录过程，如图4.25所示。
..195.
---
## Page 205
网络安全进阶笔记
023.
图4.25QQ登录失败的评细信息
从上面的记录可以看出：QQ不仅仅通过UDP方式登录服务器，还能够以TCP方式登录。
登录过程中，QQ首先向本地端口4000发送DNS请求，解析sz.tencent.com~sz7.tencent.com这
会尝试以TCP方式登录，准备连接TCP服务器的IP地址，并解析TCPconn.tencent.com~
TCPconn6.tencenLcom服务器的IP.当然，客户端协议并不是唯一的登录方式，如IMSN客户
端不能以MSN协议进行登录时，它会尝试用HTTP协议方式、HTTP代理、Socks代理等方式
进行登录。
从网络管理员的角度来看，传统的解决方法是通过对QQ的端口和服务器地址进行封堵、
阻断8000/8001等端口。实际操作中，如果针对这些端口作阻断规则，会影响用户正常上网，
所以只能对服务器的IP地址来做规则。在针对IP做阻断规则后，QQ已基本无法登录。不过，
实际应用中，如果腾讯公司增加新的QQ服务器，QQ也可以登录。另外，使用第三方代理软
件也可能绕过去。“知己知彼，百战不殆”。下面，我们通过技巧和工具的完美结合，轻松突
破限制。内部网中，如果用户不能玩游戏、浏览网站等，他们就会通过各种方法来突破限制。
4.3.2常规武器：突破网络限制的一般方法
现象描述：比较常见的情况是网管通常都会封杀比较常见的服务端口，导致用户不能访问
某些网站，不能使用QQ等工具进行聊天、玩游戏等。另外，出于安全考虑，有些网络管理员
会限制某些协议，如不能使用FTP、对下载进行限制等。
奥技巧：可以使用普通的HTTP代理或者SOCKS代理。
小知识：SOCKS（Protocol forsessions traversalacrossfirewall securely）协议即“防火培安全会话
转换协议”，它是一种几手万能的代理协议，虽然不能理解其转发的数据内部结构，
但它能够忠实地转发数据包，完成协议本来要完成的功能，通过一些工具软件的配合，
可以使用SOCKS协议轻松地穿造防火墙，在实际应用中，SOCKS代理可用于电子邮
件、新闻组软件、网络传呼ICQ、网络聊天mIRC和各种游戏应用软件等。
---
## Page 206
第4章拒绝恶意代码与神秘的黑客
突破之前，我们来分析一下常见的网络限制结构。目前，许多网络系统都使用了网络防火
墙将内部网络结构从外部网络中隔离，这种防火墙系统通常以应用层网关的形式工作在两个网
络之间，提供Telnet、FTP、SMTP等接入.突破这种网络防火墙的常见手段是使用SOCKS协
议，它提供了一个通用框架，使这些协议能够安全透明地穿过防火墙。
在网上找代理很容易，“QQ代理公布器V2005”就是一款不错的代理公布软件，下载地
址为htp:/www1.skycn.com/sof/9642.html。它是从网站上的数据库随机读取QQ代理（SOCK5
按钮就可以找到很多地址，然后测试端口能否连接和其连接速度，连接速度越快越好。如果顺
利登录上去，就说明这个代理是成功的。软件界面如图4.26所示。
现在，提供SOCKS服务的代理软件很多，“通通通”软件就是其中比较好用的一个代理
软件。软件下载地址为htp:/www.tongtongtong.com。软件安装完毕，还要对软件进行相关设
置。首先登录http://www.tongtongtong.com网站并注册为会员，然后到注册时所用的邮箱激活
用户名
（1）第一次启动服务之前，必须先进行设置。单击“设置”按钮，进入登录信息页面，如
图4.27所示。
图4.26利用QQ代理公布器查找代理地址
图4.27“通通通”服务器列表
（2）在“通通通服务器”选项卡中，选择“从列表中选择”，再从列表框中根据您是免费
用户还是付费用户来选择相应的服务器。注意，免费用户一般选择“公共服务器”，付费用户
根据个人网络情况选择电信服务器或网通服务器或动态中转服务器。在“登录信息”选项卡中
对应地输入登录名和登录密码，也就是在其网站注册的用户名和密码，如图4.28所示。
产
图4.28“通通通”登录信息
---
## Page 207
网络安全进阶笔记
前打勾，然后填入用户名和密码。按照以上步骤设置好后，单击“确定”按钮，就会回到“通
通通2006”启动成功了。启动成功后，屏幕右下角任务栏中的图标也会变成绿灯。如果登录不
上，可以先单击“获取最新列表”按钮，这样可以获取到最新的服务器列表，从而达到比较好
的速度。这样，一个绿色通道就此打造成功。
类似的工具还有很多，如e-border软件，它也可以轻松地将测览器请求截获。软件下载地
址为http://www.paopaolong.com/html/down/62.html。在一般的网络限制中，使用以上方法就绰
绰有余了。不过，要是遇到“老鸟”，就要考虑考虑使用下面的招式了。
4.3.3秘密武器：灵活运用Socksonline进行突破
Socksonline也是一款很优秀的代理软件，通过它，可以让局域网或内部网的用户顺畅地实
现与外部网络的通讯。软件下载地址为http:/www.waysonline.com/mader/download。若提示服
务启动完毕，表示系统已正常运行。软件连通后，界面如图4.29所示。
试代理区
来自
发进：33
目标
区城医包，服务进位，购买位里
连排数1务1000,生机NA
图4.29软件连通后的界面
Socksonline正常启动后，该程序就变成了本地的SocksProxy，用户就可以通过HTTPProxy
或其他Proxy访间Intemet了.如果要突破内网登录QQ，可以打开QQ中的设置窗口输入参数。
户名和密码验证。可以单击“测试”按钮，看是否连接了网络，如图4.30所示。
同样，如果要突破内网，实现自由上网，也可以使用类似方法在IE测览器中设置SOCKS5
代理服务器。对于爱玩“传奇”、“右器时代”、“魔力宝贝”、“大话西游”等网络游戏的
用户来说，如果身处学校机房或管理比较严格的单位网络，一般情况下，只能“望网兴叹”了。
不过，现在通过Socksonline和e-Border软件的配合，突破内网的限制就很容易了。
e-Border安装完成后，会弹出一个设置客户端程序的窗口，根据向导设置代理服务器名和
默认的端口1080。在e-Border的代理方式中，选择Proxyonly方式，表示将所有的网络连接全
部截获并通过SOCKS代理连接。然后单击Includelist（包含列表）按钮，在弹出的对话框中单击
Add（添加）按钮，把Socksonline软件加入到列表框中，用同样的方法把平时上网需要使用
198
---
## Page 208
第4章拒绝恶意代码与神秘的黑客
SOCKS协议的软件都加入列表框，当然，最重要的是把游戏软件也添加进去。单击OK按钮
关闭此对话框，如图4.31所示。
新设置一代理设置
热提公量
使用的量
务器
代雅服务额工作正装
图4.30QQ2006的代理设置
Eaclede Liat
DAI
图4.31e-Border中的应用列表框
需要注意的是，部分游戏可能通过读取IE代理设置而导致失败，此时不要将IE加入排除
列表，并将IE代理设置清除，这样游戏就能够顺利通过了。
4.3.4双剑合璧：巧用Socks2HTTP和SocksCap32突破限制
SocksCap32也是一个不错的突破工具，它由著名的NEC公司开发，可以使那些基于
Windows的通过TCP或者UDP协议通讯的客户端软件自动穿越SOCKS代理服务器。软件下
载地址为http://www1.skycn.com/sof/1043.html。实际使用中，如果连SOCKS代理也限制了，
我们就可以用它与其他网络软件结合，通过两次代理访问被屏蔽掉的网站。
谈到搭档，现在自然要联想到Socks2HTTP这个软件了。Socks2HTTP是一个代理服务器
协议转换软件，它能将基于SOCKS协议的请求转换为HTTP协议的请求，并通过指定的HTTP
代理服务器处理这些请求。软件下载地址为hitp:/www.totalrc.nets2hindex.jsp。
---
## Page 209
网络安全进阶笔记
（1）下载运行Socks2http软件，首次安装的时候出现提示配置。指定一个HTTP代理的具
体参数，如在Address栏填入HTTPProxy的域名或IP地址，本例中填入的通过代理猎手代理
调度服务器为127.0.0.1:8088，如图4.32所示。如果要更改配置，则在工具栏中右键单击
socks2http的图标，在弹出的快捷菜单中选择Configuration命令，其他与以上相同。
y tat rey a
图4.32Socks2http的代理配置界面
（2）运行Socks2htp，配置通过本机127.0.0.1端口1080的SOCKS5代理连接网络，要检
测你的Socks2htp是否成功配置好，可以尝试用代理猎手校验127.0.0.1服务器的端口1080，
选SOCKS5类。如果可以登录得上，则表示HTTPProxy已成功地转换为了SOCKSProxy。现
在我们就可以使用它了。
(3）配合SocksCap32软件，能使只提供HTTP代理服务的局域网使用非HTTP协议的软
件，如FTP客户端软件、E-mail客户端软件、Telnet客户端软件以及聊天软件等。选择“文件”
试由本地端再由远端解析”，然后单击“确定”按钮，如图4.33所示。
（4）单击SocksCap32面板中的“新建”按钮，如图4.34所示。单击“浏览”，选择需要
经过SocksCap32代理的应用软件和工作目录路径。或者直接将要运行的软件拖入窗口中的空
白处，在弹出的窗口中选择“新建应用程序标识项”，设置完毕，单击“确定”按钮。
（5）现在只需双击SocksCap控制台界面里的图标就可以了通过HTTP代理来聊天了。在
SocksCap中运行ICQ等软件时，不需对代理做特别配置，使用时不可以关闭SocksCap32.否
则运行的程序就不能正常继续运行。对于有些游戏，还可以考虑e-Border或者PermeoSecurity
Driver这个软件，后者是前者的商业版本，多试几次，应该能够找到突破的出口了。
当然，在突破的过程中，我们总会遇到许多问题，如果仍然不能成功，可能问题还是孙
在这种情况下，我们就要考虑是否使用了加密代理或者其他的情况。
200
---
## Page 210
第4章拒绝恶意代码与神秘的黑客
X
文
E5
图4.33SocksCap设置
图4.34SocksCap控制台
当然，如果最后还是不能成功的话，我们还有最后一招：考虑和网络管理员搞好关系！也
许，在不伤害感情的情况下，在服务器上稍微动点手脚，一切都能搞定了，不过，特别要强调