## Page 52
修复GRUB那一节。如果你看到了 grub>的提示符，这就意味着
3.3.2阶段1.5GRUB提示
段，显示了提示符，你就可以使用GRUB 命令尝试读取分区并做一
系统和访问阶段2的代码。一旦载人了阶段2或core.img，GRUB
定位和载人GRUB环境的代码。GRUB一般还会载人所谓的阶段
的时候，就没有备用的GRUB可以使用。
RAID阵列中其他磁盘的MBR中安装GRUB)，那么当主磁盘损坏
动这个模式（或者你使用的是老版本的GRUB，而且没有手动在
装在RAID 所有磁盘的 MBR中。如果你使用的安装包没有默认启
磁盘并从这里修复GRUB还是非常简单和迅速的。
些基本的故障排除。这也就是说，绝大多数时间里，启动进人恢复
配置的GRUB启动命令。事实上，如果GRUB到达了最后一个阶
问恢复磁盘，可以在基本的 grub>提示符中输人 GRUB 配置文件中
节），会导致这种问题。如果你特别精通GRUB 命令，或者无法访
GRUB 配置文件的问题。当GRUB配置文件或阶段2文件损毁，或
机器至少载人了阶段1.5，但是它可能还会有载人阶段2或者读取
的文件系统，可能你会在一个错误或者 grub>提示符后面看到一条
示正常的GRUB菜单。当GRUB无法找到包含阶段2或配置文件
会读取文件系统中默认的配置文件，载人它所需要的额外模块，显
1.5（stage 1.5，GRUB2 将它称为core.img），它包含读取Linux文件
GRUB的第一阶段仅能占用MBR中446字节的空间，它包含需要
但是因为某些原因它无法定位到启动系统的其他代码中。记住
者包含这些文件的文件系统损坏时（出现这种问题时，可以参阅4.4
如果看到一条 loading stage 1.5 失败的信息，请查阅讨论如何
另一个导致GRUB失败的原因是，MBR虽然安装了GRUB，
3.3修复GRUB·45
---
## Page 53
3.3.3配置错误的GRUB提示
所以修改了/etc/default/grub后，还需要运行/usr/sbin/update-grub这
grub.cfg，但是这个文件通常由脚本生成且不打算让一般用户修改，
GRUB至少能进人阶段2，甚至可能读取配置文件，所以可以明
GRUB选项），那么你可以更轻松地修复GRUB。如果能进人系统，
?
如何修改和更新配置文件的说明。
版本。如果是这样，它会在文件顶部的注释中说明，还会提供关于
文件也有可能由诸如 update-grub 这样的脚本生成，这取决于系统的
个脚本，以生成最新的 grub.cfg 文件。即便在GRUB 1中，menu.lst
开 /etc/default/grub）。在GRUB2中，实际的配置文件是/boot/grub/
单地打开配置文件（GRUB1打开/boot/grub/menu.lst，GRUB 2打
确MBR中肯定安装了GRUB，下一节会介绍在MBR中重新安装
3.3.4
恢复磁盘启动。
你可以按E键，尝试根据GRUB 提示修改GRUB配置文件或者从
作，看看能否用老配置启动系统；如果没有，但你熟悉GRUB配置
换的老内核或者GRUB菜单中配置了恢复模式，那么尝试这些操
UUID 发生更改，见3.5节）。如果遇到这种情况，并且有一个可替
能会有一些错误，并且与文件相关的硬盘或分区发生了更改（或者
动菜单或者显示错误信息。这通常意味着，GRUB 的配置文件中可
从默认的启动人口启动，会出现GRUB失败的问题，并返回到启
GRUB的步骤。
第3章为什么系统无法启动？解决启动问题
最后，可能你会发现载入了整个GRUB菜单，但是当你尝试
如果你幸运地进人了活动系统（可能是用老内核或者通过修改
一旦进入了系统，如果问题与GRUB 配置文件有关，你可以简
从活动系统中修复GRUB
---
## Page 54
3.3.5通过恢复磁盘修复GRUB
shell 窗口，运行 update-grub 重新构建配置文件，然后输人 exit 离
grub.conf文件。
项做任何自定义修改，你也可以在这个 shell提示中查看/boot/grub/
MBR中重新安装GRUB，那么输人/sbin/grub-install /dev/sda。将
有特性，但是现在我们讨论使用这两种恢复盘来重新安装GRUB 的
装盘中会附带这个恢复磁盘。例如，Red Hat或CentOS 的安装盘在
提示行中输人df查看哪个设备是/mnt/sysimage）。如果需要针对选
/dev/sda替换成你的根分区设备（如果你不确定是哪个设备，在命令
一旦根分区挂载完毕，就会获得一个 shell提示，如果你需要在
rescue启动选项启动，然后输人chroot /mnt/sysimage挂载根分区。
开这个shell窗口，重启系统。
GRUB启动加载器的选项。如果你的问题是没有出现任何GRUB提
基本步骤。
盘中，恢复模式会作为启动选项中的一项展示在用户面前。对于任
启动提示中输人 linux rescue就会进人恢复模式。在Ubuntu 的安装
数版本的这个修复过程都很简单，一般CD-ROM或USB 镜像的安
系统来修复它，所以最快捷的方式就是使用恢复磁盘来修复。大多
3.4
己仅需要重新生成GRUB配置文件，那么可以在根系统中打开一个
示，那需要在系统启动的时候选择这个选项。否则，如果你觉得自
何一种恢复磁盘来说，你都应该阅读官方文档来找出恢复环境的所
如果使用Ubuntu恢复磁盘，磁盘启动后会显示一个重新安装
如果使用RedHat或者CentOS的恢复磁盘，那么使用linux
很多情况下，当你遇到GRUB 相关的问题时，都无法通过进人
在Linux早期，启动过程对普通用户来讲显示得有点多。当启
禁止启动界面
3.4禁止启动界面47
---
## Page 55
48
528c6527-24bf-42d1-b908-c175f7b06a0f这样的字符串。在第一段字
置。你如果查看GRUB 配置文件中包含内核参数的哪一行，可能
3.5.1
的问题，理解内核是如何知道根文件系统从哪里开始非常重要。
系统会包含内核模块以及内核需要用来定位、挂载文件系统和继续
件就会在RAM中展开为一个 initramfs 临时根文件系统。这个文件
件系统。GRUB 将内核与initrd文件加载到 RAM中之后，initrd 文
3.5
统的启动过程中看到调试输出。
这样的参数。你也可以添加 nosplash参数来确保禁止了全部启动界
linux或者kernel开头），然后修改这一行，去除类似quiet和 splash
启动参数。仔细查看包含所有内核启动参数的那一行（可能由单词
按键才能显示这个界面)，然后按E键针对特定的菜单进人点修改
会看到诸如root=/dev/sda2、/root=LABEL=/或者root=UUID=
执行启动过程的程序。为了更好地解决根文件系统无法挂载到内核
面。现在一旦你退出了编辑模式，根据最新的选项重启，就能在系
动选项的 GRUB菜单（可能需要在系统启动过程中按Esc或 Shift
输出功能，这样才能看到全部错误。想要做到这一点，进人显示启
启动过程中报了错，你可能想要禁止启动界面或者打开所有模式的
大量有价值的调试信息。
时刻正在干什么。但在服务器的安装过程中，很多系统默认会隐藏
动一个服务器的时候，屏幕中会出现文字滚屏，
第3章为什么系统无法启动？解决启动问题
除了GRUB错误以外，一个最常见的启动错误是无法挂载根文
如果你已经通过了GRUB 提示界面这一阶段，但是系统还是在
内核根据GRUB在root选项中传入的值得知根文件系统的位
无法挂载根文件系统
根内核参数
，告诉你系统在某个
---
## Page 56
3.5.2
/dev/sdb2 does not exist”，然后进人一个基本的 initramfs shell。在那
root=UUID=528c6527-24bf-42d1-b908-c175f7b06a0f 的 UUID。
UUID。现在不用在启动提示中指定磁盘标签，你可以指定一个像
这块新磁盘可能已经有了它自己的/或者/home标签，当这块硬盘
务器上加了另一块用来安装其他系统的硬盘，就会发生这种情况
标签不会变，系统内容还是会找到根分区。
所以根分区可能用／或者root标识，/home分区可能标识为home或
新磁盘，那么可以进人GRUB菜单，按E键修改启动参数。
些不使用UUID的系统中经常会发生这种情况，因为添加了一块新
标识都唯一。所以你可以放心地增加第二块磁盘而不用担心重复的
这个问题，一些系统的版本开始为分区指定UUID（通用唯一标识
添加到新系统的时候，内核可能无法挂载你想要的标签。为了解决
题—当两个分区标签相同的时候，会发生什么问题？当有人在服
签，如root=LABEL=/。用这种方法，就算更改了实际设备的名称，
者/home。然后，GRUB 不在root=这一行指定设备，而是用设备标
/dev/sda2很有可能现在是/dev/sdb2或者/dev/sda3。
代，因为每当增加一个磁盘或者为磁盘重新分区的时候，之前的
这种指定根设备的方法非常普遍，现在已经由磁盘符或者UUID取
符串中，内核获得了一个显式的磁盘分区/dev/sda2。在老系统中
上，而现在在/dev/sdb2上)。如果你知道最近在机器中添加了一块
磁盘，同时设备的名称发生了更改（例如，老的根分区在/dev/sda2
符）。UUID是一个长字符串，它保证世界上所有的磁盘分区的这个
想要解决设备名称更改的问题，系统开始用挂载点标识分区
标签是用来解决设备名字更改的问题，但是引入了另一个问
内核无法挂载根分区的常见原因之一是更改了给定的根分区。
根设备更改
3.5无法挂载根文件系统·49
---
## Page 57
50
测根分区）并永久更改root=这一行。顺便说一句，如果的确更改
grub.conf或/boot/grub/menu.lst，GRUB2系统使用UUID并自动检
那么你就可以修改GRUB的配置文件（GRUB1中是/boot/grub/
了设备，你可能也需要更改/etc/fstab 中的进入点。
盘有三块分区：/dev/sdal、/dev/sda2和/dev/sda3。/dev/sdb仅有
如 fdisk-1查看系统全部可用的分区。
值，那么可能需要从恢复磁盘启动。用root用户进人，输人命令
root=/dev/sdb2 或者root=/dev/sdc2。如果你不确定磁盘设备的赋
改磁盘字母。例如，如果之前是root=/dev/sda2，那么将其更改为
一个分区：/dev/sdb1。
例，它显示了两块磁盘/dev/sda和/dev/sdb的分区情况。/dev/sda磁
第3章为什么系统无法启动？解决启动问题
如果你发现当更改为另一个设备的时候，系统可以正常启动
如果你注意到root参数被设置为一个磁盘设备，那么尝试更
#fdisk-1
Disk identifier: 0x000c406f
Units = cylinders of 128  512= 65536 bytes
Disk /dev/sdb: 52.4 GB,52429848576 bytes
Disk identifier:0x0009c896
Disk /dev/sda: 11.6 GB,11560550400 bytes
/dev/sdb1
I/0 size (minimum/optimal): 512 bytes / 512 bytes
Sector size (logical/physical):512 bytes /512 bytes
4heads,32 sectors/track,800016 cy1inders
/dev/sda3
I/0size（minimum/optimal):512bytes/512bytes
Sector size (logical/physical): 512 bytes / 512 bytes
/dev/sda2
/dev/sdal
Units=cylindersof128512=65536bytes
4heads,32 sectors/track,176400 cylinders
Device Boot
Device Boot
Start
91905
Start
76280
762924
168198
91904
76279
End
End
48827120
4882816
1000000
4881840
Blocks
Blocks
下面是fdisk-1的一些输出示
Id  System
IdSystem
83
28
8
2Linux swap/ Solaris
Linux
Linux
Linux
---
## Page 58
文件（以及/etc/fstab），这样它就能指向合适的UUID。
定的设备而不是UUID。如果你发现这么做能在启动流程中走很远
UUID。
常发生在有人基于使用UUID的系统上复制了一个系统。当他们
/dev/sda2）能显示当前设备的标签是什么。
改为其他名字。输人e2label后再输人磁盘设备的名称（如e2label
/dev/sda2更改为/，应该这样输人：
配置文件，使用磁盘设备而非标签；要么使用e2label这个程序，将
那么就进入恢复磁盘，输人fdisk-l。如果将root参数中的标签替换
用标签而是指定磁盘设备本身。同样，如果你不清楚磁盘的布局
区标签。处理磁盘标签问题的最佳方法是修改root=这一行，不使
那么可以时候用blkid命令查看指向特定磁盘的UUID的值。
改GRUB菜单中的启动提示并更改root=这一行，为其指定一个特
然而当他们复制GRUB配置文件的时候，文件中指向的还是旧的
为克隆系统创建了一个根分区的时候，它会得到一个新的UUID
值，所以在根分区上经常发生UUID更改的情况。也就是说，这通
根分区更改了。通常，当分区格式化的时候会给它赋值一个UUID
根分区的分区标签更改为正确的标签。比如说，将根分区的标签从
成磁盘设备本身后，系统可以重新启动，那你可以要么更新GRUB
是添加了一块带有相同分区标签的磁盘或者系统管理员更改了根分
如果系统使用UUID而内核找不到根分区，很有可能是因为
正如磁盘标签的问题一样，快速解决这个问题的方法之一是修
在标签重名的问题中，也可以使用e2label工具将重名的根分区
一旦了解了应该是什么UUID，之后就可以修改GRUB 的配置
e21abel/dev/sda2/
对使用分区标签的系统来说，无法挂载根文件系统的原因可能
/dev/sda2: UUID="528c6527-24bf-42d1-b908-c175f7b06a0f"
$sudob1kid-s UUID/dev/sda2
3.5无法挂载根文件系统·51
---
## Page 59