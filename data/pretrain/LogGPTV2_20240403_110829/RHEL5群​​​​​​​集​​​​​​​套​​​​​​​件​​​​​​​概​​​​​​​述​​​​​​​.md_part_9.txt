::: figure
[⁠]{#ch.gfscs.cluster-overview-CSO.html#fig-lvm-gui-conga-CSO}
::: figure-contents
::: mediaobject
![Conga LVM Graphical User
Interface](images/lvm-gui-conga.png){width="444"}
:::
:::
**图 1.16. Conga LVM Graphical User Interface**
:::
::: figure
[⁠]{#ch.gfscs.cluster-overview-CSO.html#fig-creating-lv-CSO}
::: figure-contents
::: mediaobject
![Creating Logical Volumes](images/logicalvolumes.png)
:::
:::
**图 1.17. Creating Logical Volumes**
:::
:::
::: section
::: titlepage
# [⁠]{#ch.gfscs.cluster-overview-CSO.html#s1-gnbd-overview-CSO}1.7. 全​​​​​​​球​​​​​​​网​​​​​​​络​​​​​​​块​​​​​​​设​​​​​​​备​​​​​​​ {.title}
:::
::: para
全​​​​​​​球​​​​​​​网​​​​​​​络​​​​​​​块​​​​​​​设​​​​​​​备​​​​​​​（Global Network Block Device，GNBD）提​​​​​​​供​​​​​​​通​​​​​​​过​​​​​​​ TCP/IP 访​​​​​​​问​​​​​​​
Red Hat GFS 块​​​​​​​设​​​​​​​备​​​​​​​的​​​​​​​功​​​​​​​能​​​​​​​。​​​​​​​GNBD 从​​​​​​​概​​​​​​​念​​​​​​​上​​​​​​​和​​​​​​​ NBD 相​​​​​​​似​​​​​​​；然​​​​​​​而​​​​​​​，GNBD 是​​​​​​​和​​​​​​​ GFS
相​​​​​​​关​​​​​​​的​​​​​​​且​​​​​​​为​​​​​​​ GFS 单​​​​​​​独​​​​​​​进​​​​​​​行​​​​​​​了​​​​​​​调​​​​​​​整​​​​​​​。​​​​​​​当​​​​​​​需​​​​​​​要​​​​​​​更​​​​​​​健​​​​​​​壮​​​​​​​的​​​​​​​技​​​​​​​术​​​​​​​时​​​​​​​，GNBD 是​​​​​​​有​​​​​​​用​​​​​​​处​​​​​​​的​​​​​​​ ---
光​​​​​​​纤​​​​​​​通​​​​​​​道​​​​​​​或​​​​​​​ single-initiator SCSI --- 不​​​​​​​是​​​​​​​必​​​​​​​需​​​​​​​的​​​​​​​或​​​​​​​成​​​​​​​本​​​​​​​过​​​​​​​高​​​​​​​。​​​​​​​
:::
::: para
GNBD consists of two major components: a GNBD client and a GNBD server.
A GNBD client runs in a node with GFS and imports a block device
exported by a GNBD server. A GNBD server runs in another node and
exports block-level storage from its local storage (either directly
attached storage or SAN storage). Refer to [图 1.18 "GNBD
概​​​​​​​述​​​​​​​"](#ch.gfscs.cluster-overview-CSO.html#fig-gnbd-overview-CSO){.xref}.
Multiple GNBD clients can access a device exported by a GNBD server,
thus making a GNBD suitable for use by a group of nodes running GFS.
:::
::: figure
[⁠]{#ch.gfscs.cluster-overview-CSO.html#fig-gnbd-overview-CSO}
::: figure-contents
::: mediaobject
![GNBD 概​​​​​​​述​​​​​​​](images/GNBD-overview.png){width="444"}
:::
:::
**图 1.18. GNBD 概​​​​​​​述​​​​​​​**
:::
:::
::: section
::: titlepage
# [⁠]{#ch.gfscs.cluster-overview-CSO.html#s1-lvs-overview-CSO}1.8. Linux 虚​​​​​​​拟​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​ {.title}
:::
::: para
Linux 虚​​​​​​​拟​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​（LVS）是​​​​​​​一​​​​​​​组​​​​​​​集​​​​​​​成​​​​​​​的​​​​​​​软​​​​​​​件​​​​​​​组​​​​​​​件​​​​​​​，它​​​​​​​用​​​​​​​于​​​​​​​在​​​​​​​真​​​​​​​实​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​之​​​​​​​间​​​​​​​平​​​​​​​衡​​​​​​​
IP 负​​​​​​​载​​​​​​​。​​​​​​​LVS 运​​​​​​​行​​​​​​​在​​​​​​​一​​​​​​​对​​​​​​​配​​​​​​​置​​​​​​​相​​​​​​​同​​​​​​​的​​​​​​​机​​​​​​​器​​​​​​​上​​​​​​​：一​​​​​​​个​​​​​​​作​​​​​​​为​​​​​​​活​​​​​​​动​​​​​​​的​​​​​​​ LVS
路​​​​​​​由​​​​​​​器​​​​​​​而​​​​​​​另​​​​​​​外​​​​​​​一​​​​​​​个​​​​​​​作​​​​​​​为​​​​​​​备​​​​​​​份​​​​​​​ LVS 路​​​​​​​由​​​​​​​器​​​​​​​。​​​​​​​活​​​​​​​动​​​​​​​的​​​​​​​ LVS 路​​​​​​​由​​​​​​​器​​​​​​​扮​​​​​​​演​​​​​​​两​​​​​​​个​​​​​​​角​​​​​​​色​​​​​​​：
:::
::: {.itemizedlist xmlns:d="http://docbook.org/ns/docbook"}
-   ::: para
    在​​​​​​​真​​​​​​​实​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​之​​​​​​​间​​​​​​​平​​​​​​​衡​​​​​​​负​​​​​​​载​​​​​​​。​​​​​​​
    :::
-   ::: para
    检​​​​​​​查​​​​​​​每​​​​​​​个​​​​​​​真​​​​​​​实​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​上​​​​​​​的​​​​​​​服​​​​​​​务​​​​​​​的​​​​​​​完​​​​​​​整​​​​​​​性​​​​​​​。​​​​​​​
    :::
:::
::: para
备​​​​​​​份​​​​​​​ LVS 路​​​​​​​由​​​​​​​器​​​​​​​监​​​​​​​控​​​​​​​活​​​​​​​动​​​​​​​的​​​​​​​ LVS 路​​​​​​​由​​​​​​​器​​​​​​​并​​​​​​​在​​​​​​​它​​​​​​​发​​​​​​​生​​​​​​​故​​​​​​​障​​​​​​​时​​​​​​​进​​​​​​​行​​​​​​​接​​​​​​​管​​​​​​​。​​​​​​​
:::
::: para
[图 1.19 "Components of a Running LVS
Cluster"](#ch.gfscs.cluster-overview-CSO.html#gr-lvs-components-CSO){.xref}
provides an overview of the LVS components and their interrelationship.
:::
::: figure
[⁠]{#ch.gfscs.cluster-overview-CSO.html#gr-lvs-components-CSO}
::: figure-contents
::: mediaobject
![Components of a Running LVS
Cluster](images/lvs-components.png){width="444"}
:::
:::
**图 1.19. Components of a Running LVS Cluster**
:::
::: para
`pulse`{.command} 守​​​​​​​护​​​​​​​进​​​​​​​程​​​​​​​运​​​​​​​行​​​​​​​在​​​​​​​活​​​​​​​动​​​​​​​的​​​​​​​以​​​​​​​及​​​​​​​备​​​​​​​份​​​​​​​ LVS 路​​​​​​​由​​​​​​​器​​​​​​​上​​​​​​​。​​​​​​​在​​​​​​​备​​​​​​​份​​​​​​​ LVS
路​​​​​​​由​​​​​​​器​​​​​​​上​​​​​​​，`pulse`{.command} 发​​​​​​​送​​​​​​​ *heartbeat*
到​​​​​​​活​​​​​​​动​​​​​​​路​​​​​​​由​​​​​​​器​​​​​​​的​​​​​​​公​​​​​​​用​​​​​​​接​​​​​​​口​​​​​​​，确​​​​​​​保​​​​​​​活​​​​​​​动​​​​​​​路​​​​​​​由​​​​​​​器​​​​​​​正​​​​​​​常​​​​​​​工​​​​​​​作​​​​​​​。​​​​​​​在​​​​​​​活​​​​​​​动​​​​​​​的​​​​​​​ LVS
路​​​​​​​由​​​​​​​器​​​​​​​上​​​​​​​，`pulse`{.command} 启​​​​​​​动​​​​​​​ `lvs`{.command} 守​​​​​​​护​​​​​​​进​​​​​​​程​​​​​​​并​​​​​​​响​​​​​​​应​​​​​​​备​​​​​​​份​​​​​​​ LVS
路​​​​​​​由​​​​​​​器​​​​​​​的​​​​​​​ *heartbeat* 查​​​​​​​询​​​​​​​。​​​​​​​
:::
::: para
一​​​​​​​旦​​​​​​​启​​​​​​​动​​​​​​​，`lvs`{.command} 守​​​​​​​护​​​​​​​进​​​​​​​程​​​​​​​将​​​​​​​调​​​​​​​用​​​​​​​ `ipvsadm`{.command}
工​​​​​​​具​​​​​​​来​​​​​​​配​​​​​​​置​​​​​​​和​​​​​​​维​​​​​​​护​​​​​​​内​​​​​​​核​​​​​​​里​​​​​​​的​​​​​​​ IPVS（IP
虚​​​​​​​拟​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​）路​​​​​​​由​​​​​​​表​​​​​​​，并​​​​​​​为​​​​​​​每​​​​​​​台​​​​​​​真​​​​​​​实​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​上​​​​​​​配​​​​​​​置​​​​​​​的​​​​​​​的​​​​​​​每​​​​​​​个​​​​​​​虚​​​​​​​拟​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​启​​​​​​​动​​​​​​​一​​​​​​​个​​​​​​​
`nanny`{.command} 进​​​​​​​程​​​​​​​。​​​​​​​每​​​​​​​个​​​​​​​ `nanny`{.command}
进​​​​​​​程​​​​​​​检​​​​​​​查​​​​​​​一​​​​​​​台​​​​​​​真​​​​​​​实​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​上​​​​​​​的​​​​​​​一​​​​​​​个​​​​​​​配​​​​​​​置​​​​​​​好​​​​​​​的​​​​​​​服​​​​​​​务​​​​​​​的​​​​​​​状​​​​​​​态​​​​​​​，并​​​​​​​告​​​​​​​诉​​​​​​​ `lvs`{.command}
守​​​​​​​护​​​​​​​进​​​​​​​程​​​​​​​这​​​​​​​个​​​​​​​服​​​​​​​务​​​​​​​是​​​​​​​否​​​​​​​发​​​​​​​生​​​​​​​了​​​​​​​故​​​​​​​障​​​​​​​。​​​​​​​如​​​​​​​果​​​​​​​检​​​​​​​测​​​​​​​到​​​​​​​了​​​​​​​故​​​​​​​障​​​​​​​，`lvs`{.command}
守​​​​​​​护​​​​​​​进​​​​​​​程​​​​​​​将​​​​​​​指​​​​​​​引​​​​​​​ `ipvsadm`{.command} 从​​​​​​​ IPVS
路​​​​​​​由​​​​​​​表​​​​​​​中​​​​​​​删​​​​​​​除​​​​​​​那​​​​​​​台​​​​​​​真​​​​​​​实​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​的​​​​​​​条​​​​​​​目​​​​​​​。​​​​​​​
:::
::: para
如​​​​​​​果​​​​​​​备​​​​​​​份​​​​​​​ LVS 路​​​​​​​由​​​​​​​器​​​​​​​没​​​​​​​有​​​​​​​从​​​​​​​活​​​​​​​动​​​​​​​的​​​​​​​ LVS
路​​​​​​​由​​​​​​​器​​​​​​​收​​​​​​​到​​​​​​​响​​​​​​​应​​​​​​​，它​​​​​​​将​​​​​​​初​​​​​​​始​​​​​​​化​​​​​​​故​​​​​​​障​​​​​​​切​​​​​​​换​​​​​​​，调​​​​​​​用​​​​​​​ `send_arp`{.command} 将​​​​​​​所​​​​​​​有​​​​​​​虚​​​​​​​拟​​​​​​​
IP 地​​​​​​​址​​​​​​​重​​​​​​​新​​​​​​​分​​​​​​​配​​​​​​​给​​​​​​​备​​​​​​​份​​​​​​​ LVS 路​​​​​​​由​​​​​​​器​​​​​​​的​​​​​​​ NIC 硬​​​​​​​件​​​​​​​地​​​​​​​址​​​​​​​（*MAC*
地​​​​​​​址​​​​​​​），并​​​​​​​通​​​​​​​过​​​​​​​公​​​​​​​用​​​​​​​以​​​​​​​及​​​​​​​专​​​​​​​用​​​​​​​网​​​​​​​络​​​​​​​接​​​​​​​口​​​​​​​向​​​​​​​活​​​​​​​动​​​​​​​的​​​​​​​ LVS 路​​​​​​​由​​​​​​​器​​​​​​​发​​​​​​​送​​​​​​​命​​​​​​​令​​​​​​​来​​​​​​​关​​​​​​​闭​​​​​​​其​​​​​​​
`lvs`{.command} 守​​​​​​​护​​​​​​​进​​​​​​​程​​​​​​​，然​​​​​​​后​​​​​​​在​​​​​​​备​​​​​​​份​​​​​​​ LVS 路​​​​​​​由​​​​​​​器​​​​​​​上​​​​​​​启​​​​​​​动​​​​​​​ `lvs`{.command}
守​​​​​​​护​​​​​​​进​​​​​​​程​​​​​​​来​​​​​​​接​​​​​​​受​​​​​​​虚​​​​​​​拟​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​的​​​​​​​请​​​​​​​求​​​​​​​。​​​​​​​
:::
::: para
对​​​​​​​于​​​​​​​访​​​​​​​问​​​​​​​宿​​​​​​​主​​​​​​​服​​​​​​​务​​​​​​​（如​​​​​​​网​​​​​​​站​​​​​​​或​​​​​​​数​​​​​​​据​​​​​​​库​​​​​​​应​​​​​​​用​​​​​​​程​​​​​​​序​​​​​​​）的​​​​​​​外​​​​​​​部​​​​​​​用​​​​​​​户​​​​​​​，LVS
就​​​​​​​象​​​​​​​是​​​​​​​一​​​​​​​个​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​。​​​​​​​然​​​​​​​而​​​​​​​，用​​​​​​​户​​​​​​​实​​​​​​​际​​​​​​​上​​​​​​​访​​​​​​​问​​​​​​​了​​​​​​​ LVS
路​​​​​​​由​​​​​​​器​​​​​​​后​​​​​​​面​​​​​​​的​​​​​​​多​​​​​​​个​​​​​​​真​​​​​​​实​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​。​​​​​​​
:::
::: para
因​​​​​​​为​​​​​​​在​​​​​​​ LVS 里​​​​​​​没​​​​​​​有​​​​​​​内​​​​​​​置​​​​​​​组​​​​​​​件​​​​​​​在​​​​​​​真​​​​​​​实​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​间​​​​​​​共​​​​​​​享​​​​​​​数​​​​​​​据​​​​​​​，您​​​​​​​有​​​​​​​两​​​​​​​个​​​​​​​基​​​​​​​本​​​​​​​选​​​​​​​择​​​​​​​：
:::
::: {.itemizedlist xmlns:d="http://docbook.org/ns/docbook"}
-   ::: para
    在​​​​​​​真​​​​​​​实​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​间​​​​​​​对​​​​​​​数​​​​​​​据​​​​​​​进​​​​​​​行​​​​​​​同​​​​​​​步​​​​​​​。​​​​​​​
    :::
-   ::: para
    在​​​​​​​拓​​​​​​​扑​​​​​​​结​​​​​​​构​​​​​​​中​​​​​​​添​​​​​​​加​​​​​​​用​​​​​​​于​​​​​​​共​​​​​​​享​​​​​​​数​​​​​​​据​​​​​​​访​​​​​​​问​​​​​​​的​​​​​​​第​​​​​​​三​​​​​​​层​​​​​​​。​​​​​​​
    :::
:::
::: para
对​​​​​​​于​​​​​​​不​​​​​​​允​​​​​​​许​​​​​​​大​​​​​​​量​​​​​​​用​​​​​​​户​​​​​​​在​​​​​​​真​​​​​​​实​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​上​​​​​​​上​​​​​​​载​​​​​​​或​​​​​​​修​​​​​​​改​​​​​​​数​​​​​​​据​​​​​​​的​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​来​​​​​​​说​​​​​​​，第​​​​​​​一​​​​​​​个​​​​​​​选​​​​​​​择​​​​​​​是​​​​​​​首​​​​​​​选​​​​​​​项​​​​​​​。​​​​​​​而​​​​​​​如​​​​​​​果​​​​​​​真​​​​​​​实​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​允​​​​​​​许​​​​​​​大​​​​​​​量​​​​​​​用​​​​​​​户​​​​​​​修​​​​​​​改​​​​​​​数​​​​​​​据​​​​​​​，如​​​​​​​电​​​​​​​子​​​​​​​商​​​​​​​务​​​​​​​网​​​​​​​站​​​​​​​，添​​​​​​​加​​​​​​​第​​​​​​​三​​​​​​​层​​​​​​​则​​​​​​​更​​​​​​​为​​​​​​​可​​​​​​​取​​​​​​​。​​​​​​​
:::
::: para
有​​​​​​​许​​​​​​​多​​​​​​​方​​​​​​​法​​​​​​​可​​​​​​​以​​​​​​​在​​​​​​​真​​​​​​​实​​​​​​​服​​​​​​​务​​​​​​​器​​​​​​​间​​​​​​​进​​​​​​​行​​​​​​​数​​​​​​​据​​​​​​​同​​​​​​​步​​​​​​​。​​​​​​​例​​​​​​​如​​​​​​​，您​​​​​​​可​​​​​​​以​​​​​​​使​​​​​​​用​​​​​​​ shell