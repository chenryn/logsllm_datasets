title:Analysis of a mixed-use urban wifi network: when metropolitan becomes
neapolitan
author:Mikhail Afanasyev and
Tsuwei Chen and
Geoffrey M. Voelker and
Alex C. Snoeren
Analysis of a Mixed-Use Urban WiFi Network:
When Metropolitan becomes Neapolitan
Mikhail Afanasyev, Tsuwei Chen†, Geoffrey M. Voelker, and Alex C. Snoeren
University of California, San Diego and †Google Inc.
{mafanasyev,voelker,snoeren}@cs.ucsd.edu, PI:EMAIL
ABSTRACT
While WiFi was initially designed as a local-area access network,
mesh networking technologies have led to increasingly expansive
deployments of WiFi networks. In urban environments, the WiFi
mesh frequently supplements a number of existing access technolo-
gies, including wired broadband networks, 3G cellular, and com-
mercial WiFi hotspots. It is an open question what role city-wide
WiFi deployments play in the increasingly diverse access network
spectrum. We study the usage of the Google WiFi network de-
ployed in Mountain View, California, and ﬁnd that usage naturally
falls into three classes, based almost entirely on client device type.
Moreover, each of these classes of use has signiﬁcant geographic
locality, following the distribution of residential, commercial, and
transportation areas of the city. Finally, we ﬁnd a diverse set of
mobility patterns that map well to the archetypal use cases for tra-
ditional access technologies.
Categories and Subject Descriptors
C.2.3 [Computer Communication Networks]: Network Opera-
tions
General Terms
Measurement, Performance
1.
INTRODUCTION
Municipal wireless networks have generated a great deal of ex-
citement and controversy in recent years, as the promise of nearly
ubiquitous Internet access for WiFi-capable devices has led many
city governments and private entities to propose and deploy city-
wide mesh networks. At the same time, the number and type of
WiFi-capable devices have exploded due to the increasing popular-
ity of laptops and WiFi-capable smartphones like the Apple iPhone.
Yet mesh WiFi networks are far from the only networks on which
such devices operate. In urban environments, the WiFi mesh fre-
quently supplements a number of existing access technologies, in-
cluding wired broadband networks, 3G cellular, and WiFi hotspots.
Permission to make digital or hard copies of all or part of this work for
personal or classroom use is granted without fee provided that copies are
not made or distributed for proﬁt or commercial advantage and that copies
bear this notice and the full citation on the ﬁrst page. To copy otherwise, to
republish, to post on servers or to redistribute to lists, requires prior speciﬁc
permission and/or a fee.
IMC’08, October 20–22, 2008, Vouliagmeni, Greece.
Copyright 2008 ACM 978-1-60558-334-1/08/10 ...$5.00.
Given the plethora of alternative access technologies, the long-
term economic feasibility of metropolitan mesh networks appears
uncertain. In particular, it is unclear what role city-wide WiFi de-
ployments play from a user’s perspective, independent of any par-
ticular network agreement or charging policy. A great deal of aca-
demic research has focused on developing and improving wireless
mesh protocols, and studies of deployed wireless networks have re-
cently begun appearing in the literature [1, 5, 7, 8]. These studies
focus almost exclusively on the operation and effectiveness of the
mesh backbone, however; to the best of our knowledge, none have
yet to report upon how clients actually use a metropolitan network.
We study the usage of the Google WiFi network, a freely avail-
able outdoor wireless Internet service deployed in Mountain View,
California, consisting of over 500 Tropos MetroMesh pole-top ac-
cess points. Due to its location in the heart of Silicon Valley and
no-cost access policy, we expect usage in the Google network to
represent an optimistic view of potential client demand in other ur-
ban networks. Using 28 days of overall network statistics in Spring
2008, we analyze the temporal activity of clients, their trafﬁc de-
mands on the network, the mobility of users as they roam through
the city, and the diversity and coverage of users spread geographi-
cally in the network.
We ﬁnd that network usage uniquely blends the characteristics of
three distinctly different user populations into a single metropoli-
tan wireless network; we call such a hybrid network Neapolitan.1
Figure 1 shows one dramatic example of this usage variation: when
plotting bytes transferred as a function of session length, three dis-
tinct clusters emerge: one cluster of short, light sessions at the left
axis, another cluster of extremely long and heavy sessions at the
far right, and a third that spans the full range of session lengths and
sizes. If one classiﬁes these sessions by device type as shown in the
ﬁgure, three distinct user populations emerge: Local residents and
businesses use it as a static WiFi mesh access network, a substitute
for DSL or cable modem service. Laptop users have mobility and
workload patterns reminiscent of campus and other public hotspot
WiFi networks (labeled hotspot in the ﬁgure). Finally, smartphone
users combine the ubiquitous coverage of cellular networks with
the higher performance of wireless LANs.
Each of these classes has signiﬁcant geographic locality in the
Google WiFi network, following the distribution of residential,
commercial, and transportation areas of the city. Additionally, we
observe a diverse set of mobility patterns that map well to the
archetypal use cases for traditional access technologies. Because
the Google network is a production network—as opposed to a re-
search prototype—user privacy is paramount. Hence, our study
focuses exclusively on client aggregates; we make no attempt to
1Neapolitan ice cream consists of strawberry, chocolate, and
vanilla ice cream all packaged side-by-side.
100G
10G
1G
100M
10M
1M
100k
10k
1k
i
n
o
s
s
e
s
r
e
p
d
e
r
r
e
f
s
n
a
r
t
s
e
t
y
B
Hotspot
Modem
Smartphone
 0
 5
 10
 15
 20
 25
Session length, hours
Figure 1: Bytes transferred as a function of session length dur-
ing a typical 24-hour period.
isolate or analyze the trafﬁc or mobility patterns of any particular
clients. Moreover, we limit our trafﬁc analysis to high-level appli-
cation classiﬁcation based upon protocol and port numbers. Finally,
because we do not collect any client-side information, we report ex-
clusively upon the behavior of clients that successfully connect to
the Google network; potential clients that are either unable (due to,
for example, a high rate of motion or poor signal strength at their lo-
cation) or choose not to connect to the network are not represented
in our data.
Due to the lack of comparable measurements for other networks,
we are unable to comment on the generality of our conclusions.
Instead, we hope that our study will encourage researchers and net-
work operators to report upon the usage within other mesh deploy-
ments to inform the ongoing debate about the future of metropoli-
tan WiFi. The remainder of this paper is organized as follows. We
begin by surveying related work in Section 2 before describing the
architecture of the Google WiFi network and our data collection
methodology in Section 3. We analyze the disparate network usage
patterns in Section 4 and then turn our attention to client mobility
in Section 5. Finally, Section 6 considers the ramiﬁcations of ob-
served usage on network coverage and deployment, and Section 7
summarizes our ﬁndings.
2. RELATED WORK
The Google WiFi network represents one of the latest in various
community, commercial, and rural efforts to use commodity 802.11
hardware to construct mesh backbone networks. Since 802.11 was
not originally tailored for use in a mesh, work in mesh network
deployments has encompassed nearly all aspects of network de-
sign, including network architecture [5], MAC protocol develop-
ment [21], routing protocol design [6], and network planning and
provisioning [26].
Measurement studies of urban WiFi mesh networks inform such
work in network design, implementation, and deployment. Aguayo
et al. captured link-level measurements of the Roofnet commu-
nity network in Cambridge, MA, to evaluate the network perfor-
mance and reliability [1]. Camp et al. used the Technology For All
(TFA) urban mesh network in Houston, TX, to characterize how
control and management trafﬁc degrade network performance [8],
to develop models to correlate link characteristics with applica-
tion performance, and to evaluate AP placement topologies to in-
crease throughput [9]. Robinson et al. introduced low-overhead
techniques for assessing mesh network geographic coverage for
planning, evaluating the techniques on both TFA as well as the
Google WiFi network we study in this paper [23]. Finally, Brik et
al. combine both passive and active measurements of the MadMesh
commercial mesh network in downtown Madison, WI, to evalu-
ate mesh planning, deployment, routing, and user experience and
workload [7]. In large part, these studies are orthogonal to our mea-
surements of the Google WiFi network, and they therefore comple-
ment each other. The MadMesh study characterized some aspects
of user activity, and we make comparisons when possible in Sec-
tion 4. Points of comparison, such as the daily variation in the num-
ber of users, are in reasonable agreement, suggesting that at least
some aspects of the Google WiFi network generalize beyond the
uniqueness of being deployed in the heart of Silicon Valley. Other-
wise, lacking comparable user workload and behavior studies, we
hesitate to generalize beyond the one network we evaluated.
The “modem” users in our study are similar to users of com-
munity and commercial backbone mesh networks exempliﬁed by
Roofnet [1]. Community and commercial mesh networks often
serve as multi-hop transit between homes, businesses, and public
locales and the Internet. Mobility is possible, but not necessarily
the primary goal; as such, network use tends to be similar to use
with DSL or cable modem service. Their application workloads
and network utilization are most useful as a point of comparison
with the other two user populations in our study; they only exhibit
mobility to the extent to which their AP associations ﬂap over time.
The “hotspot” user base in our study most closely resembles user
populations of single-hop access wireless LANs, such as univer-
sity campus networks, both in the dominant applications used and
the relatively limited user mobility. Numerous studies of indoor
802.11 networks have covered a variety of environments, includ-
ing university departments [10, 11, 27], corporate enterprises [4],
and conference and professional meetings [3, 14, 15, 18, 20, 24].
These studies have focused on network performance and reliability
as well as user behavior from the perspectives of low-level network
characteristics to high-level application use. With their more ex-
tensive geographic coverage, larger-scale studies of outdoor 802.11
networks on university campuses have provided further insight into
mobility and other user behavior [12, 13, 16, 19, 25, 29].
The dominant presence of iPhone users represents perhaps the
most interesting aspect of the Google WiFi user population. WiFi
smartphones represent an emerging market early in its exponen-
tial adoption phase, yet it is the WiFi user population that is the
least well understood. Tang and Baker’s detailed study of the Met-
ricom metropolitan wireless network [28] is most closely related
to the smartphone population of the Google WiFi network. Metri-
com operated a Ricochet packet radio mesh network covering three
major metropolitan areas. The study covers nearly two months of
activity in the San Francisco Bay Area, and focuses on network
utilization and user mobility within the network. Presumably cel-
lular providers measure cellular data characteristics extensively, but
these results are typically considered conﬁdential.
Finally, we note that rural mesh networks in developing re-
gions typically support targeted services [22], such as audio and
video conferencing to provide remote medical treatment, and con-
sequently have application characteristics speciﬁc to their intended
use.
3. THE NETWORK
The Google WiFi network is a free, outdoor wireless Internet
service deployed in Mountain View, California. The network has
been continuously operational since August 16, 2006, and provides
public access to anyone who signs up for an account. The network
is accessible using either traditional (SSID GoogleWiFi) and secure
Field
Acct-Status-Type
NAS-Identiﬁer
Calling-Station-Id
Acct-Session-Time
Tropos-Layer2-Input-Octets (TLIO)
Tropos-Layer2-Output-Octets (TLOO)
Tropos-Layer2-Input-Frames (TLIF)
Tropos-Layer2-Output-Frames (TLOF)
Acct-Input-Octets (AIO)
Acct-Output-Octets (AOO)
Acct-Input-Packets (AIP)
Acct-Output-Packets (AOP)
Units
Start/Interim-Update/Stop
Tropos ID string
client MAC address
seconds
bytes
bytes
frames
frames
bytes
bytes
packets
packets
Table 1: Partial contents of a RADIUS log record.
3.1.1 Mesh topology
While not the main focus of our study, we collected basic infor-
mation about the mesh topology through an administrative inter-
face exported by the Tropos nodes. The relatively dense deploy-
ment of APs provides signiﬁcant path diversity. On average, only
5% of APs have a unique neighbor (with a signal quality of at least
14 dBm [26]); the median AP can communicate with at least four
neighboring APs, and the most well-connected 10% have more than
eight potential next hops. The mesh topology continuously evolves
during our study (the median node changes parents once every two
days), but remains relatively stable in the short term (the most dy-
namic node changes parents slightly more than once an hour over
the course of the trace). The hierarchical structure ensures most
clients have short paths to the gateway: the majority of clients ac-
tive during our study are within two hops of the gateway, and less
than 10% are more than three hops away.
3.1.2 Access devices
To extend the network coverage indoors, Google recommends
the use of WiFi modems, or bridges, which are typically outﬁtted
with more capable antennas than a standard 802.11 client. WiFi
modems often provide a wired Ethernet connection or serve as an
in-home wireless AP, allowing the connection of multiple physi-
cal machines. While Google does not manufacture or sell WiFi
modems, it has recommended two particular WiFi modems to users
of the Mountain View network. In particular, Google suggests the
PePLink Surf and the Ruckus MetroFlex. Additionally, in certain
portions of the city, Google has deployed Meraki Mini mesh re-
peaters to extend the reach of the Tropos mesh.
3.2 Data collection
We analyze a trace of 28 days of accounting information col-
lected by the central Google WiFi RADIUS server during the
Spring of 2008. Periodic updates are generated by all Tropos nodes
for each associated client every ﬁfteen minutes. Tropos nodes is-
sue additional updates when clients ﬁrst associate or disassociate
(either explicitly—which is rare—or through a 15-minute timeout).
Table 1 shows the portion of the RADIUS log records that we use
for our study. For the purposes of this paper, we focus almost ex-
clusively on layer-three information: we do not consider the link
layer behavior of the network. (Although we do make occasional
use of layer-two accounting information as described below.)
Additionally, to facilitate our study of the types of application
trafﬁc in the network (Section 4.2.2), we obtained ﬁve-days worth
of packet-header traces collected at the central Internet gateway of
the Google WiFi network. The header trace contains only (a pre-
ﬁx of) the ﬁrst packet of each ﬂow for the ﬁrst ﬁfteen minutes of
each hour. Because the trace was collected at the gateway—as op-
Figure 2: The Google WiFi coverage map.
(WPA/802.1x, SSID GoogleWiFiSecure) 802.11 clients. Aside
from the standard prohibitions of SPAM, hacking, and other in-
appropriate activities, Google does not limit the types of trafﬁc that
can be transmitted over the network.2 However, it does rate limit
individual clients to 1 Mb/sec.
3.1 Network structure
The network consists of over 500 Tropos MetroMesh pole-top
access points. Each Tropos node has a distinct identiﬁer and a
well-known geographic location; Figure 2 shows the approximate
location of the Tropos nodes. Each Tropos node serves as an access
point (AP) for client devices, as well as a relay node in a wide-area
backhaul mesh that provides connectivity to the wired gateways.
The topology of the Tropos mesh network is constructed dynami-
cally through a proprietary Tropos routing algorithm. A pure mesh
network of this scale exhibits signiﬁcant trafﬁc congestion at nodes
close to the gateway router, however. To alleviate the congestion,
the Google WiFi network is hierarchically clustered around approx-
imately 70 point-to-point radio uplinks that serve as a ﬁxed long-
haul backbone for the mesh network.
Trafﬁc is eventually routed to one of three distinct wired gate-
ways spread across the city, which then forward the trafﬁc to the
main Google campus where it is routed to a centralized autho-
rization and authentication gateway. Google provides single sign-
on authentication and authorization service, but, at the link layer,
802.11 client devices continue to associate with each Tropos AP
individually. All Tropos nodes support the RADIUS accounting
standard [17] and provide periodic updates to the central server.
2The Google WiFi Terms of Service
are
http://wifi.google.com/terms.html.
available
at
posed to inside the wireless mesh itself—we do not observe layer-
two protocol trafﬁc such as ARP, nor many DHCP requests han-
dled by the Tropos nodes themselves. Moreover, we only observe
layer-three trafﬁc entering or leaving the Google WiFi network; our
traces do not contain trafﬁc whose source and destination both re-
side inside the WiFi network. A comparison of the trace content
to the statistics reported by the RADIUS logs (which do include
trafﬁc internal to the network) indicates the volume of such trafﬁc
is negligible, however.
3.2.1 Data correction
During the course of our analysis, we discovered several bugs
in the Tropos accounting mechanism. In particular, a number of
ﬁelds are susceptible to roll-over, but such events are readily de-
tectable. More signiﬁcantly, the Acct-Output-Octets (AOO) ﬁeld is
occasionally corrupt, leading to spurious trafﬁc reports for roughly
30% of all client sessions. Tropos conﬁrmed the bug, and informed
us that the latest version of the Tropos software ﬁxes it. Unfor-
tunately, our traces were collected before the software update was
applied.
Luckily, the layer-two trafﬁc information reported by the Tro-
pos nodes appears accurate, so we are able to both detect and cor-
rect for corrupt layer-three trafﬁc information. We detect invalid
log records by comparing the number of layer-two output octets
(TLOO) to the layer-three count (AOO); there should always be
more layer-two octets than layer-three due to link-layer headers
and retransmissions. If we discover instances where the layer-three
value is larger than layer two, we deem the layer-three information
corrupt and estimate it using layer-two information:
AOO
T LOO · (AOP/T LOF )
− (32 · AOP )
if AOO ≥ T LOO,
otherwise.
8>:
(cid:2)AOO =
In other words, we scale the layer-two octet ﬁeld based upon the
ratio of layer-two frames to layer-three packets to account for link-
layer loss, and subtract 32 bytes per packet for link-layer headers.
3.2.2 Client identiﬁcation
To preserve user privacy, we make no attempt to correlate indi-
vidual users with their identity through the Google authentication
service. Instead, we focus entirely on the client access device and
use MAC addresses to identify users. Obviously, this approxima-
tion is not without its pitfalls—we will incorrectly classify shared
devices as being one user, and are unable to correlate an individual
user’s activity across devices. While we speculate that a number of
users may access the Google WiFi network with multiple distinct
devices (a laptop and smartphone, for example), we consider this a
small concession in the name of privacy.
We have aggregated clients into groups based upon the class of
device they use to access the network. We classify devices based
upon their manufacturer, which we determine based upon their
MAC addresses. In particular, we use the ﬁrst three octets, com-
monly known as the Organizationally Unique Identiﬁer (OUI). Be-
cause many companies manufacture devices using several OUIs,
we have manually grouped OUIs from similar organizations (e.g.,
“Intel” and “Intel Corp.”) into larger aggregates. Table 2 shows
some of the most popular OUI aggregates in our trace.
Apple bears particular note. While we have attempted to deter-
mine which OUIs are used for iPhones as opposed to other Apple
devices (PowerBooks, MacBooks, iPod Touch, etc.), we have ob-
served several OUIs that are in use by both laptops and iPhones.
Hence, accurately de-aliasing these OUI blocks would require te-
dious manual veriﬁcation. For the purposes of this paper we have
Modem
(3%)
Manufacturers
Class
Smartphone Apple
Nokia
(45%)
Research in Motion (RIM)
Ruckus
PePLink
Ambit
Intel
Hon Hai
Gemtek
Askey Computer Corp.
Asus
Hotspot
(52%)
Count
15,450
138
107
525
297
224
9,825
1,931
1,735
667
385
Table 2: A selection of manufacturers in the trace and distinct
client devices seen, grouped by device class. The fraction of
total devices in each class is in parentheses.
lumped all Apple devices together, and consider them all to be
iPhones. Somewhat surprisingly, this appears to be a reasonable
approximation.
In particular, we estimate that 88% of all Apple
devices in our trace are iPhones.3
To estimate the population of iPhone devices, we observed that
Apple products periodically check for software updates by polling
a central server, wu.apple.com.