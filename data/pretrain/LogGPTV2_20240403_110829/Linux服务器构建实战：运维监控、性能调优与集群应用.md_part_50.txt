qdisk分区，那么就认为此节点失败，会从集群中被隔离。
5.配置qdisk
变的。
议用卷标名，因为设备名有可能会在系统重启后发生变化，但卷标名称是不会发生改
www.Linuxidc.com
myduster
dustars
111
11
mycluster
GeneralFencelMulticest
图12-29配置qdisk
oply
ping ~e3=c2192.169.12.1
Path to Progran
leuristics
(Device （deprcated）
CLabel
Minimum Score
/otes
nterval
PDG
---
## Page 343
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
使用GFS文件系统必须要有Fence设备。
可以防止节点间“脑裂”的发生。
群资源（例如文件系统）同时被多个节点占有，保护了共享数据的安全性和一致性，同时也
12.5.7
口HP服务器提供的iLO卡。
口IBM服务器提供的RSAII卡。
RHCS提供的Fence设备有两种。
GFS基于集群底层架构来传递锁信息，或者说是基于RHCS的一种集群文件系统，因此
配置Fence设备是RHCS集群系统中必不可少的一个环节，通过Fence设备可以防止集
至此，qdisk已经运行起来了。
Service Name
Service
Cluster Status
[rootaweb1-]#clustat-1
qdiskd启动后，如果配置正确，qdisk磁盘将自动进入Online状态。信息如下：
[rootoweb1-]#/etc/init.d/qdiskdstart
在集群每个节点上执行如下命令，启动qdiskd服务：
6.启动qdiskd服务
Flags
Current State
Last Transition
Last
Owner
Flags
Current State
/dev/adb7
web1
Member Name
Last
Last
配置Fence设备
Transition
Owner
----
s for mycluster @ Sat Aug 21 01:25:40 2010
Information
1
ID
Fri Aug 20 20:31:03 2010
Online,
Online,
none
atarted (112)
service:webserver
Fri Aug 20 21:36:00 2010
none
Mysq11
none（o)
started (112)
service:mysqlserver
Online,
Status
（0)
Quorum Disk
rgmanager
rgmanager
，一种是内部fence设备，常见的如下：
---
## Page 344
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
示，最后单击“Update main fence properties”按钮，Fence设备在节点web1上绑定完成。
已经存在的Fence设备，这里选择刚才创建好的Fence设备，即WTI-Fence，如图12-33所
“ClusterList”中单击“mycluster”中的web1节点，如图12-32所示。
次输入IPAddress和Password，如图12-31所示。
择对应的Fence类型。
框中依次选择“Shared FenceDevices”→“Add aFence Device”，如图12-30所示。
在“Main Fencing Method”区城中，单击“Add a fence device to this level”，选择一个
最后，将添加的Fence设备绑定到集群的每个节点上。选择“Cluster”，然后在
按照这个操作方法，依次将Fence设备绑定到节点web2、Mysqll、Mysql2中。
这里选择的Fence设备为“WTIPower Switch”，Fence的名称为“WTI-Fence”。然后依
图12-30列出了RHCS支持的所有类型的FenceDevice，可以根据自己的Fence设备选
单击“Cluster”，然后单击“ClusterList”中的“mycluster”，在左下角的mycluster选择
另外，如果共享存储是通过GNBD Server实现的，那么还可以使用GNBD的Fence功能。
ONETWORKSWITCH
SANSWITCH
UPS。
另一种是外部Fence设备，常见的如下：
口智能平台管理接口IPMI。
口DELL服务器提供的DRAC卡。
www.Linuxidc.com
图12-30RHCS提供的FenceDevice列表
Confgureise
Shared ence
Failover Domains
Resources
Services
Nodes
duster
Configure
Cluster List
Seleetshared fenee davice
AddaSharableFenceDevice
mycluster
Virtual Machins Fencing
mll
cDats
Fencing Type
Sriteh
---
## Page 345
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
330
www.Linuxidc .com
ervices
Configure
Add a Hode
repoi
Mysql2
Mysqll
veb2
dusters
Fence Device
Davice
AddaFence
Shared Fence
Failover Domains
Resources
Services
Nodes
Configure
Cluster
Cluster List
update main fence properties
adafenedeietotisleel
Main Fencing Method
FailoverDomain Membership
websere
Services on this Node
Update node doemon properties
Cluster daemonsrunning on thisnode
Showreenlgivitfrthis
mycluster
图12-32绑定Fence设备到每个节点
rgmaneger
图12-31添加一个Fence设备
yes
Add this shared fence
Fencing Type
AddaSharableFenceDevice
mycluster
Password Script(option
PuoMsse
IPAddress
Namo
Fence Type
WTI Power Switch
device
101
Update backupfenceproperies
Choose aTatk
92.168
UTI-Fence
afenc devicp to.this.lee
12
251
Go
河
PDG
---
## Page 346
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
文件内容如下：
到这里为止，
mycluster
Lesources
ervices
Configure
Add a Node
Nodes
Configure
Mysqi2
Mysql1
veb2
Cluster List
www.Linuxidc.com
，一个完整的RHCS集群系统已经全部配置完成了。配置完成的cluster.conf
Update main fence properbies
Cluster daemons running on this node
Show recent log activity for this node
Status: Cluster member
mycluster
图12-33添加WTI-Fence到节点web1上
Adda fence
ull PA
ETI-Fnc
nera SAN Centroller
Use an existing Fence Device
device to
his
start
Updatebackup fence properties
Choose a Task...
Go
331
PDG
---
## Page 347
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
332
rm>
第6箱
www Linuxidc .com
name="mysqlserver" recovery="relocate">
name="webserver"
fsid="7108"
ordered="1"
= o>
recovery=
restricted="1">
name="1">
nodeid="4"votes="1">
"relocate">
force_fsck="1"
mountpoint="/webdata"
exclusive="0"
exclusive="0"
---
## Page 348
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
ccsd、qdisk、daemons、fenceing等服务，并且将相关集群模块载人系统内核。
在集群所有节点成功启动cman服务后，继续依次在每个节点启动rgmanager服务。
行如下命令即可：
12.6.1
使用非常简单，这里不再详述，这里重点讲述在命令行下如何管理RHCS集群。
在集群管理方面，RHCS提供了两种方式：即Luci图形界面方式和命令行方式。图形方式的
熟悉RHCS的基本运行原理，所以前面花费了大量章节讲述RHCS集群的构成和运行原理。
12.6
从这个输出可知，cman其实是一个集群服务的集合，在启动cman时，同时也启动了
Starting Cluster Service Manager:[OK ]
[root@web1 -]# service rgmanager start
等cman在其他节点成功启动后，开始启动rgmanager服务。
Starting cluster:
[rootswebl -]# service cman start
例如，在主机web1上启动集群服务，操作如下：
需要注意的是，执行这两个命令是有先后顺序的，要先启动cman，然后再启动rgmanager。
service rgmanager start
service cman start
RHCS集群的核心进程有cman和rgmanager。要启动集群，依次在集群的每个节点上执
管理和维护RHCS集群是一个非常复杂和繁琐的工作，要维护好一个RHCS集群，必须
OK]
Starting
Starting
Starting ccsd...done
Mounting configfs...done
Loading modules...
管理和维护RHCS集群
启动RHCS集群
www.Linuxidc.com
qdiskd..
<fencedevice agent="fence_wti" ipaddr="192.168.12.251"name="wTI-Fence