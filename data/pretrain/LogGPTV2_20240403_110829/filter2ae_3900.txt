### 问题背景及测试环境

这是一个较早发现的问题，官方已经知晓，并且在较长的周期内应该已经进行了修复。本文讨论的是一款号称开源的堡垒机，用户只需下载ISO文件并直接安装即可使用。该堡垒机自带系统和默认配置。我主要针对默认配置下的堡垒机进行测试。尽管问题被描述为“绕过访问限制”，但实际上利用了其IPV6相关配置缺陷。随着国家对IPV6的推广，这类安全问题可能会越来越受到关注。

### 测试步骤与结果

我们首先使用官方提供的ISO镜像安装两台测试机，以检查数据库密码是否随机生成。此方法不仅快速（几分钟即可完成），而且无需分析安装脚本，同时可以验证是否存在默认密码。

#### 测试环境
- **测试机1**
- **测试机2**

#### 初始观察
通过观察发现，`freesvr`用户的密码没有变化，均为`freesvr/freesvr`，并且访问限制设置为`%`，意味着无任何限制。但`root`账户仅允许本地访问。

### 访问数据库的可能性

接下来，我们探讨在默认安装情况下能否直接访问数据库。

#### 简单测试
1. **telnet 3306端口**：尝试连接MySQL服务。
2. **工具连接**：使用数据库管理工具（如Navicat）尝试连接。
3. **端口号检查**：确认端口号是否更改。使用`netstat`命令查看：
   ```
   netstat -tuln | grep 3306
   ```
   结果显示，3306端口确实处于监听状态，且支持IPv4和IPv6。

#### iptables规则检查
通过查看iptables规则，我们发现以下配置：
```
Chain RH-Firewall-1-INPUT (2 references)
target     prot opt source               destination         
ACCEPT     all  --  anywhere             anywhere            
...
REJECT     all  --  anywhere             anywhere            reject-with icmp-host-prohibited
```

注意到3306端口只有一条监听记录，并且是`tcp6`协议，这意味着IPv4和IPv6都能使用3306端口。然而，iptables仅对IPv4流量进行控制，若要限制IPv6流量，则需安装并配置ip6tables。

#### 绕过限制
由于iptables仅限制IPv4流量，而未对IPv6流量进行限制，因此可以通过IPv6地址绕过这些限制。不过，许多工具不支持IPv6，如Navicat等。此时，可采用命令行方式连接MySQL数据库：
```bash
mysql -h [ipv6地址] -ufreesvr -pfreesvr
```

#### 进一步操作
- **读取管理员密码**：存在解密脚本可用于获取管理员密码。
- **读取文件**：虽然可以读取文件，但由于权限不足，无法写入shell脚本。

### 总结
本文揭示了一个堡垒机在默认配置下存在的安全漏洞，即通过IPv6绕过防火墙限制。建议用户在实际部署时加强IPv6相关的安全措施。此外，如何从一个IPv4地址获取对应的IPv6地址，仍有待进一步研究。