The format of the output. Possible values are:
text
Standard text format; this is the default value.
json
Standard JSON format; any application that understands JSON can take this output and process it
directly.
.
Sample output
The following three examples show the output from the program.
The first example uses the default formatting option where the program takes the MQI definition of a field
and formats the output to make the output more readable.
**** Message (320 Bytes) on Queue SYSTEM.ADMIN.QMGR.EVENT ****
Event Type : Queue Mgr Event
Reason : Unknown Alias Base Queue
Event created : 2015/06/17 13:47:07.02 GMT
Queue Mgr Name : V8003_A
Queue Name : EVT.NO.BASE.QUEUE
Base Object Name : EVT.NOT.DEFINED
Appl Type : Unix
Appl Name : amqsput
Base Type : Queue
The second example shows the alternative formatting, using the -d option, that does not try to translate
MQI constants. This might be preferable for some scripting tools that look for specific MQI values.
**** Message (320 Bytes) on Queue SYSTEM.ADMIN.QMGR.EVENT ****
Event Type : MQCMD_Q_MGR_EVENT
Reason : MQRC_UNKNOWN_ALIAS_BASE_Q
Event created : 2015/06/17 13:52:48.18 GMT
MQCA_Q_MGR_NAME : V8003_A
MQCA_Q_NAME : EVT.NO.BASE.QUEUE
MQCA_BASE_OBJECT_NAME : EVT.NOT.DEFINED
MQIA_APPL_TYPE : MQAT_UNIX
MQCACF_APPL_NAME : amqsput
MQIA_BASE_TYPE : MQOT_Q
The third example shows the JSON output from the command
amqsevt -m QM1 -q SYSTEM.ADMIN.TRACE.ACTIVITY.QUEUE -o json
IBM MQ Monitoring and performance 57
{
"eventSource" : { "objectName": "SYSTEM.ADMIN.TRACE.ACTIVITY.QUEUE",
"objectType" : "Queue" },
"eventType" : {
"name" : "Activity Trace",
"value" : 209
},
"eventReason" : {
"name" : "None",
"value" : 0
},
"eventCreation" : {
"timeStamp" : "2018-07-10T12:44:26Z",
"epoch" : 1531226666
},
"eventData" : {
"queueMgrName" : "QM1",
"hostName" : "",
"startDate" : "2018-07-10",
"startTime" : "13:44:25",
"endDate" : "2018-07-10",
"endTime" : "13:44:26",
"commandLevel" : 910,
...
Example usage
The following example shows you how to use more than one queue:
amqsevt -m QM1 -q SYSTEM.ADMIN.QMGR.EVENT -q SYSTEM.ADMIN.PERM.EVENT -w 1
Related concepts
“Event monitoring” on page 8
Event monitoring is the process of detecting occurrences of instrumentation events in a queue manager
network. An instrumentation event is a logical combination of events that is detected by a queue manager
or channel instance. Such an event causes the queue manager or channel instance to put a special
message, called an event message, on an event queue.
“Instrumentation events” on page 9
An instrumentation event is a logical combination of conditions that a queue manager or channel instance
detects and puts a special message, called an event message, on an event queue.
Related reference
C programming
“Sample C program to monitor the logger event queue” on page 49
Use this page to view a sample C program that monitors the logger event queue for new event messages,
reads those messages, and puts the contents of the message to stdout.
Message monitoring
Message monitoring is the process of identifying the route a message has taken through a queue manager
network. By identifying the types of activities, and the sequence of activities performed on behalf of a
message, the message route can be determined.
As a message passes through a queue manager network, various processes perform activities on behalf of
the message. Use one of the following techniques to determine a message route:
• The IBM MQ display route application (dspmqrte)
• Activity recording
• Trace-route messaging
These techniques all generate special messages that contain information about the activities performed
on the message as it passed through a queue manager network. Use the information returned in these
special messages to achieve the following objectives:
• Record message activity.
58 Monitoring and Performance for IBM MQ
• Determine the last known location of a message.
• Detect routing problems in your queue manager network.
• Assist in determining the causes of routing problems in your queue manager network.
• Confirm that your queue manager network is running correctly.
• Familiarize yourself with the running of your queue manager network.
• Trace published messages.
Related concepts
Types of message
Activities and operations
Activities are discrete actions that an application performs on behalf of a message. Activities consist of
operations, which are single pieces of work that an application performs.
The following actions are examples of activities:
• A message channel agent (MCA) sends a message from a transmission queue down a channel
• An MCA receives a message from a channel and puts it on its target queue
• An application getting a message from a queue, and putting a reply message in response.
• The IBM MQ publish/subscribe engine processes a message.
Activities consist of one or more operations. Operations are single pieces of work that an application
performs. For example, the activity of an MCA sending a message from a transmission queue down a
channel consists of the following operations:
1.Getting a message from a transmission queue (a Get operation).
2.Sending the message down a channel (a Send operation).
In a publish/subscribe network, the activity of the IBM MQ publish/subscribe engine processing a
message can consist of the following multiple operations:
1.Putting a message to a topic string (a Put operation).
2.Zero or more operations for each of the subscribers that are considered for receipt of the message (a
Publish operation, a Discarded Publish operation or an Excluded Publish operation).
Information from activities
You can identify the sequence of activities performed on a message by recording information as the
message is routed through a queue manager network. You can determine the route of a message through
the queue manager network from the sequence of activities performed on the message, and can obtain
the following information:
The last known location of a message
If a message does not reach its intended destination, you can determine the last known location of
the message from a complete or partial message route.
Configuration issues with a queue manager network
When studying the route of a message through a queue manager network, you might see that the
message has not gone where expected. There are many reasons why this can occur, for example, if a
channel is inactive, the message might take an alternative route.
For a publish/subscribe application, you can also determine the route of a message being published
to a topic and any messages that flow in a queue manager network as a result of being published to
subscribers.
In such situations, a system administrator can determine whether there are any problems in the
queue manager network, and if appropriate, correct them.
IBM MQ Monitoring and performance 59
Message routes
Depending on your reason for determining a message route, you can use the following general
approaches:
Using activity information recorded for a trace-route message
Trace-route messages record activity information for a specific purpose. You can use them to
determine configuration issues with a queue manager network, or to determine the last known
location of a message. If a trace-route message is generated to determine the last known location
of a message that did not reach its intended destination, it can mimic the original message. This gives
the trace-route message the greatest chance of following the route taken by the original message.
The IBM MQ display route application can generate trace-route messages.
Using activity information recorded for the original message
You can enable any message for activity recording and have activity information recorded on its
behalf. If a message does not reach its intended destination, you can use the recorded activity
information to determine the last known location of the message. By using activity information from
the original message, the most accurate possible message route can be determined, leading to the
last known location. To use this approach, the original message must be enabled for activity recording.
Warning: Avoid enabling all messages in a queue manager network for activity recording. Messages
enabled for activity recording can have many activity reports generated on their behalf. If every
message in a queue manager network is enabled for activity recording, the queue manager network
traffic can increase to an unacceptable level.
Related concepts
“Message monitoring” on page 58
Message monitoring is the process of identifying the route a message has taken through a queue manager
network. By identifying the types of activities, and the sequence of activities performed on behalf of a
message, the message route can be determined.
“Message route techniques” on page 60
Activity recording and trace-route messaging are techniques that allow you to record activity information
for a message as it is routed through a queue manager network.
“Trace-route messaging” on page 67
Trace-route messaging is a technique that uses trace-route messages to record activity information for a
message. Trace-route messaging involves sending a trace-route message into a queue manager network.
Related tasks
Writing your own message channel agents
Message route techniques
Activity recording and trace-route messaging are techniques that allow you to record activity information
for a message as it is routed through a queue manager network.
Activity recording
If a message has the appropriate report option specified, it requests that applications generate
activity reports as it is routed through a queue manager network. When an application performs an
activity on behalf of a message, an activity report can be generated, and delivered to an appropriate
location. An activity report contains information about the activity that was performed on the
message.
The activity information collected using activity reports must be arranged in order before a message
route can be determined.
Trace-route messaging
Trace-route messaging is a technique that involves sending a trace-route message into a queue
manager network. When an application performs an activity on behalf of the trace-route message,
activity information can be accumulated in the message data of the trace-route message, or activity
reports can be generated. If activity information is accumulated in the message data of the trace-
60 Monitoring and Performance for IBM MQ
route message, when it reaches its target queue a trace-route reply message containing all the
information from the trace-route message can be generated and delivered to an appropriate location.
Because a trace-route message is dedicated to recording the sequence of activities performed on its
behalf, there are more processing options available compared with normal messages that request
activity reports.
Comparison of activity recording and trace-route messaging
Both activity recording and trace-route messaging can provide activity information to determine the route
a message has taken through a queue manager network. Both methods have their own advantages.
Benefit Activity Trace-route
recording messaging
Can determine the last known location of a message Yes Yes
Can determine configuration issues with a queue manager network Yes Yes
Yes No
Can be requested by any message
(is not restricted to use with trace-route messages)
Message data is left unmodified Yes No
Message processed normally Yes No
Activity information can be accumulated in the message data No Yes
Optional message delivery to target queue No Yes
If a message is caught in an infinite loop, it can be detected and No Yes
dealt with
Activity information can be put in order reliably No Yes
Application provided to display the activity information No Yes
Message route completeness
In some cases it is not possible to identify the full sequence of activities performed on behalf of a
message, so only a partial message route can be determined. The completeness of a message route
is directly influenced by the queue manager network that the messages are routed through. The
completeness of a message route depends on the level of the queue managers in the queue manager
network, as follows:
Queue managers at IBM WebSphere® MQ 6.0 and subsequent releases
MCAs and user-written applications connected to queue managers at IBM WebSphere MQ 6.0
or subsequent releases can record information related to the activities performed on behalf of
a message. The recording of activity information is controlled by the queue manager attributes
ACTIVREC and ROUTEREC. If a queue manager network consists of queue managers at IBM
WebSphere MQ 6.0 or subsequent releases only, complete message routes can be determined.
Queue managers before IBM WebSphere MQ 6.0
Applications connected to queue managers before IBM WebSphere MQ 6.0 do not record the
activities that they have performed on behalf of a message. If a queue manager network contains
any queue manager prior to IBM WebSphere MQ 6.0, only a partial message route can be determined.
How activity information is stored
IBM MQ stores activity information in activity reports, trace-route messages, or trace-route reply
messages. In each case the information is stored in a structure called the Activity PCF group. A trace-
route message or trace-route reply message can contain many Activity PCF groups, depending on the
IBM MQ Monitoring and performance 61
number of activities performed on the message. Activity reports contain one Activity PCF group because a
separate activity report is generated for every recorded activity.
With trace-route messaging, additional information can be recorded. This additional information is stored
in a structure called the TraceRoute PCF group. The TraceRoute PCF group contains a number of PCF
structures that are used to store additional activity information, and to specify options that determine
how the trace-route message is handled as it is routed through a queue manager network.
Related concepts
“Activity recording” on page 62
Activity recording is a technique for determining the routes that messages take through a queue manager
network. To determine the route that a message has taken, the activities performed on behalf of the
message are recorded.
“Trace-route messaging” on page 67
Trace-route messaging is a technique that uses trace-route messages to record activity information for a
message. Trace-route messaging involves sending a trace-route message into a queue manager network.
Related reference
“The TraceRoute PCF group” on page 72
Attributes in the TraceRoute PCF group control the behavior of a trace-route message. The TraceRoute PCF
group is in the message data of every trace-route message.
“Activity report message data” on page 107
Use this page to view the parameters contained by the Activity PCF group in an activity report message.
Some parameters are returned only when specific operations have been performed.
Activity recording
Activity recording is a technique for determining the routes that messages take through a queue manager
network. To determine the route that a message has taken, the activities performed on behalf of the
message are recorded.
When using activity recording, each activity performed on behalf of a message can be recorded in an
activity report. An activity report is a type of report message. Each activity report contains information
about the application that performed the activity on behalf of the message, when the activity took place,
and information about the operations that were performed as part of the activity. Activity reports are
typically delivered to a reply-to queue where they are collected together. By studying the activity reports
related to a message, you can determine the route that the message took through the queue manager
network.
Activity report usage
When messages are routed through a queue manager network, activity reports can be generated. You can
use activity report information in the following ways:
Determine the last known location of a message
If a message that is enabled for activity recording does not reach its intended destination, activity
reports generated for the message as it was routed through a queue manager network can be studied
to determine the last known location of the message.
Determine configuration issues with a queue manager network
A number of messages enabled for activity recording can be sent into a queue manager network. By
studying the activity reports related to each message it can become apparent that they have not taken
the expected route. There are many reasons why this can occur, for example, a channel could have
stopped, forcing the message to take an alternative route. In these situations, a system administrator
can determine whether there are any problems in the queue manager network, and if there are,
correct them.
Note: You can use activity recording in conjunction with trace-route messages by using the IBM MQ
display route application.
62 Monitoring and Performance for IBM MQ
Activity report format
Activity reports are PCF messages generated by applications that have performed an activity on behalf of
a message. Activity reports are standard IBM MQ report messages containing a message descriptor and
message data, as follows:
The message descriptor
• An MQMD structure
Message data
• An embedded PCF header (MQEPH)
• Activity report message data
Activity report message data consists of the Activity PCF group, and if generated for a trace-route
message, the TraceRoute PCF group.
Related reference
MQMD - Message descriptor
MQEPH - Embedded PCF header
Controlling activity recording
Enable activity recording at the queue manager level. To enable an entire queue manager network,
individually enable every queue manager in the network for activity recording. If you enable more queue
managers, more activity reports are generated.
About this task
To generate activity reports for a message as it is routed through a queue manager: define the message
to request activity reports; enable the queue manager for activity recording; and ensure that applications
performing activities on the message are capable of generating activity reports.
If you do not want activity reports to be generated for a message as it is routed through a queue manager,
disable the queue manager for activity recording.
Procedure
1.Request activity reports for a message
a)In the message descriptor of the message, specify MQRO_ACTIVITY in the Report field.
b)In the message descriptor of the message, specify the name of a reply-to queue in the ReplyToQ
field.
Warning: Avoid enabling all messages in a queue manager network for activity recording. Messages
enabled for activity recording can have many activity reports generated on their behalf. If every
message in a queue manager network is enabled for activity recording, the queue manager network
traffic can increase to an unacceptable level.
2.Enable or disable the queue manager for activity recording.
Use the MQSC command ALTER QMGR, specifying the parameter ACTIVREC, to change the value of
the queue manager attribute. The value can be:
MSG
The queue manager is enabled for activity recording. Any activity reports generated are delivered
to the reply-to queue specified in the message descriptor of the message. This is the default value.
QUEUE
The queue manager is enabled for activity recording. Any activity reports generated are delivered
to the local system queue SYSTEM.ADMIN.ACTIVITY.QUEUE. The system queue can also be used
to forward activity reports to a common queue.
IBM MQ Monitoring and performance 63
DISABLED
The queue manager is disabled for activity recording. No activity reports are generated while in the
scope of this queue manager.
For example, to enable a queue manager for activity recording and specify that any activity
reports generated are delivered to the local system queue SYSTEM.ADMIN.ACTIVITY.QUEUE, use the
following MQSC command:
ALTER QMGR ACTIVREC(QUEUE)
Remember: When you modify the ACTIVREC queue manager attribute, a running MCA does not detect
the change until the channel is restarted.
3.Ensure that your application uses the same algorithm as MCAs use to determine whether to generate
an activity report for a message:
a)Verify that the message has requested activity reports to be generated
b)Verify that the queue manager where the message currently resides is enabled for activity recording
c)Put the activity report on the queue determined by the ACTIVREC queue manager attribute
Setting up a common queue for activity reports
To determine the locations of the activity reports related to a specific message when the reports are
delivered to the local system queue, it is more efficient to use a common queue on a single node
Before you begin
Set the ACTIVREC parameter to enable the queue manager for activity recording and to specify that any
activity reports generated are delivered to the local system queue SYSTEM.ADMIN.ACTIVITY.QUEUE.
About this task
If a number of queue managers in a queue manager network are set to deliver activity reports to the local
system queue, it can be time consuming to determine the locations of the activity reports related to a
specific message. Alternatively, use a single node, which is a queue manager that hosts a common queue.
All the queue managers in a queue manager network can deliver activity reports to this common queue.
The benefit of using a common queue is that queue managers do not have to deliver activity reports to the
reply-to queue specified in a message and, when determining the locations of the activity reports related
to a message, you query one queue only.
To set up a common queue, perform the following steps:
Procedure
1.Select or define a queue manager as the single node
2.On the single node, select or define a queue for use as the common queue
3.On all queue managers where activity reports are to be delivered to the common queue, redefine the
local system queue SYSTEM.ADMIN.ACTIVITY.QUEUE as a remote queue definition:
a)Specify the name of the single node as the remote queue manager name
b)Specify the name of the common queue as the remote queue name
Determining message route information
To determine a message route, obtain the information from the activity reports collected. Determine