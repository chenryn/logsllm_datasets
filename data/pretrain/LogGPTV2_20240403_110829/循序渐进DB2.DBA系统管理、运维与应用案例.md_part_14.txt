对于需要使用XML数据的应用程序，有一个特殊的注意事项。当前，DB2只在定义
例如中文代码页为1386，codeset为GBK，TERRITORY为CN。创建数据库时要注意
在默认情况下，数据库的整理次序根据CREATEDATABASE命令中使用的代码集进
3个表空间（SYSCATSPACE、TEMPSPACE1、USERSPACE1)都是在默认目录中自动创
一旦创建了Unicode数据库，您就不需要发出任何专门的命令或采取任何进一步措施
假如要创建一个同时支持XML和SQL的数据库，请执行如下命令：
表空间定义
所有DB2字符数据类型（CHAR、VARCHAR、CLOB、DBCLOB）都有一个相关联的字
代码页和整理次序
如果数据库启用了自动存储，那么在定义表空间时还有另一个选择。可以指定
，务必要慎重选择。如
更多资源请访问www.ckook.com
---
## Page 88
面）。大小还可以指定为一个整数，后面跟着K（表示千字节）、M（表示兆字节）或G（表示千
将存储在这些容器中。指定容器的类型（FILE或DEVICE）和大小（按照PAGESIZE大小的页
程序就会创建这个目录。容器字符串的格式取决于操作系统。
果目录名不是绝对的，它就相对于数据库目录。如果目录的任何部分不存在，数据库管理
器，表空间数据将存储在这些容器中。每个容器字符串可以是绝对的或相对的目录名。如
sySTEMIGcontanerstring
理空间。SMS表空间使用SYSTEMUSING关键字，如下所示：
USING--
USING--（----/container-string-+-）-
其语法如下：
用的文件系统的特征。
+-
更多资源请访问www.ckook.com
创建数据库和表空间
->
8
---
## Page 89
功能甚至效率更高。预读取大小还可以指定为一个整数，后面跟着K、M或G。
大小的倍数，可以并行地读取多个扩展数据块。当表空间的容器在不同的硬盘上时，这个
个值代表在DB2触发预读取请求时每次读取多少个页面。通过将这个值设置为扩展数据块
取的积极程度。在默认情况下，这个值设置为DFT_PREFETCH_SZ数据库配置参数。这
间。可以通过修改CREATETABLESPACE语句中的PREFETCHSIZE参数来控制执行预获
这样查询就不需要等待底层操作系统执行I/O操作。这种异步的检索可以显著减少执行时
连续的预读取是指数据库管理程序能够提前预测查询，在实际引用页面之前读取这些页面
PREFETCHSIzEnumberofpages
覆盖这个数字。
2048KB（对于8KB页面）。可以在CREATETABLESPACE语句中使用EXTENTSIZE参数
256个页面；因此，绝对大小是从8KB到1024KB（对于4KB页面），或者从16KB到
DFT_EXTENT_SZ指定数据库中所有表空间的默认扩展数据块大小。这个值的范围是2到
定义的。一旦为表空间指定了扩展数据块大小，就不能改变了。数据库配置参数
数据库管理程序在存储数据时重复地循环使用各个容器。EXTENTSIZE大小是在表空间级
之后将跳到下一个容器。EXTENTSIZE值还可以指定为一个整数，后面跟着K、M或G。
EXTENTSIZE number of pages
UNIX/Linux的chown命令实现这一点。
通常需要使用操作系统root权限创建逻辑卷并且赋予DB2实例使用的权限，一般通过
DEVICE容器，容器字符串必须是设备名而且这个设备必须已经存在，对于DEVICE容器
录。如果文件不存在，数据库管理程序就会创建这个文件并初始化为指定的大小。对于
它就相对于数据库目录。如果目录名的任何部分不存在，数据库管理程序就会创建这个目
兆字节）。可以混合指定FILE和DEVICE容器。
循序渐进DB2—DBA系统管理、运维与应用案例
CREATE DATABASEMYDB
DFT_EXTENT_SZ4
PREFETCHSIZE指定在执行数据预获取时将从表空间中读取的PAGESIZE页面数量
对于FILE容器，容器字符串必须是绝对或相对的文件名。如果文件名不是绝对的，
下面是一个CREATEDATABASE命令的示例，它使用了前面讨论的许多选项。
关于PREFETCHSIZE的设置，我们在后面表空间性能小节还会详细讲解。
EXTENTSIZE指定数据库可以写到一个容器中的PAGESIZE页面数量，达到这个数量
重要提示：所有容器必须在所有数据库上是唯一的：一个容器只能属于一个表空间。
CREATEDATABASE命令示例
更多资源请访问www.ckook.com
---
## Page 90
我们会在3.2节中详细讲解。
要做更多的规划工作，但是产生的数据库更容易管理，性能也可能更好。关于这部分内容
库转入生产环境，就需要对DB2使用的数据布局和表空间定义付出更大的努力。尽管这需
DATABASE命令的默认值提供了一个可以满足开发和测试需要的数据库。一旦决定将数据
EXTENTSIZE8
·DFT_EXTENT_SZ4：这个参数告诉DB2默认的扩展数据块大小是4个页面，除非
·CREATEDATABASE：这个语句定义要创建的数据库的名称。
TEMPORARY TABLESPACE MANAGED BY SYSTEM USING
CATALOGTABLESPACEMANAGEDBYDATABASEUSING
上面我们介绍了关于如何创建DB2数据库的背景知识。在大多数情况下，CREATE
我们来详细地看看每一行：
（'C:\TEMPTS,D:ATEMPTS')
PREFETCHSIZE48：查询处理期间，同时预读取48个页面。
PREFETCHSIZE 16
(FILE'C:\DB2DATA\CATALOG.DAT'2000,FILE'D:\DB2DATA\CATALOG.DAT'2000)
EXTENTSIZE24：USER表空间的EXTENTSIZE是24个页面。
FILEC：TS.：这个空间只有一个容器，它由1200个页面组成。
的表的地方）将由DB2直接管理。
C:TEMPTS.：临时空间将跨两个文件，文件的大小在DB2执行期间自动地调整。
TEMPORARYTABLESPACEMANAGEDBYSYSTEMUSING：DB2使用的临时
EXTENTSIZE8：EXTENTSIZE是8个页面。这个设置会覆盖DFT_EXTENT_SZ。
FILEC:L.：表空间的位置将跨两个文件，每个文件有2000个页面的空间。
在创建表空间时显式地声明，否则默认使用这个值。
PREFETCHSIZE48
空间将由操作系统处理。
PREFETCHSIZE16：在查询处理期间，同时预读取16个页面。
由数据库管理。
CATALOGTABLEPSACEMANAGEDBYDATABASEUSING:DB2编目空间将
EXTENTSIZE 24
(FILEC:\TS\USERTS.DAT1200)
创建数据库和表空间
更多资源请访问www.ckook.com
---
## Page 91
击“添加”按钮，将会显示另一个对话框，如图3-9所示，可以在这里定义要使用的容器。
个表空间的设备和文件系统，如图3-8所示。
择“低维护”选项，向导就会创建SMS表空间。如果选择“高性能”，就需要指定用于这
一个。
义为UTF-8（EnabledatabaseforXML)。另外，在DB2V9中自动存储是数据库的默认设置
3-7所示。另外，可以添加关于数据库内容的注释。
称、创建它的默认驱动器（如果没有指定其他驱动器，就会使用这个驱动器）和别名，如图
据库，创建数据库向导将带领我们执行许多步骤来生成数据库。向导首先询问数据库的名
循序渐进DB2—DBA系统管理、运维与应用案例
无论选择哪个选项，都可以指定希望分配给这个表空间的容器（文件、设备）。如果单
如果没有为表空间指定容器或文件，DB2将在前面指定的默认驱动器上自动地生成
可以设置两个性能参数：EXTENTSIZE和PREFETCHSIZE，如图3-10所示。
创建数据库向导：性能选项
向导的后3个对话框要求填写关于如何创建用户、编目和临时表空间的信息。如果选
创建数据库向导：用户/编目/临时表
关于图3-7有几点需要特别注意。如果希望在数据库中使用XML列，那么它必须定
如果感觉到通过上面命令创建数据库比较麻烦，您可以通过创建数据库向导来创建数
2.使用创建数据库向导创建数据库
创建数据库向导
让B2等（自动存储券）
指定新数据库的名称
图3-7指定数据库的名称、默认路径、别名等
试政据库
T一成取清
更多资源请访问www.ckook.com
---
## Page 92
创建数据库向导
户
定义容器
文件党型
D
创建数据库向导
security
Readme
北许0日2目动更新表空网线取大小
调整此数据库的性能。
全部文件（）
指定如何存储用户表，以及存储在
示了1项（共1项）
地大小
图3-8指定如何创建用户、编目和临时表空间
自动地加（系饮量
益
4KB页
图3-10
更改（）
图3-9定义容器
e
果生不加容
调整数据库的性能
宣
则向
确定联消应用量业助
上一岁回下一岁元成取消
EE
第3章
创建数据库和表空间
取请
9
---
## Page 93
8
页的数据类型。一般情况下，使用相同的应用程序代码页和数据库代码页是有好处的，可
用二进制表示来比较所有值。在需要以本机（二进制）格式存储数据时，要避免使用有代码
对数据值进行比较。如果使用选项COLLATEUSINGIDENTITY，那么以逐字节的方式使
行定义。如果指定选项COLLATEUSINGSYSTEM，就根据为数据库指定的TERRITORY
问的数据库不同的代码页，那么一定要确保代码页是兼容的并可以执行转换。
较。如果它们的代码页不相同，就会尝试对每个SQL语句执行代码页转换。如果使用与访
据的应用程序，可以考虑设置更高的PREFETCHSIZE。
循序渐进DB2——DBA系统管理、运维与应用案例
在默认情况下，数据库的整理次序根据CREATEDATABASE命令中使用的编码集进
当一个DB2应用程序绑定到DB2数据库时，会对应用程序和数据库的代码页进行比
在数据库创建过程中，遇到的下一个选项涉及代码页和整理次序，如图3-11所示。
创建数据库向导：代码页和整理次序
这些参数的默认值对于许多应用程序是合适的，但是对于执行许多查询或分析大量数
·EXTENTSIZE：扩展数据块（extent）是表空间的容器中的一个空间单元。数据库对象
我们来看这两个参数的作用：
盘上时，这个功能甚至效率更高。
数据块大小的倍数，可以并行地读取多个扩展数据块。当表空间的容器在不同的硬
值代表在DB2触发预获取请求时每次读取多少个页面。通过将这个值设置为扩展
程度。在默认情况下，这个值设置为DFT_PREFETCH_SZ数据库配置参数。这个
CREATETABLESPACE语句中的PREFETCHSIZE参数来控制执行预读取的积极
用页面之前读取这些页面。这种异步的检索可以显著减少执行时间。可以通过修改
PREFETCHSIZE：连续的预读取是指数据库管理程序能够提前预测查询，在实际引
及其对EXTENTSIZE的影响的更多信息，请参考《深入解析DB2》一书。
那么扩展数据块的很大一部分有可能是空的（对于包含很少记录的维集）。关于MDC
定。MDC表将为创建的每个新的维集分配一个扩展数据块。如果扩展数据块太大，
CREATETABLESPACE语句中使用EXTENTSIZE参数覆盖这个数字。
到1024KB（对于4KB页面），或者从16KB到2048KB（对于8KB页面）。可以在
认扩展数据块大小。这个值的范围是2到256个页面：因此，绝对大小是从8KB
就不能改变了。数据库配置参数DFT_EXTENT_SZ指定数据库中所有表空间的默
据块。扩展数据块大小是在表空间级定义的。一旦为表空间指定了扩展数据块大小，
（除了LOB和longvarchar之外）都存储在DB2中的页面中。这些页面组合成扩展数
更多资源请访问www.ckook.com
---
## Page 94
建数据库的DB2命令，如图3-13所示。
所有选择，如图3-12所示。
以避免进行代码页转换
总结页面上一个极其有用的特性是“显示命令”按钮。如果单击它，就会看到用米创
在设置好所有参数之后，创建数据库向导会显示一个总结页面，其中总结了您做出的
创建数据库向导：创建总结
创建数据库向导
创建数据库向导
用户表
件
复查在单击“完成”之后将执行的操作。
指定此数据库的语言环境。
数示命W
请言环膜（地城和代码实）确定款指浓所能用的半柠货。
图3-13显示数据库的创建命令
XOL)
图3-11
图3-12查看数据库创建总结
指定数据库的语言环境
地址
CK
上
第3章
OLLATE
X
取清
创建数据库和表空间
更多资源请访问www.ckook.com
---
## Page 95
录可以区分在CREATEDATABASE命令中指定的目录下的实例中创建的数据库。
区数据库环境中的数据库分区。在节点名目录下面，将创建一个名为SQL00001的子目录。
在实例名子目录下面，将创建一个名为NODE0000的子目录。这个子目录可以区分逻辑分
的子目录。这个子目录确保在同一目录下的不同实例中创建的数据库不会使用相同的路径
索引、容器等信息，这个目录至关重要，一定要注意它的安全性。
位置。建议我们创建数据库时明确数据库路径。数据库目录中存放的是数据库表空间、表、
提供的路径信息。如果在创建数据库时未指定目录路径或驱动器的位置，那么将使用默认
这就是数据库目录。此分层目录结构的创建位置取决于您在CREATEDATABASE命令中
样，当我们创建数据库时，关于该数据库的信息（包括默认信息）会存储在目录层次结构中
3.1.4数据库目录