D.49 ecpg . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 356
D.50 END . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 360
D.51 EXPLAIN . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 360
D.52 FETCH . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 362
D.53 GRANT . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 365
D.54 initdb . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 368
D.55 initlocation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 369
xiv CONTENTS
D.56 INSERT . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 370
D.57 ipcclean . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 372
D.58 LISTEN . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 373
D.59 LOAD . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 374
D.60 LOCK . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 376
D.61 MOVE . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 379
D.62 NOTIFY . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 380
D.63 pgaccess . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 382
D.64 pgtclsh . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 385
D.65 pgtksh . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 385
D.66 pg_ctl . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 386
D.67 pg_dump . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 389
D.68 pg_dumpall . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 391
D.69 pg_passwd . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 393
D.70 pg_upgrade . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 395
D.71 postgres . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 396
D.72 postmaster . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 399
D.73 psql . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 402
D.74 REINDEX . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 422
D.75 RESET. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 423
D.76 REVOKE . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 424
D.77 ROLLBACK . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 426
D.78 SELECT . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 427
D.79 SELECTINTO . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 436
D.80 SET . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 437
D.81 SHOW . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 443
D.82 TRUNCATE . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 444
D.83 UNLISTEN . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 445
D.84 UPDATE . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 446
D.85 VACUUM . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 448
D.86 vacuumdb . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 450
Bibliography 453
Index 455
List of Figures
2.1 psqlsessionstart-up . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
2.2 MyfirstSQLquery . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7
2.3 Multilinequery . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7
2.4 Backslash-pdemo . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 8
3.1 Databases . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 12
3.2 Createtablefriend . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 13
3.3 Exampleofbackslash-d . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 14
3.4 INSERTintofriend . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 15
3.5 AdditionalfriendINSERTcommands . . . . . . . . . . . . . . . . . . . . . . . . . 16
3.6 MyfirstSELECT . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 16
3.7 MyfirstWHERE . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 17
3.8 MorecomplexWHEREclause . . . . . . . . . . . . . . . . . . . . . . . . . . . . 17
3.9 Asinglecell . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 18
3.10 Ablockofcells . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 18
3.11 Comparingstringfields . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 18
3.12 DELETEexample . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 20
3.13 MyfirstUPDATE . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 21
3.14 Useof ORDERBY . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 21
3.15 ReverseORDERBY . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 21
3.16 Useof ORDERBYandWHERE . . . . . . . . . . . . . . . . . . . . . . . . . . . . 22
4.1 Exampleofcommondatatypes . . . . . . . . . . . . . . . . . . . . . . . . . . . 24
4.2 Insertionofspecificcolumns . . . . . . . . . . . . . . . . . . . . . . . . . . . . 25
4.3 NULLhandling . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 27
4.4 Comparisonof NULLfields . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 28
4.5 NULLvaluesandblankstrings . . . . . . . . . . . . . . . . . . . . . . . . . . . 28
4.6 UsingDEFAULTvalues . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 29
4.7 Controllingcolumnlabels . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 29
4.8 Computationusingacolumnlabel . . . . . . . . . . . . . . . . . . . . . . . . . 30
4.9 Commentstyles . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 30
xv
xvi LISTOFFIGURES
4.10 Newfriends . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 31
4.11 WHEREtestforSandyGleason . . . . . . . . . . . . . . . . . . . . . . . . . . . . 32
4.12 FriendsinNewJerseyandPennsylvania . . . . . . . . . . . . . . . . . . . . . . 32
4.13 IncorrectlymixingANDandORclauses . . . . . . . . . . . . . . . . . . . . . . . 33
4.14 CorrectlymixingANDandORclauses . . . . . . . . . . . . . . . . . . . . . . . . 33
4.15 Selectingarangeofvalues . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 34
4.16 FirstnamebeginswithD . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 35
4.17 Regularexpressionsamplequeries . . . . . . . . . . . . . . . . . . . . . . . . . 38
4.18 Complexregularexpressionqueries . . . . . . . . . . . . . . . . . . . . . . . . 39
4.19 CASEexample . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 40
4.20 ComplexCASEexample . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 41
4.21 DISTINCTpreventsduplicates . . . . . . . . . . . . . . . . . . . . . . . . . . . . 42
4.22 Functionexamples . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 44
4.23 Operatorexamples . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 45
4.24 SHOWandRESETexamples . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 46
5.1 ExamplesofAggregates. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 50
5.2 AggregatesandNULLvalues . . . . . . . . . . . . . . . . . . . . . . . . . . . . 52
5.3 AggregatewithGROUPBY . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 53
5.4 GROUPBYwithtwocolumns . . . . . . . . . . . . . . . . . . . . . . . . . . . . 54
5.5 HAVING . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 54
6.1 Qualifiedcolumnnames . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 58
6.2 Joiningtables . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 59
6.3 Creationofcompanytables . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 61
6.4 Insertionintocompanytables . . . . . . . . . . . . . . . . . . . . . . . . . . . . 63
6.5 Findingacustomernameusingtwoqueries . . . . . . . . . . . . . . . . . . . . 64
6.6 Findingacustomernameusingonequery . . . . . . . . . . . . . . . . . . . . . 64
6.7 Findinganordernumberforacustomername . . . . . . . . . . . . . . . . . . . 65
6.8 Three-tablejoin . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 66
6.9 Four-tablejoin . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 66
6.10 Employeeswhohavetakenordersforcustomers . . . . . . . . . . . . . . . . . 67
6.11 Joiningcustomerandemployee . . . . . . . . . . . . . . . . . . . . . . . . . . . . 68
6.12 Joiningpartandemployee . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 69
6.13 Thestatenametable . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 69
6.14 Usingacustomercode . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 71
6.15 Aone-to-manyjoin . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 72
6.16 Unjoinedtables . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 73
6.17 Usingtablealiases . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 73
6.18 Examplesofself-joinsusingtablealiases . . . . . . . . . . . . . . . . . . . . . . 74
6.19 Non-equijoins . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 75
LISTOFFIGURES xvii
6.20 Newsalesordertableformultiplepartsperorder . . . . . . . . . . . . . . . . . . 76
6.21 Theorderparttable . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 76
6.22 Queriesinvolvingtheorderparttable . . . . . . . . . . . . . . . . . . . . . . . . 78
7.1 OIDtest . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 80
7.2 ColumnswithOIDs . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 81
7.3 Examplesofsequencefunctionuse . . . . . . . . . . . . . . . . . . . . . . . . . 83
7.4 Numberingcustomerrowsusingasequence . . . . . . . . . . . . . . . . . . . . 84
7.5 ThecustomertableusingSERIAL . . . . . . . . . . . . . . . . . . . . . . . . . . 85
8.1 CombiningtwocolumnswithUNION . . . . . . . . . . . . . . . . . . . . . . . . 88
8.2 CombiningtwotableswithUNION . . . . . . . . . . . . . . . . . . . . . . . . . . 89
8.3 UNIONwithduplicates . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 89
8.4 UNIONALLwithduplicates . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 90
8.5 EXCEPTrestrictsoutputfromthefirstSELECT . . . . . . . . . . . . . . . . . . . 90
8.6 INTERSECTreturnsonlyduplicatedrows . . . . . . . . . . . . . . . . . . . . . . 91
8.7 FriendsnotinDickGleason’sstate . . . . . . . . . . . . . . . . . . . . . . . . . 93
8.8 Subqueriescanreplacesomejoins . . . . . . . . . . . . . . . . . . . . . . . . . 94
8.9 Correlatedsubquery. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 95
8.10 Employeeswhotookorders . . . . . . . . . . . . . . . . . . . . . . . . . . . . 97
8.11 Customerswhohavenoorders . . . . . . . . . . . . . . . . . . . . . . . . . . . 97
8.12 INqueryrewrittenusingANYandEXISTS . . . . . . . . . . . . . . . . . . . . . . 99
8.13 NOTINqueryrewrittenusingALLandEXISTS . . . . . . . . . . . . . . . . . . . 100
8.14 Simulatingouterjoins . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 101
8.15 SubquerieswithUPDATEandDELETE . . . . . . . . . . . . . . . . . . . . . . . . 102
8.16 UPDATEtheorder_date . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 102
8.17 UsingSELECTwithINSERT . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 103
8.18 TablecreationwithSELECT . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 104
9.1 Exampleofafunctioncall . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 112
9.2 Errorgeneratedbyundefinedfunction/typecombination. . . . . . . . . . . . . . 112
9.3 Errorgeneratedbyundefinedoperator/typecombination . . . . . . . . . . . . . 115
9.4 Creationofarraycolumns . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 116
9.5 Usingarrays . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 117
9.6 Usinglargeimages . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 118
10.1 INSERTwithnoexplicittransaction . . . . . . . . . . . . . . . . . . . . . . . . . 122
10.2 INSERTusinganexplicittransaction . . . . . . . . . . . . . . . . . . . . . . . . 122
10.3 TwoINSERTsinasingletransaction . . . . . . . . . . . . . . . . . . . . . . . . . 123
10.4 Multistatementtransaction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 123
10.5 Transactionrollback . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 124
xviii LISTOFFIGURES
10.6 Read-committedisolationlevel . . . . . . . . . . . . . . . . . . . . . . . . . . . 126
10.7 Serializableisolationlevel . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 127
10.8 SELECTwithnolocking . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 129
10.9 SELECT…FORUPDATE . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 130
11.1 Exampleof CREATEINDEX . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 132
11.2 Exampleofauniqueindex . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 133
11.3 UsingEXPLAIN . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 134
11.4 MorecomplexEXPLAINexamples . . . . . . . . . . . . . . . . . . . . . . . . . . 135
11.5 EXPLAINexampleusingjoins . . . . . . . . . . . . . . . . . . . . . . . . . . . . 136
12.1 Examplesof LIMITandLIMIT/OFFSET . . . . . . . . . . . . . . . . . . . . . . . . 138
12.2 Cursorusage . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 139
13.1 Temporarytableauto-destruction . . . . . . . . . . . . . . . . . . . . . . . . . . 142
13.2 Exampleoftemporarytableuse . . . . . . . . . . . . . . . . . . . . . . . . . . 143
13.3 ALTERTABLEexamples . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 144
13.4 ExamplesoftheGRANTcommand. . . . . . . . . . . . . . . . . . . . . . . . . . 145
13.5 Creationofinheritedtables . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 146
13.6 Accessinginheritedtables . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 146
13.7 Inheritanceinlayers. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 147
13.8 Examplesofviews . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 148
13.9 RuletopreventanINSERT . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 149
13.10 Rulestologtablechanges . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 150
13.11 Useofrulestologtablechanges . . . . . . . . . . . . . . . . . . . . . . . . . . 151
13.12 Viewsignoretablemodifications . . . . . . . . . . . . . . . . . . . . . . . . . . 152
13.13 Rulestohandleviewmodifications . . . . . . . . . . . . . . . . . . . . . . . . . 152
13.14 Exampleofrulesthathandleviewmodifications . . . . . . . . . . . . . . . . . . 153
14.1 NOTNULLconstraint . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 156
14.2 NOTNULLwithDEFAULTconstraint . . . . . . . . . . . . . . . . . . . . . . . . . 156
14.3 UNIQUEcolumnconstraint . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 157
14.4 MulticolumnUNIQUEconstraint . . . . . . . . . . . . . . . . . . . . . . . . . . . 157
14.5 CreationofaPRIMARYKEYcolumn . . . . . . . . . . . . . . . . . . . . . . . . . 158
14.6 ExampleofamulticolumnPRIMARYKEY . . . . . . . . . . . . . . . . . . . . . . 159
14.7 Foreignkeycreation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 160
14.8 Foreignkeyconstraints . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 160
14.9 Creationofcompanytablesusingprimaryandforeignkeys . . . . . . . . . . . . 161
14.10 Customertablewithforeignkeyactions . . . . . . . . . . . . . . . . . . . . . . 162
14.11 Foreignkeyactions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 163
14.12 Exampleofamulticolumnforeignkey . . . . . . . . . . . . . . . . . . . . . . . 164
LISTOFFIGURES xix
14.13 MATCHFULLforeignkey . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 165
14.14 DEFERRABLEforeignkeyconstraint. . . . . . . . . . . . . . . . . . . . . . . . . 167
14.15 CHECKconstraints . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 168
15.1 Exampleof COPY…TOandCOPY…FROM . . . . . . . . . . . . . . . . . . . . . . 170
15.2 Exampleof COPY…FROM . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 171
15.3 Exampleof COPY…TO…USINGDELIMITERS . . . . . . . . . . . . . . . . . . . . . 172
15.4 Exampleof COPY…FROM…USINGDELIMITERS . . . . . . . . . . . . . . . . . . . 172
15.5 COPYusingstdinandstdout . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 173
15.6 COPYbackslashhandling . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 174
16.1 Exampleof\pset . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 179
16.2 psqlvariables . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 181
16.3 Pgaccess’sopeningwindow . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 186
16.4 Pgaccess’stablewindow . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 186
17.1 Sampleapplicationbeingrun . . . . . . . . . . . . . . . . . . . . . . . . . . . . 187
17.2 Statenametable . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 188
17.3 LIBPQdataflow . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 189
17.4 LIBPQsampleprogram . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 190
17.5 LIBPGEASYsampleprogram . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 192
17.6 ECPGsampleprogram . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 193
17.7 LIBPQ++sampleprogram . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 194
17.8 Javasampleprogram . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 197
17.9 Perlsampleprogram . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 198
17.10 TCLsampleprogram . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 199
17.11 Pythonsampleprogram . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 200
17.12 PHPsampleprogram—input . . . . . . . . . . . . . . . . . . . . . . . . . . . . 201
17.13 PHPsampleprogram—output . . . . . . . . . . . . . . . . . . . . . . . . . . . . 202
18.1 SQLftocfunction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 204
18.2 SQLtaxfunction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 205
18.3 Recreationoftheparttable . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 206
18.4 SQLshippingfunction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 207
18.5 SQLgetstatenamefunction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 208
18.6 Gettingstatenameusingajoinandafunction . . . . . . . . . . . . . . . . . . . 209
18.7 PL/PGSQLversionofgetstatename . . . . . . . . . . . . . . . . . . . . . . . . . . 209
18.8 PL/PGSQLspreadfunction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 211
18.9 PL/PGSQLgetstatecodefunction . . . . . . . . . . . . . . . . . . . . . . . . . . . 212
18.10 Callstogetstatecodefunction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 213
18.11 PL/PGSQLchange_statenamefunction . . . . . . . . . . . . . . . . . . . . . . . . 214
xx LISTOFFIGURES
18.12 Examplesusingchange_statename() . . . . . . . . . . . . . . . . . . . . . . . . 215
18.13 Triggercreation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 217
19.1 Cctof function . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 220
19.2 Createfunctionctof . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 221
19.3 Callingfunctionctof . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 221
20.1 Examplesofuseradministration . . . . . . . . . . . . . . . . . . . . . . . . . . 224
20.2 Examplesofdatabasecreationandremoval . . . . . . . . . . . . . . . . . . . . 225
20.3 Makinganewcopyofdatabasetest . . . . . . . . . . . . . . . . . . . . . . . . . 228
20.4 Postmasterandpostgresprocesses . . . . . . . . . . . . . . . . . . . . . . . . . 229
List of Tables
3.1 Tablefriend . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 12
4.1 Commondatatypes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 23
4.2 Comparisonoperators . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 34
4.3 LIKEcomparisons . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 35
4.4 Regularexpressionoperators . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 36
4.5 Regularexpressionspecialcharacters . . . . . . . . . . . . . . . . . . . . . . . . 36
4.6 Examplesofregularexpressions . . . . . . . . . . . . . . . . . . . . . . . . . . . 37
4.7 SEToptions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 43
4.8 DATESTYLEoutput . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 46
5.1 Aggregates . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 49
7.1 Sequencenumberaccessfunctions . . . . . . . . . . . . . . . . . . . . . . . . . . 82
9.1 POSTGRESQLdatatypes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 108
9.2 Geometrictypes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 110
9.3 Commonfunctions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 113
9.4 Commonoperators . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 114
9.5 Commonvariables. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 115
10.1 Visibilityofsingle-querytransactions . . . . . . . . . . . . . . . . . . . . . . . . 124
10.2 Visibilityofmultiquerytransactions . . . . . . . . . . . . . . . . . . . . . . . . . 125
10.3 Waitingforalock . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 128
10.4 Deadlock. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 129
13.1 Temporarytableisolation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 141
15.1 BackslashesunderstoodbyCOPY . . . . . . . . . . . . . . . . . . . . . . . . . . . 174
16.1 psql’squerybuffercommands . . . . . . . . . . . . . . . . . . . . . . . . . . . . 178
16.2 psql’sgeneralcommands . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 178
xxi
xxii LISTOFTABLES
16.3 psql’s\psetoptions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 179
16.4 psql’soutputformatshortcuts . . . . . . . . . . . . . . . . . . . . . . . . . . . . 180
16.5 psql’spredefinedvariables . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 182
16.6 psql’slistingcommands . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 183
16.7 psql’slargeobjectcommands . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 184
16.8 psql’scommand-linearguments . . . . . . . . . . . . . . . . . . . . . . . . . . . 185
17.1 Interfacesummary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 188
20.1 Commonlyusedsystemtables . . . . . . . . . . . . . . . . . . . . . . . . . . . . 231
Foreword
Most research projects never leave the academic environment. Occasionally, exceptional ones
survivethetransitionfrom theuniversityto the realworld andgoon to becomeaphenomenon.
POSTGRESQLisoneofthoseprojects. Itspopularityandsuccessareatestamenttothededication
andhard work of the POSTGRESQL global developmentteam. Although developingan advanced
databasesystemisnosmallfeat,maintainingandenhancinganinheritedcodebaseareevenmore
challenging. ThePOSTGRESQLteamhasmanagedtonotonlyimprovethequalityandusabilityof
thesystem,butalsoexpanditsuseamongtheInternetusercommunity. Thisbookmarksamajor
milestoneinthehistoryoftheproject.
Postgres95, later renamed POSTGRESQL, started as a small project to overhaul Postgres.
Postgres was a novel and feature-rich database system created by the students and staff at the
University of California at Berkeley. Our goal with Postgres95 was to keep the powerful and
useful features of this system while trimming down the bloat caused by much experimentation
and research. We had a lot of fun reworking the internals. At the time, we had no idea where
we were going with the project. The Postgres95 exercise was not research, but simply a bit of
engineeringhousecleaning. Bythespringof1995however,ithadoccurredtousthattheInternet
user community really needed an open source, SQL-based multiuser database. Happily, our first
releasewasmetwithgreatenthusiasm,andweareverypleasedtoseetheprojectcontinuing.
Obtaining information about a complex system like POSTGRESQL is a great barrier to its
adoption. Thisbookfillsacriticalgapinthedocumentationoftheprojectandprovidesanexcellent
overview of the system. It covers a wide range of topics, from the basics to the more advanced
anduniquefeaturesof POSTGRESQL.
In writing this book, Bruce Momjian has drawn on his experiencein helping beginners with
POSTGRESQL.Thetextiseasytounderstandandfullofpracticaltips. Momjiancapturesdatabase
concepts using simple and easy-to-understand language. He also presents numerous real-life
examplesthroughoutthebook. Inaddition,hedoesanoutstandingjobofcoveringmanyadvanced
POSTGRESQLtopics. EnjoyreadingthebookandhavefunexploringPOSTGRESQL!Itisourhope
thisbook willnotonly teachyouabout usingPOSTGRESQL,butalsoinspireyou to delveinto its
innardsandcontributetotheongoingPOSTGRESQLdevelopmenteffort.
ChenandAndrewYu,co-authorsofPostgres95