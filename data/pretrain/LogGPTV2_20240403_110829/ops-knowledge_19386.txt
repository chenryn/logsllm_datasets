User: How to write Shell scripts to automate log file analysis and transmission? Please provide sample code and detailed steps.
Assistant: In Linux systems, we can use Shell scripts to automate log file analysis and transmission. The following is a sample code, the script will read the log file from the specified directory, analyze the log content and transmit it to the specified target host in the specified format. ``` #!/bin/bash # Log directory log_dir="/var/log/apache2/" # Target host IP address target_host="192.168.1.100" # Target host port number target_port="22" # Target host user Name target_user="root" # The key file path of the target host key_file="/root/.ssh/id_rsa" # Process the log file for logfile in $(ls $log_dir) do # Count the top 10 access times in the statistics log IP address top_ips=$(grep -oE "\b([0-9]{1,3}\.){3}[0-9]{1,3}\b" $log_dir/$logfile | sort | uniq -c | sort -rn | head -n 10) # Format the output and transfer it to the target host formatted_log="Log file: $logfile\n\nThe IP address with the most visits:\n$top_ips\n\n " ssh -i $key_file -p $target_port $target_user@$target_host "echo \"$formatted_log\" >> /root/logs/top_ips.log" done ``` The above script includes the following steps: 1. Set the log directory, Target host IP address, port number, username, and key file path. 2. Loop through all log files in the log directory, and obtain the top 10 IP addresses with the most visits. 3. Format the output log content and transfer it in append mode to the specified file on the target host. It should be noted that during the transfer process, SSH password-free login needs to be configured on the target host, and the public key must be added to the authorized_keys file of the target host. At the same time, we can also flexibly modify the script content and implementation logic according to specific needs, so as to realize the automatic processing and transmission of log files.