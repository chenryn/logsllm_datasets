## Page 162
addemail.php脚本
创建Add email脚本
你目前在处理这一步。
Elmer需要一个HTML表单从客户那里收集客户名和邮件地址。
为邮件列表创建一个数据库和数据库
一旦有了这些信息，可以利用一个PHP脚本来获取，并存储在
表：
email_list表中。Web表单（addemai1.html）需要有3个输
2
创建一个AddEmailWeb表单和PHP脚
本向列表增加新客户。
入域和一个按钮。表单动作是表单中最重要的代码，因为它的任
务就是将表单数据传递到我们将要创建的addemail.php脚本。
③
创建一个SendEmailWeb表单和PHP
脚本向列表发送一个邮件。
A0O
要通过表单动作将HTML
MakEMEELviS.COM
We6表单与处理其数据的
PHP脚本（addemail.php）相
连接。
First name
Lastname
Emel
Subme
提交表单时金运行
First name:
addemail.php脚本，它
Last name:
的任务就是处理表单
数据并把客户增加到
Enai1:
邮件列表中（数据库
表）
addemail.html
addemail.php
只需使用这个Web表单，新客户
Web服务器
就能加入Elmer的邮件列表（增
数据库服务器
加到数据库）。
elvis store
email list
first_nc
email
126
---
## Page 163
创建与填充数据库
addemail.php脚本处理来自Addemail表单的数据。这个脚本应当从表单取得数据，
ExeRciSe
连接到elvis_store数据库，并使用INSERT将数据插人到email_list表中。下面
请你帮助Elmer，首先编写一个示例SQL查询插入一个新客户，然后使用这个查询完成
PHP脚本代码。
在这里编写一个示例
查询在Elmer的数据库
表中插入数据。
标记设置一个
addemail.php
返固表单的链接。
128
第3章
---
## Page 165
创建与填充数据库
运行测试
测试Addemail表单。
从Head FirstLabs网站（www.headfirstlabs.com/books/hfphp）下
载Addemail页面的代码。这个代码在chapter03文件夹下，包含Elmer的Web
表单（addemail.html）、一个样式表（style.css），以及两个图像
不要忘记根据你的
（elvislogo.gif和blankface.jpg）。
具体情况修改数据
库连接变量。
现在创建一个新文本文件，名为addemail.php，输入上一页的所有代码。这
就是将处理Elmer的Web表单并向email_list表增加新客户的脚本。
将所有这些文件上传到你的Web服务器，并在Web浏览器中打开addemail，
html页面。在表单中输入一个新客户，然后点击Submit。
000
-
MaKEMEELViS.COM
addemail.php脚本会
确认新客户确实插入
ciatng ist
到邮件列表中。
First name: juios
Lastreme: Oenes
Email: juliangbreaerec
Sbmt
可以在一个MySQL工具中执行SELECT查询来检查这个客户是否确实增加到
数据库中。
ail_llat
ulie
PDG
你现在的位置
129
---
## Page 166
测试你的选择能力
thereareno
DumbQuestions
的“星号”（）是同一个东西吗？
的字符？
同一个键上。按下8的同时按下SHIFT就能键入这个
符，但目前你只需要知道这个“星”字符。更重要
星号（*）。不过，尽管这与星号是同一个字符，但
的是，对于我们当前的目标来说，这也是SQL语句
是SQL术语中总是称之为“星”。这很好，因为相
SELECT部分中唯一用到的特殊字符。
对于“从….选择星号”，“从…·选择星”的说
法更为自然。
harpen
既然Elmer的邮件列表已经开始填人数据，下面帮助他编写
些SQL查询以便查找指定的客户数据。
选择名为Martin的客户的所有数据：
只选择名为Bubba的客户的姓：
选择邮件地址为PI:EMAIL的客户的名和姓：
选择名为Amber而且姓为McCarthy的客户的所有列：
130
第3章
---
## Page 167
创建与填充数据库
first na
lastname
Julian
1
Oates
PI:EMAIL
Kevin
/
Jones
PI:EMAIL
Amanda
Sanchez
PI:EMAIL
Bo
Wallace
PI:EMAIL
|Amber
|McCarthy
PI:EMAIL
Cormac
Hurst
PI:EMAIL
Joyce
Harper
PI:EMAIL
Stephen
Meyer
PI:EMAIL
1Martin
PI:EMAIL
Walt
Perala
PI:EMAIL
funyon
PI:EMAIL
真不错。现在用户可以通
ino
PI:EMAIL
过一个网页加入我的邮件到表。
PI:EMAIL
PI:EMAIL
这个列表完全自行构建。
on
PI:EMAIL
PI:EMAIL
PI:EMAIL
D
PI:EMAIL
Louis
Shaffer
PI:EMAIL
Bubba
Shakespeare|
PI:EMAIL
John
Doe
PI:EMAIL
这并不是最后的表数
据.…·Emer的邮件列
表还在飞速增长！
不过这个邮件列表还不能做到自行发送。
Elmer还缺少这个Web应用的另一半，有了这一部分，他才能输
人邮件正文并发送到邮件列表中的每一个人。为此，他需要一个
新的HTML表单和一个PHP脚本来完成具体工作..
①为邮件列表创建
9
个数据库和数据库
表：
创建个AddemailWeb表单和PHP脚
本向列表增加新客户。
PDG
第2步已完成！
③
创建一个SendemailWeb表单和PHP
脚本向列表发送一个邮件。
你现在的位置
131
---
## Page 168
“sharpenyourpencil”解答
既然Elmer的邮件列表已经开始填入数据，下面帮助他编写
一些SQL查询以便查找指定的客户数据。
选择名为Martin的客户的所有数据：
SELECT*FROMemail_listWHEREfitst_nameMatin
这个WHERE子句将奎询结果绵减为只
*表示送择表中的所有列。
包含名为Matin的客户。
只选择名为Bubba的客户的姓：
SELECTlast_nameFROM email_listWHEREsitst_nameBa66a
C
壹询结果中只返①last_name列
选择邮件地址为PI:EMAIL的客户的名和姓：
SELECTsitst_name,last_name FROMemail_list PI:EMAIL
通过用道号分隔各个列名，可以为结果数据指
定多个列。
选择名为Amber而且姓为McCarthy的客户的所有列：
WHERE子句可以依赖于多个信息，在这里
要求同时满足名和姓的匹配。
132
第3章
---
## Page 169
创建与填充数据库
Elmer应用的另一半
要向Elmer邮件列表中的人员发送邮件，在某些方面这与增加人员很类
似，因为这也需要一个HTML
Web表单和一个PHP脚本。最大的差别在
SendemaitWeb表单元许
于，向邮件列表发送一个邮件需要处理email_list表的全部内容，而
Elmet输入一个邮件的主题
addemail.php只处理一个数据行。
和正文，然后发送到整个邮
件列表。
为邮件列表创建-个数据库和数据库
000
表。
MakEMEELViS.COM
③创建个Add-Emuilweb表单和PHP脚
Privase: For Elr
本向列表增加新客户。
哈，终于到了
Subiectsfem
最后一步。
3
创建一个SendEmailweb表单和PHP脚
本向列表发送一个邮件。
Subne
Subject of enail:
Body of email:
sendemail.php脚本从数
据库表读取客户，并把
Elmer的邮件发送给各个
客户。
：单动作能发
mdemail.php脚本。sendemail.html
Web服务器
数据库服务器
sendemail.php
email_list
elvis
store
first_na
last_name
email
Julian
Oates
PI:EMAIL
Kevin
Jones
PI:EMAIL
Amanda
Sanchez
PI:EMAIL
你现在的位置》
133
---
## Page 170
sendemail.php脚本
Sendemail脚本剖析
sendemail.php脚本必须结合两个不同来源的数据生成并发送邮件。一
方面，脚本需要从elvis_store数据库的email_list表中抽取邮件
接收者的名字和邮件地址。另外还必须获得Elmer在SendemailWeb表单
（sendemail.html）中输入的主题和邮件正文。下面逐一分析有关的各个
步骤。
1
使用$_POST数组从表单获得邮件主题和正文。
这里没有什么新内容。点击sendemail.html表单中的Submit会把表单数据发送给
sendemail.php，可以借助s_POST数组获取这些数据并存放在变量中。
对email_1ist表运行一个SELECT查询。
PHPmysqli_query（)函数运行一个SELECT查询来得到邮件列表的数据。由于我们希望得到表
中的所有数据，所以可以使用SELECT*。
从查询结果获取邮件数据。
只是运行一个查询并不能访问数据。还需要获取查询结果中的各个数据行，分别得到各个客户的
名、姓和邮件地址。
调用mai1（）函数向各个客户发送一个邮件。
要发送邮件，需要循环处理邮件列表中的每一个客户，这对应于查询
结果中的每一个数据行。这里创建的循环从第一个数据行开始，然后
移至下一行，接下来循环处理SELECT查询得到的其余数据行。达到
数据末尾时则结束。
$POST['subject']
email_list
Posr[elvismail']
first_nome
lust_nome
email
Julian
Oates
PI:EMAIL
邮件主题和正文通过
Kevin
Jones
PI:EMAIL
S_POST超级全品变
Amanda
Sanchez
PI:EMAIL
量传送到脚本
sendemail.php
脚本需要email_list表
中的奶件数据。
2
Amanda