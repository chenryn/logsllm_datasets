title:Realtime Robust Malicious Traffic Detection via Frequency Domain Analysis
author:Chuanpu Fu and
Qi Li and
Meng Shen and
Ke Xu
Realtime Robust Malicious Traffic Detection
via Frequency Domain Analysis
Chuanpu Fu1, Qi Li2,3, Meng Shen4, and Ke Xu1,3,5
1Department of Computer Science and Technology, Tsinghua University, Beijing, China
2Institute for Network Sciences and Cyberspace, Tsinghua University, Beijing, China
3Beijing National Research Center for Information Science and Technology (BNRist), Tsinghua University, Beijing, China
4School of Cyberspace Science and Technology, Beijing Institute of Technology, Beijing, China
{fcp20@mails., qli01@, xuke@}tsinghua.edu.cn, PI:EMAIL
5Peng Cheng Laboratory, China
ABSTRACT
Machine learning (ML) based malicious traffic detection is an emerg-
ing security paradigm, particularly for zero-day attack detection,
which is complementary to existing rule based detection. However,
the existing ML based detection achieves low detection accuracy
and low throughput incurred by inefficient traffic features extrac-
tion. Thus, they cannot detect attacks in realtime, especially in
high throughput networks. Particularly, these detection systems
similar to the existing rule based detection can be easily evaded
by sophisticated attacks. To this end, we propose Whisper, a re-
altime ML based malicious traffic detection system that achieves
both high accuracy and high throughput by utilizing frequency
domain features. It utilizes sequential information represented by
the frequency domain features to achieve bounded information
loss, which ensures high detection accuracy, and meanwhile con-
strains the scale of features to achieve high detection throughput.
In particular, attackers cannot easily interfere with the frequency
domain features and thus Whisper is robust against various evasion
attacks. Our experiments with 42 types of attacks demonstrate that,
compared with the state-of-the-art systems, Whisper can accurately
detect various sophisticated and stealthy attacks, achieving at most
18.36% improvement of AUC, while achieving two orders of magni-
tude throughput. Even under various evasion attacks, Whisper is
still able to maintain around 90% detection accuracy.
CCS CONCEPTS
• Security and privacy → Intrusion detection systems.
KEYWORDS
Machine learning; malicious traffic detection; frequency domain
ACM Reference Format:
Chuanpu Fu, Qi Li, Meng Shen, and Ke Xu. 2021. Realtime Robust Malicious
Traffic Detection via Frequency Domain Analysis. In Proceedings of the 2021
ACM SIGSAC Conference on Computer and Communications Security (CCS
Permission to make digital or hard copies of all or part of this work for personal or
classroom use is granted without fee provided that copies are not made or distributed
for profit or commercial advantage and that copies bear this notice and the full citation
on the first page. Copyrights for components of this work owned by others than ACM
must be honored. Abstracting with credit is permitted. To copy otherwise, or republish,
to post on servers or to redistribute to lists, requires prior specific permission and/or a
fee. Request permissions from permissions@acm.org.
CCS ’21, November 15–19, 2021, Virtual Event, Republic of Korea
© 2021 Association for Computing Machinery.
ACM ISBN 978-1-4503-8454-4/21/11...$15.00
https://doi.org/10.1145/3460120.3484585
’21), November 15–19, 2021, Virtual Event, Republic of Korea. ACM, New York,
NY, USA, 16 pages. https://doi.org/10.1145/3460120.3484585
1 INTRODUCTION
Traditional malicious traffic detection identifies malicious traffic by
analyzing the features of traffic according to preconfigured rules,
which aims to protect legitimate Internet users from network at-
tacks [29, 47]. However, the rule-base detection is unable to detect
zero-day attacks [8, 12, 22, 65] though it can achieve high detection
accuracy and detection throughput in high bandwidth networks,
e.g., in Internet backbone networks.
As a promising security paradigm, machine learning based mali-
cious traffic detection has been developed, particularly as a com-
plement of the traditional fixed rule based methods (i.e., signature
based NIDS) [6, 29, 35, 47]. Table 1 summarizes and compares rule
based and typical machine learning based detection methods. Com-
pared with rule based methods, machine learning based methods
can effectively identify zero-day malicious traffic [12, 22]. Unfortu-
nately, due to the processing overhead of machine learning algo-
rithms, existing detection methods achieve low detection through-
put and are unable to process high-rate traffic. As a result, most
of these methods can only be deployed offline [2, 4, 5, 15, 28, 49]
so that they cannot realize realtime detection, particularly in high
performance networks (e.g., in 10 Gigabit networks) [42, 77, 78].
Meanwhile, attackers can easily interfere with and evade these
methods by injecting noises, e.g., packets generated by benign ap-
plications, into attack traffic. Packet-level detection [42, 53, 68]
that analyzes per-packet feature sequences is unable to achieve
robust detection. Actually, even in the absence of the evasion at-
tacks, the packet-level detection is unable to detect sophisticated
zero-day attacks. Traditional flow-level methods [4, 28, 49, 77] de-
tecting attacks by analyzing flow-level statistics incur significant
detection latency. Moreover, evasion attacks can easily bypass the
traditional flow-level detection that uses coarse-grained flow-level
statistics [14, 63]. Thus, realtime robust machine learning based
detection that is ready for real deployment is still missing.
In this paper, we develop Whisper that aims to realize realtime
robust malicious traffic detection by utilizing machine learning al-
gorithms. Whisper effectively extracts and analyzes the sequential
information of network traffic by frequency domain analysis [51],
which extracts traffic features with low information loss. Especially,
the frequency domain features of traffic can efficiently represent
various packet ordering patterns of traffic with low feature redun-
dancy. Frequency domain feature analysis with low information
Session 12C: Traffic Analysis and Side ChannelsCCS ’21, November 15–19, 2021, Virtual Event, Republic of Korea3431Table 1: Comparing the Existing Malicious Traffic Detection Methods
Category of
Detection Systems
Feature Extraction Methods
Zero-Day
Detection
High
Accuracy
Robust
Detection
Realtime
Detection
High
Task
Throughput
Agnostic
Rule based
Preconfigured fix rules [6, 29, 35]
Packet-level
ML based
Packet header fields [53]
Context statistics [42]
Payload statistics [68]
Flow-level statistics [5, 37, 77]
Flow-level
Application usage statistics [4, 28, 49]
Frequency domain features, Whisper
1 Bartos et al. [4] only considered evasion strategies for malicious Web traffic.
×
✓
✓
✓
✓
✓
✓
✓
✓
✓
✓
×
✓
✓
×
×
×
×
×
×1
✓
✓
✓
✓
×
×
×
✓
✓
×
×
×
✓
×
✓
×
✓
✓
✓
×
×
✓
loss enables accurate and robust detection, while low feature redun-
dancy ensures high throughput traffic detection. In particular, since
the frequency domain features represent fine-grained sequential
information of the packet sequences, which are not disturbed by
the injected noise packets, Whisper can achieve robust detection.
However, it is non-trivial to extract and analyze the frequency do-
main features from traffic because of the large-scale, complicated,
and dynamic patterns of traffic [14, 63].
To effectively perform frequency domain traffic feature analysis,
we develop a three-step frequency domain feature extraction. First,
we encode per-packet feature sequences as vectors, which reduces
the data scale and the overhead of subsequent processing. Sec-
ond, we segment the encoded vectors and perform Discrete Fourier
Transformation (DFT) [51] on each frame, which aims to extract
the sequential information of traffic. It allows statistical machine
learning algorithms to easily learn the patterns. Third, we perform
logarithmic transformation on the modulus of the frequency do-
main representation produced by DFT, which prevents float point
overflows incurred by the numerical instability issue [23] during
the training of machine learning.
Furthermore, we propose an automatic parameter selection mod-
ule to select the encoding vector for efficient packet feature encod-
ing. To achieve this, we formulate the per-packet feature encoding
as a constrained optimization problem to minimize mutual interfer-
ence of the per-packet features during frequency domain feature
analysis. We transform the original problem into an equivalent
SMT problem and solve the problem by an SMT solver. It ensures
the detection accuracy by choosing vectors, while effectively re-
ducing manual efforts of selecting encoding vectors. We utilize
statistical machine learning to cluster the patterns according to the
frequency domain features. Due to the rich feature presentation
and lightweight machine learning, Whisper finally realizes realtime
detection of malicious traffic in high throughput networks.
We theoretically prove that Whisper is more efficient than packet-
level and traditional flow-level detection methods. We conduct a
theoretical analysis to prove that the frequency domain features
ensure bounded information loss, which lays the foundation for
robust detection of Whisper. We develop a traffic feature differential
entropy model, a theoretical framework to measure information loss
of feature extraction from traffic. First, we prove the information
loss in processing packet sequences in the existing flow-level meth-
ods, which further demonstrates that it cannot accurately extract
features. Second, we prove that Whisper maintains the informa-
tion loss in the flow-level methods and validate that the frequency
domain features are more efficient. Third, we prove that Whisper
effectively reduces feature redundancy by the decrease in the data
scale of features.
We prototype Whisper with Intel’s Data Plane Development Kit
(DPDK) [26]. To extensively evaluate the performance of the Whis-
per prototype, we replay 42 malicious traffic datasets with the high
throughput backbone network traffic. Besides the typical attacks,
we collect and replay 36 new malicious traffic datasets including:
(i) more stealthy attacks, e.g., low-rate TCP DoS attacks [25, 31, 33]
and stealthy network scanning [38]; (ii) complicated multi-stage
attacks, e.g., TCP side-channel attacks [10, 11, 17] and TLS padding
oracle attacks [67]; (iii) evasion attacks, i.e., attackers inject dif-
ferent types of noise packets (i.e., packets generated by various
benign applications) in attack traffic to evade detection. According
to our experimental results, we validate that Whisper can detect
the different types of attacks with AUC ranging between 0.891 and
0.999 while achieving 1,310,000 PPS, i.e., two orders of magnitude
throughput more than the state-of-the-art methods. Particularly,
Whisper can detect various evasion attacks with 35% improvement
of AUC over the state-of-the-art methods. Furthermore, Whisper
achieves realtime detection with bounded 0.06 second detection
latency in high throughput networks.
In summary, the contributions of our paper are five-fold:
• We present Whisper, a novel malicious traffic detection sys-
tem by utilizing frequency domain analysis, which is the
first system built upon machine learning achieving realtime
and robust detection in high throughput networks.
• We perform frequency domain feature analysis to extract the
sequential information of traffic, which lays the foundation
for the detection accuracy, robustness, and high throughput
of Whisper.
• We develop automatic encoding vector selection for Whis-
per to reduce manual efforts for parameter selection, which
ensures the detection accuracy while avoiding manual pa-
rameter setting.
• We develop a theoretical analysis framework to prove the
• We prototype Whisper with Intel DPDK and use the ex-
periments with different types of replayed attack traffic to
validate the performance of Whisper.
properties of Whisper.
Session 12C: Traffic Analysis and Side ChannelsCCS ’21, November 15–19, 2021, Virtual Event, Republic of Korea3432Figure 1: High-level design of Whisper.
The rest of the paper is organized as follows: Section 2 introduces
the threat model and the design goals of Whisper. Section 3 presents
the high-level design of Whisper. In Section 4, we present the design
details of Whisper. In Section 5, we conduct a theoretical analysis. In
Section 6, we experimentally evaluate the performances of Whisper.
Section 7 reviews related works and Section 8 concludes this paper.
2 THREAT MODEL AND DESIGN GOALS
2.1 Threat Model
We aim to develop a malicious traffic detection system as a plug-in
module of middlebox. The middlebox forwards the replicated traffic
to the detection system through port mirroring, which is similar to
Cisco SPAN [13]. Thus, the detection system does not interfere with
benign traffic forwarding. We assume that the detection system
does not have any prior knowledge on threats, which means that it
should be able to deal with zero-day attacks [12, 42, 65]. Note that,
we do not consider defenses against the attacks detected by Whisper
and can deploy existing malicious traffic defenses [70, 71, 74] to
throttle the detected traffic.
The developed detection system should be able to determine
whether traffic passing through the middlebox is benign or mali-
cious by monitoring ongoing traffic. We emphasize that the mali-
cious traffic detection is fully different from traffic classification [48,
58, 61, 66] that aims to classify whether traffic is generated by a
certain network application or a certain user. We do not consider
detecting passive attacks that do not cause obvious traffic variance,
e.g., eavesdropping attacks and intercept attacks [45, 46].
2.2 Design Goals
In this paper, we aim to develop a realtime robust malicious traf-
fic detection system, which achieves high detection accuracy and
task-agnostic detection. Particularly, the system should achieve the
following two goals, which are not well addressed in the literature.
Robust Accurate Detection. The system should be able to detect
various zero-day attacks. Especially, it can capture different evasion
attacks, which try to evade detection by deliberately injecting noise
packets, i.e., using various packets generated by benign applications,
into the attack traffic.
Realtime Detection with High Throughput. The system should
be able to be deployed in high throughput networks, e.g., a 10
Gigabit Ethernet, while incurring low detection latency.
3 OVERVIEW OF WHISPER
In this section, we present our malicious traffic detection system,
Whisper. Whisper achieves high performance detection by encod-
ing per-packet feature sequences as vectors to reduce the overhead
of subsequent feature processing. Meanwhile, it extracts the sequen-
tial information of traffic via frequency domain to ensure detection
accuracy. In particular, since the frequency domain features repre-
sent fine-grained sequential information of the packet sequences,
which are not disturbed by the injected noise packets, Whisper can
achieve robust detection. Figure 1 shows the overview of Whisper.
High Speed Packet Parser Module. High speed packet parser
module extracts per-packet features, e.g., the packet length and
arriving time interval, at high speed to ensure the processing effi-
ciency in both training and detection phases. This module provides
the per-packet feature sequences to the feature extraction module
for extracting the frequency domain features and the automatic
parameter selection module for determining the encoding vector.
Note that, this module dose not extract specific application related
features and thus Whisper achieves task agnostic detection.
Frequency Features Extraction Module. In both training and de-
tection phases, this module extracts the frequency domain features