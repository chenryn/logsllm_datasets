uirementsandSecurityAssessmentProcedures(201o,October).Payment CardIndustry（PCI)
Procedures-Part-8.html>.
_chuvakin/pci-dss-and-logging-what-you-need-to-kn>
---
## Page 256
者向竞争对手出售商业机密。
攻击者可能不直接寻求人侵计算机，但是可能参与某些恶意活动，例如挪用公司的资金，或
什么含义？攻击者是进行未授权活动的人，不管他们是“外部人员”还是“内部人员”。
有着很大的影响。本章探索日志记录系统可能遭受的攻击，并对缓解或者检测这些攻击的解
志数据作为法律上的证据，说明日志数据完整性的能力对于该数据是否被视为可接受的证据
据的企图有适应能力。在此基础上，它还必须对日志数据的访问进行细粒度的控制。如果日
17.1概述
本章要点
17.2
决方案提出建议。
为什么攻击者会以日志记录系统为目标？首先，我们在这一背景下所说的“攻击者”是
。外部人员的典型例子之一是邪恶的互联网黑客。内部人员可能是你自己的系统管理员
健壮的日志分析系统依赖于所要分析的日志数据的完整性。该系统必须对修改和删除数
攻击以日志为目标的原因多种多样。首先，聪明的攻击者通常希望避免被抓住。因为日
■攻击案例研究
■各类攻击
各类攻击
对日志系统的攻击
第17章
Chapater?
---
## Page 257
236
17.2.2
除，但是日志主机上还有可用的拷贝。对日志主机的这类攻击更为致命。
文件。这种攻击可以通过使用加固的集中日志主机来缓解，在原始主机上的数据仍然会被删
17.2.1攻击什么
击。即使数据本身不是敏感的，法律或者公司政策可能将该数据的曝光视作违规。
报可能是关于系统和网络的信息，这种信息可以用于其他攻击，信息的收集可能本身就是攻
据到达日志主机。
系统的日志，以收集情报。
户编号。因此，攻击者有不被日志记录、销毁日志、修改日志的动机，也希望窥探来自各种
中发现对自己有用的信息，例如事务数据，或者有助于攻击其他系统的信息，如密码或者账
来隐藏他的痕迹，使观察者认为发生的是其他事件。除了隐藏痕迹之外，攻击者可能在日志
志数据提供了活动的证据，他希望避免这些信息被发现。更聪明的攻击者可能希望通过误导
另一种简单的攻击是对源和日志主机之间的网络进行洪泛攻击，造成丢包，阻止日志数
对日志数据的机密性攻击与隐藏痕迹的入侵者无关，而与收集情报相关。这里所说的情
人侵者能在你的日志中找到什么？下面是日志记录领域中可能有用的一些例子：
本节探索这些攻击和其他一些攻击的细节。
例如，远程人侵者使用的rootkit中常常发现一种简单的攻击，即删除/var/log中的任何
■可用性：攻击者删除日志数据或者禁用日志记录系统的能力，或者拒绝分析功能操作
■完整性：攻击者修改、破坏或者插入“构造的”日志数据的能力。
■最后，攻击者可以攻击任何日志管理都无法避免的部分，查看数据和作出决策的分析人员。
■传输：源和日志主机之间的网络，或者处理和存储之间的网络。
■源：日志消息生成的主机，攻击系统或者日志记录应用程序本身都是可行的选择。
对日志记录基础设施的攻击可以在基础设施的任何一点进行：
■你在日志中可能注意到什么，这是为了确定如何避免被注意，或者为了不被记入日志
■你正在运行的应用程序，以及运行它们的主机。日志往往显示应用程序版本，也可能
■机密性：攻击者读取日志数据的能力。
攻击本身可以用计算机威胁分析的“CIA”模型分类：
■
■收集器或者收集日志的代理：收集来自各种源的日志的场所。
包括有关应用程序配置的信息。所有这些数据可以用来寻找漏洞。
的能力。
分析：完成分析的系统和分析过程本身。
日志数据存储：存储日志信息的数据库系统（如果你为这一目的使用数据库)。也适
用于存档日志数据的任何机制，包括利用训练有素的、以备份磁带为生的人。
对机密性的攻击
---
## Page 258
8章)。这里提供的模式与syslog 消息开始处时间戳的匹配。输出如下所示：
可读字符串的内容（一系列可打印字符）。grep用一个正则表达式匹配输人（更多细节参见第
该组的唯一成员是“root”
接访问可能使攻击者能够阅读日志数据。下面的简单例子中，日志文件可以被任何人阅读：
这种情况下告诉dd一次读取多少数据）。strings命令读取二进制输人，并打印任何看上去像
下面是一个例子：
的任何内容（提醒你一句，不仅是日志文件，而是任何内容！任何人的影子文件？）。
权限：
读不应该阅读的内容一例如系统管理员在用户名（root）的位置输入了自己的密码。
间接访问的例子之一是在日志文件存储的磁盘分区所用的设备文件上为所有人设置可读
阅读原始磁盘数据听起来很困难，但是只要有标准的Unix工具和一点耐心就能完成。
在上述例子中，“disk”组的任何用户都可以读取整个磁盘。在本例所处的特定系统中，
dd是一个简单的工具，用于在设备之间传输数据。参数指定输入设备和“块尺寸”（在
ddif=/dev/hda2bs=1M|
这样的设置还不错。但是如果另一个用户能够成为该组的成员，他们就可以读取磁盘上
#grepdisk/etc/group
#1s-1/dev/hd*
如果非特权用户能够读取日志文件，他们就更加容易诊断自己的问题，但是他们可能阅
得到日志数据的最简单方法是访问生成这些数据的地方一
#1s-1/var/1og/messages
■可以窃取的数据或者事务记录的位置，这可能是攻击的真正目标。
Sep 5 07:29:05 1inux kernel:k1ogd 1.4.1,1og source=/proc/kmsg
Sep507:29:001inux sys1ogd 1.4.1:restart.
disk:x:6:root
brw-r-----1rootdisk3,00ct904:45/dev/had
■偶然曝光的证书。例如，
1.源机密性
■有用的信息片断，
份认证失败之后才发觉。错误输人的密码可能会被当作用户名记人日志中的“登录失
(原因同前）。
[0-9]0-9]:[0-9]0-9]:[0-9]0-9][]
败”消息。
started.
如谁有访问特权，人们何时登录等。
strings
，用户在提示输入用户名时不小心输入了他们的密码，直到身
grep
6-06-0]2-0]-]2-]
一消息源。过高的权限或者间
第17章对日志系统的攻击237
---
## Page 259
限的攻击者可能够拦截传输中的数据。这类攻击可以在任何一个端点、利用对任何一台主
完全取决于你。
工具包，它们往往设计为自动删除痕迹并安装后门。是否耗费精力去混淆日志文件的位置，
所以这时你所要考虑的问题比日志文件要严重得多。
读。当然，具有根权限的攻击者仍然能够修改该文件，但是这样的攻击者可以做任何事情，
有人可读的，你应该保持这种配置。实际上，很少有理由将任何常规的文件设置为所有人可
位置建立日志的第二拷贝，或者将日志转发到另一台主机。配置文件默认情况下一般不是所
置了合适的权限。
还应该在磁盘和分区设备（例如/dev/hde*）上检查权限。确保任何日志轮转程序在文件上设
他可以读取的文件。
确保日志所有上级目录只能由特权用户写人。否则，攻击者可以重命名目录和文件，并创建
创建这个例子时，我们的测试脚本令人惊讶：
级的工具可以在更短的时间内完成。
试图修改这些文件的自动化rootkit使用默认的位置，无法完成这种攻击。rootkit是一组入侵
有些人建议将配置文件保存在另一个位置，这样日志所在位置就不会那么明显。而且，
如果有需要访问日志的用户，创建一个单独的组（例如“logs”）并为该组提供读权限。
除了对文件的直接访问之外，如果攻击者能够修改 syslog配置文件，他就可以在另一个
这种方法不完全准确，因为它可能发现任何类似日志消息的数据，包括删除的数据。在
2.传输中的机密性
为了避免这类攻击，需要验证日志文件及目录的权限已经严格限制在特权用户上。还要
Feb622:45:05 glen kernel:HiSax:Driver for Siemens chip set ISDN
这个例子在大的磁盘分区上需要花一些时间，但是攻击者通常有的是时间。而且，更高
显示的结果是ISDN配置教程中的日志消息示例，该教程随操作系统安装。
这正是在日志文件中看到的样子。
Sep507:29:051inuxkerne1:Loaded 23439symbo1sfrom/boot/System.
Sep 5 07:29:05 1inux kernel:Inspecting /boot/System.map-2.6.4-52-
Feb622:45:05g1enkerne1:HiSax:AVMdriverRev.1.6
Feb
Feb
Feb
Feb622:45:05g1en kernel:HiSax:Version2.1
cards
map-2.6.4-52-defau1t.
default
622:45:05 glen kernel:HiSax:Card1Protoco1 EDSS1 Id=HiSax（0)
622:45:05glen kernel:HiSax:Tota11card defined
622:45:05 glen kernel:HiSax:Revisions1.15/1.10/1.10/1.30/1.8
---
## Page 260
机常常会泄露流量。有些低端交换机并没有真的在所有端口上采用交换，端口组可能共享流
为 syslog 格式记录。
协议（UDP）数据包，并将其写人文件 syslogdump.dmp。要查看结果，再次使用tcpdump：
拦截网络流量并不像某些人想象的那么难。下面是用 tcpdump 嗅探 syslog 流量的一个简单
符串还能使tcpdump数据更加可读。而且，plog工具（在第6章中讨论过）将这些数据转换
例子：
流量的拦截问题，这取决于你自己的判断和风险分析。
志主机（私钥只需要在加密数据时使用，而不需要出现在解密的位置），从而缓解后一种攻击。
拦截加密密钥。使用公钥加密方法（如我们介绍的PGP示例），可以不将私钥保存在源或者日
crypt加密日志数据，也可以使用你喜欢的其他加密方法（Rot13总是个办法）。
就可以得到这一功能。我们在第3章中讨论了该RFC和客户端。syslog-ng允许用PGP或者
syslog可靠RFC提供日志数据流的加密，如果你使用支持该RFC的syslog客户端和服务器
量。而且，有些交换机可以通过使其MAC表溢出而变为Hub。
输
，流量还可以用sslwra、stunnel通过SSL隧道传输，或者使用一个SSH隧道。
现在，有些人会说“我们采用交换式网络，攻击者无法在网络上嗅探流量.”交换
注意，控制其中一个端口（源或者日志主机）的攻击者可以在日志数据加密前拦截，或者
这种方法在第5章中关于syslog-ng的小节里做了介绍。如果你使用基于TCP的日志传
缓解日志数据的网络拦截问题有各种不同方法，它们都基于传输中日志数据的加密
所以，不要依靠网络设备来保持数据机密性，它不是设计用于这一目的。
这不像查看日志文件那么容易，但是对于攻击者来说已经足够。我们在本章中介绍的字
0x0010 ac10 6e35 0202 0202002c a5c33c313839..n5.....,
结果如下：
-x-os dp.dp-oss-pd
上面这行命令收集来自172.16.90.128主机端口514（syslog端口）上的所有用户数据报
保护源上的数据机密性所涉及的所有问题都适用于日志主机。此外，由于日志主机一般
3.日志主机的机密性
0x003074617274757020737563636565646564tartup.succeeded
0x00203e7379736c6f 673a206b 6c6f 67642073>sys1og:.k1ogd.s
12:02:29.402842 anton.sys1og>anotherbox.sys1og:[udp sumok] udp 36
（tt1128,id47609.1en64)
UDPandport514
.<189
第17章对日志系统的攻击239
---
## Page 261
240
本文件pg_hba.conf。为了实现mysql示例中的相同访问控制，我们在pg_hba.conf中输人如
能查询数据，只能插入和修改数据。
只允许查询数据库，但是不能修改，只能从日志分析工作站上操作。注意，logwriter用户不
只允许读权限：
任何操作。你可能希望进一步限制权限，将修改的能力限制在日志主机上的用户，对其他人
用GRANT语句，为两种限制提供相同的机制：
到数据库服务器，然后从本地文件中将数据加载到数据库。
证级别。在数据库中存放日志的另一种方法是使用文件传输机制，从日志主机将数据“拉”
访问规则应该加以限制，使得只有授权用户能够查询数据。
限制在日志主机和用于日志分析的系统上。这些连接应该加密，以避免拦截。数据库用户的
数据库服务器之间传输的事务。