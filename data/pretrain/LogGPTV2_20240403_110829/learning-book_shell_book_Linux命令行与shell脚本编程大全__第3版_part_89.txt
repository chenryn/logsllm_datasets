天气脚本会连接到指定城市的Yahoo!天气页面，将Web页面保存到一个文件中，提取对应的
文本，删除临时文件，然后显示天气信息。这么做的好处在于，一旦你从网站上提取到了数据，
就可以随心所欲地处理它，比如创建一个温度表。可以创建一个每天运行的cron任务（参见第16
章）来跟踪当天的温度。
警告互联网无时不刻不在发生变化。如果你花费了几个小时找到了Web页面上数据的精确位
置，而几个星期后却发现数据已经不在了，脚本也没法工作了，不必感到惊讶。事实上，
很有可能上面这个例子在你阅读本书时已经无法工作了。重要的是要知道从Web页面提取
数据的过程。这样你就可以将原理运用到任何情形中。
25.3使用电子邮件
随着电子邮件的普及，现在几乎每个人都有一个邮件地址。正因如此，人们通常更期望通过
邮件接收数据而不是看文件或打印出的资料。在shell脚本编程中也是如此。如果你通过shel脚本
生成了报表，大多数情况下都要用电子邮件的形式将结果发送给他人。
可用来从shell脚本中发送电子邮件的主要工具是Mailx程序。不仅可以用它交互地读取和发
送消息，还可以用命令行参数指定如何发送消息。
说明在你安装包含Mailx程序的mailutils包之前，有些Linux发行版还会要求你安装邮件服务器
包（例如osendmail成,Postfix ）。
Mailx程序发送消息的命令行的格式为：
mai1[-eLinv]  [-a header [b addx][c addr [α subj]  toaGdx
25
mai1命令使用表25-2中列出的命令行参数。
表25-2Mailx命令行参数
数
描
述
-a
指定额外的SMTP头部行
-b
给消息增加个BCC:较件人
C
给消息增加一个CC收件人
如果消息为空，不要发送消息
-1
忽略TTY中断信号
---
## Page 577
562
第25章创建与数据库、Web及电子邮件相关的脚本
(续）
数
描
述
 I
强制Maikx以交互模式运行
-T.
不要读取/etc/mailLrc启动文件
指定一个主题行
-V
在终端上显示投递细节
正如表25-2中所示，你完全可以使用命令行参数来创建整个电子邮件消息。唯一需要添加的
就是消息正文。
要这么做的话，你需要将文本重定向给mai1命令。下面这个简单的例子演示了如何直接在
命令行上创建和发送电子邮件消息。
qta ,a6easau qsa. a- xtteu 1 ,aesaau qsaq e ag stq. oqoa $
Mailx程序将来自echo命令的文本作为消息正文发送。这提供了一个从shell脚本发送消息的
简单途径。下面是一个简单的例子。
$ cat factnail
1/bin/bssh
 mailing the anewer to a factorial
MAIL=$ (which mai 1x)
factorial=1
counter=1
read -p “Enter the nunber: * value
vhile [ $counter -le $value ]
do
factorial=$[$factoria] * $counter]
counter=$[Scounter + 1]
done
echo The factorial of $value is $factorial l $MAIl -s *Factorial
echo *The result has been sailed to you.*
answer* SUSER
这段脚本不会假定Mailx程序位于标准位置。它使用which命令来确定mail程序在哪里。
在计算出阶乘函数的结果后，shell脚本使用mai1命令将这个消息发送到用户自定义的sUSER
环境变量，这应该是运行这个脚本的人。
$ ./factmai1
Enter the number: 5
The result bas been mailed to you.
你只需要查看邮件，看看是否收到回信。
$nai1
*/var/nai1/rich*: 1 meeeage 1 mev
>  1 Rich Blun
Mon Sep 1 10:3213/586Factorial anever
---
## Page 578
25.3使用电子邮件
563
XOr1g1na1To: r1chgr1chParal1elaVirtua1Platforn
Retuxn-Path: 
Delivered7o: rich8rich-ParallelaV1rtualPlat.form
Recelved: By rlch-Parallele-Vixtual-Platfoxm (Poetfix, fron userld 1000)
1d B4A2A260081; Bon,  1 Sep 2014 10:32:24 -0500 (EST)
Subject: Factorial ansver
To: 
MessageId:
Haller: mai1 (GNU Xai1ut11s 2.1)
Date: Hon, 1 Sep 2014 10:32:24 0500 (EST)
Fron: rlchexichParallelaVixtual-Platform (Rlch Blun)
The factorial of 5 1a 120
在消息正文中只发送一行文本有时会不方便。通常，你需要将整个输出作为电子邮件消息发
送。这种情况总是可以将文本重定向到临时文件中，然后用cat命令将输出重定向给mail程序。
下面是一个在电子邮件消息中发送大量数据的例子。
$ cat dlakma11
#1/bin/bash
# sending the current dlsk statistics in an enail nessage
date=S (Gate +fm/8d/$Y)
MAIL=$ (vhich ma 11x)
TEHP= (nktenp tmp X)
cat STEHP I SMAIL -s *Diak stata for $&ate* $1
df -k > STENP
rn f STENP
diskmail程序用date命令（采用了特殊格式）得到了当前日期，找到Mailx程序的位置后创建
了一个临时文件。接着用af命令显示了当前磁盘空间的统计信息（参见第4章），并将输出重定向
到了那个临时文件。
然后它使用第一个命令行参数作为目的地地址，使用当前日期作为邮件主题，将临时文件重
定向到mai1命令。在运行这个脚本时，你不会看到任何命令行输出。
$/dialknal1rich
25
但如果你检查邮件，你就会看到发出的消息。
/var/nal1/r1ch*: 1 message 1 nev
S nai1
>N
1 Rich B1um
Hon Sep 1 10:35 19/1020  Diak atata for 09/01/2014
Return-Path: 
XMai1er: ma1l(GNU Ma11ut11a 2 .1)
MeasageId: 
Date: Mon, 1 Sep 2014 10:35:39 0500 (EST)
From: rich8rich=Parallelg=VlrtualPlatforn (R1ch B1um)
F1lesysten
1Kblocks
Used Avallable Use& Mounted on
/dev/αda1
63315876
2595552
507052
228
57504044
506824
58 /
none
18/dev
none
512648
1.92
100
512456
18_/vax/run
18/dev/ahn
none
512648
512548
none
4294967296
512648
0
04294967296
512648
08/vax/1ock
none
？
08 /medLa/pαf
现在你要做的是用cron功能安排每天运行该脚本，这样就可以将磁盘空间报告自动发送到你
的收件箱了。系统管理再没比这个更简单的了！
25.4小结
本章讲解了一些高级功能在脚本中的用法。首先讨论了如何使用MySQL服务器存储应用程
序的持久性数据。这只需要为应用程序创建一个数据库和一个唯一的用户账户，然后只给用户赋
予该数据库的权限就可以了。你可以创建数据表来存储应用程序数据。shell脚本使用mysql命令
行工具作为MySQL服务器的接口，提交SELECT查询，显示检索结果。接着，讨论了如何使用基
于文本的浏览器1ynx从互联网上的网站中提取数据。1ynx工具能够转储Web页面的全部文本，
你可以使用标准的shel编程技巧存储这些数据，并从中查找所需要的内容。最后，介绍了如何使
用标准的Mailx程序通过Linux电子邮件服务器发送报表。Mailx程序可以让你轻松地将命令输出发
送到任一电子邮件地址。
在接下来的最后一章中，我们会再介绍一些shell脚本的例子，向你展示shel脚本编程的威力。
---
## Page 580
第26章
些小有意思的脚本
本章内容
口发送消息
口获取灵感
口发送文本
习编写shell脚本的主要原因在于能够创建自己的Linux系统实用工具。明白如何编写有
子实用价值的脚本工具很重要。但有时候寓教于乐也是不错的选择。本章中出现的脚本
未必实用，但都充满了趣味！这同时也有助于巩固你的脚本编写知识。
26.1
发送消息
无论是在办公室还是在家里，发送消息的方法有很多：短信、电子邮件，甚至打电话。有种
不常用的方法是将消息直接发送到同伴系统的用户终端上。因为这种方法并不广为人知，所以用
它和别人来交流一定很好玩。
这个shell脚本工具能够帮你简单快速地向你的Linux系统登录用户发送消息。这个脚本简单
至极，也乐趣满满。
26.1.1功能分析
对于这种简单的脚本，需要的功能不多。涉及的一些命令很常见，本书也讲过。不过有几个
命令我们只接触过皮毛，你可能还不太熟悉。本节会讲解编写这个简单有趣的脚本所需的命令。
1.确定系统中都有谁
要用到的第一个工具就是who命令。该命令可以告诉你当前系统中所有的登录用户。
26
$who
christine tty2
2015-09-10 11:46
2 015  0 9 1.0 11 : 4.3
tinothy
[- - . ]
发送消息所需要的所有信息都可以在这部分输出的信息列表中找到。who命令默认给出的是
---
## Page 581
566
第26章一些小有意思的脚本
可用信息的简略版本。这些信息包括：
口用户名
口用户所在终端
口用户登入系统的时间
如果要发送消息，只需使用前两项信息。用户名和用户当前终端是必须要用到的。
2.启用消息功能
用户可以禁止他人使用mesg工具向自已发送消息。因此你在打算发送消息前，最好先检查一
下是否允许发送消息。这只需要输人命令mesg就行了。
$nesg
1.5 I
结果中显示的isn表明消息发送功能被关闭了。如果结果是y，表明允许发送消息。
窍门有些发行版（如Ubuntu）默认关闭了消息发遥功炭。而对于其他发行版（如orCentOS），消
息发递功能跌认是开启的。因此在发递消息前，你需要检查一下所使用发行版的具体设
置以及其他用户的消息状态。
要查看别人的消息状态，还可以使用who命令。记住，这只检查当前已登入用户的消息状态。
使用who命令的-T选项：
S vho -f
chrlatine - tty2
2015-0910 12:56
tinothy
 - tty3
2015-0910 11:46
[.-.]
用户名后面的破折号（-）表示这些用户的消息功能已经关闭。如果启用的话，你看到的会
是加号（+)。
如果要接收消息，你需要使用mesg命令的y选项。
Swhoaml
chrlatine
5 nesg Y
S nesg
当发出mesgy命令后，用户christine的消息功能就启用了。可以使用mesg命令来检查用户的
消息状态。毫无疑问，命令的结果是isy，这说明该用户已经可以接收消息。
其他用户使用who命令可以看到用户christine已经改变了她的消息状态。现在消息状态已经变
成了加号，表明她可以接收他人的消息了。
---
## Page 582
26.1发送消息
567
S who -
chrlstine + tty2
tinothy
20150910 12:56
ε -
20150910 11:46
[. ..]
要想进行双向通信，其他用户也必须启用消息功能。在这个例子中，用户timothy也启用了他
的消息功能。
S who -
tlsothy
20150910 12:56
 +tty3
20150910 11:46
[ . . - ] 
现在，消息功能至少在两名用户之间启用了，你可以试试用命令发送消息。不过who命令还
用得上，因为它能够提供消息发送的必需信息。
3.向其他用户发送消息
我们的脚本用到的主要工具是write命令。只要消息功能启用，就可以使用write命令通过
其他登录用户的用户名和当前终端向其发送消息。
说明你只能使用write命令向登录到虚拟控制台终端（参见第2章）的用户成功发送消息。登
入图形化环境的用户是无法接收到消息的。
在下面的例子中，用户christine向登录在终端tty3上的用户timothy发送了一条消息。在
christine的终端上，会话过程看起来如下。
$ who
christine tty2
201509-10 13:54
timotbytty3
2015-09-10 11:46
[...]