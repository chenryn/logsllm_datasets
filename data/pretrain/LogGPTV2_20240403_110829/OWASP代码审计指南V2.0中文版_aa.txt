1 
OWASP 代码审计指南
V2.0 中文版 
注：本指南版权归 OWASP Foundation 所有。由刘传兴、孙维康翻译，仅供业内人士学习参考。 
2 
目 录 
1 介绍 ......................................................................................................................................................... 10 
1.1 前言 ................................................................................................................................................ 10 
1.2 介绍 ................................................................................................................................................ 11 
1.2.1 主要内容 ............................................................................................................................... 11 
1.3 如何使用本文档 .......................................................................................................................... 11 
2 相关技术和方法 .................................................................................................................................. 13 
2.1 代码安全审计 .............................................................................................................................. 13 
2.1.1 代码审计技术参考 ............................................................................................................. 13 
2.1.2 为什么代码有漏洞？ ........................................................................................................ 14 
2.1.3 什么是代码安全审计？ ................................................................................................... 16 
2.1.4 代码审计和代码安全审计的区别是什么？ ............................................................... 17 
2.1.5 确定安全源代码审计的规模？ ...................................................................................... 17 
2.1.6 我们无法保证自己的安全 ............................................................................................... 20 
2.1.7 耦合源代码审计和渗透测试 .......................................................................................... 22 
2.1.8 代码审计对开发实践的潜在优势 ................................................................................. 24 
2.1.9 代码安全审计技术方面 ................................................................................................... 27 
2.1.10 代码审计和合规............................................................................................................... 28 
3 
2.1.11 与代码审计相关的 PCI-DSS 要求 ............................................................................ 29 
2.2 方法 ................................................................................................................................................ 30 
2.2.1 开发代码审计流程时要考虑的因素............................................................................. 30 
2.2.2 在软件开发生命周期中整合代码审计 ........................................................................ 32 
2.2.3 何时进行代码审计 ............................................................................................................. 34 
2.2.4 敏捷和瀑布开发的代码安全审计 ................................................................................. 37 
2.2.5 基于风险的代码审计方法 ............................................................................................... 37 
2.2.6 代码审计准备 ...................................................................................................................... 40 
2.2.7 代码审计发现和收集信息 ............................................................................................... 43 
2.2.8 静态代码分析 ...................................................................................................................... 47 
2.2.9 应用威胁建模 ...................................................................................................................... 49 
2.2.10 指标和代码审计............................................................................................................... 60 
2.2.11 爬行代码 ............................................................................................................................ 65 
3 安全代码审计技术参考 .................................................................................................................... 66 
3.1 A1 注入漏洞 ................................................................................................................................ 66 
3.1.1 概述什么是注入 ................................................................................................................. 66 
3.1.2 SQL 注入 ............................................................................................................................... 67 
3.1.3 JSON (JavaScript 对象符号) ......................................................................................... 78 
3.1.4 内容安全策略 ...................................................................................................................... 79 
4 
3.1.5 输入验证 ............................................................................................................................... 84 
3.2 A2 身份验证和会话管理中断 ................................................................................................ 89 
3.2.1 概述 ........................................................................................................................................ 89 
3.2.2 身份验证的作用 ................................................................................................................. 89 
3.2.3 审计什么 ............................................................................................................................... 90 
3.2.4 忘记密码 ............................................................................................................................... 93 
3.2.5 验证码 .................................................................................................................................... 94 
3.2.6 带外通信 ............................................................................................................................... 96 
3.2.7 会话管理 ............................................................................................................................. 100 
3.3 A3 跨站点脚本注入（XSS） ............................................................................................... 107 
3.3.1 概述 ...................................................................................................................................... 107 
3.3.2 超文本标记语言属性编码 ............................................................................................. 111 
3.4 A4 不安全直接对象参考 ....................................................................................................... 117 
3.4.1 概述 ...................................................................................................................................... 117 
3.4.2 描述 ...................................................................................................................................... 117 
3.5 A5 安全配置错误 ..................................................................................................................... 122 
3.5.1 Apache Struts .................................................................................................................. 123 
3.5.2 Java 企业版配置声明方式 ............................................................................................. 125 
3.5.3 JEE 注解 ............................................................................................................................... 130 
5 
3.5.4 应用服务器特定配置 ...................................................................................................... 131 
3.5.5 方案配置:J2EE .................................................................................................................. 135 
3.5.6 微软 IIS ................................................................................................................................ 138 
3.5.7 框架特定配置:微软 IIS ................................................................................................... 140 
3.5.8 编程配置:微软 IIS ............................................................................................................ 145 
3.5.9 IIS 配置过滤请求和网址重写 ....................................................................................... 146 
3.5.10 应用程序签名 ................................................................................................................. 159 
3.5.11 反编译 ............................................................................................................................... 164 
3.5.12 .NET 身份验证控件 ....................................................................................................... 169 
3.6 A6 敏感数据泄露 ..................................................................................................................... 176 
3.6.1 加密控制 ............................................................................................................................. 176 
3.6.2 描述 ...................................................................................................................................... 177 
3.6.3 审计内容:传输中的保护 ................................................................................................ 179 
3.6.4 审计内容:静态保护.......................................................................................................... 183 
3.6.5 加密、散列和加盐 ........................................................................................................... 191 
3.6.6 减小攻击面 ........................................................................................................................ 197 
3.7 A7 缺失功能级别访问控制................................................................................................... 201 
3.7.1 授权 ...................................................................................................................................... 201 
3.7.2 描述 ...................................................................................................................................... 202 
6 
3.7.3 审计什么 ............................................................................................................................. 204 
3.8 A8 跨站点请求伪造（CSRF） ............................................................................................ 207 
3.8.1 描述 ...................................................................................................................................... 207 
3.8.2 预防 CSRF .......................................................................................................................... 211 
3.8.3 没有跨站点脚本(XSS)漏洞 ........................................................................................... 217 
3.9 A9 使用已知漏洞的组件 ....................................................................................................... 218 
3.9.1 描述 ...................................................................................................................................... 218 
3.9.2 审计什么 ............................................................................................................................. 218 
3.10 A10 未验证的重定向和转发 ............................................................................................. 220 
3.10.1 描述 ................................................................................................................................... 221 
3.10.2 审计什么 .......................................................................................................................... 223 
3.10.3 参考 ................................................................................................................................... 225 
4 其它方面 .............................................................................................................................................. 226 
4.1 HTML5 ......................................................................................................................................... 226 
4.1.1 描述 ...................................................................................................................................... 226 
4.1.2 审计什么:网络信息.......................................................................................................... 227 
4.1.3 审计什么:跨域资源共享 ................................................................................................ 228 
4.1.4 审计什么:网络套接字 ..................................................................................................... 229 
4.1.5 审计什么:服务器发送的事件 ....................................................................................... 231 
7 
4.2 同源策略（Same Origin Policy） ................................................................................... 232 
4.2.1 描述 ...................................................................................................................................... 232 
4.2.2 审计什么 ............................................................................................................................. 233 
4.3 审计日志代码 ............................................................................................................................ 234 
4.3.1 描述 ...................................................................................................................................... 234 
4.3.2 审计什么 ............................................................................................................................. 235 
4.3.3 参考 ...................................................................................................................................... 238 
4.4 错误处理 ..................................................................................................................................... 238 
4.4.1 描述 ...................................................................................................................................... 239 
4.4.2 审计什么 ............................................................................................................................. 241 
4.4.3 参考 ...................................................................................................................................... 256 
4.5 审计安全告警 ............................................................................................................................ 256 
4.5.1 描述 ...................................................................................................................................... 257 
4.5.2 审计什么 ............................................................................................................................. 260 
4.6 审计主动防御 ............................................................................................................................ 261 
4.6.1 描述 ...................................................................................................................................... 262 
4.6.2 审计什么 ............................................................................................................................. 262 
4.6.3 参考 ...................................................................................................................................... 265 
4.7 竞争条件 ..................................................................................................................................... 265 
8 
4.7.1 描述 ...................................................................................................................................... 265 
4.7.2 审计什么 ............................................................................................................................. 266 
4.7.3 参考 ...................................................................................................................................... 267 
4.8 缓冲区溢出 ................................................................................................................................. 268 
4.8.1 24.1 描述 ............................................................................................................................. 268 
4.8.2 审计什么:缓冲区溢出 ..................................................................................................... 269 
4.8.3 审计什么:格式化函数溢出 ............................................................................................ 272 
4.8.4 审计什么:整数溢出.......................................................................................................... 273 
4.8.5 参考 ...................................................................................................................................... 276 
4.9 客户端 JavaScript ................................................................................................................... 276 
4.9.1 描述 ...................................................................................................................................... 276 
4.9.2 其他示例和潜在的安全风险 ........................................................................................ 278 
4.9.3 参考: ..................................................................................................................................... 280 
5 附录 ....................................................................................................................................................... 280 
5.1 代码审计的 Do’s 和 Dont’s .......................................................................................... 280 
5.2 敏捷软件开发生命周期 .......................................................................................................... 282 
5.2.1 持续集成和测试驱动开发 ............................................................................................. 283 
5.2.2 分解过程区域 .................................................................................................................... 284 
5.3 代码审计 Checklist ................................................................................................................. 285 
9 
5.4 威胁模型示例 ............................................................................................................................ 292 
5.5 代码爬行 ..................................................................................................................................... 298 
5.5.1 在.NET 中搜索代码 ......................................................................................................... 298 
5.5.2 在 Java 中搜索代码 ........................................................................................................ 306 
5.5.3 在经典 ASP 中搜索代码 ................................................................................................ 311 
5.5.4 在 C++和 Apache 中搜索代码.................................................................................. 314 
5.5.5 超文本标记语言 ............................................................................................................... 316 
10 
1 介绍 
1.1 前言 
OWASP代码审计指南刚开始包含在OWASP Testing Guide 中，比较符合的发展状况。
但随着代码审计的不断发展，逐渐形成了独有的规范标准。我在 2006 年开始代码审计指南
的编写项目。当前版本于 2013 年 4 月重新启动，并获得美国国土安全部的资助。 
OWASP 代码审计团队由一群有才华的志愿者组成，他们在全球各类型的企业或组织中
开展代码审计工作，从小型初创公司到全球大型的软件开发企业。 
众所周知，当在系统开发生命周期的早期阶段检测到安全问题时，修复成本更低。从安
全角度看，把代码审计与 SDLC 整合有利于产出高质量代码。系统本身安全是抵御攻击者的
最佳方法。攻击者找系统漏洞的时间比防御者多。攻防是一场不公平、不对称的对抗。 
本指南没有涵盖所有的编程语言，主要集中在 C#、.NET 和 Java，可能也会包括 C、
C++、PHP 等。但指南中提到的技术基本能够适配任何代码环境。幸运也是不幸的一点是，
web 应用中的安全缺陷在不同的编程语言中非常一致。 
—— Eoin Keary，OWASP 董事会成员，2013 年 4 月 19 日
11 
1.2 介绍 
欢迎使用第二版的 OWASP 代码审计指南。第二版更新了最新的威胁和应对措施，也
加入了 OWASP 成员在代码审计方面积累的经验和最佳实践。 
1.2.1 主要内容 
《代码审计指南》第二版旨在为软件开发人员和管理人员提供代码安全审计的最佳实践
和建议，以及如何在软件安全开发生命周期中使用该指南。该指南首先介绍了如何进行代码
安全审计，如何将其引入公司的 S-SDLC，并根据具体的技术，给出审计人员应该寻找什么
的代码示例。具体而言，该指南涵盖: 
概述 
如何进行代码安全审计及优势等。它概述了安全代码审计技术，并将代码审计与其它源
码分析技术比较。 
方法论 
方法论部分更详细地介绍了如何将安全审计技术整合到开发组织的软件开发生命周期
中，以及审计代码的人员如何确保他们有正确的上下文进行有效审计。主题包括将基于风险
的安全代码审计，通过威胁建模来了解正在审计的应用程序，以及了解外部业务驱动因素如
何影响对代码安全审计的需求。 
1.3 如何使用本文档 
这本指南的内容和结构都经过精心设计。此外，所有贡献的章节都经过精心编辑，并整
合到一个统一的框架中，提供了统一的结构和风格。 
12 
本指南内容从三种不同的视角展开。 
1. 管理团队希望了解为什么需要代码审计，以及为什么在为当今组织开发安全企业软
件的最佳实践中包括代码审计。高级管理人员应该至少阅读本指南的第一节和第二节。如果
进行安全编码将成为组织软件开发生命周期的一部分，那么，管理层需要考虑以下事项: 
⚫ 
组织项目评估是否为代码审计分配时间？ 
⚫ 
管理层是否有能力跟踪每个项目和程序员的代码审计和静态分析的相关指标？ 
⚫ 
管理层需要决定在项目生命周期中什么时候应该进行代码审计，以及对现有项目的哪些
变更需要在审计之前完成代码审计。 
2.软件负责人希望在代码审计中向同行提供有足够经验的反馈，以帮助他们的组织创建
安全的企业软件。他们应该考虑: 
⚫ 
作为一名同行代码审计员，要使用这本书，你首先要决定你想完成的代码审计类型。让
我们花几分钟时间来复习每一种类型的代码，以帮助决定这本书如何对您有所帮助。 
⚫ 
应用编程接口/设计代码审计。使用这本书来理解架构设计如何导致安全漏洞。此外，
如果应用编程接口是第三方应用编程接口，代码中有哪些安全控制来防止安全漏洞。 
⚫ 
可维护性代码审计。这些类型的代码审计更倾向于组织内部的最佳编码实践。这本书确
实涵盖了代码度量，这可以帮助代码审计者更好地理解如果一段代码过于复杂，应该查
看哪些代码的安全漏洞。 
⚫ 