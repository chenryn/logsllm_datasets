### 使用支持只读快照的文件系统作为备份介质
如果你使用可重复写入的介质作为备份介质，推荐使用支持只读快照的文件系统，如 Btrfs 或 ZFS。这可以确保数据的一致性和完整性。

### 10.1.7 可移动存储设备
可移动存储设备包括但不限于以下几种：
- USB 闪存盘
- 硬盘驱动器
- 光盘驱动器
- 数码相机
- 数字音乐播放器

这些设备可以通过多种方式进行连接：
- USB
- IEEE1394/FireWire
- PC 卡

现代桌面环境（如 GNOME 和 KDE）能够在 `/etc/fstab` 文件中没有匹配条目的情况下自动挂载这些可移动设备。
- `udisks2` 包提供了守护进程和相关实用程序来挂载和卸载这些设备。
- D-Bus 创建事件以触发自动处理。
- PolicyKit 提供所需的权限。

**提示：**
- 在自动挂载设备时，`umount(8)` 可能会带有 `uhelper=` 参数。
- 只有当这些可移动设备未在 `/etc/fstab` 文件中列出时，桌面环境才会自动挂载它们。
- 现代桌面环境下的挂载点通常为 `/media/username/disk_label`，可以通过以下方式自定义：
  - FAT 格式的文件系统使用 `mlabel(1)` 命令
  - ISO9660 文件系统使用带有 `-V` 选项的 `genisoimage(1)` 命令
  - ext2/ext3/ext4 文件系统使用带有 `-L` 选项的 `tune2fs(1)` 命令
- 挂载时可能需要提供编码选项（参见第 8.1.3 节）。
- 通过图形界面菜单移除文件系统可能会删除其动态设备节点（如 `/dev/sdc`）。如果要保留设备节点，请使用命令行中的 `umount(8)` 命令进行卸载。

### 10.1.8 选择用于分享数据的文件系统
当你通过可移动存储设备与其他系统共享数据时，应选择两种操作系统都支持的通用文件系统。以下是常用文件系统的列表：

**提示：**
- 查看第 9.9.1 节了解关于使用设备级加密的跨平台数据共享信息。

| 文件系统 | 典型使用场景 |
|----------|--------------|
| FAT12    | 软盘（<32MiB）上的跨平台数据共享 |
| FAT16    | 小硬盘（<2GiB）上的跨平台数据共享 |
| FAT32    | 大硬盘（<8TiB，MS Windows 95 OSR2 及以上支持）上的跨平台数据共享 |
| exFAT    | 大硬盘（<512TiB，Windows XP, MacOS X Snow Leopard 10.6.5 和 Linux 内核 5.4 及以上支持）上的跨平台数据共享 |
| NTFS     | 大硬盘类设备上的跨平台数据共享（MS Windows NT 及后续版本原生支持；Linux 上通过 FUSE 的 NTFS-3G 支持） |
| ISO9660  | CD-R 和 DVD+/-R 上的跨平台静态数据共享 |
| UDF      | CD-R 和 DVD+/-R（新）上的增量数据写入 |
| MINIX    | 软盘上磁盘空间高利用率的 Unix 文件数据存储 |
| ext2     | 装有老旧 Linux 系统的硬盘上的数据共享 |
| ext3     | 装有老旧 Linux 系统的硬盘上的数据共享 |
| ext4     | 装有较新 Linux 系统的硬盘上的数据共享 |
| Btrfs    | 使用只读快照在装有较新 Linux 系统的硬盘上共享数据 |

**安全注意事项：**
- 使用 `tar(1)` 或 `cpio(1)` 命令压缩文件，以保留文件名、符号链接、原始文件权限和所有者信息。
- 使用 `split(1)` 命令将压缩文件分割成若干小于 2GiB 的小文件，以避免文件大小限制。
- 加密压缩文件以保护内容免受未经授权的访问。

**注意：**
- FAT 文件系统的设计最大文件大小为 (2^32 - 1) bytes = (4GiB - 1 byte)。对于一些老旧的 32 位系统上的应用程序而言，最大文件大小甚至更小 (2^31 - 1) bytes = (2GiB - 1 byte)。Debian 不会遇到后者的问题。
- 微软不建议在超过 200MB 的分区或驱动器上使用 FAT。他们的文档《Overview of FAT, HPFS, and NTFS File Systems》强调了 FAT 文件系统的一些缺点，例如低效的磁盘空间利用。在 Linux 系统上，建议使用 ext4 文件系统。

**提示：**
- 有关文件系统和访问文件系统的更多信息，请参考“Filesystems HOWTO”。

### 10.1.9 网络上的数据共享
当通过网络共享数据时，应使用通用的服务。以下是一些提示：

尽管通过网络挂载文件系统和传输文件非常方便，但可能存在安全隐患。网络连接必须通过以下方式加强安全性：
- SSL/TLS 加密
- SSH 隧道
- VPN 隧道
- 安全的防火墙

**参考：**
- 第 6.5 节和第 6.6 节

| 网络服务 | 典型使用场景描述 |
|----------|------------------|
| SMB/CIFS | 通过 Samba 挂载网络文件系统（参见 `smb.conf(5)` 和官方 Samba 3.x.x HOWTO 和参考手册或 `samba-doc` 软件包） |
| NFS      | 通过 Linux 内核挂载网络文件系统（参见 `exports(5)` 和 Linux NFS HOWTO） |
| HTTP     | 在 Web 服务器/客户端之间共享文件 |
| HTTPS    | 在有加密的安全套接层 (SSL) 或安全传输层 (TLS) 的网络服务器/客户端之间共享文件 |
| FTP      | 在 FTP 服务器/客户端之间共享文件 |

### 10.2 备份和恢复
计算机有时会出现问题，或者由于人为错误导致系统和数据损坏。备份和恢复操作是成功系统管理的重要组成部分。可能有一天你的电脑就会出问题。

**提示：**
- 保持备份系统简洁并定期备份。拥有备份数据比采用先进的备份方法更为重要。

### 10.2.1 备份和恢复策略
实际的备份和恢复策略由以下三个关键因素决定：

1. **知道要备份和恢复什么：**
   - 用户创建的数据文件：`~/` 目录下的数据
   - 应用程序创建的数据文件：`/var/` 目录下的数据（除了 `/var/cache/`、`/var/run/` 和 `/var/tmp/`）
   - 系统配置文件：`/etc/` 目录下的数据
   - 本地程序：`/usr/local/` 或 `/opt/` 目录下的数据
   - 系统安装信息：关键步骤（如分区等）的纯文本备忘录
   - 验证数据结果：通过实验性恢复操作预先验证
     - 用户进程的 Cron 作业：文件在 `/var/spool/cron/crontabs` 目录，并重启 `cron(8)`。参见第 9.4.14 节获取关于 `cron(8)` 和 `crontab(1)` 的信息。
     - 用户进程的 Systemd 计时器作业：文件在 `~/.config/systemd/user` 目录。参见 `systemd.timer(5)` 和 `systemd.service(5)`。
     - 用户进程的自动启动作业：文件在 `~/.config/autostart` 目录。参见 Desktop Application Autostart Specification。

2. **知道如何备份和恢复：**
   - 安全的数据存储：防止覆盖和系统故障
   - 定期备份：计划性的备份
   - 冗余备份：数据镜像
   - 简单操作：单个简单命令备份

3. **评估涉及的风险和成本：**
   - 数据丢失的风险
     - 数据至少应存储在不同的磁盘分区上，最好是在不同的磁盘和机器上，以抵御文件系统损坏。重要数据最好存储在一个只读文件系统上。
   - 数据非法访问的风险
     - 敏感身份数据（如 `/etc/ssh/ssh_host_*_key`、`~/.gnupg/*`、`~/.ssh/*`、`~/.local/share/keyrings/*`、`/etc/passwd`、`/etc/shadow`、`popularity-contest.conf`、`/etc/ppp/pap-secrets` 和 `/etc/exim4/passwd.client`）应使用加密备份（参见第 9.9 节）。
     - 即使在可信系统上，也不应在任何脚本中硬编码系统登录密码或加密密码（参见第 10.3.6 节）。
   - 数据丢失的方式及其可能性
     - 硬件（特别是硬盘）可能会损坏
     - 文件系统可能会损坏，导致数据丢失
     - 对于违规安全访问，远程存储系统不可信
     - 弱密码保护容易被破解
     - 文件权限系统可能被破解
   - 备份所需资源：人力、硬件、软件等
     - 使用 cron 任务或 Systemd 计时器任务自动化调度备份工作

**注意：**
- 除非你知道自己在做什么，否则不要备份 `/proc`、`/sys`、`/tmp` 和 `/run` 目录下的伪文件系统（参见第 1.2.12 节和第 1.2.13 节）。它们包含大量无用的数据。
- 在备份数据时，可能希望停止一些应用程序的守护进程，如 MTA（参见第 6.2.4 节）。

### 10.2.2 实用备份套件
以下是 Debian 系统上值得注意的实用备份程序套件列表：

- **MondoRescue**：一个备份系统，可以从备份 CD/DVD 等设备中快速恢复整个系统，而无需经过常规的系统安装过程。
- **Bacula**、**Amanda** 和 **BackupPC**：全功能备份实用套件，主要用于联网的定期备份。
- **定期备份用户数据**：可以通过简单的脚本实现（参见第 10.2.3 节）。

第 10.1.1 节和第 10.1.2 节描述的基础工具可以通过自定义脚本来帮助系统备份。这些脚本的功能可以通过以下工具增强：
- **restic** 软件包：增量备份（远程）
- **rdiff-backup** 软件包：增量备份（远程）
- **dump** 软件包：高效增量归档和恢复整个文件系统

**提示：**
- 参见 `/usr/share/doc/dump/` 和 "Is dump really deprecated?" 了解更多关于 `dump` 程序的信息。

**注释：**
- 一次性写入介质（如 CD/DVD-R）可以防止覆盖事故。GNOME 桌面环境允许你通过菜单轻松地进行写入操作：“位置 → CD/DVD 刻录”。
- 这些数据中的一些无法通过在系统中输入相同的字符串重新生成。