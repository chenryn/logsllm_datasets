如果你在使用一个可重复写入的介质作为你的备份介质，使用支持只读快照的 btrfs或 zfs文件系统，也许是一个
好注意。
10.1.7 可移动存储设备
可移动存储设备可能是以下的任何一种。
• USB闪存盘
• 硬盘驱动器
• 光盘驱动器
• 数码相机
• 数字音乐播放器
它们可以通过以下的方式来进行连接。
• USB
• IEEE1394/FireWire
• PC卡
像GNOME和KDE这样的现代桌面环境能够在”/etc/fstab”文件中没有匹配条目的时候，自动挂载这些可移动设
备。
Debian参考手册 183/233
• udisks2包提供了守护进程和相关的实用程序来挂载和卸载这些设备。
• D-bus创建事件来触发自动处理。
• PolicyKit提供了所需的特权。
提示
umount(8)在自动挂载设备的时候可能会带有”uhelper=”参数。
提示
只有当这些可移动设备没有在”/etc/fstab”文件中列出时，桌面环境下才会自动挂载。
现代桌面环境下的挂载点被选为”/media/username/disk_label”，它可以被如下所示的来定制。
• FAT格式的文件系统使用mlabel(1)命令
• ISO9660文件系统使用带有”-V”选项的genisoimage(1)命令
• ext2/ext3/ext4文件系统使用带有”-L”选项的tune2fs(1)命令
提示
挂载时可能需要提供编码选项（参见第 8.1.3 节）。
提示
在图形界面菜单上移除文件系统，可能会移除它的动态设备节点例如”/dev/sdc”。如果你想要保留它的设备节点，
你应该在命令行提示符上输入umount(8)命令来卸载它。
10.1.8 选择用于分享数据的文件系统
当你通过可移动存储设备与其他系统分享数据的时候，你应该先把它格式化为被两种操作系统都支持的通用的文件系
统。下面是文件系统的列表。
提示
查看第 9.9.1 节来获得关于使用设备级加密的跨平台的数据共享的信息。
FAT文件系统被绝大多数的现代操作系统支持，它对于通过可移动硬盘进行的数据交换是非常有用的。
当格式化像装有FAT文件系统的跨平台数据共享的可移动设备时，以下应该是保险的选择。
• 用fdisk(8)，cfdisk(8)或者parted(8)命令（参见第 9.6.2 节）把它们格式化为单个的主分区并对把它做如下
标记。
– 标记小于2GB的FAT设备为字符”6”。
– 标记更大的FAT32设备为字符”c”。
• 如下所示是用mkfs.vfat(8)命令格式化主分区的。
– 它的设备名字，例如”/dev/sda1”用于FAT16设备
– 明确的选项和它的设备名，例如”-F 32 /dev/sda1”用于FAT32设备
Debian参考手册 184/233
文件系统名 典型使用场景
FAT12 软盘（<32MiB）上跨平台的数据分享
FAT16 在小硬盘(<2GiB)上的跨平台的数据分享
在大硬盘（<8TiB，被MSWindows95OSR2以上的操作系统所支持)上的跨平台的数据
FAT32
分享
在大硬盘类设备上跨平台共享数据（<512TiB，被WindowsXP,MacOSXSnowLeopard
exFAT
10.6.5和Linux内核5.4版本以上的操作系统所支持)
在大硬盘类设备上的跨平台共享数据(在MSWindowsNT和后续版本原生支持；在
NTFS
Linux上，通过使用FUSE的NTFS-3G支持。)
ISO9660 在CD-R和DVD+/-R上的跨平台的静态数据分享
UDF CD-R和DVD+/-R(新)上的增量数据写入
MINIX 软盘上磁盘空间高利用率的unix文件数据存储
ext2 在装有老旧linux系统的硬盘上的数据分享
ext3 在装有老旧linux系统的硬盘上的数据分享
ext4 在装有较新的linux系统的硬盘上的数据分享
btrfs 使用只读快照在装有较新的Linux系统的硬盘上共享数据
Table10.3: 典型使用场景下可移动存储设备可选择的文件系统列表
当使用FAT或ISO9660文件系统分享数据时，如下是需要注意的安全事项。
• 用tar(1)，或 cpio(1)命令压缩文件，目地是为了保留文件名，符号链接，原始的文件权限和文件所有者信息。
• 用split(1)命令把压缩文件分解成若干小于2GiB的小文件，使其免受文件大小限制。
• 加密压缩文件保护其内容免受未经授权的访问。
注意
因为FAT文件系统的设计，最大的文件大小为(2^32 - 1) bytes = (4GiB -1 byte)。对于一些老旧的32
位系统上的应用程序而言，最大的文件大小甚至更小 (2^31 -1) bytes = (2GiB -1 byte)。Debian没有遇
到后者的问题。
注意
微软系统本身并不建议在超过200MB的分区或者驱动器上使用FAT。他们的”OverviewofFAT,HPFS,andNTFS
FileSystems这篇文章突出显示了微软系统的缺点，例如低效的磁盘空间利用。当然了，我们在Linux系统上还是
应该使用ext4文件系统。
提示
有关文件系统和访问文件系统的更多信息，请参考”FilesystemsHOWTO”。
10.1.9 网络上的数据分享
当使用网络来分享数据的时候，你应该使用通用的服务。这里有一些提示。
尽管对于文件分享来说，通过网络挂载文件系统和传输文件是相当方便的，但这可能是不安全的。它们的网络连接必
须通过如下所示的加强安全性。
• 用SSL/TLS加密
• 建立SSH通道
• 建立VPN通道
• 网络之间需要有安全的防火墙
参见第 6.5 节和第 6.6 节。
Debian参考手册 185/233
网络服务 典型使用场景描述
通过“MicrosoftWindows网络”分享文件，参见smb.conf(5)和
SMB/CIFS用Samba挂载网络文件系统 官方Samba3.x.x指导和参考手册（TheOfficialSamba3.x.x
HOWTOandReferenceGuide）或samba-doc软件包
通过“Unix/Linux网络”分享文件，参见exports(5)和Linux
NFS用Linux内核挂载网络文件系统
NFS-HOWTO
HTTP服务 在web服务器/客户端之间分享文件
在有加密的安全套接层(SSL)或者安全传输层(TLS)的网络服务
HTTPS服务
器/客户端中分享文件
FTP服务 在FTP服务器/客户端之间分享文件
Table10.4: 典型使用场景下可选择的网络服务列表
10.2 备份和恢复
我们都熟知计算机有时会出问题，或者由于人为的错误导致系统和数据损坏。备份和恢复操作是成功的系统管理中非
常重要的一部分。可能有一天你的电脑就会出问题。
提示
保持你的备份系统简洁并且经常备份你的系统，有备份数据比你采用的备份方法的技术先进要重要的多。
10.2.1 备份和恢复策略
有3个关键的因素决定实际的备份和恢复策略。
1. 知道要备份和恢复什么。
• 你自己创建的数据文件：在”~/”下的数据
• 你使用的应用程序创建的数据文件：在”/var/”下的数据（除了”/var/cache/”，”/var/run/”和”/var/tmp/”)
• 系统配置文件：在”/etc/”下的数据
• 本地程序：在”/usr/local/”或”/opt/”下的数据
• 系统安装信息：关键步骤(分区,...) 的纯文本备忘录
• 验证数据结果：通过实验性的恢复操作来预先验证
– 用户进程的Cron工作，文件在”/var/spool/cron/crontabs”目录，并且重启cron(8)。参见第 9.4.14
节来获得关于cron(8)和crontab(1)的信息。
– 用户进程的Systemd计时器工作：文件在”~/.config/systemd/user”目录。参见systemd.timer(5)
和systemd.service(5)。
– 用户进程的自动启动工作：文件在”~/.config/autostart” 目录。参见 Desktop Application Autostart
Specification。
2. 知道怎样去备份和恢复。
• 安全的数据存储：保护其免于覆盖和系统故障
• 经常备份：有计划的备份
• 冗余备份：数据镜像
• 傻瓜式操作：单个简单命令备份
3. 评估涉及的风险和成本。
• 数据丢失的风险
Debian参考手册 186/233
– 数据至少是应该在不同的磁盘分区上，最好是在不同的磁盘和机器上，来承受文件系统发生的损坏。重要数
据最好存储在一个只读文件系统上。1
• 数据非法访问的风险
– 敏感的身份数据，比如”/etc/ssh/ssh_host_*_key”,”~/.gnupg/*”,”~/.ssh/*”,”~/.local/share/keyrings/*”,
”/etc/passwd”,”/etc/shadow”,”popularity-contest.conf”,”/etc/ppp/pap-secrets”,and”/etc/exim4/passwd.client”
应当使用加密备份。2(参见第 9.9 节。)
– 即使在信任的系统上，也不能够硬编码系统登录密码或者加密密码到任何脚本里面。(参见第 10.3.6 节。)
• 数据丢失的方式及其可能性
– 硬件（特别是硬盘）将会损坏
– 文件系统可能会损坏，里面的数据可能被丢失
– 对违规安全访问而言，远程存储系统不能够被信任
– 弱的密码保护能够被轻松的破解
– 文件权限系统可以被破解
• 备份所需的资源：人力，硬件，软件，…
– 使用cron任务或者systemd计时器任务来自动化调度备份工作
注意
除非你知道自己做的是什么，否则不要备份 /proc, /sys, /tmp, 和 /run 目录下的伪文件系统（参见第 1.2.12
节和第 1.2.13 节)。它们是庞大且无用的数据。
注意
当备份数据的时候，你可能希望停止一些应用程序的守护进程例如MTA（参见第 6.2.4 节）。
10.2.2 实用备份套件
以下是Debian系统上值得注意的实用备份程序套件的列表。
备份工具有各自的专用的用途。
• MondoRescue是一个备份系统，它能够方便的从备份CD/DVD等设备中快速恢复整个系统，而不需要经过常规的系
统安装过程。
• Bacula，Amanda和BackupPC是全功能的备份实用套件，主要用于联网的定期备份。
• 定期备份用户数据，可以通过一个简单的脚本实现(第 10.2.3 节)。
第 10.1.1 节和第 10.1.2 节描述的基础工具能够通过自定义脚本来帮助系统备份。这些脚本的功能可以通过如下的工
具来增强。
• restic软件包能够增量备份（远程）。
• rdiff-backup软件包能够增量备份（远程）。
• dump软件包用于高效增量的归档和恢复整个文件系统。
提示
参见”/usr/share/doc/dump/”和”Isdumpreallydeprecated?”来了解dump程序。
1一个只能写一次的媒介，例如CD/DVD-R，能防止覆盖事故。（参见第 9.8 节怎样在shell命令行写入存储媒介。GNOME桌面图形环境可以让
你轻松的通过菜单：“位置→CD/DVD刻录”来实现写入操作。）
2这些数据中的一些，不能够通过在系统里面输入同样的字符串来重新生成。
Debian参考手册 187/233
软件包 流行度 大小 说明
4.4BSDdump(8)和restore(8)命令用于ext2/ext3/ext4文件系
dump V:1,I:4 351