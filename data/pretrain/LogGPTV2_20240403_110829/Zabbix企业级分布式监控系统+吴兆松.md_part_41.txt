Dsabled
Ensbted
bos
nMSsoq
Mtr.wu
Zabbix Usef
BoSS
No
Ck
E
Dsabled
Sraoled
Devops Li
ming
DevCps
rio
Ok
Svstendetaut
Disanled
3
guest
Zabbix User
Guests
Ok
Sstenoer
Dasabled
Nerwork.H
wei
Mr Hu
Zabbix User
Network QPs
No
Ok
5ystem
Disabled
Ensbled
userl
userl
user1
Zabbix User
businessmanager qrouol
No
Ok
Disaoled
Enabled
user2
iser2
user2
ZabbrxUser
businessmanaqer qrouo2
No
Ck
Disabito
Enaclta
iser3
user3
Zabbix User
business
U03
No
GK
psabled
Erabled
Webi Song
Duo
MrSong
Zabbx User
Devwweh arp group1
No
Syeir detauit
Biables
webzZha0
Zabbix User
Qev webapp orouo2
No
Systemidefault
Disatled
Erabled
yeb3Tano
angzong
Mr Tang
zabbix User
Deywebapp
tic
Svstem defsul
Disaoles
Erabl4.4
图16-32
16.4.2
业务组的配置
业务的分组规则见4.2节介绍的原则，如图16-33所示，是划分了多个业务组的
界面。
ZABBIX
Configuration of host groupsConfiguration of hostsConfiguration of te
CONFIGURATIONOF HOST GROUPS
Host groups
Displaying1 to13of 13fo
Name
Members
Templates(o)
businessmanaqer group1
host1host2host3host4host5host
Hosts(6)
Templates(o)
businessmanaqerqroup2
Hosts(0)
Templates(0)
Hosts(0)
Templates(o)
Devops
Hosts(o)
Devwebapp qroup1
Temolates (o)
Hosts(0)
Dev webapp aroup2
Templates(0)
Hosts(0)
Templates(o)
Deywebapp qroup3
Hosts(0)
Tenolates (0)
Hosts(o)
Templates(o)
Hypervisors
Hosts(0)
Temolates(o)
Linux servers
图16-33
16.4.3
监控模板的定制
如图16-34所示的模板是Zabbix提供的。
336
---
## Page 353
第16章大型分布式监控案例
ration of templates Configuration of host
ng1to38of38found
ItemsTriogersGraphsScreensDiscoveryWebLinked temp
ateAppFTPService
Items (1)
Inqgers (1)
Graphs (0)
Screens (o) Discovery (o)Web (0)
Appikcatons(1)
Items(1)
Tmioqers(1)
Sraphs(o)Screens(o)Discovery(O)Web（0)
[emolateAppHIPSService
Applicanons(1)
[tems(1)
Iriqgers (1)
Graphs (0)Screns (o) Discovery (0) web(0)
TemplateAppIMAPService
Aoplications(1)
Items(1)
Irigqers(1)Graphs (0)Screens (0) Discovery (0) Web (0)
Items (1)
Inqaers(1）Graphs(0）Screens(0）DisQver(0）web（0）
TemplateApp MvSOL
Items (14) Inqgers(1)Graphs (2)Screens (1) Discoverv (0) Web (0)
ateAppNNTPServic
tems(1)
Triqners (1)
Graphs (o)Screens (o) Discover (o） Weh (0)
emplateApp NTPService
Aoplications(1)
Items(1)
Triqgers(1)Graphis()Screens(o) Discover ()web(0)
Items (1)
Inqqers(1）Graphs (0)Screens (0） Discover(0）Web (0)
[tems(1)Tnqoers(1)Graphs (0)Screens(0） Discover ()web (0)
IKems (1)
Iniqgers (1)
Graphs (o)
Screens (o) Discovery (o)web (o)
[tems(1）Inqgers(1）Graphs（0)Screens（0）Discovery(0)Web（0）
Applicatons（1）Items(3）Tnqqers(3）Graphs(0)Sereens（o) Discovery (0）web（0）
图16-34
在默认的模板中，Items工作在被动方式中。在实际环境中，由于监控的机器
数量较多，所以需要配置为主动模式。具体配置主动模式的内容请参考8.3节。
其他需要优化的地方，如Items 中历史数据的存储时间设置，将History 和
Trends 的保存时间设置为更短，可以有效地减轻数据库的压力。
默认的触发器中，有很多是不合理的，例如，TemplateOSLinux模板中，以
下触发器的设置都不合理，需要根据实际情况来修改。
●{Template OS Linux:system.cpu.load[percpu,avg1].avg(5m)}>5:单颗 CPU 负载
·{Template OSLinux:proc.num[].avg(5m)}>300：进程数量。
·{Template OSLinux:agent.ping.nodata(5m)}=1：由于网络抖动而引起的误报。
·{TemplateOSLinux:kernel.maxfiles.last（0)} create database zabbix character set utf8;
（此处要特别注意数据库字符集的问题，如果数据库是非utf8字符，则web页面改为中文
后会出现乱码。）
mysql> grant all privileges on zabbix.* to zabbix@localhost
identified by'zabbix';
mysql> flush privileges;
确保以上操作都正常，测试数据库连接是否正常。
如果可以正常连接，说明用户名和密码正确，连接正常后退出，继续进行下面的操作。
shell# mysql -uzabbix -pzabbix zabbix < ${zabbix-X.X.X }/database/
mysql/schema.sql
需要注意的是，如果是安装Proxy，只导入schema.sql即可，无须导入下面的
SQL，否则Proxy无法正常工作。
shell# mysql -uzabbix -pzabbix zabbix < $(zabbix-X.X.x )/database/
mysql/images.sql
shell# mysql -uzabbix -pzabbix zabbix < $(zabbix-X.X.X }/database/
mysql/data.sql
确保以上过程无误。
shell# mkdir/var/log/zabbix
shell# chown zabbix.zabbix /var/log/zabbix
5.复制Service启动脚本
shell# cp misc/init.d/fedora/core/zabbix_* /etc/init.d/
shell# chmod755 /etc/init.d/zabbix*
shell# sed -i "s#BASEDIR=/usr/local#BASEDIR=/usr/#g"/etc/init.d/
zabbix_server
zabbix_agentd
6.配置zabbix_server.conf服务器端的文件
路径：/etc/zabbix/zabbix_server.conf。
修改主要参数即可正常工作。
340
---
## Page 357
附录A源码安装及相关配置
DBName=zabbix
数据库名称
DBUser=zabbix
数据库用户
DBPassword=zabbix数据库密码
shell#egrep -v"(#1~$)"/etc/zabbix/zabbix_server.conf #见第3章
7.复制网页文件到apache目录
shell# cp -r
./zabbix-X.x.x/frontends/php//var/www/html/zabbix
shell# chown -R apache.apache /var/www/html/zabbix
开启Zabbix服务。
shell# chkconfig
zabbix server on
shell# chkconfig
httpd
on
shell# service
zabbix_server
start
shell# service httpd
start
#如果启动失败，请检查配置文件是否都正确
至此，Zabbix的Server端安装完成。
8.配置Zabbix-Server前端UI
打开浏览器，访问http://X.X.X.X/zabbix，Web配置的知识见第3章。
A.2安装Zabbix-Agent
安装zabbix-Agent的语句如下。
shell# wget http://sourceforge.net/projects/zabbix/files/zABBIx%
20Latest%20Stable/2.2.2/zabbix-2.2.2.tar.gz
 6-xtaqez ppednox #us
shell# useradd -g zabbix -u 201
-m zabbix
shell# tar xf ${zabbix-x.x.x ).tar.gz
shell# cd $(zabbix-X.x.x}
xezo/=uoss-- s/=x-- oo. #1u
en
able-agent
shell# make
shell# make
install
shell#mkdir
/var/log/zabbix
shell# chown
zabbix.zabbix
/var/log/zabbix
shell# cp
misc/init.d/fedora/core/zabbix_agentd
/etc/init.d/
shell# chmod
755 /etc/init.d/zabbix_agentd
shell# sed -i "s#BASEDIR=/usr/local#BASEDIR=/usr/#g" /etc/init.d/
zabbix_agentd
shell# vim
/etc/services
zabbix-agent
10050/tcp
#Zabbix Agent
10050/udp
zabbix-agent
#Zabbix Agent
zabbix-trapper
10051/tcp
#Zabbix Trapper
zabbix-trapper
10051/udp
#Zabbix Trappe
341
---
## Page 358
Zabbix企业级分布式监控系统
shell# sed -i "s/Server\=127.0.0.1/Server\=127.0.0.1,x.x.x.x/g"
/etc/zabbix/zabbix_agentd.conf
#被动模式
shell# sed -i "s/ServerActive\=127.0.0.1/ServerActive\=x.x.X.x:
10051/g"  /etc/zabbix/zabbix_agentd.conf
#主动模式
注意，这里的X.X.X.X为Zabbix-Server的IP地址。
shell# sed -i "s#tmp/zabbix_agentd.log#var/log/zabbix/zabbix_ag
entd.log#g" /etc/zabbix/zabbix_agentd.conf
n"
/etc/zabbix/zabbix_agentd.conf
启动Zabbix-Agent服务的语句如下。
shell# chkconfig zabbix_agentd on
shell# service  zabbix_agentd start
A.3关于Zabbix的升级
从Zabbix1.8升级到Zabbix2.0，需要对数据库打补丁，从Zabbix2.0升级到
Zabbix2.2是自动对数据库进行升级的，步骤如下。
①先对数据库进行备份，参考3.12节的数据库备份脚本。
②升级zabbix_server二进制文件。
源码在src/libs/zbxdbupgrade/dbupgrade.c中，读者可以参考源码去研究其实现细节，
static int
DBpatch_2010034（void）
returm DBdrop_field("events","value_changed");
staticint
DBpatch_2010035(vo1d)
const char
(Z)
return FAIL;
static intDBpatch_2010036(void)
constchar
*spdateprofflesy
retum FAIL;
staticint
retum FAIL:
图A-1
关于Zabbix1.8、Zabbix2.0、Zabbix2.2三个版本的数据库字段变更，请参考
如下网址中的内容：
https://github.com/itnihao/ zabbix-book/blob/master/17-chapter/za
bbix-database-1.8-2.0-2.2.xlsx
342
---
## Page 359
[Gｅｎｅｒａｌｌｎfｏｒｍａｔｉｏｎ]
书名= Z ab bi× 企业级分布式监控系统
作者=吴兆松编著
页数=342
SS号=13603847
出版日期=2014.08
出版社=北京：电子工业出版社
ISBN号=978-7-121-23877-2
中图法分类号=TP277
原书定价=59．0０
主题词=计算机监控系统
参考文献格式= 吴兆松编著．Z a b bｉ× 企业级分布式监控系统．北京：电子工业出版社，2 0 1
4.08.
内容提要=本书从运维（〇 P S）角度对Z abbi× 的各项功能进行了详细介绍，以自动化运维视
角为出发点，对Z a b bi× 的安装和配置、自动化功能、监控告警、性能调优、Z ab bi× A P
I、Z a b bi× 协议、R P M安装包定制，结合S a丨t St ac k 实现自动化配置管理等内容进
行了全方位的深入剖析。
---