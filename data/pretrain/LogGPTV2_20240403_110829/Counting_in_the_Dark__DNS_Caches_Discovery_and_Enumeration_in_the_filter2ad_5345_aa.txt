title:Counting in the Dark: DNS Caches Discovery and Enumeration in the
Internet
author:Amit Klein and
Haya Shulman and
Michael Waidner
2017 47th Annual IEEE/IFIP International Conference on Dependable Systems and Networks
Counting in the Dark:
DNS Caches Discovery and Enumeration in the Internet
Amit Klein, Haya Shulman and Michael Waidner
Fraunhofer Institute for Secure Information Technology
Darmstadt, Germany
Abstract
Domain Name System (DNS) is a fundamental element
of the Internet providing lookup services for end users
as well as for a multitude of applications, systems and
security mechanisms that depend on DNS, such as anti-
spam defences, routing security, ﬁrewalls, certiﬁcates
and more. Caches constitute a critical component of
DNS, allowing to improve efﬁciency and reduce latency
and trafﬁc in the Internet. Understanding the behaviour,
conﬁgurations and topologies of caches in the DNS
platforms in the Internet is important for efﬁciency and
security of Internet users and services.
In this work we present methodologies for efﬁciently
discovering and enumerating the caches of the DNS
resolution platforms in the Internet. We apply our
techniques and methodologies for studying caches in
popular DNS resolution platforms in the Internet. Our
study includes networks of major ISPs, enterprises
and professionally managed open DNS resolvers. The
results of our Internet measurements shed light on
architectures and conﬁgurations of the caches in DNS
resolution platforms.
I. Introduction
Domain Name System (DNS), [RFC1034, RFC1035],
has a key role in the Internet, and its correctness and
availability are critical to the security and functional-
ity of Internet clients, services and networks. Initially
designed to translate domain names to IP addresses,
DNS is increasingly utilised to facilitate a wide range of
applications and constitutes an important building block
in the design of scalable network architectures. Over
the years, the DNS infrastructure has evolved into a
complex ecosystem.
Due to the signiﬁcance of DNS and its increasing
complexity, the research and operational communities
invest considerable efforts to gain insight into the inner
workings of DNS. Multiple studies were done in order
to understand the complexity and security of the DNS
infrastructure; we review related work and compare to
our research in Section VI.
In this work we focus on one of the most important
elements of the DNS infrastructure: the caches. The
idea is simple: once a record is requested, it is cached
and subsequent requests for the same record will be
responded from the cache. This allows to reduce trafﬁc
in the Internet and improve efﬁciency and performance
of clients and services. Our goal is to understand the
topologies and conﬁgurations of the caches, in partic-
ular, the correlation and relationship between the IP
addresses used to communicate with the clients and the
DNS nameservers, and the caches used by them.
Understanding the caches is critical for improving the
security and performance of the Internet. Our current
view of basic Internet components is based on standard
documents and initial designs. However, most systems
signiﬁcantly evolved since their conception. Further-
more, typically the networks or Internet operators make
different choices when setting up their infrastructure.
In order to evaluate or improve security of the basic
Internet components a clear understanding thereof is
important. Even basic questions, such as a number of
caches in a DNS platform, are necessary to evaluate
vulnerabilities to cache poisoning attacks. We explain
the motivation for studying the caches in Section II and
provide examples.
For our study we design methodologies for measuring
the caches and apply them to the DNS platforms in
the Internet. The challenge that our study faces is
the following: during a DNS transaction, there is no
direct interaction of the clients and nameservers with
the caches. Speciﬁcally, the caches are ‘hidden’ behind
resolving devices that communicate with the clients and
with the nameservers; see details pertaining to DNS
resolution platforms in Section I-A. Our methodology
uses the standard DNS request/response behaviour - we
trigger specially crafted DNS requests for records in our
2158-3927/17 $31.00 © 2017 IEEE
DOI 10.1109/DSN.2017.63
367
Authorized licensed use limited to: Tsinghua University. Downloaded on March 19,2021 at 10:02:38 UTC from IEEE Xplore.  Restrictions apply. 
domains. The DNS requests (including the requested
records and their type), that arrive from the resolution
platforms at our nameservers, are used as a side channel
to infer information about the caches hidden behind the
IP addresses of the tested DNS platform. Our methods
enable us ‘to decouple’ the caches from the IP addresses
and count the number of caches as well as the mapping
between the caches and IP addresses.
Our contribution is twofold: Conceptually, our study
improves the current understanding of the DNS resolu-
tion platforms and serves as a building block for further
research on DNS performance and security. In particu-
lar, we show that the DNS resolution platforms are more
complex than the traditional model of DNS whereby
a single cache is situated behind a given IP address.
Practically, our tools and measurements can be used
for improving the security, efﬁciency and consistency of
DNS as well as for designing mechanisms that utilise
the DNS infrastructure.
A. DNS Resolution Platforms
We consider a general model for DNS resolution
platforms, illustrated in Figure 1. Typically a full subnet
is allocated for the resolvers (as shown in Figure 1) but
that is not mandatory for our analysis. The platform
consists of a set (232−x) of ingress IP addresses which
handle DNS queries from the clients, a set of n caches,
and a set (232−y) of egress IP addresses, which com-
municate with the nameservers if the queries from the
clients cannot be satisﬁed from (one of) the caches. The
load balancers apply logic for selection of the caches to
sample, and for an egress resolver’s IP address (in case
a requested record cannot be satisﬁed from caches).
Fig. 1. A generic view on DNS resolution platforms and the relevant
actors.
This infrastructure corresponds to complex platforms
such as Google Public DNS, and it can also be ab-
stracted to incorporate a very simple version for a DNS
resolution platforms with a single IP address which
performs both the ingress and egress functionalities and
uses a single cache.
Our measurement infrastructure, Caches Discovery
and Enumeration (CDE) Infrastructure uses direct and
indirect probers to communicate with the ingress IP
368
addresses of the DNS resolution platforms, and a set
of nameservers to communicate with the egress IP
addresses of the DNS resolution platforms.
B. Contributions
We design tools for studying the caches in DNS
resolution platforms in the Internet, and report on the
results of our large scale evaluation of caches in diverse
networks populations. Our analyses provide insights on
architecture of caches in DNS platforms.
Our study is performed on a diverse and represen-
tative dataset of networks. For our data collection we
utilise three different approaches: (1) a distributed ad-
network, (2) email servers in popular domains, (3) pop-
ular Alexa networks (www.alexa.com) that operate
open resolvers to reduce trafﬁc to nameservers (see
details in Section III). The evaluation on different types
of networks offers an accurate and representative view
of the DNS resolution platforms in the Internet. Prior
studies on DNS resolvers were typically done either on
the nameservers’ side (by collecting queries that arrive
at the nameservers) or by scanning the IPv4 address
block for open recursive resolvers.
Our tools enable repetitive studies of the caches over
periods of time. This allows to perform analyses of
adoption of new mechanisms, trends, growth of the
DNS resolution platforms and more. We make our tools
available for public use1.
C. Organisation
In Section II we explain motivation for our study and
describe examples where the tools and the statistics can
be useful. In Section III we present our dataset and data
collection study, and report on the insights important
for characterising the DNS infrastructure (such as IP to
caches mapping). In Section IV we design techniques
for caches enumeration and for mapping between IP
addresses and caches. In Section V we apply our
techniques for a study of DNS resolution platforms in
the Internet. In Section VI we compare our study to
related work. We conclude this work in Section VII and
provide directions for future work.
II. Motivation for Studying Caches
Understanding Internet components is critical for im-
proving their security and for designing mechanisms
that use them or depend on them. In this section we
explain the importance of studying the caches in DNS
platforms.
1Due to double blind requirement, the tools are available upon
request from the authors.
Authorized licensed use limited to: Tsinghua University. Downloaded on March 19,2021 at 10:02:38 UTC from IEEE Xplore.  Restrictions apply. 
A. Security
The structure of DNS platforms and the number of
caches that they use are important parameters in assess-
ing the security of networks against cache poisoning
attacks. Using multiple caches signiﬁcantly increases
the difﬁculty of cache poisoning. During a cache poison-
ing attack, spoofed responses, containing incorrect DNS
records, are sent to the victim DNS resolver. The re-
solver accepts only correct responses, namely those with
correct challenge response authentication parameters
(deﬁned in [RFC5452]). However, recent work showed
that often the defences can be circumvented, [1], [2],
[3], [4], [5], [6], [7]. As a result, an off-path attacker can
inject a spoofed response that would be accepted and
cached by the resolver. A man-in-the-middle (MitM)
attacker does not even need to attempt to guess the
challenge response authentication, but can simply copy
the values from the request to the response. Typically
a cache would already contain the values which the
attacker attempts to inject, hence the attacker would
need to overwrite the cached records with ones that
contain spoofed values, [8]. This requires exchanging
a sequence of request/response pairs with the same
cache. In a multiple cache scenario the difﬁculty to
launch a successful cache poisoning attack increases
signiﬁcantly. For instance, different caches apply dif-
ferent logic for deciding which records to cache, hence
the attacker would need to force his attack to run
against a speciﬁc cache with the vulnerable software.
Furthermore, the spoofed records sent by the attacker
will be distributed to multiple caches, hence rendering
the attack ineffective - say if an attacker wishes to
inject an NS record and then to use it to supply a
spoofed A record for a website. In that case, if one
of the records ‘hits’ a different cache, the attack fails.
Understanding the structure of DNS platforms and the
number of caches that they use enables researchers and
network operators to evaluate resilience and security
against cache poisoning attacks.
B. Resilience
Tools for studying caches allow to model and anal-
yse the dependability and security of DNS resolution
platforms without a priori knowledge of their structure.
For instance, how resilient is a DNS platform and the
services that depend on it against Distributed Denial of
Service (DDoS) attacks. How easy is it to disconnect
services from the Internet by attacking DNS? Tools
developed in this work help network operators to assess
the security and dependability of their networks. For
instance, a network operator can identify when some
of the caching components fail and are not available,
e.g., a DNS platform uses four caches, but our tool
measures two, namely two are down. Our tools can also
be used for large scale studies of the dependability of
the Internet while being non intrusive and requiring no
cooperation from the tested networks.
In addition to facilitating further research on re-
silience of networks and platforms in the Internet,
our tools provide means for comparing DNS service
operators in order to select one with better resilience
and fault tolerance.
C. Tools for Networks Management and Research
which caches enumeration is critical and useful.
In this section we provide a number of examples, in
(cid:73) Consistency of the caching of DNS records. Our
study provides tools for differentiating between multiple
caches and inconsistency in caches with respect to DNS
Time-to-Live (TTL). For instance, requesting the same
record from a DNS resolution platform twice, within a
time interval that is shorter than the TTL of the DNS
record, should result in only one DNS request issued
by the resolution platform to the nameservers2. Current
studies interpret multiple requests as inconsistency with
TTL. However, it can also be that the DNS resolu-
tion platform is using multiple caches. When a DNS
platform is conﬁgured with multiple caches, not all the
caches will have the requested record, hence will issue
the query again. This can be mistakenly taken as an
indication that the DNS platform does not respect the
TTL. Our tools allow researchers and network operators
to differentiate between multiple caches and caches with
inconsistent TTL.
(cid:73) Size of DNS resolution platforms. Originally de-
signed to translate domain names to IP addresses,
DNS is increasingly used by different mechanisms,
for instance mechanisms for security, such as DANE,
anti-spam mechanisms, routing defences against preﬁx
hijacks. As a result, the DNS resolution platforms have
to satisfy the increasing demands for storage and the
trafﬁc volume. Our tools enables measuring the sizes of
DNS resolution platforms in the Internet.
(cid:73) Device discovery. Device discovery mechanisms
ﬁnd devices that have addresses, since caches are not
identiﬁed by IP addresses, they would not be detected.
Our tools extend current device discovery mechanisms
enabling discovery of hidden caches . Our ideas and
techniques can also be applied for design of discovery
of other hidden caches.
(cid:73) Measuring software and new mechanisms. Dis-
tribution of patches and upgrades. Caches on DNS
resolution platforms are often running different DNS
software. For distribution and integration of patches it
is important to know which software the caches are
2Some DNS resolution platforms enforce a minimal and a maximal
TTL. In those cases, TTL that is smaller than the minimum, or larger
than the maximum will be adjusted by the cache.
369
Authorized licensed use limited to: Tsinghua University. Downloaded on March 19,2021 at 10:02:38 UTC from IEEE Xplore.  Restrictions apply. 
running. Inferring the software used by DNS caches is
also important for the studies measuring deployment of
DNS software in the Internet. As we show in related
work, currently, studies on DNS resolution platforms
measure devices with IP addresses but omit the hidden
caches. Similarly our tools enable studies of adoption of
new mechanisms for DNS, such as the transport layer
EDNS [RFC6891] mechanism.
III. Data Collection
IP address of the resolver is used as the A records of
the nameservers in the zone ﬁles of the corresponding
domains, and the nameservers are essentially hidden
behind the IP addresses associated with the open re-
solvers. Speciﬁcally, when receiving a DNS request, the
value is checked in the cache, and if it is not in the