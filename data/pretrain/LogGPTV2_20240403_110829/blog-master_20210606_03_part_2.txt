                END AS c    
      FROM (SELECT 2.0*generate_series(0,%s)/%s-1.0) AS x(x),    
           (SELECT 2.0*generate_series(0,%s)/%s-1.0) AS y(y)    
     ORDER BY y,x    
  ) AS xy    
 GROUP BY y    
 ORDER BY y    
)    
UNION ALL     
SELECT repeat(SUBSTRING(%L,slice,1), 2) || '  ' ||     
       name || ': ' ||     
       VALUE || '  (' || round(percentage,0) || '%%)'     
  FROM slices;    
$_$, sql, radius, radius, colours, width, width, height, height, colours);    
return;    
end;    
$$ language plpgsql strict;    
```  
```  
postgres=# select * from gen_charts('select mod(id,5),count(*) from tbl group by 1 order by 2 desc');  
                                    gen_charts                                       
-----------------------------------------------------------------------------------  
                                         ;                                          
                          ;;;;;;;;;;;;;;;;;;;;;;;;;;;####                           
                    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;###########                     
                ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;################                 
            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;#####################             
         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;#########################          
       oooooo;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;############################        
      ooooooooooo;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;##############################       
    oooooooooooooooooo;;;;;;;;;;;;;;;;;;;;;;;;#################################     
   ooooooooooooooooooooooo;;;;;;;;;;;;;;;;;;;###################################    
  oooooooooooooooooooooooooooo;;;;;;;;;;;;;;#####################################   
  ooooooooooooooooooooooooooooooooo;;;;;;;;######################################   
  oooooooooooooooooooooooooooooooooooo       ####################################   
  oooooooooooooooooooooooooooooooooooo       XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX   
  ooooooooooooooooooooooooooooooooo::::::::XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX   
  ooooooooooooooooooooooooooooo:::::::::::::XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX   
   ooooooooooooooooooooooo:::::::::::::::::::XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX    
    oooooooooooooooooo::::::::::::::::::::::::XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX     
      ooooooooooo::::::::::::::::::::::::::::::XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX       
       oooooo:::::::::::::::::::::::::::::::::::XXXXXXXXXXXXXXXXXXXXXXXXXXXX        
         ::::::::::::::::::::::::::::::::::::::::XXXXXXXXXXXXXXXXXXXXXXXXX          
            ::::::::::::::::::::::::::::::::::::::XXXXXXXXXXXXXXXXXXXXX             
                :::::::::::::::::::::::::::::::::::XXXXXXXXXXXXXXXX                 
                    ::::::::::::::::::::::::::::::::XXXXXXXXXXX                     
                          ::::::::::::::::::::::::::::XXX                           
                                         :                                          
 ##  2: 563867  (20%)  
 ;;  3: 563581  (20%)  
 oo  4: 563241  (20%)  
 ::  1: 562509  (20%)  
 XX  0: 562363  (20%)  
(31 rows)  
```  
4、R绘图  
##### 201506/20150618_01.md   [《生成泊松、高斯、指数、随机分布数据 - PostgreSQL 9.5 new feature - pgbench improve, gaussian (standard normal) & exponential distribution》](../201506/20150618_01.md)  
纵轴: 概率  
横轴: value  
![pic](../201506/20150618_01_pic_001.png)    
![pic](../201506/20150618_01_pic_002.png)    
![pic](../201506/20150618_01_pic_003.png)    
![pic](../201506/20150618_01_pic_004.png)    
![pic](../201506/20150618_01_pic_005.png)    
![pic](../201506/20150618_01_pic_006.png)    
![pic](../201506/20150618_01_pic_007.png)    
![pic](../201506/20150618_01_pic_008.png)    
![pic](../201506/20150618_01_pic_009.png)    
### 1 随机分布   
```  
create unlogged table tbl (id int, info text);  
```  
为了便于观察概率分布情况, 取100个值.   
```  
vi test.sql  
\set id random(1,100)  
insert into tbl values (:id, 'test');  
pgbench -M prepared -n -r -P 1 -f ./test.sql -c 12 -j 12 -T 20  
```  
概率分布情况:   
```  
 bucket |  range   |  freq  | ratio  |         bar            
--------+----------+--------+--------+----------------------  
      1 | [1,4]    | 112623 | 4.00 % | ********************  
      2 | [5,8]    | 113083 | 4.02 % | ********************  
      3 | [9,12]   | 112719 | 4.00 % | ********************  
      4 | [13,16]  | 112613 | 4.00 % | ********************  
      5 | [17,20]  | 112798 | 4.01 % | ********************  
      6 | [21,24]  | 113045 | 4.02 % | ********************  
      7 | [25,28]  | 112343 | 3.99 % | ********************  
      8 | [29,32]  | 113011 | 4.01 % | ********************  
      9 | [33,36]  | 112894 | 4.01 % | ********************  
     10 | [37,40]  | 112040 | 3.98 % | ********************  
     11 | [41,44]  | 112700 | 4.00 % | ********************  
     12 | [45,48]  | 112247 | 3.99 % | ********************  
     13 | [49,52]  | 112771 | 4.01 % | ********************  
     14 | [53,56]  | 112284 | 3.99 % | ********************  
     15 | [57,60]  | 112399 | 3.99 % | ********************  
     16 | [61,64]  | 112181 | 3.98 % | ********************  
     17 | [65,68]  | 112560 | 4.00 % | ********************  
     18 | [69,72]  | 112514 | 4.00 % | ********************  
     19 | [73,76]  | 112681 | 4.00 % | ********************  
     20 | [77,80]  | 112666 | 4.00 % | ********************  
     21 | [81,84]  | 112508 | 4.00 % | ********************  
     22 | [85,88]  | 112864 | 4.01 % | ********************  
     23 | [89,92]  | 113081 | 4.02 % | ********************  
     24 | [93,96]  | 112283 | 3.99 % | ********************  
     25 | [97,100] | 112653 | 4.00 % | ********************  
(25 rows)  
```  
### 2 高斯分布  
```  
truncate tbl;  
\set id random_gaussian(1,100,2.5)  
insert into tbl values (:id, 'test');  
pgbench -M prepared -n -r -P 1 -f ./test.sql -c 12 -j 12 -T 20  
```  
概率分布情况:   
```  
 bucket |  range   |  freq  | ratio  |         bar            
--------+----------+--------+--------+----------------------  
      1 | [1,4]    |  13432 | 0.46 % | *  
      2 | [5,8]    |  21253 | 0.72 % | **  
      3 | [9,12]   |  32501 | 1.10 % | ***  
      4 | [13,16]  |  47288 | 1.60 % | ****  
      5 | [17,20]  |  66095 | 2.24 % | ******  
      6 | [21,24]  |  89577 | 3.04 % | ********  
      7 | [25,28]  | 115935 | 3.93 % | **********  
      8 | [29,32]  | 144387 | 4.89 % | ************  
      9 | [33,36]  | 173053 | 5.87 % | ***************  
     10 | [37,40]  | 198419 | 6.73 % | *****************  
     11 | [41,44]  | 219778 | 7.45 % | ******************  
     12 | [45,48]  | 233489 | 7.91 % | ********************  
     13 | [49,52]  | 238105 | 8.07 % | ********************  
     14 | [53,56]  | 234864 | 7.96 % | ********************  
     15 | [57,60]  | 219427 | 7.44 % | ******************  
     16 | [61,64]  | 198440 | 6.73 % | *****************  
     17 | [65,68]  | 172913 | 5.86 % | ***************  
     18 | [69,72]  | 144989 | 4.91 % | ************  
     19 | [73,76]  | 116383 | 3.95 % | **********  
     20 | [77,80]  |  89234 | 3.02 % | *******  