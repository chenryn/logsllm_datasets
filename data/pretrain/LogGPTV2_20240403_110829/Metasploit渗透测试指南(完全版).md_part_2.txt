供了独树一帜的能力。
XVI
---
## Page 11
Metasploit框架在代码的反复无常上是“声名狼籍”的，它的代码库每天被一个核心的开发
团队和数百位来自社区的贡献者更新数十次。在我看来，为Metasploit写一本书根本就是一种
自虐行为：完成的一章刚刚经过了试读，可能它里面的内容就已经过时了。然而，作者们接受
了这项艰巨的任务，并成功地让这本书在到达读者手中时，内容还仍然是适用的。
Metasploit开发团队也参与了这本书的评审，以确保对代码的最新修改能够精确地反映到书
中，而最终的评审结果是：这本书对Metasploit框架软件的“零日”覆盖已经达到了人力的极
限了。我们可以很负责任地说一一这是现今已有最好的Metasploit框架软件参考指南。我们希
望本书能够在你的工作中发挥价值，并且是指导你在渗透测试技术道路上不断探索前行的一本
优秀参考指南。
HDMoore
Metasploit项自创始人
PDC
XVII
---
## Page 12
·作者序
Metasploit框架路身信息安全职业者们最广泛使用的工具软件行列已经相当长时间了，但是
除了源码本身和在博客上的一些评论之外，有价值的文档却一直非常少。这种状态在
Offensive-Security团队开发了“Metasploit揭秘”在线教程之后得到了显著改观。在这部教程上
线之后不久，NoStarch出版社就联系我们探讨扩展“Metasploit揭秘”教程来编写一本参考书
的可行性。
而这本书就是设计来让你了解Metasploit的输入/输出，以及如何极致地发挥Metasploit框
架能力的。而我们的章节内容覆盖也是经过深思熟虑和精心选择的一我们不会覆盖到每个参
数或渗透攻击模块，但我们会让你了解必须掌握的基础技术，以及现在和将来如何使用
Metasploit的方法。
XVm
---
## Page 13
当我们开始写作本书时，我们得到Metasploit项目创始人HDMoore的一次善意提醒。在
和HD的一次关于开发我们的“Metasploit揭秘”在线教程的谈话中，我们中的一位对他说了一
句：“我想教程质量会很好的”。对于这句漫不经心的自我评价，HD仅仅回应了一句“那就确
保好的质量吧”。然后这就是我们尝试对本书所期望达到的效果了。
作为一个团队，我们都是富有经验的渗透测试师，每天都在使用Metasploit框架系统性地
挫败安全控制措施、绕过防御机制，并攻击系统。我们写作此书的目的是帮助读者能够成为具
备能力的渗透测试师。HD对高质量的关注和追求也在Metasploit框架中得到了非常显著的体现，
我们也期望能够在本书中达到与之相匹配的程度。而我们到底完成得如何，这将由你们来判断。
PDC
XIX
---
## Page 14
致
谢·
我们要对许多人致以谢意，首先是那些辛勤工作并为社区提供了如此一款优秀软件的勇士
们。特别的感谢致以Metasploit开发团队：HDMoore,James Lee,David D.Rude II,Tod Beardsley,
Jonathan Cran, Stephen Fewer, Joshua Drake, Mario Ceballos, Ramon Valle, Patrick Webster, Efrain
Torres, Alexandre Maloteaux, Wei Chen, Steve Tornio, Nathan Keltner, Chris Gates, Carlos Perez,
MattWeeks和RaphaelMudge。另外一个额外的感谢给CarlosPerez，他帮助我们编写了
Meterpreter脚本章节的部分内容。
非常感谢ScotWhite，本书的技术评审，感谢他令人敬畏的工作态度。
谢谢Offensive-Security团队将我们团结在一起，Offensive-Security团队的座右铭“Try
Harder”经常激励和折磨我们的灵魂（包括邪恶的ryujin）。
XX
---
## Page 15
我们还有许多信息安全社区的同仁们要去感谢，但要感谢的人实在太多了，难以在此一一
列举，而且遗漏某人的几率很高。所以我们对安全社区中的所有朋友们表示感谢，致以我们所
有人最为热烈的拥抱。
衡量的努力工作。Bill、Alison、Travis和Tyler，与你们和NoStarch 出版社幕后工作的所有人
共同工作，我们非常高兴！
最后，非常非常感谢我们的家庭，我们都已经结婚而且一半都已经有了孩子，我们花了太
多的时间在键盘上，而没有足够的时间和他们在一起。对于我们的家庭，谢谢你们的理解，我
们将马上回报你们一一等我们搞定下一行代码，或找出这个内存破坏的源头，或svn更新完代
码，或把这个Fuzz测试跑起来，或..·
个人特别致谢
Dave（Twitter:@dave_rellk）：我将本书（我的那部分工作）献给我可爱的妻子Erin，她忍
受了我在深夜中不断地敲击键盘。献给我的三个孩子，他们让我同时年轻和老成。献给我的父
亲Jim和母亲Janna，以及继母Deb，谢谢他们和我在一起并培养我成才。感谢Jim、Dookie和
Muts在本书中付出的辛勤工作，以及成为我的好朋友。感谢我在Offensive-Security团队中的好
友：Chris“Logan”Hadnagy、我的兄弟 Shawn Sullivan，以及我在Diebold 公司的同事们。感谢
我的好朋友HDMoore，他对安全业界的专注和投入给我们很多启示。感谢在我生活中的所有
朋友，谢谢ScottAngelo给我一个机会并信任我。最后，感谢上帝，没有他，这世上没有人能
够存在。
Devon（@dookie2000ca）：感谢我美丽且包容的妻子，她不但支持还鼓励了我的技术狂热，
你不仅仅是我的灵感与动力的源泉，如果没有你在这些事务中为我考虑，我将永远不可能取得
任何成绩。感谢我的合作者，谢谢你们信任我这个新人并接受我入伙。特别要感谢Mati，不仅
仅是组建了这支欢乐的乐队，还给我提供了机会。
Muts（@backtracklinux）：特别感谢本书的合作者，他们对本书投入的时间和热情真是令人
鼓舞。我将Jim、Devon和Dave看作最好的朋友和在安全领域最好的伙伴。
Jim（@_Elwood_）：谢谢Matteo、Chris“Logan”和所有Offensive-Security团队的伙伴们。
另外也很感谢Robert、Matt、Chris 和我在 StrikeForce 的同事们。谢谢我的好妻子Melissa：你
在你手中拿着的这本书是证明我之前并非有意逃避家务劳动的证据。感谢Jack和Joe，请不要
在妈妈面前揭发我告诉她我正在工作的时候是在和你们一起玩游戏，你们三个人是我生命中最
重要的人。最后感谢我的合作者Mati、Devon和Dave：谢谢你们让我把名字署在书上—我真
的是在逃避家务。
IXX
---
## Page 16
前言
想象一下在不久的将来，一位攻击者决定要攻击一家跨国企业的数字资产，目标是从花费
数百万美元构建的安全防御基础设施中挖掘出价值数亿的知识产权。攻击者很娴熟地祭出“神
器”—最新版本Metasploit，在攻破目标组织的网络边界防御之后，他找到了一个“软肋”，
并有条不紊地实施一系列渗透攻击，但是直到他已经攻陷了网络中每一个角落之后，好戏才刚
刚上演。他在系统之间神出鬼没，寻找核心业务组件，而企业仍然在按部就班地运营，没人能
够察觉到他的存在。弹指之间，他让数百万美元的安全防御设施灰飞烟灭，将公司最敏感的知
识产权数据手到擒来。
恭喜你完成了一次漂亮的工作，你已经展示出真正的业务影响后果，现在是写报告和收钱
的时候了。令人称奇的是，现今的渗透测试者就已经处在上面场景中所描述的假想敌手角色，
应那些需要高度安全等级的企业所邀请，来实施合法的攻击。欢迎来到渗透测试的神奇世界。
IIXX
---
## Page 17
为什么进行渗透测试
企业在保护关键基础设施的安全计划中投入了数百万美元，来找出防护盔甲的缝隙，防止
敏感数据外泄。而渗透测试是能够识别出这些安全计划中的系统弱点与不足之处的一种最为有
效的技术方式。通过尝试挫败安全控制措施并绕开防御机制，渗透测试师能够找出攻击者可能
攻陷企业安全计划、并对企业带来严重破坏后果的方法。
当你在阅读本书时，请记住你并不是非要攻陷哪个或者哪些系统，你的目标是以一种安全
和受控的方式，来展示攻击者如何可以对一个组织造成严重破坏，并影响它的业务盈利、维持
声望和保护客户的能力。
为什么是Metasploit
Metasploit并不仅仅是一个工具软件，它是为自动化地实施经典的、常规的，或复杂新颖的
攻击提供基础设施支持的一个完整框架平台。它使你可以将精力集中在渗透测试过程中那些独
特的方面上，以及如何识别信息安全计划的弱点上。
何在你的渗透测试过程中以多种方式来使用Metasploit框架软件。Metasploit能够让你通过选择
它的渗透攻击模块、攻击载荷和编码器来轻易实施一次渗透攻击，也可以更进一步编写并执行
更为复杂的攻击技术。在本书中，我们也会介绍几个基于Metasploit 框架所构建的第三方工具
一其中一些是由本书作者所编写的。我们的目标是让你充分熟悉Metasploit框架，为你展示
一些高级的攻击技术，并确保你能够可靠地应用这些技术。我们希望你能够像我们编写过程中
一样享受这本书。进入游戏，让我们开始玩吧！
Metasploit发展简史
开发渗透代码构建一个灵活且可维护的框架平台，2003年10月他发布了他的第一个基于Perl
语言的Metasploit版本，当时一共集成了11个渗透攻击模块。
块和超过27个攻击载荷。在这次发布之后不久，MattMiller（Skape）加入了Metasploit开发团
队，随着项目逐步获得关注，Metasploit框架也获得了来自信息安全社区的大量代码贡献，并很
快成为一个渗透测试与攻击的必备工具。
XXIII
---
## Page 18
随着3.0版本的发布，Metasploit在安全社区取得了更加广泛的用户群，并在代码贡献方面也得
到了快速的发展。
2009年秋季，Metasploit被漏洞扫描领域的一家领军企业Rapid7公司收购，Rapid7公司允
许HD来招募一支团队，专注于Metasploit框架的开发。自从被收购之后，Metasploit上的代码
更新比任何人所预期的都要快得多。Rapid7公司在Metasploit框架的基础上也发布了两款商业
版本：Metasploit Express 和Metasploit Pro。Metasploit Express是一个带有GUI界面的轻量级
Metasploit框架软件，并增加了一些额外的功能，包括报告生成和其他一些很有用的特性。
MetasploitPro则是MetasploitExpress的扩展版本，能够支持以团队协作方式实施的渗透测试过
程，并拥有如一键创建VPN通道等很多有用的特性。
关于本书
们的目的是为初学者提供一本有用的指南教程，为职业的渗透测试者提供一本参考索引，然而
我们不会总是牵着你的手前行。编程知识是在渗透测试领域中必须具备的，本书中的很多例子
都会使用Ruby或者Python编程语言，虽然我们建议你去学习并掌握像Ruby或Python这样一
类的编程语言，来帮助你进行更高级的渗透攻击和攻击定制开发，但对于阅读本书来讲编程知
识不是必需的。
当你逐渐熟悉Metasploit之后，你会发现：Metasploit框架是一项经常更新，并拥有一些新
的特性、渗透代码和攻击的技术。本书在编写时，Metasploit中的知识也在不停地更新，没有-一
本书能够跟上如此快速开发的脚步，因此我们更加关注于基础，因为一旦你理解了Metasploit
如何工作，你就有能力自己快速地去了解和掌握Metasploit框架的更新内容了。
本书内容
个章节作为阶梯，这样可以帮助你从零开始来建立起作为渗透测试者的基本技能。
●第2章：“Metasploit基础”，引领你认识Metasploit框架中的各种工具。
·第3章：“情报搜集”，为你展示在渗透测试侦察阶段利用Metasploit搜集情报信息的不
同方法。
XXIV
---
## Page 19
●第4章：“漏洞扫描”，指导你如何发现安全漏洞并充分利用漏洞扫描技术。
●第5章：“渗透攻击之旅”，带你进入渗透攻击的世界。
●第9章：“Metasploit辅助模块”，带你了解辅助模块的多样化能力。
●第12章：“Karmetasploit无线攻击套件”，为你展示如何利用Karmetasploit进行无线攻
击。
●第14章：“创建你自已的渗透攻击模块”，介绍Fuzz测试技术，以及如何使用缓冲区
溢出技术来创建渗透攻击模块。
·第15章：“将渗透代码移植到Metasploit框架”，让你深入地体验将已有的渗透代码移
植成Metasploit框架模块的过程。
●第16章：“Meterpreter脚本编程”，为你展示如何编写你自己的Meterpreter脚本。
模拟的渗透攻击。
关于道德伦理的忠告
我们编写本书的目标是帮助你提升作为渗透测试者的技能。作为一名渗透测试者，我们可
以击败安全防御机制，但这仅仅是我们工作的一部分。当你进行渗透攻击时，请记住如下的忠
告：
·不要进行恶意的攻击；
●不要做傻事；
●在没有获得书面授权时，不要攻击任何目标；
·考虑你的行为将会带来的后果：
无论本书作者，还是本书的出版商一一NoStarch出版社（译者注：再加上本书译者和中文
的行为，也不会对其承担任何责任，我们的目标是让你变得更具能力，而不是帮助你自找麻烦，
而且我们也不想、也没有能力把你从里面捞出来。
XXV
---
## Page 20
录
第1章渗透测试技术基础
1.1PTES标准中的渗透测试阶段
2
1.1.1前期交互阶段.
1.1.2
情报搜集阶段..
1.1.3威胁建模阶段.
2
1.1.4
漏洞分析阶段..
1.1.5
渗透攻击阶段.
1.1.6后渗透攻击阶段
1.1.7报告阶段.
1.2渗透测试类型.
1.2.1白盒测试...
1.2.2黑盒测试.
1.3漏洞扫描器.
VII
---
## Page 21
1.4小结
6
第2章Metasploit基础.
专业术语...
7
2.1.1
渗透攻击（Exploit）
8
2.1.2
攻击载荷（Payload）
2.1.3
Shellcode.
.8
2.1.4
模块（Module）
8
2.1.5
监听器（Listener）
8
2.2Metasploit用户接口..
.8
2.2.1
MSF终端
9
2.2.2
MSF命令行...
...9
2.2.3
Armitage...
...11
2.3Metasploit功能程序.
.12
2.3.1
MSF攻击载荷生成器，
12
2.3.2
MSF编码器