    图 12.13–基巴纳指数模式定义
5.  点击**下一步**按钮继续。
6.  In the configuration settings, click the dropdown and select **time**, then click **Create index pattern** to create the pattern:
    ![Figure 12.14 – Creating an index ](img/Fig_12.14_B15514.jpg)
    图 12.14–创建索引
7.  最后，通过点击最终屏幕右上角的星号，将索引设置为默认索引:
![Figure 12.15 – Setting a default index ](img/Fig_12.15_B15514.jpg)
图 12.15–设置默认索引
就是这样，现在您的集群上运行了一个完整的 Falco 日志记录系统。
要开始查看数据，请单击位于基巴纳屏幕左上角的发现按钮![](img/Icon_2.png)，该按钮将带您进入基巴纳主页面，您将在该页面上看到集群中的事件:
![Figure 12.16 – Kibana homepage ](img/Fig_12.16_B15514.jpg)
图 12.16–基巴纳主页
您可以通过在搜索栏中键入关键字来搜索事件。如果您正在寻找单一类型的事件，并且知道要搜索什么值，这将很有帮助。
像基巴纳这样的日志记录系统的真正好处是能够创建自定义仪表板，提供对多个事件的视图，这些事件可以按计数、平均值等进行分组。在下一节中，我们将解释如何创建一个提供 Falco 事件集合的仪表板。
创建仪表板是您需要发展的一项技能，了解如何对数据进行分组以及在仪表板中使用什么值需要时间。本节旨在为您提供开始创建仪表板所需的基本工具，如下所示:
![Figure 12.17 – Example dashboard ](img/Fig_12.17_B15514.jpg)
图 12.17–仪表板示例
人们喜欢仪表板，Kibana 提供了工具来创建系统的动态且易于解释的视图。仪表板可以使用基巴纳有权访问的任何数据来创建，包括 Falco 事件。在我们创建仪表板之前，让我们了解一下*可视化*意味着什么。
#### 形象化
可视化是一组数据的图形表示——在我们的上下文中，来自基巴纳索引。Kibana 包括一组可视化功能，允许您将数据分组为表格、仪表、水平条、饼图、竖线等。
要创建新的可视化效果，请单击左侧栏上的可视化图标![](img/Icon_3_new.png)，该图标看起来像一个小图形。这将显示新的可视化选择屏幕。然后，按照以下步骤操作:
1.  To select the visualization you want to create, select it from the list. Let's use a common one for this visualization, the pie chart:
    ![Figure 12.18 – Falco visualizations ](img/Fig_12.18_B15514.jpg)
    图 12.18–Falco 可视化
2.  Each visualization requires a source. For our example, we only have one index created called `falco*`, so select that as the source:
    ![Figure 12.19 – Selecting a visualization source ](img/Fig_12.19_B15514.jpg)
    图 12.19–选择可视化源
3.  下一步是选择一个指标和一个桶。度量定义了如何聚合桶中的结果。桶是您想要可视化的值。例如，我们希望饼图显示事件优先级的总数，范围从**错误**、**通知**和**警告**到**调试**。
4.  First, set the metric aggregation value to **Count**:
    ![Figure 12.20 – Visualization metric options ](img/Fig_12.20_B15514.jpg)
    图 12.20–可视化指标选项
5.  Next, we need to select the field we want to aggregate. For **Aggregation**, select **Terms**, and for **Field**, select **priority.keyword**:
    ![Figure 12.21 – Selecting bucket values ](img/Fig_12.21_B15514.jpg)
    图 12.21–选择铲斗值
6.  Before saving the visualization, you can preview the results by clicking the arrow button at the top of the metric box. A preview of the results will be shown in the right-hand pane:
    ![Figure 12.22 – Visualization preview ](img/Fig_12.22_B15514.jpg)
    图 12.22–可视化预览
7.  如果结果是您所期望的，您可以通过单击主视图顶部的**保存**链接来保存可视化效果。输入可视化效果的名称，以便您稍后在创建仪表板时可以找到它:
![Figure 12.23 – Saving a new visualization ](img/Fig_12.23_B15514.jpg)
图 12.23–保存新的可视化效果
保存可视化时，它将保留在屏幕上，但您应该会在右下角看到保存成功的确认。
要创建其他可视化效果，您只需再次单击可视化效果按钮，并选择所需的类型来创建另一个可视化效果。使用我们在第一个可视化中看到的内容，创建两个使用以下参数的附加可视化:
*   **Visualization Type**: Horizontal bar
    **来源** : `falco*`
    **度量**:聚合:计数
    **桶** : X 轴，聚合:术语，字段:`rule.keyword`
    **度量**:计数，大小:5，自定义标签:前 5 条 Falco 规则
    **可视化名称**:前 5 大 Falco 规则
*   **Visualization Type**: Data Table
    **来源** : `falco*`
    **度量**:聚合:计数
    **桶**:拆分行，聚合:术语，字段:`output_fields.fd.name.keyword`，度量:计数，大小:5，自定义标签:前 5 个修改文件
    **可视化名称**:前 5 名 Falco 修改文件
在下一节中，我们将创建一个显示您创建的可视化效果的仪表板。
#### 创建仪表板
仪表板允许您在一个集合中显示可视化效果，该集合易于阅读，信息每分钟更新一次:
1.  To create a dashboard, click on the dashboard button ![](img/Icon_4.png) on the sidebar.
    按钮看起来像 4 个堆叠的块。
2.  This will bring up the **Create your first dashboard screen**. Click the **Create new dashboard** button to start creating your dashboard.
    屏幕上将出现一个空白仪表盘，上面有一个按钮:
    ![Figure 12.24 – Creating a new dashboard ](img/Fig_12.24_B15514.jpg)
    图 12.24–创建新仪表板
3.  This button provides you the option to use an existing visualization or to create a new one. Since we created three visualizations earlier, click the **Add an existing** link. Once selected, all existing visualizations will be presented on the right-hand side of the dashboard in the **Add panels** box:
    ![ Figure 12.25 – Adding panels to a dashboard ](img/Fig_12.25_B15514.jpg)
    图 12.25–向仪表板添加面板
4.  我们想添加我们创建的三个可视化效果:**Falco 优先级计数**、**前 5 名 Falco 修改文件**和**前 5 名 Falco 规则**。要添加每一个，点击它们每一个**一次**。
5.  Once you have added all of the visualizations to the dashboard, you can close the **Add panels** pane by clicking the **X** in the upper right-hand of that pane. Once it's closed, you should see your dashboard with the visualizations you selected:
    ![Figure 12.26 – Dashboard view after adding visualizations ](img/Fig_12.26_B15514.jpg)
    图 12.26–添加可视化后的仪表板视图
    哎呀！看起来我们可能已经添加了两次前 5 名的 Falco 规则可视化。当我们完成添加可视化的步骤时，我们在步骤中强调了一个关键词:“要添加每个可视化，请单击每个可视化**一次**。”每次点击时都会添加可视化效果。当我们将 Falco 规则添加到仪表板时，我们双击了它。
    如果您碰巧双击了一个可视化，它将被添加到仪表板两次。如果不小心添加了两次可视化效果，只需点击可视化效果角落的齿轮，从仪表盘中选择**删除，即可删除其中一个可视化效果:**
    ![Figure 12.27 – Deleting a panel from a dashboard ](img/Fig_12.27_B15514.jpg)
    图 12.27–从仪表板中删除面板
6.  删除重复的可视化后，您可以通过单击浏览器窗口顶部的保存链接来保存仪表板。这将提示您保存您的仪表板，因此将其命名为`Falco Dashboard`并单击**保存**:
![Figure 12.28 – Saving a dashboard ](img/Fig_12.28_B15514.jpg)
图 12.28–保存仪表板
一旦您保存了一个仪表盘，它将通过基巴纳主页左侧的仪表盘按钮可用。这与您之前创建第一个仪表板时使用的按钮相同。
# 总结
本章讲述了如何为 Kubernetes 集群创建一个增强的审计系统。我们从介绍 Falco 开始这一章，Falco 是 Sysdig 捐赠给 CNCF 的一个审计附件。Falco 增加了 Kubernetes 不包括的审计级别，并与 including auditing 功能相结合，为从 API 访问到 pod 中的操作的所有内容提供了审计跟踪。
如果您不能将日志存储在日志记录系统中，日志就没有用了，该系统允许您将日志存储在持久存储上，并且通常提供一个管理界面来搜索日志和创建仪表板。我们在我们的 KinD 集群上安装了通用的 EFK 栈，并创建了一个自定义仪表板来显示基巴纳的 Falco 事件。
通过本章中学习的主题，您应该对如何将 Falco 添加到集群并使用 EFK 存储日志以及在可视化和仪表板中呈现数据有了很好的基础知识。
虽然日志记录和审核很重要，但在发生灾难时，拥有恢复工作负载的流程也同样重要。在下一章中，我们将介绍来自 Heptio 的开源备份实用程序 Velero。
# 问题
1.  If you need to edit an included Falco rule, which file would you edit?
    A.`falco.yaml`
    B.`falco_rules.yaml`
    C.`falco_rules.changes.yaml`
    D.`falco_rules.local.yaml`
2.  Which of the following is a common log forwarder used by Kubernetes?
    A. 多维数据集向前。
    B. 流利。
    C.货代。
    D.Kubernetes 不使用转发器。
3.  What is the product that provides a way to present logs using visualizations and dashboards when you deploy the EFK stack?
    A.流体
    B. Elasticsearch
    C. 基巴纳
    D.擅长
4.  Which of the following tools forwards only Falco logs to a central logging system?
    A.猎鹰队。
    B.法尔考西迪克。
    C.永恒的 API 服务器。
    D.所有产品都会转发每个日志，而不仅仅是 Falco 日志。
5.  What is the name of the object in Falco that allows you to create a collection of items?
    A.列表
    B.规则
    C.数组
    D.收集**