6）对少数日志采取行动。
忽略应用程序日志
---
## Page 206
参考文献
记录基础设施的价值。
购买、构建和使用工具的时候记住它们很有用。
14.4小结
正常情况”。
法。它们使得组织能够找出日志数据中真正的异常，而不仅仅是“已知的问题”和“已知的
KDD）和虚拟化方法在日志数据上取得了巨大的成功，在本书的其他章节我们讨论了这些方
而且，避免常见的错误将使你的日志管理计划提高到新的水平，增强现有安全性和日志
我们冒昧地定义了一些日志记录领域的普遍真理。在规划和运营与日志相关的项目以及
logging-notes.pdf(retrievedMay2012).
第14章日志法则和日志错误185
---
## Page 207
Ch3第15章
合何种工具取决于所要监控的系统数量以及组织的依从性需求。本章并不打算进行全面的说
件搜索、集中化日志收集，以及加人了依从性相关报告和实时警报的更加健壮的工具。你适
经集成到当今环境中使用的许多服务器和网络设备中。我们将研究开源解决方案和一些好的
15.1概述
本章要点
15.2
志管理的工具和特性。
明，而是讨论当今广为使用的一些日志管理和分析工具，并且提供最适合于你的组织日常日
商业化工具，这些工具帮助你集中、管理和报告环境中的日志。这些工具包括基本的扁平文
日志管理和日志分析工具市场近年来有了显著的增长。许多工具集（如 grep和awk）已
在许多公司中，安全和日志管理不是核心竞争力，是从事业务所需的成本而非收入来
■外包、构建或者购买
■日志分析工具一超越基本
日志分析基本工具
外包、构建或者购买
商业化工具供应商
日志信息集中化实用工具
日志分析和收集工具
---
## Page 208
源和有限的成本开始。与此相关，有一些优势和风险：
望，许多组织选择构建日志管理解决方案。在许多情况下，这种方法使组织可以从现有的资
15.2.1构建一个解决方案
构建或者外包的利弊。
的关键部分。虽然我们不知道在这些事件中，合适的日志管理和日志分析系统起着什么样的
价，也可能造成业务损失。
注意到，如果不选择正确的系统，或者没有足够的资源来监控系统，可能会付出很高昂的代
中有超过1亿7千4百万条记录遭到泄露（Verizon公司，2012年）。这些事故使许多企业
2012年最新的《VerizonBreachReport》中回顾了超过855次事故，结果表明，在这些攻击
源。多年来发生的一些引人注目的安全事故已经加强了安全性低下会付出代价的意识。在
15.2.2
供单一方法更能够满足组织的需求。我们在本章将讨论各种不同的工具，你应该考虑购买、
出购买、构建或者外包的决策。在许多情况下，购买和构建、购买和外包相结合，可能比提
而使公司能够弥补安全漏洞并持续运营中是至关重要的。
作用，但是我们可以断定，快速地审核、关联和分析工具，在识别受影响的系统和客户，从
依从性原则（如支付卡行业数据安全标准PCIDSS）的企业中。日志管理和审核是PCIDSS
日志管理和日志分析系统应该接受和环境中任何关键IT系统一样的认真评估，才能做
最近的许多事故（例如最近的GlobalPayments数据泄密事件）发生在需要遵循最严格的
许多组织可能觉得，构建日志管理系统过于费时，如果系统开发不是公司的核心竞争
优势：
由于开源日志管理解决方案的存在，以及对针对环境和需求定制和调整解决方案的渴
■系统是否能够处理来自组织各系统的日志，是否能够随着组织的成长而扩展？
■你可以完成商业化或者开源解决方案中无法找到的功能，因为在许多情况下，你可以
■如果构建该系统的关键人物离开公司，你能够雇用、保留和训练员工继续维护该系统
■没有第三方支持。你就是支持人员！
■这很有趣！
■获取系统的先期成本有限(甚至没有)。
■你能得到适用于环境的一个系统和解决方案（Chuvakin,2008）。
风险：
吗？
你拥有系统，必须为系统维护和持续满足依从性标准的任何更新分配资源和时间。
你可以选择和设计系统的平台、
修改和更新系统的代码。
购买
、工具和过程。
第15章日志分析和收集工具187
---
## Page 209
188
常运行时间、支持和法律需求。下面是外包时应该考虑的项目：
包是更好的替代方案。正如购买的选项一样，外包使得组织能够满足环境中运营的系统的正
15.2.3外包
面是购买日志管理系统时所应该考虑的。
支持协议和法律需求。由于这些因素和其他一些因素，许多组织寻求购买日志管理系统。
持协议，以保证正常运行时间和法律需求。基于开源产品自行开发的解决方案通常无法满足
力，它们也可能没有资源投入到这些系统的构建和维护中。较大的组织还需要与供应商的支
■组织的数据量可能给供应商带来挑战，在向组织外传输数据时，可能影响你的系统
■由别人操心你的问题，他们可能没有适合你的环境或者依从性需求的背景。
■投人日志管理和审核日志日常活动及其他依从性需求的人员较少。
■外包限制了基础设施占用，外包供应商托管组织中安装的基础设施。
■由别人去操心组织内的日志管理日常任务和依从性需求。这解放了你的资源，以便专
优势：
许多组织发现，
■可能购买服务和现场帮助，协助安装系统和训练内部人员。
■产品更新和改进，包括满足依从性标准更改的更新。
■支持协议通常包含正常运行时间和问题响应时间的服务协议。
■“付现自运”—付款之后，你就能获得一个日志管理和分析需求的解决方案。
风险：
■订购的解决方案支持广泛的日志来源和格式。
优势：
1你的组织有没有这样的员工，具备学习、使用和最大限度发挥所购系统的作用的技
口
风险：
来难以切换日志管理提供商。我们将在第21章中进一步讨论与云供应商相关的细节。
1组织失去了对其数据的控制。如果托管在组织外部，就会存在丢失数据的风险，在未
注于其他核心业务（Chuvakin,2008）。
供应商成熟度、寿命和组织在未来更换供应商的风险。
系统中存在缺口，不能支持环境中安装的应用程序，或者与依从性需求相关的过程。
能？
约束和持续的人员留存及教育成本。
它。你的组织应该考虑这对当前业务优先顺序的影响，
除了初始系统成本之外，你现在将得到一个系统，需要雇用或者训练员工安装和使用
SLA。
系统可能有缺口，不能支持环境中安装的应用程序，或者与依从性需求相关的过程。
，在自身没有能力或者资源构建或者运营／维护所购买的解决方案时，外
以及初始系统成本之外的预算
下
---
## Page 210
的许多搜索工具一样，严重依赖用户了解搜索项或者想要搜索的内容（参见表15.1)。
些文件可以用 grep轻松地搜索，寻找在日常日志审核和取证中有用的信息。grep 和本章介绍
www.cygwin.com/）的一部分。
的 grep forWindows（http://gnuwin32.sourceforge.net/packages/grep.htm），也是Cygwin（http://
15.3.1
此将研究一些这类工具，并提供使用这些工具进行日志分析的例子。
以通过互联网免费下载，或者作为许多组织已经订购的办公室生产力套件的一部分。我们在
务吗？
间？你是否能证明自己有执行这项功能的工具，可以报告谁在何时审核了日志？
或者正则表达式搜索输人文件（IEEE和TheOpenGroup（国际标准开放组织），2004）。
15.3
据吗？
害的（Chuvakin,2008）。
题。
15.2.4
本书的许多日志文件和示例说明，许多系统直接将日志记录为人类可读的文本文件。这
8）你是否能够轻松地证明安全、变更管理和访问控制策略正在使用中且保持最新？
。不管你的组织选择构建、购买或者外包日志管理和分析解决方案，这些问题都是切中要
这个实用程序已经移植到许多其他操作系统，包括Windows，流行的移植版本有GNU
有一些简单而强大的工具内建在Linux/Unix操作系统中，可用于进行日志分析，它们可
grep是大部分Linux和Unix操作系统上都可以找到的命令行实用程序，能够根据模式
7）你能够建立日志数据上下文，并在组织范围内进行关联，用于取证和其他运营任
4）你能在日志的任何内容上设置警报吗？
3）打包的报告是否适合你的需求？你能够创建必要的报告，快速组织收集的日志数
研究本章的工具和解决方案时，考虑如下问题，以及每种工具如何帮助你回答这些问
■访问日志数据可能受限于供应商提供的API和在线数据留存时间。
9）你是否能安全地与其他应用程序及用户共享日志数据？
6）你是否能够对特定的数据执行快速、针对性的搜索？
5）你是否每天查看日志数据，系统是否有能力聚合情报或者减少这些活动耗费的时
2）日志是否安全地传输和保存？
1）你是否收集和聚合了来自网络上所有数据源的全部日志数据？
日志分析基本工具
问题
grep
第15章日志分析和收集工具189
---
## Page 211
190
带宽和协议使用情况
防火墙阻止的通信
在Windows上所要寻找的
失败的用户登录
在Linux/Unix上所要寻找的
内部服务器错误
无效请求
用户认证失败
访问接受用户输人的“危险”页面
看上去像URL一部分的代码（SQL、HTML）
在Web服务器上所要寻找的
管理员访问
用户账户更改
检测到的攻击活动
传输字节数（大文件？）
防火墙上允许的通信
下面的例子选自CiscoASA日志；其他设备的功能类似
对入站和出站活动都要注意
在网络设备上所要寻找的
对象拒绝访问（如果启用审计）
服务启动或者停止
密码更改
用户账户更改
用户登录/注销事件
下面的大部分事件在安全日志中，但是其中许多只在域控制器上记录
服务故障（Chuvakin,2011）
Sudo操作
用户账户更改或者删除
用户注销
在不是你的文件上出现错误码200
Web服务停止/启动/失败消息
对不存在的文件的过度访问
下面列出的事件ID用于Windows2000/XP。Vista/7安全事件ID在这些事件ID上加上4096。
成功的用户登录
访
方问你没有实现的扩展
我们举一个Apache访问日志的例子。在组织内的许多Web服务器日志中，你会发现，
1.使用 grep进行日志分析
表15.1