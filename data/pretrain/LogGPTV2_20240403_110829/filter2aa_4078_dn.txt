可 以在这一层监测或修改数据流。
11.2 TCP/I P 模型
与 OSI 参考模型的 7 层相比较， TCPIIP 模型(也称为 DA盯A或 DOD 模型)仅由 4 层组成。TCPIIP
模型的 4 层为: 应用层、 传输层(也称为主机到主机层)、 网际层(有时称为互联网层)和网络接入层(然
而网络接口层和网络访问层都会被用到)。 图 1 1 .5对TCPIIP 模型 的 4 层结构与 OSI 模型的 7 层结构
进行了 比较。 TCPIIP 协议族是在 OSI 参考模型出现前被开发的。 因为网络连接中 己经部署了 TCPIIP
协议族， 所 以 OSI 参考模型 的设计人员 在设计时注意了确保 TCPIIP 协议族适用该模型的 问题。
TCPIIP 模型的应用层对应于 OSI 模型的第 三 第 6 和第7层。 TCPIIP 模型的主机到主机层对应
于 OSI 模型的第 4 层。 TCPIIP 模型的网际层对应于 OSI 模型的第 3 层。 TCPIIP 模型的网络接入层
对应于 OSI 模型的第 1 层和第 2 层。
后来， 由于混淆、 误解或偷懒， TCPIIP 模型层次的名字往往变得与 OSI 模型层次的名字相同 。
TCPIIP 模型的应用层已经借用 了 OSI 模型的一个层次名 ， 这是轻而易举的。 TCPIIP 模型的主机到
主机层有时被称为传输层(OSI 模型的第 4 层)0 TCPIIP 模型的网际层有时被称为网络层(OSI 模型的
第3层)0 TCP/IP 模型的网络接入层有时被称为数据链路层(OSI 模型的第 2 层)。
305
306
CISSP 官方学 习指南(第 7 版)
OSI 模型 TCPIIP 模型
应用层
表示层
会话层
传输层 主机到主机层
网络层 网 际层
立斗 网络接入层
图 1 1 .5 OSI 模型与 TCPIIP 模型的对比
提示 :
由 于 TCPIIP 模型层次的名 字与 OSI 模型层次的名 字可以交换使用 ， 因此根据各种上下文确 定
所涉及的模型十分重要。 除非专 门指出 ， 我们往往认定讨论的是 OSI 模型 ， 这是因 为 它是最广泛使
用的网 络参考模型 。
1 1 .2.1 TCP/IP 协议族概述
TCPIIP 是使用最广泛的协议， 但它并不是一个单独的协议， 而是一个由许多单独的协议组成的
协议枝(如 图 1 1 .6 所示)0 TCP/IP 是一个基于开放式标准的、 独立于平台 的协议。 然而， 这既是它的
优点， 也是它的缺点。 TCPIIP 几乎可以在所有可用的操作系统中找到 ， 但是它耗用 了相当数量的资
源 ， 并且 由 于其设计 目 的是便于使用而不是安全 ， 因此容易 遭到攻击。
TCP UDP
| 网络层 I I 网 际层
I IGMP
IP
| 时1 1 *j 1…| 令牌环 I FDDI
图 1 1 .6 TCP/lP 模型的 4 个层次及其组成协议
TCPIIP 可 以使用两个系统之间的 VPN 链接进行安全保护。 VPN 链接通过加密增加了 隐私性、
机密'性和身份认证， 并且维护数据的完整性。 用 于建立 VPN 的协议包括点对点隧道协议σPTP)、 二
第 11 章 网络安全架构与保护网络组件
层隧道协议(L2TP)和网 际协议安全(IPSec)。 另一种提供协议级别安全性的方法是采用 TCP 包装。 通
过在用户 D 或系统 D 的基础上限制对端口 和资源的访问， TCP 包装可以作为能够起到基本防火墙
作用 的应用程序 。 TCP 包装是基于端 口 的访问控制形式。
1 . 传输层协议
TCPIIP 两个主要的传输层协议是 TCP 和 UDPo TCP 是一个面向连接的协议， 而 UDP 是一个无
连接的协议。 当一个通信连接在两个系统之间建立起来时 ， 它 通过端 口 的使用完成操作 。 TCP 和
UDP 都有 65 536 个端口。 因 为端 口 号是 16 位二进制数， 所以端口总数为 2^ 1 6 或 65 536， 并且从 0
到 65 535 进行编号。 端口(也被称为套接宇)就是通信链接两端在传输数据时同意使用 的地址号。 端
口 允许单个 IP 地址能够支持多个同时发生的通信 ， 并且每个端 口 都使用 一个不同 的端 口 号 。
这些端 口 中 的前 1 024 个(端口 0-1023)被称为知名端 口 或服务端口 ， 这是由于它们己经按照标准
分配给所支持的服务。 例如， 端 口 80 是用 于 Web(H盯P川专输的标准端口 ， 端 口 23 是用于 Telnet 的
标准端口 ， 端 口 25 是用于 SMTP 的标准端口。 可以在 "通用应用层协议" 部分看到对考试有参考
价值的端 口 列表 。
端口 1024-49151 被称为己注册软件端口。 这些端口具有注册到 IANA(ww观iana.org)的一个或
多个互联软件产品 ， 目 的是为试图连接其产品 的客户 端提供一个标准的端 口 编号系统。
因为通常被客户端随机使用为源端口， 所以端口 491 52-65535 被称为随机端口。 在客户端和服
务器之间协商初始服务或己注册端口 之外的数据传输营造时， 某些网络连接服务也会使用这些随机
端口， 例如通用 FTP 进行的数据传输。
端口编号
IANA 推荐 49 152 到 65 535 之间 的端 口 用 于动态或私有端口。 然而不是所有的 OS 都遵从这个
规定， 例如:
• 伯克利软件分发(BSD)使用 1 024 到 4999 之间 的端 口
• 许多 Linux 内 核使用 32 768到61 000 之间 的端口
• 衍生软公司 Windows Server 2003 及以前的版本使用 1 025 到 5000 之间的端 口
• Windows Vista、 Windows 7 和 Windows Server 2008 使用 IANA 定义的端 口 范 围
• FreeBSD 从 4.6 版本后 ， 使用 IANA 建议的 端 口 范 围
传输控制协议在OSI模型的第4层(传输层)上运作。 这个面向连接的协议能够支持全双工通信，
并且使用 了可靠的会话。 TCP是面向连接的， 这是因为它在两个系统之间使用握手过程建立一个通
信会话。 当握手过程完成时， 就会建立能够在客户端和服务器之间 支持数据传输的通信会话。 这个
三步骤的握手过程(见图11 .7)如下所示:
SYN
SYN/ACK
C S
ACK
图 1 1 .7 TCP 三次握手
307
308
CISSP 官方学习指南(第 7 版)
(1) 客户端向 服务器发送 SYN( 同步)数据包。
(2) 服务器使用 SYN/ACK( 同步和确认)数据包响应客户端。
(3) 客户端使用 ACK(确认)数据包响应服务器。
当通信会话结束时， 可 以使用两种方法断开 TCP 会话连接。 第一种也是最常用的方法是使用
FIN(finish)数据包来代替 SYN 数据包。 一旦所有的数据传输完毕， 会话的每一方都会发送一个 F时
标记包， 触发对方通过一个 ACK 标记包进行确认。 因此， 它 需要4个包来完成一个 TCP 会话。 第
二种方法是使用 RST(reset)数据包， 此类数据包能够使会话立即和突然终止(请参看稍后章节讨论的
TCP 报头标记)。
一个 TCP 传输的信息段是有顺序的 。 在不管接收顺序的情况下， 通过将接收的信息段重新排序
为正常的排列顺序， 接收者就能够重构最初的通信。 TCP 会话的数据通信会使用一个确认信号定期
进行验证。 确认是由接收端反馈给发送端， 通过设置 TCP 报头中 的序列值来确认收到发送方发送窗
口 内最后发送的序列号 。 发送确认数据包之前传输的数据包数被称为传输窗口 。 数据流通过名为滑
动窗口 的机制受到控制。 在发送确认信号之前， TCP 能够使用不同大小的窗 口 (也就是不同的传输数
据包数)。 较大的窗口 允许更快的数据传输速度， 但是只应当被用在数据丢失或损坏最小化的可靠连
接上。 在通信连接不可靠时， 应当使用较小的窗 口 。 在需要数据发送时， 就应当利用 TCP。 因为 TCP
会话的可靠性在使用时会有所变化， 所 以滑动窗 口 允许动态地改变这个大小。 在发送窗 口 的所有数
据包未接收完的情况下， 不会发送任何确认数据包 。 当 时间超时后， 发送方将会重新发送整个传输
窗口中 的 数据包。
与 UDP 协议相 比， TCP 报头相对复杂 。 TCP 报头的长度为 20 到 60 字节， 这个报头被分为若
干部分或宇段， 表 1 1.1 详细描述了 这些内容。
表 1 1.1 TCP 报头构造(按照从报头开始到结束的l顺序)
比特数 字段
16 源端 口
16 目 的端 口
32 序列号
4 数据偏移量
4 预留使用
8 标志(参看表 1 1 .2)
16 窗口大小
16 校验和
16 紧急指针
可变 各种选项; 大小必须是 32 比特的倍数
所有这些宇段都具有独特的参数和要求， 其中大多数字段超出 了CISSP的考试范围。 不过， 你
应当熟悉标志宇段的细节。 标志宇段可以包含对一个或多个标志或控制位的指示项。 这些标志指示
TCP数据包的功能， 并且请求接收方采用特定的方式进行响应。 标志宇段的长度为8比特， 其中每个
比特位置都表示单个标志或控制设置， 使用值1可以设置打开， 使用值0则可 以设置关闭。 有些情况
下， 可 以一次性启用 多个标志(也就是同时设置SYN和ACK标志时TCP三步握手中 的第二个数据包)。
表11.2详细说明 了 标志控制 比特。
第 11 章 网络安全架构与保护网络组件
表 1 1 .2 TCP 报头标记字段值
标志比特指示项 各 字 描述
C WR 拥塞窗 口 大小 用 于管理拥塞链接上的传输， 参看 盯C 3168
ECE ECN-Echo(明 确拥塞通知) 用 于管理拥塞链接上的传输， 参看 盯C 3168
URG 紧 急 指示紧急数据
ACK 确认 确认同步或关闭请求
PSH 推送 指示需要立即 推送数据加 以应用
RST 重宣 导致 TCP 会话立即断开连接