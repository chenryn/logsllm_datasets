# 戴文的Linux内核专题：10 配置内核(6)

## 作者
无

## 类别
技术

## 发布日期
2013-11-23 21:15:00

## 更新日期
2013-11-23 21:15:00

## 摘要
欢迎来到下一篇关于内核配置的文章！本文将重点讨论PCI和ACPI的配置选项。

![](/data/attachment/album/201311/23/211248jqrqtwj8e8rhtteq.png)

### ACPI控制的扩展坞和可移动驱动器槽支持
在本部分中，我们可以启用由ACPI（高级配置与电源管理接口）控制的扩展坞和可移动驱动器槽的支持。ACPI是一种电源管理系统，扩展坞是一种允许其他设备通过额外接口插入的设备，可以容纳多种端口和连接器。一个由ACPI控制的扩展坞意味着其电源管理是通过ACPI进行的。驱动器槽则是一套可以增加硬盘的设备，同样可以由ACPI管理。

### 空闲CPU管理
接下来，我们可以通过ACPI来管理空闲的CPU。这可以让处理器在空闲时进入ACPI C2或C3状态，从而节省电力并降低CPU芯片的温度。只有当处理器完全空闲且没有程序请求特定时间的CPU资源时，才会进入这些状态。

### CPU电源状态
CPU有四个主要的电源状态：C0、C1、C2和C3。C0是操作激活状态；C1（Halt）是一个不执行指令但随时可以恢复的状态；C2（Stop-Clock）是一种断电状态；C3（Sleep）是一种更彻底的断电状态，在这种状态下缓存不再被同步或管理。第五个状态称为C1E（Enhanced Halt State），它具有更低的功耗。

### IPMI驱动
如果启用了IPMI驱动，ACPI可以访问BMC控制器（基板管理控制器）。BMC是一种管理软件和硬件间连接的微控制器。智能平台管理接口（IPMI）是一种框架，通过直接的硬件层面而不是登录shell或操作系统层面来管理计算机。

### ACPI v4.0进程聚合器
ACPI v4.0进程聚合器允许内核应用一个CPU配置到所有系统中的处理器。截至ACPI v4.0，只有idle状态可以用这种方式配置。

### 热区支持
可以启用ACPI热区支持，大多数硬件都支持这一特性。这允许风扇的电源由ACPI管理。

### 自定义DSDT
如果启用此选项，自定义DSDT（系统差异表）可以链接到内核。开发者必须在文件中包含完整的路径名。DSDT包含了系统支持的电源事件信息。通常不需要输入路径名，因为这些表存在于固件中。这个功能主要用于开发者需要使用不同于设备内置表的情况。

### 覆盖ACPI表
任何ACPI表都可以通过initrd来覆盖。ACPI表指示了如何控制并与硬件交互的基本规则和指令。

### 调试信息
像内核的其他部分一样，ACPI系统也可以生成调试信息。为了节省空间，建议禁用这些调试信息。

### PCI插槽检测驱动
启用该特性后，系统会为每个检测到的PCI插槽创建文件（位于`/sys/bus/pci/slots/`目录下）。PCI插槽是在PCI主板上的一个端口，允许用户连接其他PC设备。某些应用程序可能需要这些文件。

### 电源管理定时器
电源管理定时器是另一种电源管理系统，用于追踪时间。它消耗很少的能源，并且不受处理器空闲、电压/频率调节和节流的影响。许多系统需要使用这一特性。

### ACPI模块和容器设备驱动
启用该特性后，可以支持处理器、内存和节点的热插拔。这需要NUMA系统支持。

### 内存热插拔
下面的驱动提供对ACPI内存热插拔的支持。即使启用了这个驱动，有些设备也可能不支持热插拔。如果以模块形式加载，该模块将被`acpi_memhotplug`调用。

### 注意事项
对于内核的某些特定功能，硬件、BIOS和固件必须支持。某些系统的BIOS不控制硬件，通常不会限制这些特性。如果内核确实提供了某个功能，硬件必须能够完成相应的任务。

### 智能电池系统
智能电源管理驱动提供对电池状态和信息的访问。

### 硬件错误设备
该驱动通过SCI报告硬件错误。通常，大多数错误都是已纠正的错误。

### AML方法替换
允许在运行时插入或替换ACPI AML方法，无需重启系统。AML代表ACPI机器语言，可以通过请求重启来改变和测试AML代码。

### APEI
APEI是ACPI的错误接口，从芯片向操作系统报告错误。该接口还提供错误注入能力。

### SFI支持
启用SFI（简单固件接口）支持后，硬件固件可以发送消息给操作系统。固件与操作系统间的通信通过内存中的静态表进行。SFI-only的计算机的内核工作需要这一特性。

### CPU频率调整
启用该特性后，可以改变处理器的时钟速度和运行时。CPU频率调整意味着改变处理器的时钟速度，以节能。

### CPU空闲电源管理
启用该特性后，当处理器不在活跃状态时，它可以处于有效的空闲方式，减少电源消耗和CPU损耗。

### 多个cpuidle驱动支持
在多处理器系统上，用户可以在每个CPU上使用不同的驱动。启用该驱动可以允许用户为每个处理器设置不同的驱动。

### Intel处理器专用驱动
对于Intel处理器，内核有一个专门管理这类CPU芯片空闲的驱动。

### Intel芯片组空闲内存电源管理驱动
该驱动支持IO AT的Intel设备，使内存芯片在空闲时处于低功耗状态。

### PCI支持
不同的计算机使用不同类型的主板，其中一种类型是PCI。该驱动允许内核运行在PCI主板上。

### mmconfig PCI配置空间访问
可以启用或禁用主桥窗口驱动，支持mmconfig PCI配置空间访问。请注意，这个驱动尚未完成（至少在3.9.4版本中是这样）。

### PCIe支持
另一种类型的主板是PCI Express（PCIe），这是一种改进且更快的PCI。该驱动提供对PCIe的支持。

### PCIe热插拔驱动
启用该驱动后，可以支持PCIe主板上的热插拔。

### 根端口高级错误报告
可以启用或禁用根端口高级错误报告（Root Port Advanced Error Reporting），即PCIe AER驱动。

### PCIe ECRC设置控制
该特性允许用户使用PCIe EREC覆盖BIOS和固件设置。下一个选项是对PCIe的错误注入支持（PCIe AER error injector support）。

### PCIe ASPM控制
该设置提供了操作系统控制PCI的活跃状态和时钟电源管理的能力。通常情况下，固件会控制ASPM，但这个特性允许操作系统接管控制。

### ASPM调试支持
与内核的许多组件一样，这里提供了ASPM的调试支持。

### 默认ASPM策略
在这个菜单中选择“默认ASPM策略”。

### 消息信号中断
启用该选项后，允许设备驱动启用消息信号中断（Message Signaled Interrupts (MSI)）。通常情况下，最好允许设备向CPU发送中断。

### PCI调试
为了在系统日志中加入大量的调试信息，可以启用PCI调试。

### PCI资源重分配检测
该选项允许PCI核心检测是否有必要启用PCI资源重分配。

### PCI Stub驱动
在Linux上托管虚拟操作系统时，有时可以使用PCI Stub驱动为虚拟系统保留PCI设备。在系统虚拟化下，一个操作系统可能在另一个系统的内部或并行运行。保留设备可以减少资源竞争并提高性能。

### HyperTransport设备中断
该驱动允许HyperTransport设备使用中断。HyperTransport是一种用于处理器之间高速通信的系统/协议总线。

### PCI IOV支持
该驱动用于PCI虚拟化，允许虚拟设备间共享它们的物理资源。

### PCI PRI支持
PCI页面请求接口（PRI）使在IOMMU之后的PCI设备能够从页错误中恢复。页错误不是一种错误，而是指软件尝试访问不在物理内存上的数据的事件。

在后续文章中，您将看到更多需要配置的Linux内核特性。

---

**译者**: [geekpi](https://github.com/geekpi)  
**校对**: [wxy](https://github.com/wxy)  
**原文**: [via]  
**本文由 [LCTT](https://github.com/LCTT/TranslateProject) 原创翻译，[Linux中国](http://linux.cn/) 荣誉推出**