}
term default {
then accept;
}
}
}
interfaces {
ge-0/0/1 {
unit 0 {
family inet {
filter {
output mirror-all;
}
address 10.200.0.1/24;
}
1247
family iso;
}
}
}
Attachment Points for Filters
Filter Attachment Point Interface Type Mirrored Packet Layer 2 Header
Input Any Ethernet except gr- and fti- Layer 2 header of the incoming
packet is reported
Output Any Ethernet except gr- and fti- Layer 2 header of the incoming
packet is reported
Input or output gr- interface Not supported
Input fti- interface Incoming Layer 2 header of the
original packet (as it was seen on
the WAN port)
Output fti- interface Incoming Layer 2 header of the
original packet (as it was seen on
the WAN port)
Input irb interface Incoming Layer 2 header of the
original packet (as it was seen on
the WAN port)
Output irb interface Not supported
Suggestions for Enhancements to Your Packet-Filtering Configuration
Consider the following as an additional practice to enhance your filter network telemetry setup:
You can use input-chain and output-chain filters to separate the filter configuration used for mirroring
from existing filters, thus helping you to avoid inadvertent configuration errors while troubleshooting.
For details of this feature, see Example: Using Firewall Filter Chains.
1248
Troubleshooting Port Mirroring
IN THIS SECTION
Troubleshooting Port Mirroring | 1248
Troubleshooting Port Mirroring Configuration Error Messages | 1250
Troubleshooting Port Mirroring
IN THIS SECTION
Egress Port Mirroring with VLAN Translation | 1248
Egress Port Mirroring with Private VLANs | 1249
Egress Port Mirroring with VLAN Translation
IN THIS SECTION
Problem | 1248
Solution | 1249
Problem
Description
If you create a port-mirroring configuration that mirrors customer VLAN (CVLAN) traffic on egress and
the traffic undergoes VLAN translation before being mirrored, the VLAN translation does not apply to
the mirrored packets. That is, the mirrored packets retain the service VLAN (SVLAN) tag that should be
replaced by the CVLAN tag on egress. The original packets are unaffected—on these packets VLAN
translation works properly, and the SVLAN tag is replaced with the CVLAN tag on egress.
1249
Solution
This is expected behavior.
SEE ALSO
Understanding Q-in-Q Tunneling and VLAN Translation
Egress Port Mirroring with Private VLANs
IN THIS SECTION
Problem | 1249
Solution | 1250
Problem
Description
If you create a port-mirroring configuration that mirrors private VLAN (PVLAN) traffic on egress, the
mirrored traffic (the traffic that is sent to the analyzer system) has the VLAN tag of the ingress VLAN
instead of the egress VLAN. For example, assume the following PVLAN configuration:
• Promiscuous trunk port that carries primary VLANs pvlan100 and pvlan400.
• Isolated access port that carries secondary VLAN isolated200. This VLAN is a member of primary
VLAN pvlan100.
• Community port that carries secondary VLAN comm300. This VLAN is also a member of primary
VLAN pvlan100.
• Output interface (monitor interface) that connects to the analyzer system. This interface forwards
the mirrored traffic to the analyzer.
If a packet for pvlan100 enters on the promiscuous trunk port and exits on the isolated access port, the
original packet is untagged on egress because it is exiting on an access port. However, the mirror copy
retains the tag for pvlan100 when it is sent to the analyzer.
1250
Here is another example: If a packet for comm300 ingresses on the community port and egresses on the
promiscuous trunk port, the original packet carries the tag for pvlan100 on egress, as expected.
However, the mirrored copy retains the tag for comm300 when it is sent to the analyzer.
Solution
This is expected behavior.
Troubleshooting Port Mirroring Configuration Error Messages
IN THIS SECTION
An Analyzer Configuration Returns a “Multiple interfaces cannot be configured as a member of
Analyzer output VLAN” Error Message | 1250
Troubleshooting issues with port mirroring on EX Series switches:
An Analyzer Configuration Returns a “Multiple interfaces cannot be configured as a member of
Analyzer output VLAN” Error Message
IN THIS SECTION
Problem | 1250
Solution | 1251
Problem
Description
In an analyzer configuration, if the VLAN to which mirrored traffic is sent contains more than one
member interface, the following error message is displayed in the CLI when you commit the analyzer
configuration and the commit fails:
Multiple interfaces cannot be configured as a member of Analyzer output VLAN 
1251
Solution
You must direct the mirrored traffic to a VLAN that has a single member interface. You can do this by
completing either of these tasks:
• Reconfigure the existing VLAN to contain a single member interface. You can choose this method if
you want to use the existing VLAN.
• Create a new VLAN with a single member interface and associate the VLAN with the analyzer.
To reconfigure the existing VLAN to contain only one member interface:
1. Remove member interfaces from the VLAN repeatedly by using either the delete vlan command or
the delete interface command until the VLAN contains a single member interface:
• [edit]
user@switch# delete vlan vlan-id interface interface-name
• [edit]
user@switch# delete interface interface-name unit 0 family family-name vlan member vlan-id
2. (Optional) Confirm that the VLAN contains only one interface:
[edit]
user@switch# show vlans vlan-name
The output for this command must display only one interface.
To create a new VLAN with a single member interface:
1. Configure a VLAN to carry the mirrored traffic:
[edit]
user@switch# set vlans vlan-name
2. Associate an interface with the VLAN:
[edit]
user@switch# set interfaces interface-name unit logical-unit-number family family-name vlan
members vlan-name
1252
3. Associate the VLAN with the analyzer:
[edit ethernet-switching-options]
user@switch# set analyzer analyzer-name output vlan vlan-name
10
PART
System Log Messages
Overview of System Logging | 1254
System Logging on a Single-Chassis System | 1266
System Logging for a TX Matrix or TX Matrix Plus Router | 1289
Direct System Log Messages to a Remote Destination | 1310
Display System Log Files | 1325
Configure System Logging for Security Devices | 1330
Configure Syslog over TLS | 1362
Monitor Log Messages | 1372
1254
Overview of System Logging
SUMMARY IN THIS SECTION
This section describes the system log messages that System Log Overview | 1254
identify the Junos OS process responsible for
System Logging Facilities and Message
generating the message and provides a brief
Severity Levels | 1256
description of the operation or error that occurred.
Default System Log Settings | 1258
Platform-Specific Default System Log
Messages | 1260
Interpret Messages Generated in Standard
Format | 1261
Manage Host OS System Log and Core
Files | 1263
System Log Overview
Junos OS generates system log messages (also called syslog messages) to record events that occur on
the device, including the following:
• Routine operations, such as creation of an Open Shortest Path First (OSPF) protocol adjacency or a
user login to the configuration database.
• Failure and error conditions, such as failure to access a configuration file or unexpected closure of a
connection to a peer process.
• Emergency or critical conditions, such as power-down of the device due to excessive temperature.
Each system log message identifies the Junos OS process responsible for generating the message and
provides a brief description of the operation or error that occurred. For detailed information about
specific system log messages, see the System Log Explorer.
To configure the device to log system messages, configure the syslog statement at the [edit system]
hierarchy level.
In Junos OS Release 17.3R1, the syslog-event daemon handles the fxp0 in dedicated management
routing instance for IPv4 addressed remote host. In Junos OS Release 18.1R1, the syslog-event daemon
supports IPv6-based configuration when connecting to a remote host or an archival site and fxp0 is
1255
moved to dedicated management instance. In Junos OS Release 18.4R1, the syslog client can send
messages through any routing instance that you define at appropriate hierarchies. See routing-instance
(Syslog).
NOTE: This topic describes system log messages for Junos OS processes and libraries and not
the system logging services on a Physical Interface Card (PIC) such as the Adaptive Services PIC.
In Junos OS Evolved, each node has the standard journalctl tool, which is an interface to retrieve and
filter the system journal. System log messages are extracted from the system journal. The relay-eventd
process runs on all nodes and retrieves events (based on the syslog configuration) from the system
journal as well as error messages from the different applications and forwards them to the master-eventd
process. The master-eventd process runs on the primary Routing Engine and writes the log messages and
errors to disk.
Use the System Log Explorer application to view or compare system log messages in different releases.
In Junos OS Evolved there is no messages file on the backup Routing Engine. All backup Routing Engine
logs are in the messages file on the primary Routing Engine node.
By default, Junos OS Evolved appends the node name to the hostname in system log messages; Junos
OS does not. This action keeps Junos OS Evolved system log messages compliant with RFC5424.
However, some monitoring systems may not identify a Junos OS Evolved hostname correctly, because
the hostname-node name combination does not match any hostnames in the inventory of hostnames.
Starting in Junos OS Evolved Release 20.4R2, to ensure accurate identification of Junos OS Evolved
hostnames in your monitoring system, use the set system syslog alternate-format configuration mode
command. This command changes the format of the Junos OS Evolved system log messages. The node
name is prepended to the process name in the message rather than appended to the hostname, thereby
allowing the monitoring system to identify the hostname correctly.
For example, Junos OS system log messages do not print the origin process in system log messages
coming from an FPC:
user@mxhost> show log messages
Dec 19 13:22:41.959 mxhost chassisd[5290]: CHASSISD_IFDEV_DETACH_FPC: ifdev_detach_fpc(0)
Dec 19 13:23:22.900 mxhost fpc2 Ukern event counter Sock_tx init delayed
However, Junos OS Evolved messages append the node name to the hostname and do print the origin
process for messages coming from a node, including FPCs:
user@ptxhost-re0> show log messages
May 25 18:41:05.375 ptxhost-re0 mgd[16201]: UI_CHILD_STATUS: Cleanup child '/usr/sbin/
1256
dot1xd', PID 21322, status 0
May 25 18:42:34.632 ptxhost-fpc0 evo-cda-bt[14299]: Register bt.igp_misc.debug.hdr_length_cnt
not found
May 25 18:42:34.753 ptxhost-fpc1 evo-cda-bt[14427]: HBM: hbm_gf_register_inst
May 25 18:47:14.498 ptxhost-re0 ehmd[5598]: SYSTEM_APP_READY: App is ready re0-ehmd
If you have configured the alternate format for Junos OS Evolved system log messages, the same set of
system log messages would look like this instead, with the hostname by itself:
user@ptxhost-re0> show log messages
May 25 18:41:05.375 ptxhost re0- mgd[16201]: UI_CHILD_STATUS: Cleanup child '/usr/sbin/
dot1xd', PID 21322, status 0
May 25 18:42:34.632 ptxhost fpc0- evo-cda-bt[14299]: Register bt.igp_misc.debug.hdr_length_cnt
not found
May 25 18:42:34.753 ptxhost fpc1- evo-cda-bt[14427]: HBM: hbm_gf_register_inst
May 25 18:47:14.498 ptxhost re0- ehmd[5598]: SYSTEM_APP_READY: App is ready re0-ehmd
Starting in Junos OS Release 22.1R1 on SRX Series and NFX Series devices and Junos OS Evolved
Release 22.2R1 on QFX5130, QFX5200, QFX5220, and QFX5700 devices, we’ve added multiple events
inside the event tag using the UI_LOGIN_EVENT|UI_LOGOUT_EVENT format, which has an option (|)
to separate the events and to generate system log messages. Earlier to these releases, the event tag
used the UI_LOGIN_EVENT UI_LOGOUT_EVENT format and for various combinations of  rpc filters was not getting logged.
System Logging Facilities and Message Severity Levels
Table 125 on page 1256 lists the Junos OS system logging facilities that you can specify in configuration
statements at the [edit system syslog] hierarchy level.
Table 125: Junos OS System Logging Facilities
Facility (number) Type of Event or Error
kernel (0) The Junos OS kernel performs actions and encounters errors.
user (1) User-space perform actions or encounter errors.
1257
Table 125: Junos OS System Logging Facilities (Continued)
Facility (number) Type of Event or Error
daemon (3) System perform actions or encounter errors.
authorization (4) Authentication and authorization attempts.
ftp (11) FTP performs actions or encounters errors.
ntp (12) Network Time Protocol performs actions or encounters errors.
security (13) Security related events or errors.
dfc (17) Events related to dynamic flow capture.
external (18) The local external applications perform actions or encounter errors.
firewall (19) The firewall filter performs packet filtering actions.
pfe (20) The Packet Forwarding Engine performs actions or encounters errors.
conflict-log (21) Specified configuration is invalid on the router type.
change-log (22) Changes to the Junos OS configuration.
interactive-commands A client application such as a Junos XML protocol or NETCONF XML client issues
(23) commands at the Junos OS command-line interface (CLI) prompt.
Table 126 on page 1258 lists the severity levels that you can specify in configuration statements at the
[edit system syslog] hierarchy level. The levels from emergency through info are in the order from highest
severity (greatest effect on functioning) to lowest.
Unlike the other severity levels, the none level disables logging of a facility instead of indicating how
seriously a triggering event affects routing functions. For more information, see "Disabling the System
Logging of a Facility" on page 1285.
1258
Table 126: System Log Message Severity Levels
Value Severity Level Description
N/A none Disables logging of the associated facility to a destination.
0 emergency System panic or other condition that causes the router to stop functioning.
1 alert Conditions that require immediate correction, such as a corrupted system
database.
2 critical Critical conditions, such as hard errors.
3 error Error conditions that generally have less serious consequences than errors at
the emergency, alert, and critical levels.
4 warning Conditions that warrant monitoring.
5 notice Conditions that are not errors but might warrant special handling.
6 info Events or non-error conditions of interest.
7 any Includes all severity levels.
Default System Log Settings
Table 127 on page 1259 summarizes the default system log settings that apply to all routers that run the
Junos OS and specifies which statement to include in the configuration to override the default value.
1259
Table 127: Default System Logging Settings
Setting Default Overriding Statement Instructions
Alternative For change-log: local6 "Changing the Alternative Facility
facility for [edit system syslog] Name for System Log Messages
message For conflict-log: local5 host hostname { Directed to a Remote
forwarded to a facility-override Destination" on page 1318
For dfc: local1
remote machine facility;
}
For firewall: local3
For interactive-commands:
local7
For pfe: local4
Format of Standard Junos OS format, "Logging Messages in Structured-
messages logged based on UNIX format [edit system syslog] Data Format" on page 1274
to a file file filename {
structured-data;
}
Maximum 10 "Specifying Log File Size,
number of files in [edit system syslog] Number, and Archiving
the archived set archive { Properties" on page 1274
files number;
}
file filename {
archive {
files number;
}
}
Maximum size of M Series, MX Series, and T "Specifying Log File Size,
the log file Series: 1 megabyte (MB) [edit system syslog] Number, and Archiving
archive { Properties" on page 1274
TX Matrix: 10 MB
size size;
}
file filename {
archive {
size size;
}
}
1260
Table 127: Default System Logging Settings (Continued)
Setting Default Overriding Statement Instructions
Timestamp Month, date, hour, minute, "Including the Year or Millisecond
format second [edit system syslog] in Timestamps" on page 1280
time-format format;
For example: Aug 21 12:36:30
Users who can root user and users with the "Specifying Log File Size,
read log files Junos OS maintenance [edit system syslog] Number, and Archiving
permission archive { Properties" on page 1274
world-readable;
}
file filename {
archive {
world-readable;
}
}
Platform-Specific Default System Log Messages
The following messages are generated by default on specific routers. To view any of these types of
messages, you must configure at least one destination for messages as described in "Junos OS Minimum
System Logging Configuration" on page 1269.
• To log the kernel process message on an M Series, MX Series, or T Series router, include the kernel
info statement at the appropriate hierarchy level:
[edit system syslog]
(console | file filename | host destination | user username) {
kernel info;
}
• On a routing matrix composed of a TX Matrix router and T640 routers, the primary Routing Engine
on each T640 router forwards all messages with a severity of info and higher to the primary Routing
1261
Engine on the TX Matrix router. This is equivalent to the following configuration statement included
on the TX Matrix router:
[edit system syslog]
host scc-master {
any info;
}
• Starting in Junos OS Release 15.1X49-D10 and Junos OS Release 17.3R1, likewise on a routing
matrix composed of a TX Matrix Plus router with connected T1600 or T4000 routers, the primary
Routing Engine on each T1600 or T4000 LCC forwards to the primary Routing Engine on the TX
Matrix Plus router all messages with a severity of info and higher. This is equivalent to the following
configuration statement included on the TX Matrix Plus router:
NOTE: From the perspective of the user interface, the routing matrix appears as a single
router. The TX Matrix Plus router controls all the T1600 or T4000 routers connected to it in
the routing matrix.
[edit system syslog]