### 发送策略列表
发送策略列表展示发送策略名称，发送条件，使用插件，编辑操作和删除操作。
![cruxee send policy](media/image103.png){width="5.833333333333333in"
height="1.829332895888014in"}
### 通道插件
Cruxee提供默认插件：incident_email，ping_host。
cruxee也支持用户上传自己的告警插件：短信/微信告警，电话通知等。点击\"通道插件\"，进入插件列表页，可以看到已有的插件，也可以上传新的插件。
![cruxee plugin list](media/image104.jpeg){width="5.833333333333333in"
height="1.1884437882764654in"}
点击插件列表的\"上传插件\"，弹出悬浮层，选择插件类型：事件通知、事件操作。上传编写好的插件文件，点击上传，完成。通常如果告警插件是邮件告警、syslog告警、HTTP告警，短信/微信告警、电话通知等，插件类型选择事件通知。如果是ping_host插件，插件类型选择事件操作。
![cruxee plugin upload](media/image105.jpeg){width="5.833333333333333in"
height="3.459549431321085in"}
用户可以开发自定义插件，详情请见《日志易监控告警手册》中的\"告警插件开发\"章节。
### 新建发送策略
点击发送策略列表页的\"新建\"，进入新建发送策略页面，可以看到发送策略拥有如下属性：
![cruxee new send
policy](media/image106.png){width="5.833333333333333in"
height="2.6344083552055992in"}
-   策略名称：必填策略名称。
-   延迟等待时间：合并开始后不立刻发邮件，延迟一段时间后再发，默认30s。
-   发送条件：
    -   incident变更时发送：incident状态，评论，分配变更是否发送
    -   默认incident新增event发送告警。
-   通道插件：可以设置不同优先级关联不同插件，优先级和插件是多对多的关系，一个发送策略可以应用到多个incident，incident的优先级不同则使用的发送插件不同。
## 处理统计
通过设置时间（周/月/季度）和及时率，针对incident被处理的操作用户，展示该用户对incident的操作表现。由于不同公司对incident的处理完成时限要求不一样痛殴点击设置及时率的阈值。
![cru processing
statistics](media/image107.jpeg){width="5.833333333333333in"
height="2.0719991251093615in"}
在展示列表内，通过五个参数进行展示：
1.  处理事件总量：在时间和分组条件范围内，该用户处理或忽略的事件历史总量。
2.  高级事件数量：在时间和分组条件范围内，该用户处理或忽略的高级事件历史总量。
3.  高级事件及时处理量：在时间和分组条件范围内，该用户及时处理或忽略的高级事件历史总量。
4.  处理用时分布：分为30个区间，表示在时间和分组条件范围内，该用户处理或忽略每一条：事件的用时范围，以概率分布的直方图形式展现。其中第一个区间是用户最快处理或忽略的用时，最后一个区间是用户最慢处理或忽略的用时，可以鼠标悬停查看每个用时区间内用户处理的事件历史个数。
5.  高级事件及时率：
    在时间范围内，按照选择的及时标准，针对于一级事件进行及时率的计算。其中及时标准分为：15分钟内，1小时内，当天处理和48小时内。即处理或忽略的用时在及时标准内的操作，都算及时。可以在表头操作小图标上点击切换。高级事件及时率=高级事件及时处理量/高级事件总量。
## 策略统计
该页面可根据所选配置，包含时间（今天/周/月/季度）和计算方法，统计各合并策略分组内事件状态的等级分布，以及浮动涨跌幅。
各分组通过点击下拉符号""，默认为收起，可对不同组进行配置。在选择了与总控制项不同的内容情况下，总控制项勾选的特征会被分组内的配置参数取代。
![cru strategy
statistics](media/image108.jpeg){width="5.833333333333333in"
height="3.1914009186351704in"}
如上图，每个合并策略类型的卡片内的统计内容主要分两部分：
1.  等级分布条：用来展示一个相对占比，且长度仅限用于该类型内的比较。当光标移动在长条上方时，显示光标位置的颜色对应等级的"事件数量"和"所占比率"。
2.  同/环比浮动：事件级别下事件统计个数在选定的时间条件内的增长率。例：时间条件选择\"今天\"，事件级别为\"重要\"的事件项，今天有5条，昨天有10条，则其\"环比浮动\"为-50%。
### 默认值
1.  时间：默认以"今天"为展示页面，数据不足以计算同比、环比时，则显示"暂无数据"。
2.  同比环比：默认为均不选。
### 同环比
假设今天（2017年6月15号，星期四，下午12:32）查看，则：
  --------------------------------------------------------------------------------------------------------- --------------------------------------------- ---------------------------------------------------- ----------------------------------------
  同比                                                                                                      同比实例                                      环比                                                 环比实例
  今天                                                                                                      与上周的这天，从0点到当前时间的比较           跟2017年6月8号0点到12:32的数据                       与昨天，0点到当前时间的比较
  跟2017年6月14号0点到12:32的数据                                                                           周                                            与本周从周一开始到今天对应的上个月相同的日期比较     跟2017年5月12号0点到5月15号12:32的数据
  与上周从周一开始到今天周几的日期比较                                                                      跟2017年6月5号0点到8号12:32的数据             月                                                   与去年的本月一号到今天这段时间的比较
  跟2016年6月1号0点到15号12:32的数据                                                                        与上个月1号到今天对应的上个月的相同日期比较   跟2017年5月1号0点到15号12:32的数据                   季度
  跟去年的该季度的一号到今天这段时间比较。一年有四个季度，季度起始日分别为1月1日，4月1日，7月1日，10月1日   跟2016年4月1号0点到6月15号12:32的数据         上个季度的起始日到今天对应的上个季度的相同日期比较   跟2017年1月1号0点到3月15号12:32的数据
  --------------------------------------------------------------------------------------------------------- --------------------------------------------- ---------------------------------------------------- ----------------------------------------
## 数据对接
Cruxee接收的事件必须满足AlertCEF格式。您可以使用curl命令上传数据，示例如下：
>     curl -X POST http://{cruxee服务所在地址}:9081/alert_cefs \
>     '{
>         "custom_info": {
>             "alert_id": 75,
>             "alert_name": "【事件数告警】-定时-1分钟-搜索结果数触发告警--基本配置",
>             "check_interval_sec": 10,
>             "content": {......}
>         },
>         "domain_id": 1,
>         "agent": "rizhiyi",
>         "agent_location": "",
>         "agent_time": "2019-09-18T16:20:20.291+0800",
>         "event_class": "naname,test",
>         "event_id": "1_0000000",
>         "event_type": "rizhiyi",
>         "manager": "rizhiyi",
>         "priority": "minor",
>         "signature": "rizhiyi_1_75_1568797040267",
>         "source": "",
>         "source_id": "",
>         "summary": "",
>         "use_alert_sender": false,
>         "use_incident_sender": true,
>         "name": "【事件数告警】-定时-1分钟-搜索结果数触发告警--基本配置"
>     }'
其中cruxee服务所在地址可以通过manager查看，如192.168.1.111。
如上例所示，AlertCEF格式需满足以下要求字段：
-   domain_id：域名id，整数类型，不能为空，例如：1，2。
-   name：监控名称，字符串类型，可以为空，rizhiyi使用alert_name。
-   signature：AlertCEF唯一标识符，不可重复，不能为空，字符串类型，举例：rizhiyi_1\_14300xxxx_appname_appname123。
-   alert_id：监控id，整数类型，可以重复可以为空，rizhiyi使用alert_id，从AlertCEF添加请求的custom_info中抽取。
-   event_id：监控记录id，监控每触发一次生成一个监控记录。字符串类型，不能为空，rizhiyi使用alertid_时间戳。
-   source：日志来源，如软件名称，如数据库名称。字符串类型，不能为空，可以为空字符串，rizhiyi使用设备切分的设备值，举例：appname:appname123。
-   source_id：告警（Alert）来源标识，如IP,MAC等有标示性的真实数据。字符串类型，不能为空，可以为空字符串。推荐使用日志产生的机器IP。
-   manager：事件生成器/代理管理器名称，如Nagios,
    SCOM。字符串类型，可以为空，日志易使用rizhiyi。
-   event_class：告警分类/分组/标签，字符串类型，不能为空，可以为空字符串。如果多个分组/标签用逗号分割，举例：naname,test
-   event_type：更大范围的告警分类，字符串类型，不能为空，可以为空字符串，日志易使用rizhiyi，表示来自rizhiyi的告警。
-   agent：创建事件的特定代理，字符串类型，不能为空，日志易使用rizhiyi。
-   agent_location：agent所在位置，如New
    York，BeiJing等，字符串类型，不能为空，日志易使用空字符串。
-   agent_time：告警记录产生时间，DateTime类型，如2019-09-18T16:20:20.291+0800，不能为空。
-   summary：告警概括描述，作为通用模板，举例：PING OK - Packet loss =
    0%, RTA = 1.41 ms。字符串类型，不能为空，日志易使用alert
    的description，可以发送空字符串。另，summary作为incident的sub_title。
-   use_alert_sender：是否对告警发邮件等各类消息，原来的监控触发告警发送邮件、短信等。boolean类型，可以为空，为空时默认false。
-   use_incident_sender：是否走合并流程，并且发Incident邮件等。boolean类型，可以为空，为空时默认false。通常使用合并流程，该值设为true。
-   custom_info：包含告警的各种字段，用于逻辑判断，发邮件等。字符串类型，可以为空。详见custom_info结构说明章节。
-   priority：优先级，枚举类型，不能为空。枚举成员有{clear, undefined,
    warning, minor, major, critical}，对应的中文是{告警恢复, 较低, 一般,
    中级, 重要, 严重}。日志易使用{warning，minor，major，clear}
-   status：AlertCEF的状态，跟随Incident改变。枚举类型，不能为空，默认\"active\"，不需要传。枚举成员有{active,
    processing, resolved, closed}，解释如下：
    -   active：处于等待分配的状态
    -   processing：已经分配，正在处理中
    -   resolved：分配者已经处理完成该Incident
    -   closed：忽略，关闭，不接收告警
### custom_info结构说明
custom_info是AlertCEF的组成字段，包含告警的各种字段，用于逻辑判断，发邮件等。字符串类型，可以为空。
注意：如果接入的是外部系统的数据，此项无数据，则不能发送邮件等告警信息，需要自己写相关的插件
以日志易的告警格式为例，说明custom_info包含的字段。
-   alert_id：监控的id
-   alert_name：监控的名称
-   check_interval_sec：监控触发时间间隔，用于默认合并策略的告警连续逻辑判断
-   content：alert产生的告警结构，见下面的示例，详见《日志易监控告警手册》的\"告警内容可用变量\"章节。
```{=html}
```
>     "custom_info": {
>             "alert_id": 75,
>             "alert_name": "【事件数告警】-定时-1分钟-搜索结果数触发告警--基本配置",
>             "check_interval_sec": 10,
>             "content": {
>                 "data": {
>                     "_alert_domain_id": 1,
>                     "_alert_domain_token": "1f0d166ab3e82d812fa2ed26aebdb0ac",
>                     "_alert_id": 75,
>                     "_alert_owner_id": 1,
>                     "_alert_owner_name": "owner",
>                     "_alert_plugins": [],
>                     "check_interval": 10000,
>                     "description": "",
>                     "exec_time": 1568797037934,
>                     "extend_conf": {},
>                     "graph_enabled": false,
>                     "is_alert_recovery": false,
>                     "is_segmentation": false,
>                     "level": "low",
>                     "name": "【事件数告警】-定时-1分钟-搜索结果数触发告警--基本配置",
>                     "result": {
>                         "hits": [
>                             {
>                                ......
>                             },
>                             {
>                                 ......
>                             }
>                         ],
>                         "total": 10,
>                         "value": 10,
>                     },
>                     "search": {
>                         "query": "*"
>                     },
>                     "segmentation_field": "",
>                     "send_time": 1568797040267,
>                     "strategy": {
>                         "description": "事件数告警",
>                         "name": "count",
>                         "trigger": {
>                             "alert_thresholds": "{\"high\":[3.0],\"low\":[1.0],\"mid\":[2.0]}",
>                             "compare": ">",
>                             "compare_style": "fixed",
>                             "compare_value": [
>                                 3
>                             ],
>                             "end_time": 1568795237880,
>                             "level": "high",
>                             "method": "count",
>                             "start_time": 1568795237880
>                         }
>                     }
>                 },
>                 "result": true,
>                 "trace_id": "event_count_job_7"
>             }
>         }