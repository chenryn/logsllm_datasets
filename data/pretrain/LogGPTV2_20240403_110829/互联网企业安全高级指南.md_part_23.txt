ueu-3o1/eA/uaed-sa7a-2t1:3tmsf.Zxoona
-172-19-254-253.use1.opsec.mozi11a.con /var/iog/secure [1astmodified:2015-421 14:36:56.22
[1astmodified:2e15-0421 14:23:04
e[last
modified:2015-04-21 14:15:23.751627611
"ch's1
UTC.
mod
ozilla.com
nodified:2015-8421 14:38: 22.177328882 +00ee
,size:698187] in search 's1'
[ulfrefedbox2~]s
同样，如果你得知discuz某个版本的程序有漏洞，你可以通过文件指纹（SHA256哈希
值或其他）迅速查找匹配的机器，用以调查哪些地方需要修补。
总体上对于教火而言MIG是利器
8.1.3 OSquery
Facebook的开源项目OSquery这个东西在国内比较冷门，它不能算是完全的HIDS，
也不能说是完全为了安全而设计的，有一部分应该是出于运维的需求。它的实现是把操作
系统当做一个数据库，各种系统信息可以用SQL语句的方式来查询，如下所示：
一般人可能不会把它联想到是一个安全强相关的系统，但是我们摘取一些它支持的查
询项来看：
>_ SELECT address, mac, id.interface
FROM interface_details AS id, interface_addresses AS ia WHERE id.interface = ia.interface;
---
## Page 144
132技术篇
com.apple.kec.corecrypto
com.apple.iokit.IOACPIFanily
c134567
com.apple.iokit.IOPCIFamily
346
SELECT
u.username,
g.name as groupname,
u.directory.
u.description
.>
J0IN groups AS g ON u.gid - g.gid
LIMIT5;
groupnane
Idirectory
description
avisd
amavisd
/var/virusmails
AMaViS Daenon
appleevents
appleevents
/var/
AppleEvents D
Application Server
Application Owner
ard
pue
/var/enpty
Apple Remote Desktop
jery>
-exit
exit
socket_events
Track network socket opens and closes.
Column
Type
Description
action
TEXT_TYPE
The socket action (bind, listen, close)
pid
BIGINT_TYPE
Process (or thread) ID
path
TEXT_TYPE
Path of executed file
fd
TEXT_TYPE
The file description for the process socket
INTEGER_TYPE
The socket open attempt status
family
INTEGER_TYPE
The Intermet protocol family ID
protocol
INTEGER_TYPE
The network protocol ID
1ocal_address
TEXT_TYPE
Local address associated with socket
remote_address
TEXT_TYPE
Remote address associated with socket
1ocal_port
INTEGER_TYPE
Local network protocol port number
remote_port
INTEGER_TYPE
Remote network protocol port number
socket
TEXT_TYPE
The local path (UNIX domain socket only)
time
BIGINT_TYPE
Time of execution in UNIX time
BIGINT_TYPE
Time of execution in system uptime
---
## Page 145
第8章入侵感知体系133
file_events
Track time/action changes to files specified in configuration data
Column
Type
Description
target_path
TEXT_TYPE
The path associated with the event
category
TEXT_TYPE
The category of the file defined in the config
action
TEXT_TYPE
Change action (UPDATE, REMOVE, elc)
transaction_id
BIGINT_TYPE
ID used during bulk update
inode
BIGINT_TYPE
Filesystem inode number
uid
BIGINT_TYPE
Owning user ID
gid
BIGINT_TYPE
Owning group ID
node
TEXT_TYPE
Permission bits
size
BIGINT_TYPE
Size of file in bytes
atime
BIGINT_TYPE
Last access time
mtime
BIGINT_TYPE
Last modification time
ctime
BIGINT_TYPE
Last status change time
md5
TEXT_TYPE
The MD5 of the file after change
sha1
TEXT_TYPE
The SHA1 of the file after change
sha256
TEXT_TYPE
The SHA256 of the file after change
hashed
INTEGER_TYPE
1 if the file was hashed, 0 if not, -1 if hashing failed
time
BIGINT_TYPE
Time of file event
process_events
Track time/action process executions.
Column
Type
Description
pid
BIGINT_TYPE
Process (or thread) ID
path
TEXT_TYPE
Path of executed file
mode
BIGINT_TYPE File mode permissions
cnd1ine
TEXT_TYPE
Command line arguments (argv)
cmdline_size
BIGINT_TYPE
Actual size (bytes) of command line arguments
environment
TEXT_TYPE
Environment variables delimited by spaces
environment_count
BIGINT_TYPE Number of environment variables
environment_size
BIGINT_TYPE Actual size (bytes) of environment list
---
## Page 146
134技术篇
Column
Type
Description
uid
BIGINT_TYPE User ID at process start
prna
BIGINT_TYPE Effective user ID at process start
gid
BIGINT_TYPE Group ID at process start
praa
BIGINT_TYPE Effective group ID at process start
BIGINT_TYPE File owner user ID
BIGINT_TYPE File owner group ID
create_time
BIGINT_TYPE File creation in UNIX time
access_time
BIGINT_TYPE File last access in UNIX time
modify_time
BIGINT_TYPE File modification in UNIX time
BIGINT_TYPE File last metadata change in UNIX time
overf1ows