Data:ServiceplanSP,localconstraintsLC,candidatesSResult:OptimalcandidateindexρforSP.nl=|SLT|;nf=|SFT|;n=nl+nf;ni=|SFTi|;mi=|Si|;1for(i=1;i≤nl;i++)do2for(j=1;j≤mi;j++)do3if∀x(qxij≤lcxi)thenuij=utility(qij);4end5ifnocandidatemeetlcithenThrowexception;6uix=min{uij};7ρi=x;8end9for(i=nl+1;i≤n;i++)do10for(j=1;j≤mi;j++)do11if∀x∀y(qxiyj≤lcxiy)then12q=flowQoS(SP,qi1j,..,qinij);13uij=utility(q);14end15end16ifnocandidatemeetlcithenThrowexception;17uix=min{uij};18foralltasksinSFTidoρik=x;19end20Algorithm2:FTSelectionwithLocalConstraints•xij∈{0,1}TosolveProblem1,foreachtaskti,weﬁrstusetheformulainTable1tocalculatetheQoSvaluesofthefaulttolerancestrategycandidates.Thenthecandidateswhichcannotmeetthelocalconstraintsareexcluded.Afterthat,theutilityvaluesofthecandidatesarecalculatedbyEqua-tion2.Finally,thecandidatesixwiththebestutilityvaluewillbeselectedastheoptimalcandidatefortibysettingρi=x.Whenaserviceplancontainsstatefultasksandneedstomaintainstatesacrossmultipletasks,thestate-relatedtasksneedtoemployoperationsprovidedbythesameWebservice(e.g.,wecannotlogininoneWebserviceandlogoutinanotherone).Algorithm2isdesignedtose-lectoptimalcandidatesforaserviceplan,whichincludesstatelesstasks(SLT={ti}nli=1)aswellasstatefultasks(SFT={SFTi}ni=nl).Algorithm2ﬁrstselectsoptimalcandidatesforthestatelesstasksusingtheaboveproce-dures.Then,foreachstatefultaskSFTi,whichincludesasetofstate-relatedtasks,theoverallQoSvaluesofthewholeserviceplanwithdifferentcandidate-sets(operationsofthesameWebservice)arecalculatedbyAlgorithm1,andtheutilityvaluesiscalculatedbyEquation2.Finally,thecandidate-setwhichmeetsallthelocalconstraintsandwiththebestutilityvaluewillbeselectedastheoptimalcandidate-setforSFTi.4.3.FTSelectionwithGlobalConstraintsLocalconstraintsrequireserviceuserstoprovidede-tailedconstraintsettingsforindividualtasksintheserviceplan,whichnotonlyneedsalotoftimefortheconﬁgu-ration,butalsorequiresgoodknowledgeontheindividualtasks.Toaddressthesedrawbacks,wedesignglobalcon-straints(GC)forspecifyingconstraintsforthewholeser-viceplan.Foraserviceplan,thereareasetofglobalcon-straintsGC={gc}ci=1forthecqualitypropertiesrespec-tively.Sinceaserviceplanmayincludebranchstructuresandhasmultipleexecutionroutes,eachexecutionrouteshouldmeettheglobalconstraintstomakesurethatthewholeser-viceplanmeetstheglobalconstraints.Theexecutionrouteandsequentialroutearedeﬁnedasfollows:Deﬁnition2Executionroute(ERi)isasubserviceplan(ERi⊆SP)includingonlyonebranchineachbranchstructure.Eachexecutionroutehasanexecutionprobabil-itypro(ERi),whichistheproductofallprobabilitiesoftheselectedbranchesintheroute.(cid:2)nei=1pro(ERi)=1,whereneisthenumberofexecutionroutesinaserviceplan.Deﬁnition3Sequentialroute(SRij)isasubserviceplanwhichincludesonlyonebranchineachparallelstructureofanexecutionroute,SRij⊆ERi.Fordeterminingoptimalcandidatesforanexecutionrouteunderglobalconstraints,thesimplestwayisemploy-inganexhaustivesearchingapproachtocalculateutilityval-uesofallcandidatecombinationsandselectouttheone,whichmeetsalltheconstraintsandwiththebestutilityper-formance.However,exhaustivesearchingapproachisim-practicalwhenthetasknumberislarge,sincethenumberofcandidatecombinations(cid:3)ni=1miisincreasingexponen-tially,wheremiisthecandidatenumberfortasktiandnisthetasknumberintheserviceplan.Todeterminetheoptimalfaulttolerancecandidatesforaserviceplanunderbothglobalandlocalconstraints,weﬁrsttransformtheloopstructurestobranchstructuresusingtheapproachproposedin[1],wheretheithbranchpresentsex-ecutingtheloopforitimes.Then,aserviceplanisdecom-posedtodifferentexecutionroutes,andforeachexecutionroute,theoptimalcandidatedeterminationproblemismod-eledasa0-1IntegerProgramming(IP)problemasshowninProblem2.Problem2Minimize:(cid:5)i∈ERi(cid:5)j∈Siuijxij(3)Subjectto:(cid:5)i∈ERi(cid:5)j∈Siqyijxij≤gcy(y=2,3,4)(4)∀k,(cid:5)i∈SRik(cid:5)j∈Siqyijxij≤gcy(y=6,8)(5)(cid:6)i∈ERi(cid:6)j∈Si(qyij)xij≤gcy(y=1,5,7)(6)∀SFTi,xy1j=xy2j=...=xynij(tyi∈SFTi)(7)978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
244
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 09:59:04 UTC from IEEE Xplore.  Restrictions apply. 
∀i,(cid:5)j∈Sixij=1;xij∈{0,1}(8)InProblem2,Equation3istheobjectivefunction,whereuijistheutilityvalueofthecandidatesij.Equation4istheglobalconstraintsforthequalitypropertiesprice,popular-ityanddate-size(qy,y=2,3,4),wheretheQoSvaluesofthewholeexecutionroutearethesumofallitstasks.Equation5istheglobalconstraintsforResponse-timeandoverall-response-time(qy,y=6,8).Forq6andq8,allse-quentialroutesintheexecutionrouteshouldmeettheglobalconstraintsgc6andgc8tomakesurethattheresponsetimeofthelongestsequentialroutemeetstheglobalconstraints.TheQoSvaluesofq6andq8ofthesequential-routesarecalculatedbythesumofallitstasks.Equation6istheglobalconstraintsforavailability,success-rateandoverall-success-rate(qy,y=1,5,7),where(qyij)xij=1ifacandi-dateisnotselected(xij=0).TheQoSvaluesofq1,q5,andq7arecanbecalculatedbytheproductofthetasks.Equa-tion7istomakesurethatthestate-relatedtasksinSFTiwillemployoperationsofthesameWebservice(thesamecandidateindexj).Equation8istomakesurethatonlyonecandidatewillbeselectedforeachtask.Inintegerprogramming,theobjectivefunctionandcon-straintsshouldbelinear.Therefore,weneedtotransformtheEquation6fromnon-lineartolinear.ByapplyingthelogarithmfunctiontoEquation6,weobtain(cid:5)i∈ERi(cid:5)j∈Sixijln(qyij)≤ln(gcy)(y=1,5,7),(9)whichislinear.Theobjectivefunctionneedtobechangedaccordingly.WhencalculatingtheQoSvalues(qy,y=1,5,7)oftheexecutionroute,thenormalizationfunctionqyERi−minqymaxqy−minqyshouldbereplaceby˜qyERi−minln(qy)maxln(qy)−minln(qy),(10)where˜qyERi=ln(qyERi)=(cid:5)i∈ERi(cid:5)j∈Sixijln(qyij).(11)Inthisway,theoptimalfaulttolerancestrategydetermi-nationproblemisformulatedasa0-1IPproblem.Then,wedesignanalgorithmFT-BAB,whichisbasedonthewell-knownBranch-and-Boundalgorithm[23],toﬁndoptimalfaulttolerancestrategiesfortheexecutionroutes.Sinceeachexecutionroutemayonlyincludeasubsetofthewholeserviceplananddifferentexecutionroutesmayhaveover-lappingtasks,thefollowingrulesaredesignedtocombinetheresults:Data:SP,ER,ConstraintsGC,LC,CandidatesS,pctResult:OptimalcandidatesindexρforSP.n=nl+nf;nl=|SLT|;mi=|si|;ne=|ER|;Te={};1for(i=1;i≤ne;i++)do2ifERi∈theﬁrstpctmajorroutsthen3FTBAB(ERi);4Te=Te∪Ti;5end6end7foreachtk∈Tedo8iftk∈onlyoneERithen9ρk=ERi.ρk;10elseiftk∈multiplyERithen11pro(ERx)=max{pro(ERi)};12ρk=ERx.ρk;13end14end15ifTe==Tthenreturnρ;16ρ=ﬁndInitialSolution(T,GC,LC,S,Te,ρ);17qall=flowQoS(SP,q1ρ1,...,qnρn);18while∃x(qxallgcx>1)do19S(cid:2)=ﬁndExchangeCandidate(T,GC,LC,ρ);20if|S(cid:2)|==0then21returnNoFeasibleSolutionExist!22else23forallsxy∈S(cid:2)doρx=y;24end25end26repeat27ρ=feasibleUpgrade(SP,GC,LC,S,ρ);28untilρdonotchange;29returnρ;30Algorithm3:HybridAlgorithm:FT-BABHEU•Ifatasktionlybelongstooneexecutionroute,thentheoptimalresultisselectedastheﬁnalresultfortheserviceplan.•Ifatasktibelongstomultipleexecutionroutes,thentheresultoftheexecutionroutewiththehighestex-ecutionprobabilitypro(ERi)isselectedastheﬁnalresultfortheserviceplan.4.4.HybridAlgorithmforFTSelectionTheIPproblemisNP-Complete[6]andthecomputa-tiontimeincreasesexponentiallywiththeproblemsize.Toaddressthesedrawbacks,wedesignahybridalgorithmFT-BABHEUasshowninAlgorithm3,whichcombinesaBranch-and-BoundalgorithmFT-BABandaHeuristicalgo-rithmFT-HEUforimprovingthecomputationperformance.Theparameterpct(0%≤pct≤100%)inline3oftheAl-gorithm3isauser-deﬁnedthresholdforadjustingtheFT-BABHEUalgorithm.Anexecutionrouteiscountedasama-jorrouteifitsexecutionprobabilitypro(ERi)isinthetoppctpercentofalltheexecutionroutes.Whenpct=100%,allexecutionroutesaremajorrouteandwhenpct=0%,therearenomajorroutes.Algorithm3includesthefollow-ingmainsteps:Step1(lines2-7):FindingouttheoptimalcandidatesforthemajorroutesbysolvingtheIPproblemusingaBranch-and-BoundalgorithmFTBAB().978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
245
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 09:59:04 UTC from IEEE Xplore.  Restrictions apply. 
Data:SP,GC,LC,S,Te,ρResult:InitialcandidatesindexρforSP.n=|SLT|+|SFT|,nl=|SLT|,mi=|si|;1qall=flowQoS(SP,qe);2wt=(cid:4)1aifqall==0qtallgct/(cid:2)at=1qtallgctifqall(cid:7)=0;3for(i=1;i≤n;i++)do4ifti∈TethenContinue;5for(j=1;j≤mi;j++)do6q=qij;7ifi>nlthenq=flowQoS(SP,qi1j,...,qirij);8if∀x(qx≤lcxij&&qx≤gcx)then9λij=(cid:2)at=1wtqtgct;10end11end12λix=min{λij};13ρi=x;14qall=flowQoS(SP,q1ρ1,...,qiρi);15updatewt;16end17returnρ;18Algorithm4:FindInitialSolutionStep2(lines8-15):Combiningtheoptimalresultsofdif-ferentexecutionroutesbytherulesinSection4.3.Step3(lines16-17):Ifthemajorroutescoverallthetasksintheserviceplan,theoptimalresultswillbere-turned.Otherwise,aheuristicalgorithmFT-HEUwillbeemployedfordeterminingtheoptimalcandidatesfortheun-coveredtasks.IntheFT-HEUalgorithm,ﬁrstthefunctionfindInitialSolution(),whichisshowninAlgorithm4,isinvokedforﬁndinginitialfeasiblecandidatesfortheuncov-eredtasks.Foreachcandidateofanuncoveredtask,Equa-tion12isemployedforcalculatingthevalueofλij,whereasmallervaluemeansthecandidateismoresuitable.qkallinEquation12istheaccumulatedQoSvaluesofallthese-lectedcandidates,whichcanbecalculatedbyAlgorithm1.Whenthevalueofqkallgckislarge,itmeansthatthequalitypropertyqkisinmoredangerandneedsmoreattention(largerwk).λij=c(cid:5)t=1wkqkgck;wk=(cid:4)1cifqall=0qkallgck/(cid:2)ck=1qkallgckifqall(cid:5)=0(12)Step4(lines18-26):Iftheinitialsolutioncannotmeettheglobalconstraints(denotedasinfeasiblesolution),thenthefindExchangeCandidate()function,whichisshowninAlgorithm5,isinvokedtoﬁndanexchangeablecandi-datewhichmeetsthefollowingthreerequirements:•Itwilldecreasethehighestinfeasiblefactorofthequalityproperties,qxnewgcx1.•ItwillnotincreasetheinfeasiblefactorofanyotherData:ServiceplanSP,ConstraintsGC,LC,CandidateindexρResult:AsetofcandidatesS(cid:2)forexchange.n=|SLT|+|SFT|,nl=|SLT|mi=|si|,S(cid:2)={};1qold=flowQoS(SP,q1ρ1,...,qnρn);2qxoldgcx=max(q1oldgc1,...,qaoldgca);3for(i=1;i≤n;i++)do4for(j=1;j≤mi;j++)do5ifj==ρi||∃y(qyij>lcyij)thenContinue;6qnew=flowQoS(SP,q1ρ1,..,qij,..,qnρn);7if(qxnewgcx1and∀y(qynewgcy≤1&&qyoldgcy≤1)thenq=qij;9ifi>nlthenq=flowQoS(SP,qi1j,.,qirij);10vij=qxiρi−qxgcx;11end12end13end14vxy=max{vij};15ifx≤nlthen16AddsxytoS(cid:2);17else18AddallrelatedsxytoS(cid:2);19end20returnS(cid:2);21Algorithm5:FindExchangeCandidatepreviouslyinfeasibleproperties,∀y(qynewgcy≤qyoldgcy),whereqyoldgcy>1andy(cid:5)=x.•Itwillnotmakeanypreviouslyfeasiblequalityproper-tiesbecomeinfeasible,∀y(qynewgcy≤1),whereqyoldgcy≤1.Ifsuchacandidatecannotbefound,thenaFeasibleS-olutionNotFoundexceptionwillbethrowntotheuserforrelaxingtheconstraints.Otherwise,theabovecandidate-exchangingprocedureswillberepeateduntilafeasibleso-lutionbecomesavailable.Step5(lines27-29):Iterativeimprovementofthefeasi-blesolutionbyinvokingthefeasibleUpgrade()function,whichisshowninAlgorithm6.Thefeasiblesolutionup-gradeincludesthefollowingsteps:•Ifthereexistsatleastonefeasibleupgrade(smallerutilityvalueunew<uold)whichprovidesQoSsav-ingsvij<0,thecandidatewithmaximalQoSsav-ings(minimalvijvalue)ischosenforexchanging.TheQoSsavingvijisdeﬁnedas:vij=c(cid:5)k=1wkqknew−qkoldgck,(13)wherewkisdeﬁnedinEquation12.•IfnofeasibleupgradewithQoSsavingexists,thenthecandidatewithmaximalutility-gainperQoSsavingisselected,whichiscalculatedbyuold−uxyvxy.978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
246
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 09:59:04 UTC from IEEE Xplore.  Restrictions apply. 