# An End-Host View on Local Traffic at Home and Work

## Authors
Ahlem Reggani<sup>1</sup>, Fabian Schneider<sup>2</sup>, and Renata Teixeira<sup>1</sup>

### Affiliations
<sup>1</sup> UPMC Sorbonne Universités and CNRS, LIP6, Paris, France  
<sup>2</sup> NEC Laboratories Europe, Heidelberg, Germany (work done at UPMC<sup>1</sup>)

## Abstract
This paper compares local and wide-area traffic from end-hosts connected to different home and work networks. Our analysis is based on network and application traces collected from 47 end-hosts for at least one week. We compare traffic patterns in terms of the number of connections, bytes, duration, and applications. As expected, wide-area traffic dominates local traffic for most users. Local connections are often shorter and smaller than Internet connections. Furthermore, we find that name services (DNS) and network file systems are the most common local applications, whereas web surfing and P2P, which are the most popular applications in the wide-area, are not significant locally.

## 1. Introduction
Over the past few decades, numerous studies have characterized Internet traffic [1, 6, 7, 12]. These studies are typically based on packet traces collected in ISP networks, at border routers of university campuses, or enterprise networks, focusing primarily on wide-area traffic. Little is known about the traffic that remains within a network, which we term local traffic. One notable exception is a study of traffic from a single enterprise [8, 9], which shows that local traffic differs significantly from wide-area traffic, with a substantial amount of name service, network file system, and backup traffic. The authors note that their study provides "an example of what modern enterprise traffic looks like" [9].

It is crucial to extend such analysis to other enterprises and, more importantly, to other types of edge networks. For instance, the proliferation of broadband Internet has led to an increase in the number of households with home networks. However, there has been limited analysis of local traffic volumes in just three home networks [5], with no in-depth characterization of in-home traffic patterns. The challenge in studying local traffic across multiple edge networks lies in obtaining measurements from inside these networks.

This paper characterizes local network traffic in multiple networks from the perspective of an end-host connected within an edge network. This approach contrasts with previous work [5, 9], which instruments routers in the local network. While instrumenting routers can capture all traffic traversing the local network, it is difficult to gain access to routers in more than a few networks. By monitoring traffic directly at end-hosts, we can sample a larger number of networks, though we only see the traffic from one host in each network. For smaller networks (such as home networks), a single host's traffic captures a significant fraction of the total network traffic, whereas for larger networks (like enterprises), this fraction is less significant.

We rely on data collected using the HostView monitoring tool [4], which records packet header traces and information about applications and the user environment. The data used in this study was collected from 47 users who ran HostView for more than a week each. Given that users move between different networks, our dataset includes end-host traffic from a total of 185 different networks spread over 18 countries. Section 2 provides an overview of the HostView data. Analyzing local and wide-area traffic from HostView data is challenging because HostView lacks information on which traffic flows are local. Additionally, HostView removes the end-host IP address from the traces to protect user privacy, making the identification of local traffic more difficult. Therefore, we developed a heuristic to separate local from wide-area traffic. Section 3 describes this heuristic and our method to categorize environments and applications in the HostView data.

Our analysis, presented in Section 4, addresses several high-level questions: How does the volume of an end-host's local traffic compare to wide-area traffic? Do local and wide-area applications differ? How does traffic vary between home and work? The results show that for most users, wide-area traffic dominates local traffic, but some users have over 80% of local traffic. Local connections are generally shorter and smaller than wide-area connections, though they sometimes transfer more data than large wide-area connections. We find that typical local applications include DNS, SSH, and network file systems (confirming previous findings [9]). Common applications at work include backup, printing, and web, but these are rarely used at home.

## 2. Summary of HostView Data
In this paper, we use three datasets collected by the HostView tool [4]: network packet traces, application labels, and the end-host's network environment. HostView logs all this data directly at the end-host into a trace file, which is periodically uploaded to a server. A new trace is created every four hours or when a change in the network interface or IP address is detected.

### Network Traces and Application Context
HostView logs the first 100 bytes of each packet sent and received by the end-host using libpcap. For DNS packets, it records the entire packet to enable offline hostname-to-IP address mappings. In this paper, we use connection summaries generated by previous work [3]. Each connection summary record describes both directions of a TCP or UDP connection and includes the source and destination IP addresses (with the host IP address replaced by "0.0.0.0" to comply with French privacy laws), the source and destination port numbers, and the network protocol. It also includes the number of bytes, the number of packets, and the duration of the connection, as well as the name of the process executable that generated the connection.

### Network Environment
HostView labels each trace file with information describing the network environment the end-host is connected to, including the network interface, a hash of the wireless network SSID, and the BSSID of the access point for wireless networks or a hash of the MAC address of the gateway for wired networks. It also records the ISP, city, and country for each trace using the MaxMind GeoIP commercial database from March 2011. When the end-host connects to a new wireless network, HostView asks the user to specify the network type from a predefined list: Home, Work, Airport, Hotel, Conference meeting, Friend’s home, Public place, Coffee shop, or Other (with the possibility to specify). This user tag is used to classify the network according to the environment type. Unfortunately, this tag is not available for wired connections, and users sometimes skip the questionnaire. Initially, only 40% of HostView traces had a user tag, but after applying some heuristics (which exploit the fact that users connect to the same network with both wireless and wired, for instance), previous work was able to label 78% of the traces [3]. Still, the data includes at least one unlabeled trace per user. The next section describes our method to label most of the remaining traces with an environment type.

### Dataset Characteristics and Biases
HostView was announced in networking conferences and researcher mailing lists. Volunteer users downloaded HostView (available only for Mac OS and Linux) and ran it during different time intervals between November 2010 and August 2011. In this paper, we use traces from 47 users who ran HostView for at least one week; 32 of these users ran HostView for more than a month. Due to the way HostView was advertised and its limited operating-system support, the user population is biased towards networking researchers. We acknowledge that networking researchers may use different applications than the average user and may also work from home. Despite this, it is still interesting to study examples of the differences between local and wide-area traffic. We observe a diverse set of applications among different users, and our users do use some popular applications like YouTube, Facebook, and BitTorrent. Furthermore, this bias influences the types of networks we study. Importantly, "work" is often a university. Overall, we study end-hosts connected to 185 unique networks spread over 18 different countries (Italy: 25, France: 22, Germany: 21, Rest of Europe: 31, Asia: 19, US: 63, Australia: 3, and Brazil: 1); 34 distinct home networks and 38 distinct work environments (29 are universities and 9 enterprises).

Another bias comes from using data collected for a limited time period on only one single end-host in the network. It is well known that traffic characteristics can vary considerably between different networks and over time [10]. HostView can only see a small fraction of the network's traffic, and there are some types of traffic that it can never observe. For example, some homes may have a media server that serves content to the TV; this type of traffic traverses the home network but is not originated or consumed by an end-host. Despite these limitations, we believe that this end-host perspective on local versus wide-area traffic offers a unique opportunity to sample traffic in a relatively large number of networks. Whenever appropriate, we also contrast our findings with previous work.

## 3. Methodology
In this paper, we compare local and wide-area traffic in networks of different types and are interested in the traffic application mix. We follow three steps to label HostView traces before our analysis: (i) Differentiation of local and wide-area traffic, (ii) Extension of the incomplete network type labeling, and (iii) Categorization of connection records into application groups.

### Table 1. Examples of Process Names and Network Services to Category Mappings
| Category | Process Name (Examples) | Application Protocols |
|----------|-------------------------|-----------------------|
| Chat     | Skype, iChat, Adium, Pidgin | ircd, SIP, msnp, snpp, xmpp |
| Email    | IMAP(S), POP3(S), (S)SMTP | Mail, Outlook, Thunderbird |
| FileTransfer | ftp, rsync, svn, cvspserver | AFP, AFS, LDAP, netbios, nfs |
| Management | ssh(22), webmin | BOOTP, MySQL, VPN, SNMP, whois |
| Media Players | HTTP(S) | Firefox, Chrome, Safari, Opera, httpd, plugin-container, WebKitPluginHost |
| Miscellaneous | perl, python, VirtualBox, openvpn | traceroute, iperf, nmap, ntpd, uPNP |
| Backup   | amanda | — |
| DistantControl | ssh, sshd, VNC, screen sharing | — |
| NameService | domain(53), mdns, netbios-ns | dns, nmblookup, named, nmbd, nscd |
| NetworkFS | smbclient, smbd, AppleFileServer | AFP, AFS, LDAP, netbios, nfs |
| P2P      | amule, Kazaa, BitTorrent | amule, uTorrent, transmission |
| Printing | ipp, printer | cupsd, lpd, HP, Lexmark |

### Local vs. Wide-Area
HostView does not collect the host IP address, so we cannot identify the local subnet based on the host IP prefix. We developed several heuristics to classify traffic as local or wide-area. We define local traffic as all traffic exchanged between an end-user machine and a private IP address, i.e., 192.168/16, 172.16/12, 10/8. We expect this classification to correctly match most local traffic at homes, as those typically connect through a NAT gateway sharing one public IP on the outside. To avoid misclassification when the ISP employs carrier-grade NAT, we developed a second heuristic that analyzes the remote IP addresses of all traffic flows classified as local. When we observe that the remote IP addresses fall in more than five different subnets, we compute the number of connections and bytes for each remote /24 to identify whether there is a "preferred subnet," i.e., a remote subnet that carries most of the traffic (>99.9%). If there is a preferred subnet, then we leave all traffic classified as local. Otherwise, we flag the network for manual inspection. The HostView data had a total of five home networks which contacted more than five different remote subnets, four of these had a preferred subnet. We manually inspected the remaining home network and found that a large fraction of P2P traffic was going to IPs in 10.* networks. In fact, this user's home ISP is known to deploy carrier-grade NAT, so we labeled this 10.* traffic as wide-area and left the 192.* traffic as local. For work networks, we might misclassify local traffic as wide-area when hosts connected to the local network have public IP addresses. We address this issue with a third heuristic that labels all traffic to a destination IP address that has the exact same organization name as that of the source network as local. Finally, we classify all broadcast traffic as local. We label all the remaining traffic as wide-area.

### Extension of Network Environment Labels
As discussed in Section 2, some of the HostView traces have no network type tag (e.g., Home or Work). We manually inspect the ISP, the network interface, and the geolocation of each unlabeled trace and assign a label. For example, we label a trace annotated with ISP: "University of California" as a work network.