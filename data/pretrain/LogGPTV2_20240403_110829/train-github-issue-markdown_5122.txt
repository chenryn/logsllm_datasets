 **Is this a request for help?** (If yes, you should use our troubleshooting
guide and community support channels, see
http://kubernetes.io/docs/troubleshooting/.):
**What keywords did you search in Kubernetes issues before filing this one?**
(If you have found any duplicates, you should instead reply there.):
* * *
**Is this a BUG REPORT or FEATURE REQUEST?** (choose one): BOTH
**Kubernetes version** (use `kubectl version`):  
1.5 custom built master
**Environment** :
  * **Cloud provider or hardware configuration** : azure
  * **OS** (e.g. from /etc/os-release): CentOS 7.2
  * **Kernel** (e.g. `uname -a`): Linux ma-kub8ms0 3.10.0-327.36.3.el7.x86_64 #1 SMP Mon Oct 24 16:09:20 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux
  * **Install tools** : ansible + kubeadm
  * **Others** :
**What happened** :  
When passing --cloud-provider to kubeadm, the flag is only passed to the
controller manager. It is however not passed to the kubelet, which makes Azure
Disk mounting (and probably other cloud features?) not work. Also, the
--cloud-config flag is not passed into the kubelet.
It looks like the kubelet is able to figure out the appropriate cloud provider
(azure) by itself. Not sure how it does this, maybe it gets a hint from the
controller manager. Nevertheless, if users provide a cloud provider to
kubeadm, this one should be explicitly passed to all services which offer such
an option. Also, the (correct) auto guessing does not help when there is no
cloud config given to the kubelet.
I currently have to provide a custom systemd dropin which overrides the
KUBELET_EXTRA_ARGS env var.
An idea how to fix this: Add an optional environment file
(/etc/kubernetes/kubeadm-kubelet-args.env) to the 10-kubeadm.conf dropin. The
kubeadm could then write appropriate cloud-config (and other?) flags to this
file.