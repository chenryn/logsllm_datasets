Exploit	
  PLC	
  on	
  the	
  internet
Z-­‐0ne
概述
什么是PLC
为什么会联网
PLC
• Programmable	
  Logic	
  Controller
– 电源
– CPU
– 存储
– I/O
– 网络模块
PLC功能
• PLC功能
– 顺序控制
– 逻辑控制
• PLC应用
– 自动化控制
– 过程控制
其他
• PLC内核
– Codesys
– ProConos
• 底层操作系统
– Linux
– Vxworks
– WinCE
• 通信协议
– 通用
• Modbus
– 私有
• S7
• Omron	
  FINS
PLC通信
• 串行
– RS232/485
• 专用
– MPI
• 以太网
– TCP/IP
– UDP
网络武器的目标
• Stuxnet作为网络武器其最终的目标也是西
门子PLC
– 劫持通信
– 注入自己的逻辑程序
联网的隐患(1)
• PLC暴露在互联网是比SCADA更大的安全隐
患
– 未授权访问
– 设备的用户等级保护缺失
– 通信协议的脆弱性
联网的隐患(2)
• PLC暴露在互联网是比SCADA更大的安全隐
患
– 控制流程工艺
– 位于更底层
– 可能为关键基础设施
P
L
P
L
P
L
P
L
APPLICATION
MES应用
ERP
信息层
管理层
控制层
设备层
联网的趋势
• 远程数据通信/远程维护催生了联网的需求
– 方便、快捷
– 减少了现场运维的成本
– 统一管理
联网的解决方案(1)
联网的解决方案(2)
联网的解决方案(2)
PLC	
  ON	
  THE	
  INTERNET
西门子PLC全球统计报告
西门子PLC公网蜜罐统计
西门子S7协议 蜜罐应用案例
联网的风险案例
S7-­‐1200硬件形态
S7-­‐300硬件形态
西门子PLC	
  CPU模块全球统计报告(1)
• 使用S7协议(TCP/102)对互联网进行扫描探测
– http://www.zoomeye.org/search?q=port%3A102
– https://www.shodan.io/search?query=Module+po
rt%3A102
• 全球数据 (能成功读出模块型号的数据)
– ZoomEye à 1446	
– Shodan à 2749
– Plcscan.org	
  à 2215
西门子PLC	
  CPU模块全球统计报告(2)
• 使用S7协议(TCP/102)对互联网进行扫描探测
– Nmap à s7-­‐enumerate.nse(TSAP:0102)
– PG	
  mode
– Rack:0	
  Slot:2
西门子PLC	
  CPU模块全球统计报告(3)
• 国家排行
– 德国
350
– 意大利 255
– 美国
179
– 西班牙 146
– 土耳其 124
– 波兰
113
– 法国
108
– 捷克
74
– 丹麦
67
– 奥地利 64
西门子PLC	
  CPU模块全球统计报告(4)
• 模块货号排行
– 6ES7	
  214-­‐1AG31-­‐0XB0
145
– 6ES7	
  214-­‐1AE30-­‐0XB0
142
– 6ES7	
  212-­‐1HE31-­‐0XB0
129
– 6ES7	
  315-­‐2AG10-­‐0AB0
129
– 6ES7	
  151-­‐8AB01-­‐0AB0
121
– 6ES7	
  315-­‐2EH14-­‐0AB0
120
– 6ES7	
  315-­‐2AH14-­‐0AB0
88
– 6ES7	
  214-­‐1BG31-­‐0XB0
74
– 6ES7	
  314-­‐6EH04-­‐0AB0
74
– 6ES7	
  313-­‐5BF03-­‐0AB0
73
西门子PLC	
  CPU模块全球统计报告(5)
• 固件版本排行
– Version:	
  3.0.2
472
– Version:	
  2.2.0
142
– Version:	
  2.6.0
113
– Version:	
  4.0.0
96
– Version:	
  2.6.11
76
– Version:	
  3.2.10
76
– Version:	
  3.2.6
69
– Version:	
  3.3.8
59
– Version:	
  3.2.3
59
– Version:	
  3.2.8
55
西门子PLC	
  CP模块全球统计报告(1)
• 使用S7协议(TCP/102)对互联网进行扫描探测
– Nmap à s7-­‐enumerate.nse(TSAP:0100)
– Rack:0	
  Slot:0
• 全球数据(能成功读出模块型号的数据)
– Plcscan.org	
  à 486
西门子PLC	
  CP模块全球统计报告(2)
• 使用S7协议(TCP/102)对互联网进行扫描探测
– Nmap à s7-­‐enumerate.nse(TSAP:0100)
– PG	
  mode
– Rack:0	
  Slot:0
西门子PLC	
  CP模块全球统计报告(3)
• 国家排行
– 意大利 91
– 德国
76
– 西班牙 32
– 法国
29
– 瑞士
26
– 捷克
25
– 丹麦
23
– 美国
18
– 波兰
14
– 中国
14
西门子PLC	
  CP模块全球统计报告(4)
• 模块货号排行
– 6GK7	
  343-­‐1CX10-­‐0XE0
305
– 6GK7	
  343-­‐1EX30-­‐0XE0
70
– 6GK7	
  343-­‐1CX00-­‐0XE0
19
– 6GK7	
  343-­‐1EX11-­‐0XE0
18
– 6GK7	
  443-­‐1EX20-­‐0XE0
16
– 6GK7	
  443-­‐1EX11-­‐0XE0
14
– 6GK7	
  343-­‐1EX21-­‐0XE0
14
– 6GK7	
  343-­‐1EX20-­‐0XE0
13
– Unknown
4
– 6GK7	
  343-­‐1GX21-­‐0XE0
3
西门子PLC	
  CP模块全球统计报告(5)
• 固件版本排行
– Version:	
  3.0.23
104
– Version:	
  2.3.2
79
– Version:	
  2.0.16
60
– Version:	
  2.6.0
56
– Version:	
  2.1.14
31
– Version:	
  2.2.20
22
– Version:	
  1.1.5
15
– Version:	
  2.5.0
14
– Version:	
  1.2.3
9
– Version:	
  1.0.26
8
西门子PLC全球分布图形化统计
西门子PLC	
  蜜罐统计报告(1)
• Conpot
– 不推荐默认配置
– 特征
• S7(TCP/102)
– Serial	
  number	
  of	
  module:	
  88111222
• 全球数据
– ZoomEye à 48
– Shodan à 61
– Plcscan.org	
  à 30
西门子PLC	
  蜜罐统计报告(2)
西门子S7协议 蜜罐应用案例(1)
• 通过监听TCP/102端口并仿真S7协议收集扫
描信息
– 记录连入端口的IP、时间
– 回复伪装的模块信息
– 输出协议操作的详细日志
西门子S7协议 蜜罐应用案例(2)
2015-­‐07-­‐09	
  09:27:20	
  [71.6.167.142]	
  Client	
  added
2015-­‐07-­‐09	
  09:27:20	
  [71.6.167.142]	
  The	
  client	
  requires	
  a	
  PDU	
  size	
  of	
  480	
  bytes
2015-­‐07-­‐09	
  09:27:20	
  [71.6.167.142]	
  Client	
  added
2015-­‐07-­‐09	
  09:27:21	
  [71.6.167.142]	
  The	
  client	
  requires	
  a	
  PDU	
  size	
  of	
  480	
  bytes
2015-­‐07-­‐09	
  09:27:21	
  [71.6.167.142]	
  Read	
  SZL	
  request,	
  ID:0x0011	
  INDEX:0x0001	
  -­‐-­‐>	
  OK
2015-­‐07-­‐09	
  09:27:21	
  [71.6.167.142]	
  Read	
  SZL	
  request,	
  ID:0x001c	
  INDEX:0x0001	
  -­‐-­‐>	
  OK
2015-­‐07-­‐09	
  09:27:21	
  [71.6.167.142]	
  Client	
  disconnected	
  by	
  peer
2015-­‐07-­‐09	
  09:27:25	
  [71.6.167.142]	
  Client	
  disconnected	
  by	
  peer
C:\Users\Administrator>nslookup	
   71.6.167.142
服务器:	
  google-­‐public-­‐dns-­‐a.google.com
Address:	
  8.8.8.8
名称:	
  census9.shodan.io
Address:	
  71.6.167.142
西门子S7协议 蜜罐应用案例(3)
2015-­‐05-­‐06	
  19:53:49	
  [5.61.38.11]	
  Client	
  added
2015-­‐05-­‐06	
  19:53:55	
  [5.61.38.11]	
  Client	
  added
2015-­‐05-­‐06	
  19:53:58	
  [5.61.38.11]	
  The	
  client	
  requires	
  a	
  PDU	
  size	
  of	
  480	
  bytes
2015-­‐05-­‐06	
  19:53:58	
  [5.61.38.11]	
  Client	
  disconnected	
  by	
  peer
2015-­‐05-­‐06	
  19:53:59	
  [5.61.38.11]	
  Read	
  SZL	
  request,	
  ID:0x0011	
  INDEX:0x0000	
  -­‐-­‐>	
  OK
2015-­‐05-­‐06	
  19:53:59	
  [5.61.38.11]	
  Read	
  SZL	
  request,	
  ID:0x001c	
  INDEX:0x0000	
  -­‐-­‐>	
  OK
2015-­‐05-­‐06	
  19:54:00	
  [5.61.38.11]	
  Read	
  SZL	
  request,	
  ID:0x0132	
  INDEX:0x0004	
  -­‐-­‐>	
  OK
2015-­‐05-­‐06	
  19:54:02	
  [5.61.38.11]	
  Block	
  of	
  type	
  OB	