LimitsofLearning-basedSignatureGenerationwithAdversariesShobhaVenkataramanCarnegieMellonUniversityshobha@cs.cmu.eduAvrimBlumCarnegieMellonUniversityavrim@cs.cmu.eduDawnSongUniversityofCalifornia,Berkeleydawnsong@cs.berkeley.eduAbstractAutomaticsignaturegenerationisnecessarybecausetheremayoftenbelittletimebetweenthediscoveryofavulnerability,andexploitsdevelopedtotargetthevulner-ability.Muchresearchefforthasfocusedonpattern-extractiontechniquestogeneratesignatures.Thesehaveincludedtechniquesthatlookforasinglelargeinvariantsubstringofthebytesequences,aswellastechniquesthatlookformanyshortinvariantsubstrings.Pattern-extractiontechniquesareattractivebecausesignaturescanbegener-atedandmatchedefﬁciently,andearlierworkhasshowntheexistenceofinvariantsinexploits.Inthispaper,weshowfundamentallimitsontheaccuracyofpattern-extractionalgorithmsforsignature-generationinanadversarialsetting.Weformulateaframe-workthatallowsauniﬁedanalysisofthesealgorithms,andprovelowerboundsonthenumberofmistakesanypattern-extractionlearningalgorithmmustmakeundercommonas-sumptions,byshowinghowtoadaptresultsfromlearningtheory.Whilepreviousworkhastargetedspeciﬁcalgo-rithms,ourworkgeneralizestheseattacksthroughtheoreti-calanalysistoanyalgorithmwithsimilarassumptions,notjustthetechniquesdevelopedsofar.Wealsoanalyzewhenpattern-extractionalgorithmsmaywork,byshowingcondi-tionsunderwhichtheselowerboundsareweakened.Ourresultsareapplicabletootherkindsofsignature-generationalgorithmsaswell,thosethatusepropertiesoftheexploitthatcanbemanipulated.1IntroductionItiswell-knownthatautomaticsignaturegenerationisimportant–often,theremaybesmalltime-windowsbe-tweenwhenavulnerabilityisdiscovered,andwhenfast-spreadingexploitsthattargetitappear.Generatingsigna-turesmanuallyisslowanderror-prone,andthus,weneedautomaticsignaturegeneration.However,therearesomerequirementsforthegeneratedsignaturestobeuseful.Thesesignaturesneedtoidentifymostoftheexploits(havelowfalsenegatives),andfalselyidentifyveryfewnon-exploits(havelowfalsepositives).Theyneedtocapturepropertiesofexploitsthatdonotap-pearinnormaltrafﬁc.Theyalsoneedtobeefﬁcientsothatsignaturescanbegeneratedquickly.Theserequirementsmakeautomaticsignaturegenerationahardproblem.Amajorlineofresearchefforthasfocusedonﬁndingsignaturesusingpattern-basedanalysis,i.e.,byextractingbytepatternsthatuniquelydistinguishexploitsusingnet-worktrafﬁcstatistics[17,18,20,25,29].Suchpattern-extractionalgorithmsareattractivebecausethesignaturescanbeefﬁcientlygeneratedandmatched.Pattern-extractionalgorithmsare,atcore,machinelearningalgorithms:theyuseapoolofdatacontainingexploitsandnormaltrafﬁc(calledthetrainingpool),andlookforinvariantbytestringsthatarepresentacrossallexploitpackets,butdonotoc-curinthenormaltrafﬁc.Earlierworkhasshownthatsuchdistinguishinginvariantsexist,evenwhenthepayloadsareself-encrypting,e.g.,eveninpolymorphicworms,thehigh-orderbitsofthereturnaddressofbufferoverﬂowsandpro-tocolframingbytesarefoundtobeinvariant[20,25].Thisresearchhasledtointerestinhowpattern-extractionalgo-rithmscouldbeattackedorevaded[15,26,28].Inthiswork,weshowfundamentallimitsontheac-curacyofalargeclassofpattern-extractionalgorithmsinanadversarialsetting.Weformulateaframeworkthatal-lowsuniﬁedanalysisofallsuchpattern-extractionalgo-rithms,andshowlowerboundsonthemistakesallpattern-extractionalgorithmsneedtomakeundersomecommonas-sumptions,byshowinghowtoadaptresultsfromlearningtheory.Atahighlevel,ourresultsshowthatalgorithmsforpattern-extractionsignature-generationcanbeforcedintomakingasigniﬁcantnumberoffalsepositivesorfalseneg-atives.Earlierworkonthelimitationsofpattern-extractionalgorithmshavefocusedonindividualalgorithmsandspe-ciﬁcsystems.Forexample,Perdiscietal.[28]demonstrateifanattackercansystematicallyinjectnoiseintothetrain-ingpool,Polygraphfailstogenerategoodsignatures.New-someetal.[26]illustratesimilarresultsinParagraphevenwhenadversarycannotinjectarbitrarynoiseintothetrain-ingpool.Ourresultsgeneralizetheseearlierresultsthroughtheoreticalanalysis,demonstratingthatsimilarattacksarepossibleonallsuchalgorithms,withsimilarassumptions.Thecentralconclusionofourtheoreticalanalysisisthatanypattern-extraction(andsimilarlearning-based)algo-rithmscouldbemanipulatedintomakinganumberofmis-takesonarbitraryexploits,asafunctionoftheadversary’spowertoaddmisleadinginformationtohisexploits.Be-causewecannotpredicthowfutureexploitswouldlook,itisimportanttoknow(andthisresultshowsus)whenandhowmuchpattern-extractionalgorithmscouldbefooled.Theseresultsholdwhenthereisavalidsignatureofinvari-ants,thesignature-generatorusesrandomizedalgorithms,whoseoutputtheadversarycannotpredict,andevenifhost-monitoringtechniquesliketaintanalysis[7,11,27,30]areusedtoidentifyexactlywhichpacketsareexploitsandwhicharenot.Ourresultsareindependentofthekindoffunctionthatthealgorithmtriestolearnoverthebytesequence,(i.e.,thealgorithmisallowedtolearnanyarbitrarycomplexfunc-tionovertheinvariantbytes),orcomputationalcomplexityofthealgorithm.Ouranalysisalsooffersinsightintoalgo-rithmsthatrefusetotolerateone-sidederror,andthelowerboundsforthesealgorithmsaremuchhigherthanresultsformoregeneralalgorithms.Theseresultsshowthat,itisindeedmucheasierforanadversarytomanipulateanalgo-rithmthatmakesveryfewfalsepositives,orveryfewfalsenegatives.Existingexperimentalresults(Perdiscietal.[28]andParagraph[26])alreadyillustratethattheassumptionsforouranalysishold,atleastforcurrentfamiliesofpattern-extractionalgorithms.Ourresultsdemonstratethatifpattern-extractionalgorithms(andsimilarsignature-generationalgorithms)needtoworkinanadversarialenvi-ronment,theyneedtobedesignedsothattheassumptionsdonothold;i.e.,thattheadversarycannotﬁndalargesetofbytestrings,resembletheexploit’sinvariantsintrafﬁcfrequencystatistics.Wealsoexplorewhenpattern-extractionalgorithms(andsimilarsignature-generationalgorithms)maywork.Forexample,ifanexploitcontainsinvariantsthatareneverpresentinnormaltrafﬁc,thenitseemslikelythattheexploitcanbeidentiﬁed.Ourresultsshowthatthelowerboundsofsomefamiliesofalgorithmsarenoticeablyweakened,un-dersomeconditions,i.e.,whenthereisagapbetweenthedistributionoftokensinnormaltrafﬁcandtheinvariantsofexploits.Ouranalysisalsooffersinsightintothekindofalgorithmsthatmayworkandhighlightstheimportanceofthefunction(overtheinvariants)thatthealgorithmlearns:algorithmsthatlookforasimplesetofinvariants(learningasimpleconjunctionofinvariants)havefarworselowerboundsthanalgorithmsthatlookformorecomplexfunc-tionsovertheinvariants;thisimpliesthat,unliketheresultsforarbitraryexploits,itisfareasierfortheadversarytoma-nipulatethosesimplefunctionswhenthereisagapinthetrafﬁc.Ourresultsarealsoapplicabletoothersignature-generationtechniquesbesidespattern-extractionalgo-rithms.If,forexample,asignature-generationalgorithmlooksforprotocolﬁeldsexceedingspeciﬁclengths,butchoosesthelengthsbasedonmalicioustrafﬁc(e.g.,COV-ERS[21]),ourresultswouldstillhold.Thekeylimitationinpattern-extractionalgorithmsisthattheadversarycaneasilyaddpatternsthataresimilartoexploit’sinvariants,andal-gorithmcannotdistinguishbetweentheinvariantsandthoseaddedbytheadversary(redherrings).Ourresultsareappli-cableaslongasthiskindoflimitationholds:theadversarycanembedsimilarpropertiestothoseinvarianttotheex-ploit,andthealgorithmcannotdistinguishbetweenthem.2DeﬁnitionsandOverviewWenowpresentthemaindeﬁnitionsandassumptionsthatweusethroughoutthepaper.2.1DeﬁnitionsAsignatureisafunctionσthatclassiﬁesagivenbytesequence(or,equivalently,packet)asmaliciousornon-malicious,i.e.,σ(y)=Malicious,whenbytesequenceyisanexploit,andσ(y)=Non-Malicious,whenyisbenign.Asignaturemaybebasedonvariouspropertiesofthebytesequence,andwedenotethesepropertiesundercon-siderationforsignaturegenerationasattributes.Anat-tributeAisafunctionwhoseinputisthebytesequenceandoutputisboolean:e.g.,Acouldbewhetheraaaaaispresentinabytesequence.Forthisattribute,forbytese-quenceaaaaattttt,A(aaaaattttt)=true,whileforbytesequenceaabbccttttt,A(aabbccttttt)=false.Asigna-turecouldthenbeconsideredafunctionofattributes;thus,ineffect,asignatureisafunctionoverbooleanconditions.e.g.,ifA(y)andB(y)areattributes,asignaturecouldbeσ(y)={Malicious:A(y)∧B(y)}.Wesaythatanat-tributeissatisﬁedifitevaluatestotrue.Recallpattern-extractionalgorithmslookforinvariantbytestringsthatarepresentintheexploit,andnotinnor-maltrafﬁc,andtheseinvariantsarebytestringsthatmustallbepresentintheexploitforittobemalicious.e.g.,asig-naturereportedbyPolygraph[25]isapairofbytestrings,’\xFF\xBF’and’\x00\x00\FA’(theLionwormexploit-ingtheBINDTSIGvulnerability).Werefertoeachsuchbytestringasatoken.Inourterminology,theattributestestforwhethereachofthesetokensispresent,andsigna-tureisaconjunctionofthetwoattributes.Wecoulddenotethissignatureasσ(y)={Malicious:’\xFF\xBF’∈y∧’\x00\x00\FA’∈y}.Moregenerally,forpattern-extractionalgorithms,anat-tributetestsforthepresenceofaparticulartoken,perhapsataparticularlocation.Foralgorithmsthatusemoreinfor-mation,otherkindsofattributeswouldalsobeneeded,e.g.,COVERS[21]considerslengthsofﬁelds,soanattributewouldalsorepresentwhetheraparticularﬁeldinthebytesequenceislongerthanaspeciﬁcvalue.ForaﬁxedsetofattributesG,wecanrepresentabytesequencebytheattributesinGthatitsatisﬁes,andwede-scribehowtodosonow.WedeﬁneaninstanceiforabytesequenceandasetofattributesGtobeabooleanm-tuple,i.e.,i∈{0,1}m,wheretheithbitis1iftheithpropertyholdstrueforthebytesequence.Aninstancethusisarep-resentationofabytesequenceforasetofattributes.So,ifGconsistsofthetwoattributes“Is{aaaaa}present?”and“Is{bbbbb}present?”,thebytesequenceaaaaaxxxxbbbbwouldberepresentedas(1,1),andcccccxxxxxbbbbwouldberepresentedby(0,1).TheinstancespaceisthesetofallinstancesI={i∈{0,1}m}.Fortherestofthispa-per,weconsiderthesetofpossibleattributesGtobeﬁxed.Everybytesequenceisrepresentedasavectorinthein-stancespace,andourdiscussionwillbeinthisinstancespace{0,1}m.Wealsointroducesomemachinelearningterminology.Thealgorithmisgivensometrainingdata,whichconsistsofmaliciousandnon-maliciousinstances,alongwiththelabelsofeachinstance,sothatitknowswhichinstancesaremaliciousandwhicharenot.Thealgorithmﬁndsahypoth-esis,afunctionthatclassiﬁesagiveninstanceasmaliciousornon-malicious.Wedeﬁnethetruesignaturetobethesignaturethatachieves0falsepositivesand0falsenegatives,onanysetofinstancespresentedtoit.Inlearningterminology,thetruesignatureisthetargethypothesisthatneedstobefoundbythelearningalgorithm.Oncethespaceofattributesisﬁxed,weassumethereisonlyonetruesignature;ofcourse,theremaybemultiplefunctionstorepresentthistruesigna-ture.(Iftherearemultiplesignaturesthatcanalwaysachieve0falsepositivesandfalsenegatives,aconjunctionofthesesignaturesisalsoatruesignature,sothisassumptionisnotlimiting.)Werefertotheattributesinthetruesignatureascriticalattributes.2.2OverviewofLearningFrameworkThecentralquestionthatwewanttoansweristhefol-lowing:towhatextentcananadversaryforceeverylearn-ingalgorithmtolearnthesignatureslowly?Weanswerthisquestionbypresentinglowerboundsonthealgorithm’sper-formance.Todoso,weneedsomeassumptions,andinthissectionwedescribeandjustifysomebasicassumptionsweuse.Ourgoalinchoosingtheseassumptionsistogivethealgorithmsinthesignaturegeneratorasmuchpoweraspos-sible.Thelowerboundsshowthat,evenso,theadversarycanevadedetectionforalongtime.Wefocusonfourdifferentassumptionshere:thelearn-ingmodel,theformofthetruesignature,thelabelcorrect-ness,andtheadversary’sknowledgeofthealgorithms.Learningmodel:Ouranalysisassumesthatthealgo-rithmisallowedtoupdateitsinternalstateaftereachbatchofdatathatitsees,andtheseupdatesmaybemadeoverallofthedataaccumulatedsofar.Forexample,ifthealgo-rithmhas100packetsinitsinitialtrainingpool,andthengets50packetsinthenextbatch,thealgorithmmayupdateitssignatureafterseeingthesecondbatch,andmaythenuseall150packetstogeneratetheupdatedsignature.Thisisalittledifferentfromthetypicalmachinelearn-ingsetting,wherethealgorithmisgivenalargebatchoftrainingdata,allowedtolearnafunctionoverit,andthentestedonnewtestingdata.However,sincewehaveama-liciousadversarywhocontrolspartofthedataandaimstodelaylearning,theadversarycouldensurethat,withoutup-dates,thealgorithmneverlearnsagoodsignature.Byal-lowingupdates,algorithmmightﬁndagoodsignatureoveralongerperiodoftime.Wecanalsoperformamorein-formativeanalysisabouthowthealgorithm’sperformanceevolveswithmoredataovertime.Thelearningalgorithmstilldoesgetaninitialtrainingpool,whichcancontainanynumberofmaliciousandnon-malicioussamples,aslongastheassumptionofSection3isobeyed.Inaddition,sincetheadversarywantsthealgorithmtomakeasmanyerrorsaspossible,theadversaryaimstore-leaseinformationaboutthetruesignatureasslowlyaspos-sible.Theadversarycanpresentinformationaboutexactlyonenewinstanceineachbatch(e.g.,allthemaliciousin-stancesinthebatchcanbethesame,soamistakeontheinstancewouldcausea100%falsenegative).1Ineffect,itisasifthealgorithmgetsonenewinstanceatatime,classi-ﬁesit,andupdatesitsinternalstatebasedonthatinstance.Ourboundswillbeintermsofthenumberofmistakesthealgorithmmakesinthissetting,whichalsocorrespondstothenumberofupdatesitrequires.Inthelearningtheoryliterature,thisisknownasthemistake-boundmodel[22].Formofthetruesignature:Weassumethatthetruesignatureoftheexploitisaconjunctionofattributes–i.e.,allattributesintheconjunctionmustbesatisﬁedbythepacket.Wedosobecauseconjunctionsarethesimplestformofsignaturesthathavebeenhistoricallyconsidered,andlowerboundsforconjunctionsimplylowerboundsformorecomplexfunctionsthatcanrepresentconjunctions.Forexample,theselowerboundsarealsolowerboundsforregularexpressions,becauseregularexpressionsignaturescanrepresentconjunctions.However,wedonotmakeanyassumptionontheform1Indeed,ifthealgorithmcanupdateitshypothesisonlyeverybatch,itisoptimalfortheadversarytopresentexactlyoneinstanceatatime.ofhypotheseschosenbythealgorithmsforitsinternalstate.Thealgorithmcoulduse,forexample,aweightedcombina-tionoftokensasitsclassiﬁer.Thelearningalgorithmisnotrequiredtolearnaconjunction.LabelCorrectness:Weassumethateverylabelgiventothealgorithmiscorrect.Thismeanstheadversaryisforcedtobetruthful,andcannotdecidetochangethesigna-ture(targethypothesis)afterthealgorithmhasbeengivendata.Thisaffordsthealgorithmalotofpower:itisasifthealgorithmhasanoraclelikeadynamicruntimechecker,andcantesteachinputonit.Iftheadversarycanlie,byaddingcarefullycraftednoiseforsomeinstances,orchangethetarget,thelowerboundswouldonlyincrease.Adversaryknowledge:Weassumethattheadversaryknowsthekindsofattributesconsideredbythealgorithminquestion.Insomeofourbounds(fordeterministicalgo-rithms),theadversaryneedstoknowthealgorithmheaimstomistrain,butthisisnotrequiredfortheboundsontheran-domizedalgorithms.Theserandomizedboundsholdwhentheadversary(a)knowsthealgorithm,buthasnoaccesstoitsprivaterandomness,(b)doesnotknowthealgorithm,or(c)doesnotknowtheparameters(e.g.,statisticalalgorithmsusingsoftdecisionboundaries).3ReﬂectingSetInthissectionwedescribetheformalframeworkwewillusetoanalyzelimitationsonlearning-basedsignaturegen-eration.Ourkeyassumptionisthattheadversaryhastheabilitytoconstructreﬂectingsets:spuriousattributes(e.g.,tokens)that,tothelearningalgorithm,lookatleastasplau-sibleaprioriastheactualattributesinthesignature.Thesetaketheroleofthe”conceptclass”inlearningtheory,andthelargertheset,thestrongerthelimitation.Below,wemotivatethenotionofreﬂectingsetsandgiveformaldeﬁni-tions,focusingonpattern-extractionalgorithms,especiallyPolygraph[25]&Hamsa[20].3.1Motivation&DeﬁnitionsWebeginbyobservingacommonpropertyofmanystrategiesproposedtoevadedetectionbypattern-extractionalgorithms.Awiderangeofstrategieshavebeenproposedforevasion,andallofthemsucceedbecausetheadversarycanincreasethenumberoftokensthatresemblethetokenscriticaltothesignature.e.g.,Inredherringattacks[25],theattackeraddsspurioustokenstothetruesignature,andtheattacksucceedswhenthealgorithmmistakenlycon-sidersthoseaspartofthetruesignature.Likewise,innoiseinjectionattacks[28],allergyattacks[15]andsuspi-cious/innocuouspoolpoisoningattacks[26],theadversarymanipulatesthetokendistributioninthetrainingortestingpool,byaddingwell-crafted(maliciousornormal)packetswithcarefullychosentokens,andchangingthedistributionsofvarioustokensinthetrainingpool.Hereagain,howef-fectivetheattackisdependsonhowmuchtheattackercanchangethetokensconsideredbythealgorithm.Thus,theseattackssucceedwhenthealgorithmisunabletoaprioridistinguishbetweenthetokenscriticaltothetruesignature,andanyspurioustokensthathappentoresemblethesecriticaltokens.Theattackerforcesthealgorithmtofailbycarefullyincreasingtheappropriateresemblancebe-tweenthecriticalandspurioustokens,andhemaybeabletodothisforotherkindsofattributesaswell.Wewillusethetermreﬂectingsetstodescribethesesetsofresemblingattributes,aseachattributewithinareﬂectingsetappearstoreﬂectalloftheotherattributesinthatset.Deﬁnition:Wenowdeﬁnereﬂectingsetsformally:LetSdenotethetruesignatureforanexploit,andletAdenoteasignaturegenerationalgorithm.LetPrA[S!]denotetheprobabilitythatAgivestothefunctionS!beingthetruesignature.SupposeC1,C2,...Cjbesetsofattributes,suchthatthesignatureScontainsanattributesiineachCi.LetTisbethesetoffunctionsobtainedbychoosingoneormoreattributesci∈Ci,toreplacethecorrespondingprop-ertysiinS.LetWmandWnmbethemaliciousandnon-maliciousinstancesseenbythealgorithmsofar,andletW=Wm∪Wnm.LetTWbethesetoffunctionsinTconsistentwithW.IfPrA[T]=PrA[T!],foranypairoffunctionsT,T!∈TW,forallW,thenthesetsC1,C2...CjarereﬂectingsetsforthesignatureSandthealgorithmA.Thus,fromthepointoftheviewofthealgorithm,itisasifanycombinationofattributes,aslongasoneispickedfromeachreﬂectingset,couldbethetruesignatureevenafteranalysisoverallofthetrainingdata.IfTdenotesthesetofallcombinationsofattributesthatincludesonefromeachreﬂectingset,thentothealgorithm,thetruesignatureSappearstobedrawnatrandomfromT.Anadditionalaspectofthisdeﬁnitionisthatreﬂectingsetsarespeciﬁctoanalgorithm(orafamilyofalgorithms).Wedeﬁnethereﬂectingsetsthiswaybecausedifferental-gorithmscouldusedifferentaspectsofpossibleattributestoidentifyalikelysignature,andtherefore,reﬂectingsetforonealgorithmmaynotbeareﬂectingsetforanotheral-gorithm.Forexample,theconjunctionsalgorithmofPoly-graphuseseveryinfrequenttokenthatappearsinallofthemaliciousinstancesasitssignature.Forthisalgorithm,areﬂectingsetisveryeasilyconstructedbysimplyaddingmoreinfrequenttokenstoallofthemaliciousinstances.Suchasimplereﬂectingset,however,wouldnotworkforotheralgorithms,e.g.,naiveBayesalgorithminPolygraph,orHamsa’salgorithm.LearningwithReﬂectingSets:Inthispaper,weana-lyzetheproblemoflearningasignaturewithamaliciousadversaryasthefollowing:foreverycriticalattribute,theadversarymayincludetherespectivereﬂectingsetinthepackets(normalormalicious,asneeded).Thegoalistoﬁndthetruesignaturebyidentifyingthecriticalattributes,isolatingthemfromtheirreﬂectingsets.Wedeﬁnetheprob-lemformallyinthenextsection.3.2FindingReﬂectingSetsTheresultsofthispaperareapplicabletoalgorithmswhereitispossible/easyfortheadversarytoconstructre-ﬂectingsets(orsetswithabiasawayfromthetruesigna-ture)fortheattributesinthetruesignature,e.g.,pattern-extractionalgorithms.Ingeneral,thiscouldbedoneforalgorithmsthatrequireinformationfrom(adversarially-generated)exploits,butcannotidentifythetruecauseoftheexploit,andtherefore,theattributeorparametertheylearncanbeforgedbytheattacker.Itisalsonotstrictlynecessaryforalltheattributesinthereﬂectingsettohaveidenticaltrafﬁcstatistics:thegoalistocapturethealgorithm’sinabilitytodistinguishbetweendif-ferentattributesinsidetheset,andtherefore,unabletobiasanyselectiontowardsthetruesignature.Ifthereﬂectingsetsarechosensothatthealgorithm’schoiceofsignatureislesslikelytobethetruesignature,thenthelowerboundswouldonlyincrease.e.g.,Hamsa’salgorithmpreferstokenswiththesmallestfrequencyinnormaltrafﬁcpool,andtheattacksuggestedaddsspurioustokensthatareevenlessfre-quent,andtherefore,wouldcausethealgorithmtomakeatleastasmanymistakes.Thequantitativeboundsonalgorithms’errorsarerelatedtothesizeofthereﬂectingsetsthatcanbefoundfortheat-tributes.Thesizeofanyparticularreﬂectingsetdependsonthenatureoftheexploit(e.g.,itsdistinguishingprop-erties,theprotocolsapplicable),theadversary’sabilitytomanipulatethetrainingandtestingpool,andthekindsofsignaturesthatthealgorithmaimstolearnforit.Thead-versarymaycraftthesereﬂectingsetseitherbyexplicitlyincludingselectedattributesinthemaliciousinstances,orsendingspeciﬁctypesofinstancesinthetrainingdata.Be-causetheadversarycraftsthereﬂectingsetforthesignaturegenerators,theadversaryknowsthereﬂectingset.Earlierexperimentalwork(e.g.,inParagraph)hasdemonstratedthatreﬂectingsetscanbefoundforcurrentgenerationsofpattern-extractionalgorithms.Further,poly-morphicblendingattacks[14]suggestthatitmaybepossi-bletoﬁndsuchreﬂectingsetsformanypattern-extractionalgorithms,aslongasthealgorithmsusebyte-basedtrafﬁcstatisticsforﬁndingthepriorsofthecriticaltokensinthesignature(e.g.[33]).Webelieveitwouldbetypicallypos-sibletoﬁndreﬂectingsetsforpattern-extractionalgorithmsingeneral,especiallythosewhichusethetrafﬁcstatisticsofindividualtokens,duetotheheavy-tailednatureofnormaltrafﬁcdistribution.4GeneralAdversarialModelInthissection,weconsiderageneraladversarialsetting,andwepresentimpossibilityresultsonlearningalgorithmsthatgeneratesignaturesinthismodel.4.1LearningModelWepresentouranalysisinthemistake-boundmodeloflearning.AsdescribedinSection2.2,wechoosethismodelbecauseitaffordsthealgorithmsigniﬁcantpower,butevenwiththispower,theadversarycandelaysignaturegener-ation.Inthismodel,thealgorithmgetsaninitialtrainingpool(ofanysize),andthengetsoneinstanceatatimetoclassify,classiﬁesitasmaliciousornon-malicious,andisthentoldthecorrectlabeloftheinstance.Thealgorithmthenupdatesitshypothesis.Thealgorithm’sgoalistocon-vergetothetruesignaturewhileminimizingthemistakesmade.Eachinstancegiventothelearningalgorithmisanm-tuplebooleanvector,i.e.,apointin{0,1}m.Thetruesig-nature,ortargethypothesis,isaconjunctionofnattributes:aninstancemustcontainallnattributestobemalicious.AsdiscussedinSection3,weassumetheadversarycanﬁndareﬂectingsetCiofsizekforeachcriticalattributei,andthealgorithmcannotdistinguishbetweentheattributesin-sideCi.Itmay,however,beabletodistinguishbetweenattributesindifferentreﬂectingsets,andweneedtoac-countforthisinthelowerbounds.Thus,thesetofallvalidhypothesesisthesetofallconjunctionscontaininganat-tributefromeachreﬂectingset;thus|H|=kn.Werefertothenbitsinthetruesignatureasthetargetbits.Becausetheadversarycraftsthemaliciousdata,hecanensurethatevenwithaninitialtrainingpool,noinformationisreleasedaboutthecriticalattribute,todistinguishitinitsreﬂectingset.Thetotalnumberofattributesm=nk,theproductofthenumberofcriticalattributesandthesizeofeachreﬂect-ingset.Ourboundsareintermsofthenumberofmistakesmadebythealgorithm.Themistakesmadecanbeinterpretedasthenumberofupdatesrequiredtoconvergetothetruesig-nature,whenthealgorithmreceivesthecorrectlabelrightaway.Themistakesinthismodelimplyfalsepositivesandnegativesinthestandardbatchsetting:amistakeonama-liciousinstanceisafalsenegative,andamistakeonanon-maliciousinstanceisafalsepositive.Theexactfalseposi-tiveandnegativeratethatamistake(orasequenceofmis-takes)causesdependsonthespeciﬁcalgorithm,butaworst-caseestimateonanyparticularbatchcanbeseen:wheneverthealgorithmmakesamistake,theadversarycangenerateadistributionthatcausesa100%falsenegativerate(foramaliciousinstance),orpotentiallyalargefalsepositiverate(foranormalinstance).Therearetwowaysinwhichtargethypothesiscanbechosenforthelower-boundsanalysis.TheadversarycanchoosethetargethypothesisfromthesetH,ornaturepicksthetargetatrandomfromthesetH,andtheadversaryknowsthetargethypothesisselected.Lowerboundsforthesecondwayofchoosingthetargetclearlyimplylowerboundsfortheﬁrst.RepresentationofHypothesisEventhoughthetargethypothesisisaconjunctionofthetargetbits,thereisnorequirementthatthelearningalgorithmlearnaconjunctionofthetargetbits.Thatis,thelearningalgorithmisfreetochooseanyfunction,aslongasitagreeswiththetargethy-pothesisonalltheinstancesseen.Formally,letx1,...,xmdenotembitsofaninstance,wherexj={0,1}.Inthiscontext,aconjunctionhypoth-esisisafunctionxa∧xb∧...xr,forsomervalues,andevaluatestotrueifallbitsxa...xrare1.Alinearsepara-torhypothesisisafunctionoftheform!i∈[1,m]wixi>qwheretheweightswi∈$.Allinstancesthatsatisfythecondition(i.e.,weightedcombinationsofbitsexceedsthethresholdq)evaluatetotrue.Therepresentationofthehypothesisisthetypeoffunc-tionlearntbythealgorithm,e.g.alinearseparatororcon-junction.Polygraphusesbothconjunctionsandlinearsepa-rators,andHamsausesconjunctions.Theresultsinthissec-tionareindependentofthehypothesisrepresentationcho-sen.4.2ResultsWenowpresentourresultsinthelearningmodelde-scribedabove.Eachoftheselowerboundscanbederivedfrommoregeneralresultsinlearningtheory;ourproofsshowanexplicitconstructionofinstancesthatachievetheboundsforoursetting.Forspacereasons,wedeferallproofstotheappendix.Intheproofofeachtheorem,weshowasequenceofinstancesforwhichanyalgorithmmustachievethestatedmistake-bound.2Weﬁrstpresentboundsontheoverallnumberofmis-takesthatanydeterministicorrandomizedalgorithmcouldbeforcedtomake.Theorem4.1showsthateverydetermin-isticalgorithm,regardlessofwhatitlearns,couldbeforcedtomakeatleastnlogmnmistakesbyanadversary–thus,themistakesgrowlinearlyinthesizeofthesignature,butonlylogarithmicallyinthesizeofthereﬂectingsets.2Theadversarydoesnotrequireknowledgeofthealgorithm’sbe-haviourtogeneratethenextinstance.Hewouldforthelowerboundsondeterministicalgorithms,buttheboundsfortherandomizedalgorithmsapplyevenifthealgorithmisablackboxtotheadversary.Theorem4.1.(DeterministicAlgorithms)Foreveryde-terministicalgorithm,anadversarycangeneratease-quenceofinstancessuchthatthealgorithmisforcedtomakeatleastnlogkmistakes,wherekisthesizeofthereﬂectingsets.SincetheboundofTheorem4.1scaleslogarithmicallywiththenumberofspuriousattributes,itisnaturaltoaskwhetherthislowerboundistight.TheWinnowalgo-rithm[22]achievesaboundwithinnlognadditivefactor,showingthattheboundisnearlytight.However,muchoftheerrorintheprevioustheoremcomesfromtheadversary’sabilitytopredictwhattheal-gorithmwoulddonext.Acommonsolutionistoallowthealgorithmtouserandomization.Theorem4.2analyzesthenumberofmistakesmadeifthealgorithmisrandomized(orequivalently,unknown)totheadversary.Itshowsthatevenifthesignaturegeneratorusesarandomizedalgorithm,thealgorithmcanbeforcedtogeneratealotofmistakesinex-pectation,halfthemistakesofthedeterministiccase.Theorem4.2.(RandomizedAlgorithms)Foranyran-domizedalgorithm,anadversarycangenerateasequenceofinstancessothatthealgorithmwillmake,inexpectation,atleast12nlogkmistakes,wherekisthesizeofthereﬂect-ingsets.Theorem4.2showsthatanarbitrarydeterministicalgo-rithmisnottoomuchworsethanarandomizedalgorithm,andsuggeststhatsomedeterministicalgorithmsmaynotfaretoopoorly.Thisresultis,however,dependentonthenatureofdeterminisminthealgorithm.Forexample,onekindofextremedeterminismistoguaranteenofalseposi-tivesornofalsenegatives.Suchalgorithmsareattractive,sinceitseemsbettertohavetotolerateonlyonekindoferror.Wenowconsiderone-sidedalgorithms:algorithmswhicharenotallowedtomake(many)falsepositivesor(many)falsenegatives.Ourresultsshowthatone-sidedal-gorithmscanbeforcedintomakingmanymoreerrorsthanalgorithmswitharbitrarybreak-downofmistakes(e.g.,incomparisontoTheorem4.1).Guaranteeingasmallnum-berofmistakesofeitherfalsepositivesorfalsenegativesforcesthealgorithmtomakealargenumberofmistakesoftheotherkind.Theorem4.3.(BoundedFalsePositives)Ifanalgorithmthatisnotallowedtomakeanymistakesonnon-maliciousinstances,thereexistsasequenceofinstancessuchthatitisforcedtomakeatleastn(k−1)mistakesonmaliciousinstances.Moregenerally,consideranalgorithmthatisforcedtomakefewerthantmistakesonthenon-maliciousinstances,fort≤n.Thenthealgorithmmustmakeatleast(n−t)(k−1)mistakesonthemaliciousinstances.Suchlargemistakesarenotspecialtoonlyalgorithmsthatrequireasmallnumberoffalsepositives.Theorem4.4showsmistake-boundsforalgorithmsthatmustmakeveryfewfalsenegatives.Indeed,thesemistake-boundsaremuchlargerthanthoseinTheorem4.3,forkn’n(i.e.,sincereﬂectingsetsarelargebutcontainonlyonetargetbiteach).Theorem4.4.(BoundedFalseNegatives)Ifanalgorithmisallowedtomakenomistakesonmaliciousinstances,anadversarycangenerateasequenceofinstancessothatthealgorithmisforcedtomakekn−1mistakesonnon-maliciousinstances.Moregenerally,consideradetermin-isticalgorithmthatisforcedtomakefewerthantmistakesonmaliciousinstances,fort0inourproof.Forcompleteness,wepresentthewholeproofheretoillustratethesequenceofinstancesthattheattackercanpresent,inordertoforcethemistakesindicatedinthelowerbound.Lett=0.Then,weneedtoshowasequenceofin-stancessuchthatthealgorithmmakesatleastn(k−1)mis-takes.Ifthealgorithmisallowedtomakenomistakeonnon-maliciousinstances,itmustalwayslabelaninstancetobenon-maliciouswhenitisuncertainofthelabelofaninstance.Inordertohavethealgorithmmakealotofmistakes,theadversaryhastopresentasequenceofinstancessuchthatthealgorithmisalwaysforcedtolabelitnon-malicious.Theadversarydoesthisasfollows:intheithepoch,hepicksonereﬂectingsetCitofocuson,andtheinstancespresentedhavethebitsthatcorrespondtoalltheotherreﬂectingsets(i.e.,otherthanCi)allsetto1(e.g.,intheﬁrstepoch,allbitsthatcorrespondtoreﬂectingsetsC2toCnarealwayssetto1).HestartstheepochbypresentingtheinstancewithallbitsinCisetto1,andhechoosesoneadditionalnon-targetbitfromthecurrentinstance,andsetsitto0togeneratetheinstancethatfollows.Thus,withinanepoch,everyinstancereceivedbytheal-gorithm(subsequenttotheﬁrstinstance)hasonefewerbitsetto1thanthepreviousinstance.However,itdoesnotknowwhetherthetargetbithasbeensetto0,bydeﬁnitionofthereﬂectingset,andthereforehastolabeltheinstancenon-malicious.Astheadversarydoesnotsetthetargetbitto0,eachinstancepresentedtothealgorithmisindeedma-licious.Theadversarycanpresentk−1suchinstancesforeachreﬂectingset,andthus,therearen(k−1)mistakesmadebythealgorithm.Whent≥1,thealgorithmmaymakeatmosttincorrectguessesonnon-maliciousinstances.Theadversarymayusethesamesequenceofinstancesasdescribedabove,andbe-causethealgorithmisdeterministic,theadversaryknowswhenthealgorithmwilllabelaninstancetobemalicious.Theadversarycanthenchoosethetargethypothesissothat,atthatpoint,anon-maliciousinstanceispresented,i.e.,itisthetargetbitoftherelevantreﬂectingsetthatisdroppedattheinstance(thoughallbitsdroppedearlierintheepocharestillnon-targetbits,asbefore).Withthischange,algorithmhasthenmadeamistakeonanon-maliciousinstance,butalsoknowsthetargetbitfortherelevantreﬂectingset,andwillnotmakeanymoremistakeswithinthatepoch.Thus,eachmistakeonanon-maliciousinstanceinthissequencerevealsthetargetbitofonereﬂectingset,butnoinforma-tionaboutanyotherreﬂectingset.Whenthealgorithmisallowedtsuchmistakes,theadversarycanforcethealgo-rithmtomakeatleast(n−t)(k−1)mistakesonthemali-ciousinstances.A.4ProofforTheorem4.4Proof.Ourproofforthecaseoft=0isanapplicationofthetheoremsin[1]toourproblem,arestrictionofthegenerallearningproblem.Weextendthisfort>0inourproof.Forcompleteness,wepresentthewholeproofheretoillustratethesequenceofinstancesthattheattackercanpresent,inordertoforcethemistakesindicatedinthelowerbound.Onceagain,webeginwiththecaseoft=0.Now,theadversaryisallowedtomakenomistakesonthemaliciousinstances.Therefore,anytimethealgorithmreceivesaninstance,itmustlabelitmalicious,unlessthealgorithmiscertainthattheinstanceisnotmalicious.Theadversarypresentsanynon-maliciousinstancewithnbitspresent,subjecttothefollowingtwoconditions:(1)exactlyonebitispresentfromeachreﬂectingset,(2)alltargetbitsarenotpresentintheinstance(thisfollowsbydeﬁnitionofanon-maliciousinstance).Eachinstanceinthissequenceisnon-malicious,butthealgorithmisforcedtolabelitmalicious:thealgorithmdoesnothaveenoughinformationtodistinguishwhetheranyparticularbitpresentfromareﬂectingsetistrulythetargetbitforthereﬂectingset,untilamaliciousinstancehasbeenpresented.Moreformally,letAdenotethesetofallinstancesthatsatisfytheabovetwoconditions:eachinstanceinAcon-tainsexactlynbitssetto1,andonlyonebitissetfromeachreﬂectingset.Letimaldenotethesolemaliciousin-stanceinA.Theadversarypresentsinstancesi1,i2,...fromA−{imal}tothealgorithm,oneatatime.De-ﬁneIwtobethesetoftheﬁrstwinstancespresented,forw0,ifPr[T]>,aninstancedrawnatrandomfromKwillforcethealgorithmtomakeamistakewithprobabil-ity/"ndn#.Thus,thereisalwaysaconstantchanceoferroronthenon-maliciousinstancesifPr[T]>.Therefore,ifthealgorithmusesaconjunctionwithfewattributes,alongsequenceofrandominstancesdrawnfromKcouldgen-erate,inexpectation,manynon-informativeerrorsonthenon-maliciousinstances.Now,ifthealgorithmtriestoﬁndaconjunctionwithatleastdn+1attributes(andthusincludeattributesfromatleastdn+1reﬂectingsets),itmakesatleastk−1kmistakesinexpectationforeachofthe(dn+1)attributes.Asbefore,theadversarystartswiththemaliciousinstancethathasallbitssetto1,andineachsubsequentround,picksoneaddi-tionalnon-targetbit(fromanyreﬂectingset)tosetto0intheinstancethatispresented.Foreveryreﬂectingsetthatappearsinthealgorithm’sconjunction,thealgorithmhasa1/kchanceofmakingamistakewhenanynon-targetbitissetto0.Becausetheadversarycandothisk−1timeswithinasinglereﬂectingset,theexpectednumberofmistakesisk−1k,withinoneset.Theadversarycanensurethatdn+1reﬂectingsetsareusedwithprobability1−,sothenumberofmistakesitmakes,inexpectation,is(1−)k−1k(dn+1),forany>0.B.3ProofforTheorem5.3Proof.RecallthatCidenotestheithreﬂectingset.LetU={Ci}i.Withoutlossofgenerality,wewillassumethatthebitsintheinstancearereorderedsothattheﬁrstkbitscorrespondtotheattributesinreﬂectingsetC1;thenextkbitscorrespondtotheattributesinthereﬂectingsetC2,andsoon.Letxi,jbe1ifthejthpropertyofthere-ﬂectingsetCiispresentintheinstance(ik+jthbitis1inthereorderedinstance)and0otherwise.Alinearseparatorthatidentiﬁesmaliciousinstancesneedstobeoftheform!i,jwi,jxi,j>t,wherewi,jisaweightoftoken,andtisanyﬁxedvaluewitht>0.Fortheproof,wewilluseK,thesetofzero-informationin-stancesdeﬁnedintheproofofTheorem5.1.LetDbeasetthatcontainsexactlyd-fractionofthereﬂectingsets.Theadversarycanthenforcethefollowingconstraintstoholdateverypointoftime:foreveryD,!a∈D!jwa,j≤t.Thisisbecauseiftheconstraintsdonothold,theadversarycanforcethealgorithmtomakeamistakeonazero-informationinstancefromK,andthusthealgorithmmakesamistakethatdoesnothelpinidentifyingthetargethypothesis.AsintheproofofTheorem5.1,weshowhowtheat-tackergeneratesmistakesonthemaliciousinstanceswiththeseconstraints.Theattackerconstructsmaliciousin-stancesasfollows:foreachreﬂectingsetCi,theattackerchoosesthepbitswiththelowestweights,andsetsthema-liciousinstancetohavethesepbitstobe1.LetqibethesumoftheweightsofthepbitsforareﬂectingsetCi.Then,foreverysetDasdeﬁnedear-lier,!i∈Dqi≤tpk.LetDbethesetofallsuchsetsD.Then,wehave!D∈D!i∈Dqi≤|D|tpk.Thisimpliesthat"n−1dn−1#!i∈Uqi≤"ndn#tpk,giving!i∈Uqi≤tpkd.Byset-tingp≤kd,!i∈Uqi≤t.Thus,theattackercansendamaliciousinstancewiththeappropriatepbitsset,andthealgorithmwillmakeamistakebylabellingitnon-malicious.Withthismistake,theattackerhasreducedthesizeofeveryreﬂectingsettoeffectivelybekdfromtheoriginalsizeofk:thealgorithmnowknowsthatthetargetbithastobeamongthekdbitsthatweresetinthemaliciousinstancejustpresented.Theadversarycanrecursethisprocedurewiththenewreﬂectingsets,untiltheirsizehaseffectivelyreducedto1,andthisallowstheattackertoforcelog1/dkmistakes,orlog1/dmn.B.4ProofforTheorem5.4Proof.TheproofissimilartothatofTheorem5.3;however,weneedtomaketwomodiﬁcations,becausetheadversarydoesnotalwaysknowtheinternalstateofthealgorithm.Inourproof,weuseK,thesetofzero-informationinstancesdeﬁnedintheproofofTheorem5.1.First,theadversarynolongerknowswhetherthecon-straint!i,jwi,j≤t/disdisobeyed;however,hecanforceittoholdwithhighprobabilitybypresentingtheal-gorithm,atrandomlychosenpointsinsequence,anon-maliciousinstancefromK.Inparticular,forany>0,ifPr[!i,jwi,j>t/d]>,aninstancedrawnatran-domfromKwillcausethealgorithmtomakeamistakewithprobabilityd.Thus,thereisalwaysaconstantchanceoferroronthenon-maliciousinstancesifPr[!i,jwi,j>t/d]>–thischanceoferrordoesnotapproach0aslongas!i,jwi,j>t/d.Therefore,if!i,jwi,j>t/d,anarbitrarilylongsequenceofrandominstancesdrawnfromKcouldgenerate,inexpectation,arbitrarilymanynon-informativeerrorsonthenon-maliciousinstances.Thesecondmodiﬁcationneededisthattheadversaryconstructsaslightlydifferentsequenceofmaliciousin-stancespresenttothealgorithm.Inthissituation,thead-versarycannotpickthepsmallestweights,sincethead-versarydoesnotknowthepsmallestweights.Instead,theadversarypicksp/2weightsatrandom,fromeachreﬂect-ingset,andconstructsaninstancewiththosebitssetto1,andtherestsetto0.Theprobabilitythatthesenp/2weightsexceedtp/kdisatmost1/2,whichmeansthattheprobabilitythatanmistakeiscausedisatleast1/2,byMarkov’sinequality.Thus,ateachstep,thealgorithmmakesamistakewithprobability1/2,andthenumberofat-tributesineachreﬂectingsetreducestokd/2.Thus,theal-gorithmmakes1/2log1/2dmnmistakesonthemaliciousin-stancesinexpectation,whentheconstraint!i,jwi,j>t/dholds.Asthiscanbesettoholdwithprobability1−,forany>0,theexpectednumberofmistakesisatleast12(1−)log1/2dmn.