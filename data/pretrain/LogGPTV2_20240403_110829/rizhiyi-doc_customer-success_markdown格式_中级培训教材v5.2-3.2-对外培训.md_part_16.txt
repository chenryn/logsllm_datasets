日志学院
则可以配置得到如下桑基图:
3-171
日志学院
桑基图上各节点的颜色默认自动分配，如果需要对部分节点采用相同的颜色标记，可以使用
关系图的颜色分组特性，示例说明如下:
 普通效果
(logtype:jsonANDappname:json)AND
'tag':sample04061424_json_sdyd_float_59|statscount()byjson.name,
json.actionName,json.dimensions.cookie_CURRENT_MENUID,json.application
得到的表格如下:
配置桑基图如下：
 颜色分组效果
为节点字段name搭配一个同名的{name}_group字段，作为颜色标记的分组凭据：
(logtype:jsonANDappname:json)AND
'tag':sample04061424_json_sdyd_float_59|statscount()byjson.name,
json.actionName,json.dimensions.cookie_CURRENT_MENUID,json.application
3-172
日志学院
|renamejson.nameasjson.actionName_group|renamejson.applicationas
json.dimensions.cookie_CURRENT_MENUID_group
得到的表格如下:
配置桑基图如下:
注：关系图中其他类型图表，同样支持颜色分组特性。
力图
例如如下搜索:
logtype:apache|statscount()byapache.clientip,apache.request_path
可以得到如下结果：
3-173
日志学院
图中出现了一个游离在外的孤岛，可以很容易的看到，来自183.60.191.56的访问请求和其
他来源地址截然不同，值得重点关注。
力图可以设置斥力因子：大于0的数值，值越大，斥力越大，两个球之间的距离越远。我们
可以调节斥力因子使图形更美观。
复合
此类图表变量较多，均不提供自动配置的功能。
复合类图表包括以下两种：
区间图：用esma预测CPU、内存使用情况时，使用区间图展示波动区间；
多Y轴图：采用不同形态展示同一数据。
区间图
区间图所需配置参数较多，因此需要点击进入“设置”栏目，手动配置五个参数：
1.x轴
2. 展示字段
3. 标记
4. 区间上限
3-174
日志学院
5. 曲线下限
区间图可用于展示时序指标的拟合和置信区间。
例如搜索:
*|buckettimestampspan=15sasts|statscount('appname')as'count'byts|esmacount
timefield=ts
得到结果表格:
字段的相应配置规则应为:
 X轴字段：ts
 Y轴实际值：count
 Y轴预测值：_predict_count
 区间上限字段：upper95
 区间下限字段：lower95
得到如下结果:
如上图所示，图中将明确标记预测值的历史部分和未来部分。
3-175
日志学院
多 Y 轴
多Y轴图的参数设置随机性较高，因此需要用户点击进入“设置”栏目，手动配置以下参数:
1.X轴
2.Y轴（可设置多个）
3. 每个Y轴对应一个图表类型（曲线图，面积图，散点图，柱状图）
4. 分组
您可以选择不同Y轴的序列采用不同形态来展示。也就是说，可以左Y轴用折线图，右Y
轴用柱状图，右二Y轴用散点图。
下图是一个双Y轴的折线图：
地图
目前包含四类图表：
热力地图: 热力分布方式，展示统计数值的分布差距；
攻击图：针对网络攻击、访问路径等具有明显来去轨迹的行为，日志易提供了轨迹地图功能；
区划地图：支持图内点击钻取效果，但是要求 SPL 统计表格中一次性包含各层级的结果；
统计地图：统计地图是专门针对 geostats 指令的返回结果特制的可视化效果。可以在地图
上根据经纬度精准定位绘制饼图分布。
区划地图和热力地图提供自动配置功能，图表配置详情见下文。攻击地图和统计地图需用户
手动配置。
区划地图
区划地图支持图内点击钻取效果，但是要求 SPL 统计表格中一次性包含各层级的结果。比
如，实现完整的从世界到省份的钻取逻辑的统计语句应该写作：
logtype:apache|statscount()byapache.geo.country,apache.geo.province,apache.geo.city
然后设置对应的省市级下钻字段即可:
3-176
日志学院
此外，区划地图还有其他几个参数:
1. 数值：自动配置时会取第一个统计数值；
2. 切分：自动配置时会取第一个分组字段；
3. 区域：可以选择世界，中国，北京、上海等各省市。
热力地图
字段的自动配置包括两类参数：
1. 数值：取第一个统计数值；
2. 切分：取第一个分组字段。
热力地图在普通的行政区划地图效果基础上，采用热力分布方式，展示统计数值的分布差距。
例如搜索：*|statscount()byapache.geo.city得到的热力地图效果如下:
3-177
日志学院
攻击地图
攻击地图所需配置参数较多，因此需要点击进入“设置”栏目，手动配置八个参数:
1. 来源字段值
2. 来源经度
3. 来源维度
4. 目标字段值
5. 目标经度
6. 目标维度
7. 权重字段值
8. 区域：世界/中国
针对网络攻击、访问路径等具有明显来去轨迹的行为，日志易提供了轨迹地图功能，例如：
*|statscount()bygw.src.geo.city,gw.src.geo.latitude,gw.src.geo.longitude,gw.dst.geo.city,
gw.dst.geo.latitude,gw.dst.geo.longitude
得到的效果如下:
对于部分国内客户来说，绝大多数数据都集中在中国境内。日志易提供了展示区域的切换，
可以在设置中，切换为中国地图范围内的轨迹地图。
3-178
日志学院
统计地图
统计地图是专门针对 geostats 指令的返回结果特制的可视化效果。可以在地图上根据经纬
度精准定位绘制饼图分布。一个饼图表示一个指定的经纬地理区域内的数据统计结果，其大
小表示数据总大小，其切片大小表示数据内某分组值的大小。绘制中心点处于该经纬区域内
所有实际点的几何中心位置。
由于是专属可视化效果，可配置参数仅包含对饼图的半径大小和透明度设置。当地图上饼图
过多过大时，会相互遮盖影响展示，请用户合理设置。
logtype:vorsANDvors.VendorCountry:United\States|geostatslatfield=vors.VendorLatitude
longfield=vors.VendorLongitudemaxzoomlevel=3sum(vors.Weight)byvors.product_name
该语句对应的效果如下:
地图上可以点击进行放大缩小查看操作，日志易会根据 geostats 指令返回的不同层级数据
进行聚合展示。maxzoomlevel 参数最多支持 9 层。
其他
此模块每一类视图都对应不同配置条件，其用途也各有不同：
 单值：单个数值展现，可根据字段类型添加图标，可按区间、趋势展现；
 水球图：单个数值展现，多用于百分比展示；
 字符云图：常用于展示单词文本的占比数据。比一般饼图的视觉冲击力更强；
 循序图：关注消息在对象之间交互的生命线。循序图常见于软件开发的UML领域；
 雷达图：将多个维度的数据量映射到坐标轴上，常用于展示出数据集中各个变量的权重
高低情况，非常适用于展示性能数据；
 漏斗图：漏斗图适用于业务流程比较规范、周期长、环节多的单流程单向分析，用梯形
面积表示某个环节业务量与上一个环节之间的差异；
 矩阵热力图：常用于分组较多时，关注同一时刻数据的离散度；
 调用链：用来展示zipkin、pinpoint、skywalking 和 jaeger 等开源 Tracing 方案，常用
于展示订单在各业务系统中流经的过程。
3-179
日志学院
单值
可配置字段包含三类参数：
1. 数值字段：取第一个统计数值
2. 展示效果：
 默认：只能设置颜色填充字体或背景；
 按区间：需手动添加数值分段区间并选择对应颜色，用“*”星号表示无穷大。注意数值
分段区间不能重叠。也支持设置颜色填充字体或背景；
 按趋势：可设置对比时间，固定按涨跌启用红绿色背景，可选择使用绝对值或百分比形
式展示对比效果。
3. 图标
 按名称：输入任意一个fontawesome免费图标的英文名称即可在单值前部展示名称对
应的图标，考虑到 fontawesome 免费图标库多达一千二百多个，日志易提供了输入提
示功能；
 按字段：如果需要根据搜索结果动态变化图标，可以由 SPL 语句返回某个字段，指定
该字段名称，日志易将自动使用该字段值作为 fontawesome 图标名称。
3-180
日志学院
水球图
可配置字段只有一个：“展示字段”。默认用第一个统计数值自动配置。比如之前章节介绍的
百分位统计，请求如下：
logtype:apache|statspct_ranks(apache.resp_len,25)|evalret=
_pct_ranks.apache.resp_len.25/100
改用水球图效果为：
字符云图
自动配置的两个参数及默认的字段取值规则:
1. 展示字段：取第一个统计数值
2. 分组：取第一个分组字段
字符云图常用于展示单词文本的占比数据。比一般饼图的视觉冲击力更强。比如如下请求:
logtype:apache|statscount()byapache.geo.city
使用词云图效果为：
3-181
日志学院
循序图
循序图，又叫时序图、顺序图。和时序指标趋势图不一样，循序图更关注消息在对象之间交
互的生命线。循序图常见于软件开发的UML领域。
日志易中，可以具体定义循序图的时序、来源、目标、分组、标记字段。系统将自动把来源
和目标字段合并得到对象列表。
3-182
日志学院
注意：循序图上对象数量不宜过多。
雷达图
雷达又叫戴布拉图、蜘蛛网图。雷达图是一种表现多维（4维以上）数据的图表。它将多个
维度的数据量映射到坐标轴上，这些坐标轴起始于同一个圆心点，通常结束于圆周边缘，将
同一组的点使用线连接起来就成了雷达图。它可以将多维数据进行展示，和饼图不同的是，
点的相对位置和坐标轴之间的夹角是没有任何信息量的。在坐标轴设置恰当的情况下雷达图
所围面积能表现出一些信息量。
为了容易理解和统一比较，使用雷达图经常会人为的将将多个坐标轴都统一成一个度量，比
如：统一成分数、百分比等。这样这个图就退化成一个二维图了，事实上这种雷达图在日常
生活更常见、更长用。另外，雷达图还可以展示出数据集中各个变量的权重高低情况，非常
适用于展示性能数据。
日志易中，可以具体定义雷达图的数值、切分、指示器字段。
此外，在切分配置中，可以开启"统一度量"选项，使用二维图效果，上例开启之后的效果如
下：
3-183
日志学院
雷达图上指示器过多，或切分过多，都会导致可读性下降，请务必控制，使雷达图保持简单
清晰。
漏斗图
漏斗图适用于业务流程比较规范、周期长、环节多的单流程单向分析，通过漏斗各环节业务
数据的比较能够直观地发现和说明问题所在的环节，进而做出决策。漏斗图用梯形面积表示
某个环节业务量与上一个环节之间的差异。漏斗图从上到下，有逻辑上的顺序关系，表现了
随着业务流程的推进业务目标完成的情况。如果无流向关系的对比，请采用饼图或柱状图。
日志易中，可以具体定义漏斗图的数值和切分字段。
3-184
日志学院
矩阵热力图
矩阵热力图效果，基于数值对比常用的热力图效果，结合矩阵布局进行时序数据的分析。常
用于分组较多时，关注同一时刻数据的离散度。
日志易中，可以具体定义矩阵热力图的 X 轴、Y 轴字段，以及 Y 轴的分段数量。其中，
矩阵热度并不是使用原始数值，而是计算落入对应分段区间的分组个数。落入某个矩阵单元