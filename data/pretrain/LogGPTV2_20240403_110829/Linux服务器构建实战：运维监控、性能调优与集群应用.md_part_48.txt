## Page 330
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
先添加一个虚拟IP地址，如图12-20所示。
源如图12-19所示。
12.5.3创建Resources
“priority”处将Mysqll的优先级设置为2，Mysql2的优先级设置为8，如图12-18所示。
的Member复选框中，选择加人此域的节点，这里选择Mysqll和Mysql2节点。然后，在
值的增大，节点的优先级也依次降低。
的优先级设置为10。需要说明的是，
这里选择的是web1和web2节点。然后，在“Priority”处将web1的优先级设置为1，web2
在图12-9左下端mycluster选择框中，
Resources是集群的核心，主要包含服务脚本、IP地址、文件系统等。RHCS 提供的资
按照前面的介绍，继续添加第二个失败转移域mysql-failover。在Failoverdomainmembership
所有设置完成，单击“Submit”按钮，开始创建FailoverDomain。
接下来，在Failoverdomainmembership的“Member”复选框中选择加入此域的节点
口Donotfailback servicesin this domain：表示在这个域中使用故障切回功能，也就是
障切换限制，这里选择启用。
口Restrictfailover to this domain'smembers：表示是否在失败转移域成员中启用服务故
集群的服务和资源会从备用节点自动切换到主节点。
说，主节点故障时，备用节点会自动接管主节点服务和资源，当主节点恢复正常时，
www.Linuxidc.com
mycuster
Cenferesm
ervice
lodes
Configure
Gluster List
图12-18创建mysql-failover
Node
Fallover domainmemt
onotfailbaedonen
Restrict
AddaFallover
mycluster
Submit
veb1
Mysql
Ayso
“Priority”设置为1的节点，优先级是最高的，随着数
，依次单击“Resources”→“Add aResource”，首
7
Domain
315
群
---
## Page 331
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
316
接着，再添加一个HTTP服务脚本资源，如图12-21所示。
Www.Linuxidc .com
AddaResource
Services
Configure
Cluster List
mycluster
hared
Resource
Configure a
Resources
lodes
Shared Fence
Failover Domains
Resource
Configure a
AddaResource
Resources
Services
Hodes
Configure
Cluster
Craabea Nev
Cluster List
图12-20添加IP地址
图12-19RHCS资源一览
Submit
IPAddressResource Configuration
AddaResource
mycluster
IPaddress
Select e resource type
Selecta Resource Type
AddaResource
mycluster
SOL
oeript
就
el
192.168.12.233
PDG
---
## Page 332
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
口Device，指定需要挂载共享磁盘的设备标识。
口Mount point，指定文件系统的挂载点，这个挂载点要在服务器上存在。
口File system type，指定文件系统的类型，默认的选项有ext2、ext3。
口Name，表示添加文件系统资源的名称，任意指定一个即可。
图12-22中的各个选项的含义如下：
然后添加一个ext3文件系统资源，如图12-22所示。
www.Linuxidc.com
ailover Domaint
Resource
AddaResource
saoitosa
Services
Nodes
rcurtar
Configure
Cbuatar Lirt
Add a Resource
myduster
dusters
Failover Domain
Ceniaure a
Resources
Services
Nodes
Configure
Cluster List
图12-22添加文件系统资源
图12-21添加httpScript资源
Submit
Fle systemID （optional)
Fle systemtype
File System Resource Configuratio
AddaResource
mycluster
Check file system before mounting
Forceunmount
Options
Device
Mount point
Name
Submit
ScriptResourceConfiguration
Adda Resource
mycluster
Full path to soript file
Name
httpSeript
D
司
317
PDG
---
## Page 333
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
最后，再次添加一个虚拟IP地址和mysqlscript，如图12-23、图12-24所示。
口Checkfile systembefore mounting，表示在挂载磁盘前，首先检测文件系统。
口Reboothost nodeifunmountfails，表示如果卸载分区失败就重启系统。
口Force unmount，表示执行强制卸载文件系统操作。
口Options，指定挂载文件系统时的一些挂载参数，可以不填写。
myduster
Devices
Fallover Domains
AddaResource
Kesources
Services
Nodes
Configure
Cluster Lirt
myduster
clustor
Failover Domsini
AddaResource
eso
Service:
sepoN
Configure
Clustar List
图12-24添加mysqlscript
图12-23添加IP资源
Submit
ScriptResource Configure
AddaResource
mycluster
Full path to script file
Name
Submit
IPAddressResource Configure
AddaResource
mycluster
Monitorlink
IPaddress
192.160.12.234
aysqlser
ator
PDG
---
## Page 334
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
existingglobalresource”，将已经存在的资源加人到新建的服务中，这里依次加入集群IP地
单击“Add a resource to this service”按钮，增加一个资源到这个服务中，选择“Use an
以选择“Restart”，也就是服务不可用时，尝试重启服务，而不是切换到其他节点。
的含义是：当服务在一个节点上不可用时，立刻将服务转移到其他节点。在恢复策略中还可
webserver-Failover加人到此服务中，并且设定服务的恢复策略为“Relocate”。“Relocate”
所示。
启动应用程序服务。这样就完成了整个集群系统高可用服务的转移。
在接到故障节点成功卸载共享磁盘的通知后，开始执行挂载磁盘，接着启用集群IP，最后，
卸载共享磁盘，接着释放集群IP地址，最后停止集群应用程序服务；而备用节点刚好相反，
在故障切换时，集群服务的转移是有先后顺序的，如果集群中有共享磁盘，那么主节点会先
仅接管主节点的应用程序服务是不够的，还必须要接管集群服务IP地址、共享磁盘分区等。
不仅仅是/etc/init.d/httpd之类的应用程序。在一个集群系统中，如果主节点岩机，备用节点
12.5.4
加的资源，如图12-25所示。
在图12-26中，创建了一个名为webserver的服务，设定服务自动启动，然后将
单击“cluster”，然后在“Cluster List”中单击“mycluster”，接着，在左下端的
在RHCS高可用性集群中，服务（Service）指的是一系列资源（Resource）的集合，而
所有资源添加完成后，单击“mycluster”选择框中的“Resources”选项，显示所有已添
创建Service
www.Linuxidc.com
Resources
Nodes
duster
FailoverDomain
Corfiouea
Add a Resource
Services
Configure
Cluster List
图12-25已添加资源的列表
ext3-fs
192.168.12.234
192.168.12.2331
Resourcesformycluster
mycluster
mysqiscript
httpSo
File System
IPAddress
Soript
IPAddress
Type
confiqure
Configure
Delete
319
---
## Page 335
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
群每个节点以及服务的运行状态。操作如下：
所示。
在ClusterList中可以看到两个服务的启动状态，在正常情况下，均显示为绿色，如图12-28
和mysqlScript加人到此服务中，如图12-27所示。
入到此服务中，设定恢复策略为“Relocate”，最后将集群另一个服务IP地址192.168.12.234
创建。
址192.168.12.233 和 httpScript。
RHCS也提供了根据命令行查看集群状态的方式，通过clustat命令可以更清晰地了解集
所有服务添加完成后，如果应用程序设置正确，服务将自动启动，单击“cluster”，然后
接着，继续创建第二个名为mysqlserver的服务，设置服务自动启动，并将mysql-Failover加
mycluster
Adda Service
Nodet
Configure
duntar
Shared Fence
Cluster List
Add aresourceto this serviceSubmit
IP Address Resource Configuration
AddaService
mycluster
图12-26添加一个webserver服务
Adda childDelete thisresource
This resource is anindependent subtree
Full path to scriptfle
Name
Script Resource Configuration
Adda childDelete this resource
Thisresource is an independent subtree
Moniterlink
IPaddress
Length of tme in seconds after which to forget aresta
Maximum number ofrestart falures beforereloc
FailoverDomain
Enable NFS lock workarounds
Automaticaly start this ser
Service name
所有资源添加完成后，单击“Submit”按钮完成一个服务的
192.169.12.23
/etc/init.d/htepe
httpSeript
---
## Page 336
Linux公社（www.LinuxIDC.com）是专业的Linux系统门户网站，实时发布最新Linux资讯。
Member Status:Quorate
cluster Status
[root@web1 -]#
Nodes
Configure
A
www.Linuxidc.com
Configure
duster
for mycluster @ Thu Aug 19 16:39:46 2010
clustat -l
Addaresource to this serviceSubmit
AddaService
mycluster
图12-27
Add a childDelete this resource
Full path to soript fl
Script Resource Configuration
Add childDelete thisresource
Thisresourceisanindependent subtee
IP Address Resource Configuratior
Name
Monitorfink
IPaddress
Length of time in seconds after
ecovery policy
Service name
图12-28mycluster运行状态
web2
Mysql2
Mysql1
dodes
-TotalClusterVotes:4
 Status: Quorate
Cluster Name:mycluster
Chooseacluster toadminister
Minimum Required Quorum:3
添加一个mysqlserver服务
R
192.168.12.234
workarou
start this ser
/etc/init.d/ay
ayrqlseript
口
webserver
mysqlserver
Services
Restart this clusterGo
mgld
321