### FIRMA's Signature Generation and Comparison with Manual Signatures

FIRMA currently does not support the generation of signatures based on URL parameter values. However, it can identify that all requests from a specific malware family share a common User-Agent value, which was overlooked by the analysts. For the family with fewer signatures, FIRMA generates three manual signatures. The only signature generated by FIRMA matches exactly one of the manual signatures, while the other manual signatures match individual binaries. This discrepancy highlights a case where manual analysts focused on variant-specific behaviors that do not generalize to the entire family.

We manually classified 20 families into three groups based on the number of signatures. Figure 4 illustrates the comparison between manually (M) and automatically (A) generated signatures by FIRMA. For simplicity, metadata has been removed, and family names have been normalized.

- **Cluster 1:**
  - **Manual (M):** 
    ```plaintext
    alert tcp any any -> any [80] (msg:"Cluster:1"; content:"/picture.php";)
    ```
  - **Automatic (A):**
    ```plaintext
    alert tcp any any -> any [80] (msg:"Cluster:1"; content:"GET"; http_method; content:"/picture.php"; http_uri;)
    ```

- **Cluster 2:**
  - **Manual (M):**
    ```plaintext
    alert tcp any any -> any [80] (msg:"Cluster:2"; content:"POST"; http_method; content:"pcre:"/aa1020R0=[Ë†&]+%2/";)
    ```
  - **Automatic (A):**
    ```plaintext
    alert tcp any any -> any [80] (msg:"Cluster:2"; content:"POST"; http_method; content:"aa1020R0="; content:"|253344253044253041|";)
    ```

- **Cluster 3:**
  - **Manual (M):**
    ```plaintext
    alert tcp any any -> any [80] (msg:"Cluster:3"; content:"GET"; http_method; content:"/n09230945.asp"; http_uri;)
    ```
  - **Automatic (A):**
    ```plaintext
    alert tcp any any -> any [42633] (msg:"Cluster:3"; dsize:5; content:"|6e65770d0a|";)
    ```

- **Cluster 4:**
  - **Manual (M):**
    ```plaintext
    alert tcp any any -> any any (msg:"Cluster:4"; content:"|04000001050000000007000100|";)
    ```
  - **Automatic (A):**
    ```plaintext
    alert tcp any any -> any [443,8014] (msg:"Cluster:4"; dsize:13; content:"|04000001050000000007000100|";)
    ```
    ```plaintext
    alert tcp any any -> any [9145] (msg:"Cluster:4"; dsize:181; content:"GNUTELLA CONNECT/0.6|0d0a|Listen-IP|3a|0.0.0.0|3a|22324|0d0a|Remote-IP|3a| 31.35.6.6|0d0a|User-Agent|3a| Shareaza|0d0a|";)
    ```

### Analysis of Signature Specificity

For 12 families, FIRMA generates more specific signatures compared to the manual ones. For 5 families, the signatures are identical, and for 3 families, the manual signatures are more specific. Generally, FIRMA produces more specific signatures because analysts tend to stop adding tokens when they feel the signature is sufficiently specific. There are two cases where the manual signatures are more specific:

1. **URL Parameters:** FIRMA generates a token set, while manual signatures sometimes use regular expressions, which impose ordering constraints and may limit the size of parameter values.
2. **HTTP Headers:** Some manual signatures capture the absence of HTTP headers like User-Agent or Accept, which typically appear in HTTP requests. While the automatically generated signatures are still specific enough without these features, we plan to support them in the future.

### Comparison of Clusters

- **Cluster 1:** The manual signature misses the GET method and field attributes, highlighting inconsistencies that FIRMA prevents.
- **Cluster 2:** The manual signature uses a regular expression, but FIRMA's equivalent signature is more specific and faster to match.
- **Cluster 3:** The manual signature captures traffic to the whatismyip.com web service, which can produce false positives. FIRMA's signature captures a 5-byte binary packet on port 42633, missed by the analysts.
- **Cluster 4:** FIRMA finds an extra signature that captures a new network behavior (Gnutella P2P traffic).

### Conclusion

Our qualitative evaluation shows that FIRMA-generated signatures are of similar, and often better, quality than manually generated ones. Experienced analysts would generate better manual signatures, but FIRMA significantly reduces the effort required. We plan to release a new version of the MALICIA dataset that includes both manually and FIRMA-generated signatures to facilitate external review and comparisons.

### Related Work

Several prior works propose systems for generating different types of network signatures to identify worm traffic, such as Honeycomb, Autograph, EarlyBird, Polygraph, and PAYL. These systems handle single malware families or small amounts of noise. In contrast, FIRMA handles input traffic from multiple malware families with diverse network behaviors. ProVex, AutoRE, and ShieldGen are related works that focus on specific aspects of malware detection, but they do not address the clustering of traffic from different malware binaries. Techniques like Botminer and Perdisci et al.'s work cluster malware using HTTP traffic, but FIRMA analyzes all types of traffic and includes header and body content in the signatures.

### Conclusion

FIRMA is a tool that clusters malware binaries into families and generates network signatures for each family. It efficiently produces protocol-aware token-set signatures that capture distinguishing characteristics in any request fields. Our implementation and evaluation on two recent datasets show high precision and recall. FIRMA's signatures are of similar or better quality than manually generated ones, while significantly reducing analyst resources.

### Acknowledgements

We thank James Newsome for providing the code for Polygraph and Antonio Nappa for help with the MALICIA dataset. We also thank Corrado Leita and the anonymous reviewers for their insightful comments. This work was supported in part by the European Union through Grant FP7-ICT No.256980, the Spanish Government through Grant TIN2012-39391-C04-01, and a Juan de la Cierva Fellowship for Juan Caballero.

### References

[References listed as in the original text]

This revised version aims to provide a clearer, more coherent, and professional presentation of the information.