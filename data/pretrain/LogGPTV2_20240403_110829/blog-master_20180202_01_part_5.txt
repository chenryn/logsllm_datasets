                                 Recheck Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                                 ->  Bitmap Index Scan on idx_tbl59_info  (cost=0.00..550.19 rows=15625 width=0)    
                                       Index Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                           ->  Parallel Bitmap Heap Scan on tbl61  (cost=554.09..15935.51 rows=1953 width=200)    
                                 Recheck Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                                 ->  Bitmap Index Scan on idx_tbl61_info  (cost=0.00..550.19 rows=15625 width=0)    
                                       Index Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                           ->  Parallel Bitmap Heap Scan on tbl62  (cost=554.09..15935.51 rows=1953 width=200)    
                                 Recheck Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                                 ->  Bitmap Index Scan on idx_tbl62_info  (cost=0.00..550.19 rows=15625 width=0)    
                                       Index Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                           ->  Parallel Bitmap Heap Scan on tbl63  (cost=554.09..15935.51 rows=1953 width=200)    
                                 Recheck Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                                 ->  Bitmap Index Scan on idx_tbl63_info  (cost=0.00..550.19 rows=15625 width=0)    
                                       Index Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                           ->  Parallel Bitmap Heap Scan on tbl0  (cost=554.09..15935.51 rows=1953 width=200)    
                                 Recheck Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                                 ->  Bitmap Index Scan on idx_tbl0_info  (cost=0.00..550.19 rows=15625 width=0)    
                                       Index Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                           ->  Parallel Bitmap Heap Scan on tbl1  (cost=554.09..15935.51 rows=1953 width=200)    
                                 Recheck Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                                 ->  Bitmap Index Scan on idx_tbl1_info  (cost=0.00..550.19 rows=15625 width=0)    
                                       Index Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                           ->  Parallel Bitmap Heap Scan on tbl6  (cost=554.09..15935.51 rows=1953 width=200)    
                                 Recheck Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                                 ->  Bitmap Index Scan on idx_tbl6_info  (cost=0.00..550.19 rows=15625 width=0)    
                                       Index Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                           ->  Parallel Bitmap Heap Scan on tbl15  (cost=554.09..15935.51 rows=1953 width=200)    
                                 Recheck Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                                 ->  Bitmap Index Scan on idx_tbl15_info  (cost=0.00..550.19 rows=15625 width=0)    
                                       Index Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                           ->  Parallel Bitmap Heap Scan on tbl27  (cost=554.09..15935.51 rows=1953 width=200)    
                                 Recheck Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                                 ->  Bitmap Index Scan on idx_tbl27_info  (cost=0.00..550.19 rows=15625 width=0)    
                                       Index Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                           ->  Parallel Bitmap Heap Scan on tbl32  (cost=554.09..15935.51 rows=1953 width=200)    
                                 Recheck Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                                 ->  Bitmap Index Scan on idx_tbl32_info  (cost=0.00..550.19 rows=15625 width=0)    
                                       Index Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                           ->  Parallel Bitmap Heap Scan on tbl40  (cost=554.09..15935.51 rows=1953 width=200)    
                                 Recheck Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                                 ->  Bitmap Index Scan on idx_tbl40_info  (cost=0.00..550.19 rows=15625 width=0)    
                                       Index Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                           ->  Parallel Bitmap Heap Scan on tbl43  (cost=554.09..15935.51 rows=1953 width=200)    
                                 Recheck Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                                 ->  Bitmap Index Scan on idx_tbl43_info  (cost=0.00..550.19 rows=15625 width=0)    
                                       Index Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                           ->  Parallel Bitmap Heap Scan on tbl54  (cost=554.09..15935.51 rows=1953 width=200)    
                                 Recheck Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                                 ->  Bitmap Index Scan on idx_tbl54_info  (cost=0.00..550.19 rows=15625 width=0)    
                                       Index Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                           ->  Parallel Bitmap Heap Scan on tbl60  (cost=554.09..15935.51 rows=1953 width=200)    
                                 Recheck Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                                 ->  Bitmap Index Scan on idx_tbl60_info  (cost=0.00..550.19 rows=15625 width=0)    
                                       Index Cond: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
                           ->  Parallel Seq Scan on tbl  (cost=0.00..0.00 rows=1 width=36)    
                                 Filter: (info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'::text)    
(265 rows)    
```    
6、强制使用并行，PostgreSQL 11支持多个分区并行执行，速度将更快。    
```    
set enable_parallel_append =on;    
set max_parallel_workers_per_gather =16;    
set parallel_setup_cost =0;    
set parallel_tuple_cost =0;    
set min_parallel_table_scan_size =0;    
set min_parallel_index_scan_size =0;    
set enable_parallel_append =on;    
```    
```    
postgres=# select set_limit(0.7);    
 set_limit     
-----------    
       0.7    
(1 row)    
explain select similarity(info, '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁') as sml, -- 计算输入词与存储字符串的相似度    
  * from tbl     
  where info % '懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁'    -- 相似度超过阈值    
  order by sml desc            -- 按相似度排序(倒排，越相似的排在越前面)    
  limit 10;     
```    
加了并行后，SQL耗时：40毫秒（因为本来就已经很快了，所以加并行度性能几乎没有提高，当计算量很大时，性能会提升明显）    
```    
 sml  | id |                                                               info                                                                   
------+----+----------------------------------------------------------------------------------------------------------------------------------    
 0.75 |  1 | 懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁内橰畁蜫征瘭缆竟    
(1 row)    
Time: 40.298 ms    
```    
## 相似查询性能压测    
1、构建压测函数，从现有记录中，使用主键随机提取一条字符串（并加工处理，生成一个新的具有一定相似度的字符串）。    
使用 ```substring(info,1,28)||gen_hanzi(4)||substring(info,29,28)``` 将得到相似度为0.75的一个新字符串。    
```    
从第1位开始，取28位，然后插入4个随机中文，再从29位开始取28位。这个字符串作为相似查询的输入。相似度为0.75。    
postgres=# select substring(info,1,28)||gen_hanzi(4)||substring(info,29,28) newval, info, similarity(substring(info,1,28)||gen_hanzi(4)||substring(info,29,28) , info) from tbl limit 10;    
-[ RECORD 1 ]--------------------------------------------------------------------------------------------------------------------------------    
newval     | 懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑焳邹祧鵅莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁    
info       | 懛瑌娺罊鹜凳芹绱茙蠡㥪礛唾霹跷憙胣缃犭昉斗蒽曲牵痈嚒巈茑莥钶们鼗楝𫝩眦条弘娸霵镯钻夊涨鮗傞屽嶋莁艳舸鮉蟙材骘媨迁内橰畁蜫征瘭缆竟    
similarity | 0.75    
-[ RECORD 2 ]--------------------------------------------------------------------------------------------------------------------------------    
newval     | 荓嚅𰾭鑬抾诐裹坲雚囻卥饸数拰絔劫霨礸诿廓琫颧仯瞱卷瘰弶瓴叠濷賨櫕鹝逼倭舌飂陭盒寚芘怦叙种椡檱玠肙羡兔蒿眤粆焙蟸侥樛裦窽美    
info       | 荓嚅𰾭鑬抾诐裹坲雚囻卥饸数拰絔劫霨礸诿廓琫颧仯瞱卷瘰弶瓴鹝逼倭舌飂陭盒寚芘怦叙种椡檱玠肙羡兔蒿眤粆焙蟸侥樛裦窽美影诳哜帪粊圊鈵疧    
similarity | 0.75    
-[ RECORD 3 ]--------------------------------------------------------------------------------------------------------------------------------    
newval     | 龌楣莁橹箉髎岒险旚舲瞒靻蕰岹滺扡习坍敮鯭钶鈫篖刀绎花截孞荧镻缮蜝讼咺茅雠沥叠湓𫛷戊糥钫秤彨沤熻云筝銵妮宊鲗焜埒躐采薨銐鐚    
info       | 龌楣莁橹箉髎岒险旚舲瞒靻蕰岹滺扡习坍敮鯭钶鈫篖刀绎花截孞讼咺茅雠沥叠湓𫛷戊糥钫秤彨沤熻云筝銵妮宊鲗焜埒躐采薨銐鐚梶唣𠇹响寏蓘铅缅    