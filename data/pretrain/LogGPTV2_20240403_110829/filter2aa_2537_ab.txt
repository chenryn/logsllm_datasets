• Register your AS and your prefix in RIR (no immediate 
effect, but eventually someone will use them)
• No anonymity – if you hijack, everyone knows it’s you 
(due to AS-PATH)
• If things still work, who complains?
How To Resolve A Hijacking
• Once rogue announcement is 
identified, work begins. Contact the 
upstreams and scream. 
–May take minutes, hours (if you are 
Youtube-sized), or possibly days
• About as easy as getting DDoS 
stopped (or not)
What This Means
• Rootkits + 0day  rogue announcements  
Man-in-middle attacks, with our clues applied
– No need for three-way-handshake when you’re in-line 
– Nearly invisible exploitation potential, globally
• Endpoint enumeration - direct discovery of who  
and what your network talks to
• Can be accomplished globally, any-to-any
• How would you know if this isn’t happening right 
now to your traffic at DEFCON?
BGP MITM Hijack Concept
•
We originate the route like we always did
–
Win through usual means (prefix length, shorter as-
path w/ several origin points, etc)
•
“Win” is some definition of “most of the internet chooses 
your route”
•
We return the packets somehow
–
Coordinating delivery was non-trivial
–
Vpn/tunnel involve untenable coordination at target
•
Then it clicked – use the Internet itself as reply 
path, but how?
BGP MITM Setup
1. Traceroute & plan reply path to target
2. Note the ASN’s seen towards target from 
traceroute & bgp table on your router
3. Apply as-path prepends naming each of 
the ASN’s intended for reply path
4. Nail up static routes towards the next-
hop of the first AS in reply path
5. Done
BGP MITM – First Observe
Random User ASN 100
Target ASN 200
AS20
AS10
AS30
AS60
AS40
AS50
ASN 200 originates 
10.10.220.0/22, sends 
announcements to AS20 
and AS30
Internet is converged 
towards valid route
View of Forwarding 
Information Base (FIB) for 
10.10.220.0/22 after 
converging
BGP MITM – Plan reply path
Attacker ASN 100
Target ASN 200
AS20
AS10
AS30
AS60
AS40
AS50
ASN 100’s FIB shows route for 
10.10.200.0/22 via AS10
We then build our as-path prepend list to 
include AS 10, 20, and 200
BGP MITM  – Setup Routes
Attacker ASN 100
Target ASN 200
AS20
AS10
AS30
AS60
AS40
AS50
10.10.220.0/24 is announced with a route-map:
route-map hijacked permit 10
 match ip address prefix-list jacked
 set as-path prepend 10 20 200
Then, install static route in AS100 for 
10.10.220.0/24 to AS10’s link
ip route 10.10.220.0 255.255.255.0 4.3.2.1
Anonymzing The Hijacker
• We adjust TTL of packets in transit
• Effectively ‘hides’ the IP devices handling 
the hijacked inbound traffic (ttl additive)
• Also hides the ‘outbound’ networks 
towards the target (ttl additive)
• Result: presence of the hijacker isn’t 
revealed
Without TTL adjustment
  2 12.87.94.9 [AS 7018] 4 msec 4 msec 8 msec
  3 tbr1.cgcil.ip.att.net (12.122.99.38) [AS 7018] 4 msec 8 msec 4 msec
  4 ggr2.cgcil.ip.att.net (12.123.6.29) [AS 7018] 8 msec 4 msec 8 msec
  5 192.205.35.42 [AS 7018] 4 msec 8 msec 4 msec
  6 cr2-loopback.chd.savvis.net (208.172.2.71) [AS 3561] 24 msec 16 msec 28 msec
  7 cr2-pos-0-0-5-0.NewYork.savvis.net (204.70.192.110) [AS 3561] 28 msec 28 msec 28 msec
  8 204.70.196.70 [AS 3561] 28 msec 32 msec 32 msec
  9 208.175.194.10 [AS 3561] 28 msec 32 msec 32 msec
 10 colo-69-31-40-107.pilosoft.com (69.31.40.107) [AS 26627] 32 msec 28 msec 28 msec
 11 tge2-3-103.ar1.nyc3.us.nlayer.net (69.31.95.97) [AS 4436] 32 msec 32 msec 32 msec
 12 * * *   (missing from trace, 198.32.160.134 – exchange point)
 13 tge1-2.fr4.ord.llnw.net (69.28.171.193) [AS 22822] 32 msec 32 msec 40 msec
 14 ve6.fr3.ord.llnw.net (69.28.172.41) [AS 22822] 36 msec 32 msec 40 msec
 15 tge1-3.fr4.sjc.llnw.net (69.28.171.66) [AS 22822] 84 msec 84 msec 84 msec
 16 ve5.fr3.sjc.llnw.net (69.28.171.209) [AS 22822] 96 msec 96 msec 80 msec
 17 tge1-1.fr4.lax.llnw.net (69.28.171.117) [AS 22822] 88 msec 92 msec 92 msec
 18 tge2-4.fr3.las.llnw.net (69.28.172.85) [AS 22822] 96 msec 96 msec 100 msec
 19 switch.ge3-1.fr3.las.llnw.net (208.111.176.2) [AS 22822] 84 msec 88 msec 88 msec
 20 gig5-1.esw03.las.switchcommgroup.com (66.209.64.186) [AS 23005] 84 msec 88 msec 88 msec
 21 66.209.64.85 [AS 23005] 88 msec 88 msec 88 msec
 22 gig0-2.esw07.las.switchcommgroup.com (66.209.64.178) [AS 23005] 88 msec 88 msec 88 msec
 23 acs-wireless.demarc.switchcommgroup.com (66.209.64.70) [AS 23005] 88 msec 84 msec 84 msec
With TTL Adjustments
  2 12.87.94.9 [AS 7018] 8 msec 8 msec 4 msec
  3 tbr1.cgcil.ip.att.net (12.122.99.38) [AS 7018] 4 msec 8 msec 8 msec
  4 ggr2.cgcil.ip.att.net (12.123.6.29) [AS 7018] 4 msec 8 msec 4 msec
  5 192.205.35.42 [AS 7018] 8 msec 4 msec 8 msec
  6 cr2-loopback.chd.savvis.net (208.172.2.71) [AS 3561] 16 msec 12 msec *
  7 cr2-pos-0-0-5-0.NewYork.savvis.net (204.70.192.110) [AS 3561] 28 msec 32 msec 32 msec
  8 204.70.196.70 [AS 3561] 28 msec 32 msec 32 msec
  9 208.175.194.10 [AS 3561] 32 msec 32 msec 32 msec
 10 gig5-1.esw03.las.switchcommgroup.com (66.209.64.186) [AS 23005] 88 msec 88 msec 84 msec
 11 66.209.64.85 [AS 23005] 88 msec 88 msec 88 msec
 12 gig0-2.esw07.las.switchcommgroup.com (66.209.64.178) [AS 23005] 84 msec 84 msec 88 msec
 13 acs-wireless.demarc.switchcommgroup.com (66.209.64.70) [AS 23005] 88 msec 88 msec 88 msec
Compare Original BGP & Route Path
Hijacked:
  2 12.87.94.9 [AS 7018] 8 msec 8 msec 4 msec
  3 tbr1.cgcil.ip.att.net (12.122.99.38) [AS 7018] 4 msec 8 msec 8 msec
  4 ggr2.cgcil.ip.att.net (12.123.6.29) [AS 7018] 4 msec 8 msec 4 msec
  5 192.205.35.42 [AS 7018] 8 msec 4 msec 8 msec
  6 cr2-loopback.chd.savvis.net (208.172.2.71) [AS 3561] 16 msec 12 msec *
  7 cr2-pos-0-0-5-0.NewYork.savvis.net (204.70.192.110) [AS 3561] 28 msec 32 msec 32 msec
  8 204.70.196.70 [AS 3561] 28 msec 32 msec 32 msec
  9 208.175.194.10 [AS 3561] 32 msec 32 msec 32 msec
 10 gig5-1.esw03.las.switchcommgroup.com (66.209.64.186) [AS 23005] 88 msec 88 msec 84 msec
 11 66.209.64.85 [AS 23005] 88 msec 88 msec 88 msec
 12 gig0-2.esw07.las.switchcommgroup.com (66.209.64.178) [AS 23005] 84 msec 84 msec 88 msec
 13 acs-wireless.demarc.switchcommgroup.com (66.209.64.70) [AS 23005] 88 msec 88 msec 88 msec
Original:
  2 12.87.94.9 [AS 7018] 8 msec 8 msec 4 msec
  3 tbr1.cgcil.ip.att.net (12.122.99.38) [AS 7018] 8 msec 8 msec 8 msec
  4 12.122.99.17 [AS 7018] 8 msec 4 msec 8 msec
  5 12.86.156.10 [AS 7018] 12 msec 8 msec 4 msec
  6 tge1-3.fr4.sjc.llnw.net (69.28.171.66) [AS 22822] 68 msec 56 msec 68 msec
  7 ve5.fr3.sjc.llnw.net (69.28.171.209) [AS 22822] 56 msec 68 msec 56 msec
  8 tge1-1.fr4.lax.llnw.net (69.28.171.117) [AS 22822] 64 msec 64 msec 72 msec
  9 tge2-4.fr3.las.llnw.net (69.28.172.85) [AS 22822] 68 msec 72 msec 72 msec
 10 switch.ge3-1.fr3.las.llnw.net (208.111.176.2) [AS 22822] 60 msec 60 msec 60 msec
 11 gig5-1.esw03.las.switchcommgroup.com (66.209.64.186) [AS 23005] 60 msec 60 msec 60 msec
 12 66.209.64.85 [AS 23005] 64 msec 60 msec 60 msec
 13 gig0-2.esw07.las.switchcommgroup.com (66.209.64.178) [AS 23005] 60 msec 64 msec 60 msec
 14 acs-wireless.demarc.switchcommgroup.com (66.209.64.70) [AS 23005] 60 msec 60 msec 60 msec
In conclusion
• We learned that any arbitrary prefix can be 
hijacked, without breaking end-to-end
• We saw it can happen nearly invisibly
• We noted the BGP as-path does reveal 
the attacker
• Shields up; filter your customers.
Thanks & Praise
• Felix "FX" Lindner
• Jay Beale
• Dan Kaminsky
• Defcon Speaker Goons & Staff
• Todd Underwood