I'm trying to build tensorflow 1.9 for android but build always fails due to
different reasons...
For android-ndk-r14b I've tried the following:
**bazel --output_user_root=/mnt/d/ai/.madman/bazel build -c opt
//tensorflow:libtensorflow_cc.so --crosstool_top=//external:android/crosstool
--host_crosstool_top=@bazel_tools//tools/cpp:toolchain --cpu=armeabi-v7a
--cxxopt="-std=c++11" --cxxopt="-DTENSORFLOW_DISABLE_META" --jobs 1**
_But got this:_
    INFO: Analysed target //tensorflow:libtensorflow_cc.so (0 packages loaded).
    INFO: Found 1 target...
    ERROR: /mnt/d/ai/.madman/tensorflow_r1.9/tensorflow/core/distributed_runtime/rpc/BUILD:160:1: C++ compilation of rule '//tensorflow/core/distributed_runtime/rpc:grpc_worker_service' failed (Exit 1)
    In file included from tensorflow/core/distributed_runtime/rpc/grpc_worker_service.cc:20:
    In file included from external/grpc/include/grpc++/alarm.h:26:
    In file included from external/grpc/include/grpcpp/alarm.h:25:
    In file included from external/grpc/include/grpcpp/impl/codegen/completion_queue.h:37:
    In file included from external/grpc/include/grpcpp/impl/codegen/core_codegen_interface.h:25:
    external/grpc/include/grpcpp/impl/codegen/config.h:37:12: error: no member named 'to_string' in namespace 'std'
    using std::to_string;
          ~~~~~^
_... also tried to switch to llvm's STL like this:_
**bazel --output_user_root=/mnt/d/ai/.madman/bazel build -c opt
//tensorflow:libtensorflow_cc.so --crosstool_top=@androidndk//:toolchain-
libcpp --android_crosstool_top=@androidndk//:toolchain-libcpp
--host_crosstool_top=@bazel_tools//tools/cpp:toolchain --cpu=armeabi-v7a
--cxxopt="-std=c++11" --cxxopt="-DTENSORFLOW_DISABLE_META" --jobs 1**
_... and got another issue:_
    WARNING: /mnt/d/ai/.madman/bazel/cd3928a854e918c00cc4e280f6815890/external/grpc/BUILD:1960:1: in srcs attribute of cc_library rule @grpc//:grpc_nanopb: please do not import '@grpc//third_party/nanopb:pb_encode.c' directly. You should either move the file to this package or depend on an appropriate rule there. Since this rule was created by the macro 'grpc_generate_one_off_targets', the error might have been caused by the macro implementation in /mnt/d/ai/.madman/bazel/cd3928a854e918c00cc4e280f6815890/external/grpc/bazel/grpc_build_system.bzl:172:12
    INFO: Analysed target //tensorflow:libtensorflow_cc.so (0 packages loaded).
    INFO: Found 1 target...
    ERROR: /mnt/d/ai/.madman/tensorflow_r1.9/tensorflow/core/kernels/BUILD:340:1: C++ compilation of rule '//tensorflow/core/kernels:stage_op' failed (Exit 1)
    In file included from tensorflow/core/kernels/stage_op.cc:22:
    In file included from ./tensorflow/core/framework/op_kernel.h:23:
    In file included from ./tensorflow/core/framework/allocator.h:23:
    In file included from ./tensorflow/core/framework/numeric_types.h:19:
    In file included from external/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/complex:246:
    In file included from external/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/cmath:305:
    In file included from external/androidndk/ndk/sources/android/support/include/math.h:31:
    external/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:661:91: error: use of undeclared identifier 'acosl'
    inline _LIBCPP_INLINE_VISIBILITY long double acos(long double __lcpp_x) _NOEXCEPT {return acosl(__lcpp_x);}
                                                                                              ^
    external/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:673:91: error: use of undeclared identifier 'asinl'
    inline _LIBCPP_INLINE_VISIBILITY long double asin(long double __lcpp_x) _NOEXCEPT {return asinl(__lcpp_x);}
                                                                                              ^
    external/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:685:91: error: use of undeclared identifier 'atanl'
    inline _LIBCPP_INLINE_VISIBILITY long double atan(long double __lcpp_x) _NOEXCEPT {return atanl(__lcpp_x);}
                                                                                              ^
    external/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:697:114: error: use of undeclared identifier 'atan2l'
    inline _LIBCPP_INLINE_VISIBILITY long double atan2(long double __lcpp_y, long double __lcpp_x) _NOEXCEPT {return atan2l(__lcpp_y, __lcpp_x);}
                                                                                                                     ^
    external/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:732:90: error: use of undeclared identifier 'cosl'
    inline _LIBCPP_INLINE_VISIBILITY long double cos(long double __lcpp_x) _NOEXCEPT {return cosl(__lcpp_x);}
                                                                                             ^
    external/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:744:91: error: use of undeclared identifier 'coshl'
    inline _LIBCPP_INLINE_VISIBILITY long double cosh(long double __lcpp_x) _NOEXCEPT {return coshl(__lcpp_x);}
                                                                                              ^
    external/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:756:90: error: use of undeclared identifier 'expl'
    inline _LIBCPP_INLINE_VISIBILITY long double exp(long double __lcpp_x) _NOEXCEPT {return expl(__lcpp_x);}
                                                                                             ^
    external/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:792:113: error: use of undeclared identifier 'fmodl'
    inline _LIBCPP_INLINE_VISIBILITY long double fmod(long double __lcpp_x, long double __lcpp_y) _NOEXCEPT {return fmodl(__lcpp_x, __lcpp_y);}
                                                                                                                    ^
    external/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:839:90: error: use of undeclared identifier 'logl'
    inline _LIBCPP_INLINE_VISIBILITY long double log(long double __lcpp_x) _NOEXCEPT {return logl(__lcpp_x);}
                                                                                             ^
    external/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:851:92: error: use of undeclared identifier 'log10l'
    inline _LIBCPP_INLINE_VISIBILITY long double log10(long double __lcpp_x) _NOEXCEPT {return log10l(__lcpp_x);}
                                                                                               ^
    external/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:863:114: error: use of undeclared identifier 'modfl'
    inline _LIBCPP_INLINE_VISIBILITY long double modf(long double __lcpp_x, long double* __lcpp_y) _NOEXCEPT {return modfl(__lcpp_x, __lcpp_y);}
                                                                                                                     ^
    external/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:870:112: error: use of undeclared identifier 'powl'
    inline _LIBCPP_INLINE_VISIBILITY long double pow(long double __lcpp_x, long double __lcpp_y) _NOEXCEPT {return powl(__lcpp_x, __lcpp_y);}
                                                                                                                   ^
    external/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:893:90: error: use of undeclared identifier 'sinl'
    inline _LIBCPP_INLINE_VISIBILITY long double sin(long double __lcpp_x) _NOEXCEPT {return sinl(__lcpp_x);}
                                                                                             ^
    external/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:905:91: error: use of undeclared identifier 'sinhl'
    inline _LIBCPP_INLINE_VISIBILITY long double sinh(long double __lcpp_x) _NOEXCEPT {return sinhl(__lcpp_x);}
                                                                                              ^
    external/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:917:91: error: use of undeclared identifier 'sqrtl'
    inline _LIBCPP_INLINE_VISIBILITY long double sqrt(long double __lcpp_x) _NOEXCEPT {return sqrtl(__lcpp_x);}
                                                                                              ^
    external/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:931:90: error: use of undeclared identifier 'tanl'
    inline _LIBCPP_INLINE_VISIBILITY long double tan(long double __lcpp_x) _NOEXCEPT {return tanl(__lcpp_x);}
                                                                                             ^
    external/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:943:91: error: use of undeclared identifier 'tanhl'
    inline _LIBCPP_INLINE_VISIBILITY long double tanh(long double __lcpp_x) _NOEXCEPT {return tanhl(__lcpp_x);}
                                                                                              ^
    external/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:955:92: error: use of undeclared identifier 'acoshl'
    inline _LIBCPP_INLINE_VISIBILITY long double acosh(long double __lcpp_x) _NOEXCEPT {return acoshl(__lcpp_x);}
                                                                                               ^
    external/androidndk/ndk/sources/cxx-stl/llvm-libc++/include/math.h:967:92: error: use of undeclared identifier 'asinhl'
    inline _LIBCPP_INLINE_VISIBILITY long double asinh(long double __lcpp_x) _NOEXCEPT {return asinhl(__lcpp_x);}
                                                                                               ^
    fatal error: too many errors emitted, stopping now [-ferror-limit=]
    20 errors generated.
    Target //tensorflow:libtensorflow_cc.so failed to build
    Use --verbose_failures to see the command lines of failed build steps.
    INFO: Elapsed time: 7.012s, Critical Path: 1.84s
    INFO: 0 processes.
    FAILED: Build did NOT complete successfully
So I've tried the same for android-ndk-r12b:
_first in this way:_
**bazel build -c opt //tensorflow/contrib/android:libtensorflow_inference.so
--crosstool_top=//external:android/crosstool
--host_crosstool_top=@bazel_tools//tools/cpp:toolchain --cpu=armeabi-v7a
--jobs 1**
_... but got another issue:_
    ERROR: /mnt/d/ai/.madman/tensorflow_r1.9-gcc/tensorflow/core/BUILD:2891:1: C++ compilation of rule '//tensorflow/core:gpu_runtime_impl' failed (Exit 1)
    tensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc: In member function 'virtual void* tensorflow::GPUNanResetAllocator::AllocateRaw(size_t, size_t)':
    tensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc:176:27: error: 'nanf' is not a member of 'std'
                               std::nanf(""));
                               ^
    tensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc:176:27: note: suggested alternative:
    In file included from external/androidndk/ndk/sources/cxx-stl/gnu-libstdc++/4.9/include/cmath:44:0,
                     from external/androidndk/ndk/sources/cxx-stl/gnu-libstdc++/4.9/include/complex:44,
                     from ./tensorflow/core/framework/numeric_types.h:19,
                     from ./tensorflow/core/framework/allocator.h:23,
                     from ./tensorflow/core/common_runtime/visitable_allocator.h:20,
                     from ./tensorflow/core/common_runtime/gpu/gpu_debug_allocator.h:24,
                     from tensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc:16:
    external/androidndk/ndk/platforms/android-14/arch-arm/usr/include/math.h:359:7: note:   'nanf'
     float nanf(const char *) __NDK_FPABI_MATH__ __pure2;
           ^
    tensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc: In member function 'virtual void tensorflow::GPUNanResetAllocator::DeallocateRaw(void*)':
    tensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc:191:29: error: 'nanf' is not a member of 'std'
                                 std::nanf(""));
                                 ^
    tensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc:191:29: note: suggested alternative:
    In file included from external/androidndk/ndk/sources/cxx-stl/gnu-libstdc++/4.9/include/cmath:44:0,
                     from external/androidndk/ndk/sources/cxx-stl/gnu-libstdc++/4.9/include/complex:44,
                     from ./tensorflow/core/framework/numeric_types.h:19,
                     from ./tensorflow/core/framework/allocator.h:23,
                     from ./tensorflow/core/common_runtime/visitable_allocator.h:20,
                     from ./tensorflow/core/common_runtime/gpu/gpu_debug_allocator.h:24,
                     from tensorflow/core/common_runtime/gpu/gpu_debug_allocator.cc:16:
    external/androidndk/ndk/platforms/android-14/arch-arm/usr/include/math.h:359:7: note:   'nanf'
     float nanf(const char *) __NDK_FPABI_MATH__ __pure2;
           ^
    Target //tensorflow:libtensorflow_cc.so failed to build
_... then again tried to switch to llvm:_
**bazel build tensorflow/core:android_tensorflow_lib
--crosstool_top=//external:android/crosstool --cpu=armeabi-v7a
--host_crosstool_top=@bazel_tools//tools/cpp:toolchain --config monolithic**
_and again no luck:_
    ERROR: /mnt/d/ai/.madman/tensorflow_r1.9-gcc/tensorflow/core/BUILD:2014:1: C++ compilation of rule '//tensorflow/core:lib_internal_impl' failed (Exit 1)
    In file included from external/androidndk/ndk/sources/cxx-stl/llvm-libc++/libcxx/include/memory:614:0,
                     from external/androidndk/ndk/sources/cxx-stl/llvm-libc++/libcxx/include/functional:477,
                     from ./tensorflow/core/lib/core/threadpool.h:19,
                     from tensorflow/core/lib/core/threadpool.cc:16:
    external/androidndk/ndk/sources/cxx-stl/llvm-libc++/libcxx/include/atomic: In member function 'void Eigen::EventCount::CommitWait(Eigen::EventCount::Waiter*)':
    external/androidndk/ndk/sources/cxx-stl/llvm-libc++/libcxx/include/atomic:720:75: error: invalid failure memory model for '__atomic_compare_exchange'
                                        __gcc_atomic::__to_gcc_order(__failure));
                                                                               ^
    Target //tensorflow:libtensorflow_cc.so failed to build
    Use --verbose_failures to see the command lines of failed build steps.
    INFO: Elapsed time: 617.731s, Critical Path: 11.03s
    INFO: 264 processes: 264 local.
    FAILED: Build did NOT complete successfully
What am I doing wrong?
P.S. '--jobs 1' seems to be necessary for my environment, otherwise I'm
getting different random build issues.