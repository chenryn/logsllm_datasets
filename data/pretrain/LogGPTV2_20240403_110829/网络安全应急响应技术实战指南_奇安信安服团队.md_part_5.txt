2）通过注册表查看
注册表是操作系统中一个重要的数据库，主要用于存储系统所必需的信息。
注册表以分层的组织形式存储数据元素。数据项是注册表的基本元素，每个数据
项下面不但可以存储很多子数据项，还可以以键值对的形式存储数据。注册表的
启动项是恶意程序的最爱，很多病毒木马通过注册表来实现在系统中的持久化驻
留。特别是我们在安装了新的软件程序后，一定不要被程序漂亮的外表迷惑，需
要看清楚它的本质，是否是木马的伪装外壳或是捆绑程序，必要时可以根据备份
来恢复注册表。
注册表目录的含义如下。
21
网络安全应急响应技术实战指南
（1）HKEY_CLASSES_ROOT（HKCR）：此处存储的信息可确保在Windows
资源管理器中执行时打开正确的程序。它还包含有关拖放规则、快捷方法和用户
界面信息的更多详细信息。
（2）HKEY_CURRENT_USER（HKCU）：包含当前登录系统的用户的配置信
息，有用户的文件夹、屏幕颜色和控制面板设置。
（3）HKEY_LOCAL_MACHINE（HKLM）：包含运行操作系统的计算机硬件
特定信息，有系统上安装的驱动器列表及已安装硬件和应用程序的通用配置。
（4）HKEY_USERS（HKU）：包含系统上所有用户配置文件的配置信息，有
应用程序配置和可视设置。
（5）HKEY_CURRENT_CONFIG（HCU）：存储有关系统当前配置的信息。
这里以“驱动人生”病毒作为查询案例，通过注册表（如图2.1.29 所示）和
命令（如图 2.1.30 所示）进行查询，会发现“驱动人生”建立了 WebServers 和
Ddriver两个键值，分别是病毒的信息窃取模块和病毒的主程序。
图2.1.29 注册表
图2.1.30 命令
22
第2章
网络安全应急响应工程师基础技能
2．Linux系统
启动项是恶意病毒实现持久化驻留的一种常用手段，使用以下方法可以查找
启动项相关内容。
使用【cat /etc/init.d/rc.local】命令，可查看init.d 文件夹下的rc.local文件内容。
使用【cat /etc/rc.local】命令，可查看rc.local文件内容。
使用【ls -alt /etc/init.d】命令，可查看init.d文件夹下所有文件的详细信息，
如图2.1.31所示，框内的文件是某挖矿木马的启动项。
图2.1.31 某挖矿木马启动项
2.1.4 任务计划
由于很多计算机都会自动加载“任务计划”，“任务计划”也是恶意病毒实现
持久化驻留的一种常用手段，因此在应急响应事件排查时需要重点排查。
1．Windows系统
任务计划是Windows系统的一个预置实现某些操作的功能，利用这个功能还
可实现自启动的目的，获取任务计划的方法有以下几种。
（1）打开【计算机管理】窗口，选择【系统工具】中【任务计划程序】中的
【任务计划程序库】选项，可以查看任务计划的名称、状态、触发器等详细信息，
如图2.1.32所示。
（2）在 PowerShell 下输入【Get-ScheduledTask】命令，可查看当前系统中所
有任务计划的信息，包括任务计划的路径、名称、状态等详细信息，如图 2.1.33
所示。
23
网络安全应急响应技术实战指南
图2.1.32 任务计划程序库
图2.1.33 输入【Get-ScheduledTask】命令
（3）在命令行中输入【schtasks】命令，可获取任务计划的信息，如图2.1.34
所示。该命令是一个功能更为强大的超级命令行计划工具，它含有【at】（在较旧
的系统中才可以用）命令行工具中的所有功能，获取任务计划时要求必须是本地
Administrators组的成员。
24
第2章
网络安全应急响应工程师基础技能
图2.1.34 输入【schtasks】命令
2．Linux系统
在 Linux 系统中，任务计划也是维持权限和远程下载恶意软件的一种手段。
一般有以下两种方法可以查看任务计划。
（1）在命令行中输入【crontab -l】命令，可查看当前的任务计划，也可以指
定用户进行查看，如输入命令【crontab -u root -l】，可查看root用户的任务计划，
以确认是否有后门木马程序启动相关信息。如图2.1.35所示，使用命令【crontab -l】
后，查询到一个挖矿恶意程序的任务计划设置，其会每隔12分钟远程下载恶意网
站上的crontab.sh脚本文件。
图2.1.35 一个挖矿恶意程序的任务计划设置
25
网络安全应急响应技术实战指南
（2）查看etc目录下的任务计划文件。
一般在Linux系统中的任务计划文件是以cron开头的，可以利用正则表达式
的*筛选出etc目录下的所有以cron开头的文件，具体表达式为/etc/cron*。例如，
查看etc目录下的所有任务计划文件就可以输入【ls /etc/cron*】命令，如图2.1.36
所示。
图2.1.36 输入【ls /etc/cron*】命令
通常，还有如下包含任务计划的文件夹，其中，*代表文件夹下所有文件：
/etc/crontab
/etc/cron.d/*
/etc/cron.daily/*
/etc/cron.hourly/*
/etc/cron.monthly/*
/etc/cron.weekly/
/etc/anacrontab
2.1.5 其他
Windows系统防火墙最基本的用途是对出、入的数据包进行检测。
防火墙规则包括入站规则和出站规则。入站规则：根据规则中的过滤条件，
过滤从公网到本地主机的流量。出站规则：根据规则中的过滤条件，过滤从本地
主机到公网的流量。两种规则都可以按需自定义流量过滤的条件。换句话说，入
站规则与进入主机的流量有关。如果在主机上运行一个Web服务器，那就必须告
诉防火墙允许外部用户访问主机。出站规则与流出主机的流量有关，会将应用程
26
第2章
网络安全应急响应工程师基础技能
序分类，允许部分应用程序访问外网，而其他应用则不能。如果想让浏览器（IE、
火狐、Safari、Chrome、Opera等）访问外网，但同时阻止访问某些网站，则可以
在出站规则中插入命令，表示允许或不允许哪些网站通过防火墙。有些恶意软件
会通过设置防火墙策略进行流量转发等操作，如驱动人生病毒对防火墙的设置。
打开【Windows防火墙】窗口，单击【高级设置】，然后选择【入站规则】或
【出站规则】可查看防火墙的入站规则或出站规则，如图2.1.37所示。
图2.1.37 查看防火墙的入站规则或出站规则
也可以在命令行中输入【netsh】命令进行查看。使用【netsh Firewall show state】
命令，可显示当前防火墙的网络配置状态，如图2.1.38所示。
图2.1.38 当前防火墙的网络配置状态
27
网络安全应急响应技术实战指南
2.2 进程排查
进程（Process）是计算机中的程序关于某数据集合上的一次运行活动，是系
统进行资源分配和调度的基本单位，是操作系统结构的基础。在早期面向进程设
计的计算机结构中，进程是程序的基本执行实体；在面向线程设计的计算机结构
中，进程是线程的容器。无论是在Windows系统还是Linux系统中，主机在感染
恶意程序后，恶意程序都会启动相应的进程，来完成相关的恶意操作，有的恶意
进程为了能够不被查杀，还会启动相应的守护进程对恶意进程进行守护。
1．Windows系统
对于Windows系统中的进程排查，主要是找到恶意进程的PID、程序路径，
有时还需要找到PPID（PID的父进程）及程序加载的DLL。对于进程的排查，一
般有如下几种方法。
1）通过【任务管理器】查看
比较直观的方法是通过【任务管理器】查看可疑程序。但是需要在打开【任
务管理器】窗口后，添加【命令行】和【映射路径名称】等进程页列，如图2.2.1
所示，以方便获取更多进程信息。
图2.2.1 添加进程页列
28
第2章
网络安全应急响应工程师基础技能
在排查进程时，可重点关注进程的映像路径名称及命令行是否可疑，从而进
一步进行排查。如图2.2.2所示，程序iexplore.exe为可疑进程。
图2.2.2 可疑进程排查
2）使用【tasklist】命令进行排查
在命令行中输入【tasklist】命令，可显示运行在计算机中的所有进程，可查
看进程的映像名称、PID、会话名等信息，如图2.2.3所示。
图2.2.3 使用【tasklist】命令进行排查
使用【tasklist】命令并添加特定参数，还可以查看每个进程提供的服务，如
添加svc参数，即输入【tasklist /svc】命令，可以显示每个进程和服务的对应情况，
如图2.2.4所示。
29
网络安全应急响应技术实战指南
图2.2.4 输入【tasklist /svc】命令
对于某些加载DLL的恶意进程，可以通过输入【tasklist /m】命令进行查询，
如图2.2.5所示。
图2.2.5 输入【tasklist /m】命令
30
第2章
网络安全应急响应工程师基础技能
要想查询特定DLL的调用情况，可以使用命令【tasklist /m 名称】。如图2.2.6
所示，输入【tasklist /m ntdll.dll】命令，可查询调用ntdll.dll模块的进程。
图2.2.6 输入【tasklist /m ntdll.dll】命令
同时，【tasklist】命令还有过滤器的功能，可以使用【fi】命令进行条件筛选，
结合关系运算符【eq】（等于）、【ne】（不等于）、【gt】（大于）、【lt】（小于）、【ge】
（大于等于）、【le】（小于等于）等命令进行有效过滤，如图2.2.7所示。
图2.2.7 过滤
31
网络安全应急响应技术实战指南
例如，查看PID为992的进程，可使用命令【tasklist /svc /fi "PID eq 992"】查
看，如图2.2.8所示。
图2.2.8 查看PID为992的进程
3）使用【netstat】命令进行排查
在命令行中输入【netstat】命令，可显示网络连接的信息，包括活动的 TCP
连接、路由器和网络接口信息，是一个监控TCP/IP网络的工具。相关参数如下。
-a：显示所有连接和侦听端口。
-b：显示在创建每个连接或侦听端口时涉及的可执行程序。
-e：显示以太网统计信息。可以与-s结合使用。
-f：显示外部地址的完全限定域名（FQDN）。
-n：以数字形式显示地址和端口号。
-o：显示拥有的与每个连接关联的进程 ID。
-p proto：显示proto指定的协议的连接。
-q：显示所有连接、侦听端口和绑定的非侦听TCP端口。绑定的非侦听端口
不一定与活动连接相关联。
-r：显示路由表。
-s：显示每个协议的统计信息。默认情况下，显示 IP、IPv6、ICMP、ICMPv6、
TCP、TCPv6、UDP 和 UDPv6 的统计信息。
-t：显示当前连接卸载状态。
-x：显示NetworkDirect连接、侦听器和共享终结点。