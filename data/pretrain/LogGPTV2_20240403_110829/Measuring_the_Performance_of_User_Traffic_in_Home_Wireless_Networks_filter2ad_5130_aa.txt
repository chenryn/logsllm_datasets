title:Measuring the Performance of User Traffic in Home Wireless Networks
author:Srikanth Sundaresan and
Nick Feamster and
Renata Teixeira
Measuring the Performance of User Traﬃc
in Home Wireless Networks
Srikanth Sundaresan1(B), Nick Feamster2, and Renata Teixeira3
1 ICSI, Berkeley, USA
PI:EMAIL
2 Princeton University, Princeton, USA
PI:EMAIL
3 Inria, Paris, France
PI:EMAIL
Abstract. This paper studies how home wireless performance charac-
teristics aﬀect the performance of user traﬃc in real homes. Previous
studies have focused either on wireless metrics exclusively, without con-
nection to the performance of user traﬃc; or on the performance of
the home network at higher layers. In contrast, we deploy a passive
measurement tool on commodity access points to correlate wireless per-
formance metrics with TCP performance of user traﬃc. We implement
our measurement tool, deploy it on commodity routers in 66 homes for
one month, and study the relationship between wireless metrics and TCP
performance of user traﬃc. We ﬁnd that, most of the time, TCP ﬂows
from devices in the home achieve only a small fraction of available access
link throughput; as the throughput of user traﬃc approaches the access
link throughput, the characteristics of the home wireless network more
directly aﬀect performance. We also ﬁnd that the 5 GHz band oﬀers users
better performance better than the 2.4 GHz band, and although the per-
formance of devices varies within the same home, many homes do not
have multiple devices sending high traﬃc volumes, implying that certain
types of wireless contention may be uncommon in practice.
1 Introduction
Many home networks use 802.11 wireless as a predominant mode of communi-
cation; in fact, many consumer devices in home networks connect exclusively
over a wireless connection. Despite increasingly widespread deployment of home
wireless networks, there is little information about their performance in real
homes, particularly as it relates to that of real user traﬃc and end-to-end perfor-
mance. Understanding how wireless performance aﬀects end-to-end user perfor-
mance will become increasingly important as the throughput of residential access
links continues to increase and the home wireless network becomes more likely a
bottleneck.
There is an extensive set of previous work studying wireless network per-
formance in many settings, including conferences, enterprise networks, and even
apartment complexes [1,3,6,9,10,12]. These studies have measured either layer-2
c(cid:2) Springer International Publishing Switzerland 2015
J. Mirkovic and Y. Liu (Eds.): PAM 2015, LNCS 8995, pp. 305–317, 2015.
DOI: 10.1007/978-3-319-15509-8 23
306
S. Sundaresan et al.
performance metrics (such as wireless bitrates and retransmissions) or layer-3
performance such as TCP throughput over the wireless link. Yet, wireless net-
work performance is extremely variable, even on short timescales, and mapping
layer-2 performance to higher-level performance metrics such as throughput or
latency is challenging. Additionally, active measurements can only capture the
wireless network performance at one point in time; these measurements may
not correspond to the performance that users see in practice for their actual
application traﬃc.
In this paper, we explore the relationship between wireless performance met-
rics and TCP performance of user traﬃc. To do so, we passively measure wireless
performance metrics on user traﬃc as it passes through the home wireless access
point and correlate these metrics with the TCP performance of user traﬃc. We
implement a measurement tool that runs on a commodity home wireless access
point, which permits a widespread deployment and the ability to diﬀerentiate
wireless versus wide-area performance. The routers that we use for our study
have both 2.4 and 5 GHz radios, which allows us to compare the performance of
these two bands. The deployment on commodity hardware poses strict design
constraints: (1) the devices are resource-constrained, which limits the amount of
collection and processing we can do; (2) each home has only a single measurement
vantage point; and (3) we aim to use unmodiﬁed drivers to avoid interfering with
the very environment that we are trying to measure. We measured the perfor-
mance of wireless networks in 66 home networks around the world; we passively
measure user traﬃc to extract both the performance of active TCP connections
and wireless statistics such as frame bitrate and retransmissions. Our study both
conﬁrms results from previous studies and reveals new phenomena. Speciﬁcally,
we ﬁnd:
(cid:129) As access link capacity increases, wireless performance plays a greater role in
(cid:129) Latency inside the home is a signiﬁcant contributor to end-to-end latency.
(cid:129) The 5 GHz channel performs better than the 2.4 GHz (in particular, latency
over the wireless is larger for 2.4 GHz); we also ﬁnd that bitrates are generally
low and retransmission rates high on 2.4 GHz.
(cid:129) Within the same home, diﬀerent devices experience diﬀerent wireless perfor-
(cid:129) It is rare for devices in a home to send signiﬁcant traﬃc volumes simultane-
the TCP throughput that users observe.
mance.
ously.
As content providers continue to place content closer to users and governments
and companies continue to invest in increasing access link throughput, under-
standing how users’ home wireless networks relate to the performance that their
traﬃc experiences will become critical for improving user experience. Our ﬁnd-
ings are a ﬁrst step towards understanding the relationship between wireless
performance metrics and TCP performance of user traﬃc. The results from
this paper may ultimately be useful for designing a system to detect and isolate
performance problems in home wireless networks.
Measuring the Performance of User Traﬃc in Home Wireless Networks
307
2 Method
We describe the passive measurement tool that we developed for home access
points, and the TCP and wireless performance metrics we used.
2.1 Measurements
We perform passive measurements of user traﬃc from commodity home wireless
access points and correlate those measurements with the wireless metrics for the
corresponding traﬃc. In contrast to active measurements, passive measurements
more accurately reﬂect the actual performance that users experience. Further,
passive measurements do not introduce contention or other artifacts that could
aﬀect the conditions that we seek to characterize. A measurement tool that
operates on commodity access points facilitates both a widespread deployment,
which can take advantage of an installed base of access points, and the ability
to diﬀerentiate wireless versus wide-area performance. Ultimately, such a tool
could operate in practice for a large user population. On the other hand, both the
resource limitations of commodity access points and the bandwidth constraints
in real home networks introduce design constraints that preclude using existing
network diagnostic tools.
We collect packet traces of connections from the WAN interface and both
wireless interfaces on the access point using pcap. Packet traces from the WAN
interface provide information about wide-area TCP connections and IP packets
that traverse the access point. We conﬁgure the wireless interfaces in monitor
mode to capture radiotap headers [11]. For each frame, the radiotap headers
provide the source and destination MAC addresses, the received signal strength
(RSSI), and the frame control bits (the bitrate used, and whether the frame was
retransmitted).
Deployment: We deploy our measurements on BISmark [2,17], which uses Net-
gear’s WNDR 3700/3800 access point. This device has an Atheros chipset with
a 450 MHz processor, one 802.11gn radio and one 802.11an radio. The 3800 has
128 MB of RAM, and the 3700 has 64 MB of RAM. The devices run OpenWrt
with the ath9k wireless driver that uses the Minstrel rate adaptation algorithm
with the default setting to a maximum bitrate of 130 Mbps. To respect user pri-
vacy, we do not collect payloads, and we anonymize all IP addresses and MAC
addresses using SHA-256 and a per-access point secret salt as the data is col-
lected on the router. Figure 1 summarizes our IRB-approved deployment and the
characteristics of the home networks in this deployment; we collected data from
66 homes in 15 countries for one month in 2013.
Limitations: Our collection methods limit the types of wireless performance
problems that we can study. First, continuous data collection from multiple inter-
faces on a commodity access point imposes signiﬁcant CPU and data require-
ments. Thus, the router collect data only every ﬁve minutes on average for
15 seconds per iteration. The router exports only ﬂow summaries, to reduce
upload bandwidth requirements. This level of sampling precludes analyzing
308
S. Sundaresan et al.
ﬁne-grained characteristics (e.g., transient faults, other conditions that fre-
quently vary) or characteristics that derive from complete TCP ﬂows. Second,
because we anonymize device MACs and IP addresses, ﬁner-grained analysis
of the impact of certain types of application ﬂows on certain devices (video in
mobile devices, for example) is not possible. It is also not possible to account for
device-speciﬁc issues, such as buﬀering in mobile devices. Third, we only have a
single vantage point from which to collect our measurements, because typically
homes only have a single access point. In contrast, other studies collect and cor-
relate data from multiple radios [10] or multiple vantage points [3,6,12]. Finally,
due to a driver limitation in the deployed devices, we could not scan for nearby
access points. Scanning caused persistent disconnections for a small number of
users; since this had a direct impact on users (BISmark devices are intended to
be used as the primary access point), we did not scan the medium.
2.2 Metrics
We use the passive traﬃc traces to extract both TCP-level performance metrics
and wireless performance metrics.
TCP Performance Metrics. The access point runs tcptrace, which processes
the pcap traces to provide TCP statistics. We study the average download TCP
throughput achieved during the captured lifetime of the ﬂow. We use this met-
ric to compute the aggregate throughput at every one-second interval by sum-
ming the average throughput of all active ﬂows downloading traﬃc through a
given access point during that interval. For reference, we compare the aggregate
throughput with the access link capacity, which we measure using BISmark’s
active measurements. BISmark performs a multi-threaded TCP throughput test
approximately every two hours [16,17]. We deﬁne the access link capacity as the
95th percentile of the multi-threaded throughput test measurements. We also
study the round-trip time (RTT) of TCP connections, which tcptrace com-
putes as the diﬀerence between the time of the data and SYN packets and its
corresponding acknowledgments (tcptrace’s analysis algorithm already handles
many corner cases, such as delayed acknowledgments). Running tcptrace at the
access point allows us to measure both the RTT between the access point and
the home devices (the LAN RTT ) and the RTT between the access point and
destinations in the wide-area (the WAN RTT ).
Wireless Performance Metrics. We use the bitrate, retransmission rate, and
received signal strength indication (RSSI) as our indicators of wireless perfor-
mance problems because we can obtain these metrics easily from packet head-
ers. IEEE 802.11 bitrate adaptation techniques adjust the transmission bitrate
as wireless channel conditions change. Although these techniques usually adapt
rates even under benign conditions to determine the channel quality, rate adapta-
tion is typically more frequent when the channel quality is poor, because wireless
senders typically reduce the bitrate in response to bit errors [8]. Thus, we also
use the normalized bitrate, which is the average wireless bitrate computed over
one second intervals, normalized by the maximum bitrate supported by that
Measuring the Performance of User Traﬃc in Home Wireless Networks
309
channel, as an indicator of a poor wireless channel. Normalized bitrate tends to
be low when the wireless channel quality is poor. When bitrate adaptation does
not adjust the bitrate (e.g., due to varying channel conditions or contention),
the normalized bitrate might not indicate channel quality, but in these cases
retransmission rates are still high. We also compute the retransmission rate
as the fraction of frames with the retransmit bit set in any given one-second
interval.
3 Results
We present the results from our measurement study. We ﬁrst measure the
throughput and RTTs of user traﬃc in home networks and how these per-
formance metrics relate to wireless performance metrics. We then explore the
wireless performance characteristics of user traﬃc in more detail.
Fig. 1. Data collected for this study.
Fig. 2. The fraction of time that the collec-
tion of active ﬂows receive a particular ratio
of ﬂow throughput to access link through-
put.
3.1 Correlating TCP and Wireless Performance
We explore the achieved throughput of user traﬃc and the contributions of the
home wireless network to this performance. Then, we study RTTs of user traﬃc
and how the poor wireless network performance can result in higher LAN RTTs.
This ﬁnding is relevant in light of the many recent eﬀorts by service providers
to reduce latency to end-to-end services with myriad optimizations and careful
placement of content.
User Traﬃc Rarely Achieves the Full Access-Link Throughput. Figure 2
shows the fraction of time that the sum of TCP throughput for all ﬂows in a
home (the “aggregate throughput” as deﬁned in Sect. 2.2) achieves a particular
value relative to the access link throughput, as measured with BISmark’s active
throughput test (the normalized aggregate throughput). The results show that
the user traﬃc rarely saturates the available access link throughput. Of course,
310
S. Sundaresan et al.
the TCP traﬃc might not saturate the access link throughput for many reasons:
for example, user traﬃc demand may be insuﬃcient (in fact, previous studies
have shown this phenomena is often the case [15]), or ﬂows may be short enough
that they fail to saturate the access link, which could happen if many short
Web transfers are the dominant traﬃc type. Unfortunately, we have only the
ﬂow statistics exported by tcptrace, so we cannot run a tool like T-RAT [18]
to identify with certainty when the application, as opposed to the network, was
limiting TCP throughput. Nevertheless, it is remarkable that the access link is
so underutilized so often. We suspect that one reason for lower utilization of the
access link (when there is suﬃcient demand to saturate it) may be the presence
of wireless bottlenecks in the home network. The rest of this section explores
this possibility.
Achieved Throughput Often Correlates with Wireless Performance
Metrics. To explore the relationship between the TCP throughput of user traf-
ﬁc in homes and access-link throughput, we measure how the aggregate through-
put correlates with the bitrate and the retransmission rate. We normalize the
aggregate throughput by the access link capacity (normalized throughput) and
correlate this value with each of the wireless performance metrics. When we
consider all traﬃc ﬂows, TCP throughput does not correlate with any of the
wireless performance metrics: the correlation coeﬃcient between retransmission
rate and normalized throughput is −0.01; for bitrate, the correlation coeﬃcient
is −0.02; and for RSSI, the correlation is 0.06.
However, when we explore the correlation for the subset of ﬂows whose nor-
malized throughput is greater than 0.1 (i.e., for which we determine there is
suﬃcient user demand), correlation between wireless metrics and access link
throughput is stronger. This correlation increases with the access link through-
put. In Fig. 3a we show how the correlation coeﬃcient between aggregate
throughput and retransmission rate varies as we only consider users with access
link throughput above a certain value; we see as this value increases, the cor-
relation becomes stronger. Figure 3b shows a similar trend when we correlate
Fig. 3. Correlation of wireless metrics to normalized throughput at diﬀerent access link
throughput levels.
Measuring the Performance of User Traﬃc in Home Wireless Networks
311
Fig. 4. Round-trip latency of ﬂows.
RSSI with normalized throughput (though, obviously, the opposite trend holds;
normalized throughput is positively correlated with RSSI). This result makes
sense: wireless is more likely to introduce a bottleneck as access link throughput