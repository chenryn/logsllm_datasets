# 360 | 数字货币钱包APP安全威胁概况
##### 译文声明
本文是翻译文章
译文仅供参考，具体内容表达以及含义原文为准。
#
**传送门** ：[360 | 数字货币钱包安全白皮书](https://www.anquanke.com/post/id/146233)
## 前言
随着区块链技术的普及，各种数字货币得到了很大发展，官方货币会发布自己的钱包APP，如Bitcoin
Core、Parity，第三方数字货币钱包为了进一步提升用户体验，同样开发出了如比特派，imToken，AToken等钱包APP，随着他们出现在市场上，黑客也瞄准了这块。
2017年，智能合约公司Parity开发的数字货币钱包所使用的多重签名技术被黑客发现存在漏洞，并导致15.3万枚以太币被盗，损失高达价值3260万美元。
2018年，技术处于全球领先的硬件数字货币钱包制造商Ledger在完成7500万美元的B轮融资后被爆出钱包设计存在缺陷，黑客可通过恶意软件篡改钱包地址，并将数字货币转给黑客。
2018年Bitcoin Wallet被爆出不正确的私钥存储，容易被黑客获取到私钥并还原出用户助记词。
为了更准确地了解钱包APP的安全现状，近期，我们对应用市场上流通的热钱包以及冷钱包进行了相关安全审核评估，发现了很多安全问题，在此整理成相关文档发布，帮助钱包APP厂商和用户了解周知其中存在的安全风险，引起大家对安全的重视并且及时自查，避免受到损失。
## 数字货币钱包安全威胁
一个数字货币钱包的使用，是包含了从软件启动到进行交易的一套完整的过程，其中会涉及到非常多的业务场景，从传统软件APP的功能如核心代码未加密，软件自身无校验，中间人数据劫持等，在钱包APP的业务场景下则会将危害放大，导致用户的钱财受到损失。同时针对钱包APP的独有业务场景，如助记词的不安全保存，交易密码设置弱口令，货币价格走势数据被替换等也将会给用户在使用钱包的安全上造成很大的危害，以下为我们整理发现的top5的安全风险。
### 1\. 助记词、交易密码泄露
比特派为比特币官方推荐的一支第三方团队比太开发的钱包应用，目前在Google Play上安装量达到10000+。
我们在非Root环境下，对其进行录屏测试，发现在助记词生成阶段无法录屏，但在导入钱包时，可以录下界面，此处可以导致助记词泄露从而造成数字货币账户被盗，同时，我们发现在输入交易密码时同样存在可录屏漏洞，通过观察按键按下顺序即可推出交易密码。
在钱包业务场景下，需要对相关敏感信息输入页面做防截屏措施，采用相关保护如对当前Activity页面加入属性WindowManager.LayoutParams.FLAG_SECURE，使得第三方程序在截屏时直接显示黑屏，无法记录。
### 2.不安全的钱包APP运行环境
数字货币钱包APP的一个安全重点就是运行环境，安卓是一个非常庞大而且复杂的系统，我们在实际进行分析测试的时候，发现将近四分之三的APP都未对相关环境做过检测，能够直接对APP进行逆向调试，HOOK注入，来分析APP的执行流程与动态分析加解密算法过程。我们发现，近八成的钱包APP未对运行环境安全做安全检测，无法保证用户运行APP的环境安全，导致用户钱财受到损失。
如上图360发布的中国手机安全状况报告中，我们可以看到目前安卓手机存在的漏洞非常多，导致APP运行在上面也会有很多安全风险，比如以下几点。
  1. 手机漏洞的扫描
如果一个手机存在已经披露过的系统漏洞，那么就时刻处于被黑客攻击的风险之下，如果存在可提权或者可以获取到助记词等敏感数据的漏洞，那么用户账户就会暴露在一个极其危险的环境下，所以我们建议加上对已知安卓系统漏洞的检测。
  2. Root环境检测
安卓实行沙箱机制，如果设备未Root，在沙箱的保护下，其他应用并不能获取本应用的数据，如果设备已Root，我们无法保证运行时的环境的安全性，助记词等极其重要的数据很有可能被恶意应用获取到。
  3. APP完整性检测
APP完整性指的是自身是否被篡改，通常可以通过签名校验来实现，防止用户使用被重打包后的应用。
  4. 网络代理检测
如果当前网络使用的是代理，那么就有可能在数据交互的过程中被第三方监听，造成数据的泄露甚至是敏感数据泄露。
对以上提到的几个关键点，我们分别在不同的环境下进行模拟攻击，发现近八成APP未对此做安全防护措施，我们可以利用安卓系统漏洞，软件自身漏洞等进行攻击测试。同时近一年来，挖矿木马，钱包APP劫持木马也开始大量出现，使很多用户直接受到财产损失，所以建议钱包厂商一定要对此问题重视，并且使用相关漏洞缓解措施。
### 3\. 交易密码被暴力猜解
大部分的数字货币钱包在第一次运行时会提示用户是否创建新钱包，当用户创建新钱包后，数字货币钱包会通过一系列算法生成一个私钥，正常情况下该私钥并不会展示给用户，而是会通过助记词的形式提示用户进行钱包的备份操作，如下是某款数字货币钱包的助记词界面，该算法有一套业界标准，通过助记词可以推导出私钥，再由私钥推导出其它数据。
在钱包初始化完后，会提示用户输入一个交易密钥，该交易密钥用于交易之前的私钥解密推导，当发生交易时，通过输入的交易密钥结合算法进行私钥的计算，生成的私钥用于交易的签名，如果数字货币钱包的交易密码设置不够强，非常容易被暴力破解，当交易密钥被暴力破解，整个钱包相当于处于没有任何防护的状态，任何人都可以对钱包进行操作，包括转账等。