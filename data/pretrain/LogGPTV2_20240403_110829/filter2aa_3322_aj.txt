头、打印机、路由器等。”Shodan爬取的是互联网上所有设备的IP地
址及其端口号，其官网提供了强大的搜索功能，可通过IP、域名、设
备进行条件搜索，获取大量有价值的网络信息。
2）Censys（https://censys.io）。Censys也是一款用以搜索联
网设备信息的新型搜索引擎，其功能与Shodan十分相似。与Shodan相
比，其优势在于它是一款由谷歌提供支持的免费搜索引擎。Censys搜
索引擎能够扫描整个互联网，蓝队常将它作为前期侦查攻击目标、搜
集目标信息的利器。
3）ZoomEye（https://www.zoomeye.org）。中文名字“钟馗之
眼”，是国内一款类似于Shodan的搜索引擎。ZoomEye官网提供了两部
分数据资源搜索：网站组件指纹，包括操作系统、Web服务、服务端语
言、Web开发框架、Web应用、前端库及第三方组件等；终端设备指
纹，主要对NMAP大规模扫描结果进行整合。
4）FOFA（https://fofa.so）。FOFA（网络空间资产检索系统）
也是一款网络设备搜索引擎，号称拥有更全的全球联网IT设备的DNA信
息，数据覆盖更完整。通过其官网可搜索全球互联网的资产信息，进
行资产及漏洞影响范围分析、应用分布统计、应用流行度态势感知
等。
5）APNIC（https://www.apnic.net）。APNIC提供全球性的支持
互联网操作的分派和注册服务。通过其官网可对公共APNIC Whois数据
库进行查询，获取目标网络IP地址、域名网络服务提供商、国家互联
网登记等相关信息。
6）CNNIC（http://www.cnnic.net.cn）。CNNIC负责国家网络基
础资源的相关信息维护管理，可提供Whois相关查询服务。
（2）专业开发资源网站
此类网站提供系统开发资源支持，大量开发人员常在此类网站上
使用Git或SVN进行版本控制。如果有目标系统应用源码被不小心公布
在此类网站，常常会导致非常严重的信息泄露。此类网站是蓝队攻击
利用的重要途径之一。
1）https://github.com。GitHub是世界上最大的代码托管平台，
目前有超过5000万开发者在使用。GitHub社区是一个致力于分享和传
播GitHub上优质开源项目的社区平台，用户可从中获取大量开发部署
资源。蓝队可以利用该平台搜索目标系统的一些开发信息。
2）https://gitee.com。Gitee是国内厂商推出的基于Git的代码
托管服务，和GitHub一样提供开源资源搜索支持，但资源相对较少。
3）https://www.lingfengyun.com/。凌风云是国内专业团队在大
数据、云计算的基础上精心研发的新一代互联网平台，具备专业的免
费资源垂直搜索引擎功能，可搜索百度网盘、新浪微盘、天翼云盘、
腾讯微盘等多个网盘中公开分享的资源，支持关键词检索和大量数据
库查询。
2. 目标官网
目标官网经常会发布一些有关网络建设的新闻消息，这些信息也
是蓝队在进行网情搜集时需要的重要信息。在官网上可主要围绕目标
组织管理架构、网络建设情况进行信息搜集，可通过关注目标网络建
设招标情况、网络项目介绍、设备供应商合作等搜集有价值的信息。
3. 社会工程学
社会工程学手段主要从目标系统内部人员入手，通过拉拢、收买
等手段间接获取目标系统相关的情况信息来开展网情搜集，常用的手
段主要有熟人打听、买通内部人员、与客服沟通来套取和打探等。
4. 扫描探测
扫描探测主要是借助扫描工具，对目标网络设备指纹、系统版
本、平台架构、开放服务端口进行扫描，以发掘可能存在的漏洞信
息。扫描探测主要完成以下几方面的信息搜集。
1）地址扫描探测。主要利用ARP、ICMP请求目标IP或网段，通过
回应消息获取目标网段中存活机器的IP地址和MAC地址，进而掌握拓扑
结构。
2）端口扫描探测。端口扫描是扫描行为中用得最多的，可以快速
获取目标机器开启端口和服务的情况。
3）设备指纹探测。根据扫描返回的数据包匹配TCP/IP协议栈指纹
来识别不同的操作系统和设备。
4）漏洞扫描。通过扫描等手段对指定的远程或本地计算机系统的
安全脆弱性进行检测，发现可利用的漏洞。漏洞扫描可细分为网络漏
扫、主机漏扫、数据库漏扫等不同种类。
2.3 外网纵向突破
2.3.1 何为外网纵向突破
如果将目标网络比作一座城池，那么蓝队就是攻城者，而外网纵
向突破就好比在城墙上打开突破口进入城内。蓝队在对一个目标网络
实施攻击时，首先就是寻找目标系统互联网侧薄弱点，然后利用这些
薄弱点突破外网，进入目标网络内网。这个由外网突破、进入内网的
过程一般称为“纵向突破”。外部纵向突破的重点是寻找突破口，主
要就是依据网情搜集阶段获取的相关信息进行针对性测试，直至利用
不同的纵向突破手段打开突破口。
2.3.2 外网纵向突破的主要工作
在外网纵向突破阶段，蓝队的主要工作就是围绕目标网络突破口
开展渗透测试，通过获取必要的安全认证信息或漏洞利用获取控制权
限。因为一般网络对外开放的接口非常有限，能从外部接触到的只有
Web网站、外部邮件系统、边界网络设备、外部应用平台，所以外网纵
向突破工作的重点也在这些接口上（见图2-28）。
图2-28 外网主要突破口
2.3.3 外网纵向突破的途径
蓝队在外部纵向突破中主要采用两种途径：一种是利用各种手段
获取目标网络的一些敏感信息，如登录口令、安全认证或网络安全配
置等；另一种就是通过漏洞利用，实现对目标网络外部接口如Web网
站、外部邮件系统、边界网络设备和外部应用平台的突破。目标网络
在互联网侧对外暴露面非常有限，蓝队纵向突破口也是以这些目标对
外暴露面为切入点展开攻击。蓝队能够利用的突破口主要有以下几
种。
1. Web网站
主要针对门户官网、网上办公、信息平台等Web入口进行突破，通
过Web入口存在的安全缺陷控制Web后台服务器，并进一步向内网渗
透。突破方式以漏洞利用为主，包括SQL注入、跨站脚本攻击、未加密
登录请求、弱口令、目录遍历、敏感文件泄露与文件上传漏洞等。另
外，存在较多漏洞的是一些Web平台组件，比如WebLogic、
WebSphere、Tomcat、Apache、Nginx、IIS和Web脚本平台等。最近被
利用得比较多的反序列化漏洞就主要是Web平台组件导致的。
2. 外部邮件系统
主要针对目标网络外部邮件系统进行突破，目标是控制外部邮件
系统后台服务器，并以此为跳板向目标网络内网渗透。突破方式有利
用邮件系统安全认证缺陷、利用邮件系统组件漏洞、口令暴力破解、
系统撞库、网络数据监听与社工等手段。
3. 边界网络设备
主要针对暴露在外网的防火墙、边界网关和路由进行突破，目标
是控制这些边界设备，并进一步利用它们的通联优势向内网渗透。主
要方式是利用这些互联网接口防火墙、边界网关和路由支持开放的
HTTP、HTTPS、Telnet、FTP、SSH与网络代理服务，通过远程溢出、远
程执行漏洞、安全规则配置不当、口令猜破与社工手段，对一些开放
的重要服务和端口进行渗透。比较典型的例子有VPN网关仿冒接入突
破。
4. 外部应用平台
主要针对外部应用平台，比如业务系统、OA、报表系统、微信公
众号平台、大数据平台等，利用其基础构件、网络代理组件、应用后
台数据库或平台应用程序本身的设计缺陷进行突破。云平台的渗透和
常规的渗透是没有任何区别的：从技术角度来讲，云平台只是多了一
些虚拟化技术应用，本质与传统网络一样，虚拟资产信息也大多可以
通过扫描探测被发现；云平台也会存在常规的安全漏洞，如SQL注入、
弱口令、未授权操作、命令执行、文件上传、敏感信息泄露等。
2.4 内网横向拓展
2.4.1 何为内网横向拓展
横向拓展，通常是指攻击者攻破某台内网终端或主机设备后，以
此为基础，对相同网络环境中的其他设备发起的攻击活动；但也常常
被用来泛指攻击者进入内网后的各种攻击活动。不同于外网纵向突破
阶段由外到内的渗透过程，蓝队的内网横向拓展主要是指在突破进入
目标网络内网以后，在内网主机、系统应用、服务器和网络设备等网
络资产之间的跳转、控制、渗透过程（见图2-29）。
图2-29 内网横向拓展主要流程
2.4.2 内网横向拓展的主要工作
蓝队在内网横向拓展阶段的主要工作就是围绕靶标等内网核心目
标，在内网快速横向渗透拓展，实现控制权限最大化，最终达到攻击
目标。进入目标内网后，蓝队才真正有机会接触到目标网络核心的东
西。实现在内网快速拓展、定位控制内网重要目标是一项细致、烦琐
的工作，主要工作包含以下几方面。
1. 内网信息搜集
蓝队在内网横向拓展的效率取决于其对目标内部网络的熟悉程
度，而对目标内部网络整体架构、VLAN划分、部门间网络隔离、关键
网络节点部署和重要部门或人员网络内精确定位等信息的掌握则是内
网快速横向拓展的关键。因此，蓝队在内网横向拓展阶段需要尽可能
多地搜集有关内网网络部署、关键网络节点、核心业务目标的信息，
实现对内网信息最大限度的了解，为内网进一步拓展提供情报支持。
内网信息搜集的重点主要有以下几方面：
·内网存活的IP以及存活IP开放的端口和服务；
·主机和服务器性质，判断设备所在区域是DMZ区、办公区还是
服务器区，作用是文件服务器、Web服务器、代理服务器、DNS服务
器、邮件服务器、病毒服务器、日志服务器、数据库服务器等之中的
哪一个；
·内网的网络拓扑、VLAN划分、各网络节点和网段间的连通
性；
·内网通用的杀毒软件、防火墙、终端操作系统、OA办公软件、
即时通信软件或其他应用系统。
目标网情搜集中有关目标组织架构、网络建设、设备部署以及网