### References
1. S. Stern, "Decoupling of Measuring the Response Time of a Transponder and Its Authentication," November 2008.
2. P. Janssens, "Proximity Check for Communication Devices," April 2015.
3. T. Chothia, J. de Ruiter, and B. Smyth, "Modelling and Analysis of a Hierarchy of Distance Bounding Attacks," in USENIX Security, 2018.
4. J. de Ruiter and E. Poll, "Formal Analysis of the EMV Protocol Suite," in Theory of Security and Applications - Joint Workshop, TOSCA, 2011.
5. A. Debant, S. Delaune, and C. Wiedling, "Proving Physical Proximity Using Symbolic Models," Univ Rennes, CNRS, IRISA, France, Research Report, February 2018.
6. D. Basin, S. Capkun, P. Schaller, and B. Schmidt, "Formal Reasoning About Physical Properties of Security Protocols," Transactions on Information and System Security (TISSEC), 2011.
7. V. Nigam, C. Talcott, and A. Aires Urquiza, "Towards the Automated Verification of Cyber-Physical Security Protocols: Bounding the Number of Timed Intruders," in European Symposium on Research in Computer Security (ESORICS), 2016.
8. P. D. Rowe, J. D. Guttman, and J. D. Ramsdell, "Assumption-Based Analysis of Distance-Bounding Protocols with CPSA," in Logic, Language, and Security, 2020.
9. A. Debant, S. Delaune, and C. Wiedling, "Symbolic Analysis of Terrorist Fraud Resistance," in European Symposium on Research in Computer Security, (ESORICS). Springer, 2019.
10. S. Mauw, Z. Smith, J. Toro-Pozo, and R. Trujillo-Rasua, "Post-Collusion Security and Distance Bounding," in Computer and Communications Security, CCS, 2019.
11. ISO, "14443-4: 2018 – Identification Cards – Contactless Integrated Circuit Cards – Proximity Cards – Part 4: Transmission Protocol," International Organization for Standardization, Standard, 2018.
12. ——, "7816-4: 2020 – Identification Cards – Integrated Circuit Cards – Part 4: Organization, Security and Commands for Interchange," International Organization for Standardization, Standard, 2020.
13. EMVCo, "EMV Contactless Specifications for Payment Systems; Book D; EMV Contactless Communication Protocol Specification," 2016.

### Appendix A: The ISO 14443 Protocol

There are several standards for proximity cards that define their electrical characteristics and how fields are modulated and data is transmitted between a reader and a proximity (RFID) card. Contactless payment cards use the ISO 14443 standard [23], [55] for the lower levels of the communication stack. This standard consists of four documents, with the first two defining the electrical characteristics and modulation schemes. We focus on ISO 14443-3, which defines how a card establishes a link with a reader, and ISO 14443-4, which specifies the transmission protocol used after the card is "linked" to the reader. Built on top of this is the ISO 7816-4 protocol, which defines how data is packaged into APDUs. The EMV specifications refer to the 14443 standards as Level 1, the ISO 7816-4 standard [56] as Level 2, and the EMV messages themselves as Level 3.

#### A. ISO 14443-3

The ISO 14443-3 standard [23] defines how the initial link between a reader and a card is established (see Fig. 11). The reader regularly polls for proximity cards by sending WUPA or REQA messages. When a card enters the magnetic field generated by the reader, it draws energy from the reader and responds with an ATQA message upon receiving a WUPA or REQA message.

The ATQA response provides the reader with information about the card, including the size of the UID. This information is used in the subsequent anti-collision phase. If multiple cards respond to the same WUPA/REQA message, the anti-collision phase selects a single card. During this process, the reader sends ANTICOLLISION and SELECT messages, ultimately selecting a single card. In the final stage, the reader sends a SELECT message with the UID, and the card responds with an acknowledgment (SAK). This acknowledgment confirms the card's compliance with ISO 14443-4 and its ability to send the RATS message (bit 3=0 and bit 6=1). Figure 11 illustrates the process when there is only a single response, and the anti-collision phase is shortened. For payment cards, if the reader detects a collision, the payment is rejected [57]. Once a card is selected, the reader moves to the next part of the protocol with the card in the ACTIVE state.

#### B. ISO 14443-4

When a card is selected and in the ACTIVE state, the ISO 14443-4 standard [55] specifies how the communication should proceed. It starts with the reader sending a RATS command, and the card responding with an Answer to Select (ATS) message. These messages set up parameters for the following communications, such as frame size limits and timing parameters for the card. Historical bytes, which are optional, can be used to transfer card-specific information from the card to the reader. This standard also details how large frames should be split, sent, and re-combined, and how the card can request more time to respond by sending frame waiting time extension requests. For our reader, all these operations are handled by the NFC chip, which sets the parameters for the transfers (except the historical bytes). Once the RATS–ATS exchange is completed, frames to and from the layer above are handled transparently. Splitting frames affects timing, so any timed exchange should use the smallest possible frame.

### Appendix B: The PayWave & VISA-L1 Protocols

The VISA-L1 protocol is an extension of the Visa PayWave protocol shown in Fig. 2. The extension involves randomizing the UID (the blue message in Fig. 11) and including this UID in the SDAD. The Visa specification document [17] states that the UID should be cryptographically bound with the Level 3 protocol session data. Including the UID specifically inside the SDAD, rather than other parts of the protocol, is based on our conversations with Visa Research.

Figure 12 shows the diagram of a relay attack against VISA-L1, which can be performed using a rooted Android phone.

### Appendix C: Timing Results

For the Mastercard-RRP test card, in addition to measuring the RRP messages, we also measured the response times for other messages. For comparison, we measured the response times for messages from a "normal" Mastercard and Visa card running their protocols. Apart from the test card, none of our Mastercards responded to the RRP messages.

The timings for the Level 1 messages are given in Table I. The average response times for the WUPA, ANTICOLL, and SELECT UID messages are very similar, with some variability. There is no correlation between the time taken and the distance of the card from the reader (see Table III). For the RATS messages, the two Mastercards have similar timings, while the Visa card has shorter response times, but also smaller message sizes. The differences in length do not fully explain the timing differences. The timings for the responses to the RATS message are correlated with the distance from the reader. It appears that for the first three messages, the response is automatic once the card is energized by the field. The RATS message requires some processing, and the time for this depends on the strength of the energizing electromagnetic field. To minimize time variations, any nonce exchange at this level should be organized so that any required processing is kept to a minimum—the card's nonce should be generated as soon as the card enters the field and before it responds to the WUPA command.

Selected timing results for Level 3 commands, including the GPO message and its reply, as well as the nonce exchanges of the Mastercard-RRP card, are summarized in Table II. For the GPO 1 message, plots of the message timings with respect to card distance and angle are shown in Fig. 13. As with the RATS command, there is a clear correlation between the response times and the distance of the card from the reader for all these commands (see Table III).

We also conducted correlation analysis on the timing measurements with respect to different distances. We tested the hypothesis of whether there is a linear relationship between the distance between a card and a reader and the reply times observed for each Level 1 and Level 3 command. The data reveals that for most Level 1 commands (WUPA, ANTICOLLISION, and SELECT UID), there is no significant relationship. However, for Level 3 commands, there is a strong significant correlation between the two variables. This confirms the intuitive observations from the average and standard deviation analysis, indicating that performing distance bounding at Level 1 would allow tighter control over the timing.

### Figures and Tables

**Figure 11: ISO 14443 Protocol Sketch (when there is a single card in the field)**

**Figure 12: Relay of Card UID Against Visa’s Relay Protection Protocol**

**Table I: Level 1 Reply Time Measurements for Mastercard and Visa Cards, in µs.**

| Command | Mastercard-RRP | Mastercard | Visa |
|---------|----------------|------------|------|
| wupa    | 340.46         | 340.09     | 339.34 |
| anticoll| 699.15         | 699.08     | 699.29 |
| select uid | 1123.91      | 1127.77    | 1127.29 |
| rats    | 2875.93        | 3231.61    | 1799.91 |

**Table II: Level 3 Reply Time Measurements for Mastercard and Visa Cards Across All Angles and Distances, in µs.**

| Command | Mastercard-RRP | Mastercard | Visa |
|---------|----------------|------------|------|
| Select 2Pay | 97371.78      | 63134.47   | 85438.76 |
| Select AID | 67223.86      | 85050.24   | 85050.24 |
| GPO 1   | 58862.01      | 37100.56   | 37755.15 |
| rrp 1   | 48429.66      | 37100.56   | 37755.15 |
| rrp 2   | 34920.51      | 37100.56   | 37755.15 |
| rrp 3   | 34919.93      | 37100.56   | 37755.15 |
| read record: 01, SFI: 2 | 86088.06 | 37100.56 | 37755.15 |
| read record: 01, SFI: 3 | 104328.99 | 37100.56 | 37755.15 |
| read record: 01, SFI: 4 | 41900.57 | 37100.56 | 37755.15 |
| read record: 02, SFI: 5 | 83108.45 | 37100.56 | 37755.15 |
| checksum | 23401.71 | 37100.56 | 37755.15 |