S. Stern, “Decoupling of measuring the response time of a transponder
and its authentication,” November 2008.
[46] P. Janssens, “Proximity check for communication devices,” April 2015.
[47] T. Chothia, J. de Ruiter, and B. Smyth, “Modelling and analysis of a
hierarchy of distance bounding attacks,” in USENIX Security, 2018.
[48] J. de Ruiter and E. Poll, “Formal analysis of the emv protocol suite,” in
Theory of Security and Applications - Joint Workshop, TOSCA, 2011.
[49] A. Debant, S. Delaune, and C. Wiedling, “Proving physical proximity
using symbolic models,” Univ Rennes, CNRS, IRISA, France, Research
Report, Feb. 2018.
[50] D. Basin, S. Capkun, P. Schaller, and B. Schmidt, “Formal reasoning
about physical properties of security protocols,” Transactions on Infor-
mation and System Security (TISSEC), 2011.
[51] V. Nigam, C. Talcott, and A. Aires Urquiza, “Towards the automated
veriﬁcation of cyber-physical security protocols: Bounding the number
of timed intruders,” in European Symposium on Research in Computer
Security (ESORICS), 2016.
[52] P. D. Rowe, J. D. Guttman, and J. D. Ramsdell, “Assumption-Based
Analysis of Distance-Bounding Protocols with CPSA,” in Logic, Lan-
guage, and Security, 2020.
[53] A. Debant, S. Delaune, and C. Wiedling, “Symbolic analysis of terrorist
fraud resistance,” in European Symposium on Research in Computer
Security, (ESORICS). Springer, 2019.
[54] S. Mauw, Z. Smith, J. Toro-Pozo, and R. Trujillo-Rasua, “Post-collusion
security and distance bounding,” in Computer and Communications
Security, CCS, 2019.
[55] ISO, “14443-4: 2018 – Identiﬁcation cards – Contactless integrated
circuit cards – Proximity cards – Part 4: Transmission protocol,”
International Organization for Standardization, Standard, 2018.
[56] ——, “7816-4: 2020 – Identiﬁcation cards – Integrated circuit cards Part
4: Organization, security and commands for interchange,” International
Organization for Standardization, Standard, 2020.
[57] EMVCo, “EMV Contactless Speciﬁcations for Payment Systems; Book
D; EMV Contactless Communication Protocol Speciﬁcation,” 2016.
Authorized licensed use limited to: Tsinghua University. Downloaded on August 07,2022 at 12:59:17 UTC from IEEE Xplore.  Restrictions apply. 
1752
Reader
Card
U ID ∈R {0, 1}24
WUPA/REQA
ATQA
The reader carries out the anti-collision routine.
ANTICOLLISION
UID
SELECT UID
SAK
Additional ANTICOLLISION, UID, SELECT UID
and SAK, based on UID size transmitted in ATQA
RATS
ATS
Fig. 11. ISO 14443 Protocol Sketch (when there is a single card in the ﬁeld)
APPENDIX A
THE ISO 14443 PROTOCOL
There are several standards for proximity cards deﬁning
their electrical characteristics and how the ﬁelds are modu-
lated and data transmitted between a reader and a proximity
(RFID) card. Contactless payment cards use the ISO 14443
standard [23], [55] for the lower levels of the communication
stack. There are four documents in this standard, the ﬁrst two
deﬁne the electrical characteristics and modulation schemes to
be used. We do not need to consider these in the work that we
are reporting. We focus on ISO 14443-3, which deﬁnes how
a card establishes a link with a reader and on ISO 14443-4,
which gives the transmission protocol to be used after the card
is “linked” to the reader. Built on top of this is a protocol,
ISO 7816-4, which deﬁnes how data is packaged up into
APDUs. The EMV speciﬁcations refer to the 14443 standards
as Level 1, the ISO 7816-4 standard [56] as Level 2, and the
EMV messages themselves as Level 3.
A. ISO 14443-3
The ISO 14443-3 standard [23] deﬁnes how the initial link
between a reader and a card is setup (see Fig. 11). The reader
is regularly polling for proximity cards by sending WUPA
or REQA messages. When a card enters the magnetic ﬁeld
generated by the reader, the card draws energy from the reader
and when it receives a WUPA or a REQA message it starts
the protocol by replying with an ATQA message.
The ATQA response gives the reader information about the
card that it can then use in the steps that follow. In particular,
it tells the reader the size of the UID that the card uses and
this is used in the next anti-collision phase. Several cards
could respond to the same WUPA/REQA message and the
anti-collision phase is used to select a single card for the next
stage. During this process a number of ANTICOLLISION and
SELECT messages from the reader are used, ﬁnally selecting
a single card. In the ﬁnal stage the reader sends a SELECT
message with the UID being selected and the card responds
with an acknowledgement (SAK). This acknowledgement tells
the reader that the card is compliant with ISO 14443-4 and
can send the RATS message (bit 3=0 and bit 6=1). Fig. 11
shows the process when there is only a single response and
the anti-collision phase is cut short. This applies in the tests
that we have been doing and it should also be noted that, for
payment cards, if the reader detects a collision the payment
is rejected [57]. Once a card is selected the reader moves on
to the next part of the protocol with the card in the ACTIVE
state.
B. ISO 14443-4
When a card is selected and in the ACTIVE state, the
ISO 14443-4 standard [55] speciﬁes how the communication
should proceed. It starts with the reader sending a RATS
command and the card replying with an Answer to Select
(ATS) response. These two message setup parameters for the
communications that follow, such as limits on the size of
frames that can be sent, or received, and for the card, timing
parameters and the “historical bytes”. Historical bytes are
optional and can be used to transfer card speciﬁc information
from the card to the reader. This standard also details how
large frames should be split, sent, and then re-combined, and
how the card can request more time to respond by sending
frame waiting time extension requests. For our reader all of
these operations are carried out by the NFC chip, it sets
the parameters for the transfers (except the historical bytes)
and once the RATS–ATS exchange is completed, frames to
and from the layer above are handled transparently. Splitting
frames will clearly affect the timing, so any timed exchange
should use as small a frame as possible.
APPENDIX B
THE PAYWAVE & VISA-L1 PROTOCOLS
The VISA-L1 protocol
is an extension of the Visa Pay-
Wave protocol shown in Fig. 2.
The extension of the Visa PayWave protocol to the VISA-
L1 protocol is one where the UID (the blue message in Fig. 11)
is randomised (as opposed to being static) and this UID is
included in the SDAD. The Visa speciﬁcation document [17]
only states that the UID should be cryptographically bound
with the Level 3 protocol session data. Doing this by including
the UID speciﬁcally inside the SDAD (as opposed to other
parts of the protocol, such as the AC) is based on our
conversations with Visa Research.
Fig. 12 shows the diagram of the relay attack against VISA-
L1, which can be done with a rooted Android phone.
APPENDIX C
TIMINGS RESULTS
For the Mastercard-RRP test card, in addition to measuring
the RRP messages, we also measured the response times for
Authorized licensed use limited to: Tsinghua University. Downloaded on August 07,2022 at 12:59:17 UTC from IEEE Xplore.  Restrictions apply. 
1753
Card
U ID2
ISO 14443-A activation protocol
card sends U ID2 (as per Fig. 11)
Reader
CardEmulator
TerminalEmulator
U ID1
U ID2
setUID(U ID2)
WUPA
ATQA
ANTICOLL
U ID2
SELECT UID
SAK
RATS
ATS
EMV protocol relayed
Fig. 12. Relay of card UID against Visa’s relay protection protocol
the other messages used. For comparison, we also measured
the response times for the messages from a “normal” Master-
card and Visa card running their protocols. Apart from the
test card, none of our Mastercards responded to the RRP
messages.
The timings for the Level 1 messages are given in Table I.
We see that
the average response times for the WUPA,
ANTICOLL and SELECT UID messages are all very similar.
Although there are some differences in the variability, note
that these ﬁgures are in µs. For all three of these messages
there is no correlation between the time taken and the distance
of the card from the reader (see Table III). For the RATS
messages the two Mastercards have similar timings, while for
the Visa card the response time is shorter, but so is the message
size. However, the difference in length does not totally explain
the differences. The timings for the responses to the RATS
message are correlated with the distance from the reader. It
is difﬁcult to be certain, but it seems that for the ﬁrst three
of these messages the response is automatic, once energised
by the ﬁeld the card can immediately respond. The RATS
message clearly needs some processing to be done before it
can respond and the time for this depends on the strength of
the energising electromagnetic ﬁeld. This is also seen in the
Level 3 results given below. To minimise time variations, any
nonce exchange at this level should be organised so that any
processing required is kept to a minimum – the card’s nonce
should be generated as soon as the card enters the ﬁeld and
before it responds to the WUPA command.
We now present selected timing results for Level 3 com-
mands, we consider the GPO message with its reply, as well as
the nonce exchanges of the Mastercard-RRP card. The results
obtained are summarised in Table II. For the GPO 1 message,
plots of the message timings with respect to card distance and
LEVEL 1 REPLY TIME MEASUREMENTS FOR MASTERCARD AND VISA
TABLE I
CARDS, IN µS.
command
Mastercard-RRP
wupa
anticoll
select uid
rats
Mastercard
wupa
anticoll
select uid
rats
Visa
wupa
anticoll
select uid
rats
avg
std
bytes
range
340.46
699.15
1123.91
2875.93
340.09
699.08
1127.77
3231.61
339.34
699.29
1127.29
1799.91
0.91
0.88
0.89
163.82
6.17
0.70
12.38
286.50
13.55
0.76
17.58
82.73
2
5
3
22
2
5
3
21
2
5
3
12
2.36
2.36
2.36
549.85
146.31
2.36
208.85
989.97
147.49
2.36
208.85
246.61
Fig. 13. Average reply times for the EMV GPO command and response
angle are shown in Fig. 13. Just as for the RATS command,
there is a clear correlation between the response times and the
distance of the card from the reader for all of these commands
(see Table III).
We also carried out correlation analysis on the timing
measurements, with respect
to the different distances we
recorded. We tested the hypothesis of whether there is a
linear relationship between the distance between a card and
a reader, and the reply times observed, for each Level 1 and
Level 3 command. The data reveals that for most Level 1
commands (WUPA, ANTICOLLISION and SELECT UID),
there is no signiﬁcant relationship. However, for Level 3
commands there is a strong signiﬁcant correlation between
the two variables. This conﬁrms the intuitive observations
formed from the average and standard deviation analysis, that
performing distance bounding at Level 1 would allow tighter
Authorized licensed use limited to: Tsinghua University. Downloaded on August 07,2022 at 12:59:17 UTC from IEEE Xplore.  Restrictions apply. 
1754
Angles (deg)04590135180Distance (mm)5.011.421.024.227.4Time (us)29334.3643781.4458228.5272675.6187122.69101569.77Mastercard GPO 1 averageAngles (deg)04590135180Distance (mm)5.011.421.024.227.430.6Time (us)29334.3643781.4458228.5272675.6187122.69101569.77Mastercard RRP GPO 1 averageAngles (deg)04590135180Distance (mm)5.011.421.024.227.4Time (us)29334.3643781.4458228.5272675.6187122.69101569.77Visa GPO 1 averageLEVEL 3 REPLY TIME MEASUREMENTS FOR MASTERCARD AND VISA
CARDS ACROSS ALL ANGLES AND DISTANCES, IN µS.
TABLE II
command
Mastercard-RRP
Select 2Pay
Select AID
GPO 1
rrp 1
rrp 2
rrp 3
read record: 01, SFI: 2
read record: 01, SFI: 3
read record: 01, SFI: 4
read record: 02, SFI: 5
checksum
Mastercard
Select 2Pay
Select AID
GPO 1
GPO 2
read record: 01, SFI: 2
read record: 01, SFI: 4
read record: 02, SFI: 4
Visa
Select 2Pay
Select AID
GPO 1
avg
std
bytes
range
97371.78
67223.86
58862.01
48429.66
34920.51
34919.93
86088.06
104328.99
41900.57
83108.45
23401.71
39790.21
45680.31
51490.57
390503.14
63134.47
85438.76
85050.24
37100.56
37755.15