       +0x018 DataLength       : 0x188
       +0x018 stDataLength     : 0x188
       +0x020 MdlChain         : 0xffffe20b`b0a9c220 _MDL
       +0x028 DataOffset       : 0x70
       +0x000 Link             : _SLIST_HEADER
       +0x000 NetBufferHeader  : _NET_BUFFER_HEADER
       +0x030 ChecksumBias     : 0
       +0x032 Reserved         : 0
       +0x038 NdisPoolHandle   : 0xffffe20b`ae45cb40 Void
       +0x040 NdisReserved     : [2] (null) 
       +0x050 ProtocolReserved : [6] 0x00000198`00000000 Void
       +0x080 MiniportReserved : [4] (null) 
       +0x0a0 DataPhysicalAddress : _LARGE_INTEGER 0x0
       +0x0a8 SharedMemoryInfo : (null) 
       +0x0a8 ScatterGatherList : (null) 
    kd> dt ndis!_MDL 0xffffe20b`aea77e70
       +0x000 Next             : 0xffffe20b`aea77b10 _MDL
       +0x008 Size             : 0n56
       +0x00a MdlFlags         : 0n4
       +0x00c AllocationProcessorNumber : 0xffff
       +0x00e Reserved         : 0xffff
       +0x010 Process          : (null) 
       +0x018 MappedSystemVa   : 0xffffe20b`aea77eb0 Void
       +0x020 StartVa          : 0xffffe20b`aea77000 Void
       +0x028 ByteCount        : 0x30
       +0x02c ByteOffset       : 0xeb0
    kd> db 0xffffe20b`aea77eb0+0x10
    ffffe20b`aea77ec0  19 04 00 00 00 00 03 84-30 30 30 30 30 30 30 30  ........00000000    //  dt ndis!_NET_BUFFER @r14
       +0x000 Next             : (null) 
       +0x008 CurrentMdl       : 0xffffe20b`aea77b10 _MDL
       +0x010 CurrentMdlOffset : 0
       +0x018 DataLength       : 0x168
       +0x018 stDataLength     : 0x168
       +0x020 MdlChain         : 0xffffe20b`b0a9c220 _MDL
       +0x028 DataOffset       : 0x90
       +0x000 Link             : _SLIST_HEADER
       +0x000 NetBufferHeader  : _NET_BUFFER_HEADER
       +0x030 ChecksumBias     : 0
       +0x032 Reserved         : 0
       +0x038 NdisPoolHandle   : 0xffffe20b`ae45cb40 Void
       +0x040 NdisReserved     : [2] (null) 
       +0x050 ProtocolReserved : [6] 0x00000198`00000000 Void
       +0x080 MiniportReserved : [4] (null) 
       +0x0a0 DataPhysicalAddress : _LARGE_INTEGER 0x0
       +0x0a8 SharedMemoryInfo : (null) 
       +0x0a8 ScatterGatherList : (null) 
    kd>   dt ndis!_MDL 0xffffe20b`aea77b10
       +0x000 Next             : 0xffffe20b`aea78890 _MDL
       +0x008 Size             : 0n56
       +0x00a MdlFlags         : 0n4
       +0x00c AllocationProcessorNumber : 0xe20b
       +0x00e Reserved         : 0xffff
       +0x010 Process          : (null) 
       +0x018 MappedSystemVa   : 0xffffe20b`aea77b50 Void
       +0x020 StartVa          : 0xffffe20b`aea77000 Void
       +0x028 ByteCount        : 0x30
       +0x02c ByteOffset       : 0xb50
    kd> db 0xffffe20b`aea77b50
    ffffe20b`aea77b50  19 05 00 00 00 00 03 84-41 41 41 41 41 41 41 41  ........AAAAAAAA    //  dt ndis!_NET_BUFFER @r14
       +0x000 Next             : (null) 
       +0x008 CurrentMdl       : 0xffffe20b`aea77e70 _MDL
       +0x010 CurrentMdlOffset : 0x10
       +0x018 DataLength       : 0x188
       +0x018 stDataLength     : 0x188
       +0x020 MdlChain         : 0xffffe20b`b0a9c220 _MDL
       +0x028 DataOffset       : 0x70
       +0x000 Link             : _SLIST_HEADER
       +0x000 NetBufferHeader  : _NET_BUFFER_HEADER
       +0x030 ChecksumBias     : 0
       +0x032 Reserved         : 0
       +0x038 NdisPoolHandle   : 0xffffe20b`ae45cb40 Void
       +0x040 NdisReserved     : [2] (null) 
       +0x050 ProtocolReserved : [6] 0x00000198`00000000 Void
       +0x080 MiniportReserved : [4] (null) 
       +0x0a0 DataPhysicalAddress : _LARGE_INTEGER 0x0
       +0x0a8 SharedMemoryInfo : (null) 
       +0x0a8 ScatterGatherList : (null) 
    kd> dt ndis!_MDL 0xffffe20b`aea77e70
       +0x000 Next             : 0xffffe20b`aea77b10 _MDL
       +0x008 Size             : 0n56
       +0x00a MdlFlags         : 0n4
       +0x00c AllocationProcessorNumber : 0xffff
       +0x00e Reserved         : 0xffff
       +0x010 Process          : (null) 
       +0x018 MappedSystemVa   : 0xffffe20b`aea77eb0 Void
       +0x020 StartVa          : 0xffffe20b`aea77000 Void
       +0x028 ByteCount        : 0x30
       +0x02c ByteOffset       : 0xeb0
    kd> db 0xffffe20b`aea77eb0+0x10
    ffffe20b`aea77ec0  19 04 00 00 00 00 03 84-30 30 30 30 30 30 30 30  ........00000000  //  dt ndis!_NET_BUFFER @r14
       +0x000 Next             : (null) 
       +0x008 CurrentMdl       : 0xffffe20b`aea77e70 _MDL
       +0x010 CurrentMdlOffset : 0x28
       +0x018 DataLength       : 0x170
       +0x018 stDataLength     : 0x170
       +0x020 MdlChain         : 0xffffe20b`b0a9c220 _MDL
       +0x028 DataOffset       : 0x88
       +0x000 Link             : _SLIST_HEADER
       +0x000 NetBufferHeader  : _NET_BUFFER_HEADER
       +0x030 ChecksumBias     : 0
       +0x032 Reserved         : 0
       +0x038 NdisPoolHandle   : 0xffffe20b`ae45cb40 Void
       +0x040 NdisReserved     : [2] (null) 
       +0x050 ProtocolReserved : [6] 0x00000198`00000000 Void
       +0x080 MiniportReserved : [4] (null) 
       +0x0a0 DataPhysicalAddress : _LARGE_INTEGER 0x0
       +0x0a8 SharedMemoryInfo : (null) 
       +0x0a8 ScatterGatherList : (null) 
    kd> dt ndis!_MDL 0xffffe20b`aea77e70
       +0x000 Next             : 0xffffe20b`aea77b10 _MDL
       +0x008 Size             : 0n56
       +0x00a MdlFlags         : 0n4
       +0x00c AllocationProcessorNumber : 0xffff
       +0x00e Reserved         : 0xffff
       +0x010 Process          : (null) 
       +0x018 MappedSystemVa   : 0xffffe20b`aea77eb0 Void
       +0x020 StartVa          : 0xffffe20b`aea77000 Void
       +0x028 ByteCount        : 0x30
       +0x02c ByteOffset       : 0xeb0
    kd> db 0xffffe20b`aea77eb0+0x28
    ffffe20b`aea77ed8  18 22 fd 81 00 00 03 84-00 bf 09 02 73 6d 41 72  ."..........smAr //  r rdx  // actual_length_bytes_1
    rdx=0000000000000110
    kd> dd r8 // Storage_1
    fffff806`6ce9a348  00000000 00000000 00000000 00000000
    fffff806`6ce9a358  00000000 00000000 00000000 00000000
    fffff806`6ce9a368  00000000 00000000 b3b18770 ffffe20b
    fffff806`6ce9a378  aea77eb0 ffffe20b b021bce0 ffffe20b
    fffff806`6ce9a388  00000000 00000000 aea77eb0 ffffe20b
    fffff806`6ce9a398  00000000 00000000 b0210040 00000000
调用NdisGetDataBuffer函数后：
    kd> dd fffff806`6ce9a348
    fffff806`6ce9a348  81fd2218 84030000 00000519 84030000
    fffff806`6ce9a358  41414141 41414141 41414141 41414141
    fffff806`6ce9a368  42424242 42424242 42424242 42424242
    fffff806`6ce9a378  00000519 84030000 41414141 41414141
    fffff806`6ce9a388  41414141 41414141 42424242 42424242
    kd> k
    Child-SP          RetAddr           Call Site
    fffff806`6ce9a090 42424242`42424242 tcpip!Ipv6pHandleRouterAdvertisement+0xae522
    fffff806`6ce9a440 84030000`00000519 0x42424242`42424242
    fffff806`6ce9a448 41414141`41414141 0x84030000`00000519
    fffff806`6ce9a450 41414141`41414141 0x41414141`41414141
    fffff806`6ce9a458 00000000`00000000 0x41414141`41414141
最后需要注意的是如果从NetBuffer_1请求的数据是连续的，则会将数据存放在NDIS提供的地址，这样无法造成溢出。所以需要从NetBuffer_1请求的数据不是连续的，才会将数据存放在Storage_1上。数据非连续的实现是通过
**fragmentation** （碎片化），将Router Advertisement包通过scapy的fragment6函数拆分成多个IPv6
fragments进行发送。
蓝屏崩溃现场：
## 0x04 补丁分析
补丁前第一个循环case:0x19的伪代码：
补丁后：
补丁加入了针对length的奇偶验证，v32为length *8的结果， 如果 length 为偶数，(v32-8)&0xf
将不等于0，则转入错误处理流程。
## 0x05 时间线
**2020-10-13** 微软发布漏洞通告
**2020-10-14** 360CERT发布通告
**2020-10-16** 360CERT监测到网上公开相关Poc
**2020-10-16** 360CERT更新通告
**2020-10-19** 360CERT发布漏洞分析报告
## 0x06 参考链接
  1. 
  2. 
  3. 
  4. 