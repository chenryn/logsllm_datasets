User: How to write a script using Python to monitor CPU and memory utilization of an AWS EC2 instance?
Assistant: To use Python to write scripts to monitor the CPU and memory utilization of AWS EC2 instances, you can use the AWS SDK for Python (Boto3) to obtain instance metric data. The following are the basic steps: 1. Install the AWS SDK for Python (Boto3): ``` pip install boto3 ``` 2. Configure AWS credentials: To use Boto3 to access AWS resources, you need to configure access credentials. Credentials can be configured using the AWS CLI or using IAM roles. For more details, please refer to the AWS documentation: https://docs.aws.amazon.com/sdk-for-python/v1/developer-guide/credentials.html 3. Get the EC2 instance ID: You need to get the EC2 instance ID to be monitored . The instance ID can be found in the AWS console, or obtained using Boto3. For example: ``` import boto3 ec2 = boto3.resource('ec2') instances = ec2.instances.filter(Filters=[{'Name': 'instance-state-name', 'Values': ['running'] }]) for instance in instances: print(instance.id) ``` 4. Obtain CPU and memory indicator data: You can use Boto3's CloudWatch client to obtain EC2 instance CPU and memory indicator data. The following is a code example to obtain the CPU utilization of an instance: ``` import boto3 from datetime import datetime, timedelta cloudwatch = boto3.client('cloudwatch') instance_id = 'your-instance-id' metric_name = 'CPUUtilization' namespace = 'AWS /EC2' period = 300 end_time = datetime.utcnow() start_time = end_time - timedelta(hours=1) response = cloudwatch.get_metric_statistics( Namespace=namespace, MetricName=metric_name, Dimensions=[{'Name': 'InstanceId', ' Value': instance_id}], StartTime=start_time, EndTime=end_time, Period=period, Statistics=['Average'] ) print(response['Datapoints'][-1]['Average']) ``` To get For instance memory metrics data, you can use MetricName as MemoryUsage. Other parameters are the same as when obtaining CPU indicator data. 5. Generate reports or send alerts: After obtaining the CPU and memory utilization data of an instance, scripts can be written to generate reports or send alerts, so that problems can be detected in time and corresponding measures can be taken. Reports and alerts can be sent via email, Slack, and more.