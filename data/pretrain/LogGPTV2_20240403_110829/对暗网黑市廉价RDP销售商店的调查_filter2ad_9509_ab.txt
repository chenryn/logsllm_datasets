除了出售RDP，这些商店中的一些还提供活跃的社会保险号码、信用卡数据和网上商店登录信息的交易。我们研究的第二大RDP商店，BlackPass，提供了最广泛的产品。这些经纪人中最多产者提供一站式访问所有用于欺诈的工具：rdp访问权限、社会安全号码和其他建立贷款或开立银行账户的综合数据。
由于法律和道德原因，我们没有购买任何提供的产品。因此，我们不知道服务的质量。
## RDP 勒索软件攻击方案
是否有可能使用RDP商店找到一个高价值受害者？高级威胁研究小组对这一理论进行了检验。通过利用RDP商店提供的大量权限，我们能够快速识别符合美国高价值目标形象的受害者。
我们在UASShop上发现了一台新发布的(4月16日)Windows Server 2008
R2标准机器。根据商店的描述，它属于美国的一个城市，只要花10美元，我们就可以获得这个系统的管理员权限。
[](https://p0.ssl.qhimg.com/t01086d4bfeff219ca5.png "RDP权限出售")
UASShop隐藏了它提供销售的系统的IP地址中的最后两个八位数，并对完整地址收取少量费用。(我们没有为UAS或任何其他商店提供的任何服务付费。)为了定位正在出售的系统，我们通过Shodan.io使用以下查询在特定组织中搜索任何打开的RDP端口：
    org:”City  XXX” port:”3389”
结果比我们预期的要令人震惊得多。Shodan搜索将65，536个可能的IP缩小到三个与我们的查询相匹配的IP。通过获得完整的IP地址，我们现在可以查找WHOIS信息，其中显示所有地址都属于一个主要的国际机场。这绝对不是你想在俄罗斯地下RDP商店里发现的东西，但事情变得更糟了。
[](https://p2.ssl.qhimg.com/t01cbeeb42d131846cf.png)
## 问题更严重了
其中两个IP地址显示了可访问登录屏幕的截图。
[](https://p5.ssl.qhimg.com/t010bada2b10657b23a.png "与RDP商店提供的配置相匹配的登录屏幕")
仔细看一下屏幕截图，就会发现Windows配置(前一个屏幕)与RDP商店提供的系统完全相同。此系统上有三个可用的用户帐户，其中之一是管理员帐户。其他账户的名字一开始似乎并不重要，但经过几次开源搜索后，我们发现这些账户与两家专门从事机场安全的公司有关联，一家是安全和楼宇自动化公司，另一家是摄像头监控和视频分析公司。我们没有探索这些帐户的全部访问级别，但是这可以提供一个很大的立足点和通过使用如MimiKatz等工具实现网络横向移动。
[](https://p4.ssl.qhimg.com/t01632c20fe5781bb5a.png "同一网络上第二个系统的登录屏幕")
看看其他登录帐户(前面的屏幕)，我们看到它是一个非常具体的缩写域名的一部分。我们在另一个登录帐户上进行了类似的搜索，发现这个域名很可能与机场的自动传输系统(连接终端的客运系统)相关。一个具有如此重大公共影响的系统可以从因特网上公开访问，这是很恐怖的事情。
现在我们知道，像Samsam集团这种攻击者，确实可以使用RDP商店来获得访问一个潜在的高价值的勒索软件的受害者。我们发现，进入一个与大型国际机场相关的系统只需10美元，没有0day攻击、精心设计的网络钓鱼活动，也没有水坑攻击。
## 匿名化
为了公布我们的调查结果，我们对数据进行了匿名处理，以防止敏感的安全信息被泄露。
## 基本的解释和安全建议
除了出售无数的访问权限外，RDP商店还提供了一些提示，说明当攻击者希望使用刚购买的RDP访问权限时，如何不被发现。
[](https://p5.ssl.qhimg.com/t0190f7e5ffbf11b669.png
"UASShop的FAQ部分中的这个屏幕解释了如何添加几个注册表项来隐藏用户帐户")
UASShop提供一个带有补丁程序的zip文件，允许多用户RDP访问，尽管在某些Windows版本中默认情况下是禁用的。zip文件包含两个更改Windows注册表的.reg文件和一个更改termsvrl.dll以允许并发远程桌面连接的修补程序文件。
对注册表和文件的这些更改会在系统上留下明显的痕迹。这些指标有助于调查滥用RDP访问的情况。
除了检查这些标志之外，最好检查Windows事件和安全日志，以查看异常登录类型和RDP使用情况。下图解释了在哪里可以找到日志：
[](https://p1.ssl.qhimg.com/t01c59e81b709e610be.png "资料来源：无国界医生组织2015年海报")
## RDP基本安全措施
外部访问网络可能是必要的，但它总是伴随着风险。我们总结了一些基本的RDP安全措施：
  * 使用复杂的密码和双因素身份验证将使暴力的rdp攻击更难成功。
  * 不允许在打开的Internet上进行RDP连接
  * 锁定用户，阻止或超时IP有太多失败的登录尝试
  * 定期检查事件日志是否有不寻常的登录尝试
  * 考虑使用不透露组织信息的帐户命名约定。
  * 枚举网络上的所有系统，并列出它们是如何连接的以及通过哪些协议。这也适用于物联网和POS系统。
## 结论
远程访问系统对于系统管理员执行其职责至关重要。然而，他们必须花时间以一种安全且不易被利用的方式建立远程访问。RPD商店正在储存易受攻击机器的地址，并将黑客选择受害者的工作减少到简单的在线购买。
政府和组织每年花费数十亿美元来保护我们信任的计算机系统。但是，即使是最先进的解决方案也不能保证绝对的安全，后门是开放的，或只携带一个简单的挂锁。就像我们离开家时检查门窗一样，组织必须定期检查哪些服务可以从外部访问，以及这些服务是如何安全的。保护系统需要一个综合的深度防御方法和每一个员工积极的态度。
审核人：yiwang 编辑：边边