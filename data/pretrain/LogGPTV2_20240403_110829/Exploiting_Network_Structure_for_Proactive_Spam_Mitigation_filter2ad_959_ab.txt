cates: (i) Most IP addresses, send either mostly spam
or mostly legitimate mail.
(ii) Fewer than 1 − 2% of
the active IP addresses have a spam-ratio of between
1% − 99%, i.e., there are very few IP addresses that
send a non-trivial fraction of both spam and legitimate
mail. (iii) Further, the vast majority (nearly 90%) of IP
addresses on any given day generate almost exclusively
spam, and have spam-ratios between 99% − 100%.
of legitimate mail and spam sent by the set Ik depends on
the spam-ratio k. Speciﬁcally, let Li(k) and Si(k) be the
fractions of the total daily legitimate mail and spam that
comes from all IPs in the set Ik, on day i. Fig. 2(a) plots
Li(k) averaged over all the days, along with conﬁdence
intervals. Fig. 2(b) shows the corresponding distribution
for the spam volume Si(k).
Result 2. Distribution of legitimate mail volume:
Fig. 2(a) shows that the bulk of the legitimate mail
(nearly 70% on average) comes from IP addresses with a
very low spam-ratio (k ≤ 5%). However, a modest frac-
tion (over 7% on average) also comes from IP addresses
with a high spam-ratio (k ≥ 80%).
1
t
n
e
s
l
i
a
m
e
t
a
m
i
t
i
g
e
l
f
o
n
o
i
t
c
a
r
F
0.8
0.6
0.4
0.2
0
0%
20%
Legitimate mail
40%
60%
IP spam−ratio
80%
100% 
(a) Legitimate mail
Spam
1
0.8
0.6
0.4
0.2
t
n
e
s
m
a
p
s
f
o
n
o
i
t
c
a
r
F
0
0%
20%
40%
IP spam−ratio
60% 
80%
100% 
(b) Spam
The above results indicate that identifying IP ad-
dresses with low or high spam-ratios could identify most
of the legitimate senders and spammers. In addition, for
some applications (e.g., the mail server overload prob-
lem), it would be valuable to identify the IP addresses
that send the bulk of the spam or the bulk of the legiti-
mate mail, in terms of mail volume. To do so, we next
explore how the daily legitimate mail or spam volumes
are distributed as a function of the IP spam-ratios, and
the resulting implications.
Let Ik denote the set of all IP addresses that have a
spam-ratio of at most k. Fig. 2 examines how the volume
Figure 2: Legitimate mail and spam contributions as a
function of IP spam-ratio.
Result 3. Distribution of spam volume: Fig. 2(b) in-
dicates that almost all (over 99% on average) of the
spam sent every day comes from IP addresses with an
extremely high spam-ratio (when k ≥ 95%). Indeed, the
contribution of the IP addresses with lower spam-ratios
(k ≤ 80%) is a tiny fraction of the total.
We observe that the distribution of legitimate mail vol-
ume as a function of the spam-ratio k is more diffused
152
16th USENIX Security Symposium
USENIX Association
than the distribution of spam volume. There are two pos-
sible explanations for such behaviour of the legitimate
senders. First, spam-ﬁltering software tends to be con-
servative, allowing some spam to marked as legitimate
mail. Second, a lot of legitimate mail tends to come
from large mail servers that cannot do perfect outgoing
spam-ﬁltering. These mail servers may, therefore, have
a slightly higher IP spam-ratio, and this would cause the
distribution of legitimate mail to be more diffused across
the spam-ratio.
Together, the above results suggest that the IP spam-
ratio may be a useful discriminating feature for spam
mitigation As an example, assume that we have a clas-
siﬁcation function that accepted (or prioritized) all IP
addresses with a spam-ratio of at most k and rejected
all IP addresses with a higher spam-ratio. Then, if we
set k = 95%, we could accept (or prioritize) nearly all
the legitimate mail, and no more than 1% of the spam.
However, such a classiﬁcation function requires perfect
knowledge of every IP address’s daily spam-ratio every
single day, and in reality, this knowledge may not be
available.
Instead, our approach is to identify properties that oc-
cur over longer periods of time, and are useful for pre-
dicting the current behaviour of an IP address based on
long-term history, and these properties are incorporated
into classiﬁcation functions. The effectiveness of such
history-based classiﬁcation functions for spam mitiga-
tion depends on the extent to which IP addresses long-
lived, how much of the legitimate email or spam are
contributed by the long-lived IP addresses, and to what
extent the spam-ratio of an IP address varies over time.
Sec. 2.2.2 and Sec. 2.2.3 explore these questions.
For the following analysis, we focus on the spam-ratio
of each individual IP address, computed over the entire
data set, since we are interested in its behaviour over its
lifetime. We refer to this as the lifetime spam-ratio of the
IP address. We show the presence of two properties in
this analysis: (i) a signiﬁcant fraction of legitimate mail
comes from good IP addresses that last for a long time
(persistence), and (ii) IP addresses that are good on aver-
age tend to have a low spam-ratio each time they appear
(temporal stability). These two properties directly inﬂu-
ence how effective it would be to use historical informa-
tion for determining the likelihood of spam coming from
an individual IP address.
2.2.2 Persistence
are extremely short-lived. These suggest the existence
of a potentially signiﬁcant difference in the behaviour of
senders of legitimate mail and spammers with respect to
persistence. We next quantify the extent to which these
hypotheses hold, by examining the persistence of indi-
vidual IP addresses.
Our methodology for understanding the persistence
behavior of IP addresses is as follows: we consider the
set of all IP addresses with a low lifetime spam-ratio and
examine how much legitimate mail they send, as well as
how much of the legitimate mail is sent by IP addresses
that are present for a long time. Such an understanding
can indicate the potential of using a whitelist-based ap-
proach for prioritizing legitimate mail. If, for instance,
the bulk of the legitimate mail comes from IP addresses
that last for a long time, we could use this property to
prioritize legitimate mail from long-lasting IP addresses
with low spam-ratios.
105
104
103
102
s
e
s
s
e
r
d
d
A
P
I
f
o
r
e
b
m
u
N
101
0
k = 1
k = 5
k = 10
k = 20
k = 30
20
40
60
100
Number of days
80
120
140
160
(a) Number of k-good IP addresses present for x or
more days
0.7
0.6
0.5
0.4
0.3
0.2
0.1
t
n
e
s
l
i
a
m
e
t
a
m
i
t
i
g
e
l
f
o
n
o
i
t
c
a
r
F
k = 1
k = 5
k = 10
k = 20
k = 30
0
0
20
40
60
100
Number of days
80
120
140
160
(b) Fraction of legitimate mail sent by k-good IP ad-
dresses present for x or more days
Figure 3: Persistence of k-good IP addresses.
Due to the community structure inherent in non-spam
communication patterns, it seems reasonable that most of
the legitimate mail will originate from IP addresses that
appear and re-appear. Previous studies have also indi-
cated that most of the spam comes from IP addresses that
For this analysis, we use the following two deﬁnitions.
Deﬁnition 1. A k-good IP address is an IP address
whose lifetime spam-ratio is at most k. A k-good set
is the set of all k-good IP addresses. Thus, a 20-good set
USENIX Association
16th USENIX Security Symposium
153
is the set of all IP addresses whose lifetime spam-ratio is
no more than 20%.
We compute (a) the number of k-good IP addresses
present for at least x distinct days, and (b) the fraction of
legitimate mail contributed by k-good IP addresses that
are present in at least x distinct days. 1 Fig. 3(a) shows
the number of IP addresses that appear in at least x dis-
tinct days, for several different values of k.
Fig. 3(b) shows the fraction of the total legitimate mail
that originates from IP addresses that are in the k-good
set and appear in at least x days, for each threshold k.
Most of the IP addresses in a k-good set are not present
very long, and the number of IP addresses falls quickly,
especially in the ﬁrst few days. However, their contribu-
tion to the legitimate mail drops much more slowly as x
increases. The result is that the few longer-lived IPs con-
tribute to most of the legitimate mail from a k-good set.
For example, only 5% of all IP addresses in the 20-good
set appear at least 10 distinct days, but they contribute to
almost 87% of all legitimate mail for the 20-good set. If
the k-good set contributes to a signiﬁcant fraction of the
legitimate mail, then the few longer-lived IP addresses
also contribute signiﬁcantly to the total legitimate mail.
For instance, IP addresses in the 20-good set contribute
to 63.5% of the total legitimate mail received. Only 2.1%
of those IP addresses are present for at least 30 days, but
they contribute to over 50% of the total legitimate mail
received.
Result 4. Distribution of legitimate mail from persis-
tent k-good IPs: Fig. 3 indicates that (i) IP addresses
with low lifetime spam ratios (small k) tend to contribute
a major proportion of the total legitimate email, and (ii)
only a small fraction of the IP addresses with a low life-
time spam-ratio addresses appear over many days, but
they contribute to a signiﬁcant fraction of the legitimate
mail.
The graphs also reveal another trend: the longer an IP
address lasts, the more stable is its contribution to the le-
gitimate mail. For example, 0.09% of the IP addresses
in the 20-good set are present for at least 60 days, but
they contribute to over 40% of the total legitimate mail
received. From this, we can infer that there were an addi-
tional 1.2% of IP addresses in the 20-good set that were
present for 30-59 days, but they only contributed to 10%
of the total legitimate mail received.
1Our analysis considers persistence of IP addresses only in our data
set, i.e., it considers whether the IP address has sent mail for x days
to our mail server. These IP addresses may have sent mail to other
mail servers on more days, and combining data across multiple differ-
ent mail servers may give a better picture of stablility of IP addresses
sending mail. Nevertheless, in this work, we focus on the persistence in
one data set, as it highlights behavioural differences due to community
structure present within a single vantage point.
Fig. 4 presents a similar analysis of persistence for IP
addresses with a high lifetime spam-ratio. Like the k-
good IP addresses and k-good sets, we deﬁne k-bad IP
addresses and k-bad sets.
Deﬁnition 2. A k-bad IP address is an IP address that
has a lifetime spam-ratio of at least k. A k-bad set is the
set of all k-bad IP addresses.
108
106
104
102
s
e
s
s
e
r
d
d
A
P
I
f
o
r
e
b
m
u
N
100
0
k = 70
k = 80
k = 90
k = 99
k = 100
20
40
60
100
Number of days