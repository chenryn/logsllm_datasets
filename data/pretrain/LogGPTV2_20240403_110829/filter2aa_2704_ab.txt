athdebug&&&&&&&&&&&&&&&diff&&&&&&&&&&&&&&&&&&&grep&&&&&&&&&&&&&&&&&&&iw_console&&&&&&&&&&&&&iwpriv&&&&&&&&&&&&&&&&&mox_vconfig&&&&&&&&&&&&resize&&&&&&&&&&&&&&&&&tcpdump&&&&&&&&&&&&&&&&wget.sh&
athstats&&&&&&&&&&&&&&&dirname&&&&&&&&&&&&&&&&groups&&&&&&&&&&&&&&&&&iw_console_user&&&&&&&&iwspy&&&&&&&&&&&&&&&&&&mpstat&&&&&&&&&&&&&&&&&rm&&&&&&&&&&&&&&&&&&&&&tcpsvd&&&&&&&&&&&&&&&&&which&
athstatsclr&&&&&&&&&&&&dmesg&&&&&&&&&&&&&&&&&&gunzip&&&&&&&&&&&&&&&&&iw_diagnose&&&&&&&&&&&&kill&&&&&&&&&&&&&&&&&&&mv&&&&&&&&&&&&&&&&&&&&&rmdir&&&&&&&&&&&&&&&&&&telnet&&&&&&&&&&&&&&&&&who&
awk&&&&&&&&&&&&&&&&&&&&dnsdomainname&&&&&&&&&&gzip&&&&&&&&&&&&&&&&&&&iw_doConfig&&&&&&&&&&&&killall&&&&&&&&&&&&&&&&nart.out&&&&&&&&&&&&&&&rmmod&&&&&&&&&&&&&&&&&&telnetd&&&&&&&&&&&&&&&&whoami&
basename&&&&&&&&&&&&&&&dnsmasq&&&&&&&&&&&&&&&&halt&&&&&&&&&&&&&&&&&&&iw_dst&&&&&&&&&&&&&&&&&killall5&&&&&&&&&&&&&&&netstat&&&&&&&&&&&&&&&&route&&&&&&&&&&&&&&&&&&test&&&&&&&&&&&&&&&&&&&whois&
beep&&&&&&&&&&&&&&&&&&&dropbear&&&&&&&&&&&&&&&hd&&&&&&&&&&&&&&&&&&&&&iw_event&&&&&&&&&&&&&&&klogd&&&&&&&&&&&&&&&&&&nice&&&&&&&&&&&&&&&&&&&rpcapd&&&&&&&&&&&&&&&&&test_get_eapol_key&&&&&wifi_setup&
blockdev&&&&&&&&&&&&&&&dropbearkey&&&&&&&&&&&&head&&&&&&&&&&&&&&&&&&&iw_event_user&&&&&&&&&&konf&&&&&&&&&&&&&&&&&&&nmeter&&&&&&&&&&&&&&&&&rtcwake&&&&&&&&&&&&&&&&test_get_node_list&&&&&wifi_test&
bootchartd&&&&&&&&&&&&&du&&&&&&&&&&&&&&&&&&&&&hexdump&&&&&&&&&&&&&&&&iw_firewall&&&&&&&&&&&&konfd&&&&&&&&&&&&&&&&&&nohup&&&&&&&&&&&&&&&&&&run-parts&&&&&&&&&&&&&&test_get_rssi_report&&&wirelessWatchdog&
brctl&&&&&&&&&&&&&&&&&&dumpleases&&&&&&&&&&&&&hostapd&&&&&&&&&&&&&&&&iw_fw&&&&&&&&&&&&&&&&&&lan_setup&&&&&&&&&&&&&&nslookup&&&&&&&&&&&&&&&runlevel&&&&&&&&&&&&&&&tftp&&&&&&&&&&&&&&&&&&&wlanconfig&
burnin_9344&&&&&&&&&&&&dumpregs&&&&&&&&&&&&&&&hostapd_cli&&&&&&&&&&&&iw_gps&&&&&&&&&&&&&&&&&lan_test&&&&&&&&&&&&&&&openssl&&&&&&&&&&&&&&&&runsv&&&&&&&&&&&&&&&&&&time&&&&&&&&&&&&&&&&&&&wpa_cli&
busybox&&&&&&&&&&&&&&&&ebtables&&&&&&&&&&&&&&&hostname&&&&&&&&&&&&&&&iw_handle_phy&&&&&&&&&&less&&&&&&&&&&&&&&&&&&&passwd&&&&&&&&&&&&&&&&&runsvdir&&&&&&&&&&&&&&&timeout&&&&&&&&&&&&&&&&wpa_passphrase&
cat&&&&&&&&&&&&&&&&&&&&ebtables-restore&&&&&&&hwclock&&&&&&&&&&&&&&&&iw_init&&&&&&&&&&&&&&&&lldpctl&&&&&&&&&&&&&&&&pgrep&&&&&&&&&&&&&&&&&&sed&&&&&&&&&&&&&&&&&&&&top&&&&&&&&&&&&&&&&&&&&wpa_supplicant&
chgrp&&&&&&&&&&&&&&&&&&echo&&&&&&&&&&&&&&&&&&&i2cdetect&&&&&&&&&&&&&&iw_ipConflict&&&&&&&&&&lldpd&&&&&&&&&&&&&&&&&&pidof&&&&&&&&&&&&&&&&&&seq&&&&&&&&&&&&&&&&&&&&touch&&&&&&&&&&&&&&&&&&xargs&
chmod&&&&&&&&&&&&&&&&&&eeprom&&&&&&&&&&&&&&&&&i2cdump&&&&&&&&&&&&&&&&iw_ip_update&&&&&&&&&&&ln&&&&&&&&&&&&&&&&&&&&&ping&&&&&&&&&&&&&&&&&&&serviceAgent&&&&&&&&&&&tr&&&&&&&&&&&&&&&&&&&&&yes&
chown&&&&&&&&&&&&&&&&&&egrep&&&&&&&&&&&&&&&&&&i2cget&&&&&&&&&&&&&&&&&iw_ntp&&&&&&&&&&&&&&&&&log&&&&&&&&&&&&&&&&&&&&pipe_progress&&&&&&&&&&setconsole&&&&&&&&&&&&&traceroute&&&&&&&&&&&&&zcat&
chpasswd&&&&&&&&&&&&&&&emiHandler&&&&&&&&&&&&&i2cset&&&&&&&&&&&&&&&&&iw_onekey&&&&&&&&&&&&&&logHandler&&&&&&&&&&&&&pkill&&&&&&&&&&&&&&&&&&setlogcons&&&&&&&&&&&&&true&&&&&&&&&&&&&&&&&&&zcip&
chpst&&&&&&&&&&&&&&&&&&env&&&&&&&&&&&&&&&&&&&&id&&&&&&&&&&&&&&&&&&&&&iw_ramImage&&&&&&&&&&&&logger&&&&&&&&&&&&&&&&&pktlogconf&&&&&&&&&&&&&setserial&&&&&&&&&&&&&&tty&&&&&&&&&&&&&&&&&&&&zip_main&
chroot&&&&&&&&&&&&&&&&&envdir&&&&&&&&&&&&&&&&&ifconfig&&&&&&&&&&&&&&&iw_resetd&&&&&&&&&&&&&&login&&&&&&&&&&&&&&&&&&pktlogdump&&&&&&&&&&&&&setsid&&&&&&&&&&&&&&&&&ttysize&
chrt&&&&&&&&&&&&&&&&&&&envuidgid&&&&&&&&&&&&&&ifdown&&&&&&&&&&&&&&&&&iw_setBios&&&&&&&&&&&&&logname&&&&&&&&&&&&&&&&pmap&&&&&&&&&&&&&&&&&&&setuidgid&&&&&&&&&&&&&&tunctl&
cksum&&&&&&&&&&&&&&&&&&ethreg&&&&&&&&&&&&&&&&&ifrename&&&&&&&&&&&&&&&iw_setValue&&&&&&&&&&&&logread&&&&&&&&&&&&&&&&poweroff&&&&&&&&&&&&&&&sh&&&&&&&&&&&&&&&&&&&&&udhcpc&
clear&&&&&&&&&&&&&&&&&&event_logd&&&&&&&&&&&&&ifup&&&&&&&&&&&&&&&&&&&iw_snmpd&&&&&&&&&&&&&&&losetup&&&&&&&&&&&&&&&&printenv&&&&&&&&&&&&&&&slattach&&&&&&&&&&&&&&&udhcpd&
clish&&&&&&&&&&&&&&&&&&expand&&&&&&&&&&&&&&&&&init&&&&&&&&&&&&&&&&&&&iw_sysMon&&&&&&&&&&&&&&ls&&&&&&&&&&&&&&&&&&&&&printf&&&&&&&&&&&&&&&&&sleep&&&&&&&&&&&&&&&&&&umount&
comm&&&&&&&&&&&&&&&&&&&expr&&&&&&&&&&&&&&&&&&&insmod&&&&&&&&&&&&&&&&&iw_test&&&&&&&&&&&&&&&&lsmod&&&&&&&&&&&&&&&&&&ps&&&&&&&&&&&&&&&&&&&&&snmpd&&&&&&&&&&&&&&&&&&uname&
cp&&&&&&&&&&&&&&&&&&&&&false&&&&&&&&&&&&&&&&&&io&&&&&&&&&&&&&&&&&&&&&iw_testBoard&&&&&&&&&&&lsusb&&&&&&&&&&&&&&&&&&pstree&&&&&&&&&&&&&&&&&softlimit&&&&&&&&&&&&&&unexpand&
crond&&&&&&&&&&&&&&&&&&fgrep&&&&&&&&&&&&&&&&&&iostat&&&&&&&&&&&&&&&&&iw_testDesc&&&&&&&&&&&&md5sum&&&&&&&&&&&&&&&&&pwd&&&&&&&&&&&&&&&&&&&&sort&&
MOXA WAP: NOW WHAT? 
•  Modify legit binaries 
–  change the serviceAgent binary to deliver custom payloads to 
the Moxa Windows configuration application 
•  this potentially allows an attacker to “swim upstream,” moving from 
the device up to the IT network 
•  get around read-only: kill legit process and run evil from /var&
–  “patch” the firmware install binary to skip integrity checks 
•  iptables, tunnels, catch all traffic, etc. 
•  Linux kernel modules 
–  insmod,&lsmod,&rmmod&
•  Change RF parameters 
–  frequency, channel, strength, etc. 
MOXA WAP: NOW WHAT? 
MOXA WAP: SOFT BRICK 
•  killall5&
–  “It sends a signal to all processes except kernel threads and 
the processes in its own session” 
–  device requires manual hard power cycle 
•  physical reset button doesn’t work 
•  umount / mount games 
•  etc. 
MOXA WAP: FIRM BRICK 
•  Not sure exactly how it happened J 
•  Was testing out a bunch of Moxa binaries 
–  suspect it was fw_setenv followed by a couple mount/umount&
and a reboot&
•  the device never came back from the reboot 
–  have full console logs but haven’t been able to verify 
•  so far, unable to un-brick the device 
•  only have 1 functional device remaining 
MOXA WAP: FIRM BRICK 
/&#&fw_setenv&&
Unlocking&flash...&
Done&
Erasing&old&environment...&
Done&
Writing&environment&to&/dev/mtd1...&
Done&
Locking&...&
Done&
/&#&mount&-o&remount,rw&–a&
/&#&reboot&
&
MOXA WAP: FIRM BRICK 
MOXA AWK-3131A: CVEs 
1. 
CVE-2016-8717
 10.0
 Hard-coded Administrator Credentials Vulnerability 
2. 
CVE-2016-8721
 9.1
 Web Application Ping Command Injection Vulnerability 
3. 
CVE-2016-8723
 7.5
 HTTP GET Denial of Service Vulnerability 
4. 
CVE-2016-8716
 7.5
 Web Application Cleartext Transmission of Password Vulnerability 
5. 
CVE-2016-8718
 7.5
 Web Application Cross-Site Request Forgery Vulnerability 
6. 
CVE-2016-8719
 7.5
 Web Application Multiple Reflected Cross-Site Scripting Vulnerabilities 
7. 
CVE-2016-8712
 5.9
 Web Application Nonce Reuse Vulnerability 
8. 
CVE-2016-8722
 5.3
 Web Application asqc.asp Information Disclosure Vulnerability 
9. 
CVE-2016-8720
 3.1
 Web Application bkpath HTTP Header Injection Vulnerability 
10. 
CVE-2016-0241
 7.5
 Web Application onekey Information Disclosure Vulnerability 
11. 
CVE-2016-8725
 5.3
 Web Application systemlog.log Information Disclosure Vulnerability 
12. 
CVE-2016-8724
 5.3
 serviceAgent Information Disclosure Vulnerability 
13. 
CVE-2016-8726
 7.5
 web_runScript Header Manipulation Denial of Service Vulnerability 
MOXA AWK-3131A: HELLO 
AB MICROLOGIX 1400 PLC 
ML1400: ABOUT 
•  Programmable Logic Controller (PLC) 
–  “micro” and “nano” control systems 
•  as opposed to “small” or “large” control systems 
–  “conveyor automation, security systems, and building and 
parking lot lighting” 
•  PLC includes built-in 
–  Input / Output 
–  Ethernet 
–  Serial 
–  Supports expansion I/O 
ML1400: ABOUT 
ML1400: FIRMWARE 
•  binwalk not much help 
•  strings not much help 
•  limited analysis tools 
ML1400: FIRMWARE - STRINGS 
ML1400: FIRMWARE - BINWALK 
ML1400: FIRMWARE - BINWALK 
binwalk&–A&&
ML1400: HARDWARE 
ML1400: FIRMWARE - BINWALK 
ML1400: SNMP 
ML1400: SNMP 
snmpwalk&-v&2c&-c&public&192.168.42.11&
ML1400: SNMP BACKDOOR 
snmpwalk&-c&public&-v&2c&192.168.42.11&.1.3.6.1.4.1.95&
ML1400: SNMP BACKDOOR 
CVE-2016-5645: AB Rockwell Automation MicroLogix 1400 Code Execution Vulnerability 
ML1400: SNMP BACKDOOR 
ML1400: MODIFY FIRMWARE 
ML1400: MODIFY FIRMWARE 
ML1400: MODIFY FIRMWARE 
&
~#&snmpset&-c&wheel&-v&2c&192.168.42.11&.
1.3.6.1.4.1.95.2.2.1.1.1.0&a&&
&
~#&snmpset&-c&wheel&-v&2c&192.168.42.11&.
1.3.6.1.4.1.95.2.2.1.1.2.0&s&"”&
&
~#&snmpset&-c&wheel&-v&2c&192.168.42.11&.
1.3.6.1.4.1.95.2.3.1.1.1.1.0&i&2&
ML1400: MODIFY FIRMWARE 
ML1400: MODIFY FIRMWARE 
ML1400: BYPASS INTEGRITY CHECK 
•  Only using self-reported checksum* 
–  Basic math 
–  At least two very easy bypasses 
1.  Find all occurrences of checksums in the firmware and update to 
match the checksums of modified firmware 
2.  Make “compensating” changes when modifying firmware 
–  “zero sum” byte changes 
»  0x12&0x34&à&0x34&0x12&
»  0x42&0x42&à&0x41&0x43&
»  0x00&0x00&0x00&0xFF&à&0x41&0x42&0x43&0x39&
•  * Rockwell’s latest hardware revision (Series C) may use cryptographically-signed firmware   
• 
Not supported on older models 
• 
Challenge accepted J 
ML1400: BYPASS INTEGRITY CHECK 
ML1400: BYPASS INTEGRITY CHECK 
ML1400: BYPASS INTEGRITY CHECK 
ML1400: MODIFY FIRMWARE 
ML1400: MODIFY FIRMWARE 
ML1400: MODIFY FIRMWARE 
ML1400: SOFT BRICK 
4EF9&0004&0150&
&JMP&0x00040150&&
&
JMP&to&start&of&code&
&0x150&bytes&in&
&offset&0x40000&
ML1400: SOFT BRICK 
4EF9&0004&0000&
&JMP&0x00040000&&
&
JMP&to&self&
ML1400: SOFT BRICK 
ML1400: SOFT BRICK 
Reboot 
(Try TFTP 
Firmware) 
(Try Flash 
Firmware) 
ML1400: SOFT BRICK 
ML1400: FIRM BRICK 
•  Unsuccessful with a few dozen “elegant” attacks 
–  creative changes of Coldfire instructions 
–  jump loops 
•  Success on first attempt of “hey, look over there” attack 
–  randomly move bytes* around 
*bytes that are important but are not Coldfire instructions 
ML1400: FIRM BRICK 
ML1400: FIRM BRICK 
ML1400: FIRM BRICK 
ML1400: FIRM BRICK 
ML1400: FIRM BRICK 
ML1400: SHODAN 
ML1400: HARD BRICK 
ML1400: HARD BRICK 
CONCLUSION 
TL;DR: BOX TO BACKDOOR TO BRICK 
THANK YOU 
•  Cisco Talos 
–  support 
–  beer 
•  Moxa Americas 
–  BusyBox GPL’d source code 
–  coordinated disclosure 
•  Rockwell Automation / Allen-Bradley 
–  coordinated disclosure 
@talossecurity-
blog.talosintelligence.com-
Patrick DeSantis | @pat_r10t