根据这一标准，标准的渗透测试可以分为下述7个阶段：
·事前互动：
·情报收集：
·威胁建模：
·漏洞分析；
·漏洞利用；
·深度利用：
·书面报告。
PTES 的官方网站详细介绍了每个阶段的思维导图（mindmaps）和组成步骤。这些内
容有助于审计人员根据被测环境的测试要求，对PTES标准进行相应调整。只要在其官方网
站上点击思维导图的构成节点，就可详细查看该节点的各个组成步骤。
主要特性与优势
PTES 的主要特性与优势如下。
·它是非常全面的渗透测试框架，涵盖了渗透测试的技术方面和其他重要的方面，如
范围蔓延（scope creep）、报告，以及渗透测试人员保护自身的方法。
·它介绍了多数测试任务的具体方法，可指导您准确测试目标系统的安全状态。
的解，一日
·它包含了最常用的以及很罕见的相关技术。
·它浅显易懂，您可根据测试工作的需要对相应测试步骤进行调整。
---
## Page 70
52KaliLinux渗透测试的艺术
2.5通用渗透测试框架
KaliLinux属于通用型操作系统，它配备有多种安全评估工具和渗透测试工具。在没有
合适的测试理论指导的情况下冒然使用这些工具，可能会导致测试失败，测试结果可能无
法让人满意。因此，从技术管理的角度来看，遵循正规的测试框架对安全测试极为重要。
这一小节将通过黑盒测试的具体方法和白盒测试的通用测试方法介绍通用测试框架。
它涵盖了典型的审计测试工作和渗透测试工作会涉及到的各个阶段。评估人员可以根据被
测目标的具体情况对上述测试方法进行相应调整。这一方法论由一系列相关步骤所组成。
要想成功完成安全评估项目，必须在测试的初始化阶段、测试进行阶段以及测试结束阶段
全面遵循这些步骤。这些步骤包括：
·范围界定：
·信息收集：
·目标识别：
·服务枚举；
·漏洞映射：
·社会工程学：
·漏洞利用：
·提升权限；
·访问维护：
·文档报告。
无论是进行白盒测试还是黑盒测试，选择和使用测试步骤都是测试人员的责任。在测
试开始前，测试人员需要根据目标系统的实际环境和已掌握的关于目标系统的情况，制定
最佳的测试策略。下文将会介绍每一个测试阶段，包括它们的简要描述、定义和可能适用
的应用程序。虽然这种通用测试方法论可以配合其他的方法论同时使用，但是它只是一种
指导建议，而不是全能的渗透测试解决方案。
2.5.1范围界定
在开始技术性安全评估之前，务必要观察、研究目标环境的被测范围。同时还要了解，
---
## Page 71
第2章渗透测试方法论53
这个范围牵扯到多少个单位，是单个单位还是多个单位会参与到安全评估的工作中来。在
范围界定阶段，需要考虑的典型因素如下。
·测试对象是什么？
·应当采取何种测试方法？
·有哪些在测试过程中需要满足的条件？
·哪些因素可能会限制测试执行的过程？
·需要多久才能完成测试？
·此次测试应当达成什么任务目标？
审计人员只有确切理解被评估系统所使用的技术，理解其基本功能，以及相关技术与
网络之间的相互影响，才能成功达成渗透测试的目标。因此，无论是进行什么类型的安全
评估项目，审计人员的知识结构都将起着至关重要的作用。
2.5.2信息收集
在划定了测试范围之后，就需要进入信息收集阶段。在这个阶段，渗透测试人员需要
使用各种公开资源尽可能地获取测试目标的相关信息。他们从互联网上搜集信息的互联网
渠道主要有：
·论坛；
·公告板；
·新闻组：
·媒体文章：
·博客：
·社交网络：
·其他商业或非商业性的网站。
此外，他们也可借助各种搜索引擎中获取相关数据，例如谷歌、雅虎、MSN必应、百
度等。进一步说，审计人员可以使用KaliLinmux收录的各种工具在测试目标的网络系统里挖
掘信息。这些运用漏洞数据挖掘技术的工具能够收集可观信息，包括DNS服务器、路由关
系、whois数据库、电子邮件地址、电话号码、个人信息以及用户账户。收集到的信息越多，
渗透测试成功的概率就越高。
---
## Page 72
54Kali Linux渗透测试的艺术
2.5.3目标识别
这个阶段的主要任务是识别目标的网络状态、操作系统和网络架构。该阶段工作旨在
完整地展现目标网络里各种联网设备或技术的完整关系，以帮助测试人员在接下来的工作
里枚举目标网络的各种服务。KaliLinux提供的一系列先进的网络工具，可以轻松探测到联
网主机，识别这些主机运行的操作系统，并根据每个设备在网络系统中的不同角色对它们
进行归类。这些工具通常采用了基于上层网络协议的主动和被动的检测技术，它们能够通
过不同的方式巧妙地利用各种协议获取许多有用的信息，比如操作系统指纹等。
2.5.4服务枚举
这一阶段会根据前面各个阶段的成果，进一步找出目标系统中所有开放的端口，一且
找到了所有开放的端口，就可以通过这些端口来列出目标系统上运行的服务。有很多扫描
端口的技术，如全开（full-open）扫描、半开（half-open）扫描、隐蔽式（stealth）扫描等。
这些技术都可用来检测端口的开放情况，甚至可以扫描处于防火墙或者入侵检测系统保护
下的主机。主机上开放的端口都有相应的服务程序，对这些信息进行深度分析之后，可进
一步发掘目标网络基础设施中可能存在的漏洞。因此，这个阶段为其后的测试工作打下了
基础，有助于测试人员继而发现各种网络设备上可能会造成严重危害的安全漏润。KaliLinux
收录的部分自动化工具可以辅助审计人员完成这一阶段的目标。
2.5.5漏洞映射
至此为止，我们已经充分收集了目标网络的各种信息。接下来，我们就可以根据已经
发现的开放端口和服务程序，查我、分析目标系统中存在的漏润。KaliLinux系统中提供的
一系列自动化的网络和应用漏润评估工具可以担任完成这个阶段的任务。当然，人工（手
动）完成这些任务未尝不可，只是人工操作极为耗时，而且需要有关人员拥有专家级的知
识。但是，如果能够将自动和手动这两种不同的测试方法结合起来，审计人员对目标系统
的认知就会更为清晰、透彻，并能够仔细地检查任何已知和未知的漏洞。否则，被遗漏的
漏洞将会一直残留在目标网络系统里。
2.5.6社会工程学
如果目标网络没有直接的入口，欺骗的艺术将起到抛砖引玉的重要作用。对目标组织
中的人员进行定向攻击，很有可能帮助我们找到渗透目标系统的入口。例如，诱使用户运
---
## Page 73
第2章渗透测试方法论55
行会安装后门的恶意程序，就可能为审计人员的渗透工作形成突破。社会工程学渗透分为
多种不同实现形式。伪装成网络管理员，通过电话要求用户提供自已的账户信息：发送钓
鱼邮件来动持用户的银行账户；甚至是诱使某人出现在某个地点一这些都属于社会工程
学攻击。在社会工程学中，达成同一既定目标的实现方式应有尽有。需要注意的是，在
对目标实施欺骗以达成渗透目标之前，多数情况下需要长时间研究目标人员的心理。另
外，在开展这个阶段的工作之前，您需要事先研究国内的法律是否有关于社会工程学的
相关条款。
2.5.7漏洞利用
在仔细检查和发现目标系统中的漏洞之后，就可以使用已有的漏洞利用程序对目标系
统进行渗透。某些情况下不得不对漏润利用程序（exploit）进行额外的研究和修改，否则它
可能就无法正常工作。虽然这听起来就很麻烦，但是先进的漏洞利用（修改）工具可使这
项工作容易得多，而且KaliLinux已经收录了这种工具。此外，审计人员可以把客户端漏洞
利用程序和社会工程学进行结合，进面控制目标系统。这个阶段的主要任务是控制目标系
统。整个流程可以分为3步，涉及攻击前、攻击、攻击后的相关行动。
2.5.8提升权限
获取目标系统的控制权是渗透成功的标志。接下来，审计人员就可以依据其所拥有的
访问权限，在被测系统中自由发挥。审计人员也可以使用适用于目标系统的本地漏润来提
升自已的权限。只要他们能够在目标系统上运行提权漏润利用程序，就可以获得主机上的
超级用户权限或者系统级权限。审计人员还可以以该主机为跳板，进一步攻击局域网络。
根据之前对渗透范围的界定，审计人员接下来会开展的攻击可能是受限制的，也可能是不
受限的。而后，他们很有可能以各种方式获得与被控制系统有关的更多信息。具体的说，
他们可能使用噪探手段截获网络数据包，被解各种服务的密码，在局域网络中使用网络欺
骗手段。所以说，提升权限的最终目的是获得目标系统的最高访问权限。
2.5.9访问维护
多数情况下，审计人员需要在一段时间内维护他们对目标系统的访间权限。例如，在
演示越权访间目标系统的时候，安装后门将节省重新渗透目标系统所耗费的大量时间。这
些情况下，访问维护将节约获取目标系统访问权限所需要的时间、花费和资源。审计人员
可以通过一些秘密的通信隧道，在既定时间内维持对目标的访问权限。这些隧道往往基于
特定协议、代理或者点对点通信方法的后门程序。这种对系统的访问方法可以清楚地展示，
---
## Page 74
56Kali Linux渗透测试的艺术
入侵人员在目标系统实施攻击时隐匿行踪的具体方法。
2.5.10文档报告
在渗透测试的最后一个环节里，审计人员要记录、报告并现场演示那些已经识别、验
证和利用了的安全漏洞。被测单位的管理和技术团队会检查渗透时使用的方法，并会根据
这些文档修补所有存在的安全漏洞。所以从道德角度来看，文档报告的工作十分重要。为
了帮助惯例人员和技术人员共同理解、分析当前IT基础架构中的薄弱环节，可能需要给不
同的部门撰写不同措辞的书面报告。此外，这些报告还可以用来获取和比较渗透测试前后
目标系统的完整性。
2.6
道德准则
专业的、道德的、经过授权的安全测试服务，离不开由事先约定的规则所组成的安全
测试道德准则。这些准则约定了安全测试服务的服务方式、安全实施的测试方法、合同和
谈判所约定的法律条款、测试的范围、测试的准备、测试的流程，以及报告结构的一致性。
要顾全上述因素，就要仔细地考察、设计在整个测试过程中都要遵循的正规的操作方法和
相关流程。下面将介绍一些常见的到的准则。
·审计人员不得在和客户达成正式协议之前对目标系统进行任何形式的渗透测试。这
种不道德的营销方法有可能薇坏客户的止常业务。在采些国家或地区，这种行为县
至可能是违法行为。
·在测试过程中，在没有得到客户明确许可的情况下，测试人员不得进行超出测试范
围越过已约定范畴的安全测试。
·具有法律效力的正式合同可帮助测试人员避免承担不必要的法律责任。正式合同将
会约定哪些渗透行为属于免责范围，这份合同必须清楚地说明测试的条款和条件、
紧急联系信息、工作任务声明以及任何明显的利益冲突。
·测试人员应当遵守测试计划所明确的安全评估的时间期限。渗透测试的时间应当避
开正常生产业务的时间段，以避免造成相互影响。
·测试人员应当遵循在测试流程里约定的必要步骤。这些规则以技术和管理不同角
度，通过内部环境和相关人员来制约测试的流程。
·在范围界定阶段，应当在合同书里明确说明安全评估业务涉及到的所有实体，以及
他们在安全评估的过程中受到哪些制约。
---
## Page 75
第2章渗透测试方法论57
·测试结果和书面报告必须清晰，其顺序必须一致。报告中提及的所有已知的和未知
的漏洞，必须以安全保密的方式递交给有权查看报告的相关责任人。
2.7本章总结
本章详细介绍了多种渗透测试方法论，以及渗透测试的基本术语、相关类型，还有这
些术语和业内其他术语之间的区别。本章的重点内容如下。
·渗透测试可分为黑盒测试和白盒测试。黑盒测试也称为外部测试，在黑盒测试中，
审计人员事先不了解目标系统的内部结构或任何技术。白盒测试也叫内部测试，在
白盒测试中，审计人员了解目标系统的全部细节。结合黑盒测试和白盒测试的测试
类型，称做灰盒测试。
·脆弱性评估和渗透测试最基本的不同点在于：脆弱性评估旨在找出目标系统中存在
的安全漏洞，并不会去衡量这些漏洞可能造成的相应危害：面渗透测试会进一步利
用这些漏洞，发起实质性攻击以评估它们可能造成的安全问题。
·虽然业内有很多安全测试方面的方法论，但是在评测网络系统或应用程序安全性方
面，只有极少数的方法论才能够具有阶段性的循序渐进的指导意义。本章介绍了5
个非常有名的开源安全评估方法论，突出了它们的技术功能、主要特征和优势，这
5个方法论分别是开源安全测试方法论（OSSTMM）、信息系统安全评估框架
（ISSAF)并放式 Web应用程序安全项目（OWASP)，渗透测试拟行标准（PTES)
以及Web应用安全联合威胁分类（WASC-TC）。
·本章还介绍了一个简单的结构化的通用测试方法论。它由安全测试行业标准方法归
纳而来，分为多个标准化测试阶段。这些阶段分为：范围界定、信息收集、目标
识别、服务枚举、漏洞映射、社会工程学、漏洞利用、提升权限、访间维护、文
档报告。
·最后，本章讨论了在整个安全评估过程中必须遵守的渗透测试道德准则。在安全
评估的各个阶段落实有关道德准则，可以切实保障审计人员和商业实体双方的各
自利益。
在接到一个渗透测试任务时，如何从客户那里获取相关信息，又如何对信息进行管理？
请参见下一章。
---