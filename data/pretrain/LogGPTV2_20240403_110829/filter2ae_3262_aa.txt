**本文纯属个人经验和见解，如有语言不妥之处，还望批评指出。**
### 概述:
网络安全不仅仅是网络上的信息安全,涉及领域很广。
从广义来说，凡是涉及到网络上信息的保密性、完整性、可用性、可控性和可审查性的相关技术都属于网络安全的研究范畴。
百度定义：网络安全是指网络系统的[硬件](https://baike.baidu.com/item/%E7%A1%AC%E4%BB%B6)、[软件](https://baike.baidu.com/item/%E8%BD%AF%E4%BB%B6/12053)及其系统中的数据受到保护，不因偶然的或者恶意的原因而遭受到破坏、更改、泄露，系统连续可靠正常地运行，[网络服务](https://baike.baidu.com/item/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1)不中断。
我们要建设好网络安全，这个是很不容易的，因为涉及的面太广，网络又太过于复杂，又因技术人员的水平和公司安全管理的差异，或多或少造成了很多东西不可实现。
下文，笔者将介绍网络安全主要的防御点和攻击点，由于内网架构建设往往和企业自身特点相关，所以文中相关介绍可能与现实情况有些出入。
### 0X00 网络架构
一个好的网络架构不仅便于管理而且能有很好的防御性。
一般地，企业会有很多个部门，企业的网络分内网和外网，内网又分为办公网和生产网和其他网络，那么如何规划好各个网络之间的联系，成为了网络架构者们头疼的问题。
面对如今的网络安全现状，有数据的企业不被攻击是很难避免的，所以一个好的网络架构就会是企业内网的一道防御点。下面画张图来简单的了解下。
**当然，真实的网络环境比这个草图还要复杂的多，这张图只是一个抽象图，并不能完美呈现网络的全部架构。如要细分的话可能就是体力活了。**
一般来说，企业网络都会是相通的，而且内网的防御一般来说都会是比较薄弱和复杂的，所以对于内网防御就需要大大加强。
对于各个网络环境来讲，是不需要共通的，比如办公网环境，办公网环境是比其他网络更容易受攻击，因为员工不会按照正常的安全操作规范去操作的，员工的管理难度是有的，所以如果办公网和其他网络共通，一台办公网的设备受到攻击，那么整个内网就会直接沦陷。反之，如果其他网络被攻击也是一样的效果。
那么，规避的办法就是不让各个网络共通，各个部门的网络不能连通，其实这些网络也没有共通的必要，那么各个网络或者部门需要连通就要有内部的OA平台。所有的交流由交互服务器环境进行统一管理。如果说还有其他的需求，办法就是都通过外部接口进行联系，每个网络都是独立的个体，风险就会降低许多。
### 0X01 信息连通
接上面的话题，各个部门和其他网络不能连通，那么连通的方式就是要有一个企业自己内部的办公平台，所有的员工交互都需要在这个上面交互，当然也是可以把网络做成单独的个体。
在内网中搭建一个内网办公服务器，部署OA服务器，相关会议通知、部门审批都在上面发布、处理。
服务器当然是放到独立的内部外部网络，由专门的审计服务器进行审计，上传的文件都是要经过处理检查后才能上传保存。
相应的日志是必不可少的，对溯源很有帮助。
### 0X02 内网嗅探
内网常见的攻击莫过于内网嗅探了，一般攻击者拿到权限都会对网络进行扫描，发现主机漏洞并针对性进行攻击。
这类攻击不怎么好防范，只能是做好策略，在网关上做好防ARP攻击等策略，绑定同IP段的MAC地址，自身机器也要确保基线配置合规。
内网中可以嗅探的协议有很多，ICMP、DNS都是可嗅探的，还有就是内网钓鱼要特别防范，在内网中的钓鱼，即使钓鱼特征非常明显，成功的几率也是非常大的，因为人都有在安全感好的地方放松警惕习惯，这个时候就需要防护策略的保障了。
### 0X03 内网监控
在内网中安装监控软件，监控软件监听异常流量，现在市面上的软件，包括开源免费和收费的软件都是有好的可以防范的工具，一旦出现异常发包都会触发报警和记录。
这样做可能会引起员工的不满，所以这个内网监控的做法就只能是监控IP段中的流出流入流量是否异常，每台设备的发包是否正常，更多的就还是只能靠策略防火墙了。
### 0X04 防火墙
防火墙一般是配置在外网出入口处，但是一道防线肯定是不够的，那么防火墙的配置就是需要特别策划了。每一种品牌的防火墙优缺点不一样，防护策略功能和能力也是良莠不齐的，所以我们选择防火墙就需要从多方面考虑。
这里我们先排除经费的问题，当然这个看企业对安全的投入持什么态度。防火墙的选择必须依靠业务自身特点来选择，总不可能一套防DDOS的防火墙你用来当Web的WAF用，不合适吧？所以我们就需要有针对性的选择，网络需要选择那种类型，办公网需要选择哪种类型。针对性的在多个网络出入口进行防火墙设置，当然这个投入是相当大的，所以没钱就…..
当然一般的公司，如果不是什么机密部门或者重要数据存放的网络，普通办公场所就一台总防火墙加一般杀毒软件就OK，不用考虑太多。如果不是攻击者的撒网式攻击，否者根本没有被攻击的可能，毕竟攻击是要讲利益和成本的。
在各个部门的出口入口防火墙策略上做好安全配置，可以让恶意软件或者反向连接型后门出不了当前网段，但对于云端木马来讲，就显得有点鸡肋了，这个也是最不好防范的地方，因为云端木马不按常理出牌，一般依赖客户端，只要设备能够与外界通信，木马就能够执行，并且能够隐藏的很好。所以解决办法就是在防火墙注册软件特征码，当然当前的防火墙还不具备这种功能，所以就只能靠软件来监控软件特征码（这类软件市面上没有全面的，如果公司有实力，可以自己研发），不合规的统统不让出。
不过，这里会有个问题，就是如果病毒流量隐藏在其中呢？如果员工自己新安装了软件呢？所以这个就只能是对服务器有效了？其实不然，我们可以建立异常流量库，是病毒木马都会执行命令，那么就肯定会有命令执行的相关特征，建立大量的特征库，针对性的进行过滤告警，防范也就顺其自然了。
### 0X05 日志分析
日志分析是运维安全中比较重要的，这个和防火墙差不多，依赖于人工和软件自动化，如果企业有条件，可以加上AI自动学习机制，这样可以减少人力，再一个可以增加攻击识别率。
一般来讲，当服务器产生日志，日志是不需要存放到本地的，日志需要直接发送到专门的日志存储服务器上面去，这样可以防止被入侵时，日志被删，减小无法取证溯源的风险。然后审计服务器开始对日志进行审计，提取入侵痕迹，对事件进行报警。
其实日志分析也是一门取证学问，日志不是万能的，但没有日志又是万万不能的。
### 0X06 无线/vpn网络
通常，我们登录堡垒机或者从外部访问内网都是需要用VPN来登录的，所以VPN又是攻击者攻进内网的一个点，排除VPN自身0day,防范的点一般就是U盾加帐号密码来登录。对于帐号密码登录的VPN，风险是比较大的，攻击者可以通过暴力破解、撞库等手段进行帐号密码猜解。所以一个好的强登录手段可以防范此类攻击。
下面来说说无线网的安全，一般公司都会安装无线网的，其中有些公司会把无线网安装部署到内网中，部署到办公网中，这个是非常危险的部署方式。如果攻击者拿到无线网密码，那么他就可以直接内网漫游了，所以无线网应该怎么部署是一个值得探讨的问题。
通常，无线网是部署在其他网络环境中的，也就是与内网是分离开的，或者是内网中独立出来的一个网络，此网络无法与公司其他内部网络进行通信，只能是具有普通的上网功能，供来宾使用。
在这个地方有一个安全的问题，就是公司的无线网设备都是部署于第三方网络环境中，本身无问题不与内网产生关系，但是员工私自在办公电脑上开放无线网，这里的无线网不代表公司办公电脑是否安装无线网卡，这个可以是随身WIFI，U盘无线等设备，这种情况的发生不是不可能。
但是这种情况的发生是很难管控的，因为这个属于员工自有行为，屏蔽或者取消USB插口的话，如果特殊情况要用，又当如何？这种处理场景是有条件限制的，所以这个就只有对问题采取规避措施了，如培训或者对事件发生进行处罚等，健全公司安全管理措施。
### 0X07 内网管控
在办公电脑或者在网服务器中关闭无关端口，屏蔽高危端口。在系统安全中笔者也提到过，端口是攻击者探测信息的重要渠道，所以我们必须关闭无关端口，因为你也不知道这个端口究竟有无漏洞，还有就是高危端口，如Windows的SMB（135，445）的端口，MS08-067,MS17-010就是一个例子，这两个漏洞都是史诗级别的，威力巨大，所以像这些容易被攻击的高危端口都应该关掉，如存在特殊情况应做好安全策略来防范,毕竟有些地方还是需要这些端口来通信的。
内网的管理一般都是批量管理的，如域管理，因为公司小可以不用，但如果一个大公司的话，这样一台一台的管理根本就不可能，所以批量的实现，可以减少管控带来的难度。
域的安全是值得重视的，健全域环境和配置合规，保证域安全。
在内网传输中的传输需要加密，当然不敏感的数据除外。
### 0X08 蜜罐
搭建蜜罐环境可以帮助我们更好的了解攻击者的手法，参考其手法放入公司策略。蜜罐的作用不仅能够追踪最新的攻击手法，也是获取威胁情报的重要途径，以至于当服务器被入侵时，能够找到并对攻击进行溯源，从而避开了系统日志分析的短板。
### 0x09 制度建设