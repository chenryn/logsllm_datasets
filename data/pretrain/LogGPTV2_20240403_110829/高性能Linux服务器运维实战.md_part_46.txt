恢复(TRIGGER.STATUS)、服务器:(HOSTNAME1):(TRIGGER:NAME}已恢裂
更新
告警主机HOSTNAME1)
ID:(EV
[EVENT.TIME}
设置莞成后。点击这个“添加按钮
配置监控项故障恢复时的通知信息
VENTID)
执行内容
{EVENT.TIME}
或
行内容或更新时的执行内容
动作
动件
---
## Page 262
里输入“邮件告警”；“类型”选择“电子邮件”，
面，然后单击“Email”
告警设置，几乎可以做到实时收取告警信息。
免费，加上现在有很多手机邮件客户端工具（网易邮件大师、QQ邮箱），通过简单的邮件
定就可以了。
还可以扩展到微信告警、钉钉告警等方式，至于选择哪种告警方式，以爱好和习惯来
出去。常用的告警媒介有很多，例如，Email、Jabber和SMS等，这是3种默认方式
6.3.7报警媒介类型配置
通过Email媒介发送消息。也就是故障恢复消息。
默认使用较多的是通过Email方式进行消息的发送告警。邮件告警方式的优势是简单、
报警媒介类型是用来设置监控告警的方式，也就是通过什么方式将告警信息发送
最后，还是要单击上图左下角的“添加”按钮，这样刚才的设置才能保存生效。
在“报警媒介类型”选项卡可以设置Email告警属性。“名称”可以是任意名字，这
这个界面是设置当监控项故障恢复后，向Zabbixadministrators 用户组中的所有用户
报警媒介类型
级agen代理程序认证用户联组用户报营障介类型脚本队列
ZABBIX
报警媒介类型
SMTP服务器端口
选项
MessagefomatHTML文本
SMTPHELO
SMTP服务器
监测
进入编辑页面，如图6-25所示。
SMTP电邮
用户名称
安全链接
已启用
密码
资产记录报表
认证
类型
图6-25配置报警媒介类型为邮件
名称
无联户名和密码
添加取消
无STARTTLS（纯文本通信协议扩展）SSLTLS
zabbixserver
PI:EMAIL
smtp.163.com
电子邮件
邮件告警
配置
易
，当然也可以选择“脚本”“短信”等类型；
运维监控利器Zabbix第6章
251
---
## Page 263
还可以单击右边的“图形”链接，即可通过图形方式展示一段时间的数据趋势，如图6-27
“0.0003”就是获取的最新数据，通过不断刷新此页面，可以看到最新数据的变化。如果
据，单击“应用”按钮，即可显示过滤出来的数据信息。重点看“最新数据”一列的内容，
控项的内容。这里选择“Linux servers”主机组，“http server”应用集下所有监控项的数
所示。
测”菜单，然后选择“最新数据”，即可看到监控项是否获取到了最新数据，如图6-26
报警媒介，配置消息发送的介质，这就是一个完整的Zabbix配置过程。
中引用已经存在的或新增的模板；然后创建触发器动作，设置消息发送事件；最后，设置
发器，如果有必要，还可以对此监控项添加图形；接着，开始添加主机组和主机，在主机
模板，或者在默认模板基础上新增监控项；监控项添加完成后接着对此监控项添加一个触
252
所示。
监控项获取不到最新数据，那么显示的结果将会是浅灰色。要想查看一段时间的历史数据，
6.3.8
发件人邮箱登录的用户名和密码。
保持默认即可；“SMTP电邮”就是发件人的邮箱地址，输入一个网易163邮箱地址即可：
因此设置为“smtp.163.com”即可；“SMTP服务器端口”，输入默认值25；“SMTPHELO"
“SMTP服务器”是设置邮件告警的发件服务器，这里使用网易163邮箱进行邮件告警，
高性能Linux服务器运维实战：shell编程、监控告警、性能优化与实战案例
最新数据
ZABBIX监测
一个监控项的添加流程完成了。
在查看最新监控数据时，可以通过此界面提供的过滤器快速获取想查看的主机或者监
最后，再来梳理下一个监控项添加的流程。
所有设置完成，单击“添加”按钮完成邮件媒介告警的添加。到这里为止，Zabbix中
17216215229
172 16.213231
当一个监控项配置完成后，要如何查看是否获取到数据了呢？单击Web上面的“监
监控状态查看
资产记录
最新散据
招装配耀管理
Lireu snersx
图
图6-26查看监控项获取的最新数据
石扑图
自动发现
90d
3656Zabbx产2019-11-0609.47:43
用理
Zabx客户2019-11060947.47
查看无迎料动目
一般操作步骤是这样的：首先新创建一个
查看继书
时
---
## Page 264
了Linux操作系统相关的所有基础监控项。
础监控就已经自动加载到了172.16.213.231主机上。因为“TemplateOSLinux”模板自带
加了，在之前将“Template OSLinux”模板链接到172.16.213.231上时，这些操作系统基
等操作系统基础监控信息。这些基础监控都不需要添加监控项，因为Zabbix默认已经添
角的条件中选择需要的主机以及网卡名称即可，如图6-28所示。
形”，即可进入图形展示界面，例如，要展示172.16.213.231的网卡流量信息，可在右上
常显示了。
/usr/local/nginx/html/zabbix/assets/fonts)。
中文的地方出现乱码，这是默认编码非中文字体导致的，需要简单做一些处理，过程如
下所述。
生成，无须设置。由于使用的是中文界面，在图形展示数据的时候，可能会在左下角有
172.16.213.231:httpd port 80 status
在这个界面中，不但可以查看网卡图形信息，还可以查看CPU、内存、文件系统、Swap
要查看其他监控项的图形展示，
其中 simhei为字库名字，不用写.tf扩展名。刷新一下浏览器，中文字体应该可以正
修改为：
打开/usr/local/nginx/html/zabbix/include/defines.inc.php文件，找到如下两行：
3）修改Zabbix的Web前端的字体设置。
2）将Windows下的中文字体文件上传到ZabbixWeb目录下的fonts 目录（本例是
1）进入C:Windows\Fonts，选择其中任意一种中文字体，如黑体（SIMHEI.TTF）。
define('ZBX_GRAPH_FONT_NAME',‘simhei'）;
define（'ZBX FONT NAME',
define(*ZBX_GRAPH_FONT_NAME',
define（ZBXFONT NAME',DejaVuSans'）;
图6-27查看zabbix监控项一段时间的趋势数据
，可以单击Web上面的“监测”菜单，然后选择“图
I.16 21a 81i hiftpd jear1 S6 stanTus
'simhei');
'DejaVuSans');
AWOWENE
，此图形曲线是自动
小小时
以橙围摄形
253
---
## Page 265
254
基于以下信息。
部署、简化管理，
6.4.1
就可以实现主机的批量添加。
就会极大地提高运维效率，答案是有的。通过Zabbix提供的自动注册和自动发现功能，
非常多时，也将变得非常烦琐。那么有没有一种方法，可以实现主机的批量添加呢？这样
高性能Linux服务器运维实战：shell编程、监控告警、性能优化与实战案例
6.4
图形
ZABBIX监澜武产招堡振表昆置普理
》IP段自动发现。
Zabbix提供非常有力和灵活的自动网络发现功能。通过网络发现，
》自动网络发现（Networkdiscovery）。
Zabbix的发现包括3种类型
在上面的介绍中，演示了手动添加一台主机的方法，虽然简单，但是当要添加的主机
网络发现由两个步骤组成：发现和动作（action）。Zabbix周期性地扫描在网络发现规
1.自动发现的原理
下面分别进行介绍。
》低级别发现（low-level discovery）。
从SNMP客户端接收到的信息。
从Zabbix客户端接收到的信息。
可用的外部服务（FTP、SSH、WEB、POP3、IMAP和TCP等）。
Zabbix的自动网络发现
主动客户端自动注册（Active agent auto-registration）。
Zabbix自动发现、
在不断变化的环境中使用 Zabix 不需要过多的管理，Zabbix 网络发现
图6-28以图形方式查看zabbix监控项数据
自动注册和自定义监控的实现
16:2135281
标组nuvr主机1721.213.23形Nok op0
，可以加速Zabbix
《小还小时
---
## Page 266
能获取数据，如果能获取到数据，那么就把这台主机加入到自动发现规则中。
个范围段的所有IP，依次连接这些IP的10050 端口，接着通过system.uname 键值看是否
加”
随便输入一个Zabbix 默认键值即可，这里输入的是 system.uname，
口范围”和“键值”两个选项，端口就输入10050这个agent的默认端口即可，键值可以
类型”选项，这里面有很多检查类型，选择“Zabbix客户端”即可，接着还需要输入“端
围段的 IP，设置了范围之后，Zabbix 就会自动扫描整个段的 IP。那么扫描的依据是什么
图6-29所示。
用主机、添加主机到某个组中、
定IP段的服务检查集合。
则中定义的 IP 段。根据每一个规则配置自身的检查频率。每一个规则都定义了一个对指
在这个界面中，主要设置的是“IP范围”，这里设置的是172.16.213.220～239这个范
动作是对发现的主机进行相关设置的过程，常用的动作有添加或删除主机、启用或停
自动发现规则添加完成后，接着，就可以添加自动发现动作了。单击Web界面的“配
综上所述，这个字段发现规则的意思是：Zabbix会自动扫描172.16.213.220～239这
按钮，这样一个自动发现规则就创建完成了。
单击Web 界面的“配置”菜单，然后选择“自动发现”，即可创建一个发现规则，
2.配置网络发现规则
自动发现规则
主机群组模板主机维护动作关联项事件自动发期服务
ZABBIX
监测
设备难一性准IP地址
代理程序自动发现
资产记录报表配置管理
图6-29创建一个自动发现规则
伊范围17216213220-239
检查
名称自动发现规则
发现通知等。
盗加联油
没有agent代理程序
IP地址
端口范围10050
检查类型Zabbix客户端
键值systemuname
运维监控利器Zabbix第6章
然后单击下面的“添
255
如
---
## Page 267
256
作”选项卡，进入如图6-31所示的设置界面。
触发条件添加到了上面的“条件”选项中。
触发条件有非常多，这里选择红框内的4个即可。选择完成后，单击“添加”就把选择的
“与/或（默认）”即可。要添加触发条件，可以在“新的触发条件”选项下选择触发条件，
按钮，即可创建一个自动发现的动作，如图6-30所示。
置”菜单，然后选择“动作”，在右上角事件源选择“自动发现”，接着单击“创建动作”
高性能Linux服务器运维实战：shell编程、监控告警、
除了自动发现条件的设置，还需要设置自动发现后操作的方式，单击图6-30中的“操
在自动发现动作配置界面中，难点是设置自动发现的条件。“计算方式”选择默认的
主机彩组梗板主机维护动件关职项事件自动发现服务
ZABBIX监测资产记录根表配置管理
动作
主机群组模板主机维护动作关联项事件自动发现服务
ZABBIX监测资产记录接表配置管理
动作
操作
图6-31设置自动发现主机后自动执行的操作
新的触发条件
消息内容
默认标题
计算方式与或（默认]AandBandCandD
巴启用
操作
条件
名称自动发现动作
添加眼游
链接到模板：Template CS Linu
图6-30创建自动发现动作
添加取消
必须至少设置—个执行内容
服务类型等于FTP
服务类型等于Zabbx套户端
自动发现状态等于上
在线不在线大于等于600
自动发现规则等于自动发斑短遗
性能优化与实战案例
---
## Page 268
件”选项中。
触发条件有非常多，这里选择红框内的两个即可，这两个条件其实都是在Zabbix agent端
“与/或（默认）”即可。要添加触发条件，可以在“新的触发条件”选项下选择触发条件，
接着单击“创建动作”按钮，即可创建一个自动注册的动作，如图6-32所示。
将在客户端重启之后立即发送。
在客户端中配置文件zabbix_agentd.conf 的 RefreshActiveChecks 参数中指定。第1次请求
IP分配就是随机的，这个功能就可以很好地解决类似的问题。
仍然可以实现主机自动添加到ZabbixWeb 中的功能。例如，云环境下的监控，云环境中，
条件未知（如 agent 端的IP地址段、agent 端的操作系统版本等信息）时，agent去请求 server
前面的Network discovery具有同样的功能，但是这个功能更适用于特定的环境，当有一个
6.4.2主动客户端自动注册
的主机自动添加到ZabbixWeb中来a
主机。
组和“TemplateOSLinux”模板也自动链接到此主机下，最后在ZabbixWeb中启用这个
现主机后，首先自动将这个主机添加到Zabbix Web上来，然后将“Linux servers”主机
击左下角的“新的”按钮可以设置多个操作动作，一般情况下设置4个即可，也就是发