新 特 性
P G
digoal
目录
• PG 12 重点新特性
• 风向标
重点新特性
PG 12
• 性能增强
• AM接口
• 分区表大幅性能提升
• GiST index include 任意数据组织存储
• Btree 索引 duplicate key存储组织 sort by ctid增强性能
• 自定义统计信息支持多列 MCV
PG 11+
高性能
自动计算并行度 覆盖几乎所有复杂查询
几乎线性提升
l 表扫描
l 索引扫描
l SQL 过滤
l 单表10亿测试 l 不需要改写SQL l JOIN、子查询
l 平均提速20倍+ l 自动根据SQL代价启动并行计算 l 聚合、自定义函数
l 分区表、外部表
l 自定义聚合、函数
l 排序、建表、物化、创建索引
接口
AM
PG 12
• https://github.com/digoal/blog/blob/master/201903/20190331_03.md
• https://github.com/digoal/blog/blob/master/201905/20190531_03.md
存储引擎扩展
• zedstore(列存 )
• zheap(支持回滚段 )
分区表 大量分区性能提升
-
个分区、 倍
•
1000 469
• https://github.com/digoal/blog/blob/master/201905/20190521_01.md
• https://github.com/digoal/blog/blob/master/201903/20190331_01.md
Index include
• 痛点：
• 数据离散存储，查询多条时IO多，查询慢，占用内存多，memcpy效率低。
• 聚集存储（b+t）只有一种存储形态，聚集KEY必须是PK，二级索引效率低，实用性差。
• PG 11 Btree, PG 12 GiST support index include
• create index idx_t1_1 on t1 (id) include(c1,c2,c3,info,crt_time);
Btree,duplicate keys sort by ctid
• https://github.com/digoal/blog/blob/master/201911/20191128_03.md
• 1、duplicate keys值按ctid排序存储，减少索引页split。原来是按duplicate group无序存储。
• 2、提高查询效率（有序scan）
• 3、降低索引存储空间。
• 4、vacuum时，scan table，存储垃圾tuple ctids，存满vacuum memory(maintenance mem)，scan
index回收垃圾index tuples。当回收整个duplicate keys，vacuum产生的wal更少(涉及的index page更
少))。
自定义统计信息支持多列
MCV
• Where a = ? And b=? Or c=? And d=? …
• 评估选择性
单列柱状图
简单粗暴：
单列柱状图 多列柱状图 概率更加精准
单列概率相乘、相加
单列柱状图
重点新特性
PG 12
• 功能
• Reindex Concurrently 不堵塞写操作
• 日志采样
• SQL/JSON path language
• Generated columns
• Case-insensitive and accent-insensitive grouping and ordering
• Checksum offline 修改， pg_checksum插件支持 online开关 checksum
日志采样
• https://github.com/digoal/blog/blob/master/201904/20190405_09.md
• log_statement_sample_rate ，当设置了log_min_duration_statement时，如果
log_statement_sample_rate也设置了，它表示百分之多少的超时SQL被记录。
• log_transaction_sample_rate ， 不管其他任何设置，它表示百分之多少的事务被记录duration。（事
务为最小粒度单位，如果一个事务被触发了记录duration，这个事务中的所有SQL都会被记录。）
SQL/JSON path language
• 新增类型 jsonpath
• https://www.postgresql.org/docs/12/functions-json.html#FUNCTIONS-SQLJSON-PATH
风向标
• PG DNA
• License
• 社区化开源数据库
• 模块化设计，Easy extendable
• 社区化运作有组织有纪律
• Major sponsors组成-健壮性
• 底盘（可靠性、安全性、 sql兼容性、可用性、易用性、生态）
风向标
• 大环境
• 拥抱开源，全球化趋势
• 自主可控
风向标
• 风向、机会
• RAC
• NewSQL
• 垂直化市场功能
• SaaS(ERP,。。。)
• 工具生态（同步、迁移、 …）
• Support、培训
数据库秒杀活动
aliyun (12.25~12.27)
• https://www.aliyun.com/database/miaosha
折起
1
谢谢