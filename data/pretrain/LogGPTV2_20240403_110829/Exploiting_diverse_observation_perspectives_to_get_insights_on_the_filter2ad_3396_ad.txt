classes 
is the file size: while 
the worm lacks self-updating 
their static 
can be fixed by, for instance, re-running 
characteristics. 
Once detected, these 
the mis­
of cluster­
aberra­
Sam­
when purely looking 
profiles, 
by the analysis 
of behavioral 
in pinpointing 
from the DNS database2. 
This real-world 
example shows the usefulness 
features 
unrelated 
are discovered 
clustering 
profiles. 
at 
when 
to be related 
ing based on static 
tions produced 
ples that are apparently 
their behavioral 
analyzing 
problems 
configured 
seen on a limited 
deed very effective 
the generation 
samples would be too expensive 
in most of the cases, the comparison 
techniques 
which it would be useful to repeat the behavioral 
to improve consistency. 
these anomalies. 
profiles for all the 
allows to detect small groups of samples for 
in eliminating 
samples multiple 
and probably 
behavioral 
of multiple 
with static 
is in­
While 
number of samples that re-execution 
analysis 
analysis 
times. We have experimentally 
unnecessary 
4.3. The value of the propagation context 
When looking 
at Figure 3, we can identify 
a considerable 
M-clusters. 
amount of cases in which a B-cluster 
different 
ing on the motivations 
lected two of the biggest 
M-clusters. 
B-clusters 
In order to get a better understand­
underlying 
these splits, 
associated 
we have se­
to multiple 
is split into several 
The behavioral 
profiles 
generated 
in time. At the time of writing, 
by Anubis are obvi­
each behav­
to an execution 
time of four min­
profile includes 
information 
ously limited 
ioral profile corresponds 
utes. While such a behavioral 
on the generated 
ficient to understand 
tion. This is especially 
pends on external 
cording 
understanding 
to his will. Honeypots 
and studying 
the dynamics 
network traffic, this information 
is not suf­
of the mal ware propaga­
true for bots, whose behavior 
commands generated 
by a bot-herder 
in better 
helpful 
are instead 
de­
ac­
these dynamics. 
Looking at the right side of Figure 5, we can immediately 
in the size of the infected 
over the IP space. In 
in terms of num­
important 
differences 
with most of the static 
and on their distribution 
identify 
populations, 
this case, we face rather small populations 
bers of attackers, 
to very specific networks 
ties are bursty, 
exposes complex behaviors 
associated 
looking 
clusters, 
in depth at the temporal 
we obtain the following 
evolution 
sequence: 
that we consider 
behavior. 
to bot-like coordinated 
and in some cases, the temporal 
clusters 
of one of the M­
of the IP space. All the activi­
likely to be 
For instance, 
evolution 
associated 
Figure 5 shows contextual 
information 
for the two B­
under consideration. 
The X axis splits 
associated 
graphs show, from top to bottom, 
M-clusters 
with it, while the 
the B-cluster 
the distribution 
hosts over the IP space, the number of weeks 
of activ­
and the timeline 
classes, 
of the different 
clusters 
into the different 
different 
of the infected 
of activity 
ity. 
• 1517 -1617: observed 
• 1817: observed 
hitting 
• 2617: observed 
hitting 
• 2/8-4/8: 
• 27/9: observed 
observed 
hitting 
network location 
hitting 
A 
network location 
network location 
B 
B 
hitting 
network location 
A 
network location 
B 
In the first  case, 
we see that the different 
with different 
malware vari­
sizes in terms 
population 
sizes, combined with the small coverage 
the Internet. 
The different 
of the 
pop­
hosts scanning 
ants are associated 
of infected 
ulation 
SGNET deployment 
IPs (at the time of writing, 
deployment 
in 30 different 
smaller 
150 IPs are monitored 
network locations), 
by the 
makes the 
groups account for only a few hits in the dataset. 
in terms of the number of monitored 
2 As of today, any resolution 
attempt for the above name fails, and the 
name appears in many popular blacklists 
Such coordinated 
Command&Control 
channel. 
behavior 
suggests 
the presence 
of a 
looked closer into the behavioral 
and have tried to gather evidence 
of an IRC Command & Control server. 
We have, therefore, 
for these samples, 
profiles 
of the presence 
While not all the samples were executed 
the activity 
to associate 
tion to the corresponding 
most cases, each M-cluster 
to a specific IRC server. 
period of the C&C server, 
some of the M-clusters 
IRC server. 
In the minority 
by Anubis during 
we have been able 
taken into considera­
Table 2 shows how, in 
is characterized 
by connections 
of cases in which 
978-1-4244-7501-8/10/$26.00 
©2010 IEEE 
400 
DSN 20lO: Leita et al. 
Authorized licensed use limited to: Tsinghua University. Downloaded on March 18,2021 at 14:00:10 UTC from IEEE Xplore.  Restrictions apply. 
2010 IEEE/IFIP International 
Conference 
on Dependable 
Systems & Networks (DSN) 
 2.5"  .......•. :  ...............
......... . 
:. 2.0 _ 'l1'li-. .... : •....•.. + ... .. .  - ....  . 
-:  :. 
.:  : 
0.5 ,., • .;.._ .•. " . ...•.•.• ....•  . ......•.. ......  .. '.' 
_  .. :. .. 
0.00  10  20  30  40  50  60  70  80 
 ...... : ••  ..... ; ••• H' 
..• 
. 
.. 
3.0 
 2.5 
g. 2.0 
eo 1.5 
1.0 
0.5 
0.00 
'ii 
al4 . 
• o 
E3 
 il2 
  1 
°0---7----7---------10--1
25.------------------. 
12 
2 
Figure 5. Propagation 
context information for 
two behavioral 
clusters. 
I 
°0-- ----6---7
Different 
clusters 
 -- 10----712 
and re­
operate 
to different 
M-c1usters 
or "patches" 
code variants 
But even when looking 
on the same IRe channel 
distinct 
ceive commands from the same room name, they are likely 
to be associated 
plied to the very same botnet. 
M-clusters 
acteristics 
ties: many IRe servers 
and send commands to the bots from rooms with recurring 
names or name patterns. 
specific 
tiple separate 
reveal very strong similari­
are hosted in the same 124 subnet, 
operating 
of the IRe channels 
at 
the char­
that is maintaining 
or organization 
IRe channels, 
the operation 
on different 
This suggests 
bot-herder 
of a 
mul­
ap­
botnets. 
The combination 
of malware clustering 
techniques 
(i.e., 
information 
on their evolution 
and dynamic features) 
based on both static 
contextual 
tice. That is, such techniques 
how malware is developed 
the importance 
for studying 
driving 
with long term 
in prac­
allow us to understand 
Our work shows 
information 
of its 
the threat evolution, 
and propagated. 
and the "economy" 
of leveraging 
is helpful 
different 
forces. 
better 
sources 
5. Conclusion 
In this paper, we evaluate 
and combine different 
clus­
tering techniques 
building 
intelligence 
on the threats 
economy. 
in order to improve our effectiveness 
in 
Server address Room name M-c1usters 
67.43.226.242 #las6 
67.43.232.34 #kok8 
67.43.232.35 #kok6 
67.43.232.36 #kham 
67.43.232.36 #kok2 
67.43.232.36 #kok6 
67.43.232.36 #ns 
72.10.172.211 #las6 
72.10.172.218 #siwa 
83.68.16.6 #ns 
282, 70 
263 
23,277 
170 
37 
195,275 
234 
266 
140 
112 
Table 2. IRC servers associated to some of 
the M-clusters 
We take advantage 
of a freely accessible 
honeypot 
while being resistant 
engines. 
of polymorphic 
to the cur­
Despite 
and the easiness 
with which 
generation 
tech­
between exploits, 
shell­
of the approach 
level of sophistication 
SGNET, and propose a pattern 
the relationships 
dataset, 
nique to explore 
codes and mal ware classes 
rent level of sophistication 
the simplicity 
it could be evaded by malware writers, 
current 
is very low and that simple clustering 
static 
show the importance 
"healing" 
dependence 
tions (e.g., 
trol server). 
often work well in practice. 
of these techniques 
such as the availability 
of the execution 
known problems 
behavior 
features 
Furthermore, 
in detecting 
techniques 
based on 
we 
and 
such as the 
condi­
on external 
of a command and con­
in dynamic analysis, 
we show that the 
of polymorphic 
techniques 
978-1-4244-7501-8/101$26.00 
©201 0 IEEE 
401 
DSN 2010: Leita et al. 
Authorized licensed use limited to: Tsinghua University. Downloaded on March 18,2021 at 14:00:10 UTC from IEEE Xplore.  Restrictions apply. 
2010 IEEEIIFIP International 
Conference 
on Dependable 
Systems & Networks (DSN) 
Moreover, 
we offer insights 
into the relationships 
be­
their propagation 
We show with practical 
offer different 
strate­
vulnerabilities 
phic worm exploits. 
and Communications 
New York, NY, USA, 2005. 
The propagation 
context 
on top of the malware clusters, 
perspec­
allows 
provid­
that is not easily available 
through 
standard 
[9] J. R. Crandall, Z. Su, and S. F. Wu. On deriving unknown 
from zero-day polymorphic and metamor­
In 12th ACM conference 
Security, 
on Computer 
pages 235-248. ACM Press 
[10] F-Secure. 
Malwareinformation 
pages: Allaple.a, 
http: / / 
www.f-secure.com/v-descs/allaplea.shtml. 
December 2006. 
We show how the propaga­
[11] M. Gheorghescu. 
An Automated Virus Classification 
Sys­
can be used to study code-sharing 
tem. In Virus Bulletin 
conference, 
2005. 
and how temporal 
can be effectively 
to the security 
in­
used to 
behavior 
an­
[12] T. Holz, C. Willems, K. Rieck, P. Duessel, and P.  Laskov. 
Learning and Classification 
Conference 
nerability 
Assessment 
on Detection of Intrusions 
of Malware Behavior. In Fifth 
and Malware & Vul­
(DIMVA 08), June 2008. 
intrusion 
detection 
alarms to support 
[13] K. Julisch. Clustering 
techniques 
malware classes, 
profiles. 
tween different 
gies and their behavioral 
examples 
how different 
tives over the ground truth. 
to build semantics 
ing information 
dynamic analysis 
tion vector information 
taking place among malware writers, 
formation 
and source distribution 
provide 
alyst. 
techniques. 
on the threat 
semantics 
Acknowledgments 
This work has been partially 
supported by the European Com­
root cause analysis. 
System Security (T/SSEC), 6(4):443-471, 
2003. 
ACM Transactions 
on Information and 
[14] J. Z. Kolter and M. A. Maloof. Learning to detect and clas­
sify malicious 
7:2721-2744,2006. 
executables 
in the wild. 1. Mach. Learn. Res., 
mission through project FP7-ICT-216026-WOMB
the 7th framework program. The opinions expressed in this paper 
are those of the authors and do not necessarily 
the European Commission. We would like to thank the reviewers, 
Ludovic Me, and Marc Dacier for their insightful 
led to substantial 
improvements 
reflect the views of 
comments that 
of this work. 
AT funded by 
References 
[1] ANUBIS: A platform for the dynamic analysis of malware. 
http:// anubis. iseclab. org, 2009. 
[2] P. Baecher, 
M. Koetter, 
T. Holz, M. Dornseif, and F. Freiling. 
The Nepenthes Platform: An Efficient Approach to Collect 
Malware. In 9th International 
vances in Intrusion 
Symposium on Recent Ad­
Detection (RAID), September 2006. 
[3] M. Bailey, J. Oberheide, 
J. Andersen, Z. M. Mao, F. Jaha­
nian, and J. Nazario. Automated classification 
of internet 
tional Symposium on Recent Advances in Intrusion 
tion (RAID'07), September 2007. 
[4] U. Bayer, P. M. Comparetti, 
mal ware. In Proceedings of the 10th Interna­
Detec­
C. Hlauschek, 
and analysis 
E. Kirda. Scalable, 
Behavior-Based 
16th Annual Network& Distributed 
sium,2009. 
[5] U. Bayer, I. Habibi, D. Balzarotti, 
E. Kirda, and C. Kruegel. 
Insights into current mal ware behavior. In LEET'09: 2nd 
USENIX W orkshop on Large-Scale 
Threats, April 21, 2009, Boston, MA, USA, Apr 2009. 
Exploits and Emergent 
[6] U. Bayer, C. Kruegel, and E. Kirda. T TAnalyze: A Tool for 
Analyzing Malware. In 15th European Institute 
puter Antivirus 
April 2006. 
Research (EICAR 2006) Annual Conference, 
for Com­
[7] J. Canto, M. Dacier, E. Kirda, and C. Leita. Large scale 
malware collection: 
shop on Sharing Field Data and Experiment 
on Resilience 
of Distributed 
Lessons learned. In IEEE SRDS Work­
Computing Systems, 2008. 
Measurements 
[8] E. Carrera. Pefile, http://code.google.com/p/ 
pefile/. 
C. Kruegel, and 
Malware Clustering. 
In 
System Security Sympo­
improve resistance 
ference on Computer and communications 
290-299. ACM New York, NY, USA, 2003. 
to static disassembly. 
of executable 
code to 
In 10th ACM con­
security, 
pages 
[15] T. Lee and J. J. Mody. Behavioral 
Classification. 
In EICAR 
Conference, 
2006. 
[16] C. Leita. Automated protocol learning for the observation 
de Nice-Sophia 
Universite 
PhD thesis, 
threats. 
of malicious 
Antipolis, 
December 2008. 
[17] C. Leita and M. Dacier.  SGNET: 
a worldwide deployable 
framework to support the analysis of malware threat mod­
els. In 7th European Dependable Computing Conference 
(EDCC 2008), May 2008. 
[18] C. Leita and M. Dacier. SGNET: Implementation 
In IEEEIIFIP Network Operations and Management Sym­
posium, April 2008. 
Insights. 
[19] C. Leita, M. Dacier, and F. Massicotte. 
and reaction 
dling of protocol dependencies 
with ScriptGen based honeypots. 
posium on Recent Advances in Intrusion 
Sep 2006. 
In 9th International 
Sym­
Detection (RAID), 
Automatic han­
to O-day attacks 
[20] C. Leita, K. Mermoud, and M. Dacier. Scriptgen: 
an au­
tool for honeyd. In 21st An­
Decem­
tomated script generation 
nual Computer Security Applications 
ber 2005. 
Conference, 
[21] C. Linn and S. Debray. Obfuscation 
[22] A. Moser, 
for malware detection. 
Applications 
Conference 
C. Kruegel, and E. Kirda. Limits of static analysis 
In 23rd Annual Computer Security 
(ACSAC), 2007. 
[23] G. Portokalidis, 
A. Slowinska, 
and H. Bos. Argos: an em­
ulator for fingerprinting 
EuroSys,2006. 
zero-day attacks. In ACM Sigops 
[24] D. Smith. Allaple worm (ISC diary), http: / / isc. 
sans.org/diary.html?storyid=2451. 
[25] VirusTotal. 
[26] G. Wicherski. pehash: A novel approach to fast malware 
In 2nd USENIX Workshop on Large-Scale 
www.virustotal.com. 2007. 
clustering. 
ploits and Emergent Threats, April 2009. 
Ex­
[27] T. Yetiser. Polymorphic viruses -implementation, detec­
tion, and protection, http://vx . net lux . org/ lib/ 
ayt01.html. 
978-1-4244-7501-8/10/$26.00 
©201O IEEE 
402 
DSN 2010: Leita et al. 
Authorized licensed use limited to: Tsinghua University. Downloaded on March 18,2021 at 14:00:10 UTC from IEEE Xplore.  Restrictions apply.