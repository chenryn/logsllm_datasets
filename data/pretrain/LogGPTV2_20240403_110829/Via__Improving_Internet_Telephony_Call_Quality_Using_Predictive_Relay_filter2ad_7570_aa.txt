title:Via: Improving Internet Telephony Call Quality Using Predictive Relay
Selection
author:Junchen Jiang and
Rajdeep Das and
Ganesh Ananthanarayanan and
Philip A. Chou and
Venkat N. Padmanabhan and
Vyas Sekar and
Esbjorn Dominique and
Marcin Goliszewski and
Dalibor Kukoleca and
Renat Vafin and
Hui Zhang
VIA: Improving Internet Telephony Call Quality
Using Predictive Relay Selection
Junchen Jiang1,2, Rajdeep Das1, Ganesh Ananthanarayanan1, Philip A. Chou1,
Venkata N. Padmanabhan1, Vyas Sekar2, Esbjorn Dominique1, Marcin Goliszewski1,
Dalibor Kukoleca1, Renat Vaﬁn1, Hui Zhang2,3
1 Microsoft, 2 CMU, 3Conviva
ABSTRACT
The use of the Internet for voice calls is here to stay.
In
spite of the volume and importance of Internet telephony, we
have little understanding of (1) how network performance
impacts user-perceived call quality, and (2) why and where
such quality problems occur in the wild. To bridge this gap,
we analyze a data set of 430 million calls from Skype, with
clients across 1900 ASes and 126 countries. We observe that
call quality problems are quite pervasive. More importantly,
these problems are signiﬁcantly spread out geographically
and over time, thereby making simple ﬁxes targeted at spe-
ciﬁc "pockets" of poor performance largely ineffective.
To alleviate call quality problems, we present an archi-
tecture called VIA that revisits the use of classical overlay
techniques to relay calls. We argue that this approach is both
timely and pragmatic given the emergence of private back-
bones in recent years to connect globally distributed data-
centers, which can serve as a readily available infrastruc-
ture for a managed overlay network. Trace-driven analysis
shows that an oracle-based overlay can potentially improve
up to 53% of calls whose quality is impacted by poor net-
work performance. A key challenge is realizing these bene-
ﬁts in practice, in the face of signiﬁcant spatial and tempo-
ral variability in performance and a large number of relaying
choices. We develop a practical relay selection approach that
intelligently combines prediction-based ﬁltering with an on-
line exploration-exploitation strategy. Trace-driven analysis
and a small-scale deployment shows that VIA cuts the inci-
dence of poor network conditions for calls by 45% (and for
some countries and ASes by over 80%) while staying within
a budget for relaying trafﬁc through the managed network.
Permission to make digital or hard copies of all or part of this work for personal
or classroom use is granted without fee provided that copies are not made or
distributed for proﬁt or commercial advantage and that copies bear this notice
and the full citation on the ﬁrst page. Copyrights for components of this work
owned by others than ACM must be honored. Abstracting with credit is per-
mitted. To copy otherwise, or republish, to post on servers or to redistribute to
lists, requires prior speciﬁc permission and/or a fee. Request permissions from
permissions@acm.org.
SIGCOMM ’16, August 22-26, 2016, Florianopolis , Brazil
c(cid:13) 2016 ACM. ISBN 978-1-4503-4193-6/16/08. . . $15.00
DOI: http://dx.doi.org/10.1145/2934872.2934907
CCS Concepts
•Applied computing → Internet telephony; •Networks →
Overlay and other logical network structures; Network per-
formance analysis; Network measurement;
Keywords
Internet telephony; Quality of experience; Predictive relay
selection; Managed overlay networks
1 Introduction
Over the last several years, we have seen a dramatic rise in
Internet-based telephony, especially for long-distance inter-
national calling [5, 6]. The importance of audio calling is
evident as almost all major content and social networking
platforms today offer some form of Internet calling capa-
bility (e.g., Skype, Google Hangouts, Facebook Messenger,
WhatsApp, WeChat, FaceTime).
Despite the growing importance of Internet telephony and
the dominant role that the network plays in user perceived
call quality, there have been few systematic studies at scale
that analyze (1) how network performance impacts user-perceived
quality of experience for Internet telephony, and (2) the typ-
ical characteristics of performance issues in the real world.
As a ﬁrst step to bridge this disconnect, we analyze mea-
sured network performance and user-perceived quality in-
dexes from one of the largest deployed VoIP services, Skype,
which serves hundreds of millions of users and handles a to-
tal call volume in excess of a billion minutes of talk-time per
day. Our dataset consists of a sample of this total call volume
and includes 430 million calls from seven months spanning
135 million users across 126 countries. As expected, we ob-
serve that the call quality experienced by users is strongly
correlated with the underlying network performance (RTT,
packet loss rate and jitter). But contrary to our intuition,
The key difference between Internet-based audio call stream-
ing and on-demand video streaming (e.g., Netﬂix) is inter-
activity. The real-time interactive nature of audio calls make
them far more sensitive to issues such as high RTT, packet
loss and jitter induced by the network [15] while at the same
time making solutions based on application-level buffering,
that work well with video streaming, less effective.
calls over poor networks are not conﬁned to a few bad pock-
ets but rather are spread out geographically and over time.
How might we alleviate these sources of poor network
performance? Despite many prior efforts on network QoS,
the Internet remains a best-effort network that provides no
guarantees of performance. Also, the popularly used tech-
nique of deploying “edge” proxies close to users for better
network performance does not cater to the client-to-client
communication pattern of audio calls. If the caller and callee
are in geographically distant locations, the VoIP application
has no choice but to communicate over the wide-area net-
work, which makes it challenging to meet the performance
requirements of the application.
In this context, we argue that it is timely to revisit the clas-
sical idea of overlay routing (e.g., [8, 33]), which has seen
well over a decade’s worth of research. Overlay networks
can improve performance by crafting paths that route around
bottlenecks in the default Internet paths (e.g., BGP-derived).
The adoption of overlay routing at scale has been stymied
for various reasons but perhaps the most important one is
the need to deploy the overlay infrastructure (relay nodes)
from scratch. Today, however, large cloud providers with
geographically distributed datacenters that are connected by
a “managed” backbone network provide the opportunity to
construct highly performant overlay alternatives to the de-
fault Internet path [25, 37].
Inspired by this opportunity, we envision a framework
called VIA, which can be viewed as an instance of a man-
aged overlay. VoIP calls can be selectively relayed over
managed overlay servers deployed by service providers. For
instance, Microsoft could choose to route (a subset of) Skype
trafﬁc through their managed network, and Google could do
likewise with Hangouts trafﬁc.
Indeed, Skype has moved
to a hybrid model where calls can be either relayed through
datacenters or through direct peer-to-peer path, and Hang-
out has started to use multi-hop relays in the cloud for many
calls in addition to the default Internet paths.
Managed overlays offer a pragmatic alternative to clas-
sical “user-deﬁned” overlays as the providers can carefully
provision the servers, decide which calls to relay, and con-
trol how the trafﬁc is routed over the overlay, thus ensur-
ing that the managed backbone network does not get turned
into a general-purpose conduit. Also, by tying the use of the
managed overlay to a widely-used application, trafﬁc from
the application itself could be used to learn about network
conditions passively, thereby obviating the need for active
probing whose overhead can be prohibitive at large scale.
We evaluate the potential of such relaying using trace-
driven analysis of the Skype dataset using their production
relays. We ﬁnd that an “oracle” that looks into the future
network performance and identiﬁes the best relay(s) can im-
prove 53% of calls whose quality is impacted by poor net-
work performance. (We derive thresholds for "poor network
performance" in §2.2.) We believe this is one of the largest
potential analyses of overlay routing in production.
Achieving this potential in practice, however, turns out to
be challenging. The signiﬁcant spatial and temporal variabil-
ity in network performance through various relaying alterna-
tives requires carefully tracking these dynamics. Also, op-
erators may prefer to not overload their managed backbone,
thus requiring our solution to function within a “budget” for
how much trafﬁc could be relayed.
VIA uses an approach called prediction-guided exploration
to decide which calls to relay and to pick the relay(s).
It
makes these decisions with performance information from
call history, which tends to be limited and highly skewed.
The key insight behind our approach is the empirical obser-
vation that even though available performance information
from call history may not sufﬁce to accurately predict the
best relay for each call, it can nevertheless help identify a
small subset of relay choices that contains the best relay.
Speciﬁcally, we use performance information from call
history to ﬁlter out all but the most promising (top-k) re-
laying alternatives, from which, we then employ an online
exploration-exploitation strategy to identify the optimal re-
lay path, while staying within the relaying budget. Prediction-
guided exploration, thus, strikes a balance between exploration-
based approaches which seeks to explore all possible choices,
and prediction-based approaches which attempt to predict
a single best choice from history information. In addition,
VIA also uses network tomography to expand the coverage
of prediction to paths that have not even been seen.
Trace-driven simulations show that VIA’s improvement in
call quality closely matches that of an oracle. VIA helps cut
the incidence of poor network conditions for calls by up to
45% (and for some countries and ASes by even over 80%)
We also implement a prototype of VIA with a cloud-based
controller and modiﬁed Skype clients, and deploy and evalu-
ate on a small testbed of 18 client pairs across ﬁve countries
for relaying calls through Skype’s managed relays.
Contributions: This paper makes three key contributions.
1. Analyzing the impact of network performance on In-
ternet telephony audio call quality at scale. (§2)
2. Quantifying the potential beneﬁts of a managed over-
lay network for improving audio call quality. (§3)
3. Highlighting the challenges in achieving these bene-
ﬁts and presenting a practical relay selection algorithm
that delivers close-to-optimal performance. (§4)
2 VoIP Performance in the Wild
In this section, we use call logs from Skype (described in
§2.1) to quantify the impact of network metrics on audio call
quality (§2.2), and the patterns of poor network performance
(§2.3 and §2.4). opportunities for improving network perfor-
mance and show why simple ﬁxes are not sufﬁcient. These
observations motivate the design requirements of VIA.
2.1 Dataset description
The dataset from Skype consists of a sampled set of 430 mil-
lion audio calls drawn from a seven month period. The sam-
pled set includes both calls that use the default path (e.g.,
BGP-derived) between the caller and the callee as well as
calls that are relayed through managed relay nodes distributed
across datacenters in different locations. Note that today
such relaying is typically employed for connectivity (e.g.,
Time
Calls
Users
ASes
Countries/regions
Table 1: Skype dataset summary.
2015.11.15−
2016.05.30
430M
135M
1.9K
126
(a) PCR vs. RTT
(b) PCR vs. Loss
(c) PCR vs. Jitter
Figure 1: Network performance metrics have consider-
able impact on user experience (poor call rate or PCR);
y-axis normalized to the maximum PCR. Vertical gray
lines show the thresholds for poor network performance.
ﬁrewall or NAT traversal) rather than for performance op-
timization (which is our focus here). That is, the only in-
stances of relaying in our passively collected dataset cor-
respond to the caller and callee being unable to establish
a direct connection. Despite this bias, the dataset offers a
panoramic view across diverse end-points from 1, 905 ASes
across 126 countries. Table 1 summarizes the statistics.
To the best of our knowledge, our work is the ﬁrst to study
the quality of Internet telephony calls at such a large scale.
There are several characteristics that make this dataset stand
out: a large fraction of calls are international (46.6%), inter-
AS (80.7%), and wireless (83%). These characteristics al-
low us to study the performance of Internet telephony over a
much greater diversity of Internet paths than has been con-
sidered in prior studies, where trafﬁc was mostly US-centric
(e.g., [7]) or conﬁned to server-client paths (e.g., [20]) or
academic sites (e.g., PlanetLab [28]).
Each call is associated with three metrics of network per-
formance: (i) round-trip time (RTT), (ii) loss rate, and (iii)
jitter. (We do not analyze bandwidth given the low data rate
typical of VoIP streams.) These network metrics are calcu-
lated by the Skype clients in accordance with the RTP spec-
iﬁcations [23] and correspond to the average value of each
metric over the entire duration of a call. (More detailed net-
work metrics such as transient latency spikes or loss bursts
are not reported.) To understand the characteristics of de-
fault Internet routing, this section focuses only on default-
routed (BGP-derived) calls while §3 considers relayed (i.e.,
overlay-routed) calls as well.
2.2 Call quality & Network performance
For a small random fraction of calls in Skype, users label
the call quality on a discrete 5-point scale, ranging from 1
(worst) to 5 (best). Consistent with the operational practice
in Skype, we deem the calls with a rating of 1 or 2 as “poor”,
and use the fraction of such calls, termed as the Poor Call
Rate (PCR), as an empirical metric of user experience. Be-
(a) RTT
(b) Loss
(c) Jitter
Figure 2: CDF of observed network performance met-
rics – RTT, loss rate, jitter. Vertical grey lines show the
thresholds for poor network performance.
sides PCR, prior work also has provided analytical models
to translate the network metrics into a measure of audio call
quality, called the Mean Opinion Score (MOS) (e.g., [17]).
In this section, we show that both PCR and MOS are well-
correlated with network metrics. Then, we identify suitable
thresholds for poor call performance on the network metrics
of RTT, loss and jitter. Since our goal is to understand the
impact of network performance metrics on call quality, the
thresholds keep our focus directly on these network metrics.