# Multi-Dimensional Range Query over Encrypted Data

**Authors:**
- Elaine Shi
- John Bethencourt
- T.-H. Hubert Chan
- Dawn Xiaodong Song
- Adrian Perrig

## Abstract
We introduce an encryption scheme, Multi-Dimensional Range Query over Encrypted Data (MRQED), to address privacy concerns in the sharing of network audit logs and other applications. Our scheme allows a network gateway to encrypt summaries of network flows before submitting them to an untrusted repository. When network intrusions are suspected, an authority can issue a key to an auditor, enabling the decryption of flows with specific attributes (e.g., source and destination addresses, port numbers) within certain ranges. The privacy of all irrelevant flows is preserved. We formally define the security for MRQED and prove its construction under the decision bilinear Difﬁe-Hellman and decision linear assumptions in certain bilinear groups. We also evaluate the practical performance of our scheme in the context of network audit logs. Additionally, MRQED has applications in financial audit logs, medical privacy, and untrusted remote storage. We show that MRQED implies a solution to its dual problem, allowing investors to trade stocks through a broker in a privacy-preserving manner.

## 1. Introduction
Recently, the network intrusion detection community has made significant efforts to collect network audit logs from various sites [25, 35, 24]. In this application, a network gateway or an Internet Service Provider (ISP) can submit network traces to an audit log repository. However, due to the presence of sensitive information in these traces, only authorized parties should be able to search the audit logs. We consider four types of entities: a gateway, an untrusted repository, an authority, and an auditor. We design a cryptographic primitive that allows the gateway to submit encrypted audit logs to the untrusted repository. Normally, no one can decrypt these logs. However, when malicious behavior is suspected, an auditor can request a search capability from the authority. With this capability, the auditor can decrypt entries that satisfy certain properties, such as network flows whose destination address and port number fall within a specific range, while preserving the privacy of all other flows. To avoid a central point of trust, multiple parties can jointly act as the authority, and only when a sufficient number of them collaborate can they generate a valid search capability.

### 1.1. Application to Network Audit Logs
Network audit logs are generated by firewalls and network intrusion detection systems (NIDS) like Snort [44], Emerald [40], and Bro [39]. These logs summarize detected or blocked activities suspected to be malicious, typically including fields such as source and destination IP addresses, ports, date and time, and protocol. Sharing these logs across organizations helps gain broader information about malicious activities on the Internet, but it is hampered by the presence of sensitive information. By encrypting each log entry before sending it to another party, the source can alleviate these concerns. Later, the source may release a decryption key for a specified set of log entries deemed relevant. For example, if a host with IP address \(a_1\) is determined to have been compromised at time \(t_1\) and later involved in scanning other hosts on a certain range of ports \([p_1, p_2]\), a trusted authority can release a key to decrypt any entries at time \(t\), with source address \(a\), connecting to port \(p\) such that \(t \geq t_1\), \(a = a_1\), and \(p_1 \leq p \leq p_2\). Using secure multi-party computation techniques [27], only when a sufficient number of parties collaborate can they generate a valid decryption key. This ensures precise guarantees about the privacy of the network while providing useful information to other organizations or a global monitoring effort.

### 1.2. Other Applications
Apart from network audit logs, MRQED has several other potential applications:

- **Financial Audit Logs:** Financial institutions can release audit logs in encrypted format. An authorized auditor can obtain a decryption key from a trusted authority to decrypt transactions suspected of fraudulent activities, while preserving the privacy of all other transactions.
  
- **Medical Privacy:** In a health monitoring program, a PDA or smartphone can deposit encrypted location and time data at a storage server. During an epidemic, a user can be alerted if they were present at a site during an incubation period, without leaking their trajectory if they were not at a disease-borne site.
  
- **Untrusted Remote Storage:** Users can store emails and files on a remote server, encrypted with multi-dimensional attributes. They can perform range queries and retrieve only the data that satisfies the queries.
  
- **Biometric-Based Anonymous IBE:** MRQED can be used in biometric-based Anonymous Identity-Based Encryption (AIBE). Personal data is encrypted using biometric features, and a user with the private key for identity \(X\) can decrypt data encrypted under \(X'\) if \(\|X - X'\|_\infty \leq \epsilon\).

## 2. Related Work
The problem of search on encrypted data (SoE) was introduced in the symmetric key setting by Song et al. [45] and has seen recent improvements in security definitions and efficiency [21]. Boneh et al. [10] proposed Public Key Encryption with Keyword Search (PEKS), where any party with the public key can encrypt, and the owner of the corresponding private key can generate keyword search capabilities. Both SoE and PEKS can be extended to support one-dimensional range queries, similar to the MRQED1 scheme described in Section 4.2. However, extending these schemes to multi-dimensional range queries is non-trivial.

## 3. Formal Definition and Security Model
We formally define the Multi-Dimensional Range Query over Encrypted Data (MRQED) problem and its security model. We then provide a detailed comparison between our scheme, MRQED, and the concurrent work by Boneh and Waters [13].

## 4. Initial Attempts and Novel Construction
In this section, we demonstrate some initial attempts at constructing MRQED and describe our novel construction, which is the main contribution of this paper. We also provide formal security proofs in the online technical report version [43], based on the hardness of the Decision Bilinear Difﬁe-Hellman and Decision Linear problems.

## 5. Practical Performance
We evaluate the practical performance of our scheme in the context of network audit logs and show that MRQED implies a solution to its dual problem, which is of particular interest to investors who wish to trade stocks through a broker in a privacy-preserving manner.

## 6. Conclusion
Our scheme, MRQED, provides a robust and efficient solution for multi-dimensional range queries over encrypted data, with applications in network audit logs, financial audit logs, medical privacy, and untrusted remote storage. We believe that MRQED will be a valuable tool for ensuring privacy and security in a wide range of applications.