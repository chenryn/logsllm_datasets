title:Multi-Dimensional Range Query over Encrypted Data
author:Elaine Shi and
John Bethencourt and
T.-H. Hubert Chan and
Dawn Xiaodong Song and
Adrian Perrig
Multi-Dimensional Range Query over Encrypted Data ∗
Elaine Shi
John Bethencourt T-H. Hubert Chan Dawn Song Adrian Perrig
Carnegie Mellon University
Abstract
We design an encryption scheme called Multi-dimensional
Range Query over Encrypted Data (MRQED), to address the
privacy concerns related to the sharing of network audit logs
and various other applications. Our scheme allows a network
gateway to encrypt summaries of network ﬂows before sub-
mitting them to an untrusted repository. When network intru-
sions are suspected, an authority can release a key to an au-
ditor, allowing the auditor to decrypt ﬂows whose attributes
(e.g., source and destination addresses, port numbers, etc.)
fall within speciﬁc ranges. However, the privacy of all irrele-
vant ﬂows are still preserved. We formally deﬁne the security
for MRQED and prove the security of our construction un-
der the decision bilinear Difﬁe-Hellman and decision linear
assumptions in certain bilinear groups. We study the practi-
cal performance of our construction in the context of network
audit logs. Apart from network audit logs, our scheme also
has interesting applications for ﬁnancial audit logs, medical
privacy, untrusted remote storage, etc. In particular, we show
that MRQED implies a solution to its dual problem, which en-
ables investors to trade stocks through a broker in a privacy-
preserving manner.
1 Introduction
Recently, the network intrusion detection community has
made large-scale efforts to collect network audit logs from
different sites [25, 35, 24]. In this application, a network gate-
way or an Internet Service Provider (ISP) can submit network
traces to an audit log repository. However, due to the pres-
ence of privacy sensitive information in the network traces,
the gateway will allow only authorized parties to search their
audit logs. We consider the following four types of entities: a
gateway, an untrusted repository, an authority, and an audi-
tor. We design a cryptographic primitive that allows the gate-
way to submit encrypted audit logs to the untrusted reposi-
tory. Normally, no one is able to decrypt these audit logs.
∗
This research was supported in part by CyLab at Carnegie Mellon under
grant DAAD19-02-1-0389 and Cyber-TA Research grant No. W911NF-06-
1-0316 from the Army Research Ofﬁce, and grants 0433540 and 0448452
from the National Science Foundation, and a grant from GM. The views
and conclusions contained here are those of the authors and should not be
interpreted as necessarily representing the ofﬁcial policies or endorsements,
either express or implied, of ARO, CMU, GM, NSF, or the U.S. Government
or any of its agencies.
However, when malicious behavior is suspected, an auditor
may ask the authority for a search capability. With this search
capability, the auditor can decrypt entries satisfying certain
properties, e.g., network ﬂows whose destination address and
port number fall within a certain range. However, the privacy
of all other ﬂows should still be preserved. Note that in prac-
tice, to avoid a central point of trust, we can have multiple
parties to jointly act as the authority. Only when a sufﬁcient
number of the parities collaborate, can they generate a valid
search capability.
We name our encryption scheme Multi-dimensional
Range Query over Encrypted Data (MRQED). In MRQED,
we encrypt a message with a set of attributes. For example, in
the network audit log application, the attributes are the ﬁelds
of a network ﬂow, e.g., source and destination addresses, port
numbers, time-stamp, protocol number, etc. Among these at-
tributes, suppose that we would like to support queries on the
time-stamp t, the source address a and the destination port
number p. Our encryption scheme provides the following
properties:
• Range query on attributes. An authority can issue a
decryption key for all ﬂows whose (t, a, p) falls within
t ∈ [t1, t2] and a ∈ [a1, a2] and
a certain range:
p ∈ [p1, p2]. Notice that range query implies equality
and greater-than (smaller-than) tests, e.g., t ≥ t1 and
a = a1 and p ≤ p1. With this decryption key, all ﬂows
whose (t, a, p) tuple falls within the above range can be
decrypted.
• Security requirement. Normally, no one can learn any
information from the ciphertexts. Under special circum-
stances, however, an auditor may obtain a decryption
key from an authority for some range t ∈ [t1, t2] and
a ∈ [a1, a2] and p ∈ [p1, p2]. For any ﬂow, if at least one
attribute among t, a, p lies outside the speciﬁed range,
the auditor fails to decrypt it. The auditor inevitably
learns that the (t, a, p) tuple of this ﬂow does not lie
within the given range. However, apart from this in-
formation, the auditor cannot learn anything more about
the ﬂow. For example, the auditor cannot learn anything
about attributes other than t, a, p; in addition, she cannot
decide whether t  t2, etc.
Our results and contributions. We are among the earliest
to study the problem of point encryption, range query, and
conditional decryption of matching entries. We propose a
provably secure encryption scheme that allows us to achieve
Authorized licensed use limited to: Tsinghua University. Downloaded on March 19,2021 at 02:54:17 UTC from IEEE Xplore.  Restrictions apply. 
2007 IEEE Symposium on Security and Privacy(SP'07)0-7695-2848-1/07 $20.00  © 2007Scheme
BonehWaters06 [13]
Naive AIBE-based scheme
Our scheme
Encrypt. Cost
Pub. Key Size
CT Size
O(D · T )
O(D · T )
O(D · T )
O((log T )D) O((log T )D)
O(1)
O(D · log T ) O(D · log T ) O(D · log T )
O(D)
O((log T )D)
O(D · log T )
Decrypt. Key Size Decrypt. Cost
O(D)
O((log T )D)
O((log T )D)
Security Model
MC
MR
MR
Table 1. Performance of different approaches. D denotes the number of dimensions and T the number of points in each.
The naive AIBE-based scheme is described in Section 4.3. MC and MR refer to the match-concealing and match-revealing
security models respectively as deﬁned in Section 3.
these properties. Table 1 summarizes the asymptotic perfor-
mance of our scheme in comparison with other approaches.
Please refer to Section 2 for a detailed comparison between
our scheme MRQED, and the concurrent work BonehWa-
ters06 [13]. We study the practical performance of MRQED,
and show that it makes the encrypted network audit log appli-
cation feasible. We also study the dual problem to MRQED,
where one encrypts under a hyper-range in multi-dimensional
space, and decrypts under a point. We show that MRQED im-
plies a solution to its dual problem, which enables investors to
trade stocks through a broker in a privacy-preserving manner.
Paper organization.
In the remainder of this section, we
give more example applications of MRQED. We review re-
lated work in Section 2, and formally deﬁne the MRQED
problem in Section 3.
In Section 4, we demonstrate some
initial attempts at constructing MRQED; while in Section 5,
we describe our novel construction which we consider the
main contribution of this paper. We note that the purpose
of Section 4 is not only to exhibit straw-man schemes, but
also to better motivate our design of MRQED as described
in Section 5. In particular, some of the primitives introduced
in Section 4 will later be used in Section 5 when we explain
our novel construction. Due to limit of space, formal security
proofs of security are provided in the online technical report
version [43]. In the proof, we borrow techniques from the
AHIBE scheme of Boyen and Waters [15]. As a result, the
security of our construction is likewise based on the hardness
of Decision Bilinear Difﬁe-Hellman problem and the Deci-
sion Linear problem. In Section 7, we consider the practical
performance of the scheme in the context of network audit
logs. We show that MRQED implies a solution to its dual
problem in Section 8, and show that the dual problem is of
particular interest to investors who would like to trade stocks
through a broker in a privacy-preserving manner.
1.1 Application to Network Audit Logs
We brieﬂy mentioned network audit logs at the beginning
of this section. Throughout the paper, we will keep using
this example to motivate the design of MRQED. To provide
context for the remainder of the paper, we now describe this
application in greater detail.
Firewalls and network intrusion detection systems (NIDS)
such as Snort [44], Emerald [40], and Bro [39] produce logs
summarizing detected or blocked activities suspected to be
malicious. Log entries typically correspond to either a sin-
gle packet (perhaps rejected by a ﬁrewall) or an established
ﬂow deemed suspicious. Each entry normally includes ﬁelds
such as source and destination IP address and port, date and
time, protocol (e.g., TCP, UDP, or ICMP), and, in the case
of NIDS, the type of rule causing an alert. Sharing and com-
paring such logs across organizations is a method for gaining
broader information about malicious activities on the Internet
so that administrators may better protect their systems. Cur-
rent large scale efforts to collect and aggregate network au-
dit logs for this purpose include DShield [25], myNetWatch-
man [35], and Deepsight [24].
However, sharing of network audit logs is hampered by the
presence of security and privacy sensitive information. By en-
crypting each log entry before sending it to another party, the
source can allay these concerns. Later, the source may release
a decryption key for a carefully speciﬁed set of log entries
deemed currently relevant. For example, suppose a particular
host with IP address a1 is determined to have been compro-
mised at time t1 and later involved in scanning other hosts for
vulnerabilities on a certain range of ports [p1, p2]. A trusted
authority may then choose to release a key decrypting any
entries at time t, with source address a, connecting to port p
such that t ≥ t1, a = a1, and p1 ≤ p ≤ p2. Note that to avoid
a central point of trust, we can have multiple parties jointly
act as the authority. Using techniques from secure multi-party
computation [27], only when a sufﬁcient number of them col-
laborate, can they generate a valid decryption key. The source
would then have precise guarantees about the privacy of their
network while providing useful information to other individ-
ual organizations or a global monitoring effort. The public
key nature of the scheme would allow distributed, encrypted
submissions to a central monitoring organization possessing
the master private key and giving out decryption keys as nec-
essary. There have been some previous attempts to protect
the security of audit logs through encryption or anonymiza-
tion while allowing limited queries [47, 23, 33], but in no
previous scheme has it been possible to issue keys for con-
junctions of ranges over multiple attributes while maintaining
the secrecy of the attributes. In particular, we are not aware of
any previous method supporting queries such as our example
of (t≥ t1) ∧ (a = a1) ∧ (p1 ≤ p≤ p2) that does not require
either revealing the attribute values or issuing an exponential
number of key components.
1.2 Other Applications
Apart from the network audit log application, and the
stock-trading application described in Section 8, we men-
tion here some other potentially interesting applications of
MRQED.
Financial audit logs. Financial audit logs contain sensi-
tive information about ﬁnancial transactions. Our MRQED
Authorized licensed use limited to: Tsinghua University. Downloaded on March 19,2021 at 02:54:17 UTC from IEEE Xplore.  Restrictions apply. 
2007 IEEE Symposium on Security and Privacy(SP'07)0-7695-2848-1/07 $20.00  © 2007scheme allows ﬁnancial institutions to release audit logs in
encrypted format. When necessary, an authorized auditor can
obtain a decryption key from a trusted authority. With this
decryption key, the auditor can decrypt certain transactions
that may be suspected of fraudulent activities. However, the
privacy of all other transactions are preserved.
Medical privacy. Consider a health monitoring program.
When Alice moves about in her daily life, a PDA or smart-
phone she carries automatically deposits encrypted crumbs of
her trajectory at a storage server. Assume that each crumb is
of the form ((x, y, t), ct), where (x, y) represents the loca-
tion, t represents time, and ct is Alice’s contact information.
During an outbreak of an epidemic, Alice wishes to be alerted
if she was present at a site borne with the disease during an
incubation period, i.e., if (x, y, t) falls within a certain range.
However, she is also concerned with privacy, and she does not
wish to leak her trajectory if she has not been to a site borne
with the disease.
Untrusted remote storage.
Individual users may wish to
store emails and ﬁles on a remote server, but because the stor-
age server is untrusted, the content must be encrypted before
it is stored at the remote server. Emails and ﬁles can be clas-
siﬁed with multi-dimensional attributes. Users may wish to
perform range queries and retrieve only data that satisfy the
queries.
Using biometrics in anonymous IBE. The MRQED scheme
can also be used in biometric-based Anonymous Identity-
Based Encryption (AIBE). Using biometrics in identity-based
encryption ﬁrst appeared in the work by Sahai and Wa-
ters [41]. In this application, a person’s biometric features
such as ﬁnger-prints, blood-type, year of birth, eye color, etc.,
are encoded as a point X in a multi-dimensional lattice. Per-
sonal data is encrypted using the owner’s biometric features
as the identity, and the encryption protects both the secrecy
of the personal data and the owner’s biometric identity. Due
to potential noise each time a person’s biometric features are
sampled, a user holding the private key for biometric identity
X should be allowed to decrypt data encrypted under X(cid:1)
, iff
X(cid:1)
and X have small distance. In particular, the SahaiWa-
ters04 construction [41] considered the set-overlap distance
(or the Hamming distance); and their encryption scheme does
not hide the identity of the user. Our construction allows a
user with the private key for identity X, to decrypt an en-
, iff (cid:1)∞(X, X(cid:1)) ≤ . Here (cid:1)∞ de-
try encrypted under X(cid:1)
notes the (cid:1)∞ distance between X and X(cid:1)
, and is deﬁned as
max{|x1 − x
D|}. In this case, the decryp-
1| , . . . ,|xD − x
(cid:1)
(cid:1)
tion region is a hyper-cube in multi-dimensional space. One
can also associate a different weight to each dimension, in
which case the decryption region becomes a hyper-rectangle.
2 Related Work
Search on encrypted data. The problem of search on en-
crypted data (SoE) was introduced in the symmetric key set-
ting by Song et al. [45] and has had some recent improve-
ments in security deﬁnitions and efﬁciency [21]. Boneh
that allow us to decide whether xd ≤ x
(cid:1)
et al. [10] later proposed Public Key Encryption with Key-
word Search (PEKS), in which any party possessing the pub-
lic key can encrypt and the owner of the corresponding pri-
vate key can generate keyword search capabilities. Both
SoE and PEKS can be trivially extended to support one-
dimensional range queries; the extension is similar to the
MRQED1 scheme described in Section 4.2. However, it is