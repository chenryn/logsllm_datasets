### 优化后的文本

#### 1. Embedding表示学习
在获得item序列后，第三步是进行Embedding表示学习。我们对原文中的SkipGram模型进行了两处优化：
1. **负样本采样**：针对超大规模的字典，采用负样本采样（Negative Sampling）替代Hierarchical Softmax分类器，大幅提高了训练速度。
2. **动态采样器**：在语言学中，词按照出现频率从大到小排序后，服从Zipfian分布（即log-uniform分布）。然而，我们的数据分析发现，item出现的频次与log-uniform分布并不完全吻合，并且不同时间段的数据间也呈现一定的波动趋势。为此，我们在训练过程中实时统计每个item的出现频次，维护一个能够根据item出现频次生成负样本的动态采样器。

#### 2. 行为序列数据处理
对于行为序列，短时间内的高密度点击更能反映用户的真实意图，短期的兴趣偏好也更为集中。相比之下，基于用户点击共现的传统协同过滤（CF）算法在数据层面会有更多的噪声。在实践中，准备行为序列数据时需要注意以下两点：
1. **时间窗口选择**：需要结合业务特点仔细调节行为序列的时间窗口。
2. **噪声点过滤**：通过停留时长和类目不相似度来过滤典型的异常点击。

#### 3. 转移概率连接图
为了克服用户真实session行为中存在的大量节点热点问题，我们提出并定义了新的转移概率连接图。以每个节点为中心，利用其扩散子节点的连接频次及行为共现频次计算转移概率，构建全网的转移概率连接图。在此基础上，通过DeepWalk随机采样，构造出千亿级别的多阶虚拟样本，用于后续的深度网络学习。

#### 4. 引入side-information
引入宝贝的side-information信息受到语言模型中sub-word概念的启发，类似于在word2vec中加入单词的词根、词缀等sub-word信息。我们认为某些具有相同词根词缀的单词在某些维度上具有相似的语义，同店、同品牌的宝贝也有一定的相关性。引入side-information后，i2i结果的头部精度得到提高，同店、同品牌的宝贝在排序中更为靠前。同时，对于一些没有出现行为的新鲜上架宝贝，根据其side-information进行embedding表达，有效解决了宝贝的冷启动问题。

#### 5. S3最终版本
引入side-information和sequence行为序列后，模型准确性大幅提升，但仍面临全网宝贝embedding参数空间太大、训练样本过多的问题（均在千亿量级以上）。为了解决这一问题，我们根据行为序列天然的转移概率重构全网宝贝的weighted directed Graph，再将整个网络切分成多个sub-graph，在每个sub-graph内部进行Graph Embedding训练，不同的sub-graph间并行训练，缩短训练迭代周期。

#### 6. 嵌入向量可视化
下图展示了我们的embedding高维向量降维后的直观解释。我们随机选取了运动鞋这个一级类目下的宝贝embedding向量进行降维，不同的颜色代表不同的叶子类目，每一个点代表一个商品降维后的坐标。可以清晰地看出，同一个类目下的宝贝embedding向量自然地聚在一起，说明这种聚类的本质是graph embedding的向量是可靠的。

#### 7. 双11之前的调优过程
在双11之前，我们在这项工作上进行了近两个月的迭代调优。期间尝试了多种不同的网络模型结构、样本选取过滤方式、引入sequential行为信息、转移概率边的全新构建方法以及side information等多种调优方法。在日常首页个性化（AIO）场景中，uctr对比swing版本i2i提升明显，双11在该场景全面替换了线上的最优召回方式。

### 2. 基于XTF的深度排序模型
#### 2.1 XTensorflow简介
2017年双十一，我们承接了手淘首页流量分发最大的几个首页场景。这些场景的特点是流量大、业务规则限制多、业务变动频繁。我们需要一个稳定、支持快速迭代和实时计算的机器学习平台来支撑我们训练模型及在线打分。为此，我们参与了工程团队的共建工作，基于Porsche blink的分布式Tensorflow训练及在线打分平台，开发出了若干Rank模型，并取得了不错的效果。我们将该平台称为XTensorflow，简称XTF。

在这个深度学习平台上，我们在双十一上线了包括DCN、DeepResNet等深层高阶特征学习模型，以及更加成熟应用了WDL深度模型。相对于WDL模型，更为复杂的深度模型也取得了显著效果。

#### 2.2 模型特点
- **DCN**：引入了cross network，通过网络层数控制特征交叉的阶数，并且实现高阶特征交叉所需的参数量远小于DNN。cross layer的定义比较简单，类似于ResNet的设计，l+1层的映射函数实际上是在拟合残差。cross network最终会和deep network进行联合学习。
- **WDL**：引入了wide侧，显式记忆一些可解释的特征交叉信息以保证模型的精准性，但带来了大量的特征工程工作，并且只能学习2阶浅层的交叉。

### 三、欢迎与我们交流
阿里巴巴推荐算法团队目前主要负责阿里电商平台（包括淘宝、天猫、海外版淘宝、Lazada等）的商品及feeds流推荐。其中，手机淘宝首图个性化、猜你喜欢、购买链路等场景每天服务数亿用户，涉及流量效率提升、用户体验、提高商家及达人参与淘宝的积极性，优化商业生态运行机制。

欢迎热爱算法、对业务有好奇心、有合作精神的同学一起工作、成长。简历可投递至以下邮箱：
- PI:EMAIL
- PI:EMAIL

### 四、引用
[1] DeepWalk: online learning of social representations. Bryan Perozzi, Rami Al-Rfou, Steven Skiena. Proceedings of the 20th ACM SIGKDD international conference on Knowledge discovery and data mining, 2014.
[2] node2vec: Scalable Feature Learning for Networks. A. Grover, J. Leskovec. ACM