# Active and Passive DNS Sibling Detection

## 3.3 Active DNS Siblings

The passive-DNS data set, collected over a six-month period, contains large equivalence classes as discussed in Section 4.3. To understand the results gathered over a much shorter time frame, we use the active DNS measurement technique described in §2.3. We first identify the open resolvers in the passive-DNS data set, finding 6,581 IPv4 and 2,658 IPv6 open resolvers. Each of these open resolvers is probed 32 times on September 14, 2012, requesting resolution for our special domain, which induces chains of lookups across IPv4 and IPv6 DNS glue. This yields a data set over a short period of about 2 hours, with the same set of nameservers being probed repeatedly.

Each 4-tuple (v4/v6/v4/v6) yields either 1, 2, or 4 (v4, v6) address pairs, depending on whether the two v4’s and two v6’s are the same. We then consider the marginal benefit of repeated active probing of the open resolvers. We examine those resolvers for which the 4-tuple is obtained at least 20 times and compute equivalence classes based on different amounts of probing.

### Figure 6: Equivalence Class Sizes
Figure 6 shows the percentage of addresses that are in equivalence classes of at least a given size, as a function of the number of probes. For example, with 32 probes, 15% of the addresses are in equivalence classes of size at least 15. The x-axis begins at 3, allowing one to infer the percentage of addresses in 1-1 equivalence classes. The y-intercept of 23% means that 77% of the addresses are in an equivalence class of size 2. The higher curves in the figure indicate that the equivalence classes are larger and more complex, with a heavier tail. The lowest curve represents the equivalence classes from the first probe, while subsequent curves show the results after the first two, five, ten, twenty, and all 32 probes. Increased sampling reveals additional nameservers, making the equivalence classes larger.

### Figure 7: Impact of AS Exclusion and Aggregation
Looking at the AS's of the nameservers in the set of 32 probes, we find that two AS's, AS 15169 (Google) and AS 6939 (Hurricane Electric), play a significant role in the complexity of the equivalence classes. Figure 7 examines the actively collected DNS siblings, showing the impact of excluding these AS's and/or aggregating to prefixes or AS's. The red (top) line is the same as in Figure 6. Removing the two AS's (the green line) significantly reduces the complexity. Aggregating addresses to prefixes (the dark blue and purple lines) further simplifies the equivalence classes. Lastly, when the addresses are aggregated to AS's (the light blue and dash-dot red lines), the resulting equivalence classes are even simpler. When AS 15169 and 6939 are included, one equivalence class of AS's is significantly larger, with a size of 51-20. Figure 8 shows the structure of this equivalence class, highlighting the dominant role of AS 15169 and the secondary role of AS 6939.

### 3.4 Active and Passive Validation
We examine the overlap between the nameserver pairs found by the active and passive techniques. Of the actively discovered address pairs, 75% are present within a single passively-discovered equivalence class. This overlap validates the correctness of both techniques, despite the large difference in data collection duration. To put this 75% value in perspective, we perform a similar calculation using partitions of the active-DNS data set. We consider sibling pairs received from open and forwarding resolvers that obtain at least twenty-five 4-tuples via the active technique. For each resolver, we temporally divide the received sibling pairs into bins. The first bin contains the first 10 sibling pairs, the second bin the next 10 pairs, and so on. We compare the address pair overlap between bins to determine the overall temporal consistency. We find an inter-bin consistency ranging from 75% to 77%, with a median value of 77%. Different partitions yield similar results, ranging from 65% to 85% with median values in the mid-70s. This consistency across multiple active probes over a short time span matches the consistency observed when comparing recent probes with the passive collection done over a six-month period.

### 3.5 Web Server Machine Siblings
We evaluate our TCP-based clock skew machine-sibling detection technique on the Alexa top 100,000 websites. For each website, we record the DNS A and any AAAA records on May 3, 2012. From the top 100,000 sites, we find 1398 (≈ 1.4%) with IPv6 DNS records. We then repeatedly probe each site via IPv4 and IPv6 using HTTP to fetch the root HTML page. Probing proceeds sequentially using deterministic addresses, with no DNS lookups during fetching. We conservatively use t = 1.0 degree in applying the method of §2.2.

Table 2 depicts the machine sibling inference for the 1398 Alexa sites. We identify 839 siblings (60.0%), 356 non-siblings (25.5%), and 210 possible siblings (14.5%). Two exceptions can cause our inference technique to fail: non-monotonic timestamps across TCP flows or the failure to negotiate the TCP timestamp option. A total of 195 sites (14.0%) did not negotiate timestamps for at least one of the addresses. If neither the IPv6 nor the IPv4 address supports timestamps, we can only weakly conclude that they are possible siblings. However, if one address supports timestamps and the other does not, they are positively non-siblings. Some TCP implementations, notably BSD-based, randomize the initial TCP timestamp values on a per-flow basis, leading to non-sibling inferences when one address presents randomized values and the other does not.

### Figure 9: Non-Siblings Example
Figure 9 presents an example where www.socialsecurity.gov is probed, and identical HTTP headers are received via both IPv4 and IPv6. However, the clock skew fingerprinting method suggests that the IPv4 and IPv6 addresses are not machine-siblings, implying that these addresses will not have correlated failures and will behave differently under attack.

### Origin AS Analysis
Among the inferred sibling and non-sibling populations, we examine the origin autonomous system (AS) of the routed prefixes to which the addresses belong. Of the 1398 websites, 246 (17.6%) have IPv4 and IPv6 addresses that reside in different ASes. 49 of 115 skew-based non-siblings (43%) are in different ASes, while 106 of 839 skew-based siblings (12.6%) are in different ASes. Many non-siblings in different ASes are due to content distribution network (CDN) effects. Manual investigation of siblings in different ASes reveals some that are different but related to the same organization. In future work, we plan to use AS-to-organization mappings to better understand these instances of divergent ASes between IPv4 and IPv6.