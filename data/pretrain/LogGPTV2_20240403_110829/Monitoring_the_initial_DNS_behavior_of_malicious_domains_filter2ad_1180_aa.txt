title:Monitoring the initial DNS behavior of malicious domains
author:Shuang Hao and
Nick Feamster and
Ramakant Pandrangi
Monitoring the Initial DNS Behavior of Malicious Domains
Shuang Hao
Georgia Tech
Nick Feamster
Georgia Tech
Ramakant Pandrangi
Verisign, Inc.
Atlanta, GA, USA
PI:EMAIL
Atlanta, GA, USA
PI:EMAIL
Dulles, VA, USA
PI:EMAIL
ABSTRACT
1.
INTRODUCTION
Attackers often use URLs to advertise scams or propagate mal-
ware. Because the reputation of a domain can be used to identify
malicious behavior, miscreants often register these domains “just
in time” before an attack. This paper explores the DNS behav-
ior of attack domains, as identiﬁed by appearance in a spam trap,
shortly after the domains were registered. We explore the behav-
ioral properties of these domains from two perspectives: (1) the
DNS infrastructure associated with the domain, as is observable
from the resource records; and (2) the DNS lookup patterns from
networks who are looking up the domains initially. Our analysis
yields many ﬁndings that may ultimately be useful for early de-
tection of malicious domains. By monitoring the infrastructure for
these malicious domains, we ﬁnd that about 55% of scam domains
occur in attacks at least one day after registration, suggesting the
potential for early discovery of malicious domains, solely based on
properties of the DNS infrastructure that resolves those domains.
We also ﬁnd that there are a few regions of IP address space that
host name servers and other types of servers for only malicious
domains. Malicious domains have resource records that are dis-
tributed more widely across IP address space, and they are more
quickly looked up by a variety of different networks. We also iden-
tify a set of “tainted” ASes that are used heavily by bad domains
to host resource records. The features we observe are often evident
before any attack even takes place; ultimately, they might serve as
the basis for a DNS-based early warning system for attacks.
Categories and Subject Descriptors
C.2.3 [Computer-Communication Networks]: Network Opera-
tions—Network monitoring; K.6.5 [Management of Computing
and Information Systems]: Security and Protection
General Terms
Measurement, Security
Keywords
DNS, Domain Registration, Spam, Malicious Domain
Permission to make digital or hard copies of all or part of this work for
personal or classroom use is granted without fee provided that copies are
not made or distributed for proﬁt or commercial advantage and that copies
bear this notice and the full citation on the ﬁrst page. To copy otherwise, to
republish, to post on servers or to redistribute to lists, requires prior speciﬁc
permission and/or a fee.
IMC’11, November 2–4, 2011, Berlin, Germany.
Copyright 2011 ACM 978-1-4503-1013-0/11/11 ...$10.00.
The Domain Name System (DNS), the Internet’s lookup service
for mapping names to IP addresses, provides a critical service for
Internet applications; unfortunately, it also allows attackers to di-
rect victims to Web sites that host scams, malware, and other ma-
licious content. To mitigate these threats, network operators try
to derive a reputation for each domain that reﬂects the likelihood
that the domain is associated with a particular type of attack (e.g.,
scam, phishing, malware hosting). The rate at which new domains
appear makes quickly developing a reputation for these domains
particularly challenging: in our analysis, we ﬁnd that over tens of
thousands of new domains are registered every day. Existing DNS
reputation systems use the characteristics of DNS lookups from re-
solvers that look up a domain to distinguish legitimate from mali-
cious domains [1, 2]. Unfortunately, these systems must observe a
signiﬁcant volume of DNS lookups before determining the reputa-
tion for a domain, which only occurs after compromise has taken
place.
Towards facilitating pre-attack detection of malicious domains,
we study the initial DNS activity for each domain and characterize
how the observable behavior for a malicious domain differs from
that of legitimate domains. We study two aspects of initial DNS
behavior associated with domains: (1) the DNS infrastructure used
to resolve the domains to IP addresses; and (2) the DNS lookup pat-
terns from the networks that perform initial lookups to the domain.
Certain characteristics of the DNS infrastructure may be unique to
malicious domains, such as the IP address ranges and ASes that
host either the authoritative name servers for the sites, or the sites
themselves. Identifying infrastructure that is common across mali-
cious domains may provide hints for identifying malicious domains
before the attacks themselves are mounted. Characteristics of early
DNS lookups can help network operators discover valuable infor-
mation about the nature of the domains that are being looked up.
Notably, we ﬁnd that domains that are registered for malicious pur-
poses are initially queried from a much more diverse set of subnets
than legitimate domains.
Our study of DNS behavior early in a domain’s life cycle is moti-
vated by our ultimate desire to perform early detection of malicious
domains. We use domains collected at several large spam traps as a
source of domains associated with spam campaigns. To character-
ize the resource record behavior of each domain, we perform peri-
odic iterative queries of newly registered domains in March 2011.
To characterize DNS lookup patterns across networks, we use in-
formation about DNS lookups collected from the Verisign top-level
domain servers, coupled with registration information about these
domains.
We focus exclusively on the early DNS behavior of a domain,
which is enabled by two important pieces of information. First,
269registration records alert us when a domain is registered, and allow
us to begin querying it immediately, before attacks. Second, we
study a global view of early DNS lookup patterns across the en-
tire Internet for .com and .net domains. Our study reveals the
following ﬁndings:
• Domain registration and resource record establishment hap-
pens before attacks take place. As many as 55% of spam
campaigns may occur at least one day after the domain ref-
erenced in the spam messages were registered, offering the
potential for early discovery of malicious domains based on
initial DNS behavior.
• DNS infrastructure for malicious domains is located in dif-
ferent address space regions and autonomous systems than
the infrastructure for legitimate domains. A few autonomous
systems and IP address regions host infrastructure only for
domains that are associated with malicious activity. Identify-
ing these at domain registration time can potentially enable
early detection.
• Early lookup patterns for a newly registered malicious do-
mains differ signiﬁcantly from the patterns for a legitimate
domain. Domains associated with spam campaigns are ini-
tially looked up by a more diverse set of network address
regions than legitimate domains. Especially, the newly reg-
istered spam domains become “popular” more quickly.
These features may ultimately be used to develop unique ﬁnger-
prints for distinguishing legitimate domains from those that are as-
sociated with Internet attacks.
The rest of this paper is organized as follows. Section 2 sur-
veys the problem context and related work. Section 3 describes the
data sets that we use for our analysis. Section 4 studies the char-
acteristics of resource records for newly registered legitimate and
malicious domains. Section 5 studies the lookup characteristics for
different types of domains, and Section 6 concludes.
2. CONTEXT AND RELATED WORK
We provide a brief overview of DNS records and lookups, as
well as an overview of recent DNS studies.
2.1 DNS Resource Records and Lookups
When an entity registers a DNS domain, domain name registries
insert several basic entries into the zone ﬁles to refer to the services
for the domain. NS records point to the authoritative name servers
for the zone, MX records point to the domain’s mail servers, and A
records point to the hosts. The NS and MX records can be further
resolved to IP addresses. A single domain is typically assigned
multiple server records for redundancy, but the number of IP ad-
dresses associated with the records is typically much less than the
number of the domains being registered.
In March 2011, three million second-level domains under .com
and .net were newly registered with NS records, but the number
of distinct IPs mapped from NS records was just 150 thousand; A
records and MX records have similar statistics. This observation in-
dicates that the same server has been repeatedly used by many dif-
ferent domains to host DNS infrastructure (e.g., the most “heavily”
used IP addresses carry NS records for around 300 scam domains).
Recursive DNS servers relay the users’ queries to the zone’s au-
thoritative servers to acquire resource records, which reduces DNS
trafﬁc in the wide area. Recursive servers commonly respond to
the hosts’ requests within their respective networks, so the set of
recursive servers querying for a domain can be a reasonable ap-
proximation for the networks that have attempted to reach the do-
main. The top-level domain (TLD) name servers thus provide a
natural vantage point for monitoring the lookups directed to the
second-level domains (the direct sub-domains below a TLD). Al-
though DNS caching prevents us from determining the volume of
lookups to a domain, the distribution of the recursive servers con-
tains rich information about which networks have issued lookups
for a domain; this statistic is particularly useful during the early
part of a domain’s life cycle, when it is initially registered and no
caching has yet taken place.
2.2 Related Work
Monitoring and analysis on zones’ resource records Previous
studies have used the mechanism of querying the DNS servers to
check the zones’ resource records. Holz et al.
investigated the
diversity of the A records returned in the lookups to identify fast-
ﬂux service networks [10]. Konte et al. studied the changing rates
of the IP address in the DNS records of scam domains [12]. Our
work, on the other hand, tracks DNS records of newly registered
domains to infer spatial and temporal characteristics. Anax scanned
the recursive servers to ﬁnd out anomaly in the cached records and
detect poisoning attacks [1]. In contrast, we monitor the records in
the zones’ authoritative servers to discover the characteristics in the
malicious domains’ registration.
DNS lookup patterns The ﬁrst studies of DNS lookup behavior
at a local resolver were performed by Danzig et al. [8] and Jung
et al. [11]; both of these studies examined lookup behavior from
the vantage point of lookups to a single local resolver, and did not
attempt to characterize how these lookup patterns differed for mali-
cious domains. Notos [2] and EXPOSURE [4] studied DNS lookup
behavior within a local domain below the DNS resolvers to build
the domains’ reputation. Such a view of DNS lookup behavior is
valuable, but this vantage point cannot reveal coordinated behav-
ior across multiple networks, and it relies ﬁrst on an attack to take
place or hosts being compromised before it can detect any mali-
cious domains. Antonakakis et al. also monitored the DNS trafﬁc
from authoritative servers or top-level domain servers to detect mal-
ware domains [3], but the zones’ dynamics were still reconstructed
from DNS request and response messages; they did not focus on
the behavioral analysis of newly registered domains. Other work
has examined DNS lookup behavior at a DNS root server [5–7].
The focus of these studies was different from this paper. Castro et
al. [7] and Brownlee et al. [6] attempted to characterize how much
DNS trafﬁc at the DNS root server was illegitimate. Broido et al.
identiﬁed misconﬁgured hosts using spectrography to identify ma-
chines that were mistakenly issuing automatically conﬁgured DNS
queries [5]. In contrast, we study DNS lookup patterns from the
perspective of a top-level domain, and examines the behavior of
lookups as seen from recursive resolvers, as opposed to lookups
from individual hosts.
Domain registration inference Recently, a number of research ef-
forts have studied domain registration patterns. Kreibich et al. [13]
investigated the time from a domain’s registration to its use in
spam. Spring et al. examined the delay between registration of
a malware domain and the ﬁrst successfully resolved response in
DNS trafﬁc [17]. We make a similar observation, but on a much
larger set of domains under .com and .net; further, we explore
the DNS characteristics in domains’ early life cycle. Felegyhazi et
al. [9] proposed to automatically identify malicious domains based
on WHOIS and name server information. In contrast, we actively
collect different types of resource records to track the changes, and
monitor the networks querying the domains. Some of the charac-
270type
DNZA entry
Query record
example
add-new example.com NS ns1.example.com
example.com 111.111.111.0 , 22.22.22.0
Table 1: Data format examples.
teristics that we observe about malicious domains could be used to
build efﬁcient dynamic reputation systems.
3. DATA COLLECTION
We describe our data and the process of probing for resource
records and correlating with spam messages.
DNS data The top-level domain servers are responsible for main-
taining the zone information (more speciﬁc, second-level domains)
and answer the queries for the registered domains. Verisign, Inc.
operates the generic top-level domains (gTLDs) for .com and
.net, which account for over 45% of registered domain names
on the Internet [16]. The servers maintain two kinds of dynamics
about the second-level domains. The ﬁrst type of information is
the Domain Name Zone Alert (DNZA). This information includes
changes about the zone, such as whether a domain name was newly
registered or a name server’s IP address was modiﬁed. The DNZA
ﬁles keep track of these changes.
The second type of information concerns the DNS queries issued
by the recursive servers. After the recursive servers sent queries
to the TLD name servers for resolving the second-level domains
names, Verisign’s systems aggregated the source IP addresses into
/24 subnets for logging and the TLD name servers recorded the
querying subnets each day. The query records show the rela-
tionship between the domain names and the queriers. Verisign
deploys multiple TLD name servers to resolve second-level do-
main names, and we collected the logs of querying /24s from all
servers for analysis. Table 1 shows the example format of each
type of data. The DNZA entry indicates that an “add-new” com-
mand created a new domain example.com and the NS record
was ns1.example.com; The query record means that there
were queries from /24s of “111.111.111.0” and “22.22.22.0” for
the domain. The DNZA ﬁles and the query data were collected at
Verisign’s .com and .net TLD name servers during the period of
March 2011. On average, about 80 million domains were queried
each day.
Resource records The DNZA entries with “add-new” commands
show what domains are newly registered. To get the new zone’s
resource records, we must perform active queries to their authority
servers, since the second-level domains’ records are not available
within the TLD name servers. After a second-level domain under
.com or .net is registered, we probe the domain once a day to
discover the resource records and the resolved IPs. As mentioned
in Section 2, we collect NS, MX and A records. We performed the
probing procedure during March 2011. For example, 190 thousand
domains were created on March 1, 2011; we continually queried
those domains over the next 30 days. At the end of March 2011,
we accumulated 4 million domains for monitoring. We use the
PlanetLab platform [14] to make it feasible to query a large set of
domains. Each PlanetLab node is responsible to query a subset
of domains, and deliver the collected information back to the cen-
tral monitor. Eventually, we deployed around 150 PlanetLab nodes
to perform the probing procedure throughout the month. Though
the daily querying does not capture all the changes in the resource
i
s
n
a
m
o
d
f
o
s
r
e
b
m
u
n
f
o
%
e
v
i
t
l
a
u
m
u
C
100
 80
 60
 40
 20
  0
0
5
10
15
20
25
Days
Figure 1: Days between a malicious domain’s registration (in
March 2011) and the time when the domain showed up in spam.
records, it continually tracks the “snapshots” of DNS infrastructure
and implies the change trends.
Spamming Scam domains appearing in spam messages are the ma-
jor targets in our study, since timestamps in each email help explic-
itly identify when the spamming activities occurred, and spam is
related to many different attacks, such as phishing. We used spam
trap to capture emails sent from spammers during March 2011.
Because the domains for the spam trap have no legitimate email
addresses, emails received at the mail server were all spam. The
second-level domains appearing in the messages’ URLs were ex-
tracted as being involved in spamming activities (overall, 40% of
unique second-level domains were found under .com and .net).
In the context of this paper, we use “scam domains” and “mali-
cious domains” interchangeably to refer to the second-level do-
mains identiﬁed being associated with spam. From spam traps, we
identiﬁed 2, 045 scam domains as newly registered during March
2011. We also checked the domains with Spamhaus [15], and iden-
tiﬁed 4, 587 blacklisted second-level domains. The union of these
two sets yielded a total of 5, 988 .com and .net second-level do-
mains that we considered spamming-related.
To obtain a representative set of legitimate domains for compari-
son, we sampled 6, 000 domains registered during March 2011 that
have not yet appeared in any blacklist.
4. REGISTRATION & RESOURCE RECORDS
We ﬁrst check the time between the registration of a domain
and the subsequent attack to investigate the potential for early de-
tection. Then, we explore how DNS behavior associated with
infrastructure—where a domain’s resolvers initially reside—can be
an early signal for malicious domains.
4.1 Time Between Registration and Attack