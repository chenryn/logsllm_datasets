在收到EHRs管理器的事务（msg.sender =
ME）后，管理员会根据其在智能合约的政策列表中的PK来验证该请求。如果PK在列表中可用，则请求被接受，立刻向请求者授予数据访问权限。否则，智能合约将通过惩罚()函数发出惩罚，从区块链网络中丢弃这个请求。
**_第3步：EHRs检索（由管理员执行）_**
一旦授予权限，合同将使用 _abiDecoder:decodeMethod(Tx)_
函数对事务进行解码，以获取交易数据字段中EHRs的地址信息（见第二节）。现在，管理员可以知道请求的区域ID和患者ID，然后将其转发给EHRs管理器，以便从IPFS[14]中检索数据。
**_第4步：数据反馈（由EHRs管理器执行）_**
一旦找到所要求的数据，EHRs管理器会将把它发送给请求者。现在分享完毕，一个新的事务会被添加到区块链上，并播发给网络用户。需要注意的是，这类事务中的数据主要是患者地址，这些地址在区块链上的存储是轻量级的，也是高效的。算法1显示了我们的共享协议，其源代码可以在我们近期的工作中获得[14]。
## 参考文献
[1] S. M. Riazul Islam et al., ”The Internet of Things for Health Care: A
Comprehensive Survey,” _IEEE Access_ , vol. 3, pp. 678-708, 2015.
[2] Guo, Hao, et al., ”Attribute-based Multi-Signature and Encryption for EHR
Management: A Blockchain-based Solution,” in _2020 IEEE International
Conference on Blockchain and Cryptocurrency (ICBC)_ , pp. 1-5, 2020.
[3] Dinh C. Nguyen et al., ”A mobile cloud based IoMT framework for automated
health assessment and management,” in _41st Conference of the IEEE Engineering
in Medicine & Biology Society (EMBC)_, 2019.
[4] M. Asif-Ur-Rahman et al., ”Towards a heterogeneous mist, fog, and cloud
basedframework for the internet of healthcare things,” _IEEE Internet of
Things Journal_ , vol.6, pp. 4049-4062, 2018.
[5] R. Saha et al., ”Privacy ensured e-healthcare for fog-enhanced IoT
basedapplications,” _IEEE Access_ , vol. 7, pp. 44 536-44 543, 2019.
[6] H. Wu et al., ”Mobile healthcare systems with multi-cloud offlfloading,”
in _IEEE Int. Conf. on Mobile Data Management_ , vol. 2, 2013, pp. 188-193.
[7] Navaz et al. ”Towards an effificient and Energy-Aware mobile big health
data architecture.” _Comput. methods and programs in bio._ , 2018.
[8] R. M. Abdelmoneem et al., ”A cloud-fog based architecture for IoT
applications dedicated to healthcare,” in _IEEE ICC_ , 2019, pp. 1-6.
[9] D. Giri et al., ”Sechealth: An effificient fog based sender initiated
secure data transmission of healthcare sensors for e-medical system,” in _IEEE
Global Communications Conference_ , 2017, pp. 1-6.
[10] M. Min et al., ”Learning-based privacy-aware offlfloading for healthcare
IoT with energy harvesting,” _IEEE Internet of Things Journal_ , vol. 6, pp.
4307-4316, 2018.
[11] J. Liu et al., ”BPDS: A blockchain based privacy-preserving data sharing
for electronic medical records,” in _IEEE GLOBECOM_ , 2018, pp. 1-6.
[12] H. Guo et al., ”Access control for electronic health records with
hybridblockchain-edge architecture,” in _IEEE Int. Conf. on Blockchain_ ,
2019.
[13] S. Wang al., ”A blockchain-based framework for data sharing with
fifinegrained access control in decentralized storage systems,” _IEEE Access_
, vol. 6, pp.38437-38450, 2018.
[14] Dinh C. Nguyen et al., ”Blockchain for secure EHRs sharing of mobile
cloud based e-health systems,” _IEEE Access_ , pp. 66792-66806, 2019.
[15] M. T. de Oliveira et al., ”Towards a blockchain-based secure electronic
medical record for healthcare applications,” in _IEEE ICC_ , 2019.
[16] Dinh C. Nguyen et al., ”Privacy-preserved task offlfloading in mobile
blockchain with deep reinforcement learning,” _IEEE Transactions on Network
and ServiceManagement_ , 2020, in press.
[17] Sigwele, Tshiamo, et al. ”Intelligent and energy effificient mobile
smartphone gateway for healthcare smart devices based on 5G” in _IEEE Global
CommunicationsConference (GLOBECOM)_ , 2018..
[18] I. Elgendy et al., ”An effificient and secured framework for mobile
cloudcomputing,” _IEEE Transactions on Cloud Computing_ , 2018.
[19] W.-T. Sung and Y.-C. Chiang, ”Improved particle swarm optimization
algorithm for android medical care IoT using modifified parameters,” _Journal
of medical systems_ , vol. 36, no. 6, pp. 3755-3763, 2012.
[20] AWS Lambda with Cloud Front Lambda Edge Services [Online].
Available:https://aws.amazon.com/lambda/edge/.
[21] Firebase Performance Monitoring – Google [Online]. Available:
https://fifirebase.google.com/docs/perf-mon.