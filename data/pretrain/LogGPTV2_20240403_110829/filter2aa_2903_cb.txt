版本
产品编号
厂商
ID
1 整 个 代 码
Vcc 产品
类型
Generation（第
几代）
型号
长度
4
1
6
4
5
11
1 32
二进
制
XXXX 0
000001 0110
00011 00011 1 XXXX300000101100
0011000000010011
十六
进制
X
0
01
6
03
09
1 X02c3013
7.4.2 探测模式
下面介绍IA-32处理器的探测模式（Probe Mode）。探测模式是专
门用于调试的一种处理器内部模式。与实模式和保护模式这些软件可以
控制的操作模式不同，只有通过专门的管脚信号和边界扫描寄存器才可
以访问探测模式。在探测模式下，CPU中断正常的操作，从外部看就好
像处于休眠的状态，但通过调试工具可以与其通信，分析并修改系统的
状态，包括内存、I/O空间和各种寄存器。以奔腾处理器为例，调试工
具可以通过将R/S#管脚信号置低电平要求处理器进入探测模式。当处理
器检测到该信号后，完成正在执行的指令后，便停止执行下一条指令
（freeze on next instruction boundary），并设置PRDY（Probe Ready）信
号。调试工具发现PRDY信号后，便可以通过JTAG协议向目标处理器发
送各种调试命令和数据了，比如观察内存、设置断点等。在调试工具完
成设置后，可以通过解除R/S#信号（恢复其高电平）使处理器退出探测
模式，恢复执行原来的程序。
从实现角度来看，探测模式是通过扩展JTAG标准实现的，包括增
加TAP寄存器、TAP指令和管脚信号。
可能是为了避免混淆，英特尔的各种文档没有系统地介绍探测模
式。通常是用进入“空闲状态”等词语一带而过。但从调试的角度分析，
CPU此时是在另一种模式下工作着的。
7.4.3 ITP接口
为了更好地调试基于IA-32处理器设计的主板和系统，英特尔定义
了3种调试接口用以和集成在处理器中的调试功能通信。这3种接口是：
ITP（30针）、ITP700（25针）和XDP（60 pin）。
ITP是In-Target Probe的缩写，意思是目标内探测器。下面我们详细
介绍曾经广泛使用过的ITP700接口。
ITP700是一个 25针（pin）的接口（见图7-6），主要包含3类信
号，即JTAG信号、系统信号和执行信号。JTAG信号即IEEE 1149.1中定
义的标准信号。系统信号用来指示整个系统的状态。执行信号用来控制
目标处理器的执行和复位。
图7-6 ITP700接口示意图
表7-4列出并解释了ITP700接口的各个信号，其中第3列给出的输入
和输出方向是相对于ITP工具的。
表7-4 ITP信号说明
信  号
编号
输
入/
输
出
描  述
PWR
22
输
入
目标系统的电源。ITP工具可以用来：①判断目标系统的
电源是否稳定；②用作产生BPM[5:0]#和RESET#信号时
的参考电压；③与DBA#信号一起用于仲裁（arbitrate）边
界扫描链的使用权
BCLK（p/n） 19/21 输
入
目标系统的差分驱动总线信号。用于采样执行信号等
DBA#
（Debug Port
Active）
4
输
出
指示调试端口是否活动（active）。ITP使用该信号表示它
正在使用目标系统的TAP接口
DBR#
（Debug Port
Reset）
6
输
出
复位调试端口。ITP可以使用该信号来复位目标系统
FBI
18
输
出
TAP主时钟（master clock）的另一个来源。对于大多数
ITP实现，该信号都是可选的，因为通常都使用TCK作为
TAP的主时钟
FBO
17
输
入
是TCK的回馈
TCK
16
输
出
TAP主时钟的标准来源。如果FBI被用为主时钟信号，那
么ITP工具可以不提供TCK
TDI
10
输
出
TAP的数据输入信号。ITP工具通过该信号向目标系统发
送数据
TDO
24
输
入
TAP的数据输出信号。ITP工具通过该信号从目标系统接
收数据
TMS
12
输
TAP状态管理信号
TMS
12
输
出
TAP状态管理信号
TRST# （Test
Reset）
14
输
出
测试逻辑复位信号
BPM[5:0]#
13、
11、
9、
7、
5、3
输
入
来自目标系统的断点信号。BPM[3:0]#用来表示对应的调
试寄存器断点被触发（或对应的性能计数器溢出，依赖于
DebugCtl寄存器） BPM4#相当于奔腾处理器的PRDY信
号，目标CPU用以回应ITP工具的探测请求（Probe
Request），通知ITP工具已经进入探测模式，可以接受各
种调试命令了 BPM5#应该与BPM5DR短接，因此没有独
立功能
RESET#
15
输
入
来自目标系统的复位信号
BPM5DR#
23
输
出
相当于PREQ（Probe Request）信号，ITP工具用之请求对
目标处理器的控制权
参考资料[5]更详细地介绍了ITP700端口的细节以及设计中应该注意
的问题。
7.4.4 XDP端口
XDP是eXtended Debug Port的缩写，意思是扩展的调试端口。ITP所
包含的信号是XDP的一个子集，因此可以通过一个转接头将XDP端口转
为ITP。
简单来说，XDP是一个图7-7所示的接头，共有60针，除了JTAG标
准中定义的信号外，还包括很多实现扩展功能的信号。与ITP相比，尽
管XDP的信号数量更多，但是由于设计不同，它占用的主板空间更小。
图7-7 XDP端口
市场上销售的大多数主板并没有安装XDP端口，但是在其背面（不
安装零件的一面）通常留有一组焊点，可以焊接上称为XDP-
SSA（Second Side Attach）的调试端口。XDP-SSA共有31个信号，是
XDP的一个子集，因此不再具有XDP的某些增强功能。通常处于开发阶
段的主板才带有完整的XDP调试端口。
参考资料[6]详细介绍了XDP端口的所有信号及功能。
7.4.5 ITP-XDP调试仪
有几家公司生产和开发IA平台的JTAG调试器，除了英特尔公司
外，著名的还有Arium（合并到Asset Intertech）和劳特巴赫
（Lauterbach）。
完整的JTAG调试器一般分为硬件和软件两个部分。为了避免引起
歧义，本书把硬件部分称为JTAG调试仪。图7-8所示的是英特尔公司的
JTAG调试仪，名叫ITP-XDP，常常简称为ITP。
图7-8 英特尔公司的JTAG调试仪
在很长一段时间里，ITP是很敏感的秘密武器。即使是英特尔的内
部员工，也要特别申请才可走内部流程购买（内部价格500美元）。如
果要带出公司使用，还需要上级审批。大约从2011年开始，英特尔逐步
放宽了ITP的适用范围，先是允许一些外部合作伙伴购买和使用，后来
在官网上明码标价出售（单价3000美元，软件需另外购买）。