# Title: A Comparison of Overlay Routing and Multihoming Route Control

## Authors
- Aditya Akella, Carnegie Mellon University (aditya@cmu.edu)
- Jeffrey Pang, Carnegie Mellon University (jeffpang@cmu.edu)
- Bruce M. Maggs, Carnegie Mellon University and Akamai Technologies (bruce@cmu.edu)
- Srinivasan Seshan, Carnegie Mellon University (srini@cmu.edu)
- Anees Shaikh, IBM T.J. Watson Research Center (anees@us.ibm.com)

## Abstract
The limitations of BGP routing in the Internet are often blamed for poor end-to-end performance and prolonged connectivity interruptions. Recent work advocates using overlays to effectively bypass BGP’s path selection to improve performance and fault tolerance. In this paper, we explore the possibility that intelligent control of BGP routes, coupled with ISP multihoming, can provide competitive end-to-end performance and reliability. Using extensive measurements of paths between nodes in a large content distribution network, we compare the relative benefits of overlay routing and multihoming route control in terms of round-trip latency, TCP connection throughput, and path availability. We observe that the performance achieved by route control together with 3-multihoming is within 5-15% of overlay routing employed in conjunction with 3-multihoming, in terms of both end-to-end RTT and throughput. We also show that while multihoming cannot offer the nearly perfect resilience of overlays, it can eliminate almost all failures experienced by a singly-homed end-network. Our results demonstrate that, by leveraging the capability of multihoming route control, it is not necessary to circumvent BGP routing to extract good wide-area performance and availability from the existing routing system.

## Categories and Subject Descriptors
C.2 [Computer Systems Organization]: Computer-Communication Networks; C.2.1 [Computer-Communication Networks]: Network Architecture and Design

## General Terms
Measurement, Performance, Reliability

## Keywords
Multihoming, Route Control, Overlay Routing

## Acknowledgments
This work was supported by the Army Research Office under grant number DAAD19-02-1-0389. Additional support was provided by IBM.

Permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page. To copy otherwise, to republish, to post on servers or to redistribute to lists, requires prior specific permission and/or a fee.

SIGCOMM’04, Aug. 30–Sept. 3, 2004, Portland, Oregon, USA.
Copyright 2004 ACM 1-58113-862-8/04/0008 ...$5.00.

## 1. Introduction
The limitations of conventional Internet routing based on the Border Gateway Protocol (BGP) are often held responsible for failures and poor performance of end-to-end transfers. Studies have shown that the underlying connectivity of the Internet is capable of providing much greater performance and resilience than end-points currently receive. For example, Detour [25, 26] and RON [6] demonstrate that using overlay routing to bypass BGP’s policy-driven routing enables quicker reaction to failures and improved end-to-end performance.

In this paper, we question whether overlay routing is required to make the most of the underlying connectivity, or whether better selection of BGP routes at an end-point is sufficient. There are two key factors contributing to the differences between overlay routing and BGP-based routing that have not been carefully evaluated in past work: the number of routing choices available to each system and the policies used to select among these routes.

### Route Availability
By allowing sources to specify a set of intermediate hops, overlay routing allows end-points nearly arbitrary control over the wide-area path that packets take. On the other hand, BGP only allows a network to announce routes that it actually uses. Thus, to reach a given destination, an end-point has access to only a single path from each Internet Service Provider (ISP) to which it is attached [30]. As a result, an end-point’s ability to control routing is tightly linked to the number of ISP connections it has.

Past studies showing the relative benefits of overlay routing draw conclusions based on the highly restrictive case wherein paths from just a single ISP are available [6, 25]. In contrast, in this paper, we carefully consider the degree of ISP multihoming at the end-point and whether it provides sufficient BGP route choices for the end-point to obtain the same performance as when employing an overlay network.

### Route Selection
In addition to having a greater selection of routes to choose from than BGP, overlay routing systems use much more sophisticated policies in choosing the route for any particular transfer. Overlays choose routes that optimize end-to-end performance metrics, such as latency. On the other hand, BGP employs simpler heuristics to select routes, such as minimizing AS hop count or cost. However, this route selection policy is not intrinsic to BGP-based routing—given an adequate selection of BGP routes, end-points can choose the one that results in the best performance, availability, or cost. Several commercial vendors already enable such route control or selection (e.g., [19, 21, 24]).

In this paper, we compare overlays with end-point based mechanisms that use this form of “intelligent” route control of the BGP paths provided by their ISPs. Hereafter, we refer to this as multihoming route control or simply, route control. Notice that we do not assume any changes or improvements to the underlying BGP protocol. Multihoming route control simply allows a multihomed end-network to intelligently schedule its transfers over multiple ISP links in order to optimize performance, availability, cost, or a combination of these metrics.

Our goal is to answer the question: How much benefit does overlay routing provide over BGP, when multihoming and route control are considered? If the benefit is small, then BGP path selection is not as inferior as it is held to be, and good end-to-end performance and reliability are achievable even when operating completely within standard Internet routing. On the other hand, if overlays yield significantly better performance and reliability characteristics, we have further confirmation of the claim that BGP is fundamentally limited. Then, it is crucial to develop alternate bypass architectures such as overlay routing.

Using extensive active downloads and traceroutes between 68 servers belonging to a large content distribution network (CDN), we compare multihoming route control and overlay routing in terms of three key metrics: round-trip delay, throughput, and availability. Our results suggest that when route control is employed along with multihoming, it can offer performance similar to overlays in terms of round-trip delay and throughput. On average, the round-trip times achieved by the best BGP paths (selected by an ideal route control mechanism using 3 ISPs) are within 5–15% of the best overlay paths (selected by an ideal overlay routing scheme also multihomed to 3 ISPs). Similarly, the throughput on the best overlay paths is only 1–10% better than the best BGP paths. We also show that the marginal difference in the RTT performance can be attributed mainly to overlay routing’s ability to select shorter paths, and that this difference can be reduced further if ISPs implement cooperative peering policies. In comparing the end-to-end path availability provided by either approach, we show that multihoming route control, like overlay routing, is able to significantly improve the availability of end-to-end paths.

This paper is structured as follows. In Section 2, we describe past work that demonstrates limitations in the current routing system, including work on overlay routing and ISP multihoming. Section 3 provides an overview of our approach. Section 4 gives details of our measurement testbed. In Section 5, we analyze the RTT and throughput performance differences between route control and overlay routing and consider some possible reasons for the differences. In Section 6, we contrast the end-to-end availability offered by the two schemes. Section 7 discusses the implications of our results and presents some limitations of our approach. Finally, Section 8 summarizes the contributions of the paper.

## 2. Related Work
Past studies have identified and analyzed several shortcomings in the design and operation of BGP, including route convergence behavior [16, 17] and “inflation” of end-to-end paths due to BGP policies [28, 32]. Particularly relevant to our study are proposals for overlay systems to bypass BGP routing to improve performance and fault tolerance, such as Detour [25] and RON [6].

In the Detour work, Savage et al. [25] study the inefficiencies of wide-area routing on end-to-end performance in terms of round-trip time, loss rate, and throughput. Using observations drawn from active measurements between public traceroute server nodes, they compare the performance on default Internet (BGP) paths with the potential performance from using alternate paths. This work shows that for a large fraction of default paths measured, there are alternate indirect paths offering much better performance.

Andersen et al. propose Resilient Overlay Networks (RONs) to address the problems with BGP’s fault recovery times, which have been shown to be on the order of tens of minutes in some cases [6]. RON nodes regularly monitor the quality and availability of paths to each other and use this information to dynamically select direct or indirect end-to-end paths. RON mechanisms are shown to significantly improve the availability and performance of end-to-end paths between the overlay nodes. The premise of the Detour and RON studies is that BGP-based route selection is fundamentally limited in its ability to improve performance and react quickly to path failures. Both Detour and RON compare the performance and resilience of overlay paths against default paths via a single provider. Overlays offer a greater choice of end-to-end routes, as well as greater flexibility in controlling the route selection. In contrast, we explore the effectiveness of empowering BGP-based route selection with intelligent route control at multihomed end-networks in improving end-to-end availability and performance relative to overlay routing.

Additionally, several past studies have focused on “performance-aware” routing, albeit not from an end-to-end perspective. Proposals have been made for load-sensitive routing within ISPs (see [27], for example) and intra- and inter-domain traffic engineering [10, 23, 15]. However, the focus of these studies is on balancing the utilization on ISP links and not necessarily on end-to-end performance. More directly related to our work is a recent study on the potential of multihoming route control to improve end-to-end performance and resilience relative to using paths through a single ISP [3]. Finally, a number of vendors have recently developed intelligent routing appliances that monitor availability and performance over multiple ISP links and automatically switch traffic to the best provider. These products facilitate very fine-grained selection of end-to-end multihoming routes (e.g., [8, 19, 21, 24]).

## 3. Comparing BGP Paths with Overlay Routing
Our objective is to understand whether the modest flexibility of multihoming, coupled with route control, is able to offer end-to-end performance and resilience similar to overlay routing. To answer this question, we evaluate an idealized form of multihoming route control where the end-network has instantaneous knowledge about the performance and availability of routes via each of its ISPs for any transfer. We also assume that the end-network can switch between candidate paths to any destination as often as desired. Finally, we assume that the end-network can easily control the ISP link traversed by packets destined for its network (referred to as “inbound control”).

In a real implementation of multihoming route control, however, there are practical limitations on the ability of an end-network to track ISP performance, on the rate at which it can switch paths, and on the extent of control over incoming packets. However, recent work [4] shows that simple active and passive measurement-based schemes can be employed to obtain near-optimal availability, and RTT performance that is within 5-10% of the optimal, in practical multihomed environments. Also, simple NAT-based techniques can be employed to achieve inbound route control [4].

To ensure a fair comparison, we study a similarly agile form of overlay routing where the end-point has timely and accurate knowledge of the best performing, or most available, end-to-end overlay paths. Frequent active probing of each overlay link makes it possible to select and switch to the best overlay path at almost any instant when the size of the overlay network is small (≤50 nodes)1. We compare overlay routing and route control with respect to the degree of flexibility available at the end-network. In general, this flexibility is represented by k, the number of ISPs available to either technique at the end-network. In the case of route control, we consider k-multihoming, where we evaluate the performance and reliability of end-to-end candidate paths induced by a combination of k ISPs. For overlay routing, we introduce the notion of k-overlays, where k is the number of providers available to an endpoint for any end-to-end overlay path. In other words, this is simply overlay routing in the presence of k ISP connections.

When comparing k-multihoming with k-overlays, we report results based on the combination of k ISPs that gives the best performance (RTT or throughput) across all destinations. In practice, an end-network cannot purchase connectivity from all available providers, or easily know which combination of ISPs will provide the best performance. Rather, our results demonstrate how much flexibility is necessary, in terms of the number of ISP connections, and the maximum benefit afforded by this flexibility.

Figure 1 illustrates some possible route control and overlay configurations. For example, (a) shows the case of conventional BGP routing with a single default provider (i.e., 1-multihoming). Figure 1(b) depicts end-point route control with three ISPs (i.e., 3-multihoming). Overlay routing with a single first-hop provider (i.e., 1-overlay) is shown in Figure 1(c), and Figure 1(d) shows the case of additional first-hop flexibility in a 3-overlay routing configuration.

We seek to answer the following key questions:
1. On what fraction of end-to-end paths does overlay routing outperform multihoming route control in terms of RTT and throughput? In these cases, what is the extent of the performance difference?
2. What are the reasons for the performance differences? For example, must overlay paths violate inter-domain routing policies to achieve good end-to-end performance?
3. Does route control, when supplied with sufficient flexibility in the number of ISPs, achieve path availability rates that are comparable with overlay routing?

## 4. Measurement Testbed
Addressing the questions posed in Section 3 from the perspective of an end-network requires an infrastructure that provides access to a number of BGP path choices via multihomed connectivity and the ability to select among those paths at a fine granularity. We also require an overlay network with a reasonably wide deployment to provide a good choice of arbitrary wide-area end-to-end paths that could potentially bypass BGP policies.

We address both requirements with a single measurement testbed consisting of nodes belonging to the server infrastructure of the Akamai CDN. Following a similar methodology to that described in [3], we emulate a multihoming scenario by selecting a few nodes in a metropolitan area, each singly-homed to a different ISP, and use them collectively as a stand-in for a multihomed network. Relative to previous overlay routing studies [25, 6], our testbed is larger with 68 nodes. Additionally, since the nodes are all connected to commercial ISPs, they avoid paths that traverse Internet2, which may introduce unwanted bias due to their higher bandwidth and lower likelihood of queuing compared to typical Internet paths. Our measurements are confined to nodes located in the U.S., though we do sample paths traversing ISPs at all levels of the Internet hierarchy from vantage points in many major U.S. metropolitan areas.

The 68 nodes in our testbed span 17 U.S. cities, averaging about four nodes per city, connected to commercial ISPs of various sizes. The nodes are chosen to avoid multiple servers attached to the same provider in a given city. The list of cities and the tiers of the corresponding ISPs are shown in Figure 2(a). The tiers of the ISPs are derived from the work in [31]. The geographic distribution of the testbed nodes is illustrated in Figure 2(b). We emulate multihomed networks in 9 of the 17 metropolitan areas where there are at least 3 providers—Atlanta, Bay Area, Boston, Chicago, Dallas, Los Angeles, New York, Seattle, and Washington D.C.

## 5. Latency and Throughput Performance
We now present our results on the relative latency and throughput performance benefits of multihoming route control compared with overlay routing. We first describe our data collection methodology (Section 5.1) and evaluation metrics (Section 5.2). Then, we present the key results in the following order. First, we compare 1-multihoming against 1-overlays along the same lines as the analysis in [25] (Section 5.3). Next, we compare the benefits of using k-multihoming and k-overlay routing, relative to using default paths through a single provider (Section 5.4). Then, we compare k-multihoming against 1-overlay routing, for k ≥ 1 (Section 5.5). Here, we wish to quantify the benefit to end-systems of greater flexibility in the choice of BGP routes via multihoming, relative to the power of 1-overlays. Finally, we contrast k-multihoming against k-overlay routing to understand the additional benefits gained by allowing end-systems almost arbitrary control on end-to-end paths.