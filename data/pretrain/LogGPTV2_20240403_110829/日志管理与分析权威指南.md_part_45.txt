需求11说明扫描（或者“测试”）范围内系统漏洞的必要性。但是，在11.4小节中要求
需求9介绍了安全的一个新领域一
为每个访问系统的用户分配唯一的ID符合其他安全“最佳实践”。在PCI中，这不仅是
需求6也处于同一范畴：它要求组织“开发和维护安全的系统和应用程序”
所以，即使是“使用和定期更新防病毒软件”也可能在评估期间需要请求日志数据，
需求5针对病毒防御。当然，为了满足5.2小节的需求一
需求4处理的也是加密，由于同样的原因，和日志记录也有隐含的联系。
需求12涵盖了更高级的问题一
，《Requirements and SecurityAssessmentProcedures》，2010）。显然，人们必须“控制用
一安全策略、安全标准和日常运营规程（例如，需求10
一物理访问控制。甚至连包含来访者日志维护（可能
“确保所有防病毒机制最新、
因
---
## Page 234
统组件都进行了定期日志审核”（《Requirements and SecurityAssessment Procedures》，2010）。
2010）。然后，它又增加了这一条：“可以使用日志收集、解析和警报工具满足需求10.6的
集和分析，才能满足PCI的广泛需求。
SecurityAssessmentProcedures》，2010），如果没有高效的日志数据收集和及时审核，上述要
记录和发布安全事故响应和升级规程，确保及时和有效地处理所有情况”（《Requirements and
SecurityAssessmentProcedures》，2010）。QSA还必须确定“通过观察和面谈，验证所有系
每天至少一次审核安全日志的规程，并且要求对异常情况进行后续调查”（《Requirements and
以及计费协议服务器（例如RADIUS）”（《RequirementsandSecurityAssessmentProcedures》，
16.5
求难以想象。
记录应该是每个安全策略的一部分。除此之外，事故响应需求也和日志记录相关：“建立、
中强制的每日日志审核规程应该在这里反映)。但是，它也和日志记录相关，因为评估日志
验证规程强制，合格安全评估员（QSA）应该“获得和检查安全策略及规程，验证它们包含
日志。日志审核必须包含执行人侵检测系统（IDS）和身份认证、授权等安全功能的服务器
使用PCIDSS的概念，但是这个策略是通用的，可以应用于非PCI活动、应用程序等场合。
因此，PCIDSS中的事件日志记录和安全监控远不止于需求10。只有通过精心的数据收
现在，我们将重点放在日志审核上。PCIDSS指出：“至少每天一次审核所有系统组件的
日志记录策略定义应该捕捉日志数据的哪些属性供以后审核、升级和响应。同样，本章中
■足够的日志记录，包括日志事件类型（登录／注销、资源访问、防火墙接受/拒绝、
最后，在下一个小节，我们讨论日志审核规程的应用和工作流程，包括：
根据PCIDSS需求，
下一小节详细讨论日志记录需求，重点放在需求10和12。
1）日志审核方法、模式和任务。
IPS/IDS 警报等）和细节。
合格安全评估员（QSA）是对处理信用卡数据的企业进行PCI依从性评估的合格（通
日志审核
日志聚合和留存（1年）。
过培训、认证等）人员。
日志保护(确保日志不被篡改)。
日志记录策略
，源于PCI的日志记录策略至少必须包含如下内容：
第16章日志管理规程213
---
## Page 235
214
天日志审核”）的基本原则是实现如下目标：
（见16.3小节）进行，可以使用自动化工具（在PCIDSS中明确允许），如果这些自动化工具
证”小节中的规定记录文档，建立依从性证据。我们现在将提供这三种任务的细节。
16.6
的日志格式时，也可以人工进行。
不可用或者不支持PCI应用程序中的日志类型，则人工进行。
16.6.1
率），发现的任何异常情况被升级到“异常调查和分析”。这两者都按照本章的“日志审核验
本小节介绍日志管理的定期日志审核规程。这种审核由应用程序管理员或者安全管理员
PCIDSS是每天日志审核的动机，但是它还能实现其他的目标：
■尽早检测出持卡人数据的可能风险。
■确定持卡人数据没有遭到攻击者的人侵。
PCIDSS定期日志审核（尽管它可能没有每天对所有应用程序进行，但是仍被称为“每
我们将为两种情况建立完整的端到端规程，然后用例子加以说明。
换句话说，每天进行“定期日志审核工作”（如果每天审核不可能，
三种PCI强制规程之间的联系如图16.1所示。
这些规程可以使用自动化的日志管理工具，当这些工具不可用或者不兼容应用程序生成
2）异常调查和分析。
■满足PCIDSS日志审核的明确需求。
3）规程和管理报告的验证。
审核、响应、
定期日志审核方法和模式
日志审核
度
中
务
、升级规程
为确保PCIDSS依从性而验证及记录文档
图16.1确保PCIDSS依从性
异发工作旅程
调查
升级
辅到事格
，可以选择较低的频
---
## Page 236
的例子是很有意义的。例如（AntonChuvakin博士的博客，2011）：
(《Requirements and Security Assessment Procedures》，2010）。
志和Unix日志中没有记录明确的日志或者事件类型。所需要的是创建一个隐含的事件类型
其添加到预期的基线。图16.4展示了一个Windows7事件ID示例。
（AntonChuvakin博士的博客，2011）。
发生）持卡人数据的泄露。
基线的讨论参见第10章。
然后，按照基线，从常规例程中寻找“异常”，并调查它们，以确保没有发生（或者即将
需要注意的是，有些日志类型中可能没有明确的事件类型。例如，有些Java应用程序日
尽管日志管理工具自动进行这一过程，但是在采用人工日志审核规程时，研究一个人工
3）确定消息的这一部分是不是唯一的。
2）识别日志消息的哪一部分说明了相关的情况。
这种情况的规程如下：
图16.3是第一次出现，我们确定该消息不表示持卡人数据安全的关键故障，我们可以将
构建的主要基线包括日志消息类型，如图16.3所示。
在进行PCI每天日志审核之前，熟悉每个应用程序在日志中记录的正常活动是关键
图16.2说明了这一过程。
根据上述目标，每天日志审核围绕“基线”或者常规日志消息集的学习和文档记录构建。
■协调日志中观察到的与其他系统和活动之间所有可能的异常情况（例如应用程序代码
■确保处理持卡人数据的系统安全有效地运行。
4）从消息的这一部分创建一个事件ID。
1）审核日志消息。
变化或者补丁部署）。
第一次日志审核
不
建立基线
（按照应用程序）
图16.2基线过程
每天审核基线对比
正常日志记录：更新基线
异常：调查
第16章日志管理规程215
---
## Page 237
216
的这类消息更新基线。
分类这一条消息。
的秘密”，甚至是“generating secret”。
Event Properties
Event
DaBterOWords
Descriptiort
Compuler:OLGA
Jser
>>>>17 Ju1 2008
下面我们介绍另一个Java应用程序日志的示例。
我们可以创建一个事件ID或者消息类型“generating_secret”。现在我们可以用观测到
4）从消息的这个部分创建事件ID
对日志中其他消息的审核说明，没有其他消息包含相同的短句，因此这一短句可以用于
3）确定消息的这一部分是不是唯一的
2）识别消息的哪一部分说明了相关的情况
[Mon Jan 26 22:55:37 2004][notice] Digest:generating secret for
noung
日志消息如下：
1）审核日志消息
示例2
日志消息如下：
1）审核日志消息
示例1
图16.3WindowsXP事件ID示例
digest authentication.
6:08:48AM
/5/200Souce
Userenw
Event ID or type
Cancel
图区
Bppl
←
>
EventPpett24MtWs
GeneratDetails
The Windows Firewall
图16.4Windows7事件ID示例
Nindows
Komords
Logeate
Audi Ssces
Close
---
## Page 238
Chuvakin博士的博客，2011）。
（Anton Chuvakin，2011）。
有日志类型（Chuvakin，日期不详）。
息类型（Chuvakin，日期不详）。
16.6.2
Chuvakin博士的博客，2011）。
录丢失（常常从日志条目容量的明显减小中发现）必须加以调查，并升级为安全事故（Anton
评估也很有意义。日志容量的显著不同也应该用下面定义的规程进行调查。特别是，日志记
使用自动化工具。
们可以用观测到的这类消息更新基线。
availability",
(CompletePCIDSSLogReviewProceduresPart 8，2011）。
除了这个“事件类型”之外，对前一天（过去24个小时）重叠的日志条目容量进行快速
可以使用如下过程快速构建初始基线，包括两种情况：使用自动化的日志管理工具和不
5）如果没有发现任何卡数据泄露，
4）运行一个报告，显示每个消息类型的计数。这个报告指出系统运营90天内遇到的所
2）确定工具能够“理解”（解析、标记等）消息，并标识每个日志的“事件ID”或者消
我们可以创建一个消息ID或者消息类型“Error_getting_merchant_availability”。现在我
执行如下步骤，用日志管理工具构建一个基线：
4）从消息的这个部分创建事件ID
对日志中其他消息的审核发现，没有其他消息包含短句“Error getting merchant
3）确定消息的这一部分是不是唯一的
2）确定消息的哪一部分说明了相关的情况
factory.service.travel.flying.PropertyAvailServiceImpl.
com.factory.service.travel.flying.exception.MerchantSupplierException
gettingmerchant availability,will fall back to XFS
13:00:57|AFWVGBYMBHWMV|ERROR|MerchantPreferredQuoteStrategy|Error
1）确保日志管理工具收集PCI应用程序中的相关日志（Chuvakin，日期不详）。
atcom.