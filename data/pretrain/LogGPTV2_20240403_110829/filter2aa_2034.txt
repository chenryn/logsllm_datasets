EtherSniff
EtherSniff
How to stealthily monitor an 
How to stealthily monitor an 
established Ethernet network
established Ethernet network
by Mark Smith, aka Smitty
Introduction
Introduction
 Hardwired network paths are secure.
Hardwired network paths are secure.
 No encryption needed internally.
No encryption needed internally.
 A physical 
A physical sniffer
sniffer insertion would break link on 
insertion would break link on 
network interfaces, triggering alarms.
network interfaces, triggering alarms.
Right?
Right?
 …
…maybe not
maybe not…
…
Introduction: Me
Introduction: Me
 Mark Smith, aka 
Mark Smith, aka Smitty
Smitty
 By day: Network engineer and system 
By day: Network engineer and system 
administrator for over 15 years
administrator for over 15 years
 By night: Maker, ham radio nerd, musician, 
By night: Maker, ham radio nerd, musician, 
podcaster
podcaster, husband, father, closet tree hugger
, husband, father, closet tree hugger
 Contact me:
Contact me:
 Email: mark {at} halibut {dot} com
Email: mark {at} halibut {dot} com
 @
@SmittyHalibut
SmittyHalibut just about everywhere else.
just about everywhere else.
Encoding Techniques: 10baseT
Encoding Techniques: 10baseT
 10Mbps, baseband (not carrier modulated), 
10Mbps, baseband (not carrier modulated), 
Twisted pair.
Twisted pair.
 10Mbps data stream, Manchester coded, 
10Mbps data stream, Manchester coded, 
produces 20MHz square wave signal.
produces 20MHz square wave signal.
 Bi
Bi--state output: +2.5v and 
state output: +2.5v and --2.5v.
2.5v.
 Full duplex done with two separate simplex 
Full duplex done with two separate simplex 
pairs: TX and RX
pairs: TX and RX
http://en.wikipedia.org/wiki/10BASET
Encoding Techniques: 10baseT
Encoding Techniques: 10baseT
 Manchester coding: Output = Data XOR Clock
Manchester coding: Output = Data XOR Clock
 Guarantees a state transition with every bit.
Guarantees a state transition with every bit.
http://en.wikipedia.org/wiki/Manchester_code
Encoding Techniques: 100baseT
Encoding Techniques: 100baseT
 100Mbps, baseband, Twisted pair.
100Mbps, baseband, Twisted pair.
 100Mbps data stream, 4B5B line coding to 
100Mbps data stream, 4B5B line coding to 
ensure sufficient clocking, produces 125Mbps 
ensure sufficient clocking, produces 125Mbps 
symbol rate.
symbol rate.
 MLT
MLT--3 encoding produces 31.25MHz tri
3 encoding produces 31.25MHz tri--state 
state 
output: +1v, 0v, and 
output: +1v, 0v, and --1v.
1v.
 Full duplex done with two separate simplex 
Full duplex done with two separate simplex 
pairs: TX and RX
pairs: TX and RX
http://en.wikipedia.org/wiki/Fast_Ethernet
Encoding Techniques: 100baseT
Encoding Techniques: 100baseT
 4B5B line coding ensures sufficient 1s density 
4B5B line coding ensures sufficient 1s density 
for 0v DC offset. Includes signaling.
for 0v DC offset. Includes signaling.
http://en.wikipedia.org/wiki/4B5B
Encoding Techniques: 100baseT
Encoding Techniques: 100baseT
 MLT
MLT--3 coding.  3 voltage levels, 4 states. Moves 
3 coding.  3 voltage levels, 4 states. Moves 
to next state on 1, stays on current state on 0.
to next state on 1, stays on current state on 0.
 Max base frequency is 
Max base frequency is ¼
¼ the data rate.
the data rate.
http://en.wikipedia.org/wiki/MLT-3
Encoding Techniques: 1000baseT
Encoding Techniques: 1000baseT
 …
…uhh
uhh…
… II’’ll get back to this later in the talk
ll get back to this later in the talk…
…
http://www.ieee802.org/3/ab/index.html
http://en.wikipedia.org/wiki/Gigabit_Ethernet
http://en.wikipedia.org/wiki/Pulse_amplitude_modulation
http://en.wikipedia.org/wiki/Trellis_modulation
http://en.wikipedia.org/wiki/Linear_feedback_shift_register
Tapping methods
Tapping methods
 DC coupling
DC coupling
 Inductive coupling
Inductive coupling
Tapping Methods: DC coupling
Tapping Methods: DC coupling
 A direct copper connection between the wires 
A direct copper connection between the wires 
being monitored and the monitoring device.
being monitored and the monitoring device.
Tapping Methods: DC coupling
Tapping Methods: DC coupling
 Pros:
Pros:
 Easy to construct and connect.
Easy to construct and connect.
 Hardware is cheap and passive; no power required.
Hardware is cheap and passive; no power required.
 Cons:
Cons:
 Accidental DC short, could break link.
Accidental DC short, could break link.
 Tap and branch cause reflections, could break link.
Tap and branch cause reflections, could break link.
 Accidental reversal of TX/RX, or auto
Accidental reversal of TX/RX, or auto--negotiation 
negotiation 
of MDI state will transmit, could break link.
of MDI state will transmit, could break link.
Tapping Methods: Inductive Coupling
Tapping Methods: Inductive Coupling
 Build a small transformer with the pair being 
Build a small transformer with the pair being 
monitored, pull a bit of the power.
monitored, pull a bit of the power.
Tapping Methods: Inductive Coupling
Tapping Methods: Inductive Coupling
 Pros:
Pros:
 Minimal impedance change, hard to detect.
Minimal impedance change, hard to detect.
 Insulation intact, won
Insulation intact, won’’t accidentally DC short.
t accidentally DC short.
 The receiver amplifier acts as a buffer, prevents 
The receiver amplifier acts as a buffer, prevents 
accidental transmission.
accidental transmission.
 Cons:
Cons:
 Inductively coupled signal is high impedance; 
Inductively coupled signal is high impedance; 
requires amplifier.
requires amplifier.
 Transformers are finicky, hard to get right.
Transformers are finicky, hard to get right.
Hardware Assembly
Hardware Assembly
 Because of its simplicity, we
Because of its simplicity, we’’ll be using a DC 
ll be using a DC 
coupled system for today
coupled system for today’’s demonstration.
s demonstration.
Hardware Assembly: DC Coupled
Hardware Assembly: DC Coupled
Punch a 100 ohm resistor across Orange pair 
Punch a 100 ohm resistor across Orange pair 
of two 568B RJ
of two 568B RJ--45 wall jacks.
45 wall jacks.
Hardware Assembly: DC Coupled
Hardware Assembly: DC Coupled
 Carefully cut about 12 inches of the 
Carefully cut about 12 inches of the outer 
outer 
jacket
jacket off the Ethernet cable to be monitored. 
off the Ethernet cable to be monitored. 
Hardware Assembly: DC Coupled
Hardware Assembly: DC Coupled
 Untwist the Orange pair a bit to give yourself 
Untwist the Orange pair a bit to give yourself 
about an inch of straight wires.
about an inch of straight wires.
Hardware Assembly: DC Coupled
Hardware Assembly: DC Coupled
 Using the 
Using the non
non--cutting
cutting side of a punch tool, 
side of a punch tool, 
punch the Orange wire into the Green pair of 
punch the Orange wire into the Green pair of 
one of the 568B RJ
one of the 568B RJ--45 wall jacks.
45 wall jacks.
Hardware Assembly: DC Coupled
Hardware Assembly: DC Coupled
 Repeat last two steps with the Green pair.
Repeat last two steps with the Green pair.
Hardware Assembly: DC Coupled
Hardware Assembly: DC Coupled
 Connect two standard Ethernet cables from the 
Connect two standard Ethernet cables from the 
RJ
RJ--45 wall jacks to your monitoring system.
45 wall jacks to your monitoring system.
Hardware Assembly: DC Coupled
Hardware Assembly: DC Coupled
 eth0 sees traffic one way, eth1 sees traffic the 
eth0 sees traffic one way, eth1 sees traffic the 
other way.
other way.
 Use 
Use tcpdump
tcpdump, , WireShark
WireShark or similar to capture 
or similar to capture 
and display the data.
and display the data.
 Capture with precise timestamps, add a bit of 
Capture with precise timestamps, add a bit of 
scripting, and you can have a single combined 
scripting, and you can have a single combined 
data flow.
data flow.
Hardware Assembly: Inductively Coupled
Hardware Assembly: Inductively Coupled
 …
…come see me next year
come see me next year…
…
Thinking Black Hat
Thinking Black Hat
 Shared phone rooms and wiring closets
Shared phone rooms and wiring closets
 Drop ceilings
Drop ceilings
 ““Protected
Protected”” conduits (got a pipe cutter from 
conduits (got a pipe cutter from 
Home Depot?)
Home Depot?)
 Man holes, J
Man holes, J--Boxes, etc.
Boxes, etc.
Thinking White Hat
Thinking White Hat
 Physical Security.  (See other presentations here 
Physical Security.  (See other presentations here 
at 
at DefCon
DefCon.).)
 Encryption. IPSec, TLS, etc.
Encryption. IPSec, TLS, etc.
 Heck, encrypt everything anyway; CPU is cheap.
Heck, encrypt everything anyway; CPU is cheap.
 Periodic TDR measurements.
Periodic TDR measurements.
 Gigabit Ethernet (stick around
Gigabit Ethernet (stick around…
…))
The Holy Grail: Gigabit Ethernet
The Holy Grail: Gigabit Ethernet
…
…and why it
and why it’’s s REALLY
REALLY hard to sniff
hard to sniff…
…
 10baseT and 100baseT are easy to monitor:
10baseT and 100baseT are easy to monitor:
 Simple line coding techniques.
Simple line coding techniques.
 Relatively low signal rates (20MHz and 31.25MHz)
Relatively low signal rates (20MHz and 31.25MHz)
 Individual TX and RX pairs (each pair is simplex.)
Individual TX and RX pairs (each pair is simplex.)
 Auto
Auto--negotiation can be disabled and line settings 
negotiation can be disabled and line settings 
configured manually.
configured manually.
The Holy Grail: Gigabit Ethernet
The Holy Grail: Gigabit Ethernet
…
…and why it
and why it’’s s REALLY
REALLY hard to sniff
hard to sniff…
…
 Gigabit Ethernet is none of those things:
Gigabit Ethernet is none of those things:
 Auto
Auto--negotiation is a requirement of the spec.
negotiation is a requirement of the spec.
 All four pairs are used 
All four pairs are used simultaneously
simultaneously for TX and RX.  
for TX and RX.  
Two unknowns, only one equation.
Two unknowns, only one equation.
 1000baseT is far more susceptible to reflections and 
1000baseT is far more susceptible to reflections and 
changes in impedance.
changes in impedance.
The Holy Grail: Gigabit Ethernet
The Holy Grail: Gigabit Ethernet
…
…and why it
and why it’’s s REALLY
REALLY hard to sniff
hard to sniff…
…
 Nothing public exists for this yet, but its not 
Nothing public exists for this yet, but its not 
impossible.
impossible.
 A more motivated and better funded 
A more motivated and better funded 
organization has probably already figured this 
organization has probably already figured this 
out.
out.
Conclusion
Conclusion
 We
We’’ve shown that:
ve shown that:
 A careful attacker with no budget can 
A careful attacker with no budget can easily
easily tap into 
tap into 
unprotected 10baseT and 100baseT.
unprotected 10baseT and 100baseT.
 A decently funded attacker can probably do the 
A decently funded attacker can probably do the 
same thing with 1000baseT.
same thing with 1000baseT.
 If you can
If you can’’t physically secure your network links, 
t physically secure your network links, 
encrypt your traffic (IPSec, TLS, etc.)
encrypt your traffic (IPSec, TLS, etc.)
Thanks!
Thanks!
 Thanks for listening!
Thanks for listening!
 Mark Smith, aka 
Mark Smith, aka Smitty
Smitty
 mark {at} halibut {dot} com
mark {at} halibut {dot} com
 @
@SmittyHalibut
SmittyHalibut everywhere else
everywhere else
http://www.halibut.com/~mark/EtherSniff
http://www.halibut.com/~mark/EtherSniff--v1.0.pdf
v1.0.pdf