# 敲竹杠家族的新手段：随机化密码与邮件取信

## 译文声明
本文为翻译文章，原文来源：360QVM@360安全播报。译文仅供参考，具体内容及含义请以原文为准。

## 一、概况
近期，360QVM团队发现了一批伪装成游戏外挂、QQ刷钻以及游戏装备辅助等类型的勒索软件。一旦用户运行这些恶意程序，其计算机的管理员账户将被添加或更改密码，导致用户无法进行任何操作。如果用户希望解锁计算机，必须联系恶意软件界面上提供的QQ号码并支付费用，以此达到勒索目的。

## 二、样本分析
我们最近捕获到的恶意勒索软件主要采用了两种不同的方法来实现其目标：一种是直接给计算机用户设置一个固定的密码；另一种则是基于当前环境的部分信息生成加密密码。后者使得系统难以进入，本文将以采用随机算法的一个样本为例进行深入分析。
- **MD5:** FD71FA7B8B9282618E050653464611F4
- **SHA1:** C0126EACC1D50F0F7BBE3C1303EA61154688AC4B

### (一) 样本执行流程
该样本首先利用随机数和时间戳进行混合运算生成密码，随后通过修改注册表关闭UAC（用户账户控制）等功能。接着它会更改用户密码，并向预设的邮箱发送密码信息以便于后续赎金交易时使用。最后，样本会强制重启计算机。

### (二) 样本具体行为
1. 设置自身为开机启动项，在注册表中创建名为“3.exe”的条目。
2. 使用`taskkill`命令终止卡巴斯基、瑞星、McAfee等安全软件进程以自我保护。
3. 对注册表进行大量修改，详情见下文源码部分。
   - 添加注册表项
   - 删除特定注册表键值
4. 通过调用CMD命令来设定新的计算机登录密码。
5. 向作者指定的电子邮件地址发送包含新密码的信息后关机。
由于该样本是用易语言编写的，根据其特性识别出支持库信息并恢复了原始代码。算法部分如下所示：
- [逆向工程后的支持库代码]
- [完整的还原源代码]

## 三、解决方案
对于此类敲诈木马，预防总是优于事后补救。如果不慎感染，请考虑使用360安全卫士提供的“敲竹杠”木马开机密码恢复功能（<http://fuwu.360.cn/chaxun/qq>）。我们会持续更新已知的密码数据库以帮助受害者找回丢失的密码。在成功恢复密码之后，请立即进行全面的病毒扫描。如果您遇到未能找到相应密码的情况，也欢迎向我们提交相关样本以便进一步研究。
- **步骤一**：若您的电脑启动时出现异常界面
- **步骤二**：输入黑客留下的QQ联系方式
- **步骤三**：尽快更改您的账户密码（路径：控制面板 > 用户账户 > 更改密码）

## 四、总结
随着去年CryptLocker病毒的爆发，“勒索软件”这个词开始受到广泛关注。这类病毒能够加密用户的个人文件，并要求支付赎金才能解密。此后，在国内也开始出现了通过修改或增加开机密码来进行勒索的行为，并且这种趋势正在逐渐加剧。此类恶意软件的发展对用户的设备及其存储的数据构成了严重威胁。我们将继续密切关注此类攻击模式的变化，并提供有效的防护措施。