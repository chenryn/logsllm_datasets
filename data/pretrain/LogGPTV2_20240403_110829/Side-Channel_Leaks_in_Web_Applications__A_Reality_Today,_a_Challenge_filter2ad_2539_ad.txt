info
(5)
Head of Household 
eligibility test
Social security 
number of 
deceased  spouse
Exemption 
eligibility test
Eligibility 
test result
Personal info 
summary
(1) Single
(4) Head of household
(2) Married filing jointly
(5) Qualifying Widow(er)
(3) Married filing separately
Figure 6: State machine that decides the filing status 
197
Similarly,  we  can  infer  the  number  of  children  in  the 
family by observing  how  many times the  user fills out the 
child  info  page,  and  whether  the  spouse  has  salaries  by 
observing  the  salary  form  submissions  (a.k.a.,  W-2  form). 
All these user actions produce unique web flow vectors. 
Inference of AGI. AGI is calculated by OnlineTaxA based on 
the  data  in  the  Income  module.  It  is  unlikely  to  infer  the 
AGI  from  the  sizes  of  W-2  or  other  income  forms:  for 
example,  each  W-2  form  has  twenty  input  boxes,  most  of 
which take the data of variable lengths; this gives the input 
(which  includes  the  AGI)  a  sufficiently  high  entropy  that 
discourages a side-channel analysis.  
As  described  in  Section  III,  communications  in  web 
applications  are  stateful.  The  inference  of  user  input  does 
not  have  to  be  accomplished  when  the  data  is  initially 
entered  by  the  user,  and  can  instead  make  full  use  of  the 
web  flow  vectors  observed  from  the  later  state  transitions 
that are also affected by the input data. When it comes to tax 
calculation,  the  dependencies  between  the  AGI  and  tax 
deductions/credits become an intrinsic link to tie the AGI to 
the  state  transitions.  More  specifically,  the  attacker  can 
utilize the following two facts: (1) the user’s eligibilities for 
many credits and deductions depend on the AGI, and such 
dependencies  can  be  identified  from  tax  laws;  (2)  such 
eligibilities  affect  state  transitions,  which  can  be  inferred 
from observed traffic patterns. 
For  example,  Figure  7  shows  OnlineTaxA’s  state 
machine for determining one’s eligibility for the child credit. 
X:
(2028(cid:102)10(cid:206), 208(cid:102)10(cid:206),
(cid:205)1476, (cid:205)1476, (cid:205)1476, (cid:205)b)
Entry page of 
Deductions & 
Credits
Summary of 
Deductions 
& Credits
(2095(cid:206), 195(cid:102)5(cid:206),
(cid:205)1476, (cid:205)1476,
(cid:205)890+b
)
(2095(cid:206), 195(cid:102)5(cid:206),
(cid:205)1476, (cid:205)1476,
(cid:205)700+b
)
Not eligible for 
child credit
(2095(cid:206), 195(cid:102)5(cid:206), (cid:205)1476, (cid:205)1476,    
(cid:205)1476, (cid:205)1476, (cid:205)584+b
)
Partial child credit
Full child credit
Figure 7: State transitions for child credit eligibilities 
When  the  user  gets  the  entry  page  of  Deductions  & 
Credits,  web  flow  vector  X:  (2028±10(cid:206),  208±10(cid:206), 
(cid:205)1476, (cid:205)1476, (cid:205)1476, (cid:205)b) is observed, i.e., the attacker 
learns from the observation about the value of b, which is a 
value  different  for  each  user  because  the  response  packet 
contains user-profile data of a certain length. Based on the 
value of b, the attacker can determine the transition to one 
of  the  three  possible  states:  “not  eligible  for  child  credit”, 
“partial  child  credit”  and  “full  child  credit”  (the  web  flow 
differences are highlighted in the figure). According to the 
tax law document IRS-Pub-792, (1) the taxpayer can claim 
up  to  $1000*c  credit,  where  c  is  the  number  of  dependent 
children;  (2)  if  the  AGI  is  below  $110,000  for  Married 
Filing Jointly, the taxpayer gets the full credit; (3) for every 
$1000  income  in  the  AGI  above  $110,000,  the  taxpayer 
loses $50 child credit (a.k.a. the phase-out rule). Therefore, 
if  a  taxpayer  claims  two  children  in  the  personal  info 
module,  by  observing  the  transitions  in  Figure  7,  the 
attacker is able to confidently identify where the taxpayer’s 
AGI falls: below $110,000, between $110,000 and $150,000, 
or above $150,000.   
Even  more  intriguing  are  other  Credits  &  Deductions 
situations, which often have asymmetric execution paths for 
different  eligibilities.  For  example,  Figure  8  shows  the 
Student  Loan  Interest  deduction:  if  the  AGI  is  higher  than 
$145,000,  the  user  is  not  eligible,  and  no  further  question 
will  be  asked;  otherwise,  the  application  gets  into  the 
highlighted  state  where  the  information  about  the  user’s 
interest is required. Therefore, if the user is partially or fully 
qualified,  the  path  of  state  transitions  will  be  longer  than 
that  for  those  not  eligible.  This  allows  an  eavesdropper  to 
tell  whether  one’s  AGI  is  above  $145,000,  even  when  the 
web  flow  vector  of  transition  A  in  Figure  8  are  made 
indistinguishable from that of D. Asymmetric paths widely 
exist  in  OnlineTaxA:  all  the  nine  credits  and  deductions 
listed  in  Figure  9,  except  “child  credit”  and  “elderly  or 
disabled credit”, have this situation.  
(2028(cid:102)10(cid:206), 
208(cid:102)10(cid:206),
(cid:205)1476, 
(cid:205)1476,
(cid:205)1476, (cid:205)b)
Entry page of 
Deduction & 
Credit
Summary of 
Deduction 
& Credit
A: (2084(cid:206), 
207(cid:206), (cid:205)1476, 
(cid:205)1476,
(cid:205)675+b)
D: (2084(cid:206), 207(cid:206), (cid:205)1476, 
(cid:205)1476, (cid:205)1476, (cid:205)73+b)
Not eligible 
for the credit
B:  (2084(cid:206), 
260(cid:102)10(cid:206), (cid:205)1476, 
(cid:205)1476, (cid:205)336+b)
Partial credit 
to be claimed
Enter your 
interest paid
C: (2084(cid:206), 
260(cid:102)10(cid:206),
(cid:205)1476, (cid:205)1476,
(cid:205)275+b)
Full credit to 
be claimed
FIGURE 8: ASYMMETRIC PATHS IN STUDENT LOAN INTEREST DEDUCTION 
We  skimmed  through  the  U.S.  tax  instructions  to 
sample  some  common  credits/deductions,  and  confirmed 
that the web flow vectors of OnlineTaxA indeed enable the 
attacker  to  infer  a  series  of  AGI  ranges  (see  Figure  9)  for 
those who attempt to claim the credits and deductions.  
$0
$24999
$41646
$53000
Elderly or 
Disabled Credit
Earned Income 
Credit
Retirement Saving 
Contribution
College Expense
Retirement Account 
(IRA) Contribution
Student Loan Interest
Child credit *
First-time Homebuyer credit
Adoption expense
$174730 $214780
* The upper limit of Child Credit Eligibility = $110000+$20000*c    (c is No. of children)
$85000 $105000
$115000
$130000 or $150000 or $170000 …
$150000 $170000
$145000
$116000
$110000
Figure 9: Some disclosed AGI ranges  
198
So  far  we  have  only  focused  on  the  federal  tax.  Most 
U.S. states have their state income tax provisions. Many of 
them are also associated with the AGI. We believe that the 
same  attack  could  work  on  state  taxes.  Since  none  of  the 
authors of the paper is a tax expert, we only studied a small 
fraction of all (hundreds of) the credits and deductions that 
OnlineTaxA  can  process.  We  believe  that  state  transitions 
associated  with  those  credits  and  deductions  could  give 
away  more  private  information,  such  as  other  AGI  ranges, 
whether the user paid large medical bills or mortgages, etc. 
C.  OnlineInvestA.com  
OnlineInvestA  is  a  leading  financial  company  in  the 
U.S., which provides a wide range of financial products and 
services  to  investors.  The  service  is  also  exclusively 
accessible  through  HTTPS.  Different  from  prior  examples 
in  which  data  leaks  are  caused  by  auto-suggestion,  search, 
and  wizard  conversation,  etc,  here  privacy  information  is 
disclosed by graphical visualization of data.  
1)  The Mutual Fund Page and the Fund Allocation Page 
When the user logs onto the OnlineInvestA account, one 
can  choose  to  view  investment  holdings  such  as  mutual 
funds, stocks or bond, in a list. Figure 10 (upper) illustrates 
an example in which the user invests three funds, and their 
12-month  price  history  charts  are  displayed  on  the  side  of 
the  textual  content.  These  charts  are  GIF  images.  Per 
OnlineInvestA’s request, we replaced the actual screenshots 
with the mock-up graphics. 
t
s
i
l
d
n
u
f
l
t
a
u
u
M
i
t
a
c
o
l
l
n
o
a
d
n
u
F
Mutual Funds
Fund A
Price $52.85     09/09/2009
Value       Quantity
$12345      234
Fund B
Price $32.15     09/09/2009
Value       Quantity
$12330      384
Fund C
Price $28.80     09/09/2009
Value       Quantity
$11111      386
Your Retirement Investment Portfolio
The pie chart shows the allocation 
among your funds.
(cid:307)
(cid:131) Fund A: 34.9%
(cid:131) Fund B: 34.2%
(cid:131) Fund C: 30.9% 
(cid:307)
34.9%      Fund A
34.2%      Fund B
100-(cid:307)-ω
30.8%      Fund C
ω
Note: Hyperlinks in the circles navigate to fund detail pages. 
Figure 10: Mutual fund list (upper) and allocation (lower) 
An  image  (i.e.,  )  on  an  HTML  page  is  loaded 
separately  from  the  page.  Therefore  the  size  of  the  image 
can be identified from the packet size of the response from 
the server. There are 9 mutual funds available in this type of 
account to choose, which are obviously a set of low entropy 
inputs. We recorded the sizes of all the price-history charts 
199
on 9/9/2009, which  were all distinct,  with a density 0.044. 
To access the fund details, the user can click the hyperlinks 
highlighted  in  circles  in  Figure  10.  The  sizes  of  the  fund 
detail  pages  were  all  different  too,  with  a  much  lower 
density 0.010.  
the  percentages  of 
Figure 10 (lower) is another view  that can be selected 
by 
the 
the  user,  which  displays 
investment on the funds. The pie chart is also a GIF image. 
In the next subsection, we will see how the pie chart can be 
inferred  from  its  size,  which  once  again  demonstrates  the 
multiplicative reduction power that the attacker can obtain. 
2)  Leaking Investment Secrets  
The  price  history  charts  and  the  fund  detail  pages  are 
publicly  accessible 
to  everyone,  with  or  without 
OnlineInvestA  accounts  (in  fact,  the  browser  imports  the 
charts  from  the  website https://FinancialDataA.com,  which 
is  not  OnlineInvestA’s  property).  Since  the  choices  of 
mutual  funds  have  low  entropy  and  the  sizes  of  the  charts 
and the detail pages are all distinct, the funds that the user 
invests  can  be  identified  by  comparing  the  sizes  of  the 
packets  she  receives  with  the  publicly  obtained  sizes. 
However,  inferring  pie  charts  seems  more  challenging,  as 
the  entropy  is  much  higher.  This  is  the  focus  of  the 
discussion below. 
Inferring fund allocation. We first assume that the user 
invests  in  3  funds  (2-fund  and  1-fund  scenarios  are  trivial 
cases). The dimensions of the pie chart image are 136×136. 
It  has  380  pixels  on  the  circumference.  Therefore  the 
portions  of  two  of  these  funds,  denoted  by  (cid:307)  and  ω  as 
indicated in Figure 10 (right), have 380 possible values each. 
To  make  the  analysis  easier,  we  conservatively  adopted 
0.25% as the increment to enumerate (cid:307) and ω values, which 
gives  each  fund  400  values,  and  totally  79401  possible 
charts. We observed that the sizes of the charts varied, but 
within a range smaller than 200 bytes. The density is over 
385. At the first glance, the inference seems impossible.  
Interestingly, since OnlineInvestA updates the pie chart 
every day after the market closes, the pie chart’s evolution 
can be viewed as state transitions over a multiple-day period, 
initiated  by  the  input  of  the  first-day’s  financial  data  from 
the  backend  database  and  driven  by  the  follow-up  daily 
inputs from the market. This gives the attacker a significant 
reduction  power,  similar  to  that  in  the  auto-suggestion 
scenario, with only two unessential differences: (1) the input 
comes from the backend database, not from the user; (2) the 
state  transitions  in  the  auto-suggestion  widget  are  in  the 
form of consecutive keystroke inputs, while the pie chart of 
each day is the evolution result of the chart of the previous 
day,  by  applying  the  mutual  fund  price  changes  of  the 
current day. Since the price of each fund, in U.S. cents, is 
public  knowledge,  the  pie  charts  on  different  days  are 
indeed semantically correlated.   
Following we describe an algorithm that performs such 
an  inference.  Its  parameters  include:  allSizes((cid:307),ω)  – 
an array that keeps the image sizes for the 79401 pie charts, 
price(fund,day)  –  the  prices  of  the  invested  mutual 
funds  everyday,  and  size(day)  –  the  image  size  of  the 
pie chart of each day observed by the attacker. The program 
first  determines  the  initial  ambiguity  set  AgtySet  based 
upon the image size of the first day. For each following day, 
the price change is applied to every pie chart in the set, and 
those  that  do  not  match  the  image  size  of  the  day  are 
dropped.  In this way, AgtySet shrinks everyday.  
AgtySet= {((cid:307),ω)| allSizes((cid:307),ω) == size(1)}; 
for (d=2; |AgtySet| > 1; d++){ /*d is the day*/ 
AgtySet’={((cid:307),ω)| (((cid:307),ω) ∈ AgtySet) ∧ ((size(d) 