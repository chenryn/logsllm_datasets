title:SiamHAN: IPv6 Address Correlation Attacks on TLS Encrypted Traffic
via Siamese Heterogeneous Graph Attention Network
author:Tianyu Cui and
Gaopeng Gou and
Gang Xiong and
Zhen Li and
Mingxin Cui and
Chang Liu
SiamHaN: IPv6 Address Correlation Attacks on 
TLS Encrypted Traffic via Siamese Heterogeneous 
Graph Attention Network
Tianyu Cui, Gaopeng Gou, Gang Xiong, Zhen Li, Mingxin Cui, and Chang Liu, 
Institute of Information Engineering, Chinese Academy of Sciences, and School 
of Cyber Security, University of Chinese Academy of Sciences
https://www.usenix.org/conference/usenixsecurity21/presentation/cui
This paper is included in the Proceedings of the 30th USENIX Security Symposium.August 11–13, 2021978-1-939133-24-3Open access to the Proceedings of the 30th USENIX Security Symposium is sponsored by USENIX.SIAMHAN: IPv6 Address Correlation Attacks on TLS Encrypted Trafﬁc via
Siamese Heterogeneous Graph Attention Network
Tianyu Cui1,2, Gaopeng Gou1,2, Gang Xiong1,2, Zhen Li1,2, Mingxin Cui1,2, and Chang Liu1,2,∗
1Institute of Information Engineering, Chinese Academy of Sciences
2School of Cyber Security, University of Chinese Academy of Sciences
{cuitianyu, gougaopeng, xionggang, lizhen, cuimingxin, liuchang}@iie.ac.cn
Abstract
Unlike IPv4 addresses, which are typically masked by a NAT,
IPv6 addresses could easily be correlated with users’ activity,
endangering their privacy. Mitigations to address this privacy
concern have been deployed, making existing approaches
for address-to-user correlation unreliable. This work demon-
strates that an adversary could still correlate IPv6 addresses
with users accurately, even with these protection mechanisms.
To do this, we propose an IPv6 address correlation model –
SIAMHAN. The model uses a Siamese Heterogeneous Graph
Attention Network to measure whether two IPv6 client ad-
dresses belong to the same user even if the user’s trafﬁc is
protected by TLS encryption. Using a large real-world dataset,
we show that, for the tasks of tracking target users and dis-
covering unique users, the state-of-the-art techniques could
achieve only 85% and 60% accuracy, respectively. However,
SIAMHAN exhibits 99% and 88% accuracy.
1 Introduction
Over the past years, we have witnessed an increasing number
of network providers expediting the deployment of IPv6 [37,
41]. Due to these efforts, one-third of Internet users can now
access online services through IPv6 [17]. With this growth in
use, however, come increased focus on security and privacy
issues (e.g., [5, 11, 28]). A particular concern for the privacy
of IPv6 users is the user activity correlation attack [9]. In this
attack, which works even on trafﬁc encrypted by Transport
Layer Security (TLS) [36], an adversary could identify and
track users. Since an IPv6 address usually corresponds to one
single user rather than a user group due to the rare deployment
of NAT, a correlation attack against IPv6 remains a serious
individual-level privacy threat. Activity correlation on IPv6
trafﬁc can be grouped into two categories – address-based
correlation and trafﬁc characteristic correlation.
Address-based correlation allows an adversary to associate
an IPv6 address with a user’s activity, especially when an IPv6
∗Chang Liu is the corresponding author.
address is in a weak conﬁguration. For example, a user might
conﬁgure a constant interface identiﬁer through which a user’s
activity could be pinpointed from multiple contexts [46]. To
eliminate this address correlation issue, RFC 4291 [21] stan-
dard requires network operators to treat interface identiﬁers as
semantically opaque. RFC 4941 standard [33] extends state-
less address auto-conﬁguration (SLAAC) allowing IPv6 users
to use temporary addresses.
Different from address-based correlation, trafﬁc charac-
teristic correlation associates trafﬁc with users’ activities by
analyzing the patterns in the encrypted trafﬁc (e.g., [2, 16,
27, 34]). While demonstrating high effectiveness in trafﬁc-
user-correlation, approaches of using this technique can only
correlate the trafﬁc of a selected subset of users because of
the poor knowledge description and the unreliable similarity
learning leads to false positives.
In this paper, we demonstrate that a more sophisticated
approach could overcome this limitation, presenting signiﬁ-
cantly more danger to the privacy of IPv6 users. In particular,
we introduce a method to learn a correlation function from
TLS encrypted trafﬁc. Using the function, an adversary could
determine whether two arbitrary addresses belong to the same
user. Unlike prior works, this enables large-scale user activ-
ity correlation. Our proposed attack consists of two steps
as follows. First, an adversary monitors the TLS encrypted
trafﬁc on a vantage point and then constructs a knowledge
graph for each client address. Second, using Graph Neural
Networks [52] along with Siamese Networks [8], we intro-
duce a Siamese Heterogeneous Graph Attention Network
– SIAMHAN that employs multi-level attention and metric
learning to capture the relationship between two IPv6 ad-
dresses with TLS encrypted trafﬁc.
In this work, we evaluate the performance of SIAMHAN
by using 5-month IPv6 user trafﬁc collected at a vantage ob-
servation point. We show that SIAMHAN could correlate
the activities of pairwise IPv6 addresses with 90% accuracy
based on 1-month adversary’s background knowledge. When
applied to long-term user tracking and user discovery tasks,
SIAMHAN outperforms existing correlation techniques by
USENIX Association
30th USENIX Security Symposium    4329
signiﬁcant margins. For instance, with an adversary’s back-
ground knowledge on a real-world 5-month dataset, tracking
target users or discovering unique users could achieve 99%
or 88% accuracy. This performance dramatically outperforms
the state-of-the-art correlation system Deepcorr [34] which
demonstrates only 85% or 60% accuracy.
Contributions. Our contributions can be summarized as:
• We introduce a new IPv6 address correlation attack that
effectively correlates a user’s TLS encrypted trafﬁc with
its dynamic address.
• We present a knowledge graph-based approach to model
user behavior behind addresses. It exploits multi-type
semantic meta-information to facilitate user correlation.
• We propose a correlation attack model – SIAMHAN
which demonstrates superior performance on IPv6 user
activity correlation.
• We conduct extensive experiments on a 5-month IPv6
user TLS trafﬁc dataset. Results show that SIAMHAN
is robust and could reach drastically high accuracy on
multiple long-term user correlation tasks.
Roadmap. Section 2 summarizes the prior researches re-
lated to our work. Section 3 introduces the threat model and
the basic knowledge about IPv6 address correlation attacks.
Section 4 highlights the overall design of SIAMHAN. Section
5 presents the main setting for experiments. Section 6 shows
the evaluation results and Section 7 discusses the mitigations
against the attack. Section 8 concludes the paper.
2 Related Work
From the objective perspective, prior works relevant to ours
are user activity correlation. From the technical perspective,
the works mostly relevant to ours are heterogeneous graph
representation learning as well as metric learning. In the fol-
lowing, we summarize and discuss these works.
2.1 Address Structure Learning
One technique to correlate user activities with addresses is
to learn address structure and infer user address conﬁgu-
ration schemes. RFC 7707 [15] points out known address
conﬁguration schemes and possible administrator conﬁgura-
tion customs. The measurement work in the document in-
dicates that most addresses follow speciﬁc patterns, which
means that even an address conﬁguration with transform ad-
dresses, such as DHCPv6 [32], may be compromised by ad-
dress structure learning to narrow the target user range. A
body of work [10, 12, 13] could even learn the addressing
pattern through unsupervised clustering or neural networks
to facilitate active user discovery. However, RFC 4941 [33]
proposed a temporary address conﬁguration scheme to re-
place the traditional addressing with pseudo-random interface
identiﬁers that change over time, making it extremely difﬁ-
cult to identify users from the address structure. Ullrich et
al. [47] analyzed the temporary address generation algorithm
and showed that it is possible to infer a user’s future tem-
porary addresses through long-term observations. Because
the observation must be conducted on one single user host,
address correlation with large-scale users is still impossible
to implement. Finally, RFC 7721 [9] discussed the privacy
and security considerations of the IPv6 address generation
mechanism and indicated that certain constant information
associations might lead to prolonging the observation time
of temporary addresses. It is consistent with the idea of our
attack. Our work will complete long-term user activity cor-
relation through a combination of address structure learning
and trafﬁc characteristics learning.
2.2 Trafﬁc Characteristics Learning
Another technique to correlate user activities with addresses
is to extract multiple trafﬁc characteristics and then iden-
tify users. Since the trafﬁc contains multiple dimensions
of user meta-information, moderate learning on the trafﬁc
characteristics has proved powerful performance in multiple
tasks, including ﬂow correlation [34, 42], website ﬁngerprint-
ing [39, 40, 51], and trafﬁc classiﬁcation [29]. Prior work
mainly learns trafﬁc characteristics from three dimensions,
including user proﬁling [16, 27], TLS ﬁngerprinting [2], and
ﬂow sequences [34].
User Proﬁling. User proﬁling refers to using behavior-
based statistical features to construct a user proﬁle. Kumpost
et al. [27] employed the target IP address to create user pro-
ﬁles to identify these users in future trafﬁc. Banse et al. [20]
generate user proﬁles by collecting user DNS requests and
utilize a Bayesian classiﬁer [31] to track users on the univer-
sity network. In the case of TLS trafﬁc, Gonzalez et al. [16]
showed that leveraging Server Name Indication (SNI) infor-
mation could effectively collect user online interests.
TLS Fingerprinting. TLS Fingerprinting is a technique
that extracts parameters from a TLS ClientHello to provide
visibility into the application that creates the session. Applica-
tions of TLS ﬁngerprinting include malware detection [3], op-
erating system identiﬁcation [2], and client identiﬁcation [22].
Due to the difference in ﬁngerprints of different browsers, it
is possible to distinguish users to a certain extent. Several
open-source databases have been released include [1, 7, 30].
Flow Sequences. Flow sequences are the packet timings
and packet sizes collected during the user communications.
Nasr et al. [34] exploited ﬂow sequences to link the egress and
ingress segments of a Tor connection. Liu et al. [29] could dis-
tinguish the application types of user-generated trafﬁc through
the characteristic. These works show the effectiveness of ﬂow
sequence for user activity identiﬁcation.
4330    30th USENIX Security Symposium
USENIX Association
Figure 1: The threat model of IPv6 address correlation attacks. The adversary could collect IPv6 client addresses and their TLS
trafﬁc within time t as the background knowledge κt to conduct correlation learning for user tracking or user discovery.
While multi-dimension characteristics could be extracted
in TLS encrypted trafﬁc, the complexity of user activity brings
extreme difﬁculty when applied on a large scale. Therefore,
prior work is mainly performed on a closed-world dataset,
i.e., re-identifying training users on the test set. In this work,
we exploit graph-based user proﬁles to develop the correla-
tion attack model in IPv6 scenarios, achieving strong user
correlation on an open-world dataset for unknown users.
2.3 Heterogeneous Graph Embedding
Graph data is a powerful tool to model the complex relation-
ships between entities. Therefore, a family of machine learn-
ing techniques known as Graph Neural Networks (GNNs)
[18, 26, 49, 52] was proposed to analyze graphs. With the
growing performance of GNNs and considerable research
interest, researchers are no longer satisﬁed with the study of
homogeneous graphs. The real-world graph usually comes
with multi-types of nodes and edges, also widely known as
Heterogeneous Information Networks (HIN) [38]. Because
the heterogeneous graph contains more comprehensive infor-
mation and rich semantics, it has been widely used in many
data mining tasks [35, 50]. For instance, Wang et al. [52] pro-
posed a Heterogeneous Graph Attention Network (HAN) to
provide powerful performance on node classiﬁcation and clus-
tering tasks. To express the user activities behind the client
address in the trafﬁc with sufﬁcient semantic information, we
employ a heterogeneous graph as the knowledge of user be-
havior and exploit a multi-level attention mechanism to learn
the graph embedding for correlation tasks.
2.4 Metric Learning
Metric learning, also known as distance metric learning, is
learning a distance metric for the input space of data from a
given collection of pairs of similar or dissimilar entities. The
core idea of distance metric is applied by many representative
works, including KNN and SVM [54]. With the development
of deep learning, Siamese Networks [8] is proposed to employ
a pair of shared weight network architecture and contrastive
loss function to model the distance metric. The simplicity and
extensibility of the network structure lead the Siamese Net-
work widely applied in computer vision tasks, including face
recognition [45] and object tracking [19]. In this paper, we
implement a Siamese Network framework based on hetero-
geneous graph data, called SIAMHAN, to acquire a reliable
correlation metric between IPv6 client addresses.
3 Preliminaries
This section proposes the threat model of IPv6 address corre-
lation attacks and a brief basic knowledge related to our attack
model, including IPv6 addressing and TLS communications,
to help readers understand this paper.
3.1 Threat Model
Figure 1 shows the threat model of IPv6 address correlation
attacks. In an IPv6 network, N IPv6 users may generate C
client addresses to access online services within a period t.
There usually is |N| ≤ |C| due to frequent changes of the
client addresses. However, the relationship between users and
addresses cannot be detected using packet contents due to TLS
encryption. For instance, Ci and Cj are two IPv6 addresses
of a user observed in the trafﬁc during the period t. However,
such association can not be detected by inspecting the packet
contents of Ci and Cj due to TLS encryption.
The goal of an adversary is to correlate two arbitrary IPv6
addresses to identify a unique user. In particular, the adver-
sary could perform an IPv6 address correlation attack, i.e.,
based on the encrypted communication behavior of all IPv6
addresses for a wiretapping time t as the background knowl-
edge κt, the adversary could judge the relationship R of a pair
of addresses (cid:104)Ci, Cj(cid:105) through a correlation function f :
R = f ((cid:104)Ci, Cj(cid:105)|κt )
(1)
The correlation function f can be learned by an attack model
providing the distance metric for arbitrary pair of IPv6 ad-
dresses, which is used to determine whether they belong to
the same user through a threshold η.
USENIX Association
30th USENIX Security Symposium    4331
Real worldN IPv6 (cid:88)sers C Client addresses with encrypted communications Observation point worldObservation time tAttack modelAdversary’s background knowledge Kt …Correlation function fPairwise inputDistance metricUser TrackingUser DiscoveryTarget samplesCorrelation AttackCorrelation TasksIPv6 Address Transform To train the attack model, the adversary could utilize some
tricks to obtain the ground truth dataset, e.g., using leaked
plaintext cookies. Although the user data is protected by TLS
encryption most of the time, a few users expose their HTTP
plaintext since they use the changing addresses and access
some websites without HTTPS deployment during adver-
sary’s trafﬁc monitoring. Then the adversary could easily
label the encryption connections of these addresses through
the plaintext cookies. It is worth noting that this situation
could only provide a small number of user labels and most
users never reveal their plaintext information. Since the attack
model only requires training with TLS data, the adversary
could perform large-scale correlation attacks on the wild TLS
trafﬁc without plaintext once obtaining the model. Another
way for the adversary to collect the training set is simulating
and generating user data by her own clients. In this case, the
adversary might require a more detailed setting to obtain a
representative dataset.
An IPv6 address correlation adversary can intercept net-
work trafﬁc at various network locations. According to the
different target user groups, these locations could be re-
lay routers, Autonomous systems (ASes), Internet exchange
points (IXPs), and website servers.
Since the IPv6 address correlation attack could model an
association relationship between any pair of addresses, we
consider that the attack could conduct user tracking and user
discovery tasks on large-scale encrypted trafﬁc:
User Tracking. Based on the adversary’s background
knowledge κt, a limited number of target users’ one client
address activity sample is known. The adversary could cor-
relate all addresses of the target users during the period t to
achieve target user tracking, which is like a classiﬁcation task
of classifying all collected samples into target user categories
or no correlation categories.
User Discovery. Based on the adversary’s background
knowledge κt, the number of users in trafﬁc is unknown. The
adversary could calculate the correlation between every two
addresses and acquire address clusters during the period t to
realize user discovery, like a clustering task of classifying all
collected samples into unknown user categories.
IPv6 Addressing
3.2
An IPv6 address consists of a global routing preﬁx, a local
subnet identiﬁer, and an interface identiﬁer (IID) [21]. While
the global routing preﬁx is determined to route trafﬁc destined
to a Local Area Network (LAN), the conﬁguration of IID is
allowed more freedom to ensure the uniqueness of the host
interface in the local network segment. RFC 7721 [9] consid-
ers the security and privacy of various address conﬁguration
schemes. These schemes show different degrees of privacy
threats in the face of address-based correlation:
• Constant IID. An IPv6 interface identiﬁer that is glob-
ally stable, i.e., the IID will remain constant even if the
Table 1: The notions of the TLS ﬁelds used in the paper.
Field Name Notion
Record version The version of the TLS protocol
employed in the Record Layer.
Client version The version of the TLS protocol by
which the client wishes to communicate.
Server version The version of the TLS protocol
ﬁnally chosen by the server.
Cipher suites A list of the cryptographic options
supported in the ClientHello or the single
cipher suite selected in the Server Hello.
Compression A list of the compression methods
supported in the ClientHello or the single
method selected in the ServerHello.
SNI The domain name speciﬁed by the client
to reach in the ClientHello extensions.
Algorithm ID The identiﬁer for the cryptographic
algorithm used to sign the certiﬁcate.
Issuer The entity that has signed and issued the
certiﬁcate in the Certiﬁcate message.
Subject The entity associated with the public
key stored in the Certiﬁcate message.
node moves from one IPv6 link to another, which could
be generated through IEEE identiﬁer [46] or static, man-
ual conﬁguration and be used to correlate activities for
the device lifetime or the address lifetime.
• Stable IID. An IPv6 interface identiﬁer that is stable per
IPv6 link, i.e., the IID will remain unchanged as long as