及SHA1值。Amcache.hve文件的位置为“%SystemRoot%\appcompat\Programs\”，
可以在【运行】对话框中输入【%SystemRoot%\appcompat\Programs\】命令，打
开Amcache.hve所在文件夹，Amcache.hve文件如图2.4.5所示。
44
第2章
网络安全应急响应工程师基础技能
图2.4.5 Amcache.hve文件
2）时间点查找
应急响应事件发生后，需要先确认事件发生的时间点，然后排查时间点前、
后的文件变动情况，从而缩小排查的范围。
（1）可列出攻击日期内新增的文件，从而发现相关的恶意软件。在Windows
系统中，可以在命令行中输入【forfiles】命令，查找相应文件，命令的参数情况
如图2.4.6和图2.4.7所示。
图2.4.6 命令参数情况1
45
网络安全应急响应技术实战指南
图2.4.7 命令参数情况2
【forfiles】命令的使用方法如图2.4.8所示。使用【forfiles /m *.exe /d +2020/2/12
/s /p c:\ /c "cmd /c echo @path @fdate @ftime" 2>null】命令就是对2020/2/12后的
exe新建文件进行搜索。在输入此命令后，找到了oskjwyh28s3.exe文件。
图2.4.8 【forfiles】命令的使用方法
还可以根据文件列表的修改日期进行排序，查找可疑文件。当然也可以搜索
指定日期范围内的文件夹及文件，如图2.4.9所示。
图2.4.9 搜索文件
（2）对文件的创建时间、修改时间、访问时间进行排查。对于人工入侵的应
急响应事件，有时攻击者会为了掩饰其入侵行为，对文档的相应时间进行修改，
46
第2章
网络安全应急响应工程师基础技能
以规避一些排查策略。例如，攻击者可能通过“菜刀类”工具改变修改时间。因
此，如果文件的相关时间存在明显的逻辑问题，就需要重点排查了，极可能是恶
意文件。如图2.4.10所示，文件的修改时间为2015年，但创建时间为2017年，
存在明显的逻辑问题，这样的文件就需要重点进行排查。
图2.4.10 文件的相关时间存在明显的逻辑问题
3）Webshell
在应急响应过程中，网站是一个关键的入侵点，对 Webshell（网站入侵的脚本
工具）的查找可以通过上述方法进行筛选后再进一步排查。还可以使用D盾、HwsKill、
WebshellKill等工具对目录下的文件进行规则查询，以检测相关的Webshell。这里以
使用D盾为例，通过扫描文件，可以直接发现可疑文件，如图2.4.11所示。
图2.4.11 使用D盾
47
网络安全应急响应技术实战指南
2．Linux系统
1）敏感目录
Linux系统常见的敏感目录如下。
（1）/tmp目录和命令目录/usr/bin /usr/sbin等经常作为恶意软件下载目录及相
关文建被替换的目录。文件名为 crloger8 的木马下载到/tmp 目录下，如图 2.4.12
所示。
图2.4.12 文件名为crloger8的木马下载到/tmp目录下
（2）此外，~/.ssh及/etc/ssh也经常作为一些后门配置的路径，需要重点检查，
如图2.4.13所示。
图2.4.13 后门配置路径
2）时间点查找
（1）通过列出攻击日期内变动的文件，可发现相关的恶意软件。通过【find】
命令可对某一时间段内增加的文件进行查找。以下为常用的【find】命令。
find：在指定目录下查找文件。
-type b/d/c/p/l/f：查找块设备、目录、字符设备、管道、符号链接、普通文件。
-mtime -n +n：按文件更改时间来查找文件，-n指n天以内，+n指n天前。
-atime -n +n：按文件访问时间来查找文件，-n指n天以内，+n指n天前。
-ctime -n +n：按文件创建时间来查找文件，-n指n天以内，+n指n天前。
48
第2章
网络安全应急响应工程师基础技能
使用命令【find / -ctime 0 -name "*.sh"】，可查找一天内新增的sh文件，如图2.4.14
所示。
图2.4.14 查找一天内新增的sh文件
在查看指定目录时，也可以对文件时间进行排序，图2.4.15是使用命令【ls -alt
| head -n 10】查看排序后前10行的内容。
图2.4.15 查看排序后前10行的内容
（2）对文件的创建时间、修改时间、访问时间进行排查。
使用【stat】命令可以详细查看文件的创建时间、修改时间、访问时间，若修
改时间距离应急响应事件日期接近，有线性关联，说明可能被篡改。使用【stat
commandi.php】命令查询文件commandi.php的时间信息，如图2.4.16所示。
图2.4.16 查询文件commandi.php的时间信息
3）特殊文件
Linux系统中的恶意文件存在特定的设置、特定的关键字信息等。Linux系统
中的几种特殊文件类型可以按照以下方法进行排查。
（1）特殊权限文件查找。如图2.4.17所示是查找777权限的文件，使用命令
【find /tmp -perm 777】，可发现crloger8文件。
49
网络安全应急响应技术实战指南
图2.4.17 特殊权限文件查找
（2）Webshell 查找。Webshell 的排查可以通过分析文件、流量、日志进行，
基于文件的命名特征和内容特征，相对操作性较高。通过分析文件的方法进行查
找，可以从Webshell中常出现的一些关键字着手，对文件进行初筛，缩小排查的
范围。例如，可使用如图2.4.18所示的语句，其中【find /var/www/ -name "*.php"】
命令是查找“/var/www/”目录下的所有php文件，【xargs egrep】及之后的命令是
查询php文件中是否包含后面的关键字。
图2.4.18 语句
除了初筛的方法，还可以使用findWebshell、Scan_Webshell.py等进行扫描排查。
（3）对系统命令进行排查。【ls】和【ps】等命令很可能被攻击者恶意替换，
所以可以使用【ls -alt /bin】命令，查看命令目录中相关系统命令的修改时间，从
而进行排查，如图2.4.19所示。
图2.4.19 查看系统命令修改时间
50
第2章
网络安全应急响应工程师基础技能
也可以使用【ls -alh /bin】命令查看相关文件的大小，若明显偏大，则文件很
可能被替换，如图2.4.20所示。
图2.4.20 查看相关文件大小
（4）Linux的后门检测，可以使用第三方查杀工具（如chkrootkit、rkhunter）
进行查杀。chkrootkit 工具用来监测 rootkit 是否被安装到当前系统中。rootkit 是
攻击者经常使用的后门程序。这类后门程序通常非常隐秘、不易被察觉，植入后，
等于为攻击者建立了一条能够长时间入侵系统或可对系统进行实时控制的途径。
因此，使用chkrootkit工具可定时监测系统，以保证系统的安全。
在使用chkrootkit时，若出现infected，则说明检测出系统后门；若未出现，
则说明未检测出系统后门，如图 2.4.21 所示。也可以使用【chkrootkit -q | grep
INFECTED】命令检测并筛选出存在infected的内容。
使用rkhunter可以进行系统命令（Binary）检测，包括MD5校验、rootkit检
测、本机敏感目录检测、系统配置检测、服务及套件异常检测、第三方应用版本
检测等。排查情况如图2.4.22和图2.4.23所示。
51
网络安全应急响应技术实战指南
图2.4.21 排查情况
图2.4.22 排查情况1
52
第2章
网络安全应急响应工程师基础技能
图2.4.23 排查情况2
（5）排查 SUID 程序，即对于一些设置了 SUID 权限的程序进行排查，可以
使用【find / -type f -perm -04000 -ls -uid 0 2>/dev/null】命令，如图2.4.24所示。
图2.4.24 排查SUID程序
2.5 日志分析
1．Windows系统
1）日志概述
在Windows系统中，日志文件包括：系统日志、安全性日志及应用程序日志，
53
网络安全应急响应技术实战指南
对于应急响应工程师来说这三类日志需要熟练掌握，其位置如下。
在Windows 2000 专业版/Windows XP/Windows Server 2003（注意日志文件的
后缀名是evt）系统中：
系统日志的位置为C:\WINDOWS\System32\config\SysEvent.evt；
安全性日志的位置为C:\WINDOWS\System32\config\SecEvent.evt；
应用程序日志的位置为C:\WINNT\System32\config\AppEvent.evt。
在Windows Vista/Windows 7/Windows 8 /Windows 10/Windows Server 2008及
以上版本系统中：
系统日志的位置为%SystemRoot%\System32\Winevt\Logs\System.evtx；
安全性日志的位置为%SystemRoot%\System32\Winevt\Logs\Security.evtx；
应用程序日志的位置为%SystemRoot%\System32\Winevt\Logs\Application.
evtx。
（1）系统日志。
系统日志主要是指Windows系统中的各个组件在运行中产生的各种事件。这
些事件一般可以分为：系统中各种驱动程序在运行中出现的重大问题、操作系统
的多种组件在运行中出现的重大问题及应用软件在运行中出现的重大问题等。这
些重大问题主要包括重要数据的丢失、错误，以及系统产生的崩溃行为等。事件
ID为8033的系统日志详情如图2.5.1所示。
图2.5.1 事件ID为8033的系统日志详情
54
第2章
网络安全应急响应工程师基础技能
（2）安全性日志。
安全性日志与系统日志不同，安全性日志主要记录了各种与安全相关的事件。
构成该日志的内容主要包括：各种登录与退出系统的成功或不成功的信息；对系
统中各种重要资源进行的各种操作，如对系统文件进行的创建、删除、更改等操
作。事件ID为513的安全性日志详情如图2.5.2所示。（注意：由于系统版本不同，
部分“安全性”日志也可写为“安全”日志。）
图2.5.2 事件ID为513的安全性日志详情
（3）应用程序日志。
应用程序日志主要记录各种应用程序所产生的各类事件。例如，系统中SQL
Server数据库程序在受到暴力破解攻击时，日志中会有相关记录，该记录中包含与
对应事件相关的详细信息。事件ID为18456的应用程序日志详情如图2.5.3所示。
除了上述日志，Windows系统还有其他的日志，在进行应急响应和溯源时也
可能用到。
在Windows 2000专业版/Windows XP/Windows Server 2003系统中，只有应用
程序、安全性及系统三类日志，如图2.5.4所示。
在Windows 7/Windows 8 /Windows 10/Windows Server 2008/Windows Server
2012等系统中进行应急响应时，除了会用到应用程序、安全性及系统三类日志，
还会用到其他日志，如 Dhcp、Bits-Client 等，这些日志存储在“%SystemRoot%\
55
网络安全应急响应技术实战指南
System32\Winevt\Logs”目录下，如图2.5.5所示。
图2.5.3 事件ID为18456的应用程序日志详情
图2.5.4 应用程序、安全性及系统三类日志 图2.5.5 其他日志
还可以在【运行】对话框中输入【eventvwr】命令，打开【事件查看器】窗