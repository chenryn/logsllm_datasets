# 工控实战不同项目下PROFINET通讯搭建
|
##### 译文声明
本文是翻译文章
译文仅供参考，具体内容表达以及含义原文为准。
## 前言
PROFINET是开放的、标准的、实时的工业以太网标准，是基于20年来PROFIBUS
DP的成功应用经验，并将常用的用户操作与以太网技术中的新概念相结合。作为PROFINET的一部分，PROFINET
IO是用于实现模块化、分布式应用的通信概念。这样，通过多个节点的并行数据传输可更有效地使用网络。  
PROFINET作为基于以太网的自动化标准，它定义了跨厂商的通信、自动化系统和工程组态模式。本文介绍西门子不同项目（不同组态软件）下、变频器（不同品牌）进行PROFINET通讯。
## 一、简介
###  1、网络结构
本次测试项目中，选择S7-1200为控制器，S7-300、ET200M、S7-200SMART、G120变频器（西门子）和GA700变频器（安川）为IO智能设备，网络结构如下：
图1.1 网络结构
###  2、使用环境
① S7 1215C V4.1  
② S7 315-2PN/DP V3.2  
③ S7 200SMART ST40  
④ IM153-4 V4.0  
⑤ TIA 博途 STEP7 V13 SP1  
⑥ STEP 7 V5.6  
⑦ STEP 7-MicroWIN SMART V2.05
###  3、实现功能
用于演示不同项目S7-1200与S7-300、S7-200SMART、分布式I/O
ET200M和不同品牌变频器G12O变频器（西门子）、GA700变频器（安川）PN口之间的PROFINET通信。主要是通过GSD文件进行数据传输。
ET200M和G12O变频器（西门子）分别在分布式I/O、其他现场设备中添加，I/O地址直接占用S7-1200
I/O地址，也可自行设置。S7-300和S7-200SMART需要通过安装GSD文件传输数据。注：如果在其他现场设备中找不到所需的G12O变频器（西门子）型号，可到官网下载GSD文件进行安装，步骤和I-Device安装步骤一样。  
GA700变频器（安川）的GSD文件可在安川电机官网下载安装，步骤和I-Device安装步骤一样。
S7-300 CPU设置为I-Device，建立两个传输区，并导出S7-300 CPU的GSD文件：  
① 传输区_1：S7-300 CPU接收从IB10开始，长度为20个字节；  
② 传输区_2：S7-300 CPU发送从QB10开始，长度为20个字节。
S7-200SMART CPU也设置为I-Device，建立两个传输区，并导出S7-200SMART CPU的GSD文件：  
① 传输区_1：S7-200SMART CPU接收从IB1152开始，长度为10个字节；  
② 传输区_2：S7-200SMART CPU发送从QB1152开始，长度为10个字节。
S7-1200 CPU设置为IO-Controller，并导入S7-300 CPU和S7-200SMART的GSD文件：  
① 传输区_1：S7-1200 PN CPU发送从QB10开始，长度为20个字节；  
② 传输区_2：S7-1200 PN CPU接收从IB10开始，长度为20个字节；  
③ 传输区_3：S7-1200 PN CPU接收从QB1152开始，长度为10个字节；  
④ 传输区_4：S7-1200 PN CPU发送从IB1152开始，长度为10个字节。
## 二、组态步骤
###  1、主控制器组态
在TIA
Portal组态软件中，创建一个新项目。然后进入“项目视图”对S7-1200进行硬件组态。在CPU属性窗口，修改控制器名称（S7-1200）和设置IP地址，并在“设备视图”窗口中，继续添加IO模块。
图2.1 添加CPU
图2.2 修改名称
图2.3 修改IP地址
###  2、IO智能设备组态
####  2.1 ET200M接口模块组态
在TIA Portal组态软件继续组态，ET200M接口模块和G120变频器组态步骤一样，以ET200M接口模块为例。  
在网络窗口添加ET200M接口模块IM 153-4PN，并在设备视图进行硬件配置，根据实际的模块型号，插入电源模块和DI、DO模块到相应的槽位。
图2.4 添加分布式I/O
在“属性”>“常规”的“名称”中修改该接口模块的设备名称（ET200M）。
图2.5 修改名称
在“属性”>“常规”>“以太网地址”中设置IP地址“192.168.30.62”。注意要与S7-1200 CPU的IP地址在同一个网段，且地址不能重复。
图2.6 修改IP地址
在“网络视图”中将ET200M分配给S7-1200，S7-1200作为ET200M的控制器。
图2.7 分配控制器
####  2.2 S7-300组态
使用STEP7 V5.6创建一个新项目，并在硬件组态界面中组态315-2 PN/DP，设置IP地址，并确认设备名称。注意要与S7-1200
CPU的IP地址在同一个网段，且地址不能重复。
图2.8新建项目
图2.9 配置CPU
然后在属性窗口“I设备”选项中，勾选“I设备模式”，新建传送区域，注意，地址不能冲突。
图2.10 新建传送区域
展开菜单栏中的选项，选择“创建用于I设备的GSD文件”，导出GSD文件。
图2.11 创建GSD文件
图2.12 导出GSD文件
图2.13 GSD文件存储位置
####  2.3 S7-200SMART组态
使用STEP 7-MicroWIN SMART新建一个项目，选择CPU ST40，在系统块窗口通信中，设置IP地址和站名称。注意要与S7-1200
CPU的IP地址在同一个网段，且地址不能重复。
图2.14 修改CPU IP地址
在启动选项中，选择“CPU模式”为“RUN”。
图2.15 修改CPU启动模式
在项目树窗口中，展开项目>向导，双击打开“PROFINET”，勾选PLC角色为“智能设备”，以太网端口选择固定IP地址及站名。
图2.16 打开PROFINET配置窗口
图2.17 修改PLC角色和以太网端口
在“智能设备配置”窗口中，添加输入/输出两个传输区，并导出GSD文件。
图2.18 添加传送区和导出GSD文件
###  3、GSD文件安装
打开TIA
Portal组态软件，在菜单栏中，展开“选项”，选择“管理通用站描述文件（GSD）”，在弹出的窗口中，分别找到S7-300、S7-200SMART、GA700变频器（安川）的GSD文件的源路径，安装GSD文件。以S7-300为例。
图2.19 打开GSD文件安装窗口
图2.20 安装GSD文件
图2.21 安装GSD文件成功
安装完成后，在硬件目录中的“其他现场设备”>“PROFINET IO”中找到已安装的IO智能设备。然后拖拉到窗口中。
图2.22 添加IO智能设备
在GA700变频器属性窗口中，修改IP地址。注意要与S7-1200 CPU的IP地址在同一个网段，且地址不能重复。
图2.23 GA700变频器修改IP地址
然后分配到S7-1200。经过上述的操作，在项目的网络视图中得到完整的网络结构。
图2.24 完整网络结构
###  4、分配名称
分配名称操作都一样，以ET200M分配名称为例。  
在“设备视图”中，右键选择“分配设备名称”。
图2.25 打开分配名称窗口
勾选“闪烁LED”，观察模块指示灯是否闪烁，来确认PROFINET设备。选择要分配的设备，点击“分配名称”。
图2.26 分配设备名称
分配设备名称可能需要几秒钟的时间，在这期间软件界面是禁止操作的。注意，未分配名称，或者名称不一致，都会导致之后下载错误。
图2.27 分配成功
###  5、编译下载
将S7-300、S7-200SMART以及S7-1200的硬件配置编译后下载。
图2.28 下载硬件配置
## 三、通讯调试
系统结构建立后，PROFINET
IO控制器S7-1200、智能设备S7-300、S7-200SMART、M151-3、G12O变频器和GA700变频器之间可以进行数据交换。  
以S7-300为例。对S7-1200的QB10赋值为1，观察S7-300的IB10的值。
图3.1 S7-1200 QB10的值
图3.2 S7-300 IB10的值
用户也可以根据自己的需求进行编程，从而实现不同的控制算法，以及使用画面组态软件展示出来。
图3.3 编程
图3.4 画面展示
结束语
大禹工控安全实验室
由中国网安·广州三零卫士成立，汇聚国内多名漏洞挖掘、二进制逆向、安全分析、渗透测试、自动化工程师等安全专家组建而成，专注于工业控制系统安全、工业物联网安全、工业威胁情报安全等安全领域，大禹工控安全实验室始终坚持在工业控制系统安全领域进行探索和研究。
IRTeam工控安全红队
属于民间工业安全组织，由经验丰富的工控安全研究员组成，一直在学习和研究最新的工控漏洞及漏洞利用和防护，同时开发了Kali
ICS工控渗透平台能够提供全方位的工控漏洞挖掘和渗透测试。在工控的协议安全、HMI安全、工业云安全等领域有着丰富的经验和成果。