# Hillstone Networks
## 山石网科网络安全审计系统
### 日志信息参考指南
**版本**: 2.0R1  
**版权**: © 2021 Hillstone Networks. 保留所有权利。

---

本文件中的信息可能会在不另行通知的情况下更改。本文档中描述的软件受许可协议或保密协议约束，仅可在遵守这些协议条款的情况下使用或复制。未经Hillstone Networks书面许可，不得以任何形式或任何手段（电子或机械）对本出版物的任何部分进行复制、存储于检索系统或传输，除非用于购买者的个人用途。

---

### 联系信息
**公司总部（北京总部）**:
- **地址**: 北京市海淀区宝盛南路1号院20号楼5层
- **邮编**: 100192
- **联系我们**: [https://www.hillstonenet.com.cn/about/contact_Hillstone.html](https://www.hillstonenet.com.cn/about/contact_Hillstone.html)

### 关于本手册
本手册介绍了Hillstone Networks公司的山石网科网络安全审计系统的日志信息，包括日志参数、产生原因及处理建议等内容，旨在为用户进行系统诊断和维护提供参考。假设您已具备数据通信技术知识，并熟悉网络产品。

更多文档资料，请访问: [https://docs.hillstonenet.com](https://docs.hillstonenet.com)  
针对本文档的反馈，请发送邮件至: PI:EMAIL

---

## 目录
1. 简介
2. 日志格式说明
3. 如何获取日志信息
4. 将日志信息保存到日志文件
5. 将日志信息发送到日志服务器
6. 日志模块列表
7. 文档使用说明
8. 系统管理日志
   - 用户上下线日志
     - IMC认证上下线通知
     - 免认证上下线通知
     - APP认证上下线通知
     - 微信认证上下线通知
     - 本地WEB认证上下线通知
     - 短信认证上下线通知
     - 单点登录上下线通知
     - 二维码认证上下线通知
     - IC卡认证上下线通知
     - POP3认证上下线通知
     - 钉钉认证上下线通知
9. 系统操作日志
10. 事件日志
11. 健康日志
12. 整机转发流量日志
13. 流量日志
14. 流阻断日志
15. NAT日志
16. IPSec流量日志
17. VPN告警日志
18. 网站访问日志
19. 恶意URL日志
20. 内容审计日志
21. 安全日志
22. 行为模型日志
23. 终端日志
24. 移动终端日志
25. 共享接入日志
26. 用户注册申请日志
27. 用户注册审批日志
28. 应用控制日志

---

## 简介
本文档详细介绍了山石网科SG-6000-ICM系列网络安全审计系统的日志信息，涵盖日志参数、产生原因及处理建议等，帮助用户进行系统诊断和维护。

## 日志格式说明
默认情况下，日志采用以下格式：
```
<PRI>time name msg
```

### 日志头字段说明
| 字段 | 描述 |
| --- | --- |
| PRI | 由尖括号包含的一个数字，表示程序模块（Facility）和严重性（Severity）。该数字由Facility乘以8加上Severity计算得出。 |
| time | 时间紧跟在PRI后面，格式为“Mmm dd hh:mm:ss”，不包括年份。月份取值包括：Jan、Feb、Mar、Apr、May、Jun、Jul、Aug、Sep、Oct、Nov、Dec。 |
| name | 设备名称或IP地址，必须包含序列号（SN），格式为`device_name;sn;ipversion;msgversion`。 |

### 日志等级说明
| 级别 | 严重程度 | 描述 |
| --- | --- | --- |
| 0 | Emergency | 表示设备不可用的信息，如系统授权已到期。 |
| 1 | Alert | 表示设备出现重大故障，需要立即响应的信息，如流量超出接口上限。 |
| 2 | Critical | 表示严重信息，如设备温度超过预警值，电源或风扇故障等。 |
| 3 | Error | 表示错误信息，如接口链路状态变化，存储卡拔出等。 |
| 4 | Warning | 表示警告信息，如接口连接断开，内存耗尽告警等。 |
| 5 | Notification | 表示正常但重要的信息，如通过终端登录设备，设备重启等。 |
| 6 | Informational | 表示需要记录的通知信息，如命令行输入命令的记录信息，执行ping命令的日志信息等。 |
| 7 | Debug | 表示调试过程产生的信息。 |

### 可变参数域
| 参数标识 | 参数类型 |
| --- | --- |
| INT16 | 有符号的16位整数 |
| UINT16 | 无符号的16位整数 |
| INT32 | 有符号的32位整数 |
| UINT32 | 无符号的32位整数 |
| INT64 | 有符号的64位整数 |
| UINT64 | 无符号的64位整数 |
| DOUBLE | 有符号的双32位整数，格式为[INT32].[INT32] |
| HEX | 十六进制数 |
| CHAR | 字节类型 |
| STRING | 字符串类型 |
| IPADDR | IP地址 |
| MAC | MAC地址 |
| DATE | 日期 |
| TIME | 时间 |

## 如何获取日志信息
默认情况下，设备的日志功能处于开启状态，并允许向控制台（console）、WEB页面、日志服务器（loghost）和本地日志文件（logfile）输出日志信息。您可以在WEB页面上实时查看系统输出的日志信息，也可以通过`show log event`命令查看事件日志信息。

通过`log`命令可以设置日志信息的输出规则，指定日志的输出方向以及哪些特性模块或信息等级的日志信息进行输出。所有信息等级高于或等于设置等级的日志信息都会被输出到指定的输出方向。例如，如果输出规则中指定允许等级为6（informational）的信息输出，则等级0～6的信息均会被输出到指定的输出方向。

### 注意事项
- 监视终端是指以AUX、VTY、TTY类型用户线登录的用户终端。
- 配置日志服务器后，日志服务器可以实时监控日志信息。
- 本地日志文件可以记录日志信息，但只能通过WEB页面查看。

## 将日志信息保存到日志文件
默认情况下，系统根据通过`log`命令配置的日志过滤条件，将需要记录的日志实时记录到日志文件中。日志文件中的内容可以通过WEB页面中的日志查询实时查看。

## 将日志信息发送到日志服务器
您可以通过配置日志服务器向指定的IP地址发送设备的日志信息，同时配置日志服务器接收日志信息的端口号（默认为514）。如果设备侧配置的日志服务器接收日志信息的端口号与日志服务器侧不一致，则日志服务器将无法接收日志信息。您可以指定多个不同服务器同时接收设备生成的日志信息，但最多可指定3个。

## 日志模块列表
表4列出了所有可能生成日志信息的日志模块。

### 日志模块列表
| 模块名 | 说明 |
| --- | --- |
| 系统管理日志 | 包括系统操作日志和系统状态日志。 |
| 流量日志 | 与流量相关的日志。 |
| IPSec日志 | IPSec VPN相关的日志。 |
| 网站访问日志 | 所有访问过的网站。 |
| 应用控制日志 | 应用控制策略相关的日志。 |
| 恶意URL日志 | 访问的恶意URL。 |
| 内容审计日志 | 审计出的流量的内容。 |
| 防攻击日志 | 发生攻击的日志。 |

## 文档使用说明
本文将系统日志信息按照日志模块分类，并以表格形式介绍日志信息。有关表中各项的含义请参考下表。

### 日志信息表内容说明
| 表项 | 说明 | 举例 |
| --- | --- | --- |
| 日志内容 | 显示日志信息的具体内容 | `ACL [$1:UINT32] [$2:STRING] [$3:COUNTER64] packet(s).` |
| 参数解释 | 按照参数在日志中出现的顺序对参数进行解释 | `$1：ACL编号` <br>`$2：ACL规则的ID和内容` <br>`$3：与ACL规则匹配的数据包个数` |
| 日志等级 | 日志严重等级 | `6` |
| 举例 | 一个真实的日志信息举例 | `operator_name=admin; operate_ip=192.168.1.105; create_time=2014-07-22 17:56:32; level=notice; reason=mod; result=success; managestyle=WEB; content=mod syslog configuration` |
| 日志说明 | 解释日志信息和日志生成的原因 | `匹配一条ACL规则的数据包个数。该日志会在数据包个数发生变化时输出。` |
| 处理建议 | 建议用户应采取哪些处理措施 | `级别为6的“Informational”日志信息是正常运行的通知信息，用户无需处理。` |

## 系统管理日志
本节介绍系统管理输出的日志。

### 用户上下线日志
#### IMC认证上下线通知
##### IMC认证上线通知
- **日志内容**: `[$1:Imc] [$2:login]: logname=[$3:USERNAME] realname=[$4:REALNAME] groupname=[$5:GROUPNAME]@[$6:IPADDR]($7:MACADDR)`
- **参数解释**:
  - `$1`: IMC认证。
  - `$2`: 认证上线。
  - `$3`: 认证用户名字。
  - `$4`: 用户真实名称。
  - `$5`: 用户组名称。
  - `$6`: 用户IP地址。
  - `$7`: 用户MAC地址。
- **日志等级**: `5`
- **举例**: `Imc login:logname=123 realname=321 groupname=test @1.1.1.1(8c:34:fd:26:0f:50)`
- **日志说明**: IMC认证上线通知。
- **处理建议**: 无。

##### IMC认证下线通知
- **日志内容**: `[$1:Imc] [$2:logout]: logname=[$3:USERNAME] realname=[$4:REALNAME] groupname=[$5:GROUPNAME]@[$6:IPADDR]($7:MACADDR) login at [$8:TIME], logout at [$9:TIME], duration is [$10:TIME], reason is [$11:logout/kickoff]`
- **参数解释**:
  - `$1`: IMC认证。
  - `$2`: 认证下线。
  - `$3`: 认证用户名字。
  - `$4`: 用户真实名称。
  - `$5`: 用户组名称。
  - `$6`: 用户IP地址。
  - `$7`: 用户MAC地址。
  - `$8`: 登录时间。
  - `$9`: 退出时间。
  - `$10`: 登录时常。
  - `$11`: `logout`/`kickoff`（退出/强制下线）。
- **日志等级**: `5`
- **举例**: `Imc logout:logname=test realname=testabc groupname=test @1.1.1.1(8c:34:fd:26:0f:50) login at 2016-05-25 09:17:26, logout at 2016-05-25 09:18:52, duration is 85s, reason is logout`
- **日志说明**: IMC认证下线通知。
- **处理建议**: 无。

#### 免认证上下线通知
##### 免认证上线通知
- **日志内容**: `[$1:Free] [$2:login]: [$3:USERNAME]@[$4:IPADDR]($5:MACADDR)`
- **参数解释**:
  - `$1`: 免认证方式。
  - `$2`: 认证上线。
  - `$3`: 认证用户名字。
  - `$4`: 用户IP地址。
  - `$5`: 用户MAC地址。

---

以上是对原文档的部分优化，使其更加清晰、连贯和专业。如果有其他部分需要进一步优化，请告知。