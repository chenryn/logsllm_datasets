(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
Application Migration
 Object Names / Identifiers
Names of schema, tables, columns, functions, …
Oracle converts them to UPPER CASE, unless quoted
Postgres converts them to lower case, unless quoted
You're safe if application quotes/does not quote the identifiers
 Consistency is the key
31
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
Application Migration
 Outer Join Syntax
In Oracle, WHERE clause entries mark the NULL augmented side
with a (+)
Oracle was ahead of the SQL Standards Committee
Postgres provides SQL Standard syntax {LEFT|RIGHT|FULL}
[OUTER] JOIN; and so does Oracle.
SELECT e.name, d.name FROM emp e, dept d WHERE e.deptno
= d.deptno (+)
SELECT e.name, d.name FROM emp e LEFT JOIN dept d ON
e.deptno = d.deptno
32
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
Application Migration
 INTERSECT
Becomes EXCEPT
 Function Call using named notation
=> becomes :=
For example:
var = fn( c => 10, a => 'xyz', b => 2.5);
becomes
var = fn( c := 10, a := 'xyz', b := 2.5);
 DUAL
Just a 1-row x 1-column table for expression evaluation
Orafce provides this table.
33
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
Application Migration
 ROWNUM
Use ROW_NUMBER() windowing function
Use as a wrapper around the main query, if needed.
 ROWID
Use CTID system column
 May fail when used in conjunction with partitioning
Use OID column
 Has performance implication since it creates an implicit index
 Optimizer Hints
Postgres doesn't have them, and doesn't want them.
Discard, or keep for future reference; they won't bite you
34
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
Application Migration
 Empty strings are NULLS ?!
Oracle treats empty string '' as NULL. Non-standard and
confusing.
 ’’ = ’’ is not true
 Concatenation operator || disregards NULL semantics
SQL> select ’crazy’ result from dual where (’a’ || ’’ ) = ( ’a’ || ’’ );
RESULT
------
crazy
Needs careful examination of queries comparing empty string
35
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
Builtin Functions
36
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
Builtin functions
 NVL
Provided by Orafce
Or use SQL standard COALESCE()
 More flexible
 DECODE
Use the SQL Standard CASE clause
Postgres now has VARIADIC; it might be possible to implement
this where all parameters' data types are same.
 TO_CHAR()
Postgres has this, but not very robust; requires testing of queries.
Orafce provides the 1-argument version
37
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
Builtin functions
 SUBSTR()
Postgres provides this.
Postgres also provides SQL standards compliant syntax
 SYSDATE
Use current_timestamp
38
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
DBA Migration
(Database Architecture)
39
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
DBA Migration
 Postgres’ process architecture is similar to Oracle
Have them attend some of Bruce's talks :)
No Rollback Segments
SGA => ~ shared_buffers
PGA => ~ work_mem
PMON => Postmaster
TNS Listener => Postmaster
GRANT/REVOKE => Almost the same; mostly syntax change
40
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
Porting Tools
41
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
Porting Tools
 Orafce
A lot of Oracle compatibility functions
 DBMS_ALERT
 DBMS_PIPE
 UTL_FILE
 DBMS_OUTPUT
 DBMS_RANDOM
 Date operations
 to_char(param1) for various data types
DUAL table
Packages for various platforms (RPM, .deb)
42
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
Porting Tools
 Ora2pg
Pretty advanced schema and data extraction
Extracts PL/SQL too; Packages, Functions, Procedures
Tries to convert PL/SQL
Export to file, multiple files, compressed
Export directly to Postgres
43
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
Porting Tools
 DBD::Oracle
Perl module
Develop your own extraction tools
Ora2pg uses this
Packages available for different platforms
 Migration Tool Kit (MTK)
Developed by EnterpriseDB
Mainly for Oracle to Postgres Plus Advanced Server migration
May help in Oracle to Postgres migration
Does not convert PL/SQL code
Maps data types
44
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
Ora2pg
45
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
Ora2pg
 Export Schema
Tables
PRIMARY KEY
UNIQUE
FOREIGN KEY
CHECK
Views
Sequences
Indexes
 Export Privileges
GRANT
46
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
Ora2pg
 Export partitions
Range
List
No Hash partitions (yet)
 Ability to export specific objects
 Ability to apply WHERE clause
 Export BLOB type as Postgres’ BYTEA
 Export Oracle VIEWs int Postgres TABLEs
 Rudimentary PL/SQL to PL/PGSQL conversion help
 Platform independent
47
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
Ora2pg
 Many ways to export
Export to a single file
Export to multiple files
Compress output files using gzip or bzip
Export directly to Postgres (not recommended as first step)
48
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
Ora2pg
 Steps to export
Everything is specified in a config file
 Ora2pg config config_file.conf
Define Oracle's connection paramters
 ORACLE_HOME
 ORACLE_DSN
 dbi:Oracle:host=oradb_host.mydom.dom;sid=TEST
 ORACLE_USER (recommended to use a sysdba/super-admin role)
 ORACLE_PWD
 USER_GRANTS = 0/1 (if running as non admin user)
 TRANSACTION
 readonly, readwrite, serializable, committed
49
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
Ora2pg
 Steps to export (continued)
Define objects to export
 SCHEMA : Schema in Oracle
 EXPORT_SCHEMA 0/1: Create a new schema in Postgres
 PG_SCHEMA : Export into this Postgres schema (renaming)
 SYSUSERS : Export objects owned by these system users too.
 TYPE : What kind of export you want; can specify only one.
 TABLE, VIEW. SEQUENCE, TABLESPACE
 FUNCTION, PROCEDURE, PACKAGE
 TRIGGER, GRANT, TYPE
 DATA, COPY
 PARTITION : Work-in-progress
50
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
Ora2pg
 Steps to export (continued)
Define objects to export (continued)
 TABLES : List of tables to export
 EXCLUDE : Export all tables, but not these
 WHERE: Apply a WHERE clause to tables being exported
 WHERE touched_time >= ’2010-01-01 00:00:00’
 WHERE my_table[ ID=200 ]
 WHERE mytab1[ id=100] date_created > ’2010...’ mytab2[ id = 54 ]
Modify structure
 MODIFY_STRUCT
 MODIFY_STRUCT T_TEST1(id,dossier) T_TEST2(id,fichier)
 REPLACE_COLS
 REPLACE_COLS T_TEST(dico : dictionary,dossier : folder)
51
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
Ora2pg
 Control the output
DATA_LIMIT: Limit number of incoming rows in memory
OUTPUT: output file name; .gz or .bz2
OUTPUT_DIR: Where to put output file(s)
BZIIP2: Location of bzip2 executable
FILE_PER_TABLE: One output file per table
FILE_PER_FUNCTION: One function/trigger per file
TRUNCATE_TABLE: Truncate the table before loading;
DATA/COPY mode only
52
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
Ora2pg
 Import into Postgres
PG_DSN
 dbi:Pg:dbname=pgdb;host=localhost;port=5432
PG_USER
PG_PWD
53
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
Ora2pg
 Control objects exported
SKIP: List of schema constraint type to skip
 pkeys, fkeys, ukeys, indices, checks
 SKIP indices,checks
KEEP_PKEY_NAMES
 Keep Primary Key names from Oracle.
FKEY_DEFERRABLE
 Mark all Foreign Keys as deferrable
DEFER_FKEY
 Defer deferrable Foreign Keys during data load.
DROP_FKEY
 Drop Foreign Keys before data load, and recreate them later
54
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
Ora2pg
 Control objects exported (continued)
DROP_INDEXES
 Drop Indexes before data load, and recreate them afterwards
DISABLE_TABLE_TRIGGERS: 0/USER/ALL
 Disable triggers before data load, and recreate them
afterwards
DISABLE_SEQUENCE
 Disable altering of sequences during data load.
DATA_TYPE
 Map Oracle data types to Postgres data types
 DATA_TYPE DATE:timestamp,LONG:text,LONG RAW:text
55
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
Ora2pg
 Control objects exported (continued)
CASE_SENSITIVE
 Control identifiers’ lower/upper case conversion
ORA_RESERVED_WORDS
 List of words to escape before loading into Postgres
56
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
Ora2pg
 Encoding conversion
NLS_LANG
 Set it to Oracle’s encoding
 NLS_LANG AMERICAN_AMERICA.UTF8
BINMODE
 Workaround for Perl’s Wide character in print
 BINMODE utf8
 Results in: binmode OUTFH, ":utf8";
CLIENT_ENCODING
 Workaround for: ERROR: invalid byte sequence for encoding
"UTF8": 0xe87472
 CLIENT_ENCODING LATIN9
57
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential
Thank You
58
(C) EnterpriseDB Corporation 2011. All Rights Reserved. Company Confidential