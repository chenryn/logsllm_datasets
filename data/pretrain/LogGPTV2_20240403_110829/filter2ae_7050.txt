# 【技术分享】CVE-2017-0780：拒绝服务漏洞导致Android信息应用崩溃

#### 译文声明
本文为翻译文章，原文来源：trendmicro.com
原文链接：[此处应插入原文地址]
译文仅供参考，具体内容及含义以原文为准。

#### 译者
Janus情报局
投稿方式：发送邮件至linwei#360.cn，或登录网页版在线投稿

### 前言
我们有时会收到有趣的GIF表情包，但如果这些GIF会导致你的Android信息应用崩溃呢？最近，趋势科技向谷歌报告了一个拒绝服务漏洞，该漏洞能够实现这一效果。此漏洞已被收录为 **CVE-2017-0780**。经测试确认，该漏洞影响最新的Nexus和Pixel设备。攻击者可以通过远程发送包含恶意构造数据的彩信，使受害者的Android信息应用崩溃。即使在安全模式下重启或启动设备，应用程序也无法从崩溃中恢复。

### 影响
Android信息应用在Google Play商店中的安装量超过5000万次，并且是许多Nexus和Pixel设备的默认信息应用（不可卸载）。这对终端用户和企业的影响显而易见。例如，企业可以利用该应用与客户进行沟通，用户也可以创建更加个性化的信息，而不与其他应用混淆。鉴于这款应用被定位为跨各种Android平台的无缝信息服务，其无法使用可能会对用户的沟通产生重大负面影响。

此外，若该应用无法访问，可能成为潜在攻击的催化剂，使设备所有者无法看到、删除或控制。这些攻击可能涉及接管设备的SMS/MMS功能，或者发送和接收含有恶意软件的短信。

### 技术分析
该漏洞涉及到多个未处理的Java级空指针异常（NPEs），我们在信息应用解析GIF文件的过程中发现了这些问题。攻击者只需知道一个电话号码，即可利用此缺陷将恶意GIF文件发送给潜在受害者。

Android消息应用使用 **FrameSequenceDrawable** 来显示GIF文件。**FrameSequence** 首先基于GIF文件构建一个位图对象，然后组件使用这个位图来显示GIF。然而，我们发现 **acquireAndValidateBitmap** 函数调用位图中的 **acquireBitmap** 方法（包含图像文件的像素数据）时，没有检查它是否有效。

当 **FrameSequence** 尝试从畸形的GIF文件构建位图时，**acquireBitmap** 函数会失败并返回空值。如果其他模块/组件或变量引用了这个空对象，则会触发NPE。不幸的是，Android操作系统和Android信息应用都无法处理这种异常，从而导致信息应用在解析MMS中的畸形GIF文件时崩溃。

### 缓解措施
用户可以选择刷机或将设备恢复到出厂设置，这将删除恶意GIF文件及其他存储在设备上的文件。用户需要权衡此操作的风险，或者考虑备份文件后再执行。需要注意的是，卸载并重新安装应用并不能解决崩溃问题。

另一种减轻攻击的方法是手动禁用Android信息应用的“自动下载彩信”功能，或使用不受影响的信息应用手动删除恶意MMS文件。

随着移动设备的普及，必须采用良好的安全习惯来缓解甚至防止此类威胁。对于未经请求的、可疑的或未知的消息和链接，用户应更加谨慎，并定期更新设备的操作系统及其应用。

幸运的是，最新版本的Nexus和Pixel设备已经获得了更统一或一致的补丁。然而，其他Android设备的更新仍然碎片化，因此用户应联系其设备制造商获取更新。对于企业和组织来说，IT/系统管理员应加强补丁管理策略，以提高BYOD设备的安全性。

我们已向谷歌披露了这一安全问题，他们在2017年9月1日发布的Android安全公告中提供了补丁，并已在Google Play商店部署。补丁会捕获未处理的Java级异常。谷歌还增加了安全网络日志，以监控任何利用该漏洞的攻击。