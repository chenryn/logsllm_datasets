given has a concrete and pDractical implementation. Finally, do not layer multiple steps into one
proposed solution. Each distinct step should be its own solution.
The Technical Findings and Recommendations section will likely be the major part of the report
and the time and effort invested in writing it should reflect its importance.
In describing the findings, we will present the means of replicating them, either in the body of the
report or in an appendix. We need to show exactly where the application was affected, and how to
trigger the vulnerability. A full set of steps to replicate the finding should be documented with
screenshots. This includes steps that we take for granted (such as running with administrative
privileges), as these may not be obvious to the reader.
The details should be separated into two sections:
1. The affected URL/endpoint
2. A method of triggering the vulnerability
If multiple areas are affected by the vulnerability, we should include a reference to each area. If
there is a large number of similar issues, then it’s often acceptable to provide samples with a
caveat that these are not the only areas where the issue occurs. In the latter case, we would
recommend a systemic remediation.
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 109
Made in Morocco
Penetration Testing with Kali Linux
5.2.7 Appendices, Further Information, and References
The final part of the report is the Appendices section. Things that go here typically do not fit
anywhere else in the report, or are too lengthy or detailed to include inline. This includes long lists
of compromised users or affected areas, large proof-of-concept code blocks, expanded
methodology or technical write-ups, etc. A good rule to follow is if it’s necessary for the report but
would break the flow of the page, put it in an appendix.
We may wish to include a Further Information section. In this section, we’d include things that
may not be necessary for the main write-up but could reasonably provide value for the client.
Examples would include articles that describe the vulnerability in more depth, standards for the
remediation recommendation for the client to follow, and other methods of exploitation. If there is
nothing that can add enough value, there is no reason to necessarily include this section.
References can be a useful way to provide more insight for the clienty in areas not directly relevant
to the testing we carried out. When providing references, we need to ensure we only use the most
authoritative sources, and we should also ensure that we cite them properly.
k
In this Module we discussed various tools and practices which will come in handy while we write
our penetration testing reports. However, just as within sthe penetration testing field itself, there is
no “one tool to rule them all” for report writing either. With the vast amount of reporting and note-
taking tools, we recommend experimenting witho them to find what works for you and/or the
client. In the long run, this will make report writing more comfortable and effective at the same
time.
n
There are many aspects we need to keep in mind during penetration testing and note-taking is
arguably one of the most important ones. We may end up working with thousands of computers,
i
users, applications, etc. and remembering everything as we progress without documentation is
z
close to impossible. Taking the time to document each step thoroughly will help us write a better
report in the end. It will also make our penetration test more effective, allowing us to view the
documentation as we go alDong to see what we have already done instead of repeating the steps.
Finally, we need to keep in mind who will read the report. The goal should be to make the report
useful for all potential audiences within an organization, both technical and non-technical. We can
do this by splitting the report up in different parts, using different levels of technical language in
each of them. This will ensure that everyone gets an idea of what the outcome of the penetration
test really was.
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 110
Made in Morocco
Penetration Testing with Kali Linux
6 Information Gathering
The goal of a penetration test (or pentest) is to detect security gaps to improve the defenses of
the company being tested. Because the network, devices, and software within the company’s
environment change over time, penetration testing is a cyclic activity. A company’s attack surface
changes periodically due to newly discovered software vulnerabilities, configuration mistakes
from internal activities, or IT restructuring that might expose new segments for targeting.
In this Learning Module, we’ll learn how to methodically map such an attack surface using both
passive and active means, and understand how to leverage this information during the entire
penetration test lifecycle.
6.1 The Penetration Testing Lifecycle
y
This Learning Unit covers the following Learning Objectives:
k
• Understand the stages of a Penetration Test
s
• Learn the role of Information Gathering inside each stage
• Understand the differences between Active and Passive Information Gathering
o
To keep a company’s security posture as tightly controlled as possible, we should conduct
penetration testing on a regular cadence and after every time there’s a significant shift in the
n
target’s IT architecture.
A typical penetration test comprisesi the following stages:
z
• Defining the Scope
• Information Gathering
D
• Vulnerability Detection
• Initial Foothold
• Privilege Escalation
• Lateral Movement
• Reporting/Analysis
• Lessons Learned/Remediation
In this Module, we’ll briefly cover scoping before turning our focus to the main objective,
Information Gathering. We will learn more about the other stages during the rest of the course.
The scope of a penetration test engagement defines which IP ranges, hosts, and applications
should be test subjects during the engagement, as compared to out-of-scope items that should
not be tested.
Once we have agreed with the client on the engagement’s scope and time frame, we can proceed
to the second step, information gathering. During this step, we aim to collect as much data about
the target as possible.
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 111
Made in Morocco
Penetration Testing with Kali Linux
To begin information gathering, we typically perform reconnaissance to retrieve details about the
target organization’s infrastructure, assets, and personnel. This can be done either passively or
actively. While the former technique aims to retrieve the target’s information with almost no direct
interaction, the latter probes the infrastructure directly. Active information gathering reveals a
bigger footprint, so it is often preferred to avoid exposure by gathering information passively.
It’s important to note that information gathering (also known as enumeration) does not end after
our initial reconnaissance. We’ll need to continue collecting data as the penetration test
progresses, building our knowledge of the target’s attack surface as we discover new information
by gaining a foothold or moving laterally.
In this Module, we’ll first learn about passive reconnaissance, then explore how to actively interact
with a target for enumeration purposes.
6.2 Passive Information Gathering y
This Learning Unit covers the following Learning Objectives: k
• Understand the two different Passive Information Gathering approaches
s
• Learn about Open Source Intelligence (OSINT)
• Understand Web Server and DNS passive infoormation gathering
Passive Information Gathering, also known as Open-source Intelligence (OSINT),209 is the process
of collecting openly-available information anbout a target, generally without any direct interaction
with that target.
Before we begin, we need examine ithe two different schools of thought about what constitutes
“passive” in this context. z
In the strictest interpretation, we never communicate with the target directly. For example, we
D
could rely on third parties for information, but we wouldn’t access any of the target’s systems or
servers. Using this approach maintains a high level of secrecy about our actions and intentions,
but can also be cumbersome and may limit our results.
In a looser interpretation, we might interact with the target, but only as a normal internet user
would. For example, if the target’s website allows us to register for an account, we could do that.
However, we would not test the website for vulnerabilities during this phase.
Both approaches can be useful, depending on the objectives of the test we are conducting. For
this reason, we need to consider the scope and rules of engagement for our penetration test
before deciding which to use.
In this Module, we will adopt this latter, less rigid interpretation for our approach.
There are a variety of resources and tools we can use to gather information, and the process is
cyclical rather than linear. In other words, the “next step” of any stage of the process depends on
what we find during the previous steps, creating “cycles” of processes. Since each tool or
resource can generate any number of varied results, it can be hard to define a standardized
process. The ultimate goal of passive information gathering is to obtain information that clarifies
209 (Wikipedia, 2022), https://en.wikipedia.org/wiki/Open-source_intelligence
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 112
Made in Morocco
Penetration Testing with Kali Linux
or expands an attack surface,210 helps us conduct a successful phishing campaign, or
supplements other penetration testing steps such as password guessing, which can ultimately
lead to account compromise.
Instead of demonstrating linked scenarios, we will simply cover various resources and tools,
explain how they work, and arm you with the basic techniques required to build a passive
information gathering campaign.
Before we begin discussing resources and tools, let’s share a personal example of a penetration
test that involved successful elements of a passive information gathering campaign.
A Note From the Authors
Several years ago, the team at OffSec was tasked with performing a penetration test for a small
company. This company had virtually no internet presence and very few externally-exposed
y
services, all of which proved to be secure. There was practically no attack surface to be found.
After a focused passive information gathering campaign that leveraged various Google search
operators, connected bits of information “piped” into other onkline tools, and a bit of creative and
logical thinking, we found a forum post made by one of the target’s employees in a stamp-
collecting forum: s
Hi!
I'm looking for rare stamps from the 1950's -o for sale or trade.
Please contact me at PI:EMAIL
Cell: 999-999-9999
n
Listing 34 - A forum post as a lure
We used this information to launch a semi-sophisticated client-side attack. We quickly registered
i
a stamps-related domain name and designed a landing page that displayed various rare stamps
z
from the 1950’s, which we found using Google Images. The domain name and design of the site
definitely increased the perceived reliability of our stamp trading website.
D
Next, we embedded some nasty client-side attack exploit code in the site’s web pages, and called
“David” during the workday. During the call, we posed as a stamp collector that had inherited their
Grandfather’s huge stamp collection.
David was overjoyed to receive our call and visited the malicious website to review the “stamp
collection” without hesitation. While browsing the site, the exploit code executed on his local
machine and sent us a reverse shell.
This is a good example of how some innocuous passively-gathered information, such as an
employee engaging in personal business with his corporate email, can lead to a foothold during a
penetration test. Sometimes the smallest details can be the most important.
While “David” wasn’t following best practices, it was the company’s policy and
lack of a security awareness program that set the stage for this breach. Because
of this, we avoid casting blame on an individual in a written report. Our goal as
penetration testers is to improve the security of our client’s resources, not to
210 (Wikipedia, 2022), https://en.wikipedia.org/wiki/Attack_surface
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 113
Made in Morocco
Penetration Testing with Kali Linux
target a single employee. Simply removing “David” wouldn’t have solved the
problem.
Let’s review some of the most popular tools and techniques that can help us conduct a
successful information gathering campaign. We will use MegaCorp One,211 a fictional company
created by OffSec, as the subject of our campaign.
6.2.1 Whois Enumeration
Whois212 is a TCP service, tool, and type of database that can provide information about a domain
name, such as the name server213 and registrar.214 This information is often public, since
registrars charge a fee for private registration.
y
We can gather basic information about a domain name by executing a standard forward search
and passing the domain name, megacorpone.com, into whois, providing the IP address of our
Ubuntu WHOIS server as an argument of the host (-h) parametker.
kali@kali:~$ whois megacorpone.com -h 192.168.50.251
s
Domain Name: MEGACORPONE.COM
Registry Domain ID: 1775445745_DOMAIN_COM-VRSN
Registrar WHOIS Server: whois.gandi.net o
Registrar URL: http://www.gandi.net
Updated Date: 2019-01-01T09:45:03Z
Creation Date: 2013-01-22T23:01:00Z n
Registry Expiry Date: 2023-01-22T23:01:00Z
...
Registry Registrant ID: i
Registrant Name: Alan Grofieldz
Registrant Organization: MegaCorpOne
Registrant Street: 2 Old Mill St
Registrant City: Rachel D
Registrant State/Province: Nevada
Registrant Postal Code: 89001
Registrant Country: US
Registrant Phone: +1.9038836342
...
Registry Admin ID:
Admin Name: Alan Grofield
Admin Organization: MegaCorpOne
Admin Street: 2 Old Mill St
Admin City: Rachel
Admin State/Province: Nevada
Admin Postal Code: 89001
Admin Country: US
Admin Phone: +1.9038836342
...
Registry Tech ID:
211 (OffSec, 2023), https://www.megacorpone.com/
212 (Wikipedia, 2022), https://en.wikipedia.org/wiki/WHOIS
213 (Wikipedia, 2022), https://en.wikipedia.org/wiki/Name_server
214 (Wikipedia, 2022), https://en.wikipedia.org/wiki/Domain_name_registrar
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 114
Made in Morocco
Penetration Testing with Kali Linux
Tech Name: Alan Grofield
Tech Organization: MegaCorpOne
Tech Street: 2 Old Mill St
Tech City: Rachel
Tech State/Province: Nevada
Tech Postal Code: 89001
Tech Country: US
Tech Phone: +1.9038836342
...
Name Server: NS1.MEGACORPONE.COM
Name Server: NS2.MEGACORPONE.COM
Name Server: NS3.MEGACORPONE.COM
...
Listing 35 - Using whois on megacorpone.com
Not all of this data is useful, but we did discover some valuable information. First, the output
y
reveals that Alan Grofield registered the domain name. According to the Megacorp One Contact
page, Alan is the “IT and Security Director”.
k
We also found the name servers for MegaCorp One. Name servers are a component of DNS that
we won’t be examining now, but we should nevertheless add these servers to our notes.
s
Assuming we have an IP address, we can also use the whois client to perform a reverse lookup
and gather more information. o
kali@kali:~$ whois 38.100.193.70 -h 192.168.50.251
n
...
NetRange: 38.0.0.0 - 38.255.255.255
CIDR: 38.0.0.0/8
i
NetName: COGENT-A
z
...
OrgName: PSINet, Inc.
OrgId: PSI
D
Address: 2450 N Street NW
City: Washington
StateProv: DC
PostalCode: 20037
Country: US
RegDate:
Updated: 2015-06-04
...
Listing 36 - Whois reverse lookup
The results of the reverse lookup give us information about who is hosting the IP address. This
information could be useful later, and as with all the information we gather, we will add this to our
notes.
6.2.2 Google Hacking
The term “Google Hacking” was popularized by Johnny Long in 2001. Through several talks215
and an extremely popular book (Google Hacking for Penetration Testers216), he outlined how
215 (Wikipedia, 2022) https://en.wikipedia.org/wiki/Google_hacking
216 (Johnny Long, Bill Gardner, Justin Brown, 2015), https://www.amazon.com/Google-Hacking-Penetration-Testers-
Johnny/dp/0128029641/ref=dp_ob_image_bk
PWK - Copyright © 2023 OffSec Services Limited. All rights reserved. 115
Made in Morocco
Penetration Testing with Kali Linux