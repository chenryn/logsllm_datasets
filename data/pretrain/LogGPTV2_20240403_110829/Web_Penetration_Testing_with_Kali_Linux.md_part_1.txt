www.it-ebooks.info
Web Penetration Testing with
Kali Linux
A practical guide to implementing penetration testing
strategies on websites, web applications, and standard
web protocols with Kali Linux.
Joseph Muniz
Aamir Lakhani
BIRMINGHAM - MUMBAI
www.it-ebooks.info
Web Penetration Testing with Kali Linux
Copyright © 2013 Packt Publishing
All rights reserved. No part of this book may be reproduced, stored in a retrieval
system, or transmitted in any form or by any means, without the prior written
permission of the publisher, except in the case of brief quotations embedded in
critical articles or reviews.
Every effort has been made in the preparation of this book to ensure the accuracy
of the information presented. However, the information contained in this book is
sold without warranty, either express or implied. Neither the authors, nor Packt
Publishing, and its dealers and distributors will be held liable for any damages
caused or alleged to be caused directly or indirectly by this book.
Packt Publishing has endeavored to provide trademark information about all of the
companies and products mentioned in this book by the appropriate use of capitals.
However, Packt Publishing cannot guarantee the accuracy of this information.
First published: September 2013
Production Reference: 1180913
Published by Packt Publishing Ltd.
Livery Place
35 Livery Street
Birmingham B3 2PB, UK.
ISBN 978-1-78216-316-9
www.packtpub.com
Cover Image by Karl Moore (PI:EMAIL)
[ FM-2 ]
www.it-ebooks.info
Credits
Authors Project Coordinator
Joseph Muniz Anugya Khurana
Aamir Lakhani
Proofreaders
Christopher Smith
Reviewers
Adrian Hayter Clyde Jenkins
Danang Heriyadi
Tajinder Singh Kalsi Indexer
Monica Ajmera Mehta
Brian Sak
Kunal Sehgal
Graphics
Nitin.K. Sookun (Ish)
Ronak Dhruv
Acquisition Editor
Production Coordinator
Vinay Argekar
Aditi Gajjar
Lead Technical Editor
Cover Work
Amey Varangaonkar
Aditi Gajjar
Technical Editors
Pooja Arondekar
Sampreshita Maheshwari
Menza Mathew
[ FM-3 ]
www.it-ebooks.info
About the Authors
Joseph Muniz is a technical solutions architect and security researcher. He started
his career in software development and later managed networks as a contracted
technical resource. Joseph moved into consulting and found a passion for security
while meeting with a variety of customers. He has been involved with the design
and implementation of multiple projects ranging from Fortune 500 corporations to
large federal networks.
Joseph runs TheSecurityBlogger.com website, a popular resources regarding
security and product implementation. You can also find Joseph speaking at live events
as well as involved with other publications. Recent events include speaker for Social
Media Deception at the 2013 ASIS International conference, speaker for Eliminate
Network Blind Spots with Data Center Security webinar, speaker for Making Bring
Your Own Device (BYOD) Work at the Government Solutions Forum, Washington
DC, and an article on Compromising Passwords in PenTest Magazine - Backtrack
Compendium, July 2013.
Outside of work, he can be found behind turntables scratching classic vinyl or on
the soccer pitch hacking away at the local club teams.
This book could not have been done without the support of my
charming wife Ning and creative inspirations from my daughter
Raylin. I also must credit my passion for learning to my brother
Alex, who raised me along with my loving parents Irene and Ray.
And I would like to give a final thank you to all of my friends,
family, and colleagues who have supported me over the years.
[ FM-4 ]
www.it-ebooks.info
Aamir Lakhani is a leading Cyber Security and Cyber Counterintelligence
architect. He is responsible for providing IT security solutions to major commercial
and federal enterprise organizations.
Lakhani leads projects that implement security postures for Fortune 500 companies,
the US Department of Defense, major healthcare providers, educational institutions,
and financial and media organizations. Lakhani has designed offensive counter
defense measures for defense and intelligence agencies, and has assisted organizations
in defending themselves from active strike back attacks perpetrated by underground
cyber groups. Lakhani is considered an industry leader in support of detailed
architectural engagements and projects on topics related to cyber defense, mobile
application threats, malware, and Advanced Persistent Threat (APT) research, and
Dark Security. Lakhani is the author and contributor of several books, and has
appeared on National Public Radio as an expert on Cyber Security.
Writing under the pseudonym Dr. Chaos, Lakhani also operates the DrChaos.com
blog. In their recent list of 46 Federal Technology Experts to Follow on Twitter, Forbes
magazine described Aamir Lakhani as "a blogger, infosec specialist, superhero..., and
all around good guy."
I would like to dedicate this book to my parents, Mahmood and
Nasreen, and sisters, Noureen and Zahra. Thank you for always
encouraging the little hacker in me. I could not have done this without
your support. Thank you mom and dad for your sacrifices. I would
also additionally like to thank my friends and colleagues for your
countless encouragement and mentorship. I am truly blessed to be
working with the smartest and most dedicated people in the world.
[ FM-5 ]
www.it-ebooks.info
About the Reviewers
Adrian Hayter is a penetration tester with over 10 years of experience developing
and breaking into web applications. He holds an M.Sc. degree in Information Security
and a B.Sc. degree in Computer Science from Royal Holloway, University of London.
Danang Heriyadi is an Indonesian computer security researcher specialized
in reverse engineering and software exploitation with more than five years hands
on experience.
He is currently working at Hatsecure as an Instructor for "Advanced Exploit and
ShellCode Development". As a researcher, he loves to share IT Security knowledge
in his blog at FuzzerByte (http://www.fuzzerbyte.com).
I would like to thank my parents for giving me life, without them, I
wouldn't be here today, my girlfriend for supporting me every day
with smile and love, my friends, whom I can't describe one-by-one.
[ FM-6 ]
www.it-ebooks.info
Tajinder Singh Kalsi is the co-founder and Chief Technical Evangelist at Virscent
Technologies Pvt Ltd with more than six years of working experience in the field of
IT. He commenced his career with WIPRO as a Technical Associate, and later became
an IT Consultant cum Trainer. As of now, he conducts seminars in colleges all across
India, on topics, such as information security, Android application development,
website development, and cloud computing, and has covered more than 100 colleges
and nearly 8500 plus students till now. Apart from training, he also maintains a blog
(www.virscent.com/blog), which pounds into various hacking tricks. Catch him
on facebook at—www.facebook.com/tajinder.kalsi.tj or follow his
website—www.tajinderkalsi.com.
I would specially like to thank Krunal Rajawadha (Author
Relationship Executive at Packt Publishing) for coming across me
through my blog and offering me this opportunity. I would also like
to thank my family and close friends for supporting me while I was
working on this project.
Brian Sak, CCIE #14441, is currently a Technical Solutions Architect at Cisco
Systems, where he is engaged in solutions development and helps Cisco partners
build and improve their consulting services. Prior to Cisco, Brian performed security
consulting and assessment services for large financial institutions, US government
agencies, and enterprises in the Fortune 500. He has nearly 20 years of industry
experience with the majority of that spent in Information Security. In addition to
numerous technical security and industry certifications, Brian has a Master's degree
in Information Security and Assurance, and is a contributor to The Center for
Internet Security and other security-focused books and publications.
[ FM-7 ]
www.it-ebooks.info
Kunal Sehgal (KunSeh.com) got into the IT Security industry after completing
the Cyberspace Security course from Georgian College (Canada), and has been
associated with financial organizations since. This has not only given him
experience at a place where security is crucial, but has also provided him with
valuable expertise in the field.
Currently, he heads is heading IT Security operations, for the APAC Region of one
of the largest European banks. Overall, he has about 10 years of experience in diverse
functions ranging from vulnerability assessment, to security governance and from
risk assessment to security monitoring. He holds a number of certifications to his
name, including Backtrack's very own OSCP, and others, such as TCNA, CISM,
CCSK, Security+, Cisco Router Security, ISO 27001 LA, ITIL.
Nitin Sookun (MBCS) is a passionate computer geek residing in the heart of
Indian ocean on the beautiful island of Mauritius. He started his computing career
as an entrepreneur and founded Indra Co. Ltd. In the quest for more challenge, he
handed management of the business over to his family and joined Linkbynet Indian
Ocean Ltd as a Unix/Linux System Engineer. He is currently an engineer at Orange
Business Services.
Nitin has been an openSUSE Advocate since 2009 and spends his free time
evangelizing Linux and FOSS. He is an active member of various user groups
and open source projects, among them openSUSE Project, MATE Desktop Project,
Free Software Foundation, Linux User Group of Mauritius, and the Mauritius
Software Craftsmanship Community.
He enjoys scripting in Bash, Perl, and Python, and usually publishes his work on
his blog. His latest work "Project Evil Genius" is a script adapted to port/install
Penetration Testing tools on openSUSE. His tutorials are often translated to various
languages and shared within the open source community. Nitin is a free thinker
and believes in sharing knowledge. He enjoys socializing with professionals from
various fields.
[ FM-8 ]
www.it-ebooks.info
www.PacktPub.com
Support files, eBooks, discount offers and more
You might want to visit www.PacktPub.com for support files and downloads related
to your book.
Did you know that Packt offers eBook versions of every book published, with PDF
and ePub files available? You can upgrade to the eBook version at www.PacktPub.
com and as a print book customer, you are entitled to a discount on the eBook copy.
Get in touch with us at PI:EMAIL for more details.
At www.PacktPub.com, you can also read a collection of free technical articles, sign
up for a range of free newsletters and receive exclusive discounts and offers on Packt
books and eBooks.
TM
http://PacktLib.PacktPub.com
Do you need instant solutions to your IT questions? PacktLib is Packt's online
digital book library. Here, you can access, read and search across Packt's entire
library of books.
Why Subscribe?
• Fully searchable across every book published by Packt
• Copy and paste, print and bookmark content
• On demand and accessible via web browser
Free Access for Packt account holders
If you have an account with Packt at www.PacktPub.com, you can use this to access
PacktLib today and view nine entirely free books. Simply use your login credentials
for immediate access.
[ FM-9 ]
www.it-ebooks.info
www.it-ebooks.info
Table of Contents
Preface 1
Chapter 1: Penetration Testing and Setup 7
Web application Penetration Testing concepts 8
Penetration Testing methodology 9
Calculating risk 14
Kali Penetration Testing concepts 17
Step 1 – Reconnaissance 17
Step 2 – Target evaluation 18
Step 3 – Exploitation 19
Step 4 – Privilege Escalation 19
Step 5 – maintaining a foothold 20
Introducing Kali Linux 21
Kali system setup 21
Running Kali Linux from external media 21
Installing Kali Linux 22
Kali Linux and VM image first run 29
Kali toolset overview 29
Summary 31
Chapter 2: Reconnaissance 33
Reconnaissance objectives 34
Initial research 34
Company website 35
Web history sources 36
Regional Internet Registries (RIRs) 39
Electronic Data Gathering, Analysis, and Retrieval (EDGAR) 40
Social media resources 41
Trust 41
www.it-ebooks.info
Table of Contents
Job postings 41
Location 42
Shodan 42
Google hacking 44
Google Hacking Database 45
Researching networks 48
HTTrack – clone a website 49
ICMP Reconnaissance techniques 52
DNS Reconnaissance techniques 53
DNS target identification 55
Maltego – Information Gathering graphs 57
Nmap 59
FOCA – website metadata Reconnaissance 66
Summary 72
Chapter 3: Server-side Attacks 73
Vulnerability assessment 74
Webshag 74
Skipfish 78
ProxyStrike 81
Vega 85
Owasp-Zap 89
Websploit 95
Exploitation 96
Metasploit 96
w3af 102
Exploiting e-mail systems 105
Brute-force attacks 107
Hydra 107
DirBuster 110
WebSlayer 113
Cracking passwords 119
John the Ripper 119
Man-in-the-middle 121
SSL strip 122
Starting the attack – redirection 123
Setting up port redirection using Iptables 124
Summary 127
Chapter 4: Client-side Attacks 129
Social engineering 129
Social Engineering Toolkit (SET) 130
Using SET to clone and attack 132
[ ii ]
www.it-ebooks.info
Table of Contents
MitM Proxy 143
Host scanning 144
Host scanning with Nessus 145
Installing Nessus on Kali 145
Using Nessus 146
Obtaining and cracking user passwords 151
Windows passwords 153
Mounting Windows 154
Linux passwords 155
Kali password cracking tools 155
Johnny 156
hashcat and oclHashcat 159
samdump2 161
chntpw 161
Ophcrack 165
Crunch 168
Other tools available in Kali 170
Hash-identifier 170
dictstat 171
RainbowCrack (rcracki_mt) 172
findmyhash 173
phrasendrescher 173
CmosPwd 173
creddump 174
Summary 174
Chapter 5: Attacking Authentication 175
Attacking session management 177
Clickjacking 177
Hijacking web session cookies 178
Web session tools 179
Firefox plugins 180
Firesheep – Firefox plugin 180
Web Developer – Firefox plugin 180
Greasemonkey – Firefox plugin 181
Cookie Injector – Firefox plugin 182
Cookies Manager+ – Firefox plugin 183
Cookie Cadger 184
Wireshark 187
Hamster and Ferret 190
Man-in-the-middle attack 193