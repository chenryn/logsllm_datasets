#44
#71
#43
#02
Italia
Free
b
a
b
o
r
p
e
g
a
s
u
k
n
L
i
l
)
e
a
c
s
g
o
l
(
10-2
10-4
1235789
0
1
1
1
2
1
3
1
6
1
7
1
8
1
9
1
0
2
5
2
7
2
0
3
2
3
3
3
4
3
5
3
6
3
7
3
8
3
0
4
4
4
5
4
6
4
8
4
9
4
4
5
6
5
8
5
9
5
0
6
1
6
Link ID
Fig. 2. Link usage probability of 6 probes. Each ISP employs at least two interdomain
links to load balance the traﬃc to video caches. (Color ﬁgure online)
Geographic Location. The ﬁrst factor to study is the relationship between
geographic location of probes and the use of interdomain links. Figure 1(a) shows
that diﬀerent probes in Comcast showed similar/dissimilar behavior in terms
of link use. We investigated this sharing of interdomain links among probes.
Revealing the Load-Balancing Behavior of YouTube Traﬃc
235
, P b
2
, ..., P b
We characterize this behavior by computing a link usage probability vector,
i >,∀i ∈ L, for each probe. We then performed agglom-
P b = <P b
1
erative hierarchical clustering in Matlab, and used squared Euclidean distance
as a similarity measure between two vectors. We considered only Comcast mon-
itors, because interdomain links will not overlap across ISPs. Figure 3 shows
the dendrogram of the resulting ﬁve clusters, which reﬂect the locations of the
probes.
The leftmost cluster (red) consists of 6 monitors in the Northeastern U.S. The
second cluster (#30) is in the Southeastern U.S. The remaining three clusters
are in northern central, southwest, and central areas of the U.S., respectively.
This clustering is consistent with the goal of reducing latency of requests by
routing them across the nearest interconnection.
Time of Day. Another important factor is time of day, because ISPs or
YouTube can employ diﬀerent load balancing strategies during peak hours. We
adopted the “7 p.m. to 11 p.m.” deﬁnition of the peak usage hour from the FCC
Broadband America Report [11], and recomputed the link usage probability for
peak and oﬀ-peak hours. The German ISP (Kabel) showed a signiﬁcant diﬀer-
ence in terms of link usage probability in the two time periods. Figure 4 shows
the ﬁve interdomain links observed by probe #02. During the oﬀ-peak hours,
the ﬁve links were somewhat evenly utilized. In the peak hours, only three of the
ﬁve links were signiﬁcantly used. The link usage probability of the three links
increased 5% to 15% relative to oﬀ-peak hours. For the other ISPs, we did not
ﬁnd signiﬁcant diﬀerences in link usage (not to be confused with utilization!)
between peak and oﬀ peak hours.
e
c
n
a
t
s
D
i
2
1.5
1
0.5
0
y
t
i
l
i
b
a
b
o
r
P
0.5
0.4
0.3
0.2
0.1
0
North-East
South-
East
Central-
North
South-
West
Cen-
tral
#32 #60 #44 #67 #27 #36 #30 #78 #96 #38 #89 #61
Probes
Peak
Off-peak
32
33
34
35
36
Link ID
Fig. 3. Dendrogram for hierarchical
clustering of Comcast probes. (Color
ﬁgure online)
Fig. 4. The link usage probability
of Kabel (#02) during peak/oﬀ-peak
hours.
236
R. K. P. Mok et al.
4.2 Destination Google AS
According to [1], ISPs can establish peering with Google on two ASes—AS 15169
and AS 36040. The former is the most common option and can access all Google
services and content, while the latter provides only the most popular content
and is not available at all IXPs [1]. Table 3 shows the link usage probability
according to the destination AS of the links. Values in brackets are the number
of links in the respective categories.
Table 3. Link usage probability (number of interdomain links) to Google ASes.
Google AS Comcast Kabel
Italia
Free
15169
36040
43515
0.99 (25)
0.76 (3) 0.16 (6) 0.04 (1)
0.0001 (1) 0.24 (2) 0.84 (4) 0.94 (2)
0
0
0
0.02 (1)
Comcast mostly connects users to Google with AS 15169. For the other three
ISPs in Europe, load balancing with AS 36040 is more common. ISP Italia has
more interdomain links peering with AS 15169, but accesses YouTube caches
mainly using AS 36040. This arrangement could be for historical reasons, because
AS 36040 was assigned to YouTube before the merger (Today, the AS name is
still ‘YouTube’). For the German ISP Kabel, we found that the links (Link ID
32 and 33) mostly used in the oﬀ-peak hours (see Fig. 4) were peering with AS
36040, while the remaining three links were peering with AS 15169.
Interestingly, we found that ISP Free connected users to Google with AS
43515 between Jun 1, 2016 and Aug 17, 2016. Google currently manages this AS
for its core network but not for peering purposes [1]. These YouTube test sessions
were assigned to video caches with IP preﬁx (208.117.224.0/19), announced by
AS 43515. We believe that the purpose of this AS recently changed. Some video
caches were still assigned to AS 43515 during that time period, but now no longer
responded to ICMP ping, as other caches did. This example illustrates that ISPs
may have diﬀerent preferences in engineering traﬃc to and from Google ASes.
4.3 Video Cache Assignment
YouTube mainly employs two techniques to load balance requests, namely DNS-
based redirection and HTTP-based redirection. DNS-based redirection assigns
users to a front-end server according to the DNS server making the query-
ing [8,10]. These front-end servers, apart from serving static web elements on
youtube.com, are responsible for assigning users to video caches hosted under the
domain *.googlevideo.com. In some cases, the video content is not available
in the assigned video cache (cache miss), Google uses HTTP-based redirection
to redirect users to another cache using HTTP response status code 302.
Revealing the Load-Balancing Behavior of YouTube Traﬃc
237
We investigated whether the video caches selected by the front-end server
considered the use of interdomain links. Our YouTube measurements captured
more than 3,000 hostnames and IPs of video caches. The SamKnows probes
resolved these hostnames with their default list of DNS servers, during each
YouTube measurement. We found that around 90% of the hostnames mapped to
a single IP address, except a special hostname (redirector.googlevideo.com)
designed for handling cache misses. This result indicated that DNS-based redi-
rection is not common for hostnames of Google’s video caches.
To study the mechanism of video cache selection method, we compared video
cache hostnames and IPs between any two probes. In Sect. 4.1 we described how
user geographic location appears to inﬂuence selection of interdomain link. If
Google uses video cache selection to engineer the desired use of speciﬁc interdo-
main links, the front-end servers will likely direct nearby probes to a similar set of
caches. Figure 5 depicts the overlapping in video cache hostname/IP mappings
for any two monitors, with probes (rows) sorted according to the clustering
results in Fig. 3. The lower/upper triangular part of the matrix compares the
hostnames/IPs collected by the two probes, respectively. The triangular symme-
try is a reﬂection of the largely one-to-one mapping between IPs and hostnames.
From the similarity of the use of interdomain links, we expect nearby probes (e.g.,
#32, #60, and #44) should share a similar set of video caches (i.e., many over-
#32
39
461
117
#60
31
#44
454
#67
108
#27
0
#36
466
#30
481
#78
1
#96
389
#38
#89
#61
#02
#43
#71
2
1
1
0
0
1
20
70
7
16
15
3
6
64
7
70
0
0
1
30