# 【技术分享】GNU Radio无线通信嗅探基础

##### 译文声明
本文为翻译文章，原文来源：安全客。译文仅供参考，具体内容和含义以原文为准。

**作者**: [backahasten](http://bobao.360.cn/member/contribute?uid=245645961)

**预估稿费**: 300 RMB（欢迎投稿！）

**投稿方式**: 发送邮件至 [linwei#360.cn](mailto:PI:EMAIL) 或访问 [网页版](http://bobao.360.cn/contribute/index) 在线投稿。

## 文章内容简介
1. 使用哪些GRC模块完成我们的嗅探工作。
2. 如何选择参数以获取最佳波形。
3. 如何从波形还原回数据。

我将使用电视棒（RTL-SDR）来嗅探一个固定码遥控锁开发组件，并展示以下GRC流图的配置方法。

## 模块选择与参数设定
首先，`rtlsdr_source` 模块封装了电视棒的底层驱动，用于获取原始数据信号。

- **采样率 (samp_rate)**: 根据带通采样定理，采样率应为所需信号频率的两倍，以确保信号不失真。较高的采样率会带来较大的内存和运算消耗。
- **频率 (frequency)**: 填写需要捕获信号的中心频率。
- **频率误差 (Freq_corr)**: 由于电视棒精度不高，频率选择会有误差，`Freq_corr` 用于修正此误差。如果没有高精度设备确定该值，可以设为0。
- **其他参数**:
  - **DC offset 和 IQ Balance Mode**: 选择“自动”即可。
  - **Gain Mode, RF Gain, IF Gain 和 BB Gain**: 这些参数用于调整增益。如果不设置增益，信号强度会很低；如果增益过大，信号在噪音中难以识别。通常选择“自动”增益模式。

### 低通滤波器配置
- **采样率**: 与 `rtl-sdr source` 保持一致。
- **截止频率 (cutoff Freq)**: 填写信号的大致宽度。可以使用 `gqrx` 来确定。
- **过渡带宽 (transition width)**: 选择信道带宽的40%到50%。对于窄带ASK调制，建议设置为5 KHz。

### 信号解调
使用 `Complex to Mag` 模块对信号进行解调，去除载波。发射信号通常采用调幅、调频或调相三种方式，分别通过能量大小、频率变化和波相位变化表示数据。

#### 解调前后的波形
- **未解调波形**: 可以使用 `scope sink` 观察，但因计算机性能问题，波形可能有延迟和卡顿。因此，推荐使用 `file_sink` 将其保存为文件，再用 `Audacity` 观察。
- **解调后波形**: `Complex to Mag` 将能量大致为0的部分解为低电平，不为0的部分解为高电平。

#### 脉冲信号整理
使用 `Threshold` 模块进行脉冲信号整理，小于0.2的值设为0，大于0.5的值设为1。处理后的波形如下：

提取基带信号对于后续解码和重放攻击非常重要。直接录制原始信号进行重放效果较差，而通过基带信号调制后再发送，整体信号质量可控且效果更好。

## 数字信息还原
请注意，不要主观认为高电平就是1，低电平就是0。数字通信中，基带信号有多种表示方法，某些情况下不能直接通过 `Threshold` 处理（例如双极性归零波形）。正确的方法是阅读芯片手册。

### 接收器芯片
- **LM358**: 集成运放芯片，主要用于信号放大。
- **PT2272**: 关键芯片，使用ASK调制，发出的编码信号由地址码、数据码和同步码组成。

### 信道编码定义
- **时钟周期 (a)**: 4a高+12a低+4a高表示bit“0”，12a高+4a低+12a高表示bit“1”，4a高+12a低+12a高表示bit“f”（仅在地址码中使用）。

### 波形解析示例
- **帧结构**: 默认情况下，9个地址码，3个数据码，一个脉冲作为截断，每帧携带3 bit数据，共25个脉冲。
- **示例波形**: 遥控器上按“C”键时发出的信号，解出的数据为“FFFFFFFF0010”，即数据为“010”。

## 其他注意事项
1. GRC图集成了多个GUI库，只能选择一个。如果无法运行，请检查图形库选择是否与模块对应。
2. 本文仅介绍了ASK解调方法，其他调制方式请参阅《利用GRC进行安全研究和审计 – 将无线电信号转换为数据包》。
3. 使用专用芯片成本较高且复杂，推荐使用Arduino设备驱动芯片进行发射。Arduino功能强大且编程简单，适合硬件开发。
4. 本文涉及大量通信知识，如有错误或理解不当之处，敬请指正。
5. 未来计划撰写一篇关于使用Arduino进行嗅探的文章。