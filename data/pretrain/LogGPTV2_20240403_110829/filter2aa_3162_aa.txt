PLEAD	
The	
  Phantom	
of	
  routers	
Who	
  we	
  are	
•  Charles	
  &	
  Zha0	
•  APT	
  Research	
  @	
  Team	
  T5	
•  Malware	
  analysis,	
  Cyber	
  Threat	
  Tracking	
Agenda	
•  IntroducGon	
•  PLEAD	
  began	
•  PLEAD	
  malware	
  analysis	
•  PLEAD	
  lateral	
  movement	
•  GD	
  Rat:	
  Hiding	
  behind	
  PLEAD?	
•  The	
  phantom	
  of	
  routers	
•  Conclusion	
IntroducGon	
•  PLEAD	
  is	
  a	
  RAT	
  used	
  by	
  an	
  APT	
  group	
  targeGng	
Taiwan	
  speciﬁcally.	
– developed	
  purely	
  in	
  shellcode	
– adopGng	
  skillful	
  techniques	
  to	
  obfuscate	
  itself	
•  The	
  actors	
  use	
  several	
  RATs	
  at	
  the	
  same	
  Gme	
•  They	
  have	
  excellent	
  tools	
  for	
  their	
  post	
exploitaGon	
  job.	
•  Routers	
  were	
  leveraged	
  to	
  hide	
  their	
footprints	
Agenda	
•  IntroducGon	
•  PLEAD	
  began	
•  PLEAD	
  malware	
  analysis	
•  PLEAD	
  lateral	
  movement	
•  GD	
  Rat:	
  Hiding	
  behind	
  PLEAD?	
•  The	
  phantom	
  of	
  routers	
•  Conclusion	
PLEAD	
  began	
•  The	
  1st	
  public	
  report	
  about	
  PLEAD	
  was	
  released	
by	
  trendmicro	
  in	
  2014,	
  it	
  was	
  named	
  PLEAD	
  in	
that	
  report:	
•  RTLO	
  tricks	
  were	
  used	
  by	
  them	
  to	
  target	
  TW	
  Gov	
in	
  that	
  report.	
•  The	
  only	
  public	
  report	
  about	
  PLEAD	
  so	
  far.	
PLEAD	
  began
•  The	
  oldest	
  sample	
  we’ve	
  seen	
  could	
  be	
  dated	
back	
  to	
  2011:	
•  RTLO	
  was	
  also	
  used	
  then	
  J
PLEAD	
  began
•  We	
  named	
  it	
  “PLEAD”	
  from	
  its	
  instrucGons:
Agenda	
•  IntroducGon	
•  PLEAD	
  began	
•  PLEAD	
  malware	
  analysis	
•  PLEAD	
  lateral	
  movement	
•  GD	
  Rat:	
  Hiding	
  behind	
  PLEAD?	
•  The	
  phantom	
  of	
  routers	
•  Conclusion	
PLEAD	
  MALWARE	
  FAMILIES
PLEAD
PLEAD	
  Analysis
Process Injection (iexplorer.exe)
PLEAD	
  Analysis
Config Block Decoder
PLEAD	
  Analysis
•  PLEAD	
  Traﬃc	
  Pa[ern:	
– The	
  1st	
  character	
  of	
  content	
  data	
  would	
  be	
  the	
command	
  (xor	
  with	
  0x00)	
– following	
  immediately	
  with	
  encoded	
  parameter	
  of	
the	
  command	
  (xor	
  with	
  1	
  byte	
  key)	
(GET|POST)\s\/\d{4}\/\w\d+\.(js|asp|jpg|css)\sHTTP/\d\.\d 
Content	
  Data	
  -­‐	
  Comment	
  CMD:	
  A,C,P,G,E,L,D 
GET	
  XOR	
  BLOCK	
  (0...0x0D) 
POST	
  XOR	
  BLOCK	
  (0...0x0B) 
PLEAD	
  Analysis
•  PLEAD	
  Traﬃc	
  Pa[ern:
LC:\
L:	
  cmd_listdir	
LisGng	
  command	
  of	
  C:\	
  and	
  return	
  the	
  result
PLEAD	
  MALWARE	
  FAMILIES
PLEAD	
  Downloader	
  à	
  PLEAD/RACKEY
PLEAD	
  Downloader	
  Analysis	
•  Shellcode	
  (encoded)	
  again!!	
Two	
  bytes	
  (ASCII)	
  to	
  1	
byte	
  (binray)	
  encoding
http://dcns.chickenkiller.com:80/
dyfwmine.jpg
PLEAD	
  Downloader	
  Analysis	
PLEAD	
  Downloader	
  Analysis	
•  Network	
  traﬃc
RC4(Shellcode	
  RC4	
(ReﬂecGve	
  DLL))	
RC4 KEY
Shellcode
PLEAD	
  Downloader	
  Analysis	
PLEAD	
  Downloader	
  Analysis	
Shift 20h byte + 
Fill MZ Header
PLEAD	
  MALWARE	
  FAMILIES
PLEAD	
  Loader	
  à	
  PLEAD/RACKEY
RC4 Key
PLEAD	
  Loader	
  Analysis	
Shellcode
PLEAD	
  Loader	
  Analysis	
ConstrucGng	
shellcode	
  in	
  memory	
RC4 Key
PLEAD	
  Loader	
  Analysis	
PLEAD	
  Loader	
  Analysis	
RC4 key
PLEAD	
  MALWARE	
  FAMILIES
EnCOMSecurity/EnableCOMS
EnCOMSecurity/EnableCOMS	
Analysis
rundll32.exe "%APPDATA%\Microsoft\pdfupd.dll",EnCOMSecurity 
{7288fcda-571e-4eb3-8c2e-97c2fd10ce2e}
EnCOMSecurity/EnableCOMS	
Analysis
•  Decoding	
  the	
  shellcode
EnCOMSecurity/EnableCOMS	
Analysis
InjecGng	
  to	
  iexplore.exe
EnCOMSecurity/EnableCOMS	
Analysis
•  Random	
  URI	
  from	
  Dict.	
h[p://mail.yahoo.com/	
Console	
Tables	
GET	
  h[p://%s%s?%x=%dI%d	
POST	
  h[p://%s%s?%x=%dI%d	
GET	
  h[p://%s:%d%s?%x=%dI%d	
POST	
  h[p://%s:%d%s?%x=%dI%d	
GET	
  %s?%x=%dI%d	
POST	
  %s?%x=%dI%d	
Content-­‐Length:	
  %d	
Content-­‐type:	
  applicaGon/x-­‐www-­‐form-­‐urlencoded	
Cookie:	
  %xid=%s	
Cookie:	
  %xid=%s	
%d-­‐%02d-­‐%02d	
  %02d:%02d	
EnCOMSecurity/EnableCOMS	
Analysis
•  Network	
  traﬃc
Change order(Base64(Encode(RC4_Variable(data))))
PLEAD	
  MALWARE	
  FAMILIES
Diskless	
  PLEAD
Diskless	
  PLEAD	
  malware
•  Hacking	
  Team	
  Tool	
  –	
  CVE-­‐2015-­‐5119
32	
  Bit	
  payload	
  –	
  PLEAD	
•  Exist	
  only	
  in	
  memory	
•  Hard	
  to	
  detect	
Agenda	
•  IntroducGon	
•  PLEAD	
  began	
•  PLEAD	
  malware	
  analysis	
•  PLEAD	
  lateral	
  movement	
•  GD	
  Rat:	
  Hiding	
  behind	
  PLEAD?	
•  The	
  phantom	
  of	
  routers	
•  Conclusion	
Lateral	
  Movement
•  Arer	
  compromise	
•  Leveraging	
  AnG-­‐Virus	
  products	
  to	
  deploy	
trojan:	
– MD5=59fd59c0a63ccef421490c9fac0*****	
  2011-­‐09-­‐02	