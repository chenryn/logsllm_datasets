ICS 35.240
L 78
YD
中华人民共和国通信行业标准
XX/T s—XXXX
云上软件工程 软件质量 可观测性平台技术要求
    Technical capability requirements for distributed middleware service part II-Observablility 
|  |
|---|
|  |
XXXX -    - XX发布
XXXX - XX -   实施
  发 布
目  次
目  次	I
前  言	II
分布式中间件服务技术能力要求 第x部分 可观测性平台	1
1 范围	1
2 规范性引用文件	1
3 术语定义和缩略语	1
3.1.1 可观测性 Observability	1
3.1.2 指标 Metrics	1
3.1.3 日志 Logs	1
3.1.4 链路追踪 Traces	23.1.3 日志 Logs	1
3.1.4 链路追踪 Traces	2
3.1.5 标签 Tags	2
3.1.6 代理 Agent	2
3.1.7 采集周期 Cycle	2
3.1.8 数据聚合 Aggregation	2
3.1.9 告警 Alerting	2
4 框架图	2
5 可观测性平台分级规则	3
6 平台数据处理要求	3
7 业务系统支撑能力	6
8 平台运维支撑能力要求	7
9 平台安全能力要求	9
10 性能项要求	10
11 可观测性应用场景	11
前  言
本标准属于“云上软件工程 软件质量”系列标准。
云上软件工程 软件质量 可观测性平台技术要求
范围
本标准定义了软件质量领域可观测性平台的技术规范和能力要求。该标准内容包括五个部分：第一部分是可观测性应用能力要求；第二部分是可观测性功能要求；第三部分是可观测性运维支持能力要求；第四部分对可观测性安全方面的规范进行了描述；第五部分对于可观测性的性能要求提出了衡量指标；本标准同时适用于服务商提供的公有云服务和私有云软件产品，即面向公共用户提供公有云服务和私有环境下的软件产品或解决方案;依据交付形式的差异，本标准针对不同的使用场景其技术指标要求略有不同。 
规范性引用文件
下列文件对于本文件的应用是必不可少的。凡是注日期的引用文件，仅所注日期的版本适用于本文件。凡是不注日期的引用文件，其最新版本（包括所有的修改单）适用于本文件。
术语定义和缩略语
下列术语和定义适用于本文件。
术语定义
3.1.1 可观测性 Observability
对基础设施以及服务或应用程序的运行状态进行度量和观测的能力及相关技术，可观测性主要包括指标（Metrics）、日志（Logging）、链路追踪（Tracing）3大维度。
3.1.2 指标 Metrics
一段时间内可聚合状态的数字表示，是基础设施、程序、业务指标的量化，如CPU使用率、程序接口请求量、业务活跃用户数等。3.1.3 日志 Logs
表示结构化或者利于可读的离散事件，主要是系统/应用输出的时间相关的记录，包括系统日志、应用程序的日志、服务的变更记录、报警记录等。
3.1.4 链路追踪 Traces
用户请求从用户端到服务端到底层组件的整个链路和拓扑关系，也包括客户端的页面或视图的请求关系。为应用程序发送的消息添加唯一标识符，可以追踪各个事务在分布式系统中移动的路径。
3.1.5 标签 Tags
标签是在数据上报时添加维度的方式，使用它们便于在管理界面中可视化的进行数据的过滤、聚合和对比。
3.1.6 代理 Agent
代理是安装在主机、容器或应用程序侧的轻量级软件。它通过集成、命令行或API从应用程序上采集Metircs、Logs和Traces数据上报给服务端。
3.1.7 采集周期 Cycle
对目标指标（如CPU、memory、I/O或应用发布的指标接口）进行在周期性数据采集时，相邻两次实测之间的时间间隔。3.1.8 数据聚合 Aggregation
将多个维度的数据进行基于时间、标签的聚合，可以支持多种数学函数，如非负求导。
3.1.9 告警 Alerting
告警是根据所设定的指标进行一系列异常检测（通过简单阈值或机器学习）后生成的事件，这种事件通常通过短信、电话或者即时通讯软件快速发给相关问题负责人。
缩略语
下列缩略语适用于本标准：
API        应用编程接口       Application Programming Interface                
SSL        安全套接层         Secure Sockets Layer                  
RCA       根因分析           Root Cause Analysis
可观测性技术框架图
可观测性平台分级规则可观测性技术框架图
可观测性平台分级规则
可观测性的三类支柱数据是指标、日志、链路。可观测性平台能力成熟度也是围绕着这三类数据的实时性、关联性、统一性来展开。整体上我们把所有的能力分成三个等级，各级别服务能力描述如下：
--基础级：离散式可观测-离散式可观测主要的特点就是针对复杂的分布式系统,针对某一个组件进行定制式的观测或者组合式的观测,不能反映整个分布式系统状态的全貌,属于部分可观测;
能够基本实现功能要求；
--增强级：集中式可观测-集中式可观测主要的特点就是把所有观测对象的观测结果统一存储,统一分析,但采集的方式并不统一,数据结构并不统一,虽然可以通过数据治理达到了整体可观测,但没有一个标准模型,无法达到接入即可观测.
在基础级能力上，具备较高级的功能实现；
--先进级：统一全链路可观测-统一全链路可观测的特点是自采集起就是具备一个统一的数据模型,从前端到后端,从请求开始到请求结束,所有数据可采可查可预警, 达到了接入即可观测的标准.在增强级能力上，具备行业内领先的功能实现。
平台数据处理要求
数据采集能力
描述：可观测的基础是全面的数据采集能力,采集能力的强弱直接决定了可观测能力的强弱。
采集范围:
基础资源：包含云,主机,容器,网络, 采集的对象包含指标(实时状态,多维统计),日志(运行日志,出错日志)
中间件：包含数据库,消息队列,应用容器,存储,日志等, 采集数据范围包括日志(运行日志,出错日志), 指标(实时状态,多维统计), 链路(延迟,通讯量,错误率,饱和度)
IOT设备：包含各种边缘设备,采集的数据范围包括指标((实时状态,多维统计))
前端应用：包含H5,ios,android,小程序等,采集范围包括指标(实时状态,多维统计),链路(延迟,通讯量,错误率,饱和度),日志(运行日志,出错日志)
后端应用：包含java python nodejs c# go等,采集范围包括指标(实时状态,多维统计),链路(延迟,通讯量,错误率,饱和度),日志(运行日志,出错日志)1 级能力要求如下：
2 级能力要求如下：
3 级能力要求如下：
支持采集基础资源、中间件、IOT设备等系统指标；
支持采集应用的前端应用、后端应用的服务指标、业务运行指标；
系统可以使用多种集成方式采集事件日志和时间序列指标数据。如通过安装Agent、通用配置模版集成或自定义API集成。
支持适配4种及4种以上环境，如安超OS、NeoKylin、 Redflag Linux、Harmony OS、Mac OS X、Windows、Debian、Ubuntu、CentOS、RedHat、SUSE、AIX、Docker、Kubernetes、Openshift等
支持Java、C++、Python、.Net Core、PHP、NodeJS、Golang、LUA、Ruby、Rust等4种及4种以上语言SDK或探针；
数据上报治理能力
描述：数据上报治理功能为采集端构建“可控可管”的能力，具有较强的较灵活性，确保业务的稳定运营。要求：
1) 采样率动态调整,可按租户、服务名、服务Endpoint等维度配置不同采样规则； 
2) 采集端具备数据聚合、压缩、补报等能力；
3) 采集端具备一定的熔断与降级机制，实现采集的动态调整、暂停、恢复等能力。
4）数据上报支持对敏感信息进行脱敏，如日志中的密码，追踪中的SQL请求中的用户ID。
数据开放能力
描述：平台对生成的应用可观测性数据进行开放，满足第三方应用的增值需求。
要求：
1) 业务上线前的资源精准评估，结合链路拓扑与服务压测，得出每条边的放大倍数；
2) 结合混沌工程，引入服务调用关系链数据，用于服务强弱依赖分析；
3) 收集追踪、指标、日志等历史数据，引入机器学习技术，实施异常检测及根因分析。
4）业务服务质量报表，如成功率，平均延迟，分位延迟等
5）提供开放API供外部系统集成
数据存储能力
描述：根据采集可观测性数据的应用特点实施分级存储。数据存储能力
描述：根据采集可观测性数据的应用特点实施分级存储。
要求：
1) 支持实时数据 ,最新最热的数据，推荐以小时级为单位的存储粒度
2) 支持以周为单位的数据存储，用于短期回顾检索
3) 支持以月、年为单位的数据存储，用于永久历史数据的查询与分析	
4) 支持数据去重与合并
数据可分析可观测能力
描述：“补充”
要求：
提供了可视化方案方便使用者构建可观测的视图
提供完整的全链路的数据分析能力，有效的整合指标，日志和追踪
提供强大的数据分析查询语言，快速在海量数据中查询指标，日志和追踪
数据的异常检测能力
描述：“补充”
要求：
1)支持指标基于阈值或机器学习的异常检测能力，如相较于过去一周的指标偏移情况
2)支持日志基于文本的异常检测能力，如日志中包含关键字的错误过去5分钟出现了多少次
3)支持追踪基于规则的异常检测能力，如过去5分钟p99延迟超过多少的请求。3)支持追踪基于规则的异常检测能力，如过去5分钟p99延迟超过多少的请求。
复杂环境的可观测性支持
描述：“补充”
要求：
1)支持复杂网络条件下的可观测性
2)支持多云、混合云环境下的可观测性
3)支持容器环境下的可观测性
业务系统支撑能力
指标统计
描述：支撑业务程序在运行过程中准确的统计自身的性能数据，以使可观测系统能够准确获取程序的运行状态；
要求：
准确统计流量、平均响应时间、错误码、成功率等信息
日志
描述：
要求：
日志等级规范，常态下不输出无效日志。
描述：业务系统从端上到接入层到后端和组件，支持对各个请求进行标识，并在日志中记录每一个请求在每一个环节的标识码，方便可观测系统识别分析。