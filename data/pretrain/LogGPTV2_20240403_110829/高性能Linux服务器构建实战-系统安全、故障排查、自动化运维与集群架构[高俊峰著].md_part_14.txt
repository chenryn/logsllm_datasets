---
## Page 90
状态分为6类，分别是：
的开放情况。nmap 在默认状态下会扫描1000个最有可能开放的端口，并将侦测到的端口
2.4.6
复，就认为此主机处于在线状态。
识，
UDP包。但是仅仅收到了ICMP Echo(ping)和 80端口的回复，22端口返回了“RST”标
发送了四个探测包，分别是ICMP Echo (ping)、22端口和80端口的 TCP SYN、53端口的
2-25所示。
侦测方式和侦测过程，这里通过抓包工具Wireshark 动态监测 nmap 探测主机的过程，如图
侦测主机信息的，而“-PU”则是以 UDP 的方式进行主机侦测的。为了清晰展示 nmap 的
以发送ICMP echo 报文的形式进行主机探测的，“-PS”是以发送TCP SYN/ACK 包的形式
的服务器上执行如下命令：
，这说明 22 端口处于关闭状态。不过 nmap 的原则是只要能收到任何一种探测请求的回
fltered，表示端口被防火墙屏蔽，无法进一步确定状态。
口closed，表示端口是关闭的。
open，表示端口是开放的。
端口扫描是nmap最核心的功能，通过端口扫描可以发现目标主机上TCP、UDP 端口
从图2-25中可以看到，nmap所在的主机“192.168.12.188”向目标主机“61.185.133.234"
4372
在这个例子中，使用了“-PE”、“-PS”、“-PU”等参数，根据上面的介绍，“-PE”是
执行结果如图2-24所示。
nmap-sn-PE-PS22,80-PU53www.abc.com
nmap 端口扫描
IS
12
bu
up
EZ
Nlma
图2-25通过Wireshark 获取的 nmap 探测主机过程
T9
1.185.133.234
for
185.
or
.133.23
nmap
2.18
图2-24主机发现的执行结果
A8T
com（not 3canned）:
WO
no
910
PS22,80
(butd)
6910
RST,
116.34.65.215
ceachab
第2章Linux网络安全运维
71
---
## Page 91
72第一部分安全运维篇
关闭状态。
各100个端口），由输出可知，有21个端口处于开放或者屏蔽状态，其他179个端口处于
UDP端口，“-F”表示使用快速扫描模式，扫描最可能开放的前100个端口（TCP和UDP
在联网的服务器上执行如下命令：
可自己指定。
“TCP FIN/Xmasscanning”、“UDP scanning”等探测方式。具体使用哪种探测方式，用户
--top-ports 
-p
-sN/sF/sX
-sU
-sS/sT/sA/sW/sM
执行结果如图2-26所示。
nmap -sU-sS -F www.abc.com
下面仍以探测www.abc.com主机的信息为例，简单演示端口扫描的使用方法。首先，
2.使用实例
nmap 端口扫描的常用选项与含义如表2-8所示。
nmap［选项或参数］目标主机
nmap 提供了多个选项以供用户来指定扫描方式和扫描端口，使用语法如下：
1.端口扫描的用法
口closedfiltered，表示不确定状态，端口可能是关闭的，也可能是屏蔽的。
口openlfiltered，表示不确定状态，端口可能是开放的，也可能是屏蔽的。
口unfiltered，表示端口没有被屏蔽，但是否处于开放状态，
选项
议，U表示UDP协议，S表示SCTP协议
状态
仅扫描开放率最高的number个端口
快速扫描模式，仅仅扫描开放率最高的前100个端口
例如“-p80"、“-p1-100"、“-p T:80-88,8000,8080,U:53,11,S:9"，其中T表示TCP协
仅仅扫描指定的一个或一批端口
指定使用TCPNull、FIN、Xmas scans秘密扫描方式来协助侦测目标主机的TCP端口
指定使用UDP扫描方式扫描目标主机的UDP端口状况
指定使用TCPSYN/ConnectO/ACK/Window/Maimon scans来对目标主机进行端口扫描
表2-8nmap端口扫描的常用选项及含义
含义
，还需要进一步确定。
---
## Page 92
能识别几千种服务签名，下面介绍 nmap 版本侦测的使用方法。
息，nmap 的版本侦测支持TCP/UDP 协议，支持多种平台的服务侦测，支持IPV6功能，并
2.4.7
--version-trace
--version-all
--version-light
--version-intensity
-SV
nmap 在版本侦测方面的常用选项及含义如表2-9 所示。
nmap［选项或参数］目标主机
nmap 在版本侦测方面的命令选项非常简单，常用的语法如下：
1.版本侦测的用法
nmap 的版本侦测功能主要用来确定目标主机开放的端口上运行的应用程序及版本信
nmap版本侦测
选项
的服务版本就越精确，但扫描的时间也更长
表 2-9nmap版本侦测的常用选项及含义
udp
udp
显示版本侦测的详细过程
尝试使用所有的probes进行侦测，相当于侦测强度为9
设置使用轻量级的侦测方式，相当于侦测强度值为2
设置版本侦测的强度值，取值范围为0~9，默认是7。这个数值越高，探测出
设置nmap进行版本侦测
图2-26nmap端口扫描应用实例
openlfiltered sip
11
F
ope
11
STATE
enlfiltered
ben
Den
cered
red
ered
or
snm
10
PPp
dado
SERVICE
cpo
323/Q.931
ell
odz
lserver
含义
.con
第2章Linux网络安全运维
73
---
## Page 93
74第一部分安全运维篇
统侦测的使用方法。
丰富的系统指纹库，目前可以识别近 3000种操作系统与设备类型。下面介绍 nmap操作系
2.4.8
的安全威胁。
在软件漏洞，
过对服务器上运行服务的了解，以及对服务版本的探测，基本能判断出来此服务器是否存
测的使用方法。首先，在联网的服务器上执行如下命令：
nmap 在操作系统侦测方面提供的命令选项比较少，常用的语法如下：
1.操作系统侦测的用法
从图2-27中 nmap 的输出可以看到每个端口对应的服务名称以及详细的版本信息，通
执行结果如图2-27所示。
nmap-sV23.76.232.59
下面以探测“23.76.232.59”主机上运行的应用程序的版本信息为例，简单演示版本侦
2.使用实例
nmap 操作系统侦测
，进而提醒运维管理人员进行端口关闭或升级软件等操作，尽早应对可能出现
open
opet
B
open
STATE
980
D
Cered
001
1#nmap-sV23.76.232.59
pptp
L91
aoft-
232.59
图2-27nmap 版本侦测实例
Apache Tomcat/Coyote JSP engine l.1
MySQL5.1.30
VERSION
bache httpd
at2013-12-2122:16CST
2.0.63
(Unix)
DAV/2
(fo
---
## Page 94
示操作系统侦测的使用方法。首先，在联网的服务器上执行如下命令：
--osscan-guess
从图2-28中可以看出，在指定了“-0”选项后，nmap命令首先执行了主机发现操
执行结果如图2-28所示。
nmap -0 --0sscan-guess 192.168.12.118-119
下面以探测“192.168.12.118”和“192.168.12.119”主机的操作系统类型为例，简单演
2.使用实例
nmap 在操作系统侦测方面的常用选项及含义如表 2-10 所示。
nmap【选项或参数】目标主机
选项
MAC
PORT
37
iap
tcp
合判断操作系统类型
Ado
猜测目标主机的操作系统类型，nmap会给出可能性的比率，用户可以根据提供的比率综
设置nmap进行操作系统侦测
18
Bcan
open
STATE
open
STATE
表 2-10nmap操作系统侦测的常用选项及含义
report for 192.168.12.119
OSgues
inux
0.
port
nce:
图2-28nmap操作系统侦测实例
http
SERVICE
~1#
1hop
E6
90:0D:AC
cency)
2.6.30
re
cy)
口
ESXI
5.3
O-RELEASE-PI
BETA2
含义
(x86)
96）
10.0-CURRENI
Ind.Co.Ltd
第 2章Linux 网络安全运维
---
## Page 95
76第一部分安全运维篇
的强大。
事实上，此主机确实安装了这个版本的系统。由此可见，nmap的操作系统侦测功能是多么
“192.168.12.119”主机，nmap 给出最可能的操作系统版本是VMware ESXi Server 5.0，而
络距离。如果不能确定操作系统的版本，会猜测每个系统版本的可能性比率，例如对于
取到的信息有设备类型、操作系统版本、操作系统的CPE描述、操作系统的细节和网
作，接着执行了端口扫描操作，然后根据端口扫描的结果进行操作系统类型的侦探，获
---
## Page 96
特点：
的一致性，这有点类似于一个网络 RAID1的功能。对于DRDB 数据镜像来说，它具有如下
盘分区，将一个节点的数据通过网络实时地传送到另一个远程节点，保证两个节点间数据
3.1.1
现问题，远程主机上还保留着一份相同的数据，可以继续使用，保证了数据的安全。
这样本地主机（主节点）与远程主机（备节点）的数据就可以保证实时同步，当本地主机出
据镜像。当用户将数据写人本地磁盘时，还会将数据发送到网络中另一台主机的磁盘上，
基于网络的块复制存储解决方案，主要用于对服务器之间的磁盘、分区、逻辑卷等进行数
3.1数据镜像软件DRBD介绍
口透明性。应用程序的数据存储在镜像设备上是透明和独立的。数据可以存储在基于
口实时性。
DRBD的核心功能就是数据的镜像，其实现方式是通过网络来镜像整个磁盘设备或磁
分布式块设备复制（Distributed Replicated BlockDevice，DRBD），是一种基于软件的，
口异步镜像。当本地写操作已经完成时，才开始对远程主机进行写操作。
口同步镜像。当本地应用申请写操作时，同时也在远程主机上开始进行写操作。
网络的不同服务器上。