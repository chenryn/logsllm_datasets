Mac OS X Server.
Starting and Stopping Web Service
To start Web service:
$ sudo serveradmin start web
To stop Web service:
$ sudo serveradmin stop web
Checking Web Service Status
To see if Web service is running:
$ sudo serveradmin status web
To see complete Web service status:
$ sudo serveradmin fullstatus web
Viewing Web Settings
You can use serveradmin to view your server’s Web service configuration. However, if 
you want to work with the Web service from the command-line, you’ll probably find it 
more straightforward to work directly with the underlying Apache web server.
For information on Apache settings, visit www.apache.org.
To list all Web service settings:
$ sudo serveradmin settings web
To list a particular setting:
$ sudo serveradmin settings web:setting
LL2354.book  Page 123  Monday, October 20, 2003  9:47 AM
124
Chapter 12    Working With Web Technologies
To list a group of settings:
You can list a group of settings that have part of their names in common by typing 
only as much of the name as you want, stopping at a colon (:), and typing an asterisk 
(*) as a wildcard for the remaining parts of the name. For example,
$ sudo serveradmin settings web:IFModule:_array_id:mod_alias.c:*
Changing Web Settings
You can use serveradmin to modify your server’s Web service configuration. However, 
if you want to work with the Web service from the command-line, you’ll probably find 
it more straightforward to work directly with the underlying Apache web server.
For information on Apache, visit www.apache.org.
serveradmin and Apache Settings
The parameters are written differently in the Apache configuration file than they are in 
serveradmin. For example, this block of Apache configuration parameters
MacBinary On
MacBinaryBlock html shtml perl pl cgi jsp php phps asp scpt
MacBinaryBlock htaccess
appear as follows in serveradmin
web:IfModule:_array_id:mod_macbinary_apple.c:MacBinary = yes
web:IfModule:_array_id:mod_macbinary_apple.c:MacBinaryBlock:_array_index:0 = 
"html shtml perl pl cgi jsp php phps asp scpt"
web:IfModule:_array_id:mod_macbinary_apple.c:MacBinaryBlock:_array_index:1 = 
"htaccess".
For information on Apache settings, visit www.apache.org.
Changing Settings Using serveradmin
You can change Web service settings using the serveradmin command.
To change a setting:
$ sudo serveradmin settings web:setting = value
Parameter
Description
setting
A Web service setting. To see a list of available settings, type
$ sudo serveradmin settings web
value
An appropriate value for the setting.
LL2354.book  Page 124  Monday, October 20, 2003  9:47 AM
Chapter 12    Working With Web Technologies
125
To change several settings:
$ sudo serveradmin settings
web:setting = value
web:setting = value
web:setting = value
[...]
Control-D
Web serveradmin Commands
You can use the following commands with the serveradmin application to manage 
Web service.
Listing Hosted Sites
You can use the serveradmin getSites command to display a list of the sites hosted 
by the server along with basic settings and status.
To list sites:
$ sudo serveradmin command web:command = getSites
Viewing Service Logs
You can use tail or any other file listing tool to view the contents of Web service 
access and error logs for each site hosted by the server.
To view the latest entries in a log:
$ tail log-file
You can use the serveradmin getLogPaths command to see where the current error 
and activity logs for each site are located.
To display the log paths:
$ sudo serveradmin command web:command = getLogPaths
Command
(web:command=)
Description
getHistory
View Web service statistics. See “Viewing Service Statistics” on 
page 126.
getLogPaths
Finding the access and error logs for each hosted site. See “Viewing 
Service Logs” on this page.
getSites
Listing existing sites. See “Listing Hosted Sites” on this page.
LL2354.book  Page 125  Monday, October 20, 2003  9:47 AM
126
Chapter 12    Working With Web Technologies
Viewing Service Statistics
You can use the serveradmin getHistory command to display a log of periodic 
samples of the number of requests, cache performance, and data throughput. Samples 
are taken once each minute.
To list samples:
$ sudo serveradmin command
qtss:command = getHistory
qtss:variant = statistic
qtss:timeScale = scale
Control-D
Output
web:nbSamples = 
web:samplesArray:_array_index:0:vn = 
web:samplesArray:_array_index:0:t = 
web:samplesArray:_array_index:1:vn = 
web:samplesArray:_array_index:1:t = 
[...]
web:samplesArray:_array_index:i:vn = 
web:samplesArray:_array_index:i:t = 
web:vnLegend = ""
web:currentServerTime = 
Parameter
Description
statistic
The value you want to display. Valid values:
v1 - number of requests per second
v2 - throughput (bytes/sec)
v3 - cache requests per second
v4 - cache throughput (bytes/sec)
scale
The length of time in seconds, ending with the current time, for 
which you want to see samples. For example, to see 30 minutes of 
data, you would specify qtss:timeScale = 1800.
Value displayed by getHistory
Description
The total number of samples listed.
A textual description of the selected statistic. 
"REQUESTS_PER_SECOND" for v1
"THROUGHPUT" for v2
"CACHE_REQUESTS_PER_SECOND" for v3
"CACHE_THROUGHPUT" for v4
The numerical value of the sample.
The time at which the sample was measured. A standard UNIX time 
(number of seconds since Sep 1, 1970.) Samples are taken every 60 
seconds.
LL2354.book  Page 126  Monday, October 20, 2003  9:47 AM
Chapter 12    Working With Web Technologies
127
Example Script for Adding a Website
The following script shows how you can use serveradmin to add a website to the 
server’s Web service configuration. The script uses two files:
• addsite  The actual script you run. It accepts values for the site’s IP address, port 
number, server name, and root directory and uses sed to substitute these values in 
the settings it reads from the second file (addsite.in) feeds to serveradmin.
• addsite.in  Contains the actual settings (with placeholders for values you provide 
when you run addsite) used to create the website.
The addsite File
sed -es#_ipaddr#$1#g -es#_port#$2#g -es#_servername#$3#g 
-es#_docroot#$4#g ./addsite.in | /usr/sbin/serveradmin --set -i
The addsite.in File
web:Sites:_array_id:_ipaddr\:_port__servername = create
web:Sites:_array_id:_ipaddr\:_port__servername:Listen:_array_index:0 = 
"_ipaddr:_port"
web:Sites:_array_id:_ipaddr\:_port__servername:ServerName = _servername
web:Sites:_array_id:_ipaddr\:_port__servername:ServerAdmin = 
admin@_servername
web:Sites:_array_id:_ipaddr\:_port__servername:DirectoryIndex:_array_index:0 
= "index.html"
web:Sites:_array_id:_ipaddr\:_port__servername:DirectoryIndex:_array_index:1 
= "index.php"
web:Sites:_array_id:_ipaddr\:_port__servername:WebMail = yes
web:Sites:_array_id:_ipaddr\:_port__servername:CustomLog:_array_index:0:
Format = "%{User-agent}i"
web:Sites:_array_id:_ipaddr\:_port__servername:CustomLog:_array_index:0:
enabled = yes
web:Sites:_array_id:_ipaddr\:_port__servername:CustomLog:_array_index:0:
ArchiveInterval = 0
web:Sites:_array_id:_ipaddr\:_port__servername:CustomLog:_array_index:0:
Path = "/private/var/log/httpd/access_log"
web:Sites:_array_id:_ipaddr\:_port__servername:CustomLog:_array_index:0:
Archive = yes
web:Sites:_array_id:_ipaddr\:_port__servername:Directory:_array_id:
/Library/WebServer/Documents:Options:Indexes = yes
web:Sites:_array_id:_ipaddr\:_port__servername:Directory:_array_id:
/Library/WebServer/Documents:Options:ExecCGI = no
web:Sites:_array_id:_ipaddr\:_port__servername:Directory:_array_id:
/Library/WebServer/Documents:AuthName = "Test Site"
web:Sites:_array_id:_ipaddr\:_port__servername:ErrorLog:ArchiveInterval = 0
web:Sites:_array_id:_ipaddr\:_port__servername:ErrorLog:Path = 
"/private/var/log/httpd/error_log"
web:Sites:_array_id:_ipaddr\:_port__servername:ErrorLog:Archive = no
web:Sites:_array_id:_ipaddr\:_port__servername:Include:_array_index:0 = 
"/etc/httpd/httpd_squirrelmail.conf"
web:Sites:_array_id:_ipaddr\:_port__servername:enabled = yes
LL2354.book  Page 127  Monday, October 20, 2003  9:47 AM
128
Chapter 12    Working With Web Technologies
web:Sites:_array_id:_ipaddr\:_port__servername:ErrorDocument:_array_index:0:
StatusCode = 404
web:Sites:_array_id:_ipaddr\:_port__servername:ErrorDocument:_array_index:0:
Document = "/nwesite_notfound.html"
web:Sites:_array_id:_ipaddr\:_port__servername:LogLevel = "warn"
web:Sites:_array_id:_ipaddr\:_port__servername:IfModule:_array_id:mod_ssl.c:
SSLEngine = no
web:Sites:_array_id:_ipaddr\:_port__servername:IfModule:_array_id:mod_ssl.c:
SSLPassPhrase = ""
web:Sites:_array_id:_ipaddr\:_port__servername:IfModule:_array_id:mod_ssl.c:
SSLLog = "/private/var/log/httpd/ssl_engine_log"
web:Sites:_array_id:_ipaddr\:_port__servername:DocumentRoot = "_docroot"
web:Sites:_array_id:_ipaddr\:_port__servername
To run the script:
$ addsite ipaddress port name root
If you get the message “command not found” when you try to run the script, precede 
the command with the full path to the script file. For example,
/users/admin/documents/addsite 10.0.0.2 80 corpsite 
/users/webmaster/sites/corpsite
Or, use cd to change to the directory that contains the file and precede the command 
with ./. For example:
$ cd /users/admin/documents
$ ./addsite 10.0.0.2 80 corpsite /users/webmaster/sites/corpsite
Parameter
Description
ipaddress
The IP address for the site.
port
The port number to be used to for HTTP access to the site.
name
The name of the site.
root
The root directory for the site’s files and subdirectories.
LL2354.book  Page 128  Monday, October 20, 2003  9:47 AM
13
129
13 Working With Network Services
Commands you can use to manage DHCP, DNS, Firewall, 
NAT, and VPN service in Mac OS X Server.
DHCP Service
Starting and Stopping DHCP Service
To start DHCP service:
$ sudo serveradmin start dhcp
To stop DHCP service:
$ sudo serveradmin stop dhcp
Checking the Status of DHCP Service
To see summary status of DHCP service:
$ sudo serveradmin status dhcp
To see detailed status of DHCP service:
$ sudo serveradmin fullstatus dhcp
Viewing DHCP Service Settings
To list DHCP service configuration settings:
$ sudo serveradmin settings dhcp
To list a particular setting:
$ sudo serveradmin settings dhcp:setting
To list a group of settings:
You can list a group of settings that have part of their names in common by typing 
only as much of the name as you want, stopping at a colon (:), and typing an asterisk 
(*) as a wildcard for the remaining parts of the name. For example,
$ sudo serveradmin settings dhcp:subnets:*
LL2354.book  Page 129  Monday, October 20, 2003  9:47 AM
130
Chapter 13    Working With Network Services
Changing DHCP Service Settings
To change a setting:
$ sudo serveradmin settings dhcp:setting = value
To change several settings:
$ sudo serveradmin settings
dhcp:setting = value
dhcp:setting = value
dhcp:setting = value
[...]
Control-D
DHCP Service Settings
Use the following parameters with the serveradmin command to change settings for 
the dhcp service.
Parameter
Description
setting
A DHCP service setting. To see a list of available settings, type
$ sudo serveradmin settings dhcp
or see “DHCP Service Settings” on this page and “DHCP Subnet 
Settings Array” on page 131.
value
An appropriate value for the setting.
Parameter (dhcp:)
Description
logging_level
"LOW"|"MEDIUM"|"HIGH"
Default = "MEDIUM"
Corresponds to the Log Detail Level pop-up menu 
in the Logging pane of DHCP service settings in 
the Server Admin GUI application.
subnet_status
Default = 0
subnet_defaults:logVerbosity
"LOW"|"MEDIUM"|"HIGH"
Default = "MEDIUM"
subnet_defaults:logVerbosityList:
_array_index:n
Available values for the logVerbosity setting. 
Default = "LOW," "MEDIUM," and "HIGH"
subnet_defaults:WINS_node_type
Default = "NOT_SET"
subnet_defaults:routers
Default = empty_dictionary
subnet_defaults:selected_port_key
Default = en0
subnet_defaults:selected_port_key
_list:_array_index:n
An array of available ports.
subnet_defaults:dhcp_domain_name
Default = The last portion of the server’s host 
name, for example, company.com.
LL2354.book  Page 130  Monday, October 20, 2003  9:47 AM
Chapter 13    Working With Network Services
131
DHCP Subnet Settings Array
An array of the settings listed in the following table is included in the DHCP service 
settings for each subnet you define. You can add a subnet to the DHCP configuration 
by using serveradmin to add an array of these settings.
About Subnet IDs
In an actual list of settings,  is replaced with a unique ID code for the 
subnet. The IDs generated by the server are just random numbers. The only 
requirement for this ID is that it be unique among the subnets defined on the server.
subnet_defaults:dhcp_domain_name_
server:_array_index:n
Default = The DNS server addresses provided 
during server setup, as listed in the Network pane 
of the server’s System Preferences.
subnets:_array_id:...
An array of settings for a particular subnet. 
 is a unique identifier for each 
subnet. See “DHCP Subnet Settings Array” on this 
page.
Parameter (dhcp:)
Description
Subnet Parameter
subnets:_array_id::
Description
descriptive_name
A textual description of the subnet.
Corresponds to the Subnet Name field in the General 
pane of the subnet settings in the Server Admin GUI 
application.
dhcp_domain_name
The default domain for DNS searches, for example, 
company.com.
Corresponds to the Default Domain field in the DNS 
pane of the subnet settings in the Server Admin GUI 
application.
dhcp_domain_name_server:
_array_index:n
The primary WINS server to be used by clients.
Corresponds to the Name Servers field in the DNS pane 
of the subnet settings in the Server Admin GUI 
application.
dhcp_enabled
Whether DHCP is enabled for this subnet.
Corresponds to the Enable checkbox in the list of 
subnets in the Subnets pane of the DHCP settings in the 
Server Admin GUI application.
dhcp_ldap_url:
_array_index:n
The URL of the LDAP directory to be used by clients.
Corresponds to the Lease URL field in the LDAP pane of 
the subnet settings in the Server Admin GUI application.
dhcp_router
The IPv4 address of the subnet’s router.
Corresponds to the Router field in the General pane of 
the subnet settings in the Server Admin GUI application.
LL2354.book  Page 131  Monday, October 20, 2003  9:47 AM
132
Chapter 13    Working With Network Services
lease_time_secs
Lease time in seconds.
Default = "3600"
Corresponds to the Lease Time pop-up menu and field in 
the General pane of the subnet settings in the Server 
Admin GUI application.
net_address
The IPv4 network address for the subnet.
net_mask
The subnet mask for the subnet.
Corresponds to the Subnet Mask field in the General 
pane of the subnet settings in the Server Admin GUI 
application.
net_range_end
The highest available IPv4 address for the subnet.
Corresponds to the Ending IP Address field in the 
General pane of the subnet settings in the Server Admin 
GUI application.
net_range_start
The lowest available IPv4 address for the subnet.
Corresponds to the Starting IP Address field in the 
General pane of the subnet settings in the Server Admin 
GUI application.
selected_port_name
The network port for the subnet.
Corresponds to the Network Interface pop-up menu in 
the General pane of the subnet settings in the Server 
Admin GUI application.
WINS_NBDD_server
The NetBIOS Datagram Distribution Server IPv4 address. 
Corresponds to the NBDD Server field in the WINS pane 
of the subnet settings in the Server Admin GUI 
application.
WINS_node_type
The WINS node type. Can be set to:
""  (not set, default)
BROADCAST_B_NODE
PEER_P_NODE
MIXED_M_NODE
HYBRID-H-NODE
Corresponds to the NBT Node Type field in the WINS 
pane of the subnet settings in the Server Admin GUI 
application.
WINS_primary_server
The primary WINS server to be used by clients.
Corresponds to the WINS/NBNS Primary Server field in 
the WINS pane of the subnet settings in the Server 
Admin GUI application.
Subnet Parameter
subnets:_array_id::
Description
LL2354.book  Page 132  Monday, October 20, 2003  9:47 AM
Chapter 13    Working With Network Services
133
Adding a DHCP Subnet
You may already have a subnet for each port you enabled when you installed and set 
up the server. You can use the serveradmin settings command to check for subnets 
that the server set up for you; see “Viewing DHCP Service Settings” on page 129.
You can use the serveradmin settings command to add other subnets to your DHCP 
configuration. 
Note:  Be sure to include the special first setting (ending with = create). This is how 
you tell serveradmin to create the necessary settings array with the specified 
subnet ID. 
To add a subnet:
$ sudo serveradmin settings
dhcp:subnets:_array_id:subnetID = create
dhcp:subnets:_array_id:subnetID:WINS_NBDD_server = nbdd-server
dhcp:subnets:_array_id:subnetID:WINS_node_type = node-type
dhcp:subnets:_array_id:subnetID:net_range_start = start-address
dhcp:subnets:_array_id:subnetID:WINS_scope_id = scope-ID
dhcp:subnets:_array_id:subnetID:dhcp_router = router
dhcp:subnets:_array_id:subnetID:net_address = net-address
dhcp:subnets:_array_id:subnetID:net_range_end = end-address
dhcp:subnets:_array_id:subnetID:lease_time_secs = lease-time
dhcp:subnets:_array_id:subnetID:dhcp_ldap_url:_array_index:0 = ldap-server
dhcp:subnets:_array_id:subnetID:WINS_secondary_server = wins-server-2
dhcp:subnets:_array_id:subnetID:descriptive_name = description
dhcp:subnets:_array_id:subnetID:WINS_primary_server = wins-server-1
dhcp:subnets:_array_id:subnetID:dhcp_domain_name = domain
dhcp:subnets:_array_id:subnetID:dhcp_enabled = (yes|no)
dhcp:subnets:_array_id:subnetID:dhcp_domain_name_server:_array_index:0 = 
dns-server-1
dhcp:subnets:_array_id:subnetID:dhcp_domain_name_server:_array_index:1 = 
dns-server-2
dhcp:subnets:_array_id:subnetID:net_mask = mask
dhcp:subnets:_array_id:subnetID:selected_port_name = port
Control-D
WINS_scope_id
A domain name such as apple.com.
Default = ""
Corresponds to the NetBIOS Scope ID field in the WINS 
pane of the subnet settings in the Server Admin GUI 
application.
WINS_secondary_server
The secondary WINS server to be used by clients.
Corresponds to the WINS/NBNS Secondary Server field in 
the WINS pane of the subnet settings in the Server 
Admin GUI application.
Subnet Parameter
subnets:_array_id::
Description
LL2354.book  Page 133  Monday, October 20, 2003  9:47 AM
134
Chapter 13    Working With Network Services
List of DHCP serveradmin Commands
You can use the following command with the serveradmin application to manage 
DHCP service.
Viewing the DHCP Service Log
You can use tail or any other file listing tool to view the contents of the DHCP service 
log.
To view the latest entries in a log:
$ tail log-file
You can use the serveradmin getLogPaths command to see where the current DHCP 
log is located.
To display the log path:
$ sudo serveradmin command dhcp:command = getLogPaths
Output
dhcp:systemLog = 