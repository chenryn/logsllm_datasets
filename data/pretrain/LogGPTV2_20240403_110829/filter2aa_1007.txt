About 
• 阿里巴巴移动安全专家
• 曾发现谷歌，苹果等众多国
内外知名公司漏洞
• 擅长windows安全，
andrdoid安全，漏洞挖掘
• 支付宝钱包终端攻防对抗组
的负责人
• 客户端技术专家
• 主要移动端逆向、漏洞挖掘、
防护
dragonltx
曲和
Alipay.unLimit.Security.Team
1
第三方库安全现状
2
攻击Android第三方库
3
Fuzz*Android第三方库
4
第三方库安全思考
5
Q&A
Agenda
Part. 01
第三方库安全现状
3
探索⼀切、攻破⼀切 | [ Hacker@KCon ]
探索⼀切、攻破⼀切 | [ Hacker@KCon ]
探索⼀切、攻破⼀切 | [ Hacker@KCon ]
Part. 02
攻击Android第三方库
7
2
zxing
二维码解析库
几乎所有App都有扫码功能，攻击范围大
2
zxing
sqlcipher
第三方透明加密数据库组件
sqlcipher编译时没移除load* extension
sql注入配合load_extension进行漏洞利用
sqlcipher
远程代码执行
黑客可将文件通过目录遍历漏洞放到app私有目录下
通过发消息触发sql注入语句
存在漏洞的app可以接收文件
攻击思路最早由TSRC白帽子雪人提出：
chromium
国内很多Android浏览器都使用这个内核进行二次开发
最新的Android系统webview使用该引擎
历史漏洞众多(uxss,overflow,use* after*free,address*bar*spoof*etc.)
chromium
chromium
530301/531891影响众多国内浏览器
chromium
530301/531891影响国内众多Android5.0系统webview/系统自带浏览器
stagefright
Android多媒体解析库
许多Android* App也会使用stagefright作为多媒体解析库
可通过彩信，视频浏览等进行攻击
stagefright
2
libupnp
局域网内便捷播放UPnP架构库
开放了UDP 1900端口，可远程攻击
2
libupnp
2
ffmpeg
采集功能、视频格式转换、视频抓图、给视频加水印等。
越来越多的应用使用ffmpeg库
2
ffmpeg
2
ffmpeg*CVE-2016-6920*0day
2
sdk安全
so可被劫持
so自身设计安全
Part. 03
Fuzz*Android第三方库
25
Fuzz**tools
Peach
MFFA
honggfuzz
AFL
Peach*fuzz教程
http://www.peachfuzzer.com
https://github.com/fuzzing/MFFA
https://github.com/google/honggfuzz
http://lcamtuf.coredump.cx/afl/
http://bbs.pediy.com/showthread.php?t=176420
Android
Fuzz
基于文件格式规范
样本大小无限制
无需基于文件格式规范
代码路径反馈
小样本
Peach
Honggfuzz
AFL
无需基于文件格式规范
代码路径反馈
小样本
MFFA + Peach
MFFA传输样本到手机
基于peach.pit生成样本
MFFA调起目标并监控崩溃
Peach
MFFA
案例：360影视 fuzz
案例：360影视 fuzz
案例：360影视 fuzz
案例：skia fuzz
9-patch*(also*known*as*NinePatch)*
is*an*Android-specific*extension*to
the*PNG*image*format*that*allows*
for*automatic*scaling*of*images
案例：skia fuzz
案例：skia fuzz（CVE-2015-1532 Reproduce）
案例：stagefright fuzz
build the module 
push the module
run the module
frameworks/av/cmds/stagefright
mma
/data/local/tmp/
./stagefright –a
./stagefright -s
案例：stagefright fuzz(CVE-2015-6599)
案例：stagefright fuzz(CVE-2015-6599)
AFL + Peach + MFFA
AFL
Peach
Create.sample.
file.based.on.
afl.corrupted.
file
Run.
stagefright.
with.MFFA
Build.the.
android.
source.
code
Build.
stagefright.
with.afl
Run.
stagefright.
with.afl-
fuzz
• Your*text*in*here
• Your*text*in*here
• Your*text*in*here
• Your*text*in*here
• Your*text*in*here
• Your*text*in*here
• Your*text*in*here
• Your*text*in*here
More*
code*
coverage
Based*on
file*
specification
Advantage
linkage
More*
efficiency
案例：stagefright fuzz(CVE-2016-0842 Duplicate)
案例：stagefright fuzz(CVE-2016-0842 Duplicate)
案例：stagefright fuzz(CVE-2016-0842 Duplicate)
Part. 04
第三方库安全思考
42
扫描器直接支持第三方库漏
洞扫描？
使用后扫描
存在1个第三方库漏洞库方
便开发查询使用的SDK是否
存在历史漏洞？
使用前查询
Q&A
2
我们正在招聘
支付宝钱包移动安全团队(新组建)
逆向、漏洞等
T
H
A
N
K
S