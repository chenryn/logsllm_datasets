### 图11：流完成时间与截止时间的散点图

- **TCP（左）**、**RCPdc（中）** 和 **D3（右）** 的流完成时间与截止时间的散点图。位于对角线以上的点表示满足了截止时间的流。

公平共享协议，如 RCPdc 和 DCTCP，通过确保无丢包和网络中的短队列来解决这一问题；然而，由于它们并不了解截止时间，仍有大量流错过了其相关的截止时间（见图11中间）。在这些特定实验中，RCPdc 错过了 8.1% 的流截止时间，而 D3 仅为 1%。进一步观察错过截止时间的流，RCPdc 导致其完成时间超过截止时间的 95 百分位为 75%（平均 30%），而 D3 则为 27.7%（平均 9%）。这意味着即使截止时间是“软”的，公平共享协议仍然表现不佳，因为相当一部分流显著超过了截止时间。这对于数据中心来说是不可接受的，因为需要确保非常高的百分比的流具有良好的性能。

对于 TCPpr，我们使用两级优先级。具有较短截止时间的流被映射到较高优先级类。这种“截止时间感知”提高了其相对于 TCP 的性能。然而，它仍然受到 TCP 拥塞控制算法的影响，并且会遭受丢包。增加优先级类到四个（交换机支持的最大值）并没有显著改善性能。简单地将 RCPdc 与优先级结合也不会有帮助。这是因为截止时间可以有很大的变化，需要大量的优先级类，而当今的交换机只支持 O(10) 类。此外，如第 3 节所述，交换机优先级是基于数据包的，而截止时间是与流相关的。最后，突发的数据中心流量意味着需要根据截止时间和网络条件动态地优先处理流，而不是静态地将流映射到优先级类。D3 正好解决了所有这些问题。

### 在背景流存在的情况下

我们重复上述流突发实验，添加长的背景流。这些流用于更新工作节点的最新数据，通常没有关联的截止时间。每次运行时，我们从一个流量生成器向接收者发送一个长流。该流在接收者与其 ToR 交换机之间的链路上形成瓶颈。五秒后，所有发送者发送响应（[2KB, 50KB]）。

图 12 显示了三种协议在高应用吞吐量操作模式下的情况。与仅响应流的情况相比，最大发送者数量的相对下降对于 D3 来说比 TCP、TCPpr 和 RCPdc 小得多。性能显著下降的原因是大多数流需要超过 3 个 RTT 才能完成，在此期间 TCP 发送窗口将超过 8 个数据包。

### 图12：在存在长背景流的情况下支持的并发发送者数量

- 确保超过 99% 应用吞吐量时支持的并发发送者数量。

### 图13：不同发送者数量下的应用吞吐量

- 响应流大小为 2.9KB，存在一个长背景流时的应用吞吐量。

在存在排队背景流的情况下，TCP 和 TCPpr 的性能下降已被广泛记录 [4]。值得注意的是，即使只有两个发送者，TCP 也无法达到 99% 的应用吞吐量。TCPpr 在这种情况下实现了三级优先级，其中背景流被分配到最低优先级类，而截止时间流则根据其截止时间值分配到其他两个优先级类。然而，背景流仍然消耗缓冲空间并影响高优先级响应流。因此，D3 在存在背景流量的情况下更好地满足了流的截止时间。

### 对于极小的响应流

由于 TCP 在数据中心中处理流突发的问题，应用程序设计者被迫使用各种“hack”作为变通方法。这包括限制响应流的大小 [4]。这里，我们重复流突发实验，响应流大小统一为 2.9KB，使得响应流只有 2 个数据包长。此外，存在一个长背景流。图 13 显示了适度截止时间（均值 = 30ms）下的应用吞吐量。使用 TCP 时，长流填满了队列，导致一些响应流遭受丢包。因此，应用吞吐量在只有 12 个发送者时就开始下降。相比之下，其他三种方法在 40 个发送者之前都能满足所有截止时间。由于响应流很小，D3 在这方面无法超越 RCPdc 和 TCPpr。然而，我们之前的实验结果表明，如果设计者能够摆脱 TCP 效率低下的约束，D3 可以提供比公平共享方法和优先级方法更大的收益。

由于 RCPdc 是公平共享协议的上限，并且比优先级方法表现更好，接下来的部分我们将主要比较 D3 和 RCPdc；TCP 也将作为当前状态的参考。

### 6.1.2 基准流量

在本节中，我们评估 D3 在实际数据中心流量模式和流动态下的性能。与之前一样，我们选择每个机架中的一个终端主机作为聚合主机。

| 流/秒 | TCP（减少 RTO） | RCPdc | D3 |
| --- | --- | --- | --- |
| 1300 | 100 (1100) | 2000 |

表 1：在保持 >99% 应用吞吐量的同时支持的流到达速率。

### 图14：不同流完成时间下的流完成时间分布

- 流完成时间范围从 0 到 300ms。
- D3、RCPdc 和 TCP 的流完成时间分布。

通过这些图表和实验结果，我们可以看到 D3 在多种场景下都表现出色，特别是在存在背景流量和小响应流的情况下。