title:The Waterfall of Liberty: Decoy Routing Circumvention that Resists
Routing Attacks
author:Milad Nasr and
Hadi Zolfaghari and
Amir Houmansadr
Decoy Routing Circumvention that Resists Routing Attacks
The Waterfall of Liberty:
Milad Nasr
University of Massachusetts Amherst
PI:EMAIL
Hadi Zolfaghari
PI:EMAIL
University of Massachusetts Amherst
University of Massachusetts Amherst
Amir Houmansadr
PI:EMAIL
ABSTRACT
Decoy routing is an emerging approach for censorship circum-
vention in which circumvention is implemented with help from a
number of volunteer Internet autonomous systems, called decoy
ASes. Recent studies on decoy routing consider all decoy routing
systems to be susceptible to a fundamental attack —regardless of
their specific designs—in which the censors re-route traffic around
decoy ASes, thereby preventing censored users from using such
systems. In this paper, we propose a new architecture for decoy
routing that, by design, is significantly stronger to rerouting attacks
compared to all previous designs. Unlike previous designs, our new
architecture operates decoy routers only on the downstream traffic
of the censored users; therefore we call it downstream-only decoy
routing. As we demonstrate through Internet-scale BGP simula-
tions, downstream-only decoy routing offers significantly stronger
resistance to rerouting attacks, which is intuitively because a (cen-
soring) ISP has much less control on the downstream BGP routes
of its traffic.
Designing a downstream-only decoy routing system is a challeng-
ing engineering problem since decoy routers do not intercept the
upstream traffic of censored users. We design the first downstream-
only decoy routing system, called Waterfall, by devising unique
covert communication mechanisms. We also use various techniques
to make our Waterfall implementation resistant to traffic analysis
attacks.
We believe that downstream-only decoy routing is a significant
step towards making decoy routing systems practical. This is be-
cause a downstream-only decoy routing system can be deployed
using a significantly smaller number of volunteer ASes, given a
target resistance to rerouting attacks. For instance, we show that a
Waterfall implementation with only a single decoy AS is as resistant
to routing attacks (against China) as a traditional decoy system
(e.g., Telex) with 53 decoy ASes.
CCS CONCEPTS
• Security and privacy → Pseudonymity, anonymity and un-
traceability; Privacy-preserving protocols;
Permission to make digital or hard copies of all or part of this work for personal or
classroom use is granted without fee provided that copies are not made or distributed
for profit or commercial advantage and that copies bear this notice and the full citation
on the first page. Copyrights for components of this work owned by others than the
author(s) must be honored. Abstracting with credit is permitted. To copy otherwise, or
republish, to post on servers or to redistribute to lists, requires prior specific permission
and/or a fee. Request permissions from permissions@acm.org.
CCS ’17, October 30-November 3, 2017, Dallas, TX, USA
© 2017 Copyright held by the owner/author(s). Publication rights licensed to Associa-
tion for Computing Machinery.
ACM ISBN 978-1-4503-4946-8/17/10...$15.00
https://doi.org/10.1145/3133956.3134075
KEYWORDS
Internet Censorship, censorship circumvention, decoy routing, rout-
ing attacks
1 INTRODUCTION
Internet censorship continues to remain a global threat to the free-
dom of speech, ideas, and information. An increasing number of
repressive regimes and totalitarian governments implement In-
ternet censorship [11, 32, 33, 46] using various techniques such
as IP address filtering, DNS interference, and deep-packet inspec-
tion [31, 50]. To help the impacted Internet users bypass such cen-
sorship, various circumvention systems have been designed and
deployed by academics and practitioners [5, 13, 17, 24, 30, 42].
Decoy routing [21, 25, 59] is an emerging approach for censor-
ship circumvention. Unlike traditional circumvention systems (e.g.,
Tor [13], VPNs [42, 43], and Psiphon [24]) where circumvention
software is implemented on computer servers, in decoy routing
the circumvention software is mounted on the Internet routers of
some volunteer Internet autonomous systems called decoy ASes.
That is, decoy routing takes an end-to-middle proxying approach
in contrast to the traditional end-to-end proxies. This, by design,
makes decoy routing resistant to IP address blocking, which is one
of the most effective, most widely practiced censorship mechanisms
for disabling traditional end-to-end circumvention systems like Tor
and VPNs.
Existing decoy routing systems are known to be susceptible to
particular routing attacks by the censors, known as the routing
around decoys (RAD) attacks [48]. In RAD, the censoring ISPs ma-
nipulate the upstream Internet (BGP) routes of their Internet users
such that the censored users’ traffic does not transit through any of
the (identified) decoy ASes, therefore preventing the users from uti-
lizing decoy routing systems for circumvention. Recent studies on
decoy routing [22, 41, 48] consider RAD to be a fundamental weak-
ness of the decoy routing approach —regardless of the technical
specifications of decoy routing systems. In this paper, we debunk
this common belief by proposing a new decoy routing architecture
that—by design—provides significantly stronger resistance to RAD
and similar rerouting attacks compared to traditional decoy routing
systems. The core idea of our new decoy routing architecture is to
operate decoy routers only on the downstream traffic of the cen-
sored users, with no need for intercepting the upstream traffic of the
censored users; therefore, we name our new approach downstream-
only decoy routing. This is in contrast to the architecture used by
—all—previous decoy routing systems [4, 15, 21, 25, 58, 59] where
they all need to intercept the upstream traffic of the censored users
Session I5:  Communication PrivacyCCS’17, October 30-November 3, 2017, Dallas, TX, USA2037(some previous designs need to intercept both upstream and down-
stream [21, 25, 59], while others need to intercept only the up-
stream [4, 15, 58] traffic). Figure 1 illustrates the difference between
various architectures.
As we demonstrate through Internet-scale BGP path simulations,
downstream-only decoy routing offers significantly stronger resis-
tance to routing attacks by the censors compared to the traditional
(upstream) decoy routing approach. Intuitively, this is because a
typical (censoring) ISP has significantly more leverage on shap-
ing the BGP routes of its upstream traffic than its downstream
traffic. Particularly, a censoring ISP can re-route its upstream traf-
fic by applying per-destination routing rules (e.g., re-route only
the traffic towards specific Internet destinations), however, it can
not re-route downstream traffic by applying per-source rules (e.g.,
the censoring ISP has to re-route either all or none of its down-
stream traffic through each of its Internet provider ASes). The RAD
attack, as studied in the literature [22, 41, 48], only modifies the
upstream BGP routes, therefore does not trivially work against
our downstream-only architecture. We therefore introduce and
investigate two variants of the RAD attack that are specifically
tailored to downstream-only decoy routing systems. We demon-
strate through Internet-scale path simulations that applying such
routing attacks on downstream-only decoy routing is extremely
costlier than routing attacks on traditional (upstream) decoy rout-
ing systems. For instance, we show that a downstream-only decoy
routing system implemented on only a single decoy AS is as re-
sistant to routing attacks (by the Chinese censors) as a traditional
decoy routing system (e.g., Telex) with 53 decoy ASes. We argue
that downstream-only decoy routing is a major step forward
in making decoy routing systems practical, as they need to be
deployed on a significantly smaller number of volunteer ASes for a
target resistance to routing attacks.
Note that designing a downstream-only decoy routing system
is an extremely challenging engineering problem. All previous (up-
stream) decoy routing designs [4, 15, 21, 25, 58, 59] use the upstream
traffic of the censored users to communicate essential covert mes-
sages to the decoy routers, such as registration requests, HTTP
GET requests for blocked destinations, etc. This is not possible in
a downstream-only decoy routing system since the upstream traf-
fic of the censored users is not supposed to be intercepted by the
decoy routers. We design the first downstream-only decoy routing
system, called Waterfall.1 We use a set of complementary mecha-
nisms to enable low-latency upstream covert communications in
Waterfall despite its downstream-only architecture. Particularly,
we use HTTP redirection and several other techniques to enable
real-time upstream covert communications in Waterfall. We also
use various techniques to make Waterfall resistant to various traffic
analysis attacks. We have built a fully functional prototype of
Waterfall, which is publicly available online [55].
In summary, we make the following main contributions:
(1) We propose a novel decoy routing architecture, called downstream-
only decoy routing, that by-design provides much stronger
resistance to the infamous routing attacks by the censors,
compared to previous (upstream) decoy routing systems. We
1It is hard to deflect a waterfall’s falling water stream!
demonstrate the superior resistance of downstream-only de-
coy routing against routing attacks trough extensive Internet-
scale simulation of BGP routes.
(2) Designing a downstream-only decoy routing system is a chal-
lenging engineering problem. In this paper, we design the
first downstream-only decoy routing system, called Water-
fall, by using several novel covert communication techniques.
While resisting routing attacks is the main focus of this pa-
per, we also use novel techniques to make Waterfall resistant
to traffic analysis attacks.
(3) We have built a fully functional prototype of Waterfall, which
is publicly available online [55].
2 BACKGROUND
2.1 Major Censorship Circumvention Systems
Traditional censorship circumvention systems like Tor [12, 13, 28],
VPNs [42, 43], Psiphon [24], and many other systems [5, 14, 30]
work by setting up circumvention proxy servers outside the censor-
ship territories. Such proxies are used by censored users to bypass
censorship by relaying the traffic of the censored users to their
intended blocked Internet destinations. For instance, Tor [13] is
comprised of several thousands of volunteer proxies, and every
censored user will select a number of such proxies (usually three)
to relay her traffic to censored destinations. Unfortunately, proxy-
based circumvention systems are trivially blockable as soon as the
censors identify the IP addresses of their proxies. For instance, Tor
bridges [12] are discovered and blocked in-the-wild through vari-
ous mechanisms [6, 16, 35, 56, 57] such as insider attacks, zig-zag
attacks, and active probing.
Domain fronting [17] is a new approach to set up circumvention
proxies that resist IP address filtering. In this mechanism, circum-
vention proxies, e.g., Tor meek bridges [38], are run as web services
that share IP addresses with other, non-circumvention services,
therefore blocking them will impose collateral damage to the cen-
sors. Domain fronting, however, is an expensive circumvention
solution due to the bandwidth and CPU costs charged by the host-
ing web services [39]. CDNBrowsing [19, 61] is a similar circum-
vention solution in which censored users directly fetch censored
content from the public content-delivery networks like Akamai
that are hosting them. CDNBrowsing is much cheaper than domain
fronting as it does not run any proxies, however, it can unblock
only a limited class of censored websites [61].
2.2 Decoy Routing Circumvention Approach
Decoy routing is a recent approach for censorship circumven-
tion [21, 25, 59] whose design is motivated by the ease of IP address
blocking of traditional proxy-based circumvention systems, as dis-
cussed above. In decoy routing, censorship circumvention is imple-
mented with help from a number of friendly Internet autonomous
systems, called decoy ASes. Each decoy AS modifies some of its
routers (e.g., its border routers) such that they deflect the Inter-
net traffic of censored users to the blocked Internet destinations
requested by the users; the routers implementing the deflection
functionality are called decoy routers. By design, decoy routing
defeats IP address blocking, which is the most effective mechanism
used in-the-wild to disable traditional proxy-based circumvention
Session I5:  Communication PrivacyCCS’17, October 30-November 3, 2017, Dallas, TX, USA2038(a) Upstream (Type I)
[21, 25, 59]
(b) Upstream (Type II)
[4, 15, 58]
(c) Downstream-Only
Figure 1: Decoy routing architectures: In our downstream-only architecture shown in (c), decoy routers do not need to intercept
upstream overt traffic, but just downstream overt traffic (note that the downstream traffic may or may not be intercepted by
the decoy routers). By contrast, previous designs (shown in (a) and (b)) need to intercept upstream overt traffic to be able to
operate (some previous work shown in (a) need to intercept both upstream and downstream).
systems like Tor and VPNs. Figure 1 illustrates the decoy routing
approach.
To use a decoy routing system, a censored user will first need to
establish an encrypted connection (e.g., a TLS connection) with a
non-censored overt destination. The client selects the overt desti-
nation such that his network communications with that destination
transit through at least one decoy router. A decoy routing system is
composed of an upstream and a downstream covert communica-
tion channel through which the censored users communicate with
the decoy routers intercepting their overt traffic. Particularly, the up-
stream covert channel is used by the censored users to send covert
messages to decoy routers, e.g., HTTP GET requests for blocked
Internet destinations. On the other hand, the downstream covert
channel is used by the decoy routers to send covert messages to the
censored users, e.g., the HTTP responses obtained from blocked In-
ternet destinations. Each decoy routing system also has a signaling
(or registration) channel through which a censored user informs
the decoy routers intercepting her traffic of her willingness to use
the decoy routing system (the upstream and downstream covert
communications will establish only after a successful registration).
2.3 Existing Decoy Routing Designs
Table 1 compares the design of major decoy routing systems pro-
posed in the literature, along with our system Waterfall. As can be
seen, all previous designs use TLS records as their upstream and
downstream covert communication channels in different fashions.
Early decoy routing systems like Telex [59], Cirripede [21], and
Curveball [25] simply embed upstream and downstream covert
messages into the overt TLS connections man-in-the-middled by
decoy routers. They encrypt the covert content with keys previ-
ously exchanged between decoy routers and censored clients during
the signaling stage to foil deep-packet inspection by the censors.
More recent designs perform a more sophisticated replacement of
TLS records to provide stronger unobservability guarantees. For in-
stance, Slitheen [4] embeds upstream covert content as a particular
HTTP header in the upstream HTTP traffic towards an overt TLS