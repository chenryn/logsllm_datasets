• SSYYNN
• FFIINN
可使用多种方法将这些标志用于各种攻击中。此处仅介绍一项选择。
URG 标志表示该数据包十分紧急，必须先于所有其他数据包进行处理；PSH 标志设置 TCP 堆栈以刷新其缓存并将所有信息发送到应用程
序。这两种标志都可用于名为 Xmas 扫描的类型端口扫描中，通常为已启用 URG 和 PSH 标志的 FIN 数据包。此扫描的名称由来是交替打
开和关闭标志字节 (00101001) 中的位，类似圣诞树上的灯。
未受保护的计算机收到与 Xmas 扫描相关的数据包时，将出现以下情况：
条条件件 响响应应
关闭的端口 返回 RST 数据包
打开的端口 无响应，暴露了已打开端口的存在
RST 或 RESET 标志突然终止了 TCP 连接。如上所述，其合法使用还包括终止到指出连接不可行或未经允许的已关闭端口的连接。但是，
RST 标志还可以用作旨在破坏现有会话的 RESET 攻击的一部分。下图举例说明了一种攻击情况，其中主机 C 可以计算主机 A 期望从主机
B 的数据包获取的 TCP 序列号，因此欺骗主机 A 相信主机 B 已向其发送 RST 数据包。最终结果是拒绝服务攻击：
帧类型
术语“帧”是指以太网帧，提供的协议可指定帧包含的数据。
Internet 协议 (IP)、地址解析协议 (ARP) 和反向地址解析协议 (REVARP) 是当代以太网网络上最常包含的协议，但是通过从下拉列表中
选择“其他”，您可以通过其“帧编号”指定任何其他帧类型。
防火墙规则操作
防火墙规则可以执行以下操作：
• 允允许许：：明确允许符合规则的流量通过，隐式拒绝其他流量。
• 放放行行：：允许流量绕开防火墙和入侵防御分析。仅将此设置用于媒体密集协议。放行规则可基于 IP、端口、流量方向和协议。
93
亚信安全服务器深度安全防护系统 9.6 管理员指南 防火墙
• 拒拒绝绝：：明确阻止符合规则的流量。
• 强强制制允允许许：：强制允许另外可能被其他规则拒绝的流量。
注意： 强强制制允允许许规则允许的流量仍要经过入侵防御模块的分析。
• 仅仅记记录录：：流量将仅供记录。不会采取任何其他操作。
关于“允许”规则的更多信息
允允许许规则有两个功能：
1. 允许明确允许的流量。
2. 隐式拒绝所有其他流量。
注意： 将丢弃允允许许规则未明确允许的流量，并记录为不不允允许许的的策策略略防火墙事件。
常用的允允许许规则包括：
• AARRPP：允许传入的地址解析协议 (ARP) 流量。
• 允允许许请请求求的的 TTCCPP//UUDDPP 回回复复：确保主机计算机可以接收对其 TCP 和 UDP 消息的回复。这与 TCP 和 UDP 状态配置结合使用。
• 允允许许请请求求的的 IICCMMPP 回回复复：确保主机计算机可以接收对其 ICMP 消息的回复。这与 ICMP 状态配置结合使用。
关于“放行”规则的更多信息
放放行行规则专用于媒体密集协议，无需通过防火墙或入侵防御模块进行过滤。放放行行规则具有以下显著特征：
符合放放行行规则条件的数据包具有以下特点：
• 不受状态配置设置条件的约束。
• 可绕开防火墙和入侵防御分析。
由于状态检查未应用于已绕开的流量，因此绕开一个方向的流量不会自动绕开另一个方向的响应。因此，应始终成对创建和应用放行规
则，一个用于传入流量，另一个用于传出流量。
注意： 不会记录放行规则事件。这是不可配置的行为。
如果亚信安全服务器深度安全防护系统管理中心使用受亚信安全服务器深度安全防护系统客户端保护的远程数据库，那么在亚信安全服务
器深度安全防护系统管理中心将入侵防御规则保存到数据库时，将出现入侵防御相关的虚假警报。规则内容本身将误报为攻击。针对此情
况的解决方法之一是为从亚信安全服务器深度安全防护系统管理中心到数据库主机的流量创建放行规则。
亚信安全服务器深度安全防护系统管理中心流量的缺省放行规则
亚信安全服务器深度安全防护系统管理中心自动实现优优先先级级 44 放放行行规规则则，将在运行亚信安全服务器深度安全防护系统客户端的主机计算机
上的端口 4118 打开传入的 TCP 流量。优先级 4 可确保在所有拒绝规则之前先应用此规则，放行可保证流量始终不会受到影响。
但是，此规则接受来自任何 IP 地址和任何 MAC 地址的流量。要稳定此端口的 DSA，您可以为此端口创建更加严格的备用放行规则。客户
端实际上将禁用缺省管理中心流量规则以支持新定制规则，前提是其具有以下特性：
• 优优先先级级：： 4 — 最高
• 数数据据包包流流向向：： 传入
• 帧帧类类型型：： IP
• 协协议议：： TCP
94
亚信安全服务器深度安全防护系统 9.6 管理员指南 防火墙
• 数数据据包包目目标标端端口口：： 4118
定制规则必须使用以上参数替换缺省规则。实际管理中心的 IP 地址或 MAC 地址应用作规则的数据包源。
关于“强制允许”规则的更多信息
“强制允许”选项排除了另外可能被拒绝操作覆盖的流量子集。它与其他操作的关系如下所示。强制允许与放行规则的效果是一样的。但
是，和放行不同的是，因此操作通过防火墙的流量仍要由入侵防御模块进行审查。强制允许操作对于确保必要的网络服务能够与 DSA 计算
机进行通信特别有用。这些缺省的强制允许规则通常会在实际应用中启用：
• 允许
• 拒绝
• 强制允许
注意： 在多节点排列中使用多个管理中心计算机时，最好为这些计算机定义一个 IP 列表，然后将此列表用于定制管理中心流量
规则
防火墙规则流程
到达计算机的数据包会先按防火墙规则进行处理，接着根据状态配置条件进行处理，最后再按入侵防御规则进行处理。
以下是应用防火墙规则的顺序（传入和传出）：
1. 具有优先级 44（（最最高高））的防火墙规则
1. 放放行行
2. 仅仅记记录录（只能为仅仅记记录录规则分配优先级 44（（最最高高）））
3. 强强制制允允许许
4. 拒拒绝绝
2. 具有优先级 33（（高高））的防火墙规则
1. 放放行行
2. 强强制制允允许许
3. 拒拒绝绝
3. 具有优先级 22（（一一般般））的防火墙规则
1. 放放行行
2. 强强制制允允许许
3. 拒拒绝绝
4. 具有优先级 11（（低低））的防火墙规则
1. 放放行行
2. 强强制制允允许许
3. 拒拒绝绝
5. 具有优先级 00（（最最低低））的防火墙规则
1. 放放行行
2. 强强制制允允许许
3. 拒拒绝绝
4. 允允许许（请注意，允允许许规则只能分配优先级 00（（最最低低）））
95
亚信安全服务器深度安全防护系统 9.6 管理员指南 防火墙
注意： 如果计算机上没有任何允允许许规则生效，除非被拒拒绝绝规则特别阻止，否则将允许所有流量。创建单个允允许许规则后，除非其满
足允允许许规则的条件，否则将阻止所有其他流量。此情况有一个例外：除非拒拒绝绝规则明确阻止 ICMPv6 网络通信，否则始终
允许该网络通信。
在同一优先级上下文中，拒拒绝绝规则会覆盖允允许许规则，而强强制制允允许许规则将会覆盖拒拒绝绝规则。通过使用规则优先级系统，可以制订较高优先级
的拒拒绝绝规则来覆盖较低优先级的强强制制允允许许规则。
考虑一个 DNS 服务器策略示例，该策略使用强强制制允允许许规则，从而允许所有经由 TCP/UDP 端口 53 的传入 DNS 查询。创建优先级高于强强制制
允允许许规则的拒拒绝绝规则，则可以指定某特定范围的 IP 地址并必须禁止使用这些地址来访问同一个公共服务器。
通过基于优先级的规则集，您可以设置应用规则时所要依据的顺序。如果已设置具有最高优先级的拒拒绝绝规则，而且同一优先级中没有强强制制
允允许许规则，则会自动丢弃匹配该拒拒绝绝规则的任何数据包，并忽略其余的规则。相反地，如果具有最高优先级标志集的强强制制允允许许规则存在，
则会自动允许匹配该强强制制允允许许规则的任何传入数据包通过，且不针对任何其他规则进行检查。
有关记录的注意事项
放放行行规规则则从不生成事件。此选项不可配置。
仅当符合规则的数据包后来没有被下列任一规则阻止时，仅仅记记录录规则才会生成事件：
• 拒拒绝绝规则，或
• 排除该数据包的允允许许规则。
如果数据包被上述两种规则中的一种阻止，则这些规则（但不是仅仅记记录录规则）将生成事件。如果没有后续规则停止数据包，则仅仅记记录录规则
会生成事件。
防火墙规则如何协作
亚信安全服务器深度安全防护系统防火墙规则既有规则处理措施，又有规则优先级。这两种属性配合使用可让您创建非常有弹性且功能强
大的规则集。其他防火墙使用的规则集可能要求依照运行时应有的顺序定义规则，与此不同的是，亚信安全服务器深度安全防护系统防火
墙规则是根据规则处理措施和规则优先级的确定顺序运行的，与其定义或分配的顺序无关。
规则处理措施
每个规则可以有五种处理措施之一。
1. 放放行行：：如果数据包符合放放行行规则，则无论同一优先级级别的其他任意规则为何，数据包均可通过防火墙和入侵防御引擎。
2. 仅仅记记录录：：如果数据包符合仅仅记记录录规则，则该数据包会通过，该事件将被记录。
3. 强强制制允允许许：：如果数据包符合强强制制允允许许规则，则无论同一优先级级别的其他规则是什么，数据包均可通过。
4. 拒拒绝绝：：如果数据包符合拒拒绝绝规则，则会被丢弃。
5. 允允许许：：如果数据包符合允允许许规则，则可以通过。不符合允允许许规则之一的任何流量都会被拒绝。
实行允许规则将导致拒绝允许规则未特别覆盖的所有其他流量：
96
亚信安全服务器深度安全防护系统 9.6 管理员指南 防火墙
“拒绝”规则可以优先于“允许”规则执行，以阻止某些类型的流量：
“强制允许”规则可以应用于被拒绝的流量之上，以允许某些异常经过：
规则优先级
拒拒绝绝和强强制制允允许许类型的规则处理措施可以在 5 种优先级的任一种中加以定义，以便进一步修正允允许许规则集所定义的允许流量。规则以最高
（优先级 4）到最低（优先级 0）的优先级顺序运行。在特定的优先级级别中，规则是根据规则操作的顺序（强制允许、拒绝、允许、仅
记录）得到处理的。
优先级上下文可让用户使用拒拒绝绝/强强制制允允许许组合依次修正流量控制，以达到更大的灵活性。在同一优先级上下文中，可以使用拒拒绝绝规则否
定允允许许规则，也可以使用强强制制允允许许规则否定拒拒绝绝规则。
注意： 允允许许类型的规则处理措施只在优先级为 0 时运行，而仅仅记记录录类型的规则处理措施只在优先级为 4 时运行。
组合使用规则处理措施和规则优先级
规则以最高（优先级 4）到最低（优先级 0）的优先级顺序运行。在特定的优先级级别中，会根据规则处理措施的顺序处理规则。优先级
相同的规则处理顺序如下：
• 放行
• 仅记录
• 强制允许
• 拒绝
• 允许
注意： 请记住，允允许许类型的规则处理措施只在优先级为 0 时运行，而仅仅记记录录类型的规则处理措施只在优先级为 4 时运行。
注意： 请记住，如果强强制制允允许许规则和拒拒绝绝规则处于同一优先级，则强强制制允允许许规则比拒拒绝绝规则优先，因此将会允许符合强强制制允允许许规
则的流量。
97
亚信安全服务器深度安全防护系统 9.6 管理员指南 防火墙
状态过滤
状态配置在计算机上生效时，会在流量历史记录、TCP 和 IP 标头值正确性，以及 TCP 连接状态转换的上下文中分析数据包。在无状态协
议（例如，UDP 和 ICMP）情况下，会根据历史流量分析执行假状态机制。
注意： 在亚信安全服务器深度安全防护系统管理中心中，可通过策策略略>>通通用用对对象象>>防防火火墙墙状状态态配配置置找到保存的状态配置。它们
通过策略编辑器或计算机编辑器应用至计算机，方法为转到策策略略//计计算算机机编编辑辑器器 >> 防防火火墙墙 >> 通通用用 >> 防防火火墙墙状状态态配配置置。
如果数据包经由静态规则明确允许，将会通过状态例程。
• 通过检查连接表检查数据包是否属于现有的连接
• 检查 TCP 标头的正确性（例如，序号、标志组合）
启用后，状态引擎会应用至通过接口的所有流量。
缺省情况下，UDP 假状态检查会拒绝任意传入的“未经请求的”UDP 数据包。如果计算机运行的是 UDP 服务器，则策略中必须包含强强制制允允
许许规则，以允许访问该服务。例如，如果在 DNS 服务器上启用了 UDP 状态检查，则必须有允许 UDP 流量通往端口 53 的强强制制允允许许规则。
缺省情况下，ICMP 假状态检查会拒绝任何未经请求的传入 ICMP 的请求回复和错误类型数据包。若要允许未经请求的 ICMP 数据包，必须
明确定义强强制制允允许许。除非使用静态规则明确允许，否则会丢弃其他所有 ICMP（非请求回复或错误类型）数据包。
将所有内容汇总设计防火墙策略
一般而言，定义计算机的防火墙策略有两种方法：
• 禁禁止止：：禁止一切未明确允许的流量。可以通过使用允允许许规则描述允许的流量，使用拒拒绝绝规则进一步限制允许的流量，将两种方
法相结合以创建禁止策略。
• 允允许许：：允许一切未明确禁止的流量。可单独使用拒拒绝绝规则描述应丢弃的流量，以创建允许策略。
一般而言，应优先使用禁止策略，而尽量避免使用允许策略。
强强制制允允许许规则应只与允允许许规则和拒拒绝绝规则结合使用，以允许由允允许许规则和拒拒绝绝规则所禁止的流量子集。当启用 ICMP 和 UDP 状态时，还需
要强强制制允允许许规则以允许未经请求的 ICMP 和 UDP 流量。
示例
以下是如何为 Web 服务器创建简单防火墙策略的示例。
1. 首先使用已启用 TCP、UDP 和 ICMP 选项的全局防火墙状态配置启用这些选项的状态检查。
2. 添加防火墙规则以允许回复来自工作站的请求的 TCP 和 UDP 数据包。为实现此目的，创建传入允允许许规则，将协议设置为 "TCP
+ UDP"，并选择特特定定标标志志下的非非复选框和 SSyynn 复选框。此时，该策略只允许回复由工作站上的用户启动的请求的 TCP 和 UDP
数据包。例如，结合步骤 1 中已启用的状态分析选项，此规则允许此计算机上的用户执行 DNS 查询（通过 UDP）以及通过
HTTP (TCP) 浏览 Web。
3. 添加防火墙规则以允许回复来自工作站的请求的 ICMP 数据包。为实现此目的，创建传入允允许许规则，并将协议设置为 "ICMP"，
并选择任任何何标标志志复选框。这意味着此计算机上的用户可以 ping 其他的工作站并收到回复，但是其他用户将无法 ping 此计算
机。
4. 添加防火墙规则，选中特特定定标标志志部分下的 SSyynn 复选框，以允许通往端口 80 和 443 的传入 TCP 流量。这意味着外部用户可以