…
ICCID 
89490240001381900000
CVH1 
3 tries left (10 to unblock)
CVH2 
3 tries left (10 to unblock)
number of CHV/UNBLOCK CHV/ADM 
4
CHV1/PIN is disabled
IMSI 
262011910185216
Kc [seq.] 
3E104356638C70D0 [2]
PLMN selector (user priority) 
- 222 03
- 222 06
- 222 10
- 211 30
forbidden PLMN 
- 266 02
- 222 01
- 266 07
- 266 03
user controlled PLMN 
operator controlled PLMN 
- 222 03
- 000 22
phase 
2 and PROFILE DOWNLOAD required
SIM service table 
  - 1 CHV1 disable function 
allocated, activated
  - 2 Abbreviated Dialling Numbers (ADN) 
allocated, activated
  - 3 Fixed Dialling Numbers (FDN) 
allocated, activated
  - 4 Short Message Storage (SMS) 
allocated, activated
  - 5 Advice of Charge (AoC) 
not allocated, not activated
  - 6 Capability Configuration Parameters (CCP) 
not allocated, not activated
  - 7 PLMN selector 
allocated, activated
  - 8 RFU 
not allocated, not activated
  - 9 MSISDN 
allocated, activated
  - 10 Extension1 
not allocated, not activated
  - 11 Extension2 
not allocated, not activated
  - 12 SMS Parameters 
allocated, activated
  - 13 Last Number Dialled (LND) 
allocated, activated
  - 14 Cell Broadcast Message Identifier 
not allocated, not activated
15
  - 15 Group Identifier Level 1 
allocated, activated
  - 16 Group Identifier Level 2 
allocated, activated
  - 17 Service Provider Name 
allocated, activated
  - 18 Service Dialling Numbers (SDN) 
not allocated, not activated
  - 19 Extension3 
not allocated, not activated
  - 20 RFU 
not allocated, not activated
  - 21 VGCS Group Identifier List (EFVGCS and 
EFVGCSS) 
not allocated, not activated
  - 22 VBS Group Identifier List (EFVBS and 
EFVBSS) 
not allocated, not activated
  - 23 enhanced Multi-Level Precedence and 
Pre-emption Service 
not allocated, not activated
  - 24 Automatic Answer for eMLPP 
not allocated, not activated
  - 25 Data download via SMS-CB 
not allocated, not activated
  - 26 Data download via SMS-PP 
allocated, activated
  - 27 Menu selection 
allocated, activated
  - 28 Call control 
not allocated, not activated
  - 29 Proactive SIM 
allocated, activated
administration data
  MS operation mode 
normal operation
  OFM (Operational Feature Monitor) 
enabled
  length of MNC in the IMSI 
2
Table 4 – Result of file reading on SIM where Data download via SMS-PP is present
The type of message sent is addressed directly to the SIM, by setting the PID to 0x7F, 
corresponding to USIM Data Download, as you will see below. Also the DCS has to be a 
class 2 message type. According to GSM 11.14 here is what happens when these are set10:
If the service "data download via SMS Point-to-point" is allocated and activated in the 
SIM Service Table, then the ME shall follow the procedure below:
- When the ME receives a Short Message with protocol identifier = SIM data download, 
and data coding scheme = class 2 message, then the ME shall pass the message 
transparently to the SIM using the ENVELOPE (SMS-PP DOWNLOAD) command.
- The ME shall not display the message, or alert the user of a short message waiting.
In other words, the phone will not display anything and the user will not be aware of this 
attack.
Let’s have a look at the secure command SMS header. One of its components is the 
Security Parameter Indicator (SPI). SPI is 2 octets long and it has the following structure:
10 ETSI GSM 11.14, December 1996, Version 5.2.0, page 33
16
Figure 10 – Coding of the first SPI octet 11
Figure 11 – Coding of the second SPI octet 12
The vulnerability is possible due to the second byte: here you can set how the proof of 
receipt (PoR) to be sent – via SMS-DELIVER-REPORT or SMS-SUBMIT. When is set to be 
on SMS-SUBMIT the phone will try to send back a reply to the originated sender. 
If we set it to acknowledge the receipt via DELIVER REPORT, the phone will report to 
the network the status of the message. Since we don’t have valid entries for the KIc, KID, 
11 ETSI TS 101 181 V8.9.0 (2005-06), page 13
12 ETSI TS 101 181 V8.9.0 (2005-06), page 13
17
TAR, the result of the STK command is an error so the report will be an error. The sending 
SMSC then thinks that the phone hasn’t received the message and it will try again to send the 
message, putting on hold any other future messages that are supposed to be delivered, until 
the initial message expires.
Below you will find a list of images taken from Wireshark indicating how the phone 
behaves when the special crafted message with PoR set to SMS-SUBMIT is sent.
Figure 12 – Capture from Wireshark showing the receipt of the STK message
First, the message is received from the network
18
Figure 13 - Capture from Wireshark showing the receipt of the STK message
As you can see, the PID is set to “SIM Data download”, DCS to “SIM specific message”
class 2 and the Information Element has the STK headers. 
19
Figure 14 - Capture from Wireshark showing GSM SIM packet
Next the SIM prepares to send a reply message – GSM ENVELOPE packet – and sends 
it to the network.
Figure 15 - Capture from Wireshark showing the automated SMS-SUBMIT
Again, note the SIM Toolkit Security Headers.
20
Figure 16 - Capture from Wireshark showing GSM SIM packet with STK reply
The most important proof: the SMS was sent automatically due to a SIM Toolkit 
operation and not due to a human intervention.
SIM Application Toolkit provides Value Added Services for the mobile operators. 
Basically is a set of commands written on the SIM card which helps the card to communicate 
with the mobile device, making it possible to initiate commands independently of the network 
or handset. 
Figure 17 – Communication between the phone and the SIM 13
Starting with the future phones, all of them are able to communicate via SIM Toolkit. 
13 http://www.gemalto.com/techno/stk/
21
Figure 18 – Communication between the phone and the SIM 14
One of the best examples of the STK usage is the extra-menu that you see on your 
phone, from which you can find details about weather, recharge account, your bank account 
details, etc. 
14 http://www.gemalto.com/techno/stk/
22
Figure 19 - Capture from Wireshark showing report error
In the above capture you can see what happens when the messages comes with the SPI 
byte having the POR set to DELIVER REPORT. First the phone receives the message 
(Network to MS) and reports to the network that there was an issue (CP-DATA (RP) RP-
ERROR). Further the network believes that the phone was not able to properly receive the 
message and it will try over and over to send it, until it has expired.
5
Resultsandimpact
As stated before, by sending this crafted STK message we can make the phone send 
automatically a reply to the originated sender. Another behavior is that the phone will not be 
able to receive any messages until the malformed one expires.
I first discovered the vulnerability somewhere in June 2010 and worked on better 
understanding it. Meanwhile on August 26 2010 I have reported the vulnerability to CERT 
(Computer Emergency Response Team) and they have assigned a CVE but it was not 
published yet. Details about this will be published on http://www.cve.mitre.org/cgi-
bin/cvename.cgi?name=2010-3612. At the time of this writing I am still waiting for a reply 
from CERT regarding the date they will disclose it.
An important thing to note is that the issue only works for the SIM cards that have SIM 
Application Toolkit (STK) / USIM Application Toolkit (USAT) implemented. Now more and 
23
more operators have these kinds of cards due to the continuous development of the mobile 
banking, so it won’t be so hard for an attacker to succeed. However, even with this 
limitation, the attack works no matter the phone you use or the mobile network – GSM 
/ UMTS. Tests have been made on different feature phones and smartphone and they all 
succeeded.
Another thing that should be taken into consideration is that the type of message is 
addressed directly to the SIM. This means that the operator should allow the users to send 
this type of SMS, which normally only the mobile operator would send. In practice not many 
networks firewall the SMS, making it the perfect environment for an attacker since the SMS 
is always on. However, even if the operator would filter such messages, it would be possible 
to send the SMS if you have access to a SMSC. This brings us to a developed method of 
attack.
When sending the message between different networks or the same network it doesn’t 
have such a great financial impact. First of all, if you send the message to someone registered 
to the same operator as yours, most probably that person won’t be charged extra due to the 
billing plan which most of the time offers you some messages within the network. If you send 
to someone registered on a different network, even internationally, it will cost you too much. 
The question is how can we create a considerable financial impact? The answer is to use a 
SMSC provider. 
There are plenty such providers over the Internet to which you can connect in different 
ways: by email, HTTP, SMPP. The issue is that not all forward correctly the APDU packets 
to all or some mobile operators. During my research, after contacting about 10 different 
providers I found two that correctly forwarded the messages to the destination networks 
tested. It will take you some time, but in the end you’ll find for sure one that works. Most of 
these providers allow you to change the sender number (address) to either numeric or 
alphanumeric and they have really good rates for SMS – somewhere in the low euro cent area 
– and even cheaper than the rates you have on your own operator.
24
Figure 20 – Capture from NowSMS showing the options from SMPP connection
Given all these, now we can send a spoofed binary message coming from Thailand. 
Since the command message sends the reply to the originated number, it will send the reply 
in Thailand, thus paying much more and making the user get a pretty expensive bill. Even so, 
the attacker won’t gain any money. To overcome this, the attacker can easily get a premium 
rate number which will charge 10 EUR per message received. All that is left to do is to spoof 
the sender with the premium rate number he got. Now for only one message sent – which is a 
few cents – he gains 10 times more. This has a great impact on the users and it’s not much 
they can do.
How to protect from such attacks? There are a few ways:
 Mobile operators could filter command messages that are not coming from 
themselves. Even if it’s a network protection, users not being protected if not all of 
the operators implement such security or in case someone comes with their own built 
network like OpenBTS / OpenBSC, I still consider it would be the best protection 
especially if we think about the premium rate numbers attack.
 Some mobile devices have the option to ask the user about SIM actions. If the 
option is set, when the phone will try to send the message it will ask to allow this. See 
some images about this configuration and how the phone behaves.
 Use a SIM card that has the service "data download via SMS Point-to-point"
deactivated or one that doesn’t have any Toolkit Application on it.
25
 Use a Nokia DCT3 phone and stay always connected with the F-BUS cable 
and Wireshark opened (hard to make it always).
However it’s hard to answer such an ambiguous question as we don’t have any 
information about the type of message, the content, the destination. Also some SIM cards are 
configured to automatically send a message to the network operator in order to receive 
settings for MMS and Internet access when they are put in a new device. Most probably the 
users will allow the phone to send the message.
26
References
ETSI TS 100 901 V7.5.0 (2001-12), page 13
ETSI TS 100 901 V7.5.0 (2001-12), page 38
ETSI GSM 11.14, December 1996, Version 5.2.0, page 33
ETSI TS 100 901 V7.5.0 (2001-12), page 42
ETSI TS 101 181 V8.9.0 (2005-06), page 13
ETSI TS 101 181 V8.9.0 (2005-06), page 13
http://adywicaksono.wordpress.com/2008/05/21/
http://bb.osmocom.org/trac/wiki/dct3-gsmtap
http://berlin.ccc.de/~tobias/cos/s60-curse-of-silence-
advisory.txt
http://en.wikipedia.org/wiki/SMS
http://www.gemalto.com/techno/stk/
http://www.mseclab.com
http://www.nobbi.com/pduspy.html
https://gsm.tsaitgaist.info/doku.php?id=siminfo