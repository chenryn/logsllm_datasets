/var/lib/rizhiyi_manager_server/server/downloads/-f
6. 重启managerserver
7. 观察manageragent的/opt/rizhiyi/parcel-cache目录，出现文件，就表示已经开始恢复，
重新下载文件
8. 等待下载完成，数据恢复，就可以正确升级
更新日志易安装包
选择顶部菜单->版本管理->日志易版本，进入版本管理页面，点击导入新版本。
目前支持两种导入方式：
1、使用服务器上文件
在弹出页面中选择使用服务器上文件，然后输入要导入的安装包文件的路径（需提前将安装
包拷贝到Manager所在的服务器上，并且确保rizhiyi用户可以访问该文件），点击提交即
可开始导入。
9-322
日志学院
2、页面上传
在弹出页面中选择上传文件，然后选择本机文件，等待页面处理完成后，点击上传即开始上
传，上传完成后。点击提交即可开始导入。
页面上传的一些补充说明
 目前不支持断点续传，所以可以的话，大文件用别的工具上传到服务器会比较稳妥一些。
 上传前会计算文件md5，如果文件较大时会要处理很长时间才能点击上传按钮，请耐
心等待。
 上传完成后，文件会存放到 /var/lib/rizhiyi_manager_server/server/tmp/下，保存24小
时后再删除，遇上这个分区过小导致无法上传时，请清理空间，或者将这个目录改成软
链，指向空间足够的地方。
 利用上传功能，可以在某些限制很多的客户环境上通过manager 页面向服务器上传输
任意文件（上传完成后不提交，文件不会马上删除，可以在上面的tmp目录找到。）
 目前支持导入的包有两种 parcels/tar.gz，前者为完整发布包，包含多个模块信息，导
入后会有完整的版本号。后者为单个模块补丁包，导入完成后会显示为xxxx.patchxx。
9-323
日志学院
 只想升级parcels中某个特定模块的补丁的话，可以用 tarzxfYDP-xxxxx.parcels 命令，
解压后获得的xxxx.tar.gz就是对应各个模块的单独的补丁包。
 导入补丁时，可以选择是打在激活版本上，还是最新版本上，导入多个补丁时，可以每
次都选择打在最新版本上，导入全部补丁后再一次性激活。
 导入完成后会提示导入结果（成功/失败，失败时会提示原因）。
 导入成功的版本会显示在版本管理页面的版本列表中，供进一步操作。Agent会自动下
载导入成功的安装包，无需人工干预。
 同一个版本的安装包无法重复导入，第二次导入时会提示错误。
更新日志易后台版本
在版本管理页面上，可以查看到所有导入成功的后台安装包版本。
当所有Agent完成安装包下载之后，对应的版本下载状态就会变成下载完成，就可以通过点
击”激活”按钮来进行激活。已经是激活状态的版本无法再次激活。
在agent下载完成之前，版本是无法激活的。如果集群中有机器异常失联，那么会始终无法
激活，需要定位并解决了问题才可以激活。机器都正常，但是长时间始终未能下载完成的话，
可以查看下载状态的详情，登录对应的机器检查是否存在下载的异常。
点击激活，就可以切换日志易的系统到指定版本。
点击激活后，会弹出以下页面，提示激活版本和当前版本的差异：
9-324
日志学院
如果有些模块的配置模板发生了改变，这个页面会提示你去确认模板的变化，可以点击”修
改模板”进入模板对比页面，就可以看到当前的模板和激活后使用的新模板，然后手工进行
处理，一般来说，如果之前有手工定制的部分，都应当考虑合并到新的模板中，如果单纯是
新模板增加了内容，那么什么都不改，最终简单覆盖就可以。确认全部模板都调整ok之后，
点击下一步。
这时会弹出以下窗口，提示选择激活方式（推荐使用自动模式，手工模式仅在特定情况下使
用），另外也需要选择是否备份数据库的数据（一般情况下推荐备份，部分环境db超大，
导致后续激活超时失败的话，可以在这里选择不备份）
选择后自动跳转到升级执行页面，显示升级进度。
如果有正在执行的升级/进程启停重启操作，将无法进行升级操作。
激活时，会自动重启所有版本发生了变化的模块，并执行可能有的升级脚本/DB操作，失败
时会在页面上有相关提示。
升级完成后，所有Agent运行的模块都会更新到指定的版本。如果模块在升级前后使用的版
本完全不变，将会跳过不做任何更新。
9-325
日志学院
激活过程建议要等到激活完成后再进行其他操作，避免激活发生错误时不能及时发现。
更新日志易后台 license
选择顶部菜单->版本管理->license管理，进入license管理页面，点击导入license。然后可
以选择页面上传或者使用服务器上文件，将license文件导入到系统。
导入完成后，所有Agent会自动下载并安装新的license文件。
另外在该页面，还可以查看集群的license信息，以及所有license文件的下载状态。
更新 Agent 的版本
选择顶部菜单->版本管理->Manager版本，进入版本管理页面，点击导入Agent新版本。
然后可以选择页面上传或者使用服务器上文件，将Agent版本导入到系统。
9-326
日志学院
导入完成后，点击全量/批量升级按钮，输入服务器的密码，即可对服务器上的Agent进行
升级。
更新 server 的版本
选择顶部菜单->版本管理->Manager版本，进入版本管理页面，点击升级ManagerServer。
然后可以选择页面上传或者使用服务器上文件，将ManagerServer安装包导入系统。
导入完成后，ManagerServer会自动完成安装过程，并重启ManagerServer。重新登录后，
即可检查新版本的ManagerServer是否安装成功。
9.4. 模块管理功能
添加/删除 Agent 服务器上运行的服务
选择顶部菜单->服务项，进入服务概览页面，从左树中选取想要添加的服务，进入服务管
理视图。
点击”添加实例”，在弹出的服务器列表中选择想使用的服务器：
9-327
日志学院
点击”下一步”，可以查看到添加模块后使用的配置文件和收到这个修改影响的其他模块的配
置文件，直接点击”下一步”，即可完成添加。完成添加后，添加的服务实例就可以在对应的
服务管理视图上查看到。
（……中间省略若干行……）
添加的服务实例只有处于停止状态，才可以在服务管理视图上进行删除。要删除某个进程前，
需要先从服务管理视图上对进程进行停止操作。
添加/删除服务也可以在主机视图上进行操作，但是不如在服务视图方便，因此不推荐使用。
9-328
日志学院
启动/停止/重启服务
选择顶部菜单->服务项，进入服务概览页面，从左树中选取想要添加的服务，进入服务管
理视图。
如果想要”启动/停止/重启”一个服务的全部实例，可以点击”全部启动/停止/重启”按钮来进行
操作。
只想操作其中的特定实例，也可以勾选这些实例后，点击”选择操作”按钮进行操作。
点击操作后，会跳转到执行操作页面，显示执行的结果。
查看服务配置及日志文件
选择顶部菜单->服务项，进入服务概览页面，从左树中选取想要添加的服务，进入服务管
理视图模板。
每个服务的右侧都有配置/日志文件的链接，点击即可进行查看。
另外点击”历史配置”也可以查看配置文件的历史版本，并可以与其他版本进行对比，确认配
置文件的修改内容。
9-329
日志学院
修改服务配置及模板文件
选择顶部菜单->服务项，进入服务概览页面，从左树中选取想要操作的服务，进入服务管
理视图。
点击上面的”配置/模板”即可进行修改。
一般来说，只需要修改配置项的值，配置模板一般请在有技术支持的情况下进行修改。
修改完成后，点击“下一步”即可预览修改后的结果。继续“下一步”即可完成修改。
修改后的配置无法立刻更新到运行中的服务实例，需要重启才可真正把修改后的配置推送到
对应的服务实例上。
这时点击任意服务的管理页面，都可以看到提示有配置修改后，模块未进行重启。模块未重
启则新配置无法生效。
点击“点击重启”链接，确认需要重启的实例后，即可跳转到操作页面，对需要重启的进程进
行操作。
另外在配置模板页面，可以查看历史上使用过的模板信息，便于修改错误时回滚，或者是发
生异常时检查配置错误。
修改模块配置参数
选择顶部菜单->服务项，进入服务概览页面，从左树中选取想要操作的服务，进入模块的
服务管理视图，点击“配置”可进入配置参数修改界面。
9-330
日志学院
使用Command+F（Windows使用Ctrl+F）调用浏览器搜索框，搜索关键字定位参数，修改
参数即可。
参数修改完毕后，滑动页面到页面最底部，点击“更新”即可保存参数配置。重启模块后参数
生效。
9.5. 监控功能
系统整体运行情况
选择顶部菜单->首页项，即可查看系统整体运行情况。
9-331
日志学院
左边是所有服务的状态，可以查看目前处于异常状态的服务，以及最近的告警数。点击对应
的链接可以跳转到对应的页面，方便查看。
右边是系统整体性能视图，展示系统最近48小时的处理总量和处理性能曲线，展示系统的
处理状态。下方还提供系统流程图，显示各个模块间的处理状态/处理速率，在出现异常堆
积，处理效率低于阈值时变红，提示系统出现了异常。
业务模块查看
选择顶部菜->服务项，进入服务概览页面，在左树中选择想要查看的服务。
在概览页面可以看到目前服务部署在哪些主机上，当前进程的运行状态。并可以根据需要做
启停操作/查看配置文件/日志文件。
选择配置/模板，可以修改这个服务的配置/模板，具体说明在”模块管理”功能中有说明，这
里不再说明。
选择告警，可以查看业务模块最近产生的告警详情，用于分析系统的异常。
9-332
日志学院
选择性能，可以查看该项服务的性能指标，这里看到的指标是所有部署了服务的主机的性能
指标统计，反应的是整个业务的运行状况。也可以选择查看单机指标，比较集群中每台服务
器的指标的差异。
每个业务模块的指标中都会定义一部分指标为重点指标，在下拉列表中选择重要性能指标可
以一次性查看全部重点指标的曲线图，便于运维人员查看。点击编辑按钮就可以指定重点指
标包含哪些指标，对性能页面进行定制化。
点击”网络质量”，可以查询服务所在服务器的网络质量，Managerserver会定期（1分钟）
ping所有服务器，获取平均延时/丢包性能数据。(Manager所在机器没有质量数据，因此只
有在其他机器上部署了实例的业务才能看得到数据。单机系统无法看到任何质量数据）
Agent 服务器查看
选择顶部菜单->主机项，进入主机概览页面，在左树中选择想要查看的主机。
9-333
日志学院
在概览页面可以看到主机最近的告警数/CPU负载/硬盘/MEM情况，以及CPU/流量/IO等关
键服务器性能指标的曲线图。曲线图默认显示最近48小时的数据，有需要的话也可以调节
起止时间进行查询。
点击”服务”，可以查看主机上目前配置的服务实例，并进行启停操作，查看对应的配置/日
志文件。也可以添加新的服务实例。
选择性能，可以查看主机的各项性能指标。
这些性能指标是按模块进行分类的，可以在下拉列表中选择对应的业务模块进行查看。
每个业务模块都有多项指标，可以根据名称在下拉列表中进行选取，点击查询查看。
点击网络质量，可以查询服务器的网络质量，ManagerServer会定期（1分钟）ping所有服
务器，获取平均延时/丢包性能数据（ping自身毫无意义，所以ManagerServer本身的网络
质量是没有数据的）。
9-334
日志学院
选择告警，可以查询服务器历史上的告警，检查服务器最近发生的异常。
另外Manager现在也集成了web-ssh页面，用户可以在主机列表页面，点击终端按钮，通
过ssh登录对应主机。这个功能主要是为了方便用户在特定的访问受限环境，通过web页
面来访问后台服务器。
9.6. 性能管理
Manager会采集所有模块的性能指标，并支持在页面上进行展示。
Managerserver上安装了一个开源组件Influxdb，用于保存性能数据。
Agent 上报机制
ManagerAgent启动时，会从心跳包中获取中央的Influxdb地址，并记录下来，用于后面
上报数据。
ManagerAgent启动时，会启动一个系统性能采集线程，采集系统的CPU/硬盘/流量等基础
性能指标，一分钟采集一次，采集之后直接将性能指标加入到发送队列，只要Agent还在运
行，这个线程就会一直工作，不会停止。
ManagerAgent上每启动一个进程时，都会启动一个性能采集线程，负责采集这个进程的性
能指标，一分钟采集一次，采集之后直接将性能指标加入到发送队列。进程停止时，这个线
程将会被停止，不再进行采集。
ManagerAgent启动时会开启一个性能上报线程，会轮询发送队列，发现有数据时就会主动
写入到influxdb中。写入时是批量写入，每次写入最多100条。
9-335
日志学院
性能指标
性能指标目前一般是按照“性能指标名 +ip+key+ 性能指标值”的方式来进行保存的。其
中key一般是用来在一个性能指标拥有多份不同数据（例如硬盘占用率有多个硬盘分区，
kafka偏移量有多个partition）时进行区分用的。很多不存在这种需求的指标，key都是空。
在系统上查看性能数据时，如果是单机视图，只能查看到最细粒度的性能数据，每个key
都会有一个图。
在查看模块数据时，就有两个选择：
1. 单机服务性能，这个和单机看到的是一样的，都是最细粒度的数据。
2. 整体服务性能，这个看到的是所有数据的叠加值。
目前ManagerServer也有承担一部分采集任务，会定期采集系统的网络质量数据/url调用
数据，保存到Influxdb中。
Influxdb
Influxdb虽然部署在ManagerServer上，但是Server只读不写，所有性能数据直接由Agent