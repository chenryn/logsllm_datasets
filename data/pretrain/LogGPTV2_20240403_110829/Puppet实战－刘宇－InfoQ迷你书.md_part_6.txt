 ArchLinux
1.8.1/6
1.9.0/1/2
1.9.3
1.8.7
1.8.5*
Ruby version
不支持
不支持
不支持
支持
支持
Puppet 2.6
 表 2-1  Puppet 与 Ruby 版本对应关系 
不支持
不支持
不支持
支持
Puppet 2.7
支持
第2章Puppet安装与配置·19
不支持
不支持
支持
支持
不支持
Puppet 3.0
---
## Page 31
20第一部分准备篇
便，本书统称 Puppet 3.xx 和 Puppet 3.0.x 为 Puppet 3。
说明
catalog 时效率更高。对于首次接触 Puppet 的读者来说，推荐使用 Puppet 3。如果之前一直在
版本是 3.0.x。Puppet 3 并不完全兼容 2.x 以下的低版本，而且比 Puppet 2.x性能更好，在编译
源即可完成所有包的安装。安装的时候会自动安装 Ruby 相关依赖及其相关组件。
2.4在 Linux 下安装
升级可参考2.8节。
提示
上通过包管理器、源码及 Gems 工具来进行安装与使用。在编写本书的时候，Puppet 的最新
提示
常容易。
第1章的学习，我们掌握了Puppet 的原理，再结合以上8步，我们再安装 Puppet将变得非
或直接运行 puppet agent --test --server server.domain.com 与 Master 交互完成签名认证。
通过命令 puppet master --no-daemonize --verbose 可以查看到相关日志与输出。
5）在客户端配置文件 Puppet.conf 中指定 Server 端，在终端运行 puppet agent -test 命令
Puppet 3 的新特征参考 1.1.3节。升级 Puppet 时需要保持 Master 版本高于 Agent 版本,
Puppet 3 为 Puppet 3.x.x 版本的简写。Puppet 2 为 Puppet 2.x.x 版本的简写。为了阅读方
在Linux 下安装 Puppet 是非常容易的事，特别是在Centos 操作系统下，直接配置官方
Facter（或者称为 fact）用于收集关于主机的信息，来帮助定制 Puppet 配置。
接下来我们学习 Puppet 在各操作系统平台下的安装及配置方法。
接下来本节主要讲解 Puppet 在 RHEL、Centos、Ubuntu&Debian、Fedora、Windows 系统
4）Solaris 使用 Blastwave 命令进行安装。
3）对于 SUSE，在 http://software.opensuse.org/122/en 处可以搜索到软件包。
2）Gentoo使用 Portage 命令进行安装。
对于各平台系统，建议使用官方包管理方式对 Puppet 进行安装：
1）FreeBSD、OpenBSD 可以使用 ports 命令进行安装。
8）客户端再次运行配置（puppet agent --test）。
7）检查语法是否正确（通常采用 puppet parser validate test.pp 命令进行语法检查）。
6）在 Server上配置节点信息，告诉客户端要做什么。
---
## Page 32
作系统。
release-6-6.noarch.rpm 
择 puppetlabs-release-6-6 软件包。配置方法如下：
安装或升级 Ruby一次，或者直接采用官方Puppet 源进行安装。
CentOS 5 的 Ruby 1.8.7的 RPM 包，并且不再支持 1.8.5。所以建议在安装官方 Puppet 源后再
提示
进行安装：
载和安装。
进行安装，
中的 Shell 前端软件包管理器。基于 RPM 包管理，能够从指定的服务器自动下载 RPM 包并
读者采用Linux 发行版的包管理器进行安装。
安装的包也是最新版本的3.0，如果需要安装较早的版本，就需要在安装时指定。笔者推荐
直接安装。注意选择自己系统版本的 Yum 源。
2.4.1
Yum 源的官方地址为 http://yum.puppetlabs.com。Yum 支持 RedHat、CentOS、Fedora 操
 $sudo rpm -Uvh http://yum.puppetlabs.com/el/6Server/products/x86 64/puppetlabs-
Yum（全称为 Yellow dog Updater, Modified）是一个在 Fedora、RedHat、SUSE 及 CentOS
$ sudo yum clean all
1）根据操作系统版本配置 Yum 源，我们这边使用的操作系统为 Centos 6 x64，因此选
#如果系统默认 Yum 源里没有 Ruby 及相关软件包，
$ sudo yum -y install ruby ruby-libs ruby-shadow
在安装之前需要确认自己的 Ruby 版本。如果系统并没有安装 Ruby，可以采用如下方法
（1）在 RHEL 5 和 RHEL 6、Centos 5 和 Centos 6 上安装 Puppet 
 用Linux 发行版的包管理器来安装 Puppet 最为简单，而且会自动处理好所有依赖。这里
ruby 1.8.7
$ruby-V
运行如下命令来检查 Ruby 的安装：
下面介绍具体的安装过程。
包管理器方式安装
，可以自动处理依赖性关系，并且一次安装所有依赖的软件包，无须繁琐地多次下
可
以配置 EPEL 源进行安装
第2章Puppet 安装与配置·21
---
## Page 33
22第一部分准备篇
软件仓库中搜索、安装、升级、卸载软件或操作系统。目前主要应用于Debian和Ubuntu。
提示
写V)。
release-17-6.noarch.rpm
介绍。下面介绍具体的安装步骤。
采用 Yum 安装。注意选择自己系统版本的 Yum 软件包进行配置。这里以 Fedora 16 为例进行
Puppet 在 Fedora 15 和 Fedora 16 上的安装方法。
Facter):
 apt-get 是一条Linux 命令，适用于 deb 包管理式的操作系统，主要用于自动从互联网的
注意先安装 Ruby。我们也可以从 PuppetLabs 源（http://apt.puppetlabs.com/）来配置和安
在 Debian 和 Ubuntu 上安装 Puppet 的方法也非常简单，只需要配置好仓库就可以了。
（3）在 Debian 和 Ubuntu 上安装 Puppet 
安装完成后检查安装状态，具体命令与前面的一样（采用-v查看，注意 puppet 后是大
2）在服务器端安装，安装方法如下：
$ sudo yum clean all 
 $ sudo rpm -Uvh http://yum.puppetlabs.com/fedora/f17/products/x86 64/puppetlabs-
1）配置 Yum 源，配置方法如下:
在 Fedora 上安装 Puppet 也非常简单，
（2）在Fedora 上安装 Puppet 
到此在Linux 系统下的 Puppet 安装就完成了，配置方法将在 2.7节讲解。接下来我们看
3）在客户端安装 Puppet。同理运行如下代码会自动匹配安装相关依赖包（包括Facter):
2）在服务器端安装Puppet。运行如下代码会自动匹配安装 Facter 等相关依赖包（包括
$sudo yum install puppet
3）在客户端安装，安装方法如下：
$sudo yum install puppet-server
ssudo yum install puppet
2.0.0-rc4
$ puppet -V
运行如下命令来检查 Puppet 的安装:
$sudo yum install puppet-server
章图书
---
## Page 34
件包，建议选择 Ruby 1.8.7版本。
关系。我们首先到 Ruby 的下载页面（http://www.ruby-lang.org/en/downloads/）选择 Ruby软
这里以 Centos 6 安装为例进行讲解。
通常我们需要到相关软件下载页面下载对应平台的版本源代码文件，并逐步进行编译安装。
2.4.2
puppetlabs.com/ lucid main"
装Ruby。
相比以 Yum 方式安装 Puppet，源代码安装显得较为复杂，需要按照相关依赖逐步进行。
下载ruby-1.8.7-p370.tar.gz 软件包，进入相应目录，进行编译安装，安装方法如下：
（1）安装Ruby
此方法同样适用于如下操作系统：Scientific Linux 5 和 6、Ascendos 5 和 6。
$ sudo ruby install.rb
$ wget http://downloads.puppetlabs.com/facter/facter-1.6.13.tar.gz
下载最新版本的 facter-1.6.13.tar.gz 软件包进行安装，安装方法如下:
$ sudo apt-get install puppet
3）在客户端安装，安装方法如下：
2）在服务器端安装，安装方法如下：
1）配置 puppetlabs 仓库，配置方法如下：
（2）安装Facter
$sudomakeinstall
S
$m
$ sudo apt-get install puppetmaster
$ sudo apt-get update
cd facter-1.6.13
tar -zxf facter-1.6.13.tgz
./configure && make
cd ruby-1.8.7-p370
tar zxvf ruby-1.8.7-p370.tar.gz
wget ftp://ftp.ruby-lang.org/pub/ruby/1.8/ruby-1.8.7-p370.tar.gz
mkdir /opt/puppetlabs
从源代码进行安装
，当然都采用源代码安装也没有
第2章Puppet安装与配置·23
---
## Page 35
24第一部分准备篇
自己所需要的版本进行安装。本例将选择3.0.1版本进行安装，命令如下：
提示
常方便。注意先安装好 Ruby。
pull 命令即可更新至最新版。也可以选择任意版本进行安装。缺点是打包批量部署时不是非
版本的信息。这样在下载不同版本的 Puppet 时采用的是增量的方法，每个版本直接采用 git
2.4.3
1）获取版本库到本地，命令如下：B00
如果在本地克隆了一个 Git 项目的版本库，就可以通过版本库的方式获取 Puppet 的最新
3）我们可以通过 git tag 命令查看 Git 中的 tag（即标签），
2）安装Facter，命令如下:
如果系统没有安装 Git 可以通过 yum install git 命令进行安装。
3.0.0
2.7.9
$ git tag
$ sudo ruby install.rb
$ sudo cd facter 
S
$ sudo mkdir -p /usr/src
1.6.13
$ ruby -v
运行如下命令来检查 Ruby 及 Puppet 的安装：
$ sudo ruby install.rb --destdir=/opt/puppet 
下载最新版本的 puppet-3.0.1.tar.gz软件包进行安装，安装方法如下 :
（3）安装 Puppet
3.0.1
ruby 1.8.7
 sudo git clone git://github.com/puppetlabs/puppet
puppet -V
默认安装在/etc/puppet 目录中，如果需要指定安装目录可以使用如下命令
cd/usr/src
facter -v
sudo
从 Git 版本库进行安装
ruby install.rb
，并通过 git checkout 命令选择
---
## Page 36
Mac 系统上工作是一件非常惬意的事。下面我们看看在 Mac 下如何安装 Puppet。
2.5.1通过二进制发布包进行安装
2.5在Mac OS ×下安装
能类似于 Linux 下的 Yum。有关细节可参考：http:/baike.baidu.com/view/663386.htm。
提示
用 gem 命令像下面这样来安装 Puppet 和 Facter了。默认安装的 Puppet 版本为 3.0。
SLES、Debian 和Ubuntu上，这个软件包的名字是RubyGems。当这个包安装好后，就能使
是先在操作系统上安装 Ruby 和相应的 RubyGems 包。在 RedHat、CentOS、Fedora、SUSE/
2.4.4通过 Gems 进行安装
一个分发Ruby 程序和库的标准格式，还提供一个管理程序包安装的工具。RubyGems 的功
Mac OS X被认为是操作系统中“高富帅”的象征，是最为人生化的操作系统之一。在
（1）下载二进制包
RubyGems（简称Gems）是一个用于对Rails 组件进行打包的Ruby打包系统。它提供
和大部分基于 Ruby 的程序一样，Puppet 和Facter 也能通过 RubyGems 进行安装，前提
$ wget http://downloads.puppetlabs.com/mac/puppet-3.0.1.dmg
http://downloads.puppetlabs.com/mac/
从官方网站可以下载编译好的 dmg二进制包并进行安装，命令如下:
$ sudo gem install puppet
2）安装 Puppet，命令如下:
$ ruby setup.rb
zh1't7'8'1-swa6Aqn1/swa6Aqnz/61o:swa6Aqna'1o·uotaonpo1d//:dzau 4abm opns s
1）安装 RubyGems，命令如下：
$ ruby install.rb
SC
4）安装 Puppet，命令如下:
HEAD is now at 1d7d7cb... Update PUPPETVERSION for 3.0.1
$ git checkout 3.0.1
3.0.1-rcl
3.0.1
cd rubygems-1.8.24
华章图书
第2章Puppet安装与配置·25
---
## Page 37
26第一部分准备篇
单介绍一下安装步骤。
2.5.2从Git版本库进行安装
例，效果如图 2-2 所示。
即可在默认安装程序目录下完成安装。两个软件安装完成后的效果一样。以 Puppet 安装为
为.pkg 的安装程序，开始安装 Facter 和 Puppet。注意，需要先安装 Facter，输入 root 密码后
在 Mac 下采用 Git 安装 Puppet 与在Linux 下的安装方法一样，这里不再详细介绍，只简
图 2-1显示了两个 pkg 文件。Puppet-3.0.1.pkg 就是 Puppet 安装程序。分别点击扩展名
Mac 的.dmg 格式软件就是一个磁盘映像，双击即可完成挂载，打开后如图 2-1所示。
.dmg 是 Mac 磁盘镜像格式的软件发布包。
（3）安装Facter 和Puppet
（2）挂载镜像文件
图 2-1在 Mac OS X下打开.dmg 格式磁盘映像
图 2-2在 Mac OS X下成功安装 Puppet
The installation was successful.
The
softwarewasinstalled.
successfully.
Go BackClose
---
## Page 38
方法是相同的。
用 Puppet，这些内容我们将在 2.6 节集中讲解，因为 Puppet 在不同操作系统下的配置与使用
持2.7.6版本。
行在线安装。
安装软件。
装其他应用程序，跟 BSD 中的 Ports 道理一样。MacPorts 就像 apt-get、yum一样，可以快速
2.5.3
在 Mac 下面除了可以用 dmg、pkg 来安装软件外，还可以利用 MacPorts 比较方便地安
至此，我们已经讲完了 Puppet 在主流 Linux下的安装方法，但并没有讲到如何去配置使
puppet @2.7.6 (sysutils)
Warning: port
$ port search puppet
2）使用 port 命令安装 Puppet。查找 ports 仓库源中 Puppet 的安装包，使用 port 命令进
#安装过程省略。双击即可完成安装
https://distfiles.macports.org/MacPorts/MacPorts-2.1.2-10.8-MountainLion.pkg
1）在 Mac OS X Lion 系统下安装 MacPorts，命令如下：
从 MacPorts 官方网址下载对应的 Mac 系统的软件包并进行安装，具体如下。
MacPorts 的官方网址：http://www.macports.org。
3.0.1
$ puppet -V
4）确认 Puppet 版本，命令如下:
$ sudo ruby install.rb
$ cd puppet 
3）安装 Puppet，命令如下：
$ sudo ruby install.rb
$ cd facter
2）安装Facter，命令如下:
$ sudo git clone git://github.com/puppetlabs/puppet
$ sudo git clone git://github.com/puppetlabs/facter
$ sudo mkdir -p /opt/puppetlabs
1）创建目录来下载版本文件，命令如下：
cd /opt/puppetlabs 
从 Ports 仓库进行安装
。如果查询到多个版本的 Puppet，必须指定版本才可以。这里安装 Puppet 时只支
 definitions are more than two weeks old, consider using selfupdate
#用于查找 ports 仓库提供安装的 Puppet 版本
第2章Puppet 安装与配置·27
---
## Page 39
28第一部分准备篇
资源：
提示
提示
的 Puppet 可以直接启动使用。
法，接下来我们将讲如何配置 Puppet，并且配置一个简单的 File 资源进行测试。默认安装好
2.6