### Explicit-Null and TTL Propagation

The use of explicit null labels is triggered by the `explicit-null` setting. Additionally, (forward) Time-to-Live (TTL) propagation is disabled. When tracing towards CE2, PE2 does not appear in the trace, making it seem as though CE2 is directly connected to PE1, as illustrated in Figure 4d. Even if an address for PE2 is discovered through other means and used as a new target, none of the techniques discussed in this paper reveal any additional information.

For Forward Return Path Length Analysis (FRPLA) and Reverse Traceroute Length Analysis (RTLA), we analyzed the TTL values of the ICMP time-exceeded messages received during the tracing process. For instance, while PE2 appears to be six hops away (as shown in Figures 2 and 4c) or three hops away (as shown in Figure 4d), the return TTL (indicated in brackets in Figure 4) consistently shows six hops when tracing towards CE2, except in the Uniform Hop Protocol (UHP) case. This discrepancy provides the shift and gap that FRPLA and RTLA can exploit.

### Validation of Measurement Techniques

To further validate our measurement techniques, we performed a cross-validation of hidden hop revelation techniques, specifically Dynamic Path Reconstruction (DPR) and Backward Recursive Path Reconstruction (BRPR), on explicit tunnels. We collected data from PlanetLab, using 23 vantage points distributed across five teams. Each team was responsible for probing 10,000 unique destinations, with no overlap between teams, resulting in a total of 269,096 traces. From these, we extracted 14,771 distinct Ingress-Egress Label Edge Router (LER) pairs, with Label Switch Routers (LSRs) explicitly revealed between the LERs. Both LERs must be within the same Autonomous System (AS), and the content of the LSRs must be fully revealed (i.e., no anonymous hops).

On these pairs, we re-ran DPR and BRPR. DPR is considered successful if, when targeting the Egress LER, the exact number of hops between the Ingress and Egress LERs is obtained. BRPR is considered successful if, at each step of the recursion, the last hop does not exhibit any MPLS labels.

Out of the 14,771 distinct Ingress-Egress LER pairs, 9,407 failed to re-discover either the Ingress or Egress. Table 3 summarizes the cross-validation results for the remaining 5,364 pairs. In 8% of cases, both DPR and BRPR failed. However, in 60% of cases, DPR and BRPR were successful. In 5% of cases, tunnels were partially revealed by DPR and partially by BRPR. Finally, in 26% of cases, the tunnel was successfully retrieved, but we could not distinguish between DPR and BRPR because the LSP contained only one LSR. The success rate for BRPR was very low (3%), suggesting that Cisco devices are configured to inject loopback addresses into Label Distribution Protocol (LDP) instead of all prefixes, especially in hybrid hardware environments (e.g., Juniper and Cisco). This result is confirmed by our survey (Section 2.3).

### Discussion

Our techniques cover most basic MPLS configurations, except for the totally invisible configuration with UHP enabled, which is not standard and deployed by only 10% of operators. The main Cisco configuration (Penultimate Hop Popping (PHP) and all prefixes enabled) is detectable with FRPLA and BRPR. The basic Juniper configuration is detectable with DPR and also causes a shift visible with FRPLA. The mixed Juniper LER and Cisco LSR configuration is specifically covered with RTLA. It is likely that other mixes with PHP as the default mode will also trigger signals. For example, with Cisco LER, at least FRPLA should work (and thus BRPR), and with Juniper LER, RTLA and DPR (and/or BRPR) should work. BRPR and DPR can be combined to track more advanced configurations with LDP filters or heterogeneous operating systems.

Unlike other techniques, FRPLA should not be used at the tunnel scale in the wild, as it may produce false positives (inferring a tunnel length due to routing asymmetry) and false negatives (shorter return path due to routing asymmetry). Instead, FRPLA should be used with multiple independent vantage points as a statistical method to infer the existence and average length of invisible tunnels at the AS scale. If the traceroute campaign produces traces entering through a sufficient number of Ingress LERs in the target AS, the routing asymmetry will likely follow a normal distribution centered around zero. In other words, FRPLA measures the sum of the return tunnel length and the IP routing asymmetry.

Generally, if MPLS is enabled with PHP (the default for basic LDP tunneling), we should see it with at least one of our techniques. UHP, designed for traffic engineering, makes RSVP-TE tunnels truly invisible. Since operators have no reason to deploy RSVP-TE without enabling LDP, our set of techniques should provide at least one MPLS signal in the vast majority of cases, provided some transit traces traverse LDP-signaled LSPs.

### Data Collection

Before deploying our measurement techniques, we identified High-Degree Nodes (HDNs) in the Caida ITDK dataset. We cleaned the dataset by removing non-publicly-routable IP addresses and pseudo-addresses allocated to non-responsive routers. After pruning, 45,021,817 IP addresses, 44,700,863 nodes, 2,705,780 links, and 43,178 ASes remained. We set the threshold for differentiating HDNs at 128 (any node with a degree ≥ 128 is tagged as an HDN) and selected areas of interest for probing. The 128-degree threshold is a reasonable balance between probe volume and data collection, considering the capabilities of common PE routers like the Cisco ASR9000 series.

We retrieved neighbors of HDNs (set A – 599,467 unique nodes) and neighbors of neighbors (set B – 983,793 unique nodes) from the Caida ITDK dataset. This allowed us to simulate transit traffic, entirely traversing the suspicious AS made of many HDNs and ending at one of its neighbors. Our destination set is the union of sets A and B, totaling 1,306,545 destination IP addresses.

Our measurement scripts used Scamper and its Paris-traceroute implementation with ICMP echo-request packets, starting at TTL = 2. Echo-request probes were also sent to all IP addresses appearing in the traces for router signature inference. For each trace, we examined the last three hops, X, Y, D (where D ∈ A ∪ B). X and Y are candidate endpoints of an invisible tunnel. A second trace with Y as the target is then launched. If this trace ends with X, H, Y, we infer that one hop, H, has been revealed from an invisible tunnel. A new trace is then launched towards H (recursive processing with BRPR) to reveal more hops. The recursion stops if no new address is revealed or if the new trace does not go through X. Note that multiple IP addresses may be revealed in a single shot, i.e., the trace towards Y ends with X, H1, H2, ..., Hn−1, Hn, Y, with n > 1 being the number of hops discovered with DPR.

Since we are looking for invisible MPLS tunnels spanning a single AS with HDNs as a trigger, our post-processing methods select only traces ending with I, E, D, where I and E are HDNs located in the same AS. For AS resolution, we used Caida node-to-AS mapping when available, otherwise, IP-to-AS mapping from Team Cymru.

Our tool was deployed on the PlanetLab testbed on 91 Vantage Points (VPs) distributed globally (USA, Canada, Europe, Japan, Russia, Brazil, China, Australia, New Zealand). The VPs were distributed equally in five groups, with attention to geographical locations. The destination set (A ∪ B) was distributed among the different VP groups. The sizes of the destination subsets were similar: 579,012 (VP set 1), 583,173 (VP set 2), 586,363 (VP set 3), 588,771 (VP set 4), and 586,229 (VP set 5). All measurements on each VP set were launched simultaneously on November 18th, 2016, with Scamper probing at a rate of 25 packets/second. The fastest VP set finished on November 29th, 2016, while the slowest finished on December 6th, 2016.

### Measurement Results

This section provides three types of analysis to demonstrate the efficiency of our contributions. First, we study and compare the efficiency of our two most powerful techniques, DPR and BRPR, for revealing internal IP hops (Section 5.1). Second, we analyze the Return & Forward Asymmetry (i.e., the difference between the return and forward path in terms of the number of hops) with FRPLA, and cross-validate it with DPR and BRPR (Section 5.2). Finally, we study the distribution of return tunnel length with RTLA, its impact on path asymmetry, and cross-validate it using DPR and BRPR (Section 5.3). We demonstrate that most invisible tunnels can be identified, either explicitly (DPR or BRPR) or implicitly (FRPLA or RTLA).

Table 4 provides information for ASes with the largest number of HDNs for which we were able to reveal the content of invisible tunnels (except AS2856). The columns labeled "HDNs" refer to the number of HDNs found in the Caida dataset ("ITDK") and those encountered in our measurement campaign ("Candidate") that can potentially act as endpoints of invisible tunnels.