# 优化后的文本

## 5.2.1 长流分析

图14展示了从GSR 12410路由器获取的测量结果。通过限制出接口队列长度，调整了路由器内存。缓冲区大小以RTT×C√n（即所需数据包数量和RAM设备大小）的倍数给出。我们从中减去了线路卡上的内部FIFO大小（详见5.2.2节）。模型预测的是利用率下限。Sim. 和 Exp. 分别表示通过ns2仿真和实际路由器测得的利用率。对于100和200个流，正如预期的那样，存在一定程度的同步现象。超过这个数目后，模型在测量精度（约±0.1%）范围内正确预测了利用率。ns2有时预测的利用率低于实际情况，我们认为这是由于仿真中比实际网络中的流之间有更多的同步现象。

这里的关键结论是，模型、仿真和实验都一致表明，路由器缓冲区的大小应约为RTT×C√n，而不是RTT×C（后者在这种情况下将是1291个数据包）。

## 5.2.2 短流分析

在第4章中，我们使用M/G/1模型预测了短时突发TCP流所需的缓冲区大小。为了验证我们的模型，我们生成了大量的短时流，并测量了GSR 12410路由器队列长度的概率分布。图15显示了结果，并与模型进行了比较，两者匹配得非常好。

## 5.3 结果范围及未来工作

本文中的结果假设每个流路径上只有一个拥塞点。我们不认为如果部分流在多个链路上经历拥塞，会对我们的结果产生很大影响，但这一点尚未进行研究。单个拥塞点意味着没有反向路径拥塞，这可能会影响TCP-缓冲区交互[28]。基于这些假设，我们的简化网络拓扑结构具有一定的普遍性。在一个任意网络中，流可能会在瓶颈链路之前或之后通过其他路由器。然而，因为我们假设只有单个拥塞点，所以在网络中的前一链路上不会发生丢包和流量整形的情况。

我们主要关注TCP，因为它是当今互联网上的主要流量类型。恒定速率的UDP源（如在线游戏）或单个数据包源（如DNS）可以通过我们的短流模型进行建模，混合流量的结果仍然成立。但是，要理解主要由非TCP数据包组成的流量，则需要进一步的研究。

我们的模型假设拥塞窗口没有上限。实际上，TCP实现的最大窗口大小可以低至6个数据包[29]。超过64kByte的窗口大小需要使用缩放选项[30]，而这很少被使用。我们的结果仍然成立，因为有限窗口大小的流需要更小的路由器缓冲区[1]。

我们还运行了一些使用随机早期检测（RED）[12]的仿真，这对少量流的同步现象有一定影响。大量（>500）不同RTT的流聚合不会同步，RED对缓冲区需求的影响较小或无影响。然而，早期丢弃可能会稍微增加所需的缓冲区，因为它使用缓冲区的效率较低。

除了直接影响带宽延迟乘积外，改变延迟没有明显的影响。

拒绝服务（DOS）攻击也可能导致拥塞，通过向主机或路由器发送大量网络流量。了解如何使路由器对抗DOS攻击不在本文讨论范围内，但我们发现较大的缓冲区对抵抗DOS攻击并无直接益处。

## 6. 相关工作

Villamizar和Song在[1]中报告了RTT×BW规则，在该文中，作者测量了不同缓冲区大小下1, 4和8个长寿命TCP流的40Mb/s网络链路利用率。他们发现，对于FIFO丢弃策略和非常大的最大TCP拥塞窗口，需要有RTT×C大小的缓冲区才能保证链路完全利用。我们使用ns2重现了他们的结果，并在相同设置下确认了这些结果。在这种少数流和大拥塞窗口的情况下，流几乎完全同步，其缓冲区需求与单一流相同。

Morris [31] 调查了最多1500个长寿命流在10 Mb/s链路和25ms延迟下的缓冲区需求。他得出结论，所需的最小缓冲量是流数的一个小倍数，并指出对于一个带宽延迟乘积为217个数据包的情况，每个流在任何时候仅有几分之一的数据包在传输。许多流处于超时状态，这不利地影响了利用率和公平性。我们在ns2中重复了这一实验并得到了类似结果。然而，对于运营商或ISP使用的典型路由器来说，这种影响有限。快速接入链路的用户需要多个未完成的数据包来达到足够的性能。而对于非常慢的接入链路（例如32kb/s调制解调器或9.6kb/s GSM移动接入），则需要在网络中增加额外的缓冲区，以便有足够的数据包未完成。然而，这种额外的缓冲区应位于接入链路的末端，例如本地ISP的调制解调器库或蜂窝运营商的GSM网关。我们认为，过度缓冲服务于不同用户的主干路由器是错误的方法，因为过度缓冲会增加所有人的延迟，并且在高线速下也难以实现。相反，服务于低于1Mb/s的慢速最后一英里接入链路的接入设备应继续为每条链路提供几个数据包的缓冲区。

Avrachenkov等人[32]提出了一个用于长期流利用率和短期流完成时间的固定点模型。他们使用仅考虑流而不考虑突发的M/M/1/K模型来模拟短期流。在他们的长期流模型中，他们使用了一个受缓冲区影响的TCP解析模型。由于该模型需要固定点迭代来计算特定设置的值，并且只给出了一个仿真结果，因此我们无法直接将他们的结果与我们的结果进行比较。

Garetto和Towsley[33]描述了一个负载低于1的路由器队列长度模型，类似于我们在第4章中的模型。关键区别在于，作者在M[k]/M/1模型中将突发视为批量到达（而我们的模型通过在M/G/1模型中改变任务长度来模拟突发）。它既适应慢启动模式也适应拥塞避免模式，但缺乏闭式解。最终，作者得到的队列分布与我们的非常相似。

## 7. 结论

我们认为，主干路由器中的缓冲区比实际需要的大得多——可能是两个数量级。如果我们的结果正确，它们将对主干路由器的设计产生影响。尽管我们有证据表明可以减小缓冲区，但我们还没有在实际运营网络中测试这一假设。说服一个功能正常、盈利的网络运营商冒险移除99%的缓冲区是有些困难的。但这必须是下一步，我们认为本文提出的结果是说服运营商尝试的第一步。

短期内这也是困难的。即使运营商验证了我们的结果，或者至少证明了更小的缓冲区也能正常工作，仍然要说服路由器制造商生产较少缓冲区的路由器。在一个竞争激烈的市场中，路由器供应商是否会愿意制造只有竞争对手1%缓冲区的路由器并不明显。出于历史原因，网络运营商很可能会购买拥有更大缓冲区的路由器，即使这些缓冲区是不必要的。

最终，如果路由器继续按照当前的经验法则建造，将很难用商用内存芯片构建线路卡。因此，最终必要性可能会迫使缓冲区变得更小。至少，如果我们的结果正确，我们知道路由器将继续正常工作，网络利用率也不会受到影响。

## 8. 致谢

作者感谢威斯康星大学麦迪逊分校的Joel Sommers和Paul Barford教授在WAIL测试平台上设置并运行物理路由器的测量；以及Sally Floyd和Frank Kelly的有益讨论。Matthew Holliman关于长流的反馈导致了中心极限定理论证。

## 9. 参考文献

[此处省略参考文献列表]

希望经过优化后的文本更加清晰、连贯和专业。如果有任何进一步的修改需求，请告诉我！