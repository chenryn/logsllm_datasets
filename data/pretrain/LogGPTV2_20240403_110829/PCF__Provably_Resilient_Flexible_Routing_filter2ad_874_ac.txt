ğ‘ 1. Moreover, if ğ‘› âˆ’ 1 of the links between between ğ‘ 0 and ğ‘ 1 fail
simultaneously, the traffic is no more than 1 âˆ’ ğ‘›âˆ’1
ğ‘ .
Next, consider PCF-TF, and assume that all possible tunnels
between ğ‘  and ğ‘¡ are used. There are ğ‘ğ‘›ğ‘šâˆ’1 possible tunnels. We
will show that PCF-TF can only guarantee traffic of 1/ğ‘› units from
ğ‘ 0 to ğ‘ ğ‘š under ğ‘› âˆ’ 1 simultaneous link failures. To see this, observe
that the reservation across all tunnels between ğ‘  and ğ‘¡ is at most 1
(constrained by the capacity of all links between ğ‘ 0 and ğ‘ 1). Let ğ‘Ÿğ‘–
denote the reservation on all tunnels that use the ğ‘–ğ‘¡â„ link between
ğ‘–=1 ğ‘Ÿğ‘– â‰¤ 1, and there must exist at least one link
ğ‘— between ğ‘ 1 and ğ‘ 2 such that ğ‘Ÿ ğ‘— â‰¤ 1/ğ‘›. Consider a failure scenario
where all links between ğ‘ 1 and ğ‘ 2 except ğ‘— fail. Under this scenario,
PCF-TF can guarantee at most 1/ğ‘› units of traffic from ğ‘ 0 to ğ‘ ğ‘š.
ğ‘ 1 and ğ‘ 2. Then,ğ‘›
Note that 1 âˆ’ ğ‘›âˆ’1
> 0 whenever ğ‘ > ğ‘› > 1.
Consider the case where ğ‘ = ğ‘›2. Then, as ğ‘› gets larger, the amount
of traffic carried in the optimal solution converges to 1, while PCF-
TF converges to 0. â–¡
(ğ‘âˆ’ğ‘›)(ğ‘›âˆ’1)
ğ‘ âˆ’ 1
As discussed in Â§2, these issues with FFC and PCF-TF stem from
the fact that reservations are made over entire tunnels, are tightly
ğ‘› =
ğ‘ğ‘›
Link capacity: 1 Link capacity: 1/p, p > n s0s1s2s3.  .  . sm. .  . p links. .  . n links. .  . n linksPCF: Provably Resilient Flexible Routing
SIGCOMM â€™20, August 10â€“14, 2020, Virtual Event, NY, USA
coupled to a particular network path, and are pre-allocated inde-
pendent of any specific failure scenario. When a link in the tunnel
fails, the corresponding capacity is unavailable in other links along
the tunnel.
Logical sequences. PCF is motivated by the fact that more
flexible methods of responding to failures can potentially address
the limitations of FFC and PCF-TF highlighted by Proposition 3.
However, even with more flexible response, PCF must proactively
decide prior to any failure scenario how much traffic to admit so
the network does not experience congestion over a given set of
failure scenarios. Not all ways of making routing more flexible are
amenable to provable congestion-free guarantees.
Instead, PCF considers a more carefully crafted flexible network
response strategy, which we show is amenable to provable guaran-
tees. Specifically, PCF introduces the notion of a logical sequence
(LS). A LS ğ‘ from ğ‘  to ğ‘¡ consists of a series of routers ğ‘ , ğ‘£1, ..., ğ‘£ğ‘š, ğ‘¡
that we refer to as logical hops. Consecutive logical hops in a LS
need not have a direct link between them, and in fact any pair of
routers in the network could be consecutive logical hops. Traffic
from ğ‘  to ğ‘¡ is required to traverse the logical hops ğ‘£1, ğ‘£2, . . . , ğ‘£ğ‘š, ğ‘¡,
with significant flexibility in terms of how traffic is carried between
two consecutive logical hops. In particular, traffic may be carried
over physical tunnels (like FFC), or other LSs. We refer to each of
ğ‘ ğ‘£1, ğ‘£1ğ‘£2, ..., ğ‘£ğ‘šğ‘¡ as a logical segment of ğ‘. Each LS ğ‘ is associated
with a reservation ğ‘ğ‘, which indicates that every segment of ğ‘ is
guaranteed to carry ğ‘ğ‘ traffic under all failure scenarios that PCF
is designed for.
We next illustrate the potential benefits of LSs using Fig. 4. Con-
sider the LS ğ‘ which traverses the logical hops ğ‘ 0, ğ‘ 1, ..., ğ‘ ğ‘š. Let each
link be a tunnel. Traffic between consecutive logical hops is carried
by the tunnels (links) connecting those hops. For example, traffic
between ğ‘ 1 and ğ‘ 2 is carried on the ğ‘› tunnels (links) connecting the
nodes. When any link fails, only the reservation in the relevant
segment of ğ‘ is impacted â€“ e.g., if a link between ğ‘ 1 and ğ‘ 2 fails,
there is no impact on the reservation on the segment between ğ‘ 0
and ğ‘ 1. This is unlike FFC and PCF-TF where such a failure would
cause part of the capacity on other links to be unavailable. The
corollary to Proposition 3 below captures the resulting benefits.
Corollary 3.1. For the topology in Fig. 4, PCFâ€™s performance with
a single LS and polynomially many tunnels can be arbitrarily better
than PCF-TF and FFC with exponentially many tunnels.
Proof. We have already shown that FFC and PCF-TF can be ar-
bitrarily worse than optimal. Consider PCF where LS ğ‘ correspond-
ing to ğ‘ 0, ğ‘ 1, ..., ğ‘ ğ‘š is used, with each link being a tunnel. There are
ğ‘ + ğ‘›(ğ‘š âˆ’ 1) tunnels in total. Under any scenario involving ğ‘› âˆ’ 1
simultaneous link failures, the first segment (ğ‘ 0ğ‘ 1) has a capacity of
at least 1 âˆ’ ğ‘›âˆ’1
ğ‘ available. All other segments have at least capacity
1 available on any ğ‘› âˆ’ 1 failure scenario. Thus, ğ‘ can carry at least
1 âˆ’ ğ‘›âˆ’1
traffic, which meets the optimal throughput. â–¡
We note that using the LS has at least two sources of flexibility
beyond classic tunneling. First, in classic tunneling, traffic on each
tunnel only carries traffic corresponding to the end points of the
tunnel. Second, when there is a failure, only the source node of
a tunnel may respond. In contrast, with a LS, each segment may
carry traffic corresponding to different sources and destinations
- for instance, in Fig. 4, the segment (and hence tunnel) between
ğ‘
Figure 5: Illustrating conditional logical sequences
Optimal
1
FFC PCF-TF
0
2/3
PCF-LS
PCF-CLS
4/5
1
R3
0
Table 1: Throughput of different schemes for the topology
in Fig 5 under 2 simultaneous link failures.
ğ‘ 1 and ğ‘ 2 may carry traffic between ğ‘ 0 and ğ‘ ğ‘š. Further, if the link
between ğ‘ 1 and ğ‘ 2 fails, ğ‘ 1 may redistribute the traffic that arrives
at ğ‘ 1 onto the tunnels between ğ‘ 1 and ğ‘ 2.
Bandwidth allocation with LSs. We next show that bandwidth
allocation with LSs can be tractably formulated. For each pair with
source ğ‘  and destination ğ‘‘, let ğ¿(ğ‘ , ğ‘¡) denote the set of LSs from ğ‘ 
to ğ‘¡ (with ğ‘‡ (ğ‘ , ğ‘¡) denoting the set of tunnels as before). Note that
each source destination pair is associated with zero or more LSs,
and zero or more tunnels. Then, the model seeks to reserve ğ‘ğ‘ on
each LS, and reserve ğ‘ğ‘™ on each tunnel ğ‘™ as discussed below:
Î˜(ğ‘§)
ğ‘ğ‘™ (1 âˆ’ ğ‘¦ğ‘™) + 
ğ‘ğ‘
ğ‘âˆˆğ¿(ğ‘ ,ğ‘¡)
(ğ‘ƒ2) max
ğ‘§,ğ‘,ğ‘
s.t. 
â‰¥ 
ğ‘™âˆˆğ‘‡ (ğ‘ ,ğ‘¡)
ğ‘ğ‘â€² + ğ‘§ğ‘ ğ‘¡ğ‘‘ğ‘ ğ‘¡ âˆ€ğ‘ , ğ‘¡ âˆˆ ğ‘‰ ,âˆ€ğ‘¦ âˆˆ ğ‘Œ
(7)
ğ‘â€²âˆˆğ‘„(ğ‘ ,ğ‘¡)
ğ‘ğ‘ â‰¥ 0 âˆ€ğ‘ , ğ‘¡ âˆˆ ğ‘‰ , ğ‘ âˆˆ ğ¿(ğ‘ , ğ‘¡)
Constraints (2), (3).
The most significant change relative to (4) pertains to the capacity
constraint (first constraint). The LHS of this constraint captures
that traffic from ğ‘  to ğ‘¡ could use both the reservations (ğ‘ğ‘™) on the
physical tunnels between ğ‘  and ğ‘¡, and the reservations (ğ‘ğ‘) on the
LSs between ğ‘  and ğ‘¡. While the capacity on tunnel ğ‘™ is only available
when all links on the tunnel are alive (ğ‘¦ğ‘™ = 0), the reservation on the
LS ğ‘ is always available (though we relax this requirement in Â§3.4).
The RHS of this constraint corresponds to the total traffic that must
be carried from ğ‘  to ğ‘¡. With FFC, this corresponds entirely to the
bandwidth allocated to traffic that originates at ğ‘ , and terminates
at ğ‘¡. However, in PCF, it is possible that ğ‘ ğ‘¡ is a segment of a LS
ğ‘â€² (between a source ğ‘ â€² and destination ğ‘¡â€²). Let ğ‘„(ğ‘ , ğ‘¡) denote the
set of all such LSs. Then, the RHS also accounts for reservations
on all such ğ‘â€² âˆˆ ğ‘„(ğ‘ , ğ‘¡). We refer to (P2) as the PCF-LS model.
Note that the reservation on a LS is supported by the reservations
on physical tunnels and other LSs. The reservations on physical
tunnels themselves are supported by the capacity of underlying
physical links.
s1324Link capacity: 1 Link capacity: 1/2 567tSIGCOMM â€™20, August 10â€“14, 2020, Virtual Event, NY, USA
Chuan Jiang, Sanjay Rao, and Mohit Tawarmalani
3.4 Conditional Logical Sequences
As described in Â§3.3, each segment in a LS must guarantee the
reservation associated with the LS over the entire set of failures. We
next consider a generalization, that we call conditional LSs which
only guarantee the reservation over a subset of failure scenarios. A
conditional LS ğ‘ is associated with a condition â„ğ‘, and a reservation
ğ‘ğ‘. The reservation ğ‘ğ‘ must be guaranteed over each segment
of ğ‘ for all scenarios where the condition â„ğ‘ is met. An example
condition is a given set of links being alive or dead.
Illustrating benefits of conditional LSs. We illustrate by con-
sidering Fig. 5. Table 1 shows the traffic guaranteed by different
schemes for traffic from source ğ‘  to destination ğ‘¡ under single and
two link failures. The table shows both FFC and PCF-TF (both
schemes use all 6 tunnels from ğ‘  to ğ‘¡) are sub-optimal (for the same
reasons as (Â§3.2, Â§3.3)).
Consider now that a LS (ğ‘ , 4, ğ‘¡) is added with logical segments
ğ‘ 4 (with the tunnel ğ‘  âˆ’ 4), and 4ğ‘¡ (with multiple tunnels from 4 to ğ‘¡
including 4âˆ’ 1âˆ’ 5âˆ’ ğ‘¡, 4âˆ’ 2âˆ’ 6âˆ’ ğ‘¡, and 4âˆ’ 3âˆ’ 7âˆ’ ğ‘¡). Further, the LS
is associated with a condition that the reservation is only needed
when the link ğ‘  âˆ’ 4 is alive. Table 1 shows the optimal is achieved
with this conditional LS (PCF-CLS). Consider two link failure case.
When ğ‘ âˆ’4 is dead, at most one of the tunnels ğ‘ âˆ’1âˆ’5âˆ’ğ‘¡, ğ‘ âˆ’2âˆ’6âˆ’ğ‘¡,
ğ‘  âˆ’ 3 âˆ’ 7 âˆ’ ğ‘¡ are dead and the remaining can carry 1 unit of flow.
When ğ‘  âˆ’ 4 is alive, at most 2 of these tunnels are dead. Therefore,
they can cary 0.5 units of flow. Finally, LS (ğ‘ , 4, ğ‘¡) can carry 0.5 units
of flow since ğ‘ 4 is alive and at most 2 of the tunnels 4 âˆ’ 1 âˆ’ 5 âˆ’ ğ‘¡ ,
4 âˆ’ 2 âˆ’ 6 âˆ’ ğ‘¡ and 4 âˆ’ 3 âˆ’ 7 âˆ’ ğ‘¡ are dead.
Note that when the same LS is added but without the attached
condition, the objective is not optimal. This is because, the logi-
cal segment ğ‘ 4 cannot guarantee any reservation over single link
failures when only the tunnel ğ‘  âˆ’ 4 is used. It is possible to add
more tunnels between ğ‘  and 4 (e.g., ğ‘  âˆ’ 1 âˆ’ 4, ğ‘  âˆ’ 2 âˆ’ 4, ğ‘  âˆ’ 3 âˆ’ 4),
which allows the LS (ğ‘ , 4, ğ‘¡) to be more resilient to failures (PCF-LS).
However, this is at the cost of reservations on the tunnels from ğ‘ 
to ğ‘¡, and consequently the objective is increased but still does not
achieve the optimal.
Modeling conditional LSs. We next discuss how conditional
LSs are modeled. Under any given failure scenario, let â„ğ‘ indicate
whether LS ğ‘ is active or not. Like before, let ğ‘¦ğ‘™ indicate whether
tunnel ğ‘™ fails or not. Let (ğ‘¦, â„) denote all ğ‘¦ğ‘™ and â„ğ‘ variables, and let
ğ‘Œ ğ» denote all possible combinations of (ğ‘¦, â„) under all scenarios
involving the simultaneous failure of ğ‘“ links. To incorporate these
conditions, we replace constraint (7) in (P2) with the constraint
below, and refer to the resulting model as PCF-CLS.
ğ‘ğ‘™ (1 âˆ’ ğ‘¦ğ‘™) + 
ğ‘ğ‘â„ğ‘
ğ‘âˆˆğ¿(ğ‘ ,ğ‘¡)

â‰¥ 
ğ‘™âˆˆğ‘‡ (ğ‘ ,ğ‘¡)
ğ‘â€²âˆˆğ‘„(ğ‘ ,ğ‘¡)
ğ‘ğ‘â€²â„ğ‘â€² + ğ‘§ğ‘ ğ‘¡ğ‘‘ğ‘ ğ‘¡ âˆ€ğ‘ , ğ‘¡ âˆˆ ğ‘‰ ,âˆ€(ğ‘¦, â„) âˆˆ ğ‘Œ ğ» .
In Â§5, we show that LSs activated under a simple condition (a single
link being dead) is sufficient to get good performance. To handle
this, we model ğ‘Œ ğ» by adding constraints â„ğ‘ = ğ‘¥ğ‘’ğ‘ for each LS
ğ‘ to (4), where ğ‘’ğ‘ is the link whose failure activates LS ğ‘. In the
Appendix, we model a more general condition, where all links in
a set ğœ‚ğ‘ are alive and all links in a set ğœ‰ğ‘ are dead, which helps
generalize PCF to richer failures (e.g., node failures) (Â§3.5).
3.5 PCF generalizations
In this section, we discuss generalizations of PCF, and its relation-
ship with R3 [37], another congestion-free mechanism.
Heuristics for selecting LSs. We present a heuristic for select-
ing LSs that works well empirically (Â§5). Our approach involves
considering a more general model based on flows and decomposing
the results of that model into LSs.
We begin by introducing logical flows, which are a generalization
of LSs in that traffic is no longer constrained to visiting a sequence
of hops. A logical flow ğ‘¤ from ğ‘  to ğ‘¡ is captured by the flow balance
constraints below:
ğ‘ğ‘¤ â‰¥ 0 âˆ€ğ‘ , ğ‘¡ âˆˆ ğ‘‰ ,âˆ€ğ‘¤ âˆˆ ğ‘Š (ğ‘ , ğ‘¡)

ğ‘ğ‘¤(ğ‘– ğ‘—) âˆ’
ğ‘—