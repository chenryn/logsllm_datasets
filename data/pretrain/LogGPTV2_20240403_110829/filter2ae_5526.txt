# 【安全工具】玩转社会工程学之WiFi钓鱼工具包：WifiPhisher

##### 译文声明
本文是翻译文章，原文来源：thevivi.net。具体内容表达及含义以原文为准。

翻译：[RcoIl](http://bobao.360.cn/member/contribute?uid=870482963)  
预估稿费：200 RMB  
投稿方式：发送邮件至 linwei#360.cn 或登录网页版在线投稿

## 背景
[Wifiphisher](https://github.com/wifiphisher/wifiphisher) 是一种自动化的安全工具，用于对WiFi客户端进行定制的网络钓鱼攻击。该工具由希腊安全研究员 George Chatzisofroniou 开发，并使用 Python 编写。

Wifiphisher 因其独特的攻击方式在无线安全领域引起了广泛关注。与传统的 WiFi 攻击不同，它不涉及握手捕获或密码破解。Wifiphisher 的攻击成功主要依赖于诱导受害者提供无线网络密钥或其他敏感信息。其操作可以分为三个阶段：

1. 启动一个假冒的无线接入点（AP），也称为“evil twin”。
2. 通过向目标及其连接的合法 AP 发送去认证数据包，迫使目标从合法 AP 断开连接。
3. 使目标连接到假冒的 AP，并提供一个网页，诱使其输入无线网络密码。

尽管这看起来需要很多步骤，但 Wifiphisher 的自动化功能使得整个过程只需少量交互即可完成。Wifiphisher 的去认证攻击灵感来自于 Dan McInerney 的 Wifijammer。

要运行 Wifiphisher，您需要：
- 一个 Linux 系统。
- 两张无线网卡；其中一张支持注入（用于去认证攻击）。推荐使用 Alfa AWUS036H 或 Alfa AWUS051NH。

## 使用 Wifiphisher
最初，Wifiphisher 旨在捕获无线网络凭据。目前，它提供了三种网络钓鱼场景，其中最受欢迎的是“固件升级”页面。Wifiphisher 利用此页面说服用户进行路由器固件升级，从而获取无线网络密码。一旦用户输入密码，密码将显示在操作员的终端上，随后 Wifiphisher 会关闭假冒 AP，使目标无法察觉。

## 添加钓鱼场景
使用 Wifiphisher 几周后，我决定为其添加更多钓鱼场景。由于版权原因，Wifiphisher 不能包含任何第三方材料（如徽标或专有模板），因此没有流行的社交媒体网站钓鱼页面。不过，因为我无意在 GitHub 上发布这个修改版本，所以我认为这样做是可以的。

创建网络钓鱼页面通常很简单：下载原始钓鱼页面并修改登录表单以收集凭据。需要注意的是，在执行攻击时，操作员和目标都会失去互联网连接，因此所有钓鱼页面必须独立，不能依赖任何在线资源。使用 `wget` 可以轻松下载所需的所有文件：

```bash
$ wget -E -H -k -K -p <URL>
```

运行上述命令后，您可以获得设置钓鱼页面所需的所有文件。例如，我将使用 LinkedIn 登录页面作为示例。

Wifiphisher 通过记录以字符串“wfphshr”为前缀的所有 POST 请求来捕获凭据。因此，我们需要在网页中编辑用户名/电子邮件和密码字段，并将其附加到“wfphshr”前缀。前缀可以自定义，只要 Wifiphisher 的代码和网页中的前缀一致即可。最后，将新的钓鱼选项添加到 Wifiphisher 的菜单中。

## 测试
1. 运行 Wifiphisher 并选择最强的接口。
   注意：我还修改了 Wifiphisher 的界面选择菜单。如果不带任何参数运行，Wifiphisher 将自动选择最强大的无线接口作为干扰接口。如果选择了错误的接口，攻击可能会失败，因为大多数笔记本电脑内置的网络适配器不支持数据包注入。您可以手动指定干扰接口。
2. 选择一个钓鱼场景。
3. 选择一个 WiFi 网络作为目标，并等待 Wifiphisher 启动假冒 AP。
4. 目标开始连接到假冒 AP。
   目标方：无论他们浏览什么网站，都会被重定向到您选择的钓鱼页面。
5. 收集凭据。
   注意：我也修改了 Wifiphisher 的请求处理程序，以便能够收集多个用户的凭据。

## 进一步探索
如果我们可以让目标连接到我们的假冒 AP 并显示任何网页，为什么不能让他们下载并安装一些“有用”的软件呢？例如 Adobe Flash Player 更新？

1. 下载 Adobe Flash Player 安装页面。
2. 修改下载按钮指向我们系统上托管的文件（adobe_update.exe），并重写页面文字，说服目标下载更新文件。
3. 准备 payload。这里使用 Shellter 生成 Metasploit 的反弹 shell payload，并嵌入到 Windows 可执行文件中。您可以更改可执行文件图标，使其更具说服力。
4. 启动 Wifiphisher 并选择有效载荷下载选项。当选择“Adobe Flash Update”方案时，添加有效载荷选择提示。
5. 等待目标连接到假冒 AP。
6. 目标方：目标将看到 Adobe 更新页面，并确信下载并安装更新。
7. 目标运行更新文件，我们获得反弹 shell。
   注意：建议使用连接到公共 Metasploit 侦听器的 payload，这样即使用户断开假冒 AP 并连接到其他网络，您仍然可以获得 shell。

## 结论
在使用 Wifiphisher 的过程中，我发现了很多乐趣。虽然我不能将上述情景贡献到官方版本中，但我确实贡献了一个通用的无版权的有效载荷下载情景。如果您想尝试上述负载攻击，可以在官方 Wifiphisher 中查看“浏览器插件更新”情景。