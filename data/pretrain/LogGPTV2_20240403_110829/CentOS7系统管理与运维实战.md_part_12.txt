【示例3-34】
本示例实现的功能是搭建一域名服务器ns.oa.com，位于192.168.19.101，其他主机可以通
要配置DNS服务器，需修改配置文件/etc/named.conf。如果不存在则创建该文件。
2.编辑配置文件/etc/named.conf
Loading mirror speeds from cached hostfile
updates
extras
updates: mirrors.sina.cn
extras: mirrors.sina.cn
pid-file"/run/named/named.pid";
bindkeys-file "/etc/named.iscdlv.key"
allow-query
dnssec-lookaside auto;
dnssec-validation yes;
recursion yes;
memstatistics-file"/var/named/data/named_mem_stats.txt"
statistics-file "/var/named/data/named_stats.txt";
dump-file
directory
(any;）:
"/var/named/data/cache dump.db";
"/var/named";
第3章运维必备的网络管理技能
一
3.4KB
3.4kB
00:00
00:00
15
---
## Page 88
CentoS7系统管理与运维实战
include"/etc/named.root.key":
include"/etc/named.rfcl912.zones";
zone "oa.com" IN(
#以下为添加的配置项
logging(
Name.conf配置文件中的配置项非常多，以下为最主要的配置项说明：
options：是全局服务器的配置选项，即在options中指定的参数，对配置中的任何域
得DNS各个域名的数据文件。
zone：每一个 zone 就是定义一个域的相关信息及指定了named服务从哪些文件中获
信息追加到该文件中。
statistics-file：指定named服务的统计文件。当执行统计命令时，会将内存中的统计
dump-file：当执行导出命令时将DNS服务器的缓存数据存储到指定的文件中。
件所属的组应为named，否则域名服务无法读取数据文件。
行指定并创建，指定后所有的DNS数据文件都存放在此目录下，注意此目录下的文
directory:指定named从/var/named目录下读取DNS数据文件，这个目录用户可自
收所有主机的连接。
指定域名服务监听的网络接口。如监听在本机IP上或127.0.0.1。此处“any”表示接
listen-onport:DNS服务实际是一监听在本机53端口的TCP服务程序。该选项用于
项对这些域都生效。
都有效，如在服务器上要配置多个域如 testl.com和test2.com，在option中指定的选
type master;
file"named,ca";
channel default_debug
allow-updatenone;
file "oa.com.zone";
type
session-keyfile "/run/named/sessi
hint;
file"data/named.run";
severity dynamic;
on
---
## Page 89
/var/named中的named.localhost获得模板。文件配置内容如【示例3-35】所示。
[rootecentos named]# cat -n oa.com.zone
【示例3-35】
该文件为DNS数据文件，可以配置每个域名指向的实际IP，此文件可通过复制目录
3.编辑DNS数据文件/var/named/oa.com.zone
下面说明各个参数的含义：
TTL：表示域名缓存周期字段，指定该资源文件中的信息存放在DNS缓存服务器的
11bbs
始名字将解析到同样的主机地址。
CNAME：用来将一个域名和该域名的别名相关联，访问域名的别名和访问域名的原
资源记录。
NS：一条NS记录指向一个给定区域的主域名服务器，以及包含该服务器主机名的
A：表示主机记录，用于将一个主机名与一个或一组IP地址相对应。
Minimum：如果没有明确指定TTL的值，则minimum表示域名默认的缓存周期。
expire：指在指定的时间内，如果从服务器还不能联系到主服务器，从服务器将丢去
务器联系的时间间隔，单位是秒。
retry:指定了从域名服务器的一个请求或一个区域刷新失败后，从服务器重新与主服
为秒。
refresh：指定了从域名服务器将要检查主域名服务器的SOA记录的时间间隔，单位
录的序列号相比较，如果数值改变了，从服务器将重新拉取主服务器的数据信息。
服务器在一定时间以后请求主服务器的SOA记录，并将该序列号值与缓存中的SOA记
serial：表示该区域文件的版本号。当区域文件中的数据改变时，这个数值将要改变。从
域查找。root表示接收信息的邮箱，此处为本地的root用户。
@：表示本域，SOA描述了一个授权区域，如有oa.com的域名请求将到ns.oa.com
信息。
时间，
0
1#TTL3600
所有的区域数据。
test
ns
，此处设置为3600秒，表示超过3600秒则DNS缓存服务器重新获取该域名的
A 192.168.19.1
A192.168.19.102
TS.
A192.168.19.101
ns
1H
1D
2015
第3章运维必备的网络管理技能
serial
minimum
expire
retry
refresh
L
---
## Page 90
3-37】所示。
务器，操作步骤如下。
3.7.3
参考系统帮助“man named.conf”
CentOs7系统管理与运维实战
步02
步骤01
提示
如需正确地解析域名，客户端需要设置DNS服务器地址。DNS服务器地址修改如【示例
经过上一节的步骤，DNS
>bbs.oa.com
域名测试可以使用ping、nslookup或dig命令。
nameserver 192.168.19.1
【示例3-37】
如启动失败可以参考屏幕输出定位错误内容，或查看/var/log/messages的内容，更多信息
Name:
Address:
Server:
Address:192.168.19.1#53
Default server:192.168.19.1
【示例3-38】
[root@Centos ~]# cat/etc/resolv.con
[root@Centos Packages]# systemctl start named.service
server
#先使用server命令确认是否使用本机作为解析DNS
[root@Centos~]# nslookup
【示例3-36】
启动域名服务可以使用BIND软件提供的/etc/init.d/named脚本，如【示例3-36】所示。
4.启动域名服务
第9~11行分别定义了相关域名指向的IP地址。
域名测试。
配置/etc/resolv.conf。
DNS服务测试
oa.com.zone修改文件所属的用户组。
默认权限可能会阻止bind访问oa.com.zone 文件，因由root用户使用命令chgrp named
192.168.19.1#53
192.168.19.1
服务端已经部署完毕，客户端需要做一定设置才能访问域名服
bbs.oa.com
---
## Page 91
过程中具有非常重要的作用，需上机多加练习。
绍使读者可以掌握iptables 的使用方法。网络数据采集与分析工具tcpdump 在网络程序的调试
绍Linux系统中的网络配置、Linux内核防火墙的工作原理和使用方法，并通过一些实例的介
讲解的是Linux系统的网络配置。在开始配置网络之前，介绍了一些网络协议和概念。之后介
3.8
系统帮助或其他资料。
Address:192.168.19.102
目前Linux系统主要用作服务器，在互联网时代，要使用计算机就离不开网络。本章主要
经过以上的部署和测试演示了DNS域名系统的初步功能，要了解更进一步的信息可参考
上述示例说明了bbs.oa.com成功解析到192.168.19.102。
小结
第3章运维必备的网络管理技能
6
---
## Page 92
间的路由器传递数据包，如图4.1所示。
收件人手中。
运输网络，例如由北京市东城区发往四川省成都市成华区的邮件，则需要东城区邮政局将邮件
一小区的信件，只需在东城区邮政局分抹投递即可。如果信件发往外埠则需要借助邮政局间的
果信件传递仅发生在邮局内部，则直接分拣投递即可，例如北京市东城区某小区发往东城区另
4.1.1路由的基本概念
本节将简单介绍路由的概念。
重要工作之一，本章将介绍Linux系统中的路由管理。
器是根据路由条目转发数据包，因此路由管理的实质是路由条目管理。路由管理是运维人员的
包在网络中从主机出发，经过传输、转发最终到达目标主机所依赖的是网络中的路由器。路由
数据包的传递过程与邮政系统类似，也是先将计算机分组划分成不同子网，然后通过子网
路由器传递数据包的方法与现代邮政系统工作机制相似，先按行政区域划分设立邮局。如
路由不仅存在于路由器中，也存在于操作系统中，不仅Linux系统有，Windows中也存在。
本章涉及的主要知识点有：
对于Linux系统而言网络至关重要，这是因为大多数Linux服务器都依赖于网络。而数据
策略路由
配置Linux路由
路由的分类
路由的基本知识
认识路由
路由管理
第4章
---
## Page 93
修改为C发送给交换机，交换机再将数据包交给PC3，数据包传输完成。
由器2。
址为192.168.1.2。
PC3，路由器中就需要一条指向192.168.2.0/24的路由条目，这个条目指明数据包的下一跳地
网络192.168.2.0/24位于何处，此时就需要借助路由条目的帮助。为了能将数据包成功发往
发送出去，交换机会将数据包交给192.168.0.1，即路由器。
数据包发送过程如下：
似，PC1会将数据包交给自己的“上级”默认网关。例如在图4.1中PC1发送数据包给PC3，
由交换机发送给PC2，数据包传输过程完成了。
192.168.0.1的路由器接口均会收到广播，但只有PC2会回应PC1的广播并将其MAC地址反
ARP广播会发送给子网192.168.0.0/24中的所有计算机。图中所示的PC2和IP地址为
馈
标主机。例如当PC1发送数据包给PC2时，PC1会首先发送ARP广播寻找PC2的MAC地址，
说明简写为A、B、C等格式。
所示的MAC地址正确格式应为“00-51-5B-C0-00-08”或“00:51:5B:C0:00:08”，此处为方便
192.168.2.0/243个子网，本例中各设置的IP地址等信息均已在图中。需要特别说明的是图中
贵给PC1。当PC1收到PC2的MAC地址后，将目的IP、MAC地址正确写入数据包，然后交
（1）由于PC1与PC3的地址不在同一子网，因此PC1会将数据包的MAC地址修改为D
与邮政系统类似，当数据包发送的目标地址为同一子网时，数据包由交换机直接传送给目
IP:192.168.0.2
（4）路由器2与192.168.2.0/24直接相联，因此收到数据包后，路由器2会将目的MAC
（3）根据路由条目指示，路由器会将数据包目的MAC地址修改为F将数据包发送给路
纵观上述过程，无论是数据包发送给默认网关，还是由一个路由器发送给另一个路由器，
（2）与路由器相连的网络分别为192.168.0.0/24和192.168.1.0/24，因此路由器并不知道
另一种情况是PC1发送的数据包目的地址与PC1不在同一子网时，这时就与邮政系统类
在图4.1中共有2个交换机和路由器及3台计算机，共包含192.168.0.0/24、192.168.1.0/24、
MAC:A
PC1
IP:192.168.0.3
交换机
MAC:B
PC2
192.168.0.1
MAC:D
192.168.1.1
图4.1子网拓扑
MAC:F
192.168.1.2
192.168.2.1
交换机
第4章路由管理
IP:192.168.2.2
MAC：C
PC3
18
---
## Page 94
CentoS7系统管理与运维实战
使用的网关。
与计算机直接相连的子网路由。命令输出中Flags 字段中的U表示路由条目可用，G表示正在
可以使用route命令，如【示例4-1】所示。
中的路由条目可能会更多。这些路由条目存储于路由表中，如果要在Linux系统中查看路由表，
4.1.3
条目。
192.168.0.0/16和192.168.2.0/24，但基于精确匹配原则，最终将使用192.168.2.0/24这条路由
配目标地址，则使用最精确的条目作为转发路径。例如IP地址192.168.2.2能同时匹配
网相同，因此就会将数据包转发给192.168.1.2。
据包地址为192.168.2.2，与192.168.2.0/24网络的子网掩码按位与的结果为192.168.2.0，与子
同，则采用此路由条目的下一跳地址作为转发目的地。例如在图4.1中，路由器发往PC3的数
由条目中的子网掩码按位与，即二进制按位做乘法。如果按位与的结果与路由条目的子网相
下一跳设备)，其主要含义如下：
由的基本原理。
4.1.2
都离不开路由的参与。
在示例4-1中，命令输出了两个路由条目，第一条是指向默认网关的默认路由，第二条是
在计算机中通常不止一个路由条目，能正常通信的计算机至少有两个路由条目，而路由器
无论是计算机还是路由器，在计算路由时都遵循精确匹配原则，即如果多条路由条目都匹
172.16.45.00.0.0.0
通常计算机中会有多条路由条目，计算机发出数据包时会进行计算，将目标IP地址与路
一个路由条目至少包含3个要素：子网，子网掩码和下一跳地址（在有些设备中使用的是
在4.1.1节中介绍了路由的基本作用，但路由运作的机制比较复杂，本小节将简要介绍路
default
Destination Gateway
Kernel IP routing table
[root@localhost~]# route
【示例4-1】
?
3Linux系统中的路由表
备通常是本地接口。
下一跳地址：目标子网数据包的转发地址。在有些路由器中可以使用下一跳设备，设
子网掩码：目标子网的子网掩码，默认路由的子网掩码为0.0.0.0。
子网：目标子网的网络号，默认路由的子网号为0.0.0.0。
路由的原理
172.16.45.1
255.255.255.0U
0.0.0.0
Genmask
UG
eno16777736
eno16777736
---
## Page 95
的稳定性相当不错。
所有网络的距离。由于使用网络延迟、带宽、可靠性及负载等都被用作路由选择，因此IGRP
秒为周期向其相邻的路由器发送路由表的全部或部分，由此区域内的所有路由器都可以计算出
的专用于Cisco设备上的一种路由协议。IGRP是一种距离向量路由协议，其要求路由器以
稳定性。
协议进行可靠的传输，同时还使用了路由汇聚、增量更新等功能，极大地增加了网络可靠性和
由关系的路由协议，最适合处理像Intermet这样十分巨大的网络。BGP即不完全是距离矢量协
态计算路由表，更适合于大型网络，其收敛速度也更快。
数据库，最后路由器会通过数据库计算出OSPF路由表。与RIP相比，OSPF协议根据链路状
统内部，所有加入到OSPF的路由器都会通过路由协议相互交换信息，以维护自治系统的结构
由协议。OSPF一般用于一个路由域内，称为自治系统（AutonomousSystem）。在这个自治）
变化后，路由表生成得越慢，网络稳定需要的时间也越长)。
敛时间是指路由协议让每个路由器建立精确并稳定的路由表的时间长度，时间越长，网络发生
将不可达。由于路由器每30秒向相邻路由器交换信息，因此RIP协议的收敛时间相对较长（收
到达目的地。RIP最大的优点是配置简单，但仅适用于小型网络，如果跳数超过15，数据包
建立的路由表以距离为单位，通过一个路由器称为一跳，RIP总是希望数据包通过最少的跳数
要求路由器以30秒为周期，向相邻的路由器交换信息，从而让每个路由器都建立路由表。RIP
IGRP等。
整各路由器的路由条目，最大程度上保持网络通畅。常见的动态路由协议有RIP、OSPF、BGP、
由条目就会失效，也会造成无法访问的问题。
器上为每个子网添加路由，否则就会出现无法访问的问题。如果其中一台路由器出现问题，路
由多为静态路由；最后一种是由动态路由协议生成的动态路由。
管理员手动添加的静态路由，静态路由仅适合于网络运作简单的环境，Linux系统中添加的路
即与自身所在同一子网的路由，只要网络持续连接直联路由就会一直存在并生效；第二种是由
议，也不完全像OSPF那样使用链路状态，BGP使用的是通路向量路由协议。BGP使用TCP
将介绍这些路由条目的来源及分类。
192.168.0.1后，路由器将会计算下一步的路径，其依据就是路由器中保存的路由条目。本小节
4.1.4
在4.1.1小节中介绍了数据包如何从PC1发送到PC3的整个过程，当数据包到达
（4）IGRP（InteriorGatewayRouting Protocol，内部网关路由协议）是由Cisco公司设计
（3）BGP（BorderGatewayProtocol，边界网关协议）是一个用来处理自治系统之间的路
（2）OSPF（Open ShortestPathFirst，开放最短路径优先）是一个相对比较复杂的动态
，为了解决静态路由的这些问题，动态路由协议应运而生，动态路由协议会根据网络状况调
静态路由的缺点很明显，当路由器数量增加时，子网数量也增多，这时就需要在每个路由
路由的来源有三种，第一种是路由器和计算机根据自身的网络连接自动生成的直联路由，
（1）RIP（Routing Information Protocol，路由信息协议）是最简单的路由协议，RIP协议
静态路由和动态路由
第4章路由管理
83
90
---
## Page 96
地址等，但同时只能激活一个配置。多配置在图形界面中可以单击“Applications"，然后在弹
程如【示例4-2】所示。
eno16777736:1，其中eno16777736是网络接口的名称，“：1”则表示这是一个子接口。配置过
络接口上配置单个IP地址的相关知识已在第3章中介绍过，此处介绍如何在同一接口上配置
关的网络等，此时就需要正确设置路由，否则就无法正确访问。本节将简要介绍如何在Linux
络环境。除了常见服务器使用的Intermet网络连接外，通常还会有公司内部网络，远程访问相