不包含切屏图文件名。
这些值的顺序很重要，因为
INSERT语句认为它们同样按
guitarwars
表中列的颁序排列。
id
date
nome
score
2008-04-2214:37:34
screenshot
1
PacoJastorius
127650
2
2008-04-2221:27:54
Nevil Johansson
98430
3
2008-04-2309:06:35
Eddie Vanilli
345900
4
2008-04-2309:12:53
Belita Chevy
282470
5
2008-04-2309:13:34
Ashton Simpson
368420
6
2008-04-2314:09:50
Kenny Lavitz
64930
编写→个查询用INSERT
1
2008-04-2408:13:52
Phiz Lairston
186580
phizsscore.gif
将切屏图像名插入到表的
screenshot列中。
新的INSERT语句将切屏图像文件名插入到
scteenshot列中。
238
第5章
---
## Page 275
使用存储在文件中的数据
得出上传文件的文件名
这个查询看上去不错，不过我们还是不知道图像的具体文件名是什么。
可以认为表单中的文件输入域会以某种方式提供对文件名的访问，不
过究竞是何种方式呢？答案就是名为$_FILES的内置PHP超级全局
变量，它类似于之前用于访问表单数据的$_POST超级全局变量。与
$POST相似，$FILES也是一个数组，其中不仅有上传文件的文件
"screenshot" />
名，还包含有关该文件的其他一些可能很有用的信息。
表单通过S_F儿ES超级金
局变量将有关文件的一些
phizsscore.gif
上传文件的文
有用信息传进到PHP脚本。
件名。
image/gif
上传文件的MME类
looi
型，这里是CF。
Iloloo
001010
lololll
$_FILES['screenshot']['size']
77phizsscore.gif
12244
力
上传文件的大小（字
节数）。
这就是利用表单中文
件输入域上传的图像
文件。
$_FILES['screenshot']['tmp_name']
/tmp/phpE7qJky
文件在服务器上的临时
存储位置。
$_FILES内置超级
0
文件上传的错误码：0表示成
全局变量允许访问
功.其他值表示失败。
上传文件的有关信
息。
$_FILES变量中提供的其他信息肯定是有用的，不过目前我们只需要
图像的文件名，可以把它存储在一个局部变量（$screenshot）中
并在SQLINSERT语句中使用。
你现在的位置
239
---
## Page 276
保证外部文件数据在外部文件中
等一下，我们只是在数据
库中存储了围像文件的文件
名·那么文件本身呢？
Unverified!
186580
Guitar
Dates 2008 94-24 08,:13:52
Wars
PareL
586580
存储在外部文件中的数据一般就留在外部文件中，即使是数据库应用也往往
如此。
在这里，数据是构成一个图像的像素集合，存储在一个外部文件中，即一个
GIF、JPEG或PNG图像文件。数据库非常擅长存储文本数据，但是存储诸如图
像的原始二进制数据则不是它的强项，所以最好只是在数据库中存储图像文件
的一个引用。这个引用就是图像文件的文件名。
Web应用中不在数据库中存储图像还有一个原因，倘若存储在数据库中，使用
HTML代码显示时将困难得多。要记住，HTML代码要使用文件名由外部文件
引用图像。所以在HTML中生成一个图像标记时，需要使用图像名而不是原始
图像数据。
在Web页面上放
l001
置一个图像只需
HTMC标记使用图像
llloloo
图像文件名
的文件名来引用Web服务器
o0101o
要该图像文件的
[ololl
上的图像文件。
phizsscore.gif
PDG
一个引用。
240
第5章
---
## Page 277
使用存储在文件中的数据
harpenyou
GuitarWars主页（index.php）还不能为高分显示相应的切屏图。
完成以下代码来显示图像。
';
while ($row = mysqli_fetch_array ($data))(
//Display the score data
echo '';
echo''.$row['score'].'';
echo'Name:'.$row['name'].'';
echo'Date:'.$row['date'].'';
if (is_file(
)&& filesize(
（0';
mysqli_close ($dbc);
?>
你现在的位置
241
---
## Page 278
sharpenyourpencil答案
GuitarWars主页（index.php）还不能为高分显示相应的切屏图。
完成以下代码来显示图像。
出于筒化代码的考虑，mysqli函数失败时我们没有使
用“ordie()”来生成错误消息并退出脚本。在你自己的
应用中你可能仍毒望包含这个代码，不过为简洁起见，
这里没有这样做。
';
while ($row=mysqli_fetch_array($data)) (
// Display the score data
echo'';
这个面数检叠并确保
echo'Name:'.$row['name'].';
个空文件。
echo'Date:'.$row['date'}.';
if （is_file（Stow[‘scteenshot’]）&& filesize（Stow“scteenshot']>0）{
>,
这个函数查看一个切屏图像文件是否确
实存在。
数据库的screenshot列存健了一个给定分数的相
else{
应切屏图像。
echo''
修改GuitarWars主页
echo'';
来显示高分对应的切
mysqli_close($dbc);
?>
242
第5章
---
## Page 279
使用存储在文件中的数据
运行测试
为GuitarWars增加一个新的高分，并提供一个切屏图像。
如果还没有下载有关代码，请先从HeadFirstLabs网站（www.headfirstlabs，
com/books/hfphp）下载GuitarWars示例代码。代码放在chapter05文件夹
中。代码包括主页（index.php）、AddScore脚本（addscore.php）和一
个样式表（style.css）。
首先需要修改addscore.php脚本，使AddScore表单支持文件上传。这包括增
加新的表单域、调整标记，并检查Sscreenshot变量不为空。然后在
脚本中加人新的高分INSERT查询。
现在来看index.php脚本，增加上一页中的新代码，从而为每个高分显示相应
的切屏图像。
将所有这些文件上传到你的Web服务器，并在Web浏览器中打开addscore，
php页面。在表单中输人一个新的高分，点击Submit。然后导航到index.php
页面，查看这个新分数。
368420
Name: Asboo Simpson
Date: 2008-04-23 09:13:34
64930
Date: 2008-04-23 14:09:50
Name: Kenny Lavitz
186580
Name: Phiz Lainton
Date:2008-04-24 08:13:52
联
好像有点问题：图像没有如
期地随新分数显示。
RAIN
XPOWER
你认为切屏图像为什么没有随新分数显示出来？另
外数据库中已有的分数呢？
你现在的位置
243
---
## Page 280
上传的文件存储在一个临时文件夹中
上传的文件去哪里了？
上传图像之所以没有显示，问题出在我们之前做了一个假设，认为文
件会上传到Web服务器上PHP脚本所在的同一个文件夹中。实际表明，
这个假设完全是错误的。AddScore表单允许用户从其自已的计算机中
选择一个文件，但是这个文件实际上会上传到服务器上的一个临时文
件夹中。这个临时文件夹会在服务器上自动创建，通常有一个奇怪的
名字，包含一堆随机的字母和数字。
Web服务器
这就导致index.php中的代码出现了问题，因为它假设图像
位于主Web文件夹中：
71
这个代码假设图像存储
在PHP文件所在的主We6
这个临时文件类名
文件央中…但事实上
和位置通常随PHP安
并非如此！
装不同有所变化。
客户Web
浏览器
/le.css
addscore.php
index.php
lool
llloloo
切屏图像文件最早
001010
放在用户计算机中
这个表单由
l0loll
的某个文件类中。
addscore.php
phizsscore.gif
得来。
looi
1oloo
oolo1o
ololll
phizsscore.gif
AddScore脚本负责将图像文
件上传到服务器上的一个临
时文件类中。
244
第5章
---
## Page 281
使用存储在文件中的数据
把围像存储在一个神秘的临时文件夹中看起
来很没有必要。我们不能控制存储上传文件的
位置吗？
当然可以！PHP允许你控制将上传文件存储在哪里。
不过，你无法利用PHP控制上传文件最初的存储位置，正是因为这个原因，这个位
置被认为是临时的。不过，文件上传后你可以把文件移动到另一个位置。PHP函
数move_uploaded_file（）接受一个文件的源位置和目标位置，然后负责完成
文件移动。
move_uploaded_file(S_FILES['screenshot']['tmp_name'],$target);
个
这是图像文件的源位置
包括临时路径和交件名。
Web服务器
这是图像文件的目
标位置，包括永久
路经和文件名。
文件从一个
临时文件类
移动到一个<
永久文件类。
yle.css
score.php
index.php
looi
move_uploaded file()
00
这个文件夹可以是你在We6服务
llloloo
器上选择的任意交件夹、只是确
001010
001010
保你拥有必要的权限可以向其中
lololll
ioioill
写文件。
phizsscore.gif
phizsscore.gif
你现在的位置
245
---
## Page 282
没有傻问题
thereareno
DumbQuestions
件的初始存储位置吗？
upload_tmp_dir选项改变上传文件的初始存储位置。不
过如果你的应用在一个虚拟服务器上托管，可能无法访问
这个文件，这说明必须通过PHP脚本代码把文件移动到你自
己的文件央中。
移动后这个文件夹是不是就消失了？
这是指它不会作为上传文件的最终存储位置。可以把它认
为是一个容留区，上传文件可以存储在这里，直到它们被
移动到其最终的存储位置。
增加S_FILES['screenshot']['tmp_name']、确保
能够在临时文件央中找到该文件。不过要记住，通常你并
不会控制文件央的名宇或位置。更重要的是，在某些系统
上，可能会自动将临时文件央定期清空。另一个潜在的问
题是，临时上传文件央可能不允许公开访问，所以你无法
从HTML代码引用上传的文件，这正是GuitarWars和大多数
其他PHP应用的主要问题。通过将上传文件移出临时上传文
件央，就可以精心控制这些文件存储在哪里以及如何访问。
246
真9嵩
---
## Page 283
使用存储在文件中的数据
太好了，现在我知遥如何移
动上侍文件了。这确实很不一
般。不过对于它们要去哪里我
还是一点头绪都没有。
每个应用都需要一个图像文件夹。
确实，“需要”这个词的语气可能有点过强，不过尽可能地组织PHP
应用的各个部分确实很重要，而要做到这一点，一种方法就是为不同
的组成部分创建相应的文件夹。由于上传的文件由用户提交，它们往
往不是你能直接控制的，至少从文件名和数量上不能控制。所以把它
们与其他应用文件分开单独存储是一个很好的想法。
总之，我们需要一个图像文件夹，上传到GuitarWars应用的图像文件
都存储在这里。如果需要，这个文件夹也可以存储应用可能使用的所
有其他图像。
这个图像文件类并不比其他文
件夹更大，不过有助于统一组
织图像文件。