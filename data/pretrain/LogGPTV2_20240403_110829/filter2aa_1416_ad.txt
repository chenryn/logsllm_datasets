35
138
140
142
144
146
148
150
152
154
156
0
5
10
15
20
25
30
35
STANAG 4285
STANAG 4285
2400 baud
80 (preamble) +
4 x 32 (data) +
3 x 16 (channel probe)
@ 2400 bps
= 106.66 ms
Digital
Radio
Mondiale
Cyclic Autocorrelation Function
Un‐guarded 
symbol time
Total symbol 
periodicity
Han, Sohn & Moung,"A Blind OFDM Detection and Identification Method 
Based on Cyclostationarity for Cognitive Radio Application"
Un‐guarded Symbol Time
21.33 ms
Total Symbol Duration
~37.48 Hz = 26.6 ms
Top‐down DRM Symmetry
DRM Class B
Modulation property 
Value 
Un‐guarded symbol time 
21.33 ms 
Sub‐carrier spacing 
46 7/8 Hz 
Guard interval 
5.33 ms 
Total symbol duration 
26.66 ms 
Guard interval ratio 
1/4 
Symbols per frame 
15 
1 / (21.33 ms)
21.33 ms
(1 Msps / 50) x 21.33ms = 426.6
26.66 ms
“DUFF DUFF”
Software Defined
Radio Direction Finding
DF Usage
• Radio navigation
– Predecessor to RADAR
• SIGINT
• Emergency aid
– Avalanche rescue
• Wildlife tracking
• Reconnaissance
– Trajectory tracking
• Sport?!
Rotatable
loop antenna
History
• WW I & II
– Y‐stations along the 
British coastline
– Find bearing to 
U‐boats in Atlantic
– ‘U‐Adcock’ system
• Four 10m high vertical 
aerials around hut     
• DF goniometer 
(angle measurement) & 
radio
DF for HF
• HF: 3‐30 MHz
– long wavelengths  large distances
• HF/DF = “HUFF DUFF!”
• Used for SIGINT
• Large installations:
AN/FLR‐9 array near 
Augsburg, Germany 
Amateur RDF
• ‘Fox hunts’
• Competitor on 
‘2‐meter band’ 
ARDF course
Highly‐directional Yagi antenna
Crazy‐serious German HAM
(Pseudo‐) Doppler DF
• Exploit Doppler shifting of radio waves caused 
by motion of an antenna
• Measure the shift in detected signal
Determine direction of transmission
Recap: Doppler Effect
Aside: Siren Misconception
“…the observed frequency increases as the 
object approaches an observer and then 
decreases only as the object passes the 
observer.”
“…Higher sound pressure levels make for a 
small decrease in perceived pitch in low 
frequency sounds, and for a small increase in 
perceived pitch for high frequency sounds.”
A Swan
Doppler
Effect
Cosmological Redshift
Expansion of space, not motion of radiating object!
Frequency Modulation 101
Analog or digital
Information to 
be transmitted
‘Main’ 
transmission 
frequency
(e.g. 105.7 MHz)
Frequency modulation changes the carrier’s frequency
 Moves the carrier slightly left/right of its 
original position on frequency plot
Physically Rotated Antenna
Joseph Moell,
“Transmitter Hunting:
Radio Direction 
Finding Simplified”,
1987 (McGraw‐Hill)
Doppler Shift
• Doppler shift of received signal used to 
calculate angle of transmitter
• Easy with an FM radio!
• Frequency Modulation:
– Shifts the centre (carrier) frequency about based 
on the original modulating signal
– Doppler shift just moves it around some more
• FM receiver detects Doppler as an extra tone!
Extra tone: sine wave
http://silcom.com/~pelican2/PicoDopp/ABOUT_DOPP.html
Mechanical Rotation Rate
• Doppler equation relates:
– Doppler shift
– Radius of antenna
– Angular velocity (rotation rate)
– Frequency of signal
• For a small antenna setup tuned to 2m 
wavelength (~150 MHz), requires:
38600 RPM
~643 rot/sec
Pseudo‐Doppler
• Array of fixed antennas
• Switch electronically between them
– ‘Simulate’ physical rotation
Electronically Rotated Antenna
Home‐made RDF
• ‘Roanoke Doppler’
• Four antennas
• Control box
• Plug in any standard 
FM radio
• LEDs indicate direction
Joseph Moell,
“Transmitter Hunting:
Radio Direction Finding Simplified”,
1987 (McGraw‐Hill)
Block Diagram
Circuit Diagram
Mobile Roanoke
Time to go colour…
Software Defined RDF
Do it in software!
Software Defined RDF
Antenna 
Array
Antenna Switch
FPGA Modification
Use USRP clock
control antenna
array
Map sample counter’s 
bits to unused GPIO
Modification Bonuses
• Using FPGA clock ensures antenna switching is 
in lockstep with samples arriving at host
– Same clock domain  host‐side ‘just works’
– Use host‐generated sine wave as reference
• FPGA’s sample counter begins at zero for each 
stream start
– Calibrate array orientation just once
Receiver
Processing & Display
Switching affecting spectrum
Signal Processing
Tricks
• Only need to know:
1. Sample rate (FPGA clock / decimation)
2. Which bit of sample counter is MSB of switch
(64 MHz / 256) = 250 ksps
31st and 32nd bits used
 250k / 32 = 7.8125 kHz tone
For Xlate decim 5 & 1024 FFT bins, tone sits in:
((250 ksps / 5) / 1024) * 7812.5 = 160 exactly
Magic of SDR
FM (quadrature) demodulation:
 Multiply current signal sample by complex conjugate of 
previous one and find the argument (angle)
for (int i = 0; i < noutput_items; i++) {
gr_complex product = in[i] * conj(in[i-1]);
out[i] = d_gain * arg (product);
}
Doppler sine wave
Frequency plot (FFT) of FM‐demodulated signal
Doppler sine wave
Pure Doppler sine wave after filtering
Reference
Measured
Find a target
Telstra Tower on Council St
Known Transmitter
Start
Drive
Direction Measurement
Complications
• Line‐Of‐Sight
– Beware of reflections
• Descending into ‘valley’…
– Reflections in urban areas
– Multiple wavefronts will ‘confuse’ FM detector
• Doppler
Complications: Coogee
Line of sight
Listen: Multipath
Multiple reflections 
confusing FM detector
Inch forward until audio ‘clears up’
DC
Phase (range)
Strength
Done
Closer to (my new) home
Method 2: Super‐resolution algorithms
• Simultaneously receive multiple streams
– One stream per antenna  antenna array
• Apply a mathematical model
– Linear (far‐field) wavefront approaching antenna array
– Model/calibrate for antenna response
• MUSIC: MUltiple SIgnal Classification
– Sample signal at each antenna (assuming sinusoids)
– Maths (sample correlation matrix, eigenvector 
decomposition, orthogonal signal/noise subspaces)
– Search through array response to find peak  DOA
Wavefront impinging on antenna array
Find maximal array response
Advantages
• Much higher resolution
– Assuming model is correct & system is calibrated
• Detect & process multiple signals of interest 
simultaneously!
• However…
you need more (coherent) radios.
GNU Radio MUSIC DOA block
Calibration
• Use shared Local Oscillator
• Inject shared tone in each channel
• Calculate per‐channel phase differences
– w. r. t. reference channel
• Apply corrections
• Periodically re‐calibrate
Flowgraph
Police Checklist
• Car’s rego paper
• Amateur Radio licence
• Antenna structural redundancy
• Dress code
• Clean‐shaven
• Hide Motorola XTS radios
• Avoid turning around and trying to desperately 
disconnect antennas
Gedanken: TX
DO NOT TRY THIS AT…
WHEREVER!
Gedanken: Pagers
• Don’t like a doctor/nurse?
– Send them on many a wild goose chase
• Is your arch‐nemesis in hospital?
– Tell them to remove the other ********
• Need to distract security?
– Issue an ‘automated’ alert
Gedanken: Mode S
• Want to reach cruising altitude a little quicker?
– Put a ‘plane’ heading towards you (at a slightly 
lower altitude)
• Think the pilot made the wrong choice in deciding to 
land?
– Put a ‘plane’ on the runway
• Want to display a message on everyone’s radar 
screen?
– Spell one using ‘aircraft marker’ art
Gedanken: ACARS
• Don’t want to fly on a particular aircraft?
– Send a severe fault report
• Was the flight a little bumpy?
– Send an engine performance report to RR with 
large vibration values
• Need to message the cockpit privately?
– Address the message to cockpit printer #1
Gedanken: Satellite
• Uplink power is generally kept at the minimum level 
to save money
• Depends on the weather:
– Clear sky:
a few W
– Heavy rain:
a few kW
• Turn yours up to (theirs + 1)
• “…a malfunctioning UPC system can interfere with 
other services and even damage a satellite Travelling 
Wave Tube Amplifier…”
Remember: be legal and be….
PI:EMAIL
@spenchdotnet
http://wiki.spench.net/wiki/RF
http://spench.net/