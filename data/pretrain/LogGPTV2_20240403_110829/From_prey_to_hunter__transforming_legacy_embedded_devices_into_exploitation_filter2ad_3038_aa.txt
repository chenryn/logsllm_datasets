**Title: From Prey to Hunter: Transforming Legacy Embedded Devices into Exploitation Sensor Grids**

**Authors:**
- Ang Cui, Columbia University, Department of Computer Science, New York, NY 10027, USA
- Jatin Kataria, Columbia University, Department of Computer Science, New York, NY 10027, USA
- Salvatore J. Stolfo, Columbia University, Department of Computer Science, New York, NY 10027, USA

**Abstract:**
Our global communication infrastructure relies heavily on a vast number of legacy embedded devices. Recent advancements in offensive technologies targeting these systems have demonstrated the feasibility of stealthy exploitation of high-value embedded devices such as routers and firewalls. However, there is a significant lack of host-based defensive technologies to monitor and protect these devices, leaving them vulnerable to attacks. To address this, we developed a method to augment legacy embedded devices, such as Cisco routers, with host-based defenses, creating a stealthy, embedded sensor grid capable of monitoring and capturing real-world attacks. This is achieved through a software mechanism called the Symbiote, which injects a whitelist-based code modification detector into the Cisco IOS firmware. The resulting firmware can detect and capture successful attacks against itself for analysis. Our system requires no hardware modifications, fully preserves the original firmware's functionality, and detects unauthorized memory modifications within 450 milliseconds. We believe it is feasible to use these techniques to create an early attack warning system to protect the Internet substrate.

**1. Introduction**
The Internet is a dynamic network of various devices, primarily consisting of general-purpose hosts and servers connected by specialized embedded devices such as routers, switches, and firewalls. These embedded devices form the communication substrate of the Internet. Despite the critical role they play, most host-based security technologies are designed to protect general-purpose servers and hosts, leaving embedded devices largely undefended against exploitation.

We present a new defense system designed to make the Internet substrate more secure. Our approach involves injecting security functionality into legacy embedded systems to:
1. Provide security features to protect these devices against exploitation and rootkitting.
2. Create a large-scale sensor grid to detect and identify attacks against embedded devices that are currently unmonitored.

Recent studies suggest that many vulnerable embedded devices on the Internet are prime targets for exploitation. However, successful exploits against these devices are rarely observed, despite the availability of proof-of-concept malware and known vulnerabilities. We hypothesize that the inability to monitor embedded devices for malware installation contributes to this phenomenon. By deploying our sensor system across the Internet substrate, we aim to provide visibility into black-box embedded devices, enabling real-time detection and analysis of exploitation.

To demonstrate feasibility, we show how to transform existing legacy embedded devices into exploitation detection sensors using Cisco firmware and hardware as the primary platform. Our method involves automatically injecting generic whitelist-based anti-rootkit functionality into standard IOS firmwares. Once injected, the augmented firmware can be loaded onto physical Cisco routers, transforming them into highly interactive router honeypots. As shown in Section 8, the resulting devices are fully functional and can be deployed in production environments.

**2. Motivation**
Several recent studies highlight the presence of numerous unsecured and vulnerable embedded devices on the Internet. These devices are susceptible to the same types of attacks as general-purpose computers and can be systematically exploited. For example, exploitable vulnerabilities and rootkits have been discovered and disclosed for Cisco's router operating system, IOS. Cisco devices running IOS are widely deployed in critical areas of residential, commercial, financial, government, military, and backbone networks.

IOS, like many embedded systems, lacks modern protection schemes and does not support third-party antivirus solutions. Given the availability of proof-of-concept exploits and the high value of targets, vulnerable embedded devices should be attractive targets. While documented cases of embedded device exploitation are rare, it is plausible that stealthy, targeted attacks have gone undetected due to the lack of visibility into these devices. Therefore, detecting and mitigating such attacks is crucial for the integrity of the Internet substrate.

**3. Threat Model**
Our goal is to detect, capture, and analyze successful rootkit injections into IOS at runtime. We assume the attacker is technically sophisticated, with access to zero-day vulnerabilities and a reliable rootkit that persistently alters the behavior of the victim device's OS, providing covert root access. The rootkit will likely patch specific portions of the router's code to create a hidden backdoor, altering static regions of memory. While our current threat model covers all published IOS rootkitting techniques, it is possible that a backdoor can be created without modifying static memory. Additionally, sophisticated attacks may attempt to disable the Symbiote before exploiting the device. We discuss methods to increase the computational complexity of bypassing the Symbiote defense in Section 6.

**4. Related Work**
Little work has been done to detect and capture sophisticated attacks against embedded devices, although such problems are well-studied for general-purpose computers and operating systems. Various rootkit and malware detection mechanisms have been proposed, but they primarily target general-purpose computers. Commercial products from vendors like Symantec, McAfee/Intel, Kaspersky, and Microsoft offer some form of protection against kernel-level rootkits, but these solutions rely on signature-based detection and can be subverted. Research has also proposed advanced detection and prevention strategies, including virtualization-based methods and hardware-assisted solutions. However, these strategies have not been adapted for the unique characteristics and constraints of embedded device firmware. Our methodology transforms standard legacy embedded devices into exploitation detectors, similar to honeypot-based IDS strategies, but with a focus on embedded devices.

**Figure 1: Logical Overview of Symbiote Injection into Embedded Device Firmware**
- **Symbiote Manager**: Manages the injection process.
- **Host Program**: The original firmware or binary.
- **Symbiote Payload**: Executes alongside the original OS, maintaining control through large-scale randomized control-flow interception.

**Conclusion**
By transforming legacy embedded devices into exploitation sensor grids, we aim to enhance the security of the Internet substrate. Our approach, leveraging the Symbiote, provides a practical and effective solution to monitor and protect these critical devices. Future work will focus on extending the Symbiote-based detection to cover a broader range of threats and further fortify the system against sophisticated attacks.