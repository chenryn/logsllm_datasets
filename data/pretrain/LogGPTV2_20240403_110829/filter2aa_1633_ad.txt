mailhub.minaffet.gov.rw
mail.irtemp.na.cnr.it
mail.univaq.it
195.170.2.1
195.170.2.3
193.6.138.65
80.191.2.2
62.56.174.152
140.164.20.20
192.150.195.10
希腊
希腊
匈牙利
伊朗
以色列
意大利
意大利
希腊 
希腊 
匈牙利 
伊朗 
意大利国家研究委员会
意大利 
21
www.pangulab.cn
北京奇安盘古实验室科技有限公司
ns.univaq.it
matematica.univaq.it
sparc20mc.ing.unirc.it
giada.ing.unirc.it
mailer.ing.unirc.it
mailer.ing.unirc.it
192.167.50.12
192.167.50.14
192.167.50.2
192.167.50.202
意大利
意大利
意大利
意大利
192.150.195.20
192.150.195.38
意大利
意大利
意大利 
意大利 
bambero1.cs.tin.it
gambero3.cs..tin.it
mail.bhu.ac.in
mtccsun.imtech.ernet.in
axil.eureka.lk
mu-me01-ns-ctm001.vsnl.net.in
vsn1radius1.vsn1.net.in
vsnl-navis.emc-sec.vsnl.net.in
ns1.ias.ac.in
mail.tropmet.res.in
mail1.imtech.res.in
nd11mx1-a-fixed.sancharnet.in
194.243.154.57
194.243.154.62
202.141.107.15
202.141.121.198
202.21.32.1
202.54.4.39
202.54.4.61
202.54.49.70
203.197.183.66
203.199.143.2
203.90.127.22
61.0.0.46
意大利
意大利
印度
印度
印度
印度
印度
印度
印度
印度
印度
印度
意大利 
意大利 
印度Banaras Hindu University
印度教育网
印度 
印度 
印度 
印度 
印度 
印度 
印度 
ndl1pp1-a-fixed.sancharnet.in
bgl1dr1-a-fixed.sancharnet.in
bgl1pp1-a-fixed.sancharnet.in
mum1mr1-a-fixed.sancharnet.in
www.caramail.com
newin.int.rtbf.be
m16.kazibao.net
webshared-admin.colt.net
webshared-front2.colt.net
webshared-front3.colt.net
webshared-front4.colt.net
petra.nic.gov.jo
61.0.0.71
61.1.128.17
61.1.128.71
61.1.64.45
195.68.99.20
212.35.107.2
213.41.77.50
213.41.78.10
213.41.78.12
213.41.78.13
213.41.78.14
193.188.71.4
印度
印度
印度
印度
英国
英国
英国
英国
英国
英国
英国
约旦
印度 
印度 
印度 
印度 
英国 
英国 
英国 
英国 
英国 
英国 
约旦 
ns.cec.uchile.cl
200.9.97.3
159.226.*.*
159.226.*.*
159.226.*.*
智利
中国
中国
中国
智利 
意大利Universita' degli Studi 
Mediterranea di Reggio Calabria
意大利Universita' degli Studi 
Mediterranea di Reggio Calabria
意大利Universita' degli Studi 
Mediterranea di Reggio Calabria
意大利Universita' degli Studi 
Mediterranea di Reggio Calabria
22
www.pangulab.cn
北京奇安盘古实验室科技有限公司
166.111.*.*
166.111.*.*
166.111.**.**
168.160.*.*
202.101.*.*
202.107.*.*
202.112.*.*
202.112.*.*
202.112.*.*
202.117.*.*
202.121.*.*
202.127.*.*
中国
中国
中国
中国
中国
中国
中国
中国
中国
中国
中国
中国
202.166.*.*
202.166.*.*
202.197.*.*
202.197.*.*
202.201.*.*
202.201.*.*
202.204.*.*
202.38.*.*
202.84.*.*
202.96.*.*
202.96.*.*
202.98.*.*
中国
中国
中国
中国
中国
中国
中国
中国
中国
中国
中国
中国
202.99.*.*
210.72.*.*
210.77.*.*
210.83.*.*
211.137.*.*
211.138.*.*
211.82.*.*
218.104.*.*
202.94.*.*
218.107.*.*
218.245.*.*
218.247.*.*
中国
中国
中国
中国
中国
中国
中国
中国
中国
中国
中国
中国
23
www.pangulab.cn
北京奇安盘古实验室科技有限公司
mars.ee.nctu.tw
cad-server1.ee.nctu.edu.tw
218.29.*.*
218.29.*.*
222.22.*.*
61.151.*.*
202.175.*.*
202.175.*.*
202.175.*.*
202.175.*.*
202.175.*.*
202.175.*.*
140.113.212.13
140.113.212.150
中国
中国
中国
中国
中国澳门特别行政区
中国澳门特别行政区
中国澳门特别行政区
中国澳门特别行政区
中国澳门特别行政区
中国澳门特别行政区
中国台湾
中国台湾
台湾省新竹市国立交通大学
台湾省新竹市国立交通大学
expos.ee.nctu.edu.tw
twins.ee.nctu.edu.tw
soldier.ee.nctu.edu.tw
royals.ee.nctu.edu.tw
mail.et.ntust.edu.tw
mail.dyu.edu.tw
mail.ncue.edu.tw
aries.ficnet.net
ns.chining.com.tw
mail.tccn.edu.tw
mail.must.edu.tw
ultra10.nanya.edu.tw
140.113.212.20
140.113.212.26
140.113.212.31
140.113.212.9
140.118.2.53
163.23.1.73
163.23.225.100
202.145.137.19
202.39.26.50
203.64.35.108
203.68.220.40
203.68.40.6
中国台湾
中国台湾
中国台湾
中国台湾
中国台湾
中国台湾
中国台湾
中国台湾
中国台湾
中国台湾
中国台湾
中国台湾
台湾省新竹市国立交通大学
台湾省新竹市国立交通大学
台湾省新竹市国立交通大学
台湾省新竹市国立交通大学
台湾省台北市国立台湾科技大学
台湾省大叶大学
台湾省彰化师范大学
台湾省台湾固网
台湾省中华电信
台湾省花莲县慈济科技大学
台湾省 
台湾省 
mail.hccc.gov.tw
210.241.6.97
中国台湾
台湾省 
24
www.pangulab.cn
北京奇安盘古实验室科技有限公司
原始文件列表：
25
www.pangulab.cn
北京奇安盘古实验室科技有限公司
在2015年事件响应过程中，根据实际的流量记录，受害列表中的日本地区210.135.90.0/24网段
存在作为C2服务器的行为，即攻击者会利用受害主机作为跳板对目标进行攻击：
众多针对中国的攻击线索中，最早的一条可以追溯到2002年：
利用受害主机作为跳板攻击目标
26
www.pangulab.cn
北京奇安盘古实验室科技有限公司
Bvp47 的实现包含了复杂的代码、区段加解密，Linux多版本平台适配，丰富的 rootkit 反追踪技
巧，最重要的是集成了高级隐蔽信道中所使用的BPF引擎高级利用技巧，以及繁琐的通信加解密流程。 
本章节将就以上方面进行分析。 
Bvp47 在重要动作执行流程方面主要分为两个关键环节， “程序初始化运行”和“隐蔽信道通信”
环节。 
在“程序初始化运行”时主要有如下几个关键点， 
1. 分 Linux 用户态和内核态操作，用户态进程会保持存活 ；
2. 进行 Bvp 引擎初始化 ；
3. 一系列的环境检测，环境信息不匹配样本就自动清除；
4. 一系列的 payload 区块解密 ；
5. 篡改内核 devmem 限制，允许用户态直接读写内核空间等内核技巧； 
6. 装载非标准的 lkm 模块文件 ；
7. Hook 系统函数进行自身进程，文件，网络隐藏，自删除检测在“隐蔽信道通信”环节大致如下：  
a) Bvp47 接收到服务端发过来的SYN包后，会进入BPF过滤规则（见下文）进行数据包格式匹配； 
b) 只有满足操作 1 中的 BPF 规则后，会进行 RSA+RC-X 等加密算法的解密； 
c) 根据解密后的指令进行对应命令操作； 
主要行为 
6. Bvp47后门技术详解 
27
www.pangulab.cn
北京奇安盘古实验室科技有限公司
Bvp47 的整个文件采用后门常用打包方式，即将后门功能模块进行压缩、拼装后置文件末尾，整
体以附加数据的形式存在。附加数据通过内置在程序内部的 loader 功能模块进行加载，主要完成以下
几个步骤： 
读取 
校验 
解压 
解密 
装载 
其中 payload 主要数据结构如下： 
具体对应到样本详细内容如下： 
Payload 
28
www.pangulab.cn
北京奇安盘古实验室科技有限公司
利用 010Editor 解析效果如下： 
29
www.pangulab.cn
北京奇安盘古实验室科技有限公司
在解密方面 payload 的 loader 会， 
1. 调用四个不同的解密函数（底层解密方式一样）来完成各个分片解压操作； 
2. 完成操作 1 后，loader 会继续调用 Xor 0x47 算法（见其它章节）完成分片的解密操作； 
   具体的几个解密函数如下： 
30