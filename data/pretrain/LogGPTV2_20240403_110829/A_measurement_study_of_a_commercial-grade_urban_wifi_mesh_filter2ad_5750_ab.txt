# Average Degree of MAPs (in Logscale)
## Figure 3: Plot showing the fraction of MAPs with a given average degree for MadMesh and Roofnet

### Key Questions
- **Neighborhood Connectivity:** What does the neighborhood of each MAP look like? What kind of connectivity does each MAP have with its peers?
- **Robustness to Failures:** How robust is the deployment to failure scenarios?
- **Link-Level Error Rates and Signal Quality:** What are the link-level error rates and signal qualities on the backbone and access links? What are the contributing factors?
- **Routing Mechanisms:** Does the network topology lend itself to new routing mechanisms such as network coding and opportunistic routing?

## 3.1 Average MAP Degree
The degree of a MAP is defined as the number of neighboring MAPs with a link quality above a threshold (14 dB in this study). The average degree of the MAPs in the network helps us determine the connectivity properties of the deployed mesh network. A low degree of connectivity would imply that the MAPs have limited choices for parent links, which in turn implies limited re-routing options in the presence of losses. Conversely, an extremely high degree of connectivity would suggest over-provisioning and increased self-interference.

Figure 3 plots the CDF of the degree for all the MAPs in the mesh. We observe that 20% of the MAPs have a degree of less than 2, and about 60% of the MAPs have a degree of more than 3. This is interesting because more than 70% of the MAPs use directional sector antenna systems with a 45-degree beam for the backbone, and we would have expected lower connectedness. Overall, the connectivity of the MAPs within the mesh is fairly good.

However, it is noteworthy that the neighborhood distribution of MadMesh is still much lower than an organically grown mesh, such as the Roofnet. The latter is a network deployed in Cambridge, MA, around MIT, comprising wireless nodes hosted in homes and apartments of willing volunteers. This results in limited control over its growth and structure. In Figure 3, we also plot the degree of nodes in the Roofnet network, and the large variation in node density is a consequence of its unplanned growth. In contrast, the deployment of MadMesh is well-structured, preceded by detailed site surveys, and continuously managed. MAPs in MadMesh are continuously available, tightly managed by the network operators, making their uptimes more predictable. Therefore, it is logical to expect that the density of MAPs in MadMesh is much lower than in RoofNet.

## 3.2 Robustness of the Deployment
To gauge the quality of the mesh planning, one needs to measure the robustness of the deployment against link failures. A well-deployed network should have more than one distinct path to the wired Internet connection. We study the robustness of the mesh topology by examining the min-cut of each MAP, which is the minimum number of edges whose removal would disconnect the MAP from the graph. We build a graph from connectivity reports obtained through SNMP logs and calculate the min-cut of each MAP from the different RAPs. Figure 4 shows the scatter-plot of the average min-cut of all the MAPs as it varies against the average degree. As seen in the plot, around 8% of the MAPs have a min-cut less than 2, implying that these MAPs would get disconnected if fewer than 2 specific MAPs fail. The figure also shows that MAPs with a neighbor degree as high as 7 can still have a min-cut lower than 2, which can occur if the neighbors of a MAP have a common ancestor in the path to the RAP. Figure 4 highlights a specific instance where a group of MAPs are connected to the rest of the network via a single path at a specific time. In this case, the failure of the common MAP would result in a disconnected topology.

The analysis assumes that all MAPs in the mesh have equal failure probability. However, in reality, the failure of a MAP can be triggered by many independent factors, including hardware failures, channel fluctuations, or external interference. Thus, the exact failure probability of each MAP may differ, and this information needs to be coupled with the min-cut values to provide a better estimate of the robustness of a MAP. One way to estimate the failure probability is to track the uptimes of all the MAPs in the system. Unfortunately, we currently do not have access to this information for Madmesh, and we hope to provide more details on node failure in future work. Nonetheless, tracking the min-cut of the MAPs in the mesh provides a reasonable estimate of the robustness of the mesh, and network planners should examine the path diversity in their mesh deployments. Specifically, they need to ensure that multiple paths exist between each MAP and the different RAPs to help tide over individual failures, and a high neighbor degree of each MAP does not automatically guarantee robustness.

## 3.3 Error Rates of Backbone and Client Access Links
The mesh network utilizes two different spectral bands (2.4 GHz for access links and 5 GHz for backbone links) for communication. We characterize the relative performance of access and backbone links by comparing the packet error rates (PER) for both. PER is defined as the fraction of unicast wireless frames for which no corresponding acknowledgment was received. For the calculation of PER on the backbone links, we use two SNMP counters: the number of packets for which the MAP did not receive an acknowledgment (F) and the number of transmitted packets for which an acknowledgment was successfully received (T). We then calculate PER for the backbone links using F/(T + F). However, the SNMP data for calculating the PER on access links was not available, so we carried out directed active measurements to estimate the PER of the access side. We randomly selected 35 locations in the coverage area, and at each location, we connected with the MAP with the strongest signal and performed three sets of TCP iperf sessions, each lasting 120 seconds. Our iperf server was running on the mesh controller, and we captured packets in monitor mode on a different interface to determine the number of retransmissions (and hence the loss rates). We observed 15 distinct MAPs in this active measurement procedure.

Figure 5 shows the CDF of the PER for all the backbone (5.2 GHz) and access (2.4 GHz) bands. We observe that the PER on the access side is much higher than on the backbone side. This indicates that the error rate in the 2.4 GHz access band is much higher than in the 5.2 GHz backbone band, attributed to higher levels of interference and noise in the 2.4 GHz band, widely used by most wireless access points to serve end clients. On the access side, the client-to-MAP link is more vulnerable due to the lower transmit power of client devices compared to the MAP. This link asymmetry can lead to packet losses from the client to the MAP, even though the signal strength from the MAP to the client is high.

We validated this assumption using a client device with higher transmit power, and as expected, the PER on the access band was significantly lower for that client. Since client devices typically have lower transmit power, the performance on an end-to-end mesh path will be severely impacted by the interference and errors observed on the access link. Even if the mesh backbone is of high quality (as in MadMesh), the performance observed by clients will be limited by the interference and error effects on its direct connection to the first MAP.

## 3.4 Channel Selection in Backbone and Access Links
As described, the packet error rates on the access links are significantly higher than those of the backbone links. To understand this, we first examine the signal-to-noise ratio (SNR) of the backbone links. For a link operating on a higher SNR, there is a higher probability of successful packet transmissions. Similarly, links with low SNR values can result in high packet error rates, possibly due to high levels of ambient interference or very low received signal strength. In Figure 6(a), we plot the CDF of the SNR values reported for all the backbone links. We observe that nearly 99% of the links have an SNR above 15 dB, explaining the minimal PER values seen on the backbone links.

Next, we focus on the quality of the access links. High SNR values in the access would imply that clients would experience relatively low losses. To study the characteristics of the access links, ideally, we would plot the SNR for these links. However, different client radios use different radios (quality/brand) and different transmit powers, making the reported SNR a function of the client device and its proximity to the MAP, which are difficult to quantify. We therefore analyzed the amount of ambient noise (raw power received from non-802.11 sources operating in the same channel) and the amount of interference (raw power received from 802.11 sources other than the client in communication). These values are reported periodically in the SNMP records. We observed that the ambient noise floor was at an acceptable level of -90 dBm for nearly 90% of the access links.

In contrast, we observed that the amount of interference was very high. Figure 6(b) shows the CDF of the amount of interference for all the access links. More than 20% of the access links experience high interference of -70 dBm. We attribute such high values of interference to be one of the main reasons for the high PER seen on the access links. Another possible reason could be the low RSS of the client radios, but we could not verify this as we did not have access to the MAP software.

A possible remedy for the losses would involve:
- Forcing clients to use a better RSSI while communicating with the MAPs.
- Ensuring that the access link operates in the channel with the least amount of ambient noise and interference.

While the signal strengths from the clients cannot be controlled by the MAPs, they can ensure they operate in the best possible channel (channel with the least amount of interference and ambient noise). To determine whether the MAPs are indeed working in the best channel, we plot the CDF of the least amount of interference present in any given channel for all the SNMP snapshots in Figure 6(b). The plot shows that the MAPs are not working in the best channel available. We believe that adopting a channel selection algorithm would result in better performance in the mesh. Designing such a channel selection algorithm is nontrivial, as MAPs must ensure they operate in independent channels to avoid interfering with each other. Given the high loss rates observed in the current settings, we believe this optimization would improve overall mesh performance.

## 3.5 Feasibility of Network Coding
A good degree of connectivity in the mesh network has implications for ongoing research in network coding.