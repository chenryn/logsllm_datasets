User Guide
Cobalt Strike 4.6
CopyrightTermsandConditions
CopyrightHelp/SystemsLLCanditsgroupofcompanies.
ThecontentinthisdocumentisprotectedbytheCopyrightLawsoftheUnitedStatesofAmericaandothercountriesworldwide.The
unauthorizeduseand/orduplicationofthismaterialwithoutexpressandwrittenpermissionfromHelpSystemsisstrictlyprohibited.
Excerptsandlinksmaybeused,providedthatfullandclearcreditisgiventoHelpSystemswithappropriateandspecificdirectionto
theoriginalcontent.HelpSystemsanditstrademarksarepropertiesoftheHelpSystemsgroupofcompanies.Allothermarksare
propertyoftheirrespectiveowners.
202205051012
Table of Contents
WelcometoCobaltStrike 8
Overview 8
InstallationandUpdates 9
StartingtheTeamServer 16
StartingaCobaltStrikeClient 16
DistributedandTeamOperations 18
ScriptingCobaltStrike 20
RunningtheClientonMacOSX 21
UserInterface 22
Overview 22
Toolbar 23
SessionandTargetVisualizations 24
Tabs 26
Consoles 27
Tables 28
DataManagement 28
Overview 28
Targets 29
Services 29
Credentials 30
Maintenance 30
ListenerandInfrastructureManagement 31
Overview 31
ListenerManagement 31
CobaltStrike’sBeaconPayload 33
PayloadStaging 33
DNSBeacon 33
HTTPBeaconandHTTPSBeacon 37
SMBBeacon 41
UserGuide www.helpsystems.com page:3
TableofContents
TCPBeacon 43
ExternalC2 45
ForeignListeners 46
InfrastructureConsolidation 47
PayloadSecurityFeatures 48
InitialAccess 49
Client-sideSystemProfiler 49
ApplicationBrowser 49
CobaltStrikeWebServices 50
User-drivenAttackPackages 50
HostingFiles 54
User-drivenWebDrive-byAttacks 55
Client-sideExploits 58
CloneaSite 59
SpearPhishing 59
PayloadArtifactsandAnti-virusEvasion 62
TheArtifactKit 63
TheVeilEvasionFramework 64
JavaAppletAttacks 65
TheResourceKit 65
TheSleepMaskKit 66
PostExploitation 66
BeaconCovertC2Payload 66
TheBeaconConsole 66
TheBeaconMenu 67
AsynchronousandInteractiveOperations 68
RunningCommands 68
SessionPassing 69
AlternateParentProcesses 70
SpoofProcessArguments 70
BlockingDLLsinChildProcesses 71
UploadandDownloadFiles 71
page:4 www.helpsystems.com UserGuide
TableofContents
FileBrowser 71
TheWindowsRegistry 72
KeystrokesandScreenshots 73
ControllingBeaconJobs 73
TheProcessBrowser 73
DesktopControl 74
PrivilegeEscalation 76
Mimikatz 78
CredentialandHashHarvesting 79
PortScanning 79
NetworkandHostEnumeration 80
TrustRelationships 81
LateralMovement 82
LateralMovementGUI 82
OtherCommands 83
BrowserPivoting 84
Overview 84
Setup 85
Use 86
HowBrowserPivotingWorks 87
Pivoting 87
WhatisPivoting 87
SOCKSProxy 87
ReversePortForward 88
SpawnandTunnel 89
PivotListeners 90
CovertVPN 91
SSHSessions 92
TheSSHClient 92
RunningCommands 93
UploadandDownloadFiles 93
Peer-to-peerC2 94
UserGuide www.helpsystems.com page:5
TableofContents
SOCKSPivotingandReversePortForwards 94
MalleableCommandandControl 95
Overview 95
CheckingforErrors 95
ProfileLanguage 96
HTTPStaging 103
ABeaconHTTPTransactionWalk-through 103
HTTPServerConfiguration 104
Self-signedSSLCertificateswithSSLBeacon 106
ValidSSLCertificateswithSSLBeacon 106
ProfileVariants 107
CodeSigningCertificate 108
DNSBeacons 108
ExercisingCautionwithMalleableC2 110
MalleablePE,ProcessInjection,andPostExploitation 111
Overview 111
PEandMemoryIndicators 111
ProcessInjection 114
ControllingProcessInjection 116
ControllingPostExploitation 119
UserDefinedReflectiveDLL Loader 121
BeaconObjectFiles 124
WhataretheadvantagesofBOFs? 124
HowdoBOFswork? 125
WhatarethedisadvantagesofBOFs? 125
HowdoIdevelopaBOF? 125
DynamicFunctionResolution 126
AggressorScriptandBOFs 127
BOFCAPI 128
AggressorScript 131
WhatisAggressorScript? 131
HowtoLoadScripts 132
page:6 www.helpsystems.com UserGuide
TableofContents
TheScriptConsole 132
HeadlessCobaltStrike 133
AQuickSleepIntroduction 134
InteractingwiththeUser 136
CobaltStrike 137
DataModel 140
Listeners 141
Beacon 143
SSHSessions 151
OtherTopics 153
CustomReports 155
CompatibilityGuide 157
Hooks 159
Events 174
Functions 187
PopupHooks 331
Report-OnlyFunctions 331
ReportingandLogging 340
Logging 340
Reports 340
CustomLogoinReports 346
CustomReports 347
Appendix 347
KeyboardShortcuts 347
BeaconCommandBehaviorandOPSECConsiderations 348
UnicodeSupport 353
UserGuide www.helpsystems.com page:7
WelcometoCobaltStrike/Overview
Welcome to Cobalt Strike
CobaltStrikeisaplatformforadversarysimulationsandredteamoperations.Theproductis
designedtoexecutetargetedattacksandemulatethepost-exploitationactionsofadvanced
threatactors.ThissectiondescribestheattackprocesssupportedbyCobaltStrike’sfeatureset.
Therestofthismanualdiscussesthesefeaturesindetail.
Overview
TheOffenseProblemSet
Athought-outtargetedattackbeginswithreconnaissance.CobaltStrike’ssystemprofilerisa
webapplicationthatmapsyourtarget’sclient-sideattacksurface.Theinsightsgleanedfrom
reconnaissancewillhelpyouunderstandwhichoptionshavethebestchanceofsuccessonyour
target.
Weaponizationispairingapost-exploitationpayloadwithadocumentorexploitthatwill
executeitontarget.CobaltStrikehasoptionstoturncommondocumentsintoweaponized
artifacts.CobaltStrikealsohasoptionstoexportitspost-exploitationpayload,Beacon,ina
varietyofformatsforpairingwithartifactsoutsideofthistoolset.
UseCobaltStrike’sspearphishingtooltodeliveryourweaponizeddocumenttooneormore
peopleinyourtarget’snetwork.CobaltStrike’sphishingtoolrepurposessavedemailsintopixel-
perfectphishes.
Controlyourtarget’snetworkwithCobaltStrike’sBeacon.Thispost-exploitationpayloaduses
anasynchronous“lowandslow”communicationpatternthat’scommonwithadvancedthreat
malware.BeaconwillphonehomeoverDNS,HTTP,orHTTPS.Beaconwalksthroughcommon
proxyconfigurationsandcallshometomultiplehoststoresistblocking.
UserGuide www.helpsystems.com page:8
WelcometoCobaltStrike/InstallationandUpdates
Exerciseyourtarget’sattackattributionandanalysiscapabilitywithBeacon’sMalleable
CommandandControllanguage.ReprogramBeacontousenetworkindicatorsthatlooklike
knownmalwareorblendinwithexistingtraffic.
Pivotintothecompromisednetwork,discoverhosts,andmovelaterallywithBeacon’shelpful
automationandpeer-to-peercommunicationovernamedpipesandTCPsockets.CobaltStrike
isoptimizedtocapturetrustrelationshipsandenablelateralmovementwithcaptured
credentials,passwordhashes,accesstokens,andKerberostickets.
DemonstratemeaningfulbusinessriskwithCobaltStrike’suser-exploitationtools.Cobalt
Strike’sworkflowsmakeiteasytodeploykeystrokeloggersandscreenshotcapturetoolson
compromisedsystems.Usebrowserpivotingtogainaccesstowebsitesthatyourcompromised
targetisloggedontowithInternetExplorer.ThisCobaltStrike-onlytechniqueworkswithmost
sitesandbypassestwo-factorauthentication.
CobaltStrike’sreportingfeaturesreconstructtheengagementforyourclient.Providethe
networkadministratorsanactivitytimelinesotheymayfindattackindicatorsintheirsensors.
CobaltStrikegenerateshighqualityreportsthatyoumaypresenttoyourclientsasstand-alone
productsoruseasappendicestoyourwrittennarrative.
Throughouteachoftheabovesteps,youwillneedtounderstandthetargetenvironment,its
defenses,andreasonaboutthebestwaytomeetyourobjectiveswithwhatisavailabletoyou.
Thisisevasion.ItisnotCobaltStrike’sgoaltoprovideevasionout-of-the-box.Instead,the
productprovidesflexibility,bothinitspotentialconfigurationsandoptionstoexecuteoffense
actions,toallowyoutoadapttheproducttoyourcircumstanceandobjectives.
Installation and Updates
HelpSystemsLLCdistributesCobaltStrikepackagesasnativearchivesforWindows,Linux,and
MacOSX.
CobaltStrikeusesaclient/servermodelwhereeachcomponentcanbeinstalledonthesame
system,butisoftendeployedseparately.TheCobaltStrikeGUIisreferredtoas‘CobaltStrike’,
the‘CobaltStrikeGUI’,orthecommandusedtostarttheclient‘cobaltstrike’.TheCobaltStrike
serverisreferredtoas‘TeamServer’orthecommandusedtostarttheserver‘teamserver’.
ThebasicprocesstoinstallCobaltStrikeinvolvesdownloadingandextractingadistribution
packageontoyouroperatingsystemandrunninganupdateprocesstodownloadtheproduct.
Before You Begin
ReadthissectionbeforeyouinstallCobaltStrike.
System Requirements
ThefollowingitemsarerequiredforanysystemhostingtheCobaltStrikeclientand/orserver
components.
Java
CobaltStrike'sGUIclientandteamserverrequireoneofthefollowingJavaenvironments:
UserGuide www.helpsystems.com page:9
WelcometoCobaltStrike/InstallationandUpdates
l OracleJava1.8
l OracleJava11
l OpenJDK11.(seeInstallingOpenJDKonpage10forinstructions)
NOTE:
IfyourorganizationdoesnothavealicensethatallowscommercialuseofOracle'sJava,we
encourageyoutouseOpenJDK11.
Supported Operating Systems
CobaltStrikeTeamServerissupportedonaLinuxsystemthatmeetstheJavarequirementsand
hasbeentestedonthefollowingDebianbasedLinuxdistributions(otherversionsmayworkbut
havenotbeentested):
l Debian
l Ubuntu
l KaliLinux
CobaltStrikeClientrunsonthefollowingsystems:
l Windows7andabove
l MacOSX10.13andabove
l GUIbasedLinux,suchas:Debian,UbuntuandKaliLinux(otherversionsmayworkbut
havenotbeentested)
Hardware
Inadditiontoanacceptedoperatingsystem,thebelowminimumrequirementsshouldbemet:
l 2GHz+processor
l 2GBRAM
l 500MB+availablediskspace
OnAmazon'sEC2,useatleastaHigh-CPUMedium(c1.medium,1.7GB)instance.
Linux glibc
BeawarethatcertainLinuxdistributionsmaybemissingordon'thavethecorrectversionof
glibc.Ifyourunintothatissue,reviewtheKnowledgeArticle,glibcMissingFromOlderLinux
Distributions,ontheHelpSystemsPortal.
Installing OpenJDK
CobaltStrikeistestedwithOpenJDK11anditslaunchersarecompatiblewithaproperly
installedOpenJDK11environment.
Linux (Kali 2018.4, Ubuntu 18.04)
1. UpdateAPT:
sudo apt-get update
2. InstallOpenJDK11withAPT:
UserGuide www.helpsystems.com page:10
WelcometoCobaltStrike/InstallationandUpdates
sudo apt-get install openjdk-11-jdk
3. MakeOpenJDK11thedefault:
sudo update-java-alternatives -s java-1.11.0-openjdk-amd64
Linux (Other)
1. UninstallthecurrentOpenJDKpackage(s).
2. DownloadOpenJDKforLinux/x64at:https://jdk.java.net/archive/.
3. ExtracttheOpenJDKbinary:
tar zxvf openjdk-11.0.1_linux-x64_bin.tar.gz
4. MovetheOpenJDKfolderto/usr/local:
mv jdk-11.0.1 /usr/local
5. Addthefollowingto~/.bashrc:
JAVA_HOME="/usr/local/jdk-11.0.1"
PATH=$PATH:$JAVA_HOME/bin
6. Refreshyour~/.bashrctomakethenewenvironmentvariablestakeeffect:
source ~/.bashrc
MacOS X
1. DownloadOpenJDKformacOS/x64at:https://jdk.java.net/archive/.
2. OpenaTerminalandnavigatetotheDownloads/folder.
3. Extractthearchive:
tar zxvf openjdk-11.0.1_osx-x64_bin.tar.gz
4. Movetheextractedarchiveto/Library/Java/JavaVirtualMachines/:
sudo mv jdk-11.0.1.jdk/ /Library/Java/JavaVirtualMachines/
ThejavacommandonMacOSXwillusethehighestJavaversionin/Library/Javaasthedefault.
TIP:
IfyouareseeingaJRELoadError messagethisisbecausetheJavaAppLauncherstub
includedwithCobaltStrikeloadsalibraryfromasetpathtoruntheJVMwithinthestub
process.Issuethefollowingcommandtofixthiserror:
sudo ln -fs /Library/Java/JavaVirtualMachines/jdk-11.0.2.jdk
/Library/Internet\ Plug-Ins/JavaAppletPlugin.plugin
Replacejdk-11.0.2.jdkwithyourJavapath.ThenextCobaltStrikereleasewilluseaJava
ApplicationStubforMacOSXthatismoreflexible.
Windows
1. DownloadOpenJDKforWindows/x64at:https://jdk.java.net/archive/.
2. Extractthearchivetoc:\program files\jdk-11.0.1.
UserGuide www.helpsystems.com page:11
WelcometoCobaltStrike/InstallationandUpdates
3. Addc:\program files\jdk-11.0.\bintoyouruser'sPATHenvironmentvariable:
a. GotoControl Panel-> System-> Change Settings-> Advanced->
Environment Variables....
b. HighlightPathinUser variables for user.
c. PressEdit.
d. PressNew.
e. Type:c:\program files\jdk-11.0.1\bin.
f. PressOKonalldialogs.
Wayland Desktop - Not Supported
WaylandisamodernreplacementfortheXWindowsSystem.Waylandhasmadegreatstrides,
asaproject,andsomedesktopenvironmentsuseitastheirdefaultwindowsystem.Don'tletthe
adoptionfoolyouthough.Notallapplicationsorapplicationenvironmentswork100%perfectly
onWayland.Therearestillbugsandissuestoaddress.
TherearebugsinJava(orWayland)thatmaycauseagraphicalJavaapplicationtocrash,during
normaluse,whenruninaWaylanddesktop.ThesebugsaffectCobaltStrikeusers.HelpSystems
doesnotsupporttheuseofCobaltStrikeonWaylanddesktops.
Am I using Wayland?
Typeecho $XDG_SESSION_TYPEtofindoutifyou'reonwaylandorx11.
How to disable Wayland on Kali Linux
ThelatestversionofKaliLinux2017RollingusesaWaylanddesktopbydefault.Tochangethis
backtoX11:
1. Open/etc/gdm3/daemon.confwithyourfavoritetexteditor.
2. Findthe[daemon]section.
3. AddWaylandEnable=falseandrebootyoursystem.
Installing Cobalt Strike
FollowtheseinstructionstoinstallCobaltStrike.
NOTE:
TheCobaltStrikeDistributionPackage(steps1and3)containstheOS-specificCobalt
Strikelauncher(s),supportingfiles,andtheupdaterprogram.ItdoesnotcontaintheCobalt
Strikeprogramitself.RunningtheUpdateProgram(step4)downloadstheCobaltStrike
productandperformsthefinalinstallationsteps.
1. DownloadaCobaltStrikedistributionpackageforasupportedoperatingsystem.(an
emailisprovidedwithalinktothedownload)
2. SetuparecommendedJavaenvironment.(seeInstallingOpenJDKonpage10for
instructions)
UserGuide www.helpsystems.com page:12
WelcometoCobaltStrike/InstallationandUpdates
3. Extract,mountorunzipthedistributionpackage.Basedontheoperatingsystemperform
oneofthefollowing.
a. ForLinux:
i. Extractthecobaltstrike-dist.tgz:
tar zxvf cobaltstrike-dist.tgz
b. ForMacOSX:
i. Double-clickthecobaltstrike-dist.dmgfiletomountit.
ii. DragtheCobaltStrikefoldertotheApplicationsfolder.
c. ForWindows:
i. Disableanti-virusbeforeyouinstallCobaltStrike.
ii. Useyourpreferredziptooltoextractthecobaltstike.zipfiletoaninstall
location.
4. Runtheupdateprogramtofinishtheinstall.Basedontheoperatingsystemperformone
ofthefollowing.
a. ForLinux:
i. Enterthefollowingcommands:
cd /path/to/cobaltstrike
./update
b. ForMacOSX:
i. NavigatetotheCobaltStrikefolder.
ii. Double-clickUpdate Cobalt Strike.command.
c. ForWindows:
i. NavigatetotheCobaltStrikefolder.
ii. Double-clickupdate.bat.
Makesureyouupdatebothyourteamserverandclientsoftwarewithyourlicensekey.Cobalt
Strikeisgenerallylicensedonaperuserbasis.Theteamserverdoesnotrequireaseparate
license.
License Authorization Files
ThelicensedversionofCobaltStrikerequiresavalidauthorizationfiletostart.Anauthorization