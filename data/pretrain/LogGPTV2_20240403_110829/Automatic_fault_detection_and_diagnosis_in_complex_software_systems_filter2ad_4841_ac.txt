Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 09:56:20 UTC from IEEE Xplore.  Restrictions apply. 
thesystemstateiscomponentS.Byassumption(1),Pp(Si)=1.Therefore,pT={(p(S1),p(S2),...p(Sn)}istheprobabilitydistributionvectorforthedifferentcom-ponents.Withassumptions(4,5,6),thesystemcanbemodeledasaMarkovchainwithtransition-probabilityma-trixG.Astationaryprobability-distributionvectorπ=[(π(S1),π(S2),...π(Sn))]TisavectorsuchthatπT=πTGIfπexists,thesigniﬁcancemeasureofacomponentSisgivenbyπ(S).Wecallπthesigniﬁcancevector.Weobtaintheappropriatetransition-probabilitymatrixGinthreesteps.LettheinitialtransitionmatrixbeH:ann×nmatrixwhereHij=ui(j).Basedonassumption(5),thisisthetransitionmatrixifalltransitionsareoftypeprogress.Ifwemaketheoptionalassumption(3),itcanbeshownthatHisstochastic.Otherwise,astochasticadjustmentshouldbemadebyreplacingall0TrowsofHwith1neT;i.e.,L=H+a1neT,whereai=1ifPi=∅andai=0otherwise.Thisadjustmentisinaccordancewithassump-tions(3,6),asatransitionfromanisolatedcomponentmustbeanexittransition.Aprimitiveadjustmentisthenperformedaccordingtoassumptions(4,6):G=αL+(1−α)evT.Asaconse-quence,itcanbeshownthatGisstochastic,irreducibleandaperiodic[6].Therefore,auniquepositivestationaryvectorπexists,andcanbefoundbythePowermethod[6].Oncewehavecomputedthesigniﬁcancevector,theanomalyscorerjofcomponentSjisadjustedasfollows:rj=Pni=1ci(t)∩Mijπ(Cj)Pni=1ci(t)∪MijTheSigScorealgorithmaddressestheproblemthatpop-ularcomponentsareweightedmoreheavilyintheRa-tioScorealgorithm.Itdoessobyadjustingtheanomalyscorebyanestimateofthecomponentpopularity.Inpractice,therecommendedvaluesforα,uTiandvT[6]aregivenby:α=0.85,vT=1neT,andui(j)=(1|Pi|,ifSj∈Pi0,otherwiseThesuggesteduTiandvTassumeequalprobabilityoftransitionamongcomponents,whichisreasonablegivenknowledgeofcomponentdependenciesonly.Eventhoughthesuggestedαdrawsfromexperienceinthewebsearchdomain,itproducesgoodresultsinourexperiments.More-over,thevalueofαdoesnotchangethecomponentranksinthestationaryvector,butonlyaffectsthespeedatwhichthePowermethodconverges.Inourwork,becausethematrixrankofGissmall,thecostofeachiterationofthePowermethodislow,andthus,thechoiceofαisnotcritical.WeillustratehowtheSigScorealgorithmworksusingtheexamplepresentedinSection4.2.Theinitialtransitionmatrixisgivenby:H=013131301000010000120001200010Thestochasticandprimitivityadjustmentyields:L=HG=0.85L+0.15eeTThepowermethodyieldsthesigniﬁcancevector:πT=(0.358,0.131,0.131,0.245,0.134)TThesigniﬁcancevectormatchestheintuitionfromFig-ure3;ComponentAisthemostpopular,andcomponentDisthesecondmostpopular.Afteradjustingtheanomalyscoresbythecomponents’popularity,thescoresbecome(1.39,2.51,0,1.02,1.86).TheseupdatedscorescorrectlypinpointcomponentBasthefaultycomponent.5EvaluationWeusearealisticJ2EE-basedsystemtovalidateourap-proach.OurtestbedincludesadatatierbasedonaDB2UDB8.2databaseserverandanapplicationtierconsist-ingofWebSphere6ApplicationServer.Ourtargetapplica-tionisTrade[7],whichprovidesareal-worldtransactionalworkloadofabusinessapplicationofferingonlinetradingofsecurities.Ourworkloaddriveremulatesauniformran-dompopulationofclientsaccessingtheapplicationfunc-tionality(e.g.,getstockquotes,buy,sell,viewportfolio,etc.).Thisworkloadcausesthesystemtooperateatrangeofresourceutilizationlevels.TomonitorthesystemwecollectmanagementmetricsfromWebSphereandDB2,whichreﬂectthestateandper-formanceof28components(SeeexamplesinTable2).WecollectallmetricsfromWebSpheretogetherwithdatabase-andtable-levelmetricsfromDB2,providedtheyhavenon-zerovariance.Ourdatasetsconsistofmorethan300met-ricscollectedevery10seconds.ThedatasetweusetocomputeNMIiscollectedoveraperiodofthreehoursduringwhichnormalactivityissimu-lated.WeusethesamedatatoestimatetheNMIthresholdtNMIcorrespondingtor2>0.6,whichgenerallyindicatesastronglinearrelationship.WethenfeedtheNMIvaluesandtNMItothecomplete-linkhierarchicalagglomerativeclusteringalgorithm[5]togroupsimilarmetricstogether.978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
292
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 09:56:20 UTC from IEEE Xplore.  Restrictions apply. 
ComponentMetricsWebContainer#Sessionscreated/invalidatedThreadPoolsFreepoolsizeJDBCmoduleMeanresponsetime,#FreeconnectionsServlet/JSPandEJB#Instantiated,MeanresponsetimeDatabase#Activeconnections,#LogwritesDatabasetables#Rowsretrieved/writtenTable2.ExamplesofmetricscollectedFaultClassFaultCategoryComponentsInjectedApplicationfaultsExceptionsinEJBs5ExceptionsinJSPs7OperatormistakesMisconﬁgurations3Componentdeletion7Table3.FaultsInjectedWeevaluateouralgorithmsbyinjectingfaultsincom-ponentsofTrademidwaythroughexperiments,whichoth-erwisesimulatenormalactivity.Wesimulatetwocate-goriesoffaults:application-levelfaultsandoperatormis-takes.Application-levelfaultsaredefectsthatmayap-pearwhen,forexample,theapplicationisupdated.Op-eratormistakesconsistofconﬁgurationerrorsmadewhiletuningthesystem.Ourfaultsincludeexceptionsinappli-cationcomponents,misconﬁgurationofthedatabaseau-thenticationcredentials,incorrecttuningofconnectionandthread-poolsizes,andinadvertentdeletionofcomponentsduringapplicationre-deployment.Table3summarizesthe22faultsweuse.Forfaultinjection,wecarryoutseparate30-minutelongexperiments,ineachofwhichthesystemisfaultyfor10minutes.5.1FaultDetectionAnidealfault-detectionalgorithmshouldreportanoma-lieswheneverthereisafaultandreportnothingotherwise.Nevertheless,afterafaultoccurs,thecurrentobservationwindowmaycontainbothnormalandanomaloussamples.Thus,theWilcoxonRank-Sumtestonslidingwindowsmaynotreportanomaliesimmediately.Theremaybeatimelaguptothelengthoftheobservationslidingwindowbeforeanomaliesaredetected.Wecallthislagadetectionwindow,whichequalsthesizeoftheobservationwindowtimesthedurationofthesamplingperiod.Assuch,werequireouralgorithmtoachievethefollowing:1.Sensitivity:whenafaultoccurs,thealgorithmshouldreportananomalyafterthefaultoccursandbeforethedetectionwindowpasses.2.Accuracy:anyanomalyreportedshouldtrulyrepre-sentafault.Anyanomalyreportedwhenthereisnofaultisconsideredafalsealarmandshouldbeavoided. 0 5 10 15 20 25 30 35 40 4 6 8 10 12Fault CoverageWindow SizeFaults DetectedFaults OccurredFigure4.FaultCoverageWemeasurethedetectionsensitivitybythefaultcoverageFC,whichisgivenby:FC=nXi=1FiwhereFi=1ifananomalyisreportedwithinthedetectionwindowafterafaultisinjectedinanexperimenti,andFi=0ifnoanomalyisreportedwithinthedetectionwindow.Ideally,FCshouldequaln.Wecomputethefalse-positiverateFPthus:FP=Pni=1piPni=1aiwherenisthenumberofexperimentswecarryout,aiisthenumberoftimesalarmsareraisedduringexperimenti,andpiisthenumberoftimesalarmsareraisedduringexperimentiwhenthereisnofault.Ideally,FP=0.Weevaluatethedetectionperformanceusing22experi-ments,eachwithfaultsinjectedfromthetimeinterval32.Intheseexperiments,wesetthebaselinewindowsizetobethesameasthatofthetestwindow,andrepeattheseex-perimentswiththetestwindowsizerangingfrom4to12.Figure4showsthefaultcoverage,andFigure5showsthefalse-positiveratewithdifferentwindowsizes.WeseeacleartendencyinFigure5thatusinglargerwin-dowsproducealowerfalse-positiverate.Thisisreasonable,asmoresamplesinastatisticaltestmakethetestmorero-bustandreliable.Moreover,Figure4showsmodestim-provementinfaultcoverageasthewindowsizeincreases.Theseresultssuggestatrade-offbetweendetectionlatencyanddetectionquality.Thelongerthedetectionlatencywecantolerate,thelargerthesizeoftheobservationwindowwecanuseintheWilcoxonRank-Sumtest,whichwouldimprovefaultdetection.OurexperimentsshowthattheWilcoxonRank-Sumtestbasedoninformation-theoreticmeasuresachievesgood978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
293
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 09:56:20 UTC from IEEE Xplore.  Restrictions apply. 
 0 0.02 0.04 0.06 0.08 0.1 4 6 8 10 12False-Positive RateWindow SizeFalse PositiveFigure5.False-PositiveRatefaultcoverage,whileincurringalowfalse-positiverate.Thetestreliablydetectsfaultsaslongasthefaultsinducestatisticallysigniﬁcantperturbanceinthesystem.Withatestwindowsizeof7orlarger,wedetectatleast15outof22faultsandhaveafalse-positiverateoflessthan5%.Withawindowsizeof11orlarger,wehavenofalsepositivesanddetect17outof22faults.Incaseswherewedonotdetectfaults,mostoftenthereisnometricthatadequatelyreﬂectstheinducedchangeinbehaviour.Also,somefaultsmaynotcausetheclusterentropytochangeastheeffectsontheun-derlyingdistributionarenotwellcapturedbyourentropyestimation.5.2DiagnosisApre-requisiteforperformingdiagnosisisthatafaultisﬁrstdetected;thediagnosisalgorithmisonlyexecutedwhenthedetectionalgorithmﬁndsananomaly.AsshowninFigures4and5,largerwindowsizesenablemorereliablefaultdetection.Therefore,wesetthewindowsizeto12intheremainingexperiments,wherebywedetect17outof22faultswithoutanyfalsealarms.Weevaluateourdiagnosisalgorithmsusingthese17experiments.Weevaluatethediagnosisqualitybyboththefaulty-componentrankandtheidentiﬁed-faultscountcriteriade-scribedinSection4.Faulty-ComponentRank:Thefaulty-componentrankinthe17experimentsareshowninTable4.Inthethreeexperimentswith“-”astherank,thefaultycomponenthasananomalyscoreof0andthereforeisnotranked.Intheremaining14experiments,weseethatSigScoreisalwaysbetterthanRatioScoreexceptforonecase.TheaveragerankforSigScoreis4.76,whereasitis7.18forRatioScore.Identiﬁed-FaultsCount:Ourmodelingcaptures28componentsinoursystemviatheirmetrics;assuch,thecandidate-setsizetcouldbeanynumberbetween1and28,dependingonthesystemadministrator’srequirements.FaultRatioScoreSigScoreDBauthenticationfault96DBconnectionpoolsizefault11Threadpoolsizefault--displayquote.jspdeletion21tradehome.jspdeletion136marketsummary.jspdeletion135order.jspdeletion43portfolio.jspdeletion32quote.jspdeletion1210QuoteEJBexceptions149OrderEJBexceptions78AccountEJBexceptions--HoldingEJBexceptions1816quote.jspexceptions107order.jspexceptions--marketsummary.jspexceptions43tradehome.jspexceptions124Table4.Faulty-ComponentRank 0 5 10 15 20 0 5 10 15 20 25 30Faults DiagnosedCandidate Set SizeSigScoreRatioScoreFigure6.Identiﬁed-FaultsCountHowever,thesmallerthecandidateset,thefasterasys-temadministratorcanlocalizethefault.Figure6showstheidentiﬁed-faultscountastvariesfrom1to28.WecanseethatSigScoreisstrictlybetterthanRatioScore.SigScoresucceedsinidentifyingthefaultycomponentwithinthetop-5in7outof17cases,whichamountstoa40%im-provementoverRatioScore.Likewise,SigScoreincludesthefaultycomponentinthetoptenin13ofthe17cases,ascomparedto8forRatioScore.TheseresultsshowthatSigScoreprovidesasigniﬁcantimprovementovertheuseofaJaccardcoefﬁcient-basedanomalyscore,whichrepre-sentsthestate-of-the-art.6RelatedWorkSeveralstudieshavereportedtheexistenceofstatisticalcorrelationsbetweensoftware-systemsmetrics[4,9,15,16,17].Theseworkssuggestthatsuchcorrelationscanbeusedtodetectandlocalizefaults.However,inpriorworkre-searchershaveassumedthatcorrelationsﬁtaspeciﬁcmath-978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
294
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 09:56:20 UTC from IEEE Xplore.  Restrictions apply. 
ematicalform.Incontrast,ourapproachtomodelingdoesnotassumeanyspeciﬁcformofmetricrelationships.MostcurrenttechniquesfordiagnosisbasedonmetriccorrelationsarevariantsoftheJaccardcoefﬁcient.Thesetechniqueshavebeenproposed[10,17]andevaluated[17]inthecontextofmetric-pairmodels.OurRatioScoreal-gorithmisalsoavariantoftheJaccardcoefﬁcientandisoutperformedbyourSigScorealgorithm.TheJaccardcoef-ﬁcientisalsousedinPinPoint[1],whichenablesdiagnosisofcomponentsbasedontheircorrelationwithanomaloustransactions.Pinpoint,however,reliesontracinguserre-queststhroughthesystem,whileweusemanagementmet-rics.Collectingrequesttracesismuchmoreexpensivethanmanagementmetricsandisnotstudiedinourwork.Oneothertrendtoimprovethediagnosisistolearnfromknownfaults.Typically,supervisedlearningisusedsuchthatanyrecurrentfaultsmaybeidentiﬁedquickly.Suchmethods[2,3,11]useeitherBayesianorneuralnetworkstolearnfaultsymptomsfromlabeleddata.Whilesuchef-fortssigniﬁcantlyimprovethediagnosis,theyhaveimpor-tantshortcomings:labeleddatamaynotbeavailableandonlyknownfaultscanbeidentiﬁed.WeconstructaMarkovprocessmodelandﬁndtherel-ativesigniﬁcanceofsystemcomponentsbasedoncompo-nentdependencies.ThisissimilartothePageRank[6]algo-rithmforwebsearch.Inadifferentcontext,Inoueetal.[8]useanalgorithmsimilartoPageRanktoidentifygenericcomponentsofasystemtoimprovesoftwarere-usability.7ConclusionsandFutureWorkInthispaperwepresentanapproach,builtoninformation-theoreticmeasures,toautomaticallymonitorthehealthofcomplexsoftwaresystemsandlocalizefaultycomponentswhenfaultsoccur.WeemploytheWilcoxonRank-Sumtesttoautomaticallyidentifysigniﬁcantchangesinclusterentropy,therebyenablingrobustfaultdetection.Fordiagnosingfaultycomponents,weextendtheuseoftheJaccardcoefﬁcienttoclustersofmetrics.Inaddition,weproposeSigScore,adiagnosisalgorithmmotivatedbyPageRank,whichimprovesonthealgorithmbasedontheJaccardcoefﬁcient.Weevaluateourapproachusingare-alistictest-bedconsistingofamulti-tierenterprisesoft-waresystem.Weshowthroughexperimentsthatourfault-detectionapproachhashighfaultcoverageandlowfalse-alarmrate.Wealsoshowimprovementindiagnosisob-tainedbyusingSigScore.Ourresultsindicatethatthepro-poseddiagnosisalgorithmcanprovidevaluablehelpforad-dressingfaultsincomplexsystems.TheSigScorealgorithmrequiresinformationoncompo-nentdependencies.However,completedependencyinfor-mationmaynotalwaysbeavailable.Also,indynamicsys-tems,dependenciesmaychange.Studyingtheeffectofin-accuratedependencyinformationondiagnosisispartofourfuturework.References[1]M.Y.Chen,E.Kiciman,E.Fratkin,A.Fox,andE.A.Brewer.Pinpoint:Problemdeterminationinlarge,dynamicinternetservices.InDSN,pages595–604,2002.[2]I.Cohen,S.Zhang,M.Goldszmidt,J.Symons,T.Kelly,andA.Fox.Capturing,indexing,clustering,andretrievingsystemhistory.InSOSP,pages105–118,2005.[3]S.GhanbariandC.Amza.Semantic-drivenmodelcompo-sitionforaccurateanomalydiagnosis.InICAC,2008.[4]Z.Guo,G.Jiang,H.Chen,andK.Yoshihira.Trackingprob-abilisticcorrelationofmonitoringdataforfaultdetectionincomplexsystems.InDSN,pages259–268,2006.[5]J.HanandM.Kamber.DataMining:ConceptsandTech-niques.MorganKaufmann,2ndedition,2006.[6]J.HanandM.Kamber.Google’sPagerankandBeyond:TheScienceofSearchEngineRankings.PrincetonUniversityPress,2006.[7]IBMCorporation.IBMTradePerformanceBenchmark.http://www-01.ibm.com/software/webservers/appserv/-was/performance.html.[8]K.Inoue,R.Yokomori,H.Rujiwara,T.Yamamoto,M.Mat-sushita,andS.Kusumoto.Componentrank:relativesignif-icancerankforsoftwarecomponentsearch.InICSE,2003.[9]G.Jiang,H.Chen,andK.Yoshihira.Discoveringlikelyinvariantsofdistributedtransactionsystemsforautonomicsystemmanagement.InICAC,2006.[10]G.Jiang,H.Chen,andK.Yoshihira.Modelingandtrackingoftransactionﬂowdynamicsforfaultdetectionincomplexsystems.IEEETrans.onDependableandSecureComput-ing,3(4):312–326,2006.[11]M.Jiang,M.A.Munawar,T.Reidemeister,andP.A.S.Ward.Detectionanddiagnosisofrecurrentfaultsinsoft-waresystemsbyinvariantanalysis.InHASE,2008.[12]M.Jiang,M.A.Munawar,T.Reidemeister,andP.A.S.Ward.Information-theoreticmodelingfortrackingthehealthofcomplexsoftwaresystems.InCASCON,2008.[13]J.O.KephartandD.M.Chess.Thevisionofautonomiccomputing.IEEEComputer,36(1):41–50,2003.[14]D.M.Levine,C.P.P.Ramsey,andR.K.Smidt.AppliedStatisticsforEngineersandScientists.PrenticeHall,2000.[15]M.A.MunawarandP.A.Ward.Adaptivemonitoringinenterprisesoftwaresystems.InSysML,June2006.[16]M.A.MunawarandP.A.Ward.Acomparativestudyofpairwiseregressiontechniquesforproblemdetermination.InCASCON,pages152–166,2007.[17]M.A.MunawarandP.A.Ward.Leveragingmanysimplestatisticalmodelstoadaptivelymonitorsoftwaresystems.InISPA,2007.[18]C.E.Shannon.Amathematicaltheoryofcommunication.KeyPapersintheDevelopmentofInformationTheory,1948.[19]A.StrehlandJ.Ghosh.Clusterensembles–aknowledgereuseframeworkforcombiningmultiplepartitions.JournalonMachineLearningResearch,3:583–617,Dec2002.