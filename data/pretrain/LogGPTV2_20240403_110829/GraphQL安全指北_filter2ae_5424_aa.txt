# GraphQLå®‰å…¨æŒ‡åŒ—
##### è¯‘æ–‡å£°æ˜Ž
æœ¬æ–‡æ˜¯ç¿»è¯‘æ–‡ç« 
è¯‘æ–‡ä»…ä¾›å‚è€ƒï¼Œå…·ä½“å†…å®¹è¡¨è¾¾ä»¥åŠå«ä¹‰åŽŸæ–‡ä¸ºå‡†ã€‚
è”åä½œè€…ï¼šgyyyy & å›¾å—
>
> ä»Šå¹´å…ˆçŸ¥å¤§ä¼šä¸Špç‰›åˆ†äº«äº†ä¸€äº›å…³äºŽGraphQLå®‰å…¨çš„å†…å®¹ï¼Œæˆ‘æ­£å¥½æœ‰ä½¿ç”¨GraphQLï¼ŒäºŽæ˜¯æƒ³å†™ä¸€äº›æˆ‘å¯¹GraphQLå®‰å…¨çš„ä¸€äº›ç†è§£å’Œçœ‹æ³•ï¼Œå’Œå¥½åŸºå‹`[@gyyyy](https://github.com/gyyyy
> "@gyyyy")` è¯´äº†è¿™ä¸ªæƒ³æ³•ä¹‹åŽä¸€æ‹å³åˆï¼ŒäºŽæ˜¯è”æ‰‹å†™äº†è¿™ç¯‡æ–‡ã€‚æˆ‘ä¿©æ°´å¹³æœ‰é™ï¼Œä¸è¶³ä¹‹å¤„è¯·æ‰¹è¯„æŒ‡æ­£ã€‚
## è¯´åœ¨å‰é¢çš„è¯
æœ¬æ–‡ä»¥GraphQLä¸­ä¸€äº›å®¹æ˜“è®©åˆå­¦è€…ä¸Žå…¸åž‹Web API _ï¼ˆä¸ºäº†ä¾¿äºŽç†è§£ï¼Œä¸‹æ–‡ä»¥ç›®å‰æµè¡Œçš„RESTful APIä¸ºä¾‹ä»£æŒ‡ï¼‰_
æ··æ·†æˆ–é”™è¯¯ç†è§£çš„æ¦‚å¿µç‰¹æ€§è¿›è¡Œå†…å®¹åˆ’åˆ†ï¼Œç”±`[@gyyyy](https://github.com/gyyyy "@gyyyy")`
ä»Žå®‰å…¨çš„è§’åº¦æŠ›å‡ºGraphQLåº”è¯¥æ³¨æ„çš„å‡ ç‚¹å®‰å…¨é—®é¢˜ï¼Œè€Œæˆ‘åˆ™ä¼šæ›´å¤šçš„ä»Žå¼€å‘çš„è§’åº¦ç»™å‡ºè‡ªå·±åœ¨å®žé™…ä½¿ç”¨è¿‡ç¨‹ä¸­æ€»ç»“çš„æœ€ä½³å®žè·µã€‚
å¦å¤–ï¼Œéœ€è¦æå‰å£°æ˜Žçš„æ˜¯ï¼Œæœ¬æ–‡ä¸­æˆ‘ä½¿ç”¨çš„æ˜¯Node.jsï¼Œ`[@gyyyy](https://github.com/gyyyy "@gyyyy")`
ä½¿ç”¨çš„åŽç«¯å¼€å‘è¯­è¨€æ˜¯Goï¼Œå‰ç«¯ç»Ÿä¸€ä¸ºReact _ï¼ˆGraphQLå®¢æˆ·ç«¯ä¸ºApolloï¼‰_ ï¼Œè¯·å¤§å®¶è‡ªè¡Œæ¶ˆåŒ–ã€‚
Letâ€™s Go!
## GraphQLç®€ä»‹
æœ‰äº›åŒå­¦æ˜¯ä¸æ˜¯æ ¹æœ¬æ²¡å¬è¿‡è¿™ä¸ªçŽ©æ„ï¼Ÿæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ­£åœ¨ä½¿ç”¨å®ƒçš„å¤§å®¢æˆ·ä»¬ï¼š
æ˜¯ä¸æ˜¯å€¼å¾—æˆ‘ä»¬èŠ±å‡ åˆ†é’Ÿå¯¹å®ƒåšä¸ªç®€å•çš„äº†è§£äº†ï¼ŸXD
### **ä»€ä¹ˆæ˜¯GraphQL**
ç®€å•çš„è¯´ï¼ŒGraphQLæ˜¯ç”±Facebookåˆ›é€ å¹¶å¼€æºçš„ä¸€ç§ç”¨äºŽAPIçš„æŸ¥è¯¢è¯­è¨€ã€‚
å†å¼•ç”¨å®˜æ–¹æ–‡æ¡ˆæ¥å¸®åŠ©å¤§å®¶ç†è§£ä¸€ä¸‹GraphQLçš„ç‰¹ç‚¹ï¼š
1.è¯·æ±‚ä½ æ‰€è¦çš„æ•°æ®ï¼Œä¸å¤šä¸å°‘
å‘ä½ çš„APIå‘å‡ºä¸€ä¸ªGraphQLè¯·æ±‚å°±èƒ½å‡†ç¡®èŽ·å¾—ä½ æƒ³è¦çš„æ•°æ®ï¼Œä¸å¤šä¸å°‘ã€‚GraphQLæŸ¥è¯¢æ€»æ˜¯è¿”å›žå¯é¢„æµ‹çš„ç»“æžœã€‚ä½¿ç”¨GraphQLçš„åº”ç”¨å¯ä»¥å·¥ä½œå¾—åˆå¿«åˆç¨³ï¼Œå› ä¸ºæŽ§åˆ¶æ•°æ®çš„æ˜¯åº”ç”¨ï¼Œè€Œä¸æ˜¯æœåŠ¡å™¨
2.èŽ·å–å¤šä¸ªèµ„æºï¼Œåªç”¨ä¸€ä¸ªè¯·æ±‚
GraphQLæŸ¥è¯¢ä¸ä»…èƒ½å¤ŸèŽ·å¾—èµ„æºçš„å±žæ€§ï¼Œè¿˜èƒ½æ²¿ç€èµ„æºé—´å¼•ç”¨è¿›ä¸€æ­¥æŸ¥è¯¢ã€‚å…¸åž‹çš„RESTful
APIè¯·æ±‚å¤šä¸ªèµ„æºæ—¶å¾—è½½å…¥å¤šä¸ªURLï¼Œè€ŒGraphQLå¯ä»¥é€šè¿‡ä¸€æ¬¡è¯·æ±‚å°±èŽ·å–ä½ åº”ç”¨æ‰€éœ€çš„æ‰€æœ‰æ•°æ®
3.æè¿°æ‰€æœ‰çš„å¯èƒ½ï¼Œç±»åž‹ç³»ç»Ÿ
GraphQLåŸºäºŽç±»åž‹å’Œå­—æ®µçš„æ–¹å¼è¿›è¡Œç»„ç»‡ï¼Œè€Œéžå…¥å£ç«¯ç‚¹ã€‚ä½ å¯ä»¥é€šè¿‡ä¸€ä¸ªå•ä¸€å…¥å£ç«¯ç‚¹å¾—åˆ°ä½ æ‰€æœ‰çš„æ•°æ®èƒ½åŠ›ã€‚GraphQLä½¿ç”¨ç±»åž‹æ¥ä¿è¯åº”ç”¨åªè¯·æ±‚å¯èƒ½çš„æ•°æ®ï¼Œè¿˜æä¾›äº†æ¸…æ™°çš„è¾…åŠ©æ€§é”™è¯¯ä¿¡æ¯
### **GraphQLæ ¸å¿ƒç»„æˆéƒ¨åˆ†**
1.Type
ç”¨äºŽæè¿°æŽ¥å£çš„æŠ½è±¡æ•°æ®æ¨¡åž‹ï¼Œæœ‰Scalar _ï¼ˆæ ‡é‡ï¼‰_ å’ŒObject _ï¼ˆå¯¹è±¡ï¼‰_ ä¸¤ç§ï¼ŒObjectç”±Fieldç»„æˆï¼ŒåŒæ—¶Fieldä¹Ÿæœ‰è‡ªå·±çš„Type
2.Schema
ç”¨äºŽæè¿°æŽ¥å£èŽ·å–æ•°æ®çš„é€»è¾‘ï¼Œç±»æ¯”RESTfulä¸­çš„æ¯ä¸ªç‹¬ç«‹èµ„æºURI
3.Query
ç”¨äºŽæè¿°æŽ¥å£çš„æŸ¥è¯¢ç±»åž‹ï¼Œæœ‰Query _ï¼ˆæŸ¥è¯¢ï¼‰_ ã€Mutation _ï¼ˆæ›´æ”¹ï¼‰_ å’ŒSubscription _ï¼ˆè®¢é˜…ï¼‰_ ä¸‰ç§
4.Resolver
ç”¨äºŽæè¿°æŽ¥å£ä¸­æ¯ä¸ªQueryçš„è§£æžé€»è¾‘ï¼Œéƒ¨åˆ†GraphQLå¼•æ“Žè¿˜æä¾›Fieldç»†ç²’åº¦çš„Resolver
_ï¼ˆæƒ³è¦è¯¦ç»†äº†è§£çš„åŒå­¦è¯·é˜…è¯»GraphQLå®˜æ–¹æ–‡æ¡£ï¼‰_
### **GraphQL VS. RESTful**
GraphQLæ²¡æœ‰è¿‡å¤šä¾èµ–HTTPåè®®ï¼Œå®ƒæœ‰ä¸€å¥—è‡ªå·±çš„è§£æžå¼•æ“Žæ¥å¸®åŠ©å‰åŽç«¯ä½¿ç”¨GraphQLæŸ¥è¯¢è¯­æ³•ã€‚åŒæ—¶å®ƒæ˜¯å•è·¯ç”±å½¢æ€ï¼ŒæŸ¥è¯¢å†…å®¹å®Œå…¨æ ¹æ®å‰ç«¯è¯·æ±‚å¯¹è±¡å’Œå­—æ®µè€Œå®šï¼Œå‰åŽç«¯åˆ†ç¦»è¾ƒæ˜Žæ˜¾ã€‚
ç”¨ä¸€å¼ å›¾æ¥å¯¹æ¯”ä¸€ä¸‹ï¼š
## èº«ä»½è®¤è¯ä¸Žæƒé™æŽ§åˆ¶ä¸å½“
> [@gyyyy](https://github.com/gyyyy "@gyyyy")ï¼š  
>
> å‰é¢è¯´åˆ°ï¼ŒGraphQLå¤šäº†ä¸€ä¸ªä¸­é—´å±‚å¯¹å®ƒå®šä¹‰çš„æŸ¥è¯¢è¯­è¨€è¿›è¡Œè¯­æ³•è§£æžæ‰§è¡Œç­‰æ“ä½œï¼Œä¸ŽRESTfulè¿™ç§å……åˆ†åˆ©ç”¨HTTPåè®®æœ¬èº«ç‰¹æ€§å®Œæˆå£°æ˜Žä½¿ç”¨çš„APIè®¾è®¡ä¸åŒï¼ŒSchemaã€Resolverç­‰ç§ç§å®šä¹‰ä¼šè®©å¼€å‘è€…å¯¹å®ƒçš„å­˜åœ¨æ„ŸçŸ¥è¾ƒå¤§ï¼Œé—´æŽ¥çš„å¢žåŠ äº†å¯¹å®ƒç†è§£çš„å¤æ‚åº¦ï¼ŒåŠ ä¸Šå®ƒæœ¬èº«çš„å•è·¯ç”±å½¢æ€ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´å¼€å‘è€…åœ¨ä¸å®Œå…¨äº†è§£å…¶ç‰¹æ€§å’Œå†…éƒ¨è¿è¡Œæœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œé”™è¯¯å®žçŽ°ç”šè‡³å¿½ç•¥APIè°ƒç”¨æ—¶çš„æŽˆæƒé‰´æƒè¡Œä¸ºã€‚
åœ¨å®˜æ–¹çš„æè¿°ä¸­ï¼ŒGraphQLå’ŒRESTful APIä¸€æ ·ï¼Œå»ºè®®å¼€å‘è€…å°†æŽˆæƒé€»è¾‘å§”æ‰˜ç»™ä¸šåŠ¡é€»è¾‘å±‚ï¼š
åœ¨æ²¡æœ‰å¯¹GraphQLä¸­å„ä¸ªQueryå’ŒMutationåšå¥½æŽˆæƒé‰´æƒæ—¶ï¼ŒåŒæ ·å¯èƒ½ä¼šè¢«æ”»å‡»è€…éžæ³•è¯·æ±‚åˆ°ä¸€äº›éžé¢„æœŸæŽ¥å£ï¼Œæ‰§è¡Œé«˜å±æ“ä½œï¼Œå¦‚æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ï¼š
        query GetAllUsers {
            users {
                _id
                username
                password
                idCard
                mobilePhone
                email
            }
        }
è¿™å‡ ä¹Žæ˜¯ä½¿ç”¨ä»»ä½•APIæŠ€æœ¯éƒ½æ— æ³•é¿å…çš„ä¸€ä¸ªå®‰å…¨é—®é¢˜ï¼Œå› ä¸ºå®ƒä¸ŽAPIæœ¬èº«çš„èŒèƒ½å¹¶æ²¡æœ‰å¤ªå¤§çš„å…³ç³»ï¼ŒAPIä¸éœ€è¦èƒŒè¿™ä¸ªé”…ï¼Œä½†ç”±æ­¤é—®é¢˜å¸¦æ¥çš„å¹¶å‘ç—‡å´ä¸å®¹å°è§‘ã€‚
### **ä¿¡æ¯æ³„éœ²**
å¯¹äºŽè¿™ç§æœªæŽˆæƒæˆ–è¶Šæƒè®¿é—®æ¼æ´žçš„æŒ–æŽ˜åˆ©ç”¨æ–¹å¼ï¼Œå¤§å®¶ä¸€å®šéƒ½å¾ˆæ¸…æ¥šäº†ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬éƒ½ä¼šæœŸæœ›å°½å¯èƒ½èŽ·å–åˆ°æ¯”è¾ƒå…¨é‡çš„APIæ¥è¿›è¡Œè¿›ä¸€æ­¥çš„åˆ†æžã€‚åœ¨RESTful
APIä¸­ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦é€šè¿‡ä»£ç†ã€çˆ¬è™«ç­‰æŠ€æœ¯æ¥æŠ“å–APIã€‚è€Œéšç€Web
2.0æ—¶ä»£çš„åˆ°æ¥ï¼Œå„ç§å¼ºå¤§çš„å‰ç«¯æ¡†æž¶ã€è¿è¡Œæ—¶DOMäº‹ä»¶æ›´æ–°ç­‰æŠ€æœ¯ä½¿ç”¨é¢‘çŽ‡çš„å¢žåŠ ï¼Œæ›´ä½¿å¾—æˆ‘ä»¬ä¸å¾—ä¸åŠ¨ç”¨åˆ°å¦‚Headlessç­‰æŠ€æœ¯æ¥æé«˜å¯¹APIçš„èŽ·å–è¦†ç›–çŽ‡ã€‚
ä½†ä¸ŽRESTful APIä¸åŒçš„æ˜¯ï¼ŒGraphQLè‡ªå¸¦å¼ºå¤§çš„å†…çœè‡ªæ£€æœºåˆ¶ï¼Œå¯ä»¥ç›´æŽ¥èŽ·å–åŽç«¯å®šä¹‰çš„æ‰€æœ‰æŽ¥å£ä¿¡æ¯ã€‚æ¯”å¦‚é€šè¿‡`__schema`æŸ¥è¯¢æ‰€æœ‰å¯ç”¨å¯¹è±¡ï¼š
        {
            __schema {
                types {
                    name
                }
            }
        }
é€šè¿‡`__type`æŸ¥è¯¢æŒ‡å®šå¯¹è±¡çš„æ‰€æœ‰å­—æ®µï¼š
        {
            __type(name: "User") {
                name
                fields {
                    name
                    type {
                        name
                    }
                }
            }
        }
è¿™é‡Œæˆ‘é€šè¿‡[graphql-go/graphql](https://github.com/graphql-go/graphql/)çš„æºç ç®€å•åˆ†æžä¸€ä¸‹GraphQLçš„è§£æžæ‰§è¡Œæµç¨‹å’Œå†…çœæœºåˆ¶ï¼Œå¸®åŠ©å¤§å®¶åŠ æ·±ç†è§£ï¼š
  1. GraphQLè·¯ç”±èŠ‚ç‚¹åœ¨æ‹¿åˆ°HTTPçš„è¯·æ±‚å‚æ•°åŽï¼Œåˆ›å»º`Params`å¯¹è±¡ï¼Œå¹¶è°ƒç”¨`Do()`å®Œæˆè§£æžæ‰§è¡Œæ“ä½œè¿”å›žç»“æžœï¼š 
             params := graphql.Params{
             Schema:         *h.Schema,
             RequestString:  opts.Query,
             VariableValues: opts.Variables,
             OperationName:  opts.OperationName,
             Context:        ctx,
         }
         result := graphql.Do(params)
  2. è°ƒç”¨`Parser()`æŠŠ`params.RequestString`è½¬æ¢ä¸ºGraphQLçš„ASTæ–‡æ¡£åŽï¼Œå°†ASTå’ŒSchemaä¸€èµ·äº¤ç»™`ValidateDocument()`è¿›è¡Œæ ¡éªŒ _ï¼ˆä¸»è¦æ ¡éªŒæ˜¯å¦ç¬¦åˆSchemaå®šä¹‰çš„å‚æ•°ã€å­—æ®µã€ç±»åž‹ç­‰ï¼‰_
  3. ä»£å…¥ASTé‡æ–°å°è£…`ExecuteParams`å¯¹è±¡ï¼Œä¼ å…¥`Execute()`ä¸­å¼€å§‹æ‰§è¡Œå½“å‰GraphQLè¯­å¥
å…·ä½“çš„æ‰§è¡Œç»†èŠ‚å°±ä¸å±•å¼€äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å…³å¿ƒçš„å†…çœåŽ»å“ªäº†ï¼ŸåŽŸæ¥åœ¨GraphQLå¼•æ“Žåˆå§‹åŒ–æ—¶ï¼Œä¼šå®šä¹‰ä¸‰ä¸ªå¸¦ç¼ºçœResolverçš„å…ƒå­—æ®µï¼š
    SchemaMetaFieldDef = &FieldDefinition{ // __schemaï¼šæŸ¥è¯¢å½“å‰ç±»åž‹å®šä¹‰çš„æ¨¡å¼ï¼Œæ— å‚æ•°
            Name:        "__schema",
            Type:        NewNonNull(SchemaType),
            Description: "Access the current type schema of this server.",
            Args:        []*Argument{},
            Resolve: func(p ResolveParams) (interface{}, error) {
                return p.Info.Schema, nil
            },
        }
        TypeMetaFieldDef = &FieldDefinition{ // __typeï¼šæŸ¥è¯¢æŒ‡å®šç±»åž‹çš„è¯¦ç»†ä¿¡æ¯ï¼Œå­—ç¬¦ä¸²ç±»åž‹å‚æ•°`name`
            Name:        "__type",
            Type:        TypeType,
            Description: "Request the type information of a single type.",
            Args: []*Argument{
                {
                    PrivateName: "name",
                    Type:        NewNonNull(String),
                },
            },
            Resolve: func(p ResolveParams) (interface{}, error) {
                name, ok := p.Args["name"].(string)
                if !ok {
                    return nil, nil
                }
                return p.Info.Schema.Type(name), nil
            },
        }
        TypeNameMetaFieldDef = &FieldDefinition{ // __typenameï¼šæŸ¥è¯¢å½“å‰å¯¹è±¡ç±»åž‹åç§°ï¼Œæ— å‚æ•°
            Name:        "__typename",
            Type:        NewNonNull(String),
            Description: "The name of the current Object type at runtime.",
            Args:        []*Argument{},
            Resolve: func(p ResolveParams) (interface{}, error) {
                return p.Info.ParentType.Name(), nil
            },
        }
å½“`resolveField()`è§£æžåˆ°å…ƒå­—æ®µæ—¶ï¼Œä¼šè°ƒç”¨å…¶ç¼ºçœResolverï¼Œè§¦å‘GraphQLçš„å†…çœé€»è¾‘ã€‚
### **è‡ªåŠ¨ç»‘å®šï¼ˆéžé¢„æœŸå’ŒåºŸå¼ƒå­—æ®µï¼‰**
GraphQLä¸ºäº†è€ƒè™‘æŽ¥å£åœ¨ç‰ˆæœ¬æ¼”è¿›æ—¶èƒ½å¤Ÿå‘ä¸‹å…¼å®¹ï¼Œè¿˜æœ‰ä¸€ä¸ªå¯¹äºŽåº”ç”¨å¼€å‘è€Œè¨€æ¯”è¾ƒå‹å–„çš„ç‰¹æ€§ï¼šâ€˜APIæ¼”è¿›æ— éœ€åˆ’åˆ†ç‰ˆæœ¬â€™ã€‚
ç”±äºŽGraphQLæ˜¯æ ¹æ®å‰ç«¯è¯·æ±‚çš„å­—æ®µè¿›è¡Œæ•°æ®å›žä¼ ï¼ŒåŽç«¯Resolverçš„å“åº”åŒ…å«å¯¹åº”å­—æ®µå³å¯ï¼Œå› æ­¤åŽç«¯å­—æ®µæ‰©å±•å¯¹å‰ç«¯æ— æ„ŸçŸ¥æ— å½±å“ï¼Œå‰ç«¯å¢žåŠ æŸ¥è¯¢å­—æ®µä¹Ÿåªè¦åœ¨åŽç«¯å®šä¹‰çš„å­—æ®µèŒƒå›´å†…å³å¯ã€‚åŒæ—¶GraphQLä¹Ÿä¸ºå­—æ®µåˆ é™¤æä¾›äº†â€˜åºŸå¼ƒâ€™æ–¹æ¡ˆï¼Œå¦‚Goçš„`graphql`åŒ…åœ¨å­—æ®µä¸­å¢žåŠ `DeprecationReason`å±žæ€§ï¼ŒApolloçš„`[@deprecated](https://github.com/deprecated
"@deprecated")`æ ‡è¯†ç­‰ã€‚
è¿™ç§ç‰¹æ€§éžå¸¸æ–¹ä¾¿çš„å°†å‰åŽç«¯è¿›è¡Œäº†åˆ†ç¦»ï¼Œä½†å¦‚æžœå¼€å‘è€…æœ¬èº«å®‰å…¨æ„è¯†ä¸å¤Ÿå¼ºï¼Œè®¾è®¡çš„APIä¸å¤Ÿåˆç†ï¼Œå°±ä¼šåŸ‹ä¸‹äº†å¾ˆå¤šå®‰å…¨éšæ‚£ã€‚æˆ‘ä»¬ç”¨å¼€å‘é¡¹ç›®ä¸­å¯èƒ½ä¼šç»å¸¸é‡åˆ°çš„éœ€æ±‚åœºæ™¯æ¥é‡çŽ°ä¸€ä¸‹ã€‚
å‡è®¾å°æ˜Žåœ¨åº”ç”¨ä¸­å·²ç»å®šä¹‰å¥½äº†æŸ¥è¯¢ç”¨æˆ·åŸºæœ¬ä¿¡æ¯çš„APIï¼š
    graphql.Field{
            Type: graphql.NewObject(graphql.ObjectConfig{
                Name:        "User",
                Description: "ç”¨æˆ·ä¿¡æ¯",
                Fields: graphql.Fields{
                    "_id": &graphql.Field{Type: graphql.Int},
                    "username": &graphql.Field{Type: graphql.String},
                    "email": &graphql.Field{Type: graphql.String},
                },
            }),
            Args: graphql.FieldConfigArgument{
                "username": &graphql.ArgumentConfig{Type: graphql.String},
            },
            Resolve: func(params graphql.ResolveParams) (result interface{}, err error) {
                // ...
            },
        }
å°æ˜ŽèŽ·å¾—æ–°çš„éœ€æ±‚æè¿°ï¼Œâ€˜ç®¡ç†å‘˜å¯ä»¥æŸ¥è¯¢æŒ‡å®šç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯â€™ï¼Œä¸ºäº†æ–¹ä¾¿ _ï¼ˆä¹Ÿç»å¸¸ä¼šä¸ºäº†æ–¹ä¾¿ï¼‰_ ï¼ŒäºŽæ˜¯åœ¨åŽŸæœ‰æŽ¥å£ä¸Šæ–°å¢žäº†å‡ ä¸ªå­—æ®µï¼š
    graphql.Field{
            Type: graphql.NewObject(graphql.ObjectConfig{
                Name:        "User",
                Description: "ç”¨æˆ·ä¿¡æ¯",
                Fields: graphql.Fields{
                    "_id": &graphql.Field{Type: graphql.Int},
                    "username": &graphql.Field{Type: graphql.String},
                    "password": &graphql.Field{Type: graphql.String}, // æ–°å¢ž ç”¨æˆ·å¯†ç  å­—æ®µ
                    "idCard": &graphql.Field{Type: graphql.String}, // æ–°å¢ž ç”¨æˆ·èº«ä»½è¯å· å­—æ®µ
                    "mobilePhone": &graphql.Field{Type: graphql.String}, // æ–°å¢ž ç”¨æˆ·æ‰‹æœºå· å­—æ®µ
                    "email": &graphql.Field{Type: graphql.String},
                },
            }),
            Args: graphql.FieldConfigArgument{
                "username": &graphql.ArgumentConfig{Type: graphql.String},
            },
            Resolve: func(params graphql.ResolveParams) (result interface{}, err error) {
                // ...
            },
        }
å¦‚æžœæ­¤æ—¶å°æ˜Žæ²¡æœ‰åœ¨å­—æ®µç»†ç²’åº¦ä¸Šè¿›è¡Œæƒé™æŽ§åˆ¶ _ï¼ˆä¹Ÿæš‚æ—¶å¿½ç•¥å…¶ä»–æƒé™é—®é¢˜ï¼‰_
ï¼Œæ”»å‡»è€…å¯ä»¥è½»æ˜“çš„é€šè¿‡å†…çœå‘çŽ°è¿™å‡ ä¸ªæœ¬ä¸è¯¥è¢«æ™®é€šç”¨æˆ·æŸ¥çœ‹åˆ°çš„å­—æ®µï¼Œå¹¶æž„é€ è¯·æ±‚è¿›è¡ŒæŸ¥è¯¢
_ï¼ˆå®žé™…å¼€å‘ä¸­ä¹Ÿç»å¸¸å®¹æ˜“é—ç•™ä¸€äº›æµ‹è¯•å­—æ®µï¼Œåœ¨GraphQLå¼ºå¤§çš„å†…çœæœºåˆ¶é¢å‰è¿™æ— ç–‘æ˜¯éžå¸¸å±é™©çš„ã€‚å¦‚æžœç†Ÿæ‚‰Springè‡ªåŠ¨ç»‘å®šæ¼æ´žçš„åŒå­¦ï¼Œä¹Ÿä¼šå‘çŽ°å®ƒä»¬ä¹‹é—´æœ‰ä¸€éƒ¨åˆ†ç›¸ä¼¼çš„åœ°æ–¹ï¼‰_
ã€‚
æ•…äº‹ç»§ç»­ï¼Œå½“å°æ˜Žå‘çŽ°è¿™ç§åšæ³•æ¬ å¦¥æ—¶ï¼Œä»–å†³å®šåºŸå¼ƒè¿™å‡ ä¸ªå­—æ®µï¼š
    // ...
        "password": &graphql.Field{Type: graphql.String, DeprecationReason: "å®‰å…¨æ€§é—®é¢˜"},
        "idCard": &graphql.Field{Type: graphql.String, DeprecationReason: "å®‰å…¨æ€§é—®é¢˜"},
        "mobilePhone": &graphql.Field{Type: graphql.String, DeprecationReason: "å®‰å…¨æ€§é—®é¢˜"},
        // ...
æŽ¥ç€ï¼Œä»–åˆç”¨ä¸Šé¢çš„`__type`åšäº†ä¸€æ¬¡å†…çœï¼Œå¾ˆå¥½ï¼ŒåºŸå¼ƒå­—æ®µæŸ¥ä¸åˆ°äº†ï¼Œé€šçŸ¥å‰ç«¯å›žæ»šæŸ¥è¯¢è¯­å¥ï¼Œé—®é¢˜è§£å†³ï¼Œä¸‹ç­å›žå®¶ _ï¼ˆGraphQLçš„ä¼˜åŠ¿ç«‹åˆ»å‡¸æ˜¾å‡ºæ¥ï¼‰_
ã€‚
ç†Ÿæ‚‰å®‰å…¨æ”»é˜²å¥—è·¯çš„åŒå­¦éƒ½çŸ¥é“ï¼Œå¾ˆå¤šçš„æ”»å‡»æ–¹å¼ _ï¼ˆå°¤å…¶åœ¨Webå®‰å…¨ä¸­ï¼‰_ éƒ½æ˜¯åˆ©ç”¨äº†å¼€å‘ã€æµ‹è¯•ã€è¿ç»´çš„çŸ¥è¯†ç›²ç‚¹
_ï¼ˆå¦‚æžœä½ æƒ³é—®è¿™äº›ç›²ç‚¹çš„äº§ç”ŸåŽŸå› ï¼Œæˆ‘åªèƒ½è¯´æ˜¯å› ä¸ºæ­£å¸¸æƒ…å†µä¸‹æ ¹æœ¬ç”¨ä¸åˆ°ï¼Œæ‰€ä»¥ä¸æ·±å…¥ç ”ç©¶åŸºæœ¬ä¸ä¼šåŽ»åˆ»æ„å…³æ³¨ï¼‰_
ã€‚å¦‚æžœå¼€å‘è€…æ²¡æœ‰å¾ˆä»”ç»†çš„é˜…è¯»GraphQLå®˜æ–¹æ–‡æ¡£ï¼Œç‰¹åˆ«æ˜¯å†…çœè¿™ä¸€ç« èŠ‚çš„å†…å®¹ï¼Œå°±å¯èƒ½ä¸çŸ¥é“ï¼Œé€šè¿‡æŒ‡å®š`includeDeprecated`å‚æ•°ä¸º`true`ï¼Œ`__type`ä»ç„¶å¯ä»¥å°†åºŸå¼ƒå­—æ®µæš´éœ²å‡ºæ¥ï¼š
        {
            __type(name: "User") {
                name
                fields(includeDeprecated: true) {
                    name
                    isDeprecated
                    type {
                        name
                    }
                }
            }
        }
è€Œä¸”ç”±äºŽå°æ˜Žæ²¡æœ‰å¯¹Resolveråšä¿®æ”¹ï¼ŒåºŸå¼ƒå­—æ®µä»ç„¶å¯ä»¥æ­£å¸¸å‚ä¸ŽæŸ¥è¯¢ _ï¼ˆå…¼å®¹æ€§æƒ¹çš„ç¥¸ï¼‰_ ï¼Œæ•…äº‹ç»“æŸã€‚
æ­£å¦‚pç‰›æ‰€è¨€ï¼Œâ€˜GraphQLæ˜¯ä¸€é—¨è‡ªå¸¦æ–‡æ¡£çš„æŠ€æœ¯â€™ã€‚å¯è¿™ä¹Ÿä½¿å¾—æŽˆæƒé‰´æƒçŽ¯èŠ‚ä¸€æ—¦å‡ºçŽ°çº°æ¼ï¼ŒGraphQLèƒŒåŽçš„åº”ç”¨æ‰€é¢ä¸´çš„å®‰å…¨é£Žé™©ä¼šæ¯”å…¸åž‹Web
APIå¤§å¾—å¤šã€‚
> @å›¾å—ï¼š  
>
> GraphQLå¹¶æ²¡æœ‰è§„å®šä»»ä½•èº«ä»½è®¤è¯å’Œæƒé™æŽ§åˆ¶çš„ç›¸å…³å†…å®¹ï¼Œè¿™æ˜¯ä¸ªå¥½äº‹æƒ…ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥æ›´çµæ´»çš„åœ¨åº”ç”¨ä¸­å®žçŽ°å„ç§ç²’åº¦çš„è®¤è¯å’Œæƒé™ã€‚ä½†æ˜¯ï¼Œåœ¨æˆ‘çš„å¼€å‘è¿‡ç¨‹ä¸­å‘çŽ°ï¼Œåˆå­¦è€…ç»å¸¸ä¼šå¿½ç•¥GraphQLçš„è®¤è¯ï¼Œä¼šå†™å‡ºä¸€äº›è£¸å¥”çš„æŽ¥å£æˆ–è€…æ— æ•ˆè®¤è¯çš„æŽ¥å£ã€‚é‚£ä¹ˆæˆ‘å°±åœ¨è¿™é‡Œè¯¦ç»†è¯´ä¸€ä¸‹GraphQLçš„è®¤è¯æ–¹å¼ã€‚
### **ç‹¬ç«‹è®¤è¯ç»ˆç«¯ _ï¼ˆRESTfulï¼‰_**
å¦‚æžœåŽç«¯æœ¬èº«æ”¯æŒRESTfulæˆ–è€…æœ‰ä¸“é—¨çš„è®¤è¯æœåŠ¡å™¨ï¼Œå¯ä»¥ä¿®æ”¹å°‘é‡ä»£ç å°±èƒ½å®žçŽ°GraphQLæŽ¥å£çš„è®¤è¯ã€‚è¿™ç§è®¤è¯æ–¹å¼æ˜¯æœ€é€šç”¨åŒæ—¶ä¹Ÿæ˜¯å®˜æ–¹æ¯”è¾ƒæŽ¨èçš„ã€‚
ä»¥JWTè®¤è¯ä¸ºä¾‹ï¼Œå°†æ•´ä¸ªGraphQLè·¯ç”±åŠ å…¥JWTè®¤è¯ï¼Œå¼€æ”¾ä¸¤ä¸ªRESTfulæŽ¥å£åšç™»å½•å’Œæ³¨å†Œç”¨ï¼Œç™»å½•å’Œæ³¨å†Œçš„å…·ä½“é€»è¾‘ä¸å†èµ˜è¿°ï¼Œç™»å½•åŽè¿”å›žJWT
Tokenï¼š
        // ...
        router.post('/login', LoginController.login);
        router.post('/register', LoginController.register);
        app.use(koajwt({secret: 'your secret'}).unless({
            path: [/^/public/, '/login', '/register']
        }));
        const server = new ApolloServer({
            typeDefs: schemaText,
            resolvers: resolverMap,
            context: ({ctx}) => ({
                ...ctx,
                ...app.context
            })
        });
        server.applyMiddleware({app});
        app.listen({
            port: 4000
        }, () => console.log(`ðŸš€ Server ready at http://localhost:4000${server.graphqlPath}`),);
        // ...
è®¾ç½®å®ŒæˆåŽï¼Œè¯·æ±‚GraphQLæŽ¥å£éœ€è¦å…ˆè¿›è¡Œç™»å½•æ“ä½œï¼Œç„¶åŽåœ¨å‰ç«¯é…ç½®å¥½è®¤è¯è¯·æ±‚å¤´æ¥è®¿é—®GraphQLæŽ¥å£ï¼Œä»¥`curl`ä»£æ›¿å‰ç«¯è¯·æ±‚ç™»å½•RESTfulæŽ¥å£ï¼š
        curl -X POST http://localhost:4000/login -H 'cache-control: no-cache' -H 'content-type: application/x-www-form-urlencoded' -d 'username=user1&password=123456'
        {"message":"ç™»å½•æˆåŠŸ","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkYXRhIjp7Il9pZCI6IjViNWU1NDcwN2YyZGIzMDI0YWJmOTY1NiIsInVzZXJuYW1lIjoidXNlcjEiLCJwYXNzd29yZCI6IiQyYSQwNSRqekROOGFQbEloRzJlT1A1ZW9JcVFPRzg1MWdBbWY0NG5iaXJaM0Y4NUdLZ3pVL3lVNmNFYSJ9LCJleHAiOjE1MzI5MTIyOTEsImlhdCI6MTUzMjkwODY5MX0.Uhd_EkKUEDkI9cdnYlOC7wSYZdYLQLFCb01WhSBeTpY"}
ä»¥GraphiQL _ï¼ˆGraphQLå¼€å‘è€…è°ƒè¯•å·¥å…·ï¼Œå¤§éƒ¨åˆ†GraphQLå¼•æ“Žè‡ªå¸¦ï¼Œé»˜è®¤å¼€å¯ï¼‰_ ä»£æ›¿å‰ç«¯è¯·æ±‚GraphQLæŽ¥å£ï¼Œè¦å…ˆè®¾ç½®è®¤è¯è¯·æ±‚å¤´ï¼š
### **åœ¨GraphQLå†…è®¤è¯**
å¦‚æžœGraphQLåŽç«¯åªèƒ½æ”¯æŒGraphQLä¸èƒ½æ”¯æŒRESTfulï¼Œæˆ–è€…å…¨éƒ¨è¯·æ±‚éƒ½éœ€è¦ä½¿ç”¨GraphQLï¼Œä¹Ÿå¯ä»¥ç”¨GraphQLæž„é€ loginæŽ¥å£æä¾›Tokenã€‚
å¦‚ä¸‹é¢ä¾‹å­ï¼Œæž„é€ loginçš„Query Schema, ç”±è¿”å›žå€¼ä¸­æºå¸¦Tokenï¼š
        type Query {
            login(
                username: String!
                password: String!
            ): LoginMsg
        }
        type LoginMsg {
            message: String
            token: String
        }
åœ¨Resolverä¸­æä¾›ç™»å½•é€»è¾‘ï¼š
        import bcrypt from 'bcryptjs';
        import jsonwebtoken from 'jsonwebtoken';
        export const login = async (_, args, context) => {
            const db = await context.getDb();
            const { username, password } = args;
            const user = await db.collection('User').findOne({ username: username });
            if (await bcrypt.compare(password, user.password)) {
                return {
                    message: 'Login success',
                    token: jsonwebtoken.sign({