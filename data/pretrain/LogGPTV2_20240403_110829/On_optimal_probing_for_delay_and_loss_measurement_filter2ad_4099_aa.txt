title:On optimal probing for delay and loss measurement
author:François Baccelli and
Sridhar Machiraju and
Darryl Veitch and
Jean Bolot
On Optimal Probing for Delay and Loss Measurement
∗
Francois Baccelli
INRIA-ENS, Ecole Normale Supérieure, France
PI:EMAIL
Darryl Veitch*†
Dept. of E&E Engineering
University of Melbourne, Australia
PI:EMAIL
ABSTRACT
Packet delay and loss are two fundamental measures of perfor-
mance. Using active probing to measure delay and loss typically in-
volves sending Poisson probes, on the basis of the PASTA property
(Poisson Arrivals See Time Averages), which ensures that Pois-
son probing yields unbiased estimates. Recent work, however, has
questioned the utility of PASTA for probing and shown that, for de-
lay measurements, i) a wide variety of processes other than Poisson
can be used to probe with zero bias and ii) Poisson probing does not
necessarily minimize the variance of delay estimates.
In this paper, we determine optimal probing processes that mini-
mize the mean-square error of measurement estimates for both de-
lay and loss. Our contributions are twofold. First, we show that
a family of probing processes, speciﬁcally Gamma renewal prob-
ing processes, has optimal properties in terms of bias and variance.
The optimality result is general, and only assumes that the target
process we seek to optimally measure via probing, such as a loss
or delay process, has a convex auto-covariance function. Second,
we use empirical datasets to demonstrate the applicability of our
results in practice, speciﬁcally to show that the convexity condition
holds true and that Gamma probing is indeed superior to Poisson
probing. Together, these results lead to explicit guidelines on de-
signing the best probe streams for both delay and loss estimation.
Categories and Subject Descriptors
C.4 [Performance of Systems]: Measurement Techniques, Mod-
eling Techniques, Performance Attributes.
∗
Work funded in part by the "Equipes Associés" INRIA Pro-
gramme on Internet Probing.
†
ARC Special Research Centre on Ultra-Broadband Information
Networks, CUBIN is an afﬁliated program of National ICT Aus-
tralia (NICTA).
Permission to make digital or hard copies of all or part of this work for
personal or classroom use is granted without fee provided that copies are
not made or distributed for proﬁt or commercial advantage and that copies
bear this notice and the full citation on the ﬁrst page. To copy otherwise, to
republish, to post on servers or to redistribute to lists, requires prior speciﬁc
permission and/or a fee.
IMC’07, October 24-26, 2007, San Diego, California, USA.
Copyright 2007 ACM 978-1-59593-908-1/07/0010 ...$5.00.
Sridhar Machiraju
Sprint, California, U.S.A.
PI:EMAIL
Jean Bolot
Sprint, California, U.S.A.
PI:EMAIL
General Terms
Design, Measurement, Performance, Theory.
Keywords
Active Probing, Convexity, Auto-covariance, Variance, PASTA.
1.
INTRODUCTION
In packet networks, packet loss and delay are two of the most
fundamental measures of performance. Their role is even more
central when it comes to end-to-end measurements, particularly us-
ing active probing. Here, loss and delay are not only important
performance metrics in their own right, they are the information
carried by probes about the network ‘system’ they traverse, infor-
mation that can be used to infer network parameters such as link
capacities and available bandwidth.
Of the two, loss is harder to measure and exploit because it is
harder to ﬁnd in many of today’s networks, in particular in the In-
ternet core, and because loss data manifests as a per-packet loss/no-
loss indication, a binary variable, which is much coarser than con-
tinuous delay, and thereby carries far less information. As a result
of these difﬁculties, with few exceptions, probing for loss has re-
mained straightforward and it has essentially consisted in sending
isolated probes and estimating average loss probability by observ-
ing their empirical loss rate.
More sophisticated techniques have been proposed for delay mea-
surements involving, for example, probe ‘trains’ at the sender, and
interpreting the spacing between train packets at the receiver. Anal-
ogous techniques for loss are hampered by the fact that multiple
losses in a train is an event so rare that it would almost never be ob-
served in experiments of reasonable length (excessively intrusive
probing rate aside).
In all cases, using active probing to measure delay and loss typ-
ically involves Poisson probes or trains, that is exponential probe
or train separations, on the basis of the PASTA property (Poisson
Arrivals See Time Averages), which ensures that Poisson probing
yields unbiased estimates from a single sample path. This prop-
erty has been used, in particular since Paxson’s work [15], to jus-
tify sending probes as a Poisson stream. Although the validity of
PASTA itself is not in question, Baccelli et al. [2] recently ques-
tioned its utility for network probing as a whole. Speciﬁcally, re-
sults in [2] show that for delay measurements, a wide variety of
291(non-intrusive) processes other than Poisson, which have a mixing
property, can be used to probe with zero bias.
This paper is motivated by the observation and counterexamples
of [2] showing that Poisson probing is not optimal, that is, it does
not minimize the variance of delay estimates. This opens up the
general question of whether there exist optimal probing strategies.
We address this not only for delay as in [2] but also for loss, and
not just for simple measures such as average loss and marginal de-
lay distributions, but more complex ones such as loss correlations
and delay jitter. We give rigorous results on probing strategies us-
ing a network model general enough to include cases relevant to
today’s network practitioners, including multiple hops where loss
mechanisms may vary.
Our ﬁrst set of results is theoretical. As mentioned earlier, it was
shown in [2], in the context of delay, that Poisson sampling can be
sub-optimal for variance. We conﬁrm that this holds also for loss,
and go much further, by providing a theorem on minimizing vari-
ance with wide applicability and giving an explicit family (Gamma
renewal) of probing streams, all of which have variance that is bet-
ter than that of Poisson, and simultaneously zero sample path bias.
The optimality result is very general and can be applied to any prob-
ing problem assuming that the target process we seek to optimally
measure via probing has a convex auto-covariance function. In a
probing context, the target process could be a delay process or a
loss process, with measures of interest ranging from average delay
to average loss, number of packets in a train lost, etc.
In our second set of results, we argue that the convexity prop-
erty is present in real systems and provide experimental evidence
to support our argument. We use empirical datasets collected on
routers and on the Internet backbone to demonstrate that the con-
vexity condition holds true and that Gamma probing is indeed su-
perior to Poisson probing.
Together, these two sets of results lead to explicit guidelines on
designing the best probe streams for both delay and loss estimation.
These guidelines are consistent with the spirit of the probe pattern
separation rule introduced in [2] as a replacement to the Poisson
default.
The remainder of the paper is structured as follows. Section 2
presents background information on sampling for delay and loss.
Section 3 proves two theorems on optimal variance for the estima-
tion of delay and loss, and discusses their generality. In Section 4
and Section 5, we provide extensive measurement results primar-
ily based on a unique full-router dataset to support our results. In
Section 7 we compare our work to that of others, and conclude in
Section 8.
2. OVERVIEW
In this section, we use prior work [2] to provide an overview of
the current state-of-art and motivate the problem we study. We start
with the ground truth process, which is what we want to measure.
2.1 The Ground Truth Process
Consider the measurement of loss. We begin by deﬁning what it
is we actually want to measure, the ‘ground truth’ for loss. An ob-
vious candidate is the probability px that a packet of size x (bytes),
injected into the network at some source, would fail to arrive at the
receiver. However, despite its importance, px is not rich enough
to describe the sampling that occurs during measurement. Instead,
we take our ground truth to be a binary stochastic process Ix(t),
which takes value 1 if a packet of size x, if it were injected at time
t, would be lost, and 0 otherwise. We assume that this loss process
Ix(t) is stationary, in which case px is well deﬁned as its marginal
loss probability px = P(Ix(t) = 1), a constant for any time t.
The deﬁnition of Ix(t) is natural and direct: it records whether
loss would have occurred or not, without asking how. It is there-
fore a general deﬁnition, and as it makes no assumption on loss
mechanism or policy, it applies to very general networks.
The following examples help to make this notion of the ground
truth as a process, more concrete. First, take a simple one hop path
model, consisting of a ﬁnite FIFO buffer with a continuous time
occupancy process B(t) bytes, buffer size K bytes, and droptail
dropping policy. In this case, writing 1 for the indicator function,
Ix(t) = 1{B(t) + x > K},
(1)
which depends strongly on x. If, on the other hand, the dropping
policy was based on the number N (t) of packets, with a maximum
of K packets, then
Ix(t) = 1{N (t) + 1 > K},
(2)
which is independent of x. We now extend the ﬁrst example to a
2-hop FIFO tandem network. To do so, note that the level B2(·) of
the second buffer must be observed when the packet would arrive to
it, provided it was not lost at the ﬁrst. The loss process is therefore
Ix(t) = 1{B(t) + x > K}
+ 1{B(t) + x ≤ K, B2(t + dx(t)) + x > K2},
(3)
where dx(t) = (B(t) + x)/C is the delay over the ﬁrst buffer, C
is the ﬁrst hop bandwidth, and K2 the size of buffer B2. The above
examples show that the actual loss behavior depends strongly on
each of packet size, node policies, and network topology. The loss
process Ix(t) is general enough to encompass all of these.
It is crucial to note that Ix(t) describes what a probe would see
if it entered at time t, but the probe does not actually do so. The
observed loss process is therefore a functional of the system state
which is not in any way perturbed by probes. Similarly, we can
deﬁne the ground truth process for delay, too. Speciﬁcally, if Dx(t)
is the ground truth delay observed by a packet of size x, then Dx(t)
is the delay a packet of size x would have experienced had it been
injected into the system at time t. A special case is the virtual
delay process D0(t), the delay experienced by a virtual (zero-sized)
probe injected into the system at time t.
The process Ix(t) relates to what a single probe would see. We
would also like to send in probe patterns, clusters or trains of probes,
and ask what losses they would experience. For example, we could
ask whether a probe train with m packets having sizes (cid:2)x, and inter-
probe spacings (cid:2)τ , would lose at least one packet if it entered the
network at time t. Alternatively, we could inquire after the distri-
bution of the number of packets lost in a train. Questions such as
these cannot be answered using the loss process Ix(t). The time
dimension of Ix(t) corresponds simply to the fact that we can ask
the question, ’would a packet be lost’, at any time. It is not possible
to use Ix(.) at times t and t(cid:2)
to determine what losses would be ex-
perienced by two packets sent at t and t(cid:2)
simultaneously, because
Ix(t) is uninﬂuenced by the probe at t, and so the second probe,
like the ﬁrst, arrives to an unperturbed system.
To answer questions on losses in probe trains, a more complex
notion of ground truth is needed, and one which is speciﬁc to train
type. For example, we could deﬁne the following binary train-loss
process I(cid:2)x,(cid:2)p(t), which takes value 1 if at least one probe in the
train (deﬁned by the size and spacing vectors (cid:2)x and (cid:2)p), sent into the
network at time t, is lost, and 0 otherwise. Note that just as in the
case for Ix(t), these probe trains do not actually enter the system.
The train-loss process I(cid:2)x,(cid:2)p(t) is a functional of the unperturbed
system only. Analogously to before, the variable t is simply a way
to ask the question: ‘would probes in a train be lost if sent now’.
2.2 Sampling and Intrusiveness
There are two main issues in measurement via probing: sam-
pling, and intrusiveness. Sampling concerns the fact that probes
can only experience, and reveal, the state of the network at partic-
ular discrete times. Intrusiveness refers to the fact that real probes
perturb the network. This paper focuses on the sampling issue, in
particular the question of variance, in a non-intrusive context. Be-
fore we can do so we must explain what non-intrusiveness really
means, and how it is attained.
Consider the case of the delay ground truth process Dx(t) de-
ﬁned above. An ideal observer of the network would know the
value taken by Dx(t) over continuous time. In practice, with ac-
tive probing, continuous observation is not possible. Instead, probe
packets are sent at discrete times {Tn}, and it seems natural to view
the observations as the samples {Dx(Tn)} of Dx(t). However, this
will not be the case because real probes perturb the network, and so
their experiences are not described exactly by Dx(t) but by some
perturbed form of it. Dealing with these perturbations is a difﬁcult
problem that also interacts with sampling. Hence, to study sam-
pling, it is advantageous to somehow avoid perturbation. In [2],
this motivated the use of the virtual delay process D0(t) as a ba-
sis of non-intrusive sampling, since zero sized probes do not add
to service time, yet will still return meaningful delays. In fact, in
many systems, they correspond precisely to the samples {Dx(Tn)}
of the x = 0 ground truth D0(t).
Although virtual probes were well suited for the purposes of
[2], there are several problems with using them as a basis for non-
intrusive probing in general. The most obvious one is that for loss,
x = 0 seems useless, since such probes would never be lost in
systems like Equation 1, and therefore would not carry very useful
information about the loss experienced by typical packets. Second,
virtual probes are in fact intrusive whenever network elements act
on the number of packets rather than their byte-size (for example
in packet based loss systems such as Equation (2)), and this holds
equally for loss and delay. The most important reason however is
the following. Whereas in [2] x = 0 was synonymous with non-
intrusiveness, our deﬁnition of ground truths for both loss and delay
are for arbitrary x ≥ 0. Hence we need a deﬁnition of non-intrusive
probing which is independent of probe size. In fact, it must be:
(i) General: applicable to any loss or delay ground truth,
(ii) Faithful: i.e. guaranteed to be non-intrusive for any system,
(iii) Sampling Compatible: amenable to a direct sampling inter-
pretation.
The only way to guarantee each of these properties is to deﬁne
a purely sampling viewpoint. In other words, relative to a given
ground truth process X(t), we deﬁne non-intrusive probing directly
as the sampling {X(Tn)}, where the {Tn} are the times the probes
enter the system. Like virtual probes, this notion of non-intrusive
probing is theoretical, it cannot be obtained by real probes, but it
can be calculated by an oracle with full access to the system state.
For completeness, recall that [2] also dealt with x > 0, however
this was in an intrusive context for delay only. An extension of that
intrusive case to loss is discussed in [3]. Here we do not discuss the
intrusive case at all beyond some comments in Section 6.
2.3 NIMASTA
In [2] we coined and proved the NIMASTA property, that Non-
Intrusive Mixing Arrivals See Time Averages. The context is that of
a probe point process which is independent of some ground truth
process. The latter is just assumed to be stationary and ergodic,
whereas the probe point process is assumed to be stationary and
mixing. Mixing is a strong form of ergodicity (see [2] for details)
which guarantees joint ergodicity between the probe and ground
]
c
e
S
[
s
e
t
a
m
l
i
t
s
E
y
a
e
D
n
a
e
M
4
3
2
1
0
x 10−4
True
Sampled
True Poisson Periodic Uniform Pareto EAR(1)
Figure 1: Result from [2] illustrating how mixing processes
have zero sample-path bias whereas non mixing streams (such
as Periodic) may not.
truth processes. By ‘see time averages’, we mean that empirical
averages made by the probe observations of a given ground truth
tend to the true value, namely to the mean value of the stationary
ground truth process:
lim
N→∞
1
N
f (X(Tn)) = E[f (X(0))],
(4)
NX
n=1
where the convergence is in the almost sure (a.s.) sense. In this
formula, f is an arbitrary positive function and X(t) is the ground
truth process of interest. In statistical parlance, this result is one
of strong consistency of the estimator appearing on the LHS for
E[f (X(0))], namely estimates from a single sample path a.s. con-
verge to the true value when the number of samples grows large.
Such a property is very desirable in the active probing context where
only a single sample path is available. In what follows, we will say
that when (4) holds the estimator has no sample-path bias.
In [2], Equation (4) was proved in the context of delay for virtual
probes, that is X(t) = D0(t), and three examples of f functions
were given corresponding to average delays, the delay distribution,
and jitter.
In fact, by using the deﬁnitions both of ground truth
given in section 2.1, and of non-intrusive probing (as deﬁned in
section 2.2), the proof of Equation (4) generalizes naturally to ar-
bitrary ground truth processes (see [3]). In this way loss and delay
can be integrated into a single framework, and hence the results of
[2] can be extended to loss.
The assumption that the probe point process is mixing is nec-
essary for strong consistency to hold. Figure 1 gives an example
(taken from [2]) of ergodic probe processes, one of which, the Peri-
odic case, is not mixing. In this case joint-ergodicity is not satisﬁed,
resulting in a phase-lock phenomenon which lead to sample-path
bias. Note that sample path bias differs from true bias: it is easy
to show that the estimator deﬁned in the LHS of (4) is unbiased for
all ergodic probe point processes. In the case of periodic sampling,
we have a lack of strong consistency (and hence a non-zero sample
path bias as illustrated in the above example) combined with zero
true bias.
In this paper, we employ probes satisfying the mixing property so
as to guarantee strong consistency, and we examine optimal prob-
ing through an analysis of variance within this framework.
3. SAMPLING FOR OPTIMAL VARIANCE
In this section, we explore a class of mixing renewal sampling
(or probing) point processes (a point process is a renewal process
if it has i.i.d inter-arrival times) in an attempt to determine which
probe streams are best to use from the point of view of minimizing
estimation variance. Recently, explicit but simple examples were
given [2] showing the sub-optimality of Poisson probing (Pois-
son point processes belong to the class of mixing renewal pro-
cesses). The main result we prove in this section is that Pois-
son probing/sampling is provably not optimal (in terms of vari-
ance) in this class under very general conditions, provided the auto-
covariance function of the relevant ground truth is convex. Further-
more, under the same conditions, Gamma probing/sampling pro-
cesses (which are also mixing renewal) help achieve a variance that
is as close to the lowest as possible.
3.1 The Convexity Condition
We denote the ground truth continuous time stochastic process,
which we seek to optimally sample, by X(t). We denote its mean
by p and its auto-covariance function by:
R(τ ) = IE[X(t)X(t + τ )] − p2.
We work within the same framework of general networks as de-
scribed in Section 2, but focus on those for which the auto-covariance
function R(τ ) exists and is convex for τ ≥ 0.
The usual sample mean estimator of p using N samples is
ˆp1 =
1
N