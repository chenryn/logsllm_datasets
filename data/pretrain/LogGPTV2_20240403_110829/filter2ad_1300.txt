title:Guide Me to Exploit: Assisted ROP Exploit Generation for ActionScript
Virtual Machine
author:Fadi Yilmaz and
Meera Sridhar and
Wontae Choi
1
Guide Me to Exploit: Assisted ROP Exploit Generation 
for ActionScript Virtual Machine 
Fadi Yilmaz, Meera Sridhar, and Wontae Choi 
36th Annual Computer Security Applications Conference (ACSACâ€™20)
December 7-11, 2020, Online
presented by 
Fadi Yilmaz
Work supported in part by National Science Foundation Grant No. 1566321 
Motivation of Automated Exploit Generation (AEG)
2
â€¢ Monitoring the execution of exploit scripts is crucial
â€¢ Underlying weaknesses of target applications
â€¢ Unorthodox methods to exploit vulnerabilities
AEG
3
â€¢ Determining the exploitability [Younis et al. SQJâ€™16]
â€¢ Explores all possible execution paths [Avgerinos et al. 
NDSSâ€™11]
Vulnerability 
State
ğ‘›!
.
.
.
ğ‘›",!ğ‘›","
ğ‘›",$!
...
...
.
.
.
...
Level 1
Level 2
.
.
.
...
...
.
.
.
...
Level ğ‘˜
.
..
.
Exploit State
.
.
...
Level ğ‘˜+1
Exploit State
.
.
.
...
...
.
.
.
...
Level ğ‘Ÿ
AEG Components
4
â€¢ Fuzzer [Miller et al. ACMâ€™90, Jayaraman et al. NFMâ€™09, Rawat et 
al. NDSSâ€™17]
â€¢ Explores only one execution path in one run
Vulnerability 
State
ğ‘›!
.
.
.
ğ‘›",!ğ‘›","
ğ‘›",$!
...
...
.
.
.
...
Level 1
Level 2
.
.
.
...
...
.
.
.
...
Level ğ‘˜
.
..
.
Exploit State
.
.
...
Level ğ‘˜+1
Exploit State
.
.
.
...
...
.
.
.
...
Level ğ‘Ÿ
AEG Components
5
â€¢ Fuzzer 
â€¢ Explores only one execution path in one run
ğ‘›",!ğ‘›","
ğ‘›",$!
Vulnerability 
State
ğ‘›!
.
.
.
...
...
.
.
.
...
Level 1
Level 2
.
.
.
...
...
.
.
.
...
Level ğ‘˜
.
..
.
Exploit State
.
.
...
Level ğ‘˜+1
Exploit State
.
.
.
...
...
.
.
.
...
Level ğ‘Ÿ
AEG Components
â€¢ Symbolic Execution [King et al. ACMâ€™76]
â€¢ Explores all execution paths symbolically in one run
6
Vulnerability 
State
ğ‘›!
.
.
.
ğ‘›",!ğ‘›","
ğ‘›",$!
...
...
.
.
.
...
Level 1
Level 2
.
.
.
...
...
.
.
.
...
Level ğ‘˜
.
..
.
Exploit State
.
.
...
Level ğ‘˜+1
Exploit State
.
.
.
...
...
.
.
.
...
Level ğ‘Ÿ
AEG Components
7
â€¢ Symbolic Execution
â€¢ Explores all execution paths symbolically in one run
Vulnerability 
State
ğ‘›!
.
.
.
ğ‘›",!ğ‘›","
ğ‘›",$!
...
...
.
.
.
...
Level 1
Level 2
.
.
.
...
...
.
.
.
...
Level ğ‘˜
.
..
.
Exploit State
.
.
...
Level ğ‘˜+1
Exploit State
.
.
.
...
...
.
.
.
...
Level ğ‘Ÿ
AEG Components
8
â€¢ Symbolic Execution 
â€¢ Explores all execution paths symbolically in one run
Vulnerability 
State
ğ‘›!
.
.
.
ğ‘›",!ğ‘›","
ğ‘›",$!
...
...
.
.
.
...
Level 1
Level 2
.
.
.
...
...
.
.
.
...
Level ğ‘˜
.
..
.
Exploit State
.
.
...
Level ğ‘˜+1
Exploit State
.
.
.
...
...
.
.
.
...
Level ğ‘Ÿ
AEG Components
9
â€¢ Symbolic Execution 
â€¢ Explores all execution paths symbolically in one run
Vulnerability 
State
ğ‘›!
.
.
.
ğ‘›",!ğ‘›","
ğ‘›",$!
...
...
.
.
.
...
Level 1
Level 2
.
.
.
...
...
.
.
.
...
Level ğ‘˜
.
..
.
Exploit State
.
.
...
Level ğ‘˜+1
Exploit State
.
.
.
...
...
.
.
.
...
Level ğ‘Ÿ
AEG Components
10
â€¢ Symbolic Execution 
â€¢ Explores all execution paths symbolically in one run
Vulnerability 
State
ğ‘›!
.
.
.
ğ‘›",!ğ‘›","
ğ‘›",$!
...
...
.
.
.
...
Level 1
Level 2
.
.
.
...
...
.
.
.
...
Level ğ‘˜
...
.
Exploit State
.
.
...
Level ğ‘˜+1
Exploit State
.
.
.
...
...
.
.
.
...
Level ğ‘Ÿ
AEG Components
11
+pros
Fast, easy to build
Fuzzer
Complex grammar rules 
for executables 
Infinitesimal chance
-cons
+pros
Explores all execution 
paths in one run
Symbolic 
Execution
The path-explosion 
problem
-cons
GUIDEXP : A Prototype Semi-Automatic AEG Tool
12
â€¢ The first guided (semi-automatic) exploit generation tool for 
the AVM implementations
â€¢ Does not rely on a fuzzer or a symbolic execution tool
Intuition Behind Target Exploit Generation
13
â€¢ Structure of our target exploit
â€¢ Exploit pattern
Exploit Subgoals
14
â€¢ A search space
â€¢ Set of instructions
â€¢ An invariant
â€¢ The test
Preparation: Defining Exploit Subgoals, 
15
Phase 1
Target Exploit Subgoals
Inputs & Outputs
ğœ2
ğœ1
ğœğ‘›
ğœğ‘– (Exploit Subgoal)
Search Space(ğœğ‘– )
Phase 2
Phase 3
Trigger 
Slice
Parser
AST
Code 
Generator
Candidate
Slice
Invariant 
Validator
Next Exploit Subgoal
Checkpoint(ğœğ‘– )
Exploit Subgoal
Manager
Slice, ğœğ‘– )
Decision(Candidate 
The Exploit
Exploit Subgoal
Parser
Invariant(ğœğ‘– )
OUR AEG 
TOOL
Preparation: Defining Exploit Subgoals, 
16
Phase 1
Target Exploit Subgoals
Inputs & Outputs
ğœ2
ğœ1
ğœğ‘›
ğœğ‘– (Exploit Subgoal)
Search Space(ğœğ‘– )
Phase 2
Phase 3
Trigger 
Slice
Parser
AST
Code 
Generator
Candidate
Slice
Invariant 
Validator
Next Exploit Subgoal
Checkpoint(ğœğ‘– )
Exploit Subgoal
Manager
Slice, ğœğ‘– )
Decision(Candidate 
The Exploit
Exploit Subgoal
Parser
Invariant(ğœğ‘– )
OUR AEG 
TOOL
Reads exploit 
subgoals and 
invariant  
Phase 1: Exploit Subgoal Processing
17
Target Exploit Subgoals
Phase 1
ğœ2
ğœ1
ğœğ‘›
ğœğ‘– (Exploit Subgoal)
Search Space(ğœğ‘– )
Exploit Subgoal
Parser
Invariant(ğœğ‘– )
OUR AEG 
TOOL
Phase 2
Phase 3
Trigger 
Slice
Parser
AST
Code 
Generator
Candidate
Slice
Invariant 
Validator
Next Exploit Subgoal
Checkpoint(ğœğ‘– )
Exploit Subgoal
Manager
Slice, ğœğ‘– )
Decision(Candidate 
The Exploit
Phase 2: Generates Candidate Slices and Validating 
Invariant 
18
Target Exploit Subgoals
Phase 1
ğœ2
ğœ1
ğœğ‘›
ğœğ‘– (Exploit Subgoal)
Search Space(ğœğ‘– )
Exploit Subgoal
Parser
Invariant(ğœğ‘– )
OUR AEG 
TOOL
Phase 2
Phase 3
Trigger 
Slice
Parser
AST
Code 
Generator
Candidate
Slice
Invariant 
Validator
Next Exploit Subgoal
Checkpoint(ğœğ‘– )
Exploit Subgoal
Manager
Slice, ğœğ‘– )
Decision(Candidate 
The Exploit
Phase 2: Generates Candidate Slices and Validating 
Invariant
19
Parses the 
trigger slice
Target Exploit Subgoals
Phase 1
ğœ2
ğœ1
ğœğ‘›
ğœğ‘– (Exploit Subgoal)
Search Space(ğœğ‘– )
Exploit Subgoal
Parser
Invariant(ğœğ‘– )
OUR AEG 
TOOL
Phase 2
Phase 3
Trigger 
Slice
Parser
AST
Code 
Generator
Candidate
Slice
Invariant 
Validator
Next Exploit Subgoal
Checkpoint(ğœğ‘– )
Exploit Subgoal
Manager
Slice, ğœğ‘– )
Decision(Candidate 
The Exploit
Phase 2: Generates Candidate Slices and Validating 
Invariant 
20
Generates 
candidate slices
Target Exploit Subgoals
Phase 1
ğœ2
ğœ1
ğœğ‘›
ğœğ‘– (Exploit Subgoal)
Search Space(ğœğ‘– )
Exploit Subgoal
Parser
Invariant(ğœğ‘– )
OUR AEG 
TOOL
Phase 2
Phase 3
Trigger 
Slice
Parser
AST
Code 
Generator
Candidate
Slice
Invariant 
Validator
Next Exploit Subgoal
Checkpoint(ğœğ‘– )
Exploit Subgoal
Manager
Slice, ğœğ‘– )
Decision(Candidate 
The Exploit
Phase 2: Generates Candidate Slices and Validating 
Invariant 
21
Executes and 
tests candidate 
slices
Target Exploit Subgoals
Phase 1
ğœ2
ğœ1
ğœğ‘›
ğœğ‘– (Exploit Subgoal)
Search Space(ğœğ‘– )
Exploit Subgoal
Parser
Invariant(ğœğ‘– )
OUR AEG 
TOOL
Phase 2
Phase 3
Trigger 
Slice
Parser
AST
Code 
Generator
Candidate
Slice
Invariant 
Validator
Next Exploit Subgoal
Checkpoint(ğœğ‘– )
Exploit Subgoal
Manager
Slice, ğœğ‘– )
Decision(Candidate 
The Exploit
Phase 3: Evaluating Candidate Slices
22
Evaluates the 
execution of 
candidate slices
Target Exploit Subgoals
Phase 1
ğœ2
ğœ1
ğœğ‘›
ğœğ‘– (Exploit Subgoal)
Search Space(ğœğ‘– )
Exploit Subgoal
Parser
Invariant(ğœğ‘– )
OUR AEG 
TOOL
Phase 2
Phase 3
Trigger 
Slice
Parser
AST
Code 
Generator
Candidate
Slice
Invariant 
Validator
Next Exploit Subgoal
Checkpoint(ğœğ‘– )
Exploit Subgoal
Manager
Slice, ğœğ‘– )
Decision(Candidate 
The Exploit
Optimization Techniques
â€¢ Exploit Deconstruction ~10!"
â€¢
Synthesizing smaller exploit subgoals in sequence
23
Vulnerability 
State
ğ‘›!
.
.
.
...
...
.
.
.
...
Level 1
Level 2
...
...
.
.
.
...
Level ğ‘˜
.
..
.
Exploit State
.
.
...
Level ğ‘˜+1
Exploit State
.
.
.
...
...
.
.
.
...
Level ğ‘Ÿ
Optimization Techniques
â€¢ Exploit Deconstruction ~10!"
â€¢
Synthesizing smaller exploit subgoals in sequence
24
Vulnerability 
State
ğ‘›!
.
.
.
...
...
.
.
.
...
Level 1
Level 2
...
...
.
.
.
...
Level ğ‘˜
.
..
.
Exploit State
.
.
...
Level ğ‘˜+1
Exploit State
.
.
.
...
...
.
.
.
...
Level ğ‘Ÿ
Optimization Techniques
â€¢ Exploit Deconstruction ~10!"
â€¢
Synthesizing smaller exploit subgoals in sequence
25
Vulnerability 
State
ğ‘›!
.
.
.
...
...
.
.
.
...
Level 1
Level 2
...
...
.
.
.
...
Level ğ‘˜
.
..
.
Exploit State
.
.
...
Level ğ‘˜+1
Exploit State
.
.
.
...
...
.
.
.
...
Level ğ‘Ÿ
Optimization Techniques
â€¢ Exploit Deconstruction ~10!"
â€¢
Synthesizing smaller exploit subgoals in sequence
26
Vulnerability 
State
ğ‘›!
.
.
.
...
...
.
.
.
...
Level 1
Level 2
...
...
.
.
.
...
Level ğ‘˜
.
..
.
Exploit State
.
.
...
Level ğ‘˜+1
Exploit State
.
.
.
...
...
.
.
.
...
Level ğ‘Ÿ
Optimization Techniques
â€¢ Exploit Deconstruction ~10!"
â€¢
Synthesizing smaller exploit subgoals in sequence
27
Vulnerability 
State
ğ‘›!
.
.
.
...
...
.
.
.
...
Level 1
Level 2
...
...
.
.
.
...
Level ğ‘˜
.
..
.
Exploit State
.
.
...
Level ğ‘˜+1
Exploit State
.
.
.
...
...
.
.
.
...
Level ğ‘Ÿ
Optimization Techniques
â€¢ Exploit Deconstruction ~10!"
â€¢
Synthesizing smaller exploit subgoals in sequence
28
Vulnerability 
State
ğ‘›!
.
.
.
...
...
.
.
.
...
Level 1
Level 2
...
...
.
.
.
...
Level ğ‘˜
.
..
.
Exploit State
.
.
...
Level ğ‘˜+1
Exploit State
.
.
.
...
...
.
.
.
...
Level ğ‘Ÿ
Optimization Techniques
â€¢ Exploit Deconstruction ~10!"
â€¢
Synthesizing smaller exploit subgoals in sequence
29
Vulnerability 
State
ğ‘›!
.
.
.
...
...
.
.
.
...
Level 1
Level 2
...
...
.
.
.
...
Level ğ‘˜
.
..
.
Exploit State
.
.
...
Level ğ‘˜+1
Exploit State
.
.
.
...
...
.
.
.
...
Level ğ‘Ÿ
â€¢ Exploit Deconstruction ~10!"
â€¢ Operand Stack Verification 98.78%
â€¢
Synthesizing smaller exploit subgoals in sequence
Optimization Techniques
30
â€¢ Disqualifies candidate slices that perform illegal stack operations
Optimization Techniques
31
â€¢
Synthesizing smaller exploit subgoals in sequence
â€¢ Exploit Deconstruction ~10!"
â€¢ Operand Stack Verification 98.78%
Instruction Tiling ~10#$."
â€¢
â€¢ Disqualifies candidate slices that perform illegal stack operations
â€¢ Glues instructions together to obtain more coarse-grained, 
meaningful instruction chains
Optimization Techniques
32
â€¢
â€¢ Exploit Deconstruction ~10!"
â€¢ Operand Stack Verification 98.78%
Instruction Tiling ~10#$."
Feedback from the AVM 58%
meaningful instruction chains
â€¢
â€¢
â€¢ Detects error-raising instruction prefixes
Synthesizing smaller exploit subgoals in sequence
â€¢ Disqualifies candidate slices that perform illegal stack operations
â€¢ Glues instructions together to obtain more coarse-grained, 
Experimental Results -I
33
â€¢ Two sets of experiments
â€¢ CVE-2015-5119
â€¢ Open-source core implementation 
â€¢ Closed-source standalone Flash Player Debugger
Experimental Results -I
34
â€¢ The difference is due to starting/closing of the Flash Player
It takes 85ms on average, equivalent to 89% of the time
â€¢
Experimental Results -II
35
â€¢ Generating exploit scripts for different vulnerabilities 
with the closed-source debugger
Limitations and Challenges
36
â€¢ Compatibility
â€¢ Different memory offset
â€¢ Calling external libraries
â€¢ Debuggers 
â€¢ PoCs perform their malicious activities implicitly
â€¢ Accuracy of the exploit subgoals
â€¢ Having unnecessary instructions significantly increases the 
time (combinatorial rate)
37
Thank You
Fadi Yilmaz
UNC Charlotte
PI:EMAIL
Meera Sridhar
UNC Charlotte
PI:EMAIL
Wontae Choi
PI:EMAIL
Key References
38
[Younis et al. SQJâ€™16] Awad Younis, Yashwant K Malaiya, and Indrajit Ray. 2016. 
Assessing vulnerability exploitability risk using software properties. Software 
Quality Journal 24, 1 (2016), 159â€“202.
[Avgerinos et al. NDSSâ€™11] Thanassis Avgerinos, Sang Kil Cha, Brent Lim Tze Hao, 
and David Brumley. 2011. AEG: Automatic Exploit Generation. In Proceedings of 
The Network and Distributed System Security Symposium (NDSS).
[Miller et al. ACMâ€™90] Barton P Miller, Louis Fredriksen, and Bryan So. 1990. An 
empirical study of the reliability of UNIX utilities. Commun. ACM 33, 12 (1990), 
32â€“44.
[Jayaraman et al. NFMâ€™09] Karthick Jayaraman, David Harvison, and Adam Kiezun
Vijay Ganesh. 2009. jFuzz: A concolic whitebox fuzzer for Java. In Proceedings of 
the First NASA Formal Methods Symposium (NFM).
[Rawat et al. NDSSâ€™17] Sanjay Rawat, Vivek Jain, Ashish Kumar, Lucian Cojocar, 
Cristiano Giuffrida, and Herbert Bos. 2017. VUzzer: Application-aware 
Evolutionary Fuzzing. In Proceedings of the Network and Distributed System 
Security Symposium (NDSS), Vol. 17. 1â€“14.