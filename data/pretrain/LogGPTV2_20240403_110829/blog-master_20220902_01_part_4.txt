```  
```  
D select count(*) from predict_result;  
┌──────────────┐  
│ count_star() │  
├──────────────┤  
│ 5011         │  
└──────────────┘  
D select * from predict_result limit 10;  
┌────────────┬────────────────────────────────────────────────────────────────────────────────────┬────────────────────────────────────────────────────────────────────────────────────┬────────┐  
│     c1     │                                        v_r2                                        │                                     v_predict                                      │ today  │  
├────────────┼────────────────────────────────────────────────────────────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────┼────────┤  
│ 2001-09-18 │ [0.5477248881771232, 0.4294103279226137, 0.03009429133494708, 0.170296619278861... │ [36.19781407035174, 36.178874345549715, 36.01305389221556, 36.27806672714444, 3... │ 36.250 │  
│ 2001-09-19 │ [0.9611386034911508, 0.6535704666379193, 0.5715803478188309, 0.0014653458030233... │ [35.894709576138155, 35.83907085691977, 35.91483213182286, 36.08960226565418, 3... │ 36.920 │  
│ 2001-09-20 │ [0.0015117174275450366, 0.0029461146679347697, 0.017964714013863896, 4.23991119... │ [36.40301674515962, 36.41369577960143, 36.4792048791507, 36.18644868841496, 36.... │ 36.610 │  
│ 2001-09-21 │ [0.17268457359219136, 0.07695242873659218, 0.08883974063158542, 0.1441959730711... │ [36.66319165638668, 36.486907090977795, 36.48749719476356, 36.46415520954117, 3... │ 36.060 │  
│ 2001-09-24 │ [0.1566366042721039, 0.006366482125359778, 0.018232425919809007, 0.018611120513... │ [36.80417729024607, 36.437406610299774, 36.28947279014742, 36.29932536079288, 3... │ 36.050 │  
│ 2001-09-25 │ [0.6165713402856844, 0.02412225708179192, 0.05680990588985864, 0.04861667900846... │ [35.962677912493405, 36.338516659059785, 36.31826261867725, 36.22388234243884, ... │ 36.230 │  
│ 2001-09-26 │ [0.22128507496296002, 0.4374969015310316, 0.055406903536342936, 0.0758783125403... │ [36.11481824083091, 36.16487413980442, 36.33899769504784, 36.33964143099952, 36... │ 36.080 │  
│ 2001-09-27 │ [0.16394346958076422, 0.20907984305230073, 0.46260944204892124, 0.0767341232139... │ [36.132866449511404, 36.12818712738776, 36.081162388431466, 36.24558100180505, ... │ 36.700 │  
│ 2001-09-28 │ [0.3201373973630739, 0.08695757663985203, 0.16135448117525963, 0.05556990265243... │ [35.23591397849454, 35.639272300469486, 35.993311734422164, 36.36011484529211, ... │ 37.090 │  
│ 2001-10-08 │ [0.39780897600847426, 0.49709615562506027, 0.5522311441310693, 0.15847076815429... │ [37.37150684931507, 37.4154761904762, 37.4830664652568, 36.8382500680378, 36.75... │ 36.580 │  
└────────────┴────────────────────────────────────────────────────────────────────────────────────┴────────────────────────────────────────────────────────────────────────────────────┴────────┘  
```  
使用r2最接近于1的预测值, 对比真实值计算预测准确度.    
用sort list, 获得最接近于1的r2 ( r2的取值范围是0到1, 所以没有负数, 没有所谓的负相关性, 这不是corr ) 作为map key, 取得map value  
BUG1:  
这里发现一个bug: array排序会修改原来的value, 所以map里面的r2也被排序了, 但是predict没有被排序. 这是个大坑.  (把sort放在map后面, 问题依旧.)   
issue: https://github.com/duckdb/duckdb/issues/4591   
```  
create table t as   
select   
c1,   
today,   
array_sort(v_r2, 'DESC', 'NULLS LAST')[1] as k ,  
map(v_r2, v_predict) as v_map  
from predict_result;   
```  
```  
2001-10-08: 0.5522311441310693 本来对应 37.4830664652568  
但是这里变成了 37.37150684931507  
D select * from t limit 10;   
┌────────────┬────────┬─────────────────────┬────────────────────────────────────────────────────────────────────────────────────┐  
│     c1     │ today  │          k          │                                       v_map                                        │  
├────────────┼────────┼─────────────────────┼────────────────────────────────────────────────────────────────────────────────────┤  
│ 2001-09-18 │ 36.250 │ 0.5477248881771232  │ {0.5477248881771232=36.19781407035174, 0.4294103279226137=36.178874345549715, 0... │  
│ 2001-09-19 │ 36.920 │ 0.9611386034911508  │ {0.9611386034911508=35.894709576138155, 0.6535704666379193=35.83907085691977, 0... │  
│ 2001-09-20 │ 36.610 │ 0.1591385938539098  │ {0.1591385938539098=36.40301674515962, 0.03630903802451202=36.41369577960143, 0... │  
│ 2001-09-21 │ 36.060 │ 0.17268457359219136 │ {0.17268457359219136=36.66319165638668, 0.14419597307111012=36.486907090977795,... │  
│ 2001-09-24 │ 36.050 │ 0.1566366042721039  │ {0.1566366042721039=36.80417729024607, 0.061351731248072416=36.437406610299774,... │  
│ 2001-09-25 │ 36.230 │ 0.6165713402856844  │ {0.6165713402856844=35.962677912493405, 0.07644244823905755=36.338516659059785,... │  
│ 2001-09-26 │ 36.080 │ 0.4374969015310316  │ {0.4374969015310316=36.11481824083091, 0.22128507496296002=36.16487413980442, 0... │  
│ 2001-09-27 │ 36.700 │ 0.46260944204892124 │ {0.46260944204892124=36.132866449511404, 0.20907984305230073=36.12818712738776,... │  
│ 2001-09-28 │ 37.090 │ 0.3201373973630739  │ {0.3201373973630739=35.23591397849454, 0.16135448117525963=35.639272300469486, ... │  
│ 2001-10-08 │ 36.580 │ 0.5522311441310693  │ {0.5522311441310693=37.37150684931507, 0.49709615562506027=37.4154761904762, 0.... │  
└────────────┴────────┴─────────────────────┴────────────────────────────────────────────────────────────────────────────────────┘  
Run Time (s): real 0.002 user 0.001619 sys 0.000191  
D select * from t where k >0.9 limit 10;  
┌────────────┬────────┬────────────────────┬────────────────────────────────────────────────────────────────────────────────────┐  
│     c1     │ today  │         k          │                                       v_map                                        │  
├────────────┼────────┼────────────────────┼────────────────────────────────────────────────────────────────────────────────────┤  
│ 2001-09-19 │ 36.920 │ 0.9611386034911508 │ {0.9611386034911508=35.894709576138155, 0.6535704666379193=35.83907085691977, 0... │  
│ 2001-10-10 │ 36.100 │ 0.9963368695122323 │ {0.9963368695122323=36.28310126582279, 0.2852291723692304=36.861108548363845, 0... │  
│ 2001-10-11 │ 35.750 │ 0.9866335698274049 │ {0.9866335698274049=38.10113785557986, 0.985402510653=38.07037358238826, 0.3093... │  
│ 2001-10-18 │ 34.040 │ 0.9781479987901981 │ {0.9781479987901981=33.712385321100925, 0.7486847756284869=33.54943988050785, 0... │  
│ 2001-10-19 │ 33.500 │ 0.9533950750712719 │ {0.9533950750712719=33.85476923076923, 0.8658318425760284=33.81948497854077, 0.... │  
│ 2001-10-22 │ 32.790 │ 0.9477912047935907 │ {0.9477912047935907=33.285365448504976, 0.8833241316339207=33.1913194375187, 0.... │  
│ 2001-10-23 │ 36.070 │ 0.9510735325285963 │ {0.9510735325285963=31.57185332011894, 0.9500656419423904=32.14222371025968, 0.... │  
│ 2001-11-15 │ 33.680 │ 0.9361801792676424 │ {0.9361801792676424=33.64224388514711, 0.6009975066046721=33.79353325643983, 0.... │  
│ 2001-11-19 │ 35.050 │ 0.9674148245577682 │ {0.9674148245577682=38.84000000000003, 0.633792497858624=36.10839694656508, 0.2... │  
│ 2001-11-20 │ 35.380 │ 0.9522489742995084 │ {0.9522489742995084=37.73210424710417, 0.9458826283979601=37.87320042342975, 0.... │  
└────────────┴────────┴────────────────────┴────────────────────────────────────────────────────────────────────────────────────┘  
Run Time (s): real 0.001 user 0.001354 sys 0.000137  
```  
以下SQL预期的是取出v_map中r2最大时对应的预测值.   
BUG2:   
但是可能又是个bug: 貌似只取了一个k的value后, 传入的k都是固定的(不确定).     
issue: https://github.com/duckdb/duckdb/issues/4590  
```  
D select c1,k,v_map,v_map[k] from t order by c1 limit 10;  
┌─────────────────────┐  
│      v_map[k]       │  
├─────────────────────┤  
│ [36.19781407035174] │  
│ []                  │  
│ []                  │  
│ []                  │  
│ []                  │  
│ []                  │  
│ []                  │  
│ []                  │  
│ []                  │  
│ []                  │  
└─────────────────────┘  
Run Time (s): real 0.001 user 0.001363 sys 0.000067  
D select element_at(v_map, k) from t limit 5;  
┌──────────────────────┐  
│ element_at(v_map, k) │  
├──────────────────────┤  
│ [36.19781407035174]  │  
│ []                   │  
│ []                   │  
│ []                   │  
│ []                   │  
└──────────────────────┘  
Run Time (s): real 0.002 user 0.001522 sys 0.000111  
```  
那就先建2张表, 一张存储sort后的key, 一张存储未sort的map.  
```  
create table t1 as   
select   
c1,   
today,   
array_sort(v_r2, 'DESC', 'NULLS LAST')[1] as k   
from predict_result;   
create table t2 as   
select   
c1,   
map(v_r2, v_predict) as v_map  
from predict_result;   
D select * from t1 limit 10;  
┌────────────┬────────┬─────────────────────┐  
│     c1     │ today  │          k          │  
├────────────┼────────┼─────────────────────┤  
│ 2001-09-18 │ 36.250 │ 0.5477248881771232  │  
│ 2001-09-19 │ 36.920 │ 0.9611386034911508  │  
│ 2001-09-20 │ 36.610 │ 0.1591385938539098  │  
│ 2001-09-21 │ 36.060 │ 0.17268457359219136 │  
│ 2001-09-24 │ 36.050 │ 0.1566366042721039  │  
│ 2001-09-25 │ 36.230 │ 0.6165713402856844  │  
│ 2001-09-26 │ 36.080 │ 0.4374969015310316  │  
│ 2001-09-27 │ 36.700 │ 0.46260944204892124 │  
│ 2001-09-28 │ 37.090 │ 0.3201373973630739  │  
│ 2001-10-08 │ 36.580 │ 0.5522311441310693  │  
└────────────┴────────┴─────────────────────┘  
Run Time (s): real 0.001 user 0.000640 sys 0.000075  
D select * from t2 limit 10;  
┌────────────┬────────────────────────────────────────────────────────────────────────────────────┐  
│     c1     │                                       v_map                                        │  
├────────────┼────────────────────────────────────────────────────────────────────────────────────┤  
│ 2001-09-18 │ {0.5477248881771232=36.19781407035174, 0.4294103279226137=36.178874345549715, 0... │  
│ 2001-09-19 │ {0.9611386034911508=35.894709576138155, 0.6535704666379193=35.83907085691977, 0... │  
│ 2001-09-20 │ {0.0015117174275450366=36.40301674515962, 0.0029461146679347697=36.413695779601... │  
│ 2001-09-21 │ {0.17268457359219136=36.66319165638668, 0.07695242873659218=36.486907090977795,... │  
│ 2001-09-24 │ {0.1566366042721039=36.80417729024607, 0.006366482125359778=36.437406610299774,... │  
│ 2001-09-25 │ {0.6165713402856844=35.962677912493405, 0.02412225708179192=36.338516659059785,... │  
│ 2001-09-26 │ {0.22128507496296002=36.11481824083091, 0.4374969015310316=36.16487413980442, 0... │  
│ 2001-09-27 │ {0.16394346958076422=36.132866449511404, 0.20907984305230073=36.12818712738776,... │  
│ 2001-09-28 │ {0.3201373973630739=35.23591397849454, 0.08695757663985203=35.639272300469486, ... │  
│ 2001-10-08 │ {0.39780897600847426=37.37150684931507, 0.49709615562506027=37.4154761904762, 0... │  
└────────────┴────────────────────────────────────────────────────────────────────────────────────┘  
Run Time (s): real 0.001 user 0.001226 sys 0.000157  
```  
拆成2张表之后, 好像问题还是存在:  