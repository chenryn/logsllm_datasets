scanner types (see Sect. 3.1), we checked our scanners to see which TTL they
were actually using to see if our setup simply has too small values. All our ZMap-
based scanners initialize the TTL ﬁeld with its maximum of 255 possible hops,
all scanners building on top of the transport layer interfaces, in contrast, use the
current Linux default of 64 hops as also recommended in RFC1700 [29]. Given
that we are at least on the recommended hop count, this leaves us with three
possibilities, (i) the current recommendation of 64 is too low to reach these hosts,
(ii) there are middleboxes modifying the TTL to a much lower value, or, (iii)
there are routing loops on the path to these hosts. After shortly summarizing
our ﬁndings, we continue by exploring the latter.
3.6 Summary
As the previous sections have shown, our Internet-wide scans produce an insight-
ful secondary dataset of ICMP responses. Driven by these messages, we identiﬁed
62
J. R¨uth et al.
a potential DNS spoofer, found that long deprecated source quench messages are
still generated in today’s Internet and that ICMP redirects are sent across dif-
ferent administrative domains pointing to several outdated and misconﬁgured
networks. Without crafting a dedicated dataset, our scans enable us to study
Internet reachability and we believe that longitudinal studies oﬀer a way to deal
with the challenge of ICMP rate-limiting.
4 Routing Loops
Routing loops are an undesirable control plane misconﬁguration that render
destination networks unreachable and that challenge a link’s load [35]. In essence,
IP’s TTL protects the Internet from indeﬁnitely looping packets and thus ICMP
TTL messages inform the sender that a router dropped a packet after exceeding
the allowed number of router hops (TTL). While the potential for routing loops
is known, only a few studies investigated their presence a decade ago [20,36],
current information on the presence and prevalence is missing. Therefore, we
study routing loops on the basis of ICMP TTL exceeded messages triggered by
our scans. We further argue that routing loops can be frequently investigated
as a by-product of Internet-wide scans that are regularly conducted for diﬀerent
purposes.
4.1 Methodology: Detecting Loops
ICMP TTL exceeded messages are not necessarily caused by loops, also overly
large paths or middleboxes could trigger these messages. To investigate whether
or not an actual loop is present, we perform traceroutes for the original des-
tinations (in the quoted IP) of the ICMP TTL exceeded messages. Since our
traceroutes are subject to ICMP rate-limiting, especially when packets start to
loop, we customize traceroute. Our traceroute slows down its sending rate when
detecting an already seen IP address (loop indicator), otherwise, it follows the
design of Paris traceroute [1] reusing ﬂow identiﬁers for each hop to trigger the
same forwarding behavior in ECMP-like load balancers.
Since the traceroutes can still be noisy due to hosts that do not generate
ICMP at all or are still subject to rate-limiting, especially when also other traﬃc
ﬂows into a loop, we put strong demands on our loop. For each hop on the path
that does not generate a reply, we assign a new unique label, all others are simply
labeled by the answering IP. From this list of labels, we create a directed graph
connecting each label-induced node to its successor and on this path we compute
all elementary cycles using [23]. On an elementary cycle, no node appears twice
except that the ﬁrst and last node are the same. Then, on each of these possible
cycles we inspect the node with the highest degree, and if this node’s degree
is larger than 54, we mark this traceroute as having a loop. This will yield
4 This is basically a precaution against bad load balancers traded against the required
TTL.
Hidden Treasures – Recycling Large-Scale Internet Measurements
63
loops as long as at least one router in the loop generated ICMP TTL exceeded
messages, which we found to work reasonably well when traceroute pauses the
packet generation for at least 500 ms when observing an already seen IP address.
Thus in a loop of two routers, we will send each router a packet roughly every
second.
4.2 Routing Loops in the Wild
We seed our traceroutes by ICMP TTL exceeded messages generated from our
Internet-wide scans5. Since we get way too many TTL exceeded messages to
traceroute them all without generating substantial rate-limiting, we restrict us
to a single traceroute for each unique /24 subnet within 30-min intervals. Thus
for two TTL exceeded messages for a destination from the same /24 subnet, we
only perform a single traceroute if the messages arrive within 30 min.
For our assessment of routing loops, we investigate TTL exceeded messages in
the last week of August 2018. To avoid rate-limiting we also limit our traceroutes
that we perform in parallel; generating all traceroutes for this single week took
us until the end of September 2018. While this skews our data, it enables us to
reason about the persistence of these loops since every 30 min the same /24 could
be scheduled for a rescan. In total, we performed ∼27M traceroutes to ∼612K
diﬀerent /24 subnets from 28K ASes, of these, 439K subnets from 19.8K ASes
are unreachable due to a loop. We further inspect how many loops are present
and if loops are only within a single AS or whether loops cross AS borders and
are thus potentially on a peering link. To do so, we count the number of distinct
loops and ASes involved in the loops and ﬁnd 167K diﬀerent loops in 13.9K ASes.
Of these loops, 136K have IPs for all routers involved in the loop, thus allowing
an in-depth inspection. Looking at the ASes involved, we ﬁnd that 13% (17.7K)
already cover all diﬀerent ASes paths involved (i.e., we replaced each IP by the
respective AS), of these 4.8K cross AS boundaries. The top three ASes involved
in the loops are AS171 (Cogent) a Tier-1, AS9498 (BHARTI Airtel Ltd.), an
Indian ISP, and AS3549 (Level 3), again a Tier-1.
Persistence. To investigate the persistence, we restrict our view to traceroutes
that were performed two weeks after the initial TTL exceeded message was
triggered by our Internet-wide scans. In contrast to our previous observation,
loops from roughly 150 ASes disappear, yet, we still ﬁnd 4.6K loops crossing
AS borders, in total still rendering 404K subnets unreachable. Thus, most loops
seem to persist and are not resolved.
Loops at our Upstream ISP. Within our data, we also found loops in the
AS of our upstream ISP. We contacted the ISP about our ﬁndings which they
were able to conﬁrm. Since many of the loops are outside of their administrative
domain even though they manage the address space, they were still able to give
5 Our dataset excludes TTL exceeded messages generated by these traceroutes.
64
J. R¨uth et al.
us more details on a loop that they were able to ﬁx. For one loop, they found
that the ﬁrst router had a static route for our tested destination towards its next
hop, yet, the next hop had no speciﬁc forwarding information for this destination
and thus used its default gateway, which however was the previous router with
the static route thus causing the loop.
Takeaway. Routing loops seem to persist in large parts of the Internet, chal-
lenging the question if the address space cut oﬀ by the loops is in use after all or
if there are other routers that would be taken from diﬀerent vantage points. We
believe routing loops have a huge potential for causing congestion when exploited
and thus a persistent monitoring seeded by large-scale Internet measurements
that informs operators could be a long-term attempt to reduce routing loops.
5 Related Work
Our work relates to approaches analyzing ICMP traﬃc and its generation in
general, as well as approaches that focus on particular studies built upon ICMP,
e.g., path/topology discovery and routing loops. In the following, we discuss
similarities and diﬀerences to our work but we remark that the body of works
building on top of ICMP is far larger but conceptually diﬀer in that they do not
analyze ICMP as a by-product.
Bano et al. [3] also use ZMap and capture all (cross-layer) responses to probe
traﬃc to infer IP liveness but run speciﬁc measurements to generate this traﬃc,
we believe that our dataset could be used to perform a similar analysis. Malone et
al. [26] analyze the correctness of ICMP quotations. They base their analysis on a
dataset obtained via tcptraceroute in 2005, targeting around 84K web servers.
While most of the reported messages are of type ICMP time exceeded, they
also ﬁnd around 100 source quench messages, which were already deprecated
then. As we have shown, by looking at the ICMP responses to Internet-wide
scans, we are able to update their ﬁndings on a regular basis without having
to craft a dedicated dataset. Guo et al. [19] present FADER, an approach to
detect the presence of ICMP rate-limiting in measurement traces. While we did
not focus on rate-limiting, we found indicators for rate-limiting. We believe that
longitudinal studies seeded by Internet-wide scans can, in the long run, help to
overcome limited visibility due to rate-limiting.
In 2002, Hengartner et al. [20] have characterized and analyzed the presence
of routing loops in a Tier-1 ISP backbone trace. Xia et al. [35,36] have fur-
ther tracerouted over 9M IP addresses to ﬁnd routing loops in 2005. Transient
routing loops have also been subject to investigation [34] and they are well stud-
ied [14,32]. Lone et al. [25] investigate routing loops in CAIDA data to study
source address validation but do not focus on their prevalence in the Internet,
further, in contrast to using the CAIDA dataset that actively runs traceroutes
against all /24, we utilize indications from ongoing measurement data to investi-
gate loops. While these works show that routing loops are a known problematic
misconﬁguration, their presence in the Internet has not been analyzed for over
Hidden Treasures – Recycling Large-Scale Internet Measurements
65
10 years. By recycling Internet-wide scans, we can seed such investigations and
enable persistent monitoring of this phenomenon showing that routing loops are
still a problem today.
6 Conclusion
In this paper, we used ICMP responses triggered by large-scale Internet measure-
ments to study how the Internet’s control plane reacts to these measurements.
Thereby, we found that these responses are hidden treasures that are typically
neglected but oﬀer great insights into the conﬁguration of Internet-connected
systems. Our analyses of diﬀerent ICMP responses led us to many misconﬁgured
routers, e.g., sending ICMP redirects across the Internet, or outdated systems,
e.g., generating long-deprecated source quench messages. Further, our analy-
sis showed a large and nuanced degree of unreachability in the Internet. More
speciﬁcally, our scans hint at the existence of routing loops, which we found to
persist in large parts of the Internet. We hope that these ICMP by-products are
analyzed by more researchers when performing large-scale measurements and
that the regular nature of these scans will enable persistent monitoring of the
Internet’s control plane and that, especially when brought to the attention of
operators, misconﬁgurations can be ﬁxed. To this end, we make our dataset
publicly available at [22].
Acknowledgments. Funded by the Excellence Initiative of the German federal and
state governments, as well as by the German Research Foundation (DFG) as part of
project B1 within the Collaborative Research Center (CRC) 1053—MAKI. We would
like to thank the network operators at RWTH Aachen University, especially Jens Hek-
tor and Bernd Kohler as well as RWTH’s research data management team.
References
1. Augustin, B., et al.: Avoiding traceroute anomalies with Paris traceroute. In: ACM
IMC (2006)
2. Baker, F.: Requirements for IP Version 4 Routers. RFC 1812, RFC Editor (1995)
3. Bano, S., et al.: Scanning the internet for liveness. SIGCOMM CCR 48(2), 2–9
(2018)
4. Braden, R.: Requirements for Internet Hosts - Communication Layers. RFC 1122,
RFC Editor (1989)
5. Cisco: IP Routing Frequently Asked Questions. https://www.cisco.com/c/en/us/
support/docs/ip/border-gateway-protocol-bgp/28745-44.html#qa5
6. Cisco Systems, Inc.: Cisco IOS XR MPLS: mpls ip-ttl-propagate (2014). https://
www.cisco.com/c/en/us/td/docs/routers/xr12000/software/xr12k r4-1/mpls/com
mand/reference/b mpls cr41xr12k/b mpls cr41xr12k chapter 010.html#wp28648
46713
7. Custura, A., Fairhurst, G., Learmonth, I.: Exploring usable Path MTU in the
Internet. In: IFIP Network Traﬃc Measurement and Analysis Conference (2018)
8. Donnet, B., Luckie, M., M´erindol, P., Pansiot, J.-J.: Revealing MPLS Tunnels
obscured from traceroute. SIGCOMM CCR 42(2), 87–93 (2012)
66
J. R¨uth et al.
9. Durumeric, Z., et al.: The matter of heartbleed. In: ACM IMC (2014)
10. Durumeric, Z., Wustrow, E., Halderman, J.A.: ZMap: fast internet-wide scanning
and its security applications. In: USENIX Security (2013)
11. Edeline, K., K¨uhlewind, M., Trammell, B., Donnet, B.: copycat: Testing diﬀerential
treatment of new transport protocols in the wild. In: Proceedings of the Applied
Networking Research Workshop (ANRW) (2017)
12. Finn, G.G.: A connectionless congestion control algorithm. SIGCOMM CCR 19(5),
12–31 (1989)
13. Floyd, S.: TCP and explicit congestion notiﬁcation. SIGCOMM CCR 24(5), 8–23
(1994)
14. Francois, P., Bonaventure, O.: Avoiding transient loops during the convergence of
link-state routing protocols. IEEE/ACM Trans. Netw. 15, 1280–1292 (2007)
15. Gill, S.: ICMP redirects are ba’ad, mkay? Technical report, Team Cymru Inc.
(2002)
16. Gont, F.: ICMP Attacks Against TCP. RFC 5927, RFC Editor (2010)
17. Gont, F.: Deprecation of ICMP Source Quench Messages. RFC 6633, RFC Editor
(2012)
18. Graham, R.: MASSCAN: Mass IP Port Scanner (2018). https://github.com/
robertdavidgraham/masscan
19. Guo, H., Heidemann, J.: Detecting ICMP rate limiting in the internet. In: Beverly,
R., Smaragdakis, G., Feldmann, A. (eds.) PAM 2018. LNCS, vol. 10771, pp. 3–17.
Springer, Cham (2018). https://doi.org/10.1007/978-3-319-76481-8 1
20. Hengartner, U., Moon, S., Mortier, R., Diot, C.: Detection and analysis of routing
loops in packet traces. In: ACM SIGCOMM Workshop on Internet Measurement
(2002)
21. Hewlett Packard: HP-UX - Serviceguard A.11.19 on HP-UX 11.31: Source Quench
Seen for Every IPMON Ping. https://support.hpe.com/hpsc/doc/public/display?
docId=emr na-c02190964
22. R¨uth, J., Zimmermann, T., Hohlfeld, O.: ICMP Dataset and Tools (2018). https://
icmp.netray.io
23. Johnson, D.: Finding all the elementary circuits of a directed graph. SIAM J.
Comput. 4(1), 77–84 (1975)
24. Juniper Networks, Inc.: no-propagate-ttl
- TechLibrary - Juniper Networks
(2017). https://www.juniper.net/documentation/en US/junos/topics/reference/
conﬁguration-statement/no-propagate-ttl-edit-protocols-mpls.html
25. Lone, Q., Luckie, M., Korczy´nski, M., van Eeten, M.: Using loops observed in
traceroute to infer the ability to spoof. In: Kaafar, M.A., Uhlig, S., Amann, J.
(eds.) PAM 2017. LNCS, vol. 10176, pp. 229–241. Springer, Cham (2017). https://
doi.org/10.1007/978-3-319-54328-4 17
26. Malone, D., Luckie, M.: Analysis of ICMP quotations. In: Uhlig, S., Papagiannaki,
K., Bonaventure, O. (eds.) PAM 2007. LNCS, vol. 4427, pp. 228–232. Springer,
Heidelberg (2007). https://doi.org/10.1007/978-3-540-71617-4 24
27. Nokia: Router Conﬁguration Guide Release 15.0.R5. https://infoproducts.
alcatel-lucent.com/cgi-bin/dbaccessﬁlename.cgi/3HE11976AAACTQZZA01
V1 7450%20ESS%207750%20SR%207950%20XRS%20and%20VSR%20Router
%20Conﬁguration%20Guide%20R15.0.R5.pdf
28. Postel, J.: Internet Control Message Protocol. RFC 792, RFC Editor (1981)
29. Reynolds, J., Postel, J.: Assigned Numbers. RFC 1700, RFC Editor (1994)
30. R¨uth, J., Bormann, C., Hohlfeld, O.: Large-scale scanning of TCP’s initial window.
In: ACM IMC (2017)
Hidden Treasures – Recycling Large-Scale Internet Measurements
67
31. R¨uth, J., Poese, I., Dietzel, C., Hohlfeld, O.: A ﬁrst look at QUIC in the wild.
In: Beverly, R., Smaragdakis, G., Feldmann, A. (eds.) PAM 2018. LNCS, vol.
10771, pp. 255–268. Springer, Cham (2018). https://doi.org/10.1007/978-3-319-
76481-8 19
32. Sridharan, A., Moon, S., Diot, C.: On the correlation between route dynamics and
routing loops. In: ACM IMC (2003)
33. Varvello, M., Schomp, K., Naylor, D., Blackburn, J., Finamore, A., Papagiannaki,
K.: Is the web HTTP/2 yet? In: Karagiannis, T., Dimitropoulos, X. (eds.) PAM
2016. LNCS, vol. 9631, pp. 218–232. Springer, Cham (2016). https://doi.org/10.
1007/978-3-319-30505-9 17
34. Wang, F., Qiu, J., Gao, L., Wang, J.: On understanding transient interdomain
routing failures (2009)
35. Xia, J., Gao, L., Fei, T.: Flooding attacks by exploiting persistent forwarding loops.
In: ACM IMC (2005)
36. Xia, J., Gao, L., Fei, T.: A measurement study of persistent forwarding loops on
the internet. Comput. Netw. 51, 4780–4796 (2007)
37. Zimmermann, T., R¨uth, J., Wolters, B., Hohlfeld, O.: How HTTP/2 pushes the
web: an empirical study of HTTP/2 server push. In: IFIP Networking Conference
(2017)