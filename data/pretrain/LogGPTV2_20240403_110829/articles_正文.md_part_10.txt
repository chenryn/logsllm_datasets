1）优点
（1）扩展性。
可根据需要增加或减少集群节点。
（2）支持大规模数据集。
文件以块为单位，一个文件可以分布在多个节点上，HDFS中的典型文件大小一般在GB级至TB级。
（3）高吞吐量。
采用分布式并行处理和流式数据访问方式，可实现高吞吐量。
（4）容错性。
每个节点上都存有其他某些节点的备份。当一个节点出现故障时，可以快速检测，并从故障节点的备份中自动恢复。
（5）硬件要求低。
Hadoop对硬件要求不高，可以运行于普通商业计算机上。当硬件出现故障时，容错恢复机制可使用户感知不到中断。
2）缺点
（1）需要二次开发。
日志记录工具对Hadoop的支持有限，使用者往往需要根据自身需求开发基于Hadoop的系统。
（2）访问延时。
Hadoop为高吞吐量数据传输而设计，而这是以访问延时为代价的。
3\. 应用场景
Hadoop适用于非常大的日志文件存储，以及对查询延时要求不高的场景；不适用于大量小文件的存储、要求低延时的数据访问，以及多方读写、任意修改文件的场景。
### 6.3.3 文件检索系统存储
日志大多以文件的形式存储。如何在大量的文件中快速高效地搜索，不仅依赖于查询算法，还依赖于文件存储方式。合理地存储文件，能极大地提高查询速度。很多搜索引擎都采取倒排索引的存储方式。因为搜索引擎的数据操作比较简单，通常只有增、删、改、查这几个功能，且数据格式比较固定，所以可针对这些功能设计出简单高效的应用程序。
倒排索引也称反向索引、置入档案或反向档案，是一种索引方法。通过倒排索引，可以根据单词快速获取包含这个单词的文档列表。倒排索引主要由两部分组成：单词词典和倒排列表。现代搜索引擎大多采用倒排索引。相比于签名文件、后缀树等索引结构，倒排索引是实现单词到文档映射关系的最佳方式和最有效的索引结构。
常见的利用倒排索引存储和查询数据的系统有Lucene、Elasticsearch等。Lucene是Apache软件基金会Jakarta项目组的一个子项目，是一个[开放源代码](https://baike.baidu.com/item/%252525E5%252525BC%25252580%252525E6%25252594%252525BE%252525E6%252525BA%25252590%252525E4%252525BB%252525A3%252525E7%252525A0%25252581/114160)的全文搜索引擎工具包，但它不是一个完整的全文搜索引擎，而是提供全文搜索引擎的架构。Elasticsearch是基于Lucene的全文搜索引擎，也是一种流行的企业级搜索引擎。
1\. 存储和查询
Elasticsearch将文档数据以倒排索引的数据结构存储。倒排索引建立了单词和文档之间的映射关系，数据是面向单词而不是面向文档的。有倒排索引，自然就有正向索引，正向索引的数据是面向文档的。为什么倒排索引的数据结构更有利于查询呢？例如，当搜索某个关键字时，使用正向索引需要查询所有文档，即在每个文档对应的关键字索引列表中查找包含该关键字的索引，然后将所有包含该关键字索引的文档作为结果返回。如果文档量巨大，查询起来就会慢且吃力。若使用倒排索引，则直接在关键字列表中查找该关键字对应的文档索引，然后返回包含该关键字的所有文档即可，效率得到极大的提升。
2\. 优点和缺点
1）优点
（1）查找速度快。
倒排索引能提升搜索效率，尤其是面对海量数据时。当进行多关键字查询时，可先在倒排列表中完成查询的逻辑运算，再对记录进行存取，从而更有效地提高查找速度。
（2）并发能力强。
倒排索引通常被认为是不可变的，所以不需要上锁，因而能提升并发能力。
（3）节省CPU和磁盘I/O开销。
倒排索引可以进行压缩，从而节省CPU和磁盘I/O开销。
2）缺点
（1）创建索引较为耗时。
在存储文档时，需要对文档内的每个关键字创建相应的索引，这会产生一定的时间消耗。
（2）维护成本较高。
倒排索引不可变，如果修改一个文档，搜索引擎通常会对修改后的文档新建一个索引表，并将旧索引表删除。
3\. 应用场景
文件检索系统（搜索引擎）通常用于处理PB级的结构化或非结构化数据，包括存储和搜索。下面以Elasticsearch为例，介绍倒排索引的使用方法。
通过分词器的处理，文档被切分为单词集合，每个单词有对应的文档ID。这里以表6-1中的文档为例。
表6-1 文档示例
  ----------------------------------- --------------------------------------------
  文档ID                              文档内容
  1                                   中国是一个历史悠久的国家
  2                                   我们都有一个家，名字叫中国
  3                                   中国自研搜索引擎的代表是日志易的Beaver系统
  ----------------------------------- --------------------------------------------
根据文档内容创建的倒排索引示例见表6-2。
表6-2 根据文档内容创建的倒排索引示例
  ---------------------- ------------------------------------------------
  单词                   文档ID
  中国                   1, 2, 3
  一个                   1, 2
  历史悠久               1
  国家                   1
  我们                   2
  都有                   2
  家                     2
  名字                   2
  ---------------------- ------------------------------------------------
续表
  ---------------------- ------------------------------------------------
  单词                   文档ID
  自研                   3
  搜索引擎               3
  代表                   3
  日志易                 3
  Beaver                 3
  系统                   3
  ---------------------- ------------------------------------------------
如果以"中国"作为关键字进行搜索，那么需要先找到单词"中国"对应的文档ID，然后通过文档ID找到对应的文档，将文档内容作为结果返回。
倒排索引由单词词典和倒排列表组成。单词词典一般用B+树实现，倒排列表记录单词与文档的对应关系。除文档ID外，倒排列表中还包含其他一些关键信息，通常至少包含如下几项：
（1）DocID：文档ID。
（2）TF（Term Frequency）：单词频率，即单词在某个文档中出现的次数。
（3）Posting：位置，即单词在文档中出现的位置，多处出现则记录多个位置。
（4）Offset：偏移量，即单词在文档中开始和结束的位置。
上述示例中单词"中国"对应的文档信息见表6-3。
表6-3 单词"中国"对应的文档信息
  -----------------------------------------------------------------------
  DocID             TF                Posting           Offset
  ----------------- ----------------- ----------------- -----------------
  1                 1                 0                 \[0,2)
  2                 1                 4                 \[11,13)
  3                 1                 0                 \[0,2)
  -----------------------------------------------------------------------
### 6.3.4 云存储
云存储是一种新兴的数据存储解决方案，即把数据存放在多台虚拟[服务器](https://baike.baidu.com/item/%252525E6%2525259C%2525258D%252525E5%2525258A%252525A1%252525E5%25252599%252525A8)（通常由第三方托管）上。现在中外各大互联网厂商都开始提供云存储服务，大多数云存储服务中都包含日志的存储和处理。
1\. 存储和查询
云存储，顾名思义，是指云端的存储服务。云存储以集群方式部署，通过云计算、分布式文件系统等技术，使网络中大量不同类型的存储设备协同工作，共同对外提供数据存储和业务访问功能。使用者通过购买或租赁的方式，向服务方申请使用云存储服务，之后可以在任何地方通过连接互联网的设备访问数据。
2\. 优点和缺点
1）优点
（1）方便存储和访问。
只要能连接互联网，就能方便地进行读写操作。
（2）方便扩容。
云存储整合了分散在不同地方的服务器。使用者只要提出扩容需求，云存储服务商就会处理扩容事宜。
（3）降低成本。
针对海量数据的存储和查询，企业本地部署和维护一套处理系统的成本远远高于购买云存储服务的成本。云存储服务由专业团队进行开发和维护，使用者只要付费即可使用。
（4）容灾备份。
云存储是分布式应用，服务商通常会提供数据备份功能，并且在一台服务器出现故障时可以自动切换到另一台服务器，使用者不会感觉到服务中断。
2）缺点
（1）读写速度受网络环境影响。
云存储依托于网络，所以网络环境会影响云存储的上传和访问速度。
（2）数据安全性不高。
云存储分为公有云、私有云和混合云。公有云的计算能力强，私有云的安全性较高，混合云结合了二者的优点。但没有绝对安全的云存储，使用者还是需要采取一些加密或安全措施。
## 6.4 日志物理存储
日志的存储方式、存储格式都很重要，但对于硬件的要求，也是不容小觑的。物理存储直接影响检索和访问的速度。日志物理存储一般分为3类：在线存储、近线存储、离线存储，见表6-4。
表6-4 日志物理存储
+------+--------------------+----------------------+------------------+
| >    | > 在线存储         | > 近线存储           | > 离线存储       |
| 类型 |                    |                      |                  |
+======+====================+======================+==================+
| >    | >                  | > 介于在线存         | > 通             |
| 简介 | 存储设备时刻待命， | 储和离线存储之间，数 | 常需要人工介入查 |
|      | 以便用户随时访问， | 据访问频率不是很高， | 询和访问。它是对 |
|      | 对访问速度要求较高 | 因而对访问速度要求不 | 在线存储的备份， |
|      |                    | 太高，但要求容量较大 | 以防数据丢失。访 |
|      |                    |                      | 问速度慢，频率低 |
+------+--------------------+----------------------+------------------+
| >    | > 计算机磁盘       | > 移动硬盘           | > 备份光盘或磁带 |
| 举例 |                    |                      |                  |
+------+--------------------+----------------------+------------------+
| >    | > 较高             | > 适中，             | > 较低           |
| 成本 |                    | 大约是在线存储的一半 |                  |
+------+--------------------+----------------------+------------------+
| >    | > 访               | > 性能较好，         | >                |
| 优点 | 问速度快，性能较好 | 传输速率高，容量较大 | 成本较低，容量大 |
+------+--------------------+----------------------+------------------+
| >    | > 系               | > 近期备份数据       | > 历史数据       |
| 适用 | 统当前需要使用的数 | 、访问不太频繁的数据 | 、很少访问的数据 |
| 对象 | 据、访问频繁的数据 |                      |                  |
+------+--------------------+----------------------+------------------+
在实际应用中，应根据场景、需求、预算等具体情况，选择合适的存储介质，以达到最高的性价比。