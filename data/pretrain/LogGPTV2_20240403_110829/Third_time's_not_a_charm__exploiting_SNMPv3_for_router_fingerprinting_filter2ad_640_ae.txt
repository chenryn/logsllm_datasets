we present a heat map for the popularity of each vendor in all
the ASes of a region (continent). Cisco is the dominant vendor
across all regions. The second most popular is Huawei with about
27% market share in Asia, around 22% in Europe, and close to 14%
in South America and Africa. However, we could not find any
Huawei router in North America and less than 1% in Oceania. The
contributions of other router vendors is very low across regions.
We conclude that although the number of vendors per AS may be
high only a relatively small number of routers contribute to this
diversity, as there is a strong consolidation driven by two major
router manufacturers, Cisco and Huawei.
6.4.4 Vendor Popularity in Large Networks. Finally, we perform a
case study for the top 10 networks by number of routers. These are
networks with at least 4.5k routers. They are distributed in different
continents, four in Europe, four in North America, and one in Asia
and South America. In Figure 15, we report the popularity of each
Figure 16: Router vendor popularity for top 10 networks by
number of routers with number of routers in parenthesis.
vendor and in parenthesis the number of routers per AS. In 6 out of
10 of these networks Cisco is dominant. However, in the network
from Asia and in two of the networks in Europe, Huawei is domi-
nant. Typically, the large networks have only one dominant vendor,
however, one of the networks in the top 10 list has deployed both
Cisco and Huawei routers as well as UNIX-based router solutions.
Again, although we see multiple router vendors present in all top
10 networks, the large majority of the routers (typically, more than
95%) belongs to only one or two vendors. Thus, large networks can
be potentially vulnerable to vulnerabilities of a single major vendor
as their deployment is quite uniform.
6.5 Vendor Dominance
We also study the homogeneity of router vendors in each network.
In order to analyze this homogeneity we introduce a new metric,
vendor dominance, i.e., the fraction of routers belonging to the most
dominant router vendor in that AS. Thus, the closer the vendor
dominance is to 1, the higher higher is the share of routers belonging
to only a single vendor in this network. This is a critical property
of a network, as vulnerabilities of the dominant vendor may be
exploited and affect a large fraction of the deployed routers. In
Figure 17 we show the distribution of the vendor dominance across
ASes. We notice that the the values of vendor dominance are high
throughout many networks: more than 80% of the networks have
a vendor dominance of 0.7 or more. This shows that, typically,
there is a single very popular vendor per network, that can well be
160
CiscoHuaweiNet-SNMPJuniperOtherEU (134k)NA (97k)AS (81k)SA (22k)AF (5k)OC (5k)20406080CiscoHuaweiNet-SNMPJuniperOtherEU-1 (9.4k)EU-2 (9.0k)EU-3 (8.9k)EU-4 (5.2k)AS-1 (7.0k)SA-1 (6.4k)NA-1 (8.0k)NA-2 (6.5k)NA-3 (5.6k)NA-4 (4.6k)020406080IMC ’21, November 2–4, 2021, Virtual Event, USA
Taha Albakour et al.
Figure 17: Vendor dominance for routers found with SNMPv3
measurements per AS.
Figure 18: Vendor dominance for routers found with SNMPv3
measurements per region for ASes with at least 10 routers.
different from network to network. Next, we turn our attention to
the regional characteristics of networks with at least 10 routers as
measured with SNMPv3, see Figure 18. We notice that there are two
groups of regions: (i) South America, Asia, Africa, and (ii) Oceania,
North America, Europe. The vendor dominance of networks in the
first group is typically lower than in those of the second group.
7 RELATED WORK
Prior work has developed passive and active techniques that lever-
age identifiers and implementation-specific differences to finger-
print and de-alias devices at various granularities. This section
details these existing methods.
7.1 Router Vendor Fingerprinting
Nmap: Nmap is an open-source network scanning and reconnais-
sance tool that can perform operating system fingerprinting [46].
It sends a series ICMP echo requests, UDP packets, and TCP probes
with different field values, flags, and options to fingerprint the re-
mote system. By examining the responses, e.g., length, options,
window size, sequence numbers, IP ID and TTL values, checksum,
and flags, Nmap finds the best matching implementation in its data-
base of operating system fingerprints. The latest version of Nmap
(7.91) contains 5,679 fingerprints; of these, approximately 160 and
22 correspond to Cisco and Juniper routers respectively. While
Nmap is a powerful tool for TCP/IP fingerprinting, it requires the
remote host to listen and respond on an open TCP port. Because
routers in the wild are secured and typically do not respond to
unsolicited TCP probes, Nmap is generally ineffective for router
fingerprinting.
Scanning: A second popular technique for remotely inferring oper-
ating system and vendor information is “banner grabbing,” whereby
publicly available services leak information. For instance, the Cisco
SSH server implementation returns identifying information in its
response string. Internet-wide scanning and banner grabbing are
performed regularly [14, 21, 22, 33]. Recent work has sought to find
banners and augment with active and analysis of banners and aug-
mentation with active measurements [30] to perform large-scale
network vendor inference. Unfortunately, as with Nmap’s reliance
on TCP, banner analysis requires a publicly responsive service that
returns discriminating information. Routers are frequently tightly
secured and unresponsive to banner queries.
TTL: Due to the relatively closed nature of routers, Vanaubel et al.
developed a fingerprinting technique based solely on TTL responses
[59]. They send TCP, UDP, and ICMP probes toward the target, and
show that the tuple of inferred initial TTL (iTTL) values from the
responses can differentiate between some well known platforms,
including Cisco and Juniper. Unfortunately, the universe of possible
iTTL values is small, and can lead to a large number of incorrect
inferences, e.g., Huawei has the same iTTL signature as Cisco.
7.2 Router Alias Resolution
Identifiers: Techniques for discovering router aliases were first
developed by exploiting an implementation behavior where ICMP
port unreachable responses were generated with a source address
of the interface toward the destination, regardless of which inter-
face IP was originally probed [26]. Other techniques have included
pre-specified timestamps [54] and graph analysis [27]. More re-
cently, Marder proposed using path length estimation [40] while
Vermeulen et al. leverage ICMP rate limiting [60]. However, to date,
state-of-the-art systems use IP ID based alias resolution.
IP ID: The IP identifier (IP ID) field is used for fragmentation and
reassembly. Since IP ID is a mandatory field in IPv4, it is possible
to elicit an IP ID value from a router via a simple ICMP echo. This
value is typically set in one of three ways: zero (in conjunction with
the “don’t fragment” bit), randomly, or sequentially for each new
packet. While this information can convey some information about
the router vendor, IP IDs can be used for alias resolution—the pro-
cess of determining if multiple IP addresses correspond to different
interfaces on the same router (i.e., are aliases). In many implemen-
tations, the IP ID counter is shared among different interfaces on
the router [55]. Current state-of-the-art alias resolution techniques
sample the IP ID value of candidate IPs over time and perform a
monotonic bounds test on IP ID sequences to infer aliases [34].
Similar techniques have been developed for IPv6 [38]. As the IP ID
is only 16 bits long, it can increment and wrap faster than it can
161
0.00.20.40.60.81.0Vendor Dominance of SNMPv3 Routers per AS0.00.20.40.60.81.0ECDF: Fraction of ASesASes 2+ RoutersASes 5+ RoutersASes 10+ RoutersASes 50+ RoutersASes 100+ Routers0.00.20.40.60.81.0Vendor Dominance of SNMPv3 Routers per AS per Region0.00.20.40.60.81.0ECDF: Fraction of ASesNA (663 ASes)EU (870 ASes)AS (530 ASes)SA (92 ASes)AF (99 ASes)OC (74 ASes)Third Time’s Not a Charm: Exploiting SNMPv3 for Router Fingerprinting
IMC ’21, November 2–4, 2021, Virtual Event, USA
be sampled if the router has a large traffic rate. As a result, IP ID
techniques suffer from false positive and false negative errors [39].
Further, finding aliases based on IP ID at Internet-scale remains
challenging, and requires intensive probing and computation. In
contrast, our technique elicits a strong, unique, and persistent iden-
tifier that can discover aliases much more efficiently.
7.3 Dual-stack Inference
Comparatively less work has made progress on finding dual-stack
aliases, especially for routers. Scheitle et al. use TCP timestamp
skew to identify IPv4/IPv6 siblings, but, as routers are generally un-
responsive to TCP probes, their work largely centers on servers [52].
Berger et al. developed a method to reveal dual-stack addresses of
name servers [2]. And while Czyz et al. examined IPv6 security
posture as compared to IPv4 [19], they too had no method to resolve
dual-stack router aliases. To date, the only viable technique for dual-
stack router alias resolution has been through DNS inference, in
particular using Luckie’s method for extract router hostnames [39]
which we compare against.
8 DISCUSSION
Remediation. In consultation with Cisco’s product security in-
cident response team, we learned that they had multiple existing
bugs [17, 18] (the oldest one is from 2012) along with a reserved
CVE [57] relating to SNMPv3 information leakage. As a fix, Cisco
added a new configuration command that instructs the router to
drop (and not respond to) SNMP packets for an unknown user
(specifically: snmp-server drop unknown-user). While this patch
is welcome, our findings underscore the fact that, despite this vul-
nerability being known for nearly a decade, it persists in the wild.
Further, operators must know of, and explicitly enable, this config-
uration option in their equipment. As such, we recommend that
this configuration become the default in the future.
Follow Best Current Security Practices When Running SN-
MPv3. To our surprise, millions of devices, including hundreds
of thousands of routers, respond to unauthorized and unsolicited
SNMPv3 requests. Recall that all of our requests were launched
by a server in a single data center, implying that these devices ei-
ther were not behind a firewall or the firewall was not properly
configured. If the network administrators had applied best current
security practices, e.g., access control lists or segregated out-of-band
management, we would expect significantly fewer responses. This
would have mitigated the potential vulnerabilities we identified at
large. Similarly surprising, as mentioned in Section 3, we did not
receive any complaints (although we provided contact information)
when we scanned routers, in striking contrast to scans performed
in the past for servers. This can be attributed to the fact that SN-
MPv3 scans are stealthy as they send only a single UDP packet,
but it also suggests that routers and other connected devices that
run SNMPv3 are not well monitored by network administrators for
scanning activity. Operators may want to more rigorously monitor
such external management queries to their infrastructure.
Implicitly Enabling SNMPv3. In addition to the open network
access policies previously identified, a likely explanation for the
large number of responsive SNMPv3 devices is that some vendors
and implementations automatically enable SNMPv3 when SNMPv2
is enabled (see Section 6.2). Instead, we recommend that implemen-
tations require explicit configuration to enable SNMPv3 to ensure
that operators are consciously running SNMPv3.
Potential Vulnerabilities of Current SNMPv3 Implementa-
tion. There are more than 400 vulnerabilities related to SNMP [41].
While many of these vulnerabilities are related to specific imple-
mentations, our observations on SNMPv3’s behavior exposes a
more fundamental fingerprinting weakness. Whereas an unautho-
rized and unsolicited request in SNMPv2 does not elicit a response,
SNMPv3, by design, does respond. Our study shows that potentially
millions of devices will respond to such SNMPv3 requests. More-
over, as SNMPv3 is UDP-based, it is trivial to spoof the source of
these requests, akin to other spoofed-source attacks [4, 25, 48, 51].
More concerningly, in some of our measurements, a single request
resulted in multiple (identical) responses. For example, in the the
first IPv4 scan, more than 182k IPv4 addresses responded with more
than one request, 48 of which returned more than 1,000 responses
within two to twenty hours. One of them, sent back 48,500,523
response packets within two hours. Although the exact cause of
this behavior is not known, similar behavior has been reported for
other handshaking protocols [36]. In the second IPv4 scan, we also
saw different addresses return a large number of responses. Thus,
SNMPv3 could be potentially exploited for amplification attacks.
Towards SNMPv4. Although SNMPv3 offers a stronger security
model than its predecessors, our study uncovered shortcomings
in the protocol that enable fingerprinting. A fundamental design
tension exists between maintaining the stateless operation of SNMP
and the security mechanisms. While proposals to utilize standards
such as TLS with SNMP have been drafted to protect datagrams [28],
such approaches may present other concerns, including the ability
to perform certificate-based fingerprinting. A more immediate solu-
tion is to not use MAC addresses as the engine ID. While the engine
ID needs to be persistent, re-purposing MAC addresses has a long
history in network security of enabling fingerprinting and other
attacks. Further, researchers have shown that obtaining the per-
sistent engine ID permits brute force SNMPv3 password recovery
attacks [58]. We thus encourage protocol designers in the future
to consider the weaknesses of a persistent engine ID, as well as
discourage the use of MAC address-based engine ID.
9 CONCLUSION
In this paper, we show that the adoption of a secure network man-
agement protocol, SNMPv3, surprisingly increases device finger-
printing capabilities. By design, devices that run SNMPv3 respond
to unauthorized and unsolicited authentication requests with a de-
vice unique identifier and other critical status and configuration
information. We show that SNMPv3 allows for light and accurate
alias resolution, dual-stack association, and fingerprinting with
only a single request per IP. With our technique we were able to
de-alias and fingerprint more than 4.6 million devices, including
around 350k routers. Our analysis provides fresh insights on the
router vendor share, router deployment strategies of network op-
erators around the world, as well as router uptime statistics and
distribution of vendors in different regions. We hope that our tech-
nique can be used for answering other network analytics questions
in the future, e.g., inferring NAT and load balancers in the wild.
162
IMC ’21, November 2–4, 2021, Virtual Event, USA
Taha Albakour et al.
Acknowledgments
We thank Cas D’Angelo for providing invaluable operational net-
work validation. We would also like to thank our shepherd Mattijs