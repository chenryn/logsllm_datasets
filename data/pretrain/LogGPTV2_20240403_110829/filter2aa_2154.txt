# 指令型远控软件轻松谈

## 简介
- 了解指令型远端操控软件的基本架构。

## 训练大纲
1. **单元 1：何谓远控软件**
2. **单元 2：远控软件分析**
3. **单元 3：总结**

---

### 单元 1：何谓远控软件
- **定义**：能够控制远程计算机的软件都可以称为远程控制软件。
- **工作方式**：大部分远程控制软件通过网络实现对远程计算机的控制。
- **类型**：
  - **木马**：通常用于非法访问。
  - **后门**：为攻击者提供未经授权的访问。
  - **VNC**：虚拟网络计算，一种合法的远程桌面工具。

---

### 单元 2：远控软件分析
#### 如何连接
- **Socket编程基础**：
  - **Server端**：
    - `Socket()`
    - `Bind()`
    - `Listen()`
    - `Accept()`
    - `Read()`
    - `Write()`
  - **Client端**：
    - `Socket()`
    - `Connect()`
    - `Write()`
    - `Read()`

- **连接方式**：
  - **反向连接**：一般木马使用这种连接方式。
  - **正向连接**：如远程桌面使用这种方式连接。

- **连接过程**：
  - **Servant Connect (反向)**：
     - 载入对象 & 数组
     - 断线
     - 释放对象 & 数组
     - 验证密码
     - 成功建立连接
  - **Master Connect (正向)**：
     - 载入Servant资料
     - 成功建立连接

- **控制模式**：
  - **一对一控制**：一个Master控制一个Servant。
  - **一对多控制**：一个Master同时控制多个Servant。
  - **中继站**：通过中继站进行多台计算机的控制。

- **功能对比**：
  - **一对一**：如远程桌面、VNC等。
  - **一对多**：如rootkit、灰鸽子、Evis等。

- **功能不足**：
  - 功能越多，文件越大。
  - 功能越多，按钮越多。
  - 设计者可能没有考虑到某些功能。

- **指令界面的优点**：
  - **宏**：允许用户自定义组合指令。
  - **简洁界面**：减少不必要的按钮。

- **如何执行指令**：
  - **参数替换**：将宏指令替换成基本指令。
  - **宏系统**：用户自定义宏指令。
  - **队列系统**：将英文指令转换成内码指令，并修正目标。
  - **指令解析系统**：处理中断和非中断指令。
  - **Timer Event**：从队列中提取并执行指令。

- **示例**：
  - **宏系统**：
    ```plaintext
    Dload http://test.tw/1.rar
    Download http://test.tw/1.rar|C:\test.rar|1
    ```

- **指令分类**：
  - **本地执行指令**：如清除屏幕、设定控制端功能。
  - **远程执行指令**：查看远程所有进程、要求远程下载文件。

- **指令编码**：
  - **函数名与代码对应**：
    ```plaintext
    Function Name | Function Code | MSF Code
    -----------------------------------------
    ClearScreen   | 000           | 101
    SetFeature    | 001           | ...
    ```

- **示例演示**：
  - **输入指令**：`Urun C:\a.exe`
  - **宏内容**：`Urun ads = Send ads|C:\a.exe + RunS a.exe`
  - **参数替换**：`FSend C:\a.exe|C:\a.exe + RunS a.exe`
  - **指令替换**：`FSend C:\a.exe|C:\a.exe` 和 `RunS a.exe`
  - **内码转换**：
    ```plaintext
    101 C:\a.exe|C:\a.exe
    120 a.exe
    ```
  - **执行指令**：`Write (001C:\a.exe|10240|1)` 并传送文件传输信号。
  - **文件传输**：建立另一组连接后传输二进制数据。
  - **完成传输**：执行队列中的下一个指令 `Write (020C:\a.exe)`

- **Google搜索示例**：
  - 搜索 `Evis Ain`

---

### 单元 3：总结
- **宏的作用**：
  - 允许用户创建新的功能，如传输/下载执行文件并执行、传输/下载DLL文件并调用。

PDF created with pdfFactory Pro trial version www.pdffactory.com