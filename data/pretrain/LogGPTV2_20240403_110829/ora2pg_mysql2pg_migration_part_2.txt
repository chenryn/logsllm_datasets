### Oracle to PostgreSQL Migration Guide

#### Introduction
Migrating from Oracle to PostgreSQL can be a complex task, but with the right tools and strategies, it can be managed efficiently. This guide will provide a step-by-step approach to help you through the migration process.

#### 1. Handling Outer Joins
- **Oracle Syntax**: Oracle uses the `(+)` notation for outer joins, which is deprecated.
- **ANSI Compliant Join Syntax**: It is recommended to use ANSI-compliant join syntax.
- **Automation Tools**:
  - **Toad**: Use the Query Builder to load your SQL code and convert it to ANSI join syntax.
    - **Steps**:
      1. Open Toad Query Builder.
      2. Load your SQL code.
      3. Refactor → Convert to ANSI Join Syntax.
  - **Oracle SQL Developer**: Similar functionality is available in Oracle SQL Developer.
- **Manual Conversion**:
  - If automation tools are not sufficient, manual conversion may be necessary. This can be time-consuming, so consider using tools to speed up the process.

#### 2. Converting DECODE Function
- **Oracle Specific Function**: The `DECODE` function is specific to Oracle.
- **Standard CASE Clause**: Oracle recommends using the `CASE` clause since version 9i.
- **Orafce**: You can also use the Orafce extension, which provides an `orafce.decode()` function.
- **Automation Tools**:
  - **Toad**: Use the Refactor feature to convert `DECODE` to `CASE`.
    - **Steps**:
      1. Open Toad.
      2. Refactor → Convert Decode to Case.
- **Manual Conversion**:
  - If automation tools are not sufficient, manually replace `DECODE` with `CASE`.

#### 3. Migrating Spatial Data
- **Oracle Spatial/Locator Type**:
  - **Table Definition**:
    ```sql
    CREATE TABLE cola_markets (
        mkt_id NUMBER PRIMARY KEY,
        name VARCHAR2(32),
        shape SDO_GEOMETRY
    );
    ```
  - **SDO_GEOMETRY Type**:
    ```sql
    SDO_GEOMETRY(
        2001, -- Indicates the type of the geometry, here a point
        NULL, -- Identify a coordinate system (SRID: spatial reference system)
        NULL, -- SDO_POINT attributes X, Y, and Z, all of type NUMBER
        SDO_ELEM_INFO_ARRAY(1,1,1), -- Element information array
        SDO_ORDINATE_ARRAY(10, 5) -- Coordinates Array
    )
    ```

- **PostGIS Spatial Type**:
  - **Table Definition**:
    ```sql
    CREATE TABLE cola_markets (
        mkt_id bigint PRIMARY KEY,
        name varchar(32),
        shape geometry(GEOMETRY)
    );
    ```
  - **Geometry Types**:
    - **WKT (Well-Known Text)**:
      ```sql
      'LINESTRING(0 0, 1 1, 2 1, 2 2)'
      ```
    - **WKB (Well-Known Binary)**:
      ```sql
      0101000020040000000000000000000000000000000000000000000000000000000...
      ```

- **Geometry Constraints**:
  - **Enforcing Geometry Types**:
    ```sql
    CREATE TABLE stores (
        id integer,
        gps_position geometry(POINT),
        sale_area geometry(POLYGONZ)
    );
    ```
  - **3D and 4D Objects**:
    - **Suffixes**: `Z` for 3D, `ZM` for 4D.
    - **Examples**:
      - `GEOMETRY / GEOMETRYZ / GEOMETRYZM`
      - `POINT / POINTZ / POINTZM`
      - `POLYGON / POLYGONZ / POLYGONZM`

- **Default Geometry**:
  - **Mixed Geometry Types**:
    ```sql
    shape geometry(GEOMETRY)
    shape geometry(GEOMETRY, 4326)
    ```

- **SRID (Spatial Reference System)**:
  - **Conversion**:
    - **Oracle "legacy" vs. Standard "EPSG"**:
      - **Function**: `map_oracle_srid_to_epsg()`
      - **Default SRID**: `4326`
    - **Enforcing a Particular SRID**:
      - **Example**: `CONVERT_SRID 27572`

- **Detecting Geometry Constraint**:
  - **Ora2Pg**:
    - **Detection Methods**:
      - **Index Parameters**: `CREATE INDEX ... PARAMETERS ('sdo_indx_dims=2, layer_gtype=line')`
      - **Sequential Scan**: `SELECT DISTINCT c.SDO_GTYPE FROM MYTABLE c WHERE ROWNUM < AUTODETECT_SPATIAL_TYPE`

- **Inserting Geometry**:
  - **Oracle**:
    ```sql
    INSERT INTO cola_markets VALUES (
        302, 'Rectangle',
        SDO_GEOMETRY(
            2003, -- 2D polygon
            8307,
            NULL,
            SDO_ELEM_INFO_ARRAY(1,1003,3), -- a rectangle
            SDO_ORDINATE_ARRAY(1,1, 5,7) -- 2 points define the rectangle
        )
    );
    ```
  - **PostGIS**:
    - **WKT**:
      ```sql
      INSERT INTO cola_markets (mkt_id, name, shape) VALUES (
          302, 'rectangle', 'POLYGON ((1.0 1.0, 5.0 1.0, 5.0 7.0, 1.0 7.0, 1.0 1.0))'
      );
      ```
    - **WKB**:
      ```sql
      INSERT INTO cola_markets VALUES (302, 'rectangle', '01ea03000003000000000000000000000000000000000000000000000000000000000000000000000000f03f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000