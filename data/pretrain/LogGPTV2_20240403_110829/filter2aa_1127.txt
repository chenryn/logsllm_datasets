www.dbappsecurity.com.cn
百举百捷：
红队视角下又一个突破口，
再看大国独有小程序
2020.6.16/Poc Sir
À propos de moi
关于我
Poc Sir
PI:EMAIL
雷神众测以及其他平台专业打酱油白帽子
Hack Inn « www.hackinn.com » 安全议题分享平台运营者
安恒信息实习4年的最长实习生，未来仍将实习
目前一直呆在法国，欢迎大家来找我思考美食、人参
喜欢聊聊两岸三地，微博号挺多的红V、蓝V、橙V、没V都有
Contents
目录
小程序概览
01
获取小程序源码
02
初探好玩的CMRF漏洞
03
小程序的特有API漏洞
04
05 第三方那些事
小程序概览
01
小程序他🔥吗？ —— 太火了
“后疫情时代”海外人员归国离不开“防疫健康码国际版”
当你在微信分享“微博”“百度网盘文件”时离不开对应小程序
他已经慢慢的渗透进了我们的互联网生活……
那他为什么能火呢？
1.强大的平台依托，谁不用微信&支付宝
2.方便、轻量，好东西为啥不用？
3.各方重视，大力发展，互联网时代潮流
字节跳动
百度
京东
阿里巴巴
腾讯
今日头条
西瓜视频
抖音
皮皮虾
百度APP
京东APP
京东金融
京麦APP
高德导航
UC浏览器
淘宝
支付宝
微信
QQ
QQ浏览器
哪些平台有小程序生态？
单纯在小程序平台层面我们能做什么？
资产搜集！
信息搜集！
快速搜索企业小程序
判别资产归属
轻松获取子域名
脚本源
码自取
🐎######🐎
自己送上门的信息
获取小程序源码
02
安卓保存路径：/data/data/com.tencent.mm/MicroMsg/{用户ID}/appbrand/pkg/
IOS 保存路径：/var/mobile/Containers/Data/Application/{程序-
UUID}/Library/WechatPrivate/{用户ID}/WeApp/LocalCache/release/{小程序ID}/
.wxapkg文件
IOS 保存路径：
/var/mobile/Containers/Data/
Application/{程序-
UUID}/Documents/NAMAPP_
UNZIP/{随机ID}/
未加密压缩包
还原小程序
xml (axml 阿里、wxml 微信、jxml 京东)
＆ css (acss、wxss、jxss) ＆ js ＆ json
不见了！！
多出来的HTML文件是啥？
为啥打开之后一片空白？
你是谁？你变了，
变的开发者工具都不认识你了
支付宝小程序
微信小程序
index.js
(页面名称).html
wxss文件
acss文件
支付宝小程序
微信小程序
index.woker.js
app-service.js
js文件
js文件
支付宝小程序
微信小程序
appConfig.json
app-config.json
json文件
json文件
支付宝小程序
微信小程序
page-frame.html
index.js
wxml文件
axml文件
初探好玩的CMRF漏洞
03
看不见却实际存在的页面路径
可传入数据但又无法直接修改
pages/archives/detail.html?id=492&title=
HackingDay 2019 HangZhou
CMRF 跨小程序请求伪造漏洞
（Cross MiniAPP Request Forgery）
利用小程序对用户在对应平台上身份的
信任，在获取页面传入的参数之后结合
用户已经登录的身份信息向小程序后端
发送对应的数据包，从而使用户在无意
间完成一次具有危害性的请求操作。
/pages/my/changepwd.html
?newpwd=新的密码
输入密码点击修改
https://example.org/user/changepwd.do?
password=新密码&token=用户身份信息
构造恶意分享内容
…?newpwd=Abc123
诱导
点击
CMRF
完整
拟真
利用
Title:决定页面描述
Des:决定小程序标题
Pagepath: 决定小程序页面
路径以及传入参数内容
alipays://platformapi/startapp?appId=小程
序ID号&page=urlencode之后的页面数据
/pages/index/thorsrc?date=616&whoami=Poc-Sir
……
baiduboxapp://swan/小程序ID号/?传入页面数据
dingtalk://dingtalkclient/action/open_mini_app?miniApp
Id=appid&page=页面?传入数据内容
支付宝调用
视频DEMO
小程序的特有API漏洞
04
微信
字节跳动
支付宝
第三方那些事
05
第三方一键生成平台
第三方后台管理平台
第三方管理平台插件
第三方小程序端插件
第三方小程序端JDK
第三方开发账户授权
www.dbappsecurity.com.cn
谢谢观看
Merci beaucoup！