precision
recall
F1 score
30% Manual
Labels
Public only
20% Manual
0.9698
0.9510
0.9396
0.9453
0.9634
0.9367
0.9142
0.9253
0.9633
0.9380
0.9087
0.9232
408          22nd International Symposium on Research in Attacks, Intrusions and DefensesUSENIX Associationdata within an hour, get the detection results, accumulate label
information, and the cycle repeats.
In CERNET2, on average, about 40 thousand clients initi-
ate 3.8 million DNS requests within an hour and about 0.25
million unique domains exist after graph pruning. With Hin-
Dom we ﬁnd 3.34% domains are malicious. The result is
proved to be reliable by experts certiﬁcation and some of
these malicious domains are detected several months before
they are reported by public services. In particular, HinDom
detects a bunch of domains that are not listed in any pub-
lic blacklists, neither are the IP addresses they are resolved
to. After consulting Qihoo 360, a Chinese internet security
company, we conﬁrm these domains belong to a long-buried
mining botnet named MsraMiner. In TUNET, about 50 thou-
sand clients request for 0.4 million unique domains per hour.
With closer network supervision, the proportion of malicious
domains drops to 1.21%. However, we still detect the variation
of MsraMiner, with domains like ra1.kziu0tpofwf.club and
sim.jiovt.com, in the campus network. The above detection re-
sults have been reported to the relevant network management
department.
6 Limitation and Future Work
Currently, HinDom constructs a HIN of clients, domains and
IP addresses based on the DNS-related data and can perform
well even with a small fraction of labeled samples. Yet there
are some potential problems in views of scalability and prac-
ticability. We discuss HinDom’s limits and our future work in
this section.
First, efﬁciency. With a graph-based mechanism, HinDom
cannot be deployed in a real-time mode. We need to choose
a proper time window T to collect data and then conduct the
detection procedure off-line. If T is too small, the collected
data will not be sufﬁcient for accurate detection. Yet with a
very big time window, HinDom will need more computing
resources and longer detection time. Thus, there is a trade-off
between accuracy and efﬁciency. We have mentioned that
the multiplication between adjacency matrices in HinDom
is a resource-consuming operation. We recommend matrix
block calculation and parallel computation framework like
Hadoop in the real-world deployment. Besides, we ﬁnd that
embedding is an up-and-coming approach to represent graphs
in a low dimensional way. Some embedding methods such as
HIN2Vec [13] and ESim [30] have been proposed to repre-
sent nodes in HIN, which can be used to improve HinDom’s
efﬁciency.
Second, the detection range. As an association-based de-
tection system, HinDom can only detect malicious domains
that have direct or indirect relations with others. When a new
type of malicious domain is just registered and has few rela-
tions with other entities, HinDom cannot detect it immediately.
Besides, HinDom may not hold a good performance when
detecting malicious domains hosted by network services like
Figure 8: ROC of detection with public or manual labels
5.7 Compare with detection engines
To test HinDom’s practicality, we also compare its perfor-
mance with existing Detection Engines (DE) on VirusTo-
tal [34]. We randomly choose 30% domains from the exper-
imental dataset as testing samples and collect the detection
results of all 66 engines in VirusTotal. Due to space limita-
tions, Table 10 only displays nine engines that have relatively
good performance or that are widely used by security vendors
like McAfee, Kaspersky, etc. We can see that HinDom out-
performs six out of nine engines with accuracy: 0.9697 and
F1-score: 0.9460. This is a remarkable result as these engines
are supported by more expertise and the label information of
our experimental dataset is partly depended on VirusTotal.
Table 10: Detection results of engines from VirusTotal
Engines HinDom
0.9697
0.9460
DE5
0.9812
0.9747
F1-score
Engines
F1-score
ACC
ACC
DE1
0.9038
0.8898
DE6
0.9846
0.9800
DE2
0.9785
0.9701
DE7
0.9023
0.8975
DE3
0.8952
0.8824
DE8
0.9116
0.9048
DE4
0.9603
0.9511
DE9
0.8974
0.8423
5.8 Real-world Deployment
We implement a prototype system of HinDom and deploy it in
CERNET2 and TUNET. Though HinDom is not a real-time
detection system, it can be run every hour or every day to de-
tect ongoing malicious activities. Taking computing resources
and the network scale into consideration, we choose to set
the time window T to one hour in our deployment. In other
words, we construct a HIN instance based on the DNS-related
USENIX Association        22nd International Symposium on Research in Attacks, Intrusions and Defenses 409CDN, as they are related to a large number of benign domains.
To eliminate these problems, we plan to utilize more types
of DNS-related data and dig out richer associations among
domains. For example, WHOIS dataset is an important clue
with information about registered users or assignees. Besides,
for now, we only use A, AAAA and CNAME records in DNS
trafﬁc and may expand to PDG, MX, SRV, NS, PTR for richer
information in the future.
Third, further analyzation. After getting domain detection
results, we can design functions and go further to ﬁnd the
infected clients and malicious IPs in the network based on the
rich semantic information represented in HinDom. With this
information, the security management team can narrow down
their investigation range and focus on the most dangerous
hosts. We will add the client and IP detection module in
future work.
7 Conclusion
In this paper, we present an intelligent malicious domain de-
tection system named HinDom. HinDom constructs a HIN of
clients, domains and IP addresses to model the DNS scene and
generates a combined meta-path to analyze the associations
among domains. With a meta-path based transductive classiﬁ-
cation method, HinDom performs well even when the initial
label fraction drops to 10%, which reduces the cost of acquir-
ing labeled samples. In our extensive evaluation, we veriﬁed
HinDom’s performance, robustness and practicality. In the
real-world deployment, we are able to discover a long-buried
mining botnet named MsraMiner and some other malicious
domains ahead of the public services. As for further develop-
ments, we plan to extend to other types of DNS-related data
for more comprehensive semantic information and integrate
graph embedding in HinDom to improve efﬁciency.
Acknowledgment
We thank Hui Zhang, Chenxi Li, Shize Zhang for constructive
recommendations on experiments and data processing. Addi-
tionally, we appreciate 360netLab, VirusTotal for permissions
of their advanced APIs and we thank Information Technol-
ogy Center of Tsinghua University for authorizing the use of
their data in our experiments. This work is supported by the
National Key Research and Development Program of China
under Grant No.2017YFB0803004.
References
[2] Hyrum S Anderson, Jonathan Woodbridge, and Bobby
Filar. Deepdga: Adversarially-tuned domain genera-
tion and detection. In Proceedings of the 2016 ACM
Workshop on Artiﬁcial Intelligence and Security, pages
13–21. ACM, 2016.
[3] Manos Antonakakis, Roberto Perdisci, David Dagon,
Wenke Lee, and Nick Feamster. Building a dynamic rep-
utation system for dns. In USENIX security symposium,
pages 273–290, 2010.
[4] Manos Antonakakis, Roberto Perdisci, Wenke Lee,
Nikolaos Vasiloglou, and David Dagon. Detecting mal-
ware domains at the upper dns hierarchy. In USENIX
security symposium, volume 11, pages 1–16, 2011.
[5] Manos Antonakakis, Roberto Perdisci, Yacin Nadji,
Nikolaos Vasiloglou, Saeed Abu-Nimeh, Wenke Lee,
and David Dagon. From throw-away trafﬁc to bots:
Detecting the rise of dga-based malware. In USENIX
security symposium, volume 12, 2012.
[6] Leyla Bilge, Sevil Sen, Davide Balzarotti, Engin Kirda,
and Christopher Kruegel. Exposure: A passive dns
analysis service to detect and report malicious domains.
ACM Transactions on Information and System Security
(TISSEC), 16(4):14, 2014.
[7] Yizheng Chen, Yacin Nadji, Athanasios Kountouras,
Fabian Monrose, Roberto Perdisci, Manos Antonakakis,
and Nikolaos Vasiloglou. Practical attacks against graph-
In Proceedings of the 2017 ACM
based clustering.
SIGSAC Conference on Computer and Communications
Security, pages 1125–1142. ACM, 2017.
[8] Daiki Chiba, Takeshi Yagi, Mitsuaki Akiyama, Toshiki
Shibahara, Takeshi Yada, Tatsuya Mori, and Shigeki
Goto. Domainproﬁler: Discovering domain names
abused in future. In 2016 46th Annual IEEE/IFIP Inter-
national Conference on Dependable Systems and Net-
works (DSN), pages 491–502. IEEE, 2016.
[9] Google Developers. Google Safe Browsing. https:
//developers.google.com/safe-browsing/, 2019.
[Online].
[10] Dnsdb.info. DNSDB.
2019. [Online].
https://www.dnsdb.info,
[11] Yujie Fan, Shifu Hou, Yiming Zhang, Yanfang Ye, and
Melih Abdulhayoglu. Gotcha-sly malware!: Scorpion
a metagraph2vec based malware detection system. In
Proceedings of the 24th ACM SIGKDD International
Conference on Knowledge Discovery & Data Mining,
pages 253–262. ACM, 2018.
[1] Amazon Web Services, Inc. AWS | Alexa Top Sites - Up-
to-date lists of the top sites on the web. https://aws.
amazon.com/alexa-top-sites/, 2019. [Online].
[12] Schloss Dagstuhl Leibniz Center for Informatics. DNS-
BH – Malware Domain Blocklist by RiskAnalytics.
url=https://dblp.uni-trier.de/, 2019. [Online].
410          22nd International Symposium on Research in Attacks, Intrusions and DefensesUSENIX Association[13] Tao-yang Fu, Wang-Chien Lee, and Zhen Lei. Hin2vec:
Explore meta-paths in heterogeneous information net-
works for representation learning. In Proceedings of the
2017 ACM on Conference on Information and Knowl-
edge Management, pages 1797–1806. ACM, 2017.
[14] Jason Geffner. End-to-end analysis of a domain gener-
ating algorithm malware family. Black Hat USA, 2013,
2013.
[15] Xiaofei He, Deng Cai, and Partha Niyogi. Laplacian
score for feature selection. In Advances in neural infor-
mation processing systems, pages 507–514, 2006.
[16] Shifu Hou, Yanfang Ye, Yangqiu Song, and Melih Ab-
dulhayoglu. Hindroid: An intelligent android malware
detection system based on structured heterogeneous in-
formation network. In Proceedings of the 23rd ACM
SIGKDD International Conference on Knowledge Dis-
covery and Data Mining, pages 1507–1515. ACM, 2017.
[17] Ming Ji, Yizhou Sun, Marina Danilevsky, Jiawei Han,
and Jing Gao. Graph regularized transductive classiﬁca-
tion on heterogeneous information networks. In Joint
European Conference on Machine Learning and Knowl-
edge Discovery in Databases, pages 570–586. Springer,
2010.
[18] Issa Khalil, Ting Yu, and Bei Guan. Discovering mali-
cious domains through passive dns data graph analysis.
In Proceedings of the 11th ACM on Asia Conference
on Computer and Communications Security, pages 663–
674. ACM, 2016.
[19] Issa M Khalil, Bei Guan, Mohamed Nabeel, and Ting
Yu. A domain is only as good as its buddies: Detect-
ing stealthy malicious domains via graph inference. In
Proceedings of the Eighth ACM Conference on Data
and Application Security and Privacy, pages 330–341.
ACM, 2018.
[20] Pierre Lison and Vasileios Mavroeidis. Automatic de-
tection of malware-generated domains with recurrent
neural models. arXiv preprint arXiv:1709.07102, 2017.
[21] Daiping Liu, Zhou Li, Kun Du, Haining Wang, Bao-
jun Liu, and Haixin Duan. Don’t let one rotten apple
spoil the whole barrel: Towards automated detection of
shadowed domains. In Proceedings of the 2017 ACM
SIGSAC Conference on Computer and Communications
Security, pages 537–552. ACM, 2017.
[22] Chen Luo, Renchu Guan, Zhe Wang, and Chenghua
Lin. Hetpathmine: A novel transductive classiﬁcation
algorithm on heterogeneous information networks. In
European Conference on Information Retrieval, pages
210–221. Springer, 2014.
[23] Malwaredomainlist.com. MDL.
https://www.
malwaredomainlist.com, 2019. [Online].
[24] Malwaredomains.com.
main Blocklist by RiskAnalytics.
malwaredomains.com, 2019. [Online].
DNS-BH – Malware Do-
http://www.
[25] Pratyusa K Manadhata, Sandeep Yadav, Prasad Rao, and
William Horne. Detecting malicious domains via graph
In European Symposium on Research in
inference.
Computer Security, pages 1–18. Springer, 2014.
[26] Passivedns.cn.
Sign In-passiveDNS.
passivedns.cn, 2019. [Online].
https://
[27] Daniel Plohmann, Khaled Yakdan, Michael Klatt, Jo-
hannes Bader, and Elmar Gerhards-Padilla. A com-
prehensive measurement study of domain generating
In 25th {USENIX} Security Symposium
malware.
({USENIX} Security 16), pages 263–278, 2016.
[28] Babak Rahbarinia, Roberto Perdisci, and Manos An-
tonakakis. Segugio: Efﬁcient behavior-based tracking
of malware-control domains in large isp networks. In
Dependable Systems and Networks (DSN), 2015 45th
Annual IEEE/IFIP International Conference on, pages
403–414. IEEE, 2015.
[29] Samuel Schüppen, Dominik Teubert, Patrick Herrmann,
{FANCI}: Feature-based auto-
and Ulrike Meyer.
mated nxdomain classiﬁcation and intelligence. In 27th
{USENIX} Security Symposium ({USENIX} Security
18), pages 1165–1181, 2018.
[30] Jingbo Shang, Meng Qu, Jialu Liu, Lance M Kaplan,
Jiawei Han, and Jian Peng. Meta-path guided embed-
ding for similarity search in large-scale heterogeneous
information networks. arXiv preprint arXiv:1610.09769,
2016.
[31] Chuan Shi, Yitong Li, Jiawei Zhang, Yizhou Sun, and
S Yu Philip. A survey of heterogeneous information
network analysis. IEEE Transactions on Knowledge
and Data Engineering, 29(1):17–37, 2017.
[32] Yizhou Sun, Jiawei Han, Xifeng Yan, Philip S Yu, and
Tianyi Wu. Pathsim: Meta path-based top-k similarity
search in heterogeneous information networks. Proceed-
ings of the VLDB Endowment, 4(11):992–1003, 2011.
[33] Yizhou Sun, Yintao Yu, and Jiawei Han. Ranking-based
clustering of heterogeneous information networks with
star network schema. In Proceedings of the 15th ACM
SIGKDD international conference on Knowledge dis-
covery and data mining, pages 797–806. ACM, 2009.
[34] Virustotal.com.
Virustotal.
virustotal.com, 2019. [Online].
https://www.
USENIX Association        22nd International Symposium on Research in Attacks, Intrusions and Defenses 411[35] Mengting Wan, Yunbo Ouyang, Lance Kaplan, and Ji-
awei Han. Graph regularized meta-path based transduc-
tive regression in heterogeneous information network.
In Proceedings of the 2015 SIAM International Confer-
ence on Data Mining, pages 918–926. SIAM, 2015.
[37] Dengyong Zhou, Olivier Bousquet, Thomas N Lal, Ja-
son Weston, and Bernhard Schölkopf. Learning with
In Advances in neural
local and global consistency.
information processing systems, pages 321–328, 2004.
[36] Jonathan Woodbridge, Hyrum S Anderson, Anjum
Ahuja, and Daniel Grant. Predicting domain genera-
tion algorithms with long short-term memory networks.
arXiv preprint arXiv:1611.00791, 2016.
[38] Futai Zou, Siyu Zhang, Weixiong Rao, and Ping Yi.
In-
Detecting malware based on dns graph mining.
ternational Journal of Distributed Sensor Networks,
11(10):102687, 2015.
412          22nd International Symposium on Research in Attacks, Intrusions and DefensesUSENIX Association