can separate out the component of the variance of(cid:2)y that is due to
the estimation step from the inherent variance of(cid:2)x as follows:
LEMMA 1. Var((cid:2)y) = E[(cid:2)x2
(cid:2)X, we obtain the following results for the variance of (cid:2)X, which are
Applying this Lemma to each sampling stage in the formation of
1 − p((cid:2)x)
p((cid:2)x)
] + Var((cid:2)x).
proved, along with Lemma 1, in the Appendix. Let xmax denote
the maximum ﬂow size and bmax the maximum packet size.
THEOREM 1. Assume independent packet sampling with period
N and smart ﬂow sampling with threshold z.
(i) (cid:2)X is an unbiased estimator of X.
(ii) Var (cid:2)X =
E[(cid:2)xi max{zq
n(cid:3)
mi(cid:3)
−1 −(cid:2)xi, 0}]+
n(cid:3)
bij)2 + N − 1
(
n(cid:3)
1 − q
q
i=1
q
mi(cid:3)
b2
ij .
(iii) Var (cid:2)X ≤ q
variance Var (cid:2)X
(cid:2)
i=1
j=1
i=1
j=1
−1X (z + (1 − q)xmax + (N − 1)bmax).
of corresponding usage estimate (cid:2)X
(cid:2)
.
(iv) When ﬂows can be split, the same bound (iii) holds for the
4.2 Interpretation of Theorem 1
The expressions in Theorem 1(ii) and (iii) are sums over contri-
butions due to the different types of sampling: the ﬁrst from smart
sampling, the second from loss of ﬂow records, and the third from
packet sampling. We now interpret the meanings of the terms.
)
B
M
i
(
x
e
z
S
w
o
F
e
g
a
r
e
v
A
l
s
e
t
y
B
,
e
z
S
i
t
i
e
k
c
a
P
m
u
m
x
a
M
1 1500
1 1500
1 1500
1 1500
1 1500
1 1500
1 1500
1 1500
1 1500
1 1500
)
B
G
(
X
e
g
a
s
U
c
i
f
f
a
r
T
1
10
0.1
1
10
1
1
1
1
1
)
B
M
l
(
z
d
o
h
s
e
r
h
T
g
n
N
d
o
i
r
e
P
g
n
i
l
p
m
a
S
t
t
q
-
1
e
a
R
s
s
o
L
r
o
r
r
E
d
r
a
d
n
a
S
g
n
t
i
l
p
m
a
S
r
o
r
r
E
d
r
a
d
n
a
S
g
n
t
i
l
p
m
a
S
t
r
o
r
r
t
E
d
r
a
d
n
a
S
s
s
o
L
w
o
F
l
r
o
r
r
E
d
r
a
d
n
a
S
t
t
i
l
l
e
k
c
a
P
t
r
a
m
S
t
e
r
p
o
k
m
a
p
c
e
a
a
o
R
P
S
T
0% 3.16% 2.74% 0.00% 4.18%
500
1
0% 1.00% 0.87% 0.00% 1.32%
500
1
0% 10.00% 8.65% 0.00% 13.22%
500
1
0% 10.00% 2.74% 0.00% 10.37%
500
10
0% 1.00% 0.87% 0.00% 1.32%
1
500
0% 3.16% 8.66% 0.00% 9.22%
1 5000
50
1
0% 3.16% 0.86% 0.00% 3.28%
500 10% 3.16% 2.88% 1.05% 4.41%
1
500 50% 3.16% 3.87% 3.16% 5.91%
1
1
500 90% 3.16% 8.65% 9.49% 13.22%
Table 2: SAMPLING STANDARD ERRORS: broken down for
packet sampling, ﬂow loss, and smart sampling.
4.2.1 Computational Issues
Observe that when q = 1 (no transmission loss) the bound (iii)
needs only two broad characteristics of the trafﬁc: the total volume
X to be estimated, and the maximum packet size bmax. The lat-
ter can in turn be bounded above by the Maximum Transmission
Unit of the network under measurement. By comparison, the exact
expression (ii) requires knowing the characteristics of each ﬂow;
it requires far more detailed measurements (including packet sizes,
which may not be available), and it computationally more inten-
sive. We shall see in Section 7 that the bound in fact gives a very
close approximation to the actual variance in cases examined.
4.2.2 The Effect of Sparse Flows
Although the upper bound Theorem 1(iii) is unaffected by split-
ting of sparse ﬂows, the expression (ii) is generally impacted. Vari-
ance due to ﬂow loss decreases, since ﬂows are split across multiple
reports. Variance due to packet sampling is unchanged. The smart
sampling variance may increase or decrease.
4.2.3 Large Flows and Estimator Variance
Note that when X is dominated by the contribution of one very
large ﬂow, the last term in the variance bound may be close to
(1−q)/q. The the standard error may be quite large if the dropping
rate is also large. This is not surprising: smart sampling was ap-
plied in the collector precisely so as to mitigate against the effects
on accuracy of uniform sampling of ﬂow records whose reported
sizes have a heavy-tailed distribution. For this reason, we recom-
mend that the bandwidth for transmission of raw ﬂow records and
computational resources on the collector be sufﬁciently large to ac-
commodate the records without loss under normal operation. Later
in this paper, we provide estimates for the required bandwidth.
4.2.4 Comparing Variance: Packet, Smart Sampling
Assuming that our recommendation to dimension collection in-
frastructure for no report loss is followed, the bound of Theorem 1(iii)
takes a simple form: Var X ≤ X(z + (N − 1)bmax). From this
bound, we expect the ratio of variance due to smart sampling to that
due to packet sampling is about z/(N bmax). Thus for typical val-
ues bmax = 1, 500 Bytes, N = 100, the smart sampling variance
exceeds the packet sampling variance only when z > 150 kBytes.
4.2.5 Resampling of Aggregates
In the TAP infrastructure, smart sampled ﬂow records may be ag-
gregated over time, and the resulting aggregates subject to further
smart sampling with a threshold z2. What is the effect on estimator
variance? Without aggregation, it was shown in [7] that composi-
tion of n smart sampling stages with thresholds z1 . . . , zn is equiv-
alent to a single smart sampling with threshold maxn
i=1 zi. With
aggregation, we have found no such simple relation. However, an
application of Lemma 1, together with the bounding methods used
(cid:2)
to establish Theorem 1(iii), show that the additional variance in (cid:2)X
introduced is bounded above by q
−1Xz2.