ro (read-only)
对共享目录具有只读权限
sync
同步写入，数据写入内存的同时写入磁盘
async
异步写入，数据先写入内存，周期性的写入磁盘
root_squash
将root用户及所属组映射为匿名用户或用户组（默认设置）
no_root_squash
与root_squash参数功能相反
all_squash
将远程访问的所有普通用户及所属组映射为匿名用户或用户组
河南中医药大学信息技术学院互联网技术教学团队／https://internet.hactcm.edu.cn /http://www.51xueweb.cn
---
## Page 51
51
2.NFS服务器
2.4NFS的共享参数
表7-3-1NFS配置文件参数及说明表
参数
说明
no_all_squash
与all_squash参数功能相反（默认设置）
anonuid
将远程访问的所有用户均映射为匿名用户，并指定该用户的本地用户UID
将远程访问的所有用户组均映射为匿名用户组，并指定该匿名用户组的本地
anongid
用户组GID
secure
限制客户端只能从小于1024的TCP/IP端口连接NFS服务器（默认设置）
insecure
允许客户端从大于1024的TCP/IP端口连接服务器
subtree_check
若输出目录是子目录，NFS服务器检查其父目录的权限
no_subtree_check
若输出目录是子目录，NFS服务器不检查其父目录的权限
河南中医药大学信息技术学院互联网技术教学团队／https://internet.hactcm.edu.cn /http://www.51xueweb.cn
---
## Page 52
52
2.NFS服务器
2.5 任务4
任务4：工作组内的网络共享存储服务
步骤1：规划网络共享存储服务的方案
步骤2：部署NFS
步骤3：配置NFS服务器的安全
步骤4：在Windows上使用网络共享存储服务
步骤5：在Linux上使用网络共享存储服务
河南中医药大学信息技术学院互联网技术教学团队/https://internet.hactcm.edu.cn /http://www.51xueweb.cn
---
## Page 53
53
任务4：工作组内的网络共享存储服务
■任务目标：
口规划网络共享存储服务的方案
·部署实现网络共享存储服务
在Windows上访问网络共享存储服务
口在Linux上访问网络共享存储服务
操作视频/现场演示
---
## Page 54
54
某设计工作室拥有大量的数字资源，若存储在本地会占用主机大量存储，且不利于资源共
享。
现需要构建公共网络存储，实现灵活的资源读取和共享。
基本需求:
建设大容量高可靠的网络共享存储服务，在存储服务器上安装大量磁盘并通过
Raid技术实现存储容灾。
2
提供超过20TB的存储容量，实现高容量网络存储服务。
③
支持MacOS、Linux、Windows等多操作系统。
解决思路：
?
通过NFS建设网络存储服务
2
仅允许工作室内部网络的设备访问
③
支持多种操作系统进行磁盘挂载
业务服务器
移动工作站
TTTTT
无线接入点
工作室交换机
文件服务器
NFS + Raid + Disk
设计工作站
---
## Page 55
55
部署NFS服务器
---
## Page 56
#创建用于共享的目录
56
[root@Project-07-Task-02 ~]# mkdir /opt/WorkGroupShare
3.
[root@Project-07-Task-02 ~]# chmod 777 /opt/WorkGroupShare
#安装nfs服务
5.
[root@Project-07-Task-02 ~]# yum install -y nfs-utils rpcbind
#对nfs服务进行配置
7.
[root@Project-07-Task-02 ~]# systemctl start rpcbind
8
[root@Project-07-Task-02 ~]# systemctl enable rpcbind
9.
[root@Project-07-Task-02 ~]# systemctl start nfs-server
10.[root@Project-07-Task-02 ~]# systemctl enable nfs-server
命令指南/操作引导
11.
#对nfs进行配置确认
12. 
[root@Project-07-Task-02 ~]# systemctl is-enabled rpcbind
13.
[root@Project-07-Task-02 ~]# systemctl status rpcbind
14.
[root@Project-07-Task-02 ~]# systemctl is-enabled nfs-server
15.
[root@Project-07-Task-02 ~]# systemctl status nfs-server
#创建nfs共享
17.
[root@Project-07-Task-02 ~]# echo "/opt/WorkGroupShare 10.10.2.0/24(rw,root_squash,no_all_squash,sync,insecure)" >> /etc/exports 
18.
[root@Project-07-Task-02 ~]# systemctl reload nfs-server
19.
[root@Project-07-Task-02 ~]# exportfs -rv
20. [root@Project-07-Task-02 ~]# showmount -e
---
## Page 57
#配置nfs服务器的防火墙和SELinux
57
[root@Project-07-Task-02 ~]# rpcinfo -p
[root@Project-07-Task-02 ~]# firewall-cmd --permanent --zone=public --add-service=nfs
3.
4.
[root@Project-07-Task-02 ~]# firewall-cmd --permanent --add-port=111/tcp
5.
dpn/lll=od-ppe-- uauead-- p-lema #[~ o-ser-o-aosdtoo]
6.
d/rto=od-ppe-- uauewa--po-llma # co--o-aodtoo]
7.
[root@Project-07-Task-02 ~]# firewall-cmd --permanent --add-port=2049/udp
dstoo=od-ppe-- uauead--pw-lema #[ zo-sep-o-aodoo
9.
[root@Project-07-Task-02 ~]# firewall-cmd --permanent --add-port=20048/udp
10.
[root@Project-07-Task-02 ~]# firewall-cmd --reload
11.
[root@Project-07-Task-02 ~]# firewall-cmd --zone=public --list-all
命令指南/操作引导
12.
[root@Project-07-Task-02 ~]# setsebool -P nfs_export_all_rw on
13.
[root@Project-07-Task-02 ~]# setsebool -P nfs_export_all_ro on
14.
[root@Project-07-Task-02 ~]# getsebool -a | grep nfs
15.
#在nfs服务器上访问nfs共享，进行服务测试
16.
[root@Project-07-Task-02 ~]# mkdir /mnt/sharedisk
17.
[root@Project-07-Task-02 ~]# mount -t nfs 10.10.2.126:/opt/WorkGroupShare /mnt/sharedisk
18. 
[root@Project-07-Task-02 ~]# cd /mnt/sharedisk
19.
[root@Project-07-Task-02 sharedisk]# touch a.txt
20. [root@Project-07-Task-02 sharedisk]# Is -l
21.
#查看nfs共享服务的状态
22.
[root@Project-07-Task-02 sharedisk]# cd ~
23. [root@Project-07-Task-02 ~]# nfsstat
---
## Page 58
58
访问共享存储服务进行测试
---
## Page 59
59
3.Samba服务器
3.1 Samba的工作原理
Samba的历史渊源:
■早期类UNIX系统中可以通过NFS让所有类UNIX系统之间实现资源共享，微软为了
让Windows（即当时的DOS）系统间可以实现资源共享，提出了一个不同于NFS的
SMB（Server Message Block）通信协议，使得网络中的文件系统、打印机等可以
实现资源共享。
由于微软公司没有将SMB协议公开，如果想在UNIX与Windows共享资源却很困难
基本只有通过FTP实现。
---
## Page 60
60
3.Samba服务器
3.1 Samba的工作原理
口Samba的历史渊源：
11991年，大学生AndrewTridgwell为了解决这个障碍，通过对数据包的分析，编写
了Samba自由软件。
在类UNIX系统上启用Samba服务，即可利用SMB协议与Windows系统之间实现资
源共享等相关功能。
Samba是开放源代码的GPL自由软件，其解决了类UNIX与Windows之间通过SMB
协议进行资源共享与访问。
Samba: http://www.samba.org
---
## Page 61
口
5s
C
☆
中
SAMBAWIKI
Anony
SAMBF
Main Page
S'AMBA
Main Page
Disc
lView source History
Welcome
About Samba
Donations
Samba is an Open Source/ Free Softi
are suite that has, ince 1992, provided file and print services to all manner of SMB/CIFS clients,
Samba is the standard Win
andUnix
Navigation
think Samba
including the numerous versions of Microsoft Windows operating systems.Samba is freely available under the GNU General Public License.
Main Page
eralPublicLicen
e,theSambaprojectis a
The Samba project i a member of the Software Freedom Conservancy'5.
 get Samba
member of theSoftwareFree
JserDocu
learn Samba
Since 1992,Samba has p
 Latest News
using theSMB/CIFSprotocolsuchasallversionsofDOSandWind
Categories
 talk Samba
others
CurrentEvents
07September 2023
Recent Changes
User Documentation
Latest Releases
hack Samba
andDesktopsinto
Random Page
· Seting up Samba as an Active irectory Domain Controller
. Current Stable Release: 4.19.0 Release Notes)
member.
Report Samba Bug
contact Samba
· Setting up Sambas a Domain Member
Report DocBug
·Maintenance Mode: 4.18.6 (Release Notes)
·Joining aSamba DCto an Exsting Active Diretory
· Security Fixes Only Mode: 4.17118 Release Notes ER)
· Updating Samba
·Release Planning
support Samba
 Releases
·Setting up a Share Using POSIX ACLs
 Beyond Samba
· Seting up a Share Using Windows ACS
Wiki tools
· Setting up Samba as a Print Server
Current stable release
Commercial Support
 Specil pages
notes formore info.
·CTDB and Clustered Samba
 Upcoming Events
Samba 4.19.0 (gzipped)
Global·By Country
·FAQ- Frequently Asked Questions
ReleaseNotes·Signature
04 September 2023
· Online man page documentation for Samba
Conferences
·Upcoming Events
Release History
·more..
Versions&Notes
SAMBRC
More
What links here
Maintenance
SDC by SNIA
meressg arpal has 
Related changes
News
Patches·Security Updates
 Developer Documentation
Printable version
Key
Permanent ink 
·Samba News
thereleasenotes formoreinfo.
· Writing Torture Tests
Future
 Page information
Release Planning·Roadmap
Page logs
·Videos
FurtherNews>>
· Samba Cl on gitlab
·Google Summer of Code
 Related Sites
·more...
Community
SAMBA
THINK SAMBA
GET SAMBA
LEARN SAMBA
: Download info 
: Dos n oes 
· How to do Samba: Nicely
linux-cifs.samba.org
: Pianet samba
GUIS
Contribution
TALK SAMBA
HACK SAMBA
CONTACT SAMBA
· Bug reporting
Idb.san
rsync.samb
· Capture packets
Etiquette
· Contributing Code to Samba
· Code review
'ppp.samba
·more...
---
## Page 62
62
3.Samba服务器
3.1Samba的工作原理
Samba是作为类UNIX系统和Windows的通信的桥梁，在设计上是让类UNIX系
统加入到Windows网络中，而不是让Windows加入类UNIX网络中。
在Windows98、WindowsMe、WindowsNT操作系统中SMB服务使用137(UDP)、
138(UDP)及139(TCP)端口。
■在Windows 2000以后版本的操作系统中使用445(TCP)端口。
---
## Page 63
63
3.Samba服务器
3.1 Samba的工作原理
口Samba服务的两个主要进程：
■Nmbd：进行NetBIOS名称解析，并提供浏览服务显示网络上的共享资源列表。
Smbd：管理Samba服务器上的共享目录、打印机等。
口主要是针对网络上的共享资源进行管理的服务。
口当访问服务器要查找共享文件时，靠smbd这个进程来管理数据传输。
---
## Page 64
SMB客户端
SMB服务器
SMBnegprot请求数据包
3.Samba服务器
SMBnegprot响应数据包
原理
协议协商
Samba服务与Samba客户端工作流程
协议协商
建立连接
SMB客户端
SMB服务器
SMBSessstupX请求数据包
访问共享资源
断开连接
SMBSessstupX响应数据包
建立连接
SMB客户端
SMB服务器
SMBTconX请求数据包
SMBTconX响应数据包
访问共享资源
河南中医药大学信息技术学院互联网技术教学团队／https://internet.hactcm.edu.cn /http://www.51xueweb.cn
---
## Page 65
65
3.Samba服务器
3.1 Samba的工作原理
口Samba服务器的安全模式：
■share安全级别模式
客户端登录Samba服务器，不需要输入用户名和密码就可以浏览Samba服务器的资源，适用于公共
的共享资源，安全性差，需要配合其他权限设置来保证安全性。
user安全级别模式
客户端登录Samba服务器，需要提交合法帐号和密码，经过服务器验证才可以访问共享资源，服务器
默认为此级别模式。
server安全级别模式
口客户端需要将用户名和密码，提交到指定的一台Samba服务器上进行验证，如果验证出现错误，客户
端会用user级别访问，实现集中式的认证管理。
domain安全级别模式
加入Windows域环境中，验证工作将由Windows域控制器负责。
ads安全级别模式
：具备了domain安全级别模式中所有的功能并可以具备域控制器的功能。
t.hactcm.edu.cn / http://www.51xueweb.cn
---
## Page 66
66
3.Samba服务器
3.2 Samba的配置文件
Samba常用的目录及文件
表6-16Samba服务的相关文件说明
裁
说明
/etc/samba/smb.conf
Samba软件的主配置文件
/etc/init.d/smb
控制Samba服务的smbd服务
/etc/init.d/nmb
控制Samba服务的nmbd服务
/usr/bin/smbclient
Samba服务的客户端工具
/sur/bin/rpcclient
执行客户端的MS-RPC功能的工具
/usr/bin/smbpasswd
修改SMB用户的密码
/usr/bin/smbusers
用户名称映射文件
/usr/bin/findsmb
列出 SMB 名称查询上级的相关信息
/usr/sbin/smbd
提供SMB/CIFS服务
/usr/sbin/nmbd
提供IP命名服务上的NetBIOS客户端
/etc/pam.d/samba
PAM认证文件
/usr/bin/eventlogadm
存储Samba事件日志记录
/usr/bintestparm
检查 smb.conf配置文件的内部正确性
河南中医药大学信息技术学院互联网技术教学团队／https://internet.hactcm.edu.cn /http://www.51xueweb.cn
---