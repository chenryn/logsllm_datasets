### DNS X-Ray: A Tool for Analyzing and Visualizing DNS Resolution Platforms

#### Introduction
AFNIC operates Zonemaster, a tool that crawls domains to provide information about the connectivity and configuration of zone files and nameservers. Additionally, there are commercial services, such as those provided by Pingdom, which monitor the latency and availability of nameservers. Tools for measuring resolvers often focus on checking whether ports are randomly selected. The DNS Operations, Analysis, and Research Center (DNS OARC) offers a porttest tool for this purpose. However, these tools do not provide insights into the internal workings of DNS resolution platforms.

#### DNS X-Ray System Design
DNS X-Ray is a comprehensive system designed to analyze and visualize DNS resolution platforms. It consists of three main components:
1. **Client-Side Script**: Runs in web browsers and triggers DNS requests.
2. **Nameservers**: Host our zone files and receive DNS requests from the tested DNS platforms.
3. **Website**: Displays the analysis of DNS platforms and statistics in the form of graphs and charts.

The system architecture is illustrated in Figure 1. By using our own nameservers, we can capture requests from the tested DNS platforms and infer information about their components based on the request and response patterns.

We use two hierarchies in DNS, each configured in a separate zone file. DNS X-Ray runs on four Ubuntu servers and uses MongoDB to store the collected raw data. The implementation of the DNS resolution functionality is based on the Stanford DNS server. The analysis of the statistics is performed using Perl scripts on the webserver.

#### Methodology
DNS X-Ray leverages the standard DNS request/response behavior. The client-side script triggers specially crafted DNS requests for records in our domains. These requests, including the requested records and their types, are used to infer information about the caches behind the IP addresses of the tested DNS platform. DNS X-Ray decouples the caches from the IP addresses and counts the number of caches and IP addresses.

By analyzing the caching behavior, specifically the eviction of cached records and overwriting with new values, we can determine the DNS software and operating system on the caches. This is achieved by examining the port allocation by egress IP addresses in the DNS platform.

#### Data Collection and Statistics Generation
After each evaluation of DNS X-Ray on a new network, the data is added to the database, and the statistics are recalculated to incorporate the new results. The collected data is analyzed to generate the following outputs:
- Number of caches used by the tested DNS resolution platform.
- DNS software on the caches.
- Number of egress IP addresses.
- Networks and countries where the egress IP addresses are hosted.
- Whether the egress resolvers use random source ports and TXIDs.

DNS X-Ray focuses on collecting basic information about the components of DNS platforms, particularly characterizing the caching component. The system is modular, allowing for easy extension with new graphs and charts. All collected data during the evaluation of a given DNS platform is stored in a database, enabling the creation of new graphs and charts over the previously collected data. For example, DNS X-Ray can be extended to present statistics about latency, nameserver selection, IP identifier assignment, or support for cryptography, such as DNSSEC validation [RFC4033-RFC4035].

#### Non-Exposure to Attacks
DNS X-Ray does not expose the evaluated network or other networks to attacks. Users can only evaluate the security of DNS platforms on networks to which they have access. This ensures that the evaluation does not introduce additional threats to the network. The traffic generated by DNS X-Ray is moderate (14 tests each repeated 30 times) and lasts for 5-10 minutes.

#### Bypassing Local Caches
Upon invocation on a given network, a script running in the client's browser causes the stub resolver on the client's machine to send DNS requests to the resolution platform. To bypass intermediate caches, DNS X-Ray maps the same hostname to multiple aliases using CNAME records. For example, we set up q DNS records in our `cache.example` zone, mapping them to CNAME records as follows:

```
x-1.cache.example
x-2.cache.example
...
x-q.cache.example
name.cache.example IN A
IN CNAME name.cache.example
IN CNAME name.cache.example
IN CNAME name.cache.example
a.b.c.d
```

The script running in the client's browser then triggers q DNS requests for names `x-1.cache.example`, ..., `x-q.cache.example`. The local caches are not involved in the resolution process, specifically in resolving the CNAME redirection, and only receive the final answer.

#### Conclusions
Our current understanding of basic Internet components is based on standardization documents and initial designs. However, most systems have evolved significantly since their conception, and network operators often make different choices when setting up their infrastructure. To evaluate or improve the security of these components, a clear understanding is essential. DNS X-Ray enables users to evaluate DNS platforms and the security of their components, as well as to obtain collective information about DNS platforms in other networks on the Internet. DNS X-Ray is crucial for clients to identify vulnerabilities in their DNS platforms, even if DNSSEC validation [RFC4033-RFC4045] is applied, ensuring security even when DNSSEC is incorrectly adopted [13].

#### Acknowledgements
This research was supported in part by the German Federal Ministry of Education and Research (BMBF), the Hessian Ministry of Science and the Arts within CRISP (www.crisp-da.de/), and co-funded by the DFG as part of project S3 within the CRC 1119 CROSSING. This work was also partially supported by the HUJI Cyber Security Research Center in conjunction with the Israel National Cyber Bureau in the Prime Minister’s Office.

#### References
[1] Ruetee Chitpranee and Kensuke Fukuda. 2013. Towards passive DNS software fingerprinting. In Proceedings of the 9th Asian Internet Engineering Conference. ACM, 9–16.
[2] David Dagon, Niels Provos, Christopher P Lee, and Wenke Lee. 2008. Corrupted DNS Resolution Paths: The Rise of a Malicious Resolution Authority.. In NDSS.
[3] Amir Herzberg and Haya Shulman. 2013. Fragmentation considered poisonous, or: One-domain-to-rule-them-all. org. In Communications and Network Security (CNS), 2013 IEEE Conference on. IEEE, 224–232.
[4] Amir Herzberg and Haya Shulman. 2013. Socket overloading for fun and cache-poisoning. In Proceedings of the 29th Annual Computer Security Applications Conference. ACM, 189–198.
[5] Amit Klein, Haya Shulman, and Michael Waidner. 2017. Counting in the Dark: Caches Discovery and Enumeration in the Internet. In The 47th IEEE/IFIP International Conference on Dependable Systems and Networks (DSN).
[6] Amit Klein, Haya Shulman, and Michael Waidner. 2017. Internet-Wide Study of DNS Cache Injections. In INFOCOM.
[7] Marc Kührer, Thomas Hupperich, Jonas Bushart, Christian Rossow, and Thorsten Holz. 2015. Going wild: Large-scale classification of open DNS resolvers. In Proceedings of the 2015 ACM Conference on Internet Measurement Conference. ACM, 355–368.
[8] Kyle Schomp, Mark Allman, and Michael Rabinovich. 2014. DNS resolvers considered harmful. In Proceedings of the 13th ACM Workshop on Hot Topics in Networks. ACM, 16.
[9] Kyle Schomp, Tom Callahan, Michael Rabinovich, and Mark Allman. 2013. On measuring the client-side DNS infrastructure. In Proceedings of the 2013 conference on Internet measurement conference. ACM, 77–90.
[10] Kyle Schomp, Tom Callahan, Michael Rabinovich, and Mark Allman. 2014. Assessing DNS vulnerability to record injection. In Passive and Active Measurement. Springer, 214–223.
[11] Craig A Shue and Andrew J Kalafut. 2013. Resolvers revealed: Characterizing DNS resolvers and their clients. ACM Transactions on Internet Technology (TOIT) 12, 4 (2013), 14.
[12] Haya Shulman and Michael Waidner. 2014. Fragmentation considered leaking: port inference for DNS poisoning. In International Conference on Applied Cryptography and Network Security. Springer, 531–548.
[13] Haya Shulman and Michael Waidner. 2017. One Key to Sign Them All Considered Vulnerable: Evaluation of DNSSEC in Signed Domains. In The 14th USENIX Symposium on Networked Systems Design and Implementation (NSDI). USENIX.
[14] Yingdi Yu, Duane Wessels, Matt Larson, and Lixia Zhang. 2012. Authority Server Selection of DNS Caching Resolvers. ACM SIGCOMM Computer Communication Reviews (April 2012).
Jing Zhang, Zakir Durumeric, Michael Bailey, Mingyan Liu, and Manish Karir. 2014. On the Mismanagement and Maliciousness of Networks. In to appear) Proceedings of the 21st Annual Network & Distributed System Security Symposium (NDSS’14), San Diego, California, USA.
[15]

PosterCCS’17, October 30-November 3, 2017, Dallas, TX, USA