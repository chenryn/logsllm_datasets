www.senseofsecurity.com.au 
© Sense of Security 2013  
Page ‹#›  – 13-Sep-13  
Compliance, Protection & Business Confidence  
Sense of Security Pty Ltd 
!
Sydney 
Level 8, 66 King Street  
Sydney NSW 2000    Australia
Melbourne 
Level 10, 401 Docklands Drv 
Docklands VIC 3008 Australia
T: 1300 922 923 
T: +61 (0) 2 9290 4444 
F: +61 (0) 2 9290 4455
PI:EMAIL 
www.senseofsecurity.com.au 
ABN: 14 098 237 908
VoIP Wars:  
Attack of the Cisco Phones
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Speaker
• Fatih Ozavci  
• Senior Security Consultant 
• Interests 
• VoIP 
• Mobile Applications 
• Network Infrastructure 
!
• Author of Viproy VoIP Penetration Testing Kit 
• Public Speaker 
• Defcon, BlackHat Arsenal, AusCert, Ruxcon
2
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Viproy VoIP Toolkit
• Viproy is a Vulcan-ish Word that means "Call" 
• Viproy VoIP Penetration and Exploitation Kit 
• Testing modules for Metasploit, MSF license 
• Old techniques, new approach 
• SIP library for new module development 
• Custom header support, authentication support 
• Trust analyser, SIP proxy bounce, MITM proxy, Skinny, VOSS 
• Modules 
• Options, Register, Invite, Message 
• Brute-forcers, Enumerator 
• SIP trust analyser,SIP proxy, Fake service 
• Skinny analysers, VOSS exploits
3
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Agenda
1. Hosted VoIP Services and Cisco 101 
2. Network Infrastructure 
3. Cisco Unified Communications Manager  
4. IP Phone and Service Management 
5. Attacking Desktop and Mobile Clients
4
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Hosted VoIP services
5
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Cisco VoIP environment
• Web based services 
• IP Phone services (Cisco, VOSS) 
• Tenant client services (VOSS Selfcare) 
• Tenant* management services (Cisco HCS) 
• VoIP services 
• Skinny (SCCP) services for Cisco phones 
• SIP services for other tenant phones 
• RTP services for media streaming 
• PBX/ISDN gateways, network equipment   
!
* Tenant => Customer of hosted VoIP service
6
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Goals
• Discover VoIP network configuration, design and 
requirements 
• Find Voice VLAN and gain access 
• Gain access using PC port on IP Phone 
• Understand the switching security for: 
• Main vendor for VoIP infrastructure 
• Network authentication requirements 
• VLAN ID and requirements 
• IP Phone management services 
• Supportive services in use
7
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Protected and isolated?
8
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Switching manipulation
• Attack Types 
• PC Ports of the IP phone and handsets 
• CDP sniffing/spoofing for Voice VLAN 
• DTP and VLAN Trunking Protocol attacks 
• ARP spoofing for MITM attacks 
• DHCP spoofing & snooping 
• Persistent access 
• Tapberry Pi 
• Tampered phone 
• Power over ethernet (PoE) 
• 3G/4G for connectivity
9
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Attacking the TFTP server
• Obtaining configuration files for MAC addresses 
• SEPDefault.cnf, SEPXXXXXXXXXXXX.cnf.xml 
• SIPDefault.cnf, SIPXXXXXXXXXXXX.cnf.xml 
• Identifying SIP, Skinny, RTP and web settings 
• Finding IP phone software and updates 
• Configuration files may contain credentials 
• Digital signature/encryption usage for files 
!
!
!
Tip: TFTPTheft, Metasploit, Viproy TFTP module
10
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Configuration file content
• SCCP!
• !
• !
!
• 1!
• 1!
• 0!
• 1!
• 1!
!
• 
11
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Becoming the TFTP server
• Send fake configurations for 
• HTTP server 
• IP phone management server 
• SIP server and proxy 
• Skinny server 
• RTP server and proxy 
• Deploy SSH public keys for SSH on IP Phones 
• Update custom settings of IP Phones 
• Deploy custom OS update and code execution 
!
Tip: Metasploit TFTP & FakeDNS servers, Viproy MITM proxy 
12
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Unified Communications
• Forget TDM and PSTN 
• SIP, Skinny, H.248, RTP, MSAN/MGW 
• Smart customer modems & phones 
!
• Cisco UCM  
• Linux operating system 
• Web based management services 
• VoIP services (Skinny, SIP, RTP) 
• Essential network services (TFTP, DHCP) 
• Call centre, voicemail, value added services 
13
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Discovering VoIP servers
• Looking for 
• Signalling servers (e.g. SIP, Skinny, H.323, H.248) 
• Proxy servers (e.g. RTP, SIP, SDP) 
• Contact Centre services 
• Voicemail and email integration 
• Call recordings, call data records, log servers 
!
• Discovering 
• Operating systems, versions and patch level 
• Management services (e.g. SNMP, Telnet, HTTP, SSH) 
• Weak or default credentials
14
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Attacking SIP services
• Essential analysis 
• Registration and invitation analysis 
• User enumeration, brute force for credentials 
• Discovery for SIP trunks, gateways and trusts 
• Caller ID spoofing (w/wo register or trunk) 
!
• Advanced analysis 
• Finding value added services and voicemail 
• SIP trust hacking 
• SIP proxy bounce attack
15
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Cisco specific SIP registration
• Extensions (e.g. 1001) 
• MAC address in Contact field 
• SIP digest authentication (user + password) 
• SIP x.509 authentication 
• All authentication elements must be valid! 
!
• Good news, we have SIP enumeration inputs! 
Warning: 399 bhcucm "Line not configured” 
Warning: 399 bhcucm "Unable to find device/user in database" 
Warning: 399 bhcucm "Unable to find a device handler for the 
request received on port 52852 from 192.168.0.101” 
Warning: 399 bhcucm "Device type mismatch"
16
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Register and Subscribe
17
Register / Subscribe (FROM, TO, Credentials)
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Invite, CDR and Billing tests
18
Invite / Ack / Re-Invite / Update (FROM, TO, VIA, Credentials)
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
SIP Proxy Bounce attack
19
SIP Proxy Bounce Attacks 
• SIP trust relationship hacking 
• Attacking inaccessible servers 
• Attacking the SIP software and protocol 
• Software, Version, Type, Realm
192.168.1.146 
Melbourne
192.168.1.202 
Brisbane
192.168.1.145 - Sydney 
Production SIP Service
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Denial of Service attacks
20
SIP based DoS attacks 
• UDP vulnerabilities and IP spoofing 
• Too many errors, very very verbose mode 
• ICMP errors
192.168.1.146 
Melbourne
192.168.1.202 
Brisbane
192.168.1.145 - Sydney 
Production SIP Service
Alderaan
IP spoofed UDP SIP request
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Hacking SIP trust relationships
21
Send INVITE/MESSAGE requests with 
• IP spoofing (source is Brisbane), 
• from field contains Spoofed IP and Port, 
the caller ID will be your trusted host.
IP spoofed UDP SIP request 
From field has IP and Port
192.168.1.146 
Melbourne
192.168.1.202 
Brisbane
192.168.1.145 - Sydney 
Production SIP Service
UDP Trust
Universal 
Trust
Tatooine
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Attacking a client using SIP trust
22
IP spoofed UDP SIP request 
From field has bogus characters
192.168.1.146 
Melbourne
192.168.1.202 
Brisbane
192.168.1.145 - Sydney 
Production SIP Service
UDP Trust
Universal 
Trust
Tatooine
It’s a TRAP!
Send INVITE/MESSAGE requests with 
• IP spoofing (source is Brisbane), 
• from field contains special number, 
you will have fun or voicemail access.
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Toll fraud for CUCM
• Cisco UCM accepts MAC address as identity 
• No authentication (secure deployment?) 
• Rogue SIP gateway with no authentication 
• Caller ID spoofing with proxy headers  
• Via field, From field 
• P-Asserted-Identity, P-Called-Party-ID 
• P-Preferred-Identity  
• ISDN Calling Party Number, Remote-Party-ID  
• Billing bypass with proxy headers  
• P-Charging-Vector (Spoofing, Manipulating) 
• Re-Invite, Update (With/Without P-Charging-Vector)
23
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Caller ID spoofing on CUCM
Remote-Party-ID header 
Remote-Party-ID: ;party=called;screen=yes;privacy=off 
!
What for? 
• Caller ID spoofing 
• Billing bypass 
• Accessing voicemail 
• 3rd party operators
24
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Caller ID fraud for all operators?
• Telecom operators trust source Caller ID 
• One insecure operator to rule them all
25
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
Fake Caller ID for messages?
• Call me back function on voicemail / calls 
• Sending many spoofed messages for DoS 
• Overseas? Roaming? 
• Social engineering (voicemail notification) 
• Value added services 
• Add a data package to my line 
• Subscribe me to a new mobile TV service 
• Reset my password/PIN/2FA 
• Group messages, celebrations 
26
www.senseofsecurity.com.au                                                                                  © Sense of Security 2014  
Page        of 58 –   Aug-14  
SIP advanced attacks demo
27
Video Demonstration