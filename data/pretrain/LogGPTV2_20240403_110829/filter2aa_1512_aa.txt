Android	
  App逆向工程与签章技术
Joey{27350000	
  @	
  hst.tw}	
这场演讲“三不一没有”
三不一没有
•  三不	
– 我不是骇客（我是鲁蛇）	
– 我不会Android	
– 这场演讲不难，大家都听得懂	
•  一没有	
– 这场演讲没有太多梗，有的话帮帮忙笑一下	
About	
  Me	
•  Joey	
  Chen	
•  目前	
-  国立台湾科技大学资管所 烟酒生 研究生	
-  Hack-­‐Stuﬀ	
  Technology	
  Core	
  member	
-  趋势科技实习生	
•  证照	
–  ISO	
  27001:2013	
–  BS	
  10012:2009	
•  经历	
–  2012年骇客年会第三名	
–  2013年骇客年会第二名	
–  2014年Honeynet	
  CTF	
  第二名	
•  精专于	
-  加解密与数位签章	
-  逆向工程
演讲重点
•  今日演讲不再“技术”	
•  演讲重点在于“努力”	
•  希望大家找到“热情”
大纲
•  逆向工程	
•  签章技术	
•  工具介绍	
•  Android	
  OS	
  介绍	
•  拆解第一个	
  App	
•  修改第一个	
  App	
•  保护	
  App	
•  结论	
•  Q&A
预备知识(1)	
  -­‐	
  逆向工程
•  Compiler	
  V.S	
  Reversing	
Engineer	
•  直译式	
  V.S	
  编译式	
•  程式语言的不同,	
  ex	
  :	
  C/C++,	
  .Net	
  ,	
  Java…	
•  File	
  format	
  的不同,	
  ex	
  :	
*.exe,	
  *.dll,	
  *.jar…	
预先处理
编译
组译
连结
原始码
执行档
*.obj
*.lib
ﬁle.obj
工具介绍(1)	
  -­‐	
  Genymocom
工具介绍(2)	
  -­‐	
  Sublime
工具介绍(3)	
  -­‐	
  IDA	
  pro
预备知识(2)	
  -­‐	
  数位签章
发文者
收文者
杂凑	
函数
10101010
11111111
签体	
私钥	
加密	
11111111
签体	
传送给收文者
杂凑	
函数
10101010
11111111
签体	
公钥	
解密
10101010
Verify	
  ?	
  Yes	
  :	
  No	
表示资料未被篡改	
且确认发文者身份
Android	
  OS	
资料来源：hgp://en.wikipedia.org/wiki/Android_(operacng_system)	
APK	
  包装过程
Applicacon	
Resources
R.java
.class	
  File
Applicacon	
Source	
  Code
Java	
Interfaces
.aidl	
  File
aapt
aidl
Java	
Compiler
dex
3rd	
  Party	
Libraries	
and	
  .class	
  File
.dex	
  File
apkbuilder
Compiler	
Resources
Other	
Resources
APK	
  签章过程
Debug	
  or	
Release	
Keystore
Jarsigner
Signed	
  .apk
Zipalign	
(release	
mode)
Signed	
  and	
Aligned.apk
使用Zipalign工具对签名后的APK进行对齐处理，它位于
android-­‐sdk/tools，他的主要工作是将apk套件进行对齐处理，
使apk套件中的所有资源档距离档案起始偏移为4位元组整数
倍，这样透过记忆体映射存取apk档案时速度会更快。
破解第一支	
  APP
•  破解工具	
– Apktool,	
  dex2jar,	
  JD-­‐GUI,	
  IDA	
  pro,	
  androguard	
•  环境	
– OSX,	
  windows,	
  linux	
•  开发工具	
– Eclipse,	
  Android	
  SDK,	
  Android	
  NDK,	
  genymocon	
•  先备语言	
– Java,	
  C/C++,	
  .Net	
检视	
  APK	
  档案格式
•  Apk	
  :	
  Android	
  应用程式套件档案	
–  META-­‐INF	
•  MANIFEST.MF	
  :	
  清单资讯（Manifest	
  ﬁle） 	
•  CERT.RSA	
  :	
  储存著该应用程式的凭证和授权资讯。 	
•  CERT.SF	
  :	
  储存著 SHA-­‐1	
  资讯资源清单	
–  Lib	
  :	
  已编译好的程式	
–  Res	
  :不需要被编译的档案,	
  ex	
  :	
  *.png,	
  *jpg	
  …	
–  Assets	
  :用于存放需要打包到应用程式的静态档，以便部署到设备中,	
ex	
  :	
  政策条款等等…	
–  AndroidManifest.xml	
  :传统的Android清单档案，有该应用程式名字、
版本号、所需权限、注册服务、连结的其他应用程式名称	
–  classes.dex	
  :	
  classes档案通过DEX编译后的档案格式，用于在Dalvik虚
拟机器上执行的主要代码部分	
–  resources.arsc	
  :	
  有被编译过的档案,	
  ex	
  :	
  被编译过的xml
Apktool	
  :	
  A	
  Tool	