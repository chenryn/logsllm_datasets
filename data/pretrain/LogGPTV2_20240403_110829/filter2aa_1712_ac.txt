' Clear ALL cookies
#07
CLEAR
#08
' Initialize Browser tab 1, close all other tabs
#09
TAB T=1
#10
TAB CLOSEALLOTHERS
#11
' Tell iMacros to ignore images (nice if using Tor)
#12
FILTER TYPE=IMAGES STATUS=ON
#13
' Tell iMacros to ignore extract messages
#14
SET !EXTRACT_TEST_POPUP NO
#15
'##################################################
DEFCON XVII July 31-Aug 2, 2009
  Las Vegas,  Nevada
Screen Scraper Tricks: Difficult cases                 PI:EMAIL
Preferred iMaco Header commands
#01
'##################################################
#02
' Set maximum web page time out
#03
SET !TIMEOUT 240
#04
' Tell iMacros to ignore error messages
#05
SET !ERRORIGNORE YES
#06
' Clear ALL cookies
#07
CLEAR
#08
' Initialize Browser tab 1, close all other tabs
#09
TAB T=1
#10
TAB CLOSEALLOTHERS
#11
' Tell iMacros to ignore images (nice if using Tor)
#12
FILTER TYPE=IMAGES STATUS=ON
#13
' Tell iMacros to ignore extract messages
#14
SET !EXTRACT_TEST_POPUP NO
#15
'##################################################
DEFCON XVII July 31-Aug 2, 2009
  Las Vegas,  Nevada
Screen Scraper Tricks: Difficult cases                 PI:EMAIL
Preferred iMaco Header commands
#01
'##################################################
#02
' Set maximum web page time out
#03
SET !TIMEOUT 240
#04
' Tell iMacros to ignore error messages
#05
SET !ERRORIGNORE YES
#06
' Clear ALL cookies
#07
CLEAR
#08
' Initialize Browser tab 1, close all other tabs
#09
TAB T=1
#10
TAB CLOSEALLOTHERS
#11
' Tell iMacros to ignore images (nice if using Tor)
#12
FILTER TYPE=IMAGES STATUS=ON
#13
' Tell iMacros to ignore extract messages
#14
SET !EXTRACT_TEST_POPUP NO
#15
'##################################################
DEFCON XVII July 31-Aug 2, 2009
  Las Vegas,  Nevada
Screen Scraper Tricks: Difficult cases                 PI:EMAIL
Preferred iMaco Header commands
#01
'##################################################
#02
' Set maximum web page time out
#03
SET !TIMEOUT 240
#04
' Tell iMacros to ignore error messages
#05
SET !ERRORIGNORE YES
#06
' Clear ALL cookies
#07
CLEAR
#08
' Initialize Browser tab 1, close all other tabs
#09
TAB T=1
#10
TAB CLOSEALLOTHERS
#11
' Tell iMacros to ignore images (nice if using Tor)
#12
FILTER TYPE=IMAGES STATUS=ON
#13
' Tell iMacros to ignore extract messages
#14
SET !EXTRACT_TEST_POPUP NO
#15
'##################################################
DEFCON XVII July 31-Aug 2, 2009
  Las Vegas,  Nevada
Screen Scraper Tricks: Difficult cases                 PI:EMAIL
Preferred iMaco Header commands
#01
'##################################################
#02
' Set maximum web page time out
#03
SET !TIMEOUT 240
#04
' Tell iMacros to ignore error messages
#05
SET !ERRORIGNORE YES
#06
' Clear ALL cookies
#07
CLEAR
#08
' Initialize Browser tab 1, close all other tabs
#09
TAB T=1
#10
TAB CLOSEALLOTHERS
#11
' Tell iMacros to ignore images (nice if using Tor)
#12
FILTER TYPE=IMAGES STATUS=ON
#13
' Tell iMacros to ignore extract messages
#14
SET !EXTRACT_TEST_POPUP NO
#15
'##################################################
A complete iMacros 
command reference 
Is available at:
wiki.imacros.net/Command_Reference
DEFCON XVII July 31-Aug 2, 2009
  Las Vegas,  Nevada
Screen Scraper Tricks: Difficult cases                 PI:EMAIL
Let's look at where the data can come from
Firefox/iMacros 
equipped
Harvester
(XP, Ubuntu)
Central
Server
Target
Website(s)
DEFCON XVII July 31-Aug 2, 2009
  Las Vegas,  Nevada
Screen Scraper Tricks: Difficult cases                 PI:EMAIL
Let's look at where the data can come from
Firefox/iMacros 
equipped
Harvester
(XP, Ubuntu)
Central
Server
Periodically asks 
for instructions
Target
Website(s)
DEFCON XVII July 31-Aug 2, 2009
  Las Vegas,  Nevada
Screen Scraper Tricks: Difficult cases                 PI:EMAIL
Let's look at where the data can come from
Firefox/iMacros 
equipped
Harvester
(XP, Ubuntu)
Central
Server
Periodically asks 
for instructions
Tells Harvester 
what to do
Target
Website(s)
DEFCON XVII July 31-Aug 2, 2009
  Las Vegas,  Nevada
Screen Scraper Tricks: Difficult cases                 PI:EMAIL
Let's look at where the data can come from
Firefox/iMacros 
equipped
Harvester
(XP, Ubuntu)
1. Request data
2. Save Screens
3. Parse results
Central
Server
Periodically asks 
for instructions
Tells Harvester 
what to do
Target
Website(s)
iMacros Macro
DEFCON XVII July 31-Aug 2, 2009
  Las Vegas,  Nevada
Screen Scraper Tricks: Difficult cases                 PI:EMAIL
Let's look at where the data can come from
Firefox/iMacros 
equipped
Harvester
(XP, Ubuntu)
1. Request data
2. Save Screens
3. Parse results
Central
Server
Target
Website(s)
iMacros Macro
Update central 
server
Periodically asks 
for instructions
Tells Harvester 
what to do
DEFCON XVII July 31-Aug 2, 2009
  Las Vegas,  Nevada
Screen Scraper Tricks: Difficult cases                 PI:EMAIL
Large scale deployment
(challenges traditional thoughts regarding hosting)
Harvester
Central
Server
Target
Website(s)
Harvester
Harvester
Harvester
Harvester
Harvester
Harvester
Harvester
Harvester
Harvester
Harvester
Harvester
Harvester
Harvester
Harvester
Harvester
Harvester
Instructions 
or software 
updates
Data and/or 
scraping 
status
Website 
requests
Raw 
websites 
DEFCON XVII July 31-Aug 2, 2009
  Las Vegas,  Nevada
Screen Scraper Tricks: Difficult cases                 PI:EMAIL
Advanced iMacros Hacks
First example was a very straight forward iMacros 
example
iMacros also some JavaScript-like scripting compatibility 
(in the paid version)
iMacros has limited parsing and data extraction 
capability
While solving many problems--without further hacking, 
iMacros leaves you with many (or most) browser 
limitations.
DEFCON XVII July 31-Aug 2, 2009
  Las Vegas,  Nevada
Screen Scraper Tricks: Difficult cases                 PI:EMAIL
Advanced iMacros Hacks
First example was a very straight forward iMacros 
example
iMacros also some JavaScript-like scripting compatibility 
(in the paid version)
iMacros has limited parsing and data extraction 
capability
While solving many problems--without further hacking, 
iMacros leaves you with many (or most) browser 
limitations.
DEFCON XVII July 31-Aug 2, 2009
  Las Vegas,  Nevada
Screen Scraper Tricks: Difficult cases                 PI:EMAIL
Advanced iMacros Hacks
First example was a very straight forward iMacros 
example
iMacros also some JavaScript-like scripting compatibility 
(in the paid version)
iMacros has limited parsing and data extraction 
capability
While solving many problems--without further hacking, 
iMacros leaves you with many (or most) browser 
limitations.
DEFCON XVII July 31-Aug 2, 2009
  Las Vegas,  Nevada
Screen Scraper Tricks: Difficult cases                 PI:EMAIL
Advanced iMacros Hacks
First example was a very straight forward iMacros 
example
iMacros also some JavaScript-like scripting compatibility 
(in the paid version)
iMacros has limited parsing and data extraction 
capability
While solving many problems--without further hacking, 
iMacros leaves you with many (or most) browser 
limitations.
DEFCON XVII July 31-Aug 2, 2009
  Las Vegas,  Nevada
Screen Scraper Tricks: Difficult cases                 PI:EMAIL
Advanced iMacros Hacks
Suppose you could execute 
an iMacros macro in 
one browser tab...
DEFCON XVII July 31-Aug 2, 2009
  Las Vegas,  Nevada
Screen Scraper Tricks: Difficult cases                 PI:EMAIL
Advanced iMacros Hacks
And then open another 
browser tab to act on the 
data iMacros downloaded
and
● Parse data
● Read/Write to a database
● Pass data back to the iMacros macro
● Or, anything else
DEFCON XVII July 31-Aug 2, 2009
  Las Vegas,  Nevada
Screen Scraper Tricks: Difficult cases                 PI:EMAIL
Advanced iMacros Hacks
Let's finish our first 
example.
When we get to 
this point:
● Create a 2nd tab
● Launch a local 
php program in 
Apache
● Parse the web 
page
● Return the 
access code
● Complete the 
form submission 
in the original 
tab
DEFCON XVII July 31-Aug 2, 2009
  Las Vegas,  Nevada
Screen Scraper Tricks: Difficult cases                 PI:EMAIL
Advanced iMacros Hacks
Let's finish our first 
example.
When we get to 
this point:
● Create a 2nd tab
● Launch a local 
php program in 
Apache
● Parse the web 
page
● Return the 
access code
● Complete the 
form submission 
in the original 
tab
DEFCON XVII July 31-Aug 2, 2009
  Las Vegas,  Nevada
Screen Scraper Tricks: Difficult cases                 PI:EMAIL
Advanced iMacros Hacks
Let's finish our first 
example.
When we get to 
this point:
● Create a 2nd tab
● Launch a local 
php program in 
Apache
● Parse the web 
page
● Return the 
access code
● Complete the 
form submission 
in the original 
tab
DEFCON XVII July 31-Aug 2, 2009
  Las Vegas,  Nevada
Screen Scraper Tricks: Difficult cases                 PI:EMAIL
Advanced iMacros Hacks
Let's finish our first 
example.
When we get to 
this point:
● Create a 2nd tab
● Launch a local 
php program in 
Apache
● Parse the web 
page
● Return the 
access code
● Complete the 
form submission 
in the original 
tab
DEFCON XVII July 31-Aug 2, 2009
  Las Vegas,  Nevada
Screen Scraper Tricks: Difficult cases                 PI:EMAIL
Advanced iMacros Hacks
Let's finish our first 
example.
When we get to 
this point::
● Create a 2nd tab
● Launch a local 
php program in 
Apache
● Parse the web 
page
● Return the 
access code
● Complete the 
form submission 
in the original 
tab
 DEFCON XVII July 31-Aug 2, 2009
  Las Vegas,  Nevada
 Screen Scraper Tricks: Difficult cases                 PI:EMAIL
Switch to demo #2
You need to trust me that it will also work in a  
more complex environment (i.e. a “difficult case”)!
DEFCON XVII July 31-Aug 2, 2009
  Las Vegas,  Nevada
Screen Scraper Tricks: Difficult cases                 PI:EMAIL
This code was added to the original iMacros macro
#01
'# SAVE A COPY OF THE WEBPAGE TO FILE SYSTEM
#02
SAVEAS TYPE=HTM FOLDER=* FILE=PARSE_FILE.html
#03
'# OPEN A NEW TAB FOR THE PARSING SOFTWARE
#04
TAB OPEN
#05
TAB T=2
#06
URL GOTO=http://localhost/defcon17/simple_parse.php
#07
'
#08
'# READ THE PARSED RESULTS
#09
TAB T=1
#10
CMDLINE !DATASOURCE data.csv
#11
SET !DATASOURCE_COLUMNS 1
#12
SET !DATASOURCE_LINE {{!LOOP}}
#13
TAG POS=1 TYPE=INPUT:TEXT 
FORM=NAME:simple_form 
ATTR=NAME:access_code CONTENT={{!COL1}}
#14
WAIT SECONDS=5
#15
TAG POS=1 TYPE=INPUT:SUBMIT FORM=NAME:simple_form
ATTR=NAME:save&&VALUE:Save
Saves a copy of the screen 
data to a file in the 
/iMacros/Downloads directory. 
DEFCON XVII July 31-Aug 2, 2009
  Las Vegas,  Nevada
Screen Scraper Tricks: Difficult cases                 PI:EMAIL
This code was added to the original iMacros macro
#01
'# SAVE A COPY OF THE WEBPAGE TO FILE SYSTEM
#02
SAVEAS TYPE=HTM FOLDER=* FILE=PARSE_FILE.html
#03
'# OPEN A NEW TAB FOR THE PARSING SOFTWARE
#04
TAB OPEN
#05
TAB T=2
#06
URL GOTO=http://localhost/defcon17/simple_parse.php
#07
'
#08
'# READ THE PARSED RESULTS
#09
TAB T=1
#10
CMDLINE !DATASOURCE data.csv
#11
SET !DATASOURCE_COLUMNS 1
#12
SET !DATASOURCE_LINE {{!LOOP}}
#13
TAG POS=1 TYPE=INPUT:TEXT 
FORM=NAME:simple_form 
ATTR=NAME:access_code CONTENT={{!COL1}}
#14
WAIT SECONDS=5
#15
TAG POS=1 TYPE=INPUT:SUBMIT FORM=NAME:simple_form
ATTR=NAME:save&&VALUE:Save
●  Opens the second tab 
●  Loads and runs the file “simple_parse.php” 
   on a local installation of Apache
This program
● Reads the previously stored file
● Parses the access code
● Stores it in a iMacros (CSV) data file 
DEFCON XVII July 31-Aug 2, 2009
  Las Vegas,  Nevada
Screen Scraper Tricks: Difficult cases                 PI:EMAIL
This code was added to the original iMacros macro
#01
'# SAVE A COPY OF THE WEBPAGE TO FILE SYSTEM
#02