码，如图15-8所示。
图15-8 测试流程图
15.2.1 密码找回凭证暴露在请求链接中
步骤一：进入某直播网站登录处，单击忘记密码，选择通过注册手机找回密码，如图
15-9所示。
图15-9 通过注册手机找回密码
步骤二：输入手机号码，单击获取验证码，然后使用Firebug查看请求链接，发现验
证码直接出现在请求链接中，如图15-10所示。
图15-10 验证码出现在请求链接中
步骤三：直接输入请求链接中暴露出来的验证码即可修改密码。
15.2.2 加密验证字符串返回给客户端
步骤一：进入某电商官网按正常流程执行找回密码功能，填写好邮箱和图片验证码，
进入下一步，然后使用抓包工具抓取请求包。
步骤二：分析返回的数据包，发现其中包含了一个加密字符串，将其记录下来，如图
15-11所示。
图15-11 抓包返回数据结果
步骤三：之后，邮箱中会收到一个找回密码用的验证码。将该验证码在页面上填好，
单击下一步按钮即可进入密码重置页面，如图15-12所示。
步骤四：仔细观察发现，密码重置页面URL中的加密验证字符串和之前返回数据包中
的加密字符串是同一个，如图15-10和图15-11所示。既然如此，则可以绕过邮箱验证码校
验，直接利用抓包工具获取到的加密字符串构造到URL中进行任意密码重置，如图15-12
所示。成功重置并登录了官方客服的账号，如图15-13所示。
图15-12 密码重置页面
图15-13 密码重置并登录成功
15.2.3 网页源代码中隐藏着密保答案
步骤一：进入某邮箱网站官网，单击“找回密码”按钮，再单击“网上申诉”链接，如图
15-14所示。
步骤二：在网上申诉页面直接查看源代码，发现源代码中不但有密码提示问题，还在
Hide表单里隐藏着问题答案。通过该方式，可获得任意用户修改密码问题答案，从而可以
修改其他用户邮箱密码，如图15-15所示。
图15-14 网上申诉链接
图15-15 密保答案泄露
15.2.4 短信验证码返回给客户端
步骤一：进入某商城网站首页，单击忘记密码。
步骤二：使用一个已注册的手机号码，通过短信验证方式找回密码，如图15-16所
示。
图15-16 通过短信验证方式找回密码
步骤三：输入图片验证码，单击获取短信验证码，如图15-17所示。
图15-17 获取验证码
步骤四：此时抓取数据包，发现服务端直接将短信验证码646868返回给了客户端，将
短信验证码填写到验证码处即可成功重置其密码。同理，通过该方式，可以重置其他用户
的密码，如图15-18所示。
图15-18 返回短信验证码
15.3 密码重置链接存在弱Token
有些信息系统的密码找回功能会在服务端生成一个随机 Token 并发送到用户邮箱作
为密码找回凭证。但一旦这个 Token 的生成方式被破解，攻击者就可以伪造该Token作为
凭证重置其他用户的密码。测试流程如图15-19所示。
图15-19 测试流程图
15.3.1 使用时间戳的md5作为密码重置Token
步骤一：进入某网站先按正常流程取回一次密码，查看邮箱，邮件内容如图15-20所
示。
图15-20 邮件内容
步骤二：从邮件内容中可以看出参数vc为一串md5值，u为用户邮箱。将参数vc解密
后为1496732066。于是猜测参数vc应该为id值，尝试遍历id值并修改变量u，查看是否可以
修改其他用户密码，结果发现不可行。
步骤三：再仔细观察vc参数，发现和UNIX时间戳格式相符，于是使用UNIX时间戳转
换工具验证，转换成功，如图15-21所示。
图15-21 UNIX时间戳转换
步骤四：大致推测出该系统找回密码的流程。用户取回密码时，先产生一个精确的时
间戳并与账号绑定记录在数据库内，同时将该时间戳作为密码找回凭证发送到用户的注册
邮箱。只要用户能够向系统提供该时间戳即可通过认证，进入密码重置流程。但对攻击者
来说，只要编写一段程序在一定时间段内对时间戳进行暴力猜解，很快就可以获得找回密
码的有效链接，如图15-22所示。
图15-22 测试exp
步骤五：最终成功重置密码并登录到个人中心，如图15-23所示。
图15-23 重置密码成功
15.3.2 使用服务器时间作为密码重置Token
步骤一：进入某积分兑换商城，首先用 2 个账号在两个浏览器窗口中同时找回密码来
进行对比，如图15-24所示。
步骤二：对比邮箱中收到的找回密码链接，我们可以看出，找回密码使用的随机
Token只相差4，那么攻击者通过遍历Token的方式即可重置其他用户的密码，如图15-25所
示。
图15-24 开始找回密码
图15-25 重置密码链接
15.4 密码重置凭证与用户账户关联不严
有些信息系统在密码找回功能的校验逻辑上存在缺陷，只校验了密码重置凭证是否在
数据库中存在，但未严格校验该重置凭证和用户账号之间的绑定关系。这种密码重置凭证
与用户账户关联不严的逻辑漏洞就让攻击者可以通过在数据包中修改用户账号达到重置其
他密码的目的，如图15-26所示。
图15-26 业务流程图
15.4.1 使用短信验证码找回密码
步骤一：进入某手机厂商官网，首先填写自己的手机号码进行密码找回。
步骤二：收到验证码后填入验证码和新密码提交，这时候使用数据抓包工具进行抓
包，将数据包中的username修改为其他账号，post上去后就可以使用自己设置的密码登录
其他账号，如图15-27所示。
图15-27 重置密码链接
15.4.2 使用邮箱Token找回密码
步骤一：进入某公共信息网站使用真实信息找回密码后，系统会发送一封邮件到绑定
的邮箱。邮件中的找回密码链接如下：
http：//**.**.**.**/test.do？method=resetPassword&id=用户ID值
&authcode=XXX&Email=邮箱地址
步骤二：访问后可直接进入用户密码重置页面。在该页面输入新密码，并在提交时使
用抓包工具抓取数据抓包，可获得以下内容：
org.apache.struts.taglib.html.TOKEN=83accc27d5178f832d9f22a1d02bdacf&org.apache.struts.taglib.html.TOKEN=83accc27d5178f832d9f22a1d02bdacf&rt
Password=123456&passwordw=123456&rtEmail=邮箱&idtagCard=用户ID
步骤三：虽然包文中含有org.apache.struts.taglib.html.TOKEN和
org.apache.struts.taglib.html.TOKEN两个Token参数，但因为并没有和用户ID进行绑定验
证，依然可以通过修改用户ID重置他人密码。随机修改了一个用户ID并提交后，提示密
码重置成功，如图15-28所示。
图15-28 密码重置成功
15.5 重新绑定用户手机或邮箱
有些信息系统在绑定用户手机或者邮箱的功能上存在越权访问漏洞。攻击者可以利用
该漏洞越权绑定其他用户的手机或者邮箱后，再通过正常的密码找回途径重置他人的密
码。
15.5.1 重新绑定用户手机
步骤一：首先注册一个某邮箱的测试账号，然后会跳转到一个手机绑定的页面上，如
图15-29所示。
图15-29 绑定手机页面
步骤二：注意此处链接中有个参数为uid，将uid修改为其他人的邮箱账号。填入一个
你可控的手机号码，获取到验证码。确定后这个目标邮箱已经被越权绑定了密保手机，如
图15-30所示。
图15-30 手机号码绑定成功
步骤三：走正常的密码取回流程，发现这个邮箱多了一个通过手机找回密码的方式，
这个手机尾号就是刚刚绑定的手机号码，如图15-31所示。
步骤四：获取验证码并填入新密码，最终成功重置了目标账户的密码，如图15-32所
示。
图15-31 找回密码流程
图15-32 找回密码成功
15.5.2 重新绑定用户邮箱
步骤一：某网站用户注册后的激活页面链接如下：
http://**.***.com/user/test/2815193
步骤二：链接尾部的一串数字是用户的ID，通过修改这个ID即可进入其他用户的页
面，如图15-33所示，该页面提供了更改邮箱地址的功能，可在此处将邮箱地址修改为自
己的测试邮箱。
图15-33 用户激活页面
步骤三：然后使用该测试邮箱进行密码找回，即可重置目标用户的密码，如图15-34
所示。
图15-34 重置密码成功
15.6 服务端验证逻辑缺陷
有些信息系统的服务端验证逻辑存在漏洞。攻击者可以通过删除数据包中的某些参
数、修改邮件发送地址或者跳过选择找回方式和身份验证的步骤，直接进入重置密码界面
成功重置其他人的密码。
15.6.1 删除参数绕过验证
步骤一：某邮箱系统可以通过密码提示问题找回密码，如图15-35所示。
图15-35 通过密码提示问题找回密码
步骤二：首先随机填写密码答案，然后进入下一步，抓包后将问题答案的整个字段都
删除再提交，如图15-36所示。
图15-36 抓包截图
步骤三：因服务端验证逻辑存在缺陷，无法获取到问题答案的情况下直接通过了验
证，密码重置成功，如图15-37所示。
图15-37 密码修改成功
15.6.2 邮箱地址可被操控
步骤一：某网站可以通过注册时填写的邮箱来找回密码，但为防止网络不稳定等因素
导致邮件发送失败，找回密码页面提供了“重新发送邮件”的功能，如图15-38所示。
图15-38 重新发送邮件
步骤二：单击重新发送邮件，然后抓包拦截请求，将数据包中的邮箱地址改为自己的
测试邮箱，如图15-39所示。
图15-39 抓包截图
步骤三：进入自己的测试邮箱，单击收到的链接，密码重置成功，如图 15-40所示。
图15-40 修改密码成功
15.6.3 身份验证步骤可被绕过
步骤一：进入某网站的密码找回功能，输入账号和验证码，如图15-41所示。
步骤二：确定后，直接访问 http：//**.***.com.cn/reset/pass.do 即可跳过选择找回方式
和身份验证的步骤，直接进入重置密码界面，如图15-42所示。
图15-41 密码找回界面
图15-42 重置密码界面
步骤三：最终成功修改密码并登录到个人中心，如图15-43所示。
图15-43 登录成功
15.7 在本地验证服务端的返回信息——修改返回包绕过验证
有些信息系统在密码找回功能的设计上存在逻辑漏洞，攻击者只需要抓取服务端的返
回包并修改其中的部分参数即可跳过验证步骤，直接进入密码重置界面。
修改返回包绕过验证案例如下。
步骤一：进入某电商网站，单击忘记密码，输入用户名admin后选择手机找回，单击
发送验证码，然后随便填写一个验证码，单击下一步按钮，如图15-44所示。
图15-44 验证手机
步骤二：此时抓包并拦截返回的数据包。经过测试，将返回码改成 200 即可绕过验证