"
string(38) "	.?-KC@"
string(76) "0e091defbfbd12efbfbd2eefbfbdefbfbdefbfbd3f2defbfbd4b43efbfbd05efbfbd40efbfbd"
"K4FEmxz4yuTsjDAbRZQmHJ+MBiCSGaOnpZTLbThXpCkDYe3siAIPfihX6ppjN2Tz6XqOr4tF\/u1\/+ccfhj8NNLIL+2hknyDXbosmMBV8mEGYsMqQHAE0f+3OhDWlzN5RnteSMYNZbTipFErB8ZOWCiXmynWxsqJhyaN9J6\/\/h6I="
oops, hsm is jsonless?
```
`U+fffd`å˜æˆäº†`\xef\xbf\xbd`ã€‚æ‰€ä»¥ç”±äºŽ go çš„ json ç¼–ç é—®é¢˜ï¼Œä¸¢å¤±äº†å¾ˆå¤šä¿¡æ¯ï¼Œé€ æˆäº† md5 å‰çš„æ•°æ®æœ‰å¾ˆå¤šç›¸åŒå­—ç¬¦ã€‚å½“æ—¶åšé¢˜æ—¶å¾€ä¸‹å¹¶æ²¡æœ‰ç»†æƒ³ï¼Œå¾—åˆ° n åŽæ€»æ˜¯æƒ³æž„é€ å‡ºä»»æ„å‘½ä»¤çš„ç­¾åï¼Œä¹Ÿå¾ˆç–‘æƒ‘å¦‚æžœæž„é€ å‡ºå²‚ä¸æ˜¯è¿™ç§ç­¾åå°±ä¸å®‰å…¨äº†ï¼Ÿå…¶å®žæ˜¯æ— æ³•å¾—åˆ°çš„ã€‚
æ­£è§£æ˜¯ go çš„è¿™ç§é—®é¢˜ ï¼Œä¸ºç¢°æ’žåˆ›é€ äº†æ¡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥ç¢°æ’žå‡ºåœ¨è¿™ç§ç¼–ç æƒ…å†µä¸‹ä¸Ž `ls -l `æœ‰ç›¸åŒç»“æžœçš„`cat *` æ­¤ç±»å‘½ä»¤ã€‚ä½†æ˜¯é—®é¢˜æ˜¯æˆ‘ä»¬éœ€è¦éžå¸¸å¤§é‡ ip æ¥æä¾›ç¢°æ’žçš„æ•°æ®ã€‚
å¯ä»¥å‘çŽ°ï¼Œgo å– ip çš„æ—¶å€™ï¼Œæ˜¯å…ˆç”¨`net.ParseIP`è§£æžäº† ipï¼Œæˆ‘ä»¬åœ¨ ip æ¯ä¸ªæ•°å­—å‰é¢åŠ  0 ï¼Œè§£æžåŽè¿˜æ˜¯åŽŸæ¥çš„ ip ç»“æžœï¼Œæ¯ä¸ªæ•°å­—æœ€å¤šæ·»åŠ  256 ä¸ª 0ï¼Œå››ä¸ªæ•°å­—å°±å·²ç»äº§ç”Ÿäº† `2^32`ç§ä¸åŒçš„ç»„åˆï¼Œè¶³ä»¥ç¢°æ’žå‡º `ls -l `ä¸Ž `cat *`ä¹‹é—´çš„å†²çªã€‚
å®˜æ–¹é¢˜è§£çš„ c++ ç¢°æ’žè„šæœ¬æˆ‘æœ¬åœ°ç¼–è¯‘çš„æœ‰ç‚¹é—®é¢˜ï¼ŒåŠ äº†ä¸€äº›å¼•å…¥çš„å¤´æ–‡ä»¶ï¼š
```c++
// g++ -std=c++17 -march=native -O3 -lcrypto -lpthread gewalt.cpp -o gewalt
#include 
#include 
#include 
#include 
#include 
#include 
#include 
#include 
#include 
#include 
#include 
#include 
#include 
#include 
const unsigned num_threads = std::thread::hardware_concurrency();
static std::string hash(std::string const& s)
{
    SHA_CTX ctx;
    if (!SHA1_Init(&ctx)) throw;
    if (!SHA1_Update(&ctx, s.data(), s.length())) throw;
    std::string d(SHA_DIGEST_LENGTH, 0);
    if (!SHA1_Final((uint8_t *) &d[0], &ctx)) throw;
    return d;
}
static std::u32string kapot(std::string const& s)
{
    std::u32string r(s.size(), 0);
    size_t o = 0;
    for (size_t i = 0; i = s.size() || T(s[i+0]))
                     goto invalid;
                 goto one;
        case  3:
                 if (c &= 0x1f, i+1 >= s.size() || T(s[i+0]) || T(s[i+1]))
                     goto invalid;
                 goto two;
        case  4:
                 if (c &= 0x1f, i+2 >= s.size() || T(s[i+0]) || T(s[i+1]) || T(s[i+2]))
                     goto invalid;
                 cont();
        two:     cont();
        one:     cont();
                 goto valid;
        }
    }
    r.resize(o);
    return r;
}
std::atomic hcount = 0, kcount = 0;
typedef std::unordered_map tab_t;
tab_t tab0, tab1;
std::mutex mtx;
std::array ip;
std::string cmd0, cmd1;
class stuffer_t
{
    private:
        std::array cnts;
        size_t step;
        std::string cmd;
    public:
        stuffer_t(size_t t, size_t s, std::string c) : cnts{t}, step(s), cmd(c) {}
        std::string operator()()
        {
            //XXX this is by far not the most efficient way of doing this, but yeah
            if (++cnts[3] >= cnts[0]) {
                cnts[3] = 0;
                if (++cnts[2] >= cnts[0]) {
                    cnts[2] = 0;
                    if (++cnts[1] >= cnts[0]) {
                        cnts[1] = 0;
                        cnts[0] += step;
                    }
                }
            }
            std::stringstream o;
            for (size_t i = 0; i > 1, (num_threads + 1) >> 1, one ? cmd1 : cmd0);
    tab_t& mytab = one ? tab1 : tab0;
    tab_t& thtab = one ? tab0 : tab1;
    uint64_t myhcount = 0, mykcount = 0;
    while (1) {
        std::string r = next();
        {
            ++myhcount;
            auto h = hash(r);
            if ((h.size()+3)/4  3 + (size_t) std::count(k.begin(), k.end(), 0xfffd))
                continue;
            std::lock_guard lck(mtx);
            hcount += myhcount, myhcount = 0;
            kcount += mykcount, mykcount = 0;
            if (thtab.find(k) != thtab.end()) {
                mytab[k] = r;
                std::cerr  lck(mtx);
            std::cerr ::min() || n > std::numeric_limits::max())
                goto bad_ip;
            v = n;
        }
        if (!ss) {
bad_ip:
            std::cerr  ts;
    for (unsigned i = 0; i < num_threads; ++i)
        ts.push_back(std::thread(go, i));
    for (auto& t: ts)
        t.join();
}
```
ç¼–è¯‘å¯èƒ½ä¼šæ‰¾ä¸åˆ° `lcrypto`ï¼Œç¼–è¯‘å‘½ä»¤åŠ ä¸Š lcrypto è·¯å¾„ï¼ˆæˆ‘æœ¬åœ°æ˜¯ /usr/local/opt/openssl/libï¼‰
```bash
g++ -std=c++17 -march=native -O3 -lcrypto -lpthread gewalt.cpp -o gewalt -L/usr/local/opt/openssl/lib
```
ä¸Ž go äº¤äº’çš„è„šæœ¬ï¼š
```python
#!/usr/bin/env python3
import sys, requests, subprocess
benign_cmd = 'ls -l'
exploit_cmd = 'cat *'
ip, port = sys.argv[1], sys.argv[2]
url = 'http://{}:{}'.format(ip, port)
my_ip = requests.get(url + '/ip').text
print('[+] IP: ' + my_ip)
o = subprocess.check_output(['./gewalt', my_ip, benign_cmd, exploit_cmd])
print('[+] gewalt:' + o.decode())
payload = {}
for l in o.decode().splitlines():
    ip, cmd = l.split('|')
    payload['benign' if cmd == benign_cmd else 'pwn'] = ip, cmd
print(payload)
sig  = requests.post(url + '/sign', data={'ip': payload['benign'][0], 'cmd': payload['benign'][1]}).text
print('[+] sig: ' + sig)
r = requests.post(url + '/exec', data={'signature': sig[:172] + payload['pwn'][0]  + '|' + payload['pwn'][1]})
print(r.text)
```
```bash
 âš™  SaV-ls-l-aaS  python solve.py 127.0.0.1 60601
[+] IP: 172.17.0.1
fffd fffd fffd fffd fffd fffd 55 fffd fffd fffd fffd c fffd fffd fffd fffd fffd fffd fffd fffd
hash count:  168104875 (2^27.32)
kapot count: 3477222 (2^21.73)
table sizes: 8745 8856
[+] gewalt:00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000172.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000017.000000000000000000000000000000000000000000000000000000000000000000000000000000000.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001|ls -l
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000172.17.000000000000000000000000.0000000000000000000000000000000000000001|cat *
{'pwn': (u'00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000172.17.000000000000000000000000.0000000000000000000000000000000000000001', u'cat *'), 'benign': (u'00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000172.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000017.000000000000000000000000000000000000000000000000000000000000000000000000000000000.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001', u'ls -l')}
[+] sig: ODxSukwtu4rHICBpzT23WGD7DCJNawhA0DUN/tcyv1AgwNmS8OPUnO5FnBBDgiaVx5OTYd4OjH8LVbKiXUBUBuFx1OHDgKBKG5umkKMLt+350SlgMWY5qWny9tPIU3I+X0A9FcADCBCi6f0PkXfc0CSCZXuFu9rAKnVGsbmaUwY=00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000172.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000017.000000000000000000000000000000000000000000000000000000000000000000000000000000000.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001|ls -l
hxp{FLAG}
```
å‚è€ƒï¼š
- https://ctftime.org/writeup/17966