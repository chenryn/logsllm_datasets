来源：
如下面这个信号有幅度、相位、频率几个参数
简单来说IQ值是保存无线信号的一种数据格式，分为I和Q两路数据，从下图的最后一个等式可以看出只需要IQ数据就可以得到信号的幅度和相位等信息。
有了IQ数据再加上载波频率就可以还原出无线信号了，对应的硬件也较简单如下图
图 IQ数据对应硬件简图（图片来自网络）
**题目分析**
比赛的题目要求是要在这原始的无线数据中找出物理设备（注意这里说的物理设备，一个设备的网络地址等可能改变，但无论怎么变，它还只是一个物理设备，例如你一部手机断开WIFI后再连接前后的IP地址可能变了，但是你还只是一台物理设备,你的MAC地址一般也不会变），并且在网络环境变化（如移除某些设备，添加某些设备，设备的网络地址或者通信协议改变等等）后还要分辨出那些新增或者消失的物理设备。一共8道题目，要求找出B1和B2文件中每个独立物理设备的网络ID和设备ID，列出在B1中出现而在C1中未出现（比如设备已关闭或者断电）的物理设备的网络ID和设备ID，其他问题也是类似
B2和C2对应的问题也是类似，一共有8道题，其中B1和C1相关的有4道题，B2和C2相关的有4道题。
答题的时候需要给出设备的网络ID和设备ID，如下的示例答案
注意，这里网络ID和设备ID并不能标识一个物理设备，因为网络ID和设备ID有可能会变，后面会讲。
看看这题目感觉还是非常有挑战性的，首先工作在2.42GHz和908MHz这两个频率点的设备可能有很多，如蓝牙，WIFI，ZigBee，Z-Wave等等，那么如何在才能唯一的物理的识别这些采用不同协议的设备呢？
进一步阅读发现主办方还是比较仁慈的，做了一些限定。
主办方只要求我们分析802.15.4（ZigBee）和ITU-T G.9959（Z-Wave
https://en.wikipedia.org/wiki/Z-Wave）流量，排除其他流量，如802.11（WIFI）和802.15.1（蓝牙）。ZigBee和Z-Wave是物联网领域广泛采用的协议，常用于智能家居等，这与本次比赛的目的（IoT）还是比较契合的，因为蓝牙和WIFI的安全是比较成熟的研究领域，ZigBee和Z-Wave相对而言就算是比较新的领域了，后面我会再讲详细一点。
分析到这里我发现分数排行榜已经更新了，已经有人做到了75分。（比赛可以提交3次答案，最后会根据时间戳和最高分来确定最后成绩）
虽然我知道拿奖金的可能性比较低，但是既然参赛了还是想尽量早点提交结果期待拿个名次，所以还是有点开始着急了。
**继续分析题目**
至此已经知道题目要求和给的数据格式了，下一步就是如何根据给的数据来完成题目了
如下图所示，ZigBee通信一共有26个信道。
图 ZigBee的信道分布（图片来自网络）
主办方给出的B1和C1两个文件的采样中心频率是2.42GHz，和ZigBee的第14信道吻合。
下图是Z-Wave 的工作频率分布图
图 Z-Wave 的工频率（图片来自网络）
从图中可以看出，Z-Wave根据地区的不同而采用不同的频率，主办方给出的B2和C2两个文件的采样中心频率是908MHz，与Z-Wave在北美和南美采用的908.42MHz非常接近，虽然ZigBee在908MHz附近也有信道，但是可能性不大。题目只要求列出采用ZigBee和Z-Wave设备，所以可以确定B1和C1两个文件是要求参赛者找出ZigBee设备，而B2和C2则是要求参赛者找出Z-Wave设备。
至此数据格式及题目要求都已经搞清楚了，接下来就该下手做题了。
**IEEE802.15.4（ZigBee）**
ZigBee的协议栈我比较熟悉，因为我曾经研究过一段时间的ZigBee
安全性,所以拿ZigBee开刀进行分析（关于ZigBee的安全感兴趣的可以看看我和独角兽团队老大杨卿一起发表到DEFCON黑客大会的研究成果[《I am a
newbie yet I can hack ZigBee—take unauthorized control over ZigBee
devices》](https://www.defcon.org/html/defcon-23/dc-23-speakers.html#Li)）。
ZigBee是一种自组织网络，广泛用于智能家居、环境监测、远程控制等领域
图 ZigBee应用场景（图片来自网络）
ZigBee网络中的设备安功能不同分为3种：
协调器（Co-ordinator）：起核心协调作用，负责组网，分配网络地址等等
路由器（Router）：负责转发数据（也可以兼具设备功能，例如一个智能开关）
终端节点（End Device）：即设备，像传感器、智能家居里的开关等等
类似电脑一样，每个ZigBee设备在通信的时候主要由网络地址（NetworkID 又称为PANID）和设备地址（DeviceID，又称为短地址）来寻址。
图 ZigBee的网络拓扑（图片来自网络）
但是无论是网络地址还是设备地址都不能唯一的标记一个物理设备，因为NetworkID是由协调器在建立网络的时候设定的，所以同一个协调器物理设备可能建立不同NetworkID的网络，DeviceID是终端设备在入网时由协调器分配的，当这个终端设备再次入网的时候可能会得到另一个网络地址。也就是说，同一个设备，两次入网地址可能就变了，所以DeviceID也不能作为唯一标记物理设备的ID。
每一台ZigBee设备在出厂时都会有一个64位IEEE地址或者叫扩展地址，这个地址类似与电脑网卡的MAC地址，一般是不会变的，所以可以用来唯一标记一台物理设备，而这个IEEE地址在ZigBee通信过程中一般不使用（ZigBee通信过程一般使用网络地址和设备地址），只在特殊的时候使用，如设备申请入网时，网络广播时等等。只要能找到这些IEEE地址对应的物理设备，则无论这个设备的NetworkID和DeviceID怎么变都能够唯一地确定这些物理设备，所以参赛者的目标就是要找这些唯一的IEEE地址代表的物理设备，并在不同场景（及B1和C1两个场景）中找出其对应的网络地址和设备地址。
那么如何才能从IQ数据中找到IEEE地址呢？我最初的的几个想法是：
1.把数据用Python或者matlab进行处理，参考协议栈的文档一步一步从原始数据（Raw data）解析到网络层，即下图的NWK Frame那层
图 ZigBee帧结构（图片来自网络）
这种方法肯定费时费力，相当于要自己实现ZigBee协议栈，虽然有一些开源的协议栈可以修改和参考但总归比较麻烦。
开源的协议栈举例
2.对数据进行最简单的底层处理，然后用wireshark进行解析，也比较麻烦。
3.正在抓耳挠腮之际突然想到了软件无线电（SDR software defined
radio）设备可以录制信号及重放信号，而IQ数据正是一种很常用的信号保存格式，无线电安全研究部内的独角兽团队有很多同事是软件无线电专家，包括中国第一本软件无线电书籍的作者黄琳也是我们团队的。能不能用SDR把IQ数据重新发送出来，这样就好像是把主办方采集数据的环境从美国搬到了我这里，那么下一步就可以利用我之前做ZigBee安全研究积累的数据分析经验、软件和硬件了。
经过以上分析我决定采用第三种方法，下图是第三种方法的所需步骤的示意图：
我们已经下载了比赛数据，所以接下来我们要进行图中的第二步，把数据发送出来进行分析
发送数据：可以采用的设备有HackRF，USRP等等SDR硬件，我们团队都有（炫富ing），我们最终用的USRP来进行的发送信号。
分析数据：分析ZigBee数据可以用的软件硬件组合有也有很多，有付费版的软件如Ubiqua protocol analyzer，Perytons
protocol analyzer等等，免费的软件如TI packet sniffer，killerbee等等，
至于接收数据的硬件大部分分析软件都支持德州仪器的USB Dongle，而我们手头也有现成的。我最终选择了TI的免费软件+USB Dongle来分析数据。
下图为搭建好的环境，左边是USRP硬件+GNU Radio Companion软件用来发送数据，右边是ZigBee USB Dongle硬件+TI
Packet Sniffer软件用来接收和分析数据。
下图即为用用GNU Radio发送数据的流图：
现在可以发送数据了，但是还有一个问题需要解决，MITRE要求我们中无线信号中定位识别出发送信号的物理设备，日常环境中与现在我们要定位识别的ZigBee设备同样工作在2.4GHz频段的还有很多其他设备，如蓝牙、WIFI甚至其他ZigBee设备，我们肯定不希望受到其他设备的干扰或者错误地将其他ZigBee设备识别为比赛让我们识别的设备，所以我们需要解决干扰问题。
应对这个问题一般有多种方法，比如直接将信号发送方和信号接收方用屏蔽线（类似天线的馈线）连接起来，这样发送的信号只有接收方能收到，由于我采用的硬件是印制板天线，所以无法采用这一种方法。另一种方法就是在电磁屏蔽空间中进行，好在我们团队有电磁屏蔽实验室（炫富ing
x 2），下图即为屏蔽实验室的”铜墙铁壁” ；）
好了，发送数据、接收数据、抗干扰等问题都解决了，接下来看看如何分析数据，如前面所说，主办方要我们在不同环境下列出每个物理设备的网络ID和设备ID。