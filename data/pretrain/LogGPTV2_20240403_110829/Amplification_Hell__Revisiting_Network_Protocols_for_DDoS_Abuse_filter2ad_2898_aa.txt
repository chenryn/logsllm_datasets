title:Amplification Hell: Revisiting Network Protocols for DDoS Abuse
author:Christian Rossow
Ampliﬁcation Hell: Revisiting
Network Protocols for DDoS Abuse
VU University Amsterdam, The Netherlands
Horst G¨ortz Institute for IT-Security, Ruhr University Bochum, Germany
Christian Rossow
{ﬁrstname.lastname}@rub.de
Abstract—In distributed reﬂective denial-of-service (DRDoS)
attacks, adversaries send requests to public servers (e.g., open
recursive DNS resolvers) and spoof the IP address of a victim.
These servers,
in turn, ﬂood the victim with valid responses
and – unknowingly – exhaust its bandwidth. Recently, attackers
launched DRDoS attacks with hundreds of Gb/s bandwidth of this
kind. While the attack technique is well-known for a few protocols
such as DNS, it is unclear if further protocols are vulnerable to
similar or worse attacks.
In this paper, we revisit popular UDP-based protocols of
network services, online games, P2P ﬁlesharing networks and
P2P botnets to assess their security against DRDoS abuse. We
ﬁnd that 14 protocols are susceptible to bandwidth ampliﬁcation
and multiply the trafﬁc up to a factor 4670. In the worst case,
attackers thus need only 0.02% of the bandwidth that they want
their victim(s) to receive, enabling far more dangerous attacks
than what is known today. Worse, we identify millions of public
hosts that can be abused as ampliﬁers.
We then analyze more than 130 real-world DRDoS attacks.
For this, we announce bait services to monitor their abuse and
analyze darknet as well as network trafﬁc from large ISPs. We
use trafﬁc analysis to detect both, victims and ampliﬁers, showing
that attackers already started to abuse vulnerable protocols other
than DNS. Lastly, we evaluate countermeasures against DRDoS
attacks, such as preventing spooﬁng or hardening protocols and
service conﬁgurations. We shows that carefully-crafted DRDoS
attacks may evade poorly-designed rate limiting solutions. In
addition, we show that some attacks evade packet-based ﬁltering
techniques, such as port-, content- or length-based ﬁlters.
I.
INTRODUCTION
In a denial-of-service (DoS) attack, an attacker with ﬁnan-
cial, political or purely destructive motivation disrupts a service
of a victim by adding an excessively high load to the victim’s
service(s). There are several forms of DoS attacks [30, 18],
most of which are well-documented and used by attackers to
disturb services for years. For example, attackers target victims
with distributed DoS (DDoS) attacks and instruct infected PCs
that are part of a malicious botnets [4]. Similarly, attackers
can exhaust application-layer resources, such as the maximum
number of database sessions of a web application [30].
Permission(cid:1) to(cid:1) freely(cid:1) reproduce(cid:1) all(cid:1) or(cid:1) part(cid:1) of(cid:1) this(cid:1) paper(cid:1) for(cid:1) noncommercial(cid:1)
purposes(cid:1)is(cid:1)granted(cid:1)provided(cid:1)that(cid:1)copies(cid:1)bear(cid:1)this(cid:1)notice(cid:1)and(cid:1)the(cid:1)full(cid:1)citation(cid:1)
on(cid:1)the(cid:1)ﬁrst(cid:1)page.(cid:1)Reproduction(cid:1)for(cid:1)commercial(cid:1)purposes(cid:1)is(cid:1)strictly(cid:1)prohibited(cid:1)
without(cid:1)the(cid:1)prior(cid:1)written(cid:1)consent(cid:1)of(cid:1)the(cid:1)Internet(cid:1)Society,(cid:1)the(cid:1)ﬁrst-named(cid:1)author(cid:1)
(for(cid:1) reproduction(cid:1) of(cid:1) an(cid:1) entire(cid:1) paper(cid:1) only),(cid:1) and(cid:1) the(cid:1) author’s(cid:1) employer(cid:1) if(cid:1) the(cid:1)
paper(cid:1)was(cid:1)prepared(cid:1)within(cid:1)the(cid:1)scope(cid:1)of(cid:1)employment.
NDSS(cid:1)’14,(cid:1)23-26(cid:1)February(cid:1)2014,(cid:1)San(cid:1)Diego,(cid:1)CA,(cid:1)USA
Copyright(cid:1)2014(cid:1)Internet(cid:1)Society,(cid:1)ISBN(cid:1)1-891562-35-5
http://dx.doi.org/(cid:18)(cid:17)(cid:15)(cid:18)(cid:21)(cid:24)(cid:19)(cid:19)(cid:16)(cid:79)(cid:69)(cid:84)(cid:84)(cid:15)(cid:19)(cid:17)(cid:18)(cid:21)(cid:15)(cid:19)(cid:20)(cid:19)(cid:20)(cid:20)
In distributed reﬂective denial-of-service (DRDoS) attacks,
an adversary aims to exhaust
the victim’s bandwidth. He
abuses the fact that public servers of UDP-based network
protocols respond to requests without further validating the
identity (i.e., the IP address) of the sender. DRDoS offers many
desired attack features for an adversary: (i) He disguises his
identity, as victims receive backscatter trafﬁc from ampliﬁers,
i.e., systems that can be abused to send trafﬁc to the victim on
the attacker’s behalf; (ii) The simultaneous abuse of multiple
ampliﬁers permits a highly-distributed DoS attack to be con-
ducted from a single Internet uplink. (iii) The trafﬁc reﬂected
to the victim is signiﬁcantly larger in bandwidth than the trafﬁc
an attacker has to send to the ampliﬁers.
Adversaries abused the high potential of massive DRDoS
attacks recently. In May 2012, attackers targeted a real-time
ﬁnancial exchange platform with a 167 Gb/s DRDoS at-
tack [15]. In March 2013, attackers launched 300 Gb/s DRDoS
attack against Spamhaus.org [16]. In August 2013, presumably
politically-motivated attackers brought down GreenNet, an
ISP hosting human rights groups, with a 100 Gb/s DRDoS
attack [36]. In these known examples, attackers abused open
DNS resolvers to amplify their attack trafﬁc. The attacker(s)
issued specially-crafted ANY requests to thousands of open
resolvers and speciﬁed the victim’s IP address as packet
source. In turn, after successful name resolution, the resolvers
sent several-kilobyte-large responses to the victim, exceeding
its bandwidth capacity. With these attacks, DNS has been
practically proven to be vulnerable to DRDoS abuse. One of
the reasons for this vulnerability are the recent deployment
of EDNS0 and DNSSEC, which signiﬁcantly increases the
DNS response sizes [5]. As a consequence, developers and
administrators increasingly harden DNS servers against abuse,
e.g., by closing millions of open resolvers and limiting the
request rate per client [38]. However, DNS is not the only
widely-deployed service, and little is known about angles for
ampliﬁcation of other popular network protocols.
In this paper, we revisit UDP-based network protocols and
evaluate if they are vulnerable to ampliﬁcation attacks. We
identify and describe ampliﬁcation vectors in 14 protocols of
various services, including network services (such as NTP,
SNMP, SSDP and NetBios), legacy services (CharGen and
QOTD), peer-to-peer (P2P) ﬁlesharing networks (BitTorrent
and Kad), game servers (Quake 3 and Steam) and P2P-
based botnets. Many of these protocols have been designed
decades ago way before DRDoS attacks emerged. As we
show, attackers can abuse these protocols to multiply their
attack bandwidth by factors from 3.8 (BitTorrent, NetBios)
up to 4670 (NTP). In combination with source IP address
spooﬁng, this adds severe loads to designated DRDoS victims.
For each protocol, we explore the set of potential ampliﬁers,
for example, by scanning the Internet for open services, by
crawling P2P networks, or by requesting game server lists from
master servers. We show that millions of potential ampliﬁers
are available for six vulnerable protocols – ideal for attackers
that aim to distribute attacks over many trafﬁc sources.
We then use a three-fold approach to understand if attackers
abuse these vulnerable protocols. (i) We deploy bait services
for these protocols and monitor how they are abused by attack-
ers. (ii) We analyze if attackers scan for potential ampliﬁers
by looking at the scanning noise of two darknets. (iii) We
propose a light-weight method to detect DRDoS attacks via
trafﬁc analysis and deploy it at a large ISP. Our evaluation of
more than 130 real-world DRDoS attacks shows that DNS is
still the most popular DRDoS protocol, but we also already
witnessed attacks abusing CharGen, SNMP and Quake 3.
Fearing that adversaries will soon discover other powerful
ampliﬁcation vectors like NTP or SSDP, we describe and
evaluate countermeasures. We show that for some of the
protocols, existing attack detection techniques, such as port-,
content- or length-based ﬁltering approaches will fail, as none
of these attributes is characteristic in the attack trafﬁc. In ad-
dition, we show that request rate limiting does not sufﬁciently
protect against carefully-crafted DRDoS attacks that abuse
millions of ampliﬁers. To foster security of future protocols
and their implementations, we also discuss how protocols can
be hardened and give positive examples that are presumably
immune to DRDoS attacks.
The following list summarizes our contributions:
1) We discover that 14 network protocols can be abused
to launch DRDoS attacks that amplify the attack
trafﬁc by the order of up to three magnitudes. We
found thousands, and for six protocols even millions
of ampliﬁers, allowing for highly distributed attacks.
2) We propose methods to detect real-world DRDoS
attacks, such as bait services that are monitored for
abuse and using trafﬁc analysis to identify DRDoS
victims and ampliﬁers. We analyze more than 130
real-world attacks, showing that DRDoS attacks
bother network operators on a daily basis.
3) We describe and evaluate DRDoS countermeasures
and discuss methods (not) to use to harden network
protocols and vulnerable implementations.
II. THREAT MODEL
Our threat model are distributed and reﬂective denial-of-
service (DRDoS) attacks, in which an attacker A aims to con-
sume all available bandwidth of a victim V . Reﬂective means
that A does not directly send trafﬁc to V , but instead uses
systems that reﬂect the attack trafﬁc to V (so called ampliﬁers).
Distributed accounts for the fact that A abuses thousands of
ampliﬁers and V thus faces thousands of attack sources. The
victim V is any Internet-connected host (i.e., server or client)
with a single uplink, usually (but not necessarily) identiﬁed by
a single IPv4 address.
A controls an Internet gateway that can send IP packets
with spoofed source addresses. This assumption is reasonable
despite the fact that IP spooﬁng is considered a bad habit and is
discouraged [21]. As of July 2013, the Spoofer Project listed
that 25% of the Autonomous Systems world-wide allow IP
spooﬁng [1]. Our threat model becomes more severe the higher
the bandwidth available to A, but we do not make assumptions
about the bandwidth an attacker can use.
A further knows at least one UDP-based protocol P for
which he can craft requests that a server (a potential ampliﬁer)
for P will answer. We assume that A can obtain a set of
ampliﬁers (MP ) that respond to valid requests of protocol
P . As we will show, obtaining MP is typically not a high
burden to attackers, as attackers can easily understand most
network protocols by reading public documentation or open
source code. In this work, we focus on protocols for which the
responses are larger than the requests. Attacks become worse
the higher this imbalance is, as A can then actually amplify
(and not only reﬂect) its trafﬁc.
We further restrict A such that he cannot control or
conﬁgure the ampliﬁers in any way, i.e., he can only use
services offered to anybody. To be speciﬁc, for the P2P botnets
we analyze, A can not command the bots.
Fig. 1: Our threat model: An attacker sends requests to ampliﬁers with
the victim’s IP address as IP packet source. In turn, the ampliﬁers send
(potentially multiple) large responses to the victim.
The remainder of this paper is structured as follows. In Sec-
tion II, we describe our threat model. In Section III, we show
popular network protocols that are vulnerable to ampliﬁcation.
We search for real-world attacks abusing these protocols in
Section IV. We evaluate countermeasues in Section V, discuss
our ﬁndings and future work in Section VII and conclude our
work in Section VIII.
Figure 1 illustrates our threat model. A sends small requests
to three heterogeneous ampliﬁers that all run services that
are vulnerable to an ampliﬁcation attack. A speciﬁes V ’s IP
address as source for the request sent to MP , causing the
ampliﬁers to send their responses to V — although V never
asked for it. In case of ampliﬁcation vulnerabilities in P , MP
typically sends responses which are signiﬁcantly larger than
the requests, causing bandwidth congestion at V .
2
VictimAttackerAmplifiersOther types of DDoS attacks are outside the scope of this
work, such as exhausting TCP connections or slowing down
application-layer services. Note that we focus on IPv4 only,
but our results should be similar in IPv6 networks.
To summarize, our threat model represents a typical setting
of underground DDoS services. In fact, the most severe DR-
DoS attacks so far followed exactly this setting [16, 15, 36].
In this work, we seek to understand if we can expect similar
or even worse attacks in the future.
III. AMPLIFICATION VULNERABILITIES
In DRDoS attacks, two main factors determine the impact
of an attack. First, attackers strive to abuse network proto-
cols that not only reﬂect trafﬁc, but that also amplify the
attack bandwidth. Second, the number of ampliﬁers and their
aggregated attack bandwidth constrains the bandwidth of an
DRDoS attack. In this section, we show which popular network
protocols are attractive to attackers in this regard.
A. Protocol Overview
One of the key characteristics of DRDoS attacks is that
attackers abuse network protocols in which i) small requests
lead to relatively large responses and ii) where reﬂection of
trafﬁc with spoofed IP source addresses is possible due to the
lack of a proper handshake. As such, we exclude all TCP-
based protocols from our analysis, as IP address spooﬁng is
restricted to the start of the TCP handshake. Although the TCP
handshake fulﬁls the reﬂection criterion, it does not allow for
easy ampliﬁcation (since a TCP ACK is not larger than a TCP
SYN packet). However, we show that 14 popular UDP-based
network protocols are suitable candidates for DRDoS attacks.
Protocol
Cat
c SNMP v2
v
S
NTP
DNS
NetBios
SSDP
k
r
o
w
t
e
N
. CharGen
P BitTorrent
QOTD
Kad
g
e
L
2
P
s
t
o
B
m Quake 3
a
G
Steam
ZAv2
Sality
Gameover
Port(s)
Description
161 Monitoring network-attached devices
123
53
137
1900
19
17
any
any
27960
27015
164XY
any
any
Time synchronization
(Primarily) Domain name resolution
Name service protocol of NetBios API
Discovery of UPnP-enabled hosts
Legacy character generation protocol
Legacy ”Quote-of-the-day” protocol
BitTorrent’s Kademlia DHT impl.
eMule’s Kademlia DHT impl.
Games using the Quake 3 engine
Games using the Steam protocol
P2P-based rootkit
P2P-based malware dropper
P2P-based banking trojan
TABLE I: Overview of the analyzed network protocols grouped into
ﬁve categories: network services, legacy protocols, P2P ﬁle sharing,
multiplayer games and P2P-based botnets. The Port(s) column de-
scribes the typical UDP listening port for the service or speciﬁes any
if ports are chosen randomly.
Table I categorizes the 14 protocols that we analyzed into
ﬁve groups. The ﬁrst group consists of popular protocols used
for network services, such as time synchronization, host dis-
covery or device monitoring. We added two legacy protocols,
Character Generation (CharGen, RFC 864) and Quote of the
Day (QOTD, RFC 865), to the second group. The third group
comprises two protocols of P2P-based ﬁle sharing networks. In
group four, we added two game server engines that are used for
various game implementations. In the last group, we explore
3
how P2P-based botnets [26] can be abused for DRDoS attacks,
i.e., even for somebody not being the botmaster. This non-
exhaustive list represents the protocols that we found are most
relevant for our analysis. We excluded a few protocols from
our analysis for which we did not ﬁnd ampliﬁcation vectors,
such as the ECHO and ISAKMP protocols – these protocols