title:An Empirical Study of the Cost of DNS-over-HTTPS
author:Timm B&quot;ottger and
F&apos;elix Cuadrado and
Gianni Antichi and
Eder Leão Fernandes and
Gareth Tyson and
Ignacio Castro and
Steve Uhlig
An Empirical Study of the Cost of DNS-over-HTTPS
Timm Böttger, Felix Cuadrado, Gianni Antichi, Eder Leão Fernandes,
Gareth Tyson, Ignacio Castro and Steve Uhlig
Queen Mary University of London
ABSTRACT
DNS is a vital component for almost every networked application.
Originally it was designed as an unencrypted protocol, making user
security a concern. DNS-over-HTTPS (DoH) is the latest proposal
to make name resolution more secure.
In this paper we study the current DNS-over-HTTPS ecosystem,
especially the cost of the additional security. We start by survey-
ing the current DoH landscape by assessing standard compliance
and supported features of public DoH servers. We then compare
different transports for secure DNS, to highlight the improvements
DoH makes over its predecessor, DNS-over-TLS (DoT). These im-
provements explain in part the significantly larger take-up of DoH
in comparison to DoT.
Finally, we quantify the overhead incurred by the additional
layers of the DoH transport and their impact on web page load
times. We find that these overheads only have limited impact on
page load times, suggesting that it is possible to obtain the improved
security of DoH with only marginal performance impact.
CCS CONCEPTS
• Networks → Transport protocols; Network measurement;
Network security.
KEYWORDS
DNS-over-HTTPS, Transport, Performance
ACM Reference Format:
Timm Böttger, Felix Cuadrado, Gianni Antichi, Eder Leão Fernandes,
Gareth Tyson, Ignacio Castro and Steve Uhlig. 2019. An Empirical Study
of the Cost of DNS-over-HTTPS. In IMC ’19: ACM Internet Measurement
Conference, October 21–23, 2019, Amsterdam, Netherlands. ACM, New York,
NY, USA, 7 pages. https://doi.org/10.1145/3355369.3355575
1 INTRODUCTION
Introduced in 1983, the Domain Name System (DNS) has become a
critical component of the Internet. In addition to its original purpose
of domain name resolution, DNS has also gained relevance due to its
intensive use by Content Distribution Networks (CDNs) for traffic
redirection [5, 8]. Most websites nowadays include content from
third parties, hence requiring multiple DNS queries [7] to access a
single page. To highlight this, Figure 1 shows the number of DNS
queries required to fully retrieve each page in the Alexa global top
100k sites. Each website was retrieved through Firefox, logging the
Permission to make digital or hard copies of part or all of this work for personal or
classroom use is granted without fee provided that copies are not made or distributed
for profit or commercial advantage and that copies bear this notice and the full citation
on the first page. Copyrights for third-party components of this work must be honored.
For all other uses, contact the owner/author(s).
IMC ’19, October 21–23, 2019, Amsterdam, Netherlands
© 2019 Copyright held by the owner/author(s).
ACM ISBN 978-1-4503-6948-0/19/10.
https://doi.org/10.1145/3355369.3355575
Figure 1: CDF of the number of DNS queries required to re-
trieve all embedded objects for each of the top 100k Alexa
sites.
DNS requests at the stub resolver. Caches of both Firefox and the
DNS stub resolver were emptied before requesting the next website.
The figure illustrates that multiple DNS queries per page are the
norm rather than the exception: about 50% of the sites require at
least 20 DNS queries.
DNS impacts networked application performance [6] and can re-
veal information about the destination of a connection [4]. Address-
ing increasing concerns about security, DNS-over-TLS (DoT) [11]
and more recently DNS-over-HTTPS (DoH) [10] have been pro-
posed within the IETF. To increase security, these protocols rely
on a TLS session between the client and the resolver. In the case of
DoH, this TLS session also contains a HTTP connection. So far, DoT
has only gained limited traction, whereas DoH has gathered sub-
stantial momentum already [13], with the help of notable players
like Mozilla, Cloudflare and Google.
In this paper, we take a first look at the implications of securing
DNS with DoH. We also compare DoT and DoH to shed some
light on why the latter has recently gained so much interest. The
following are the main contributions:
(1) We survey and characterize the current landscape for secure
DNS via HTTP and TLS.
(2) We compare different transport protocols for securing DNS
resolution, to understand the momentum behind DoH.
(3) We quantify the overheads incurred by the additional HTTP
and TLS layers in DoH.
(4) We take a first look at the impact that switching to DoH has
on web performance, more specifically DNS resolution times
and page load times.
2 THE DOH LANDSCAPE
To better understand the current landscape of DoH resolvers, we
take the list of DoH servers curated by the curl project,1 and assess
their supported feature set. We initially retrieved all information
1https://github.com/curl/curl/wiki/DNS-over-HTTPS
15
 0 0.2 0.4 0.6 0.8 1 0 50 100 150 200 250CDFNumber of queriesIMC ’19, October 21–23, 2019, Amsterdam, Netherlands
Timm Böttger et al.
DoH URL
https://dns.google.com/resolve
https://dns.google.com/dns-query
https://cloudflare-dns.com/dns-query
https://dns.quad9.net/dns-query
Provider
MK
Google (i)
G1
Google (ii)
G2
Cloudflare
CF
Quad9
Q9
CleanBrowsing https://doh.cleanbrowsing.org/doh/family-filter CB
PD
PowerDNS
Blahdns
BD
https://doh.powerdns.org/
https://doh-ch.blahdns.com/dns-query
https://doh-jp.blahdns.com/dns-query
https://doh-de.blahdns.com/dns-query
https://doh.securedns.eu/dns-query
https://dns.rubyfish.cn/dns-query
SecureDNS
Rubyfish
Commons Host https://commons.host/
SD
RF
CH
Table 1: Compared DoH resolvers. Markers (MK) refer to col-
umn identifiers used in Table 2. Blahdns offers DoH services
on three different URLs.
in this section on 10 October 2018. We then verified it and, where
necessary, updated entries in both tables again on 10 September
2019.
As Table 1 shows, major players like Google, Cloudflare and IBM
(Quad9), as well as some smaller players, support DoH. We observe
diversity in their service configurations. While different base URLs
for every service can be expected, it is surprising to see four differ-
ent URL paths (/, /resolve, /dns-query, /family-filter) just
among these nine providers. Google even uses different paths to
two different services with the same base URL. While technically
the DoH RFC [10] does not mandate a specific path to be used and
leaves it up to the service operators, the majority of services still
use the path /dns-query, which is the one used in all examples in
the RFC. Given the huge efforts spent by operators to obtain easy-
to-remember and thus easy-to-configure IP addresses for their UDP
based DNS servers [12, 24], seeing such a potentially confusing
variety and choices for the DoH service parameters is noteworthy.
DoH operators indeed seem to have realised this, when we first
collected this information in October 2018 we observed six different
base paths for the same set of providers, while now we only observe
four.
We now examine the features supported by the individual re-
solvers. HTTP supports the transmission of different content types.
As per the DoH RFC, all DoH servers and clients must support
the application/dns-message content type, which essentially is
an encapsulation of the UDP DNS wireformat in HTTPS. Another
widely supported type is application/dns-json which represents
DNS messages in JSON format. While a draft RFC for the JSON DNS
format [3] exists, its support is not mandatory for DoH servers. The
application/dns-message content type is supported by all imple-
mentations except Google’s. Google in fact operates two different
services with two different paths (/resolve and /dns-query) on
the same domain, with each service only supporting one content
type. Curiously enough, the service supporting the RFC mandated
format was initially named /experimental and has since then be-
ing renamed to /dns-query. This again highlights that operators
have understood that too many different URLs are confusing and
Feature
G1 G2 CF Q9 CB PD BD SD RF CH
✗
✗
✓
✓
✓
✓
✓
✗
✓
✓
✓
✗
✓
✗
✗
✗
✓
✓
✓
✓
✓
✓
✓
✓
✓
✗
✓
✓
✓
✓
✗ ✓ ✓
✓ ✗
✓
✓
✗
✗
✓
✓ ✓ ✓
✓ ✓ ✓
dns-message
dns-json
TLS 1.0
TLS 1.1
TLS 1.2
TLS 1.3
CT
DNS CAA
OCSP MS
QUIC
✗
DNS-over-TLS ✓ ✓ ✓
✗
Traf. Steering DL* DL* AC+ AC+ AC+ UC± UC± UC± UC± AC+
* DNS Load Balancing
✓ ✓ ✓
✓ ✓
✗
✗
✗
✗
+ Anycast
± Unicast
✗
✗
✓
✓
✓
✗
✗
✗
✗
✓
✗
✓