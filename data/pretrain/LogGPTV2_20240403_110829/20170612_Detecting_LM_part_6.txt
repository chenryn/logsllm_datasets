When Execution is Successful
Points to be Confirmed
Log Generation Additional
Communication Log Type and Name Acquired Information Details
Location Settings
Event ID: 4688 (A new process has been created)
4689 (A process has exited)
- Process Information -> Process Name: "[File Name (mimikatz.exe)]"
- Confirmable Information
- Process Start/End Time and Date: Log Date
- Name of User Who Executed the Process: Subject -> Account Name
- Domain of User Who Executed the Process: Subject -> Account Domain
- Presence of Privilege Escalation at Process Execution: Process Information -> Token Escalation Type
- Process Return Value: Process Information -> Exit Status
Until all tickets are processed, the processing of the Event IDs: 4656, 4663, and 4658 are repeated.
Event ID: 4656 (A handle to an object was requested)
- Process Information -> Process Name: "[File Name (mimikatz.exe)]"
Event Log
- Required
- Confirmable Information
Security
- Targeted File: Object -> Object Name ("[Ticket File Name]")
- Handle ID: Object -> Handle ID *Used for association with other logs.
- Process Details: Access Request Information -> Access ("READ_CONTROL", "SYNCHRONIZE", "WriteData (or AddFile)",
"AppendData (or AddSubdirectory or CreatePipeInstance)", "WriteEA", "ReadAttributes", "WriteAttributes")
Event ID: 4663 (An attempt was made to access an object)
Host
-
(Windows)
- Confirmable Information
- Handle ID: Object -> Handle ID *Used for association with other logs.
- Process Details: Access Request Information -> Access ("WriteData (or AddFile)", "AppendData (or AddSubdirectory or
CreatePipeInstance)")
Event ID: 4658 (The handle to an object was closed)
- Confirmable Information
- Handle ID: Object -> Handle ID
Event ID: 1 (Process Create)
5 (Process Terminated)
- Image: "[File Name (mimikatz.exe)]"
Event Log
- - Confirmable Information Required
Sysmon - Process Start/End Time and Date (UTC): UtcTime
- Process Command Line: CommandLine *The used option is recorded as an argument (it is recorded in Event ID 1).
- User Name: User
- Process ID: ProcessId
File name:
Execution History C:\Windows\Prefetch\[Executable File (MIMIKATZ.EXE)]-[RANDOM].pf
- -
- Confirmable Information (the following can be confirmed using this tool: WinPrefetchView)
Prefetch
- Last Execution Time and Date: Last Execution Time
Remarks
Additional Event Logs That Can Be Output -
31
3.3.6. WCE (Windows Credentials Editor)
Basic Information
Tool Name WCE (Windows Credentials Editor) Legend
Category Password and Hash Dump - Acquirable
Tool Overview Acquires password hash information in the memory of a logged in host Information
Tool - Event ID/Item Name
Example of
- Field Name
Presumed Tool Use This tool uses the acquired hash information to perform pass-the-hash and other attacks.
- "Field Value"
During an Attack
Authority Administrator
Targeted OS Windows
Operating Domain Not required
Condition Communication
-
Protocol
Service -
Standard Settings - Execution history (Prefetch)
Information
- The fact that a tool was executed, and the option used during tool execution (Sysmon).
Acquired from
Additional Settings - Reference of lsass.exe by the tool (Sysmon)
Log
- Creation / deletion of a file (audit policy)
Evidence That Can Be Confirmed
- The "C:\Users\[User Name]\AppData\Local\Temp\wceaux.dll" file was created and deleted.
When Execution is Successful
Points to be Confirmed
Log Generation Additional
Communication Log Type and Name Acquired Information Details
Location Settings
Event ID: 4688 (A new process has been created)
4689 (A process has exited)
- Process Information -> Process Name: "[File Name (wce.exe)]"
- Confirmable Information
- Process Start/End Time and Date: Log Date
- Name of User Who Executed the Process: Subject -> Account Name
- Domain of User Who Executed the Process: Subject -> Account Domain
- Presence of Privilege Escalation at Process Execution: Process Information -> Token Escalation Type
- Process Return Value: Process Information -> Exit Status
Event ID: 4656 (A handle to an object was requested)
4663 (An attempt was made to access an object)
4658 (The handle to an object was closed)
- Process Information -> Process Name: "[File Name (wce.exe)]"
Event Log
- Confirmable Information
- Required
- Targeted File: Object -> Object Name: ("C:\Users\[User Name]\AppData\Local\Temp\wceaux.dll")
Security
- Handle ID: Object -> Handle ID *Used for association with other logs.
- Process Details: Access Request Information -> Access ("READ_CONTROL", "SYNCHRONIZE", "ReadData (or
"WriteData (or AddFile)", "AppendData (or AddSubdirectory or CreatePipeInstance)",
"ReadEA", "WriteEA", "ReadAttributes", "WriteAttributes")
- Success or Failure: Keywords ("Audit Success")
Event ID: 4656 (A handle to an object was requested)
4660 (An attempt was deleted)
4658 (The handle to an object was closed)
- Process Information -> Process Name: "[File Name (wce.exe)]"
Host
－
(Windows)
- Confirmable Information
- Targeted File: Object -> Object Name: ("C:\Users\[User Name]\AppData\Local\Temp\wceaux.dll")
- Handle ID: Object -> Handle ID *Used for association with other logs.
- Process Details: Access Request Information -> Access ("DELETE")
- Success or Failure: Keywords ("Audit Success")
Event ID: 1 (Process Create)
5 (Process Terminated)
- Image： "[File Name (wce.exe)]"
- Confirmable Information
- Process Start/End Time and Date (UTC): UtcTime
- Process Command Line: CommandLine
Event Log - User Name: User
- - Process ID: ProcessId Required
Sysmon
Event ID: 8 (CreateRemoteThread detected)
- Image： "[File Name (wce.exe)]"
- TargetImage: "C:\Windows\System32\lsass.exe"
- Confirmable Information
- Process Start Time and Date (UTC): UtcTime
File name:
Execution History C:\Windows\Prefetch\[File Name (WCE.EXE)]-[RANDOM].pf
- -
- Confirmable Information (the following can be confirmed using this tool: WinPrefetchView)
Prefetch
- Last Execution Time and Date: Last Execution Time
Remarks
Additional Event Logs That Can Be Output -
32
3.3.7. gsecdump
Basic Information
Tool Name gsecdump Legend
Category Password and Hash Dump - Acquirable
Tool Overview Extracts hash from SAM/AD or logon sessions Information
Tool - Event ID/Item Name
Example of
- Field Name
Presumed Tool Use This tool is used to log on to other hosts using acquired hash information.
- "Field Value"
During an Attack
Authority Administrator
Targeted OS Windows 32-bit (a tool that operates in the 64-bit environment has yet to be confirmed)
Operating Domain Not required
Condition Communication
-
Protocol
Service -
Information Standard Settings - Execution history (Prefetch)
Acquired from Additional Settings - Execution history (Sysmon / audit policy)
Evidence That Can Be Confirmed
The successful execution of the tool cannot be determined from event logs or execution history.
When Execution is Successful
Points to be Confirmed
Log Generation Additional
Communication Log Type and Name Acquired Information Details
Location Settings
Event ID: 4688 (A new process has been created)
4689 (A process has exited)
- Process Information -> Process Name: "[File Name]"
Event Log
- Confirmable Information
- Required
- Process Start/End Time and Date: Log Date
Security
- Name of User Who Executed the Process: Subject -> Account Name
- Domain of User Who Executed the Process: Subject -> Account Domain
- Presence of Privilege Escalation at Process Execution: Process Information -> Token Escalation Type
- Process Return Value: Process Information -> Exit Status
Event ID: 1 (Process Create)
Host
- 5 (Process Terminated)
(Windows)
- Image: "[File Name]"
Event Log
- - Confirmable Information Required
Sysmon - Process Start/End Time and Date (UTC): UtcTime
- Process Command Line: CommandLine *The used option is recorded as an argument.
- User Name: User
- Process ID: ProcessId
File name:
Execution History C:\Windows\Prefetch\[File Name (GSECDUMP.EXE)]-[RANDOM].pf
- -
- Confirmable Information (the following can be confirmed using this tool: WinPrefetchView)
Prefetch
- Last Execution Time and Date: Last Execution Time
Remarks
Additional Event Logs That Can Be Output -
33
3.3.8. lslsass
Basic Information
Tool Name lslsass Legend
Category Password and Hash Dump - Acquirable
Tool Overview Acquires a password hash of active logon sessions from the Isass process Information
Tool - Event ID/Item Name
Example of
- Field Name
Presumed Tool Use This tool is used to perform logon authentication on other hosts using the acquired hash information.
- "Field Value"
During an Attack
Authority Administrator
Targeted OS Windows
Operating Domain Not required
Condition Communication
-
Protocol
Service -
Information Standard Settings - Execution history (Prefetch)
Acquired from Additional Settings - Execution history (Sysmon/access history)
Evidence That Can Be Confirmed
The successful execution of the tool cannot be determined from event logs or execution history.
When Execution is Successful
Points to be Confirmed
Log Generation Additional
Communication Log Type and Name Acquired Information Details
Location Settings
Event ID: 4688 (A new process has been created)
4689 (A process has exited)
- Process Information -> Process Name: "[File Name (Islsass[Bit Number].exe)]"
Event Log
- - Confirmable Information Required
Security - Process Start/End Time and Date: Log Date
- Name of User Who Executed the Process: Subject -> Account Name
- Domain of User Who Executed the Process: Subject -> Account Domain
- Process Return Value: Process Information -> Exit Status
Event ID: 1 (Process Create)
- Host 5 (Process Terminated)
(Windows) - Image： "[File Name (Islsass[Bit Number].exe)]"
Event Log
- - Confirmable Information Required
Sysmon - Process Start/End Time and Date (UTC): UtcTime
- Process Command Line: CommandLine *The used option is recorded as an argument.
- User Name: User
- Process ID: ProcessId
File name: ）
C:\Windows\Prefetch\[Executable File(LSLSASS[Number of Bits].EXE ]-[RANDOM].pf
Execution History
-
Prefetch - Confirmable Information (the following can be confirmed using this tool: WinPrefetchView)
- Last Execution Time and Date: Last Execution Time
Remarks
Additional Event Logs That Can Be Output
34
3.3.9. Find-GPOPasswords.ps1
Basic Information
Tool Name Find-GPOPasswords.ps1 Legend
Category Password and Hash Dump - Acquirable
Tool Overview Acquires any password descriptions in a group policy file Information
Tool - Event ID/Item Name
Example of
- Field Name
Presumed Tool Use This tool attempts to infiltrate other hosts using acquired passwords (by executing the tool on Active Directory).
- "Field Value"
During an Attack
Authority Administrator
Windows Server
Targeted OS
This investigation is conducted on the Domain Controller.
Operating
Domain Required
Condition
Communication
-
Protocol
Service -
- Execution history (Prefetch)
Information Standard Settings
*The information is not of use when PowerShell is used in regular operations.
Acquired from
- The fact that PowerShell was started is recorded.
Log Additional Settings
- The fact that a file in which passwords are dumped (GPPDataReport-[Domain Name]-[Time and Date].csv) is output is recorded.
Evidence That Can Be Confirmed
- A file in which a password was dumped (GPPDataReport-[Domain Name]-[Time and Date].csv) is output.
When Execution is Successful
Points to be Confirmed
Log Generation Additional
Communication Log Type and Name Acquired Information Details
Location Settings
Event ID: 4688 (A new process has been created)
4689 (A process has exited)
- Process Information -> Process Name: "C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe"
- Confirmable Information
- Process Start/End Time and Date: Log Date
- Name of User Who Executed the Process: Subject -> Account Name
- Domain of User Who Executed the Process: Subject -> Account Domain
- Presence of Privilege Escalation at Process Execution: Process Information -> Token Escalation Type
- Process Return Value: Process Information -> Exit Status
Event ID: 4656 (A handle to an object was requested)
- Process Information -> Process Name: "C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe"
- Confirmable Information
- Targeted File: Object -> Object Name: ("C:\Users\[User Name]\AppData\Local\Microsoft\Windows\SchCache
\[Domain Controller FQDN].sch")
- Handle ID: Object -> Handle ID *Used for association with other logs.
- Process Details: Access Request Information -> Access ("READ_CONTROL", "SYNCHRONIZE", "WriteData (or AddFile)",
"AppendData (or AddSubdirectory or CreatePipeInstance)","WriteEA","ReadAttributes","WriteAttributes")
Event ID: 4663 (An attempt was made to access an object)
- Process Information -> Process Name: "C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe"
- Confirmable Information
- Handle ID: Object -> Handle ID *Used for association with other logs.
- Process Details: Access Request Information -> Access ("WriteData (or AddFile)", "AppendData (or AddSubdirectory
or CreatePipeInstance)")
Event ID: 4658 (The handle to an object was closed)
- Process Information -> Process Name: "C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe"
Event Log
- - Confirmable Information Required
Security - Handle ID: Object -> Handle ID *The same as the handle ID recorded in event 4663 that is output first.
Active Directory Event ID: 4656 (A handle to an object was requested)
- Domain Controller - Process Information -> Process Name: "C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe"
(Windows Server)
- Confirmable Information
- Targeted File: Object -> Object Name: ("GPPDataReport-[Domain Name]-[Time and Date].csv")
- Handle ID: Object -> Handle ID *Used for association with other logs.
- Process Details: Access Request Information -> Access ("READ_CONTROL", "SYNCHRONIZE", "WriteData (or AddFile)",
"AppendData (or AddSubdirectory or CreatePipeInstance)","WriteEA","ReadAttributes","WriteAttributes")
Event ID: 4663 (An attempt was made to access an object)
- Process Information -> Process Name: "C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe"
- Confirmable Information
- Targeted File: Object -> Object Name: ("GPPDataReport-[Domain Name]-[Time and Date].csv")
- Handle ID: Object -> Handle ID *Used for association with other logs.
- Process Details: Access Request Information -> Access ("WriteData (or AddFile)", "AppendData
(or AddSubdirectory or CreatePipeInstance)")
Event ID: 4658 (The handle to an object was closed)
- Process Information -> Process Name: "C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe"
- Confirmable Information
- Handle ID: Object -> Handle ID *The same as the handle ID recorded in event 4663 that is output first.
Event ID: 4689 (A process has exited)
- Process Information -> Process Name: "C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe"
- Confirmable Information
- Process End Time and Date: Log Date
- Process Return Value: Process Information -> Exit Status
Event ID: 1 (Process Create)
5 (Process Terminated)
- Image: "C:\Windows\System32\Windows PowerShell\v1.0\powershell.exe"
Event Log
- Required
- Confirmable Information
Sysmon
- Process Start/End Time and Date (UTC): UtcTime
- User Name: User
- Process ID: ProcessId
Remarks
Additional Event Logs That Can Be Output -
35
3.3.10. Mail PassView
Basic Information
Tool Name Mail PassView Legend
Category Password and Hash Dump - Acquirable