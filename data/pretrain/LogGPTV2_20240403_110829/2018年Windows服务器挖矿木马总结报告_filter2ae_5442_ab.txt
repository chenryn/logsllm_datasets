表1 2018年挖矿木马入侵Windows服务器所使用的漏洞
###  三、挖矿木马使用的攻击技术
**（一）横向移动**
横向移动指的是：木马在入侵计算机之后，以该计算机作为傀儡机，攻击局域网中的其他机器并控制这些机器。具有僵尸网络性质的挖矿木马家族常会利用Windows系统自身漏洞攻击局域网中的其他机器，并在其他机器中植入挖矿木马。在横向移动攻击武器的选择上，“永恒之蓝”漏洞攻击武器是大部分挖矿木马家族的首选，而横向渗透神器Mimikatz也被WannaMine等挖矿木马家族所使用。在这些家族的横向渗透中，Mimikatz只是作为“永恒之蓝”漏洞攻击武器的备选方案，可见攻击者更追求稳定性和使用上的简便，而不愿将上手难度高的Mimikatz放在首位。
图5 使用“永恒之蓝”漏洞攻击武器与使用Mimikatz的挖矿木马家族数量对比
**（二）Living off the land**
Living off the
land直译是“靠山吃山，靠水吃水”，在恶意攻击中指的是借助系统中已存在的应用程序或工具完成攻击。上文提到针对Windows服务器的挖矿木马大多数通过Web应用或系统的缺陷入侵计算机，而这些缺陷大多数只允许在远程计算机上执行任意命令而非任意代码，因此攻击者需要借助系统中已存在的应用程序或工具下载载荷，实现挖矿木马的植入。表2展示了被挖矿木马借力的合法应用程序。
应用程序名称
|
被挖矿木马滥用的功能  
---|---  
cmd.exe
|
执行载荷  
PowerShell.exe
|
下载载荷，执行载荷  
Regsvr32.exe
|
执行载荷  
Certutil.exe
|
下载载荷，解码载荷  
bitsadmin.exe
|
下载载荷，执行载荷，持续驻留  
wscript.exe
|
下载载荷，执行载荷  
cscript.exe
|
下载载荷，执行载荷  
mshta.exe
|
执行载荷  
wmic.exe
|
执行载荷  
表2 被挖矿木马借力的合法应用程序
图7则展示了针对Windows平台挖矿木马家族对这些合法应用程序的使用情况。Powershell这个功能强大的工具是攻击者最青睐的，而诸如Regsvr32.exe、mshta.exe这类能够执行存放在攻击者服务器的恶意代码的应用程序也被大量挖矿木马所使用。
图6 针对Windows平台挖矿木马家族滥用合法应用程序的情况
**（三）Fileless**
Fileless也叫“无文件攻击”技术，即攻击者在不释放文件的情况下实施攻击。攻击者一般通过在内存中加载恶意代码实现“无文件攻击”。Fileless本身是在Living
off the land的范畴中，由于针对Windows服务器的挖矿木马频繁使用该技术，故此在文章中将其提取出来另外讨论。
在针对Windows服务器的挖矿木马家族中，WannaMine是“无文件攻击”技术的集大成者。WannaMine利用漏洞入侵服务器后，会借助PowerShell应用程序在内存中完成挖矿木马运行、横向渗透、更新自身等多项工作。图8是WannaMine家族所使用的无文件攻击技术图解[2]。
图7 WannaMine家族所使用的无文件攻击技术图解
2018年11月，Mykings僵尸网络使用CVE-2015-7768攻击KONICA MINOLTA
FTP时也使用了“无文件”攻击技术。Mykings将加密后的载荷隐藏在PowerShell内存中，当扫描到存在漏洞的KONICA MINOLTA
FTP时就解密载荷并向其发送带有载荷的漏洞利用代码。
图8 Mykings家族攻击KONICA MINOLTA FTP时所使用的无文件攻击技术图解
“无文件攻击”技术的优势在于能够躲避杀毒软件的静态扫描，劣势在于现阶段过分依赖PowerShell强大的功能，一旦PowerShell被封锁，攻击者将很难找到替代品。
**（四）代码混淆技术**
代码混淆的目的是为了逃避杀毒软件的静态扫描，并增加样本分析人员的分析难度。对PE文件格式的木马加上诸如VMP这类的强壳已经是老生常谈了。2018年挖矿木马将混淆魔爪伸向了PowerShell脚本、JS脚本、hta文件等非PE文件，这些文件不一定会在受害机器上出现，更多的是在内存中执行，攻击者此举纯粹是为了给样本分析人员增加难度。
Invoke-DOSfuscation项目[3]最受挖矿木马青睐，图10和图11分别是WannaMine家族和Mykings家族使用Invoke-DOSfuscation对PowerShell代码进行混淆的例子。这类连编辑器都无法正常高亮的混淆代码给样本分析人员带来极大的挑战。
图9 WannaMine家族使用Invoke-DOSfuscation进行混淆的例子
图10 Mykings家族使用Invoke-DOSfuscation进行混淆的例子
###  四、挖矿木马收益分析及未来获利方式预测
2018年全球加密数字货币价格呈现走跌的趋势，大部分挖矿木马选择的币种——门罗币，在2018年缩水了超过九成。从最高时的1个门罗币兑3500元人民币降到现在的1个门罗币兑300元人民币。
图11 门罗币价格走势，红框中为2018年门罗币价格走势[4]
挖矿是一种几乎零成本的获利方式，因此门罗币价格的大幅缩水对挖矿木马攻击趋势的影响有限。表3展示了各个针对Windows服务器的成规模挖矿家族钱包地址和获利情况。可以看出，即使加密数字货币价格狂跌，一些大型挖矿家族仍然能够获得不错的收益。以WannaMine家族为例，若该家族以当前价格将持有的门罗币兑换成人民币，依然可以收益将近150万人民币，而实际收益必然大于150万人民币。
钱包地址
| 加密数字货币数量 |
家族  
---|---|---  
43Qof2iF1QV8NuGEDhxU3vBapovcxGVrYaNu35oMA58JXx1wx5nwEdZMe2DEsRVM1DV3vj5prS9moK8hAebH4ewgV7JDmDb
|
2879XMR
|
WannaMine  
44XYTPbEG7pg17grFsFdd3KdPaiJzNBNCZX1RqkvDuBmKwcLq1QVwhaCzrZctw15zrDPGFhQWVAWsi47g3p5dyNY21jUCj1
|
2015XMR  
4B9oDLDgeLnWnE9y2snHC3N2fX5CnBFMvQw1hgyZkhd8Vfg3nVAzJ2mVND9eryd5ZmauBredcbxtLMU35t346K6cPPQt7Bt
|
157XMR  
41mmoPVT1EFTaq3R4RpWEWiFJufAqJk8bAHBheSDVSGLgorjJHTNemdNg3kocA2Hj66Cve8B9fVEuYY6ztctk1bAETqsnNk
|
31XMR  
49kWWHdZd5NFHXveGPPAnX8irX7grcNLHN2anNKhBAinVFLd26n8gX2EisdakRV6h1HkXaa1YJ7iz3AHtJNK5MD93z6tV9H
|
53XMR  
4836J714oRpM9zdt7PZGmpChufqSEAFW8RgEMhu4tpGZKiFtogAiPY85GW9tWD9zKEi9XmB4Prw55M5fjjTgrhVhSDLLkFZ
|
12XMR  
44FaSvDWdKAB2R3n1XUZnjavNWwXEvyixVP8FhmccbNC6TGuCs4R937YWuoewbbSmMEsEJuYzqUwucVHhW73DwXo4ttSdNS
|
3XMR
|
Zombieboy  
41e2vPcVux9NNeTfWe8TLK2UWxCXJvNyCQtNb69YEexdNs711jEaDRXWbwaVe4vUMveKAzAiA4j8xgUi29TpKXpm3zKTUYo
|
545XMR
|
“8220”组织  
4AB31XZu3bKeUWtwGQ43ZadTKCfCzq3wra6yNbKdsucpRfgofJP3YwqDiTutrufk8D17D7xw1zPGyMspv8Lqwwg36V5chYg
|
203XMR  
46E9UkTFqALXNh2mSbA7WGDoa2i6h4WVgUgPVdT9ZdtweLRvAhWmbvuY1dhEmfjHbsavKXo3eGf5ZRb4qJzFXLVHGYH4moQ
|
11XMR  
48ojQAPbQCY5j75Hshe1mXKSAe3db6NVRAxsiMxS7rMNcEGE1mKGW1eETRamd1cKgRHCtqdTnEUu6NEKKSGXVugN9q2WVM8
|
43XMR
|
KoiMiner  
463tGbooc85VubSo9TjhjLegtVvBQD6qPVJ3LxDoNrtKexAqcyDkoqm9p32MrDoMWcSmWz41EKbxL3AKPJyCjCmcTPZ96XQ
|
16XMR  
47Uvt85TgZzHkveaTed69jhY4CSN8334BUufUtmaoLSNJadf2BoTtroHm5evYqQy4NJeyVBYYtGK8SHSAtFSiW6aDztDs9j
|
46XMR  
44873Xameckc4wR21AdrM5fnoFHKZJSVj6cBADTgFTrEEN94jP2XfQZ74PMRiqoYHnBu2cCe32wLx7gKHnQpfFqCLb6Ryn2
|
19XMR  
43BEKp4t8km3wEBasxmPMcV5n5XPPjRN4VcicaSwKZkTHxKzc4hTYwd3tyqR8SLZahfuSsTeJEG3fcEMnX3jA1F86iao1GU
|