TCP/IP Fundamentals for Microsoft Windows 
Microsoft Corporation 
Published: May 21, 2006 
Updated: Jan 9, 2012 
Author: Joseph Davies 
Editor: Anne Taussig 
Abstract 
This online book is a structured, introductory approach to the basic concepts and principles of the 
Transmission Control Protocol/Internet Protocol (TCP/IP) protocol suite, how the most important 
protocols function, and their basic configuration in the Microsoft® Windows Vista™, Windows 
Server® 2008, Windows® XP, and Windows Server 2003 families of operating systems. This 
book is primarily a discussion of concepts and principles to lay a conceptual foundation for the 
TCP/IP protocol suite and provides an integrated discussion of both Internet Protocol version 4 
(IPv4) and Internet Protocol version 6 (IPv6). 
The information contained in this document represents the current view of 
Microsoft Corporation on the issues discussed as of the date of 
publication.  Because Microsoft must respond to changing market 
conditions, it should not be interpreted to be a commitment on the part of 
Microsoft, and Microsoft cannot guarantee the accuracy of any 
information presented after the date of publication. 
This content is for informational purposes only.  MICROSOFT MAKES NO 
WARRANTIES, EXPRESS, IMPLIED OR STATUTORY, AS TO THE 
INFORMATION IN THIS DOCUMENT. 
Complying with all applicable copyright laws is the responsibility of the 
user. The terms of use of this document can be found at 
http://www.microsoft.com/info/cpyright.mspx. 
Microsoft may have patents, patent applications, trademarks, copyrights, 
or other intellectual property rights covering subject matter in this 
document.  Except as expressly provided in any written license 
agreement from Microsoft, the furnishing of this document does not give 
you any license to these patents, trademarks, copyrights, or other 
intellectual property. 
Unless otherwise noted, the example companies, organizations, products, 
domain names, e-mail addresses, logos, people, places, and events 
depicted herein are fictitious, and no association with any real company, 
organization, product, domain name, email address, logo, person, place, 
or event is intended or should be inferred. 
© 2008 Microsoft Corporation. All rights reserved. 
Microsoft, Active Directory, Windows, Windows NT 4.0, Windows Vista, 
and Windows Server are either registered trademarks or trademarks of 
Microsoft Corporation in the United States and/or other countries. 
All other trademarks are property of their respective owners. 
TCP/IP Fundamentals for Microsoft Windows  
Page: i 
Contents 
Chapter 1 – Introduction to TCP/IP ........................................................................................................ 1 
Chapter Objectives ................................................................................................................................ 2 
History of TCP/IP ................................................................................................................................... 3 
The Internet Standards Process ............................................................................................................ 5 
Requests for Comments (RFCs) ........................................................................................................ 5 
TCP/IP Terminology ............................................................................................................................... 7 
TCP/IP Components in Windows........................................................................................................... 9 
Configuring the IPv4-based TCP/IP Component in Windows ............................................................ 9 
Automatic Configuration ............................................................................................................... 10 
Manual Configuration .................................................................................................................... 11 
Installing and Configuring the IPv6-based TCP/IP Component in Windows ................................... 12 
Windows Vista and Windows Server 2008 ................................................................................... 12 
Windows XP and Windows Server 2003 ...................................................................................... 13 
Name Resolution Files in Windows .................................................................................................. 14 
TCP/IP Tools in Windows ................................................................................................................. 14 
The Ipconfig Tool .......................................................................................................................... 15 
The Ping Tool ............................................................................................................................... 16 
Network Monitor ............................................................................................................................... 17 
Chapter Summary ................................................................................................................................ 19 
Chapter Glossary ................................................................................................................................. 20 
Chapter 2 – Architectural Overview of the TCP/IP Protocol Suite .................................................... 23 
Chapter Objectives .............................................................................................................................. 24 
The TCP/IP Protocol Suite ................................................................................................................... 25 
Network Interface Layer ................................................................................................................... 25 
Internet Layer ................................................................................................................................... 26 
Transport Layer ................................................................................................................................ 26 
Application Layer .............................................................................................................................. 27 
IPv4 Internet Layer ............................................................................................................................... 28 
ARP .................................................................................................................................................. 28 
ARP Cache ................................................................................................................................... 28 
TCP/IP Fundamentals for Microsoft Windows  
Page: ii 
ARP Process ................................................................................................................................ 29 
Internet Protocol version 4 (IPv4) ..................................................................................................... 30 
Fragmentation and Reassembly ................................................................................................... 31 
Internet Control Message Protocol (ICMP) ...................................................................................... 31 
Internet Group Management Protocol (IGMP) ................................................................................. 32 
IPv6 Internet Layer ............................................................................................................................... 34 
IPv6 .................................................................................................................................................. 34 
IPv6 Extension Headers ............................................................................................................... 35 
Fragmentation in IPv6 ................................................................................................................... 35 
Internet Control Message Protocol for IPv6 (ICMPv6) ..................................................................... 36 
Neighbor Discovery (ND) ................................................................................................................. 37 
Address Resolution ....................................................................................................................... 38 
Router Discovery .......................................................................................................................... 39 
Address Autoconfiguration............................................................................................................ 39 
Multicast Listener Discovery (MLD) ................................................................................................. 39 
Transmission Control Protocol (TCP) .................................................................................................. 41 
TCP Ports ......................................................................................................................................... 41 
TCP Three-Way Handshake ............................................................................................................ 42 
User Datagram Protocol (UDP) ........................................................................................................... 43 
UDP Ports......................................................................................................................................... 43 
Packet Multiplexing and Demultiplexing .............................................................................................. 44 
Application Programming Interfaces .................................................................................................... 46 
Windows Sockets ............................................................................................................................. 46 
NetBIOS ........................................................................................................................................... 47 
TCP/IP Naming Schemes in Windows ................................................................................................ 48 
Host Names ...................................................................................................................................... 48 
NetBIOS Names ............................................................................................................................... 48 
Chapter Summary ................................................................................................................................ 50 
Chapter Glossary ................................................................................................................................. 51 
Chapter 3 – IP Addressing .................................................................................................................... 53 
Chapter Objectives .............................................................................................................................. 54 
IPv4 Addressing ................................................................................................................................... 55 
TCP/IP Fundamentals for Microsoft Windows  
Page: iii 
IPv4 Address Syntax ........................................................................................................................ 55 
Converting from Binary to Decimal ............................................................................................... 56 
Converting from Decimal to Binary ............................................................................................... 57 
IPv4 Address Prefixes ...................................................................................................................... 58 
Prefix Length Notation .................................................................................................................. 58 
Dotted Decimal Notation ............................................................................................................... 59 
Types of IPv4 Addresses ................................................................................................................. 59 
IPv4 Unicast Addresses ................................................................................................................... 60 
Internet Address Classes .............................................................................................................. 60 
Modern Internet Addresses .......................................................................................................... 62 
Public Addresses .......................................................................................................................... 63 
Illegal Addresses .......................................................................................................................... 63 
Private Addresses ......................................................................................................................... 63 
Automatic Private IP Addressing .................................................................................................. 64 
Special IPv4 Addresses ................................................................................................................ 65 
Unicast IPv4 Addressing Guidelines ............................................................................................ 65 
IPv4 Multicast Addresses ................................................................................................................. 66 
IPv4 Broadcast Addresses ............................................................................................................... 66 
IPv6 Addressing ................................................................................................................................... 68 
IPv6 Address Syntax ........................................................................................................................ 68 
Converting Between Binary and Hexadecimal ............................................................................. 69 
Compressing Zeros ...................................................................................................................... 70 
IPv6 Address Prefixes ...................................................................................................................... 70 
Types of IPv6 Addresses ................................................................................................................. 70 
IPv6 Unicast Addresses ................................................................................................................... 71 
Global Unicast Addresses ............................................................................................................ 71 
Link-Local Addresses ................................................................................................................... 73 
Site-Local Addresses .................................................................................................................... 73 
Zone IDs for Local-Use Addresses ............................................................................................... 74 
Unique Local Addresses ............................................................................................................... 74 
Special IPv6 Addresses ................................................................................................................ 75 
Transition Addresses .................................................................................................................... 75 
TCP/IP Fundamentals for Microsoft Windows  
Page: iv 
IPv6 Interface Identifiers ................................................................................................................... 76 
EUI-64 Address-based Interface Identifiers .................................................................................. 77 
IEEE 802 Address Conversion Example ...................................................................................... 79 
Temporary Address Interface Identifiers ...................................................................................... 79 
IPv6 Multicast Addresses ................................................................................................................. 80 
Solicited-Node Multicast Address ................................................................................................. 81 
IPv6 Anycast Addresses .................................................................................................................. 82 
IPv6 Addresses for a Host ................................................................................................................ 82 
IPv6 Addresses for a Router ............................................................................................................ 83 
Comparing IPv4 and IPv6 Addressing ................................................................................................. 84 
Chapter Summary ................................................................................................................................ 85 
Chapter Glossary ................................................................................................................................. 86 
Chapter 4 – Subnetting ......................................................................................................................... 89 
Chapter Objectives .............................................................................................................................. 90 
Subnetting for IPv4 .............................................................................................................................. 91 
Determining the Subnet Prefix of an IPv4 Address Configuration ................................................... 92 
Prefix Length Notation .................................................................................................................. 93 
Subnet Mask Notation .................................................................................................................. 94 
Defining a Prefix Length ................................................................................................................... 95 
Subnetting Within an Octet ............................................................................................................... 97 
Defining the Subnetted Address Prefixes ..................................................................................... 98 
Defining the Range of IPv4 Addresses for Each Subnet .............................................................. 99 
Subnetting Across an Octet Boundary ........................................................................................... 102 
Defining the Subnetted address prefixes .................................................................................... 102 
Defining the Range of IPv4 Addresses for Each Subnet ............................................................ 104 
Variable Length Subnetting ............................................................................................................ 105 
Variable Length Subnetting Example ......................................................................................... 106 
Variable Length Subnetting and Routing .................................................................................... 108 
Subnetting for IPv6 ............................................................................................................................ 109 
Subnetting a Global or Unique Local Address Prefix ..................................................................... 109 
Determining the Number of Subnetting Bits ............................................................................... 109 
Enumerating Subnetted Address Prefixes .................................................................................. 110 
TCP/IP Fundamentals for Microsoft Windows  
Page: v 
Variable Length Subnetting ............................................................................................................ 113 
Chapter Summary .............................................................................................................................. 114 
Chapter Glossary ............................................................................................................................... 115 
Chapter 5 – IP Routing ........................................................................................................................ 117 
Chapter Objectives ............................................................................................................................ 118 
IP Routing Overview .......................................................................................................................... 119 
Direct and Indirect Delivery ............................................................................................................ 119 
IP Routing Table ............................................................................................................................. 120 
Routing Table Entries ................................................................................................................. 120 
Static and Dynamic Routing ........................................................................................................... 121 
Dynamic Routing ........................................................................................................................ 122 
Routing Protocol Technologies ................................................................................................... 122 
IPv4 Routing ....................................................................................................................................... 124 
IPv4 Routing with Windows ............................................................................................................ 124 
Contents of the IPv4 Routing Table ............................................................................................ 124 
Route Determination Process ..................................................................................................... 125 
Determining the Next-Hop Address and Interface ...................................................................... 126 
Example Routing Table for an IPv4 Host Running Windows ..................................................... 127 
Static IPv4 Routing ......................................................................................................................... 129 
Configuring Static IPv4 Routers.................................................................................................. 130 
Dynamic IPv4 Routing .................................................................................................................... 130 
RIP .............................................................................................................................................. 131 
OSPF .......................................................................................................................................... 131 
BGP-4 ......................................................................................................................................... 131 
Integrating Static and Dynamic Routing ......................................................................................... 132 
IPv4 Route Aggregation and Summarization ................................................................................. 133 
Route Summarization for Internet Address Classes: Supernetting ............................................ 134 
IPv4 Routing Support in Windows .................................................................................................. 135 
Static Routing ............................................................................................................................. 135 
Dynamic Routing with RIP and OSPF ........................................................................................ 135 
Configuring Hosts for IPv4 Routing ................................................................................................ 135 
Default Gateway Setting ............................................................................................................. 136 
TCP/IP Fundamentals for Microsoft Windows  
Page: vi 
Default Route Metric ................................................................................................................... 137 
ICMP Router Discovery .............................................................................................................. 137 
Static Routes .............................................................................................................................. 138 
Persistent Static Routes ............................................................................................................. 138 
RIP Listener ................................................................................................................................ 138 
Routing for Disjoint Networks ......................................................................................................... 138 
Network Address Translation ......................................................................................................... 140 
How Network Address Translation Works .................................................................................. 141 
IPv6 Routing ....................................................................................................................................... 144 
IPv6 Routing Tables ....................................................................................................................... 144 
IPv6 Routing Table Entry Types ................................................................................................. 144 
Route Determination Process ..................................................................................................... 145 
Example Windows IPv6 Routing Table ...................................................................................... 145 
IPv6 Routing Protocols ................................................................................................................... 147 
RIPng for IPv6 ............................................................................................................................ 147 
OSPF for IPv6 ............................................................................................................................. 147 
Integrated IS-IS for IPv6 ............................................................................................................. 147 
BGP-4 ......................................................................................................................................... 148 
IPv6 Route Aggregation and Summarization ................................................................................. 148 
Windows Support for IPv6 Static Routing ...................................................................................... 149 
Configuring Hosts for IPv6 Routing ................................................................................................ 153 
Routing Tools ..................................................................................................................................... 154 
Chapter Summary .............................................................................................................................. 155 
Chapter Glossary ............................................................................................................................... 156 
Chapter 6 – Dynamic Host Configuration Protocol .......................................................................... 159 
Chapter Objectives ............................................................................................................................ 160 
DHCP Overview ................................................................................................................................. 161 
Benefits of Using DHCP ................................................................................................................. 162 
Configuring TCP/IP Manually ..................................................................................................... 162 
Configuring TCP/IP Using DHCP ............................................................................................... 162 
How DHCP Works.............................................................................................................................. 163 
DHCP Messages and Client States ............................................................................................... 163 
TCP/IP Fundamentals for Microsoft Windows  
Page: vii 
The Initializing State ................................................................................................................... 165 
The Selecting State .................................................................................................................... 166 
The Requesting State ................................................................................................................. 168 
The Bound State ......................................................................................................................... 169 
The Renewing State ................................................................................................................... 170 
The Rebinding State ................................................................................................................... 171 
Restarting a Windows DHCP Client ........................................................................................... 172 
The Windows DHCP Server Service ................................................................................................. 174 
Installing the DHCP Server Service ............................................................................................... 174 
DHCP and Active Directory Integration .......................................................................................... 175 
BOOTP Support ............................................................................................................................. 175 
DHCP Server Service Configuration .................................................................................................. 176 
Properties of the DHCP Server ...................................................................................................... 176 
DHCP Scopes ................................................................................................................................ 177 
Configuring a DHCP Scope ........................................................................................................ 177 
Deploying Multiple DHCP Servers .............................................................................................. 178 
Superscopes................................................................................................................................... 179 
Options ........................................................................................................................................... 179 
Client Reservations ........................................................................................................................ 181 
Fault Tolerance for Client Reservations ..................................................................................... 182 
DHCP Options Classes .................................................................................................................. 182 
Vendor Classes .......................................................................................................................... 183 
User Classes .............................................................................................................................. 183 
The DHCP Relay Agent ..................................................................................................................... 185 
Installing the DHCP Relay Agent ................................................................................................... 185 
Address Autoconfiguration for IPv6 ................................................................................................... 187 
Autoconfigured Address States ...................................................................................................... 187 
Types of Autoconfiguration ............................................................................................................. 188 
Autoconfiguration Process ............................................................................................................. 188 
DHCPv6 .......................................................................................................................................... 189 
DHCPv6 Messages and Message Exchanges ........................................................................... 190 
DHCPv6 Support in Windows ........................................................................................................ 192 
TCP/IP Fundamentals for Microsoft Windows  
Page: viii 
Configuring DHCPv6 Scopes and Options ................................................................................. 192 
Installing and Configuring the DHCPv6 Relay Agent ................................................................. 193 
Using the Ipconfig Tool ...................................................................................................................... 195 
Verifying the IP Configuration......................................................................................................... 195 
Renewing a Lease .......................................................................................................................... 195 
Releasing a Lease .......................................................................................................................... 196 
Setting and Displaying the Class ID ............................................................................................... 196 
Chapter Summary .............................................................................................................................. 197 
Chapter Glossary ............................................................................................................................... 198 
Chapter 7 – Host Name Resolution.................................................................................................... 201 
Chapter Objectives ............................................................................................................................ 202 