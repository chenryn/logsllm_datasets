# 针对CMS的网络攻击中的快照回滚研究（三）
##### 译文声明
本文是翻译文章，文章原作者 Ranjita Pai Kasturi, Yiting Sun, Ruian Duan, Omar Alrawi, Ehsan
Asdar, Victor Zhu,Yonghwi Kwon, Brendan Saltaformaggio，文章来源：computer.org
原文地址：
译文仅供参考，具体内容表达以及含义原文为准。
这项研究有机会研究了超过300,000个不同网站生产的每晚备份。在此过程中评估了基于CMS的网站的攻击情况，并评估了备份和还原保护方案的有效性。令人惊讶的是，发现成千上万次攻击的演变表现出清晰的长期多阶段攻击模式。TARDIS，一种来源推断技术，它可以仅基于网站托管公司已经收集的每晚备份来调查和补救针对CMS的攻击。
本文中将介绍TARDIS的在野部署和案例研究，以及相关工作和局限性。
## 0x01 Deploying TARDIS in the Wild
在确认TARDIS的分析能够准确捕获基于CMS的网站备份中的攻击标签后，与CodeGuard合作，将TARDIS部署在其数据集的很大一部分上。利用此访问权从306个830个唯一网站（从2014年3月到2019年5月）的每晚备份中，以经验方式衡量基于CMS的网站在现实世界中的运行状况。在本节中记录了使用TARDIS来了解基于CMS的网站所面临的威胁态势的发现。也正在与CodeGaurd合作，以将发现告知网站所有者，并补救发现的攻击。
实验设置：使用了具有8个虚拟CPU和64 GB RAM的Amazon Web
Services（AWS）弹性计算（EC2）r5.2xlarge实例。这些实例在AWS
Batch作业调度引擎的监督下在数百个网站备份上并行运行TARDIS。
使用了几种工具来协助调查：CMS分类建立在WhatCMS和CMS Garden的基础上。
TARDIS用Python（2500行代码）编写，并利用zxcvbn进行注入元素名称中的熵估计，并利用Pandas进行数据分析。
###  A. CMS布局
上表列出了306、830个网站中的入侵行为分布。第1列和第2列分别显示了CMS平台及其分布。第3列显示了被TARDIS标记为被破坏的网站的数目，即TARDIS输出多阶段攻击标签和被入侵窗口的网站。第4到第6列分别显示每个CMS的文件平均总数（“空间元素”），受感染网站中的平均文件数以及仅良性网站中的平均文件数。
提如第2列所示，大多数网站都使用WordPress作为其底层CMS。在此数据集中，看到96％的网站使用WordPress，高于实际趋势。这是由于WordPress用户在CodeGuard生产环境中的市场份额很高。从表的第2列可以看出，除了Contao之外，此数据集中的所有CMS都是多阶段攻击的受害者。总计发现20个，591个受到感染的网站。单独有19,260个WordPress网站感染了这些攻击（占WordPress网站总数的6.5％）。
有趣的是，超过16％的Joomla，13％的Drupal，18％的Prestashop和9％的Contenido网站是多阶段攻击的受害者。这表明这些攻击不仅针对CMS，而且也针对流行和较不流行的CMS。在此数据集中，约有5％的PivotX和TYPO
CMS3网站受到了长期存在的多阶段攻击的威胁，表明这些CMS由于其较小的市场份额可能不是受欢迎的攻击目标。
从表的第4列可以看出，几乎所有CMS平均都包含成千上万个文件。但是，一个有趣的指标是将受感染CMS中的文件平均数与良性CMS中的文件数进行比较。比较第5列和第6列时，很明显，攻击总是将大量文件注入CMS（在手动调查中也观察到了）。如表所示，几乎所有受感染的网站的文件数量增加了50％或更多。
TYPO3 CMS出现了文件数量最高的膨胀，受到危害时平均文件数量增加了150％。 WordPress位居第二，平均增长80％。
###  B.攻击的演变
下表列出了TARDIS认定为受感染的20个591个网站中攻击模型的分布。第1至第8行显示了TARDIS分配的所有攻击标签的这些输出。第2至8列显示每个CMS标记为TARDIS入侵的网站的数量。表第4行的读数可作如下解释：在数据集中总共295,774个WordPress网站上运行TARDIS后，它发现了13,317个具有代码生成功能的受感染网站。最后，表中的第9行列出了每个CMS进行折衷的总数，以进行比较。
从上表可以看出，代码生成功能是最常见的策略，在所有攻击中有70％以上都可见，而与底层CMS无关。从该表的第1行，看到在所有CMS中标识建立立足点标签并不普遍，这主要是由于数据集的性质。但是，当被识别时，它是确认多阶段攻击的可靠指标。还有在完成攻击动机后，所有此类攻击中有20％以上试图清除其痕迹。
但是，并非所有的多阶段攻击都会主动隐藏它们的存在。从表的第5行可以看出，超过60％的受感染WordPress网站试图通过遵循流行的隐藏文件/目录或伪装文件的方法来逃避防御。相反，流行的防御规避技术在属于其他CMS的受感染网站中并未广泛看到。这可能归因于网站所有者的技术性较弱，因为攻击者在攻击过程中没有将资源用于主动隐藏。
这些攻击中有很大一部分（8％）使用混淆技术，使网站所有者更难对注入的代码进行逆向工程。由于一旦检测到任何可疑活动的痕迹就无法立即将托管网站撤下，因此当事件响应可以理解混淆代码时，对手将已经在网站中完成了侦察（如图4所示），并实现了目标。进行了攻击清除。
###  C.入侵窗口
从该数据集中最重要的发现是基于CMS的网站遭受破坏的时间。一旦受到攻击，多阶段攻击就会在网站中长期存在。上图显示了每个受损CMS的TARDIS输出中的入侵窗口分布。请注意，这是简化的箱形图版本，以提高可读性。该图未显示：WordPress网站上超过20％的攻击持续300到1694天。如图所示，从WordPress的箱形图的中位数可以看出，WordPress网站中的大多数攻击持续了40天左右。
相比之下，在Joomla和PivotX中，攻击的中位时间较长，介于75到85天之间。在4000多个WordPress网站中，这些攻击持续3个月到4.5年之间的任何时间。属于此四分位数（前25％）的多阶段攻击对网站访问者构成了最大威胁：丢弃的文件只是在网站中潜伏着，其中许多目的是利用网站访问者。
在所有CMS中，Joomla的平均多阶段攻击持续时间最长，平均持续3个月。此外，对于使用更流行的CMS（例如WordPress，Joomla和Drupal）的网站，攻击者可能会持续更长的时间，因为对手看到了更大的机会基础，并从其资源投资中获得了更好的回报。相反，不那么受欢迎的CMS，TYPO3
CMS和Prestashop，不仅受到持久性攻击的攻击较少，而且这些攻击也不能持久存在。这可以归因于较高的机会成本和较低的针对针对较不受欢迎的CMS的攻击的回报。
###  D.现有的缓解攻击框架
回想一下，当前的行业标准是结合集成AV的幼稚“备份和还原”模型。
AV一旦检测到危害，就会提示网站所有者回滚到以前的快照。提取了306,830个网站的数据集的AV报告，并配置了TARDIS，以记录用户发起的回滚和回滚后重新感染的次数。结果列于下表。请注意，TARDIS不了解AV报告，仅依赖其攻击模型进行时间轴重建。表中显示，AV不能识别几乎所有受感染的网站，因此再次证实了本文的主张，即AV签名仅捕获知名的恶意软件，并且它们无法检测到隐匿的多阶段攻击。
第1列和第2列介绍了CMS平台以及每个CMS中受感染网站的数量。第3列显示了每个CMS触发AV警报的受感染网站的数量。第4列显示了具有AV警报的网站数量，这些网站尝试回滚到以前的版本，以缓解AV识别出的威胁。第5列列出了尝试回滚并保持感染或再次感染的网站的数量。正如预期的那样，AV警报和回滚的分布反映了CodeGuard产品集中CMS的市场份额，认为这是CMS的代表。