particular result since the ISPs in our data sets are peering,
and thus, not providing transit to each other.
We collected month-long traﬃc logs from the participating
ISPs. The collected logs have a time resolution of two hours
since it was the highest common factor for month-long data.
This is because both MRTG and RRDtool aggregate old
records into coarser records in order to bound the database
size.
In MRTG, 2-hour resolution records are maintained
for 31 days in order to draw monthly graphs. RRDtool does
not have ﬁxed aggregation intervals but it is most likely
that RRDtool is conﬁgured to maintain 1-hour or 2-hour
resolution records needed for monthly graphs. Although the
peak rate is often used for operational purposes, only the
mean rate is collected since the peak rate is not summable.
We developed a perl script to read a list of MRTG and
RRDtool log ﬁles, and to aggregate traﬃc measurements for
a given period at a given resolution. It outputs “timestamp,
in-rate, out-rate” for each time step. Another script pro-
duces a graph using RRDtool. We provided the tools to the
ISPs so that each ISP could create aggregated logs by them-
selves. This allows ISPs not to disclose the internal structure
of their network or unneeded details of their traﬃc.
The highest workload for the ISPs is to classify a large
number of per-interface traﬃc logs and create a log list for
each group. For large ISPs, the number of existing per-
interface traﬃc logs can exceed 100,000. To reduce the
workload, ISPs are allowed to use the internal interface of a
border router instead of a set of external (edge) interfaces
if the traﬃc on the internal interface is an approximation of
the sum of the external interfaces. In this case, we instruct
the tool to swap “in” and “out” records since the notation in
the per-interface logs depicts the perspective of the routers
but inbound/outbound records in our data sets signify the
ISPs’ point of view.
We analyzed month-long traﬃc logs from seven major
Japanese ISPs six times over 21 months; September, Oc-
tober, November in 2004, May and November in 2005, and
May in 2006. For data analysis, we focus on the data sets
in 2005 to compare them with the per-customer data even
though the latest set is from May 2006. We collected the
data separately for each month, and checked consistency
in each ISP’s share, diﬀerences from the previous measure-
ments, the coverage of the IX traﬃc, and others. We also
provide the aggregated results to the ISPs so that each ISP
can compare and check its own data against the aggregated
results. Thus, we are fairly conﬁdent about the accuracy
of the results. After the initial trials over four months (the
ﬁrst results from August 2004 had errors and have never
been published), we decided to collect data only twice a
year to reduce the workload of the participating ISPs.
Monthly traﬃc logs with two-hour resolution allow us to
identify major changes in each ISP’s traﬃc. When such
changes are found, we contact the ISP to conﬁrm the cause of
the change, e.g., a network reconﬁguration, an outage, miss-
ing SNMP data, or a mis-classiﬁcation of interface counter
logs. Afterwards, if necessary, we ask the ISP for corrected
data. We indeed found short periods of missing SNMP data
a few times but their impacts to the monthly average were
less than 1%. Once, we found a mis-classiﬁcation and asked
for corrected data.
2.2 Data Collection of Per-Customer Trafﬁc
In order to further analyze the behavior of residential traf-
ﬁc, we obtained Sampled NetFlow data from one of the par-
ticipating ISPs. This ISP has residential broadband cus-
tomers over DSL and ﬁber but not over CATV. Data was
collected from all edge routers accommodating residential
broadband customers. The sampling rate used was 1/2048
so as to not overload the routers. We believe it is enough
for analyzing heavy-hitters but there is a certain amount of
sampling error, especially for lightweight users. The traﬃc
volume is derived by multiplying the measured volume by
the sampling rate.
A week-long data set was collected ﬁve times: April, May,
October in 2004, February and July in 2005. In this paper,
we use only the two sets from February and July 2005 to
focus on traﬃc in 2005.
Data from February 2005 was used to analyze per-customer
behavior in Section 4.1 through 4.3 by matching customer
IDs with the assigned IP addresses. The ISP provided the
inbound/outbound traﬃc volume of each customer in one
hour resolution as well as customer’s attributes: the line
type (DSL or ﬁber), and the prefecture.
Data from July 2005 was used to analyze geographic com-
munication patterns from Section 4.4 through 4.5. In our
data, one end of a ﬂow is always the residential customer
of the ISP but the other end is generally a customer of an-
other ISP. Therefore, it is not possible to classify both ends
by the ISP’s information alone. For this reason, we used
two geo-IP databases, Cyber Area Research Inc’s SUTF-
POINT and Digital Envoy’s Netacuity, to classify both ends
of the ﬂows. The former database maps the address blocks
of domestic residential customers to prefectures, but it does
not cover non-residential addresses such as data-centers and
leased-lines. The advantage of using this database is that
we can distinguish residential users from other domestic
users. The addresses not covered by the former database
are classiﬁed simply into domestic and international by the
latter database. Thus, domestic corresponds mainly to data-
centers and leased lines in Japan, but it also includes residen-
tial address blocks not listed in the former geo-IP database.
3. ANALYSIS OF AGGREGATED TRAFFIC
The results were obtained by aggregating all traﬃc logs
provided by the seven ISPs. Each ISP provided month-
long traﬃc logs with 2-hour resolution. Both MRTG and
RRDtool compute 2-hour boundaries in UTC so that the
boundaries fall on odd hours in Japanese Standard Time
(UTC+9). Throughout the paper, inbound and outbound
are presented from the ISPs’ point of view.
Figure 4: Growth of customer traﬃc: (A1) RBB
customer and (A2) non-RBB customer
Figure 5: Growth of external traﬃc: (B1) 6 major
IXes, (B2) other domestic and (B3) international
3.1 Growth of Trafﬁc
The monthly average rates in bits/second of the traﬃc
groups are shown in Tables 1 through 4. Table 1 shows the
average rates of aggregated customer traﬃc, and the traﬃc
growth is shown in Figure 4. Between November 2004 and
November 2005, the growth rate of the RBB customer traﬃc
(A1) was 26% for inbound, 46% for outbound, and 37% for
the combined volume. The diﬀerence between inbound and
outbound slightly widened in the ﬁrst 6 months. The data
for non-RBB customer traﬃc was obtained only from the
four ISPs; it is diﬃcult for the other ISPs to distinguish ex-
ternal links from other links due to historical reasons. Since
(A2) from these other ISPs is missing, it is not possible to
directly compare (A1) with (A2). Thus, we estimated the
ratio of (A1) to (A) using only data from the 4 ISPs with
both (A1) and (A2). The estimated ratio (A1)/(A1+A2)
was 59% for inbound and 64% for outbound in November
2005.
Table 1: Monthly average rates of aggregated cus-
tomer traﬃc
(A1)customer-RBB
(A2)customer-non-RBB
(7 ISPs)
(4 ISPs)
inbound
outbound
inbound
outbound
2004
Sep
Oct
Nov
2005 May
Nov
2006 May
98.1G
108.3G
116.0G
134.5G
146.7G
173.0G
111.8G
124.9G
133.0G
178.3G
194.2G
226.2G
14.0G
15.0G
16.2G
23.7G
36.1G
42.9G
13.6G
14.9G
15.6G
23.9G
29.7G
38.3G
Table 2 summarizes the average rates of aggregated exter-
nal traﬃc, and the traﬃc growth is shown in Figure 5. It is
observed that the total volume of external domestic traﬃc
(B2), mainly private peering, exceeds the volume for the six
major IXes (B1). From this result, it would be misleading
to simply rely on data from IXes to estimate and under-
stand nation-wide traﬃc, because a considerable amount of
traﬃc is exchanged by private peering. At the same time, it
is possible that the ratio of private peering is overestimated
for the rest of the Japanese ISPs because private peering
is usually exercised only between large ISPs. The ratio of
international traﬃc to the total external traﬃc was 30% for
inbound and 26% for outbound in November 2005.
Table 3 shows a relationship between the total customer
traﬃc (A) and the total external traﬃc (B). If we assume
all inbound traﬃc from other ISPs is destined to customers,
Table 2: Monthly average rates of aggregated exter-
nal traﬃc
(B1)ext-6ix
(7 ISPs)
in
out
(B2)ext-dom
(7 ISPs)
in
out
(B3)ext-intl
(7 ISPs)
in
out
35.9G 30.9G 48.2G 37.8G 25.3G 14.1G
36.3G 31.8G 53.1G 41.6G 27.7G 15.4G
38.0G 33.0G 55.1G 43.3G 28.5G 16.7G
47.9G 41.6G 73.3G 58.4G 40.1G 24.1G
54.0G 48.1G 80.9G 68.1G 57.1G 39.8G
66.2G 60.1G 94.9G 77.6G 68.5G 47.8G
2004
Sep
Oct
Nov
2005 May
Nov
2006 May
the inbound traﬃc volume for the total external traﬃc (B)
should be close to the outbound traﬃc volume for the total
customer traﬃc (A). Similarly, the outbound traﬃc volume
(B) should be close to the inbound traﬃc volume (A). How-
ever, non-RBB customer data is provided by only 4 ISPs. If
we interpolate the missing ISPs in the non-RBB customer
traﬃc using the ratio from the four reporting ISPs, the total
inbound and outbound customer traﬃc for November 2005
is estimated to be 248.4Gbps and 304.4Gbps, respectively.
These ﬁgures are higher than those for the total external
traﬃc, and the diﬀerence is considered to be customer traf-
ﬁc whose source and destination belong to the same ISP.
Table 3: Monthly average rates of total customer
traﬃc and total external traﬃc
2004
Sep
Oct
Nov
2005 May
Nov
2006 May
(A)customer(A1+A2)
inbound
outbound
112.1G
123.3G
132.2G
158.2G
182.8G
215.9G
125.4G
139.8G
148.6G
202.2G
223.9G
264.5G
outbound
(B)external(B1+B2+B3)
inbound
109.4G
117.1G
121.6G
161.3G
192.0G
229.6G
82.8G
88.8G
93.0G
124.1G
156.0G
185.5G
Last, we examined the relationship between our IX traﬃc
data (B1) and the total input rate of the six major IXes,
as obtained directly from these IXes [29].
In comparison
with the published total incoming traﬃc of these IXes, our
data consistently represents about 42% of the total traﬃc
as shown in Table 4. If we assume this ratio to be the traf-
ﬁc share of the seven ISPs, the total amount of residential
broadband traﬃc in Japan in November 2005 can roughly be
estimated to be 353Gbps for inbound and 468Gbps for out-
bound. We are not aware of any data from other countries
against which to compare these numbers.
Table 4: IX traﬃc observed at ISPs and IXes
(B1)ext-6ix
outbound
2004
Sep
Oct
Nov
2005 May
Nov
2006 May
30.9G
31.8G
33.0G
41.6G
48.1G
60.1G
6 major IXes
ratio (%)
inbound
74.5G
77.1G
80.3G
99.1G
115.9G
139.2G
41.5
41.2
41.1
42.0
41.5
43.2
3.2 Customer Trafﬁc
Figure 6 shows weekly customer traﬃc. For weekly data
analysis, we took the averages of the same weekdays in a
month. We excluded holidays from the weekly analysis since
holiday traﬃc patterns are closer to those of weekends.
Figure 6: Aggregated weekly traﬃc of RBB cus-
tomers (top) and non-RBB customers (bottom) in
November 2005. Darker vertical lines indicate the
start of the day (0:00 am in local-time).