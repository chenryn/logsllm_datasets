​ [  
加密函数首先通过gen_key函数，生成三个密钥key,gen_key函数如下所示：  
​ [  
从代码可以看出，生成的三个密钥，对于每个文件来说都是随机生成的，然后对每个文件内容分成文件块加密，每个文件块的大小为4096字节，加密函数分别为crypt_all,crypt_10mb,crypt_1mb这三个函数，从代码分析，可以得出这三个函数使用的加密算法最后都是一样的，如下所示：  
​ [  
通过分析my_ecb_crypt函数，我们可以得知，使用的加密算法为三重DES加密算法，三个密钥都是之前随机生成的，如下所示：  
​ [  
加密完成之后，可以看到所有的文件都已经被加密了，如下所示：  
​ [  
从上面的分析可以得出，勒索软件使用了三重DES加密算法，且对应的每个文件都是按照4096大小的文件块进行加密，文件加密密钥都是随机生成的，因此根本无法解密文件，就算你按照它上面的要求给了BTC，这类勒索软件真是坑人，真够黑的，太不道德了，盗亦有盗呢？
### 四、总结
好了，样本分析完了，再说说自己对勒索类样本的一点个人看法和经验，最近几年勒索软件是越来越流行，各大安全公司也在积极应对，同时随着各种物联网设备的兴起，可能以后会越来越多有针对物联网相关的勒索软件，反正只有要利益的地方，就一定有黑产，前段时间就有报道一款TV设备受到了勒索软件的攻击，以及之前DEFCON上演示的一款智能温控系统被勒索软件攻击等，IoT设备正在成为勒索软件的攻击目标！从15年开始我就分析过几款勒索软件，16年成为了勒索软件的曝发期，大量的勒索样本不断出现，不断变种，之前这些软件主要的攻击对象是PC平台，以及后面随着移动互联网时代的兴起，安卓手机也成为了勒索类软件攻击的主要目标，记得当时分析完Android
FBI勒索样本之后，我又自己实现了一遍源代码，还蛮好玩的，这一两年各大安全公司都在花式炫耀自己捕获的各种平台下的勒索软件，如Maktub,Locker,Petya,Locky,NanoLocker,CryptoLocker,Ransomceber,PadCrypt,SkidLocker,KeyRanger,KillDisk,FsocietyLocker,Zepto,DMA
Locker,Chimera,PowerWare,Tesalcrypt,Linux.Encoder.1等以及它们的变种，其实这些勒索样本都还比较容易实现，技术手段也都不太高明，从PC平台端的勒索从简单的加解密文件，到后面发展到修改mbr，然后进行磁盘加密，再到后面以Android/Linux平台为主等等，在未来随着云以及IoT时代的到来，勒索类软件会更多的向各种不同的平台进行变种，迁移，同时可能会针对相应的数据库进行加密勒索，做为安全研究人员，必须时刻保持清醒，同这些恶意软件进行斗争，寻找更有效的安全解决方案。
下面给大家介绍几款开源的勒索软件，供大家参考研学习：   
从上面的开源代码可以看出，勒索类的软件已经运作在了各个平台，以及可以使用各种不同的语言进行编写:C/C++,Java,JavaScript,Python,Go,C#,VB.Net,PHP,Ruby等，随着各类勒索软件的开源，使得各类勒索软件变种越来越多，用户防不胜防，这种勒索软件本身的技术含量可能不高，但确实对用户伤害最大的，如果用户相应的重要文档没有及时备份，用户的损失还是比较大的，目前还没有用效的方法应对这种勒索软件，要应对这类软件，就需要我们具有良好的上网习惯，以及对重要文件进行定期备份处理，以防患于未然。
### 五、样本的发展趋势预测
​
KillDisk是由一个叫[TeleBots]的团队开发的，该团队也开发了同名的后门木马，并为2016年破坏乌克兰公司【电力系统，银行系统】的网络攻击负责。除此之外，乌克兰银行也被使用了包含该木马的恶意电子邮件攻击。
​ 可以得出KillDisk之前是[TeleBots]团队开发的专门针对乌克兰的网络攻击样本，在2017/01/05，ESET才捕抓到一个  
KillDisk的样本，具体的染感量未知，这款变种样本应该也是[TeleBots]团队开发的，由于样本刚刚出来就被ESET捕获到了，新本较新，暂未对影响量以及传播渠道进行批漏，可能未来这款样本，会被应用到专门攻击Linux服务器的用途上，目前外界感染这款样本的Linux服务器量未知，以后会不会呈现一个爆发的趋势也是未知的。
能过微步在线平台查找Hash值，上面显示样本发现时间为：2017/01/05,相关的IOC列表如下：
    26633a02c56ea0df49d35aa98f0fb538335f071c
         84a2959b0ab36e1f4e3abd61f378dc554684c9fc
         8f43bdf6c2f926c160a65cbcdd4c4738a3745c0c
         95fc35948e0ce9171dfb0e972add2b5d03dc6938
         92fe49f6a758492363215a58d62df701afb63f66
         b2e566c3ce8da3c6d9b4dc2811d5d08729dc2900
         2379a29b4c137afb7c0fd80a58020f5e09716437
         25074a17f5544b6f70ba3e66ab9b08adf2702d41
​ （由于ESET并未对样本的捕获来源以及样本的感染进行过多的详细说明，以上纯属个人想法，有不对的地方，请大牛多多指教，欢迎交流）
### 六、参考