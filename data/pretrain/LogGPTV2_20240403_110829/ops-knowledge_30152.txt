User: How to set the load balancing policy and health check mechanism of Nginx?
Assistant: As a high-performance web server and reverse proxy server, Nginx can be used for load balancing and high availability requirements. By setting Nginx's load balancing policy and health check mechanism, you can ensure that requests are evenly distributed to back-end servers and prevent faulty nodes from affecting services. The following are the steps to set up Nginx load balancing and health check: Load balancing strategy: 1. Download and install Nginx: You can download Nginx from the official website or use package management tools to install Nginx. 2. Modify the configuration file of Nginx: configure reverse proxy rules in nginx.conf, you can use round-robin (round-robin), ip-hash (based on client IP address hash value) and other round-robin strategies. - polling policy upstream backend { server backend1.example.com; server backend2.example.com; } server { location / { proxy_pass http://backend/; } } - ip-hash policy upstream backend { ip_hash; server backend1. example.com; server backend2.example.com; } server { location / { proxy_pass http://backend/; } } 3. Restart the Nginx server: After saving the configuration file, run the sudo systemctl restart nginx command to restart the Nginx server. Health check mechanism: 1. Add health check configuration in the Nginx configuration file, you can use HttpHealthCheckModule or Third-Party plug-ins, such as Nginx Plus, UpstreamCheckModule, etc. 2. Configure checking rules, including checking interval, fault threshold, and recovery threshold. upstream backend { server backend1.example.com; server backend2.example.com; #Check configuration check interval=3000 rise=2 fall=3 timeout=1000; #Fault judgment, use DNS domain name analysis to judge whether the request failed check_http_send "HEAD / HTTP/1.0\r\n\r\n"; check_http_expect_alive http_status 200..399; } 3. Restart the Nginx server: After saving the configuration file, restart the Nginx server through the sudo systemctl restart nginx command. After running for a period of time, you can view the results of the health check through log files or other monitoring tools. By setting the load balancing and health check mechanism of Nginx, the availability and stability of the application can be improved, and the efficient operation of the back-end server and data security can be ensured.