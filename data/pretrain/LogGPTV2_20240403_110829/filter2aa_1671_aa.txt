www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 1  – 8 August 2015 
Compliance, Protection & Business Confidence   
Sense of Security Pty Ltd 
Sydney 
Level 8, 66 King Street  
Sydney NSW 2000    
Australia 
Melbourne 
Level 10, 401 Docklands Drv 
Docklands VIC 3008 
Australia 
T: 1300 922 923 
T: +61 (0) 2 9290 4444 
F: +61 (0) 2 9290 4455 
PI:EMAIL 
www.senseofsecurity.com.au 
ABN: 14 098 237 908 
Sense of Security 
VoIP Security Testing Training 
Fatih Ozavci  
Christos Archimandritis 
8 August 2015 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 2  – 8 August 2015 
Agenda 
• Network Infrastructure  
• VoIP Server Security 
• Signalling Security  
• Media Transport Security 
• Cloud VoIP Solutions Security 
• VoIP Client Security 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 3  – 8 August 2015 
Introduction 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 4  – 8 August 2015 
Trainers’ Background 
• Fatih Ozavci, Principal Security Consultant 
• Interests 
• VoIP & *Phreaking 
• Mobile Applications 
• Network Infrastructure 
• Embedded Devices 
• Hardware and IoT Hacking 
• Author of Viproy VoIP Penetration Testing Kit 
• Public Speaker and Trainer 
• Blackhat, Defcon, HITB, AusCert, Troopers, Ruxcon 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 5  – 8 August 2015 
Trainers’ Background 
• Chris Archimandritis – Senior Security 
Consultant 
• Interests 
• VoIP and IMS Infrastructure 
• Mobile Applications 
• SAP Environment and Applications Security 
• Hardware Hacking 
• Network Infrastructure 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 6  – 8 August 2015 
The Art of VoIP Hacking Test Lab 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 7  – 8 August 2015 
The Art of VoIP Hacking Test Lab 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 8  – 8 August 2015 
Current Threats and Attacker Skills 
General assumptions: 
• The VoIP Networks are isolated 
• Hacking VoIP requires detailed knowledge 
• Attacks target only privacy and toll fraud 
• Pretending VoIP services are configured well 
Real life: 
• Broken physical security, weak network auth 
• After Viproy, no knowledge required anymore 
• How about client attacks, intelligence and APT 
• Default passwords, obsolete systems… 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 9  – 8 August 2015 
Pen-Test for UC, IMS and NGN 
• VoIP Infrastructure, design and protocol analysis 
• Authorisation and authentication analysis  
• Signalling security analysis for SIP and H.248 
• Advanced analysis of business functionality 
• Transport encryption analysis 
• Media streaming and MITM analysis 
• Analysis of essential and supportive services  
• Management services and protocol analysis 
• Hosted/cloud services analysis 
• Call centre analysis 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 10  – 8 August 2015 
Viproy VoIP Pen-Testing Toolkit 
• Viproy VoIP Penetration and Exploitation Kit 
• Testing modules for Metasploit Framework 
• SIP & Skinny libraries for the module development 
• SIP custom header and authentication support 
• Trust analyser, SIP proxy bounce, MITM proxy, Skinny 
• Modules 
• SIP Options, Register, Invite, Message 
• SIP Brute Forcer, Enumerator 
• SIP trust analyser, SIP proxy, Fake service 
• Cisco Skinny analysers 
• Cisco CUCM/CUCDM exploits 
• MSRP Support, Fuzzing for SIP and SDP  
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 11  – 8 August 2015 
How Viproy Helps Fuzzing Tests 
• Skeleton for Feature Fuzzing, NOT Only SIP Protocol 
• Multiple SIP Service Initiation 
• Call fuzzing in many states, response fuzzing 
• Integration With Other Metasploit Features 
• Fuzzers, encoding support, auxiliaires, etc. 
• Custom Header Support 
• Future compliance, vendor specific extensions, VAS 
• Raw Data Send Support (Useful with External Static Tools) 
• Authentication Support 
• Authentication fuzzing, custom fuzzing with authentication 
• Less Code, Custom Fuzzing, State Checks 
• Some Extra Features (Fuzz Library, SDP, MSRP) 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 12  – 8 August 2015 
Network Infrastructure 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 13  – 8 August 2015 
Corporate VoIP Infrastructure 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 14  – 8 August 2015 
Unified Communications Services 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 15  – 8 August 2015 
Hosted/Cloud VoIP Services 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 16  – 8 August 2015 
Plan & Goals 
Plan 
• Identifying the network design issues 
• Unauthorised access to the Voice LAN/WAN 
• Attacking network services 
• Persistent access 
Goals 
• Persistent unauthorised network access 
• Mass compromise of clients and services 
• Eavesdropping 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 17  – 8 August 2015 
A Recipe for Network Attacks 
• Discover VoIP network configuration, design 
and requirements 
• Find Voice VLAN and gain access 
• Gain access using PC port on IP Phone 
• Understanding the switching security for 
• Main vendor for VoIP infrastructure 
• Network authentication requirements 
• VLAN ID and requirements 
• IP Phone management services 
• Persistent access 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 18  – 8 August 2015 
Understanding the VoIP Service 
• Client Types  
• Soft phones (IP Communicator, Android/iOS Apps) 
• IP phones and handsets (Cisco 7945, Yealink) 
• Video conference equipment (Cisco Presence)  
• External meeting services (Webex, GoMeeting) 
• Service Purpose 
• International/National landline/Cell endpoints  
• Call centre (commercial vs Open Source) 
• Commercial VoIP services (mobile, hosted) 
• Internal usage (VLAN, conference rooms) 
• VoIP protocols (Skinny, SIP, RTP, IAX, H.323) 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 19  – 8 August 2015 
LAN and WAN Design for VoIP 
• Local Area Network 
• Voice VLAN usage (protected, authenticated) 
• Network segmentation (computers vs VoIP) 
• Supportive services (CDP, DHCP, TFTP, HTTP, 
SNMP) 
• Wide Area Network 
• Connection types (routers, VPNs, landline) 
• Bottlenecks vs QoS requirements 
• Service trusts and trunk usage 
• Primary Concerns for Commercial Services 
• Service contingency requirements 
• Denial of Service targets 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 20  – 8 August 2015 
Getting Physical Access to the LAN 
• Local distribution rooms and infrastructure 
• Network termination and endpoint facilities 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 21  – 8 August 2015 
Getting Physical Access to the LAN 
• Meeting room and lobby phones, conference 
devices, emergency phones 
• PC ports, Power Over Ethernet 
• Raspberry Pi 
• Permanent access with 4G 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 22  – 8 August 2015 
LAN Discovery for Voice VLAN 
• Attack Types 
• PC Ports of the IP phone and handsets 
• CDP sniffing/spoofing for Voice VLAN 
• DTP and VLAN Trunking Protocol attacks 
• ARP spoofing for MITM attacks 
• HSRP spoofing for MITM attacks 
• DHCP spoofing & snooping 
• Persistent access 
• Tapberry Pi (a.k.a berry-tap) 
• Tampered phone + PoE 
• 3G/4G for connectivity 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 23  – 8 August 2015 
Getting Access Using PC Port 
• IP Phones have a PC Port for desktop usage 
• CDP spoofing is not required 
• VLAN setting is not required 
• DTP spoofing is not required 
• Authentication of IP Phones 
• 802.1x - using Hub to bypass 
• EAP-MD5 dictionary attack 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 24  – 8 August 2015 
How to make your own Tapberry Pi 
RJ45 Connection Pins 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 25  – 8 August 2015 
How to make your own Tapberry Pi 
Speaker Power 
Patch the Cat5 cable 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 26  – 8 August 2015 
CDP Sniffing and Spoofing 
• Discovering Cisco devices 
• Learning Voice VLAN 
• Tools  
• Wireshark  
• VoIP Hopper  
• CDP-tools 
• Viproy CDP module 
• Sniffing to learn the network infrastructure 
• Sending a spoofed CDP packet as an IP Phone to 
get access to the Voice VLAN 
• Connect to the Voice VLAN (802.1x, EAP-MD5) 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 27  – 8 August 2015 
Cisco Discovery Protocol (CDP) 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 28  – 8 August 2015 
Dynamic Trunking Protocol (DTP) 
• Ports can be a trunk or not (dynamically) 
• Default state is DTP allowed for all ports 
• Port negotiation and encapsulation  
• 802.1Q/ISL 
• Enable trunking, double encapsulation 
• DTP master shares VLAN information with all 
downstream switches 
• Find the Voice VLAN and get access 
• Tools 
• Yersinia 
• Metasploit DTP Module 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 29  – 8 August 2015 
Dynamic Trunking Protocol (DTP) 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 30  – 8 August 2015 
Getting Access to the Voice VLAN 
• Adding the Voice VLAN  
• max 4094 VLANs for Cisco, can be brute-forced 
• Linux 
• vconfig add eth0 VLANID 
• dhclient eth0.VLANID 
• Mac OS X 
• Settings -> Network -> Manage Virtual 
Interfaces 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 31  – 8 August 2015 
ARP Scanning and Spoofing 
• ARP Scan 
• ARP Spoofing 
• MITM Attack 
• Hijacking 
• SSL 
• SSH keys 
• Rogue service 
• Tools 
• Cain & Abel 
• Ettercap 
• Dsniff 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 32  – 8 August 2015 
ARP Scanning and Spoofing 
• ARP Scanning  
• Find MAC and IPs to guess names of configuration 
files stored on TFTP/HTTP servers 
• SIP/Skinny authentication with MAC address 
• ARP Spoofing and being the … 
• TFTP server (configuration, updates, SSH keys) 
• DNS server 
• Web server (management, IP phone services) 
• SIP/Skinny server/Proxy 
• RTP proxy 
• MAC based filtering and authentication 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 33  – 8 August 2015 
DHCP Spoofing 
• DHCP Sniffing 
• Finding IP range 
• Finding TFTP/HTTP 
• Finding DNS 
• DHCP Spoofing 
• Suspend the DHCP server 
• DHCP consumption (request all IP addresses) 
• Become a Rogue DHCP Server 
• Send spoofed DHCP responses to the IP phones 
• Custom TFTP and DNS server 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 34  – 8 August 2015 
Attacking the TFTP Server 
• VoIP networks generally use TFTP servers for 
configuration, update, certificate, SSH keys 
management. (Web servers may be in use) 
• Obtaining configuration files for MAC addresses 
• SEPDefault.cnf, SEPXXXXXXXXXXXX.cnf.xml 
• SIPDefault.cnf, SIPXXXXXXXXXXXX.cnf.xml 
• Identifying SIP, Skinny, RTP and web settings 
• Finding IP phones software versions and updates 
• Configuration files may have username/passwords 
• Digital signature/encryption usage for files 
• Tools: TFTPTheft, Metasploit 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 35  – 8 August 2015 
Sample Configuration for Cisco 
SCCP 
USER 
PASSWORD 
1 
1 
0 
1 
1 
1234 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 36  – 8 August 2015 
Sample Configuration for Polycom 
reg.1.address="3047" 
reg.1.label="3047“ 
reg.1.auth.userId="7d5b905ecc1b1efa7077868
70276a940" 
reg.1.auth.password="d9429ad54c3ee623f6e2
0ae39de758ee“ 
divert.fwd.1.enabled="0" 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 37  – 8 August 2015 
Become the TFTP Server 
• Send fake IP addresses for … 
• HTTP server 
• IP phones management server 
• SIP server and proxy 
• Skinny server 
• RTP server and proxy 
• Deploy SSH public keys for SSH on IP Phones 
• Update custom settings of IP Phones 
• Null ring, custom alerts 
• Deploy custom OS update and code execution 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 38  – 8 August 2015 
SNMP Weaknesses 
• SNMP protocol 
• UDP protocol, IP spoofing, no encryption 
• Authentication 
• Community name (public, private, cisco) 
• SNMPv3 username/password attacks 
• SNMP Software 
• SNMP management software vulnerabilities 
• Buffer overflows, memory corruptions 
• Practical Attacks 
• Device configuration download and upload 
• Information gathering, code execution 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 39  – 8 August 2015 
Exercises  
• CDP Spoofing to get VLAN access 
• Cisco IP Phone configuration file 
enumeration through TFTP 
• Polycom IP Phone configuration file 
enumeration through HTTP 
• SNMP scanning and enumeration 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 40  – 8 August 2015 
Solutions 
• Secure network design 
• Secure network infrastructure 
• DHCP snooping protection 
• ARP Spoofing protection 
• 802.1x for Voice VLANs 
• Using secure network protocols 
• TFTP -> FTP+SSL or HTTPS 
• Telnet -> SSH 
• SNMP v1 v2c -> SNMP v3 with authentication 
• Using digital signature and encryption for 
software updates and configuration 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 41  – 8 August 2015 
VoIP Server Security 
www.senseofsecurity.com.au 
© Sense of Security 2015 
Page 42  – 8 August 2015 
VoIP Servers and Devices 
• Signalling servers and devices 
• Media gateways 
• SIP and RTP Proxies 