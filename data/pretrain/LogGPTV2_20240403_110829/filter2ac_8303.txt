### Title: Fire & Ice: Crafting and Bypassing macOS Firewalls

In the ongoing battle between malicious code and anti-malware tools, firewalls play a crucial role. Many malware threats have been thwarted thanks to the vigilant protection provided by these products. However, on macOS, firewalls are often poorly understood. Apple's documentation on its network filter interfaces, which are used to create kernel-mode firewalls, is limited, and all commercial macOS firewalls are closed-source. This talk aims to shed light on the inner workings of host-based macOS firewall products, revealing both how to create and bypass them.

First, we will delve into the key components required to build an effective firewall for macOS. We will cover core concepts such as kernel-level socket filtering, communication with user-mode components, secure installation of privileged code, and simple methods for implementing self-defense mechanisms. This includes protecting the user interface from synthetic events.

While firewalls are powerful tools, they are not invincible. We will examine various macOS malware specimens that actively attempt to detect and evade these firewalls. By donning our "gray" (or perhaps "black") hats, we will discuss security vulnerabilities and generic attacks that can compromise these products. Some of these attacks are well-known, while others remain undisclosed and can generically bypass even the most vigilant third-party Mac firewalls.

However, there is hope. By proactively discussing these attacks and leveraging our newfound understanding of firewall internals, we can improve the current state of firewall development. With a bit of luck, these advancements may thwart or at least complicate the efforts of future sophisticated Mac malware.