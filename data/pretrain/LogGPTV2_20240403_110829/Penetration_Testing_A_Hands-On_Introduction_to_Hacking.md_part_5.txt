12 Chapter 1
6. You will be presented with a screen like the one shown in Figure 1-5.
Figure 1-5: The Kali Linux GUI
Configuring the Network for Your Virtual Machine
Because we’ll be using Kali Linux to attack our target systems over a net-
work, we need to place all our virtual machines on the same virtual network
(we will see an example of moving between networks in Chapter 13, which
covers post exploitation). VMware offers three options for virtual network
connections: bridged, NAT, and host only. You should choose the bridged
option, but here’s a bit of information about each:
• The bridged network connects the virtual machine directly to the local
network using the same connection as the host system. As far as the
local network is concerned, our virtual machine is just another node
on the network with its own IP address.
• NAT, short for network address translation, sets up a private network on the
host machine. The private network translates outgoing traffic from the
virtual machine to the local network. On the local network, traffic from
the virtual machine will appear to come from the host machine’s IP
address.
• The host-only network limits the virtual machine to a local private net-
work on the host. The virtual machine will be able to communicate
with other virtual machines in the host-only network as well as the host
machine itself, but it will not be able to send or receive any traffic with
the local network or the Internet.
Setting Up Your Virtual Lab 13
note Because our target virtual machines will have multiple known security vulnerabili-
ties, use caution when attaching them to your local network because anyone else on
that network can also attack these machines. For this reason, I do not recommend work-
ing through this book on a public network where you do not trust the other users.
By default, the Kali Linux virtual machine network adapter is set to
NAT. Here’s how to change that option on both Windows and Mac OS.
VMware Player on Microsoft Windows
To change the virtual network on VMware Player for Windows, start VMware
Player and then click your Kali Linux virtual machine. Choose Edit virtual
machine settings, as shown in Figure 1-6. (If you’re still running Kali Linux
in VMware Player, choose Player4Manage4Virtual machine settings.)
Figure 1-6: Changing the VMware network adapter
On the next screen, choose Network Adapter in the Hardware tab and
choose the Bridged option in the Network connection section, as shown in
Figure 1-7.
14 Chapter 1
Figure 1-7: Changing the network adapter settings
Now click the Configure Adapters button and check the network
adapter that you’re using with your host operating system. As you can see
in Figure 1-8, I’ve selected only the Realtek wireless adapter. Once you’ve
made your selection, press OK.
Figure 1-8: Selecting a network adapter
Setting Up Your Virtual Lab 15
VMware Fusion on Mac OS
To change the virtual network connection in VMware Fusion, go to Virtual
Machine4Network Adapter and change from NAT to Bridged, as shown in
Figure 1-9.
Figure 1-9: Changing the network adapter
Connecting the Virtual Machine to the Network
Kali Linux should automatically pull an IP address from the Bridged network
once you make the switch. To verify your IP address, open a Linux terminal
by clicking the terminal icon(a black rectangle with the symbols >_) at the
top left of the Kali screen (or choose Applications4Accessories4Terminal).
Then run the command ifconfig to see your network information, as shown
in Listing 1-1.
root@kali:~# ifconfig
eth0 Link encap:Ethernet HWaddr 00:0c:29:df:7e:4d
inet addr:192.168.20.9 Bcast:192.168.20.255 Mask:255.255.255.0
inet6 addr: fe80::20c:29ff:fedf:7e4d/64 Scope:Link
--snip--
Listing 1-1: Networking information
note The prompt root@kali:~# is the superuser (root) prompt. We will learn more about
this and the other Linux commands we use for setup in Chapter 2.
16 Chapter 1
The IPv4 address for this virtual machine is 192.168.20.9, as highlighted
in bold in Listing 1-1. (The IP address for your machine will likely differ.)
Testing Your Internet access
Now let’s make sure that Kali Linux can connect to the Internet. We’ll use
the ping network utility to see if we can reach Google. Make sure your com-
puter is connected to the Internet, open a Linux terminal, and enter the
following.
root@kali:~# ping www.google.com
If you see something like the following in response, you’re online.
(We’ll learn more about the ping command in Chapter 3.)
PING www.google.com (50.0.2.221) 56(84) bytes of data.
64 bytes from cache.google.com (50.0.2.221): icmp_req=1 ttl=60 time=28.7 ms
64 bytes from cache.google.com (50.0.2.221): icmp_req=2 ttl=60 time=28.1 ms
64 bytes from cache.google.com (50.0.2.221): icmp_req=3 ttl=60 time=27.4 ms
64 bytes from cache.google.com (50.0.2.221): icmp_req=4 ttl=60 time=29.4 ms
64 bytes from cache.google.com (50.0.2.221): icmp_req=5 ttl=60 time=28.7 ms
64 bytes from cache.google.com (50.0.2.221): icmp_req=6 ttl=60 time=28.0 ms
--snip--
If you do not receive a response, make sure that you have set your net-
work adapter to Bridged, that Kali Linux has an IP address, and, of course,
that your host system currently has Internet access.
Installing Nessus
Although Kali Linux has just about every tool we’ll need, we do need to
install a few additional programs. First, we’ll install Tenable Security’s
Nessus Home vulnerability scanner. This scanner is free for home use only
(you’ll see a description of limitations on the Nessus website). Note that
Nessus is very actively developed, so the current version as well as its GUI
may have changed a bit since this book went to press.
Use the following steps to install Nessus Home from within Kali:
1. Open Applications4Internet4Iceweasel Web Browser and enter
http://www.tenable.com/products/nessus-home/ in the address bar. Complete
the Register for an Activation Code information and click Register.
(Use a real email address—you’ll need the activation code later.)
2. Once you reach the Downloads page, choose the latest version of Nessus
for the Linux Debian 32-bit platform (Nessus-5.2.5-debian6_i386.deb as of
this writing) and download it to your root directory (the default down-
load location).
3. Open a Linux terminal (click the terminal icon at the top of the Kali
screen) to open a root prompt.
Setting Up Your Virtual Lab 17
4. Enter ls to see a list of the files in your root directory. You should see
the Nessus file that you just downloaded.
5. Enter dpkg -i followed by the name of the file you downloaded (you can
type the first letter of the filename and press tab to use tab completion)
and press enter to begin the install process. Installation may take a while
as Nessus processes various plugins. Progress is shown by a line of hash
symbols (#).
Selecting previously unselected package nessus.
(Reading database ... 355024 files and directories currently installed.)
Unpacking nessus (from Nessus-5.2.5-debian6_amd64.deb) ...
Setting up nessus (5.2.5) ...
nessusd (Nessus) 5.2.5 [build N25109] for Linux
Copyright (C) 1998 - 2014 Tenable Network Security, Inc
Processing the Nessus plugins...
[########### ]
6. Once you’re returned to the root prompt with no errors, Nessus should
be installed, and you should see a message like this.
All plugins loaded
Fetching the newest plugins from nessus.org...
Fetching the newest updates from nessus.org...
Done. The Nessus server will start processing these plugins within a
minute
nessusd (Nessus) 5.2.5 [build N25109] for Linux
Copyright (C) 1998 - 2014 Tenable Network Security, Inc
Processing the Nessus plugins...
[##################################################]
All plugins loaded
- You can start nessusd by typing /etc/init.d/nessusd start
- Then go to https://kali:8834/ to configure your scanner
7. Now enter the following to start Nessus.
root@kali:~# /etc/init.d/nessusd start
8. Open the URL https://kali:8834/ in the Iceweasel web browser. You
should see a SSL certificate warning, similar to that in Figure 1-10.
note If you access Nessus from outside the Iceweasel browser in Kali, you will need to go to
https://:8834 instead.
18 Chapter 1
Figure 1-10: Invalid SSL certificate warning
9. Expand I Understand the Risks and click Add Exception. Then click
Confirm Security Exception, as shown in Figure 1-11.
Figure 1-11: Confirming the security exception
Setting Up Your Virtual Lab 19
10. Click Get Started at the bottom left of the opening Nessus page and
enter a username and password on the following page. I’ve chosen
georgia:password for my example. If you choose something else, remember
it because we’ll use Nessus in Chapter 6. (Note that I use poor passwords
throughout this book, as will many clients you encounter. In production,
you should use much better passwords than password.)
11. At the next page, enter the activation code you received via email from
Tenable Security.
12. Once registered with Tenable Security, choose the option to download
plugins (downloading will take some time). Once Nessus processes the
plugins, it will initialize.
When Nessus finishes downloading plugins and configuring the soft-
ware, you should see the Nessus login screen, as shown in Figure 1-12. You
should be able to use the credentials for the account you created during
setup to log in.
Figure 1-12: Login screen of the Nessus web interface
To close Nessus, just close its tab in the browser. We will come back to
Nessus in Chapter 6.
Installing Additional Software
We’re not done yet. Follow these instructions to complete your Kali Linux
install.
The Ming C Compiler
We need to install a cross compiler so we can compile C code to run on
Microsoft Windows systems. The Ming compiler is included in the Kali Linux
repositories but is not installed by default. Install it with this command.
root@kali:~# apt-get install mingw32
20 Chapter 1
Hyperion
We’ll use the Hyperion encryption program to bypass antivirus software.
Hyperion is not currently included in the Kali repositories. Download
Hyperion with wget, unzip it, and compile it with the Ming cross compiler
you installed in the previous step, as shown in Listing 1-2.
root@kali:~# wget http://nullsecurity.net/tools/binary/Hyperion-1.0.zip
root@kali:~# unzip Hyperion-1.0.zip
Archive: Hyperion-1.0.zip
creating: Hyperion-1.0/
creating: Hyperion-1.0/FasmAES-1.0/
root@kali:~# i586-mingw32msvc-c++ Hyperion-1.0/Src/Crypter/*.cpp -o hyperion.exe
--snip--
Listing 1-2: Installing Hyperion
Veil-Evasion
Veil-Evasion is a tool that generates payload executables you can use to bypass
common antivirus solutions. Install Veil-Evasion Kali (see Listing 1-3) by first
downloading it with the command wget. Next, unzip the downloaded file
master.zip and change to the Veil-master/setup directory. Finally, enter ./setup.sh
and follow the default prompts.
root@kali:~# wget https://github.com/ChrisTruncer/Veil/archive/master.zip
--2015-11-26 09:54:10-- https://github.com/ChrisTruncer/Veil/archive/master.zip
--snip--
2015-11-26 09:54:14 (880 KB/s) - `master.zip' saved [665425]
root@kali:~# unzip master.zip
Archive: master.zip
948984fa75899dc45a1939ffbf4fc0e2ede0c4c4
creating: Veil-Evasion-master/
--snip--
inflating: Veil-Evasion-master/tools/pyherion.py
root@kali:~# cd Veil-Evasion-master/setup
root@kali:~/Veil-Evasion-master/setup# ./setup.sh
=========================================================================
[Web]: https://www.veil-evasion.com | [Twitter]: @veilevasion
=========================================================================
[*] Initializing Apt Dependencies Installation
--snip—
Do you want to continue? [Y/n]? Y
--snip--
root@kali:~#
Listing 1-3: Installing Veil-Evasion
Setting Up Your Virtual Lab 21
Ettercap
Ettercap is a tool for performing man-in-the-middle attacks. Before run-
ning it for the first time, we need to make a couple of changes to its config-
uration file at /etc/ettercap/etter.conf. Open its configuration file from a Kali
root prompt in the nano editor.
root@kali:~# nano /etc/ettercap/etter.conf
First change the userid and groupid values to 0 so Ettercap can run with
root privileges. Scroll down to where you see the following lines in the file.
Replace whatever values you see following the equal signs (=) with a 0.
[privs]
ec_uid = 0 # nobody is the default
ec_gid = 0 # nobody is the default
Now scroll down to the Linux section of the file and uncomment
(remove the leading # characters) before the two lines shown at u and v
in Listing 1-4 to set Iptables firewall rules to redirect the traffic.
#---------------
# Linux
#---------------
# if you use ipchains:
#redir_command_on = "ipchains -A input -i %iface -p tcp -s 0/0 -d 0/0 %port -j REDIRECT
%rport"
#redir_command_off = "ipchains -D input -i %iface -p tcp -s 0/0 -d 0/0 %port -j REDIRECT
%rport"
# if you use iptables:
uredir_command_on = "iptables -t nat -A PREROUTING -i %iface -p tcp --dport %port -j
REDIRECT --to-port %rport"
vredir_command_off = "iptables -t nat -D PREROUTING -i %iface -p tcp --dport %port -j
REDIRECT --to-port %rport"
Listing 1-4: Ettercap configuration file
Save and exit the file by pressing ctrl-X and then Y to save the changes.
Setting Up Android Emulators
Now we’ll set up three Android emulators on Kali to use for mobile testing
in Chapter 20. First we’ll need to download the Android SDK.
1. Open the Iceweasel web browser from within Kali and visit https://
developer.android.com/sdk/index.html.
2. Download the current version of the ADT bundle for 32-bit Linux and
save it to your root directory.
22 Chapter 1
3. Open a terminal, list the files there (ls), and extract the compressed
archive that you just downloaded with unzip (the x’s represent the name
of your file, as versions may have changed since this was written).
root@kali:~# unzip adt-bundle-Linux-x86-xxxxxxxxxxx.zip
4. Now use cd to go into the new directory (with the same name as the file
without the .zip extension).
# cd sdk/tools
# ./android
5. The Android SDK Manager should open, as shown in Figure 1-13.
Figure 1-13: The Android SDK Manager
We’ll download any updates to the Android SDK tools and Android SDK
platform tools (checked by default), as well as Android 4.3 and a couple of
older versions of Android with specific vulnerabilities, Android 2.2 and
Android 2.1. Select the boxes to the left of each Android version. Then
(leaving Updates/New and Installed checked) click Install packages, as
shown in Figure 1-14. Accept the license agreement, and the Android SDK
should download and install the chosen packages. Installation will likely
take several minutes.
Setting Up Your Virtual Lab 23
Figure 1-14: Installing Android software
Now it’s time to set up our Android virtual devices. Open the Android
SDK Manager and choose Tools4Manage AVDs. You should see the win-
dow shown in Figure 1-15.