273. 247
274. 248
275. 249
276. 250
277. 251
278. 252
279. 253
280. 254
281. 255
282. 256
283. 257
284. 258
285. 259
286. 260
287. 261
288. 262
289. 263
290. 264
291. 265
292. 266
293. 267
294. 268
295. 269
296. 270
297. 271
298. 272
299. 273
300. 274
301. 275
302. 276
303. 277
304. 278
305. 279
306. 280
307. 281
308. 282
309. 283
310. 284
311. 285
312. 286
313. 287
314. 288
315. 289
316. 290
317. 291
318. 292
319. 293
320. 294
321. 295
322. 296
323. 297
324. 298
325. 299
326. 300
327. 301
328. 302
329. 303
330. 304
331. 305
332. 306
333. 307
334. 308
335. 309
336. 310
337. 311
338. 312
339. 313
340. 314
341. 315
342. 316
343. 317
344. 318
345. 319
346. 320
347. 321
348. 322
349. 323
350. 324
351. 325
352. 326
353. 327
354. 328
355. 329
356. 330
357. 331
358. 332
359. 333
360. 334
361. 335
362. 336
363. 337
364. 338
365. 339
366. 340
367. 341
368. 342
BLACKHATGO
GoProgrammingforHackersand
Pentesters
byTomSteele,ChrisPatten,andDanKottmann
SanFrancisco
BLACKHATGO.Copyright©2020byTomSteele,ChrisPatten,andDan
Kottmann.
Allrightsreserved.Nopartofthisworkmaybereproducedortransmittedinany
formorbyanymeans,electronicormechanical,includingphotocopying,
recording,orbyanyinformationstorageorretrievalsystem,withouttheprior
writtenpermissionofthecopyrightownerandthepublisher.
ISBN-10:1-59327-865-9
ISBN-13:978-1-59327-865-6
Publisher:WilliamPollock
ProductionEditor:LaurelChun
CoverIllustration:JonnyThomas
InteriorDesign:OctopodStudios
DevelopmentalEditors:FrancesSauxandZachLebowski
TechnicalReviewer:AlexHarvey
Copyeditor:SharonWilkey
Compositor:DanielleFoster
Proofreader:BrookeLittrel
Indexer:BethNauman-Montana
Forinformationondistribution,translations,orbulksales,pleasecontactNoStarch
Press,Inc.directly:
NoStarchPress,Inc.
2458thStreet,SanFrancisco,CA94103
phone:1.415.863.9900;PI:EMAIL
www.nostarch.com
LibraryofCongressCataloging-in-PublicationData
Names:Steele,Tom(SecurityConsultant),author.|Patten,Chris,author.
|Kottmann,Dan,author.
Title:BlackHatGo:Goprogrammingforhackersandpentesters/Tom
Steele,ChrisPatten,andDanKottmann.
Description:SanFrancisco:NoStarchPress,2020.|Includes
bibliographicalreferencesandindex.|Summary:"AguidetoGothat
beginsbyintroducingfundamentalslikedatatypes,controlstructures,
anderrorhandling.ProvidesinstructiononhowtouseGofortaskssuch
assniffingandprocessingpackets,creatingHTTPclients,andwriting
exploits."--Providedbypublisher.
Identifiers:LCCN2019041864(print)|LCCN2019041865(ebook)|ISBN
9781593278656|ISBN9781593278663(ebook)
Subjects:LCSH:Penetrationtesting(Computersecurity)|Go(Computer
programlanguage)
Classification:LCCQA76.9.A25S7392020(print)|LCCQA76.9.A25(ebook)
|DDC005.8--dc23
LCrecordavailableathttps://lccn.loc.gov/2019041864
LCebookrecordavailableathttps://lccn.loc.gov/2019041865
NoStarchPressandtheNoStarchPresslogoareregisteredtrademarksofNo
StarchPress,Inc.Otherproductandcompanynamesmentionedhereinmaybethe
trademarksoftheirrespectiveowners.Ratherthanuseatrademarksymbolwith
everyoccurrenceofatrademarkedname,weareusingthenamesonlyinan
editorialfashionandtothebenefitofthetrademarkowner,withnointentionof
infringementofthetrademark.
Theinformationinthisbookisdistributedonan“AsIs”basis,withoutwarranty.
Whileeveryprecautionhasbeentakeninthepreparationofthiswork,neitherthe
authorsnorNoStarchPress,Inc.shallhaveanyliabilitytoanypersonorentity
withrespecttoanylossordamagecausedorallegedtobecauseddirectlyor
indirectlybytheinformationcontainedinit.
ABOUTTHEAUTHORS
TomSteelehasbeenusingGosincetheversion1releasein
2012andwasoneofthefirstinhisfieldtoleveragethe
languageforoffensivetooling.Heisamanagingprincipal
researchconsultantatAtredisPartnerswithover10yearsof
experienceperformingadversarialandresearch-basedsecurity
assessments.Tomhaspresentedandconductedtraining
coursesatnumerousconferences,includingDefcon,Black
Hat,DerbyCon,andBSides.Outsideoftech,Tomisalsoa
BlackBeltinBrazilianjiujitsuwhocompetesregularly,both
regionallyandnationally.Heownsandoperateshisown
jiujitsuacademyinIdaho.
ChrisPattenisthefoundingpartnerandleadconsultantof
STACKTITAN,aspecializedadversarialservicessecurity
consultancy.Chrishasbeenpracticinginthesecurityindustry
formorethan25yearsinvariouscapacities.Hespentthelast
decadeconsultingforanumberofcommercialand
governmentorganizationsondiversesecurityissues,including
adversarialoffensivetechniques,threathuntingcapabilities,
andmitigationstrategies.Chrisspenthislatesttenureleading
oneofNorthAmerica’slargestadvancedadversarialteams.
Priortoformalconsulting,Chrishonorablyservedinthe
USAirForce,supportingthewar-fightingeffort.Heactively
servedwithintheDepartmentofDefenseSpecialOperations
IntelligencecommunityatUSSOCOM,consultingforSpecial
OperationsGroupsonsensitivecyberwarfareinitiatives.
FollowingChris’smilitaryservice,heheldleadarchitect
positionsatnumerousFortune500telecommunication
companies,workingwithpartnersinaresearchcapacity.
DanKottmannisafoundingpartnerandleadconsultantof
STACKTITAN.Hehasplayedanintegralroleinthegrowth
anddevelopmentofthelargestNorthAmericanadversarial
consultancy,directlyinfluencingtechnicaltradecraft,process
efficiency,customerexperience,anddeliveryquality.With15
yearsofexperience,Danhasdedicatednearlytheentiretyof
hisprofessionalcareertocross-industry,customer-direct
consultingandconsultancydevelopment,primarilyfocusedon
informationsecurityandapplicationdelivery.
Danhaspresentedatvariousnationalandregionalsecurity
conferences,includingDefcon,BlackHatArsenal,DerbyCon,
BSides,andmore.Hehasapassionforsoftwaredevelopment
andhascreatedvariousopen-sourceandproprietary
applications,fromsimplecommandlinetoolstocomplex,
three-tier,andcloud-basedwebapplications.
ABOUTTHETECHNICALREVIEWER
AlexHarveyhasbeenworkingwithtechnologyhiswholelife
andgothisstartwithembeddedsystems,robotics,and
programming.Hemovedintoinformationsecurityabout15
yearsago,focusingonsecuritytestingandresearch.Neverone
toshyawayfrommakingatoolforthejob,hestartedusing
theGoprogramminglanguageandhasnotlookedback.
BRIEFCONTENTS
ForewordbyHDMoore
Acknowledgments
Introduction
Chapter1:GoFundamentals
Chapter2:TCP,Scanners,andProxies
Chapter3:HTTPClientsandRemoteInteractionwithTools
Chapter4:HTTPServers,Routing,andMiddleware
Chapter5:ExploitingDNS
Chapter6:InteractingwithSMBandNTLM
Chapter7:AbusingDatabasesandFilesystems
Chapter8:RawPacketProcessing
Chapter9:WritingandPortingExploitCode
Chapter10:GoPluginsandExtendableTools
Chapter11:ImplementingandAttackingCryptography
Chapter12:WindowsSystemInteractionandAnalysis
Chapter13:HidingDatawithSteganography
Chapter14:BuildingaCommand-and-ControlRAT
Index
CONTENTSINDETAIL
FOREWORDbyHDMoore
ACKNOWLEDGMENTS
INTRODUCTION
WhoThisBookIsFor
WhatThisBookIsn’t
WhyUseGoforHacking?
WhyYouMightNotLoveGo
ChapterOverview
1
GOFUNDAMENTALS
SettingUpaDevelopmentEnvironment
DownloadingandInstallingGo
SettingGOROOTtoDefinetheGoBinaryLocation
SettingGOPATHtoDeterminetheLocationofYourGoWorkspace
ChoosinganIntegratedDevelopmentEnvironment
UsingCommonGoToolCommands
UnderstandingGoSyntax
DataTypes
ControlStructures
Concurrency
ErrorHandling
HandlingStructuredData
Summary
2
TCP,SCANNERS,ANDPROXIES
UnderstandingtheTCPHandshake
BypassingFirewallswithPortForwarding
WritingaTCPScanner
TestingforPortAvailability
PerformingNonconcurrentScanning
PerformingConcurrentScanning
BuildingaTCPProxy
Usingio.Readerandio.Writer
CreatingtheEchoServer
ImprovingtheCodebyCreatingaBufferedListener
ProxyingaTCPClient
ReplicatingNetcatforCommandExecution
Summary
3
HTTPCLIENTSANDREMOTEINTERACTIONWITH
TOOLS
HTTPFundamentalswithGo
CallingHTTPAPIs
GeneratingaRequest
UsingStructuredResponseParsing
BuildinganHTTPClientThatInteractswithShodan
ReviewingtheStepsforBuildinganAPIClient
DesigningtheProjectStructure
CleaningUpAPICalls
QueryingYourShodanSubscription
CreatingaClient
InteractingwithMetasploit
SettingUpYourEnvironment
DefiningYourObjective
RetrievingaValidToken
DefiningRequestandResponseMethods
CreatingaConfigurationStructandanRPCMethod
PerformingRemoteCalls
CreatingaUtilityProgram
ParsingDocumentMetadatawithBingScraping
SettingUptheEnvironmentandPlanning
DefiningthemetadataPackage
MappingtheDatatoStructs
SearchingandReceivingFileswithBing
Summary
4
HTTPSERVERS,ROUTING,ANDMIDDLEWARE
HTTPServerBasics
BuildingaSimpleServer
BuildingaSimpleRouter
BuildingSimpleMiddleware
Routingwiththegorilla/muxPackage
BuildingMiddlewarewithNegroni
AddingAuthenticationwithNegroni
UsingTemplatestoProduceHTMLResponses
CredentialHarvesting
KeyloggingwiththeWebSocketAPI
MultiplexingCommand-and-Control
Summary
5
EXPLOITINGDNS
WritingDNSClients
RetrievingARecords
ProcessingAnswersfromaMsgstruct
EnumeratingSubdomains
WritingDNSServers
LabSetupandServerIntroduction
CreatingDNSServerandProxy
Summary
6
INTERACTINGWITHSMBANDNTLM
TheSMBPackage
UnderstandingSMB
UnderstandingSMBSecurityTokens
SettingUpanSMBSession
UsingMixedEncodingofStructFields
UnderstandingMetadataandReferentialFields
UnderstandingtheSMBImplementation
GuessingPasswordswithSMB
ReusingPasswordswiththePass-the-HashTechnique
RecoveringNTLMPasswords
CalculatingtheHash
RecoveringtheNTLMHash
Summary
7
ABUSINGDATABASESANDFILESYSTEMS
SettingUpDatabaseswithDocker
InstallingandSeedingMongoDB
InstallingandSeedingPostgreSQLandMySQLDatabases
InstallingandSeedingMicrosoftSQLServerDatabases
ConnectingandQueryingDatabasesinGo
QueryingMongoDB
QueryingSQLDatabases
BuildingaDatabaseMiner
ImplementingaMongoDBDatabaseMiner
ImplementingaMySQLDatabaseMiner
PillagingaFilesystem
Summary
8
RAWPACKETPROCESSING
SettingUpYourEnvironment
IdentifyingDevicesbyUsingthepcapSubpackage
LiveCapturingandFilteringResults
SniffingandDisplayingCleartextUserCredentials
PortScanningThroughSYN-floodProtections
CheckingTCPFlags
BuildingtheBPFFilter
WritingthePortScanner
Summary
9
WRITINGANDPORTINGEXPLOITCODE
CreatingaFuzzer
BufferOverflowFuzzing
SQLInjectionFuzzing
PortingExploitstoGo
PortinganExploitfromPython
PortinganExploitfromC
CreatingShellcodeinGo
CTransform
HexTransform
NumTransform
RawTransform
Base64Encoding
ANoteonAssembly
Summary
10
GOPLUGINSANDEXTENDABLETOOLS
UsingGo’sNativePlug-inSystem