\
\
\
\
\ \# 网卡eth1 \--\> prvate1
\
\
## 配置虚拟机2:nova01 XML 配置
\[root@room9pc01 qemu\]# virsh edit nova01
\
\nova01\
\b0194653-7e32-43ba-9111-065a44719d6f\
\4880000\ #保证总共4.5G内存以上
\4880000\ #当前分配内存
\...
\
\
\
\
\
\
\
\ \# 网卡eth1 \--\> prvate1
\
\
## 扩展磁盘(按需)
\[root@localhost \~\]# /usr/bin/growpart /dev/vda 1
\[root@localhost \~\]# /usr/sbin/xfs_growfs /
## 启动虚拟机
\[root@room9pc01 images\]# virsh start nodestack
域 nodestack 已开始
\[root@room9pc01 images\]# virsh start nova01
域 nova01 已开始
## 配置网卡
**虚拟机1: openstack**
11 vim /etc/sysconfig/network-scripts/ifcfg-eth0
DEVICE=\"eth0\"
ONBOOT=\"yes\"
TYPE=\"Ethernet\"
BOOTPROTO=\"static\"
IPADDR=\"192.168.1.10\"
NETMASK=\"255.255.255.0\"
GATEWAY=\"192.168.1.254\"
\[ 836.776620\] IPv6: ADDRCONF(NETDEV_UP): lo: link is not ready
13 cd /etc/sysconfig/network-scripts/
14 cp ifcfg-eth0 ifcfg-eth1
15 vim ifcfg-eth1
DEVICE=\"eth1\"
ONBOOT=\"yes\"
TYPE=\"Ethernet\"
BOOTPROTO=\"static\"
IPADDR=\"192.168.4.10\"
NETMASK=\"255.255.255.0\"
\[root@localhost \~\]# systemctl restart network
**虚拟机2:nova01**
\# Generated by dracut initrd
DEVICE=\"eth0\"
ONBOOT=\"yes\"
TYPE=\"Ethernet\"
BOOTPROTO=\"static\"
IPADDR=\"192.168.1.11\"
NETMASK=\"255.255.255.0\"
GETEWAY=\"192.168.1.254\"
\# Generated by dracut initrd
DEVICE=\"eth1\"
ONBOOT=\"yes\"
TYPE=\"Ethernet\"
BOOTPROTO=\"static\"
IPADDR=\"192.168.4.11\"
NETMASK=\"255.255.255.0\"
\[root@localhost \~\]# systemctl restart network
配置主机名
配置/etc/hosts
配置/etc/resolv.conf
## 配置yum 按实际
将三个光盘镜像挂在真机上:
mount -t iso9660 -o ro,loop \'目录/CentOS7-1708.iso\' /var/ftp/Centos
mount -t iso9660 -o ro,loop \'目录/RHEL7OSP-10.iso\' /var/ftp/RHEL7OSP
mount -t iso9660 -o ro,loop \'目录/RHEL7-extras.iso\' /var/ftp/RHEL7
虚拟机将用ftp方式访问光盘内容,配置yum源
配置yum源最终结果三个光盘配置的yum 源总数是10731个安装包
其中baseurl= 指定的路径必须是含有repodata/目录的目录下
RHEL7OSP-10.iso光盘的挂载要分别挂载10个
\[centos\]
name=centos
baseurl=ftp://192.168.1.254/Centos/
enabled=1
gpgcheck=0
\[RHEL7\]
name=RHEL7
baseurl=ftp://192.168.1.254/RHEL7/
enabled=1
gpgcheck=0
\[RHEL7OSP1\]
name=RHEL7OSP1
baseurl=ftp://192.168.1.254/RHEL7OSP/rhel-7-server-openstack-10-devtools-rpms/
enabled=1
gpgcheck=0
\[RHEL7OSP2\]
name=RHEL7OSP2
baseurl=ftp://192.168.1.254/RHEL7OSP/rhel-7-server-openstack-10-optools-rpms/
enabled=1
gpgcheck=0
\.....还有很多\....此处省略
repolist: 10,731
## 配置时间服务器:
真机做为服务器,同时同步阿里的时间服务器
\[root@room9pc01 \~\]# vim /etc/chrony.conf
server ntp1.aliyun.com iburst
allow 0/0
\[root@room9pc01 \~\]# systemctl restart chronyd
openstack 主机与Nova01主机相同操作
\[root@nava01 \~\]# vim /etc/chrony.conf
server 192.168.1.254 iburst
\[root@nava01 \~\]# chronyc sources -v #验证是否成功
210 Number of sources = 1
.\-- Source mode \'\^\' = server, \'=\' = peer, \'#\' = local clock.
/ .- Source state \'\*\' = current synced, \'+\' = combined , \'-\' =
not combined,
\| / \'?\' = unreachable, \'x\' = time may be in error, \'\~\' = time
too variable.
\|\| .- xxxx \[ yyyy \] +/- zzzz
\|\| Reachability register (octal) -. \| xxxx = adjusted offset,
\|\| Log2(Polling interval) \--. \| \| yyyy = measured offset,
\|\| \\ \| \| zzzz = estimated error.
\|\| \| \| \\
MS Name/IP address Stratum Poll Reach LastRx Last sample
===============================================================================
\^\* 192.168.1.254 3 6 17 10 +14us\[ -18us\] +/- 20ms
有\^\* 与 3 6 17 10 有数字即可
## 安装依赖软件包
**openstack 主机与Nova01主机相同操作**
\[root@openstack \~\]# yum -y install qemu-kvm libvirt-daemon
libvirt-client libvirt-daemon-driver-qemu python-setuptools
已安装:
libvirt-client.x86_64 0:3.2.0-14.el7 libvirt-daemon.x86_64
0:3.2.0-14.el7 python-setuptools.noarch 0:0.9.8-7.el7
qemu-kvm-rhev.x86_64 10:2.6.0-28.el7_3.6 #共5个成功安装,94个安装包
作为依赖被安装:
alsa-lib.x86_64 0:1.1.3-3.el7 autogen-libopts.x86_64 0:5.18-5.el7
avahi-libs.x86_64 0:0.6.31-17.el7 \...\....
\...\....
# 安装packstack
Packstack主要是由Redhat推出的用于概念验证（PoC）环境快速部署的工具。Packstack是一个命令行工具，它使用Python封装了Puppet模块，通过SSH在服务器上部署OpenStack。
Packstack支持三种运行模式：
-   快速运行
-   交互式运行
-   非交互式运行
Packstack支持两种部署架构：
-   All-in-One，即所有的服务部署到一台服务器上
-   Multi-Node，即控制节点和计算机分离
因为Redhat官方有详细的使用文档，因此本文将简要介绍Packstack的快速运行以及交互式运行方式来部署All-in-One的Openstack。
只是在openstack上安装
\[root@openstack \~\]# yum install -y openstack-packstack
验证中 : virt-what-1.13-10.el7.x86_64 78/78
已安装:
openstack-packstack.noarch 0:9.0.0-3.el7ost
作为依赖被安装:
PyYAML.x86_64 0:3.10-11.el7 \....
## 用packstack安装openstack
### 创建应答文件
\[root@openstack \~\]# packstack \--gen-answer-file answer.ini
Packstack changed given value to required value /root/.ssh/id_rsa.pub
### 修改应答文件:
\[root@openstack \~\]# vim answer.ini
修改应答文件
42: CONFIG_SWIFT_INSTALL=n
75: CONFIG_NTP_SERVERS=192.168.1.254
333: CONFIG_KEYSTONE_ADMIN_PW=a
840: CONFIG_NEUTRON_ML2_TYPE_DRIVERS=flat,vxlan
876: CONFIG_NEUTRON_ML2_VXLAN_GROUP=239.1.1.5
910: CONFIG_NEUTRON_OVS_BRIDGE_MAPPINGS=physnet1:br-ex
921: CONFIG_NEUTRON_OVS_BRIDGE_IFACES=br-ex:eth0
936: CONFIG_NEUTRON_OVS_TUNNEL_IF=eth1
1179:CONFIG_PROVISION_DEMO=n
### 根据应答文件安装openstack
\[root@openstack \~\]# packstack \--answer-file=answer.ini
Installing:
Clean Up \[ DONE \]
Discovering ip protocol version \[ DONE \]
Setting up ssh keys \[ DONE \]
..
\*\*\*\* Installation completed successfully \*\*\*\*\*\*
#显示此处为成功
## 可能会出现的错误以及排错方法:
### 1）ntp时间不同步，如图-2所示：
![image002](media/image36.png){width="4.617361111111111in"
height="2.3666666666666667in"}
解决办法：查看ntp时间服务器，是否出现\*号，若没有，查看配置文件，配置ntp服务器步骤在案例3，可以参考
\[root@room9pc01 \~\]# chronyc sources -v //出现\*号代表NTP时间可用
\^\* 120.25.115.20 2 6 17 62 -753us\[-7003us\] +/- 24ms
\[root@openstack \~\]# chronyc sources -v
\^\* 192.168.1.3 3 9 377 504 +50us\[ -20us\] +/- 24ms
\[root@nova \~\]# chronyc sources -v
\^\* 192.168.1.3 3 9 377 159 -202us\[ -226us\] +/- 24ms
### 2）网桥名称写错，如图-3所示：
![image003](media/image37.png){width="4.617361111111111in"
height="1.6833333333333333in"}
解决办法：检查配置文件
\[root@openstack \~\]# vim answer.ini
\...
921 CONFIG_NEUTRON_OVS_BRIDGE_IFACES=br-ex:eth0
//br-ex桥的名称与eth0连接，管理eth0,网桥与哪个物理网卡连接
\...
### 3）若/root/.ssh/id_rsa.pub，提示password，
同样是配置文件没有写对，如图-4所示：
![image004](media/image38.png){width="4.617361111111111in"
height="1.1083333333333334in"}
图-4
### 4）yum源没有配置正确，如图-5所示：
![image005](media/image39.png){width="4.617361111111111in"
height="1.6666666666666667in"}
图-5
解决办法：检查yum是否为10731个软件包，查看是否是yum源没有配置正确，之后安装oprnstack-dashboard
备注：除了系统源gpgcheck=1之外，其他都是gpgcheck=0
### 5）出现Cannot allocate memory,如图-6所示：
![image006](media/image40.png){width="4.617361111111111in"
height="3.466666666666667in"}
图-6
解决办法：
内存不足，重新启动主机
### 查看外部ovs网桥端口
\[root@openstack \~\]# cat /etc/sysconfig/network-scripts/ifcfg-br-ex
ONBOOT=\"yes\"
IPADDR=\"192.168.1.10\"
NETMASK=\"255.255.255.0\"
GETEWAY=\"192.168.1.254\"
DEVICE=br-ex
NAME=br-ex
DEVICETYPE=ovs
OVSBOOTPROTO=\"static\"
TYPE=OVSBridge
\[root@openstack \~\]# cat /etc/sysconfig/network-scripts/ifcfg-eth0
DEVICE=eth0
NAME=eth0
DEVICETYPE=ovs
TYPE=OVSPort #类型变成了端口
OVS_BRIDGE=br-ex
ONBOOT=yes
BOOTPROTO=none #不是dhcp 也不是statce ,纯端口
如果网络启动不了.就手动按照以上配置修改
\[root@openstack \~\]# ovs-vsctl show #查看ovs交换机
# Horizon配置
![LINUXNSD_V01CLOUDDAY02_052](media/image41.png){width="5.760416666666667in"
height="2.9569444444444444in"}
![LINUXNSD_V01CLOUDDAY02_053](media/image42.png){width="5.760416666666667in"
height="4.320833333333334in"}
## Horizon BUG处理
\[root@openstack \~\]# ls /etc/httpd/conf.d/15-horizon_vhost.conf
/etc/httpd/conf.d/15-horizon_vhost.conf
![LINUXNSD_V01CLOUDDAY02_054](media/image43.png){width="5.760416666666667in"
height="3.629166666666667in"}
\[root@openstack \~\]# vim /etc/httpd/conf.d/15-horizon_vhost.conf
\...\...
WSGIDaemonProcess apache group=apache processes=3 threads=10 user=apache
WSGIProcessGroup apache
WSGIApplicationGroup %{GLOBAL}
WSGIScriptAlias /dashboard
\"/usr/share/openstack-dashboard/openstack_dashboard/wsgi/django.wsgi\"
\
\[root@openstack \~\]# apachectl graceful
![](media/image44.png){width="5.759722222222222in"
height="4.597222222222222in"}
用户名:admin 密码:a
界面如果是英文版的可设置,右上角"设置"按钮
![](media/image45.png){width="5.760416666666667in"
height="3.1777777777777776in"}
# 项目管理
## openstack命令行接口基础
\[root@openstack \~\]# ls
answer.ini eip keystonerc_admin
\[root@openstack \~\]# source keystonerc_admin #载入keystonerc_admin文件
\[root@openstack \~(keystone_admin)\]# openstack user list
+\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--+\-\-\-\-\-\-\-\-\-\-\--+
\| ID \| Name \|
+\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--+\-\-\-\-\-\-\-\-\-\-\--+
\| 9c328c7d35934599902c1bfb8399f238 \| admin \|
\| 1e43b2ab6b1b4f9ba2c2ac4223f5e2c7 \| neutron \|
\| 2491ba13b33446a39515b85e913ec0db \| gnocchi \|
\| add28d1d69fb4f20b1ed3ecaf1e34655 \| aodh \|
\| 23f0d028197d4df2b27dac8232bd7ea7 \| nova \|