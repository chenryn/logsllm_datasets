Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 09:59:20 UTC from IEEE Xplore.  Restrictions apply. 
 0.975 0.98 0.985 0.99 0.995 1 2 3 4 5 6CDFThe number of origin ASesFig.2.OriginASesdistribution 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 0 10 20 30 40 50 60 70CDFNumber of sub-prefixesFig.3.Numberofdirectsub-preﬁxes. 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 1 10 100 1000 10000 100000CDFDuration (min) 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 1 10 100 1000 10000 100000CDFDuration (min)aggregatede-aggregateFig.4.Aggregation/de-aggregationduration.Table2.TheprotocolatthepreﬁxownerRi.1.Hash-chainInitializationforeachneighborofRi,send(hn(sp))k−i2.Preﬁxannouncement2.1Announcenewpreﬁxpifpdoesnothaveanycover-preﬁxannounce(p,hn−1(sp))elseﬁndp’sdirectcover-preﬁxesˆp,sendannouncement:(p,hn−1(sp),hcˆp−1(sˆp))endif2.2AnnouncepreﬁxpwithneworiginASRiannouncespreﬁxpwith(p,hc−1(sp))andtheneworiginAS3.WithdrawalTowithdrawpreﬁxpanditslatesthashchainvaluehc(sp);sendwithdrawal:(p,hc−1(sp))withinoneASbehaveconsistentlyasitiseasiertomanageinsidetheISPnetwork.Finally,ifonepreﬁxhasmultipleprovidersasoriginASes,weassumethatthepreﬁxownerwillcommunicatewithalltheseproviderstoensuretheconsistencyofthehashvalue.4.3ThebasicprotocolThekeyideaofourprotocolistoexploitthelight-weightsecuritypropertyofone-wayhashchaintoverifytheassoci-ationbetweentheoriginandtheannouncedpreﬁxesinanyrouteadvertisement.First,theASwhodecidestodeploythisschemeneedstopropagatethehashchain’sinitialvaluetootherASesinasecuremanner.Aftertheinitializationpro-cess,theoriginASstartsannouncingthepreﬁxwithitslatesthashvalue.Eachreceiverthenveriﬁesiftherouteisfromthepreviouslyauthenticatedoriginviatheattachedhashvalue.TheoriginASneedstoupdatethehashvalueonlyinoneofthefollowingthreecases:(1)thepreﬁx’soriginASchanges,(2)anyofitssub-preﬁxesisnewlyannounced,(3)thepre-ﬁxiscompletelywithdrawn.NotethatnormalwithdrawalsandannouncementscausedbyanintermediateASswitchingbetweenalternativepathsreusethesamehashvalue,assuchchangesdonotinvolvetheoriginchanges.TheoverallprotocolforpreﬁxownerRiissketchedinTa-ble2.ForanyupdatereceiverRi+1,theveriﬁcationprocessisshowninTable3withtheterminologydeﬁnedinTable1.Wenowintroduceeachstepoftheprotocol.Table3.TheprotocolatreceiverRi+1.1.Hash-chainInitializationReceivetheinitialvalueforpreﬁxpfromneighborRi,Verifyandstore((hn(sp))k−i)k+i.Signandsend(hn(sp))k−i+1.Storehn(sp).2.PreﬁxannouncementReceiveanannouncementforpreﬁxpwithhc(sp).ifpexistsinroutingtableandoriginASdoesnotchangeAccept.elsifpexists,originASchangesandh(hc(sp))==storedpAccept.Storehc(sp)intheroutingtable.elsifpisanewsub-preﬁxofexistingˆpandwithsameorigin,Accept.Storehn−1(sp)intheroutingtable.elsifpisanewsub-preﬁxofexistingˆp,withdifferentoriginASes,andh(hc(sˆp))==storedˆpAccept.Storehc(sˆp)andhn−1(sp)inroutingtable.elseReject.3.WithdrawalReceiveawithdrawalforpreﬁxpwithhc(sp).ifwithdrawalisannouncedwithupdatedhc(sp)ifh(hc(sp))==storedpAccept.Storehc(sp)intheroutingtable.elseReject.elsifwithdrawaliswitholdhashvalueAccept.1.Hash-chaininitialization.Eachpreﬁxhasaninitialvalue.TheoriginASneedstopropagatetheinitialvaluetootherASessecurely.WeassumethatneighboringeBGPpeer-ingrouterscaneasilyexchangetheirkeys,usinganout-of-bandmechanismneededforestablishingthepeeringsession.Theinitialvaluesarepropagatedhop-by-hopbetweenpartici-patingneighboringrouters.ForeachpreﬁxownedbyASRi,Riﬁrstassignsthepreﬁxaninitialhashchainvalue,whichisthenpropagatedtoitsneighborsencryptedbyk−i.Itsneigh-boringrouterRi+1ﬁrstdecryptsusingRi’spublickey,storesthehashvalue,encryptsitwithitsownkey,andthenprop-agatesthehashvaluefurther.Thisisaone-timeoverheadforeachoriginatingpreﬁx.Whenthehashchainvalueisex-hausted,theinitializationisperformedagain.Notethatintheaboveprotocol,anymaliciousASalongthepropagationpathcanmodifytheinitializationvalue.Weimposeapartialorderingtolimitthepropagationofthemod-iﬁedinitialvaluetoaverysmallrange.Moreprecisely,wecaneliminateanypollutionexceptforattacker’scustomers978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
28
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 09:59:20 UTC from IEEE Xplore.  Restrictions apply. 
withallotherASesguaranteedtobesafeassumingfullde-ployment.Thedetailsaredescribedin§5withothercornercases,e.g.,messageloss,discussedin§7.2.Preﬁxannouncement.IfthepreﬁxisannouncedwiththesameoriginASasthepreviousupdate,orthesub-preﬁxisannouncedwiththesameoriginASasitscover-preﬁx,thereisnoneedtoupdatethehashchain.Thehashchainvaluehoweverisupdatedinthefollowingtwoscenarios.2.1OriginASchanges.ThepreﬁxownermaymodifyitsoriginASbyforinstancemulti-homingtoseveralprovidersforloadbalancing.Inthiscase,werelyonthepreﬁxownertocoordinateaconsistenthashvalueamongtheoriginASes.ItneedstoinformtheneworiginASwiththelatesthashchainvalue.WhenaneworiginASRistartstoannounceapreﬁxp,itneedstoupdatethehashchainvaluetohc−1(sp).NotethatthisisonlyperformedwhentheoriginASchanges.2.2Sub-preﬁxannouncement.Wheneverasub-preﬁxisinitiallyannounced,itshouldbeattachedwithnotonlyitsownhashvalue,butalsoitscover-preﬁx’supdatedhashvalue,indicatingthatthecover-preﬁx’soriginAShasauthenticatedtheannouncementofthesub-preﬁx.WhenRiannouncespreﬁxp’ssub-preﬁxp1,itunder-takesthefollowingactions.Itﬁrstpropagatestheinitialhashvaluehn(sp1)(step1)andthenannouncesthesub-preﬁx:p1,hn−1(sp1),hc−1(sˆp).Thereceivervalidateshc−1(sˆp)withhc(sˆp)tocheckthisannouncementisauthorizedbythecover-preﬁxp.Thereceiverthencompareshn−1(sp1)withhn(sp1)toverifythehashvalueofsub-preﬁxp1.Thisan-nouncementensuresaconnectionbetweenthecover-preﬁxandsub-preﬁx,effectivelypreventingsub-preﬁxhijacking.3.Withdrawal.WithdrawalsoccurquitefrequentlyontheInternetduetotransientfailuresorroutingconvergence.Mostwithdrawalsarecausedbytransientfailuresalongthepath.Forthesetransientwithdrawals,nohashchainupdateisrequiredbecausetransientfailuresarenotcausednorcon-trolledbytheoriginASes.Underonescenariothehashvalueneedstobeupdated.WhentheoriginASRidecidestowithdrawanexistingpre-ﬁxpforthelongterm,e.g.,duetoaggregationorchangingprovider,itneedstoincludetheupdatedhashvalue.ThisistopreventanattackerfromannouncingpwithRiastheoriginASandtheoldhashvalueafterthelong-termwithdrawal.Ifthehashchainvalueinthewithdrawalisthesameasthelatestone,thenthereceivertreatsitasnormalwithdrawalandacceptsit.Otherwise,ifthewithdrawalissenttogetherwithanupdatedhashvalue,suggestingthatthepreﬁxoriginwith-drawsroutetothispreﬁx.Thereceiveracceptsthewithdrawalonlyifthehashchainvaluematches.Oncethepreﬁxiswith-drawn,thereceiverdoesnotacceptanyannouncementforthispreﬁxwithanoldhashchainvalue.Figure5illustrateshowHC-BGPpreventshijackingintro-ducedpreviously.Forbothfullpreﬁxandsub-preﬁxhijack-ing,AS2discardsthefalseroutefromtheattackerbecauseh999(s2)doesnotmatchthestoredhashvalue.WenowbrieﬂyanalyzethecomputationalcomplexityofHC-BGP.Detailedanalysisispresentedin§9.HC-BGPin-troducestwosetsofcomputationaloverhead:asymmetrickeybasedinitializationandhashchainbasedvalidation.Fortu-nately,unlikepreviousschemes,bothoperationsarerarelyperformed.Theinitialization,anexpensiveoperation,isonlyperformedintwocases:whenanASbeginstodeploythisschemeorwhenanewsub-preﬁxisannounced.Thisisonlyaone-timecost.Thehash-chainvaluegeneration/veriﬁcation,whichislight-weight,isonlyperformedwhenapreﬁx’soriginAS(es)changes,anewsub-preﬁxisannouncedorwithdrawn.5Advancedprotocol:partialorderinginHC-BGPannouncementThebasicprotocolhastwosecurityholes:1)duringinitial-ization,anattackercanmodifytheinitialvaluereceivedfromitsneighbor.2)duringthepropagationofhashchainvalueup-dates,anattackercantamperthevalue.ItcanalsoreplaythevaluebyannouncingthepreﬁxasoriginatedfromitsownAS.Inthefollowing,wepresentapartialorderingalgorithmthatcaneffectivelypreventthesecases.Weusethereplayattackasanexample.Thealgorithmcanalsobeappliedtopreventattacksduringinitialization.ThereplayattackisillustratedinFigure6(a).Preﬁxp’sactualownerASAS0startstoannouncepreﬁxpwithhashvaluehi(s).ItannouncestoitsproviderAS1,whichthenpropagatestoitscustomer.IfoneofAS1’scustomerMismalicious,ithijacksthepreﬁxbyannouncingptoitsmulti-homedproviderAS3withhi(s),uponreceivinghi(s)fromAS1.ToavoidconﬂictingoriginASes,Mmaychoosenottoannouncehi(s)toAS1.Inthiscase,MsuccessfullypollutesasetofASesconnectedtoAS3.Topreventsuchattacks,weexplorethefactthatthereex-istsacertaindelaybetweenthetimewhenAS0announceshi(s)andwhenMlearnsit.Thekeyideaofoursolutionistoamplifysuchdelaytoensurethathi(s)fromAS0ispropagatedtothemajorityoftheInternetbeforeMlearnsit.ThisisachievedbyexploitingtheInternethierarchicalstruc-turetoimposeapartialorderingonthehashchainpropaga-tionthroughouttheInternet.Weprovethatbyfollowingtheseguidelines,theBGPsystemreachesasecurestate,suchthatreplayattackisimpossible.Weﬁrstintroducethenotationused.Anupdateforpre-ﬁxpanditshashvaluehi(s)isdenotedasUp.p’sactualownerisAS0.AllTier-1ASesintheInternetformaset{Tier−1}.ThecommercialrelationshipbetweenASesin-cludescustomer-providerandpeer-peer.ThevalidroutingpolicydeterminestheASpathtobeoftheformofCustomer-Provider*Peer-Peer?Provider-Customer*(knownastheASpath“valley-free”rule[9]),where“*”denoteszeroormoreoccurrenceofsuchanASedgeand“?”atmostoneoccur-rence.ThepropagationofUpshouldfollowguidelinesbelow.978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
29
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 09:59:20 UTC from IEEE Xplore.  Restrictions apply. 
sub-prefix with new originverify      rejectAS1AS2AS3VictimAttacker10.1.0.0/16h(s1)100010.1.1.0/24h(s2)999h(s1)!=h(1000h(s2))999AS1AS2AS3VictimAttacker10.1.0.0/16h(s1)100010.1.0.0/16h(s2)999h(s1)!=h(1000h(s2))999origin changed     verify      rejectFull prefix hijacksSub-prefix hijacksFig.5.Hashchainbasedpreﬁxhijackingprevention.Guideline:(Phase-1and2mayproceedconcurrently.)1.InPhase-1,everyASonlysendsUptoitsprovider.2.InPhase-2,theTier-1ASeswhohaveUpsendUptotheirTier-1peers.3.InPhase-3,ifASihasprovidersorTier-1peers,ASiwaitsuntilreceivingUpfromanyoftheprovidersorTier-1ASes.Then,ASisendsUptoallitscustomersandpeers.EachASstoresthehi(s)intheUpfromitsproviderorTier-1peers.Intuitively,theguidelinesenforcetheroutepropagationor-derfollowingthetrustrelationship.Notethatwedonotlimitorchangeanyrouteselectionintheguideline.First,wedonotrestrictanyroutepropagationbutonlyimposesomede-lay.Second,wedonotchangetherouteselectionpolicy.InPhase-3,ASiﬁrstdeterminesthevalidhi(s)fromitsproviderandTier-1peers,whichittrusts.ASicanstillselectthebestrouteamongallrouteswithvalidhi(s).Wenowprovethesecurityguaranteeoftheguideline.Theorem5.1IfalltheASesintheBGPsystemfollowtheguideline,theneveryASonlyacceptsUporiginatingfromAS0,excepttheattackeranditscustomers.Weprovethetheoremusingthreelemmas.Lemma1IntheInternettopology,foranyASi,thereexistsapathintheformof[(Customer→Provider)*(Peer→Peer)?]fromASitooneoftheTier-1ASes.Proof:IfASi∈{Tier−1},Lemma1holds.Oth-erwise,startingfromAS0,bytraversingthroughalltheCustomer→Provideredges,weobtainaDAGD.LetTop(D)denotesthesetofnodesinDwithoutoutgoingdegree(with-outprovider).IfTop(D)(cid:2){Tier−1}(cid:7)=∅,Lemma1holds.IfTop(D)(cid:2){Tier−1}=∅,let’sexaminethehypoth-esisthatthereisnoPeer-Peeredgebetweenthesetwosets.Bydeﬁnition,neitherTop(D)nor{Tier−1}haveproviders.ThustherecannotbeanyCustomer↔Provideredgesbetweenthem.Ifthereisnoedgebetweenthem,thenarouteoriginatedfrom{Tier−1}canonlygothroughProvider→Customer→Provider/PeertoTop(D),whichviolatesthe“valley-free”rule.Thus,thehypothesisisrejectedandLemma1holds.Lemma2EveryASreceivesUp.Thereachabilityisnotaf-fected.Proof:Accordingtothevalley-freepolicy,therouteispropagatedinoneofthefollowingways:(1)customer→AS→provider,(2)customer→AS→peer,(3)customer→AS→customer,(4)peer→AS→customer,(5)provider→AS→customer.Category1isallowedinPhase-1.Cate-gory2-5areallowedinPhase-3withsomedelay.NotethatinPhase-3,eachASsendstheroutetoallitscustomersandpeerseveniftherouteislearnedfromthiscustomer.There-fore,everyASwaitsforﬁnitetimeunlessitisdisconnectedfromallitsproviders.Thus,theguidelinesdonotdisallowanyroutepropagation.Thereachabilityisnotaffected.Lemma3EveryASonlyacceptsUpfromAS0.Themali-ciousrouteisnotbeacceptedbyanyothernetworksexcepttheattackeranditsdirectcustomers.Proof:Weprovethisrecursively.InPhase-1,theownerAS0hastheinitialUp.BytraversingalltheCustomer→Provideredges,weobtainaDAGD.IfASiisinD,itlearnstheroutefromitscustomerASi−1inPhase-1.As-sumingprovidersdonothaveincentivestohijackcustomers’route,UASip=UASi−1p=UAS0p.IfASiisin{Tier−1},therearetwocases.Ifthereisadirectedge,thenUASip=UDp=UAS0p.OtherwisewecanﬁndtheASi−1whichlearnstherouteviaapeeringedgefromD(Lemma1).AssumingthatTier-1ASesaretrustworthy,UASip=UASi−1p=UAS0p.Finally,ifASiisnotin{{Tier−1}(cid:3)D},accordingtoguideline(3),ASionlyacceptsroutefromitsprovider.TraversingtheCustomer→ProviderdirectededgefromASi,weobtainaDAGD(cid:2).BecauseofLemma1,UTop(D(cid:2))p=U{Tier−1}p=UAS0p.Thus,UASip=UAS0p.Weusethisguidelinetoprovidesecuritytobothhashchain-basedrouteupdatesandthehashvalueinitializationprocess.SimilartotheexampleinFigure6(a),whenapreﬁxownerstartstoinitializethehashvaluehn(s),themaliciousASMcanmodifythehn(s)tohn(s(cid:2)).However,ifallASesfollowtheguideline,anyASexceptMacceptsthecorrecthn(s).Figure6(b)showsthatAS1onlysendshi(s)toMaf-terAS4haslearnedthecorrectvalue.Accordingtoguideline(3),AS3truststhevaluefromAS4insteadofM.Thus,theattackercannotpolluteanyotherASesbyreplayinghi(s).TheguidelineimposesextraroutepropagationdelaytotheBGPsystem.Wearguethisisnotaseriousissueforthefol-lowingtworeasons.First,thedelayisonlyimposedwhenthepreﬁxoriginchangesorpreﬁxannouncement/withdrawal.Theseeventsdonotoccurfrequently.Second,usuallythe978-1-4244-4421-2/09/$25.00 c(cid:13)2009 IEEE
30
Authorized licensed use limited to: Tsinghua University. Downloaded on March 20,2021 at 09:59:20 UTC from IEEE Xplore.  Restrictions apply. 