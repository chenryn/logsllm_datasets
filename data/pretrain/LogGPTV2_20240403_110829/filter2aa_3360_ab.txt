PentesterAcademy.com
SRTP Decrypt: Ready
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
SRTP Decrypt: Copying SRTP key
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
SRTP Decrypt: UDP Ports
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
SRTP Decrypt: Decrypting SRTP Traffic
Command: ./srtp-decrypt -k uK+RfjSi9/fUFr8zoJu6zdqPw6MGtONhgX4yqwRj  decoded.raw 
•
-k      :     Defined SRTP key  (uK+RfjSi9/fUFr8zoJu6zdqPw6MGtONhgX4yqwRj in this case)
•
Normal_Call_two_parties.pcap  Input file
•
decoded.raw 
Output file
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
SRTP Decrypt: decoded.raw
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
SRTP Decrypt: Importing Decrypted Content
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
SRTP Decrypt: Importing Decrypted Content
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
SRTP Decrypt: Imported Decrypted UDP Packets
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
SRTP Decrypt: Decode As
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
SRTP Decrypt: Decode As RTP
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
SRTP Decrypt: Decoded Packets
PentesterAcademy.com
©PentesterAcademy.com
SRTP Decrypt: Checking RTP Streams PentesterAcademy.com
PentesterAcademy.com
©PentesterAcademy.com
SRTP Decrypt: Analysing RTP Streams PentesterAcademy.com
PentesterAcademy.com
©PentesterAcademy.com
SRTP Decrypt: Playing Decrypted Call PentesterAcademy.com
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Libsrtp
•
Implementation of the Secure Real-time Transport Protocol (SRTP)
•
Can decipher SRTP packets
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Libsrtp
•
GitHub: github.com/cisco/libsrtp   
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Libsrtp: Installation
•
Cloning
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Libsrtp: Installation
•
Configure
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Libsrtp: Installation
•
Make
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Libsrtp: Ready
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Libsrtp: SRTP key
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Libsrtp: Copying SRTP key
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Libsrtp: Filtering for one sender
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Libsrtp: Filtering single RTP stream
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Libsrtp: Exporting filtered traffic
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Libsrtp: Saving exported traffic
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Libsrtp: Command
•
./rtp_decoder -a -t 10 -e 128 -b 2stvabBcXXf3HtaHCSsB8WACeRBst9f7lwLqlzqE *  ./Normal_Call_two_parties_Decrypted.pcap
•
-t                         Treat the text before the packet as a date/time code
•
%M:%S               Time format
•
-u                         Prepend dummy UDP header with specified source and destination ports
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Libsrtp: Decrypting RTP traffic
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Libsrtp: Decrypted traffic
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Libsrtp: Decode as
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Libsrtp: Decode as RTP
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Libsrtp: Decrypted RTP traffic
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Libsrtp: Analysing RTP Streams
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Libsrtp: Analysing RTP Streams
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Libsrtp: Playing decrypted call
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Other Important Parts?
• DTMF
• Messages (SMS)
• Exporting Call
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
RTP DTMF
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
SIP Message
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
PCAP2WAV: Online service 
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
PCAP2WAV: Uploading PCAP and Downloading Wav
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
PCAP2WAV: Wav in audacity
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
PCAP2WAV: Offline script
•
Bash script to extract the audio from VoIP calls
•
Outputs .wav file
•
Uses tshark and sox
•
GitHub: https://gist.github.com/avimar/d2e9d05e082ce273962d742eb9acac16 
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
PCAP2WAV: Help
PentesterAcademy.com
©PentesterAcademy.com
PCAP2WAV: Installing tshark and sox PentesterAcademy.com
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
PCAP2WAV: Running the tool
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
PCAP2WAV: Directory contents 
•
Directory content before running the script
•
Directory content after running the script
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
PCAP2WAV: Wav in audacity
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
VoIPShark
•
Collection of Wireshark plugins to
–
Decrypt VoIP calls
–
Export call audio
–
Overview of traffic (Extensions, SMS, DTMF)
–
Common VoIP attacks
•
GPL just like Wireshark
•
Github: github.com/pentesteracademy/voipshark 
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
VoIPShark: Need?
•
Cumbersome and complex process
•
Multiple tools
–
Need compilation, hence time consuming to set-up 
–
Not easy to use
–
User dependent, prone to mistakes
•
Inability to retain timestamp, IP addresses etc. during decryption
•
Live traffic not supported
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Why Wireshark Plugins?
•
Plug and play
•
Plugins can be 
–
Lua scripts
–
Compiled C/C++ code
•
Harnessing power of Wireshark
•
OS independent
•
Large user base
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Wireshark Plugins Types
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Dissector
•
To interpret the payload data
•
Decodes its part of the protocol and passes the payload to next
Example Dissection Flow
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Chained Dissector
•
Takes data from previous dissector, processes its part and pass the payload to next 
dissector
Example Dissection Flow
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
VoIPShark: Hook in Dissector Chain
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
VoIPShark: Overall Architecture
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
VoIPShark: Decryption Routines
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Plugins locations
•
Check Help > About Wireshark > Folders
Windows                                                                                    Ubuntu
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Decrypting SRTP: SRTP Packets
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Decrypting SRTP: Enabling Auto Decryption
PentesterAcademy.com
©PentesterAcademy.com
Decrypting SRTP: Decrypted SRTP (RTP) PentesterAcademy.com
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
VoIPShark: Exporting Call Audio
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
Exporting Call Audio: Specifying Location and File name
PentesterAcademy.com
©PentesterAcademy.com
Exporting Call Audio: Exported Streams PentesterAcademy.com
PentesterAcademy.com
©PentesterAcademy.com
VoIPShark: SIP Information Gathering PentesterAcademy.com
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
SIP Information Gathering : DTMF
PentesterAcademy.com
©PentesterAcademy.com
SIP Information Gathering: Extensions PentesterAcademy.com
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
SIP Information Gathering: RTP Packet Transfers
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
SIP Information Gathering : SIP Auth Export
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
SIP Information Gathering : Servers and Proxy
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
SIP Information Gathering: Unique Messages 
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
VoIPShark: VoIP Attack Detection
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
 VoIP Attack Detection: Bruteforce
PentesterAcademy.com
©PentesterAcademy.com
 VoIP Attack Detection: Invite Flooding PentesterAcademy.com
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
 VoIP Attack Detection: Message Flooding
PentesterAcademy.com
©PentesterAcademy.com
 VoIP Attack Detection: MiTM AttemptsPentesterAcademy.com
PentesterAcademy.com
©PentesterAcademy.com
PentesterAcademy.com
 VoIP Attack Detection: Unauthenticated Users
PentesterAcademy.com
©PentesterAcademy.com
Demo
PentesterAcademy.com
©PentesterAcademy.com
Q & A
Github: github.com/pentesteracademy/voipshark
PI:EMAIL