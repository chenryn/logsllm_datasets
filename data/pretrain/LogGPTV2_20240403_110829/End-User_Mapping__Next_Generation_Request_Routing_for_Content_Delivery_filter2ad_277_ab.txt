To motivate the need for end-user mapping, we start by
analyzing the locations of clients relative to their recursive
name servers (i.e., LDNS) in the global Internet. To obtain
an accurate picture we need to match a large characteristic
set of clients around the world with their respective LDNSes.
The matched client-LDNS pairs can then be located using
our geo-location database [1] to provide the geographic lo-
cation and network information needed for the analysis.
3.1 Collecting Client-LDNS pairs
Associating a client with its LDNS has some intrinsic dif-
ﬁculties. Both the LDNS’s request for a domain name reso-
lution and the client’s subsequent request for an URL on that
domain are logged at Akamai’s authoritative name servers
and content servers respectively. One potential approach
is to match these requests to obtain client-LDNS pairings.
However, matching the requests is tricky and inexact since
the two requests can be spaced within a time window equal
to the TTL of the domain name. Further, when the client re-
ceives a cached response from its LDNS, the LDNS makes
no corresponding downstream request to Akamai’s author-
itative name servers. While there are heuristic ways of ob-
taining a smaller sample of client-LDNS pairs [24], our chal-
lenge is to obtain a large characteristic and deﬁnitive set of
pairs that have good coverage of the clients who generate
trafﬁc on the global Internet.
To obtain a large set of pairs, we use Akamai’s download
manager called NetSession [3]. NetSession is installed on
client devices and is used to perform downloads in a faster
and more reliable fashion. Software and media publishers
opt-in to use Netsession features to improve http delivery
performance for their content. Once they opt-in, clients use
Netsession to download that content. Thus, Netsession has
a large, representative installed base of clients around the
world, making it an ideal measurement platform for our anal-
ysis. More than 30 million unique NetSession clients per-
form transactions every month.
NetSession was instrumented to collect LDNS informa-
tion as follows. Each NetSession client maintains a persis-
tent connection with a NetSession control plane. Even if the
client is behind a NAT, it can reliably learn its external client
IP from this persistent connection. NetSession clients also
found their LDNS server performing a “dig” command on a
special Akamai name whoami.akamai.net. The client-
LDNS association was then sent to Akamai’s cloud storage
for processing. The LDNS information for clients around
the world were then aggregated in the cloud to the granular-
ity of /24 client IP blocks. Speciﬁcally, for each /24 client
IP block, the process generates the set of IPs corresponding
to the LDNSes used by the clients in that address block. For
each LDNS in the set, the relative frequency with which that
LDNS appeared was computed.
Using the above process, we collected LDNS data from
March 24 to April 7, 2014. On average, about 14.8 mil-
lion records were processed per day during the course of our
data collection. Client-LDNS association data for a total of
3.76 million /24 client IP blocks was computed in aggre-
gate. While the clients that use NetSession are generally a
fraction of the total active clients in any given /24 client IP
block, our coverage of /24 client IP blocks is representative
and signiﬁcant of the overall Internet. In particular, the /24
client IP blocks in our dataset account for about 84.6% of
the total global client demand5 served by Akamai. The num-
ber of distinct LDNSes in our data set was just over 584,000.
Thus, our data set is a large representative cross-section of
clients and LDNSes in the global Internet.
To derive client-LDNS distance estimates, we use Aka-
mai’s Edgescape [1] geo-location database that uses registry
data and network data distilled from transactions handled by
over 170,000 Akamai servers in 102 countries and over a
thousand ISP deployments around the world to establish ge-
ographical location and network information for IPs around
the world. Edgescape can provide the latitude, longitude,
country and autonomous system (AS) for an IP. For IPs in
mobile networks, the mobile gateway location is used as the
reference location. To derive the distance between a client-
LDNS pair we use the latitude and longitude information to
compute the great circle distance between the two locations.
5Client demand is a measure of the amount of content trafﬁc
downloaded by a client (or by clients in an IP block).
171
40%
30%
20%
10%
d
n
a
m
e
d
t
n
e
i
l
c
f
o
t
n
e
c
r
e
P
0%
10
100
Client−LDNS distance (miles)
1000
10000
Figure 5: Histogram of client-LDNS distance for clients
across the global Internet.
)
s
e
l
i
m
(
e
c
n
a
i
t
s
d
S
N
D
L
−
n
e
t
i
l
C
7500
5000
2500
0
N
I
R
T
N
V
X
M
R
B
D
I
U
A
U
R
T
I
P
J
S
U
Y
M
A
C
E
D
R
F
B
G
L
N
R
A
H
T
H
C
S
E
K
H
R
K
G
S
W
T
Country
Figure 6: Client-LDNS distances by country.
3.2 How far are clients from their LDNSes
Figure 5 shows the overall global distribution of client
LDNS distances. Nearly half of the client population is lo-
cated very close to its LDNS. The most typical distance lies
in a range that is no greater than the diameter of a metropoli-
tan area. At around 200-300 miles, there is a noteworthy
increase in the marginal distribution. At around 5000 miles,
there is another increase that can be attributed to the small
number of clients that use LDNS that are either across the
Atlantic or Paciﬁc oceans.
Breakdown by country. Breaking these distances down
by country, Figure 6 is a box-plot6 representing the 5th, 25th,
median, 75th, and 95th quantiles of the per-country distribu-
tions. We list data for the top 25 countries as measured by
aggregate client demand. Overall, most countries have a me-
dian distance that is fairly small, though India, Turkey, Viet-
nam and Mexico have median distances over 1000 miles. In-
dia, Brazil, Australia, and Argentina have signiﬁcant popu-
lations whose LDNSes are very far away as over a quarter of
the population is served by LDNSes whose distance is over
6All box plots in this paper show 5th, 25th, 50th, 75th and
95th percentiles.
4500 miles. Western Europe sees low distances appearing in
a small band. However, Korea and Taiwan are signiﬁcant in
having the smallest distances. This is not surprising consid-
ering the well-developed Internet infrastructure and the con-
centration of populations within a small geographical area in
the major cities in these countries. Japan has a small median
distance but a signiﬁcant fraction of clients have LDNSes
that are far away. One reason is clients at multi-national cor-
porations with centralized LDNSes deployed outside Japan.
Public resolvers. We now evaluate the client-LDNS dis-
tance for public resolvers where a client uses an LDNS pro-
vided by a public third-party provider such as Google Pub-
lic DNS or OpenDNS. Such providers have a distributed
name server infrastructure and use IP anycast [14] to route
clients to the “closest” LDNS deployment. However, the
public resolvers use their unicast addresses when commu-
nicating with Akamai’s authoritative name servers allowing
us to geo-locate the public LDNSes. Figure 7 shows client-
LDNS distance for clients that use public resolvers. We see
that the client-LDNS distances are signiﬁcantly higher with
median distance at 1028 miles, compared to a median dis-
tance of 162 miles in the overall client population. This re-
ﬂects the fact that the LDNS deployments of a public DNS
provider may often not be local to the client.
compared to clients in those same countries who do not use
public resolvers.
6000
5000
4000
3000
2000
)
s
e
l
i
m
(
e
c
n
a
i
t
s
D
S
N
D
L
−
n
e
t
i
l
C
1000
0
R
A
R
B
U
A
N
D
I
I
G
S
Y
M
H
T
R
T
X
M
P
J
S
E
S
U
U
R
K
H
T
I
H
C
E
D
B
G
R
F
L
N
W
T
N
V
R
K
A
C
Country
Figure 8: Client-LDNS distance for clients who use public
resolvers.
l
s
r
e
v
o
s
e
r
c
12.5%
10.0%
7.5%
5.0%
2.5%
0.0%
d
n
a
m
e
d
t
n
e
i
l
c
f
o
t
n
e
c
r
e
P
10
100
Client−LDNS distance (miles)
1000
Figure 7: Histogram of the client-LDNS distance for clients
who use public resolvers.
The country breakdown in Figure 8 shows disproportion-
ately large distances for clients using public resolvers in some
countries in South America, South East Asia and Oceania.
The two South American countries of Argentina and Brazil
had the largest distances.
In this regard, it is notable that
the largest public resolver provider, Google Public DNS,
does not currently have a presence in many South American
countries. Singapore and Malaysia are well served by the
public resolvers hosted in Singapore. However, presumably
due to peering arrangements, many clients in these coun-
tries are routed to more distant public resolvers. Clients who
use public resolvers in Western Europe, Hong Kong and Tai-
wan are relatively close to their LDNS in comparison with
other countries, though they are much more distant when
172
40%
20%
0%
i
l
b
u
p
m
o
r
f
d
n
a
m
e
d
t
n
e
i
l
c
f
o
t
n
e
c
r
e
P
N
V
R
T
T
I
D
I
Y
M
R
B
R
A
N
I
U
R
X
M
H
T
S
E
W
T
S
U
B
G
K
H
A
C
H
C
R
F
L
N
E
D
G
S
U
A
P
J
R
K
Country
Figure 9: Percent of client demand originating from public
resolvers, by country.
10000
The adoption of public resolvers also vary country by coun-
try. Figure 9 shows the percentage of client demand orig-
inating from public resolvers broken down by country as
seen in our NetSession data set. Clients in Vietnam and
Turkey are very heavy users of public resolvers. Remark-
ably, despite the signiﬁcant client-LDNS distances, a sig-
niﬁcant fraction of clients in India, Brazil, and Argentina
use public resolvers. Overall, percent of client demand from
public resolvers approaches 8 percent worldwide.
Breakdown by AS. Figure 10 shows the distribution of
the client-LDNS distance as a function of the AS size, where
AS size is the client demand originating from that AS as a
percentage of the total client demand served by Akamai, i.e.,
an AS with size 2 1 has clients that account for 0.5% of the
total client demand served by Akamai. A total of 37,294
ASes with the most demand were analyzed.
As can be seen in the ﬁgure, when the AS size is small,
the client-LDNS distances are large, especially the higher