[15] Dataproof Communications, “Plurox: Modular backdoor,” Dataproof
[Online]. Available: http://
Communications, Tech. Rep., 2019.
www.dataproof.co.za/index.php/2019/06/18/plurox-modular-backdoor/
[16] L. DiCioccio, R. Teixeira, M. May, and C. Kreibich, “Probe and
Pray: Using UPnP for Home Network Measurements,” in International
Conference on Passive and Active Network Measurement (PAM), 2012.
[17] R. Dingledine, N. Mathewson, and P. Syverson, “Tor: The Second-
generation Onion Router,” in USENIX Security Symposium, 2004.
[18] P. Ducklin, “Don’t
fall victim to the Chromecast hackers –
here’s what to do,” Sophos, Tech. Rep., 2019. [Online]. Available:
https://nakedsecurity.sophos.com/2019/01/04/dont-fall-victim-to-the-
chromecast-hackers-heres-what-to-do/
[19] Z. Durumeric, M. Bailey, and J. A. Halderman, “An Internet-Wide View
of Internet-Wide Scanning,” in USENIX Security Symposium, 2014.
[20] Z. Durumeric, E. Wustrow, and J. A. Halderman, “ZMap: Fast Internet-
wide Scanning and Its Security Applications,” in USENIX Security
Symposium, 2013.
[21] R. T. Fielding, J. Gettys, J. C. Mogul, H. F. Nielsen, L. Masinter, P. J.
Leach, and T. Berners-Lee, “RFC 2616: Hypertext Transfer Protocol -
HTTP/1.1,” RFC Editor, Tech. Rep., 1999.
[22] R. T. Fielding and J. F. Reschke, “RFC 7230: Hypertext Transfer
Protocol (HTTP/1.1): Message Syntax and Routing,” RFC Editor, Tech.
Rep., 2014.
[23] ——, “RFC 7231: Hypertext Transfer Protocol (HTTP/1.1): Semantics
and Content,” RFC Editor, Tech. Rep., 2014.
[24] ——, “RFC 7235: Hypertext Transfer Protocol (HTTP/1.1): Authenti-
cation,” RFC Editor, Tech. Rep., 2014.
[25] D. Garcia, “Universal plug and play (UPnP) mapping attacks,” in
DEF CON 19, 2011. [Online]. Available: http://toor.do/DEFCON-19-
Garcia-UPnP-Mapping-WP.pdf
[26] G. George, E. Wirt, and D. J. Blueman, “Linux UPnP Internet Gateway
Device,” 2007. [Online]. Available: http://linux-igd.sourceforge.net
[27] R. D. Graham, “MASSCAN: Mass IP port scanner,” 2014. [Online].
Available: https://github.com/robertdavidgraham/masscan/
[28] B. Greene, “Filtering Exploitable Ports and Minimizing Risk to
and from Your Customers,” Tech. Rep., 2017. [Online]. Available:
https://www.senki.org/exploitable-port-ﬁltering/
[29] S. Grover, M. S. Park, S. Sundaresan, S. Burnett, H. Kim, B. Ravi, and
N. Feamster, “Peeking Behind the NAT: An Empirical Study of Home
Networks,” in ACM SIGCOMM Conference on Internet Measurement,
2013.
[30] M. A. Hakim, H. Aksu, A. S. Uluagac, and K. Akkaya, “U-PoT:
A Honeypot Framework for UPnP-Based IoT Devices,” in IEEE In-
ternational Performance Computing and Communications Conference
(IPCCC), 2018.
J. Hart, “R7-2014-17: NAT-PMP Implementation and Conﬁguration
Vulnerabilities,” Rapid7, Tech. Rep., 2014. [Online]. Available: https:
[31]
16
[52] S. Neti and S. Sivakumaran, “CVE-2019-12527: Code execution on
squid proxy through a buffer overﬂow,” Trend Micro, Tech. Rep.,
2019.
[Online]. Available: https://www.zerodayinitiative.com/blog/
2019/8/22/cve-2019-12527-code-execution-on-squid-proxy-through-a-
heap-buffer-overﬂow
[53] V. Olteanu and D. Niculescu, “SOCKS protocol version 6 -
[Online]. Available:
draft,” RFC Secretariat, Tech. Rep., 2018.
https://tools.ietf.org/html/draft-olteanu-intarea-socks-6-02
[54] Open Connectivity Foundation, “UPnP Standards & Architecture,”
[Online]. Available: https://openconnectivity.org/developer/
2019.
speciﬁcations/upnp-resources/upnp
[55] V. S. Pai, L. Wang, K. Park, R. Pang, and L. Peterson, “The Dark
Side of the Web: An Open Proxy’s View,” ACM SIGCOMM Computer
Communication Review, vol. 34, no. 1, 2004.
[56] Pat Padgett, “Corkscrew – A tool for tunneling SSH through HTTP
[Online]. Available: https://github.com/bryanpkc/
proxies,” 2001.
corkscrew
[57] D. Perino, M. Varvello, and C. Soriente, “ProxyTorrent: Untangling
the Free HTTP(S) Proxy Ecosystem,” in World Wide Web Conference
(WWW), 2018.
[58] ProxyBroker Developers, “Proxybroker,” 2019. [Online]. Available:
https://proxybroker.readthedocs.io
[59] Y. Rekhter, B. G. Moskowitz, D. Karrenberg, G. J. de Groot, and
E. Lear, “RFC 1918: Address Allocation for Private Internets,” RFC
Editor, Tech. Rep., 1996.
[60] C. Rossow, “Ampliﬁcation Hell: Revisiting Network Protocols for
DDoS Abuse,” in Symposium on Network and Distributed System
Security (NDSS), 2014.
[61] W. Scott, R. Bhoraskar, and A. Krishnamurthy, “Understanding open
proxies in the wild,” Chaos Communication Camp, 2015.
[62] C. Seaman, “UPnProxy: EternalSilence,” Akamai, Tech. Rep., 2018.
[Online]. Available: https://blogs.akamai.com/sitr/2018/11/upnproxy-
eternalsilence.html
[63] Shodan Developers, “Shodan,” 2019.
//www.shodan.io
[Online]. Available: https:
[64] A. K. Sood, R. J. Enbody, and R. Bansal, “Dissecting SpyEye – Under-
standing the design of third generation botnets,” Computer Networks,
vol. 57, no. 2, 2013.
J. Squire, “Universal Plug and Play IGD - A Fox in the Hen
House,” in Blackhat Brieﬁngs USA, 2008.
[Online]. Available:
https://www.blackhat.com/presentations/bh-usa-08/Squire/BH US 08
Squire A Fox in the Hen House%20White%20Paper.pdf
[65]
[66] K. Steding-Jessen, N. L. Vijaykumar, and A. Montes, “Using low-
interaction honeypots to study the abuse of open proxies to send spam,”
INFOCOMP Journal of Computer Science, vol. 7, no. 1, 2008.
[67] Symantec,
“Inception framework: Alive
and hiding
behind proxies,” Symantec, Tech. Rep., 2018.
[Online]. Avail-
able: https://www.symantec.com/blogs/threat-intelligence/inception-
framework-hiding-behind-proxies
”thecableguy“, “Security breached devices - port tcp 4145,” 2018. [On-
line]. Available: https://forum.mikrotik.com/viewtopic.php?t=137840
and well,
[68]
[69] G. Tsirantonakis, P. Ilia, S. Ioannidis, E. Athanasopoulos, and M. Poly-
chronakis, “A Large-scale Analysis of Content Modiﬁcation by Open
HTTP Proxies,” in Symposium on Network and Distributed System
Security (NDSS), 2018.
[70] Z. Whittaker, “Hackers hijack thousands of Chromecasts to warn
of latest security bug,” TechCrunch, 2019. [Online]. Available: http:
//social.techcrunch.com/2019/01/02/chromecast-bug-hackers-havoc/
[71] D. Wing, S. Cheshire, M. Boucadair, R. Penno, and P. Selkirk, “RFC
6887: Port Control Protocol (PCP),” RFC Editor, Tech. Rep., 2013.
//blog.rapid7.com/2014/10/21/r7-2014-17-nat-pmp-implementation-
and-conﬁguration-vulnerabilities/
[32] A. Hemel, “Universal Plug and Play: Dead simple or simply deadly?” in
5th System Administration and Network Engineering Conference, 2006.
[33] S. Huang, F. Cuadrado, and S. Uhlig, “Middleboxes in the Internet:
a HTTP perspective,” in Network Trafﬁc Measurement and Analysis
Conference (TMA).
Internet Society, “State of IPv6 Deployment 2018,” Internet Society,
Tech. Rep., 2018. [Online]. Available: https://www.internetsociety.org/
resources/2018/state-of-ipv6-deployment-2018/
IEEE, 2017.
[34]
as Control Servers; Releases Free Tool
“McAfee Discovers Pinkslipbot Exploiting Infected
[35] S. Karve,
to Detect,
Machines
Disable Trojan,” McAfee Blogs,
[Online]. Available:
https://securingtomorrow.mcafee.com/other-blogs/mcafee-labs/mcafee-
discovers-pinkslipbot-exploiting-infected-machines-as-control-servers-
releases-free-tool-to-detect-disable-trojan/
2017.
[36] B. Kelly, Z. Durumeric, D. Adrian, D. Corcoran, and J. A. Halderman,
“Censys,” 2018. [Online]. Available: https://censys.io
[37] R. Khare and S. D. Lawrence, “RFC 2817: Upgrading to TLS Within
HTTP/1.1,” RFC Editor, Tech. Rep., 2000.
[38] D. Koblas
and M. R. Koblas,
in USENIX
Summer 1992 Technical Conference, 1992.
[Online]. Available:
https://www.usenix.org/conference/usenix- summer- 1992- technical-
conference/socks
“SOCKS,”
[39] M. K¨uhrer, T. Hupperich, C. Rossow, and T. Holz, “Exit from Hell?
Reducing the Impact of Ampliﬁcation DDoS Attacks,” in USENIX
Security Symposium, 2014.
[40] L. Kuppan,
“JS-Recon,”
2010.
[Online]. Available:
http:
//www.andlabs.org/tools/jsrecon/jsrecon.html
[41] Y. Lee, “SOCKS: A protocol for TCP proxy across ﬁrewalls,” NEC,
Tech. Rep., 2005. [Online]. Available: https://ftp.icm.edu.pl/packages/
socks/socks4/SOCKS4.protocol
[42] ——, “SOCKS 4A: A Simple Extension to SOCKS 4 Protocol,”
NEC, Tech. Rep., n.d. [Online]. Available: https://www.openssh.com/
txt/socks4a.protocol
[43] M. Leech, “RFC 1929: Username/Password Authentication for SOCKS
V5,” RFC Editor, Tech. Rep., 1996.
[44] M. Leech, M. Ganis, Y. Lee, R. Kuris, D. Koblas, and L. Jones, “RFC
1928: SOCKS Protocol Version 5,” RFC Editor, Tech. Rep., 1996.
I. Livadariu, K. Benson, A. Elmokashﬁ, A. Dhamdhere, and A. Dainotti,
in the Wild,” in IEEE
“Inferring Carrier-Grade NAT Deployment
Conference on Computer Communications (INFOCOM), 2018.
[45]
[46] G. Lyon, “Firewall/IDS Evasion and Spooﬁng,” 2019.
[Online].
Available: https://nmap.org/book/man-bypass-ﬁrewalls-ids.html
[47] A. Mani, T. Vaidya, D. Dworken, and M. Sherr, “An Extensive
Evaluation of the Internet’s Open Proxies,” in Annual Computer Security
Applications Conference (ACSAC), 2018.
[48] R. Merget, J. Somorovsky, N. Aviram, C. Young, J. Fliegenschmidt,
J. Schwenk, and Y. Shavitt, “Scalable Scanning and Automatic Clas-
siﬁcation of TLS Padding Oracle Vulnerabilities,” in USENIX Security
Symposium, 2019.
[49] X. Mi, Y. Liu, X. Feng, X. Liao, B. Liu, X. Wang, F. Qian, Z. Li,
S. Alrwais, and L. Sun, “Resident Evil: Understanding Residential IP
Proxy as a Dark Service,” in IEEE Symposium on Security and Privacy.
IEEE, 2019.
[50] C. Montonen, “Solar and Solstice - Two Mirai Variants,” Tech. Rep.,
2019. [Online]. Available: https://blog.race-conditions.net/posts/solar-
and-solstice-two-mirai-variants/
[51] H. Moore, “Security Flaws in Universal Plug and Play: Unplug.
Don’t play,” Rapid7, Tech. Rep., 2013. [Online]. Available: https:
//hdm.io/writing/SecurityFlawsUPnP.pdf
17
A. UPnP
APPENDIX
Listing 1 shows an example request for discovering all
UPnP supporting devices, and a single response from a gate-
way device.
> M−SEARCH * HTTP / 1 . 1
> HOST: 2 3 9 . 2 5 5 . 2 5 5 . 2 5 0 :1 900
> MAN: ” s s d p : d i s c o v e r ”
> MX: 2
> ST: ”ssdp:all”
urn:schemas-upnp-org:device:InternetGatewayDevice:1
. . .
u r n : s c h e m a s−upnp−o r g : d e v i c e : W A N C o n n e c t i o n D e v i c e : 1
WANConnectionDevice
MiniUPnP
h t t p : / / miniupnp . f r e e . f r /
MiniUPnP daemon
MiniUPnPd
20170705
h t t p : / / miniupnp . f r e e . f r /
00000000
uuid:7061756c −6974−6172−6a61−( . . . )
000000000000
urn:schemas-upnp-org:service:WANIPConnection:1
urn:upnp−org:serviceId:WANIPConn1
/WANIPCn.xml
/ctl/IPConn
/ e v t / IPConn
h t t p : / / 1 9 2 . 1 6 8 . 1 5 . 1 /
Listing 2.
Condensed UPnP Device Description showing availability of
version 1 of the WANIPConnection service of the Internet Gateway Device.
0
8
16
Version=4/0 † Cmd/Result
Destination port
31
Destination address
Null-terminated user ID (variable length)
SOCKS4A: Null-terminated domain name
Version=5
Cmd/Result
Reserved=0 Address type
Destination address (variable length)
Destination port
Reserved = 0
Fragment
Address Type
Destination address (variable length)
Destination port
Data
4
S
K
C
O
S
S
P
D
U
5
S
K
C
O
S
5
S
K
C
O
Fig. 4. SOCKS4(A) and SOCKS5 headers († for responses)
TABLE XIII.
SOCKS COMMANDS AND ERROR CODES ([44], [38])
SOCKS4
SOCKS5
Code
0x01
0x02
Code
0x5A
0x5B
0x5C
0x5D
Command
Connect
Bind
Reason
Request granted
Request rej./failed
Failed: no identd
Fail: identd conﬁrm
Code
0x01
0x02
0x03
Code
0x00
0x01
0x02
0x03
0x04
0x05
0x06
0x07
0x08
0xFF
Command
Connect
Bind
UDP associate
Reason
Succeeded
General failure
Not allowed
Net unreachable
Host unreachable
Connection refused
TTL expired
Unsupp. command
Unsupp. address type
No valid auth
B. SOCKS
Figure 4 visualizes the headers for both commonly used
SOCKS versions to illustrate the lack of backward compat-
ibility between the versions. SOCKS4A extension works by
using a non-routable (ﬁrst three bytes zeroed) IP address as
destination and appending a null-terminated domain name at
the end. SOCKS5 requires authentication method negotiation
and authentication, which are omited in this presentation.
SOCKS5 UDP datagrams are wrapped into a UDP preamble
and sent to the server-given endpoint for delivery.
Table XIII shows the differences in commands and error
codes, emphasizing the differences in the result codes.
18