4.
IMPLEMENTATION
Fig. 6 shows the prototype of a single full duplex radio. To imple-
ment it we designed our own analog circuit boards for cancellation
and integrated them with existing software radios. We also imple-
mented the digital cancellation algorithms in the software radio. Be-
low we discuss the different pieces.
Analog Cancellation Board: The analog cancellation board is a
10×10 cm PCB board designed and built using Rogers 4350 ma-
terial. The ﬁxed delay lines are implemented using micro-strip trace
381In this section we show experimentally that our design delivers a
complete full duplex WiFi PHY link. We prove the claim in two
stages. First, we show that our design provides the 110dB of self
interference cancellation required to reduce interference to the noise
ﬂoor. We also show experimentally that the received signal is re-
ceived with almost no distortion in full duplex mode (the SNR of
the received signal is reduced by less than 1dB on average), and that
these results are consistent across a wide variety of bandwidths, con-
stellations, transmit powers and so on. Second, we take the next
step and design a working full duplex communication WiFi link. We
show experimentally that it delivers close to the theoretical doubling
of throughput expected from full duplex.
We start with an experimental evaluation of the cancellation sys-
tem. We deﬁne two metrics we use throughout this section:
• Increase in noise ﬂoor: This is the residual interference present af-
ter the cancellation of self interference which manifests itself as
an increase in the noise ﬂoor for the received signal. This num-
ber is calculated relative to the receiver noise ﬂoor of the radio of
−90dBm. For example, if after cancellation we see a signal energy
of −88dBm, it would imply that we increased the noise ﬂoor by
2dB.
• SNR loss: This is the decrease in SNR experienced by the received
signal when the radio is in full duplex mode due to any residual
self interference left after cancellation. To compute this we ﬁrst
measure the SNR of the received signal when the radio is in half
duplex mode and there is no self interference, and then with full
duplex mode. The difference between these two measured SNRs is
the SNR loss.
We compare our design against two state-of-the-art full duplex
systems presented in prior work.
• Balun Cancellation: This design [11] uses a balun transformer to
invert a copy of the transmitted signal, adjust its delay and attenua-
tion using programmable attenuators and delay lines and cancel it.
The design also uses two antennas separated by 20cm one each for
TX and RX which automatically provides 30dB of self interference
reduction. We implement this design and optimize it to produce the
best performance.
• Rice Design: This design uses an extra transmit chain in addition
to the main transmit chain. The extra chain generates a cancellation
signal that is combined with the signal on the receive chain to cancel
self interference. This design also uses two antennas and to make a
fair comparison we use a 20cm separation as the balun based design.
However we also provide results with 40cm separation since that
was the value used in the prior work. We implement this design
by using an extra signal generator as an extra transmit chain for
cancellation.
Note that our design uses a single antenna and therefore does not
have the beneﬁt of the 30dB of self interference reduction that prior
schemes enjoy from using two physically separate antennas.
5.1 Can we cancel all of the self interference?
The ﬁrst claim we made in this paper is that our design is capa-
ble of canceling all of the self interference for the latest operational
WiFi protocols. To investigate this assumption, we experimentally
test if we can fully cancel a 80MHz WiFi 802.11ac signal upto a max
transmit power of 20dBm (all of which are the standard parameters
used by WiFi APs), as well as the smaller bandwidths of 40MHz and
20MHz. We conduct the experiment by placing our full duplex radio
in different locations in our building. Further we increase the trans-
mit power from 4dBm to 20dBm (typical transmit power range). For
each TX power and location (in total 100) we conduct 20 runs and
compute the average cancellation across those runs and locations.
The goal is to show that we can cancel to the noise ﬂoor for a variety
Figure 6: Experimental set-up of our full duplex transceiver
lines of different ﬁxed lengths. The attenuators are programmable
step Peregrine PE43703 [17] attenuators which can be programmed
in steps of 0.25dB from 0 to 31.5dB for a total of 128 different val-
ues.
Radio Transceiver and Baseband: Our goal was to design and im-
plement a full duplex system that was capable of supporting the lat-
est WiFi protocol 802.11ac with least 80MHz of bandwidth in the
2.4GHz range and 20dBm average TX power. Unfortunately none
of the widely used software radios, such as USRPs or WARPs, sup-
port such high performance; at best they are capable of supporting
20MHz bandwidths. For that reason, we prototyped our design us-
ing radio test equipment from Rohde and Schwarz. For our trans-
mitter, we used a SMBV 100A vector signal generator [16] to send
our desired WiFi signals. Since the SMBV is not capable of generat-
ing 20dBm power, we use an external power ampliﬁer [18]. For the
receiver, we use the RS spectrum analyzer [15].
A practical concern is how to kick-start re-tuning of analog can-
cellation. Speciﬁcally if analog cancellation drops below a thresh-
old, then the receiver might get saturated and the feedback needed to
tune is distorted. To tackle this we implemented an AGC via a digital
tunable attenuator in front of the LNA. The idea is that if the base-
band detects that the receiver is getting saturated, then it programs
the attenuator to a large value which brigs the whole signal down to
within the dynamic range. After cancellation is tuned, this attenua-
tion is turned off. The FSW is capable of receiving 100MHz signals
at 2.45GHz, down-converting and digitizing it to baseband, and then
giving us access to the raw IQ samples, which we can then freely
process using our own baseband algorithms. The noise ﬂoor of this
receiver is -90dBm at 100MHz bandwidth. It has a 16 bit ADC ca-
pable of sampling a 100MHz signal, however to ensure that we are
only using resources found in commodity WiFi cards we conﬁgure
the ADC to only use 12 bits of resolution.
The IQ samples are transported via ethernet to a host PC, on which
we implement our cancellation and baseband software. We imple-
mented a full WiFi-OFDM PHY that can be conﬁgured to oper-
ate over all the standard WiFi bandwidths (20MHz, 40MHz, and
80MHz). We support all the WiFi constellations from BPSK to 64-
QAM for 40MHz, and 256 QAM for 80MHz. We also support all
the channel codes with coding rates (1/2, 2/3, 3/4 and 5/6 convolu-
tional coding). Finally we also implement our digital cancellation
algorithm in software on the same host PC.
However to show that our design is general and does not beneﬁt
from using expensive test equipment, we also develop an implemen-
tation using standard WARP radios. Due to their radio limitations,
these results will be for 20MHz signals which is the widest that the
WARP supports.
5. EVALUATION
382Figure 7: Cancellation and increase in noise ﬂoor vs TX power for different
cancellation techniques with transmission of WiFi 802.11 signal. Our full
duplex system can cancel to the noise ﬂoor standard WiFi signals of 20dBm
at highest WiFi bandwidth of 80MHz, while prior techniques still leave 25dB
of self interference residue, even for the narrower bandwidth of 40MHz.
Figure 8: Spectrum Response for our cancellation with the Rohde-Schwarz
(RS) radios and the WARP radios. The ﬁgure shows the amount of cancella-
tion achieved by different stages of our design. It also shows that our design
provides the same 110dB of cancellation even with WARP radios.
of transmit powers up to and including the max average TX power
of 20dBm. Fig. 7 plots the average cancellation as a function of TX
power.
It also plots the corresponding observed increase in noise
ﬂoor on the other axis.
Fig. 7 shows that our design essentially cancels the entire self in-
terference almost to the noise ﬂoor. In the standard case of 20dBm
transmit power, the noise ﬂoor is increased by at most 1dB over the
receiver noise ﬂoor. The amount of cancellation increases with in-
creasing TX power, reaching the required 110dB for the 20dBm TX
power. The takeaway is that as the TX power increases, self interfer-
ence increases at the same rate and we need a correspondingly larger
amount of cancellation, which our design provides.
PAPR: Note that these are average cancellation numbers, in practice
our WiFi transmissions exhibit transient PAPR as high as 10dB, so
the peak transmit power we see is around 30dBm. We do not report
the speciﬁc numbers for these due to lack of space, but our cancella-
tion system scales up and also cancels these temporary peaks in the
self interference signal to the noise ﬂoor.
The prior balun and Rice designs however fare far worse. Further,
since these designs perform very poorly at 80MHz, we only report
their results for the smaller 40MHz WiFi bandwidth and 20dBm TX
power. As we can see, these designs can at best provide 85dB and
80dB of cancellation respectively. In other words they increase the
noise ﬂoor by 25dB and 30dB respectively. The reasons for this
are the ones we discussed in Sec. 2.2, the inability to adequately
cancel transmitter noise in analog and the inability to model non-
linear distortions produced by radios. To check if these designs could
be made to work with larger antenna separation, we repeated the
experiment with an antenna separation of 40cm instead of 20cm. We
Figure 9: SNR loss vs half duplex SNR at ﬁxed TX power = 20 dBm, con-
stellation = 64 QAM, bandwidth = 80MHz with transmission of WiFi 802.11
signal. Our full duplex system ensures that the received signal suffers negli-
gible SNR loss regardless of the SNR it was received at.
found that even with an impractical rough half meter separation in
antennas, the noise ﬂoor increase is at least 20dB.
5.1.1 Does our design work with commodity radios?
We repeat the above experiment, but instead of the Rohde-Schwarz
test equipment, we use off-the-shelf WARP radios in the setup. The
goal is to show that our design can work with cheap commodity ra-
dios and does not depend on the precision of test equipment. Since
the widest bandwidth that the WARP can support is 20MHz, we only
report results for that bandwidth. Fig. 8 shows the spectrum plot of
canceled signals after different stages of cancellation. For compari-
son, we also plot the spectrum plot of cancellation using the Rohde-
Schwarz equipment.
As we can see, our cancellation completely eliminates self-interference
even with commodity WARP radios. The WARP has a worse noise
ﬂoor of −85dBm compared to the −90dBm of the RS equipment.
Hence if we used 20dBm transmit power, then a slightly smaller
105dB of self-interference cancellation is required to eliminate it to
the noise ﬂoor. However for consistency, for the WARP experiments
we increase the transmit power to 25dBm to show that our design can
still achieve 110dB of cancellation and eliminate self-interference to
the noise ﬂoor.
5.1.2
SNR loss of the Received Signal in Full Duplex
Mode
The previous section provided evidence for the amount of cancel-
lation and increase in noise ﬂoor. However the experiments had only
one radio transmitting. A natural question is how well does the sys-
tem work when we are in true full duplex mode, i.e.
the radio is
transmitting and simultaneously receiving a signal. In this section,
we evaluate the SNR loss for the received signal when operating in
full duplex mode.
The experiment is conducted as follows. We setup two nodes ca-
pable of full duplex operation in our building. The two nodes ﬁrst
send 20 WiFi packets (with the following PHY parameters: 80MHz
bandwidth, 20dBm TX power, 64QAM constellation) to each other
one after the other, i.e.
they take turns and operate in half duplex
mode. They then send 20 WiFi packets to each other simultaneously,
i.e. they operate in full duplex mode. For each run we measure the
average SNR of the received packets across the 20 packets in half
duplex mode, and then with full duplex mode. We then compute the
SNR loss which is deﬁned as the absolute difference between the av-
erage half duplex SNR and full duplex SNR measured above. We
repeat the experiment at several different locations of the two nodes
in our testbed. We plot the SNR loss as a function of the half duplex
SNR in Fig, 9.
As Fig. 9 shows the SNR loss is uncorrelated with the half duplex
SNR value and is almost identical to the increase in noise ﬂoor value
we saw in the previous experiment. The takeaway is that self inter-
Higher#is##be2er#Lower#is##be2er#0#5#10#15#20#25#30#35#0#5#10#15#20#25#Increase)in)Noise)Floor))(dB))TX)Power)(dBm))75#80#85#90#95#100#105#110#115#0#5#10#15#20#25#Cancella'on)(dB))TX)Power)(dBm))-110-90-70-50-30-1010302.412.432.452.472.49Power in dBm Freq in Ghz 80 Mhz (RS Platform)  62 dB 48 dB -100-85-70-55-40-25-105202.432.442.452.462.47Power in dBm Freq in Ghz 20 Mhz (WARP Platform) Tx SignalResidualSignalafter ACResidualSignalafter DCNoiseFloor72 dB 38 dB 00.511.52051015202530SNR Loss of Rx Signal (dB) SNR of Half Duplex Link (dB) Tx power  20 dBm 383Figure 10: Shows CDF of SNR loss with changing bandwidths and constel-
lations. Left: we see the SNR loss for different constellations with TX power
= 20 dBm and bandwidth = 80MHz. Right: we see the SNR loss for differ-
ent bandwidths (20 MHz, 40 MHz and 80 MHz) for TX power = 20 dBm
and constellation = 64 QAM. Observe we can support all WiFi modulation
schemes and bandwidths with low SNR loss.
ference cancellation is not impacted by the received signal’s strength,
whether it is weak or strong. Further, the SNR loss is typically
around or less than 1dB which implies that even in full duplex mode
the received signal should retain almost the same throughput as in
clean half duplex mode.
5.2 Digging Deeper
5.2.1 Impact of Constellation and Bandwidth
We conduct two experiments. First we use the same setup as the
SNR loss experiments and ﬁx the bandwidth to 80MHz, but vary the
constellation for the transmitted signal for the full duplex node from
QPSK to the densest constellation in WiFi 256-QAM. Once again we
calculate the SNR loss of the received signal across different mea-
surements and locations from the half duplex node. In the second
experiment we ﬁx the constellation to 64-QAM but vary the band-
width from 20 to 40 to 80MHz and once again calculate the SNR
loss of the received signal. We repeat this experiment for different
locations of the two nodes. Fig. 10 plot the CDFs of the SNR losses
for different choices of constellations and bandwidth.
As the ﬁgures show, our design performs consistently well for all
constellation choices and bandwidths. Our cancellation technique
makes no assumptions about what constellation and other param-
eters the PHY is using: for us all of them are a self interference
signal and hence the design is unaffected by constellation choice.
Our design also works equally well for all the bandwidths used by
802.11ac in the 2.4GHz band. The reason is that our analog cancel-
lation, as we will show in the next section, has sufﬁcient ﬂexibility
to provide an almost ﬂat wideband cancellation, while prior designs
are extremely narrow-band and cancellation tapers off quickly with
wider and wider bandwidths.
5.2.2 Deconstructing Analog Cancellation
In this section we dig deeper into the analog cancellation compo-
nent of our design. The key parameter in our analog cancellation cir-
cuit board is the number of ﬁxed delay lines as discussed in Sec. 3.1.
We conduct an experiment to examine the impact of the number of
such lines. However since these are circuit boards, we do not have
the ﬂexibility to vary the number of lines in increments of one. The
granularity of our board design allows us to only test two conﬁgura-
tions, one with 8 lines and one with 16 lines. We conduct the same
self interference cancellation experiment as described in Sec. 5. We
measure the signal after analog cancellation (without digital cancel-
lation) and plot the frequency response of the canceled signal for the
two cases in Fig. 11. The plot should be read as the power of the
self-interference signal after analog cancellation as a function of the
frequency.
As Fig. 11 shows, with 8 lines we can achieve 45dB of cancella-
tion over 80MHz, while we can achieve 63dB of cancellation with
Figure 11: Frequency domain representation of self interference before ana-
log cancellation and self interference after analog cancellation using 8 taps
and 16 taps. Note that with 16 taps we can provide at least 63 dB of analog
cancellation over the entire 80 MHz of bandwidth.
80MHz. The reason for the difference is the higher capability of 16
lines in canceling signal reﬂections in addition to the main self inter-
ference component that is leaking through the circulator. When the
full duplex node is transmitting, the response from the circulator and