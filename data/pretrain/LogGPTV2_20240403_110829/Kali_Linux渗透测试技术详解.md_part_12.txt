 Input datagrams
: 37878
#输入数据元
Delivered datagrams
:38486
#传输的数据元
Output datagrams
:16505
#输出数据元
以上信息显示了该目标系统中网络的相关信息，如默认TTL值、收到TCP段、发送
TCP段和重发TCP段等。
· 77 ·
---
## Page 90
第2篇信息的收集及利用
（7）获取网络接口信息，如接口状态、速率、IP地址和子网掩码等。结果如下所示：
[] Network interfaces
Interface
: [ up ] Software Loopback Interface 1
Interface Speed
: 1073.741824 Mbps
#接口速率
IP Address
: 127.0.0.1
#IP地址
Netmask
: 255.0.0.0
#子网掩码
MTU
: 1500
#最大传输单元
以上信息中显示了loopback接口的相关信息。包括它的速率、IP地址、子网掩码和最
大传输单元。
（8）获取路由信息，如目标地址、下一跳地址、子网掩码和路径长度值。结果如下所
示：
[] Routing information
Destination
Next Hop
Mask
Metric
0.0.0.0
192.168.41.2
0.0.0.0
10
127.0.0.1
127.0.0.1
255.255.255.255
306
127.255.255.255
127.0.0.1
255.255.255.255
306
192.168.41.0
192.168.41.138
255.255.255.0
266
192.168.41.138
192.168.41.138
255.255.255.255
266
192.168.41.255
192.168.41.138
255.255.255.255
266
224.0.0.0
127.0.0.1
240.0.0.0
306
以上信息表示目标系统的一个路由表信息。该路由表包括目的地址、下一跳地址、子
网掩码及路径长度值。
结果如下所示：
[]Network services
Application Experience
Background Intelligent Transfer Service
Base Filtering Engine
COM+ Event System
COM+ System Application
Computer Browser
Cryptographic Services
DCOM Server Process Launcher
DHCP Client
DNS Client
以上信息显示了目标主机中所安装的服务。由于篇幅的原因，只列出了一少部分服务。
（10）获取监听的TCP端口，如监听的TCP端口号有135、495149513和139等。结
果如下所示：
[] Listening TCP ports andconnections
· 78 ·
---
## Page 91
第4章
信息收集
Local Address
Port
Remote Address
Port
State
0.0.0.0
135
0.0.0.0
Listening
0.0.0.0
49152
0.0.0.0
Listening
0.0.0.0
49153
0.0.0.0
Listening
0.0.0.0
49154
0.0.0.0
Listening
0.0.0.0
49155
0.0.0.0
Listening
0.0.0.0
49156
0.0.0.0
Listening
0.0.0.0
49159
0.0.0.0
Listening
192.168.41.138
139
0.0.0.0
Listening
192.168.41.138
49241
192.168.41.1
139
Time wait
以上信息表示两台主机建立TCP连接后的信息。包括本地地址、本机端口、远程主机
地址、远程主机端口及连接状态。
（11）获取监听UDP端口信息，如监听的UDP端口有123、161、4500、500和5355
等。结果如下所示：
[*] Listening UDP ports
Local Address
Port
0.0.0.0
123
0.0.0.0
161
0.0.0.0
4500
0.0.0.0
500
0.0.0.0
5355
127.0.0.1
1900
127.0.0.1
51030
192.168.41.138
137
192.168.41.138
138
192.168.41.138
1900
以上信息表示目标主机中已开启的UDP端口号。
（12）获取软件组件信息，如VisualC++2008。显示结果如下所示：
[] Software components
1. Microsoft Visual C++ 2008 Redistributable - x86 9.0.30729.4148
以上信息表示该主机中安装了VisualC++2008类库。
（13）获取Web服务信息，如发送的字节数、文件数和当前匿名用户等。结果如下所
示：
[] Web server information
Total bytes sent low word
-
Total bytes received low word
:-
Total files sent
: -
Current anonymous users
:-
Current non anonymous users
-
Total anonymous users
: -
Total non anonymous users
: -
[*] Enumerated 192.168.41.138 in 0.64 seconds
Signal USR1 received in thread 1, but no signal handler set. at /usr/bin/snmpcheck line 230.
以上信息显示了关于Web服务的信息。最后显示了枚举主机192.168.41.138共用的时间。
· 79 ·
---
## Page 92
第2篇信息的收集及利用
4.1.5SMTP枚举工具smtp-user-enum
smtp-user-enum是针对SMTP服务器的25端口，进行用户名枚举的工具，用以探测服
务器已存在的邮箱账户。在SMTP服务上启动用户的SMTP枚举。执行命令如下所示：
root@kali:~# smtp-user-enum -M VRFY -U /tmp/users.txt -t 192.168.41.138
Starting smtp-user-enum v1.2 ( http://pentestmonkey.net/tools/smtp-user-enum )
Scan Information
.. VRFY
#SMTP枚举使用的模式
Worker Processes ...
.5
#运行进程数
Usernames file.......
/tmp/users.txt
#用户名文件
Target count..
.... 1
#目标账户数
Username count ...
... 2
#用户名账号数
Target TCP port .....
.. 25
#目标TCP端口
Query timeout ....
... 5 secs
#超时时间
Target domain .......
#目标域名
*ScansttartedatSatApr1916:07:042014#
#扫描启动时间
#扫描结束时间
O results
2 queries in 1 seconds (2.0 queries / sec)
输出的信息显示了扫描192.168.41.138主机的详细信息，包括模式、运行进程、用户
名文件、用户数和TCP端口等。
4.2测试网络范围
测试网络范围内的IP地址或域名也是渗透测试的一个重要部分。通过测试网络范围内
的IP地址或域名，确定是否有人入侵自己的网络中并损害系统。不少单位选择仅对局部IP
基础架构进行渗透测试，但从现在的安全形势来看，只有对整个IT基础架构进行测试才有
意义。这是因为在通常情况下，黑客只要在一个领域找到漏洞，就可以利用这个漏洞攻击
另外一个领域。在Kali中提供了DMitry和Scapy工具。其中，DMitry工具用来查询目标
网络中IP地址或域名信息：Scapy工具用来扫描网络及嗅探数据包。本节将介绍使用DMitry
和Scapy工具测试网络范围。
4.2.1域名查询工具DMitry
DMitry工具是用来查询IP或域名WHOIS信息的。WHOIS是用来查询域名是否已经
被注册及已经注册域名的详细信息的数据库（如域名所有人和域名注册商）。使用该工具
可以查到域名的注册商和过期时间等。下面将使用DMitry工具收集rzchina.net域名的信息。
执行命令如下所示：
root@kali:~# dmitry -wnpb rzchina.net
80 ·
---
## Page 93
第4章信息收集
Deepmagic Information Gathering Tool
"There be some deep magic going on"
HostIP:180.178.45.123
HostName:rzchina.net
Gathered Inic-whois information for rzchina.net
Domain Name: RZCHINA.NET
Registrar: BIZCN.COM, INC.
Whois Server: whois.bizcn.com
Referral URL: http://www.bizcn.com
Name Server: DNS1.BIZMOTO.COM
Name Server:DNS2.BIZMOTO.COM
Status: clientDeleteProhibited
Status: clientTransferProhibited
Updated Date: 18-apr-2013
Retrieving Netcraft.com information for rzchina.net
Netcraft.com Information gathered
Gathered TCP Port information for 180.178.45.123
Port
State
21/tcp
open
>> 220 Welcome
22/tcp
open
>>SSH-2.0-OpenSSH_4.3
25/tcp
>> 220 vhost78.myverydz.com ESMTP Postfix
open
80/tcp
uedo
110/tcp
open
>>+OK Hello there.
Portscan Finished: Scanned 150 ports, 135 ports were in state closed
All scans completed, exiting
输出的信息显示了rzchina.net域名的IP地址、WHOIS信息及开放的端口号等。执行
以上命令后输出的信息很多，但是由于篇幅的原因，部分内容使用省略号（..）代替。
虽然使用DMitry工具可以查看到IP或域名信息，但还是不能判断出这个网络范围。
因为一般的路由器和防火墙等并不支持IP地址范围的方式，所以工作中经常要把IP地址
转换成子网掩码的格式、CIDR格式和思科反向子网掩码格式等。在Linux中，netmask工
具可以在IP范围、子网掩码、CIDR和Cisco等格式中互相转换，并且提供了IP地址的点
分十进制、十六进制、八进制和二进制之间的互相转换。使用netmask工具将域名rzchina.net
转换成标准的子网掩码格式。执行命令如下所示：
root@kali:~# netmask -s rzchina.net
180.178.45.123/255.255.255.255
输出的信息显示了rzchina.net域名的IP地址和子网掩码值。
4.2.2跟踪路由工具Scapy
Scapy是一款强大的交互式数据包处理工具、数据包生成器、网络扫描器、网络发现
工具和包噢探工具。它提供多种类别的交互式生成数据包或数据包集合、对数据包进行操
作、发送数据包、包嗅探、应答和反馈匹配等功能。下面将介绍Scapy工具的使用。
• 81 *
---
## Page 94
第2篇信息的收集及利用
使用Scapy实现多行并行跟踪路由功能。具体操作步骤如下所示。
（1）启动Scapy工具。执行命令如下所示。
root@kali~#scapy
INFO: Can't import python gnuplot wrapper.Won't be able to plot.
WARNING:Noroute found for IPv6 destination :(no default route?)
Welcome to Scapy (2.2.0)
>>>
看到>>>提示符，表示scapy命令登录成功。
（2）使用sr0函数实现发送和接收数据包。执行命令如下所示：
>>> ans,unans=sr(IP(dst="www.rzchina.net/30",ttl=(1,6))/TCP())
Begin emission:
,****Finished to send 24 packets.
***************.
.C#Ct+C终止
Received 70 packets, got 19 answers, remaining 5 packets
执行以上命令后，会自动与www.rzchina.net建立连接。执行几分钟后，使用Ctrl+C
终止接收数据包。从输出的信息中可以看到收到70个数据包，得到19个响应包及保留了
5个包。
（3）以表的形式查看数据包发送情况。执行命令如下所示：
>>> ans.make_table(lambda(s,r):(s.dst,s.ttl,r.src))
执行以上命令后，输出如下所示的信息：
180.178.45.120 180.178.45.121 180.178.45.122 180.178.45.123
1192.168.41.2192.168.41.2
192.168.41.2192.168.41.2
2 180.178.45.120 -
180.178.45.122 180.178.45.123
3 180.178.45.120 -
180.178.45.122 180.178.45.123
4 180.178.45.120 -
180.178.45.122 180.178.45.123
5 180.178.45.120 -
180.178.45.122 180.178.45.123
6 180.178.45.120 -
180.178.45.122 180.178.45.123
输出的信息显示了该网络中的所有IP地址。
（4）使用scapy查看TCP路由跟踪信息。执行命令如下所示：
>>>
res,unans=traceroute(["www.google.com","www.kali.org","www.rzchina.net°],dport=[80,443],maxt
tl=20,retry=-2)
Begin emission:
***************
**************Finished to send 120 packets.
*.Finished to send 39 packets.
Begin emission:
Finished to send 38 packets.
Begin emission:
Finished to send 38 packets.
Received 84 packets, got 82 answers, remaining 38 packets
173.194.127.179:tcp443
173.194.127.179:tcp80
180.178.45.123:tcp443
180.178.45.123:tcp80 198.58.119.164:tcp443 198.58.119.164:tcp80
1
192.168.41.2
11
192.168.41.2
11
192.168.41.2
11
192.168.41.2
11
192.168.41.2
11
192.168.41.2
11
2
180.178.45.123
RA
180.178.45.123
SA
198.58.119.164
RA
198.58.119.164