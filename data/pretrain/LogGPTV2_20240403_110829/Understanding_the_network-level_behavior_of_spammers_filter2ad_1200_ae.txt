Withdrawal
.
2
8
m
o
r
f
m
a
p
S
d
n
a
,
s
l
a
w
a
r
d
h
t
i
W
,
s
t
n
e
m
e
c
n
u
o
n
n
A
22:00:00
05:00:00
12:00:00
19:00:00
02:00:00
09:00:00
16:00:00
2004/12/28
2004/12/29
2004/12/29
2004/12/29
2004/12/30
2004/12/30
2004/12/30
Time
Figure 10: Observation of a short-lived BGP route announcement for
82.0.0.0/8, spam arriving from mail relays in that preﬁx, and the
subsequent withdrawal of that preﬁx.
using this technique to send spam quite regularly. In fact, looking in
further detail at the several (preﬁx, AS) combinations, we observed
the following remarkable patterns:
• AS 21562, an Internet service provider (ISP) in Indianapolis,
Indiana (according to ra.net and arin.net), originated
routing announcements for 66.0.0.0/8.
• AS 8717, an ISP in Soﬁa, Bulgaria, originated announce-
ments for 82.0.0.0/8.
• In a third,
less persistent case, AS 4678, an ISP
in Japan, Canon Network Communications (according
to apnic.net), originated routing announcements for
61.0.0.0/8.
We were surprised that three of the most persistent preﬁxes in-
volved in short-lived BGP routing announcements were so large.
Although some short-lived routing announcements may be miscon-
ﬁgurations [15], the fact that these routing announcements contin-
ually appear, that they are for large address blocks, and that they
typically coincide with spam arrivals (as shown in Figure 9) raised
our suspicion about the veracity of these announcements. Indeed,
not only are these route announcements short-lived and hijacked,
but they are also for large address blocks. Although the use of large
address blocks might initially seem surprising, the distribution of
the IP addresses of hosts sending spam using this technique sug-
gests the following theory.
F
D
C
 1
 0.1
 0.01
 0.001
 0.0001
 1e-05
Spam Routes
All Routes
 1
 10
 100
 1000  10000 100000 1e+06  1e+07  1e+08
Epoch Length (seconds)
Figure 11: CDF of the length of each short-lived BGP episode, from
September 2005–December 2005.
Finding 6.1 (Spectrum Agility) A small, but persistent, group of
spammers appear to send spam by (1) advertising (in fact, hijack-
ing) large blocks of IP address space (i.e., /8s), (2) sending spam
from IP addresses that are scattered throughout that space, and
(3) withdrawing the route for the IP address space shortly after the
spam is sent.
We have called this technique “spectrum agility” because it al-
lows a spammer the ﬂexibility to use a wide variety of IP addresses
within a very large block from which to send spam. The large IP ad-
dress block allows the mail relays to “hop” between a large number
of IP addresses, thereby evading IP-based ﬁltering techniques like
DNSBLs. Judging from Figure 4 and our analysis in Section 4.2,
the technique seems to be rather effective. As an added beneﬁt,
route announcements for shorter IP preﬁxes (i.e., larger blocks of
IP addresses) are less likely to be blocked by ISPs’ route ﬁlters than
route announcements or hijacks for longer preﬁxes.
Upon further inspection, we also discovered the following in-
teresting features: (1) the IP addresses of the mail relays send-
ing this spam are widely distributed across the IP address space;
(2) the IP addresses from which we see spam in this address space
typically appear only once; (3) on February 6, 2006, attempts to
contact the mail relays that we observed using this technique re-
vealed that that roughly 60-80% of these hosts were not reachable
by traceroute; (4) many of the IP addresses of these mail relays
were located in allocated, albeit unannounced and unused IP ad-
dress space; and (5) many of the AS paths for these announcements
contained reserved (i.e., to-date unallocated AS numbers), suggest-
ing a possible attempt to further hamper traceability by forging ele-
ments of the AS path. We are at a loss to explain certain aspects of
this behavior, such as why some of the machines appear to have IP
addresses from allocated space, when it would be simpler to “step
around” the allocated preﬁx blocks, but, needless to say, the spam-
mers using this technique appear to be very sophisticated.
Whether spammers are increasingly using this technique is in-
conclusive. Still, many of the ASes that send the most spam with
this technique also appear to be relative newcomers. Variants of this
type of technique may be used in the future to make it more difﬁcult
to track and blacklist spamming hosts, particularly since the tech-
nique allows a spammer to relatively undetectably commandeer a
very large number of IP addresses.
6.2 Prevalence of BGP Spectrum Agility
Because of the volume of data and the relatively high cost of
performing longest-preﬁx match queries, we performed a more ex-
tensive analysis on a subset of our trace, from September 2005
till December 2005, to detect the fraction of spam coming from
short-lived announcements and to determine a reasonable thresh-
old for studying short-lived announcements across the entire trace.
Figure 11 shows that, for all of the IP addresses for which we re-
ceived spam over the course of these four months, almost 99% of
the corresponding BGP routing announcements were announced
continuously for at least a day. In other words, most of the received
spam corresponded to routing advertisements that were not short-
lived. On the other hand, this technique appears to be used intermit-
tently, and during time periods when this activity was more preva-
lent, as much as 10% of all received spam coincides with routing
announcements that lasted less than a day.
Finding 6.2 (Prevalence: Spam from Short-Lived Routes)
Only about 1% of spam was received from route that persisted
for less than a single day, although during intervals when this
technique was used more commonly, as much as 10% of all spam
coincided with routes that lasted less than a day.
Unfortunately for traditional ﬁltering techniques, the spammers
who are the most persistent across time are, for the most part, not
the spammers who send the most spam using this technique. In-
deed, only two ASes—AS 4788 (Telekom Malaysia) and AS 4678
(Canon Network Communications, in Japan)—appear among both
the top-10 most persistent and most voluminous spammers using
short-lived BGP routing announcements.
6.3 How Much Spam from Spectrum Agility?
A comparatively small fraction of spam originates from IP ad-
dresses that correspond to short-lived BGP route announcements
(i.e., routing announcements that persist for less than a day) that
coincide with spam arrival. The total amount of spam received as a
result of this technique seems to pale in comparison to other tech-
niques: no more than 10% of all spam—and more likely as little as
1%—appears to be sent using this technique. Although this tech-
nique is not apparent for most of the spam we receive (after all, a
botnet makes traceability difﬁcult enough), the few groups of spam-
mers that employ this technique typically use it quite regularly. We
also observed that many of the ASes using this technique for the
longest period of time do not, in fact, rely on this technique for
sending most of their spam. Even the most proliﬁc spamming AS
in this group, Malaysia Telekom, appears to send only about 15%
of their spam in this fashion.
Finding 6.3 (Persistence vs. Volume) The ASes
from where
spammers most continually use short-lived route announcements
to send spam are not the same ASes from which the most spam
originates via this technique.
Many ASes that advertise short-lived BGP routing announce-
ments and send large volumes of spam from these routes do not
appear to be hijacking IP preﬁxes. In the case where spam volume
is high, these short-lived routing announcements may simply coin-
cide with spam being sent via another means (e.g., from a botnet).
The ASes that persistently advertise short preﬁxes, however, appear
to be doing so intentionally.
7. Lessons for Better Spam Mitigation
Existing spam mitigation techniques have focused on either
throttling senders (e.g., recent attention has focused on cost-based
schemes [9, 11]) or having receivers ﬁlter spam according to the
content of a message. The results of this paper, however, highlight
several important lessons that strongly indicate that devoting more
attention to the network-level properties of spammers that may
be a useful addition to today’s spam mitigation techniques. Using
network-level information to help mitigate spam not only provides
a veritable font of new features for spam ﬁlters, but network-level
properties have two important properties that could potentially lead
to more robust ﬁltering.
1. Network-level properties are less malleable than those based
on an email’s contents.
2. Network-level properties may be observable in the middle of
the network, or closer to the source of the spam, which may
allow spam to be quarantined or disposed of before it ever
reaches a destination mail server.
From our ﬁndings, we derive the following lessons regarding the
network-level behavior of spammers that could help in designing
better mitigation techniques.
Lesson 1 Spam ﬁltering requires a better notion of host identity.
We observed a signiﬁcant amount of spam from “one-shot” bots
and spammers using spectrum agility. Short-lived bots, short-lived
BGP route hijacks, and dynamic addressing effects foil the com-
mon practice of using a host’s IP address as its identity.
Lesson 2 Detection techniques based on aggregate behavior are
more likely to expose nefarious behavior than techniques based on
observations of a single IP address.
Although comprehensive IP-based blacklisting is somewhat effec-
tive, blacklisting techniques may also beneﬁt by exploiting other
network-level properties such as IP address ranges, some of which
(e.g., 80.*–90.*) send mostly spam.
Lesson 3 Securing the Internet routing infrastructure is a neces-
sary step for bolstering identity and traceability of email senders.
Although BGP spectrum agility is by no means responsible for
most received spam, several characteristics make the technique ex-
tremely troubling. Most notably, the technique can be combined
with other spamming techniques (possibly even spamming with
botnets) to give spammers more agility in evading IP-based black-
lists. Indeed, our analysis of DNSBLs indicates that spammers may
already be doing this. A routing infrastructure that instead pro-
vided protection against route hijacking (speciﬁcally, unauthorized
announcement of IP address blocks) would make BGP spectrum
agility attacks more difﬁcult to mount.
Lesson 4 Some network-level properties of spam can be incorpo-
rated relatively easily into spam ﬁlters and may be quite effective
at detecting spam that is missed by other techniques.
Although the BGP spectrum agility attack is particularly wily—and
effective against DNSBLs—incorporating additional network-level
features into spam ﬁltering software such as “recently announced
BGP announcement” should prove remarkably effective at quench-
ing this attack.
Given the beneﬁts that network-wide analysis could provide for
stemming spam, we imagine that the ability to witness the network-
level behavior of spammers across multiple distinct domains could
also expose patterns that are not evident from a single domain. One
organization might be able amass such a dataset either by sinkhol-
ing a large number of domains; for example, Project Honeypot [23]
solicits donations of MX records for registered domains that do not
receive email (though its corpus is still signiﬁcantly smaller than
ours). As we have discovered thus far from our initial experiences
establishing new sinkholes, attracting spam to a new domain takes
some effort (we found some amusement in the difﬁculty of attract-
ing spam when we actually wanted to receive it). In addition to us-
ing sinkholes, network operators might share network-level statis-
tics of received email from real network domains to pre-emptively
detect and ﬁlter spamming hosts.
8. Conclusion
This paper has studied the network-level behavior of spammers
using a joint analysis of a unique combination of datasets—a 17-
month-long trace of all spam sent to a single domain with real-time
traceroutes, passive TCP ﬁngerprints, and DNSBL lookup results;
BGP routing announcements for the network where the sinkholes
are located; command and control traces from the Bobax spamming
botnet; and mail logs from a large commercial email provider.
This analysis allowed us to study some new and interesting ques-
tions that should guide the design of better spam ﬁlters in the fu-
ture, based on the lessons in Section 7. We studied network-level
behavior of spammers and compared these characteristics to those
of legitimate email, noting some differences that could help identify
spammers by IP address space or AS. We also used “ground truth”
Bobax drones to better understand the characteristics of spamming
botnets, and we found that most of these drones do not appear to re-
visit the same domain twice. While this property does not appear to
hamper the use of blacklists for identifying bots (emphasizing the
beneﬁts of collaborative spam ﬁltering), we found that blacklists
were remarkably ineffective at detecting spamming relays that sent
spam from IP addresses scattered throughout a brieﬂy announced
(and typically hijacked) IP address block—a new technique we call
“BGP spectrum agility”. This technique is lethal because it makes
traceability and blacklisting signiﬁcantly more difﬁcult. Spam ﬁl-
ters that incorporate network-level behavior could not only mitigate
this class of attack and many others, but they could also prove to be
more resistant to evasion than content-based ﬁlters.
Acknowledgments
We thank David Mazi`eres, David Dagon, and Suresh Ramasubra-
manian, whose traces made this study possible. We are also grateful
to David Mazi`eres for supporting Mail Avenger, to Hari Balakrish-
nan for inspirational discussions and the use of physical resources
at MIT, and to David Andersen, Randy Bush, Wenke Lee, Vern Pax-
son, Michael Walﬁsh, the anonymous reviewers, and our shepherd,
Adrian Perrig, for helpful feedback. Finally, we thank the Datapos-
itory project and Emulab for providing resources that we used in
our analysis.
REFERENCES
[1] D. Bank and R. Richmond. Where the Dangers Are. The Wall Street
Journal, July 2005. http://online.wsj.com/public/
article/
SB112128442038984802-w4qR772hjUeqGT2W0FIcA3
FNjE 20060717.html.
[2] M. Casado, T. Garﬁnkel, W. Cui, V. Paxson, and S. Savage.
Opportunistic measurement: Extracting insight from spurious trafﬁc.
In Proc. 4th ACM Workshop on Hot Topics in Networks (Hotnets-IV),
College Park, MD, Nov. 2005.
[3] CNN Technology News. Expert: Botnets No. 1 emerging Internet
threat. http://www.cnn.com/2006/TECH/internet/01/
31/furst/, Jan. 2006.
[4] Description of coordinated spamming, Feb. 2005. http://www.
waltdnes.org/spam.
[5] J. Evers. Most spam still coming from the U.S. http://news.
com.com/Most+spam+still+coming+from+the+U.S./
2100-1029 3-6030758.html, Jan. 2006.
[6] N. Feamster. Open problems in BGP anomaly detection. In CAIDA
Workshop on Internet Signal Processing, San Diego, CA, Nov. 2004.
[7] N. Feamster, D. Andersen, H. Balakrishnan, and M. F. Kaashoek.
Measuring the Effects of Internet Path Faults on Reactive Routing. In
Proc. ACM SIGMETRICS, pages 126–137, San Diego, CA, June
2003.
[8] N. Feamster, J. Jung, and H. Balakrishnan. An Empirical Study of
“Bogon” Route Advertisements. ACM Computer Communications
Review, 35(1):63–70, Nov. 2004.
[9] Goodmail Systems, 2006. http://www.goodmailsystems.
com/.
[10] J. Goodman. IP Addresses in Email Clients. In First Conference on
Email and Anti-Spam, Mountain View, CA, July 2004.
[11] S. Hansell. Postage is due for companies sending email, February 5,
2006. http://www.nytimes.com/2006/02/05/
technology/05AOL.html.
[12] Honeynet Project. Know Your Enemy: Tracking Botnets. http://
www.honeynet.org/papers/bots/botnet-commands.
html, 2006.
[13] J. Jung and E. Sit. An Empirical Study of Spam Trafﬁc and the Use
of DNS Black Lists. In Proc. ACM SIGCOMM Internet Measurement
Conference, pages 370–375, Taormina, Sicily, Italy, Oct. 2004.
[14] A. Kumar, V. Paxson, and N. Weaver. Exploiting Underlying
Structure for Detailed Reconstruction of an Internet-scale Event. In
Proc. ACM SIGCOMM Internet Measurement Conference, Berkeley,
CA, Oct. 2005.
[15] R. Mahajan, D. Wetherall, and T. Anderson. Understanding BGP
Misconﬁguration. In Proc. ACM SIGCOMM, pages 3–17, Pittsburgh,
PA, Aug. 2002.
[16] MailAvenger, 2005. http://www.mailavenger.org/.
[17] J. Mason. Spam Forensics: Reverse-Engineering Spammer Tactics.
http://spamassassin.apache.org/presentations/
2004-09-Toorcon/html/, Sept. 2004.
[18] Microsoft security bulletin ms04-011. http://www.
microsoft.com/technet/security/bulletin/
ms04-011.mspx, Apr. 2004.
[19] D. Moore, C. Shannon, and J. Brown. Code-red: A case study on the
spread and victims of an internet worm. In Proc. ACM SIGCOMM
Internet Measurement Workshop, Marseille, France, Nov. 2002.
[20] Operating System Market Shares. http://marketshare.
hitslink.com/report.aspx?qprid=2, Jan. 2006.
[21] The Open Relay Database, 2006. http://ordb.org/.
[22] M. Prince, B. Dahl, L. Holloway, A. Keller, and E. Langheinrich.
Understanding How Spammers Steal Your E-Mail Address: An
Analysis of the First Six Months of Data from Project Honey Pot. In
Second Conference on Email and Anti-Spam, Stanford, CA, July
2005.
[23] Project Honey Pot. http://www.projecthoneypot.org/.
[24] A. Ramachandran and N. Feamster. Understanding the
Network-Level Behavior of Spammers. Technical Report
GT-CSS-2006-001, Georgia Tech, Feb. 2006.
[25] S. Ramasubramanian. Port 25 ﬁlters - how many here deploy them
bidirectionally? http://www.merit.edu/mail.archives/
nanog/2005-01/msg00127.html, Jan. 2005.
[26] The Spam and Open Relay Blocking System (SORBS), 2006.
http://www.sorbs.net/.
[27] SpamAssassin, 2005. http://www.spamassassin.org/.
[28] Spammer-X. Inside the Spam Cartel. Syngress, Nov 2004.
[29] S. Staniford, V. Paxson, and N. Weaver. How to 0wn the Internet in
Your Spare Time. In Proc. 11th USENIX Security Symposium, San
Francisco, CA, Aug. 2002.
[30] J. Todd. AS number inconsistencies, July 2002. http://www.
merit.edu/mail.archives/nanog/2002-07/
msg00259.html.
[31] ZDNet Security News. Most spam genrated by botnets, expert says.
http://news.zdnet.co.uk/internet/security/0,
39020375,39167561,00.htm, Sept. 2004.