Database Compatibility for Oracle®
Developers Built-in Package Guide
EDB Postgres™ Advanced Server 11
February 11, 2019
Database Compatibility for Oracle® Developers
Built-in Package Guide
by EnterpriseDB® Corporation
Copyright © 2007 - 2019 EnterpriseDB Corporation. All rights reserved.
EnterpriseDB Corporation, 34 Crosby Drive, Suite 201, Bedford, MA 01730, USA
T +1 781 357 3390 F +1 978 467 1307 E PI:EMAIL www.enterprisedb.com
Database Compatibility for Oracle® Developers
Built-in Package Guide
Table of Contents
1 Introduction ........................................................................................................................... 8
1.1 What’s New .................................................................................................................... 9
1.2 Typographical Conventions Used in this Guide .................................................................... 9
2 Packages ............................................................................................................................. 10
2.1 Package Components ..................................................................................................... 10
2.1.1 Package Specification Syntax ................................................................................... 11
2.1.2 Package Body Syntax .............................................................................................. 15
2.2 Creating Packages.......................................................................................................... 21
2.2.1 Creating the Package Specification............................................................................ 21
2.2.2 Creating the Package Body ...................................................................................... 21
2.3 Referencing a Package.................................................................................................... 24
2.4 Using Packages With User Defined Types......................................................................... 25
2.5 Dropping a Package ....................................................................................................... 29
3 Built-In Packages.................................................................................................................. 30
3.1 DBMS_ALERT............................................................................................................. 31
3.1.1 REGISTER............................................................................................................ 32
3.1.2 REMOVE.............................................................................................................. 32
3.1.3 REMOVEALL ....................................................................................................... 33
3.1.4 SIGNAL................................................................................................................ 33
3.1.5 WAITANY............................................................................................................ 33
3.1.6 WAITONE ............................................................................................................ 35
3.1.7 Comprehensive Example ......................................................................................... 36
3.2 DBMS_AQ................................................................................................................... 39
3.2.1 ENQUEUE ............................................................................................................ 40
3.2.2 DEQUEUE ............................................................................................................ 43
3.2.3 REGISTER............................................................................................................ 47
3.2.4 UNREGISTER....................................................................................................... 48
3.3 DBMS_AQADM........................................................................................................... 50
3.3.1 ALTER_QUEUE.................................................................................................... 51
3.3.2 ALTER_QUEUE_TABLE....................................................................................... 52
3.3.3 CREATE_QUEUE ................................................................................................. 53
3.3.4 CREATE_QUEUE_TABLE .................................................................................... 55
3.3.5 DROP_QUEUE...................................................................................................... 57
3.3.6 DROP_QUEUE_TABLE......................................................................................... 58
3.3.7 PURGE_QUEUE_TABLE....................................................................................... 59
3.3.8 START_QUEUE .................................................................................................... 60
3.3.9 STOP_QUEUE ...................................................................................................... 60
3.4 DBMS_CRYPTO .......................................................................................................... 62
3.4.1 DECRYPT............................................................................................................. 63
3.4.2 ENCRYPT............................................................................................................. 65
3.4.3 HASH ................................................................................................................... 67
3.4.4 MAC .................................................................................................................... 67
3.4.5 RANDOMBYTES .................................................................................................. 68
3.4.6 RANDOMINTEGER .............................................................................................. 69
3.4.7 RANDOMNUMBER .............................................................................................. 70
3.5 DBMS_JOB.................................................................................................................. 71
3.5.1 BROKEN .............................................................................................................. 72
3.5.2 CHANGE .............................................................................................................. 73
3.5.3 INTERVAL ........................................................................................................... 74
3.5.4 NEXT_DATE ........................................................................................................ 74
3.5.5 REMOVE.............................................................................................................. 75
3.5.6 RUN ..................................................................................................................... 75
Copyright © 2007 - 2019 EnterpriseDB Corporation. All rights reserved. 3
Database Compatibility for Oracle® Developers
Built-in Package Guide
3.5.7 SUBMIT ............................................................................................................... 76
3.5.8 WHAT .................................................................................................................. 77
3.6 DBMS_LOB................................................................................................................. 79
3.6.1 APPEND ............................................................................................................... 80
3.6.2 COMPARE............................................................................................................ 80
3.6.3 CONVERTTOBLOB .............................................................................................. 81
3.6.4 CONVERTTOCLOB .............................................................................................. 83
3.6.5 COPY ................................................................................................................... 84
3.6.6 ERASE ................................................................................................................. 85
3.6.7 GET_STORAGE_LIMIT ........................................................................................ 86
3.6.8 GETLENGTH........................................................................................................ 86
3.6.9 INSTR .................................................................................................................. 86
3.6.10 READ ................................................................................................................... 87
3.6.11 SUBSTR ............................................................................................................... 88
3.6.12 TRIM.................................................................................................................... 89
3.6.13 WRITE ................................................................................................................. 89
3.6.14 WRITEAPPEND .................................................................................................... 90
3.7 DBMS_LOCK .............................................................................................................. 91
3.7.1 SLEEP .................................................................................................................. 91
3.8 DBMS_MVIEW............................................................................................................ 92
3.8.1 GET_MV_DEPENDENCIES................................................................................... 93
3.8.2 REFRESH ............................................................................................................. 93
3.8.3 REFRESH_ALL_MVIEWS..................................................................................... 95
3.8.4 REFRESH_DEPENDENT ....................................................................................... 97
3.9 DBMS_OUTPUT .......................................................................................................... 99
3.9.1 CHARARR............................................................................................................ 99
3.9.2 DISABLE.............................................................................................................. 99
3.9.3 ENABLE..............................................................................................................100
3.9.4 GET_LINE ...........................................................................................................101
3.9.5 GET_LINES .........................................................................................................103
3.9.6 NEW_LINE..........................................................................................................104
3.9.7 PUT.....................................................................................................................104
3.9.8 PUT_LINE ...........................................................................................................105
3.9.9 SERVEROUTPUT ................................................................................................106
3.10 DBMS_PIPE................................................................................................................108
3.10.1 CREATE_PIPE .....................................................................................................109
3.10.2 NEXT_ITEM_TYPE .............................................................................................110
3.10.3 PACK_MESSAGE ................................................................................................112
3.10.4 PURGE ................................................................................................................112
3.10.5 RECEIVE_MESSAGE...........................................................................................114
3.10.6 REMOVE_PIPE....................................................................................................114
3.10.7 RESET_BUFFER ..................................................................................................116
3.10.8 SEND_MESSAGE ................................................................................................117
3.10.9 UNIQUE_SESSION_NAME ..................................................................................118
3.10.10 UNPACK_MESSAGE .......................................................................................118
3.10.11 Comprehensive Example ....................................................................................119
3.11 DBMS_PROFILER ......................................................................................................122
3.11.1 FLUSH_DATA .....................................................................................................122
3.11.2 GET_VERSION....................................................................................................123
3.11.3 INTERNAL_VERSION_CHECK............................................................................123
3.11.4 PAUSE_PROFILER ..............................................................................................124
3.11.5 RESUME_PROFILER ...........................................................................................124
3.11.6 START_PROFILER ..............................................................................................124
3.11.7 STOP_PROFILER.................................................................................................125
3.11.8 Using DBMS_PROFILER ......................................................................................126
3.11.8.1 Querying the DBMS_PROFILER Tables and View............................................128
Copyright © 2007 - 2019 EnterpriseDB Corporation. All rights reserved. 4
Database Compatibility for Oracle® Developers
Built-in Package Guide
3.11.8.2 DBMS_PROFILER - Reference ......................................................................135
3.11.8.2.1 PLSQL_PROFILER_RUNS .......................................................................135
3.11.8.2.2 PLSQL_PROFILER_UNITS ......................................................................135
3.11.8.2.3 PLSQL_PROFILER_DATA .......................................................................136
3.11.8.2.4 PLSQL_PROFILER_RAWDATA...............................................................136
3.12 DBMS_RANDOM .......................................................................................................143
3.12.1 INITIALIZE .........................................................................................................143
3.12.2 NORMAL ............................................................................................................144
3.12.3 RANDOM ............................................................................................................144
3.12.4 SEED...................................................................................................................145
3.12.5 SEED...................................................................................................................145
3.12.6 STRING...............................................................................................................146
3.12.7 TERMINATE .......................................................................................................146
3.12.8 VALUE................................................................................................................147
3.12.9 VALUE................................................................................................................147
3.13 DBMS_REDACT .........................................................................................................149
3.13.1 Using DBMS_REDACT Constants and Function Parameters.......................................150
3.13.2 ADD_POLICY......................................................................................................158
3.13.3 ALTER_POLICY ..................................................................................................162
3.13.4 DISABLE_POLICY ..............................................................................................165
3.13.5 ENABLE_POLICY ...............................................................................................166
3.13.6 DROP_POLICY....................................................................................................167
3.13.7 UPDATE_FULL_REDACTION_VALUES ..............................................................168
3.14 DBMS_RLS ................................................................................................................171
3.14.1 ADD_POLICY......................................................................................................174
3.14.2 DROP_POLICY....................................................................................................181
3.14.3 ENABLE_POLICY ...............................................................................................182
3.15 DBMS_SCHEDULER ..................................................................................................183
3.15.1 Using Calendar Syntax to Specify a Repeating Interval ...............................................185
3.15.2 CREATE_JOB ......................................................................................................187
3.15.3 CREATE_PROGRAM ...........................................................................................190
3.15.4 CREATE_SCHEDULE ..........................................................................................192
3.15.5 DEFINE_PROGRAM_ARGUMENT.......................................................................194
3.15.6 DISABLE.............................................................................................................196
3.15.7 DROP_JOB ..........................................................................................................197
3.15.8 DROP_PROGRAM ...............................................................................................198
3.15.9 DROP_PROGRAM_ARGUMENT..........................................................................199
3.15.10 DROP_SCHEDULE ..........................................................................................200
3.15.11 ENABLE..........................................................................................................201
3.15.12 EVALUATE_CALENDAR_STRING ..................................................................202
3.15.13 RUN_JOB ........................................................................................................204
3.15.14 SET_JOB_ARGUMENT_VALUE ......................................................................205
3.16 DBMS_SESSION.........................................................................................................207
3.16.1 SET_ROLE ..........................................................................................................207
3.17 DBMS_SQL ................................................................................................................208
3.17.1 BIND_VARIABLE................................................................................................210
3.17.2 BIND_VARIABLE_CHAR ....................................................................................212
3.17.3 BIND VARIABLE RAW .......................................................................................213
3.17.4 CLOSE_CURSOR.................................................................................................214
3.17.5 COLUMN_VALUE...............................................................................................215
3.17.6 COLUMN_VALUE_CHAR ...................................................................................217
3.17.7 COLUMN VALUE RAW.......................................................................................218
3.17.8 DEFINE_COLUMN ..............................................................................................219
3.17.9 DEFINE_COLUMN_CHAR ...................................................................................221
3.17.10 DEFINE COLUMN RAW ..................................................................................222
3.17.11 DESCRIBE COLUMNS.....................................................................................223
Copyright © 2007 - 2019 EnterpriseDB Corporation. All rights reserved. 5
Database Compatibility for Oracle® Developers
Built-in Package Guide
3.17.12 EXECUTE........................................................................................................224
3.17.13 EXECUTE_AND_FETCH..................................................................................225
3.17.14 FETCH_ROWS.................................................................................................227
3.17.15 IS_OPEN .........................................................................................................229
3.17.16 LAST_ROW_COUNT .......................................................................................230
3.17.17 OPEN_CURSOR...............................................................................................232
3.17.18 PARSE.............................................................................................................233
3.18 DBMS_UTILITY .........................................................................................................235
3.18.1 LNAME_ARRAY .................................................................................................236
3.18.2 UNCL_ARRAY ....................................................................................................236
3.18.3 ANALYZE_DATABASE, ANALYZE SCHEMA and ANALYZE PART_OBJECT ......237
3.18.4 CANONICALIZE..................................................................................................240
3.18.5 COMMA_TO_TABLE...........................................................................................242
3.18.6 DB_VERSION......................................................................................................244
3.18.7 EXEC_DDL_STATEMENT ...................................................................................245
3.18.8 FORMAT_CALL_STACK .....................................................................................246
3.18.9 GET_CPU_TIME ..................................................................................................247
3.18.10 GET_DEPENDENCY........................................................................................248
3.18.11 GET_HASH_VALUE ........................................................................................249
3.18.12 GET_PARAMETER_VALUE ............................................................................251
3.18.13 GET_TIME ......................................................................................................252
3.18.14 NAME_TOKENIZE ..........................................................................................253
3.18.15 TABLE_TO_COMMA.......................................................................................256
3.19 UTL_ENCODE............................................................................................................258
3.19.1 BASE64_DECODE ...............................................................................................258
3.19.2 BASE64_ENCODE ...............................................................................................259
3.19.3 MIMEHEADER_DECODE ....................................................................................260
3.19.4 MIMEHEADER_ENCODE ....................................................................................261
3.19.5 QUOTED_PRINTABLE_DECODE ........................................................................262
3.19.6 QUOTED_PRINTABLE_ENCODE ........................................................................263
3.19.7 TEXT_DECODE...................................................................................................264
3.19.8 TEXT_ENCODE...................................................................................................265
3.19.9 UUDECODE ........................................................................................................266
3.19.10 UUENCODE ....................................................................................................267
3.20 UTL_FILE...................................................................................................................270
3.20.1 Setting File Permissions with utl_file.umask..............................................................271
3.20.2 FCLOSE ..............................................................................................................273
3.20.3 FCLOSE_ALL ......................................................................................................273
3.20.4 FCOPY ................................................................................................................273
3.20.5 FFLUSH ..............................................................................................................275
3.20.6 FOPEN ................................................................................................................276
3.20.7 FREMOVE...........................................................................................................277
3.20.8 FRENAME...........................................................................................................277
3.20.9 GET_LINE ...........................................................................................................279
3.20.10 IS_OPEN .........................................................................................................280
3.20.11 NEW_LINE......................................................................................................281
3.20.12 PUT.................................................................................................................282
3.20.13 PUT_LINE .......................................................................................................284
3.20.14 PUTF ...............................................................................................................285
3.21 UTL_HTTP .................................................................................................................287
3.21.1 HTML_PIECES ....................................................................................................290
3.21.2 REQ ....................................................................................................................290
3.21.3 RESP ...................................................................................................................290
3.21.4 BEGIN_REQUEST ...............................................................................................291
3.21.5 END_REQUEST ...................................................................................................291
3.21.6 END_RESPONSE .................................................................................................292
Copyright © 2007 - 2019 EnterpriseDB Corporation. All rights reserved. 6
Database Compatibility for Oracle® Developers
Built-in Package Guide
3.21.7 GET_BODY_CHARSET .......................................................................................292
3.21.8 GET_FOLLOW_REDIRECT..................................................................................293
3.21.9 GET_HEADER.....................................................................................................293
3.21.10 GET_HEADER_BY_NAME ..............................................................................295
3.21.11 GET_HEADER_COUNT ...................................................................................296
3.21.12 GET_RESPONSE .............................................................................................296
3.21.13 GET_RESPONSE_ERROR_CHECK...................................................................296
3.21.14 GET_TRANSFER_TIMEOUT............................................................................297
3.21.15 READ_LINE ....................................................................................................297
3.21.16 READ_RAW ....................................................................................................299
3.21.17 READ_TEXT ...................................................................................................300
3.21.18 REQUEST........................................................................................................301
3.21.19 REQUEST_PIECES ..........................................................................................301
3.21.20 SET_BODY_CHARSET ....................................................................................302
3.21.21 SET_FOLLOW_REDIRECT ..............................................................................302
3.21.22 SET_HEADER .................................................................................................303
3.21.23 SET_RESPONSE_ERROR_CHECK ...................................................................303
3.21.24 SET_TRANSFER_TIMEOUT ............................................................................304
3.21.25 WRITE_LINE...................................................................................................304
3.21.26 WRITE_RAW...................................................................................................305
3.21.27 WRITE_TEXT..................................................................................................306
3.22 UTL_MAIL .................................................................................................................308
3.22.1 SEND ..................................................................................................................308
3.22.2 SEND_ATTACH_RAW.........................................................................................309
3.22.3 SEND_ATTACH_VARCHAR2 ..............................................................................311
3.23 UTL_RAW..................................................................................................................313
3.23.1 CAST_TO_RAW ..................................................................................................313
3.23.2 CAST_TO_VARCHAR2........................................................................................314
3.23.3 CONCAT .............................................................................................................315
3.23.4 CONVERT ...........................................................................................................315
3.23.5 LENGTH .............................................................................................................316
3.23.6 SUBSTR ..............................................................................................................317
3.24 UTL_SMTP.................................................................................................................319
3.24.1 CONNECTION.....................................................................................................320
3.24.2 REPLY/REPLIES..................................................................................................320
3.24.3 CLOSE_DATA .....................................................................................................320
3.24.4 COMMAND.........................................................................................................321
3.24.5 COMMAND_REPLIES .........................................................................................321
3.24.6 DATA..................................................................................................................322
3.24.7 EHLO ..................................................................................................................322
3.24.8 HELO ..................................................................................................................323
3.24.9 HELP...................................................................................................................323
3.24.10 MAIL ..............................................................................................................324
3.24.11 NOOP ..............................................................................................................324
3.24.12 OPEN_CONNECTION ......................................................................................325
3.24.13 OPEN_DATA ...................................................................................................325
3.24.14 QUIT ...............................................................................................................326
3.24.15 RCPT...............................................................................................................326
3.24.16 RSET ...............................................................................................................326
3.24.17 VRFY ..............................................................................................................327
3.24.18 WRITE_DATA .................................................................................................327
3.24.19 Comprehensive Example ....................................................................................328
3.25 UTL_URL ...................................................................................................................330
3.25.1 ESCAPE ..............................................................................................................330
3.25.2 UNESCAPE .........................................................................................................332
4 Acknowledgements..............................................................................................................334
Copyright © 2007 - 2019 EnterpriseDB Corporation. All rights reserved. 7
Database Compatibility for Oracle® Developers
Built-in Package Guide
1 Introduction
Database Compatibility for Oracle means that an application runs in an Oracle
environment as well as in the EDB Postgres Advanced Server (Advanced Server)
environment with minimal or no changes to the application code. This guide focuses
solely on the features that are related to the package support provided by Advanced
Server.
For more information about using other compatibility features offered by Advanced
Server, please see the complete set of Advanced Server guides, available at:
https://www.enterprisedb.com/resources/product-documentation
Copyright © 2007 - 2019 EnterpriseDB Corporation. All rights reserved. 8
Database Compatibility for Oracle® Developers
Built-in Package Guide
1.1 What’s New
The following database compatibility for Oracle features have been added to Advanced
Server 10 to create Advanced Server 11:
 Advanced Server now supports SPL standalone procedure overloading. Note that
this feature is not compatible with Oracle databases. For information, see the
Database Compatibility for Oracle Developer’s Guide.
 Advanced Server now supports the PRAGMA AUTONOMOUS_TRANSACTION
directive within any SPL block to provide the autonomous transaction capability.
For information, see the Database Compatibility for Oracle Developer’s Guide.
For affected SPL programs, see Section 2.1.2.
1.2 Typographical Conventions Used in this Guide
Certain typographical conventions are used in this manual to clarify the meaning and
usage of various commands, statements, programs, examples, etc. This section provides a
summary of these conventions.
In the following descriptions a term refers to any word or group of words which may be
language keywords, user-supplied values, literals, etc. A term’s exact meaning depends
upon the context in which it is used.
 Italic font introduces a new term, typically, in the sentence that defines it for the
first time.
 Fixed-width (mono-spaced) font is used for terms that must be given
literally such as SQL commands, specific table and column names used in the
examples, programming language keywords, etc. For example, SELECT * FROM
emp;
 Italic fixed-width font is used for terms for which the user must
substitute values in actual usage. For example, DELETE FROM table_name;
 A vertical pipe | denotes a choice between the terms on either side of the pipe. A
vertical pipe is used to separate two or more alternative terms within square
brackets (optional choices) or braces (one mandatory choice).
 Square brackets [ ] denote that one or none of the enclosed term(s) may be
substituted. For example, [ a | b ], means choose one of “a” or “b” or neither
of the two.
 Braces {} denote that exactly one of the enclosed alternatives must be specified.
For example, { a | b }, means exactly one of “a” or “b” must be specified.
 Ellipses ... denote that the proceeding term may be repeated. For example, [ a |
b ] ... means that you may have the sequence, “b a a b a”.
Copyright © 2007 - 2019 EnterpriseDB Corporation. All rights reserved. 9
Database Compatibility for Oracle® Developers
Built-in Package Guide
2 Packages
This chapter discusses the concept of packages in Advanced Server. A package is a
named collection of functions, procedures, variables, cursors, user-defined record types,
and records that are referenced using a common qualifier – the package identifier.
Packages have the following characteristics:
 Packages provide a convenient means of organizing the functions and procedures
that perform a related purpose. Permission to use the package functions and
procedures is dependent upon one privilege granted to the entire package. All of
the package programs must be referenced with a common name.
 Certain functions, procedures, variables, types, etc. in the package can be declared
as public. Public entities are visible and can be referenced by other programs that
are given EXECUTE privilege on the package. For public functions and
procedures, only their signatures are visible - the program names, parameters if
any, and return types of functions. The SPL code of these functions and
procedures is not accessible to others, therefore applications that utilize a package
are dependent only upon the information available in the signature – not in the
procedural logic itself.
 Other functions, procedures, variables, types, etc. in the package can be declared
as private. Private entities can be referenced and used by function and procedures
within the package, but not by other external applications. Private entities are for
use only by programs within the package.
 Function and procedure names can be overloaded within a package. One or more
functions/procedures can be defined with the same name, but with different
signatures. This provides the capability to create identically named programs that
perform the same job, but on different types of input.
2.1 Package Components
Packages consist of two main components:
 The package specification: This is the public interface, (these are the elements
which can be referenced outside the package). We declare all database objects
that are to be a part of our package within the specification.
 The package body: This contains the actual implementation of all the database
objects declared within the package specification.
The package body implements the specifications in the package specification. It contains
implementation details and private declarations which are invisible to the application.
You can debug, enhance or replace a package body without changing the specifications.
Similarly, you can change the body without recompiling the calling programs because the
implementation details are invisible to the application.
Copyright © 2007 - 2019 EnterpriseDB Corporation. All rights reserved. 10
Database Compatibility for Oracle® Developers
Built-in Package Guide
2.1.1 Package Specification Syntax
The package specification defines the user interface for a package (the API). The
specification lists the functions, procedures, types, exceptions and cursors that are visible
to a user of the package.
The syntax used to define the interface for a package is:
CREATE [ OR REPLACE ] PACKAGE package_name
[ authorization_clause ]
{ IS | AS }
[ declaration; ] ...
[ procedure_or_function_declaration ] ...