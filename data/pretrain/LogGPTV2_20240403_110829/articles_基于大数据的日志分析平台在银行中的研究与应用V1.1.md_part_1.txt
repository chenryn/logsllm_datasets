**基于大数据日志分析平台在银行中的研究与应用**
关键字: 日志 大数据 银行
1.  **课题研究背景**
随着银行信息化建设，银行业务正常运行对IT系统的依赖度逐步加大，信息系统及承载的物理环境日趋复杂并呈现多样化趋势，
银行IT运维经过多年探索已经逐步建立起相应的运维体系，但随着大数据时代到来，数据量与日俱增，银行数据具备Volume（大量）、Velocity（高速）、Variety（多样）、Value（价值）的大数据特征，利用大数据技术分析日志数据，基于海量数据分析的视觉化以及数据管理的全新系统正在以日新月异的速度改变着信息使用者的分析能力。同时国家对网络安全等级保护的管理要求进一步提高，银行迫切需要建立一套日志集中管理分析平台来满足业务系统与网络设备日志管理与分析。从而实现运营分析、实时告警、事件回溯以及满足网络安全法对日志的管理与审计需求，并积累更丰富的运维数据资源，加速故障分析、故障追踪和定位，满足银行日益迫切的运维监控及分析要求。
2.  **日志分析与审计的意义**
银行信息系统中的主机、服务器、网络设备、安全设备、数据库以及各种应用服务软件在运行过程中会产生大量的运行日志、安全日志和行为日志，这些体量巨大的日志蕴含着丰富的信息。但是这些日志产生于不同的业务部门、分布在不同的服务器上，日志分散难以管理。传统模式下，交易部门和研究部门的数据是相互独立，甚至数据的储存格式都不同，由此形成一个个信息孤岛，造成不同系统间关联分析困难、事故原因分析困难。同时日志格式复杂难以解读，银行数据体量大。现代成熟的金融行业，随着网上支付、手机银行、互联网金融等新一代业务的出现，每天产生的各种业务数据、网络设备数据及防火墙数据等将轻松突破TB级别。
**日志分析能帮助银行挖掘数据价值**：
-   提高运维效率
传统运维技术需要大量人工操作，通常排查一个问题需要花费一个有经验的运维技术人员数小时精力，而依靠大数据日志分析运维技术，可以实现实时检索，定制化告警达到秒级延时。这样就可以满足金融场景中快速运维工作的要求，也极大提升了用户体验。
-   业务数据分析
大数据日志分析技术改变了传统的数据使用模式，通过异源日志的全面收集、海量存储，通过强大的分析、搜索引擎，基于多种维度统计用户的访问习惯，用户的终端类型、访问时间、地理区域可以将手机银行、网上支付、线下零售与社交、运营商等多维数据源相结合，对用户行为进行全方位画像，覆盖的维度广，并可将数据可视化，为用户提供多方位、全视角的分析报表，让企业更了解用户，有助于实现精准营销。
**日志审计能帮助银行完成合规要求**
作为电子货币与交易信息传输系统，一旦出现账户盗用、虚假信息等现象，将既影响到国家金融与个人经济利益，又涉及到交易隐私的安全性，同时还增加了金融风险的传导与扩散危险。另一方面，金融信息系统用户的非法操作及异常行为往往具有特异性弱和隐蔽性强等特点，内部人员以合法用户身份登录系统，进行非法操作，窃取涉密资料，造成危害很大。
因此，通过日志分析平台进行日志审计的目标在于：在事前控制、过程监督、事后追溯和闭环整改的机制下记录、分析和检查用户行为及系统状况，判断是否符合预定的安全策略，通过分析和检查发现系统存在的安全漏洞、潜在的安全威胁，并可对其造成的后果进行分析和评估，降低安全风险并追究系统安全破坏者的责任。
（1）事前控制指建立运行日志分析平台时即建立与信息系统安全等级相应和有效的安全防护技术措施，从技术上保证平台运行的安全和可靠；
（2）过程监督指在信息系统运行过程中，应具备有效的监管手段和审计措施，确保用户过程行为受控；
（3）事后追溯指信息系统中的用户行为应有相关的行为日志记录，在发生异常事件时有追溯机制；
（4）闭环整改指审计出信息系统用户行为异常、信息系统存在安全风险时，有相应的整改措施和闭环手段。
日志审计能解决金融企业在合规性、运维支撑、威胁检测、取证分析方面的需求，除了集中管理、存储来自企业和组织中所有IT资源(包括网络、系统和应用)产生的安全信息(包括日志、告警等)外，还应能够实时监控、历史分析、审计分析、调查取证、出具报表。鉴别出来自外部的入侵和内部的违规、误操作行为，从而实现IT资源合规性管理的目标，提升企业和组织的安全运营、威胁管理和应急响应能力。
-   日志审计是信息安全管理的需要：
> 因为日志审计是日常信息安全管理中最为重要的环节之一；能从纷繁复杂的日志中萃取出具有价值的部分是各类信息安全管理者、参与者、相关者最大的诉求，故选择一款高可靠、高性能、具备强大功能的日志集中审计系统就成为必须；
-   日志审计是安全技术保障体系建设要求的需要
一个完整的信息安全技术保障体系应由检测、保护和响应三部分组成，而日志审计是检测安全事件的不可或缺重要手段之一。目前，大部分信息系统的所依赖的IDS/IPS系统只能检测部分来之网络的攻击事件，对运维人员的违规操作、系统运行异常、设备故障等安全事件缺乏监控能力，而这些异常事件恰恰是对内部信息系统安全威胁的最大部分。日志审计系统通过分析各设备、系统、应用、数据库产生的运行日志，能够及时发现[入侵检测](https://cloud.tencent.com/product/hs)系统检测到的各类安全隐患，并及时给予告警，从而避免安全事件的发生；
-   日志审计是各种规范符合性要求的需要
如：《信息安全[等级保护](https://cloud.tencent.com/product/djbh)》（几乎各级均要求提供审计功能）、《信息安全风险管理规范》、《基于互联网电子政务信息安全指南》、《银行业金融机构信息系统管理指引》等等。此外，国际上的相关标准、规范也均明确提出信息安全审计系统的重要性，如萨班斯法案、ISO27001等均要求企业对重要系统、设备的运日志进行保留，并且周期性地进行第三方审计。
通过日志运维管理平台，运维人员能获得可量化的数据及全面的服务质量指标，方便系统优化及汇报，同时通过日志分析技术帮助运维人员对各IT组件对业务系统影响的权重度评估、各IT组件的风险预测，各IT组件的可用性监控，还能够对公司所有设备和业务系统的运行趋势进行分析，做到及时预警，提升管理决策。
3.  **多源日志数据的采集**
对银行IT系统日志整体对接，应支持对业务系统、数据库、中间件、服务器、网络设备、安全设备日志采集，支持各种格式的数据（文本、XML、数据、事件、消息、专有格式等任何数据），采集功能包括：
(1) 操作系统：支持对Windows、Linux、HPUX、AIX、Solaris等系统的日志采集。
(2) 数据库：支持对DB2、ORACLE、SQL Server、MySQL等数据库的日志采集。
(3) 网络设备：支持华为、锐捷、中兴、思科（CISCO），瞻博网络（Juniper）、华三通信（H3C）、博科（Brocade）等主流的网络设备。
(4) 安全设备：天融信、启明星辰、深信服、华为、蓝盾、绿盟科技等主流的安全设备。
(5) 中间件：支持对WAS、Tomcat、Apache、JBoss、WebLogic、Nginx,
    MQ、MB等中间应用程序的日志采集。
(6) 支持带日期格式或编号的文件名自动识别，对于没有时间戳的日志可以自动添加时间戳实现。
(7) 支持对多行日志的采集，能够智能识别出每行日志并进行采集，且对不同格式的日志通过配置可自动实现规范化。
(8) 支持对于目录为对象的采集能力，监听目录下最新的文件，将所有最新的内容上传至本系统，可以读取子目录的日志文件。
(9) 支持通过api接口，获取业务系统日志，对于特殊格式的API，可以开发定制，保证数据正常和完整的接入。
(10) 支持对于常见的HTTP、TCP/UDP Socket、Syslog/Rsyslog、SNMP
     Trap等标准协议的接收采集能力。
(11) 支持对于Windows事件的采集能力。
(12) 具有各种常见操作系统版本的采集客户端，可以采集各平台的日志，并对Agent提供管理功能，支持对Agent进行远程启动、停止、重启、清除缓存。支持批量升级和批量配置，支持客户端Agent分组、实时查看Agent的状态、监听Agent心跳，以便管理人员第一时间发现问题，从而不影响日志的采集。
同时应具备与第三方系统数据集成对接的接口，能够按照标准数据接口规范要求，与第三方系统进行数据对接，支持按照不同场景将筛选、统计后的日志数据推送到第三方系统（如集中运维监控、信息交互平台等）；支持将触发规则的告警数据推送到第三方系统。
与现有CMDB的对接，新增加的设备和应用或产品，在CMDB中定义后，日志分析平台实现基于IP地址差异性识别，并进行主动式提醒；
4.  **平台功能设计与研究**
现代银行信息化建设成熟，日志资源丰富，每日数据量达到TB级别，已经具备建立统一日志分析平台的条件，对全网设备、应用以及网络中的各类操作进行全面的日志采集，符合当下银行的日志管理需求；通过实时监控系统事件，并根据设定条件对日志数据进行过滤，同时将无序杂乱的非结构化的日志转换成结构化数据，提供统一管理方式，实现日志的日志持久化、标准化存储，从而符合标准政策规定内控需求；从IT
系统的行为、状态、配置、故障等事件中，自动产生趋势预判，提供准实时运维可用性监控及应用性能监控，帮助银行技术人员进行安全信息与实践管理、事件关联分析、在线业务统计分析、安全审计等工作，提升工作效率，符合工作需求。
日志分析平台按照功能划分应主要包括以下模块：数据采集、数据流式处理、数据存储、数据检索、数据可视化、权限控制。
![](media/image1.png){width="5.780555555555556in"
height="4.551388888888889in"}
图1 功能架构图
## 数据采集
对银行IT系统日志整体对接，应支持对业务系统、数据库、中间件、服务器、网络设备、安全设备日志采集，支持各种格式的数据（文本、XML、数据、事件、消息、专有格式等任何数据）。
采集系统需满足数据的真实性、安全性及完整性，防篡改、支持加密传输，限制日志上报占用带宽、指定时间传输数据、压缩传输、采集频率等，以减少对系统的影响。所采集的日志都会包含应用名称、主机名称、标签，以保证对日志类型、来源等信息的区分，也可以使用这三个维度对日志重新分类，以增加对数据可管理性。
1\) 对业务系统文本日志数据采用通过 HekaAgent 的方式获得数据，并根据需
要对数据进行汇总、分析、展示等。数据采集一般分为实时增量获取、按
非工作时间段获取（避免对业务运行时间造成网络带宽占用）。
2\) 对于无法自动获取的源数据，将数据制作成符合格式要求的文件（如
EXCEL、CSV 等），通过 ftp 或其他服务存放在指定的文件系统中，采集系
统通过 HekaAgent 服务进行采集。另外对于数据库表数据，直接可以通过
Collector 主动定时或者增量采集表数据。这部分数据主要为我司的资产
设备信息、机房机柜位置分布信息、交易统计数据、系统的性能数据等。
3\) 其他应用开发商所开发的 web 应用服务数据可根据提供接口通过平台 API
接口进行数据的对接。
4\)
对于既无法通过数据采集接口自动获取、又无法实现文件导入的数据，通过系统
web 界面录入数据。
![](media/image2.png){width="3.7728565179352582in"
height="2.8058059930008747in"}
## 数据流式处理
银行数据量巨大，应用系统众多，复杂度高，承载量大，日志量呈现几何倍数增长，因此数据流式处理需满足：
> （1）运行结点100+，并达到秒级延迟。
>
> （2）使用基于内存的计算作为执行引擎，具有高效和容错的特性。
>
> （3）能集成批处理和交互查询。
>
> （4）为实现复杂的算法提供和批处理类似的简单接口。通过丰富的API和基于内存的高速计算引擎可以结合流式处理，批处理和交互查询等应用。
>
> （6）计算流程：将流式计算分解成一系列短小的批处理作业。把输入数据（如1秒）分成一段一段的数据。
>
> （7）容错性与实时性：将流式计算分解成多个Job，对于每一段数据的处理都会经过分解，以及任务集的调度过程。
>
> （9）扩展性与吞吐量：能够线性扩展到100个节点（每个节点4Core），可以以数秒的延迟处理万级以上EPS。
>
> 模块架构如下：
>
> ![](media/image3.png){width="4.305772090988627in"
> height="3.774647856517935in"}
## 数据存储
采用分布式文件的存储方式来保存数据，支持对近期数据的实时搜索、历史数据的快速检索、对数据归档备份以备追溯和审计的需要，同时为后续的数据挖掘、大数据分析积累数据。数据存储需满足以下要求：
> \(1\)
> 日志的准确性：日志系统在接收日志时采用了分布式消息队列，在数据处理失败的时候会选择另外的执行路径进行重新提交处理，在群集内存储时可以设置保留的副本数量，在归档时是对日志完整的归档，这样使接收、处理和存档的日志数据没有缺陷或者误导信息且保证日志的不丢失支持原始日志保存。对采集的日志进行保存时，不会对原始数据做任何修改。
>
> \(2\) 支持压缩存储：支持对原始日志的压缩。
>
> \(3\)
> 集中存储的安全性：日志被采集到后，对内各个使用人员有详细的权限划分，如日志来源、告警、仪表盘、趋势图、报表、定时任务、URL访问等均可通过权限给相关人员查看；对外保存的是自身的文件格式，其他系统或工具无法打开，从而保证存储安全性。
>