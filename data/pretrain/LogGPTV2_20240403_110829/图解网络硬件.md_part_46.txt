可信赖的公司内部网络区域。一般使用默认设置
Untrust
Ethernet1/2
公司外部（互联网）网络区域。一般使用默认设置
DMZ
Ethernet1/5
向外部公开的服务器所使用的区域。一般使用默认设置
Sales
Ethernet1/3
只有销售部门员工才能访问的区域，是由管理员划分出的
新区域
信任区域
公司内部网络等，需要由组织内的防火墙来保护的网络一般称为信任区域（trustedzone）或
内部区域，意思就是“被信赖的区域”。
不信任区域
与信任区域相对的是外部网络，如互联网等，一般被称为不信任区域（UntrustZone）或外部
区域。不信任区域的意思就是“不被信赖的区域”。
支持区域划分的防火墙可以根据默认的安全策略仅执行默认拦截操作，也可以根据安全策略
---
## Page 272
258|第5章防火墙功能与防范威胁的对策
完成从信任区域到不信任区域的通信。
DMZ
DMZ的意思是非武装区域（DeMilitarizedZone），网络中的DMZ是指由防火墙划分的、放
置了对外公开服务器的网段，该区域与内部网络是分离开的。
为了防正受到攻击，从外部网络访问内部网络的通信一般都会被防火墙拦截，但是服务器中
还存在Web服务器这类对外公开的服务器，对于这类服务器的访问就不能一味地拦截了。但如
果将这类服务器放置在内部网络中，一旦遭到外部网络用户的恶意入侵，便会导致拥有重要数据
的内部网络对外敲开大门。
因此，将需要对外公开的服务器放置在DMZ中，即使该服务器遭到入侵，外部网络也无法
直接从该区域直接访问内部网络。
自定义区域
虽然信任区域、不信任区域、DMZ在防火墙中常被使用，但区域也能够根据其具体内容、
安全策略描述以及便于管理员管理的目的自定义名称，如“人事部区域”或“销售部区域”等，
这些由管理员重新划分并自命名的区域成为自定义区域（CustomZone）。
05.07.04安全策略
防火墙的主要功能是访问控制，即判断是否允许特定发送源与特定目的地之间进行特定的通
信。访问控制通过设置“规则”来实现，每一条规则都指定了需要控制的发送源、目的地以及通
信内容等信息。在路由器中，这类访问控制的规则集合称为“访问控制列表”，而在防火墙中则
一般称为“安全策略”或“安全规则。
路由器的访问控制列表
访问控制列表以行为单位定义规则，一般一个规则整体会使用多行来定义，每一行的规则称
为“表项”。
组成。
例如，以CiscoIOS中为标准的访问控制列表表项只允许发送源IP地址作为触发对象，而行
为则是在也只许可（permit）和拒绝（deny）之间二选一。
扩展后的访问控制列表可以将下面这些参数作为触发对象。
---
## Page 273
05.07防火墙中搭载的各种功能|259
IP协议号、发送源IP地址、目的地IP地址、ToS数据域、ICMP类型、ICMP代码、ICMP消息、发送源TCP/UDP端
口号、目的地TCP/UDP端口号、TCP会话是否已经建立
访问控制列表表项中的可选项表示当满足条件（触发对象）时，可以指定“记录日志”或
“表项有效时间段”等操作。如果使用了有效时间段选项，就能够设置一个只以公司上班时间为
对象的访问控制列表表项。
例如，允许从IP地址为10.1.1.2的客户端向IP地址为172.16.1.1的服务器进行Telnet连接
（TCP端口为23）时，访问控制列表如下所示。
表5-16CiscoIOS中扩展访问控制列表的命令
类型
命令注1
IP
access-listaccess-list-number[dynamicdynamic-name[timeoutminutes]]{deny|permit}protocol source
source-wildcarddestinationdestination-wildcard[precedenceprecedence][tostos][log|log-input]【time
range time-range-name]
ICMP
access-listaccess-list-number[dynamicdynamic-name[timeoutminutes]]{deny|permit}icmpsource
TCP
source-wildcard[operator[portlldestination destination-wildcard[operator[portll[established]
[precedenceprecedence][tostos][log|log-input][time-rangetime-range-name]
UDP
access-listaccess-list-numberIdynamicdynamic-name[timeoutminutesll {deny|permit}udpsource
source-wildcard[operator[portll]destinationdestination-wildcard[operator[portllIprecedence
precedence][tostos][log|log-input][time-rangetime-range-name]
注1：粗体字表示关键字，斜体字表示可选项。
表5-17CiscoIOS中访问控制列表命令参数一览
参数注
说明
access-list-number
访问控制列表编号。扩展ACL时，可以使用100到199（或从2000到2599）之间的值
dynamicdynamic
如果是“timeout10”，表示空闲超时时间为10分钟，即会话如果在10分钟内没有进行任何通
name [timeout
信就将该会话之后的通信拦截。如果使用了dynamic关键字，则表示通信开始10分钟后会话仍
minutes]
然有效
{deny |permit)
指定拒绝（deny）或接受（permit）
protocol
指定IP首部内表示协议号的数值。对于ICMP、TCP、UDP等可以使用icmp、tcp、Udp等文字
序列作为关键字
source
指定发送源地址。在source部分指定网络地址，并可以于source-wildcard处指定掩码取反的
source-wildcard
通配符
例：10.1.1.00.0.0.255”表示10.1.1.0/24的地址
“host10.1.1.1”表示10.1.1.1/32的地址
any”表示所有发送源地址
---
## Page 274
260|第5章防火墙功能与防范威胁的对策
（续）
参数注1
说明
destination
表示发送目的地的地址。在destination部分指定网络地址，并可以于source-wildcard处指定掩
destination-wildcard
码取反的通配符
例：“10.1.1.00.0.0.255”表示10.1.1.0/24的地址
"host10.1.1.1”表示10.1.1.1/32的地址
“any”表示所有目的地址
指定ICMP的类型或代码
type icmp-codel|
例：“8”表示EchoRequest（ICMPType8）
[icmp-messagel]
30”表示DestinationUnreachable（ICMPType3的Code0）
“echo-replay”表示EchoReplay（ICMPTypeO）
[operator[port]]
如果记述于“sourcesource-wildcard”之后，指定的是发送源端口，记述于“destination
destination-wildcard”之后则指定的是目的地端口。“port”部分可以填写端口编号或“ftp”这
种应用程序文字列。“operator"部分可以指定“lIt（小于）”、“gt（大于）”、“eq（等于）”、“neq
（不等于）”、“range（包含范围）”中任意一个类型
例：“eq23”表示当端口号等于23时的情况
“gt1023”表示端口号大于1023时的情况
[established]
表示TCP会话的建立过程已经完成，即在收到SYN消息后，后续收到的消息会携带ACK或
RST比特位相一致的分节数据
Iprecedence
指定IP首部内IPprecedence的值。该值可以是从O到7的数字，也可以是文字序列。例：
precedence)
precedenceO”表示IPprecedence的值为0
precedencepriority”表示IPprecedence的值为1
[50 501]
指定IP首部内ToS数据域的值，该值可以是从0到15的数字，也可以是文字序列。例：“tos
0”表示ToS值为0
tosmin-delay”表示ToS值为8
[log | log-input]
“log”关键字用来告知路由器当收到与访问控制列表中规则一致的分组时，需要在控制端口输出
日志信息。“loginput”的部分则表示还需要将输入网络接口和发送源MAC地址的相关信息一
同输出。该参数一般用于调试模式
[time-range
指定访问控制列表生效的时间段。“time-range”命令后还可以添加一个给指定时间段定义的新
time-range-name]
名称
例：指定平日中午12点至13点生效
(config)# time-range Lunch_time
注1：粗体字表示关键字，斜体字表示可选内容。
■防火墙的安全策略
防火墙的安全策略与路由器的访问控制列表最大的不同点在于是否拥有区域的概念。大多数
防火墙将区域作为触发对象。
另外，新一代防火墙中的触发对象还包括了应用程序名称和用户名称等信息。
---
## Page 275
05.07防火墙中搭载的各种功能丨261
访问控制列表和安全策略都是按照表中由上往下的顺序依次进行评估。例如在表5-18所示
的范例中，从信任区域向不信任区域的192.168.2.1地址通信时，防火墙首先评估第1条安全策
略，检测出发送源地址和该策略中定义的不同，因此未执行Allow行为。接着评估第2条安全策
略，发送源地址和策略定义相匹配，因此执行Deny行为，也就是拒绝该通信。防火墙的这种安
全策略评估行为也可称为安全策略查找（policylookup）。
表5-18
安全策略的范例
发送源区域
目的地区域
发送源地址
目的地址
目的地端口
行为
Trust
Untrust
192.168.1.0/24
Any
Any
Allow
1
Trust
Untrust
192.168.2.0/24
Any
80
Deny
2
Untrust
DMZ
Any
10.1.1.1
80
3
Allow
如果将触发对象设置为“Any”则表示触发对象是任何值都与策略相匹配。
在表5-18所示的范例中，并没有从信任区域向DMZ区域进行通信的表项。对于这类没有
出现在安全策略表中的通信行为，防火墙默认执行拒绝的行为，这一决策称为“默认的拒绝”
（implicitdeny），路由器的访问控制列表同样也可以执行“默认的拒绝”。
当需要防火墙在没有匹配的情况下也执行充许行为时，可以像表5-19所示那样，在安全策
表5-19
在最后一行设置allow策略的范例
发送源区域
目的地区域
发送源地址
目的地址
目的地端口
行为
Trust
Untrust
Any
Any
192.168.1.0/24
Allow
Trust
Untrust
Any
80
Deny
192.168.2.0/24
Untrust
Any
3
DMZ
10.1.1.1
80
Allow
Any
Any
Any
Any
Any
Allow
4
防火墙可设置的安全策略也会有一定的上限，该上限由产品规格决定。当需要进行安全策略
评估的表项越来越多时，设备的性能也会随之下降。至于设备性能会下降到何种程度，则需要对
在设置完安全策略后，策略最终行命中的情况下，所能得到的通信吞吐量与没有配置任何安全策
略时能得到的通信吞吐量进行比较，方能得出结论。
内容安全策略
区域、IP地址、端口号、应用程序等都可以作为防火墙判断是否允许进行通信的安全策略依
据。另外，在UTM以及新一代防火墙中，还可以使用内容安全策略规则完成对特定通信的控制。
具体而言，该策略使用了反病毒、IPS（人侵防御系统）URL过滤、DLP（数据泄露防护）
---
## Page 276
262|第5章防火墙功能与防范威胁的对策
等基于内容的安全机制，能够拦截非法通信和避免不必要的通信流量。另外，通过该策略防火墙
还也可以对这些通信不实施拦截，而是将其记录到告警日志中后放行。
程度低的攻击只记录到告警日志中。当然，用户也能够通过修改设置拦截严重程度低的攻击。
另外，反病毒以及IPS可能会发生误判。误判分为假阳性（false-positive）错误和假阴性
(false-negative）错误两类。
假阳性错误是指明明没有攻击行为（或病毒入侵），却被网络安全装置判断为存在攻击行为
（或病毒人侵），并将该行为记录到日志中，或者之间将通信拦截。一般这类错误容易被用户或管
理员察觉。
假阴性错误是指明明存在攻击行为，却判断为没有攻击行为。结果不仅完成了通信，也没
有将通信该行为记录到日志中，导致管理员即使查看安全设备的日志信息也无法察觉这一严重后
果。只有检查作为客户端的个人计算机上安装的反病毒软件或个人防火墙，才能找到这些没有被
安全设备防范的通信的信息。总之，假阴性错误一般都是由于数字签名本身不存在，或误认为数
字签名存在而导致的检测失败。
05.07.05NAT
使用私有IP地址、位于内部网络的客户端向位于外部网络（互联网）的服务器进行通信时，
可以通过路由器或防火墙将发送源的私有IP地址转换为全局IP地址，这一转换过程称为NAT。
NAT原本是由为路由器提供的功能，不过现在位于网络边界处的防火墙也常常使用该项功
静态NAT
静态NAT（StaticNAT）是指将NAT之前的地址和NAT之后的地址进行1对1的分配，由
管理员将信息设置到网关中。管理员根据转换前的地址在网关中设置一个指定地址，该指定地址
即成为转换后的地址信息。静态NAT在进行目的地NAT时经常使用，能够对外部网络屏蔽内部
服务器的地址，从而避免内部网络受到攻击。
①来自于生物学，可以简单理解为验证某事物为阳性（真）时，出现了错误。一译者注
②来自于生物学，可以简单理解为验证某事物为阴性（假）时，出现了错误。—译者注
③全称为NetworkAddressTranslator。—译者注
---
## Page 277
05.07防火墙中搭载的各种功能1263
图5-19静态NAT的流程
NAT转换表
3.3.3.1→192.168.10.1
3.3.3.2→192.168.10.2
12.1.1.1
192.168.10.1
192.168.10.254