Stephen Hilt, miaoski 
2015/8/26-27 
Building Automation and Control – 
Hacking Subsidized Energy Saving System 
1 
$ whoami 
• miaoski (@miaoski) 
• Staff engineer in Trend Micro 
• BACnet newbie 
2 
$ whoami 
• Stephen Hilt (@tothehilt) 
• Senior threat researcher, Trend Micro 
• 10 years ICS security exp 
3 
Disclaimer 
• Do not probe / scan / modify the devices that you don’t own. 
• Do not change any value without permission. 
• It’s a matter of LIFE AND DEATH. 
• Beware! Taiwanese CRIMINAL LAW. 
4 
Photo courtesy of 
Wikimedia, CC0. 
BACnet – 
Building Automation and Control networks 
5 
BACnet was designed to allow communication of building automation and control 
systems for applications such as heating, ventilating, and air-conditioning control, 
lighting control, access control, and fire detection systems and their associated 
equipment.   http://en.wikipedia.org/wiki/BACnet 
Building Automation? 
6 
Image from http://buildipedia.com/aec-pros/facilities-ops-maintenance/case-study-
cuyahoga-metro-housing-authority-utilizes-bas 
Credit: Siemens Building Technologies 
Building Automation! 
7 
Photo courtesy of Chien Kuo Senior High School. 
ANSI/ASHRAE 135-2001 
8 
ICS Protocols 
9 
•
ICS – Industrial Control 
Systems 
•
SCADA – Supervisory 
Control and Data 
Acquisition 
•
DCS – Distributed 
Control Systems 
(Most) ICS Protocols 
10 
Authentication 
Encryption 
Data Integrity 
Homemade BACnet 
11 
http://bacnet.sourceforge.net/ 
BACnet Layers map to OSI 
12 
Credit: icpdas.com 
BACnet/IP 
13 
BACnet/IP = UDP + BVLL + NPDU + APDU + … 
14 
Charts courtesy of http://www.bacnet.org/Tutorial/BACnetIP/default.html 
BACnet/IP = UDP + BVLL + NPDU + APDU + … 
15 
Charts courtesy of http://www.bacnet.org/Tutorial/BACnetIP/default.html 
BBMD = BACnet broadcast management device 
BACnet Objects 
16 
Credit: www.bacnet.org 
BACnet-discover-enumerate.nse (1) 
17 
Object Name Packet Sent == 810a001101040005010c0c023FFFFF194d 
 77 == 0x4d 
Source: ANSI/ASHRAE Standard 135-2001 
Source code: 
https://github.com/digitalbond/Redpoint/blob/master/BACnet-discover-enumerate.nse 
BACnet-discover-enumerate.nse (2) 
• Other Read Properties To Try 
– 810a001101040005010c0c023FFFFF19xx  
• Vendor ID: 120 (0x78) 
• Description: 28 (0x1c) 
• Firmware: 44 (0x2c) 
• Application Software: 12 (0x0c) 
• Model Name: 70 (0x46) 
• Location: 58 (0x3a) 
• Object Identifier: 75 (0x4b) 
18 
Source code: 
https://github.com/digitalbond/Redpoint/blob/master/BACnet-discover-enumerate.nse 
BACnet-discover-enumerate.nse (3) 
19 
|   Vendor ID: 
|   Object-identifier:  
|   Firmware:  
|   Application Software: 
|   Object Name:  
|   Model Name:  
|   Location: 
|   Broadcast Distribution Table (BDT): 
|_  Foreign Device Table (FDT): Empty Table 
Vendor ID:  A registered BACnet 
Vendor 
Object-identifier:  unique 
identifier of the device.  If the 
Object-Identifier is known, it is 
possible to send commands with 
BACnet client software, including 
those that change values, 
programs, schedules, and other 
operational information on BACnet 
devices. 
# nmap --script BACnet-discover-enumerate.nse -sU  -p 47808 140.xx.xx.xx 
BACnet-discover-enumerate.nse (3) 
20 
|   Vendor ID: 
|   Object-identifier:  
|   Firmware:  
|   Application Software: 
|   Object Name:  
|   Model Name:  
|   Location: 
|   Broadcast Distribution Table (BDT): 
|_  Foreign Device Table (FDT): Empty Table 
Broadcast Distribution Table 
(BDT) : A list of the BACnet 
Broadcast Management Devices 
(BBMD) in the BACnet network. 
This will identify all of the subnets 
that are part of the BACnet 
network. 
Foreign Device Table (FDT):  A 
list of foreign devices registered 
with the BACnet device. A foreign 
device is any device that is not on 
a subnet that is part of the BACnet 
network, not in the BDT. Foreign 
devices often are located on 
external networks and could be an 
attacker's IP address. 
Map Out Connections 
21 
Nmap scan report for 140-xxx-xxx-xxx.n**k.edu.tw (140.xxx.xxx.xxx) 
Host is up (0.00050s latency). 
PORT      STATE SERVICE 
47808/udp open  BACNet -- Building Automation and Control Networks 
| bacnet-info:  
|   Vendor ID: Siemens Schweiz AG (Formerly: Landis & Staefa Division Europe) (7) 
|   Vendor Name: Siemens Building Technologies Inc.  
|   Object-identifier: 0 
|   Firmware: 3.7 
|   Application Software: INT0370 
|   Object Name: 25OC0001874 
|   Model Name: Insight 
|   Description: BACnet Device 
|   Location: PC 
|   Broadcast Distribution Table (BDT):  
|     140.xxx.xxx.xxx:47808 
|     140.xxx.xxx.xxx:47808 
|     172.18.9.254:47808 
|_  Foreign Device Table (FDT): Non-Acknowledgement (NAK) 
FDT  NAK! 
22 
Nmap scan report for 140-xxx-xxx-xxx.n**k.edu.tw (140.xxx.xxx.xxx) 
Host is up (0.00050s latency). 
PORT      STATE SERVICE 
47808/udp open  BACNet -- Building Automation and Control Networks 
| bacnet-info:  
|   Vendor ID: Siemens Schweiz AG (Formerly: Landis & Staefa Division Europe) (7) 
|   Vendor Name: Siemens Building Technologies Inc.  
|   Object-identifier: 0 
|   Firmware: 3.7 
|   Application Software: INT0370 
|   Object Name: 25OC0001874 
|   Model Name: Insight 
|   Description: BACnet Device 
|   Location: PC 
|   Broadcast Distribution Table (BDT):  
|     140.xxx.xxx.xxx:47808 
|     140.xxx.xxx.xxx:47808 
|     172.18.9.254:47808 
|_  Foreign Device Table (FDT): Non-Acknowledgement (NAK) 
Let’s Gather MORE Information 
• Systems Require you to Join the Network as a Foreign Device 
to Enumerate Devices that are attached, as well as points 
– Once Registered in FDT, perform a Who-is message 
– Parse I-Am responses 
– … 
– Profit? 
23 
BACnet Discovery Tool (BDT) 
24 
View Connected Inputs 
25 
26 
Another day. 
Today we look for BACnet devices. 
Shodan + BACnet Discovery Tool 
27 
BACnet port = 0xBAC0 = port 47808 
Country: TW 
• As of July 29, 2015 
• 48 BACnet devices 
– 14 Advantech / BroadWin WebAccess Bacnet Server 7.0 
– 4 Automated Logic LGR 
– 3 Carel S.p.A. pCOWeb 
– 2 TAC MNB-1000 
– 1 Siemens Insight 
• 59 Ethernet/IP 
• 23 Moxa Nport Ethernet-RS485 in N**U 
28 
14 Advantech/BroadWin WebAccess 
29 
• CVE-2011-4522 XSS in bwerrdn.asp 
• CVE-2011-4523 XSS in bwview.asp 
• CVE-2011-4524 Long string REC 
• CVE-2011-4526 ActiveX buffer overflow 
• CVE-2012-0233 XSS of malformed URL 
• CVE-2012-0234 SQL injection 
• CVE-2012-0236 CSRF (Cross-site report forgery) 
• CVE-2012-0237 Unauthorized modification 
• CVE-2012-0238 opcImg.asp stack overflow REC 
• CVE-2012-0239 Authentication vulnerability (still in 7.0) 
• CVE-2012-0240 Authentication vulnerability in GbScriptAddUp.asp 
• CVE-2012-0241 Arbitrary memory corruption 
• CVE-2012-0242 Format string exploit 
• CVE-2012-0243 ActiveX buffer overflow in bwocxrun.ocx 
• CVE-2012-0244 SQL injection 
11 Protected by Password 
30 
Kenting Caesar Park Hotel 垦丁凯撒大饭店 
11 Protected by Password 
31 
Chung Hua University 中华大学 
11 Protected by Password 
32 
Dorm, Chung Yuan Christian University 中原大学宿舍 
11 Protected by Password 
33 
Hydean Biotechnology Co., Ltd. 瀚顶生物科技 
3 No or Default Password 
34 
Underground Driveway, ** Road ***车行地下道 
Unprotected HMI 
35 
Unprotected HMI 
36 
Unprotected HMI 
37 
Project Management 
38 
Analog Input Parameters 
39 
PLC Binary Value 
40 
Parameter Update 
41 
Main Graph 
42 
Turn Off the Aircon and Go Home? 
43 
Life Is Harder without HMI, But ... 
• Trane 2.6.30_HwVer12AB-hydra 
• P******* Co., New Taipei City 
44 
Device 11021 / 11022 
45 
Analog Inputs 
46 
Output = Modifiable 
47 
4 Automated Logic ME-LGR 
48 
3 Carel pCOWeb 
49 
2 TAC-MNB 
50 
Siemens Insight 
51 
Other than BACnet 
• 59 Ethernet/IP in TW 
– N**U Library 
– N**U Bio Center 
– N**U Men’s Dormitory 
– N**U Management Division 
– ... and so on 
• ModBus/TCP 
• Simple Ethernet-RS422/485 Adapters 
– 23 Moxa NPort in N**U 
52 
Allen-Bradley Powermonitor 1000 
53 
Unprotected HMI of Powermonitor 1000 
54 
Force KYZ 
55 
KYZ Pulse 
56 
Circuit courtesy of http://solidstateinstruments.com/newsletters/kyz-pulses.php 
Energy Results 
57 
Voltage Monitor 
58 
23 Moxa Nport Ethernet-RS485 in N**U 
59 
Unprotected NPort 
60 
•
23 NPort in N**U 
•
12 firewalled 
•
2 password protected 
•
9 no password 
Dump and Have Fun 
61 
Legacy Devices (Osaki PowerMax 22) 
62 
Legacy Devices (Osaki PowerMax 22) 
63 
Special thanks to 
Chien Kuo Senior 
High School. 
Subsidies from Ministry of Education 
64 
MOE subsidies ~25,000 USD to schools for, 
•
Power consumption management system 
•
Building energies management system 
•
Improvement of air-condition controls 
National Chia-Yi University 
65 
Contract capacity:  4,700kW 
Peak capacity:       5,216kW 
Minimum capacity: 2,752 kW 
NTU’s Discussion about BACnet 
66 
Shu-Zen Junior College 
67 
Taitung Senior Commercial Vocational School 
68 
St. Mary’s Junior College of Medicine 
69 
Points in Common 
• Subsidized 
• Public Tender 
• Contracted 
Note 
You can find the papers on Google. 
We did not probe / test their devices. 
70 
Suggestions 
• Password 
• Use private IP.  No, not corporate LAN 
• Firewall, SDN or tagged VLAN 
• Upgrade / Patch 
• Contract with a pentester 
71 
Port 47808, TW: 57/12,358 
72 
Home Automation with Arduino & RPi 
73 
Project at http://www.instructables.com/id/Uber-Home-Automation-w-Arduino-Pi/ 
Control System on Your Hand 
74 
Homepage of http://bacmove.com 
Our suggestion: 
These things shouldn't even be on the internet, not on the corporate network. 
It’s a control system and should be treated as such. 
Questions? 
75 
TAC-MNB Module 
76 
77 
Automated Logic 
US$40 (used) 
| 
US$2,500 (new) 
78 
MOXA NPort 5130 
US$75 - 149 (new) 
Carel pCO1000 US$200 
pCOWEB, unknown 
MNB-1000 US$321.60