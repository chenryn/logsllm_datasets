# 0 导读
**门禁卡安全么？二代身份证安全么？他们能否轻易复制，又是使用什么样的技术进行通讯和存储信息的？  
一文解答你的困惑。**
# 1 卡片分类
**IC卡，ID卡，M1卡，RFID卡，各是什么？按照什么来进行分类的？**
### 1.1 ID卡：一般只读，只储存ID
ID卡：只存储了ID号，设备识别ID号，没有算法可言，容易复制，安全性低。应用：普通门禁卡。
### 1.2 IC卡(Integrated Circuit)：带芯片的智能卡统称
1970年由法国人Roland Moreno发明，他第一次将可编程设置的IC芯片放于卡片中，使卡片具有更多功能。  
IC卡”和“磁卡”都是从技术角度起的名字，不能将其和“信用卡”、“电话卡”等从应用角度命名的卡相混淆。自IC卡出现以后，国际上对它有多种叫法。英文名称有“Smart
Card”、“IC Card”等；在亚洲特别是香港、台湾地区，多称为“聪明卡”、“智慧卡”、“智能卡”等；在我国，一般简称为“IC卡”。
### 1.3 磁条卡：磁性介质存储的卡。
磁性介质存储，可被轻易读取，被复制，无密码时，复制的卡片无认证，极易被盗刷。一般为接触式。
### 1.4 RFID 卡：所有采用射频识别技术的卡、无接触式
所有采用无线射频识别即射频识别技术（Radio Frequency Identification，RFID）的卡。  
根据供电方式又分为：
无源卡：没有电源，近距离接触识别、频段低。应用：校园卡，公交卡，二代身份证。
有源卡：自带电源，可以主动向外发射信号。应用：ETC系统。
半有源卡：平常处于休眠状态，低频信号激活后，电源供电高频精确通信。  
无源RFID自身不供电，但有效识别距离太短。有源RFID识别距离足够长，但需外接电源，体积较大。而半有源RFID就是为这一矛盾而妥协的产物。半有源RFID又叫做低频激活触发技术。在通常情况下，半有源RFID产品处于休眠状态，仅对标签中保持数据的部分进行供电，因此耗电量较小，可维持较长时间。当标签进入射频识别阅读器识别范围后，阅读器先现以125KHz低频信号在小范围内精确激活标签使之进入工作状态，再通过2.4GHz微波与其进行信息传递。也即是说，先利用低频信号精确定位，再利用高频信号快速传输数据。
### 1.5 M1卡(NXP Mifare1 Card):使用M1芯片的非接触式IC卡，可读写
所谓的M1芯片，是指飞利浦下属子公司恩智浦出品的芯片缩写，全称为NXP Mifare1系列，常用的有S50及S70两种型号。常见的有卡式和钥匙扣式。  
存储了ID号，可读写数据，M1卡发一个数据到设备，设备再传一个数据给M1卡确认，再进行交易或身份认证，只有一个算法。可以反复计算卡片秘钥，进行暴力破解。  
特点：可读写，有存储器无处理器。
### 1.6 射频存储卡
同上  
是采用了射频功能的存储卡。  
M1卡是射频存储卡的一个子集，市面上大部分使用的射频存储卡，都采用了M1卡芯片。  
特点：可读写，有存储器无处理器。
### 1.7 CPU 卡：有处理器的卡
有操作系统，可存储数据，也有自己的ID号，CPU卡发一串数据给设备，设备与SAM卡进行运算，设备再发一串数据回CPU卡确认，然后进行交易或身份认证；跟M1卡的区别在于一个算法在空中，一个算法在设备里面；无论是卡商，设备商，运营商，都不知道其中的算法，所以这个系统的安全性会高很多。  
有接触式也有非接触式。  
特点：可读写，有存储器和处理器。安全性极高，卡片内部有微处理器和储存空间，
### 1.8 芯片卡：
CPU卡的另外一种简称，即可接触式也可以非接触式。
## 1.9 其他概念
### 接触式非接触式：
**非接触式卡** 其实就是射频卡，由IC芯片、感应天线组成，封装在一个标准的PVC卡片内，芯片及天线无任何外露部分（也不一定）。
**接触式卡：**  
芯片金属暴露在外，肉眼可以看见，通过芯片上的触点可与读写外界接触交换信息。现在的银行卡大部分都是接触式的芯片卡。
**但是也有例外**
，以苏州的社保卡为例，芯片暴露在外面，既可以进行接触式刷卡（刷医保），也可以进行非接触式刷卡（坐公交等）。是将RFID和这两种技术融合在一起了。
### NFC 和 RFID的关系和区别
NFC是RFID的一部分，ETC是RFID的一个分支，它们都是无线射频技术。它们都有各自的使用领域，可以说是相辅相成。  
NFC的工作频率为13.56MHz，ETC的工作频率为2.45GHZ，而RFID的工作频率有低频，高频（13.56MHz）及超高频。  
工作距离：NFC的工作距离理论上为0-20cm，但是在产品的实现上，由于采用了特殊功率抑制技术，使其工作距离只有0-10cm，从而更好地保证业务的安全性。由于RFID具有不同的频率，其工作距离在几厘米到几十米不等。  
工作模式：NFC同时支持读写模式和卡模式。而在RFID中，读卡器和非接触卡是独立的两个实体，不能切换。  
点对点通信：NFC支持P2P模式，RFID不支持P2P模式。  
应用领域: RFID更多的应用在生产，物流，跟踪和资产管理上，ETC主要用于高速收费，而NFC则工作在门禁，公交卡，手机支付等领域。  
标准协议:
NFC的底层通讯协议兼容高频RFID的底层通信标准，即兼容ISO14443/ISO15693标准。NFC技术还定义了比较完整的上层协议，如LLCP，NDEF和RTD等。
# 2 各类卡片结构&通信原理协议&识别方式&安全性分析
前面是把各类卡片的类型大致梳理了一遍，接下来介绍各个卡片的结构和通信原理。
这里主要介绍 **非接触式IC卡的结构**
### 2.1 卡片组成结构
非接触式IC卡主要由：IC芯片、感应线圈组成的，封装在一个标准的PVC卡片内部。  
实际上是将IC卡和射频识别技术结合在一起，通信距离大概是5-10cm。
### 2.2 供电原理
无源IC卡 比如M1卡是带有存储功能，CPU卡不仅有存储器还有微处理器。所以在接触过程中，需要进行供电。
供电的方式是采用 **电磁感应** ，射频读写器回想IC卡发一组固定频率的电磁波。卡片内部就有一个LC连谐振电路，和读写器发射的频率相同。  
这样在电磁波激励下，LC谐振电路产生共振，从而使电容内有了电荷；在这个电荷的另一端，接有一个单向导通的电子泵，将电容内的电荷送到另一个电容内存储，当所积累的电荷达到2V时，此电容可作为电源为其它电路提供工作电压，将卡内数据发射出去或接受读写器的数据。
也就是感应线圈，从中获得持续稳定的直流工作电源电压，通过查文献，现在的电压已经可以达到3.5V。
### 2.3 通信原理
非接触性IC卡与读卡器之间通过无线电波来完成读写操作。  
二者之间的通讯频率为13.56MHZ。  
非接触性IC卡本身是无源卡，当读写器对卡进行读写操作时，读写器发出的信号由两部分叠加组成:
  1. 一部分是电源信号，该信号由卡接收后，与本身的L/C产生一个瞬间能量来供给芯片工作。
  2. 另一部分则是指令和数据信号，指挥芯片完成数据的读取、修改、储存等，并返回信号给读写器,完成一次读写操作。
**reader-读写器** 则一般由单片机，专用智能模块和天线组成，并配有与PC的通讯接口，打印口，I/O口等，以便应用于不同的领域。
### 2.4 通信协议
先描述几个概念：  
标签（Tag)———卡片头部存储信息又叫做标签。比如我们用Mifare Classic Tool
对卡片进行读取的时候。提示的就是对标签进行查找，一般卡上的标签指的是卡片UID。
通信分为以下几个过程：
  1. 寻卡过程：  
当 MIFARE Classic 卡接近读卡器的磁场区域时，卡片会接收到读卡器发来的寻卡指令，然后按照防冲突协议发出自己的卡号 UID。
  2. 选卡过程：  
收到 UID 后，读卡器会选择这张卡（选卡过程）。接着读卡器发出对某一块扇区or全部的认证请求。
  3. 认证过程（双方）：  
大部分情况下，可以抽象为以下三个步骤：  
【1】卡片产生一个随机数 NT 并以明文方式发送给读卡器。（一般是伪随机数，且为硬件随机的方式）  
【2】读卡器获取到卡片的ID和随机数NT，根据卡片的ID在数据库中找到卡片的key。使用key将卡片发出的随机数NT加密
得到对卡片的应答aR。接着将对卡片的应答aR和读卡器的自己的随机数nR发给卡片  