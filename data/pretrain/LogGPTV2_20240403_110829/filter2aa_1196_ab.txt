Yes
Comodo Client 
Security
 8.3.0.5216
Persistence
DNS, HTTP
Yes
BitDefender 
Total Security 
2017
Build 21.0.23.1101
Engine v. 7.69800
-
11
As can be seen, 4 major Anti-Virus products (Avira, ESET, Kaspersky and Comodo) out of 10 were positively shown
to facilitate exfiltration of data from “isolated” endpoints.
Insights on AV sandboxes
We encountered 44 different sandbox instances from 22 templates. In general, they belong to 10 classes, based on their
computer name:
namePC (1 template, 13 instances: REYNAPC, MALVAPC, ELEANOREPC, WRIGHTPC, BRIAPC, JORIPC, GABBIPC,
HELSAPC, MAMEPC, SHARAIPC, ARACHONPC, FLORIANPC, EDITHPC) – In this class/template, the computer
name comprises of a person's first name followed by “PC”. This class is operated by ESET (its DNS queries come from
an IP owned by ESET). All machines encountered share some basic properties such as disk volume (e0b2a963),
performance counter frequency (100MHz) and MAC address prefix (00:1B:21:13:37:xx – the last byte varies). HTTP
traffic to the Internet is blocked, but DNS is enabled. 
something-PC (11 templates, 15 instances: WIN7-PC, ROGER-PC, DAVID-PC, ADMIN-PC, APIARY7-PC, ANTONY
PC, LUSER-PC, PERRY-PC, KLONE_X64-PC, 0M9P60J5W-PC, MIKI-PC) – each template in this class is different
(different CPU, different clock speed, different MAC address, different disk volume number). 
The template 0M9P60J5W-PC had 5 instances (different computer/user/domain names but all exhibit the same
properties). All templates use IPs in consumer ISPs to connect to the Internet. Usually the username is identical to the
computer name, but for ROGER-PC we also encountered cases wherein the username was a seemingly random string of
alphanumeric characters. This class is operated by Comodo and/or Kaspersky and/or Avira.
C-TT (2 templates: C02TT with 4 instances: C02TT22, C02TT26, C02TT36 and C02TT18; C06TT – one instance,
C06TT43) – this class is used by Avira.
ZGXTIQTG8837952 (1 template, 4 instances) – this class is used by Comodo. In one case, we encountered it behind
TOR.
Figure 1 - ESET NOD32 Antivirus 
notification (writing EICAR file to disk)
Figure 2 - Kaspersky Total Security 2017 
notification (persistence in the Startup folder)
12
spurtive (2 templates – "spurtive" and "circumstellar", one instance each) – used by Comodo. 
5 one-template, one instance classes (ABC-WIN7, PC, WIN-U9ELNVPPAD0, PC-4A095E27CB, WIN-LRG949QLD21
Not much information is available since each was encountered only once or twice.
It appears that not a lot of effort is made to hide the identity of the sandboxes from the processes running on them.
Most of the time, the names are fixed, and even if not, the disk volume serial number is not changed. In some cases, the
MAC address clearly indicates a virtualized environment (VMware). The Performance Counter is also an indicator for
virtualization in some cases (see http://www.securitygalore.com/site3/wpc-frequency-vm-os-matrix for details of this
technique). 
It is also noteworthy that several sandbox templates (e.g. “ROGER-PC”) are shared (or OEMed) between several players.
This is clear in the case of “ROGER-PC” (Comodo, Kaspersky and Avira), but can be deduced in the case of “BRIA-PC”
and “JORI-PC” – both were only observed being used by Comodo, but their DNS traffic is coming from an IP owned by
ESET. This may indicate for example, that Comodo uses third party AV engines/services to help evaluate unknown files.
The full details of the sandboxes we encountered are provided in the appendix.
Additional observations:
• 
Reaction time (time between sample upload and exfiltration) of sandbox execution varies from minutes to hours.
• 
In some cases (ROGER-PC, ANTONY-PC) we noticed that sometimes the sandbox prevented the investigated process
from accessing the environment variables.
• 
It appears that additional sandbox executions sometime took place days and even weeks after the sample was
submitted. We suspect these were related to either batch processing/re-evaluation, or due to analysts manually
investigating the samples.
• 
In some cases, we noticed that the sandbox ran the Satellite before the data was “burned” into it by the Rocket. Our
theory is that the AV product statically scanned the Rocket file/process, discovered the embedded executable 
(Satellite), extracted it as-is and executed it.
ON-PREMISE AV SANDBOXES
Some AV vendors offer an alternative to cloud AV sandbox in the form of an on-premise sandbox, in which the suspicious 
executable can be run safely. In this configuration, the attack may still be carried out, provided that:
• 
The sandbox allows outbound (Internet) traffic of some sort; and
• 
The enterprise network configuration allows outbound (Internet) traffic from the sandbox of at least one of the
protocols/traffic types allowed by the sandbox
We did not experiment with on-premise AV sandboxes. Even if we could find AV on-premise sandboxes that allow
outbound traffic, the impact would be determined on a customer-by-customer basis as it depends on the enterprise
network configuration as it applies to the sandbox.
Nevertheless, enterprises should be aware of this attack variant.
13
CLOUD-BASED ANALYSIS SERVICES
There are several online services that offer analysis of binaries – either by subjecting them to multiple AV products, or by
running proprietary malware analysis logic. Assuming the attacker knows that such services are used (manually, or as a
backend to other security products/services) in the attacked enterprise, the attacker can use the same technique described
above to spawn a binary with embedded enterprise data to be run in the cloud by the online service and exfiltrate the
enterprise data. In this case, while the online service facilitates the attack, it is not a vulnerability in the online service since
there’s no expectation from the service to prevent exfiltration.
Google VirusTotal (https://www.virustotal.com/) was tested with a vanilla (non-triggering) Satellite and with the two
triggering Satellites, just to observe if any of its sandboxes are connected to the Internet. Indeed, we got back sandbox
fingerprints from sandbox templates ROGER-PC (DNS and HTTP), ANTONY-PC (DNS and HTTP), VVHMQ-PC (DNS, HTTP)
,ABC-WIN7 (DNS, HTTP), PC (DNS, HTTP), ADMIN-PC (DNS, HTTP), PERRY-PC (DNS, HTTP), PC 4A095E27CB (DNS,
HTTP), LUSER-PC (DNS, HTTP), APIARY7-PC (DNS, HTTP), MIKI-PC (DNS, HTTP) and MAMEPC (DNS). This is possibly due
to VirusTotal’s scanning with Avira and/or ESET and/or Comodo and/or Kaspersky, and/or by having triggered another cloud
based product which we either didn’t test, or failed to trigger. 
Joe Security’s Joe Sandbox Cloud - File Analyzer (https://www.file-analyzer.net/) was tested with a vanilla Satellite and
was observed to leak via a single sandbox (DNS only, limited to 10 DNS queries). The File Analyzer sandbox we encountered
has the environment variable "COMPUTERNAME" set to "226533".
Payload Security’s Hybrid Analysis (https://www.reverse.it/) was tested with a vanilla Satellite and was observed to leak
via a single sandbox (HTTP and DNS). The Hybrid Analysis sandbox name we encountered is 7YTRfV35L8.
We conclude that when online scanning services VirusTotal, Hybrid Analysis and Joe Sandbox Cloud (and perhaps others)
are used to evaluate a binary (either manually or via a 3rd party product using these services as part of its backend),
exfiltration becomes possible.
VENDOR STATUS 
Cloud AV sandboxes
• 
Avira – fixed on May 2nd (10h30m!).
• 
ESET – fixed on May 15th or before.
• 
Comodo – fixed on May 26th .
• 
Kaspersky - provided to us on July 14th with the following statement: "If customers are concerned about this scenario, 
they may configure their device and security settings accordingly. Those using our consumer products can disable files 
sent to the cloud sandbox without affecting detection effectiveness. Those using corporate products can install Kaspersky 
Private Security Network, the on-premises version of the Kaspersky Security Network cloud service, or a private fix to 
disable files sent to the cloud sandbox."
Cloud-based analysis services
• 
VirusTotal – informed us on June 16th that they WONTFIX, and provided the following statement: "We have our 
sandboxes on the internet on purpose to allow them communicate with C2 machines so we record the traffic".
• 
Joe Security – fixed on June 19th (3d11h!) and provided the following credit acknowledgement: "Improved ISIM max UDP 
request config (@credits to Amit & Itzik from Safebreach)".
• 
Payload Security - informed us on June 23rd that "Payload Security chooses not to comment".
14
IMPROVING AV CLOUD SANDBOXES
Clearly, one way to prevent this attack is to block AV sandboxes from accessing the Internet. Indeed, some cloud AVs
probably do exactly that. 
Of course, this may be too strict in many cases, because it would be interesting to observe the Internet traffic of a
sample. Therefore, we can tune the defense technique a bit. We can only apply Internet blocking for samples not coming
from the Internet (i.e. binaries which are created on the machine, or which are obtained from another machine in the
enterprise). The reasoning is this – a sample which is obtained from the Internet (e.g. downloaded from a website) does
not carry any enterprise endpoint-specific payload, and as such, won’t be able to exfiltrate anything useful from the
endpoint when run in an Internet-connected sandbox.
The same applies for on-premise AV sandboxes.
FUTURE RESEARCH
The technique we developed has a lot of untapped potential. We speculate that there are many additional “supportive”
AV products which we have not marked as such due to the simplicity of our tests. Therefore, there are several options
for future research, such as:
• 
Test additional triggers – e.g. packing the Satellite code with a known packer, connecting to malware C&C, etc.
• 
Test additional exfiltration techniques – e.g. ping (ICMP), HTTPS, SMTP, IRC, connection to popular sites, etc.
• 
Improve the stealth of the Rocket-Satellite combination by compressing/encrypting the Satellite image inside 
       the Rocket.
• 
A more robust alternative to AV triggering is to reverse engineer the protocol between the AV agent on the   
endpoint and the AV cloud or the AV management server, and have the Rocket submit the sample (Satellite)     
directly, without triggering any AV behavioral rule (and without visual cues to the user, and log artifacts).
CONCLUSIONS
We have demonstrated that cloud-based AV sandbox execution can be used to exfiltrate data from endpoint machines
by “burning” the data into the binary to be scanned in the cloud. In this way, even high security enterprises which
prevent their endpoints from directly accessing the Internet, or severely restricting Internet access to endpoints, can still
have their data exfiltrated. We demonstrated this technique successfully with the latest versions of Avira Antivirus Pro,
ESET NOD32 Antivirus, Kaspersky Total Security 2017 and Comodo Client Security. As part of this research we also
made some observations on the sandboxes used by these vendors, and commented on the ease of their detection.
We can generalize our findings and state that sharing an executable (suspicious/malicious sample) from the organization,
with the outside world in some manner (e.g. submitting the sample to a cloud analysis service or allowing such file
submission) can result in data exfiltration, unless there is confidence that the sample has arrived from outside the
organization and the file has not changed since its arrival.
ACKNOWLEDGEMENTS
We would like to thank Yoni Fridburg for his help in setting up the AV research lab. 
15
APPENDIX – FINGERPRINTS OF ENCOUNTERED SANDBOXES
Computer name
C02TT36/C02TT22/C02TT26/C02TT18
Class
C-TT (template C02TT)
Used by
Avira
IP
79.207.224.213 (Deutsche Telekom, Germany) / 
87.162.248.42 (Deutsche Telekom, Germany)
Performance Counter Frequency
2825742
CPU
Intel64 Family 6 Model 45 Stepping 7, GenuineIntel
Domain
C02TT36/C02TT22/C02TT26/C02TT18
Username
Administrator
MAC
Random
Disk Volume Number
a0e1740e
Additional Software
Python TCL/TK
Computer name
C06TT43
Class
C-TT (template C06TT)
Used by
Avira
IP
87.162.248.42 (Deutsche Telekom, Germany)
Performance Counter Frequency
10000000 (probably virtualized)
CPU
Intel64 Family 6 Model 26 Stepping 5, GenuineIntel
Domain
C06TT43
Username
Administrator
MAC
Random
Disk Volume Number
08266a95
Additional Software
Python TCL/TK
Computer name
WIN7-PC
Class
Something-PC
Used by
Comodo
IP
 192.241.99.0/24 (B2 Net, USA)
Performance Counter Frequency
1955556
CPU
Intel64 Family 6 Model 86 Stepping 2, GenuineIntel
Domain
win7-PC
Username
win7
MAC
08:00:27:60:0B:FB (Cadmus) / 08:00:27:63:DC:9F 
(Cadmus), 08:00:27:2D:9B:64 (Cadmus)
Disk Volume Number
c8e74c10
Additional Software
Python
16
Computer name
ROGER-PC
Class
Something-PC
Used by
Comodo, Kaspersky, Avira
IP
95.25.4.0/24 (Beeline, Russia)
Performance Counter Frequency
2734726
CPU
Intel64 Family 6 Model 15 Stepping 11, 
GenuineIntel
Domain
Roger-PC
Username
Roger
MAC
00:07:E9:E4:CE:4D (Intel)
Disk Volume Number
88fdb972
Additional Software
Java
Computer name
0M9P60J5W-PC (and computer names derived from 
“nDfFAdDKCg4D”, “wdqqwmpPw3rg”, “vvhMq”, 
“DfCMD”) (differs from ROGER-PC only by perf. freq. 
counter and username, domain and computer name)
Class
Something-PC
Used by
?
IP
95.25.4.0/24 (Beeline, Russia)
Performance Counter Frequency
2543427
CPU
Intel64 Family 6 Model 15 Stepping 11, 
GenuineIntel
Domain
0M9P60J5W-PC (same as computer name)
Username
0M9P60J5W (computer name without “-PC”)
MAC
00:07:E9:E4:CE:4D (Intel)
Disk Volume Number
88fdb972
Additional Software
Java
Computer name
PERRY-PC
Class
Something-PC
Used by
?
IP
23.253.228.196 (Rackspace, USA)
Performance Counter Frequency
10000000 (probably virtualized)
CPU
Intel64 Family 6 Model 63 Stepping 2, GenuineIntel
Domain
Perry-PC
Username
Perry
MAC
08:00:27:76:47:D9 (Cadmus) / 08:00:27:43:D3:7A 
(Cadmus)
Disk Volume Number
44cb6efe
Additional Software
None?
17
Computer name
DAVID-PC
Class
Something-PC
Used by
Comodo, Avira
IP
66.129.102.52 (Cythereon, USA)
Performance Counter Frequency
14318180
CPU
Intel64 Family 6 Model 45 Stepping 2, GenuineIntel
Domain
David-PC
Username
David
MAC
00:50:56:88:00:BF (VMware) / 00:50:56:88:6C:C2 
(VMware)
Disk Volume Number
24b8ccbd
Additional Software