ä½¿ç”¨ ./bin/datascale æ‰§è¡Œä»»ä½•å‘½ä»¤æ—¶ï¼Œè¯»å–çš„é…ç½®æ–‡ä»¶ ./config/datascale.toml ä¸­
çš„æ¯ä¸ªå‚æ•°ä¹Ÿéƒ½å¯ä»¥è¢«ç›¸å…³çš„ç¯å¢ƒå˜é‡æ‰€è¦†ç›–ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨æŒ‡å®šçš„ç«¯å£å¯åŠ¨ DataScale manager
æœåŠ¡ï¼š
$ export DATASCALE_SERVICE_MODE="manager"
$ export DATASCALE_SERVICE_ADDRESS="localhost:8080"$ ./bin/datascale start
ä¿¡æ¯
æ›´å¤šå…³äºç¯å¢ƒå˜é‡ä½¿ç”¨æ–¹æ³•çš„ä»‹ç»ï¼Œå‚è§ ç¯å¢ƒå˜é‡ã€‚
ç‰ˆæœ¬ï¼š2.13.0-beta
Restful API
	ä¿¡æ¯ 
å…³äº DataScale æœåŠ¡çš„ Restful API å®Œæ•´åˆ—è¡¨ï¼Œå‚è§ ã€‚
ç®¡ç† Restful API 
DataScale æœåŠ¡æä¾›äº†ä¸°å¯Œçš„ Restful API ç”¨äºç®¡ç†æ•°æ®é‡‡é›†ä»»åŠ¡ç›¸å…³çš„é…ç½®ï¼ŒåŒ…æ‹¬ï¼š
â€¢ é…ç½®ç”¨äºç®¡ç† dataflow çš„ worker group
â€¢ é…ç½® dataflow åŠå…¶å†…éƒ¨ sourceã€pipeline å’Œ sink ç»„ä»¶â€¢ å®‰è£…ã€åˆ é™¤è‡ªå®šä¹‰é‡‡é›†å™¨
DataScale å‘½ä»¤è¡Œå·¥å…·å’Œ Web UI ä¸Šæä¾›çš„å„é¡¹ç®¡ç†åŠŸèƒ½éƒ½åŸºäºå¯¹è¿™äº› Restful API çš„è°ƒç”¨ï¼Œè¿™äº› Restful API åŒæ—¶ä¹Ÿä½œä¸º DataScale worker å’Œ manager ä¹‹é—´åŒæ­¥é…ç½®æ•°æ®çš„æ¥å£ã€‚æŒ‡æ ‡ æ ‡ API 
æŒ‡æ ‡ API å¯¹å¤–æä¾› DataScale æœåŠ¡çš„æŒ‡æ ‡æ•°æ®ï¼Œå¯ç”¨äºå¯¹æœåŠ¡çš„ç›‘æ§ã€‚
Heartbeat API 
DataScale worker å’Œ manager ä¹‹é—´çš„ heartbeat æœºåˆ¶ä¹Ÿæ˜¯é€šè¿‡ Restful API è°ƒç”¨æ¥å®Œæˆã€‚
ç‰ˆæœ¬ï¼š2.13.0-beta
è¿›é˜¶æŒ‡å—
æ›´å¤š DataScale çš„ä½¿ç”¨ã€éƒ¨ç½²æŒ‡å—ã€‚
ğŸ“„é™åˆ¶ç³»ç»Ÿèµ„ ç»Ÿèµ„æº
å½“ DataScale æ‰§è¡Œ dataflow æ—¶ï¼Œdataflow çš„æ•°é‡å’Œç¹é‡ç¨‹åº¦å†³å®šäº† DataScale æœåŠ¡æ¶ˆè€—çš„ç³»ç»Ÿèµ„æºçš„å¤šå°‘ã€‚
ğŸ—ƒ DataScale é›†ç¾¤
| 2 ä¸ªé¡¹ç›® |
|---|
| ğŸ—ƒè‡ªå®šä¹‰ ä¹‰é‡‡é›†å™¨ |
2 ä¸ªé¡¹ç›®
	ç‰ˆæœ¬ï¼š2.13.0-beta 
é™åˆ¶ç³»ç»Ÿèµ„ ç»Ÿèµ„æº2 ä¸ªé¡¹ç›®
	ç‰ˆæœ¬ï¼š2.13.0-beta 
é™åˆ¶ç³»ç»Ÿèµ„ ç»Ÿèµ„æº
å½“ DataScale æ‰§è¡Œ dataflow æ—¶ï¼Œdataflow çš„æ•°é‡å’Œç¹é‡ç¨‹åº¦å†³å®šäº† DataScale æœåŠ¡æ¶ˆè€—çš„ç³»ç»Ÿ èµ„æºçš„å¤šå°‘ã€‚å½“ä½ å°† DataScale æœåŠ¡å’Œå…¶ä»–æœåŠ¡éƒ¨ç½²åœ¨åŒä¸€å°ä¸»æœºæ—¶ï¼Œä½ å¯èƒ½ä¼šå¸Œæœ›ä¸è¦å› ä¸º DataScale æœåŠ¡å ç”¨äº†è¿‡å¤šçš„ç³»ç»Ÿèµ„æºï¼Œè€Œå½±å“åˆ°å…¶ä»–æœåŠ¡çš„è¿è¡Œã€‚è¿™æ—¶ï¼Œä½ å¯ä»¥è®¾ç½® DataScale æœåŠ¡å¯ä»¥ä½¿ç”¨çš„ç³»ç»Ÿèµ„æºï¼ˆCPU å’Œå†…å­˜ï¼‰çš„ä¸Šé™ï¼Œç¡®ä¿å…¶ä»–æœåŠ¡å¯ä»¥å¾—åˆ°å¿…è¦çš„ç³»ç»Ÿèµ„æºã€‚
ä½¿ç”¨ Docker / Kubernetes
å¦‚æœæ˜¯åœ¨ Docker æˆ–è€… Kubernetes çš„ç¯å¢ƒä¸­è¿è¡Œ DataScale æœåŠ¡ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒä»¬çš„æœºåˆ¶å¯¹å®¹å™¨
åšèµ„æºé™åˆ¶ã€‚
å…·ä½“æ–¹æ³•å¯ä»¥å‚è€ƒ Docker æˆ–è€… Kubernetes çš„èµ„æºç®¡ç†ç›¸å…³æ–‡æ¡£ã€‚
ä½¿ç”¨ Systemdï¼ˆåªé€‚ç”¨äº Linux å¹³å°ï¼‰ä½¿ç”¨ Systemdï¼ˆåªé€‚ç”¨äº Linux å¹³å°ï¼‰
å¦‚æœä½ æ˜¯ä½¿ç”¨ Systemd ç®¡ç† DataScale æœåŠ¡ï¼ŒSystemd ä¹Ÿæä¾›äº†ä¸€å¥—èµ„æºç®¡ç†æœºåˆ¶ã€‚
åœ¨å®‰è£… DataScale æœåŠ¡ä¹‹å‰ï¼Œä½ å¯ä»¥ä¿®æ”¹ DataScale å®‰è£…åŒ…ä¸‹çš„ Systemd æœåŠ¡é…ç½®æ¨¡ç‰ˆæ–‡ä»¶ init/systemd/datascale.service.templateï¼Œæ‰“å¼€èµ„æºé™åˆ¶çš„åŠŸèƒ½ï¼Œå¹¶åˆ†é…åˆé€‚æ•°é‡çš„ CPU å’Œå†…å­˜èµ„æºã€‚
å‡è®¾ä½ å¸Œæœ›ä¸º DataScale æœåŠ¡è®¾ç½®çš„èµ„æºä¸Šé™æ˜¯æœ€å¤šç”¨æ»¡ä¸€ä¸ª CPU core ä»¥åŠæœ€å¤šä½¿ç”¨ 1GB å†… å­˜ï¼Œé…ç½®æ–‡ä»¶ä¸­çš„ç›¸å…³å‚æ•°åº”è¯¥è®¾ç½®ä¸ºï¼š
[Service]
...
CPUAccounting=yes
å¯¹äºå·²ç»å®‰è£…æˆ–è€…æ­£åœ¨è¿è¡Œä¸­çš„ DataScale æœåŠ¡ï¼Œä½ å¯ä»¥ä¿®æ”¹ Systemd æœåŠ¡é…ç½®æ–‡ä»¶ /usr/ lib/systemd/system/datascale.serviceä¸­çš„ä¸Šè¿°å‚æ•°ä»¥è°ƒæ•´èµ„æºé™åˆ¶çš„è®¾ç½®ï¼Œå¹¶é‡æ–° åŠ è½½æœåŠ¡ä½¿æ–°è®¾ç½®ç”Ÿæ•ˆï¼š$ sudo systemctl daemon-reload
å¦‚éœ€äº†è§£æ›´å¤šç»†èŠ‚ï¼Œå¯ä»¥å‚è€ƒ Systemd æ–‡æ¡£ ã€‚
ä½¿ç”¨ cgroupï¼ˆåªé€‚ç”¨äº Linux å¹³å°ï¼‰
å¦‚æœä¸Šè¿°æ–¹å¼éƒ½ä¸é€‚ç”¨äºä½ çš„ä½¿ç”¨åœºæ™¯ï¼ŒDataScale æœåŠ¡è¿˜æä¾›äº†å†…ç½®çš„åŸºäº cgroup çš„èµ„æºé™åˆ¶æœº
åˆ¶ã€‚åœ¨é…ç½®æ–‡ä»¶ config/datascale.toml ä¸­ï¼Œ resources.cpu_quota å’Œ resources.memory_limitå‚æ•°åˆ†åˆ«è®¾ç½® CPU å’Œå†…å­˜çš„ä½¿ç”¨ä¸Šé™ã€‚
å‡è®¾ä½ å¸Œæœ›ä¸º DataScale æœåŠ¡è®¾ç½®çš„èµ„æºä¸Šé™æ˜¯æœ€å¤šç”¨æ»¡ä¸€ä¸ª CPU core ä»¥åŠæœ€å¤šä½¿ç”¨ 1GB å†… å­˜ï¼Œé…ç½®æ–‡ä»¶ä¸­çš„ç›¸å…³å‚æ•°åº”è¯¥è®¾ç½®ä¸ºï¼š
[resources] 
# The CPU limit expressed as a percentage and is relative to a single core.# For examples: 
# 0 is "no limit"; 50 is 50% of a core; 200% is two cores.
cpu_quota = 100 
# Memory limit (in MB).
# For examples: 
# 0 is "no limit"; 1024 is 1GB 
memory_limit  = 1024
ä¿¡æ¯
â€¢ ç›®å‰ï¼Œä½¿ç”¨ cgroup çš„æ–¹å¼é™åˆ¶ç³»ç»Ÿèµ„æºéœ€è¦ä½¿ç”¨ root è´¦å·è¿è¡Œ DataScale æœåŠ¡
â€¢ ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ä¸Šè¿°å‚æ•°åï¼Œéœ€è¦é‡å¯ DataScale æœåŠ¡ä½¿æ–°å‚æ•°ç”Ÿæ•ˆ
å¦‚éœ€äº†è§£æ›´å¤š cgroup çš„æŠ€æœ¯ç»†èŠ‚ï¼Œå¯ä»¥å‚è€ƒæ–‡æ¡£ .
ç‰ˆæœ¬ï¼š2.13.0-beta
DataScale é›†ç¾¤
å…³äºä½¿ç”¨ DataScale é›†ç¾¤åŠŸèƒ½çš„ä»‹ç»ã€‚
ğŸ“„éƒ¨ç½² DataScale é›†ç¾¤ğŸ“„éƒ¨ç½² DataScale é›†ç¾¤
æœ¬æ–‡æ¡£å°†æŒ‡å¯¼ç”¨æˆ·å¿«é€Ÿæ­å»ºä¸€ä¸ªç®€å•çš„ DataScale é›†ç¾¤ï¼ŒåŒ…æ‹¬ä¸€ä¸ª DataScale manager å’Œä¸¤ä¸ª DataScale workerã€‚
ğŸ“„ç®¡ç† DataScale Worker çš„ç¾¤ç»„
DataScale worker çš„ç¾¤ç»„ç®¡ç†æœ‰ä¸¤ç§æ–¹å¼ï¼š
ç‰ˆæœ¬ï¼š2.13.0-beta
éƒ¨ç½² DataScale é›†ç¾¤
æœ¬æ–‡æ¡£å°†æŒ‡å¯¼ç”¨æˆ·å¿«é€Ÿæ­å»ºä¸€ä¸ªç®€å•çš„ DataScale é›†ç¾¤ï¼ŒåŒ…æ‹¬ä¸€ä¸ª DataScale manager å’Œä¸¤ä¸ª DataScale workerã€‚ä¸¤ä¸ª DataScale worker åˆ†åˆ«å±äºä¸åŒçš„ groupï¼Œå› æ­¤ DataScale manager éœ€è¦ç®¡ç†ä¸¤ä¸ª worker ä¸Šçš„ä¸åŒçš„ dataflow é…ç½®ã€‚
ä¿¡æ¯
â€¢ å…³äº DataScale é›†ç¾¤çš„å·¥ä½œæœºåˆ¶ï¼Œå‚è§ DataScale é›†ç¾¤ã€‚â€¢ å…³äº DataScale é›†ç¾¤çš„å·¥ä½œæœºåˆ¶ï¼Œå‚è§ DataScale é›†ç¾¤ã€‚
â€¢ æœ¬æ–‡æ¡£å‡è®¾ DataScale çš„ manager å’Œ worker åˆ†åˆ«éƒ¨ç½²åœ¨ä¸åŒçš„ä¸»æœºï¼Œå› æ­¤ä¸éœ€è¦è€ƒè™‘ åœ¨åŒä¸€å°ä¸»æœºéƒ¨ç½²å¤šä¸ª DataScale æœåŠ¡å¯¼è‡´çš„ç«¯å£åœ°å€å†²çªã€‚å…³äºä¿®æ”¹ DataScale æœåŠ¡ çš„ç›‘å¬åœ°å€ï¼Œå‚è§ Service é…ç½®ã€‚
éƒ¨ç½²å‰çš„å‡†å¤‡
â€¢ å®Œæˆæ–‡æ¡£ å®‰è£…å‰çš„å‡†å¤‡ ä¸­çš„å‡†å¤‡æ­¥éª¤ã€‚
â€¢ åœ¨ç‚å‡°æ•°æ®å¹³å°ä¸­å‡†å¤‡å¥½æ•°æ®é›† my_datascale_cluster ã€‚
æ‰‹åŠ¨ åŠ¨éƒ¨ç½² DataScale é›†ç¾¤
éƒ¨ç½² manager
â€¢ é€‰æ‹©ä¸€å°ä¸»æœºå®‰è£… DataScaleï¼Œå¹¶å‚ç…§æ–‡æ¡£ é…ç½® DataScale æœåŠ¡ å®Œæˆé…ç½®ï¼š
â—¦ æœåŠ¡åœ¨ manager æ¨¡å¼ä¸‹è¿è¡Œ
å‡è®¾è¿è¡Œ manager çš„ä¸»æœºåä¸º master1ï¼Œåˆ™ manager å¯åŠ¨åçš„é»˜è®¤ Web UI åœ°å€ä¸ºhttp://master1:7880ï¼Œé»˜è®¤ Restful API åœ°å€ä¸ºhttp://master1:7881ã€‚
â€¢ å‚ç…§æ–‡æ¡£ é…ç½® Groupï¼Œåˆ›å»ºåç§°ä¸º another_group çš„ groupã€‚
éƒ¨ç½² workers
å¦å¤–é€‰æ‹©ä¸¤å°ä¸»æœºå®‰è£… DataScaleï¼Œå¹¶å‚ç…§æ–‡æ¡£ é…ç½® DataScale æœåŠ¡ å®Œæˆé…ç½®ï¼š
â€¢ æœåŠ¡åœ¨ worker æ¨¡å¼ä¸‹è¿è¡Œ
â€¢ worker æ‰€å±çš„ manager åœ°å€å’Œ group
å‡è®¾è¿è¡Œ worker çš„ä¸¤å°ä¸»æœºååˆ†åˆ«ä¸º worker1 å’Œ worker2ï¼Œåˆ™ä»–ä»¬çš„é…ç½®æ–‡ä»¶ config/ datascale.tomlä¸­çš„serviceé…ç½®åˆ†åˆ«ä¸ºï¼š
â€¢ worker1 åˆ†é…åˆ° group default
[service] 
mode = "worker" 
[service.worker]mode = "worker" 
[service.worker] 
	manager_address = "http://master1:7881" 	groups = "default"
â€¢ worker2 åˆ†é…åˆ° group another_group
[service] 
mode = "worker" 
[service.worker] 
	manager_address = "http://master1:7881" 	groups = "another_group"
åˆ›å»º dataflow
å‚ç…§æ–‡æ¡£ é…ç½® Dataflowï¼Œåˆ†åˆ«åœ¨ manager ä¸Šçš„ group default å’Œ another_group ä¸­åˆ›å»º dataflowã€‚è¿™äº›æ–°åˆ›å»ºçš„ dataflow å°†ä¼šç«‹åˆ»è‡ªåŠ¨åŒæ­¥åˆ°å¯¹åº”çš„ workerã€‚
â€¢ åœ¨ default group ä¸­åˆ›å»º dataflow default_dataflow ï¼Œé…ç½®å¦‚ä¸‹ï¼š{ 
	"name": "default_dataflow", 
	"sources": [ 
	{ 
	"name": "my_source", 
	"type": "exec", 
	"conf": { 
	"command": "echo \"Dataflow is default_dataflow and host is $HOSTNAME\"", 
	"mode": "scheduled", 
	"scheduled": { 
	"exec_interval_secs": 10 
	} 
	} 
	} 
	], 
	"pipelines": [], 
	"sinks": [ 
	{ 
	"name": "my_sink", 
	"inputs": [ "my_source" ], 
	"type": "yh", 
	"conf": { 
	"event_set": "my_datascale_cluster""event_set": "my_datascale_cluster" 
	} 
	} 
	]
â€¢ åœ¨ another_group group ä¸­åˆ›å»º dataflow another_dataflow ï¼Œé…ç½®å¦‚ä¸‹ï¼š
{ 
	"name": "another_dataflow", 
	"sources": [ 
	{ 
	"name": "my_source", 
	"type": "exec", 
	"conf": { 
	"command": "echo \"Dataflow is another_dataflow and host is $HOSTNAME\"", 
	"mode": "scheduled", 
	"scheduled": { 
	"exec_interval_secs": 10 
	} 
	} 
	} 
	], 
	"pipelines": [],} 
	} 
	} 
	], 
	"pipelines": [], 
	"sinks": [ 
	{ 
	"name": "my_sink", 
	"inputs": [ "my_source" ], 
	"type": "yh", 
	"conf": { 
	"event_set": "my_datascale_cluster" 
	} 
	} 
	] 
}
åœ¨ DataScale Web UI ä¸­æŸ¥ æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€
åœ¨ DataScale Monitoring ä»ª ä»ªè¡¨æ¿ä¸­æŸ¥ æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€
ä»ªè¡¨æ¿ä¸­å¯ä»¥çœ‹åˆ°ä¸€ä¸ª managerï¼Œä¸¤ä¸ª workerï¼Œä»¥åŠ groupã€dataflow åŠå…¶ç»„ä»¶çš„æ•°é‡ç­‰ï¼š
åœ¨ç‚å‡°æ•°æ®å¹³å°ä¸­æŸ¥è¯¢ æŸ¥è¯¢ workers é‡‡é›†åˆ°çš„ events 
ä»æŸ¥è¯¢æ•°æ®é›† my_datascale_cluster å¾—åˆ°çš„ events å¯ä»¥çœ‹åˆ°ä¸¤ä¸ª worker åˆ†åˆ«æ‰§è¡Œäº†ä¸åŒgroup ä¸­çš„ dataflowï¼š
ä½¿ç”¨ Ansible éƒ¨ç½² DataScale é›†ç¾¤
ä¿¡æ¯
ç›®å‰ï¼ŒDataScale Ansible å·¥å…·åŒ…ä»…æ”¯æŒåœ¨å…·æœ‰ Systemd æœåŠ¡ç®¡ç†å™¨çš„ Linux æ“ä½œç³»ç»Ÿä¸Šéƒ¨
ç½² DataScale é›†ç¾¤ã€‚
éƒ¨ç½²å‰çš„å‡†å¤‡
â€¢ åœ¨æ§åˆ¶ä¸»æœºä¸Šå®‰è£… ã€‚
â€¢ è®¾ç½®ä»æ§åˆ¶ä¸»æœºåˆ°å³å°†å®‰è£… DataScale manager å’Œ worker çš„ä¸‰å°ä¸»æœºçš„ SSH è¿æ¥ã€‚
â€¢ ä¸‹è½½ DataScale Ansible å·¥å…·åŒ…ã€‚
	ä¿¡æ¯ 
å·¥å…·åŒ…å¯é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼è·å¾—ï¼š
â—¦ Uç›˜ç›´æ¥æ‹·è´
â—¦ åœ¨çº¿ä¸‹è½½(é“¾æ¥ç”±ç‚å‡°æ•°æ®å›¢é˜Ÿæä¾›)
åˆå§‹åŒ–å®‰è£…åŒ…å’Œé…ç½®æ–‡ä»¶
â€¢ å°† DataScale Ansible å·¥å…·åŒ…æ‹·è´åˆ°æ§åˆ¶ä¸»æœºï¼Œå¹¶è§£å‹å·¥å…·åŒ…
$ tar zxvf datascale-ansible-X.Y.Z.tar.gz 
$ cd datascale-ansible/$ cd datascale-ansible/ 
$ ls 
README.md       config          hosts           playbook vars.yaml
â€¢ å°† DataScale å®‰è£…åŒ…æ‹·è´è‡³ ./playbook/files/ ç›®å½•ä¸‹
â€¢ ä»å®‰è£…åŒ…ä¸­æå–å‡ºåˆå§‹é…ç½®ï¼Œå­˜æ”¾è‡³ ./config/ ç›®å½•
	ä¿¡æ¯ 
å¦‚æœä½ ä¸éœ€è¦é›†ä¸­ç®¡ç† DataScale éƒ¨ç½²çš„é…ç½®æ–‡ä»¶ï¼Œä½ å¯ä»¥ï¼š
â—¦ åªæå– config/datascale.toml é…ç½®æ–‡ä»¶è‡³ ./config/ ç›®å½•
â—¦ åç»­çš„ DataScale æœåŠ¡é…ç½®ã€group å’Œ dataflow çš„åˆ›å»ºç­‰æ­¥éª¤ï¼Œéƒ½å¯ä»¥åœ¨ 	DataScale æœåŠ¡éƒ¨ç½²ä¹‹åå†é€šè¿‡ DataScale manager çš„ Web UI å®Œæˆé…ç½®ã€‚$ tar zxvf playbook/files/datascale-X.Y.Z-x86_64-linux.tar.gz-C config/ --transform 's,^datascale/config,,' datascale/ config/ 
$ ls config/ 