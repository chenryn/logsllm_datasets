{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "内存不够用，需要增加内存或优化相关SQL", "knowledge_description": "查看等待分配内存的进程信息"}, {"knowledge_name": "根据智能诊断发现的异常指标以及推荐的诊断路径下钻分析", "knowledge_description": "泛路由-SQLServer 内存情况分析"}, {"knowledge_name": "查找出消耗内存多的会话和SQL，并对SQL进行优化", "knowledge_description": "查看数据库使用内存明细"}, {"knowledge_name": "优化表结构数据", "knowledge_description": "查看占用缓存多的对象"}, {"knowledge_name": "及时添加索引将大大提升查询效率", "knowledge_description": "查看查询中缺少的索引情况"}, {"knowledge_name": "启用optimize for ad hoc workloads启用参数化来优化此问题，但要提前测试！！！", "knowledge_description": "查看即席查询(Adhoc)的执行计划占用内存情况"}, {"knowledge_name": "优化占用内存多的对象和SQL执行计划", "knowledge_description": "查看TOP 10 内存分配器占用内存情况"}], "description": "内存不够，存在等待内存的进程", "rule_name": "memory_presure", "id": "4447", "rule_expression": "[metric,2151003]<[num,$1] && ([metric,2151054]>[num,$2] || [metric,2151087]>[num,$3])", "db_type": "SQL Server", "warning_level": "2"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_description": "查看数据库日志"}], "description": "最近数据库发生了重启事件", "rule_name": "db_restart_mssql", "id": "4471", "rule_expression": null, "db_type": "SQL Server", "warning_level": "4", "warning_message": "数据库在{[metric,2150006]}秒前发生了重启"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "请在主库上执行该知识点", "knowledge_description": "查看日志传输还原的错误信息"}, {"knowledge_name": "在从库上运行该知识点", "knowledge_description": "查看从库还原日志情况"}], "description": "日志传输还原延迟时间过高，超过1分钟", "rule_name": "mssql_log_skipping_relay_high", "id": "5316", "rule_expression": null, "db_type": "SQL Server", "warning_level": "2"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "增加参数值", "knowledge_description": "检查max server memory (MB)数据库参数是否设置合理"}, {"knowledge_name": "参考下面建议", "knowledge_description": "查看各个对象、实例的缓存命中率"}, {"knowledge_description": "检查数据库占用内存情况"}, {"knowledge_name": "查找出消耗内存多的会话和SQL，并对SQL进行优化", "knowledge_description": "查看数据库使用内存明细"}, {"knowledge_name": "优化表结构数据", "knowledge_description": "查看占用缓存多的对象"}], "description": "Buffer Hit % 低于90%，说明系统系统存在问题", "rule_name": "buffer_cache_hit_ratio_mssql", "id": "4473", "rule_expression": null, "db_type": "SQL Server", "warning_level": "2"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "优化SQL", "knowledge_description": "物理读高的SQL"}, {"knowledge_name": "减少SQL运行次数或优化相关执行时间长的SQL", "knowledge_description": "运行次数多的SQL"}, {"knowledge_name": "优化SQL，添加索引，减少返回行数", "knowledge_description": "查看返回行数较高的SQL"}, {"knowledge_name": "查找出消耗内存多的会话和SQL，并对SQL进行优化", "knowledge_description": "查看数据库使用内存明细"}, {"knowledge_description": "检查数据库占用内存情况"}], "description": "每秒物理读远超出平时平均值10倍，并且超过基线0.8倍，说明应用或者数据出现了异常", "rule_name": "more_phy_read_mssql", "id": "4459", "rule_expression": "[metric,2151077]/[metric hour avg,2151077]>[num,$1] && [metric,2151077]>[bsl upper,2151077]*[num,$2]", "db_type": "SQL Server", "warning_level": "2", "warning_message": "每秒物理读{[metric,2151077]}超出小时平均值{$1}倍，并且超过基线{$2}倍，应用或者数据出现了异常"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "优化SQL", "knowledge_description": "逻辑读高的SQL"}, {"knowledge_name": "如果某个数据文件IO压力较大，可将热对象移动到其他数据文件或性能更好的磁盘上。或者优化某个引起该问题的SQL语句。", "knowledge_description": "查看数据文件IO相关状态信息"}, {"knowledge_name": "及时删除多余索引", "knowledge_description": "检查未使用的索引信息"}], "description": "每秒逻辑读超过平时平均值10倍，并且超过基线0.8倍，说明应用或者数据出现了异常", "rule_name": "more_logical_read_mssql", "id": "4461", "rule_expression": "[metric,2151078]/[metric hour avg,2151078]>[num,$1] && [metric,2151078]>[bsl upper,2151078]*[num,$2]", "db_type": "SQL Server", "warning_level": "2"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "优化运行时间长的SQL、减少长连接", "knowledge_description": "查看会话信息"}, {"knowledge_name": "减少SQL运行次数或优化相关执行时间长的SQL", "knowledge_description": "运行次数多的SQL"}, {"knowledge_name": "KILL会话", "knowledge_description": "查看锁时间超过5秒的会话信息，请及时确认是否正常，否则应KILL会话"}], "description": "每秒登录超过20次，说明数据库存在频繁登陆", "rule_name": "more_logons_mssql", "id": "4469", "rule_expression": null, "db_type": "SQL Server", "warning_level": "2"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "优化SQL", "knowledge_description": "查看运行时间长的SQL"}, {"knowledge_name": "KILL会话", "knowledge_description": "查看锁时间超过5秒的会话信息，请及时确认是否正常，否则应KILL会话"}, {"knowledge_name": "优化运行时间长的SQL、减少长连接", "knowledge_description": "查看会话信息"}], "description": "当前活动会话数超过100个，数据库可能存在问题", "rule_name": "more_active_session_mssql", "id": "4467", "rule_expression": null, "db_type": "SQL Server", "warning_level": "4"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "KILL会话", "knowledge_description": "查看锁时间超过5秒的会话信息，请及时确认是否正常，否则应KILL会话"}, {"knowledge_name": "优化运行时间长的SQL、减少长连接", "knowledge_description": "查看会话信息"}, {"knowledge_name": "优化SQL", "knowledge_description": "查看运行时间长的SQL"}, {"knowledge_name": "KILL会话", "knowledge_description": "查看锁时间超过5秒的会话信息，请及时确认是否正常，否则应KILL会话"}, {"knowledge_name": "优化运行时间长的SQL、减少长连接", "knowledge_description": "查看会话信息"}, {"knowledge_name": "优化SQL", "knowledge_description": "查看运行时间长的SQL"}], "description": "被阻塞的会话数超过5则说明系统存在隐患", "rule_name": "block_session_mssql", "id": "4475", "rule_expression": "[metric in time,10,2151143] >[num,$1]", "db_type": "SQL Server", "warning_level": "3"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "优化SQL", "knowledge_description": "查看运行时间长的SQL"}, {"knowledge_name": "优化SQL", "knowledge_description": "物理读高的SQL"}, {"knowledge_name": "及时删除多余索引", "knowledge_description": "检查未使用的索引信息"}, {"knowledge_name": "重建索引", "knowledge_description": "查看索引碎片"}, {"knowledge_name": "根据智能诊断发现的异常指标以及推荐的诊断路径下钻分析", "knowledge_description": "泛路由-SQLServer IO情况分析"}], "description": "平均执行时间超过5秒的SQL数量超过10个，表示系统存在系统问题", "rule_name": "long_sqls_mssql", "id": "4481", "rule_expression": null, "db_type": "SQL Server", "warning_level": "2"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "优化SQL", "knowledge_description": "物理读高的SQL"}, {"knowledge_name": "如果某个数据文件IO压力较大，可将热对象移动到其他数据文件或性能更好的磁盘上。或者优化某个引起该问题的SQL语句。", "knowledge_description": "查看数据文件IO相关状态信息"}, {"knowledge_name": "及时添加索引将大大提升查询效率", "knowledge_description": "查看查询中缺少的索引情况"}, {"knowledge_name": "提升磁盘IO性能，分开存放日志文件和数据文件", "knowledge_description": "查看WRITELOG等待事件信息"}, {"knowledge_name": "优化SQL，减少磁盘IO操作。使用性能更好的磁盘。", "knowledge_description": "查看IO_COMPLETION等待事件信息"}, {"knowledge_name": "分析服务器IO设备的IO情况", "knowledge_description": "分析服务器IO设备的IO情况"}, {"knowledge_name": "提升磁盘性能", "knowledge_description": "查看PAGEIOLAT_SH等待事件的信息"}, {"knowledge_name": "提升磁盘性能，优化相关SQL，将日志文件、临时文件和数据文件存放到不同磁盘等", "knowledge_description": "查看PAGEIOLAT_DT等待事件的信息"}, {"knowledge_name": "根据智能诊断发现的异常指标以及推荐的诊断路径下钻分析", "knowledge_description": "泛路由-SQLServer IO情况分析"}], "description": "磁盘IO高", "rule_name": "disk_reads", "id": "4405", "rule_expression": null, "db_type": "SQL Server", "warning_level": "2"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "优化SQL", "knowledge_description": "查看运行时间长的SQL"}, {"knowledge_name": "KILL会话", "knowledge_description": "查看锁时间超过5秒的会话信息，请及时确认是否正常，否则应KILL会话"}, {"knowledge_name": "提升磁盘IO性能，分开存放日志文件和数据文件", "knowledge_description": "查看WRITELOG等待事件信息"}], "description": "每秒事务数（User Transaction Per Sec）超过最近1小时平均值的10倍，说明应用可能存在异常", "rule_name": "more_trans_mssql", "id": "4465", "rule_expression": "[metric,2151061]/[metric hour avg,2151061]>[num,$1]", "db_type": "SQL Server", "warning_level": "2"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "优化SQL", "knowledge_description": "查看运行时间长的SQL"}, {"knowledge_name": "优化SQL", "knowledge_description": "物理读高的SQL"}, {"knowledge_name": "及时删除多余索引", "knowledge_description": "检查未使用的索引信息"}, {"knowledge_name": "请及时收集统计或设置自动收集统计信息，有利于生成更准确的执行计划", "knowledge_description": "缺少统计信息或统计信息陈旧的索引"}, {"knowledge_name": "优化SQL，添加索引，减少返回行数", "knowledge_description": "查看返回行数较高的SQL"}], "description": "每秒全表扫描次数超过20次，说明数据库存在性能问题", "rule_name": "full_scans_mssql", "id": "4483", "rule_expression": null, "db_type": "SQL Server", "warning_level": "2"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "检查网络、数据库压力、磁盘IO", "knowledge_description": "查看Always on集群概况"}, {"knowledge_name": "检查网络带宽", "knowledge_description": "查看Always on集群同步延迟"}, {"knowledge_description": "查看高可用组AG状态"}, {"knowledge_description": "查看TCP监听状态"}, {"knowledge_description": "查看数据库日志"}], "description": "Always on集群中从库未应用的日志大小超过1MB，请确认从库是否正常", "rule_name": "alwayson_redo_queue_size", "id": "4491", "rule_expression": null, "db_type": "SQL Server", "warning_level": "3"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "重建索引", "knowledge_description": "查看索引页拆分情况"}, {"knowledge_name": "重建索引", "knowledge_description": "查看索引碎片"}, {"knowledge_name": "如果某个数据文件IO压力较大，可将热对象移动到其他数据文件或性能更好的磁盘上。或者优化某个引起该问题的SQL语句。", "knowledge_description": "查看数据文件IO相关状态信息"}, {"knowledge_name": "针对不同的指标、进行针对性的分析", "knowledge_description": "SqlServer数据库负载指标分析"}], "description": "页拆分次数过高，页拆分是个很昂贵得动作，除了IO操作外，还会引起表碎片问题", "rule_name": "mssql_page_splits", "id": "121", "rule_expression": "[metric,2151130]>[num,$1] || [metric,2151130]/[metric hour avg,2151132]>[num,$2] ", "db_type": "SQL Server", "warning_level": "2"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "1.添加数据文件。2.调整数据文件自动增长", "knowledge_description": "查看数据文件空间使用率"}, {"knowledge_name": "请删除不需要的文件、删除文件组中的对象、将其他文件添加到文件组或为文件组中的现有文件启用自动增长，以便增加可用磁盘空间。", "knowledge_description": "查看数据文件所在磁盘的空间使用率"}], "description": "数据文件可扩展最大可用大小小于5000MB", "rule_name": "mssql_max_avail_file", "id": "4497", "rule_expression": "[metric min,2154007] < [num,$1]", "db_type": "SQL Server", "warning_level": "2", "warning_message": "{[metric iname,2154007]}的最大可用大小小于5000 MB，为{[metric min iname,2154007]} MB"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "检查网络带宽", "knowledge_description": "查看Always on集群同步延迟"}, {"knowledge_name": "检查网络、数据库压力、磁盘IO", "knowledge_description": "查看Always on集群概况"}, {"knowledge_description": "查看高可用组AG状态"}, {"knowledge_description": "查看数据库日志"}], "description": "Always on集群某个副本从库延迟时间超过5秒，请确认网络是否正常、数据库是否存在大事务。", "rule_name": "alwayson_relay", "id": "4487", "rule_expression": null, "db_type": "SQL Server", "warning_level": "2"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_description": "查看高可用组AG状态"}, {"knowledge_name": "检查网络带宽", "knowledge_description": "查看Always on集群同步延迟"}, {"knowledge_name": "检查网络、数据库压力、磁盘IO", "knowledge_description": "查看Always on集群概况"}, {"knowledge_description": "查看TCP监听状态"}, {"knowledge_description": "查看数据库日志"}], "description": "Always on集群处于非健康状态", "rule_name": "alwayson_healthy", "id": "8054", "rule_expression": null, "db_type": "SQL Server", "warning_level": "4"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "优化SQL", "knowledge_description": "CPU时间高的SQL"}, {"knowledge_description": "分析指标、SQL相似度"}, {"knowledge_description": "按CPU时间排序的TOP 20 存储过程"}, {"knowledge_name": "保证SQL语句WHERE条件指定类型和字段类型一致", "knowledge_description": "查看TOP 10发生隐式转换的SQL"}, {"knowledge_name": "根据智能诊断发现的异常指标以及推荐的诊断路径下钻分析", "knowledge_description": "泛路由-SQLServer CPU情况分析"}], "description": "CPU使用率超过80%，CPU可能存在压力", "rule_name": "cpu_use", "id": "4401", "rule_expression": null, "db_type": "SQL Server", "warning_level": "2"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "根据智能诊断发现的异常指标以及推荐的诊断路径下钻分析", "knowledge_description": "泛路由-SQLServer IO情况分析"}, {"knowledge_name": "如果某个数据文件IO压力较大，可将热对象移动到其他数据文件或性能更好的磁盘上。或者优化某个引起该问题的SQL语句。", "knowledge_description": "查看数据文件IO相关状态信息"}, {"knowledge_name": "分析服务器IO设备的IO情况", "knowledge_description": "分析服务器IO设备的IO情况"}, {"knowledge_name": "优化SQL", "knowledge_description": "物理读高的SQL"}], "description": "数据文件IO延迟超过50毫秒，说明数据库性能有问题", "rule_name": "file_io_stall_mssql", "id": "4485", "rule_expression": null, "db_type": "SQL Server", "warning_level": "3"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "优化运行时间长的SQL、减少长连接", "knowledge_description": "查看会话信息"}, {"knowledge_name": "KILL会话", "knowledge_description": "查看锁时间超过5秒的会话信息，请及时确认是否正常，否则应KILL会话"}], "description": "锁时间超过30秒，请确认是否需要KILL", "rule_name": "wait_time_locks", "id": "4445", "rule_expression": "[metric,2152037]>[num,$1]", "db_type": "SQL Server", "warning_level": "3", "warning_message": "{[metric iname,2152037]的}的锁时间超过30秒，为{$1}毫秒。"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "请删除不需要的文件、删除文件组中的对象、将其他文件添加到文件组或为文件组中的现有文件启用自动增长，以便增加可用磁盘空间。", "knowledge_description": "查看数据文件所在磁盘的空间使用率"}, {"knowledge_name": "1.添加数据文件。2.调整数据文件自动增长", "knowledge_description": "查看数据文件空间使用率"}], "description": "数据文件所在磁盘可用大小，小于10GB，请及时添加存储或清除无效大对象", "rule_name": "mssql_disk_avail", "id": "4501", "rule_expression": null, "db_type": "SQL Server", "warning_level": "4", "warning_message": "{[metric iname,2154010]}的最大可用大小小于10GB，为{[metric,2154010]}GB"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "1.添加数据文件。2.调整数据文件自动增长", "knowledge_description": "查看数据文件空间使用率"}, {"knowledge_name": "请删除不需要的文件、删除文件组中的对象、将其他文件添加到文件组或为文件组中的现有文件启用自动增长，以便增加可用磁盘空间。", "knowledge_description": "查看数据文件所在磁盘的空间使用率"}], "description": "数据文件可扩展最大大小的已使用率超过90%", "rule_name": "mssql_max_used_per_file", "id": "4499", "rule_expression": null, "db_type": "SQL Server", "warning_level": "4", "warning_message": "{[metric iname,2154009]}的最大使用率超过90%，为{[metric,2154009]}%"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_description": "查看高可用组AG状态"}, {"knowledge_name": "检查网络带宽", "knowledge_description": "查看Always on集群同步延迟"}, {"knowledge_name": "检查网络、数据库压力、磁盘IO", "knowledge_description": "查看Always on集群概况"}, {"knowledge_description": "查看TCP监听状态"}, {"knowledge_description": "查看数据库日志"}], "description": "Always on集群处于非健康状态", "rule_name": "alwayson_healthy", "id": "4489", "rule_expression": null, "db_type": "SQL Server", "warning_level": "4"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_description": "数据库同步实时检查"}, {"knowledge_description": "查看TCP监听状态"}, {"knowledge_name": "优化运行时间长的SQL、减少长连接", "knowledge_description": "查看会话信息"}, {"knowledge_description": "查看指定数据库的详细信息"}, {"knowledge_name": "根据建议优化相应问题", "knowledge_description": "分析数据库实例情况"}], "description": "数据库同步异常", "rule_name": "mirroring_disnormal", "id": "8285", "rule_expression": "[metric,2151142] == [num,0] || [metric,2151142] == [num,1] || [metric,2151142] == [num,3] || [metric,2151142] == [num,5]", "db_type": "SQL Server", "warning_level": "4"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "立即检查并确认是否正常", "knowledge_description": "查看数据库基本信息"}], "description": "存在处于异常状态的数据库", "rule_name": "anomaly_database_mssql", "id": "11942", "rule_expression": "[metric in time,5,2150064][oper,>=][num,$1]", "db_type": "SQL Server", "warning_level": "4", "warning_message": "存在处于{[metric iname,2150064]}状态数据库的数量为：{[metric in time,5,2150064]}，请立即确认"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "根据智能诊断发现的异常指标以及推荐的诊断路径下钻分析", "knowledge_description": "泛路由-SQLServer IO情况分析"}, {"knowledge_name": "如果某个数据文件IO压力较大，可将热对象移动到其他数据文件或性能更好的磁盘上。或者优化某个引起该问题的SQL语句。", "knowledge_description": "查看数据文件IO相关状态信息"}, {"knowledge_name": "分析服务器IO设备的IO情况", "knowledge_description": "分析服务器IO设备的IO情况"}, {"knowledge_name": "优化SQL", "knowledge_description": "物理读高的SQL"}], "description": "数据文件IO延迟超过50毫秒，说明数据库性能有问题", "rule_name": "file_io_stall_mssql", "id": "8065", "rule_expression": null, "db_type": "SQL Server", "warning_level": "3"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "检查网络、数据库压力、磁盘IO", "knowledge_description": "查看Always on集群概况"}, {"knowledge_name": "检查网络带宽", "knowledge_description": "查看Always on集群同步延迟"}, {"knowledge_description": "查看高可用组AG状态"}, {"knowledge_description": "查看TCP监听状态"}, {"knowledge_description": "查看数据库日志"}], "description": "Always on集群中从库未应用的日志大小超过1MB，请确认从库是否正常", "rule_name": "alwayson_redo_queue_size", "id": "8055", "rule_expression": null, "db_type": "SQL Server", "warning_level": "3"}}
{"type": "rule", "data": {"knowledge_id": [], "description": "AG组角色发生切换，请检查", "rule_name": "mssql_ag_role_switch", "id": "16754", "rule_expression": "[metric,2150066] [oper,==] [num,1]", "db_type": "SQL Server", "warning_level": "4", "warning_message": "AG组{[metric iname,2150065]}角色发生切换，当前角色是{[metric ,2150065]}"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "优化运行时间长的SQL、减少长连接", "knowledge_description": "查看会话信息"}, {"knowledge_name": "减少SQL运行次数或优化相关执行时间长的SQL", "knowledge_description": "运行次数多的SQL"}, {"knowledge_name": "KILL会话", "knowledge_description": "查看锁时间超过5秒的会话信息，请及时确认是否正常，否则应KILL会话"}], "description": "每秒登录超过20次，说明数据库存在频繁登陆", "rule_name": "more_logons_mssql", "id": "8071", "rule_expression": null, "db_type": "SQL Server", "warning_level": "2"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "检查网络带宽", "knowledge_description": "查看Always on集群同步延迟"}, {"knowledge_name": "检查网络、数据库压力、磁盘IO", "knowledge_description": "查看Always on集群概况"}, {"knowledge_description": "查看高可用组AG状态"}, {"knowledge_description": "查看数据库日志"}], "description": "Always on集群某个副本从库延迟时间超过5秒，请确认网络是否正常、数据库是否存在大事务。", "rule_name": "alwayson_relay", "id": "8056", "rule_expression": null, "db_type": "SQL Server", "warning_level": "2"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "立即检查并确认是否正常", "knowledge_description": "查看数据库基本信息"}], "description": "存在处于异常状态的数据库", "rule_name": "anomaly_database_mssql", "id": "11943", "rule_expression": "[metric in time,5,2150064][oper,>=][num,$1]", "db_type": "SQL Server", "warning_level": "4", "warning_message": "存在处于{[metric iname,2150064]}状态数据库的数量为：{[metric in time,5,2150064]}，请立即确认"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "KILL会话", "knowledge_description": "查看锁时间超过5秒的会话信息，请及时确认是否正常，否则应KILL会话"}, {"knowledge_name": "优化运行时间长的SQL、减少长连接", "knowledge_description": "查看会话信息"}, {"knowledge_name": "优化SQL", "knowledge_description": "查看运行时间长的SQL"}, {"knowledge_name": "KILL会话", "knowledge_description": "查看锁时间超过5秒的会话信息，请及时确认是否正常，否则应KILL会话"}, {"knowledge_name": "优化运行时间长的SQL、减少长连接", "knowledge_description": "查看会话信息"}, {"knowledge_name": "优化SQL", "knowledge_description": "查看运行时间长的SQL"}], "description": "被阻塞的会话数超过5则说明系统存在隐患", "rule_name": "block_session_mssql", "id": "8058", "rule_expression": "[metric in time,10,2151143] >[num,$1]", "db_type": "SQL Server", "warning_level": "3"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "增加参数值", "knowledge_description": "检查max server memory (MB)数据库参数是否设置合理"}, {"knowledge_name": "参考下面建议", "knowledge_description": "查看各个对象、实例的缓存命中率"}, {"knowledge_description": "检查数据库占用内存情况"}, {"knowledge_name": "查找出消耗内存多的会话和SQL，并对SQL进行优化", "knowledge_description": "查看数据库使用内存明细"}, {"knowledge_name": "优化表结构数据", "knowledge_description": "查看占用缓存多的对象"}], "description": "Buffer Hit % 低于90%，说明系统系统存在问题", "rule_name": "buffer_cache_hit_ratio_mssql", "id": "8059", "rule_expression": null, "db_type": "SQL Server", "warning_level": "2"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_description": "查看数据库日志"}], "description": "最近数据库发生了重启事件", "rule_name": "db_restart_mssql", "id": "8061", "rule_expression": null, "db_type": "SQL Server", "warning_level": "4", "warning_message": "数据库在{[metric,2150006]}秒前发生了重启"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "优化SQL", "knowledge_description": "查看运行时间长的SQL"}, {"knowledge_name": "优化SQL", "knowledge_description": "物理读高的SQL"}, {"knowledge_name": "及时删除多余索引", "knowledge_description": "检查未使用的索引信息"}, {"knowledge_name": "请及时收集统计或设置自动收集统计信息，有利于生成更准确的执行计划", "knowledge_description": "缺少统计信息或统计信息陈旧的索引"}, {"knowledge_name": "优化SQL，添加索引，减少返回行数", "knowledge_description": "查看返回行数较高的SQL"}], "description": "每秒全表扫描次数超过20次，说明数据库存在性能问题", "rule_name": "full_scans_mssql", "id": "8066", "rule_expression": null, "db_type": "SQL Server", "warning_level": "2"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_description": "数据库同步实时检查"}, {"knowledge_description": "查看TCP监听状态"}, {"knowledge_name": "优化运行时间长的SQL、减少长连接", "knowledge_description": "查看会话信息"}, {"knowledge_description": "查看指定数据库的详细信息"}, {"knowledge_name": "根据建议优化相应问题", "knowledge_description": "分析数据库实例情况"}], "description": "数据库同步异常", "rule_name": "mirroring_disnormal", "id": "8286", "rule_expression": "[metric,2151142] == [num,0] || [metric,2151142] == [num,1] || [metric,2151142] == [num,3] || [metric,2151142] == [num,5]", "db_type": "SQL Server", "warning_level": "4"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "优化SQL", "knowledge_description": "查看运行时间长的SQL"}, {"knowledge_name": "KILL会话", "knowledge_description": "查看锁时间超过5秒的会话信息，请及时确认是否正常，否则应KILL会话"}, {"knowledge_name": "优化运行时间长的SQL、减少长连接", "knowledge_description": "查看会话信息"}], "description": "当前活动会话数超过100个，数据库可能存在问题", "rule_name": "more_active_session_mssql", "id": "8069", "rule_expression": null, "db_type": "SQL Server", "warning_level": "4"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "优化SQL", "knowledge_description": "逻辑读高的SQL"}, {"knowledge_name": "如果某个数据文件IO压力较大，可将热对象移动到其他数据文件或性能更好的磁盘上。或者优化某个引起该问题的SQL语句。", "knowledge_description": "查看数据文件IO相关状态信息"}, {"knowledge_name": "及时删除多余索引", "knowledge_description": "检查未使用的索引信息"}], "description": "每秒逻辑读超过平时平均值10倍，并且超过基线0.8倍，说明应用或者数据出现了异常", "rule_name": "more_logical_read_mssql", "id": "8070", "rule_expression": "[metric,2151078]/[metric hour avg,2151078]>[num,$1] && [metric,2151078]>[bsl upper,2151078]*[num,$2]", "db_type": "SQL Server", "warning_level": "2"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "优化SQL", "knowledge_description": "物理读高的SQL"}, {"knowledge_name": "减少SQL运行次数或优化相关执行时间长的SQL", "knowledge_description": "运行次数多的SQL"}, {"knowledge_name": "优化SQL，添加索引，减少返回行数", "knowledge_description": "查看返回行数较高的SQL"}, {"knowledge_name": "查找出消耗内存多的会话和SQL，并对SQL进行优化", "knowledge_description": "查看数据库使用内存明细"}, {"knowledge_description": "检查数据库占用内存情况"}], "description": "每秒物理读远超出平时平均值10倍，并且超过基线0.8倍，说明应用或者数据出现了异常", "rule_name": "more_phy_read_mssql", "id": "8072", "rule_expression": "[metric,2151077]/[metric hour avg,2151077]>[num,$1] && [metric,2151077]>[bsl upper,2151077]*[num,$2]", "db_type": "SQL Server", "warning_level": "2", "warning_message": "每秒物理读{[metric,2151077]}超出小时平均值{$1}倍，并且超过基线{$2}倍，应用或者数据出现了异常"}}
{"type": "rule", "data": {"knowledge_id": [], "description": "AG组角色发生切换，请检查", "rule_name": "mssql_ag_role_switch", "id": "16755", "rule_expression": "[metric,2150066] [oper,==] [num,1]", "db_type": "SQL Server", "warning_level": "4", "warning_message": "AG组{[metric iname,2150065]}角色发生切换，当前角色是{[metric ,2150065]}"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "优化SQL", "knowledge_description": "CPU时间高的SQL"}, {"knowledge_description": "分析指标、SQL相似度"}, {"knowledge_description": "按CPU时间排序的TOP 20 存储过程"}, {"knowledge_name": "保证SQL语句WHERE条件指定类型和字段类型一致", "knowledge_description": "查看TOP 10发生隐式转换的SQL"}, {"knowledge_name": "根据智能诊断发现的异常指标以及推荐的诊断路径下钻分析", "knowledge_description": "泛路由-SQLServer CPU情况分析"}], "description": "CPU使用率超过80%，CPU可能存在压力", "rule_name": "cpu_use", "id": "8060", "rule_expression": null, "db_type": "SQL Server", "warning_level": "2"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "优化SQL", "knowledge_description": "物理读高的SQL"}, {"knowledge_name": "如果某个数据文件IO压力较大，可将热对象移动到其他数据文件或性能更好的磁盘上。或者优化某个引起该问题的SQL语句。", "knowledge_description": "查看数据文件IO相关状态信息"}, {"knowledge_name": "及时添加索引将大大提升查询效率", "knowledge_description": "查看查询中缺少的索引情况"}, {"knowledge_name": "提升磁盘IO性能，分开存放日志文件和数据文件", "knowledge_description": "查看WRITELOG等待事件信息"}, {"knowledge_name": "优化SQL，减少磁盘IO操作。使用性能更好的磁盘。", "knowledge_description": "查看IO_COMPLETION等待事件信息"}, {"knowledge_name": "分析服务器IO设备的IO情况", "knowledge_description": "分析服务器IO设备的IO情况"}, {"knowledge_name": "提升磁盘性能", "knowledge_description": "查看PAGEIOLAT_SH等待事件的信息"}, {"knowledge_name": "提升磁盘性能，优化相关SQL，将日志文件、临时文件和数据文件存放到不同磁盘等", "knowledge_description": "查看PAGEIOLAT_DT等待事件的信息"}, {"knowledge_name": "根据智能诊断发现的异常指标以及推荐的诊断路径下钻分析", "knowledge_description": "泛路由-SQLServer IO情况分析"}], "description": "磁盘IO高", "rule_name": "disk_reads", "id": "8064", "rule_expression": null, "db_type": "SQL Server", "warning_level": "2"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "优化SQL", "knowledge_description": "查看运行时间长的SQL"}, {"knowledge_name": "优化SQL", "knowledge_description": "物理读高的SQL"}, {"knowledge_name": "及时删除多余索引", "knowledge_description": "检查未使用的索引信息"}, {"knowledge_name": "重建索引", "knowledge_description": "查看索引碎片"}, {"knowledge_name": "根据智能诊断发现的异常指标以及推荐的诊断路径下钻分析", "knowledge_description": "泛路由-SQLServer IO情况分析"}], "description": "平均执行时间超过5秒的SQL数量超过10个，表示系统存在系统问题", "rule_name": "long_sqls_mssql", "id": "8067", "rule_expression": null, "db_type": "SQL Server", "warning_level": "2"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "内存不够用，需要增加内存或优化相关SQL", "knowledge_description": "查看等待分配内存的进程信息"}, {"knowledge_name": "根据智能诊断发现的异常指标以及推荐的诊断路径下钻分析", "knowledge_description": "泛路由-SQLServer 内存情况分析"}, {"knowledge_name": "查找出消耗内存多的会话和SQL，并对SQL进行优化", "knowledge_description": "查看数据库使用内存明细"}, {"knowledge_name": "优化表结构数据", "knowledge_description": "查看占用缓存多的对象"}, {"knowledge_name": "及时添加索引将大大提升查询效率", "knowledge_description": "查看查询中缺少的索引情况"}, {"knowledge_name": "启用optimize for ad hoc workloads启用参数化来优化此问题，但要提前测试！！！", "knowledge_description": "查看即席查询(Adhoc)的执行计划占用内存情况"}, {"knowledge_name": "优化占用内存多的对象和SQL执行计划", "knowledge_description": "查看TOP 10 内存分配器占用内存情况"}], "description": "内存不够，存在等待内存的进程", "rule_name": "memory_presure", "id": "8068", "rule_expression": "[metric,2151003]<[num,$1] && ([metric,2151054]>[num,$2] || [metric,2151087]>[num,$3])", "db_type": "SQL Server", "warning_level": "2"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "优化SQL", "knowledge_description": "查看运行时间长的SQL"}, {"knowledge_name": "KILL会话", "knowledge_description": "查看锁时间超过5秒的会话信息，请及时确认是否正常，否则应KILL会话"}, {"knowledge_name": "提升磁盘IO性能，分开存放日志文件和数据文件", "knowledge_description": "查看WRITELOG等待事件信息"}], "description": "每秒事务数（User Transaction Per Sec）超过最近1小时平均值的10倍，说明应用可能存在异常", "rule_name": "more_trans_mssql", "id": "8073", "rule_expression": "[metric,2151061]/[metric hour avg,2151061]>[num,$1]", "db_type": "SQL Server", "warning_level": "2"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "请删除不需要的文件、删除文件组中的对象、将其他文件添加到文件组或为文件组中的现有文件启用自动增长，以便增加可用磁盘空间。", "knowledge_description": "查看数据文件所在磁盘的空间使用率"}, {"knowledge_name": "1.添加数据文件。2.调整数据文件自动增长", "knowledge_description": "查看数据文件空间使用率"}], "description": "数据文件所在磁盘可用大小，小于10GB，请及时添加存储或清除无效大对象", "rule_name": "mssql_disk_avail", "id": "8074", "rule_expression": null, "db_type": "SQL Server", "warning_level": "4", "warning_message": "{[metric iname,2154010]}的最大可用大小小于10GB，为{[metric,2154010]}GB"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "请在主库上执行该知识点", "knowledge_description": "查看日志传输还原的错误信息"}, {"knowledge_name": "在从库上运行该知识点", "knowledge_description": "查看从库还原日志情况"}], "description": "日志传输还原延迟时间过高，超过1分钟", "rule_name": "mssql_log_skipping_relay_high", "id": "8075", "rule_expression": null, "db_type": "SQL Server", "warning_level": "2"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "1.添加数据文件。2.调整数据文件自动增长", "knowledge_description": "查看数据文件空间使用率"}, {"knowledge_name": "请删除不需要的文件、删除文件组中的对象、将其他文件添加到文件组或为文件组中的现有文件启用自动增长，以便增加可用磁盘空间。", "knowledge_description": "查看数据文件所在磁盘的空间使用率"}], "description": "数据文件可扩展最大可用大小小于5000MB", "rule_name": "mssql_max_avail_file", "id": "8076", "rule_expression": "[metric min,2154007] < [num,$1]", "db_type": "SQL Server", "warning_level": "2", "warning_message": "{[metric iname,2154007]}的最大可用大小小于5000 MB，为{[metric min iname,2154007]} MB"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "1.添加数据文件。2.调整数据文件自动增长", "knowledge_description": "查看数据文件空间使用率"}, {"knowledge_name": "请删除不需要的文件、删除文件组中的对象、将其他文件添加到文件组或为文件组中的现有文件启用自动增长，以便增加可用磁盘空间。", "knowledge_description": "查看数据文件所在磁盘的空间使用率"}], "description": "数据文件可扩展最大大小的已使用率超过90%", "rule_name": "mssql_max_used_per_file", "id": "8077", "rule_expression": null, "db_type": "SQL Server", "warning_level": "4", "warning_message": "{[metric iname,2154009]}的最大使用率超过90%，为{[metric,2154009]}%"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "重建索引", "knowledge_description": "查看索引页拆分情况"}, {"knowledge_name": "重建索引", "knowledge_description": "查看索引碎片"}, {"knowledge_name": "如果某个数据文件IO压力较大，可将热对象移动到其他数据文件或性能更好的磁盘上。或者优化某个引起该问题的SQL语句。", "knowledge_description": "查看数据文件IO相关状态信息"}, {"knowledge_name": "针对不同的指标、进行针对性的分析", "knowledge_description": "SqlServer数据库负载指标分析"}], "description": "页拆分次数过高，页拆分是个很昂贵得动作，除了IO操作外，还会引起表碎片问题", "rule_name": "mssql_page_splits", "id": "8078", "rule_expression": "[metric,2151130]>[num,$1] || [metric,2151130]/[metric hour avg,2151132]>[num,$2] ", "db_type": "SQL Server", "warning_level": "2"}}
{"type": "rule", "data": {"knowledge_id": [{"knowledge_name": "优化运行时间长的SQL、减少长连接", "knowledge_description": "查看会话信息"}, {"knowledge_name": "KILL会话", "knowledge_description": "查看锁时间超过5秒的会话信息，请及时确认是否正常，否则应KILL会话"}], "description": "锁时间超过30秒，请确认是否需要KILL", "rule_name": "wait_time_locks", "id": "16765", "rule_expression": "[metric,2152037]>[num,$1]", "db_type": "SQL Server", "warning_level": "3", "warning_message": "{[metric iname,2152037]的}的锁时间超过30秒，为{$1}毫秒。"}}
