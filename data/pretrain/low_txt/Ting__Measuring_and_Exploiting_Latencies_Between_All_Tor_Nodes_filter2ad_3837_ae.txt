### Median Probability of a Node Being on a Path with RTT = x

The median probability of a node being on a path with a specific Round-Trip Time (RTT) = x is a metric that captures the "entropic" nature of the set of circuits for a given RTT and path length. For example, in our dataset, the number of 10-hop circuits capable of achieving an RTT of 1.9 seconds is very small, which is reflected by the low value at x = 1.9. Figure 17 illustrates that, for many circuit lengths, low-latency circuits do not rely on a small fraction of peers; it is only 10-hop circuits that significantly sacrifice entropy for RTTs less than 500 ms.

### Entropy and Circuit Length

Using measurements like those in Figure 17, if an attacker knows a victim’s circuit length and end-to-end RTT, they may be able to quickly narrow down the set of potential circuits in use. The most entropic region for any given circuit length is naturally in the intermediate RTT values. By choosing circuits within this range of RTT values, users can thwart such attacks. A user can increase the number of potential circuits for a given RTT by consulting the data provided by Ting. For instance, if a user seeks a circuit in the range of 200-300 ms, there are many 3-hop, 4-hop, and 5-hop circuits available. As a result, if an attacker learns the end-to-end RTT (e.g., if the attacker is running a web server and trying to identify Tor users), there would be over two orders of magnitude more possible circuits than if the user had restricted themselves to 3-hop nodes.

### Ramifications of Longer Circuits

The use of longer circuits represents a tragedy of the commons: while end-users may benefit, longer circuits consume more resources from the Tor network as a whole. Since circuits are determined strictly by the source, the system has limited means to prevent a self-interested but rational user from adopting longer circuits. We believe that approaches to provide incentive-compatibility in Tor [19, 3, 5] are increasingly important as longer circuits become feasible.

Although longer circuits can help defend against external attackers, their effectiveness in the presence of active adversaries within the Tor network is less clear. Assuming a fixed fraction of malicious Tor nodes, as circuits grow longer, the probability increases that an adversary will be one of the chosen hops, making deanonymization through traffic analysis possible [14]. Whether this increased probability outweighs the obfuscation benefits of longer circuits merits further study.

### Design Space for Circuit Length

The results in this section suggest that there is potential for a larger design space than Tor’s three-hop default: longer hops need not necessarily induce greater latency. How to leverage this to achieve different balances between security and performance is an interesting area for future work.

### Ting as a Measurement Platform

The final application we consider is arguably Ting’s most natural: as a platform for directly measuring latencies between hosts that researchers may not otherwise have access to.

King [11] measured the latency between DNS servers thought to be near clients or servers in the Internet to estimate the latency between those hosts. In 2002, Gummadi et al. found that 72–79% of authoritative name servers supported remote recursive queries to support King; we find that only 3% continue to do so today, presumably due to concerns over amplification attacks. This change inspired us to apply Ting to the same problem: to estimate latency between hosts thought to be near Tor relays. Compared to King, Ting offers higher accuracy because the Tor node representing a prefix is a member of that prefix, rather than an authoritative name server that may be much better connected or remote. However, Ting has the disadvantage that not every residential subnet has a Tor node.

### Coverage Evaluation

We can evaluate Ting’s coverage in three dimensions: geography, network, and host type. The geographical coverage of Tor is well-known: many countries are represented, with Tor Metrics [32] reporting 77 countries with relays in November 2014. However, there are some countries where Tor is blocked.

In terms of network diversity, we show the number of unique /24 IP address prefixes and the total number of relays in the Tor network from February 28, 2015, to April 28, 2015, in Figure 18. We consider /24 prefixes because they represent a network allocation likely to be geographically clustered. During this two-month period, we observed between 5426 and 6044 unique /24s. Compared with past data collected by Tor Metrics [32], the total number of relays has grown by roughly 30% since the previous year.

Finally, host types are diverse. The pool of relays is predominantly volunteer-run, and many relays are run from within homes. To quantify the number of residential hosts, we extended the residential detection technique described by Schulman et al. [27], which involves classifying hosts based on their reverse DNS name, including suffix and presence of numbers. Using this technique, we found that, of the 5484 currently running Tor relays with a reverse DNS name, at least 3355, or roughly 61%, are residential. This underestimates the fraction of residential hosts because there are many Tor relays outside of the U.S. and Europe that are not accounted for, and because the remaining 1150 of the 6634 currently running relay addresses have no reverse DNS name. Data centers are also represented, with 361 at hosting sites identified by reverse DNS name (e.g., linode.com, amazonaws.com, ovh.com, cloudatcost.com, your-server.de, and leaseweb.com), and another 345 within Digital Ocean’s IP address range.

### Summary

This section demonstrated a wide range of applications that benefit from Ting’s accurate RTT measurements. We believe the set of applications to which Ting is beneficial is both broader and deeper than what is covered here. Even with these few examples, we can conclude that Ting’s accurate, all-pairs RTT estimation can be an extremely powerful tool in securing and improving Tor.

### Conclusion

In this paper, we presented Ting, a novel and practical technique for measuring round-trip times between any arbitrary pair of Tor relays with accuracy and at scale. Ting sets itself apart from previous attempts to compute latency information in that: (1) it does not require any modification of the Tor client or protocol, (2) it does not require any additional infrastructure deployment, and (3) it calculates latencies by sending packets along the entire network path.

### Acknowledgments

We thank our shepherd, Phillipa Gill, and the anonymous IMC reviewers for their helpful comments. This research was supported in part by NSF grant CNS-1409191, the National Security Agency as part of a Science of Security lablet, and an Amazon Web Services in Education grant.

### References

[1] S. Agarwal and J. R. Lorch. Matchmaking for online games and other latency-sensitive P2P systems. In ACM SIGCOMM, 2009.
[2] M. Akhoondi, C. Yu, and H. V. Madhyastha. LASTor: A low-latency AS-aware Tor client. In IEEE Symposium on Security and Privacy, 2013.
[3] E. Androulaki, M. Raykova, S. Srivatsan, A. Stavrou, and S. M. Bellovin. PAR: Payment for anonymous routing. In Symposium on Privacy Enhancing Technologies (PETS), 2008.
[4] D. Chaum. Untraceable electronic mail, return addresses, and digital pseudonyms. Communications of the ACM, 24(2):84–88, Nov. 1981.
[5] Y. Chen, R. Sion, and B. Carbunar. XPay: Practical anonymous payments for Tor routing and other networked services. In Workshop on Privacy in the Electronic Society (WPES), 2009.
[6] R. Cox, F. Dabek, F. Kaashoek, J. Li, and R. Morris. Practical, distributed network coordinates. In Workshop on Hot Topics in Networks (HotNets), 2003.
[7] R. Dingledine, N. Mathewson, and P. Syverson. Tor: The second-generation onion router. In USENIX Security Symposium, 2004.
[8] R. Dingledine and S. J. Murdoch. Performance improvements on Tor or, why Tor is slow and what we’re going to do about it. Online: https://www.torproject.org/press/presskit/2009-03-11-performance.pdf, 2009.
[9] N. S. Evans, R. Dingledine, and C. Grothoff. A practical congestion attack on Tor using long paths. In USENIX Security Symposium, 2009.
[10] Y. Gilad and A. Herzberg. Spying in the dark: TCP and Tor traffic analysis. In Privacy Enhancing Technologies, pages 100–119. Springer, 2012.
[11] K. P. Gummadi, S. Saroiu, and S. D. Gribble. King: Estimating latency between arbitrary Internet end hosts. In ACM Internet Measurement Workshop (IMW), 2002.
[12] N. Hopper, E. Y. Vasserman, and E. Chan-Tin. How much anonymity does network latency leak? ACM Transactions on Information and System Security (TISSEC), 13(2):13, 2010.
[13] R. Jansen, J. Geddes, C. Wacek, M. Sherr, and P. Syverson. Never been KIST: Tor’s congestion management blossoms with kernel-informed socket transport. In USENIX Security Symposium, 2014.
[14] A. Johnson, C. Wacek, R. Jansen, M. Sherr, and P. Syverson. Users get routed: Traffic correlation on Tor by realistic adversaries. 2013.
[15] C. Lumezanu, R. Baden, D. Levin, N. Spring, and B. Bhattacharjee. Symbiotic relationships in Internet routing overlays. In Symposium on Networked Systems Design and Implementation (NSDI), 2009.
[16] S. J. Murdoch and G. Danezis. Low-cost traffic analysis of Tor. In USENIX Security Symposium, 2005.
[17] Neustar IP Geolocation. https://www.neustar.biz/services/ip-intelligence.
[18] T. E. Ng and H. Zhang. Towards global network positioning. In ACM Internet Measurement Workshop (IMW), 2001.
[19] T.-W. Ngan, R. Dingledine, and D. S. Wallach. Building incentives into Tor. In Financial Cryptography (FC), 2010.
[20] A. Panchenko and J. Renner. Path selection metrics for performance-improved onion routing. In ACM SIGCOMM, 2009.
[21] L. Peterson, T. Anderson, D. Culler, and T. Roscoe. A blueprint for introducing disruptive technology into the Internet. In Workshop on Hot Topics in Networks (HotNets), 2002.
[22] M. K. Reiter and A. D. Rubin. Crowds: Anonymity for web transactions. ACM TISSEC, 1(1):66–92, Nov. 1998.
[23] Reporters Without Borders. Enemies of the Internet 2013 Report. https://surveillance.rsf.org/en/wp-content/uploads/sites/2/2013/03/enemies-of-the-internet_2013.pdf, Mar. 2013.
[24] RIPE NCC. RIPE Atlas. https://atlas.ripe.net.
[25] SamKnows. https://www.samknows.com.
[26] S. Savage, A. Collins, E. Hoffman, J. Snell, and T. Anderson. The end-to-end effects of Internet path selection. In ACM SIGCOMM, 1999.
[27] A. Schulman and N. Spring. Pingin’ in the rain. In ACM Internet Measurement Conference (IMC), 2011.
[28] M. Sherr, M. Blaze, and B. T. Loo. Scalable link-based relay selection for anonymous routing. In Privacy Enhancing Technologies Symposium (PETS), 2009.
[29] R. Sherwood, B. Bhattacharjee, and A. Srinivasan. P5: A protocol for scalable anonymous communication. Journal of Computer Security, 13(6):839–876, 2005.
[30] Stem Controller Library. https://stem.torproject.org.
[31] S. Sundaresan, S. Burnett, N. Feamster, and W. De Donato. BISmark: A testbed for deploying measurements and applications in broadband access networks. In USENIX Annual Technical Conference, 2014.
[32] Tor Metrics. https://metrics.torproject.org.
[33] B. Wong, I. Stoyanov, and E. G. Sirer. Octant: A comprehensive framework for the geolocalization of Internet hosts. In Symposium on Networked Systems Design and Implementation (NSDI), 2007.