### Figure 3: Discovery of Open DoT Resolvers
In each scan, over 1,500 open DoT (DNS-over-TLS) resolvers were identified, a significantly higher number than those listed in public resolver lists. Geographically, Table 2 highlights the top 10 countries with the most resolvers and their fluctuations during our scan period. Notably, the number of DoT resolvers in Ireland, Brazil, and Russia doubled within three months, while those in the United States increased by four times. Conversely, there was a significant decline (-84%) in the number of DoT resolvers in China, primarily due to the shutdown of resolvers belonging to a cloud hosting platform.

### Ratio Comparison
Our ratio of discovered resolvers is lower than that reported in [47] because we exclude probes using well-known public resolvers (e.g., 8.8.8.8) as their local resolver. Examples of DoT-capable local resolvers we identified include 194.109.6.66 (AS3265, Xs4all Internet BV), 212.242.40.51 (AS9158, Telenor A/S), and 78.158.0.2 (AS43700, UAB Consilium Optimum).

### Finding 1.2: SSL Certificate Validity
Approximately 25% of DoT providers use resolvers equipped with invalid SSL certificates, including a large provider and TLS inspection devices. In contrast, public DoH (DNS-over-HTTPS) servers maintain good certificate management. SSL certificates are crucial for clients to authenticate their DNS servers. Using `openssl` [13], we fetched and verified the certificates of all discovered resolvers, configuring the tool to trust the system-wide trust store of CentOS 7.6 (i.e., Mozilla CA list [19]). Since the names of DoT resolvers are unknown to us, we did not compare domain names to the provided certificates but only verified the certificate paths.

Figure 4 shows that around 25% of DoT providers have at least one resolver with an invalid certificate. In our latest scan (May 1), 122 resolvers from 62 providers used invalid certificates, including 27 expired, 67 self-signed, and 28 with invalid certificate chains. Among the 27 expired certificates, 9 expired in 2018 (e.g., 185.56.24.52, expired Jul 2018), indicating potential lack of maintenance. Two resolvers of a large provider (Perfect Privacy, see Figure 3) used self-signed certificates. Additionally, 47 resolvers used self-signed default certificates of FortiGate (a firewall by Fortinet) [43], acting as DoT proxies that inspect encrypted queries from DNS clients. In contrast, no invalid certificates were found on port 443 of all 17 DoH resolvers we discovered. This is reasonable because DoH requires strict authentication, and queries will fail if resolvers cannot be authenticated.

Using invalid certificates poses privacy risks to DNS clients, as they cannot authenticate the servers. Therefore, we recommend that providers regularly examine and correct misconfigurations in their resolvers.

### 4. CLIENTS: USING DNS-OVER-ENCRYPTION
For traditional DNS, studies have shown that some DNS clients may experience issues such as inability to connect [60, 74]. For common users, there are also concerns about the performance overhead of encrypting DNS transactions [62, 68]. To assess the current technology readiness of DNS-over-Encryption, we conducted a global large-scale measurement study focusing on client-side usability. This section describes our methodology, which addresses two major challenges. We then analyze the factors preventing global clients from using public DNS-over-Encryption resolvers and perform a country-level analysis of the performance overhead of encrypted DNS queries.

#### 4.1 Methodology
**Experiment Setup:** The first challenge in performing a large-scale measurement is to collect a large number of global vantage points. These vantage points should be able to send encrypted DNS queries directly to public server addresses, rather than their local DNS resolvers. We addressed this challenge by using two SOCKS proxy networks, as described below in "Vantage Points." From the collected clients, we developed a measurement platform and performed a Reachability test on a set of popular public DNS-over-Encryption resolvers. The second challenge was to conduct a Performance test on query latency using proxy networks without direct control over the vantage points.

**Vantage Points:** To obtain different vantage points globally, we leveraged two residential TCP SOCKS proxy networks. As shown in Figure 5, the proxy network accepts traffic generated by our measurement client and forwards it to various proxy nodes. This setup is suitable for encrypted DNS queries, as both DoT and DoH are based on TCP and TLS. We used ProxyRack [5], a residential TCP SOCKS proxy network with over 600,000 endpoints in more than 150 countries, and Zhima [10], whose endpoints are located in 5 ASes of two Chinese ISPs. Both platforms forward our traffic to exit nodes without intercepting TLS sessions.

Table 3 summarizes our collected dataset, with 122,991 vantage points in total. Through ProxyRack, we collected over 29K clients from 166 countries, as shown in Figure 6.

**Reachability Test:** To test whether DNS-over-Encryption services are affected by in-path devices, we performed DNS lookups on each proxy client. We narrowed down our test scope to three large and representative public resolvers: Cloudflare [2], Google [4], and Quad9 [14]. For comparison, we included a self-built resolver supporting clear-text DNS, DoT, and DoH.

Figure 7 presents the workflow of our reachability test. From each vantage point, we issued clear-text DNS, DoT, and DoH queries to each resolver in our list, using A-type requests for our own domain name to avoid caching. When testing DoT and DoH, we collected and verified their SSL certificates. We used the Opportunistic Privacy profile for DoT queries and the Strict-Privacy profile for DoH. To understand why DNS-over-Encryption resolvers are not accessible, we probed common ports and fetched webpages of the resolvers from failed clients, comparing these results with the genuine resolvers' open ports and webpages.

**Performance Test:** DNS-over-Encryption can introduce performance overhead, particularly in query latency. We focused on the relative performance overhead between DNS-over-Encryption and clear-text DNS. Connection reuse significantly impacts performance, and it is the default setting in popular client-side software and servers. We considered connection reuse as the major scenario and used DNS/TCP as the baseline for clear-text DNS, as it has equivalent performance to DNS/UDP with reused connections.

To observe DNS query latency, we encountered a challenge as we do not have direct control over the vantage points. Instead, we observed query latency on our measurement client, which is larger than the actual DNS query latency. We issued 20 DNS/TCP, DoT, and DoH queries on each proxy client, calculated the medians of TR for each kind of DNS request, and compared their differences as relative performance overhead.

**Limitations:** Our proxy networks only allow TCP traffic, so we used DNS/TCP for the baseline test. However, DNS/TCP has equivalent performance to DNS/UDP with reused connections, so this does not affect our test results.

**Ethics:** The ethical considerations center on the proxy networks. We used commercial platforms and abided by their terms of service. The endpoints are recruited by the platforms, and we only generated benign DNS and HTTP requests, ensuring no harm to the proxy clients.

### 4.2 Reachability to DNS-over-Encryption Servers
**Key Observation 2:** Over 99% of global users can normally access large DNS-over-Encryption servers, while less than 1% of clients experience problems due to IP conflicts, censorship, and TLS interception.

Table 4 presents our reachability test results. We investigated whether DNS-over-Encryption services are affected by the following behaviors:
- **IP Conflict:** Issues arise from addresses being taken by in-path devices, blackholed, or used for internal purposes.
- **Censorship:** Some networks block or manipulate DNS traffic.
- **TLS Interception:** Devices intercept and inspect TLS-encrypted DNS queries.